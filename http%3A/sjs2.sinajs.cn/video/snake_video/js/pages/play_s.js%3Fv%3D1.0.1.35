SVK.register("common.channel.widget",function(a){return a.listener("common.channel.widget",["onVisibleReady","onStart","onComplete"])});
SVK.register("common.extra.lazyload",function(a){(function(a){function e(c,e,g){if(!b){b=!0;a(window).on("scroll",f);a(window).on("resize",f)}if(i(c,g))try{e.apply(c)}catch(h){}else d.add(function(){if(i(c,g)){try{e.apply(c)}catch(a){console.error(a)}d.remove(arguments.callee)}});return this}function f(){clearTimeout(c);c=setTimeout(function(){g()},150)}function g(){d.fire()}function h(){if(b){b=!1;a(window).off("scroll",f);a(window).off("resize",f)}}function i(b,c){var d,e,f,g;d=a(b);e=a(window);g=d.offset().top;f=e.scrollTop();return g<=f+e.height()-(c||0)}var b,c,d=a.Callbacks("memory");e.fire=g;e.inVisibleArea=i;e.destroy=h;a.lazyload=e;a.fn.lazyload=function(b,c){return a.each(a(this),function(a,d){return e(d,b,c)})}})(jQuery);return a.lazyload});
jQuery.ajaxSetup({accepts:{linkstyle:"text/css"}});jQuery.ajaxPrefilter("linkstyle",function(a){a.cache===undefined&&(a.cache=!1);a.type="GET"});jQuery.ajaxTransport("linkstyle",function(a){var b,c,d=navigator.userAgent.replace(/.*AppleWebKit\/(\d+)\..*/,"$1")*1<536;return{send:function(e,f){var g,h;h=function(a){a=a||200;if(!g){g=!0;h=function(){};f(a)}};b=jQuery("<link>").prop({rel:"stylesheet",charset:a.styleCharset,href:a.url}).on("load error",c=function(a){c=null;a&&h(a.type==="error"?404:200,a.type)});(function(){var a=b.get(0).sheet,c=arguments;if(d&&a){h();return}try{a.cssRules&&h()}catch(e){e.name=="NS_ERROR_DOM_SECURITY_ERR"?h():setTimeout(function(){c.callee()},10)}})();document.getElementsByTagName("head")[0].appendChild(b[0])},abort:function(){c&&c()}}});jQuery.getLinkStyle=function(a,b){return jQuery.get(a,undefined,b,"linkstyle")};
SVK.register("common.extra.loader",function(a){(function(a){function b(b,c){var d,b=a.isArray(b)?b:[b],c=c||{},e=a.Deferred();d=b.length;a.when.apply(a,a.map(b,function(b){return a.ajax(b)})).done(function(){var b=0,c=d==1?[arguments]:arguments;a.each(c,function(a,c){c=c||[];/success/i.test(c[1])&&++b});b==d&&e.resolveWith(e,c)}).fail(function(){e.rejectWith(e,arguments)});e.done(function(){a.isFunction(c.success)&&c.success.apply(a,arguments)}).fail(function(){a.isFunction(c.error)&&c.error.apply(a,arguments)});return e.promise()}a.widget=a.widget||{};a.widget.loader=b})(jQuery);return a.widget.loader});
SVK.register("common.widget.loader",function(a){var b=a.common.channel.widget;(function(){function l(b){b=a.extend({id:"",require:[],rate:0,exports:function(){},isDepend:!1,initialize:!1,requireParams:[],loadTime:null},b);b.node=b.id?a("#"+b.id):null;b.isVisible=b.node?a.lazyload.inVisibleArea(b.node):!1;b.rate+=!!b.isVisible;return b}function m(){c.sort(function(a,b){return a.rate-b.rate<0});a.each(c,function(b,c){if(typeof c=="object"&&a.inArray(c,g)==-1){c.isVisible?d.push(c):c.node&&a.lazyload(c.node,function(){n(c)});c.loadTime&&a.addLoadEvent(c.loadTime,function(){n(c)})}});(function(){var c,e,f=arguments;a.each(d,function(a,b){b&&b.async&&n(b)});d.length&&(c=d.shift())?n(c,f.callee):b.onVisibleReady.fire()})()}function n(c,d){var require=c.require,require=a.isArray(require)?require:[require],f=c.node,h=[],i;if(a.inArray(c,g)!=-1){a.isFunction(d)&&d();return}g.push(c);require=a.map(require,function(b,d){var e,f;if(b){e=p(b);if(f=c.requireParams[d]){var g=e.data;a.extend(e,f);a.extend(e.data,g)}return e}});h=a.map(require,function(a){if(a&&a._evalVar_)return a._evalVar_});require=a.map(require,function(b){if(a.inArray(b.url,e)==-1)return b});require=a.map(require,function(a){if(!q(a._evalVar_))return a});i=function(){a.isFunction(d)&&d();a.isFunction(c.exports)&&c.exports.apply(f||a,[f,c]);a.each(require,function(a,b){b._fileType_=="js"&&b.url&&e.push(b.url)});c.initialize&&function(){var b,d;if(h.length&&(b=h.shift())&&(d=q(b))&&a.isFunction(d.init))try{d.init.apply(a,[f,c])}catch(e){}}();a.isReady&&a(document).ready(function(){try{var a=document.createEvent("HTMLEvents");a.initEvent("DOMContentLoaded",!0,!0);document.dispatchEvent(a)}catch(b){}});b.onComplete.fire(c)};b.onStart.fire(c);if(require.length)if(c.isDepend){var j=[].concat(require);(function(){var b;j.length&&(b=j.shift())?a.widget.loader(b).done(arguments.callee).fail(arguments.callee):setTimeout(i,0)})()}else a.widget.loader(require).done(i).fail(i);else i()}function o(a){return h.test(a)?"css":"js"}function p(a){var b,c,d,e;c=o(a);if(!i.test(a)){b=a.replace(/\./g,"/")+"."+c;b=j[c]+b;c=="js"&&(e=a)}else b=a;return{url:b,_fileType_:c,_evalVar_:e,cache:!0,data:k[c]&&e?{v:k[c]}:{},dataType:{js:"script",css:"linkstyle"}[c]}}function q(b){var c,d,e,f=SVK;b=a.trim(b)||"";e=b.split(".");while(e.length&&(c=e.shift()))if(f[c]){f=f[c];e.length==0&&(d=!0)}return d?f:!1}var c=[],d=[],e=[],f={},g=[],h=/\.css(?:\?|$)/gi,i=/(http|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:/~\+#]*[\w\-\@?^=%&amp;/~\+#])?/,j={js:"http://sjs0.sinajs.cn/video/snake_video/js/",css:"http://sjs0.sinajs.cn/video/snake_video/css/"},k={};a.addLoadEvent=function(b,c){var d;if(a.type(b)=="string"){d=f[b]||(f[b]=a.Callbacks("once memory"));a.isFunction(c)&&(b=="DOMContentLoaded"?a(document).ready(c):d.add(c))}};a.fireLoadEvent=function(b){var c;a.type(b)=="string"&&(c=f[b])&&c.fire()};a.startLoadWidget=function(b){var d;b=b||{};d=a.isArray(b.widget)?b.widget:[b.widget];a.extend(j,b.path);a.extend(k,b.version);a.each(d,function(a,b){b&&c.push(new l(b))});m()}})(jQuery);a(document).ready(function(){a.fireLoadEvent("DOMContentLoaded")});b.onVisibleReady.add(function(){a.fireLoadEvent("onVisibleReady")});a(window).on("load",function(){a.fireLoadEvent("onload")});return{startLoadWidget:a.startLoadWidget,fireLoadEvent:a.fireLoadEvent,addLoadEvent:a.addLoadEvent}});
SVK.register("common.channel.shijiao.player",function(a){return a.listener("common.channel.shijiao.player",window.$PlayerCallNameArr)});
SVK.register("common.channel.player",function(a){var b=["flashInitCompleted","playCompleted","getPlayer","playStart","toWide","toNarrow","lightOff","lightOn","setLight","pIaskError","pIAskEd","pAdPlayStart","pLoadStreamTime","firstView","setFactoryValue","setPlayerSize","adComplete"];return a.listener("common.chanel.player",b)});
SVK.register("common.userInfo.userLogin",function(a){var b=function(a,b){if(!a)return"";b||(b=30);var c=Number(a)%8+1;return"http://portrait"+c+".sinaimg.cn/"+a+"/blog/"+b+"/"+(new Date).getTime()},c=function(){var c=a.trim(a.cookie.get("SUP")),d={};if(c){d=a.queryToJson(unescape(c),!0);d.ownurl="http://you.video.sina.com.cn/m/"+d.uid;d.pic=b(d.uid)}return d};return{getUser:function(){return c()},islogin:function(){var a=c();return a&&a.uid?!0:!1},logoutURL:function(){return"http://login.sina.com.cn/cgi/login/logout.php?r="+encodeURIComponent(location.href)},getOwnURL:function(a){return"http://you.video.sina.com.cn/m/"+a},getOwnPic:b}});
SVK.register("common.channel.brgLoginChannel",function(a){return a.listener("common.channel.brgLoginChannel",["login","loginMsg","showLogin","showCallback","hideCallback","hide","toggle"])});
SVK.register("common.channel.shijiao.playerPage",function(a){return a.listener("common.channel.shijiao.playerPage",["loadWidgetPlayer"])});
SVK.register("tpl.brgLoginLayer",function(a){return['<div class="hd">','<a href="javascript:void(0);" class="cls" action-type="close"></a>','<div class="tl">登录发送弹幕</div>','<div class="erro" node-type="msg"></div>',"</div>",'<ul class="login_item">','<li><input type="text" name="username" class="log_ipt" placeholder="微博/邮箱/手机号" enter="true" errormsg="请输入用户名" verify="require=true"></li>','<li><input type="password" name="password" class="log_ipt" placeholder="输入密码" errormsg="请输入密码" enter="true" verify="require=true"></li>',"<li>",'<a href="javascript:void(0);" class="login_btn" action-type="submit">登录</a>','<div class="plus">','<a href="https://login.sina.com.cn/signup/signup?entry=vblog&r=http%3A%2F%2Fv.sina.com.cn" target="_blank">我要注册</a>','<a href="http://login.sina.com.cn/member/getpwd/getpwd0.php?entry=vblog" target="_blank">忘记密码</a>',"</div>","</li>","</ul>"].join("")});
SVK.register("comp.user.brgLoginTrans",function(a){var b=a.common.channel.brgLoginChannel,c=function(c,d){if(!sinaSSOController)return;sinaSSOController.entry="vblog";sinaSSOController.pageCharset="UTF-8";sinaSSOController.customLoginCallBack=function(c){if(!c.result){b.loginMsg.fire(c);return}b.login.fire();try{a.common.userInfo.userControl.resetLogin();a.common.channel.loginChannel.login.fire()}catch(d){}};sinaSSOController.login(c,d,30)},d={};d.send=function(a,b){c(a,b)};return d});
SVK.register("comp.user.brgLoginVal",function(a){var b=a.common.verify.verifydata,c=a.comp.user.brgLoginTrans,d=a.common.extra.textDefault,e=a.common.extra.bindEnter,f=a.common.channel.brgLoginChannel,g=function(a,b){var c="";switch(a){case"fail":b=b||"登录失败";c=b}return c};return function(h){var i=h.node,j=a(h.msgNode,i),k={},l=!1,m=i.find('[action-type="submit"]'),n=i.find("[name]"),o=a(h.close,i),p={},q={submit:function(){if(l)return;p.clearMsg();var b=k.verify.verify();if(!b.result){j.html(g("fail",b.msg)).show();return}m.html(h.msgLogining);l=!0;c.send(a.trim(a('[name="username"]',i).val()),a.trim(a('[name="password"]',i).val()))}};p.clearMsg=function(){j.html("").hide()};var r=function(){m.on("click",function(a){a.preventDefault();a.stopPropagation();q.submit()});n.each(function(){var b=a(this);d(b)});e.bind(i.find('[enter="true"]'),function(){q.submit()});f.loginMsg.add(function(a){j.html(g("fail",a.reason)).show();l=!1;m.html(h.msgLogin)});f.login.add(function(){l=!1;p.clearMsg();m.html(h.msgLogin);n.each(function(){a(this).val("")})});o.on("click",function(){f.hide.fire()})},s=function(){if(!i||i.length==0)return;k.verify=b(i);r()};s();return p}});
SVK.register("comp.user.brgLoginLayer",function(a){var b=a.common.channel.brgLoginChannel,c=a.ui.mutexLayer,d=a.comp.user.brgLoginVal;return function(e){var f=null,g={},h={node:null,mname:"head"},i=function(){g.showCallback.add(function(){f.clearMsg()});b.login.add(function(){g.hide()})},j=function(){a.extend(h,e||{});var b=h.node;if(!b)return;g=c(h);b.html(a.tpl.brgLoginLayer);f=d(e);i()};j();return g}});
SVK.register("comp.user.loginControl",function(a){var b=a.common.channel.brgLoginChannel,c=a.comp.user.brgLoginLayer,d=a('<div action-type="brgMask" style="display:none;position:absolute;left:0;top:0;width:640px;height:516px; background:rgb(0,0,0); opacity:.5;filter:Alpha(Opacity=50);"></div>');a(".playBox").prepend(d);var e=c({node:a("#brg_loginLayer"),msgNode:'[node-type="msg"]',msgLogining:'登录中<em class="loging"></em>',msgLogin:"登录",close:'[action-type="close"]'});e.showCallback.add(function(){d.show();b.showCallback.fire()});e.hideCallback.add(function(){d.hide();b.hideCallback.fire()});b.showLogin.add(function(){e.show()});b.hide.add(function(){e.hide()});b.toggle.add(function(){e.toggle()})});
(function(a){var b=a.common.userInfo.userLogin,c=a.common.channel.brgLoginChannel,d=a.common.channel.shijiao.player,e=a.common.channel.shijiao.playerPage;window.console=window.console||{};window.console.log=window.console.log||function(){};a.common.channel.widget.onVisibleReady.add(function(){window.timing&&timing.tick("visibleReady")});e.loadWidgetPlayer.add(function(){a.common.channel.player.firstView.fire();a.fireLoadEvent("firstView")});d.playStart.add(function(){a.fireLoadEvent("playStart")});window.getUserInfo=function(a){var d=b.getUser();if(d&&d.uid)return d.uid;a&&c.showLogin.fire();return""};a("#"+$FlashConfig.container).bind("click",function(a){a.stopPropagation()});a(document).ready(function(){if(window.timing)try{timing.tick("domReady")}catch(b){}a.common.widget.loader.startLoadWidget({widget:window.$widget,path:{js:$SCOPE.jsPath,css:$SCOPE.cssPath},version:{js:$SCOPE.jsVersion,css:$SCOPE.cssVersion}})})})(SVK);
SVK.register("pages.play.acVideo",function(a){function c(a){return b?b+a.charAt(0).toUpperCase()+a.substr(1):a}function d(){this.isLowIE=!document.addEventListener;if(this.isLowIE)return;this.playerEle=a("#myMovie");this.acVideo=a("#acVideo");this.flashBox=a("#myflashBox");this.dragPlay=document.getElementById("dragPlay");this.vd_playBox=this.flashBox.parent().parent();this.scrollerStyle=this.acVideo.get(0).style;this.tmpScrollerStyle=a.extend({},this.scrollerStyle);this.playSize={width:this.flashBox.width(),height:this.flashBox.height()};this.MIN_WIDTH=950;this.acPlayParam={width:300,height:169,intervalTop:5,intervalBottom:5,intervalLeft:5,intervalRight:5,left:0,right:0,bottom:a(window).height()-169-5-5,topAside:!1,bottomAside:!1};this._transform=c("transform");this.clientWidth=a(window).width();this.clientHeight=a(window).height();this.acVideoInitW=this.acPlayParam.width+this.acPlayParam.intervalLeft;this.acVideoInitH=this.acPlayParam.height+this.acPlayParam.intervalTop+this.acPlayParam.intervalBottom+this.acPlayParam.bottom;if(this.clientWidth<this.MIN_WIDTH){this.standardDistanceX=this.acVideoInitW-this.clientWidth;this.threshold={top:this.acVideoInitH-this.clientHeight,right:0,bottom:this.acPlayParam.bottom,left:this.acPlayParam.width+this.acPlayParam.intervalLeft-this.clientWidth};this.marginLeft=0}else{this.standardDistanceX=this.acVideoInitW-this.MIN_WIDTH;this.threshold={top:this.acVideoInitH-this.clientHeight,right:Math.floor((this.clientWidth-this.MIN_WIDTH)/2)-this.acPlayParam.intervalRight,bottom:this.acPlayParam.bottom,left:Math.round((this.clientWidth+this.MIN_WIDTH)/2-this.acPlayParam.width-this.acPlayParam.intervalLeft)};this.marginLeft=Math.round((this.clientWidth-this.MIN_WIDTH)/2)}this.x=0;this.y=0;this.pageX=0;this.pageY=0;this.display=!1;this.thresholdAC=700;this.memoryPos={thresholdLeft:this.threshold.left,top:0,left:0,clientWidth:this.clientWidth,offsetX:-this.standardDistanceX,offsetY:this.clientHeight-this.acVideoInitH};this.pressed=!1;this.resizing=!1;this._init()}var b=function(){var a=document.createElement("div").style,b=["t","webkitT","MozT","msT","OT"],c;for(var d in b){c=b[d]+"ransform";if(c in a)return b[d].substr(0,b[d].length-1)}}();d.prototype={_init:function(){this.vd_playBox.height(this.flashBox.height());this._initEvent()},_bindEvent:function(a,b,c,d){a.addEventListener(b,c,!!d)},_initEvent:function(){this._bindEvent(window,"scroll",this);this._bindEvent(window,"resize",this);this._bindEvent(this.dragPlay,"mousedown",this);this._bindEvent(window,"mousemove",this);this._bindEvent(window,"mouseup",this)},_resetPosition:function(){var b,c;this.clientWidth=a(window).width();this.clientHeight=a(window).height();if(this.clientWidth<this.MIN_WIDTH){this.acPlayParam.left=this.clientWidth-this.acVideoInitW-this.acPlayParam.intervalRight;this.acPlayParam.right=0;this.threshold.left=this.acVideoInitW+this.acPlayParam.intervalRight-this.clientWidth;this.threshold.right=0;b=this.acVideoInitW-this.clientWidth+this.memoryPos.offsetX+this.acPlayParam.intervalRight}else{this.acPlayParam.intervalLeft=parseInt(this.acVideo.css("padding-left"),10);this.acPlayParam.left=Math.round((this.clientWidth+this.MIN_WIDTH)/2-this.acPlayParam.width-this.acPlayParam.intervalLeft);this.acPlayParam.right="auto";this.threshold.left=-this.acPlayParam.left;this.threshold.right=Math.floor((this.clientWidth-this.MIN_WIDTH)/2)-this.acPlayParam.intervalRight;b=this.standardDistanceX+this.memoryPos.offsetX}c=this.acVideoInitH-this.clientHeight+this.memoryPos.offsetY;this.threshold.top=this.acVideoInitH-this.clientHeight;this.acVideo.css({left:this.acPlayParam.left,right:this.acPlayParam.right,bottom:this.acPlayParam.bottom,overflow:"hidden"});this.baseLeft=this.acPlayParam.left;this.baseBottom=this.acPlayParam.bottom;this.x=this._thresholdX(b);this.y=this._thresholdY(c);this._translate(this.x,this.y)},_scroll:function(b){this.pressed=!1;if(!this.display)return;if(a(document).scrollTop()>this.thresholdAC){if(!this.acVideo.hasClass("SM_acvideo")){this.acVideo.addClass("SM_acvideo");this._resetPosition();this.flashBox.css({width:this.acPlayParam.width,height:this.acPlayParam.height});this.playerEle.css({width:this.acPlayParam.width,height:this.acPlayParam.height});this.scrollerStyle[this._transform]=this.tmpScrollerStyle[this._transform];this.playerEle.get(0).hideAllController(!0)}}else if(this.acVideo.hasClass("SM_acvideo")){this.tmpScrollerStyle[this._transform]=this.scrollerStyle[this._transform];this.acVideo.removeClass("SM_acvideo");this.flashBox.css({width:this.playSize.width,height:this.playSize.height});this.playerEle.css({width:this.playSize.width,height:this.playSize.height});this.scrollerStyle[this._transform]="translate(0, 0)";this.playerEle.get(0).hideAllController(!1)}},_start:function(a){if(a.type==="mousedown"&&a.button!==0)return;a.preventDefault();this.pressed=!0;this.pageX=a.pageX;this.pageY=a.pageY},_move:function(a){if(!this.pressed)return;var b,c;this.deltaX=a.pageX-this.pageX;this.deltaY=a.pageY-this.pageY;this.pageX=a.pageX;this.pageY=a.pageY;b=this.x+this.deltaX;c=this.y+this.deltaY;b=this._thresholdX(b);c=this._thresholdY(c);this._translate(b,c)},_end:function(b){this.pressed=!1;this.clientWidth=a(window).width();this.clientHeight=a(window).height();this.memoryPos.offsetX=this.x-this.standardDistanceX;this.memoryPos.offsetY=this.y-(this.acVideoInitH-this.clientHeight)},_thresholdX:function(a){var b=a;(this.pressed||this.resizing)&&b<this.threshold.left?b=this.threshold.left:(this.pressed||this.resizing)&&b>this.threshold.right&&(b=this.threshold.right);return b},_thresholdY:function(a){var b=a;if((this.pressed||this.resizing)&&b<this.threshold.top){this.acPlayParam.topAside=!0;this.acPlayParam.bottomAside=!1;b=this.threshold.top}else if((this.pressed||this.resizing)&&b>this.threshold.bottom){this.acPlayParam.bottomAside=!0;this.acPlayParam.topAside=!1;b=this.threshold.bottom}else{this.acPlayParam.topAside=!1;this.acPlayParam.bottomAside=!1}return b},_resize:function(b){if(a(document).scrollTop()>this.thresholdAC){this.resizing=!0;this._resetPosition();this.memoryPos.clientWidth=this.clientWidth;this.resizing=!1}},_translate:function(a,b){this.scrollerStyle.left=this.baseLeft+a+"px";this.scrollerStyle.bottom=this.baseBottom-b+"px";this.x=a;this.y=b},handleEvent:function(a){switch(a.type){case"scroll":this._scroll(a);break;case"mousedown":this._start(a);break;case"mousemove":this._move(a);break;case"mouseup":this._end(a);break;case"resize":this._resize(a);break;default:}},setDisplay:function(a){this.display=!0;this._scroll()}};return new d});
SVK.register("pages.play_s",function(){var a=$.common.channel.shijiao.player,b=$.pages.play.acVideo;a.playComplete.add(function(){var a=window.$SINAPLAYEROBJ;a.player.playVideo(-1)});a.adComplete.add(function(a){b.setDisplay(a)});$(document).ready(function(){$("#pl_like").on("click",".red_like",function(){SUDA.uaTrack("video2","like")})})});SVK.register("comp.shijiao.config",function(a){return{interdomain:"http://video.sina.com.cn/shijiao",interdomain1:"http://s.video.sina.com.cn",pagedomain:"http://video.sina.com.cn/"}});
SVK.register("comp.shijiao.logSystem",function(a){(function(a){function e(c){var e={},c=c||{},f,g,h,i,j,k,l,m,n,o,p,q;g=c.url;n=c.baseArgs||"";j=c.dataType||"tick";h=c.data||[];i=a.type(c.defaultData)!="undefiend"?c.defaultData:-1;k=function(c){typeof c!="boolean"&&(c=!0);var d=b.data[j],e={};a.each(h,function(a,b){d.hasOwnProperty(b)?e[b]=d[b]:c&&(e[b]=-1)});return e};o=function(a){var b=new Image;b.onload=b.onerror=function(){return!0};b.src=g+"?"+encodeURIComponent(a);b=null};var r=function(b,c,d,e){var f=g;d&&(f=d);var h=new Image,i;typeof c!="boolean"&&(c=!0);c?i=a.extend(k(),b):i=b;h.onload=h.onerror=function(){return!0};typeof e!="string"&&(e="?");h.src=f+e+a.param(i);h=null};l=function(b){var c=navigator.userAgent.toLowerCase(),d=/msie/.test(c),e=/msie 6/.test(c),f=/gecko/.test(c)&&!/(compatible|webkit)/.test(c),g=!f&&"onbeforeunload"in window&&!d?"beforeunload":"unload";a(window).on(g,function(){try{b()}catch(c){}a(window).off(g,arguments.callee)})};m=function(a){var c=b.data[j];return c[a]!=i};e.getRequestData=k;e.evt=d[j];e.evt.unload=l;e.hasValue=m;e.request=o;e.keyrequest=r;return e}if(!window.timing)return;var b=window.timing,c={tick:b.tick,info:b.info},d={tick:a.Callbacks(),info:a.Callbacks()};a.each(["tick","info"],function(a,e){b[e]=function(a,b){e=="tick"&&(b=b||(new Date).getTime());c[e](a,b);d[e].fire({label:a,value:b})}});a.logSystem=e})(jQuery);return a.logSystem});
SVK.register("comp.shijiao.stat",function(a){var b=function(){return window.$SINAPlayer.player.init&&window.$SINAPlayer.player.type==1}(),c=$SCOPE.video,d=function(){var a="";try{if(navigator.plugins&&navigator.plugins["Shockwave Flash"]){var b=navigator.plugins["Shockwave Flash"];a=b.version||b.description}else if(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")){var c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");a=c.GetVariable("$version")}}catch(d){}return a}(),e=function(){var a=navigator.userAgent.toLowerCase(),b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(safari)[ \/]([\w.]+)/.exec(a)||/(firefox)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version)?[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||!/compatible/.test(a)&&/(mozilla)(?:.*? rv:([\w.]+))?/.exec(a)||[];if(b[1]&&b[1]==="msie"){var c=/(360se)/.exec(a)||/(maxthon)/.exec(a)||/(tencenttraveler)/.exec(a)||null;return c&&c[1]?c[1]:b[1]+(b[2]||"")}return b[1]||"unknown"}(),f=function(){var a=navigator.platform.toLowerCase();if(a.match(/win/)){var b=navigator.userAgent.split(";");if(b[2])switch(b[2]){case" Windows4.0":return"Win95";case" Windows 98":return"Win98";case" Windows NT 5.0":return"Win2000";case" Windows NT 5.1":return"WinXP";case" Windows NT 5.2":return"Win2003";case" Windows NT 6.0":return"WinVista";case" Windows NT 6.1":return"Win7"}}return a}(),g=["firstOpenTime","domReady","mainJSReady","startInitPlayFlash","playerInitComplete","pMainInitedTime","pSkinSt","pSkinEd","pIAskSt","pIAskEd","pNoticeJsTime","pJsPlayTime","pVideoSt","pVideoEd","pLoadStreamTime","pStreamReadyTime","pFirstBufferFull","pHasAd","pAdSt","pAdEd","pAdContentSt","pAdContentEd","pAdPlayStart","pAdPlayStop","pAdVaError","pAdError","pAdComplete","pPlayBegan"],h=!1,i={},j=SVK.comp.shijiao.logSystem({url:"http://log.ivideo.sina.com.cn/b.gif",data:g}),k=j.request,l=j;l.sendPPO=function(){if(!h&&b){h=!0;var g=j.getRequestData(),k={lid:1,app:"video",pid:c.pid,fot:g.firstOpenTime,drt:g.domReady,jrt:g.mainJSReady,sipt:g.startInitPlayFlash,br:e,dis:screen.width+"*"+screen.height,os:f,ts:(new Date).getTime()};window.$SCOPE&&$SCOPE.user&&$SCOPE.user.uid&&(k.uid=$SCOPE.user.uid);a.extend(k,i);k.fpv=k.fpv||d;j.keyrequest(k,!1);j.keyrequest(k,!1,"http://beacon.sina.com.cn/l.gif?video","&")}};l.setPPOArgs=function(a,b){i[a]=b};j.evt.unload(function(){l.sendPPO()});return l});
SVK.register("comp.player.playerCallFun",function(a){var b=a.common.channel.shijiao.player,c=window.$SINAPlayer.getPlayer,d=a.comp.shijiao.config,e=a.comp.shijiao.stat,f=a.common.userInfo.userLogin,g=!1;b.playStart.add(function(){e.sendPPO()});b.playComplete.add(function(){});b.flashInitCompleted.add(function(b,d){timing.tick("playInitComplete",d);var e=c.getPlayer(b),g=e.dom;if(window.$SINAPlayer.player.init&&window.$SINAPlayer.player.type==1&&a.common.channel.loginChannel){var h=a.common.channel.loginChannel;h.login.add(function(){var a=f.getUser();a&&a.uid&&g.setLogin(a.uid)})}});b.playOutside.add(function(b){if(g)return;var d=c.getPlayer(b),e=d.dom;if(!d)return;var f=$SCOPE.video,h={};h.pid=f.pid;h.video_id=f.video_id;h.title=f.title;h.url=f.url;h.swfOutsideUrl=f.swfOutsideUrl;var i="http://video.sina.com.cn/watch/outPlayerNew.php?";i+=a.core.json.jsonToQuery(h,!0);var j=e.offsetWidth,k=e.offsetHeight,l=parseInt((window.screen.availHeight-k)/2),m=parseInt((window.screen.availWidth-j)/2);window.open(i,"_blank","width="+j+",height="+k+",top="+l+",left="+m+",scrollbars=no,menubar=no,resizable=yes");d.obj.pause();g=!0;setTimeout(function(){g=!1},5e3)});b.recordValue.add(function(a,b,c){a&&b&&e.setPPOArgs(a,b)})});
SVK.register("module.setPosition",function(a){function d(b){return a(b).css("display")!="none"}function e(b){b=a.isArray(b)?b:[0,0];for(var c=0;c<2;c++)typeof b[c]!="number"&&(b[c]=0);return b}function f(c,e,f,g){if(!d(c))return;var h="",i,j,k,l,m=a(c).width(),n=a(c).height(),o={width:a(window).width(),height:a(window).height()},p=0,q=0;if(g&&b){h="fixed";i=l=f[1];j=k=f[0];switch(e){case"lt":l=k="";break;case"lb":i=k="";break;case"rt":j=l="";break;case"rb":i=j="";break;case"c":default:i=(o.height-n)/2+f[1];j=(o.width-m)/2+f[0];l=k=""}}else{h="absolute";p=i=a(document).scrollTop();q=j=a(document).scrollLeft();switch(e){case"lt":i+=f[1];j+=f[0];break;case"lb":i+=o.height-n-f[1];j+=f[0];break;case"rt":i+=f[1];j+=o.width-m-f[0];break;case"rb":i+=o.height-n-f[1];j+=o.width-m-f[0];break;case"c":default:i+=(o.height-n)/2+f[1];j+=(o.width-m)/2+f[0]}k=l=""}if(e=="c"){i<p&&(i=p);j<q&&(j=q)}a(c).css({position:h,top:i,left:j,right:k,bottom:l});return{position:h,top:i,left:j,right:k,bottom:l,width:m,height:n}}var b=!("undefined"==typeof document.body.style.maxHeight||document.compatMode!=="CSS1Compat"&&/msie/.test(navigator.userAgent.toLowerCase())),c=/^(c|lt|lb|rt|rb)$/;return function(d,g,h,i){var j={};j.callbacks=a.Callbacks();if(c.test(g)){function k(){if(i&&!b){var a=f(d,g,h,i);j.callbacks.fire({type:"setPosAfter",data:a})}}function l(){j.callbacks.fire("resizeBefore");if(g=="c"){var a=f(d,g,h,i);j.callbacks.fire({type:"setPosAfter",data:a})}}var m=function(){b||a(window).scroll(k);a(window).resize(l)};j.getNode=function(){return d};j.isFixed=function(){return i};j.setAlign=function(b){if(!b)return;a.extend({type:g,offset:h,fixed:i},b);if(c.test(b.type)){g=b.type;h=e(b.offset);i=b.fixed;typeof i!="boolean"&&(i=!0);var k=f(d,g,h,i);j.callbacks.fire({type:"setPosAfter",data:k})}};j.destroy=function(){b||a(window).off("scroll",k);j.callbacks.empty()};m();j.setAlign({type:g,offset:h,fixed:i})}return j}});
SVK.register("module.mask",function(a){var b=a.module.setPosition,c="STK-Mask-Key-body";return function(d){var e={box:document.body,color:"#000",opacity:.5,zIndex:9999},f={},g={};g.callbacks=a.Callbacks();var h=null,i=!1,j={setPos:null},k=function(){var a=['<iframe src="" style="display:block;z-index:0;border:0 none;',"opacity:0;filter:Alpha(Opacity=0);","width:100%;",'height:100%;">',"</iframe>"].join("");return a},l=function(){var b={top:0,left:0,width:0,height:0};if(f.box==document.body){b.width=a(window).width();b.height=a(window).height()}else{var c=a(f.box).position();b.width=a(f.box).width();b.height=a(f.box).height();b.top=c.top;b.left=c.left}return b},m=function(b,c){var c=c||l();a(b).css({position:"absolute",width:"100%",height:"100%",top:c.top,left:c.left})},n=function(){var b=a("<div>"),d=l();"undefined"==typeof document.body.style.maxHeight&&b.html(k());b.css({"background-color":f.color,opacity:f.opacity,zIndex:f.zIndex,display:"none"});a(document.body).append(b);h=b;i=!1;if(f.box==document.body){a(b).attr("id",c);o.resetMaskSize()}else m(h,d)},o={resetMaskSize:function(){var b=l();a(h).height("100%");a(h).width("100%")}},p=function(){if(f.box==document.body){if(a("#"+c).length){h=a("#"+c);return}n()}else n()},q=function(){if(j.setPos){j.setPos.destroy();delete j.setPos}},r=function(){f=a.extend(e,d||{});p()};r();g.show=function(){g.callbacks.fire("maskShowBefore");h.length||r();if(f.box==document.body&&!a("#"+c).length){q();p()}a(h).css({opacity:f.opacity,zIndex:f.zIndex,display:""});i=!0;if(f.box==document.body)if(j.setPos)j.setPos.setAlign({});else{j.setPos=b(h,"lt",[0,0],!0);j.setPos.callbacks.add(function(a){a=="resizeBefore"&&o.resetMaskSize()})}};g.hide=function(){g.callbacks.fire("maskHideBefore");a(h).css("display","none");i=!1};g.getMaskNode=function(){return h};g.destroy=function(){a(h).remove();h=null;g.callbacks.empty();q();i=!1};return g}});
SVK.register("comp.shijiao.pagePlayerFun",function(a){function l(a){if(i)return;h.light.hide();j(a).dom.setLight(1);k().hide();h.eplaybox.css("zIndex",1400);i=!0}function m(a){h.eplaybox.css("zIndex",1e4);k().show();h.light.show();j(a).dom.setLight(0);i=!1}var b=a.common.channel.shijiao.player,c=a.common.channel.shijiao.playerPage,d=window.$SINAPlayer.getPlayer,e=null,f=6e3,g=null,h={playbox:a(".vd_playBox"),playerbox:a("#"+$FlashConfig.container)};h.eplaybox=a(".playBox");h.light=a("[node-type='openLight']");var i=!0,j=function(a){var b=d.getPlayer(a);return b},k=function(){g||(g=a.module.mask({zIndex:1800,opacity:1}));return g};b.toWide.add(function(a){h.playbox.addClass("vd_fullPlayBox");var b=j(a).dom;b.width=950;b.toWide()});b.toNarrow.add(function(a){h.playbox.removeClass("vd_fullPlayBox");var b=j(a).dom;b.width=640;b.toNarrow()});b.setLight.add(function(a,b){a==0?m(b):a==1&&l(b)});var n=function(){c.loadWidgetPlayer.fire();n=a.noop};b.playStart.add(function(){n()});b.videoError.add(function(){n()});h.light.click(function(a){l($FlashConfig.id)});var o=window.$SINAPlayer.time.initPlayerStart||(new Date).getTime(),p=(new Date).getTime()-o;p>=f?setTimeout(function(){n()},0):e=setTimeout(function(){n()},f-p)});
SVK.register("comp.shijiao.resetPlayerCallJs",function(a){var b=a.common.channel.shijiao.player,c=window.$SINAPlayer.getPlayer,d=window.$SINAPlayer.cacheFuns,e=!1;d.forExec(function(a,c){a=="flashInitCompleted"&&(e=!0);setTimeout(function(){var d=b[a];d.fire.apply(d,c)},0)});d.clear();for(var f=0,g=window.$PlayerCallNameArr.length;f<g;f++)(function(){var a=window.$PlayerCallNameArr[f];$PlayerCallJs[a]=function(){if(arguments.length==0)throw new Error("播放器回调js方法必须传入播放器id");if(a=="flashInitCompleted"&&!e){window.$SINAPlayer.player.load=!0;e=!0;if(typeof $SCOPE=="object"&&typeof $SCOPE.video=="object"){var d=c.getPlayer(arguments[arguments.length-1]);d&&d.obj.playVideo($SCOPE.video)}}var f=Array.prototype.slice.call(arguments,0);f.push((new Date).getTime());setTimeout(function(){var c=b[a];c.fire.apply(c,f)},0)}})()});

SVK.register("common.extra.logSystem",function(a){(function(a){function e(c){var e={},c=c||{},f,g,h,i,j,k,l,m,n,o,p;g=c.url;h=c.data||[];j=c.dataType||"tick";i=a.type(c.defaultData)!="undefiend"?c.defaultData:-1;k=function(){var c=b.data[j],d={};a.each(h,function(a,b){d[b]=c.hasOwnProperty(b)?c[b]:-1});return d};n=function(b){var c=new Image,d;d=a.extend(k(),b);d._t=(new Date).getTime();c.onload=c.onerror=function(){return!0};c.src=g+"?"+a.param(d);c=null};l=function(b){var c=navigator.userAgent.toLowerCase(),d=/msie/.test(c),e=/msie 6/.test(c),f=/gecko/.test(c)&&!/(compatible|webkit)/.test(c),g=!f&&"onbeforeunload"in window&&!d?"beforeunload":"unload";a(window).on(g,function(){try{b()}catch(c){}a(window).off(g,arguments.callee)})};m=function(a){var c=b.data[j];return c[a]!=i};e.getRequestData=k;e.evt=d[j];e.evt.unload=l;e.hasValue=m;e.request=n;return e}if(!window.timing)return;var b=window.timing,c={tick:b.tick,info:b.info},d={tick:a.Callbacks(),info:a.Callbacks()};a.each(["tick","info"],function(a,e){b[e]=function(a,b){e=="tick"&&(b=b||(new Date).getTime());c[e](a,b);d[e].fire({label:a,value:b})}});a.logSystem=e})(jQuery);return a.logSystem});
SVK.register("pl.ad",function(a){function b(b){var c=b.box||a("#"+b.id);if(!c[0])return;if(b.html)c.html(b.html);else if(b.pdps){var d=document.createElement("ins");a(d).attr("data-ad-pdps",b.pdps).addClass("sinaads");c.append(d);try{(sinaads=window.sinaads||[]).push(b.args||{})}catch(e){}}}function c(){$adWidget&&a.map($adWidget,function(a){try{b(a)}catch(c){}})}c()});

