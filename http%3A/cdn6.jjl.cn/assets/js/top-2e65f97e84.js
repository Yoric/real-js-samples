var portname;$(function(){var e=document.getElementById("getloginUser_deng");e&&(e.addEventListener?e.addEventListener("click",loginUser,!1):e.attachEvent("onclick",loginUser,!1));var o=document.getElementById("getloginUser");o&&(o.addEventListener?o.addEventListener("click",getregisterUser,!1):o.attachEvent("onclick",getregisterUser,!1));var n,t,a=document.getElementById("param_code");a.addEventListener?a.addEventListener("click",showcode,!1):a.attachEvent("onclick",showcode,!1),(n=document.getElementById("sendcun")).addEventListener?n.addEventListener("click",sendphone,!1):n.attachEvent("onclick",sendphone,!1),(t=document.getElementById("loginuser")).addEventListener?t.addEventListener("click",login_user,!1):t.attachEvent("onclick",login_user,!1),$("#weibo").on("click",function(){var e=window.location.href,o=e.split("?");if(void 0!==o[1]){var n=o[1].substr(1).split("=");window.open(js_api_config.wwhost+"/sina_login?h="+n[1],"TencentLogin","width=450,height=320,menubar=0,scrollbars=1,resizable=1,status=1,titlebar=0,toolbar=0,location=1")}else window.open(js_api_config.wwhost+"/sina_login?h="+e,"TencentLogin","width=450,height=320,menubar=0,scrollbars=1,resizable=1,status=1,titlebar=0,toolbar=0,location=1")}),$("#qq").on("click",function(){var e=window.location.href,o=e.split("?");if(void 0!==o[1]){var n=o[1].substr(1).split("=");window.open(js_api_config.wwhost+"/qq_login?h="+n[1],"TencentLogin","width=695,height=475,menubar=0,scrollbars=1,resizable=1,status=1,titlebar=0,toolbar=0,location=1")}else window.open(js_api_config.wwhost+"/qq_login?h="+e,"TencentLogin","width=450,height=320,menubar=0,scrollbars=1,resizable=1,status=1,titlebar=0,toolbar=0,location=1")}),(n=document.getElementById("sendcun_reg")).addEventListener?n.addEventListener("click",sendphone_reg,!1):n.attachEvent("onclick",sendphone_reg,!1),(t=document.getElementById("loginuser_reg")).addEventListener?t.addEventListener("click",login_user_reg,!1):t.attachEvent("onclick",login_user_reg,!1),$("#weibo_reg").on("click",function(){var e=window.location.href,o=e.split("?");if(void 0!==o[1]){var n=o[1].substr(1).split("=");window.open(js_api_config.wwhost+"/sina_login?h="+n[1],"TencentLogin","width=450,height=320,menubar=0,scrollbars=1,resizable=1,status=1,titlebar=0,toolbar=0,location=1")}else window.open(js_api_config.wwhost+"/sina_login?h="+e,"TencentLogin","width=450,height=320,menubar=0,scrollbars=1,resizable=1,status=1,titlebar=0,toolbar=0,location=1")}),$("#qq_reg").on("click",function(){var e=window.location.href,o=e.split("?");if(void 0!==o[1]){var n=o[1].substr(1).split("=");window.open(js_api_config.wwhost+"/qq_login?h="+n[1],"TencentLogin","width=695,height=475,menubar=0,scrollbars=1,resizable=1,status=1,titlebar=0,toolbar=0,location=1")}else window.open(js_api_config.wwhost+"/qq_login?h="+e,"TencentLogin","width=450,height=320,menubar=0,scrollbars=1,resizable=1,status=1,titlebar=0,toolbar=0,location=1")})});var layeropen,hostname=window.location.hostname;function showcode(){$.ajax({url:"/param_code?time="+(new Date).getTime(),type:"get",success:function(e){$("#param_code")[0].innerHTML=e},error:function(e,o,n){console.log("获取失败，请重试！CODE:"+e.status)}})}function getlogin(){$.ajax({url:"/param_code",type:"get",success:function(e){$("#param_code").html(e)},error:function(e,o,n){console.log("获取失败，请重试！CODE:"+e.status)}}),layeropen=layer.open({type:1,shade:[.4,"#000"],shadeClose:!0,closeBtn:!1,area:["421px","500px"],title:!1,border:[0],bgcolor:"#fff",scrollbar:!1,content:$("#l_u"),success:function(){},cancel:function(){$("#login_e_phone").css("display","none")},end:function(){$("#login_e_phone").css("display","none")}})}function getregister(){$.ajax({url:"/param_code",type:"get",success:function(e){$("#param_code").html(e)},error:function(e,o,n){console.log("获取失败，请重试！CODE:"+e.status)}}),layeropen=layer.open({type:1,shade:[.4,"#000"],shadeClose:!0,closeBtn:!1,area:["421px","487px"],title:!1,border:[0],bgcolor:"#fff",scrollbar:!1,content:$("#r_u"),success:function(){},cancel:function(){$("#login_e_phone").css("display","none")},end:function(){$("#login_e_phone").css("display","none")}})}function getregisterUser(){var e=window.location.href;console.log("h",e);var o=e.split("/");console.log("hh[1]",o[3]);var n=e.split("?");console.log("hhh",n[1]),"register"!=o[3]&&"forget"!=o[3]&&"login"!=o[3]&&"loginUser"!=o[3]&&"login?h=http:"!=o[3]&&"loginUser?h=http:"!=o[3]&&"register?h=http:"!=o[3]?(console.log("11111"),window.open(fn.urlgen("register")+"?h="+e)):null!=n[1]&&"register"!=o[3]&&"forget"!=o[3]&&"login"!=o[3]&&"loginUser"!=o[3]?(console.log("aaaa"),window.location.reload()):null==n[1]&&"loginUser"==o[3]?(console.log("22222"),window.location.reload()):null==n[1]&&"forget"==o[3]?(console.log("forget"),window.open(fn.urlgen("login"))):null!=n[1]&&"register"==o[3]&&(console.log("rrrrrr"),window.open(fn.urlgen("loginUser")))}function loginUser(){var e=window.location.href;console.log("h",e);var o=e.split("/");console.log("hh[1]",o[3]);var n=e.split("?");console.log("hhh",n[1]),"register"!=o[3]&&"forget"!=o[3]&&"login"!=o[3]&&"loginUser"!=o[3]&&"login?h=http:"!=o[3]&&"loginUser?h=http:"!=o[3]?(console.log("11111"),window.open(fn.urlgen("loginUser")+"?h="+e)):null!=n[1]&&"register"!=o[3]&&"forget"!=o[3]&&"login"!=o[3]&&"loginUser"!=o[3]?(console.log("aaaa"),window.location.reload()):null==n[1]&&"loginUser"==o[3]?(console.log("22222"),window.location.reload()):null==n[1]&&"forget"==o[3]?window.open(fn.urlgen("login")):null!=n[1]&&"register?h=http:"==o[3]&&(console.log("rrrrrr"),window.open(fn.urlgen("loginUser")))}function sendphone(){if(""!==$("#phone").val()){if(!/^1\d{10}$/.test($("#phone").val()))return $("#login_e_phone").css("display","block"),void $("#login_error_text").html("请输入正确手机号码");$("#login_e_phone").css("display","none"),""!=$("#tupian").val()?/^[a-zA-Z0-9]{4}$/.test($("#tupian").val())?$.ajax({url:"/sendcode_s",type:"post",data:{param_code:$("#tupian").val().toLowerCase(),phone:$("#phone").val()},dataType:"json",withCredentials:!0,success:function(e){if(0===e.code){layer.msg("短信发送成功，请查阅手机");var o=60,n=setInterval(function(){if(0===o)return $("#sendcun").attr("value","发送验证码"),$("#sendcun").removeAttr("disabled"),void clearInterval(n);$("#sendcun").attr("disabled","disabled"),$("#sendcun").attr("value",o+"s"),o--},1e3)}else"1"==e?layer.msg("图片验证码输入错误"):"1150013"===e.code?layer.msg(e.message):layer.msg("数据错误")},error:function(e,o,n){console.log("获取失败，请重试！CODE:"+e.status),layer.msg("获取失败，请重试！CODE:"+e.status)}}):layer.msg("请输入4位图片验证码"):layer.msg("请输入图片验证码")}else $("#login_e_phone").css("display","block")}function login_user(){if(""!==$("#phone").val()){if(!/^1\d{10}$/.test($("#phone").val()))return $("#login_e_phone").css("display","block"),void $("#login_error_text").html("请输入正确手机号码");$("#login_e_phone").css("display","none"),""!==$("#verify").val()?$("#guwen input[type='checkbox']").is(":checked")?$.ajax({url:portname+"/login_user",type:"POST",dataType:"json",data:{phone:$("#phone").val(),code:$("#verify").val()},success:function(e){0==e.code?(layer.msg("登录成功"),layer.close(layeropen),window.location.reload()):layer.msg(e.message)}}):layer.msg("请同意注册协议"):layer.msg("请输入手机验证码")}else $("#login_e_phone").css("display","block")}function outlogin(){var e=JSON.parse(cookie("login_ss")),o=window.location.href,n=o.split("/");o.split("?");$.ajax({url:portname+"/login_out",type:"GET",dataType:"jsonp",jsonpCallback:"cb",success:function(o){"0"==o&&("forget"==n[3]&&"login"==n[3]&&"loginUser"==n[3]||null==n[3]||""==n[3]||""==n[4]||null==n[4]||"article"==n[4]||"case"==n[4]||"album"==n[4]||"hot"==n[4]?window.location.reload():1==e.usertype?window.location.href="/loginUser":window.location.href="/login")},error:function(e,o,n){console.log("获取失败，请重试！CODE:"+e.status)}})}function sendphone_reg(){if(""===$("#phone_reg").val())return $("#phone_reg").parent().addClass("has-error").removeClass("has-success"),void $("#phone_reg").data("toogle","left").data("placement","right").data("container","body").data("content","请输入手机号码").popover({trigger:"manual"}).popover("show");if(!/^1\d{10}$/.test($("#phone_reg").val()))return $("#phone_reg").parent().addClass("has-error").removeClass("has-success"),void $("#phone_reg").data("toogle","left").data("placement","right").data("container","body").data("content","请输入正确手机号码").popover({trigger:"manual"}).popover("show");$.ajax({url:"/sendcode_s",type:"GET",data:{phone:$("#phone_reg").val()},dataType:"json",withCredentials:!0,success:function(e){0===e.code?layer.msg("短信发送成功，请查阅手机"):layer.msg("数据错误")},error:function(e,o,n){console.log("获取失败，请重试！CODE:"+e.status),layer.msg("获取失败，请重试！CODE:"+e.status)}});var e=60,o=setInterval(function(){if(0===e)return $("#sendcun_reg").attr("value","发送验证码"),$("#sendcun_reg").removeAttr("disabled"),void clearInterval(o);$("#sendcun_reg").attr("disabled","disabled"),$("#sendcun_reg").attr("value",e+"s"),e--},1e3)}function login_user_reg(){return""===$("#phone_reg").val()?($("#phone_reg").parent().addClass("has-error").removeClass("has-success"),void $("#phone_reg").data("toogle","left").data("placement","right").data("container","body").data("content","请输入手机号码").popover({trigger:"manual"}).popover("show")):/^1\d{10}$/.test($("#phone_reg").val())?void(""!==$("#verify_reg").val()?$("#guwen_reg input[type='checkbox']").is(":checked")?$.ajax({url:"/login_user",type:"POST",dataType:"json",withCredentials:!0,data:{phone:$("#phone_reg").val(),code:$("#verify_reg").val()},success:function(e){0==e.code?(layer.msg("登录成功"),layer.close(layeropen),window.location.reload()):layer.msg(e.message)}}):layer.msg("请同意注册协议"):layer.msg("请输入手机验证码")):($("#phone_reg").parent().addClass("has-error").removeClass("has-success"),void $("#phone_reg").data("toogle","left").data("placement","right").data("container","body").data("content","请输入正确手机号码").popover({trigger:"manual"}).popover("show"))}portname="http://"+window.location.hostname,"www.jjl.cn"==hostname?"development"==js_api_config.version&&(portname+=":4000"):"yimin.jjl.cn"==hostname&&"development"==js_api_config.version&&(portname+=":4600");