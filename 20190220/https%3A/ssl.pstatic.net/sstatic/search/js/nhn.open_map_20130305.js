/* release date : 2013-02-25 */
var oTotalSearch=oTotalSearch||{};oTotalSearch.oBCKOpenMap=oTotalSearch.oBCKOpenMap||null;(function(){if(oTotalSearch.oBCKOpenMap==null){oTotalSearch.oBCKOpenMap={init:function(){this._oConfigArea={};this._oLayer={elIframe:null,elLayer:null,width:0,height:0};this._isInit=false;this._elBtn=null;this._id="";this._bResizeContent=false;this._elContent=$("content");this._isOpen=false;this.addArea=$Fn(this._addArea,this).bind();$Fn(this._setElement,this).attach(window,"load");var a=$Agent().os();$Fn(this._hideLayerOnDocumentClick,this).attach(document,((a.iphone||a.ipad)?"touchstart":"click"));this.getValue=$Fn(this._getValueFromClassName,this).bind();this._oFnBase={closeMap:function(d){var c="closeMap";var e=this._id;var b=this._getArguments(d);this._hideLayer();if(typeof this._oConfigArea[e].oFnCallBack[c]!="undefined"){this._oConfigArea[e].oFnCallBack[c].apply(this,b);}},clickTitle:function(d){var c="clickTitle";var e=this._id;var b=this._getArguments(d);if(typeof this._oConfigArea[e].oFnCallBack[c]!="undefined"){this._oConfigArea[e].oFnCallBack[c].apply(this,b);}},clickAddr:function(d){var c="clickAddr";var e=this._id;var b=this._getArguments(d);if(typeof this._oConfigArea[e].oFnCallBack[c]!="undefined"){this._oConfigArea[e].oFnCallBack[c].apply(this,b);}},viewLarge:function(d){var c="viewLarge";var e=this._id;var b=this._getArguments(d);if(typeof this._oConfigArea[e].oFnCallBack[c]!="undefined"){this._oConfigArea[e].oFnCallBack[c].apply(this,b);}},searchRoute:function(d){var c="searchRoute";var e=this._id;var b=this._getArguments(d);if(typeof this._oConfigArea[e].oFnCallBack[c]!="undefined"){this._oConfigArea[e].oFnCallBack[c].apply(this,b);}}};this._oFnClickButton={clickBtnOpen:function(){var c=this._id;var b=this._getArguments();if(typeof this._oConfigArea[c].oFnOpenClose!="undefined"){this._oConfigArea[c].oFnOpenClose.clickBtnOpen.apply(this,b);}},clickBtnClose:function(){var c=this._id;var b=this._getArguments();if(typeof this._oConfigArea[c].oFnOpenClose!="undefined"){this._oConfigArea[c].oFnOpenClose.clickBtnClose.apply(this,b);}}};},_getArguments:function(f){var b=$Element(this._elBtn).className();var d=[];var a=this._getValueFromClassName("_cr",b);var e=this._getValueFromClassName("_mapId",b);var c="";if(f!=null&&typeof f.href!="undefined"){c=f.href;}d[0]=e;d[1]=a;d[2]=c;d[3]=b;return d;},_addArea:function(g,f){var e=false;var c=f.base;for(var a in this._oConfigArea){if(c==this._oConfigArea[a]["base"]){e=true;}}if(!e){var d=$Agent().os();this._oConfigArea[g]=f;var b=this;this["_"+g+"_clickMapView"]=$Fn(function(h){var k=new Function("return '"+g+"'");var j=h.element;var i=this._oConfigArea[g]["base"];if(!((j===i)||$Element(j).isChildOf($Element(i)))){return;}if(this._isInit==true){if($Element(j).hasClass("_bck_open_map")){if($Element(j).hasClass("map_opn")){this._hideLayer();this._elBtn=j;this._id=k();this._oFnClickButton.clickBtnOpen.apply(this,[]);this._clickMapView(k(),h);}else{this._oFnClickButton.clickBtnClose.apply(this,[]);this._hideLayer();}}}},this).attach(c,((d.iphone||d.ipad)?"touchstart":"click"));this._attachEventHalder(g);}},_attachEventHalder:function(c){var a=this._oConfigArea[c].prefix;for(var b in this._oConfigArea[c].oFnCallBack){window[a+b]=$Fn(this._oFnBase[b],this).bind();}},_clickMapView:function(){this._moveLayer();this._showLayer();this._resizeContent();this._moveLayer();this._moveScroll();},_getValueFromClassName:function(a,b){RegExp("(^|\\s+)"+a+"[-](\\S+)").test(b);return RegExp.$2;},_setElement:function(){if(this._isInit==false){this._oLayer.elLayer=$("bck_layer_map");this._oLayer.elIframe=$$.getSingle("iframe",this._oLayer.elLayer);$Element(this._oLayer.elLayer).show();this._oLayer.width=$Element(this._oLayer.elIframe).width();this._oLayer.height=$Element(this._oLayer.elIframe).height();$Element(this._oLayer.elLayer).hide();this._isInit=true;}},_moveLayer:function(){var f=this._elBtn;var g=$Element(f);var h=$Element(this._oLayer.elLayer);var c=$Element(this._elContent);var b=this._oLayer.width;var a=160;var e=g.offset().left+g.width()-b;e=(e>a)?e:a;h.css("left",e+"px");var d=g.offset().top+g.height()+2;h.css("top",d+"px");},_resizeContent:function(){var d=$Element(this._elContent);var c=this._oLayer.height+$Element(this._oLayer.elLayer).offset().top-d.offset().top;var b=d.height();if(c>b){var a=c;var e=this._oConfigArea[this._id];this._bResizeContent=true;if(e.type=="nexearch"){a=a+20;}d.css("height",a+"px");}},_moveScroll:function(){var c=this._elBtn;var d=$Element(c);var a=this._oLayer.height+d.offset().top+25;var e=document.documentElement.clientHeight+Math.max(document.documentElement.scrollTop,document.body.scrollTop);if(a>e){var b=document.documentElement.scrollTop;document.documentElement.scrollTop=1;if(document.documentElement.scrollTop==1){document.documentElement.scrollTop=b+a-e+20;}else{document.body.scrollTop=document.body.scrollTop+a-e+20;}}},_getUrl:function(){var a=this._elBtn;var e=$Element(a).className();var h=this._getValueFromClassName("_mapid",e);var f=this._getValueFromClassName("_postId",e);var g=this._oConfigArea[this._id];var i=[];var c="";var d=g.url||"http://mashup.map.naver.com/view";var b=(g.oOpenUrl)?g.oOpenUrl[f]:"";i.push("prefix="+g.prefix);i.push("type="+g.type);i.push("mid="+h);i.push("openurl="+escape(b));c=i.join("&");d=d+"?"+c;return d;},_showLayer:function(){var d=this._getUrl();var c='<iframe src="" id="mapLayerFrame" name="map" style="display:none" frameborder="0" width="440" height="373" marginwidth="0" marginheight="0" scrolling="no" title="약도보기"></iframe>';var b=$$.getSingle("> div",this._oLayer.elLayer);b.innerHTML=c;this._oLayer.elIframe=$$.getSingle("iframe",this._oLayer.elLayer);this._oLayer.elIframe.src=d;var e=this._oLayer.elIframe;var a=this;$Element(e).show();$Fn(function(){var g=$$.getSingle("#mapLayerFrame");var h=g.contentDocument||g.contentWindow.document;var f=$$.getSingle("h1 a",h);f.focus();},this).attach(e,"load");$Element(this._oLayer.elLayer).show();$Element(this._elBtn).removeClass("map_opn");$Element(this._elBtn).addClass("map_clse");this._isOpen=true;},_hideLayerOnDocumentClick:function(a){if(!this._isCurrentBtn(a.element)&&this._elBtn!=null){this._hideLayer();}},_isCurrentBtn:function(a){return(this._elBtn==a);},_hideLayer:function(){if(this._isOpen){$Element(this._elBtn).removeClass("map_clse");$Element(this._elBtn).addClass("map_opn");this._elBtn.focus();this._elBtn=null;this._id=null;$Element(this._oLayer.elLayer).hide();this._isOpen=false;if(this._bResizeContent==true){this._bResizeContent=false;$Element(this._elContent).css("height","");}}}};oTotalSearch.oBCKOpenMap.init();}})();