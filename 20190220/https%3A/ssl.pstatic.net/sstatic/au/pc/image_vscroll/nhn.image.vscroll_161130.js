nhn=window.nhn||{},nhn.image=nhn.image||{},nhn.image.vscroll=nhn.image.vscroll||{},nhn.image.vscroll.Controller=$Class({$init:function(t){this._htOption=t,this._assignVars(),this._htOption.bPaging===!0&&(this._assignElement(),this._attachEvent()),this._initList()},_assignVars:function(){this._oList=null,this._nWindowWidth=document.documentElement.clientWidth,this._nResizeThread=0,this._nScrollTop=0},_assignElement:function(){this._elRoot=this._htOption.elRoot,this._elNextMore=$$(this._htOption.sNextMoreClass,this._elRoot)[0],this._elNextMoreBtn=$$("a",this._elNextMore)[0]},_attachEvent:function(){$Fn(this._onClickNextMore,this).attach(this._elNextMoreBtn,"click"),$Fn(this._onScroll,this).attach(window,"scroll"),$Fn(this._onResize,this).attach(window,"resize")},_initList:function(){this._oList=new nhn.image.vscroll.List(this._htOption),this._oList.firstDraw()},_onClickNextMore:function(t){t.stopDefault(),this._oList.resetPageRequestCount(),this._oList.drawNext()},_onScroll:function(t){var i=document.documentElement.scrollHeight,e=window.scrollY?window.scrollY:document.documentElement.scrollTop,s=document.documentElement.clientHeight,n=Math.floor((e+s)/i*100),h="undefined"==typeof this._htOption.nReqScrollTopPer?50:this._htOption.nReqScrollTopPer;n>h&&this._oList.drawNext()},_onResize:function(t){this._nResizeThread&&window.clearTimeout(this._nResizeThread),this._nResizeThread=setTimeout($Fn(function(){var t=document.documentElement.clientWidth;this._nWindowWidth!==t&&(this._nWindowWidth=t,this._nScrollTop=window.scrollY?window.scrollY:document.documentElement.scrollTop,this._oList.resetPageRequestCount(),this._oList.refresh(),window.scrollTo(0,this._nScrollTop))},this).bind(),200)}}),nhn.image.vscroll.List=$Class({$init:function(t){this._htOption=t,this._assign(),this._assignElement()},_assign:function(){this._bIsDrawing=!1,this._bHasPrev=!0,this._bHasNext=!0,this._aData=[],this._aHiddenData=[],this._sPageTemplate=this._htOption.sPageTemplate,this._nLastStart=this._htOption.nFirstStart,this._nPageSize=1*this._htOption.htApiOption.viewcount,this._nPageLimit=1*this._htOption.nMaxPageLimit,this._nPageRequest=0,this._fDrawCallback=null,this._nMaxLimit=4e3,this._nTotal=0},_assignElement:function(){this._elRoot=this._htOption.elRoot,this._elPhotoArea=$$(this._htOption.sPhotoWallAreaClass,this._elRoot)[0],this._elNextMore=$$(this._htOption.sNextMoreClass,this._elRoot)[0],this._elLoading=$$(this._htOption.sLoadingClass,this._elRoot)[0],this._elNoMore=$$(this._htOption.sNoMoreClass,this._elRoot)[0]},firstDraw:function(){var t=this._htOption.htFirstLodingData;this._drawStart(),this._drawCallback(!0,t.result),this._htOption.bPaging===!0&&document.documentElement.clientWidth>this._htOption.htClientSizeForAutoNext.nWidth&&document.documentElement.clientHeight>this._htOption.htClientSizeForAutoNext.nHeight&&(this._bIsDrawing=!1,this.drawNext())},refresh:function(){this._redraw()},drawNext:function(){this._bHasNext&&this._nPageRequest!==this._nPageLimit&&this._draw(!0)},resetPageRequestCount:function(){this._nPageRequest=0},_isDrawing:function(){return this._bIsDrawing},_drawStart:function(){this._bIsDrawing=!0,this._nPageRequest++},_drawEnd:function(){this._htOption.bPaging===!0&&($Element(this._elLoading).addClass("off"),this._bHasNext?this._nPageRequest===this._nPageLimit&&($Element(this._elLoading).hide(),$Element(this._elNextMore).show()):($Element(this._elLoading).hide(),$Element(this._elNextMore).hide(),this._showNoMoreNotice()));var t=this;setTimeout(function(){t._bIsDrawing=!1,null!==t._fDrawCallback&&(t._fDrawCallback(),t._fDrawCallback=null)},500)},_showNoMoreNotice:function(){var t=this._getNextStartIndex();this._nTotal<this._nMaxLimit||t<this._nMaxLimit-1?$Element(this._elNoMore).hide():$Element(this._elNoMore).show()},_getNextStartIndex:function(){return this._nLastStart+this._nPageSize},_redraw:function(){this._isDrawing()||(window.scrollTo(0,$Element(this._elRoot).offset().top),this._aHiddenData=[],this._elPhotoArea.innerHTML="",this._drawStart(),this._addPhotoWall(this._aData,!0),this._drawEnd())},_draw:function(t){if(!this._isDrawing()){this._drawStart();var i=1;t&&(i=this._getNextStartIndex(),this._requestAjax($Fn(this._drawCallback,this).bind(t),i),this._nLastStart=i,this._nPageRequest>1&&this._nPageRequest<this._nPageLimit+1&&this._htOption.htClickLog&&this._htOption.htClickLog.onAutoScroll({start:i}))}},_drawCallback:function(t,i){this._nTotal=1*i.total;var e=i.items.item,s=this._remapData(e);this._addPhotoWall(s,t),t&&(this._aData=this._aData.concat(s),this._bHasNext=s.length<this._nPageSize?!1:!0),this._drawEnd()},_remapData:function(t){for(var i=[],e=0,s=t.length;s>e;e++){var n=t[e].sImgSize.split("X"),h=t[e].sThumbSize.split("X"),a=this._getViewerLink(t[e]);i.push({width:n[0],height:n[1],thumb_width:h[0],thumb_height:h[1],src:t[e].sThumb,link:a.href,click:a.click,title:$S(t[e].sTitle).stripTags(),full_title:t[e].fullTitle,section_name:t[e].section_name,PCLink:t[e].PCLink,stt_data:t[e].stt_data})}return i},_addPhotoWall:function(t,i){var e=$S(this._sPageTemplate).trim().toString(),s=$(e),n=$Element(this._elPhotoArea),h=null;i?(n.append(s),h=this._aHiddenData.concat(t)):(n.prepend(s),h=[].concat(t));var a=new PW.PhotoWall(s);a.initialize(h,this._htOption.htThumbnailInfo,this._nPageSize),a.redraw(),this._aHiddenData=[].concat(a.getHiddenData())},_getViewerLink:function(t){var i=t.rank,e=t.gdid,s=t.signature,n=t.img_id,h=this._htOption.htApiOption.viewurl,a=this._htOption.sCrAreaPrefix,o=t.crArea,r=[];r.push(h),r.push("#imgId="+decodeURIComponent(n));var _=[];return _.push("r="+i),_.push("&i="+e),_.push("&g="+s),_.push("&a="+a+"*"+o),{href:r.join(""),click:_.join("")}},_requestAjax:function(t,i){var e=this._htOption.htApiOption.api,s=this._htOption.htApiOption.apiparams;s.display=this._nPageSize,s.start=i,$Ajax(e,{type:"jsonp",callbackid:"imageenlarge1234",onerror:function(){},onload:function(i){var e=i.json(),s=e.result;t(s)}}).request(this._apiRequestDecode(s))},_apiRequestDecode:function(t){var i=$H();return $H(t).forEach(function(t,e,s){i.add(e,decodeURIComponent(t))}),i._table}}),function(){PW=window.PW={},PW.PhotoWall=$Class({name:"PW.PhotoWall",_LIST_CLASS_NAME:"_photowall",_LIST_MARGIN:0,_LIST_MIN_WIDTH:300,_SCROLLBAR_WIDTH:0,$init:function(t){this._welWrapper=$Element(t),this._welList,this._wList=0,this._aDatas=null,this._bIsLastPage=!1,this._oFormatter=new PW.PhotoWallFormatter,this._timer=null,this._aHiddenData=[]},initialize:function(t,i,e){this._aDatas=t||[],this._welList=this._findListElement(),this._htThumbnailInfo=i,this._bIsLastPage=t.length<e?!0:!1,this._LIST_MARGIN=i.nListMargin+i.nMargin},_findListElement:function(){var t=this._welWrapper.query("."+this._LIST_CLASS_NAME);return $Element(t)},_draw:function(){if(this._aDatas){this._initListWidth();var t=this._makePhotoWallData(),i=this._oFormatter.getHtml(this._wList,t);this._welList.html(i)}},_initListWidth:function(){var t=Math.max(this._welList.width(),this._LIST_MIN_WIDTH),i=t-this._LIST_MARGIN;this._wList=i},_makePhotoWallData:function(){for(var t=[],i=[],e=0,s=new PW.PhotoWallRow(this._wList),n=this._aDatas.length,h=this._htThumbnailInfo.nMaxRowLimit?this._htThumbnailInfo.nMaxRowLimit:0,a=0;n>a;){var o=new PW.PhotoWallImageData(this._aDatas[a],this._htThumbnailInfo),r=s.addImageData(o),_=r&&a===n-1,l=h===e+1?!0:!1;if(s.isFull()&&l&&(_=!0),!s.isFull()&&_){for(var c=s.getRowData(),g=0,m=c.length;m>g;g++)i.push(c[g].getData());s.setRowWidthToCurrentSum()}if((s.isFull()||_)&&(s.adjustSizeOfRowDatas(),s.isFull()?t=t.concat(s.getRowData()):(h>0&&(this._bIsLastPage=!0),this._bIsLastPage&&_&&(0===this._htThumbnailInfo.nMaxRowLimit||e<this._htThumbnailInfo.nMaxRowLimit)&&(t=t.concat(s.getRowData()))),s.reset(),e++),r&&a++,e>0&&e===h)break}return this._aHiddenData=[].concat(i),t},getHiddenData:function(){return this._aHiddenData},redraw:function(){this._welList&&this._redrawAndSelectItems()},_redrawAndSelectItems:function(){this._welList.empty(),this._draw()},reset:function(){this._aDatas=null}})}(),function(){PW.PhotoWallRow=$Class({$init:function(t){this._wRow=t,this._wFrameSum=0,this._wMarginSum=0,this._aRowData=[],this._bIsFull=!1},addImageData:function(t){return this._isRowOverflowing(t)&&(this._bIsFull=!0,this._isNotPossibleToAdd(t))?!1:(this._wFrameSum+=t.getFrameWidth(),this._wMarginSum+=t.getBothSidesMargin(),this._aRowData.push(t),!0)},_isRowOverflowing:function(t){return this._getOverflowingValue(t)>0},_getOverflowingValue:function(t){var i=this._getCurrentSum()+t.getFrameWidth()+t.getBothSidesMargin();return i-this._wRow},_getCurrentSum:function(){return this._wFrameSum+this._wMarginSum},_isNotPossibleToAdd:function(t){var i=t.getBaseFrameWidth()/4,e=this._getOverflowingValue(t);return e>i},isFull:function(){return this._bIsFull},adjustSizeOfRowDatas:function(){this._getCurrentSum()>this._wRow?this._compressDatas():this._stretchDatas()},_compressDatas:function(){this._adjustEachImageData($Fn(function(t){var i=this._getFrameAreaRatio();return{wFrame:t.getFrameWidth()*i,hFrame:t.getFrameHeight(),wImage:t.getImageWidth(),hImage:t.getImageHeight()}},this).bind())},_stretchDatas:function(){this._adjustEachImageData($Fn(function(t){var i=this._getFrameAreaRatio();return{wFrame:t.getFrameWidth()*i,hFrame:t.getFrameHeight()*i,wImage:t.getImageWidth()*i,hImage:t.getImageHeight()*i}},this).bind())},_adjustEachImageData:function(t){var i=0;this._eachRowData(function(e){var s=t(e),n=Math.floor(s.wFrame);Math.floor(s.hFrame);i+=s.wFrame-n,i>=.99&&(n+=1,i-=1),e.setFrameWidth(n),e.setImageWidth(s.wImage),e.setImageHeight(s.hImage)})},_getFrameAreaRatio:function(){return(this._wRow-this.getMarginSum())/this.getFrameSum()},_eachRowData:function(t){for(var i=0,e=this._aRowData.length;e>i;i++)t(this._aRowData[i])},getFrameSum:function(){return this._wFrameSum},getMarginSum:function(){return this._wMarginSum},getRowData:function(){return this._aRowData},setRowWidthToCurrentSum:function(){this._wRow=this._getCurrentSum()},reset:function(){this._wFrameSum=0,this._wMarginSum=0,this._aRowData=[],this._bIsFull=!1}})}(),function(){PW.PhotoWallImageData=$Class({$init:function(t,i){this._oData=t,this._htThumbnailInfo=i,this._wOrigin=this._oData.width,this._hOrigin=this._oData.height,Math.abs((this._wOrigin/this._hOrigin).toFixed(1)-(this._oData.thumb_width/this._oData.thumb_height).toFixed(1)).toFixed(1)>.1&&(this._wOrigin=this._oData.thumb_width,this._hOrigin=this._oData.thumb_height),this._wImage=this._wOrigin,this._hImage=this._hOrigin,this._wFrame=this.getBaseFrameWidth(),this._hFrame=this.getBaseFrameHeight(),this._adjustSize()},_adjustSize:function(){this.isSmallerThanBaseSize()?this._adjustFrameToSquare():this._adjustSizeToBaseFrameHeight()},isSmallerThanBaseSize:function(){return this._wOrigin<=this.getBaseFrameWidth()&&this._hOrigin<=this.getBaseFrameHeight()},_adjustFrameToSquare:function(){this._isWidthShortenThanBaseFrameHeight()?this._wFrame=this.getBaseFrameHeight():this._wFrame=Math.floor(this._wImage)},_isWidthShortenThanBaseFrameHeight:function(){return this._wOrigin<this.getBaseFrameHeight()},_adjustSizeToBaseFrameHeight:function(){this._setWidthByHeightDifferenceRatio(),this._hImage=this._hImage*(this._wImage/this._wOrigin)},_setWidthByHeightDifferenceRatio:function(){var t=this._wOrigin*this._getBaseHeightDifferenceRatio();t=Math.min(t,this.getBaseFrameWidth()),this._wImage=t,this._wFrame=Math.floor(t),this._wFrame=Math.max(this._wFrame,70)},_getBaseHeightDifferenceRatio:function(){return this.getBaseFrameHeight()/this._hOrigin},toString:function(){return["Origin: (%d, %d)".format(this._wOrigin,this._hOrigin),"Image: (%d, %d)".format(this._wImage,this._hImage),"Frame: (%d, %d)".format(this._wFrame,this._hFrame)].join("\n")},setFrameWidth:function(t){this._wFrame=t},setFrameHeight:function(t){this._hFrame=t},setImageWidth:function(t){this._wImage=t},setImageHeight:function(t){this._hImage=t},getBaseFrameWidth:function(){return this._htThumbnailInfo.nWidth},getBaseFrameHeight:function(){return this._htThumbnailInfo.nHeight},getData:function(){return this._oData},getFrameWidth:function(){return this._wFrame},getFrameHeight:function(){return this._hFrame},getImageWidth:function(){return this._wImage},getImageHeight:function(){return this._hImage},getMargin:function(){return this._htThumbnailInfo.nMargin},getBothSidesMargin:function(){return 2*this.getMargin()}})}(),function(){PW.PhotoWallFormatter=$Class({_LIST_TEMPLATE_ID:"tmpl_photowall_list",_ITEM_TEMPLATE_ID:"tmpl_photowall_item",$init:function(){this._oListTemplate=$Template(this._LIST_TEMPLATE_ID),this._oItemTemplate=$Template(this._ITEM_TEMPLATE_ID)},getHtml:function(t,i){var e=this._oListTemplate.process({width:t,itemHtml:this._getItemHtml(i)});return e},_getItemHtml:function(t){for(var i=[],e=t.length,s=null,n=0;e>n;n++)s=t[n],i.push(this._oItemTemplate.process(this._getItemStyleData(s,n)));return i.join("")},_getItemStyleData:function(t,i){var e=t.getData(),s=t.getFrameWidth(),n=t.getFrameHeight(),h=t.getImageWidth(),a=t.getImageHeight(),o=2,r=(s-h)/2,_=(n-a)/2;return{idx:i+1,data:e,frame:{width:s,height:n,margin:t.getMargin()},image:{page:e.page,click:e.click,link:e.link,src:e.src,width:h,height:a,left:r,top:a>n?0:_},border:{width:s-o,height:n-o}}}})}();