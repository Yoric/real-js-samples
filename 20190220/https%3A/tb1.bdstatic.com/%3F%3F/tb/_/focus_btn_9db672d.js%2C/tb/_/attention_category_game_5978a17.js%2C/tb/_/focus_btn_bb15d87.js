_.Module.define({path:"forum/pagelet/focus_btn",sub:{initial:function(n){this.initialEvent(n)},initialEvent:function(n){n.on("like_status_update",function(t){$(n.document).addClass("pagelet-loading"),n.refresh({url:t.url}).then(function(){$(n.document).removeClass("pagelet-loading")})})}}});_.Module.define({path:"entertainment-game/widget/attentionCategoryGame",sub:{initial:function(t,e,n){this.reason=t,this.is_reply=e,this.likeData=n,this._requestData()},_requestData:function(){var t=this,e="/game/adtask/getFollowList?&forum_id="+PageData.forum.id;$.get(e).done(function(e){if(0===e.no){var n=e.data.game_list;if(""!=n)t._bindEvent(n);else{var i=[{id:"752",name:"\u5927\u5929\u4f7f\u4e4b\u5251",link:"http://wanba.baidu.com/login_game_by_zone.xhtml?type=lastloginserver&id=842&pid=10400200842_879148",srcimg:{type_230_170:"//tb1.bdstatic.com/tb/zt/tengfei/dts27-_130.jpg"},online:"13\u4e07"},{id:"123",name:"SD\u9ad8\u8fbe",link:"http://wanba.baidu.com/login_game_by_zone.xhtml?type=lastloginserver&id=752&pid=10400200752_879148",srcimg:{type_200_200:"//tb1.bdstatic.com/tb/zt/tengfei/wd2.jpg"},online:"12\u4e07"},{id:"123",name:"\u821e\u52a8",link:"http://wanba.baidu.com/login_game_by_zone.xhtml?type=lastloginserver&id=530&pid=10400200530_879148",srcimg:{type_200_200:"//tb1.bdstatic.com/tb/zt/tengfei/wd.jpg"},online:"10\u4e07"}];t._bindEvent(i)}}}).fail(function(){})},_bindEvent:function(t){var e=this;e._trackData();var n=this._renderAttentionContent(e.reason,e.is_reply,e.likeData,t),i={title:"\u672c\u5427\u63a8\u8350",width:515,height:320},a=$.dialog.open(n,i);$(a.element[0]).find(".dialogJcontent").tbattr("id","attention-game-wraper_dialog"),$(a.element[0]).find(".userlike_tip_span a").click(function(){Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=entryimallinpop")}),$(a.element[0]).find(".attention_category_game_btn").eq(0).bind("click",function(){e._reloadAndGotop()}),a.bind("onclose",function(){e._reloadAndGotop()})},_renderAttentionContent:function(t,e,n,i){var a=['<div class="attention-game-wraper">','<div class="attention-game-header">',"<p>\u5ba2\u5b98\uff0c\u4e0b\u9762\u662f\u5c0f\u8d34\u8d34\u4e3a\u60a8\u5949\u4e0a\u672c\u5427\u4e13\u5c5e\u6e38\u620f\uff0c\u8bf7\u7b11\u7eb3\uff01</p>","</div>",'<div class="attention-game-content">','<div class="primary-attention-game">','<div class="primary-attention-game-inner">',"<h3>"+i[0].name+"\uff0c\u8d34\u5427\u4e13\u5c5e\u798f\u5229</h3>",'<div class="primary-attention-game-content">','<img class="primary-attention-game-img" src="'+i[0].srcimg.type_230_170+'">','<div class="over-layer">','<a href="/game/adtask/link?tbjump='+encodeURIComponent(i[0].jump_url)+'&gfr=attention" target="_blank" class="button">\u7acb\u5373\u53bb\u73a9</a>',"</div>","</div>","</div>","</div>",'<div class="secondary-attention-game">','<div class="secondary-attention-game-inner">','<h3>\u5176\u4ed6\u5427\u53cb\u8fd8\u73a9<span class="attention-more-game"><a href="//tieba.baidu.com/game/index" target="_blank">\u67e5\u770b\u66f4\u591a\u6e38\u620f</a></span></h3>','<div class="secondary-attention-game-content">','<div class="attention-game-item clearfix">','<img class="attention-game-item-img" src="'+i[1].srcimg.type_200_200+'">','<div class="attention-game-info">',"<p>"+i[1].name+"</p>","<p>"+i[1].online+"\u5427\u53cb\u5728\u73a9</p>",'<p><a  class="j_item1 button" href="/game/adtask/link?tbjump='+encodeURIComponent(i[1].jump_url)+'&gfr=attention" target="_blank">\u53bb\u770b\u770b</a></p>',"</div>","</div>",'<div class="attention-game-item clearfix">','<img class="attention-game-item-img" src="'+i[2].srcimg.type_200_200+'">','<div class="attention-game-info">',"<p>"+i[2].name+"</p>","<p>"+i[2].online+"\u5427\u53cb\u5728\u73a9</p>",'<p><a href="/game/adtask/link?tbjump='+encodeURIComponent(i[2].jump_url)+'&gfr=attention" target="_blank"  class="j_item2 button">\u53bb\u770b\u770b</a></p>',"</div>","</div>","</div>","</div>","</div>","</div>","</div>"];return a.join("")},_trackData:function(){$.stats.track("\u6e38\u620f\u7c7b\u76ee\u5427\u5173\u6ce8","\u6e38\u620f\u6d6e\u5c42",null,"view",{obj_type:"\u6e38\u620f"}),$("body").on("click",".primary-attention-game-content a",function(){$.stats.track("\u6e38\u620f\u6d6e\u5c42\u5de6\u4e00","\u6e38\u620f\u6d6e\u5c42",null,"click",{obj_type:"\u6e38\u620f"})}),$("body").on("click",".j_item1",function(){$.stats.track("\u6e38\u620f\u6d6e\u5c42\u53f3\u4e00","\u6e38\u620f\u6d6e\u5c42",null,"click",{obj_type:"\u6e38\u620f"})}),$("body").on("click",".j_item2",function(){$.stats.track("\u6e38\u620f\u6d6e\u5c42\u53f3\u4e8c","\u6e38\u620f\u6d6e\u5c42",null,"click",{obj_type:"\u6e38\u620f"})})},_reloadAndGotop:function(){window.history&&window.history.pushState?Bigpipe.broadcast("like_status_update",{}):$.tb.location.setHref($.tb.location.getHref().split("#")[0])}}});_.Module.define({path:"forum/widget/focus_btn",requires:["entertainment-game/widget/attentionCategoryGame","forum/widget/like_tip"],sub:{initial:function(e){this.userLevel=e.userLevel,this.levelId=e.levelId,this.levelName=e.levelName,this.firstClass=e.firstClass,this.tbs=PageData.tbs,this.uid=PageData.user.id,this.forum_name=PageData.forum.name,this.forumVdir=e.forumVdir,this.isBawu=e.isBawu;var t=this,i=$("#j_head_focus_btn"),a=null;t.config={},t.config.url={closetip:"/f/like/commit/notice/delete",dolike:"/f/like/commit/add",undolike:"/f/like/commit/delete"},a=parseInt(e.islike)?function(){if(t.isBawu)return t._showAlert('<p style="text-align: center;">\u60a8\u8fd8\u662f\u672c\u5427\u7684\u5427\u52a1\uff0c\u8f9e\u804c\u540e\u624d\u80fd\u53d6\u6d88\u5173\u6ce8\u54e6~</p>'),!1;var e=$.tb.subByte(t.forum_name,10,"..."),i=['<div style="width:190px;text-align:center;top:18px;left:10px;position:absolute;">\u786e\u5b9a\u4e0d\u518d\u5173\u6ce8 <span style="color:red">'+e+"</span> \u5427\uff1f</div>",'<a rel="noreferrer" href="#" id="cancel_focus_yes" class="btn-default btn-small" style="position:absolute;top:50px;left:48px;">',"\u786e\u8ba4","</a>",'<a rel="noreferrer" href="#" onclick="return false;" id="cancel_focus_no" class="btn-sub btn-small" style="position:absolute;top:50px;left:105px;">',"\u53d6\u6d88","</a>"].join(""),a=new $.dialog({html:i,showTitle:!1,fixed:!1,show:!0,draggable:!1,autoCenter:!1,modal:!1,top:$("#j_head_focus_btn").offset().top-$(this).height()/2-90,left:$("#j_head_focus_btn").offset().left-$(this).width()/2+15,width:210,height:70});$("#cancel_focus_yes").on("click",function(e){e.preventDefault(),t._undolike(),a.close()}),$("#cancel_focus_no").on("click",function(e){e.preventDefault(),a.close()})}:function(){t._dolike()},i.on("click",a),$(".j_search_post ").click(function(){$.stats.track("FRS\u5168\u5427\u641c\u7d22","PB\u53caFRS\u7edf\u8ba1\u5408\u9879","frs","click")}),$(".search_internal_btn").click(function(){$.stats.track("FRS\u5427\u5185\u641c\u7d22","PB\u53caFRS\u7edf\u8ba1\u5408\u9879","frs","click")}),$(".sign_title_text_bright").click(function(){$.stats.track("FRS\u7b7e\u5230\u5e7f\u544a","PB\u53caFRS\u7edf\u8ba1\u5408\u9879","frs","click")}),$(".j_nav_list > li:eq(2) a").click(function(){$.stats.track("FRS\u7b7e\u5230\u5e7f\u544a","PB\u53caFRS\u7edf\u8ba1\u5408\u9879","frs","click")})},_showAlert:function(e){var t='<div style="padding:20px 20px; text-align:center; line-height:20px;font-size:13px;">'+e+"</div>";$.dialog.open(t,{title:"\u64cd\u4f5c\u5931\u8d25",width:380})},_dolike:function(){var e=this;if(!PageData.user.is_login)return TbCom.process("User","buildLoginFrame"),!1;if(PageData.user.is_login&&PageData.user.no_un)return TbCom.process("User","buildUnameFrame","\u586b\u5199\u7528\u6237\u540d","\u6709\u7528\u6237\u540d\u624d\u80fd\u70b9\u4eae\u201c\u6211\u559c\u6b22\u201d\uff0c\u8d76\u5feb\u7ed9\u81ea\u5df1\u8d77\u4e00\u4e2a\u5427~"),!1;var t={};1==$.tb.location.getSearchValue("fromadlike")&&$.stats.track("\u95f4\u63a5\u52a0\u5173\u6ce8","\u5206\u53d1\u5173\u6ce8\u5427\u63a8\u8350","","click"),PageData.forum&&(t={fid:PageData.forum.id,fname:e.forum_name,uid:PageData.user.name_url,ie:"gbk",tbs:e.tbs},t.fname=$.tb.escapeHTML(t.fname)),$.post(e.config.url.dolike,t,function(t){var i,a=!1;try{i=t}catch(n){a=!0}if(!a)if(i&&0==i.no)"\u6e38\u620f"==e.firstClass?e.requireInstance("entertainment-game/widget/attentionCategoryGame",["",!1,{index:i.data.ret.index,like_no:i.like_no}]):e.requireInstance("forum/widget/like_tip",["",!1,{index:i.data.ret.index,likeNo:i.like_no,userLevel:e.userLevel,levelId:e.levelId,levelName:e.levelName,forumVdir:e.forumVdir}]);else if(1990055===i.no)$.tb.checkRealName();else{var o="";o=8==i.no||9==i.no?"\u4f60\u5728\u672c\u5427\u88ab\u5c01\u7981\uff0c\u6682\u65f6\u4e0d\u80fd\u8fdb\u884c\u64cd\u4f5c":220==i.no?"\u4f60\u88ab\u5427\u4e3b\u52a0\u5165\u9ed1\u540d\u5355\uff0c\u6682\u65f6\u4e0d\u80fd\u8fdb\u884c\u64cd\u4f5c":221==i.no?"\u4f60\u5df2like\u4e86\u672c\u5427,\u8bf7\u4e0d\u8981\u91cd\u590d\u64cd\u4f5c":"\u62b1\u6b49\uff0c\u5f02\u5e38\u9519\u8bef\uff0c\u5efa\u8bae\u5237\u65b0\u9875\u9762\u91cd\u8bd5\u4e00\u4e0b",e._showAlert(o)}},"json")},_undolike:function(){var e=this,t=null;PageData.forum&&(t={fid:PageData.forum.id,fname:e.forum_name,uid:PageData.user.name_url,ie:"utf-8",tbs:e.tbs},t.fname=$.tb.escapeHTML(t.fname)),$.tb.post(e.config.url.undolike,t,function(e){var t,i=!1;try{t=e}catch(a){i=!0}i||(t&&0==t.no?window.history&&window.history.pushState?Bigpipe.broadcast("like_status_update",{}):$.tb.location.setHref($.tb.location.getHref().split("#")[0]):t&&1990055===t.no&&$.tb.checkRealName())})}}});