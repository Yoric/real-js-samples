_.Module.define({path:"ueditor/widget/draft",sub:{initial:function(t,i){t=t||window.UE,i=i||window.EditorUI,this.initPlugin(t,this),this.initLayer(i,this),this.initModel(i,this),this.initAdapter(t,i,this)},initPlugin:function(t){t.plugins.draft=function(){var t=this;if($.tb.Storage.isSupport()){var i=PosterContext.getContext(),r=["draft-"+this.uid,i.user.id,i.forum.id,i.thread?i.thread.id:0].join("-"),e=["draft-"+this.uid,"",i.forum.id,i.thread?i.thread.id:0].join("-"),n=["draft",i.user.id,i.forum.id,i.thread?i.thread.id:0].join("-"),o=(["draft","",i.forum.id,i.thread?i.thread.id:0].join("-"),$.tb.throttle(function(i,r){$.tb.Storage.set(i,r),t.$container.trigger("saved.draft")},2e3));this.addListener("contentchange",function(){o(r,this.body.innerHTML)}),this.restoreDraft=function(){var t=$.tb.Storage.get(r);t||(t=$.tb.Storage.get(e)),t||(t=$.tb.Storage.get(n)),t&&"<p><br></p>"!=t&&"<P>&nbsp;</P>"!=t&&(this.body.innerHTML=t,this.$container.trigger("restored.draft"))},this.clearDraft=function(){$.tb.Storage.remove(r),$.tb.Storage.remove(e)}}else this.clearDraft=function(){}}},initLayer:function(){},initModel:function(){},initAdapter:function(){}}});_.Module.define({path:"ueditor/widget/at",sub:{initial:function(t,i){t=t||window.UE,i=i||window.EditorUI,this.initPlugin(t,this),this.initLayer(i,this),this.initModel(i,this),this.initAdapter(t,i,this)},initPlugin:function(t){t.plugins.at=function(){function i(t,i){var e=this;this.$root=$("<div class='edui_at_box' style='display: none;'><div class='at_box_title'>\u60f3\u7528@\u63d0\u5230\u8c01\uff1f</div><ul></ul></div>").appendTo(t),this.$list=this.$root.children("ul"),this.$list.on({mouseenter:function(){e.setFocus(this)},click:function(){var t=$(this).text();e.hide(),i(t)}},"li"),this.shown=!1}function e(t){var i=t.selection.getRange();if(i.collapsed){var e=$("<span class='at'>@</span>")[0];i.setStart(i.startContainer,i.startOffset-1).select().deleteContents().insertNode(e).setStart(e,1).collapse(!0).select(),t.atBox.show(e)}}function s(i){var e=n.selection.getRange(),s=n.selection.getStart(),o=t.dom.domUtils.findParent(s,function(t){return $(t).is(".at")&&"SPAN"==t.tagName},!0);o&&null!=i&&i.length>0&&(o.innerHTML="@"+i),e.setStartAfter(o).collapse(!0).select(),n.execCommand("inserthtml","&nbsp;")}var n=this;i.prototype={loadSuggestion:function(t){var i=this;$.get("/at-sug",{query:t,uid:PosterContext.getContext().user.id,ie:"utf-8"},function(t){if(0==t.error){for(var e,s=[],n=0;e=t.msg[n];n++)s.push("<li>"),s.push(e),s.push("</li>");i.$list.html("").append(s.join(""))}},"json")},clearList:function(){this.$list.html("")},isShown:function(t){return t?this.shown&&this.target==t:this.shown},show:function(t){t!=this.target&&this.clearList(),this.target=t,this.shown=!0;var i=$(t).position();this.$root.css({left:i.left,top:i.top+16}).show()},hide:function(){this.$root.hide(),this.shown=!1},first:function(){this.setFocus(this.$list.children(":first"))},last:function(){this.setFocus(this.$list.children(":last"))},next:function(){var t=this.$list.children(".focus");0==t.size()?this.first():t.index()==this.$list.children().size()-1?this.first():this.setFocus(t.next())},prev:function(){var t=this.$list.children(".focus");0==t.size()?this.last():0==t.index()?this.last():this.setFocus(t.prev())},setFocus:function(t){$(t).siblings(".focus").removeClass("focus").end().addClass("focus")},getValue:function(){return this.$list.find(".focus").text()}},n.addListener("ready",function(){n.atBox=new i(n.$body.parent(),s)}),n.addListener("keydown",function(t,i){if(n.atBox.isShown()){switch(i.keyCode){case 38:n.atBox.prev();break;case 40:n.atBox.next();break;case 13:var e=n.atBox.getValue();n.atBox.hide(),s(e);break;case 32:s(null);break;default:return}return i.preventDefault&&i.preventDefault(),!1}}),n.addListener("keyup",function(i,s){if(50==s.keyCode&&s.shiftKey)e(this);else if(this.atBox.isShown()&&-1==$.inArray(s.keyCode,[38,40,13,32])){var n=t.dom.domUtils.findParent(this.selection.getStart(),function(t){return"at"==t.className},!0),o=$(n).text().substring(1);o.length>0&&this.atBox.loadSuggestion(o)}}),n.addListener("selectionchange",function(){var i=n.selection.getRange();if(i.collapsed){var e=n.selection.getStart(),s=t.dom.domUtils.findParent(e,function(t){return"at"==t.className},!0);s?this.atBox.isShown(s)||(this.atBox.show(s),this.atBox.loadSuggestion($(s).text().substring(1))):this.atBox.isShown()&&this.atBox.hide()}}),this.addOutputRule(function(i){$.each(i.getNodesByTagName("span"),function(i,e){var s=e.getAttr("class");if("at"==s){var n=e.innerText(),o=t.uNode.createText(n),a=e.parentNode;a.insertBefore(o,e),a.removeChild(e)}})},!0)}},initLayer:function(){},initModel:function(){},initAdapter:function(){}}});_.Module.define({path:"ueditor/widget/counter",sub:{initial:function(i,t){i=i||window.UE,t=t||window.EditorUI,this.initPlugin(i,this),this.initLayer(t,this),this.initModel(t,this),this.initAdapter(i,t,this)},initPlugin:function(i){i.plugins.counter=function(){function i(i){return i.replace(/[^\x00-\xff]/g,"mm").length}var t=this;t.getContentByteLength=function(){return i(t.getContent())}}},initLayer:function(){},initModel:function(){},initAdapter:function(){}}});_.Module.define({path:"ueditor/widget/word_limit",sub:{initial:function(e,t){e=e||window.UE,t=t||window.EditorUI,this.initPlugin(e,this),this.initLayer(t,this),this.initModel(t,this),this.initAdapter(e,t,this)},initPlugin:function(e){e.plugins.word_limit=function(){var e=10,t=null,i=300,n=!1,o=!1,r=this;r.maxNum=140,r.maxWordNumType="HalfAsciiCode",r.ready(function(){r.options.maxWordNum&&(r.maxNum=r.options.maxWordNum,r.maxWordNumType=r.options.maxWordNumType?r.options.maxWordNumType:r.maxWordNumType,r.creatHolder(),r.container.appendChild(r.holder),r.addListener("keyup",r.handlerEvent,r),r.addListener("focus",r.handlerEvent,r),r.checkWordNum())}),r.creatHolder=function(){var e=document.createElement("div");e.className="wordlimit-holder",e.style.visibility="hidden",r.holder=e},r.handlerEvent=function(){clearTimeout(t),t=setTimeout(function(){r.checkWordNum()},i)},r.getContentByteLength=function(e){e=(e||[]).concat(["br","img"]),count="NormalAsciiCodeLen"==r.maxWordNumType?2*this.getContentTxt().replace(/[\t\r\n]+/g,"").length:this.getContentTxt().replace(/[\t\r\n]+/g,"").replace(/[^\x00-\xff]/g,"mm").length;for(var t,i=0;t=e[i++];){switch(t){case"br":count+=this.body.getElementsByTagName(t).length;continue;case"img":}count+=2*this.body.getElementsByTagName(t).length}return count},r.checkWordNum=function(){var t=r.maxNum-Math.ceil(r.getContentByteLength()/2);e>=t?(r.holder.style.visibility="visible",n=!0,0>t?(o||(r.fireEvent("overflow"),o=!0),r.holder.innerHTML='\u5df2\u7ecf\u8d85\u51fa<span style="font-size:18px;font-family:Arial;color:#f00;">'+-t+"</span>\u4e2a\u5b57"):(o&&(r.fireEvent("unoverflow"),r.exceed=!1),r.holder.innerHTML='\u8fd8\u80fd\u8f93\u5165<span style="font-size:18px;font-family:Arial;">'+t+"</span>\u4e2a\u5b57")):n&&(r.holder.style.visibility="hidden",n=!1,o&&(r.fireEvent("unoverflow"),o=!1))}}},initLayer:function(){},initModel:function(){},initAdapter:function(){}}});!function(){function t(){this._api={getProps:"/tbmall/get/userProps"}}var e=null,n={};t.prototype={getProps:function(t,e,i){if(arguments.length<2)throw"At least 2 arguments needed";"undefined"==typeof i?(i=e,e=!0):e=!!e,e&&n[t]?i(n[t]):$.get(this._api.getProps,{category:t,t:(new Date).getTime()},function(e){n[t]=e.data[t]||{},i(n[t])})}},_.Module.define({path:"encourage-base/widget/props_data",sub:{initial:function(){},getInstance:function(){return null===e&&(e=new t),e}}})}(window);_.Module.define({path:"encourage-thread/widget/bubble_factory",requires:["encourage-base/widget/props_data"],sub:{_curPropId:0,_bubbleDefaultProp:null,_list:[{id:0,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/nobubble.png",name:"\u4e0d\u4f7f\u7528\u6c14\u6ce1",type:0},{id:1010034,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jintianzhangzheyang.jpg",name:"\u4eca\u5929\u957f\u8fd9\u6837",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jintianzhangzheyang_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/jintianzhangzheyang_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jintianzhangzheyang_03.png",topHeight:"22",bottomHeight:"105"}},{id:1010033,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/woxiangjingjing.jpg",name:"\u6211\u60f3\u9759\u9759",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/woxiangjingjing_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/woxiangjingjing_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/woxiangjingjing_03.png",topHeight:"22",bottomHeight:"105"}},{id:1010032,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/ranbingluan.jpg",name:"\u7136\u5e76\u5375",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/ranbingluan_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/ranbingluan_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/ranbingluan_03.png",topHeight:"22",bottomHeight:"105"}},{id:1010031,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jiji.jpg",name:"\u6324\u6324",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jiji_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/jiji_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jiji_03.png",topHeight:"22",bottomHeight:"105"}},{id:1010030,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/qianpai.jpg",name:"\u524d\u6392",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/qianpai_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/qianpai_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/qianpai_03.png",topHeight:"22",bottomHeight:"105"}},{id:1010020,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xionghaizhi.jpg",name:"\u5c0f\u718a\u5f00\u5b66",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xionghaizhi_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/xionghaizhi_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xionghaizhi_03.png",topHeight:"11",bottomHeight:"108"}},{id:1010019,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/piaoliupings.jpg",name:"\u6f02\u6d41\u74f6",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/piaoliuping_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/piaoliuping_2.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/piaoliuping_3.png",topHeight:"110",bottomHeight:"34"}},{id:1010016,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/panpasis.jpg",name:"\u6f58\u5e15\u65af\u4e4b\u9e70",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/panpasi_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/panpasi_2.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/panpasi_3.png",topHeight:"54",bottomHeight:"91"}},{id:1010015,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/riermans.jpg",name:"\u65e5\u8033\u66fc\u6218\u8f66",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/rierman_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/rierman_2.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/rierman_3.png",topHeight:"50",bottomHeight:"65"}},{id:1010014,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/caoshangyingfeis.jpg",name:"\u8349\u957f\u83ba\u98de",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/caoshangyingfei_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/caoshangyingfei_2.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/caoshangyingfei_3.png",topHeight:"61",bottomHeight:"58"}},{id:1010012,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xingnis.jpg",name:"\u6765\u81ea\u661f\u661f\u7684\u4f60",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xingni_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/xingni_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xingni_3.png",topHeight:"35",bottomHeight:"67"}},{id:1010011,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/qingrens.jpg",name:"\u4e18\u6bd4\u7279",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/qingren_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/qingren_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/qingren_3.png",topHeight:"60",bottomHeight:"66"}},{id:1010010,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/chunjies.jpg",name:"\u6b22\u5ea6\u6625\u8282",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/chunjie_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/chunjie_2.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/chunjie_3.png",topHeight:"35",bottomHeight:"68"}},{id:1010007,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/yuandans.jpg",name:"\u559c\u5e86\u5143\u65e6",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/yuandan_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/yuandan_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/yuandan_03.png",topHeight:"24",bottomHeight:"56"}},{id:1010006,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/shengdans.jpg",name:"\u5feb\u4e50\u5723\u8bde",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/shengdian_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/shengdan_2.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/shengdan_3.png",topHeight:"26",bottomHeight:"72"}},{id:1010005,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/zhangyus.jpg",name:"\u6ce1\u6fa1\u7ae0\u9c7c",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/zhangyu_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/zhangyu_2.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/zhangyu_3.png",topHeight:"66",bottomHeight:"70"}},{id:1010004,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/tuhaos.jpg",name:"\u94bb\u77f3\u571f\u8c6a\u91d1",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/tuhao_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/tuhao_2.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/tuhao_3.png",topHeight:"37",bottomHeight:"42"}},{id:1010003,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/dashus.jpg",name:"\u5fae\u7b11\u5927\u53d4",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/shushu_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/shushu_2.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/shushu_3.png",topHeight:"31",bottomHeight:"55"}},{id:1010002,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/dazuiguais.jpg",name:"\u5927\u5634\u602a",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/dazuiguai_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/dazuiguai_2.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/dazuiguai_3.png",topHeight:"78",bottomHeight:"34"}},{id:1010001,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xiaolus.jpg",name:"\u773a\u671b\u5c0f\u9e7f",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xiaolu_1.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/xiaolu_2.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xiaolu_3.png",topHeight:"45",bottomHeight:"55"}}],_npcPropsList:[{id:1010101,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/lufei.jpg",name:"\u8def\u98de",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/lufei_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/lufei_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/lufei_03.png",topHeight:"19",bottomHeight:"101"}},{id:1010102,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/mingren.jpg",name:"\u9e23\u4eba",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/mingren_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/mingren_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/mingren_03.png",topHeight:"42",bottomHeight:"117"}},{id:1010103,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/nazi.jpg",name:"\u7eb3\u5179",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/nazi_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/nazi_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/nazi_03.png",topHeight:"18",bottomHeight:"124"}},{id:1010104,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/huangyuge.jpg",name:"\u9ec4\u9c7c\u54e5",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/huangyuge_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/huangyuge_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/huangyuge_03.png",topHeight:"111",bottomHeight:"27"}},{id:1010105,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/shouwangzhe.jpg",name:"\u6212\u8272\u5b88\u671b\u8005",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/shouwangzhe_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/shouwangzhe_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/shouwangzhe_03.png",topHeight:"25",bottomHeight:"60"}},{id:1010106,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/zhangqiling.png",name:"\u5f20\u8d77\u7075",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/zhangqiling_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/zhangqiling_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/zhangqiling_03.png",topHeight:"80",bottomHeight:"48"}},{id:1010107,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/suhuanzhen.png",name:"\u7d20\u8fd8\u771f",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/suhuanzhen_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/suhuanzhen_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/suhuanzhen_03.png",topHeight:"23",bottomHeight:"126"}},{id:1010108,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jinmuyan.png",name:"\u91d1\u6728\u7814",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jinmuyan_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/jinmuyan_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jinmuyan_03.png",topHeight:"53",bottomHeight:"87"}},{id:1010109,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/heiqiyihu.png",name:"\u9ed1\u5d0e\u4e00\u62a4",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/heiqiyihu_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/heiqiyihu_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/heiqiyihu_03.png",topHeight:"80",bottomHeight:"160"}},{id:1010110,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jieluxiaoguanjia.png",name:"\u6212\u64b8\u5427\u5c0f\u7ba1\u5bb6",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jieluxiaoguanjia_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/jieluxiaoguanjia_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jieluxiaoguanjia_03.png",topHeight:"80",bottomHeight:"175"}},{id:1010111,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jingtianming.png",name:"\u8346\u5929\u660e",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jingtianming_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/jingtianming_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jjingtianming_03.png",topHeight:"27",bottomHeight:"80"}},{id:1010112,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/yingsanjiage.png",name:"\u82f1\u4e09\u5609\u54e5",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/yingsanjiage_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/yingsanjiage_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/yingsanjiage_03.png",topHeight:"74",bottomHeight:"44"}},{id:1010113,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/bantianyinshi.png",name:"\u5742\u7530\u94f6\u65f6",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/bantianyinshi_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/bantianyinshi_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/bantianyinshi_03.png",topHeight:"40",bottomHeight:"100"}},{id:1010114,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/nuannuan.png",name:"\u6696\u6696",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/nuannuan_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/nuannuan_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/nuannuan_03.png",topHeight:"18",bottomHeight:"124"}},{id:1010115,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/heisikong.png",name:"\u9ed1\u4e1d\u63a7",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/heisikong_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/heisikong_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/heisikong_03.png",topHeight:"20",bottomHeight:"120"}},{id:1010116,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/huiyuanai.png",name:"\u7070\u539f\u54c0",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/huiyuanai_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/huiyuanai_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/huiyuanai_03.png",topHeight:"49",bottomHeight:"111"}},{id:1010117,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/dongfangai.png",name:"\u4e1c\u65b9\u7231",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/dongfangai_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/dongfangai_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/dongfangai_03.png",topHeight:"21",bottomHeight:"116"}},{id:1010118,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/gaobansuinaiguo.png",name:"\u9ad8\u5742\u7a57\u4e43\u679c",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/gaobansuinaiguo_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/gaobansuinaiguo_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/gaobansuinaiguo_03.png",topHeight:"17",bottomHeight:"118"}},{id:1010120,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xierwanasi.jpg",name:"\u5e0c\u5c14\u74e6\u5a1c\u65af",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xierwanasi_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/xierwanasi_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xierwanasi_03.png",topHeight:"45",bottomHeight:"82"}},{id:1010121,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/mengbanniang.jpg",name:"\u840c\u677f\u5a18",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/mengbanniang_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/mengbanniang_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/mengbanniang_03.png",topHeight:"36",bottomHeight:"104"}},{id:1010122,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jijianhun.jpg",name:"\u796d\u5251\u9b42",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jijianhun_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/jijianhun_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/jijianhun_03.png",topHeight:"94",bottomHeight:"32"}},{id:1010123,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/fujianyuanbigu.png",name:"\u4f0f\u89c1\u733f\u6bd4\u53e4",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/fujianyuanbigu_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/fujianyuanbigu_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/fujianyuanbigu_03.png",topHeight:"32",bottomHeight:"137"}},{id:1010124,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/gainie.png",name:"\u76d6\u8042",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/gainie_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/gainie_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/gainie_03.png",topHeight:"37",bottomHeight:"119"}},{id:1010125,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/maolilan.png",name:"\u6bdb\u5229\u5170",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/maolilan_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/maolilan_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/maolilan_03.png",topHeight:"30",bottomHeight:"103"}},{id:1010126,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/wuxie.png",name:"\u5434\u90aa",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/wuxie_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/wuxie_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/wuxie_03.png",topHeight:"39",bottomHeight:"100"}},{id:1010127,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xiamuguizhi.png",name:"\u590f\u76ee\u8d35\u5fd7",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xiamuguizhi_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/xiamuguizhi_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/xiamuguizhi_03.png",topHeight:"63",bottomHeight:"122"}},{id:1010128,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/baoyuxinnu.png",name:"\u66b4\u96e8\u5fc3\u5974",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/baoyuxinnu_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/baoyuxinnu_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/baoyuxinnu_03.png",topHeight:"45",bottomHeight:"33"}},{id:1010129,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/yefan.png",name:"\u53f6\u51e1",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/yefan_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/yefan_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/yefan_03.png",topHeight:"70",bottomHeight:"90"}},{id:1010130,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/kiana.png",name:"kiana",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/kiana_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/kiana_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/kiana_03.png",topHeight:"40",bottomHeight:"160"}},{id:1010131,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/chuyinmiku.png",name:"\u521d\u97f3\u30df\u30af",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/chuyinmiku_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/chuyinmiku_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/chuyinmiku_03.png",topHeight:"57",bottomHeight:"230"}},{id:1010132,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/zetiangangji.png",name:"\u6ca2\u7530\u7eb2\u5409",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/zetiangangji_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/zetiangangji_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/zetiangangji_03.png",topHeight:"128",bottomHeight:"84"}},{id:1010133,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/liuming.png",name:"\u67f3\u9e23",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/liuming_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/liuming_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/liuming_03.png",topHeight:"21",bottomHeight:"110"}},{id:1010134,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/menghao.png",name:"\u5b5f\u6d69",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/menghao_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/menghao_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/menghao_03.png",topHeight:"85",bottomHeight:"34"}},{id:1010135,smallPic:"//tb1.bdstatic.com/tb/cms/post/bubble/wudaodongxiang.png",name:"\u96fe\u5c9b\u8463\u9999",type:1,background:{topPic:"//tb1.bdstatic.com/tb/cms/post/bubble/wudaodongxiang_01.png",middlePic:"//tb1.bdstatic.com/tb/cms/post/bubble/wudaodongxiang_02.png",bottomPic:"//tb1.bdstatic.com/tb/cms/post/bubble/wudaodongxiang_03.png",topHeight:"33",bottomHeight:"127"}}],initial:function(t){"object"==typeof t&&t.props_id&&(this._bubbleDefaultProp=t||{},this._curPropId=this._bubbleDefaultProp.props_id),this._list=$.map(this._list,function(t){return t.background=t.background||{},t.background.id=t.id,t})},loadUserPropsData:function(t){var b=this,i=this.requireInstance("encourage-base/widget/props_data"),c=i.getInstance();c.getProps(101,function(i){b._userPropList=i,b._list=$.map(b._list,function(t){return t.isBuy=t.background.isBuy=b.hasUserPower(t.id),t.loseTime=t.isBuy?b.hasNearLosePower(t.id):0,t}),b._list=b._list.concat($.map(b._npcPropsList,function(t){var i=b.hasUserPower(t.id);if(i)return t.background=t.background||{},t.background.id=t.id,t.isBuy=t.background.isBuy=i,t.loseTime=t.isBuy?b.hasNearLosePower(t.id):0,t})),b._npcPropsList=[],t()})},hasUserPower:function(t){if(0==t)return!0;var b=this.get(t),i=this._userPropList[b.id]||{},c=1*new Date,o=(parseInt(1e3*i.end_time)-c)/864e5;return 0==b.type?!0:i&&o>0?!0:!1},hasNearLosePower:function(t){var b=this._userPropList[t||0]||{},i=1*new Date,c=(parseInt(1e3*b.end_time)-i)/864e5;return b&&c>0&&2>c?parseInt(c+1):0},get:function(t){return _.filter(this._list.concat(this._npcPropsList),function(b){return b.id==t})[0]},getRandom:function(){var t=parseInt(Math.random()*this._list.length);return 0==this._list[t].id||this._list[t].id==this._curPropId?this.getRandom():this._list[t].id},getAll:function(){return this._list},setPropId:function(t){this._curPropId=this.get(t)?t:this._curPropId,PageData.user.bubble_id=this._curPropId},getPropId:function(){return this._curPropId},getCurrent:function(){if(this._bubbleDefaultProp&&this._bubbleDefaultProp.props_id===this._curPropId){var t=$.extend(this.get(this._curPropId),this._bubbleDefaultProp);t.background=t.background||{},t.background.id=t.id,t.isBuy=t.background.isBuy=1e3*t.end_time>new Date;var b=(parseInt(1e3*t.end_time)-1e3*new Date)/864e5;return t.loseTime=t.isBuy?b>0&&2>b?b+1:0:0,t}return this.get(this._curPropId)}}});_.Module.define({path:"encourage-thread/widget/post_setting",requires:["encourage-thread/widget/bubble_factory","encourage-member/widget/join_vip_dialog"],sub:{_typeList:[{type:"bubble",name:"\u53d1\u8d34\u6c14\u6ce1",submitUrl:"/#"}],initial:function(t){t=$.extend({},t);{var e=t.type;t.forumId}this.scores=t.userScore,this.level=t.userLevel,this.userLevel=t.level||0,this.type=this._hasType(e)?e:"setting",this.bubbleFactory=this.requireInstance("encourage-thread/widget/bubble_factory"),t.noShow||this.show(e)},loadDialogFlag:0,show:function(t){if(!this._dialog){var e=this;0===this.loadDialogFlag&&(this.loadDialogFlag=1,this.bubbleFactory.loadUserPropsData(function(){e.loadDialogFlag=0,e.type=e._hasType(t)?t:e.type,e._build(),e.listenEvent()}))}},listenEvent:function(){var t=this;this._root.find(".dialogJclose").click(function(e){e.preventDefault(),t._dialog.close()});var e=this._root.find(".j_post_setting_frame"),s=this._root.find(".j_post_setting_tab");this._root.find(".j_post_setting_title").on("click",".j_post_setting_tab",function(i){i.preventDefault();var _=$(i.currentTarget),o=_.tbattr("attr-type");t.type=t._hasType(o)?o:t.type;var a=t._root.find(".j_post_setting_frame_"+o);s.removeClass("post_setting_tab_select j_post_setting_tab_select"),_.addClass("post_setting_tab_select j_post_setting_tab_select"),e.removeClass("post_setting_frame_show"),a.addClass("post_setting_frame_show")}),this._root.on("click",".j_post_settting_nopower",function(e){e.preventDefault(),t.requireInstance("encourage-member/widget/join_vip_dialog",{scores:t.scores,level:t.level}).getMemberDialog("\u53d1\u5e16\u6c14\u6ce1\u5f00\u901a\u70b9\u51fb2",1007001002),$.stats.track("\u53d1\u5e16\u6c14\u6ce1","\u4f1a\u5458\u5065\u5eb7\u7edf\u8ba1","","click",{obj_name:"\u53d1\u5e16\u6c14\u6ce1\u5f00\u901a\u70b9\u51fb2"})}),this._root.find(".j_post_setting_submit").click(function(e){e.preventDefault(),t._handleSubmit()}),this._root.find(".j_post_setting_cancel").click(function(e){e.preventDefault(),t._dialog.close()}),this._dialog.onclose(function(){t._dialog=null})},_hasType:function(t){return _.filter(this._typeList,function(e){return e.type===t}).length},_build:function(){var t=this._buildHtml();this._dialog=new $.dialog({html:t,showTitle:!1,width:620,height:423,modal:!1}),this._root=this._dialog.element},_buildHtml:function(){var t=this,e=[];e.push('<div class="post_setting_wrap">'),e.push('<a href="#" class="dialogJclose" title="\u5173\u95ed\u672c\u7a97\u53e3">&nbsp;</a>'),e.push('<div class="post_setting_title clearfix j_post_setting_title"></div>'),e.push('<div class="post_setting_body j_post_setting_body"></div>'),e.push('<div class="post_setting_operation j_post_setting_operation">'),e.push('<a href="#" class="btn_default btn_middle post_setting_submit j_post_setting_submit">\u786e \u5b9a</a>'),e.push('<a href="#" class="btn_sub btn_middle j_post_setting_cancel">\u53d6 \u6d88</a>'),e.push("</div>"),e.push("</div>");var s=$(e.join("")),i=[];return $.each(this._typeList,function(e,_){var o="";_.type===t.type&&(o="post_setting_tab_select j_post_setting_tab_select"),i.push('<a href="#" attr-type="'+_.type+'" class="post_setting_tab j_post_setting_tab '+o+'">'+_.name+"</a>"),s.find(".j_post_setting_body").append(t._buildSecondFrame(_.type,_.type===t.type))}),s.find(".j_post_setting_title").append(i.join("")),s},_buildSettingFrame:function(){},_buildSecondFrame:function(t,e){var s=this,i={},_=[];switch(t){case"bubble":i=this.bubbleFactory.getAll()}var o=[];$.each(i,function(t,e){var i="";e.id==s.bubbleFactory.getPropId()&&(i="post_setting_prop_item_select j_post_setting_prop_item_select"),o.push('<div class="post_setting_prop_item j_post_setting_prop_item '+i+'" attr-id="'+e.id+'">'),o.push('<a onclick="return false" href="#" class="post_setting_prop_item_pic_wrap">'),o.push('<img src="'+e.smallPic+'"/>'),o.push('<div class="post_setting_prop_item_set_default_back"></div>'),o.push('<div class="post_setting_prop_item_set_default">'),o.push('<span class="post_setting_prop_item_set_default_btn j_post_setting_default_btn">\u8bbe\u4e3a\u9ed8\u8ba4</span>'),o.push('<span class="post_setting_prop_item_set_default_suc">\u5df2\u7ecf\u8bbe\u4e3a\u9ed8\u8ba4</span>'),1!=e.type||e.isBuy||s.userLevel||o.push('<div class="post_setting_prop_item_nopower"><span class="j_post_settting_nopower" href="#">\u5f00\u901a\u4f1a\u5458</span>\u514d\u8d39\u4f7f\u7528</div>'),o.push("</div>"),e.isBuy||o.push('<div class="post_setting_prop_item_power_icon"></div>'),o.push("</a>"),o.push('<div class="post_setting_prop_item_name">'),o.push(e.name),o.push("</div>"),o.push("</div>")}),_.push('<div class="post_setting_frame j_post_setting_frame clearfix j_post_setting_frame_'+t+" "+(e?"post_setting_frame_show":"")+'">'),_.push(o.join("")),_.push("</div>");var a=$(_.join("")),n=a.find(".j_post_setting_prop_item");return a.on("click",".j_post_setting_default_btn",function(t){t.preventDefault();var e=$(t.currentTarget),s=e.closest(".j_post_setting_prop_item");n.removeClass("post_setting_prop_item_select j_post_setting_prop_item_select"),s.addClass("post_setting_prop_item_select j_post_setting_prop_item_select")}),a},_handleSubmit:function(){var t=$(this._root.find(".j_post_setting_frame_"+this.type).find(".j_post_setting_prop_item_select").get(0)).tbattr("attr-id");switch(this.type){case"bubble":this.changeBubble(t)}this._dialog.close()},changeBubble:function(t){var e=this,s=this.bubbleFactory.get(t||0);$.ajax({url:"/tbmall/submit/setBub",type:"post",dataType:"json",data:{props_id:s.id,tbs:PageData.tbs||PageData.user.tbs},success:function(){e.trigger("bubbleset",s),e.bubbleFactory.setPropId(s.id)},error:function(){e.trigger("bubbleset",s),e.bubbleFactory.setPropId(s.id)}})},randomBubble:function(){var t=this.bubbleFactory.getRandom();this.changeBubble(t)}}});_.Module.define({path:"encourage-thread/widget/setting",requires:["encourage-member/widget/join_vip_dialog","encourage-thread/widget/post_setting"],sub:{initial:function(e,t,n){e=e||window.UE,t=t||window.EditorUI,this.userOptions=$.extend({},n),this.level=this.userOptions.level||{},this.scores=this.userOptions.scores||{},this.initPlugin(e,this),this.initLayer(t,this),this.initModel(t,this),this.initAdapter(e,t,this)},initPlugin:function(e,t){e.plugins.setting=function(){if(window.PosterContext){var e=this,n=PosterContext.getContext(),i=null,o=t.level||{},r=o.end_time?parseInt(1*new Date/1e3)>o.end_time?0:o.props_id:0,s={MSG_DEFAULT:"",MSG_NOT_MEMBER:'<p><a class="j_get_member" href="#">\u5f00\u901a\u4f1a\u5458</a>\uff0c\u7acb\u5373\u514d\u8d39\u4f7f\u7528\u6240\u6709\u9053\u5177\u3002</p>',MSG_NEED_BUY:'<p><a class="post_random_bubble j_random_bubble" href="#">\u6362\u4e00\u6362</a><a class="post_cancel_bubble j_cancel_bubble" href="#">\u53d6\u6d88\u4f7f\u7528</a>\u8be5\u9053\u5177\u9700\u8d2d\u4e70\u624d\u80fd\u4f7f\u7528\uff0c\u53bb<a target="_blank" href="/tbmall/propslist?category=101">\u8d2d\u4e70\u5355\u54c1</a>\u6216<a class="post_get_member j_get_member" href="#">\u5f00\u901a\u4f1a\u5458</a>\u3002',MSG_NEAR_LOSE:'<p>\u6709\u6548\u671f\u4e0d\u8db3{#TIME#}\u5929\uff0c\u53bb<a class="j_get_member" href="#">\u7eed\u8d39\u4f1a\u5458</a>\u3002</p>',MSG_USE_GUIDE:'<p>\u5c0a\u656c\u7684\u4f1a\u5458\uff0c\u60a8\u53ef\u4f7f\u7528\u53d1\u8d34\u6c14\u6ce1\uff0c<a class="j_open_setting" href="#">\u7acb\u5373\u8bd5\u7528</a>\u3002</p>'},a=null,c=function(){return a?a:(a=e.$container?e.$container.find(".edui-editor-msg"):null,a&&a.on("click",".j_get_member",function(e){e.preventDefault();var n=t.requireInstance("encourage-member/widget/join_vip_dialog",{scores:t.userScore,level:t.userLevel});n.getMemberDialog("\u53d1\u5e16\u6c14\u6ce1\u5f00\u901a\u70b9\u51fb1",1007001001),$.stats.track("\u53d1\u5e16\u6c14\u6ce1","\u4f1a\u5458\u5065\u5eb7\u7edf\u8ba1","","click",{obj_name:"\u53d1\u5e16\u6c14\u6ce1\u5f00\u901a\u70b9\u51fb1"})}).on("click",".j_cancel_bubble",function(e){e.preventDefault(),i&&i.changeBubble()}).on("click",".j_open_setting",function(t){t.preventDefault(),e.execCommand("setting","bubble"),$.cookie("bubguide",1,{expires:30}),a.html(s.MSG_DEFAULT)}).on("click",".j_random_bubble",function(t){t.preventDefault(),e.execCommand("setting","bubble","change")}),a)},u=function(o,r,s){i=t.requireInstance("encourage-thread/widget/post_setting",{type:o,noShow:r,props:n.user.props,forumId:n.forum.id,level:n.user.memberLevel,userScore:t.userOptions.scores,userLevel:t.userOptions.level}),i.bind("bubbleset",function(t,n){e.execCommand("background","bubble",n.background),l(n)}),"function"==typeof s&&s.call(e,i)},l=function(e){a=c(),e=$.extend({},e);var t=s.MSG_DEFAULT;return e.isBuy?e.loseTime?t=s.MSG_NEAR_LOSE.replace(/\{#TIME#\}/,e.loseTime):0===r&&e.id&&(t=s.MSG_NOT_MEMBER):t=s.MSG_NEED_BUY,a.html(t),t},b=function(e){return i?(i.show(e),void 0):(u(e),void 0)},_=function(e){return i?(i.randomBubble(),void 0):(u(e,!0,function(e){e.randomBubble()}),void 0)};e.ready(function(){u(null,!0,function(){a=c()})}),e.commands.setting={execCommand:function(e,t,n){switch(n=n||"show"){case"change":_(t);break;case"show":b(t);break;default:b(t)}}},e.commands.setmsg={execCommand:function(t,n){e.ready(function(){a=c(),"string"==typeof n?a.html(s[n||"MSG_DEFAULT"]||""):"object"==typeof n&&l(n)})}}}}},initLayer:function(){},initModel:function(){},initAdapter:function(){}}});_.Module.define({path:"encourage-thread/widget/medal",requires:["poster/widget/post_manager","encourage-thread/widget/bubble_factory"],sub:{initial:function(t,e,n){t=t||window.UE,e=e||window.EditorUI,this.option=$.extend({},n),this.initPlugin(t,this),this.initLayer(e,this),this.initModel(e,this),this.initAdapter(t,e,this),this.postManager=this.requireInstance("poster/widget/post_manager"),this.initBubble(),this.initPostDataProcessor(),this.initPostValidate()},initPlugin:function(t){t.plugins.medal=function(){var t=this;t.getContentRoot=function(){return this.$body},t.addListener("beforepaste",function(t,e){var n=/<img[^>]*class="BDE_Colorful"[^>]*code="([\w\d]*)".*?(?:>|\/>)/gi;e.html=e.html.replace(n,function(t,e){return String.fromCharCode(e)}),e.html=e.html.replace(/<\/?[^>]+>/g,"")}),t.commands.insertcolorful={execCommand:function(e,n){t.execCommand("inserthtml",n,!0)},ignoreContentChange:!0}}},initLayer:function(){},initModel:function(t){t.registerModel("medal",function(){var e=new t.EditorModel,n=$.eduibutton({icon:"medal",title:"\u8d34\u5427\u7279\u6743"});return e.setButton(n),e})},initAdapter:function(t,e){t.registerUI("medal",function(t){var n=this,i=e.getModel(t),o=i.getButton();return i.getWidget(),o.click(function(){n.execCommand("setting","bubble","show")}),o})},initBubble:function(){var t=this,e=(this.option.level||0,this.option.defaultBubble||{});this.postManager.addEditorReady(function(n){var i=n.editor||{},o=n.context||{};if("function"==typeof o.isPostAllowed&&o.isPostAllowed()){var r=t.requireInstance("encourage-thread/widget/bubble_factory",e);if(r.getPropId()&&r.getCurrent())return i.ready(function(){i.execCommand("background","bubble",r.getCurrent().background),i.execCommand("setmsg",r.getCurrent())}),void 0;t.memberLevel&&!$.cookie("bubguide")&&i.execCommand("setmsg","MSG_USE_GUIDE")}})},initPostDataProcessor:function(){this.postManager.addPostDataProcess(function(t){var e=(t.context||{},t.editorExtendContent||{}),n={};return e.ptype?(n.ptype=e.ptype,n):!1})},initPostValidate:function(){this.postManager.addPostValidate(function(t){var e=(t.context||{},t.editorExtendContent||{});if(e.ptype&&!e.ptypePower){var n="\u6ca1\u6709\u9053\u5177\u4f7f\u7528\u6743\u9650\u5c06\u65e0\u6cd5\u53d1\u8868\u6210\u529f";return n}return!0})}}});!function(){var n={},t=null,e=function(){};e.prototype={set:function(t,e){return n[t]=e,!0},get:function(t){return n[t]?n[t]:null}},_.Module.define({path:"encourage-thread/widget/paypost_data",sub:{initial:function(){},getInstance:function(){return t||(t=new e),t}}})}(window);_.Module.define({path:"encourage-thread/widget/paypost_agree_dialog",requires:["encourage-thread/widget/paypost_data"],sub:{dialog:null,nextFnStack:[],tpl:["<div>","<h3>\u8d34\u5427\u201c\u4ed8\u8d39\u53ef\u89c1\u201d\u529f\u80fd\u7528\u6237\u4f7f\u7528\u534f\u8bae</h3>",'<div class="scroll_section">',"<ul>","<li><b>\u3010\u9996\u90e8\u53ca\u5bfc\u9009\u3011</b></li>","<li>\u4efb\u4f55\u4f7f\u7528\u767e\u5ea6\u8d34\u5427\u4ed8\u8d39\u53ef\u89c1\u529f\u80fd\u7684\u53d1\u8d34\u548c\u6d4f\u89c8\u7528\u6237\uff08\u4ee5\u4e0b\u7edf\u79f0\u4e3a\u201c\u60a8\u201d\uff09\u5747\u5e94\u4ed4\u7ec6\u9605\u8bfb\u987b\u77e5\uff0c\u7528\u6237\u53d1\u8d34\u548c\u6d4f\u89c8\u7684\u884c\u4e3a\u5c06\u88ab\u89c6\u4e3a\u5bf9\u672c\u987b\u77e5\u5168\u90e8\u5185\u5bb9\u7684\u8ba4\u53ef\u3002\u672c\u987b\u77e5\u89c6\u4e3a\u300a\u767e\u5ea6\u514d\u8d23\u58f0\u660e\u300b\u3001\u300a\u8d34\u5427\u534f\u8bae\u300b\u3001\u300a\u5427\u4e3b\u5236\u5ea6\u300b\u3001\u300aT\u8c46\u4f7f\u7528\u987b\u77e5\u300b\u7684\u8865\u5145\u89c4\u5b9a\uff0c\u662f\u5176\u4e0d\u53ef\u5206\u5272\u7684\u7ec4\u6210\u90e8\u5206\uff0c\u4e0e\u5176\u6784\u6210\u7edf\u4e00\u6574\u4f53\u3002\u672c\u987b\u77e5\u4e0e\u4e0a\u8ff0\u5185\u5bb9\u5b58\u5728\u51b2\u7a81\u7684\uff0c\u4ee5\u672c\u89c4\u5219\u4e3a\u51c6\u3002\u672c\u987b\u77e5\u5185\u5bb9\u540c\u65f6\u5305\u62ec\u767e\u5ea6\u53ef\u80fd\u4e0d\u65ad\u53d1\u8868\u7684\u5173\u4e8e\u672c\u987b\u77e5\u7684\u76f8\u5173\u89c4\u5219\u3001\u4e1a\u52a1\u89c4\u5219\u7b49\u5185\u5bb9\u3002\u4e0a\u8ff0\u5185\u5bb9\u4e00\u7ecf\u6b63\u5f0f\u53d1\u8868\uff0c\u5373\u4e3a\u672c\u987b\u77e5\u4e0d\u53ef\u5206\u5272\u7684\u7ec4\u6210\u90e8\u5206\uff0c\u60a8\u540c\u6837\u5e94\u5f53\u9075\u5b88\u3002</li>","<li><b>\u7b2c\u4e00\u7ae0 \u4ec0\u4e48\u662f\u8d34\u5b50\u4ed8\u8d39\u53ef\u89c1\u529f\u80fd\u4ee5\u53ca\u5982\u4f55\u4f7f\u7528\u8d34\u5b50\u4ed8\u8d39\u53ef\u89c1\u529f\u80fd</b></li>","<li>\u7528\u6237\u4e3a\u6d4f\u89c8\u4f18\u8d28\u5185\u5bb9\u800c\u5411\u8d34\u5427\u53d1\u8d34\u7528\u6237\u4ed8\u8d39\u7684\u529f\u80fd\u3002<br />\u60a8\u5728\u5427\u5185\u5347\u81f36\u7ea7\u5373\u53ef\u5f00\u542f\u8be5\u529f\u80fd\uff0c\u5728\u53d1\u8d34\u6846\u70b9\u51fb\u201c\u4ed8\u8d39\u53ef\u89c1\u201d\u6309\u94ae\u6253\u5f00\u4ed8\u8d39\u5185\u5bb9\u7f16\u8f91\u533a\uff0c\u7f16\u8f91\u533a\u4e0a\u65b9\u6587\u672c\u6846\u8f93\u5165\u552e\u4ef7\uff08\u5373\u51fa\u552e\u7684T\u8c46\u6570\uff09\uff0c\u7136\u540e\u5728\u4ed8\u8d39\u533a\u57df\u548c\u6b63\u5e38\u533a\u57df\u5206\u522b\u7f16\u8f91\u5b8c\u6210\u540e\u70b9\u51fb\u201c\u53d1\u8868\u201d\u5373\u53ef\u3002</li>","<li><b>\u7b2c\u4e8c\u7ae0 \u8d23\u4efb\u6761\u6b3e</b></li>","<li>\u4f7f\u7528\u767e\u5ea6\u8d34\u5427\u4ed8\u8d39\u53ef\u89c1\u529f\u80fd\u8fc7\u7a0b\u4e2d\u6240\u521b\u9020\u7684\u5185\u5bb9\uff0c\u5747\u6765\u81ea\u70ed\u5fc3\u7528\u6237\u7684\u79ef\u6781\u53d1\u8868\u3002\u767e\u5ea6\u81ea\u8eab\u4e0d\u7f16\u8f91\u6216\u4fee\u6539\u7528\u6237\u53d1\u8868\u7684\u5185\u5bb9\u3002\u5bf9\u4e8e\u7528\u6237\u5728\u4f7f\u7528\u4ed8\u8d39\u53ef\u89c1\u529f\u80fd\u8fc7\u7a0b\u4e2d\u6240\u53d1\u8868\u5185\u5bb9\u7684\u771f\u5b9e\u6027\u5f15\u53d1\u7684\u5168\u90e8\u8d23\u4efb\uff0c\u7531\u7528\u6237\u81ea\u884c\u627f\u62c5\u3002\u4f7f\u7528\u767e\u5ea6\u8d34\u5427\u4ed8\u8d39\u53ef\u89c1\u529f\u80fd\u7684\u7528\u6237\u4e0d\u80fd\u4fb5\u72af\u5305\u62ec\u4ed6\u4eba\u7684\u8457\u4f5c\u6743\u5728\u5185\u7684\u77e5\u8bc6\u4ea7\u6743\u4ee5\u53ca\u5176\u4ed6\u6743\u5229\u3002\u4e00\u65e6\u7531\u4e8e\u7528\u6237\u4f7f\u7528\u767e\u5ea6\u8d34\u5427\u4ed8\u8d39\u53ef\u89c1\u529f\u80fd\u8fc7\u7a0b\u4e2d\u53d1\u8868\u7684\u5185\u5bb9\u53d1\u751f\u6743\u5229\u7ea0\u7eb7\u6216\u4fb5\u72af\u4e86\u4efb\u4f55\u7b2c\u4e09\u65b9\u7684\u5408\u6cd5\u6743\u76ca\uff0c\u5176\u8d23\u4efb\u7531\u7528\u6237\u672c\u4eba\u627f\u62c5\uff0c\u56e0\u6b64\u7ed9\u767e\u5ea6\u6216\u4efb\u4f55\u7b2c\u4e09\u65b9\u9020\u6210\u635f\u5931\u7684\uff0c\u7528\u6237\u5e94\u8d1f\u8d23\u5168\u989d\u8d54\u507f\u3002</li>","<li>\u4f7f\u7528\u767e\u5ea6\u8d34\u5427\u4ed8\u8d39\u53ef\u89c1\u529f\u80fd\u7684\u7528\u6237\u53ef\u4ee5\u4e3a\u4ecb\u7ecd\u3001\u8bc4\u8bba\u3001\u7814\u7a76\u7b49\u76ee\u7684\uff0c\u5728\u5408\u7406\u7684\u8303\u56f4\u5185\u9002\u5f53\u5f15\u7528\u4ed6\u4eba\u5df2\u7ecf\u53d1\u8868\u7684\u4f5c\u54c1\uff0c\u4f46\u5e94\u5f53\u6ce8\u660e\u4f5c\u8005\u59d3\u540d\u3001\u4f5c\u54c1\u540d\u79f0\uff0c\u5e76\u4e0d\u5f97\u4fb5\u72af\u8457\u4f5c\u6743\u4eba\u53ca\u5176\u4ed6\u6743\u5229\u4eba\u7684\u5408\u6cd5\u6743\u76ca\u3002</li>","<li>\u7528\u6237\u627f\u8bfa\uff1a\u5176\u5728\u4f7f\u7528\u767e\u5ea6\u8d34\u5427\u4ed8\u8d39\u53ef\u89c1\u529f\u80fd\u8fc7\u7a0b\u4e2d\u6240\u53d1\u8868\u7684\u6240\u6709\u5185\u5bb9\u7b26\u5408\u4e2d\u56fd\u6cd5\u5f8b\u6cd5\u89c4\u548c\u89c4\u8303\u6027\u6587\u4ef6\u7684\u76f8\u5173\u89c4\u5b9a\uff0c\u4e0d\u4fb5\u72af\u4efb\u4f55\u7b2c\u4e09\u65b9\u7684\u5408\u6cd5\u6743\u76ca\u3002\u5982\u7528\u6237\u8fdd\u53cd\u524d\u8ff0\u4fdd\u8bc1\uff0c\u767e\u5ea6\u8d34\u5427\u6709\u6743\u5220\u9664\u76f8\u5173\u6587\u672c\u548c\u9644\u4ef6\u5185\u5bb9\uff0c\u5e76\u53ef\u4ee5\u6682\u505c\u6216\u7ec8\u6b62\u5411\u8be5\u7528\u6237\u63d0\u4f9b\u670d\u52a1\u3002\u5982\u56e0\u4f7f\u7528\u767e\u5ea6\u8d34\u5427\u4ed8\u8d39\u53ef\u89c1\u529f\u80fd\u7684\u7528\u6237\u53d1\u8868\u7684\u5185\u5bb9\u4fb5\u72af\u4e86\u7b2c\u4e09\u65b9\u7684\u5408\u6cd5\u6743\u5229\uff0c\u7b2c\u4e09\u65b9\u5411\u767e\u5ea6\u63d0\u51fa\u5f02\u8bae\uff0c\u767e\u5ea6\u8d34\u5427\u6709\u6743\u5220\u9664\u76f8\u5173\u7684\u5185\u5bb9\u3002\u63d0\u51fa\u5f02\u8bae\u8005\u548c\u5185\u5bb9\u53d1\u8868\u8005\u4e4b\u95f4\u7684\u76f8\u5173\u6cd5\u5f8b\u95ee\u9898\u5f97\u5230\u89e3\u51b3\u540e\uff0c\u4ee5\u6b64\u4e3a\u4f9d\u636e\uff0c\u5411\u767e\u5ea6\u8d34\u5427\u63d0\u51fa\u7533\u8bf7\uff0c\u767e\u5ea6\u8d34\u5427\u53ef\u4ee5\u6062\u590d\u88ab\u5220\u9664\u7684\u5185\u5bb9\u3002\u5bf9\u4e8e\u7528\u6237\u4f7f\u7528\u767e\u5ea6\u8d34\u5427\u4ed8\u8d39\u53ef\u89c1\u529f\u80fd\u8fc7\u7a0b\u4e2d\u53d1\u8868\u7684\u4efb\u4f55\u5185\u5bb9\uff0c\u7528\u6237\u540c\u610f\u767e\u5ea6\u5728\u5168\u4e16\u754c\u8303\u56f4\u5185\u4eab\u6709\u514d\u8d39\u7684\u3001\u6c38\u4e45\u7684\u3001\u4e0d\u53ef\u64a4\u9500\u7684\u3001\u975e\u6392\u4ed6\u6027\u7684\u4f7f\u7528\u548c\u518d\u8bb8\u53ef\u7684\u6743\u5229\u3002\u767e\u5ea6\u4eab\u6709\u4fee\u6539\u3001\u590d\u5236\u3001\u53d1\u884c\u3001\u8868\u6f14\u3001\u5c55\u89c8\u3001\u4fe1\u606f\u7f51\u7edc\u4f20\u64ad\u3001\u6539\u7f16\u3001\u7ffb\u8bd1\u3001\u6c47\u7f16\u7b49\u6743\u5229\u3002\u540c\u65f6\uff0c\u5bf9\u4e8e\u7528\u6237\u4f7f\u7528\u767e\u5ea6\u8d34\u5427\u4ed8\u8d39\u53ef\u89c1\u529f\u80fd\u8fc7\u7a0b\u4e2d\u53d1\u8868\u5185\u5bb9\u7684\u4fb5\u6743\u884c\u4e3a\uff0c\u7528\u6237\u6388\u6743\u767e\u5ea6\u5728\u5168\u4e16\u754c\u8303\u56f4\u5185\u8fdb\u884c\u7ef4\u6743\u3002</li>","<li><b>\u7b2c\u4e09\u7ae0 \u672c\u987b\u77e5\u9879\u4e0b\u670d\u52a1\u7684\u53d8\u66f4\u3001\u4e2d\u6b62\u6216\u7ec8\u6b62</b></li>","<li>\u60a8\u5145\u5206\u4e86\u89e3\u5e76\u540c\u610f\uff0c\u7531\u4e8e\u4e92\u8054\u7f51\u670d\u52a1\u7684\u7279\u6b8a\u6027\uff0c\u767e\u5ea6\u53ef\u80fd\u4f1a\u6309\u7167\u76f8\u5173\u6cd5\u89c4\u3001\u53cc\u65b9\u7ea6\u5b9a\u6216\u5728\u5176\u4ed6\u5fc5\u8981\u65f6\uff0c\u4e2d\u6b62\u6216\u7ec8\u6b62\u5411\u60a8\u63d0\u4f9b\u76f8\u5e94\u670d\u52a1\uff0c\u5c4a\u65f6\uff0c\u767e\u5ea6\u4f1a\u4f9d\u6cd5\u4fdd\u62a4\u60a8\u7684\u5408\u6cd5\u6743\u76ca\u3002</li>","<li><b>\u7b2c\u56db\u7ae0 \u9644\u5219</b></li>","<li>\u767e\u5ea6\u8d34\u5427\u4ed8\u8d39\u53ef\u89c1\u529f\u80fd\u5982\u56e0\u7cfb\u7edf\u7ef4\u62a4\u6216\u5347\u7ea7\u7b49\u800c\u9700\u6682\u505c\u670d\u52a1\u65f6\uff0c\u5c06\u4e8b\u5148\u516c\u544a\u3002\u82e5\u56e0\u786c\u4ef6\u6545\u969c\u6216\u5176\u5b83\u4e0d\u53ef\u6297\u529b\u800c\u5bfc\u81f4\u6682\u505c\u670d\u52a1\uff0c\u4e8e\u6682\u505c\u670d\u52a1\u671f\u95f4\u9020\u6210\u7684\u4e00\u5207\u4e0d\u4fbf\u4e0e\u635f\u5931\uff0c\u767e\u5ea6\u8d34\u5427\u4e0d\u8d1f\u4efb\u4f55\u8d23\u4efb\u3002 \u7531\u4e8e\u767e\u5ea6\u8d34\u5427\u4ed8\u8d39\u8d34\u7684\u8c03\u6574\u5bfc\u81f4\u4fe1\u606f\u4e22\u5931\u548c/\u6216\u5176\u4ed6\u7ed3\u679c\u7684\uff0c\u767e\u5ea6\u516c\u53f8\u4e0d\u627f\u62c5\u4efb\u4f55\u8d23\u4efb\u3002</li>","<li>\u767e\u5ea6\u6709\u6743\u6839\u636e\u4e2d\u534e\u4eba\u6c11\u5171\u548c\u56fd\u6cd5\u5f8b\u3001\u6cd5\u89c4\u53ca\u89c4\u8303\u6027\u6587\u4ef6\u7684\u53d8\u5316\u4ee5\u53ca\u4e92\u8054\u7f51\u53ca\u81ea\u8eab\u4e1a\u52a1\u7684\u53d1\u5c55\u60c5\u51b5\uff0c\u4e0d\u65ad\u4fee\u6539\u548c\u5b8c\u5584\u5305\u62ec\u767e\u5ea6\u8d34\u5427\u4ed8\u8d39\u8d34\u534f\u8bae\u5728\u5185\u7684\u767e\u5ea6\u8d34\u5427\u5e2e\u52a9\u7684\u76f8\u5173\u6761\u6b3e\u3002\u767e\u5ea6\u4fdd\u7559\u968f\u65f6\u4fee\u6539\u767e\u5ea6\u8d34\u5427\u4ed8\u8d39\u8d34\u534f\u8bae\u5728\u5185\u7684\u767e\u5ea6\u8d34\u5427\u5e2e\u52a9\u6761\u6b3e\u7684\u6743\u5229\u3002\u672c\u534f\u8bae\u672a\u6d89\u53ca\u7684\u95ee\u9898\u53c2\u89c1\u56fd\u5bb6\u6709\u5173\u6cd5\u5f8b\u6cd5\u89c4\uff0c\u5f53\u672c\u534f\u8bae\u4e0e\u56fd\u5bb6\u6cd5\u5f8b\u6cd5\u89c4\u51b2\u7a81\u65f6\uff0c\u4ee5\u56fd\u5bb6\u6cd5\u5f8b\u6cd5\u89c4\u4e3a\u51c6\u3002</li>","</ul>","</div>",'<div class="btn_group">','<a href="javascript:;" class="btn_default btn_middle j_agree">',"<span><em>\u540c \u610f</em></span>","</a>",'<a href="javascript:;" class="btn_sub btn_middle j_refuse">',"<span><em>\u62d2 \u7edd</em></span>","</a>","</div>","</div>"],initial:function(){},registNextFn:function(i,e){this.nextFnStack.push({fn:i,context:e})},show:function(){this.dialog=new $.dialog({holderClassName:"paypostAgreeDialog",html:this.tpl.join(""),title:"\u4f7f\u7528\u987b\u77e5",width:550,height:270,draggable:!1}),this._bindDialogEvents()},_bindDialogEvents:function(){var i=this;this.dialog.element.find(".j_agree").one("click",function(){$.post("/diamond/submit/paypost/agree",{tbs:PageData.tbs});var e=i.requireInstance("encourage-thread/widget/paypost_data").getInstance();e.set("hasAgree",1),i._fireNextFn(),i.dialog.close()}),this.dialog.element.find(".j_refuse").one("click",function(){i.dialog.close()})},_fireNextFn:function(){_.forEach(this.nextFnStack,function(i){i.fn.call(i.context)})}}});_.Module.define({path:"encourage-thread/widget/paypost_editor",requires:["encourage-thread/widget/paypost_data","tbui/widget/bubble_tip"],sub:{FEE_EDITOR_ID:"ueditor_fee_replace",EDITOR_ID:"ueditor_replace",editor:null,opt:{},initial:function(t){this.opt=t,this.paypostData=this.requireInstance("encourage-thread/widget/paypost_data").getInstance()},showEditor:function(){if(this.normalEditor=UE.getEditor("ueditor_replace"),this.opt.isInitialed)this.feeEditor=UE.getEditor(this.FEE_EDITOR_ID);else{$("<div />").tbattr({id:this.FEE_EDITOR_ID}).appendTo($(".old_style_wrapper")),this.feeEditor=UE.getEditor("ueditor_fee_replace",{dontSavePictureToYunAlbum:!0,heightLimit:!0,toolbar:["attachment","image","video","music","scrawl"]});var t=$(this.feeEditor.container);t.addClass("paypost-fee-editor"),t.find(".edui-body-container").css({minHeight:71}),this._renderTdouInput(t),this._bindEvents(t),this.feeEditor.ready(function(){this.restoreDraft()}),this.feeEditor.enableHeightLimit(300),this.feeEditor.addListener("focus",this._editorFocusHandler)}$(this.normalEditor.container).find(".edui-editor-body").removeClass("body-container-focus").css({height:71,minHeight:71}),$(this.normalEditor.container).find(".edui-body-container").css({minHeight:55}),$(this.feeEditor.container).find(".edui-editor-body").css({height:71,minHeight:71}),$(this.feeEditor.container).addClass("editor-active"),$(this.normalEditor.container).addClass("has-paypost-editor"),this.paypostData.set("isPaypost",1),this.normalEditor.addListener("focus",this._editorFocusHandler)},_editorFocusHandler:function(){var t=$(this.container),i=t.siblings(),e=t.find(".edui-editor-body").height(),o=i.find(".edui-editor-body").height();e+=10,o-=10,e=81>e?81:e,e=e>342?342:e,o=61>o?61:o,o=o>332?332:o,t.find(".edui-editor-body").css({height:e,minHeight:81}),i.find(".edui-editor-body").css({height:o,minHeight:61})},hiddenEditor:function(){this.normalEditor=UE.getEditor("ueditor_replace"),this.feeEditor=UE.getEditor(this.FEE_EDITOR_ID),$(this.normalEditor.container).find(".edui-editor-body").css({height:220}),$(this.normalEditor.container).find(".edui-body-container").css({minHeight:204}),$(this.feeEditor.container).removeClass("editor-active"),this.paypostData.set("isPaypost",0),this.normalEditor.removeListener("focus",this._editorFocusHandler)},_renderTdouInput:function(t){var i=this,e=$('<div class="clearfix"></div>'),o=t.find(".edui-toolbar").addClass("edui-toolbar-float-left").wrap(e),a='<p class="paypost_tdou_ipt_area">   <span>\u4ee5\u4e0b\u533a\u57df\u4ed8\u8d39\u540e\u53ef\u89c1</span>   <span>     \u4ef7\u683c:   </span>   <input class="form-control j_paypost_tdou_ipt" type="text" maxlength="8" value="500" />   T\u8c46 </p>';$(a).insertBefore(o);var s='<div class="paypost_tdou_tips">   *\u6bcf\u552e\u51fa\u4e00\u6b21\uff0c\u4f60\u5c06\u6536\u5230 <span class="orange_text j_paypost_diamond">250</span> \u84dd\u94bb <div class="j_paypost_faq paypost_faq_wrap"><div class="j_paypost_tip_bubble paypost_tip_bubble_wrap">   </div><i class="icon_faq"></i></div>   <span class="orange_text j_paypost_exp">+2</span> \u672c\u5427\u7ecf\u9a8c </div>';$(s).appendTo(t);var d='<div class="paypost_editor_close_wrap"><a href="javascript:;" class="paypost_editor_close j_paypost_editor_close"></a></div>',r=$(d).insertAfter(o);r.find(".j_paypost_editor_close").on("click",function(){i.hiddenEditor()})},_bindEvents:function(t){var i=this,e=PosterContext.getContext(),o={content:"\u53ef\u7528\u4e8e1:1\u5151\u6362T\u8c46<br/>\uff08\u53ef\u5728\u4e2a\u4eba\u4e2d\u5fc3\u5151\u6362\uff1a<a href='/home/main?un="+encodeURIComponent(e.user.name)+"&ie=utf-8&fr=paypost' target='_blank'>\u524d\u5f80\u67e5\u770b</a>\uff09",arrow_dir:"up",bubble_css:{top:14,right:-73,width:180,"text-align":"center"},arrow_pos:{left:90},attr:" id='paypost_tip_bubble' ",wrap:$(".j_paypost_tip_bubble"),level:1,arrowReq:!0},a=this.requireInstance("tbui/widget/bubble_tip",o);t.find(".j_paypost_faq").on("mouseover",function(){a.showBubble()}).on("mouseout",function(){a.hideBubble()});var s=t.find(".j_paypost_diamond"),d=t.find(".j_paypost_exp");t.find(".j_paypost_tdou_ipt").on("keydown",function(t){var i=t.which,e=!1;return t.shiftKey&&(9==i&&(e=!0),e=!1),(57>=i&&i>=48||37==i||39==i||8==i||9==i||46==i||105>=i&&i>=96||229==i)&&(e=!0),e}).on("keyup change paste",function(){var t=$.trim($(this).val());if(t){t=t.replace(/\D/g,""),$(this).val(t);var e=i._calcDiamondAndExp(t);s.text(e.diamond),d.text("+"+e.exp)}})},_calcDiamondAndExp:function(t){return{diamond:Math.floor(.5*t),exp:Math.floor(.5*t*.01*.8)}}}});_.Module.define({path:"encourage-thread/widget/paypost",requires:["poster/widget/post_manager","encourage-payment/widget/tbean_safe_ajax","encourage-thread/widget/paypost_data","encourage-thread/widget/paypost_editor","encourage-thread/widget/paypost_agree_dialog"],sub:{feeEditor:null,_options:{isPaypost:1,needPaypostAgree:0},initial:function(t,e,i){t=t||window.UE,e=e||window.EditorUI;this.initPlugin(t,this),this.initLayer(e,this),this.initModel(e,this),this.initAdapter(t,e,this),this._options=$.extend({},this._options,i),this.postManager=this.requireInstance("poster/widget/post_manager"),this.initEditorReady(),this.initPostDataProcess(),this.initPostValidate(),this.initPostSuccess()},initPlugin:function(){},initLayer:function(t,e){t.registerLayer("paypost",function(t,i){var a='<div style="padding:10px;">\u54a6\uff0c\u6b64\u529f\u80fd\u9700\u8981\u62e5\u6709\u672c\u54276\u7ea7\u5934\u8854\u624d\u80fd\u4f7f\u7528\uff0c\u518d\u52aa\u529b\u4e00\u4e0b\uff01&nbsp;<a href="//tieba.baidu.com/f/like/level?kw=#{name}&ie=utf-8#level_main" target="_blank">\u67e5\u770b\u5347\u7ea7\u79d8\u7c4d</a></div>',n=!1;t.bind("show",function(){if(i.user.level>=6){var t=e.requireInstance("encourage-payment/widget/tbean_safe_ajax",{mobileMsg:"\u7ed1\u5b9a\u624b\u673a\u662f\u76ee\u524d\u6700\u7b80\u5355\u6709\u6548\u964d\u4f4e\u8d26\u53f7\u88ab\u76d7\u98ce\u9669\u7684\u65b9\u6cd5~\u7ed1\u5b9a\u540e\u5373\u53ef\u4f7f\u7528\u201c\u4ed8\u8d39\u53ef\u89c1\u201d\u529f\u80fd"});t.post("/diamond/paypost/verify",{tbs:i.tbs,forum_id:i.forum.id},function(t){0==t.errno&&o()})}});var o=function(){var t=e.requireInstance("encourage-thread/widget/paypost_data"),i=t.getInstance().get("isPaypost"),a=e.requireInstance("encourage-thread/widget/paypost_editor",{isInitialed:n});i||n||(n=!0),(i=!i)?a.showEditor():a.hiddenEditor()};if(i.user.level<6){var r=$.eduipopup().on("beforeshow",function(){var t=r.edui().getBodyContainer();t.html($.tb.format(a,i.forum))});t.setWidget(r)}})},initModel:function(t){t.registerModel("paypost",function(e,i){var a=new t.EditorModel;t.bindLayer("paypost",a);var n=$.eduibutton({icon:"paypost",title:"\u4ed8\u8d39\u53ef\u89c1"});return"frs"===e.product&&i.paypost||n.hide(),a.setButton(n),a})},initAdapter:function(t,e){t.registerUI("paypost",function(t){var i=this,a=e.getModel(t),n=a.getButton(),o=a.getWidget();return n.click(function(){a.trigger("show"),o&&(o.parent().length||i.$container.find(".edui-dialog-container").append(o),o.css("zIndex",i.options.zIndex+1).edui().show(n,{offsetTop:-10,caretLeft:20,caretTop:-8})),$.stats.track("paypost_btn","ueditor")}),n.edui().register("click",n,function(){o&&o.hide()}),n})},initEditorReady:function(){var t=this;this.postManager.addEditorReady(function(e){var i=(e.editor||{},e.context||{},e.poster||{});if(i&&i.$root){var a=i.$root.find(".j_draft"),n=a.children(".j_clear"),o=t.requireInstance("encourage-thread/widget/paypost_data").getInstance();n.on("click",function(){o.get("isPaypost")&&(t.feeEditor=t.feeEditor||UE.getEditor("ueditor_fee_replace"),t.feeEditor.setContent(""),t.feeEditor.clearDraft())})}})},initPostDataProcess:function(){var t=this;this.postManager.addPostDataProcess(function(e){var i=e.editorExtendContent||{},a={},n=t.requireInstance("encourage-thread/widget/paypost_data").getInstance();if(n.get("isPaypost")){var o=t.feeEditor||UE.getEditor("ueditor_fee_replace");a.is_paypost=1,a.secret=o.getContentUbb(),a.score=$(o.container).find(".j_paypost_tdou_ipt").val();var r=o.getExtendContent();if(r.attachments){var s=JSON.parse(r.attachments);a.files=JSON.stringify(JSON.parse(i.attachments).concat(s)),a.secret_files=JSON.stringify(_.pluck(s,"fs_id"))}}return 1===t._options.isPaypost&&(a.is_paypost=1),a})},initPostValidate:function(){var t=this;this.postManager.addPostValidate(function(e){var i=(e.context||{},e.editorExtendContent||{},e.poster||{}),a=t.requireInstance("encourage-thread/widget/paypost_data").getInstance();if(a.get("isPaypost")){t.feeEditor=t.feeEditor||UE.getEditor("ueditor_fee_replace");var n=$(t.feeEditor.container),o=n.find(".j_paypost_tdou_ipt").val();if(100>o)return"\u9690\u85cf\u5185\u5bb9\u552e\u4ef7\u987b\u81f3\u5c11100T\u8c46";if(o>1e7)return"\u9690\u85cf\u5185\u5bb9\u552e\u4ef7\u4e0d\u5f97\u9ad8\u4e8e10000000T\u8c46";var r=t.feeEditor.getExtendContent();if(0==$.trim(t.feeEditor.getContent()).length&&"[]"==r.attachments)return"\u4ed8\u8d39\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a";if(t._options.needPaypostAgree&&!a.get("hasAgree")){var s=t.requireInstance("encourage-thread/widget/paypost_agree_dialog");return s.registNextFn(i.post,i),s.show(),""}}return!0})},initPostSuccess:function(){var t=this;this.postManager.addPostSuccess(function(){var e=t.requireInstance("encourage-thread/widget/paypost_data").getInstance();e.get("isPaypost")&&(t.feeEditor&&t.feeEditor.setContent(""),t.feeEditor&&t.feeEditor.clearDraft())})}}});