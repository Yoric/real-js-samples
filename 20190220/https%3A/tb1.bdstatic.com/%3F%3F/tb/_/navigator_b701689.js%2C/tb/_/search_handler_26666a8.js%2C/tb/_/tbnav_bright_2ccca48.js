_.Module.define({path:"navigation/widget/navigator",sub:{initial:function(t,i){this.support=!!(window.history&&window.history.pushState&&i),this.initialEvent(t)},initialEvent:function(t){var i=this,n=this.initialTabLocker(!1);$(".j_nav_list").on("click","a.j_nav_local_tab_link",function(){var t=this;if(i.support){if(!n.isLock()){n.lock();var o=$.tb.unescapeHTML($(t).tbattr("href"));Bigpipe.broadcast("router_handle",{url:o})}return!1}}),t.on("tab_change_finish",function(t){n.unlock();var i=t.tab||"main",o=$("#tb_nav"),a=o.find(".j_tbnav_tab[data-tab-"+i+"]");o.find(".j_tbnav_tab.focus").removeClass("focus"),a.length>0?a.addClass("focus"):void 0})},initialTabLocker:function(t,i){var n=!1,i=i||100,o=null,a=function(t){n=!!t};return a.prototype.isLock=function(){return n},a.prototype.lock=function(){var t=this;return n=!0,o&&clearTimeout(o),o=setTimeout(function(){t.unlock()},i),this},a.prototype.unlock=function(){return n=!1,this},new a}}});_.Module.define({path:"navigation/widget/search_handler",sub:{_staticUrl:{no_key:"//tieba.baidu.com/","\u8d34\u5427\u6295\u8bc9":"//tieba.baidu.com/tousu/new","\u5e16\u5427\u6295\u8bc9":"//tieba.baidu.com/tousu/new",tiebatousu:"//tieba.baidu.com/tousu/new","\u8d34\u5427\u6295\u8bc9\u5427":"//tieba.baidu.com/tousu/new","\u8d34\u5427\u6295\u8bc9\u4e2d\u5fc3":"//tieba.baidu.com/tousu/new","\u6295\u8bc9\u4e2d\u5fc3":"//tieba.baidu.com/tousu/new","\u6295\u8bc9":"//tieba.baidu.com/tousu/new","\u8d34\u5427\u4e3e\u62a5":"//tieba.baidu.com/tousu/new","\u77e5\u9053\u6295\u8bc9":"http://tousu.baidu.com/zhidao","\u7a7a\u95f4\u6295\u8bc9":"http://tousu.baidu.com/hi","\u767e\u79d1\u6295\u8bc9":"http://tousu.baidu.com/baike",zhidaotousu:"http://tousu.baidu.com/zhidao",kongjiantousu:"http://tousu.baidu.com/hi",baiketousu:"http://tousu.baidu.com/baike"},_sendStatistics:function(t){$.stats.sendRequest("st_mod=search&search_type="+t)},initial:function(){},toStaticUrl:function(t){var e=t.toLowerCase();return this._staticUrl.hasOwnProperty(e)?($.tb.location.setHref(this._staticUrl[e]),!1):void 0},enterBa:function(t,e){if(""==t)return $.tb.location.setHref(this._staticUrl.no_key),!1;this.toStaticUrl(t);var s=[];if(s=-1!=t.indexOf("\uff1a")?t.split("\uff1a"):t.split(":"),2==s.length){if("\u6807\u7b7e"==s[0])return this._sendStatistics("tagsearch",t),$.tb.location.setHref("/f/search/fm?ie=utf-8&tag="+encodeURIComponent($.tb.escapeHTML(s[1]))),!1;if(-1!=s[0].indexOf("\u5427\u5185")){var o=s[0].split("\u5427\u5185")[0];if(o)return this._sendStatistics("baneisearch",t),$.tb.location.setHref("/f/search/res?ie=utf-8&kw="+encodeURIComponent($.tb.escapeHTML(o))+"&qw="+encodeURIComponent($.tb.escapeHTML(s[1]))),!1}}if(PageData.search_what&&"fromBtn"!=e){if("composite"==PageData.search_what)return this._sendStatistics("compositesearch",t),$.tb.location.setHref("/f/search/res?ie=utf-8&qw="+encodeURIComponent($.tb.escapeHTML(t))),!1;if("forum"==PageData.search_what)return this._sendStatistics("forumsearch",t),$.tb.location.setHref("/f/search/fm?ie=utf-8&qw="+encodeURIComponent($.tb.escapeHTML(t))),!1}return this._sendStatistics("enterba&from=search",t),$.tb.location.setHref("/f?ie=utf-8&kw="+encodeURIComponent(t)+"&fr=search"),!1},searchPost:function(t){return window.history_search_post||(PageData.user.is_login&&$.tb.post("/f/search/addWord",{word:$.tb.escapeHTML(t)},function(t){0==t.no&&(window.history_search_post=!1)}),window.history_search_post=!0),this._sendStatistics("postsearch",t),setTimeout(function(){$.tb.location.setHref("/f/search/res?ie=utf-8&qw="+encodeURIComponent($.tb.escapeHTML(t)))},100),!1},searchPostInBa:function(t,e){var s="/f/search/res?ie=utf-8&kw="+encodeURIComponent($.tb.escapeHTML(e))+"&qw="+encodeURIComponent($.tb.escapeHTML(t));return window.history_search_post||(PageData.user.is_login&&$.tb.post("/f/search/addWord",{word:$.tb.escapeHTML(t)},function(t){0==t.no&&(window.history_search_post=!1)}),window.history_search_post=!0),this._sendStatistics("baneisearch",t),setTimeout(function(){$.tb.location.setHref(s)},100),!1},searchPeople:function(t){return this._sendStatistics("peoplesearch",t),$.tb.location.setHref("/f/search/sure?ie=utf-8&only_user=1&qw="+encodeURIComponent($.tb.escapeHTML(t))),!1},searchTag:function(t){return this._sendStatistics("tagsearch",t),$.tb.location.setHref("/f/search/fm?ie=utf-8&tag="+encodeURIComponent($.tb.escapeHTML(t))),!1},searchForum:function(t){var e="/f/search/fm?ie=UTF-8&";return-1!=t.indexOf("\u6807\u7b7e\uff1a")?(t=t.substr(t.indexOf("\u6807\u7b7e\uff1a")+3),e=e+"tag="+encodeURIComponent($.tb.escapeHTML(t))):-1!=t.indexOf("\u6807\u7b7e:")?(t=t.substr(t.indexOf("\u6807\u7b7e:")+3),e=e+"tag="+encodeURIComponent($.tb.escapeHTML(t))):e=e+"qw="+encodeURIComponent($.tb.escapeHTML(t)),$.tb.location.setHref(e),!1}}});_.Module.define({path:"navigation/widget/tbnav_bright/tbnav_search",requires:["navigation/widget/search_handler"],sub:{_searchHandler:null,_jq_wrap:null,_jq_input:null,_options:{forumName:""},initial:function(t,i){var n=this;this._searchHandler=this.requireInstance("navigation/widget/search_handler"),this._jq_wrap=t,this._jq_input=t.find(".j_search_internal_input"),this._options=$.extend(this._options,i),this._jq_wrap.submit(function(){return n._searchInternal(),!1}),this._initPlaceHolder()},_addJump:function(){$(".qiangzuo_trigger").length>0&&$(".qiangzuo_trigger").on("click",function(){window.open("/game/worldcup/index")})},_searchInternal:function(){var t=this._getSearchWord();this._searchHandler.searchPostInBa(t,this._options.forumName)},_getSearchWord:function(){return this._jq_input.val()},_initPlaceHolder:function(){var t=this,i=this._jq_wrap.find(".j_search_internal_placeholder"),n=this._jq_input;""!=t._getSearchWord()&&i.hide(),n.focus(function(){i.hide()}).blur(function(){""==t._getSearchWord()&&i.show()}),i.click(function(){n.focus()})}}}),_.Module.define({path:"navigation/widget/tbnav_bright",requires:["navigation/widget/tbnav_bright/tbnav_search"],sub:{_jq_wrap:null,_nav_wrap:null,promotion_tmp:['<div id="activity_nav_promotion_enter">','<a href="#{link}" target="_blank">','<img src="#{img}">',"</a>","</div>"].join(""),initial:function(t,i,n){this._jq_wrap=t,this._nav_wrap=$("#tb_nav"),this.requireInstance("navigation/widget/tbnav_bright/tbnav_search",[i.jq_search,i]),this._bindNavDropDownList(),this._initStats(),this._initWanleTip(),n=n||{},this._initPromotionEnter(n.promotion_setting)},_bindNavDropDownList:function(){var t=this;this._nav_wrap.find(".j_tbnav_list").on("mouseenter",function(i){i.preventDefault();var n=$(i.currentTarget);n.addClass("nav_list_over"),t._nav_wrap.find(".j_nav_list").css("overflow","visible"),$("#star_class_nav").css("overflow","visible")}).on("mouseleave",function(t){t.preventDefault();var i=$(t.currentTarget);i.removeClass("nav_list_over")})},_initPromotionEnter:function(t){var i=$.getPageData("0.0",0,t),n=$.getPageData("1.0",0,t);if(!n||!i)return!1;var a=i.replace(/[\/,:,.,-]/g,"").substr(-30);if(1==$.tb.Storage.get("tbnavHideBarrageEnter_"+a))return!1;var e=$.tb.format(this.promotion_tmp,{link:n,img:i}),r=$(e);this._nav_wrap.find(".j_nav_list").append(r),$("#star_class_nav").append(r),$.stats.track("\u5bfc\u822a\u680f\u5c55\u793a","\u5206\u53d1\u5bfc\u822a\u680f\u63a8\u5e7f\u4f4d","","view"),r.on("click",function(){$.stats.track("\u5bfc\u822a\u680f\u8df3\u8f6c","\u5206\u53d1\u5bfc\u822a\u680f\u63a8\u5e7f\u4f4d","","click"),$.tb.Storage.set("tbnavHideBarrageEnter_"+a,1)})},_initStats:function(){var t=this._nav_wrap.find(".j_nav_list"),i="\u5bfc\u822a\u680ftab\u7edf\u8ba1";t.find("a").on("click",function(){var t=$(this).text().split("\uff08")[0];$.stats.track(t,i)})},_initWanleTip:function(){var t=PageUnit.load("tbnav_bright_wanle_type");if(1!=t)return!1;var i=new Date,n=i.getTime(),a=new Date(i.getTime()+864e5-1e3*(60*i.getHours()*60+60*i.getMinutes()+i.getSeconds())),e=$.cookie("wanleTipCircle");if(e){if(n>e+1728e5)return $.cookie("wanleTipCircle",0),void 0;if(0==e)return}else $.cookie("wanleTipCircle",n);var r=this._nav_wrap.find("#j_navtab_wanle");if(r.on("click",function(){$.stats.track("tab\u5bfc\u6d41","\u8d34\u5427PC\u76d6\u697c\u6d3b\u52a8","","click"),s.hide(),$.cookie("wanleTipHide",1,{expires:a})}),1!=$.cookie("wanleTipHide")){var o=['<div class="wanle_tab_tip">','<a class="jump_tip" href="/f?ie=utf-8&kw='+encodeURIComponent("\u4e50\u6b64\u4e0d\u75b2")+'" target="_self"></a>','<a class="close_tip" href="#" onclick="return false;"></a>',"</div>"].join(""),s=$(o);r.closest(".space").append(s),s.on("click","a",function(){s.hide(),$.cookie("wanleTipHide",1,{expires:a})}),s.on("click",".jump_tip",function(){$.stats.track("tab\u5bfc\u6d41","\u8d34\u5427PC\u76d6\u697c\u6d3b\u52a8","","click")})}}}});