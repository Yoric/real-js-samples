!function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=23)}([function(t,e,i){"use strict";var n=i(4);t.exports=function(t){if(!n(t))throw new TypeError("Cannot use null or undefined");return t}},function(t,e,i){"use strict";t.exports=function(t){if("function"!=typeof t)throw new TypeError(t+" is not a function");return t}},function(t,e,i){"use strict";t.exports=i(65)()?Symbol:i(67)},function(t,e,i){"use strict";var n,r=i(8),o=i(13),a=i(46),s=i(16);n=t.exports=function(t,e){var i,n,a,l,c;return arguments.length<2||"string"!=typeof t?(l=e,e=t,t=null):l=arguments[2],null==t?(i=a=!0,n=!1):(i=s.call(t,"c"),n=s.call(t,"e"),a=s.call(t,"w")),c={value:e,configurable:i,enumerable:n,writable:a},l?r(o(l),c):c},n.gs=function(t,e,i){var n,l,c,u;return"string"!=typeof t?(c=i,i=e,e=t,t=null):c=arguments[3],null==e?e=void 0:a(e)?null==i?i=void 0:a(i)||(c=i,i=void 0):(c=e,e=i=void 0),null==t?(n=!0,l=!1):(n=s.call(t,"c"),l=s.call(t,"e")),u={get:e,set:i,configurable:n,enumerable:l},c?r(o(c),u):u}},function(t,e,i){"use strict";var n=i(11)();t.exports=function(t){return t!==n&&null!==t}},function(t,e,i){"use strict";var n=Object.prototype.toString,r=n.call(function(){return arguments}());t.exports=function(t){return n.call(t)===r}},function(t,e,i){"use strict";t.exports=i(14)()?Object.setPrototypeOf:i(15)},function(t,e,i){"use strict";var n=Object.prototype.toString,r=n.call("");t.exports=function(t){return"string"==typeof t||t&&"object"==typeof t&&(t instanceof String||n.call(t)===r)||!1}},function(t,e,i){"use strict";t.exports=i(41)()?Object.assign:i(42)},function(t,e,i){"use strict";var n,r=i(10),o=i(8),a=i(1),s=i(0),l=i(3),c=i(27),u=i(2),h=Object.defineProperty,f=Object.defineProperties;t.exports=n=function(t,e){if(!(this instanceof n))throw new TypeError("Constructor requires 'new'");f(this,{__list__:l("w",s(t)),__context__:l("w",e),__nextIndex__:l("w",0)}),e&&(a(e.on),e.on("_add",this._onAdd),e.on("_delete",this._onDelete),e.on("_clear",this._onClear))},delete n.prototype.constructor,f(n.prototype,o({_next:l(function(){var t;if(this.__list__)return this.__redo__&&void 0!==(t=this.__redo__.shift())?t:this.__nextIndex__<this.__list__.length?this.__nextIndex__++:void this._unBind()}),next:l(function(){return this._createResult(this._next())}),_createResult:l(function(t){return void 0===t?{done:!0,value:void 0}:{done:!1,value:this._resolve(t)}}),_resolve:l(function(t){return this.__list__[t]}),_unBind:l(function(){this.__list__=null,delete this.__redo__,this.__context__&&(this.__context__.off("_add",this._onAdd),this.__context__.off("_delete",this._onDelete),this.__context__.off("_clear",this._onClear),this.__context__=null)}),toString:l(function(){return"[object "+(this[u.toStringTag]||"Object")+"]"})},c({_onAdd:l(function(t){if(!(t>=this.__nextIndex__)){if(++this.__nextIndex__,!this.__redo__)return void h(this,"__redo__",l("c",[t]));this.__redo__.forEach(function(e,i){e>=t&&(this.__redo__[i]=++e)},this),this.__redo__.push(t)}}),_onDelete:l(function(t){var e;t>=this.__nextIndex__||(--this.__nextIndex__,this.__redo__&&(e=this.__redo__.indexOf(t),-1!==e&&this.__redo__.splice(e,1),this.__redo__.forEach(function(e,i){e>t&&(this.__redo__[i]=--e)},this)))}),_onClear:l(function(){this.__redo__&&r.call(this.__redo__),this.__nextIndex__=0})}))),h(n.prototype,u.iterator,l(function(){return this}))},function(t,e,i){"use strict";var n=i(0);t.exports=function(){return n(this).length=0,this}},function(t,e,i){"use strict";t.exports=function(){}},function(t,e,i){"use strict";var n=i(39),r=Math.max;t.exports=function(t){return r(0,n(t))}},function(t,e,i){"use strict";var n=i(4),r=Array.prototype.forEach,o=Object.create,a=function(t,e){var i;for(i in t)e[i]=t[i]};t.exports=function(t){var e=o(null);return r.call(arguments,function(t){n(t)&&a(Object(t),e)}),e}},function(t,e,i){"use strict";var n=Object.create,r=Object.getPrototypeOf,o={};t.exports=function(){var t=Object.setPrototypeOf,e=arguments[0]||n;return"function"==typeof t&&r(t(e(null),o))===o}},function(t,e,i){"use strict";var n,r=i(47),o=i(0),a=Object.prototype.isPrototypeOf,s=Object.defineProperty,l={configurable:!0,enumerable:!1,writable:!0,value:void 0};n=function(t,e){if(o(t),null===e||r(e))return t;throw new TypeError("Prototype must be null or an object")},t.exports=function(t){var e,i;return t?(2===t.level?t.set?(i=t.set,e=function(t,e){return i.call(n(t,e),e),t}):e=function(t,e){return n(t,e).__proto__=e,t}:e=function t(e,i){var r;return n(e,i),r=a.call(t.nullPolyfill,e),r&&delete t.nullPolyfill.__proto__,null===i&&(i=t.nullPolyfill),e.__proto__=i,r&&s(t.nullPolyfill,"__proto__",l),e},Object.defineProperty(e,"level",{configurable:!1,enumerable:!1,writable:!1,value:t.level})):null}(function(){var t,e=Object.create(null),i={},n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__");if(n){try{t=n.set,t.call(e,i)}catch(t){}if(Object.getPrototypeOf(e)===i)return{set:t,level:2}}return e.__proto__=i,Object.getPrototypeOf(e)===i?{level:2}:(e={},e.__proto__=i,Object.getPrototypeOf(e)===i&&{level:1})}()),i(44)},function(t,e,i){"use strict";t.exports=i(53)()?String.prototype.contains:i(54)},function(t,e,i){"use strict";var n=i(58);t.exports=function(t){if(!n(t))throw new TypeError(t+" is not iterable");return t}},function(t,e,i){"use strict";function n(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function r(){}var o=Object.prototype.hasOwnProperty,a="function"!=typeof Object.create&&"~";r.prototype._events=void 0,r.prototype.eventNames=function(){var t,e=this._events,i=[];if(!e)return i;for(t in e)o.call(e,t)&&i.push(a?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},r.prototype.listeners=function(t,e){var i=a?a+t:t,n=this._events&&this._events[i];if(e)return!!n;if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,s=new Array(o);r<o;r++)s[r]=n[r].fn;return s},r.prototype.emit=function(t,e,i,n,r,o){var s=a?a+t:t;if(!this._events||!this._events[s])return!1;var l,c,u=this._events[s],h=arguments.length;if("function"==typeof u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,i),!0;case 4:return u.fn.call(u.context,e,i,n),!0;case 5:return u.fn.call(u.context,e,i,n,r),!0;case 6:return u.fn.call(u.context,e,i,n,r,o),!0}for(c=1,l=new Array(h-1);c<h;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var f,d=u.length;for(c=0;c<d;c++)switch(u[c].once&&this.removeListener(t,u[c].fn,void 0,!0),h){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,e);break;case 3:u[c].fn.call(u[c].context,e,i);break;default:if(!l)for(f=1,l=new Array(h-1);f<h;f++)l[f-1]=arguments[f];u[c].fn.apply(u[c].context,l)}}return!0},r.prototype.on=function(t,e,i){var r=new n(e,i||this),o=a?a+t:t;return this._events||(this._events=a?{}:Object.create(null)),this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],r]:this._events[o].push(r):this._events[o]=r,this},r.prototype.once=function(t,e,i){var r=new n(e,i||this,!0),o=a?a+t:t;return this._events||(this._events=a?{}:Object.create(null)),this._events[o]?this._events[o].fn?this._events[o]=[this._events[o],r]:this._events[o].push(r):this._events[o]=r,this},r.prototype.removeListener=function(t,e,i,n){var r=a?a+t:t;if(!this._events||!this._events[r])return this;var o=this._events[r],s=[];if(e)if(o.fn)(o.fn!==e||n&&!o.once||i&&o.context!==i)&&s.push(o);else for(var l=0,c=o.length;l<c;l++)(o[l].fn!==e||n&&!o[l].once||i&&o[l].context!==i)&&s.push(o[l]);return s.length?this._events[r]=1===s.length?s[0]:s:delete this._events[r],this},r.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[a?a+t:t]:this._events=a?{}:Object.create(null),this):this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prototype.setMaxListeners=function(){return this},r.prefixed=a,t.exports=r},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=i(26),c=n(l),u=i(25),h=n(u),f=i(18),d=function(t){function e(i){r(this,e);var n=o(this,t.call(this));return n.model=new h.default,n.model.option=i,n.loadXML(i),n}return a(e,t),s(e,null,[{key:"COMPLETE_PARSING",get:function(){return"completeParsing"}},{key:"ERROR_PARSING",get:function(){return"errorParsing"}}]),e.prototype.loadXML=function(t){var i=this;new c.default(t.xml+"?cors=storyphotoview_canvas").loadDoc().then(function(t){i.generateData(t)}).catch(function(t){var n=document.createElement("canvas");n.width=10,n.height=10,i.model.option.container.appendChild(n),i.emit(e.ERROR_PARSING)})},e.prototype.generateData=function(t){var i=t;this.clean(i),this.type=this.getType(i),this.type>3?(this.getModuleData(i),this.getImgData(i)):(this.getOldModuleData(i),this.getOldImgData(i)),7!=this.type&&3!=this.type&&this.getImgViewData(),this.setModelData(),this.emit(e.COMPLETE_PARSING,this.model)},e.prototype.getType=function(t){var e=t.childNodes[0].children[1].getAttribute("type")||t.childNodes[0].children[2].getAttribute("type");return Number(e)},e.prototype.getModuleData=function(t){var e=[],i=[],n=void 0,r=t.childNodes[0].children[1];if(7==this.type)return e.push({viewerWidth:r.children[2].childNodes[0].nodeValue,viewerHeight:3*r.children[2].childNodes[0].nodeValue/4,slideInterval:r.children[5].childNodes[0].nodeValue}),void(this.moduleData=e);var o=5;switch(this.type){case 5:case 6:o=4}var a=t.childNodes[0].children[1].children[o],s=a.children.length,l=this.setColAndRow(Number(r.children[1].childNodes[0].nodeValue),Number(r.children[0].childNodes[0].nodeValue));e.push({row:l.row,column:l.col,viewerWidth:r.children[2].childNodes[0].nodeValue,viewerHeight:Math.ceil(3*r.children[2].childNodes[0].nodeValue/4),tileGap:"tileGap"==r.children[3].nodeName?r.children[3].childNodes[0].nodeValue:5});for(var c=0;c<s;c++)n=new Map,a.children[0].hasAttribute("colSpan")&&(n.set("colSpan",a.children[c].getAttribute("colSpan")),n.set("rowSpan",a.children[c].getAttribute("rowSpan")),n.set("parentX",a.children[c].getAttribute("parentX")||null),n.set("parentY",a.children[c].getAttribute("parentY")||null)),t.childNodes[0].children[1].children[o].children[c].hasChildNodes()&&(n.set("isRescale",t.childNodes[0].children[1].children[o].children[c].children[0].getAttribute("isRescale")),n.set("matrix",[a.children[c].children[0].children[0].getAttribute("a"),a.children[c].children[0].children[0].getAttribute("b"),a.children[c].children[0].children[0].getAttribute("c"),a.children[c].children[0].children[0].getAttribute("d"),a.children[c].children[0].children[0].getAttribute("tx"),a.children[c].children[0].children[0].getAttribute("ty")]),n.set("seqID",a.children[c].children[0].children[1].childNodes[0].nodeValue),n.set("imageID",a.children[c].children[0].children[2].childNodes[0].nodeValue),n.set("cellIndex",c)),5==this.type&&n.set("rotation",a.children[c].getAttribute("rotation")),i.push(n);this.moduleData=e,this.cellData=i},e.prototype.getOldModuleData=function(t){var e=[],i=[],n=void 0;if("3"==this.type)return e.push({viewerWidth:this.model.option.viewWidth,viewerHeight:Math.ceil(.8*this.model.option.viewWidth),slideInterval:t.childNodes[0].children[2].children[0].children[3].childNodes[0].nodeValue}),void(this.moduleData=e);var r=void 0,o=void 0;if("0"==this.type)this.cellData=i,this.oldTemplateCheck(t),e.push({row:t.childNodes[0].children[2].children[0].children[1].childNodes[0].nodeValue,column:t.childNodes[0].children[2].children[0].children[0].childNodes[0].nodeValue,tileGap:t.childNodes[0].children[2].children[0].children[2].childNodes[0].nodeValue,viewerWidth:this.model.option.viewWidth,viewerHeight:Math.ceil(.8*this.model.option.viewWidth)});else if("1"==this.type){r=t.childNodes[0].children[2].children[0].children[5],o=r.children.length,e.push({row:t.childNodes[0].children[2].children[0].children[2].childNodes[0].nodeValue,column:t.childNodes[0].children[2].children[0].children[1].childNodes[0].nodeValue,tileGap:5,viewerWidth:this.model.option.viewWidth,viewerHeight:Math.ceil(.8*this.model.option.viewWidth)}),this.cellLength=e[0].row*e[0].column;for(var a=0;a<this.cellLength;a++)n=new Map,n.set("cellIndex",a),i.push(n);this.cellData=i;for(var s=0;s<o;s++){var l=r.children[s].getAttribute("boxNo");this.cellData[l].set("index",r.children[s].getAttribute("index"))}}else if("2"==this.type){o=t.childNodes[0].children[0].children.length;var c=this.setColAndRow(o,0);e.push({row:c.row,column:c.col,tileGap:5,viewerWidth:this.model.option.viewWidth,viewerHeight:Math.ceil(.8*this.model.option.viewWidth)});for(var u=0;u<o;u++)n=new Map,n.set("cellIndex",u),i.push(n)}this.moduleData=e,this.cellData=i},e.prototype.getImgData=function(t){var e=[],i=void 0;if(7==this.type){for(var n=t.childNodes[0].children[0].children.length,r=0;r<n;r++)i=new Map,i.set("imgSrc",t.childNodes[0].children[0].children[r].children[4].childNodes[0].nodeValue),e.push(i);return void(this.imgData=e)}var o=5;switch(this.type){case 5:case 6:o=4}for(var a=t.childNodes[0].children[1].children[o].children.length,s=t.childNodes[0].children[0].children.length,l=void 0,c=void 0,u=0;u<s;u++)i=new Map,i.set("imageID",t.childNodes[0].children[0].children[u].children[0].childNodes[0].nodeValue),i.set("order",t.childNodes[0].children[0].children[u].children[1].childNodes[0].nodeValue),i.set("URI",t.childNodes[0].children[0].children[u].children[4].childNodes[0].nodeValue),i.set("isOld",!1),e.push(i);for(var h=0;h<a;h++)if(this.cellData[h].has("imageID")){for(var f=this.cellData[h].get("imageID"),d=0;d<e.length;d++)if(e[d].get("imageID")==f){c=d;break}if(this.cellData[h].has("seqID")){var p=t.childNodes[0].children[0].children[c].children[4].childNodes[0].nodeValue,A=p;if(6==this.type){l=p;var g=this.model.option.imgPrefix+l+"&cors=storyphotoview_canvas",_=this.checkUrl(g);_||(p=p.split("/"),p.pop(),l=p.join("/")+"/0?storyphoto="+this.cellData[h].get("seqID"))}else p=p.split("/"),p.pop(),l=p.join("/")+"/0?storyphoto="+this.cellData[h].get("seqID");this.cellData[h].set("imgSrc",l),this.cellData[h].set("imgOriginalSrc",A)}}},e.prototype.checkUrl=function(t){var e=!1;return window.XMLHttpRequest?e=new XMLHttpRequest:window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHttp")),!(!e||(e.open("GET",t),200!=e.status))},e.prototype.getOldImgData=function(t){var e=[],i=void 0;if(3==this.type){for(var n=t.childNodes[0].children[0].children.length,r=0;r<n;r++)i=new Map,i.set("imgSrc",t.childNodes[0].children[0].childNodes[r].childNodes[0].nodeValue),e.push(i);return void(this.imgData=e)}if(2!=this.type){if(1==this.type){for(var o=t.childNodes[0].children[0].children.length,a=0;a<o;a++)i=new Map,i.set("idx",t.childNodes[0].children[0].childNodes[a].getAttribute("idx")),i.set("URI",t.childNodes[0].children[0].childNodes[a].childNodes[0].nodeValue),i.set("isOld",!0),e.push(i);for(var s=void 0,l=0;l<this.cellLength;l++)if(this.cellData[l].has("index")){for(var c=this.cellData[l].get("index"),u=0;u<e.length;u++)if(e[u].get("idx")==c){s=u;break}this.cellData[l].set("imgSrc",e[s].get("URI"))}}if(0==this.type){for(var h=t.childNodes[0].children[0].children.length,f=0;f<h;f++)i=new Map,i.set("idx",t.childNodes[0].children[0].childNodes[f].getAttribute("idx")),i.set("URI",t.childNodes[0].children[0].childNodes[f].childNodes[0].nodeValue),i.set("isOld",!0),e.push(i);for(var d=void 0,p=0;p<this.cellLength;p++)if(this.cellData[p].has("index")){for(var A=this.cellData[p].get("index"),g=0;g<e.length;g++)if(e[g].get("idx")==A){d=g;break}this.cellData[p].set("imgSrc",e[d].get("URI"))}}}else for(var _=t.childNodes[0].children[0].children.length,m=0;m<_;m++)this.cellData[m].set("imgSrc",t.childNodes[0].children[0].childNodes[m].childNodes[0].nodeValue)},e.prototype.getImgViewData=function(){this.setViewPosition();for(var t=Number(this.moduleData[0].column),e=Number(this.moduleData[0].row),i=Number(this.moduleData[0].tileGap),n=this.posX,r=this.posY,o=this.tw,a=this.th,s=1,l=1,c=void 0,u=void 0,h=[],f=0;f<t*e;f++){if(c=f%t,u=Math.floor(f/t),"4"==this.type&&this.cellData[f]&&this.cellData[f].has("colSpan")){if(s=this.cellData[f].get("colSpan"),l=this.cellData[f].get("rowSpan"),null!=this.cellData[f].get("parentX")&&(this.cellData[f].get("parentX")!=f%t||this.cellData[f].get("parentY")!=Math.floor(f/t)))continue}else if("0"==this.type){if(!(f<this.cellData.length))continue;s=this.cellData[f].get("colSpan"),l=this.cellData[f].get("rowSpan"),c=this.cellData[f].get("parentX"),u=this.cellData[f].get("parentY")}if(h[f]={x:n+(o+i)*c,y:r+(a+i)*u,w:o*s+i*(s-1),h:a*l+i*(l-1)},f>=this.cellData.length){var d=new Map;d.set("cellInfo",h[f]),this.cellData.push(d)}else this.cellData[f].set("cellInfo",h[f])}},e.prototype.setColAndRow=function(t,e){var i=void 0,n=void 0,r=void 0;switch(this.type){case 4:case 5:i=t,n=e;break;case 2:case 6:i=t,n=e,r=t+e,9==r?(i=3,n=3):10==r?(i=5,n=2):11==r||12==r?(i=6,n=2):13==r||14==r?(i=7,n=2):15!=r&&16!=r||(i=4,n=4)}return{col:i,row:n}},e.prototype.setViewPosition=function(){var t=this.moduleData[0].viewerWidth,e=void 0==this.moduleData[0].viewerHeight?Math.ceil(3*t/4):this.moduleData[0].viewerHeight,i=this.moduleData[0].column,n=this.moduleData[0].row,r=Number(this.moduleData[0].tileGap),o=void 0,a=void 0;i/n>=4/3?(o=Math.floor((t-(i-1)*r)/i),a=o):(a=Math.floor((e-(n-1)*r)/n),o=a),this.tw=o,this.th=a,this.posX=(t-(i*o+(i-1)*r))/2,this.posY=(e-(n*a+(n-1)*r))/2},e.prototype.oldTemplateCheck=function(t){for(var e=t.childNodes[0].children[2].children[0].children[5],i=e.children.length,n=void 0,r=[],o=void 0,a=[],s=void 0,l=0;l<i;l++)n=e.children[l].childNodes[0].nodeValue,n=n.split("|"),r.push.apply(r,n);o=n.length;var c=0;r.forEach(function(t,e){r[e]=Number(r[e]),c<r[e]&&(c=r[e])}),this.cellLength=c+1;for(var u=void 0,h=t.childNodes[0].children[2].children[0].children[6],f=0;f<this.cellLength;f++)u=new Map,u.set("cellIndex",f),this.cellData.push(u);for(var d=0;d<h.children.length;d++){var p=h.children[d].childNodes[0].nodeValue;this.cellData[p].set("index",h.children[d].getAttribute("index"))}for(var A=0;A<r.length;A++){s=new Map;for(var g=0;g<r.length;g++){var _=Math.floor(g/o),m=g%o;A==r[g]&&(s.set("index",A),s.has("x1")?(s.set("x2",m),s.set("y2",_)):(s.set("x1",m),s.set("y1",_)))}if(0!==s.size){var v=s.get("x1"),y=s.get("y1");if(s.has("x2")){var w=s.get("x2")-s.get("x1")+1,b=s.get("y2")-s.get("y1")+1;this.cellData[A].set("colSpan",w),this.cellData[A].set("rowSpan",b),this.cellData[A].set("parentX",v),this.cellData[A].set("parentY",y)}else this.cellData[A].set("colSpan",1),this.cellData[A].set("rowSpan",1),this.cellData[A].set("parentX",v),this.cellData[A].set("parentY",y);a.push(s)}}},e.prototype.setModelData=function(){if(7==this.type||3==this.type)return this.model.type=this.type,this.model.moduleData=this.moduleData,void(this.model.imgData=this.imgData);delete this.moduleData[0].column,delete this.moduleData[0].row,delete this.moduleData[0].tileGap,this.moduleData[0].viewerWidth=Number(this.moduleData[0].viewerWidth),this.cellData.forEach(function(t,e){t.delete("colSpan"),t.delete("rowSpan"),t.delete("parentX"),t.delete("parentY"),t.delete("imageID"),t.delete("seqID"),t.delete("index")}),this.model.type=this.type,this.model.moduleData=this.moduleData,this.model.cellData=this.cellData},e.prototype.dispose=function(){this.model=null},e.prototype.clean=function(t){for(var e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];8===i.nodeType||3===i.nodeType&&!/\S/.test(i.nodeValue)?(t.removeChild(i),e--):1===i.nodeType&&this.clean(i)}},e}(f);e.default=d,function(t){t&&t.prototype&&null==t.prototype.children&&Object.defineProperty(t.prototype,"children",{get:function(){for(var t,e=0,i=this.childNodes,n=[];t=i[e++];)1===t.nodeType&&n.push(t);return n}})}(window.Node||window.Element)},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=i(24),c=function(t){return t&&t.__esModule?t:{default:t}}(l),u=i(18),h=(i(70)(),function(t){function e(i,o){n(this,e);var a=r(this,t.call(this));return a.model=o,a.context=null,a.viewerWidth=a.model.moduleData[0].viewerWidth,a.viewerHeight=a.model.moduleData[0].viewerHeight,a.type=a.model.type,a.isOld=a.type<4,a.imgs=[],a.index=0,a.alpha=1,a.nextAlpha=0,a._isAni=!1,a.cellRescale=a.viewerWidth/550,a.model.loadingImage.src=c.default.LOADING_IMG,a.model.loadingImage.onload=function(t){a.drawCanvas(i)},a}return o(e,t),s(e,null,[{key:"COMPLETE_DRAWING",get:function(){return"completeDrawing"}}]),e.prototype.drawCanvas=function(t){var e=document.createElement("canvas");if(e.width=this.viewerWidth,e.height=this.viewerHeight,3!==this.type&&7!==this.type){var i=this.model,n=this.imgs;this.mouseEvent(e,i,n)}t.appendChild(e);var r=e.getContext("2d");this.context=r,this.loadAllImage()},e.prototype.dispose=function(){if(this.context){var t=this.context.canvas;t.parentNode.removeChild(t),cancelAnimationFrame(this._animateHandler),this._animateHandler=null,this.context=null,this.offCanvas=null,this.offCtx=null}},e.prototype.mouseEvent=function(t,e,i){function n(e,i){var n=t.getBoundingClientRect();return{x:e-n.left*(t.width/n.width),y:i-n.top*(t.height/n.height)}}for(var r=[],o=[],a=[],s=0;s<this.model.cellData.length;s++){var l=this.model.cellData[s];l.has("imgSrc")&&(r[s]=l.get("cellInfo"),a.push(l.get("cellIndex")),this.model.cellData[s].has("imgOriginalSrc")?o.push(this.model.option.imgPrefix+l.get("imgOriginalSrc")):o.push(this.model.option.imgPrefix+l.get("imgSrc")))}var c=void 0;t.onmousemove=function(e){c=n(e.clientX,e.clientY);for(var i=c.x,o=c.y,a=!1,s=0;s<r.length;s++)if(void 0!=r[s]){var l=r[s].x,u=r[s].y,h=r[s].w,f=r[s].h;if(i>l&&i<l+h&&o>u&&o<u+f){a=!0,this._i=s;break}this._i=null}t.style.cursor=1==a?"pointer":"default"},t.onmousedown=function(t){this.mousedown_i=this._i},t.onmouseup=function(t){if(this.mouseup_i=this._i,null!==this.mouseup_i&&null!==this.mousedown_i&&this.mouseup_i==this.mousedown_i){this.indexOfSelctedTile=this.mouseup_i;var e=a.indexOf(this.indexOfSelctedTile);viewSotryphotoOrigin(o,e)}}},e.prototype._oldImgLoad=function(){var t=this;if(3==this.type){var e,i=function(){var i=t.model.imgData.length,n=0,r=0;for(e=0;e<i;e++)c=new Image,c.onload=function(e){++n+r>=i&&t.drawView(t.type)},c.onerror=function(e){r++,n+r>=i&&t.drawView(t.type),n+r>=i&&t.drawView(t.type)},c.src=t.model.option.imgPrefix+t.model.imgData[e].get("imgSrc")+"?cors=storyphotoview_canvas",t.imgs.push(c);return{v:void 0}}();if("object"===(void 0===i?"undefined":a(i)))return i.v}for(var n=this.model.cellData.length,r=0,o=0,s=0,l=void 0,c=void 0,u=this.model.loadingImage.width,h=this.model.loadingImage.height,f=0;f<n;f++)this.model.cellData[f].has("cellInfo")&&(l=this.model.cellData[f].get("cellInfo"),this.context.save(),this.context.fillStyle="#F2F2F2",this.context.fillRect(l.x,l.y,l.w,l.h),this.context.restore(),this.model.cellData[f].has("imgSrc")&&(this.context.drawImage(this.model.loadingImage,l.x+(l.w-u)/2,l.y+(l.h-h)/2|0),++r));for(var d=0;d<n;d++)c=new Image,this.model.cellData[d].has("imgSrc")&&(c.onload=function(e){++o+s>=r&&t.drawView(t.type)},c.onerror=function(e){s++,o+s>=r&&t.drawView(t.type)},c.setAttribute("data-index",this.model.cellData[d].get("cellIndex")),c.src=this.model.option.imgPrefix+this.model.cellData[d].get("imgSrc")+"?cors=storyphotoview_canvas",this.model.cellData[d].set("image",c),this.imgs[d]=c);this.cellLength=n,this.itemLength=r},e.prototype._newImgLoad=function(){var t=this;if(7==this.type){var e,i=function(){var i=t.model.imgData.length,n=0;for(e=0;e<i;e++)c=new Image,c.onload=function(e){t.imgs.push(e.target),++n>=i&&t.drawView(t.type)},c.onerror=function(e){7==t.type&&n++},c.src=t.model.option.imgPrefix+t.model.imgData[e].get("imgSrc")+"?cors=storyphotoview_canvas";return{v:void 0}}();if("object"===(void 0===i?"undefined":a(i)))return i.v}for(var n=this.model.cellData.length,r=0,o=0,s=0,l=void 0,c=void 0,u=this.model.loadingImage.width,h=this.model.loadingImage.height,f=0;f<n;f++)this.model.cellData[f].has("cellInfo")&&(l=this.model.cellData[f].get("cellInfo"),this.context.save(),this.context.fillStyle="#F2F2F2",this.context.fillRect(l.x,l.y,l.w,l.h),this.context.restore(),this.model.cellData[f].has("imgSrc")&&(this.context.drawImage(this.model.loadingImage,l.x+(l.w-u)/2,l.y+(l.h-h)/2|0),++r));for(var d=0;d<n;d++)c=new Image,this.model.cellData[d].has("imgSrc")&&(c.onload=function(e){++o+s>=r&&t.drawView(t.type)},c.onerror=function(e){s++,o+s>=r&&t.drawView(t.type)},c.setAttribute("data-index",this.model.cellData[d].get("cellIndex")),c.src=this.model.option.imgPrefix+this.model.cellData[d].get("imgSrc")+"&cors=storyphotoview_canvas",this.model.cellData[d].set("image",c),this.imgs[d]=c);this.cellLength=n,this.itemLength=r},e.prototype.loadAllImage=function(){!1===this.isOld?this._newImgLoad():this._oldImgLoad()},e.prototype.drawView=function(t){"3"==t||"7"==t?(this._isAni=!0,this.emit(e.COMPLETE_DRAWING),this.requestAnimation()):this.drawTileAndImage()},e.prototype._deltaTransformPoint=function(t,e){return{x:e.x*t.a+e.y*t.c+0,y:e.x*t.b+e.y*t.d+0}},e.prototype._decomposeMatrix=function(t){var e=this._deltaTransformPoint(t,{x:0,y:1}),i=this._deltaTransformPoint(t,{x:1,y:0}),n=180/Math.PI*Math.atan2(e.y,e.x)-90,r=180/Math.PI*Math.atan2(i.y,i.x);return{translateX:t.e,translateY:t.f,scaleX:Math.sqrt(t.a*t.a+t.b*t.b),scaleY:Math.sqrt(t.c*t.c+t.d*t.d),skewX:n,skewY:r,rotation:n}},e.prototype._createRCanvas=function(t,e){var i=document.createElement("canvas"),n=i.getContext("2d"),r=90==e||270==e;switch(i.width=r?t.height:t.width,i.height=r?t.width:t.height,n.save(),e){case 90:n.translate(i.width,0);break;case 180:n.translate(i.width,i.height);break;case 270:n.translate(0,i.height)}return n.rotate(e*Math.PI/180),n.drawImage(t,0,0),n.save(),i},e.prototype.drawTileAndImage=function(){for(var t=this,i=this.type,n=void 0,r=this.cellLength-1;r>=0;r--)setTimeout(function(e){if(t.model.cellData[e].has("image")){var r=t.model.cellData[e].get("cellInfo"),o=(t.model.cellData[e].get("matrix"),t.model.cellData[e].get("isRescale"),parseInt(t.model.cellData[e].get("rotation")));n=t.imgs[e];var a=document.createElement("canvas"),s=(document.createElement("canvas"),void 0),l=void 0;if(a.width=r.w,a.height=r.h,o&&0!=o&&(n=t._createRCanvas(n,o)),"5"==i||"6"==i||parseInt(i)<3){if(l=a.getContext("2d"),t.applyImageCrop(e,n,l).ratio,"w"==(s=t.applyImageCrop(e,n,l).criterion)){var c=Math.floor((n.height-n.width*r.h/r.w)/2),u=Math.floor(n.width*r.h/r.w);t.context.drawImage(n,0,c,n.width,u,0|r.x,0|r.y,r.w,r.h)}else if("h"==s){var h=Math.floor((n.width-n.height*r.w/r.h)/2),f=Math.floor(n.height*r.w/r.h);t.context.drawImage(n,h,0,f,n.height,0|r.x,0|r.y,r.w,r.h)}}else t.context.drawImage(n,0|r.x,0|r.y,r.w,r.h)}},15*(this.cellLength-r),r);this.emit(e.COMPLETE_DRAWING)},e.prototype.applyMatrix=function(t,e,i,n,r){var o=this.model.cellData[t].get("cellInfo");if(""!=e&&null!=e){var a=o.w/n.width,s=o.h/n.height;return a>s?a:s}},e.prototype.applyImageCrop=function(t,e,i){var n=this.model.cellData[t].get("cellInfo"),r=n.w/e.width,o=n.h/e.height;return{ratio:r>o?r:o,criterion:r>o?"w":"h"}},e.prototype.requestAnimation=function(){!this._animateHandler&&(this._animateHandler=this.animateHandler.bind(this)),requestAnimationFrame(this._animateHandler)},e.prototype.animateHandler=function(t){if(this.context)if(0==this._isAni){this._oldTime||(this._oldTime=(new Date).getTime());var e=(new Date).getTime();e-this._oldTime>=c.default.ANIMATION_TIME&&(this._oldTime=null,this._isAni=!0),this.requestAnimation()}else this.context.clearRect(0,0,this.viewerWidth,this.viewerHeight),this.fadeInOut(),this.requestAnimation()},e.prototype.fadeInOut=function(){var t=this.imgs,e=t.length,i=this.index,n=i+1==e?0:i+1,r=t[0],o=t[i],a=t[n],s=this.viewerWidth,l=this.viewerHeight;(this.alpha<0||this.nextAlpha>1)&&(this.alpha=0,this.nextAlpha=1),this.context.globalAlpha=this.alpha,this.fitImage(o,0,0,s,l),this.context.globalAlpha=this.nextAlpha,this.index+1<e?this.fitImage(a,0,0,s,l):this.fitImage(r,0,0,s,l),0==this.alpha||1==this.nextAlpha?(this.alpha=1,this.nextAlpha=0,this.index<e-1?this.index=this.index+1:this.index=0,this._isAni=!1):(this.nextAlpha+=.019,this.alpha=1-this.nextAlpha)},e.prototype.fitImage=function(t,e,i,n,r){var o=t.width,a=t.height,s=e,l=i,c=n,u=r;u<a&&o/a<4/3?this.context.drawImage(t,0,0,o,a,(c-o*u/a)/2,l,o*u/a,u):c<o&&o/a>4/3?this.context.drawImage(t,0,0,o,a,s,(u-a*c/o)/2,c,a*c/o):this.context.drawImage(t,0,0,o,a,s+(c-o)/2,l+(u-a)/2,o,a)},e}(u));e.default=h},function(t,e,i){"use strict";t.exports=i(60)()?Map:i(64)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){function i(){}function n(t,e){return function(){t.apply(e,arguments)}}function r(t,e){for(;3===t._state;)t=t._value;if(0===t._state)return void t._deferreds.push(e);t._handled=!0,u._immediateFn(function(){var i=1===t._state?e.onFulfilled:e.onRejected;if(null===i)return void(1===t._state?o:a)(e.promise,t._value);var n;try{n=i(t._value)}catch(t){return void a(e.promise,t)}o(e.promise,n)})}function o(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var i=e.then;if(e instanceof u)return t._state=3,t._value=e,void s(t);if("function"==typeof i)return void c(n(i,e),t)}t._state=1,t._value=e,s(t)}catch(e){a(t,e)}}function a(t,e){t._state=2,t._value=e,s(t)}function s(t){2===t._state&&0===t._deferreds.length&&u._immediateFn(function(){t._handled||u._unhandledRejectionFn(t._value)});for(var e=0,i=t._deferreds.length;e<i;e++)r(t,t._deferreds[e]);t._deferreds=null}function l(t,e,i){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=i}function c(t,e){var i=!1;try{t(function(t){i||(i=!0,o(e,t))},function(t){i||(i=!0,a(e,t))})}catch(t){if(i)return;i=!0,a(e,t)}}function u(t){if(!(this instanceof u))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(t,this)}var h=setTimeout,f=u.prototype;f.catch=function(t){return this.then(null,t)},f.then=function(t,e){var n=new this.constructor(i);return r(this,new l(t,e,n)),n},u.all=function(t){return new u(function(e,i){function n(t,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var s=a.then;if("function"==typeof s)return void s.call(a,function(e){n(t,e)},i)}r[t]=a,0==--o&&e(r)}catch(t){i(t)}}if(!t||void 0===t.length)throw new TypeError("Promise.all accepts an array");var r=Array.prototype.slice.call(t);if(0===r.length)return e([]);for(var o=r.length,a=0;a<r.length;a++)n(a,r[a])})},u.resolve=function(t){return t&&"object"==typeof t&&t.constructor===u?t:new u(function(e){e(t)})},u.reject=function(t){return new u(function(e,i){i(t)})},u.race=function(t){return new u(function(e,i){for(var n=0,r=t.length;n<r;n++)t[n].then(e,i)})},u._immediateFn="function"==typeof t&&function(e){t(e)}||function(t){h(t,0)},u._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console},e.default=u}.call(e,i(73).setImmediate)},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(19),s=n(a),l=i(20),c=n(l),u=i(22),h=n(u),f=i(21),d=n(f),p=function(){function t(e){r(this,t),this.model=null,this.fullOption=e;var i=this.fullOption;this.optionIndex=0,this.optionLength=i.xml.length,this.setOption()}return o(t,null,[{key:"COMPLETE_RENDERING",get:function(){return"completeRendering"}}]),t.prototype.setOption=function(){var t=this.fullOption,e=this.optionIndex++;if(e>=this.optionLength)return void completeStoryPhotoRendering();var i={xml:t.xml[e],imgPrefix:t.imgPrefix,viewWidth:t.viewWidth[e],container:t.container[e]};this.showView(i)},t.prototype.showView=function(t){var e=this;this.handleCompPars=function(i){e.drawCanvas(t.container,i)},this.start(t)},t.prototype.start=function(t){this.dataManager=new s.default(t),this.dataManager.on(s.default.COMPLETE_PARSING,this.handleCompPars),this.dataManager.on(s.default.ERROR_PARSING,this.setOption.bind(this))},t.prototype.drawCanvas=function(t,e){this.model=e,this.view=new c.default(t,this.model),this.view.on(c.default.COMPLETE_DRAWING,this.setOption.bind(this))},t.prototype.dispose=function(){null!=this.dataManager&&(this.view&&(this.view.off(c.default.COMPLETE_DRAWING,this.setOption),this.view.dispose()),this.dataManager&&(this.dataManager.off(s.default.COMPLETE_PARSING,this.handleCompPars),this.dataManager.off(s.default.ERROR_PARSING,this.setOption()),this.dataManager.dispose()),this.view=null,this.dataManager=null,this.model=null)},t}();e.default=p,window.Promise=window.Promise||h.default,window.Map=window.Map||d.default,window.naver=window.naver||{},naver.story=naver.story||{},naver.story.Main=p},function(t,e,i){"use strict";e.__esModule=!0;var n={ANIMATION_TIME:2e3,LOADING_IMG:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAKCAYAAADcpvzeAAAAhklEQVQ4T72UUQrAIAxD7WE9VQ+70UEhdKHrIJtfWvSRJqotwdh7H+5uAtQyBSwZCpZU0GcORacBxxi6Wu5Fp1IcY1Q2NnJzCG1nEbB4ao0xnrgpaiwoHapuxPp3QdOOJ+5hA2x+OYQZRuaT+5IwvCudILafClK8jLeM7nuQfGZTQcz5evYEjtXwZ5VkPdwAAAAASUVORK5CYII="};e.default=n},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=function(){function t(){n(this,t),this.loadingImage=new Image,this.option=null,this.type=null,this.moduleData=null,this.cellData=null,this.imgData=null}return r(t,[{key:"matrix",get:function(){return this._matrix}}]),t}();e.default=o},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var r=function(){function t(e){n(this,t),this.xmlPath=e}return t.prototype.loadDoc=function(){var t=this,e=this;return new Promise(function(i,n){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){if(r.responseXML)i(r.responseXML);else if(r.responseText){var t=r.responseText,o=e.text2XML(t);i(o)}}else 404==r.status&&n("404 에러 :",r.status)},r.onerror=function(t){n(t)},r.open("GET",t.xmlPath,!0),r.send()})},t.prototype.text2XML=function(t){var e=void 0;return window.DOMParser?e=(new DOMParser).parseFromString(t,"text/xml"):(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(t)),e},t}();e.default=r},function(t,e,i){"use strict";var n,r=i(43),o=i(13),a=i(1),s=i(51),l=i(1),c=i(0),u=Function.prototype.bind,h=Object.defineProperty,f=Object.prototype.hasOwnProperty;n=function(t,e,i){var n,o=c(e)&&l(e.value);return n=r(e),delete n.writable,delete n.value,n.get=function(){return!i.overwriteDefinition&&f.call(this,t)?o:(e.value=u.call(o,i.resolveContext?i.resolveContext(this):this),h(this,t,e),this[t])},n},t.exports=function(t){var e=o(arguments[1]);return null!=e.resolveContext&&a(e.resolveContext),s(t,function(t,i){return n(i,t,e)})}},function(t,e,i){"use strict";var n=i(36),r=i(12),o=i(0),a=Array.prototype.indexOf,s=Object.prototype.hasOwnProperty,l=Math.abs,c=Math.floor;t.exports=function(t){var e,i,u,h;if(!n(t))return a.apply(this,arguments);for(i=r(o(this).length),u=arguments[1],u=isNaN(u)?0:u>=0?c(u):r(this.length)-c(l(u)),e=u;e<i;++e)if(s.call(this,e)&&(h=this[e],n(h)))return e;return-1}},function(t,e,i){"use strict";t.exports=i(30)()?Array.from:i(31)},function(t,e,i){"use strict";t.exports=function(){var t,e,i=Array.from;return"function"==typeof i&&(t=["raz","dwa"],e=i(t),Boolean(e&&e!==t&&"dwa"===e[1]))}},function(t,e,i){"use strict";var n=i(2).iterator,r=i(5),o=i(32),a=i(12),s=i(1),l=i(0),c=i(4),u=i(7),h=Array.isArray,f=Function.prototype.call,d={configurable:!0,enumerable:!0,writable:!0,value:null},p=Object.defineProperty;t.exports=function(t){var e,i,A,g,_,m,v,y,w,b,I=arguments[1],x=arguments[2];if(t=Object(l(t)),c(I)&&s(I),this&&this!==Array&&o(this))e=this;else{if(!I){if(r(t))return 1!==(_=t.length)?Array.apply(null,t):(g=new Array(1),g[0]=t[0],g);if(h(t)){for(g=new Array(_=t.length),i=0;i<_;++i)g[i]=t[i];return g}}g=[]}if(!h(t))if(void 0!==(w=t[n])){for(v=s(w).call(t),e&&(g=new e),y=v.next(),i=0;!y.done;)b=I?f.call(I,x,y.value,i):y.value,e?(d.value=b,p(g,i,d)):g[i]=b,y=v.next(),++i;_=i}else if(u(t)){for(_=t.length,e&&(g=new e),i=0,A=0;i<_;++i)b=t[i],i+1<_&&(m=b.charCodeAt(0))>=55296&&m<=56319&&(b+=t[++i]),b=I?f.call(I,x,b,A):b,e?(d.value=b,p(g,A,d)):g[A]=b,++A;_=A}if(void 0===_)for(_=a(t.length),e&&(g=new e(_)),i=0;i<_;++i)b=I?f.call(I,x,t[i],i):t[i],e?(d.value=b,p(g,i,d)):g[i]=b;return e&&(d.value=null,g.length=_),g}},function(t,e,i){"use strict";var n=Object.prototype.toString,r=n.call(i(11));t.exports=function(t){return"function"==typeof t&&n.call(t)===r}},function(t,e,i){"use strict";t.exports=i(34)()?Math.sign:i(35)},function(t,e,i){"use strict";t.exports=function(){var t=Math.sign;return"function"==typeof t&&(1===t(10)&&-1===t(-20))}},function(t,e,i){"use strict";t.exports=function(t){return t=Number(t),isNaN(t)||0===t?t:t>0?1:-1}},function(t,e,i){"use strict";t.exports=i(37)()?Number.isNaN:i(38)},function(t,e,i){"use strict";t.exports=function(){var t=Number.isNaN;return"function"==typeof t&&(!t({})&&t(NaN)&&!t(34))}},function(t,e,i){"use strict";t.exports=function(t){return t!==t}},function(t,e,i){"use strict";var n=i(33),r=Math.abs,o=Math.floor;t.exports=function(t){return isNaN(t)?0:(t=Number(t),0!==t&&isFinite(t)?n(t)*o(r(t)):t)}},function(t,e,i){"use strict";var n=i(1),r=i(0),o=Function.prototype.bind,a=Function.prototype.call,s=Object.keys,l=Object.prototype.propertyIsEnumerable;t.exports=function(t,e){return function(i,c){var u,h=arguments[2],f=arguments[3];return i=Object(r(i)),n(c),u=s(i),f&&u.sort("function"==typeof f?o.call(f,i):void 0),"function"!=typeof t&&(t=u[t]),a.call(t,u,function(t,n){return l.call(i,t)?a.call(c,h,i[t],t,i,n):e})}}},function(t,e,i){"use strict";t.exports=function(){var t,e=Object.assign;return"function"==typeof e&&(t={foo:"raz"},e(t,{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy")}},function(t,e,i){"use strict";var n=i(48),r=i(0),o=Math.max;t.exports=function(t,e){var i,a,s,l=o(arguments.length,2);for(t=Object(r(t)),s=function(n){try{t[n]=e[n]}catch(t){i||(i=t)}},a=1;a<l;++a)e=arguments[a],n(e).forEach(s);if(void 0!==i)throw i;return t}},function(t,e,i){"use strict";var n=i(29),r=i(8),o=i(0);t.exports=function(t){var e=Object(o(t)),i=arguments[1],a=Object(arguments[2]);if(e!==t&&!i)return e;var s={};return i?n(i,function(e){(a.ensure||e in t)&&(s[e]=t[e])}):r(s,t),s}},function(t,e,i){"use strict";var n,r=Object.create;i(14)()||(n=i(15)),t.exports=function(){var t,e,i;return n?1!==n.level?r:(t={},e={},i={configurable:!1,enumerable:!1,writable:!0,value:void 0},Object.getOwnPropertyNames(Object.prototype).forEach(function(t){if("__proto__"===t)return void(e[t]={configurable:!0,enumerable:!1,writable:!0,value:void 0});e[t]=i}),Object.defineProperties(t,e),Object.defineProperty(n,"nullPolyfill",{configurable:!1,enumerable:!1,writable:!1,value:t}),function(e,i){return r(null===e?t:e,i)}):r}()},function(t,e,i){"use strict";t.exports=i(40)("forEach")},function(t,e,i){"use strict";t.exports=function(t){return"function"==typeof t}},function(t,e,i){"use strict";var n=i(4),r={function:!0,object:!0};t.exports=function(t){return n(t)&&r[typeof t]||!1}},function(t,e,i){"use strict";t.exports=i(49)()?Object.keys:i(50)},function(t,e,i){"use strict";t.exports=function(){try{return Object.keys("primitive"),!0}catch(t){return!1}}},function(t,e,i){"use strict";var n=i(4),r=Object.keys;t.exports=function(t){return r(n(t)?Object(t):t)}},function(t,e,i){"use strict";var n=i(1),r=i(45),o=Function.prototype.call;t.exports=function(t,e){var i={},a=arguments[2];return n(e),r(t,function(t,n,r,s){i[n]=o.call(e,a,t,n,r,s)}),i}},function(t,e,i){"use strict";var n=Array.prototype.forEach,r=Object.create;t.exports=function(t){var e=r(null);return n.call(arguments,function(t){e[t]=!0}),e}},function(t,e,i){"use strict";var n="razdwatrzy";t.exports=function(){return"function"==typeof n.contains&&(!0===n.contains("dwa")&&!1===n.contains("foo"))}},function(t,e,i){"use strict";var n=String.prototype.indexOf;t.exports=function(t){return n.call(this,t,arguments[1])>-1}},function(t,e,i){"use strict";var n,r=i(6),o=i(16),a=i(3),s=i(2),l=i(9),c=Object.defineProperty;n=t.exports=function(t,e){if(!(this instanceof n))throw new TypeError("Constructor requires 'new'");l.call(this,t),e=e?o.call(e,"key+value")?"key+value":o.call(e,"key")?"key":"value":"value",c(this,"__kind__",a("",e))},r&&r(n,l),delete n.prototype.constructor,n.prototype=Object.create(l.prototype,{_resolve:a(function(t){return"value"===this.__kind__?this.__list__[t]:"key+value"===this.__kind__?[t,this.__list__[t]]:t})}),c(n.prototype,s.toStringTag,a("c","Array Iterator"))},function(t,e,i){"use strict";var n=i(5),r=i(1),o=i(7),a=i(57),s=Array.isArray,l=Function.prototype.call,c=Array.prototype.some;t.exports=function(t,e){var i,u,h,f,d,p,A,g,_=arguments[2];if(s(t)||n(t)?i="array":o(t)?i="string":t=a(t),r(e),h=function(){f=!0},"array"===i)return void c.call(t,function(t){return l.call(e,_,t,h),f});if("string"!==i)for(u=t.next();!u.done;){if(l.call(e,_,u.value,h),f)return;u=t.next()}else for(p=t.length,d=0;d<p&&(A=t[d],d+1<p&&(g=A.charCodeAt(0))>=55296&&g<=56319&&(A+=t[++d]),l.call(e,_,A,h),!f);++d);}},function(t,e,i){"use strict";var n=i(5),r=i(7),o=i(55),a=i(59),s=i(17),l=i(2).iterator;t.exports=function(t){return"function"==typeof s(t)[l]?t[l]():n(t)?new o(t):r(t)?new a(t):new o(t)}},function(t,e,i){"use strict";var n=i(5),r=i(4),o=i(7),a=i(2).iterator,s=Array.isArray;t.exports=function(t){return!!r(t)&&(!!s(t)||(!!o(t)||(!!n(t)||"function"==typeof t[a])))}},function(t,e,i){"use strict";var n,r=i(6),o=i(3),a=i(2),s=i(9),l=Object.defineProperty;n=t.exports=function(t){if(!(this instanceof n))throw new TypeError("Constructor requires 'new'");t=String(t),s.call(this,t),l(this,"__length__",o("",t.length))},r&&r(n,s),delete n.prototype.constructor,n.prototype=Object.create(s.prototype,{_next:o(function(){if(this.__list__)return this.__nextIndex__<this.__length__?this.__nextIndex__++:void this._unBind()}),_resolve:o(function(t){var e,i=this.__list__[t];return this.__nextIndex__===this.__length__?i:(e=i.charCodeAt(0),e>=55296&&e<=56319?i+this.__list__[this.__nextIndex__++]:i)})}),l(n.prototype,a.toStringTag,o("c","String Iterator"))},function(t,e,i){"use strict";t.exports=function(){var t,e,i;if("function"!=typeof Map)return!1;try{t=new Map([["raz","one"],["dwa","two"],["trzy","three"]])}catch(t){return!1}return"[object Map]"===String(t)&&(3===t.size&&("function"==typeof t.clear&&("function"==typeof t.delete&&("function"==typeof t.entries&&("function"==typeof t.forEach&&("function"==typeof t.get&&("function"==typeof t.has&&("function"==typeof t.keys&&("function"==typeof t.set&&("function"==typeof t.values&&(e=t.entries(),i=e.next(),!1===i.done&&(!!i.value&&("raz"===i.value[0]&&"one"===i.value[1])))))))))))))}},function(t,e,i){"use strict";t.exports=function(){return"undefined"!=typeof Map&&"[object Map]"===Object.prototype.toString.call(new Map)}()},function(t,e,i){"use strict";t.exports=i(52)("key","value","key+value")},function(t,e,i){"use strict";var n,r=i(6),o=i(3),a=i(9),s=i(2).toStringTag,l=i(62),c=Object.defineProperties,u=a.prototype._unBind;n=t.exports=function(t,e){if(!(this instanceof n))return new n(t,e);a.call(this,t.__mapKeysData__,t),e&&l[e]||(e="key+value"),c(this,{__kind__:o("",e),__values__:o("w",t.__mapValuesData__)})},r&&r(n,a),n.prototype=Object.create(a.prototype,{constructor:o(n),_resolve:o(function(t){return"value"===this.__kind__?this.__values__[t]:"key"===this.__kind__?this.__list__[t]:[this.__list__[t],this.__values__[t]]}),_unBind:o(function(){this.__values__=null,u.call(this)}),toString:o(function(){return"[object Map Iterator]"})}),Object.defineProperty(n.prototype,s,o("c","Map Iterator"))},function(t,e,i){"use strict";var n,r=i(10),o=i(28),a=i(6),s=i(1),l=i(0),c=i(3),u=i(69),h=i(2),f=i(17),d=i(56),p=i(63),A=i(61),g=Function.prototype.call,_=Object.defineProperties,m=Object.getPrototypeOf;t.exports=n=function(){var t,e,i,r=arguments[0];if(!(this instanceof n))throw new TypeError("Constructor requires 'new'");return i=A&&a&&Map!==n?a(new Map,m(this)):this,null!=r&&f(r),_(i,{__mapKeysData__:c("c",t=[]),__mapValuesData__:c("c",e=[])}),r?(d(r,function(i){var n=l(i)[0];i=i[1],-1===o.call(t,n)&&(t.push(n),e.push(i))},i),i):i},A&&(a&&a(n,Map),n.prototype=Object.create(Map.prototype,{constructor:c(n)})),u(_(n.prototype,{clear:c(function(){this.__mapKeysData__.length&&(r.call(this.__mapKeysData__),r.call(this.__mapValuesData__),this.emit("_clear"))}),delete:c(function(t){var e=o.call(this.__mapKeysData__,t);return-1!==e&&(this.__mapKeysData__.splice(e,1),this.__mapValuesData__.splice(e,1),this.emit("_delete",e,t),!0)}),entries:c(function(){return new p(this,"key+value")}),forEach:c(function(t){var e,i,n=arguments[1];for(s(t),e=this.entries(),i=e._next();void 0!==i;)g.call(t,n,this.__mapValuesData__[i],this.__mapKeysData__[i],this),i=e._next()}),get:c(function(t){var e=o.call(this.__mapKeysData__,t);if(-1!==e)return this.__mapValuesData__[e]}),has:c(function(t){return-1!==o.call(this.__mapKeysData__,t)}),keys:c(function(){return new p(this,"key")}),set:c(function(t,e){var i,n=o.call(this.__mapKeysData__,t);return-1===n&&(n=this.__mapKeysData__.push(t)-1,i=!0),this.__mapValuesData__[n]=e,i&&this.emit("_add",n,t),this}),size:c.gs(function(){return this.__mapKeysData__.length}),values:c(function(){return new p(this,"value")}),toString:c(function(){return"[object Map]"})})),Object.defineProperty(n.prototype,h.iterator,c(function(){return this.entries()})),Object.defineProperty(n.prototype,h.toStringTag,c("c","Map"))},function(t,e,i){"use strict";var n={object:!0,symbol:!0};t.exports=function(){var t;if("function"!=typeof Symbol)return!1;t=Symbol("test symbol");try{String(t)}catch(t){return!1}return!!n[typeof Symbol.iterator]&&(!!n[typeof Symbol.toPrimitive]&&!!n[typeof Symbol.toStringTag])}},function(t,e,i){"use strict";t.exports=function(t){return!!t&&("symbol"==typeof t||!!t.constructor&&("Symbol"===t.constructor.name&&"Symbol"===t[t.constructor.toStringTag]))}},function(t,e,i){"use strict";var n,r,o,a,s=i(3),l=i(68),c=Object.create,u=Object.defineProperties,h=Object.defineProperty,f=Object.prototype,d=c(null);if("function"==typeof Symbol){n=Symbol;try{String(n()),a=!0}catch(t){}}var p=function(){var t=c(null);return function(e){for(var i,n,r=0;t[e+(r||"")];)++r;return e+=r||"",t[e]=!0,i="@@"+e,h(f,i,s.gs(null,function(t){n||(n=!0,h(this,i,s(t)),n=!1)})),i}}();o=function(t){if(this instanceof o)throw new TypeError("Symbol is not a constructor");return r(t)},t.exports=r=function t(e){var i;if(this instanceof t)throw new TypeError("Symbol is not a constructor");return a?n(e):(i=c(o.prototype),e=void 0===e?"":String(e),u(i,{__description__:s("",e),__name__:s("",p(e))}))},u(r,{for:s(function(t){return d[t]?d[t]:d[t]=r(String(t))}),keyFor:s(function(t){var e;l(t);for(e in d)if(d[e]===t)return e}),hasInstance:s("",n&&n.hasInstance||r("hasInstance")),isConcatSpreadable:s("",n&&n.isConcatSpreadable||r("isConcatSpreadable")),iterator:s("",n&&n.iterator||r("iterator")),match:s("",n&&n.match||r("match")),replace:s("",n&&n.replace||r("replace")),search:s("",n&&n.search||r("search")),species:s("",n&&n.species||r("species")),split:s("",n&&n.split||r("split")),toPrimitive:s("",n&&n.toPrimitive||r("toPrimitive")),toStringTag:s("",n&&n.toStringTag||r("toStringTag")),unscopables:s("",n&&n.unscopables||r("unscopables"))}),u(o.prototype,{constructor:s(r),toString:s("",function(){return this.__name__})}),u(r.prototype,{toString:s(function(){return"Symbol ("+l(this).__description__+")"}),valueOf:s(function(){return l(this)})}),h(r.prototype,r.toPrimitive,s("",function(){var t=l(this);return"symbol"==typeof t?t:t.toString()})),h(r.prototype,r.toStringTag,s("c","Symbol")),h(o.prototype,r.toStringTag,s("c",r.prototype[r.toStringTag])),h(o.prototype,r.toPrimitive,s("c",r.prototype[r.toPrimitive]))},function(t,e,i){"use strict";var n=i(66);t.exports=function(t){if(!n(t))throw new TypeError(t+" is not a symbol");return t}},function(t,e,i){"use strict";var n,r,o,a,s,l,c,u=i(3),h=i(1),f=Function.prototype.apply,d=Function.prototype.call,p=Object.create,A=Object.defineProperty,g=Object.defineProperties,_=Object.prototype.hasOwnProperty,m={configurable:!0,enumerable:!1,writable:!0};n=function(t,e){var i;return h(e),_.call(this,"__ee__")?i=this.__ee__:(i=m.value=p(null),A(this,"__ee__",m),m.value=null),i[t]?"object"==typeof i[t]?i[t].push(e):i[t]=[i[t],e]:i[t]=e,this},r=function(t,e){var i,r;return h(e),r=this,n.call(this,t,i=function(){o.call(r,t,i),f.call(e,this,arguments)}),i.__eeOnceListener__=e,this},o=function(t,e){var i,n,r,o;if(h(e),!_.call(this,"__ee__"))return this;if(i=this.__ee__,!i[t])return this;if("object"==typeof(n=i[t]))for(o=0;r=n[o];++o)r!==e&&r.__eeOnceListener__!==e||(2===n.length?i[t]=n[o?0:1]:n.splice(o,1));else n!==e&&n.__eeOnceListener__!==e||delete i[t];return this},a=function(t){var e,i,n,r,o;if(_.call(this,"__ee__")&&(r=this.__ee__[t]))if("object"==typeof r){for(i=arguments.length,o=new Array(i-1),e=1;e<i;++e)o[e-1]=arguments[e];for(r=r.slice(),e=0;n=r[e];++e)f.call(n,this,o)}else switch(arguments.length){case 1:d.call(r,this);break;case 2:d.call(r,this,arguments[1]);break;case 3:d.call(r,this,arguments[1],arguments[2]);break;default:for(i=arguments.length,o=new Array(i-1),e=1;e<i;++e)o[e-1]=arguments[e];f.call(r,this,o)}},s={on:n,once:r,off:o,emit:a},l={on:u(n),once:u(r),off:u(o),emit:u(a)},c=g({},l),t.exports=e=function(t){return null==t?p(c):g(Object(t),l)},e.methods=s},function(t,e,i){var n,n;!function(e){t.exports=e()}(function(){return function t(e,i,r){function o(s,l){if(!i[s]){if(!e[s]){var c="function"==typeof n&&n;if(!l&&c)return n(s,!0);if(a)return a(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var h=i[s]={exports:{}};e[s][0].call(h.exports,function(t){var i=e[s][1][t];return o(i||t)},h,h.exports,t,e,i,r)}return i[s].exports}for(var a="function"==typeof n&&n,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(t,e,i){"use strict";function n(t){var e=t||[],i={js:e.indexOf("js")>=0,wasm:e.indexOf("wasm")>=0};o.call(this,i),this.features={js:i.js,wasm:i.wasm&&this.has_wasm},this.use(a),this.use(s)}var r=t("inherits"),o=t("multimath"),a=t("multimath/lib/unsharp_mask"),s=t("./mm_resize");r(n,o),n.prototype.resizeAndUnsharp=function(t,e){var i=this.resize(t,e);return t.unsharpAmount&&this.unsharp_mask(i,t.toWidth,t.toHeight,t.unsharpAmount,t.unsharpRadius,t.unsharpThreshold),i},e.exports=n},{"./mm_resize":4,inherits:14,multimath:15,"multimath/lib/unsharp_mask":18}],2:[function(t,e,i){"use strict";function n(t){return t<0?0:t>255?255:t}function r(t,e,i,r,o,a){var s,l,c,u,h,f,d,p,A,g,_,m=0,v=0;for(A=0;A<r;A++){for(h=0,g=0;g<o;g++){for(f=a[h++],d=a[h++],p=m+4*f|0,s=l=c=u=0;d>0;d--)_=a[h++],u=u+_*t[p+3]|0,c=c+_*t[p+2]|0,l=l+_*t[p+1]|0,s=s+_*t[p]|0,p=p+4|0;e[v+3]=n(u+8192>>14),e[v+2]=n(c+8192>>14),e[v+1]=n(l+8192>>14),e[v]=n(s+8192>>14),v=v+4*r|0}v=4*(A+1)|0,m=(A+1)*i*4|0}}function o(t,e,i,r,o,a){var s,l,c,u,h,f,d,p,A,g,_,m=0,v=0;for(A=0;A<r;A++){for(h=0,g=0;g<o;g++){for(f=a[h++],d=a[h++],p=m+4*f|0,s=l=c=u=0;d>0;d--)_=a[h++],u=u+_*t[p+3]|0,c=c+_*t[p+2]|0,l=l+_*t[p+1]|0,s=s+_*t[p]|0,p=p+4|0;e[v+3]=n(u+8192>>14),e[v+2]=n(c+8192>>14),e[v+1]=n(l+8192>>14),e[v]=n(s+8192>>14),v=v+4*r|0}v=4*(A+1)|0,m=(A+1)*i*4|0}}e.exports={convolveHorizontally:r,convolveVertically:o}},{}],3:[function(t,e,i){"use strict";e.exports="AGFzbQEAAAABFAJgBn9/f39/fwBgB39/f39/f38AAg8BA2VudgZtZW1vcnkCAAEDAwIAAQQEAXAAAAcZAghjb252b2x2ZQAACmNvbnZvbHZlSFYAAQkBAArmAwLBAwEQfwJAIANFDQAgBEUNACAFQQRqIRVBACEMQQAhDQNAIA0hDkEAIRFBACEHA0AgB0ECaiESAn8gBSAHQQF0IgdqIgZBAmouAQAiEwRAQQAhCEEAIBNrIRQgFSAHaiEPIAAgDCAGLgEAakECdGohEEEAIQlBACEKQQAhCwNAIBAoAgAiB0EYdiAPLgEAIgZsIAtqIQsgB0H/AXEgBmwgCGohCCAHQRB2Qf8BcSAGbCAKaiEKIAdBCHZB/wFxIAZsIAlqIQkgD0ECaiEPIBBBBGohECAUQQFqIhQNAAsgEiATagwBC0EAIQtBACEKQQAhCUEAIQggEgshByABIA5BAnRqIApBgMAAakEOdSIGQf8BIAZB/wFIG0EQdEGAgPwHcUEAIAZBAEobIAtBgMAAakEOdSIGQf8BIAZB/wFIG0EYdEEAIAZBAEobciAJQYDAAGpBDnUiBkH/ASAGQf8BSBtBCHRBgP4DcUEAIAZBAEobciAIQYDAAGpBDnUiBkH/ASAGQf8BSBtB/wFxQQAgBkEAShtyNgIAIA4gA2ohDiARQQFqIhEgBEcNAAsgDCACaiEMIA1BAWoiDSADRw0ACwsLIQACQEEAIAIgAyAEIAUgABAAIAJBACAEIAUgBiABEAALCw=="},{}],4:[function(t,e,i){"use strict";e.exports={name:"resize",fn:t("./resize"),wasm_fn:t("./resize_wasm"),wasm_src:t("./convolve_wasm_base64")}},{"./convolve_wasm_base64":3,"./resize":5,"./resize_wasm":8}],5:[function(t,e,i){"use strict";function n(t,e,i){for(var n=3,r=e*i*4|0;n<r;)t[n]=255,n=n+4|0}var r=t("./resize_filter_gen"),o=t("./convolve").convolveHorizontally,a=t("./convolve").convolveVertically;e.exports=function(t){var e=t.src,i=t.width,s=t.height,l=t.toWidth,c=t.toHeight,u=t.scaleX||t.toWidth/t.width,h=t.scaleY||t.toHeight/t.height,f=t.offsetX||0,d=t.offsetY||0,p=t.dest||new Uint8Array(l*c*4),A=void 0===t.quality?3:t.quality,g=t.alpha||!1,_=r(A,i,l,u,f),m=r(A,s,c,h,d),v=new Uint8Array(l*s*4);return o(e,v,i,s,l,_),a(v,p,s,l,c,m),g||n(p,l,c),p}},{"./convolve":2,"./resize_filter_gen":6}],6:[function(t,e,i){"use strict";function n(t){return Math.round(t*((1<<o)-1))}var r=t("./resize_filter_info"),o=14;e.exports=function(t,e,i,o,a){var s,l,c,u,h,f,d,p,A,g,_,m,v,y,w,b,I,x=r[t].filter,E=1/o,B=Math.min(1,o),C=r[t].win/B,D=Math.floor(2*(C+1)),O=new Int16Array((D+2)*i),Q=0,M=!O.subarray||!O.set;for(s=0;s<i;s++){for(l=(s+.5)*E+a,c=Math.max(0,Math.floor(l-C)),u=Math.min(e-1,Math.ceil(l+C)),h=u-c+1,f=new Float32Array(h),d=new Int16Array(h),p=0,A=c,g=0;A<=u;A++,g++)_=x((A+.5-l)*B),p+=_,f[g]=_;for(m=0,g=0;g<f.length;g++)v=f[g]/p,m+=v,d[g]=n(v);for(d[i>>1]+=n(1-m),y=0;y<d.length&&0===d[y];)y++;if(y<d.length){for(w=d.length-1;w>0&&0===d[w];)w--;if(b=c+y,I=w-y+1,O[Q++]=b,O[Q++]=I,M)for(g=y;g<=w;g++)O[Q++]=d[g];else O.set(d.subarray(y,w+1),Q),Q+=I}else O[Q++]=0,O[Q++]=0}return O}},{"./resize_filter_info":7}],7:[function(t,e,i){"use strict";e.exports=[{win:.5,filter:function(t){return t>=-.5&&t<.5?1:0}},{win:1,filter:function(t){if(t<=-1||t>=1)return 0;if(t>-1.1920929e-7&&t<1.1920929e-7)return 1;var e=t*Math.PI;return Math.sin(e)/e*(.54+.46*Math.cos(e/1))}},{win:2,filter:function(t){if(t<=-2||t>=2)return 0;if(t>-1.1920929e-7&&t<1.1920929e-7)return 1;var e=t*Math.PI;return Math.sin(e)/e*Math.sin(e/2)/(e/2)}},{win:3,filter:function(t){if(t<=-3||t>=3)return 0;if(t>-1.1920929e-7&&t<1.1920929e-7)return 1;var e=t*Math.PI;return Math.sin(e)/e*Math.sin(e/3)/(e/3)}}]},{}],8:[function(t,e,i){"use strict";function n(t,e,i){for(var n=3,r=e*i*4|0;n<r;)t[n]=255,n=n+4|0}function r(t){return new Uint8Array(t.buffer,0,t.byteLength)}function o(t,e,i){if(s)return void e.set(r(t),i);for(var n=i,o=0;o<t.length;o++){var a=t[o];e[n++]=255&a,e[n++]=a>>8&255}}var a=t("./resize_filter_gen"),s=!0;try{s=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]}catch(t){}e.exports=function(t){var e=t.src,i=t.width,r=t.height,s=t.toWidth,l=t.toHeight,c=t.scaleX||t.toWidth/t.width,u=t.scaleY||t.toHeight/t.height,h=t.offsetX||0,f=t.offsetY||0,d=t.dest||new Uint8Array(s*l*4),p=void 0===t.quality?3:t.quality,A=t.alpha||!1,g=a(p,i,s,c,h),_=a(p,r,l,u,f),m=this.__align(0+Math.max(e.byteLength,d.byteLength),8),v=this.__align(m+r*s*4,8),y=this.__align(v+g.byteLength,8),w=y+_.byteLength,b=this.__instance("resize",w),I=new Uint8Array(this.__memory.buffer),x=new Uint32Array(this.__memory.buffer),E=new Uint32Array(e.buffer);return x.set(E),o(g,I,v),o(_,I,y),(b.exports.convolveHV||b.exports._convolveHV)(v,y,m,i,r,s,l),new Uint32Array(d.buffer).set(new Uint32Array(this.__memory.buffer,0,l*s)),A||n(d,s,l),d}},{"./resize_filter_gen":6}],9:[function(t,e,i){"use strict";function n(t,e){this.create=t,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0,this.idle=e||2e3}n.prototype.acquire=function(){var t=this,e=void 0;return 0!==this.available.length?e=this.available.pop():(e=this.create(),e.id=this.lastId++,e.release=function(){return t.release(e)}),this.acquired[e.id]=e,e},n.prototype.release=function(t){var e=this;delete this.acquired[t.id],t.lastUsed=Date.now(),this.available.push(t),0===this.timeoutId&&(this.timeoutId=setTimeout(function(){return e.gc()},100))},n.prototype.gc=function(){var t=this,e=Date.now();this.available=this.available.filter(function(i){return!(e-i.lastUsed>t.idle)||(i.destroy(),!1)}),0!==this.available.length?this.timeoutId=setTimeout(function(){return t.gc()},100):this.timeoutId=0},e.exports=n},{}],10:[function(t,e,i){"use strict";function n(t){var e=Math.round(t);return Math.abs(t-e)<o?e:Math.floor(t)}function r(t){var e=Math.round(t);return Math.abs(t-e)<o?e:Math.ceil(t)}var o=1e-5;e.exports=function(t){var e,i,o,a,s,l,c,u=t.toWidth/t.width,h=t.toHeight/t.height,f=n(t.srcTileSize*u)-2*t.destTileBorder,d=n(t.srcTileSize*h)-2*t.destTileBorder,p=[];for(a=0;a<t.toHeight;a+=d)for(o=0;o<t.toWidth;o+=f)e=o-t.destTileBorder,e<0&&(e=0),s=o+f+t.destTileBorder-e,e+s>=t.toWidth&&(s=t.toWidth-e),i=a-t.destTileBorder,i<0&&(i=0),l=a+d+t.destTileBorder-i,i+l>=t.toHeight&&(l=t.toHeight-i),c={toX:e,toY:i,toWidth:s,toHeight:l,toInnerX:o,toInnerY:a,toInnerWidth:f,toInnerHeight:d,offsetX:e/u-n(e/u),offsetY:i/h-n(i/h),scaleX:u,scaleY:h,x:n(e/u),y:n(i/h),width:r(s/u),height:r(l/h)},p.push(c);return p}},{}],11:[function(t,e,i){"use strict";function n(t){return Object.prototype.toString.call(t)}e.exports.isCanvas=function(t){var e=n(t);return"[object HTMLCanvasElement]"===e||"[object Canvas]"===e},e.exports.isImage=function(t){return"[object HTMLImageElement]"===n(t)},e.exports.limiter=function(t){function e(){i<t&&n.length&&(i++,n.shift()())}var i=0,n=[];return function(t){return new Promise(function(r,o){n.push(function(){t().then(function(t){r(t),i--,e()},function(t){o(t),i--,e()})}),e()})}},e.exports.cib_quality_name=function(t){switch(t){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"},e.exports.cib_support=function(){return Promise.resolve().then(function(){if("undefined"==typeof createImageBitmap||"undefined"==typeof document)return!1;var t=document.createElement("canvas");return t.width=100,t.height=100,createImageBitmap(t,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then(function(e){var i=10===e.width;return e.close(),t=null,i})}).catch(function(){return!1})}},{}],12:[function(t,e,i){"use strict";e.exports=function(){var e=t("./mathlib"),i=void 0;onmessage=function(t){var n=t.data.opts;i||(i=new e(t.data.features));var r=i.resizeAndUnsharp(n);postMessage({result:r},[r.buffer])}}},{"./mathlib":1}],13:[function(t,e,i){function n(t){t<.5&&(t=.5);var e=Math.exp(.527076)/t,i=Math.exp(-e),n=Math.exp(-2*e),r=(1-i)*(1-i)/(1+2*e*i-n);return a=r,s=r*(e-1)*i,l=r*(e+1)*i,c=-r*n,u=2*i,h=-n,f=(a+s)/(1-u-h),d=(l+c)/(1-u-h),new Float32Array([a,s,l,c,u,h,f,d])}function r(t,e,i,n,r,o){var a,s,l,c,u,h,f,d,p,A,g,_,m,v;for(p=0;p<o;p++){for(h=p*r,f=p,d=0,a=t[h],u=a*n[6],c=u,g=n[0],_=n[1],m=n[4],v=n[5],A=0;A<r;A++)s=t[h],l=s*g+a*_+c*m+u*v,u=c,c=l,a=s,i[d]=c,d++,h++;for(h--,d--,f+=o*(r-1),a=t[h],u=a*n[7],c=u,s=a,g=n[2],_=n[3],A=r-1;A>=0;A--)l=s*g+a*_+c*m+u*v,u=c,c=l,a=s,s=t[h],e[f]=i[d]+c,h--,d--,f-=o}}function o(t,e,i,o){if(o){var a=new Uint16Array(t.length),s=new Float32Array(Math.max(e,i)),l=n(o);r(t,a,s,l,e,i,o),r(a,t,s,l,i,e,o)}}var a,s,l,c,u,h,f,d;e.exports=o},{}],14:[function(t,e,i){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},{}],15:[function(t,e,i){"use strict";function n(t){if(!(this instanceof n))return new n(t);var e=r({},s,t||{});if(this.options=e,this.__cache={},this.has_wasm=a(),this.__init_promise=null,this.__modules=e.modules||{},this.__memory=null,this.__wasm={},this.__isLE=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0],!this.options.js&&!this.options.wasm)throw new Error('mathlib: at least "js" or "wasm" should be enabled')}var r=t("object-assign"),o=t("./lib/base64decode"),a=t("./lib/wa_detect"),s={js:!0,wasm:!0};n.prototype.use=function(t){return this.__modules[t.name]=t,this.has_wasm&&this.options.wasm&&t.wasm_fn?this[t.name]=t.wasm_fn:this[t.name]=t.fn,this},n.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm)return Promise.reject(new Error('mathlib: only "wasm" was enabled, but it\'s not supported'));var t=this;return this.__init_promise=Promise.all(Object.keys(t.__modules).map(function(e){var i=t.__modules[e];return t.has_wasm&&t.options.wasm&&i.wasm_fn?t.__wasm[e]?null:WebAssembly.compile(t.__base64decode(i.wasm_src)).then(function(i){t.__wasm[e]=i}):null})).then(function(){return t}),this.__init_promise},n.prototype.__base64decode=o,n.prototype.__reallocate=function(t){if(!this.__memory)return this.__memory=new WebAssembly.Memory({initial:Math.ceil(t/65536)}),this.__memory;var e=this.__memory.buffer.byteLength;return e<t&&this.__memory.grow(Math.ceil((t-e)/65536)),this.__memory},n.prototype.__instance=function(t,e,i){if(e&&this.__reallocate(e),!this.__wasm[t]){var n=this.__modules[t];this.__wasm[t]=new WebAssembly.Module(this.__base64decode(n.wasm_src))}if(!this.__cache[t]){var o={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[t]=new WebAssembly.Instance(this.__wasm[t],{env:r(o,i||{})})}return this.__cache[t]},n.prototype.__align=function(t,e){e=e||8;var i=t%e;return t+(i?e-i:0)},e.exports=n},{"./lib/base64decode":16,"./lib/wa_detect":22,"object-assign":23}],16:[function(t,e,i){"use strict";e.exports=function(t){for(var e=t.replace(/[\r\n=]/g,""),i=e.length,n=new Uint8Array(3*i>>2),r=0,o=0,a=0;a<i;a++)a%4==0&&a&&(n[o++]=r>>16&255,n[o++]=r>>8&255,n[o++]=255&r),r=r<<6|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(a));var s=i%4*6;return 0===s?(n[o++]=r>>16&255,n[o++]=r>>8&255,n[o++]=255&r):18===s?(n[o++]=r>>10&255,n[o++]=r>>2&255):12===s&&(n[o++]=r>>4&255),n}},{}],17:[function(t,e,i){"use strict";e.exports=function(t,e,i){for(var n,r,o,a,s,l=e*i,c=new Uint16Array(l),u=0;u<l;u++)n=t[4*u],r=t[4*u+1],o=t[4*u+2],s=n>=r&&n>=o?n:r>=o&&r>=n?r:o,a=n<=r&&n<=o?n:r<=o&&r<=n?r:o,c[u]=257*(s+a)>>1;return c}},{}],18:[function(t,e,i){"use strict";e.exports={name:"unsharp_mask",fn:t("./unsharp_mask"),wasm_fn:t("./unsharp_mask_wasm"),wasm_src:t("./unsharp_mask_wasm_base64")}},{"./unsharp_mask":19,"./unsharp_mask_wasm":20,"./unsharp_mask_wasm_base64":21}],19:[function(t,e,i){"use strict";var n=t("glur/mono16"),r=t("./hsl_l16");e.exports=function(t,e,i,o,a,s){var l,c,u,h,f,d,p,A,g,_,m,v,y;if(!(0===o||a<.5)){a>2&&(a=2);var w=r(t,e,i),b=new Uint16Array(w);n(b,e,i,a);for(var I=o/100*4096+.5|0,x=257*s|0,E=e*i,B=0;B<E;B++)v=2*(w[B]-b[B]),Math.abs(v)>=x&&(y=4*B,l=t[y],c=t[y+1],u=t[y+2],A=l>=c&&l>=u?l:c>=l&&c>=u?c:u,p=l<=c&&l<=u?l:c<=l&&c<=u?c:u,d=257*(A+p)>>1,p===A?h=f=0:(f=d<=32767?4095*(A-p)/(A+p)|0:4095*(A-p)/(510-A-p)|0,h=l===A?65535*(c-u)/(6*(A-p))|0:c===A?21845+(65535*(u-l)/(6*(A-p))|0):43690+(65535*(l-c)/(6*(A-p))|0)),d+=I*v+2048>>12,d>65535?d=65535:d<0&&(d=0),0===f?l=c=u=d>>8:(_=d<=32767?d*(4096+f)+2048>>12:d+((65535-d)*f+2048>>12),g=2*d-_>>8,_>>=8,m=h+21845&65535,l=m>=43690?g:m>=32767?g+(6*(_-g)*(43690-m)+32768>>16):m>=10922?_:g+(6*(_-g)*m+32768>>16),m=65535&h,c=m>=43690?g:m>=32767?g+(6*(_-g)*(43690-m)+32768>>16):m>=10922?_:g+(6*(_-g)*m+32768>>16),m=h-21845&65535,u=m>=43690?g:m>=32767?g+(6*(_-g)*(43690-m)+32768>>16):m>=10922?_:g+(6*(_-g)*m+32768>>16)),t[y]=l,t[y+1]=c,t[y+2]=u)}}},{"./hsl_l16":17,"glur/mono16":13}],20:[function(t,e,i){"use strict";e.exports=function(t,e,i,n,r,o){if(!(0===n||r<.5)){r>2&&(r=2);var a=e*i,s=4*a,l=2*a,c=2*a,u=4*Math.max(e,i),h=s,f=h+l,d=f+c,p=d+c,A=p+u,g=this.__instance("unsharp_mask",s+l+2*c+u+32,{exp:Math.exp}),_=new Uint32Array(t.buffer);new Uint32Array(this.__memory.buffer).set(_);var m=g.exports.hsl_l16||g.exports._hsl_l16;m(0,h,e,i),m=g.exports.blurMono16||g.exports._blurMono16,m(h,f,d,p,A,e,i,r),m=g.exports.unsharp||g.exports._unsharp,m(0,0,h,f,e,i,n,o),_.set(new Uint32Array(this.__memory.buffer,0,a))}}},{}],21:[function(t,e,i){"use strict";e.exports="AGFzbQEAAAABMQZgAXwBfGACfX8AYAZ/f39/f38AYAh/f39/f39/fQBgBH9/f38AYAh/f39/f39/fwACGQIDZW52A2V4cAAAA2VudgZtZW1vcnkCAAEDBgUBAgMEBQQEAXAAAAdMBRZfX2J1aWxkX2dhdXNzaWFuX2NvZWZzAAEOX19nYXVzczE2X2xpbmUAAgpibHVyTW9ubzE2AAMHaHNsX2wxNgAEB3Vuc2hhcnAABQkBAAqJEAXZAQEGfAJAIAFE24a6Q4Ia+z8gALujIgOaEAAiBCAEoCIGtjgCECABIANEAAAAAAAAAMCiEAAiBbaMOAIUIAFEAAAAAAAA8D8gBKEiAiACoiAEIAMgA6CiRAAAAAAAAPA/oCAFoaMiArY4AgAgASAEIANEAAAAAAAA8L+gIAKioiIHtjgCBCABIAQgA0QAAAAAAADwP6AgAqKiIgO2OAIIIAEgBSACoiIEtow4AgwgASACIAegIAVEAAAAAAAA8D8gBqGgIgKjtjgCGCABIAMgBKEgAqO2OAIcCwu3AwMDfwR9CHwCQCADKgIUIQkgAyoCECEKIAMqAgwhCyADKgIIIQwCQCAEQX9qIgdBAEgiCA0AIAIgAC8BALgiDSADKgIYu6IiDiAJuyIQoiAOIAq7IhGiIA0gAyoCBLsiEqIgAyoCALsiEyANoqCgoCIPtjgCACACQQRqIQIgAEECaiEAIAdFDQAgBCEGA0AgAiAOIBCiIA8iDiARoiANIBKiIBMgAC8BALgiDaKgoKAiD7Y4AgAgAkEEaiECIABBAmohACAGQX9qIgZBAUoNAAsLAkAgCA0AIAEgByAFbEEBdGogAEF+ai8BACIIuCINIAu7IhGiIA0gDLsiEqKgIA0gAyoCHLuiIg4gCrsiE6KgIA4gCbsiFKKgIg8gAkF8aioCALugqzsBACAHRQ0AIAJBeGohAiAAQXxqIQBBACAFQQF0ayEHIAEgBSAEQQF0QXxqbGohBgNAIAghAyAALwEAIQggBiANIBGiIAO4Ig0gEqKgIA8iECAToqAgDiAUoqAiDyACKgIAu6CrOwEAIAYgB2ohBiAAQX5qIQAgAkF8aiECIBAhDiAEQX9qIgRBAUoNAAsLCwvfAgIDfwZ8AkAgB0MAAAAAWw0AIARE24a6Q4Ia+z8gB0MAAAA/l7ujIgyaEAAiDSANoCIPtjgCECAEIAxEAAAAAAAAAMCiEAAiDraMOAIUIAREAAAAAAAA8D8gDaEiCyALoiANIAwgDKCiRAAAAAAAAPA/oCAOoaMiC7Y4AgAgBCANIAxEAAAAAAAA8L+gIAuioiIQtjgCBCAEIA0gDEQAAAAAAADwP6AgC6KiIgy2OAIIIAQgDiALoiINtow4AgwgBCALIBCgIA5EAAAAAAAA8D8gD6GgIgujtjgCGCAEIAwgDaEgC6O2OAIcIAYEQCAFQQF0IQogBiEJIAIhCANAIAAgCCADIAQgBSAGEAIgACAKaiEAIAhBAmohCCAJQX9qIgkNAAsLIAVFDQAgBkEBdCEIIAUhAANAIAIgASADIAQgBiAFEAIgAiAIaiECIAFBAmohASAAQX9qIgANAAsLC7wBAQV/IAMgAmwiAwRAQQAgA2shBgNAIAAoAgAiBEEIdiIHQf8BcSECAn8gBEH/AXEiAyAEQRB2IgRB/wFxIgVPBEAgAyIIIAMgAk8NARoLIAQgBCAHIAIgA0kbIAIgBUkbQf8BcQshCAJAIAMgAk0EQCADIAVNDQELIAQgByAEIAMgAk8bIAIgBUsbQf8BcSEDCyAAQQRqIQAgASADIAhqQYECbEEBdjsBACABQQJqIQEgBkEBaiIGDQALCwvTBgEKfwJAIAazQwAAgEWUQwAAyEKVu0QAAAAAAADgP6CqIQ0gBSAEbCILBEAgB0GBAmwhDgNAQQAgAi8BACADLwEAayIGQQF0IgdrIAcgBkEASBsgDk8EQCAAQQJqLQAAIQUCfyAALQAAIgYgAEEBai0AACIESSIJRQRAIAYiCCAGIAVPDQEaCyAFIAUgBCAEIAVJGyAGIARLGwshCAJ/IAYgBE0EQCAGIgogBiAFTQ0BGgsgBSAFIAQgBCAFSxsgCRsLIgogCGoiD0GBAmwiEEEBdiERQQAhDAJ/QQAiCSAIIApGDQAaIAggCmsiCUH/H2wgD0H+AyAIayAKayAQQYCABEkbbSEMIAYgCEYEQCAEIAVrQf//A2wgCUEGbG0MAQsgBSAGayAGIARrIAQgCEYiBhtB//8DbCAJQQZsbUHVqgFBqtUCIAYbagshCSARIAcgDWxBgBBqQQx1aiIGQQAgBkEAShsiBkH//wMgBkH//wNIGyEGAkACfwJAIAxB//8DcSIFBEAgBkH//wFKDQEgBUGAIGogBmxBgBBqQQx2DAILIAZBCHYiBiEFIAYhBAwCCyAFIAZB//8Dc2xBgBBqQQx2IAZqCyIFQQh2IQcgBkEBdCAFa0EIdiIGIQQCQCAJQdWqAWpB//8DcSIFQanVAksNACAFQf//AU8EQEGq1QIgBWsgByAGa2xBBmxBgIACakEQdiAGaiEEDAELIAchBCAFQanVAEsNACAFIAcgBmtsQQZsQYCAAmpBEHYgBmohBAsCfyAGIgUgCUH//wNxIghBqdUCSw0AGkGq1QIgCGsgByAGa2xBBmxBgIACakEQdiAGaiAIQf//AU8NABogByIFIAhBqdUASw0AGiAIIAcgBmtsQQZsQYCAAmpBEHYgBmoLIQUgCUGr1QJqQf//A3EiCEGp1QJLDQAgCEH//wFPBEBBqtUCIAhrIAcgBmtsQQZsQYCAAmpBEHYgBmohBgwBCyAIQanVAEsEQCAHIQYMAQsgCCAHIAZrbEEGbEGAgAJqQRB2IAZqIQYLIAEgBDoAACABQQFqIAU6AAAgAUECaiAGOgAACyADQQJqIQMgAkECaiECIABBBGohACABQQRqIQEgC0F/aiILDQALCwsL"},{}],22:[function(t,e,i){"use strict";var n,r=t("./base64decode");e.exports=function(){if(void 0!==n)return n;if(n=!1,"undefined"==typeof WebAssembly)return n;try{var t=new WebAssembly.Module(r("AGFzbQEAAAABBQFgAAF/Ag8BA2VudgZtZW1vcnkCAAEDAgEABAQBcAAABwoBBmRldGVjdAAACQEACgYBBABBAQs=")),e={memoryBase:0,memory:new WebAssembly.Memory({initial:1}),tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};return 1===(0,new WebAssembly.Instance(t,{env:e}).exports.detect)()&&(n=!0),n}catch(t){}return n}},{"./base64decode":16}],23:[function(t,e,i){"use strict";function n(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}var r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},i=0;i<10;i++)e["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(t){n[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var i,s,l=n(t),c=1;c<arguments.length;c++){i=Object(arguments[c]);for(var u in i)o.call(i,u)&&(l[u]=i[u]);if(r){s=r(i);for(var h=0;h<s.length;h++)a.call(i,s[h])&&(l[s[h]]=i[s[h]])}}return l}},{}],24:[function(t,e,i){var n=arguments[3],r=arguments[4],o=arguments[5],a=JSON.stringify;e.exports=function(t,e){function i(t){g[t]=!0;for(var e in r[t][1]){var n=r[t][1][e];g[n]||i(n)}}for(var s,l=Object.keys(o),c=0,u=l.length;c<u;c++){var h=l[c],f=o[h].exports;if(f===t||f&&f.default===t){s=h;break}}if(!s){s=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var d={},c=0,u=l.length;c<u;c++){var h=l[c];d[h]=h}r[s]=[Function(["require","module","exports"],"("+t+")(self)"),d]}var p=Math.floor(Math.pow(16,8)*Math.random()).toString(16),A={};A[s]=s,r[p]=[Function(["require"],"var f = require("+a(s)+");(f.default ? f.default : f)(self);"),A];var g={};i(p);var _="("+n+")({"+Object.keys(g).map(function(t){return a(t)+":["+r[t][0]+","+a(r[t][1])+"]"}).join(",")+"},{},["+a(p)+"])",m=window.URL||window.webkitURL||window.mozURL||window.msURL,v=new Blob([_],{type:"text/javascript"});if(e&&e.bare)return v;var y=m.createObjectURL(v),w=new Worker(y);return w.objectURL=y,w}},{}],"/":[function(t,e,i){"use strict";function n(){return{value:a(u),destroy:function(){if(this.value.terminate(),"undefined"!=typeof window){var t=window.URL||window.webkitURL||window.mozURL||window.msURL;t&&t.revokeObjectURL&&this.value.objectURL&&t.revokeObjectURL(this.value.objectURL)}}}}function r(t){if(!(this instanceof r))return new r(t);this.options=o(A,t||{});var e="lk_"+this.options.concurrency;this.__limit=f[e]||c.limiter(this.options.concurrency),f[e]||(f[e]=this.__limit),this.features={js:!1,wasm:!1,cib:!1,ww:!1},this.__workersPool=null,this.__requested_features=[],this.__mathlib=null}var o=t("object-assign"),a=t("webworkify"),s=t("./lib/mathlib"),l=t("./lib/pool"),c=t("./lib/utils"),u=t("./lib/worker"),h=t("./lib/tiler"),f={},d=!1;try{"undefined"!=typeof navigator&&navigator.userAgent&&(d=navigator.userAgent.indexOf("Safari")>=0)}catch(t){}var p=1;"undefined"!=typeof navigator&&(p=Math.min(navigator.hardwareConcurrency||1,4));var A={tile:1024,concurrency:p,features:["js","wasm","ww"],idle:2e3},g={quality:3,alpha:!1,unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0},_=void 0,m=void 0;r.prototype.init=function(){var e=this;if(this.__initPromise)return this.__initPromise;if(!1!==_&&!0!==_&&(_=!1,"undefined"!=typeof ImageData&&"undefined"!=typeof Uint8ClampedArray))try{new ImageData(new Uint8ClampedArray(400),10,10),_=!0}catch(t){}!1!==m&&!0!==m&&(m=!1,"undefined"!=typeof ImageBitmap&&(ImageBitmap.prototype&&ImageBitmap.prototype.close?m=!0:this.debug("ImageBitmap does not support .close(), disabled")));var i=this.options.features.slice();if(i.indexOf("all")>=0&&(i=["cib","wasm","js","ww"]),this.__requested_features=i,this.__mathlib=new s(i),i.indexOf("ww")>=0&&"undefined"!=typeof window&&"Worker"in window)try{t("webworkify")(function(){}).terminate(),this.features.ww=!0;var r="wp_"+JSON.stringify(this.options);f[r]?this.__workersPool=f[r]:(this.__workersPool=new l(n,this.options.idle),f[r]=this.__workersPool)}catch(t){}var a=this.__mathlib.init().then(function(t){o(e.features,t.features)}),u=void 0;return u=m?c.cib_support().then(function(t){if(e.features.cib&&i.indexOf("cib")<0)return void e.debug("createImageBitmap() resize supported, but disabled by config");i.indexOf("cib")>=0&&(e.features.cib=t)}):Promise.resolve(!1),this.__initPromise=Promise.all([a,u]).then(function(){return e}),this.__initPromise},r.prototype.resize=function(t,e,i){var n=this;this.debug("Start resize...");var r=g;isNaN(i)?i&&(r=o(r,i)):r=o(r,{quality:i}),r.toWidth=e.width,r.toHeigth=e.height,r.width=t.naturalWidth||t.width,r.height=t.naturalHeight||t.height;var a=!1,s=null;r.cancelToken&&(s=r.cancelToken.then(function(t){throw a=!0,t},function(t){throw a=!0,t}));var l=e.getContext("2d",{alpha:Boolean(r.alpha)});return this.init().then(function(){if(a)return s;if(n.features.cib)return n.debug("Resize via createImageBitmap()"),createImageBitmap(t,{resizeWidth:r.toWidth,resizeHeight:r.toHeigth,resizeQuality:c.cib_quality_name(r.quality)}).then(function(t){if(a)return s;if(!r.unsharpAmount)return l.drawImage(t,0,0),t.close(),l=null,n.debug("Finished!"),e;n.debug("Unsharp result");var i=document.createElement("canvas");i.width=r.toWidth,i.height=r.toHeigth;var o=i.getContext("2d",{alpha:Boolean(r.alpha)});o.drawImage(t,0,0),t.close();var c=o.getImageData(0,0,r.toWidth,r.toHeigth);return n.__mathlib.unsharp(c.data,r.toWidth,r.toHeigth,r.unsharpAmount,r.unsharpRadius,r.unsharpThreshold),l.putImageData(c,0,0),c=o=i=l=null,n.debug("Finished!"),e});var i=void 0,o=void 0,u={},f=function(t){return Promise.resolve().then(function(){return n.features.ww?new Promise(function(e,i){var r=n.__workersPool.acquire();s&&s.catch(function(t){return i(t)}),r.value.onmessage=function(t){r.release(),t.data.err?i(t.data.err):e(t.data.result)},r.value.postMessage({opts:t,features:n.__requested_features,preload:{wasm_nodule:n.__mathlib.__}},[t.src.buffer])}):n.__mathlib.resizeAndUnsharp(t,u)})},p=function(e){return n.__limit(function(){if(a)return s;var u=void 0;if(c.isCanvas(t))n.debug("Get tile pixel data"),u=i.getImageData(e.x,e.y,e.width,e.height);else{n.debug("Draw tile imageBitmap/image to temporary canvas");var h=document.createElement("canvas");h.width=e.width,h.height=e.height;var p=h.getContext("2d",{alpha:Boolean(r.alpha)});p.globalCompositeOperation="copy",p.drawImage(o||t,e.x,e.y,e.width,e.height,0,0,e.width,e.height),n.debug("Get tile pixel data"),u=p.getImageData(0,0,e.width,e.height),p=h=null}var A={src:u.data,width:e.width,height:e.height,toWidth:e.toWidth,toHeight:e.toHeight,scaleX:e.scaleX,scaleY:e.scaleY,offsetX:e.offsetX,offsetY:e.offsetY,quality:r.quality,alpha:r.alpha,unsharpAmount:r.unsharpAmount,unsharpRadius:r.unsharpRadius,unsharpThreshold:r.unsharpThreshold};return n.debug("Invoke resize math"),Promise.resolve().then(function(){return f(A)}).then(function(t){if(a)return s;u=null;var i=void 0;if(n.debug("Convert raw rgba tile result to ImageData"),_)i=new ImageData(new Uint8ClampedArray(t),e.toWidth,e.toHeight);else if(i=l.createImageData(e.toWidth,e.toHeight),i.data.set)i.data.set(t);else for(var r=i.data.length-1;r>=0;r--)i.data[r]=t[r];return n.debug("Draw tile"),d?l.putImageData(i,e.toX,e.toY,e.toInnerX-e.toX,e.toInnerY-e.toY,e.toInnerWidth+1e-5,e.toInnerHeight+1e-5):l.putImageData(i,e.toX,e.toY,e.toInnerX-e.toX,e.toInnerY-e.toY,e.toInnerWidth,e.toInnerHeight),null})})};return Promise.resolve().then(function(){if(c.isCanvas(t))return i=t.getContext("2d",{alpha:Boolean(r.alpha)}),null;if(c.isImage(t))return m?(n.debug("Decode image via createImageBitmap"),createImageBitmap(t).then(function(t){o=t})):null;throw new Error('".from" should be image or canvas')}).then(function(){function t(){o&&(o.close(),o=null)}if(a)return s;n.debug("Calculate tiles");var i=h({width:r.width,height:r.height,srcTileSize:n.options.tile,toWidth:r.toWidth,toHeight:r.toHeigth,destTileBorder:Math.ceil(Math.max(3,2.5*r.unsharpRadius|0))}),l=i.map(function(t){return p(t)});return n.debug("Process tiles"),Promise.all(l).then(function(){return n.debug("Finished!"),t(),e},function(e){throw t(),e})})})},r.prototype.resizeBuffer=function(t){var e=this,i=o(g,t);return this.init().then(function(){return e.__mathlib.resizeAndUnsharp(i)})},r.prototype.toBlob=function(t,e,i){return e=e||"image/png",new Promise(function(n){if(t.toBlob)return void t.toBlob(function(t){return n(t)},e,i);for(var r=atob(t.toDataURL(e,i).split(",")[1]),o=r.length,a=new Uint8Array(o),s=0;s<o;s++)a[s]=r.charCodeAt(s);n(new Blob([a],{type:e}))})},r.prototype.debug=function(){},e.exports=r},{"./lib/mathlib":1,"./lib/pool":9,"./lib/tiler":10,"./lib/utils":11,"./lib/worker":12,"object-assign":23,webworkify:24}]},{},[])("/")})},function(t,e){function i(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function r(t){if(u===setTimeout)return setTimeout(t,0);if((u===i||!u)&&setTimeout)return u=setTimeout,setTimeout(t,0);try{return u(t,0)}catch(e){try{return u.call(null,t,0)}catch(e){return u.call(this,t,0)}}}function o(t){if(h===clearTimeout)return clearTimeout(t);if((h===n||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(t);try{return h(t)}catch(e){try{return h.call(null,t)}catch(e){return h.call(this,t)}}}function a(){A&&d&&(A=!1,d.length?p=d.concat(p):g=-1,p.length&&s())}function s(){if(!A){var t=r(a);A=!0;for(var e=p.length;e;){for(d=p,p=[];++g<e;)d&&d[g].run();g=-1,e=p.length}d=null,A=!1,o(t)}}function l(t,e){this.fun=t,this.array=e}function c(){}var u,h,f=t.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:i}catch(t){u=i}try{h="function"==typeof clearTimeout?clearTimeout:n}catch(t){h=n}}();var d,p=[],A=!1,g=-1;f.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];p.push(new l(t,e)),1!==p.length||A||r(s)},l.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=c,f.addListener=c,f.once=c,f.off=c,f.removeListener=c,f.removeAllListeners=c,f.emit=c,f.prependListener=c,f.prependOnceListener=c,f.listeners=function(t){return[]},f.binding=function(t){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(t){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},function(t,e,i){(function(t,e){!function(t,i){"use strict";function n(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),i=0;i<e.length;i++)e[i]=arguments[i+1];var n={callback:t,args:e};return c[l]=n,s(l),l++}function r(t){delete c[t]}function o(t){var e=t.callback,n=t.args;switch(n.length){case 0:e();break;case 1:e(n[0]);break;case 2:e(n[0],n[1]);break;case 3:e(n[0],n[1],n[2]);break;default:e.apply(i,n)}}function a(t){if(u)setTimeout(a,0,t);else{var e=c[t];if(e){u=!0;try{o(e)}finally{r(t),u=!1}}}}if(!t.setImmediate){var s,l=1,c={},u=!1,h=t.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(t);f=f&&f.setTimeout?f:t,"[object process]"==={}.toString.call(t.process)?function(){s=function(t){e.nextTick(function(){a(t)})}}():function(){if(t.postMessage&&!t.importScripts){var e=!0,i=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=i,e}}()?function(){var e="setImmediate$"+Math.random()+"$",i=function(i){i.source===t&&"string"==typeof i.data&&0===i.data.indexOf(e)&&a(+i.data.slice(e.length))};t.addEventListener?t.addEventListener("message",i,!1):t.attachEvent("onmessage",i),s=function(i){t.postMessage(e+i,"*")}}():t.MessageChannel?function(){var t=new MessageChannel;t.port1.onmessage=function(t){a(t.data)},s=function(e){t.port2.postMessage(e)}}():h&&"onreadystatechange"in h.createElement("script")?function(){var t=h.documentElement;s=function(e){var i=h.createElement("script");i.onreadystatechange=function(){a(e),i.onreadystatechange=null,t.removeChild(i),i=null},t.appendChild(i)}}():function(){s=function(t){setTimeout(a,0,t)}}(),f.setImmediate=n,f.clearImmediate=r}}("undefined"==typeof self?void 0===t?this:t:self)}).call(e,i(74),i(71))},function(t,e,i){function n(t,e){this._id=t,this._clearFn=e}var r=Function.prototype.apply;e.setTimeout=function(){return new n(r.call(setTimeout,window,arguments),clearTimeout)},e.setInterval=function(){return new n(r.call(setInterval,window,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},n.prototype.unref=n.prototype.ref=function(){},n.prototype.close=function(){this._clearFn.call(window,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},i(72),e.setImmediate=setImmediate,e.clearImmediate=clearImmediate},function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i}]);