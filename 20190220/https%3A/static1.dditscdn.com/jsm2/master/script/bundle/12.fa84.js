(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{6900:function(e,t,s){var o=s("1029"),i=s("d869"),n=s("a2ae"),r=s("6ff1"),a=s("b89f"),h=s("a142"),l=s("1a5f"),u=s("0592").default,c=s("e568"),d=s("1cab").default,m=s("a9a1").store,E=s("1af1").updateEliteProfile,p=function(e,t){p.superclass.constructor.call(this,e,t)};e.exports=Ext.extend(p,o.Component,{name:"SignUpComponent",signUpFormId:"signup_form",maxEmailLength:255,maxUsernameLength:16,maxPasswordLength:128,usernameInputId:"username",hintContainerId:"hint_node",passwordId:"password",emailId:"email",isAjaxForm:!0,getCreditIndexRoute:"Credit/Index",isStandalone:!0,init:function(e,t){p.superclass.init.call(this,e,t),o.addEvents(i.SignUpComponent.EVENT_SIGNUP_SUCCESS),this._setController(),this._setComponents(),o.on(this._controller,"show-suggested-name",this.onShowSuggestedName,this),o.on(this._controller,"hide-suggested-name",this.onHideSuggestedName,this)},_setController:function(){return this._controller instanceof n||(this._controller=new n({items:{view:{component:this._setView(),listeners:{"login-link-click":"onLoginLinkClick","signup-show-suggested-name":"onShowSuggestedName","signup-hide-suggested-name":"onHideSuggestedName"}}}})),this._controller},_setView:function(){return this._view instanceof r||(this._view=new r({containerId:this.element.id,isStandalone:this.isStandalone,model:this._setModel()})),this._view},_setModel:function(){return this._model instanceof a||(this._model=new a),this._model},_setComponents:function(){this._setSignUpForm(),this._setUserNameCharacterCounter(),this._setPasswordCharacterCounter(),this._setEmailCharacterCounter()},_setSignUpForm:function(){this._signUpForm=new h(this.signUpFormId,{isAjax:this.isAjaxForm,scope:this,success:this.signUpFormSuccessCallBack}),o.on([{element:this._signUpForm,event:"validationError",handler:this.onSignUpFormValidationError}],this)},_setUserNameCharacterCounter:function(){this._usernameCharacterCounterCmp=new l(this.signUpFormId,{maxChar:this.maxUsernameLength,hasWarningLimit:!1,inputId:this.usernameInputId,charInfoId:this.hintContainerId,isShowCounter:!1,isMaxCharSound:!0}),o.on(this._usernameCharacterCounterCmp,i.CharacterCounter.EVENT_MAX_CHAR_LIMIT_REACHED,this.onMaxCharacterLimitReached,this)},_setPasswordCharacterCounter:function(){this._passwordCharacterCounterCmp=new l(this.signUpFormId,{maxChar:this.maxPasswordLength,hasWarningLimit:!1,inputId:this.passwordId,charInfoId:this.hintContainerId,isShowCounter:!1,isMaxCharSound:!0}),o.on(this._passwordCharacterCounterCmp,i.CharacterCounter.EVENT_MAX_CHAR_LIMIT_REACHED,this.onMaxCharacterLimitReached,this)},_setEmailCharacterCounter:function(){this._emailCharacterCounterCmp=new l(this.signUpFormId,{maxChar:this.maxEmailLength,hasWarningLimit:!1,inputId:this.emailId,charInfoId:this.hintContainerId,isShowCounter:!1,isMaxCharSound:!0}),o.on(this._emailCharacterCounterCmp,i.CharacterCounter.EVENT_MAX_CHAR_LIMIT_REACHED,this.onMaxCharacterLimitReached,this)},_sendGoogleAnalyticsEvent:function(e,t){d.push({event:d.CONST.EVENT.GENERIC,eventCategory:d.CONST.PAGE.SIGNUP,eventAction:d.CONST.ACTION.SIGNUP,eventLabel:e,eventValue:0,eventInteraction:!0,eventCallback:t,eventTimeout:d.CONST.EVENT_TIMEOUT})},signUpFormSuccessCallBack:function(e,t){var s=t.json.data,i=s.trackingHtml,n=s.nick,r=s.memberIdHash;this._signUpSuccessCallBackResponse=t,i&&Ext.DomHelper.append(Ext.getBody(),i),n&&(m.dispatch(E(s.elite.profile)),c.setMemberNick(n),c.setMemberIdHash(r),c.setIsLoggedIn(!0),d.updateUserData()),this._signUpSuccessCallBackResponse.json.data.isFreeRegEnabled?(this._sendGoogleAnalyticsEvent("correct"),this._showSignUpSuccessModals(this._signUpSuccessCallBackResponse)):this._sendGoogleAnalyticsEvent("correct",o.bind(function(){location.href=o.getUrl(this.getCreditIndexRoute,{},{},"")},this))},onSignUpFormValidationError:function(){this._sendGoogleAnalyticsEvent("incorrect")},_showSignUpSuccessModals:function(e){o.fireEvent(i.SignUpComponent.EVENT_SIGNUP_SUCCESS,e),o.Config.set("isOverlayPending",!0),o.Config.set("promoType","signup"),o.Config.set("isPromoNeeded",!0),u.navigateBack()},destroyForm:function(){this._signUpForm&&(this._signUpForm.unbind(),this._signUpForm=null)},onMaxCharacterLimitReached:function(e){o.fireEvent(i.TooltipView.EVENT_SHOW_TOOLTIP,{element:e.field.dom,attributes:{title:e.field.dom.getAttribute("alt")}})},destroy:function(){this.destroyForm(),this._usernameCharacterCounterCmp.destroy(),this._passwordCharacterCounterCmp.destroy(),p.superclass.destroy.call(this)},onShowSuggestedName:function(){this._signUpForm.disableForm(!0)},onHideSuggestedName:function(){this._signUpForm.disableForm(!1)}})},"6ff1":function(e,t,s){var i=s("1029"),n=s("d869"),r=s("5f9e"),o=function(e,t){o.superclass.constructor.call(this,e,t)};e.exports=Ext.extend(o,i.View,{name:"SignUpView",signupButtonId:"signup_submit",suggestedUserName:"suggested_username",usernameInputId:"username",formTokenId:"form_token_signup",loginButtonId:"login_link",userNameExistsWrapperId:"username_exists",durationTime:.5,emailId:"email",showCls:"show",suggestedUsernameId:"suggested_username",userNameExistsId:"username_exists",usernameFieldErrorId:"username_error",isSuggestNameExist:!1,USERNAME_EXISTS:"usernameExists",init:function(){this.addEvents(n.SignUpView.EVENT_SIGNUP_SHOW_SUGGESTED_NAME,n.SignUpView.EVENT_SIGNUP_HIDE_SUGGESTED_NAME,n.SignUpView.EVENT_LOGIN_LINK_CLICK),this.getElements(),this._userNameInputEl.focus(),this._turnOffInputsAutoComplete(),o.superclass.init.call(this)},getElements:function(){this._userNameSuggestContEl=Ext.get(this.userNameExistsWrapperId),this._userNameInputEl=Ext.get(this.usernameInputId),this._userNameFieldContainer=this._userNameInputEl.parent(),this._loginButtonEl=Ext.get(this.loginButtonId),this._emailInputEl=Ext.get(this.emailId),this.suggestedUsernameEl=Ext.get(this.suggestedUsernameId),this._formTokenEl=Ext.get(this.formTokenId),this.signupButtonEl=Ext.get(this.signupButtonId),this.usernameFieldErrorEl=Ext.get(this.usernameFieldErrorId)},_turnOffInputsAutoComplete:function(){this._userNameInputEl.set({autocomplete:"off"}),this._emailInputEl.set({autocomplete:"off"})},onSuggestedUsernameClick:function(e){e.preventDefault(),this._userNameInputEl.dom.value=this.suggestedUsernameEl.dom.innerHTML,this._userNameInputEl.dom.noShow=!0,this.displayUsernameRefresh(!1),this.usernameFieldErrorEl.fadeOut()},displayUsernameRefresh:function(e){e!==this.USERNAME_EXISTS||this.usernameRefreshOpened||(this.model.getNewNick(this._userNameInputEl.dom.value),this.isSuggestNameExist&&(this.isSuggestNameExist=!1,this._userNameSuggestContEl.addClass(this.showCls),this.usernameRefreshOpened=!0,this.fireEvent(n.SignUpView.EVENT_SIGNUP_SHOW_SUGGESTED_NAME,this))),!e&&this.usernameRefreshOpened&&(this._userNameSuggestContEl.removeClass(this.showCls),this.usernameRefreshOpened=!1,this.fireEvent(n.SignUpView.EVENT_SIGNUP_HIDE_SUGGESTED_NAME,this))},onCheckNickSuccess:function(){this.displayUsernameRefresh(!1),this.usernameFieldErrorEl.fadeOut()},onCheckNickError:function(e){var t=this._userNameInputEl.dom.offsetWidth+this._userNameInputEl.dom.offsetLeft;this.displayUsernameRefresh(!1),this.displayUsernameRefresh(this.USERNAME_EXISTS),e.json.errors&&!this._userNameFieldContainer.hasClass("protip-open")&&(this.usernameFieldErrorEl.select("p").item(0).dom.innerHTML=e.json.errors,this.usernameFieldErrorEl.dom.setAttribute("style","left:"+t+"px; top: 30px;"),this.usernameFieldErrorEl.fadeIn())},onNickBlur:function(){var e=this._userNameInputEl.getValue(),t={nick:e,email:this._emailInputEl.getValue(),csrfToken:this._formTokenEl.getValue()};""!==e&&e!==this.currentNickValue&&this.model.checkNick(t)},onNickClick:function(){this.currentNickValue=this._userNameInputEl.getValue(),Ext.get(this.usernameFieldErrorId).setStyle({visibility:"hidden",display:"none"})},onLoginButtonClick:function(e){this.isStandalone||(e.preventDefault(),this.fireEvent(n.SignUpView.EVENT_LOGIN_LINK_CLICK,this))},onGetNewNickSuccess:function(e){this.isSuggestNameExist=!0,this.suggestedUsernameEl.dom.innerHTML=e,this.displayUsernameRefresh(this.USERNAME_EXISTS)},bind:function(){r.registerCommand("displayUsernameRefresh",this.displayUsernameRefresh,this),i.on([{element:this._loginButtonEl,event:"click",handler:this.onLoginButtonClick,scope:this},{element:this.suggestedUsernameEl,event:"click",handler:this.onSuggestedUsernameClick,scope:this},{element:this._userNameInputEl,event:"click",handler:this.onNickClick,scope:this},{element:this._userNameInputEl,event:"blur",handler:this.onNickBlur,scope:this},{element:this._emailInputEl,event:"blur",handler:this.onNickBlur,scope:this},{element:this.model,event:n.SignUpModel.EVENT_CHECKNICK_SUCCESS,handler:this.onCheckNickSuccess},{element:this.model,event:n.SignUpModel.EVENT_CHECKNICK_ERROR,handler:this.onCheckNickError},{element:this.model,event:n.SignUpModel.EVENT_GETNEWUSERNAME_SUCCESS,handler:this.onGetNewNickSuccess}],this)}})},a142:function(e,t,s){var i=s("1029"),n=s("f306"),r=s("81d7").default,o=function(e,t){o.superclass.constructor.call(this,e,t)};e.exports=Ext.extend(o,n,{name:"SignUpForm",formErrorSel:"warning_tag",isAjax:!0,isBackConnNeeded:!0,requestParams:["username","password","email","form_token","free_peeks_token","captcha","captcha_id","recaptcha","submit_button","listPageId"],disableSubmitOnSubmit:!0,hasCaptcha:!0,useModalForGeneralErrors:!1,errorHideDuration:0,passwordId:"password",userNameId:"username",identicalPasswordTranslateKey:"The username and the password cannot be the same",init:function(e,t){o.superclass.init.call(this,e,t),this.reCaptchaContainer=Ext.get("reCaptchaSignUp")},renderReCaptcha:function(){r.render({containerId:"reCaptchaSignUp",tokenInputId:"reCaptchaSignUpInput",callback:this.onReCaptchaTokenSet.bind(this),errorCallback:this.reCaptchaErrorHandler.bind(this)})},reCaptchaErrorHandler:function(){this.showError(Ext.get("username"),i.translate("An unexpected error occurred, try again later.")),this._formSubmitInProgress=!1,this.setSubmitEnabled(!0)},checkField:function(e,t,s){var i=o.superclass.checkField.call(this,e,t,s);return i&&s&&(this.isUserNameField(e)||this.isPasswordField(e))&&(i=this.checkIdenticalPassword()),i},isUserNameField:function(e){return e.id===this.userNameId},isPasswordField:function(e){return e.id===this.passwordId},checkIdenticalPassword:function(){var e=!0,t=Ext.fly(this.userNameId).dom.value;return t!==Ext.fly(this.passwordId).dom.value||i.isEmpty(t)||(this.showError(Ext.fly(this.passwordId).dom,i.translate(this.identicalPasswordTranslateKey)),e=!1),e},isExistingExternalError:function(e){var t=!1;return(this.isUserNameField(e)||this.isPasswordField(e))&&(t=!this.checkIdenticalPassword()),t},submitForm:function(e){if(e.preventDefault(),this.hasError=this.validateAll(this.showErrorsOnSubmit),!this.submitOnSubmit||this.isFormDisabled)return e.preventDefault(),this.fireEvent("before-submit",{scope:this}),!this.hasError;this.hasError?this.fireEvent("validationError",this.element):(this.setSubmitEnabled(!this.disableSubmitOnSubmit),r.isActive&&!r.token?(this.renderReCaptcha(),this._formSubmitInProgress=!0):(this.fireEvent("submit",this.element),this.isAjax?this.submit.call(this,e,e.target):this.element.dom.submit()))},onReCaptchaTokenSet:function(){this._formSubmitInProgress&&(this._formSubmitInProgress=!1,this.setSubmitEnabled(!0),Ext.fly("signup_submit").dom.click())},showError:function(e,t){"captcha"===e&&r.isActive||o.superclass.showError.call(this,e,t)},onError:function(e){o.superclass.onError.call(this,e),i.isObject(e.errors)&&e.errors.captcha&&r.isActive&&(this.setSubmitEnabled(!0),Ext.fly("signup_submit").dom.click())}})},a2ae:function(e,t,s){var i=s("1029"),n=s("d869"),r=s("0592").default,o=function(e,t){o.superclass.constructor.call(this,e,t)};e.exports=Ext.extend(o,i.Controller,{name:"SignUpController",init:function(e,t){o.superclass.init.call(this,e,t),this.addEvents(n.SignUpController.EVENT_SIGNUP_SHOW_SUGGESTED_NAME,n.SignUpController.EVENT_SIGNUP_HIDE_SUGGESTED_NAME)},onLoginLinkClick:function(){r.navigate("login",{trigger:!0,replace:!0,preventNavigateBack:!0})},onShowSuggestedName:function(){this.fireEvent(n.SignUpController.EVENT_SIGNUP_SHOW_SUGGESTED_NAME)},onHideSuggestedName:function(){this.fireEvent(n.SignUpController.EVENT_SIGNUP_HIDE_SUGGESTED_NAME)}})},b89f:function(e,t,s){var i=s("1029"),n=s("d869"),r=s("5f9e"),o=function(e,t){o.superclass.constructor.call(this,e,t)};e.exports=Ext.extend(o,i.Model,{name:"SignUpModel",nickCheckRoute:"Validate/CheckNick",newNickRoute:"Validate/GetNewNick",init:function(){o.superclass.init.call(this),this.addEvents(n.SignUpModel.EVENT_CHECKNICK_SUCCESS,n.SignUpModel.EVENT_CHECKNICK_ERROR,n.SignUpModel.EVENT_GETNEWUSERNAME_SUCCESS)},getNewNick:function(e){var t=r.setXDomainUrl(i.getUrl(this.newNickRoute,{},{nick:e},""));this.fetch({url:t,method:"GET",xdomain:!0,success:i.bind(this.onGetNewNickSuccess,this)})},onGetNewNickSuccess:function(e){this.fireEvent(n.SignUpModel.EVENT_GETNEWUSERNAME_SUCCESS,e.json.username)},checkNick:function(e){this.fetch({type:"json",method:"POST",url:i.getUrl(this.nickCheckRoute,{},{},""),scope:this,params:e,success:i.bind(this.onCheckNickSuccess,this),error:i.bind(this.onCheckNickError,this)})},onCheckNickSuccess:function(){this.fireEvent(n.SignUpModel.EVENT_CHECKNICK_SUCCESS)},onCheckNickError:function(e){this.fireEvent(n.SignUpModel.EVENT_CHECKNICK_ERROR,e)},onError:function(e,t){i.isFunction(t)&&t(e)}})}}]);