!function(e){function t(i){if(n[i])return n[i].exports;var s=n[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=12)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensionEventActions=void 0;var i=n(14);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var s=n(15);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var r=n(16);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var o=n(17);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var a=n(18);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});t.ExtensionEventActions=[s.SupervisorAction.SupervisorReady,i.ExtensionAction.TwitchExtLoaded,i.ExtensionAction.TwitchExtLongtask,i.ExtensionAction.TwitchExtUserAction,i.ExtensionAction.TwitchExtNetworkTiming,i.ExtensionAction.TwitchExtBeginPurchase,i.ExtensionAction.TwitchExtBitsOnHover,i.ExtensionAction.TwitchExtUseBits,i.ExtensionAction.TwitchExtPubSubReceived,i.ExtensionAction.TwitchExtPubsubListen,i.ExtensionAction.TwitchExtPubsubUnlisten,r.FunctionAction.FollowAction,r.FunctionAction.FollowStatusRequest,r.FunctionAction.IdShareRequest,r.FunctionAction.TwitchExtMinimize]},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(2),o=function(e){return e&&e.__esModule?e:{default:e}}(r),a=function(){},c=a,u={},l={DEBUG:1,INFO:2,WARNING:3,ERROR:4,CRITICAL:5},h=l.WARNING,f=function(){function e(t){i(this,e),this._opts=t}return s(e,[{key:"debug",value:function(e){h<=l.DEBUG&&this._log("DEBUG: "+e)}},{key:"info",value:function(e){h<=l.INFO&&this._log("INFO: "+e)}},{key:"warning",value:function(e){h<=l.WARNING&&this._log("WARNING: "+e)}},{key:"error",value:function(e){h<=l.ERROR&&this._log("ERROR: "+e)}},{key:"critical",value:function(e){h<=l.CRITICAL&&this._log("CRITICAL: "+e)}},{key:"_log",value:function(e){var t=this._opts.prefix+e;this._opts.logFunc?this._opts.logFunc(t):c(t)}}]),e}(),d={setLogger:function(e){c="function"==typeof e?e:a},setLevel:function(){var e=(o.default.urlParams.pubsub_log_level||"").toUpperCase();if(e){var t=l[e];if(t)return h=t,function(){}}return function(e){h=e?l[e.toUpperCase()]||l.WARNING:l.WARNING}}(),_getLogger:function(e){return u[e]||(u[e]=new f({prefix:"pubsub.js ["+e+"] "})),u[e]},_noopLogger:new f({prefix:"",logFunc:a})},p=window.console;p&&p.log&&(p.log.apply?d.setLogger(function(){p.log.apply(p,arguments)}):d.setLogger(function(){for(var e=[],t=0;t<arguments.length;++t)e.push(arguments[t]);p.log(e.join(" "))})),t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={};i.randomInt=function(e){return Math.floor(Math.random()*e)},i.time={seconds:function(e){return 1e3*e},now:function(){return(new Date).getTime()}},i.urlParams=function(){for(var e={},t=window.location.search.substr(1),n=t.split("&"),i=0;i<n.length;++i){var s=n[i].split("=");e[decodeURIComponent(s[0])]=s.length>1?decodeURIComponent(s[1]):""}return e}(),i.generateString=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=0;s<e;s++)t+=n.charAt(i.randomInt(n.length));return t},i.inIframe=function(){try{return window.self!==window.top}catch(e){return!0}},t.default=i},function(e,t,n){"use strict";(function(i){var s,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(o){function a(){this._events={},this._conf&&c.call(this,this._conf)}function c(e){e?(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),this._maxListeners=e.maxListeners!==o?e.maxListeners:p,e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),this.wildcard&&(this.listenerTree={})):this._maxListeners=p}function u(e,t){var n="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(n+=" Event name: "+t+"."),void 0!==i&&i.emitWarning){var s=new Error(n);s.name="MaxListenersExceededWarning",s.emitter=this,s.count=e,i.emitWarning(s)}else console.error(n),console.trace&&console.trace()}function l(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,c.call(this,e)}function h(e,t,n,i){if(!n)return[];var s,r,o,a,c,u,l,f=[],d=t.length,p=t[i],_=t[i+1];if(i===d&&n._listeners){if("function"==typeof n._listeners)return e&&e.push(n._listeners),[n];for(s=0,r=n._listeners.length;s<r;s++)e&&e.push(n._listeners[s]);return[n]}if("*"===p||"**"===p||n[p]){if("*"===p){for(o in n)"_listeners"!==o&&n.hasOwnProperty(o)&&(f=f.concat(h(e,t,n[o],i+1)));return f}if("**"===p){l=i+1===d||i+2===d&&"*"===_,l&&n._listeners&&(f=f.concat(h(e,t,n,d)));for(o in n)"_listeners"!==o&&n.hasOwnProperty(o)&&("*"===o||"**"===o?(n[o]._listeners&&!l&&(f=f.concat(h(e,t,n[o],d))),f=f.concat(h(e,t,n[o],i))):f=o===_?f.concat(h(e,t,n[o],i+2)):f.concat(h(e,t,n[o],i)));return f}f=f.concat(h(e,t,n[p],i+1))}if(a=n["*"],a&&h(e,t,a,i+1),c=n["**"])if(i<d){c._listeners&&h(e,t,c,d);for(o in c)"_listeners"!==o&&c.hasOwnProperty(o)&&(o===_?h(e,t,c[o],i+2):o===p?h(e,t,c[o],i+1):(u={},u[o]=c[o],h(e,t,{"**":u},i+1)))}else c._listeners?h(e,t,c,d):c["*"]&&c["*"]._listeners&&h(e,t,c["*"],d);return f}function f(e,t){e="string"==typeof e?e.split(this.delimiter):e.slice();for(var n=0,i=e.length;n+1<i;n++)if("**"===e[n]&&"**"===e[n+1])return;for(var s=this.listenerTree,r=e.shift();r!==o;){if(s[r]||(s[r]={}),s=s[r],0===e.length)return s._listeners?("function"==typeof s._listeners&&(s._listeners=[s._listeners]),s._listeners.push(t),!s._listeners.warned&&this._maxListeners>0&&s._listeners.length>this._maxListeners&&(s._listeners.warned=!0,u.call(this,s._listeners.length,r))):s._listeners=t,!0;r=e.shift()}return!0}var d=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},p=10;l.EventEmitter2=l,l.prototype.delimiter=".",l.prototype.setMaxListeners=function(e){e!==o&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},l.prototype.event="",l.prototype.once=function(e,t){return this._once(e,t,!1)},l.prototype.prependOnceListener=function(e,t){return this._once(e,t,!0)},l.prototype._once=function(e,t,n){return this._many(e,1,t,n),this},l.prototype.many=function(e,t,n){return this._many(e,t,n,!1)},l.prototype.prependMany=function(e,t,n){return this._many(e,t,n,!0)},l.prototype._many=function(e,t,n,i){function s(){return 0==--t&&r.off(e,s),n.apply(this,arguments)}var r=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");return s._origin=n,this._on(e,s,i),r},l.prototype.emit=function(){this._events||a.call(this);var e=arguments[0];if("newListener"===e&&!this._newListener&&!this._events.newListener)return!1;var t,n,i,s,r,o=arguments.length;if(this._all&&this._all.length){if(r=this._all.slice(),o>3)for(t=new Array(o),s=0;s<o;s++)t[s]=arguments[s];for(i=0,n=r.length;i<n;i++)switch(this.event=e,o){case 1:r[i].call(this,e);break;case 2:r[i].call(this,e,arguments[1]);break;case 3:r[i].call(this,e,arguments[1],arguments[2]);break;default:r[i].apply(this,t)}}if(this.wildcard){r=[];var c="string"==typeof e?e.split(this.delimiter):e.slice();h.call(this,r,c,this.listenerTree,0)}else{if("function"==typeof(r=this._events[e])){switch(this.event=e,o){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(o-1),s=1;s<o;s++)t[s-1]=arguments[s];r.apply(this,t)}return!0}r&&(r=r.slice())}if(r&&r.length){if(o>3)for(t=new Array(o-1),s=1;s<o;s++)t[s-1]=arguments[s];for(i=0,n=r.length;i<n;i++)switch(this.event=e,o){case 1:r[i].call(this);break;case 2:r[i].call(this,arguments[1]);break;case 3:r[i].call(this,arguments[1],arguments[2]);break;default:r[i].apply(this,t)}return!0}if(!this._all&&"error"===e)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},l.prototype.emitAsync=function(){this._events||a.call(this);var e=arguments[0];if("newListener"===e&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);var t,n,i,s,r,o=[],c=arguments.length;if(this._all){if(c>3)for(t=new Array(c),s=1;s<c;s++)t[s]=arguments[s];for(i=0,n=this._all.length;i<n;i++)switch(this.event=e,c){case 1:o.push(this._all[i].call(this,e));break;case 2:o.push(this._all[i].call(this,e,arguments[1]));break;case 3:o.push(this._all[i].call(this,e,arguments[1],arguments[2]));break;default:o.push(this._all[i].apply(this,t))}}if(this.wildcard){r=[];var u="string"==typeof e?e.split(this.delimiter):e.slice();h.call(this,r,u,this.listenerTree,0)}else r=this._events[e];if("function"==typeof r)switch(this.event=e,c){case 1:o.push(r.call(this));break;case 2:o.push(r.call(this,arguments[1]));break;case 3:o.push(r.call(this,arguments[1],arguments[2]));break;default:for(t=new Array(c-1),s=1;s<c;s++)t[s-1]=arguments[s];o.push(r.apply(this,t))}else if(r&&r.length){if(r=r.slice(),c>3)for(t=new Array(c-1),s=1;s<c;s++)t[s-1]=arguments[s];for(i=0,n=r.length;i<n;i++)switch(this.event=e,c){case 1:o.push(r[i].call(this));break;case 2:o.push(r[i].call(this,arguments[1]));break;case 3:o.push(r[i].call(this,arguments[1],arguments[2]));break;default:o.push(r[i].apply(this,t))}}else if(!this._all&&"error"===e)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(o)},l.prototype.on=function(e,t){return this._on(e,t,!1)},l.prototype.prependListener=function(e,t){return this._on(e,t,!0)},l.prototype.onAny=function(e){return this._onAny(e,!1)},l.prototype.prependAny=function(e){return this._onAny(e,!0)},l.prototype.addListener=l.prototype.on,l.prototype._onAny=function(e,t){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},l.prototype._on=function(e,t,n){if("function"==typeof e)return this._onAny(e,t),this;if("function"!=typeof t)throw new Error("on only accepts instances of Function");return this._events||a.call(this),this._newListener&&this.emit("newListener",e,t),this.wildcard?(f.call(this,e,t),this):(this._events[e]?("function"==typeof this._events[e]&&(this._events[e]=[this._events[e]]),n?this._events[e].unshift(t):this._events[e].push(t),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,u.call(this,this._events[e].length,e))):this._events[e]=t,this)},l.prototype.off=function(e,t){function n(e){if(e!==o){var t=Object.keys(e);for(var i in t){var s=t[i],a=e[s];a instanceof Function||"object"!==(void 0===a?"undefined":r(a))||null===a||(Object.keys(a).length>0&&n(e[s]),0===Object.keys(a).length&&delete e[s])}}}if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var i,s=[];if(this.wildcard){var a="string"==typeof e?e.split(this.delimiter):e.slice();s=h.call(this,null,a,this.listenerTree,0)}else{if(!this._events[e])return this;i=this._events[e],s.push({_listeners:i})}for(var c=0;c<s.length;c++){var u=s[c];if(i=u._listeners,d(i)){for(var l=-1,f=0,p=i.length;f<p;f++)if(i[f]===t||i[f].listener&&i[f].listener===t||i[f]._origin&&i[f]._origin===t){l=f;break}if(l<0)continue;return this.wildcard?u._listeners.splice(l,1):this._events[e].splice(l,1),0===i.length&&(this.wildcard?delete u._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,t),this}(i===t||i.listener&&i.listener===t||i._origin&&i._origin===t)&&(this.wildcard?delete u._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return n(this.listenerTree),this},l.prototype.offAny=function(e){var t,n=0,i=0;if(e&&this._all&&this._all.length>0){for(t=this._all,n=0,i=t.length;n<i;n++)if(e===t[n])return t.splice(n,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(n=0,i=t.length;n<i;n++)this.emit("removeListenerAny",t[n]);this._all=[]}return this},l.prototype.removeListener=l.prototype.off,l.prototype.removeAllListeners=function(e){if(e===o)return!this._events||a.call(this),this;if(this.wildcard)for(var t="string"==typeof e?e.split(this.delimiter):e.slice(),n=h.call(this,null,t,this.listenerTree,0),i=0;i<n.length;i++){var s=n[i];s._listeners=null}else this._events&&(this._events[e]=null);return this},l.prototype.listeners=function(e){if(this.wildcard){var t=[],n="string"==typeof e?e.split(this.delimiter):e.slice();return h.call(this,t,n,this.listenerTree,0),t}return this._events||a.call(this),this._events[e]||(this._events[e]=[]),d(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},l.prototype.eventNames=function(){return Object.keys(this._events)},l.prototype.listenerCount=function(e){return this.listeners(e).length},l.prototype.listenersAny=function(){return this._all?this._all:[]},(s=function(){return l}.call(t,n,t,e))!==o&&(e.exports=s)}()}).call(t,n(7))},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var i=function(){function e(){}return e}()},function(e,t,n){"use strict";n.d(t,"c",function(){return _}),n.d(t,"d",function(){return g}),n.d(t,"a",function(){return v}),n.d(t,"b",function(){return b});var i=n(8),s=(n.n(i),n(3)),r=(n.n(s),n(0)),o=(n.n(r),n(22)),a=(n.n(o),n(24)),c=n(26),u=n(32),l=n(34),h=n(36),f=n(46),d=n(47),p=this&&this.__assign||function(){return p=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},p.apply(this,arguments)};Object(i.polyfill)();var _,g,v;!function(e){e.Authorized="callback-event-authorized",e.Context="callback-event-context",e.Error="callback-event-error",e.Position="callback-event-position",e.ReloadEntitlements="callback-event-reload-entitlements",e.Visibility="callback-event-visibility",e.Highlight="callback-event-highlight"}(v||(v={}));var b=function(){function e(e){var t=this;this.authData=null,this.context=null,this.contextChangedFields=[],this.isVisible=!0,this.handleMessageEvent=function(e){if(e.source===window.parent){var n=e.data;switch(n.action){case r.ExtensionAction.TwitchExtBootstrap:t.features.initializeFeatureFlags(n.features),t.configuration.initializeConfiguration(n.configuration),t.onAuthReceived(n.auth);break;case r.ExtensionAction.TwitchExtReload:window.location.reload();break;case r.ExtensionAction.TwitchExtAuth:t.onAuthReceived(n.auth);break;case r.ExtensionAction.TwitchExtError:t.callbackEvents.emit(v.Error,new Error(n.message));break;case r.ExtensionAction.TwitchExtContext:t.context=n.context,t.contextChangedFields=n.updatedFields,t.callbackEvents.emit(v.Context,t.context,t.contextChangedFields);break;case r.ExtensionAction.TwitchExtVisibilityChanged:t.isVisible=n.isVisible,t.callbackEvents.emit(v.Visibility,n.isVisible,n.context);break;case r.ExtensionAction.TwitchExtPositionChanged:t.callbackEvents.emit(v.Position,n.position);break;case r.ExtensionAction.TwitchExtHighlightChanged:t.callbackEvents.emit(v.Highlight,n.isHighlighted)}t.actions.onControllerMessage(n),t.bits.onControllerMessage(n),t.purchases.onControllerMessage(n),t.pubsub.onControllerMessage(n)}},this.onAuthorized=function(e){t.callbackEvents.removeAllListeners(v.Authorized),t.callbackEvents.addListener(v.Authorized,e),t.authData&&t.callbackEvents.emit(v.Authorized,t.authData)},this.onError=function(e){t.callbackEvents.removeAllListeners(v.Error),t.callbackEvents.addListener(v.Error,e)},this.onContext=function(e){t.callbackEvents.removeAllListeners(v.Context),t.callbackEvents.addListener(v.Context,e),t.authData&&t.callbackEvents.emit(v.Context,t.context,t.contextChangedFields)},this.onPositionChanged=function(e){t.callbackEvents.removeAllListeners(v.Position),t.callbackEvents.addListener(v.Position,e)},this.onVisibilityChanged=function(e){t.callbackEvents.removeAllListeners(v.Visibility),t.callbackEvents.addListener(v.Visibility,e),t.isVisible||t.callbackEvents.emit(v.Visibility,t.isVisible,null)},this.onHighlightChanged=function(e){t.callbackEvents.removeAllListeners(v.Highlight),t.callbackEvents.addListener(v.Highlight,e)},this.onNetworkResourceTiming=function(e){"resource"===e.entryType&&t.sendCoordinatorMessage({action:r.ExtensionAction.TwitchExtNetworkTiming,payload:{duration:e.duration,endTime:e.responseEnd,startTime:e.startTime,url:e.name}})},_=this.config=e,g=this.sendCoordinatorMessage,this.features=new l.a,this.callbackEvents=new s.EventEmitter2,this.pubsub=new h.a(this.features,this.callbackEvents),this.actions=new a.a,this.bits=new c.a,this.configuration=new u.a(this.callbackEvents),this.purchases=new f.a,this.rig=new d.a;var n=window.performance,i=window.location.href;Object(o.isSniffingAllowed)(n)&&(this.networkSniffer=new o.NetworkSniffer(n,i),this.networkSniffer.start(),this.networkSniffer.addResourceListener(this.onNetworkResourceTiming))}return Object.defineProperty(e.prototype,"publicAPI",{get:function(){var e=this;return p({get onAuthorized(){return e.onAuthorized},get onContext(){return e.onContext},get onError(){return e.onError},get onPositionChange(){return e.onPositionChanged},get onPositionChanged(){return e.onPositionChanged},get onVisibilityChanged(){return e.onVisibilityChanged},get onHighlightChanged(){return e.onHighlightChanged}},this.pubsub.publicAPI,{get actions(){return e.actions.publicAPI},get bits(){return e.bits.publicAPI},get configuration(){return e.configuration.publicAPI},get features(){return e.features.publicAPI},get purchases(){return e.purchases.publicAPI},get rig(){return e.rig.publicAPI}})},enumerable:!0,configurable:!0}),e.prototype.sendCoordinatorMessage=function(e){window.parent.postMessage(e,"*")},e.prototype.onAuthReceived=function(e){this.authData=e,this.pubsub.setAuth(e),this.configuration.setAuth(e),this.callbackEvents.emit(v.Authorized,e)},e}()},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(){i(this,e)}return s(e,[{key:"on",value:function(e,t,n){return this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(t,n),this}},{key:"off",value:function(e,t){if(this._events)for(var n=this._events[e]||[],i=this._events[e]=[],s=0;s<n.length;s+=2)n[s]!==t&&(i.push(n[s]),i.push(n[s+1]));return this}},{key:"_trigger",value:function(e){if(this._events)for(var t=this._events[e]||[],n=1;n<t.length;n+=2)t[n-1].apply(t[n],Array.prototype.slice.call(arguments,1));return this}},{key:"count",value:function(e){if(this._events){return(this._events[e]||[]).length/2}return 0}}]),e}();t.default=r},function(e,t,n){"use strict";function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function r(e){if(h===setTimeout)return setTimeout(e,0);if((h===i||!h)&&setTimeout)return h=setTimeout,setTimeout(e,0);try{return h(e,0)}catch(t){try{return h.call(null,e,0)}catch(t){return h.call(this,e,0)}}}function o(e){if(f===clearTimeout)return clearTimeout(e);if((f===s||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function a(){g&&p&&(g=!1,p.length?_=p.concat(_):v=-1,_.length&&c())}function c(){if(!g){var e=r(a);g=!0;for(var t=_.length;t;){for(p=_,_=[];++v<t;)p&&p[v].run();v=-1,t=_.length}p=null,g=!1,o(e)}}function u(e,t){this.fun=e,this.array=t}function l(){}var h,f,d=e.exports={};!function(){try{h="function"==typeof setTimeout?setTimeout:i}catch(e){h=i}try{f="function"==typeof clearTimeout?clearTimeout:s}catch(e){f=s}}();var p,_=[],g=!1,v=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];_.push(new u(e,t)),1!==_.length||g||r(c)},u.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=l,d.addListener=l,d.once=l,d.off=l,d.removeListener=l,d.removeAllListeners=l,d.emit=l,d.prependListener=l,d.prependOnceListener=l,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(e,t,n){"use strict";(function(i){var s,r,o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   4.1.1
 */
!function(i,a){"object"===o(t)&&void 0!==e?e.exports=a():(s=a,void 0!==(r="function"==typeof s?s.call(t,n,t,e):s)&&(e.exports=r))}(0,function(){function e(e){var t=void 0===e?"undefined":o(e);return null!==e&&("object"===t||"function"===t)}function t(e){return"function"==typeof e}function s(e){W=e}function r(e){G=e}function a(){return void 0!==V?function(){V(u)}:c()}function c(){var e=setTimeout;return function(){return e(u,1)}}function u(){for(var e=0;e<z;e+=2){(0,Y[e])(Y[e+1]),Y[e]=void 0,Y[e+1]=void 0}z=0}function l(e,t){var n=arguments,i=this,s=new this.constructor(f);void 0===s[ee]&&R(s);var r=i._state;return r?function(){var e=n[r-1];G(function(){return L(r,s,e,i._result)})}():T(i,s,e,t),s}function h(e){var t=this;if(e&&"object"===(void 0===e?"undefined":o(e))&&e.constructor===t)return e;var n=new t(f);return m(n,e),n}function f(){}function d(){return new TypeError("You cannot resolve a promise with itself")}function p(){return new TypeError("A promises callback cannot return that same promise.")}function _(e){try{return e.then}catch(e){return se.error=e,se}}function g(e,t,n,i){try{e.call(t,n,i)}catch(e){return e}}function v(e,t,n){G(function(e){var i=!1,s=g(n,t,function(n){i||(i=!0,t!==n?m(e,n):k(e,n))},function(t){i||(i=!0,E(e,t))},"Settle: "+(e._label||" unknown promise"));!i&&s&&(i=!0,E(e,s))},e)}function b(e,t){t._state===ne?k(e,t._result):t._state===ie?E(e,t._result):T(t,void 0,function(t){return m(e,t)},function(t){return E(e,t)})}function y(e,n,i){n.constructor===e.constructor&&i===l&&n.constructor.resolve===h?b(e,n):i===se?(E(e,se.error),se.error=null):void 0===i?k(e,n):t(i)?v(e,n,i):k(e,n)}function m(t,n){t===n?E(t,d()):e(n)?y(t,n,_(n)):k(t,n)}function w(e){e._onerror&&e._onerror(e._result),x(e)}function k(e,t){e._state===te&&(e._result=t,e._state=ne,0!==e._subscribers.length&&G(x,e))}function E(e,t){e._state===te&&(e._state=ie,e._result=t,G(w,e))}function T(e,t,n,i){var s=e._subscribers,r=s.length;e._onerror=null,s[r]=t,s[r+ne]=n,s[r+ie]=i,0===r&&e._state&&G(x,e)}function x(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var i=void 0,s=void 0,r=e._result,o=0;o<t.length;o+=3)i=t[o],s=t[o+n],i?L(n,i,s,r):s(r);e._subscribers.length=0}}function O(){this.error=null}function P(e,t){try{return e(t)}catch(e){return re.error=e,re}}function L(e,n,i,s){var r=t(i),o=void 0,a=void 0,c=void 0,u=void 0;if(r){if(o=P(i,s),o===re?(u=!0,a=o.error,o.error=null):c=!0,n===o)return void E(n,p())}else o=s,c=!0;n._state!==te||(r&&c?m(n,o):u?E(n,a):e===ne?k(n,o):e===ie&&E(n,o))}function S(e,t){try{t(function(t){m(e,t)},function(t){E(e,t)})}catch(t){E(e,t)}}function A(){return oe++}function R(e){e[ee]=oe++,e._state=void 0,e._result=void 0,e._subscribers=[]}function j(e,t){this._instanceConstructor=e,this.promise=new e(f),this.promise[ee]||R(this.promise),H(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?k(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&k(this.promise,this._result))):E(this.promise,C())}function C(){return new Error("Array Methods must be provided an Array")}function M(e){return new j(this,e).promise}function I(e){var t=this;return new t(H(e)?function(n,i){for(var s=e.length,r=0;r<s;r++)t.resolve(e[r]).then(n,i)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function U(e){var t=this,n=new t(f);return E(n,e),n}function F(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function q(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function N(e){this[ee]=A(),this._result=this._state=void 0,this._subscribers=[],f!==e&&("function"!=typeof e&&F(),this instanceof N?S(this,e):q())}function B(){var e=void 0;if("undefined"!=typeof global)e=global;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=N}var D=void 0;D=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var H=D,z=0,V=void 0,W=void 0,G=function(e,t){Y[z]=e,Y[z+1]=t,2===(z+=2)&&(W?W(u):Z())},J="undefined"!=typeof window?window:void 0,K=J||{},Q=K.MutationObserver||K.WebKitMutationObserver,X="undefined"==typeof self&&void 0!==i&&"[object process]"==={}.toString.call(i),$="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Y=new Array(1e3),Z=void 0;Z=X?function(){return function(){return i.nextTick(u)}}():Q?function(){var e=0,t=new Q(u),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}():$?function(){var e=new MessageChannel;return e.port1.onmessage=u,function(){return e.port2.postMessage(0)}}():void 0===J?function(){try{var e=n(13);return V=e.runOnLoop||e.runOnContext,a()}catch(e){return c()}}():c();var ee=Math.random().toString(36).substring(16),te=void 0,ne=1,ie=2,se=new O,re=new O,oe=0;return j.prototype._enumerate=function(e){for(var t=0;this._state===te&&t<e.length;t++)this._eachEntry(e[t],t)},j.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,i=n.resolve;if(i===h){var s=_(e);if(s===l&&e._state!==te)this._settledAt(e._state,t,e._result);else if("function"!=typeof s)this._remaining--,this._result[t]=e;else if(n===N){var r=new n(f);y(r,e,s),this._willSettleAt(r,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(i(e),t)},j.prototype._settledAt=function(e,t,n){var i=this.promise;i._state===te&&(this._remaining--,e===ie?E(i,n):this._result[t]=n),0===this._remaining&&k(i,this._result)},j.prototype._willSettleAt=function(e,t){var n=this;T(e,void 0,function(e){return n._settledAt(ne,t,e)},function(e){return n._settledAt(ie,t,e)})},N.all=M,N.race=I,N.resolve=h,N.reject=U,N._setScheduler=s,N._setAsap=r,N._asap=G,N.prototype={constructor:N,then:l,catch:function(e){return this.then(null,e)}},N.polyfill=B,N.Promise=N,N})}).call(t,n(7))},function(e,t,n){"use strict";n.d(t,"a",function(){return s}),n.d(t,"b",function(){return c});var i,s,r=n(19),o=n(20),a=n(21);n(4);!function(e){e.Production="production",e.Staging="staging",e.Test="test"}(s||(s={}));var c=(i={},i[s.Production]=r.a,i[s.Staging]=o.a,i[s.Test]=a.a,i)},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(){i(this,e),this._map={},this._size=0}return s(e,[{key:"set",value:function(e,t){this._map.hasOwnProperty(e)||(this._size+=1),this._map[e]=t}},{key:"get",value:function(e){return this._map[e]}},{key:"has",value:function(e){return this._map.hasOwnProperty(e)}},{key:"remove",value:function(e){this._map.hasOwnProperty(e)&&(this._size-=1),delete this._map[e]}},{key:"size",value:function(){return this._size}},{key:"map",value:function(){return this._map}},{key:"values",value:function(){var e=[];for(var t in this._map)this._map.hasOwnProperty(t)&&e.push(this._map[t]);return e}}]),e}();t.default=r},function(e,t,n){"use strict";function i(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),i=n.exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}t.b=i,n.d(t,"c",function(){return r}),n.d(t,"a",function(){return o});var s=["assert","clear","count","debug","dir","dirxml","exception","group","groupCollapsed","groupEnd","info","log","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],r=function(){var e;window.console?e=Object.keys(window.console).filter(function(e){return"function"==typeof window.console[e]}):(window.console={},e=s),e.forEach(function(e){window.console[e]=function(){return 0}})},o=function(e){[e.documentElement,e.body].forEach(function(e){e.style.setProperty("width","100%","important"),e.style.setProperty("height","100%","important")}),e.body.setAttribute("tabindex","-1")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),s=(n.n(i),n(0)),r=(n.n(s),n(9)),o=n(5),a=n(49),c=n(11),u=this&&this.__assign||function(){return u=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},u.apply(this,arguments)},l=new r.b.production,h=new o.b(l),f={anchor:Object(c.b)("anchor"),mode:Object(c.b)("mode"),state:Object(c.b)("state")},d=Object(c.b)("platform");d&&(f.platform=d);var p=new a.a(f,h.handleMessageEvent,window,document);p.bindEvents(),f.state===s.ExternalExtensionState.Released&&Object(c.c)(),document.body&&p.forceVideoOverlayFullSize(),window.Twitch=window.Twitch||{},window.Twitch.ext=window.Twitch.ext||u({environment:"production",version:"1.20.0"},h.publicAPI)},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,s=t.ExtensionActivationStatus=void 0;!function(e){e.Active="active",e.Inactive="inactive"}(s||(t.ExtensionActivationStatus=s={}));var r=t.ExtensionAnchor=void 0;!function(e){e.Hidden="hidden",e.Panel="panel",e.Overlay="video_overlay",e.Component="component"}(r||(t.ExtensionAnchor=r={}));var o=t.ExtensionMode=void 0;!function(e){e.Config="config",e.Dashboard="dashboard",e.Viewer="viewer"}(o||(t.ExtensionMode=o={}));var a=t.ExtensionPlatform=void 0;!function(e){e.Mobile="mobile",e.Web="web"}(a||(t.ExtensionPlatform=a={}));var c=t.ExtensionState=void 0;!function(e){e.Testing="Testing",e.HostedTest="Assets Uploaded",e.Approved="Approved",e.Released="Released",e.ReadyForReview="Ready For Review",e.InReview="In Review",e.PendingAction="Pending Action",e.Uploading="Uploading"}(c||(t.ExtensionState=c={}));var u=t.ExternalExtensionState=void 0;!function(e){e.Testing="testing",e.HostedTest="hosted_test",e.Approved="approved",e.Released="released",e.ReadyForReview="ready_for_review",e.InReview="in_review",e.PendingAction="pending_action",e.Uploading="uploading"}(u||(t.ExternalExtensionState=u={}));var l=(t.ExtensionStateMap=(i={},i[c.Testing]=u.Testing,i[c.HostedTest]=u.HostedTest,i[c.Approved]=u.Approved,i[c.Released]=u.Released,i[c.ReadyForReview]=u.ReadyForReview,i[c.InReview]=u.InReview,i[c.PendingAction]=u.PendingAction,i[c.Uploading]=u.Uploading,i),t.ExtensionAction=void 0);!function(e){e.TwitchExtAuth="twitch-ext-auth",e.TwitchExtBootstrap="twitch-ext-bootstrap",e.TwitchExtContext="twitch-ext-context",e.TwitchExtError="twitch-ext-error",e.TwitchExtLoaded="twitch-ext-loaded",e.TwitchExtLongtask="twitch-ext-longtask",e.TwitchExtNetworkTiming="twitch-ext-network-timing",e.TwitchExtReload="twitch-ext-reload",e.TwitchExtUserAction="twitch-ext-user-action",e.TwitchExtConfirmationRequest="twitch-ext-confirmation-request",e.TwitchExtBeginPurchase="twitch-ext-begin-purchase",e.TwitchExtReloadEntitlements="twitch-ext-reload-entitlements",e.TwitchExtProductPrices="twitch-ext-product-prices",e.TwitchExtVisibilityChanged="twitch-ext-visibility-changed",e.TwitchExtHighlightChanged="twitch-ext-highlight-changed",e.TwitchExtBitsProducts="twitch-ext-bits-products",e.TwitchExtUseBits="twitch-ext-use-bits",e.TwitchExtBitsTransactionComplete="twitch-ext-bits-transaction-complete",e.TwitchExtBitsOnHover="twitch-ext-bits-on-hover",e.TwitchExtPubSubReceived="twitch-ext-pubsub-received",e.TwitchExtPositionChanged="twitch-ext-position-changed",e.TwitchExtPubsubMessage="twitch-ext-pubsub-message",e.TwitchExtPubsubBindFailure="twitch-ext-pubsub-bind-failure",e.TwitchExtPubsubListen="twitch-ext-pubsub-listen",e.TwitchExtPubsubUnlisten="twitch-ext-pubsub-unlisten"}(l||(t.ExtensionAction=l={}));t.DefaultZoomPixelWidth=1024},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=t.SupervisorAction=void 0;!function(e){e.SupervisorReady="supervisor-ready",e.SupervisorInit="supervisor-init"}(i||(t.SupervisorAction=i={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=t.FunctionAction=void 0;!function(e){e.LoginRequest="twitch-ext-login-request",e.FollowAction="twitch-ext-follow-action",e.FollowComplete="twitch-ext-follow-complete",e.FollowStatusRequest="twitch-ext-follow-status",e.FollowStatusResponse="twitch-ext-follow-status-response",e.IdShareRequest="twitch-ext-id-share-request",e.TwitchExtMinimize="twitch-ext-minimize",e.UseBitsPromptRequired="twitch-ext-use-bits",e.UseBits="twitch-ext-use-bits",e.UseBitsComplete="twitch-ext-use-bits-complete"}(i||(t.FunctionAction=i={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=(t.DEFAULT_PANEL_HEIGHT=300,t.ExtensionFrameEvents=void 0);!function(e){e.ExtensionFrameLoaded="extensionFrameLoaded",e.IdentityLinked="identityLinked",e.Minimize="minimize",e.RequestModal="requestModal",e.ShowBitsBalance="showBitsBalance",e.ShowUseBitsSuccess="showUseBitsSuccess",e.UseBitsError="useBitsError"}(i||(t.ExtensionFrameEvents=i={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=t.PlaybackMode=void 0;!function(e){e.Video="video",e.Audio="audio",e.Remote="remote",e.ChatOnly="chat-only"}(i||(t.PlaybackMode=i={}))},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(4),s=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.environment="production",t.pubsubEnvironment="production",t.pubsubURL="https://api.twitch.tv/v5/extensions/message",t.twitchAPIURL="https://api.twitch.tv",t}return s(t,e),t}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(4),s=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.environment="staging",t.pubsubEnvironment="darklaunch",t.pubsubURL="http://pubsub-broker-darklaunch.internal.twitch.tv",t.twitchAPIURL="https://api.twitch.tv",t}return s(t,e),t}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(4),s=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.environment="test",t.pubsubEnvironment="test",t.pubsubURL="http://test",t.twitchAPIURL="http://test",t}return s(t,e),t}(i.a)},function(e,t,n){"use strict";(function(e){var n,i,s,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(o,a){"object"===r(t)&&"object"===r(e)?e.exports=a():(i=[],n=a,void 0!==(s="function"==typeof n?n.apply(t,i):n)&&(e.exports=s))}(0,function(){return function(e){function t(i){if(n[i])return n[i].exports;var s=n[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,t),s.l=!0,s.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/assets/",t(t.s=1)}([,function(e,t,n){function i(e){return!!(e&&e.timing&&e.getEntriesByType&&e.setResourceTimingBufferSize&&e.clearResourceTimings)}Object.defineProperty(t,"__esModule",{value:!0}),t.isSniffingAllowed=i,n.d(t,"NetworkSniffer",function(){return s});var s=function(){function e(e,t){this.performance=e,this.frameURL=t,this.resourceEntriesIndex=0,this.resourceListeners=[],this.startCalled=!1,console.assert(i(e),"performance object does not support sniffing")}return e.prototype.start=function(){return!this.startCalled&&(this.startCalled=!0,this.setResourceBufferSize(),setInterval(this.processNewResourceTimings.bind(this),1e3),!0)},e.prototype.getFrameTiming=function(){return this.performance.timing},e.prototype.getAvailableResourceTimings=function(){return this.performance.getEntriesByType("resource")},e.prototype.addResourceListener=function(e){this.resourceListeners.push(e)},e.prototype.removeResourceListener=function(e){this.resourceListeners=this.resourceListeners.filter(function(t){return t!==e})},e.prototype.setResourceBufferSize=function(){this.performance.setResourceTimingBufferSize(1e3)},e.prototype.clearResourceBuffer=function(){this.resourceEntriesIndex=0,this.performance.clearResourceTimings(),this.setResourceBufferSize()},e.prototype.isResourceBufferAlmostFull=function(){return this.performance.getEntriesByType("resource").length>=750},e.prototype.processNewResourceTimings=function(){var e=this;this.performance.getEntriesByType("resource").slice(this.resourceEntriesIndex).forEach(function(t){e.resourceEntriesIndex++,e.fireResourceListeners(t)}),this.isResourceBufferAlmostFull()&&this.clearResourceBuffer()},e.prototype.fireResourceListeners=function(e){this.resourceListeners.forEach(function(t){t(e)})},e}()}])})}).call(t,n(23)(e))},function(e,t,n){"use strict";e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";var i=n(25);n.d(t,"a",function(){return i.a})},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i=n(0),s=(n.n(i),function(){function e(){var e=this;this.callbacks={},this.onControllerMessage=function(t){switch(t.action){case i.FunctionAction.FollowComplete:var n=e.callbacks[i.FunctionAction.FollowComplete];n&&n(t.didFollow,t.channel)}},this.followChannel=function(e){window.parent.postMessage({action:i.FunctionAction.FollowAction,payload:{channel:e}},"*")},this.minimize=function(){window.parent.postMessage({action:i.FunctionAction.TwitchExtMinimize},"*")},this.requestIdShare=function(){window.parent.postMessage({action:i.FunctionAction.IdShareRequest},"*")},this.onFollow=function(t){e.callbacks[i.FunctionAction.FollowComplete]=t}}return Object.defineProperty(e.prototype,"publicAPI",{get:function(){return{followChannel:this.followChannel,onFollow:this.onFollow,minimize:this.minimize,requestIdShare:this.requestIdShare}},enumerable:!0,configurable:!0}),e}())},function(e,t,n){"use strict";var i=n(27);n.d(t,"a",function(){return i.a})},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var i=n(0),s=(n.n(i),n(28)),r=(n.n(s),function(){function e(){var e=this;this.authData=null,this.useLoopback=!1,this.onControllerMessage=function(t){switch(t.action){case i.ExtensionAction.TwitchExtBitsTransactionComplete:e.onTransactionCompleteCallback&&e.onTransactionCompleteCallback({product:t.product,transactionId:t.transactionId,userId:t.userId,displayName:t.displayName,initiator:t.initiator,transactionReceipt:t.transactionReceipt});break;case i.ExtensionAction.TwitchExtBitsProducts:e.setProducts(t.products);break;case i.FunctionAction.UseBitsComplete:(!t.didConfirm||!t.didUseBits)&&e.onTransactionCancelledCallback&&e.onTransactionCancelledCallback()}},this.showBitsBalance=function(){window.parent.postMessage({action:i.ExtensionAction.TwitchExtBitsOnHover},"*")},this.useBits=function(t){e.useLoopback?e.loopbackUseBits(t):window.parent.postMessage({action:i.ExtensionAction.TwitchExtUseBits,sku:t},"*")},this.onTransactionComplete=function(t){e.onTransactionCompleteCallback=t},this.onTransactionCancelled=function(t){e.onTransactionCancelledCallback=t},this.getProducts=function(){return e.bitsProducts},this.setUseLoopback=function(t){e.useLoopback=t},this.loopbackUseBits=function(t){var n=e.authData?e.authData.userId:"0",i=n+"."+(new Date).valueOf(),r={transactionId:i,product:{sku:t,displayName:"test SKU",cost:{amount:"1",type:"bits"}},userId:n,displayName:"bits user",initiator:s.Initiator.CurrentUser};window.setTimeout(function(){e.onTransactionCompleteCallback&&e.onTransactionCompleteCallback(r)},1e3)},this.setupBitsProducts()}return Object.defineProperty(e.prototype,"publicAPI",{get:function(){return{getProducts:this.getProducts,useBits:this.useBits,onTransactionComplete:this.onTransactionComplete,onTransactionCancelled:this.onTransactionCancelled,showBitsBalance:this.showBitsBalance,setUseLoopback:this.setUseLoopback}},enumerable:!0,configurable:!0}),e.prototype.setAuth=function(e){this.authData=e},e.prototype.setupBitsProducts=function(){var e=this;this.bitsProducts=new Promise(function(t){e.setProducts=t})},e}())},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensionCoordinator=t.Initiator=void 0;var i=n(29),s=n(0),r=n(30),o=n(31),a=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),c=t.Initiator=void 0;!function(e){e.CurrentUser="current_user",e.Other="other"}(c||(t.Initiator=c={}));var u=function(e){function t(t){var n=e.call(this)||this;return n.iframe=t,n.destroy=function(){n.iframe.ownerDocument.defaultView.removeEventListener("message",n.handleMessage)},n.sendContext=function(e,t){n.sendMessage({action:s.ExtensionAction.TwitchExtContext,context:e,updatedFields:t})},n.sendExtensionAuth=function(e){n.sendMessage({action:s.ExtensionAction.TwitchExtAuth,auth:e})},n.sendExtensionBootstrap=function(e,t,i){n.sendMessage({action:s.ExtensionAction.TwitchExtBootstrap,auth:e,features:t,configuration:i})},n.sendSupervisorInit=function(e){n.sendMessage({action:s.SupervisorAction.SupervisorInit,options:e})},n.sendFunctionReply=function(e){n.sendMessage(e)},n.sendExtensionReloadEntitlementsMessage=function(){n.sendMessage({action:s.ExtensionAction.TwitchExtReloadEntitlements})},n.sendVisibilityChanged=function(e,t){n.sendMessage({action:s.ExtensionAction.TwitchExtVisibilityChanged,isVisible:e,context:t})},n.sendPositionChange=function(e){n.sendMessage({action:s.ExtensionAction.TwitchExtPositionChanged,position:e})},n.sendHighlightChange=function(e){n.sendMessage({action:s.ExtensionAction.TwitchExtHighlightChanged,isHighlighted:e})},n.sendBitsProductsMessage=function(e){n.sendMessage({action:s.ExtensionAction.TwitchExtBitsProducts,products:e})},n.sendBitsTransactionCompleteMessage=function(e){n.sendMessage(e)},n.sendHelperPubsubMessage=function(e,t,i){n.sendMessage({action:s.ExtensionAction.TwitchExtPubsubMessage,payload:{target:e,contentType:t,content:i}})},n.sendHelperPubsubBindFailure=function(e,t){n.sendMessage({action:s.ExtensionAction.TwitchExtPubsubBindFailure,payload:{target:e,error:t}})},n.handleMessage=function(e){var t=e.source,i=e.data;if(t===n.iframe.contentWindow)try{n.handleExtensionAction(i)}catch(e){console.error("Caught Error in Message Handler: "+e.stack)}},n.handleExtensionAction=function(e){-1!==s.ExtensionEventActions.indexOf(e.action)&&n.emit(e.action,e)},n.sendMessage=function(e){n.iframe&&n.iframe.contentWindow&&n.iframe.contentWindow.postMessage(e,r.supervisor.supervisorOrigin)},n.iframe.ownerDocument.defaultView.addEventListener("message",n.handleMessage),n}return a(t,e),t.prototype.sendExtensionReloadMessage=function(){this.sendMessage({action:s.ExtensionAction.TwitchExtReload})},t.prototype.sendExtensionProductPricesMessage=function(e){var t=e.products.reduce(function(e,t){var n=t.sku,i=t.price;return e[n]={displayPrice:(0,o.formatPrice)(i.price,i.currency_unit)},e},{});this.sendMessage({action:s.ExtensionAction.TwitchExtProductPrices,prices:t})},t}(i.EventEmitter2);t.ExtensionCoordinator=u},function(e,t,n){"use strict";(function(i){var s,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(o){function a(){this._events={},this._conf&&c.call(this,this._conf)}function c(e){e?(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),this._maxListeners=e.maxListeners!==o?e.maxListeners:p,e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),this.wildcard&&(this.listenerTree={})):this._maxListeners=p}function u(e,t){var n="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(n+=" Event name: "+t+"."),void 0!==i&&i.emitWarning){var s=new Error(n);s.name="MaxListenersExceededWarning",s.emitter=this,s.count=e,i.emitWarning(s)}else console.error(n),console.trace&&console.trace()}function l(e){this._events={},this.newListener=!1,this.verboseMemoryLeak=!1,c.call(this,e)}function h(e,t,n,i){if(!n)return[];var s,r,o,a,c,u,l,f=[],d=t.length,p=t[i],_=t[i+1];if(i===d&&n._listeners){if("function"==typeof n._listeners)return e&&e.push(n._listeners),[n];for(s=0,r=n._listeners.length;s<r;s++)e&&e.push(n._listeners[s]);return[n]}if("*"===p||"**"===p||n[p]){if("*"===p){for(o in n)"_listeners"!==o&&n.hasOwnProperty(o)&&(f=f.concat(h(e,t,n[o],i+1)));return f}if("**"===p){l=i+1===d||i+2===d&&"*"===_,l&&n._listeners&&(f=f.concat(h(e,t,n,d)));for(o in n)"_listeners"!==o&&n.hasOwnProperty(o)&&("*"===o||"**"===o?(n[o]._listeners&&!l&&(f=f.concat(h(e,t,n[o],d))),f=f.concat(h(e,t,n[o],i))):f=o===_?f.concat(h(e,t,n[o],i+2)):f.concat(h(e,t,n[o],i)));return f}f=f.concat(h(e,t,n[p],i+1))}if(a=n["*"],a&&h(e,t,a,i+1),c=n["**"])if(i<d){c._listeners&&h(e,t,c,d);for(o in c)"_listeners"!==o&&c.hasOwnProperty(o)&&(o===_?h(e,t,c[o],i+2):o===p?h(e,t,c[o],i+1):(u={},u[o]=c[o],h(e,t,{"**":u},i+1)))}else c._listeners?h(e,t,c,d):c["*"]&&c["*"]._listeners&&h(e,t,c["*"],d);return f}function f(e,t){e="string"==typeof e?e.split(this.delimiter):e.slice();for(var n=0,i=e.length;n+1<i;n++)if("**"===e[n]&&"**"===e[n+1])return;for(var s=this.listenerTree,r=e.shift();r!==o;){if(s[r]||(s[r]={}),s=s[r],0===e.length)return s._listeners?("function"==typeof s._listeners&&(s._listeners=[s._listeners]),s._listeners.push(t),!s._listeners.warned&&this._maxListeners>0&&s._listeners.length>this._maxListeners&&(s._listeners.warned=!0,u.call(this,s._listeners.length,r))):s._listeners=t,!0;r=e.shift()}return!0}var d=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},p=10;l.EventEmitter2=l,l.prototype.delimiter=".",l.prototype.setMaxListeners=function(e){e!==o&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},l.prototype.event="",l.prototype.once=function(e,t){return this._once(e,t,!1)},l.prototype.prependOnceListener=function(e,t){return this._once(e,t,!0)},l.prototype._once=function(e,t,n){return this._many(e,1,t,n),this},l.prototype.many=function(e,t,n){return this._many(e,t,n,!1)},l.prototype.prependMany=function(e,t,n){return this._many(e,t,n,!0)},l.prototype._many=function(e,t,n,i){function s(){return 0==--t&&r.off(e,s),n.apply(this,arguments)}var r=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");return s._origin=n,this._on(e,s,i),r},l.prototype.emit=function(){this._events||a.call(this);var e=arguments[0];if("newListener"===e&&!this.newListener&&!this._events.newListener)return!1;var t,n,i,s,r,o=arguments.length;if(this._all&&this._all.length){if(r=this._all.slice(),o>3)for(t=new Array(o),s=0;s<o;s++)t[s]=arguments[s];for(i=0,n=r.length;i<n;i++)switch(this.event=e,o){case 1:r[i].call(this,e);break;case 2:r[i].call(this,e,arguments[1]);break;case 3:r[i].call(this,e,arguments[1],arguments[2]);break;default:r[i].apply(this,t)}}if(this.wildcard){r=[];var c="string"==typeof e?e.split(this.delimiter):e.slice();h.call(this,r,c,this.listenerTree,0)}else{if("function"==typeof(r=this._events[e])){switch(this.event=e,o){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(o-1),s=1;s<o;s++)t[s-1]=arguments[s];r.apply(this,t)}return!0}r&&(r=r.slice())}if(r&&r.length){if(o>3)for(t=new Array(o-1),s=1;s<o;s++)t[s-1]=arguments[s];for(i=0,n=r.length;i<n;i++)switch(this.event=e,o){case 1:r[i].call(this);break;case 2:r[i].call(this,arguments[1]);break;case 3:r[i].call(this,arguments[1],arguments[2]);break;default:r[i].apply(this,t)}return!0}if(!this._all&&"error"===e)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},l.prototype.emitAsync=function(){this._events||a.call(this);var e=arguments[0];if("newListener"===e&&!this.newListener&&!this._events.newListener)return Promise.resolve([!1]);var t,n,i,s,r,o=[],c=arguments.length;if(this._all){if(c>3)for(t=new Array(c),s=1;s<c;s++)t[s]=arguments[s];for(i=0,n=this._all.length;i<n;i++)switch(this.event=e,c){case 1:o.push(this._all[i].call(this,e));break;case 2:o.push(this._all[i].call(this,e,arguments[1]));break;case 3:o.push(this._all[i].call(this,e,arguments[1],arguments[2]));break;default:o.push(this._all[i].apply(this,t))}}if(this.wildcard){r=[];var u="string"==typeof e?e.split(this.delimiter):e.slice();h.call(this,r,u,this.listenerTree,0)}else r=this._events[e];if("function"==typeof r)switch(this.event=e,c){case 1:o.push(r.call(this));break;case 2:o.push(r.call(this,arguments[1]));break;case 3:o.push(r.call(this,arguments[1],arguments[2]));break;default:for(t=new Array(c-1),s=1;s<c;s++)t[s-1]=arguments[s];o.push(r.apply(this,t))}else if(r&&r.length){if(r=r.slice(),c>3)for(t=new Array(c-1),s=1;s<c;s++)t[s-1]=arguments[s];for(i=0,n=r.length;i<n;i++)switch(this.event=e,c){case 1:o.push(r[i].call(this));break;case 2:o.push(r[i].call(this,arguments[1]));break;case 3:o.push(r[i].call(this,arguments[1],arguments[2]));break;default:o.push(r[i].apply(this,t))}}else if(!this._all&&"error"===e)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(o)},l.prototype.on=function(e,t){return this._on(e,t,!1)},l.prototype.prependListener=function(e,t){return this._on(e,t,!0)},l.prototype.onAny=function(e){return this._onAny(e,!1)},l.prototype.prependAny=function(e){return this._onAny(e,!0)},l.prototype.addListener=l.prototype.on,l.prototype._onAny=function(e,t){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},l.prototype._on=function(e,t,n){if("function"==typeof e)return this._onAny(e,t),this;if("function"!=typeof t)throw new Error("on only accepts instances of Function");return this._events||a.call(this),this.emit("newListener",e,t),this.wildcard?(f.call(this,e,t),this):(this._events[e]?("function"==typeof this._events[e]&&(this._events[e]=[this._events[e]]),n?this._events[e].unshift(t):this._events[e].push(t),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,u.call(this,this._events[e].length,e))):this._events[e]=t,this)},l.prototype.off=function(e,t){function n(e){if(e!==o){var t=Object.keys(e);for(var i in t){var s=t[i],a=e[s];a instanceof Function||"object"!==(void 0===a?"undefined":r(a))||null===a||(Object.keys(a).length>0&&n(e[s]),0===Object.keys(a).length&&delete e[s])}}}if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var i,s=[];if(this.wildcard){var a="string"==typeof e?e.split(this.delimiter):e.slice();s=h.call(this,null,a,this.listenerTree,0)}else{if(!this._events[e])return this;i=this._events[e],s.push({_listeners:i})}for(var c=0;c<s.length;c++){var u=s[c];if(i=u._listeners,d(i)){for(var l=-1,f=0,p=i.length;f<p;f++)if(i[f]===t||i[f].listener&&i[f].listener===t||i[f]._origin&&i[f]._origin===t){l=f;break}if(l<0)continue;return this.wildcard?u._listeners.splice(l,1):this._events[e].splice(l,1),0===i.length&&(this.wildcard?delete u._listeners:delete this._events[e]),this.emit("removeListener",e,t),this}(i===t||i.listener&&i.listener===t||i._origin&&i._origin===t)&&(this.wildcard?delete u._listeners:delete this._events[e],this.emit("removeListener",e,t))}return n(this.listenerTree),this},l.prototype.offAny=function(e){var t,n=0,i=0;if(e&&this._all&&this._all.length>0){for(t=this._all,n=0,i=t.length;n<i;n++)if(e===t[n])return t.splice(n,1),this.emit("removeListenerAny",e),this}else{for(t=this._all,n=0,i=t.length;n<i;n++)this.emit("removeListenerAny",t[n]);this._all=[]}return this},l.prototype.removeListener=l.prototype.off,l.prototype.removeAllListeners=function(e){if(0===arguments.length)return!this._events||a.call(this),this;if(this.wildcard)for(var t="string"==typeof e?e.split(this.delimiter):e.slice(),n=h.call(this,null,t,this.listenerTree,0),i=0;i<n.length;i++){var s=n[i];s._listeners=null}else this._events&&(this._events[e]=null);return this},l.prototype.listeners=function(e){if(this.wildcard){var t=[],n="string"==typeof e?e.split(this.delimiter):e.slice();return h.call(this,t,n,this.listenerTree,0),t}return this._events||a.call(this),this._events[e]||(this._events[e]=[]),d(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},l.prototype.eventNames=function(){return Object.keys(this._events)},l.prototype.listenerCount=function(e){return this.listeners(e).length},l.prototype.listenersAny=function(){return this._all?this._all:[]},(s=function(){return l}.call(t,n,t,e))!==o&&(e.exports=s)}()}).call(t,n(7))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.SUPERVISOR_LOCATION={production:"https://supervisor.ext-twitch.tv",staging:"https://supervisor.ext-assets.internal.justin.tv"},this.env="production"}return Object.defineProperty(e.prototype,"environment",{get:function(){return this.env},set:function(e){this.env=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supervisorOrigin",{get:function(){return this.SUPERVISOR_LOCATION[this.env]||this.SUPERVISOR_LOCATION.production},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supervisorURL",{get:function(){return this.supervisorOrigin+"/supervisor/v1/index.html"},enumerable:!0,configurable:!0}),e}();t.Supervisor=i;t.supervisor=new i},function(e,t,n){"use strict";function i(e,t){return"USD"===t?"$"+e:e+" "+t}Object.defineProperty(t,"__esModule",{value:!0}),t.formatPrice=i},function(e,t,n){"use strict";var i=n(33);n.d(t,"a",function(){return i.a})},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i,s=n(3),r=(n.n(s),n(5));!function(e){e.Broadcaster="broadcaster",e.Developer="developer",e.Global="global"}(i||(i={}));var o;!function(e){e.ConfigurationReceived="configuration-received"}(o||(o={}));var a=function(){function e(e){var t=this;this.callbackEvents=e,this.authData=null,this.eventEmitter=new s.EventEmitter2,this.addConfigurationChangeListener=function(e){t.eventEmitter.on(o.ConfigurationReceived,e)},this.setConfiguration=function(e,n,i){if(!t.authData)return void t.callbackEvents.emit(r.a.Error,new Error("Twitch.ext.configuration.set attempted before onAuthorized returned"));var s=new XMLHttpRequest;s.open("PUT",r.c.twitchAPIURL+"/v5/extensions/"+t.authData.clientId+"/configurations/",!0),s.setRequestHeader("Content-Type","application/json"),s.setRequestHeader("Client-ID",t.authData.clientId),s.setRequestHeader("X-Requested-With","helper"),s.setRequestHeader("Authorization","Bearer "+t.authData.token),s.addEventListener("load",t.handleSetLoad),s.addEventListener("error",t.handleSetError),s.send(JSON.stringify({channel_id:t.authData.channelId,segment:e,version:n,content:i}))},this.handleSetLoad=function(e){var n=e.target;200!==n.status&&204!==n.status&&t.callbackEvents.emit(r.a.Error,new Error("Twitch.ext.configuration.set failed: "+n.statusText))},this.handleSetError=function(e){var n=e.message||"Network error";t.callbackEvents.emit(r.a.Error,new Error(n||"Twitch.ext.configuration.set failed"))}}return Object.defineProperty(e.prototype,"publicAPI",{get:function(){var e=this;return{get onChanged(){return e.addConfigurationChangeListener},get set(){return e.setConfiguration},get broadcaster(){return e.broadcaster},get developer(){return e.developer},get global(){return e.global}}},enumerable:!0,configurable:!0}),e.prototype.initializeConfiguration=function(e){void 0===e&&(e={}),this.broadcaster=e.broadcaster,this.developer=e.developer,this.global=e.global,this.eventEmitter.emit(o.ConfigurationReceived)},e.prototype.setAuth=function(e){this.authData=e},e}()},function(e,t,n){"use strict";var i=n(35);n.d(t,"a",function(){return i.a})},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i,s=n(3),r=(n.n(s),this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},r.apply(this,arguments)}),o=["isChatEnabled","isBitsEnabled"];!function(e){e.ExternalChanged="external-feature-changed"}(i||(i={}));var a=function(){function e(){var e=this;this.eventEmitter=new s.EventEmitter2,this.featureFlags={isChatEnabled:!1,isBitsEnabled:!1,useSharedPubsub:!1,bits:!1,sharePubsub:!1},this.addFeatureChangeListener=function(t){e.eventEmitter.on(i.ExternalChanged,t)},this.updateFeatureFlags=function(t){var n=Object.keys(t).filter(function(n){return-1!==o.indexOf(n)&&t[n]!==e.featureFlags[n]});e.featureFlags=r({},e.featureFlags,t),n.length&&e.eventEmitter.emit(i.ExternalChanged,n)}}return Object.defineProperty(e.prototype,"publicAPI",{get:function(){var e=this;return{get isChatEnabled(){return e.featureFlags.isChatEnabled},get isBitsEnabled(){return e.featureFlags.isBitsEnabled},get onChanged(){return e.addFeatureChangeListener}}},enumerable:!0,configurable:!0}),e.prototype.initializeFeatureFlags=function(e){this.updateFeatureFlags(e)},e.prototype.getFeatureFlag=function(e){return this.featureFlags[e]},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var i=n(3),s=(n.n(i),n(0)),r=(n.n(s),n(37)),o=n.n(r),a=n(45),c=n(9),u=n(5),l=function(){function e(e,t){var n=this;this.features=e,this.callbackEvents=t,this.authData=null,this.listenQueue=[],this.sendQueue=[],this.targetListeners=new i.EventEmitter2,this.send=function(e,t,i){var s={target:e,contentType:t,message:i};if(!n.authData)return void n.sendQueue.push(s);n.sendToPubsub(s)},this.listen=function(e,t){var i=n.targetListeners.listeners(e),s=0!==i.length;if(-1===i.indexOf(t)&&n.targetListeners.addListener(e,t),!n.authData)return void n.listenQueue.push(e);s||n.listenToPubsub(e).catch(function(){n.targetListeners.removeListener(e,t)})},this.unlisten=function(e,t){n.targetListeners.removeListener(e,t),n.targetListeners.listeners(e).length||n.unlistenFromPubsub(e)},this.handleSendLoad=function(e){var t=e.target;200!==t.status&&204!==t.status&&n.callbackEvents.emit(u.a.Error,new Error("sendToPubsub(signal) failed: "+t.statusText))},this.handleSendError=function(e){var t=e.message||"Network error";n.callbackEvents.emit(u.a.Error,new Error(t||"sendToPubsub(signal) failed"))}}return Object.defineProperty(e.prototype,"publicAPI",{get:function(){var e=this;return{get send(){return e.send},get listen(){return e.listen},get unlisten(){return e.unlisten}}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"driver",{get:function(){return this.driverInstance||(this.driverInstance=o.a.getInstance(u.c.pubsubEnvironment),this.mockStatsBackend()),this.driverInstance},enumerable:!0,configurable:!0}),e.prototype.setAuth=function(e){var t=this;this.authData=e,this.sendQueue.length&&(this.sendQueue.forEach(function(e){return t.sendToPubsub(e)}),this.sendQueue=[]),this.listenQueue.length&&this.listenQueue.forEach(function(e){return t.listenToPubsub(e)})},e.prototype.onControllerMessage=function(e){switch(e.action){case s.ExtensionAction.TwitchExtPubsubMessage:this.handleSharedPubsubMessage(e);break;case s.ExtensionAction.TwitchExtPubsubBindFailure:this.handleSharedPubsubFailure(e)}},e.prototype.sendToPubsub=function(e){if(!this.authData)return void this.callbackEvents.emit(u.a.Error,new Error("Twitch.ext.send attempted before onAuthorized returned"));var t=new XMLHttpRequest;t.open("POST",this.getSendRequestURL(),!0),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("Client-ID",this.authData.clientId),t.setRequestHeader("Authorization","Bearer "+this.authData.token),t.addEventListener("load",this.handleSendLoad),t.addEventListener("error",this.handleSendError),t.send(this.getSendRequestBody(e))},e.prototype.getSendRequestURL=function(){if(!this.authData)return"";switch(u.c.environment){case c.a.Production:return u.c.twitchAPIURL+"/v5/extensions/message/"+this.authData.channelId;case c.a.Staging:return u.c.pubsubURL+"/v1/message";case c.a.Test:return""+u.c.pubsubURL}return""},e.prototype.getSendRequestBody=function(e){if(!this.authData)return"";var t=e.contentType,n=e.message;switch(e.message instanceof Object&&(n=JSON.stringify(e.message),t="application/json"),u.c.environment){case c.a.Production:return JSON.stringify({auth:this.authData.token,content_type:t,message:n,targets:[e.target]});case c.a.Staging:return JSON.stringify({topics:["channel-ext-v1."+this.authData.channelId+"-"+this.authData.clientId+"-"+e.target],data:JSON.stringify({content_type:e.contentType,content:[e.message],num_messages:1,request_numbers:[]})});case c.a.Test:return"test"}return""},e.prototype.getUseSharedPubsub=function(){return this.features.getFeatureFlag("sharePubsub")||this.features.getFeatureFlag("useSharedPubsub")},e.prototype.handleSharedPubsubMessage=function(e){var t=this,n=e.payload,i=n.target,s=n.contentType;n.content.forEach(function(e){t.targetListeners.emit(i,i,s,e)})},e.prototype.handleSharedPubsubFailure=function(e){this.callbackEvents.emit(u.a.Error,new Error(e.payload.error))},e.prototype.listenToPubsub=function(e){var t=this;return new Promise(function(n,i){return t.getUseSharedPubsub()?(Object(u.d)({action:s.ExtensionAction.TwitchExtPubsubListen,target:e}),n()):t.authData?void t.driver.Listen({auth:t.authData.token,topic:t.targetToTopic(e),failure:i,success:n,message:function(n){Object(a.a)(e)||t.targetListeners.emit(e,e,"application/plain",n);var i;try{i=JSON.parse(n)}catch(e){return void t.callbackEvents.emit(u.a.Error,new Error("ill-formed JSON response received"))}i.content.forEach(function(n){t.targetListeners.emit(e,e,i.content_type,n)}),i.sequence&&Object(u.d)({action:s.ExtensionAction.TwitchExtPubSubReceived,payload:{target:e,topic:t.targetToTopic(e),sequenceNumber:i.sequence.number,sequenceStart:i.sequence.start}})}}):i()})},e.prototype.unlistenFromPubsub=function(e){var t=this;return new Promise(function(n,i){if(t.getUseSharedPubsub())return Object(u.d)({action:s.ExtensionAction.TwitchExtPubsubUnlisten,target:e}),n();t.driver.Unlisten({topic:t.targetToTopic(e),failure:i,success:n,message:a.b})})},e.prototype.targetToTopic=function(e){if(!this.authData)return"";if(Object(a.a)(e)){var t=this.authData.channelId;return"global"===e&&(t="all"),"channel-ext-v1."+t+"-"+this.authData.clientId+"-"+e}return e},e.prototype.mockStatsBackend=function(){this.driverInstance&&(this.driverInstance._stats._backend={logCounter:a.b,logGauge:a.b,logLine:a.b,logTimer:a.b,setPrefix:a.b})},e}()},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){if("production"!==e&&"staging"!==e&&"darklaunch"!==e)throw"Invalid Pubsub instance environment";return null===window.__Twitch__pubsubInstances[e]&&(window.__Twitch__pubsubInstances[e]=new L(e)),window.__Twitch__pubsubInstances[e]}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=n(6),l=i(u),h=n(1),f=i(h),d=n(2),p=i(d),_=n(38),g=i(_),v=n(39),b=i(v),y=n(40),m=i(y),w=n(42),k=n(44),E=i(k),T=f.default._getLogger("PubsubDriver"),x=3e4,O=/^https?:\/\/([\w-]+\.)*twitch\.(tv|tech)(:\d+)?\/.*$/,P=1,L=function(e){function t(e){s(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._env=p.default.urlParams.pubsub_environment||e,n._clientReady=!1,n._hasDisconnected=!1,n._queuedRequests=[],n._stats=w.Stats.getInstance(n._env,"pubsub-js-client"),n._numDisconnects=0,p.default.inIframe()&&O.test(document.referrer)?(T.debug("Driver is in an iframe"),n._client=new g.default({parentUrl:document.referrer}),n._clientType="iframe-verified"):(T.debug("Driver is not in an iframe"),n._client=new m.default({env:n._env,stats:n._stats}),n._iframeHost=new b.default(n._client),n._clientType="ws"),n._stats.setPrefix("pubsub-js-client."+n._clientType),"true"===p.default.urlParams.force_pubsub_tester?P=1:"false"===p.default.urlParams.force_pubsub_tester&&(P=0),Math.random()<P&&window.setTimeout(n.runTest.bind(n),x),n._client.on("unverified",n._clientUnverified,n),n._client.on("verified",n._clientVerified,n),n._client.verify(),n}return o(t,e),c(t,[{key:"runTest",value:function(){this._tester=new E.default({env:this._env,driver:this,stats:this._stats})}},{key:"connect",value:function(){}},{key:"Listen",value:function(e){this._clientReady?this._client.Listen(e):this._queuedRequests.push({type:"LISTEN",opts:e})}},{key:"Unlisten",value:function(e){this._clientReady?this._client.Unlisten(e):this._queuedRequests.push({type:"UNLISTEN",opts:e})}},{key:"_flushQueuedRequests",value:function(){for(T.debug("Flushing "+this._queuedRequests.length+" queued requests");this._queuedRequests.length>0;){var e=this._queuedRequests.shift();switch(e.type){case"LISTEN":this._client.Listen(e.opts);break;case"UNLISTEN":this._client.Unlisten(e.opts)}}}},{key:"_clientConnected",value:function(){T.debug("Client connected"),this._client.on("disconnected",this._clientDisconnected,this),this._stats.logCounter("connected",1),this._trigger("connected"),this._hasDisconnected&&this._trigger("reconnected"),this._clientReady=!0,this._flushQueuedRequests()}},{key:"_clientDisconnected",value:function(){T.debug("Client disconnected"),this._trigger("disconnected"),this._clientReady=!1,this._numDisconnects+=1,this._hasDisconnected=!0}},{key:"_clientVerified",value:function(){T.debug("Client verified (type = "+this._clientType+")"),this._stats.setPrefix("pubsub-js-client."+this._clientType),this._client.on("connected",this._clientConnected,this),this._client.connect(),window.setInterval(this._sendClientTypeGauge.bind(this),6e4)}},{key:"_clientUnverified",value:function(){T.debug("Unverified IframeClient"),this._client.off("verified",this._clientVerified,this),this._client.off("unverified",this._clientUnverified,this),this._client=new m.default({env:this._env,stats:this._stats}),this._clientType="iframe-unverified",this._client.on("unverified",this._clientUnverified,this),this._client.on("verified",this._clientVerified,this),this._client.verify()}},{key:"_sendClientTypeGauge",value:function(){this._stats.logGauge("pubsub-js-client."+this._clientType)}}]),t}(l.default);window.__Twitch__pubsubInstances=window.__Twitch__pubsubInstances||{production:null,staging:null,darklaunch:null},t.default={getInstance:a}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),c=n(6),u=i(c),l=n(1),h=i(l),f=n(2),d=i(f),p=n(10),_=i(p),g=h.default._getLogger("IframeClient"),v=function(e){function t(e){s(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._parentUrl=e.parentUrl,n._pendingResponses=new _.default,n._listens=new u.default,window.addEventListener("message",n.receiveMessage.bind(n),!1),n}return o(t,e),a(t,[{key:"connect",value:function(){window.parent.postMessage({twitch_protocol:"pubsub",type:"connect"},this._parentUrl)}},{key:"verify",value:function(){window.parent.postMessage({twitch_protocol:"pubsub",type:"verify"},this._parentUrl),this._verifyTimeout=setTimeout(this._unverified.bind(this),1e3)}},{key:"Listen",value:function(e){g.debug("listening on "+e.topic);var t=this._generateNonce(),n={twitch_protocol:"pubsub",type:"LISTEN",nonce:t,data:{topics:[e.topic],auth_token:e.auth}};this._send(t,n,e)}},{key:"Unlisten",value:function(e){if(g.debug("unlistening on "+e.topic+"("+this._listens.count(e.topic)+" listeners)"),this._listens.count(e.topic)>1)return e.message&&this._listens.off(e.topic,e.message),e.success&&e.success(),void g.debug("now have "+this._listens.count(e.topic)+" listeners");var t=this._generateNonce(),n={twitch_protocol:"pubsub",type:"UNLISTEN",nonce:t,data:{topics:[e.topic]}};this._send(t,n,e)}},{key:"_send",value:function(e,t,n){this._pendingResponses.set(e,{timeout:setTimeout(this._onResponseTimeout.bind(this),3e4,e),topic:n.topic,auth:n.auth,message:t,callbacks:{success:n.success,failure:n.failure,message:n.message}}),window.parent.postMessage(t,this._parentUrl)}},{key:"receiveMessage",value:function(e){if(e.data&&"pubsub"==e.data.twitch_protocol)switch(g.debug("Received message: "+JSON.stringify(e.data)),e.data.type){case"connected":this._trigger("connected");break;case"disconnected":this._trigger("disconnected");break;case"success":this.handleResponse(!0,e.data);break;case"failure":this.handleResponse(!1,e.data);break;case"message":this.handleMessage(e.data.topic,e.data.message);break;case"verify":this._verified()}}},{key:"handleResponse",value:function(e,t){if(this._pendingResponses.has(t.nonce)){var n=this._pendingResponses.get(t.nonce);g.debug("ResponseInfo: "+JSON.stringify(n)),clearTimeout(n.timeout),this._pendingResponses.remove(t.nonce),e?(n.callbacks.message&&("LISTEN"===n.message.type?this._listens.on(n.topic,n.callbacks.message,this):"UNLISTEN"===n.message.type&&this._listens.off(n.topic,n.callbacks.message,this)),n.callbacks.success&&n.callbacks.success()):n.callbacks.failure&&n.callbacks.failure(t.error)}}},{key:"handleMessage",value:function(e,t){g.debug("received '"+t+"' on topic "+e),this._listens._trigger(e,t)}},{key:"_onResponseTimeout",value:function(e){g.debug("response timed out: "+e)}},{key:"_verified",value:function(){g.debug("Verified"),clearTimeout(this._verifyTimeout),this._trigger("verified")}},{key:"_unverified",value:function(){window.removeEventListener("message",this.receiveMessage.bind(this),!1),this._trigger("unverified")}},{key:"_generateNonce",value:function(){return d.default.generateString(30)}}]),t}(u.default);t.default=v},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(1),o=function(e){return e&&e.__esModule?e:{default:e}}(r),a=1e4,c=o.default._getLogger("IframeHost"),u=function(){function e(t){i(this,e),this._driver=t,this._sources=[],this._listeners=[],this._driver.on("connected",this.handleConnected,this),this._driver.on("disconnected",this.handleDisconnected,this),window.addEventListener("message",this.receiveMessage.bind(this),!1),this._orphanedListenerCheckTimer=setInterval(this._checkOrphanedListeners.bind(this),a)}return s(e,[{key:"destroy",value:function(){clearInterval(this._orphanedListenerCheckTimer)}},{key:"receiveMessage",value:function(e){if(e.data&&"pubsub"==e.data.twitch_protocol&&e.source)switch(c.debug("Received message: "+JSON.stringify(e.data)),e.data.type){case"LISTEN":this.handleListen(e.source,e.data.nonce,e.data.data);break;case"UNLISTEN":this.handleUnlisten(e.source,e.data.nonce,e.data.data);break;case"connect":this._sources.push(e.source),this._driver.connect();break;case"verify":e.source.postMessage({twitch_protocol:"pubsub",type:"verify"},"*")}}},{key:"_pushListener",value:function(e,t){for(var n=0;n<this._listeners.length;n++)if(this._listeners[n].source===e&&this._listeners[n].topic===t)return null;var i={source:e,topic:t,message:function(n){e.postMessage({twitch_protocol:"pubsub",type:"message",topic:t,message:n},"*")}};return this._listeners.push(i),i}},{key:"_popListener",value:function(e,t){for(var n=0;n<this._listeners.length;n++)if(this._listeners[n].source===e&&this._listeners[n].topic===t)return this._listeners.splice(n,1)[0];return null}},{key:"_checkOrphanedListeners",value:function(){for(var e=0;e<this._listeners.length;e++)this._listeners[e].source.closed&&this._cleanUpOrphanedListener(this._listeners.splice(e--,1)[0])}},{key:"_cleanUpOrphanedListener",value:function(e){c.debug("Cleaning up orphaned listener for topic: "+e.topic),this._driver.Unlisten({topic:e.topic,success:function(){c.debug("Success when cleaning up orphaned listener for topic: "+e.topic)},failure:function(t){c.debug("Error when cleaning up orphaned listener for topic: "+e.topic+" Error: "+t)},message:e.message})}},{key:"handleListen",value:function(e,t,n){var i=this._pushListener(e,n.topics[0]);if(!i)return void e.postMessage({twitch_protocol:"pubsub",type:"success",nonce:t},"*");this._driver.Listen({topic:i.topic,auth:n.auth_token,success:function(){e.postMessage({twitch_protocol:"pubsub",type:"success",nonce:t},"*")},failure:function(n){e.postMessage({twitch_protocol:"pubsub",type:"failure",nonce:t,error:n},"*")},message:i.message})}},{key:"handleUnlisten",value:function(e,t,n){var i=this._popListener(e,n.topics[0]);if(!i)return void c.debug("Failed to unlisten, could not find listener for topic "+n.topics[0]);this._driver.Unlisten({topic:i.topic,auth:n.auth_token,success:function(){e.postMessage({twitch_protocol:"pubsub",type:"success",nonce:t},"*")},failure:function(n){e.postMessage({twitch_protocol:"pubsub",type:"failure",nonce:t,error:n},"*")},message:i.message})}},{key:"handleConnected",value:function(){for(var e=0;e<this._sources.length;e++)this._sources[e].postMessage({twitch_protocol:"pubsub",type:"connected"},"*")}},{key:"handleDisconnected",value:function(){for(var e=0;e<this._sources.length;e++)this._sources[e].postMessage({twitch_protocol:"pubsub",type:"disconnected"},"*")}}]),e}();t.default=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),c=n(6),u=i(c),l=n(1),h=i(l),f=n(2),d=i(f),p=n(41),_=i(p),g=n(10),v=i(g),b=h.default._getLogger("WebsocketClient"),y="wss://pubsub-edge.twitch.tv:443/v1",m="wss://pubsub-edge-darklaunch.twitch.tv:443/v1",w="ws://localhost:6900/v1",k=function(e){function t(e){s(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));switch(n._opts=e,n._env=e.env,n._stats=e.stats,n._env){case"production":n._addr=y;break;case"darklaunch":n._addr=m;break;case"development":n._addr=w;break;default:n._addr=y}return window.WebSocket?(n._queuedRequests=[],n._pendingResponses=new v.default,n._pendingReplayResponses=new v.default,n._listens=new u.default,n._replays=new v.default,n._replaysSize=0,n._firstConnectTime=n._firstListenTime=0,n._connectCalled=n._reconnecting=!1,n._primarySocket=new _.default({stats:n._stats,addr:n._addr}),n._bindPrimary(n._primarySocket),n):r(n)}return o(t,e),a(t,[{key:"verify",value:function(){this._trigger("verified")}},{key:"connect",value:function(){window.WebSocket&&(this._connectCalled?this._primarySocket._isReady()&&this._trigger("connected"):(this._connectCalled=!0,this._primarySocket.connect()))}},{key:"_bindPrimary",value:function(e){e.on("open",this._onPrimaryOpen,this),e.on("response",this._onResponse,this),e.on("message",this._onMessage,this),e.on("reconnect",this._onReconnect,this),e.on("connection_failure",this._onConnectionFailure,this)}},{key:"_unbindPrimary",value:function(e){e.off("open",this._onPrimaryOpen,this),e.off("response",this._onResponse,this),e.off("message",this._onMessage,this),e.off("reconnect",this._onReconnect,this),e.off("connection_failure",this._onConnectionFailure,this)}},{key:"_onPrimaryOpen",value:function(){b.debug("primary open: "+this._primarySocket._id),0===this._firstConnectTime&&(this._firstConnectTime=d.default.time.now(),this._firstListenTimeout=setTimeout(this._neverListened.bind(this),45e3)),this._connected=!0,this._trigger("connected"),this._flushQueuedRequests()}},{key:"_onResponse",value:function(e){if(b.debug("primary response: "+JSON.stringify(e)),this._pendingResponses.has(e.nonce)){var t=this._pendingResponses.get(e.nonce);b.debug("responseInfo: "+JSON.stringify(t)),clearTimeout(t.timeout),this._pendingResponses.remove(e.nonce),""===e.error?("LISTEN"===t.message.type?(0===this._firstListenTime&&(clearTimeout(this._firstListenTimeout),this._firstListenTime=d.default.time.now(),this._stats.logTimer("time_to_first_listen",this._firstListenTime-this._firstConnectTime,.1)),this._replays.set(e.nonce,{nonce:e.nonce,message:t.callbacks.message,topic:t.topic,auth:t.auth}),t.callbacks.message&&this._listens.on(t.topic,t.callbacks.message,this)):"UNLISTEN"===t.message.type&&(this._replays.remove(e.nonce),t.callbacks.message&&this._listens.off(t.topic,t.callbacks.message,this)),t.callbacks.success&&t.callbacks.success()):t.callbacks.failure&&t.callbacks.failure(e.error)}}},{key:"_onResponseTimeout",value:function(e){if(this._pendingResponses.has(e)){var t=this._pendingResponses.get(e);this._pendingResponses.remove(e),t.callbacks.failure&&t.callbacks.failure("response timeout")}}},{key:"_onMessage",value:function(e){b.debug("primary message: "+JSON.stringify(e)),this._listens._trigger(e.data.topic,e.data.message)}},{key:"_onConnectionFailure",value:function(){b.debug("connection failure"),this._trigger("disconnected"),this._notifyWhenOpen=!0,this._onReconnect()}},{key:"_onReconnect",value:function(){b.debug("reconnecting..."),this._reconnecting=!0,this._backupSocket=new _.default({stats:this._stats,addr:this._addr}),this._bindBackup(this._backupSocket),setTimeout(this._backupSocket.connect.bind(this._backupSocket),this._jitteredReconnectDelay())}},{key:"_bindBackup",value:function(e){e.on("open",this._onBackupOpen,this),e.on("response",this._onBackupResponse,this)}},{key:"_unbindBackup",value:function(e){e.off("open",this._onBackupOpen,this),e.off("response",this._onBackupResponse,this)}},{key:"_onBackupOpen",value:function(){b.debug("Backup socket opened"),this._replays.size()>0?this._replayBackup():(this._swapSockets(),this._notifyWhenOpen&&(b.debug("triggering connected"),this._notifyWhenOpen=!1,this._trigger("connected")))}},{key:"_replayBackup",value:function(){for(var e=this._replays.values(),t=0;t<e.length;t++){var n={type:"LISTEN",nonce:this._generateNonce(),data:{topics:[e[t].topic],auth_token:e[t].auth}};this._pendingReplayResponses.set(n.nonce,!0),this._backupSocket.send(n)}}},{key:"_onBackupResponse",value:function(e){this._pendingReplayResponses.has(e.nonce)&&""===e.error&&(this._pendingReplayResponses.remove(e.nonce),0===this._pendingReplayResponses.size()&&(this._swapSockets(),this._notifyWhenOpen&&(b.debug("triggering connected"),this._notifyWhenOpen=!1,this._trigger("connected"))))}},{key:"_swapSockets",value:function(){b.debug("swapping primary "+this._primarySocket._id+" and backup "+this._backupSocket._id),this._unbindPrimary(this._primarySocket),this._unbindBackup(this._backupSocket),this._bindPrimary(this._backupSocket),this._primarySocket.close(),this._primarySocket=this._backupSocket,this._reconnecting=!1,this._flushQueuedRequests()}},{key:"Listen",value:function(e){if(window.WebSocket){b.debug("listening on "+e.topic);var t=this._generateNonce(),n={type:"LISTEN",nonce:t,data:{topics:[e.topic],auth_token:e.auth}};this._queuedSend(t,n,e)}}},{key:"Unlisten",value:function(e){if(window.WebSocket){if(b.debug("unlistening on "+e.topic+"("+this._listens.count(e.topic)+" listeners)"),this._listens.count(e.topic)>1){this._listens.off(e.topic,e.message);for(var t in this._replays.map())if(this._replays.get(t).message===e.message){this._replays.remove(t);break}return e.success&&e.success(),void b.debug("now have "+this._listens.count(e.topic)+" listeners")}var n=this._generateNonce(),i={type:"UNLISTEN",nonce:n,data:{topics:[e.topic]}};this._queuedSend(n,i,e)}}},{key:"_queuedSend",value:function(e,t,n){this._reconnecting||!1===this._primarySocket._isReady()?(b.debug("queuing"),this._queuedRequests.push({nonce:e,msg:t,opts:n})):(b.debug("sending immediately"),this._send(e,t,n))}},{key:"_flushQueuedRequests",value:function(){for(b.debug("flushing "+this._queuedRequests.length+" listen/unlistens");this._queuedRequests.length>0;){var e=this._queuedRequests.shift();this._send(e.nonce,e.msg,e.opts)}}},{key:"_send",value:function(e,t,n){this._pendingResponses.set(e,{timeout:setTimeout(this._onResponseTimeout.bind(this),3e4,e),topic:n.topic,auth:n.auth,message:t,callbacks:{success:n.success,failure:n.failure,message:n.message}}),this._primarySocket.send(t)}},{key:"_neverListened",value:function(){this._stats.logCounter("first_listen_timeout",1)}},{key:"_generateNonce",value:function(){return d.default.generateString(30)}},{key:"_jitteredReconnectDelay",value:function(){return d.default.randomInt(2e3)}}]),t}(u.default);t.default=k},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),c=n(6),u=i(c),l=n(1),h=i(l),f=n(2),d=i(f),p=h.default._getLogger("PubsubSocket"),_=function(e){function t(e){s(this,t);var n=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._opts=e,n._addr=e.addr,n._stats=e.stats,n._connectionAttempts=0,n._sentPing=n._receivedPong=!1,n._id="["+d.default.generateString(10)+"] ",window.addEventListener("beforeunload",n._beforeUnload.bind(n)),n}return o(t,e),a(t,[{key:"connect",value:function(){p.debug(this._id+"connecting to "+this._addr),this._connecting=!0,this._socketConnectTime=d.default.time.now();try{this._socket=new WebSocket(this._addr),this._socket.onmessage=this._onMessage.bind(this),this._socket.onerror=this._onError.bind(this),this._socket.onclose=this._onClose.bind(this),this._socket.onopen=this._onOpen.bind(this)}catch(e){this._stats.logCounter("socket.error.security_err",1,1),this._trigger("connection_failure")}}},{key:"close",value:function(){p.debug(this._id+"closing"),this._closing=!0,this._clearTimeouts(),this._socket.close()}},{key:"send",value:function(e){p.debug(this._id+"sending "+JSON.stringify(e)),this._isReady()?this._socket.send(JSON.stringify(e)):this._trigger("error","not_ready")}},{key:"_isReady",value:function(){return p.debug(this._id+"_isReady called"),!!this._socket&&this._socket.readyState===WebSocket.OPEN}},{key:"_onMessage",value:function(e){p.debug(this._id+"received message: "+e.data);try{var t=JSON.parse(e.data);switch(t.type){case"RESPONSE":this._trigger("response",t);break;case"MESSAGE":this._trigger("message",t);break;case"PONG":this._receivedPong=!0;break;case"RECONNECT":this._trigger("reconnect")}}catch(e){this._stats.logLine("onMessage JSON Parse error: "+e)}}},{key:"_onError",value:function(e){p.debug(this._id+"error: "+JSON.stringify(e))}},{key:"_onClose",value:function(e){if(p.debug(this._id+"onClose triggered with code "+e.code+"(closing = "+this._closing+", connecting = "+this._connecting+")"),this._clearTimeouts(),this._connecting){var t=Math.pow(2,this._connectionAttempts);t>120&&(t=120),p.debug(this._id+"reconnecting in "+t+" seconds"),this._connectionAttempts+=1,this._nextConnectionAttempt=setTimeout(this.connect.bind(this),1e3*t)}else if(this._closing)this._closed=!0,this._trigger("connection_failure");else{if(this._windowUnloading)return;p.debug(this._id+"unexpected close"),this._stats.logCounter("socket.error.unexpected_closed",1,1),this._stats.logCounter("socket.error.close."+e.code,1,1);var n="pubsub-js-client unexpected_close. code: "+e.code+", reason: "+e.reason+", wasClean: "+e.wasClean;this._stats.logLine(n),this._closed=!0,this._trigger("connection_failure")}}},{key:"_onOpen",value:function(e){p.debug(this._id+" socket opened"),this._connectionAttempts=0,this._connecting=!1,this._socketConnectTime&&this._stats.logTimer("socket.connect",d.default.time.now()-this._socketConnectTime,.1),this._stats.logCounter("socket.connection_retries."+this._connectionAttempts,1,.1),this._ping(),this._pingInterval=window.setInterval(this._ping.bind(this),24e4),this._trigger("open")}},{key:"_ping",value:function(){p.debug(this._id+"sending PING");try{this._socket.send(JSON.stringify({type:"PING"})),this._sentPing=!0,this._pongTimeout&&clearTimeout(this._pongTimeout),this._pongTimeout=setTimeout(this._pongTimedOut.bind(this),3e4)}catch(e){this._stats.logCounter("socket.error.ping_send_error",1,1),this._stats.logLine("ping error: closed: "+this._closed+", error: "+e),this.close()}}},{key:"_pongTimedOut",value:function(){this._sentPing&&!this._receivedPong&&(p.debug(this._id+"Pong timed out!"),this._stats.logCounter("socket.error.pong_timed_out",1,1),this.close())}},{key:"_clearTimeouts",value:function(){this._sentPing=this._receivedPong=!1,clearTimeout(this._pongTimeout),clearInterval(this._pingInterval),clearTimeout(this._nextConnectionAttempt)}},{key:"_beforeUnload",value:function(){this._windowUnloading=!0}}]),t}(u.default);t.default=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Stats=void 0;var i=n(43),s=function(e){return e&&e.__esModule?e:{default:e}}(i);t.Stats=s.default,t.default={Stats:s.default}},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){var n=u[e];if(!n)throw new Error("Invalid environment - got "+e);if(!t)throw new Error("Invalid prefix - got "+t);window[c]=window[c]||{};var i=window[c];i[e]||(i[e]=new l(n));var s=i[e];return new h(s,t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=500,a=20,c="__Twitch__statsInstances_1",u={production:{addr:"https://client-event-reporter.twitch.tv"},darklaunch:{addr:"https://client-event-reporter-darklaunch.twitch.tv"}};u.staging=u.darklaunch,u.development=u.darklaunch,u.test=u.darklaunch;var l=function(){function e(t){if(i(this,e),!t)throw new Error("config is required");this._addr=t.addr,this._resetCombinedStats(),this._recordDelay=o,this._maxPendingStats=a}return r(e,[{key:"logCounter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._combinedStats.counters.push({key:e,count:t,sample_rate:n}),this._record()}},{key:"logTimer",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._combinedStats.timers.push({key:e,milliseconds:t,sample_rate:n}),this._record()}},{key:"logLine",value:function(e){this._combinedStats.log_lines.push({log_line:e}),this._record()}},{key:"logGauge",value:function(e){this._combinedStats.gauges.push({key:e}),this._record()}},{key:"_resetCombinedStats",value:function(){this._combinedStats={timers:[],counters:[],log_lines:[],gauges:[]}}},{key:"_record",value:function(){var e=this;this._numPendingStats()>this._maxPendingStats?(this._flushTimeout&&(clearTimeout(this._flushTimeout),this._flushTimeout=null),this._flush()):this._flushTimeout||(this._flushTimeout=setTimeout(function(){e._flushTimeout=null,e._flush()},this._recordDelay))}},{key:"_flush",value:function(){var e=this._combinedStats;this._resetCombinedStats();var t=this._addr+"/v1/stats",n=this._createCorsRequest("POST",t);if(!n)return void console.log("WARNING: Cannot send stats because CORS is unsupported");n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(e))}},{key:"_numPendingStats",value:function(){var e=this._combinedStats;return e.timers.length+e.counters.length+e.log_lines.length+e.gauges.length}},{key:"_createCorsRequest",value:function(e,t){var n=new XMLHttpRequest;return"withCredentials"in n?n.open(e,t,!0):"undefined"!=typeof XDomainRequest?(n=new XDomainRequest,n.open(e,t)):n=null,n}}]),e}(),h=function(){function e(t,n){if(i(this,e),!t)throw new Error("Missing backend");if(!n)throw new Error("Missing prefix");this._backend=t,this._prefix=n}return r(e,[{key:"logCounter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._backend.logCounter(this._prefix+"."+e,t,n)}},{key:"logTimer",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._backend.logTimer(this._prefix+"."+e,t,n)}},{key:"logLine",value:function(e){this._backend.logLine(e)}},{key:"logGauge",value:function(e){this._backend.logGauge(e)}},{key:"setPrefix",value:function(e){if(!e)throw new Error("Missing prefix");this._prefix=e}}]),e}();t.StatsBackend=l,t.PrefixedStats=h,t.default={getInstance:s}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(2),a=i(o),c=n(1),u=i(c),l="https://pubster.twitch.tv/publish",h="https://pubster-darklaunch.twitch.tv/publish",f="pubsubtest.unique.",d="pubsubtest.shared."+a.default.randomInt(10),p=u.default._getLogger("PubsubTest"),_=function(){function e(t){if(s(this,e),!window.$)return void p.debug("PubsubTest could not be enabled. JQuery is undefined.");switch(p.debug("PubsubTest enabled"),this._env=t.env,this._driver=t.driver,this._stats=t.stats,this._env){case"production":this._addr=l;break;case"darklaunch":this._addr=h;break;default:this._env="production",this._addr=l}this._statKeys={uniqueSuccess:"test.unique.success",uniqueFailure:"test.unique.failure",sharedSuccess:"test.shared.success",sharedFailure:"test.shared.failure"},this._uniqueKey=f+a.default.generateString(20),this._sharedKey=d,this._listeningUnique=this._listeningShared=!1,this.sendListens()}return r(e,[{key:"sendListens",value:function(){this._driver.Listen({topic:this._uniqueKey,auth:"",success:this._gotUniqueOk.bind(this),failure:this._gotUniqueFail.bind(this),message:this._gotUniqueMessage.bind(this)}),this._driver.Listen({topic:this._sharedKey,auth:"",success:this._gotSharedOk.bind(this),failure:this._gotSharedFail.bind(this),message:this._gotSharedMessage.bind(this)})}},{key:"_gotUniqueOk",value:function(){this._listeningUnique=!0,this._listeningShared&&this.startTesting()}},{key:"_gotUniqueFail",value:function(e){}},{key:"_gotSharedOk",value:function(){this._listeningShared=!0,this._listeningUnique&&this.startTesting()}},{key:"_gotSharedFail",value:function(e){}},{key:"startTesting",value:function(){p.debug("startTesting"),this._driver.on("connected",this.resumeTesting,this),this._driver.on("disconnected",this.stopTesting,this),this.checkAndSend(),this._publishInterval=window.setInterval(this.checkAndSend.bind(this),6e4)}},{key:"resumeTesting",value:function(){p.debug("resumeTesting"),this.checkAndSend(),this._publishInterval=window.setInterval(this.checkAndSend.bind(this),6e4)}},{key:"stopTesting",value:function(){p.debug("stopTesting"),clearInterval(this._publishInterval),this._receivedUniqueMessage=this._sentUniqueMessage=!1,this._receivedSharedMessage=this._sentSharedMessage=!1}},{key:"checkAndSend",value:function(){p.debug("checkAndSend: unique: sent = "+this._sentUniqueMessage+", received = "+this._receivedUniqueMessage),!this._receivedUniqueMessage&&this._sentUniqueMessage&&(p.debug("unique failure"),this._stats.logCounter(this._statKeys.uniqueFailure,1,1)),!this._receivedSharedMessage&&this._sentSharedMessage&&(p.debug("shared failure"),this._stats.logCounter(this._statKeys.sharedFailure,1,1)),this._receivedUniqueMessage=this._sentUniqueMessage=!1,this._receivedSharedMessage=this._sentSharedMessage=!1,this._expectedMessage=a.default.generateString(30),$.ajax({type:"POST",url:this._addr,contentType:"application/json",timeout:3e4,data:JSON.stringify({topics:[this._uniqueKey],data:this._expectedMessage}),success:function(){p.debug("unique message sent"),this._sentUniqueMessage=!0}.bind(this)}),this._sentUniqueMessageTime=a.default.time.now(),Math.random()<1e-4&&($.ajax({type:"POST",url:this._addr,contentType:"application/json",timeout:3e4,data:JSON.stringify({topics:[this._sharedKey],data:this._expectedMessage}),success:function(){p.debug("shared message sent"),this._sentSharedMessage=!0}.bind(this)}),this._sentSharedMessageTime=a.default.time.now())}},{key:"_gotUniqueMessage",value:function(e){if(p.debug("received unique message: "+e),e===this._expectedMessage){var t=a.default.time.now()-this._sentUniqueMessageTime;this._receivedUniqueMessage=!0,this._stats.logTimer(this._statKeys.uniqueSuccess,t,.1),this._stats.logCounter(this._statKeys.uniqueSuccess,1,.1)}}},{key:"_gotSharedMessage",value:function(e){if(e===this._expectedMessage){var t=a.default.time.now()-this._sentSharedMessageTime;this._receivedSharedMessage=!0,this._stats.logTimer(this._statKeys.sharedSuccess,t,.1),this._stats.logCounter(this._statKeys.sharedSuccess,1,.1)}}}]),e}();t.default=_},function(e,t,n){"use strict";function i(e){return-1===e.indexOf(".")}function s(){}t.a=i,t.b=s},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var i,s=n(3),r=(n.n(s),n(0)),o=(n.n(r),n(5));!function(e){e.Reload="purchases-event-reload-entitlements"}(i||(i={}));var a=function(){function e(){var e=this;this.eventEmitter=new s.EventEmitter2,this.beginPurchase=function(e){Object(o.d)({action:r.ExtensionAction.TwitchExtBeginPurchase,payload:{sku:e}})},this.onReloadEntitlements=function(t){e.eventEmitter.removeAllListeners(i.Reload),e.eventEmitter.addListener(i.Reload,t)},this.getPrices=function(){return e.prices},this.setupProducts()}return Object.defineProperty(e.prototype,"publicAPI",{get:function(){return{beginPurchase:this.beginPurchase,getPrices:this.getPrices,onReloadEntitlements:this.onReloadEntitlements}},enumerable:!0,configurable:!0}),e.prototype.onControllerMessage=function(e){switch(e.action){case r.ExtensionAction.TwitchExtProductPrices:this.setPrices(e.prices);break;case r.ExtensionAction.TwitchExtReloadEntitlements:this.eventEmitter.emit(i.Reload)}},e.prototype.setupProducts=function(){var e=this;this.prices=new Promise(function(t){e.setPrices=t})},e}()},function(e,t,n){"use strict";var i=n(48);n.d(t,"a",function(){return i.a})},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var i;!function(e){e.Log="twitch-ext-rig-log"}(i||(i={}));var s=function(){function e(){}return Object.defineProperty(e.prototype,"publicAPI",{get:function(){return{log:this.log}},enumerable:!0,configurable:!0}),e.prototype.log=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];window.parent.postMessage({action:i.Log,messages:[e].concat(t)},"*")},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var i=n(0),s=(n.n(i),n(11)),r=["click","mousemove"],o=function(){function e(e,t,n,s){var r=this;this.onDOMContentLoaded=function(){r.window.addEventListener("message",r.handleMessageEvent,!1),r.parentWindow.postMessage({action:i.ExtensionAction.TwitchExtLoaded},"*"),r.forceVideoOverlayFullSize()},this.bindLongtaskHandler=function(){window.PerformanceObserver&&window.PerformanceLongTaskTiming&&(r.performanceObserver=new window.PerformanceObserver(function(e){e.getEntries().forEach(r.trackLongtask)}),r.performanceObserver.observe({entryTypes:["longtask"]}))},this.unbindLongtaskHandler=function(){r.performanceObserver&&(r.performanceObserver.disconnect(),r.performanceObserver=void 0)},this.trackLongtask=function(e){r.shouldTrackLongtask(e)&&r.parentWindow.postMessage({action:i.ExtensionAction.TwitchExtLongtask,payload:{longtask_duration:e.duration}},"*")},this.onMouseAction=function(e){r.parentWindow.postMessage({action:i.ExtensionAction.TwitchExtUserAction,payload:{type:e.type,clientX:e.clientX,clientY:e.clientY}},"*"),r.forceVideoOverlayFullSize()},this.onFocus=function(e){switch(e.target.tagName.toLowerCase()){case"input":case"select":case"textarea":case"button":return;default:r.parentWindow.postMessage({action:i.ExtensionAction.TwitchExtUserAction,payload:{type:e.type}},"*")}},this.window=n||window,this.parentWindow=this.window.parent,this.documentObject=s||document,this.params=e,this.handleMessageEvent=t,this.isViewerVideoOverlay="video_overlay"===this.params.anchor&&this.params.mode===i.ExtensionMode.Viewer}return e.prototype.forceVideoOverlayFullSize=function(){this.isViewerVideoOverlay&&Object(s.a)(this.documentObject)},e.prototype.bindEvents=function(){var e=this;this.documentObject.addEventListener("DOMContentLoaded",this.onDOMContentLoaded),r.forEach(function(t){e.documentObject.addEventListener(t,e.onMouseAction,!0)}),this.documentObject.addEventListener("focusin",this.onFocus,!0),this.bindLongtaskHandler()},e.prototype.unbindEvents=function(){var e=this;this.documentObject.removeEventListener("DOMContentLoaded",this.onDOMContentLoaded),r.forEach(function(t){e.documentObject.removeEventListener(t,e.onMouseAction,!0)}),this.documentObject.removeEventListener("focusin",this.onFocus,!0),this.unbindLongtaskHandler()},e.prototype.shouldTrackLongtask=function(e){var t=.1>Math.random(),n="self"===e.name;return t&&n},e}()}]);