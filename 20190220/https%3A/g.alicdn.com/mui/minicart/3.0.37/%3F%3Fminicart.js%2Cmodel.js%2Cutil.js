KISSY.add("mui/minicart/minicart",function(t,a,e,i,r,n,s){var o={};var c=0;t.mix(o,{version:"%VERSION%",init:function(i,r){if(c){return}c++;var s=this;s.carttype=1;i=a.get(i);r=t.merge({},r);a.addClass(i,"tm-mCart");s.el=i;var o=function(){i.innerHTML='<div class="tm-mcRoot">'+'<div class="tm-mcListBox"><div class="tm-mcListInner"><div class="tm-mcList"></div></div><div class="tm-mcLoading"></div><div class="tm-mcMask"></div></div>'+'<div class="tm-mcHandler">'+'<div class="tm-mcApart"></div>'+'<div class="tm-mcGrace"></div>'+"</div>"+"</div>";s.handlerEl=a.get("div.tm-mcHandler",i);s.listBoxEl=a.get("div.tm-mcListBox",i);s.listInnerEl=a.get("div.tm-mcListInner",i);s.listEl=a.get("div.tm-mcList",i);s.rootEl=a.get("div.tm-mcRoot",i);s.graceEl=a.get("div.tm-mcGrace",i);s.apartEl=a.get("div.tm-mcApart",i);s.renderHandler();t.use("mui/minicart/fullext",function(){s.strectch()});e.on(s.rootEl,"click",function(t){t.stopPropagation();var e=t.target;do{if(e===this){return}var i=a.attr(e,"data-tmc");if("."===i){return}if(i){if("A"===e.nodeName){t.preventDefault()}return s[i](e)}e=a.parent(e)}while(true)});n.detach("numInit",o)};n.on("numInit",o);n.numInit();s.CartModel=n},login:function(a){var e=this;n.record("tmalljy.2.5?action=openmininotlogin_v102&ver="+e.carttype);var i=n.get("_mallbarItem");var r=n.get("_mallbarConf");if(i&&r){i.fire(r.E.LOGIN,{success:function(){n.set("_isLogin",true);if(t.isFunction(a)){return a()}if(TB&&TB.Global&&TB.Global.writeLoginInfo){TB._isMemberInfoReady=false;TB._isLoginStatusReady=false;TB.Global.writeLoginInfo()}}})}},cart:function(){window.open(n.getApi("bcart"),"_blank")},add:function(e,i,r){var s=this;s.addData={params:t.clone(e),success:i,error:r};var o=e.anim;delete e.anim;i=i||function(){};n.set("_cached",false);n.add({data:e,success:function(t){if(window.TB&&TB.Global&&TB.Global.mallbar){var r=o.startNode;var n=40;var s=40;TB.Global.mallbar.driving({e:{target:o.startNode,pageX:a.offset(r).left+(a.width(r)-n)/2,pageY:a.offset(r).top-s},type:"cart",flyer:o.img,width:n,height:s,params:e,speed:2,callback:function(){i(t)}})}},error:r||i})},invalidCache:function(){n.set("_cached",false)},loginThenAdd:function(){var t=this;t.login(function(){var a=t.addData;t.add(a.params,a.success,a.error)})},renderHandler:function(){var t=this;var e=n.getNum("total");var i="";if(n.get("_listFilled")&&!t.cartDegr){i+='<div class="tm-mcCashier-wrap">';i+=o();i+=c();i+='<div class="tm-mcTotal clearfix">'+'<h3><span class="tm-e1">\u8d2d\u7269\u8f66</span><span class="tm-e2">\u5df2\u9009</span><strong class="tm-mcCartNumTotal">'+e+'</strong><strong class="tm-mcCheckedNum">'+(n.get("_checkedCount")||0)+'</strong><span class="tm-e2">\u4ef6</span></h3>'+'<span class="tm-mcTotalFeeWrap"><strong class="tm-mcTotalFee">'+s.toMoney(n.get("_totalFee"),n.get("_totalCurrency"))+"</strong></span>"+"</div>";i+='<div class="tm-mcCashier" data-tmc="go">';i+='<div class="tm-mcGo">\u7ed3 \u7b97<s></s></div>';i+="</div>";i+="</div>"}var r=t.handlerEl;a.remove(".tm-mcCashier-wrap",r);a.append(a.create(i),r);function o(){var t="";if(n.get("isDouble11Pre")){t='<div class="tianmaobao j_tianmaobao"><a href="//chong.alipay.com/i/chong.htm" title="\u5929\u732b\u5b9d"><img src="//gtms01.alicdn.com/tps/i1/TB1p6vmGpXXXXXPXFXXYZaeLVXX-280-46.png"/></a></div>'}return t}function c(){var t="";var a=n.get("tmallEppCart");if(a){t+='<a class="tmallEppCart" href="'+a+'" title="\u8fdb\u5165\u4f01\u4e1a\u91c7\u8d2d\u8d2d\u7269\u8f66">';t+='<img class="icon" src="//img.alicdn.com/tfs/TB1Ah_CKFXXXXXHXVXXXXXXXXXX-78-78.png"/>';t+="<span>\u8fdb\u5165\u4f01\u4e1a\u91c7\u8d2d\u8d2d\u7269\u8f66</span>";t+='<img class="arrow" src="//img.alicdn.com/tfs/TB1ZiDGKFXXXXccXFXXXXXXXXXX-14-22.png"/>';t+="</a>"}return t}}});n.on("after_counterDownChange",function(t){a[t.newVal?"addClass":"removeClass"](o.el,"tm-mcCounterDown")});n.on("after_countMaxChange",function(t){a[t.newVal?"addClass":"removeClass"](o.el,"tm-mcCountMax")});window.MiniCartModel=n;window.TMiniCart=o;return o},{requires:["dom","event","anim","ua","mui/minicart/model","mui/minicart/util","mui/minicart/minicart.css"]});KISSY.add("mui/minicart/model",function(t,e,a,r,i,n,c){var s=function(){var e=false;var a=[];var r=new Image;window["_tmcr_"+t.now()]=r;r.onload=r.onerror=function(){e=false;i()};function i(){if(e){return}var i=a.shift();if(i){e=true;r.src="//gm.mmstat.com/"+i+(i.indexOf("?")>-1?"&":"?")+t.now()}}return function(t){if(t){a.push(t);i()}}}();KISSY.config({packages:{"sd/data_sufei":{base:"//g.alicdn.com/sd/data_sufei/1.3.6/sufei",ignorePackageNameInUri:true,charset:"utf8"}}});KISSY.use("sd/data_sufei/sufei",function(t,e){});function o(){var t=this;var e=location.hostname;var a=e.match(/\b(daily|com\.hk)\b/);var r=e.match(/\.hk\b/);var i=e.match(/\.95095/);var n=e.match(/\.liangxinyao/);var c=e.match(/\.95095\.daily\.etao\.net/);t.isDaily=a;var s=a?"daily.tmall.com.hk":"tmall.hk";var l=a?"daily.tmall.net":"tmall.com";var d=a?"daily.taobao.net":"taobao.com";var m=a?"yao.95095.daily.tmall.net":"yao.95095.com";var u=a?"liangxinyao.daily.etao.net":"liangxinyao.com";var f=a?"daily.alitrip.net":"alitrip.com";if(c){m="yao.95095.daily.etao.net"}o.superclass.constructor.call(t);t.set("_checkedMax",50);t.set("_numDanger",50);var v;if(r){v=s}else if(i){v=m}else if(n){v=u}else{v=l}t.set("host:fbuy","//{hostprefix}fbuy."+v);t.set("host:cart","//{hostprefix}cart."+l);t.set("host:buy","//{hostprefix}buy."+l);t.set("host:buyYY","//{hostprefix}buy."+m);t.set("host:buyHK","//{hostprefix}buy."+s);t.set("host:buyYYZY","//{hostprefix}buy."+u);t.set("host:buyTrip","//{hostprefix}buy."+f);t.set("api:num",(a?"//count.daily.taobao.net":"//count.taobao.com")+"/counter6");t.set("api:list","{fbuy}/cart/mini/trailMiniCart.htm");t.set("api:add","{fbuy}/cart/addCartItems.do");t.set("api:del","{fbuy}/cart/mini/delMini.do");t.set("api:update","{fbuy}/cart/mini/updateMini.do");t.set("api:check","{fbuy}/cart/mini/checkMini.do");t.set("api:sss","//{hostprefix}cart."+d+"/sss.htm");t.set("api:bag","{fbuy}/auth/buyerRemoveReward.do");t.set("api:bcart","{cart}/cart/myCart.htm");t.set("api:buyTB","//{hostprefix}buy."+d+"/auction/order/confirm_order.htm");t.set("api:buy","{buy}/order/confirmOrder.htm");t.set("api:buyHK","{buyHK}/order/confirmOrder.htm");t.set("api:buyYY","{buyYY}/order/confirm_order.htm");t.set("api:buyYYZY","{buyYYZY}/order/confirm_order.htm");t.set("api:buyTrip","{buyTrip}/order/confirmOrder.htm");t.set("api:checkLogin","{buy}/login/buy.do");t.set("api:checkLoginYY","{buyYY}/login/buy.do");t.set("api:checkLoginYYZY","{buyYYZY}/login/buy.do");t.set("api:checkLoginHK","{buyHK}/login/buy.do");t.set("api:checkLoginTrip","{buy}/login/buy.do");var h=window.TB&&TB.Global&&TB.Global.setCartNum?TB.Global.setCartNum:function(){};t.on("numChange",function(){h(this.get("_counterDown")||this.get("_countMax")?false:this.getNum("total"))})}t.extend(o,a);t.augment(o,i.Target||t.EventTarget,{DATA:{},NUM:{total:0,normal:0,invalid:0,primitive:true},TYPE:{bundle:{child:"main"},main:{parent:"bundle",child:"order"},order:{parent:"main"}},setNum:function(e,a){var r={};var i=false;if(!t.isPlainObject(e)){r[e]=a}else{r=e}var n=this.NUM;t.each(r,function(t,e){if(e in n){if(t!==n[e]){i=true}n[e]=t}});n.total=n.normal+n.invalid;if(n.total>=this.get("_numDanger")){this.set("_countMax",true)}if(n.primitive){i=true;n.primitive=false}if(i){this.fire("numChange")}this.fire("updateNum")},getNum:function(e){var a=this.NUM;if(e){return a[e]}return t.clone(a)},numInit:function(){var e=this;var a=false;var r=function(){if(a){return}a=true;var r=e.get("uid");var i="TCART_234_"+r+"_q";var n=function(a){a=a||{};e.set("__totalCount__",a[i]);var r=t.isNumber(a[i]);if(!r){e.set("_counterDown",true)}e.setNum({normal:r?e.formatNum(a[i]):0,invalid:0});e.fire("numInit")};if(r){e.xhr({api:"num",data:{keys:i},complete:n})}else{n()}};if(TB&&TB.Global&&TB.Global.loginStatusReady){TB.Global.loginStatusReady(function(a){if(a.isLogin){e.set("_isLogin",true);var i=t.later(r,5e3);TB.Global.memberInfoReady(function(t){i.cancel();var a=t.memberInfo;e.set("uid",a.cookies&&a.cookies.unb?a.cookies.unb.value:"");r()})}else{e.set("uid",a.trackId);r()}})}},dump:function(){if(window.console){window.console.log(this.getAttrVals());window.console.log(this.NUM);window.console.log(this.DATA)}},getApi:function(e){var a=this;if(-1===e.indexOf(":")){e="api:"+e}var r=a.get(e);if(r){t.each(["fbuy","buy","buyHK","cart","buyYY","buyYYZY","buyTrip"],function(t){r=r.replace("{"+t+"}",a.get("host:"+t)||"")});if("api:buyTrip"===e){r=r.replace("{hostprefix}","trip")}r=r.replace("{hostprefix}",a.get("host:prefix")||"")}return r},record:s,add:function(e){var a=this;var i=0;var s=1;e=a.mixParams(e);o(e.data);l();function o(t){t.add=r.stringify(t.add);var e=a.get("_tb_token_");if(e){t._tb_token_=e}}function l(r){if(r){o(r)}else{r=e.data}a.xhr({api:"add",data:r,success:function(t){a.set("totalSize",t.cartNum);a.setNum({normal:t.cartNum,invalid:0});e.success(t)},error:function(o){if(i>=s){return}if("CsrfCheckFail"===o.errorCode&&o.tk){i++;e.data._tb_token_=o.tk;a.set("_tb_token_",o.tk);return l()}if(!o.errorCode){o.errorCode="SERVER_BUSY";o.error="\u5ba2\u5b98\uff0c\u7f51\u7edc\u62e5\u5835\uff0c\u6dfb\u52a0\u8d2d\u7269\u8f66\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5"}if(o.errorCode==="BuyerNeedLogin"){var d={check:false};if(r.proxyURL){d.proxyURL=r.proxyURL}if(!c.show){c=new c}c.show(function(){var c=r.getParams;if(o.tk){e.data._tb_token_=o.tk;a.set("_tb_token_",o.tk)}if(t.isFunction(c)){n.when(c(),function(t){i++;return l(t)})}else{i++;return l()}},d)}else{e.error(o)}}})}},xhr:function(a){var r=this;a=t.merge({data:{},type:"get",success:function(){},error:function(){},complete:function(){},wait:function(){},needMerge:false,timeout:5},a);var i=r.getApi(a.api);var n=t.later(function(){a.wait()},360);var c=function(e){n.cancel();a.responseData=e;r.onXhrResponse(a);var i=r.get("uid");if(a.api==="num"&&!i){t.each(e,function(t,e){if(t<0){r.record("tmalljy.2.5?action=tair-error")}})}};var s=a.data;var o=r.get("_tpId");if(o){s.tpId=o}a.data=s;var l=this.get("division");if(l&&l.code){i+="?divisionCode="+l.code}if(a.api==="list"){KISSY.use("sd/data_sufei/sufei",function(t,r){new e(r({url:i,data:s,success:c,dataType:"jsonp",crossDomain:true,cache:false,timeout:a.timeout},{style:"taobao"}))});return}if("get"===a.type){e({url:i,type:"get",scriptCharset:a.scriptCharset||"gbk",data:s,dataType:"jsonp",complete:c,timeout:a.timeout})}else{r.useProxy(function(t){t.post(i,s,c,a.timeout)})}},onXhrResponse:function(e){var a=this;var i=e.responseData;if(!t.isPlainObject(i)){i={success:false}}var n=i.globalData;var c;if(n){c=n.sss;a.set("_isLogin",n.login);if(!a.get("host:prefix")&&n.hostPrefix){a.set("host:prefix",n.hostPrefix+".")}if(n.cartUrl){a.set("api:bcart",n.cartUrl)}}try{c=c||r.parse(i.sss);if(t.isPlainObject(c)&&"quantity"in c){t.getScript(a.getApi("sss")+"?quantity="+c.quantity+"&tk="+c.token+"&"+t.now())}}catch(s){}if(i.success){if(e.needMerge){a.set(n);a.merge(i.list)}if(n&&n.bundRela){a.mergeBundleRelaPromo(n)}e.success(i);if(e.needMerge){a.calculate()}}else{e.error(i)}e.complete(i)},formatNum:function(t){t-=0;return t>0?t:0},read:function(t,e,a){if(!t){return null}var r;e=e.split("/");while(r=e.shift()){if(r in t){t=t[r]}else{return a}}return t},mixParams:function(e,a){return t.merge({success:function(){},error:function(){}},a,e)},useProxy:function(e){var a=this;t.use("mui/minicart/proxy",function(t,r){r.init(a.getApi("host:fbuy")+"/cart/mini/proxy.htm",function(){});if(e){e(r)}})}});return new o},{requires:["ajax","base","json","event","promise","mui/minilogin/"]});KISSY.add("mui/minicart/util",function(t,e){var r={};t.mix(r,{toMoney:function(t,r){function i(){var t=false;if(/chaoshi/.test(location.host)){t=true}if(window.g_config&&window.g_config.bizId==="chaoshi"){t=true}return t}if(i()&&e.get("#J_NavCart")&&!e.get("#J_NavCart_rmbStyle")){var a=e.create('<style id="J_NavCart_rmbStyle">.tm-mcTotal .tm-mcRmb{display:none;} .tm-mcTotalFee,.tm-mcOrder .tm-mcPrice{font-family: verdana, arial;}</style>');e.append(a,e.get("#J_NavCart"))}if(isNaN(parseFloat(t,10))){return t}if("number"!==typeof t){t=t-0}var n=100;var c="&yen";if(r){n=r.unitFactor||n;c=r.symbol||c}t=t/n;return isNaN(t)?"":c+t.toFixed(2)},toWeight:function(t){if("number"!==typeof t){t=t-0}t/=1e3;return t||0},toTxt:function(t){var r=document.createElement("div");r.innerHTML=t;return e.text(r).replace(/\s+/g,"")},showLogin:function(e){t.use("mui/minilogin/",function(t,r){if(!r.show){r=new r}r.show(e)})}});return r},{requires:["dom"]});