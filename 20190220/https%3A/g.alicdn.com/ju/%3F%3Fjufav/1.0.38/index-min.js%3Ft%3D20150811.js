KISSY.add("jbc/jufav/1.0.38/index",function(t,a){function e(){t.ready(function(){var e=t.all("#J_HasJufav").val();"false"!=e&&a.init()})}function o(){a.addData.apply(null,arguments)}return{init:e,addData:o}},{requires:["./mods/jutools","./jufav.css","core"]}),KISSY.add("jbc/jufav/1.0.38/mods/favbox",function(t,a,e,o,n){var i=t.all,s=t.DOM,l=(t.Node,t.Event,t.Anim),c=t.IO,r="#J_favNumDom",d="#J_surNumDom",u="#J_favItemlistwrap",p="#J_surItemlistwrap",f="#J_favItemList",g="#J_surItemList",m="#J_favTagCon",v="#J_surTagCon",h="#J_favSubNav li",b="#J_surSubNav li",w=".J_icondel",_=".J_item",j="#J_justar em",k="#J_favboxparent",y="#J_justar",J="#J_justar i",C="#J_surmsg";if(-1!==window._ju_config.domain.indexOf("daily"))var x="//detail.ju.daily.taobao.net/",D="//dskip.ju.daily.taobao.net/",S="//img02.taobaocdn.net/bao/uploaded/",T="//dskip.ju.daily.taobao.net/json/collect_mark.htm";else var x="//detail.ju.taobao.com/",D="//dskip.ju.taobao.com/",S="//gju1.alicdn.com/bao/uploaded/",T="//dskip.ju.taobao.com/json/collect_mark.htm";var I={config:{getData:{url:D+"json/collect_list.htm",param:[{name:"listType",enumval:["collect","favorite"]},{name:"queryType",enumval:[1,2,3]}]},addData:{url:D+"json/add_collect.htm",param:[{name:"id"}]},delData:{url:D+"json/delete_collect.htm",param:[{name:"id"}],delStatus:!0},html_temp:"<div class='favboxwrap' id='J_favbox'><div class='favboxframe'><div class='tagtit J_tagtit'><ul><li id='J_favNumDom' class='active'>我的聚收藏（<span>0</span>）</li><li id='J_surNumDom'>聚有惊喜（<span>0</span>）</li></ul></div><div class='tagcon'><div class='tagconwrap myjufav' id='J_favTagCon' data-spm='dp0'><div class='subnav' id='J_favSubNav'><ul><li class='active'>全部</li><li>开团中</li><li>即将开团</li></ul></div><div class='itemlistwrap' id='J_favItemlistwrap'></div></div><div class='tagconwrap jusurprise' id='J_surTagCon' data-spm='dp1'><div class='subnav' id='J_surSubNav'><ul><li class='active'>全部</li><li>开团中</li><li>即将开团</li></ul></div><div class='surmsg' id='J_surmsg'>亲，您淘宝收藏夹里的宝贝上聚划算啦！</div><div class='itemlistwrap' id='J_surItemlistwrap'></div></div></div></div></div>"},init:function(a,e,n){t.use("jbc/julog",function(t,e){e.track("jufav",20,"favbox.init.click","[v"+a+"]")}),I.getData(0,0,function(l){if(!l||"SUCCESS"!==l.type)return"click"!=n||o.isLogin()?(s.removeClass(y,"justara_on"),s.removeClass(J,"loginin")):(t.use("jbc/julog",function(t,e){e.track("jufav",16,"favbox.init.login","[v"+a+"]")}),o.login(function(){I.getCollectMark(),t.use("jbc/julog",function(t,e){e.track("jufav",16,"favbox.init.loginsuccess","[v"+a+"]")}),s.addClass(J,"loginin"),i(y).fire("click")})),void(e&&e(!1));if(t.use("jbc/julog",function(t,e){e.track("jufav",20,"favbox.init.datasuccess","[v"+a+"]")}),s.html(k,I.config.html_temp),i(r).one("span").text(l.collectcount),l.collectcount&&t.use("jbc/julog",function(t,e){e.track("jufav",20,"favbox.init.havcollect","[v"+a+"]")}),l.favoritecount){t.use("jbc/julog",function(t,e){e.track("jufav",18,"favbox.init.havfavorite","[v"+a+"]")}),i(d).one("span").text(l.favoritecount),i(b).on("click",function(){if(!s.hasClass(this,"active")){var t=i(b).index(this);i(b).removeClass("active"),i(this).addClass("active"),I.getData(1,t,function(t){t&&"SUCCESS"===t.type&&I.showData(t.result,1)}),window.goldlog&&window.goldlog.send("//gm.mmstat.com/jhs.4.3.8?name=tab&type=1&subtype="+t+"&page="+a)}}),i(r).on("click",function(){i(r).hasClass("active")||(i(r).addClass("active"),i(d).removeClass("active"),i(m).fadeIn(.3),i(v).fadeOut(.3),window.goldlog&&window.goldlog.send("//gm.mmstat.com/jhs.4.3.8?name=tab&type=0&page="+a))});var c=!1;i(d).on("click",function(){i(d).hasClass("active")||(i(r).removeClass("active"),i(d).addClass("active"),c||(c=!0,I.getData(1,0,function(t){t&&"SUCCESS"===t.type&&I.showData(t.result,1)})),i(m).fadeOut(.3),i(v).fadeIn(.3),window.goldlog&&window.goldlog.send("//gm.mmstat.com/jhs.4.3.8?name=tab&type=1&page="+a))})}else i(d).hide(),i(r).css("width","100%");I.showData(l.result,0),i(h).on("click",function(){if(!s.hasClass(this,"active")){var t=i(h).index(this);i(h).removeClass("active"),i(this).addClass("active"),I.getData(0,t,function(t){t&&"SUCCESS"===t.type&&I.showData(t.result,0)}),window.goldlog&&window.goldlog.send("//gm.mmstat.com/jhs.4.3.8?name=tab&type=0&subtype="+t+"&page="+a)}}),i(u).delegate("click",w,function(t){if(I.config.delData.delStatus){I.config.delData.delStatus=!1;var a=t.currentTarget,e=i(s.parent(a,_)).attr("data-id");I.delData(e)}}),I.getCollectMark(),e&&e(!0)})},reset:function(){s.empty(k)},showData:function(t,e){t=t||[];var o=I.parseData(t,e);0==e?(i(u).html(o),I.favKscroll=new a(i(f),{prefix:"clear-",hotkey:!0,bodydrag:!1,allowArrow:!0})):(i(p).html(o),I.surKscroll=new a(i(g),{prefix:"clear-",hotkey:!0,bodydrag:!1,allowArrow:!0}))},getData:function(t,a,e){for(var o=arguments,n=I.config.getData.url,i={_input_charset:"utf-8"},s=I.config.getData.param,l=0;l<s.length;l++)i[s[l].name]=s[l].enumval[o[l]];c.jsonp(n,i,function(t){e&&e(t)})},addData:function(a,e,d,p,g,m){function v(){KISSY.juReady(function(t){for(var a=I.config.addData.url,e={_tb_token_:t.tbToken},o=I.config.addData.param,n=0;n<o.length;n++)e[o[n].name]=y[n];c.jsonp(a,e,function(t){"BUSY"==t.type||"ERROR"==t.type?b(t.message):(w(),h()),window.addToCollectionStatus=!0})})}function h(a){if(e&&t.one(e)&&NaN!==parseInt(t.one(e).text())){var o=parseInt(t.one(e).text())+1;t.one(e).text(o)}}function b(t){i(".J_Add_jufav").html(t||"对不起，加入聚收藏失败！"),C.show()}function w(){var a=t.one("#J_justar"),e=t.one(p);if(a&&e){var o=a.offset(),n=e.offset();o.left+=10,o.top+=10,n.left+=g||0,n.top+=m||0;var i=t.one('<i style="background: url(//gtms01.alicdn.com/tps/i1/T1QyRoFsXbXXbv3u_a-21-20.png) no-repeat 0 0;width: 21px;height: 20px;display: inline-block;position: absolute;left: 0;top: 0;z-index:11000"></i>');i.css("left",n.left+"px"),i.css("top",n.top+"px"),i.appendTo("body"),t.Anim(i[0],{top:o.top+"px",opacity:.3},{queue:!1,duration:.6,easing:"backIn"}).run(),t.Anim(i[0],{left:o.left+"px"},{queue:!1,duration:.6,easing:"easeNone",complete:function(){i.remove(),I.heartFlash(),d&&k()}}).run()}}function k(){if(i(j).length&&i(j).one("b")){var t=parseInt(i(j).one("b").text())+1;i(j).one("b").text(t)}i(r).length&&I.getData(0,0,function(t){if(t&&"SUCCESS"===t.type)for(var e=0;e<t.result.length;e++)if(t.result[e].id==a){var o=parseInt(i(r).one("span").text())+1;i(r).one("span").text(o);var n=I.parseData([t.result[e]],2),c=s.create(n,{height:0,opacity:0},document);i(u).all(_).length||s.empty(f),s.prepend(c,f);var d=new l(c,{height:84,opacity:1},.3,"easeNone",function(){I.favKscroll.resize()});d.run()}})}if(a){var y=arguments,J=!0;o.login(function(){J&&(J=!1,I.getCollectMark(),v())})}else w(),h(),window.addToCollectionStatus=!0;var C=new n({title:"<em>提示</em>",content:'<div class="J_Add_jufav"></div>',autoShow:!1,wrapId:"J_coupons_popup_wrap",buttons:[{style:"buttonClass",text:"关闭",func:function(){this.hide()}}]})},delData:function(t){var a=arguments;KISSY.juReady(function(e){for(var o=I.config.delData.url,n={_tb_token_:e.tbToken},d=I.config.delData.param,p=0;p<d.length;p++)n[d[p].name]=a[p];c.jsonp(o,n,function(a){if("SUCCESS"==a.type){var e=i(r).one("span").text();if(i(r).one("span").text(parseInt(e)-1),i(j).length&&i(j).one("b")){var o=parseInt(i(j).one("b").text())-1;i(j).one("b").text(o)}i(u).all(_).each(function(a,e){if(a.attr("data-id")==t){var o=new l(a,{height:0,opacity:0},.3,"easeNone",function(){s.remove(a),I.favKscroll.resize(),i(u).all(_).length||i(u).html("<div class='itemlist' id='J_favItemList'><div class='nodata'>亲，你是啥都看不上呢还是啥也没看？里面好空哦...</div></div>")});o.run(),setTimeout(function(){I.config.delData.delStatus=!0},300)}})}else I.config.delData.delStatus=!0})})},parseData:function(a,e){var o="";if(0==e&&(o="<div class='itemlist' id='J_favItemList'>"),1==e&&(o="<div class='itemlist' id='J_surItemList'>"),t.unique(a),a&&a.length)for(var n=0;n<a.length;n++)a[n].id||(a.splice(n,1),n--);if(a&&a.length){for(var n=0;n<a.length;n++){var s=parseInt(a[n].onlineStartTime)>(new Date).getTime()?!0:!1,l=a[n].id,c=x+"home.htm?id="+l,r=S+a[n].picUrlNew+"_100x100.jpg",d=a[n].shortName,u=(I.addtitdot(t.trim(d)),s?"green":"red"),p=a[n].isTmallPointExchange,f=p&&parseInt(a[n].tmallPoint),g=a[n].activityPriceText?a[n].activityPriceText:parseInt(a[n].activityPrice)/100,m=parseInt(a[n].originalPrice)/100,v=a[n].soldCount?a[n].soldCount+"件已售":"团购进行中",h=a[n].isLock;0!=h||s||(u="gray",v="卖光了");var b=new Date(parseInt(a[n].onlineStartTime)).formatAs("MM月DD日 hh:mm开团",!0);o+="<div class='item J_item' data-id='"+l+"'>",o+="<div class='itemframe'>",o+="<div class='pic'>",o+="<a target='_blank' href='"+c+"' title='"+d+"'><img src='"+r+"' width='66' height='66'></a>",o+="</div>",o+="<div class='iteminfo'>",o+="<div class='title'><a target='_blank' href='"+c+"' title='"+d+"'>"+d+"</a></div>",o+="<div class='price'>",o+=p?"<span class='"+u+" point'> <strong>"+f+"</strong><em> 天猫积分</em></span>":"<span class='"+u+"'>&yen;<strong>"+g+"</strong></span>",o+=" &yen;<span class='del'>"+m+"</span>",o+="</div>",o+=s?"<div>"+b+"</div>":0==h?"<div class='saleinfo'>"+v+"</div>":"<div class='saleinfo'><span>"+v+"</span><a target='_blank' href='"+c+"' class='btn-msq'>马上抢</a></div>",o+="</div>",o+="</div>",(0==e||2==e)&&(o+="<i class='icon-del J_icondel'></i>"),o+="</div>"}1==e&&i(C).show()}else 0==e&&(o+="<div class='nodata'>亲，你是啥都看不上呢还是啥也没看？里面好空哦...</div>"),1==e&&i(C).hide();return 2!==e&&(o+="</div>"),o},addtitdot:function(t){for(var a=0,e=0;e<t.length;e++){a+=t.charCodeAt(e)<=128?.5:1;{if(!(Math.round(a)<=10))return t.substr(0,e)+"...";if(e==t.length-1)return t}}},heartFlash:function(){var t=KISSY.all("#heart");t.show();var a=t.width(),e=t.height(),o=t.css("top"),n=t.css("left"),i=new l("#heart",{height:2*e,width:2*a,top:parseInt(o)-.5*e,left:parseInt(n)-.5*a,opacity:0},.3,"easeOut",function(){t.hide(),t.css({width:a,height:e,top:o,left:n,opacity:1})});i.run()},getCollectMark:function(t){c.jsonp(T,{},function(a,e){"success"==e&&a&&i(j).length&&(a.totalCount||0==a.totalCount)&&i(j).html("<b>"+a.totalCount+"</b> 件"),t&&t()})}};return I},{requires:["gallery/kscroll/1.2/index","gallery/RichDate/1.0/index","jbc/julogin","jbc/jupopup","core"]}),KISSY.add("jbc/jufav/1.0.38/mods/jutools",function(t,a,e){var o=function(){var o=t.DOM,n=t.Event,i=t.Cookie,s=t.Anim,l=null!=navigator.userAgent.match(/iPad/i),c=!1,r=i.get("codefold_time")||"",d=null,u=t.all('[name="spm-id"]').attr("content");this.init=function(){function a(a){var e='<div class="ju-rbar">';return e+='<ul class="ju-groupbar" data-spm="800700">',e+='<li class="backtop J_BackToTop"><a>&#xe61d;</a></li>',t.one("#downQrcoder")&&t.one("#downQrcoder").val()&&(e+='<li class="feedback downapp J_downAppEnter"><a href="javascript:;"><span>&#xe651;</span>App<img src="'+t.one("#downQrcoder").val()+'" class="img J_downAppQrcode"></span></a></li>'),a&&(e+='<li class="feedback"><a class="J_feedback" href="'+a+'" title="给聚划算提意见" target="_blank"><span>&#xe606;</span>反馈</a></li>'),e+="</ul>",e+='<div class="jufav" id="J_jufav"><a class="ju-rbara" id="J_justar" href="#"><span class="cnt" id="J_jufavcnt"><span>我的聚收藏 <em></em></span><sub></sub><sup></sup></span><i class="tip-ur"></i></a><div class="favboxparent" id="J_favboxparent"></div><img class="heart" id="heart" src="//gtms01.alicdn.com/tps/i1/T1A30CFvXbXXbhgrfd-29-26.png"></div>',e+="</div>"}var e=this;e.config={interval:200,threshold:500};var o="https://feedback.taobao.com/pc/feedbacks?productId=155&source=pc-satisfaction";/^http(s)?:.*$/.test(t.all("#J_Feedback").val())?(o=t.all("#J_Feedback").val(),e.temp_trig=a(o)):"608.7065813"==u?(o="https://feedback.taobao.com/pc/feedbacks?productId=155&source=pc-detail",e.temp_trig=a(o)):"608.5847453"==u||"608.5847457"==u?(o="https://feedback.taobao.com/pc/feedbacks?productId=155&source=pc-pinpaituan",e.temp_trig=a(o)):"608.7763366"==u?(o="https://feedback.taobao.com/pc/feedbacks?productId=155&source=pc-jumingpin",e.temp_trig=a(o)):l?e.temp_trig='<a class="pad-backtotop J_BackToTop"></a>':e.temp_trig=a(o),e.trigger=null,e.timer=null,e._render()},this._checkToShow=function(){var a=o.scrollTop(document),e=t.one(".J_BackToTop");a<this.config.threshold?e&&e.animate({opacity:0},.2):e&&e.animate({opacity:1},.2)},this._foldQrcode=function(){if(d&&d.hasClass("downapp-show")){var a="";if(location.hostname.indexOf("ju.daily.taobao.net")>-1?a="ju.daily.taobao.net":location.hostname.indexOf("ju.taobao.com")>-1&&(a="ju.taobao.com"),d.removeClass("downapp-show"),!c){var e=r.split("|");e[0]=t.now(),c=!0,i.set("codefold_time",e.join("|"),"",a,"/","")}}},this._rendTrigger=function(){var a=this;this.trigger=o.create(this.temp_trig),o.append(this.trigger,document.body),t.juReady(function(a){var e=a.time||t.now();if(d=t.one(".J_downAppEnter"),r&&r.split("|")[0]){var o=parseInt(r.split("|")[0],10);864e5>=e-o&&new Date(e).getDate()==new Date(o).getDate()&&(c=!0)}c||!d||t.one("#juapp-foot")||d.addClass("downapp-show")}),e.getCollectMark(),t.one(a.trigger).fadeIn(.8)},this._getRightDis=function(){var t=o.width(document.body);return t>=1100?parseInt((t-990)/2-66,10):0},this._bindEvent=function(){function i(t,a){h||(h=!0,o.addClass(m,"loginin"),o.addClass(f,"justara_on"),e&&e.init(c.page,function(t){if(t){var e=new s("#J_jufavcnt",{width:187},.15,"easeNone",function(){var t=new s("#J_favboxparent",{height:555,opacity:1},.3,"easeNone",function(){v=!0,h=!1});t.run(),a&&a()});e.run()}else h=!1},t.type))}function l(){if(v){var t=new s("#J_favboxparent",{height:0,opacity:0},.3,"easeNone",function(){v=!1;var t=new s("#J_jufavcnt",{width:117},.15,"easeNone",function(){});t.run(),e.reset(),o.removeClass(f,"justara_on")});t.run()}}var c=this,r=o.get(".J_BackToTop"),p=t.UA.webkit?document.body:document.documentElement;d&&(n.on(d,"mouseenter",function(t){d.addClass("downapp-show"),window.goldlog&&window.goldlog.send("//gm.mmstat.com/jhs."+u+".rtcode.unfold?spm-cnt="+u+".0.0&logtype=2&cache="+Math.random()+"autosend=1")}),n.on(".J_feedback,.J_BackToTop","mouseenter",function(t){c._foldQrcode()}),n.on(o.get("body"),"click",function(a){t.one(a.target).hasClass("J_downAppQrcode")||c._foldQrcode()})),n.on(r,"click",function(a){a.halt();var e=t.UA.ie;e?window.scrollTo(0,0):t.all(window).animate({scrollTop:0},.2,"easeOut",function(){}),p.scrollTop=0});var f=o.get("#J_justar");if(f){var g,m="#J_justar i",v=!1,h=!1;n.on(f,"mouseenter",function(t){v||(a.isLogin()?(o.addClass(m,"loginin"),g=setTimeout(function(){v||i(t,function(){window.goldlog&&window.goldlog.send("//gm.mmstat.com/jhs.4.3.8?name=icon&page="+c.page)})},350)):(g=setTimeout(function(){v||o.addClass(f,"justara_on")},350),o.removeClass(m,"loginin")))}),n.on(f,"mouseleave",function(t){v||(clearTimeout(g),o.removeClass(f,"justara_on"))}),n.on(f,"click",function(t){if(t.preventDefault(),a.isLogin()){if(v)return;i(t,function(){window.goldlog&&window.goldlog.send("//gm.mmstat.com/jhs.4.3.8?name=icon&page="+c.page)})}else{if(o.removeClass(m,"loginin"),v)return;a.login(function(){e.getCollectMark(),i(t,function(){window.goldlog&&window.goldlog.send("//gm.mmstat.com/jhs.4.3.8?name=login&type=1&page="+c.page)})}),window.goldlog&&window.goldlog.send("//gm.mmstat.com/jhs.4.3.8?name=login&type=0&page="+c.page),window.goldlog&&window.goldlog.send("//gm.mmstat.com/jhs.4.3.8?name=icon&page="+c.page)}}),n.on(document,"click",function(a){a.stopPropagation(),t.all(a.target).parent("#J_favboxparent")||l()})}},this._render=function(){var t=this;this.trigger||this._rendTrigger(),this._bindEvent(),n.on(window,"scroll",function(a){t.timer||(t._checkToShow(),t.timer=setTimeout(function(){clearTimeout(t.timer),t.timer=null},t.config.interval))}),t._checkToShow()},this.addData=function(){e.addData.apply(null,arguments)}};return new o},{requires:["jbc/julogin","./../mods/favbox","core"]}),KISSY.config("modules",{"jbc/index":{requires:["./mods/jutools","./jufav.css","core"]},"jbc/mods/favbox":{requires:["gallery/kscroll/1.2/index","gallery/RichDate/1.0/index","jbc/julogin","jbc/jupopup","core"]},"jbc/mods/jutools":{requires:["jbc/julogin","./../mods/favbox","core"]}});