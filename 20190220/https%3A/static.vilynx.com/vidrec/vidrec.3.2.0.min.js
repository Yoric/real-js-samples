!function(){function e(t,o,i){function r(a,l){if(!o[a]){if(!t[a]){var s="function"==typeof require&&require;if(!l&&s)return s(a,!0);if(n)return n(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=o[a]={exports:{}};t[a][0].call(c.exports,function(e){return r(t[a][1][e]||e)},c,c.exports,e,t,o,i)}return o[a].exports}for(var n="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}return e}()({1:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var i={userid:!1,publickey:!1,feedhash:"",debug:!1,onpluginload:"",currenturl:"",limit:5,overrideurl:!1,onlyrelated:!1,retrieveguid:!1,maxdays:2,urlsplitchar:!1,urlfilterregex:!1,domain:"",cf:!1,disablecf:!1,cfwo:!1,confighash:!1,temprules:!1,idattribute:!1,type:["video"],returnmetadata:!1,minelemwidth:200,minelemheight:180,minelemspacing:5,excludeRelated:!1,excludeTrending:!1,excludeMostViewed:!1,userProfileMaxSize:100,userProfileMaxRecommendations:3,viewedMaxSize:300,userprofilettl:2,disablestorage:!1,maxapitrend:40,maxapiviews:40,percentedomairecommend:.6,domainpercentage:!1,sharedls:!1,iframed:!1,preloadoffset:300,displayallscores:!1};o.default=i},{}],2:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var i={serverurl:"https://www.vilynx.com",cndUrl:"https://static.vilynx.com/vidrec",publicUrl:"https://public.vilynx.com",version:"3.2.0",maxRetries:2,retryTime:1e3,cleanUrlRegex:/(^\w+:|^)\/\//};o.default=i},{}],3:[function(require,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),_globalConfig=require("./config/globalConfig"),_globalConfig2=_interopRequireDefault(_globalConfig),_privateConfig=require("./config/privateConfig"),_privateConfig2=_interopRequireDefault(_privateConfig),_computator=require("./modules/computator"),_computator2=_interopRequireDefault(_computator),_messenger=require("./modules/helpers/comm/internal/messenger"),_messenger2=_interopRequireDefault(_messenger),_recommendationsFinder=require("./modules/helpers/dom/recommendationsFinder"),_localStorage=require("./modules/helpers/storage/localStorage"),_localStorageUpdater=require("./modules/helpers/storage/localStorageUpdater"),_sessionStorage=require("./modules/helpers/storage/sessionStorage"),_logger=require("./modules/helpers/utils/logger"),_vidhtml=require("./modules/vidhtml"),_vidhtml2=_interopRequireDefault(_vidhtml);require("./polyfills/classList"),require("./polyfills/customEvent"),require("./polyfills/mutationObserver"),require("./polyfills/path"),require("./modules/helpers/dom/scrollMonitor");var Recommendator=function(){function Recommendator(){var _this=this;if(_classCallCheck(this,Recommendator),this.loadGlobalConfig()){_logger.logger.log("this log does nothing, nothing de nothing"),_globalConfig2.default.debug||(_globalConfig2.default.debug=_localStorage.ls.get("vilynx_results")||!1);var vxClicked=_sessionStorage.ss.get("vx_clicked")||!1;if(vxClicked&&_recommendationsFinder.recommendationFinder.sendClickEvent(vxClicked,!0),_localStorageUpdater.localStorageUpdater.validateLocalStorage(),this.computador=new _computator2.default,this.cnfgBackup={},"function"!=typeof eval(_globalConfig2.default.onpluginload)&&!_globalConfig2.default.iframed)throw"onpluginload param function expeted. \n                Got ["+_typeof(eval(_globalConfig2.default.onpluginload))+"] "+_globalConfig2.default.onpluginload;if(""===_globalConfig2.default.domain){var hostname=location.hostname.split(".");_globalConfig2.default.domain=hostname[hostname.length-2]||""}_globalConfig2.default.disablestorage&&(_logger.logger.warn("Storage is disabled, you have been warned."),_localStorage.ls.disableLocalStorage(),_sessionStorage.ss.disableSessionStorage(),_globalConfig2.default.sharedls=!1),_globalConfig2.default.sharedls?(this.createIframe(),document.addEventListener("messenger",function(e){try{e.detail.message}catch(e){return!1}var message=e.detail.message;if("iframe loaded"===message)_this.iframeLoaded=!0,_this.messenger.sendPost({action:"getViewedVideos"});else if("videoViews"===message.content){var viewedVids=_localStorage.ls.get("vx_viewed")||[];message.views.forEach(function(e){viewedVids.forEach(function(t){e!==t&&(message.views.push(t),_this.messenger.sendPost({action:"saveNewVideoView",url:t}))})}),_localStorage.ls.set("vx_viewed",message.views),_localStorage.ls.set("vx_recommended",message.recommended),eval(_globalConfig2.default.onpluginload)(),_logger.logger.info("Vilynx Recommendator initialized successful for domain "+_globalConfig2.default.domain+".")}})):setTimeout(function(){eval(_globalConfig2.default.onpluginload)()},5)}else _logger.logger.error("FUBAR: Can't load config. Aborting")}return _createClass(Recommendator,[{key:"get",value:function(e,t,o){_globalConfig2.default.excludeRelated=!1,_globalConfig2.default.excludeTrending=!1,_globalConfig2.default.excludeMostViewed=!1,this.restoreConfig(),o&&this.loadTempConfig(o);var i=_localStorage.ls.get("vx_viewed")||[],r=_localStorage.ls.get("vx_computed")||{},n=_localStorage.ls.get("vx_parentVideos")||{},a=_sessionStorage.ss.get("vx_lastBatchRecommended")||[],l=_localStorage.ls.get("vx_recommended")||{},s=void 0,u=[],c=[],d={};if(_globalConfig2.default.disablecf?(_logger.logger.info('Collaborative filter is disable due "disablecf"'),_globalConfig2.default.cf=!1):0===i.length?(_logger.logger.info("Activating Collaborative Filter"),_globalConfig2.default.cf=!0):_globalConfig2.default.cf&&(_logger.logger.info("Deactivating Collaborative Filter"),_recommendationsFinder.recommendationFinder.destructor(),_globalConfig2.default.cf=!1),0===e.indexOf("//")&&(e=e.replace("//","")),_logger.logger.log("Getting recommendations for: "+e),_globalConfig2.default.currenturl=e,s=e.replace(_privateConfig2.default.cleanUrlRegex,""),_globalConfig2.default.urlsplitchar){var f=s.split(_globalConfig2.default.urlsplitchar);s=f[f.length-1]}if(-1!==a.indexOf(s)&&a.forEach(function(e){l[e]&&(l[e][0]=1)}),_sessionStorage.ss.remove("vx_lastBatchRecommended"),_globalConfig2.default.sharedls&&this.messenger&&this.messenger.sendPost({action:"saveNewVideoView",url:s}),r[s]&&(_logger.logger.log("Removing "+s+" from user profile."),delete r[s]),-1===i.indexOf(s)&&s.length>0){if(i.push(s),Object.keys(i).length>_globalConfig2.default.viewedMaxSize){var g=Object.keys(i).length-_globalConfig2.default.viewedMaxSize;i.splice(0,g)}_localStorage.ls.set("vx_viewed",i)}return Object.keys(n).forEach(function(e){var t=new Date,o=n[e][1];Math.abs(t-o)/36e5>_globalConfig2.default.userprofilettl&&(_logger.logger.log("ParentVideos: Parent video "+n[e][0]+" has timed out."),n[e][1]=(new Date).getTime(),u.push(e),c.push(n[e][0]),d[n[e][0]]=e)}),Object.keys(r).forEach(function(e){u.indexOf(r[e][2])>-1&&(_logger.logger.info("ParentVideos: Removing "+e+" from user profile for relation with "+n[r[e][2]][0]),delete r[e])}),_localStorage.ls.set("vx_computed",r),_localStorage.ls.set("vx_recommended",l),_localStorage.ls.set("vx_parentVideos",n),this.computador.getDataFromRemote(c,d,t)}},{key:"getTrending",value:function(e,t){_globalConfig2.default.excludeRelated=!0,_globalConfig2.default.excludeTrending=!1,_globalConfig2.default.excludeMostViewed=!0,this.restoreConfig(),t&&this.loadTempConfig(t);var o=_localStorage.ls.get("vx_videosScored")||{};return _globalConfig2.default.debug||(_globalConfig2.default.debug=_localStorage.ls.get("vilynx_results")||!1),_logger.logger.log("Getting trending."),_globalConfig2.default.currenturl="",_localStorage.ls.remove("vx_videosScored"),_localStorage.ls.remove("vx_videos"),this.computador.getDataFromRemote(o,e)}},{key:"getMostViewed",value:function(e,t){_globalConfig2.default.excludeRelated=!0,_globalConfig2.default.excludeTrending=!0,_globalConfig2.default.excludeMostViewed=!1;var o=_localStorage.ls.get("vx_videosScored")||{};return this.restoreConfig(),t&&this.loadTempConfig(t),_globalConfig2.default.debug||(_globalConfig2.default.debug=_localStorage.ls.get("vilynx_results")||!1),_logger.logger.log("Getting trending."),_globalConfig2.default.currenturl="",_localStorage.ls.remove("vx_videosScored"),_localStorage.ls.remove("vx_videos"),this.computador.getDataFromRemote(o,e)}},{key:"getTrendingAndMostViewed",value:function(e,t){_globalConfig2.default.excludeRelated=!0,_globalConfig2.default.excludeTrending=!1,_globalConfig2.default.excludeMostViewed=!1;var o=_localStorage.ls.get("vx_videosScored")||{};return this.restoreConfig(),t&&this.loadTempConfig(t),_globalConfig2.default.debug||(_globalConfig2.default.debug=_localStorage.ls.get("vilynx_results")||!1),_logger.logger.log("Getting trending."),_globalConfig2.default.currenturl="",_localStorage.ls.remove("vx_videosScored"),_localStorage.ls.remove("vx_videos"),this.computador.getDataFromRemote(o,e)}},{key:"insert",value:function(e,t,o){var i=this;o?o.videoinfo=!0:o={videoinfo:!0},this.get(e,function(e,o,r){i.vidHTML=new _vidhtml2.default(t),i.vidHTML.insertRecommendations(e,r)},o)}},{key:"loadGlobalConfig",value:function(){var e=document.querySelector('script[src*="vilynx.com/vidrec/vidrec"], script[data-vidrec-local]');return e?(Object.keys(e.attributes).forEach(function(t){var o=e.attributes[t];if("data-"===o.name.substr(0,5)){var i=o.name.replace("data-","");void 0===_globalConfig2.default[i]?_logger.logger.warn("Config register not found: "+o.name):(_globalConfig2.default[i]=o.value,_logger.logger.debug("Config element loaded: "+o.name))}}),_globalConfig2.default.userid||_globalConfig2.default.publickey?(_globalConfig2.default.publickey&&(_globalConfig2.default.userid=_globalConfig2.default.publickey),_globalConfig2.default.domainpercentage&&(_globalConfig2.default.percentedomairecommend=_globalConfig2.default.domainpercentage),_logger.logger.info("Config loaded"),_globalConfig2.default.loaded=!0,!0):(_logger.logger.error("FUBAR: Can't find userid. Aborting"),!1)):(_logger.logger.warn("Vilynx Script not detected"),!1)}},{key:"loadTempConfig",value:function(e){var t=this;return this.cnfgBackup={},e?(_logger.logger.info("Loading options object"),Object.keys(e).forEach(function(o){void 0===_globalConfig2.default[o]?_logger.logger.warn("Config register not found: "+o):(t.cnfgBackup[o]=_globalConfig2.default[o],_globalConfig2.default[o]=e[o],_logger.logger.debug("Config element loaded: "+o))}),_typeof(_globalConfig2.default.type)!==Array&&_logger.logger.warn('"type" must be a array with the types of contents to recommend'),_globalConfig2.default.domainpercentage&&(_globalConfig2.default.percentedomairecommend=_globalConfig2.default.domainpercentage),_logger.logger.info("Config loaded"),!0):(_logger.logger.warn("No options to load"),!1)}},{key:"restoreConfig",value:function(){var e=this;Object.keys(this.cnfgBackup).forEach(function(t){void 0===_globalConfig2.default[t]?_logger.logger.warn("Config register not found: "+t):(_globalConfig2.default[t]=e.cnfgBackup[t],_logger.logger.debug("Config element restored: "+t))}),this.cnfgBackup={}}},{key:"createIframe",value:function(){var e=this,t="",o=document.createElement("iframe"),i=_privateConfig2.default.version;return t="dev"===i?_privateConfig2.default.cndUrl+"/shvivi.html":_privateConfig2.default.cndUrl+"/shvivi."+i+".html",o.setAttribute("height","0px"),o.setAttribute("width","0px"),o.setAttribute("width","0px"),o.style.display="none",o.setAttribute("name","vilynxVrSup"),o.src=t,o.id="vilynxVrSup",o.onload=function(){e.messenger=new _messenger2.default("top");var t="";t="dev"===i?"shvivi.js":"shvivi."+i+".min.js",e.messenger.sendPost({vidrecInit:!0,vidrecSrc:t,config:_globalConfig2.default})},document.body.appendChild(o),!0}}]),Recommendator}();window.vilynxRecommendations=new Recommendator},{"./config/globalConfig":1,"./config/privateConfig":2,"./modules/computator":4,"./modules/helpers/comm/internal/messenger":8,"./modules/helpers/dom/recommendationsFinder":9,"./modules/helpers/dom/scrollMonitor":10,"./modules/helpers/storage/localStorage":11,"./modules/helpers/storage/localStorageUpdater":12,"./modules/helpers/storage/sessionStorage":13,"./modules/helpers/utils/logger":14,"./modules/vidhtml":15,"./polyfills/classList":16,"./polyfills/customEvent":17,"./polyfills/mutationObserver":18,"./polyfills/path":19}],4:[function(e,t,o){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),a=e("../config/globalConfig"),l=i(a),s=e("../config/privateConfig"),u=i(s),c=e("./helpers/comm/external/emergencyService"),d=i(c),f=e("./helpers/comm/external/xhr"),g=i(f),h=e("./helpers/comm/internal/messenger"),m=i(h),v=e("./helpers/dom/recommendationsFinder"),p=e("./helpers/storage/localStorage"),b=e("./helpers/storage/sessionStorage"),y=e("./helpers/utils/logger"),w=function(){function e(){r(this,e),this.xhr=new g.default,this.emeregency=new d.default,this.config={},this.r={},this.computed={},this.userProfile={},this.computedFinal={},this.debugReturn={},this.domainExclusiveVideos=0,this.domainExclusiveTrends=0,this.domainExclusiveViews=0}return n(e,[{key:"getDataFromRemote",value:function(e,t,o){var i=this,r=void 0,n=u.default.serverurl+"/api2.0/recommendations/raw",a=void 0;e.length>0?e.unshift(l.default.currenturl):e=[l.default.currenturl],e=JSON.stringify(e),l.default.confighash?(r={user_hash:l.default.userid,id:e},n+="/"+l.default.confighash,"preview"===l.default.confighash&&(r.rules_values_pcs=l.default.temprules)):r={video_url:e,userhash:l.default.userid,feedhash:l.default.feedhash,max_days:l.default.maxdays,only_related:l.default.onlyrelated,url_filter_regex:l.default.urlfilterregex,contentTypes:JSON.stringify(l.default.type)},r.trends_limit=l.default.maxapitrend,r.views_limit=l.default.maxapiviews,r.return_guid=l.default.retrieveguid,r.cf=l.default.cf,r.get_video_info=l.default.returnmetadata,l.default.cf&&(r.cf=!0,r.originUrl=document.location.host+(document.location.pathname||"")),a=p.ls.get("vx_config")||{},a.guid!==l.default.retrieveguid&&(a.guid=l.default.retrieveguid,y.logger.warn("ExtIds mismatch, updating config, removing user profile"),p.ls.set("vx_computed",{}),p.ls.set("vx_urlInfo",{}),p.ls.set("vx_recommended",{}),p.ls.set("vx_config",a)),this.xhr.get(n,r,function(r){i.doLoop(r,e,t,o)},function(){l.default.confighash||(y.logger.warn("API call fallback, using emergency service."),i.emeregency.getCdnJson(function(r){i.doLoop(r,e,t,o)}))})}},{key:"doLoop",value:function(e,t,o,i){var r=this,n=[],a={},s=p.ls.get("vx_viewed")||[],c={},d=p.ls.get("vx_recommended")||{},f=l.default.currenturl.trim().replace(u.default.cleanUrlRegex,""),g=void 0,h="vx_computed",w=void 0,_=void 0,x=void 0,S=void 0,C=e.campaigns,k=[],E=[];if(l.default.confighash&&(h+="_"+l.default.confighash),this.userProfile=p.ls.get(h)||{},this.parentVideos=p.ls.get("vx_parentVideos")||{},e.video_info&&Object.keys(e.video_info).forEach(function(t){var o=t;if(l.default.urlsplitchar){var i=t.split(l.default.urlsplitchar);o=i[i.length-1]}a[o]=e.video_info[t]}),w=p.ls.get("vx_urlInfo")||{},Object.keys(w).forEach(function(e){a[e]=w[e]}),this.urlInfo=a,Object.keys(d).forEach(function(e){c[e]=1===d[e][0]||!1,d[e]=d[e][1]}),t=JSON.parse(t),this.userProfileVideoInfo={},this.config={},this.userProfileTimes={},this.userProfileParentVideo={},this.computed={},this.r=e,this.computedFinal={},this.debugReturn={},this.config.alpha=e.config.alpha,this.config.beta=e.config.beta,this.config.gamma=e.config.gamma,this.config.delta=e.config.delta,this.calculatePromotions(),this.unzipUserProfile(),s.forEach(function(e){d[e]&&delete d[e]}),l.default.excludeRelated||Object.keys(this.r.rel).forEach(function(e){r.r.rel[e].reqVid===f?(r.computed[e]=r.config.alpha*r.r.rel[e].rScore,l.default.debug&&(r.debugReturn[e]={user_profile_score:r.userProfile[e],rScore:r.r.rel[e].rScore,tScore:r.r.rel[e].tScore,most_viewed:r.r.rel[e].most_viewed})):t.indexOf(r.r.rel[e].reqVid)>0&&(y.logger.log("ParentVideos: Related coming from a old parent video "),1==o[r.r.rel[e].reqVid]?(y.logger.info("ParentVideos:  Using this.config.gamma^2 for "+e),r.computed[e]=Math.pow(r.config.gamma,2)*r.r.rel[e].rScore):2==o[r.r.rel[e].reqVid]?(y.logger.info("ParentVideos:  Using this.config.gamma^3 for "+e),r.computed[e]=Math.pow(r.config.gamma,3)*r.r.rel[e].rScore):y.logger.warn("Something went wrong")),r.computedFinal[e]=r.computed[e]+r.config.beta*r.r.rel[e].tScore,r.computedFinal[e]+=r.config.delta*r.r.rel[e].vScore,l.default.onlyrelated||(r.r.trend&&r.r.trend[e]&&delete r.r.trend[e],r.r.most_viewed&&r.r.most_viewed[e]&&delete r.r.most_viewed[e])}),this.loopUserProfile(),l.default.onlyrelated||(e.trend&&!l.default.excludeTrending&&this.loopTrending(),e.most_viewed&&!l.default.excludeMostViewed&&this.loopMost_viewed()),Object.keys(this.computedFinal).forEach(function(e){var t=e.split(l.default.urlsplitchar);if(t=t[t.length-1],d[t]&&d[t]>0&&d[t]<4){var o=.75;c[t]&&(o=.25),r.computedFinal[e]*=Math.pow(o,d[t]),y.logger.info("Decreased score for "+e+" *("+o+"^"+d[t]+")  ")}}),l.default.cf&&this.r.cf&&(l.default.cfwo?y.logger.log("CF is in WO mode, ignoring input data"):Object.keys(this.computedFinal).forEach(function(e){r.computedFinal[e]*=r.r.cf[e]})),n=Object.keys(this.computedFinal).sort(function(e,t){return r.computedFinal[t]-r.computedFinal[e]}),s.forEach(function(t){var o=t.trim().replace(u.default.cleanUrlRegex,"");if(l.default.urlsplitchar){var i=o.split(l.default.urlsplitchar);o=i[i.length-1]}for(var a=0;a<n.length;a++)o&&n[a].indexOf(o)>-1&&n.length>l.default.limit&&(y.logger.info("Removing "+n[a]+" from url. Reason: Matching with "+o),n.splice(a,1),E.push(o));Object.keys(e.rel).forEach(function(e){""!==o&&e.indexOf(o)>-1&&-1!==E.indexOf(o)&&(delete r.computed[e],y.logger.log("Removing "+e+" from user profile, matching with "+o))})}),E.forEach(function(e){var t=s.indexOf(e);s.push(s.splice(t,1)[0])}),p.ls.set("vx_viewed",s),_={},Object.keys(d).forEach(function(e){for(var t=0;t<n.length;t++)""!==e&&n[t].indexOf(e)>-1&&d[e]>=l.default.userProfileMaxRecommendations&&(_[e]=d[e])}),n.length-Object.keys(_).length<l.default.limit){var O=void 0;y.logger.warn("To many urls to remove, restoring old recommended urls. Restoring "+l.default.limit+" videos"),O=Object.keys(_).sort(function(e,t){return _[t]-_[e]}),O=O.splice(0,l.default.limit),O.forEach(function(e){d[e]=0})}if(Object.keys(d).forEach(function(e){for(var t=0;t<n.length;t++)""!==e&&n[t].indexOf(e)>-1&&d[e]>=l.default.userProfileMaxRecommendations&&(y.logger.info("Removing "+n[t]+" from url. Reason: Matching with "+e+" and already recommended "+l.default.userProfileMaxRecommendations+" times"),n.splice(t,1),d[e]+=1)}),this.limitUserProfile(),this.domainExclusiveVideos>0&&(n=this.promote(n)),n=n.slice(0,l.default.limit),n.forEach(function(e){var t=e.trim().replace(u.default.cleanUrlRegex,"");if(l.default.urlsplitchar){var o=t.split(l.default.urlsplitchar);t=o[o.length-1]}d[t]?d[t]+=1:d[t]=1}),Object.keys(d).length>l.default.viewedMaxSize){var V=void 0,M=void 0,T=Object.keys(d).length-l.default.viewedMaxSize;M=Object.keys(d).sort(function(e,t){return r.computed[t]-r.computed[e]}),V=M.splice(0,T-1),V.forEach(function(e){y.logger.debug("Removing "+e+" from all recommended, score too high"),delete d[e]})}if(l.default.currenturl.replace(u.default.cleanUrlRegex,"").length>0&&this.adminAndSaveTtl(d),Object.keys(d).forEach(function(e){var t=1;t=void 0!==c[e]&&c[e]?1:0,d[e]=[t,d[e]]}),p.ls.set("vx_recommended",d),x=[],x=Object.keys(this.computed).map(function(e){var t=e.split(l.default.urlsplitchar);return t[t.length-1]}),x=x.concat(n.map(function(e){var t=e.split(l.default.urlsplitchar);return t[t.length-1]})),Object.keys(a).forEach(function(e){-1===x.indexOf(e)&&(y.logger.debug("Removing "+e+" from vx_urlInfo, not present on computed anymore"),delete a[e])}),p.ls.set("vx_urlInfo",a),this.zipUserProfile(n),p.ls.set(h,this.computed),l.default.debug&&p.ls.set("vx_last_returned",{date:new Date,returned:n,debug:this.debugReturn}),l.default.sharedls){new m.default("top").sendPost({action:"saveAllRecommended",recommended:d})}if(S=n,l.default.urlsplitchar&&(S=[],n.forEach(function(e){var t=e.split(l.default.urlsplitchar);e=t[t.length-1],S.push(e)})),b.ss.set("vx_lastBatchRecommended",S),l.default.cf&&v.recommendationFinder.addUrlsToObserve(S),C&&Object.keys(C).forEach(function(e){var t=C[e].audience_pct;if(Math.floor(100*Math.random())+1<=t){var o=void 0;if(Object.keys(C[e].elements).some(function(t){var i=C[e].elements[t].guid;return-1===s.indexOf(i)&&(o=l.default.returnmetadata?C[e].elements[t]:t,!0)}),!o){var i=Object.keys(C[e].elements).length,r=Math.floor(Math.random()*i),n=Object.keys(C[e].elements)[r];o=l.default.returnmetadata?C[e].elements[n]:n}o&&k.push(o)}}),g=n,l.default.returnmetadata){var P=[],I=0;n.forEach(function(t){var o=t.split(l.default.urlsplitchar),i=void 0;o=o[o.length-1],i=a[o].url,l.default.retrieveguid||l.default.urlsplitchar||(i=o),a[o]&&a[o].title?(P.push({type:a[o].type,hash:a[o].hash,url:i,guid:a[o].guid,thumbnail:a[o].thumbnail_url,title:a[o].title,duration:a[o].duration,score:r.computedFinal[t]||0}),l.default.displayallscores&&(e.rel[o]?P[I].scores={trend_score:e.rel[o].tScore,related_score:e.rel[o].rScore,user_profile_score:r.userProfile[o]||0,view_score:e.rel[o].vScore||0}:P[I].scores={trend_score:e.trend[o]||0,related_score:0,user_profile_score:r.userProfile[o]||0,view_score:e.most_viewed[o]||0})):y.logger.warn("Missing "+t+' on "vx_urlInfo". Result will not be returned.'),I+=1}),k.forEach(function(e){e.score=0,P.unshift(e)}),g=P.splice(0,l.default.limit)}else k.forEach(function(e){g.unshift(e)});return i(g,this.debugReturn,e.video_info)}},{key:"unzipUserProfile",value:function(){var e=this;Object.keys(this.userProfile).forEach(function(t){var o=t.split(l.default.urlsplitchar);o=o[o.length-1],void 0===e.urlInfo[o]?y.logger.warn(t+" Missing on urlInfo. Excluding."):l.default.confighash||-1!==l.default.type.indexOf(e.urlInfo[o].type)?(e.userProfileTimes[t]=e.userProfile[t][1],e.userProfileParentVideo[t]=e.userProfile[t][2],e.userProfile[t]=e.userProfile[t][0]):y.logger.warn("Excluding "+t+" from user profile. Element type not the one we want")})}},{key:"zipUserProfile",value:function(e){var t=this;Object.keys(this.computed).forEach(function(o){if(t.userProfileTimes[o]?t.computed[o]=[t.computed[o],t.userProfileTimes[o]]:t.computed[o]=[t.computed[o],0],-1!==e.indexOf(o)&&(t.computed[o][1]+=1),t.r.rel[o]){var i=0;Object.keys(t.parentVideos).forEach(function(e){t.parentVideos[e]&&t.parentVideos[e][0]===t.r.rel[o].reqVid&&(i=e)}),i||(i=0),t.computed[o][2]=i}else t.computed[o][2]=t.userProfileParentVideo[o];t.computed[o][1]>=l.default.userProfileMaxRecommendations&&(y.logger.debug("Removing "+o+" from user profile, recommended to many times"),delete t.computed[o])})}},{key:"normalizeTrending",value:function(){var e=this,t=0;for(var o in this.r.trend)this.r.trend.hasOwnProperty(o)&&this.r.trend[o]>t&&(t=this.r.trend[o]);Object.keys(this.r.trend).forEach(function(o){e.r.trend[o]/=t}),Object.keys(this.r.rel).forEach(function(o){e.r.rel[o].tScore/=t})}},{key:"loopUserProfile",value:function(){var e=this;Object.keys(this.userProfile).forEach(function(t){return e.computedFinal[t]?e.computedFinal[t]+=e.config.gamma*e.userProfile[t]:e.computedFinal[t]=e.config.gamma*e.userProfile[t],e.computed[t]?e.computed[t]+=e.config.gamma*e.userProfile[t]:e.computed[t]=e.config.gamma*e.userProfile[t],!0})}},{key:"loopTrending",value:function(){var e=this;y.logger.debug("Iterating Trending data"),Object.keys(this.r.trend).forEach(function(t){e.computedFinal[t]?e.computedFinal[t]+=e.config.beta*e.r.trend[t]:e.computedFinal[t]=e.config.beta*e.r.trend[t],l.default.debug&&(e.debugReturn[t]?e.debugReturn[t].tScore=e.r.trend[t]:e.debugReturn[t]={tScore:e.r.trend[t]})})}},{key:"loopMost_viewed",value:function(){var e=this;y.logger.debug("Iterating Most viewed data"),Object.keys(this.r.most_viewed).forEach(function(t){e.computedFinal[t]?e.computedFinal[t]+=e.config.delta*e.r.most_viewed[t]:e.computedFinal[t]=e.config.delta*e.r.most_viewed[t],l.default.debug&&(e.debugReturn[t]?e.debugReturn[t].most_viewed=e.r.most_viewed[t]:e.debugReturn[t]={most_viewed:e.r.most_viewed[t]})})}},{key:"calculatePromotions",value:function(){0===Object.keys(this.userProfile).length&&0===Object.keys(this.r.rel).length&&(this.r.most_viewed||this.r.trend)&&(y.logger.info("No user profile and no related found. Generating extra weights for views and trend"),this.domainExclusiveVideos=Math.round(l.default.limit*l.default.percentedomairecommend),this.domainExclusiveTrends=Math.floor(Math.random()*this.domainExclusiveVideos),this.domainExclusiveViews=this.domainExclusiveVideos-this.domainExclusiveTrends,this.domainExclusiveViews>Object.keys(this.r.most_viewed)&&(this.domainExclusiveTrends+=-(Object.keys(this.r.most_viewed)-this.domainExclusiveViews),this.domainExclusiveViews-=-(Object.keys(this.r.most_viewed)-this.domainExclusiveViews)),y.logger.info("News promotions will be for: \n                Trend "+this.domainExclusiveTrends+" \n                Views "+this.domainExclusiveViews))}},{key:"promote",value:function(e){for(var t=this,o=0,i=0,r=0;r<l.default.limit;r++)e[r]&&-1!==e[r].indexOf(l.default.domain)&&(this.domainExclusiveVideos-=1);return this.domainExclusiveVideos<0?(y.logger.info("No promotions are needed, the pole is set."),e):(this.calculatePromotions(),this.r&&this.r.trend?Object.keys(this.r.trend).forEach(function(i){if(o<t.domainExclusiveTrends){var r=e.indexOf(i);if(-1!==i.indexOf(l.default.domain)&&-1!==r){if(r>l.default.limit){var n=e.splice(r,1)[0];e.splice(o,0,n),y.logger.info("Promoted "+n+" from trends. From position "+r+" to "+o)}o+=1}}}):y.logger.warn("There is no trending for promotion :( "),this.r&&this.r.most_viewed?Object.keys(this.r.most_viewed).forEach(function(o){var r=e.indexOf(o);if(o.indexOf(l.default.domain)>=0&&i<=t.domainExclusiveViews&&-1!==r){var n=e.splice(r,1)[0];e.unshift(n),y.logger.info("Promoted "+n+" from views. From position "+r+" to "+i),i+=1}}):y.logger.warn("There is no views for promotion :( "),e)}},{key:"limitUserProfile",value:function(){var e=this;if(Object.keys(this.computed).length>l.default.userProfileMaxSize){var t=void 0,o=void 0,i=Object.keys(this.computed).length-l.default.userProfileMaxSize;o=Object.keys(this.computed).sort(function(t,o){return e.computed[t]-e.computed[o]}),t=o.splice(0,i-1),t.forEach(function(t){y.logger.debug("Removing "+t+" from user profile, score too low"),delete e.computed[t]})}}},{key:"adminAndSaveTtl",value:function(e){var t=this,o=!1,i=l.default.currenturl.replace(u.default.cleanUrlRegex,"");if(Object.keys(this.parentVideos).forEach(function(e){t.parentVideos[e][0]===i&&(o=e)}),o){if(y.logger.log("ParentVideos: Parent video already have used slot, updating timestamp"),2==o){var r=this.parentVideos[1];this.parentVideos[1]=this.parentVideos[2],this.parentVideos[2]=r,Object.keys(this.userProfileVideoInfo).forEach(function(e){2==t.userProfileVideoInfo[e]?t.userProfileVideoInfo[e]="1":1==t.userProfileVideoInfo[e]&&(t.userProfileVideoInfo[e]="2")})}this.parentVideos[1][1]=(new Date).getTime()}else Object.keys(this.userProfileParentVideo).forEach(function(e){2==t.userProfileParentVideo[e]?delete t.computed[e]:1==t.userProfileParentVideo[e]&&(t.userProfileParentVideo[e]="2")}),this.parentVideos[2]=this.parentVideos[1],this.parentVideos[1]=[i,(new Date).getTime()];Object.keys(this.parentVideos).forEach(function(o){Object.keys(e).forEach(function(e){t.userProfileParentVideo[e]==o&&(y.logger.log("ParentVideos: Found a recommended video with a parent on the dict, updating timestamp"),t.parentVideos[o][1]=(new Date).getTime())})}),p.ls.set("vx_parentVideos",this.parentVideos)}}]),e}();o.default=w},{"../config/globalConfig":1,"../config/privateConfig":2,"./helpers/comm/external/emergencyService":5,"./helpers/comm/external/xhr":6,"./helpers/comm/internal/messenger":8,"./helpers/dom/recommendationsFinder":9,"./helpers/storage/localStorage":11,"./helpers/storage/sessionStorage":13,"./helpers/utils/logger":14}],5:[function(e,t,o){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),a=e("./xhr"),l=i(a),s=e("../../../../config/globalConfig"),u=i(s),c=e("../../../../config/privateConfig"),d=i(c),f=e("../../utils/logger"),g=function(){function e(){r(this,e),this.maxHourDelay=24,this.currentHourDelay=0,this.xhr=new l.default,this.cndUrl=d.default.publicUrl+"/recommendation/"}return n(e,[{key:"getCdnJson",value:function(e){f.logger.info("Starting emergency service"),this.currentHourDelay=0,this.doCall(e,this.getFormattedJsonUrl())}},{key:"doCall",value:function(e,t){var o=this;this.xhr.get(t,"",function(i){f.logger.info("Got response on '"+t+"' with "+o.currentHourDelay+" hours of delay"),e(i)},function(){setTimeout(function(){o.currentHourDelay<o.maxHourDelay?(o.currentHourDelay+=1,o.doCall(e,o.getFormattedJsonUrl())):(f.logger.warn("CDN file not found, using user profile."),e(o.getLocalJson()))},5)})}},{key:"getLocalJson",value:function(){return{config:{alpha:1,beta:1,delta:1,gamma:.8},most_viewed:{},rel:{},trend:{}}}},{key:"getFormattedJsonUrl",value:function(){var e=new Date,t="",o=e.getUTCMonth()+1,i=e.getUTCHours(),r=e.getUTCDate(),n=void 0;return e=new Date(e.setHours(e.getHours()-this.currentHourDelay)),t=u.default.retrieveguid?"_guid":"_url",u.default.get_video_info&&(t+="_videoInfo"),o<10&&(o="0"+o),r<10&&(r="0"+r),i<10&&(i="0"+i),n=u.default.userid+"_"+e.getUTCFullYear()+o+r+"_"+i+t+".json",this.cndUrl+n}}]),e}();o.default=g},{"../../../../config/globalConfig":1,"../../../../config/privateConfig":2,"../../utils/logger":14,"./xhr":6}],6:[function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(o,"__esModule",{value:!0});var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),n=e("../../utils/logger"),a=function(){function e(){i(this,e)}return r(e,[{key:"get",value:function(e,t,o,i){n.logger.info("Making Xhr GET to "+e);var r=new XMLHttpRequest,a=Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&");r.open("GET",e+"?"+a,!0),r.setRequestHeader("Accept","application/json, text/javascript, */*"),r.onreadystatechange=function(){4!==r.readyState||"2"!==r.status.toString()[0]&&"0"!==r.status.toString()[0]?4===r.readyState&&"2"!==r.status.toString()[0]&&(n.logger.error("Xhr GET to "+e+" erroneous with code "+r.status),i(!0)):(n.logger.info("Xhr GET to "+e+" successful with code "+r.status),
r.response.length>1?o(JSON.parse(r.response)):(n.logger.warn("No JSON data found on the response"),i(!1)))},r.send(null)}},{key:"post",value:function(e,t,o,i){n.logger.info("Making Xhr Post to "+e);var r=new XMLHttpRequest,a=Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&");r.open("POST",e+"?"+a,!0,!0),r.setRequestHeader("Accept","application/json, text/javascript, */*"),r.onreadystatechange=function(){4===r.readyState&&"2"===r.status.toString()[0]?(n.logger.info("Xhr Post to "+e+" successful with code "+r.status),r.response.length>1?o(JSON.parse(r.response)):(n.logger.warn("No JSON data found on the response"),i(!1))):4===r.readyState&&"2"!==r.status.toString()[0]&&(n.logger.error("Xhr Post to "+e+" erroneous with code "+r.status),i(!0))},r.send(null)}}]),e}();o.default=a},{"../../utils/logger":14}],7:[function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(o,"__esModule",{value:!0});var r=function e(t,o){i(this,e),this.timestamp=Date.now(),this.sender=o,this.message=t,this.isVidrecMessage=!0};o.default=r},{}],8:[function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(o,"__esModule",{value:!0});var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),n=e("./message"),a=function(e){return e&&e.__esModule?e:{default:e}}(n),l=e("../../utils/logger"),s=function(){function e(t){return i(this,e),this.role=t,this.chanel="messenger","top"===this.role?this.postDestination=document.querySelector("#vilynxVrSup").contentWindow:"iframe"===this.role?this.postDestination=parent.window:l.logger.warn("Role not defined properly, must define role ['top' or 'iframe'] to send post message"),this.listenPost(),!0}return r(e,[{key:"sendInternal",value:function(e,t){var o={};o=t?new CustomEvent(this.chanel,{detail:e}):new CustomEvent(this.chanel,{detail:new a.default(e,this.role)}),document.dispatchEvent(o)}},{key:"sendPost",value:function(e,t){l.logger.info("Sending post message:"),l.logger.info(e);var o={};if(o=t?e:new a.default(e,this.role),"top"!==this.role&&"iframe"!==this.role)return l.logger.warn("Role not defined properly, must define role ['top' or 'iframe'] to send post message"),!1;this.postDestination.postMessage(o,"*")}},{key:"listenPost",value:function(){var e=this;window.addEventListener("message",function(t){if(!t.data.isVidrecMessage)return!1;e.sendInternal(t.data,!0)})}}]),e}();o.default=s},{"../../utils/logger":14,"./message":7}],9:[function(e,t,o){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(o,"__esModule",{value:!0}),o.recommendationFinder=void 0;var n=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),a=e("../../../config/privateConfig"),l=i(a),s=e("./../comm/external/xhr"),u=i(s),c=e("./../storage/sessionStorage"),d=e("./../storage/localStorage"),f=e("./../utils/logger");e("../../../polyfills/mutationObserver"),e("../../../polyfills/classList");var g=e("../../../config/globalConfig"),h=i(g),m=function(){function e(){r(this,e),this.urlsToObserve=[],this.urlsObsrved=[],this.scrollWatchers=[],this.domNodes=[],this.currentElementsInDom=0,this.hashesToSend=[],this.xhr=new u.default,this.currentUrl=document.location.host+(document.location.pathname||""),this.domObserver,this.addDomObserver()}return n(e,[{key:"destructor",value:function(){this.urlsToObserve=[],this.urlsObsrved=[],this.scrollWatchers=[],this.domNodes=[],this.currentElementsInDom=0,this.hashesToSend=[],this.domObserver&&this.domObserver.disconnect()}},{key:"addUrlsToObserve",value:function(e){var t=this;return"string"==typeof e&&(e=[e]),e.forEach(function(e){-1===t.urlsToObserve.indexOf(e)&&-1===t.urlsObsrved.indexOf(e)&&t.urlsToObserve.push(e)}),!0}},{key:"reScanDom",value:function(e){var t=this,o={},i=0;Array.prototype.forEach.call(e,function(e){e.querySelector&&t.urlsToObserve.forEach(function(i){try{if(-1===t.urlsObsrved.indexOf(i)){var r='a[href*="'+i+'"]:not(.vilynx_cf)',n=void 0;if(h.default.idattribute&&(r+=", *.vilynx_enabled["+h.default.idattribute+'*="'+i+'"]:not(.vilynx_cf)'),(n=e.querySelector(r))&&n.offsetParent)throw o[i]=n,i}}catch(o){var a=t.urlsToObserve.indexOf(o);t.urlsObsrved.push(t.urlsToObserve.slice(a,1)),f.logger.log(e),f.logger.log("found! "+o)}})}),Object.keys(o).length>0&&Object.keys(o).forEach(function(e){try{var r=void 0,n=void 0;try{r=o[e],n=r.classList.contains("vilynx_cf")}catch(e){n=!1}if(!n&&o[e]){var a=t.getHashFromUrl(e),s=t.scrollWatchers.push(window.scrollMonitor.create(r));try{r.classList.add("vilynx_cf")}catch(e){return f.logger.error(e),0}a.length>1?(t.scrollWatchers[s-1].enterViewport(function(){r.classList.contains("vilynx_cf_watched")||(f.logger.log(a+" entering viewport for first time"),r.classList.add("vilynx_cf_watched"),t.hashesToSend.push(a),t.currentElementsInDom+=1,t._debounce(function(){var e={data:JSON.stringify({currentUrl:t.currentUrl,hashes:t.hashesToSend,numVideos:t.currentElementsInDom})};t.xhr.get(l.default.serverurl+"/api2.0/recommendations/cf_displayed",e,function(){return t.hashesToSend=[],!0},function(){return!0})},500)())}),r.addEventListener("click",function(){var e={data:JSON.stringify({currentUrl:t.currentUrl,videoSelected:a,numVideos:t.currentElementsInDom})};c.ss.set("vx_clicked",e),setTimeout(function(){t.sendClickEvent(e)},500)},!0)):f.logger.warn("Video URL "+e+" have no associated hash")}else i+=1}catch(e){f.logger.error(e)}}),i>0&&this.reScanDom(e)}},{key:"addDomObserver",value:function(){var e=this,t=document.querySelector("body"),o={childList:!0,subtree:!0};this.domObserver=new MutationObserver(function(t){t.forEach(function(t){t.addedNodes.length>0&&e.reScanDom(t.addedNodes)})}),this.domObserver.observe(t,o)}},{key:"getHashFromUrl",value:function(e){var t=d.ls.get("vx_urlInfo");return!!t[e]&&t[e].hash}},{key:"sendClickEvent",value:function(e,t){this.xhr.get(l.default.serverurl+"/api2.0/recommendations/cf_clicked",e,function(){c.ss.remove("vx_clicked")},function(){f.logger.warn("Can't send clicked element."),t&&(f.logger.info("Removing information form SS."),c.ss.remove("vx_clicked"))})}},{key:"_debounce",value:function(e,t,o){var i=this,r=arguments;return h.default.cf?function(){var n=i,a=r,l=function(){i.timeout=null,o||e.apply(n,a)},s=o&&!i.timeout;clearTimeout(i.timeout),i.timeout=setTimeout(l,t),s&&e.apply(n,a)}:(f.logger.warn('"CF" is disabled, debounce is disabled.'),function(){return!1})}},{key:"_findAncestor",value:function(e,t){for(;(e=e.parentElement)&&!e.classList.contains(t););return e}}]),e}();o.recommendationFinder=new m},{"../../../config/globalConfig":1,"../../../config/privateConfig":2,"../../../polyfills/classList":16,"../../../polyfills/mutationObserver":18,"./../comm/external/xhr":6,"./../storage/localStorage":11,"./../storage/sessionStorage":13,"./../utils/logger":14}],10:[function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(o,"__esModule",{value:!0}),o.scrollMonitor=void 0;var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),n=e("../../../config/globalConfig"),a=function(e){return e&&e.__esModule?e:{default:e}}(n),l=e("./../utils/logger"),s=function(){function e(){var t=this;i(this,e);var o=setInterval(function(){a.default.loaded&&(l.logger.info("ScrollMonitor initialized"),window.scrollMonitor=t.factory(),clearInterval(o))},20)}return r(e,[{key:"factory",value:function(){function e(){if(d.viewportTop=u(),d.viewportBottom=d.viewportTop+d.viewportHeight,d.documentHeight=E(),d.viewportLeft=c(),d.viewportRight=d.viewportLeft+d.viewportWidth,d.documentWidth=O(),d.documentHeight!==V||d.documentWidth!==M){for(P=f.length;P--;)f[P].recalculateLocation();V=d.documentHeight,M=d.documentWidth}}function t(){d.viewportHeight=C(),d.viewportWidth=k(),e(),i()}function o(){clearTimeout(I),I=setTimeout(t,100)}function i(){for(R=f.length;R--;)f[R].recalculateLocation(),f[R].update();for(R=f.length;R--;)f[R].triggerCallbacks()}function r(e,t){function o(e){if(0!==e.length)for(f=e.length;f--;)C=e[f],C.callback.call(i,T),C.isOne&&e.splice(f,1)}var i=this;this.watchItem=e,this.offsets=t?t===+t?{top:t,bottom:t}:{top:t.top||S.top,bottom:t.bottom||S.bottom}:S,this.callbacks={};for(var r=0,n=x.length;r<n;r++)i.callbacks[x[r]]=[];this.locked=!1;var a,l,s,u,c,f,C,k=!0;this.triggerCallbacks=function(){switch(this.isInViewport&&!a&&o(this.callbacks[h]),this.isFullyInViewport&&!l&&o(this.callbacks[m]),this.isCanPreload&&!c&&o(this.callbacks[w]),this.isCanUnload&&!k&&o(this.callbacks[_]),this.isAboveViewport!==s&&this.isBelowViewport!==u&&(o(this.callbacks[g]),l||this.isFullyInViewport||(o(this.callbacks[m]),o(this.callbacks[p])),a||this.isInViewport||(o(this.callbacks[h]),o(this.callbacks[v]))),!this.isFullyInViewport&&l&&o(this.callbacks[p]),!this.isInViewport&&a&&o(this.callbacks[v]),this.isInViewport!==a&&o(this.callbacks[g]),!0){case a!==this.isInViewport:case l!==this.isFullyInViewport:case s!==this.isAboveViewport:case u!==this.isBelowViewport:o(this.callbacks[y])}a=this.isInViewport,l=this.isFullyInViewport,s=this.isAboveViewport,u=this.isBelowViewport,c=this.isCanPreload,k=this.isCanUnload},this.recalculateLocation=function(){if(!this.locked&&this.watchItem){var e=this.top,t=this.bottom;if(this.watchItem.nodeName){var i=this.watchItem.style.display;"none"===i&&(this.watchItem.style.display="");var r=this.watchItem.getBoundingClientRect();this.top=Math.ceil(r.top)+d.viewportTop,this.bottom=Math.floor(r.bottom)+d.viewportTop,this.left=Math.ceil(r.left)+d.viewportLeft,this.right=Math.floor(r.right)+d.viewportLeft,"none"===i&&(this.watchItem.style.display=i)}else this.watchItem===+this.watchItem?this.watchItem>0?this.top=this.bottom=this.watchItem:this.top=this.bottom=d.documentHeight-this.watchItem:(this.top=this.watchItem.top,this.bottom=this.watchItem.bottom);this.top-=this.offsets.top,this.bottom+=this.offsets.bottom,this.height=this.bottom-this.top,void 0===e&&void 0===t||this.top===e&&this.bottom===t||o(this.callbacks[b])}},this.recalculateLocation(),this.update(),a=this.isInViewport,l=this.isFullyInViewport,s=this.isAboveViewport,u=this.isBelowViewport}function n(t){T=t,e(),i()}this.version=.9;var l="undefined"==typeof window,s=!l,u=function(){return l?0:"undefined"!=typeof showMarquee?-parseInt(showMarquee.content.$container.css("top")):window.pageYOffset||document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop},c=function(){return l?0:window.pageXOffset>=0?0:window.pageXOffset||document.documentElement&&document.documentElement.scrollWidth||document.body.scrollWidth},d={},f=[],g="visibilityChange",h="enterViewport",m="fullyEnterViewport",v="exitViewport",p="partiallyExitViewport",b="locationChange",y="stateChange",w="canPreload",_="canUnload",x=[g,h,m,v,p,b,y,w,_],S={top:0,bottom:0},C=function(){return l?0:window.innerHeight||document.documentElement.clientHeight},k=function(){return l?0:window.innerWidth||document.documentElement.clientWidth},E=function(){return l?0:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight)},O=function(){return l?0:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth,document.documentElement.clientWidth)};d.viewportTop=null,d.viewportBottom=null,d.documentHeight=null,d.viewportHeight=C(),d.viewportWidth=k();var V,M,T,P,I,R;r.prototype={on:function(e,t,o){switch(!0){case e===g&&!this.isInViewport&&this.isAboveViewport:case e===h&&this.isInViewport:case e===m&&this.isFullyInViewport:case e===v&&this.isAboveViewport&&!this.isInViewport:case e===p&&this.isAboveViewport:case e===w&&this.isCanPreload:case e===_&&this.isCanUnload:if(t.call(this,T),o)return}if(!this.callbacks[e])throw new Error("Tried to add a scroll monitor listener of type "+e+". Your options are: "+x.join(", "));this.callbacks[e].push({callback:t,isOne:o||!1})},off:function(e,t){if(!this.callbacks[e])throw new Error("Tried to remove a scroll monitor listener of type "+e+". Your options are: "+x.join(", "));for(var o,i=0;o=this.callbacks[e][i];i++)if(o.callback===t){this.callbacks[e].splice(i,1);break}},one:function(e,t){this.on(e,t,!0)},recalculateSize:function(){this.height=this.watchItem.offsetHeight+this.offsets.top+this.offsets.bottom,this.bottom=this.top+this.height},update:function(){this.isAboveViewport=this.top<d.viewportTop,this.isBelowViewport=this.bottom>d.viewportBottom,this.isInViewport=this.top<=d.viewportBottom&&this.bottom>=d.viewportTop&&this.left<=d.viewportRight&&this.right>=d.viewportLeft,this.isFullyInViewport=this.top>=d.viewportTop&&this.bottom<=d.viewportBottom&&this.left>=d.viewportLeft&&this.right<=d.viewportRight||this.isAboveViewport&&this.isBelowViewport,this.isCanPreload=this.top-a.default.preloadoffset<=d.viewportBottom&&this.bottom+a.default.preloadoffset>=d.viewportTop,this.isCanUnload=!this.isCanPreload},destroy:function(){var e=f.indexOf(this),t=this;f.splice(e,1);for(var o=0,i=x.length;o<i;o++)t.callbacks[x[o]].length=0},lock:function(){this.locked=!0},unlock:function(){this.locked=!1}};for(var L=0,j=x.length;L<j;L++){var D=x[L];r.prototype[D]=function(e){return function(t,o){this.on.call(this,e,t,o)}}(D)}if(s)try{e()}catch(t){try{window.$(e)}catch(e){throw new Error("If you must put scrollMonitor in the <head>, you must use jQuery.")}}if(s){if(window.addEventListener){var N=!1;window.addEventListener("scroll",function(e){N||window.requestAnimationFrame(function(){n(e),N=!1}),N=!0},!0),window.addEventListener("resize",o)}else window.attachEvent("onscroll",n),window.attachEvent("onresize",o);a.default.proactiveload&&setInterval(function(){d.update(),n()},200)}return d.beget=d.create=function(e,t){"string"==typeof e?e=document.querySelector(e):e&&e.length>0&&(e=e[0]);var o=new r(e,t);return f.push(o),o.update(),o},d.update=function(){T=null,e(),i()},d.recalculateLocations=function(){d.documentHeight=0,d.update()},d.version=this.version,d}},{key:"reFactory",value:function(){l.logger.warn("ScrollMonitor create error, reFactory method called"),window.scrollMonitor=this.factory()}}]),e}();o.scrollMonitor=new s},{"../../../config/globalConfig":1,"./../utils/logger":14}],11:[function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(o,"__esModule",{value:!0}),o.ls=void 0;var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),n=e("../utils/logger"),a=function(){function e(){i(this,e),this.isLoacalStorageAvailable=!0;try{var t="__storage_test__";localStorage.setItem(t,t),localStorage.removeItem(t)}catch(e){this.isLoacalStorageAvailable=!1,n.logger.warn("LocalStorage is not available")}}return r(e,[{key:"disableLocalStorage",value:function(){this.isLoacalStorageAvailable&&(this.remove("vx_computed"),this.remove("vx_last_returned"),this.remove("vx_parentVideos"),this.remove("vx_recommended"),this.remove("vx_urlInfo"),this.remove("vx_version"),this.remove("vx_viewed")),this.isLoacalStorageAvailable=!1}},{key:"get",value:function(e){if(!this.isLoacalStorageAvailable)return n.logger.warn("LocalStorage is not available"),!1;n.logger.debug("Getting "+e+" from local storage");var t=localStorage.getItem(e);try{t=JSON.parse(t)||!1}catch(e){t=!1}return t}},{key:"set",value:function(e,t){if(!this.isLoacalStorageAvailable)return n.logger.warn("LocalStorage is not available"),!1;n.logger.debug("Saving "+e+" to local storage");try{localStorage.setItem(e,JSON.stringify(t))}catch(e){n.logger.error(e),n.logger.error("Can't save to local storage. Maybe it's full.")}return e}},{key:"remove",value:function(e){return this.isLoacalStorageAvailable?(n.logger.debug("Removing "+e+" from local storage"),localStorage.removeItem(e),e):(n.logger.warn("LocalStorage is not available"),!1)}}]),e}();o.ls=new a},{"../utils/logger":14}],12:[function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(o,"__esModule",{value:!0}),o.localStorageUpdater=void 0;var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),n=e("../../../config/privateConfig"),a=function(e){return e&&e.__esModule?e:{default:e}}(n),l=e("./localStorage"),s=e("../utils/logger"),u=function(){function e(){i(this,e)}return r(e,[{key:"validateLocalStorage",value:function(){return!!this.isLocalStorageUpToDate()||(s.logger.log("Version hash mismatch, checking LocalStorage integrity"),this.updateVxComputed()&&this.updateVxRecommended()&&this.updateVxViewed()&&this.updateVxVersion()&&this.updateVxUrlInfo())}},{key:"updateVxComputed",value:function(){var e=l.ls.get("vx_computed")||{};s.logger.info("Validating vx_computed");try{Object.keys(e).forEach(function(t){if(!Array.isArray(e[t]))throw"nope";if("number"!=typeof e[t][0]||"number"!=typeof e[t][1]||1!==e[t][2].length)throw"nope"})}catch(e){s.logger.warn('Can\'t determine structure for "vx_computed" resenting value'),l.ls.set("vx_computed",{})}finally{return!0}}},{key:"updateVxRecommended",value:function(){var e=l.ls.get("vx_recommended")||{};s.logger.info("Validating vx_recommended");try{Object.keys(e).forEach(function(t){if("number"==typeof e[t][0]&&"number"==typeof e[t][1])return!0;throw"nope"})}catch(e){s.logger.warn('Can\'t determine structure for "vx_recommended" resenting value'),l.ls.set("vx_recommended",{})}finally{return!0}}},{key:"updateVxViewed",value:function(){var e=l.ls.get("vx_viewed")||{};s.logger.info("Validating vx_viewed");try{e.forEach(function(e){if("string"==typeof e)return!0;throw"nope"})}catch(e){s.logger.warn('Can\'t determine structure for "vx_viewed" resenting value'),l.ls.set("vx_viewed",[])}finally{return!0}}},{key:"updateVxUrlInfo",value:function(){var e=l.ls.get("vx_urlInfo")||{};try{Object.keys(e).forEach(function(t){if(void 0===e[t].url||void 0===e[t].guid)throw"nope"})}catch(e){s.logger.warn('Can\'t determine structure for "vx_urlInfo" resenting value'),l.ls.set("vx_urlInfo",{}),l.ls.set("vx_computed",{})}finally{return!0}}},{key:"isLocalStorageUpToDate",value:function(){return(l.ls.get("vx_version")||"")===this.hashString(a.default.version)}},{key:"hashString",value:function(e){var t=0,o=void 0,i=void 0;if(0===e.length)return t;for(o=0;o<e.length;o++)i=e.charCodeAt(o),t=(t<<5)-t+i,t|=0;return t}},{key:"updateVxVersion",value:function(){return l.ls.set("vx_version",this.hashString(a.default.version)),!0}}]),e}();o.localStorageUpdater=new u},{"../../../config/privateConfig":2,"../utils/logger":14,"./localStorage":11}],13:[function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(o,"__esModule",{value:!0}),o.ss=void 0;var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),n=e("../utils/logger"),a=function(){function e(){i(this,e),this.isSessionStorageAvailable=!0;try{var t="__storage_test__";sessionStorage.setItem(t,t),sessionStorage.removeItem(t)}catch(e){this.isSessionStorageAvailable=!1,n.logger.warn("SessionStorage is not available")}}return r(e,[{key:"disableSessionStorage",value:function(){this.isSessionStorageAvailable&&this.remove("vx_lastBatchRecommended"),this.isSessionStorageAvailable=!1}},{key:"get",value:function(e){if(!this.isSessionStorageAvailable)return n.logger.warn("SessionStorage is not available"),!1;n.logger.debug("Getting "+e+" from local storage");var t=sessionStorage.getItem(e);try{t=JSON.parse(t)||!1}catch(e){t=!1}return t}},{key:"set",value:function(e,t){if(!this.isSessionStorageAvailable)return n.logger.warn("SessionStorage is not available"),!1;n.logger.debug("Saving "+e+" to local storage");try{sessionStorage.setItem(e,JSON.stringify(t))}catch(e){n.logger.error(e),n.logger.error("Can't save to session storage. Maybe it's full.")}return!0}},{key:"remove",value:function(e){return this.isSessionStorageAvailable?(n.logger.debug("Removing "+e+" from local storage"),sessionStorage.removeItem(e),!0):(n.logger.warn("SessionStorage is not available"),!1)}}]),e}();o.ss=new a},{"../utils/logger":14}],14:[function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(o,"__esModule",{value:!0}),o.logger=void 0;var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),n=e("../../../config/globalConfig"),a=function(e){return e&&e.__esModule?e:{default:e}}(n),l=function(){function e(){i(this,e),this.info("Logger Enabled")}return r(e,[{key:"debug",value:function(e){a.default.iframed&&(e="[IFRAME] "+e),!a.default.debug||console.debug(e)}},{key:"log",value:function(e){a.default.iframed&&(e="[IFRAME] "+e),!a.default.debug||console.log(e)}},{key:"info",value:function(e){a.default.iframed&&(e="[IFRAME] "+e),!a.default.debug||console.info(e)}},{key:"warn",value:function(e){a.default.iframed&&(e="[IFRAME] "+e),!a.default.debug||console.warn(e)}},{key:"error",value:function(e){a.default.iframed&&(e="[IFRAME] "+e),!a.default.debug||console.error(e)}},{key:"timeStart",value:function(e){a.default.iframed&&(e="[IFRAME] "+e),!a.default.debug||console.time(e)}},{key:"timeStop",value:function(e){a.default.iframed&&(e="[IFRAME] "+e),!a.default.debug||console.timeEnd(e)}}]),e}();o.logger=new l},{"../../../config/globalConfig":1}],15:[function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(o,"__esModule",{value:!0});var r=function(){function e(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,o,i){return o&&e(t.prototype,o),i&&e(t,i),t}}(),n=e("./helpers/utils/logger"),a=e("./../config/globalConfig"),l=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(t){i(this,e),this.querySelector=t,this.config={},this.isvertical=!1,this.width=document.querySelector(t).offsetWidth,this.height=document.querySelector(t).offsetHeight,this.min_elemwidth=l.default.minelemwidth,this.min_elemheight=l.default.minelemheight,this.min_spacing=l.default.minelemspacing;var o=document.createElement("style"),r=this;o.type="text/css",o.innerHTML=".vx_rec_main {width:100%; height: 100%; display:block; overflow:hidden; }",o.innerHTML+=".vx_rec { float:left;overflow:hidden; padding:0px; align:center;}",o.innerHTML+=".vx_rec a{ text-decoration:none; display:block; margin:0px; padding:0px;}",o.innerHTML+=".vx_rec h2{ font-size:1em; line-height:1.2em; font-family: proxima_nova,Helvetica,Arial,sans-serif;  margin:0px; padding:0px; font-weight:300; color:#666;}",o.innerHTML+=".vx_rec h2:hover,h2:active, h2:focus{ color:#444;}",document.body.appendChild(o),window.addEventListener("resize",function(){r.resizeElements()})}return r(e,[{key:"insertRecommendations",value:function(e){var t=document.createElement("div"),o=document.createElement("a"),i=document.createElement("div"),r=document.createElement("div"),a=document.createElement("img"),l=document.createElement("h2"),s=document.createElement("a");t.className="vx_rec_main",i.className="vx_rec",a.src="",o.appendChild(a),r.appendChild(o),i.appendChild(r),s.appendChild(l),i.appendChild(s),n.logger.debug("Got "+e.length+" to show thumbnails"),e.forEach(function(e){var o=i.cloneNode(!0),r=o.getElementsByTagName("a")[0],a=o.getElementsByTagName("a")[1],l=o.getElementsByTagName("h2")[0],s=o.getElementsByTagName("img")[0],u=e.title,c=e.thumbnail,d=e.url;-1===c.search(/(^\w+:|^)\/\//)&&(c="//"+c),d&&-1===d.search(/(^\w+:|^)\/\//)&&(d="//"+d),d&&(r.href=d,a.href=d),s.onerror=function(){n.logger.warn("Can't load default recommendation thumbnail, trying gallery fallback."),r.className+=" vilynx_noimage",s.style.visibility="hidden"},s.src=c,l.innerHTML=u,t.appendChild(o)}),document.querySelector(this.querySelector).appendChild(t),this.resizeElements()}},{key:"resizeElements",value:function(){var e=this;this.width=parseInt(window.getComputedStyle(document.querySelector(this.querySelector)).width,10),this.height=parseInt(window.getComputedStyle(document.querySelector(this.querySelector)).height,10),this.isvertical=!(this.width>this.height);var t=document.querySelector(this.querySelector).getElementsByClassName("vx_rec"),o=this;[].forEach.call(t,function(t,i){if(o.isvertical){t.style.width=o.width+"px";var r=parseInt(window.getComputedStyle(document.querySelector(e.querySelector).getElementsByTagName("h2")[0]).height,10),n=Math.floor((o.height+o.min_spacing)/(o.min_elemheight+o.min_spacing)),a=Math.floor((o.height+o.min_spacing)/n-o.min_spacing),l=Math.floor((o.height-n*a)/(n-1)),s=a-r;t.style.height=a+"px",t.style.width=o.width+"px",t.getElementsByTagName("img")[0].style.height=s+"px",t.getElementsByTagName("a")[0].style.height=s+"px",t.getElementsByTagName("img")[0].style.width="100%",t.style.margin="0px",0!==i&&(t.style.marginTop=l+"px")}else{var u=Math.floor((o.width+o.min_spacing)/(o.min_elemwidth+o.min_spacing)),c=Math.floor((o.width+o.min_spacing)/u-o.min_spacing),d=Math.floor((o.width-u*c)/(u-1));t.style.width=c+"px",t.style.height=o.height+"px",t.getElementsByTagName("img")[0].style.width=Math.floor(o.width/u)+"px",t.getElementsByTagName("img")[0].style.height=.5625*o.width/u+"px",t.getElementsByTagName("a")[0].style.height="100%",t.style.margin="0px",0!==i&&(t.style.marginLeft=d+"px")}})}}]),e}();o.default=s},{"./../config/globalConfig":1,"./helpers/utils/logger":14}],16:[function(e,t,o){"use strict";"document"in self&&("classList"in document.createElement("_")?function(){var e=document.createElement("_");if(e.classList.add("c1","c2"),!e.classList.contains("c2")){var t=function(e){var t=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(e){var o,i=arguments.length;for(o=0;o<i;o++)e=arguments[o],t.call(this,e)}};t("add"),t("remove")}if(e.classList.toggle("c3",!1),e.classList.contains("c3")){var o=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(e,t){return 1 in arguments&&!this.contains(e)==!t?t:o.call(this,e)}}e=null}():function(e){if("Element"in e){var t=e.Element.prototype,o=Object,i=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},r=Array.prototype.indexOf||function(e){for(var t=0,o=this.length;t<o;t++)if(t in this&&this[t]===e)return t;return-1},n=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},a=function(e,t){if(""===t)throw new n("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new n("INVALID_CHARACTER_ERR","String contains an invalid character");return r.call(e,t)},l=function(e){for(var t=i.call(e.getAttribute("class")||""),o=t?t.split(/\s+/):[],r=0,n=o.length;r<n;r++)this.push(o[r]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},s=l.prototype=[],u=function(){return new l(this)};if(n.prototype=Error.prototype,s.item=function(e){return this[e]||null},s.contains=function(e){return e+="",-1!==a(this,e)},s.add=function(){var e,t=arguments,o=0,i=t.length,r=!1;do{e=t[o]+"",-1===a(this,e)&&(this.push(e),r=!0)}while(++o<i);r&&this._updateClassName()},s.remove=function(){var e,t,o=arguments,i=0,r=o.length,n=!1;do{for(e=o[i]+"",t=a(this,e);-1!==t;)this.splice(t,1),n=!0,t=a(this,e)}while(++i<r);n&&this._updateClassName()},s.toggle=function(e,t){e+="";var o=this.contains(e),i=o?!0!==t&&"remove":!1!==t&&"add";return i&&this[i](e),!0===t||!1===t?t:!o},s.toString=function(){return this.join(" ")},o.defineProperty){var c={get:u,enumerable:!0,configurable:!0};try{o.defineProperty(t,"classList",c)}catch(e){-2146823252===e.number&&(c.enumerable=!1,o.defineProperty(t,"classList",c))}}else o.prototype.__defineGetter__&&t.__defineGetter__("classList",u)}}(self))},{}],17:[function(e,t,o){"use strict";!function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var o=document.createEvent("CustomEvent");return o.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),o}if("function"==typeof window.CustomEvent)return!1;e.prototype=window.Event.prototype,window.CustomEvent=e}()},{}],18:[function(e,t,o){"use strict";!function(){function e(e){S.push(e),x||(x=!0,y(o))}function t(e){return window.ShadowDOMPolyfill&&window.ShadowDOMPolyfill.wrapIfNeeded(e)||e}function o(){x=!1;var e=S;S=[],e.sort(function(e,t){return e.uid_-t.uid_});var t=!1;e.forEach(function(e){var o=e.takeRecords();i(e),o.length&&(e.callback_(o,e),t=!0)}),t&&o()}function i(e){e.nodes_.forEach(function(t){var o=b.get(t);o&&o.forEach(function(t){t.observer===e&&t.removeTransientObservers()})})}function r(e,t){for(var o=e;o;o=o.parentNode){var i=b.get(o);if(i)for(var r=0;r<i.length;r++){var n=i[r],a=n.options;if(o===e||a.subtree){var l=t(a);l&&n.enqueue(l)}}}}function n(e){this.callback_=e,this.nodes_=[],this.records_=[],this.uid_=++C}function a(e,t){this.type=e,this.target=t,this.addedNodes=[],this.removedNodes=[],this.previousSibling=null,this.nextSibling=null,this.attributeName=null,this.attributeNamespace=null,this.oldValue=null}function l(e){var t=new a(e.type,e.target);return t.addedNodes=e.addedNodes.slice(),t.removedNodes=e.removedNodes.slice(),t.previousSibling=e.previousSibling,t.nextSibling=e.nextSibling,t.attributeName=e.attributeName,t.attributeNamespace=e.attributeNamespace,t.oldValue=e.oldValue,t}function s(e,t){return k=new a(e,t)}function u(e){return E||(E=l(k),E.oldValue=e,E)}function c(){k=E=void 0}function d(e){return e===E||e===k}function f(e,t){return e===t?e:E&&d(e)?E:null}function g(e,t,o){this.observer=e,this.target=t,this.options=o,this.transientObservedNodes=[]}var h=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,m=window.WeakMap;if(void 0===m){var v=Object.defineProperty,p=Date.now()%1e9;m=function(){this.name="__st"+(1e9*Math.random()>>>0)+p+++"__"},m.prototype={set:function(e,t){var o=e[this.name];return o&&o[0]===e?o[1]=t:v(e,this.name,{value:[e,t],writable:!0}),this},get:function(e){var t;return(t=e[this.name])&&t[0]===e?t[1]:void 0},delete:function(e){var t=e[this.name];if(!t)return!1;var o=t[0]===e;return t[0]=t[1]=void 0,o},has:function(e){var t=e[this.name];return!!t&&t[0]===e}}}var b=new m,y=window.msSetImmediate;if(!y){var w=[],_=String(Math.random());window.addEventListener("message",function(e){if(e.data===_){var t=w;w=[],t.forEach(function(e){e()})}}),y=function(e){w.push(e),window.postMessage(_,"*")}}var x=!1,S=[],C=0;n.prototype={observe:function(e,o){if(e=t(e),
!o.childList&&!o.attributes&&!o.characterData||o.attributeOldValue&&!o.attributes||o.attributeFilter&&o.attributeFilter.length&&!o.attributes||o.characterDataOldValue&&!o.characterData)throw new SyntaxError;var i=b.get(e);i||b.set(e,i=[]);for(var r,n=0;n<i.length;n++)if(i[n].observer===this){r=i[n],r.removeListeners(),r.options=o;break}r||(r=new g(this,e,o),i.push(r),this.nodes_.push(e)),r.addListeners()},disconnect:function(){this.nodes_.forEach(function(e){for(var t=b.get(e),o=0;o<t.length;o++){var i=t[o];if(i.observer===this){i.removeListeners(),t.splice(o,1);break}}},this),this.records_=[]},takeRecords:function(){var e=this.records_;return this.records_=[],e}};var k,E;g.prototype={enqueue:function(t){var o=this.observer.records_,i=o.length;if(o.length>0){var r=o[i-1],n=f(r,t);if(n)return void(o[i-1]=n)}else e(this.observer);o[i]=t},addListeners:function(){this.addListeners_(this.target)},addListeners_:function(e){var t=this.options;t.attributes&&e.addEventListener("DOMAttrModified",this,!0),t.characterData&&e.addEventListener("DOMCharacterDataModified",this,!0),t.childList&&e.addEventListener("DOMNodeInserted",this,!0),(t.childList||t.subtree)&&e.addEventListener("DOMNodeRemoved",this,!0)},removeListeners:function(){this.removeListeners_(this.target)},removeListeners_:function(e){var t=this.options;t.attributes&&e.removeEventListener("DOMAttrModified",this,!0),t.characterData&&e.removeEventListener("DOMCharacterDataModified",this,!0),t.childList&&e.removeEventListener("DOMNodeInserted",this,!0),(t.childList||t.subtree)&&e.removeEventListener("DOMNodeRemoved",this,!0)},addTransientObserver:function(e){if(e!==this.target){this.addListeners_(e),this.transientObservedNodes.push(e);var t=b.get(e);t||b.set(e,t=[]),t.push(this)}},removeTransientObservers:function(){var e=this.transientObservedNodes;this.transientObservedNodes=[],e.forEach(function(e){this.removeListeners_(e);for(var t=b.get(e),o=0;o<t.length;o++)if(t[o]===this){t.splice(o,1);break}},this)},handleEvent:function(e){switch(e.stopImmediatePropagation(),e.type){case"DOMAttrModified":var t=e.attrName,o=e.relatedNode.namespaceURI,i=e.target,n=new s("attributes",i);n.attributeName=t,n.attributeNamespace=o;var a=null;"undefined"!=typeof MutationEvent&&e.attrChange===MutationEvent.ADDITION||(a=e.prevValue),r(i,function(e){if(e.attributes&&(!e.attributeFilter||!e.attributeFilter.length||-1!==e.attributeFilter.indexOf(t)||-1!==e.attributeFilter.indexOf(o)))return e.attributeOldValue?u(a):n});break;case"DOMCharacterDataModified":var i=e.target,n=s("characterData",i),a=e.prevValue;r(i,function(e){if(e.characterData)return e.characterDataOldValue?u(a):n});break;case"DOMNodeRemoved":this.addTransientObserver(e.target);case"DOMNodeInserted":var l,d,i=e.relatedNode,f=e.target;"DOMNodeInserted"===e.type?(l=[f],d=[]):(l=[],d=[f]);var g=f.previousSibling,h=f.nextSibling,n=s("childList",i);n.addedNodes=l,n.removedNodes=d,n.previousSibling=g,n.nextSibling=h,r(i,function(e){if(e.childList)return n})}c()}},h||(window.MutationObserver=n)}()},{}],19:[function(e,t,o){"use strict";"path"in Event.prototype||Object.defineProperty(Event.prototype,"path",{get:function(){for(var e=[],t=this.target;t;)e.push(t),t=t.parentElement;return-1===e.indexOf(window)&&-1===e.indexOf(document)&&e.push(document),-1===e.indexOf(window)&&e.push(window),e}})},{}]},{},[3]);