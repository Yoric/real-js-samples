function openModal(e){var o=document.getElementById("signinModal"),n=document.querySelectorAll(".js_closeModal");if(o){var t=e;signinbox.signInUtilModal=new MG_Modal({content:o}),null!==typeof signinbox.signInUtilModal&&signinbox.signInUtilModal.openModal(function(o,n){var r=n.querySelectorAll(".js-signinUsernameModal");if(e=n.querySelectorAll("[class*=loginAccessTitle]"),e[0].innerHTML=t||textPHTranslation.loginTitle,e[0].innerHTML.toLowerCase().indexOf("subscribe")>=0){var a=document.getElementsByClassName("js-loginFormModal"),s=document.createElement("input");for(s.type="hidden",s.name="subscribe",s.value=1,i=0;i<a.length;i++)a[i].appendChild(s)}r[0].focus(),passEvents()}),MG_Utils.addEventHandler(n,"click",function(){void 0!==signinbox.signInUtilModal&&signinbox.signInUtilModal.closeModal()})}}function loginAjaxModal(e,o,n){var t=n;if(XMLHttpRequest){var i=new XMLHttpRequest;i.open(o,e,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),i.onreadystatechange=function(){if(4===i.readyState)if(i.status>=200&&i.status<400){var e=JSON.parse(i.responseText);if("0"===i.response.success)return!1;if(e.twoStepVerification){var o=document.querySelectorAll(".js-loginFormModal")[1],n=document.querySelectorAll(".js-userVerificationModal")[1];if(o&&MG_Utils.addClass(o,"hidden"),n){MG_Utils.removeClass(n,"hidden");var t=n.querySelector("#userPhoneNumber"),r=n.querySelector("#enterVerificationCode"),a=n.querySelector("#btnVerifyCode"),s=n.querySelector("#verificationEnabledUsername"),l=n.querySelector("#verificationEnabledToken"),d=n.querySelector("#resendVerificationCode"),c=n.querySelector("#authyId");t&&(t.innerHTML=e.phoneNumber),s&&l&&(s.value=e.username,l.value=e.autoLoginParameter),c&&(c.value=e.authyId),r&&a&&(MG_Utils.addEventHandler(r,"keyup",function(e){""!==r.value?MG_Utils.hasClass(a,"disabled")&&MG_Utils.removeClass(a,"disabled"):MG_Utils.hasClass(a,"disabled")||MG_Utils.addClass(a,"disabled")}),MG_Utils.addEventHandler(document.querySelector("#modalWrapMTubes #btnVerifyCode"),"click",function(e){e.preventDefault(),MG_Utils.hasClass(document.querySelector("#modalWrapMTubes #btnVerifyCode"),"disabled")||loginTwoStepVerificationEnabled()}),MG_Utils.addEventHandler(r,"keydown",function(e){var o=e.which||e.keyCode;13===o&&(e.preventDefault(),MG_Utils.hasClass(a,"disabled")||loginTwoStepVerificationEnabled()),69===o&&e.preventDefault()})),d&&MG_Utils.addEventHandler(d,"click",function(e){e.preventDefault();var o=c.value,n=document.querySelector("#modalWrapMTubes #xsrfToken"),t=document.querySelector("#modalWrapMTubes .resendCodeResponse");if(n){var i=n.value;$j.ajax({type:"POST",url:TOP_BODY.urlResendCode,dataType:"json",data:{authyId:o,token:i},success:function(e){t&&(MG_Utils.removeClass(t,"hidden"),"success"!=e.status?(MG_Utils.addClass(t,"verificationError"),$j(t).find(".resendCodeStatus").text(e.status+":"),$j(t).find(".resendCodeMessage").text(e.message+" "+PAGE_LAYER.tryAgainMessage)):(MG_Utils.hasClass(t,"verificationError")&&MG_Utils.removeClass(t,"verificationError"),MG_Utils.addClass(t,"verificationSuccess"),$j(t).find(".resendCodeStatus").text(e.status+":"),$j(t).find(".resendCodeMessage").text(e.message),setTimeout(function(){MG_Utils.addClass(t,"hidden")},3e3)))},error:function(e){alert(TOP_BODY.ajaxError),document.location.reload()}})}})}}else callbackSuccess(e)}else callbackFailed()},i.send(t)}}function loginTwoStepVerificationEnabled(){$j.ajax({type:"POST",url:TOP_BODY.twoStepVerificationLogin,data:$j("#modalWrapMTubes .js-userVerificationModal").serialize(),success:function(e){var o=document.querySelector("#modalWrapMTubes .twoStepVerificationMessage");o&&MG_Utils.removeClass(o,"hidden"),"0"!=e.success?(o&&MG_Utils.hasClass(o,"verificationError")&&MG_Utils.removeClass(o,"verificationError"),MG_Utils.addClass(o,"verificationSuccess"),o.innerHTML=TOP_BODY.verificationSuccessfulMessage+"...",callbackSuccess(e)):""!=e.message&&o?(MG_Utils.addClass(o,"verificationError"),o.innerHTML=e.message):""==e.message&&(alert(TOP_BODY.ajaxError),document.location.reload())},error:function(e){alert(TOP_BODY.ajaxError),document.location.reload()}})}function callbackSuccess(o){var n=document.querySelectorAll(".singupModalWrapper")[1],t=n.querySelector("#signinLoggingin"),i=n.querySelector(".signinError");if("0"==o.premium_redirect_cookie){if(o.showExpiredFreeTrial||o.showExpiredModal){return void("1"===expired_modal.getCookie()?document.location.assign(o.redirectToPH):(expired_modal.startPremiumUrl=o.takeFreePremiumUrl,expired_modal.noThanksBtnUrl=o.redirectToPH,expired_modal.segment=o.segment,expired_modal.isExpiredPromoUser=o.showExpiredModal,expired_modal.showExpiredPromoModal()))}o.redirect?(t.style.display="block",i.style.display="none",void 0!==o.subscribe&&1==o.subscribe?(document.querySelector(".subscribeButton button.login").setAttribute("data-login","0"),subscribeAjax(e,document.querySelector(".subscribeButton button.login"),"",!0,o.redirect)):document.location.assign(o.redirect)):(i.style.display="block",i.innerHTML=o.message)}else{var r=new Date,a=premiumRedirectCookieURL+(premiumRedirectCookieURL.indexOf("?")>0?"&":"?")+"timestamp="+r.getTime(),s=new XMLHttpRequest;s.withCredentials=!0,s.open("GET",a,!0),s.onreadystatechange=function(){4===this.readyState&&this.status>=200&&this.status<400&&(o.redirect?(t.style.display="",i.style.display="none",document.location.assign(o.redirect)):(i.style.display="",i.innerHTML=o.message))},s.send(),s=null}}function callbackFailed(){location.reload}function collectLoginData(e){for(var o={},n=0;n<e.length;n++){var t=e.item(n);o[t.name]=encodeURIComponent(t.value)}return"redirect="+o.redirect+"&token="+o.token+"&remember_me="+o.remember_me+"&from="+o.from+"&username="+o.username+"&password="+o.password+"&subscribe="+o.subscribe}function passEvents(){var e=document.querySelectorAll(".singupModalWrapper")[1];if(null!=e){var o=e.querySelectorAll(".signup_field"),n=e.querySelector('[type="checkbox"]'),t=e.querySelector('[name="remember_me"]'),r=e.querySelector(".js-signinUsernameModal"),a=e.querySelector(".js-signinPasswordModal"),s=e.querySelector(".js-loginSubmitModal"),l=e.querySelector(".js-loginFormModal").elements,d=!1;for(i=0;i<o.length;i++)MG_Utils.addEventHandler(o[i],"focus",function(){signinbox.inputFocused=!0}),MG_Utils.addEventHandler(o[i],"blur",function(){signinbox.inputFocused=!1});MG_Utils.addEventHandler(n,"click",function(){t.value=n.checked?1:0}),MG_Utils.addEventHandler(s,"click",function(e){e.preventDefault?e.preventDefault():e.returnValue=!1,loginAjaxModal("/front/authenticate","POST",collectLoginData(l))}),MG_Utils.addEventHandler(r,"keydown",function(e){var o=e.which||e.keyCode;d?d&&13!=o&&(d=!1):13==o&&(loginAjaxModal("/front/authenticate","POST",collectLoginData(l)),d=!0)}),MG_Utils.addEventHandler(a,"keydown",function(e){var o=e.which||e.keyCode;d?d&&13!=o&&(d=!1):13==o&&(loginAjaxModal("/front/authenticate","POST",collectLoginData(l)),d=!0)})}}var signinbox={logCount:0,doingLogin:!1,inputFocused:!1,containerWidth:889,signInUtilModal:{},show:function(e){var o=document.getElementById("signinModal"),n=window.location.href.indexOf("awards/nominees")>-1?document.querySelectorAll(".voteList"):document.getElementById("headerLoginLink");if(navigator.userAgent&&navigator.userAgent.match(/PLAYSTATION/))return document.location.assign("http://"+location.hostname+"/login"),!1;if("block"!=o.style.display&&null!=n){openModal(e),appendedTasteProfile("js-tasteProfileLoginModal");document.getElementById("usernameModal").focus()}},hide:function(){document.querySelectorAll(".signinError").style.display="none",document.querySelectorAll(".js-signinUsernameModal").value="",document.getElementById("js-signinPasswordModal").value="",document.getElementById("js-redirect").value=""}},expired_modal={premiumPromoModal:document.getElementById("premium-promo-modal"),isExpiredPromoUser:!1,startPremiumUrl:"",noThanksBtnUrl:"",segment:"",promoUser:"",init:function(){this.premiumPromoModal&&(this.promoModal=new MG_Modal({content:this.premiumPromoModal,className:"premiumPromoModalContainer"}))},showExpiredPromoModal:function(){var e=this,o="gay"===this.segment?"promoModalWrapperGay":"promoModalWrapperStraight",n=this.isExpiredPromoUser?"promoModalWrapperExpired":"";signinbox.signInUtilModal.closeModal(),setTimeout(function(){e.promoModal.openModal(),e.setCookies(),$j(".premiumPromoModalContainer .promoModalWrapper").addClass(o),$j(".premiumPromoModalContainer .promoModalWrapper").addClass(n),e.attachHandlers()},0)},attachHandlers:function(){var e=this;$j(".premiumPromoModalContainer #promoStartfreeweek").on("click",function(){document.location.assign(e.startPremiumUrl)}),$j(".premiumPromoModalContainer #promoCancelFreeWeek, .premiumPromoModalContainer .closeMTubes").on("click",function(){document.location.assign(e.noThanksBtnUrl)})},getCookie:function(){return $j.cookie("valentine_promo_modal")},setCookies:function(){$j.cookie("valentine_promo_modal",1,{path:"/"})}};MG_Utils.domReady(function(){document.location.search.match(/showSigninBox=true/i)&&null!=document.getElementById("headerLoginLink")&&signinbox.show(),expired_modal.init()});