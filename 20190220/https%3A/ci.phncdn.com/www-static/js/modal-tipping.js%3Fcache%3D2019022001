function toJson(e){return JSON.parse('{"'+decodeURI(e).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}MG_Utils.domReady(function(){function e(){if(l())if(selectedAmountNumber=a(),f.closeModal(),MODEL_PROFILE.requestLast4){if(MODEL_PROFILE.requestLast4){if(y.openModal(),u(y),selectedAmountNumber&&selectedAmountNumber>0){var e=document.querySelectorAll(".tipsDigitsContent .modelTipAmount"),r=document.querySelector(".tipsDigitsContent #selectedAmountValue");e[1].innerHTML=selectedAmountNumber,r.value=selectedAmountNumber}var s=document.querySelector(".tippingDigitsModal .formTipsDigits .button"),c=document.getElementById("js-digits"),d=document.getElementById("js-digitsLink"),m=document.querySelectorAll(".formTipsDigits")[1];E=toJson($j(m).serialize()),c&&c.addEventListener("keyup",i,!1),s&&MG_Utils.addEventHandler(s,"click",function(e){e.preventDefault(),o(e)}),d&&MG_Utils.addEventHandler(d,"click",function(e){e.preventDefault(),E&&t(E)})}}else{if(O.openModal(),u(O),selectedAmountNumber&&selectedAmountNumber>0){var e=document.querySelectorAll(".tipsNoDigitsContent .modelTipAmount"),r=document.querySelector(".tipsNoDigitsContent #selectedAmountValueNoDigits");e[1].innerHTML=selectedAmountNumber,r.value=selectedAmountNumber}var s=document.querySelector(".tippingNoDigitsModal .formTipsNoDigits .button"),m=document.querySelectorAll(".formTipsNoDigits")[1],p=document.getElementById("js-buyLink"),E=toJson($j(m).serialize());s&&MG_Utils.addEventHandler(s,"click",function(e){e.preventDefault(),E&&n(E)}),p&&MG_Utils.addEventHandler(p,"click",function(e){e.preventDefault(),E&&t(E)})}}function t(e){var t={newCC:!0,username:MODEL_PROFILE.username,amount:e.amount};MODEL_PROFILE&&MODEL_PROFILE.viewkey&&MG_Utils.extendSimple(t,{viewkey:MODEL_PROFILE.viewkey}),MG_Utils.ajaxCall({url:MODEL_PROFILE.urlFor,type:"POST",data:t,success:function(e){if(!e.error&&e.redirectUrl.length>0)window.location=e.redirectUrl;else{document.getElementById("js-regularTip").innerHTML=e.message}}})}function n(e){var t={username:MODEL_PROFILE.username,amount:e.amount};MODEL_PROFILE&&MODEL_PROFILE.viewkey&&MG_Utils.extendSimple(t,{viewkey:MODEL_PROFILE.viewkey}),MG_Utils.ajaxCall({url:MODEL_PROFILE.urlFor,type:"POST",data:t,success:function(e){if(!e.error&&e.redirectUrl.length>0)window.location=e.redirectUrl;else{document.getElementById("js-regularTip").innerHTML=e.message}}})}function i(e){if(e.keyCode>=65&&e.keyCode<=90||190==e.keyCode||69==e.keyCode)e.preventDefault(),e.target.value="";else{if(e.target!==e.currentTarget){e.target.value.length>1&&(e.target.value=e.target.value.substr(0,1))}if(8!=e.keyCode&&46!=e.keyCode){e.target.nextElementSibling.focus()}}}function o(e){var t=document.getElementById("js-digits"),n=document.getElementById("js-last4Err"),i=[];if(t&&[].forEach.call(t.elements,function(t){return""==t.value||t.value==t.defaultValue?(e.preventDefault(),n.innerHTML=MODEL_PROFILE.errorLast4,!1):(i.push(t.value),n.innerHTML="",i)}),i&&4==i.length){n.innerHTML="";var o=document.querySelector("#lastFourDigits");o.value=i.join(""),joinedDigits=o.value,amount=document.getElementById("selectedAmountValue").value,form=document.querySelector(".tippingDigitsModal .formTipsDigits"),serialize=toJson($j(form).serialize()),serialize&&r(serialize)}}function r(e){var t=document.getElementById("js-last4Err"),n={username:MODEL_PROFILE.username,amount:e.amount,last4:joinedDigits};MODEL_PROFILE&&MODEL_PROFILE.viewkey&&MG_Utils.extendSimple(n,{viewkey:MODEL_PROFILE.viewkey}),MG_Utils.ajaxCall({url:MODEL_PROFILE.urlFor,type:"POST",data:n,success:function(e){e.error?t.innerHTML=e.message:(t.innerHTML="",window.location.href=e.redirectUrl)}})}function l(){var e=document.querySelector('.tips .inputBox input[type="radio"]:checked'),t=e.parentElement,n=!0;if(e.classList.contains("js-tipOther")){var i=t.querySelector(".inputTipOther").value;if(/^\d+$/.test(i)){var o=parseInt(i);n=o>0&&o<=150}else n=!1;n?(t.querySelector(".inputTipOther").classList.remove("error"),t.querySelector(".tipAmount").innerHTML=i):(t.querySelector(".inputTipOther").classList.add("error"),t.querySelector(".inputTipOther").value="")}return n}function a(){var e=document.querySelectorAll(".tips .inputBox label"),t=0;return e&&[].forEach.call(e,function(e){var n=e.querySelector('input[type="radio"]');if(n&&n.checked){var i=e.querySelector(".tipAmount").innerHTML;if(i)return t=Number(i.replace(/[^0-9\.-]+/g,"")),!1}}),t}function s(e){e.preventDefault();var t=this;if(parentElement=MG_Utils.closest(t,".subscribeButtonWrapper"),allElement=parentElement.getAttribute("data-button-id"),toggleUrl=0===parseInt(t.getAttribute("data-subscribed"))?t.getAttribute("data-subscribe-url"):t.getAttribute("data-unsubscribe-url"),loggedIn=parseInt(t.getAttribute("data-login")),refresh=parseInt(t.getAttribute("data-refresh")),0!==loggedIn){c.openModal();var n=document.querySelector("#modalWrapMTubes.loginModal");if(loginForm=n.querySelector(".tippingLoginForm"),n){var i=n.querySelector(".js-buttonLogin");loginForm.querySelector("h2")||loginForm.insertBefore(document.createElement("h2"),loginForm.firstChild);var o=loginForm.querySelector("h2");o&&(o.innerHTML=MODEL_PROFILE.loggedOutText),i&&MG_Utils.addEventHandler(i,"click",login.addLoginFunctionality(loginForm,MG_Utils.previousElementSibling(loginForm)))}}else MG_Utils.ajaxCall({url:toggleUrl,type:"POST",success:function(e){"PASS"==e.success?(0===parseInt(t.getAttribute("data-subscribed"))?(t.setAttribute("data-subscribed",1),MG_Utils.removeClass(parentElement,"subscribe"),MG_Utils.addClass(parentElement,"unsubscribe"),t.innerHTML=MODEL_PROFILE.subscribedText):(t.setAttribute("data-subscribed",0),MG_Utils.removeClass(parentElement,"unsubscribe"),MG_Utils.addClass(parentElement,"subscribe"),t.innerHTML=MODEL_PROFILE.unsubscribedText),1===refresh&&location.reload()):t.setAttribute("disabled",1)}})}function u(e){MG_Utils.addEventHandler(e.closeButton,"click",function(){ga("send","event",e.options.className,"click","Closed Modal")})}var c,d=document.querySelector(".js-tipsModal"),m=document.querySelector(".js-tipsSuccess"),p=document.querySelector(".js-tipsDigits"),E=document.querySelector(".js-tipsNoDigits"),M=document.getElementById("js-tipsTrigger"),g=document.querySelector(".js-failedModal"),f=new MG_Modal({content:d,className:"tippingModal",closeButton:!0}),L=new MG_Modal({content:m,className:"tippingSuccessfulModal",closeButton:!0}),y=new MG_Modal({content:p,className:"tippingDigitsModal",closeButton:!0}),O=new MG_Modal({content:E,className:"tippingNoDigitsModal",closeButton:!0});if("undefined"!=typeof signinbox&&(c=signinbox),g)var v=new MG_Modal({content:g,className:"failedModal",closeButton:!0});var _="undefined"!=typeof MODEL_PROFILE?MODEL_PROFILE.price:null;if(_&&"undefined"!=typeof MODEL_PAGE&&"declined"!==MODEL_PAGE.transactionStatus&&1==MODEL_PAGE.isTip&&(document.getElementById("transactionPrice").innerText=_,L.openModal(function(){"undefined"!=typeof MODEL_PROFILE&&void 0!==MODEL_PROFILE.modelProfileLink&&(L.modal.querySelector(".btnModelProfile").href=MODEL_PROFILE.modelProfileLink)})),"undefined"!=typeof MODEL_PAGE&&MODEL_PAGE.transaction&&void 0!==v&&"declined"==MODEL_PAGE.transactionStatus){if(v.openModal(ga("send","event","Tipping Failed Modal","click","Modal Shown")),document.getElementById("js-closeFailed")){var D=document.getElementById("js-closeFailed");MG_Utils.addEventHandler(D,"click",function(){v.closeModal(),"function"==typeof checkPlatform&&"pc"===checkPlatform().mode&&(window.location=window.location.href.split("?")[0])})}if(document.getElementById("js-retryPurchase")){var b=document.getElementById("js-retryPurchase");MG_Utils.addEventHandler(b,"click",function(){error=document.querySelector(".js-failedError");var e={username:MODEL_PROFILE.username,amount:MODEL_PAGE.tipAmount};MODEL_PROFILE&&MODEL_PROFILE.viewkey&&MG_Utils.extendSimple(e,{viewkey:MODEL_PROFILE.viewkey}),MG_Utils.ajaxCall({url:MODEL_PROFILE.urlFor,type:"POST",data:e,success:function(e){e.error?error.innerHTML=e.message:(error.innerHTML="",window.location.href=e.redirectUrl)}})})}}var S=function(){f.openModal(),u(f);var t=document.querySelector(".tippingModal.elOpenMTubes"),n=t.querySelectorAll(".inputBox label");if(n)for(var i=0;i<n.length;i++)MG_Utils.addEventHandler(n[i],"click",function(e){checkoutButton=document.querySelector(".tippingModal .tips .button"),checkoutButton&&MG_Utils.addClass(checkoutButton,"checkoutEnabled")});if(t){var o=t.querySelector(".js-tipOther"),r=t.querySelector(".tipOtherCaption");MG_Utils.addEventHandler(o,"click",function(e){r.querySelector(".tipAmount").style.display="none",r.querySelector(".inputTipOther").style.display="block"}),MG_Utils.addEventHandler(r.querySelector(".inputTipOther"),"keydown",function(t){13==t.keyCode&&(t.preventDefault(),e())});var l=t.querySelector(".button");l&&MG_Utils.addEventHandler(l,"click",function(t){t.preventDefault(),e()})}};"undefined"!=typeof MODEL_PROFILE&&MODEL_PROFILE.loggedIn&&localStorage.getItem("tipsClicked")==window.location.pathname+(window.location.search?window.location.search:"")&&(S(),localStorage.removeItem("tipsClicked")),M&&MG_Utils.addEventHandler(M,"click",function(e){e.preventDefault(),MODEL_PROFILE.loggedIn?S():(MG_Utils.hasStorage()&&localStorage.setItem("tipsClicked",window.location.pathname+(window.location.search?window.location.search:"")),c.show(textPHTranslation.loginTitleToTip))}),"undefined"!=typeof MODEL_PROFILE&&MODEL_PROFILE.loggedIn&&"#tip"===window.location.hash&&(!function(){var e=window.location;"pushState"in history?history.pushState("",document.title,e.pathname+e.search):e.hash=""}(),S());var I=document.querySelector(".subscribeButtonWrapper button");I&&MG_Utils.addEventHandler(I,"click",s)});