function initCaptcha(){var e=document.querySelectorAll(".g-recaptcha");if(e.length>0)for(var r=0;r<e.length;r++)grecaptcha.render(e[r],{sitekey:purchaseFlow_LoginSignup_Params.signupSitekey,theme:"dark",callback:verifiedCallback})}function verifiedCallback(){recaptchaComplete=!0}var PurchaseFlow_LoginSignup=function(){"use strict";var e=this;e.defaultSettings={timer:null,idleTime:500,signup_errors:{}},e.init=function(r){e.params=e.getExtendedObject(e.defaultSettings,r)},e.getExtendedObject=function(e,r){var a={};return Object.keys(e).forEach(function(r){a[r]=e[r]}),Object.keys(r).forEach(function(e){a[e]=r[e]}),a},e.addListeners=function(r,a){(a||"true"==a)&&MG_Utils.addClass(r.querySelector(".pf_signup_recaptcha"),"active"),MG_Utils.addClass(r,"leave_confirmation"),r.querySelector(".js_cancel_leave_modal").parentElement.setAttribute("data-previousModal","login_signup_modal");var s=r.querySelectorAll(".login_signup_tabs_item");[].forEach.call(s,function(e){MG_Utils.addEventHandler(e,"click",function(e){MG_Utils.removeClassMultiple(s,"active_tab"),MG_Utils.addClass(e.target,"active_tab");var a=r.querySelectorAll(".login_signup_content_wrap .login_signup_content"),t=r.querySelector("#"+e.target.getAttribute("data-tabid"));MG_Utils.removeClassMultiple(a,"active"),MG_Utils.addClass(t,"active")})}),e.addLoginListeners(r),e.addSignupListeners(r),e.signup_initCaptcha(r)},e.addLoginListeners=function(r){MG_Utils.addEventHandler(r.querySelector(".js_purchase_flow_login"),"click",function(a){MG_Utils.hasClass(a.target,"disabled")||e.handleLoginAjax(r,r.querySelector(".js_pf_login_username").value,r.querySelector(".js_pf_login_password").value,a.target)});var a=r.querySelectorAll(".pf_login_input");[].forEach.call(a,function(a){["keyup","input","keypress"].forEach(function(s){MG_Utils.addEventHandler(a,s,function(a){""!=r.querySelector(".js_pf_login_username").value&&""!=r.querySelector(".js_pf_login_password").value&&(MG_Utils.removeClass(r.querySelector(".js_purchase_flow_login"),"disabled"),"keyup"==s&&"13"==a.keyCode&&e.handleLoginAjax(r,r.querySelector(".js_pf_login_username").value,r.querySelector(".js_pf_login_password").value,r.querySelector(".js_purchase_flow_login")))})})})},e.addSignupListeners=function(r){e.signupInputs={email:r.querySelector(".js_pf_signup_email"),username:r.querySelector(".js_pf_signup_username"),password:r.querySelector(".js_pf_signup_password")},["keyup","input","keypress"].forEach(function(a){["email","username","password"].forEach(function(s){MG_Utils.addEventHandler(e.signupInputs[s],a,function(t){""!=t.target.value&&(e.signup_isInputValid(s,t.target,r)&&e.idleTimeoutValidation(function(){e.signup_backendCheckSetup(t.target,s,r)}),"keyup"!=a||"13"!=t.keyCode||MG_Utils.hasClass(r.querySelector(".js_purchase_flow_signup"),"disabled")||e.signup_submitAjax(r.querySelector(".js_purchase_flow_signup"),r))})})}),["email","username","password"].forEach(function(a){MG_Utils.addEventHandler(e.signupInputs[a],"focus",function(s){""!=s.target.value&&e.params.signup_errors[a]&&(r.querySelector(".fanclub_signup_form .error_message").innerHTML=e.params.signup_errors[a])})}),MG_Utils.addEventHandler(r.querySelector(".js_purchase_flow_signup"),"click",function(a){MG_Utils.hasClass(a.target,"disabled")||e.signup_submitAjax(a.target,r)})},e.handleLoginAjax=function(r,a,s,t){var i=r.querySelector(".js_pf_login_remember").checked,n=r.querySelector(".js_pf_login_redirect").value;MG_Utils.ajaxCall({type:"POST",url:t.getAttribute("data-submit_url"),data:{token:e.params.token,username:a,password:s,remember_me:i,modelId:t.getAttribute("data-model_id"),login:1,redirect:n},success:function(e){var a=t.getAttribute("data-purchase_flow_type");if("1"===e.success||"PASS"==e.success)if(MG_Utils.removeClassMultiple(r.querySelectorAll(".error_message"),"active"),MG_Utils.removeClassMultiple(r.querySelectorAll(".pf_login_input"),"error"),r.querySelector(".error_message").innerHTML="",MG_Utils.addClass(r.querySelector(".fanclub_login_form .success_message"),"active"),e.last4Required)if("fanclub"==a){fanclubPurchaseFlow.openSelectedModal(".last_digits_modal",r);var s=r.querySelector(".last_digits_modal");s.querySelector(".last_digits_avatar").setAttribute("src",e.thumbnail),s.querySelector(".last_digits_top_username").innerHTML=e.username,void 0!==e.dismissUrl&&(fanclubPurchaseFlow.params.dismissUrl=e.dismissUrl),void 0!==e.responseData&&void 0!==e.responseData.autoLoginParameter&&(fanclubPurchaseFlow.params.premiumUserInfo=e.responseData.autoLoginParameter),r.querySelector(".js_cancel_leave_modal").parentElement.setAttribute("data-previousModal","last_digits_modal")}else"customVideo"==a&&customVideoPurchaseFlow.handleAfterLoginSignup(r,e,e.last4Required);else"fanclub"==a?e.isAlreadyFan?(fanclubPurchaseFlow.openSelectedModal(".already_fan_modal",r),r.querySelector(".already_fan_send_tip").setAttribute("data-url",e.tipUrl),MG_Utils.removeClass(r,"leave_confirmation"),MG_Utils.addClass(r,"reload_on_close"),void 0!==e.dismissUrl&&(fanclubPurchaseFlow.params.dismissUrl=e.dismissUrl),void 0!==e.responseData&&void 0!==e.responseData.autoLoginParameter&&(fanclubPurchaseFlow.params.premiumUserInfo=e.responseData.autoLoginParameter)):void 0!==e.redirectUrl&&(window.location.href=e.redirectUrl):"customVideo"==a&&customVideoPurchaseFlow.handleAfterLoginSignup(r,e);else r.querySelector(".fanclub_login_form .error_message").innerHTML=e.message,MG_Utils.addClass(r.querySelector(".fanclub_login_form .error_message"),"active"),MG_Utils.addClassMultiple(r.querySelectorAll(".pf_login_input"),"error")}})},e.signup_backendCheckSetup=function(r,a,s){e.signup_ajaxCheck(r,a,r.value,s)},e.signup_hideError=function(r,a,s){MG_Utils.removeClass(r,"invalid"),e.params.signup_errors[a]&&delete e.params.signup_errors[a],Object.keys(e.params.signup_errors).length>0?s.querySelector(".fanclub_signup_form .error_message").innerHTML=e.params.signup_errors[Object.keys(e.params.signup_errors)[0]]:(MG_Utils.removeClass(s.querySelector(".fanclub_signup_form .error_message"),"active"),s.querySelector(".fanclub_signup_form .error_message").innerHTML="")},e.signup_ajaxCheck=function(r,a,s,t){var i={token:e.params.token,redirect:"",check_what:a};i[a]=s,MG_Utils.ajaxCall({type:"POST",url:e.params.checkInputAjax,data:i,success:function(s){""!==s.error_message?e.signup_putError(r,a,s.error_message,t):(e.signup_makeElementValid(r,a,t),e.signup_validateForm(t))},error:function(){console.log("Network Error!")}})},e.idleTimeoutValidation=function(r){e.params.timer&&clearTimeout(e.params.timer),e.params.timer=setTimeout(function(){r()},e.params.idleTime)},e.signup_isInputValid=function(r,a,s){switch(r){case"email":return e.signup_isEmailValid(a,s);case"username":return e.signup_isUsernameValid(a,s);case"password":return e.signup_isPasswordValid(a,s)}},e.signup_isEmailValid=function(r,a){return/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(r.value)?r.value.length<5?(e.signup_putError(r,"email",e.params.errorMsg.emailTooShort,a),!1):!(r.value.length>50&&(e.signup_putError(r,"email",e.params.errorMsg.emailTooLong,a),1)):(e.signup_putError(r,"email",e.params.errorMsg.invalidEmail,a),!1)},e.signup_isUsernameValid=function(r,a){var s=a.querySelector(".js_pf_signup_password");return r.value.length<5?(e.signup_putError(r,"username",e.params.errorMsg.usernameTooShort,a),!1):r.value.length>18?(e.signup_putError(r,"username",e.params.errorMsg.usernameTooLong,a),!1):""==s.value||s.value!=r.value||(e.signup_putError(r,"username",e.params.errorMsg.usernamePasswordcantMatch,a),!1)},e.signup_isPasswordValid=function(r,a){var s=a.querySelector(".js_pf_signup_username");return r.value.length<6?(e.signup_putError(r,"password",e.params.errorMsg.passwordTooShort,a),!1):r.value.length>40?(e.signup_putError(r,"password",e.params.errorMsg.passwordTooLong,a),!1):""==s.value||s.value!=r.value||(e.signup_putError(r,"password",e.params.errorMsg.usernamePasswordcantMatch,a),!1)},e.signup_putError=function(r,a,s,t){s=void 0!==s?s:"",MG_Utils.addClass(t.querySelector(".js_purchase_flow_signup"),"disabled"),MG_Utils.removeClass(r,"valid"),MG_Utils.addClass(r,"invalid"),r.setAttribute("data-valid",!1),e.params.signup_errors[a]=s,s?(t.querySelector(".fanclub_signup_form .error_message").innerHTML=s,MG_Utils.addClass(t.querySelector(".fanclub_signup_form .error_message"),"active")):e.signup_getError(a,t)},e.signup_getError=function(r,a){e.params.signup_errors[r]&&(a.querySelector(".fanclub_signup_form .error_message").innerHTML=e.params.signup_errors[r],a.querySelector(".fanclub_signup_form .error_message").style.opacity=1)},e.signup_makeElementValid=function(r,a,s){MG_Utils.removeClass(r,"invalid"),MG_Utils.addClass(r,"valid"),r.setAttribute("data-valid",!0),e.signup_hideError(r,a,s)},e.signup_validateForm=function(e){var r=!1;"true"==e.querySelector(".js_pf_signup_email").getAttribute("data-valid")&&"true"==e.querySelector(".js_pf_signup_username").getAttribute("data-valid")&&"true"==e.querySelector(".js_pf_signup_password").getAttribute("data-valid")&&(r=!0),MG_Utils.hasClass(e.querySelector(".pf_signup_recaptcha"),"active")&&(r=!!recaptchaComplete),r?MG_Utils.removeClass(e.querySelector(".js_purchase_flow_signup"),"disabled"):MG_Utils.addClass(e.querySelector(".js_purchase_flow_signup"),"disabled")},e.signup_initCaptcha=function(e){if(0==document.querySelectorAll('script[src="https://www.google.com/recaptcha/api.js?onload=initCaptcha&render=explicit"]').length){var r=document.createElement("script");r.setAttribute("src","https://www.google.com/recaptcha/api.js?onload=initCaptcha&render=explicit"),r.setAttribute("type","text/javascript"),r.setAttribute("async",""),r.setAttribute("defer",""),document.head.appendChild(r)}},e.signup_submitAjax=function(r,a){var s=e.signupInputs.email.value,t=e.signupInputs.username.value,i=e.signupInputs.password.value;MG_Utils.ajaxCall({type:"POST",url:r.getAttribute("data-submit_url"),data:{token:e.params.token,email:s,username:t,password:i,modelId:r.getAttribute("data-model_id"),signup:1},success:function(e){if("PASS"==e.success||"1"===e.success){var s=r.getAttribute("data-purchase_flow_type");"fanclub"==s?void 0!==e.redirectUrl&&(window.location.href=e.redirectUrl):"customVideo"==s&&customVideoPurchaseFlow.handleAfterLoginSignup(a,e)}else a.querySelector(".fanclub_signup_form .error_message").innerHTML=e.message,e.showSignupCaptcha&&MG_Utils.addClass(a.querySelector(".pf_signup_recaptcha"),"active")}})}};try{var purchaseFlow_LoginSignup=new PurchaseFlow_LoginSignup;purchaseFlow_LoginSignup.init("undefined"!=typeof purchaseFlow_LoginSignup_Params?purchaseFlow_LoginSignup_Params:{})}catch(e){console.log("ERROR === Fanclub Purchase Flow ==="),console.log(e)}if("function"!=typeof initCaptcha)var recaptchaComplete;