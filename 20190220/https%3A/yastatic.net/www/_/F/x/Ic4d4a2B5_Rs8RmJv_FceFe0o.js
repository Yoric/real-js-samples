if(window.Ya&&Ya.Rum){Ya.Rum.sendTimeMark("2939.2154");}home.loadManager.subscribe("js",function(){var t;Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(t,e){"use strict";if(t===undefined||null===t)throw new TypeError("Cannot convert first argument to object");for(var s=Object(t),i=1;i<arguments.length;i++){var n=arguments[i];if(n!==undefined&&null!==n)for(var r=Object.keys(Object(n)),a=0,o=r.length;a<o;a++){var c=r[a],l=Object.getOwnPropertyDescriptor(n,c);l!==undefined&&l.enumerable&&(s[c]=n[c])}}return s}}),window.Ya=window.Ya||{},window.Ya.PageLayoutConfigController={currentMods:{},mediaList:[],init:function(t,e){var s=this;this.blockName=t,this.allMods=this.getAllMods(e),this.mediaList=e.map(function(t){var e=window.matchMedia(t.media);return e.addListener(function(){s.throttleChangeMods()}),{query:e,mods:t.mods}}),this.changeMods()},getAllMods:function(t){var e={};return t.forEach(function(t){Object.keys(t.mods).forEach(function(t){e[t]=!0})}),Object.keys(e)},throttleChangeMods:function(){var t=this;this.throttleTimeout?this.throttleCallHandlerOnTimeout=!0:(this.changeMods(),this.throttleTimeout=setTimeout(function(){delete t.throttleTimeout,t.throttleCallHandlerOnTimeout&&(t.throttleCallHandlerOnTimeout=!1,t.changeMods())},200))},changeMods:function(){var t=this.getEnabledMods(),e=this.updateState(t);e.changed&&(window.BEM?this.updateBemDom(e):this.updateNativeDom(e))},getEnabledMods:function(){return this.mediaList.reduce(function(t,e){var s,i=e.query.matches;return Object.keys(e.mods).forEach(function(n){s=e.mods[n],Array.isArray(s)?t[n]=s[Number(!i)]:i&&(t[n]=s)}),t},{})},updateState:function(t){var e,s=this,i={delClasses:{},addClasses:[],changed:!1};return i.mods=this.currentMods=this.allMods.reduce(function(n,r){return n[r]=t[r]||"",n[r]!==s.currentMods[r]&&(i.changed=!0,e=s.blockName+"_"+r+"_",s.currentMods[r]&&(i.delClasses[e+s.currentMods[r]]=!0),n[r]&&i.addClasses.push(e+n[r])),n},{}),i},updateBemDom:function(t){var e=$("."+this.blockName).bem(this.blockName);this.allMods.forEach(function(s){e.setMod(s,t.mods[s])}),e.trigger("layout:change",t.mods)},updateNativeDom:function(t){var e=document.getElementsByClassName(this.blockName)[0];e.className=e.className.split(" ").filter(function(e){return!t.delClasses[e]}).concat(t.addClasses).join(" ")}},BEM.DOM.decl("stream",{onSetMod:{js:function(){this.onError=this.onError.bind(this),this.__self.instance=this,this._history=BEM.blocks["stream-history"].get(),this._cms=BEM.blocks["stream-cms"].init(),this._storeBackendData(),this._initCoordinator(),this.bindKeyTo(window,"esc",function(){this.hasMod("visibility","visible")&&this.hide()})},visibility:{visible:function(){this._onShow(),this.trigger("show"),this.runClock(),this._sendMetriks(),this.hasMod("videohub","yes")||BEM.blocks["stream-rum"].sendTTI()},"":function(){this.trigger("hide"),this.stopClock(),this._onHide(),this._stopTimeMetriks(),BEM.blocks["stream-rum"].clear()}}},_sendMetriks:function(){var t=function(){for(var t=this._getMetrikaCounters()||[],e=0;e<t.length;e++)t[e].reachGoal("stream_opened"),this._sendTimeMetriks(t[e],[30,35,40])}.bind(this);Ya&&Ya.Metrika?t():(window.yandex_metrika_callbacks=window.yandex_metrika_callbacks||[]).push(t),window.home.gaCounter&&window.home.gaCounter.trackEther&&window.home.gaCounter.trackEther(),home.stat.logPath("tech","stream.show")},_sendTimeMetriks:function(t,e){this.timeMetriksId=e.map(function(e){return setTimeout(function(){t.reachGoal("time_"+e+"sec")},1e3*e)})},_stopTimeMetriks:function(){Array.isArray(this.timeMetriksId)&&this.timeMetriksId.forEach(function(t){clearTimeout(t)}),window.home.gaCounter&&window.home.gaCounter.stopTrackEther&&window.home.gaCounter.stopTrackEther()},_getMetrikaCounters:function(){var t={id:51697790,clickmap:!0,trackLinks:!0,accurateTrackBounce:!0};return this.params.settings.exp.stream_webvisor&&(t.webvisor=!0),[window.defaultMetrikaCounter,new Ya.Metrika(t)]},_initCoordinator:function(){this._coordinator=this.findBlockOn("stream-coordinator"),this.channel("stream").on("coordinatorUpdate",this._setLastChannel,this)},_setLastChannel:function(t,e){var s=e.channel&&e.channel.channel_id;s&&this._cms.setLastChannel(s)},_onShow:function(){this._history.setMod("player","opened")},_onHide:function(){var t=this.blockInside("suggest2");t&&t.clearInput(),this.afterCurrentEvent(function(){this._coordinator.exit()}),this._history.delMod("player"),this.channel("stream").trigger("hide")},getKind:function(){return"other"},onError:function(t){return this._cms.onError(t)},_storeBackendData:function(){var t=this.params.data||{},e=t.channels||[];e.length&&this._cms.storeChannels(e),t.programs&&t.programs.length&&this._cms.storePrograms(t.programs),t.vodEpisodes&&t.vodEpisodes.length&&this._cms.storeVodEpisodes(t.vodEpisodes),t.header_category&&t.header_category.length&&this._cms.storeCategories(t.header_category)},runClock:function(){this._clock=setTimeout(function(){this.periodicTask(),this.runClock()}.bind(this),5e3)},periodicTask:function(){},stopClock:function(){clearTimeout(this._clock)},show:function(){this.setMod("visibility","visible")},hide:function(){this.delMod("visibility")},_loadingElem:function(t,e){this.toggleMod(this.elem(t),"loading","yes","",e)},_hidingElem:function(t,e){this.toggleMod(this.elem(t),"hidden","yes","",e)},getDefaultParams:function(){return{data:{channels:[],programs:[],recomended:[]},count:10,settings:{exp:{}}}},_mergeLists:function(t){var e=[];return t.forEach(function(t){e=e.concat(t)}),e},liveProjectList:function(t,e){var s,i=!1,n=!1,r=this._cms.getChannelsByProjectAlias(t).map(function(t){var e=home.now()/1e3,s=t.meta&&t.meta.event_end_time;return i=i||t.catchup_age,n=n||t.has_vod,s&&e>=s?Promise.resolve(null):this._cms.getChannelOnlineProgram(t)},this);return Promise.all(r).then(function(r){if(s=r,!e&&i&&this.params.settings&&!this.params.settings.infiniteOnlineDisabled&&!(r=r.filter(function(t){return t&&!(t instanceof this._cms.VoidProgram)},this)).length)return this.infiniteProjectList(t);if(!e&&n&&this.params.settings&&!this.params.settings.infiniteVodDisabled){var a=home.now()/1e3;if(!(r=r.filter(function(t){if(!t)return!1;if(t instanceof this._cms.VoidProgram){var e=t.meta.nextProgram&&t.meta.nextProgram.start();if(!e||e<a||e-a>900)return!1}return!0},this)).length)return this.infiniteProjectVodList(t)}}.bind(this)).then(function(t){return t&&t.length?t:this._cms.interestSort(s)}.bind(this))},infiniteProjectList:function(t){var e,s=home.now()/1e3,i=[];return this._cms.getChannelsByProjectAlias(t).forEach(function(t){var n=t.meta||{};n.event_start_time&&(e=e?Math.min(n.event_start_time,e):n.event_start_time),n.event_end_time&&s>=n.event_end_time&&(s=n.event_end_time),i.push(t.content_id)}),this._justSeen&&(s=Math.min(this._justSeen.start()-1,s)),this._cms.getPrograms({parent_id:i,end_from:e||s-604800,start_to:s,noVoid:!0}).then(function(t){return t.reverse()})},infiniteProjectVodList:function(t){return this.getProjectVodEpisodes(t).then(function(t){if(this._justSeen){var e=-1;if(t.some(function(t,s){if(this._justSeen.eq(t))return e=s,!0},this),-1!==e)return t.slice(e+1)}return t}.bind(this))},projectEpisode:function(t){return this.liveProjectList(t).then(function(t){return this._justSeen=t[0],t[0]}.bind(this))},clearSeenCache:function(){this._justSeen=null},getProjectVodLibs:function(t){var e=this._cms.getChannelsByProjectAlias(t).filter(function(t){return t.has_vod}).map(function(t){return t.getVodLibs({recommended:!0})},this);return Promise.all(e).then(this._mergeLists.bind(this))},getProjectVodEpisodes:function(t){return this.getProjectVodLibs(t).then(function(t){var e=t.map(function(t){return this._cms.getVodEpisodes({parent_id:t.content_id,limit:20})},this);return Promise.all(e).then(this._mergeLists.bind(this)).then(function(t){return t.sort(function(t,e){return e.release_date_ut-t.release_date_ut})})}.bind(this))},setCacheTimer:function(t,e,s){clearInterval(this._cacheTimer[e]);var i=home.now()/1e3,n=Math.max(i,t-300);if(!(t<n)){var r=n+(t-n)*Math.random();this._cacheTimer[e]=setInterval(function(){home.now()/1e3>r&&(clearInterval(this._cacheTimer[e]),s(t))}.bind(this),1e3)}},destroyCacheTimer:function(t){clearInterval(this._cacheTimer[t]),delete this._cacheTimer[t]},updateChannels:function(){return this.channelsRendered?Promise.resolve():(this.channelsRendered=!0,this._cms.updateChannels().then(this.redrawChannels.bind(this))["catch"](function(t){t.originalMessage=t.message,t.message="updateChannels fail",this.onError(t)}.bind(this)))},redrawChannels:function(){var t=this.findBlockInside("stream-sidemenu");t&&t.updateChannelView()},_cacheTimer:{}},{get:function(t){return this.instance?Promise.resolve(this.instance):this.getStreamCms().then(function(e){return this.instance=BEM.DOM.append($(t),this.buildHtml(e)).bem("stream"),this.instance}.bind(this))},play:function(t,e){var s=e||{},i=this.getSettings();return i.exp.stream_preload_player&&Ya.streamPlayer.preloadScripts({version:i.playerVersion}),this.get(s.container).then(function(e){return BEM.blocks["stream-cms"].setSessionParams(s.programParams),this._setActivityDaysCookie(),t.channel_id||t.id||BEM.blocks["stream-rum"].setParams({playerCreate:!1,playerInit:!1,playerStart:!1}),t.origin="initial",e.updateChannels().then(function(){return e._coordinator.set(s.active,t).then(function(){return e.show()})})}.bind(this))},getClientData:function(){var t=home.getData("stream.stream")&&home.getData("stream.stream").clientData||{};if(!t||!t.settings){var e=new Error;return e.block="stream",e.sourceType="logic",e.message="getClientData: no clientData or settings",e.meta={clientData:t},null}return this.clientData=t,this.clientData},getStreamCms:function(){var t=this.getClientData();return t&&t.settings?BEM.blocks["stream-cms"].init(t.settings).updateChannels().then(function(){return t}):Promise.reject(error)},buildHtml:function(t){var e=BEM.blocks["stream-cms"].getChannels(),s=BEM.blocks["stream-cms"].getChannelsIcon();return t.channels=e,t.data["channel-icons"]=home.view("inline-channel-icon__data",{Stream:{icons:s}}),home.view("stream",t)},getSettings:function(){var t=this.getClientData();return t&&t.settings?t.settings:{}},getExp:function(){return this.getSettings().exp||{}},getInstance:function(){return this._instance||(this._instance=$(this.buildSelector()).bem(this.getName())),this._instance},_setActivityDaysCookie:function(){var t=this.getSettings().activityDaysCookieLink;(new Image).src=t}}),BEM.DOM.decl("stream",{onSetMod:{js:function(){this.__base.apply(this,arguments)},visibility:{visible:function(){this.params.settings.videohub||$("body").addClass("b-page_overflow_hidden b-page_content_hidden"),this.__base.apply(this,arguments)},"":function(){this.params.settings.videohub||$("body").removeClass("b-page_overflow_hidden b-page_content_hidden"),this.__base.apply(this,arguments)}}},getKind:function(){return"desktop"},show:function(){this._bindScroll(),this.__base.apply(this,arguments),home.error.setProject("ether")},hide:function(){this._unbindScroll(),this.__base.apply(this,arguments),home.error.restoreDefaultProject()},_setScrollElem:function(){this._scrollElem=this.domElem},_bindScroll:function(){this._setScrollElem(),this._onScrollTrottled||(this._onScrollTrottled=home.throttle(function(){var t=$(this._scrollElem).scrollTop();this._scrollTop=t,BEM.channel("stream").trigger("scroll",t)}.bind(this),100)),$(this._scrollElem).on("scroll",this._onScrollTrottled)},_unbindScroll:function(){$(this._scrollElem).off("scroll",this._onScrollTrottled)}},{live:function(){return this.liveBindTo("close","pointerclick",function(){this.hide()}),this.liveBindKey("close","space enter",function(){this.hide()}),this.__base()},play:function(t,e){var s=this.__base.bind(this);return this.get(e&&e.container).then(function(i){var n=(i.params.settings.exp||{}).stream_embed_autoplay&&(!e.active||"storefront"===e.active);return t.channel_id||t.id||!n||(t.channel_id="default"),s(t,e)})}}),BEM.DOM.decl("stream",{_getMetrikaCounters:function(){var t=home.getData("stream.trackings"),e=t&&t.metrikaId;return[new Ya.Metrika({id:e,clickmap:!0,trackLinks:!0,accurateTrackBounce:!0}),new Ya.Metrika({id:51697790,clickmap:!0,trackLinks:!0,accurateTrackBounce:!0})]}}),home=home||{},home.streamCmsExecuted||(home.streamCmsExecuted=!0,BEM.decl("stream-cms",{},{DOC2DOC_CACHE_TIME:12e4,init:function(){if(this._inited)return this;if(this.settings=this.settings||home.getData("stream.stream.clientData.settings"),!this.settings){var t=new Error;throw t.block="stream-cms",t.sourceType="logic",t.message="init: no settings",t}return this._patchHomeNow(),this.__apiUrl=this.settings.apiUrl+"/",this._inited=!0,this._declResourceTypes(),this._declDataStructures(),this._initStores(),this.fetchEpisodeQueue=new BEM.blocks["episode-queue"](this._fetchEpisodes.bind(this)),this.fetchVodQueue=new BEM.blocks["vod-queue"](this.fetchVodLibs.bind(this)),this},_declResourceTypes:function(){var t=this;this.GenericProgram=$.inherit({__constructor:function(e,s){for(var i in this.raw=e,e)e.hasOwnProperty(i)&&(this[i]=e[i]);this.channel=s,this._setupStreams(e.streams),this.meta=this.meta||{},t.settings.adsDisabled&&this.disableAds(),!s||!s.status.overlay||this instanceof t.VoidProgram||(this.meta.with_overlay=!0),this.checkSuperres(e.streams)&&(this.meta.superres=1)},disableAds:function(){this.ads=!1},ads:!0,_setupStreams:function(e){var s;if(e=e||[],!this.cameras){var i=e.reduce(function(i,n){var r,a;return"default"!==(r=(n=home.deepExtend({},n)).id||"default")&&s||(s=r),delete n.id,delete n.options,n.content_url&&!n.url&&(n.url=n.content_url,delete n.content_url),n.url||(n.url="",t.onError({message:"_setupStreams: no url in stream",meta:{content_id:this.content_id,content_type:this.content_type_name,streams:e}})),n.url=this._getUrl(n.url),(a=i.byId[r])||(a=i.byId[r]={streams:[],id:r},i.set.push(a)),n.title&&(a.title=n.title,delete n.title),a.thumbnail||(a.thumbnail=n.thumbnail||this.thumbnail),a.streams.push(n),i}.bind(this),{byId:{},set:[]});!i.byId["default"]&&s&&(i.byId["default"]=i.byId[s],delete i.byId[s]),this.cameras=i.byId,this._camerasArray=i.set,this._camerasArray.length?this.switchToCamera("default"):t.onError({message:"_setupStreams: no cameras",meta:{content_id:this.content_id,content_type:this.content_type_name,streams:e}})}},checkSuperres:function(e){var s;return!(t.settings.exp.lowres||!e)&&(e.map(function(t){t.options&&-1!==t.options.indexOf("hires")&&(s=1)},this),s)},constructUrl:function(e,s){s=s||{};var i,n=home.parseUrl(e),r=home.deepExtend({},n.query);return r.start<0||r.end<0?i="url":(s.end===Infinity||s.start<0||s.end<0)&&(i="params",delete s.end,delete s.start),delete r.end,delete r.start,n.query=home.deepExtend(r,s),i&&t.onError({message:"constructUrl: Infinity",meta:{errorType:i,resource:{content_id:this.content_id,content_type:this.content_type_name,start:this.start_time,end:this.end_time}}}),home.makeUrl(n)},_getUrl:function(t){return this.constructUrl(t)},getAdConfig:function(){var t;if(this.adConfig)return t=this.adConfig,this.ads||delete t.partner_id,this.customAdCategory&&(t.category=this.customAdCategory),t},getStreams:function(){var t=this._activeCam;return this.cameras[t||"default"].streams},getCredentials:function(){return this.channel&&this.channel.stream&&this.channel.stream.withCredentials},getHeartbeat:function(){var t=home.getData("stream.trackings");return[["https://mc.yandex.ru/watch/"+(t&&t.metrikaId)+"?page-url=yandexhbgoal.ru",{callsCount:1,delay:3e4}]]},getTrackings:function(){var e=BEM.blocks["stream-trackings"],s=t.getCurrentWatchingParams(),i=[e.getTrackings({content_id:s.content_id,channel_id:s.channel_id,stream_block:s.stream_block,from_block:t.getPleerAdditionalParams().from_block})],n=this._getOttTrackings(),r=this.getProgramTrackings();return n&&(i=i.concat(n)),r&&(i=i.concat(r)),{trackingEvents:i=i.concat({heartbeat:this.getHeartbeat()})}},_getOttTrackings:function(){var e;if(this.ottParams){try{e=window.Ya.OTT.buildTrackings(this.ottParams,{env:"production"}).trackingEvents}catch(s){s.originalMessage=s.message,s.message="getTrackings -> couldn't build ott trackings",s.meta={content_id:this.content_id},t.onError(s)}return e}},getProgramTrackings:function(){return this.stream&&this.stream.trackings&&this.stream.trackings.trackingEvents},getLogoConfig:function(){var t=this.watermark_logo||this.channel&&this.channel.watermark_logo;if(t)return{src:t,alwaysVisible:!0}},getContentId:function(){return this.content_id},start:function(){return this.fake_start_time||this.start_time},end:function(){return this.fake_end_time||this.end_time},is:function(t){return t>=this.start()-10&&t<=this.end()+10},fromFuture:function(){return this.start()>home.now()/1e3},screwTime:function(t){return t<this.start()-10&&t>=this.start_time?this.start_time-1:t>this.end()+10&&t<=this.end_time?this.end_time+1:t},canPlay:function(){return!0},hasVodLib:function(){return!!this.parent_vod_lib_id},getVodLib:function(){return this._lib?Promise.resolve(this._lib):this.hasVodLib()?t.getLibById(this.parent_vod_lib_id).then(function(t){return this._lib=t,this._lib}.bind(this)):Promise.reject({message:"no vodLib for episode"})},canRestart:function(t){return this.canPlay(t)},eq:function(t,e){return t&&t.content_id===this.content_id&&(e===undefined||this._activeCam===e)},getActiveCam:function(){return this._activeCam},getCameras:function(){return this._camerasArray},switchToCamera:function(t){if(!this.cameras[t||"default"])throw new RangeError("Camera "+t+" is unavailable");this._activeCam=t},getStickerpack:function(){var e=this.is(home.now()/1e3),s=this.channel||{},i=s.status||{},n=this.stickerpack||s.stickerpack||"default7",r=t.settings.exp.stream_emoji_hidden;return!(!e||!r&&!i.force_emoji||"disabled"===n)&&n},getThumbnail:function(){var e=(t.settings.exp||{}).stream_preview_episode_thumbnail,s=this instanceof t.VodProgram,i="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==",n=(this.channel||{}).thumbnail||i;return e&&(n=this.thumbnail||n),s&&(n=this.thumbnail||i),n},isForbidden:function(){var e=t.forbidden;return this.meta.forbidden||e[this.content_id]||this.parent_channel_id&&e[this.parent_channel_id]||this.parent_vod_lib_id&&e[this.parent_vod_lib_id]||this.parent_id&&e[this.parent_id]},getSourceConfig:function(e){return{protectedFrame:!0,streams:this.getStreams(),startPosition:e,adConfig:this.getAdConfig(),withCredentials:!!this.getCredentials(),trackings:this.getTrackings(),logoConfig:this.getLogoConfig(),preview:this.getThumbnail(),additionalParams:t.getPleerAdditionalParams()}}}),this.Program=$.inherit(this.GenericProgram,{canPlay:function(t){var e=this.start(),s=t-this.channel.catchup_age;return!this.blacked&&t>=e&&s<e},canRestart:function(e){return t.isPad?this.canPlay(e)&&this.end()<e:this.__base.apply(this,arguments)},_getUrl:function(t){return this.constructUrl(t,{start:this.start(),end:this.end()})}}),this.LiveProgram=$.inherit(this.GenericProgram,{is:function(t){return t>=this.start()-10&&t<=this.end()+10},canPlay:function(t){return this.start()<t&&t<this.end()},canRestart:function(){return!1}}),this.EpisodeConstructor=function(e,s){return s&&s.catchup_age?new t.Program(e,s):new t.LiveProgram(e,s)},this.VoidProgram=$.inherit(this.GenericProgram,{__constructor:function(t,e){t.streams=e.streams||[{url:e.content_url}],this.__base.apply(this,arguments),this.content_id="void"+Math.random(),this.content_type_name="void",this.title=e&&e.title||home.l10n("stream.notv")},getContentId:function(){var e=this.meta&&this.meta.nextProgram;if(e instanceof t.VoidProgram){var s=new Error("VoidProgram.getContentId: next program is Void");return s.meta={program:this.content_id,next:this.meta&&this.meta.nextProgram&&this.meta.nextProgram.content_id},home.error.logError({block:"stream",sourceType:"logic"},s),null}return e instanceof t.GenericProgram&&e.getContentId()},checkSuperres:function(){return!1},canPlay:function(){return!1}}),this.AnnouncePlug=$.inherit(this.LiveProgram,{__constructor:function(t,e,s){var i,n=t,r={};s&&(i=n.meta&&n.meta.announce_thumbnail||e&&e.meta&&e.meta.announce_thumbnail||t.thumbnail,home.deepExtend(r,n.raw||n),r.content_type_name="announce",r.content_id="announce_"+n.content_id,r.thumbnail=i,r.meta||(r.meta={}),r.meta.awaiting=t,r.meta.forbidden=n.isForbidden()),this.__base(r,e)},is:function(t){return t<=this.end()+10},_setupStreams:function(){this.cameras={"default":{streams:[{url:""}]}},this._camerasArray=[]},getContentId:function(){var e=this.meta||{},s=e.awaiting,i=e.playProgram;return s instanceof t.GenericProgram?s.getContentId():i instanceof t.GenericProgram?i.getContentId():void 0},canPlay:function(){return!1},getStickerpack:function(){return!1}}),this.VodProgram=$.inherit(this.GenericProgram,{__constructor:function(){this.__base.apply(this,arguments),this.updateSerialTitle()},updateSerialTitle:function(){var t=this.series;t&&(this.isSerial=!0,this.program_title=t.series_name,this.title=t.episode_name||this.title)},canPlay:function(){return!0},getCredentials:function(){return this.stream&&this.stream.withCredentials},getStickerpack:function(){return!1},getNeighbours:function(){return this.hasVodLib()?this.getVodLib().then(function(t){return t.getNeighbourFor(this)}.bind(this)):Promise.resolve([])}}),this._programTypes||(this._programTypes={}),this._programTypes.episode=this.EpisodeConstructor,this._programTypes["vod-episode"]=this.VodProgram,this._programTypes["void"]=this.VoidProgram,this.Channel=$.inherit({__constructor:function(e){for(var s in this.raw=e,e)e.hasOwnProperty(s)&&(this[s]=e[s]);this.status=this.__self.transformStatus(e.status),this.meta=e.meta||{},e.streams&&!t.settings.exp.lowres&&e.streams.forEach(function(t){t.options&&-1!==t.options.indexOf("hires")&&(this.meta.superres=1)},this)},isProjectChannel:function(){return Boolean(this.meta&&this.meta.project_alias)},getVodLibs:function(e){return(e=e||{}).parent_id=this.content_id,t.getVodLibs(e)}}),this.Channel.transformStatus=function(t){var e={};return t&&t.forEach(function(t){e[t]=1}),e},this.VodLibrary=$.inherit({__constructor:function(t,e){for(var s in t)t.hasOwnProperty(s)&&(this[s]=t[s]);this.includes&&this._storeLastEpisodes(),this.channel=e},getEpisodes:function(e){var s=home.deepExtend({},e);return s.parent_id=this.content_id,t.getVodEpisodes(s)},getNeighbourFor:function(e){return this.getEpisodes({limit:52}).then(function(s){var i,n;return n=(i=s.map(function(t){return t.content_id}).indexOf(e.content_id))>-1?[s[i+1],s[i-1]]:[],t.settings.exp.stream_first_series&&(n=n.reverse()),n})},_storeLastEpisodes:function(){var e=this.includes;e&&e.length&&t.storeVodEpisodes(e,{parent_id:this.content_id,limit:e.length}),delete this.includes},isForbidden:function(){return t.forbidden[this.content_id]}}),this.Carousel=$.inherit({__constructor:function(e){var s;for(var i in e)e.hasOwnProperty(i)&&(this[i]=e[i]);(s=this.carousel_id)&&(this._fetcher=function(e){var i={carousel_id:s,limit:e.limit,offset:e.offset};return t._fetchCarouselItems(i)}),this.storeIncludes()},storeIncludes:function(e){this.includes=this.includes||e||[],this.set=[],this.set=t._prepareCarouselItems(this.includes),this._paginator?this.store(this.set):this._paginator=new t.Paginator(this.set,this._fetcher),this.set=this.set.filter(Boolean),delete this.includes},get:function(t){return this._paginator.get(t)},store:function(t){this._paginator.store(t)}})},_declDataStructures:function(){var t=this,e=this.List=$.inherit({__constructor:function(){this._list=[]},push:function(t){this._list.push(t)},replace:function(t,e){for(var s=0,i=this._list.length;s<i;){if(this._list[s]===t)return void(this._list[s]=e);s++}},filter:function(t){this._list=this._list.filter(t)},get:function(e){var s,i=this._list;if(e.start_from){if(-1===(s=this._findBorder(i,"start_time",e.start_from)))return[];i=i.slice(s)}return e.start_to&&(s=this._findBorder(i,"start_time",e.start_to,!0),i=i.slice(0,s+1)),i.filter(function(s){if(!(e.noVoid&&s instanceof t.VoidProgram||e.end_from&&!(e.end_from<=s.end_time)||e.end_to&&!(e.end_to>=s.end_time)||e.program_id&&e.program_id!==s.program_id||e.genre&&e.genre!==s.genre||e.rating&&!(s.rating>=e.rating)))return!0})},sort:function(){this._list=this._list.sort(function(t,e){return t.start_time-e.start_time})},_findBorder:function(t,e,s,i){var n=-1,r=t.length;if(!t.length)return i?n:r;for(s<t[0][e]?r=0:s>t[r-1][e]&&(n=r-1);r-n>1;){var a=(r+n)/2|0,o=t[a][e];o===s?i?n=a:r=a:o<s?n=a:r=a}return i?n:r}});this.Storage=$.inherit({__constructor:function(t){this.itemById={},this._lists={},t&&this.store(t)},unbroken:function(t){if(!t)return[];for(var e=1,s=t.length;e<s&&t[e].start_time-t[e-1].end_time<30;)e++;return t.slice(0,e)},findMissingSegment:function(e,s){var i,n=e.start_from||e.end_from||-Infinity,r=e.start_to||e.end_to||Infinity,a=e.limit;if(s)s=s.filter(function(t){return t.end_time>=n&&t.start_time<=r});else{var o=home.deepExtend({},e);o.noVoid=!1,o.start_from=o.end_to=null,o.end_from=n,o.start_to=r,a&&(o.limit=0),s=this.getCached(o||e)}i=s.length-1;var c=function(t,e){this.start_time=t,this.end_time=e},l=[];if(!s.length||r<s[0].start_time||n>s[i].end_time)l=[new c(n,r)];else{n<s[0].start_time&&l.push(new c(n,s[0].start_time));for(var h=0;h<i;h++)l.push(s[h]),s[h].end_time<s[h+1].start_time&&l.push(new c(s[h].end_time,s[h+1].start_time));l.push(s[i]),s[i].end_time<r&&l.push(new c(s[i].end_time,r))}var m,d,u=0,_=!1,p=a||null;l.some(function(s){if(s instanceof c)_=!0,m=m||Math.max(s.start_time,n),d=Math.min(s.end_time,r);else{if(e.noVoid&&s instanceof t.VoidProgram)return;(!e.start_from||s.start_time>=e.start_from)&&(!e.end_to||s.end_time<=e.end_to)&&(_||(u++,a&&(p=Math.max(0,a-u))))}}),a&&u>=a&&(m=null,d=null),m===Infinity&&(m=null),d===Infinity&&(d=null);var g=[];return(m||d)&&(g=[m,d],p&&(e.start_from&&p++,e.end_to&&p++,g.push(p))),g},getCached:function(t){var e,s=t.limit,i=t.offset||0,n=t.parent_id;if(t.hasOwnProperty("content_id"))return[this.itemById[t.content_id]];n||(n=this._getListsKeys()),n instanceof Array||(n=[n]),e=[],n.forEach(function(s){e=e.concat(this._getList(s).get(t))},this),e.sort(function(t,e){return t.start_time-e.start_time});var r=e.length;return s&&(r=Math.min(r,i+s)),e.slice(i,r)},store:function(t){var e=this.itemById,s={};for(var i in t.forEach(function(t){var i=t.content_id,n=this._getList(t.parent_id);if(s[t.parent_id]=n,i&&e.hasOwnProperty(i)){var r=e[i];r.related&&(t.related=r.related),n.replace(r,t)}else n.push(t);this.itemById[t.content_id]=t},this),s)s[i].sort()},_getListsKeys:function(){return Object.keys(this._lists)},_getList:function(t){return this._lists[t]||(this._lists[t]=new e),this._lists[t]}}),this.Intervals=$.inherit(this.Storage,{store:function(t){var e,s=t.parent_id,i=this._getList(s);i.push(t),i.sort(),i=i.filter(function(t){if(e&&e.end_time>t.start_time&&(t.start_time=e.end_time),t.end_time>t.start_time)return e=t,!0}),this.list=i},forget:function(t){var e=t.parent_id;this._getList(e).filter(function(e){return e!==t})}}),this.Paginator=$.inherit({__constructor:function(t,e){this._set=t||[],this._fetcher=e||null,this._getting={}},get:function(t){var e=((t=t||{}).limit||0)+"_"+(t.offset||0);return this._getting[e]||(this._getting[e]=this._get(t,e).then(function(){return this._getInterval(t).filter(Boolean)}.bind(this),function(){delete this._getting[e]}.bind(this))),this._getting[e]},_get:function(t){var e=this._findMissing(t),s=Promise.resolve();return e&&this._fetcher&&(s=this._fetcher(e).then(function(t){this._store(t,e)}.bind(this))),s},store:function(t,e){return this._store(t,e)},_store:function(t,e){var s,i=(e=e||{}).limit,n=e.offset||0;i>(t=t||[]).length&&(s=n+t.length)!==this._remoteTotal&&(this._remoteTotal=s),t.forEach(function(t,e){this._set[e+n]=t},this)},_findMissing:function(t){var e,s,i,n=this._remoteTotal,r=n!==undefined,a=t.limit||0,o=t.offset||0,c=a;if(r&&a&&a+o>n&&(c=Math.max(n-o,0)),c)return s=c-(e=this._getInterval({limit:c,offset:o})).length,(i=this._findGap(e))[0]!==undefined?{limit:(s?c:i[1]+1)-i[0],offset:o+(i[0]||0)}:s?{limit:s,offset:o+(c-s)}:void 0},_findGap:function(t){var e,s=[];for(e=0;e<t.length;e++)t[e]===undefined&&(s[0]===undefined&&(s[0]=e),s[1]=e);return s},_getInterval:function(t){var e=(t=t||{}).limit||0,s=t.offset||0;return s||(s=0),e?this._set.slice(s,e+s):[]}})},_initStores:function(){this._channelsById={},this._channelsList=[],this._channelsIcon=[],this._programs=new this.Storage,this._intervals=new this.Intervals,this._vodLibs={byChannel:{},byId:{}},this._vodEpisodes={byId:{},byLib:{},byTag:{}},this._carousels={byId:{},paginators:{}}},storeChannels:function(t){if(!t)return[];this.storeChannelsIcon(t);var e=t&&(t.set||t);return e&&e.length?e.map(function(t){return"seriea"===t.project_alias&&(t.status=t.status||[],t.status.push("sport")),this.storeChannel(t,!0)},this):this.getAllChannels()},storeChannel:function(t,e){if(t){this.overrideChannel(t);var s=this._getStoredChannel(t.content_id),i=null;return e&&!s&&(i=this._addChannelToStore(t)),s&&(i=this._updateStoredChannel(s,t)),i}},_getStoredChannel:function(t){var e=this.getCachedChannels(),s=-1;return e.some(function(e,i){if(e.content_id===t)return s=i,!0}),e[s]},_addChannelToStore:function(t){var e=this.getCachedChannels(),s=new this.Channel(t);return e.push(s),this._channelsById[s.content_id]=s,s},_updateStoredChannel:function(t,e){return this._channelsByProjectAlias=null,t.status=this.Channel.transformStatus(e.status),t.blacked=e.blacked,t},getCachedChannels:function(){return this._channelsList||[]},getAllChannels:function(){return this.getCachedChannels().filter(function(t){return!t.status.disabled})},getChannels:function(){return this.getAllChannels().filter(function(t){return!t.status.hidden})},getVodChannels:function(){return this.getChannels().filter(function(t){return t.has_vod})},getChannelsByCategory:function(t,e){var s=this.getChannels()||[],i=home.deepExtend({},t),n=e||0,r=Object.keys(i),a=r.indexOf("popular");return s.sort(this.sortByWeight),s.forEach(function(t){var e=home.intersectionArrays(r,t.channel_category)[0],s=e?r.indexOf(e):-1;n&&-1!==a&&(-1===s||a<s)?(e="popular",n--):e&&i[e]||(e="other"),i[e].push(t)},this),i},sortByWeight:function(t,e){return(+e.weight||0)-(+t.weight||0)},sortByStartTime:function(t,e){return t.start_time-e.start_time},getChannelsByProjectAlias:function(t){return this._channelsByProjectAlias||(this._channelsByProjectAlias={},this.getAllChannels().forEach(function(t){var e=t.meta&&t.meta.project_alias;e&&(this._channelsByProjectAlias[e]||(this._channelsByProjectAlias[e]=[]),this._channelsByProjectAlias[e].push(t))}.bind(this))),this._channelsByProjectAlias[t]},getChannelById:function(t){return this.getAllChannels().filter(function(e){return""+e.channel_id==""+t})[0]},getChannelByAlias:function(t){return this.getAllChannels().filter(function(e){return e.alias===t})[0]},getChannelByContentId:function(t){return this._channelsById[t]},storeChannelsIcon:function(t){if(!t)return[];var e=t&&t.icons;return e&&e.length?(this._channelsIcon=e,e):this.getChannelsIcon()},getChannelsIcon:function(){return this._channelsIcon||[]},updateChannels:function(t){var e=this.getAllChannels();return!t&&e.length?Promise.resolve(e):this._fetchChannels().then(this.storeChannels.bind(this))},_fetchChannels:function(){var t="/portal/tvstream_json/channels";return this.ajax(t).then(function(t){return this._patchHomeNow(t.Timestamp),{set:t.set,icons:t.icons}}.bind(this),function(e,s,i){return home.error.logAjaxError({block:"stream",message:"_fetchChannels: ajax",url:t,source:"morda_proxy_channels"},e,s,i),[]})},getUserChannel:function(){var t,e=this.getChannels();return[this.settings.defaultChannelByFlag,this._lastUserChannel].some(function(s){return t=e.filter(function(t){return t.channel_id===""+s})[0]}),t},setLastChannel:function(t){this._lastUserChannel=t},getDefaultChannelProgram:function(){var t=this.getUserChannel();return t?this.getChannelOnlineProgram(t).then(function(t){return t&&t.canPlay(home.now()/1e3)?t:this._getOnlineRecommendedChannelProgram()}.bind(this)):this._getOnlineRecommendedChannelProgram()},_getOnlineRecommendedChannelProgram:function(){return this.getOnlineProgramsForTopChannels(1).then(function(t){return t[0]})},getOnlineProgramsForTopChannels:function(t,e){var s,i=[],n=this;return s=this.getChannels().sort(this.sortByWeight).map(function(t){return t.content_id}),e=e||Math.ceil(home.now()/1e3),function r(a){return n.getPrograms({parent_id:a,limit:1,end_from:e}).then(function(n){if(n=n.filter(function(t){return t.canPlay(e)}).sort(function(t,e){return(e.channel.weight||0)-(t.channel.weight||0)}),(i=i.concat(n)).length>=t||!s.length)return i.slice(0,t);if(s.length)return a=s.splice(0,t),r(a);if(!i.length){var o=new Error("getOnlineProgramsForTopChannels: no online programs");return Promise.reject(o)}return n})}(s.splice(0,t>5?2*t:10))},getChannelOnlineProgram:function(t){var e=home.now()/1e3|0;return this.getProgramFor(t.content_id,e).then(function(s){if(!s){var i=new Error("getChannelOnlineProgram: no online program for channel");return i.meta={id:t.content_id,time:new Date(1e3*e)},Promise.reject(i)}return s.is(e)?s:this.getProgramFor(t.content_id,s.screwTime(e))}.bind(this))},fetchResourceById:function(t){var e=this.__apiUrl+"player/"+t+".json";return this.ajax(e).then(function(t){t=t&&t.content||t;try{return this.storeResource(t)}catch(s){var e={parent_id:t.parent_id,content_type_name:t.content_type_name};return Promise.reject(home.deepExtend(s,{meta:e}))}}.bind(this),function(s,i,n){return home.error.logAjaxError({block:"stream",message:"fetchResourceById: ajax",url:e,source:"bk_by_id",meta:{id:t}},s,i,n),Promise.reject({message:"fetchResourceById: fail"})})},getProgramByResource:function(t){return"vod-library"===t.content_type_name?this.getVodEpisodes({parent_id:t.content_id,limit:1}).then(function(e){if(!e||!e[0]){var s=new Error("no program in vod-library");return s.meta={content_id:t.content_id},Promise.reject(s)}return e&&e[0]}):t.content_type_name in this._programTypes?Promise.resolve(t):"channel"===t.content_type_name?this.getChannelOnlineProgram(t):Promise.reject({message:"getProgramByResource -> no program, id: "+t.content_id+" type: "+t.content_type_name})},storeResource:function(t,e){var s;if(e=void 0===e||e,"vod-episode"===t.content_type_name?(this.storeVodEpisodes([t]),s=this.getCachedVodEpisode(t.content_id)):"vod-library"===t.content_type_name?(this.storeVodLibs([t]),s=this.getCachedVodLib(t.content_id)):t.content_type_name in this._programTypes?s=this.storePrograms([t])[0]:"channel"===t.content_type_name&&(s=this.storeChannel(t)),s)return s;throw e&&this.onError({message:"storeResource -> couldn't store resource",meta:{resource:{content_id:t.content_id,content_type:t.content_type_name}}}),new Error("storeResource -> couldn't store resource")},getCached:function(t,e){return"intervals"===t?this._intervals.getCached(e):"info"===t?this._programs.getCached(e)[0]:this._programs.getCached(e)},getResourceById:function(t){if(this._gettingResourceById||(this._gettingResourceById={}),this._gettingResourceById[t])return this._gettingResourceById[t];var e=this._getCachedResourceById(t);return this._gettingResourceById[t]=e?Promise.resolve(e):this.fetchResourceById(t),this._gettingResourceById[t]},_getCachedResourceById:function(t){return this.getChannelByContentId(t)||this.getCachedVodLib(t)||this.getCachedVodEpisode(t)||this.getCached("info",{content_id:t})},getCachedVodLib:function(t){return this._vodLibs&&this._vodLibs.byId&&this._vodLibs.byId[t]},getCachedVodEpisode:function(t){return this._vodEpisodes&&this._vodEpisodes.byId&&this._vodEpisodes.byId[t]},getNextForProgram:function(t){return t.meta.lastForChannel?Promise.resolve(null):this.getProgramFor(t.parent_channel_id||t.parent_id,t.end_time+1)},getProgramFor:function(t,e){var s={parent_id:t,end_from:e,limit:1};return this.getPrograms(s).then(function(t){return t[0]},function(t){return Promise.reject({message:"getProgramFor -> "+(t&&t.message),originalMessage:t&&t.originalMessage})})},getPrograms:function(t){return t.limit&&(!t.start_from&&!t.end_from||t.start_to||t.end_to)?Promise.reject({message:"getPrograms: wrong params with limit"}):this.checkProgramsInCache(t.parent_id,t).then(function(){return t.limit&&"object"==typeof t.parent_id&&(t.limit=t.parent_id.length*t.limit),this.getCached("programs",t)}.bind(this),function(t){return Promise.reject({message:"getPrograms -> "+(t&&t.message),originalMessage:t&&t.originalMessage})})},checkProgramsInCache:function(t,e){var s=t||e.parent_id;if(s instanceof Array)return Promise.all(s.map(function(t){return this.checkProgramsInCache(t,e)},this));var i=e.start_from||e.end_from,n=e.start_to||e.end_to,r=this._programs.findMissingSegment({parent_id:s,start_from:e.start_from,end_from:e.end_from,start_to:e.start_to,end_to:e.end_to,limit:e.limit,noVoid:e.noVoid}),a=r[0],o=r[1];return a||o?this._fetchPrograms(s,{start:a||i,end:o||n,limit:r[2]}):Promise.resolve()},_fetchPrograms:function(t,e){var s,i=(e=e||{}).start&&parseInt(e.start,10),n=e.end&&parseInt(e.end,10),r=e.limit;if(r)return i?(s={parent_id:t,end_date__from:i,start_date__to:n,limit:r},this.fetchEpisodeQueue.add(s)):Promise.reject({message:"_fetchPrograms: wrong params with limit, no start"});var a=this._intervals.getCached({parent_id:t,end_from:i,start_to:n}),o=this._intervals.findMissingSegment({end_from:i,start_to:n},a),c=o[0],l=o[1],h=[];if(a.forEach(function(t){(!c&&!l||t.end_time<c||t.start_time>l)&&h.push(t.promise)}),o.length){s={parent_id:t,end_date__from:c,start_date__to:l};var m={promise:this.fetchEpisodeQueue.add(s).then(function(){this._intervals.forget(m)}.bind(this),function(){this._intervals.forget(m)}.bind(this)),start_time:c,end_time:l,parent_id:t};this._intervals.store(m),h.push(m.promise)}return Promise.all(h)},_fetchEpisodes:function(t){var e=this.__apiUrl+"episodes.json";return this.ajax(e,t).then(function(e){var s,i,n=t.end_date__from||-Infinity,r=t.start_date__to||Infinity,a=t.limit,o=(t.parent_id||"").split(",");a?(s=e&&(e.set||e),i=a/o.length,o.map(function(t){var e=s.filter(function(e){return e.parent_id===t});return[t,e]}).map(function(t){var e=t[0],s=t[1]||[],a=r;s.length>=i&&(a=s[s.length-1].end_time),this.storePrograms(s,n,a,[e])},this)):this.storePrograms(e,n,r,o)}.bind(this),function(s,i,n){return home.error.logAjaxError({block:"stream",message:"_fetchEpisodes: ajax",url:e,source:"bk_episodes",meta:{params:t}},s,i,n),Promise.reject({message:"_fetchEpisodes: fail"})})},getProgramInstance:function(t,e){this.overrideProgram(t),e&&e.status.subtitle_1tv&&(t.meta=t.meta||{},t.meta.subtitle="vod-episode"===t.content_type_name?home.l10n("stream.subtitle_1tv_vod"):home.l10n("stream.subtitle_1tv"));var s=this._programTypes[t.content_type_name];if(s)return new s(t,e);var i=Object.keys(this._programTypes);throw new TypeError('Invalid type "'+t.content_type_name+'", valid types: '+i)},preparePrograms:function(t,e,s,i){if(!(t||e&&s))return[];var n=t&&(t.set||t),r={};n=n&&n.length?n.map(function(t){var e=this.getChannelByContentId(t.parent_id);if(e)return t=this.getProgramInstance(t,e),r[t.parent_id]||(r[t.parent_id]=[]),r[t.parent_id].push(t),t},this).filter(Boolean):[];var a=[];if(e&&s&&i){this._programs.getCached({end_from:e,start_to:s}).filter(function(t){return t instanceof this.VoidProgram},this).forEach(function(t){r[t.parent_id]||(r[t.parent_id]=[]),r[t.parent_id].push(t)});for(var o=0;o<i.length;o++){var c=i[o],l=this.getChannelByContentId(c),h=r[c]||[];l&&(a=a.concat(this._voidsForChannel(l,h,e,s)))}}return n.concat(a).sort(this.sortByStartTime)},overrideProgram:function(t){var e=this.settings.override&&this.settings.override[t.content_id];if(e)for(var s in e)e.hasOwnProperty(s)&&("start_time"===s||"end_time"===s?t["fake_"+s]=e[s]:t[s]=e[s])},overrideChannel:function(t){var e=this.settings.resourceOverride&&this.settings.resourceOverride[t.content_id];if(e)for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])},_voidsForChannel:function(t,e,s,i){var n,r,a,o,c=t.content_id,l=e.length,h=[],m={start:{},end:{}};if(!l)return h.push(new this.VoidProgram({start_time:s,end_time:i,parent_id:c,title:t.title},t)),h;e.sort(function(t,e){return t.start_time-e.start_time});for(var d=0;d<=l;d++)a=d-1,n=0,r=0,d?d===l?e[a].end_time<i&&(n=e[a].end_time,r=i):e[a].end_time<e[d].start_time&&(n=e[a].end_time,r=e[d].start_time):e[d].start_time>s&&(n=s,r=e[d].start_time),n&&r&&(o=null,a>=0&&e[a]instanceof this.VoidProgram?o=e[a]:d<l&&e[d]instanceof this.VoidProgram&&(o=e[d]),o?(o.start_time=Math.min(o.start_time,n),o.end_time=Math.max(o.end_time,r),h.push(o)):h.push(new this.VoidProgram({start_time:n,end_time:r,parent_id:c},t))),e[d]&&(e[d]instanceof this.VoidProgram?d?d===l-1&&e[d].meta.nextProgram&&(m.start[e[d].meta.nextProgram.start_time]=e[d].meta.nextProgram):e[d].meta.prevProgram&&(m.end[e[d].meta.prevProgram.end_time]=e[d].meta.prevProgram):(m.start[e[d].start_time]=e[d],m.end[e[d].end_time]=e[d]));return h.forEach(function(t){var e=m.start[t.end_time]||null,s=m.end[t.start_time]||null;e&&(t.meta.nextProgram=e,t.fake_end_time=e.fake_start_time),s&&(t.meta.prevProgram=s,t.fake_start_time=s.fake_end_time)}),h},storePrograms:function(t,e,s,i){var n=this.preparePrograms(t&&(t.set||t),e,s,i);return this._programs.store(n),n},getVodLibs:function(t){var e=t.parent_id;e instanceof Array||(e=[e]);var s=e.map(function(e){var s=home.deepExtend({},t);s.parent_id=e,s.recommended=!0;var i=this.getCachedVodLibs(s);return i.missing?this.fetchVodQueue.add(i.missing).then(function(){return this.getCachedVodLibs(s).libs}.bind(this)):i.libs},this);return Promise.all(s).then(function(t){var e=[];return t.forEach(function(t){e=e.concat(t)}),e})},getVodEpisodes:function(t){var e=t.parent_id+"_"+t.limit+"_"+t.offset;if(this._gettingVodEpisodes||(this._gettingVodEpisodes={}),this._gettingVodEpisodes[e])return this._gettingVodEpisodes[e];var s=this._getCachedVodEpisodes(t),i=s.episodes,n=s.missing;return this._gettingVodEpisodes[e]=i&&!n?Promise.resolve(i):this.fetchVodEpisodes(n).then(function(){return this._getCachedVodEpisodes(t).episodes}.bind(this)),this._gettingVodEpisodes[e]},getCachedVodLibs:function(t){var e=t.parent_id,s=this._vodLibs&&this._vodLibs.byChannel&&this._vodLibs.byChannel[e];if(!(s&&s.set&&s.set.length))return{libs:[],missing:t};var i=s.set;return i&&i.length?{libs:i}:void 0},_getCachedVodEpisodes:function(t){var e,s=t.parent_id,i=t.limit,n=t.offset||0,r=this._vodEpisodes&&this._vodEpisodes.byLib&&this._vodEpisodes.byLib[s];if(!(r&&r.set&&r.set.length))return{episodes:[],missing:t};var a=r.set,o=r.total;return n<a.length&&(i=i+n-a.length,n=a.length),n<0&&(n=0),i<0&&(i=0),o&&i&&i+n>o&&(i=Math.max(o-n,0)),i&&(e={parent_id:s,offset:n,limit:i}),{episodes:a.slice(t.offset||0,t.limit),missing:e}},fetchVodLibs:function(t){var e=(t.parent_id||"").split(","),s=[];if(this._vodLibsPromises||(this._vodLibsPromises={}),(e=e.filter(function(t){if(!this._vodLibsPromises[t])return!0;s.push(this._vodLibsPromises[t])},this)).length){var i={recommended:!0,parent_id:e.join()},n=this.__apiUrl+"vod_libraries.json",r=this.ajax(n,i).then(function(s){var n,r,a=s.set,o={};a||(a=s.libraries||[],r=s.episodes||[],a.length!==r.length&&(n="fetchVodLibs: libs.length !== episodes.length, ["+a.length+", "+r.length)),a.length<1&&(n="fetchVodLibs: libs.length < 1"),n&&this.onError({message:n+", ajaxParams: "+JSON.stringify(i)}),e.forEach(function(t){o[t]=[]}),a.forEach(function(t){o[t.parent_id]&&o[t.parent_id].push(t)}),e.forEach(function(e){var s=home.deepExtend({},t);s.parent_id=e,this.storeVodLibs(o[e],s)},this),r&&r.length&&r.forEach(function(t){this.storeVodEpisodes([t],{parent_id:t.parent_vod_lib_id,limit:1})},this)}.bind(this),function(t,s,r){return home.error.logAjaxError({block:"stream",message:"fetchVodLibs: ajax",url:n,source:"bk_vod_libs",meta:{params:i}},t,s,r),e.forEach(function(t){this._vodLibsPromises[t]=null},this),Promise.reject({message:"fetchVodLibs: fail"})}.bind(this));e.forEach(function(t){this._vodLibsPromises[t]=r},this),s.push(r)}return Promise.all(s)},fetchVodEpisodes:function(t){var e=t,s=this.__apiUrl+"vod_episodes.json";return this.ajax(s,e).then(function(e){return this.storeVodEpisodes(e,t)}.bind(this),function(t,i,n){return home.error.logAjaxError({block:"stream",message:"fetchVodEpisodes: ajax",url:s,source:"bk_vod_episodes",meta:{params:e}},t,i,n),Promise.reject({message:"fetchVodEpisodes: fail"})})},storeVodLibs:function(t,e){var s,i,n,r=[];if(e&&(s=e.parent_id,i=e.limit,n=0,this._vodLibs.byChannel[s]||(this._vodLibs.byChannel[s]={set:[]}),(!i||i>t.length)&&(this._vodLibs.byChannel[s].total=n+t.length)),t&&t.length)return t.forEach(function(t){var e;if(!t.parent_id||(e=this.getChannelByContentId(t.parent_id))&&e.has_vod){var i=new this.VodLibrary(t,e);if(t.parent_id&&!this._vodLibs.byChannel[t.parent_id]&&(this._vodLibs.byChannel[t.parent_id]={set:[]}),s&&t.parent_id===s){var n=this._vodLibs.byId[i.content_id],a=this._vodLibs.byChannel[t.parent_id].set,o=a.indexOf(n);n&&o>-1?a[o]=i:a.push(i)}this._vodLibs.byId[i.content_id]=i}else r.push({ch:t.parent_id,id:t.content_id})},this),r.length&&this.onError({message:"storeVodLibs: invalid channel for vod lib",meta:{items:r}}),t},storeVodEpisodes:function(t,e){if(t){var s,i=t&&(t.set||t),n=e&&e.parent_id,r=[];if(i&&i.length)return n&&((s=this._vodEpisodes.byLib[n])||(s=this._vodEpisodes.byLib[n]={set:[]})),i.forEach(function(t){var e;if(t.parent_channel_id&&((e=this.getChannelByContentId(t.parent_channel_id))&&e.has_vod||r.push({ch:t.parent_channel_id,id:t.content_id})),this.overrideProgram(t),t=this.getProgramInstance(t,e),s){var i=this._vodEpisodes.byId[t.content_id],n=s.set.indexOf(this._vodEpisodes.byId[t.content_id]);i&&n>-1?s.set[n]=t:s.set.push(t)}this._vodEpisodes.byId[t.content_id]=t},this),s&&e.limit&&i.length<e.limit&&(this._vodEpisodes.byLib[n].total=(e.offset||0)+i.length),r.length&&this.onError({message:"storeVodEpisodes: invalid channel for vod episode",meta:{items:r}}),i}},getLibById:function(t){return this.getResourceById(t).then(function(e){if(e&&e instanceof this.VodLibrary)return e;var s=new Error("getLibById: no lib by id");return s.meta={content_id:t},this.onError(s),Promise.reject(s)}.bind(this))},getCarouselsById:function(t,e){return this.getCarousels(e).then(function(){return this._carousels.byId[t]||[]}.bind(this))},getCarousels:function(t){var e,s=t.tag,i=s||"default";return this._carousels.paginators[i]||(e=function(t){var e={limit:t.limit,offset:t.offset,tag:s};return this._fetchCarousels(e)}.bind(this),this._carousels.paginators[i]=new this.Paginator([],e)),this._carousels.paginators[i].get(t)},_fetchCarousels:function(t){var e=this.__apiUrl+"carousels_videohub.json",s={limit:t.limit,offset:t.offset,tag:t.tag};return this.settings.exp.stream_channels_carousels_on_backend&&(s.enable_channels=1),this.settings.disableExtraCarousels&&!t.tag&&(s.enable_extra_carousels=1),this.ajax(e,s).then(function(t){return this._prepareCarousels(t&&t.carousels)}.bind(this),function(t,e,i){return home.error.logAjaxError({block:"stream",message:"_fetchCarousels: ajax",source:"cms_carousels",meta:{params:s}},t,e,i),Promise.reject({message:"_fetchCarousels: fail"})})},getCarouselItems:function(t){return this._prepareCarousel({carousel_id:t.carousel_id}).get(t)},_fetchCarouselItems:function(t){var e=this.__apiUrl+"carousel_videohub.json",s={carousel_id:t.carousel_id,limit:t.limit,offset:t.offset};return this.ajax(e,s).then(function(t){var e=t&&t.set||[];return this._prepareCarouselItems(e)}.bind(this),function(t,e,i){return home.error.logAjaxError({block:"stream",message:"_fetchCarouselItems: ajax",source:"cms_carousel",meta:{params:s}},t,e,i),Promise.reject({message:"_fetchCarouselItems: fail"})})},_prepareCarouselItems:function(t){return t.map(function(t){try{"channel"===(t=this.storeResource(t)).content_type_name&&t.status.hidden&&(t=null)}catch(e){t=null}return t},this)},storeCategories:function(t){this._categories={},this._carouselToCategoryMap={},t.forEach(function(t){this._categories[t.category]=t,t.carousel&&(this._carouselToCategoryMap[t.carousel]=t.category)},this)},getCategories:function(){return this._categories||{}},getCarouselToCategoryMap:function(){return this._carouselToCategoryMap},_prepareCarousels:function(t){var e=[];return(t=t||[]).forEach(function(t){t=this._prepareCarousel(t),e.push(t)},this),e},_prepareCarousel:function(t){var e=t.carousel_id,s=this._carousels.byId[e];return s?(s.title=s.title||t.title,s.has_vertical=s.has_vertical||t.has_vertical,s.storeIncludes(t.includes)):(s=new this.Carousel(t),this._carousels.byId[e]=s),s},getRelatedPrograms:function(t){var e;return t&&t.hasOwnProperty("related")&&(e=Promise.resolve(t.related||[])),t.parent_id&&t.program_id&&(e=this._fetchRelated(t.parent_id,t.program_id)),e?e.then(function(e){var s={};return e.filter(function(e){return!(!e.canPlay(home.now()/1e3)||e.episode_id in s||(s[e.episode_id]=!0,e.content_id===t.content_id))})}):Promise.resolve([])},_fetchRelated:function(t,e){var s=this._intervals.getCached({parent_id:t,program_id:e});if(s.length)return s[0].promise;var i={parent_id:t,start_date__to:home.now()/1e3|0,program_id:e,limit:20},n=this.__apiUrl+"program_episodes.json",r={parent_id:t,program_id:e,promise:this.ajax(n,i).then(function(t){var e=this.storePrograms(t);return e.forEach(function(e){e.related=t.set}),this._intervals.forget(r),e}.bind(this),function(t,e,s){return home.error.logAjaxError({block:"stream",message:"_fetchRelated: ajax",url:n,source:"bk_program_episodes",meta:{params:i}},t,e,s),this._intervals.forget(r),Promise.reject({message:"_fetchRelated: fail"})}.bind(this))};return this._intervals.store(r),r.promise},getDoc2DocRecommendations:function(t,e){var s=t.getContentId();return e||(e=20),s?this._fetchDoc2DocRecommendations({content_id:s,limit:e}):Promise.resolve([])},_fetchDoc2DocRecommendations:function(t){var e=this.__apiUrl+"doc2doc",s=t.content_id,i=this.settings.disableDoc2DocErrors;return this._doc2DocMemory=this._doc2DocMemory||{},this._doc2DocMemory[s]||(this._doc2DocMemory[s]=this.ajax(e,t).then(function(t){var e=t.set||t;return this._logDebugInfo(t),e.map(function(t){try{return this.storeResource(t,!i)}catch(e){return""}},this).filter(Boolean)}.bind(this),function(e,s,i){return home.error.logAjaxError({block:"stream",message:"fetchDoc2DocRecommendations: ajax",source:"vh_doc2doc",meta:{params:t}},e,s,i),[]}),setTimeout(function(){delete this._doc2DocMemory[s]}.bind(this),this.DOC2DOC_CACHE_TIME)),this._doc2DocMemory[s].then(function(t){0===t.length&&this.onError({message:"doc2doc -> empty recommendations",meta:{resource:{content_id:s}}})}.bind(this)),this._doc2DocMemory[s]},_logDebugInfo:function(t){var e=t||{},s=e,i=home.parseUrl(location.href).query["relev-debug"]||"",n={};e&&i&&(e.video_serp_link&&(n=home.parseUrl(e.video_serp_link)),i&&i.split(".").forEach(function(t){s&&(s=s[t])}),console.log("%c   ","font-size:15px;"),console.log("%c ","font-size:13px; background-color:#fc0; padding:2px 10px;"),console.log(e.video_serp_link),console.log("%c ","font-size:13px; background-color:#fc0; padding:2px 10px;"),console.log(n.query),console.log("%c  ","font-size:13px; background-color:#fc0; padding:2px 10px;"),console.log(e),console.log("%c  ","font-size:13px; background-color:#fc0; padding:2px 10px;"),console.log(s))},dayStart:function(t){var e=t?new Date(1e3*t):home.now();e.getHours()<5&&e.setDate(e.getDate()-1);var s=e.getFullYear(),i=e.getMonth(),n=e.getDate();return new Date(s,i,n,5)/1e3|0},interestSort:function(t){var e=home.now()/1e3,s=function(t,s){var i=t instanceof this.VoidProgram,n=s instanceof this.VoidProgram;i&&t.meta.nextProgram&&(t=t.meta.nextProgram,i=!1),n&&s.meta.nextProgram&&(s=s.meta.nextProgram,n=!1);var r=t.end()-e,a=s.end()-e,o=t.start(),c=s.start(),l=r>0?1:0,h=a>0?1:0,m=h-l;return m||(i&&!n?1:!i&&n?-1:(l=o<=e&&r>0?1:0,(m=(h=c<=e&&a>0?1:0)-l)?m:i&&n?0:o>e&&c>e&&(m=o-c)?m:(m=(s.meta.relevance||0)-(t.meta.relevance||0))||a-r))}.bind(this);return t.sort(s)},ajax:function(t,e){var s=home.deepExtend(home.getData("stream.reqparams-cms",{}),{stream_options:this.settings&&this.settings.exp.lowres?"lowres":"hires",locale:BEM.blocks["i-global"].param("locale"),from:home.getData("stream.reqparams.from")||"morda",distr_id:home.getData("stream.reqparams.distr_id"),reqid:home.getData("stream.reqparams.reqid")}),i=this,n=0===t.indexOf(this.__apiUrl),r=this._ajaxInProgress,a=function(t){var e=home.localStorage.getItem("morda-stream-stale");if(t&&t.error&&"old"===t.error.code){if("report"!==e||this._needReload||(home.error.logError({block:"stream",sourceType:"vh"},{message:"Old frontend handler after reload"}),home.localStorage.setItem("morda-stream-stale","fail")),e)return;home.error.logError({block:"stream",sourceType:"stale"},{message:"Old frontend handler was used, reloading"}),this._needReload=!0,home.localStorage.setItem("morda-stream-stale","report"),setTimeout(function(){location.reload()},500)}else home.localStorage.removeItem("morda-stream-stale")}.bind(this),o=function(){this._ajaxInProgress=Math.max(0,this._ajaxInProgress-1)}.bind(this);return this._ajaxInProgress++,s.disable_trackings=1,new Promise(function(c,l){var h=$.extend(e||{},s),m=1,d=function(){var e=$.ajax({url:t,data:h,dataType:"json",xhrFields:{withCredentials:!0}});e.then(o,o),n&&e.then(a),e.then(function(t){return n&&this.checkErrors(t),t}.bind(i)).then(c,function(t,e,s){m--&&"timeout"===e?d():l(t,e,s)})},u=Math.min(300,100*r)*Math.random();u?setTimeout(d,u):d()})},checkErrors:function(t){var e=t.errors||{},s={invalid_region:"region"};["invalid_region","outdated"].map(function(i){var n=e[i]||[];t.error===i&&t.content&&n.push(t.content.content_id),n.forEach(function(t){this.forbidden[t]=s[i]||i},this)},this)},setSessionParams:function(t){var e=home.deepExtend({},home.getData("stream.reqparams"));this._sessionParams=home.deepExtend(e,t)},getSessionParams:function(){return this._sessionParams||home.getData("stream.reqparams")||{}},getPleerAdditionalParams:function(){var t=this.getSessionParams(),e=this.getCurrentWatchingParams();return $.extend({stream_block:e.stream_block},t)},setCurrentWatchingParams:function(t,e){var s={content_id:t.content_id,channel_id:t.channel&&t.channel.channel_id};if(this._currentWatchingParams=$.extend(s,e||{}),this._currentWatchingParams&&"other"===this._currentWatchingParams.stream_block){var i=new Error("setCurrentWatchingParams: stream_block is other");this.onError(i)}},getCurrentWatchingParams:function(){return this._currentWatchingParams||{}},_patchHomeNow:function(t){var e;if(this.settings.pumpkinMode&&!this._homeNowIsPatched){if(t)return t=Number(t),e=+new Date-1e3*t,home.now=function(){return new Date(+new Date-e)},void(this._homeNowIsPatched=!0);t=+new Date,(e=Math.abs(home.now()-t))<36e5&&(home.now=function(){return new Date})}},onError:function(t){var e=t.meta||{};e.from=this.getSessionParams().from,e.from_block=this.getSessionParams().from_block,t.message=t.message+(t.originalMessage?",originalErrorMessage:"+t.originalMessage:""),home.error.logError({block:"stream",sourceType:"logic",meta:e},t)},__apiUrl:"https://frontend.vh.yandex.ru/",_ajaxInProgress:0,forbidden:{}})),BEM.decl("task-queue",{__constructor:function(t){this._groups={},this._callback=t,this.__base.apply(this,arguments)},add:function(t){var e,s=this.toEntity(t),i=String(this.groupKey(s));if(!i)return Promise.resolve().then(function(){return this._callback(t)}.bind(this));this._groups[i]||(this._groups[i]={promise:new Promise(function(t){e=t}),resolver:e,items:[]});var n=this._groups[i];return n.items.push(s),this.countdown(),n.promise},countdown:function(){this._timeout||(this._timeout=setTimeout(this.runQueue.bind(this),this.TIMEOUT))},runQueue:function(){var t=this._groups,e=this._callback;for(var s in this._groups={},this._timeout=null,t)if(t.hasOwnProperty(s)){var i=t[s],n=this.merge(i.items,s),r=e(this.fromEntity(n));i.resolver(r)}},toEntity:function(t){return t},groupKey:function(){return""},merge:function(){},fromEntity:function(t){return t},TIMEOUT:20}),BEM.decl({block:"episode-queue",baseBlock:"task-queue"},{toEntity:function(t){var e=t.offset||0,s=t.limit||0,i=0,n=t.start_date__from||t.end_date__from||-Infinity,r=t.start_date__to||t.end_date__to||Infinity;t.end_date__from&&i++,t.start_date__to&&i++,s&&(s+=i);var a={},o=["limit","start_date__from","start_date__to","end_date__from","end_date__to","parent_id"];for(var c in t)t.hasOwnProperty(c)&&-1===o.indexOf(c)&&(a[c]=t[c]);return{start:n,end:r,offset:e,limit:s,parent_id:t.parent_id,rest:a}},groupKey:function(t){return t.offset?"":[this.tsToBin(t.start),this.tsToBin(t.end),t.limit?parseInt(t.limit/5,10)+1:0].join("-")},tsToBin:function(t){return t?t-t%60:""},merge:function(t){var e=[],s=0,i=Infinity,n=0;t.forEach(function(t){e.push(t.parent_id),s=Math.max(s,t.limit),i=t.start&&Math.min(i,t.start),n=t.end&&Math.max(n,t.end)});var r={limit:s*t.length,parent_id:e.join(",")};return i!==-Infinity&&i!==Infinity&&(r.start=i),n&&n!==Infinity&&(r.end=n),r},fromEntity:function(t){var e={parent_id:t.parent_id};for(var s in t.limit&&(e.limit=t.limit),t.offset&&(e.offset=t.offset),t.start!==-Infinity&&(e.end_date__from=t.start),t.end!==-Infinity&&(e.start_date__to=t.end),t.rest)t.rest.hasOwnProperty(s)&&(e[s]=t.rest[s]);return e}}),BEM.decl({block:"vod-queue",baseBlock:"task-queue"},{groupKey:function(t){return t.offset?"":[t.limit?parseInt(t.limit/5,10)+1:0,t.recommended].join("-")},merge:function(t){var e=[],s=0;return t.forEach(function(t){e.push(t.parent_id),s=Math.max(s,t.limit)}),{limit:s*t.length,parent_id:e.join(",")}}}),function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=1)}([function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,n=e.ContentTypes=void 0;(i=n||(e.ContentTypes=n={})).FILM="film",i.TRAILER="trailer",i.CHANNEL="channel";var r,a=e.TrackingEvents=void 0;(r=a||(e.TrackingEvents=a={})).SET_SOURCE="setSource",r.INIT="init",r.START="start",r.END="end",r.PLAY="play",r.PAUSE="pause",r.ERROR="error",r.AD_START="adStart",r.AD_END="adEnd",r.HEARTBEAT="heartbeat",r.WATCHED_TIME="watchedTime",r.VIEWED="viewed"},function(t,e,s){"use strict";var i=n(s(2));function n(t){return t&&t.__esModule?t:{"default":t}}(0,n(s(5))["default"])(),window.Ya.OTT.buildTrackings=i["default"]},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(s(3)),n=s(4),r=o(n),a=s(0);function o(t){return t&&t.__esModule?t:{"default":t}}var c={1:"channel-family",2:"channel",3:"episode",4:"vod-library",5:"vod-episode",6:"tv-series",7:"tv-season",8:"black-window",9:"out-of-tv-channel",10:"type-folder",11:"zen-namespace",12:"zen-library",13:"zen-episode",14:"yandex-disribution-library",15:"yandex-disribution-episode",16:"emergency-black-window",17:"cv-black-window",18:"yandex-market-library",19:"yandex-market-episode",20:"ott-movie",21:"ott-episode",22:"kd-feed-episode",24:"sport-episode",25:"announce",30:"ntv-vod-library",31:"ntv-vod-movie",32:"ntv-vod-series",33:"ntv-vod-series-season",34:"ntv-vod-series-season-episode",35:"ott-multipart",36:"ott-part",37:"ott-trailer",38:"ott-collection",39:"ott-collection-item",40:"high-light",41:"user-episode",42:"vod-news",43:"vod-broadcast",44:"vod-news-episode",45:"vod-broadcast-episode",46:"snapshot-tv-episode",47:"kp-trailer",48:"ya-news",49:"self-service-bw-window",50:"main-black-window",51:"music-clip",82:"ott_linked_video",83:"ott_music_karaoke",84:"ott_linked_video_parent",85:"ott_music_karaoke_parent",86:"ott-vod-library",87:"ott_linked_trailer",88:"ott_linked_music_clip"};function l(t){var e;switch(t){case a.TrackingEvents.START:e="2154";break;case a.TrackingEvents.END:e="1428";break;case a.TrackingEvents.PLAY:e="331";break;case a.TrackingEvents.PAUSE:e="528";break;case a.TrackingEvents.ERROR:e="1030"}return e}e["default"]=function(t,e){t=function(t){for(var e=0;e<n.TRACKING_DATA_KEYS.length;e++){var s=n.TRACKING_DATA_KEYS[e];void 0===t[s]&&(t[s]="-")}return t}(t);var s,o,h,m,d,u,_=(o={testing:{counterId:45961911,kpCounterId:48924764,vpCounterId:45151398},production:{counterId:45913512,kpCounterId:48924740,vpCounterId:31713861}})[s=e.env]?o[s]:o.testing,p=(m={testing:{ottTrackingsBackend:"https://tracking-testing.ott.yandex.net/v1/",metrikaBackend:"//mc.yandex.ru/watch/",redirlogBackend:"https://yandex.ru/clck/jclck/"},production:{ottTrackingsBackend:"https://tracking.ott.yandex.net/v1/",metrikaBackend:"//mc.yandex.ru/watch/",redirlogBackend:"https://yandex.ru/clck/jclck/"}})[h=e.env]?m[h]:m.testing,g={},f=t.serviceName,v=(d=t.contentTypeID)in(u={47:a.ContentTypes.TRAILER,20:a.ContentTypes.FILM,21:a.ContentTypes.FILM,87:a.ContentTypes.CHANNEL,88:a.ContentTypes.CHANNEL})?u[String(d)]:a.ContentTypes.FILM;return(f in r["default"][v]?r["default"][v][f]:r["default"][v]["default"]).forEach(function(t){g[t]=function(t,e,s){var i=[],n='{{metrikaBackend}}<<COUNTER_NAME>>?page-ref=yandex.ru&site-info={"{{serviceName}}":{"{{fromBlock}}":{"<<EVENT_NAME>>":{"{{uuid}}":{"{{position}}":"{{monetizationModel}}"}}}}}',r='{{ottTrackingsBackend}}watch?data={"position":"{{position}}","fromBlock":"{{fromBlock}}","serviceName":"{{serviceName}}","uuid":"{{uuid}}","sid":"{{sid}}","vSid":"{{vsid}}","yaUID":"{{yandexuid}}","monetizationModel":"{{monetizationModel}}","contentTypeName":"{{contentTypeName}}","device-type":"{{device-type}}","device-type-tns":"{{device-type-tns}}"',o="{{redirlogBackend}}reqid={{reqid}}/yandexuid={{yandexuid}}/select_event=click/cid=73037/pid=197/source=serp/rnd={{random}}/fullscreen={{fullscreen}}/duration={{duration}}/timestamp={{timestamp}}/user_ts={{vts}}/watchedTime={{fts}}/content_id={{uuid}}/licence={{monetizationModel}}/svod={{subscriptionType}}/vsid={{vsid}}/";if(e===a.ContentTypes.FILM||e===a.ContentTypes.CHANNEL){if(t===a.TrackingEvents.SET_SOURCE||t===a.TrackingEvents.INIT){var c=(d=n.replace("<<EVENT_NAME>>","video_start")).replace("<<COUNTER_NAME>>","{{counterId}}");if(i.push(c+"&page-url=goal://{{dl}}/VIDEO_START"),i.push(r+',"eventType":"video_start","eventCount":"-"}'),t===a.TrackingEvents.INIT&&("ya-serp"===s&&i.push(o+"dtype=iweb/path=690.1033.1242.1950.2154/vars=689=1086/*{{dl}}"),"kp"===s)){var h=d.replace("<<COUNTER_NAME>>","{{kpCounterId}}");i.push(h+"&page-url=goal://{{dl}}/VIDEO_START")}}else if(t===a.TrackingEvents.START||t===a.TrackingEvents.END||t===a.TrackingEvents.PLAY||t===a.TrackingEvents.PAUSE){if("ya-serp"===s){var m=l(t);i.push(o+"dtype=iweb/path={{path}}."+m+"/vars=689=1086/*{{dl}}"),i.push(o+"dtype=stred/path=player-events."+t+"/from_block=entity/*")}}else if(t===a.TrackingEvents.ERROR)i.push(r+',"errorCode":"{{error-code}}","eventType":"player_error","eventCount":"-"}'),"ya-serp"===s&&(m=l(t),i.push(o+"dtype=iweb/path={{path}}."+m+"/vars=689=1086/*{{dl}}"),i.push(o+"dtype=stred/path=player-events."+t+"/error_code={{error-code}}/from_block=entity/*"));else if(t===a.TrackingEvents.AD_START||t===a.TrackingEvents.AD_END){var d,u=t===a.TrackingEvents.AD_START?"VIDEO_AD_START":"VIDEO_AD_END";if(c=(d=n.replace("<<EVENT_NAME>>",u)).replace("<<COUNTER_NAME>>","{{counterId}}"),i.push(c),i.push(r+',"eventType":"'+u+'","eventCount":"-"}'),"ya-serp"===s&&i.push(o+"dtype=stred/path=player-events."+t+"/from_block=entity/*"),"kp"===s){var _=d.replace("<<COUNTER_NAME>>","{{kpCounterId}}");i.push(_)}}else if(t===a.TrackingEvents.HEARTBEAT){var p=e===a.ContentTypes.CHANNEL?1e4:6e4;i.push([r+',"eventType":"heartbeat","eventCount":"'+p+'","audio-track-name":"{{audio-track-name}}","audio-track-lang":"{{audio-track-lang}}","text-track-name":"{{text-track-name}}","text-track-lang":"{{text-track-lang}}"}',{delay:p,offset:p}]),"ya-serp"===s&&i.push([o+"dtype=stred/path=player-events."+t+"/from_block=entity/*",{delay:3e4}])}else if(t===a.TrackingEvents.WATCHED_TIME)[["1","content_start"],["10000",(g="content_duration_")+"10"],["20000",g+"20"],["30000",g+"30"],["40000",g+"40"],["50000",g+"50"],["60000",g+"60"]].forEach(function(t){var e={offset:Number(t[0])},a=n.replace("<<EVENT_NAME>>",t[1]),o=a.replace("<<COUNTER_NAME>>","{{counterId}}");i.push([o,e]),i.push([r+',"eventType":"'+t[1]+'","eventCount":"'+t[0]+'"}',e]),"kp"===s&&i.push([a.replace("<<COUNTER_NAME>>","{{kpCounterId}}"),e])});else if(t===a.TrackingEvents.VIEWED){var g;[["25",(g="VIDEO_")+"25"],["50",g+"50"],["75",g+"75"],["90",g+"90"],["99",g+"END"]].forEach(function(t){var e={percent:Number(t[0])},a=n.replace("<<EVENT_NAME>>",t[1]),o=a.replace("<<COUNTER_NAME>>","{{counterId}}");i.push([o,e]),i.push([r+',"eventType":"'+t[1]+'","eventCount":"'+("99"==t[0]?"100":t[0])+'"}',e]),"kp"===s&&i.push([a.replace("<<COUNTER_NAME>>","{{kpCounterId}}"),e])})}}else if(e===a.ContentTypes.TRAILER){var f="//mc.yandex.ru/watch/{{vpCounterId}}?page-ref=yandex.ru&page-url=goal://{{dl}}/";t===a.TrackingEvents.INIT?i.push('{{metrikaBackend}}{{vpCounterId}}?page-ref=yandex.ru&site-info={"kp_trailers":{"host":{"{{serviceName}}":{"{{kpId}}":{"{{uuid}}":"{{kpTrailerId}}"}}}}}&page-url=goal://{{dl}}/TRAILER_START'):t===a.TrackingEvents.AD_START?i.push(f+"TRAILER_AD_START"):t===a.TrackingEvents.AD_END?i.push(f+"TRAILER_AD_END"):t===a.TrackingEvents.VIEWED&&i.push([f+"TRAILER_50",{percent:50}],[f+"TRAILER_90",{percent:90}])}return i}(t,v,f)}),t=Object.assign(t,_,p,{contentTypeName:c[t.contentTypeID]||"unknown"}),{trackingEvents:JSON.parse((0,i["default"])(g,t))}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=function(t,e,s){void 0===e&&(e={});var n=(void 0===s?{}:s).macros,r=void 0===n?"{{"+i+"}}":n,a={};Object.keys(e).forEach(function(t){var s=r.replace(i,t);a[s]=e[t]});var o=new RegExp("("+Object.keys(a).join("|")+")","ig");return("string"==typeof t?t:JSON.stringify(t)).replace(o,function(t){return t in a?encodeURI(a[t]):t})};var i="__VAL__"},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TRACKING_DATA_KEYS=void 0;var i=s(0),n=(e.TRACKING_DATA_KEYS=["yandexuid","position","fromBlock","serviceName","reqid","path","sid","uuid","kpId","kpTrailerId","contentTypeID","monetizationModel","subscriptionType"],[i.TrackingEvents.SET_SOURCE,i.TrackingEvents.INIT,i.TrackingEvents.ERROR,i.TrackingEvents.AD_START,i.TrackingEvents.AD_END,i.TrackingEvents.HEARTBEAT,i.TrackingEvents.WATCHED_TIME,i.TrackingEvents.VIEWED]),r={film:{"default":n,kp:n,"ya-serp":n.concat([i.TrackingEvents.START,i.TrackingEvents.END,i.TrackingEvents.PLAY,i.TrackingEvents.PAUSE])},trailer:{"default":[i.TrackingEvents.INIT,i.TrackingEvents.AD_START,i.TrackingEvents.AD_END,i.TrackingEvents.VIEWED]},channel:{"default":n}};e["default"]=r},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=function(t){void 0===t&&(t=window),"Ya"in t||(t.Ya={}),"OTT"in t.Ya||(t.Ya.OTT={})}}]),function(t){var e,s;try{e=t.localStorage,s="ya_ls_test",e.setItem(s,"1"),"1"!==e.getItem(s)?e=null:e.removeItem(s)}catch(o){e=null}var i=t.home||(t.home={}),n=t.console&&function(t){console.log(t)}||function(){},r=function(t){n("localStorage is disabled. "+(t||""))},a=function(t){try{return t()}catch(o){r(o)}};e?i.localStorage={setItem:function(t,s){return a(function(){return e.setItem(t,s)})},getItem:function(t){return a(function(){return e.getItem(t)})},removeItem:function(t){return a(function(){return e.removeItem(t)})},clear:function(){return a(function(){return e.clear()})},key:function(t){return a(function(){return e.key(t)})}}:(i.localStorage={removeItem:r,setItem:r,getItem:r,clear:r},i.disabledLS=!0)}(window),BEM.DOM.decl({block:"stream",modName:"watcher",modVal:"yes"},{_watcherParams:{},onSetMod:{visibility:{visible:function(){this.__base.apply(this,arguments),this._startWatcher()},"":function(){this.__base.apply(this,arguments),this._stopWatcher()}}},getParams:function(){var t=this.params.settings.streamWatcher;return{timeToReload:t.timeToReload||2592e5,timeToFocusReload:t.timeToFocusReload||864e5,time:t.time||36e5}},_startWatcher:function(){this._openTime=this._openTime||Date.now(),this._watcherParams=this.getParams(),this._bindFocus(),this.interval=setInterval(this._watchTime.bind(this),this._watcherParams.time)},_stopWatcher:function(){this._unbindFocus(),clearInterval(this.interval)},_bindFocus:function(){this.fnFocus=this._watchFocus.bind(this),$.browser&&$.browser.msie?$(document).on("focusin",this.fnFocus):$(window).on("focus",this.fnFocus)},_unbindFocus:function(){$.browser&&$.browser.msie?$(document).off("focusin",this.fnFocus):$(window).off("focus",this.fnFocus)},_watchTime:function(){Date.now()>this._openTime+this._watcherParams.timeToReload&&(home.stat.logPath("tech","stream.reload.3d"),location.reload())},_watchFocus:function(){Date.now()>this._openTime+this._watcherParams.timeToFocusReload&&(home.stat.logPath("tech","stream.reload.focus"),location.reload())}}),BEM.DOM.decl({block:"stream",modName:"touch",modVal:"yes"},{onSetMod:{visibility:{visible:function(){return $("body > .container").css("display","none"),this.__base.apply(this,arguments)},"":function(){return $("body > .container").css("display",""),this.__base.apply(this,arguments)}}}}),BEM.DOM.decl({block:"stream",modName:"stat",modVal:"yes"},{onSetMod:{js:function(){this.channel("arrow-list").on("move.stream",this._countShows,this),this.channel("arrow-list").on("scroll.stream",this._countListSwipe,this),this.__base.apply(this,arguments)}},_countShows:function(){this.afterCurrentEvent(function(){home.stat.logDOMShow(this.domElem)})},_initList:function(){this.findBlockInside("list","arrowed-list")},_countListSwipe:function(){home.stat.logPath("click","stream.recommended.scroll.swipe")},_restartCurrent:function(){this.__base();var t=home.now(),e=this._lastRestart&&t-this._lastRestart;e>100&&e<1e4?(this._anger=(this._anger||0)+1,home.stat.logPath("click","stream.video_nav.anger."+this._anger)):this._anger=0,this._lastRestart=t}},{live:function(){return this.liveBindTo("list","pointerdown mousedown",function(){this._initList()}),this.__base()}}),function(){"use strict";var t;home.stat.addHandler=function(e,s){t||(t=[]),t.some(function(t){return t.func===s&&t.prefix===e})||t.push({prefix:e,func:s,re:new RegExp("^"+e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")+"(\\.|\\(|$)")})},home.stat.removeHandler=function(e,s){t&&(t=t.filter(function(t){return t.prefix!==e||t.func!==s}))},["logPath","redirect"].forEach(function(e){var s=home.stat[e];home.stat[e]=function(i,n,r){var a="redirect"===e?"click":i;if(n){var o=n.replace(/\([^)]+\)/g,"");return t&&t.forEach(function(t){if(t.re.test(o)){var e=t.func(a,n);e&&e.counter&&(n=e.counter)}}),s.call(home.stat,i,n,r)}}})}(),BEM.DOM.decl("stream-coordinator",{onSetMod:{js:function(){this._stream=this.findBlockOn("stream"),this.params=this._stream.params,this._cms=BEM.blocks["stream-cms"].init(),this.__self.instance=this,this._history=BEM.blocks["stream-history"].get(),this._history.on("opened",this._onPopState.bind(this));var t=this.getScreens();this._state={},["watching","schedule","sidemenu","storefront","overlay","header","error","channels-list","category","404"].forEach(function(e){if(t.hasOwnProperty(e)){var s=t[e].getMod("active");this._state[e]=s?"yes"===s?"A":"P":"H"}},this)}},getNextState:function(t){var e={watching:{watching:"A",header:"P",sidemenu:"P"},schedule:{schedule:"A",header:"P",watching:"P",sidemenu:"P"},storefront:{storefront:"A",404:"P",header:"P",watching:"P",sidemenu:"P"},overlay:{watching:"A",overlay:"A"},error:{header:"P",error:"A"},"channels-list":{"channels-list":"A",404:"P",header:"P",watching:"P",sidemenu:"P"},category:{category:"A",header:"P",watching:"P"}};return this.params.settings.exp.stream_start_screen&&delete e.storefront.sidemenu,e[t]},moveState:function(t){var e=this.getNextState(t),s={};for(var i in this._state)this._state.hasOwnProperty(i)&&(e.hasOwnProperty(i)?s[i]=e[i]:s[i]="H");return s},getStateNameForDefaultChannel:function(t){if(!t.active||"watching"===t.active)return"storefront"},getStateName:function(t){var e,s=t.active,i=t.current,n=t.channel,r=this._cms.getCategories();if(e=i||n?"watching":"storefront",t.error&&(s="storefront"),"overlay"===s&&i&&i.meta.with_overlay&&i.canPlay(home.now()/1e3))return"overlay";if(!s)return"error"!==this._stateName&&this._stateName||e;switch(s){case"error":return"error";case"category":if(t.category&&r[t.category])return s;case"schedule":if(n&&!n.status.hide_schedule)return"schedule";case"storefront":return"storefront";case"channels-list":if(this.params.settings.channelsListEnabled)return"channels-list";default:return e}},set:function(t,e){e||(e={});var s=this._process={};return this._historyUpdated=!1,e.active=e.active||t||this._stateName,"category"!==e.active||e.category||(e.category=this._prevCategory),this._enrichParams(e).then(function(t){if(this._prevCategory=t.category,s!==this._process)return Promise.resolve();var e,i=this.moveState(t.active),n=this.getScreens(),r={H:[],A:[],P:[]},a=[];for(e in!t.error&&i[404]&&(i[404]="H"),i)if(i.hasOwnProperty(e)){var o=i[e];o!==this._state[e]?r[o].push(e):"H"!==o&&a.push(e)}this._stateName=t.active,this._history.update(t.active,this._getHistoryParams(t)),this._historyUpdated=!0;var c=this._updateCurrent(t,a);c.minor=c.minor.concat(r.P.map(function(e){var s=new Promise(function(s,i){var r=n[e].peek(t);this._state[e]="P",this._stream.setMod(e,"peek"),r&&r.then?r.then(s,i):s(r)}.bind(this));return s.key=e,s},this)),c.major=c.major.concat(r.A.map(function(e){var s=new Promise(function(s,i){var r=n[e].show(t);this._state[e]="A",this._stream.setMod(e,"active"),r&&r.then?r.then(s,i):s(r)}.bind(this));return s.key=e,s},this));return[].concat(c.minor,c.major).forEach(function(t){t["catch"](function(t,e){if(this.onError("handleError "+t,e),s===this._process)return this._hideScreen(t)}.bind(this,t.key))},this),Promise.all(c.major).then(function(){return s!==this._process?Promise.resolve():Promise.all(r.H.map(this._hideScreen,this)).then(function(){this.afterCurrentEvent(function(){home.stat.logDOMShow(this._stream.domElem)})}.bind(this))}.bind(this))}.bind(this))["catch"](function(i){if(s===this._process)return this.onError("stream-coordinator.set",i),this._allowedScreens.filter(function(t){return"error"!==t}).forEach(this._hideScreen.bind(this)),this._current=null,this._state.error="A",this._stateName="error",e.active=e.active||"error",this._historyUpdated||e.replace||this._history.update(t,{channel_id:e.channel_id,auto:e.auto,id:e.id}),this.getScreens().error.show({error:i,params:e,name:t})}.bind(this))},_getHistoryParams:function(t){var e=t.current||{},s=t.live||e instanceof BEM.blocks["stream-cms"].LiveProgram,i=e.channel,n=i&&i.isProjectChannel();return{auto:t.auto,replace:t.replace,channel_id:e.channel&&e.channel.channel_id,interesting:t.interesting,rewind:t.rewind,id:!s||n?e.getContentId&&e.getContentId():null,category:"category"===t.active?t.category:""}},update:function(t){if(t||(t={}),t.id||t.program)return t.active=this._stateName,this._enrichParams(t).then(function(t){this._updateCurrent(t,Object.keys(this._state))}.bind(this))},_updateCurrent:function(t,e){this._wasLive=t.live||"continue"===t.auto,this._current=t.current,this.channel("stream").trigger("coordinatorUpdate",t);var s=[],i=[];return e.forEach(function(e){var n=this._state[e];if("H"!==n){var r=new Promise(function(s,i){var n=this._screens[e].update(t);n&&n.then?n.then(s,i):s(n)}.bind(this));r.key=e,"A"===n?s.push(r):i.push(r)}},this),{major:s,minor:i}},_hideScreen:function(t){var e=this.getScreens();return e[t]?new Promise(function(s,i){var n=e[t].hide();this._state[t]="H",this._stream.delMod(t),n&&n.then?n.then(s,i):s(n)}.bind(this))["catch"](function(e){this.onError("hideScreen "+t,e)}.bind(this)):Promise.resolve()},onError:function(t,e){if(e){var s=e.meta||{};return s.screen="coordinator",s.state=this._stateName,e.message=t+(e.message?",originalErrorMessage:"+e.message:""),this._cms.onError(e)}},_onPopState:function(t,e){if(e){var s=e.active,i=e.params;this._history.lock();var n=function(){this._history.release()}.bind(this);this.set(s,i).then(n,n)}else this._stream.hide()},findProgramByChannel:function(t){var e=t.channel;return t.program?Promise.resolve(t):this._cms.getChannelOnlineProgram(e).then(function(s){if(!s)throw new Error("No online program for channel "+(e&&e.channel_id));t.program=s})},findProgramExplicit:function(t,e){return t!==this._current&&(e.program=t,e.channel=e.program.channel),Promise.resolve(e)},_enrichParams:function(t){var e=$.extend({},t),s=Promise.resolve();if(e.program)s=this.findProgramExplicit(e.program,e);else if("default"===e.channel_id||"default"===e.id)s=this._cms.getDefaultChannelProgram().then(function(t){e.live=!0,e.program=t,e.channel=t.channel,e.active=this.getStateNameForDefaultChannel(e,t)||e.active}.bind(this));else if(e.id){s=this._cms.getResourceById(e.id).then(function(s){return"channel"===s.content_type_name?(e.live=!0,e.channel=s,this.findProgramByChannel(e,t)):this._cms.getProgramByResource(s).then(function(t){return this.findProgramExplicit(t,e)}.bind(this))}.bind(this),function(){var t=(this.params.settings||{}).exp||{};if(e.error=!0,t.stream_embed_autoplay)return this._cms.getDefaultChannelProgram().then(function(t){e.live=!0,e.program=t,e.channel=t.channel})}.bind(this))}else if(e.channel||e.channel_id)if(e.channel_id&&(e.channel=this._cms.getChannelById(e.channel_id)),e.channel)e.live=!0,s=this.findProgramByChannel(e,t);else{var i=new Error("Invalid or disabled channel");i.meta={channel:e.channel_id},s=Promise.reject(i)}else e.live=this._wasLive;return s.then(function(){return e.current=e.program||this._current,e.channel=e.channel||e.current&&e.current.channel,e.channel_id=e.channel&&e.channel.channel_id,e.active=this.getStateName(e),e}.bind(this),function(t){throw this.onError("enrichParams failed",t),t}.bind(this))},back:function(t){this._history.back(t)},exit:function(){for(var t in this._state)this._state.hasOwnProperty(t)&&"H"!==this._state[t]&&this._hideScreen(t);this._stateName=""},getScreens:function(){return this._screens||(this._screens={},this._allowedScreens=this._allowedScreens.filter(function(t){var e="stream-"+t,s=this.findBlockInside(e);return!s&&$("."+e).length&&(s=$("."+e).bem(e)),s&&(this._screens[t]=s),s},this)),this._screens},_isScreenAvailable:function(t){return this._allowedScreens.indexOf(t)>=0},getDefaultParams:function(){return(home.getData("stream.stream").clientData||{}).settings},_allowedScreens:[]}),BEM.DOM.decl("stream-coordinator",{_allowedScreens:["watching","schedule","storefront","sidemenu","error","overlay","header","channels-list","category","404"]}),BEM.DOM.decl("stream-screen",{onSetMod:{js:function(){this._coordinator=BEM.blocks["stream-coordinator"].instance,this._cms=BEM.blocks["stream-cms"].init(),this._stream=BEM.blocks.stream.getInstance(),this.params=$.extend({},this._stream.params,this.params),this._locks={}}},show:function(t){return this.setMod("active","yes"),this.update(t)},peek:function(){},hide:function(){this.afterCurrentEvent(function(){this.delMod("active")},this)},canShow:function(){return!1},update:function(t){this._logScreenShow(),this._state=t},getStateLock:function(t){var e=Math.random(),s=this._locks;return s[t]=e,function(){return s[t]===e}},countShows:function(){this.afterCurrentEvent(function(){home.stat.logDOMShow(this.domElem)})},_logScreenShow:function(){var t=this._logScreenShowParams||{},e="stream."+this._name+".show";home.stat.logPath("show",e,{customParams:t})},_loadingElem:function(t,e){this.toggleMod(this.elem(t),"loading","yes","",e)},_hidingElem:function(t,e){this.toggleMod(this.elem(t),"hidden","yes","",e)},extractParams:function(t){var e=t.data();return e.origin||(e.origin=e.statlog||"other"),e},_onLinkClick:function(t){var e=t.data.domElem;if(!e.attr("disabled")){var s=this.extractParams(e),i=s.active;return this._coordinator.set(i,s)}},onError:function(t){var e=t.meta||{};return e.screen=this._name,this._current&&(e.current=this._current.content_id||this._current,e.channel=this._current.channel&&this._current.channel.channel_id),this._cms.onError(t)},prepare:function(t){return t},_playDefault:!1},{live:function(){this.liveBindTo("link","click",function(t){this._onLinkClick(t),t.preventDefault()}),this.liveBindKey("link","space enter",function(t){this._onLinkClick(t),t.preventDefault()})}}),BEM.DOM.decl("stream-screen",{scrollToTop:function(){var t=this._stream.domElem;t.scrollTop()>150&&t.stop().animate({scrollTop:0},100)}}),BEM.DOM.decl({block:"stream-404",baseBlock:"stream-screen"},{peek:function(t){return this.show(t)},update:function(t){BEM.DOM.update(this.elem("content"),t.error?home.view("stream-404__error_type_default"):"")},_name:"404"}),BEM.DOM.decl({block:"stream-header",baseBlock:"stream-screen"},{peek:function(t){this.update(t)},update:function(t){var e=t.active;this.selectCategory(t),this.select(e),this.updateLogo(e),this.__base.apply(this,arguments)},select:function(t){var e=this.elem(t);!this._selected||e&&e.is(this._selected)||this.switchElement(this._selected,!0),e&&e.length?(this._selected=e,this.switchElement(this._selected,!1)):this._selected=null},selectCategory:function(t){var e=this._getActiveCategory(t),s=this.elem("categories-item","category",e||"channels");this.dropElemCache("categories-item"),this.delMod(this.elem("categories-item"),"current"),this.switchElement(this.elem("categories-item"),!0),this.setMod(s,"current","yes"),("storefront"!==t.active||this.params.settings.videohub)&&this.switchElement(s,"watching"===t.active)},_getActiveCategory:function(t){var e=t.active,s=t.current||t.program||{},i=this._cms.getCategories(),n="channels";return"category"===e&&i[t.category]?n=t.category:"watching"===e&&s&&!s.channel&&i[s.onto_category]?n=s.onto_category:"storefront"===e&&(n=e),n},switchElement:function(t,e){e?(t.removeAttr("disabled"),t.attr("tabindex","0")):(t.attr("disabled",!0),t.removeAttr("tabindex"))},updateLogo:function(t){var e=this.elem("service");this.switchElement(e,"storefront"!==t)},goToMainpage:function(){this._stream.hide()},_onSuggestSelect:function(t,e){var s=e.item?e.item.domElem.data():e.node.dataset,i={active:"watching",id:s.streamId,origin:s.origin};i.id&&this._coordinator.set(i.active,i)},_name:"header"},{live:function(){return this.liveBindTo("mainpage","click",function(){this.goToMainpage()}),this.liveBindKey("mainpage","space enter",function(t){this.goToMainpage(),t.preventDefault()}),this.__base()}}),BEM.DOM.decl("stream-header",{},{live:function(){var t=BEM.blocks.suggest2;return t&&t.on("select",function(t,e){t.block.hasMod("behavior","stream")&&this.getInstance()._onSuggestSelect(t,e)},this),this.__base()},getInstance:function(){return this._instance||(this._instance=$(this.buildSelector()).bem(this._name)),this._instance}}),BEM.DOM.decl("stream-search",{_onSubmit:function(t){this._isEmptyInput()&&(t.preventDefault(),this._goHome())},_goHome:function(){BEM.blocks["stream-coordinator"].instance.set("storefront",{active:"storefront"})},_isEmptyInput:function(){return!this.blockInside("input").val().replace(/\s/g,"")}},{live:function(){this.liveBindTo("submit",function(t){this._onSubmit(t)})}}),BEM.DOM.decl({block:"popup",modName:"type",modVal:"stream-suggest"},{_moveToContainer:function(){this.__base(BEM.blocks.stream.getInstance().domElem)}}),BEM.DOM.decl({block:"suggest2",modName:"behavior",modVal:"stream"},{clearInput:function(){this._input.valWithoutSuggest("")},initView:function(t,e){return(e=e||{}).videoUrl=this.params.videoUrl,e.videohub2=this.params.data.videohub2,this.__base($.extend(t||{},{behavior:this.getMod("behavior")}),e)},init:function(){return this.params.form.on("submit",function(t){var e=t.block;this._isActualSearchCGIParams=!0,e.removeHiddenInputs(),e.appendHiddenInputs([{name:"path",value:"vh"}])},this),this.__base()},_onSelectItem:function(t,e){var s=this._getItemIndex(t),i=t.onSelect(e),n=t.valOnSelect();return this._text=n,this._isBlur=!0,this._freezeInputFocus=!1,this._setSearchCGIParams(t),this.trigger("select",{val:this._text,pos:this._pos,item:t,meta:this._meta,itemIndex:s,byKeyboard:e,callbackOnSelect:i}),!1!==n&&(this._items=[],this.isNeedSubmitFormOnSelectItem(t)&&this.params.form.submit()),s}}),BEM.DOM.decl({block:"suggest2-view",modName:"behavior",modVal:"stream"},{_getItemByType:function(t,e,s,i){return e=e||{},"nav"!==s&&this.params.videoUrl?e.url=home.makeUrl({path:this.params.videoUrl,query:{text:t[1],path:"vh"}}):"text"!==s&&this.params.videohub2&&(e.url=home.view("stream-url",{streamId:e.stream_id,withHost:!0}),e.target="_self"),this.__base(t,e,s,i)},_buildRich:function(t,e,s,i){var n;return i.link=!1,s.attrs=s.attrs||{},s.stream_id&&(s.attrs["data-stream-id"]=s.stream_id),s.subtype&&(s.attrs["data-origin"]="rich-"+s.subtype),"catchup"!==s.subtype&&"live"!==s.subtype||(i.subtitle=home.view("stream-time__string",{program:{start_time:s.start_time,end_time:s.finish_time}})),(n=this.__base(t,e,s,i)).mods.behavior=this.getMod("behavior"),n}}),BEM.DOM.decl({block:"suggest2-item",modName:"behavior",modVal:"stream"},{onSelect:function(t){this.triggerEvent("select",{val:"",byKeyboard:t})}}),BEM.DOM.decl({block:"suggest2-counter",modName:"behavior",modVal:"stream"},{clear:function(){return this.__base.apply(this,arguments),this._blurDuration=0,this._blurTime=null,this._blurDurationFirstChange=0,this._blurDurationLastChange=0,this},_onInputChange:function(t,e){e&&"clear"!==e.source||(this._params.user_input=t.block.val(),this._firstChange=this._firstChange||new Date,this._lastChange=new Date,this._startInputTime||(this._startInputTime=this._firstChange.getTime())),this._selectedText&&(this._path.state="edit"),this._blurDurationLastChange=0,this._ratio.actionsCount++},_onInputFocus:function(){this._startInputTime||this._startClickTime||(this._startClickTime=Date.now()),this._startInputTime=this._startInputTime||this._startClickTime;var t=this._blurTime&&Date.now()-this._blurTime;t>300&&(this._blurDuration+=t,this._blurTime=null,0!==this._lastChange&&(this._blurDurationLastChange+=t),0!==this._firstChange&&(this._blurDurationFirstChange+=t))},_onInputBlur:function(){this._blurTime=Date.now()},_getSinceChange:function(){var t=this.__base.apply(this,arguments);return t.total_input_time=this._getTotalInputTime(),t},_getSinceTime:function(t){var e="_"+t+"Change";return this._sinceChange[t]=this[e]?Date.now()-this[e]-("first"===t?this._blurDurationFirstChange:this._blurDurationLastChange):0,this._sinceChange[t]},_getTotalInputTime:function(){return this._startInputTime&&Date.now()-this._startInputTime-this._blurDuration||0},_onSuggestSelect:function(t,e){this._path.state=e.byKeyboard?"keyboard":"mouse",this._path.index=e.itemIndex+1,this._selectedText=e.val,e.item.hasMod("personal")&&(this._path.personal="nah_used"),this.params.submitBySelect&&(this._path.submit=e.byKeyboard?"keyboard":"click_by_mouse",this._params.pos=e.pos,this._params.text=this._selectedText),this.params.suggest.isNeedSubmitFormOnSelectItem(e.item)||this.submit({val:e.item.hasMod("behavior")?e.val:"",submitForm:!1,afterSendAjaxCallback:e.callbackOnSelect}),e.item.params.safeclickUrl&&((new Image).src=e.item.params.safeclickUrl)},submit:function(t){var e=this.params.suggest.params["suggest2-input"],s=t&&t.val||e.val();this._params.text=s,this._params.pos=e.getCaretPosition(),this._params.times=this._requests.map(function(t){return!t.error&&t.duration?t.duration:0}).join("."),this.params.suggestReqID&&this.attachReqID(),this._input.elem("control").blur(),this.sendAjax(this.getUrl(),$.extend({submitForm:!0,afterSendAjaxCallback:function(){}},t)),this.trigger("submit",this._getSubmitEventData()).clear(),this._params.prev_query=s},_getSubmitEventData:function(){return{path:this._path,times:this._times,render_times:this._params.times,prev_query:this._params.prev_query,user_input:this._params.user_input,text:this._params.text,pos:this._params.pos,ratio:this._ratio,since_first_change:this._sinceChange.first,since_last_change:this._sinceChange.last,session:this._session,suggest_reqid:this._reqID,meta:this._meta,url:this.getUrl(),parent_reqid:this.params.params.parent_reqid}}}),BEM.DOM.decl({block:"suggest2",modName:"colorize",modVal:"dark"},{initView:function(t,e){return this.__base($.extend(t||{},{colorize:this.getMod("colorize")}),e)}}),BEM.DOM.decl({block:"suggest2-view",modName:"colorize",modVal:"dark"},{_getItemByType:function(t,e,s,i){return i.mods=i.mods||{},i.mods.colorize=this.getMod("colorize"),this.__base(t,e,s,i)},_buildThumb:function(t,e,s,i){return s="portrait"===t.aspect?"l":"s",this.__base(t,e,s,i)},_buildRich:function(){var t=this.__base.apply(this,arguments);return t.mods.colorize=this.getMod("colorize"),t}}),BEM.DOM.decl({block:"suggest2-view",modName:"group-video-label",modVal:"yes"},{buildGroup:function(t,e,s){s[0].content="text"===e?home.l10n("stream.suggest.label.video_search"):"";var i=this.__base(t,e,s);return"text"===e?[{block:"suggest2",elem:"group-delimiter"},i]:i}}),BEM.DOM.decl({block:"stream-coordinator",modName:"adventure",modVal:"yes"},{nextAdventureEpisode:function(t,e){return this._stream.projectEpisode(t).then(function(t){return e.current=e.program=t,e.channel=t.channel,e.channel_id=t.channel.channel_id,t.is(home.now()/1e3)||(e.rewind=e.current&&e.current.content_id,this._rewind=!0),e.interesting=!0,e}.bind(this))},findProgramExplicit:function(t,e){var s=t&&t.channel;return s&&s.isProjectChannel()&&this._rewind&&("auto-next"===e.origin||"continue"===e.auto)?(e.replace=!0,e.auto=!0,e.live=!0,this.nextAdventureEpisode(s.meta.project_alias,e)):(t!==this._current&&(this._rewind=!1),this.__base.apply(this,arguments))},findProgramByChannel:function(t){var e=t.channel;return e&&e.isProjectChannel()?t.rewind?this._cms.getResourceById(t.rewind).then(function(e){return t.current=t.program=e,t.channel=e.channel,t.channel_id=e.channel.channel_id,t}):t.interesting||!this._rewind&&!t.live?this.__base.apply(this,arguments):this.nextAdventureEpisode(e.meta.project_alias,t):(this._rewind=!1,this.__base.apply(this,arguments))}}),BEM.DOM.decl({block:"stream-watching",baseBlock:"stream-screen"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._streamStickers=this.findBlockInside("stream-stickers"),this._streamChat=null},active:{yes:function(){this._bindEvents()}},"":function(){this._unbindEvents()}},_bindEvents:function(){this._listenScroll(),this.channel("stream").on("chat",this._setChatMod,this)},_unbindEvents:function(){this._unlistenScroll(),this.channel("stream").un("chat",this._setChatMod,this)},canShow:function(){return!0},peek:function(){this._current&&this._current.meta.with_overlay&&this.destroyPlayer(),this.setMod("active","peek"),this.updateStickers(this._current),this._streamChat&&this._streamChat.deleteChat()},hide:function(){this.pause(),this.destroyPlayer(),this._current=null,this._prev=null,this._streamChat&&this._streamChat.deleteChat(),this.__base()},show:function(){this.__base.apply(this,arguments),this.updateStickers(this._current),this.updateChat(this._current)},update:function(t){return this.hasMod("active")?(t.auto||this.scrollToTop(),this._setlogScreenShowParams(t),this.toggleMod("project","yes","",t.channel&&t.channel.isProjectChannel()),this.channel("stream-more-info").trigger("update"),this.__base.apply(this,arguments),this._updateAnnounce(t).then(this._updateCurrentProgram.bind(this))):Promise.resolve()},_setChatMod:function(t,e){switch(e.open){case"yes":this.setMod("chat-open","yes");break;case"no":this.setMod("chat-open","no");break;default:this.toggleMod("chat-open","yes","no")}},_getChatHtml:function(t){var e=t&&t.auto_fields||{};if(!e.chat_id)return"";var s=!(t instanceof BEM.blocks["stream-cms"].AnnouncePlug||t instanceof BEM.blocks["stream-cms"].VoidProgram);return home.view("stream-chat",{chatId:e.chat_id,contentId:t.getContentId(),startTimeText:home.view("stream-time__time",t),isOnline:t.is(home.now()/1e3)&&s,theme:this.params.settings.videohub?"white":"dark"})},_setlogScreenShowParams:function(t){var e=t.program||t.current,s=e instanceof BEM.blocks["stream-cms"].VoidProgram,i=e?{content_id:e.content_id,content_type:e.content_type_name}:{};t.channel&&(i.channel_id=t.channel.channel_id),s&&(i.start_time=e.start_time,i.end_time=e.end_time),this._logScreenShowParams=i},_updateAnnounce:function(t){var e=t.program||t.current;if(!e)return Promise.resolve(t);var s=e instanceof BEM.blocks["stream-cms"].VoidProgram,i=e instanceof BEM.blocks["stream-cms"].LiveProgram,n=e.fromFuture(),r=s&&e.channel.status.auto_announce,a=e.canPlay(home.now()/1e3);return e.isForbidden()?(t.program=this.generateAnnounce(e),t.program.meta.hasLive=!1,Promise.resolve(t)):"overlay"===t.active?Promise.resolve(t):n||!s&&!(t.live||i&&t.auto)&&!a?(t.program=this.generateAnnounce(e),Promise.resolve(t)):e.meta.with_overlay?(t.program=this.generateAnnounce(e),t.program.meta.playProgram=e,Promise.resolve(t)):r?this.enrichVoidWithNeighbours(e).then(function(e){return t.program=this.generateAnnounce(e),Promise.resolve(t)}.bind(this),function(t){throw this.onError("couldn't generate announce",t),t}.bind(this)):Promise.resolve(t)},_updateCurrentProgram:function(t){var e=t.program||t.current,s=this._disabledByUser&&this.hasMod("active","peek"),i=(e&&e.channel||{}).branding||{},n=e&&e.auto_fields||{};t.camera===undefined&&this._current===e||(this._camId=t.camera||"default"),this._shouldChangeCurrent(e)?("initial"==t.origin&&this.hasMod("active","peek")&&(t.origin="initial.pip"),this.needUpdateRelatedData=!0,this._prev=this._current,this._current=e,this._isChannelBranding=i&&i.image&&i.logo,this._programHasChat=n.with_chat&&n.chat_id,this.setMod("type",e.content_type_name),this._cms.setCurrentWatchingParams(e,{stream_block:t.origin}),!e||s&&!this._isEmbedPlayerExp(t)||(this.channel("stream").trigger("episodeChange",e),this._disabledByUser=!1,"continue"===t.auto&&this.player||this.play(e)),this._setNeighbours(t),this.updateProgram(this._current),this.updateCameras(this._current),this._updateRelatedData()):this._updateRelatedData()},_isEmbedPlayerExp:function(){return!1},_updateRelatedData:function(){this.needUpdateRelatedData&&!this.hasMod("active","peek")&&(this.needUpdateRelatedData=!1,this.updateButton(this._current),this.updateBetButton(this._current),this.updateStickers(this._current),this.updateNav(this._current),this.updateProject(this._current),this.updateMore(this._current),this.updateChat(this._current))},_shouldChangeCurrent:function(t){return t&&this._current&&t.content_id===this._current.content_id?!this.player||(!(!t||t.getActiveCam()===this._camId)||void 0):t!==this._current},_setNeighbours:function(){if(!this._current||this._current instanceof this._cms.AnnouncePlug)this._next=null;else{var t=this.getStateLock("setprogram");this._cms.getNextForProgram(this._current).then(function(e){t()&&e&&(this._next=e)}.bind(this),function(t){this._next=null,this.onError({message:"_setNeighbours -> "+(t&&t.message),originalMessage:t&&t.originalMessage})}.bind(this))}},updateNav:function(){},updateButton:function(){},updateStickers:function(t){if(this._streamStickers){var e=this.hasMod("active","peek"),s=this.hasMod(this.elem("player"),"fullscreen","yes"),i=!this.params.settings.stickersDisabled&&!e&&!s&&t&&t.getStickerpack();this.setMod(this.elem("player-wrapper"),"bg",i?"yes":"no"),this._streamStickers.updateStickers(t,i)}},updateProject:function(){},updateCameras:function(t){var e=t&&t.getCameras(),s=this.elem("cameras");if(e.length<2)return this._camerasFor=null,this.setMod(s,"hidden","yes"),s.html("");if(this.hasMod(s,"hidden")&&this.delMod(s,"hidden"),this._camerasFor===t.content_id){var i=this.findBlockInside("cameras",{block:"stream-tile",modName:"selected",modVal:"yes"});i&&(i.delMod("disabled"),i.delMod("selected")),(i=this.findBlockInside("cameras",{block:"stream-tile",modName:"camera",modVal:this._camId}))&&(i.setMod("disabled","yes"),i.setMod("selected","yes"))}else this._camerasFor=t.content_id,s.html(home.view("stream-watching__cameras",{active:this._camId,cameras:e}))},updateMore:function(t){var e=this.getStateLock("more"),s=this.getStateLock("side-more"),i=t.channel,n=i&&i.catchup_age,r=i&&i.isProjectChannel(),a=[],o=[],c=t.hasVodLib();this.params.settings.disableWatchingCarousels||a.push(this._drawCarousels([],!0)),c&&a.push(this._drawProgramEpisodes({})),o.push(this._drawRecommended()),this.drawSideMore(o),this.drawMore(a);var l=[],h=[];return r&&(l=l.concat(this._drawProjectBlocks())),c&&l.push(this.safeDo(this._updateVodEpisodes(t),{programs:[]}).then(this._drawProgramEpisodes.bind(this))),n&&!c&&l.push(this.safeDo(this._cms.getRelatedPrograms(t).then(function(t){return{programs:t,origin:"watching.serial_catchup"}}),{programs:[]}).then(this._drawProgramEpisodes.bind(this))),h.push(this.safeDo(this._cms.getDoc2DocRecommendations(t),[]).then(this._drawRecommended.bind(this))),Promise.all(h).then(function(t){s()&&this.drawSideMore(t)}.bind(this)),Promise.all(l).then(function(t){e()&&this.drawMore(t)}.bind(this))},_drawProjectBlocks:function(){return[]},_drawCarousels:function(){return""},drawSideMore:function(t){var e=t.join(""),s=this.elem("right");this.setMod("related",e.length?"yes":""),this.setMod("right",e.length?"yes":""),BEM.DOM.update(s,e),this.countShows()},drawMore:function(t){BEM.DOM.update(this.elem("more"),t.join("")),this.countShows()},updateProgram:function(t){var e=this.elem("info-anchor");(t.title||t.program_title)&&(BEM.DOM.update(this.elem("player-header"),this._getProgramTitleHtml(t)),t.description?(BEM.DOM.update(this.elem("info-place"),home.view("stream-watching__info",{description:t.description,title:home.l10n("stream.about")})),this.delMod(e,"hidden"),this.findBlockInside("stream-more-info")):(BEM.DOM.update(this.elem("info-place"),""),this.setMod(e,"hidden","yes")),this.updateProgramMetas(t),this._loadingElem("player-header",!1))},updateBetButton:function(t){t.meta.with_sport_prediction||t.channel&&t.channel.meta.with_sport_prediction?(this.setMod("bet","yes"),this._scrollCounted=!1,BEM.blocks["i-multiline-overflow"].calcOverflow(this.elem("bet-text"),2,"stream-watching-bet")):this.hasMod("bet")&&this.delMod("bet")},_getProgramTitleHtml:function(t){return home.view("stream-program-title",{mods:{player:"layout"},program:t,parent:"stream-watching__player-header",superres:t.meta&&t.meta.superres?home.view("stream-superres",{url:this.params.settings.superresUrl,mix:"stream-watching__superres",mods:{popup:"yes"}}):""})},_drawRelated:function(t,e){var s=(t.program_title?t.program_title+"&nbsp;&mdash; ":"")+home.l10n("stream.more_episodes");return home.view("stream-more",{mix:"stream-watching__related",title:s,content:home.view("stream-list",{title:s,programs:e.map(function(t){return $.extend({},t,{program_title:"",title:t.title||t.program_title})}),statRoot:"stream.watching.more_episodes",origin:"watching.serial_catchup",parent:"stream-watching",mods:{expand:"yes"}})})},_drawRecommended:function(t){return home.view("stream-more",{mix:"stream-watching__recommended",title:home.l10n("stream.side_recommended"),content:home.view("stream-grid",{programs:t,doc2doc:!0,statRoot:"stream.watching.doc2doc_recommended",origin:"watching.doc2doc",parent:"stream-watching",maxCount:this._gridCapacity,mods:{doc2doc:"yes",expand:"yes"}})})},_updateVodEpisodes:function(t){if(!t.hasVodLib())return Promise.resolve([]);var e=t.content_id.replace("announce_","");return t.getVodLib().then(function(t){return t.getEpisodes({limit:52}).then(function(s){return{programs:s=s.filter(function(t){return t.content_id!==e}),title:t.more_title}})})},_drawProgramEpisodes:function(t){var e=t.programs,s=t.title,i=this.params.settings.disableWatchingCarousels?6:3;return home.view("stream-more",{title:s||home.l10n("stream.more_episodes"),mix:"stream-watching__program-episodes",content:home.view("stream-list",{mods:{thumbnail:"yes",expand:"yes"},listCount:i,statRoot:t.statRoot?t.statRoot:"stream.watching.more_vodepisodes",origin:t.origin?t.origin:"watching.serial_vod",parent:"stream-watching",programs:e&&e.map(function(t){return $.extend({},t,{program_title:"",title:t.title||t.program_title})})})})},safeDo:function(t,e){var s=Error().stack;return t["catch"](function(t){return t&&(t.message="safeDo->"+t.message,t.stack=t.stack+s.replace(/^([^\n]+)/,""),t.meta=t.meta||{},this.onError(t)),e}.bind(this))},infoLoaded:function(){},getPlayer:function(t){return this._creatingPlayer?this._creatingPlayer:this.createPlayer(t,this.getStartPosition(t))},destroyPlayer:function(){var t;return this._creatingPlayer&&!this.player?this._creatingPlayer.then(this.destroyPlayer.bind(this)):(this.player?(t=this.player.destroy(),this.player=null,this.setMod("api-inited","no")):t=Promise.resolve(),this.setMod(this.elem("problem-report"),"hidden","yes"),this._creatingPlayer=null,t)},createPlayer:function(t,e){var s=this,i=this.params.settings.playerVersion,n=this.hasMod("active","peek")&&!this.hasMod("embedPlayer","yes");return i||this.onError({message:"stream-watching.createPlayer: playerVersion is undefined"}),this.destroyPlayer().then(function(){return this.elem("player-elem").html(""),this.delMod(this.elem("problem-report"),"hidden"),s.params.settings.disableReport&&this.setMod(this.elem("problem-report"),"hidden","yes"),this._creatingPlayer=Ya.streamPlayer.init({source:t.getSourceConfig(e),element:"stream-watching__player",version:i,autoplay:!0,muted:!!s.hasMod("active","peek")||undefined,showLowConnectionSpeedAlert:s.params.settings.slowConnectionAlert,report:{enabled:!s.params.settings.disableReport},hidden:n?"*":"",handlers:{onFullScreenChange:s.onFullScreenChange.bind(s),onError:function(t){t.isFatal&&(-1===t.code||(s._creatingPlayer=null,s.onError({message:"Ya.streamPlayer.handlers.onError: Player API shut down after errors",meta:{errorCode:t.details?t.details.errorCode:t.code,messageCode:t.details?t.details.messageCode:"",message:t.message,playerVersion:i,playerSrc:t.details?t.details.src:""}})))},onCurrentTimeChange:s.onPlayerTimeChange.bind(s),onStateChange:function(t){if(1===t||3===t||5===t)s.delMod(s.elem("player-elem"),"hidden","yes"),s.setMod("state","playing"),BEM.blocks["stream-rum"].sendMark("playerStart");else{if(0===t)return s._onEpisodeEnd();s.delMod("state")}},onAdStateChange:s.onAdStateChange.bind(s)}}).then(function(e){return s._prev=t,s.player=e,s.onPlayerReady(),s.player}),this.setMod("api-inited","yes"),BEM.blocks["stream-rum"].sendMark("playerCreate"),this._creatingPlayer}.bind(this))["catch"](function(t){this.onError({message:"createPlayer fail -> "+(t&&t.message)}),s.delMod("has-miniplayer")}.bind(this))},play:function(t){var e=this.getStateLock("play");return this.getPlayer(t).then(function(){if(e()&&this.player)return this.startPlaying(t)}.bind(this))},pause:function(){this.player&&this.player.pause()},getStartPosition:function(t){var e=t.channel||{},s=t.meta||{};return this.player&&this._prev&&this._prev.eq(t)&&t.getActiveCam()!==this._camId?this.player.getCurrentTime():t&&t.is(home.now()/1e3)&&("auto-next"!==this._cms.getCurrentWatchingParams().stream_block||s.without_timeline)?e.status.move_start||s.without_timeline?home.now()/1e3-t.start_time:void 0:0},startPlaying:function(t){if(this._prev&&this._prev.eq(t,this._camId))return this.player&&2===this.player.getState()?this.player.play():Promise.resolve();var e=this.getStartPosition(t);t.switchToCamera(this._camId);var s=t.getSourceConfig(e);return this.player.setSource(s).then(function(){this.player.play()}.bind(this),function(s){if(s&&-1===s.code)return this.createPlayer(t,e)}.bind(this))},playProgramFor:function(t,e){var s=this._cms.getCached("info",{parent_id:e.content_id,start_to:t,end_from:t});if(s)return this._nextFetchTry=null,this._coordinator.set(null,{program:s,auto:"continue"});var i=+home.now()/1e3;if(!this._nextFetchTry||this._nextFetchTry<=i){if(this._cms.getProgramFor(e.content_id,t),this._nextFetchTry){var n=new this._cms.VoidProgram({start_time:this._nextFetchTry,end_time:i+5,parent_id:e.content_id},e);this._coordinator.update({program:n,auto:"continue"})}this._nextFetchTry=i+5}},onPlayerReady:function(){BEM.blocks["stream-rum"].sendMark("playerInit"),this._streamStickers&&!this.hasMod("active","peek")&&this._streamStickers.resizeCanvas()},onPlayerTimeChange:function(t,e){this._current&&this._current instanceof this._cms.LiveProgram&&(e||(e=home.now()/1e3),!this._current.is(e)&&this._current.channel?this.playProgramFor(this._current.screwTime(e),this._current.channel):this._nextFetchTry=null)},onAdStateChange:function(t){1===t.state?this.setMod("state","playing"):this.delMod("state"),this.channel("stream").trigger("onAdStateChange",t)},onFullScreenChange:function(t){this.toggleMod(this.elem("player"),"fullscreen","yes","",t),this.updateStickers(this._current)},getPlayerTime:function(){if(this.player){var t=this._current||{},e=(t.channel||{}).status||{},s=t.start?t.start():t.start_time,i=this.player.getUtcPosition();return!i&&e.move_start&&(i=s+this.player.getCurrentTime()),i}},_onEpisodeEnd:function(){if(this._next)return this._startNextEpisode()},_startNextEpisode:function(){return this._coordinator.set(null,{program:this._next,origin:"auto-next",auto:!0})},_restartCurrent:function(){var t=this._current;if(t){if(t instanceof this._cms.LiveProgram)return this.onError({message:"_restartCurrent: only Live available for "+t.title+"("+t.parent_id+", "+t.content_id+")"});this.player&&this.player.seek(0)}},_startPreviousEpisode:function(){return this._coordinator.set(null,{program:this._prev,origin:"auto-next",auto:!0})},_problemReport:function(){this.player?this.player.openReportWindow():this._creatingPlayer&&this._creatingPlayer.then(function(){this.player.openReportWindow()}.bind(this))},generateAnnounce:function(t){var e,s=t.channel instanceof this._cms.Channel;return t instanceof this._cms.VoidProgram&&(t=t.meta.nextProgram||t.meta.prevProgram||t,s=!1),(e=new this._cms.AnnouncePlug(t,t.channel,!0)).meta.hasLive=s,e},enrichVoidWithNeighbours:function(t){return t.meta&&t.meta.nextProgram?Promise.resolve(t):this._cms.getNextForProgram(t).then(function(e){return e&&(t.end_time=e.start_time,t.meta=t.meta||{},t.meta.nextProgram=e),Promise.resolve(t)},function(){return Promise.resolve(t)})},_isBetButtonVisible:function(t){if(!this.elem("bet").is(":visible"))return!1;var e=this.elem("bet-button"),s=window.innerHeight,i=e.offset().top+t,n=t+s,r=i+e.height();return t<=i&&r<n&&!this._scrollCounted},_onScroll:function(t,e){this._isBetButtonVisible(e)&&(this._scrollCounted=!0,home.stat.logPath("show",this.elem("bet-button").attr("data-statlog")+".realshow"))},_listenScroll:function(){this.channel("stream").on("scroll",this._onScroll,this)},_unlistenScroll:function(){this.channel("stream").un("scroll",this._onScroll,this)},_name:"watching",_gridCapacity:8},{live:function(){return this.liveBindTo("problem-report","pointerclick",function(){this._problemReport()}),this.liveBindKey("problem-report","space enter",function(t){this._problemReport(),t.preventDefault()}),this.liveBindTo("reload","click",function(){this._restartCurrent()}),this.liveBindKey("reload","space enter",function(t){this._restartCurrent(),t.preventDefault()}),this.__base()}}),BEM.DOM.decl("stream-watching",{onSetMod:{js:function(){this.__base.apply(this,arguments),this.params.settings.shareDisabled||(this._streamShare=this.findBlockInside("stream-share")),this._infinityCarousels=null,this._isWatchingInfinity=this.params&&this.params.settings&&this.params.settings.exp&&this.params.settings.exp.stream_watching_infinity,this._carouselsPerTime=this._isWatchingInfinity?10:4,this._scheduleVisible=window.innerWidth>=1600,this._onResizeThrottled=home.throttle(this._onResize,300),this.bindToWin("resize",this._onResizeThrottled),this._updateDots(),this.setChatPositionMod=this._setChatPositionMod.bind(this),this.mediaQuery=window.matchMedia("(max-width: 1020px)")},state:{playing:function(){this.countShows(),!this.hasMod("has-miniplayer")&&this.hasMod("active","peek")&&this.setMod("has-miniplayer","yes"),this.__base.apply(this,arguments)}},active:{yes:function(){this.hasMod("active","peek")&&this.afterCurrentEvent(this._loadCarouselImages),this.__base.apply(this,arguments)}},"chat-container":{right:function(){this.afterCurrentEvent(function(){this._insertChat(this._current)},this)},bottom:function(){this.afterCurrentEvent(function(){this._insertChat(this._current)},this)}}},show:function(){this.__base.apply(this,arguments),this.delMod("bigger-player"),this.delMod("has-miniplayer"),this.elem("player-container").css("background-image",""),this._playerShown=!0,this._infinityCarousels&&this._isWatchingInfinity&&this._infinityCarousels.listenEvents()},hide:function(){this.__base.apply(this,arguments),this._infinityCarousels&&this._isWatchingInfinity&&this._infinityCarousels.stopListenEvents()},update:function(t){this._setEmbedPlayerMod(t),this._updatePlayerControls(),this.__base.apply(this,arguments)},_onResize:function(){window.innerWidth>=1600&&!this._scheduleVisible?(this._scheduleVisible=!0,this._updateSchedule(this._current)):window.innerWidth<1600&&this._scheduleVisible&&(this._scheduleVisible=!1),this._updateDots()},_updateDots:function(){BEM.blocks["i-multiline-overflow"].calcOverflow(this.elem("right"),2)},_updateCurrentProgram:function(){var t=this.params.settings;this.__base.apply(this,arguments),this.updateShare(this._current);var e=this._current||this.params.program;e&&e.meta&&e.meta.with_overlay&&this.setMod("channel-overlay","yes"),this.hasMod("active","peek")&&this.updateMiniPlayerInfo(this._current),this.updateBackPlaceButton(this._current),this.updatePlayerPosition(this._current),t.channelBrandingEnabled&&this._updateChannelBranding(this._current)},updateShare:function(t){this._streamShare&&(this._streamShare.isReady()?this._streamShare.updateShareContent(t):this._streamShare.on("ready",function(){this._streamShare.updateShareContent(t)}.bind(this)))},updatePlayerPosition:function(t){t&&(this._cms.getCategories()[t.onto_category]||!t.channel?this.setMod("player-nail","menu"):this.delMod("player-nail"))},updateBackPlaceButton:function(t){var e="",s=!(this.params.settings.channelBrandingEnabled&&this._isChannelBranding);this._showChannelInfo&&t&&!t.is(home.now()/1e3)&&t.channel&&"chmf2018"!==t.channel.meta.project_alias&&1!==t.channel.status.overlay?(e=home.view("stream-online-button",{content:s?home.l10n("stream.tv_back_to_live"):home.l10n("stream.tv_button"),parent:"watching",mods:{active:"watching",theme:s?"white-text":""},url:home.view("stream-url",{streamChannel:t.channel.channel_id}),statRoot:"stream.watching.online-button",attrs:{"data-id":t.channel.content_id,"data-active":"watching",tabindex:0},mix:s?" stream-watching__button2":""}),this.elem("online").html(e)):this.elem("online").html("")},updateButton:function(t){var e=t.channel||{},s=this.params.settings,i=e.status&&e.status.hide_schedule,n="",r=s.channelBrandingEnabled,a=this._isChannelBranding;i||(n=home.view("stream-navbutton",{parent:"watching",type:"schedule",channelBrandingEnabled:r&&a,urlParams:{streamActive:"schedule",streamChannel:e.channel_id}})),this.elem("switch-place").html(n)},updateNav:function(t){var e=this.getStateLock("updatenav"),s=t&&t.canRestart(home.now()/1e3),i=t&&t.meta.playProgram;return i&&(t=i),(t?t instanceof BEM.blocks["stream-cms"].VodProgram&&t.parent_vod_lib_id?t.getNeighbours()["catch"](function(t){return this.onError({message:"vod_yes.updateNav -> "+t.message,originalMessage:t.originalMessage}),[]}.bind(this)):t.channel&&(this._current instanceof BEM.blocks["stream-cms"].Program||this._current instanceof BEM.blocks["stream-cms"].VoidProgram||this._current instanceof BEM.blocks["stream-cms"].AnnouncePlug&&this._current.start_time)?this._cms.getPrograms({parent_id:this._current.channel.content_id,end_from:this._current.start_time-1,start_to:this._current.end_time+1})["catch"](function(t){return this.onError({message:"player_yes.updateNav -> "+t.message,originalMessage:t.originalMessage}),[]}.bind(this)):Promise.resolve([]):Promise.resolve([])).then(function(t){e()&&this.drawNav(s,t)}.bind(this))},updateCameras:function(t){var e=t&&t.getCameras();this.setMod(this.elem("cameras"),"size",e.length),this.__base.apply(this,arguments)},drawNav:function(t,e){var s=e&&e[0],i=e&&e[e.length-1],n=s instanceof BEM.blocks["stream-cms"].VoidProgram?null:s,r=i instanceof BEM.blocks["stream-cms"].VoidProgram?null:i;n||r||t?this.setMod("nav","yes"):this.delMod("nav"),BEM.DOM.update(this.elem("nav"),home.view("stream-watching__nav",{prev:n,next:r,restart:t,now:home.now()/1e3}))},updateProgram:function(t){this.__base.apply(this,arguments),this.setMod(this.elem("problem-report"),"detailed",t.description?"no":"yes");var e=this.findBlockInside("stream-superres");e&&e.hidePopup();var s=t.channel&&t.channel.status;this._showChannelInfo=s&&!s.hide_schedule,this.setMod("with-schedule",this._showChannelInfo?"yes":"no"),this._updateChannelInfo(t),this._updateSchedule(t)},_updateChannelInfo:function(t){this._isChannelBranding||BEM.DOM.update(this.elem("channel"),home.view("stream-watching__channel",{program:t}))},_updateChannelBranding:function(t){if(t){var e=this.elem("branding-img"),s=this.elem("header"),i=t.channel||{},n=i&&i.branding,r=new Image;if(!this._isChannelBranding)return e.css("background-image",""),void this.delMod("branding");e.css("background-image","url("+n.image+")"),r.onload=function(){r.removeAttribute("width"),r.removeAttribute("height"),s.css("visibility","visible")},r.src=n.logo,r.alt=i.title||"",r.classList.add("stream-watching__branding-channel-logo"),BEM.DOM.update(this.elem("channel"),home.view("stream-watching__branding-channel",r)),this.setMod("branding","yes")}},_updateSchedule:function(t){if(t&&this._scheduleVisible)if(BEM.DOM.update(this.elem("schedule"),home.view("stream__loader",{})),this._showChannelInfo){var e=this._cms.dayStart(),s=t.channel||{},i=this.getStateLock("updschedule");this._cms.getPrograms({parent_id:s.content_id,end_from:e,start_to:e+86400}).then(function(n){var r,a,o=t,c=home.now()/1e3,l=s.catchup_age||0,h=0,m=0;t.is(c)||n.forEach(function(t){t.is(c)&&(o=t)}),r=Math.max(Math.min(c-l,o.start()-1),e),(n=n.filter(function(t){if(t.start_time>=e&&t.end_time>r)return h++,t.content_id===o.content_id&&(m=h),!0})).length>50&&(a=Math.max(m-Math.round(25),0),n=n.slice(a,a+50)),i()&&this._drawSchedule(n,o)}.bind(this),function(t){BEM.DOM.update(this.elem("schedule"),""),this.onError({message:"_updateSchedule -> "+t.message,originalMessage:t.originalMessage})}.bind(this))}else BEM.DOM.update(this.elem("schedule"),"")},_drawSchedule:function(t,e){var s=home.now()/1e3,i=this._current&&this._cms.dayStart(this._current.start_time);0!==t.length?(BEM.DOM.update(this.elem("schedule"),home.view("stream-watching__schedule",{items:t,canRestartCurrent:this._current.canRestart(s),dayEnd:i+86400,playing:this._current.content_id,currentProgram:this._current,enabled:t.map(function(t){return{item:t,enabled:!(!e||e.content_id!==t.content_id)||t.canRestart(s)}})})),this.countShows()):BEM.DOM.update(this.elem("schedule"),"")},_getProgramTitleHtml:function(t){return this.__base.apply(this,arguments)+home.view("stream-watching__restriction",t)},updateProgramMetas:function(t){var e,s=this._stream.params.settings.scheduleWarning&&t.channel&&!t.channel.meta.no_schedule_warning?", "+home.l10n("stream.schedule_warning").toLowerCase():"";t.meta&&t.meta.subtitle?e=t.meta.subtitle:t.start_time&&(e=home.view("stream-time__string",{program:t,mods:{time:"yes"}})+s),this.elem("live-time").text(e||"")},updateMiniPlayerInfo:function(t){if(t){var e=t.program_title||t.title||"",s="stream-watching__player_"+(this.hasMod("bigger-player","yes")?"big":""),i=t.channel&&t.channel.thumbnail||t.thumbnail,n="";t.channel&&!t.channel.status.hidden&&(n=t.channel.title),BEM.DOM.update(this.elem("player-info"),home.view("stream-watching__player-info",{title:e,channel:n})),BEM.blocks["i-multiline-overflow"].calcOverflow(this.elem("player-info"),2,s),i&&this.elem("player-container").attr({style:home.view("stream-thumbnail",{thumbnail:i})})}},updateMore:function(){return this.__base.apply(this,arguments).then(this._addInfinityCarousels.bind(this))},_addInfinityCarousels:function(){this.params.settings.disableWatchingCarousels||(BEM.DOM.append(this.elem("more"),this._getInfinityCarouselsHtml()),this._infinityCarousels=this.findBlockInside("stream-infinity-carousels"))},_getInfinityCarouselsHtml:function(){return home.view("stream-more",{title:"",mix:"stream-watching__carousels",content:home.view("stream-infinity-carousels",{carouselsPerTime:this._carouselsPerTime,infinity:this._isWatchingInfinity,showRating:this.params.settings&&this.params.settings.exp.stream_kprating,parent:"watching"})})},peek:function(t){var e,s=this._current||t.program,i=s&&s.canPlay(home.now()/1e3),n=s&&s.meta&&s.meta.with_overlay;this.__base.apply(this,arguments),this._setEmbedPlayerMod(t),this._current||this.update(t),this._playerShown||(this.setMod(this.elem("player-elem"),"hidden","yes"),this.setMod("bigger-player","yes")),n||!i&&!this.hasMod("state","playing")||this.setMod("has-miniplayer","yes"),this.updateMiniPlayerInfo(this._current),this._playerShown=!0,this._updatePlayerControls(),this._creatingPlayer&&this._creatingPlayer.then(function(){e=this.player.getAdState(),this.togglePlayerOverlayMod(e)}.bind(this)),this._infinityCarousels&&this._isWatchingInfinity&&this._infinityCarousels.stopListenEvents()},_updatePlayerControls:function(){var t=this.hasMod("active","peek")&&!this.hasMod("embedPlayer","yes");this._creatingPlayer&&this._creatingPlayer.then(function(){this.player.setHiddenControls(t?"*":"")}.bind(this))},_setEmbedPlayerMod:function(t){this._isEmbedPlayerExp(t)?(this.setMod("has-miniplayer","yes"),this.setMod("embedPlayer","yes")):this.delMod("embedPlayer")},_isEmbedPlayerExp:function(t){var e=this.params.settings.exp&&this.params.settings.exp.stream_embed_autoplay,s=this.hasMod("active","peek");return"storefront"===t.active&&s&&e},togglePlayerOverlayMod:function(t){this.setMod(this.elem("player-overlay"),"min",1===t.state?"yes":"no")},scrollToInfo:function(){var t=this.elem("info")[0].getBoundingClientRect().top+this._stream.domElem.scrollTop();this._stream.domElem.animate({scrollTop:t},300)},onAdStateChange:function(t){this.__base.apply(this,arguments),this.hasMod("active","peek")&&this.togglePlayerOverlayMod(t)},onFullScreenChange:function(t){this.__base.apply(this,arguments),this._stream.toggleMod("fullscreen","yes","",t)},_setModRightShow:function(t){if(t)return this.delMod("related"),void this.delMod("right");this.setMod("related","yes"),this.setMod("right","yes")},updateChat:function(){this._deleteChat(),this.params.settings&&!this.params.settings.disableChats&&this._programHasChat?(this.setChatPositionMod(this.mediaQuery),this.mediaQuery.addListener(this.setChatPositionMod)):this.mediaQuery.removeListener(this.setChatPositionMod)},_setChatPositionMod:function(t){t.matches?this.setMod("chat-container","bottom"):this.setMod("chat-container","right")},_deleteChat:function(){this._streamChat&&(BEM.DOM.destruct(this._streamChat.domElem),this._streamChat=null),this.delMod("chat"),this.delMod("chat-container"),delete this.chatContainer},_insertChat:function(t){var e=this.elem("right-container-chat"),s=this.elem("bottom-container-chat"),i=this._getChatHtml(t);this._streamChat&&(this.hasMod("chat-container","bottom")&&"bottom"===this.chatContainer||this.hasMod("chat-container","right")&&"right"===this.chatContainer)||(this.setMod("chat","yes"),this._streamChat&&(this.hasMod("chat-container","bottom")&&"bottom"!==this.chatContainer||this.hasMod("chat-container","right")&&"right"!==this.chatContainer)&&BEM.DOM.destruct(this._streamChat.domElem),this.hasMod("chat-container","bottom")&&"bottom"!==this.chatContainer?(BEM.DOM.update(s,i),this.chatContainer="bottom"):this.hasMod("chat-container","right")&&"right"!==this.chatContainer&&(BEM.DOM.update(e,i),this.chatContainer="right",this._setModRightShow()),this._streamChat=this.findBlockInside("stream-chat"))},drawSideMore:function(t){var e=t.join("");this._setModRightShow(!e.length&&!this.hasMod("chat","yes")),e.length?(BEM.DOM.update(this.elem("container-doc2doc"),e),this.countShows()):BEM.DOM.update(this.elem("container-doc2doc"),"")},drawMore:function(){this._prepareCarousels(),this.__base.apply(this,arguments)},_loadCarouselImages:function(){(this.findBlocksInside(this.elem("carousels"),"stream-carousel")||[]).forEach(function(t){t._loadVisibleImages()})},_prepareCarousels:function(){this.afterCurrentEvent(function(){this.dropElemCache("carousels"),this.findBlocksInside("carousels","stream-carousel"),this._calcOverflowCarousels()},this)},_calcOverflowCarousels:function(){BEM.blocks["i-multiline-overflow"].calcOverflow(this.elem("carousels"),2)},_name:"watching",_gridCapacity:12},{live:function(){return this.liveBindTo("player-overlay-close","click",function(){this._disabledByUser=!0,this.destroyPlayer(),this.delMod("has-miniplayer")}),this.liveBindTo("info-anchor","click",function(){this.scrollToInfo()}),this.liveBindKey("info-anchor","space enter",function(t){this.scrollToInfo(),t.preventDefault()}),this.__base()}}),function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=501)}({0:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(30),n=s(15),r=window.Promise;t.exports=n.checkNativeCode(r)?r:i["default"]||i},104:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BUNDLES_PATH="/yandex-video-player-iframe-api-bundles/"},12:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getWindowLocation=function(t){if(t&&t.location){var e=t.location;return"function"==typeof e.toString?e.toString():e.href||""}return""}},124:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.tryStringify=function(t){var e=void 0;try{e=JSON.stringify(t)}catch(t){}return e}},125:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getBundleVersion=function(t){for(var e=100*Math.random(),s=0,i=0;i<t.length;i++)if(e<(s+=t[i].percent))return t[i].id;return t[0].id}},126:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=/1\.0-(\d+)/;e.parseVersion=function(t){if(void 0!==t){var e=t&&t.match&&t.match(i);if(e&&e[1])return parseInt(e[1],10);throw new Error("paramsObject.version must be a string like [1.0-0] or undefined")}}},146:function(t,e,s){"use strict";var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t};Object.defineProperty(e,"__esModule",{value:!0});var n=s(89),r=s(3),a=s(55),o=s(147),c=function(t){return!0};e.loadScriptLite=function l(t){var e=t.src,s=t.win,h=t.charset,m=void 0===h?o.CHARSET_UTF_8:h,d=t.async,u=void 0===d||d,_=t.retries,p=void 0===_?0:_,g=t.onRetry,f=void 0===g?r.noop:g,v=t.checkLoad,b=void 0===v?c:v,y=t.onBeforeLoad,w=void 0===y?r.noop:y,k=t.onLoad,C=void 0===k?r.noop:k,M=t.onError,E=void 0===M?r.noop:M,P=s||window,x=P.document.createElement("script"),S=function(e){p>0?(f(e),l(i({},t,{retries:p-1}))):E(e),a.removeNodeFromParent(x)};x.type="text/javascript",x.async=u,x.onload=function(){return b(x)?C():S(new Error("checkLoad for "+e+" failed"))},x.onerror=S,x.src=e,x.charset=m,w(x),n.getHead(P).appendChild(x)}},147:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CHARSET_UTF_8="utf-8"},15:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.checkNativeCode=function(t){if(!t||!t.toString)return!1;var e=t.toString();return/\[native code\]/.test(e)||/\/\* source code not available \*\//.test(e)}},294:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getQueryParameter=function(t,e){for(var s=new RegExp("[?&]"+t+"=*([^&#]*)","g"),i=null,n=null;n=s.exec(e);)i=n;return i&&"string"==typeof i[1]?decodeURIComponent(i[1]):void 0}},295:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BUNDLE_URL_PARAM_NAME="videoplayer-bundle-url",e.VERSION_URL_PARAM_NAME="videoplayer-version"},3:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.noop=function(){}},30:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=(i=s(35))&&i.__esModule?i:{"default":i},a=setTimeout;function o(){}function c(t){if(!(this instanceof c))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],u(t,this)}function l(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,c._immediateFn(function(){var s=1===t._state?e.onFulfilled:e.onRejected;if(null!==s){var i;try{i=s(t._value)}catch(t){return void m(e.promise,t)}h(e.promise,i)}else(1===t._state?h:m)(e.promise,t._value)})):t._deferreds.push(e)}function h(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"===(void 0===e?"undefined":n(e))||"function"==typeof e)){var s=e.then;if(e instanceof c)return t._state=3,t._value=e,void d(t);if("function"==typeof s)return void u((i=s,r=e,function(){i.apply(r,arguments)}),t)}t._state=1,t._value=e,d(t)}catch(e){m(t,e)}var i,r}function m(t,e){t._state=2,t._value=e,d(t)}function d(t){2===t._state&&0===t._deferreds.length&&c._immediateFn(function(){t._handled||c._unhandledRejectionFn(t._value)});for(var e=0,s=t._deferreds.length;e<s;e++)l(t,t._deferreds[e]);t._deferreds=null}function u(t,e){var s=!1;try{t(function(t){s||(s=!0,h(e,t))},function(t){s||(s=!0,m(e,t))})}catch(t){if(s)return;s=!0,m(e,t)}}c.prototype["catch"]=function(t){return this.then(null,t)},c.prototype.then=function(t,e){var s=new this.constructor(o);return l(this,new function(t,e,s){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=s}(t,e,s)),s},c.prototype["finally"]=r["default"],c.all=function(t){return new c(function(e,s){if(!t||void 0===t.length)throw new TypeError("Promise.all accepts an array");var i=Array.prototype.slice.call(t);if(0===i.length)return e([]);var r=i.length;function a(t,o){try{if(o&&("object"===(void 0===o?"undefined":n(o))||"function"==typeof o)){var c=o.then;if("function"==typeof c)return void c.call(o,function(e){a(t,e)},s)}i[t]=o,0==--r&&e(i)}catch(t){s(t)}}for(var o=0;o<i.length;o++)a(o,i[o])})},c.resolve=function(t){return t&&"object"===(void 0===t?"undefined":n(t))&&t.constructor===c?t:new c(function(e){e(t)})},c.reject=function(t){return new c(function(e,s){s(t)})},c.race=function(t){return new c(function(e,s){for(var i=0,n=t.length;i<n;i++)t[i].then(e,s)})},c._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){a(t,0)},c._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)},e["default"]=c},325:function(t,e,s){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var i=s(68),n=s(350),r=s(88),a=s(326),o=void 0;e.loadBundle=function(e){try{var s=a.getBundleUrl(e);return void 0===o&&(o=n.loadScriptLite({src:s,retries:1,checkLoad:function(){return i.isFunction(r.iframeAPINamespace.create)}})),{promise:o,bundleUrl:s}}catch(e){return{promise:t.reject(e),bundleUrl:""}}},e._cleanup=function(){delete r.iframeAPINamespace.create,o=void 0}}).call(this,s(0))},326:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(12),n=s(294),r=s(351),a=s(104),o=s(69),c=s(327),l=s(328),h=s(295),m="video-player-iframe-api-bundle.js",d="stream_player.min.js";function u(t){var e=t>330?m:d;return"https://"+o.PROD_DOMAIN+a.BUNDLES_PATH+"1.0-"+t+"/js/"+e}e.getBundleUrlForVersion=u,e.getBundleUrl=function(t){var e=n.getQueryParameter(h.BUNDLE_URL_PARAM_NAME,i.getWindowLocation(window)),s=l.getHardcodedVersion(t);return e&&r.isValidBundleUrl(e)?e:u(s||c.BUNDLE_VERSION)}},327:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(125);e.BUNDLE_VERSION=i.getBundleVersion([{id:582,percent:15},{id:581,percent:15},{id:580,percent:15},{id:575,percent:15},{id:576,percent:15},{id:573,percent:25}])},328:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(12),n=s(352),r=s(126),a=s(295);e.getHardcodedVersion=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,s=i.getWindowLocation(e);return n.getNumericUrlParameter(a.VERSION_URL_PARAM_NAME,s)||r.parseVersion(t)}},348:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),s(78),e.iframeAPILoaderNamespace=window.Ya.streamPlayer},349:function(t,e,s){"use strict";(function(t){var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t},n=function(t,e){var s={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(s[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&(s[i[n]]=t[i[n]])}return s};Object.defineProperty(e,"__esModule",{value:!0});var r=s(6),a=s(12),o=s(3),c=s(124),l=s(62),h=s(50),m=s(88),d=s(325),u="LoaderInitError";function _(t){var e,s,i,n=t.bundleUrl,o=t.params;try{var m=new XMLHttpRequest;m.open("POST",l.PCODE_LOGS_URL,!0),m.send(JSON.stringify({service:h.SOLOMON_SERVICE_NAME,tags:(e={},s="event_"+u,i=1,s in e?Object.defineProperty(e,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[s]=i,e),data:{bundleUrl:n,params:c.tryStringify(o)},labels:{version:"1.0-583"},timestamp:Date.now(),eventType:"error",eventName:u,location:a.getWindowLocation(window),userAgent:r.getUserAgent()}))}catch(t){}}e.init=function(e){var s=e.version,r=e.handlers,a=void 0===r?{}:r,c=n(e,["version","handlers"]),l=a.onReady,h=void 0===l?o.noop:l,u=a.onError,p=void 0===u?o.noop:u,g=n(a,["onReady","onError"]),f=d.loadBundle(s),v=f.promise,b=f.bundleUrl;return v["catch"](function(s){return _({bundleUrl:b,params:e}),t.reject(s)}).then(function(){return new t(function(t,e){var s=void 0,n=i({},g,{onReady:function(e){h(e),t(s)},onError:function(t){p(t),t&&t.isFatal&&e(t)}});s=m.iframeAPINamespace.create(i({},c,{handlers:n}))})})}}).call(this,s(0))},35:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=function(t){var e=this.constructor;return this.then(function(s){return e.resolve(t()).then(function(){return s})},function(s){return e.resolve(t()).then(function(){return e.reject(s)})})}},350:function(t,e,s){"use strict";(function(t){var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t};Object.defineProperty(e,"__esModule",{value:!0});var n=s(146);e.loadScriptLite=function(e){return new t(function(t,s){n.loadScriptLite(i({},e,{onLoad:t,onError:s}))})}}).call(this,s(0))},351:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=new RegExp(["https?://","(\\w+\\.)?","(?:","(?:yandex|yastatic|yandex-team|yastat)\\.","(?:ru|net)\\/","|","localhost\\/",")",".*"].join(""),"i");e.isValidBundleUrl=function(t){return i.test(t.trim())}},352:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getNumericUrlParameter=function(t,e){var s=new RegExp("[#?&]"+t+"=(\\d+)"),i=e.match(s);return i&&i[1]?parseInt(i[1],10):void 0}},50:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SOLOMON_SERVICE_NAME="StreamPlayer"},501:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(348),n=s(349),r=s(325),a=s(502);r._cleanup(),i.iframeAPILoaderNamespace._cleanup=r._cleanup,i.iframeAPILoaderNamespace.init=n.init,i.iframeAPILoaderNamespace.preloadScripts=a.preloadScripts},502:function(t,e,s){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var i=s(89),n=s(3),r=s(104),a=s(69),o=s(327),c=s(326),l=s(328),h=i.getHead(window);function m(e){var s=document.createElement("link");return s.rel="preload",s.as="script",new t(function(t){s.onload=t,s.href=e,h.appendChild(s)}).then(n.noop)}e.preloadViaLink=m,e.preloadScripts=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).version,s=l.getHardcodedVersion(e)||o.BUNDLE_VERSION,i=[c.getBundleUrlForVersion(s),"https://"+a.PROD_DOMAIN+r.BUNDLES_PATH+"1.0-"+s+"/js/player.js","https://"+a.PROD_DOMAIN+r.BUNDLES_PATH+"1.0-"+s+"/js/stream_player_js.js"];return t.all(i.map(m)).then(n.noop)}}).call(this,s(0))},55:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.removeNodeFromParent=function(t){if(t){var e=t.parentElement;e&&e.removeChild(t)}}},6:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getUserAgent=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;try{return(t.navigator||{}).userAgent||""}catch(t){return""}}},62:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PCODE_LOGS_URL="https://an.yandex.ru/jstracer"},68:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isFunction=function(t){return"[object Function]"==={}.toString.call(t)}},69:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PROD_DOMAIN="yastatic.net"},78:function(t,e,s){"use strict";var i=window;i.Ya||(i.Ya={}),i.Ya.streamPlayer||(i.Ya.streamPlayer={})},88:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),s(78),e.iframeAPINamespace=window.Ya.streamPlayer},89:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getHead=function(t){var e=t.document,s=e.getElementsByTagName("head")[0];return s||(s=e.createElement("head"),e.documentElement.appendChild(s)),s}}}),BEM.DOM.decl("stream-more-info",{onSetMod:{js:function(){this.SHOW=home.l10n("stream.more-info"),this.HIDE=home.l10n("stream.hide-info"),this._visibility="hide",this._textElem=this.elem("text"),this._buttonElem=this.elem("button"),this._buttonElem.text(this.SHOW),this._cloneElem=undefined,this._lineCount=2,this._lineHeight=this._getLineHeight(this._textElem),"visible"===this.findBlockOutside("stream").getMod("visibility")?this._onCalcSize():setTimeout(this._onCalcSize.bind(this),0),this._onCalcSizeThrottled=home.throttle(this._onCalcSize,300),this.bindToWin("resize",this._onCalcSizeThrottled),this._listenUpdate()}},_onCalcSize:function(){if("show"!==this._visibility){var t=this._textElem;t.text(t.data("text")),this._truncate()}},_onMoreClick:function(){var t=this._textElem,e=this._buttonElem;"hide"===this._visibility?(this._visibility="show",t.text(t.data("text")),e.text(this.HIDE)):(this._visibility="hide",this._truncate(),e.text(this.SHOW))},_truncate:function(){var t=this._textElem;t.text(this._insertMore(t.data("text"))),this.setMod("visibility","visible")},_getLineHeight:function(t){var e=t.css("line-height"),s=t.css("font-size");return e="normal"===e?1.2*parseFloat(s):parseFloat(e)},_setCloneElemStyle:function(){var t=this._textElem;this._cloneElem||(this._cloneElem=$(home.view("stream-more-info-clone")).appendTo(".stream")),this._cloneElem.css({width:t.width(),fontSize:t.css("font-size"),fontFamily:t.css("font-family"),fontWeight:t.css("font-weight"),_lineHeight:this._lineHeight+"px",wordWrap:t.css("word-wrap"),whiteSpace:t.css("white-space")})},_calcLines:function(t){return this._cloneElem.text(t),this._cloneElem.height()/this._lineHeight},_insertMore:function(t){var e,s=0,i=t.length,n=this._lineCount;if(this._setCloneElemStyle(),this._calcLines(t)<=n+.1)return this.setMod("button","no"),t;for(this.setMod("button","yes");s<i;)e=Math.ceil((s+i)/2),this._calcLines(t.substr(0,e)+"..."+this.SHOW)>n+.1?i=e-1:s=e;return this._trim(t.substr(0,s))+"..."},_trim:function(t){return t.replace(/[-:;,.\s]+$/,"")},_listenUpdate:function(){this.channel("stream-more-info").on("update",function(){setTimeout(this._onCalcSize.bind(this),0)},this)}},{live:function(){return this.liveBindTo("button","pointerclick",function(){this._onMoreClick()}),this.liveBindKey("button","space enter",function(t){this._onMoreClick(),t.preventDefault()}),!0}}),BEM.DOM.decl({block:"stream-watching",modName:"type",modVal:"vod-episode"},{_setNeighbours:function(){var t=this.getStateLock("setprogram"),e=this.params.settings.exp.stream_non_stop_plug;this._prevEpisode=null,this._nextEpisode=null,this._current?Promise.all([this._current.getNeighbours(),this._cms.getDoc2DocRecommendations(this._current)]).then(function(s){var i=s[0]||[],n=(s[1]||[])[0],r=i[0],a=i[i.length-1];t()&&(e&&(this._prevEpisode=r),a&&a!==r?(this._next=a,e&&(this._nextEpisode=a)):this._next=n||null)}.bind(this),function(t){this._next=null,t&&this.onError({message:"vod-episode._setNeighbours -> "+t.message,originalMessage:t.originalMessage})}.bind(this)):this._next=null}}),BEM.DOM.decl({block:"stream-watching",modName:"type",modVal:"announce"},{onSetMod:{type:function(t,e){"announce"!==e&&clearInterval(this._switchProgramTimer),this.__base.apply(this,arguments)}},hide:function(){clearInterval(this._switchProgramTimer),this.__base.apply(this,arguments)},updateProgram:function(t){this.__base.apply(this,arguments),this.destroyPlayer(),this._current=t;var e=t.meta.awaiting,s=t.meta.playProgram,i=t.meta.forbidden,n=i&&home.l10n("stream.errortype."+i+".text");s?BEM.DOM.update(this.elem("player-plug"),home.view("stream-watching__plug",{mix:"stream-watching__link",program:t.meta.playProgram})):(BEM.DOM.update(this.elem("player-plug"),home.view("stream-announce",{mods:{"button-size":"touch"===this._stream.getKind()?"s":"m"},text:n,time:e.fromFuture()?e.start():"",liveTitle:t.meta.liveTitle,contentId:t.meta.hasLive?t.channel.content_id:"",thumbnail:t.thumbnail,now:home.now()/1e3})),this.dropElemCache("announce-text")),clearInterval(this._switchProgramTimer),(s&&s.is(home.now()/1e3)||e&&e.fromFuture())&&this._setSwitchProgramTimer()},_setSwitchProgramTimer:function(){var t=this._current.content_id,e=this._current.start(),s=7.5*Math.random();clearInterval(this._switchProgramTimer),this._switchProgramTimer=setInterval(function(){var i,n=home.now()/1e3;this._current.meta.playProgram?this.onPlayerTimeChange(n-e,n):(i=n>e-s,this._updateCountdown()),(this._current.content_id!==t||i)&&clearInterval(this._switchProgramTimer),i&&this._coordinator.update({program:this._current.meta.awaiting,live:!0})}.bind(this),1e3)},_updateCountdown:function(){var t=home.now()/1e3,e=Math.ceil((this._current.start()-t)/60);e>59||this._prevDelta!==e&&(this._prevDelta=e,BEM.DOM.update(this.elem("announce-text"),home.view("stream-announce__text",{time:this._current.start(),now:t})))},play:function(t){return"announce"===t.content_type_name?Promise.resolve():this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"stream-overlay",baseBlock:"stream-screen"},{show:function(){this.findBlockOn("stream-watching").setMod("overlay","yes");var t=this.findBlockInside("stream-stickers");t&&t.resizeCanvas(),this.__base.apply(this,arguments)},hide:function(){this.findBlockOn("stream-watching").delMod("overlay"),this.__base.apply(this,arguments)},closeOverlayProgram:function(){this._coordinator.back({active:"watching"})},_name:"overlay"},{live:function(){return this.liveBindTo("close","click",function(){this.closeOverlayProgram()}),this.liveBindKey("close","space enter",function(t){this.closeOverlayProgram(),t.preventDefault()}),this.__base()}}),BEM.DOM.decl({block:"stream-watching",modName:"overlay",modVal:"yes"},{onPlayerTimeChange:function(t,e){this._current&&this._current instanceof this._cms.LiveProgram&&(e||(e=home.now()/1e3),this._current.start()<e&&!this._current.is(e)&&this._current.channel?this.playProgramFor(this._current.screwTime(e),this._current.channel):this._nextFetchTry=null)}}),BEM.DOM.decl({block:"stream-watching",modName:"project",modVal:"yes"},{onSetMod:{project:function(t,e){"yes"!==e&&(this._clearTimers(),this._stream.clearSeenCache()),this.__base.apply(this,arguments)}},update:function(t){var e=this._current||{},s=e.channel&&e.channel.meta&&e.channel.meta.project_alias;this._projectAlias=t.channel&&t.channel.meta&&t.channel.meta.project_alias,s!==this._projectAlias&&(this._clearTimers(),this._stream.clearSeenCache()),this.__base.apply(this,arguments)},updateMore:function(){return this.__base.apply(this,arguments).then(function(){this.afterCurrentEvent(function(){this._updateNowPlayingArrows()},this)}.bind(this))},updateProject:function(t){var e=t.channel,s=home.now()/1e3;e&&e.isProjectChannel()&&!this.params.settings.projectScheduleDisabled&&(this._deltaForScheduleTab={next:604800,prev:-604800},this._projectStart=e.project_start_time,this._projectEnd=e.project_expiration_time,this._enabledSchedule={prev:this._projectStart?s>this._projectStart:1,next:this._projectEnd?s<this._projectEnd:1},this._projectScheduleEnabled=this._enabledSchedule.prev||this._enabledSchedule.next,this._selectedProjectTab=s>this._projectEnd?"prev":"next")},_drawProjectBlocks:function(){var t=[];return t.push(this.safeDo(this._getNowPlaying(),[[],[]]).then(this._drawNowPlaying.bind(this))),this._projectScheduleEnabled&&t.push(this.safeDo(this._getActiveProjectSchedule(),[]).then(this._drawProjectSchedule.bind(this))),t},hide:function(){this._clearTimers(),this.__base.apply(this,arguments)},_setNeighbours:function(t){if(!this._current||this._current instanceof this._cms.AnnouncePlug||this._current instanceof this._cms.VodProgram)this._current instanceof this._cms.VodProgram&&this.__base.apply(this,arguments);else{var e=this.getStateLock("setprogram"),s=this._current.channel.meta&&this._current.channel.meta.project_alias;(t.rewind?this._stream.infiniteProjectList(s):this._cms.getPrograms({parent_id:this._current.channel.content_id,end_from:this._current.end()+1,limit:1})).then(function(t){return t[0]}).then(function(t){e()&&t&&(this._next=t)}.bind(this),function(t){this._next=null,this.onError({message:"_setNeighbours (project) -> "+(t&&t.message),originalMessage:t&&t.originalMessage})}.bind(this))}},_updateAnnounce:function(t){var e=t.current;return this.__base(t).then(function(t){var s=e&&e.fromFuture(),i=e&&e instanceof this._cms.VoidProgram,n=e&&e.channel,r=n&&n.meta&&n.meta.project_alias;if(s||i){var a=this._stream.liveProjectList(r).then(function(s){return(s=s.filter(function(t){return!(t instanceof this._cms.VoidProgram||t===e||t.eq(e))}.bind(this))).length&&(t.program.meta.hasLive=!0,s[0].is(home.now()/1e3)||(t.program.meta.liveTitle=home.l10n("stream.announce.olymp_live"))),t}.bind(this));return this.safeDo(a,t)}return e&&e.meta.with_overlay&&t.rewind&&!t.auto?this._setAwaitLiveTimer():clearInterval(this._awaitLiveTimer),t}.bind(this))},_setAwaitLiveTimer:function(){clearInterval(this._awaitLiveTimer),this._awaitLiveTimer=setInterval(function(){var t=home.now()/1e3;this._stream.liveProjectList(this._projectAlias,!0).then(function(e){(e=e.filter(function(e){if(!e)return!1;if(e instanceof this._cms.VoidProgram){var s=e.meta.nextProgram&&e.meta.nextProgram.start();if(!s||s<t||s-t>900)return!1}return!0})).length&&(clearInterval(this._awaitLiveTimer),this._coordinator.update({program:e[0],live:!0}))}.bind(this))}.bind(this),6e4)},_getNowPlaying:function(){var t=home.now()/1e3;return this._getNowPlayingForTime(t).then(function(e){if(e.length>0&&!this._projectScheduleEnabled){var s=this._getProjectUpdateTs(e);this._setProjectUpdateTimer(s),this._stream.setCacheTimer(s,"project-schedule",this._getScheduleProgramsForTime.bind(this))}return e.filter(function(e){return e.start()<t&&e.end()>t&&!e.eq(this._current)&&!(this._current&&e.eq(this._current.meta.awaiting))},this)}.bind(this)).then(function(t){return BEM.blocks["stream-cms"].interestSort(t)})},_getNowPlayingForTime:function(t){var e=this._current.channel||{},s=e.meta&&e.meta.project_alias;if(!s)return Promise.resolve([]);var i=this._cms.getChannelsByProjectAlias(s).map(function(e){return this._cms.getPrograms({parent_id:e.content_id,end_from:t,noVoid:!0,limit:1})},this);return Promise.all(i).then(this._stream._mergeLists.bind(this._stream))},_updateNowPlaying:function(){var t=this.getStateLock("hot"),e=this.findElem("hot").find(".scroller"),s=e&&e.scrollLeft();return this.safeDo(this._getNowPlaying()).then(function(e){if(t()){var i=this._drawNowPlaying(e);BEM.DOM.replace(this.findElem("hot"),i),this._updateNowPlayingArrows(),s&&this.findElem("hot").find(".scroller").scrollLeft(s)}}.bind(this))},_drawNowPlaying:function(t){return t?home.view("stream-more",{title:home.l10n("stream.live_tab"),content:home.view("stream-hot",{programs:t,now:home.now()/1e3}),mix:"stream-watching__hot"}):home.view("stream-more",{title:home.l10n("stream.live_tab"),mods:{loading:"yes"},content:home.view("stream-hot",{key:"loading"})})},_updateNowPlayingArrows:function(){var t=this.findBlockInside("hot","arrowed-list");t&&t.toggleArrows()},_getScheduleProgramsForTime:function(t){var e=this._selectedProjectTab;this._getNowPlayingForTime(t),this._projectScheduleEnabled&&this._getProjectScheduleForTime(this._deltaForScheduleTab[e],t)},_getProjectScheduleForTime:function(t,e){var s=e?new Date(1e3*e):home.now(),i=(+new Date(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours())+(t<0?36e5:0))/1e3,n=i+t,r=i<n,a=this._current.channel||{},o=a.meta&&a.meta.project_alias;return this._cms.getPrograms({parent_id:this._cms.getChannelsByProjectAlias(o).map(function(t){return t.content_id}),end_from:r?i:Math.max(this._projectStart,n),start_to:r?Math.min(this._projectEnd,n):i})},_getActiveProjectSchedule:function(){return this._getProjectSchedule().then(function(t){return t&&!t.length&&"next"===this._selectedProjectTab&&this._enabledSchedule.prev?(this._selectedProjectTab="prev",this._getProjectSchedule()):t}.bind(this))},_getProjectSchedule:function(){var t,e=this._selectedProjectTab,s=home.now()/1e3>this._projectEnd?this._projectEnd:null;return s&&(e=this._selectedProjectTab="prev"),this._enabledSchedule[e]?(t=this._deltaForScheduleTab[e],this._getProjectScheduleForTime(t,s).then(this._filterProjectTabList.bind(this,t))):Promise.resolve([])},_getProjectUpdateTs:function(t){var e=home.now(),s=t.filter(function(t){return!(t instanceof BEM.blocks["stream-cms"].VoidProgram)}),i=e/1e3+5*(1+Math.random())*60;return s.length&&s.forEach(function(t){t.start_time>e/1e3&&(i=Math.min(i,t.start_time)),t.end_time>e/1e3&&(i=Math.min(i,t.end_time))}),i},_filterProjectTabList:function(t,e){var s=t>0,i=this._getProjectUpdateTs(e);return this._setProjectUpdateTimer(i),this._stream.setCacheTimer(i,"project-schedule",this._getScheduleProgramsForTime.bind(this)),e.filter(function(t){if(!s&&t.start()>home.now()/1e3)return!1;if(t instanceof this._cms.VoidProgram)return!1;if(s){if(!t.fromFuture())return!1}else if(t.fromFuture())return!1;return(!this._current||!t.eq(this._current)&&!t.eq(this._current.meta.awaiting))&&!(!t.fromFuture()&&t.is(home.now()/1e3))},this).sort(function(t,e){var i=t.start_time-e.start_time;return s?i:-i}).slice(0,20)},_drawProjectSchedule:function(t){var e=this._selectedProjectTab,s="",i=[];return this._enabledSchedule.prev&&i.push({key:"prev",content:home.l10n("stream.past_schedule"),selected:"prev"===e}),this._enabledSchedule.next&&i.push({key:"next",content:home.l10n("stream.future"),selected:"next"===e}),s=t.length?home.view("stream-list",{programs:t&&t.map(function(t){var e=t.program_title;return e=e&&e!==t.title?e.replace(/([!?:.])?(\s*)$/,function(t,e,s){return(e||".")+(s||" ")})+"  "+t.title:t.title,$.extend({},t,{program_title:"",title:e,thumbnail:t.thumbnail})}),statRoot:"stream.watching.more_episodes",parent:"stream-watching",mods:{thumbnail:"yes",expand:"yes"}}):home.view("stream-watching__project-schedule_empty"),home.view("stream-more",{mix:"stream-watching__project-schedule",title:home.view("stream-tabs",{tabs:i,index:"schedule",mix:"stream-watching__project-tab"}),content:s})},_updateProjectSchedule:function(){var t=this.getStateLock("schedule");return this.safeDo(this._getProjectSchedule()).then(function(e){if(t()){var s=this._drawProjectSchedule(e);BEM.DOM.replace(this.findElem("project-schedule"),s)}}.bind(this))},_setProjectUpdateTimer:function(t){clearInterval(this._projectUpdateTimer),this._projectUpdateTimer=setInterval(function(){home.now()/1e3>t&&(clearInterval(this._projectUpdateTimer),this._updateNowPlaying(),this._projectScheduleEnabled&&this._updateProjectSchedule())}.bind(this),1e3)},_onProjectTabClick:function(t){this._selectedProjectTab=t.data.domElem.data("key"),this._updateProjectSchedule()},_clearTimers:function(){clearInterval(this._projectUpdateTimer),clearInterval(this._awaitLiveTimer),this._stream.destroyCacheTimer("project-schedule")}},{live:function(){return this.liveBindTo("project-tab","click",function(t){this._onProjectTabClick(t)}),this.liveBindKey("project-tab","space enter",function(t){this._onProjectTabClick(t),t.preventDefault()}),this.__base()}}),BEM.DOM.decl("stream-hot",{onSetMod:{js:function(){this.findBlockInside("arrowed-list").toggleArrows()}}}),BEM.DOM.decl("stream-tile",{onSetMod:{disabled:function(t,e){e?(this.domElem.attr("disabled",""),this.domElem.removeAttr("tabindex")):(this.domElem.removeAttr("disabled"),this.domElem.attr("tabindex","0"))}}},{live:!0}),BEM.DOM.decl("stream-superres",{onSetMod:{js:function(){this._bindToEvents(),this._stream=this.findBlockOutside("stream")}},_bindToEvents:function(){this.bindTo("pointerenter",this._onPointerEnter),this.bindTo("pointerleave",this._onPointerLeave)},_onPointerEnter:function(){var t=this.__self;clearTimeout(t._openTimer),clearTimeout(t._closeTimer),t._openTimer=setTimeout(function(){this.setMod("active","yes"),this.showPopup(this.domElem)}.bind(this),100)},_onPointerLeave:function(){var t=this.__self;clearTimeout(t._openTimer),clearTimeout(t._closeTimer),t._closeTimer=setTimeout(function(){this.hidePopup()}.bind(this),500)},showPopup:function(t){var e=this.__self;e._popupOpened||(e._popup||e.createPopup(),e._popup.toggleMod("white-stream","yes",undefined,this._stream.hasMod("theme","white")),e._popup.on({hide:function(){this.delMod("active"),e._popupOpened=!1,e._popup.un("hide")}.bind(this)}),home.stat.logPath("show","stream.superres.popup"),e._popup.show(t),e._popupOpened=!0)},hidePopup:function(){var t=this.__self;t._popup&&t._popupOpened&&t._popup.hide()}},{_openTimer:null,_closeTimer:null,_popupOpened:null,_popup:null,createPopup:function(){var t=BEM.blocks.stream.getInstance(),e=t.params&&t.params.settings&&t.params.settings.superresUrl,s=$(home.view("stream-superres__popup",{url:e}));$(document.body).append(s),s.on("pointermove",function(){clearTimeout(this._closeTimer)}.bind(this)).on("pointerleave",function(){clearTimeout(this._openTimer),clearTimeout(this._closeTimer),this._closeTimer=setTimeout(function(){this._popup.hide()}.bind(this),500)}.bind(this)),this._popup=s.bem("popup")}}),BEM.DOM.decl({block:"popup",modName:"animate-opacity",modVal:"yes"},{afterShow:function(){if(this.getCurrDirection()){this.domElem.stop(!0).css({opacity:0}).animate({opacity:1},this.params.duration)}},beforeHide:function(t){if(!this.getCurrDirection())return t();return this.domElem.stop(!0,!0).animate({opacity:0},this.params.duration,function(){t()})}}),BEM.DOM.decl("stream-channel",{onSetMod:{disabled:function(t,e){this.domElem.attr(t,!!e),e?this.domElem.removeAttr("tabindex"):this.domElem.attr("tabindex",0)}}}),BEM.DOM.decl("expandable",{},{live:function(){return this.liveBindTo("button","click",function(){this.setMod("expanded","yes")}),this.liveBindKey("button","space enter",function(t){this.setMod("expanded","yes"),t.preventDefault()}),!0}}),BEM.decl("stream-rum",{getDefaultParams:function(){var t=this.__base.apply(this,arguments);return Object.keys(this.__self.MARKS).forEach(function(e){t[e]=!0}),t},onSetMod:{js:function(){Ya&&Ya.Rum&&(this._ready=!0),this._sentMarks={}}},_getTiming:function(){if(window.Ya&&window.Ya.Stream)return window.Ya.Stream.timing},_sendTTI:function(){this._ready&&this.params.tti&&!this._sentMarks.tti&&(this._sentMarks.tti=!0,Ya.Rum.sendTTI(!1,Ya.Rum.getTime(),this._getTiming()))},_sendMark:function(t){this._ready&&this.__self.MARKS[t]&&this.params[t]&&!this._sentMarks[t]&&(this._sentMarks[t]=!0,Ya.Rum.sendTimeMark(this.__self.MARKS[t],Ya.Rum.getTime(),!1,this._getTiming()))},_clear:function(){this._sentMarks={}}},{MARKS:{tti:"2795",playerCreate:"1242.3237",playerInit:"1242.1309",playerStart:"1242.2154"},getInstance:function(){return this._instance||(this._instance=BEM.create("stream-rum")),this._instance},setParams:function(t){var e=this.getInstance();if(e){var s=e.params;for(var i in s)s.hasOwnProperty(i)&&t.hasOwnProperty(i)&&(s[i]=t[i])}},sendTTI:function(){var t=this.getInstance();t&&t._sendTTI()},sendMark:function(t){var e=this.getInstance();e&&e._sendMark(t)},clear:function(){var t=this.getInstance();t&&t._clear()}}),BEM.DOM.decl("stream-chat",{onSetMod:{js:function(){var t=home.getData("stream.stream.clientData.settings",{}).chatSettings||{};this.THEME_DARK=t.chat_theme_enable&&"dark"===this.params.theme,this.MESSENGER_URL=t.chat_url||"",this.PASSPORT_URL="https://passport.yandex.ru/auth",this.CHAT_LOAD_TIME=t.load_time?Number(t.load_time):1e4,this.CHAT_PARAMS=t.chat_params||"";var e=home.parseUrl(this.MESSENGER_URL);this._origin=e.scheme+"://"+e.host,this._collapsed=this._isChatCollapsed(),this.THEME_DARK&&this.setMod("theme","dark"),this.createChat()}},listenEvents:function(){this.bindTo("header","pointerclick",this._updateChat,this),this.bindKeyTo("header","space enter",this._updateChat,this)},stopListenEvents:function(){this.unbindFrom("header","pointerclick",this._updateChat,this),this.unbindFrom("header","space enter",this._updateChat,this)},destruct:function(){this.deleteChat(),this.__base.apply(this,arguments)},createChat:function(){this.params.isOnline?(this.listenEvents(),this._initContainer(),this._insertLogin(),this._updateButton(),this._setMod()):this._setStatusClose()},deleteChat:function(){this._destroyContainer(),this.stopListenEvents(),clearTimeout(this._loaderTimeoutId)},_checkLogin:function(){return home.getData("common.authInfo.logged",!1)},_insertLogin:function(){if(this._checkLogin())this.setMod("login","yes");else{var t=home.l10n("stream.chat_login"),e=home.view("stream-url",{streamId:this.params.contentId,withHost:!0}),s=this.PASSPORT_URL+"?retpath="+encodeURIComponent(e);this.elem("login-container").html(home.view("stream-chat__login",{href:s,content:t})),this.delMod("login")}},_reloadChat:function(){this.unbindFrom(this.elem("reload"),"click",this._reloadChat),this.dropElemCache("reload"),this._initContainer()},_setStatusLoad:function(){this.setMod("status","load"),BEM.DOM.update(this.elem("status"),home.view("stream-chat__loader-layout")),this._loaderTimeoutId=setTimeout(this._showError.bind(this),this.CHAT_LOAD_TIME)},_setStatusReady:function(){this.setMod("status","ready"),BEM.DOM.update(this.elem("status"),""),clearTimeout(this._loaderTimeoutId)},_showError:function(t){this._destroyContainer(),BEM.DOM.update(this.elem("status"),home.view("stream-chat__error")),this.bindTo(this.elem("reload"),"click",function(t){t.stopPropagation(),this._reloadChat()}.bind(this)),this.setMod("status","error"),home.error.logError({block:"stream-chat",sourceType:"logic",message:"chat error",meta:{chatId:this.params.chatId}},t)},_setStatusClose:function(){var t=this.params.startTimeText?home.l10n("stream.chat_live")+" "+this.params.startTimeText:"";this.setMod("status","close"),this.setMod("collapsed","yes"),this.channel("stream").trigger("chat",{open:"no"}),this.delMod(this.elem("button"),"close"),this.elem("button").text(t),this.elem("header").attr("data-statlog","stream.watching.chat.live")},_initContainer:function(){if(!this._inited&&this.params.chatId){var t=this.THEME_DARK?";theme=dark":"",e="flags=sticker_packs=154;anonymous="+Number(!this._checkLogin())+t;this._iframe=document.createElement("iframe"),this._iframe.src=this.MESSENGER_URL+e+this.CHAT_PARAMS+encodeURIComponent(this.params.chatId),this._iframe.className="stream-chat__iframe",this.bindToWin("message",this._onMessage.bind(this)),this.elem("container").append(this._iframe),this._inited=!0,this._setStatusLoad()}},_destroyContainer:function(){this.unbindFromWin("message",this._onMessage.bind(this)),this._iframe&&this._iframe.parentNode&&this._iframe.parentNode.removeChild(this._iframe),this._inited=!1,delete this._iframe},_onMessage:function(t){var e=t.originalEvent||{},s=e.data;if(e.origin&&(!e.origin||e.origin===this._origin)){if("string"==typeof s)try{s=JSON.parse(s)}catch(i){home.error.logError({block:"stream-chat",sourceType:"logic",message:"_onMessage: invalid json"},i)}s&&s.type&&"messenger"===s.namespace&&this._messengerMessageHandler(s.type,s.data)}},_sendMessage:function(t,e){this._iframe.contentWindow.postMessage({namespace:"messenger",type:t,payload:e},this._origin)},_setMod:function(){this.setMod("collapsed",this._collapsed?"yes":"no"),this.channel("stream").trigger("chat",{open:this._collapsed?"no":"yes"})},_storeChatCollapsed:function(){this._collapsed=!this._collapsed,home.disabledLS||home.localStorage.setItem("home:streamChatCollapsed",this._collapsed?"1":"0")},_isChatCollapsed:function(){var t=!home.disabledLS&&home.localStorage.getItem("home:streamChatCollapsed");return null!==t&&"1"===t},_clearFocus:function(){document.activeElement=null},_updateChat:function(){this._initContainer(),this._storeChatCollapsed(),this._updateButton(),this._setMod(),this._clearFocus()},_updateButton:function(){if(this._collapsed)return this.elem("button").text(home.l10n("stream.chat_open")),this.elem("header").attr("data-statlog","stream.watching.chat.open"),void this.delMod(this.elem("button"),"close");this.elem("button").text(home.l10n("stream.chat_close")),this.elem("header").attr("data-statlog","stream.watching.chat.close"),this.setMod(this.elem("button"),"close","yes")},_messengerMessageHandler:function(t,e){switch(t){case"ready":this._handleReadyMessage();break;case"members":this._handleMembersMessage(e);break;case"error":this._handleErrorMessage(e)}},_handleMembersMessage:function(){},_handleReadyMessage:function(){this._setStatusReady()},_handleErrorMessage:function(t){clearTimeout(this._loaderTimeoutId),this._showError(t)}}),BEM.DOM.decl({block:"stream-watching",modName:"new-branding",modVal:"yes"},{_updateCurrentProgram:function(){this.__base.apply(this,arguments);var t=(this._current||{}).channel||{};this._checkChannelCoBranding(t)?this._addChannelCoBranding(t):this._deleteChannelCoBranding()},_checkChannelCoBranding:function(t){var e=t.branding||{},s=e&&e["co-title"]&&e["co-image"]&&e["co-href"];return Boolean(this._isChannelBranding&&s)},_addChannelCoBranding:function(t){BEM.DOM.append(this.elem("media"),this._getChannelCoBrandingHtml(t)),this.setMod("co-branding","yes")},_deleteChannelCoBranding:function(){this.elem("media").children(".stream-watching__co-branding-channel").remove(),this.delMod("co-branding")},_getChannelCoBrandingHtml:function(t){var e=t.branding||{};return $(home.view("stream-watching__co-branding-channel",{title:e["co-title"],href:e["co-href"]})).css("background-image","url("+e["co-image"]+")")}}),BEM.DOM.decl("stream-share",{onSetMod:{js:function(){this._stream=BEM.blocks.stream.getInstance(),this._cms=BEM.blocks["stream-cms"],this.bindTo("title","click",this._show),this.bindToDoc("click",this._hide),this._appendSocial()}},updateShareContent:function(t){if(t){var e,s=t.channel||{},i=""+s.channel_id=="353",n=t instanceof BEM.blocks["stream-cms"].VodProgram&&!i,r=s.has_vod&&!n&&t.hasVodLib(),a=s.meta&&("goldenmask"===s.meta.project_alias||"chmf2018"===s.meta.project_alias);if(r)e=this._shareLibrary(t),this.counter="lib";else if(n)e=this._shareVod(t),this.counter="vod";else if(a)e=this._shareCachup(t),this.counter="cachup";else{if(!(s instanceof BEM.blocks["stream-cms"].Channel))return;e=this._shareChannel(t),this.counter="channel"}e.then(function(t){t.image||(t.image=home.view("stream-share__img-default")),this.delMod("hidden"),this._shareInstance.updateContent(t)}.bind(this),function(t){this.setMod("hidden","yes"),t.message&&home.error.logError({block:"stream-share",message:t.message,sourceType:"logic"},t)}.bind(this))}},isReady:function(){return Boolean(this._shareInstance)},_show:function(t){this.hasMod("visible")||(this.toggleMod("visible","yes"),t.stopPropagation())},_hide:function(t){$(t.target).closest(".stream-share__popup").length||this.delMod("visible")},_shareLibrary:function(t){var e=t.channel||{};return t.getVodLib().then(function(t){if(!(t&&t.title&&t.content_id&&e.channel_id))throw new Error("_shareLibrary: no data for share");return{title:home.view("stream-share__lib-text",{libTitle:t.title||""}),image:this._prepareThumbnailUrl(t.thumbnail),url:this._getUrl({stream_channel:e.channel_id,stream_id:t.content_id})}}.bind(this))},_shareVod:function(t){var e=t.channel||{},s=t.series||{};return new Promise(function(i,n){var r=t.program_title||"";t.content_id||n({message:"_shareVod: no data for share"}),i({title:home.view("stream-share__vod-text",{programTitle:r,episodeName:s.episode_name||t.title||"",isFirstChannel:146===e.channel_id}),image:this._prepareThumbnailUrl(t.thumbnail),url:this._getUrl({stream_channel:e.channel_id,stream_id:t.content_id})})}.bind(this))},_shareChannel:function(t){var e=t.channel||{};return new Promise(function(t,s){e.title&&e.channel_id||s({message:"_shareChannel: no data for share"}),t({title:home.view("stream-share__channel-text",{channelTitle:e.title,channelId:e.channel_id}),image:this._prepareThumbnailUrl(e.thumbnail),url:this._getUrl({stream_channel:e.channel_id})})}.bind(this))},_shareCachup:function(t){var e,s=t.channel||{},i=t.series||{},n=s.meta&&"goldenmask"===s.meta.project_alias,r=s.meta&&"chmf2018"===s.meta.project_alias,a=n||r?t.title:t.program_title,o=this._prepareThumbnailUrl(t.thumbnail),c=t.getContentId();return new Promise(function(t,l){a&&s.channel_id&&c||l({message:"_shareCachup: no data for share"}),n?(e=home.view("stream-share__goldenmask-text",{programTitle:a}),o=home.view("stream-share__goldenmask-img",{thumbnail:o})):e=r?home.view("stream-share__chmf2018-text",{programTitle:a}):home.view("stream-share__vod-text",{programTitle:a,episodeName:i.episode_name||"",isFirstChannel:146===s.channel_id}),t({title:e,image:o,url:this._getUrl({stream_channel:s.channel_id,stream_id:c})})}.bind(this))},_appendSocial:function(){var t="//yastatic.net/share2/share.js";$.ajax({url:t,dataType:"script",context:this}).then(this._onShareLoad,function(e,s,i){home.error.logAjaxError({block:"stream-share",message:"_appendSocial: ajax",url:t,source:"share2"},e,s,i)})},_prepareThumbnailUrl:function(t){return t?t.replace(/^\/\//,"https://"):""},_onShareLoad:function(){var t=this,e={theme:{services:["vkontakte","twitter","odnoklassniki"].join(","),counter:!1,lang:this._stream.params.settings.locale},hooks:{onready:function(){t.trigger("ready")},onshare:function(e){var s=(t.params.statRoot||"stream")+".share."+t.counter+"."+e;home.stat.logPath("click",s)}}};this.delMod("hidden"),this._shareInstance=new Ya.share2(this.elem("list")[0],e)},_getUrl:function(t){return home.view("stream-url",{streamChannel:t.stream_channel,streamId:t.stream_id,isSharing:!0})}},{}),BEM.DOM.decl("stream-stickers-counter",{onSetMod:{js:function(){this._lastCount=0,this._stickerBase="https://yastatic.net/s3/home/stream/emoji/%stickerpack%/34.png",this.channel("stream-stickers-counter").on("update",this._update,this)}},_format:function(t){var e="";return t<1e4?t:(t>=1e6?(t=Math.round(t/1e6*1e3)/1e3+"",e=home.l10n("stream.stickers.counter_million_text")):(t=Math.floor(t/1e3*10)/10+"",e=home.l10n("stream.stickers.counter_text")),(t=t.replace(".",","))+home.view("stream-stickers-counter__count-text",{text:e}))},_calc:function(t){var e=0;for(var s in t)t.hasOwnProperty(s)&&(e+=t[s]||0);return e},_getTopEmoji:function(t){var e=Object.keys(t).sort(function(e,s){return t[s]-t[e]}),s=Math.min(e.length,3);return e.slice(0,s)},_update:function(t,e){var s=this._calc(e.emoji),i="";s!==this._lastCount&&(this._lastCount=s,0!==s?(this.delMod("hidden"),this.hasMod("size","min")||(i=this._getTopEmoji(e.emoji).map(function(t){return home.view("stream-stickers-counter__sticker",{mods:{index:t},attrs:{style:"background-image:url("+this._stickerBase.replace("%stickerpack%",e.stickerpack)+")"}})},this).join("")),BEM.DOM.update(this.domElem,home.view("stream-stickers-counter__info",{count:this._format(s),stickers:i}))):this.setMod("hidden","yes"))}},{}),BEM.DOM.decl("stream-stickers",{onSetMod:{js:function(){this._initDefaultParams(),this.channel("stream").on("hide",this._silence,this),this.channel("stream").on("onAdStateChange",this._onAdStateChange,this),this._onXivaMessage=this._onXivaMessage.bind(this),this._processQueue=this._processQueue.bind(this),this._drawScreen=this._drawScreen.bind(this),this._streamWatching=this.findBlockOutside("stream-watching"),this._stream=this.findBlockOutside("stream"),this._flightOff=this._isFlightOff(),this._flightOff&&this._disableFlight(),this._setCurrentStickerpack(this.params.currentStickerpack),this._clearStartPositions=this._clearStartPositions.bind(this),this._onStickerClickThrottled=home.throttle(this._onStickerClick,200),this._updatePositionsThrottled=home.throttle(this._updateFlightPositions,200),this._resizeCanvasThrottled=home.throttle(this.resizeCanvas,200),this._updateCounterHtml=home.throttle(this._updateCounterHtml,1e3),this._storeFakeStickers()}},_initDefaultParams:function(){this._stickersSrc="https://yastatic.net/s3/home/stream/emoji/%stickerpack%/48.png",this._canvasStickersSrc="https://yastatic.net/s3/home/stream/emoji/%stickerpack%/48.png",this._emojiCountList=[1036,1039,1038,1040,1041,1042,1037,1035],this._emojiStore={},this._emojiCount={},this._counter={},this._lastSendTs={},this._newStickers=[],this._fakeStickers=[],this._flyingStickers=[],this._flyingLimit=18,this._maxFlying=280,this._maxCount={2:18,3:21,4:35,5:45,6:55,7:80,8:110,9:130,10:150,11:180,12:230},this._speedX=2,this._speedIncByCount=0,this._speedY=.0075,this._step=.3,this._minSpeedX=2,this._maxSpeedX=3,this._stickerWidth=17,this._stickerHeight=17,this._stickerImgSize=48,this._amplitudeFrom=10,this._amplitudeTo=30,this._stickerMinSpeed=0,this._stickerMaxSpeed=.3,this._scale=.06,this._aggregationTimeout=3e3,this._newStickerWidth=22,this._startPositions={},this._periodForEmojiLive=180,this._inFocus=!0},_storeFakeStickers:function(){this.elem("new-fly-left").each(function(t,e){this._newStickers.push($(e))}.bind(this))},_isFlightOff:function(){var t=!home.disabledLS&&home.localStorage.getItem("home:streamStickersDisabled"),e=this._current&&this._current.channel&&this._current.channel.status||{},s=this._stream&&this._stream.params.settings.exp.stream_emoji_hidden;return null!==t?"1"===t:s&&!e.show_emoji},_disableStickers:function(){this._stickersDisabled=!0},_enableStickers:function(){this._stickersDisabled=!1},_disableFlight:function(){this._closePanel(),this.setMod(this.elem("panel"),"hidden","yes")},_enableFlight:function(){this.delMod(this.elem("panel"),"hidden")},_onFlightToggleClick:function(){this._flightOff=!this._flightOff,home.disabledLS||home.localStorage.setItem("home:streamStickersDisabled",this._flightOff?"1":"0"),home.stat.logPath("click",(this.params.statRoot||"stream")+".stickers."+this._flightOff?"off":"on")},_closePanel:function(){},_openPanel:function(){},_onAdStateChange:function(){},_updateFlightPositions:function(){this._flightAreaWidth=this.elem("flight-area").width(),this._clearStartPositions()},_calcStartPosition:function(t,e){var s;return this._startPositions[t]||(s=e[0].getBoundingClientRect().left,this._flightOffsetLeft=this.elem("flight-area")[0].getBoundingClientRect().left,this._flightOffsetLeft&&this._flightAreaWidth||this._updateFlightPositions(),this._startPositions[t]=s-this._flightOffsetLeft),this._startPositions[t]},_clearStartPositions:function(){for(var t in this._startPositions)this._startPositions.hasOwnProperty(t)&&(this._startPositions[t]=null)},_createStickerDomElem:function(t,e){var s=e?"stream-stickers__fake-sticker":"stream-stickers__new-sticker",i=home.view(s,{sticker:home.view("stream-stickers__sticker",{mods:{"new":e?undefined:"yes",index:t},attrs:{style:"background-image:url("+this._stickersSrc.replace("%stickerpack%",this._currentStickerPack)+")"},stat:""})});return $(i)},_appendStickerToDOM:function(t){requestAnimationFrame(function(){this.elem("new-stickers").append(t)}.bind(this))},_calcStickerAnimationTime:function(t){var e=1.4-(this._speedX-this._minSpeedX)/5-home.randomInteger(0,2)/100,s=16*t/(this._speedX*e)/1e3;return Math.round(10*s)/10},_startAnimation:function(t,e){var s=Math.floor(5*Math.random())+1;t.addClass("stream-stickers__new-fly-start stream-stickers__new-fly-start_"+s),t.css({"-webkit-transform":"translateX(-"+e+"px)",transform:"translateX(-"+e+"px)"})},_onAnimationEnded:function(t){t[0].className="stream-stickers__new-fly-left",t.removeAttr("style"),this._newStickers.push(t)},_animateNewSticker:function(t,e){var s,i,n=this._calcStartPosition(t,e),r=n+1.5*this._newStickerWidth,a=this._calcStickerAnimationTime(r);this._newStickers.length>0?i=this._newStickers.pop():(i=this._createStickerDomElem(t),this._appendStickerToDOM(i)),i.css({left:n+"px","-webkit-transition-duration":a+"s","transition-duration":a+"s"}),s=this.findElem(i,"sticker"),this.setMod(s,"index",t),s.css({"animation-duration":a+"s","background-image":"url("+this._stickersSrc.replace("%stickerpack%",this._currentStickerPack)+")"}),this.afterCurrentEvent(function(){this._startAnimation(i,r,e)}),setTimeout(function(){this._onAnimationEnded(i,e)}.bind(this),1e3*a+1e3)},_animateFakeSticker:function(t,e){var s,i,n=this._calcStartPosition(t,e);this._fakeStickers.length>0?i=this._fakeStickers.pop():(i=this._createStickerDomElem(t,!0),this._appendStickerToDOM(i)),i.css("left",n+"px"),i.addClass("stream-stickers__fake-start"),s=this.findElem(i,"sticker"),this.setMod(s,"index",t),s.css("background-image","url("+this._stickersSrc.replace("%stickerpack%",this._currentStickerPack)+")"),setTimeout(function(){i.removeClass("stream-stickers__fake-start"),this._fakeStickers.push(i)}.bind(this),1e3)},_stopAnimations:function(){this.findElem("new-fly-start").each(function(t,e){e.removeAttribute("style"),e.className="stream-stickers__new-fly-left"}),this._flyingStickers=[],this._clearCanvas()},_onStickerClick:function(t){var e=this.findElem(t,"sticker"),s=this.getMod(e,"index"),i=Date.now(),n=Math.round(this._streamWatching.getPlayerTime());this._lastSendTs[s]&&this._lastSendTs[s]+500>=i?this._animateFakeSticker(s,e):(this._sendSticker(s,n),this._lastSendTs[s]=i,this._counter[s]=(this._counter[s]||0)+1,this._updateCounterHtml(),this._animateNewSticker(s,t))},_updateStickerpack:function(t){BEM.DOM.update(this.elem("list"),home.view("stream-stickers__list",{stickerPack:t})),this._setCurrentStickerpack(t),this._clearStartPositions()},_setCurrentStickerpack:function(t){this._currentStickerPack=t;var e=new Image;e.src=this._canvasStickersSrc.replace("%stickerpack%",this._currentStickerPack),this._stickerImage=null,e.addEventListener("load",function(){this._stickerImage=e}.bind(this),!1)},updateStickers:function(t,e){var s=t||{},i=this._current&&this._current.channel&&this._current.channel.channel_id,n=s.channel&&s.channel.channel_id;i&&n!==i&&this._stopAnimations(),e&&this._currentStickerPack!==e&&this._updateStickerpack(e),e&&this._inFocus?(this._current=s,this._flightOff=this._isFlightOff(),this._enableStickers(),this._flightOff?this._disableFlight():this._initStickers(),this.delMod("hidden"),this.afterCurrentEvent(function(){this.resizeCanvas()},this)):(this.setMod("hidden","yes"),this._disableStickers(),this._silence())},_bindEvents:function(){this.bindToWin("resize",function(){this._updatePositionsThrottled(),this._resizeCanvasThrottled()},this)},_unbindEvents:function(){this.unbindFromWin("resize")},_startTimers:function(){this._lastAggregationTime=home.now()-this._aggregationTimeout,this._queueRequestId=requestAnimationFrame(this._processQueue),this._drawRequestId=requestAnimationFrame(this._drawScreen)},_stopTimers:function(){cancelAnimationFrame(this._queueRequestId),cancelAnimationFrame(this._drawRequestId),this._queueRequestId=null,this._drawRequestId=null},_initStickers:function(){this._disconnectXiva(),this._changeChannel(),this._inited||(this._inited=!0,this._startTimers(),this._bindEvents())},_silence:function(){this._inited&&(this._stopTimers(),this._disconnectXiva(),this._stopAnimations(),this._unbindEvents(),this._inited=!1)},_changeChannel:function(){this._channel="stream_"+this._current.content_id,this._connectToXiva()},_sendSticker:function(t,e){var s={ch:this._channel,emoji:t,ts:e};e<=0||(BEM.blocks["i-xiva"].send(s),this._sendTrackingCounter(t,e))},_connectToXiva:function(){BEM.blocks["i-xiva"].listen(this._channel,0,this._onXivaMessage,{force:!0,ignoreFilterByTime:!0,ignoreBlurEvent:!0})},_disconnectXiva:function(){this._sendCounterData(),this._dropEmojiCount(),this._dropCounter(),this._updateCounterHtml(),this._emojiStore={},BEM.blocks["i-xiva"].stopListen(this._channel,this._onXivaMessage)},_onXivaMessage:function(t){var e=t.emoji||{},s=Math.max(t.aggregationPeriod||1,3);this._storeEmoji(e),this._counter=t.emojiStat||{},this._updateCounterHtml(),this._aggregationTimeout=1e3*s},_dropCounter:function(){this._counter={}},_updateCounterHtml:function(){for(var t in this._counter)!this._counter.hasOwnProperty(t)||t>=0&&t<8||delete this._counter[t];this.channel("stream-stickers-counter").trigger("update",{emoji:this._counter,stickerpack:this._currentStickerPack})},_storeEmoji:function(t){var e=this._streamWatching.getPlayerTime();Object.keys(t).forEach(function(s){var i=t[s];s>e+this._periodForEmojiLive||s<e-this._periodForEmojiLive||(this._emojiStore[s]||(this._emojiStore[s]={}),Object.keys(i).forEach(function(t){t<0||t>8||(this._emojiStore[s][t]=(this._emojiStore[s][t]||0)+i[t],this._emojiCount[t]=(this._emojiCount[t]||0)+i[t])},this))},this)},_aggregateSticker:function(t){var e,s,i,n,r=Math.round(this._streamWatching.getPlayerTime()),a=this._aggregationTimeout/1e3,o=r-Math.round((a-1)/2),c=o+a-1,l=0,h={};n=Object.keys(this._emojiStore).sort(function(t,e){return t-e});for(var m=0;m<n.length;m++){if((i=n[m])>=o&&i<=c){for(var d in s=this._emojiStore[i])s.hasOwnProperty(d)&&(l+=s[d],h[d]?h[d]+=s[d]:h[d]=s[d]);delete this._emojiStore[i]}if(i<r-this._periodForEmojiLive&&delete this._emojiStore[i],i>=c)break}e=this._calcFlyingCount(l),this._calcSpeed(e),Object.keys(h).forEach(function(s){var i;if(0!==(i=l>e?Math.round(h[s]/l*e):h[s]))for(var n=0;n<i;n++)this._createSticker(s,t,l)},this),this._sendCounterData()},_calcFlyingCount:function(t){return t>this._flyingLimit?this._maxCount[Math.floor(Math.log(t))]||this._maxFlying:t},_calcSpeed:function(t){var e=.2*t;0===this._speedX?this._speedX=e:e>=this._speedX+this._step?this._speedX+=this._step:e+this._step<=this._speedX&&(this._speedX-=this._step),this._speedX=Math.max(this._speedX,this._minSpeedX),this._speedX=Math.min(this._speedX,this._maxSpeedX),this._speedIncByCount=t>0?.2*Math.log(t):0},_createSticker:function(t,e,s){var i={index:t};this._flightOff||this._stickersDisabled||(this._initStickerParams(i,e,s),this._flyingStickers.push(i))},_getBaseYPosition:function(t){return t>50?home.randomInteger(1.5*this._stickerHeight,this._canvasHeight-this._stickerHeight/2):home.randomInteger(.5*this._canvasHeight,this._canvasHeight-2*this._stickerHeight)},_initStickerParams:function(){},_drawScreen:function(){this._canvasWidth&&this._canvasHeight||this.resizeCanvas(),this._clearCanvas(),this._stickerImage&&this._drawStickers(),this._drawRequestId=requestAnimationFrame(this._drawScreen)},_drawStickers:function(){},_clearCanvas:function(){},resizeCanvas:function(){},_processQueue:function(){var t=Date.now();t-this._lastAggregationTime<this._aggregationTimeout?this._queueRequestId=requestAnimationFrame(this._processQueue):(this._aggregateSticker(t),this._lastAggregationTime=t,this._queueRequestId=requestAnimationFrame(this._processQueue))},_sendCounterData:function(){var t,e=home.rnd().substr(0,12);(t=Object.keys(this._emojiCount).filter(function(t){return this._emojiCount[t]},this).map(function(t){return this._emojiCountList[t]+"="+this._emojiCount[t]},this).join())&&(this._dropEmojiCount(),this._awaitReqId().then(function(s){var i="143=28.15.231.743,287=213,"+t;(new Image).src="https://yandex.ru/clck/click/dtype=stred/pid=1/cid=72202/reqid="+s+"/path=690.1033/vars="+i+"/rnd="+e+"/*"}))},_sendTrackingCounter:function(t,e){var s=BEM.blocks["stream-trackings"].getTrackingUrl("sticker-send",{content_id:this._current.content_id,channel_id:this._current.channel&&this._current.channel.channel_id,emoji_type:t,watchedTime:Math.floor(e)},!0);(new Image).src=s},_awaitReqId:function(){return this._getDataPromise?this._getDataPromise:(this._getDataPromise=new Promise(function(t){!function e(){var s=home.getData("timing.reqid");s?t(s):home["export"]?t(null):setTimeout(e,100)}()}),this._getDataPromise)},_dropEmojiCount:function(){for(var t in this._emojiCount)this._emojiCount.hasOwnProperty(t)&&(this._emojiCount[t]=0)}},{live:function(){return this.liveBindTo("button","pointerup",function(t){t.preventDefault(),this._onStickerClickThrottled(t.data.domElem)}),this.liveBindTo("flight-toggle","pointerclick",function(){this._onFlightToggleClick()}),!1}}),BEM.DOM.decl("stream-stickers",{onSetMod:{js:function(){this.__base.apply(this,arguments),this._getCanvasContext(),this._filterFlyingStickers=this._filterFlyingStickers.bind(this),this._startFlyingAnimation=this._startFlyingAnimation.bind(this),this.bindTo("button","touchstart touchend",function(t){t.preventDefault()}),this.channel("sys").on("visibilitychange",this._onVisibilityChange,this)}},_onVisibilityChange:function(t,e){e.hidden||this.resizeCanvas()},_onAdStateChange:function(t,e){1===e.state?this._disableStickers():2===e.state&&this._enableStickers(),this.__base.apply(this,arguments)},_bindEvents:function(){this.__base.apply(this,arguments),this.bindTo(this.findBlockOutside("stream").domElem,"scroll",this._updatePositionsThrottled)},_unbindEvents:function(){this.__base.apply(this,arguments),this.unbindFrom(this.findBlockOutside("stream").domElem,"scroll")},_disableStickers:function(){this.__base.apply(this,arguments),this._disableFlight(),this._updateToggleBtn()},_enableStickers:function(){this.__base.apply(this,arguments),this._flightOff||this._enableFlight(),this._updateToggleBtn()},_closePanel:function(){this.setMod(this.elem("panel"),"opened","no"),this.elem("open").attr({tabindex:0}).removeAttr("disabled").focus(),this.elem("button","scaled","yes").attr({tabindex:-1,disabled:"disabled"}),this.elem("close").attr({tabindex:-1,disabled:"disabled"}),setTimeout(this._clearStartPositions,500),this.__base.apply(this,arguments)},_openPanel:function(){this.setMod(this.elem("panel"),"opened","yes"),this.elem("open").attr({tabindex:-1,disabled:"disabled"}),this.findElem("button","scaled","yes").attr("tabindex","0").removeAttr("disabled"),this.elem("close").attr("tabindex","0").removeAttr("disabled").focus(),setTimeout(this._clearStartPositions,500),this.__base.apply(this,arguments)},updateStickers:function(){this._ctx&&this.__base.apply(this,arguments)},_getCanvasContext:function(){try{this._ctx=this.elem("canvas")[0].getContext("2d")}catch(t){}},_clearCanvas:function(){this._ctx.clearRect(0,0,this._canvasWidth,this._canvasHeight),this.__base.apply(this,arguments)},resizeCanvas:function(){if(this._inited){var t=this.elem("canvas")[0],e=window.devicePixelRatio>2?window.devicePixelRatio:2;this._canvasWidth=this.elem("flight-area").width(),this._canvasHeight=this.elem("flight-area").height(),t.width=this._canvasWidth*e,t.height=this._canvasHeight*e,t.style.width=this._canvasWidth+"px",t.style.height=this._canvasHeight+"px",this._ctx.scale(e,e),this.__base.apply(this,arguments)}},_initStickerParams:function(t,e,s){t.baseY=this._getBaseYPosition(s),t.time=e+this._aggregationTimeout*Math.random(),t.size=this._stickerWidth,t.angle=0,t.x=this._canvasWidth,t.y=t.baseY,t.amplitude=home.randomInteger(this._amplitudeFrom,this._amplitudeTo),t.direction=Math.random()<.5?-1:1;var i=Math.random()*(this._stickerMaxSpeed-this._stickerMinSpeed)+this._stickerMinSpeed;t.speedInc=i+this._speedIncByCount,this.__base.apply(this,arguments)},_updateStickerParams:function(t){var e=Math.round((t.x+this._stickerWidth)/this._canvasWidth*100)/100,s=-this._speedX-(2*Math.sin(e*Math.PI)-1)-t.speedInc;e>.6&&t.size<1.4*this._stickerWidth?t.size+=this._scale:e<.4&&t.size>this._stickerWidth&&(t.size-=this._scale),t.size=Math.round(10*t.size)/10,t.x=Math.round(10*(t.x+s))/10,t.angle+=this._speedY*t.direction,t.y=Math.round(10*(t.amplitude*Math.sin(t.angle)+t.baseY))/10},_filterFlyingStickers:function(t){var e=t.x===this._canvasWidth&&t.time<this._currentDrawingTime-this._aggregationTimeout-100;return t.x>=-this._stickerWidth&&!e},_startFlyingAnimation:function(t){t.time>this._currentDrawingTime||(this._updateStickerParams(t),this._ctx.drawImage(this._stickerImage,(this._stickerImgSize+2)*t.index,0,this._stickerImgSize,this._stickerImgSize,t.x,t.y,t.size,t.size))},_drawStickers:function(){this._currentDrawingTime=Date.now(),this._flyingStickers=this._flyingStickers.filter(this._filterFlyingStickers),this._flyingStickers.forEach(this._startFlyingAnimation),this.__base.apply(this,arguments)},_updateToggleBtn:function(){var t=this._flightOff?home.l10n("stream.sticker.on"):home.l10n("stream.sticker.off");BEM.DOM.update(this.elem("toggle-wrap"),home.view("stream-stickers__flight-toggle",{mods:{disabled:this._stickersDisabled?"yes":"no",state:this._flightOff||this._stickersDisabled?"off":"on"},attrs:{title:this._stickersDisabled?undefined:t}}))},_onFlightToggleClick:function(){this._stickersDisabled||(this.__base.apply(this,arguments),this._flightOff?(this._disableFlight(),this._silence()):(this._enableFlight(),this._initStickers()),this._updateToggleBtn())}},{live:function(){return this.liveBindTo("open","pointerclick",function(){this._openPanel()}),this.liveBindKey("open","space enter",function(t){this._openPanel(),t.preventDefault()}),this.liveBindKey("button","space enter",function(t){this._onStickerClickThrottled(t.data.domElem),t.preventDefault()}),this.liveBindKey("flight-toggle","space enter",function(t){this._onFlightToggleClick(),t.preventDefault()}),this.liveBindTo("close","pointerclick",function(){this._closePanel()}),this.liveBindKey("close","space enter",function(t){this._closePanel(),t.preventDefault()}),this.__base()}}),function(t){"use strict";for(var e,s=["ms","moz","webkit","o"],i={},n=[],r=0;r<s.length&&!t.requestAnimationFrame;++r)t.requestAnimationFrame=t[s[r]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[s[r]+"CancelAnimationFrame"]||t[s[r]+"CancelRequestAnimationFrame"];if(t.requestAnimationFrame===undefined){var a=+new Date,o=0,c=function(){var t=n,s=i;n=[],i={},o=+new Date,e=0;for(var r=0,c=t.length;r<c;r++)s[t[r].requestid]||t[r].callback(o-a)};t.requestAnimationFrame=function(s){var i=Date.now()+Math.round(1e4*Math.random());if(n.push({requestid:i,callback:s}),!e){var r=+new Date,a=Math.max(0,16-(r-o));e=t.setTimeout(c,a)}return i},t.requestAnimationFrame.fallback=!0}t.cancelAnimationFrame===undefined&&(t.cancelAnimationFrame=function(t){t&&!i[t]&&(i[t]=1)})}(this),BEM.DOM.decl("stream-sport-stat",{onSetMod:{js:function(){this._updateGoals=this._updateGoals.bind(this)}},updateMatch:function(t){this.stopListen(),this._matchId=t,this.getMatchData(t).then(this._updateStats.bind(this),this._hideStats.bind(this))},stopListen:function(){this._matchId&&BEM.blocks["football-updater"].getInstance().stopListen(this._matchId,!1,this._updateGoals)},_updateStats:function(t){var e=home.deepExtend({},t);e.theme="stream",BEM.DOM.update(this.elem("stats"),home.view("football-stats",e)),this._updateGoals(t)},_updateGoals:function(t){BEM.DOM.update(this.elem("goals"),home.view("stream-sport-goals",t))},_hideStats:function(){this.findBlockOutside("stream-watching").delMod("sport-stat")},_listenUpdates:function(){var t=BEM.blocks["football-updater"].getInstance();t.listen(this._matchId,!1,this._updateGoals),t.onVisible()},getMatchData:function(t){return $.ajax({url:"/portal/sport/event",data:{sport:"FB",id:t,filter:"tv_stream"},timeout:7e3,dataType:"json"}).then(function(t){return home.view("football-store__matches-data",[t]),this._listenUpdates(),t}.bind(this),function(e,s,i){return home.error.logAjaxError({block:"stream",message:"stream-sport-stat.getMatchData: fail",source:"morda_sport_event",meta:{id:t}},e,s,i),Promise.reject()})},destruct:function(){this.findBlockInside("football-stats").destruct(),this.stopListen(),this.__base.apply(this,arguments)}}),BEM.DOM.decl("football-stats",{onSetMod:{js:{inited:function(){this._updateHandler=this._updateHandler.bind(this),BEM.blocks["football-updater"].getInstance().listen(this.params.matchId,!1,this._updateHandler)}}},_updateHandler:function(t){var e=0;["ball_posession","shots_wide","shots_on_goal","corners","yellow_cards","red_cards"].forEach(function(s){var i=home.view("football-stats__stat",{teams:t.teams,stat:s}),n=this.elem("row").filter('[data-key="'+s+'"]'),r=n.find(".football-stats__val"),a=n.find(".football-stats__bar-inner");this.toggleMod(n,"hidden","yes",i.hidden),r.eq(0).html(i.leftStr),r.eq(1).html(i.rightStr),a.eq(0).css("width",i.leftPercent),a.eq(1).css("width",i.rightPercent),i.hidden||++e},this),this.toggleMod("hidden","yes",e<2),this.hasMod("theme","match")&&this.domElem.toggleClass("football__match-block_hidden_yes",e<2)},destruct:function(){BEM.blocks["football-updater"].getInstance().stopListen(this.params.matchId,!1,this._updateHandler),this.__base.apply(this,arguments)}}),BEM.decl("football-updater",{init:function(){this._config=home.getData("football-updater.config"),this._config&&(this._firstTimeout=!1,this._blockVisible=!1,this._matchesShort={},this._matches={},this._storedDataShort={},this._storedData={},this._listening=[],this._updateChannelsDebounced=$.debounce(function(){this._channelsSetted&&this._updateChannels()}.bind(this),100),this._dirtyListeners={},this._fireListenersDebounced=$.debounce(this._fireListeners.bind(this),100),this._listenHandler=this._listenHandler.bind(this),setTimeout(this._onFirstTimeout.bind(this),1e3*this._config.firstUpdateDelay))},onVisible:function(){this._blockVisible||(this._blockVisible=!0,this._firstTimeout&&this._updateChannels())},listen:function(t,e,s){if(this._config){var i=e?this._matchesShort:this._matches,n=e?this._storedDataShort:this._storedData;i[t]||(i[t]=[]),i[t].push(s),this._updateChannelsDebounced(),n[t]&&Date.now()-n[t].ts<this.__self.STORE_FOLLOW_TIMEOUT&&setTimeout(function(){s(n[t].match)},0)}},stopListen:function(t,e,s){if(this._config){var i=e?this._matchesShort:this._matches;i[t]&&(i[t]=i[t].filter(function(t){return t!==s}),this._updateChannelsDebounced())}},_onFirstTimeout:function(){this._firstTimeout=!0,this._blockVisible&&this._updateChannels()},_listenHandler:function(t){var e=t.key.split("_")[0],s=$.extend(!0,{},home.getData("football.upd_"+e,{}),t.data),i=t.key.indexOf("short")>-1,n=i?this._matchesShort:this._matches,r=i?this._storedDataShort:this._storedData;t.data.m_result_shootout||(s.m_result_shootout=null),r[e]={ts:Date.now(),match:s},n[e]&&(this._dirtyListeners[t.key]=!0,this._fireListenersDebounced())},_fireListeners:function(){for(var t in this._dirtyListeners)if(this._dirtyListeners.hasOwnProperty(t)){var e=t.split("_")[0],s=t.indexOf("short")>-1,i=s?this._matchesShort:this._matches,n=s?this._storedDataShort:this._storedData;if(!i[e])continue;i[e].forEach(function(t){t(n[e].match)})}this._dirtyListeners={}},_updateChannels:function(){this._channelsSetted=!0;var t,e=home.getData("football",{}),s=[],i=Math.floor(home.now().getTime()/1e3),n=this._config;function r(t){var s=e["upd_"+t];if(!s)return!1;var r=Number(s.timestamp);return r-n.updateBeforeMatch<=i&&r+n.updateAfterMatch>i}for(t in this._matches)this._matches.hasOwnProperty(t)&&this._matches[t].length&&r(t)&&s.push(t);for(t in this._matchesShort)this._matchesShort.hasOwnProperty(t)&&this._matchesShort[t].length&&r(t)&&s.push(t+"_short");this._listening.forEach(function(t){-1===s.indexOf(t)&&BEM.blocks["i-xiva"].stopListen("football_"+t,this._listenHandler)},this),s.forEach(function(t){-1===this._listening.indexOf(t)&&BEM.blocks["i-xiva"].listen("football_"+t,0,this._listenHandler,{force:!0})},this),this._listening=s,this._setupNextUpdate()},_setupNextUpdate:function(){var t=home.getData("football",{}),e=Math.floor(home.now().getTime()/1e3),s=this._config,i=Infinity,n=60;function r(e){var i=t["upd_"+e];if(!i)return[];var r=Number(i.timestamp);return[r-s.updateBeforeMatch+n,r+s.updateAfterMatch+n]}function a(t){for(var s in t){if(t.hasOwnProperty(s)&&t[s].length)r(s).forEach(function(t){t>e&&(i=Math.min(i,t-e))})}}a(this._matches),a(this._matchesShort),clearTimeout(this._updateChannelsTimeout),i<Infinity&&(this._updateChannelsTimeout=setTimeout(this._updateChannelsDebounced,1e3*i))}},{STORE_FOLLOW_TIMEOUT:6e4,getInstance:function(){return this._instance||(this._instance=BEM.create({block:this.getName()}),this._instance.init()),this._instance}}),BEM.DOM.decl("stream-infinity-carousels",{onSetMod:{js:{inited:function(){this._cms=BEM.blocks["stream-cms"],this._stream=this.findBlockOutside("stream"),this._updateEvent=home.throttle(this._update.bind(this),300),this._uniqueCarousels=this.params.uniqueCarousels,this._countLoadedCarousels=this.params.loadedCarousels,this._notShowedCarousels=Object.assign({},this._uniqueCarousels),this._nextLoad=!0,this._gettingCarousels=!1,this._update(null,this._scrollTop(),this.params.firstFetchData),this.listenEvents()}}},destruct:function(){this.__base.apply(this,arguments),this.stopListenEvents()},listenEvents:function(){},stopListenEvents:function(){},_scrollTop:function(){},_update:function(t,e,s){e=e||0,this._shouldGetMoreCarousels(e,s)&&(home.stat.logPath("tech","stream.infinity-carousels."+(this.params.tag||"default")+".getdata"),this._getCarousels(this.params.tag,this.params.carouselsPerTime).then(this._addCarouselsToPage.bind(this))),this._nextLoad||0!==Object.keys(this._notShowedCarousels).length||this.stopListenEvents(),this._sendRealShow(e)},_sendRealShow:function(t){var e=t||0,s=window.innerHeight+e;this.findBlocksInside("stream-carousel").forEach(function(t){var i=t.getCarouselId(),n=t.domElem,r=n&&n.data("realshow");if(i&&this._notShowedCarousels[i]&&r){var a=n.height(),o=n[0].offsetTop,c=o+a;(e<=o&&c<=s||o<=e&&c<=s&&(c-e)/a>.5||e<=o&&s<=c&&(s-o)/a>.5)&&(delete this._notShowedCarousels[i],home.stat.logPath("show",r))}}.bind(this))},_isEnableInfinityCarousels:function(){return this.params&&this.params.infinity},_shouldGetMoreCarousels:function(t,e){var s=this._gettingCarousels||!this._nextLoad,i=!this.params||!this.params.carouselsPerTime;if(s||i||!this._isEnableInfinityCarousels()&&0!==this._countLoadedCarousels||this._isDestructing)return!1;var n=this._isOnBottomEdge(t);return n&&this._addFakeCarousels(),!!e||n},_isOnBottomEdge:function(t){var e=t||0,s=window.innerHeight,i=e+s;return this.domElem[0].offsetTop+this.domElem.height()-i<s},_getCarousels:function(t,e){return this._gettingCarousels=!0,this._cms.getCarousels({limit:e,offset:this._countLoadedCarousels,tag:t}).then(function(t){this._gettingCarousels=!1;var s=t&&t.length,i=t&&this._filterUniqueCarousels(t);return(!t||s<e)&&(this._nextLoad=!1),this._countLoadedCarousels+=s,i}.bind(this))["catch"](function(e){this._gettingCarousels=!1,home.error.logError({message:"stream-infinity-carousels error: "+e.message,block:"stream",sourceType:"logic",meta:{tag:t}},e)}.bind(this))},_getCarouselsHtml:function(t,e){var s=this.params||{};return s.carousels=t,s.fake=e,home.view("stream-infinity-carousels__list",s)},_addCarouselsToPage:function(t){this._isDestructing||(this._deleteFakeCarousels(),BEM.DOM.append(this.elem("content"),this._getCarouselsHtml(t,!1)),this._countShows(),this._update(null,this._scrollTop()))},_addFakeCarousels:function(){this._isDestructing||BEM.DOM.append(this.elem("content"),this._getCarouselsHtml([],!0))},_deleteFakeCarousels:function(){this._isDestructing||this.elem("content").children(".stream-carousel_fake_yes").remove()},_filterUniqueCarousels:function(t){return t.filter(function(t){return!this._uniqueCarousels[t.carousel_id]&&(this._uniqueCarousels[t.carousel_id]=!0,this._notShowedCarousels[t.carousel_id]=!0,!0)},this)},_countShows:function(){this.afterCurrentEvent(function(){home.stat.logDOMShow(this.domElem)})}}),BEM.DOM.decl("stream-infinity-carousels",{listenEvents:function(){this._isEnableInfinityCarousels()&&(this.__base.apply(this,arguments),this.bindToWin("resize",this._updateEvent,this),this.channel("stream").on("scroll",this._updateEvent,this))},stopListenEvents:function(){this.__base.apply(this,arguments),this.unbindFromWin("resize",this._updateEvent,this),this.channel("stream").un("scroll",this._updateEvent,this)},_scrollTop:function(){return this._stream._scrollTop}}),BEM.DOM.decl("stream-carousel",{onSetMod:{js:{inited:function(){this._carouselId=this.params.carouselId,this._calcOverflowCarousel()}}},getCarouselId:function(){return this._carouselId},_calcOverflowCarousel:function(){var t=this.getCarouselId();BEM.blocks["i-multiline-overflow"].calcOverflow(this.elem("content"),2,t)}}),BEM.DOM.decl("stream-carousel",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._cms=BEM.blocks["stream-cms"],this._carousel=this.findBlockInside("arrowed-list"),this._onScroll=home.throttle(this._onScroll.bind(this),100),this._itemsCount=this.params.countItems,this._uniqueItems=this.params.uniqueItems,this._infinityCarousel=BEM.create("stream-infinity-carousel",{carouselId:this._carouselId}),this.totalCount=this.params.totalCount===undefined?Infinity:this.params.totalCount,this._itemsCount&&this._infinityCarousel.setLoadedItems(this._itemsCount),this._uniqueItems&&this._infinityCarousel.setUniqueItems(this._uniqueItems),this.totalCount<=this._itemsCount&&this._infinityCarousel.setNext(!0),this.bindTo("content","scroll",this._onScroll),this._carousel.on("scroll",this._countListSwipe,this),this.bindToWin("resize",this._loadVisibleImages,this),this._countShows(),this._onScroll()}}},destruct:function(){this.elem("content").unbind("scroll"),this._carousel.un("move",this._countShows,this),this._carousel.un("scroll",this._countListSwipe,this),this.unbindFromWin("resize"),this._infinityCarousel=null,this.__base.apply(this,arguments)},_onScroll:function(){this._shouldGetMoreItems()?(home.stat.logPath("tech",(this.params.statRoot||"stream")+".carousels."+this._carouselId+".getdata"),this._addMoreItems()):this._loadVisibleImages()},_getItemsHtml:function(t){var e=this.params.carouselParams||{};return e.items=t,e.countItems=this._itemsCount,home.view("stream-carousel__list",e)},_addMoreItems:function(){this._infinityCarousel.getItems(this._itemsPerTime).then(function(t){this._isDestructing||(BEM.DOM.append(this.elem("content"),this._getItemsHtml(t)),this._carousel.toggleArrows(),this._countShows(),this._loadVisibleImages())}.bind(this))},_shouldGetMoreItems:function(){if(!this._infinityCarousel||this._infinityCarousel.getGettingItems()||this._infinityCarousel.hasNext())return!1;var t=this.elem("content"),e=t.width(),s=t.scrollLeft()+e,i=t.children().toArray(),n=i[i.length-1];return n.offsetLeft+$(n).width()-s<e&&this._uniqueItems!==undefined},_countShows:function(){home.stat.logDOMShow(this.domElem)},_countListSwipe:function(){home.stat.logPath("click",(this.params.statRoot||"stream")+".carousel."+this.params.type+".scroll.swipe")},_loadVisibleImages:function(){if(this._carousel.update(),this._infinityCarousel){var t=this._carousel.getVisibleItems();this._infinityCarousel.loadItemsImage(t)}},_itemsPerTime:20}),BEM.DOM.decl("thumb-preview",{onSetMod:{js:{inited:function(){this.hasMod("video")||(this._loaded=[],this._preloader=BEM.create({block:"i-preloader",mods:{nosize:"yes",batch:"yes"}}),this._preloader.on("success",this._onPreloaderSuccess,this),this._preloader.on("notfound error",this._onPreloaderError,this))}},active:{yes:function(){this._isActive=!0,this._activeStartTime=Date.now();var t=this._getCurrent();t&&t.delMod("active"),this._setCurrent(this),this._start()},"":function(){this._isActive=!1,this._stop()}}},destruct:function(){this._preloader&&(this._preloader.un("success",this._onPreloaderSuccess,this),this._preloader.un("notfound error",this._onPreloaderError,this),this._preloader.destruct()),clearTimeout(this._tick),this._getCurrent()===this?(this._stop(),this._setCurrent(null)):(clearTimeout(this._timer),clearTimeout(this._startTimer)),this.__base.apply(this,arguments)},start:function(){this._outTimer&&clearTimeout(this._outTimer),this._isActive||this.hasMod("disabled",!0)||(clearTimeout(this._startTimer),this._startTimer=setTimeout(function(){this.setMod("active","yes")}.bind(this),this.params.startDelay))},stop:function(){clearTimeout(this._startTimer),this.delMod("active")},_getCurrent:function(){return this.__self.getCurrent()},_setCurrent:function(t){return this.__self._current=t,this},_start:function(){if(delete this._currentIndex,this._saveState(),!this._loaded.length)return this._preload(1);this._onStart(),this._restartTimer()},_stop:function(){this.trigger("stop"),clearTimeout(this._timer),this._restoreState()},_restartTimer:function(){if(clearTimeout(this._timer),!this.params.infinite&&this._isLast())return this.trigger("end"),this._stop(),void this.setMod("disabled",!0);this._next(),this.trigger("change",this._currentIndex),BEM.blocks["thumb-preview"].trigger("thumb-change",this._currentIndex),this._timer=setTimeout(this._restartTimer.bind(this),this.params.delay)},_isLast:function(){var t=this._loaded.length-1;return this._currentIndex===t&&0===this.params.thumbs.length},_onPreloaderSuccess:function(t,e){var s=this._findThumb(e.url);s&&(this._isActive&&!this._loaded.length&&(this._onStart(),this._tick=setTimeout(this._restartTimer.bind(this))),this._loaded.push(s))},_onPreloaderError:function(t,e){this._findThumb(e)&&this._preload(this.params.step)},_onStart:function(){this.trigger("start")},_findThumb:function(t){for(var e=null,s=this.params.thumbs,i=0;i<s.length;i++)if(-1!==s[i].indexOf(t)){e=s.splice(i,1)[0];break}return e},_preload:function(t){this._preloader.setImages(this._getImagesForPreload(t)).batchLoad()},_getImagesForPreload:function(t){var e=this.__self.getPixelRatio();return this.params.thumbs.slice(0,t).map(function(t){return[{url:t[(e>t.length?t.length:e)-1]}]})},_next:function(){this._setImageById(this._getNextIndex()),this._preload(this.params.step)},_getNextIndex:function(){var t="undefined"!=typeof this._currentIndex?this._currentIndex+1:0;return t>=this._loaded.length&&(t=this.params.thumbs.length?t-1:0),this._currentIndex=t},_saveState:function(){var t=this.elem("target");this._isImg()?this._state={src:t.attr("src"),srcset:t.attr("srcset")}:this._state=t.css("background-image")},_restoreState:function(){var t=this.elem("target");this._state&&(this._isImg()?(t.attr("src",this._state.src),t.attr("srcset",this._state.srcset||null)):t.css("background-image",this._state))},_setImageById:function(t){var e=this.elem("target");this._isImg()?(e.attr("srcset",this._loaded[t].map(function(t,e){return t+" "+(e+1)+"x"}).join(", ")),e.attr("src",this._loaded[t][0])):e.css("background-image","url("+this._loaded[t][0]+")")},_isImg:function(){return this.elem("target").is("img")}},{getCurrent:function(){return this._current},live:function(){BEM.blocks["b-page"]&&BEM.blocks["b-page"].on("blur",this.stop,this)},getPixelRatio:function(){return this._pixelRatio||(this._pixelRatio=Math.ceil(window.devicePixelRatio||1)),this._pixelRatio},stop:function(){this._current&&this._current.delMod("active")}}),BEM.DOM.decl("thumb-preview",{_longTapBrakeTimeout:500,_sendHoverCounter:function(){var t=encodeURIComponent(this.params.preview.url);home.stat.logPath("tech","thumbs-preview.hover(url="+t+")")},_onPointerStart:function(){this.setMod("active","yes"),this._pointerStart=home.now()},_onPointerEnd:function(t){home.now()-this._pointerStart>this._longTapBrakeTimeout&&t.cancelable&&t.preventDefault()}},{live:function(){this.__base(),this._isHaveTouch()?(this.liveBindTo("touchstart",function(){this._onPointerStart()}),this.liveBindTo("touchend touchcancel",function(t){this._onPointerEnd(t)})):this.liveBindTo("pointerover",function(){this.hasMod("active","yes")||this.hasMod("disabled","yes")||this._sendHoverCounter(),this._onPointerStart()})},_isHaveTouch:function(){return $(".i-ua_browser_touch").length}}),BEM.decl({block:"thumb-preview",modName:"video",modVal:!0},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),BEM.DOM.append(this.elem("target"),this.__self._getBemHtml())}},active:{yes:function(){var t=this._getCurrent();this._activeStartTime=Date.now(),t&&t!==this&&t.delMod("active"),this._setCurrent(this),this.start()},"":function(){this.stop()}}},destruct:function(){var t=this._getCurrent();t===this&&(t.stop(),t._setCurrent(null)),this.__base.apply(this,arguments)},start:function(){var t;this.hasMod("active","yes")||this.hasMod("disabled",!0)||(this._addPlayer(),this._player&&(void 0!==(t=this._player[0].play())&&t["catch"](this._onPlayError.bind(this)),this.setMod("active","yes"),this.trigger("start")))},stop:function(){this.delMod("active"),this._playing&&this._player&&(this._player[0].pause(),this._player[0].readyState>0&&(this._player[0].currentTime=0),this.delMod(this.elem("target"),"playing"),delete this._playing),this.trigger("stop")},_addPlayer:function(){var t=this.params.preview,e={};t&&(e.src=t.url,e.type=t.type,this.params.loop&&(e.loop="loop"),this._player||(this._player=this.__self._getPlayer()),BEM.DOM.prepend(this.elem("target"),this._player),this._player.attr(e))},_onError:$.noop,_onPlay:function(){this._playing=!0,this.delMod(this.elem("target"),"loading"),this.setMod(this.elem("target"),"playing",!0)},_onEnded:function(){this.stop(),this.trigger("end")},_onWait:function(){this.setMod(this.elem("target"),"loading",!0)},_onPlayError:function(t){this._isDestructing||(this.delMod(this.elem("target"),"loading"),this.delMod("active"))},_getCurrent:function(){return this.__self.getCurrent()},_setCurrent:function(t){return this.__self._current=t,this}},{_getBemHtml:function(){if(!this._videoBemHtml){this._videoBemHtml=document.createElement("div"),this._videoBemHtml.className=BEM.INTERNAL.buildClass(this.getName(),"loader");var t=document.createElement("div");t.className=BEM.INTERNAL.buildClasses("spin2",{progress:"yes",size:"xxs"}),this._videoBemHtml.appendChild(t)}return this._videoBemHtml},_getPlayer:function(){if(!this._player){var t=document.createElement("video"),e={autoplay:"autoplay",muted:"muted","x-yandex-pip":"false","x-webkit-airplay":"deny",playsinline:"playsinline"};t.className=BEM.INTERNAL.buildClass(this.getName(),"video"),t.muted="muted",Object.keys(e).forEach(function(s){t.setAttribute(s,e[s])}),this._player=BEM.DOM.append(BEM.DOM.scope,t),["Ended","Playing","Waiting","Error"].forEach(this._addEvent.bind(this))}return this._player},_addEvent:function(t){this._player&&this._player[0].addEventListener(t.toLowerCase(),function(){this._current&&this["_on"+t]()}.bind(this))},_onEnded:function(){this._current._onEnded()},_onPlaying:function(){this._current._onPlay()},_onWaiting:function(){this._current._onWait()},_onError:function(){this._current._onError()}}),BEM.decl({block:"thumb-preview",modName:"video",modVal:!0},{_onPlay:function(){var t,e=encodeURIComponent(this.params.preview.url);this._activeStartTime&&(t=Date.now()-this._activeStartTime,home.stat.logPath("tech","thumbs-preview.animation(delay="+t+";type=video;url="+e+")")),this._activeStartTime=0,this.__base.apply(this,arguments)},_onError:function(){var t=encodeURIComponent(this.params.preview.url);this._activeStartTime=0,home.stat.logPath("tech","thumbs-preview.error(url="+t+")"),home.error.logError({block:"stream",sourceType:"vh",meta:{url:t}},{message:"video-preview load error"}),this.__base.apply(this,arguments)}}),BEM.decl({block:"thumb-preview",modName:"video",modVal:!0},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),$(".i-ua_browser_touch").length||this.bindTo("pointerleave",function(){this.delMod("active")})}}}}),BEM.decl("stream-infinity-carousel",{onSetMod:{js:{inited:function(){this._uniqueItems={},this._carouselId=this.params?this.params.carouselId:"",this._loadedItems=0,this._hasNext=!1,this._gettingItems=!1}}},getItems:function(t){var e=this.getLoadedItems();return this.setGettingItems(!0),BEM.blocks["stream-cms"].getCarouselItems({carousel_id:this.getCarouselId(),limit:t,offset:e}).then(function(t){t=t||[],this.setGettingItems(!1);var s=t.length;return s?(t=this._filterUniqueItems(t),this.setLoadedItems(e+s),t):(this.setNext(!0),[])}.bind(this))["catch"](function(s){this.setGettingItems(!1),this.onError({message:"stream-infinity-carousel._getItems: fail ->"+s,meta:{carousel_id:this.getCarouselId(),limit:t,offset:e}})}.bind(this))},loadItemsImage:function(t){t.forEach(function(t){var e=$(t);e.hasClass("stream-infinity-carousel__image-processed")||(e.addClass("stream-infinity-carousel__image-processed"),e.find("[data-image]").each(function(){var t=new Image,e=$(this),s=e.data("image");s&&(t.onload=function(){e.css("background-image",'url("'+s+'")'),e.addClass("stream-infinity-carousel__image_loaded_yes")},t.src=s)}))})},_filterUniqueItems:function(t){return t.filter(function(t){return!this._uniqueItems[t.content_id]&&(this._uniqueItems[t.content_id]=!0,!0)},this)},setUniqueItems:function(t){this._uniqueItems=t},getLoadedItems:function(){return this._loadedItems||0},setLoadedItems:function(t){this._loadedItems=t},hasNext:function(){return this._hasNext||!1},setNext:function(t){this._hasNext=t},getGettingItems:function(){return this._gettingItems||!1},setGettingItems:function(t){this._gettingItems=t},getCarouselId:function(){return this._carouselId||""}}),BEM.DOM.decl({block:"stream-schedule",baseBlock:"stream-screen"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.findBlockInside("stream-calendar").on("date",this._onPickDate,this)}},show:function(t){t.current&&this._updateCurrentProgram(t.current),this.__base.apply(this,arguments)},hide:function(){this._channel=this._date=null,this.__base.apply(this,arguments)},_updateCurrentProgram:function(t){this._current=t,this._date=1e3*this._cms.dayStart(this._current&&this._current.start_time)},update:function(t){var e=!1;t.current&&t.auto&&this._updateCurrentProgram(t.current);var s=t.current||{},i=t.channel||s.channel||this._channel;this._channel!==i&&(this._channel=i,e=!0,this.updateTitle(i)),e&&this.updateTable();var n=1e3*this._cms.dayStart(home.now()/1e3-Math.max(i.catchup_age,86400));(!this._date||this._date<n)&&(this._date=1e3*this._cms.dayStart()),this._setlogScreenShowParams(),this.__base.apply(this,arguments),setTimeout(function(){var t=this.findBlockInside("stream-calendar");t.enabledFrom(n),t.setDate(this._date,!0)}.bind(this),0)},_setlogScreenShowParams:function(){var t=this._current?{content_id:this._current.content_id,content_type:this._current.content_type_name}:{};this._channel&&(t.channel_id=this._channel.channel_id),this._logScreenShowParams=t},updateTitle:function(t){t?this.elem("channel-header").text(t.title):this.elem("channel-header").text("")},updateTable:function(){var t=this._channel,e=t&&t.content_id,s=this.params.settings.scheduleWarning&&!t.meta.no_schedule_warning;if(t)if(e){this._enabledPrograms=null,this._loadingElem("events",!0),this._hidingElem("events",!1);var i=this.getStateLock("updtable"),n=this._date/1e3;this._cms.getPrograms({parent_id:e,end_from:n,start_to:n+86400}).then(function(t){var e=t.filter(function(t){return t.start_time>=n});i()&&this.drawTable(e,s)}.bind(this),function(t){i()&&this.drawError(),this.onError({message:"updateTable -> "+t.message,originalMessage:t.originalMessage})}.bind(this))}else this._hidingElem("events",!0);else this.drawTable([],s)},drawError:function(){BEM.DOM.update(this.elem("events"),home.view("stream-events",{error:!0})),this._loadingElem("events",!1),this.countShows()},drawTable:function(t,e){var s=home.now()/1e3,i="";this._enabledPrograms=t.map(function(t){return{item:t,enabled:t.canPlay(s)}}),e&&(i+=home.view("stream-schedule__warning",{})),i+=home.view("stream-events",{items:t,canRestartCurrent:this._current.canRestart(s),playing:this._current&&this._current.content_id,enabled:this._enabledPrograms,statRoot:"stream.schedule",notFirstPaint:!0}),BEM.DOM.update(this.elem("events"),i),this._loadingElem("events",!1),this.countShows()},_onPickDate:function(t,e){e&&this._date!==e&&(this._date=e,this.findBlockInside("stream-calendar").setDate(e),this.updateTable())},canShow:function(){return!0},extractParams:function(t){var e=this.__base(t);return e.origin="schedule_item",e},_name:"schedule"}),BEM.DOM.decl("stream-schedule",{update:function(t){return t.current?this.updateNavplace(!0,t):this.updateNavplace(!1,t),this.__base.apply(this,arguments)},updateNavplace:function(t,e){BEM.DOM.update(this.elem("navplace"),t?home.view("stream-navbutton",{parent:"schedule",type:"watching",urlParams:{streamChannel:e.channel_id}}):"")}}),BEM.DOM.decl("stream-calendar",{setDate:function(t,e){var s=this._roundDate(t),i=this.elem("item","date",s);i.length&&!this.hasMod(i,"selected")&&(this.delMod(this.elem("item","selected","yes"),"selected","yes"),this.setMod(i,"selected","yes")),this.seekToSelected(e)},_roundDate:function(t){var e=new Date(t);return e.setMilliseconds(0),e.setSeconds(0),e.setMinutes(0),e.setHours(5),+e},enabledFrom:function(t){var e=this._roundDate(t);this.elem("week").toArray().forEach(function(t){var s=this.findElem($(t),"item").toArray(),i=this.toggleElems(s,e);this.setMod($(t),"enabled",i?"yes":"no")},this)},toggleElems:function(t,e){var s;return t.forEach(function(t){var i=$(t),n=this.getMod(i,"date")>=e;this.setMod(i,"enabled",n?"yes":"no"),n&&(s=!0)},this),s},seekToSelected:function(){}},{live:function(){return this.liveBindTo("item","click",function(t){var e=t.data.domElem;this.trigger("date",+this.getMod(e,"date"))}),this.liveBindKey("item","space enter",function(t){var e=t.data.domElem;return this.trigger("date",+this.getMod(e,"date")),!1}),this.__base()}}),BEM.DOM.decl("stream-calendar",{seekToSelected:function(t){this.findBlockInside("arrowed-list").seek(this.elem("item","selected","yes"),t)}}),BEM.DOM.decl({block:"stream-storefront",baseBlock:"stream-screen"},{onSetMod:{active:{yes:function(){this.__base.apply(this,arguments),this._uniqCarousels={},this._name="storefront"}}},show:function(){return this.__base.apply(this,arguments),this._updateContent()},hide:function(){this._onlineEpisodes&&this._onlineEpisodes.destroy(),this.__base.apply(this,arguments)},_updateContent:function(){this._updatePromo(),this._updateOnlineEpisodes(),this._updateCarousels()},_updatePromo:function(){this._promoUpdated||this._getPromos().then(function(t){if(t.length<this.params.promoCount){var e=new Error("_updatePromo: not enough promo");return e.meta={promoCount:this.params.promoCount,actualPromoCount:t.length},Promise.reject(e)}t.length>this.params.promoCount&&(t=t.slice(0,this.params.promoCount)),this._drawPromo(t),this._promoUpdated=!0,this.countShows()}.bind(this))["catch"](function(t){BEM.DOM.update(this.elem("promo"),""),this.onError(t)}.bind(this))},_updateOnlineEpisodes:function(){this._onlineEpisodes=this.findBlockInside("stream-online-episodes"),this._onlineEpisodes&&this._onlineEpisodes.update()},_updateCarousels:function(){return this._isGettingCarousels=!0,Promise.all([this._getCarousels(),this._getExtraLibCarousels(),this._getChannelCarousels()]).then(this._afterCarouselsLoad.bind(this))["catch"](function(t){BEM.DOM.update(this.elem("carousels"),""),this._isGettingCarousels=!1,this.onError({message:"storefront:"+t.message,originalMessage:t.originalMessage})}.bind(this))},_afterCarouselsLoad:function(t){var e=t[0]&&t[0].slice()||[],s=t[1],i=t[2]||[],n=[];if(0===e.length&&0===i.length&&0===s.length)return Promise.reject({message:"empty carousels"});if(this._isGettingCarousels=!1,this._carouselsCount=e.length,i.length>0&&e.length>0)for(var r=0;r<=e.length-1;r++)n.push(e[r]),r>e.length-4&&i.length&&n.push(i.shift());e=this._filterUniqueCarousels(n.concat(i)),s.length&&!this.params.settings.disableExtraCarousels&&s.reverse().forEach(function(t){e.unshift(t)}),this._drawCarousels(e),this._carouselUpdated=!0,this.countShows()},_filterUniqueCarousels:function(t){return t.filter(function(t){return!this._uniqCarousels[t.carousel_id]&&(this._uniqCarousels[t.carousel_id]=!0,!0)},this)},_getPromos:function(){for(var t,e=this.params.data.storefront_promo,s=[],i=function(t){var e=new Error("No content_id or url for promo");return e.meta={promo:{}},["title","thumbnail"].some(function(s){if(s in t)return e.meta.promo[s]=t[s],!0}),e},n=0;n<e.length;n++){var r=e[n];if(r.content_id)t=this._cms.getResourceById(r.content_id),s.push(t);else{if(!r.url)return Promise.reject(i(r));s.push(Promise.resolve({}))}}return Promise.all(s).then(function(t){return t.forEach(function(t,s){e[s]=$.extend({},t,e[s]),t.content_id&&this._cms.getProgramByResource(t)["catch"](function(){})}.bind(this)),e}.bind(this))},_getCarousels:function(){return this._cms.getCarousels({limit:4}).then(function(t){return t&&0!==t.length?t:Promise.reject({message:"no recommended carousels"})})["catch"](function(t){return this.onError({message:"storefront:"+t.message,originalMessage:t.originalMessage}),Promise.resolve([])}.bind(this))},_getChannelCarousels:function(){if(this.params.settings.disableChannelCarousels)return Promise.resolve([]);var t=this.params.minChannels,e=this._cms.getChannelsByCategory({popular:[],inform:[],entertain:[],business:[],sport:[],music:[],educate:[],films:[],foreign:[],region:[],yandex:[],other:[]}),s=[];return["entertain","educate","inform","business","sport","music","films","foreign","region","yandex"].forEach(function(i){e.hasOwnProperty(i)&&e[i].length>=t&&s.push({carousel_id:i+"_category",has_vertical:!1,set:e[i],totalCount:e[i].length,title:home.l10n("stream.storefront.channel_category."+i)})}),0===s.length&&this.onError({message:"storefront: no channel carousels"}),Promise.resolve(s)},_getExtraLibCarousels:function(){return Promise.all(this.params.settings.storeFrontLibId.map(this._getExtraLibCarousel.bind(this))).then(function(t){return t.filter(Boolean)})},_getExtraLibCarousel:function(t){return t?this._cms.getLibById(t).then(function(t){return t.isForbidden()?Promise.resolve({}):t.getEpisodes({limit:20}).then(function(e){return{lib:t,programs:e}})}).then(this._prepareExtraCarousel.bind(this),function(e){return this.onError({message:"_getExtraLibCarousel:no data"+(e&&e.message?"->"+e.message:""),meta:{libId:t}}),Promise.resolve()}.bind(this)):Promise.resolve()},_prepareExtraCarousel:function(t){return t.programs&&t.programs.length?(t.programs.sort(function(t,e){return this.params.settings.exp.stream_first_series?t.release_date_ut-e.release_date_ut:e.release_date_ut-t.release_date_ut}.bind(this)),{carousel_id:"EXTRA_LIBRARY",has_vertical:!1,set:t.programs,totalCount:t.programs.length,title:t.lib.title}):Promise.resolve()},_drawPromo:function(t){BEM.DOM.update(this.elem("promo"),home.view("stream-promo",{promo:t})),this.afterCurrentEvent(function(){this._calcOverflowPromo()},this)},_drawCarousels:function(t){BEM.DOM.update(this.elem("carousels"),this._getCarouselsHtml(t)),this.afterCurrentEvent(function(){this._calcOverflowCarousels()},this)},_getCarouselsHtml:function(t){return home.view("stream-infinity-carousels",{parent:"storefront",carousels:t,uniqueCarousels:this._uniqCarousels,showRating:this.params.settings&&this.params.settings.exp.stream_kprating,headerCategories:this._cms.getCarouselToCategoryMap()})},_calcOverflowPromo:function(){var t=$(window).width()<=1240?"_min":"";BEM.blocks["i-multiline-overflow"].calcOverflow(this.elem("promo"),2,"stream-storefront-promo"+t)},_calcOverflowCarousels:function(){BEM.blocks["i-multiline-overflow"].calcOverflow(this.elem("carousels"),2,"stream-storefront-carousel")}}),BEM.DOM.decl("stream-storefront",{onSetMod:{active:{yes:function(){this.__base.apply(this,arguments),this._carouselsPerTime=10,this._episodesCount=15,this.enhanceFonts(),this._calcOverflowThrottled=home.throttle(function(){var t=this.findBlockInside("stream-online-episodes");this._calcOverflowPromo(),this._calcOverflowCarousels(),t&&t.calcOverflowEpisodes()},300),this.bindToWin("resize",this._calcOverflowThrottled,this)}}},hide:function(){this.__base.apply(this,arguments),this._infinityCarousels&&this._infinityCarousels.stopListenEvents()},show:function(){this.__base.apply(this,arguments),this._infinityCarousels&&this._infinityCarousels.listenEvents()},enhanceFonts:function(){!this._enhanced&&$(".fonts_loaded_yes").length&&(this.domElem.addClass("fonts_loaded_yes"),this._enhanced=!0)},_updateCarousels:function(){this._carouselUpdated?(this.findBlocksInside(this.elem("carousels"),"stream-carousel")||[]).forEach(function(t){t._loadVisibleImages(),t.findBlockInside("arrowed-list").toggleArrows()}):this.__base.apply(this,arguments)},_afterCarouselsLoad:function(){this.__base.apply(this,arguments),BEM.DOM.append(this.elem("carousels"),home.view("stream-infinity-carousels",{loadedCarousels:this._carouselsCount,carouselsPerTime:this._carouselsPerTime,episodesCount:this._episodesCount,infinity:!0,parent:"storefront"})),this._infinityCarousels=this.findBlockInside({block:"stream-infinity-carousels",modName:"infinity",modVal:"yes"})}}),BEM.DOM.decl("stream-online-episodes",{onSetMod:{js:function(){this._cms=BEM.blocks["stream-cms"],this._stream=BEM.blocks.stream.getInstance()}},destroy:function(){this.setMod("hidden"),clearInterval(this._updateTimer),this._stream.destroyCacheTimer("onlineEpisodes")},update:function(){this._cms.getOnlineProgramsForTopChannels(this.params.count).then(function(t){var e=t[0].end_time;t.forEach(function(t){e=Math.min(e,t.end_time)}),this._stream.setCacheTimer(e,"onlineEpisodes",this._getOnlineEpisodesForTime.bind(this,this.params.count)),this._setUpdateTimer(e),this._draw(t),this.delMod("hidden"),this.countShows()}.bind(this))["catch"](function(t){t.message&&home.error.logError({block:"stream-online-episodes",message:"updateOnlineEpisodes:"+t.message,sourceType:"logic"},t),this.destroy(),this.setMod("hidden")}.bind(this))},_setUpdateTimer:function(t){clearInterval(this._updateTimer),this._updateTimer=setInterval(function(){home.now()/1e3>t&&(clearInterval(this._updateTimer),this.update())}.bind(this),1e3)},_getOnlineEpisodesForTime:function(t,e){this._cms.getOnlineProgramsForTopChannels(t,e+1)},_draw:function(t){BEM.DOM.update(this.domElem,home.view("stream-online-episodes__content",{episodes:t,parent:this.params.parent,statRoot:this.params.statRoot})),this.afterCurrentEvent(function(){this.calcOverflowEpisodes()},this)},calcOverflowEpisodes:function(){var t=$(window).width()<=1240?"_min":"";BEM.blocks["i-multiline-overflow"].calcOverflow(this.elem("online-episodes"),2,"stream-online-episodes"+t)},countShows:function(){this.afterCurrentEvent(function(){home.stat.logDOMShow(this.domElem)})}}),BEM.DOM.decl({block:"stream-channels-list",baseBlock:"stream-screen"},{show:function(){this.__base.apply(this,arguments);var t=this.params.settings||{},e={personalized:[],popular:[],yandex:[],inform:[],entertain:[],business:[],sport:[],music:[],educate:[],films:[],foreign:[],region:[],other:[]};t.exp&&t.exp.tv_online_personalized||delete e.personalized,this._updated||(this._channelsByCategory=this._cms.getChannelsByCategory(e),this._allChannels=this._sortChannelsByFirstLetter(this._cms.getChannels()||[]),this._updateContent()),this.countShows()},_updateContent:function(){this._drawCategories(),this._drawContent(),this._updated=!0},_drawCategories:function(){BEM.DOM.update(this.elem("categories"),home.view("stream-channels-list__categories",{channelsByCategory:this._channelsByCategory}))},_drawContent:function(t){this._hasFilter?this._drawChannels(t):this._drawTaglist(t)},_drawTaglist:function(t){BEM.DOM.update(this.elem("content"),home.view("stream-channels-list__taglist",{channels:t&&t.length?t:this._allChannels,channelsByCategory:this._channelsByCategory}))},_drawChannels:function(t){BEM.DOM.update(this.elem("content"),home.view("stream-channels-list__channels",{channels:t&&t.length?t:this._allChannels,showDescription:!0,category:this._lastSelectedCategory}))},_onFilterClick:function(t){if(this._lastSelectedCategory!==t){this._lastSelectedCategory&&this._deselectCategory(this._lastSelectedCategory),this._selectCategory(t),this._hasFilter="all"!==t,this._lastSelectedCategory=t;var e=this._channelsByCategory[t];this._drawContent(e),this.scrollToTop()}},_sortChannelsByFirstLetter:function(t){return t.sort(function(t,e){var s=/^[a-z]/i,i=s.test(t.title);return i!==s.test(e.title)?i?1:-1:t.title<e.title?-1:t.title>e.title?1:0}),t},_selectCategory:function(t){var e=this.elem("category").filter('[data-category="'+t+'"]').bem("button2");e.setMod("disabled","yes"),e.hasMod("checked","yes")||e.setMod("checked","yes")},_deselectCategory:function(t){var e=this.elem("category").filter('[data-category="'+t+'"]').bem("button2");e.delMod("disabled"),e.delMod("checked")},_name:"channels-list",_checkedCategories:{},_channelsByCategory:{},_lastSelectedCategory:"all",_allChannels:[]},{live:function(){return this.liveBindTo("category","pointerclick",function(t){this._onFilterClick(t.target.getAttribute("data-category"))}),this.__base()}}),BEM.DOM.decl("stream-channels-list",{onSetMod:{active:{yes:function(){this.enhanceFonts(),this.__base.apply(this,arguments)}}},enhanceFonts:function(){!this._enhanced&&$(".fonts_loaded_yes").length&&(this.domElem.addClass("fonts_loaded_yes"),this._enhanced=!0)},_onLinkClick:function(t){if(!$(t.target).closest(".stream-channels-list__channel-category").length)return this.__base.apply(this,arguments);var e=t.target.getAttribute("data-category");this._onFilterClick(e),this._selectCategory(e)}}),BEM.DOM.decl({block:"button2",modName:"has-control",modVal:"yes"},{onSetMod:{checked:{yes:function(){this.__base.apply(this,arguments),this.elem("control").prop("checked",!0).attr("aria-checked","true")},"":function(){this.__base.apply(this,arguments),this.elem("control").prop("checked",!1).removeAttr("aria-checked").removeAttr("checked")}}},getVal:function(){return this.elem("control").val()},setVal:function(t){return this.elem("control").val(t),this},_processClick:function(t){this.__base.apply(this,arguments),this.hasMod("type","radio")&&this.setMod("checked","yes"),this.hasMod("type","check")&&this.toggleMod("checked","yes")},getDefaultParams:function(){return $.extend(this.__base(),{prvntKeys:["SPACE"],clickKeys:["SPACE"]})}}),BEM.DOM.decl({block:"button2",modName:"type",modVal:"check"},{_onClick:function(){this.__base.apply(this,arguments),this.toggleMod("checked","yes")}}),BEM.DOM.decl({block:"button2",modName:"type",modVal:"radio"},{_onClick:function(){this.__base.apply(this,arguments),this.setMod("checked","yes")}}),BEM.DOM.decl({block:"stream-error",baseBlock:"stream-screen"},{onSetMod:{js:function(){this.__base.apply(this,arguments)}},canShow:function(){return!1},_getErrorText:function(t){return{title:home.l10n("stream.errortype."+t.code+".title")||home.l10n("stream.errortype.unexpected.title"),text:home.l10n("stream.errortype."+t.code+".text")||home.l10n("stream.errortype.unexpected.text")}},show:function(t){var e=t.error||{};this.params.settings.dev&&e&&this.elem("stack").html(e.stack||e.message||e);var s=this._getErrorText(e);this.elem("header").text(s.title),this.elem("text").html(home.view("stream-error__text",s)),this.__base.apply(this,arguments)},_name:"error"},{live:function(){return this.liveBindTo("reload","click",function(){location.reload()}),this.__base()}}),BEM.DOM.decl({block:"stream",modName:"width",modVal:"auto"},{onSetMod:{js:function(){this._toggleRecommended(),this.__base.apply(this,arguments)},visibility:{visible:function(){this.__base.apply(this,arguments),this.bindToWin("resize.width_auto",this._toggleRecommended),this.bindToWin("orientationchange.width_auto",this._toggleRecommended)},"":function(){this.__base.apply(this,arguments),this.unbindFromWin("resize.width_auto"),this.unbindFromWin("orientationchange.width_auto")}},width:function(){this.afterCurrentEvent(this._redrawRecomendedVod)}},getAllRecommended:function(){var t=this.__base.apply(this,arguments);return t.then(function(t){this._lastRecomended=t}.bind(this),function(){this._lastRecomended=null}.bind(this)),t},_toggleRecommended:function(){var t=$(window).width();this.setMod("width",t<1240?"narrow":"")},_redrawRecomendedVod:function(){this._lastRecomended&&this.updateMore(this._lastRecomended)},updateMore:function(t){var e=t.slice();if(this.hasMod("width","narrow"))for(var s=function(t,s){var i=0,n=0;t&&"vod-recommended"===t.type&&(e[s]={type:t.type,list:t.list.filter(function(t){return t.lib?i++<3:n++<3})})},i=0;i<t.length;i++)s(e[i],i);this.__base(e)}}),BEM.DOM.decl({block:"stream-sidemenu",baseBlock:"stream-screen"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.updateChannelView()}},peek:function(t){return this.show(t)},_deselect:function(){this._channelElem&&(this._channelElem.delMod("current"),this._channelElem.delMod("disabled"),this._channelElem=null)},noSelection:{"channels-list":1},update:function(t){var e=t.current&&t.current.channel,s=e&&e.isProjectChannel(),i=e&&e.meta&&e.meta.project_alias,n=e&&e.status&&e.status.hidden,r=this.findBlockOn("toggles","stream-toggles"),a=r&&r.has(t.active);if(r&&(a?r.select(t.active):r.deselect()),s&&n){var o=this._cms.getChannelsByProjectAlias(i).filter(function(t){return t.status&&!t.status.hidden});o.length&&(e=o[0])}if(a||this.noSelection[t.active])return this._deselect(),this.countShows(),this.updateCurrentElem(e),this.disableCurrent(),void this.__base.apply(this,arguments);e&&e.channel_id===this._current&&this.enableCurrent(),this._current=e&&e.channel_id,this._deselect(),e&&(this.updateCurrentElem(e),this._channelElem&&(this._channelElem.setMod("current","yes"),this.openChannelCategory(),this.toggleCurrentDisabled(t)),this.__base.apply(this,arguments),this.countShows())},updateCurrentElem:function(t){if(t){var e=this.findBlockInside({block:"stream-channel",modName:"id",modVal:""+t.channel_id});this._channelElem=e}},openChannelCategory:function(){},toggleCurrentDisabled:function(t){if(this._channelElem){var e="watching"===t.active&&(t.live||"continue"===t.auto);this._channelElem.setMod("disabled",e?"yes":"")}},disableCurrent:function(){this._channelElem&&this._channelElem.delMod("disabled")},enableCurrent:function(){this._channelElem&&this._channelElem.setMod("disabled","yes")},getChannelsHtml:function(){return home.view("stream-channels",{channels:this._cms.getChannels(),notFirstPaint:!0,statRoot:"stream.sidemenu.channel"})},updateChannelView:function(){BEM.DOM.update(this.elem("channels"),this.getChannelsHtml()),BEM.DOM.update(this.elem("toggles"),home.view("stream-sidemenu__toggles",{settings:this.params.settings})),this.dropElemCache("toggles"),this.dropElemCache("channels")},canShow:function(){return!0},extractParams:function(t){var e=this.__base(t);return e.origin="channel",e.live=!0,e},_name:"sidemenu"}),BEM.DOM.decl("stream-sidemenu",{onSetMod:{js:function(){this.__base.apply(this,arguments),window.Ya.PageLayoutConfigController.init("stream-sidemenu",[{media:"(max-width: 1279px)",mods:{collapsed:["yes","no"]}}])}},extractParams:function(t){var e=this.__base(t);return e.active=e.active||"watching",e},update:function(t){var e=t.program||t.current||{},s=this._cms.getCategories();this.params.settings.exp.stream_watching_sidemenu||"watching"!==t.active||e.channel||!s[e.onto_category]?this.setMod("active","yes"):this.hide(),this.__base.apply(this,arguments)},getChannelsHtml:function(){var t=this.params.settings,e=t.popularChannelsCount,s={personalized:[],own_region:[],popular:[],yandex:[],inform:[],entertain:[],business:[],sport:[],music:[],educate:[],films:[],foreign:[],region:[],other:[]};return t.exp&&t.exp.tv_online_personalized||delete s.personalized,home.view("stream-channels",{"category-region":this._cms.getChannelsByCategory(s,e),statRoot:"stream.sidemenu.channel",notFirstPaint:!0})}}),BEM.DOM.decl("stream-toggles",{has:function(t){return this.elem(t).length},select:function(t){this.deselect();var e=this.elem(t);if(e&&e.length)return this._selected=e,e.attr("disabled",!0),e},deselect:function(){this._selected&&(this._selected.attr("disabled",!1),this._selected=null)}}),BEM.DOM.decl({block:"stream-category",baseBlock:"stream-screen"},{onSetMod:{js:{inited:function(){this._onScroll=home.throttle(this._onScroll.bind(this),100),this._itemsPerTime=0,this._tagsPerTime=0,this._tagsEpisodesCount=0,this._promoCount=4,this._carouselId="",this._category="",this._tag="",this._infinityCarousel=null}}},hide:function(){this._deleteEvens(),this._clearDom()},destruct:function(){this._deleteEvens(),this._clearDom()},_deleteEvens:function(){this._deleteListenScroll(),this._infinityCarousel=null},_addListenScroll:function(){this.bindToWin("resize",this._onScroll,this)},_deleteListenScroll:function(){this.unbindFromWin("resize",this._onScroll,this)},_onScroll:function(t,e){e=e||0,this._shouldGetMoreItems(e)&&(home.stat.logPath("tech","stream.categories."+this._carouselId+".getdata"),this._addMoreItems(this._category)),this._loadVisibleImages(e)},_isSportCategory:function(t){return"sport"===t},_enableSportCategory:function(t){this._loadingCategory(!1),this.setMod("sport","yes"),this._updateContent(t)},_isTagCategory:function(t){return Boolean(t)},_enableTagCategory:function(t){setTimeout(function(){this.setMod(this.elem("carousels"),"shown","yes"),this._updateTagCarousels(t)}.bind(this),0)},_cardsCategory:function(t,e){return t&&e?(this.setMod(this.elem("items"),"shown","yes"),this._addFakeItems(),this._updateCardsCategory()):(this.delMod(this.elem("items"),"shown"),Promise.reject("stream-category._cardsCategory: no such category"))},_getCategories:function(t){return this._cms.getCategories()[t]||{}},update:function(t){var e=t.category||"",s=this._getCategories(e),i=s.carousel,n=s.tag;this._clearDom(),this._deleteEvens(),this._initCategory(i,e,n),this._setHeader(e),this._setlogScreenShowParams({category:e}),this.__base.apply(this,arguments),this._isSportCategory(e)?this._enableSportCategory(e):this._isTagCategory(n)?this._enableTagCategory(n):(this._addListenScroll(),this._cardsCategory(i,e))},_setlogScreenShowParams:function(t){this._logScreenShowParams=t},_loadingCategory:function(t){t?this.setMod("loading","yes"):this.delMod("loading")},_setHeader:function(t){BEM.DOM.update(this.elem("header"),home.l10n("stream.category."+t))},_initCategory:function(t,e,s){this._category=e,this._carouselId=t,this._tag=s,this._itemsCount=0,this._infinityCarousel=BEM.create("stream-infinity-carousel",{carouselId:t}),this.setMod("active","yes")},_clearDom:function(){BEM.DOM.update(this.elem("items"),""),BEM.DOM.update(this.elem("carousels"),""),BEM.DOM.update(this.elem("promo"),""),this.delMod(this.elem("items"),"shown"),this.setMod(this.elem("carousels"),"shown","yes"),this.delMod("sport"),this.delMod("active")},_updateTagCarousels:function(t){t===this._tag&&BEM.DOM.update(this.elem("carousels"),home.view("stream-infinity-carousels",{loadedCarousels:this._carouselsCount,carouselsPerTime:this._tagsPerTime,episodesCount:this._tagsEpisodesCount,infinity:!0,parent:"category",tag:t}))},_updateCardsCategory:function(){if(!this._infinityCarousel)return Promise.reject("stream-category._updateardsCategory: no _infinityCarousel");this._addMoreItems(this._category)},_shouldGetMoreItems:function(t){if(!this._infinityCarousel||this._infinityCarousel.getGettingItems()||this._infinityCarousel.hasNext()||"sport"===this._category)return!1;var e=this._isOnBottomEdge(t);return e&&this._addFakeItems(),e},_isOnBottomEdge:function(t){var e=t||0,s=window.innerHeight,i=e+s;return this.domElem[0].offsetTop+this.domElem.height()-i<s},_drawCategories:function(t,e,s){var i=this._getCategoriesHtml({items:t,fake:!1,category:s});this._loadingCategory(!1),BEM.DOM.update(this.elem("items"),i)},_addMoreItems:function(t){this._infinityCarousel.getItems(this._itemsPerTime).then(function(e){if(this._category===t){var s=this._getCategoriesHtml({items:e,category:t,fake:!1});this._deleteFakeItems(),BEM.DOM.append(this.elem("items"),s),this.countShows(),this._onScroll()}}.bind(this))},_addFakeItems:function(){BEM.DOM.append(this.elem("items"),this._getCategoriesHtml({items:[],category:this._category,fake:!0}))},_deleteFakeItems:function(){this.elem("items").children(".stream-card_fake_yes").remove()},_loadVisibleImages:function(t){if(this._infinityCarousel){var e=this._getVisibleItems(t)||[];this._infinityCarousel.loadItemsImage(e)}},_getVisibleItems:function(t){var e=t||0,s=window.innerHeight;return this.elem("items").children().toArray().filter(function(t){var i=t.offsetTop,n=$(t).height();return i<e+s&&i+n>e},this)},_getCategoriesHtml:function(t){var e=t.fake,s="stream-category__"+(e?"fake-":"")+"items";return home.view(s,{items:t.items,fakeCount:e?this._itemsPerTime:0,countItems:!e&&this._infinityCarousel?this._infinityCarousel.getLoadedItems():0,category:t.category,thumbLazyLoad:"yes"})},_drawCarousels:function(t){this._loadingCategory(!1),BEM.DOM.update(this.elem("carousels"),this._getCarouselsHtml({parent:"category",carousels:t},null)),this.afterCurrentEvent(function(){this._calcOverflowCarousels()},this)},_drawFakeCarousels:function(){BEM.DOM.update(this.elem("carousels"),this._getCarouselsHtml({parent:"category",carousels:[]},{count:4,vertical:!1}))},_getCarouselsHtml:function(t,e){return home.view("stream-carousels",{fake:e,parent:t.parent,carousels:t.carousels,showRating:this.params.settings&&this.params.settings.exp.stream_kprating})},_calcOverflowCarousels:function(){BEM.blocks["i-multiline-overflow"].calcOverflow(this.elem("carousels"),2,"stream-category-carousel")},_drawPromo:function(t){if(t.length<this._promoCount)return this.onError({message:"_drawPromo: not enough promo",meta:{promoCount:this._promoCount,actualPromoCount:t.length}}),void BEM.DOM.update(this.elem("promo"),"");BEM.DOM.update(this.elem("promo"),home.view("stream-promo",{parent:"category",promo:t})),this.afterCurrentEvent(function(){this._calcOverflowPromo()},this)},_calcOverflowPromo:function(){var t=$(window).width()<=1240?"_min":"";BEM.blocks["i-multiline-overflow"].calcOverflow(this.elem("promo"),2,"stream-category-promo"+t)},canShow:function(){return!0},_name:"category"}),BEM.DOM.decl("stream-category",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._itemsPerTime=48,this._tagsPerTime=10,this._tagsEpisodesCount=15}}},_addListenScroll:function(){this.channel("stream").on("scroll",this._onScroll,this),this.__base.apply(this,arguments)},_deleteListenScroll:function(){this.channel("stream").un("scroll",this._onScroll,this),this.__base.apply(this,arguments)},_onScroll:function(t,e){var s=[t,e||this._stream._scrollTop];this.__base.apply(this,s)}}),BEM.DOM.decl({block:"stream-category",modName:"sport",modVal:"yes"},{_updateContent:function(t){return this._drawCategories([],t),this._drawPromo(this._getSportPromos()),this._drawFakeCarousels(),this._getSportCarousels().then(this._drawCarousels.bind(this)),Promise.resolve()},_getSportChannels:function(){return this._cms.getAllChannels().filter(function(t){return t.status&&t.status.sport||t.channel_category&&-1!==t.channel_category.indexOf("sport")})},_getSportCarousels:function(){var t=this._cms,e=this._getSportCarouselGroups().map(function(e){var s=e.projectAlias?-604800:-129600,i=Math.ceil(home.now()/1e3);return Promise.all([this._getChannelProgramsForTime(e.channelIds,s),t.getPrograms({parent_id:e.channelIds,limit:2,end_from:i})]).then(function(s){if("sport"===this._category){var n=(s[0]||[]).concat(s[1]||[]),r={},a=[];if((a=(n=n.filter(function(e){return!(e instanceof t.VoidProgram)}).filter(function(t){return!r[t.content_id]&&(r[t.content_id]=!0,!0)})).reduce(function(t,e){return e.start_time>i?t.future.push(e):t.all.push(e),t},{future:[],all:[]})).future=[a.future.sort(t.sortByStartTime)[0]],!((n=a.all.concat(a.future).filter(Boolean)).length<7))return{carousel_id:"category_sport."+(e.projectAlias||e.channelIds[0]),has_vertical:!1,set:n.sort(t.sortByStartTime).slice(-50).reverse(),title:e.title}}}.bind(this),function(){return Promise.resolve()})}.bind(this));return Promise.all(e).then(function(t){return t.filter(Boolean)})},_getSportCarouselGroups:function(){var t,e,s;if(this._sportGroups)return this._sportGroups;s=(t=this._getSportChannels()).filter(function(t){return!t.meta.project_alias}),e=this._getSportAliases(t).map(function(t){return this._cms.getChannelsByProjectAlias(t)}.bind(this));var i=s.map(function(t){return{title:t.title,weight:t.weight,channelIds:[t.content_id]}}),n=e.map(function(t){var e=t.map(function(t){return t.content_id});return{title:t[0].title,weight:t.sort(this._cms.sortByWeight)[0].weight,channelIds:e,projectAlias:t[0].meta.project_alias}}.bind(this));return this._sportGroups=i.concat(n).sort(this._cms.sortByWeight),this._sportGroups},_getSportPromos:function(){var t={};return this._getSportChannels().filter(function(e){return(!e.status||!e.status.hidden)&&(!e.meta.project_alias||(t[e.meta.project_alias]?void 0:(t[e.meta.project_alias]=!0,!0)))}).map(function(t){return{title:t.title,content_id:t.content_id,subtitle:home.l10n("stream.promo_live"),thumbnail:t.thumbnail}}).slice(0,this._promoCount)},_getSportAliases:function(t){var e;return e=t.reduce(function(t,e){return e.meta&&e.meta.project_alias&&(t[e.meta.project_alias]=!0),t},{}),Object.keys(e)},_getChannelProgramsForTime:function(t,e,s){var i=s?new Date(1e3*s):home.now(),n=(+new Date(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours())+(e<0?36e5:0))/1e3,r=n+e,a=n<r;return this._cms.getPrograms({parent_id:t,end_from:a?n:r,start_to:a?r:n})}}),t={football:{stats:{ball_posession:" ",corners:"",red_cards:" ",shots_on_goal:"   ",shots_wide:"  ",yellow_cards:" "}},spok_yes:{month_accus:{1:"",10:"",11:"",12:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:""}},stream:{about:" ",announce:{olymp_live:"   "},category:{anim_film:"",anim_series:"",blogger:"",cybersport:"",film:"",series:"",sport:"",tv_channel:""},channel_categories:{region:{business:"",educate:"",entertain:"",films:"  ",foreign:"",inform:"",music:"",other:"",own_region:" ",personalized:"",popular:"",region:"",sport:"",thematic:"",yandex:" "}},channel_category:{all:"",business:"",educate:"",entertain:"",films:"  ",foreign:"",inform:"",music:"",other:"",personalized:"",region:"",single:{business:"",educate:"",entertain:"",films:"  ",foreign:"",inform:"",music:"",region:"",sport:"",yandex:"."},sport:"",yandex:""},chat_close:"",chat_live:" ",chat_login:"",chat_open:"",error_not_found:{subtitle:"       ,   ",title:"     "},errortype:{disabled:{text:"     . //    .",title:"  "},filtered:{text:"    .       .",title:" "},licenses:{text:"  "},region:{text:"    .",title:" "},unexpected:{text:"        .  //    .",title:"  "}},future:" ",header:{"channels-list":" ",plus:{available:"  "},start:" ",storefront:" ",user:{account:" ",add_account:" ",disk:" ",enter:"",help:"",logout:"",mail:"",notification:"",plus:" ",plus_active:"",registration:"",review:" ",settings:"",write_mail:" "}},"hide-info":"",live_tab:" ","more-info":"",more_episodes:" ",past_schedule:" ",promo_live:" ",schedule_warning:"  ",side_recommended:" ",sticker:{off:"",on:""},stickers:{counter_million_text:"",counter_text:"."},storefront:{channel_category:{business:" ",educate:" ",entertain:" ",films:"    ",foreign:" ",inform:" ",music:" ",region:" ",sport:" ",yandex:" "}},suggest:{label:{video_search:" &nbsp;."}},tv_back_to_live:"  ",tv_button:""}},home.lang=home.lang&&"undefined"!=typeof jQuery?jQuery.extend(!0,home.lang,t):t,function(){var t=home.view.define;home.view;t("stream",function(t,e,s){var i=t.data||{},n=t.settings||{},r=n.exp||{},a=t.mods||{},o=i["channel-icons"]||[],c={table:"yes",player:"yes",vod:"yes",start:"yes",stat:"yes",width:"auto",fn:"adventure",watcher:n.streamWatcher?"yes":undefined,initialProgram:i.initialProgram?i.initialProgram.content_id:"","channel-icon-color":"white"};for(var l in c)c.hasOwnProperty(l)&&(a[l]=c[l]);return n.videohub&&(a["channel-icon-color"]="black"),s("stream__layout",{mods:a,mix:s("stream__mix"),channels:i.channels,js:{stream:{data:i,settings:n},"stream-coordinator":{}},header:n.videohub?"":s("stream-header",{settings:n,headerCategories:i.header_category,channels:t.channels||i.channels}),sidemenu:s("stream-sidemenu",t),screens:s("stream-404",t)+s("stream-watching",t)+s("stream-schedule",t)+s("stream-storefront",{exp:r})+(n.channelsListEnabled?s("stream-channels-list"):"")+s("stream-category")+s("stream-error"),close:n.videohub?"":s("stream__close",{stat:e.stat.getClientCounter("stream.close")}),styles:s("inline-channel-icon",{icons:o,colors:n.videohub?"both":"white"})})}),t("stream__loader",function(t,e,s){return'<div class="stream__loader"><div class="loader loader_size_m"></div></div>'}),t("stream__close",function(t,e,s){var i;return'<div class="stream__close-wrap"><div class="stream__close '+(t.mix!==i?t.mix:"")+'" '+(t.stat!==i?t.stat:"")+' role="button" tabindex="0" title=""><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="m1.6,1.6l12.7,12.7m0,-12.7l-12.7,12.7" stroke-width="2.6" stroke="currentColor"/></svg></div></div>'}),t("stream__layout",function(t,e,s){var i;return'<div class="'+home.parseRules.bem(t,e,"stream.class")+'" data-bem="'+home.parseRules.bem(t,e,"js")+'"><style>'+(t.styles!==i?t.styles:"")+"</style>"+(t.close!==i?t.close:"")+'<div class="stream__main"><div class="stream__header">'+(t.header!==i?t.header:"")+'</div><div class="stream__center"><div class="stream__inner">'+(t.sidemenu!==i?t.sidemenu:"")+'<div class="stream__middle">'+(t.screens!==i?t.screens:"")+"</div></div></div></div></div>"}),t("stream__mix",function(){return[{block:"stream-coordinator",mods:{adventure:"yes"}},"i-bem","font-regular"]}),t("button2__icons",function(t,e,s){var i=[];return t.icon?i.push(s("button2__icon",{mod:t.icon})):t.iconObj&&i.push(s("icon",{mods:t.iconObj.mods,mix:"button2__icon"+(t.iconObj.mix?" "+t.iconObj.mix:"")})),t.iconLeft?i.push(s("button2__icon",{mod:"button2__icon_side_left "+t.iconLeft})):t.iconLeftObj&&i.push(s("icon",{mods:t.iconLeftObj.mods,mix:"button2__icon button2__icon_side_left"+(t.iconLeftObj.mix?" "+t.iconLeftObj.mix:"")})),t.iconRight?i.push(s("button2__icon",{mod:"button2__icon_side_right "+t.iconRight})):t.iconRightObj&&i.push(s("icon",{mods:t.iconRightObj.mods,mix:"button2__icon button2__icon_side_right"+(t.iconRightObj.mix?" "+t.iconRightObj.mix:"")})),i.join("")}),t("button2__default_mods",function(t,e,s){return"i-bem"}),t("button2",function(t,e,s){var i=t.mods||{},n=t.tag||"button",r=t.attrs||{};return t.url?n="a":t.tag&&(n=t.tag),i.theme||("yes"===i.pseudo?i.theme="pseudo":i.theme="normal"),r.role="button",t.tabindex&&(r.tabindex=t.tabindex),t.url?(r.href=t.url,t.target&&(r.target=t.target),i.disabled&&(r["aria-disabled"]=!0)):(r.type=t.type||"button",t.name&&(r.name=t.name),t.value&&(r.value=t.value),i.disabled&&(r.disabled="disabled")),i.view||(i.view="classic"),"<"+n+' class="'+home.getBEMClassname("button2",{mods:i,mix:t.mix})+" "+s("button2__default_mods",t)+'" data-bem="{&quot;button2&quot;:{}}"'+home.getAttributes(r)+(t.stat||"")+">"+s("button2__icons",t)+'<span class="button2__text"'+(t.text&&t.text.attrs?home.getAttributes(t.text.attrs):"")+">"+(t.content||"")+"</span></"+n+">"}),t("button2__icon",function(t,e,s){return'<span class="icon button2__icon '+(void 0!==t.mod?t.mod:"")+'" aria-hidden="true"></span>'}),t("stream-screen",function(t,e,s){var i;return'<div class="'+home.parseRules.bem(t,e,"stream-screen.class")+' i-bem" data-bem="'+home.parseRules.bem(t,e,"js")+'"><div class="stream-screen__content '+(t.contentMix!==i?t.contentMix:"")+'">'+(t.content!==i?t.content:"")+"</div></div>"}),t("stream-404__error_type_default",function(t,e,s){return s("stream-404__content",{title:home.prepareSpaces("     "),subtitle:home.prepareSpaces("       ,   ")})}),t("stream-404",function(t,e,s){return s("stream-screen",{mods:{404:!0},contentMix:"stream-404__content",mix:"stream-404",js:{"stream-404":{}},content:""})}),t("stream-404__content",function(t,e,s){var i;return'<span class="stream-404__title">'+(t.title!==i?t.title:"")+'</span><span class="stream-404__subtitle">'+(t.subtitle!==i?t.subtitle:"")+"</span>"}),t("stream-header__search-video-url",function(t,e){return["//yandex.",e.MordaZone,"/video/search"].join("")}),t("stream-header__suggest-video-url",function(t,e){return["//yandex.",e.MordaZone,"/suggest-video/videohub"].join("")}),t("stream-header__categories-channels",function(t,e,s){var i=t.channels.filter(function(t){return!t.status.hidden&&!t.status.length||-1===t.status.indexOf("hidden")}),n=i[0]&&i[0].content_id;return n||(n="default"),s("stream-header__categories-item",{mix:"stream-header__link",mods:{category:"channels"},attrs:{"data-id":n,"data-active":"channels-list"},urlParams:{streamId:n,streamActive:"channels-list"},stat:e.stat.getClientCounter("stream.header.category.tv_channel"),content:""})}),t("stream-header__categories-list",function(t,e,s){var i,n=t.categories||[],r=t.channels||[];return i=t.showStorefrontLink?s("stream-header__categories-storefront"):"",i+=s("stream-header__categories-channels",{channels:r,exp:t.settings.exp,settings:t.settings}),(i+=n.map(function(t){return s("stream-header__categories-item",{mix:"stream-header__link",mods:{category:t.category},attrs:{"data-active":"category","data-category":t.category},urlParams:{streamActive:"category",streamCategory:t.category},stat:e.stat.getClientCounter("stream.header.category."+t.category),content:e.l10n("stream.category."+t.category)})}).join("")).length?s("stream-header__bottom",{content:s("stream-header__categories",{content:i})}):""}),t("stream-header__categories-item",function(t,e,s){return s("home-link",{mods:{hover:"inherit"},href:s("stream-url",t.urlParams),attrs:t.attrs,content:s("stream-header__categories-item-inner",{content:t.content}),mix:home.getBEMClassname("stream-header__categories-item",{mods:t.mods})+" "+t.mix,stat:t.stat})}),t("stream-header__categories-storefront",function(t,e,s){return s("stream-header__categories-item",{mix:"stream-header__link",mods:{category:"storefront"},attrs:{"data-active":"storefront"},urlParams:{streamActive:"storefront"},stat:e.stat.getClientCounter("stream.header.category.storefront"),content:" "})}),t("stream-header__logo",function(t,e,s){return s("stream-header__logo-layout",{mainpageStat:e.stat.getClientCounter("stream.logo.close"),serviceStat:e.stat.getClientCounter("stream.logo.storefront")})}),t("stream-header__categories-item-inner",function(t,e,s){var i;return'<span class="stream-header__categories-title">'+(t.content!==i?t.content:"")+'</span><span class="stream-header__categories-title stream-header__categories-title_bold">'+(t.content!==i?t.content:"")+"</span>"}),t("stream-header__categories",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-header__categories.class")+'">'+(void 0!==t.content?t.content:"")+"</div>"}),t("stream-header__logo-layout",function(t,e,s){var i;return'<div class="'+home.parseRules.bem(t,e,"stream-header__logo.class")+'"><div class="stream-header__mainpage" tabindex="0" title="" '+(t.mainpageStat!==i?t.mainpageStat:"")+'></div><div class="stream-header__service stream-header__link" data-active="storefront" tabindex="0" title="" '+(t.serviceStat!==i?t.serviceStat:"")+"></div></div>"}),t("stream-header__bottom",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-header__bottom.class")+'"><div class="i-bem scroller" data-bem="{&quot;scroller&quot;:{}}">'+(void 0!==t.content?t.content:"")+"</div></div>"}),t("stream-header",function(t,e,s){var i=t.settings||{},n=i.exp&&!i.exp.stream_no_search_header,r="",a=[],o=t.headerCategories||[],c=t.channels||[],l="",h=i.videohub,m=t.mix||[],d="";return a.push({name:"storefront",counter:"stream.header.storefront"}),n&&(r+=s("stream-search",{settings:{suggest:i.suggest,streamSuggestServer:i.streamSuggestServer},suggestUrl:s("stream-header__suggest-video-url"),searchtUrl:s("stream-header__search-video-url")})),r+=a.reduce(function(t,i){return t+s("stream-header__item",{mix:["stream-header__link stream-header__"+i.name],attrs:{"data-active":i.name,tabindex:0},stat:e.stat.getClientCounter(i.counter),content:e.l10n("stream.header."+i.name)})},""),i.headerPromo&&!h&&(i.headerPromo.subtitle&&(d=s("stream-header__promo-subtitle",{subtitle:i.headerPromo.subtitle})),r+=s("stream-header__item",{mix:"stream-header__link stream-header__promo",attrs:{tabindex:0,"data-id":i.headerPromo.contentId,"data-active":"watching"},stat:e.stat.getClientCounter("stream.header.promo"),content:s("stream-header__promo",{title:i.headerPromo.title,subtitle:d,iconAttrs:{style:"background-image:url("+i.headerPromo.icon+")"}})})),i.videohub||(l=s("stream-header__top",{logo:s("stream-header__logo",{}),content:r})),(o.length||h)&&(l+=s("stream-header__categories-list",{showStorefrontLink:h,categories:o,channels:c,settings:i})),s("stream-header__html",{mods:{type:h?"videohub":"",full:a.length>2||n?"yes":""},mix:m,js:{"stream-header":{}},content:l})}),t("stream-header__promo-subtitle",function(t,e,s){return'<div class="stream-header__promo-subtitle">'+(void 0!==t.subtitle?t.subtitle:"")+"</div>"}),t("stream-header__promo",function(t,e,s){var i;return'<div class="stream-header__promo-info"><div class="stream-header__promo-title">'+(t.title!==i?t.title:"")+"</div>"+(t.subtitle!==i?t.subtitle:"")+'</div><div class="stream-header__promo-icon"'+home.parseRules.bem(t,e,"iconAttrs.attrs")+"></div>"}),t("stream-header__item",function(t,e,s){var i;return'<div class="'+home.parseRules.bem(t,e,"stream-header__item.class")+'"'+home.parseRules.bem(t,e,"attrs")+" "+(t.stat!==i?t.stat:"")+">"+(t.content!==i?t.content:"")+"</div>"}),t("stream-header__top",function(t,e,s){var i;return'<div class="'+home.parseRules.bem(t,e,"stream-header__top.class")+'">'+(t.logo!==i?t.logo:"")+(t.content!==i?t.content:"")+"</div>"}),t("stream-header__html",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-header.class")+' i-bem" data-bem="'+home.parseRules.bem(t,e,"js")+'">'+(void 0!==t.content?t.content:"")+"</div>"}),t("stream-search",function(t,e,s){var i=t.settings,n=i.suggest,r=!(e.BrowserDesc&&e.BrowserDesc.isTouch),a=i.streamSuggestServer?i.streamSuggestServer.params:{},o=i.streamSuggestServer?i.streamSuggestServer.url:t.suggestUrl;return a.text_limit=n.textLimit||0,a.limit=n.limit||8,s("stream-search__template",{action:t.searchtUrl,mix:[{block:"suggest2-form"},{block:"suggest2-form",elem:"node"},{block:"suggest2-counter",mods:{behavior:"stream"}}],js:{"suggest2-form":{},"suggest2-counter":{service:"videohub_ru",submitBySelect:!0,preventSubmit:!1,host:"//yandex."+e.MordaZone,path:"/clck/jclck/",params:{dtype:"stred",pid:0,cid:2873,parent_reqid:e.Requestid?e.Requestid:home.getData?home.getData("timing.reqid"):""},autoFocus:r},"stream-search":!0},content:[s("input",{mods:{theme:"normal",type:"stream-search","has-clear":"yes"},control:{attrs:{autofocus:r?home.emptyAttr:"",autocomplete:"off"}},placeholder:", ",name:"text",mix:{block:"suggest2-form",elem:"input"},search:s("button2",{attrs:{tabindex:"-1"},type:"submit",title:"",mix:[{block:"suggest2-form",elem:"button"},{block:"input",elem:"search"}],content:s("icon",{mods:{glyph:"type-search"}})})}),s("popup",{mods:{autoclosable:"yes",adaptive:"no",type:"stream-suggest",animate:"no",theme:"none"},js:{directions:"bottom-left"},jsMix:"&quot;suggest2&quot;:"+home.getBEMParams({url:o,videoUrl:t.searchtUrl,dataType:"json",data:a,viewMods:{rich:"yes","group-video-label":n.groupVideoLabel?"yes":""},requestOnEmptyInput:!0})+",&quot;suggest2-detect&quot;:{}",mix:[{block:"suggest2",mods:{type:"advanced",rich:"yes",theme:"large",size:"m",adaptive:"yes",colorize:"dark",behavior:"stream",group:n.groupVideoLabel?"type":""}},{block:"suggest2-detect"},{block:"stream",elem:"suggest"}],content:" "})].join("")})}),t("stream-search__template",function(t,e,s){var i;return'<form class="'+home.parseRules.bem(t,e,"stream-search.class")+' i-bem" action="'+(t.action!==i?t.action:"")+'" data-bem="'+home.parseRules.bem(t,e,"js")+'" target="_blank">'+(t.content!==i?t.content:"")+"</form>"}),t("icon",function(t,e,s){var i=t||{},n={},r=i.url!==undefined,a=Object(i.attrs).style!==undefined,o=(a?i.attrs.style:"")+(r?";background-image:url('"+i.url+"');":"");return i.mods=i.mods||{},i.mods["has-glyph"]="yes",a&&(i.attrs.style=o),o&&(n.style=o),s("icon__html",{mods:i.mods,attrs:n,mix:i.mix,content:s("icon_glyph_"+i.mods.glyph)})}),t("icon__html",function(t,e,s){return'<span class="'+home.parseRules.bem(t,e,"icon.class")+'" '+home.parseRules.bem(t,e,"attrs")+">"+(void 0!==t.content?t.content:"")+"</span>"}),t("icon_glyph_type-search",function(t,e,s){return'<svg class="icon__glyph" xmlns="http://www.w3.org/2000/svg" width="14" height="14"><path d="M13.417 12.583l-3-3.083v-.083c.75-1 1.25-2.25 1.25-3.584A5.797 5.797 0 0 0 5.833 0 5.797 5.797 0 0 0 0 5.833a5.797 5.797 0 0 0 5.833 5.834c1.25 0 2.417-.417 3.417-1.084l.083.084 3 3.083.25.25 1.152-1.138-.318-.279zm-11.75-6.75a4.126 4.126 0 0 1 4.166-4.166A4.126 4.126 0 0 1 10 5.833 4.126 4.126 0 0 1 5.833 10C3.5 10 1.667 8.083 1.667 5.833z"/></svg>'}),t("input",function(t,e,s){var i=t.mods||{},n=t.js||{};return i.theme||(i.theme="normal"),t.keyboard&&(i.keyboard="yes"),"gradient"===i.popup&&(n.popupMods={gradient:"yes"}),t.mods=i,'<span class="'+home.getBEMClassname("input",t)+' i-bem" data-bem="{&quot;input&quot;:'+home.getBEMParams(n)+'}">'+(t.before||"")+'<span class="input__box">'+(t.noclear?"":s("input__clear",t))+(t.forgot?'<span class="input__forgot input__forgot_visible_yes" unselectable="on">'+t.forgot+"</span>":"")+("yes"===i.keyboard?s("keyboard-loader",{mix:"input__keyboard-button"}):"")+("yes"===i["voice-search"]?s("input__voice-search",t):"")+s("input__control",t)+(t.search?t.search:"")+"</span>"+(t.after||"")+"</span>"}),t("input__clear",function(t,e,s){var i="&nbsp;",n=t.mods&&t.mods.type?s("input__clear_type_"+t.mods.type):"";return n&&(i=n),'<span class="input__clear" unselectable="on">'+i+"</span>"}),t("input__control",function(t){var e=t.control&&t.control.attrs||{},s=t.mods,i="textarea"===s.type,n=i?"textarea":"input",r=i?">"+(t.value||"")+"</textarea":"/",a=t.control&&t.control.mix&&" "+t.control.mix||"";switch(t.value&&!i&&(e.value=t.value),t.name&&(e.name=t.name),s.disabled&&(e.disabled="disabled"),t.placeholder&&(e.placeholder=t.placeholder),s.type){case"password":case"search":e.type=s.type}return"<"+n+' class="input__control input__input'+a+'"'+home.getAttributes(e)+r+">"}),t("input__clear_type_stream-search",function(t,e,s){return'<svg focusable="false" width="0" height="0" viewBox="0 0 16 16"><path d="M8 6.94l4.97-4.97 1.06 1.06L9.06 8l4.97 4.97-1.06 1.06L8 9.06l-4.97 4.97-1.06-1.06L6.94 8 1.97 3.03l1.06-1.06L8 6.94z"/></svg>'}),t("stream-time__relative",function(t,e){var s=Math.ceil(t.delta/60);return s>59?home.view("stream-time__string",{program:{start_time:t.time},mods:{"short-preposition":"yes",relative:"yes"}}).toLowerCase():" "+(1!==s?s+" ":"")+home.decline(s,["","",""])}),t("stream-time__string",function(t,e,s){var i,n,r,a,o,c=t.program,l=1e3*(c.start?c.start():c.start_time),h=1e3*(c.end?c.end():c.end_time),m=e.Timestamp?new Date(e.Timestamp):home.now(),d=m.getTime(),u=t.mods&&"yes"===t.mods.short,_=t.mods&&"yes"===t.mods.relative,p=t.mods&&"yes"===t.mods.time;if(d>l&&d<h)return"  ";function g(t,e){return t.getYear()===e.getYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()}return t.dateTemplate?o=t.dateTemplate:u?(l=1e3*(c.release_date_ut||c.start_time),o="%day% %time%",p||(o=o.replace(" %time%",""))):o=_?"%day%  %time%":"  %day% %time%",864e5,i=new Date(l),_&&g(m,i)?r="":_&&g(m,new Date(l+864e5))?r="":_&&g(m,new Date(l-864e5))?r="":(n=i.getMonth()+1,r=i.getDate()+" "+e.l10n("spok_yes.month_accus."+n)),a=o.replace("%day%",r).replace("%time%",s("stream-time__time",c)),home.capitalize(a)}),t("stream-time__weekday",function(t,e){return{0:"",1:"",2:"",3:"",4:"",5:"",6:""}[new Date(1e3*t.start_time).getDay()]}),t("stream-time__time",function(t){var e,s,i,n=t.start?t.start():t.start_time;return t.release_date_ut&&(n=t.release_date_ut),s=(e=new Date(1e3*n)).getHours(),i=e.getMinutes(),(s<10?"0"+s:s)+":"+(i<10?"0"+i:i)}),t("stream-url",function(t,e,s){(t=t||{}).streamDefault&&!t.streamChannel&&(t.streamChannel="default");var i,n,r=home.getData("stream.stream.clientData.settings",s("stream-settings")),a=r.streamPath,o=r.streamPaths,c=r.streamSharePath,l=r.homePageNoArgs,h=r.streamFrom,m=a;t.path&&"undefined"!=typeof o[t.path]&&(m=o[t.path]),t.isSharing&&(i=home.parseUrl(l).host,n="https",m=c),t.withHost&&(i=home.parseUrl(l).host,n="https");var d=t.from||h;return home.makeUrl({scheme:n,host:i,path:m,query:{stream_active:t.streamActive,stream_id:t.streamId,stream_channel:t.streamChannel,stream_category:t.streamCategory,from_block:t.fromBlock,from:d}})}),t("stream-watching__cameras",function(t,e,s){return t.cameras.map(function(i,n){var r,a={camera:i.id,aspect:"wide"},o=i.title||(n?" %d".replace("%d",n+1):" ");return t.active===i.id?(a.selected="yes",a.disabled="yes"):r=e.stat.getClientCounter("stream.camera."+i.id),s("stream-tile",{program:{title:o,thumbnail:i.thumbnail},attrs:{"data-replace":!0,"data-camera":i.id,"data-bem":home.getBEMParams({"stream-tile":{}}),"data-active":null},mix:"stream-watching__link",mods:a,stat:r})})}),t("stream-watching__channel",function(t,e,s){var i=(t.program||{}).channel||{};return s("stream-watching__channel-layout",{title:i.title,icon:s("channel-icon",{mods:{channel:i.channel_id},mix:"stream-watching__channel-icon"})})}),t("stream-watching__schedule",function(t,e,s){return s("stream-watching__schedule-layout",{title:" ",events:s("stream-events",{mods:{compact:"yes"},items:t.items,itemsMix:"stream-watching__link",canRestartCurrent:t.canRestartCurrent,playing:t.playing,enabled:t.enabled})})}),t("stream-watching__content",function(t,e,s){var i=t.data||{},n=t.settings||{},r=n.bookmakerExport,a=!i.initialProgram,o=i.initialProgram||{},c=n.stickersDisabled,l="stream-watching__layout";return n.channelBrandingEnabled&&(l="stream-watching__layout_new-branding_yes"),s(l,{title:s("stream-program-title",{mods:{player:"layout"},program:o})||"&nbsp;","tv-program":"",restriction:o.restriction_age||"",playerWrapperMix:"stream-watching__player-wrapper_bg_"+(c?"no":"yes"),titleMix:a?"stream-watching__player-header_loading_yes":"",time:o.start_time?s("stream-time__string",{program:o,mods:{time:"yes"}}):"&nbsp;",timeMix:a?"stream__live-time_loading_yes":"",overlay:{button:s("button2",{mods:{size:"n",theme:"stream"},mix:"stream-overlay__close",content:"",iconLeft:"stream-overlay__icon",stat:e.stat.getClientCounter("stream.overlay.close")})},player:s("stream-watching__player",{overlay:{stat:e.stat.getClientCounter("stream.mini_player"),statClose:e.stat.getClientCounter("stream.mini_player.pause")}}),stickersCounter:c?"":s("stream-stickers-counter",{}),stickers:c?"":s("stream-stickers",{statRoot:"stream.watching"}),sportStat:n.sportStatEnabled?s("stream-sport-stat"):"",anchor:{icon:s("stream-icon",{mix:"stream-watching__info-icon"}),stat:e.stat.getClientCounter("stream.info_anchor")},anchorAttrs:{role:"link",tabindex:"0"},share:n.shareDisabled?"":s("stream-share",{mix:"stream-watching__share",statRoot:"stream.watching"}),report:n.touch&&!n.disableReport?s("stream-watching__problem-report",{}):"",bet:s("stream-watching__bet",{bookmakerPromo:r})})}),t("stream-watching",function(t,e,s){var i={doc2doc:"yes"};return(t.settings||{}).channelBrandingEnabled&&(i["new-branding"]="yes"),s("stream-screen",{mods:{player:!0},mix:[{block:"stream-watching",mods:i},{block:"stream-overlay"}],js:{"stream-watching":{},"stream-overlay":{}},content:s("stream-watching__content",t)})}),t("stream-watching__channel-layout",function(t,e,s){var i;return(t.icon!==i?t.icon:"")+'<div class="stream-watching__channel-title">'+(t.title!==i?t.title:"")+"</div>"}),t("stream-watching__schedule-layout",function(t,e,s){var i;return'<div class="stream-watching__schedule-title">'+(t.title!==i?t.title:"")+"</div>"+(t.events!==i?t.events:"")}),t("stream-watching__cameras-layout",function(t,e,s){return'<div class="stream-watching__neighbour stream-watching__cameras-wrap"><div class="stream-watching__cameras"></div></div>'}),t("stream-watching__layout",function(t,e,s){var i,n;return'<div class="stream-watching__content"><div class="stream-watching__left stream-watching__neighbour"><div class="stream-watching__tv-program">'+(t["tv-program"]!==n?t["tv-program"]:"")+'</div><div class="stream-watching__schedule"></div></div><div class="stream-watching__center"><div class="stream-watching__main"><div class="stream-watching__top '+(t.topMix!==n?t.topMix:"")+'">'+((i=t.overlay)&&(i=i.button),i!==n?i:"")+'<div class="stream-watching__header stream-watching__neighbour"><div class="stream-watching__header-left"><div class="stream-watching__channel">'+(t.channel!==n?t.channel:"")+'</div><div class="stream-watching__switch-place"></div></div><div class="stream-watching__header-right"><div class="stream-watching__online"></div></div></div><div class="stream-watching__player-wrapper '+(t.playerWrapperMix!==n?t.playerWrapperMix:"")+'"><div class="stream-watching__player-bg">'+(t.player!==n?t.player:"")+"</div>"+(t.stickers!==n?t.stickers:"")+(t.bet!==n?t.bet:"")+((i=s("stream-watching__cameras-layout",t))!==n?i:"")+'</div><div class="stream-watching__nav-bg stream-watching__neighbour"><ul class="stream-watching__nav"></ul></div><div class="stream-watching__footer stream-watching__neighbour"><div class="stream-watching__bottom-container-chat"></div><div class="stream-watching__footer-top"><div class="stream-watching__footer-left"><h1 class="stream__tab-title"><span class="stream-watching__player-header '+(t.titleMix!==n?t.titleMix:"")+'">'+(t.title!==n?t.title:"")+'</span></h1><span class="stream-watching__live-time '+(t.timeMix!==n?t.timeMix:"")+'">'+(t.time!==n?t.time:"")+'</span></div><div class="stream-watching__footer-right">'+(t.stickersCounter!==n?t.stickersCounter:"")+(t.share!==n?t.share:"")+'</div></div><div class="stream-watching__footer-bottom"><div class="stream-watching__info-place"></div></div></div></div></div>'+(t.sportStat!==n?t.sportStat:"")+'<div class="stream-watching__neighbour"><div class="stream-watching__more"></div></div></div><div class="stream-watching__right stream-watching__neighbour"><div class="stream-watching__right-container-chat"></div><div class="stream-watching__container-doc2doc"></div></div></div>'}),t("stream-online-button",function(t,e,s){var i=t.content||"",n=t.attrs||{},r=t.parent||"",a=t.mix||"",o=t.mods||{};return o.theme||(o.theme="square"),s("button2",{mods:o,mix:"stream-online-button stream-"+r+"__link"+a,url:t.url,attrs:n,content:i,icon:"square"===o.theme?"stream-online-button__icon":"",stat:e.stat.getClientCounter(t.statRoot||"stream.switch")})}),t("stream-watching__info",function(t,e,s){var i=t.description||"";return i=i.replace(/[\r\n]+/g,"\n").split("\n").map(function(t){return home.htmlFilter(t)}).join(""),s("stream-watching__info-html",{title:t.title,content:s("stream-more-info",{content:i,statRoot:"stream.watching"})})}),t("stream-watching__info-html",function(t,e,s){var i;return'<div class="stream-watching__info"><h2 class="stream-watching__info-title stream-watching__sub-title">'+(t.title!==i?t.title:"")+'</h2><div class="stream-watching__description">'+(t.content!==i?t.content:"")+"</div></div>"}),t("stream-more-info",function(t,e,s){var i=t.content||"",n=t.statRoot||"stream";return s("stream-more-info-html",{js:{"stream-more-info":{}},stat:e.stat.getClientCounter(n+".more-program-info"),content:i})}),t("stream-more-info-clone",function(t,e,s){return'<div class="stream-more-info__clone" aria-hidden="true"></div>'}),t("stream-more-info-html",function(t,e,s){var i,n;return'<div class="'+home.parseRules.bem(t,e,"stream-more-info.class")+' i-bem" data-bem="'+home.parseRules.bem(t,e,"js")+'"><p class="stream-more-info__text" data-text="'+(t.content!==n?t.content:"")+'">'+(t.content!==n?t.content:"")+'</p><nobr>&nbsp;&nbsp;<button class="stream-more-info__button" '+(t.stat!==n?t.stat:e.stat!==n?e.stat:(i=s("stat",t))!==n?i:"")+"></button></nobr></div>"}),t("stream-watching__bet",function(t,e,s){var i=t.bookmakerPromo;if(!i)return"";var n=i.icon,r="#"+i.button_color,a="background-color: "+r+";"+(n?"background-image:url("+i.icon+")":""),o={theme:"bet",size:"s",type:"link"};return n&&(o.icon="yes"),s("stream-watching__bet-layout",{text:i.text,button:s("button2",{mods:o,target:"_blank",url:i.link,mix:"stream-watching__bet-button",content:i.button_text+s("stream-watching__bet-ad-layout",{}),attrs:{style:a},stat:e.stat.getClientCounter("stream.watching.bet")}),color:"color: "+r+";"})}),t("stream-watching__bet-ad-layout",function(t,e,s){return'<span class="stream-watching__bet-ad"></span>'}),t("stream-watching__bet-layout",function(t,e,s){var i;return'<div class="stream-watching__bet"><div class="stream-watching__bet-wrapper"><div class="stream-watching__bet-bg"></div><div class="stream-watching__bet-coll stream-watching__bet-coll_left"><span class="stream-watching__bet-text i-multiline-overflow">'+(t.text!==i?t.text:"")+'</span></div><div class="stream-watching__bet-coll stream-watching__bet-coll_right">'+(t.button!==i?t.button:"")+'<div class="stream-watching__bet-button-clone" style="'+(t.color!==i?t.color:"")+'"></div></div></div></div>'}),t("stream-announce__text",function(t,e,s){return t.time?"  "+s("stream-announce__time",{content:s("stream-time__relative",{time:t.time,delta:t.time-t.now})}):" "}),t("stream-announce",function(t,e,s){var i=t.mods||{};return s("stream-announce__layout",{mods:i,text:t.text||s("stream-announce__text",{time:t.time,now:t.now}),liveButton:t.contentId?s("button",{content:t.liveTitle||" ",mods:{size:i["button-size"],theme:"white-transparent"},attrs:{"data-id":t.contentId},stat:e.stat.getAttr("stream.announce.live"),mix:"stream-announce__live-button stream-watching__link"}):"",attrs:{style:s("stream-thumbnail",t)}})}),t("stream-announce__time",function(t,e,s){return'<span class="'+home.parseRules.bem(t,e,"stream-announce__time.class")+'">'+(void 0!==t.content?t.content:"")+"</span>"}),t("stream-announce__layout",function(t,e,s){var i;return'<div class="'+home.parseRules.bem(t,e,"stream-announce.class")+'" '+home.parseRules.bem(t,e,"attrs")+'><div class="stream-announce__content"><div class="stream-announce__text stream-watching__announce-text">'+(t.text!==i?t.text:"")+'</div><div class="stream-announce__live">'+(t.liveButton!==i?t.liveButton:"")+"</div></div></div>"}),t("button",function(t){var e=t.mods||{},s="button",i=t.attrs||{};return t.url?s="a":t.tag&&(s=t.tag),e.theme||("yes"===e.pseudo?e.theme="pseudo":e.theme="normal"),i.role="button",t.tabindex&&(i.tabindex=t.tabindex),t.url?(i.href=t.url,t.target&&(i.target=t.target),e.disabled&&(i["aria-disabled"]=!0),"_blank"===i.target&&"undefined"==typeof i.rel&&(i.rel="noopener")):(i.type=t.type||"button",t.name&&(i.name=t.name),t.value&&(i.value=t.value),e.disabled&&(i.disabled="disabled")),"<"+s+' class="'+home.getBEMClassname("button",{mods:e,mix:t.mix})+' i-bem" data-bem="{&quot;button&quot;:{}}"'+home.getAttributes(i)+(t.stat||"")+'><span class="button__text">'+(t.content||"")+"</span></"+s+">"}),t("stream-overlay__html",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-overlay.class")+' i-bem" data-bem="'+home.parseRules.bem(t,e,"js")+'">'+(void 0!==t.button?t.button:"")+'<div class="stream-overlay__center"><div class="stream-overlay__player-container"><div class="stream-overlay__player" id="stream-overlay__player"></div></div></div></div>'}),t("stream-overlay",function(t,e,s){return s("stream-overlay__html",{js:{"stream-overlay":{}},button:s("button2",{mods:{size:"n",theme:"stream"},mix:"stream-overlay__close",content:"",iconLeft:"stream-overlay__icon",stat:e.stat.getClientCounter("stream.overlay.close")})})}),t("stream-watching__plug",function(t,e,s){var i=t.program;return s("stream-watching__plug-html",{attrs:{style:s("stream-thumbnail",{thumbnail:i.thumbnail}),"data-active":"overlay","data-id":i.content_id},mix:t.mix||""})}),t("stream-watching__plug-html",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-watching__plug.class")+'" '+home.parseRules.bem(t,e,"attrs")+' tabindex="0" role="button"><div class="stream-watching__plug-icon"></div></div>'}),t("stream-watching__project-schedule_empty",function(t,e,s){return'<div class="stream-watching__project-schedule_empty"> </div>'}),t("stream-watching__forbidden",function(t,e,s){var i="";return t&&t.channel&&(i=s("button2",{mods:{size:"n",theme:"stream"},mix:"stream-watching__forbidden-button stream-watching__link",stat:e.stat.getClientCounter("stream.online"),content:" ",attrs:{"data-id":t.channel.content_id,"data-live":!0}})),s("stream-watching__forbidden-html",{button:i})}),t("stream-watching__forbidden-html",function(t,e,s){return'<div class="stream-watching__forbidden">   '+(void 0!==t.button?t.button:"")+"</div>"}),t("stream-watching__problem-report",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-watching__problem-report.class")+'" data-statlog="stream.watching.problem_report" role="link" tabindex="0" title="  "><div class="stream-watching__problem-report-icon"></div><div class="stream-watching__problem-report-text">  </div></div>'}),t("stream-more",function(t,e,s){var i="",n=t.mix||"";return t.content?(t.title&&(i=s("stream-more__title",{title:t.title})),s("stream-more__html",{mods:t.mods,mix:n+" stream_channel-icon-color_white",title:i,content:t.content})):""}),t("stream-more__title",function(t,e,s){return'<h2 class="stream-more__title">'+(void 0!==t.title?t.title:"")+"</h2>"}),t("stream-more__html",function(t,e,s){var i;return'<div class="'+home.parseRules.bem(t,e,"stream-more.class")+'">'+(t.title!==i?t.title:"")+(t.content!==i?t.content:"")+"</div>"}),t("stream-hot__badge",function(t){if(t.program.is(t.now))return'<span class="stream-hot__badge"> </span>'}),t("stream-hot",function(t,e,s){var i=t.programs,n="stream.hot."+t.key;if(i&&i.length&&(i=i.map(function(t){return $.extend({},t,{thumbnail:t.thumbnail||"https://yastatic.net/s3/home/olymp2018/sport_thumb/default/0.jpg"})})),t.mods=t.mods||{},!i){t.mods.fake="yes",i=[];for(var r=0;r<8;r++)i.push(s("stream-tile",{mods:{fake:"yes"}}));return s("stream-slider",{mods:t.mods,statRoot:n,programs:i})}return i.length?s("stream-slider",{mods:t.mods,mix:"stream-hot__slider",statRoot:n,programs:i.map(function(i){return s("stream-tile",{program:i,stat:e.stat.getClientCounter(n+".item"),icon:s("stream-hot__badge",{program:i,now:t.now}),mods:{overlay:"yes"},mix:"stream-watching__link"})})}):""}),t("stream-slider",function(t,e,s){return t.programs&&t.programs.length?(t.programs=t.programs.map(function(t){return s("stream-slider__item",{content:t})}).join(""),s("stream-slider__layout",t)):""}),t("stream-slider__item",function(t,e,s){return'<li class="'+home.parseRules.bem(t,e,"stream-slider__item.class")+'">'+(void 0!==t.content?t.content:"")+"</li>"}),t("stream-slider",function e(t,s,i){return t.prevStat=s.stat.getClientCounter(t.statRoot+".scroll.back"),t.nextStat=s.stat.getClientCounter(t.statRoot+".scroll.forward"),t.js={"arrowed-list":{offsetLeft:26,offsetRight:26,blockid:"stream",valuableScroll:100}},t.list={mods:{arrow:"rounded",aligned:"yes",color:"white"},mix:"i-bem"},i(e.base,t)}),t("stream-slider__layout",function(t,e,s){var i;return'<div class="'+home.parseRules.bem(t,e,"stream-slider.class")+'"><div class="'+home.parseRules.bem(t,e,"list.arrowed-list.class")+'" data-bem="'+home.parseRules.bem(t,e,"js")+'"><div class="arrowed-list__control arrowed-list__left" '+(t.prevStat!==i?t.prevStat:"")+'></div><div class="arrowed-list__container"><ul class="arrowed-list__content scroller i-bem" data-bem="{&quot;scroller&quot;:{}}">'+(t.programs!==i?t.programs:"")+'</ul></div><div class="arrowed-list__control arrowed-list__right" '+(t.nextStat!==i?t.nextStat:"")+"></div></div></div>"}),t("stream-tile__superres",function(t,e,s){return t.meta&&t.meta.superres?s("stream-superres",{mix:"stream-tile__superres"}):""}),t("stream-tile__thumb-meta",function(t,e,s){var i,n=t.start?t.start():t.start_time,r=t.end?t.end():t.end_time,a=home.now().getTime()/1e3,o=t.duration;return t.release_date_ut&&(n=t.release_date_ut),n&&r&&!o&&(o=r-n),a>n&&a<r&&(i=!0),s("stream-meta-badge",{duration:o,live:i,dHD:t.meta&&t.meta.superres,mix:{block:"stream-tile",elem:"thumb-meta"}})}),t("stream-tile__meta",function(t,e,s){var i=t.start?t.start():t.start_time,n=t.end?t.end():t.end_time,r=t.release_date_ut,a=t.genres,o=home.now().getTime()/1e3,c=t.release_year,l=o>i&&o<n,h=[];return"vod-episode"!==t.content_type_name||t.parent_vod_lib_id||(a&&h.push(s("stream-tile__meta-ganres",{content:a.join(", ")})),c&&h.push(c)),"episode"!==t.content_type_name||!r&&!i||l||h.push(s("stream-time__string",{mods:{short:"yes"},program:{start_time:r||i}})),h.length?s("stream-tile__meta-html",{content:h.join("<br>")}):""}),t("stream-tile",function(t,e,s){var i=t.mods||{},n={},r=t.program||{},a=t.attrs||{},o={};return"undefined"!=typeof BEM&&BEM.blocks?n=BEM.blocks.stream.getExp():home&&home.exp&&(n.stream_video_preview=home.exp.check("stream_video_preview",e)),i.fake?(i.disabled="yes",s("stream-tile__fake",t)):(n.stream_video_preview&&r.ya_video_preview&&(t.mix+=" thumb-preview thumb-preview_video",o["thumb-preview"]={preview:{url:r.ya_video_preview}}),r.title&&(a.title=r.title),i.disabled?a.disabled=!0:a.tabindex="0",r.content_id&&(a["data-id"]=r.content_id),t.origin&&(a["data-origin"]=t.origin),null!==a["data-active"]&&(a["data-active"]=a["data-active"]||"watching"),s("stream-tile__html",{mods:i,stat:t.stat,js:o,icon:t.icon,title:s("stream-program-title",{program:r,subTitleMix:[{block:"i-multiline-overflow"}],parent:"stream-tile"}),meta:t.doc2doc?s("stream-tile__meta",r):"",mix:t.mix,thumb:{style:s("stream-thumbnail",r)},attrs:a,metaBadge:t.doc2doc?s("stream-tile__thumb-meta",r):"",superres:t.doc2doc?"":s("stream-tile__superres",r)}))}),t("stream-tile__meta-ganres",function(t,e,s){return'<span class="'+home.parseRules.bem(t,e,"stream-tile__meta-ganres.class")+'">'+(void 0!==t.content?t.content:"")+"</span>"}),t("stream-tile__meta-html",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-tile__meta.class")+'">'+(void 0!==t.content?t.content:"")+"</div>"}),t("stream-tile__fake",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-tile.class")+'" disabled><div class="stream-tile__thumb"></div><div class="stream-tile__content"></div></div>'}),t("stream-tile__html",function(t,e,s){var i;return'<div class="'+home.parseRules.bem(t,e,"stream-tile.class")+' i-bem" data-bem="'+home.parseRules.bem(t,e,"js")+'" '+home.parseRules.bem(t,e,"attrs")+(t.stat!==i?t.stat:"")+' role="button"><div class="stream-tile__thumb thumb-preview__target"'+home.parseRules.bem(t,e,"thumb.attrs")+">"+(t.icon!==i?t.icon:"")+(t.superres!==i?t.superres:"")+(t.metaBadge!==i?t.metaBadge:"")+'</div><div class="stream-tile__content">'+(t.title!==i?t.title:"")+(t.meta!==i?t.meta:"")+"</div></div>"}),t("stream-program-title",function(t,e,s){var i=t&&t.program||{},n=i.program_title,r=i.title,a=t&&t.parent?t.parent+"-title":"",o=[t&&t.parent?t.parent+"-subtitle":""],c=t&&t.superres&&s("stream-program-title__superres",t),l="",h="",m=t.mods&&"layout"===t.mods.player;return t.subTitleMix&&(o=o.concat(t.subTitleMix)),n&&n!==r&&(r&&(n=n.replace(/([!?:.])?(\s*)$/,function(t,e,s){return(e||".")+(s||" ")})),l=s("stream-program-title__layout",{title:n,mix:a,movie:t.movie||"",blacked:t.blacked||""})),r&&(h=l&&r!==n?s("stream-program-title__subtitle",{subTitle:r,mix:o}):s("stream-program-title__layout",{title:r,mix:a,movie:t.movie||"",blacked:t.blacked||""})),m?s("stream-program-title_player_layout",{title:l,subTitle:h})+(c||""):l+h+(c||"")}),t("stream-program-title__superres",function(t,e,s){return"<nobr>&nbsp;"+(void 0!==t.superres?t.superres:"")+"</nobr>"}),t("stream-program-title__subtitle",function(t,e,s){var i;return'<span class="'+home.parseRules.bem(t,e,"stream-program-title__subtitle.class")+'">'+(t.subTitle!==i?t.subTitle:"")+"</span>"+(t.superres!==i?t.superres:"")}),t("stream-program-title__layout",function(t,e,s){var i,n;return'<span class="'+home.parseRules.bem(t,e,"stream-program-title.class")+'">'+(t.title!==n?t.title:"")+"</span>"+(t.superres!==n?t.superres:"")+(t.movie!==n?t.movie:e.movie!==n?e.movie:(i=s("movie",t))!==n?i:"")+(t.blacked!==n?t.blacked:e.blacked!==n?e.blacked:(i=s("blacked",t))!==n?i:"")}),t("stream-program-title_player_layout",function(t,e,s){var i;return'<span class="stream-program-title_player_layout">'+(t.title!==i?t.title:"")+(t.subTitle!==i?t.subTitle:"")+"</span>"}),t("stream-meta-badge",function(t,e,s){var i=[];return t.live?i.push(s("stream-meta-badge__item",{content:" ",mods:{live:"yes"}})):t.duration&&i.push(s("stream-meta-badge__item",{content:home.formatDuration(t.duration)})),t.dHD?i.push(s("stream-meta-badge__item",{mods:{icon:"dhd"}})):t.fullHD&&i.push(s("stream-meta-badge__item",{content:"FullHD"})),i.length?s("stream-meta-badge__html",{mix:t.mix,content:i.join(" ")}):""}),t("stream-meta-badge__item",function(t,e,s){return'<span class="'+home.parseRules.bem(t,e,"stream-meta-badge__item.class")+'">'+(void 0!==t.content?t.content:"")+"</span>"}),t("stream-meta-badge__html",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-meta-badge.class")+'">'+(void 0!==t.content?t.content:"")+"</div>"}),t("stream-superres",function(t,e,s){var i=t.mods||{},n=t.attrs||{};if(!(e.stream&&e.stream.superres_no_logo))return t.url?(n["data-statlog"]="stream.superres.link",i.link="yes",s("home-link",{href:t.url,target:"_blank",mix:home.getBEMClassname("stream-superres",{mods:i})+" i-bem "+t.mix,attrs:n})):s("stream-superres__icon",t)}),t("stream-superres__icon",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-superres.class")+'"></div>'}),t("home-link",function(t,e,s){var i="a",n=t.attrs||{},r=t.mods||{},a=t.inlineIcon||"";return t.href?n.href=t.href:i="span",t.title&&(n.title=t.title),t.target&&(n.target=t.target),"_blank"===n.target&&"undefined"==typeof n.rel&&(n.rel="noopener"),s("home-link__tmpl",{attrs:n,tag:i,mix:t.mix,mods:r,content:t.content,stat:t.stat,icon:a})}),t("home-link__tmpl",function(t,e,s){var i;return"<"+(t.tag!==i?t.tag:"")+' class="'+home.parseRules.bem(t,e,"home-link.class")+'"'+home.parseRules.bem(t,e,"attrs")+(t.stat!==i?t.stat:"")+">"+(t.icon!==i?t.icon:"")+(t.content!==i?t.content:"")+"</"+(t.tag!==i?t.tag:"")+">"}),t("stream-superres__popup",function(t,e,s){return s("popup",{js:{directions:[{to:"bottom",axis:"center",tail:{axis:"middle"}},{to:"bottom",axis:"left",tail:{axis:"middle"}},{to:"bottom",axis:"right",tail:{axis:"middle"}}],tail:{width:10,height:10},duration:150},mods:{theme:"stream",superres:"yes",animate:"yes","animate-opacity":"yes"},tail:!0,content:",    ."+(t.url?"&nbsp"+s("home-link",{href:t.url,target:"_blank",stat:e.stat.getClientCounter("stream.superres.link"),content:"",mix:"stream-superres__popup-url"}):""),attrs:{role:"complementary"}})}),t("stream-superres",function s(t,e,i){var n=t.mods||{};return t.attrs||(t.attrs={}),t.url&&(t.attrs["data-statlog"]="stream.superres.link",n.popup&&(t.attrs["data-bem"]=home.getBEMParams({"stream-superres":{url:t.url}}))),i(s.base,t)}),t("popup",function(t){var e=t.mods||{},s=t.attrs||{};return e.theme=e.theme||"ffffff",e.autoclosable===undefined&&(e.autoclosable="yes"),e.adaptive===undefined&&(e.adaptive="yes"),e.animate===undefined&&(e.animate="yes"),t.zIndex&&(s.style=s.style||"",s.style+="z-index:"+t.zIndex),'<div class="i-bem '+home.getBEMClassname("popup",{mods:e,mix:t.mix})+'" data-bem="{&quot;popup&quot;:'+home.getBEMParams(t.js?t.js:[])+(t.jsMix?","+t.jsMix:"")+'}"'+home.getAttributes(s)+'><div class="'+home.getBEMClassname("popup__under",{mods:t.underMods,mix:t.underMix})+'"></div>'+(t.tail?'<i class="popup__tail"></i>':"")+(t.content?'<div class="'+home.getBEMClassname("popup__content",{mods:t.contentMods,mix:t.contentMix})+'"'+home.getAttributes(t.contentAttrs||{})+">"+t.content+"</div>":"")+("yes"===e["has-close"]?'<i class="popup__close"'+(t.statClose||"")+">"+(t.closeText?'<div class="popup__close-text">'+t.closeText+"</div>":"")+"</i>":"")+"</div>"}),t("stream-icon",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-icon.class")+'"><div class="stream-icon__img"></div></div>'}),t("stream-grid",function(t,e,s){var i,n=t.mods||{},r=t.maxCount||8,a=t.programs;if(!a){n.fake="yes",a=[];for(var o=0;o<r;o++)a.push({mods:{theme:t.doc2doc?"doc2doc":"",fake:"yes",overlay:t.doc2doc?"":"yes"},mix:"stream-grid__tile"});return s("stream-grid__html",{title:t.title,mods:n,programs:a.map(function(t){return s("stream-grid__item",{content:s("stream-tile",t)})}).join("")})}return a.length?(n.expand?a.length>r&&(i=s("button2",{mods:{size:"n",theme:"stream"},mix:"stream-grid__button expandable__button stream__line",content:" ",stat:e.stat.getClientCounter(t.statRoot+".expand")})):a=a.slice(0,r),s("stream-grid__html",{title:t.title,mods:n,mix:i?"expandable i-bem":"",js:{expandable:{}},programs:a.map(function(n,a){var o=n.channel&&n.channel.channel_id,c={stat:e.stat.getClientCounter(t.statRoot+".item"+(i&&a>=r?".expanded":"")),program:n,attrs:n.attrs,icon:o||!t.doc2doc?s("channel-icon",{mods:{channel:o}}):"",doc2doc:t.doc2doc,mods:{overlay:t.doc2doc?"":"yes",theme:t.doc2doc?"doc2doc":""},origin:t.origin,mix:"stream-grid__tile"+(t.parent?" "+t.parent+"__link":"")};return s("stream-grid__item",{content:s("stream-tile",c)})}).join(""),button:i})):""}),t("stream-grid__item",function(t,e,s){return'<li class="'+home.parseRules.bem(t,e,"stream-grid__item.class")+'">'+(void 0!==t.content?t.content:"")+"</li>"}),t("stream-grid__html",function(t,e,s){var i;return'<div class="'+home.parseRules.bem(t,e,"stream-grid.class")+'" data-bem="'+home.parseRules.bem(t,e,"js")+'"><ul class="stream-grid__box">'+(t.programs!==i?t.programs:"")+"</ul>"+(t.button!==i?t.button:"")+"</div>"}),t("stream-channel",function(t,e,s){var i=t.mods||{},n=s("channel-icon",{mods:{channel:t.channel_id,size:i.big?"xl":""},attrs:{style:t.color?"background-color:"+t.color:""},mix:"stream-channel__icon"+(i.big?" stream-channel__icon_big_yes":"")}),r=t.attrs||{};return r["aria-label"]=t.title,t.statRoot||(t.statRoot="stream.channel"),i.id=t.channel_id,i.small||(n+=s("stream-channel__info",{title:t.title,mods:{big:i.big?i.big:undefined},superres:i.superres?s("stream-superres",{mix:"stream-channel__superres",mods:{dhd:"outline",big:i.big?i.big:undefined}}):""})),s("stream-channel__html",{mods:i,mix:t.mix,link:s("home-link",{href:s("stream-url",{streamChannel:t.channel_id}),mods:{color:"inherit",hover:"inherit"},content:n,superres:i.superres&&i.small?s("stream-superres",{mix:"stream-channel__superres"}):"",mix:"stream-channel stream-channel__link"}),attrs:r,stat:e.stat.getClientCounter(t.statRoot+"."+t.channel_id)})}),t("stream-channel__info",function(t,e,s){var i;return'<div class="'+home.parseRules.bem(t,e,"stream-channel__info.class")+'"><div class="stream-channel__info-wrap"><span class="stream-channel__title">'+(t.title!==i?t.title:"")+'<nobr class="stream-channel__superres-wrap">&nbsp;&nbsp;&nbsp;&nbsp;'+(t.superres!==i?t.superres:"")+"</nobr></span></div></div>"}),t("stream-channel__html-inner",function(t,e,s){var i;return(t.content!==i?t.content:"")+(t.superres!==i?t.superres:"")}),t("stream-channel__html",function(t,e,s){var i;return'<li class="'+home.parseRules.bem(t,e,"stream-channel.class")+'"'+(t.stat!==i?t.stat:"")+home.parseRules.bem(t,e,"attrs")+'tabindex="0" role="button">'+(t.link!==i?t.link:"")+"</li>"}),t("stream-list",function(t,e,s){var i,n,r=t.mods||{},a=t.listCount||6,o=t.programs;if(!o){r.fake="yes",o=[];for(var c=0;c<a;c++)o.push({mods:{fake:"yes"}});return s("stream-list__html",{title:t.title,mods:r,programs:o.map(function(t){return s("stream-list__item",{content:s("stream-program",t)})}).join("")})}return o.length?(r.expand&&o.length>a&&(i=(Math.random()+"").substr(3,4),n=s("button2",{mods:{size:"n",theme:"stream"},mix:"stream-list__button expandable__button stream__line",content:" ",stat:e.stat.getClientCounter(t.statRoot+".expand")})),s("stream-list__html",{title:t.title,mods:r,mix:i?"expandable i-bem":"",js:{expandable:{}},programs:o.map(function(n,o){var c=i&&o>=a;return s("stream-list__item",{mods:{expanable:c?"yes":""},content:s("stream-program",{stat:e.stat.getClientCounter(t.statRoot+".item"+(c?".expanded":"")),origin:t.origin,program:n,mods:{thumbnail:r.thumbnail,notRelativeTime:!0},mix:t.parent?t.parent+"__link":""})})}).join(""),button:n})):""}),t("stream-list__item",function(t,e,s){return'<li class="'+home.parseRules.bem(t,e,"stream-list__item.class")+'">'+(void 0!==t.content?t.content:"")+"</li>"}),t("stream-list__html",function(t,e,s){var i;return'<div class="'+home.parseRules.bem(t,e,"stream-list.class")+'" data-bem="'+home.parseRules.bem(t,e,"js")+'"><ul class="stream-list__box">'+(t.programs!==i?t.programs:"")+"</ul>"+(t.button!==i?t.button:"")+"</div>"}),t("stream-program",function(t,e,s){var i,n=t.mods||{},r=t.program||{},a={},o={},c="";return"undefined"!=typeof BEM&&BEM.blocks?a=BEM.blocks.stream.getExp():home&&home.exp&&(a.stream_video_preview=home.exp.check("stream_video_preview",e)),n.fake?(n.disabled="yes",s("stream-program__fake",t)):(a.stream_video_preview&&r.ya_video_preview&&(t.mix+=" thumb-preview thumb-preview_video",o["thumb-preview"]={preview:{url:r.ya_video_preview}}),"yes"===n.thumbnail&&(i=s("stream-program__thumb",r)),(r.release_date_ut||r.start_time)&&(c=s("stream-time__string",{mods:{short:"yes",relative:!!n["relative-time"]&&"yes"},program:r})),s("stream-program__html",{mods:n,mix:t.mix,js:o,stat:t.stat,thumbnail:i,title:s("stream-program-title",{program:r,parent:"stream-tile"}),time:c,attrs:{title:r.title,"data-id":r.content_id||"","data-origin":t.origin||""}}))}),t("stream-program__fake",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-program.class")+'" disabled></div>'}),t("stream-program__thumb",function(t,e,s){var i;return'<div class="stream-program__thumb"><div class="stream-program__img thumb-preview__target" style="'+(void 0!==(i=s("stream-thumbnail",t))?i:"")+'"></div></div>'}),t("stream-program__html",function(t,e,s){var i;return'<div class="'+home.parseRules.bem(t,e,"stream-program.class")+'" data-bem="'+home.parseRules.bem(t,e,"js")+'" '+home.parseRules.bem(t,e,"attrs")+(t.stat!==i?t.stat:"")+' tabindex="0" role="button">'+(t.thumbnail!==i?t.thumbnail:"")+'<div class="stream-program__info"><div class="stream-program__title">'+(t.title!==i?t.title:"")+'</div><div class="stream-program__time">'+(t.time!==i?t.time:"")+"</div></div></div>"}),t("stream-tabs",function(t,e,s){return s("stream-tabs__html",{content:t.tabs.map(function(i){return s("stream-tabs__item",{content:i.content,mix:"stream-watching__tab "+t.mix,mods:{selected:i.selected?"yes":""},stat:e.stat.getAttr("stream.tabs."+t.index+"."+i.key),attrs:{tabindex:i.selected?"":"0","data-tabs-index":t.index,"data-key":i.key}})}).join("")})}),t("stream-tabs__item",function(t,e,s){var i;return'<span class="'+home.parseRules.bem(t,e,"stream-tabs__item.class")+'" '+home.parseRules.bem(t,e,"attrs")+(t.stat!==i?t.stat:"")+">"+(t.content!==i?t.content:"")+"</span>"}),t("stream-tabs__html",function(t,e,s){return'<span class="stream-tabs">'+(void 0!==t.content?t.content:"")+"</span>"}),t("stream-chat__error",function(t,e,s){return s("stream-chat__error-layout",{"reload-stat":e.stat.getClientCounter("stream.watching.chat.reload")})}),t("stream-chat__login",function(t,e,s){if(t.href&&t.content)return s("home-link",{href:t.href,content:t.content,mix:"stream-chat__login",stat:e.stat.getClientCounter("stream.watching.chat.login")})}),t("stream-chat",function(t,e,s){return s("stream-chat__layout",{js:{"stream-chat":{chatId:t.chatId,contentId:t.contentId,startTimeText:t.startTimeText,isOnline:t.isOnline,theme:t.theme}},"button-stat":e.stat.getClientCounter("stream.watching.chat.close")})}),t("stream-chat__error-layout",function(t,e,s){return'<div class="stream-chat__error"><h3 class="stream-chat__error-text">   </h3><div class="stream-chat__reload" role="button" tabindex="0" '+(void 0!==t["reload-stat"]?t["reload-stat"]:"")+">  </div></div>"}),t("stream-chat__loader-layout",function(t,e,s){var i;return'<div class="stream-chat__loader">'+(void 0!==(i=s("stream__loader",t))?i:"")+"</div>"}),t("stream-chat__layout",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-chat.class")+' stream-chat_collapsed_no i-bem" data-bem="'+home.parseRules.bem(t,e,"js")+'" '+home.parseRules.bem(t,e,"attrs")+'><div class="stream-chat__header" '+(void 0!==t["button-stat"]?t["button-stat"]:"")+' role="button" tabindex="0"><div class="stream-chat__title-container"><h3 class="stream-chat__title"> </h3><p class="stream-chat__active-user"></p></div><div class="stream-chat__button-container"><div class="stream-chat__button stream-chat__button_close_yes"></div></div></div><div class="stream-chat__container-overlay"><div class="stream-chat__status"></div><div class="stream-chat__container"></div><div class="stream-chat__login-container"></div></div></div>'}),t("stream-watching__co-branding-channel",function(t,e,s){return s("stream-watching__co-branding-channel-layout_new-branding_yes",{title:t.title||"",href:t.href||"",stat:e.stat.getClientCounter("stream.co-branding")})}),t("stream-watching__branding-channel",function(t,e,s){return s("stream-watching__branding-channel-layout_new-branding_yes",{brandingChannel:t||""})}),t("stream-watching__co-branding-channel-layout_new-branding_yes",function(t,e,s){var i;return'<a class="stream-watching__co-branding-channel stream-watching__neighbour" '+(t.stat!==i?t.stat:"")+' href="'+(t.href!==i?t.href:"")+'" target="_blank">'+(t.title!==i?t.title:"")+"</a>"}),t("stream-watching__branding-channel-layout_new-branding_yes",function(t,e,s){return void 0!==t.brandingChannel?t.brandingChannel:""}),t("stream-watching__channel-layout_new-branding_yes",function(t,e,s){var i;return(t.icon!==i?t.icon:"")+'<div class="stream-watching__channel-title">'+(t.title!==i?t.title:"")+"</div>"}),t("stream-watching__layout_new-branding_yes",function(t,e,s){var i,n;return'<div class="stream-watching__content"><div class="stream-watching__left stream-watching__neighbour"><div class="stream-watching__tv-program">'+(t["tv-program"]!==n?t["tv-program"]:"")+'</div><div class="stream-watching__schedule"></div></div><div class="stream-watching__media"><div class="stream-watching__branding-channel stream-watching__neighbour"><div class="stream-watching__branding-img-gradient"></div><div class="stream-watching__branding-img"></div></div><div class="stream-watching__center"><div class="stream-watching__main"><div class="stream-watching__top '+(t.topMix!==n?t.topMix:"")+'">'+((i=t.overlay)&&(i=i.button),i!==n?i:"")+'<div class="stream-watching__header"><div class="stream-watching__header-left"><div class="stream-watching__channel">'+(t.channel!==n?t.channel:"")+'</div><div class="stream-watching__switch-place"></div></div><div class="stream-watching__header-right"><div class="stream-watching__online"></div></div></div><div class="stream-watching__player-wrapper '+(t.playerWrapperMix!==n?t.playerWrapperMix:"")+'"><div class="stream-watching__player-bg">'+(t.player!==n?t.player:"")+"</div>"+(t.stickers!==n?t.stickers:"")+(t.bet!==n?t.bet:"")+((i=s("stream-watching__cameras-layout",t))!==n?i:"")+'</div><div class="stream-watching__nav-bg"><ul class="stream-watching__nav"></ul></div><div class="stream-watching__footer"><div class="stream-watching__bottom-container-chat"></div><div class="stream-watching__footer-top"><div class="stream-watching__footer-left"><h1 class="stream__tab-title"><span class="stream-watching__player-header '+(t.titleMix!==n?t.titleMix:"")+'">'+(t.title!==n?t.title:"")+'</span></h1><span class="stream-watching__live-time '+(t.timeMix!==n?t.timeMix:"")+'">'+(t.time!==n?t.time:"")+'</span></div><div class="stream-watching__footer-right">'+(t.stickersCounter!==n?t.stickersCounter:"")+(t.share!==n?t.share:"")+'</div></div><div class="stream-watching__footer-bottom"><div class="stream-watching__info-place"></div></div></div></div></div>'+(t.sportStat!==n?t.sportStat:"")+'<div class="stream-watching__more"></div></div><div class="stream-watching__right stream-watching__neighbour"><div class="stream-watching__right-container-chat"></div><div class="stream-watching__container-doc2doc"></div></div></div></div>'}),t("stream-watching__restriction",function(t,e,s){return t.restriction_age||0===t.restriction_age?s("stream-watching__restriction-html",{content:t.restriction_age+"+"}):""}),t("stream-watching__restriction-html",function(t,e,s){var i,n;return'<span class="stream-watching__restriction">'+(t.content!==n?t.content:e.content!==n?e.content:(i=s("content",t))!==n?i:"")+"</span>"}),t("stream-watching__nav-item",function(t,e,s){var i,n,r=t.program||{},a=t.mods||{};return a.empty?s("stream-watching__nav-item-layout",{title:"&nbsp;",mods:{empty:"yes"}}):(i=r.canRestart(t.now),n="stream.watching.video_nav."+(a.prev?"back":"forward"),s("stream-watching__nav-item-layout",{title:!r.isSerial&&r.program_title||r.title,navTime:r.start_time?s("stream-watching__nav-item-time",{time:s("stream-time__time",r)}):"",navIcon:s("stream-watching__nav-icon_arrow"),mods:{prev:a.prev,next:a.next,active:i?"yes":"",long:r.start_time?"":"yes"},mix:"stream-watching__link",stat:i?e.stat.getClientCounter(n):"",attrs:{"data-program-type":a.prev?"prev":"next","data-origin":"nav","data-id":r.content_id,role:"button",tabindex:i?"0":"",disabled:i?"":"disabled"}}))}),t("stream-watching__nav",function(t,e,s){var i=t.prev,n=t.next,r="";return i||n||t.restart?(r+=s("stream-watching__nav-item",i?{program:i,now:t.now,mods:{prev:"yes"}}:{mods:{empty:"yes"}}),t.restart&&(r+=s("stream-watching__nav-item-layout",{a11y:'tabindex="0" role="button"',title:" ",mods:{active:"yes",live:"yes"},mix:"stream-watching__reload stream__reload",stat:e.stat.getClientCounter("stream.watching.video_nav.again"),attrs:{role:"button",tabindex:"0"},navIcon:s("stream-watching__nav-icon_reload")})),r+=s("stream-watching__nav-item",n?{now:t.now,program:n,mods:{next:"yes"}}:{mods:{empty:"yes"}})):r}),t("stream-watching__nav-icon_arrow",function(t,e,s){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill="currentColor" d="M5.6 14.3l5.3-5.8-5.3-5.8L7 1.3l6.7 7.2L7 15.7l-1.4-1.4z"/></svg>'}),t("stream-watching__nav-icon_reload",function(t,e,s){return'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill="currentColor" d="M9 2C6 2 3.6 4.2 3.1 7H1l3 3.5L7 7H5.1c.4-1.7 2-3 3.9-3 2.2 0 4 1.8 4 4s-1.8 4-4 4v2c3.3 0 6-2.7 6-6s-2.7-6-6-6z"/></svg>'}),t("stream-watching__nav-item-time",function(t,e,s){return'<span class="stream-watching__nav-time">'+(void 0!==t.time?t.time:"")+"</span>"}),t("stream-watching__nav-item-layout",function(t,e,s){var i;return'<li class="'+home.parseRules.bem(t,e,"stream-watching__nav-item.class")+'" '+home.parseRules.bem(t,e,"attrs")+" "+(t.stat!==i?t.stat:"")+" "+(t.a11y!==i?t.a11y:"")+'><span class="stream-watching__nav-icon">'+(t.navIcon!==i?t.navIcon:"")+"</span>"+(t.navTime!==i?t.navTime:"")+'<span class="stream-watching__nav-title">'+(t.title!==i?t.title:"")+"</span></li>"}),t("stream-watching__player-info",function(t,e,s){var i,n;return'<div class="stream-watching__player-program i-multiline-overflow">'+(t.title!==n?t.title:"")+'</div><div class="stream-watching__player-channel">'+(t.channel!==n?t.channel:"")+'</div><div class="stream-watching__player-online"></div><div class="stream-watching__player-overlay stream-watching__link" data-active="watching" '+((i=t.overlay)&&(i=i.stat),i!==n?i:"")+"></div>"}),t("stream-watching__player",function(t,e,s){var i;return'<div class="stream-watching__player"><div class="stream-watching__player-info"></div><div class="stream-watching__player-container"><div class="stream-watching__player-elem" id="stream-watching__player"></div><div class="stream-watching__player-plug"></div></div><button class="stream-watching__player-overlay-close" '+((i=t.overlay)&&(i=i.statClose),void 0!==i?i:"")+' type="button"><svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 40 40"><path d="M10 10l20 20m0-20L10 30" stroke="#fff" stroke-width="3" /></svg></button></div>'}),t("stream-navbutton",function(t,e,s){var i,n=t.mods||{},r=t.type,a="",o=t.channelBrandingEnabled,c="stream-navbutton stream-"+t.parent+"__link";return n.active=r,n.size="n",n.theme="stream","catchup"===r?(n.stream="blue",n.active="schedule",i=" ",a=e.stat.getClientCounter("stream.tvprogram")):"schedule"===r?(i="",a=e.stat.getClientCounter("stream."+t.parent+".tvprogram")):"schedule-wide"===r?(i="",a=e.stat.getClientCounter("stream.tvprogram-wide"),n.theme="transparent-icon",n.active="schedule"):"watching"===r&&(i="  ",a=e.stat.getClientCounter("stream."+t.parent+".switch")),o||"schedule"!==r||(n.theme="white-text",n.size="",c+=" stream-watching__button2"),s("button2",{url:s("stream-url",t.urlParams),mods:n,mix:c,attrs:{"data-active":n.active},content:i,iconLeft:"watching"===r||"schedule-wide"===r?"stream-navbutton__icon":"",stat:""===a?e.stat.getClientCounter("stream.switch"):a})}),t("stream-share",function(t,e,s){var i=t.statRoot||"stream";return s("stream-share__layout",{js:{"stream-share":{statRoot:i}},mods:{hidden:"yes"},stat:e.stat.getClientCounter(i+".share.popup")})}),t("stream-share__goldenmask-img-default",function(){return"https://yastatic.net/s3/home/stream/promo/goldenmask/default.jpg"}),t("stream-share__goldenmask-img",function(t,e,s){var i=t.thumbnail;return i?(null===i.match(/^https?:\/\//)&&(i="https:"+i),i):s("stream-share__goldenmask-img-default")}),t("stream-share__chmf2018-text",function(t,e){var s=t.programTitle.replace(/([!?:.])?(\s*)$/,"");return" %program%".replace("%program%",s)}),t("stream-share__goldenmask-text",function(t,e){return t.programTitle?"  online.  %program%.   ".replace("%program%",t.programTitle):"  online.   "}),t("stream-share__img-default",function(){return"https://yastatic.net/s3/home/logo/stream-share/stream-share_default.png"}),t("stream-share__append-sign",function(t){if(t.text)return t.text.replace(/([!?:.])?(\s*)$/,function(t,e,s){return(e||".")+(s||" ")})}),t("stream-share__vod-text",function(t,e,s){var i=s("stream-share__prepare-program-title",{programTitle:t.programTitle,episodeName:t.isFirstChannel?"":t.episodeName,tmplLength:"%program%   ".length,useQuotes:!0});return"%program%   ".replace("%program%",i)}),t("stream-share__lib-text",function(t,e,s){var i=s("stream-share__prepare-program-title",{programTitle:t.libTitle,tmplLength:"%program%   ".length,useQuotes:!0});return"%program%   ".replace("%program%",i)}),t("stream-share__prepare-program-title",function(t,e,s){var i,n=t.programTitle===t.episodeName?"":t.episodeName,r=t.programTitle,a="";return!r&&n&&(r=n,n=""),r&&n&&(a=s("stream-share__append-sign",{text:r})+s("stream-share__append-sign",{text:n})),(r&&!n||a.length+t.tmplLength>145)&&(i=null!==(a=r.replace(/\s+$/,"")).match(/[!?:.]$/)?"":".",a=t.useQuotes?"%program%%sign% ".replace("%program%",a).replace("%sign%",i):a+i+" "),a}),t("stream-share__channel-text",function(t,e){return{146:"     ",427:"     ",20180504:"     2018 ",1533903400:"   Dota 2 The International 2018  "}[t.channelId]||"   %channel%  ".replace("%channel%",t.channelTitle)}),t("stream-share__layout",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-share.class")+' i-bem" data-bem="'+home.parseRules.bem(t,e,"js")+'"><div class="stream-share__title" '+(void 0!==t.stat?t.stat:"")+'><div class="stream-share__icon"><svg width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M14 8.0001h2v8H0v-8h1.999v6H14v-6zM7.9997 0l4 5h-3v6h-2V5h-3.001l4.001-5z" fill="currentColor"/></svg></div></div><div class="stream-share__popup"><div class="stream-share__list"></div></div></div>'}),t("stream-stickers-counter",function(t,e,s){return s("stream-stickers-counter__layout",{js:{"stream-stickers-counter":{}},mods:t.mods,stickers:"",text:""})}),t("stream-stickers-counter__sticker",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-stickers-counter__sticker.class")+'"'+home.parseRules.bem(t,e,"attrs")+"></div>"}),t("stream-stickers-counter__count-text",function(t,e,s){return'<span class="stream-stickers-counter__count-text">&nbsp;'+(void 0!==t.text?t.text:"")+"</span>"}),t("stream-stickers-counter__info",function(t,e,s){var i;return'<div class="stream-stickers-counter__stickers">'+(t.stickers!==i?t.stickers:"")+'</div><span class="stream-stickers-counter__count">'+(t.count!==i?t.count:"")+"</span>"}),t("stream-stickers-counter__layout",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-stickers-counter.class")+' i-bem" data-bem="'+home.parseRules.bem(t,e,"js")+'"></div>'}),t("stream-stickers__fake-stickers",function(t,e,s){for(var i="",n=0;n<10;n++)i+=s("stream-stickers__new-sticker",{sticker:s("stream-stickers__sticker",{mods:{"new":"yes"},stat:""})});return i}),t("stream-stickers",function(t,e,s){var i=t.statRoot||"stream";return s("stream-stickers__layout",{js:{"stream-stickers":{currentStickerpack:"default7",statRoot:i}},panelMix:"stream-stickers__panel_opened_no",flightToggle:s("stream-stickers__flight-toggle",{mods:{disabled:"no",state:"on"},attrs:{title:""}}),stickers:s("stream-stickers__list",{stickerPack:"default7",statRoot:i}),closeStat:e.stat.getClientCounter(i+".stickers.close"),openStat:e.stat.getClientCounter(i+".stickers.open"),fakeStickers:s("stream-stickers__fake-stickers")})}),t("stream-stickers__fake-sticker",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-stickers__fake-sticker.class")+'">'+(void 0!==t.sticker?t.sticker:"")+"</div>"}),t("stream-stickers__new-sticker",function(t,e,s){return'<div class="stream-stickers__new-fly-left"><div class="stream-stickers__new-fly-up">'+(void 0!==t.sticker?t.sticker:"")+"</div></div>"}),t("stream-stickers__button",function(t,e,s){var i;return'<div class="'+home.parseRules.bem(t,e,"stream-stickers__button.class")+'" '+(t.stat!==i?t.stat:"")+" "+home.parseRules.bem(t,e,"attrs")+">"+(t.sticker!==i?t.sticker:"")+"</div>"}),t("stream-stickers__sticker",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-stickers__sticker.class")+'" '+(void 0!==t.stat?t.stat:"")+" "+home.parseRules.bem(t,e,"attrs")+"></div>"}),t("stream-stickers__flight-toggle",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-stickers__flight-toggle.class")+'" '+home.parseRules.bem(t,e,"attrs")+' role="button" tabindex="0"></div>'}),t("stream-stickers__layout",function(t,e,s){var i;return'<div class="'+home.parseRules.bem(t,e,"stream-stickers.class")+' i-bem" '+home.parseRules.bem(t,e,"attrs")+' data-bem="'+home.parseRules.bem(t,e,"js")+'"><div class="stream-stickers__inner"><div class="stream-stickers__flight-area"><canvas class="stream-stickers__canvas"></canvas></div><div class="stream-stickers__panel-wrap"><div class="stream-stickers__panel '+(t.panelMix!==i?t.panelMix:"")+'"><div class="stream-stickers__list">'+(t.stickers!==i?t.stickers:"")+'</div><div class="stream-stickers__close" role="button" tabindex="-1" '+(t.closeStat!==i?t.closeStat:"")+' title=""></div><div class="stream-stickers__open" role="button" tabindex="0" '+(t.openStat!==i?t.openStat:"")+' title=""></div></div><div class="stream-stickers__toggle-wrap">'+(t.flightToggle!==i?t.flightToggle:"")+'</div></div><div class="stream-stickers__new-stickers">'+(t.fakeStickers!==i?t.fakeStickers:"")+"</div></div></div>"}),t("stream-stickers__list",function(t,e,s){var i=t.stickerPack||"",n=i.match(/^(\w+)(\d+)$/)||[],r=n[1],a=t.statRoot||"stream",o=parseInt(n[2],10);if(r){for(var c=[],l=0;l<o;l++){var h={},m={role:"button",tabindex:0};l<3?h.anim="move-"+(o-3+1):l<o-3?(h.anim="hide-"+(o-l),h.scaled="yes",m.disabled="disabled",m.tabindex=-1):(h.anim="collapsed",h.scaled="yes",m.disabled="disabled",m.tabindex=-1),c[l]=s("stream-stickers__button",{stat:e.stat.getClientCounter(a+".stickers."+r+"."+l),attrs:m,mods:h,sticker:s("stream-stickers__sticker",{mods:{index:l},attrs:{style:"background-image:url(https://yastatic.net/s3/home/stream/emoji/"+i+"/48.png)"}})})}return c.join("")}}),t("stream-sport-stat",function(t,e,s){return s("stream-sport-stat__layout",{js:{"stream-sport-stat":{}}})}),t("stream-sport-stat__layout",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-sport-stat.class")+' i-bem" data-bem='+home.parseRules.bem(t,e,"js")+" "+home.parseRules.bem(t,e,"attrs")+'><div class="stream-sport-stat__stats"></div><div class="stream-sport-stat__goals"></div></div>'}),t("football-stats__stat",function(t){var e,s=t.teams,i=t.stat,n=s[0][i],r=s[1][i],a=s[0][i]+s[1][i],o=n,c=r,l="ball_posession"===i,h=!1;return 0===a&&(a=1),s[0][i]===undefined||s[1][i]===undefined||null===s[0][i]||null===s[1][i]?(o="&mdash;",c="&mdash;",n=0,r=0,a=1,h=!0):(e=Math.max(n,r)/a,!l&&e>2/3&&(a*=3*e/2),l&&(o+="%",c+="%")),{hidden:h,leftStr:o,rightStr:c,leftPercent:(n/a*100).toFixed(2)+"%",rightPercent:(r/a*100).toFixed(2)+"%"}}),t("football-stats",function(t,e,s){var i=t.teams;if(i&&2===i.length){var n=["ball_posession","shots_wide","shots_on_goal","corners","yellow_cards","red_cards"],r=0;n.forEach(function(t){(i[0][t]||i[1][t])&&++r});var a=t.theme||"match",o=r<2;return s("football-stats__layout_theme_"+a,{mods:{theme:a,hidden:o?"yes":undefined},header:"stream"===a?s("football-stats__header_theme_stream",t):"",mix:(t.mix||"")+(o&&"match"===a?" football__match-block_hidden_yes":""),rows:n.map(function(t){var n=s("football-stats__stat",{teams:i,stat:t});return s("football-stats__row_theme_"+a,{mods:{hidden:n.hidden?"yes":undefined},key:t,name:e.l10n("football.stats."+t),left:n.leftStr,right:n.rightStr,leftPercent:n.leftPercent,rightPercent:n.rightPercent})}).filter(Boolean).join(""),js:{"football-stats":{matchId:t.id}}})}}),t("football-stats__row_theme_match",function(t,e,s){var i;return'<div class="'+home.parseRules.bem(t,e,"football-stats__row.class")+'" data-key="'+(t.key!==i?t.key:"")+'"><div class="football-stats__val">'+(t.left!==i?t.left:"")+'</div><div class="football-stats__bar-cell"><div class="football-stats__bar"><div class="football-stats__bar-inner football-stats__bar-inner_left" style="width:'+(t.leftPercent!==i?t.leftPercent:"")+'"></div></div></div><div class="football-stats__name">'+(t.name!==i?t.name:"")+'</div><div class="football-stats__bar-cell"><div class="football-stats__bar"><div class="football-stats__bar-inner football-stats__bar-inner_right" style="width:'+(t.rightPercent!==i?t.rightPercent:"")+'"></div></div></div><div class="football-stats__val">'+(t.right!==i?t.right:"")+"</div></div>"}),t("football-stats__layout_theme_match",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"football-stats.class")+' i-bem" data-bem="'+home.parseRules.bem(t,e,"js")+'"><div class="football-stats__title"></div><div class="football-stats__table">'+(void 0!==t.rows?t.rows:"")+"</div></div>"}),t("football-stats__header_theme_stream",function(t,e,s){var i=t&&t.teams||[];return s("football-stats__header-layout_theme_stream",{flag1:s("football-flag",{iso:i[0].country_iso,country_name:i[0].country_name}),flag2:s("football-flag",{iso:i[1].country_iso,country_name:i[1].country_name})})}),t("football-stats__row_theme_stream",function(t,e,s){var i;return'<div class="'+home.parseRules.bem(t,e,"football-stats__row.class")+'" data-key="'+(t.key!==i?t.key:"")+'"><div class="football-stats__val">'+(t.left!==i?t.left:"")+'</div><div class="football-stats__name">'+(t.name!==i?t.name:"")+'</div><div class="football-stats__val">'+(t.right!==i?t.right:"")+"</div></div>"}),t("football-stats__header-layout_theme_stream",function(t,e,s){var i;return'<div class="football-stats__head"><div class="football-stats__flag football-stats__flag_left">'+(t.flag1!==i?t.flag1:"")+'</div><div class="football-stats__title"></div><div class="football-stats__flag football-stats__flag_right">'+(t.flag2!==i?t.flag2:"")+"</div></div>"}),t("football-stats__layout_theme_stream",function(t,e,s){var i;return'<div class="'+home.parseRules.bem(t,e,"football-stats.class")+' i-bem" data-bem="'+home.parseRules.bem(t,e,"js")+'">'+(t.header!==i?t.header:"")+'<div class="football-stats__table">'+(t.rows!==i?t.rows:"")+"</div></div>"}),t("football-flag",function(t,e,s){var i=t.mods||{},n=s("football-flag__map"),r=t.iso&&n[t.iso],a=t.country_name;return r?"no"!==i.shaded&&(i.shaded="yes"):(r=[0,0],i.unknown="yes"),t.size&&(i.size=t.size),s("football-flag__html",{mods:i,mix:t.mix,name:a,data:t,x:r[0]+"%",y:r[1]+"%"})}),t.cached("football-flag__map",function(){var t={};return["0empty","ar","au","be","br","ch","co","cr","de","dk","eg","gb-eng","es","fr","hr","ir","is","jp","kr","ma","mx","ng","pa","pe","pl","pt","rs","ru","sa","se","sn","tn","uy"].forEach(function(e,s){var i=s%4,n=Math.floor(s/4);t[e]=[(100*i/3).toFixed(2),(100*n/8).toFixed(2)]}),t}),t("football-flag__html",function(t,e,s){var i;return'<span class="'+home.parseRules.bem(t,e,"football-flag.class")+'" title="'+(t.name!==i?t.name:"")+'" style="background-position:'+(t.x!==i?t.x:"")+" "+(t.y!==i?t.y:"")+'"></span>'}),t("football-store__matches-data",function(t,e){function s(t,e,s){if(e)for(var i=0;i<s.length;++i)s[i]in e&&(t[s[i]]=e[s[i]])}t&&t.length&&t.forEach(function(t){if(!e.settingsJs.has("upd_"+t.id,"football")){var i={};s(i,t,["has_stream","content_id","img","url","card_enabled","timestamp","stream_start_time","m_status","has_vod","vod_img","phase_title","phase_type","stadium","push","link_type","id"]),i.teams=[{},{}];var n=["country_iso","country_short_name","country_name","shirt","rating_icon","rating_text"];s(i.teams[0],t.teams[0],n),s(i.teams[1],t.teams[1],n),i.m_result=t.m_result,i.m_result_shootout=t.m_result_shootout,e.settingsJs.add("upd_"+t.id,i,"football")}})}),t("stream-sport-goals",function(t,e,s){var i,n,r,a=t.actions,o=t.teams,c=function(t){var e,s=(t._action||"").toLowerCase();if(("goal"===s||"own goal"===s)&&t.time&&t.name)return-1===(e=String(t.time)).indexOf("'")&&(e+="'"),{time:e,time_numeric:t.time_numeric,name:t.name,auto:"own goal"===s}};if(a[0]&&(n=a[0].map(c).filter(Boolean)),a[1]&&(r=a[1].map(c).filter(Boolean).map(function(t){return t.right=!0,t})),(n.length||r.length)&&(i=(n||[]).concat(r||[]).sort(function(t,e){return t.time_numeric-e.time_numeric}).map(function(t){return s("stream-sport-goals__goal",{mods:{right:t.right?"yes":""},time:t.time,name:t.name,auto:t.auto?s("stream-sport-goals__autogoal"):""})}).join("")))return s("stream-sport-goals__html",{header:s("stream-sport-goals__header",{shirtLeft:s("stream-sport-goals__shirt",{shirt:o[0].shirt}),shirtRight:s("stream-sport-goals__shirt",{shirt:o[1].shirt})}),goals:i})}),t("stream-sport-goals__shirt",function(t,e,s){return'<div class="stream-sport-goals__shirt-outer"><div class="stream-sport-goals__shirt" style="background-image:url(https://yastatic.net/s3/home/football/2018/shirts2/'+(void 0!==t.shirt?t.shirt:"")+'.svg)"></div></div>'}),t("stream-sport-goals__autogoal",function(t,e,s){return'<div class="stream-sport-goals__autogoal"><div class="stream-sport-goals__autogoal-icon" title=""></div></div>'}),t("stream-sport-goals__goal",function(t,e,s){var i;return'<div class="'+home.parseRules.bem(t,e,"stream-sport-goals__row.class")+'"><div class="stream-sport-goals__time">'+(t.time!==i?t.time:"")+'</div><div class="stream-sport-goals__name">'+(t.name!==i?t.name:"")+"</div>"+(t.auto!==i?t.auto:"")+"</div>"}),t("stream-sport-goals__header",function(t,e,s){var i;return'<div class="stream-sport-goals__head">'+(t.shirtLeft!==i?t.shirtLeft:"")+'<div class="stream-sport-goals__title"> </div>'+(t.shirtRight!==i?t.shirtRight:"")+"</div>"}),t("stream-sport-goals__html",function(t,e,s){var i;return'<div class="stream-sport-goals stream-sport-goals">'+(t.header!==i?t.header:"")+'<div class="stream-sport-goals__table">'+(t.goals!==i?t.goals:"")+"</div></div>"}),t("stream-infinity-carousels__list",function(t,e,s){var i=t.carousels||[];return t.fake?s("stream-infinity-carousels__list_fake_yes",t):i.map(function(e){if(e.carousel_id)return s("stream-carousel",{title:e.title||"",type:e.carousel_id.toLowerCase(),carouselId:e.carousel_id,itemMix:"stream-"+t.parent+"__link",items:e.set||[],totalCount:e.totalCount,fakeEpisodesCount:t.episodesCount,statRoot:"stream."+t.parent,showRating:t.showRating,showProgress:t.showProgress,showChannelSubtitle:t.showChannelSubtitle,headerCategories:t.headerCategories,mods:t.mods||{vertical:e.has_vertical?"yes":""}})}).join("")}),t("stream-infinity-carousels__list_fake_yes",function(t,e,s){for(var i="",n=0;n<t.carouselsPerTime;n++)i+=s("stream-carousel",{title:"",fakeEpisodesCount:t.episodesCount,mods:{fake:"yes",vertical:t.fake.vertical?"yes":undefined}});return i}),t("stream-infinity-carousels__params",function(t){var e=t.uniqueCarousels||{},s=Object.keys(e).length;return{carouselsPerTime:t.carouselsPerTime||4,loadedCarousels:s||(t.loadedCarousels||0),episodesCount:t.episodesCount||20,infinity:t.infinity||!1,tag:t.tag,parent:t.parent||"stream-infinity-carousels",showRating:t.showRating,showProgress:t.showProgress,showChannelSubtitle:t.showChannelSubtitle,headerCategories:t.headerCategories||{},uniqueCarousels:e,fake:t.fake,firstFetchData:"undefined"==typeof t.firstFetchData||t.firstFetchData}}),t("stream-infinity-carousels",function(t,e,s){var i=s("stream-infinity-carousels__params",t);i.carousels=t.carousels||[];var n=t.mods||{};return n.infinity=i.infinity||"",s("stream-infinity-carousels__layout",{carousels:s("stream-infinity-carousels__list",i),js:{"stream-infinity-carousels":i},mods:n})}),t("stream-infinity-carousels__layout",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-infinity-carousels.class")+' i-bem" data-bem="'+home.parseRules.bem(t,e,"js")+'"><div class="stream-infinity-carousels__content">'+(void 0!==t.carousels?t.carousels:"")+"</div></div>"}),t("stream-carousel__list",function(t,e,s){var i=t.items||[],n=t.mods||{},r=t.countItems-i.length;return i.map(function(e,i){return s("stream-card",{statPath:t.statRoot+".item."+(r+i),mods:{vertical:t.vertical?"yes":"no",rating:t.showRating&&t.vertical?"yes":undefined,time:"yes",promo:n.promo,progress:t.showProgress?"yes":undefined,thumbLazyLoad:t.thumbLazyLoad?"yes":undefined},attrs:{role:"listitem"},mix:"stream-carousel__item "+(t.itemMix||""),thumbMix:t.thumbMix,showChannelSubtitle:t.showChannelSubtitle,item:e})}).join("")}),t("stream-carousel__unique",function(t){var e={};return t.items.forEach(function(t){var s=t.content_id;s&&!e[s]&&(e[s]=!0)}),e}),t("stream-carousel",function(t,e,s){var i=t.items||[],n=i.length,r=t.carouselId||"",a=t.mods||{},o=a.vertical,c=t.fakeEpisodesCount||7,l="",h={mods:{arrow:"rounded",aligned:"yes",color:"white"}},m={"arrowed-list":{blockid:t.type?"stream.carousel."+t.type:"",valuableScroll:o?55:66}},d={scroller:{}},u={},_=t.titleMix||"",p=(t.statRoot||"stream")+".carousel."+t.type,g="undefined"!=typeof BEM&&BEM.blocks?BEM.blocks.stream.getExp():{};if(home&&home.exp&&(g.stream_new_thumbsv1=home.exp.check("stream_new_thumbsv1",e),g.stream_new_thumbsv2=home.exp.check("stream_new_thumbsv2",e)),o||!g.stream_new_thumbsv1&&!g.stream_new_thumbsv2||(a.cardWidth=g.stream_new_thumbsv1?"v1":"v2"),a.fake){for(var f=0;f<c;f++)l+=s("stream-card",{mods:{vertical:o?"yes":"no",fake:"yes"},mix:"stream-carousel__item"});return s("stream-carousel__layout",{title:"&nbsp;",mods:a,arrowedListMods:h,arrowedListParams:m,scrollerParams:d,items:l})}if(0!==n){!1,t.headerCategory&&(u={"data-active":"category","data-category":t.headerCategory,role:"button",tabindex:0},_+=" stream-carousel__link");var v={itemMix:t.itemMix,mods:a,statRoot:p,vertical:o,showRating:t.showRating,showProgress:t.showProgress,showChannelSubtitle:t.showChannelSubtitle};return s("stream-carousel__layout",{title:t.title?s("stream-carousel__title",{title:t.title,mix:_,attrs:u}):"",js:{"stream-carousel":{type:t.type,carouselId:r,countItems:n,totalCount:t.totalCount,uniqueItems:s("stream-carousel__unique",{items:i}),statRoot:p,carouselParams:v}},mods:a,attrs:{"data-realshow":p+".realshow"},arrowedListMods:h,arrowedListParams:m,scrollerParams:d,prevStat:e.stat.getClientCounter(p+".scroll.back"),nextStat:e.stat.getClientCounter(p+".scroll.forward"),items:s("stream-carousel__list",{items:i,itemMix:t.itemMix,mods:a,statRoot:p,vertical:o,showRating:t.showRating,showProgress:t.showProgress,showChannelSubtitle:t.showChannelSubtitle,countItems:t.count||n})})}}),t("stream-carousel__title",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-carousel__title.class")+'" '+home.parseRules.bem(t,e,"attrs")+">"+(void 0!==t.title?t.title:"")+"</div>"}),t("stream-carousel__list",function i(t,e,s){return t.thumbLazyLoad=!0,s(i.base,t)}),t("stream-carousel__layout",function(t,e,s){var i;return'<div class="'+home.parseRules.bem(t,e,"stream-carousel.class")+' i-bem" data-bem="'+home.parseRules.bem(t,e,"js")+'" '+home.parseRules.bem(t,e,"attrs")+">"+(t.title!==i?t.title:"")+'<div class="'+home.parseRules.bem(t,e,"arrowedListMods.arrowed-list.class")+' i-bem" data-bem="'+home.parseRules.bem(t,e,"arrowedListParams.js")+'"><div class="arrowed-list__control arrowed-list__left arrowed-list__left_hidden_yes" '+(t.prevStat!==i?t.prevStat:"")+'></div><div class="stream-carousel__list"><div class="stream-carousel__content arrowed-list__content scroller i-bem" role="list" data-bem="'+home.parseRules.bem(t,e,"scrollerParams.js")+'">'+(t.items!==i?t.items:"")+'</div></div><div class="arrowed-list__control arrowed-list__right" '+(t.nextStat!==i?t.nextStat:"")+"></div></div></div>"}),t("stream-card__progress",function(t,e,s){var i,n,r,a,o=t.item||{},c=t.mods||{},l="";if("yes"===c.progress&&o.content_id&&o.start_time&&o.end_time)return i=parseInt(e.Timestamp||home.now()/1e3,10),n=parseInt(o.start_time,10),r=parseInt(o.end_time,10),l=s("stream-card__progress-html",{mods:{id:a=""+i+Math.round(1e4*Math.random())}}),{progressOld:"new"===c.type?"":l,progress:"new"===c.type?l:"",style:s("stream-card__style_transition_time",{id:a,duration:r-i,ratio:((i-n)/(r-n)).toFixed(4)})}}),t("stream-card__rating",function(t,e,s){var i=t.item||{};return"yes"===(t.mods||{}).rating&&i.rating_kp?s("kinopoisk-rating",{mix:"stream-card__rating",rating:i.rating_kp}):""}),t("stream-card__thumb",function(t,e,s){var i=t.item||{},n=t.mods||{},r="yes"===n.vertical&&i.onto_poster||i.thumbnail;return n.thumbLazyLoad?{"data-image":s("stream-thumbnail__src",{thumbnail:r})}:{style:s("stream-thumbnail",{thumbnail:r})}}),t("stream-card__subtitle",function(t,e,s){var i=t.item||{},n=t.mods||{},r="yes"===n.time,a=i.start?i.start():i.start_time,o="";return i.subtitle||n.promo?o=i.subtitle:!t.showChannelSubtitle&&r&&"episode"===i.content_type_name&&(i.release_date_ut||a)?o=s("stream-time__string",{mods:{relative:"yes"},program:i}):t.showChannelSubtitle&&i.channel?o=i.channel.title:i.genres&&(o=s("stream-meta",{release_year:i.release_year,genres:i.genres})),o?s("stream-card__subtitle-html",{text:o}):""}),t("stream-card__title",function(t,e,s){var i=t.item||{},n="";return(n=i.title===i.program_title?i.title:i.title&&i.program_title?i.program_title+". "+i.title:i.title||i.program_title)?s("stream-card__title-html",{text:n}):""}),t("stream-card__attrs",function(t,e,s){var i=t.item||{},n=t.attrs||{};return i.content_id&&(n["data-id"]=i.content_id),i.url?(n.href=i.url,n.target="blank"):(n.href=s("stream-url",{streamId:i.content_id}),n["data-active"]=n["data-active"]||"watching"),n}),t("stream-card__channelIcon",function(t,e,s){var i=t.item||{},n=t.mods||{},r=i.channel||{},a=i.channel_id||r.channel_id,o="new"===n.type;return"yes"!==n.vertical&&!n.promo&&o&&a?s("channel-icon",{mods:{channel:a,theme:"dark",size:"small"},mix:"stream-card__channel-icon"}):""}),t("stream-card__poster-attrs",function(t,e,s){var i=t.mods||{},n=t.poster||"";return i.thumbLazyLoad?{"data-image":s("stream-thumbnail__src",{thumbnail:n})}:{style:s("stream-thumbnail",{thumbnail:n})}}),t("stream-card__poster",function(t,e,s){var i=t.item||{},n=t.mods||{},r=i.onto_poster||i.channel&&i.channel.thumbnail,a={vertical:i.onto_poster?"yes":undefined};if(r)return s("stream-card__poster-html",{mods:a,attrs:s("stream-card__poster-attrs",{mods:n,poster:r})})}),t("stream-card__badge",function(t,e,s){var i=t.item||{},n=t.mods||{};return"yes"===n.vertical?"":i.promo_text?s("stream-card__badge-layout",{mods:{promo:"yes"},content:i.promo_text,attrs:{style:"background: "+(i.promo_color||"#304bdd")}}):s("stream-card__badge-layout",{content:s("stream-meta-badge",{duration:n.progress||n.promo||i.channel_id?"":s("stream-duration",t),dHD:i.meta&&i.meta.superres,mix:{block:"stream-card",elem:"thumb-meta"}})})}),t("stream-card__has-animation",function(t){return!(t.mods||{}).fake}),t("stream-card__has-new-style",function(t){var e=t.mods||{},s="yes"===e.promo,i="yes"===e.vertical;return t.exp&&(t.exp.stream_new_thumbsv2||t.exp.stream_new_thumbsv1)&&!i&&!s}),t("stream-card",function(t,e,s){var i=t.item||{},n={},r=t.mods||{},a={},o=t.statPath,c="",l={};return"undefined"!=typeof BEM&&BEM.blocks?n=BEM.blocks.stream.getExp():home&&home.exp&&(n.stream_video_preview=home.exp.check("stream_video_preview",e)),n.stream_video_preview&&i.ya_video_preview&&"yes"!==t.mods.vertical&&(t.mix+=" thumb-preview thumb-preview_video",t.thumbMix+=" thumb-preview__target",a["thumb-preview"]={preview:{url:i.ya_video_preview}}),s("stream-card__has-animation",t)&&(r.animated="yes"),s("stream-card__has-new-style",{mods:r,exp:n})&&(r.type="new",r.animated="no"),i.content_id&&(l.content_id=i.content_id),o&&(c=e.stat.getClientCounter(o,!1,l)),s("stream-card__html",{tag:"a",mods:t.mods,js:a,mix:t.mix,stat:c,attrs:s("stream-card__attrs",t),title:s("stream-card__title",t),subtitle:s("stream-card__subtitle",t),thumb:s("stream-card__thumb",t),thumbMix:t.thumbMix,rating:s("stream-card__rating",t),progress:s("stream-card__progress",t),badge:s("stream-card__badge",t),poster:r.poster?s("stream-card__poster",t):"",channelIcon:s("stream-card__channelIcon",t)})}),t("stream-card__badge-layout",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-card__badge.class")+'" '+home.parseRules.bem(t,e,"attrs")+">"+(void 0!==t.content?t.content:"")+"</div>"}),t("stream-card__style_transition_time",function(t,e,s){var i;return"<style>.stream-card__progress_id_"+(t.id!==i?t.id:"")+" { animation-duration: "+(t.duration!==i?t.duration:"")+"s; animation-name: progress-"+(t.id!==i?t.id:"")+"} @keyframes progress-"+(t.id!==i?t.id:"")+" { from { -webkit-transform: scaleX("+(t.ratio!==i?t.ratio:"")+"); transform: scaleX("+(t.ratio!==i?t.ratio:"")+"); } to { -webkit-transform: scaleX(1); transform: scaleX(1); } } @-webkit-keyframes progress-"+(t.id!==i?t.id:"")+" { from { -webkit-transform: scaleX("+(t.ratio!==i?t.ratio:"")+"); transform: scaleX("+(t.ratio!==i?t.ratio:"")+"); } to { -webkit-transform: scaleX(1); transform: scaleX(1); } }</style>"}),t("stream-card__poster-html",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-card__poster.class")+'" '+home.parseRules.bem(t,e,"attrs")+"></div>"}),t("stream-card__progress-html",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-card__progress.class")+'"></div>'}),t("stream-card__subtitle-html",function(t,e,s){return'<div class="stream-card__subtitle">'+(void 0!==t.text?t.text:"")+"</div>"}),t("stream-card__title-html",function(t,e,s){return'<div class="stream-card__title i-multiline-overflow">'+(void 0!==t.text?t.text:"")+"</div>"}),t("stream-card__html",function(t,e,s){var i,n;return"<"+(t.tag!==n?t.tag:"")+' class="'+home.parseRules.bem(t,e,"stream-card.class")+' i-bem" data-bem="'+home.parseRules.bem(t,e,"js")+'" '+home.parseRules.bem(t,e,"attrs")+(t.stat!==n?t.stat:"")+'><div class="stream-card__thumb thumb-preview__target" '+home.parseRules.bem(t,e,"thumb.attrs")+">"+(t.channelIcon!==n?t.channelIcon:"")+((i=t.progress)&&(i=i.progressOld),i!==n?i:"")+(t.rating!==n?t.rating:"")+(t.badge!==n?t.badge:"")+(t.poster!==n?t.poster:"")+'</div><div class="stream-card__content">'+(t.title!==n?t.title:"")+(t.subtitle!==n?t.subtitle:"")+((i=t.progress)&&(i=i.progress),i!==n?i:"")+"</div>"+((i=t.progress)&&(i=i.style),i!==n?i:"")+"</"+(t.tag!==n?t.tag:"")+">"}),t("kinopoisk-rating__color",function(t){var e=t.rating;return e>=8?"#32ba43":e>=7?"#89c939":e>=5?"#91a449":e>=3?"#85855d":"#727272"}),t("kinopoisk-rating",function(t,e,s){var i,n,r;return t.rating?(n=(i=parseFloat(t.rating)).toFixed(1).replace(".",","),r=" %s".replace("%s",n),s("kinopoisk-rating__tmpl",{mix:t.mix,text:n,label:r,color:s("kinopoisk-rating__color",{rating:i})})):""}),t("kinopoisk-rating__tmpl",function(t,e,s){var i;return'<span class="'+home.parseRules.bem(t,e,"kinopoisk-rating.class")+'" style="background-color:'+(t.color!==i?t.color:"")+';" aria-hidden="true">'+(t.text!==i?t.text:"")+'</span><span class="a11y-hidden">'+(t.label!==i?t.label:"")+"</span>"}),t("stream-schedule__warning",function(t,e,s){return'<div class="stream-schedule__warning"><span class="stream-schedule__warning-icon"></span><div class="stream-schedule__warning-text">  </div></div>'}),t("stream-schedule",function(t,e,s){return s("stream-screen",{mods:{table:!0},mix:"stream-schedule",js:{"stream-schedule":{}},content:s("stream-schedule__layout",{calendar:s("stream-calendar",{statRoot:"stream.schedule"}),events:s("stream-events",{items:t.programs,statRoot:"stream.schedule"})})})}),t("stream-schedule__layout",function(t,e,s){var i,n;return'<div class="stream-schedule__navplace"></div><div class="stream__table"><div class="stream__line stream__line-header"><h1 class="stream__tab-title stream-schedule__channel-header"></h1></div><div class="stream__line stream-schedule__calendar"> '+(t.calendar!==n?t.calendar:"")+'</div><div class="stream__line stream-schedule__events">'+((i=s("stream__loader",t))!==n?i:"")+(t.events!==n?t.events:"")+"</div></div>"}),t("stream-events__items",function(t,e,s){var i=t.items||[],n=i.filter(function(t){return"void"!==t.content_type_name});return i.length&&n.length?i.map(function(e,i){var n=e.content_id===t.playing&&e.canPlay(home.now()/1e3),r=n||t.enabled[i].enabled&&!e.blacked,a=n?t.canRestartCurrent:r&&e.channel&&e.channel.catchup_age,o="void"===e.content_type_name;return s("stream-events__item",{mods:{playing:!!n&&"yes",disabled:!(r&&!o)&&"yes","can-play":!(!r||o)&&"yes"},mix:t.itemsMix||"stream-schedule__link",statRoot:t.statRoot,canRestart:a,item:e})}).join(""):t.error||t.notFirstPaint||!n.length?s("stream-events__empty",{message:t.error?"     ":" "}):s("stream-events__empty",{message:""})}),t("stream-events",function(t,e,s){return s("stream-events__layout",{mods:t.mods||{},items:s("stream-events__items",t)})}),t("stream-events__empty",function(t,e,s){var i,n;return'<tr><td><span class="stream-events__empty">'+(t.message!==n?t.message:e.message!==n?e.message:(i=s("message",t))!==n?i:"")+"</span></td></tr>"}),t("stream-events__blacked",function(t,e,s){return'<span class="stream-events__locked">  </span>'}),t("stream-events__item-html",function(t,e,s){var i,n;return'<tr class="'+home.parseRules.bem(t,e,"stream-events__item.class")+'" '+home.parseRules.bem(t,e,"attrs")+" "+(t.stat!==n?t.stat:"")+'><td class="stream-events__time">'+((i=s("stream-time__time",t))!==n?i:"")+'</td><td class="stream-events__title">'+(t.title!==n?t.title:"")+"</td></tr>"}),t("stream-events__layout",function(t,e,s){var i,n;return'<table class="'+home.parseRules.bem(t,e,"stream-events.class")+'">'+(t.items!==n?t.items:e.items!==n?e.items:(i=s("items",t))!==n?i:"")+"</table>"}),t("stream-events__item",function(t,e,s){var i,n=t.mods||{},r=t.item||{},a=t.statRoot||"stream";return r.blacked&&(n.blacked="yes"),n.disabled?i={disabled:"disabled"}:(i={tabindex:"0","data-active":"watching"},t.canRestart?i["data-id"]=r.content_id:(i["data-id"]=r.channel.content_id,i["data-live"]=1)),s("stream-events__item-html",{mods:n,mix:t.mix,attrs:i,title:s("stream-program-title",{program:r,parent:"stream-events__item",blacked:r.blacked?s("stream-events__blacked",{}):"",movie:5===r.genre_id?s("stream-events__movie",{title:home.capitalize(r.genre)}):""}),type:r.type,start_time:r.start_time,end_time:r.end_time,stat:e.stat.getClientCounter(a+".program.item."+(n.playing?"now":"other"))})}),t("stream-events__movie",function(t,e,s){var i,n;return'<nobr>&nbsp;<span class="stream-events__movie" title="'+(t.title!==n?t.title:e.title!==n?e.title:(i=s("title",t))!==n?i:"")+'"></span></nobr>'}),t("stream-calendar",function(t,e,s){var i=e.Timestamp?new Date(1e3*e.Timestamp):home.now();i.getHours()<5&&i.setDate(i.getDate()-1);var n,r=i.getDay(),a=[],o=[],c=t.statRoot||"stream",l=new Date(i);l.setMilliseconds(0),l.setSeconds(0),l.setMinutes(0),l.setHours(5),l=+l;for(var h=1;h>=-14;h--){var m=(h+r)%7,d=l+864e5*h,u=!1;m<0&&(m+=7);var _=s("stream-calendar__weekday",{content:{0:"",1:"",2:"",3:"",4:"",5:"",6:""}[m]});if(d===+l?(_="%date%, %day%".replace("%date%",home.capitalize("")).replace("%day%",_),n=c+".weekday.now",u=!0):n=c+".weekday.other",a.length){var p=new Date(d),g=p.getDate();1===g&&(g+=" "+{1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",10:"",11:"",12:""}[p.getMonth()+1]),_="%date%, %day%".replace("%date%",g).replace("%day%",_)}var f=s("stream-calendar__item",{mods:{inactive:h>0&&"yes",weekend:(6===m||0===m)&&"yes",date:d,selected:u?"yes":""},content:_,stat:e.stat.getClientCounter(n)});o.push(f),(!a.length&&o.length>7||o.length>6)&&(a.push(o.reverse()),o=[])}return o.length&&a.push(o.reverse()),s("stream-calendar__layout",{weeks:a.reverse().map(function(t){return s("stream-calendar__week",{items:t.join("")})}).join("")})}),t("stream-calendar__weekday",function(t,e,s){return'<span class="stream-calendar__weekday">'+(void 0!==t.content?t.content:"")+"</span>"}),t("stream-calendar__item",function(t,e,s){var i;return'<li class="'+home.parseRules.bem(t,e,"stream-calendar__item.class")+'" '+home.parseRules.bem(t,e,"attrs")+(t.stat!==i?t.stat:"")+' tabindex="0" role="button">'+(t.content!==i?t.content:"")+"</li>"}),t("stream-calendar__week",function(t,e,s){return'<ul class="stream-calendar__week">'+(void 0!==t.items?t.items:"")+"</ul>"}),t("stream-calendar__layout",function(t,e,s){return'<div class="stream-calendar"><div class="arrowed-list arrowed-list_aligned_yes arrowed-list_color_white i-bem" data-bem="{&quot;arrowed-list&quot;:{&quot;offsetRight&quot;:64}}"><div class="arrowed-list__left"></div><div class="arrowed-list__content scroller i-bem" data-bem="{&quot;scroller&quot;:{}}">'+(void 0!==t.weeks?t.weeks:"")+'</div><div class="arrowed-list__right"></div></div><div class="stream-calendar__line"></div></div>'}),t("stream-storefront__params",function(t){var e=t?t.exp:{};return{promoCount:e.stream_start_screen?5:4,episodesCount:6,minChannels:7,fakeEpisodesCount:e.stream_start_screen?17:10}}),t("stream-storefront__content",function(t,e,s){var i=s("stream-storefront__params",{exp:t.exp});return s("stream-storefront__layout",{mods:t.exp.stream_start_screen?{widescreen:"yes"}:null,promo:s("stream-promo",{mods:{fake:"yes"},count:i.promoCount}),episodes:s("stream-online-episodes",{mods:{fake:"yes"},count:i.episodesCount,statRoot:"stream.storefront",parent:"stream-storefront"}),carousels:s("stream-infinity-carousels",{loadedCarousels:4,carouselsPerTime:4,episodesCount:i.fakeEpisodesCount,parent:"storefront",firstFetchData:!1,fake:{vertical:!0}})})}),t("stream-storefront",function(t,e,s){var i=s("stream-storefront__params",{exp:t.exp});return s("stream-screen",{mods:{start:!0},mix:"stream-storefront stream_channel-icon-color_white"+(t.mix?t.mix:""),js:{"stream-storefront":{promoCount:i.promoCount,episodesCount:i.episodesCount,minChannels:i.minChannels}},content:s("stream-storefront__content",t)})}),t("stream-storefront__layout",function(t,e,s){var i;return'<div class="stream-storefront__top font-regular"><div class="stream-storefront__promo  '+home.parseRules.bem(t,e,"stream-promo.class")+'">'+(t.promo!==i?t.promo:"")+'</div><div class="stream-storefront__online-episodes">'+(t.episodes!==i?t.episodes:"")+'</div></div><div class="stream-storefront__carousels font-regular">'+(t.carousels!==i?t.carousels:"")+'</div><div class="stream-storefront__loader"></div>'}),t("stream-covers",function(t,e,s){var i,n=t.mods||{},r=t.libs;if(!r){for(n.fake="yes",r=[],i=0;i<10;i++)r.push("");return r.map(function(){return s("stream-cover_fake",{})}).join("")}if(r.length)return r.map(function(i){var r;return n.icons&&i.channel_id&&(r=s("channel-icon",{mods:{channel:i.channel_id}})),s("stream-cover",{mods:{icons:n.icons},mix:"stream-"+t.screen+"__link",icon:r,thumbnail:i.thumbnail,attrs:{"data-id":i.content_id,"data-active":"watching","data-origin":"vod-lib",title:i.title,role:"button",tabindex:0},stat:e.stat.getClientCounter(t.statPath||"stream.vod-lib")})}).join("")}),t("stream-cover",function(t,e,s){var i,n;return'<div class="'+home.parseRules.bem(t,e,"stream-cover.class")+'" style="'+((i=s("stream-thumbnail",t))!==n?i:"")+'"'+home.parseRules.bem(t,e,"attrs")+(t.stat!==n?t.stat:"")+">"+(t.icon!==n?t.icon:"")+'<div class="stream-cover__title">'+(t.title!==n?t.title:e.title!==n?e.title:(i=s("title",t))!==n?i:"")+"</div></div>"}),t("stream-carousels",function(t,e,s){var i=t.carousels||[],n=s("stream-storefront__params",{exp:t.exp||{}}),r=t.headerCategories||{},a="",o=t.fake,c=t.fake&&t.fake.count||2;if(o){for(var l=0;l<c;l++)a+=s("stream-carousel",{title:"",items:[],fakeEpisodesCount:n.fakeEpisodesCount,mods:{fake:"yes",vertical:o&&o.vertical?"yes":""}});return a}return i.map(function(e){var i=t.parent?t.parent:"storefront",n=e.carousel_id||"",a=r[n];return s("stream-carousel",{title:e.title,titleMix:a?"stream-"+i+"__link":"",headerCategory:a,items:e.set,totalCount:e.totalCount,type:n.toLowerCase(),carouselId:n,statRoot:"stream."+i,itemMix:"stream-"+i+"__link",showRating:t.showRating,mods:{vertical:e.has_vertical?"yes":undefined}})}).join("")}),t("stream-promo",function(t,e,s){var i=t.promo||[],n=t.mods||{},r=t.parent||"storefront",a="";if(n.fake){for(var o=0;o<t.count;o++)a+=s("stream-card",{mods:{promo:"yes",fake:"yes",vertical:"no"},mix:"stream-promo__item"});return a}return i.map(function(t,e){var i="stream-"+r+"__link";return s("stream-card",{statPath:"stream."+r+".promo."+e,mods:{promo:"yes",vertical:"no"},mix:"stream-promo__item"+(t.content_id?" "+i:""),item:t})}).join("")}),t("stream-online-episodes__content",function(t,e,s){var i=t.episodes||[],n=t.mods||{},r=t.itemMix?" "+t.itemMix:"",a="";if(n.fake){for(var o=0;o<t.count;o++)a+=s("stream-card",{mods:{fake:"yes",vertical:"no"},mix:"stream-online-episodes__online-episode"});return s("stream-online-episodes__content-html",{content:a})}return s("stream-online-episodes__content-html",{content:i.map(function(t,e){return s("stream-card",{statPath:"stream.storefront.episode."+e,mix:"stream-online-episodes__online-episode stream-storefront__link"+r,mods:{vertical:"no",progress:"yes"},item:t,showChannelSubtitle:!0})}).join("")})}),t("stream-online-episodes",function(t,e,s){var i=t.mods||{},n=t.episodes||[];if(t.count)return s("stream-online-episodes__layout",{js:{"stream-online-episodes":{count:t.count,parent:t.parent,statRoot:t.statRoot}},content:s("stream-online-episodes__content",{episodes:n,parent:t.parent,count:t.count,statRoot:t.statRoot,mods:i})})}),t("stream-online-episodes__content-html",function(t,e,s){return'<div class="stream-online-episodes__title">  </div><div class="stream-online-episodes__list">'+(void 0!==t.content?t.content:"")+"</div>"}),t("stream-online-episodes__layout",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-online-episodes.class")+' i-bem" data-bem="'+home.parseRules.bem(t,e,"js")+'">'+(void 0!==t.content?t.content:"")+"</div>"}),t("stream-channels-list__categories",function(t,e,s){var i="";if(t.channelsByCategory)return i+=s("button2",{mods:{size:"n",theme:"stream",type:"radio",checked:"yes",disabled:"yes"},attrs:{"data-category":"all"},mix:"stream-channels-list__category",content:"",stat:e.stat.getClientCounter("stream.channels-list.filter.all")}),Object.keys(t.channelsByCategory).map(function(n){t.channelsByCategory[n].length>0&&(i+=s("button2",{mods:{size:"n",theme:"stream",type:"radio"},attrs:{"data-category":n},mix:"stream-channels-list__category",content:home.l10n("stream.channel_category."+n),stat:e.stat.getClientCounter("stream.channels-list.filter."+n)}))}),i}),t("stream-channels-list__channels",function(t,e,s){if(t.channels)return s("stream-channels-list__channels-layout",{category:t.category?home.l10n("stream.channel_category."+t.category):"",channels:t.channels.map(function(e){return s("stream-channels-list__channel",{mods:{full:"yes"},channel:e,showDescription:t.showDescription})}).join("")})}),t("stream-channels-list__channel-superres",function(t,e,s){var i=t.channel||{};return i.meta&&i.meta.superres?s("stream-channels-list__superres",{mods:{size:"middle"}}):""}),t("stream-channels-list__channel",function(t,e,s){var i=t.channel||{},n=t.mods||{},r=t.showCategory&&i.channel_category&&i.channel_category[0];return r&&t.channelsByCategory[r]&&(r=s("stream-channels-list__channel-category",{title:home.l10n("stream.channel_category.single."+r),attrs:{"data-category":r}})),r&&(n.category="yes"),s("home-link",{href:s("stream-url",{streamChannel:i.channel_id}),mods:{color:"inherit",hover:"inherit"},attrs:{"data-id":i.content_id,"data-active":"watching"},stat:e.stat.getClientCounter("stream.channels-list.channel."+i.channel_id),mix:home.getBEMClassname("stream-channels-list__channel",{mods:n})+" stream-channels-list__link",content:s("stream-channels-list__channel-layout",{title:i.title,icon:s("channel-icon",{mods:{channel:i.channel_id},attrs:i.main_color?{style:"background-color: "+i.main_color}:{},mix:"stream-channels-list__channel-icon"}),description:i.description&&t.showDescription?s("stream-channels-list__channel-description",i):"",superres:s("stream-channels-list__channel-superres",{channel:i}),category:r||""})})}),t("stream-channels-list__taglist-channels",function(t,e,s){if(t.channels)return t.channels.map(function(e){return{key:/^[0-9]/i.test(e.title)?"0&ndash;9":e.title.substr(0,1).toUpperCase(),title:e.title,content:s("stream-channels-list__channel",{channel:e,channelsByCategory:t.channelsByCategory||{},showCategory:t.showCategory,showDescription:t.showDescription})}})}),t("stream-channels-list__taglist",function(t,e,s){if(t.channels)return s("taglist",{mods:{theme:"stream"},items:s("stream-channels-list__taglist-channels",{channels:t.channels,channelsByCategory:t.channelsByCategory||{},showCategory:!0,showDescription:!0})})}),t("stream-channels-list",function(t,e,s){return s("stream-screen",{mods:{"channels-list":!0},mix:"stream-channels-list stream_channel-icon-color_white",js:{"stream-channels-list":{}},content:s("stream-channels-list__layout")})}),t("stream-channels-list__superres",function(t,e,s){var i;return"<nobr>&nbsp;"+(void 0!==(i=s("stream-superres",t))?i:"")+"</nobr>"}),t("stream-channels-list__channel-description",function(t,e,s){return'<div class="stream-channels-list__channel-desc">'+(void 0!==t.description?t.description:"")+"</div>"}),t("stream-channels-list__channel-category",function(t,e,s){return'<div class="stream-channels-list__channel-category" '+home.parseRules.bem(t,e,"attrs")+">"+(void 0!==t.title?t.title:"")+"</div>"}),t("stream-channels-list__channels-layout",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"stream-channels-list__channels.class")+'">'+(void 0!==t.channels?t.channels:"")+"</div>"}),t("stream-channels-list__channel-layout",function(t,e,s){var i;return'<div class="stream-channels-list__channel-row">'+(t.icon!==i?t.icon:"")+'<div class="stream-channels-list__channel-name"><div class="stream-channels-list__channel-title">'+(t.title!==i?t.title:"")+(t.superres!==i?t.superres:"")+"</div>"+(t.category!==i?t.category:"")+"</div></div>"+(t.description!==i?t.description:"")}),t("stream-channels-list__layout",function(t,e,s){return'<div class="stream-channels-list__categories"></div><div class="stream-channels-list__content"></div>'}),t("taglist__items",function(t,e,s){return s("taglist__item",{key:t.key,content:(t.items||[]).join("")})}),t("taglist",function(t,e,s){var i={},n=[];return t.items.forEach(function(t){i[t.key]||(i[t.key]=[],n.push(t.key)),i[t.key].push(t.content)}),s("taglist__layout",{mix:t.mix,mods:t.mods,content:n.map(function(e){return s("taglist__items",{key:e,count:t.count,items:i[e],statRoot:t.statRoot})}).join("")})}),t("taglist__item",function(t,e,s){var i;return'<div class="taglist__item"><div class="taglist__item-key">'+(t.key!==i?t.key:"")+'</div><div class="taglist__item-content">'+(t.content!==i?t.content:"")+"</div></div>"}),t("taglist__layout",function(t,e,s){return'<div class="'+home.parseRules.bem(t,e,"taglist.class")+'">'+(void 0!==t.content?t.content:"")+"</div>"}),t("stream-error__text",function(t,e,s){return(t.text||"        .  //    .").replace(/\/([^/]+)\//,function(t,i){return s("home-link",{mix:"stream-error__reload",stat:e.stat.getAttr("stream.error.reload"),content:i})})}),t("stream-error",function(t,e,s){return s("stream-screen",{mods:{error:!0},mix:"stream-error",js:{"stream-error":{}},content:s("stream-error__layout",{errorText:s("stream-error__text",{})})})}),t("stream-error__body",function(t,e,s){return'<div class="stream-error__aspect"><div class="stream-error__frame"><div class="stream-error__text">'+(void 0!==t.errorText?t.errorText:"")+'</div></div></div><div class="stream-error__stack"></div>'}),t("stream-error__header",function(t,e,s){return'<div class="stream__line stream__line-header"><h1 class="stream__tab-title stream-error__header">  </h1></div>'}),t("stream-error__layout",function(t,e,s){var i,n;return((i=s("stream-error__header",t))!==n?i:"")+'<div class="stream-error__bg">'+((i=s("stream-error__body",t))!==n?i:"")+"</div>"}),t("stream-sidemenu",function(t,e,s){return s("stream-screen",{mods:{sidemenu:!0},mix:[{block:"stream-sidemenu",mods:{doc2doc:"yes"}}],js:{"stream-sidemenu":{}},content:s("stream-sidemenu__html",{toggles:s("stream-sidemenu__toggles",t),channels:s("stream-channels",t),statRoot:"stream.sidemenu.channel"})})}),t("stream-sidemenu__toggles",function(t,e,s){if((t.settings||{}).channelsListEnabled)return s("stream-toggles",{content:s("stream-toggles__channels-list",{statRoot:"stream.sidemenu"})})}),t("stream-sidemenu__html",function(t,e,s){var i;return'<div class="stream-sidemenu__toggles">'+(t.toggles!==i?t.toggles:"")+'</div><div class="stream-sidemenu__channels">'+(t.channels!==i?t.channels:"")+"</div>"}),t("stream-channels__list",function(t,e,s){if(t.channels)return s("stream-channels__html",{content:t.channels.map(function(e){return s("stream-channel",{title:e.title,channel_id:e.channel_id,mods:{superres:e.meta&&e.meta.superres?"yes":undefined},statRoot:t.statRoot,mix:"stream-sidemenu__link",attrs:{"data-id":e.content_id}})}).join("")})}),t("stream-channels__category-region",function(t,e,s){var i=t["category-region"]||[],n="";for(var r in i)i.hasOwnProperty(r)&&i[r].length>0&&(n+=s("stream-channels-category-region",{category:r,channels:i[r]||[],statRoot:t.statRoot}));return n}),t("stream-channels",function(t,e,s){return t["category-region"]?s("stream-channels__category-region",t):t.channels?s("stream-channels__list",t):s("stream-channels__html",{content:t.notFirstPaint?s("stream-channels__empty",{}):s("stream__loader",{})})}),t("stream-channels__empty",function(t,e,s){return'<div class="stream-channels__empty">   </div>'}),t("stream-channels__html",function(t,e,s){var i,n;return'<ul class="'+home.parseRules.bem(t,e,"stream-channels.class")+'">'+(t.content!==n?t.content:e.content!==n?e.content:(i=s("content",t))!==n?i:"")+"</ul>"}),t("stream-channels-category-region",function(t,e,s){return s("stream-channels-category-region__layout",{js:{"stream-channels-category-region":{category:t.category}},title:e.l10n("stream.channel_categories.region."+t.category),channels:s("stream-channels__list",{channels:t.channels||[],statRoot:t.statRoot})})}),t("stream-channels-category-region__layout",function(t,e,s){var i;return'<div class="'+home.parseRules.bem(t,e,"stream-channels-category-region.class")+' i-bem" data-bem="'+home.parseRules.bem(t,e,"js")+'"><div class="stream-channels-category-region__title">'+(t.title!==i?t.title:"")+'</div><div class="stream-channels-category-region__panel">'+(t.channels!==i?t.channels:"")+"</div></div>"}),t("stream-toggles__toggle",function(t,e,s){var i;return'<li class="'+home.parseRules.bem(t,e,"stream-toggles__toggle.class")+'"'+(t.stat!==i?t.stat:"")+home.parseRules.bem(t,e,"attrs")+'tabindex="0" role="button" aria-label="'+(t.title!==i?t.title:"")+'">'+(t.icon!==i?t.icon:"")+'<div class="stream-toggles__info"><div class="stream-toggles__title">'+(t.title!==i?t.title:"")+"</div></div></li>"}),t("stream-toggles",function(t,e,s){return'<ul class="stream-toggles stream-sidemenu__toggles">'+(void 0!==t.content?t.content:"")+"</ul>"}),t("stream-toggles__storefront",function(t,e,s){return s("stream-toggles__toggle",{icon:s("channel-icon",{mods:{icon:"storefront"},mix:"stream-toggles__icon"}),mix:"stream-toggles__storefront stream-sidemenu__link",attrs:{"data-active":"storefront"},title:" ",stat:e.stat.getClientCounter("stream.storefront")})}),t("stream-toggles__channels-list",function(t,e,s){var i=t.statRoot||"stream";return s("stream-toggles__toggle",{icon:s("channel-icon",{mods:{icon:"channels-list"},mix:"stream-toggles__icon"}),mix:"stream-toggles__channels-list stream-sidemenu__link",attrs:{"data-active":"channels-list"},title:" ",stat:e.stat.getClientCounter(i+".channels_list")})}),t("stream-category__items",function(t,e,s){var i=t.items||[],n=t.category||"",r=t.countItems-i.length;return i.map(function(e,i){return s("stream-card",{statPath:"stream.category."+n+".item."+(r+i),mods:{vertical:"yes",rating:"yes",thumbLazyLoad:t.thumbLazyLoad?"yes":undefined},attrs:{role:"listitem"},mix:"stream-category__item stream-category__link",item:e})}).join("")}),t("stream-category__fake-items",function(t,e,s){for(var i=t.fakeCount||0,n="",r=0;r<i;r++)n+=s("stream-card",{mods:{vertical:"yes",fake:"yes"},mix:"stream-category__item stream-category__link"});return n}),t("stream-category",function(t,e,s){return s("stream-screen",{mods:{category:!0},mix:"stream-category",js:{"stream-category":{}},content:s("stream-category__layout",{title:"",items:""})})}),t("stream-category__layout",function(t,e,s){var i,n;return'<div class="stream-category__top font-regular"><div class="stream-category__header">'+(t.title!==n?t.title:"")+'</div></div><div class="stream-category__promo font-regular">'+(t.promos!==n?t.promos:"")+'</div><div class="stream-category__carousels font-regular">'+((i=s("stream__loader",t))!==n?i:"")+(t.carousels!==n?t.carousels:"")+'</div><div class="stream-category__items font-regular">'+((i=s("stream__loader",t))!==n?i:"")+(t.items!==n?t.items:"")+"</div>"})}(),home.bundles.notify("stream")});if(window.Ya&&Ya.Rum){Ya.Rum.sendTimeMark("2939.1428");}