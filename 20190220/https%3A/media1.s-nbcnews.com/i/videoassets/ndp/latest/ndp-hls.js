/*! video-player v3.3.1-7-ga324fb1e - Version Build Date 2019-02-08 1523 Last Build: 201902111410 */(function(){var Q="SDK_"+"6.21.0.0-941ca67f-201803052354".replace(/[^\w]/g,"_"),y="undefined"!=typeof window?window:"undefined"!=typeof GLOBAL?GLOBAL:this;y.tv=y.tv||{};y.tv.freewheel=y.tv.freewheel||{};y.tv.freewheel[Q]=function(y){var a={version:"js-6.21.0.0-941ca67f-201803052354"};"undefined"!==typeof window&&(window._fw_admanager=window._fw_admanager||{},window._fw_admanager.version=a.version);a.LOG_LEVEL_QUIET=0;a.LOG_LEVEL_INFO=1;a.LOG_LEVEL_DEBUG=2;a.setLogLevel=function(b){a.warn=a.log=a.debug=
function(){};if("undefined"!==typeof console){try{window.localStorage&&window.localStorage.getItem("fwLogLevel")&&-1<window.localStorage.getItem("fwLogLevel")&&(b=window.localStorage.getItem("fwLogLevel"))}catch(c){console.warn(">FW Common.setLogLevel"+c.description)}b>a.LOG_LEVEL_QUIET&&(a.log=function(){console.log(">FW "+(new Date).toTimeString().substr(3,6)+Array.prototype.slice.call(arguments).join(" "))},a.warn=function(){console.warn(">FW "+(new Date).toTimeString().substr(3,6)+Array.prototype.slice.call(arguments).join(" "))},
b>a.LOG_LEVEL_INFO&&(a.debug=function(){console.log(">FW "+(new Date).toTimeString().substr(3,6)+Array.prototype.slice.call(arguments).join(" "))}))}};a.setLogLevel(a.LOG_LEVEL_INFO);a.log("FreeWheel Integration Runtime",a.version);a.proxyUrl=null;a.proxyAuthenticationParameter=null;a.setProxy=function(b){"string"==typeof b?("/"!=b.charAt(b.length-1)&&(b+="/"),a.proxyUrl=b):a.proxyUrl=null};a.setProxyAuthenticationParameter=function(b,c){a.proxyAuthenticationParameter=2<=arguments.length&&b?{key:b,
value:c||""}:null};a.checkUserAgent=function(b){a.PLATFORM_IS_WINDOWSPHONE=-1<b.search("windows phone");a.PLATFORM_IS_IPAD=-1<b.search("ipad");a.PLATFORM_IS_IPHONE_IPOD=-1<b.search("iphone")||-1<b.search("ipod");a.PLATFORM_IS_CHROMECAST=-1<b.search("crkey");var c=function(a){return(a=b.match(a))&&0<a.length?(a=a[0].match(/\d+/g),1*a[0]+.1*a[1]):0};a.PLATFORM_IE_MOBILE_VERSION=c(/iemobile\/\d+\.\d+/);a.PLATFORM_IOS_VERSION=c(/os \d+_\d+/);c=-1<b.indexOf("transformer")?3.2:c(/android \d+\.\d+/);a.PLATFORM_ANDROID_VERSION=
c;a.PLATFORM_IS_SAFARI=0<a.PLATFORM_IOS_VERSION&&-1<b.search("applewebkit")||0===a.PLATFORM_ANDROID_VERSION&&0>b.search("chrome")&&-1<b.search("safari");a.PLATFORM_IS_CHROME=0>b.search("edge")&&-1<b.search("chrome");a.PLATFORM_IS_MOBILE=0<a.PLATFORM_IOS_VERSION||0<a.PLATFORM_ANDROID_VERSION;a.PLATFORM_BROWSER_VERSION=function(a){var b="",c;-1!=(c=a.indexOf("opr/"))?b=a.substring(c+4):-1!=(c=a.indexOf("opera"))?(b=a.substring(c+6),-1!=(c=a.indexOf("version"))&&(b=a.substring(c+8))):-1!=(c=a.indexOf("rv:"))?
b=a.substring(c+3):-1!=(c=a.indexOf("msie"))?b=a.substring(c+5):-1!=(c=a.indexOf("edge"))?b=a.substring(c+5):-1!=(c=a.indexOf("chrome"))?b=a.substring(c+7):-1!=(c=a.indexOf("safari"))?(b=a.substring(c+7),-1!=(c=a.indexOf("version"))&&(b=a.substring(c+8))):-1!=(c=a.indexOf("firefox"))?b=a.substring(c+8):(nameOffset=a.lastIndexOf(" ")+1)<(c=a.lastIndexOf("/"))&&(b=a.substring(c+1));var d;-1!=(d=b.indexOf(";"))&&(b=b.substring(0,d));-1!=(d=b.indexOf(" "))&&(b=b.substring(0,d));return(a=parseInt(""+b,
10))?a:0}(b);a.PLATFORM_ID=a.PLATFORM_IS_MOBILE?0<a.PLATFORM_ANDROID_VERSION?"Android"+a.PLATFORM_ANDROID_VERSION:a.PLATFORM_IS_IPAD?"iPad"+a.PLATFORM_IOS_VERSION:a.PLATFORM_IS_IPHONE_IPOD?"iPhone"+a.PLATFORM_IOS_VERSION:"UnknownMobile":"Desktop";a.log("Device:",a.PLATFORM_ID,"PLATFORM_IS_SAFARI:",a.PLATFORM_IS_SAFARI,"PLATFORM_IS_CHROME:",a.PLATFORM_IS_CHROME)};a.checkUserAgent(navigator.userAgent.toLowerCase());a.PLATFORM_EVENT_CLICK=a.PLATFORM_IS_MOBILE?"touchend":"click";a.MOBILE_EVENT_DRAG="touchmove";
a.PLATFORM_SEND_REQUEST_BY_FORM=!1;a.PLATFORM_HIDE_AND_SHOW_CONTENT_VIDEO_BY_MOVE_POSITION=3.1<=a.PLATFORM_ANDROID_VERSION;a.PLATFORM_HIDE_AND_SHOW_CONTENT_VIDEO_BY_SET_DISPLAY=!0;a.PLATFORM_SUPPORT_PLAY_MIDROLL_BY_CURRENT_VIDEO_ELEMENT=a.PLATFORM_IS_IPAD||a.PLATFORM_IS_IPHONE_IPOD;a.PLATFORM_AUTO_SEEK_AFTER_MIDROLL=a.PLATFORM_IS_IPAD;a.PLATFORM_NOT_SUPPORT_OVERLAY_AD=a.PLATFORM_IS_IPHONE_IPOD||0<a.PLATFORM_ANDROID_VERSION&&3.1>a.PLATFORM_ANDROID_VERSION||a.PLATFORM_IS_WINDOWSPHONE;a.PLATFORM_FILL_VIDEO_POOL_FOR_MIDROLL=
4.2<=a.PLATFORM_IOS_VERSION;a.PLATFORM_NOT_SUPPORT_MIDROLL_AD=2.2<=a.PLATFORM_ANDROID_VERSION&&3>=a.PLATFORM_ANDROID_VERSION||9<=a.PLATFORM_IE_MOBILE_VERSION;a.PLATFORM_NOT_SUPPORT_VIDEO_AD=0<a.PLATFORM_ANDROID_VERSION&&2.1>=a.PLATFORM_ANDROID_VERSION;a.PLATFORM_DETECT_FULL_SCREEN_FOR_MIDROLL=a.PLATFORM_IS_IPAD&&4.2<=a.PLATFORM_IOS_VERSION;a.PLATFORM_NOT_SUPPORT_CLICK_FOR_VIDEO=a.PLATFORM_IS_IPHONE_IPOD&&10>a.PLATFORM_IOS_VERSION||a.PLATFORM_IS_WINDOWSPHONE||a.PLATFORM_IS_CHROMECAST;a.PLATFORM_NOT_FIRE_CLICK_WHEN_AD_VIDEO_PAUSED=
3.1<=a.PLATFORM_ANDROID_VERSION||10<=a.PLATFORM_IOS_VERSION;a.PLATFORM_WAIT_WHEN_AD_VIDEO_TIMEOUT=0<a.PLATFORM_ANDROID_VERSION&&3>=a.PLATFORM_ANDROID_VERSION;a.PLATFORM_VIDEO_DOESNOT_SUPPORT_TIMEUPDATE=9<=a.PLATFORM_IE_MOBILE_VERSION;a.PLATFORM_PLAY_DUMMY_VIDEO_FOR_PREROLL=0<a.PLATFORM_IOS_VERSION&&4.2>a.PLATFORM_IOS_VERSION&&4<=a.PLATFORM_IOS_VERSION;a.PLATFORM_NOT_WAIT_FOR_ERROR_WHEN_PLAY_DUMMY_VIDEO_FOR_PREROLL=!1;a.PLATFORM_SUPPORT_VIDEO_START_DETECT_TIMEOUT=0===a.PLATFORM_IOS_VERSION||4<=a.PLATFORM_IOS_VERSION&&
4.2>a.PLATFORM_IOS_VERSION;a.PLATFORM_NOT_SUPPORT_OVERLAY_CLICK_WHEN_CONTROLS_IS_TRUE=a.PLATFORM_IS_IPAD;a.PLATFORM_BLOCKS_AUTOPLAY=a.PLATFORM_IS_MOBILE||a.PLATFORM_IS_SAFARI||a.PLATFORM_IS_CHROME&&(0<a.PLATFORM_ANDROID_VERSION||64<=a.PLATFORM_BROWSER_VERSION);a.RENDERER_STATE_INIT=1;a.RENDERER_STATE_STARTING=2;a.RENDERER_STATE_STARTED=3;a.RENDERER_STATE_COMPLETING=4;a.RENDERER_STATE_COMPLETED=5;a.RENDERER_STATE_FAILED=6;a.TRANSLATOR_STATE_INIT=a.RENDERER_STATE_INIT;a.TRANSLATOR_STATE_STARTING=a.RENDERER_STATE_STARTING;
a.TRANSLATOR_STATE_STARTED=a.RENDERER_STATE_STARTED;a.TRANSLATOR_STATE_COMPLETING=a.RENDERER_STATE_COMPLETING;a.TRANSLATOR_STATE_COMPLETED=a.RENDERER_STATE_COMPLETED;a.TRANSLATOR_STATE_FAILED=a.RENDERER_STATE_FAILED;a.EVENT_AD="adEvent";a.EVENT_AD_BUFFERING_START="adBufferingStart";a.EVENT_AD_BUFFERING_END="adBufferingEnd";a.EVENT_SLOT_IMPRESSION="slotImpression";a.EVENT_SLOT_END="slotEnd";a.EVENT_AD_INITIATED="adInitiated";a.EVENT_AD_IMPRESSION="defaultImpression";a.EVENT_AD_IMPRESSION_END="adEnd";
a.EVENT_AD_QUARTILE="quartile";a.EVENT_AD_FIRST_QUARTILE="firstQuartile";a.EVENT_AD_MIDPOINT="midPoint";a.EVENT_AD_THIRD_QUARTILE="thirdQuartile";a.EVENT_AD_SKIPPED="adSkipped";a.EVENT_AD_COMPLETE="complete";a.EVENT_AD_CLICK="defaultClick";a.EVENT_AD_MUTE="_mute";a.EVENT_AD_UNMUTE="_un-mute";a.EVENT_AD_COLLAPSE="_collapse";a.EVENT_AD_EXPAND="_expand";a.EVENT_AD_PAUSE="_pause";a.EVENT_AD_RESUME="_resume";a.EVENT_AD_REWIND="_rewind";a.EVENT_AD_ACCEPT_INVITATION="_accept-invitation";a.EVENT_AD_CLOSE=
"_close";a.EVENT_AD_MINIMIZE="_minimize";a.EVENT_ERROR="_e_unknown";a.EVENT_RESELLER_NO_AD="resellerNoAd";a.EVENT_AD_MEASUREMENT="concreteEvent";a.EVENT_EXTENSION_LOADED="extensionLoaded";a.EVENT_AD_VOLUME_CHANGE="adVolumeChange";a.EVENT_AD_AUTO_PLAY_BLOCKED="videoAutoPlayBlocked";a.INFO_KEY_CUSTOM_ID="customId";a.INFO_KEY_MODULE_TYPE="moduleType";a.MODULE_TYPE_EXTENSION="extension";a.MODULE_TYPE_RENDERER="renderer";a.MODULE_TYPE_TRANSLATOR="translator";a.INFO_KEY_ERROR_CODE="errorCode";a.INFO_KEY_ERROR_INFO=
"errorInfo";a.INFO_KEY_ERROR_MODULE="errorModule";a.INFO_KEY_VAST_ERROR_CODE="vastErrorCode";a.ERROR_IO="_e_io";a.ERROR_TIMEOUT="_e_timeout";a.ERROR_NULL_ASSET="_e_null-asset";a.ERROR_ADINSTANCE_UNAVAILABLE="_e_adinst-unavail";a.ERROR_UNKNOWN="_e_unknown";a.ERROR_MISSING_PARAMETER="_e_missing-param";a.ERROR_NO_AD_AVAILABLE="_e_no-ad";a.ERROR_PARSE="_e_parse";a.ERROR_INVALID_VALUE="_e_invalid-value";a.ERROR_INVALID_SLOT="_e_invalid-slot";a.ERROR_NO_RENDERER="_e_no-renderer";a.ERROR_DEVICE_LIMIT="_e_device-limit";
a.ERROR_3P_COMPONENT="_e_3p-comp";a.ERROR_UNSUPPORTED_3P_FEATURE="_e_unsupp-3p-feature";a.ERROR_SECURITY="_e_security";a.ERROR_UNMATCHED_SLOT_SIZE="_e_slot-size-unmatch";a.INFO_KEY_URL="url";a.INFO_KEY_SHOW_BROWSER="showBrowser";a.INFO_KEY_CUSTOM_EVENT_NAME="customEventName";a.INFO_KEY_NEED_EMPTY_CT="needEmptyCT";a.INFO_KEY_CONCRETE_EVENT_ID="concreteEventId";a.EVENT_TYPE_CLICK_TRACKING="CLICKTRACKING";a.EVENT_TYPE_IMPRESSION="IMPRESSION";a.EVENT_TYPE_CLICK="CLICK";a.EVENT_TYPE_STANDARD="STANDARD";
a.EVENT_TYPE_GENERIC="GENERIC";a.EVENT_TYPE_ERROR="ERROR";a.EVENT_VIDEO_VIEW="videoView";a.SHORT_EVENT_TYPE_IMPRESSION="i";a.SHORT_EVENT_TYPE_CLICK="c";a.SHORT_EVENT_TYPE_STANDARD="s";a.SHORT_EVENT_TYPE_ERROR="e";a.INIT_VALUE_ZERO="0";a.INIT_VALUE_ONE="1";a.INIT_VALUE_TWO="2";a.INFO_KEY_PARAMETERS="parameters";a.URL_PARAMETER_KEY_ET="et";a.URL_PARAMETER_KEY_CN="cn";a.URL_PARAMETER_KEY_INIT="init";a.URL_PARAMETER_KEY_CT="ct";a.URL_PARAMETER_KEY_METR="metr";a.URL_PARAMETER_KEY_CR="cr";a.URL_PARAMETER_KEY_KEY_VALUE=
"kv";a.URL_PARAMETER_KEY_ERROR_INFO="additional";a.URL_PARAMETER_KEY_ERROR_MODULE="renderer";a.URL_PARAMETER_KEY_CREATIVE_RENDITION_ID="reid";a.URL_PARAMETER_KEY_CONCRETE_EVENT_ID="creid";a.CAPABILITY_SLOT_TEMPLATE="sltp";a.CAPABILITY_DISPLAY_REFRESH="rfnt";a.CAPABILITY_MULTIPLE_CREATIVE_RENDITIONS="emcr";a.CAPABILITY_RECORD_VIDEO_VIEW="exvt";a.CAPABILITY_CHECK_COMPANION="cmpn";a.CAPABILITY_CHECK_TARGETING="targ";a.CAPABILITY_RESET_EXCLUSIVITY="rste";a.CAPABILITY_FALLBACK_UNKNOWN_ASSET="unka";a.CAPABILITY_FALLBACK_UNKNOWN_SITE_SECTION=
"unks";a.CAPABILITY_FALLBACK_ADS="fbad";a.CAPABILITY_SLOT_CALLBACK="slcb";a.CAPABILITY_NULL_CREATIVE="nucr";a.CAPABILITY_AUTO_EVENT_TRACKING="aeti";a.CAPABILITY_RENDERER_MANIFEST="rema";a.CAPABILITY_REQUIRE_VIDEO_CALLBACK="vicb";a.CAPABILITY_SKIP_AD_SELECTION="skas";a.SLOT_TYPE_TEMPORAL="temporal";a.SLOT_TYPE_VIDEOPLAYER_NONTEMPORAL="videoPlayerNonTemporal";a.SLOT_TYPE_SITESECTION_NONTEMPORAL="siteSectionNonTemporal";a.TIME_POSITION_CLASS_PREROLL="PREROLL";a.TIME_POSITION_CLASS_MIDROLL="MIDROLL";
a.TIME_POSITION_CLASS_POSTROLL="POSTROLL";a.TIME_POSITION_CLASS_OVERLAY="OVERLAY";a.TIME_POSITION_CLASS_DISPLAY="DISPLAY";a.TIME_POSITION_CLASS_PAUSE_MIDROLL="PAUSE_MIDROLL";a.EVENT_REQUEST_INITIATED="onRequestInitiated";a.EVENT_REQUEST_COMPLETE="onRequestComplete";a.EVENT_SLOT_STARTED="onSlotStarted";a.EVENT_SLOT_ENDED="onSlotEnded";a.EVENT_CONTENT_VIDEO_PAUSED="contentVideoPaused";a.EVENT_CONTENT_VIDEO_RESUMED="contentVideoResumed";a.EVENT_CONTENT_VIDEO_PAUSE_REQUEST="contentVideoPauseRequest";
a.EVENT_CONTENT_VIDEO_RESUME_REQUEST="contentVideoResumeRequest";a.CAPABILITY_STATUS_OFF=0;a.CAPABILITY_STATUS_ON=1;a.PARAMETER_LEVEL_PROFILE=0;a.PARAMETER_LEVEL_GLOBAL=1;a.PARAMETER_LEVEL_OVERRIDE=5;a.PARAMETER_ENABLE_FORM_TRANSPORT="sdk.enableFormTransport";a.PARAMETER_DESIRED_BITRATE="desiredBitrate";a.PARAMETER_VIDEO_POOL_SIZE="sdk.videoPoolSize";a.PARAMETER_PAGE_SLOT_CONTENT_TYPE="sdk.pageSlotContentType";a.PARAMETER_PLAY_MIDROLL_BY_CURRENT_VIDEO_ELEMENT="PARAMETER_PLAY_MIDROLL_BY_CURRENT_VIDEO_ELEMENT";
a.PARAMETER_EXTENSION_AD_CONTROL_CLICK_ELEMENT="extension.ad.control.clickElement";a.PARAMETER_EXTENSION_CONTENT_VIDEO_ENABLED="extension.contentVideo.enabled";a.PARAMETER_EXTENSION_CONTENT_VIDEO_RESPOND_PAUSE_RESUME="extension.contentVideo.respondPauseResume";a.PARAMETER_EXTENSION_CONTENT_VIDEO_AUTO_SEEK_BACK="extension.contentVideo.autoSeekBack";a.PARAMETER_EXTENSION_CONTENT_VIDEO_AUTO_SOURCE_RESTORE="extension.contentVideo.autoSourceRestore";a.PARAMETER_EXTENSION_VIDEO_STATE_ENABLED="extension.videoState.enabled";
a.PARAMETER_RENDERER_VIDEO_START_DETECT_TIMEOUT="renderer.video.startDetectTimeout";a.PARAMETER_RENDERER_VIDEO_PROGRESS_DETECT_TIMEOUT="renderer.video.progressDetectTimeout";a.PARAMETER_RENDERER_VIDEO_ANDROID_DELAY="renderer.video.android.delay";a.PARAMETER_RENDERER_VIDEO_DISPLAY_CONTROLS_WHEN_PAUSE="renderer.video.displayControlsWhenPause";a.PARAMETER_RENDERER_VIDEO_CLICK_DETECTION="renderer.video.clickDetection";a.PARAMETER_RENDERER_VIDEO_PLAY_AFTER_STALLED="renderer.video.playAfterStalled";a.PARAMETER_EXTENSION_SURVEY_ENABLED=
"extension.survey.enabled";a.PARAMETER_RENDERER_DISPLAY_COAD_SCRIPT_NAME="renderer.html.coadScriptName";a.PARAMETER_RENDERER_HTML_SHOULD_BACKGROUND_TRANSPARENT="renderer.html.isBackgroundTransparent";a.PARAMETER_RENDERER_HTML_SHOULD_END_AFTER_DURATION="renderer.html.shouldEndAfterDuration";a.PARAMETER_RENDERER_HTML_AD_LOAD_TIMEOUT="renderer.html.adLoadTimeout";a.PARAMETER_RENDERER_HTML_PLACEMENT_TYPE="renderer.html.placementType";a.PARAMETER_RENDERER_HTML_BOOTSTRAP="renderer.html.bootstrap";a.PARAMETER_RENDERER_HTML_PRIMARY_ANCHOR=
"renderer.html.primaryAnchor";a.PARAMETER_RENDERER_HTML_MARGIN_WIDTH="renderer.html.marginWidth";a.PARAMETER_RENDERER_HTML_MARGIN_HEIGHT="renderer.html.marginHeight";a.PARAMETER_VPAID_CREATIVE_TIMEOUT_DELAY="renderer.vpaid.creativeTimeoutDelay";a.PARAMETER_VAST_TIMEOUT_IN_MILLISECONDS="translator.vast.timeoutInMilliseconds";a.PARAMETER_VAST_MAX_WRAPPER_COUNT="translator.vast.maxWrapperCount";a.VAST_DEFAULT_MAX_WRAPPER_COUNT=5;a.PARAMETER_RENDERER_HTML_PLACEMENT_TYPE_INLINE="inline";a.PARAMETER_RENDERER_HTML_PLACEMENT_TYPE_INTERSTITIAL=
"interstitial";a.PARAMETER_RENDERER_HTML_BASEUNIT_INTERSTITIAL="app-interstitial";a.ID_TYPE_FW=1;a.ID_TYPE_CUSTOM=2;a.ID_TYPE_GROUP=3;a.VIDEO_STATE_PLAYING=1;a.VIDEO_STATE_PAUSED=2;a.VIDEO_STATE_STOPPED=3;a.VIDEO_STATE_COMPLETED=4;a.VIDEO_ASSET_AUTO_PLAY_TYPE_ATTENDED=1;a.VIDEO_ASSET_AUTO_PLAY_TYPE_UNATTENDED=2;a.VIDEO_ASSET_AUTO_PLAY_TYPE_NONE=3;a.VIDEO_ASSET_AUTO_PLAY_TYPE_NON_AUTO_PLAY=3;a.VIDEO_ASSET_DURATION_TYPE_EXACT="exact";a.VIDEO_ASSET_DURATION_TYPE_VARIABLE="variable";a.ADUNIT_PREROLL=
"preroll";a.ADUNIT_MIDROLL="midroll";a.ADUNIT_POSTROLL="postroll";a.ADUNIT_OVERLAY="overlay";a.ADUNIT_STREAM_PREROLL="stream_preroll";a.ADUNIT_STREAM_POSTROLL="stream_postroll";a.SLOT_LOCATION_PLAYER="player";a.SLOT_LOCATION_EXTERNAL="external";a.SLOT_OPTION_INITIAL_AD_STAND_ALONE=0;a.SLOT_OPTION_INITIAL_AD_KEEP_ORIGINAL=1;a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_ONLY=2;a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_STAND_ALONE=3;a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_THEN_STAND_ALONE=4;a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_NO_STAND_ALONE=
5;a.SLOT_OPTION_INITIAL_AD_NO_STAND_ALONE=6;a.SLOT_OPTION_INITIAL_AD_NO_STAND_ALONE_IF_TEMPORAL=7;a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_NO_STAND_ALONE_IF_TEMPORAL=8;a.REQUEST_MODE_ON_DEMAND="on-demand";a.REQUEST_MODE_LIVE="live";a.MINIMUM_VAST_VERSION_SUPPORTED=2;a.MAXIMUM_VAST_VERSION_SUPPORTED=4;a.ERROR_VAST_XML_PARSING="100";a.ERROR_VAST_SCHEMA_VALIDATION="101";a.ERROR_VAST_VERSION_NOT_SUPPORTED="102";a.ERROR_VAST_TRACKING_ERROR="200";a.ERROR_VAST_LINEARITY_NOT_MATCH="201";a.ERROR_VAST_NO_AD=
"303";a.ERROR_VAST_WRAPPER_LIMIT_REACH="302";a.ERROR_VAST_URI_TIMEOUT="301";a.ERROR_VAST_GENERAL_LINEAR_ERROR="400";a.ERROR_VAST_NON_LINEAR_GENERAL_ERROR="500";a.ERROR_VAST_COMPANION_GENERAL_ERROR="600";a.ERROR_VAST_GENERAL_VPAID_ERROR="901";a.Util={canPlayVideoType:function(b){if(a.PLATFORM_IS_SAFARI&&("video/ogg"==b||"video/webm"==b))return!1;if(1<a.PLATFORM_ANDROID_VERSION&&"video/m4v"==b)return!0;"video/3gp"==b&&(b="video/3gpp");if(3<=a.PLATFORM_ANDROID_VERSION&&"video/3gpp"==b)return!0;var c=
document.createElement("video");return c.canPlayType?!(!c.canPlayType(b)&&!c.canPlayType(b.replace("/","/x-"))):!1},str2bool:function(b){if(!b)return!1;b=a.Util.trim(b).toLowerCase();return"true"==b||"yes"==b||"on"==b||"1"==b},trim:function(a){return"string"!=typeof a?a.toString():a.replace(/^\s+|\s+$/g,"")},isBlank:function(b){return!b||""===a.Util.trim(b)},encodeToHex:function(a){for(var b="",d=0;d<a.length;d++){for(var f=a.charCodeAt(d).toString(16).toUpperCase();4>f.length;)f="0"+f;b+="\\u"+f.toUpperCase()}return b},
forEachOnArray:function(a,c,d){var b;if(null==a)throw new TypeError(" array is null or not defined");a=Object(a);var g=a.length>>>0;if("[object Function]"!={}.toString.call(c))throw new TypeError(c+" is not a function");d&&(b=d);for(d=0;d<g;){if(d in a){var k=a[d];c.call(b,k,d,a)}d++}},mixin:function(a,c){for(var b in c)"undefined"!=typeof c[b]&&(a[b]=c[b]);return a},copy:function(b){return a.Util.mixin({},b)},bind:function(a,c){var b=Array.prototype.slice.call(arguments);b.shift();c=b.shift();return function(){return c.apply(a,
b.concat(Array.prototype.slice.call(arguments)))}},getObject:function(a,c,d){if(!a)return null;a=a.split(".");c=c||window;for(var b=0,g;c&&(g=a[b]);b++)c=g in c?c[g]:d?c[g]={}:void 0;return c},buildNode:function(b,c,d,f,g){a.debug("Util.buildNode");d||(d=document);var k=null!=navigator.userAgent.match(/Firefox/);b.innerHTML=c||"";b=b.getElementsByTagName("script");var h=d.getElementsByTagName("head")[0];for(c=0;c<b.length;++c)if(k||b[c].src){var l=d.createElement("script");b[c].charset&&(l.charset=
b[c].charset);b[c].src&&(l.src=b[c].src);b[c].innerHTML&&(l.innerHTML=b[c].innerHTML);l.onload=l.onreadystatechange=function(){this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||h.removeChild(l)};try{h.appendChild(l)}catch(m){a.warn("load script err: "+m)}}else l=b[c].innerHTML,f&&(l=l.replace(/var fw_scope = document;/,"var fw_scope="+f+";")),g&&(l=l.replace(/var fw_scope_window = window;/,"var fw_scope_window="+g+";")),eval(l)},replacePageSlot:function(b,c,d){a.debug("Util.replacePageSlot("+
Array.prototype.slice.call(arguments).join(",")+")");var f;try{var g=document.getElementById(b)?document:parent.document.getElementById(b)?parent.document:null;var k=document.getElementById(b)?"window":parent.document.getElementById(b)?"parent":null}catch(l){k=g=null}if(!g)for(var h=0;h<window.frames.length;h++)try{window.frames[h].document.getElementById(b)&&(g=window.frames[h].document,k="window.frames["+h+"]")}catch(l){a.warn(l)}k&&(f=k+".document");a.log("replacing slot "+b+" in frame "+f);if(!g)throw"Slot element not found: "+
b;h=d?g.getElementById(d):g.getElementById("_fw_container_"+b);a.Util.buildNode(h,c,g,f,k)},transformUrlToProxy:function(b){if(null===a.proxyUrl)return b;var c=a.proxyUrl.replace("$","$$");b=b.replace(/https?:\/\//,c);a.proxyAuthenticationParameter&&(b=a.Util.setParameterInURL(b,a.proxyAuthenticationParameter.key,a.proxyAuthenticationParameter.value));return b},pingURLWithImage:function(b){(new Image(1,1)).src=a.Util.transformUrlToProxy(b)},pingURLWithForm:function(b,c,d){d=d?"_fw_request":"_fw_cb";
null==c&&(c=Math.random());var f=document.createElement("iframe");f.name=d+"_iframe_"+c;f.id=d+"_iframe_"+c;f.style.position="absolute";f.style.left="-10000px";f.style.width="1px";f.style.visibility="hidden";var g=document.createElement("form");g.action=a.Util.transformUrlToProxy(b);g.id=d+"_form_"+c;g.target=f.id;g.method="post";g.style.position="absolute";g.style.left="-10000px";g.style.width="1px";g.style.visibility="hidden";document.body&&(document.body.appendChild(f),document.body.appendChild(g),
g.submit(),document.body.removeChild(g))},pingURLWithScript:function(b){var c=document.getElementsByTagName("head")[0],d=document.createElement("script");d.src=a.Util.transformUrlToProxy(b);d.onload=d.onreadystatechange=function(){this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||c.removeChild(d)};c.appendChild(d)},pingURL:function(b){a.debug("send callback: "+b);b&&(a.PLATFORM_SEND_REQUEST_BY_FORM?a.Util.pingURLWithForm(b,null,!1):a.Util.pingURLWithImage(b))},pingURLs:function(b){for(var c=
0;c<b.length;c++)a.Util.pingURL(b[c])},setParameterInURL:function(a,c,d){if(!a||!c||null==d)return null;var b=!1;a=a.split("?");d=encodeURIComponent(d);if(a[1]){var g=a[1].split("&");for(var k=0;k<g.length;++k){var h=g[k].split("=");if(h[0]==c){g[k]=h[0]+"="+d;b=!0;break}}h=g.join("&");b||(h=c+"="+d+"&"+h)}else h=c+"="+d;return h=a[0]+"?"+h},getParameterInURL:function(b,c){if(!b||!c)return null;b=b.split("?");if(b[1]){b=b[1].split("&");for(var d=0;d<b.length;++d){var f=b[d].split("=");if(f[0]==c&&
!a.Util.isBlank(f[1]))return decodeURIComponent(f[1])}}return null},isParameterInURL:function(a,c){if(!a||!c)return!1;a=a.split("?");if(a[1]){a=a[1].split("&");for(var b=0;b<a.length;++b)if(a[b].split("=")[0]==c)return!0}return!1},flashVersion:function(){var b="0,0,0,0";if(null!=navigator.plugins&&0<navigator.plugins.length){if(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"])try{var c=navigator.plugins["Shockwave Flash"+(navigator.plugins["Shockwave Flash 2.0"]?" 2.0":
"")].description.split(" "),d=c[2].split("."),f=d[0],g=d[1],k=c[3];""==k&&(k=c[4]);"d"==k[0]?k=k.substring(1):"r"==k[0]&&(k=k.substring(1),0<k.indexOf("d")&&(k=k.substring(0,k.indexOf("d"))));b=f+","+g+","+k+",0"}catch(m){a.warn("Flash detection failed on navigator method")}}else try{var h=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");var l=h.GetVariable("$version").split(" ")[1].split(",");3==l.length?b=l.join(",")+",0":4==l.length&&(b=l.join(","))}catch(m){a.warn("Flash detection failed on ActiveX method")}return b},
xmlToJson:function(b){var c={};if(!b)return null;if(1===b.nodeType){if(0<b.attributes.length){c["@attributes"]={};for(var d=0;d<b.attributes.length;d++){var f=b.attributes.item(d);c["@attributes"][f.nodeName]=f.nodeValue}}}else 3===b.nodeType?c=b.nodeValue:4===b.nodeType&&(c=b.nodeValue);if(b.hasChildNodes()){for(d=0;d<b.childNodes.length;d++){f=b.childNodes.item(d);var g=f.nodeName;if("undefined"===typeof c[g])c[g]=a.Util.xmlToJson(f);else{if("undefined"===typeof c[g].length||"string"===typeof c[g]){var k=
c[g];c[g]=[];c[g].push(k)}c[g].push(a.Util.xmlToJson(f))}}"undefined"!==typeof c["#cdata-section"]?(c.value=c["#cdata-section"],c.value.constructor===Array&&(c.value=c.value.join(""))):c["#text"]&&(c.value=c["#text"])}return c},lazyJavaScriptLoad:function(a,c){var b=document.getElementsByTagName("head")[0]||document.documentElement,f=document.createElement("script");f.type="text/javascript";f.src=a;c&&(f.attachEvent&&!window.opera?f.onreadystatechange=function(){if("loaded"==f.readyState||"complete"==
f.readyState)b.removeChild(f),f.onreadystatechange=null,c()}:f.addEventListener("load",function(){b.removeChild(f);c()},!1));b.insertBefore(f,b.firstChild)},getViewport:function(){var a=0,c=0;"undefined"!==typeof window.innerWidth?(a=window.innerWidth,c=window.innerHeight):"undefined"!==typeof document.documentElement&&"undefined"!==typeof document.documentElement.clientWidth&&0!==document.documentElement.clientWidth?(a=document.documentElement.clientWidth,c=document.documentElement.clientHeight):
document.getElementsByTagName("body")&&document.getElementsByTagName("body")[0]&&(a=document.getElementsByTagName("body")[0].clientWidth,c=document.getElementsByTagName("body")[0].clientHeight);return{width:a,height:c,offsetX:window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,offsetY:window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop}},getAbsoluteUrl:function(b,c){b=a.Util.trim(b);c=a.Util.trim(c);if(-1!==c.indexOf("://"))return c;var d=
b.substring(0,b.indexOf("://"));if(0===c.indexOf("//"))return d+":"+c;d=b.indexOf("/",b.indexOf("://")+5);var f=b;-1!==d&&(f=b.substring(0,d));if(0==c.indexOf("/"))return f+c;d=b.lastIndexOf("#");f=b;-1!==d&&(f=b.substring(0,d));if(0==c.indexOf("#"))return f+c;f=b.indexOf("?");d=b;-1!==f&&(d=b.substring(0,f));if(0==c.indexOf("?"))return d+c;f=-1===f?b.lastIndexOf("/"):d.lastIndexOf("/");d=-1!==f?b.substring(0,f+1):d+"/";return d+c},secondsToHms:function(a){a=isNaN(Number(a))?0:Number(a);var b=Math.floor(a%
3600/60),d=Math.round(a%3600%60);return("0"+Math.floor(a/3600)).slice(-2)+":"+("0"+b).slice(-2)+":"+("0"+d).slice(-2)},getFixedDigitRandomNumber:function(a){a=isNaN(Number(a))?0:Number(a);return Math.floor(9*Math.random()*Math.pow(10,a-1)+Math.pow(10,a-1))},getDateStringInISOFormat:function(a){return a instanceof Date&&!isNaN(a.valueOf())?a.toISOString():null}};a.MediaState=function(){};a.MediaState.prototype={};a.MediaState.prototype.constructor=a.MediaState;a.Util.mixin(a.MediaState.prototype,{play:function(b){a.debug(this._name+
" play("+b+")")},pause:function(b){a.debug(this._name+" pause("+b+")")},complete:function(b){a.debug(this._name+" complete("+b+")")}});a.MediaInitState=function(){this._name="MediaInitState"};a.MediaInitState.prototype=new a.MediaState;a.MediaInitState.prototype.constructor=a.MediaInitState;a.Util.mixin(a.MediaInitState.prototype,{play:function(b){a.debug(this._name+" play("+b+")");b.setMediaState(a.MediaPlayingState.instance);if("function"===typeof b.onStartPlaying)b.onStartPlaying()}});a.MediaInitState.instance=
new a.MediaInitState;a.MediaPlayingState=function(){this._name="MediaPlayingState"};a.MediaPlayingState.prototype=new a.MediaState;a.MediaPlayingState.prototype.constructor=a.MediaPlayingState;a.Util.mixin(a.MediaPlayingState.prototype,{pause:function(b){a.debug(this._name+" pause("+b+")");b.setMediaState(a.MediaPausedState.instance);if("function"===typeof b.onPausePlaying)b.onPausePlaying()},complete:function(b){a.debug(this._name+" complete("+b+")");b.setMediaState(a.MediaEndState.instance);if("function"===
typeof b.onCompletePlaying)b.onCompletePlaying()}});a.MediaPlayingState.instance=new a.MediaPlayingState;a.MediaPausedState=function(){this._name="MediaPausedState"};a.MediaPausedState.prototype=new a.MediaState;a.MediaPausedState.prototype.constructor=a.MediaPausedState;a.Util.mixin(a.MediaPausedState.prototype,{play:function(b){a.debug(this._name+" play("+b+")");b.setMediaState(a.MediaPlayingState.instance);if("function"===typeof b.onResumePlaying)b.onResumePlaying()},complete:function(b){a.debug(this._name+
" complete("+b+")");b.setMediaState(a.MediaEndState.instance);if("function"===typeof b.onCompletePlaying)b.onCompletePlaying()}});a.MediaPausedState.instance=new a.MediaPausedState;a.MediaReplayingState=function(){this._name="MediaReplayingState"};a.MediaReplayingState.prototype=new a.MediaState;a.MediaReplayingState.prototype.constructor=a.MediaReplayingState;a.Util.mixin(a.MediaReplayingState.prototype,{pause:function(b){a.debug(this._name+" pause("+b+")");b.setMediaState(a.MediaReplayPausedState.instance);
if("function"===typeof b.onPausePlaying)b.onPausePlaying()},complete:function(b){a.debug(this._name+" complete("+b+")");b.setMediaState(a.MediaEndState.instance);if("function"===typeof b.onCompleteReplaying)b.onCompleteReplaying()}});a.MediaReplayingState.instance=new a.MediaReplayingState;a.MediaReplayPausedState=function(){this._name="MediaReplayPausedState"};a.MediaReplayPausedState.prototype=new a.MediaState;a.MediaReplayPausedState.prototype.constructor=a.MediaReplayPausedState;a.Util.mixin(a.MediaReplayPausedState.prototype,
{play:function(b){a.debug(this._name+" play("+b+")");b.setMediaState(a.MediaReplayingState.instance);if("function"===typeof b.onResumePlaying)b.onResumePlaying()},complete:function(b){a.debug(this._name+" complete("+b+")");b.setMediaState(a.MediaEndState.instance);if("function"===typeof b.onCompleteReplaying)b.onCompleteReplaying()}});a.MediaReplayPausedState.instance=new a.MediaReplayPausedState;a.MediaEndState=function(){this._name="MediaEndState"};a.MediaEndState.prototype=new a.MediaState;a.MediaEndState.prototype.constructor=
a.MediaEndState;a.Util.mixin(a.MediaEndState.prototype,{play:function(b){a.debug(this._name+" play("+b+")");b.setMediaState(a.MediaReplayingState.instance);if("function"===typeof b.onStartReplaying)b.onStartReplaying()}});a.MediaEndState.instance=new a.MediaEndState;a.RendererState=function(){};a.RendererState.prototype={};a.RendererState.prototype.constructor=a.RendererState;a.Util.mixin(a.RendererState.prototype,{start:function(b){a.debug(this._name+" start()")},notifyStarted:function(b){a.debug(this._name+
" notifyStarted()")},stop:function(b){a.debug(this._name+" stop()")},complete:function(b){a.debug(this._name+" complete()")},notifyCompleted:function(b){a.debug(this._name+" notifyCompleted()")},fail:function(b){a.debug(this._name+" fail()");b.setRendererState(a.RendererFailedState.instance);b.getAdInstance().complete()}});a.RendererInitState=function(){this._name="RendererInitState"};a.RendererInitState.prototype=new a.RendererState;a.RendererInitState.prototype.constructor=a.RendererInitState;a.RendererInitState.instance=
new a.RendererInitState;a.Util.mixin(a.RendererInitState.prototype,{start:function(b){a.debug(this._name+" start()");b.setRendererState(a.RendererStartingState.instance);b.getRenderer().start(b)},stop:function(b){a.debug(this._name+" stop()");b.setRendererState(a.RendererCompletingState.instance);b.getRendererState().notifyCompleted(b)}});a.RendererStartingState=function(){this._name="RendererStartingState"};a.RendererStartingState.prototype=new a.RendererState;a.RendererStartingState.prototype.constructor=
a.RendererStartingState;a.RendererStartingState.instance=new a.RendererStartingState;a.Util.mixin(a.RendererStartingState.prototype,{notifyStarted:function(b){a.debug(this._name+" notifyStarted()");b.setRendererState(a.RendererStartedState.instance);b.getAdInstance().play()},stop:function(b){a.debug(this._name+" stop()");"function"===typeof b.getRenderer().stop&&(b.setRendererState(a.RendererCompletingState.instance),b.getRenderer().stop())}});a.RendererStartedState=function(){this._name="RendererStartedState"};
a.RendererStartedState.prototype=new a.RendererState;a.RendererStartedState.prototype.constructor=a.RendererStartedState;a.RendererStartedState.instance=new a.RendererStartedState;a.Util.mixin(a.RendererStartedState.prototype,{complete:function(b){a.debug(this._name+" complete()");b.setRendererState(a.RendererCompletingState.instance)},stop:function(b){a.debug(this._name+" stop()");"function"===typeof b.getRenderer().stop&&(b.setRendererState(a.RendererCompletingState.instance),!1===b.getRenderer().stop()&&
b.getAdInstance().fakeComplete())}});a.RendererCompletingState=function(){this._name="RendererCompletingState"};a.RendererCompletingState.prototype=new a.RendererState;a.RendererCompletingState.prototype.constructor=a.RendererCompletingState;a.RendererCompletingState.instance=new a.RendererCompletingState;a.Util.mixin(a.RendererCompletingState.prototype,{notifyCompleted:function(b){a.debug(this._name+" notifyCompleted()");b.setRendererState(a.RendererCompletedState.instance);b.getAdInstance().complete()}});
a.RendererCompletedState=function(){this._name="RendererCompletedState"};a.RendererCompletedState.prototype=new a.RendererState;a.RendererCompletedState.prototype.constructor=a.RendererCompletedState;a.RendererCompletedState.instance=new a.RendererCompletedState;a.RendererFailedState=function(){this._name="RendererFailedState"};a.RendererFailedState.prototype=new a.RendererState;a.RendererFailedState.prototype.constructor=a.RendererFailedState;a.RendererFailedState.instance=new a.RendererFailedState;
a.HTMLRenderer=function(){};a.HTMLRenderer.prototype={start:function(b){this.rendererController=b;b.getAdInstance().getSlot().getBase()?this._setupParameters()&&(this._render(),b.handleStateTransition(a.RENDERER_STATE_STARTED)):this._onRendererFailed(a.ERROR_INVALID_SLOT,"slot base is empty")},pause:function(){this.log("pause");this.shouldEndAfterDuration&&this.timer&&this.timer.pause()},resume:function(){this.log("resume");this.shouldEndAfterDuration&&this.timer&&this.timer.start()},stop:function(){this.log("stop isMRAIDAd:"+
this.isMRAIDAd+" tpc:"+this._tpc+" interstitial:"+this.shouldKeepInterstitial);return this._stop()},_stop:function(){this.log("_stop isMRAIDAd:"+this.isMRAIDAd+" tpc:"+this._tpc+" interstitial:"+this.shouldKeepInterstitial);if(this.isMRAIDAd||this._tpc!=a.TIME_POSITION_CLASS_DISPLAY||this.shouldKeepInterstitial)this._cleanup(),this.rendererController.handleStateTransition(a.RENDERER_STATE_COMPLETED);else return!1},resize:function(){var b=this.rendererController.getAdInstance(),c=b.getSlot().getBase();
b.getSlot().getTimePositionClass()==a.TIME_POSITION_CLASS_OVERLAY?!this.isMRAIDAd||this.isMRAIDAd&&this.mraid.state==this.mraid.STATEDEFAULT?(b="_fw_ad_container_html_"+b.getSlot().getCustomId()+"_",b=document.getElementById(b),b.style.width=c.style.width||"100%",b.style.height=c.style.height||"100%",this._layoutOverlayAd(this.defaultAdElement)):this.log("Cannot resize an MRAID ad that is not in the default state"):this.log("Cannot resize a non-overlay ad")},_cleanup:function(){this.log("_cleanup");
this.timer&&(this.timer.stop(),this.timer=null);this.adLoadTimeoutTimer&&(this.adLoadTimeoutTimer.stop(),this.adLoadTimeoutTimer=null);window.removeEventListener?(document.removeEventListener("touchmove",this.touchMoveDisabler,!1),window.removeEventListener("message",this.messageHandlerFunc,!1),window.removeEventListener("resize",this.viewportChangeFunc,!1),window.removeEventListener("scroll",this.viewportChangeFunc,!1)):window.detachEvent&&(window.detachEvent("onmessage",this.messageHandlerFunc),
window.detachEvent("onresize",this.viewportChangeFunc),window.detachEvent("onscroll",this.viewportChangeFunc));if(this.isMRAIDAd&&(this.mraid.inExpandedState()&&(this.log("stopping with expanded state, invoke close()"),this._mraidClose()),this.mraid.inDefaultState())){this.log("stopping with default state, invoke close()");this._mraidClose();return}if(this.expandedAdElement){var a=this.expandedAdElement.parentNode;this.expandedAdElement._fw_closeButton&&a.removeChild(this.expandedAdElement._fw_closeButton);
a.removeChild(this.expandedAdElement);this.expandedAdElement===this.defaultAdElement&&(this.defaultAdElementContainer===this.defaultAdElement&&(this.defaultAdElementContainer=null),this.defaultAdElement=null);this.expandedAdElement=null}this.expandedLightbox&&(a=this.expandedLightbox.parentNode,a.removeChild(this.expandedLightbox),this.expandedLightbox=null);this.rendererController.getAdInstance().getSlot().getTimePositionClass();if(this.defaultAdElement){a=this.defaultAdElement.parentNode;var c=
this.defaultAdElement;c.style.display="none";a!==this.rendererController.getAdInstance().getSlot().getBase()&&window.setTimeout(function(){for(var b=a&&a.childNodes||[],f=0;f<b.length;f++){var g=b[f];g===c&&a.removeChild(g)}},200);this.defaultAdElementContainer===this.defaultAdElement&&(this.defaultAdElementContainer=null);this.defaultAdElement=null}this.defaultAdElementContainer&&(a=this.defaultAdElementContainer.parentNode,a.removeChild(this.defaultAdElementContainer),this.defaultAdElementContainer=
null);(this.shouldPauseContentWhenStart||this.isInterstitialNow&&!this.isMRAIDAd)&&this.rendererController.requestContentStateChange(!1)},_setupParameters:function(){var b=this.rendererController,c=b.getAdInstance(),d=c.getSlot().getTimePositionClass();this._tpc=d;var f=c.getActiveCreativeRendition();c=f.getBaseUnit();f=f.getCreativeApi();var g;if(a.PLATFORM_NOT_SUPPORT_OVERLAY_AD&&d===a.TIME_POSITION_CLASS_OVERLAY)return this._onRendererFailed(a.ERROR_DEVICE_LIMIT,"Overlay not supported on this device."),
!1;if(a.PLATFORM_NOT_SUPPORT_MIDROLL_AD&&(d===a.TIME_POSITION_CLASS_MIDROLL||d===a.TIME_POSITION_CLASS_PAUSE_MIDROLL))return this._onRendererFailed(a.ERROR_DEVICE_LIMIT,"Midroll, pause_midroll not supported on this device."),!1;if(a.PLATFORM_IS_IPHONE_IPOD)switch(d){case a.TIME_POSITION_CLASS_MIDROLL:case a.TIME_POSITION_CLASS_PAUSE_MIDROLL:case a.TIME_POSITION_CLASS_OVERLAY:return this._onRendererFailed(a.ERROR_DEVICE_LIMIT,"Midroll, pause_midroll and overlay ads are not supported on iPod, iPhone."),
!1;case a.TIME_POSITION_CLASS_PREROLL:case a.TIME_POSITION_CLASS_POSTROLL:b.setCapability(a.EVENT_AD_CLICK,a.CAPABILITY_STATUS_OFF)}this.adLoadTimeout=5;if(g=b.getParameter(a.PARAMETER_RENDERER_HTML_AD_LOAD_TIMEOUT))this.adLoadTimeout=0<Number(g)?Number(g):this.adLoadTimeout;this.shouldKeepInterstitial=!1;(g=b.getParameter(a.PARAMETER_RENDERER_HTML_PLACEMENT_TYPE))?this.shouldKeepInterstitial=g===a.PARAMETER_RENDERER_HTML_PLACEMENT_TYPE_INTERSTITIAL:"string"===typeof c&&(this.shouldKeepInterstitial=
c.toLowerCase()===a.PARAMETER_RENDERER_HTML_BASEUNIT_INTERSTITIAL);this.isInterstitialNow=this.shouldKeepInterstitial;this.shouldPauseContentWhenStart=!1;this.shouldPauseContentWhenExpandOrClick=!this.shouldKeepInterstitial&&(d===a.TIME_POSITION_CLASS_DISPLAY||d===a.TIME_POSITION_CLASS_OVERLAY);this.shouldBackgroundTransparent=!1;g=b.getParameter(a.PARAMETER_RENDERER_HTML_SHOULD_BACKGROUND_TRANSPARENT);"undefined"!==typeof g&&null!==g&&(this.shouldBackgroundTransparent=a.Util.str2bool(g));this.shouldEndAfterDuration=
d!==a.TIME_POSITION_CLASS_DISPLAY||this.shouldKeepInterstitial;g=b.getParameter(a.PARAMETER_RENDERER_HTML_SHOULD_END_AFTER_DURATION);"undefined"!==typeof g&&null!==g&&(this.shouldEndAfterDuration=a.Util.str2bool(g));this.coadScriptName=b.getParameter(a.PARAMETER_RENDERER_DISPLAY_COAD_SCRIPT_NAME);this.coadScriptName||(this.coadScriptName=b.getParameter("coad_script_name"));this.primaryAnchor=b.getParameter(a.PARAMETER_RENDERER_HTML_PRIMARY_ANCHOR)||"bc";this.marginWidth=b.getParameter(a.PARAMETER_RENDERER_HTML_MARGIN_WIDTH)||
0;this.marginHeight=b.getParameter(a.PARAMETER_RENDERER_HTML_MARGIN_HEIGHT)||0;this.bootstrap=b.getParameter(a.PARAMETER_RENDERER_HTML_BOOTSTRAP);c=a.Util.getViewport();this.defaultExpandWidth=c.width;this.defaultExpandHeight=c.height;this.isMRAIDAd="MRAID-1.0"===f;this.mraid=new function(b){this.STATELOADING="loading";this.STATEDEFAULT="default";this.STATEEXPANDED="expanded";this.STATEHIDDEN="hidden";this._renderer=b;this._state=this.STATELOADING;this._useCustomClose=!1;this.viewable=this.expandIsModal=
!0;this._baseUrlExpanded=this._baseUrlDefault="";b=Object.defineProperty||function(a,b,c){c.get&&a.__defineGetter__(b,c.get);c.set&&a.__defineSetter__(b,c.set)};b(this,"baseUrl",{get:function(){return this.inExpandedState()?this._baseUrlExpanded||this._baseUrlDefault:this._baseUrlDefault},set:function(a){this.inExpandedState()?this._baseUrlExpanded=a:(this._baseUrlDefault=a,this._baseUrlExpanded="")}});b(this,"useCustomClose",{get:function(){return this._useCustomClose},set:function(a){this._useCustomClose===
!a&&(this._useCustomClose=!!a,this.pushData())}});b(this,"placementType",{get:function(){return this._renderer.shouldKeepInterstitial?"interstitial":"inline"}});b(this,"expandWidth",{get:function(){return this._renderer.requestedExpandWidth&&this._renderer.requestedExpandWidth<this._renderer.defaultExpandWidth?this._renderer.requestedExpandWidth:this._renderer.defaultExpandWidth}});b(this,"expandHeight",{get:function(){return this._renderer.requestedExpandHeight&&this._renderer.requestedExpandHeight<
this._renderer.defaultExpandHeight?this._renderer.requestedExpandHeight:this._renderer.defaultExpandHeight}});b(this,"state",{get:function(){return this._state},set:function(b){this.log("mraid.state change "+this.state+" => "+b);this.state!==b&&(this._renderer.shouldPauseContentWhenExpandOrClick&&(b===this.STATEEXPANDED?this._renderer.rendererController.requestContentStateChange(!0):this.inExpandedState()&&this._renderer.rendererController.requestContentStateChange(!1)),b===this.STATEEXPANDED?(this._renderer.expandedAdElement?
this._renderer.rendererController.processEvent({name:a.EVENT_AD_ACCEPT_INVITATION}):(this._renderer.expandedAdElement=this._renderer.defaultAdElement,this._renderer.rendererController.processEvent({name:a.EVENT_AD_EXPAND})),this._renderer.presentInterstitial(),this._renderer.shouldEndAfterDuration&&this._renderer.timer.pause()):b===this.STATEDEFAULT&&(this._renderer.shouldKeepInterstitial?(this._renderer.expandedAdElement=this._renderer.defaultAdElement,this._renderer.presentInterstitial()):(this.inExpandedState()&&
(this._renderer.expandedAdElement!==this._renderer.defaultAdElement?this._renderer.rendererController.processEvent({name:a.EVENT_AD_CLOSE}):this._renderer.rendererController.processEvent({name:a.EVENT_AD_COLLAPSE})),this._renderer.expandedAdElement=null,this._renderer.presentInline()),this._renderer.shouldEndAfterDuration&&this._renderer.timer.start()),this._state=b,this.pushData(),b===this.STATEHIDDEN&&this._renderer.stop())}});this.inLoadingState=function(){return this.state===this.STATELOADING};
this.inDefaultState=function(){return this.state===this.STATEDEFAULT};this.inExpandedState=function(){return this.state===this.STATEEXPANDED};this.inHiddenState=function(){return this.state===this.STATEHIDDEN};this.pushData=function(){var a='mraid._Update("'+this.state+'", '+this.viewable+', "'+this.placementType+'", '+this.expandWidth+", "+this.expandHeight+", "+this.useCustomClose+", "+this.expandIsModal+")";this.log("mraid.pushData: going to invoke on iframe with "+a);this._renderer.defaultAdElement?
(this._renderer.defaultAdElement.contentWindow.postMessage("fwsdk-bounce:"+a,"*"),this._renderer.expandedAdElement&&this._renderer.expandedAdElement!==this._renderer.defaultAdElement&&this._renderer.expandedAdElement.contentWindow.postMessage("fwsdk-bounce:"+a,"*")):this.warn("_mraidPushData: no iframe suitable to send "+a)};this.log=function(a){this._renderer.log(a)};this.warn=function(a){this._renderer.warn(a)}}(this);this.onLoadFunc=a.Util.bind(this,function(){this.adLoadTimeoutTimer&&(this.adLoadTimeoutTimer.stop(),
this.adLoadTimeoutTimer=null);this.timer&&this.shouldEndAfterDuration&&this.timer.start()});this.touchMoveDisabler=function(a){a.preventDefault()};this.log("setting parameters, adLoadTimeout: "+this.adLoadTimeout+", isMRAIDAd: "+this.isMRAIDAd+", shouldKeepInterstitial: "+this.shouldKeepInterstitial+", shouldEndAfterDuration: "+this.shouldEndAfterDuration+", shouldPauseContentWhenStart: "+this.shouldPauseContentWhenStart+", shouldPauseContentWhenExpandOrClick: "+this.shouldPauseContentWhenExpandOrClick+
", shouldBackgroundTransparent: "+this.shouldBackgroundTransparent+", defaultExpandWidth: "+this.defaultExpandWidth+", defaultExpandHeight: "+this.defaultExpandHeight+", coadScriptName: "+this.coadScriptName+", primaryAnchor: "+this.primaryAnchor+", marginWidth: "+this.marginWidth+", marginHeight: "+this.marginHeight+", bootstrap: "+this.bootstrap);if(!this.shouldKeepInterstitial)!this.isMRAIDAd||a.PLATFORM_IS_IPHONE_IPOD&&d!==a.TIME_POSITION_CLASS_DISPLAY||(b.setCapability(a.EVENT_AD_ACCEPT_INVITATION,
a.CAPABILITY_STATUS_ON),b.setCapability(a.EVENT_AD_CLOSE,a.CAPABILITY_STATUS_ON),b.setCapability(a.EVENT_AD_COLLAPSE,a.CAPABILITY_STATUS_ON),b.setCapability(a.EVENT_AD_EXPAND,a.CAPABILITY_STATUS_ON));else if(d===a.TIME_POSITION_CLASS_OVERLAY)return this._onRendererFailed(a.ERROR_INVALID_SLOT,"Interstitial ad is not supported in overlay slot."),!1;return!0},_render:function(){this.log("_render");var b=this.rendererController.getAdInstance(),c=b.getSlot(),d=c.getTimePositionClass(),f=c.getBase(),g=
b.getActiveCreativeRendition(),k=g.getDuration(),h=g.getPrimaryCreativeRenditionAsset();b=h.getUrl();var l=h.getContent();d===a.TIME_POSITION_CLASS_DISPLAY&&(f.innerHTML="");this.timer=new a.Timer(k,a.Util.bind(this,this._stop));if(this.coadScriptName&&"function"===typeof window[this.coadScriptName])this.defaultAdElement=window[this.coadScriptName](l,b,g.getHeight(),g.getWidth(),h.getMimeType(),c.getCustomId()),this.timer&&this.shouldEndAfterDuration&&this.timer.start();else if(k=document.createElement("span"),
k.id="_fw_ad_container_html_"+c.getCustomId()+"_",k.style.position="relative"===f.style.position?"absolute":"relative",k.style.display="inline-block",k.style.margin="0px",k.style.padding="0px",k.style.width=f.style.width||"100%",k.style.height=f.style.height||"100%",k.style.top=k.style.left="0px",f.appendChild(k),this.defaultAdElementContainer=k,b||l){if("text/html_lit_nowrapper"==g.getContentType()||"text/html_lit_js_wc_nw"==g.getContentType()){if(this.isMRAIDAd||this.isInterstitialNow){this._onRendererFailed(a.ERROR_INVALID_VALUE,
"");this._stop();return}if(!l){this._onRendererFailed(a.ERROR_NULL_ASSET,"Empty content");this._stop();return}this.defaultAdElement=k;this.defaultAdElement.innerHTML=l;c=this.defaultAdElement.getElementsByTagName("script");var m=document.getElementsByTagName("head")[0];for(f=0;f<c.length;++f)if(c[f].src){var q=document.createElement("script");c[f].charset&&(q.charset=c[f].charset);c[f].src&&(q.src=c[f].src);c[f].innerHTML&&(q.innerHTML=c[f].innerHTML);q.onload=q.onreadystatechange=function(){this.readyState&&
"loaded"!=this.readyState&&"complete"!=this.readyState||m.removeChild(q)};m.appendChild(q)}else q=c[f].innerHTML,eval(q);this.presentInline();this.onLoadFunc();return}g=document.createElement("iframe");g.id="_fw_ad_container_iframe_"+c.getCustomId()+"_"+Math.random();g.attachEvent?g.attachEvent("onload",this.onLoadFunc):g.onload=this.onLoadFunc;this.defaultAdElement=g;this.defaultAdElementContainer.appendChild(g);this._fillAdNode(g,b,l);this.isMRAIDAd&&(this.adLoadTimeoutTimer=new a.Timer(this.adLoadTimeout,
a.Util.bind(this,function(){this._onRendererFailed(a.ERROR_TIMEOUT,"Loading MRAID Ad timed out");d!==a.TIME_POSITION_CLASS_DISPLAY?this.isMRAIDAd&&!this.mraid.inLoadingState()?this._mraidClose():this._stop():this._stop()})),this.adLoadTimeoutTimer.start())}else{this._onRendererFailed(a.ERROR_NULL_ASSET,"Empty URL and empty content");this._stop();return}this.defaultAdElement||(c=f.getElementsByTagName("iframe"))&&0<c.length&&(this.defaultAdElement=c[c.length-1]);this.defaultAdElement?(this.defaultAdElement.frameBorder=
"0",this.shouldBackgroundTransparent&&(this.defaultAdElement.allowTransparency="true",this.defaultAdElement.style["background-color"]="rgba(255,255,255,0)"),this.isInterstitialNow?(this.expandedAdElement=this.defaultAdElement,this.presentInterstitial()):this.presentInline(),this.messageHandlerFunc=a.Util.bind(this,this._onWindowMessageReceived),this.viewportChangeFunc=a.Util.bind(this,function(){this.viewportChangeFuncTimer&&window.clearTimeout(this.viewportChangeFuncTimer);this.viewportChangeFuncTimer=
window.setTimeout(a.Util.bind(this,this._onViewportResizeScroll),200)}),window.addEventListener?(window.addEventListener("message",this.messageHandlerFunc,!1),window.addEventListener("resize",this.viewportChangeFunc,!1),window.addEventListener("scroll",this.viewportChangeFunc,!1)):window.attachEvent&&(window.attachEvent("onmessage",this.messageHandlerFunc),window.attachEvent("onresize",this.viewportChangeFunc),window.attachEvent("onscroll",this.viewportChangeFunc))):this.isMRAIDAd&&(this._onRendererFailed(a.ERROR_UNKNOWN,
"Failed to find iframe in slotBase for MRAID ad"),this._stop())},_layoutOverlayAd:function(a){this.log("_layoutOverlayAd");var b=this.rendererController.getAdInstance(),d=b.getSlot(),f=d.getVideoDisplaySize().width;d=d.getVideoDisplaySize().height;var g=b.getActiveCreativeRendition();b=g.getWidth()||240;g=g.getHeight()||50;a.style.width=Math.min(b,f)+"px";a.style.height=Math.min(g,d)+"px";a.style.left=a.style.top=a.style.right=a.style.bottom="";switch(this.primaryAnchor){case "tl":case "lt":a.style.top=
this.marginHeight+"px";a.style.left=this.marginWidth+"px";break;case "tr":case "rt":a.style.top=this.marginHeight+"px";a.style.right=this.marginWidth+"px";break;case "bl":case "lb":a.style.bottom=this.marginHeight+"px";a.style.left=this.marginWidth+"px";break;case "br":case "rb":a.style.bottom=this.marginHeight+"px";a.style.right=this.marginWidth+"px";break;case "tc":case "ct":a.style.top=this.marginHeight+"px";a.style.left=.5*Math.max(0,f-b)+"px";break;case "lm":case "ml":a.style.left=this.marginWidth+
"px";a.style.top=.5*Math.max(0,d-g)+"px";break;case "rm":case "mr":a.style.right=this.marginWidth+"px";a.style.top=.5*Math.max(0,d-g)+"px";break;case "mc":case "cm":case "c":case "m":a.style.left=.5*Math.max(0,f-b)+"px";a.style.top=.5*Math.max(0,d-g)+"px";break;default:case "bc":case "cb":a.style.bottom=this.marginHeight+"px",a.style.left=.5*Math.max(0,f-b)+"px"}},_fillAdNode:function(b,c,d){this.log("_fillAdNode, url:"+c+", content:"+(d?"<omited>":"<empty>"));if(c)b.src=c;else if(d)b=b.contentWindow?
b.contentWindow.document:b.contentDocument.document?b.contentDocument.document:b.contentDocument,b.open(),b.write(d),b.close();else return this._onRendererFailed(a.ERROR_NULL_ASSET,"Empty URL and content"),!1;return!0},presentInline:function(){this.log("presentInline");this.isInterstitialNow=!1;var b=this.defaultAdElement;if(b){var c=this.rendererController.getAdInstance(),d=c.getSlot(),f=d.getTimePositionClass(),g=d.getWidth(),k=d.getHeight(),h=d.getVideoDisplaySize().width;d=d.getVideoDisplaySize().height;
var l=c.getActiveCreativeRendition();c=l.getWidth();l=l.getHeight();b.scrolling="no";b.style.overflow="hidden";switch(f){case a.TIME_POSITION_CLASS_DISPLAY:b.style.position="";b.style.background=this.shouldBackgroundTransparent?"transparent":"";b.style.left="0px";b.style.top="0px";b.style.width=(c?c:g)+"px";b.style.height=(l?l:k)+"px";break;case a.TIME_POSITION_CLASS_OVERLAY:b.style.position="absolute";b.style.background=this.shouldBackgroundTransparent?"transparent":"white";this._layoutOverlayAd(b);
break;default:b.style.position="absolute",b.style.background=this.shouldBackgroundTransparent?"transparent":"white",b.style.left="0px",b.style.top="0px",b.style.width=h+"px",b.style.height=d+"px"}}},presentInterstitial:function(){this.log("presentInterstitial, defaultExpandWidth: "+this.defaultExpandWidth+", defaultExpandHeight: "+this.defaultExpandHeight+", this.mraid.expandWidth: "+this.mraid.expandWidth+", this.mraid.expandHeight: "+this.mraid.expandHeight+", (Math.max(0, this.defaultExpandWidth - this.mraid.expandWidth) / 2) = "+
Math.max(0,this.defaultExpandWidth-this.mraid.expandWidth)/2+", (Math.max(0, this.defaultExpandHeight - this.mraid.expandHeight) / 2) = "+Math.max(0,this.defaultExpandHeight-this.mraid.expandHeight)/2);if(this.expandedAdElement){this.isInterstitialNow=!0;document.addEventListener&&(document.removeEventListener("touchmove",this.touchMoveDisabler,!1),document.addEventListener("touchmove",this.touchMoveDisabler,!1));var b=this.expandedAdElement.parentNode;this.expandedLightbox||(this.expandedLightbox=
document.createElement("div"),this.expandedLightbox.style.background="black",this.expandedLightbox.style.opacity=.8,this.expandedLightbox.style.position="fixed",this.expandedLightbox.style.top="0px",this.expandedLightbox.style.left="0px",this.expandedLightbox.style.zIndex=this.expandedLightbox.style["z-index"]=9999,b.appendChild(this.expandedLightbox));this.expandedLightbox.style.width=this.defaultExpandWidth+"px";this.expandedLightbox.style.height=this.defaultExpandHeight+"px";this.expandedAdElement.frameBorder=
"0";this.expandedAdElement.scrolling="no";this.expandedAdElement.style.position="fixed";this.expandedAdElement.style.overflow="hidden";this.expandedAdElement.style.top=this.expandedAdElement.top=Math.max(0,this.defaultExpandHeight-this.mraid.expandHeight)/2+"px";this.expandedAdElement.style.left=this.expandedAdElement.left=Math.max(0,this.defaultExpandWidth-this.mraid.expandWidth)/2+"px";this.expandedAdElement.style.width=this.expandedAdElement.width=this.mraid.expandWidth+"px";this.expandedAdElement.style.height=
this.expandedAdElement.height=this.mraid.expandHeight+"px";this.expandedAdElement.style.zIndex=this.expandedAdElement.style["z-index"]=1E4;this.log("presentInterstitial, expanded ad element size: (top, left, width, height) = ("+this.expandedAdElement.top+", "+this.expandedAdElement.left+", "+this.expandedAdElement.width+", "+this.expandedAdElement.height+")");if(this.isMRAIDAd){var c=this.expandedAdElement._fw_closeButton;c||(c=document.createElement("div"),c.addEventListener?c.addEventListener("click",
a.Util.bind(this,function(){this._mraidClose()})):c.attachEvent&&c.attachEvent("onclick",a.Util.bind(this,function(){this._mraidClose()})),c.style.position="fixed",c.style.margin="0px",c.style.padding="0px",c.style.width="25px",c.style.height="25px",c.style.zIndex=c.style["z-index"]=10001,b.appendChild(c),this.expandedAdElement._fw_closeButton=c);c.style.top=this.expandedAdElement.style.top;c.style.left=Math.max(0,this.defaultExpandWidth-this.mraid.expandWidth)/2+this.mraid.expandWidth-25+"px";c.innerHTML=
this.mraid.useCustomClose?0<a.PLATFORM_ANDROID_VERSION?"   ":"":0<a.PLATFORM_ANDROID_VERSION&&3>=a.PLATFORM_ANDROID_VERSION?'<img style="width:25px; height:25px; border:0" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA4xJREFUeNrMmjFv2kAUxw/IUAZUw4AqJjIxMAQJ9sIHgDYLUqfSBTowJBudAmOnNCNeAitLyVgxxNlBgk+QTKgb6UQHhr7nniNj8PmM3zk86XQZOPt+ee/e+9+dI4zQms1mGTpsb6EVXH42h/YHmqHrukH17kjAiWvQfYT2gfeH2BjaHfYA9hwqCABkobvik9eI/qkIMYB2A0BPSkG4By44hErrQfvhx0MRn/F/Cy3LwjH0yhfZdRSThOhyCI2FZ/iuRrFYjMxmMyMwCEDc8nB6LSsDTBZg7g4GAYj7ANmI0gpeMDEPTxwDhBRMzAXiGrqv7PgMYTSA+eWZtQACvfCTHbedQzYbu4LwOvHolp3q9TorlUpsuVyyfr/P1us16ezi8TirVqtmP5lMzPcIiuepvc5EHT+4doPIZDImhPV3q9UyX0hl+MxOp2O+I5/Ps1qt5pWat4py1CE7Gm4jnf99Sph9z5Lw9gWf845HhLJjtVqx0WhEDuMGgaElYVdbWYuTDbxGYcwiELreskQiwXK5HFssFmyz2ZBA4PoTrA9nFhtCFnu2PCJdL6bTKYlnCCCYfe4WyGc/I4PCEEK8zD3Cw+rxkPjGDIMp2Rl+otRMDGHZaZRvTQ8yv55RBGEKSwQ5C/IEWRiFEGhnMVj1naCbJa9slk6nVUKg/T2h2iyhZywZ4/RCMplUCWFW+hPBsQ0ZjFMhEEOY9SRKLUv3rRnFEHtFI4nhRPelX1xH2FQYOYjf9EsJ8qQSQqVqth8dkYGI6oQK1awExKvYUQlNL5CFSghq1exiCwQxVEOEAGPEYFPyG2QKniS+CWNTRL05w7DSdf2blX7HYe7siD0ztteRm7B3doQww5c9Ow+vspcKRvHXbrfJBCBBmOH13XdnZe95jcKzJmoVK/KMhPV2JAq/UDG8TgJVCEA3GAlvGG5a61JGpmM4UKtYJ4zEs7fmuu8Qu8vU3xEK12EqlXJV0FZIgTe6QhAOcx/kUEKxYUhVZGX8Oft/sX9sNudz2zHXW13wCm6B71m4F6AiwyuECnhj7mtjxQdUKPcrQdStCELoEZtnNO6ZwiuGU8Xr4wE/HwzgJVDY19T49cOlzA9jsk/EC0iQMQ/cM+9C8MIngOjLDjj0o5oGrzVZBWsBa8TA78Cgnznh3QQe6we9j0cpPnTe1IYG4kgIZR5273mvCdIohg6G6TzI5O32T4ABAPsBS28k7apdAAAAAElFTkSuQmCC">':
'<img style="width:25px; height:25px; border:0" src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwIiB5PSIwIiB3aWR0aD0iNDAwcHgiIGhlaWdodD0iNDAwcHgiIHZpZXdCb3g9IjAgMCA0MDAgNDAwIiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCA0MDAgNDAwIiB4bWw6c3BhY2U9InByZXNlcnZlIj48Y2lyY2xlIGZpbGw9IiM2NjY2NjYiIGN4PSIyMDAuMTM5IiBjeT0iMTk5Ljg2IiByPSIxOTcuODYiLz48cGF0aCBmaWxsPSIjRjBGMEYwIiBzdHJva2U9IiNGMEYwRjAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgZD0iTTExNC44NjUsMzAzLjY0NGMtNi4yMjYsNi4yMjctMTUuMzYzLDcuMTg2LTIwLjQwNywyLjE0NGwtMC41MjItMC41MjJjLTUuMDQzLTUuMDQzLTQuMDgzLTE0LjE4LDIuMTQ0LTIwLjQwN0wyODQuODYsOTYuMDc4YzYuMjI2LTYuMjI3LDE1LjM2Mi03LjE4NiwyMC40MDUtMi4xNDRsMC41MjIsMC41MjFjNS4wNDMsNS4wNDIsNC4wODMsMTQuMTc5LTIuMTQ0LDIwLjQwOEwxMTQuODY1LDMwMy42NDR6Ii8+PHBhdGggZmlsbD0iI0YwRjBGMCIgc3Ryb2tlPSIjRjBGMEYwIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIGQ9Ik0zMDcuODE5LDI4OC42NjZjNS4xNTMsNS4xNTgsNS4wNDgsMTMuNjI0LTAuMjQxLDE4LjkxMWwwLDBjLTUuMjg4LDUuMjg5LTEzLjc1Miw1LjM5My0xOC45MDksMC4yNEw5MS45MDYsMTExLjA1NWMtNS4xNTYtNS4xNTYtNS4wNDgtMTMuNjIzLDAuMjQtMTguOTFsMCwwYzUuMjktNS4yODksMTMuNzU1LTUuMzk2LDE4LjkxMS0wLjI0MUwzMDcuODE5LDI4OC42NjZ6Ii8+PC9zdmc+">'}this.isMRAIDAd||
this.rendererController.requestContentStateChange(!0)}},_onWindowMessageReceived:function(b){if(this.defaultAdElement&&(b.source===this.defaultAdElement.contentWindow||this.expandedAdElement&&b.source===this.expandedAdElement.contentWindow)){this.log("_onWindowMessageReceived, event.data:"+b.data+", event.origin:"+b.origin);var c=b.data.toString().split(":");if(c&&2<=c.length&&"fwsdk-invoke"===c[0]){var d=c[1];if((c=c.slice(2))&&0<c.length){for(var f=0;f<c.length;f++)c[f]=decodeURIComponent(c[f]);
1===c.length&&(c=c[0])}else c=null;if("iframe_ready"===d){if(this.onLoadFunc&&b.source===this.defaultAdElement.contentWindow&&this.defaultAdElement!==this.expandedAdElement)this.onLoadFunc();c&&(c=a.Util.trim(c))&&this.isMRAIDAd&&(this.mraid.baseUrl=c);this.bootstrap&&b.source.postMessage("fwsdk-bounce:"+this.bootstrap,b.origin);b.source.postMessage('fwsdk-bounce:mraid._messagingModel = "postMessage"',b.origin);this.isMRAIDAd&&(b.source===this.defaultAdElement.contentWindow&&this.shouldPauseContentWhenStart&&
this.rendererController.requestContentStateChange(!0),this.mraid.inLoadingState()?this.mraid.state=this.mraid.STATEDEFAULT:this.expandedAdElement&&b.source===this.expandedAdElement.contentWindow&&this.mraid.pushData())}else this.isMRAIDAd?this._mraidMethods(d,c):"close"===d&&this._stop()}}},_mraidMethods:function(b,c){if(b&&this.isMRAIDAd)switch(this.log("_mraidMethods("+b+", "+c+")"),b){case "open":"string"===typeof c?this._mraidOpen(c):2<=c.length&&this._mraidOpen(c[0],a.Util.str2bool(c[1]));break;
case "close":this._mraidClose();break;case "expand":this._mraidExpand(c);break;case "useCustomClose":c&&0<c.length?this.mraid.useCustomClose=a.Util.str2bool(c):this.warn("Invalid parameter to useCustomClose");break;case "setExpandProperties":if(!c)break;this.requestedExpandWidth=Number(c[0]);this.requestedExpandHeight=Number(c[1]);if(!this.requestedExpandWidth||!this.requestedExpandHeight||this.requestedExpandWidth===this.defaultExpandWidth&&this.requestedExpandHeight===this.defaultExpandHeight)this.requestedExpandHeight=
this.requestedExpandWidth=0;this.mraid.useCustomClose=a.Util.str2bool(c[2]);this.requestedExpandWidth===this.mraid.expandWidth&&this.requestedExpandHeight===this.mraid.expandHeight||this.mraid.pushData();break;case "log":this.log("MRAID log:"+c);break;default:this.warn("Unknown MRAID function call: "+b+" with param:"+c)}},_mraidOpen:function(b,c){this.log("_mraidOpen("+b+"), baseUrl:"+this.mraid.baseUrl+", absolute Url"+(b=a.Util.getAbsoluteUrl(this.mraid.baseUrl,b)));var d=this.rendererController;
d.getAdInstance();b&&"string"===typeof b&&0<b.length?((c||"undefined"===typeof c)&&window.open(b),d.processEvent({name:a.EVENT_AD_CLICK,info:{showBrowser:!1,url:b}})):this.warn("_mraidOpen: url required for open")},_mraidClose:function(){this.log("_mraidClose, current state: "+this.mraid.state);if(this.mraid.inExpandedState()){window.removeEventListener&&document.removeEventListener("touchmove",this.touchMoveDisabler,!1);var a=this.expandedAdElement,c=this.expandedAdElement._fw_closeButton;this.expandedAdElement._fw_closeButton=
null;var d=this.expandedAdElement.parentNode;this.mraid.state=this.mraid.STATEDEFAULT;this.expandedLightbox&&(d.removeChild(this.expandedLightbox),this.expandedLightbox=null);a!==this.defaultAdElement&&(a.style.display="hidden",window.setTimeout(function(){d.removeChild(a)},50));d.removeChild(c)}else this.mraid.inDefaultState()?this.mraid.state=this.mraid.STATEHIDDEN:this.warn("_mraidClose: close() is only valid when in expanded/default state")},_mraidExpand:function(b){this.log("_mraidExpand, current state: "+
this.mraid.state);if(this.mraid.inDefaultState())if(this.shouldKeepInterstitial)this.warn("_mraidExpand: expand() is only valid for inline ad");else{if(b){var c=document.createElement("iframe");this.shouldBackgroundTransparent&&(c.allowTransparency="true",c.style["background-color"]="rgba(255,255,255,0)");(this.defaultAdElementContainer||this.defaultAdElement.parentNode).appendChild(c);this.expandedAdElement=c;this.log("_mraidExpand("+b+"), baseUrl:"+this.mraid.baseUrl+", absolute Url"+(b=a.Util.getAbsoluteUrl(this.mraid.baseUrl,
b)));this._fillAdNode(c,b,null)}this.mraid.state=this.mraid.STATEEXPANDED;this.isInterstitialNow=!0;this._onViewportResizeScroll()}else this.warn("_mraidExpand: expand() is only valid when in default state")},_onViewportResizeScroll:function(){var b=a.Util.getViewport();this.defaultExpandWidth=b.width;this.defaultExpandHeight=b.height;this.isInterstitialNow&&this.presentInterstitial()},log:function(b){var c=this.rendererController.getAdInstance().getSlot();a.log("HTMLRenderer["+c+"]\t"+b)},warn:function(b){var c=
this.rendererController.getAdInstance().getSlot();a.warn("HTMLRenderer["+c+"]\t"+b)},info:function(){return{moduleType:a.MODULE_TYPE_RENDERER}},getPlayheadTime:function(){return this.timer?this.timer.getPlayheadTime():-1},getDuration:function(){return this.timer?this.timer.getDuration():-1},_onRendererFailed:function(b,c,d){var f={};f[a.INFO_KEY_ERROR_MODULE]="HTMLRenderer";f[a.INFO_KEY_ERROR_CODE]=b;this.rendererController.getAdInstance().getSlot().getTimePositionClass()==a.TIME_POSITION_CLASS_OVERLAY?
d||(d=a.ERROR_VAST_NON_LINEAR_GENERAL_ERROR):this.rendererController.getAdInstance().getSlot().getTimePositionClass()!=a.TIME_POSITION_CLASS_DISPLAY||d||(d=a.ERROR_VAST_COMPANION_GENERAL_ERROR);d&&(f[a.INFO_KEY_VAST_ERROR_CODE]=d);c&&(f[a.INFO_KEY_ERROR_INFO]=c);this.rendererController.handleStateTransition(a.RENDERER_STATE_FAILED,f)}};a.HTMLRenderer.prototype.constructor=a.HTMLRenderer;a.Ad=function(){this._id=null;this._creatives=[];this._noLoad=!1;this._soAdUnit=null;this._isRequiredToShow=!1};
a.Ad.prototype={isRequiredToShow:function(){return this._isRequiredToShow},parse:function(b){if(b){this._id=b.adId||null;this._noLoad=b.noLoad;this._soAdUnit=b.adUnit;b.hasOwnProperty("required")&&(this._isRequiredToShow=b.required);var c=0;for(b=b.creatives||[];c<b.length;c++){var d=b[c],f=new a.Creative;f.parse(d);this._creatives.push(f)}}},getSoAdUnit:function(){return this._soAdUnit},getId:function(){return this._id},getNoLoad:function(){return this._noLoad},getCreative:function(a){for(var b=
0;b<this._creatives.length;b++)if(this._creatives[b].getId()===a)return this._creatives[b];return null},addCreativeRendition:function(){var b=new a.Creative;this._creatives.push(b);return b}};a.Ad.prototype.constructor=a.Ad;a.Creative=function(){this._duration=this._baseUnit=this._id=null;this._parameters={};this._creativeRenditions=[]};a.Creative.prototype={getId:function(){return this._id},getBaseUnit:function(){return this._baseUnit},getDuration:function(){return this._duration},getParameter:function(a){return this._parameters[a]},
setParameter:function(a,c){null==c?delete this._parameters[a]:this._parameters[a]=c},parse:function(b){if(b){this._id=b.creativeId||null;this._baseUnit=b.baseUnit||null;this._duration=1*b.duration;if(b.parameters)if(b.parameters.constructor===Array)for(var c=0,d=b.parameters||[];c<d.length;c++){var f=d[c];this._parameters[f.name]=f.value}else"object"===typeof b.parameters&&(this._parameters=a.Util.copy(b.parameters));c=0;for(d=b.creativeRenditions||[];c<d.length;c++){f=d[c];b=new a.CreativeRendition;
b.parse(f);b.setDuration(this._duration);b.setBaseUnit(this._baseUnit);for(name in this._parameters)b.setParameter(name,this._parameters[name]);this._creativeRenditions.push(b)}}},getAllCreativeRenditions:function(){return this._creativeRenditions},addCreativeRendition:function(a){this._creativeRenditions.push(a)},getEligibleCreativeRenditionsForAdInstance:function(a){var b=[],d=[],f;for(f=0;f<this._creativeRenditions.length;f++){var g=this._creativeRenditions[f];g.getId()==a._creativeRenditionId&&
g.getReplicaId()==a._replicaId&&b.push(g);""==g.getReplicaId()&&d.push(g)}return 0==b.length?d:b},cloneForTranslation:function(){var b=new a.Creative;b.parse({creativeId:this._id,baseUnit:this._baseUnit,duration:this._duration,parameters:a.Util.copy(this._parameters)});return b}};a.Creative.prototype.constructor=a.Creative;a.CreativeRendition=function(){this._id=null;this._creativeApi="None";this._baseUnit=null;this._replicaId="";this._height=this._width=this._preference=this._wrapperUrl=this._wrapperType=
this._contentType=null;this._parameters={};this._primaryCreativeRenditionAsset=null;this._otherCreativeRenditionAssets=[];this._universalAdId=this._duration=null};a.CreativeRendition.prototype={getId:function(){return this._id},getCreativeApi:function(){return this._creativeApi},setCreativeApi:function(a){this._creativeApi=a||"None"},getReplicaId:function(){return this._replicaId},getContentType:function(){return this._contentType?this._contentType:this._primaryCreativeRenditionAsset&&this._primaryCreativeRenditionAsset.getContentType()?
this._primaryCreativeRenditionAsset.getContentType():null},setContentType:function(a){this._contentType=a},getWrapperType:function(){return this._wrapperType},setWrapperType:function(a){this._wrapperType=a},getWrapperUrl:function(){return this._wrapperUrl},setWrapperUrl:function(a){this._wrapperUrl=a},getBaseUnit:function(){return this._baseUnit},setBaseUnit:function(a){this._baseUnit=a},getPreference:function(){return this._preference},setPreference:function(a){this._preference=a},getWidth:function(){return this._width},
setWidth:function(a){this._width=a},getHeight:function(){return this._height},setHeight:function(a){this._height=a},getDuration:function(){return this._duration},setDuration:function(a){this._duration=a},getParameter:function(a){return this._parameters[a]},setParameter:function(a,c){null==c?delete this._parameters[a]:this._parameters[a]=c},getUniversalAdId:function(){return this._universalAdId},setUniversalAdId:function(a){this._universalAdId=a},getPrimaryCreativeRenditionAsset:function(){return this._primaryCreativeRenditionAsset},
getOtherCreativeRenditionAssets:function(){return this._otherCreativeRenditionAssets.slice()},addCreativeRenditionAsset:function(b,c){var d=new a.CreativeRenditionAsset;d.setName(b);c?this._primaryCreativeRenditionAsset=d:this._otherCreativeRenditionAssets.push(d);return d},parse:function(b){if(b){this._id=b.creativeRenditionId||null;this._creativeApi=b.creativeApi||"None";this._replicaId=b.hasOwnProperty("adReplicaId")?b.adReplicaId:"";this._contentType=b.contentType||null;this._wrapperType=b.wrapperType||
null;this._wrapperUrl=b.wrapperUrl||null;this._preference=1*b.preference;this._width=1*b.width;this._height=1*b.height;for(var c,d=0,f=b.parameters||[];d<f.length;d++)c=f[d],this._parameters[c.name]=c.value;this._primaryCreativeRenditionAsset=new a.CreativeRenditionAsset;this._primaryCreativeRenditionAsset.parse(b.asset);d=0;for(f=b.otherAssets||[];d<f.length;d++)c=f[d],b=new a.CreativeRenditionAsset,b.parse(c),this._otherCreativeRenditionAssets.push(b)}}};a.CreativeRendition.prototype.constructor=
a.CreativeRendition;a.CreativeRenditionAsset=function(){this._bytes=this._mimeType=this._contentType=this._content=this._url=this._name=this._id=null};a.CreativeRenditionAsset.prototype={getName:function(){return this._name},setName:function(a){this._name=a},getUrl:function(){return this._url},setUrl:function(a){this._url=a},getContent:function(){return this._content},setContent:function(a){this._content=a},getContentType:function(){return this._contentType},setContentType:function(a){this._contentType=
a},getMimeType:function(){return this._mimeType},setMimeType:function(a){this._mimeType=a},getBytes:function(){return this._bytes},setBytes:function(a){this._bytes=a},parse:function(a){a&&(this._id=a.id||null,this._name=a.name||null,this._url=a.url||null,this._content=a.content||null,this._contentType=a.contentType||null,this._mimeType=a.mimeType||null,this._bytes=1*a.bytes)}};a.CreativeRenditionAsset.prototype.constructor=a.CreativeRenditionAsset;a.AdInstance=function(b){this._context=b;this._creativeRenditionId=
this._creativeId=this._soAdUnit=this._adId=this._slot=null;this._replicaId="";this._primaryCreativeRendition=this._creative=null;this._creativeRenditions=[];this._noLoad=!1;this._companionAdInstances=[];this._eventCallbacks=[];this._externalEventCallbackUrlsDictionary={};this._rendererController=new a.RendererController(b,this);this._timer=new a.Timer;this._metr=0;this._state=a.MediaInitState.instance;this._isStartSuccessfully=this._translated=this._isImpressionSent=this._isInitiatedSent=!1;this._lastDurationFromRenderer=
-1;this._slotCustomId=this._parentAdInstancesGroup=null;this._isSkipped=!1;this._wrapperCount=0};a.AdInstance.prototype={};a.AdInstance.prototype.constructor=a.AdInstance;a.METR_MASK_QUARTILE=0;a.METR_MASK_MIDPOINT=1;a.METR_MASK_COMPLETE=2;a.METR_MASK_VOLUME=3;a.METR_MASK_SIZE=4;a.METR_MASK_CONTROL=5;a.METR_MASK_REWIND=6;a.METR_MASK_ACCEPT_INVITATION=7;a.METR_MASK_CLOSE=8;a.METR_MASK_MINIMIZE=9;a.METR_MASK_CLICK=10;a.AdInstance._metrDictionary={};a.AdInstance._metrDictionary[a.EVENT_AD_FIRST_QUARTILE]=
a.AdInstance._metrDictionary[a.EVENT_AD_THIRD_QUARTILE]=a.AdInstance._metrDictionary[a.EVENT_AD_QUARTILE]=1<<a.METR_MASK_QUARTILE|1<<a.METR_MASK_MIDPOINT|1<<a.METR_MASK_COMPLETE;a.AdInstance._metrDictionary[a.EVENT_AD_MIDPOINT]=1<<a.METR_MASK_MIDPOINT|1<<a.METR_MASK_COMPLETE;a.AdInstance._metrDictionary[a.EVENT_AD_COMPLETE]=1<<a.METR_MASK_COMPLETE;a.AdInstance._metrDictionary[a.EVENT_AD_MUTE]=1<<a.METR_MASK_VOLUME;a.AdInstance._metrDictionary[a.EVENT_AD_UNMUTE]=1<<a.METR_MASK_VOLUME;a.AdInstance._metrDictionary[a.EVENT_AD_COLLAPSE]=
1<<a.METR_MASK_SIZE;a.AdInstance._metrDictionary[a.EVENT_AD_EXPAND]=1<<a.METR_MASK_SIZE;a.AdInstance._metrDictionary[a.EVENT_AD_PAUSE]=1<<a.METR_MASK_CONTROL;a.AdInstance._metrDictionary[a.EVENT_AD_RESUME]=1<<a.METR_MASK_CONTROL;a.AdInstance._metrDictionary[a.EVENT_AD_REWIND]=1<<a.METR_MASK_REWIND;a.AdInstance._metrDictionary[a.EVENT_AD_ACCEPT_INVITATION]=1<<a.METR_MASK_ACCEPT_INVITATION;a.AdInstance._metrDictionary[a.EVENT_AD_CLOSE]=1<<a.METR_MASK_CLOSE;a.AdInstance._metrDictionary[a.EVENT_AD_MINIMIZE]=
1<<a.METR_MASK_MINIMIZE;a.AdInstance._metrDictionary[a.EVENT_AD_CLICK]=1<<a.METR_MASK_CLICK;a.Util.mixin(a.AdInstance.prototype,{getAdId:function(){return this._adId},getUniversalAdId:function(){return this.getActiveCreativeRendition()?this.getActiveCreativeRendition().getUniversalAdId():null},getSoAdUnit:function(){return this._soAdUnit},getEventCallbackUrls:function(b,c){var d=[],f=c===a.EVENT_TYPE_CLICK,g=c===a.EVENT_TYPE_CLICK_TRACKING;b=a.EventCallback.getEventCallback(this._eventCallbacks,b,
g?a.EVENT_TYPE_CLICK:c);if(!b)return d;c={};c[a.INFO_KEY_NEED_EMPTY_CT]=!0;f?b._showBrowser&&d.push(b.getUrl(c)):g?b._showBrowser||d.push(b.getUrl(c)):d.push(b.getUrl(c));f||(d=d.concat(b.getTrackingUrls()));return d},addEventCallbackUrls:function(a,c,d){d&&this._isValidEventNameAndType(a,c)&&(this._externalEventCallbackUrlsDictionary[c+"-"+a]=this.getExternalEventCallbackUrls(a,c).concat(d||[]))},setClickThroughUrl:function(b,c){c&&this._isValidEventNameAndType(b,a.EVENT_TYPE_CLICK)&&(b=this.getEventCallback(b,
a.EVENT_TYPE_CLICK))&&(a.Util.isParameterInURL(b._url,a.URL_PARAMETER_KEY_CR)||(b._url=b._url+"&"+a.URL_PARAMETER_KEY_CR+"="),b._url=a.Util.setParameterInURL(b._url,a.URL_PARAMETER_KEY_CR,c),b._showBrowser=!0)},addCreativeRendition:function(){var b=new a.CreativeRendition;b.parse({creativeRenditionId:this._creativeRenditionId,adReplicaId:this._replicaId,preference:0});b.setBaseUnit(this._creative.getBaseUnit());b.setDuration(this._creative.getDuration());this._creativeRenditions.push(b);this.isPlaceholder()&&
(this._noLoad=!1);return b},getRendererController:function(){return this._rendererController},getSlot:function(){this._slot||(this._slot=this._context._adResponse.getSlotByCustomId(this._slotCustomId));return this._slot},getCompanionSlots:function(){for(var a=[],c=0;c<this._companionAdInstances.length;c++)a.push(this._companionAdInstances[c]._slot);return a},getActiveCreativeRendition:function(){return this._primaryCreativeRendition},setActiveCreativeRendition:function(b){b?(-1==this._creativeRenditions.indexOf(b)&&
this._creativeRenditions.push(cr),this._primaryCreativeRendition=b,this._creativeRenditionId=b.getId()):a.warn("AdInstance.setActiveCreativeRendition","rendition is null")},getAllCreativeRenditions:function(){var a=this._creativeRenditions.slice();a.sort(function(a,b){return b.getPreference()-a.getPreference()});var c=a.indexOf(this._primaryCreativeRendition);-1<c&&(a.splice(c,1),a.unshift(this._primaryCreativeRendition));return a},getRenderableCreativeRenditions:function(){var a=this._creativeRenditions.slice().sort(function(a,
b){return b.getPreference()-a.getPreference()}).filter(function(a){return this._rendererController.rendererMatch(a)},this),c=a.indexOf(this._primaryCreativeRendition);-1<c&&(a.splice(c,1),a.unshift(this._primaryCreativeRendition));return a},getPlayheadTime:function(){var b=-1;if(this._rendererController.getRenderer()&&"function"===typeof this._rendererController.getRenderer().getPlayheadTime)try{b=this._rendererController.getRenderer().getPlayheadTime()}catch(c){a.warn("AdInstance.getPlayheadTime",
c.description)}return b},getDuration:function(){var a=-1;this._rendererController.getRenderer()&&"function"===typeof this._rendererController.getRenderer().getDuration&&(this._lastDurationFromRenderer=a=this._rendererController.getRenderer().getDuration());-1===a&&(a=-1<this._lastDurationFromRenderer?this._lastDurationFromRenderer:this.getActiveCreativeRendition().getDuration());return a},parse:function(b){if(b){this._adId=b.adId||null;this._creativeId=b.creativeId||null;this._creativeRenditionId=
b.creativeRenditionId||null;this._replicaId=b.hasOwnProperty("replicaId")?b.replicaId:"";this._noLoad=this._context._adResponse.getAd(this._adId).getNoLoad();this._soAdUnit=this._context._adResponse.getAd(this._adId).getSoAdUnit();this._creative=this._context._adResponse.getCreative(this._adId,this._creativeId);this._creativeRenditions=this._creative.getEligibleCreativeRenditionsForAdInstance(this);var c;var d=0;for(c=b.eventCallbacks||[];d<c.length;d++){var f=c[d];var g=a.EventCallback.newEventCallback(this._context,
f.name,f.type);g&&(g._adInstance=this,g.parse(f),this._eventCallbacks.push(g))}d=0;for(c=b.companionAds||[];d<c.length;++d)(f=c[d])&&f.adSlotCustomId&&(g=new a.AdInstance(this._context),g._slotCustomId=f.adSlotCustomId,g.parse(f),this._companionAdInstances.push(g));d=0;for(c=b.fallbackAds||[];d<c.length;++d)f=c[d],g=new a.AdInstance(this._context),this._parentAdInstancesGroup.push(g),g._slot=this._slot,g._parentAdInstancesGroup=this._parentAdInstancesGroup,g.parse(f);0<this._creativeRenditions.length&&
(this._primaryCreativeRendition=this._creativeRenditions[0])}},play:function(){a.log("AdInstance.play "+this._slotCustomId);this._timer.tick();this.processEvent(a.EVENT_AD_IMPRESSION,a.EVENT_TYPE_IMPRESSION);this._isStartSuccessfully||(a.MODULE_TYPE_RENDERER===this._rendererController.getRenderer().info()[a.INFO_KEY_MODULE_TYPE]&&this._context.dispatchEvent(a.EVENT_AD_IMPRESSION,{adInstance:this,slotCustomId:this._slotCustomId}),this._isStartSuccessfully=!0);this._state.play(this);if(this._rendererController.getRenderer().info()[a.INFO_KEY_MODULE_TYPE]===
a.MODULE_TYPE_RENDERER)for(var b=0;b<this._companionAdInstances.length;b++)this._companionAdInstances[b].isPlaceholder()||this._companionAdInstances[b].getSlot().playCompanionAds(this._companionAdInstances[b])},pause:function(){a.log("AdInstance.pause "+this._slotCustomId);this._isStartSuccessfully?this._rendererController&&this._rendererController.pause():a.log("Ad hasn't started yet. Ignore.")},resume:function(){a.log("AdInstance.resume"+this._slotCustomId);this._isStartSuccessfully?this._rendererController&&
this._rendererController.resume():a.log("Ad hasn't started yet. Ignore.")},skip:function(){a.log("AdInstance.skip");"VPAID"!=this.getActiveCreativeRendition().getCreativeApi()?(this._isSkipped=!0,this.processEvent(a.EVENT_AD_SKIPPED,a.EVENT_TYPE_GENERIC),this.stop()):a.log("VPAID creative, skip has been implemented inside of VPAID")},stop:function(){a.log("AdInstance.stop");this._rendererController.stop()},fakeComplete:function(){this._slot.getTimePositionClass()===a.TIME_POSITION_CLASS_DISPLAY&&
(this._isStartSuccessfully=!1,this._slot.playNextAdInstance())},complete:function(){this._isStartSuccessfully&&(this.processEvent(a.EVENT_AD_IMPRESSION_END,a.EVENT_TYPE_IMPRESSION),a.MODULE_TYPE_RENDERER===this._rendererController.getRenderer().info()[a.INFO_KEY_MODULE_TYPE]&&this._context.dispatchEvent(a.EVENT_AD_IMPRESSION_END,{adInstance:this}));this._state.complete(this);this._rendererController._restorePlaceholdersForHybrid();this._rendererController.setRenderer(null);this._isStartSuccessfully=
!1;this._slot.playNextAdInstance()},isStarted:function(){return this._isStartSuccessfully},onStartPlaying:function(){a.MODULE_TYPE_RENDERER===this._rendererController.getRenderer().info()[a.INFO_KEY_MODULE_TYPE]?this._isImpressionSent=!0:this._translated=!0},onCompletePlaying:function(){},onStartReplaying:function(){},onCompleteReplaying:function(){},getEventCallback:function(b,c){return a.EventCallback.getEventCallback(this._eventCallbacks,b,c)},processEvent:function(b,c,d,f){var g=!0;c=this.getEventCallback(b,
c);b===a.EVENT_AD_IMPRESSION&&this._isStartSuccessfully&&(c=this.getEventCallback(a.EVENT_ERROR,a.EVENT_TYPE_ERROR),d={errorInfo:"Trying to send defaultImpression multiple times"},g=!1);c?f||c.process(d):g=!1;b===a.EVENT_AD_CLICK&&this._context.dispatchEvent(a.EVENT_AD_CLICK,{adInstance:this});if(b!=a.EVENT_AD_IMPRESSION&&b!=a.EVENT_AD_IMPRESSION_END||a.MODULE_TYPE_RENDERER===this._rendererController.getRenderer().info()[a.INFO_KEY_MODULE_TYPE])f={subType:b,adInstance:this,slot:this._slot},b===a.EVENT_ERROR&&
(f[a.INFO_KEY_ERROR_CODE]=d[a.INFO_KEY_ERROR_CODE],f[a.INFO_KEY_ERROR_INFO]=d[a.INFO_KEY_ERROR_INFO],f[a.INFO_KEY_ERROR_MODULE]=d[a.INFO_KEY_ERROR_MODULE]),b===a.EVENT_AD_MEASUREMENT&&(f[a.INFO_KEY_CONCRETE_EVENT_ID]=d[a.INFO_KEY_CONCRETE_EVENT_ID]),this._context.dispatchEvent(a.EVENT_AD,f);return g},setVolume:function(b){a.debug("AdInstance.setVolume("+b+")");this.isStarted()&&"function"===typeof this._rendererController.getRenderer().setVolume&&this._rendererController.getRenderer().setVolume(b)},
setMetr:function(b,c){var d=a.AdInstance._metrDictionary[b];d&&(b===a.EVENT_AD_CLICK&&(c=!c),this._metr=c===a.CAPABILITY_STATUS_ON||!0===c?this._metr|d:this._metr&~d)},getExternalEventCallbackUrls:function(a,c){return(this._externalEventCallbackUrlsDictionary[c+"-"+a]||[]).slice()},reset:function(){this._rendererController.reset();for(var b=0;b<this._companionAdInstances.length;b++){var c=this._companionAdInstances[b];c._state!==a.MediaPlayingState.instance&&c._state!==a.MediaReplayingState.instance||
c.stop();c._rendererController.reset()}},cloneForTranslation:function(){var b=new a.AdInstance(this._context);b._adId=this._adId;b._creativeId=this._creativeId;b._creative=this._creative.cloneForTranslation();b._creativeRenditionId=this._creativeRenditionId;b._isInitiatedSent=this._isInitiatedSent;b._noLoad=this._noLoad;b._slot=this.getSlot();b._soAdUnit=this.getSoAdUnit();b._replicaId=this._replicaId;b._wrapperCount=this._wrapperCount;for(var c=0;c<this._eventCallbacks.length;c++){var d=this._eventCallbacks[c].copy();
d._adInstance=b;b._eventCallbacks.push(d)}b._externalEventCallbackUrlsDictionary=a.Util.copy(this._externalEventCallbackUrlsDictionary);for(c=0;c<this._companionAdInstances.length;c++)this._companionAdInstances[c].isPlaceholder()?b._companionAdInstances.push(this._companionAdInstances[c].cloneForTranslation()):b._companionAdInstances.push(this._companionAdInstances[c]);return b},isPlaceholder:function(){return this._noLoad},setMediaState:function(a){this._state=a},_isValidEventNameAndType:function(b,
c){return a.Util.isBlank(b)||a.Util.isBlank(c)?!1:c===a.EVENT_TYPE_CLICK||c===a.EVENT_TYPE_CLICK_TRACKING||c===a.EVENT_TYPE_IMPRESSION&&(b===a.EVENT_AD_IMPRESSION||b===a.EVENT_AD_FIRST_QUARTILE||b===a.EVENT_AD_MIDPOINT||b===a.EVENT_AD_THIRD_QUARTILE||b===a.EVENT_AD_COMPLETE)||c===a.EVENT_TYPE_STANDARD&&(b===a.EVENT_AD_PAUSE||b===a.EVENT_AD_RESUME||b===a.EVENT_AD_REWIND||b===a.EVENT_AD_MUTE||b===a.EVENT_AD_UNMUTE||b===a.EVENT_AD_COLLAPSE||b===a.EVENT_AD_EXPAND||b===a.EVENT_AD_MINIMIZE||b===a.EVENT_AD_CLOSE||
b===a.EVENT_AD_ACCEPT_INVITATION)||c===a.EVENT_TYPE_ERROR&&b===a.EVENT_ERROR},isPlayable:function(){var b=!(this._rendererController.getRendererState()==a.RendererFailedState.instance&&!this._isImpressionSent);if(!b)return a.debug("AdInstance.isPlayable returning false isImpressionSent:",this._isImpressionSent),b;(b=b&&!this._translated)||a.debug("AdInstance.isPlayable returning false translated:",this._translated);return b},toString:function(){return"[AdInstance "+this._adId+"]"},getCompanionAdInstances:function(){for(var a=
[],c=0;c<this._companionAdInstances.length;++c)this._companionAdInstances[c].isPlaceholder()||a.push(this._companionAdInstances[c]);return a},isRequiredToShow:function(){return this._context._adResponse.getAd(this._adId).isRequiredToShow()},incrementWrapperCount:function(){this._wrapperCount++},getWrapperCount:function(){return this._wrapperCount}});a.AdManager=function(){var b=this;this._context=this.newContext();this._context.addEventListener(a.EVENT_REQUEST_COMPLETE,function(a){b.onRequestComplete(a)});
this._networkId=this._serverURL="";this._onRequestComplete=this._location=null};a.AdManager.prototype={getVersion:function(){if(a.version){var b=a.version.match(/^js-(\d)\.(\d)\.(\d).(\d)/)||a.version.match(/^js-(\d)\.(\d)\.(\d)/)||a.version.match(/^js-(\d)\.(\d)/);if(null!=b&&0<b.length){for(var c=0,d=0;d<b.length-1;d++)c+=b[b.length-d-1]<<(d<<3);return c}if(0===a.version.indexOf("js-master"))return 4294967295}return 0},setNetwork:function(b){a.debug("AdManager.setNetwork("+Array.prototype.slice.call(arguments).join(",")+
")");if(0<1*b){this._networkId=1*b;for(var c in a._instanceQueue)if(a._instanceQueue.hasOwnProperty(c)){var d=a._instanceQueue[c];d&&d._videoAsset._videoPlayPending&&d._videoAsset.play()}}else a.warn("AdManager.setNetwork","valid networkId required")},setServerURL:function(b){a.debug("AdManager.setServerURL("+Array.prototype.slice.call(arguments).join(",")+")");a.warn("AdManager.setServerURL method is DEPRECATED, use AdManager.setServer instead.");this.setServer(b)},setServer:function(b){a.debug("AdManager.setServer("+
Array.prototype.slice.call(arguments).join(",")+")");if(b&&"string"===typeof b){this._serverURL=b;for(var c in a._instanceQueue)if(a._instanceQueue.hasOwnProperty(c)){var d=a._instanceQueue[c];d&&d._videoAsset._videoPlayPending&&d._videoAsset.play()}}else a.warn("AdManager.setServer","server url required")},setLocation:function(b){a.debug("AdManager.setLocation("+Array.prototype.slice.call(arguments).join(",")+")");this._location=b},newContext:function(){a.debug("AdManager.newContext("+Array.prototype.slice.call(arguments).join(",")+
")");return new a.Context(this)},newContextWithContext:function(b){a.debug("AdManager.newContextWithContext("+Array.prototype.slice.call(arguments).join(",")+")");var c=this.cloneContext(b);c._temporalSlotBase=b._temporalSlotBase;b.getContentVideoElement()&&(c.setContentVideoElement(b.getContentVideoElement()),delete c._temporalSlotBase["_fw_contentVideo_"+b._instanceId]);c._videoDisplaySize=b._videoDisplaySize;c._overriddenAdRenderers=b._overriddenAdRenderers;c._currentContentPlayheadTime=b._currentContentPlayheadTime;
c.startSubsession(b._adRequest._subsessionToken);c.setRequestMode(b._adRequest._requestMode);c._adRequest._compatibleDimensions=b._adRequest._compatibleDimensions;c._videoAsset._state=b._videoAsset._state;c._videoAsset._callbackTimer=b._videoAsset._callbackTimer;c._videoAsset._videoPlayPending=b._videoPlayPending;c._videoAsset._requestedVideoViewUrl=b._videoAsset._requestedVideoViewUrl;c._videoAsset._delay=b._videoAsset._delay;c._videoAsset._durationType=b._videoAsset._durationType;var d=b._extensionManager.extensions,
f;for(f in d)c.loadExtension(d[f]);return this._context=c},setParameter:function(b,c,d){a.debug("AdManager.setParameter("+Array.prototype.slice.call(arguments).join(",")+")");this._context.setParameter(b,c,d)},getParameter:function(a){return this._context.getParameter(a)},submitRequest:function(b,c){a.debug("AdManager.submitRequest()");b&&"function"===typeof b?this._onRequestComplete=b:a.warn("AdManager.submitRequest(): callback function required");this._context.submitRequest(c/1E3)},onRequestComplete:function(b){a.debug("AdManager.onRequestComplete("+
Array.prototype.slice.call(arguments).join(",")+")");this._onRequestComplete&&(this._onRequestComplete({success:b.success,response:b.response}),this._onRequestComplete=null)},registerVideoDisplayBase:function(b){a.debug("AdManager.registerVideoDisplayBase("+Array.prototype.slice.call(arguments).join(",")+")");this._context.registerVideoDisplayBase(b)},setVideoAsset:function(b,c){a.debug("AdManager.setVideoAsset("+Array.prototype.slice.call(arguments).join(",")+")");this._context.setVideoAsset(b,c)},
setSiteSection:function(b){a.debug("AdManager.setSiteSection("+Array.prototype.slice.call(arguments).join(",")+")");this._context.setSiteSection(b)},addKeyValue:function(b,c){a.debug("AdManager.addKeyValue("+Array.prototype.slice.call(arguments).join(",")+")");this._context.addKeyValue(b,c)},setVideoDisplayCompatibleSizes:function(b){a.debug("AdManager.setVideoDisplayCompatibleSizes("+Array.prototype.slice.call(arguments).join(",")+")");this._context.setVideoDisplayCompatibleSizes(b)},playSlots:function(b,
c){a.warn("AdManager.playSlots() has DEPRECATED, use tv.freewheel.SDK.Slot.Play() instead");a.debug("AdManager.playSlots("+b+")");"string"===typeof b&&(b=b.toUpperCase());this._playSlots(b,c)},_playSlots:function(b,c){"function"!==typeof c&&(c=function(){});if(this._context._adResponse){for(var d=[],f=this._context.getTemporalSlots(),g=0;g<f.length;++g){var k=f[g];(.1>Math.abs(k.getTimePosition()-b)||b===k.getTimePositionClass())&&d.push(k)}if(0===d.length)a.warn("AdManager.playSlots","no slot matches",
b),c();else if(b===a.TIME_POSITION_CLASS_OVERLAY)for(g=0;g<d.length;g++)(function(a){if(!a._onContentVideoTimeUpdate){var b=this._context.getContentVideoElement(),c=a._onContentVideoTimeUpdate=function(d){!b.paused&&!0!==b._fw_videoAdPlaying&&0<=b.currentTime-a.getTimePosition()&&1>b.currentTime-a.getTimePosition()&&(b.removeEventListener("timeupdate",c,!1),a._play(function(){var d=setInterval(function(){!b.paused&&2<Math.abs(b.currentTime-a.getTimePosition())&&(b.addEventListener("timeupdate",c,
!1),clearInterval(d))},1E3)}))};b.addEventListener("timeupdate",c,!1)}})(d[g]);else(function(){var a=d.shift();a?a._play(c):c()})()}else a.warn("AdManager._playSlots","request is not completed"),c()},dispose:function(){a.debug("AdManager.dispose()");this._context.dispose();this._onRequestComplete=null},cloneContext:function(a){var b=this.newContext(),d=a._adRequest._capabilities._capabilities,f;for(f in d)d.hasOwnProperty(f)&&b.setCapability(f,d[f]);b.setProfile(a._adRequest._playerProfile);b.setSiteSection(a._ss_id,
a._ss_networkId,a._ss_pageViewRandom,a._ss_idType,a._ss_fallbackId);b.setVideoAsset(a._va_id,a._va_duration,a._va_networkId,a._va_location,a._va_autoPlayType,a._va_viewRandom,a._va_idType,a._va_fallbackId,a._va_durationType);b.setVisitor(a._adRequest._visitorCustomId,a._adRequest._visitorIpV4Address);return b}};a.AdManager.prototype.constructor=a.AdManager;a.AdRequest=function(b){this._context=b;this._capabilities=new a.Capabilities;this._keyValues=[];this._playerProfile="";this._compatibleDimensions=
null;this._temporalSlots=[];this._siteSectionId=this._siteSectionCustomId="";this._siteSectionNetworkId=0;this._siteSectionFallbackId="";this._siteSectionViewRandom=0;this._requestMode=this._visitorIpV4Address=this._visitorCustomId="";this._subsessionToken=this._requestDuration=0;this._candidateAdIds=[];this._slotScanner=new a.PageSlotScanner(b);this._urlParams={};this._urlKeyValues=[];this._customInfo=""};a.AdRequest.prototype={setCapability:function(a,c){this._capabilities.setCapability(a,c)},addKeyValue:function(b,
c){"string"!==typeof b||"string"!==typeof c||0===b.length?a.warn("AdRequest.addKeyValue:","key and value required"):(b=encodeURIComponent(b)+"="+encodeURIComponent(c),0>this._keyValues.indexOf(b)&&this._keyValues.push(b))},setProfile:function(b){"string"!==typeof b?a.warn("AdRequest.setProfile:","player profile required"):this._playerProfile=b},setVideoDisplayCompatibleSizes:function(b){if(b&&b.length){for(var c=[],d={},f=0;f<b.length;++f)if(a.debug("dimension is:",b[f].width,"X",b[f].height),0<b[f].width&&
0<b[f].height){var g=b[f].width+","+b[f].height;null==d[g]&&(d[g]="",c.push(g))}0<c.length&&(this._compatibleDimensions=c.join("|"))}else a.warn("AdRequest.setVideoDisplayCompatibleSizes:","compatible dimensions required")},setSiteSection:function(b,c,d,f,g){if(b){switch(f){case a.ID_TYPE_FW:this._siteSectionId=b;break;case a.ID_TYPE_GROUP:this._siteSectionId="g"+b;break;default:this._siteSectionCustomId=b}0<1*c&&(this._siteSectionNetworkId=1*c);0<1*d&&(this._siteSectionViewRandom=1*d);"number"===
typeof g&&0<g?this._siteSectionFallbackId=""+g:"string"===typeof g&&(this._siteSectionFallbackId=g.trim())}else a.warn("AdRequest.setSiteSection: id required")},setVisitor:function(b,c){"string"!==typeof b?a.warn("AdRequest.setVisitor:","customId required"):(this._visitorCustomId=b,"string"===typeof c&&""!==c&&(this._visitorIpV4Address=c))},setRequestMode:function(b){b!==a.REQUEST_MODE_ON_DEMAND&&b!==a.REQUEST_MODE_LIVE?a.warn("AdRequest.setRequestMode:","unknown mode: "+b):(this._requestMode=b,this._requestMode==
a.REQUEST_MODE_LIVE&&0==this._subsessionToken&&this.setSubsessionToken(1E4*Math.random()+1))},setRequestDuration:function(b){"number"!==typeof b?a.warn("AdRequest.setRequestDuration:","request duration required"):(0>b&&(a.warn("AdRequest.setRequestDuration:","requestDuration is negative, reset it to 0"),b=0),this._requestDuration=b)},addCandidateAd:function(b){"number"!==typeof b?a.warn("AdRequest.addCandidateAd:","candidate ad ID required"):0>b?a.warn("AdRequest.addCandidateAd","invalid ad ID, ignore"):
this._candidateAdIds.push(b)},addTemporalSlot:function(b,c,d,f,g,k,h,l){if(a.Util.isBlank(b)||a.Util.isBlank(c)||0>d)a.warn("AdRequest.addTemporalSlot:","invalid parameters");else{for(var m=0;m<this._temporalSlots.length;m++)if(this._temporalSlots[m].getCustomId()===b){a.warn("AdRequest.addTemporalSlot:","slot is already existed, ignored");return}m=new a.Slot(this._context);m.setCustomId(b);m.setAdUnit(c);m.setTimePosition(d);m.setSlotProfile(f);m.setCuepointSequence(1*g);m.setMaxDuration(k);m.setMinDuration(h);
m.setAcceptContentType(l);this._temporalSlots.push(m)}},setSubsessionToken:function(a){this._subsessionToken=a},scanPageSlots:function(){this._slotScanner.scanPageSlots()},generateTypeBRequestUrl:function(){var b=this._context._adManager._serverURL.split("?"),c=b[0],d=[/fwmrm\.net$/,/fwmrm\.net\/$/,/fwmrm\.net\/ad$/,/fwmrm\.net\/ad\/$/,/fwmrm\.net\/ad\/g$/,/fwmrm\.net\/ad\/g\/$/,/fwmrm\.net\/ad\/g\/1$/];if(0===c.indexOf("http://")||0===c.indexOf("https://"))for(var f=0;f<d.length;++f)if(c.match(d[f])){c=
c.slice(0,c.indexOf("fwmrm.net")+9)+"/ad/g/1";break}this.parseQueryStr(b.slice(1).join("?"));b=this.generateGlobalParametersQueryStr()+";"+this.generateKeyValuesStr()+";";this._capabilities.getCapability(a.CAPABILITY_SKIP_AD_SELECTION)&&1==this._capabilities.getCapability(a.CAPABILITY_SKIP_AD_SELECTION)||(b+=this.generateSlotsTypeBStr());a.Util.isBlank(this._customInfo)||(b+=";"+this._customInfo);return c+"?"+b},generateVideoViewRequestUrlWithDummyContextInstanceId:function(b){this._context.setCapability(a.CAPABILITY_REQUIRE_VIDEO_CALLBACK,
a.CAPABILITY_STATUS_ON);this._context.setCapability(a.CAPABILITY_SKIP_AD_SELECTION,a.CAPABILITY_STATUS_ON);var c=this.generateTypeBRequestUrl();c=a.Util.setParameterInURL(c,"cbfn","tv.freewheel.SDK._instanceQueue['Context_"+b+"']._videoAsset.requestComplete");a.debug("generateVideoViewRequestUrlWithDummyContextInstanceId():"+c);this._context.setCapability(a.CAPABILITY_REQUIRE_VIDEO_CALLBACK,a.CAPABILITY_STATUS_UNSET);this._context.setCapability(a.CAPABILITY_SKIP_AD_SELECTION,a.CAPABILITY_STATUS_UNSET);
return c},parseQueryStr:function(b){a.debug("AdRequest.parseQueryStr("+Array.prototype.slice.call(arguments).join(",")+")");this._urlParams={};this._urlKeyValues=[];this._customInfo="";if(b){";"===b.charAt(b.length-1)&&(b=b.substring(0,b.length-1));var c=b.split(";"),d;if(c[0]){var f=c[0].split("&");for(d=0;d<f.length;++d){var g=f[d].split("=");2===g.length&&(this._urlParams[g[0]]=g[1])}}if(c[1])for(f=c[1].split("&"),d=0;d<f.length;++d)this._urlKeyValues.push(f[d]);c[2]&&(this._customInfo=c.slice(2).join(";"))}},
generateGlobalParametersQueryStr:function(){a.debug("AdRequest.generateGlobalParametersQueryStr");var b=this._context.getParameter("wrapperVersion");b=[["prof",this._playerProfile,"string"],["nw",this._context._adManager._networkId,"number"],["caid",this._context._videoAsset._customId,"string"],["asid",this._context._videoAsset._id,"string"],["vdur",this._context._videoAsset._duration,"number"],["asnw",this._context._videoAsset._networkId,"number"],["asml",this._context._videoAsset._location,"string"],
["vprn",this._context._videoAsset._viewRandom,"number"],["afid",this._context._videoAsset._fallbackId,"string"],["vdty",this._context._videoAsset._durationType,"string"],["vtpo",this._context._videoAsset._currentTpos,"number"],["csid",this._siteSectionCustomId,"string"],["ssid",this._siteSectionId,"string"],["ssnw",this._siteSectionNetworkId,"number"],["pvrn",this._siteSectionViewRandom,"number"],["sfid",this._siteSectionFallbackId,"string"],["vcid",this._visitorCustomId,"string"],["mode",this._requestMode,
"string"],["vrdu",this._requestDuration,"number"],["ssto",this._subsessionToken,"number"],["cd",this._compatibleDimensions||this.detectScreenDimension(),"string"],["vclr",a.version+(b?","+b:""),"string"],["resp",a.PLATFORM_SEND_REQUEST_BY_FORM?"json2":"json","string"],["orig",window.location.protocol+"//"+window.location.host,"string"],["cbfn","tv.freewheel.SDK._instanceQueue['Context_"+this._context._instanceId+"'].requestComplete","string"],["vip",this._visitorIpV4Address,"string"],["cana",this._candidateAdIds.join(","),
"string"]];for(var c=0;c<b.length;c++){var d=b[c];switch(d[2]){case "string":a.Util.isBlank(d[1])||(this._urlParams[d[0]]=encodeURIComponent(d[1]));break;case "number":0<d[1]&&(this._urlParams[d[0]]=d[1])}}b="";for(var f in this._urlParams)this._urlParams.hasOwnProperty(f)&&(b+=f+"="+this._urlParams[f]+"&");b=b.substring(0,b.length-1);0<this._slotScanner._candidateAds.length&&(null==this._capabilities._capabilities[a.CAPABILITY_CHECK_COMPANION]&&this._capabilities.setCapability(a.CAPABILITY_CHECK_COMPANION,
a.CAPABILITY_STATUS_ON),null==this._capabilities._capabilities[a.CAPABILITY_CHECK_TARGETING]&&this._capabilities.setCapability(a.CAPABILITY_CHECK_TARGETING,a.CAPABILITY_STATUS_OFF));this._context._videoAsset._eventCallback||this._context._videoAsset._requestedVideoViewUrl||!this._context._videoAsset._id&&!this._context._videoAsset._customId||this._context.setCapability(a.CAPABILITY_REQUIRE_VIDEO_CALLBACK,a.CAPABILITY_STATUS_ON);this._capabilities._capabilities[a.CAPABILITY_DISPLAY_REFRESH]&&this._context.setCapability(a.CAPABILITY_REQUIRE_VIDEO_CALLBACK,
a.CAPABILITY_STATUS_OFF);b=this._capabilities.parseCapabilities(b);this._context.setCapability(a.CAPABILITY_REQUIRE_VIDEO_CALLBACK,a.CAPABILITY_STATUS_UNSET);switch(this._context._videoAsset._autoPlayType){case a.VIDEO_ASSET_AUTO_PLAY_TYPE_UNATTENDED:f="+play+uapl";break;case a.VIDEO_ASSET_AUTO_PLAY_TYPE_NONE:f="-play";break;default:f="+play-uapl"}return b=b.replace(/flag=/,"flag="+encodeURIComponent(f))},generateKeyValuesStr:function(){a.debug("AdRequest.generateKeyValuesStr");var b=a.Util.flashVersion();
b=this._keyValues.concat(["_fw_h_x_flash_version="+encodeURIComponent(b),"_fw_dpr="+(void 0===window.devicePixelRatio?"1":window.devicePixelRatio.toFixed(2).toString())]);for(var c=0;c<this._urlKeyValues.length;c++){var d=this._urlKeyValues[c];0>b.indexOf(d)&&b.push(d)}(c=this._context._adManager._location)&&b.push("ltlg="+encodeURIComponent(Math.round(1E4*c.coords.latitude)/1E4+","+Math.round(1E4*c.coords.longitude)/1E4));return b.join("&")},generateSlotsTypeBStr:function(){a.debug("AdRequest.generateSlotsTypeBStr");
for(var b="",c=[],d=0;d<this._temporalSlots.length;d++){var f=this._temporalSlots[d];f=[["slid",f.getCustomId(),"string"],["slau",f.getAdUnit(),"string"],["ptgt","a","string"],["tpos",f.getTimePosition(),"number"],["cpsq",f.getCuepointSequence(),"number"],["envp",f.getSlotProfile(),"string"],["maxd",f.getMaxDuration(),"number"],["mind",f.getMinDuration(),"number"],["prct",f.getAcceptContentType(),"string"]];for(var g=[],k=0;k<f.length;k++){var h=f[k];switch(h[2]){case "string":a.Util.isBlank(h[1])||
g.push(h[0]+"="+encodeURIComponent(h[1]));break;case "number":-1<["cpsq","maxd","mind"].indexOf(h[0])?0<h[1]&&g.push(h[0]+"="+h[1]):0<=h[1]&&g.push(h[0]+"="+h[1])}}c.push(g.join("&"))}0<c.length&&(b=c.join(";")+";");return b+=this._slotScanner.slotsToTypeBStr()},detectScreenDimension:function(){a.debug("AdRequest.detectScreenDimension:",screen.width+","+screen.height);return screen.width+","+screen.height}};a.AdResponse=function(a){this._context=a};a.AdResponse.prototype={};a.AdResponse.prototype.constructor=
a.AdResponse;a.Util.mixin(a.AdResponse.prototype,{parse:function(b,c){this._data=b;this._temporalSlots=[];this._videoPlayerNonTemporalSlots=[];this._siteSectionNonTemporalSlots=[];this._profileParameters={};this._ads=[];this._siteSectionCustomId=a.Util.getObject("siteSection.customId",b)||"";this._adRenderers=[];var d;var f=a.Util.getObject("parameters",b)||[];for(d=0;d<f.length;++d){var g=f[d];this._profileParameters[g.name]=g.value}this._adRenderers=a.Util.getObject("rendererManifest.adRenderers.adRenderer",
b)||[];for(d=0;d<this._adRenderers.length;d++)"undefined"!==typeof this._adRenderers[d].adUnit&&(this._adRenderers[d].baseUnit=this._adRenderers[d].adUnit,delete this._adRenderers[d].adUnit);f=a.Util.getObject("ads.ads",b)||[];for(d=0;d<f.length;++d)g=new a.Ad(this._context),g.parse(f[d]),this._ads.push(g);f=a.Util.getObject("siteSection.videoPlayer.videoAsset.adSlots",b)||[];for(d=0;d<f.length;++d)g=new a.Slot(this._context),g.setType(a.SLOT_TYPE_TEMPORAL),g.setBase(c),g.parse(f[d]),this._temporalSlots.push(g);
f=a.Util.getObject("siteSection.videoPlayer.adSlots",b)||[];for(d=0;d<f.length;++d)g=new a.Slot(this._context),g.setType(a.SLOT_TYPE_VIDEOPLAYER_NONTEMPORAL),g.setTimePositionClass(a.TIME_POSITION_CLASS_DISPLAY),g.parse(f[d]),this._initSlotData(g),this._videoPlayerNonTemporalSlots.push(g);f=a.Util.getObject("siteSection.adSlots",b)||[];for(d=0;d<f.length;++d)g=new a.Slot(this._context),g.setType(a.SLOT_TYPE_SITESECTION_NONTEMPORAL),g.setTimePositionClass(a.TIME_POSITION_CLASS_DISPLAY),g.parse(f[d]),
this._initSlotData(g),this._siteSectionNonTemporalSlots.push(g);b=a.Util.getObject("siteSection.videoPlayer.videoAsset",b)||{};this._context._videoAsset.parse(b)},getCreative:function(a,c){return(a=this.getAd(a))?a.getCreative(c):null},getAd:function(a){for(var b=0;b<this._ads.length;b++){var d=this._ads[b];if(d.getId()===a)return d}return null},getTemporalSlots:function(){return this._temporalSlots},getSiteSectionNonTemporalSlots:function(){return this._siteSectionNonTemporalSlots},getVideoPlayerNonTemporalSlots:function(){return this._videoPlayerNonTemporalSlots},
getSiteSectionCustomId:function(){return this._siteSectionCustomId},getSlotByCustomId:function(b){for(var c=0;c<this._temporalSlots.length;++c)if(this._temporalSlots[c].getCustomId()===b)return this._temporalSlots[c];for(c=0;c<this._videoPlayerNonTemporalSlots.length;++c)if(this._videoPlayerNonTemporalSlots[c].getCustomId()===b)return this._videoPlayerNonTemporalSlots[c];for(c=0;c<this._siteSectionNonTemporalSlots.length;++c)if(this._siteSectionNonTemporalSlots[c].getCustomId()===b)return this._siteSectionNonTemporalSlots[c];
a.warn("getSlotByCustomId(): not found",b);return null},_initSlotData:function(b){for(var c=!1,d=0;d<this._context._adRequest._slotScanner._knownSlots.length;d++){var f=this._context._adRequest._slotScanner._knownSlots[d];if(b.getCustomId()===f.id&&f.element){b.setWidth(f.width);b.setHeight(f.height);b.setBase(f.element);b.setAcceptCompanion(f.acceptCompanion);b.setInitialAdOption(f.initialAdOption);c=!0;break}}c||a.warn("Failed to init slot "+b.getCustomId());return c}});a.Capabilities=function(a){this._capabilities=
{};this.init()};a.Capabilities.prototype={init:function(){for(var b=[a.CAPABILITY_SLOT_TEMPLATE,a.CAPABILITY_MULTIPLE_CREATIVE_RENDITIONS,a.CAPABILITY_FALLBACK_UNKNOWN_ASSET,a.CAPABILITY_FALLBACK_UNKNOWN_SITE_SECTION,a.CAPABILITY_FALLBACK_ADS,a.CAPABILITY_SLOT_CALLBACK,a.CAPABILITY_NULL_CREATIVE,a.CAPABILITY_AUTO_EVENT_TRACKING,a.CAPABILITY_RENDERER_MANIFEST],c=0;c<b.length;c++)this._capabilities[b[c]]=a.CAPABILITY_STATUS_ON},setCapability:function(a,c){this._capabilities[a]=c},getCapability:function(a){return this._capabilities[a]},
parseCapabilities:function(b){var c="",d;for(d in this._capabilities)if(this._capabilities.hasOwnProperty(d)){switch(this._capabilities[d]){case a.CAPABILITY_STATUS_ON:c+="+"+d;break;case a.CAPABILITY_STATUS_OFF:c+="-"+d}b=b.replace(new RegExp("(%2B|-|\\+)"+d,"g"),"")}c=encodeURIComponent(c);return b=-1<b.indexOf("flag=")?b.replace(/flag=/,"flag="+c):b+("&flag="+c)}};a.ContentVideoExtension=function(){this.autoSourceRestore=this.respondPauseResume=!0;this._originalTime=0;this._contentVideoControls=
this._contentVideoSrc=null};a.ContentVideoExtension.prototype={_isEnabled:function(){var b=this._context.getParameter(a.PARAMETER_EXTENSION_CONTENT_VIDEO_ENABLED);return(null===b||!0===a.Util.str2bool(b))&&null!==this._context.getContentVideoElement()},_getBooleanParameter:function(b,c){b=this._context.getParameter(b);null==b&&(b=c);return a.Util.str2bool(b)},init:function(b){a.debug("ContentVideoExtension.init(context)");this._context=b;this._fixContentVideoCurrentTime=a.Util.bind(this,function(b){if(!(0>=
this._context.getContentVideoElement().currentTime||0>=this._context.getContentVideoElement().seekable.length)&&(this._context.getContentVideoElement().removeEventListener("timeupdate",this._fixContentVideoCurrentTime,!1),0<this._context.getContentVideoElement().currentTime&&1>this._context.getContentVideoElement().currentTime&&1<this._originalTime)){a.log("ContentVideoExtension: seeking to original time",this._originalTime);try{this._context.getContentVideoElement().currentTime=this._originalTime}catch(d){a.warn("ContentVideoExtension: seek error")}}});
this._pause=a.Util.bind(this,function(b){this._isEnabled()?this._respondPauseResume()&&(a.debug("ContentVideoExtension: EVENT_CONTENT_VIDEO_PAUSE_REQUEST pausing content video",this._context.getContentVideoElement().src),this._originalTime=this._context.getContentVideoElement().currentTime,this._context.getContentVideoElement().pause()):a.debug("ContentVideoExtension: extension is not enabled, do nothing.")});this._resume=a.Util.bind(this,function(b){this._isEnabled()?this._respondPauseResume()&&
(a.debug("ContentVideoExtension: EVENT_CONTENT_VIDEO_RESUME_REQUEST resume content video",this._context.getContentVideoElement().src),!this._context._videoAsset||null!=this._context._videoAsset._state&&this._context._videoAsset._state!==a.VIDEO_STATE_COMPLETED?(a.log("ContentVideoExtension: resume content video"),this._context.getContentVideoElement().play(),a.PLATFORM_AUTO_SEEK_AFTER_MIDROLL&&!0===this._getBooleanParameter(a.PARAMETER_EXTENSION_CONTENT_VIDEO_AUTO_SEEK_BACK,!0)&&this._context.getContentVideoElement().addEventListener("timeupdate",
this._fixContentVideoCurrentTime,!1)):a.warn("ContentVideoExtension: video state is uninitialized or completed, skip resume.")):a.debug("ContentVideoExtension: extension is not enabled, do nothing.")});this._onAttach=a.Util.bind(this,function(b){if(!this._isEnabled())a.debug("ContentVideoExtension: extension is not enabled, do nothing.");else if(this._autoSourceRestore())switch(b.slot.getTimePositionClass()){case a.TIME_POSITION_CLASS_PREROLL:case a.TIME_POSITION_CLASS_POSTROLL:a.debug("ContentVideoExtension: store current content video src",
this._context.getContentVideoElement().src),this._contentVideoSrc=this._context.getContentVideoElement().src,this._contentVideoControls=this._context.getContentVideoElement().controls,this._context.getContentVideoElement().paused||this._context.getContentVideoElement().pause()}});this._onDetach=a.Util.bind(this,function(b){if(!this._isEnabled())a.debug("ContentVideoExtension: extension is not enabled, do nothing.");else if(this._autoSourceRestore())switch(b=b.slot.getTimePositionClass(),b){case a.TIME_POSITION_CLASS_PREROLL:case a.TIME_POSITION_CLASS_POSTROLL:a.debug("ContentVideoExtension: restore content video src to",
this._contentVideoSrc),this._context.getContentVideoElement().src!==this._contentVideoSrc&&(this._context.getContentVideoElement().src=this._contentVideoSrc),this._context.getContentVideoElement().controls=this._contentVideoControls,b===a.TIME_POSITION_CLASS_PREROLL&&this._context.getContentVideoElement().load()}});a.debug("ContentVideoExtension: enabling content video pause resume request handling.");this._context.addEventListener(a.EVENT_CONTENT_VIDEO_PAUSE_REQUEST,this._pause);this._context.addEventListener(a.EVENT_CONTENT_VIDEO_RESUME_REQUEST,
this._resume);a.debug("ContentVideoExtension: enabling content video source management.");this._context.addEventListener(a.EVENT_SLOT_STARTED,this._onAttach);this._context.addEventListener(a.EVENT_SLOT_ENDED,this._onDetach)},_respondPauseResume:function(){return this._getBooleanParameter(a.PARAMETER_EXTENSION_CONTENT_VIDEO_RESPOND_PAUSE_RESUME,!0)},_autoSourceRestore:function(){return this._getBooleanParameter(a.PARAMETER_EXTENSION_CONTENT_VIDEO_AUTO_SOURCE_RESTORE,!0)},dispose:function(){a.debug("ContentVideoExtension.dispose()");
this._context&&(this._context.removeEventListener(a.EVENT_CONTENT_VIDEO_PAUSE_REQUEST,this._pause),this._context.removeEventListener(a.EVENT_CONTENT_VIDEO_RESUME_REQUEST,this._resume),this._context.removeEventListener(a.EVENT_SLOT_STARTED,this._onAttach),this._context.removeEventListener(a.EVENT_SLOT_ENDED,this._onDetach),this._context=null)}};a.ContentVideoExtension.prototype.constructor=a.ContentVideoExtension;a._instanceCounter=0;a._instanceQueue={};a.Context=function(b){this._adManager=b;this._eventDispatcher=
new a.EventDispatcher;this._adRequest=new a.AdRequest(this);this._adResponse=null;this._videoAsset=new a.VideoAsset(this);this._temporalSlotBase=null;this._videoDisplaySize={};this._globalLevelParameterDictionary={};this._overrideLevelParameterDictionary={};this._rendererManifest={};this._overriddenAdRenderers=[];this._extensionManager=new a.ExtensionManager(this);this._totalSetDisplaySizeCount=this._autoSetDisplaySizeCount=this._requestState=0;this._instanceId=a._instanceCounter;a._instanceQueue["Context_"+
a._instanceCounter]=this;a._instanceCounter++;this._contentVideoAttached=!1;this._currentContentPlayheadTime=0;this._ss_id="";this._ss_networkId=this._ss_pageViewRandom=0;this._ss_idType=a.ID_TYPE_CUSTOM;this._va_location=this._va_networkId=this._va_duration=this._va_id=this._ss_fallbackId="";this._va_autoPlayType=a.VIDEO_ASSET_AUTO_PLAY_TYPE_ATTENDED;this._va_fallbackId="";this._va_viewRandom=0;this._va_idType=a.ID_TYPE_CUSTOM;this._va_durationType=a.VIDEO_ASSET_DURATION_TYPE_EXACT;this._isRefreshRequest=
!1;this._refreshSlots=[];this._adVolume=1;this._onVolumeChange=this.__onVolumeChange.bind(this)};a.Context.prototype={getAdVolume:function(a){return this._adVolume},setAdVolume:function(b){a.debug("Context.setAdVolume",b);if(this.getContentVideoElement())if("number"!==typeof b||0>b||1<b)a.debug("Invalid volume: "+b);else if((a.PLATFORM_IS_IPHONE_IPOD||a.PLATFORM_IS_IPAD)&&0<b&&1>b)a.debug("iOS doesn't allow volume values other than 0 and 1, ignore.");else if(b==this._adVolume)a.debug("Volume did not change, ignore.");
else{this._adVolume=b;b=this.getTemporalSlots();for(var c=0;c<b.length;++c){var d=b[c];if(d.getType()==a.SLOT_TYPE_TEMPORAL&&d.getState()!==a.MediaInitState.instance&&d.getState()!==a.MediaEndState.instance&&(d=d.getCurrentAdInstance())){d.setVolume(this._adVolume);break}}}else a.debug("No video element set, ignore.")},__onVolumeChange:function(b){a.debug("Context._onVolumeChange(): video element is muted: "+this.getContentVideoElement().muted);0!=this._adVolume||this.getContentVideoElement().muted?
this.setAdVolume(this.getContentVideoElement().muted?0:this.getContentVideoElement().volume):this.setAdVolume(this.getContentVideoElement().volume)},addRenderer:function(a,c,d,f,g,k,h){this._overriddenAdRenderers.push({url:a,baseUnit:c,contentType:d,creativeApi:k,slotType:f,soAdUnit:g,parameter:h})},setCapability:function(b,c){a.debug("Context.setCapability",b,c);this._adRequest.setCapability(b,c)},addKeyValue:function(b,c){a.debug("Context.addKeyValue",b,c);this._adRequest.addKeyValue(b,c)},setParameter:function(b,
c,d){a.debug("Context.setParameter",b,c,d);if(d===a.PARAMETER_LEVEL_GLOBAL)d=this._globalLevelParameterDictionary;else if(d===a.PARAMETER_LEVEL_OVERRIDE)d=this._overrideLevelParameterDictionary;else return;null==c?delete d[b]:d[b]=c},getParameter:function(a){return a?this._overrideLevelParameterDictionary.hasOwnProperty(a)?this._overrideLevelParameterDictionary[a]:this._adResponse&&this._adResponse._profileParameters.hasOwnProperty(a)?this._adResponse._profileParameters[a]:this._globalLevelParameterDictionary.hasOwnProperty(a)?
this._globalLevelParameterDictionary[a]:null:null},setVideoState:function(b){a.debug("Context.setVideoState",b);this._videoAsset.setVideoState(b)},registerVideoDisplayBase:function(b){a.debug("Context.registerVideoDisplayBase",b);if(b&&"string"===typeof b){if(this._temporalSlotBase&&this._temporalSlotBase.id===b){a.debug("Context.registerVideoDisplayBase","register the same display base, will only change size");var c=this._temporalSlotBase.getElementsByTagName("video")}else{this._temporalSlotBase&&
this.getContentVideoElement().removeEventListener("volumechange",this._onVolumeChange);this._temporalSlotBase=document.getElementById(b);if(!this._temporalSlotBase){a.warn("Context.registerVideoDisplayBase","could not get element",b);return}c=this._temporalSlotBase.getElementsByTagName("video");if(0===c.length){a.warn("Context.registerVideoDisplayBase","could not get video element from",b);this._temporalSlotBase=null;return}this._temporalSlotBase["_fw_contentVideo_"+this._instanceId]=c[0];this.getContentVideoElement().addEventListener("volumechange",
this._onVolumeChange);this._adVolume=c[0].muted?0:c[0].volume}this._setVideoDisplaySizeByContentVideo(c[0])}else a.warn("Context.registerVideoDisplayBase","id required")},setContentVideoElement:function(b){a.debug("Context.setContentVideoElement()");if(b&&b.parentNode){var c=this._temporalSlotBase;this._temporalSlotBase=b.parentNode;this._temporalSlotBase["_fw_contentVideo_"+this._instanceId]===b?a.debug("Context.setContentVideoElement","set the same video in same div, will only change size"):(c&&
c["_fw_contentVideo_"+this._instanceId]&&c["_fw_contentVideo_"+this._instanceId].removeEventListener("volumechange",this._onVolumeChange),this._temporalSlotBase["_fw_contentVideo_"+this._instanceId]=b,this.getContentVideoElement().addEventListener("volumechange",this._onVolumeChange),this._adVolume=this.getContentVideoElement().muted?0:this.getContentVideoElement().volume);this._setVideoDisplaySizeByContentVideo(b)}else a.warn("Context.setContentVideoElement","contentVideo and contentVideo.parentNode is required")},
getContentVideoElement:function(){return this._temporalSlotBase?this._temporalSlotBase["_fw_contentVideo_"+this._instanceId]:(a.warn("SlotBase is null"),null)},setVideoDisplaySize:function(b,c,d,f,g){a.debug("Context.setVideoDisplaySize("+Array.prototype.slice.call(arguments).join(",")+")");this._totalSetDisplaySizeCount++;this._videoDisplaySize={left:b,top:c,width:d,height:f,position:g};for(var k=this.getTemporalSlots(),h=0;h<k.length;++h){var l=k[h];l.setWidth(d);l.setHeight(f);if(l.getState()===
a.MediaPlayingState.instance||l.getState()===a.MediaReplayingState.instance){if(k=l.getCurrentAdInstance())(k=k.getRendererController().getRenderer())&&k.resize?k.resize():a.debug("renderer do not support resize");break}}},getVideoDisplaySize:function(){function a(a){a=parseInt(a,10);isNaN(a)&&(a=0);return a}this._videoDisplaySize.left=a(this._videoDisplaySize.left);this._videoDisplaySize.right=a(this._videoDisplaySize.right);this._videoDisplaySize.width=a(this._videoDisplaySize.width);this._videoDisplaySize.height=
a(this._videoDisplaySize.height);return this._videoDisplaySize},setVideoDisplayCompatibleSizes:function(b){a.debug("Context.setVideoDisplayCompatibleSizes",b);this._adRequest.setVideoDisplayCompatibleSizes(b)},resize:function(b,c){a.debug("Context.resize("+Array.prototype.slice.call(arguments).join(",")+")");if(!this._temporalSlotBase)return a.warn("SlotBase is null"),null;this.setVideoDisplaySize(this._videoDisplaySize.left,this._videoDisplaySize.right,b,c,this._videoDisplaySize.position)},setProfile:function(b){a.debug("Context.setProfile",
b);this._adRequest.setProfile(b)},setVideoAsset:function(b,c,d,f,g,k,h,l,m){a.debug("Context.setVideoAsset("+Array.prototype.slice.call(arguments).join(",")+")");this._videoAsset.setVideoAsset(b,c,d,f,g,k,h,l,m);this._va_id=b;this._va_duration=c;this._va_networkId=d;this._va_location=f;this._va_autoPlayType=g;this._va_viewRandom=k;this._va_idType=h;this._va_fallbackId=l;this._va_durationType=m},setVideoAssetCurrentTimePosition:function(b){a.debug("Context.setVideoAssetCurrentTimePosition("+b+")");
this._videoAsset.setVideoAssetCurrentTimePosition(b)},setSiteSection:function(b,c,d,f,g){a.debug("Context.setSiteSection("+Array.prototype.slice.call(arguments).join(",")+")");this._adRequest.setSiteSection(b,c,d,f,g);this._ss_id=b;this._ss_networkId=c;this._ss_pageViewRandom=d;this._ss_idType=f;this._ss_fallbackId=g},setVisitor:function(b,c){a.debug("Context.setVisitor("+Array.prototype.slice.call(arguments).join(",")+")");this._adRequest.setVisitor(b,c)},startSubsession:function(b){a.debug("Context.startSubsession("+
b+")");this._adRequest.setSubsessionToken(b)},setRequestMode:function(b){a.debug("Context.setRequestMode("+b+")");this._adRequest.setRequestMode(b)},setRequestDuration:function(b){a.debug("Context.setRequestDuration("+b+")");this._adRequest.setRequestDuration(b)},addCandidateAd:function(b){a.debug("Context.addCandidateAd("+b+")");this._adRequest.addCandidateAd(b)},addTemporalSlot:function(b,c,d,f,g,k,h,l){a.debug("Context.addTemporalSlot("+Array.prototype.slice.call(arguments).join(",")+")");this._adRequest.addTemporalSlot(b,
c,d,f,g,k,h,l)},getTemporalSlots:function(){return this._adResponse?this._adResponse._temporalSlots.slice():[]},getSlotByCustomId:function(a){return this._adResponse?this._adResponse.getSlotByCustomId(a):null},getSlotsByTimePositionClass:function(a){var b=[];if(this._adResponse){for(var d=0;d<this._adResponse._temporalSlots.length;d++)this._adResponse._temporalSlots[d].getTimePositionClass()===a&&b.push(this._adResponse._temporalSlots[d]);for(d=0;d<this._adResponse._siteSectionNonTemporalSlots.length;d++)this._adResponse._siteSectionNonTemporalSlots[d].getTimePositionClass()===
a&&b.push(this._adResponse._siteSectionNonTemporalSlots[d]);for(d=0;d<this._adResponse._videoPlayerNonTemporalSlots.length;d++)this._adResponse._videoPlayerNonTemporalSlots[d].getTimePositionClass()===a&&b.push(this._adResponse._videoPlayerNonTemporalSlots[d])}return b},submitRequest:function(b){a.debug("Context.submitRequest",b);this.dispatchEvent(a.EVENT_REQUEST_INITIATED,{});if(this._requestState)a.warn("Context.submitRequest: request already submitted");else if(a.Util.isBlank(this._adManager._serverURL))a.warn("Context.submitRequest: serverURL is not set");
else{this._requestState=1;this._adRequest.scanPageSlots();if(this._isRefreshRequest){for(var c={},d=[],f=0;f<this._refreshSlots.length;f++){var g=this._refreshSlots[f];if(void 0!=this._adRequest._slotScanner._slots[g]){c[g]=this._adRequest._slotScanner._slots[g];for(var k=c[g].split("&"),h=0;h<k.length;h++)-1!==k[h].search("flag")&&(k[h]="flag=-cmpn");c[g]=k.join("&")}for(h=0;h<this._adRequest._slotScanner._knownSlots.length;h++)this._adRequest._slotScanner._knownSlots[h].id==g&&(k=this._adRequest._slotScanner._knownSlots[h],
k.acceptCompanion=!1,k.initialAdOption=a.SLOT_OPTION_INITIAL_AD_STAND_ALONE,d.push(k))}this._adRequest._slotScanner._slots=c;this._adRequest._slotScanner._knownSlots=d}this.getParameter(a.PARAMETER_ENABLE_FORM_TRANSPORT)&&(a.debug("Context.submitRequest: enabling Safari transport mechanism globally"),a.PLATFORM_SEND_REQUEST_BY_FORM=!0);c=this._adManager._serverURL;".js"!==c.substring(c.length-3,c.length)&&(c=this._adRequest.generateTypeBRequestUrl());var l=this;if("number"!==typeof b||0>=b||!b)b=
5;setTimeout(function(){1===l._requestState&&(a.warn("Context.submitRequest: request timeout"),l.requestComplete(null))},1E3*b);a.log("Context.submitRequest: sending request to",c,"timeout",b);a.PLATFORM_SEND_REQUEST_BY_FORM?(a.debug("Context.submitRequest:","use json2"),a.Util.pingURLWithForm(c,this._instanceId,!0),l._onMessagePosted=function(a){"object"===typeof a.data&&a.data.hasOwnProperty("cbfn")&&-1<a.data.cbfn.indexOf("['Context_"+l._instanceId+"']")&&l.requestComplete(a.data.response)},window.addEventListener("message",
l._onMessagePosted,!1)):a.Util.pingURLWithScript(c)}},requestComplete:function(b){if(1!==this._requestState)a.warn("ad request complete after timeout"),this.dispatchEvent(a.EVENT_REQUEST_COMPLETE,{success:!1});else{this._requestState=2;a.debug("Context.requestComplete");if(a.PLATFORM_SEND_REQUEST_BY_FORM){window.removeEventListener("message",this._onMessagePosted,!1);var c=document.getElementById("_fw_request_iframe_"+this._instanceId);document.body.removeChild(c)}if(null!==b){a._instanceQueue["Context_"+
this._instanceId]=null;this._adResponse=new a.AdResponse(this);this._adResponse.parse(b,this._temporalSlotBase);a.log("Ad request succeeded");c=(this._adResponse._profileParameters.autoloadExtensions||"").split(",");for(var d=0;d<c.length;d++){var f=c[d].trim();a.log("Loading extension: "+f);this.loadExtension(f)}this.dispatchEvent(a.EVENT_REQUEST_COMPLETE,{success:!0,response:b});c=this._adResponse.getSiteSectionNonTemporalSlots();for(b=0;b<c.length;++b)a.log("Auto play site section nonTemporal slots"),
c[b].play();c=this._adResponse.getVideoPlayerNonTemporalSlots();for(b=0;b<c.length;++b)a.log("Auto play video player nonTemporal slots"),c[b].play()}else a.warn("Ad request failed"),this.dispatchEvent(a.EVENT_REQUEST_COMPLETE,{success:!1})}},addEventListener:function(b,c){a.debug("Context.addEventListener",b);this._eventDispatcher.addEventListener(b,c)},removeEventListener:function(b,c){a.debug("Context.removeEventListener",b);this._eventDispatcher.removeEventListener(b,c)},dispatchEvent:function(b,
c){a.log("Context.dispatchEvent",b);if(b===a.EVENT_SLOT_STARTED){var d=c.slot.getTimePositionClass();if(d===a.TIME_POSITION_CLASS_PREROLL||d===a.TIME_POSITION_CLASS_MIDROLL||d===a.TIME_POSITION_CLASS_POSTROLL)this._contentVideoAttached=!0,this._markCurrentContentPlayheadTime()}else b===a.EVENT_SLOT_ENDED&&(d=c.slot.getTimePositionClass(),d===a.TIME_POSITION_CLASS_PREROLL||d===a.TIME_POSITION_CLASS_MIDROLL||d===a.TIME_POSITION_CLASS_POSTROLL)&&(this._contentVideoAttached=!1);c=c||{};c.type=b;c.target=
this;this._eventDispatcher.dispatchEvent(c)},dispose:function(){a.debug("Context.dispose");this.setVideoState(a.VIDEO_STATE_STOPPED);if(this._adResponse){if(this._temporalSlotBase){for(var b=0,c=this._adResponse._temporalSlots||[];b<c.length;++b){var d=c[b];if(d._onContentVideoTimeUpdate){var f=this._temporalSlotBase["_fw_contentVideo_"+this._instanceId];f&&f.removeEventListener("timeupdate",d._onContentVideoTimeUpdate,!1);d._onContentVideoTimeUpdate=null}}this.getContentVideoElement().removeEventListener("volumechange",
this._onVolumeChange);this._temporalSlotBase["_fw_contentVideo_"+this._instanceId]=null}this._isRefreshRequest=!1;this._refreshSlots=[];this._extensionManager.dispose();this._extensionManager=null}},loadExtension:function(a){this._extensionManager.load(a,this)},_markCurrentContentPlayheadTime:function(){var a=this._temporalSlotBase["_fw_contentVideo_"+this._instanceId].currentTime;0<a&&(this._currentContentPlayheadTime=a)},_getContentPlayheadTime:function(){var a=-1;!this._contentVideoAttached&&this._temporalSlotBase&&
this._temporalSlotBase["_fw_contentVideo_"+this._instanceId]&&(a=this._temporalSlotBase["_fw_contentVideo_"+this._instanceId].currentTime);return 0<a?a:this._currentContentPlayheadTime},_requestContentVideoToPauseBySlot:function(a){this._videoAsset.requestPauseBySlot(a)},_requestContentVideoToResumeBySlot:function(a){this._videoAsset.requestResumeBySlot(a)},_setVideoDisplaySizeByContentVideo:function(a){if(this._autoSetDisplaySizeCount===this._totalSetDisplaySizeCount){var b=a.style.left,d=a.style.top,
f=a.offsetWidth?a.offsetWidth:a.style.pixelWidth,g=a.offsetHeight?a.offsetHeight:a.style.pixelHeight;a=a.style.position;this._autoSetDisplaySizeCount++;this.setVideoDisplaySize(b,d,f,g,a)}},_replacePageSlot:function(b,c){navigator.userAgent.match(/MSIE/);var d=null!=navigator.userAgent.match(/Firefox/);a.debug("fw replace %s",b);var f;try{var g=document.getElementById(b)?document:parent.document.getElementById(b)?parent.document:null;var k=document.getElementById(b)?"window":parent.document.getElementById(b)?
"parent":null}catch(q){k=g=null}if(!g)for(var h=0;h<window.frames.length;h++)try{window.frames[h].document.getElementById(b)&&(g=window.frames[h].document,k="window.frames["+h+"]")}catch(q){a.debug(q)}k&&(f=k+".document");a.debug("fw replacing slot %s in frame %s",b,f);if(!g)throw"Slot element not found: "+b;h=g.getElementById("_fw_container_"+b);h.innerHTML=c;c=h.getElementsByTagName("script");var l=g.getElementsByTagName("head")[0];for(h=0;h<c.length;++h)if(d||c[h].src){var m=g.createElement("script");
c[h].charset&&(m.charset=c[h].charset);c[h].src&&(m.src=c[h].src);c[h].innerHTML&&(m.innerHTML=c[h].innerHTML);m.onload=m.onreadystatechange=function(){this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||l.removeChild(m)};a.debug("fw append script for %s",b);l.appendChild(m)}else m=c[h].innerHTML,m=m.replace(/var fw_scope = document;/,"var fw_scope="+f+";"),m=m.replace(/var fw_scope_window = window;/,"var fw_scope_window="+k+";"),a.debug("fw eval in %s for %s, %s",f,b,m),eval(m);
a.debug("fw finish replace %s",b)}};a.Context.prototype.constructor=a.Context;a.DisplayRefreshExtension=function(){this.REFRESH_TYPE_NONE="refresh_none";this.REFRESH_TYPE_AD="refresh_ad";this.REFRESH_TYPE_TIME="refresh_time";this.REPLACE_TYPE_NONE="replace_none";this.REPLACE_TYPE_BLANK="replace_blank";this.REPLACE_TYPE_AD="replace_ad";this._subContext=null;this._displaySlots=[];this._companionSlots=[];this._keyValues=[];this._globalParameters=[];this._overrideParameters=[];this._refreshType=this.REFRESH_TYPE_NONE;
this._replaceType=this.REPLACE_TYPE_NONE;this._refreshInterval=0;this._refreshTimer=null;this._firstTemporalAd=!0;this._REQUEST_TIME_OUT=5};a.DisplayRefreshExtension.prototype={init:function(b){this._context=b;a.debug("DisplayRefreshExtension.init(context)");this._onRendererEvent=a.Util.bind(this,function(b){a.debug("DisplayRefreshExtension._onRendererEvent()");b.subType===a.EVENT_AD_IMPRESSION&&this._onAdStarted(b)});this._onSlotEnded=a.Util.bind(this,function(b){var c=b.slot.getTimePositionClass();
b=b.slot;a.debug("DisplayRefreshExtension._onSlotEnded()",b,c);if(null!=b&&c!=a.TIME_POSITION_CLASS_DISPLAY&&0!=b.getAdInstances().length)if(this._refreshType==this.REFRESH_TYPE_AD)this._resetSubContext(),this._refreshSlots(this._displaySlots);else if(this._refreshType==this.REFRESH_TYPE_TIME){this._resetSubContext();this._refreshSlots(this._displaySlots);var f=this;this._refreshTimer=setInterval(function(){a.debug("DisplayRefreshExtension._onTimeout()");f._resetSubContext();f._refreshSlots(f._displaySlots)},
1E3*this._refreshInterval)}});this._onRequestComplete=a.Util.bind(this,function(b){a.debug("DisplayRefreshExtension._onRequestComplete()");if(b.success){switch(this._context.getParameter("refreshType")){case "ad":this._refreshType=this.REFRESH_TYPE_AD;break;case "time":this._refreshInterval=this._context.getParameter("refreshInterval");this._refreshType=0<this._refreshInterval?this.REFRESH_TYPE_TIME:this.REFRESH_TYPE_NONE;break;default:this._refreshType=this.REFRESH_TYPE_NONE}switch(this._context.getParameter("replaceMissingCompanion")){case "blank":this._replaceType=
this.REPLACE_TYPE_BLANK;break;case "ad":this._replaceType=this.REPLACE_TYPE_AD;break;default:this._replaceType=this.REPLACE_TYPE_NONE}if(this._refreshType!=this.REFRESH_TYPE_NONE||this._replaceType!=this.REPLACE_TYPE_NONE){if(this._displaySlots=this._context.getSlotsByTimePositionClass(a.TIME_POSITION_CLASS_DISPLAY),this._companionSlots=this._displaySlots.filter(function(a,b,c){return a.getAcceptCompanion()}),this._keyValues=this._context._adRequest._keyValues,this._globalParameters=this._context._globalLevelParameterDictionary,
this._overrideParameters=this._context._overrideLevelParameterDictionary,this._firstTemporalAd=!0,this._context.addEventListener(a.EVENT_AD,this._onRendererEvent),this._context.addEventListener(a.EVENT_SLOT_ENDED,this._onSlotEnded),this._refreshType==this.REFRESH_TYPE_TIME){var c=this;this._refreshTimer=setInterval(function(){a.debug("DisplayRefreshExtension._onTimeout()");c._resetSubContext();c._refreshSlots(c._displaySlots)},1E3*this._refreshInterval)}}else this._refreshTimer&&clearInterval(this._refreshTimer)}else a.debug("DisplayRefreshExtension: request complete failed")});
this._context.addEventListener(a.EVENT_REQUEST_COMPLETE,this._onRequestComplete)},_resetSubContext:function(){a.debug("DisplayRefreshExtension._resetSubContext()");this._subContext=this._context._adManager.cloneContext(this._context);this._subContext._extensionManager._displayRefreshExtension.dispose();this._subContext._extensionManager._videoStateExtension.dispose();this._subContext.setCapability(a.CAPABILITY_SLOT_TEMPLATE,a.CAPABILITY_STATUS_OFF);this._subContext.setCapability(a.CAPABILITY_DISPLAY_REFRESH,
a.CAPABILITY_STATUS_ON);this._playRefreshedSlots=a.Util.bind(this,function(b){a.debug("DisplayRefreshExtension._playRefreshedSlots()");if(b.success){b=this._subContext.getSlotsByTimePositionClass(a.TIME_POSITION_CLASS_DISPLAY);for(var c=0;c<b.length;c++)b[c].play()}else a.debug("DisplayRefreshExtension._playRefreshedSlots(): subContext refresh request error:",b)});this._subContext.addEventListener(a.EVENT_REQUEST_COMPLETE,this._playRefreshedSlots);for(var b=this._subContext._adRequest._keyValues,
c=0;c<this._keyValues.length;c++)0>b.indexOf(this._keyValues[c])&&b.push(this._keyValues[c]);for(var d in this._globalParameters)this._globalParameters.hasOwnProperty(d)&&this._subContext.setParameter(d,this._globalParameters[d],a.PARAMETER_LEVEL_GLOBAL);for(d in this._overrideParameters)this._overrideParameters.hasOwnProperty(d)&&this._subContext.setParameter(d,this._overrideParameters[d],a.PARAMETER_LEVEL_OVERRIDE)},_onAdStarted:function(b){a.debug("DisplayRefreshExtension._onAdStarted()");var c=
b.adInstance.getSlot();a.debug("DisplayRefreshExtension._onAdStarted(): slot: ",c," | timePositionClass:",c.getTimePositionClass());if(null!=c&&c.getTimePositionClass()!=a.TIME_POSITION_CLASS_DISPLAY&&(this._resetSubContext(),this._refreshTimer&&clearInterval(this._refreshTimer),this._replaceType!=this.REPLACE_TYPE_NONE)){b=b.adInstance;c=c.getAdInstances();for(var d=0;d<c.length;d++)b.getAdId()===c[d].getAdId()&&this._checkMissingCompanionForAd(b)}},_checkMissingCompanionForAd:function(b){a.debug("DisplayRefreshExtension._checkMissingCompanionForAd()",
b);var c=this._companionSlots.slice();b=b.getCompanionAdInstances();for(var d=0;d<b.length;d++){var f=c.indexOf(b[d].getSlot());-1<f&&c.splice(f,1)}this._firstTemporalAd&&(this._firstTemporalAd=!1,c=c.filter(function(b,c,d){if(b.getInitialAdOption()!=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_ONLY&&b.getInitialAdOption()!=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_STAND_ALONE&&b.getInitialAdOption()!=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_THEN_STAND_ALONE&&b.getInitialAdOption()!=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_NO_STAND_ALONE&&
b.getInitialAdOption()!=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_NO_STAND_ALONE_IF_TEMPORAL)return a.debug("DisplayRefreshExtension._checkMissingCompanionForAd(): firstCompanionAsInitial false in slot ",b.getCustomId()),!0;c=b.getAdInstances();for(d=0;d<c.length;d++)if(!c[d].isPlaceholder())return a.debug("DisplayRefreshExtension._checkMissingCompanionForAd(): first companion found in slot ",b.getCustomId()),!1;a.debug("DisplayRefreshExtension._checkMissingCompanionForAd(): firstCompanionAsInitial true, no ad in slot ",
b.getCustomId());return!0}));if(this._replaceType==this.REPLACE_TYPE_BLANK)for(d=0;d<c.length;d++)c[d].stop(),this._subContext._replacePageSlot(c[d].getCustomId(),"");else this._replaceType==this.REPLACE_TYPE_AD&&this._refreshSlots(c)},_refreshSlots:function(b){a.debug("DisplayRefreshExtension._refreshSlots()",b);if(null!=b&&0!=b.length){for(var c=0;c<b.length;c++)b[c].stop(),this._subContext._refreshSlots.push(b[c].getCustomId());this._subContext._isRefreshRequest=!0;this._subContext.submitRequest(this._REQUEST_TIME_OUT)}},
dispose:function(){a.debug("DisplayRefreshExtension.dispose()");this._context&&(this._context.removeEventListener(a.EVENT_REQUEST_COMPLETE,this._onRequestComplete),this._context.removeEventListener(a.EVENT_SLOT_ENDED,this._onSlotEnded),this._context.removeEventListener(a.EVENT_AD,this._onRendererEvent),this._context=null);this._subContext&&(this._subContext.removeEventListener(a.EVENT_REQUEST_COMPLETE,this._playRefreshedSlots),this._subContext=null);this._displaySlots=[];this._companionSlots=[];this._keyValues=
[];this._globalParameters=[];this._overrideParameters=[];this._refreshType=this.REFRESH_TYPE_NONE;this._replaceType=this.REPLACE_TYPE_NONE;this._refreshInterval=0;this._refreshTimer&&clearInterval(this._refreshTimer);this._refreshTimer=null;this._firstTemporalAd=!0}};a.DisplayRefreshExtension.prototype.constructor=a.DisplayRefreshExtension;a.EventCallback=function(a){this._url=this._name=this._type=null;this._showBrowser=!1;this._trackingUrls=[];this._adInstance=this._slot=null;this._context=a};a.EventCallback.prototype=
{};a.EventCallback.prototype.constructor=a.EventCallback;a.EventCallback.getEventCallback=function(b,c,d){for(var f,g=0;g<b.length;g++)if(f=b[g],f._name===c&&f._type===d)return f;for(g=0;g<b.length;g++)if(f=b[g],f._type===a.EVENT_TYPE_GENERIC){if(c=a.EventCallback.newEventCallback(f._context,c,d))c._url=f._url,c._slot=f._slot,c._adInstance=f._adInstance,b.push(c);return c}return null};a.EventCallback.newEventCallback=function(b,c,d){if(d===a.EVENT_TYPE_GENERIC)b=new a.EventCallback(b);else if(d===
a.EVENT_TYPE_ERROR)b=new a.ErrorEventCallback(b);else if(d===a.EVENT_TYPE_CLICK)b=new a.AdClickEventCallback(b);else if(d===a.EVENT_TYPE_STANDARD)b=new a.AdStandardEventCallback(b);else if(c===a.EVENT_SLOT_IMPRESSION||c===a.EVENT_SLOT_END)b=new a.SlotImpressionEventCallback(b);else if(c===a.EVENT_AD_IMPRESSION||c===a.EVENT_AD_IMPRESSION_END)b=new a.AdImpressionEventCallback(b);else if(c===a.EVENT_VIDEO_VIEW)b=new a.VideoViewEventCallback(b);else if(c===a.EVENT_RESELLER_NO_AD)b=new a.ResellerNoAdEventCallback(b);
else if(c===a.EVENT_AD_FIRST_QUARTILE||c===a.EVENT_AD_MIDPOINT||c===a.EVENT_AD_THIRD_QUARTILE||c===a.EVENT_AD_COMPLETE)b=new a.AdQuartileEventCallback(b);else return null;b._name=c;b._type=d;return b};a.EventCallback.getShortType=function(b){var c="";switch(b){case a.EVENT_TYPE_IMPRESSION:c=a.SHORT_EVENT_TYPE_IMPRESSION;break;case a.EVENT_TYPE_CLICK:c=a.SHORT_EVENT_TYPE_CLICK;break;case a.EVENT_TYPE_STANDARD:c=a.SHORT_EVENT_TYPE_STANDARD;break;case a.EVENT_TYPE_ERROR:c=a.SHORT_EVENT_TYPE_ERROR}return c};
a.Util.mixin(a.EventCallback.prototype,{parse:function(a){if(a){this._usage=a.use;this._type=a.type;this._name=a.name;this._url=a.url;this._showBrowser=a.showBrowser;this._trackingUrls=[];var b=0;for(a=a.trackingUrls||[];b<a.length;b++)this._trackingUrls.push(a[b].value)}},copy:function(){var a=new this.constructor(this._context);a._type=this._type;a._name=this._name;a._url=this._url;a._showBrowser=this._showBrowser;a._trackingUrls=this._trackingUrls.slice();a._slot=this._slot;a._adInstance=this._adInstance;
return a},getUrl:function(b){var c=this._replaceMacrosInUrl(this._url,b);this._name===a.EVENT_AD_MEASUREMENT?(c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_ET,a.SHORT_EVENT_TYPE_IMPRESSION),c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_CONCRETE_EVENT_ID,b[a.INFO_KEY_CONCRETE_EVENT_ID])):c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_ET,a.EventCallback.getShortType(this._type));c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_CN,this._name);this._adInstance&&0<this._adInstance._creativeRenditionId&&
(c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_CREATIVE_RENDITION_ID,this._adInstance._creativeRenditionId));return c},getTrackingUrls:function(b){var c=this._trackingUrls;if(this._adInstance){var d=this._type;d===a.EVENT_TYPE_CLICK&&(d=a.EVENT_TYPE_CLICK_TRACKING);c=c.concat(this._adInstance.getExternalEventCallbackUrls(this._name,d))}d=[];for(var f=0;f<c.length;f++){var g=a.Util.trim(this._replaceMacrosInUrl(c[f],b));a.Util.isBlank(g)||d.push(g)}return d},process:function(b){b=b||{};this._processTrackingUrls(b);
a.Util.pingURL(this.getUrl(b))},_processTrackingUrls:function(b){this._shouldSkipSendingTrackingAndExternalUrls()||a.Util.pingURLs(this.getTrackingUrls(b))},_shouldSkipSendingTrackingAndExternalUrls:function(){return!1},_needEmptyCT:function(b){var c=!1;b&&!0===b[a.INFO_KEY_NEED_EMPTY_CT]&&(c=!0);return c},_getAdPlayheadTime:function(){var a=-1;this._adInstance&&(a=this._adInstance.getPlayheadTime());return a},_getCreativeAssetLocation:function(){var a=null;this._adInstance&&this._adInstance.getActiveCreativeRendition()&&
this._adInstance.getActiveCreativeRendition().getPrimaryCreativeRenditionAsset()&&(a=this._adInstance.getActiveCreativeRendition().getPrimaryCreativeRenditionAsset().getUrl());return a},_getParameter:function(a){return this._adInstance?this._adInstance._rendererController.getParameter(a):this._slot?this._slot.getParameter(a):this._context.getParameter(a)},_replaceVASTMacro:function(b,c,d){a.log("replace VAST Macro: url=",b+", macro="+c+", value="+d);b&&c&&(d=encodeURIComponent(d?d:""),b=b.replace("["+
c+"]",d),b=b.replace("%5B"+c+"%5D",d));return b},_replaceMacrosInUrl:function(b,c){if(a.Util.isBlank(b))return b;c&&c[a.INFO_KEY_VAST_ERROR_CODE]&&(b=this._replaceVASTMacro(b,"ERRORCODE",c[a.INFO_KEY_VAST_ERROR_CODE]));this._getCreativeAssetLocation()&&(b=this._replaceVASTMacro(b,"ASSETURI",this._getCreativeAssetLocation()));var d=this._context._getContentPlayheadTime();this._adInstance&&(c=null!=d&&0<=Number(d)?a.Util.secondsToHms(d):"",b=this._replaceVASTMacro(b,"CONTENTPLAYHEAD",c),b=this._replaceVASTMacro(b,
"CACHEBUSTING",a.Util.getFixedDigitRandomNumber(8)),b=this._replaceVASTMacro(b,"TIMESTAMP",a.Util.getDateStringInISOFormat(new Date)));b=b.replace(/#(ce?)\{([^\}]+)\}/g,a.Util.bind(this,function(b,c,k,h,l){b="ce"===c;c=null;switch(k){case "ad.playheadTime":k=this._getAdPlayheadTime();c=0<=k?Math.round(k)+"":"";break;case "content.playheadTime":c=0<=d?Math.round(d)+"":"";break;case "creative.assetLocation":c=this._getCreativeAssetLocation();break;default:0===k.indexOf("parameter.")&&(c=this._getParameter(k.substr(10)))}a.Util.isBlank(c)&&
(c="");return b?encodeURIComponent(c):c}));c="";try{c=a.Util.getParameterInURL(b,a.URL_PARAMETER_KEY_CR)}catch(f){return a.warn(f),b}a.Util.isBlank(c)||(b=a.Util.setParameterInURL(b,a.URL_PARAMETER_KEY_CR,this._replaceMacrosInUrl(c)));return b}});a.AdClickEventCallback=function(b){a.EventCallback.call(this,b)};a.AdClickEventCallback.prototype=new a.EventCallback;a.AdClickEventCallback.prototype.constructor=a.AdClickEventCallback;a.Util.mixin(a.AdClickEventCallback.prototype,{getUrl:function(b){var c=
a.EventCallback.prototype.getUrl.call(this,b);b[a.INFO_KEY_URL]&&(a.Util.isParameterInURL(c,a.URL_PARAMETER_KEY_CR)||(c=c+"&"+a.URL_PARAMETER_KEY_CR+"="),c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_CR,b[a.INFO_KEY_URL]));return c},process:function(b){b=b||{};var c=this.getUrl(b),d=!0===this._showBrowser;d=b.hasOwnProperty(a.INFO_KEY_SHOW_BROWSER)?!0===b[a.INFO_KEY_SHOW_BROWSER]:d;b[a.INFO_KEY_URL]&&(d=!0);d&&!a.Util.isBlank(c)?(window.open(c),this._processTrackingUrls(b)):a.EventCallback.prototype.process.call(this,
b)}});a.AdImpressionEventCallback=function(b){a.EventCallback.call(this,b)};a.AdImpressionEventCallback.prototype=new a.EventCallback;a.AdImpressionEventCallback.prototype.constructor=a.AdImpressionEventCallback;a.Util.mixin(a.AdImpressionEventCallback.prototype,{_shouldSkipSendingTrackingAndExternalUrls:function(){return this._getInitValue()!==a.INIT_VALUE_ONE},_getInitValue:function(){return this._adInstance.getSlot().isPauseSlot()||!this._processed?a.INIT_VALUE_ONE:a.INIT_VALUE_TWO},getUrl:function(b){var c=
a.EventCallback.prototype.getUrl.call(this,b);c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_METR,this._adInstance._metr);this._name!==a.EVENT_AD_IMPRESSION&&(c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_CT,this._needEmptyCT(b)?"":this._adInstance._timer.tick()));return c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_INIT,this._getInitValue())},process:function(b){a.MODULE_TYPE_TRANSLATOR!==this._adInstance.getRendererController().getRenderer().info()[a.INFO_KEY_MODULE_TYPE]&&(a.EventCallback.prototype.process.call(this,
b),this._processed=!0)}});a.AdQuartileEventCallback=function(b){a.EventCallback.call(this,b)};a.AdQuartileEventCallback.prototype=new a.EventCallback;a.AdQuartileEventCallback.prototype.constructor=a.AdQuartileEventCallback;a.Util.mixin(a.AdQuartileEventCallback.prototype,{getUrl:function(b){var c=a.EventCallback.prototype.getUrl.call(this,b);c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_METR,this._adInstance._metr);return c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_CT,this._needEmptyCT(b)?
"":this._adInstance._timer.tick())},process:function(b){this._processed||(a.EventCallback.prototype.process.call(this,b),this._processed=!0)}});a.AdStandardEventCallback=function(b){a.EventCallback.call(this,b)};a.AdStandardEventCallback.prototype=new a.EventCallback;a.AdStandardEventCallback.prototype.constructor=a.AdStandardEventCallback;a.ErrorEventCallback=function(b){a.EventCallback.call(this,b)};a.ErrorEventCallback.prototype=new a.EventCallback;a.ErrorEventCallback.prototype.constructor=a.ErrorEventCallback;
a.Util.mixin(a.ErrorEventCallback.prototype,{getUrl:function(b){var c=a.EventCallback.prototype.getUrl.call(this,b),d=b[a.INFO_KEY_ERROR_CODE];d||(d=a.ERROR_UNKNOWN);var f=b[a.INFO_KEY_ERROR_INFO];f||(f="");(b=b[a.INFO_KEY_ERROR_MODULE])||(b="");c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_CN,d);return c=a.Util.setParameterInURL(c,a.URL_PARAMETER_KEY_KEY_VALUE,encodeURIComponent(a.URL_PARAMETER_KEY_ERROR_MODULE)+"="+encodeURIComponent(b)+"&"+encodeURIComponent(a.URL_PARAMETER_KEY_ERROR_INFO)+
"="+a.PLATFORM_ID+"/"+encodeURIComponent(f))}});a.ResellerNoAdEventCallback=function(b){a.EventCallback.call(this,b)};a.ResellerNoAdEventCallback.prototype=new a.EventCallback;a.ResellerNoAdEventCallback.prototype.constructor=a.ResellerNoAdEventCallback;a.Util.mixin(a.ResellerNoAdEventCallback.prototype,{});a.SlotImpressionEventCallback=function(b){a.EventCallback.call(this,b)};a.SlotImpressionEventCallback.prototype=new a.EventCallback;a.SlotImpressionEventCallback.prototype.constructor=a.SlotImpressionEventCallback;
a.Util.mixin(a.SlotImpressionEventCallback.prototype,{_shouldSkipSendingTrackingAndExternalUrls:function(){return this._getInitValue()!==a.INIT_VALUE_ONE},_getInitValue:function(){return this._slot.isPauseSlot()||!this._processed?a.INIT_VALUE_ONE:a.INIT_VALUE_TWO},getUrl:function(b){b=a.EventCallback.prototype.getUrl.call(this,b);return b=a.Util.setParameterInURL(b,a.URL_PARAMETER_KEY_INIT,this._getInitValue())},process:function(b){a.EventCallback.prototype.process.call(this,b);this._processed=!0}});
a.VideoViewEventCallback=function(b){a.EventCallback.call(this,b)};a.VideoViewEventCallback.prototype=new a.EventCallback;a.VideoViewEventCallback.prototype.constructor=a.VideoViewEventCallback;a.Util.mixin(a.VideoViewEventCallback.prototype,{_getInitValue:function(){return this._processed?a.INIT_VALUE_ZERO:a.INIT_VALUE_ONE},_getCTValue:function(){return this._context._videoAsset.getPlayheadTime()},getUrl:function(b){b=a.EventCallback.prototype.getUrl.call(this,b);b=a.Util.setParameterInURL(b,a.URL_PARAMETER_KEY_INIT,
this._getInitValue());return b=a.Util.setParameterInURL(b,a.URL_PARAMETER_KEY_CT,this._getCTValue())},_shouldSkipSendingTrackingAndExternalUrls:function(){return this._processed},process:function(b){a.EventCallback.prototype.process.call(this,b);this._processed=!0}});a.EventDispatcher=function(){this._listeners={}};a.EventDispatcher.prototype={addEventListener:function(a,c){"undefined"===typeof this._listeners[a]&&(this._listeners[a]=[]);this._listeners[a].push(c)},dispatchEvent:function(b){"string"===
typeof b&&(b={type:b});b.target||(b.target=this);if(b.type&&this._listeners[b.type]instanceof Array)for(var c=this._listeners[b.type],d=0,f=c.length;d<f;d++)try{c[d]&&c[d].call(this,b)}catch(g){a.warn("EventDispatcher.dispatchEvent",b.type,g)}},removeEventListener:function(a,c){if(this._listeners[a]instanceof Array){var b=this._listeners[a];if(null==c)this._listeners[a]=[];else{a=0;for(var f=b.length;a<f;a++)if(b[a]===c){b.splice(a,1);break}}}}};a.EventDispatcher.prototype.constructor=a.EventDispatcher;
a.ExtensionManager=function(b){this._extensions={};this._context=b;this._surveyExtension=new a.SurveyExtension;this._surveyExtension.init(b);this._videoStateExtension=new a.VideoStateExtension;this._videoStateExtension.init(b);this._displayRefreshExtension=new a.DisplayRefreshExtension;this._displayRefreshExtension.init(b);this._contentVideoExtension=new a.ContentVideoExtension;this._contentVideoExtension.init(b)};a.ExtensionManager.prototype={_scriptLoaded:function(b){if(null==this._extensions[b])this._loadFail(b,
"Extension supposed to be loaded but not found");else{var c=a.Util.getObject(b);"function"!==typeof c?this._loadFail(b,"Script loaded but extension class not found"):(c=new c,"function"===typeof c.init&&"function"===typeof c.dispose?(a.log("Extension loaded: "+b),c.init(this._context),this._context.dispatchEvent(a.EVENT_EXTENSION_LOADED,{success:!0,moduleName:b})):this._loadFail(b,"Extension loaded but is not supported"))}},_getExtensionNameFromUrl:function(a){for(var b=/(?!.*\.{2})(?:[\\/\?=#])([a-z][\w\.]+)(?:\.js(#|\?|$))/gi,
d,f;d=b.exec(a);)f=d;return f?f[1]:null},_loadFail:function(b,c){a.log("Extension failed to load. "+b+" : "+c);this._context.dispatchEvent(a.EVENT_EXTENSION_LOADED,{success:!1,errorVal:c,moduleName:b})},load:function(b){if(b){var c=this._getExtensionNameFromUrl(b);if(null===c)this._loadFail(c,"Extension name not exsit in the Url. Url: "+b);else if(this._extensions[c]===b)a.log("Extension is already loaded"),this._loadFail(c,"Extension is already loaded");else{var d=1*this._context.getParameter("moduleLoadTimeout")||
6E4,f=!1,g=this,k=window.setTimeout(function(){f=!0;g._loadFail(c,"Timeout occured while loading extension. Url: "+b)},d);a.Util.lazyJavaScriptLoad(b,function(){a.log("async load extension successful, URL:"+b);window.clearTimeout(k);f?(a.debug("Extension loaded after timeout, do nothing."),g._loadFail(c,"Timeout occured while loading extension. Url: "+b)):(g._extensions[c]=b,g._scriptLoaded(c))})}}else this._loadFail(c,"Url cannot be empty")},dispose:function(){this._extensions=null;this._surveyExtension.dispose();
this._surveyExtension=null;this._displayRefreshExtension.dispose();this._displayRefreshExtension=null;this._videoStateExtension.dispose();this._videoStateExtension=null;this._contentVideoExtension.dispose();this._context=this._contentVideoExtension=null}};a.ExtensionManager.prototype.constructor=a.ExtensionManager;a.HTMLAdGenerator={log:function(b){a.log("HTMLAdGenerator\t"+b)},getExtension:function(a){return a?(a=a.match(/^[^?]+\/[^?.]*(\.\w+)+/))?a[a.length-1].slice(1):"":""},generateAd:function(b,
c,d,f,g,k,h){a.HTMLAdGenerator.log("generatorAd("+[].slice.call(arguments,0).join(",")+")");var l=k,m=!1;null==l&&(m=!0,l=a.HTMLAdGenerator.getExtension(b).toLowerCase());switch(l){case "jpeg":case "jpg":case "gif":case "png":case "image/jpeg":case "image/jpg":case "image/gif":case "image/png":case "image/bmp":l=a.HTMLAdGenerator.generateImageHTML(b,c);break;case "swf":case "application/x-shockwave-flash":l=a.HTMLAdGenerator.generateFlashHTML(b,c,d,f,g);break;case "script":case "js":case "text/javascript":case "text/js_ref":case "application/x-javascript":l=
a.HTMLAdGenerator.generateScriptHTML(b,d,f,g);break;case "iframe":case "html":case "htm":case "text/html":case "text/html_doc_ref":case "text/html_lit_nowrapper":case "text/html_doc_lit_mobile":l=a.HTMLAdGenerator.generateIFrameHTML(b,c,d,f,g);break;default:l=m?a.HTMLAdGenerator.generateIFrameHTML(b,c,d,f,g):a.HTMLAdGenerator.generateAd(b,c,d,f,g,null,h)}return"text/html_doc_lit_mobile"===h?a.HTMLAdGenerator.htmlLitToHTMLDocLitMobile(l):l},generateImageHTML:function(b,c){a.HTMLAdGenerator.log("generateImageHTML");
return c?'<a href="'+c+'" target="_blank"><img src="'+b+'" border="0" /></a>':'<img src="'+b+'" border="0" />'},generateFlashHTML:function(b,c,d,f,g){a.HTMLAdGenerator.log("generateFlashHTML");var k=b;c&&0<c.length&&(k+=-1===b.indexOf("?")?"?":"&",k+="clickTag="+encodeURIComponent(c));b='<OBJECT classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"WIDTH="'+f+'" HEIGHT="'+g+'" id="'+d+'_external_ad">'+('<PARAM NAME=movie VALUE="'+
k+'"/>')+'<PARAM NAME=quality VALUE=high/><PARAM NAME=bgcolor VALUE=#FFFFFF/><PARAM NAME="allowScriptAccess" VALUE="always"/><PARAM NAME="loop" VALUE="true"/>';b+='<EMBED src="'+k+'" ';return b+('quality=high bgcolor=#FFFFFF WIDTH="'+f+'" HEIGHT="'+g+'"NAME="'+d+'_external_video" ALIGN="" TYPE="application/x-shockwave-flash"PLUGINSPAGE="http://www.macromedia.com/go/getflashplayer"></EMBED></OBJECT>')},generateIFrameHTML:function(b,c,d,f,g){a.HTMLAdGenerator.log("generateIFrameHTML");return'<iframe height="'+
g+'" width="'+f+'" frameborder="0" scrolling="no" allowtransparency="true" leftmargin="0" rightmargin="0" marginwidth="0" marginheight="0" src="'+b+'"></iframe>'},docLitToHTMLLit:function(b,c,d,f){a.HTMLAdGenerator.log("docLitToHTMLLit");return'<iframe id="_fw_frame_'+c+'" width="'+d+'" height="'+f+'" marginwidth="0" marginheight="0" frameborder="0" scrolling="no"></iframe><script language="javascript" type="text/javascript" id="_fw_container_js_'+c+"\">if(!fw_targets) {var fw_targets = [];}var _fw_wr;var fw_scope = document;var fw_content = '"+
a.Util.encodeToHex(b)+"';var trgtFrm = fw_scope.getElementById(\"_fw_frame_"+c+'");trgtFrm = (trgtFrm.contentWindow) ? trgtFrm.contentWindow : (trgtFrm.contentDocument.document) ? trgtFrm.contentDocument.document : trgtFrm.contentDocument;fw_targets["'+c+'"] = trgtFrm;if(navigator.userAgent.match(/\\bMSIE\\b/) || navigator.userAgent.match(/\\bOpera\\b/)){trgtFrm.document.open();trgtFrm.document.write(fw_content);setTimeout(function(){fw_close(fw_targets["'+c+'"])}, 7500);} else if (navigator.userAgent.match(/\\bFirefox\\b/)) {if(true && fw_content.length < 2000){var ec = escape(fw_content);var fw_iframe_url = "http://m2.feiwei.tv/g/lib/template/echo.html?s="+ec;fw_scope.getElementById("_fw_frame_'+
c+'").src = fw_iframe_url;} else {trgtFrm.document.open();trgtFrm.document.write(fw_content);trgtFrm.document.close();}} else {trgtFrm.document.open();trgtFrm.document.write(fw_content);trgtFrm.document.close();}function fw_close(theFrame){theFrame.document.close();}\x3c/script>'},htmlLitToDocLit:function(b){a.HTMLAdGenerator.log("htmlLitToDocLit");return'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><title>Advertisement</title></head><body leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">'+
b+"</body></html>"},wrapUnsafeHTML:function(b,c,d,f){return a.HTMLAdGenerator.htmlLitToHTMLDocLitMobile(a.HTMLAdGenerator.docLitToHTMLLit(a.HTMLAdGenerator.htmlLitToDocLit(b),c,d,f))},wrapJSCode:function(b,c,d,f){return a.HTMLAdGenerator.wrapUnsafeHTML('<script language="javascript" type="text/javascript">'+b+"\x3c/script>",c,d,f)},generateScriptHTML:function(b,c,d,f){a.HTMLAdGenerator.log("generateScriptHTML");return a.HTMLAdGenerator.wrapUnsafeHTML('<script language="javascript" type="text/javascript" src="'+
b+'">\x3c/script>',c,d,f)},htmlLitToHTMLDocLitMobile:function(b){a.HTMLAdGenerator.log("htmlLitToHTMLDocLitMobile");return'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><meta name = "viewport" content = "initial-scale = 1.0, target-densitydpi = device-dpi" /><title>Advertisement</title><script type="text/javascript">window._fw_page_url = "";\x3c/script></head><body style="margin:0px;background-color:transparent;">'+b+"</body></html>"}};
a.NullRenderer=function(){};a.NullRenderer.prototype={start:function(b){b.setCapability(a.EVENT_AD_CLICK,a.CAPABILITY_STATUS_OFF);b.handleStateTransition(a.RENDERER_STATE_STARTED);b.handleStateTransition(a.RENDERER_STATE_COMPLETED)},info:function(){return{moduleType:a.MODULE_TYPE_RENDERER}},getPlayheadTime:function(){return-1},getDuration:function(){return-1}};a.NullRenderer.prototype.constructor=a.NullRenderer;a.PageSlotScanner=function(a){this.OPTION_INIT=1;this.OPTION_FCAI=2;this.OPTION_NIIC=4;
this.OPTION_NOSA=8;this.OPTION_NSIT=16;this._knownSlots=[];this._slots={};this._candidateAds=[];this._slotOptionFound=!1;this._context=a};a.PageSlotScanner.prototype={isSlotDuplicate:function(a){for(var b=0;b<this._knownSlots.length;++b)if(this._knownSlots[b].id===a)return!0;return!1},findPageSlotByScope:function(b){var c=b.document;if(c){var d=/(^|\s)_fwph(\s|$)/,f=c.getElementsByTagName("span");b._fw_admanager||(b._fw_admanager={});b._fw_admanager.pageScanState=!0;for(b=0;b<f.length;++b){var g;
var k=f[b];if(d.test(k.className)&&(k=k.getAttribute("id"),(g=c.getElementById("_fw_input_"+k))&&!this.isSlotDuplicate(k)&&(g=g.getAttribute("value")))){";"!==g.charAt(g.length-1)&&(g+=";");g=g.split(";");var h=g[g.length-2],l=!1;-1!==h.search("lo=i")&&(l=!0);var m=!1;-1!==h.search("prct=")&&(m=!0);0>h.search("flag=")&&(h+="&flag=");0>h.search("ptgt=")&&(h="ptgt=s&"+h);g=[];var q=h.split("&"),z,T;h=!0;for(var v=a.SLOT_OPTION_INITIAL_AD_STAND_ALONE,P=0;P<q.length;++P){var n=q[P].split("=");if(2===
n.length){n[1]=decodeURIComponent(n[1]);if("ssct"===n[0])if(m)continue;else m=!0,n[0]="prct";"flag"===n[0]?(-1===n[1].search(/[-\+]cmpn/)&&(n[1]+="+cmpn"),"+"!==n[1].charAt(0)&&"-"!==n[1].charAt(0)&&(n[1]="+"+n[1]),l&&-1===n[1].search("-init")&&(n[1]+="-init"),-1!==n[1].search("-nrpl")&&(n[1]=n[1].replace("-nrpl","+cmpn")),-1!==n[1].search("-cmpn")&&(h=!1),v=this._getInitialOption(n[1]),this._slotOptionFound||(v=l?a.SLOT_OPTION_INITIAL_AD_KEEP_ORIGINAL:a.SLOT_OPTION_INITIAL_AD_STAND_ALONE)):"w"===
n[0]?z=Number(n[1]):"h"===n[0]?T=Number(n[1]):"cana"===n[0]&&this._addCandidateAds(n[1]);n=encodeURIComponent(n[0])+"="+encodeURIComponent(n[1]);g.push(n)}}m||(l=this._context.getParameter(a.PARAMETER_PAGE_SLOT_CONTENT_TYPE)||"text/html_doc_lit_mobile,text/html_doc_ref",g.push("prct="+encodeURIComponent(l)));(l=c.getElementById("_fw_container_"+k))?(this._slots[k]=g.join("&")+";",this._knownSlots.push({id:k,width:z,height:T,element:l,acceptCompanion:h,initialAdOption:v})):a.warn("Failed to find container for slot "+
k)}}}},scanPageSlots:function(){for(var b=0;b<window.frames.length;++b)try{a.debug("scanPageSlots in frame",b),this.findPageSlotByScope(window.frames[b])}catch(c){}try{window.parent&&window.parent!==window&&(a.debug("scanPageSlots in parent frame"),this.findPageSlotByScope(window.parent))}catch(c){}try{a.debug("scanPageSlots in current window"),this.findPageSlotByScope(window)}catch(c){}},slotsToTypeBStr:function(){var a="",c;for(c in this._slots)if(this._slots.hasOwnProperty(c)){var d=this._slots[c];
-1===d.search("slid=")&&(d="slid="+encodeURIComponent(c)+"&"+d);a+=d;";"!==a.charAt(a.length-1)&&(a+=";")}a&&(a=a.substring(0,a.length-1));return a},_addCandidateAds:function(a){a=a.split(",");for(var b=0;b<a.length;b++){var d=parseInt(a[b],10);0<d&&this._candidateAds.push(d)}},_parseFlags:function(a){var b=[],d=[],f="",g=!0;a+="+";for(var k=0;k<a.length;++k){var h=a.charAt(k);switch(h){case "+":case "-":""!=f&&(g?b.push(f):d.push(f),f="");g="+"==h;break;default:f+=h}}return[b,d]},_getInitialOption:function(b){var c=
!1,d=0;b=this._parseFlags(b);for(var f=a.SLOT_OPTION_INITIAL_AD_STAND_ALONE,g=0;g<b.length;++g)for(var k=0;k<b[g].length;++k)switch(b[g][k].toString().toLowerCase()){case "init":d=0==g?d&~this.OPTION_INIT:d|this.OPTION_INIT;c=!0;break;case "fcai":d=0==g?d|this.OPTION_FCAI:d&~this.OPTION_FCAI;c=!0;break;case "niic":d=0==g?d|this.OPTION_NIIC:d&~this.OPTION_NIIC;c=!0;break;case "nosa":d=0==g?d|this.OPTION_NOSA:d&~this.OPTION_NOSA;c=!0;break;case "nsit":d=0==g?d|this.OPTION_NSIT:d&~this.OPTION_NSIT,c=
!0}switch(d){case 0:c&&(f=a.SLOT_OPTION_INITIAL_AD_STAND_ALONE);break;case 1:f=a.SLOT_OPTION_INITIAL_AD_KEEP_ORIGINAL;break;case 3:f=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_ONLY;break;case 2:f=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_STAND_ALONE;break;case 6:f=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_THEN_STAND_ALONE;break;case 8:f=a.SLOT_OPTION_INITIAL_AD_NO_STAND_ALONE;break;case 10:f=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_NO_STAND_ALONE;break;case 16:f=a.SLOT_OPTION_INITIAL_AD_NO_STAND_ALONE_IF_TEMPORAL;
break;case 18:f=a.SLOT_OPTION_INITIAL_AD_FIRST_COMPANION_OR_NO_STAND_ALONE_IF_TEMPORAL;break;default:f=a.SLOT_OPTION_INITIAL_AD_STAND_ALONE}this._slotOptionFound=c;return f}};a.PageSlotScanner.prototype.constructor=a.PageSlotScanner;a.RendererController=function(b,c){var d=null,f=null,g={},k=a.RendererInitState.instance,h={},l=[],m=0;return{getAdInstance:function(){return c},getContext:function(){return b},getRendererState:function(){return k},processEvent:function(b){var d=b.name;if(d===a.RENDERER_STATE_STARTED||
d===a.RENDERER_STATE_COMPLETING||d===a.RENDERER_STATE_COMPLETED||d===a.RENDERER_STATE_FAILED)this.handleStateTransition(d,b.info);else{var f=this._inferEventType(d);if(f&&(f===a.EVENT_TYPE_CLICK&&b.info&&b.info[a.INFO_KEY_CUSTOM_EVENT_NAME]&&(d=b.info[a.INFO_KEY_CUSTOM_EVENT_NAME]),d!==a.EVENT_AD_MEASUREMENT||b.info[a.INFO_KEY_CONCRETE_EVENT_ID])){var g=d===a.EVENT_AD_INITIATED||d===a.EVENT_AD_BUFFERING_START||d===a.EVENT_AD_BUFFERING_END||d===a.EVENT_AD_VOLUME_CHANGE||b.info&&b.info.hasOwnProperty("apiOnly")&&
b.info.apiOnly;c.processEvent(d,f,b.info,g)}}},handleStateTransition:function(b,d){switch(b){case a.RENDERER_STATE_STARTED:k.notifyStarted(this);break;case a.RENDERER_STATE_COMPLETING:k.complete(this);break;case a.RENDERER_STATE_COMPLETED:k.complete(this);k.notifyCompleted(this);break;case a.RENDERER_STATE_FAILED:c.getSlot()._clearScheduledAdInstance();d||(d={});a.warn("FAIL",", FW ErrorModule:",d[a.INFO_KEY_ERROR_MODULE],", FW ErrorCode:",d[a.INFO_KEY_ERROR_CODE],", FW ErrorInfo:",d[a.INFO_KEY_ERROR_INFO],
", VAST ErrorCode:",d[a.INFO_KEY_VAST_ERROR_CODE]);(b=c.processEvent(a.EVENT_ERROR,a.EVENT_TYPE_ERROR,d))||a.debug("No EVENT_ERROR callback found");if(d)switch(d[a.INFO_KEY_ERROR_CODE]){case a.ERROR_NO_AD_AVAILABLE:case a.ERROR_PARSE:(b=c.processEvent(a.EVENT_RESELLER_NO_AD,a.EVENT_TYPE_IMPRESSION))||a.debug("No EVENT_RESELLER_NO_AD callback found.")}k.fail(this);break;default:a.debug("Unknown event received",b)}},setCapability:function(a,b){c.setMetr(a,b)},getVersion:function(){return b._adManager.getVersion()},
getParameter:function(a){if(!a)return null;if(b._overrideLevelParameterDictionary.hasOwnProperty(a))return b._overrideLevelParameterDictionary[a];if(c.getActiveCreativeRendition()&&"undefined"!==typeof c.getActiveCreativeRendition().getParameter(a))return c.getActiveCreativeRendition().getParameter(a);var d=c._creative;return d&&"undefined"!==typeof d.getParameter(a)?d.getParameter(a):"undefined"!==typeof c.getSlot().getParameter(a)?c.getSlot().getParameter(a):b._adResponse._profileParameters.hasOwnProperty(a)?
b._adResponse._profileParameters[a]:b._globalLevelParameterDictionary.hasOwnProperty(a)?b._globalLevelParameterDictionary[a]:g&&g.hasOwnProperty(a)?g[a]:null},getCompanionSlots:function(){for(var a=[],b=c._companionAdInstances,d=0;d<b.length;d++)b[d].isPlaceholder()&&a.push(b[d].getSlot());return a},createNullDrivingAdInstance:function(){var a=c.getSlot().scheduleAdInstance();a.addCreativeRendition().setContentType("null/null");return a},scheduleAdInstances:function(a){var b,d=[],f=null;a=a||[];if(0===
a.length)return d;for(b=0;b<a.length;b++)a[b].getCustomId()===c.getSlot().getCustomId()&&(f=c.getSlot().scheduleAdInstance());if(!f)if(this.isTranslator())f=this.createNullDrivingAdInstance();else if(this.isRenderer())f=c;else return d;for(var g=0;g<a.length;g++){if(a[g].getCustomId()===c.getSlot().getCustomId())f!==c&&d.push(f);else for(var k=0,q=f._companionAdInstances;k<q.length;k++)if(b=q[k],a[g]===b.getSlot()){if(this.isTranslator())d.push(b);else if(this.isRenderer()&&b.isPlaceholder()){var m=
b.cloneForTranslation();f===c&&(h[m]=b);q[k]=m;d.push(m);l.push(m)}break}d.length<=g&&d.push(null)}return d},commitAdInstance:function(){if(this.isRenderer()&&c.isStarted()){for(var b=0;b<l.length;b++){var d=l[b];d&&d.getSlot().playCompanionAds(d)}l=[]}else a.warn("Skipping RendererController.commitAdInstance when called with driving ad not started or completed.")},isRenderer:function(){return d&&a.MODULE_TYPE_RENDERER===d.info()[a.INFO_KEY_MODULE_TYPE]},isTranslator:function(){return d&&a.MODULE_TYPE_TRANSLATOR===
d.info()[a.INFO_KEY_MODULE_TYPE]},playable:function(){return k===a.RendererInitState.instance},reset:function(){k=a.RendererInitState.instance},play:function(){for(var a=c.getRenderableCreativeRenditions()||[],b=null,d=0;d<a.length;d++){var f=a[d];if(b=this._matchRendererClassName(f)){c.setActiveCreativeRendition(f);break}}0===m&&this._actualPlay(b)},_actualPlay:function(b){(f=a.Util.getObject(b)||a.Util.getObject(y+"."+b))&&(d=new f);d?k.start(this):this.handleStateTransition(a.RENDERER_STATE_FAILED,
{errorCode:a.ERROR_NO_RENDERER,errorInfo:"Renderer class <"+b+"> not found"})},dispatchEvent:function(a,c){b.dispatchEvent(a,c)},requestContentStateChange:function(a){a?b._requestContentVideoToPauseBySlot(c.getSlot()):b._requestContentVideoToResumeBySlot(c.getSlot())},getRenderer:function(){return d},setRenderer:function(a){d=a},setRendererState:function(a){k=a},getContentVideoElement:function(){return b.getContentVideoElement()},_restorePlaceholdersForHybrid:function(){if(h&&this.isRenderer()){for(var a=
[],b=0;b<c._companionAdInstances.length;b++){var d=c._companionAdInstances[b],f=h[d];f?a.push(f):a.push(d)}c._companionAdInstances=a}0<l.length&&this.isRenderer()&&(l=[])},rendererMatch:function(b){return f?f===a.Util.getObject(this._matchRendererClassName(b)):!0},_matchRendererClassName:function(d){function f(b,c,d){a.debug("matching "+b+" within "+c);if(!c)return!0;c=c.split(",");c[c.length-1]||c.pop();if(d){b=b.toLowerCase();for(d=0;d<c.length;d++)if(b==c[d].toLowerCase())return!0;a.debug("not match");
return!1}(c=0<=c.indexOf(b))||a.debug("not match");return c}var h=d.getPrimaryCreativeRenditionAsset().getContentType(),k=d.getContentType(),l=d.getWrapperType(),n=d.getCreativeApi(),q=d.getBaseUnit(),F=c.getSoAdUnit(),H=c.getSlot();H.getType();H=H.getTimePositionClass();a.debug("match renderer for creativeRendition:"+d.getId());if(a.Util.isBlank(k)&&a.Util.isBlank(l))return a.warn("renderer not match due to both contentType and wrapperType are empty"),null;var x=b._rendererManifest["*"];x||(x=b._rendererManifest[l]);
x||(x=b._rendererManifest[k]);if(!x)for(var N=b._overriddenAdRenderers.concat(b._adResponse._adRenderers),L=0;L<N.length;L++){var u=N[L],C=!u.contentType;C||(l?C=f(l,u.contentType,!0):(h&&(C=f(h,u.contentType,!0)),C||(C=f(k,u.contentType,!0))));if(C)if((C=!u.creativeApi)||(C=f(n,u.creativeApi)),C)if(u.baseUnit&&!f(q,u.baseUnit))a.debug("can't match renderer "+u.url+" due to baseUnit not match for creativeRendition:"+d.getId());else if(u.soAdUnit&&!f(F,u.soAdUnit))a.debug("can't match renderer "+u.url+
" due to soAdUnit not match for creativeRendition:"+d.getId());else if(u.slotType&&!f(H.toUpperCase(),u.slotType.toUpperCase()))a.debug("can't match renderer "+u.url+" due to slotType not match for creativeRendition:"+d.getId());else{if(a.debug("renderer "+u.url+" matched for creativeRendition:"+d.getId()),u.url){x=u.url;d=x.indexOf("?");-1!==d&&(x=x.substring(0,d));d=x.lastIndexOf("/");-1!==d&&(x=x.substring(d+1));d=x.lastIndexOf(".js");-1!==d&&(x=x.substring(0,d));var I={};if(u.parameter)for(d=
[].concat(u.parameter),h=0;h<d.length;h++)if(d[h].hasOwnProperty("name"))I[d[h].name]=d[h].value;else for(var A in d[h])d[h].hasOwnProperty(A)&&(I[A]=d[h][A]);a.Util.getObject(y+"."+x)&&(x=y+"."+x);if(a.Util.getObject(x))g=I,m=0;else{if(0<m)break;var w=this;A=1*this.getContext().getParameter("moduleLoadTimeout")||6E4;m=window.setTimeout(function(){m=-1;w.handleStateTransition(a.RENDERER_STATE_FAILED,{errorCode:a.ERROR_NO_RENDERER,errorInfo:"Load renderer timeout, URL:"+u.url})},A);a.Util.lazyJavaScriptLoad(u.url,
function(){a.log("async load renderer successful, URL:"+u.url);-1===m?a.debug("renderer loaded after timeout. WILL NOT PLAY."):(window.clearTimeout(m),m=0,g=I,w._actualPlay(x))})}break}}else a.debug("can't match renderer "+u.url+" due to creative api not match for creativeRendition:"+d.getId());else a.debug("can't match renderer "+u.url+" due to contentType not match for creativeRendition:"+d.getId())}return x?x:a.Util.isBlank(l)?"null/null"===k?y+".NullRenderer":null:null},_inferEventType:function(b){return b===
a.EVENT_ERROR?a.EVENT_TYPE_ERROR:b===a.EVENT_AD_CLICK?a.EVENT_TYPE_CLICK:b===a.EVENT_AD_IMPRESSION||b===a.EVENT_AD_FIRST_QUARTILE||b===a.EVENT_AD_MIDPOINT||b===a.EVENT_AD_THIRD_QUARTILE||b===a.EVENT_AD_COMPLETE||b===a.EVENT_RESELLER_NO_AD?a.EVENT_TYPE_IMPRESSION:b===a.EVENT_AD_PAUSE||b===a.EVENT_AD_RESUME||b===a.EVENT_AD_REWIND||b===a.EVENT_AD_MUTE||b===a.EVENT_AD_UNMUTE||b===a.EVENT_AD_COLLAPSE||b===a.EVENT_AD_EXPAND||b===a.EVENT_AD_MINIMIZE||b===a.EVENT_AD_CLOSE||b===a.EVENT_AD_ACCEPT_INVITATION?
a.EVENT_TYPE_STANDARD:b===a.EVENT_AD_MEASUREMENT||b==a.EVENT_AD_VOLUME_CHANGE||b===a.EVENT_AD_BUFFERING_START||b===a.EVENT_AD_BUFFERING_END||a.EVENT_AD_INITIATED||a.EVENT_AD_AUTO_PLAY_BLOCKED?a.EVENT_TYPE_GENERIC:null},pause:function(){a.log("RendererController.pause");d&&"function"===typeof d.pause?d.pause():a.log("Renderer.pause() is not implemented.")},resume:function(){a.log("RendererController.resume");d&&"function"===typeof d.resume?d.resume():a.log("Renderer.resume() is not implemented.")},
stop:function(){a.log("RendererController.stop");0<m&&(m=-1);k.stop(this)}}};a.RenditionSelector=function(a,c,d,f){this._targetByterate=a;this._arWeight=c;this._pxWeight=d;this._conversionFactor=f};a.RenditionSelector.prototype={getBestFitRendition:function(b,c,d){var f=this;b.reverse();b=b.filter(function(b){return b&&b.getPrimaryCreativeRenditionAsset()&&(b.getPrimaryCreativeRenditionAsset().getUrl()||b.getPrimaryCreativeRenditionAsset().getContent())&&a.Util.canPlayVideoType(b.getPrimaryCreativeRenditionAsset().getMimeType())}).sort(function(a,
b){return f.getBitrate(a)-f.getBitrate(b)});if(!b.length)return null;var g=Number.MAX_VALUE,k=b.filter(function(a){a=f.getBitrate(a);g=a<g?a:g;return a<=f._targetByterate});k.length||(k=b.filter(function(a){return f.getBitrate(a)<=g}));return k.sort(function(a,b){return f.compareVisualMetrics(a,b,c,d)}).pop()},compareVisualMetrics:function(a,c,d,f){var b=this.calculateVisualRatios(a.getWidth(),a.getHeight(),d,f);f=this.calculateVisualRatios(c.getWidth(),c.getHeight(),d,f);return!b&&f?-1:b&&!f?1:b&&
f&&(d=this._conversionFactor*this._arWeight*Math.log(f.arRatio),f=this._pxWeight*Math.log(f.pixelation),b=this.findDistance(this._conversionFactor*this._arWeight*Math.log(b.arRatio),this._pxWeight*Math.log(b.pixelation),0,0),d=this.findDistance(d,f,0,0),d!=b)?d-b:a.getPreference()-c.getPreference()},calculateVisualRatios:function(a,c,d,f){if(0<a&&0<c&&0<d&&0<f){var b=a/c,k=d/f;b>k?f=d/b:d=f*b;return{arRatio:b/k,pixelation:a*c/(d*f)}}return null},findDistance:function(a,c,d,f){return isNaN(a)||isNaN(d)||
isNaN(c)||isNaN(f)?NaN:Math.sqrt(Math.pow(d-a,2)+Math.pow(f-c,2))},getBitrate:function(a){var b=a.getDuration();return(a=a.getPrimaryCreativeRenditionAsset().getBytes())&&b&&!isNaN(a)&&!isNaN(b)&&0<a&&0<b?8*a/1E3/b:-1}};a.RenditionSelector.prototype.constructor=a.RenditionSelector;a.Slot=function(b){var c="",d=null,f=null,g=null,k=null,h=[],l=[],m={},q=null,z=a.MediaInitState.instance,T=0,v=null,y,n,J,F,H,x,N=0,L=0,u=[],C=!1,I=!1,A=!0,w=[],G,K,B=!1;return{setAutoPlayBlocked:function(a){B=a},getSlotProfile:function(){return f},
setSlotProfile:function(a){f=a},setMediaState:function(a){z=a},setParameter:function(a,b){null===b?delete m[a]:m[a]=b},getParameter:function(a){if(a&&m.hasOwnProperty(a))return m[a]},getAdCount:function(){return h.length},setCustomId:function(a){c=a},getCustomId:function(){return c},setAdUnit:function(a){H=a},getAdUnit:function(){return H},setType:function(a){d=a},getType:function(){return d},setTimePosition:function(a){n=a},getTimePosition:function(){return n},setTimePositionClass:function(a){v=
a&&a.toUpperCase()},getTimePositionClass:function(){return v},setWidth:function(a){J=a},getWidth:function(){return v!==a.TIME_POSITION_CLASS_DISPLAY?J?J:b.getVideoDisplaySize().width:J},setHeight:function(a){F=1*a},getHeight:function(){return v!==a.TIME_POSITION_CLASS_DISPLAY?F?F:b.getVideoDisplaySize().height:F},setBase:function(a){y=a},getBase:function(){return y},setCuepointSequence:function(a){x=1*a?1*a:0},getCuepointSequence:function(){return x},getVideoDisplaySize:function(){return b.getVideoDisplaySize()},
setMaxDuration:function(a){N=1*a?1*a:0},getMaxDuration:function(){return N},setMinDuration:function(a){L=1*a?1*a:0},getMinDuration:function(){return L},setAcceptContentType:function(a){if(a&&a.trim())for(acceptContentTypeRaw=a.split(","),a=0;a<acceptContentTypeRaw.length;a++)u.push(acceptContentTypeRaw[a].trim())},getAcceptContentType:function(){return u.join(",")},parse:function(d){if(d){c=d.customId;n=1*d.timePosition;v=d.timePositionClass&&d.timePositionClass.toUpperCase()||v;H=d.adUnit;for(var f,
g=0,k=d.eventCallbacks||[];g<k.length;g++){f=k[g];var m=a.EventCallback.newEventCallback(b,f.name,f.type);m&&(m._slot=this,m.parse(f),l.push(m))}g=0;for(k=d.selectedAds||[];g<k.length;g++)f=k[g],d=[],m=new a.AdInstance(b),d.push(m),m._slot=this,m._slotCustomId=c,m._parentAdInstancesGroup=d,m.parse(f),h.push(d)}},getCurrentAdInstance:function(){return g},isPauseSlot:function(){return v===a.TIME_POSITION_CLASS_PAUSE_MIDROLL},play:function(c){if(B)a.log("Resuming previously blocked video ad now."),B=
!1,b.getContentVideoElement()&&b.getContentVideoElement().play();else{for(var d=this.getAdInstances(),f=0;f<d.length;f++)d[f]._isSkipped=!1;v!==a.TIME_POSITION_CLASS_DISPLAY||A?(a.log("Slot.play",v),C=!1,v===a.TIME_POSITION_CLASS_DISPLAY&&1<h.length&&h.splice(0,h.length-1),this._play(c)):(a.log("Slot is invisible. Push the play operation to the queue."),w.push({operation:this.play,argument:c}))}},stop:function(){a.log("Slot.stop",v);v===a.TIME_POSITION_CLASS_DISPLAY&&(w=[]);z===a.MediaInitState.instance||
z===a.MediaEndState.instance?a.log("Slot.stop, not start or already end, ignore"):(C=!0,g?g.stop():a.warn("Slot.stop, no _currentAdInstance, ignore"))},pause:function(){a.log("Slot.pause");v!==a.TIME_POSITION_CLASS_DISPLAY?g&&g.pause():a.log("Not a temporal slot. Ignore.")},resume:function(){a.log("Slot.resume");v!==a.TIME_POSITION_CLASS_DISPLAY?g&&g.resume():a.log("Not a temporal slot. Ignore.")},skipCurrentAd:function(){a.log("Slot.skipCurrentAd ",g);g?g.skip():a.log("Slot.skipCurrentAd, no _currentAdInstance, ignore")},
setVisible:function(b){if(v!==a.TIME_POSITION_CLASS_DISPLAY)a.log("Slot.setVisible is only for display ads.");else if(a.log("Slot.setVisible",b),A!=b&&(A=b))for(;0<w.length;)op=w.pop(),op.operation&&op.operation.call(this,op.argument)},_play:function(a){q=q||a;z.play(this)},onStartPlaying:function(){this._onStartPlaying()},onStartReplaying:function(){this._onStartPlaying()},onCompletePlaying:function(){this._onCompletePlaying()},onCompleteReplaying:function(){this._onCompletePlaying()},playNextAdInstance:function(){a.log("Slot.playNextAdInstance ",
v);this._playNextAdInstance()||z.complete(this)},scheduleAdInstance:function(){return k=g.cloneForTranslation()},_clearScheduledAdInstance:function(){k=null},_onStartPlaying:function(){v==a.TIME_POSITION_CLASS_MIDROLL&&0<h.length&&b._requestContentVideoToPauseBySlot(this);var c=a.EventCallback.getEventCallback(l,a.EVENT_SLOT_IMPRESSION,a.EVENT_TYPE_IMPRESSION);c&&c.process();this.dispatchSlotEvent(a.EVENT_SLOT_STARTED);this.playNextAdInstance()},dispatchSlotEvent:function(a){I||b.dispatchEvent(a,
{slot:this})},_onCompletePlaying:function(){q&&q();q=null;w=[];var c=a.EventCallback.getEventCallback(l,a.EVENT_SLOT_END,a.EVENT_TYPE_IMPRESSION);c&&c.process();g=null;this.dispatchSlotEvent(a.EVENT_SLOT_ENDED);v==a.TIME_POSITION_CLASS_MIDROLL&&0<h.length&&b._requestContentVideoToResumeBySlot(this)},_playNextAdInstance:function(){if(C||z!==a.MediaPlayingState.instance&&z!==a.MediaReplayingState.instance)return!1;this._commitScheduledAdInstance();g=this._nextPlayableAdInstance();if(!g)return!1;g.reset();
g._isInitiatedSent||(g.getRendererController().processEvent({name:a.EVENT_AD_INITIATED}),g._isInitiatedSent=!0);g.getRendererController().play();return!0},_commitScheduledAdInstance:function(){if(k){var a=g._parentAdInstancesGroup.indexOf(g);0<=a&&(k._parentAdInstancesGroup=g._parentAdInstancesGroup,g._parentAdInstancesGroup.splice(a,1,k),k=null)}},_nextPlayableAdInstance:function(){if(g){var b=g._parentAdInstancesGroup,c=b.indexOf(g);var d=h.indexOf(b);0<=d&&0<=c&&(g._isImpressionSent||g._isSkipped||
c==b.length-1)&&d++}else d=0;if(0>d||d>=h.length)return null;if(z===a.MediaPlayingState.instance)for(b=h[d],c=0;c<b.length;c++){var f=b[c];if(f.getRendererController().playable())return f}else if(z===a.MediaReplayingState.instance)for(;d<h.length;d++){b=h[d];for(c=0;c<b.length;c++)if(f=b[c],f._isImpressionSent)return f;for(c=0;c<b.length;c++)if(f=b[c],f.getRendererController().getRendererState()!==a.RendererFailedState.instance&&!f._translated)return f}return null},toString:function(){return"[Slot "+
c+"]"},getAdInstances:function(){for(var a=[],b=0;b<h.length;++b)for(var c=h[b],d=0;d<c.length;++d){var f=c[d];if(f.isPlayable()){a.push(f);break}}return a},getPlayheadTime:function(){for(var a=0,b=this.getAdInstances(),c=0;c<b.length;++c)if(b[c]===g){b=g.getPlayheadTime();-1<b&&(a+=b);break}else{var d=b[c].getDuration();-1<d&&(a+=d)}T&&a>T&&(a=T);return a},getTotalDuration:function(){if(d!=a.SLOT_TYPE_TEMPORAL)return-1;for(var b=0,c=this.getAdInstances(),f=0;f<c.length;++f){var g=c[f].getDuration();
-1<g&&(b+=g)}return T=b},playCompanionAds:function(b){a.log("Slot.playCompanionAds");var c=[];b._parentAdInstancesGroup=c;c.push(b);h.push(c);I=!0;g&&this.stop();this.play()},getState:function(){return z},setAcceptCompanion:function(a){G=a},getAcceptCompanion:function(){return G},setInitialAdOption:function(a){K=a},getInitialAdOption:function(){return K}}};a.SurveyExtension=function(){this._surveyPingedIds=[]};a.SurveyExtension.prototype={init:function(b){this._context=b;a.log("SurveyExtension.init("+
Array.prototype.slice.call(arguments).join(",")+")");this._onAdStarted=a.Util.bind(this,function(b){this._parameters=this._getParameters();if(this._parameters.enabled){a.log("SurveyExtension.onAdStarted()");var c=b.adInstance;if(-1<this._surveyPingedIds.indexOf(c.getAdId()))a.log("won't pingback survey since it has been pinged back");else{var f=c._creative.getParameter("_fw_survey_url");if(f)try{a.log("append"+f+" to head");var g=document.getElementsByTagName("head")[0],k=document.createElement("script");
k.setAttribute("type","text/javascript");k.setAttribute("src",f);g.appendChild(k);this._surveyPingedIds.push(c.getAdId())}catch(h){a.warn("Append survey to head",b.type,e)}}}});this._context.addEventListener(a.EVENT_AD_IMPRESSION,this._onAdStarted)},dispose:function(){a.log("SurveyExtension.dispose()");this._context.removeEventListener(a.EVENT_AD_IMPRESSION,this._onAdStarted);this._parameters=this._onAdStarted=null},_getParameters:function(){var b={};b.enabled="false"!=this._context.getParameter(a.PARAMETER_EXTENSION_SURVEY_ENABLED);
a.log(b);return b}};a.SurveyExtension.prototype.constructor=a.SurveyExtension;a.Timer=function(a,c){this._lastTickDate=new Date;this._duration=a||-1;this._playheadTime=-1;this._callback=c;this._state=-1};a.Timer.prototype={};a.Timer.prototype.constructor=a.Timer;a.Util.mixin(a.Timer.prototype,{tick:function(){var a=new Date,c=Math.round((a.getTime()-this._lastTickDate.getTime())/1E3);this._lastTickDate=a;return c},start:function(){if(0!==this._state){if(2===this._state||-1===this._playheadTime)this._playheadTime=
0;this._state=0;this._timeStamp=new Date;this._timeouter&&(window.clearTimeout(this._timeouter),this._timeouter=null);var a=this,c=1E3*(this._duration-this._playheadTime);0>c||(this._timeouter=window.setTimeout(function(){a.stop();a._playheadTime=a._duration;a._callback&&a._callback()},c))}},pause:function(){0===this._state&&(this._state=1,this._timeouter&&(window.clearTimeout(this._timeouter),this._timeouter=null),this._playheadTime=(new Date-this._timeStamp)/1E3+this._playheadTime)},stop:function(){this._state=
2;this._timeouter&&(window.clearTimeout(this._timeouter),this._timeouter=null);this._playheadTime=(new Date-this._timeStamp)/1E3+this._playheadTime},getPlayheadTime:function(){return 0===this._state?(new Date-this._timeStamp)/1E3+this._playheadTime:this._playheadTime},getCTValue:function(){return(new Date-this._timeStamp)/1E3},getDuration:function(){return this._duration}});a.VastTranslator=function(){this._rendererController=this._request=null};a.VastTranslator.prototype={start:function(b){function c(b){a.log("VastTranslator\t"+
b)}function d(b){a.warn("VastTranslator\t"+b)}function f(a,b){if(a)if(a.length&&"string"!==typeof a)for(var c=0;c<a.length;c++)b(a[c].value);else a.value&&b(a.value)}function g(a,b){f(b,function(b){b&&a.push(b)})}function k(b){if(!b)return!1;for(var c=0;c<C.length;c++)if(a.Util.trim(C[c]).toLowerCase()===a.Util.trim(b).toLowerCase())return!0;return!1}function h(b){if(!b)return null;"string"!==typeof b&&(b=b.toString());b=a.Util.trim(b);return-1<b.indexOf("://")?b:null}function l(a){this.code=this.url=
null;this.height=this.width=NaN;this.resourceType=this.creativeType=null;this.bitrate=NaN;this.creativeApi=null;this.ad=a;this.clickThrough=null;this.clickTrackings=[];this.customClicks=[];this.creativeData=null}function m(){this.creativeView=[];this.start=[];this.firstQuartile=[];this.midpoint=[];this.thirdQuartile=[];this.complete=[];this.mute=[];this.unmute=[];this.pause=[];this.rewind=[];this.resume=[];this.replay=[];this.fullscreen=[];this.expand=[];this.collapse=[];this.acceptInvitation=[];
this.stop=[]}function q(a){this._impressions=[];this.clickThrough=null;this.clickTrackings=[];this.customClicks=[];this.creativeData=null;this.sequence=-1;this.universalAdId=null;this.vastRenditions=[];this.duration=NaN;this.adp=a;this.isDrivingAd=!1}function z(a){q.call(this,a)}function y(a){q.call(this,a)}function v(a){q.call(this,a)}function P(){}function n(a,b,d,f){if(a&&f&&0<f.length){c("augmentCallbacks("+b+", "+d+", "+f+")");for(var g=a.getEventCallbackUrls(b,d),p=0;p<g.length;p++)-1<f.indexOf(g[p])&&
(c("augmentCallbacks() url = "+g[p]),f.unshift(g[p]));a.addEventCallbackUrls(b,d,f)}else c("augmentCallbacks("+b+", "+d+", "+f+"), empty callbacks")}function J(b,d){c("initErrorTrackings()");b&&d&&n(b,a.EVENT_ERROR,a.EVENT_TYPE_ERROR,d.errorTrackings)}function F(b,d){c("initTrackingEvents()");d&&b&&(n(b,a.EVENT_AD_IMPRESSION,a.EVENT_TYPE_IMPRESSION,d.creativeView),n(b,a.EVENT_AD_IMPRESSION,a.EVENT_TYPE_IMPRESSION,d.start),n(b,a.EVENT_AD_FIRST_QUARTILE,a.EVENT_TYPE_IMPRESSION,d.firstQuartile),n(b,
a.EVENT_AD_MIDPOINT,a.EVENT_TYPE_IMPRESSION,d.midpoint),n(b,a.EVENT_AD_THIRD_QUARTILE,a.EVENT_TYPE_IMPRESSION,d.thirdQuartile),n(b,a.EVENT_AD_COMPLETE,a.EVENT_TYPE_IMPRESSION,d.complete),n(b,a.EVENT_AD_MUTE,a.EVENT_TYPE_STANDARD,d.mute),n(b,a.EVENT_AD_UNMUTE,a.EVENT_TYPE_STANDARD,d.unmute),n(b,a.EVENT_AD_PAUSE,a.EVENT_TYPE_STANDARD,d.pause),n(b,a.EVENT_AD_RESUME,a.EVENT_TYPE_STANDARD,d.resume),n(b,a.EVENT_AD_REWIND,a.EVENT_TYPE_STANDARD,d.rewind),n(b,a.EVENT_AD_EXPAND,a.EVENT_TYPE_STANDARD,d.fullscreen),
n(b,a.EVENT_AD_COLLAPSE,a.EVENT_TYPE_STANDARD,d.collapse),n(b,a.EVENT_AD_EXPAND,a.EVENT_TYPE_STANDARD,d.expand),n(b,a.EVENT_AD_CLOSE,a.EVENT_TYPE_STANDARD,d.stop),n(b,a.EVENT_AD_ACCEPT_INVITATION,a.EVENT_TYPE_STANDARD,d.acceptInvitation))}function H(b,d,f,g,h){c("initClickAndImpressionEvents");if(b){d&&b.setClickThroughUrl(a.EVENT_AD_CLICK,d);f&&0<f.length&&n(b,a.EVENT_AD_CLICK,a.EVENT_TYPE_CLICK_TRACKING,f);if(g&&0<g.length)for(d=0;d<g.length;d++)g[d].url&&n(b,g[d].id,a.EVENT_TYPE_CLICK_TRACKING,
[g[d].url]);h&&n(b,a.EVENT_AD_IMPRESSION,a.EVENT_TYPE_IMPRESSION,h)}}function x(a,b){c("initTemporalAdInstance");a||d("initTemporalAdInstance: Invalid adInstance");if(b.selectedDrivingAd){b.surveyUrl&&a._creative.setParameter("_fw_survey_url",b.surveyUrl);var f=b.selectedDrivingAd,g=b.selectedDrivingRenditions;c("vastRenditions:"+g);for(var h=4===K,p=0;p<g.length;p++){var t=g[p];r=a.addCreativeRendition();q=r.addCreativeRenditionAsset("VAST_CRA",!0);a:{var l=t.creativeType;switch(l){case "video/mp4":l=
"video/mp4-h264";break a;case "video/3gp":l="video/3gpp"}}c("initTemporalAdInstance() set rendition/asset [vastRd.creativeApi,vastAd.duration,vastRd.width,vastRd.height,vastRd.url,assetContentType,vastRd.creativeType] =  "+[t.creativeApi,f.duration,t.width,t.height,t.url,l,t.creativeType]);r.setCreativeApi(t.creativeApi);isNaN(f.duration)||r.setDuration(f.duration);t.width&&!isNaN(t.width)&&r.setWidth(t.width);t.height&&!isNaN(t.height)&&r.setHeight(t.height);f.universalAdId&&r.setUniversalAdId(f.universalAdId);
t.url&&q.setUrl(t.url);t.code&&q.setContent(t.code);q.setMimeType(t.creativeType);"static"===t.resourceType&&"text/html"===t.creativeType?q.setContentType("text/html_doc_ref"):"application/x-javascript"===t.creativeType||"application/javascript"===t.creativeType?q.setContentType("text/js_ref"):"iframe"===t.resourceType?q.setContentType("text/html_doc_ref"):"text/html"===t.creativeType||"text/html_doc_ref"===t.creativeType?q.setContentType("text/html_doc_ref"):"text/html_doc_lit_mobile"===t.creativeType?
q.setContentType("text/html_doc_lit_mobile"):h||k(l)?(q.setContentType("text/html_doc_lit_mobile"),q.setUrl(null),q.setContent(N(a,G.getCustomId(),f,t,"text/html_doc_lit_mobile"))):q.setContentType(l);f.creativeData&&0!==f.creativeData.length&&(c("initTemporalAdInstance(), set asset parameter creativeData:"+f.creativeData),r.setParameter("creativeData",f.creativeData));h||k(l)||(t=t.bitrate,!isNaN(t)&&0<t&&q.setBytes(1E3*t*f.duration/8));l=V;q=O;t=!1;if(r.getContentType()&&l){var m=r.getContentType().toLowerCase(),
n=l.toLowerCase();if(m==n)t=!0;else if(0==m.indexOf("video/mp4")&&0==n.indexOf("video/mp4")||"application/javascript"==n&&"text/js_ref"==m)r.setContentType(l),t=!0}l=!1;r.getCreativeApi()&&q&&(m=r.getCreativeApi().toLowerCase(),n=q.toLowerCase(),m==n?l=!0:0==m.indexOf("mraid")&&0==n.indexOf("mraid")&&(l=!0,r.setCreativeApi(q)));t&&l?r.setPreference(10):l?r.setPreference(6):t?r.setPreference(5):r.setPreference(0);c("adjustMatchedRendition "+r.getId()+", contentType "+r.getContentType()+", creativeAPI "+
r.getCreativeApi()+", preference "+r.getPreference())}F(a,f.trackingEvents);J(a,b);H(a,h?g[0].clickThrough:f.clickThrough,f.clickTrackings,f.customClicks,f.impressions)}else{var r=a.addCreativeRendition();r.setContentType("null/null");var q=r.addCreativeRenditionAsset("VAST_CRA",!0);q.setContentType("null/null")}}function N(b,d,f,g,h){c("getCoadHTML, ad id = "+b.getAdId());return g.url&&0<g.url.length?((f=g.clickThrough)&&0<f.length&&b.setClickThroughUrl(a.EVENT_AD_CLICK,f),b=b.getEventCallbackUrls(a.EVENT_AD_CLICK,
a.EVENT_TYPE_CLICK)[0],a.HTMLAdGenerator.generateAd(g.url,b,d,g.width,g.height,g.creativeType,h)):g.code&&0<g.code.length?"script"===g.resourceType||"text/javascript"===g.resourceType||"text/js_ref"===g.resourceType||"application/x-javascript"===g.resourceType?a.HTMLAdGenerator.wrapJSCode(g.code,d,g.width,g.height):a.HTMLAdGenerator.wrapUnsafeHTML(g.code,d,g.width,g.height):null}function L(b,d,f,g){c("initPageAdInstance ad:"+d.getAdId());var h=f.vastRenditions[0];if(h.url||h.code){var p=d.addCreativeRendition(),
k=p.addCreativeRenditionAsset("VAST_CRA",!0);p.setCreativeApi(h.creativeApi);p.setWidth(h.width);p.setHeight(h.height);"static"===h.resourceType&&"text/html"===h.creativeType?(k.setContentType("text/html_doc_ref"),k.setUrl(h.url)):"iframe"===h.resourceType?(k.setContentType("text/html_doc_ref"),k.setUrl(h.url)):"HTML"===h.resourceType?(k.setContentType("text/html_doc_lit_mobile"),k.setContent(a.HTMLAdGenerator.wrapUnsafeHTML(h.code,b.getCustomId(),h.width,h.height))):(k.setContentType("text/html_doc_lit_mobile"),
k.setContent(N(d,b.getCustomId(),f,h,"text/html_doc_lit_mobile")));k.setMimeType("text/html")}else c("initPageAdInstance will add a tracking only companion ad");F(d,f.trackingEvents);J(d,g);H(d,h.clickThrough,h.clickTrackings,h.customClicks,f.impressions)}function u(d){if(200==d.status)if(d.responseXML){var f=(new P).parseAdData(d.responseXML);if(f){c("scheduleVastAds");if(f&&0!==f.length)if(d=f[0].selectedPackage,f=f[0].redirectPackage,!d&&!f)if(c("scheduleVastAds(), no ads from vast response!!!"),
I)if(4!==K)w.onTranslatorFailed(a.ERROR_NO_AD_AVAILABLE,"Expecting linear ad but returned non-linear ad",a.ERROR_VAST_LINEARITY_NOT_MATCH);else w.onTranslatorFailed(a.ERROR_NO_AD_AVAILABLE,"Expecting non-linear ad but returned linear ad",a.ERROR_VAST_LINEARITY_NOT_MATCH);else w.onTranslatorFailed(a.ERROR_NO_AD_AVAILABLE,"wrapperUrl="+r);else if(!d&&f){c("scheduleVastAds(), no ads scheduled, redirect to downstream Secondary Ad Server");c("scheduleRedirect");d=[];var g=[];d.push(G);g.push({});for(var h=
B,k=f.selectedCompanionAds,p=0;p<h.length;p++){var l=h[p];k&&k[l.getCustomId()]&&(d.push(l),g.push(k[l.getCustomId()]))}(h=b.scheduleAdInstances(d))&&0<h.length&&(k=h[0],p=k.addCreativeRendition(),p.setWrapperUrl(a.Util.transformUrlToProxy(f.tagUrl)),p.setWrapperType(X),p.setContentType(V),p.setCreativeApi(O),F(k,f.getTrackingEventsOfWrapper()),J(k,f),H(k,f.getClickThroughOfWrapper(),f.getClickTrackingsOfWrapper(),f.getCustomClicksOfWrapper(),f.getImpressionOfWrapper()));c("scheduleRedirect, schedule companion for redirect ad ",
f);for(p=1;p<h.length;p++)if(k=h[p])l=g[p],l instanceof v&&L(d[p],k,l,f)}else{if(d){c("scheduleVastAds(), ads returned from vast response, going to schedule them");d.selectedDrivingAd?(c("scheduleVastAds(), ads returned from vast response, going to schedule them with driving ad"),d.selectedDrivingAd.isDrivingAd=!0):c("scheduleVastAds(), ads returned from vast response, going to schedule them without driving ad");c("scheduleAdPackage()");f=[];g=[];f.push(G);d.selectedDrivingAd&&g.push(d.selectedDrivingAd);
h=B;k=d.selectedCompanionAds;for(p=0;p<h.length;p++)l=h[p],k&&k[l.getCustomId()]&&(f.push(l),g.push(k[l.getCustomId()]));k=b.scheduleAdInstances(f);if(0<k.length){c("scheduleAdPackage, scheduled "+k.length+" ads"+d.selectedDrivingAd?"":", 1 of it is nullAd for pure companion ad schedule");d.selectedDrivingAd||c("Driving ad is not selected, will create a dummy null ad.");d.selectedDrivingAd||(f.shift(),x(k.shift(),d));for(p=0;p<k.length;p++)if(l=k[p]){var m=g[p];m instanceof v?L(f[p],l,m,d):x(l,d)}!d.selectedDrivingAd&&
0<h.length&&0<d.companionAds.length&&0===g.length&&(c("found empty companion slots and companion ads in package, but none of them matches slot size"),w.onTranslatorFailed(a.ERROR_UNMATCHED_SLOT_SIZE))}else c("scheduleAdPackage, no ad scheduled.")}}else c("no ads for scheduleVastAds");w._request=null;b.handleStateTransition(a.TRANSLATOR_STATE_STARTED);b.handleStateTransition(a.TRANSLATOR_STATE_COMPLETED)}}else w.onTranslatorFailed(a.ERROR_PARSE,"wrapperUrl="+r,a.ERROR_VAST_XML_PARSING);else if(400<=
d.status)w.onTranslatorFailed(a.ERROR_IO,"wrapperUrl="+r)}this._rendererController=b;var C="image/gif image/jpeg image/png text/html text/javascript text/html_doc_ref text/html_doc_lit_mobile application/x-javascript application/javascript".split(" "),I=!1,A=b.getAdInstance(),w=this,G=A.getSlot(),K=function(){if(!G)return 1;switch(G.getTimePositionClass()){case a.TIME_POSITION_CLASS_PREROLL:case a.TIME_POSITION_CLASS_MIDROLL:case a.TIME_POSITION_CLASS_POSTROLL:return 2;case a.TIME_POSITION_CLASS_OVERLAY:return 4;
case a.TIME_POSITION_CLASS_DISPLAY:return G&&!G.getBase()?8:1;default:return 1}}(),B=b.getCompanionSlots().filter(function(b,c,d){if(!b)return!1;switch(b.getTimePositionClass()){case a.TIME_POSITION_CLASS_PREROLL:case a.TIME_POSITION_CLASS_MIDROLL:case a.TIME_POSITION_CLASS_PAUSE_MIDROLL:case a.TIME_POSITION_CLASS_POSTROLL:return!1;default:return!0}});c("Checking CompanionSlots, length = "+B.length+", rendererController.getCompanionSlots().length = "+b.getCompanionSlots().length+", AdInstance.getCompanionSlots.length = "+
A.getCompanionSlots().length);var V=A.getActiveCreativeRendition().getContentType(),O=A.getActiveCreativeRendition().getCreativeApi()||"None";this.log("ExpectedDrivingContentType:"+V+", ExpectedDrivingAPI:"+O);var X=A.getActiveCreativeRendition().getWrapperType();l.prototype={init:function(a,b,c,d,f,g,h,k){this.log("init("+[].slice.call(arguments,0).join(",")+")");this.url=a;this.width=1*b;this.height=1*c;this.creativeType=d;this.resourceType=f;this.bitrate=g;var p;if((p=h)&&0!==p.length)switch(p.toLowerCase()){case "flashvar":case "flashvars":p=
"clickTag";break;case "vpaid":p="VPAID";break;case "mraid":p="MRAID-1.0"}else p="None";this.creativeApi=p;this.code=k||null},log:function(b){a.log("VastTranslator.VastRendition\t"+b)},toString:function(){var a=[],b;for(b in this)this.hasOwnProperty(b)&&"function"!==typeof this[b]&&"ad"!==b&&a.push(b+":"+this[b]);return a.join(",")}};l.prototype.constructor=l;q.prototype={parse:function(b){this.log("parse()");if(b.Duration)if(b.Duration.value){var c=/(\d+):(\d+):(\d+)/.exec(b.Duration.value);c?this.duration=
3600*c[1]+60*c[2]+1*c[3]:this.warn("Failed to parse duration value for creative "+b)}else this.warn("No duration value set for creative "+b);b.VideoClicks&&(b.VideoClicks=[].concat(b.VideoClicks),a.Util.forEachOnArray(b.VideoClicks,function(a,b,c){a.ClickThrough&&a.ClickThrough.value&&(this.clickThrough=h(a.ClickThrough.value));if(a.ClickTracking)for(a.ClickTracking=[].concat(a.ClickTracking),c=0;c<a.ClickTracking.length;c++)(b=h(a.ClickTracking[c].value))&&this.clickTrackings.push(b);if(a.CustomClick)for(a.CustomClick=
[].concat(a.CustomClick),c=0;c<a.CustomClick.length;c++){var d=null;a.CustomClick[c]["@attributes"]&&(d=a.CustomClick[c]["@attributes"].id);(b=h(a.CustomClick[c].value))&&this.customClicks.push({id:d,url:b})}},this));b.MediaFiles&&b.MediaFiles.MediaFile&&(b.MediaFiles.MediaFile=[].concat(b.MediaFiles.MediaFile),a.Util.forEachOnArray(b.MediaFiles.MediaFile,function(a,b,c){b=h(a.value);var d=c=NaN,f=null,g="None",k=NaN;a["@attributes"]&&(c=a["@attributes"].width||NaN,d=a["@attributes"].height||NaN,
f=a["@attributes"].type,g=a["@attributes"].apiFramework||"None",k=a["@attributes"].bitrate||NaN);b&&-1!==b.indexOf(":")?(a=new l(this),a.init(b,c,d,f,"",k,g,null),a.clickThrough=this.clickThrough,this.vastRenditions.push(a),(isNaN(c)||isNaN(d))&&this.log("continue with missing [width,height]"+[c,d])):this.warn("will ignore this mediaFile because some required field is missing [url,width,height]:"+[b,c,d])},this));b.TrackingEvents&&this.parseTrackingEvents(b.TrackingEvents,this.setTrackingEvents());
b.AdParameters&&(this.log("parse() got AdParameters:"+b.AdParameters.value),this.creativeData=b.AdParameters.value);b.Companion&&(b.Companion=[].concat(b.Companion),a.Util.forEachOnArray(b.Companion,function(b,c,d){d=c=null;var f="",g="",p=null,t=null,m=!1;b.CompanionClickThrough&&(g=h(b.CompanionClickThrough.value));b.StaticResource&&(c=h(b.StaticResource.value),b.StaticResource["@attributes"]&&(d=b.StaticResource["@attributes"].creativeType),f="static");b.IFrameResource&&(c=h(b.IFrameResource.value))&&
(d="text/html_doc_ref",f="iframe");b.HTMLResource&&(p=b.HTMLResource["#cdata-section"]||"",p=a.Util.trim(p))&&(d="text/html_doc_lit_mobile",f="HTML");b.TrackingEvents&&(t=b.TrackingEvents);var M=new v(this.adp);M.sequence=this.sequence;M.clickThrough=g;t&&M.parseTrackingEvents(t,M.setTrackingEvents());if(b["@attributes"]){t=b["@attributes"].width||NaN;var r=b["@attributes"].height||NaN;b=b["@attributes"].apiFramework||"None";if((c&&-1!==c.indexOf(":")||p)&&!isNaN(t)&&!isNaN(r)&&k(d)||this.adp.isWrapper){var U=
new l(M);U.init(c,t,r,d,f,NaN,b,p);U.clickThrough=g;M.vastRenditions.push(U)}else m=!0,this.warn("will ignore this rendition because some required fields is missing or incompatible [creativeType,url,code,width,height]:"+[d,c,p,t,r])}else this.adp.isWrapper||(m=!0,this.warn("for InLine ad package, No attributes found for the Companion ads:"+b));m?this.adp.isWrapper&&this.adp.companionAds.push(M):this.adp.companionAds.push(M)},this));b.NonLinear&&(b.NonLinear=[].concat(b.NonLinear),a.Util.forEachOnArray(b.NonLinear,
function(b,c,d){d=c=null;var f="",g="",p="",t=null,m=!1;b.AdParameters&&(p=b.AdParameters.value);b.NonLinearClickThrough&&(g=h(b.NonLinearClickThrough.value));b.StaticResource&&(c=h(b.StaticResource.value),b.StaticResource["@attributes"]&&(d=b.StaticResource["@attributes"].creativeType),f="static");b.IFrameResource&&(c=h(b.IFrameResource.value),d="text/html_doc_ref",f="iframe");b.HTMLResource&&(t=b.HTMLResource["#cdata-section"]||"",t=a.Util.trim(t),d="text/html_doc_lit_mobile",f="HTML");var r=new y(this.adp);
r.sequence=this.sequence;r.clickThrough=g;r._trackingEvents=this._trackingEvents;p&&(r.creativeData=p);if(b["@attributes"]){p=b["@attributes"].width||NaN;var M=b["@attributes"].height||NaN;b=b["@attributes"].apiFramework||"None";if(!c&&!t||isNaN(p)||isNaN(M)||!k(d))m=!0,this.warn("will ignore this rendition because some required fields is missing or incompatible:[creativeType,url,code,width,height]:"+[d,c,t,p,M]);else{var U=new l(r);U.init(c,p,M,d,f,NaN,b,t);U.clickThrough=g;r.vastRenditions.push(U)}}else this.adp.isWrapper||
(m=!0,this.warn("for InLine ad package, No attributes found for the NonLinear ads:"+b));this.adp.nonLinearAds.push(r);m?this.adp.isWrapper&&this.adp.nonLinearAds.push(r):this.adp.nonLinearAds.push(r)},this))},parseLinears:function(a){2!=K?(this.log("TargetAdType != TARGET_LINEAR, skipping parse"),I=!0):this.parse(a)},parseNonLinears:function(a){4!==K?(this.log("TargetAdType != TARGET_NONLINEAR, skipping parse"),I=!0):this.parse(a)},parseCompanionAds:function(a){this.parse(a)},setTrackingEvents:function(){this._trackingEvents||
(this._trackingEvents=new m);return this._trackingEvents},parseTrackingEvents:function(b,c){this.log("parseTrackingEvents");b.Tracking&&(b.Tracking=[].concat(b.Tracking),a.Util.forEachOnArray(b.Tracking,function(a,b,d){b=a["@attributes"].event;if(a=h(a.value))switch(b){case "creativeView":case "start":case "firstQuartile":case "midpoint":case "thirdQuartile":case "complete":case "mute":case "unmute":case "pause":case "resume":case "rewind":case "replay":case "fullscreen":case "expand":case "collapse":case "acceptInvitation":case "stop":c[b].push(a);
break;case "close":c.stop.push(a)}},this))},toString:function(){return this.constructor.name+", renditions:"+this.vastRenditions},log:function(b){a.log("VastTranslator."+this.constructor.name+"\t"+b)},warn:function(b){a.warn("VastTranslator."+this.constructor.name+"\t"+b)}};var E=Object.defineProperty||function(a,b,c){c.get&&a.__defineGetter__(b,c.get);c.set&&a.__defineSetter__(b,c.set)};E(q.prototype,"trackingEvents",{get:function(){this.log("get trackingEvents()");return this._trackingEvents?this._trackingEvents:
this.isDrivingAd?this.adp.trackingEvents:null}});E(q.prototype,"impressions",{set:function(a){this._impressions=a},get:function(){return this.isDrivingAd?this._impressions.concat(this.adp.impressions):this._impressions}});q.prototype.constructor=q;z.prototype=new q;z.prototype.constructor=z;y.prototype=new q;y.prototype.constructor=y;v.prototype=new q;v.prototype.getPrimaryRendition=function(){return this.vastRenditions[0]||null};E(v.prototype,"impressions",{get:function(){return 8===K?this._impressions.concat(this.adp.impressions):
this._impressions}});v.prototype.constructor=v;var R=function(){this.impressions=[];this.errorTrackings=[];this.linearAds=[];this.nonLinearAds=[];this.companionAds=[];this.extensions=[];this.tagUrl="";this.isWrapper=!1;this.surveyUrl=null;this.selectedDrivingRenditions=[];this.selectedDrivingAd=null;this.selectedCompanionAds={}};R.prototype={parse:function(a){this.log("parse("+a+")");if(a)if(this.isWrapper||a.Creatives&&a.Creatives.Creative){a.Creatives=a.Creatives||[];g(this.impressions,a.Impression);
g(this.extensions,a.Extensions);g(this.errorTrackings,a.Error);this.isWrapper&&a.VASTAdTagURI&&(this.tagUrl=a.VASTAdTagURI.value||"");a.Survey&&a.Survey.value&&0<a.Survey.value.length&&(this.surveyUrl=a.Survey.value);a.Creatives.Creative=a.Creatives.Creative?[].concat(a.Creatives.Creative):[];for(var b=0;b<a.Creatives.Creative.length;b++){var c=a.Creatives.Creative[b],d=-1;c["@attributes"]&&(d=c["@attributes"].sequence||-1,d*=1);if(c.Linear){var f=new z(this);f.sequence=d;f.parseLinears(c.Linear);
this.linearAds.push(f)}else c.NonLinearAds?(f=new y(this),f.sequence=d,f.parseNonLinears(c.NonLinearAds)):c.CompanionAds&&(f=new v(this),f.sequence=d,f.parseCompanionAds(c.CompanionAds));f&&c.UniversalAdId?(f.universalAdId={idRegistry:c.UniversalAdId["@attributes"].idRegistry,idValue:c.UniversalAdId["@attributes"].idValue},this.log("Universal Ad ID with idRegistry "+f.universalAdId.idRegistry+" and idValue "+f.universalAdId.idValue)):this.log("No Universal Ad ID is present in the VAST response.")}}else this.warn("parse(): no creative found!");
else this.warn("parse(): empty adpackage")},testAndUpdatePackageForTemporalSlot:function(a){this.log("testAndUpdatePackageForTemporalSlot("+a+")");a=a?this.linearAds:this.nonLinearAds;if(1>a.length)return!1;this.log("testAndUpdatePackageForTemporalSlot(), ads.length = "+a.length+"");var b=!1;if(!b)for(var c=0;c<a.length;c++){var d=this.findRenditionGroupByContentType(a[c]);if(0<d.length){this.log("testAndUpdatePackageForTemporalSlot() : found driving ad and renditions group: "+d);this.selectedDrivingRenditions=
d;this.selectedDrivingAd=a[c];b=!0;break}}return b},testAndUpdatePackageForPageSlots:function(a){var b=!1,c=this.companionAds,d=B.slice(0);this.log("testAndUpdatePackageForPageSlots("+a+"), ads are "+c.join(",")+", slots are "+d.join(","));if(a){if(a=this.matchAdsToSlots(c,d),0<a.length)for(b=!0,c=0;c<a.length;c++){d=a[c];var f=d.ad;this.selectedCompanionAds[d.slot.getCustomId()]=f}}else a=this.matchAdsToSlots(c,[G]),1===a.length?(b=!0,this.selectedDrivingAd=a[0].ad):this.selectedDrivingAd=null;return b},
renditionFitsInSlot:function(a,b){return a?a.width<=b.getWidth()&&a.height<=b.getHeight():!1},calcDeadSpaceRatio:function(a,b){a=a.getPrimaryRendition();if(!a)return!1;this.log("ad w,h  slot w,h"+[a.width,a.height,b.getWidth(),b.getHeight()]);return this.renditionFitsInSlot(a,b)?1-a.width*a.height/b.getWidth()*b.getHeight():1},matchAdsToSlots:function(a,b){this.log("matchAdsToSlots(ads="+a.join(",")+", slots="+b.join(",")+")");for(var c=[],d=null,f=null,g=1,h=0;h<a.length;h++)for(var k=a[h],l=0;l<
b.length;l++){var p=b[l],m=this.calcDeadSpaceRatio(k,p);m<g&&(d=k,f=p,g=m)}null!==d&&(c.push({ad:d,slot:f}),a.splice(a.indexOf(d),1),b.splice(b.indexOf(f),1),c=c.concat(this.matchAdsToSlots(a,b)));this.log("matchAdsToSlots: winningAd:"+d+" winningSlot:"+f+" ratio:"+g);return c},getAllRenditions:function(a){return a.vastRenditions},findRenditionGroupByContentType:function(b){this.log("findRenditionGroupByContentType:"+b);var c=[];if(b instanceof z&&isNaN(b.duration))return this.warn("findRenditionGroupByContentType(), duration of linear ad is NaN, will not used for scheduling"),
c;for(var d=this.getAllRenditions(b),f=0;f<d.length;f++){var g=d[f];if(b instanceof z){if(null==g.creativeType||""==a.Util.trim(g.creativeType)){this.warn("findRenditionGroupByContentType, the contentType "+g.creativeType+" not supported for linearAd");continue}}else if(!k(g.creativeType)){this.warn("findRenditionGroupByContentType, the contentType "+g.creativeType+" not supported for non-linearAd");continue}c.push(g)}return c},formalizeString:function(b){return b?a.Util.trim(b).toLowerCase():""},
getAdsByTargetType:function(){this.log("getAdsByTargetType");var a=[];switch(K){case 8:a=this.companionAds;break;case 2:a=this.linearAds;break;case 4:a=this.nonLinearAds}for(var b=0;b<a.length;b++)a[b].isDrivingAd=!0;return a},getImpressionOfWrapper:function(){this.log("getImpressionOfWrapper");for(var a=this.getAdsByTargetType(),b=null,c=0;c<a.length;c++){var d=a[c];if(d&&d._impressions&&0<d._impressions.length){b=d._impressions;break}}b||(b=this.impressions);return b},getTrackingEventsOfWrapper:function(){this.log("getTrackingEventsOfWrapper");
for(var a=this.getAdsByTargetType(),b=null,c=0;c<a.length;c++){var d=a[c];if(d&&d._trackingEvents){b=d._trackingEvents;break}}return b},getClickThroughOfWrapper:function(){this.log("getClickThroughOfWrapper");for(var a=this.getAdsByTargetType(),b=null,c=0;c<a.length;c++){var d=a[c];if(d){d.clickThrough&&(b=d.clickThrough);d=d.vastRenditions;for(var f=0;f<d.length;f++){var g=d[f];if(g.clickThrough){b=g.clickThrough;break}}if(b)break}}return b},getClickTrackingsOfWrapper:function(){this.log("getClickTrackingsOfWrapper");
for(var a=this.getAdsByTargetType(),b=null,c=0;c<a.length;c++){var d=a[c];if(d){d.clickTrackings&&0<d.clickTrackings.length&&(b=d.clickTrackings);d=d.vastRenditions;for(var f=0;f<d.length;f++){var g=d[f];if(g.clickTrackings&&0<g.clickTrackings.length){b=g.clickTrackings;break}}if(b)break}}return b},getCustomClicksOfWrapper:function(){this.log("getCustomClicksOfWrapper");for(var a=this.getAdsByTargetType(),b=null,c=0;c<a.length;c++){var d=a[c];if(d){d.customClicks&&0<d.customClicks.length&&(b=d.customClicks);
d=d.vastRenditions;for(var f=0;f<d.length;f++){var g=d[f];if(g.customClicks&&0<g.customClicks.length){b=g.customClicks;break}}if(b)break}}return b},testWrapperForRedirect:function(){this.log("testAndUpdateWrapperForRedirect()");return this.tagUrl&&0<this.tagUrl.length},log:function(b){a.log("VastTranslator.VastAdPackage\t"+b)},warn:function(b){a.warn("VastTranslator.VastAdPackage\t"+b)}};R.prototype.constructor=R;P.prototype={getVastVersion:function(a){this.log("getVastVersion("+a+")");return a?0<
a.indexOf(".")?parseInt(a.substring(0,a.indexOf("."))):parseInt(a):-1},parseAdData:function(b){this.log("parseAdData()");var c={},d;c.selectedPackage=null;c.redirectPackage=null;var f=a.Util.xmlToJson(b);if(f)if(f.VAST&&f.VAST["@attributes"])if(this.getVastVersion(f.VAST["@attributes"].version)<a.MINIMUM_VAST_VERSION_SUPPORTED||this.getVastVersion(f.VAST["@attributes"].version)>a.MAXIMUM_VAST_VERSION_SUPPORTED)w.onTranslatorFailed(a.ERROR_PARSE,"wrapperUrl="+r,a.ERROR_VAST_VERSION_NOT_SUPPORTED);
else{if(f.VAST.Ad){f.VAST.Ad=[].concat(f.VAST.Ad);var g=[];b=[];for(d=0;d<f.VAST.Ad.length;d++){var h=new R;h.isWrapper=!!f.VAST.Ad[d].Wrapper;h.isWrapper?(h.parse(f.VAST.Ad[d].Wrapper),b.push(h)):(h.parse(f.VAST.Ad[d].InLine),g.push(h))}f=!1;if(0===g.length&&0===b.length)return this.log("parseAdData(): no ads from vast response!!!"),[c];this.log("parseAdData(): "+g.length+"inline ads, "+b.length+" wrapper ads.");h=null;for(d=0;d<g.length;d++)if(this.selectUsableAdsForDrivingSlot(g[d])){this.log("parseAdData(): package for driving slot is found!!!");
h=g[d];break}d=0<B.length&&A.getSlot().getTimePositionClass()!==a.TIME_POSITION_CLASS_DISPLAY;if(h)d&&this.selectUsableAdsCompanionSlots(h)&&this.log("parseAdData(): companion ads are found for companion slots, with driving slot"),c.selectedPackage=h;else if(d){d=!1;for(var k=0;k<g.length;k++)h=g[k],this.selectUsableAdsCompanionSlots(h)&&(this.log("parseAdData(): companion ads are found for companion slots,without driving slot"),c.selectedPackage=h,d=!0);d||(this.log("parseAdData(): companion ads are not found for companion slots,without driving slot"),
f=!0)}else this.log("parseAdData(): no usable ads found in vast response!!!"),f=!0;if(f&&0<b.length)for(g=0;g<b.length;g++)if(this.testWrapperForRedirect(b[g])){c.redirectPackage=b[g];A.incrementWrapperCount();this.selectUsableAdsCompanionSlots(b[g])&&this.log("parseAdData(): companion ads are found for wrapper ad");break}return[c]}f.VAST.Error&&n(A,a.EVENT_ERROR,a.EVENT_TYPE_ERROR,f.VAST.Error.value);w.onTranslatorFailed(a.ERROR_NO_AD_AVAILABLE,"wrapperUrl="+r,a.ERROR_VAST_NO_AD)}else w.onTranslatorFailed(a.ERROR_PARSE,
"wrapperUrl="+r,a.ERROR_VAST_SCHEMA_VALIDATION);else w.onTranslatorFailed(a.ERROR_PARSE,"wrapperUrl="+r,a.ERROR_VAST_XML_PARSING)},selectUsableAdsForDrivingSlot:function(a){this.log("selectUsableAdsForDrivingSlot()");switch(K){case 2:a=this.testAndUpdatePackageForTemporalSlot(a,!0);break;case 4:a=this.testAndUpdatePackageForTemporalSlot(a,!1);break;case 8:a=this.testAndUpdatePackageForPageSlots(a,!1);break;default:a=!1}return a},selectUsableAdsCompanionSlots:function(a){this.log("selectUsableAdsCompanionSlots(pk)");
return this.testAndUpdatePackageForPageSlots(a,!0)},testAndUpdatePackageForTemporalSlot:function(a,b){this.log("testAndUpdatePackageForTemporalSlot(pk,isLinear), isLinear = "+b);return a.testAndUpdatePackageForTemporalSlot(b)},testAndUpdatePackageForPageSlots:function(a,b){this.log("testAndUpdatePackageForPageSlots(pk,isCompanion) isCompanion = "+b);return a.testAndUpdatePackageForPageSlots(b)},testWrapperForRedirect:function(a){this.log("testWrapperForRedirect(pk)");return a.testWrapperForRedirect()},
log:function(b){a.log("VastTranslator.VastParser\t"+b)},warn:function(b){a.warn("VastTranslator.VastParser\t"+b)}};var r=A.getActiveCreativeRendition().getWrapperUrl();E=A.getActiveCreativeRendition().getWrapperType();c("AdInstance.getActiveCreativeRendition().getWrapperUrl()="+r+", getWrapperType()="+E);if(0!=E.indexOf("external/vast-"))w.onTranslatorFailed(a.ERROR_NO_RENDERER,"wrapperType="+E+";wrapperUrl="+r,a.ERROR_VAST_TRACKING_ERROR);else if(r&&0!==r.length){var S=a.VAST_DEFAULT_MAX_WRAPPER_COUNT;
(E=b.getParameter(a.PARAMETER_VAST_MAX_WRAPPER_COUNT))&&0<Number(E)&&(S=Number(E));if(A.getWrapperCount()>=S)w.onTranslatorFailed(a.ERROR_IO,"maximum wrapper limit is reached "+A.getWrapperCount(),a.ERROR_VAST_WRAPPER_LIMIT_REACH);else{S=b.getParameter("translator.vast.asyncLoad");S=!0===a.Util.str2bool(S);c("will load vast xml, asyncAjax:"+S);var W=b.getParameter("translator.vast.loadWithCookie");W=!0===a.Util.str2bool(W);var D=null,Q=5E3;(E=b.getParameter(a.PARAMETER_VAST_TIMEOUT_IN_MILLISECONDS))&&
0<Number(E)&&(Q=Number(E));try{window.XDomainRequest?(D=new XDomainRequest,S=!0):(D=new XMLHttpRequest,D.withCredentials=W),w._request=D,S?(D.open("GET",r),window.XDomainRequest?D.onload=function(){var a=new ActiveXObject("Microsoft.XMLDOM");a.async=!1;a.loadXML(D.responseText);D.responseXML=a;D.status=200;u(D)}:(D.timeout=Q,D.onreadystatechange=function(){4==D.readyState&&u(D)}),D.ontimeout=function(){w.onTranslatorFailed(a.ERROR_TIMEOUT,"wrapperUrl="+r+" timed out.",a.ERROR_VAST_URI_TIMEOUT)},D.onerror=
function(){window.XDomainRequest&&(D.status=0);0==D.status?(d("CORS error"),w.onTranslatorFailed(a.ERROR_SECURITY,"wrapperUrl="+r)):(d("exception:"+D.statusText),w.onTranslatorFailed(a.ERROR_UNKNOWN,"wrapperUrl="+r+";exception="+D.statusText))},D.send()):(D.open("GET",r,!1),D.send(),u(D))}catch(p){E=!1;if(!window.XMLHttpRequestException)p.code===DOMException.NETWORK_ERR&&(d("CORS in IE10"),E=!0);else if(p instanceof XMLHttpRequestException)switch(p.code){case XMLHttpRequestException.NETWORK_ERR:E=
!0}E?(d("CORS error:"+p),w.onTranslatorFailed(a.ERROR_SECURITY,"wrapperUrl="+r)):(d("exception:"+p),w.onTranslatorFailed(a.ERROR_UNKNOWN,"wrapperUrl="+r+";exception="+p))}}}else w.onTranslatorFailed(a.ERROR_NULL_ASSET,"wrapperUrl="+r,a.ERROR_VAST_TRACKING_ERROR)},info:function(){return{moduleType:a.MODULE_TYPE_TRANSLATOR}},log:function(b){a.log("VastTranslator\t"+b)},warn:function(b){a.warn("VastTranslator\t"+b)},getPlayheadTime:function(){return-1},getDuration:function(){return-1},stop:function(){a.debug("VastTranslator stop");
this._request&&(this._request.abort(),a.log("VastTranslator Stop: request aborted"));this._request=null;this._rendererController&&this._rendererController.handleStateTransition(a.TRANSLATOR_STATE_COMPLETED)},onTranslatorFailed:function(b,c,d){this._request&&(this._request=null);var f={};f[a.INFO_KEY_ERROR_MODULE]="VastTranslator";f[a.INFO_KEY_ERROR_CODE]=b;f[a.INFO_KEY_VAST_ERROR_CODE]=d;c&&(f[a.INFO_KEY_ERROR_INFO]=c);this._rendererController.handleStateTransition(a.TRANSLATOR_STATE_FAILED,f)}};
a.VastTranslator.prototype.constructor=a.VastTranslator;a.VideoAsset=function(b){this._defaultTimeouts=[5,10,15,30,60,120,180,300];this._context=b;this._internalState=a.MediaInitState.instance;this._eventCallback=this._state="";this._callbackTimer=null;this._requestedVideoViewUrl=this._videoPlayPending=!1;this._dummyInstanceId="";this._delay=0;this._location=this._networkId=this._duration=this._customId=this._id="";this._autoPlayType=null;this._fallbackId="";this._viewRandom=0;this._durationType=
null;this._currentTpos=0};a.VideoAsset.prototype={setVideoAsset:function(b,c,d,f,g,k,h,l,m){if(b){switch(h){case a.ID_TYPE_FW:h=this._id!=b;this._id=b;break;case a.ID_TYPE_GROUP:h=this._id!="g"+b;this._id="g"+b;break;default:h=this._customId!=b,this._customId=b}h&&(this._eventCallback="");"number"===typeof c&&(this._duration=Math.round(10*c)/10);0<1*d&&(this._networkId=1*d);"string"===typeof f&&(this._location=f);"number"===typeof g&&(this._autoPlayType=g);0<1*k&&(this._viewRandom=1*k);"number"===
typeof l&&0<l?this._fallbackId=""+l:"string"===typeof l&&(this._fallbackId=l.trim());if(m===a.VIDEO_ASSET_DURATION_TYPE_EXACT||m===a.VIDEO_ASSET_DURATION_TYPE_VARIABLE)this._durationType=m;this._videoPlayPending&&this.play()}else a.warn("AdRequest.setVideoAsset","id is required.")},setVideoAssetCurrentTimePosition:function(b){!b||0>b?a.warn("AdRequest.setVideoAssetCurrentTimePosition","valid timePosition is required"):this._currentTpos=b},setVideoState:function(b){b===a.VIDEO_STATE_PLAYING?(this._state===
a.VIDEO_STATE_PAUSED&&this._context.dispatchEvent(a.EVENT_CONTENT_VIDEO_RESUMED),this.play()):b===a.VIDEO_STATE_PAUSED||b===a.VIDEO_STATE_STOPPED?(this.pause(),b===a.VIDEO_STATE_PAUSED&&this._state===a.VIDEO_STATE_PLAYING&&this._context.dispatchEvent(a.EVENT_CONTENT_VIDEO_PAUSED)):b===a.VIDEO_STATE_COMPLETED&&this.complete();this._state=b},callback:function(b){this._eventCallback?this._eventCallback.process():b=!0;b||((b=this._defaultTimeouts.shift())||(b=300),this._callbackTimer=new a.Timer(b,a.Util.bind(this,
this.callback)),this._callbackTimer.start())},getPlayheadTime:function(){var a=this._delay;this._delay=0;a+=this._callbackTimer?this._callbackTimer.getCTValue():0;return Math.floor(a)},play:function(){this._context._adManager._serverURL&&this._context._adManager._networkId&&(this._id||this._customId)?this._eventCallback?(this._videoPlayPending=!1,this._internalState.play(this)):this._requestedVideoViewUrl||(this._requestedVideoViewUrl=!0,this.requestForVideoViewCallback(),this._callbackTimer||(this._callbackTimer=
new a.Timer,this._callbackTimer.tick())):(a.warn("Server URL or Network ID or Video Asset id/customId is not set, pend video asset play request."),this._videoPlayPending=!0,this._callbackTimer||(this._callbackTimer=new a.Timer,this._callbackTimer.tick()))},pause:function(){this._internalState.pause(this)},complete:function(){this._internalState.complete(this)},onStartPlaying:function(){this.callback()},onStartReplaying:function(){this.callback()},onPausePlaying:function(){this.callback(!0);this._callbackTimer.pause()},
onResumePlaying:function(){this._callbackTimer.start()},onCompletePlaying:function(){this.callback(!0);this._callbackTimer.stop();this._callbackTimer=null;this._eventCallback="";this._requestedVideoViewUrl=!1},onCompleteReplaying:function(){this.onCompletePlaying()},setMediaState:function(a){this._internalState=a},requestPauseBySlot:function(b){a.debug("requestPauseBySlot");this._internalState==a.MediaPlayingState.instance||this._internalState==a.MediaReplayingState.instance?this._context.dispatchEvent(a.EVENT_CONTENT_VIDEO_PAUSE_REQUEST,
{slot:b}):a.debug("Not sending content pause request because content video state is",JSON.stringify(this._internalState))},requestResumeBySlot:function(b){a.debug("requestResumeBySlot");this._internalState==a.MediaPausedState.instance||this._internalState==a.MediaReplayPausedState.instance?this._context.dispatchEvent(a.EVENT_CONTENT_VIDEO_RESUME_REQUEST,{slot:b}):a.debug("Not sending content resume request because content video state is ",JSON.stringify(this._internalState))},requestForVideoViewCallback:function(){var b=
new a.Context(this._context._adManager);b._videoAsset=this;this._dummyInstanceId=b._instanceId;b=this._context._adRequest.generateVideoViewRequestUrlWithDummyContextInstanceId(b._instanceId);var c=this;a.PLATFORM_SEND_REQUEST_BY_FORM?(a.debug("Context.submitRequest:","use json2"),a.Util.pingURLWithForm(b,this._dummyInstanceId,!0),c._onMessagePosted=function(a){"object"===typeof a.data&&a.data.hasOwnProperty("cbfn")&&-1<a.data.cbfn.indexOf("['Context_"+this._dummyInstanceId+"']")&&c.requestComplete(a.data.response)},
window.addEventListener("message",c._onMessagePosted,!1)):a.Util.pingURLWithScript(b)},requestComplete:function(b){this._delay=this._callbackTimer.tick();this._callbackTimer=null;if(a.PLATFORM_SEND_REQUEST_BY_FORM){window.removeEventListener("message",this._onMessagePosted,!1);var c=document.getElementById("_fw_request_iframe_"+this._dummyInstanceId);document.body.removeChild(c)}null!==b?(a._instanceQueue["Context_"+this._dummyInstanceId]=null,this.parse(a.Util.getObject("siteSection.videoPlayer.videoAsset",
b)||{}),this.play()):a.warn("Failed to get video view callback url.")},parse:function(b){if(b){this._customId=b.customId;this._networkId=parseInt(b.networkId);for(var c=0,d=b.eventCallbacks||[];c<d.length;c++){b=d[c];var f=a.EventCallback.newEventCallback(this._context,b.name,b.type);if(f&&b.name===a.EVENT_VIDEO_VIEW){f.parse(b);this._eventCallback=f;a.debug("Parsed video view url: "+this._eventCallback._url);break}}}}};a.VideoRenderer=function(){this._adVideo=null;this._duration=this._playheadTime=
-1;this._dragging=this._stopInvoked=this._isEnded=!1;this._volume=1;this._rendererController=null;this._isBuffering=!1};a.VideoRenderer.prototype={pause:function(){this._rendererController&&this._rendererController.processEvent({name:a.EVENT_AD_PAUSE});this._adVideo&&!this._adVideo.paused&&this._adVideo.pause()},resume:function(){this._rendererController&&this._rendererController.processEvent({name:a.EVENT_AD_RESUME});this._adVideo&&this._adVideo.paused&&this._adVideo.play()},start:function(b){this._rendererController=
b;var c=b.getAdInstance(),d=c.getSlot(),f=this,g=!1,k=!1;if(a.PLATFORM_NOT_SUPPORT_VIDEO_AD)this._onRendererFailed(a.ERROR_DEVICE_LIMIT,d.getTimePositionClass());else if(a.PLATFORM_NOT_SUPPORT_MIDROLL_AD&&d.getTimePositionClass()===a.TIME_POSITION_CLASS_MIDROLL)this._onRendererFailed(a.ERROR_DEVICE_LIMIT,"midroll");else{a.log("VideoRenderer.start",d.getTimePositionClass(),c);var h=b.getContentVideoElement(),l=d.getVideoDisplaySize().width,m=d.getVideoDisplaySize().height,q=c.getRenderableCreativeRenditions(),
z=(l=(new a.RenditionSelector(b.getParameter(a.PARAMETER_DESIRED_BITRATE)||1E3,b.getParameter("arWeight")||1,b.getParameter("pxWeight")||1,.2)).getBestFitRendition(q,l,m))?l.getPrimaryCreativeRenditionAsset():null;if(z&&q.length)if(z.getUrl()){c.setActiveCreativeRendition(l);a.log("VideoRenderer.start selected rendition is:",z.getUrl());b.setCapability(a.EVENT_AD_QUARTILE,a.CAPABILITY_STATUS_ON);b.setCapability(a.EVENT_AD_MUTE,a.CAPABILITY_STATUS_ON);b.setCapability(a.EVENT_AD_PAUSE,a.CAPABILITY_STATUS_ON);
var y=!a.PLATFORM_NOT_SUPPORT_CLICK_FOR_VIDEO;y||b.setCapability(a.EVENT_AD_CLICK,a.CAPABILITY_STATUS_OFF);var v=a.PLATFORM_EVENT_CLICK,P=a.MOBILE_EVENT_DRAG;a.debug("VideoRenderer","use content video element");h.controls=!1;this._adVideo=h;var n=null,J=null,F=null;this._volume=b.getContext().getAdVolume();this._adVideo.volume=this._volume;this._adVideo.muted=0==this._volume;var H=function(b){a.debug("VideoRenderer.checkTimeUpdate timeout");Q(b)},x=function(){J&&(clearTimeout(J),J=null)},N=a.Util.bind(this,
function(c){a.debug("onAdVideoBufferEmpty(): Ad video event "+c.type);c=b.getParameter(a.PARAMETER_RENDERER_VIDEO_PLAY_AFTER_STALLED);null!=c&&"undefined"!==typeof c&&!1!==a.Util.str2bool(c)&&(a.debug("play the ad immediately after the stalled event"),h&&h._fw_videoAdPlaying&&h.play())}),L=function(c){this._isBuffering||(this._isBuffering=!0,b.processEvent({name:a.EVENT_AD_BUFFERING_START}),a.debug("onAdVideoBufferingStarted(): Ad video event "+c.type))},u=function(c){this._isBuffering&&(this._isBuffering=
!1,b.processEvent({name:a.EVENT_AD_BUFFERING_END}),a.debug("onAdVideoBufferingEnded(): Ad video event "+c.type))};c=b.getParameter(a.PARAMETER_EXTENSION_AD_CONTROL_CLICK_ELEMENT);var C=null;c&&(C=document.getElementById(c));C||(C=h);var I=a.Util.bind(this,function(c){if(h.paused&&a.PLATFORM_NOT_FIRE_CLICK_WHEN_AD_VIDEO_PAUSED)h.play();else{var d=b.getParameter(a.PARAMETER_RENDERER_VIDEO_CLICK_DETECTION);null==d&&(d="true");!1!==a.Util.str2bool(d)&&(k?(a.debug("Ad video event "+c.type),this._dragging?
this._dragging=!1:b.processEvent({name:a.EVENT_AD_CLICK})):a.debug("Ad not started, ignore click."))}}),A=a.Util.bind(this,function(b){a.debug("Ad video event "+b.type);this._dragging=!0}),w,G=function(c){a.debug("Ad video event "+c.type+" ended: "+h.ended+" playing:"+h._fw_videoAdPlaying);if(h.ended&&.2>Math.abs(h.duration-h.currentTime)||!h._fw_videoAdPlaying)w=setTimeout(function(){a.warn("Force ad video end bc ad paused with ended = true");c.type="ended";O(c)},200);else{var d=b.getParameter(a.PARAMETER_RENDERER_VIDEO_DISPLAY_CONTROLS_WHEN_PAUSE);
null==d&&(d="true");!1===a.Util.str2bool(d)?a.debug("Pause controls disabled"):h.controls=!0;x()}},K=function(b){a.debug("Ad video event "+b.type);h.controls=!1},B=0,V=function(c){0>=h.currentTime?a.debug("VideoRenderer.onAdVideoTimeUpdate currentTime is less than or 0"):(x(),h.paused||(c=b.getParameter(a.PARAMETER_RENDERER_VIDEO_PROGRESS_DETECT_TIMEOUT)||8E3,J=setTimeout(H,c,c+"ms timeout when playing")),k||(k=!0,f._playheadTime=h.currentTime,0>f._playheadTime&&(f._playheadTime=0),n&&(clearTimeout(n),
n=null),f._quartileTimerId=setInterval(function(){var c=h.currentTime,d=h.duration;0<c&&(f._playheadTime=c);0<d&&(f._duration=d);"number"!==typeof c||"number"!==typeof d||F||(c>=.25*d&&1>B&&(b.processEvent({name:a.EVENT_AD_FIRST_QUARTILE}),B=1),c>=.5*d&&2>B&&(b.processEvent({name:a.EVENT_AD_MIDPOINT}),B=2),c>=.75*d&&3>B&&(clearInterval(f._quartileTimerId),f._quartileTimerId=null,b.processEvent({name:a.EVENT_AD_THIRD_QUARTILE}),B=3))},1E3),b.handleStateTransition(a.RENDERER_STATE_STARTED)))};this.dispose=
a.Util.bind(this,function(){O()});var O=function(c){var d=F;c&&c.type&&(a.debug("Ad video event "+c.type),"error"===c.type&&(a.warn(c.target.src),a.warn(c.target.currentSrc),u()));x();n&&(clearTimeout(n),n=null);y&&(C.removeEventListener(v,I,!1),C.removeEventListener(P,A,!1));w&&(clearTimeout(w),w=null);h.removeEventListener("ended",O,!1);h.removeEventListener("error",O,!0);h.removeEventListener("pause",G,!1);h.removeEventListener("playing",K,!1);h.removeEventListener("timeupdate",V,!1);h.removeEventListener("stalled",
N,!1);h.removeEventListener("waiting",L,!1);h.removeEventListener("canplay",u,!1);h.paused||(a.debug("try pausing video before complete"),h.pause());c&&"error"===c.type&&(d="video error",(c=h.error||c.target.error)&&(d="error:"+c+",code:"+c.code));d||(f._isEnded=!0);a.log("VideoRenderer.complete");g||(g=!0,delete h._fw_videoAdPlaying,f._adVideo=null,f._quartileTimerId&&(clearInterval(f._quartileTimerId),f._quartileTimerId=null),d?f._onRendererFailed(null,d):(f._stopInvoked||(h.currentTime>=.25*h.duration&&
1>B&&(b.processEvent({name:a.EVENT_AD_FIRST_QUARTILE}),B=1),h.currentTime>=.5*h.duration&&2>B&&(b.processEvent({name:a.EVENT_AD_MIDPOINT}),B=2),h.currentTime>=.75*h.duration&&3>B&&(b.processEvent({name:a.EVENT_AD_THIRD_QUARTILE}),B=3),h.currentTime>=h.duration-.5&&4>B&&(b.processEvent({name:a.EVENT_AD_COMPLETE}),B=4)),f._stopInvoked=!1,b.handleStateTransition(a.RENDERER_STATE_COMPLETED)));f._rendererController=null};var Q=function(b){F=b;a.warn(F);a.PLATFORM_WAIT_WHEN_AD_VIDEO_TIMEOUT||O()};h._fw_videoAdPlaying=
!0;var E=!1,R=function(){if(!E){E=!0;y&&(C.addEventListener(v,I,!1),C.addEventListener(P,A,!1));h.addEventListener("ended",O,!1);h.addEventListener("error",O,!0);h.addEventListener("pause",G,!1);h.addEventListener("playing",K,!1);h.addEventListener("timeupdate",V,!1);h.addEventListener("stalled",N,!1);h.addEventListener("waiting",L,!1);h.addEventListener("canplay",u,!1);h.src=z.getUrl();a.log("VideoRenderer play video ad "+h.src);h.load();if(h._fw_fromVideoPool||a.PLATFORM_SUPPORT_VIDEO_START_DETECT_TIMEOUT){var c=
b.getParameter(a.PARAMETER_RENDERER_VIDEO_START_DETECT_TIMEOUT)||5E3;n=setTimeout(Q,c,c+"ms timeout before playing")}a.PLATFORM_VIDEO_DOESNOT_SUPPORT_TIMEUPDATE&&b.handleStateTransition(a.RENDERER_STATE_STARTED);c=100;0<a.PLATFORM_ANDROID_VERSION&&(c=b.getParameter(a.PARAMETER_RENDERER_VIDEO_ANDROID_DELAY)||100);setTimeout(function(){var c=h.play();c&&a.PLATFORM_BLOCKS_AUTOPLAY&&c.catch(function(c){if(c&&"AbortError"==c.name||"NotAllowedError"==c.name)a.warn("Blocked by browser, need player to display a start button. Details: %o",
c),n&&(clearTimeout(n),n=null),d.setAutoPlayBlocked(!0),b.processEvent({name:a.EVENT_AD_AUTO_PLAY_BLOCKED,info:{apiOnly:!0}})})},c)}};a.VideoRenderer._fw_playedDummyVideo||d.getTimePositionClass()!==a.TIME_POSITION_CLASS_PREROLL||!a.PLATFORM_PLAY_DUMMY_VIDEO_FOR_PREROLL||/\.webm$/.test(z.getUrl())?R():(a.VideoRenderer._fw_playedDummyVideo=!0,a.debug("play dummy video for iOS 3.2-4.1"),h.src="http://127.0.0.1:1/404.mp4",h.load(),h.play(),h._fw_videoAdPlaying=!0,h.addEventListener("error",function(){event.target.removeEventListener("error",
h,!0);R()},!0),setTimeout(R,a.PLATFORM_NOT_WAIT_FOR_ERROR_WHEN_PLAY_DUMMY_VIDEO_FOR_PREROLL?500:5E3))}else this._onRendererFailed(a.ERROR_NULL_ASSET);else this._onRendererFailed(a.ERROR_DEVICE_LIMIT,"no compatible asset")}},stop:function(){a.debug("VideoRenderer stop");this._stopInvoked=!0;this._adVideo&&(this._adVideo._fw_videoAdPlaying=!1,this._adVideo.pause(),this.dispose());this._rendererController=null},info:function(){return{moduleType:a.MODULE_TYPE_RENDERER}},getPlayheadTime:function(){if(this._isEnded&&
0<this._duration)return this._duration;if(this._adVideo){var a=this._adVideo.currentTime;if(0<a)return a}return this._playheadTime},getDuration:function(){return this._duration},setVolume:function(b){a.debug("VideoRenderer setVolume("+b+")");this._adVideo?(this._adVideo.volume=b,this._adVideo.muted=0==b,this._volume!=b&&this._rendererController.processEvent({name:a.EVENT_AD_VOLUME_CHANGE}),0==this._volume&&0!=b?this._rendererController.processEvent({name:a.EVENT_AD_UNMUTE}):0!=this._volume&&0==b&&
this._rendererController.processEvent({name:a.EVENT_AD_MUTE}),this._volume=b):a.debug("VideoRenderer ad video is null, ignore.")},_onRendererFailed:function(b,c,d){var f={};f[a.INFO_KEY_ERROR_MODULE]="VideoRenderer";f[a.INFO_KEY_ERROR_CODE]=b;d||(d=a.ERROR_VAST_GENERAL_LINEAR_ERROR);f[a.INFO_KEY_VAST_ERROR_CODE]=d;c&&(f[a.INFO_KEY_ERROR_INFO]=c);this._rendererController.handleStateTransition(a.RENDERER_STATE_FAILED,f)}};a.VideoRenderer.prototype.constructor=a.VideoRenderer;a.VideoStateExtension=function(){};
a.VideoStateExtension.prototype={_enabled:function(){if(null==this._context)return!1;var b=this._context.getParameter(a.PARAMETER_EXTENSION_VIDEO_STATE_ENABLED);null==b&&(b="false");return!0===a.Util.str2bool(b)},init:function(b){this._context=b;this._enabled()?this._context.setVideoState(a.VIDEO_STATE_PLAYING):a.log("VideoStateExtension is disabled.")},dispose:function(){this._context=null}};a.VideoStateExtension.prototype.constructor=a.VideoStateExtension;a.VPAIDWrapper=function(){this._creative=
null;this._timeoutInMs=0;this._eventHandlers={};this._loadIntervalTimer=this._timeoutTimer=null;this._timeoutOperation="";this.timeoutReached=!1;this._visibilityChangeListener=null};a.VPAIDWrapper.prototype={_isCreativeFunctionInvokable:function(a){return this._creative?(a=this._creative[a])&&"function"==typeof a?!0:!1:!1},checkVPAIDInterface:function(a){for(var b={passed:!0,missingInterfaces:""},d=a.length-1;0<=d;d--)this._isCreativeFunctionInvokable(a[d])||(b.passed=!1,b.missingInterfaces+=a[d]+
" ");return b},loadCreativeAsset:function(b){a.log("loadCreativeAsset("+b+")");var c=document.getElementById("vpaidFrame"),d=document.createElement("iframe");d.id="vpaidFrame";null==c?document.body.appendChild(d):document.body.replaceChild(d,c);d.width=0;d.height=0;d.style.display="none";d.contentWindow.document.open();d.contentWindow.document.write('<script type="text/javascript" src="'+b+'"> \x3c/script>');d.contentWindow.document.close();this._timeoutOperation="loadCreativeAsset";this._waitForTimeout();
var f=this;this._loadIntervalTimer=setInterval(function(){var b=document.getElementById("vpaidFrame").contentWindow.getVPAIDAd;b&&"function"===typeof b&&(clearInterval(f._loadIntervalTimer),b=b(),"undefined"===typeof b?a.debug("getVPAIDAd() returns undefined value"):null===b?a.debug("getVPAIDAd() returns null"):(f._creative=b,f._eventHandlers.CreativeAssetLoaded()))},200)},setCallbacksForCreative:function(a,c){for(var b in a)a.hasOwnProperty(b)&&this._creative.subscribe(a[b],b,c)},removeCallbacksForCreative:function(a){for(var b in a)a.hasOwnProperty(b)&&
this._creative.unsubscribe(a[b],b)},handshakeVersion:function(b){a.log("VPAID Creative: handshakeVersion("+b+")");return this._creative.handshakeVersion(b)},initAd:function(b,c,d,f,g,k){a.log("VPAID Creative: initAd()");this._timeoutOperation="initAd";this._waitForTimeout();this._creative.initAd(b,c,d,f,g,k)},startAd:function(){a.log("VPAID Creative: startAd()");this._timeoutOperation="startAd";this._waitForTimeout();this._creative.startAd()},stopAd:function(){a.log("VPAID Creative: stopAd()");"startAd"===
this._timeoutOperation?(clearTimeout(this._timeoutTimer),this._timeoutOperation="startAd and stopAd"):this._timeoutOperation+="stopAd";this._creative&&(this._waitForTimeout(),this._creative.stopAd())},canPauseAd:function(){return this._isCreativeFunctionInvokable("pauseAd")},canResumeAd:function(){return this._isCreativeFunctionInvokable("resumeAd")},canResizeAd:function(){return this._isCreativeFunctionInvokable("resizeAd")},pauseAd:function(){this.canPauseAd()&&(a.log("VPAID Creative: pauseAd()"),
this._creative.pauseAd())},resumeAd:function(){this.canResumeAd()&&(a.log("VPAID Creative: resumeAd()"),this._creative.resumeAd())},resizeAd:function(b,c,d){this.canResizeAd()?(a.log("VPAID Creative: resizeAd()"),this._creative.resizeAd(b,c,d)):a.log("The creative is not able to resize")},getAdVolume:function(){return this._isCreativeFunctionInvokable("getAdVolume")?this._creative.getAdVolume():-1},setAdVolume:function(a){this._isCreativeFunctionInvokable("setAdVolume")&&this._creative.setAdVolume(a)},
getAdExpanded:function(){return this._isCreativeFunctionInvokable("getAdExpanded")?this._creative.getAdExpanded():!1},getAdRemainingTime:function(){return this._isCreativeFunctionInvokable("getAdRemainingTime")?this._creative.getAdRemainingTime():-1},getAdDuration:function(){return this._isCreativeFunctionInvokable("getAdDuration")?this._creative.getAdDuration():-1},getAdLinear:function(){return this._creative.getAdLinear()},getAdCompanions:function(){return this._isCreativeFunctionInvokable("getAdCompanions")?
this._creative.getAdCompanions():""},setTimeoutValueInMs:function(a){this._timeoutInMs=a},cancelTimeoutEvent:function(){var a="startAd and stopAd"!==this._timeoutOperation;clearTimeout(this._timeoutTimer);if(!a){this._timeoutOperation="startAd";var c=this;setTimeout(function(){c._eventHandlers&&c._eventHandlers.timeout&&c._eventHandlers.timeout.call()},500)}},addEventListener:function(a,c){this._eventHandlers[a]=c},removeEventListener:function(a){this._eventHandlers[a]=null},_waitForTimeout:function(){a.log("Wait for "+
this._timeoutOperation+" for "+this._timeoutInMs+"ms");if(this._eventHandlers.timeout){var b=this;this._timeoutTimer=setTimeout(function(){b.timeoutReached||(b.timeoutReached=!0);"startAd"===b._timeoutOperation?b.stopAd():("loadCreativeAsset"===b._timeoutOperation&&clearInterval(b._loadIntervalTimer),b._eventHandlers&&b._eventHandlers.timeout&&b._eventHandlers.timeout.call())},this._timeoutInMs)}},getTimeoutOperation:function(){return this._timeoutOperation}};a.VPAIDWrapper.prototype.constructor=
a.VPAIDWrapper;a.VPAIDRenderer=function(){this.vpaidCreative=this.rendererController=null;this.vpaidVolume=this.vpaidDuration=-1;this.creativeEventCallbacks={};this.isMuted=!1;this.adPlaybackState="";this.creativeTimeoutDelayInMs=1E4;this.vpaidDesiredBitrate=268;this.vpaidViewmode="normal";this.playheadTime=0;this.videoBase=document.createElement("div");this.videoParent=null;this.SUPPORTED_CREATIVE_VPAID_VERSION_MIN=this.PLAYER_VPAID_VERSION=2};a.VPAIDRenderer.prototype={};a.VPAIDRenderer.prototype.constructor=
a.VPAIDRenderer;a.VPAIDRenderer.VastCompanion=function(a,c,d,f){this._width=a;this._height=c;this._apiFramework=d;this._xmlNode=f};a.VPAIDRenderer.VastCompanion.prototype={getWidth:function(){return this._width},getHeight:function(){return this._height},_isValidResource:function(a,c){return"StaticResource"===a&&c["@attributes"].creativeType||"IFrameResource"===a&&c.value||"HTMLResource"===a&&c.value},hasValidRendtions:function(){for(var a in this._xmlNode)if(this._xmlNode.hasOwnProperty(a)&&("StaticResource"===
a||"IFrameResource"===a||"HTMLResource"===a))for(var c=[].concat(this._xmlNode[a]),d=c.length-1;0<=d;d--)if(this._isValidResource(a,c[d]))return!0;return!1},translateToAdInstance:function(b){this._xmlNode.CompanionClickThrough&&b.setClickThroughUrl(a.EVENT_AD_CLICK,this._xmlNode.CompanionClickThrough.value);if(this._xmlNode.TrackingEvents){var c=this._xmlNode.TrackingEvents;if(c.Tracking){c=[].concat(c.Tracking);for(var d=[],f=c.length-1;0<=f;f--)"creativeView"===c[f]["@attributes"].event&&d.push(c[f].value);
0<d.length&&b.addEventCallbackUrls(a.EVENT_AD_IMPRESSION,a.EVENT_TYPE_IMPRESSION,d)}}for(var g in this._xmlNode)if(this._xmlNode.hasOwnProperty(g)&&("StaticResource"===g||"IFrameResource"===g||"HTMLResource"===g))for(c=[].concat(this._xmlNode[g]),f=c.length-1;0<=f;f--)if(this._isValidResource(g,c[f])){d=c[f];var k=b.addCreativeRendition();k.setWidth(this._width);k.setHeight(this._height);k.setCreativeApi("None");var h=k.addCreativeRenditionAsset("VPAIDAsset"+f,!0);h.setContentType("text/html_doc_lit_mobile");
h.setMimeType("text/html");var l=b.getEventCallbackUrls(a.EVENT_AD_CLICK,a.EVENT_TYPE_CLICK)[0],m=g;"HTMLResource"===m?h.setContent(a.HTMLAdGenerator.wrapUnsafeHTML(d.value,b.getSlot().getCustomId(),this._width,this._height)):("IFrameResource"===m?creativeType="iframe":"StaticResource"===m&&(creativeType=this._xmlNode.creativeType),h.setContent(a.HTMLAdGenerator.generateAd(d.value,l,b.getSlot().getCustomId(),this._width,this._height,creativeType,h.getContentType())));a.debug("rendtion width: "+k.getWidth()+
" height:"+k.getHeight()+" asset content:"+h.getContent())}}};a.VPAIDRenderer.VastCompanion.prototype.constructor=a.VPAIDRenderer.VastCompanion;a.VPAIDRenderer.VastAdSelect=function(){};a.VPAIDRenderer.VastAdSelect.prototype={_getDeadSpaceRatio:function(b,c){var d=b.getWidth();b=b.getHeight();var f=c.getWidth();c=c.getHeight();var g=1;d<=f&&b<=c&&(g=1-d*b/(f*c));a.debug("computing dead space ratio ("+g+") for slot "+f+"x"+c+" and ad "+d+"x"+b);return g},matchAdsWithSlots:function(b,c){a.log("VPAIDRenderer: Matching ads with slots");
for(var d=0;d<c.length;++d)c[d].matched=!1;var f=[],g=[];for(d=0;d<b.length;d++)for(var k=0;k<c.length;k++)g.push({ratio:this._getDeadSpaceRatio(b[d],c[k]),adIndex:d,slotIndex:k});g.sort(function(a,b){return a.ratio-b.ratio});for(d=0;d<g.length&&1!=g[d].ratio;d++){k=g[d];var h=b[k.adIndex],l=c[k.slotIndex];h.matched||l.matched||(a.log("Winning ratio:"+k.ratio+" Winning ad:"+h.getWidth()+"x"+h.getHeight()+" for slot:"+l.getWidth()+"x"+l.getHeight()),f.push({ad:h,slot:l}),h.matched=!0,l.matched=!0)}return f}};
a.VPAIDRenderer.VastAdSelect.prototype.constructor=a.VPAIDRenderer.VastAdSelect;a.Util.mixin(a.VPAIDRenderer.prototype,{_failWithError:function(b,c,d){var f={};f[a.INFO_KEY_ERROR_MODULE]="VPAIDRenderer";f[a.INFO_KEY_ERROR_CODE]=b;d||(d=a.ERROR_VAST_GENERAL_VPAID_ERROR);f[a.INFO_KEY_VAST_ERROR_CODE]=d;c&&(f[a.INFO_KEY_ERROR_INFO]=c);this.rendererController.handleStateTransition(a.RENDERER_STATE_FAILED,f);this.dispose()},onCreativeTimeout:function(){a.log("VPAIDRenderer: onCreativeTimeout()");var b=
this.vpaidCreative.getTimeoutOperation();this._failWithError(a.ERROR_TIMEOUT,"loadCreativeAsset"!==b?"Creative function "+b+" timeout":"load creative asset timeout")},setVolume:function(b){a.log("VPAIDRenderer: setVolume("+b+")");this.vpaidCreative&&this.vpaidCreative.setAdVolume(b)},onAdVolumeChange:function(){a.log("VPAIDRenderer: onAdVolumeChange()");var b=this.vpaidCreative.getAdVolume();0>b||1<b?a.log("Invalid ad volume value"):(this.isMuted&&2<100*b?(this.isMuted=!1,this.rendererController.processEvent({name:a.EVENT_AD_UNMUTE})):
!this.isMuted&&2>100*b&&(this.isMuted=!0,this.rendererController.processEvent({name:a.EVENT_AD_MUTE})),this.rendererController.processEvent({name:a.EVENT_AD_VOLUME_CHANGE}))},onAdExpandedChange:function(){a.log("VPAIDRenderer: onAdExpandedChange()");this.vpaidCreative.getAdExpanded()?this.rendererController.processEvent({name:a.EVENT_AD_EXPAND}):this.rendererController.processEvent({name:a.EVENT_AD_COLLAPSE})},onAdDurationChange:function(){a.log("VPAIDRenderer: onAdDurationChange(): duration changed to "+
this.vpaidCreative.getAdDuration())},onAdClickThru:function(b,c,d){a.log("VPAIDRenderer: onAdClickThru() with url:"+b+" id:"+c+" playerHandles:"+d);c={name:tv.freewheel.SDK.EVENT_AD_CLICK,info:{}};c.info[a.INFO_KEY_SHOW_BROWSER]=!0===d;!0===d?b?(a.log("onAdClickThru(): open window with overrided url"),c.info[a.INFO_KEY_URL]=b):a.log("onAdClickThru(): open window with url booked in MRM UI or VAST clickthru url"):a.log("onAdClickThru(): send click tracking");this.rendererController.processEvent(c)},
onCreativeAssetLoaded:function(){a.log("VPAIDRenderer: onCreativeAssetLoaded()");this.vpaidCreative.cancelTimeoutEvent();var b=this,c=function(){var c=b.vpaidCreative.handshakeVersion(b.PLAYER_VPAID_VERSION.toFixed(1));return c?parseFloat(c)<b.SUPPORTED_CREATIVE_VPAID_VERSION_MIN?(b._failWithError(a.ERROR_INVALID_VALUE,"Only support creatives with VPAID version >= "+b.SUPPORTED_CREATIVE_VPAID_VERSION_MIN.toFixed(1)),!1):!0:(b._failWithError(a.ERROR_3P_COMPONENT,"Cannot get VPAID version from the creative"),
!1)};if(function(){var c=b.vpaidCreative.checkVPAIDInterface("handshakeVersion initAd startAd stopAd subscribe unsubscribe getAdLinear".split(" "));c.passed||b._failWithError(a.ERROR_3P_COMPONENT,"Missing interfaces in the VPAID creative: "+c.missingInterfaces);return c.passed}()&&c()){(function(){var c=b.rendererController.getParameter(a.PARAMETER_VPAID_CREATIVE_TIMEOUT_DELAY);c&&0<Number(c)&&(b.creativeTimeoutDelayInMs=Number(c));a.log("initParams(), creative timeout delay in miliseconds:"+b.creativeTimeoutDelayInMs);
c=parseFloat(b.rendererController.getParameter(a.PARAMETER_DESIRED_BITRATE));b.vpaidDesiredBitrate=0<c?c:b.vpaidDesiredBitrate;a.log("initParams(), desired bitrate: "+b.vpaidDesiredBitrate)})();b.creativeEventCallbacks={AdStarted:b.onAdStarted,AdStopped:b.onAdStopped,AdSkipped:b.onAdSkipped,AdLoaded:b.onAdLoaded,AdLinearChange:b.onAdLinearChange,AdSizeChange:b.onAdSizeChange,AdExpandedChange:b.onAdExpandedChange,AdDurationChange:b.onAdDurationChange,AdVolumeChange:b.onAdVolumeChange,AdImpression:b.onAdImpression,
AdClickThru:b.onAdClickThru,AdVideoFirstQuartile:b.onAdVideoFirstQuartile,AdVideoMidpoint:b.onAdVideoMidpoint,AdVideoThirdQuartile:b.onAdVideoThirdQuartile,AdVideoComplete:b.onAdVideoComplete,AdUserAcceptInvitation:b.onAdUserAcceptInvitation,AdUserMinimize:b.onAdUserMinimize,AdUserClose:b.onAdUserClose,AdPaused:b.onAdPaused,AdPlaying:b.onAdResumed,AdError:b.onAdError,AdLog:b.onAdLog};b.vpaidCreative.setCallbacksForCreative(b.creativeEventCallbacks,b);this.rendererController.setCapability(a.EVENT_AD_QUARTILE,
a.CAPABILITY_STATUS_ON);this.rendererController.setCapability(a.EVENT_AD_MUTE,a.CAPABILITY_STATUS_ON);this.rendererController.setCapability(a.EVENT_AD_EXPAND,a.CAPABILITY_STATUS_ON);this.rendererController.setCapability(a.EVENT_AD_PAUSE,a.CAPABILITY_STATUS_ON);this.rendererController.setCapability(a.EVENT_AD_CLOSE,a.CAPABILITY_STATUS_ON);this.rendererController.setCapability(a.EVENT_AD_MINIMIZE,a.CAPABILITY_STATUS_ON);this.rendererController.setCapability(a.EVENT_AD_ACCEPT_INVITATION,a.CAPABILITY_STATUS_ON);
(c=this.rendition?this.rendition.getParameter("creativeData"):null)||(c=this.rendition?this.rendition.getParameter("VPAID_creativeData"):null);c&&(c=a.Util.trim(c));c={AdParameters:c};var d=this.rendererController.getAdInstance().getSlot();this.videoBase.style.width="0px";this.videoBase.style.height="0px";this.videoBase.style.zIndex="100000";this.videoBase.style.position="absolute";this.videoBase.style.left=this.rendererController.getContentVideoElement().style.left;this.videoBase.style.top=this.rendererController.getContentVideoElement().style.top;
this.videoBase.className="fw_vpaid_slot";this.videoParent=d.getBase();var f=this.rendererController.getContentVideoElement();if("nodeType"in f&&0<f.nodeType)try{this.videoParent.insertBefore(this.videoBase,this.rendererController.getContentVideoElement())}catch(k){this.videoParent.insertBefore(this.videoBase,this.videoParent.firstChild)}else this.videoParent.insertBefore(this.videoBase,this.videoParent.firstChild);f={slot:this.videoBase,videoSlot:this.rendererController.getContentVideoElement(),videoSlotCanAutoPlay:!0};
var g=d.getWidth();d=d.getHeight();g&&d||!this.rendition||(g=this.rendition.getWidth(),d=this.rendition.getHeight());this.vpaidCreative.initAd(g,d,this.vpaidViewmode,this.vpaidDesiredBitrate,c,f)}},onAdLoaded:function(){a.log("VPAIDRenderer: onAdLoaded()");this.vpaidCreative.cancelTimeoutEvent();a.log("Ad duration:"+this.getDuration());var b=this,c=function(c,d){a.debug(d.length+" companion slots to fill.");if(0!==d.length&&0!==c.length){var f=(new a.VPAIDRenderer.VastAdSelect).matchAdsWithSlots(c,
d);if(0!==f.length){c=[];d=[];for(var g=f.length-1;0<=g;g--)c.push(f[g].ad),d.push(f[g].slot);d=b.rendererController.scheduleAdInstances(d);for(g=d.length-1;0<=g;g--)c[g].translateToAdInstance(d[g])}}},d=function(b){if(!b)return a.log("The adCompanions property is empty."),null;a.log("parsing adCompanions: "+b);xmlDoc=null;window.DOMParser?xmlDoc=(new DOMParser).parseFromString(b,"text/xml"):(xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),xmlDoc.async=!1,xmlDoc.loadXML(b));b=a.Util.xmlToJson(xmlDoc);
if(!b||!b.CompanionAds||!b.CompanionAds.Companion)return a.log("No companion ads found in parsed xml"),[];b=[].concat(b.CompanionAds.Companion);for(var c=[],d=b.length-1;0<=d;d--){var f=b[d];if(f["@attributes"]){var l=f["@attributes"].width,m=f["@attributes"].height;if(!l||!m||0>l||0>m)a.log("Missing width/height for companion.");else{var q=f["@attributes"].apiFramework||"";a.debug("Companion "+l+"x"+m+" api:"+q);f=new a.VPAIDRenderer.VastCompanion(l,m,q,f);f.hasValidRendtions()&&c.push(f)}}}return c}(b.vpaidCreative.getAdCompanions());
d&&0<d.length?c(d,this.rendererController.getCompanionSlots()):a.log("VPAIDAdRenderer: No companions from VPAID creative.");c=this.rendererController.getAdInstance()._context.getAdVolume();!this.isMuted&&2>100*c&&(this.isMuted=!0);this.setVolume(c);this.vpaidCreative.startAd()},onVisibilityChange:function(){a.log("onVisibilityChange:"+(document.hidden?"invisible":"visible"));a.log("Current playback state:"+this.adPlaybackState);document.hidden&&"playing"==this.adPlaybackState?(a.log("Pause the VPAID creative"),
this.vpaidCreative.pauseAd()):!document.hidden&&("paused"==this.adPlaybackState||8>a.PLATFORM_IOS_VERSION)&&(a.log("Resume the VPAID creative"),this.vpaidCreative.resumeAd())},onAdStarted:function(){a.log("VPAIDRenderer: onAdStarted()");if(this.vpaidCreative.timeoutReached)a.log("VPAID ad has already failed due to timeout. The AdStarted event will not be handled.");else if(this.vpaidCreative.cancelTimeoutEvent(),7<=a.PLATFORM_IOS_VERSION||4.4<=a.PLATFORM_ANDROID_VERSION)this._visibilityChangeListener=
this.onVisibilityChange.bind(this),document.addEventListener("visibilitychange",this._visibilityChangeListener,!1)},onAdStopped:function(){a.log("VPAIDRenderer: onAdStopped()");this.vpaidCreative?(this.vpaidCreative.cancelTimeoutEvent(),this.timePositionClass===a.TIME_POSITION_CLASS_OVERLAY&&this.vpaidCreative.getAdLinear()&&this.rendererController.requestContentStateChange(!1),this.vpaidCreative&&!this.vpaidCreative.timeoutReached&&(this.adPlaybackState?(this.rendererController.handleStateTransition(a.RENDERER_STATE_COMPLETED),
this.dispose()):(a.warn("Expecting AdStarted and AdImpression events but got AdStopped event instead. Fail."),this._failWithError(a.ERROR_3P_COMPONENT,"Expecting AdStarted and AdImpression events from the VPAID creative but got AdStopped event instead")))):a.log("The VPAID creative has been disposed. Return.")},onAdImpression:function(){a.log("VPAIDRenderer: onAdImpression()");if(this.vpaidCreative.timeoutReached)a.log("VPAID ad has already failed due to timeout. The AdImpression event will not be handled.");
else{var b=this.vpaidCreative.getAdVolume();this.isMuted=0<b&&2>=100*b;this.adPlaybackState="playing";this.rendererController.handleStateTransition(a.RENDERER_STATE_STARTED)}},onAdLinearChange:function(){a.log("VPAIDRenderer: onAdLinearChange()");var b=this.vpaidCreative.getAdLinear();b?a.log("onAdLinearChange(): non-linear click to linear -> request content video to pause"):a.log("onAdLinearChange(): linear back to non-linear -> request content video to resume");this.rendererController.requestContentStateChange(b)},
onAdSizeChange:function(){a.log("VPAIDRenderer: onAdSizeChange()")},onAdPaused:function(){a.log("VPAIDRenderer: onAdPaused()");"playing"===this.adPlaybackState&&this.rendererController.processEvent({name:a.EVENT_AD_PAUSE});this.adPlaybackState="paused"},onAdResumed:function(){a.log("VPAIDRenderer: onAdResumed()");"paused"===this.adPlaybackState&&this.rendererController.processEvent({name:a.EVENT_AD_RESUME});this.adPlaybackState="playing"},onAdSkipped:function(){a.log("VPAIDRenderer: onAdSkipped()");
this.dispose();this.rendererController.handleStateTransition(a.RENDERER_STATE_COMPLETED)},onAdVideoFirstQuartile:function(){a.log("VPAIDRenderer: onAdVideoFirstQuartile()");this.rendererController.processEvent({name:a.EVENT_AD_FIRST_QUARTILE})},onAdVideoMidpoint:function(){a.log("VPAIDRenderer: onAdVideoMidpoint()");this.rendererController.processEvent({name:a.EVENT_AD_MIDPOINT})},onAdVideoThirdQuartile:function(){a.log("VPAIDRenderer: onAdVideoThirdQuartile()");this.rendererController.processEvent({name:a.EVENT_AD_THIRD_QUARTILE})},
onAdVideoComplete:function(){a.log("VPAIDRenderer: onAdVideoComplete");this.rendererController.processEvent({name:a.EVENT_AD_COMPLETE})},onAdUserAcceptInvitation:function(){a.log("VPAIDRenderer: onAdUserAcceptInvitation()");this.rendererController.processEvent({name:a.EVENT_AD_ACCEPT_INVITATION})},onAdUserClose:function(){a.log("VPAIDRenderer: onAdUserClose()");this.rendererController.processEvent({name:a.EVENT_AD_CLOSE})},onAdUserMinimize:function(){a.log("VPAIDRenderer: onAdUserMinimize()");this.rendererController.processEvent({name:a.EVENT_AD_MINIMIZE})},
onAdLog:function(b){a.log("VPAIDRenderer: onAdLog: "+b)},onAdError:function(b){a.log("VPAIDRenderer: onAdError(): "+b);this._failWithError(a.ERROR_3P_COMPONENT,"AdError event:"+b)},start:function(b){a.log("VPAIDRenderer start()");this.rendererController=b;this.timePositionClass=b.getAdInstance().getSlot().getTimePositionClass();if(b=(b=(this.rendition=b.getAdInstance().getActiveCreativeRendition())?this.rendition.getPrimaryCreativeRenditionAsset():null)?b.getUrl():null){this.vpaidCreative=new a.VPAIDWrapper;
this.vpaidCreative.setTimeoutValueInMs(this.creativeTimeoutDelayInMs);this.vpaidCreative.addEventListener("timeout",this.onCreativeTimeout.bind(this));this.vpaidCreative.addEventListener("CreativeAssetLoaded",this.onCreativeAssetLoaded.bind(this));try{this.vpaidCreative.loadCreativeAsset(b)}catch(c){this._failWithError(a.ERROR_IO,c)}}else this._failWithError(a.ERROR_NULL_ASSET,"Creative asset url cannot be null")},stop:function(){a.log("VPAIDRenderer stop()");this.vpaidCreative.stopAd()},info:function(){return{moduleType:a.MODULE_TYPE_RENDERER}},
getPlayheadTime:function(){var a=this.vpaidCreative.getAdDuration(),c=this.vpaidCreative.getAdRemainingTime();0<=a&&0<=c&&(this.playheadTime=a-c);0>this.playheadTime&&(this.playheadTime=-1);return this.playheadTime},getDuration:function(){var a=this.vpaidCreative.getAdDuration();return 0<=a?a:-1},pause:function(){a.log("VPAIDRenderer pause()");this.rendererController.processEvent({name:a.EVENT_AD_PAUSE});this.vpaidCreative.canPauseAd()?"playing"==this.adPlaybackState&&(this.adPlaybackState="pausing",
this.vpaidCreative.pauseAd()):a.log("The creative is not able to pause")},resume:function(){a.log("VPAIDRenderer resume()");this.rendererController.processEvent({name:a.EVENT_AD_RESUME});this.vpaidCreative.canResumeAd()?"paused"==this.adPlaybackState&&(this.adPlaybackState="resuming",this.vpaidCreative.resumeAd()):a.log("The creative is not able to resume")},dispose:function(){a.log("VPAIDRenderer dispose()");this.vpaidCreative&&(this.videoParent&&(this.videoParent.removeChild(this.videoBase),this.videoParent=
null),this._visibilityChangeListener&&(a.log("remove visibilitychange listener"),document.removeEventListener("visibilitychange",this._visibilityChangeListener,!1)),this.vpaidCreative.removeCallbacksForCreative(this.creativeEventCallbacks),this.vpaidCreative.removeEventListener("timeout"),this.vpaidCreative=null)},resize:function(){a.log("VPAIDAdRenderer resize()");var b=this.rendererController.getAdInstance().getSlot(),c=b.getWidth();b=b.getHeight();a.log("VPAIDRenderer new size width:"+c+" height:"+
b);this.vpaidCreative.resizeAd(c,b,this.vpaidViewmode)}});return a};y.tv.freewheel.SDK||(y.tv.freewheel.SDK=y.tv.freewheel[Q]("tv.freewheel.SDK"));return y})();
(function () {var define;!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Hls=e():t.Hls=e()}(this,function(){return function(t){function e(i){if(r[i])return r[i].exports;var a=r[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var r={};return e.m=t,e.c=r,e.d=function(t,r,i){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/dist/",e(e.s=8)}([function(t,e,r){"use strict";function i(){}function a(t,e){return e="["+t+"] > "+e}function n(t){var e=self.console[t];return e?function(){for(var r=arguments.length,i=Array(r),n=0;n<r;n++)i[n]=arguments[n];i[0]&&(i[0]=a(t,i[0])),e.apply(self.console,i)}:i}function o(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];r.forEach(function(e){u[e]=t[e]?t[e].bind(t):n(e)})}r.d(e,"a",function(){return d}),r.d(e,"b",function(){return h});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l={trace:i,debug:i,log:i,warn:i,info:i,error:i},u=l,d=function(t){if(!0===t||"object"===(void 0===t?"undefined":s(t))){o(t,"debug","log","info","warn","error");try{u.log()}catch(t){u=l}}else u=l},h=u},function(t,e,r){"use strict";e.a={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCH:"hlsLevelSwitch",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},function(t,e,r){"use strict";r.d(e,"b",function(){return i}),r.d(e,"a",function(){return a});var i={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},a={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException"}},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}r.d(e,"b",function(){return n});var a=function(){function t(){i(this,t)}return t.isHeader=function(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},t.isFooter=function(t,e){return e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},t.getID3Data=function(e,r){for(var i=r,a=0;t.isHeader(e,r);){a+=10;a+=t._readSize(e,r+6),t.isFooter(e,r+10)&&(a+=10),r+=a}if(a>0)return e.subarray(i,i+a)},t._readSize=function(t,e){var r=0;return r=(127&t[e])<<21,r|=(127&t[e+1])<<14,r|=(127&t[e+2])<<7,r|=127&t[e+3]},t.getTimeStamp=function(e){for(var r=t.getID3Frames(e),i=0;i<r.length;i++){var a=r[i];if(t.isTimeStampFrame(a))return t._readTimeStamp(a)}},t.isTimeStampFrame=function(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info},t._getFrameData=function(e){var r=String.fromCharCode(e[0],e[1],e[2],e[3]),i=t._readSize(e,4);return{type:r,size:i,data:e.subarray(10,10+i)}},t.getID3Frames=function(e){for(var r=0,i=[];t.isHeader(e,r);){var a=t._readSize(e,r+6);r+=10;for(var n=r+a;r+8<n;){var o=t._getFrameData(e.subarray(r)),s=t._decodeFrame(o);s&&i.push(s),r+=o.size+10}t.isFooter(e,r)&&(r+=10)}return i},t._decodeFrame=function(e){return"PRIV"===e.type?t._decodePrivFrame(e):"T"===e.type[0]?t._decodeTextFrame(e):"W"===e.type[0]?t._decodeURLFrame(e):void 0},t._readTimeStamp=function(t){if(8===t.data.byteLength){var e=new Uint8Array(t.data),r=1&e[3],i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,r&&(i+=47721858.84),Math.round(i)}},t._decodePrivFrame=function(e){if(!(e.size<2)){var r=t._utf8ArrayToStr(e.data,!0),i=new Uint8Array(e.data.subarray(r.length+1));return{key:e.type,info:r,data:i.buffer}}},t._decodeTextFrame=function(e){if(!(e.size<2)){if("TXXX"===e.type){var r=1,i=t._utf8ArrayToStr(e.data.subarray(r));r+=i.length+1;var a=t._utf8ArrayToStr(e.data.subarray(r));return{key:e.type,info:i,data:a}}var n=t._utf8ArrayToStr(e.data.subarray(1));return{key:e.type,data:n}}},t._decodeURLFrame=function(e){if("WXXX"===e.type){if(e.size<2)return;var r=1,i=t._utf8ArrayToStr(e.data.subarray(r));r+=i.length+1;var a=t._utf8ArrayToStr(e.data.subarray(r));return{key:e.type,info:i,data:a}}var n=t._utf8ArrayToStr(e.data);return{key:e.type,data:n}},t._utf8ArrayToStr=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t.length,i=void 0,a=void 0,n=void 0,o="",s=0;s<r;){if(0===(i=t[s++])&&e)return o;if(0!==i&&3!==i)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(i);break;case 12:case 13:a=t[s++],o+=String.fromCharCode((31&i)<<6|63&a);break;case 14:a=t[s++],n=t[s++],o+=String.fromCharCode((15&i)<<12|(63&a)<<6|(63&n)<<0)}}return o},t}(),n=a._utf8ArrayToStr;e.a=a},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(e,r){i(this,t),this.subtle=e,this.aesIV=r}return t.prototype.decrypt=function(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)},t}(),l=s,u=function(){function t(e,r){a(this,t),this.subtle=e,this.key=r}return t.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},t}(),d=u,h=function(){function t(){n(this,t),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return t.prototype.uint8ArrayToUint32Array_=function(t){for(var e=new DataView(t),r=new Uint32Array(4),i=0;i<4;i++)r[i]=e.getUint32(4*i);return r},t.prototype.initTable=function(){var t=this.sBox,e=this.invSBox,r=this.subMix,i=r[0],a=r[1],n=r[2],o=r[3],s=this.invSubMix,l=s[0],u=s[1],d=s[2],h=s[3],c=new Uint32Array(256),f=0,p=0,g=0;for(g=0;g<256;g++)c[g]=g<128?g<<1:g<<1^283;for(g=0;g<256;g++){var v=p^p<<1^p<<2^p<<3^p<<4;v=v>>>8^255&v^99,t[f]=v,e[v]=f;var y=c[f],m=c[y],b=c[m],E=257*c[v]^16843008*v;i[f]=E<<24|E>>>8,a[f]=E<<16|E>>>16,n[f]=E<<8|E>>>24,o[f]=E,E=16843009*b^65537*m^257*y^16843008*f,l[v]=E<<24|E>>>8,u[v]=E<<16|E>>>16,d[v]=E<<8|E>>>24,h[v]=E,f?(f=y^c[c[c[b^y]]],p^=c[c[p]]):f=p=1}},t.prototype.expandKey=function(t){for(var e=this.uint8ArrayToUint32Array_(t),r=!0,i=0;i<e.length&&r;)r=e[i]===this.key[i],i++;if(!r){this.key=e;var a=this.keySize=e.length;if(4!==a&&6!==a&&8!==a)throw new Error("Invalid aes key size="+a);var n=this.ksRows=4*(a+6+1),o=void 0,s=void 0,l=this.keySchedule=new Uint32Array(n),u=this.invKeySchedule=new Uint32Array(n),d=this.sBox,h=this.rcon,c=this.invSubMix,f=c[0],p=c[1],g=c[2],v=c[3],y=void 0,m=void 0;for(o=0;o<n;o++)o<a?y=l[o]=e[o]:(m=y,o%a==0?(m=m<<8|m>>>24,m=d[m>>>24]<<24|d[m>>>16&255]<<16|d[m>>>8&255]<<8|d[255&m],m^=h[o/a|0]<<24):a>6&&o%a==4&&(m=d[m>>>24]<<24|d[m>>>16&255]<<16|d[m>>>8&255]<<8|d[255&m]),l[o]=y=(l[o-a]^m)>>>0);for(s=0;s<n;s++)o=n-s,m=3&s?l[o]:l[o-4],u[s]=s<4||o<=4?m:f[d[m>>>24]]^p[d[m>>>16&255]]^g[d[m>>>8&255]]^v[d[255&m]],u[s]=u[s]>>>0}},t.prototype.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},t.prototype.decrypt=function(t,e,r){for(var i,a,n=this.keySize+6,o=this.invKeySchedule,s=this.invSBox,l=this.invSubMix,u=l[0],d=l[1],h=l[2],c=l[3],f=this.uint8ArrayToUint32Array_(r),p=f[0],g=f[1],v=f[2],y=f[3],m=new Int32Array(t),b=new Int32Array(m.length),E=void 0,T=void 0,R=void 0,A=void 0,S=void 0,L=void 0,_=void 0,w=void 0,D=void 0,I=void 0,k=void 0,O=void 0,C=this.networkToHostOrderSwap;e<m.length;){for(D=C(m[e]),I=C(m[e+1]),k=C(m[e+2]),O=C(m[e+3]),S=D^o[0],L=O^o[1],_=k^o[2],w=I^o[3],i=4,a=1;a<n;a++)E=u[S>>>24]^d[L>>16&255]^h[_>>8&255]^c[255&w]^o[i],T=u[L>>>24]^d[_>>16&255]^h[w>>8&255]^c[255&S]^o[i+1],R=u[_>>>24]^d[w>>16&255]^h[S>>8&255]^c[255&L]^o[i+2],A=u[w>>>24]^d[S>>16&255]^h[L>>8&255]^c[255&_]^o[i+3],S=E,L=T,_=R,w=A,i+=4;E=s[S>>>24]<<24^s[L>>16&255]<<16^s[_>>8&255]<<8^s[255&w]^o[i],T=s[L>>>24]<<24^s[_>>16&255]<<16^s[w>>8&255]<<8^s[255&S]^o[i+1],R=s[_>>>24]<<24^s[w>>16&255]<<16^s[S>>8&255]<<8^s[255&L]^o[i+2],A=s[w>>>24]<<24^s[S>>16&255]<<16^s[L>>8&255]<<8^s[255&_]^o[i+3],i+=3,b[e]=C(E^p),b[e+1]=C(A^g),b[e+2]=C(R^v),b[e+3]=C(T^y),p=D,g=I,v=k,y=O,e+=4}return b.buffer},t.prototype.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},t}(),c=h,f=r(2),p=r(0),g=function(){function t(e,r){o(this,t),this.observer=e,this.config=r,this.logEnabled=!0;try{var i=crypto||self.crypto;this.subtle=i.subtle||i.webkitSubtle}catch(t){}this.disableWebCrypto=!this.subtle}return t.prototype.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},t.prototype.decrypt=function(t,e,r,i){var a=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(p.b.log("JS AES decrypt"),this.logEnabled=!1);var n=this.decryptor;n||(this.decryptor=n=new c),n.expandKey(e),i(n.decrypt(t,0,r))}else{this.logEnabled&&(p.b.log("WebCrypto AES decrypt"),this.logEnabled=!1);var o=this.subtle;this.key!==e&&(this.key=e,this.fastAesKey=new d(o,e)),this.fastAesKey.expandKey().then(function(n){new l(o,r).decrypt(t,n).catch(function(n){a.onWebCryptoError(n,t,e,r,i)}).then(function(t){i(t)})}).catch(function(n){a.onWebCryptoError(n,t,e,r,i)})}},t.prototype.onWebCryptoError=function(t,e,r,i,a){this.config.enableSoftwareAES?(p.b.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(e,r,i,a)):(p.b.error("decrypting error : "+t.message),this.observer.trigger(Event.ERROR,{type:f.b.MEDIA_ERROR,details:f.a.FRAG_DECRYPT_ERROR,fatal:!0,reason:t.message}))},t.prototype.destroy=function(){var t=this.decryptor;t&&(t.destroy(),this.decryptor=void 0)},t}();e.a=g},function(t,e){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(t){return"function"==typeof t}function a(t){return"number"==typeof t}function n(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(t){if(!a(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},r.prototype.emit=function(t){var e,r,a,s,l,u;if(this._events||(this._events={}),"error"===t&&(!this._events.error||n(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var d=new Error('Uncaught, unspecified "error" event. ('+e+")");throw d.context=e,d}if(r=this._events[t],o(r))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),r.apply(this,s)}else if(n(r))for(s=Array.prototype.slice.call(arguments,1),u=r.slice(),a=u.length,l=0;l<a;l++)u[l].apply(this,s);return!0},r.prototype.addListener=function(t,e){var a;if(!i(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,i(e.listener)?e.listener:e),this._events[t]?n(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,n(this._events[t])&&!this._events[t].warned&&(a=o(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&a>0&&this._events[t].length>a&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(t,e){function r(){this.removeListener(t,r),a||(a=!0,e.apply(this,arguments))}if(!i(e))throw TypeError("listener must be a function");var a=!1;return r.listener=e,this.on(t,r),this},r.prototype.removeListener=function(t,e){var r,a,o,s;if(!i(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(r=this._events[t],o=r.length,a=-1,r===e||i(r.listener)&&r.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(n(r)){for(s=o;s-- >0;)if(r[s]===e||r[s].listener&&r[s].listener===e){a=s;break}if(a<0)return this;1===r.length?(r.length=0,delete this._events[t]):r.splice(a,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},r.prototype.removeAllListeners=function(t){var e,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[t],i(r))this.removeListener(t,r);else if(r)for(;r.length;)this.removeListener(t,r[r.length-1]);return delete this._events[t],this},r.prototype.listeners=function(t){return this._events&&this._events[t]?i(this._events[t])?[this._events[t]]:this._events[t].slice():[]},r.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(i(e))return 1;if(e)return e.length}return 0},r.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e,r){!function(e){var r=/^((?:[^\/;?#]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,i=/^([^\/;?#]*)(.*)$/,a=/(?:\/|^)\.(?=\/)/g,n=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,o={buildAbsoluteURL:function(t,e,r){if(r=r||{},t=t.trim(),!(e=e.trim())){if(!r.alwaysNormalize)return t;var a=this.parseURL(t);if(!s)throw new Error("Error trying to parse base URL.");return a.path=o.normalizePath(a.path),o.buildURLFromParts(a)}var n=this.parseURL(e);if(!n)throw new Error("Error trying to parse relative URL.");if(n.scheme)return r.alwaysNormalize?(n.path=o.normalizePath(n.path),o.buildURLFromParts(n)):e;var s=this.parseURL(t);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var l=i.exec(s.path);s.netLoc=l[1],s.path=l[2]}s.netLoc&&!s.path&&(s.path="/");var u={scheme:s.scheme,netLoc:n.netLoc,path:null,params:n.params,query:n.query,fragment:n.fragment};if(!n.netLoc&&(u.netLoc=s.netLoc,"/"!==n.path[0]))if(n.path){var d=s.path,h=d.substring(0,d.lastIndexOf("/")+1)+n.path;u.path=o.normalizePath(h)}else u.path=s.path,n.params||(u.params=s.params,n.query||(u.query=s.query));return null===u.path&&(u.path=r.alwaysNormalize?o.normalizePath(n.path):n.path),o.buildURLFromParts(u)},parseURL:function(t){var e=r.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(a,"");t.length!==(t=t.replace(n,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}};t.exports=o}()},function(t,e,r){"use strict";function i(t,e,r,i){var a,n,o,s,l,u=navigator.userAgent.toLowerCase(),d=i,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return a=1+((192&e[r+2])>>>6),(n=(60&e[r+2])>>>2)>h.length-1?void t.trigger(Event.ERROR,{type:L.b.MEDIA_ERROR,details:L.a.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+n}):(s=(1&e[r+2])<<2,s|=(192&e[r+3])>>>6,w.b.log("manifest codec:"+i+",ADTS data:type:"+a+",sampleingIndex:"+n+"["+h[n]+"Hz],channelConfig:"+s),/firefox/i.test(u)?n>=6?(a=5,l=new Array(4),o=n-3):(a=2,l=new Array(2),o=n):-1!==u.indexOf("android")?(a=2,l=new Array(2),o=n):(a=5,l=new Array(4),i&&(-1!==i.indexOf("mp4a.40.29")||-1!==i.indexOf("mp4a.40.5"))||!i&&n>=6?o=n-3:((i&&-1!==i.indexOf("mp4a.40.2")&&(n>=6&&1===s||/vivaldi/i.test(u))||!i&&1===s)&&(a=2,l=new Array(2)),o=n)),l[0]=a<<3,l[0]|=(14&n)>>1,l[1]|=(1&n)<<7,l[1]|=s<<3,5===a&&(l[1]|=(14&o)>>1,l[2]=(1&o)<<7,l[2]|=8,l[3]=0),{config:l,samplerate:h[n],channelCount:s,codec:"mp4a.40."+a,manifestCodec:d})}function a(t,e){return 255===t[e]&&240==(246&t[e+1])}function n(t,e){return 1&t[e+1]?7:9}function o(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function s(t,e){return!!(e+1<t.length&&a(t,e))}function l(t,e){if(e+1<t.length&&a(t,e)){var r=n(t,e),i=r;e+5<t.length&&(i=o(t,e));var s=e+i;if(s===t.length||s+1<t.length&&a(t,s))return!0}return!1}function u(t,e,r,a,n){if(!t.samplerate){var o=i(e,r,a,n);t.config=o.config,t.samplerate=o.samplerate,t.channelCount=o.channelCount,t.codec=o.codec,t.manifestCodec=o.manifestCodec,w.b.log("parsed codec:"+t.codec+",rate:"+o.samplerate+",nb channel:"+o.channelCount)}}function d(t){return 9216e4/t}function h(t,e,r,i,a){var s,l,u,d=t.length;if(s=n(t,e),l=o(t,e),(l-=s)>0&&e+s+l<=d)return u=r+i*a,{headerLength:s,frameLength:l,stamp:u}}function c(t,e,r,i,a){var n=d(t.samplerate),o=h(e,r,i,a,n);if(o){var s=o.stamp,l=o.headerLength,u=o.frameLength,c={unit:e.subarray(r+l,r+l+u),pts:s,dts:s};return t.samples.push(c),t.len+=u,{sample:c,length:u+l}}}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function g(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function v(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function E(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function T(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function R(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function A(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var S=r(1),L=r(2),_=r(4),w=r(0),D=r(3),I=function(){function t(e,r,i){f(this,t),this.observer=e,this.config=i,this.remuxer=r}return t.prototype.resetInitSegment=function(t,e,r,i){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:e,duration:i,inputTimeScale:9e4}},t.prototype.resetTimeStamp=function(){},t.probe=function(t){if(!t)return!1;for(var e=D.a.getID3Data(t,0)||[],r=e.length,i=t.length;r<i;r++)if(l(t,r))return w.b.log("ADTS sync word found !"),!0;return!1},t.prototype.append=function(t,e,r,i){for(var a=this._audioTrack,n=D.a.getID3Data(t,0)||[],o=D.a.getTimeStamp(n),l=o?90*o:9e4*e,d=0,h=l,f=t.length,p=n.length,g=[{pts:h,dts:h,data:n}];p<f-1;)if(s(t,p)&&p+5<f){u(a,this.observer,t,p,a.manifestCodec);var v=c(a,t,p,l,d);if(!v){w.b.log("Unable to parse AAC frame");break}p+=v.length,h=v.sample.pts,d++}else D.a.isHeader(t,p)?(n=D.a.getID3Data(t,p),g.push({pts:h,dts:h,data:n}),p+=n.length):p++;this.remuxer.remux(a,{samples:[]},{samples:g,inputTimeScale:9e4},{samples:[]},e,r,i)},t.prototype.destroy=function(){},t}(),k=I,O=Math.pow(2,32)-1,C=function(){function t(e,r){p(this,t),this.observer=e,this.remuxer=r}return t.prototype.resetTimeStamp=function(t){this.initPTS=t},t.prototype.resetInitSegment=function(e,r,i,a){if(e&&e.byteLength){var n=this.initData=t.parseInitSegment(e);null==r&&(r="mp4a.40.5"),null==i&&(i="avc1.42e01e");var o={};n.audio&&n.video?o.audiovideo={container:"video/mp4",codec:r+","+i,initSegment:a?e:null}:(n.audio&&(o.audio={container:"audio/mp4",codec:r,initSegment:a?e:null}),n.video&&(o.video={container:"video/mp4",codec:i,initSegment:a?e:null})),this.observer.trigger(S.a.FRAG_PARSING_INIT_SEGMENT,{tracks:o})}else r&&(this.audioCodec=r),i&&(this.videoCodec=i)},t.probe=function(e){return t.findBox({data:e,start:0,end:Math.min(e.length,16384)},["moof"]).length>0},t.bin2str=function(t){return String.fromCharCode.apply(null,t)},t.readUint32=function(t,e){t.data&&(e+=t.start,t=t.data);var r=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3];return r<0?4294967296+r:r},t.writeUint32=function(t,e,r){t.data&&(e+=t.start,t=t.data),t[e]=r>>24,t[e+1]=r>>16&255,t[e+2]=r>>8&255,t[e+3]=255&r},t.findBox=function(e,r){var i,a,n,o,s,l,u,d=[];if(e.data?(l=e.start,o=e.end,e=e.data):(l=0,o=e.byteLength),!r.length)return null;for(i=l;i<o;)a=t.readUint32(e,i),n=t.bin2str(e.subarray(i+4,i+8)),u=a>1?i+a:o,n===r[0]&&(1===r.length?d.push({data:e,start:i+8,end:u}):(s=t.findBox({data:e,start:i+8,end:u},r.slice(1)),s.length&&(d=d.concat(s)))),i=u;return d},t.parseInitSegment=function(e){var r=[];return t.findBox(e,["moov","trak"]).forEach(function(e){var i=t.findBox(e,["tkhd"])[0];if(i){var a=i.data[i.start],n=0===a?12:20,o=t.readUint32(i,n),s=t.findBox(e,["mdia","mdhd"])[0];if(s){a=s.data[s.start],n=0===a?12:20;var l=t.readUint32(s,n),u=t.findBox(e,["mdia","hdlr"])[0];if(u){var d=t.bin2str(u.data.subarray(u.start+8,u.start+12)),h={soun:"audio",vide:"video"}[d];if(h){var c=t.findBox(e,["mdia","minf","stbl","stsd"]);if(c.length){c=c[0];var f=t.bin2str(c.data.subarray(c.start+12,c.start+16));w.b.log("MP4Demuxer:"+h+":"+f+" found")}r[o]={timescale:l,type:h},r[h]={timescale:l,id:o}}}}}}),r},t.getStartDTS=function(e,r){var i,a,n;return i=t.findBox(r,["moof","traf"]),a=[].concat.apply([],i.map(function(r){return t.findBox(r,["tfhd"]).map(function(i){var a,n;return a=t.readUint32(i,4),n=e[a].timescale||9e4,t.findBox(r,["tfdt"]).map(function(e){var r,i;return r=e.data[e.start],i=t.readUint32(e,4),1===r&&(i*=Math.pow(2,32),i+=t.readUint32(e,8)),i})[0]/n})})),n=Math.min.apply(null,a),isFinite(n)?n:0},t.offsetStartDTS=function(e,r,i){t.findBox(r,["moof","traf"]).map(function(r){return t.findBox(r,["tfhd"]).map(function(a){var n=t.readUint32(a,4),o=e[n].timescale||9e4;t.findBox(r,["tfdt"]).map(function(e){var r=e.data[e.start],a=t.readUint32(e,4);if(0===r)t.writeUint32(e,4,a-i*o);else{a*=Math.pow(2,32),a+=t.readUint32(e,8),a-=i*o,a=Math.max(a,0);var n=Math.floor(a/(O+1)),s=Math.floor(a%(O+1));t.writeUint32(e,4,n),t.writeUint32(e,8,s)}})})})},t.prototype.append=function(e,r,i,a){var n=this.initData;n||(this.resetInitSegment(e,this.audioCodec,this.videoCodec),n=this.initData);var o=void 0,s=this.initPTS;if(void 0===s){var l=t.getStartDTS(n,e);this.initPTS=s=l-r,this.observer.trigger(S.a.INIT_PTS_FOUND,{initPTS:s})}t.offsetStartDTS(n,e,s),o=t.getStartDTS(n,e),this.remuxer.remux(n.audio,n.video,null,null,o,i,a,e)},t.prototype.destroy=function(){},t}(),P=C,x={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(t,e,r,i,a){if(!(r+24>e.length)){var n=this.parseHeader(e,r);if(n&&r+n.frameLength<=e.length){var o=9e4*n.samplesPerFrame/n.sampleRate,s=i+a*o,l={unit:e.subarray(r,r+n.frameLength),pts:s,dts:s};return t.config=[],t.channelCount=n.channelCount,t.samplerate=n.sampleRate,t.samples.push(l),t.len+=n.frameLength,{sample:l,length:n.frameLength}}}},parseHeader:function(t,e){var r=t[e+1]>>3&3,i=t[e+1]>>1&3,a=t[e+2]>>4&15,n=t[e+2]>>2&3,o=t[e+2]>>1&1;if(1!==r&&0!==a&&15!==a&&3!==n){var s=3===r?3-i:3===i?3:4,l=1e3*x.BitratesMap[14*s+a-1],u=3===r?0:2===r?1:2,d=x.SamplingRateMap[3*u+n],h=t[e+3]>>6==3?1:2,c=x.SamplesCoefficients[r][i],f=x.BytesInSlot[i],p=8*c*f;return{sampleRate:d,channelCount:h,frameLength:parseInt(c*l/d+o,10)*f,samplesPerFrame:p}}},isHeaderPattern:function(t,e){return 255===t[e]&&224==(224&t[e+1])&&0!=(6&t[e+1])},isHeader:function(t,e){return!!(e+1<t.length&&this.isHeaderPattern(t,e))},probe:function(t,e){if(e+1<t.length&&this.isHeaderPattern(t,e)){var r=this.parseHeader(t,e),i=4;r&&r.frameLength&&(i=r.frameLength);var a=e+i;if(a===t.length||a+1<t.length&&this.isHeaderPattern(t,a))return!0}return!1}},F=x,N=function(){function t(e){g(this,t),this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}return t.prototype.loadWord=function(){var t=this.data,e=this.bytesAvailable,r=t.byteLength-e,i=new Uint8Array(4),a=Math.min(4,e);if(0===a)throw new Error("no bytes available");i.set(t.subarray(r,r+a)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*a,this.bytesAvailable-=a},t.prototype.skipBits=function(t){var e;this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,e=t>>3,t-=e>>3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)},t.prototype.readBits=function(t){var e=Math.min(this.bitsAvailable,t),r=this.word>>>32-e;return t>32&&w.b.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0?this.word<<=e:this.bytesAvailable>0&&this.loadWord(),e=t-e,e>0&&this.bitsAvailable?r<<e|this.readBits(e):r},t.prototype.skipLZ=function(){var t;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},t.prototype.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.prototype.skipEG=function(){this.skipBits(1+this.skipLZ())},t.prototype.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},t.prototype.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},t.prototype.readBoolean=function(){return 1===this.readBits(1)},t.prototype.readUByte=function(){return this.readBits(8)},t.prototype.readUShort=function(){return this.readBits(16)},t.prototype.readUInt=function(){return this.readBits(32)},t.prototype.skipScalingList=function(t){var e,r,i=8,a=8;for(e=0;e<t;e++)0!==a&&(r=this.readEG(),a=(i+r+256)%256),i=0===a?i:a},t.prototype.readSPS=function(){var t,e,r,i,a,n,o,s=0,l=0,u=0,d=0,h=this.readUByte.bind(this),c=this.readBits.bind(this),f=this.readUEG.bind(this),p=this.readBoolean.bind(this),g=this.skipBits.bind(this),v=this.skipEG.bind(this),y=this.skipUEG.bind(this),m=this.skipScalingList.bind(this);if(h(),t=h(),c(5),g(3),h(),y(),100===t||110===t||122===t||244===t||44===t||83===t||86===t||118===t||128===t){var b=f();if(3===b&&g(1),y(),y(),g(1),p())for(n=3!==b?8:12,o=0;o<n;o++)p()&&m(o<6?16:64)}y();var E=f();if(0===E)f();else if(1===E)for(g(1),v(),v(),e=f(),o=0;o<e;o++)v();y(),g(1),r=f(),i=f(),a=c(1),0===a&&g(1),g(1),p()&&(s=f(),l=f(),u=f(),d=f());var T=[1,1];if(p()&&p()){switch(h()){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[h()<<8|h(),h()<<8|h()]}}return{width:Math.ceil(16*(r+1)-2*s-2*l),height:(2-a)*(i+1)*16-(a?2:4)*(u+d),pixelRatio:T}},t.prototype.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},t}(),M=N,U=function(){function t(e,r,i,a){v(this,t),this.decryptdata=i,this.discardEPB=a,this.decrypter=new _.a(e,r)}return t.prototype.decryptBuffer=function(t,e){this.decrypter.decrypt(t,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,e)},t.prototype.decryptAacSample=function(t,e,r,i){var a=t[e].unit,n=a.subarray(16,a.length-a.length%16),o=n.buffer.slice(n.byteOffset,n.byteOffset+n.length),s=this;this.decryptBuffer(o,function(n){n=new Uint8Array(n),a.set(n,16),i||s.decryptAacSamples(t,e+1,r)})},t.prototype.decryptAacSamples=function(t,e,r){for(;;e++){if(e>=t.length)return void r();if(!(t[e].unit.length<32)){var i=this.decrypter.isSync();if(this.decryptAacSample(t,e,r,i),!i)return}}},t.prototype.getAvcEncryptedData=function(t){for(var e=16*Math.floor((t.length-48)/160)+16,r=new Int8Array(e),i=0,a=32;a<=t.length-16;a+=160,i+=16)r.set(t.subarray(a,a+16),i);return r},t.prototype.getAvcDecryptedUnit=function(t,e){e=new Uint8Array(e);for(var r=0,i=32;i<=t.length-16;i+=160,r+=16)t.set(e.subarray(r,r+16),i);return t},t.prototype.decryptAvcSample=function(t,e,r,i,a,n){var o=this.discardEPB(a.data),s=this.getAvcEncryptedData(o),l=this;this.decryptBuffer(s.buffer,function(s){a.data=l.getAvcDecryptedUnit(o,s),n||l.decryptAvcSamples(t,e,r+1,i)})},t.prototype.decryptAvcSamples=function(t,e,r,i){for(;;e++,r=0){if(e>=t.length)return void i();for(var a=t[e].units;!(r>=a.length);r++){var n=a[r];if(!(n.length<=48||1!==n.type&&5!==n.type)){var o=this.decrypter.isSync();if(this.decryptAvcSample(t,e,r,i,n,o),!o)return}}}},t}(),B=U,G={video:0,audio:1,id3:2,text:3},j=function(){function t(e,r,i,a){y(this,t),this.observer=e,this.config=i,this.typeSupported=a,this.remuxer=r,this.sampleAes=null}return t.prototype.setDecryptData=function(t){null!=t&&null!=t.key&&"SAMPLE-AES"===t.method?this.sampleAes=new B(this.observer,this.config,t,this.discardEPB):this.sampleAes=null},t.probe=function(e){var r=t._syncOffset(e);return!(r<0)&&(r&&w.b.warn("MPEG2-TS detected but first sync word found @ offset "+r+", junk ahead ?"),!0)},t._syncOffset=function(t){for(var e=Math.min(1e3,t.length-564),r=0;r<e;){if(71===t[r]&&71===t[r+188]&&71===t[r+376])return r;r++}return-1},t.createTrack=function(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:G[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:"video"===t?0:void 0,isAAC:"audio"===t||void 0,duration:"audio"===t?e:void 0}},t.prototype.resetInitSegment=function(e,r,i,a){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=t.createTrack("video",a),this._audioTrack=t.createTrack("audio",a),this._id3Track=t.createTrack("id3",a),this._txtTrack=t.createTrack("text",a),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=r,this.videoCodec=i,this._duration=a},t.prototype.resetTimeStamp=function(){},t.prototype.append=function(e,r,i,a){var n,o,s,l,u,d=e.length,h=!1;this.contiguous=i;var c=this.pmtParsed,f=this._avcTrack,p=this._audioTrack,g=this._id3Track,v=f.pid,y=p.pid,m=g.pid,b=this._pmtId,E=f.pesData,T=p.pesData,R=g.pesData,A=this._parsePAT,_=this._parsePMT,D=this._parsePES,I=this._parseAVCPES.bind(this),k=this._parseAACPES.bind(this),O=this._parseMPEGPES.bind(this),C=this._parseID3PES.bind(this),P=t._syncOffset(e);for(d-=(d+P)%188,n=P;n<d;n+=188)if(71===e[n]){if(o=!!(64&e[n+1]),s=((31&e[n+1])<<8)+e[n+2],(48&e[n+3])>>4>1){if((l=n+5+e[n+4])===n+188)continue}else l=n+4;switch(s){case v:o&&(E&&(u=D(E))&&I(u,!1),E={data:[],size:0}),E&&(E.data.push(e.subarray(l,n+188)),E.size+=n+188-l);break;case y:o&&(T&&(u=D(T))&&(p.isAAC?k(u):O(u)),T={data:[],size:0}),T&&(T.data.push(e.subarray(l,n+188)),T.size+=n+188-l);break;case m:o&&(R&&(u=D(R))&&C(u),R={data:[],size:0}),R&&(R.data.push(e.subarray(l,n+188)),R.size+=n+188-l);break;case 0:o&&(l+=e[l]+1),b=this._pmtId=A(e,l);break;case b:o&&(l+=e[l]+1);var x=_(e,l,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);v=x.avc,v>0&&(f.pid=v),y=x.audio,y>0&&(p.pid=y,p.isAAC=x.isAAC),m=x.id3,m>0&&(g.pid=m),h&&!c&&(w.b.log("reparse from beginning"),h=!1,n=P-188),c=this.pmtParsed=!0;break;case 17:case 8191:break;default:h=!0}}else this.observer.trigger(S.a.ERROR,{type:L.b.MEDIA_ERROR,details:L.a.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});E&&(u=D(E))?(I(u,!0),f.pesData=null):f.pesData=E,T&&(u=D(T))?(p.isAAC?k(u):O(u),p.pesData=null):(T&&T.size&&w.b.log("last AAC PES packet truncated,might overlap between fragments"),p.pesData=T),R&&(u=D(R))?(C(u),g.pesData=null):g.pesData=R,null==this.sampleAes?this.remuxer.remux(p,f,g,this._txtTrack,r,i,a):this.decryptAndRemux(p,f,g,this._txtTrack,r,i,a)},t.prototype.decryptAndRemux=function(t,e,r,i,a,n,o){if(t.samples&&t.isAAC){var s=this;this.sampleAes.decryptAacSamples(t.samples,0,function(){s.decryptAndRemuxAvc(t,e,r,i,a,n,o)})}else this.decryptAndRemuxAvc(t,e,r,i,a,n,o)},t.prototype.decryptAndRemuxAvc=function(t,e,r,i,a,n,o){if(e.samples){var s=this;this.sampleAes.decryptAvcSamples(e.samples,0,0,function(){s.remuxer.remux(t,e,r,i,a,n,o)})}else this.remuxer.remux(t,e,r,i,a,n,o)},t.prototype.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},t.prototype._parsePAT=function(t,e){return(31&t[e+10])<<8|t[e+11]},t.prototype._parsePMT=function(t,e,r,i){var a,n,o,s,l={audio:-1,avc:-1,id3:-1,isAAC:!0};for(a=(15&t[e+1])<<8|t[e+2],n=e+3+a-4,o=(15&t[e+10])<<8|t[e+11],e+=12+o;e<n;){switch(s=(31&t[e+1])<<8|t[e+2],t[e]){case 207:if(!i){w.b.log("unkown stream type:"+t[e]);break}case 15:-1===l.audio&&(l.audio=s);break;case 21:-1===l.id3&&(l.id3=s);break;case 219:if(!i){w.b.log("unkown stream type:"+t[e]);break}case 27:-1===l.avc&&(l.avc=s);break;case 3:case 4:r?-1===l.audio&&(l.audio=s,l.isAAC=!1):w.b.log("MPEG audio found, not supported in this browser for now");break;case 36:w.b.warn("HEVC stream type found, not supported for now");break;default:w.b.log("unkown stream type:"+t[e])}e+=5+((15&t[e+3])<<8|t[e+4])}return l},t.prototype._parsePES=function(t){var e,r,i,a,n,o,s,l,u=0,d=t.data;if(!t||0===t.size)return null;for(;d[0].length<19&&d.length>1;){var h=new Uint8Array(d[0].length+d[1].length);h.set(d[0]),h.set(d[1],d[0].length),d[0]=h,d.splice(1,1)}if(e=d[0],1===(e[0]<<16)+(e[1]<<8)+e[2]){if((i=(e[4]<<8)+e[5])&&i>t.size-6)return null;r=e[7],192&r&&(o=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,o>4294967295&&(o-=8589934592),64&r?(s=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2,s>4294967295&&(s-=8589934592),o-s>54e5&&(w.b.warn(Math.round((o-s)/9e4)+"s delta between PTS and DTS, align them"),o=s)):s=o),a=e[8],l=a+9,t.size-=l,n=new Uint8Array(t.size);for(var c=0,f=d.length;c<f;c++){e=d[c];var p=e.byteLength;if(l){if(l>p){l-=p;continue}e=e.subarray(l),p-=l,l=0}n.set(e,u),u+=p}return i&&(i-=a+3),{data:n,pts:o,dts:s,len:i}}return null},t.prototype.pushAccesUnit=function(t,e){if(t.units.length&&t.frame){var r=e.samples,i=r.length;!this.config.forceKeyFrameOnDiscontinuity||!0===t.key||e.sps&&(i||this.contiguous)?(t.id=i,r.push(t)):e.dropped++}t.debug.length&&w.b.log(t.pts+"/"+t.dts+":"+t.debug)},t.prototype._parseAVCPES=function(t,e){var r,i,a,n=this,o=this._avcTrack,s=this._parseAVCNALu(t.data),l=this.avcSample,u=!1,d=this.pushAccesUnit.bind(this),h=function(t,e,r,i){return{key:t,pts:e,dts:r,units:[],debug:i}};t.data=null,l&&s.length&&!o.audFound&&(d(l,o),l=this.avcSample=h(!1,t.pts,t.dts,"")),s.forEach(function(e){switch(e.type){case 1:i=!0,l||(l=n.avcSample=h(!0,t.pts,t.dts,"")),l.frame=!0;var s=e.data;if(u&&s.length>4){var c=new M(s).readSliceType();2!==c&&4!==c&&7!==c&&9!==c||(l.key=!0)}break;case 5:i=!0,l||(l=n.avcSample=h(!0,t.pts,t.dts,"")),l.key=!0,l.frame=!0;break;case 6:i=!0,r=new M(n.discardEPB(e.data)),r.readUByte();for(var f=0,p=0,g=!1,v=0;!g&&r.bytesAvailable>1;){f=0;do{v=r.readUByte(),f+=v}while(255===v);p=0;do{v=r.readUByte(),p+=v}while(255===v);if(4===f&&0!==r.bytesAvailable){g=!0;if(181===r.readUByte()){if(49===r.readUShort()){if(1195456820===r.readUInt()){if(3===r.readUByte()){var y=r.readUByte(),m=r.readUByte(),b=31&y,E=[y,m];for(a=0;a<b;a++)E.push(r.readUByte()),E.push(r.readUByte()),E.push(r.readUByte());n._insertSampleInOrder(n._txtTrack.samples,{type:3,pts:t.pts,bytes:E})}}}}}else if(p<r.bytesAvailable)for(a=0;a<p;a++)r.readUByte()}break;case 7:if(i=!0,u=!0,!o.sps){r=new M(e.data);var T=r.readSPS();o.width=T.width,o.height=T.height,o.pixelRatio=T.pixelRatio,o.sps=[e.data],o.duration=n._duration;var R=e.data.subarray(1,4),A="avc1.";for(a=0;a<3;a++){var S=R[a].toString(16);S.length<2&&(S="0"+S),A+=S}o.codec=A}break;case 8:i=!0,o.pps||(o.pps=[e.data]);break;case 9:i=!1,o.audFound=!0,l&&d(l,o),l=n.avcSample=h(!1,t.pts,t.dts,"");break;case 12:i=!1;break;default:i=!1,l&&(l.debug+="unknown NAL "+e.type+" ")}if(l&&i){l.units.push(e)}}),e&&l&&(d(l,o),this.avcSample=null)},t.prototype._insertSampleInOrder=function(t,e){var r=t.length;if(r>0){if(e.pts>=t[r-1].pts)t.push(e);else for(var i=r-1;i>=0;i--)if(e.pts<t[i].pts){t.splice(i,0,e);break}}else t.push(e)},t.prototype._getLastNalUnit=function(){var t=this.avcSample,e=void 0;if(!t||0===t.units.length){var r=this._avcTrack,i=r.samples;t=i[i.length-1]}if(t){var a=t.units;e=a[a.length-1]}return e},t.prototype._parseAVCNALu=function(t){var e,r,i,a,n,o=0,s=t.byteLength,l=this._avcTrack,u=l.naluState||0,d=u,h=[],c=-1;for(-1===u&&(c=0,n=31&t[0],u=0,o=1);o<s;)if(e=t[o++],u)if(1!==u)if(e)if(1===e){if(c>=0)i={data:t.subarray(c,o-u-1),type:n},h.push(i);else{var f=this._getLastNalUnit();if(f&&(d&&o<=4-d&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-d)),(r=o-u-1)>0)){var p=new Uint8Array(f.data.byteLength+r);p.set(f.data,0),p.set(t.subarray(0,r),f.data.byteLength),f.data=p}}o<s?(a=31&t[o],c=o,n=a,u=0):u=-1}else u=0;else u=3;else u=e?0:2;else u=e?0:1;if(c>=0&&u>=0&&(i={data:t.subarray(c,s),type:n,state:u},h.push(i)),0===h.length){var g=this._getLastNalUnit();if(g){var v=new Uint8Array(g.data.byteLength+t.byteLength);v.set(g.data,0),v.set(t,g.data.byteLength),g.data=v}}return l.naluState=u,h},t.prototype.discardEPB=function(t){for(var e,r,i=t.byteLength,a=[],n=1;n<i-2;)0===t[n]&&0===t[n+1]&&3===t[n+2]?(a.push(n+2),n+=2):n++;if(0===a.length)return t;e=i-a.length,r=new Uint8Array(e);var o=0;for(n=0;n<e;o++,n++)o===a[0]&&(o++,a.shift()),r[n]=t[o];return r},t.prototype._parseAACPES=function(t){var e,r,i,a,n,o=this._audioTrack,l=t.data,h=t.pts,f=this.aacOverFlow,p=this.aacLastPTS;if(f){var g=new Uint8Array(f.byteLength+l.byteLength);g.set(f,0),g.set(l,f.byteLength),l=g}for(i=0,n=l.length;i<n-1&&!s(l,i);i++);if(i){var v,y;if(i<n-1?(v="AAC PES did not start with ADTS header,offset:"+i,y=!1):(v="no ADTS header found in AAC PES",y=!0),w.b.warn("parsing error:"+v),this.observer.trigger(S.a.ERROR,{type:L.b.MEDIA_ERROR,details:L.a.FRAG_PARSING_ERROR,fatal:y,reason:v}),y)return}if(u(o,this.observer,l,i,this.audioCodec),r=0,e=d(o.samplerate),f&&p){var m=p+e;Math.abs(m-h)>1&&(w.b.log("AAC: align PTS for overlapping frames by "+Math.round((m-h)/90)),h=m)}for(;i<n;)if(s(l,i)&&i+5<n){var b=c(o,l,i,h,r);if(!b)break;i+=b.length,a=b.sample.pts,r++}else i++;f=i<n?l.subarray(i,n):null,this.aacOverFlow=f,this.aacLastPTS=a},t.prototype._parseMPEGPES=function(t){for(var e=t.data,r=e.length,i=0,a=0,n=t.pts;a<r;)if(F.isHeader(e,a)){var o=F.appendFrame(this._audioTrack,e,a,n,i);if(!o)break;a+=o.length,i++}else a++},t.prototype._parseID3PES=function(t){this._id3Track.samples.push(t)},t}(),H=j,K=function(){function t(e,r,i){m(this,t),this.observer=e,this.config=i,this.remuxer=r}return t.prototype.resetInitSegment=function(t,e,r,i){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:e,duration:i,inputTimeScale:9e4}},t.prototype.resetTimeStamp=function(){},t.probe=function(t){var e,r,i=D.a.getID3Data(t,0);if(i&&void 0!==D.a.getTimeStamp(i))for(e=i.length,r=Math.min(t.length-1,e+100);e<r;e++)if(F.probe(t,e))return w.b.log("MPEG Audio sync word found !"),!0;return!1},t.prototype.append=function(t,e,r,i){for(var a=D.a.getID3Data(t,0),n=D.a.getTimeStamp(a),o=n?90*n:9e4*e,s=a.length,l=t.length,u=0,d=0,h=this._audioTrack,c=[{pts:o,dts:o,data:a}];s<l;)if(F.isHeader(t,s)){var f=F.appendFrame(h,t,s,o,u);if(!f)break;s+=f.length,d=f.sample.pts,u++}else D.a.isHeader(t,s)?(a=D.a.getID3Data(t,s),c.push({pts:d,dts:d,data:a}),s+=a.length):s++;this.remuxer.remux(h,{samples:[]},{samples:c,inputTimeScale:9e4},{samples:[]},e,r,i)},t.prototype.destroy=function(){},t}(),W=K,V=function(){function t(){b(this,t)}return t.getSilentFrame=function(t,e){switch(t){case"mp4a.40.2":if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},t}(),Y=V,z=Math.pow(2,32)-1,X=function(){function t(){E(this,t)}return t.init=function(){t.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var e;for(e in t.types)t.types.hasOwnProperty(e)&&(t.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);t.HDLR_TYPES={video:r,audio:i};var a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);t.STTS=t.STSC=t.STCO=n,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var o=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);t.FTYP=t.box(t.types.ftyp,o,l,o,s),t.DINF=t.box(t.types.dinf,t.box(t.types.dref,a))},t.box=function(t){for(var e,r=Array.prototype.slice.call(arguments,1),i=8,a=r.length,n=a;a--;)i+=r[a].byteLength;for(e=new Uint8Array(i),e[0]=i>>24&255,e[1]=i>>16&255,e[2]=i>>8&255,e[3]=255&i,e.set(t,4),a=0,i=8;a<n;a++)e.set(r[a],i),i+=r[a].byteLength;return e},t.hdlr=function(e){return t.box(t.types.hdlr,t.HDLR_TYPES[e])},t.mdat=function(e){return t.box(t.types.mdat,e)},t.mdhd=function(e,r){r*=e;var i=Math.floor(r/(z+1)),a=Math.floor(r%(z+1));return t.box(t.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,85,196,0,0]))},t.mdia=function(e){return t.box(t.types.mdia,t.mdhd(e.timescale,e.duration),t.hdlr(e.type),t.minf(e))},t.mfhd=function(e){return t.box(t.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))},t.minf=function(e){return"audio"===e.type?t.box(t.types.minf,t.box(t.types.smhd,t.SMHD),t.DINF,t.stbl(e)):t.box(t.types.minf,t.box(t.types.vmhd,t.VMHD),t.DINF,t.stbl(e))},t.moof=function(e,r,i){return t.box(t.types.moof,t.mfhd(e),t.traf(i,r))},t.moov=function(e){for(var r=e.length,i=[];r--;)i[r]=t.trak(e[r]);return t.box.apply(null,[t.types.moov,t.mvhd(e[0].timescale,e[0].duration)].concat(i).concat(t.mvex(e)))},t.mvex=function(e){for(var r=e.length,i=[];r--;)i[r]=t.trex(e[r]);return t.box.apply(null,[t.types.mvex].concat(i))},t.mvhd=function(e,r){r*=e;var i=Math.floor(r/(z+1)),a=Math.floor(r%(z+1)),n=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t.box(t.types.mvhd,n)},t.sdtp=function(e){var r,i,a=e.samples||[],n=new Uint8Array(4+a.length);for(i=0;i<a.length;i++)r=a[i].flags,n[i+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return t.box(t.types.sdtp,n)},t.stbl=function(e){return t.box(t.types.stbl,t.stsd(e),t.box(t.types.stts,t.STTS),t.box(t.types.stsc,t.STSC),t.box(t.types.stsz,t.STSZ),t.box(t.types.stco,t.STCO))},t.avc1=function(e){var r,i,a,n=[],o=[];for(r=0;r<e.sps.length;r++)i=e.sps[r],a=i.byteLength,n.push(a>>>8&255),n.push(255&a),n=n.concat(Array.prototype.slice.call(i));for(r=0;r<e.pps.length;r++)i=e.pps[r],a=i.byteLength,o.push(a>>>8&255),o.push(255&a),o=o.concat(Array.prototype.slice.call(i));var s=t.box(t.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|e.sps.length].concat(n).concat([e.pps.length]).concat(o))),l=e.width,u=e.height,d=e.pixelRatio[0],h=e.pixelRatio[1];return t.box(t.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),t.box(t.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,h>>24,h>>16&255,h>>8&255,255&h])))},t.esds=function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))},t.mp4a=function(e){var r=e.samplerate;return t.box(t.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),t.box(t.types.esds,t.esds(e)))},t.mp3=function(e){var r=e.samplerate;return t.box(t.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]))},t.stsd=function(e){return"audio"===e.type?e.isAAC||"mp3"!==e.codec?t.box(t.types.stsd,t.STSD,t.mp4a(e)):t.box(t.types.stsd,t.STSD,t.mp3(e)):t.box(t.types.stsd,t.STSD,t.avc1(e))},t.tkhd=function(e){var r=e.id,i=e.duration*e.timescale,a=e.width,n=e.height,o=Math.floor(i/(z+1)),s=Math.floor(i%(z+1));return t.box(t.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,s>>24,s>>16&255,s>>8&255,255&s,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,n>>8&255,255&n,0,0]))},t.traf=function(e,r){var i=t.sdtp(e),a=e.id,n=Math.floor(r/(z+1)),o=Math.floor(r%(z+1));return t.box(t.types.traf,t.box(t.types.tfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a])),t.box(t.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,o>>24,o>>16&255,o>>8&255,255&o])),t.trun(e,i.length+16+20+8+16+8+8),i)},t.trak=function(e){return e.duration=e.duration||4294967295,t.box(t.types.trak,t.tkhd(e),t.mdia(e))},t.trex=function(e){var r=e.id;return t.box(t.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},t.trun=function(e,r){var i,a,n,o,s,l,u=e.samples||[],d=u.length,h=12+16*d,c=new Uint8Array(h);for(r+=8+h,c.set([0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0),i=0;i<d;i++)a=u[i],n=a.duration,o=a.size,s=a.flags,l=a.cts,c.set([n>>>24&255,n>>>16&255,n>>>8&255,255&n,o>>>24&255,o>>>16&255,o>>>8&255,255&o,s.isLeading<<2|s.dependsOn,s.isDependedOn<<6|s.hasRedundancy<<4|s.paddingValue<<1|s.isNonSync,61440&s.degradPrio,15&s.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*i);return t.box(t.types.trun,c)},t.initSegment=function(e){t.types||t.init();var r,i=t.moov(e);return r=new Uint8Array(t.FTYP.byteLength+i.byteLength),r.set(t.FTYP),r.set(i,t.FTYP.byteLength),r},t}(),q=X,Q=function(){function t(e,r,i,a){T(this,t),this.observer=e,this.config=r,this.typeSupported=i;var n=navigator.userAgent;this.isSafari=a&&a.indexOf("Apple")>-1&&n&&!n.match("CriOS"),this.ISGenerated=!1}return t.prototype.destroy=function(){},t.prototype.resetTimeStamp=function(t){this._initPTS=this._initDTS=t},t.prototype.resetInitSegment=function(){this.ISGenerated=!1},t.prototype.remux=function(t,e,r,i,a,n,o){if(this.ISGenerated||this.generateIS(t,e,a),this.ISGenerated){var s=t.samples.length,l=e.samples.length,u=a,d=a;if(s&&l){var h=(t.samples[0].dts-e.samples[0].dts)/e.inputTimeScale;u+=Math.max(0,h),d+=Math.max(0,-h)}if(s){t.timescale||(w.b.warn("regenerate InitSegment as audio detected"),this.generateIS(t,e,a));var c=this.remuxAudio(t,u,n,o);if(l){var f=void 0;c&&(f=c.endPTS-c.startPTS),e.timescale||(w.b.warn("regenerate InitSegment as video detected"),this.generateIS(t,e,a)),this.remuxVideo(e,d,n,f,o)}}else{var p=void 0;l&&(p=this.remuxVideo(e,d,n,o)),p&&t.codec&&this.remuxEmptyAudio(t,u,n,p)}}r.samples.length&&this.remuxID3(r,a),i.samples.length&&this.remuxText(i,a),this.observer.trigger(S.a.FRAG_PARSED)},t.prototype.generateIS=function(t,e,r){var i,a,n=this.observer,o=t.samples,s=e.samples,l=this.typeSupported,u="audio/mp4",d={},h={tracks:d},c=void 0===this._initPTS;if(c&&(i=a=1/0),t.config&&o.length&&(t.timescale=t.samplerate,w.b.log("audio sampling rate : "+t.samplerate),t.isAAC||(l.mpeg?(u="audio/mpeg",t.codec=""):l.mp3&&(t.codec="mp3")),d.audio={container:u,codec:t.codec,initSegment:!t.isAAC&&l.mpeg?new Uint8Array:q.initSegment([t]),metadata:{channelCount:t.channelCount}},c&&(i=a=o[0].pts-t.inputTimeScale*r)),e.sps&&e.pps&&s.length){var f=e.inputTimeScale;e.timescale=f,d.video={container:"video/mp4",codec:e.codec,initSegment:q.initSegment([e]),metadata:{width:e.width,height:e.height}},c&&(i=Math.min(i,s[0].pts-f*r),a=Math.min(a,s[0].dts-f*r),this.observer.trigger(S.a.INIT_PTS_FOUND,{initPTS:i}))}Object.keys(d).length?(n.trigger(S.a.FRAG_PARSING_INIT_SEGMENT,h),this.ISGenerated=!0,c&&(this._initPTS=i,this._initDTS=a)):n.trigger(S.a.ERROR,{type:L.b.MEDIA_ERROR,details:L.a.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},t.prototype.remuxVideo=function(t,e,r,i,a){var n,o,s,l,u,d,h,c=8,f=t.timescale,p=t.samples,g=[],v=p.length,y=this._PTSNormalize,m=this._initDTS,b=this.nextAvcDts,E=this.isSafari;E&&(r|=p.length&&b&&(a&&Math.abs(e-b/f)<.1||Math.abs(p[0].pts-b-m)<f/5)),r||(b=e*f),p.forEach(function(t){t.pts=y(t.pts-m,b),t.dts=y(t.dts-m,b)}),p.sort(function(t,e){var r=t.dts-e.dts,i=t.pts-e.pts;return r||(i||t.id-e.id)});var T=p.reduce(function(t,e){return Math.max(Math.min(t,e.pts-e.dts),-18e3)},0);if(T<0){w.b.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(T/90)+" ms to overcome this issue");for(var R=0;R<p.length;R++)p[R].dts+=T}var A=p[0];u=Math.max(A.dts,0),l=Math.max(A.pts,0);var _=Math.round((u-b)/90);r&&_&&(_>1?w.b.log("AVC:"+_+" ms hole between fragments detected,filling it"):_<-1&&w.b.log("AVC:"+-_+" ms overlapping between fragments detected"),u=b,p[0].dts=u,l=Math.max(l-_,b),p[0].pts=l,w.b.log("Video/PTS/DTS adjusted: "+Math.round(l/90)+"/"+Math.round(u/90)+",delta:"+_+" ms")),A=p[p.length-1],h=Math.max(A.dts,0),d=Math.max(A.pts,0,h),E&&(n=Math.round((h-u)/(p.length-1)));for(var D=0,I=0,k=0;k<v;k++){for(var O=p[k],C=O.units,P=C.length,x=0,F=0;F<P;F++)x+=C[F].data.length;I+=x,D+=P,O.length=x,O.dts=E?u+k*n:Math.max(O.dts,u),O.pts=Math.max(O.pts,O.dts)}var N=I+4*D+8;try{o=new Uint8Array(N)}catch(t){return void this.observer.trigger(S.a.ERROR,{type:L.b.MUX_ERROR,details:L.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:N,reason:"fail allocating video mdat "+N})}var M=new DataView(o.buffer);M.setUint32(0,N),o.set(q.types.mdat,4);for(var U=0;U<v;U++){for(var B=p[U],G=B.units,j=0,H=void 0,K=0,W=G.length;K<W;K++){var V=G[K],Y=V.data,z=V.data.byteLength;M.setUint32(c,z),c+=4,o.set(Y,c),c+=z,j+=4+z}if(E)H=Math.max(0,n*Math.round((B.pts-B.dts)/n));else{if(U<v-1)n=p[U+1].dts-B.dts;else{var X=this.config,Q=B.dts-p[U>0?U-1:U].dts;if(X.stretchShortVideoTrack){var J=X.maxBufferHole,$=X.maxSeekHole,Z=Math.floor(Math.min(J,$)*f),tt=(i?l+i*f:this.nextAudioPts)-B.pts;tt>Z?(n=tt-Q,n<0&&(n=Q),w.b.log("It is approximately "+tt/90+" ms to the next segment; using duration "+n/90+" ms for the last video frame.")):n=Q}else n=Q}H=Math.round(B.pts-B.dts)}g.push({size:j,duration:n,cts:H,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:B.key?2:1,isNonSync:B.key?0:1}})}this.nextAvcDts=h+n;var et=t.dropped;if(t.len=0,t.nbNalu=0,t.dropped=0,g.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var rt=g[0].flags;rt.dependsOn=2,rt.isNonSync=0}t.samples=g,s=q.moof(t.sequenceNumber++,u,t),t.samples=[];var it={data1:s,data2:o,startPTS:l/f,endPTS:(d+n)/f,startDTS:u/f,endDTS:this.nextAvcDts/f,type:"video",nb:g.length,dropped:et};return this.observer.trigger(S.a.FRAG_PARSING_DATA,it),it},t.prototype.remuxAudio=function(t,e,r,i){var a,n,o,s,l,u,d,h=t.inputTimeScale,c=t.timescale,f=h/c,p=t.isAAC?1024:1152,g=p*f,v=this._PTSNormalize,y=this._initDTS,m=!t.isAAC&&this.typeSupported.mpeg,b=t.samples,E=[],T=this.nextAudioPts;if(r|=b.length&&T&&(i&&Math.abs(e-T/h)<.1||Math.abs(b[0].pts-T-y)<20*g),b.forEach(function(t){t.pts=t.dts=v(t.pts-y,e*h)}),b=b.filter(function(t){return t.pts>=0}),0!==b.length){if(r||(T=i?e*h:b[0].pts),t.isAAC)for(var R=this.config.maxAudioFramesDrift,A=0,_=T;A<b.length;){var D,I=b[A],k=I.pts;D=k-_;var O=Math.abs(1e3*D/h);if(D<=-R*g)w.b.warn("Dropping 1 audio frame @ "+(_/h).toFixed(3)+"s due to "+Math.round(O)+" ms overlap."),b.splice(A,1),t.len-=I.unit.length;else if(D>=R*g&&O<1e4&&_){var C=Math.round(D/g);w.b.warn("Injecting "+C+" audio frame @ "+(_/h).toFixed(3)+"s due to "+Math.round(1e3*D/h)+" ms gap.");for(var P=0;P<C;P++){var x=Math.max(_,0);o=Y.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),o||(w.b.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),o=I.unit.subarray()),b.splice(A,0,{unit:o,pts:x,dts:x}),t.len+=o.length,_+=g,A++}I.pts=I.dts=_,_+=g,A++}else Math.abs(D),I.pts=I.dts=_,_+=g,A++}for(var F=0,N=b.length;F<N;F++){var M=b[F],U=M.unit,B=M.pts;if(void 0!==d)n.duration=Math.round((B-d)/f);else{var G=Math.round(1e3*(B-T)/h),j=0;if(r&&t.isAAC&&G){if(G>0&&G<1e4)j=Math.round((B-T)/g),w.b.log(G+" ms hole between AAC samples detected,filling it"),j>0&&(o=Y.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),o||(o=U.subarray()),t.len+=j*o.length);else if(G<-12){w.b.log("drop overlapping AAC sample, expected/parsed/delta:"+(T/h).toFixed(3)+"s/"+(B/h).toFixed(3)+"s/"+-G+"ms"),t.len-=U.byteLength;continue}B=T}if(u=B,!(t.len>0))return;var H=m?t.len:t.len+8;a=m?0:8;try{s=new Uint8Array(H)}catch(t){return void this.observer.trigger(S.a.ERROR,{type:L.b.MUX_ERROR,details:L.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:H,reason:"fail allocating audio mdat "+H})}if(!m){new DataView(s.buffer).setUint32(0,H),s.set(q.types.mdat,4)}for(var K=0;K<j;K++)o=Y.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),o||(w.b.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),o=U.subarray()),s.set(o,a),a+=o.byteLength,n={size:o.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},E.push(n)}s.set(U,a);var W=U.byteLength;a+=W,n={size:W,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},E.push(n),d=B}var V=0,z=E.length;if(z>=2&&(V=E[z-2].duration,n.duration=V),z){this.nextAudioPts=T=d+f*V,t.len=0,t.samples=E,l=m?new Uint8Array:q.moof(t.sequenceNumber++,u/f,t),t.samples=[];var X=u/h,Q=T/h,J={data1:l,data2:s,startPTS:X,endPTS:Q,startDTS:X,endDTS:Q,type:"audio",nb:z};return this.observer.trigger(S.a.FRAG_PARSING_DATA,J),J}return null}},t.prototype.remuxEmptyAudio=function(t,e,r,i){var a=t.inputTimeScale,n=t.samplerate?t.samplerate:a,o=a/n,s=this.nextAudioPts,l=(void 0!==s?s:i.startDTS*a)+this._initDTS,u=i.endDTS*a+this._initDTS,d=1024*o,h=Math.ceil((u-l)/d),c=Y.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(w.b.warn("remux empty Audio"),!c)return void w.b.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var f=[],p=0;p<h;p++){var g=l+p*d;f.push({unit:c,pts:g,dts:g}),t.len+=c.length}t.samples=f,this.remuxAudio(t,e,r)},t.prototype.remuxID3=function(t,e){var r,i=t.samples.length,a=t.inputTimeScale,n=this._initPTS,o=this._initDTS;if(i){for(var s=0;s<i;s++)r=t.samples[s],r.pts=(r.pts-n)/a,r.dts=(r.dts-o)/a;this.observer.trigger(S.a.FRAG_PARSING_METADATA,{samples:t.samples})}t.samples=[],e=e},t.prototype.remuxText=function(t,e){t.samples.sort(function(t,e){return t.pts-e.pts});var r,i=t.samples.length,a=t.inputTimeScale,n=this._initPTS;if(i){for(var o=0;o<i;o++)r=t.samples[o],r.pts=(r.pts-n)/a;this.observer.trigger(S.a.FRAG_PARSING_USERDATA,{samples:t.samples})}t.samples=[],e=e},t.prototype._PTSNormalize=function(t,e){var r;if(void 0===e)return t;for(r=e<t?-8589934592:8589934592;Math.abs(t-e)>4294967296;)t+=r;return t},t}(),J=Q,$=function(){function t(e){R(this,t),this.observer=e}return t.prototype.destroy=function(){},t.prototype.resetTimeStamp=function(){},t.prototype.resetInitSegment=function(){},t.prototype.remux=function(t,e,r,i,a,n,o,s){var l=this.observer,u="";t&&(u+="audio"),e&&(u+="video"),l.trigger(S.a.FRAG_PARSING_DATA,{data1:s,startPTS:a,startDTS:a,type:u,nb:1,dropped:0}),l.trigger(S.a.FRAG_PARSED)},t}(),Z=$,tt=function(){function t(e,r,i,a){A(this,t),this.observer=e,this.typeSupported=r,this.config=i,this.vendor=a}return t.prototype.destroy=function(){var t=this.demuxer;t&&t.destroy()},t.prototype.push=function(t,e,r,i,a,n,o,s,l,u,d,h){if(t.byteLength>0&&null!=e&&null!=e.key&&"AES-128"===e.method){var c=this.decrypter;null==c&&(c=this.decrypter=new _.a(this.observer,this.config));var f,p=this;try{f=performance.now()}catch(t){f=Date.now()}c.decrypt(t,e.key.buffer,e.iv.buffer,function(t){var c;try{c=performance.now()}catch(t){c=Date.now()}p.observer.trigger(S.a.FRAG_DECRYPTED,{stats:{tstart:f,tdecrypt:c}}),p.pushDecrypted(new Uint8Array(t),e,new Uint8Array(r),i,a,n,o,s,l,u,d,h)})}else this.pushDecrypted(new Uint8Array(t),e,new Uint8Array(r),i,a,n,o,s,l,u,d,h)},t.prototype.pushDecrypted=function(t,e,r,i,a,n,o,s,l,u,d,h){var c=this.demuxer;if(!c||o&&!this.probe(t)){for(var f=this.observer,p=this.typeSupported,g=this.config,v=[{demux:H,remux:J},{demux:P,remux:Z},{demux:k,remux:J},{demux:W,remux:J}],y=0,m=v.length;y<m;y++){var b=v[y],E=b.demux.probe;if(E(t)){var T=this.remuxer=new b.remux(f,g,p,this.vendor);c=new b.demux(f,T,g,p),this.probe=E;break}}if(!c)return void f.trigger(S.a.ERROR,{type:L.b.MEDIA_ERROR,details:L.a.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=c}var R=this.remuxer;(o||s)&&(c.resetInitSegment(r,i,a,u),R.resetInitSegment()),o&&(c.resetTimeStamp(h),R.resetTimeStamp(h)),"function"==typeof c.setDecryptData&&c.setDecryptData(e),c.append(t,n,l,d)},t}();e.a=tt},function(t,e,r){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){var r=jt[e];return!!r&&!0===r[t.slice(0,4)]}function o(t,e){return MediaSource.isTypeSupported((e||"video")+'/mp4;codecs="'+t+'"')}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d(t,e){if(!t)return null;for(var r=null,i=0;i<t.length;i++){var a=t[i];a.id===e&&(r=a)}return r}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function g(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function v(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function y(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b(t,e,r){var i=t[e],a=t[r],n=a.startPTS;isNaN(n)?a.start=r>e?i.start+i.duration:Math.max(i.start-a.duration,0):r>e?(i.duration=n-i.start,i.duration<0&&Pt.b.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!")):(a.duration=i.start-n,a.duration<0&&Pt.b.warn("negative duration computed for frag "+a.sn+",level "+a.level+", there should be some duration drift between playlist and fragment!"))}function E(t,e,r,i,a,n){var o=r;if(!isNaN(e.startPTS)){var s=Math.abs(e.startPTS-r);isNaN(e.deltaPTS)?e.deltaPTS=s:e.deltaPTS=Math.max(s,e.deltaPTS),o=Math.max(r,e.startPTS),r=Math.min(r,e.startPTS),i=Math.max(i,e.endPTS),a=Math.min(a,e.startDTS),n=Math.max(n,e.endDTS)}var l=r-e.start;e.start=e.startPTS=r,e.maxStartPTS=o,e.endPTS=i,e.startDTS=a,e.endDTS=n,e.duration=i-r;var u=e.sn;if(!t||u<t.startSN||u>t.endSN)return 0;var d,h,c;for(d=u-t.startSN,h=t.fragments,h[d]=e,c=d;c>0;c--)b(h,c,c-1);for(c=d;c<h.length-1;c++)b(h,c,c+1);return t.PTSKnown=!0,l}function T(t,e){var r,i=Math.max(t.startSN,e.startSN)-e.startSN,a=Math.min(t.endSN,e.endSN)-e.startSN,n=e.startSN-t.startSN,o=t.fragments,s=e.fragments,l=0;if(a<i)return void(e.PTSKnown=!1);for(var u=i;u<=a;u++){var d=o[n+u],h=s[u];h&&d&&(l=d.cc-h.cc,isNaN(d.startPTS)||(h.start=h.startPTS=d.startPTS,h.endPTS=d.endPTS,h.duration=d.duration,h.backtracked=d.backtracked,h.dropped=d.dropped,r=h))}if(l)for(Pt.b.log("discontinuity sliding from playlist, take drift into account"),u=0;u<s.length;u++)s[u].cc+=l;if(r)E(e,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS);else if(n>=0&&n<o.length){var c=o[n].start;for(u=0;u<s.length;u++)s[u].start+=c}e.PTSKnown=t.PTSKnown}function R(t,e){for(var r=null,i=0;i<t.length;i+=1){var a=t[i];if(a&&a.cc===e){r=a;break}}return r}function A(t,e){return re.search(t,function(t){return t.cc<e?1:t.cc>e?-1:0})}function S(t,e,r){var i=!1;return e&&e.details&&r&&(r.endCC>r.startCC||t&&t.cc<r.startCC)&&(i=!0),i}function L(t,e){var r=t.fragments,i=e.fragments;if(!i.length||!r.length)return void Pt.b.log("No fragments to align");var a=R(r,i[0].cc);return!a||a&&!a.startPTS?void Pt.b.log("No frag in previous level to align on"):a}function _(t,e){e.fragments.forEach(function(e){if(e){var r=e.start+t;e.start=e.startPTS=r,e.endPTS=r+e.duration}}),e.PTSKnown=!0}function w(t,e,r){if(S(t,e,r)){var i=L(e.details,r);i&&(Pt.b.log("Adjusting PTS using last level due to CC increase within current level"),_(i.start,r))}if(!1===r.PTSKnown&&e&&e.details){var a=e.details.programDateTime,n=r.programDateTime,o=(n-a)/1e3+e.details.fragments[0].start;isNaN(o)||(Pt.b.log("adjusting PTS using programDateTime delta, sliding:"+o.toFixed(3)),_(o,r))}}function D(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function I(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function k(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function O(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function C(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function P(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function x(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function F(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function N(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function M(){var t=y(),e=window.SourceBuffer||window.WebKitSourceBuffer,r=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),i=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove;return!!r&&!!i}function U(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function B(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function G(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function j(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function H(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function K(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function W(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function V(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function Y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function z(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function X(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function q(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Q(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function J(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function $(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Z(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function tt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function et(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function rt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function it(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function at(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function nt(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new Qe,this.regionList=[]}function ot(t){function e(t,e,r,i){return 3600*(0|t)+60*(0|e)+(0|r)+(0|i)/1e3}var r=t.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return r?r[3]?e(r[1],r[2],r[3].replace(":",""),r[4]):r[1]>59?e(r[1],r[2],0,r[4]):e(0,r[1],r[2],r[4]):null}function st(){this.values=Object.create(null)}function lt(t,e,r,i){var a=i?t.split(i):[t];for(var n in a)if("string"==typeof a[n]){var o=a[n].split(r);if(2===o.length){var s=o[0],l=o[1];e(s,l)}}}function ut(t,e,r){function i(){var e=ot(t);if(null===e)throw new Error("Malformed timestamp: "+n);return t=t.replace(/^[^\sa-zA-Z-]+/,""),e}function a(){t=t.replace(/^\s+/,"")}var n=t;if(a(),e.startTime=i(),a(),"--\x3e"!==t.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+n);t=t.substr(3),a(),e.endTime=i(),a(),function(t,e){var i=new st;lt(t,function(t,e){switch(t){case"region":for(var a=r.length-1;a>=0;a--)if(r[a].id===e){i.set(t,r[a].region);break}break;case"vertical":i.alt(t,e,["rl","lr"]);break;case"line":var n=e.split(","),o=n[0];i.integer(t,o),i.percent(t,o)&&i.set("snapToLines",!1),i.alt(t,o,["auto"]),2===n.length&&i.alt("lineAlign",n[1],["start",$e,"end"]);break;case"position":n=e.split(","),i.percent(t,n[0]),2===n.length&&i.alt("positionAlign",n[1],["start",$e,"end","line-left","line-right","auto"]);break;case"size":i.percent(t,e);break;case"align":i.alt(t,e,["start",$e,"end","left","right"])}},/:/,/\s/),e.region=i.get("region",null),e.vertical=i.get("vertical","");var a=i.get("line","auto");"auto"===a&&-1===Je.line&&(a=-1),e.line=a,e.lineAlign=i.get("lineAlign","start"),e.snapToLines=i.get("snapToLines",!0),e.size=i.get("size",100),e.align=i.get("align",$e);var n=i.get("position","auto");"auto"===n&&50===Je.position&&(n="start"===e.align||"left"===e.align?0:"end"===e.align||"right"===e.align?100:50),e.position=n}(t,e)}function dt(t){return t.replace(/<br(?: \/)?>/gi,"\n")}function ht(t,e,r,i){for(var a,n,o,s,l,u=window.VTTCue||window.TextTrackCue,d=0;d<i.rows.length;d++)if(a=i.rows[d],o=!0,s=0,l="",!a.isEmpty()){for(var h=0;h<a.chars.length;h++)a.chars[h].uchar.match(/\s/)&&o?s++:(l+=a.chars[h].uchar,o=!1);a.cueStartTime=e,e===r&&(r+=1e-4),n=new u(e,r,dt(l.trim())),s>=16?s--:s++,navigator.userAgent.match(/Firefox\//)?n.line=d+1:n.line=d>7?d-2:d+1,n.align="left",n.position=Math.max(0,Math.min(100,s/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),t.addCue(n)}}function ct(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ft(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function pt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function gt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function vt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function yt(t){if(t&&t.cues)for(;t.cues.length>0;)t.removeCue(t.cues[0])}function mt(t,e){return t&&t.label===e.name&&!(t.textTrack1||t.textTrack2)}function bt(t,e,r,i){return Math.min(e,i)-Math.max(t,r)}function Et(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Tt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function Rt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function At(t){for(var e=[],r=0;r<t.length;r++)"subtitles"===t[r].kind&&e.push(t[r]);return e}function St(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Lt(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _t(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function wt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var Dt={};r.d(Dt,"newCue",function(){return ht});var It=r(6),kt=r.n(It),Ot=r(1),Ct=r(2),Pt=r(0),xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ft=function(){function t(e){i(this,t),this.hls=e,this.onEvent=this.onEvent.bind(this);for(var r=arguments.length,a=Array(r>1?r-1:0),n=1;n<r;n++)a[n-1]=arguments[n];this.handledEvents=a,this.useGenericHandler=!0,this.registerListeners()}return t.prototype.destroy=function(){this.unregisterListeners()},t.prototype.isEventHandler=function(){return"object"===xt(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent},t.prototype.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(t){if("hlsEventGeneric"===t)throw new Error("Forbidden event name: "+t);this.hls.on(t,this.onEvent)},this)},t.prototype.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach(function(t){this.hls.off(t,this.onEvent)},this)},t.prototype.onEvent=function(t,e){this.onEventGeneric(t,e)},t.prototype.onEventGeneric=function(t,e){var r=function(t,e){var r="on"+t.replace("hls","");if("function"!=typeof this[r])throw new Error("Event "+t+" has no generic handler in this "+this.constructor.name+" class (tried "+r+")");return this[r].bind(this,e)};try{r.call(this,t,e).call()}catch(e){Pt.b.error("internal error happened while processing "+t+":"+e.message),this.hls.trigger(Ot.a.ERROR,{type:Ct.b.OTHER_ERROR,details:Ct.a.INTERNAL_EXCEPTION,fatal:!1,event:t,err:e})}},t}(),Nt=Ft,Mt=/^(\d+)x(\d+)$/,Ut=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,Bt=function(){function t(e){a(this,t),"string"==typeof e&&(e=t.parseAttrList(e));for(var r in e)e.hasOwnProperty(r)&&(this[r]=e[r])}return t.prototype.decimalInteger=function(t){var e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},t.prototype.hexadecimalInteger=function(t){if(this[t]){var e=(this[t]||"0x").slice(2);e=(1&e.length?"0":"")+e;for(var r=new Uint8Array(e.length/2),i=0;i<e.length/2;i++)r[i]=parseInt(e.slice(2*i,2*i+2),16);return r}return null},t.prototype.hexadecimalIntegerAsNumber=function(t){var e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},t.prototype.decimalFloatingPoint=function(t){return parseFloat(this[t])},t.prototype.enumeratedString=function(t){return this[t]},t.prototype.decimalResolution=function(t){var e=Mt.exec(this[t]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},t.parseAttrList=function(t){var e,r={};for(Ut.lastIndex=0;null!==(e=Ut.exec(t));){var i=e[2];0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1)),r[e[1]]=i}return r},t}(),Gt=Bt,jt={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}},Ht=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),Kt=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,Wt=/#EXT-X-MEDIA:(.*)/g,Vt=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)(\S+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),Yt=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,zt=function(){function t(){u(this,t),this.method=null,this.key=null,this.iv=null,this._uri=null}return Ht(t,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=kt.a.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),t}(),Xt=function(){function t(){u(this,t),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return t.prototype.createInitializationVector=function(t){for(var e=new Uint8Array(16),r=12;r<16;r++)e[r]=t>>8*(15-r)&255;return e},t.prototype.fragmentDecryptdataFromLevelkey=function(t,e){var r=t;return t&&t.method&&t.uri&&!t.iv&&(r=new zt,r.method=t.method,r.baseuri=t.baseuri,r.reluri=t.reluri,r.iv=this.createInitializationVector(e)),r},t.prototype.cloneObj=function(t){return JSON.parse(JSON.stringify(t))},Ht(t,[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=kt.a.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(t){this._url=t}},{key:"programDateTime",get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function(){if(!this._byteRange){var t=this._byteRange=[];if(this.rawByteRange){var e=this.rawByteRange.split("@",2);if(1===e.length){var r=this.lastByteRangeEndOffset;t[0]=r||0}else t[0]=parseInt(e[1]);t[1]=parseInt(e[0])+t[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),t}(),qt=function(t){function e(r){u(this,e);var i=s(this,t.call(this,r,Ot.a.MANIFEST_LOADING,Ot.a.LEVEL_LOADING,Ot.a.AUDIO_TRACK_LOADING,Ot.a.SUBTITLE_TRACK_LOADING));return i.loaders={},i}return l(e,t),e.prototype.destroy=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy()}this.loaders={},Nt.prototype.destroy.call(this)},e.prototype.onManifestLoading=function(t){this.load(t.url,{type:"manifest"})},e.prototype.onLevelLoading=function(t){this.load(t.url,{type:"level",level:t.level,id:t.id})},e.prototype.onAudioTrackLoading=function(t){this.load(t.url,{type:"audioTrack",id:t.id})},e.prototype.onSubtitleTrackLoading=function(t){this.load(t.url,{type:"subtitleTrack",id:t.id})},e.prototype.load=function(t,e){var r=this.loaders[e.type];if(void 0!==r){var i=r.context;if(i&&i.url===t)return void Pt.b.trace("playlist request ongoing");Pt.b.warn("abort previous loader for type:"+e.type),r.abort()}var a=this.hls.config,n=void 0,o=void 0,s=void 0,l=void 0;"manifest"===e.type?(n=a.manifestLoadingMaxRetry,o=a.manifestLoadingTimeOut,s=a.manifestLoadingRetryDelay,l=a.manifestLoadingMaxRetryTimeout):"level"===e.type?(n=0,o=a.levelLoadingTimeOut):(n=a.levelLoadingMaxRetry,o=a.levelLoadingTimeOut,s=a.levelLoadingRetryDelay,l=a.levelLoadingMaxRetryTimeout,Pt.b.log("loading playlist for "+e.type+" "+(e.level||e.id))),r=this.loaders[e.type]=e.loader=void 0!==a.pLoader?new a.pLoader(a):new a.loader(a),e.url=t,e.responseType="";var u=void 0,d=void 0;u={timeout:o,maxRetry:n,retryDelay:s,maxRetryDelay:l},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},r.load(e,u,d)},e.prototype.resolve=function(t,e){return kt.a.buildAbsoluteURL(e,t,{alwaysNormalize:!0})},e.prototype.parseMasterPlaylist=function(t,e){var r=[],i=void 0;for(Kt.lastIndex=0;null!=(i=Kt.exec(t));){var a={},o=a.attrs=new Gt(i[1]);a.url=this.resolve(i[2],e);var s=o.decimalResolution("RESOLUTION");s&&(a.width=s.width,a.height=s.height),a.bitrate=o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),a.name=o.NAME,function(t,e){["video","audio"].forEach(function(r){var i=t.filter(function(t){return n(t,r)});if(i.length){var a=i.filter(function(t){return 0===t.lastIndexOf("avc1",0)||0===t.lastIndexOf("mp4a",0)});e[r+"Codec"]=a.length>0?a[0]:i[0],t=t.filter(function(t){return-1===i.indexOf(t)})}}),e.unknownCodecs=t}([].concat((o.CODECS||"").split(/[ ,]+/)),a),a.videoCodec&&-1!==a.videoCodec.indexOf("avc1")&&(a.videoCodec=this.avc1toavcoti(a.videoCodec)),r.push(a)}return r},e.prototype.parseMasterPlaylistMedia=function(t,e,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=void 0,n=[],o=0;for(Wt.lastIndex=0;null!==(a=Wt.exec(t));){var s={},l=new Gt(a[1]);if(l.TYPE===r){if(s.groupId=l["GROUP-ID"],s.name=l.NAME,s.type=r,s.default="YES"===l.DEFAULT,s.autoselect="YES"===l.AUTOSELECT,s.forced="YES"===l.FORCED,l.URI&&(s.url=this.resolve(l.URI,e)),s.lang=l.LANGUAGE,s.name||(s.name=s.lang),i.length){var u=d(i,s.groupId);s.audioCodec=u?u.codec:i[0].codec}s.id=o++,n.push(s)}}return n},e.prototype.avc1toavcoti=function(t){var e,r=t.split(".");return r.length>2?(e=r.shift()+".",e+=parseInt(r.shift()).toString(16),e+=("000"+parseInt(r.shift()).toString(16)).substr(-4)):e=t,e},e.prototype.parseLevelPlaylist=function(t,e,r,i){var a,n,o=0,s=0,l={type:null,version:null,url:e,fragments:[],live:!0,startSN:0},u=new zt,d=0,h=null,c=new Xt;for(Vt.lastIndex=0;null!==(a=Vt.exec(t));){var f=a[1];if(f){c.duration=parseFloat(f);var p=(" "+a[2]).slice(1);c.title=p||null,c.tagList.push(p?["INF",f,p]:["INF",f])}else if(a[3]){if(!isNaN(c.duration)){var g=o++;c.type=i,c.start=s,c.levelkey=u,c.sn=g,c.level=r,c.cc=d,c.baseurl=e,c.relurl=(" "+a[3]).slice(1),l.fragments.push(c),h=c,s+=c.duration,c=new Xt}}else if(a[4]){if(c.rawByteRange=(" "+a[4]).slice(1),h){var v=h.byteRangeEndOffset;v&&(c.lastByteRangeEndOffset=v)}}else if(a[5])c.rawProgramDateTime=(" "+a[5]).slice(1),c.tagList.push(["PROGRAM-DATE-TIME",c.rawProgramDateTime]),void 0===l.programDateTime&&(l.programDateTime=new Date(new Date(Date.parse(a[5]))-1e3*s));else{for(a=a[0].match(Yt),n=1;n<a.length&&void 0===a[n];n++);var y=(" "+a[n+1]).slice(1),m=(" "+a[n+2]).slice(1);switch(a[n]){case"#":c.tagList.push(m?[y,m]:[y]);break;case"PLAYLIST-TYPE":l.type=y.toUpperCase();break;case"MEDIA-SEQUENCE":o=l.startSN=parseInt(y);break;case"TARGETDURATION":l.targetduration=parseFloat(y);break;case"VERSION":l.version=parseInt(y);break;case"EXTM3U":break;case"ENDLIST":l.live=!1;break;case"DIS":d++,c.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":d=parseInt(y);break;case"KEY":var b=y,E=new Gt(b),T=E.enumeratedString("METHOD"),R=E.URI,A=E.hexadecimalInteger("IV");T&&(u=new zt,R&&["AES-128","SAMPLE-AES"].indexOf(T)>=0&&(u.method=T,u.baseuri=e,u.reluri=R,u.key=null,u.iv=A));break;case"START":var S=y,L=new Gt(S),_=L.decimalFloatingPoint("TIME-OFFSET");isNaN(_)||(l.startTimeOffset=_);break;case"MAP":var w=new Gt(y);c.relurl=w.URI,c.rawByteRange=w.BYTERANGE,c.baseurl=e,c.level=r,c.type=i,c.sn="initSegment",l.initSegment=c,c=new Xt;break;default:Pt.b.warn("line parsed but not handled: "+a)}}}return c=h,c&&!c.relurl&&(l.fragments.pop(),s-=c.duration),l.totalduration=s,l.averagetargetduration=s/l.fragments.length,l.endSN=o-1,l.startCC=l.fragments[0]?l.fragments[0].cc:0,l.endCC=d,l},e.prototype.loadsuccess=function(t,e,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=t.data,n=t.url,o=r.type,s=r.id,l=r.level,u=this.hls;if(this.loaders[o]=void 0,void 0!==n&&0!==n.indexOf("data:")||(n=r.url),e.tload=performance.now(),0===a.indexOf("#EXTM3U"))if(a.indexOf("#EXTINF:")>0){var d="audioTrack"!==o&&"subtitleTrack"!==o,h=isNaN(l)?isNaN(s)?0:s:l,c=this.parseLevelPlaylist(a,n,h,"audioTrack"===o?"audio":"subtitleTrack"===o?"subtitle":"main");c.tload=e.tload,"manifest"===o&&u.trigger(Ot.a.MANIFEST_LOADED,{levels:[{url:n,details:c}],audioTracks:[],url:n,stats:e,networkDetails:i}),e.tparsed=performance.now(),c.targetduration?d?u.trigger(Ot.a.LEVEL_LOADED,{details:c,level:l||0,id:s||0,stats:e,networkDetails:i}):"audioTrack"===o?u.trigger(Ot.a.AUDIO_TRACK_LOADED,{details:c,id:s,stats:e,networkDetails:i}):"subtitleTrack"===o&&u.trigger(Ot.a.SUBTITLE_TRACK_LOADED,{details:c,id:s,stats:e,networkDetails:i}):u.trigger(Ot.a.ERROR,{type:Ct.b.NETWORK_ERROR,details:Ct.a.MANIFEST_PARSING_ERROR,fatal:!0,url:n,reason:"invalid targetduration",networkDetails:i})}else{var f=this.parseMasterPlaylist(a,n);if(f.length){var p=f.map(function(t){return{id:t.attrs.AUDIO,codec:t.audioCodec}}),g=this.parseMasterPlaylistMedia(a,n,"AUDIO",p),v=this.parseMasterPlaylistMedia(a,n,"SUBTITLES");if(g.length){var y=!1;g.forEach(function(t){t.url||(y=!0)}),!1===y&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(Pt.b.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main"}))}u.trigger(Ot.a.MANIFEST_LOADED,{levels:f,audioTracks:g,subtitles:v,url:n,stats:e,networkDetails:i})}else u.trigger(Ot.a.ERROR,{type:Ct.b.NETWORK_ERROR,details:Ct.a.MANIFEST_PARSING_ERROR,fatal:!0,url:n,reason:"no level found in manifest",networkDetails:i})}else u.trigger(Ot.a.ERROR,{type:Ct.b.NETWORK_ERROR,details:Ct.a.MANIFEST_PARSING_ERROR,fatal:!0,url:n,reason:"no EXTM3U delimiter",networkDetails:i})},e.prototype.loaderror=function(t,e){var r,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=e.loader;switch(e.type){case"manifest":r=Ct.a.MANIFEST_LOAD_ERROR,i=!0;break;case"level":r=Ct.a.LEVEL_LOAD_ERROR,i=!1;break;case"audioTrack":r=Ct.a.AUDIO_TRACK_LOAD_ERROR,i=!1}n&&(n.abort(),this.loaders[e.type]=void 0),this.hls.trigger(Ot.a.ERROR,{type:Ct.b.NETWORK_ERROR,details:r,fatal:i,url:n.url,loader:n,response:t,context:e,networkDetails:a})},e.prototype.loadtimeout=function(t,e){var r,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=e.loader;switch(e.type){case"manifest":r=Ct.a.MANIFEST_LOAD_TIMEOUT,i=!0;break;case"level":r=Ct.a.LEVEL_LOAD_TIMEOUT,i=!1;break;case"audioTrack":r=Ct.a.AUDIO_TRACK_LOAD_TIMEOUT,i=!1}n&&(n.abort(),this.loaders[e.type]=void 0),this.hls.trigger(Ot.a.ERROR,{type:Ct.b.NETWORK_ERROR,details:r,fatal:i,url:n.url,loader:n,context:e,networkDetails:a})},e}(Nt),Qt=qt,Jt=function(t){function e(r){h(this,e);var i=c(this,t.call(this,r,Ot.a.FRAG_LOADING));return i.loaders={},i}return f(e,t),e.prototype.destroy=function(){var t=this.loaders;for(var e in t){var r=t[e];r&&r.destroy()}this.loaders={},Nt.prototype.destroy.call(this)},e.prototype.onFragLoading=function(t){var e=t.frag,r=e.type,i=this.loaders[r],a=this.hls.config;e.loaded=0,i&&(Pt.b.warn("abort previous fragment loader for type:"+r),i.abort()),i=this.loaders[r]=e.loader=void 0!==a.fLoader?new a.fLoader(a):new a.loader(a);var n=void 0,o=void 0,s=void 0;n={url:e.url,frag:e,responseType:"arraybuffer",progressData:!1};var l=e.byteRangeStartOffset,u=e.byteRangeEndOffset;isNaN(l)||isNaN(u)||(n.rangeStart=l,n.rangeEnd=u),o={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout},s={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},i.load(n,o,s)},e.prototype.loadsuccess=function(t,e,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=t.data,n=r.frag;n.loader=void 0,this.loaders[n.type]=void 0,this.hls.trigger(Ot.a.FRAG_LOADED,{payload:a,frag:n,stats:e,networkDetails:i})},e.prototype.loaderror=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=e.loader;i&&i.abort(),this.loaders[e.type]=void 0,this.hls.trigger(Ot.a.ERROR,{type:Ct.b.NETWORK_ERROR,details:Ct.a.FRAG_LOAD_ERROR,fatal:!1,frag:e.frag,response:t,networkDetails:r})},e.prototype.loadtimeout=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=e.loader;i&&i.abort(),this.loaders[e.type]=void 0,this.hls.trigger(Ot.a.ERROR,{type:Ct.b.NETWORK_ERROR,details:Ct.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e.frag,networkDetails:r})},e.prototype.loadprogress=function(t,e,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=e.frag;a.loaded=t.loaded,this.hls.trigger(Ot.a.FRAG_LOAD_PROGRESS,{frag:a,stats:t,networkDetails:i})},e}(Nt),$t=Jt,Zt=function(t){function e(r){p(this,e);var i=g(this,t.call(this,r,Ot.a.KEY_LOADING));return i.loaders={},i.decryptkey=null,i.decrypturl=null,i}return v(e,t),e.prototype.destroy=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy()}this.loaders={},Nt.prototype.destroy.call(this)},e.prototype.onKeyLoading=function(t){var e=t.frag,r=e.type,i=this.loaders[r],a=e.decryptdata,n=a.uri;if(n!==this.decrypturl||null===this.decryptkey){var o=this.hls.config;i&&(Pt.b.warn("abort previous key loader for type:"+r),i.abort()),e.loader=this.loaders[r]=new o.loader(o),this.decrypturl=n,this.decryptkey=null;var s=void 0,l=void 0,u=void 0;s={url:n,frag:e,responseType:"arraybuffer"},l={timeout:o.fragLoadingTimeOut,maxRetry:o.fragLoadingMaxRetry,retryDelay:o.fragLoadingRetryDelay,maxRetryDelay:o.fragLoadingMaxRetryTimeout},u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},e.loader.load(s,l,u)}else this.decryptkey&&(a.key=this.decryptkey,this.hls.trigger(Ot.a.KEY_LOADED,{frag:e}))},e.prototype.loadsuccess=function(t,e,r){var i=r.frag;this.decryptkey=i.decryptdata.key=new Uint8Array(t.data),i.loader=void 0,this.loaders[i.type]=void 0,this.hls.trigger(Ot.a.KEY_LOADED,{frag:i})},e.prototype.loaderror=function(t,e){var r=e.frag,i=r.loader;i&&i.abort(),this.loaders[e.type]=void 0,this.hls.trigger(Ot.a.ERROR,{type:Ct.b.NETWORK_ERROR,details:Ct.a.KEY_LOAD_ERROR,fatal:!1,frag:r,response:t})},e.prototype.loadtimeout=function(t,e){var r=e.frag,i=r.loader;i&&i.abort(),this.loaders[e.type]=void 0,this.hls.trigger(Ot.a.ERROR,{type:Ct.b.NETWORK_ERROR,details:Ct.a.KEY_LOAD_TIMEOUT,fatal:!1,frag:r})},e}(Nt),te=Zt,ee={search:function(t,e){for(var r=0,i=t.length-1,a=null,n=null;r<=i;){a=(r+i)/2|0,n=t[a];var o=e(n);if(o>0)r=a+1;else{if(!(o<0))return n;i=a-1}}return null}},re=ee,ie={isBuffered:function(t,e){try{if(t)for(var r=t.buffered,i=0;i<r.length;i++)if(e>=r.start(i)&&e<=r.end(i))return!0}catch(t){}return!1},bufferInfo:function(t,e,r){try{if(t){var i,a=t.buffered,n=[];for(i=0;i<a.length;i++)n.push({start:a.start(i),end:a.end(i)});return this.bufferedInfo(n,e,r)}}catch(t){}return{len:0,start:e,end:e,nextStart:void 0}},bufferedInfo:function(t,e,r){var i,a,n,o,s,l=[];for(t.sort(function(t,e){var r=t.start-e.start;return r||e.end-t.end}),s=0;s<t.length;s++){var u=l.length;if(u){var d=l[u-1].end;t[s].start-d<r?t[s].end>d&&(l[u-1].end=t[s].end):l.push(t[s])}else l.push(t[s])}for(s=0,i=0,a=n=e;s<l.length;s++){var h=l[s].start,c=l[s].end;if(e+r>=h&&e<c)a=h,n=c,i=n-e;else if(e+r<h){o=h;break}}return{len:i,start:a,end:n,nextStart:o}}},ae=ie,ne=r(7),oe=r(5),se=r.n(oe),le=r(9),ue=r.n(le),de=y(),he=function(){function t(e,r){m(this,t),this.hls=e,this.id=r;var i=this.observer=new se.a,a=e.config;i.trigger=function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),a=1;a<e;a++)r[a-1]=arguments[a];i.emit.apply(i,[t,t].concat(r))},i.off=function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),a=1;a<e;a++)r[a-1]=arguments[a];i.removeListener.apply(i,[t].concat(r))};var n=function(t,r){r=r||{},r.frag=this.frag,r.id=this.id,e.trigger(t,r)}.bind(this);i.on(Ot.a.FRAG_DECRYPTED,n),i.on(Ot.a.FRAG_PARSING_INIT_SEGMENT,n),i.on(Ot.a.FRAG_PARSING_DATA,n),i.on(Ot.a.FRAG_PARSED,n),i.on(Ot.a.ERROR,n),i.on(Ot.a.FRAG_PARSING_METADATA,n),i.on(Ot.a.FRAG_PARSING_USERDATA,n),i.on(Ot.a.INIT_PTS_FOUND,n);var o={mp4:de.isTypeSupported("video/mp4"),mpeg:de.isTypeSupported("audio/mpeg"),mp3:de.isTypeSupported('audio/mp4; codecs="mp3"')},s=navigator.vendor;if(a.enableWorker&&"undefined"!=typeof Worker){Pt.b.log("demuxing in webworker");var l=void 0;try{l=this.w=ue()(10),this.onwmsg=this.onWorkerMessage.bind(this),l.addEventListener("message",this.onwmsg),l.onerror=function(t){e.trigger(Ot.a.ERROR,{type:Ct.b.OTHER_ERROR,details:Ct.a.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:t.message+" ("+t.filename+":"+t.lineno+")"}})},l.postMessage({cmd:"init",typeSupported:o,vendor:s,id:r,config:JSON.stringify(a)})}catch(t){Pt.b.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),l&&URL.revokeObjectURL(l.objectURL),this.demuxer=new ne.a(i,o,a,s),this.w=void 0}}else this.demuxer=new ne.a(i,o,a,s)}return t.prototype.destroy=function(){var t=this.w;if(t)t.removeEventListener("message",this.onwmsg),t.terminate(),this.w=null;else{var e=this.demuxer;e&&(e.destroy(),this.demuxer=null)}var r=this.observer;r&&(r.removeAllListeners(),this.observer=null)},t.prototype.push=function(t,e,r,i,a,n,o,s){var l=this.w,u=isNaN(a.startDTS)?a.start:a.startDTS,d=a.decryptdata,h=this.frag,c=!(h&&a.cc===h.cc),f=!(h&&a.level===h.level),p=h&&a.sn===h.sn+1,g=!f&&p;if(c&&Pt.b.log(this.id+":discontinuity detected"),f&&Pt.b.log(this.id+":switch detected"),this.frag=a,l)l.postMessage({cmd:"demux",data:t,decryptdata:d,initSegment:e,audioCodec:r,videoCodec:i,timeOffset:u,discontinuity:c,trackSwitch:f,contiguous:g,duration:n,accurateTimeOffset:o,defaultInitPTS:s},t instanceof ArrayBuffer?[t]:[]);else{var v=this.demuxer;v&&v.push(t,d,e,r,i,u,c,f,g,n,o,s)}},t.prototype.onWorkerMessage=function(t){var e=t.data,r=this.hls;switch(e.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case Ot.a.FRAG_PARSING_DATA:e.data.data1=new Uint8Array(e.data1),e.data2&&(e.data.data2=new Uint8Array(e.data2));default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,r.trigger(e.event,e.data)}},t}(),ce=he,fe={toString:function(t){for(var e="",r=t.length,i=0;i<r;i++)e+="["+t.start(i).toFixed(3)+","+t.end(i).toFixed(3)+"]";return e}},pe=fe,ge=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),ve={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},ye=function(t){function e(r){D(this,e);var i=I(this,t.call(this,r,Ot.a.MEDIA_ATTACHED,Ot.a.MEDIA_DETACHING,Ot.a.MANIFEST_LOADING,Ot.a.MANIFEST_PARSED,Ot.a.LEVEL_LOADED,Ot.a.KEY_LOADED,Ot.a.FRAG_LOADED,Ot.a.FRAG_LOAD_EMERGENCY_ABORTED,Ot.a.FRAG_PARSING_INIT_SEGMENT,Ot.a.FRAG_PARSING_DATA,Ot.a.FRAG_PARSED,Ot.a.ERROR,Ot.a.AUDIO_TRACK_SWITCHING,Ot.a.AUDIO_TRACK_SWITCHED,Ot.a.BUFFER_CREATED,Ot.a.BUFFER_APPENDED,Ot.a.BUFFER_FLUSHED));return i.config=r.config,i.audioCodecSwap=!1,i.ticks=0,i._state=ve.STOPPED,i.ontick=i.tick.bind(i),i}return k(e,t),e.prototype.destroy=function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),Nt.prototype.destroy.call(this),this.state=ve.STOPPED},e.prototype.startLoad=function(t){if(this.levels){var e=this.lastCurrentTime,r=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var i=r.startLevel;-1===i&&(i=0,this.bitrateTest=!0),this.level=r.nextLoadLevel=i,this.loadedmetadata=!1}e>0&&-1===t&&(Pt.b.log("override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e),this.state=ve.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this.forceStartLoad=!0,this.state=ve.STOPPED},e.prototype.stopLoad=function(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=ve.STOPPED,this.forceStartLoad=!1},e.prototype.tick=function(){1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)},e.prototype.doTick=function(){switch(this.state){case ve.ERROR:break;case ve.BUFFER_FLUSHING:this.fragLoadError=0;break;case ve.IDLE:this._doTickIdle();break;case ve.WAITING_LEVEL:var t=this.levels[this.level];t&&t.details&&(this.state=ve.IDLE);break;case ve.FRAG_LOADING_WAITING_RETRY:var e=performance.now(),r=this.retryDate;(!r||e>=r||this.media&&this.media.seeking)&&(Pt.b.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=ve.IDLE);break;case ve.ERROR:case ve.STOPPED:case ve.FRAG_LOADING:case ve.PARSING:case ve.PARSED:case ve.ENDED:}this._checkBuffer(),this._checkFragmentChanged()},e.prototype._doTickIdle=function(){var t=this.hls,e=t.config,r=this.media;if(void 0!==this.levelLastLoaded&&(r||!this.startFragRequested&&e.startFragPrefetch)){var i=void 0;i=this.loadedmetadata?r.currentTime:this.nextLoadPosition;var a=t.nextLoadLevel,n=this.levels[a];if(n){var o=n.bitrate,s=void 0;s=o?Math.max(8*e.maxBufferSize/o,e.maxBufferLength):e.maxBufferLength,s=Math.min(s,e.maxMaxBufferLength);var l=ae.bufferInfo(this.mediaBuffer?this.mediaBuffer:r,i,e.maxBufferHole),u=l.len;if(!(u>=s)){Pt.b.trace("buffer length of "+u.toFixed(3)+" is below max of "+s.toFixed(3)+". checking for more payload ..."),this.level=t.nextLoadLevel=a;var d=n.details;if(void 0===d||!0===d.live&&this.levelLastLoaded!==a)return void(this.state=ve.WAITING_LEVEL);var h=this.fragPrevious;if(!d.live&&h&&!h.backtracked&&h.sn===d.endSN&&!l.nextStart){if(Math.min(r.duration,h.start+h.duration)-Math.max(l.end,h.start)<=Math.max(.2,h.duration)){var c={};return this.altAudio&&(c.type="video"),this.hls.trigger(Ot.a.BUFFER_EOS,c),void(this.state=ve.ENDED)}}this._fetchPayloadOrEos(i,l,d)}}}},e.prototype._fetchPayloadOrEos=function(t,e,r){var i=this.fragPrevious,a=this.level,n=r.fragments,o=n.length;if(0!==o){var s=n[0].start,l=n[o-1].start+n[o-1].duration,u=e.end,d=void 0;if(r.initSegment&&!r.initSegment.data)d=r.initSegment;else if(r.live){var h=this.config.initialLiveManifestSize;if(o<h)return void Pt.b.warn("Can not start playback of a level, reason: not enough fragments "+o+" < "+h);if(null===(d=this._ensureFragmentAtLivePoint(r,u,s,l,i,n,o)))return}else u<s&&(d=n[0]);d||(d=this._findFragment(s,i,o,n,u,l,r)),d&&this._loadFragmentOrKey(d,a,r,t,u)}},e.prototype._ensureFragmentAtLivePoint=function(t,e,r,i,a,n,o){var s=this.hls.config,l=this.media,u=void 0,d=void 0!==s.liveMaxLatencyDuration?s.liveMaxLatencyDuration:s.liveMaxLatencyDurationCount*t.targetduration;if(e<Math.max(r-s.maxFragLookUpTolerance,i-d)){var h=this.liveSyncPosition=this.computeLivePosition(r,t);Pt.b.log("buffer end: "+e.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+h.toFixed(3)),e=h,l&&l.readyState&&l.duration>h&&(l.currentTime=h),this.nextLoadPosition=h}if(t.PTSKnown&&e>i&&l&&l.readyState)return null;if(this.startFragRequested&&!t.PTSKnown){if(a){var c=a.sn+1;if(c>=t.startSN&&c<=t.endSN){var f=n[c-t.startSN];a.cc===f.cc&&(u=f,Pt.b.log("live playlist, switching playlist, load frag with next SN: "+u.sn))}u||(u=re.search(n,function(t){return a.cc-t.cc}))&&Pt.b.log("live playlist, switching playlist, load frag with same CC: "+u.sn)}u||(u=n[Math.min(o-1,Math.round(o/2))],Pt.b.log("live playlist, switching playlist, unknown, load middle frag : "+u.sn))}return u},e.prototype._findFragment=function(t,e,r,i,a,n,o){var s=this.hls.config,l=void 0,u=void 0,d=s.maxFragLookUpTolerance,h=e?i[e.sn-i[0].sn+1]:void 0,c=function(t){var e=Math.min(d,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-e<=a?1:t.start-e>a&&t.start?-1:0};if(a<n?(a>n-d&&(d=0),u=h&&!c(h)?h:re.search(i,c)):u=i[r-1],u){l=u;var f=l.sn-o.startSN,p=e&&l.level===e.level,g=i[f-1],v=i[f+1];if(e&&l.sn===e.sn)if(p&&!l.backtracked)if(l.sn<o.endSN){var y=e.deltaPTS;y&&y>s.maxBufferHole&&e.dropped&&f?(l=g,Pt.b.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),e.loadCounter--):(l=v,Pt.b.log("SN just loaded, load next one: "+l.sn))}else l=null;else l.backtracked&&(v&&v.backtracked?(Pt.b.warn("Already backtracked from fragment "+v.sn+", will not backtrack to fragment "+l.sn+". Loading fragment "+v.sn),l=v):(Pt.b.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),l.dropped=0,g?(g.loadCounter&&g.loadCounter--,l=g,l.backtracked=!0):f&&(l=null)))}return l},e.prototype._loadFragmentOrKey=function(t,e,r,i,a){var n=this.hls,o=n.config;if(!t.decryptdata||null==t.decryptdata.uri||null!=t.decryptdata.key){if(Pt.b.log("Loading "+t.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+e+", currentTime:"+i.toFixed(3)+",bufferEnd:"+a.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,t.loadCounter){t.loadCounter++;var s=o.fragLoadingLoopThreshold;if(t.loadCounter>s&&Math.abs(this.fragLoadIdx-t.loadIdx)<s)return void n.trigger(Ot.a.ERROR,{type:Ct.b.MEDIA_ERROR,details:Ct.a.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:t})}else t.loadCounter=1;return t.loadIdx=this.fragLoadIdx,t.autoLevel=n.autoLevelEnabled,t.bitrateTest=this.bitrateTest,this.fragCurrent=t,this.startFragRequested=!0,isNaN(t.sn)||t.bitrateTest||(this.nextLoadPosition=t.start+t.duration),n.trigger(Ot.a.FRAG_LOADING,{frag:t}),this.demuxer||(this.demuxer=new ce(n,"main")),void(this.state=ve.FRAG_LOADING)}Pt.b.log("Loading key for "+t.sn+" of ["+r.startSN+" ,"+r.endSN+"],level "+e),this.state=ve.KEY_LOADING,n.trigger(Ot.a.KEY_LOADING,{frag:t})},e.prototype.getBufferedFrag=function(t){return re.search(this._bufferedFrags,function(e){return t<e.startPTS?-1:t>e.endPTS?1:0})},e.prototype.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.endPTS+.5):null},e.prototype._checkFragmentChanged=function(){var t,e,r=this.media;if(r&&r.readyState&&!1===r.seeking&&(e=r.currentTime,e>r.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=e),ae.isBuffered(r,e)?t=this.getBufferedFrag(e):ae.isBuffered(r,e+.1)&&(t=this.getBufferedFrag(e+.1)),t)){var i=t;if(i!==this.fragPlaying){this.hls.trigger(Ot.a.FRAG_CHANGED,{frag:i});var a=i.level;this.fragPlaying&&this.fragPlaying.level===a||this.hls.trigger(Ot.a.LEVEL_SWITCHED,{level:a}),this.fragPlaying=i}}},e.prototype.immediateLevelSwitch=function(){if(Pt.b.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var t=this.media,e=void 0;t?(e=t.paused,t.pause()):e=!0,this.previouslyPaused=e}var r=this.fragCurrent;r&&r.loader&&r.loader.abort(),this.fragCurrent=null,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},e.prototype.immediateLevelSwitchEnd=function(){var t=this.media;t&&t.buffered.length&&(this.immediateSwitch=!1,ae.isBuffered(t,t.currentTime)&&(t.currentTime-=1e-4),this.previouslyPaused||t.play())},e.prototype.nextLevelSwitch=function(){var t=this.media;if(t&&t.readyState){var e=void 0,r=void 0,i=void 0;if(void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),r=this.getBufferedFrag(t.currentTime),r&&r.startPTS>1&&this.flushMainBuffer(0,r.startPTS-1),t.paused)e=0;else{var a=this.hls.nextLoadLevel,n=this.levels[a],o=this.fragLastKbps;e=o&&this.fragCurrent?this.fragCurrent.duration*n.bitrate/(1e3*o)+1:0}if((i=this.getBufferedFrag(t.currentTime+e))&&(i=this.followingBufferedFrag(i))){var s=this.fragCurrent;s&&s.loader&&s.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(i.maxStartPTS,Number.POSITIVE_INFINITY)}}},e.prototype.flushMainBuffer=function(t,e){this.state=ve.BUFFER_FLUSHING;var r={startOffset:t,endOffset:e};this.altAudio&&(r.type="video"),this.hls.trigger(Ot.a.BUFFER_FLUSHING,r)},e.prototype.onMediaAttached=function(t){var e=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("seeked",this.onvseeked),e.addEventListener("ended",this.onvended);var r=this.config;this.levels&&r.autoStartLoad&&this.hls.startLoad(r.startPosition)},e.prototype.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(Pt.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var e=this.levels;e&&e.forEach(function(t){t.details&&t.details.fragments.forEach(function(t){t.loadCounter=void 0,t.backtracked=void 0})}),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("seeked",this.onvseeked),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},e.prototype.onMediaSeeking=function(){var t=this.media,e=t?t.currentTime:void 0,r=this.config;isNaN(e)||Pt.b.log("media seeking to "+e.toFixed(3));var i=this.mediaBuffer?this.mediaBuffer:t,a=ae.bufferInfo(i,e,this.config.maxBufferHole);if(this.state===ve.FRAG_LOADING){var n=this.fragCurrent;if(0===a.len&&n){var o=r.maxFragLookUpTolerance,s=n.start-o,l=n.start+n.duration+o;e<s||e>l?(n.loader&&(Pt.b.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),n.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=ve.IDLE):Pt.b.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===ve.ENDED&&(0===a.len&&(this.fragPrevious=0),this.state=ve.IDLE);t&&(this.lastCurrentTime=e),this.state!==ve.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*r.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=e),this.tick()},e.prototype.onMediaSeeked=function(){var t=this.media,e=t?t.currentTime:void 0;isNaN(e)||Pt.b.log("media seeked to "+e.toFixed(3)),this.tick()},e.prototype.onMediaEnded=function(){Pt.b.log("media ended"),this.startPosition=this.lastCurrentTime=0},e.prototype.onManifestLoading=function(){Pt.b.log("trigger BUFFER_RESET"),this.hls.trigger(Ot.a.BUFFER_RESET),this._bufferedFrags=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0},e.prototype.onManifestParsed=function(t){var e,r=!1,i=!1;t.levels.forEach(function(t){(e=t.audioCodec)&&(-1!==e.indexOf("mp4a.40.2")&&(r=!0),-1!==e.indexOf("mp4a.40.5")&&(i=!0))}),this.audioCodecSwitch=r&&i,this.audioCodecSwitch&&Pt.b.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1;var a=this.config;(a.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(a.startPosition)},e.prototype.onLevelLoaded=function(t){var e=t.details,r=t.level,i=this.levels[this.levelLastLoaded],a=this.levels[r],n=e.totalduration,o=0;if(Pt.b.log("level "+r+" loaded ["+e.startSN+","+e.endSN+"],duration:"+n),e.live){var s=a.details;s&&e.fragments.length>0?(T(s,e),o=e.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(o,s),e.PTSKnown&&!isNaN(o)?Pt.b.log("live playlist sliding:"+o.toFixed(3)):(Pt.b.log("live playlist - outdated PTS, unknown sliding"),w(this.fragPrevious,i,e))):(Pt.b.log("live playlist - first load, unknown sliding"),e.PTSKnown=!1,w(this.fragPrevious,i,e))}else e.PTSKnown=!1;if(a.details=e,this.levelLastLoaded=r,this.hls.trigger(Ot.a.LEVEL_UPDATED,{details:e,level:r}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var l=e.startTimeOffset;isNaN(l)?e.live?(this.startPosition=this.computeLivePosition(o,e),Pt.b.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(l<0&&(Pt.b.log("negative start time offset "+l+", count from end of last fragment"),l=o+n+l),Pt.b.log("start time offset found in playlist, adjust startPosition to "+l),this.startPosition=l),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===ve.WAITING_LEVEL&&(this.state=ve.IDLE),this.tick()},e.prototype.onKeyLoaded=function(){this.state===ve.KEY_LOADING&&(this.state=ve.IDLE,this.tick())},e.prototype.onFragLoaded=function(t){var e=this.fragCurrent,r=t.frag;if(this.state===ve.FRAG_LOADING&&e&&"main"===r.type&&r.level===e.level&&r.sn===e.sn){var i=t.stats,a=this.levels[e.level],n=a.details;if(Pt.b.log("Loaded  "+e.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+e.level),this.bitrateTest=!1,this.stats=i,!0===r.bitrateTest&&this.hls.nextLoadLevel)this.state=ve.IDLE,this.startFragRequested=!1,i.tparsed=i.tbuffered=performance.now(),this.hls.trigger(Ot.a.FRAG_BUFFERED,{stats:i,frag:e,id:"main"}),this.tick();else if("initSegment"===r.sn)this.state=ve.IDLE,i.tparsed=i.tbuffered=performance.now(),n.initSegment.data=t.payload,this.hls.trigger(Ot.a.FRAG_BUFFERED,{stats:i,frag:e,id:"main"}),this.tick();else{this.state=ve.PARSING;var o=n.totalduration,s=e.level,l=e.sn,u=this.config.defaultAudioCodec||a.audioCodec;this.audioCodecSwap&&(Pt.b.log("swapping playlist audio codec"),void 0===u&&(u=this.lastAudioCodec),u&&(u=-1!==u.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,Pt.b.log("Parsing "+l+" of ["+n.startSN+" ,"+n.endSN+"],level "+s+", cc "+e.cc);var d=this.demuxer;d||(d=this.demuxer=new ce(this.hls,"main"));var h=this.media,c=h&&h.seeking,f=!c&&(n.PTSKnown||!n.live),p=n.initSegment?n.initSegment.data:[];d.push(t.payload,p,u,a.videoCodec,e,o,f,void 0)}}this.fragLoadError=0},e.prototype.onFragParsingInitSegment=function(t){var e=this.fragCurrent,r=t.frag;if(e&&"main"===t.id&&r.sn===e.sn&&r.level===e.level&&this.state===ve.PARSING){var i,a,n=t.tracks;if(n.audio&&this.altAudio&&delete n.audio,a=n.audio){var o=this.levels[this.level].audioCodec,s=navigator.userAgent.toLowerCase();o&&this.audioCodecSwap&&(Pt.b.log("swapping playlist audio codec"),o=-1!==o.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==a.metadata.channelCount&&-1===s.indexOf("firefox")&&(o="mp4a.40.5"),-1!==s.indexOf("android")&&"audio/mpeg"!==a.container&&(o="mp4a.40.2",Pt.b.log("Android: force audio codec to "+o)),a.levelCodec=o,a.id=t.id}a=n.video,a&&(a.levelCodec=this.levels[this.level].videoCodec,a.id=t.id),this.hls.trigger(Ot.a.BUFFER_CODECS,n);for(i in n){a=n[i],Pt.b.log("main track:"+i+",container:"+a.container+",codecs[level/parsed]=["+a.levelCodec+"/"+a.codec+"]");var l=a.initSegment;l&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(Ot.a.BUFFER_APPENDING,{type:i,data:l,parent:"main",content:"initSegment"}))}this.tick()}},e.prototype.onFragParsingData=function(t){var e=this,r=this.fragCurrent,i=t.frag;if(r&&"main"===t.id&&i.sn===r.sn&&i.level===r.level&&("audio"!==t.type||!this.altAudio)&&this.state===ve.PARSING){var a=this.levels[this.level],n=r;if(isNaN(t.endPTS)&&(t.endPTS=t.startPTS+r.duration,t.endDTS=t.startDTS+r.duration),Pt.b.log("Parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb+",dropped:"+(t.dropped||0)),"video"===t.type)if(n.dropped=t.dropped,n.dropped)if(n.backtracked)Pt.b.warn("Already backtracked on this fragment, appending with the gap");else{var o=a.details;if(!o||n.sn!==o.startSN)return Pt.b.warn("missing video frame(s), backtracking fragment"),n.backtracked=!0,this.nextLoadPosition=t.startPTS,this.state=ve.IDLE,this.fragPrevious=n,void this.tick();Pt.b.warn("missing video frame(s) on first frag, appending with gap")}else n.backtracked=!1;var s=E(a.details,n,t.startPTS,t.endPTS,t.startDTS,t.endDTS),l=this.hls;l.trigger(Ot.a.LEVEL_PTS_UPDATED,{details:a.details,level:this.level,drift:s,type:t.type,start:t.startPTS,end:t.endPTS}),[t.data1,t.data2].forEach(function(r){r&&r.length&&e.state===ve.PARSING&&(e.appended=!0,e.pendingBuffering=!0,l.trigger(Ot.a.BUFFER_APPENDING,{type:t.type,data:r,parent:"main",content:"data"}))}),this.tick()}},e.prototype.onFragParsed=function(t){var e=this.fragCurrent,r=t.frag;e&&"main"===t.id&&r.sn===e.sn&&r.level===e.level&&this.state===ve.PARSING&&(this.stats.tparsed=performance.now(),this.state=ve.PARSED,this._checkAppendedParsed())},e.prototype.onAudioTrackSwitching=function(t){var e=!!t.url,r=t.id;if(!e){if(this.mediaBuffer!==this.media){Pt.b.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var i=this.fragCurrent;i.loader&&(Pt.b.log("switching to main audio track, cancel main fragment load"),i.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=ve.IDLE}var a=this.hls;a.trigger(Ot.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),a.trigger(Ot.a.AUDIO_TRACK_SWITCHED,{id:r}),this.altAudio=!1}},e.prototype.onAudioTrackSwitched=function(t){var e=t.id,r=!!this.hls.audioTracks[e].url;if(r){var i=this.videoBuffer;i&&this.mediaBuffer!==i&&(Pt.b.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=r,this.tick()},e.prototype.onBufferCreated=function(t){var e=t.tracks,r=void 0,i=void 0,a=!1;for(var n in e){var o=e[n];"main"===o.id?(i=n,r=o,"video"===n&&(this.videoBuffer=e[n].buffer)):a=!0}a&&r?(Pt.b.log("alternate track found, use "+i+".buffered to schedule main fragment loading"),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media},e.prototype.onBufferAppended=function(t){if("main"===t.parent){var e=this.state;e!==ve.PARSING&&e!==ve.PARSED||(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}},e.prototype._checkAppendedParsed=function(){if(!(this.state!==ve.PARSED||this.appended&&this.pendingBuffering)){var t=this.fragCurrent;if(t){var e=this.mediaBuffer?this.mediaBuffer:this.media;Pt.b.log("main buffered : "+pe.toString(e.buffered));var r=this._bufferedFrags.filter(function(t){return ae.isBuffered(e,(t.startPTS+t.endPTS)/2)});r.push(t),this._bufferedFrags=r.sort(function(t,e){return t.startPTS-e.startPTS}),this.fragPrevious=t;var i=this.stats;i.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*i.total/(i.tbuffered-i.tfirst)),this.hls.trigger(Ot.a.FRAG_BUFFERED,{stats:i,frag:t,id:"main"}),this.state=ve.IDLE}this.tick()}},e.prototype.onError=function(t){var e=t.frag||this.fragCurrent;if(!e||"main"===e.type){var r=!!this.media&&ae.isBuffered(this.media,this.media.currentTime)&&ae.isBuffered(this.media,this.media.currentTime+.5);switch(t.details){case Ct.a.FRAG_LOAD_ERROR:case Ct.a.FRAG_LOAD_TIMEOUT:case Ct.a.KEY_LOAD_ERROR:case Ct.a.KEY_LOAD_TIMEOUT:if(!t.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var i=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);e.loadCounter=0,Pt.b.warn("mediaController: frag loading failed, retry in "+i+" ms"),this.retryDate=performance.now()+i,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=ve.FRAG_LOADING_WAITING_RETRY}else Pt.b.error("mediaController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=ve.ERROR;break;case Ct.a.FRAG_LOOP_LOADING_ERROR:t.fatal||(r?(this._reduceMaxBufferLength(e.duration),this.state=ve.IDLE):e.autoLevel&&0!==e.level||(t.fatal=!0,this.state=ve.ERROR));break;case Ct.a.LEVEL_LOAD_ERROR:case Ct.a.LEVEL_LOAD_TIMEOUT:this.state!==ve.ERROR&&(t.fatal?(this.state=ve.ERROR,Pt.b.warn("streamController: "+t.details+",switch to "+this.state+" state ...")):t.levelRetry||this.state!==ve.WAITING_LEVEL||(this.state=ve.IDLE));break;case Ct.a.BUFFER_FULL_ERROR:"main"!==t.parent||this.state!==ve.PARSING&&this.state!==ve.PARSED||(r?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=ve.IDLE):(Pt.b.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},e.prototype._reduceMaxBufferLength=function(t){var e=this.config;e.maxMaxBufferLength>=t&&(e.maxMaxBufferLength/=2,Pt.b.warn("main:reduce max buffer length to "+e.maxMaxBufferLength+"s"),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*e.fragLoadingLoopThreshold))},e.prototype._checkBuffer=function(){var t=this.media,e=this.config;if(t&&t.readyState){var r=t.currentTime,i=this.mediaBuffer?this.mediaBuffer:t,a=i.buffered;if(!this.loadedmetadata&&a.length){this.loadedmetadata=!0;var n=t.seeking?r:this.startPosition,o=ae.isBuffered(i,n),s=a.start(0),l=!o&&Math.abs(n-s)<e.maxSeekHole;(r!==n||l)&&(Pt.b.log("target start position:"+n),l&&(n=s,Pt.b.log("target start position not buffered, seek to buffered.start(0) "+n)),Pt.b.log("adjust currentTime from "+r+" to "+n),t.currentTime=n)}else if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var u=ae.bufferInfo(t,r,0),d=!(t.paused||t.ended||0===t.buffered.length),h=r!==this.lastCurrentTime;if(h)this.stallReported&&(Pt.b.warn("playback not stuck anymore @"+r+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0;else if(d){var c=performance.now(),f=this.hls;if(this.stalled){var p=c-this.stalled,g=u.len,v=this.nudgeRetry||0;if(g<=.5&&p>1e3*e.lowBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,Pt.b.warn("playback stalling in low buffer @"+r),f.trigger(Ot.a.ERROR,{type:Ct.b.MEDIA_ERROR,details:Ct.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:g}));var y=u.nextStart,m=y-r;if(y&&m<e.maxSeekHole&&m>0){this.nudgeRetry=++v;var b=v*e.nudgeOffset;Pt.b.log("adjust currentTime from "+t.currentTime+" to next buffered @ "+y+" + nudge "+b),t.currentTime=y+b,this.stalled=void 0,f.trigger(Ot.a.ERROR,{type:Ct.b.MEDIA_ERROR,details:Ct.a.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:y+b-r})}}else if(g>.5&&p>1e3*e.highBufferWatchdogPeriod)if(this.stallReported||(this.stallReported=!0,Pt.b.warn("playback stalling in high buffer @"+r),f.trigger(Ot.a.ERROR,{type:Ct.b.MEDIA_ERROR,details:Ct.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:g})),this.stalled=void 0,this.nudgeRetry=++v,v<e.nudgeMaxRetry){var E=t.currentTime,T=E+v*e.nudgeOffset;Pt.b.log("adjust currentTime from "+E+" to "+T),t.currentTime=T,f.trigger(Ot.a.ERROR,{type:Ct.b.MEDIA_ERROR,details:Ct.a.BUFFER_NUDGE_ON_STALL,fatal:!1})}else Pt.b.error("still stuck in high buffer @"+r+" after "+e.nudgeMaxRetry+", raise fatal error"),f.trigger(Ot.a.ERROR,{type:Ct.b.MEDIA_ERROR,details:Ct.a.BUFFER_STALLED_ERROR,fatal:!0})}else this.stalled=c,this.stallReported=!1}}}},e.prototype.onFragLoadEmergencyAborted=function(){this.state=ve.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},e.prototype.onBufferFlushed=function(){var t=this.mediaBuffer?this.mediaBuffer:this.media;this._bufferedFrags=this._bufferedFrags.filter(function(e){return ae.isBuffered(t,(e.startPTS+e.endPTS)/2)}),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.state=ve.IDLE,this.fragPrevious=null},e.prototype.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},e.prototype.computeLivePosition=function(t,e){var r=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*e.targetduration;return t+Math.max(0,e.totalduration-r)},ge(e,[{key:"state",set:function(t){if(this.state!==t){var e=this.state;this._state=t,Pt.b.log("main stream:"+e+"->"+t),this.hls.trigger(Ot.a.STREAM_STATE_TRANSITION,{previousState:e,nextState:t})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var t=this.media;if(t){var e=this.getBufferedFrag(t.currentTime);if(e)return e.level}return-1}},{key:"nextBufferedFrag",get:function(){var t=this.media;return t?this.followingBufferedFrag(this.getBufferedFrag(t.currentTime)):null}},{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(t){this._liveSyncPosition=t}}]),e}(Nt),me=ye,be=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),Ee=function(t){function e(r){O(this,e);var i=C(this,t.call(this,r,Ot.a.MANIFEST_LOADED,Ot.a.LEVEL_LOADED,Ot.a.FRAG_LOADED,Ot.a.ERROR));return i.canload=!1,i.currentLevelIndex=null,i.manualLevelIndex=-1,i.timer=null,i}return P(e,t),e.prototype.destroy=function(){this.cleanTimer(),this.manualLevelIndex=-1},e.prototype.cleanTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},e.prototype.startLoad=function(){var t=this._levels;this.canload=!0,this.levelRetryCount=0,t&&t.forEach(function(t){t.loadError=0;var e=t.details;e&&e.live&&(t.details=void 0)}),null!==this.timer&&this.loadLevel()},e.prototype.stopLoad=function(){this.canload=!1},e.prototype.onManifestLoaded=function(t){var e=[],r=void 0,i={},a=null,n=!1,s=!1,l=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),u=[];if(t.levels.forEach(function(t){t.loadError=0,t.fragmentError=!1,n=n||!!t.videoCodec,s=s||!!t.audioCodec||!(!t.attrs||!t.attrs.AUDIO),!0===l&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0),a=i[t.bitrate],void 0===a?(t.url=[t.url],t.urlId=0,i[t.bitrate]=t,e.push(t)):a.url.push(t.url)}),!0===n&&!0===s&&(e=e.filter(function(t){return!!t.videoCodec})),e=e.filter(function(t){var e=t.audioCodec,r=t.videoCodec;return(!e||o(e))&&(!r||o(r))}),t.audioTracks&&(u=t.audioTracks.filter(function(t){return!t.audioCodec||o(t.audioCodec,"audio")})),e.length>0){r=e[0].bitrate,e.sort(function(t,e){return t.bitrate-e.bitrate}),this._levels=e;for(var d=0;d<e.length;d++)if(e[d].bitrate===r){this._firstLevel=d,Pt.b.log("manifest loaded,"+e.length+" level(s) found, first bitrate:"+r);break}this.hls.trigger(Ot.a.MANIFEST_PARSED,{levels:e,audioTracks:u,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:n,altAudio:u.length>0})}else this.hls.trigger(Ot.a.ERROR,{type:Ct.b.MEDIA_ERROR,details:Ct.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},e.prototype.setLevelInternal=function(t){var e=this._levels,r=this.hls;if(t>=0&&t<e.length){if(this.cleanTimer(),this.currentLevelIndex!==t){Pt.b.log("switching to level "+t),this.currentLevelIndex=t;var i=e[t];i.level=t,r.trigger(Ot.a.LEVEL_SWITCH,i),r.trigger(Ot.a.LEVEL_SWITCHING,i)}var a=e[t],n=a.details;if(!n||!0===n.live){var o=a.urlId;r.trigger(Ot.a.LEVEL_LOADING,{url:a.url[o],level:t,id:o})}}else r.trigger(Ot.a.ERROR,{type:Ct.b.OTHER_ERROR,details:Ct.a.LEVEL_SWITCH_ERROR,level:t,fatal:!1,reason:"invalid level idx"})},e.prototype.onError=function(t){if(!0===t.fatal)return void(t.type===Ct.b.NETWORK_ERROR&&this.cleanTimer());var e=!1,r=!1,i=void 0;switch(t.details){case Ct.a.FRAG_LOAD_ERROR:case Ct.a.FRAG_LOAD_TIMEOUT:case Ct.a.FRAG_LOOP_LOADING_ERROR:case Ct.a.KEY_LOAD_ERROR:case Ct.a.KEY_LOAD_TIMEOUT:i=t.frag.level,r=!0;break;case Ct.a.LEVEL_LOAD_ERROR:case Ct.a.LEVEL_LOAD_TIMEOUT:i=t.context.level,e=!0;break;case Ct.a.REMUX_ALLOC_ERROR:i=t.level,e=!0}void 0!==i&&this.recoverLevel(t,i,e,r)},e.prototype.recoverLevel=function(t,e,r,i){var a=this,n=this.hls.config,o=t.details,s=this._levels[e],l=void 0,u=void 0,d=void 0;if(s.loadError++,s.fragmentError=i,!0===r){if(!(this.levelRetryCount+1<=n.levelLoadingMaxRetry))return Pt.b.error("level controller, cannot recover from "+o+" error"),this.currentLevelIndex=null,this.cleanTimer(),void(t.fatal=!0);u=Math.min(Math.pow(2,this.levelRetryCount)*n.levelLoadingRetryDelay,n.levelLoadingMaxRetryTimeout),this.timer=setTimeout(function(){return a.loadLevel()},u),t.levelRetry=!0,this.levelRetryCount++,Pt.b.warn("level controller, "+o+", retry in "+u+" ms, current retry count is "+this.levelRetryCount)}!0!==r&&!0!==i||(l=s.url.length,l>1&&s.loadError<l?(Pt.b.warn("level controller, "+o+" for level "+e+": switching to redundant stream id "+s.urlId),s.urlId=(s.urlId+1)%l,s.details=void 0):-1===this.manualLevelIndex?(d=0===e?this._levels.length-1:e-1,Pt.b.warn("level controller, "+o+": switch to "+d),this.hls.nextAutoLevel=this.currentLevelIndex=d):!0===i&&(Pt.b.warn("level controller, "+o+": reload a fragment"),this.currentLevelIndex=null))},e.prototype.onFragLoaded=function(t){var e=t.frag;if(void 0!==e&&"main"===e.type){var r=this._levels[e.level];void 0!==r&&(r.fragmentError=!1,r.loadError=0,this.levelRetryCount=0)}},e.prototype.onLevelLoaded=function(t){var e=this,r=t.level;if(r===this.currentLevelIndex){var i=this._levels[r];!1===i.fragmentError&&(i.loadError=0,this.levelRetryCount=0);var a=t.details;if(a.live){var n=1e3*(a.averagetargetduration?a.averagetargetduration:a.targetduration),o=i.details;o&&a.endSN===o.endSN&&(n/=2,Pt.b.log("same live playlist, reload twice faster")),n-=performance.now()-t.stats.trequest,n=Math.max(1e3,Math.round(n)),Pt.b.log("live playlist, reload in "+n+" ms"),this.timer=setTimeout(function(){return e.loadLevel()},n)}else this.cleanTimer()}},e.prototype.loadLevel=function(){var t=void 0,e=void 0;null!==this.currentLevelIndex&&!0===this.canload&&void 0!==(t=this._levels[this.currentLevelIndex])&&t.url.length>0&&(e=t.urlId,this.hls.trigger(Ot.a.LEVEL_LOADING,{url:t.url[e],level:this.currentLevelIndex,id:e}))},be(e,[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var e=this._levels;e&&(t=Math.min(t,e.length-1),this.currentLevelIndex===t&&void 0!==e[t].details||this.setLevelInternal(t))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var t=this.hls.config.startLevel;return void 0!==t?t:this._firstLevel}return this._startLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}}]),e}(Nt),Te=Ee,Re=r(3),Ae=function(t){function e(r){x(this,e);var i=F(this,t.call(this,r,Ot.a.MEDIA_ATTACHED,Ot.a.MEDIA_DETACHING,Ot.a.FRAG_PARSING_METADATA));return i.id3Track=void 0,i.media=void 0,i}return N(e,t),e.prototype.destroy=function(){Nt.prototype.destroy.call(this)},e.prototype.onMediaAttached=function(t){this.media=t.media,this.media},e.prototype.onMediaDetaching=function(){this.media=void 0},e.prototype.onFragParsingMetadata=function(t){var e=t.frag,r=t.samples;this.id3Track||(this.id3Track=this.media.addTextTrack("metadata","id3"),this.id3Track.mode="hidden");for(var i=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,a=0;a<r.length;a++){var n=Re.a.getID3Frames(r[a].data);if(n){var o=r[a].pts,s=a<r.length-1?r[a+1].pts:e.endPTS;o===s&&(s+=1e-4);for(var l=0;l<n.length;l++){var u=n[l];if(!Re.a.isTimeStampFrame(u)){var d=new i(o,s,"");d.value=u,this.id3Track.addCue(d)}}}}},e}(Nt),Se=Ae,Le=function(){function t(e){U(this,t),this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=0,this.totalWeight_=0}return t.prototype.sample=function(t,e){var r=Math.pow(this.alpha_,t);this.estimate_=e*(1-r)+r*this.estimate_,this.totalWeight_+=t},t.prototype.getTotalWeight=function(){return this.totalWeight_},t.prototype.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/t}return this.estimate_},t}(),_e=Le,we=function(){function t(e,r,i,a){B(this,t),this.hls=e,this.defaultEstimate_=a,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new _e(r),this.fast_=new _e(i)}return t.prototype.sample=function(t,e){t=Math.max(t,this.minDelayMs_);var r=8e3*e/t,i=t/1e3;this.fast_.sample(i,r),this.slow_.sample(i,r)},t.prototype.canEstimate=function(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_},t.prototype.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.prototype.destroy=function(){},t}(),De=we,Ie=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),ke=function(t){function e(r){G(this,e);var i=j(this,t.call(this,r,Ot.a.FRAG_LOADING,Ot.a.FRAG_LOADED,Ot.a.FRAG_BUFFERED,Ot.a.ERROR));return i.lastLoadedFragLevel=0,i._nextAutoLevel=-1,i.hls=r,i.timer=null,i._bwEstimator=null,i.onCheck=i._abandonRulesCheck.bind(i),i}return H(e,t),e.prototype.destroy=function(){this.clearTimer(),Nt.prototype.destroy.call(this)},e.prototype.onFragLoading=function(t){var e=t.frag;if("main"===e.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this._bwEstimator){var r=this.hls,i=t.frag.level,a=r.levels[i].details.live,n=r.config,o=void 0,s=void 0;a?(o=n.abrEwmaFastLive,s=n.abrEwmaSlowLive):(o=n.abrEwmaFastVoD,s=n.abrEwmaSlowVoD),this._bwEstimator=new De(r,s,o,n.abrEwmaDefaultEstimate)}this.fragCurrent=e}},e.prototype._abandonRulesCheck=function(){var t=this.hls,e=t.media,r=this.fragCurrent,i=r.loader,a=t.minAutoLevel;if(!i||i.stats&&i.stats.aborted)return Pt.b.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var n=i.stats;if(e&&n&&(!e.paused&&0!==e.playbackRate||!e.readyState)&&r.autoLevel&&r.level){var o=performance.now()-n.trequest,s=Math.abs(e.playbackRate);if(o>500*r.duration/s){var l=t.levels,u=Math.max(1,n.bw?n.bw/8:1e3*n.loaded/o),d=l[r.level],h=d.realBitrate?Math.max(d.realBitrate,d.bitrate):d.bitrate,c=n.total?n.total:Math.max(n.loaded,Math.round(r.duration*h/8)),f=e.currentTime,p=(c-n.loaded)/u,g=(ae.bufferInfo(e,f,t.config.maxBufferHole).end-f)/s;if(g<2*r.duration/s&&p>g){var v=void 0,y=void 0;for(y=r.level-1;y>a;y--){var m=l[y].realBitrate?Math.max(l[y].realBitrate,l[y].bitrate):l[y].bitrate;if((v=r.duration*m/(6.4*u))<g)break}v<p&&(Pt.b.warn("loading too slow, abort fragment loading and switch to level "+y+":fragLoadedDelay["+y+"]<fragLoadedDelay["+(r.level-1)+"];bufferStarvationDelay:"+v.toFixed(1)+"<"+p.toFixed(1)+":"+g.toFixed(1)),t.nextLoadLevel=y,this._bwEstimator.sample(o,n.loaded),i.abort(),this.clearTimer(),t.trigger(Ot.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,stats:n}))}}}},e.prototype.onFragLoaded=function(t){var e=t.frag;if("main"===e.type&&!isNaN(e.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=e.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var r=this.hls.levels[e.level],i=(r.loaded?r.loaded.bytes:0)+t.stats.loaded,a=(r.loaded?r.loaded.duration:0)+t.frag.duration;r.loaded={bytes:i,duration:a},r.realBitrate=Math.round(8*i/a)}if(t.frag.bitrateTest){var n=t.stats;n.tparsed=n.tbuffered=n.tload,this.onFragBuffered(t)}}},e.prototype.onFragBuffered=function(t){var e=t.stats,r=t.frag;if(!(!0===e.aborted||1!==r.loadCounter||"main"!==r.type||isNaN(r.sn)||r.bitrateTest&&e.tload!==e.tbuffered)){var i=e.tparsed-e.trequest;Pt.b.log("latency/loading/parsing/append/kbps:"+Math.round(e.tfirst-e.trequest)+"/"+Math.round(e.tload-e.tfirst)+"/"+Math.round(e.tparsed-e.tload)+"/"+Math.round(e.tbuffered-e.tparsed)+"/"+Math.round(8*e.loaded/(e.tbuffered-e.trequest))),this._bwEstimator.sample(i,e.loaded),e.bwEstimate=this._bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=i/1e3:this.bitrateTestDelay=0}},e.prototype.onError=function(t){switch(t.details){case Ct.a.FRAG_LOAD_ERROR:case Ct.a.FRAG_LOAD_TIMEOUT:this.clearTimer()}},e.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null},e.prototype._findBestLevel=function(t,e,r,i,a,n,o,s,l){for(var u=a;u>=i;u--){var d=l[u],h=d.details,c=h?h.totalduration/h.fragments.length:e,f=!!h&&h.live,p=void 0;p=u<=t?o*r:s*r;var g=l[u].realBitrate?Math.max(l[u].realBitrate,l[u].bitrate):l[u].bitrate,v=g*c/p;if(Pt.b.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(p)+"/"+g+"/"+c+"/"+n+"/"+v),p>g&&(!v||f&&!this.bitrateTestDelay||v<n))return u}return-1},Ie(e,[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,e=this._bwEstimator;if(!(-1===t||e&&e.canEstimate()))return t;var r=this._nextABRAutoLevel;return-1!==t&&(r=Math.min(t,r)),r},set:function(t){this._nextAutoLevel=t}},{key:"_nextABRAutoLevel",get:function(){var t=this.hls,e=t.maxAutoLevel,r=t.levels,i=t.config,a=t.minAutoLevel,n=t.media,o=this.lastLoadedFragLevel,s=this.fragCurrent?this.fragCurrent.duration:0,l=n?n.currentTime:0,u=n&&0!==n.playbackRate?Math.abs(n.playbackRate):1,d=this._bwEstimator?this._bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,h=(ae.bufferInfo(n,l,i.maxBufferHole).end-l)/u,c=this._findBestLevel(o,s,d,a,e,h,i.abrBandWidthFactor,i.abrBandWidthUpFactor,r);if(c>=0)return c;Pt.b.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var f=s?Math.min(s,i.maxStarvationDelay):i.maxStarvationDelay,p=i.abrBandWidthFactor,g=i.abrBandWidthUpFactor;if(0===h){var v=this.bitrateTestDelay;if(v){f=(s?Math.min(s,i.maxLoadingDelay):i.maxLoadingDelay)-v,Pt.b.trace("bitrate test took "+Math.round(1e3*v)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*f)+" ms"),p=g=1}}return c=this._findBestLevel(o,s,d,a,e,h+f,p,g,r),Math.max(c,0)}}]),e}(Nt),Oe=ke,Ce=y(),Pe=function(t){function e(r){K(this,e);var i=W(this,t.call(this,r,Ot.a.MEDIA_ATTACHING,Ot.a.MEDIA_DETACHING,Ot.a.MANIFEST_PARSED,Ot.a.BUFFER_RESET,Ot.a.BUFFER_APPENDING,Ot.a.BUFFER_CODECS,Ot.a.BUFFER_EOS,Ot.a.BUFFER_FLUSHING,Ot.a.LEVEL_PTS_UPDATED,Ot.a.LEVEL_UPDATED));return i._msDuration=null,i._levelDuration=null,i._live=null,i._objectUrl=null,i.onsbue=i.onSBUpdateEnd.bind(i),i.onsbe=i.onSBUpdateError.bind(i),i.pendingTracks={},i.tracks={},i}return V(e,t),e.prototype.destroy=function(){Nt.prototype.destroy.call(this)},e.prototype.onLevelPtsUpdated=function(t){var e=t.type,r=this.tracks.audio;if("audio"===e&&r&&"audio/mpeg"===r.container){var i=this.sourceBuffer.audio;if(Math.abs(i.timestampOffset-t.start)>.1){var a=i.updating;try{i.abort()}catch(t){a=!0,Pt.b.warn("can not abort audio buffer: "+t)}a?this.audioTimestampOffset=t.start:(Pt.b.warn("change mpeg audio timestamp offset from "+i.timestampOffset+" to "+t.start),i.timestampOffset=t.start)}}},e.prototype.onManifestParsed=function(t){var e=t.audio,r=t.video||t.levels.length&&t.audio,i=0;t.altAudio&&(e||r)&&(i=(e?1:0)+(r?1:0),Pt.b.log(i+" sourceBuffer(s) expected")),this.sourceBufferNb=i},e.prototype.onMediaAttaching=function(t){var e=this.media=t.media;if(e){var r=this.mediaSource=new Ce;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),r.addEventListener("sourceopen",this.onmso),r.addEventListener("sourceended",this.onmse),r.addEventListener("sourceclose",this.onmsc),e.src=URL.createObjectURL(r),this._objectUrl=e.src}},e.prototype.onMediaDetaching=function(){Pt.b.log("media source detaching");var t=this.mediaSource;if(t){if("open"===t.readyState)try{t.endOfStream()}catch(t){Pt.b.warn("onMediaDetaching:"+t.message+" while calling endOfStream")}t.removeEventListener("sourceopen",this.onmso),t.removeEventListener("sourceended",this.onmse),t.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):Pt.b.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(Ot.a.MEDIA_DETACHED)},e.prototype.onMediaSourceOpen=function(){Pt.b.log("media source opened"),this.hls.trigger(Ot.a.MEDIA_ATTACHED,{media:this.media});var t=this.mediaSource;t&&t.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()},e.prototype.checkPendingTracks=function(){var t=this.pendingTracks,e=Object.keys(t).length;e&&(this.sourceBufferNb<=e||0===this.sourceBufferNb)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())},e.prototype.onMediaSourceClose=function(){Pt.b.log("media source closed")},e.prototype.onMediaSourceEnded=function(){Pt.b.log("media source ended")},e.prototype.onSBUpdateEnd=function(){if(this.audioTimestampOffset){var t=this.sourceBuffer.audio;Pt.b.warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+this.audioTimestampOffset),t.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var e=this.parent,r=this.segments.reduce(function(t,r){return r.parent===e?t+1:t},0);this.hls.trigger(Ot.a.BUFFER_APPENDED,{parent:e,pending:r}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()},e.prototype.onSBUpdateError=function(t){Pt.b.error("sourceBuffer error:",t),this.hls.trigger(Ot.a.ERROR,{type:Ct.b.MEDIA_ERROR,details:Ct.a.BUFFER_APPENDING_ERROR,fatal:!1})},e.prototype.onBufferReset=function(){var t=this.sourceBuffer;for(var e in t){var r=t[e];try{this.mediaSource.removeSourceBuffer(r),r.removeEventListener("updateend",this.onsbue),r.removeEventListener("error",this.onsbe)}catch(t){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},e.prototype.onBufferCodecs=function(t){if(0===Object.keys(this.sourceBuffer).length){for(var e in t)this.pendingTracks[e]=t[e];var r=this.mediaSource;r&&"open"===r.readyState&&this.checkPendingTracks()}},e.prototype.createSourceBuffers=function(t){var e=this.sourceBuffer,r=this.mediaSource;for(var i in t)if(!e[i]){var a=t[i],n=a.levelCodec||a.codec,o=a.container+";codecs="+n;Pt.b.log("creating sourceBuffer("+o+")");try{var s=e[i]=r.addSourceBuffer(o);s.addEventListener("updateend",this.onsbue),s.addEventListener("error",this.onsbe),this.tracks[i]={codec:n,container:a.container},a.buffer=s}catch(t){Pt.b.error("error while trying to add sourceBuffer:"+t.message),this.hls.trigger(Ot.a.ERROR,{type:Ct.b.MEDIA_ERROR,details:Ct.a.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:t,mimeType:o})}}this.hls.trigger(Ot.a.BUFFER_CREATED,{tracks:t})},e.prototype.onBufferAppending=function(t){this._needsFlush||(this.segments?this.segments.push(t):this.segments=[t],this.doAppending())},e.prototype.onBufferAppendFail=function(t){Pt.b.error("sourceBuffer error:",t.event),this.hls.trigger(Ot.a.ERROR,{type:Ct.b.MEDIA_ERROR,details:Ct.a.BUFFER_APPENDING_ERROR,fatal:!1})},e.prototype.onBufferEos=function(t){var e=this.sourceBuffer,r=t.type;for(var i in e)r&&i!==r||e[i].ended||(e[i].ended=!0,Pt.b.log(i+" sourceBuffer now EOS"));this.checkEos()},e.prototype.checkEos=function(){var t=this.sourceBuffer,e=this.mediaSource;if(!e||"open"!==e.readyState)return void(this._needsEos=!1);for(var r in t){var i=t[r];if(!i.ended)return;if(i.updating)return void(this._needsEos=!0)}Pt.b.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{e.endOfStream()}catch(t){Pt.b.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1},e.prototype.onBufferFlushing=function(t){this.flushRange.push({start:t.startOffset,end:t.endOffset,type:t.type}),this.flushBufferCounter=0,this.doFlush()},e.prototype.onLevelUpdated=function(t){var e=t.details;e.fragments.length>0&&(this._levelDuration=e.totalduration+e.fragments[0].start,this._live=e.live,this.updateMediaElementDuration())},e.prototype.updateMediaElementDuration=function(){var t=this.hls.config,e=void 0;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var r in this.sourceBuffer)if(!0===this.sourceBuffer[r].updating)return;e=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===t.liveDurationInfinity?(Pt.b.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>e||e===1/0||isNaN(e))&&(Pt.b.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},e.prototype.doFlush=function(){for(;this.flushRange.length;){var t=this.flushRange[0];if(!this.flushBuffer(t.start,t.end,t.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var e=0,r=this.sourceBuffer;try{for(var i in r)e+=r[i].buffered.length}catch(t){Pt.b.error("error while accessing sourceBuffer.buffered")}this.appended=e,this.hls.trigger(Ot.a.BUFFER_FLUSHED)}},e.prototype.doAppending=function(){var t=this.hls,e=this.sourceBuffer,r=this.segments;if(Object.keys(e).length){if(this.media.error)return this.segments=[],void Pt.b.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(r&&r.length){var i=r.shift();try{var a=i.type,n=e[a];n?n.updating?r.unshift(i):(n.ended=!1,this.parent=i.parent,n.appendBuffer(i.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(e){Pt.b.error("error while trying to append buffer:"+e.message),r.unshift(i);var o={type:Ct.b.MEDIA_ERROR,parent:i.parent};if(22===e.code)return this.segments=[],o.details=Ct.a.BUFFER_FULL_ERROR,o.fatal=!1,void t.trigger(Ot.a.ERROR,o);if(this.appendError?this.appendError++:this.appendError=1,o.details=Ct.a.BUFFER_APPEND_ERROR,this.appendError>t.config.appendErrorMaxRetry)return Pt.b.log("fail "+t.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),r=[],o.fatal=!0,void t.trigger(Ot.a.ERROR,o);o.fatal=!1,t.trigger(Ot.a.ERROR,o)}}}},e.prototype.flushBuffer=function(t,e,r){var i,a,n,o,s,l,u=this.sourceBuffer;if(Object.keys(u).length){if(Pt.b.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+t+"/"+e),this.flushBufferCounter<this.appended){for(var d in u)if(!r||d===r){if(i=u[d],i.ended=!1,i.updating)return Pt.b.warn("cannot flush, sb updating in progress"),!1;try{for(a=0;a<i.buffered.length;a++)if(n=i.buffered.start(a),o=i.buffered.end(a),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&e===Number.POSITIVE_INFINITY?(s=t,l=e):(s=Math.max(n,t),l=Math.min(o,e)),Math.min(l,o)-s>.5)return this.flushBufferCounter++,Pt.b.log("flush "+d+" ["+s+","+l+"], of ["+n+","+o+"], pos:"+this.media.currentTime),i.remove(s,l),!1}catch(t){Pt.b.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else Pt.b.warn("abort flushing too many retries");Pt.b.log("buffer flushed")}return!0},e}(Nt),xe=Pe,Fe=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),Ne=function(t){function e(r){return Y(this,e),z(this,t.call(this,r,Ot.a.FPS_DROP_LEVEL_CAPPING,Ot.a.MEDIA_ATTACHING,Ot.a.MANIFEST_PARSED))}return X(e,t),e.prototype.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))},e.prototype.onFpsDropLevelCapping=function(t){e.isLevelAllowed(t.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(t.droppedLevel)},e.prototype.onMediaAttaching=function(t){this.media=t.media instanceof HTMLVideoElement?t.media:null},e.prototype.onManifestParsed=function(t){var e=this.hls;this.restrictedLevels=[],e.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=t.levels,e.firstLevel=this.getMaxLevel(t.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},e.prototype.detectPlayerSize=function(){if(this.media){var t=this.levels?this.levels.length:0;if(t){var e=this.hls;e.autoLevelCapping=this.getMaxLevel(t-1),e.autoLevelCapping>this.autoLevelCapping&&e.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}},e.prototype.getMaxLevel=function(t){var r=this;if(!this.levels)return-1;var i=this.levels.filter(function(i,a){return e.isLevelAllowed(a,r.restrictedLevels)&&a<=t});return e.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)},e.isLevelAllowed=function(t){return-1===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).indexOf(t)},e.getMaxLevelByMediaSize=function(t,e,r){if(!t||t&&!t.length)return-1;for(var i=t.length-1,a=0;a<t.length;a+=1){var n=t[a];if((n.width>=e||n.height>=r)&&function(t,e){return!e||(t.width!==e.width||t.height!==e.height)}(n,t[a+1])){i=a;break}}return i},Fe(e,[{key:"mediaWidth",get:function(){var t=void 0,r=this.media;return r&&(t=r.width||r.clientWidth||r.offsetWidth,t*=e.contentScaleFactor),t}},{key:"mediaHeight",get:function(){var t=void 0,r=this.media;return r&&(t=r.height||r.clientHeight||r.offsetHeight,t*=e.contentScaleFactor),t}}],[{key:"contentScaleFactor",get:function(){var t=1;try{t=window.devicePixelRatio}catch(t){}return t}}]),e}(Nt),Me=Ne,Ue=function(t){function e(r){return q(this,e),Q(this,t.call(this,r,Ot.a.MEDIA_ATTACHING))}return J(e,t),e.prototype.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},e.prototype.onMediaAttaching=function(t){var e=this.hls.config;if(e.capLevelOnFPSDrop){"function"==typeof(this.video=t.media instanceof HTMLVideoElement?t.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),e.fpsDroppedMonitoringPeriod)}},e.prototype.checkFPS=function(t,e,r){var i=performance.now();if(e){if(this.lastTime){var a=i-this.lastTime,n=r-this.lastDroppedFrames,o=e-this.lastDecodedFrames,s=1e3*n/a,l=this.hls;if(l.trigger(Ot.a.FPS_DROP,{currentDropped:n,currentDecoded:o,totalDroppedFrames:r}),s>0&&n>l.config.fpsDroppedMonitoringThreshold*o){var u=l.currentLevel;Pt.b.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(-1===l.autoLevelCapping||l.autoLevelCapping>=u)&&(u-=1,l.trigger(Ot.a.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:l.currentLevel}),l.autoLevelCapping=u,l.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=e}},e.prototype.checkFPSInterval=function(){var t=this.video;if(t)if(this.isVideoPlaybackQualityAvailable){var e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)},e}(Nt),Be=Ue,Ge=function(){function t(e){$(this,t),e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}return t.prototype.destroy=function(){this.abort(),this.loader=null},t.prototype.abort=function(){var t=this.loader;t&&4!==t.readyState&&(this.stats.aborted=!0,t.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},t.prototype.load=function(t,e,r){this.context=t,this.config=e,this.callbacks=r,this.stats={trequest:performance.now(),retry:0},this.retryDelay=e.retryDelay,this.loadInternal()},t.prototype.loadInternal=function(){var t,e=this.context;t=this.loader=new XMLHttpRequest;var r=this.stats;r.tfirst=0,r.loaded=0;var i=this.xhrSetup;try{if(i)try{i(t,e.url)}catch(r){t.open("GET",e.url,!0),i(t,e.url)}t.readyState||t.open("GET",e.url,!0)}catch(r){return void this.callbacks.onError({code:t.status,text:r.message},e,t)}e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),t.send()},t.prototype.readystatechange=function(t){var e=t.currentTarget,r=e.readyState,i=this.stats,a=this.context,n=this.config;if(!i.aborted&&r>=2)if(window.clearTimeout(this.requestTimeout),0===i.tfirst&&(i.tfirst=Math.max(performance.now(),i.trequest)),4===r){var o=e.status;if(o>=200&&o<300){i.tload=Math.max(i.tfirst,performance.now());var s=void 0,l=void 0;"arraybuffer"===a.responseType?(s=e.response,l=s.byteLength):(s=e.responseText,l=s.length),i.loaded=i.total=l;var u={url:e.responseURL,data:s};this.callbacks.onSuccess(u,i,a,e)}else i.retry>=n.maxRetry||o>=400&&o<499?(Pt.b.error(o+" while loading "+a.url),this.callbacks.onError({code:o,text:e.statusText},a,e)):(Pt.b.warn(o+" while loading "+a.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,n.maxRetryDelay),i.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),n.timeout)},t.prototype.loadtimeout=function(){Pt.b.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},t.prototype.loadprogress=function(t){var e=t.currentTarget,r=this.stats;r.loaded=t.loaded,t.lengthComputable&&(r.total=t.total);var i=this.callbacks.onProgress;i&&i(r,this.context,null,e)},t}(),je=Ge,He=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),Ke=function(t){function e(r){Z(this,e);var i=tt(this,t.call(this,r,Ot.a.MANIFEST_LOADING,Ot.a.MANIFEST_PARSED,Ot.a.AUDIO_TRACK_LOADED,Ot.a.ERROR));return i.ticks=0,i.ontick=i.tick.bind(i),i}return et(e,t),e.prototype.destroy=function(){this.cleanTimer(),Nt.prototype.destroy.call(this)},e.prototype.cleanTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},e.prototype.tick=function(){1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)},e.prototype.doTick=function(){this.updateTrack(this.trackId)},e.prototype.onError=function(t){t.fatal&&t.type===Ct.b.NETWORK_ERROR&&this.cleanTimer()},e.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},e.prototype.onManifestParsed=function(t){var e=this,r=t.audioTracks||[],i=!1;this.tracks=r,this.hls.trigger(Ot.a.AUDIO_TRACKS_UPDATED,{audioTracks:r});var a=0;r.forEach(function(t){if(t.default&&!i)return e.audioTrack=a,void(i=!0);a++}),!1===i&&r.length&&(Pt.b.log("no default audio track defined, use first audio track as default"),this.audioTrack=0)},e.prototype.onAudioTrackLoaded=function(t){t.id<this.tracks.length&&(Pt.b.log("audioTrack "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*t.details.targetduration)),!t.details.live&&this.timer&&this.cleanTimer())},e.prototype.setAudioTrackInternal=function(t){if(t>=0&&t<this.tracks.length){this.cleanTimer(),this.trackId=t,Pt.b.log("switching to audioTrack "+t);var e=this.tracks[t],r=this.hls,i=e.type,a=e.url,n={id:t,type:i,url:a};r.trigger(Ot.a.AUDIO_TRACK_SWITCH,n),r.trigger(Ot.a.AUDIO_TRACK_SWITCHING,n);var o=e.details;!a||void 0!==o&&!0!==o.live||(Pt.b.log("(re)loading playlist for audioTrack "+t),r.trigger(Ot.a.AUDIO_TRACK_LOADING,{url:a,id:t}))}},e.prototype.updateTrack=function(t){if(t>=0&&t<this.tracks.length){this.cleanTimer(),this.trackId=t,Pt.b.log("updating audioTrack "+t);var e=this.tracks[t],r=e.url,i=e.details;!r||void 0!==i&&!0!==i.live||(Pt.b.log("(re)loading playlist for audioTrack "+t),this.hls.trigger(Ot.a.AUDIO_TRACK_LOADING,{url:r,id:t}))}},He(e,[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.trackId===t&&void 0!==this.tracks[t].details||this.setAudioTrackInternal(t)}}]),e}(Nt),We=Ke,Ve=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),Ye={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS"},ze=function(t){function e(r){rt(this,e);var i=it(this,t.call(this,r,Ot.a.MEDIA_ATTACHED,Ot.a.MEDIA_DETACHING,Ot.a.AUDIO_TRACKS_UPDATED,Ot.a.AUDIO_TRACK_SWITCHING,Ot.a.AUDIO_TRACK_LOADED,Ot.a.KEY_LOADED,Ot.a.FRAG_LOADED,Ot.a.FRAG_PARSING_INIT_SEGMENT,Ot.a.FRAG_PARSING_DATA,Ot.a.FRAG_PARSED,Ot.a.ERROR,Ot.a.BUFFER_RESET,Ot.a.BUFFER_CREATED,Ot.a.BUFFER_APPENDED,Ot.a.BUFFER_FLUSHED,Ot.a.INIT_PTS_FOUND));return i.config=r.config,i.audioCodecSwap=!1,i.ticks=0,i._state=Ye.STOPPED,i.ontick=i.tick.bind(i),i.initPTS=[],i.waitingFragment=null,i.videoTrackCC=null,i}return at(e,t),e.prototype.destroy=function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),Nt.prototype.destroy.call(this),this.state=Ye.STOPPED},e.prototype.onInitPtsFound=function(t){var e=t.id,r=t.frag.cc,i=t.initPTS;"main"===e&&(this.initPTS[r]=i,this.videoTrackCC=r,Pt.b.log("InitPTS for cc:"+r+" found from video track:"+i),this.state===Ye.WAITING_INIT_PTS&&this.tick())},e.prototype.startLoad=function(t){if(this.tracks){var e=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,e>0&&-1===t?(Pt.b.log("audio:override startPosition with lastCurrentTime @"+e.toFixed(3)),this.state=Ye.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:t,this.state=Ye.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=t,this.state=Ye.STOPPED},e.prototype.stopLoad=function(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=Ye.STOPPED},e.prototype.tick=function(){1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)},e.prototype.doTick=function(){var t,e,r,i=this.hls,a=i.config;switch(this.state){case Ye.ERROR:case Ye.PAUSED:case Ye.BUFFER_FLUSHING:break;case Ye.STARTING:this.state=Ye.WAITING_TRACK,this.loadedmetadata=!1;break;case Ye.IDLE:var n=this.tracks;if(!n)break;if(!this.media&&(this.startFragRequested||!a.startFragPrefetch))break;if(this.loadedmetadata)t=this.media.currentTime;else if(void 0===(t=this.nextLoadPosition))break;var o=this.mediaBuffer?this.mediaBuffer:this.media,s=this.videoBuffer?this.videoBuffer:this.media,l=ae.bufferInfo(o,t,a.maxBufferHole),u=ae.bufferInfo(s,t,a.maxBufferHole),d=l.len,h=l.end,c=this.fragPrevious,f=Math.max(a.maxBufferLength,u.len),p=this.audioSwitch,g=this.trackId;if((d<f||p)&&g<n.length){if(void 0===(r=n[g].details)){this.state=Ye.WAITING_TRACK;break}if(!p&&!r.live&&c&&c.sn===r.endSN&&!l.nextStart&&(!this.media.seeking||this.media.duration-h<c.duration/2)){this.hls.trigger(Ot.a.BUFFER_EOS,{type:"audio"}),this.state=Ye.ENDED;break}var v=r.fragments,y=v.length,m=v[0].start,b=v[y-1].start+v[y-1].duration,E=void 0;if(p)if(r.live&&!r.PTSKnown)Pt.b.log("switching audiotrack, live stream, unknown PTS,load first fragment"),h=0;else if(h=t,r.PTSKnown&&t<m){if(!(l.end>m||l.nextStart))return;Pt.b.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=m+.05}if(r.initSegment&&!r.initSegment.data)E=r.initSegment;else if(h<=m){if(E=v[0],null!==this.videoTrackCC&&E.cc!==this.videoTrackCC&&(E=A(v,this.videoTrackCC)),r.live&&E.loadIdx&&E.loadIdx===this.fragLoadIdx){var T=l.nextStart?l.nextStart:m;return Pt.b.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(T+.05)),void(this.media.currentTime=T+.05)}}else{var R=void 0,S=a.maxFragLookUpTolerance,L=c?v[c.sn-v[0].sn+1]:void 0,_=function(t){var e=Math.min(S,t.duration);return t.start+t.duration-e<=h?1:t.start-e>h&&t.start?-1:0};h<b?(h>b-S&&(S=0),R=L&&!_(L)?L:re.search(v,_)):R=v[y-1],R&&(E=R,m=R.start,c&&E.level===c.level&&E.sn===c.sn&&(E.sn<r.endSN?(E=v[E.sn+1-r.startSN],Pt.b.log("SN just loaded, load next one: "+E.sn)):E=null))}if(E)if(E.decryptdata&&null!=E.decryptdata.uri&&null==E.decryptdata.key)Pt.b.log("Loading key for "+E.sn+" of ["+r.startSN+" ,"+r.endSN+"],track "+g),this.state=Ye.KEY_LOADING,i.trigger(Ot.a.KEY_LOADING,{frag:E});else{if(Pt.b.log("Loading "+E.sn+", cc: "+E.cc+" of ["+r.startSN+" ,"+r.endSN+"],track "+g+", currentTime:"+t+",bufferEnd:"+h.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,E.loadCounter){E.loadCounter++;var w=a.fragLoadingLoopThreshold;if(E.loadCounter>w&&Math.abs(this.fragLoadIdx-E.loadIdx)<w)return void i.trigger(Ot.a.ERROR,{type:Ct.b.MEDIA_ERROR,details:Ct.a.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:E})}else E.loadCounter=1;E.loadIdx=this.fragLoadIdx,this.fragCurrent=E,this.startFragRequested=!0,isNaN(E.sn)||(this.nextLoadPosition=E.start+E.duration),i.trigger(Ot.a.FRAG_LOADING,{frag:E}),this.state=Ye.FRAG_LOADING}}break;case Ye.WAITING_TRACK:e=this.tracks[this.trackId],e&&e.details&&(this.state=Ye.IDLE);break;case Ye.FRAG_LOADING_WAITING_RETRY:var D=performance.now(),I=this.retryDate;o=this.media;var k=o&&o.seeking;(!I||D>=I||k)&&(Pt.b.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=Ye.IDLE);break;case Ye.WAITING_INIT_PTS:var O=this.videoTrackCC;if(void 0===this.initPTS[O])break;var C=this.waitingFragment;if(C){var P=C.frag.cc;O!==P?(e=this.tracks[this.trackId],e.details&&e.details.live&&(Pt.b.warn("Waiting fragment CC ("+P+") does not match video track CC ("+O+")"),this.waitingFragment=null,this.state=Ye.IDLE)):(this.state=Ye.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null)}else this.state=Ye.IDLE;break;case Ye.STOPPED:case Ye.FRAG_LOADING:case Ye.PARSING:case Ye.PARSED:case Ye.ENDED:}},e.prototype.onMediaAttached=function(t){var e=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("ended",this.onvended);var r=this.config;this.tracks&&r.autoStartLoad&&this.startLoad(r.startPosition)},e.prototype.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(Pt.b.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var e=this.tracks;e&&e.forEach(function(t){t.details&&t.details.fragments.forEach(function(t){t.loadCounter=void 0})}),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.stopLoad()},e.prototype.onMediaSeeking=function(){this.state===Ye.ENDED&&(this.state=Ye.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()},e.prototype.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},e.prototype.onAudioTracksUpdated=function(t){Pt.b.log("audio tracks updated"),this.tracks=t.audioTracks},e.prototype.onAudioTrackSwitching=function(t){var e=!!t.url;this.trackId=t.id,this.fragCurrent=null,this.state=Ye.PAUSED,this.waitingFragment=null,e?this.timer||(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),e&&(this.audioSwitch=!0,this.state=Ye.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()},e.prototype.onAudioTrackLoaded=function(t){var e=t.details,r=t.id,i=this.tracks[r],a=e.totalduration,n=0;if(Pt.b.log("track "+r+" loaded ["+e.startSN+","+e.endSN+"],duration:"+a),e.live){var o=i.details;o&&e.fragments.length>0?(T(o,e),n=e.fragments[0].start,e.PTSKnown?Pt.b.log("live audio playlist sliding:"+n.toFixed(3)):Pt.b.log("live audio playlist - outdated PTS, unknown sliding")):(e.PTSKnown=!1,Pt.b.log("live audio playlist - first load, unknown sliding"))}else e.PTSKnown=!1;if(i.details=e,!this.startFragRequested){if(-1===this.startPosition){var s=e.startTimeOffset;isNaN(s)?this.startPosition=0:(Pt.b.log("start time offset found in playlist, adjust startPosition to "+s),this.startPosition=s)}this.nextLoadPosition=this.startPosition}this.state===Ye.WAITING_TRACK&&(this.state=Ye.IDLE),this.tick()},e.prototype.onKeyLoaded=function(){this.state===Ye.KEY_LOADING&&(this.state=Ye.IDLE,this.tick())},e.prototype.onFragLoaded=function(t){var e=this.fragCurrent,r=t.frag;if(this.state===Ye.FRAG_LOADING&&e&&"audio"===r.type&&r.level===e.level&&r.sn===e.sn){var i=this.tracks[this.trackId],a=i.details,n=a.totalduration,o=e.level,s=e.sn,l=e.cc,u=this.config.defaultAudioCodec||i.audioCodec||"mp4a.40.2",d=this.stats=t.stats;if("initSegment"===s)this.state=Ye.IDLE,d.tparsed=d.tbuffered=performance.now(),a.initSegment.data=t.payload,this.hls.trigger(Ot.a.FRAG_BUFFERED,{stats:d,frag:e,id:"audio"}),this.tick();else{this.state=Ye.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new ce(this.hls,"audio"));var h=this.initPTS[l],c=a.initSegment?a.initSegment.data:[];if(a.initSegment||void 0!==h){this.pendingBuffering=!0,Pt.b.log("Demuxing "+s+" of ["+a.startSN+" ,"+a.endSN+"],track "+o);this.demuxer.push(t.payload,c,u,null,e,n,!1,h)}else Pt.b.log("unknown video PTS for continuity counter "+l+", waiting for video PTS before demuxing audio frag "+s+" of ["+a.startSN+" ,"+a.endSN+"],track "+o),this.waitingFragment=t,this.state=Ye.WAITING_INIT_PTS}}this.fragLoadError=0},e.prototype.onFragParsingInitSegment=function(t){var e=this.fragCurrent,r=t.frag;if(e&&"audio"===t.id&&r.sn===e.sn&&r.level===e.level&&this.state===Ye.PARSING){var i=t.tracks,a=void 0;if(i.video&&delete i.video,a=i.audio){a.levelCodec=a.codec,a.id=t.id,this.hls.trigger(Ot.a.BUFFER_CODECS,i),Pt.b.log("audio track:audio,container:"+a.container+",codecs[level/parsed]=["+a.levelCodec+"/"+a.codec+"]");var n=a.initSegment;if(n){var o={type:"audio",data:n,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[o]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(Ot.a.BUFFER_APPENDING,o))}this.tick()}}},e.prototype.onFragParsingData=function(t){var e=this,r=this.fragCurrent,i=t.frag;if(r&&"audio"===t.id&&"audio"===t.type&&i.sn===r.sn&&i.level===r.level&&this.state===Ye.PARSING){var a=this.trackId,n=this.tracks[a],o=this.hls;isNaN(t.endPTS)&&(t.endPTS=t.startPTS+r.duration,t.endDTS=t.startDTS+r.duration),Pt.b.log("parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb),E(n.details,r,t.startPTS,t.endPTS);var s=this.audioSwitch,l=this.media,u=!1;if(s&&l)if(l.readyState){var d=l.currentTime;Pt.b.log("switching audio track : currentTime:"+d),d>=t.startPTS&&(Pt.b.log("switching audio track : flushing all audio"),this.state=Ye.BUFFER_FLUSHING,o.trigger(Ot.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),u=!0,this.audioSwitch=!1,o.trigger(Ot.a.AUDIO_TRACK_SWITCHED,{id:a}))}else this.audioSwitch=!1,o.trigger(Ot.a.AUDIO_TRACK_SWITCHED,{id:a});var h=this.pendingData;this.audioSwitch||([t.data1,t.data2].forEach(function(e){e&&e.length&&h.push({type:t.type,data:e,parent:"audio",content:"data"})}),!u&&h.length&&(h.forEach(function(t){e.state===Ye.PARSING&&(e.pendingBuffering=!0,e.hls.trigger(Ot.a.BUFFER_APPENDING,t))}),this.pendingData=[],this.appended=!0)),this.tick()}},e.prototype.onFragParsed=function(t){var e=this.fragCurrent,r=t.frag;e&&"audio"===t.id&&r.sn===e.sn&&r.level===e.level&&this.state===Ye.PARSING&&(this.stats.tparsed=performance.now(),this.state=Ye.PARSED,this._checkAppendedParsed())},e.prototype.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},e.prototype.onBufferCreated=function(t){var e=t.tracks.audio;e&&(this.mediaBuffer=e.buffer,this.loadedmetadata=!0),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer)},e.prototype.onBufferAppended=function(t){if("audio"===t.parent){var e=this.state;e!==Ye.PARSING&&e!==Ye.PARSED||(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}},e.prototype._checkAppendedParsed=function(){if(!(this.state!==Ye.PARSED||this.appended&&this.pendingBuffering)){var t=this.fragCurrent,e=this.stats,r=this.hls;if(t){this.fragPrevious=t,e.tbuffered=performance.now(),r.trigger(Ot.a.FRAG_BUFFERED,{stats:e,frag:t,id:"audio"});var i=this.mediaBuffer?this.mediaBuffer:this.media;Pt.b.log("audio buffered : "+pe.toString(i.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,r.trigger(Ot.a.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=Ye.IDLE}this.tick()}},e.prototype.onError=function(t){var e=t.frag;if(!e||"audio"===e.type)switch(t.details){case Ct.a.FRAG_LOAD_ERROR:case Ct.a.FRAG_LOAD_TIMEOUT:if(!t.fatal){var r=this.fragLoadError;r?r++:r=1;var i=this.config;if(r<=i.fragLoadingMaxRetry){this.fragLoadError=r,e.loadCounter=0;var a=Math.min(Math.pow(2,r-1)*i.fragLoadingRetryDelay,i.fragLoadingMaxRetryTimeout);Pt.b.warn("audioStreamController: frag loading failed, retry in "+a+" ms"),this.retryDate=performance.now()+a,this.state=Ye.FRAG_LOADING_WAITING_RETRY}else Pt.b.error("audioStreamController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=Ye.ERROR}break;case Ct.a.FRAG_LOOP_LOADING_ERROR:case Ct.a.AUDIO_TRACK_LOAD_ERROR:case Ct.a.AUDIO_TRACK_LOAD_TIMEOUT:case Ct.a.KEY_LOAD_ERROR:case Ct.a.KEY_LOAD_TIMEOUT:this.state!==Ye.ERROR&&(this.state=t.fatal?Ye.ERROR:Ye.IDLE,Pt.b.warn("audioStreamController: "+t.details+" while loading frag,switch to "+this.state+" state ..."));break;case Ct.a.BUFFER_FULL_ERROR:if("audio"===t.parent&&(this.state===Ye.PARSING||this.state===Ye.PARSED)){var n=this.mediaBuffer,o=this.media.currentTime;if(n&&ae.isBuffered(n,o)&&ae.isBuffered(n,o+.5)){var s=this.config;s.maxMaxBufferLength>=s.maxBufferLength&&(s.maxMaxBufferLength/=2,Pt.b.warn("audio:reduce max buffer length to "+s.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*s.fragLoadingLoopThreshold),this.state=Ye.IDLE}else Pt.b.warn("buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=Ye.BUFFER_FLUSHING,this.hls.trigger(Ot.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}},e.prototype.onBufferFlushed=function(){var t=this,e=this.pendingData;e&&e.length?(Pt.b.log("appending pending audio data on Buffer Flushed"),e.forEach(function(e){t.hls.trigger(Ot.a.BUFFER_APPENDING,e)}),this.appended=!0,this.pendingData=[],this.state=Ye.PARSED):(this.state=Ye.IDLE,this.fragPrevious=null,this.tick())},Ve(e,[{key:"state",set:function(t){if(this.state!==t){var e=this.state;this._state=t,Pt.b.log("audio stream:"+e+"->"+t)}},get:function(){return this._state}}]),e}(Nt),Xe=ze,qe=function(){function t(t){return"string"==typeof t&&(!!n[t.toLowerCase()]&&t.toLowerCase())}function e(t){return"string"==typeof t&&(!!o[t.toLowerCase()]&&t.toLowerCase())}function r(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)t[i]=r[i]}return t}function i(i,n,o){var s=this,l=function(){if("undefined"!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),u={};l?s=document.createElement("custom"):u.enumerable=!0,s.hasBeenReset=!1;var d="",h=!1,c=i,f=n,p=o,g=null,v="",y=!0,m="auto",b="start",E=50,T="middle",R=50,A="middle";if(Object.defineProperty(s,"id",r({},u,{get:function(){return d},set:function(t){d=""+t}})),Object.defineProperty(s,"pauseOnExit",r({},u,{get:function(){return h},set:function(t){h=!!t}})),Object.defineProperty(s,"startTime",r({},u,{get:function(){return c},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");c=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"endTime",r({},u,{get:function(){return f},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");f=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"text",r({},u,{get:function(){return p},set:function(t){p=""+t,this.hasBeenReset=!0}})),Object.defineProperty(s,"region",r({},u,{get:function(){return g},set:function(t){g=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"vertical",r({},u,{get:function(){return v},set:function(e){var r=t(e);if(!1===r)throw new SyntaxError("An invalid or illegal string was specified.");v=r,this.hasBeenReset=!0}})),Object.defineProperty(s,"snapToLines",r({},u,{get:function(){return y},set:function(t){y=!!t,this.hasBeenReset=!0}})),Object.defineProperty(s,"line",r({},u,{get:function(){return m},set:function(t){if("number"!=typeof t&&t!==a)throw new SyntaxError("An invalid number or illegal string was specified.");m=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"lineAlign",r({},u,{get:function(){return b},set:function(t){var r=e(t);if(!r)throw new SyntaxError("An invalid or illegal string was specified.");b=r,this.hasBeenReset=!0}})),Object.defineProperty(s,"position",r({},u,{get:function(){return E},set:function(t){if(t<0||t>100)throw new Error("Position must be between 0 and 100.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"positionAlign",r({},u,{get:function(){return T},set:function(t){var r=e(t);if(!r)throw new SyntaxError("An invalid or illegal string was specified.");T=r,this.hasBeenReset=!0}})),Object.defineProperty(s,"size",r({},u,{get:function(){return R},set:function(t){if(t<0||t>100)throw new Error("Size must be between 0 and 100.");R=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"align",r({},u,{get:function(){return A},set:function(t){var r=e(t);if(!r)throw new SyntaxError("An invalid or illegal string was specified.");A=r,this.hasBeenReset=!0}})),s.displayState=void 0,l)return s}if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var a="auto",n={"":!0,lr:!0,rl:!0},o={start:!0,middle:!0,end:!0,left:!0,right:!0};return i.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},i}(),Qe=function(){return{decode:function(t){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}};st.prototype={set:function(t,e){this.get(t)||""===e||(this.values[t]=e)},get:function(t,e,r){return r?this.has(t)?this.values[t]:e[r]:this.has(t)?this.values[t]:e},has:function(t){return t in this.values},alt:function(t,e,r){for(var i=0;i<r.length;++i)if(e===r[i]){this.set(t,e);break}},integer:function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},percent:function(t,e){return!!(e.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(e=parseFloat(e))>=0&&e<=100)&&(this.set(t,e),!0)}};var Je=new qe(0,0,0),$e="middle"===Je.align?"middle":"center";nt.prototype={parse:function(t){function e(){var t=r.buffer,e=0;for(t=dt(t);e<t.length&&"\r"!==t[e]&&"\n"!==t[e];)++e;var i=t.substr(0,e);return"\r"===t[e]&&++e,"\n"===t[e]&&++e,r.buffer=t.substr(e),i}var r=this;t&&(r.buffer+=r.decoder.decode(t,{stream:!0}));try{var i;if("INITIAL"===r.state){if(!/\r\n|\n/.test(r.buffer))return this;i=e();var a=i.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!a||!a[0])throw new Error("Malformed WebVTT signature.");r.state="HEADER"}for(var n=!1;r.buffer;){if(!/\r\n|\n/.test(r.buffer))return this;switch(n?n=!1:i=e(),r.state){case"HEADER":/:/.test(i)?function(t){lt(t,function(t,e){switch(t){case"Region":console.log("parse region",e)}},/:/)}(i):i||(r.state="ID");continue;case"NOTE":i||(r.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){r.state="NOTE";break}if(!i)continue;if(r.cue=new qe(0,0,""),r.state="CUE",-1===i.indexOf("--\x3e")){r.cue.id=i;continue}case"CUE":try{ut(i,r.cue,r.regionList)}catch(t){r.cue=null,r.state="BADCUE";continue}r.state="CUETEXT";continue;case"CUETEXT":var o=-1!==i.indexOf("--\x3e");if(!i||o&&(n=!0)){r.oncue&&r.oncue(r.cue),r.cue=null,r.state="ID";continue}r.cue.text&&(r.cue.text+="\n"),r.cue.text+=i;continue;case"BADCUE":i||(r.state="ID");continue}}}catch(t){"CUETEXT"===r.state&&r.cue&&r.oncue&&r.oncue(r.cue),r.cue=null,r.state="INITIAL"===r.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var t=this;try{if(t.buffer+=t.decoder.decode(),(t.cue||"HEADER"===t.state)&&(t.buffer+="\n\n",t.parse()),"INITIAL"===t.state)throw new Error("Malformed WebVTT signature.")}catch(t){throw t}return t.onflush&&t.onflush(),this}};var Ze=nt,tr={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},er=function(t){var e=t;return tr.hasOwnProperty(t)&&(e=tr[t]),String.fromCharCode(e)},rr=15,ir=100,ar={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},nr={17:2,18:4,21:6,22:8,23:10,19:13,20:15},or={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},sr={25:2,26:4,29:6,30:8,31:10,27:13,28:15},lr=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],ur={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(t){this.time=t},log:function(t,e){var r=this.verboseFilter[t];this.verboseLevel>=r&&console.log(this.time+" ["+t+"] "+e)}},dr=function(t){for(var e=[],r=0;r<t.length;r++)e.push(t[r].toString(16));return e},hr=function(){function t(e,r,i,a,n){ct(this,t),this.foreground=e||"white",this.underline=r||!1,this.italics=i||!1,this.background=a||"black",this.flash=n||!1}return t.prototype.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.prototype.setStyles=function(t){for(var e=["foreground","underline","italics","background","flash"],r=0;r<e.length;r++){var i=e[r];t.hasOwnProperty(i)&&(this[i]=t[i])}},t.prototype.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},t.prototype.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},t.prototype.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},t.prototype.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},t}(),cr=function(){function t(e,r,i,a,n,o){ct(this,t),this.uchar=e||" ",this.penState=new hr(r,i,a,n,o)}return t.prototype.reset=function(){this.uchar=" ",this.penState.reset()},t.prototype.setChar=function(t,e){this.uchar=t,this.penState.copy(e)},t.prototype.setPenState=function(t){this.penState.copy(t)},t.prototype.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},t.prototype.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},t.prototype.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},t}(),fr=function(){function t(){ct(this,t),this.chars=[];for(var e=0;e<ir;e++)this.chars.push(new cr);this.pos=0,this.currPenState=new hr}return t.prototype.equals=function(t){for(var e=!0,r=0;r<ir;r++)if(!this.chars[r].equals(t.chars[r])){e=!1;break}return e},t.prototype.copy=function(t){for(var e=0;e<ir;e++)this.chars[e].copy(t.chars[e])},t.prototype.isEmpty=function(){for(var t=!0,e=0;e<ir;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},t.prototype.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(ur.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>ir&&(ur.log("ERROR","Too large cursor position "+this.pos),this.pos=ir)},t.prototype.moveCursor=function(t){var e=this.pos+t;if(t>1)for(var r=this.pos+1;r<e+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(e)},t.prototype.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.prototype.insertChar=function(t){t>=144&&this.backSpace();var e=er(t);if(this.pos>=ir)return void ur.log("ERROR","Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!");this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1)},t.prototype.clearFromPos=function(t){var e;for(e=t;e<ir;e++)this.chars[e].reset()},t.prototype.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.prototype.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.prototype.getTextString=function(){for(var t=[],e=!0,r=0;r<ir;r++){var i=this.chars[r].uchar;" "!==i&&(e=!1),t.push(i)}return e?"":t.join("")},t.prototype.setPenStyles=function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)},t}(),pr=function(){function t(){ct(this,t),this.rows=[];for(var e=0;e<rr;e++)this.rows.push(new fr);this.currRow=rr-1,this.nrRollUpRows=null,this.reset()}return t.prototype.reset=function(){for(var t=0;t<rr;t++)this.rows[t].clear();this.currRow=rr-1},t.prototype.equals=function(t){for(var e=!0,r=0;r<rr;r++)if(!this.rows[r].equals(t.rows[r])){e=!1;break}return e},t.prototype.copy=function(t){for(var e=0;e<rr;e++)this.rows[e].copy(t.rows[e])},t.prototype.isEmpty=function(){for(var t=!0,e=0;e<rr;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},t.prototype.backSpace=function(){this.rows[this.currRow].backSpace()},t.prototype.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},t.prototype.insertChar=function(t){this.rows[this.currRow].insertChar(t)},t.prototype.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},t.prototype.moveCursor=function(t){this.rows[this.currRow].moveCursor(t)},t.prototype.setCursor=function(t){ur.log("INFO","setCursor: "+t),this.rows[this.currRow].setCursor(t)},t.prototype.setPAC=function(t){ur.log("INFO","pacData = "+JSON.stringify(t));var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var r=0;r<rr;r++)this.rows[r].clear();var i=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){var n=a.rows[i].cueStartTime;if(n&&n<ur.time)for(var o=0;o<this.nrRollUpRows;o++)this.rows[e-this.nrRollUpRows+o+1].copy(a.rows[i+o])}}this.currRow=e;var s=this.rows[this.currRow];if(null!==t.indent){var l=t.indent,u=Math.max(l-1,0);s.setCursor(t.indent),t.color=s.chars[u].penState.foreground}var d={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(d)},t.prototype.setBkgData=function(t){ur.log("INFO","bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)},t.prototype.setRollUpRows=function(t){this.nrRollUpRows=t},t.prototype.rollUp=function(){if(null===this.nrRollUpRows)return void ur.log("DEBUG","roll_up but nrRollUpRows not set yet");ur.log("TEXT",this.getDisplayText());var t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),ur.log("INFO","Rolling up")},t.prototype.getDisplayText=function(t){t=t||!1;for(var e=[],r="",i=-1,a=0;a<rr;a++){var n=this.rows[a].getTextString();n&&(i=a+1,t?e.push("Row "+i+": '"+n+"'"):e.push(n.trim()))}return e.length>0&&(r=t?"["+e.join(" | ")+"]":e.join("\n")),r},t.prototype.getTextAndFormat=function(){return this.rows},t}(),gr=function(){function t(e,r){ct(this,t),this.chNr=e,this.outputFilter=r,this.mode=null,this.verbose=0,this.displayedMemory=new pr,this.nonDisplayedMemory=new pr,this.lastOutputScreen=new pr,this.currRollUpRow=this.displayedMemory.rows[rr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return t.prototype.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[rr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},t.prototype.getHandler=function(){return this.outputFilter},t.prototype.setHandler=function(t){this.outputFilter=t},t.prototype.setPAC=function(t){this.writeScreen.setPAC(t)},t.prototype.setBkgData=function(t){this.writeScreen.setBkgData(t)},t.prototype.setMode=function(t){t!==this.mode&&(this.mode=t,ur.log("INFO","MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},t.prototype.insertChars=function(t){for(var e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);var r=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";ur.log("INFO",r+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(ur.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},t.prototype.ccRCL=function(){ur.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.prototype.ccBS=function(){ur.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.prototype.ccAOF=function(){},t.prototype.ccAON=function(){},t.prototype.ccDER=function(){ur.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.prototype.ccRU=function(t){ur.log("INFO","RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},t.prototype.ccFON=function(){ur.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.prototype.ccRDC=function(){ur.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.prototype.ccTR=function(){ur.log("INFO","TR"),this.setMode("MODE_TEXT")},t.prototype.ccRTD=function(){ur.log("INFO","RTD"),this.setMode("MODE_TEXT")},t.prototype.ccEDM=function(){ur.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.prototype.ccCR=function(){ur.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.prototype.ccENM=function(){ur.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.prototype.ccEOC=function(){if(ur.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,ur.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},t.prototype.ccTO=function(t){ur.log("INFO","TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},t.prototype.ccMIDROW=function(t){var e={flash:!1};if(e.underline=t%2==1,e.italics=t>=46,e.italics)e.foreground="white";else{var r=Math.floor(t/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=i[r]}ur.log("INFO","MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},t.prototype.outputDataUpdate=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=ur.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),!0===t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue()),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},t.prototype.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},t}(),vr=function(){function t(e,r,i){ct(this,t),this.field=e||1,this.outputs=[r,i],this.channels=[new gr(1,r),new gr(2,i)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}}return t.prototype.getHandler=function(t){return this.channels[t].getHandler()},t.prototype.setHandler=function(t,e){this.channels[t].setHandler(e)},t.prototype.addData=function(t,e){var r,i,a,n=!1;this.lastTime=t,ur.setTime(t);for(var o=0;o<e.length;o+=2)if(i=127&e[o],a=127&e[o+1],0!==i||0!==a){if(ur.log("DATA","["+dr([e[o],e[o+1]])+"] -> ("+dr([i,a])+")"),r=this.parseCmd(i,a),r||(r=this.parseMidrow(i,a)),r||(r=this.parsePAC(i,a)),r||(r=this.parseBackgroundAttributes(i,a)),!r&&(n=this.parseChars(i,a)))if(this.currChNr&&this.currChNr>=0){var s=this.channels[this.currChNr-1];s.insertChars(n)}else ur.log("WARNING","No channel found yet. TEXT-MODE?");r?this.dataCounters.cmd+=2:n?this.dataCounters.char+=2:(this.dataCounters.other+=2,ur.log("WARNING","Couldn't parse cleaned data "+dr([i,a])+" orig: "+dr([e[o],e[o+1]])))}else this.dataCounters.padding+=2},t.prototype.parseCmd=function(t,e){var r=null,i=(20===t||28===t)&&32<=e&&e<=47,a=(23===t||31===t)&&33<=e&&e<=35;if(!i&&!a)return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,ur.log("DEBUG","Repeated command ("+dr([t,e])+") is dropped"),!0;r=20===t||23===t?1:2;var n=this.channels[r-1];return 20===t||28===t?32===e?n.ccRCL():33===e?n.ccBS():34===e?n.ccAOF():35===e?n.ccAON():36===e?n.ccDER():37===e?n.ccRU(2):38===e?n.ccRU(3):39===e?n.ccRU(4):40===e?n.ccFON():41===e?n.ccRDC():42===e?n.ccTR():43===e?n.ccRTD():44===e?n.ccEDM():45===e?n.ccCR():46===e?n.ccENM():47===e&&n.ccEOC():n.ccTO(e-32),this.lastCmdA=t,this.lastCmdB=e,this.currChNr=r,!0},t.prototype.parseMidrow=function(t,e){var r=null;if((17===t||25===t)&&32<=e&&e<=47){if((r=17===t?1:2)!==this.currChNr)return ur.log("ERROR","Mismatch channel in midrow parsing"),!1;return this.channels[r-1].ccMIDROW(e),ur.log("DEBUG","MIDROW ("+dr([t,e])+")"),!0}return!1},t.prototype.parsePAC=function(t,e){var r=null,i=null,a=(17<=t&&t<=23||25<=t&&t<=31)&&64<=e&&e<=127,n=(16===t||24===t)&&64<=e&&e<=95;if(!a&&!n)return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;r=t<=23?1:2,i=64<=e&&e<=95?1===r?ar[t]:or[t]:1===r?nr[t]:sr[t];var o=this.interpretPAC(i,e);return this.channels[r-1].setPAC(o),this.lastCmdA=t,this.lastCmdB=e,this.currChNr=r,!0},t.prototype.interpretPAC=function(t,e){var r=e,i={color:null,italics:!1,indent:null,underline:!1,row:t};return r=e>95?e-96:e-64,i.underline=1==(1&r),r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((r-16)/2),i},t.prototype.parseChars=function(t,e){var r=null,i=null,a=null;if(t>=25?(r=2,a=t-8):(r=1,a=t),17<=a&&a<=19){var n=e;n=17===a?e+80:18===a?e+112:e+144,ur.log("INFO","Special char '"+er(n)+"' in channel "+r),i=[n]}else 32<=t&&t<=127&&(i=0===e?[t]:[t,e]);if(i){var o=dr(i);ur.log("DEBUG","Char codes =  "+o.join(",")),this.lastCmdA=null,this.lastCmdB=null}return i},t.prototype.parseBackgroundAttributes=function(t,e){var r,i,a,n,o=(16===t||24===t)&&32<=e&&e<=47,s=(23===t||31===t)&&45<=e&&e<=47;return!(!o&&!s)&&(r={},16===t||24===t?(i=Math.floor((e-32)/2),r.background=lr[i],e%2==1&&(r.background=r.background+"_semi")):45===e?r.background="transparent":(r.foreground="black",47===e&&(r.underline=!0)),a=t<24?1:2,n=this.channels[a-1],n.setBkgData(r),this.lastCmdA=null,this.lastCmdB=null,!0)},t.prototype.reset=function(){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].reset();this.lastCmdA=null,this.lastCmdB=null},t.prototype.cueSplitAtTime=function(t){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].cueSplitAtTime(t)},t}(),yr=vr,mr=function(){function t(e,r){ft(this,t),this.timelineController=e,this.track=r,this.startTime=null,this.endTime=null,this.screen=null}return t.prototype.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues("textTrack"+this.track,this.startTime,this.endTime,this.screen),this.startTime=null)},t.prototype.newCue=function(t,e,r){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=r,this.timelineController.createCaptionsTrack(this.track)},t}(),br=mr,Er=function(t,e,r){return t.substr(r||0,e.length)===e},Tr=function(t){var e=parseInt(t.substr(-3)),r=parseInt(t.substr(-6,2)),i=parseInt(t.substr(-9,2)),a=t.length>9?parseInt(t.substr(0,t.indexOf(":"))):0;return isNaN(e)||isNaN(r)||isNaN(i)||isNaN(a)?-1:(e+=1e3*r,e+=6e4*i,e+=36e5*a)},Rr=function(t){for(var e=5381,r=t.length;r;)e=33*e^t.charCodeAt(--r);return(e>>>0).toString()},Ar=function(t,e,r){var i=t[e],a=t[i.prevCC];if(!a||!a.new&&i.new)return t.ccOffset=t.presentationOffset=i.start,void(i.new=!1);for(;a&&a.new;)t.ccOffset+=i.start-a.start,i.new=!1,i=a,a=t[i.prevCC];t.presentationOffset=r},Sr={parse:function(t,e,r,i,a,n){var o=/\r\n|\n\r|\n|\r/g,s=Object(Re.b)(new Uint8Array(t)).trim().replace(o,"\n").split("\n"),l="00:00.000",u=0,d=0,h=0,c=[],f=void 0,p=!0,g=new Ze;g.oncue=function(t){var e=r[i],a=r.ccOffset;e&&e.new&&(void 0!==d?a=r.ccOffset=e.start:Ar(r,i,h)),h&&(a=h+r.ccOffset-r.presentationOffset),t.startTime+=a-d,t.endTime+=a-d,t.id=Rr(t.startTime.toString())+Rr(t.endTime.toString())+Rr(t.text),t.text=decodeURIComponent(encodeURIComponent(t.text)),t.endTime>0&&c.push(t)},g.onparsingerror=function(t){f=t},g.onflush=function(){if(f&&n)return void n(f);a(c)},s.forEach(function(t){if(p){if(Er(t,"X-TIMESTAMP-MAP=")){p=!1,t.substr(16).split(",").forEach(function(t){Er(t,"LOCAL:")?l=t.substr(6):Er(t,"MPEGTS:")&&(u=parseInt(t.substr(7)))});try{e=e<0?e+8589934592:e,u-=e,d=Tr(l)/1e3,h=u/9e4,-1===d&&(f=new Error("Malformed X-TIMESTAMP-MAP: "+t))}catch(e){f=new Error("Malformed X-TIMESTAMP-MAP: "+t)}return}""===t&&(p=!1)}g.parse(t+"\n")}),g.flush()}},Lr=Sr,_r=function(t){function e(r){pt(this,e);var i=gt(this,t.call(this,r,Ot.a.MEDIA_ATTACHING,Ot.a.MEDIA_DETACHING,Ot.a.FRAG_PARSING_USERDATA,Ot.a.FRAG_DECRYPTED,Ot.a.MANIFEST_LOADING,Ot.a.MANIFEST_LOADED,Ot.a.FRAG_LOADED,Ot.a.LEVEL_SWITCHING,Ot.a.INIT_PTS_FOUND));if(i.hls=r,i.config=r.config,i.enabled=!0,i.Cues=r.config.cueHandler,i.textTracks=[],i.tracks=[],i.unparsedVttFrags=[],i.initPTS=void 0,i.cueRanges=[],i.config.enableCEA708Captions){var a=new br(i,1),n=new br(i,2);i.cea608Parser=new yr(0,a,n)}return i}return vt(e,t),e.prototype.addCues=function(t,e,r,i){for(var a=this.cueRanges,n=!1,o=a.length;o--;){var s=a[o],l=bt(s[0],s[1],e,r);if(l>=0&&(s[0]=Math.min(s[0],e),s[1]=Math.max(s[1],r),n=!0,l/(r-e)>.5))return}n||a.push([e,r]),this.Cues.newCue(this[t],e,r,i)},e.prototype.onInitPtsFound=function(t){var e=this;void 0===this.initPTS&&(this.initPTS=t.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(t){e.onFragLoaded(t)}),this.unparsedVttFrags=[])},e.prototype.getExistingTrack=function(t){var e=this.media;if(e)for(var r=0;r<e.textTracks.length;r++){var i=e.textTracks[r],a="textTrack"+t;if(!0===i[a])return i}return null},e.prototype.sendAddTrackEvent=function(t,e){var r=null;try{r=new window.Event("addtrack")}catch(t){r=document.createEvent("Event"),r.initEvent("addtrack",!1,!1)}r.track=t,e.dispatchEvent(r)},e.prototype.createCaptionsTrack=function(t){var e="textTrack"+t;if(!this[e]){var r=this.getExistingTrack(t);if(r)this[e]=r,yt(this[e]),this.sendAddTrackEvent(this[e],this.media);else{var i=this.createTextTrack("captions",this.config["captionsTextTrack"+t+"Label"],this.config.captionsTextTrack1LanguageCode);i&&(i[e]=!0,this[e]=i)}}},e.prototype.createTextTrack=function(t,e,r){var i=this.media;if(i)return i.addTextTrack(t,e,r)},e.prototype.destroy=function(){Nt.prototype.destroy.call(this)},e.prototype.onMediaAttaching=function(t){this.media=t.media,this._cleanTracks()},e.prototype.onMediaDetaching=function(){yt(this.textTrack1),yt(this.textTrack2)},e.prototype.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0},this._cleanTracks()},e.prototype._cleanTracks=function(){var t=this.media;if(t){var e=t.textTracks;if(e)for(var r=0;r<e.length;r++)yt(e[r])}},e.prototype.onManifestLoaded=function(t){var e=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[],this.config.enableWebVTT){this.tracks=t.subtitles||[];var r=this.media?this.media.textTracks:[];this.tracks.forEach(function(t,i){var a=void 0;if(i<r.length){var n=r[i];mt(n,t)&&(a=n)}a||(a=e.createTextTrack("subtitles",t.name,t.lang)),a.mode=t.default?"showing":"hidden",e.textTracks.push(a)})}},e.prototype.onLevelSwitching=function(){this.enabled="NONE"!==this.hls.currentLevel.closedCaptions},e.prototype.onFragLoaded=function(t){var e=t.frag,r=t.payload;if("main"===e.type){var i=e.sn;if(i!==this.lastSn+1){var a=this.cea608Parser;a&&a.reset()}this.lastSn=i}else if("subtitle"===e.type)if(r.byteLength){if(void 0===this.initPTS)return void this.unparsedVttFrags.push(t);var n=e.decryptdata;null!=n&&null!=n.key&&"AES-128"===n.method||this._parseVTTs(e,r)}else this.hls.trigger(Ot.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})},e.prototype._parseVTTs=function(t,e){var r=this.vttCCs;r[t.cc]||(r[t.cc]={start:t.start,prevCC:this.prevCC,new:!0},this.prevCC=t.cc);var i=this.textTracks,a=this.hls;Lr.parse(e,this.initPTS,r,t.cc,function(e){var r=i[t.trackId];e.forEach(function(t){if(!r.cues.getCueById(t.id))try{r.addCue(t)}catch(i){var e=new window.TextTrackCue(t.startTime,t.endTime,t.text);e.id=t.id,r.addCue(e)}}),a.trigger(Ot.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},function(e){Pt.b.log("Failed to parse VTT cue: "+e),a.trigger(Ot.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})})},e.prototype.onFragDecrypted=function(t){var e=t.payload,r=t.frag;if("subtitle"===r.type){if(void 0===this.initPTS)return void this.unparsedVttFrags.push(t);this._parseVTTs(r,e)}},e.prototype.onFragParsingUserdata=function(t){if(this.enabled&&this.config.enableCEA708Captions)for(var e=0;e<t.samples.length;e++){var r=this.extractCea608Data(t.samples[e].bytes);this.cea608Parser.addData(t.samples[e].pts,r)}},e.prototype.extractCea608Data=function(t){for(var e,r,i,a,n,o=31&t[0],s=2,l=[],u=0;u<o;u++)e=t[s++],r=127&t[s++],i=127&t[s++],a=0!=(4&e),n=3&e,0===r&&0===i||a&&0===n&&(l.push(r),l.push(i));return l},e}(Nt),wr=_r,Dr=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),Ir=function(t){function e(r){Et(this,e);var i=Tt(this,t.call(this,r,Ot.a.MEDIA_ATTACHED,Ot.a.MEDIA_DETACHING,Ot.a.MANIFEST_LOADING,Ot.a.MANIFEST_LOADED,Ot.a.SUBTITLE_TRACK_LOADED));return i.tracks=[],i.trackId=-1,i.media=void 0,i.subtitleDisplay=!1,i}return Rt(e,t),e.prototype._onTextTracksChanged=function(){if(this.media){for(var t=-1,e=At(this.media.textTracks),r=0;r<e.length;r++)"showing"===e[r].mode&&(t=r);this.subtitleTrack=t}},e.prototype.destroy=function(){Nt.prototype.destroy.call(this)},e.prototype.onMediaAttached=function(t){var e=this;this.media=t.media,this.media&&(void 0!==this.queuedDefaultTrack&&(this.subtitleTrack=this.queuedDefaultTrack,delete this.queuedDefaultTrack),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval(function(){e.trackChangeListener()},500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},e.prototype.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),this.media=void 0)},e.prototype.onManifestLoading=function(){this.tracks=[],this.trackId=-1},e.prototype.onManifestLoaded=function(t){var e=this,r=t.subtitles||[];this.tracks=r,this.trackId=-1,this.hls.trigger(Ot.a.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:r}),r.forEach(function(t){t.default&&(e.media?e.subtitleTrack=t.id:e.queuedDefaultTrack=t.id)})},e.prototype.onTick=function(){var t=this.trackId,e=this.tracks[t];if(e){var r=e.details;void 0!==r&&!0!==r.live||(Pt.b.log("(re)loading playlist for subtitle track "+t),this.hls.trigger(Ot.a.SUBTITLE_TRACK_LOADING,{url:e.url,id:t}))}},e.prototype.onSubtitleTrackLoaded=function(t){var e=this;t.id<this.tracks.length&&(Pt.b.log("subtitle track "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.timer&&(this.timer=setInterval(function(){e.onTick()},1e3*t.details.targetduration,this)),!t.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))},e.prototype.setSubtitleTrackInternal=function(t){if(!(t<-1||t>=this.tracks.length)){this.timer&&(clearInterval(this.timer),this.timer=null);var e=At(this.media.textTracks);if(-1!==this.trackId&&this.subtitleDisplay&&(e[this.trackId].mode="hidden"),this.trackId=t,Pt.b.log("switching to subtitle track "+t),this.hls.trigger(Ot.a.SUBTITLE_TRACK_SWITCH,{id:t}),-1!==t){var r=this.tracks[t];this.subtitleDisplay&&(e[t].mode="showing");var i=r.details;void 0!==i&&!0!==i.live||(Pt.b.log("(re)loading playlist for subtitle track "+t),this.hls.trigger(Ot.a.SUBTITLE_TRACK_LOADING,{url:r.url,id:t}))}}},Dr(e,[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.trackId!==t&&this.setSubtitleTrackInternal(t)}}]),e}(Nt),kr=Ir,Or=r(4),Cr={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING"},Pr=function(t){function e(r){St(this,e);var i=Lt(this,t.call(this,r,Ot.a.MEDIA_ATTACHED,Ot.a.ERROR,Ot.a.KEY_LOADED,Ot.a.FRAG_LOADED,Ot.a.SUBTITLE_TRACKS_UPDATED,Ot.a.SUBTITLE_TRACK_SWITCH,Ot.a.SUBTITLE_TRACK_LOADED,Ot.a.SUBTITLE_FRAG_PROCESSED));return i.config=r.config,i.vttFragSNsProcessed={},i.vttFragQueues=void 0,i.currentlyProcessing=null,i.state=Cr.STOPPED,i.currentTrackId=-1,i.ticks=0,i.decrypter=new Or.a(r.observer,r.config),i}return _t(e,t),e.prototype.destroy=function(){Nt.prototype.destroy.call(this),this.state=Cr.STOPPED},e.prototype.clearVttFragQueues=function(){var t=this;this.vttFragQueues={},this.tracks.forEach(function(e){t.vttFragQueues[e.id]=[]})},e.prototype.nextFrag=function(){if(null===this.currentlyProcessing&&this.currentTrackId>-1&&this.vttFragQueues[this.currentTrackId].length){var t=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.fragCurrent=t,this.hls.trigger(Ot.a.FRAG_LOADING,{frag:t}),this.state=Cr.FRAG_LOADING}},e.prototype.onSubtitleFragProcessed=function(t){t.success&&this.vttFragSNsProcessed[t.frag.trackId].push(t.frag.sn),this.currentlyProcessing=null,this.state=Cr.IDLE,this.nextFrag()},e.prototype.onMediaAttached=function(){this.state=Cr.IDLE},e.prototype.onError=function(t){var e=t.frag;e&&"subtitle"!==e.type||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())},e.prototype.tick=function(){var t=this;1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(function(){t.tick()},1),this.ticks=0)},e.prototype.doTick=function(){var t=this;switch(this.state){case Cr.IDLE:var e=this.tracks,r=this.currentTrackId,i=this.vttFragSNsProcessed[r],a=this.vttFragQueues[r],n=this.currentlyProcessing?this.currentlyProcessing.sn:-1,o=function(t){return i.indexOf(t.sn)>-1},s=function(t){return a.some(function(e){return e.sn===t.sn})};if(!e)break;var l;if(r<e.length&&(l=e[r].details),void 0===l)break;l.fragments.forEach(function(e){o(e)||e.sn===n||s(e)||(e.decryptdata&&null!=e.decryptdata.uri&&null==e.decryptdata.key?(Pt.b.log("Loading key for "+e.sn),t.state=Cr.KEY_LOADING,t.hls.trigger(Ot.a.KEY_LOADING,{frag:e})):(e.trackId=r,a.push(e),t.nextFrag()))})}},e.prototype.onSubtitleTracksUpdated=function(t){var e=this;Pt.b.log("subtitle tracks updated"),this.tracks=t.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(t){e.vttFragSNsProcessed[t.id]=[]})},e.prototype.onSubtitleTrackSwitch=function(t){this.currentTrackId=t.id,this.clearVttFragQueues()},e.prototype.onSubtitleTrackLoaded=function(){this.tick()},e.prototype.onKeyLoaded=function(){this.state===Cr.KEY_LOADING&&(this.state=Cr.IDLE,this.tick())},e.prototype.onFragLoaded=function(t){var e=this.fragCurrent,r=t.frag.decryptdata,i=t.frag,a=this.hls;if(this.state===Cr.FRAG_LOADING&&e&&"subtitle"===t.frag.type&&e.sn===t.frag.sn&&t.payload.byteLength>0&&null!=r&&null!=r.key&&"AES-128"===r.method){var n;try{n=performance.now()}catch(t){n=Date.now()}this.decrypter.decrypt(t.payload,r.key.buffer,r.iv.buffer,function(t){var e;try{e=performance.now()}catch(t){e=Date.now()}a.trigger(Ot.a.FRAG_DECRYPTED,{frag:i,payload:t,stats:{tstart:n,tdecrypt:e}})})}},e}(Nt),xr=Pr,Fr={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:je,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:Oe,bufferController:xe,capLevelController:Me,fpsController:Be,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0};Fr.subtitleStreamController=xr,Fr.subtitleTrackController=kr,Fr.timelineController=wr,Fr.cueHandler=Dt,Fr.enableCEA708Captions=!0,Fr.enableWebVTT=!0,Fr.captionsTextTrack1Label="English",Fr.captionsTextTrack1LanguageCode="en",Fr.captionsTextTrack2Label="Spanish",Fr.captionsTextTrack2LanguageCode="es",Fr.audioStreamController=Xe,Fr.audioTrackController=We;var Nr=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}(),Mr=function(){function t(){var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};wt(this,t);var i=t.DefaultConfig;if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var a in i)a in r||(r[a]=i[a]);if(void 0!==r.liveMaxLatencyDurationCount&&r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==r.liveMaxLatencyDuration&&(r.liveMaxLatencyDuration<=r.liveSyncDuration||void 0===r.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(Pt.a)(r.debug),this.config=r,this._autoLevelCapping=-1;var n=this.observer=new se.a;n.trigger=function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];n.emit.apply(n,[t,t].concat(r))},n.off=function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];n.removeListener.apply(n,[t].concat(r))},this.on=n.on.bind(n),this.off=n.off.bind(n),this.trigger=n.trigger.bind(n);var o=this.abrController=new r.abrController(this),s=new r.bufferController(this),l=new r.capLevelController(this),u=new r.fpsController(this),d=new Qt(this),h=new $t(this),c=new te(this),f=new Se(this),p=this.levelController=new Te(this),g=this.streamController=new me(this),v=[p,g],y=r.audioStreamController;y&&v.push(new y(this)),this.networkControllers=v;var m=[d,h,c,o,s,l,u,f];if(y=r.audioTrackController){var b=new y(this);this.audioTrackController=b,m.push(b)}if(y=r.subtitleTrackController){var E=new y(this);this.subtitleTrackController=E,m.push(E)}[r.subtitleStreamController,r.timelineController].forEach(function(t){t&&m.push(new t(e))}),this.coreComponents=m}return t.isSupported=function(){return M()},Nr(t,null,[{key:"version",get:function(){return"0.8.9"}},{key:"Events",get:function(){return Ot.a}},{key:"ErrorTypes",get:function(){return Ct.b}},{key:"ErrorDetails",get:function(){return Ct.a}},{key:"DefaultConfig",get:function(){return t.defaultConfig?t.defaultConfig:Fr},set:function(e){t.defaultConfig=e}}]),t.prototype.destroy=function(){Pt.b.log("destroy"),this.trigger(Ot.a.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(t){t.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1},t.prototype.attachMedia=function(t){Pt.b.log("attachMedia"),this.media=t,this.trigger(Ot.a.MEDIA_ATTACHING,{media:t})},t.prototype.detachMedia=function(){Pt.b.log("detachMedia"),this.trigger(Ot.a.MEDIA_DETACHING),this.media=null},t.prototype.loadSource=function(t){t=kt.a.buildAbsoluteURL(window.location.href,t,{alwaysNormalize:!0}),Pt.b.log("loadSource:"+t),this.url=t,this.trigger(Ot.a.MANIFEST_LOADING,{url:t})},t.prototype.startLoad=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;Pt.b.log("startLoad("+t+")"),this.networkControllers.forEach(function(e){e.startLoad(t)})},t.prototype.stopLoad=function(){Pt.b.log("stopLoad"),this.networkControllers.forEach(function(t){t.stopLoad()})},t.prototype.swapAudioCodec=function(){Pt.b.log("swapAudioCodec"),this.streamController.swapAudioCodec()},t.prototype.recoverMediaError=function(){Pt.b.log("recoverMediaError");var t=this.media;this.detachMedia(),this.attachMedia(t)},Nr(t,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){Pt.b.log("set currentLevel:"+t),this.loadLevel=t,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){Pt.b.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){Pt.b.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){Pt.b.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){Pt.b.log("set startLevel:"+t);var e=this;-1!==t&&(t=Math.max(t,e.minAutoLevel)),e.levelController.startLevel=t}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){Pt.b.log("set autoLevelCapping:"+t),this._autoLevelCapping=t}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var t=this,e=t.levels,r=t.config.minAutoBitrate,i=e?e.length:0,a=0;a<i;a++){if((e[a].realBitrate?Math.max(e[a].realBitrate,e[a].bitrate):e[a].bitrate)>r)return a}return 0}},{key:"maxAutoLevel",get:function(){var t=this,e=t.levels,r=t.autoLevelCapping;return-1===r&&e&&e.length?e.length-1:r}},{key:"nextAutoLevel",get:function(){var t=this;return Math.min(Math.max(t.abrController.nextAutoLevel,t.minAutoLevel),t.maxAutoLevel)},set:function(t){var e=this;e.abrController.nextAutoLevel=Math.max(e.minAutoLevel,t)}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}}]),t}();e.default=Mr},function(t,e,r){function i(t){function e(i){if(r[i])return r[i].exports;var a=r[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var r={};e.m=t,e.c=r,e.i=function(t){return t},e.d=function(t,r,i){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/",e.oe=function(t){throw console.error(t),t};var i=e(e.s=ENTRY_MODULE);return i.default||i}function a(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function n(t){var e=[],r=t.toString(),i=r.match(/^function\s?\(\w+,\s*\w+,\s*(\w+)\)/);if(!i)return e;for(var n,o=i[1],s=new RegExp("(\\\\n|\\W)"+a(o)+"\\((/\\*.*?\\*/)?s?.*?([\\.|\\-|\\w|/|@]+).*?\\)","g");n=s.exec(r);)e.push(n[3]);return e}function o(t,e){for(var r=[e],i=[],a={};r.length;){var o=r.pop();if(!a[o]&&t[o]){a[o]=!0,i.push(o);var s=n(t[o]);r=r.concat(s)}}return i}t.exports=function(t,e){e=e||{};var a=r.m,n=e.all?Object.keys(a):o(a,t),s="("+i.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+n.map(function(t){return JSON.stringify(t)+": "+a[t].toString()}).join(",")+"})(self);",l=new window.Blob([s],{type:"text/javascript"});if(e.bare)return l;var u=window.URL||window.webkitURL||window.mozURL||window.msURL,d=u.createObjectURL(l),h=new window.Worker(d);return h.objectURL=d,h}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(7),a=r(1),n=r(0),o=r(5),s=r.n(o),l=function(t){var e=new s.a;e.trigger=function(t){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];e.emit.apply(e,[t,t].concat(i))},e.off=function(t){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];e.removeListener.apply(e,[t].concat(i))};var r=function(e,r){t.postMessage({event:e,data:r})};t.addEventListener("message",function(a){var o=a.data;switch(o.cmd){case"init":var s=JSON.parse(o.config);t.demuxer=new i.a(e,o.typeSupported,s,o.vendor);try{Object(n.a)(!0===s.debug)}catch(t){console.warn("demuxerWorker: unable to enable logs")}r("init",null);break;case"demux":t.demuxer.push(o.data,o.decryptdata,o.initSegment,o.audioCodec,o.videoCodec,o.timeOffset,o.discontinuity,o.trackSwitch,o.contiguous,o.duration,o.accurateTimeOffset,o.defaultInitPTS)}}),e.on(a.a.FRAG_DECRYPTED,r),e.on(a.a.FRAG_PARSING_INIT_SEGMENT,r),e.on(a.a.FRAG_PARSED,r),e.on(a.a.ERROR,r),e.on(a.a.FRAG_PARSING_METADATA,r),e.on(a.a.FRAG_PARSING_USERDATA,r),e.on(a.a.INIT_PTS_FOUND,r),e.on(a.a.FRAG_PARSING_DATA,function(e,r){var i=[],a={event:e,data:r};r.data1&&(a.data1=r.data1.buffer,i.push(r.data1.buffer),delete r.data1),r.data2&&(a.data2=r.data2.buffer,i.push(r.data2.buffer),delete r.data2),t.postMessage(a,i)})};e.default=l}]).default});})();
!function(){window.NDP_DEBUG="0",window.NDP_DEBUG=!!+window.NDP_DEBUG;var t="none",e=0,n=window.location&&window.location.protocol||"",o="d1ba19b311442f00663cf58858840ea4f364eea4";var i={primary:null,location:null,autoPlay:!1,useCustomControls:!1,isDesktop:!0,adpolicy:35810,freewheel:{network:169843,url:n+"//29773.v.fwmrm.net/ad/p/1",siteSection:"TODAY_fallback_site_section",siteSectionFallbackID:884196,videoAssetFallbackID:90320017,adManagerUrl:"//media1.s-nbcnews.com/i/videoassets/pdk/vendor/AdManager-latest.{ext}",playerProfile:"nbcnews_{runtime}_live_https",logLevel:e,requestTimeout:7e3},pdk:{source:{version:"5.7.10",url:"//media1.s-nbcnews.com/i/videoassets/pdk/5.7.10/"},skin:{version:"brushed",url:"//media1.s-nbcnews.com/i/videoassets/pdk/5.7.10/skins/brushed/brushed.json"},layout:{version:"default",url:"//media1.s-nbcnews.com/i/videoassets/pdk/default_layout/cc_layout.xml",string:'<?xml version="1.0"?><layout><controls><region id="tpTitleRegion"><row id="tpTitleContainer" percentWidth="100"><control id="tpTitle"/></row></region><region id="tpAdCountdownRegion"><row id="tpAdCountdownContainer" percentWidth="100"><control id="tpAdCountdown" text="Your video will resume in {remainingTime} {second|seconds}"/></row></region><region id="tpBottomFloatRegion"><row><control id="tpPlay"/><group percentWidth="100"><spacer width="20"/><control id="tpCurrentTime"/><spacer width="10"/><control id="tpScrubber" showTooltip="never"/><spacer width="10"/><control id="tpTotalTime"/><control id="tpVolume" expandDirection="up"/><control id="tpButton" deck="forms" card="tpSubtitleStylesCard" icon="IconCC" /><control id="tpFullScreen"/></group></row></region></controls></layout>'},playerConfig:{formats:"F4M,MPEG4,M3U",expandVideo:!0,logLevel:t,allowFullScreen:"true",showControls:"true",showControlsBeforeVideo:"true",pluginFreeWheelSwf:"type=adcomponent|url={pdkUrl}swf/freewheel.swf{fwConfigString}",pluginFreeWheelJs:"type=adcomponent|url={pdkUrl}js/plugins/freewheel.js{fwConfigString}",pluginAkamaiSwf:"type=content|url={pdkUrl}swf/akamaiHD.swf|fallback=switch%3Dhttp|bufferProfile=livestable|priority=1|videoLayer=AkamaiHD",pluginAkamaiJs:"type=content|url={pdkUrl}js/plugins/akamaiHD.js|fallback=switch%3Dhttp|bufferProfile=livestable|priority=1|videoLayer=AkamaiHD",pluginLiveCaptions:"type=captions|url={pdkUrl}swf/liveCaptions.swf|priority=1|align=top",skinUrl:"{skinUrl}",layout:"{layoutString}"}},analytics:{CUSTOMER_KEY:o,serviceUrl:"https://nbcu-news-test.testonly.conviva.com",ConvivaApplicationName:"ndpplayer"}};"#testAdNetwork"===location.hash&&(i.freewheel.network=171224,i.freewheel.url=n+"//29cd8.v.fwmrm.net/ad/g/1",i.freewheel.siteSection="Today_Show_2015_Test_Site_Section",i.freewheel.siteSectionFallbackID=884196,i.freewheel.videoAssetFallbackID=90320017),window.$ndp&&window.$ndp.configuration?function t(e,n){for(var o in n)"object"!=typeof n[o]?void 0!==e[o]&&null!==e[o]||(e[o]=n[o]):(e.hasOwnProperty(o)||(e[o]={}),t(e[o],n[o]))}($ndp.configuration,i):(window.console,window.$ndp={},window.$ndp.configuration=i)}(),function(n){var o=parseInt(n.ndpDebugMode)||(n.NDP_DEBUG?3:0),i=("string"==typeof n.ndpDEBUG?"true"===n.ndpDEBUG.toLowerCase():n.ndpDEBUG)||n.NDP_DEBUG;function t(){if(!window.$ndp||!window.$ndp.configuration)throw new Error("Default configuration.js was not found.");this.configuration=$ndp.configuration,Object.defineProperties(this,{timestamp:{value:Date.now()},version:{value:"3.3.1"},datetime:{value:"2019-02-08 1523"},fileType:{value:"hls"},captions:{value:{}},events:{value:{}},models:{value:{}}}),this.isDebug(i),this.debugMode(o)}function a(t){return 1===(""+t).length?"0"+t:t}function l(t){return t=new Date(t),"[object Date]"===Object.prototype.toString.call(t)&&isFinite(t)||(t=new Date),t}t.prototype=Object.create({constructor:t},{__version:{value:"v3.3.1-7-ga324fb1e"},__datetime:{value:"201902111410"},__timestamp:{value:(new Date).getTime()},__has:{get:function(){return this.has}},__contains:{get:function(){return this.contains}},__extend:{get:function(){return this.extend}},__getDateTime:{value:function(t){return(t=l(t)).toLocaleDateString()+", "+this.getTimeString(t)}},__bind:{value:function(t,e){return function(){return e.apply(t,arguments)}}},__createId:{value:function(t){return(t=t||"")+(new Date).getTime()}},__cloneObjToJson:{value:function(t,e){return t&&null!==t?(e=e||function(t,e){var n=$ndp.models.domModel;return $ndp.isDomElement(e)?new n(e):e instanceof Function?e.toString().replace(/(\r)(\s+)/gm," "):"object"==typeof e&&null!==e?new(n=$ndp.models.nativeObj)(e):e},t=JSON.stringify(t,e),JSON.parse(t)):t}},__getTraceStack:{value:function(t){var e;e=t instanceof Error?t:this instanceof Error?this:new Error;var n=e.stack;try{throw e}catch(t){(n=t.stack)||(n=this.getStackTrace instanceof Function?this.getStackTrace():this.captureStackTrace instanceof Function?this.captureStackTrace():t.message)}return n||""}},getTimeString:{value:function(t,e){t=l(t);var n,o,i,s="get";e&&(s+="UTC");var r={hours:t[s+"Hours"](),minutes:t[s+"Minutes"](),seconds:t[s+"Seconds"](),milliseconds:t[s+"Milliseconds"]()};return n=a(r.hours),o=a(r.minutes),i=a(r.seconds),[n,o,i].join(":")+"."+r.milliseconds}},has:{value:function(t,e){if(!t)return!1;var n=t.length;for(;n--;)if(t[n]===e)return!0;return!1}},contains:{value:function(t,e,n){if(String.prototype.includes)return t.includes(e,n);"number"!=typeof n&&(n=0);return!(n+e.length>t.length)&&-1!==t.indexOf(e,n)}},extend:{value:function(t){if("function"==typeof Object.assign)return Object.assign.apply(null,arguments);if(!t)return t;for(var e=Object(t),n=1;n<arguments.length;n++){var o=arguments[n];if(o)for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(e[i]=o[i])}return e}},debugMode:{value:function(){if(arguments.length&&(o=parseInt(arguments[0])||o,this.console&&this.console.supportedMode.apply(this.console,arguments),this.configuration)){var t=this.configuration.pdk&&this.configuration.pdk.playerConfig||{},e=function(t){var e=window.tv&&window.tv.freewheel&&window.tv.freewheel.SDK;e&&e.setLogLevel(e[t])};0<o?t.logLevel=3<=o?(e("LOG_LEVEL_DEBUG"),"debug"):(e("LOG_LEVEL_INFO"),"info"):e("LOG_LEVEL_QUIET")}return o},enumerable:!0},isDebug:{value:function(){if(arguments.length){var t=arguments[0];if(t=Boolean("string"==typeof t?"true"===t.toLowerCase():t),i="boolean"==typeof t?t:i,!this.console){var e=this;return setTimeout(function(){e.isDebug.apply(this,arguments)},10),i}this.console.dump(i),n.NDP_DEBUG=i}return i},enumerable:!0},isNaO:{value:function(t){return null==t},enumerable:!0},isDomElement:{value:function(t){return"object"==typeof HTMLElement?t instanceof HTMLElement:t&&"object"==typeof t&&1===t.nodeType&&"string"==typeof t.nodeName},enumerable:!0},isArray:{value:function(t){return"[object Array]"===Object.prototype.toString.call([])&&"[object Array]"===Object.prototype.toString.call(t)},enumerable:!0},getFnName:{value:function(t){var e="function"==typeof t,n=e&&(t.name&&["",t.name]||t.toString().match(/function ([^\(]+)/));return e?n&&n[1]||"anonymous":"false"},enumerable:!0}}),n.$ndp=new t}(window),function(t){function e(t,e,n){this.id=t,this.name=e,this.url=n,this.isLiveMedia=arguments[3]||!1}e.prototype=Object.create({constructor:e},{getID:{value:function(){return this.id},enumerable:!0},getName:{value:function(){return this.name},enumerable:!0},getURL:{value:function(){return this.url},enumerable:!0},getCC:{value:function(){return this.cc},enumerable:!0},isLive:{value:function(){return this.isLiveMedia},enumerable:!0},getVideoData:{value:function(){var t=this.getURL(),e=0<t.indexOf("?")?"&":"?",n={};return n.url=t+e+"format=redirect&Tracking=true&Embedded=true&formats=MPEG4",n.cc=this.getCC(),n},enumerable:!0},assetTypes:{get:function(){return{fire:["fireTvOnceStreaming","FireTV-Once"],akamai:["akamaiMp4","Akamai Video"],limelight:["limelightMp4","Limelight MP4"],once:["unicornOnceStreaming","OnceURL"],hls:["liveHls","Live HLS"],hds:["liveHds","Live HDS"]}}}}),Object.defineProperty(t,"MediaAsset",{value:e,enumerable:!0})}(window.$ndp),function(o){var t=o.MediaAsset,e=window.screen.width<600;function n(t){this.raw=t,this.once=null,this.llnHigh=null,this.llnLow=null,this.liveM3U=null,this.liveF4M=null,this.captionType="srt",this.ccRoute="/captions?url=",this.cc=null,this.__parse()}((n.prototype=new t).constructor=n).constructor=t.prototype.constructor,Object.defineProperties(n.prototype,{getRawData:{value:function(){return this.raw},enumerable:!0},__parse:{value:function(){if(this.id=this.raw.guid,this.__parseURL(),this.__getCC(),this.isLiveMedia=!!this.liveM3U||!!this.liveF4M,this.isLiveMedia)if("native"===o.playbackAdapter){var t=/\?/.test(this.liveM3U);t=t?"&":"?",this.url=this.liveM3U+t+"format=redirect"}else this.url=this.liveF4M+"?MBR=TRUE&feed=All%20Content";else null!==this.once?this.url=this.once:null===this.llnHigh||e?this.url=this.llnLow:this.url=this.llnHigh;this.url=this.url.replace("http:","")},enumerable:!0},__getCC:{value:function(){this.raw.captionLinks&&this.raw.captionLinks[this.captionType]&&(this.cc=this.raw.captionLinks[this.captionType])},enumerable:!0},__parseURL:{value:function(){var t=this.raw.videoAssets.length,e=null,n=null;for(;t--;)e=this.raw.videoAssets[t],n=parseInt(e.bitRate,10),"MPEG4"!==e.format||o.has(this.assetTypes.fire,e.assetType)||(0===n?this.once=e.publicUrl:8e5===n?this.llnHigh=e.publicUrl:this.llnLow=e.publicUrl),"F4M"===e.format&&(this.liveF4M=e.publicUrl),"M3U"===e.format&&(this.liveM3U=e.publicUrl)},enumerable:!0}}),Object.defineProperty(o,"MPXMediaAsset",{value:n,enumerable:!0})}(window.$ndp),function(s){var t,e=s.MediaAsset,n=e.prototype.assetTypes,r="srt",a={once:2,limelight:1};function o(t){var e,n,o,i=(n=function(t){var e;e="native"===s.playbackAdapter?t.filter(c).map(p).map(u):t.filter(d);return e.sort(function(t,e){var n=a[l(t.assetType)]||0,o=a[l(e.assetType)]||0;return o-n||e.bitRate-t.bitRate})[0]}((e=t).videoAssets),{id:e.guid,cc:(o=e.captionLinks,o&&o[r]||""),url:n.publicUrl.replace("http:",""),isLive:"M3U"===n.format||"F4M"===n.format,isHLS:n.isHLS||!1});s.console.log("HLSPriorityMediaAsset video",t,"parsedData",i),this.raw=t,this.cc=i.cc,this.url=i.url,this.id=i.id,this.isLiveMedia=i.isLive,this.isHLS=i.isHLS}function l(t){for(var e in n)if(s.has(n[e],t))return e;return"once"}function d(t){return"M3U"!==t.format}function c(t){return"F4M"!==t.format}function p(t){return i(t,"format","redirect")}function u(t){var e=!1,n=null;return a.hasOwnProperty(l(t.assetType))||(n=i(t,"manifest","m3u"),e=!0),s.__extend({},t,n,{isHLS:e})}function i(t,e,n){var o=/\?/.test(t.publicUrl)?"&":"?",i=t.publicUrl+o+e+"="+n;return s.__extend({},t,{publicUrl:i})}((o.prototype=new e).constructor=o).constructor=e.prototype.constructor,o.prototype.getRawData=function(){return this.raw},o.prototype.useHLS=function(){return this.isHLS},Object.defineProperty(s,"HLSPriorityMediaAsset",{value:(t=window.MediaSource||window.WebKitMediaSource,/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||t&&"function"==typeof t.isTypeSupported?o:s.MPXMediaAsset),enumerable:!0})}(window.$ndp),function(e){window.console=window.console||void 0;var n=["error","trace"],o=["debug","warn","info"],i=["assert","count","dir","group","groupCollapsed","groupEnd","log","time","timeEnd"],s=["assert","count","debug","dir","error","group","groupCollapsed","groupEnd","info","log","time","timeEnd","trace","warn"],r=e.isDebug()||!1,a=parseInt(e.debugMode())||1,t=[];function l(){this.NotSupported=void 0===window.console;for(var t=s.length;t--;)this[s[t]]=this._noop;this._setLevels()}(l.prototype={constructor:l}).dump=function(){return arguments.length&&(r=Boolean(arguments[0]),this._setLevels()),r},l.prototype.supportedMode=function(){var t;arguments.length&&(a=parseInt(arguments[0])||a,arguments[1]&&(t=arguments[1]),this._setLevels(t));return a},l.prototype.supportedLevels=function(){return arguments.length&&(t=Array.prototype.slice.call(arguments[0],0)||t),t},l.prototype._setLevels=function(t){if(r){switch(this.supportedMode()){case 1:this.supportedLevels(n);break;case 2:this.supportedLevels(n.concat(o));break;case 3:this.supportedLevels(n.concat(o,i));break;case 4:t&&this.supportedLevels(t)}this.process()}else this.supportedLevels([]),this.process()},l.prototype.process=function(t){if(t=t||s,!this.NotSupported){var e=window.console||t;for(var n in e)isNaN(n)||(n=e[n]),this[n]=this._noop,this._build(n)}},l.prototype._noop=function(){},l.prototype._default=function(t){return Function.prototype.bind.call(console[t],console,"[NDPPlayerConsole]\t")},l.prototype._verify=function(t){Function.prototype.bind&&"object"==typeof console&&"object"==typeof console[t]&&(console[t]=Function.prototype.call.bind(console[t],console))},l.prototype._build=function(t){var e=this._isSupported(t)?t:"log";this._isSupported(e)&&(this._verify(e),this[t]="function"==typeof console[e]?this._default(e):this._noop)},l.prototype._isSupported=function(t){return!e.isNaO(window.console)&&!e.isNaO(window.console[t])&&!!e.__has(this.supportedLevels(),t)},e.console=new l}(window.$ndp),function(l){l.getQueryString=function(t){var e=new RegExp("[?&]"+t+"=([^&#]*)","i").exec(window.location.href);return e?e[1]:null},l.detectFullscreenSupport=function(t){var e="";document.mozFullScreenEnabled?e="moz":document.webkitFullscreenEnabled?e="webkit":document.fullscreenEnabled&&(e="MS");var n="fullscreenchange",o=document.isFullScreen||!1;switch(e){case"webkit":o=document.webkitIsFullScreen,n="webkit"+n;break;case"moz":o=document.mozFullScreen,n="moz"+n;break;case"MS":o=null!==document.msFullscreenElement,n="MSFullscreenChange";break;default:o=document.isFullScreen}var i={fullscreenElement:document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement,fullscreenEvent:n,fullscreenEnabled:o,fn:null};return t&&(t.requestFullscreen?i.fn={Request:"requestFullscreen",Exit:"exitFullscreen"}:t.webkitRequestFullscreen?i.fn={Request:"webkitRequestFullscreen",Exit:"webkitExitFullscreen"}:t.mozRequestFullScreen?i.fn={Request:"mozRequestFullScreen",Exit:"mozCancelFullScreen"}:t.msRequestFullscreen?i.fn={Request:"msRequestFullscreen",Exit:"msExitFullscreen"}:t.webkitEnterFullscreen&&(i.fn={Request:"webkitEnterFullscreen",Exit:"webkitExitFullscreen"})),i},l.detectAutoplay=function(e){if(l.AUTOPLAY=!1,!l.IsHTML5Supported())return l.detectFlash(function(t){l.AUTOPLAY=t,l.console.warn("***detectAutoplay:!IsHTML5Supported***",l.AUTOPLAY),e instanceof Function&&e()}),null;var t=document.createElement("video"),n=document.createElement("source");function o(){!1===t.paused&&(l.AUTOPLAY=!0,clearTimeout(i)),t.removeEventListener("canplay",o),l.console.warn("***detectAutoplay:onCanPlayHandler***",t),e instanceof Function&&e()}n.src="data:video/mp4;base64,AAAAFGZ0eXBNU05WAAACAE1TTlYAAAOUbW9vdgAAAGxtdmhkAAAAAM9ghv7PYIb+AAACWAAACu8AAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAnh0cmFrAAAAXHRraGQAAAAHz2CG/s9ghv4AAAABAAAAAAAACu8AAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAFAAAAA4AAAAAAHgbWRpYQAAACBtZGhkAAAAAM9ghv7PYIb+AAALuAAANq8AAAAAAAAAIWhkbHIAAAAAbWhscnZpZGVBVlMgAAAAAAABAB4AAAABl21pbmYAAAAUdm1oZAAAAAAAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAVdzdGJsAAAAp3N0c2QAAAAAAAAAAQAAAJdhdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAFAAOABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAAEmNvbHJuY2xjAAEAAQABAAAAL2F2Y0MBTUAz/+EAGGdNQDOadCk/LgIgAAADACAAAAMA0eMGVAEABGjuPIAAAAAYc3R0cwAAAAAAAAABAAAADgAAA+gAAAAUc3RzcwAAAAAAAAABAAAAAQAAABxzdHNjAAAAAAAAAAEAAAABAAAADgAAAAEAAABMc3RzegAAAAAAAAAAAAAADgAAAE8AAAAOAAAADQAAAA0AAAANAAAADQAAAA0AAAANAAAADQAAAA0AAAANAAAADQAAAA4AAAAOAAAAFHN0Y28AAAAAAAAAAQAAA7AAAAA0dXVpZFVTTVQh0k/Ou4hpXPrJx0AAAAAcTVREVAABABIAAAAKVcQAAAAAAAEAAAAAAAAAqHV1aWRVU01UIdJPzruIaVz6ycdAAAAAkE1URFQABAAMAAAAC1XEAAACHAAeAAAABBXHAAEAQQBWAFMAIABNAGUAZABpAGEAAAAqAAAAASoOAAEAZABlAHQAZQBjAHQAXwBhAHUAdABvAHAAbABhAHkAAAAyAAAAA1XEAAEAMgAwADAANQBtAGUALwAwADcALwAwADYAMAA2ACAAMwA6ADUAOgAwAAABA21kYXQAAAAYZ01AM5p0KT8uAiAAAAMAIAAAAwDR4wZUAAAABGjuPIAAAAAnZYiAIAAR//eBLT+oL1eA2Nlb/edvwWZflzEVLlhlXtJvSAEGRA3ZAAAACkGaAQCyJ/8AFBAAAAAJQZoCATP/AOmBAAAACUGaAwGz/wDpgAAAAAlBmgQCM/8A6YEAAAAJQZoFArP/AOmBAAAACUGaBgMz/wDpgQAAAAlBmgcDs/8A6YEAAAAJQZoIBDP/AOmAAAAACUGaCQSz/wDpgAAAAAlBmgoFM/8A6YEAAAAJQZoLBbP/AOmAAAAACkGaDAYyJ/8AFBAAAAAKQZoNBrIv/4cMeQ==",t.appendChild(n),t.autoplay=!0,t.addEventListener("canplay",o);var i=setTimeout(o,200)},l.IsHTML5Supported=function(){var t=document.createElement("video");return!(!t.canPlayType||!t.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"').replace(/no/,""))},l.detectFlash=function(o,i){var t=document.documentElement,e=function(t,e){var n=!!t;n&&((n=new Boolean(n)).blocked="blocked"===t),l.console.warn("Has FLASH",n),l.FLASH=n,e&&a.removeChild(e),"function"==typeof o&&o.call(i||this,l.FLASH)};if(l.FLASH instanceof Boolean)"function"==typeof o&&o.call(i||this,l.FLASH);else{var n;try{n="ActiveXObject"in window&&"Pan"in new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(t){l.console.error("Error reading ActiveXObject in FLASH Compat test",t)}if(!("plugins"in navigator&&"Shockwave Flash"in navigator.plugins||n))e(!1);else{var s,r=document.createElement("embed"),a=function(){var t=document.body;t||((t=document.createElement("body")).fake=!0);return t}();if(r.type="application/x-shockwave-flash",a.appendChild(r),!("Pan"in r||n))return void e("blocked",r);setTimeout(function(){t.contains(r)?(s=r.style.cssText,e(""===s||"blocked",r)):e("blocked"),a.fake&&a.parentNode&&a.parentNode.removeChild(a)},10)}}}}(window.$ndp),function(c){c.isDomElement,c.isNaO,c.console,c.isDebug;c.models={},c.models.nativeObj=function(t,e){if(!t||c.isArray(t))return t;for(var n in e=isNaN(parseInt(e))?2:e,this.$NDP_MAPPED_NATIVE=(new Date).getTime(),t){var o=t[n],i=Object.prototype.toString.call(o);if(/(undefined|null|string|number|boolean|array)/.test(i.toLowerCase()))this[n]=o;else if(c.isDomElement(o)){var s=c.models.domModel;this[n]=new s(o)}else if(o instanceof Function){if(!t.hasOwnProperty(n))continue;var r=o.toString().replace(/(\r*)(\s+)/gm," ").split(" "),a=[];7<r.length?a.push(i):a=r,this[n]=a.join(" ")}else if("[object Object]"===i&&e&&t.hasOwnProperty(n)){s=c.models.nativeObj;var l=--e;this[n]=new s(o,l)}}},c.models.domModel=function(t,e){if(!t)return{};for(var n in this.$NDP_MAPPED_ELEMENT=(new Date).getTime(),t)if("on"!==n.substring(0,2)){var o=t[n],i=Object.prototype.toString.call(o);/(undefined|null|string|number|boolean|array)/.test(i.toLowerCase())?this[n]=o:e&&(this[n]=i)}},c.models.videoModel=function(t){if(!t)return{};for(var e in t)if("on"!==e.substring(0,2)){var n=t[e],o=Object.prototype.toString.call(n);if(/(undefined|null|string|number|boolean|array)/.test(o.toLowerCase()))this[e]=n;else switch(e){case"seekable":var i=t.seekable||[];this.seekable=[];for(var s=0;s<i.length;s++)this.seekable.push({start:i.start(s),end:i.end(s)});break;case"buffered":var r=t.buffered||[];this.buffered=[];for(s=0;s<r.length;s++)this.buffered.push({start:r.start(s),end:r.end(s)});break;case"played":var a=t.played||[];this.played=[];for(s=0;s<a.length;s++)this.played.push({start:a.start(s),end:a.end(s)});break;case"textTracks":var l=t.textTracks||[];this.textTracks=[];for(s=0;s<l.length;s++)this.textTracks.push({id:l[s].id,kind:l[s].kind,label:l[s].label,mode:l[s].mode,language:l[s].language,cues:l[s].cues,activeCues:l[s].activeCues,src:l[s].src,srclang:l[s].srclang});break;case"videoTracks":var d=t.videoTracks||[];this.videoTracks=[];for(s=0;s<d.length;s++)this.videoTracks.push({id:d[s].id,kind:d[s].kind,label:d[s].label,language:d[s].language,selected:d[s].selected})}}this.fullscreen=c.detectFullscreenSupport(t)}}(window.$ndp),function(t){function e(){}e.prototype.getFile=function(t,e){if(t&&""!==t){var n=new XMLHttpRequest,o=function(){n.addEventListener("load",o),e(n.responseText)};n.addEventListener("load",o),n.open("GET",t),n.send()}else e("")},e.prototype.parse=function(t){if(!t||0===t.length)return[];for(var e,n=t.split(/\r\n\r\n|\n\n/),o=[],i=n.length;i--;)(e=this.parseCue(n.shift()))&&o.push(e);return o},e.prototype.parseCue=function(t){if(!t||0===t.length)return null;for(var e=t.split(/\r\n|\n|\r/);0===e[0].length||!isNaN(+e[0]);)if(e.shift(),0===e.length)return null;var n=e.shift().split(" "),o=e.join("\n");return new(window.VTTCue||window.TextTrackCue)(this.parseTime(n[0]),this.parseTime(n[2]),o)},e.prototype.parseTime=function(t){var e=t.split(":"),n=60*e.shift()*60,o=60*e.shift(),i=e.shift().split(",");return n+o+ +i.shift()+i.shift()/1e3},t.SRTParser=new e}(window.$ndp),function(t){var i=[];function e(){}e.prototype.create=function(t){for(var e=[],n=null,o=i.length;o--;)(n=i[o]).canHandle(t)&&e.push(n);return e},e.prototype.add=function(t){if(!(t.canHandle instanceof Function))throw new Error("AdapterFactory.add() - An adapter must implement a static 'canHandle' method");!1===function(t){var e=i.length;for(;e--;)if(i[e]===t)return!0;return!1}(t)&&i.push(t)},t.AdapterFactory=new e}(window.$ndp),function(o){var i=[];function t(){}t.prototype.create=function(t,e){if(o.console.debug("ModuleManager.create",(new Date).getTime()),!(t instanceof o.MessageBus))throw new Error("ModuleManager.create() cannot be called without an instance of MessageBus");for(var n=i.length;n--;)(new i[n]).init(t,e)},t.prototype.add=function(t){!1===function(t){var e=i.length;for(;e--;)if(i[e]===t)return!0;return!1}(t)&&i.push(t)},o.ModuleManager=new t}(window.$ndp),function(t){var n=t.MediaAsset;function e(){this.pointer=0,this.items=[]}e.prototype.add=function(t){if(!(t instanceof n))throw new Error("Only media of type NDP MediaAsset are supported");this.items.push(t)},e.prototype.remove=function(t){var e=t instanceof n?this.getAssetAtIndex(t):t;e<this.items.length&&this.items.splice(e,1)},e.prototype.getAssetIndex=function(t){for(var e=this.items.length;e--;)if(this.items[e]===t)return e;return-1},e.prototype.getAssetAtIndex=function(t){return this.items[t]||null},e.prototype.next=function(){return this.items[++this.pointer]||null},e.prototype.previous=function(){return this.items[--this.pointer]||null},e.prototype.first=function(){return this.pointer=0,this.items[this.pointer]||null},e.prototype.last=function(){return this.pointer=this.items.length-1,this.items[this.pointer]||null},e.prototype.length=function(){return this.items.length},t.Playlist=e}(window.$ndp),function(t){function e(t,e){this.type=t,this.payload=e,this.autoDispatch=!0}e.prototype.getType=function(){return this.type},e.prototype.getPayload=function(){return this.payload},e.prototype.makeNow=function(){return window.performance&&window.performance.now()||null},e.prototype.getNow=function(){return this.timing||this.makeNow()},t.events.Event=e}(window.$ndp),function(o){var t=o.events.Event;function e(t,e,n){n=n||o.DataStore.activePlayer,this.type=t,this.payload=new o.models.CommandDataObject(e),this.asset=e.asset,this.playerId=n.dataStore.id,this.playerIndex=n.dataStore.index,this.autoDispatch=!1}e.UNLOAD=["NDP_CommandEvent_UNLOAD"],e.LOAD=["NDP_CommandEvent_LOAD"],e.ADLOAD=["NDP_CommandEvent_ADLOAD"],e.PLAY=["NDP_CommandEvent_PLAY"],e.PAUSE=["NDP_CommandEvent_PAUSE"],e.STOP=["NDP_CommandEvent_STOP"],e.SETPLAYHEAD=["NDP_CommandEvent_SETPLAYHEAD"],e.SETVOLUME=["NDP_CommandEvent_SETVOLUME"],e.FULLSCREEN=["NDP_CommandEvent_FULLSCREEN"],e.CAPTION=["NDP_CommandEvent_CAPTION"],e.UPDATEDISPLAYBASE=["NDP_CommandEvent_UPDATEDISPLAYBASE"],e.CAPTIONOPTIONS=["NDP_CommandEvent_CAPTIONOPTIONS"],(e.prototype=new t).__super=t.prototype,(e.prototype.constructor=e).constructor=t.prototype.constructor,e.prototype.getAsset=function(){return this.asset},e.prototype.getVolume=function(){return this.payload.volume},e.prototype.seekTo=function(){return this.payload.seekTo},e.prototype.isCaption=function(){return this.payload.caption},e.prototype.isAutoPlay=function(){return this.payload.isAutoPlay},e.prototype.isLive=function(){return this.asset.isLive},e.prototype.getPlayer=function(){return o.players.findByIndex(this.playerIndex)},o.events.CommandEvent=e}(window.$ndp),function(o){var t=o.events.Event;function e(t,e,n){n=n||o.DataStore.activePlayer,this.type=t,this.payload=new o.models.CommandDataObject(e),this.asset=e.asset,this.playerId=n.dataStore.id,this.playerIndex=n.dataStore.index}e.LOADED=["NDP_PlaybackEvent_LOADED"],e.PLAY=["NDP_PlaybackEvent_PLAY"],e.PLAYING=["NDP_PlaybackEvent_PLAYING"],e.START=["NDP_PlaybackEvent_START"],e.PAUSE=["NDP_PlaybackEvent_PAUSE"],e.STOP=["NDP_PlaybackEvent_STOP"],e.COMPLETE=["NDP_PlaybackEvent_COMPLETE"],e.UNLOADED=["NDP_PlaybackEvent_UNLOADED"],e.SEEK=["NDP_PlaybackEvent_SEEK"],e.PROGRESS=["NDP_PlaybackEvent_PROGRESS"],e.VOLUME_CHANGE=["NDP_PlaybackEvent_VOLUME_CHANGE"],e.FULLSCREEN=["NDP_PlaybackEvent_FULLSCREEN"],e.HAS_CAPTIONS=["NDP_PlaybackEvent_HAS_CAPTIONS"],e.PLAYLIST_COMPLETE=["NDP_PlaybackEvent_PLAYLIST_COMPLETE"],(e.prototype=new t).__super=t.prototype,(e.prototype.constructor=e).constructor=t.prototype.constructor,e.prototype.getAsset=function(){return this.asset},e.prototype.getVolume=function(){return this.payload.volume},e.prototype.getPlayheadPosition=function(){return this.payload.playheadPosition},e.prototype.getTotalLength=function(){return this.payload.totalLength},e.prototype.getRemainingTime=function(){return this.payload.totalLength-this.payload.playheadPosition},e.prototype.isLive=function(){return this.payload.isLive},o.events.PlaybackEvent=e}(window.$ndp),function(o){var t=o.events.Event;function e(t,e,n){n=n||o.DataStore.activePlayer,this.type=t,this.payload=new o.models.CommandDataObject(e),this.playerId=n.dataStore.id,this.playerIndex=n.dataStore.index}e.ADSKIP=["NDP_AdEvent_ADSKIP"],e.NOPREROLL=["NDP_AdEvent_NOPREROLL"],e.ERROR=["NDP_AdEvent_ERROR"],e.PLAY=["NDP_AdEvent_PLAY"],e.START=["NDP_AdEvent_START"],e.PAUSE=["NDP_AdEvent_PAUSE"],e.CLICK=["NDP_AdEvent_CLICK"],e.PROGRESS=["NDP_AdEvent_PROGRESS"],e.COMPLETE=["NDP_AdEvent_COMPLETE"],e.TIMEOUT=["NDP_AdEvent_TIMEOUT"],e.VOLUME_CHANGE=["NDP_AdEvent_VOLUME_CHANGE"],e.FULLSCREEN=["NDP_AdEvent_FULLSCREEN"],(e.prototype=new t).__super=t.prototype,(e.prototype.constructor=e).constructor=t.prototype.constructor,e.prototype.getVolume=function(){return this.payload.volume},e.prototype.getPlayheadPosition=function(){return this.payload.playheadPosition},e.prototype.getTotalLength=function(){return this.payload.totalLength},e.prototype.getRemainingTime=function(){return this.payload.totalLength-this.payload.playheadPosition},e.prototype.getBanners=function(){return this.payload.banners},o.events.AdEvent=e}(window.$ndp),function(o){var t=o.events.Event;function e(t,e,n){n=n||o.DataStore.activePlayer,this.type=t,this.payload=new o.models.CommandDataObject(e),this.playerId=n.dataStore.id,this.playerIndex=n.dataStore.index}e.MEDIA_ERROR=["NDP_ErrorEvent_MEDIA_ERROR"],e.NETWORK_ERROR=["NDP_ErrorEvent_NETWORK_ERROR"],e.TIMEOUT_ERROR=["NDP_ErrorEvent_TIMEOUT_ERROR"],(e.prototype=new t).__super=t.prototype,(e.prototype.constructor=e).constructor=t.prototype.constructor,e.prototype.getError=function(){return this.payload.error},o.events.ErrorEvent=e}(window.$ndp),function(o){var t=o.events.Event;function e(t,e,n){n=n||o.DataStore.activePlayer,this.type=t,this.payload=new o.models.CommandDataObject(e),this.playerId=n.dataStore.id,this.playerIndex=n.dataStore.index,this.timing=this.makeNow()}e.REQUEST_START=["NDP_PerfEvent_REQUEST_START"],e.REQUEST_END=["NDP_PerfEvent_REQUEST_END"],(e.prototype=new t).__super=t.prototype,(e.prototype.constructor=e).constructor=t.prototype.constructor,o.events.PerfEvent=e}(window.$ndp),function(o){var t=o.events.Event;function e(t,e,n){n=n||o.DataStore.activePlayer,this.type=t,this.payload=new o.models.CommandDataObject(e),this.playerId=n.dataStore.id,this.playerIndex=n.dataStore.index,this.autoDispatch=!1}e.ELEMENT_CREATED=["NDP_SystemEvent_ELEMENT_CREATED"],e.PLAYER_CREATED=["NDP_SystemEvent_PLAYER_CREATED"],e.PLAYER_ACTIVE=["NDP_SystemEvent_PLAYER_ACTIVE"],e.VIEWPORT_UPDATE=["NDP_SystemEvent_VIEWPORT_UPDATE"],e.PLAYER_LOADED=["NDP_SystemEvent_PLAYER_LOADED"],e.SHUTDOWN=["NDP_SystemEvent_SHUTDOWN"],e.SWITCH_NATIVE_ADAPTERS=["NDP_SystemEvent_SWITCH_NATIVE_ADAPTERS"],e.VIDEO_ERROR=["NDP_SystemEvent_VIDEO_ERROR"],(e.prototype=new t).__super=t.prototype,(e.prototype.constructor=e).constructor=t.prototype.constructor,e.prototype.getVideoElement=function(){return this.payload.videoElement},e.prototype.getActivePlayer=function(){return o.DataStore.activePlayer},o.events.SystemEvent=e}(window.$ndp),function(t){var e=t.events.Event;function n(t){this.type=t}n.ERROR=["NDP_VideoEvent_ERROR"],n.STALLED=["NDP_VideoEvent_STALLED"],n.EMPTIED=["NDP_VideoEvent_EMPTIED"],n.ABORT=["NDP_VideoEvent_ABORT"],n.LOAD=["NDP_VideoEvent_LOAD"],n.LOADED=["NDP_VideoEvent_LOADED"],n.PLAY=["NDP_VideoEvent_PLAY"],n.PLAYING=["NDP_VideoEvent_PLAYING"],n.PAUSE=["NDP_VideoEvent_PAUSE"],n.COMPLETE=["NDP_VideoEvent_COMPLETE"],n.STOP=["NDP_VideoEvent_STOP"],n.SEEK=["NDP_VideoEvent_SEEK"],n.SEEKED=["NDP_VideoEvent_SEEKED"],n.PROGRESS=["NDP_VideoEvent_PROGRESS"],n.VOLUME_CHANGE=["NDP_VideoEvent_VOLUME_CHANGE"],n.FULLSCREEN=["NDP_VideoEvent_FULLSCREEN"],n.SWITCH_ADAPTERS=["NDP_VideoEvent_SWITCH_ADAPTERS"],(n.prototype=new e).__super=e.prototype,(n.prototype.constructor=n).constructor=e.prototype.constructor,t.events.VideoEvent=n}(window.$ndp),function(a,l){function t(){this.listeners={},this.listeners["*"]=[]}t.prototype.addListener=function(t,e){if(!e)throw new Error("Event Listeners cannot be null");var n=this.listeners[t]||[];arguments[2]&&(e={scope:arguments[2],listener:e}),-1===this.__getListenerIndex(n,e)&&n.push(e),this.listeners[t]=n},t.prototype.removeListener=function(t,e){var n=this.listeners[t]||[];arguments[2]&&(e={scope:arguments[2],listener:e});var o=this.__getListenerIndex(n,e);-1<o&&n.splice(o,1)},t.prototype.once=function(t,e){this.addListener(t,{once:!0,listener:e})},t.prototype.notify=function(t){var e,n,o=this.listeners[t.getType()]||[];if(t.autoDispatch&&(o=o.concat(this.listeners["*"])),0<o.length)for(n=o.length,l&&(a.DataStore.currentEvent=t.type);n--;){var i=(e=o[n]).scope?e.scope:e,s=!(this instanceof window.NDPPlayer),r=a.DataStore.activePlayer===this;(s||r)&&(e instanceof Function?e(t):e.notify instanceof Function?e.notify(t):(s||(i&&i.dataStore.id)===t.playerId)&&e.listener.call(e.scope,t))}},t.prototype.__getListenerIndex=function(t,e){var n=null,o=null,i=null,s=t.length;for(e.scope&&(n=e.scope,o=e.listener);s--;)if((i=t[s])===e||null!==n&&null!==o&&i.scope===n&&i.listener===o)return s;return-1},a.AbstractObserver=window.$ndp.AbstractObserver||t}(window.$ndp,window.NDP_DEBUG),function(s){var r="NDPAdAdapter",t=s.ModuleManager,a=s.AdapterFactory,e=s.AbstractObserver,l=s.events.CommandEvent,n=s.events.AdEvent,d=s.events.SystemEvent;function o(){this.mbus=null,this.domElement=null,this.adapters=[]}((o.prototype=new e).constructor=o).constructor=e.prototype.constructor,o.prototype.__super=e.prototype,o.prototype.init=function(t,e){s.console.debug("AdModule.init",(new Date).getTime()),this.mbus=t,this.domElement=e,this.__addHandlers();for(var n=a.create(r),o=n.length,i=null;o--;)i=n[o],this.adapters.push(new i(this,e));this.mbus.addListener(l.LOAD,this.dispatch,this),this.mbus.addListener(d.ELEMENT_CREATED,this.dispatch,this)},o.prototype.destroy=function(){this.mbus.removeListener(d.ELEMENT_CREATED,this.dispatch,this),this.mbus.removeListener(l.LOAD,this.dispatch,this),this.__removeHandlers();for(var t=this.adapters.length;t--;)this.adapters[t].destroy();this.adapters.length=0,this.domElement=null,this.mbus=null},o.prototype.notify=function(t){t.getType()===n.COMPLETE&&this.__removeHandlers(),this.mbus.notify(t)},o.prototype.dispatch=function(t){t.getType()===l.LOAD&&this.__addHandlers(),this.__super.notify.call(this,t)},o.prototype.__addHandlers=function(){this.mbus.addListener(l.PLAY,this.dispatch,this),this.mbus.addListener(l.PAUSE,this.dispatch,this),this.mbus.addListener(l.STOP,this.dispatch,this),this.mbus.addListener(l.SETVOLUME,this.dispatch,this),this.mbus.addListener(l.FULLSCREEN,this.dispatch,this),this.mbus.addListener(l.CAPTION,this.dispatch,this),this.mbus.addListener(l.UPDATEDISPLAYBASE,this.dispatch,this)},o.prototype.__removeHandlers=function(){this.mbus.removeListener(l.PLAY,this.dispatch,this),this.mbus.removeListener(l.PAUSE,this.dispatch,this),this.mbus.removeListener(l.STOP,this.dispatch,this),this.mbus.removeListener(l.SETVOLUME,this.dispatch,this),this.mbus.removeListener(l.FULLSCREEN,this.dispatch,this),this.mbus.removeListener(l.CAPTION,this.dispatch,this),this.mbus.removeListener(l.UPDATEDISPLAYBASE,this.dispatch,this)},o.prototype.toString=function(){return"AdModule"},t.add(o),s.adapterTypes=s.adapterTypes||{},s.adapterTypes.AD=r}(window.$ndp),function(t){function e(){this.messageQueue=[],this.yieldDelay=10,this.timer=-1}(e.prototype=new t).__super=t.prototype,(e.prototype.constructor=e).constructor=t.prototype.constructor,e.prototype.notify=function(t){this.messageQueue.push(t),t&&t.type===$ndp.events.CommandEvent.FULLSCREEN?this.__process():this.__setYieldTimer()},e.prototype.__process=function(){var t=this.messageQueue.shift();this.__super.notify.call(this,t),this.timer=-1,this.__setYieldTimer()},e.prototype.__setYieldTimer=function(){var t;0<this.messageQueue.length&&-1===this.timer&&(this.timer=setTimeout((t=this,function(){t.__process()}),this.yieldDelay))},window.$ndp.MessageBus=e}(window.$ndp.AbstractObserver),function(i){var t=i.ModuleManager,s=i.AdapterFactory,e=i.AbstractObserver,n=i.events.CommandEvent,r=i.events.SystemEvent,o=(i.events.PlaybackEvent,i.events.AdEvent);function a(){this.mbus=null,this.adapter=null,this.domElement=null}((a.prototype=new e).constructor=a).constructor=e.prototype.constructor,a.prototype.__super=e.prototype,a.prototype.init=function(t,e){var n;i.console.debug("PlaybackModule.init",(new Date).getTime()),this.mbus=t,this.domElement=e,this.mbus.once(r.SHUTDOWN,(n=this,function(t){n.destroy()})),this.__initHandlers();var o=s.create("PDK_INIT")[0];!o||this.adapter instanceof o||(this.adapter=new o(this,this.domElement))},a.prototype.destroy=function(){this.__removeAllHandlers(),this.adapter.destroy(),this.adapter=null,this.domElement=null,this.mbus=null},a.prototype.notify=function(t){this.mbus.notify(t)},a.prototype.dispatch=function(t){this.__super.notify.call(this,t)},a.prototype.__onLoad=function(t){var e=s.create(t.getAsset())[0];$ndp.console.debug("*** PlaybackModule.__onLoad ***",e,t),!e||this.adapter instanceof e||(this.adapter=new e(this,this.domElement)),this.dispatch(t)},a.prototype.__toggleHandlers=function(t){this.dispatch(t)},a.prototype.__initHandlers=function(){this.mbus.addListener(o.NOPREROLL,this.__toggleHandlers,this),this.mbus.addListener(o.START,this.__toggleHandlers,this),this.mbus.addListener(o.COMPLETE,this.__toggleHandlers,this),this.__addHandlers()},a.prototype.__addHandlers=function(){this.mbus.addListener(n.LOAD,this.__onLoad,this),this.mbus.addListener(n.PLAY,this.dispatch,this),this.mbus.addListener(n.PAUSE,this.dispatch,this),this.mbus.addListener(n.STOP,this.dispatch,this),this.mbus.addListener(n.SETVOLUME,this.dispatch,this),this.mbus.addListener(n.SETPLAYHEAD,this.dispatch,this),this.mbus.addListener(n.FULLSCREEN,this.dispatch,this),this.mbus.addListener(n.CAPTION,this.dispatch,this)},a.prototype.__removeHandlers=function(){this.mbus.removeListener(n.LOAD,this.__onLoad,this),this.mbus.removeListener(n.PLAY,this.dispatch,this),this.mbus.removeListener(n.PAUSE,this.dispatch,this),this.mbus.removeListener(n.STOP,this.dispatch,this),this.mbus.removeListener(n.SETVOLUME,this.dispatch,this),this.mbus.removeListener(n.SETPLAYHEAD,this.dispatch,this),this.mbus.removeListener(n.FULLSCREEN,this.dispatch,this),this.mbus.removeListener(n.CAPTION,this.dispatch,this)},a.prototype.__removeAllHandlers=function(){this.__removeHandlers(),this.mbus.removeListener(o.START,this.__toggleHandlers,this),this.mbus.removeListener(o.COMPLETE,this.__toggleHandlers,this)},t.add(a),i.adapterTypes=i.adapterTypes||{},i.adapterTypes.PLAYBACK="NDPlaybackAdapter"}(window.$ndp),function(t){var e=t.ModuleManager,n=t.AbstractObserver,o=(t.events.PlaybackEvent,t.events.CommandEvent);t.events.AdEvent,t.events.ErrorEvent,t.events.VideoEvent,t.console;function i(){this.bus=null,this.instance=null,this.currentProperties=null,this.ClassMap=null,this.ui=null}((i.prototype=new n).constructor=i).constructor=n.prototype.constructor,i.prototype.__super=n.prototype,i.prototype.init=function(t,e){this.bus=t,this.parentElem=e,this.ClassMap={fontType:".ccFontType",fontSize:".ccFontSize",fontOpacity:".ccFontOpacity",fontEdge:".ccEdge",fontColor:".ccFontColor",backgroundOpacity:".ccBackgroundOpacity",backgroundColor:".ccBackgroundColor",borderColor:".ccBorderColor",presetButtons:".ccPresetButton",submitButton:".ccSubmit"},this.captionOptions=$ndp.captions.options,this.ui={colorMode:"fontColor"},this.localStorageName="NDP.captionOptions",this.cardInstance=null,this.ccElement=document.getElementById("cc"),this.__addHandlers(),this.loadDefaults(),this.captionWindow=document.createElement("div"),this.captionWindow.className="ndpCaptionCardPreviewWindow",this.captionText=document.createElement("span"),this.captionText.className="ndpCaptionsUserSettingPreview",this.captionText.textContent="This is a preview of your caption settings.",this.updateCaptionStyle({root:this,options:this.captionOptions,notPreview:!0})},i.prototype.generateCard=function(){this.showCaptions(!1),null===this.cardInstance?this.buildUI():this.displayCard()},i.prototype.loadDefaults=function(){this.getConfigurationFromLocalStorage()||this.resetToDefaults({options:this.captionOptions})},i.prototype.supportsLocalStorage=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}},i.prototype.getConfigurationFromLocalStorage=function(){if(this.supportsLocalStorage()){var t=window.localStorage.getItem(this.localStorageName);if(t)return this.captionOptions.currentSettings=JSON.parse(t),!0}return!1},i.prototype.saveConfigurationToLocalStorage=function(t){if(t.root.supportsLocalStorage()){var e=JSON.stringify(t.options.currentSettings);return window.localStorage[t.root.localStorageName]=e,!0}return!1},i.prototype.resetToDefaults=function(t){for(var e in t.options)t.options[e].default&&(t.options.currentSettings[e]=t.options[e].default)},i.prototype.buildUI=function(t){var e=this;this.cardInstance=document.createElement("div"),this.cardInstance.className="ndpCaptionOptionsCard",this.cardInstance.id="cardModule",this.cardHeader=document.createElement("div"),this.cardHeader.className="ndpCaptionCardHeader",this.cardLabel=document.createElement("span"),this.cardLabel.textContent="Caption Options",this.cardLabel.className="ndpCaptionCardLabel",this.cardHeader.appendChild(this.cardLabel),this.closeButton=document.createElement("button"),this.closeButton.textContent="X",this.closeButton.className="ndpCaptionCardClose",this.closeButton.onclick=function(){e.hideCard()},this.cardHeader.appendChild(this.closeButton),this.cardInstance.appendChild(this.cardHeader),this.settingsArea=document.createElement("div"),this.settingsArea.className="ndpCaptionCardSettings",this.testCC=document.createElement("div"),this.testCC.className="ndpCaptionCardPreviewArea",this.previewWrapper=document.createElement("div"),this.previewWrapper.className="ndpCaptionCardPreviewWrapper",this.captionWindow.appendChild(this.captionText),this.previewWrapper.appendChild(this.captionWindow),this.testCC.appendChild(this.previewWrapper),this.cardInstance.appendChild(this.testCC),this.presetWrapper=document.createElement("div"),this.presetWrapper.className="ndpCaptionCardPresetWrapper",this.presetLabel=document.createElement("span"),this.presetLabel.textContent="Presets",this.presetLabel.className="ndpCaptionCardPresetLabel",this.presetWrapper.appendChild(this.presetLabel),this.settingsArea.appendChild(this.presetWrapper),this.styleWrapper=document.createElement("div"),this.styleWrapper.className="ndpCaptionCardStyleWrapper",this.settingsArea.appendChild(this.styleWrapper),this.colorWrapper=document.createElement("div"),this.colorWrapper.className="ndpCaptionColorsWrapper",this.colorModeWrapper=document.createElement("div"),this.colorModeWrapper.className="ndpCaptionModeWrapper",this.colorOptionsWrapper=document.createElement("div"),this.colorOptionsWrapper.className="ndpCaptionColors",this.colorWrapper.appendChild(this.colorModeWrapper),this.colorWrapper.appendChild(this.colorOptionsWrapper),this.settingsButtonsWrapper=document.createElement("div"),this.settingsButtonsWrapper.className="ndpCaptionSettingsButtonsWrapper",this.settingsArea.appendChild(this.colorWrapper),this.settingsArea.appendChild(this.settingsButtonsWrapper),this.cardInstance.appendChild(this.settingsArea),this.fontTypeWrapper=this.createFormWrapper("Font",this.styleWrapper),this.renderDropDown({element:this.fontTypeWrapper,key:"fontType",options:this.captionOptions,selected:this.captionOptions.currentSettings.fontType,callBack:this.onDropdownSelection,root:this,preview:this.updateCaptionStyle});for(var n in this.captionOptions.presets.options)this.renderButton({element:this.presetWrapper,key:"presets",text:"Aa",key:n,options:this.captionOptions,callBack:this.onPresetButtonClick,root:this,preview:this.updateCaptionStyle,buttonType:"preset"});for(var o in this.fontSizeWrapper=this.createFormWrapper("Font size",this.styleWrapper),this.fontSizeStepper=this.createStepperWrapper(),this.fontSizeWrapper.appendChild(this.fontSizeStepper),this.renderButton({element:this.fontSizeStepper,key:"fontSize",text:"-",type:"-",options:this.captionOptions,callBack:this.onPlusMinusClick,root:this,preview:this.updateCaptionStyle,buttonType:"stepper"}),this.renderButton({element:this.fontSizeStepper,key:"fontSize",text:"+",type:"+",options:this.captionOptions,callBack:this.onPlusMinusClick,root:this,preview:this.updateCaptionStyle,buttonType:"stepper"}),this.fontOpacityWrapper=this.createFormWrapper("Font opacity",this.styleWrapper),this.fontOpacityStepper=this.createStepperWrapper(),this.fontOpacityWrapper.appendChild(this.fontOpacityStepper),this.renderButton({element:this.fontOpacityStepper,key:"fontOpacity",text:"-",type:"-",options:this.captionOptions,callBack:this.onPlusMinusClick,root:this,preview:this.updateCaptionStyle,buttonType:"stepper"}),this.renderButton({element:this.fontOpacityStepper,key:"fontOpacity",text:"+",type:"+",options:this.captionOptions,callBack:this.onPlusMinusClick,root:this,preview:this.updateCaptionStyle,buttonType:"stepper"}),this.edgeEffectsWrapper=this.createFormWrapper("Edge effects",this.styleWrapper),this.renderDropDown({element:this.edgeEffectsWrapper,key:"fontEdge",options:this.captionOptions,selected:this.captionOptions.currentSettings.fontEdge,callBack:this.onDropdownSelection,root:this,preview:this.updateCaptionStyle}),this.bgOpacityWrapper=this.createFormWrapper("Background opacity",this.styleWrapper),this.bgOpacityStepper=this.createStepperWrapper(),this.bgOpacityWrapper.appendChild(this.bgOpacityStepper),this.renderButton({element:this.bgOpacityStepper,key:"backgroundOpacity",text:"-",type:"-",options:this.captionOptions,callBack:this.onPlusMinusClick,root:this,preview:this.updateCaptionStyle,buttonType:"stepper"}),this.renderButton({element:this.bgOpacityStepper,key:"backgroundOpacity",text:"+",type:"+",options:this.captionOptions,callBack:this.onPlusMinusClick,root:this,preview:this.updateCaptionStyle,buttonType:"stepper"}),this.windowOpacityWrapper=this.createFormWrapper("Window opacity",this.styleWrapper),this.windowOpacityStepper=this.createStepperWrapper(),this.windowOpacityWrapper.appendChild(this.windowOpacityStepper),this.renderButton({element:this.windowOpacityStepper,key:"windowOpacity",text:"-",type:"-",options:this.captionOptions,callBack:this.onPlusMinusClick,root:this,preview:this.updateCaptionStyle,buttonType:"stepper"}),this.renderButton({element:this.windowOpacityStepper,key:"windowOpacity",text:"+",type:"+",options:this.captionOptions,callBack:this.onPlusMinusClick,root:this,preview:this.updateCaptionStyle,buttonType:"stepper"}),this.renderButton({element:this.colorModeWrapper,key:"fontColor",text:"Font Color",state:this.ui,options:this.captionOptions,callBack:this.onColorModeSelection,root:this,preview:this.updateCaptionStyle,buttonType:"mode",selected:!0}),this.renderButton({element:this.colorModeWrapper,key:"backgroundColor",text:"Background Color",state:this.ui,options:this.captionOptions,callBack:this.onColorModeSelection,root:this,preview:this.updateCaptionStyle,buttonType:"mode"}),this.renderButton({element:this.colorModeWrapper,key:"windowColor",text:"Window Color",state:this.ui,options:this.captionOptions,callBack:this.onColorModeSelection,root:this,preview:this.updateCaptionStyle,buttonType:"mode"}),this.captionOptions.colors)this.renderButton({element:this.colorOptionsWrapper,key:o,state:this.ui,options:this.captionOptions,callBack:this.onColorSelection,root:this,preview:this.updateCaptionStyle,buttonType:"color"});this.renderButton({element:this.settingsButtonsWrapper,key:"RESET",text:"RESET",callBack:this.onColorSelection,root:this,preview:this.updateCaptionStyle,options:this.captionOptions,callBack:this.onResetButtonClick}),this.renderButton({element:this.settingsButtonsWrapper,key:"SAVE",text:"SAVE",root:this,options:this.captionOptions,callBack:this.onSubmitButtonClick}),this.parentElem.appendChild(this.cardInstance)},i.prototype.renderDropDown=function(t){var e=document.createElement("select");t.element.appendChild(e);var n=t.options[t.key];for(var o in n.options){var i=new Option;i.value=n.options[o],(i.text=o)===t.selected&&(i.defaultSelected=!0),e.options.add(i)}e.onchange=function(){t.callBack(this,t)}},i.prototype.renderButton=function(t){var e=document.createElement("button");if(t.element.appendChild(e),t.text&&(e.innerHTML=t.text),"color"===t.buttonType)e.style.backgroundColor=t.options.colors[t.key];else if("preset"===t.buttonType){var n=t.options.presets.options[t.key];e.style.fontFamily=t.options.fontType.options[n.fontType],e.style.color=t.options.colors[n.fontColor],e.style.backgroundColor=t.options.colors[n.backgroundColor],e.style.textShadow=t.options.fontEdge.options[n.fontEdge]}else"mode"===t.buttonType&&(t.selected?(e.style.backgroundColor="#ccc",e.style.border="solid 1px white"):(e.style.border="solid 1px black",e.style.backgroundColor="white"));e.onclick=function(){t.callBack(this,t)}},i.prototype.createFormWrapper=function(t,e){return this.wrapper=document.createElement("div"),this.wrapper.className="ndpCaptionFormWrapper",this.label=document.createElement("label"),this.label.className="ndpCaptionLabel",this.label.textContent=t,this.wrapper.appendChild(this.label),e.appendChild(this.wrapper),this.wrapper},i.prototype.createStepperWrapper=function(){return this.wrapper=document.createElement("div"),this.wrapper.className="stepper",this.wrapper},i.prototype.updateCaptionStyle=function(t){var e=t.options.fontType.options[t.options.currentSettings.fontType],n=t.options.fontSize.options[t.options.currentSettings.fontSize],o=t.options.fontOpacity.options[t.options.currentSettings.fontOpacity],i=t.options.fontEdge.options[t.options.currentSettings.fontEdge],s=t.options.colors[t.options.currentSettings.fontColor],r=t.options.backgroundOpacity.options[t.options.currentSettings.backgroundOpacity],a=t.options.colors[t.options.currentSettings.backgroundColor],l=t.options.windowOpacity.options[t.options.currentSettings.windowOpacity],d=t.options.colors[t.options.currentSettings.windowColor];t.root.captionWindow.style.fontFamily=e,t.root.captionWindow.style.fontSize=n,t.root.captionWindow.style.color=s,t.root.captionWindow.style.color=t.root.captionWindow.style.color.replace("rgb","rgba").replace(")",","+o+")"),t.root.captionWindow.style.textShadow=i,t.root.captionText.style.backgroundColor=a,t.root.captionText.style.backgroundColor=t.root.captionText.style.backgroundColor.replace("rgb","rgba").replace(")",","+r+")"),t.root.captionWindow.style.backgroundColor=d,t.root.captionWindow.style.backgroundColor=t.root.captionWindow.style.backgroundColor.replace("rgb","rgba").replace(")",","+l+")");var c="font-family: "+t.root.captionWindow.style.fontFamily+"; ";c+="font-size: "+t.root.captionWindow.style.fontSize+"; ",c+="color: "+t.root.captionWindow.style.color+"; ",t.root.captionWindow.style.textShadow&&(c+="text-shadow: "+t.root.captionWindow.style.textShadow+"; "),c+="background-color: "+t.root.captionText.style.backgroundColor+"; ",t.root.updateCssClass("ndpCaptionsPreview",".ndpCaptionCardPreviewWindow { background-color: "+t.root.captionWindow.style.backgroundColor+" } .ndpCaptionsUserSettingPreview { "+c+"}"),t.notPreview&&t.root.updateCssClass("ndpCaptions",".ndp-captions-track-window { background-color: "+t.root.captionWindow.style.backgroundColor+" } .ndpCaptionsUserSetting { "+c+"}"),t.root.captionWindow.style.removeProperty("font-family"),t.root.captionWindow.style.removeProperty("font-size"),t.root.captionWindow.style.removeProperty("color"),t.root.captionWindow.style.removeProperty("text-shadow"),t.root.captionText.style.removeProperty("background-color"),t.root.captionWindow.style.removeProperty("background-color")},i.prototype.updateDropdown=function(t,e){for(var n=0;n<t.length;n++)t[n].selectedIndex=e},i.prototype.onDropdownSelection=function(t,e){var n=e.key,o=t.options[t.selectedIndex].text;e.options.currentSettings[n]=o,e.preview(e)},i.prototype.onPresetButtonClick=function(t,e){for(var n in e.options.currentSettings.presets=e.key,e.options.presets.options[e.key])e.options.currentSettings[n]=e.options.presets.options[e.key][n];var o=Object.keys(e.options.fontType.options).indexOf(e.options.currentSettings.fontType),i=Object.keys(e.options.fontEdge.options).indexOf(e.options.currentSettings.fontEdge);e.root.updateDropdown(e.root.fontTypeWrapper.getElementsByTagName("select"),o),e.root.updateDropdown(e.root.edgeEffectsWrapper.getElementsByTagName("select"),i),e.preview(e)},i.prototype.onPlusMinusClick=function(t,e){var n=e.key,o=parseInt(e.options.currentSettings[n]),i=Object.keys(e.options[n].options).length-1;"+"===e.type?o<i&&(o+=1):0<o&&(o-=1),e.options.currentSettings[n]=o,e.preview(e)},i.prototype.onColorModeSelection=function(t,e){e.state.colorMode=e.key;for(var n=e.element.children,o=0;o<n.length;o++)n[o].style.backgroundColor="white",n[o].style.border="solid 1px black";t.style.backgroundColor="#ccc",t.style.border="solid 1px white",e.preview(e)},i.prototype.onColorSelection=function(t,e){var n=e.key;e.options.currentSettings[e.state.colorMode]=n,e.preview(e)},i.prototype.onResetButtonClick=function(t,e){e.root.resetToDefaults(e),window.cardRoot=e.root,e.root.updateDropdown(e.root.fontTypeWrapper.getElementsByTagName("select"),0),e.root.updateDropdown(e.root.edgeEffectsWrapper.getElementsByTagName("select"),0),e.preview(e)},i.prototype.onSubmitButtonClick=function(t,e){e.root.saveConfigurationToLocalStorage(e),e.notPreview=!0,e.root.updateCaptionStyle(e),e.root.hideCard(),e.root.showCaptions(!0)},i.prototype.updateCssClass=function(t,e){var n=document.getElementById(t);n&&document.getElementsByTagName("head")[0].removeChild(n),(n=document.createElement("style")).type="text/css",n.id=t,n.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(n)},i.prototype.displayCard=function(){this.cardInstance.style.display="block"},i.prototype.hideCard=function(){this.cardInstance.style.display="none"},i.prototype.showCaptions=function(t){this.bus.notify(new o(o.CAPTION,{caption:t}))},i.prototype.__addHandlers=function(t){this.bus.addListener(o.CAPTIONOPTIONS,this.generateCard,this)},e.add(i)}(window.$ndp),function(t){t.captions||(t.captions={}),t.captions.options={language:{default:"English",options:{English:"en",Spanish:"es"}},presets:{default:"0",options:{0:{fontType:"Use Default",fontSize:"2",fontOpacity:"4",fontEdge:"Use Default",backgroundOpacity:"4",fontColor:"black",backgroundColor:"white",windowColor:"white",windowOpacity:"0"},1:{fontType:"Courier New",fontSize:"2",fontOpacity:"4",fontEdge:"Depressed",backgroundOpacity:"4",fontColor:"grey",backgroundColor:"black",windowColor:"black",windowOpacity:"0"},2:{fontType:"Arial",fontSize:"2",fontOpacity:"4",fontEdge:"Drop Shadow",backgroundOpacity:"2",fontColor:"white",backgroundColor:"blue",windowColor:"blue",windowOpacity:"0"},3:{fontType:"Times New Roman",fontSize:"2",fontOpacity:"3",fontEdge:"Use Default",backgroundOpacity:"2",fontColor:"cyan",backgroundColor:"black",windowColor:"black",windowOpacity:"0"},4:{fontType:"Arial",fontSize:"2",fontOpacity:"3",fontEdge:"Raised",backgroundOpacity:"5",fontColor:"cyan",backgroundColor:"white",windowColor:"white",windowOpacity:"0"},5:{fontType:"Times New Roman",fontSize:"2",fontOpacity:"4",fontEdge:"Uniform",backgroundOpacity:"2",fontColor:"yellow",backgroundColor:"blue",windowColor:"blue",windowOpacity:"0"}}},fontType:{default:"Use Default",options:{"Use Default":"Verdana",Helvetica:"Helvetica",Arial:"Arial","Arial Black":"Arial Black","Courier New":"Courier New",Georgia:"Georgia",Impact:"Impact",Palatino:"Palatino",Tahoma:"Tahoma","Times New Roman":"Times New Roman"}},fontSize:{default:"2",options:{0:"50%",1:"75%",2:"100%",3:"125%",4:"150%",5:"200%"}},fontOpacity:{default:"4",options:{0:"0.2",1:"0.4",2:"0.6",3:"0.8",4:"1"}},fontEdge:{default:"Use Default",options:{"Use Default":"",None:"","Drop Shadow":"rgba(0, 0, 0, .7) 1px 1px 0px, rgba(0, 0, 0, .7) -1px 1px 0px",Depressed:"rgba(0, 0, 0, .7) -1px 1px 0px, rgba(0, 0, 0, .7) 1px -1px 0px",Raised:"rgba(0, 0, 0, .7) 1px 1px 0px, rgba(0, 0, 0, .7) -1px -1px 0px",Uniform:"rgba(0, 0, 0, .7) -1px -1px 0px, rgba(0, 0, 0, .7) 1px -1px 0px, rgba(0, 0, 0, .7) -1px 1px 0px, rgba(0, 0, 0, .7) 1px 1px 0px"}},fontColor:{default:"white"},backgroundColor:{default:"black"},backgroundOpacity:{default:"5",options:{0:"0",1:"0.2",2:"0.4",3:"0.6",4:"0.8",5:"1"}},windowColor:{default:"black"},windowOpacity:{default:"0",options:{0:"0",1:"0.2",2:"0.4",3:"0.6",4:"0.8",5:"1"}},colors:{white:"#FFFFFF",red:"#FF0000",green:"#258403",blue:"#0700FF",yellow:"#FFF000",cyan:"#00FFFF",grey:"#CCCCCC",magenta:"#FF00FF",black:"#000000"},currentSettings:{language:"",presets:"",fontType:"",fontSize:"",fontOpacity:"",fontEdge:"",fontColor:"",backgroundOpacity:"",backgroundColor:"",windowOpacity:"",windowColor:""}}}(window.$ndp),function(c,p){function t(t,e){var n=e.activeCues[t];this.region=n.region||null,this.vertical=n.vertical||"",this.snapToLines=n.snapToLines||!1,this.line=n.line||"auto",this.lineAlign=n.lineAlign||"start",this.position=n.position||"auto",this.positionAlign=n.positionAlign||"center",this.size=n.size,this.align=n.align||"center",this.text=n.text||"",this.htmlText=n.getCueAsHTML&&n.getCueAsHTML(),Object.defineProperties(this,{cueElement:{value:document.createElement("span"),enumerable:!0},regionElement:{get:function(){return e.regionElement}},regionWindowElement:{get:function(){return e.windowElement}},locationElement:{get:function(){return e.parentElement}},cueIndex:{get:function(){return t}},totalCues:{get:function(){return{active:e.activeCues&&e.activeCues.length||0,all:e.cues&&e.cues.length||0}}}})}function u(t){return t?{"writing-mode":"vertical-"+t}:{"writing-mode":"horizontal-tb"}}t.prototype=Object.create({constructor:t},{html:{get:function(){return this.buildHTML()},enumerable:!0},buildHTML:{value:function(){return this.updateRegionHtml(),this.renderCueText(),this.regionWindowElement.appendChild(this.cueElement),this.regionElement}},mapStyles:{value:function(){},enumerable:!0},updateRegionHtml:{value:function(){var t=this.getRegionStyles(this.locationElement);for(var e in t)this.setStyleProperty("region",e,t[e])}},renderCueText:{value:function(){this.cueElement.id="ndp_cc_cue_"+this.cueIndex,this.cueElement.classList.add("ndp-captions-track-cue");for(var t=function(t){var e=document.createElement("textarea");e.innerHTML=decodeURIComponent(t),"string"!=typeof e.value&&(e.value="");return t=e.value.toString()}(this.text).split(/[\r\n]+/g),e=0;e<t.length;e++){var n=this.cueCardHtml(t[e],e);this.cueElement.appendChild(n),this.cueElement.innerHTML+="<br>"}}},toggleViewHtml:{value:function(t,e){}},cueCardHtml:{value:function(t,e){var n=document.createElement("span");return n.innerText=t,n.id="ndp_cc_cue_span_"+this.cueIndex+"_"+e,n.classList.add("ndp-captions-track-cue-text"),n.classList.add("ndpCaptionsUserSetting"),n}},setStyleProperty:{value:function(t,e,n){"region"===t?this.regionElement.style.setProperty(e,n):"window"===t?this.regionWindowElement.style.setProperty(e,n):this.cueElement.style.setProperty(e,n)}},getComputedPosition:{value:function(){if(isNaN(this.position))return"left"===this.align?0:"right"===this.align?100:50;return parseInt(this.position)}},getContentRenderArea:{value:function(){var t=this.locationElement;t.offsetWidth;return this.getVideoDimensions().width/t.parentElement.offsetWidth}},getMaximumSize:{value:function(t){{if("center"===this.positionAlign)return t<=50?2*t:2*(100-t);if("line-left"===this.positionAlign)return 100-t}return t}},getComputedLine:{value:function(){return isNaN(this.line)?this.snapToLines?-(this.index+1):100:!this.snapToLines&&(100<this.line||this.line<0)?100:this.line}},getXPositionBasedOnWritingDirection:{value:function(t,e){{if("center"===this.positionAlign)return e-t/2;if("line-right"===this.positionAlign)return e-t}return e}},getVideoDimensions:{value:function(){var t=this.locationElement,e=c.detectFullscreenSupport(t),n=t.currentStyle||window.getComputedStyle(t),o=t.getBoundingClientRect(),i={};for(var s in o)i[s]=o[s];if(i.index="inherit",i.margin=parseFloat(n.marginLeft)+parseFloat(n.marginRight),i.padding=parseFloat(n.paddingLeft)+parseFloat(n.paddingRight),i.border=parseFloat(n.borderLeftWidth)+parseFloat(n.borderRightWidth),i.absPositions={top:o.top+window.scrollY,left:o.left+window.scrollX},e.fullscreenEnabled){var r=window.getComputedStyle(t,":fullscreen");if(r?r?r||(r=window.getComputedStyle(t,":-ms-full-screen")):r=window.getComputedStyle(t,":-moz-full-screen"):r=window.getComputedStyle(t,":-webkit-full-screen"),r){var a=r.getPropertyValue("z-index");i.index=isNaN(parseInt(a))?a:parseInt(a)+2}}return i}},getRegionStyles:{value:function(t){var e=this.getComputedPosition(),n=this.getMaximumSize(e),o=n;this.size<n&&(o=this.size);var i=this.getXPositionBasedOnWritingDirection(o,e),s=this.snapToLines?0:this.getComputedLine(),r=u(this.vertical);if(this.snapToLines){var a=100*this.getContentRenderArea(t);i<a&&a<i+o&&(i+=a,o-=a);var l=100-a;i<l&&l<i+o&&(o-=l)}p&&c.console.info("CUE Dimensions",{width:parseInt(o)+"vw",left:parseInt(i)+"vw",top:parseInt(s)+"vh"},this);var d=this.getVideoDimensions();return r.width=.6*d.width+"px",r.left=.2*d.width+"px",r.bottom="12%",r["z-index"]=d.index,r},enumerable:!0},getCueStyles:{value:function(t){var e=u(this.vertical);for(var n in e)_styles[n]=e[n]},enumerable:!0}}),c.captions.models||(c.captions.models={}),c.captions.models.NDPCueModel=t}(window.$ndp,window.NDP_DEBUG),function(o){var i=".ndp-video{position:relative;padding:0;margin:0;height:100%;width:100%}.ndp-video .ndp-video-player{padding:0;margin:0;height:100%;width:100%;font-size:16px} .ndp-video-player{text-shadow:none;background:initial}.ndp-video-player .ndp-captions-track-container{position:relative;width:inherit;height:inherit;text-align:center;letter-spacing:normal;word-spacing:normal;text-transform:none;text-indent:0;pointer-events:none;user-select:none;word-break:break-word;overflow:hidden;font:22px sans-serif;text-decoration:none}.ndp-video-player .ndp-captions-track-region,.ndp-video-player .ndp-captions-track-cue{position:absolute;unicode-bidi:plaintext;overflow-wrap:break-word;writing-mode:horizontal-tb;width:auto;height:auto;text-align:start;vertical-align:middle;user-select:none}.ndp-video-player .ndp-captions-track-region{overflow:hidden;min-height:0;display:inline-flex;flex-flow:column nowrap;justify-content:flex-end;align-items:center;direction:ltr}.ndp-video-player .ndp-captions-track-region *{text-shadow:none}.ndp-video-player .ndp-captions-track-region.ndp-captions-track-hidden{z-index:-999;visibility:hidden;display:none;height:0;width:0;top:-1px;left:-1px}.ndp-video-player .ndp-captions-track-region>.ndp-captions-track-window{resize:horizontal;display:inline-flex;flex-flow:column nowrap;justify-content:center;align-items:center}.ndp-video-player .ndp-captions-track-cue{position:relative;display:inline-block;padding:2px 2px 0 2px;margin:0;transition-property:height;transition-duration:0.433s;transition-timing-function:ease-in-out;transform:translateY(1px)}.ndp-video-player .ndp-captions-track-cue.ndp-user-default-style{font-size:1rem;text-shadow:none;color:#d2d2d2;background:rgba(0,0,0,0.8)}.ndp-video-player .ndp-captions-track-cue>.ndp-captions-track-cue-text{display:inline-block;padding:0 1px 0 1px;margin-bottom:2px;border-radius:2.5px;border:1px dotted transparent}.ndp-video-player .ndpCaptionOptionsCard{height:100%;max-height:480px;width:100%;max-width:640px;position:absolute;top:50%;left:50%;-ms-transform:translateX(-50%) translateY(-50%);-webkit-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);font-family:Arial}.ndp-video-player .ndpCaptionCardHeader{height:8%;width:100%;position:absolute;left:0;top:0;color:white;background-color:black}.ndp-video-player .ndpCaptionCardLabel{margin-left:10px}.ndp-video-player .ndpCaptionCardClose{float:right}.ndp-video-player .ndpCaptionCardSettings{height:60%;width:100%;position:absolute;top:8%;left:0;background-color:rgba(0,0,0,0.8);font-size:12px;overflow:auto}.ndp-video-player .ndpCaptionCardPreviewArea{height:32%;width:100%;position:absolute;left:0;top:68%;overflow:auto;font-size:16px;line-height:initial}.ndp-video-player .ndpCaptionCardPreviewWrapper{position:absolute;width:60%;top:50%;left:50%;-ms-transform:translateX(-50%) translateY(-50%);-webkit-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%)}.ndp-video-player .ndpCaptionCardPreviewWindow{display:inline-block;padding:4px}.ndp-video-player .ndpCaptionCardPresetWrapper{height:100%;width:20%;color:white;position:absolute;left:0;top:0;text-align:center}.ndp-video-player .ndpCaptionCardPresetLabel{display:block}.ndp-video-player .ndpCaptionCardStyleWrapper{height:100%;width:30%;color:white;position:absolute;left:20%;top:0}.ndp-video-player .ndpCaptionColorsWrapper{height:100%;width:50%;color:white;position:absolute;left:50%;top:0;text-align:center}.ndp-video-player .ndpCaptionSettingsButtonsWrapper{position:absolute;bottom:0;right:0}.ndp-video-player .ndpCaptions{display:inline-block;padding:2px;width:60%;font-family:'Courier New';font-size:100%;color:#ccc;background-color:rgba(0,0,0,0.8)}.ndp-video-player .ndpCaptionFormWrapper{color:black;display:block;width:100%}.ndp-video-player .ndpCaptionModeWrapper{color:black;display:block}.ndp-video-player .ndpCaptionLabel{color:white;display:block}.ndp-video-player .ndpCaptionColors button{border:1px solid white;width:40px;height:40px;margin:3px}.ndp-video-player .ndpCaptionCardPresetWrapper button{border-color:grey;border-style:solid;width:45px;height:45px;margin:3px;font-size:20px}.ndp-video-player .stepper button{background-color:white;border:solid 1px black;width:25px;height:20px}.ndp-video-player .ndpCaptionCardClose{color:black;width:20px;height:20px;background-color:white;border:none;margin:2px}.ndp-video-player .ndpCaptionSettingsButtonsWrapper button{color:white;background-color:#777777;padding:7px 15px 7px 15px;text-decoration:none;border:none;margin:0px 10px 10px 0px}",t={position:"absolute","unicode-bidi":"plaintext","overflow-wrap":"break-word","text-wrap":"balance","writing-mode":"horizontal-tb",width:"auto",height:"auto","text-align":"start"},e={position:"absolute",overflow:"hidden","writing-mode":"horizontal-tb","overflow-wrap":"break-word","text-wrap":"balance","min-height":"0px",display:"inline-flex","flex-flow":"column","justify-content":"flex-end"},n={position:"relative","unicode-bidi":"plaintext",width:"auto","overflow-wrap":"break-word","text-wrap":"balance"};function s(){}s.prototype=Object.create({constructor:s},{renderStyleSheets:{value:function(){(o.__contains(i,"NDP_GENERATED_CAPTIONS_STYLESHEETS")||"string"!=typeof i)&&(o.console.warn("NDP StyleSheets did NOT Generate.","string"!=typeof i),i=".ndp-video{height: 100%;width: 100%;}");var t=document.createDocumentFragment(),e=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=i:n.appendChild(document.createTextNode(i));t.appendChild(n),e.appendChild(t)},enumerable:!0},region:{get:function(){return o.__extend({},t,e,{})},enumerable:!0},cue:{get:function(){return o.__extend({},t,n,{})},enumerable:!0}}),o.captions.styles=new s}(window.$ndp),window.$ndp,function(s){function t(t,e){var o=this;Object.defineProperties(this,{index:{get:function(){return parseInt(t)},enumerable:!0},parentElement:{get:function(){return e.video},enumerable:!0},track:{value:e.video.textTracks[t]},regionElement:{get:function(){return e.regionElement}},windowElement:{get:function(){return e.windowElement}},CueModel:{get:function(){return s.captions.models&&s.captions.models.NDPCueModel}},viewCustomDisplay:{get:function(){return!!s.configuration.isDesktop&&!!e.view}},cueHandler:{value:function(t){o.viewCustomDisplay&&(s.console.log("cue CHANGE",t),o.mapCueRegion(t))}},toggleHandler:{value:function(t,e){if(o.toggleCustomDisplay(t,e),o.mappedCues.length)for(var n=o.mapActiveCues.length;n--;)o.mapActiveCues[n].toggleViewHtml(t,e)}}}),s.configuration.isDesktop&&(this.addEventListener(this.cueHandler),e.addToggleListener(this.toggleHandler,this,!0))}t.prototype=Object.create({constructor:t},{mappedCues:{value:[]},cues:{get:function(){return this.track.cues}},activeCues:{get:function(){return this.track.activeCues}},id:{get:function(){return this.track.id?this.track.id:this.track._src_id||""}},label:{get:function(){return this.track.label}},kind:{get:function(){return this.track.kind}},language:{get:function(){return this.track.language||this.track.srclang}},mode:{get:function(){return this.track.mode},set:function(t){this.track.mode=t,this.track.mode!==t&&(this.parentElement.textTracks[this.index].mode=t),s.console.info("NDPTextTrackModel :: Update","mode",t,this.track)}},src:{get:function(){return this.track.src},set:function(t){this.track.src=t}},toggleCustomDisplay:{value:function(t,e){if(!s.configuration.isDesktop)return;s.console.debug("TextTrackModel.toggleCustomDisplay()","viewCustomDisplay",this.viewCustomDisplay),this.viewCustomDisplay?this.regionElement.classList.remove("ndp-captions-track-hidden"):this.regionElement.classList.add("ndp-captions-track-hidden")}},mapActiveCues:{value:function(){if(!this.activeCues||!this.activeCues.length)return[];for(var t,e=[],n=this.activeCues.length,o=0;o<n;o++){var i=(t=new this.CueModel(o,this)).html;e.push(t),s.console.log("Region Caption Cue Card has been added/updated",i)}return e}},mapCueRegion:{value:function(t){return s.console.debug("TextTrackModel.mapCueRegion()",this),this.windowElement.innerHTML="",this.mappedCues=this.mapActiveCues(),this.regionElement.outerHTML}},destroy:{value:function(){}},addCue:{value:function(t){this.track.addCue(t)}},removeCue:{value:function(t){this.track.removeCue(t)}},showTrack:{value:function(){this.mode="showing"}},hideTrack:{value:function(){this.mode="hidden"}},disableTrack:{value:function(){this.mode="disabled"}},addEventListener:{value:function(t){this.track.addEventListener("cuechange",t)}},removeEventListener:{value:function(t){this.track.removeEventListener("cuechange",t)}}}),s.captions.models||(s.captions.models={}),s.captions.models.NDPTextTrackModel=t}(window.$ndp),function(d,c){var s=!d.configuration.isDesktop,o=[],i=[],r="hidden",a="disabled";function t(t){var e=this,n=!1,o=!1;this.textTracks=[],Object.defineProperties(this,{video:{get:function(){return t},enumerable:!0},TrackModel:{get:function(){return d.captions.models&&d.captions.models.NDPTextTrackModel}},regionElement:{value:document.createElement("div"),enumerable:!0},windowElement:{value:document.createElement("span"),enumerable:!0},systemMode:{get:function(){return s?"showing":r}},view:{get:function(){return n},set:function(t){t?(t=this.systemMode,this.activeTrack&&(this.activeTrack.mode=t)):this.activeTrack&&(this.activeTrack.mode=r),n=t,this.notifyToggleListeners("view"),d.console.debug("TextTrackList","view",t,this.systemMode)},enumerable:!0},enabled:{get:function(){return o},set:function(t){(o=t)&&this.activeTrack?(this.activeTrack.mode=r,d.console.log("TextTrackList","enabled",this.activeTrack)):t||this.setAllMode(a),this.notifyToggleListeners("enabled")},enumerable:!0},changeEventHandler:{value:function(t){e._changeEventHandler(t)}}});var i="change";this.video.textTracks.hasOwnProperty("onchange")||(i="addtrack"),this.video.textTracks.addEventListener(i,this.changeEventHandler);/^((?!chrome|android|crios|fxios).)*safari/i.test(navigator.userAgent)&&!s&&this.fullscreenFixWebkit()}t.prototype=Object.create({constructor:t},{length:{get:function(){return this.textTracks&&this.textTracks.length},enumerable:!0},hasCaptions:{get:function(){var t=this.length;if(t)for(;t--;){var e=this.textTracks[t];if(e.cues&&e.cues.length)return!0}return!1}},activeTrack:{get:function(){var t,e=[],n=this.length;if(!this.hasCaptions)return null;if(1===n)return this.textTracks[0];for(;n--;)"captions"===(t=this.textTracks[n]).kind&&t.cues&&t.cues.length&&e.push(this.textTracks[n]);return 1===e.length?e[0]:(d.console.error("ERROR: ACTIVE Video TextTrack Does Not Exist",this.textTracks),null)},enumerable:!0},buildTrackList:{value:function(){var t,e=[],n=this.video.textTracks.length;for(;n--;){var o=this.video.textTracks[n];this.enabled&&o&&o.mode===a&&(o.mode=r),t=new this.TrackModel(n,this),e.unshift(t)}this.textTracks=e}},addCues:{value:function(t,e){var n=this.getTrackById(t);if(!n)return void d.console.warn("ERROR: Video TextTrack Does Not Exist :: "+t);var o=e.length;for(;o--;)n.addCue(e[o]);d.console.warn("Video TextTrack CUES ADDED :: ",n,e)}},removeCues:{value:function(t){var e=this.getTrackById(t);if(!e)return void d.console.warn("ERROR: Video TextTrack Does Not Exist :: "+t);var n=e.cues&&e.cues.length||0;for(;n--;)e.removeCue(e.cues[n]);d.console.warn("Video TextTrack CUES REMOVED :: ",e)}},setAllMode:{value:function(t){var e=this.length;for(;e--;)this.textTracks[e].mode=t}},placeCueRegion:{value:function(t){if(s)return;this.windowElement.classList.add("ndp-captions-track-window"),this.regionElement.appendChild(this.windowElement),this.regionElement.classList.add("ndp-captions-track-region"),this.regionElement.setAttribute("dir","ltr"),this.regionElement.setAttribute("draggable",!0),this.regionElement.setAttribute("aria","assertive"),t.appendChild(this.regionElement)}},getTrackById:{value:function(t){if(!isNaN(t))return this.textTracks[t];var e=this.length;for(;e--;){var n=this.textTracks[e].id;if(c&&d.console.debug("TRACKLISTMODEL","getTrackById",n,t),n===t)return this.textTracks[e]}return null}},addTextTrack:{value:function(t,i,s){var r=this,a=0,l=null;this.addEventListener(function t(e){if(!l){if(a<50)return d.console.warn("WARN","addTextTrack Callback Timeout",a),void setTimeout(function(){t(e)},10*a++);e&&e.track&&(d.console.info("INFO","addTextTrack fallback rendered",l),l=e.track)}r.removeEventListener(t);var n=l.id?l.id:l._src_id,o=r.getTrackById(n);"function"==typeof i&&i.call(s,o,e),c&&d.console.warn("TRACKLISTMODEL","addTextTrack callback",o)}),l=this.video.addTextTrack(t.kind,t.label,t.language),Object.defineProperty(l,"_src_id",{value:t.id,enumerable:!0}),c&&(d.console.debug("TRACKLISTMODEL","addTextTrack",l),window.console.dir(l))}},addEventListener:{value:function(t){"function"==typeof t&&o.push(t)}},removeEventListener:{value:function(t){var e=o.length;for(;e--;)o[e]===t&&o.splice(e,1)}},_changeEventHandler:{value:function(t){c&&d.console.debug("TRACKLISTMODEL","buildTrackList",i.length,t);var e=i.length;for(;e--;)i[e].child&&i.splice(e,1);this.buildTrackList(),this.enabled&&this.activeTrack&&(this.activeTrack.mode=this.systemMode);var n=o.length;for(;n--;)o[n](t)}},notifyToggleListeners:{value:function(t){var e=i.length;for(;e--;)i[e].fn.call(i[e].scope,t,this)}},addToggleListener:{value:function(t,e,n){"function"==typeof t&&i.push({fn:t,scope:e,child:n||!1})},enumerable:!0},removeToggleListener:{value:function(t){var e=i.length;for(;e--;)i[e].fn===t&&i.splice(e,1)},enumerable:!0},fullscreenFixWebkit:{value:function(){if(!document.addEventListener)return;var t=this;document.addEventListener("webkitfullscreenchange",function(){!1===document.webkitIsFullScreen&&t.activeTrack&&(t.activeTrack.mode=t.view)},!1)}}}),d.captions.models||(d.captions.models={}),d.captions.models.NDPTrackListModel=t}(window.$ndp,window.NDP_DEBUG),function(o,n){var e=o.console,t=o.AbstractObserver,i=o.events.VideoEvent,s=o.captions.models.NDPTrackListModel,r=o.SRTParser,a=!1,l={error:i.VIDEO_ERROR,emptied:i.EMPTIED,abort:i.ABORT,loadstart:i.LOAD,canplay:i.LOADED,play:i.PLAY,playing:i.PLAYING,pause:i.PAUSE,timeupdate:i.PROGRESS,ended:i.COMPLETE,seeking:i.SEEK,seeked:i.SEEKED,volumechange:i.VOLUME_CHANGE,fullscreenchange:i.FULLSCREEN};function d(){var e,n;this.contentURL=null,this.contentIsLive=!1,this.captions=[],this.containerElement=null,this.videoElement=document.createElement("video"),this.textTracks=new s(this.videoElement),o.captions.styles.renderStyleSheets(),a=o.detectFullscreenSupport(this.videoElement),this.tt=null,this.srtTrackId="ndp_cc_srt_id",this.videoElement.id="ndp_video_player_"+Date.now(),this.allowPreRollAd=!0,this.isAdState=!1,this.handleEvent=(e=this,function(t){e.processEvent(t)}),this.srtResponseHandler=(n=this,function(t){for(var e=r.parse(t);e.length;)n.captions.unshift(e.shift());n.captions.length&&n.textTracks.addCues(n.srtTrackId,n.captions)}),this.addTextTrack(),this.addVideoListeners()}((d.prototype=new t).constructor=d).constructor=t.prototype.constructor,d.prototype.src=function(){return 1===arguments.length&&(this.isAdState=!1,this.contentIsLive=o.DataStore.mediaAsset.isLiveMedia,this.contentURL=arguments[0],this.videoElement.src=this.contentURL,this.load()),this.videoElement.src},d.prototype.showPreroll=function(){return 1===arguments.length&&(this.allowPreRollAd=arguments[0]),this.allowPreRollAd},d.prototype.restartFromAd=function(t){n&&e.log("NativeSingleton.restartFromAd",t,o.DataStore.playIntiated),this.videoElement.src!==this.contentURL&&(this.videoElement.src=this.contentURL),this.textTracks.enabled=!0,o.console.log("TEST TextTracks",this.textTracks.enabled),this.showControls(),o.DataStore.playIntiated&&(t?this.stop():this.play())},d.prototype.play=function(){n&&(e.log("NativeSingleton.play :: isPaused",this.videoElement.paused),e.log("NativeSingleton.play :: readyState",this.videoElement.readyState)),this.videoElement.paused&&this.videoElement.play()},d.prototype.pause=function(){this.isPlaying()&&this.videoElement.pause()},d.prototype.stop=function(){n&&e.log("NativeSingleton.stop :: readyState",this.videoElement.readyState),this.pause(),this.currentTime(0),this.notify(new i(i.STOP))},d.prototype.load=function(){this.videoElement.load()},d.prototype.currentTime=function(){return 1===arguments.length&&(this.videoElement.currentTime=+arguments[0]),+this.videoElement.currentTime||0},d.prototype.muted=function(){return arguments.length&&(this.videoElement.muted=arguments[0]),this.videoElement.muted},d.prototype.volume=function(){return 1===arguments.length&&(this.videoElement.volume=+arguments[0]),+this.videoElement.volume},d.prototype.duration=function(){return+this.videoElement.duration||0},d.prototype.seeking=function(){return this.videoElement.seeking},d.prototype.requestFullscreen=function(){var t=this.videoElement,e=a.fn.Request;this.containerElement&&this.containerElement[e]&&(t=this.containerElement),t[e]()},d.prototype.exitFullscreen=function(){var t=a.fn.Exit;window.document[t]()},d.prototype.setAttribute=function(t,e){this.videoElement.setAttribute(t,e)},d.prototype.setAttributes=function(t){for(var e in t)this.setAttribute(e,t[e])},d.prototype.offsetWidth=function(){return this.containerElement?this.containerElement.offsetWidth:0},d.prototype.offsetHeight=function(){return this.containerElement?this.containerElement.offsetHeight:0},d.prototype.getAttribute=function(t){return this.videoElement.getAttribute(t)},d.prototype.hasCaptions=function(){return this.textTracks.hasCaptions},d.prototype.showCaptions=function(){this.textTracks.view=!0},d.prototype.hideCaptions=function(){this.textTracks.view=!1},d.prototype.showControls=function(){this.videoElement.controls=!o.configuration.useCustomControls},d.prototype.hideControls=function(){this.videoElement.controls=!1},d.prototype.isLive=function(){return 1===arguments.length&&(this.contentIsLive=arguments[0]),this.contentIsLive},d.prototype.isPlaying=function(){var t=this.videoElement;return 0<t.currentTime&&!t.paused&&!t.ended&&2<t.readyState},d.prototype.getErrorCode=function(){return this.videoElement.error.code},d.prototype.getVideoElement=function(){return this.videoElement},d.prototype.placeVideo=function(t){null===this.containerElement&&(this.containerElement=t,this.containerElement.appendChild(this.videoElement),this.containerElement.addEventListener(a.fullscreenEvent,this.handleEvent),this.textTracks.placeCueRegion(this.containerElement),this.showControls(),this.setAttributes({playsinline:"true",preload:"metadata","x-webkit-airplay":"allow",style:"height: 100%; width: 100%"}))},d.prototype.addTextTrack=function(){var e=this,n=o.events.PlaybackEvent;this.textTracks.addEventListener(function(t){o.console.log("NativeSingleton.addTextTrack: TrackUpdate Handler"),e.notify(new n(n.HAS_CAPTIONS,{has_captions:e.hasCaptions(),asset:o.DataStore.mediaAsset},o.DataStore.activePlayer))}),this.textTracks.addTextTrack({kind:"captions",label:"Closed Captions",id:this.srtTrackId},function(t,e){t?(this.textTracks.enabled=!0,this.tt&&t.id===this.tt.id||(o.console.info("ACTIVE TEXTTRACK is Not in Singleton, Adding.",t),this.tt=this.textTracks.activeTrack||t)):window.console.error("ERROR: Video TextTrack was Not Properly Added to Video.")},this)},d.prototype.setAdState=function(t){this.isAdState=t,this.notify(new i(i.SWITCH_ADAPTERS))},d.prototype.inAdState=function(){return this.isAdState},d.prototype.addVideoListeners=function(){for(var t in l)"fullscreenchange"===t?this.addFullscreenListener():this.videoElement.addEventListener(t,this.handleEvent)},d.prototype.addFullscreenListener=function(){var t=a.fullscreenEvent;this.videoElement.addEventListener(t,this.handleEvent)},d.prototype.processEvent=function(t){var e=l[t.type];t.type===a.fullscreenEvent&&(e=l.fullscreenchange),e&&(n&&(o.DataStore.currentVideoEvent=t.type),this.notify(new i(e),this))},d.prototype.setCaptions=function(t){this.textTracks.removeCues(this.srtTrackId),this.captions.length=0,r.getFile(t,this.srtResponseHandler)},d.prototype.createCaptions=function(){this.captions.length;return this.hasCaptions()},d.prototype.removeCaptions=function(){},d.prototype.adCompleteAction=function(){},o.NativeSingleton="hls"===o.fileType?d:new d}(window.$ndp,window.NDP_DEBUG),function(e,o,i){var r=e.console;if(window.Hls){var t=e.NativeSingleton,a=(e.AbstractObserver,!1),s=!1,n=!1,l=!1,d=e.events.VideoEvent,c=(e.SRTParser,d.VIDEO_ERROR,d.EMPTIED,d.ABORT,d.PLAY,d.PLAYING,d.PAUSE,d.PROGRESS,d.COMPLETE,d.SEEK,d.SEEKED,d.VOLUME,{MEDIA_ATTACHED:o.Events.MEDIA_ATTACHED,MEDIA_ATTACHING:o.Events.MEDIA_ATTACHING,MEDIA_DETACHED:o.Events.MEDIA_DETACHED,MEDIA_DETACHING:o.Events.MEDIA_DETACHING,MANIFEST_LOADED:o.Events.MANIFEST_LOADED,MANIFEST_LOADING:o.Events.MANIFEST_LOADING,MANIFEST_PARSED:o.Events.MANIFEST_PARSED,LEVEL_LOADED:o.Events.LEVEL_LOADED,LEVEL_LOADING:o.Events.LEVEL_LOADING,LEVEL_UPDATED:o.Events.LEVEL_UPDATED,FRAG_LOADED:o.Events.FRAG_LOADED,FRAG_PARSING_METADATA:o.Events.FRAG_PARSING_METADATA,FRAG_BUFFERED:o.Events.FRAG_BUFFERED,DESTROYING:o.Events.DESTROYING,ERROR:o.Events.ERROR}),p=o.ErrorTypes.MEDIA_ERROR,u=o.ErrorTypes.NETWORK_ERROR;o.ErrorTypes.OTHER_ERROR;h.prototype=Object.create(t.prototype,{constructor:{value:h},__super:{value:t.prototype}}),h.constructor=t.prototype.constructor,h.prototype.adCompleteAction=function(){if(this.useHLS()){this.detachMedia(this.contentURL,!0)}},h.prototype.src=function(){return arguments.length?(r.info("HlsSingleton.src",this),a?this.detachMedia(arguments[0]):this.switchMedia.apply(this,arguments),this.contentURL):this.contentURL},h.prototype.useHLS=function(){return e.DataStore.mediaAsset instanceof e.HLSPriorityMediaAsset?e.DataStore.mediaAsset.useHLS():!!e.DataStore.mediaAsset.isLiveMedia},h.prototype.restartFromAd=function(t){i&&(r.log("HlsSingleton.restartFromAd",t,e.DataStore.playIntiated),r.debug("*** HlsSingleton.restartFromAd ****","useHLS?",this.useHLS())),this.useHLS()?(this.textTracks.enabled=!0,this.showControls(),e.DataStore.playIntiated&&(t?this.stop():this.play())):this.__super.restartFromAd.apply(this,arguments)},h.prototype.play=function(){var t=this.useHLS();t&&!s?l=!0:t&&n&&(n=!1,this.hls.startLoad()),i&&r.debug("HlsSingleton.play :: isPaused",this.videoElement.paused),this.videoElement.paused&&this.videoElement.play()},h.prototype.stop=function(){i&&r.log("HlsSingleton.stop :: readyState",this.videoElement.readyState),this.pause(),this.currentTime(0),this.useHLS()&&(n=!0,this.hls.stopLoad()),this.notify(new d(d.STOP))},h.prototype.loadSource=function(t){i&&r.info("HlsSingleton.loadSource",this.contentURL);var n=this,o=function(t,e){n.hls.off(c.MANIFEST_PARSED,o),r.info("HlsSingleton.loadSource"),s=!0,l&&n.play()};!(s=l=!1)===t&&(l=!0),this.hls.on(c.MANIFEST_PARSED,o),this.hls.loadSource(this.contentURL)},h.prototype.attachMedia=function(){this.contentURL=arguments[0];var n,o=this,i=arguments,s=function(t,e){o.hls.off(c.MEDIA_ATTACHED,s),r.info("HlsSingleton.attachMedia"),a=!0,1<i.length&&(n=i[1]),o.loadSource(n)};this.hls.on(c.MEDIA_ATTACHED,s),this.hls.attachMedia(this.videoElement)},h.prototype.detachMedia=function(t){var n=this,o=arguments,i=function(t,e){n.hls.off(c.MEDIA_DETACHED,i),r.info("HlsSingleton.detachMedia"),s=a=!1,n.switchMedia.apply(n,o)};this.hls&&this.videoElement&&(this.hls.on(c.MEDIA_DETACHED,i),this.hls.detachMedia())},h.prototype.switchMedia=function(t){n=!1,this.pause(),r.info("HlsSingleton.switchMedia",this.useHLS()&&!!t),this.useHLS()?this.attachMedia.apply(this,arguments):this.__super.src.apply(this,arguments)},h.prototype.addHandlers=function(){for(var t in c)this.hls.on(c[t],this.eventHandler)},h.prototype._eventHandler=function(t,e){r.log("HLS EVENT :: "+Date.now(),t,e)},h.prototype._errorHandler=function(t,e){o.ErrorDetails;var n=e.type;e.details,e.fatal;switch(r.error(n,t,e),n){case u:this.hls.startLoad();break;case p:this.hls.recoverMediaError();break;default:this.hls.destroy()}},h.prototype.setConfiguration=function(){var t={debug:!!i,autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,capLevelToPlayerSize:!1,startFragPrefech:!1,liveMaxLatencyDurationCount:10,liveSyncDurationCount:3,maxBufferLength:30,maxMaxBufferLength:600,maxBufferSize:6e7,maxBufferHole:.5,maxSeekHole:2,maxFragLookUpTolerance:.2,seekHoleNudgeDuration:.01,enableSoftwareAES:!0,enableWorker:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:6,manifestLoadingRetryDelay:500,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:6,levelLoadingRetryDelay:500,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:500,appendErrorMaxRetry:3,enableCEA708Captions:!0,stretchShortVideoTrack:!1,forceKeyFrameOnDiscontinuity:!0};return t},e.NativeSingleton=new h}else r.warn("HLS WAS NOT LOADED.");function h(){t.call(this),this.hls=new o({debug:!!i}),!!o.isSupported()}}(window.$ndp,window.Hls,window.NDP_DEBUG),function(t){t.states=t.states||{},t.states.Transitions={LOAD:["loadTransition"],LOADED:["loadedTransition"],WAIT:["adwaitTransition"],START:["startTransition"],PLAY:["playTransition"],PAUSE:["pauseTransition"],STOP:["stopTransition"],SEEK:["seekTransition"],SEEKED:["seekedTransition"],PROGRESS:["progressTransition"],VOLUME:["volumeTransition"],FULLSCREEN:["fullscreenTransition"],LOCK:["lockTransition"],UNLOCK:["unlockTransition"],COMPLETE:["completeTransition"],UNLOAD:["unloadTransition"],UNLOADED:["unloadedTransition"],ADCOMPLETE:["adcompleteTransition"],ADSKIP:["adskipTransition"],NOAD:["noadTransition"]}}(window.$ndp),function(o){var i=o.events.CommandEvent,s=o.NativeSingleton;function t(t){var e;this.parent=t,this.transitions={},this.handler=(e=this,function(t){e.__processEvent(t)})}t.prototype.enter=function(){this.__toggleHandlers(!0)},t.prototype.exit=function(){this.__toggleHandlers(!1)},t.prototype.handleCommand=function(t){switch(o.console.debug("*** ActiveState.handleCommand ***",t),t.getType()){case i.PLAY:s.play();break;case i.LOAD:case i.PAUSE:s.pause();break;case i.STOP:s.stop();break;case i.SETVOLUME:var e=t.getVolume(),n=t.payload.muted;e!==s.volume()&&s.volume(e),n!==s.muted()&&s.muted(n);break;case i.SETPLAYHEAD:s.currentTime(s.duration()*t.seekTo());break;case i.FULLSCREEN:t.payload.fullscreen?s.exitFullscreen():s.requestFullscreen();break;case i.CAPTION:t.isCaption()?s.showCaptions():s.hideCaptions()}},t.prototype.__toggleHandlers=function(t){var e=!0===t?"addListener":"removeListener";for(var n in this.transitions)Object.prototype.hasOwnProperty.call(this.transitions,n)&&s[e](n,this.handler)},t.prototype.__processEvent=function(t){var e=s.duration(),n=this.transitions[t.type];return!(n===o.states.Transitions.START&&s.currentTime()===e&&!s.isLive())&&(this.parent.stateUpdate(n,{}),!0)},o.states=o.states||{},o.states.Active=t}(window.$ndp),function(t){var e=t.states.Active,n=t.states.Transitions,o=t.events.VideoEvent,i={};function s(t){s.constructor.call(this,t),this.transitions=i}i[o.PLAY]=n.PLAY,i[o.PAUSE]=n.PAUSE,i[o.SEEK]=n.SEEK,i[o.STOP]=n.STOP,i[o.VOLUME_CHANGE]=n.VOLUME,i[o.FULLSCREEN]=n.FULLSCREEN,(s.prototype=new e).__super=e.prototype,(s.prototype.constructor=s).constructor=e.prototype.constructor,t.states.Idle=s}(window.$ndp),function(t){function e(t){this.parent=t,this.commandQueue=[]}e.prototype.enter=function(){this.commandQueue.length=0},e.prototype.exit=function(){return this.commandQueue},e.prototype.handleCommand=function(t){this.commandQueue.push(t)},t.states=t.states||{},t.states.Inactive=e}(window.$ndp),function(t){var e=t.states.Inactive;function n(t){this.parent=t,this.previousState=null}(n.prototype=new e).__super=e.prototype,(n.prototype.constructor=n).constructor=e.prototype.constructor,n.prototype.enter=function(){this.__super.enter.call(this),this.previousState=this.parent.previousState},n.prototype.exit=function(){return this.parent.previousState=this.previousState,this.__super.exit.call(this)},t.states=t.states||{},t.states.Locked=n}(window.$ndp),function(t){var e=t.states,n=e.Inactive,o=e.Transitions,i=t.MediaAsset,s=(t.MPXMediaAsset,t.events.VideoEvent,t.NativeSingleton);function r(t){this.parent=t,r.constructor.call(this,t)}(r.prototype=new n).__super=n.prototype,(r.prototype.constructor=r).constructor=n.prototype.constructor,r.prototype.enter=function(t){this.__super.enter.call(this);var e=t instanceof i&&!t.isLive()?t.getVideoData():{url:t.getURL(),isLiveMedia:t.isLiveMedia};s.pause(),s.isLive(e.isLiveMedia),s.src(e.url),this.parent.stateUpdate(o.LOADED,{})},r.prototype.exit=function(){return this.__super.exit.call(this)},t.states.Load=r}(window.$ndp),function(t){var e=t.states.Active,n=t.states.Transitions,o=t.events.VideoEvent,i={};function s(t){s.constructor.call(this,t),this.transitions=i}i[o.PLAYING]=n.START,i[o.VOLUME_CHANGE]=n.VOLUME,i[o.FULLSCREEN]=n.FULLSCREEN,i[o.STOP]=n.STOP,(s.prototype=new e).__super=e.prototype,(s.prototype.constructor=s).constructor=e.prototype.constructor,t.states.Loaded=s}(window.$ndp),function(t){var e=t.states.Active,n=t.states.Transitions,o=t.NativeSingleton,i=t.events.VideoEvent,s={};function r(t){r.constructor.call(this,t),this.transitions=s}s[i.PLAY]=n.PLAY,s[i.PAUSE]=n.PAUSE,s[i.PROGRESS]=n.PROGRESS,s[i.COMPLETE]=n.COMPLETE,s[i.STOP]=n.STOP,s[i.SEEK]=n.SEEK,s[i.VOLUME_CHANGE]=n.VOLUME,s[i.FULLSCREEN]=n.FULLSCREEN,(r.prototype=new e).__super=e.prototype,(r.prototype.constructor=r).constructor=e.prototype.constructor,r.prototype.enter=function(){this.__super.enter.call(this),o.addListener(i.STALLED,this.onStallHandler),o.inAdState()?o.hideControls():o.showControls()},r.prototype.exit=function(){this.__super.exit.call(this),o.removeListener(i.STALLED,this.onStallHandler)},r.prototype.onStallHandler=function(){o.play()},r.prototype.__canProcess=function(t){var e=t.type,n=!0;return e===i.PAUSE&&o.currentTime()===o.duration()?n=!1:e!==i.PAUSE&&e!==i.PLAY||!0!==o.seeking()||(n=!1),n},r.prototype.__processEvent=function(t){this.__canProcess(t)&&this.__super.__processEvent.call(this,t)},t.states.Play=r}(window.$ndp),function(t){var e=t.states.Active,n=t.states.Transitions,o=t.events.VideoEvent,i={};function s(t){s.constructor.call(this,t),this.transitions=i}i[o.SEEKED]=n.SEEKED,(s.prototype=new e).__super=e.prototype,(s.prototype.constructor=s).constructor=e.prototype.constructor,t.states.Seek=s}(window.$ndp),function(t){var e=t.states.Active,n=t.states.Transitions,o=t.NativeSingleton,i=t.events.VideoEvent,s={};function r(t){r.constructor.call(this,t),this.transitions=s,this.parent=t}s[i.VOLUME_CHANGE]=n.VOLUME,s[i.FULLSCREEN]=n.FULLSCREEN,s[i.COMPLETE]=n.COMPLETE,s[i.EMPTIED]=n.UNLOAD,(r.prototype=new e).__super=e.prototype,(r.prototype.constructor=r).constructor=e.prototype.constructor,r.prototype.enter=function(){this.__super.enter.call(this),o.inAdState()||o.isLive()||!t.DataStore.mediaAsset||o.load()},r.prototype.exit=function(){return this.__super.exit.call(this)},t.states.Stop=r}(window.$ndp),function(t){t.NativeSingleton;var e=t.states.Inactive,n=t.states.Transitions;function o(t){this.parent=t,o.constructor.call(this,t)}(o.prototype=new e).__super=e.prototype,(o.prototype.constructor=o).constructor=e.prototype.constructor,o.prototype.enter=function(){this.__super.enter.call(this),this.parent.stateUpdate(n.UNLOADED,{})},o.prototype.exit=function(){return this.__super.exit.call(this)},t.states.Unload=o}(window.$ndp),function(t){var e=t.states.Active,n=t.states.Transitions,o=t.events.VideoEvent,i={};function s(t){s.constructor.call(this,t),this.transitions=i}i[o.VOLUME_CHANGE]=n.VOLUME,i[o.FULLSCREEN]=n.FULLSCREEN,i[o.LOAD]=n.LOAD,(s.prototype=new e).__super=e.prototype,(s.prototype.constructor=s).constructor=e.prototype.constructor,t.states.Unloaded=s}(window.$ndp),function(i,t){var s=i.events.CommandEvent,r=i.NativeSingleton;function e(t){var e;this.parent=t,this.transitions={},this.handler=(e=this,function(t){e.__processEvent(t)})}e.prototype.enter=function(){this.__toggleHandlers(!0)},e.prototype.exit=function(){this.__toggleHandlers(!1)},e.prototype.handleCommand=function(t){var e=this.parent.adCommands();switch(e||(e=r),i.console.debug("*** AdActiveState.handleCommand ***",t,e),t.getType()){case s.PLAY:e.play();break;case s.LOAD:case s.PAUSE:e.pause();break;case s.STOP:e.stop();break;case s.SETVOLUME:var n=t.payload.muted,o=e!==r&&n?0:t.getVolume();o!==r.volume()&&e.volume(o),n!==r.muted()&&r.muted(n);break;case s.FULLSCREEN:t.payload.fullscreen?r.requestFullscreen():r.exitFullscreen();break;case s.CAPTION:t.isCaption()?r.showCaptions():r.hideCaptions()}},e.prototype.__toggleHandlers=function(t){var e=!0===t?"addListener":"removeListener";for(var n in this.transitions)this.transitions.hasOwnProperty(n)&&r[e](n,this.handler)},e.prototype.__processEvent=function(t){var e=r.duration(),n=this.transitions[t.type];return!(n===i.states.Transitions.START&&r.currentTime()===e&&!r.isLive())&&(this.parent.stateUpdate(n,{}),!0)},i.states=i.states||{},i.states.AdActive=e}(window.$ndp,window.NDP_DEBUG),function(t){var e=t.states.AdActive,n=t.states.Transitions,o=t.events.VideoEvent,i={};function s(t){s.constructor.call(this,t),this.transitions=i}i[o.PLAY]=n.PLAY,i[o.PAUSE]=n.PAUSE,i[o.VOLUME_CHANGE]=n.VOLUME,i[o.FULLSCREEN]=n.FULLSCREEN,(s.prototype=new e).__super=e.prototype,(s.prototype.constructor=s).constructor=e.prototype.constructor,t.states.AdIdle=s}(window.$ndp),function(s,t,n){if(n){s.events.AdEvent;var e=s.events.CommandEvent,i=s.events.PerfEvent,r=s.console,o=s.states,a=o.Inactive,l=o.Transitions,d=s.NativeSingleton,c=s.configuration.freewheel,p=new n.AdManager;p.setNetwork(c.network),p.setServer(c.url),(u.prototype=new a).__super=a.prototype,(u.prototype.constructor=u).constructor=a.prototype.constructor,u.prototype.enter=function(){this.__super.enter.call(this),setTimeout(this.loadFW.bind(this),1)},u.prototype.loadFW=function(){if(!d.showPreroll())return t&&r.debug("*** AdLoadState Enter => Exit :: showPreroll ***"),this.exit(),this.parent.lockedState.enter(),void this.parent.__playVideoAsset();this.__createAdContext(),this.parent.parent.addListener(e.UPDATEDISPLAYBASE,this.forceViewportUpdate),this.parent.parent.notify(new i(i.REQUEST_START,{})),d.setAdState(!0),this.containerId=this.parent.container.id,this.adContext.registerVideoDisplayBase(this.containerId),this.adContext.submitRequest(c.requestTimeout/1e3+2),!0},u.prototype.skipAd=function(){this.parent.__triggerAdTimeout()},u.prototype.exit=function(){return this.adAbandonmentTracker&&clearTimeout(this.adAbandonmentTracker),this.adContext&&(this.adContext.removeEventListener(n.EVENT_REQUEST_COMPLETE,this.onRequestCompleteHandler),this.adContext.removeEventListener(n.EVENT_REQUEST_INITIATED,this.onRequestInitHandler)),this.__super.exit.call(this)},u.prototype.__getAdConfiguration=function(){var t={adManager:p,profileId:c.playerProfile.replace("{runtime}","html5"),assetId:"missing guid",duration:500,fallbackId:c.videoAssetFallbackID,networkId:c.network,siteSectionId:c.siteSection,siteSectionFallbackId:c.siteSectionFallbackID,requestTimeout:c.requestTimeout/1e3+2};return s.configuration.siteData?(t.siteData=s.configuration.siteData,t.siteSectionId=s.configuration.siteData.siteSection):t.siteData={},s.DataStore.mediaAsset&&s.DataStore.mediaAsset.raw&&s.DataStore.mediaAsset.raw.duration&&!s.DataStore.mediaAsset.isLiveMedia&&(t.duration=s.DataStore.mediaAsset.raw.duration),s.DataStore&&s.DataStore.currentGuid&&(t.assetId=s.DataStore.currentGuid),t},u.prototype.__createAdContext=function(){var t=this.__getAdConfiguration();this.adContext&&this.adContext.previousSlot&&(r.warn("*** AdLoadState.__createAdContext ***","AdManager Context: Clear Slots & Dispose."),this.adContext.previousSlot.stop(),this.adContext.dispose()),this.adContext=t.adManager.newContext(),this.adContext.setProfile(t.profileId),this.adContext.setVideoAsset(t.assetId,t.duration,t.networkId,null,null,t.siteData.vprn,null,t.fallbackId),this.adContext.setSiteSection(t.siteSectionId,t.networkId,t.siteData.pvrn,null,t.siteSectionFallbackId),delete t.siteData.vprn,delete t.siteData.pvrn,this.__addKeyValues(t.siteData),this.adContext.addEventListener(n.EVENT_REQUEST_COMPLETE,this.onRequestCompleteHandler),this.adContext.addEventListener(n.EVENT_REQUEST_INITIATED,this.onRequestInitHandler),this.adContext.setParameter(n.PARAMETER_RENDERER_VIDEO_DISPLAY_CONTROLS_WHEN_PAUSE,!s.configuration.useCustomControls,n.PARAMETER_LEVEL_GLOBAL)},u.prototype.__addKeyValues=function(t){if(t){var e,n,o;for(e in t)if("string"==typeof(n=t[e]))this.adContext.addKeyValue(e,n);else if("kxsegs"===e)for(o in n)this.adContext.addKeyValue("ksg",n[o].ksg);var i=s.getQueryString("fwtest");i&&this.adContext.addKeyValue("fwtest",i)}},u.prototype.__transitionReady=function(t){if(this.positions={pre:[],mid:[],post:[],overlay:[]},t.success){var e=this.adContext.getSlotsByTimePositionClass(n.TIME_POSITION_CLASS_PREROLL);this.positions.pre=e||[],0<this.positions.pre.length&&(this.adContext.previousSlot=this.positions.pre[0]),this.parent.stateUpdate(l.LOADED,{positions:this.positions,context:this.adContext})}else r.error("TIME_POSITION_CLASS_PREROLL has FAILED"),this.parent.stateUpdate(l.NOAD,{})},s.states.AdLoad=u}function u(t){var e,n,o;r.warn("*** AdLoadState Initialized ***"),u.constructor.call(this,t),this.positions={pre:[],mid:[],post:[],overlay:[]},this.adAbandonmentTracker=0,this.onRequestCompleteHandler=(e=this,function(t){e.parent.parent.notify(new i(i.REQUEST_END,{})),e.__transitionReady(t)}),this.onRequestInitHandler=(n=this,function(){n.adAbandonmentTracker=window.setTimeout(function(){n.skipAd()},n.parent.adMoniter.threshold())}),this.forceViewportUpdate=(o=this,function(t){o.adContext.registerVideoDisplayBase(o.containerId)})}}(window.$ndp,window.NDP_DEBUG,window.tv&&window.tv.freewheel&&window.tv.freewheel.SDK),function(t){var e=t.events.CommandEvent,n=t.states.AdActive,o=t.NativeSingleton,i=t.states.Transitions,s=t.events.VideoEvent,r={};function a(t){a.constructor.call(this,t),this.transitions=r}r[s.PLAYING]=i.START,r[s.VOLUME_CHANGE]=i.VOLUME,r[s.FULLSCREEN]=i.FULLSCREEN,(a.prototype=new n).__super=n.prototype,(a.prototype.constructor=a).constructor=n.prototype.constructor,a.prototype.enter=function(t){this.__super.enter.call(this),this.ad=t,o.addListener(s.ABORT,this.onAbortHandler,this)},a.prototype.exit=function(){this.__super.exit.call(this),o.removeListener(s.ABORT,this.onAbortHandler,this)},a.prototype.onAbortHandler=function(){t.console.error("ABORT",":: MEDIA_ERROR :: Media ended unexpectedly",this),this.ad.stop(),this.parent.__restartContent()},a.prototype.handleCommand=function(t){t.getType()===e.PLAY&&(this.parent.__initAdVerification(),this.ad.play())},t.states.AdReady=a}(window.$ndp),function(t){var e=t.states.AdActive,n=t.states.Transitions,o=t.NativeSingleton,i=t.events.VideoEvent,s={};function r(t){r.constructor.call(this,t),this.transitions=s}s[i.PLAY]=n.PLAY,s[i.PAUSE]=n.PAUSE,s[i.PROGRESS]=n.PROGRESS,s[i.COMPLETE]=n.COMPLETE,s[i.STOP]=n.STOP,s[i.VOLUME_CHANGE]=n.VOLUME,s[i.FULLSCREEN]=n.FULLSCREEN,(r.prototype=new e).__super=e.prototype,(r.prototype.constructor=r).constructor=e.prototype.constructor,r.prototype.enter=function(){this.__super.enter.call(this),o.addListener(i.STALLED,this.onStallHandler),o.inAdState()?o.hideControls():o.showControls()},r.prototype.exit=function(){this.__super.exit.call(this),o.removeListener(i.STALLED,this.onStallHandler)},r.prototype.onStallHandler=function(){o.play()},r.prototype.__canProcess=function(t){var e=t.type,n=!0;return e===i.PAUSE&&o.currentTime()===o.duration()?n=!1:e!==i.PAUSE&&e!==i.PLAY||!0!==o.seeking()||(n=!1),n},r.prototype.__processEvent=function(t){this.__canProcess(t)&&this.__super.__processEvent.call(this,t)},t.states.AdPlay=r}(window.$ndp),function(a,l){var d=a.console;a.playbackAdapter="native";var n=a.events.CommandEvent,e=a.events.SystemEvent,c=a.events.PlaybackEvent,p=a.events.ErrorEvent,t=a.events.VideoEvent,u=a.states.Locked,h=a.states.Load,A=a.states.Loaded,E=a.states.Idle,f=a.states.Play,v=a.states.Seek,y=a.states.Stop,m=a.states.Unload,g=a.states.Unloaded,S=a.states.Transitions,o=a.AdapterFactory,r=a.MediaAsset,_=a.NativeSingleton,i={};function s(){switch(document.readyState){case"interactive":case"loaded":case"complete":document.removeEventListener("readystatechange",s),l&&d.warn("Document READYSTATE",document.readyState),w(),"ontouchstart"in window&&document.addEventListener("touchstart",T)}}function w(){_.setAttribute("style","left:-9999px;height:1px;width:1px;position:absolute;"),document.body.appendChild(_.getVideoElement())}function T(){_.play(),document.removeEventListener("touchstart",T)}function L(t,e){this.parent=t,this.currentAsset=null,this.container=e;var o,n=new E(this),i=new f(this);this.states={},this.states[S.LOAD]=new h(this),this.states[S.LOADED]=new A(this),this.states[S.SEEK]=new v(this),this.states[S.START]=i,this.states[S.PLAY]=i,this.states[S.VOLUME]=i,this.states[S.FULLSCREEN]=i,this.states[S.PAUSE]=n,this.states[S.COMPLETE]=n,this.states[S.STOP]=new y(this),this.states[S.UNLOAD]=new m(this),this.states[S.UNLOADED]=new g(this),this.lockedState=new u(this),this.currentState=null,this.previousState=null,this.onVideoError=(o=this,function(){var t,e,n;switch(_.getErrorCode()){case MediaError.MEDIA_ERR_NETWORK:t=p.NETWORK_ERROR,n="Network connection was not properly established";break;case MediaError.MEDIA_ERR_DECODE:case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:t=p.MEDIA_ERROR,n="Media failed to load correctly, MediaAssetID: "+o.currentAsset.getID()}t&&_.src()===o.src&&(l&&d.error(t,":: MEDIA_ERROR :: Media failed to load correctly"),e=new p(t,{error:n},a.DataStore.activePlayer),o.parent.notify(e))}),this.__render(),this.__addHandlers();var s,r=a.detectFullscreenSupport();document.addEventListener(r.fullscreenEvent,(s=this,function(t){s.parent.notify(new c(c.FULLSCREEN,{fullscreen:r.fullscreenEnabled},a.DataStore.activePlayer))}))}i[S.LOADED]=c.LOADED,i[S.START]=c.START,i[S.PLAY]=c.PLAY,i[S.PAUSE]=c.PAUSE,i[S.PROGRESS]=c.PROGRESS,i[S.STOP]=c.STOP,i[S.COMPLETE]=c.COMPLETE,i[S.UNLOADED]=c.UNLOADED,i[S.SEEKED]=c.SEEK,i[S.VOLUME]=c.VOLUME_CHANGE,i[S.FULLSCREEN]=c.FULLSCREEN,a.__has(["complete","loaded","interactive"],document.readyState)?s():(l&&d.warn("Document READYSTATE on ADDED eventListener",document.readyState),document.addEventListener("readystatechange",s)),L.canHandle=function(t){return t instanceof r},L.prototype.destroy=function(){this.__removeHandlers(),this.queuedEvents.length=0,this.container=null,this.parent=null},L.prototype.handleLoad=function(t){l&&d.log("NativePlayerAdapter.handleLoad :: EVENT HANDLE LOAD"),null!==this.currentAsset&&this.handleUnload(t),null!==this.currentAsset&&t.getAsset().getID()===this.currentAsset.getID()||(null!==this.currentState&&this.currentState.exit(),a.DataStore.activePlayer=t.getPlayer(),a.DataStore.mediaAsset=t.getAsset(),this.currentAsset=a.DataStore.mediaAsset,l&&d.debug("NativePlayerAdapter.handleLoad :: Change Player",a.DataStore.activePlayer),this.currentState=this.states[S.LOAD],this.currentState.enter(this.currentAsset))},L.prototype.handleUnload=function(t){l&&d.log("NativePlayerAdapter.handleUnload :: EVENT HANDLE UNLOAD"),t.getAsset().getID()!==this.currentAsset.getID()&&(this.currentState&&this.currentState.exit(),this.currentState=this.states[S.UNLOAD],this.currentState.enter(this.currentAsset))},L.prototype.handleCommand=function(t){this.currentState.handleCommand(t)},L.prototype.stateUpdate=function(t,e){var n=this.states[t];switch(t){case S.START:var o=this.currentAsset,i=o instanceof r&&!o.isLive()?o.getVideoData():{url:o.getURL(),isLiveMedia:o.isLiveMedia};_.setCaptions(i.cc||"");break;case S.FULLSCREEN:var s=a.detectFullscreenSupport();e.fullscreen={element:s.fullscreenElement,type:s.fullscreenEvent,enabled:s.fullscreenEnabled};break;case S.SEEKED:n=this.previousState;break;case S.UNLOCK:return void this.__handleUnlock()}this.__switchStates(n),this.__processTransitionEvent(t,e)},L.prototype.__handleLock=function(){this.currentState!==this.lockedState&&(this.currentState.exit(),this.lockedState.enter(),this.previousState=this.currentState,this.currentState=this.lockedState)},L.prototype.__handleUnlock=function(){this.currentState===this.lockedState&&(this.currentState=this.previousState,this.lockedState.exit(),this.currentState.enter())},L.prototype.__switchStates=function(t){var e;t&&(this.previousState=this.currentState||null,e=this.previousState.exit(),this.currentState=t,a.DataStore.currentState=t,this.currentState.enter(),this.__processQueuedCommands(e))},L.prototype.__processQueuedCommands=function(t){if(t)for(var e;t.length;)(e=t.shift()).getType()===n.LOAD?this.handleLoad(e):e.getType()===n.UNLOAD?this.handleUnload(e):this.currentState.handleCommand(e)},L.prototype.__processTransitionEvent=function(t,e){var n=i[t];n&&(e=a.__extend(e,{asset:this.currentAsset,native:_.getVideoElement()}),this.parent.notify(new c(n,e),a.DataStore.activePlayer))},L.prototype.toggleLock=function(t){_.inAdState()?this.__handleLock():_.inAdState()||this.__handleUnlock()},L.prototype.__addHandlers=function(){this.parent.addListener(n.LOAD,this.handleLoad,this),this.parent.addListener(n.UNLOAD,this.handleUnload,this),this.parent.addListener(n.PLAY,this.handleCommand,this),this.parent.addListener(n.PAUSE,this.handleCommand,this),this.parent.addListener(n.STOP,this.handleCommand,this),this.parent.addListener(n.SETPLAYHEAD,this.handleCommand,this),this.parent.addListener(n.FULLSCREEN,this.handleCommand,this),this.parent.addListener(n.SETVOLUME,this.handleCommand,this),this.parent.addListener(n.CAPTION,this.handleCommand,this),_.addListener(e.VIDEO_ERROR,this.onVideoError,this),_.addListener(t.SWITCH_ADAPTERS,this.toggleLock,this),_.addListener(c.HAS_CAPTIONS,this.forwardEvent,this)},L.prototype.__removeHandlers=function(){this.parent.removeListener(n.LOAD,this.handleLoad,this),this.parent.removeListener(n.UNLOAD,this.handleUnload,this),this.parent.removeListener(n.PLAY,this.handleCommand,this),this.parent.removeListener(n.PAUSE,this.handleCommand,this),this.parent.removeListener(n.STOP,this.handleCommand,this),this.parent.removeListener(n.SETVOLUME,this.handleCommand,this),this.parent.removeListener(n.SETPLAYHEAD,this.handleCommand,this),this.parent.removeListener(n.FULLSCREEN,this.handleCommand,this),this.parent.removeListener(n.CAPTION,this.handleCommand,this),_.removeListener(e.VIDEO_ERROR,this.onVideoError,this),_.removeListener(t.SWITCH_ADAPTERS,this.toggleLock,this),_.removeListener(c.HAS_CAPTIONS,this.forwardEvent,this)},L.prototype.forwardEvent=function(t){this.parent.notify(t)},L.prototype.setVideoSrc=function(t){_.setVideoSrc(t)},L.prototype.__render=function(){w=function(){},_.placeVideo(this.container),a.DataStore.activePlayer||a.players.loadActivePlayer();var t=new e(e.PLAYER_LOADED,{},a.DataStore.activePlayer);t.autoDispatch=!0,this.parent.notify(t)},o.add(L)}(window.$ndp,window.NDP_DEBUG),function(l,s,i){if(i){var r=l.console,a=null,n=!1,d=l.events.CommandEvent,c=(l.events.SystemEvent,l.events.AdEvent),e=l.events.VideoEvent,p=l.events.ErrorEvent,o=l.states.Locked,u=l.states.AdLoad,h=l.states.AdReady,A=l.states.AdIdle,E=l.states.AdPlay,f=l.states.Transitions,v={};v[f.LOADED]=c.LOADED,v[f.START]=c.START,v[f.PLAY]=c.PLAY,v[f.PAUSE]=c.PAUSE,v[f.PROGRESS]=c.PROGRESS,v[f.ADCOMPLETE]=c.COMPLETE,v[f.NOAD]=c.NOPREROLL,v[f.ADSKIP]=c.ADSKIP,v[f.VOLUME]=c.VOLUME_CHANGE,v[f.FULLSCREEN]=c.FULLSCREEN;var t=l.AdapterFactory,y=l.NativeSingleton,m=l.configuration.freewheel;i.setLogLevel(m.logLevel||i.LOG_LEVEL_QUIET),g.prototype.initStates=function(){var t=new A(this),e=new E(this);this.states={},this.states[f.LOAD]=new u(this),this.states[f.LOADED]=new h(this),this.states[f.START]=e,this.states[f.PLAY]=e,this.states[f.VOLUME]=e,this.states[f.FULLSCREEN]=e,this.states[f.PAUSE]=t,this.states[f.STOP]=t,this.states[f.ADCOMPLETE]=t,this.states[f.NOAD]=t,this.states[f.ADSKIP]=t,this.lockedState=new o(this),this.currentState=this.lockedState,this.previousState=null},g.prototype.destroy=function(){this.__removeHandlers(),this.__destroyAdContext(),this.adContext=null,this.onAdClickedHandler=null,this.container=null,this.videoElement=null,this.parent=null},g.canHandle=function(t){return t===l.adapterTypes.AD},g.prototype.adCommands=function(){var t=!1,e=this.currentAd;return this.currentAd&&(t={play:e.resume,pause:e.pause,stop:function(){n=!0,e.stop()},volume:this.adContext&&this.adContext.setAdVolume.bind(this.adContext)}),t},g.prototype.handleCommand=function(t){this.currentState.handleCommand(t)},g.prototype.handleLoad=function(t){s&&r.debug("NativeFreewheelAdapter.handleLoad :: EVENT HANDLE LOAD"),this.__removeAdHandlers(),this.__clearAdVerification(),this.currentState.exit();var e=t.asset||l.DataStore.mediaAsset;"monetize"in e.raw&&!1===e.raw.monetize?this.__handleLock():this.__handleUnlock()},g.prototype.__skipAd=function(){this.currentAd?this.currentAd.skipCurrentAd():this.__restartContent(!1),this.__skipAdReport()},g.prototype.__skipAdReport=function(){var t=new Date;this.__adErrorReport(c.ADSKIP,"The ad render had been abandoned at "+(t-this.adMoniter.startTime)+" milliseconds.")},g.prototype.__initAdVerification=function(){var t=this;this.__clearAdVerification(),this.adMoniter.startTime=new Date,this.adMoniter.tracker=window.setTimeout(function(){t.__triggerAdTimeout()},this.adMoniter.threshold())},g.prototype.__clearAdVerification=function(){this.adMoniter.tracker&&window.clearTimeout(this.adMoniter.tracker)},g.prototype.__triggerAdTimeout=function(){this.__clearAdVerification(),this.__skipAd()},g.prototype.__adErrorReport=function(t,e){var n={state:this.currentAdState(),positions:l.__cloneObjToJson(this.slotPositions),context:l.__cloneObjToJson(this.adContext)},o=new p(c.ERROR,{error:t,description:e||"",fw_ads:n},l.DataStore.activePlayer);this.parent.notify(o)},g.prototype.stateUpdate=function(t,e){this.slotPositions=e.positions||null;var n=this.states[t],o=!1;switch(t){case f.UNLOCK:return void this.__handleUnlock();case f.START:this.__clearAdVerification(),y.hideCaptions(),this.setControlsTrue();break;case f.LOADED:if(this.adContext=e.context,this.currentAd=e.positions.pre.shift(),!this.currentAd)return void this.__restartContent();this.__addAdHandlers(),l.isMuted&&this.adContext.getAdVolume()&&this.adContext.setAdVolume(0);break;case f.LOCK:return void this.__handleLock();case f.ADSKIP:o=e.stopped||!1,this.adContext&&this.adContext.previousSlot&&this.adContext.previousSlot.stop();break;case f.ADCOMPLETE:s&&r.debug("Transitions.ADCOMPLETE",t),this.adContext&&this.adContext.previousSlot&&this.adContext.previousSlot.stop()}this.__switchStates(n),this.__processTransitionEvent(t,e);var i=[f.ADCOMPLETE,f.NOAD,f.ADSKIP];l.__has(i,t)&&this.__restartContent(o)},g.prototype.__restartContent=function(t){var e=this;y.setAdState(!1),this.__clearAdVerification(),this.__handleLock(),setTimeout(function(){e.__playVideoAsset(t)},1)},g.prototype.__playVideoAsset=function(t){l.isMuted&&!y.volume()&&(y.volume(.75),y.muted(!0)),y.restartFromAd(t)},g.prototype.__processTransitionEvent=function(t,e){if(v[t]){var n=0,o=0,i=y.getVideoElement(),s=y.volume(),r=y.offsetWidth(),a=y.offsetHeight();this.currentAd&&(n=this.currentAd.getTotalDuration(),o=this.currentAd.getPlayheadTime(),i=this.adContext.getContentVideoElement(),s=this.adContext.getAdVolume(),r=this.currentAd.getWidth(),a=this.currentAd.getHeight()),e=l.__extend(e,{native:i,playheadPosition:Math.ceil(1e3*o),totalLength:Math.ceil(1e3*n),volume:s,width:r,height:a,banners:{id:this.currentAd&&this.currentAd.getCustomId(),state:this.currentAd&&this.currentAd.getState(),size:this.currentAd&&this.currentAd.getVideoDisplaySize()}}),this.parent.notify(new c(v[t],e,l.DataStore.activePlayer))}},g.prototype.__handleLock=function(){this.currentState.exit(),this.currentState!==this.lockedState&&(s&&r.debug("NativeFreewheelAdapter.__handleLock",this.currentState,this.adContext),y.addListener(e.PLAY,this.__updateContentState,this),y.addListener(e.PAUSE,this.__updateContentState,this),y.addListener(e.STOP,this.__updateContentState,this),y.addListener(e.COMPLETE,this.__updateContentState,this),this.lockedState.enter(),this.previousState=this.currentState,this.currentState=this.lockedState,this.adContext&&this.__removeAdHandlers())},g.prototype.__handleUnlock=function(){var t=this.lockedState.exit();this.videoElement.addEventListener("webkitbeginfullscreen",this.fullscreenHandler),this.videoElement.addEventListener("webkitendfullscreen",this.fullscreenHandler),y.removeListener(e.PLAY,this.__updateContentState,this),y.removeListener(e.PAUSE,this.__updateContentState,this),y.removeListener(e.STOP,this.__updateContentState,this),y.removeListener(e.COMPLETE,this.__updateContentState,this),this.currentState=this.states[f.LOAD],this.currentState.enter(),this.__processQueuedCommands(t)},g.prototype.__updateContentState=function(t){if(this.adContext)switch(t.getType()){case e.PLAY:this.adContext.setVideoState(i.VIDEO_STATE_PLAYING);break;case e.PAUSE:this.adContext.setVideoState(i.VIDEO_STATE_PAUSED);break;case e.STOP:this.adContext.setVideoState(i.VIDEO_STATE_STOPPED);break;case e.COMPLETE:this.adContext.setVideoState(i.VIDEO_STATE_STOPPED),this.adContext.setVideoState(i.VIDEO_STATE_COMPLETED),this.currentAdState(null)}},g.prototype.__switchStates=function(t){var e;t&&(l.DataStore.currentState=t,this.previousState=this.currentState||null,e=this.previousState.exit(),this.currentState=t,this.currentState.enter(this.currentAd),this.__processQueuedCommands(e))},g.prototype.__processQueuedCommands=function(t){var e;if(t)for(;t.length;)e=t.shift(),this.handleCommand(e),e.getType()===d.LOAD&&this.__handleUnlock()},g.prototype.__destroyAdContext=function(){this.__clearAdVerification(),this.adContext&&(this.__removeAdHandlers(),this.adContext.dispose(),this.adContext=null)},g.prototype.toggleLock=function(t){this.emptiedCount&&!t.payload.isAdState||this.currentState!==this.lockedState?t.payload.isAdState||(this.__handleLock(),this.emptiedCount=0):(this.__handleUnlock(),this.emptiedCount++)},g.prototype.__addHandlers=function(){this.parent.addListener(d.LOAD,this.handleLoad,this),this.parent.addListener(d.PLAY,this.handleCommand,this),this.parent.addListener(d.PAUSE,this.handleCommand,this),this.parent.addListener(d.STOP,this.handleCommand,this),this.parent.addListener(d.SETVOLUME,this.handleCommand,this),this.parent.addListener(d.SETPLAYHEAD,this.handleCommand,this),this.parent.addListener(d.FULLSCREEN,this.handleCommand,this),y.addListener(e.ERROR,this.__restartContent,this)},g.prototype.__removeHandlers=function(){this.parent.removeListener(d.LOAD,this.handleLoad,this),this.parent.removeListener(d.PLAY,this.handleCommand,this),this.parent.removeListener(d.PAUSE,this.handleCommand,this),this.parent.removeListener(d.STOP,this.handleCommand,this),this.parent.removeListener(d.SETVOLUME,this.handleCommand,this),this.parent.removeListener(d.SETPLAYHEAD,this.handleCommand,this),this.parent.removeListener(d.FULLSCREEN,this.handleCommand,this),y.removeListener(e.ERROR,this.__restartContent,this),this.videoElement.removeEventListener("webkitbeginfullscreen",this.fullscreenHandler),this.videoElement.removeEventListener("webkitendfullscreen",this.fullscreenHandler)},g.prototype.__addAdHandlers=function(){this.adContext&&(this.adContext.addEventListener(i.EVENT_AD_CLICK,this.onAdClickedHandler),this.adContext.addEventListener(i.EVENT_AD,this.onAdHandler),this.adContext.addEventListener(i.EVENT_SLOT_STARTED,this.onSlotStarted),this.adContext.addEventListener(i.EVENT_SLOT_ENDED,this.onSlotEnded),this.adContext.addEventListener(i.EVENT_AD_MUTE,this.onAdHandler),this.adContext.addEventListener(i.EVENT_AD_UNMUTE,this.onAdHandler),this.adContext.addEventListener(i.EVENT_AD_PAUSE,this.onAdHandler),this.adContext.addEventListener(i.EVENT_AD_RESUME,this.onAdHandler))},g.prototype.__removeAdHandlers=function(){this.adContext&&(this.adContext.removeEventListener(i.EVENT_AD_CLICK,this.onAdClickedHandler),this.adContext.removeEventListener(i.EVENT_AD,this.onAdHandler),this.adContext.removeEventListener(i.EVENT_SLOT_STARTED,this.onSlotStarted),this.adContext.removeEventListener(i.EVENT_SLOT_ENDED,this.onSlotEnded),this.adContext.removeEventListener(i.EVENT_AD_MUTE,this.onAdHandler),this.adContext.removeEventListener(i.EVENT_AD_UNMUTE,this.onAdHandler),this.adContext.removeEventListener(i.EVENT_AD_PAUSE,this.onAdHandler),this.adContext.removeEventListener(i.EVENT_AD_RESUME,this.onAdHandler))},g.prototype.__onSlotStarted=function(t){var e=t.slot;e.getTimePositionClass()===i.TIME_POSITION_CLASS_PREROLL&&e.getState()instanceof i.MediaPlayingState&&this.stateUpdate(f.START,{})},g.prototype.__onSlotEnded=function(t){var e=t.slot;s&&r.log("NativeFreewheelAdapter.__onSlotEnded",t,n),this.__clearAdVerification(),e.getTimePositionClass()===i.TIME_POSITION_CLASS_PREROLL&&(e.getState()instanceof i.MediaEndState?(l.NativeSingleton.adCompleteAction(),n?(n=!1,this.stateUpdate(f.ADSKIP,{stopped:!0})):this.stateUpdate(f.ADCOMPLETE,{stopped:!1})):this.__restartContent(!1))},g.prototype.__onAdEvent=function(t){var e=t.adInstance,n=t.slot;switch(s&&r.debug("NativeFreewheelAdapter.__onAdEvent",t),t.subType){case i.EVENT_AD_IMPRESSION:case i.EVENT_AD_IMPRESSION_END:n===this.currentAd&&this.currentAdState(t.subType),r.debug("[EVENT_AD]: "+t.subType+" with ad:"+e.getAdId()+" and slot:"+n.getCustomId());break;case i.EVENT_AD_FIRST_QUARTILE:case i.EVENT_AD_MIDPOINT:case i.EVENT_AD_THIRD_QUARTILE:case i.EVENT_AD_COMPLETE:n===this.currentAd&&this.currentAdState(t.subType),r.info("[EVENT_AD]: "+t.subType+" with ad:"+e.getAdId()+" and slot:"+n.getCustomId());break;case i.EVENT_AD_EXPAND:case i.EVENT_AD_COLLAPSE:case i.EVENT_AD_CLOSE:case i.EVENT_AD_MINIMIZE:r.warn("[EVENT_AD]: "+t.subType+" with ad:"+e.getAdId()+" and slot:"+n.getCustomId());break;case i.EVENT_RESELLER_NO_AD:case i.EVENT_ERROR:n===this.currentAd&&this.currentAdState(t.subType);var o="[EVENT_AD]"+(t.subType===i.EVENT_ERROR?"[EVENT_ERROR]":"[EVENT_RESELLER_NO_AD]")+": "+t.subType+" with ad:"+e.getAdId()+" and slot:"+n.getCustomId();this.__adErrorReport(errorEvent,description),r.error(o,t);break;default:r.log("[EVENT_AD]: "+t.subType+" with ad:"+e.getAdId()+" and slot:"+n.getCustomId())}},g.prototype.setControlsTrue=function(){var t=this;t.isFullScreen&&!t.videoElement.controls&&setTimeout(function(){t.videoElement.controls=!0},100)},l.flashAvailable||t.add(g)}function g(t,e){var n,o,i,s;this.parent=t,this.container=e,this.videoElement=y.getVideoElement(),this.captions=[],this.currentAd=null,this.slotPositions=null,this.isFullScreen=!1,this.emptiedCount=0,this.adMoniter={tracker:0,threshold:function(){var t=parseInt(m.requestTimeout);return t+t/2||7e3},startTime:0},this.onAdClickedHandler=(n=this,function(){n.handleCommand(new d(d.PAUSE,{},l.DataStore.activePlayer))}),this.onAdHandler=(o=this,function(t){o.__onAdEvent(t)}),this.onSlotStarted=(i=this,function(t){i.__onSlotStarted(t)}),this.onSlotEnded=(s=this,function(t){s.__onSlotEnded(t,s.slotPositions)}),this.fullscreenHandler=function(){y.showControls()},this.currentAdState=function(){return arguments.length&&(r.log("[CURRENT AD STATE] Updated",arguments[0]),a=arguments[0]),a},this.__addHandlers(),this.initStates()}}(window.$ndp,window.NDP_DEBUG,window.tv&&window.tv.freewheel&&window.tv.freewheel.SDK),function(i){Object.defineProperty(i.models,"CommandDataObject",{value:function(t){var e=i.DataStore,n=e.activePlayer||{};for(var o in this.dataStore=n.dataStore||null,this.playerId=this.dataStore&&this.dataStore.id||null,this.asset=e.mediaAsset,this.playheadPosition=Math.ceil(1e3*e.seekTo),this.totalLength=Math.ceil(1e3*e.duration),this.muted=e.isMuted,this.volume=parseFloat(e.volume),this.isLive=!!e.isLive||!1,t)this[o]=t[o]},enumerable:!0})}(window.$ndp),function(E,f){var t=E.AbstractObserver,v=E.ModuleManager,y=E.events.CommandEvent,m=E.events.SystemEvent,e=E.MessageBus,g=!1,S=document.createElement("div");S.id="ndp_video_player_"+Date.now(),S.classList.add("ndp-video-player");var _=E.console;function n(){t.call(this);var i=null,e=!1,n=!1,o=!1,s=.75,r=!1,a=0,l=!1,d=null,c=null,p=null,u=null,h=null,A=!1;Object.defineProperties(this,{dataContainer:{get:function(){return S},enumerable:!0},activePlayer:{get:function(){return i},set:function(t){if(t instanceof E.models.PlayerEvent)t=t.player;else{if(null===t)return void(i=t);if(!(t instanceof window.NDPPlayer))throw f&&_.warn("Active Player Model",typeof t,t),new Error("ERROR :: Player is NOT a proper model for setting Active Player")}if(i=t,"pdk"!==E.fileType||!g){var e=this.dataContainer.parentElement||this.dataContainer.parentNode;if(i&&i.dataStore.container.id!==(e&&e.id)){var n=i.dataStore,o=new m(m.PLAYER_ACTIVE,{},i);f&&_.debug("New Active Player","SystemEvent_Player_Active"),n.container.appendChild(this.dataContainer),o.autoDispatch=!0,this.messageBus.notify(o),"pdk"===E.fileType&&(g=!0)}}}},playIntiated:{get:function(){return e},set:function(t){e=t}},autoPlay:{get:function(){return n},set:function(t){n=t},enumerable:!0},continuousPlay:{get:function(){return o},set:function(t){o=t}},caption:{get:function(){return this.native?this.native.hasCaptions():l},set:function(t){l=Boolean(t)||!1,this.messageBus.notify(new y(y.CAPTION,{caption:l},this.activePlayer))}},volume:{get:function(){return this.native?this.native.volume():s},set:function(t){s=parseFloat(t),this.messageBus.notify(new y(y.SETVOLUME,{volume:s},this.activePlayer))}},isMuted:{get:function(){return this.native?this.native.muted():r},set:function(t){this.native&&this.native.muted(t),r=t,this.messageBus.notify(new y(y.SETVOLUME,{muted:r},this.activePlayer))}},fullscreen:{get:function(){return E.detectFullscreenSupport().fullscreenEnabled},set:function(t){var e=E.detectFullscreenSupport();this.messageBus.notify(new y(y.FULLSCREEN,{fullscreen:e.fullscreenEnabled},this.activePlayer))}},seekTo:{get:function(){return this.native?this.native.currentTime():a},set:function(t){a=parseFloat(t)||0,this.messageBus.notify(new y(y.SETPLAYHEAD,{seekTo:a},this.activePlayer))}},duration:{get:function(){return this.native?this.native.duration():0}},isLive:{get:function(){return!!this.native&&this.native.isLive()}},mediaAsset:{get:function(){return d},set:function(t){if(d=t){this.currentGuid=t.id;var e=new y(y.ADLOAD,{asset:d},this.activePlayer);this.messageBus.notify(e)}A||(A=!0)}},currentGuid:{get:function(){return c},set:function(t){c=t}},currentState:{get:function(){return p},set:function(t){p=t,f&&(this.stateHistory[E.getTimeString()]=E.getFnName(t.constructor))}},currentEvent:{get:function(){return u},set:function(t){u=t+"",2<E.debugMode()&&(this.eventHistory[E.getTimeString()]=u)}},currentVideoEvent:{get:function(){return h},set:function(t){h=t.toString(),2<E.debugMode()&&(this.videoEventsHistory[E.getTimeString()]=h)}}}),this.native&&(s=this.native.volume(),r=this.native.muted(),a=this.native.currentTime(),l=this.native.hasCaptions()),v.create(this.messageBus,S),this.messageBus.addListener("*",this)}(n.prototype=Object.create(t.prototype,{messageBus:{value:new e},stateHistory:{value:{}},eventHistory:{value:{}},videoEventsHistory:{value:{}},native:{get:function(){return E.NativeSingleton}}})).constructor=n,Object.defineProperty(E,"DataStore",{value:new n,enumerable:!0}),Object.defineProperty(E,"isMuted",{get:function(){return E.DataStore.isMuted},enumerable:!0})}(window.$ndp,window.NDP_DEBUG),function(t){Object.defineProperty(t.models,"PlayerEvent",{value:function(t){this.player=t,Object.defineProperties(this,{id:{get:function(){return t.dataStore.id},enumerable:!0},status:{get:function(){return t.dataStore.state},enumerable:!0},primary:{get:function(){return t.dataStore.primary},enumerable:!0},index:{get:function(){return t.dataStore.index},enumerable:!0}})},enumerable:!0})}(window.$ndp),function(p,u){var h=p.events.CommandEvent,A=p.events.SystemEvent,E=p.Playlist,f=p.MediaAsset,e=p.isDomElement,v=p.console,y="INACTIVE",m="UNLOADED",g="LOADED",S="ACTIVE";function t(t,e){var o=e.player,n=t||null,i=document.createElement("div");u&&v.warn("ParentLocation",n);var s=(n&&n.id||"")+"_ndp_"+Date.now(),r="inactive",a=!1,l=null,d=null,c=null;i.id=s,i.classList.add("ndp-video"),n&&n.appendChild(i),Object.defineProperties(this,{id:{get:function(){return s},enumerable:!0},index:{get:function(){return p.players.findIndexById(this.id)},enumerable:!0},container:{get:function(){return i},enumerable:!0},location:{get:function(){return n},set:function(t){if(t=_(t),n!==t){if(!(n=_(t)))throw new Error("HTML Element location does not exist");n.appendChild(this.container),o.locationId=n.id,o.__mBus.notify(new A(A.VIEWPORT_UPDATE,{},o))}},enumerable:!0},primary:{get:function(){return 0===p.players.findIndexById(this.id)||a},set:function(t){a=t,u&&v.debug("Is Primary?",t,this),a&&p.players.setFirstPlayer(this.id)},enumerable:!0},state:{get:function(){if(o===p.DataStore.activePlayer)switch(r){case"active":return S;case"load":return g;default:return m}return y},set:function(t){r=t},enumerable:!0},mediaAsset:{get:function(){return l},set:function(t){if(!(t instanceof f||t instanceof E))throw new Error("Asset type must be of NDP MediaAsset or NDP Playlist");var e=this.playlist;e&&-1===e.getAssetIndex(t)&&(this.playlist=null),t instanceof E&&(t=(this.playlist=t).first()),l=t,this.currentGuid=t.id;var n=new h(h.LOAD,{asset:l,isAutoPlay:!1},o);o.__mBus.notify(n)},enumerable:!0},playlist:{get:function(){return d},set:function(t){d=t},enumerable:!0},currentGuid:{get:function(){return c},set:function(t){c=t},enumerable:!0},destroy:{get:function(){return!this.container},set:function(t){t&&(c=l=d=i=null)}},on:{value:{},enumerable:!0}})}function _(t){return e(t)?t:document.getElementById(t)}t.prototype=Object.create({constructor:t},{playIntiated:{get:function(){return p.DataStore.playIntiated},enumerable:!0},autoPlay:{get:function(){return!1},enumerable:!0},caption:{get:function(){return p.DataStore.caption},enumerable:!0},volume:{get:function(){return p.DataStore.volume},enumerable:!0},mute:{get:function(){return p.DataStore.isMuted},enumerable:!0},fullscreen:{get:function(){return p.DataStore.fullscreen},enumerable:!0},seekTo:{get:function(){return p.DataStore.seekTo},enumerable:!0},isLive:{get:function(){return p.DataStore.isLive},enumerable:!0}}),Object.defineProperty(p.models,"PlayerDataStore",{value:t,enumerable:!0})}(window.$ndp,window.NDP_DEBUG),function(o){function t(){Object.defineProperties(this,{activePlayerId:{value:!1,writable:!0,enumerable:!0},PlayerEvent:{get:function(){return o.models.PlayerEvent}}})}t.prototype=Object.create({constructor:t},{array:{value:[]},length:{get:function(){return this.array.length},enumerable:!0},add:{value:function(t){if(t instanceof window.NDPPlayer)t=new this.PlayerEvent(t);else if(!(t instanceof this.PlayerEvent))return o.console.error("ERROR :: PlayerArrayModel","Player Instance is NOT a proper Model",t),-1;t.primary?this.array.unshift(t):this.array.push(t);!o.DataStore.activePlayer&&t.primary&&(o.DataStore.activePlayer=t);return t.index},enumerable:!0},remove:{value:function(t){"string"!=typeof t&&(t=t.id);var e=this.findIndexById(t);this.array.splice(e,1)},enumerable:!0},findByIndex:{value:function(t){return this.array[+t]||null},enumerable:!0},findIndexById:{value:function(t){var e=this.length;for(;e--;)if(this.array[e].id===t)return e;return-1},enumerable:!0},setFirstPlayer:{value:function(t){var e=this.findIndexById(t);if(o.console.warn("Setting primary player",t,e,this),e<=0)return e;var n=this.array.splice(e,1);o.isArray(n)&&(n=n[0]);return this.array.unshift(n),this.loadActivePlayer(),0},enumerable:!0},loadActivePlayer:{value:function(){return!!this.length&&(o.DataStore.activePlayer=this.findByIndex(0),!0)},enumerable:!0}}),Object.defineProperty(o,"players",{value:new t})}(window.$ndp),function(d){if(!d)throw new Error("$ndp Object does not exist. ");var t=d.AbstractObserver,e=d.events.CommandEvent,a=d.events.SystemEvent,n=d.MediaAsset,l=d.models.PlayerEvent,c=d.models.PlayerDataStore,p=d.isDomElement,u=d.console;function o(t){t&&t.location||(p(t)?t={location:t}:"string"==typeof t?t={location:document.getElementById(t)}:p(d.configuration.location)&&(t.location=d.configuration.location)),(d.configuration.location||d.configuration.primary)===t.location&&(t.primary=!0);var e,n,o,i,s=new l(this);this.__mBus=d.DataStore.messageBus,this.__mBus.addListener("*",this),this.__mBus.addListener(d.events.PlaybackEvent.COMPLETE,this.__onMediaComplete,this),this.dataStore=new c(t.location,s),d.players.add(s),e=t,o=(n=this).dataStore,i=Object.prototype.hasOwnProperty,e=e||{},u.debug("Mapping Player Instance Content",o.id,e,o),setTimeout(function(){for(var t in e){if(!(i.call(o,t)||t in o))throw u.error("Property Undefined",t,o[t],o),new Error("No property match for "+t);n[t](e[t])}},10);var r=new a(a.PLAYER_CREATED,{},this);r.autoDispatch=!0,this.__mBus.notify(r)}function i(t,n){var o=this,e=null,i=null,s=null;function r(t,e){Object.prototype.hasOwnProperty.call(e,"scope")?o[n](t,e.listener,e.scope):o[n](t,e)}for(var a in t)if(Object.prototype.hasOwnProperty.call(t,a))if(Object.prototype.hasOwnProperty.call(d.events,a))for(var l in i=d.events[a],s=t[a])Object.prototype.hasOwnProperty.call(s,l)&&Object.prototype.hasOwnProperty.call(i,l)&&(e=s[l],r(i[l],e));else e=t[a],r(a=[a],e)}((o.prototype=new t).constructor=o).constructor=t.prototype.constructor,o.prototype.__super=t.prototype,o.prototype.on=function(){switch(arguments.length){case 1:i.call(this,arguments[0],"addListener");break;default:this.addListener.apply(this,arguments)}},o.prototype.off=function(){switch(arguments.length){case 1:i.call(this,arguments[0],"removeListener");break;default:this.removeListener.apply(this,arguments)}},o.prototype.id=function(){return this.dataStore.id},o.prototype.location=function(){if(arguments.length){var t=arguments[0];"string"==typeof t&&(t=document.getElementById(t)),this.dataStore.location=t,u.info(" location ",this.dataStore.location)}return this.dataStore.location},o.prototype.container=function(){return this.dataStore.container},o.prototype.sequence=function(){return this.dataStore.index},o.prototype.status=function(){return this.dataStore.state},o.prototype.primary=function(){return arguments.length&&(this.dataStore.primary=arguments[0]),this.dataStore.primary},o.prototype.mediaAsset=function(){return arguments.length&&(this.dataStore.mediaAsset=arguments[0],this.dataStore.state="load"),d.DataStore.mediaAsset},o.prototype.autoPlay=function(){return window.console.warn("NDP auto play is depreciated and no longer supported."),!1},o.prototype.play=function(){arguments[0]instanceof n&&this.mediaAsset(arguments[0]),d.DataStore.playIntiated=!0,this.dataStore.state="active";var t=new e(e.PLAY,{asset:this.dataStore.mediaAsset},this);this.__mBus.notify(t)},o.prototype.pause=function(){var t=new e(e.PAUSE,{asset:this.dataStore.mediaAsset},this);this.__mBus.notify(t)},o.prototype.stop=function(){this.dataStore.state="unload";var t=new e(e.STOP,{asset:this.dataStore.mediaAsset},this);this.__mBus.notify(t)},o.prototype.fullscreen=function(){return arguments.length&&(d.DataStore.fullscreen=arguments[0]),d.DataStore.fullscreen},o.prototype.volume=function(){return arguments.length&&(d.DataStore.volume=arguments[0]),d.DataStore.volume},o.prototype.mute=function(){return arguments.length?d.DataStore.isMuted=!!arguments[0]:d.DataStore.isMuted=!d.DataStore.isMuted,d.DataStore.isMuted},o.prototype.scrub=function(){return arguments.length&&(d.DataStore.seekTo=arguments[0]),d.DataStore.seekTo},o.prototype.caption=function(){return arguments.length?d.DataStore.caption=arguments[0]:d.DataStore.caption=!d.DataStore.caption,d.DataStore.caption},o.prototype.captionOptions=function(){this.__mBus.notify(new e(e.CAPTIONOPTIONS,{},this))},o.prototype.updateDisplayBase=function(){var t=new e(e.UPDATEDISPLAYBASE,{asset:this.dataStore.mediaAsset},this);this.__mBus.notify(t)},o.prototype.destroy=function(){var t=this.dataStore.container;this.__mBus.removeListener("*",this),this.__mBus.removeListener(d.events.PlaybackEvent.COMPLETE,this.__onMediaComplete,this),this.__mBus.notify(new a(a.SHUTDOWN,{})),t.parentElement===this.dataStore.location&&this.dataStore.location.removeChild(t),this.dataStore.destroy=!0,this.__mBus=null},o.prototype.__onMediaComplete=function(t){if(null!==this.dataStore.playlist){var e=this.dataStore.playlist.next();e instanceof n?this.play(e):this.notify(new d.events.PlaybackEvent(d.events.PlaybackEvent.PLAYLIST_COMPLETE,{}))}},o.prototype.callFn=function(t){u.info("observe accessor arguments",arguments);var e=this[t];if(!(e instanceof Function))throw new Error("Requested property does not exist:  "+t,this);var n=Array.prototype.slice.call(arguments,1);return e.apply(this,n)},o.prototype.__renderPlayer=function(){this.__mBus.notify({id:"ndp_renderPlayer",propertyName:"renderPlayer",arguments:["Player has been rendered."]})};var s="$ndp "+d.fileType+" Framework Build Completed";window.console.log(s,"\nVersion",d.version,"Build",d.__version,d.datetime),window.NDPPlayer=o}(window.$ndp);