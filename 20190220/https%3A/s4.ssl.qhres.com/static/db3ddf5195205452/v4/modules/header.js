/**
 * 顶部导航js
 * @author: qiantianbing
 * @update: 2018-04-18 10:27:57
 * */(function(){var e={$nav:$("#j-header-nav"),$moreBtn:$("#j-more-btn"),$moreOuter:$(".header-menu-more"),$province:$("#j-province-list"),$pbTabHds:$(".province-boutique-tabs .tab-menu-item"),$pbTabBds:$(".province-boutique-tabs .tab-cont-list"),api:{province:App.api.apiDomain+"/Module/localChannels"},init:function(){this.renderProvince(),this.bindSwitchLocalBoutique(),this.bindSwitchMore(),this.$nav.scrollToFixed({zIndex:9999})},bindSwitchMore:function(){var e=this;this.$moreBtn.on("click",function(t){t.preventDefault(),t.stopPropagation(),e.$moreOuter.toggleClass("header-menu-more-active")}),$(document).on("click",function(t){!e.$moreOuter.is(t.target)&&!e.$moreOuter.has(t.target).length&&e.$moreOuter.removeClass("header-menu-more-active")})},renderProvince:function(){window.$utils.artRender(e.$province,"#j-tpl-province",{list:App.data.areaMenuData,channel:App.config.channel[0]})},bindSwitchLocalBoutique:function(){var e=this;this.$pbTabHds.on("click",function(){var t=$(this).index();$(this).addClass("active").siblings().removeClass("active"),e.$pbTabBds.eq(t).show().siblings().hide()})}},t={$wordsWraper:$("#j-header-search-wraper"),$words:$("#j-word-list"),$input:$("#j-search-input"),$searchBtn:$("#j-i-search"),init:function(){this.bindEvent()},bindEvent:function(){var e=this;this.$input.on("focus input",function(){var t=$(this).val();$(this).val(t);if(!t){e.hide();return}e.fetchData(t)}),$(document).on("click",function(t){!e.$wordsWraper.is(t.target)&&!e.$wordsWraper.has(t.target).length&&e.hide()}).keydown(function(t){var n=e.$input.val();if(!e.$input.is(":focus"))return;t.keyCode==13&&e.goToSearch(n)}),this.$words.on("click",".word-item",function(t){t.stopPropagation();var n=$(this).data("word");e.goToSearch(n)}),this.$searchBtn.on("click",function(t){t.stopPropagation();var n=e.$input.val();e.goToSearch(n)})},render:function(e,t){this.$words.html(template.compile($("#j-tpl-header-words").html())({oldList:e,newList:t})),this.show()},fetchData:function(e){var t=this;$.ajax({url:"//sug.so.360.cn/suggest",dataType:"jsonp",data:{word:e,encodein:"utf-8",encodeout:"utf-8"}}).then(function(n){if(!n.s||n.s.length==0)return;var r=new RegExp("("+e+")","ig"),i=n.s,s=[];s=n.s.map(function(e){return e.replace(r,"<em>$1</em>")}),t.render(i,s)})},goToSearch:function(e){var t=window.$utils.getQueryJson();t=$.extend(t,{q:_.trim(e)});var n=$.param(t).replace(/\+/g,"%20");App.config.channel[0]=="search"?location.href="//www.btime.com/search?"+n:window.open("//www.btime.com/search?"+n)},hide:function(){this.$words.hide()},show:function(){this.$words.show()}},n={$before:$("#j-login-before"),$after:$("#j-login-after"),$loginBtn:$("#j-header-login"),$regBtn:$("#j-header-reg"),$logoutBtn:$("#j-header-logout"),$userName:$("#j-user-name"),$message:$("#j-message"),$signBtn:$("#j-header-signin"),init:function(){this.renderLogin(),this.bindEvent()},renderLogin:function(){Userbridge.isLogin()?(this.$before.hide(),this.renderUserinfo()):(this.$before.show(),this.$after.hide())},renderUserinfo:function(){var e=this;Userbridge.getUserInfo(function(t){e.$userName.text(t.nick_name),e.$signBtn.text(t.is_sign==0?"签到":"已签到")}),Userbridge.getMessageStatus(function(t){if(!t)return;t.unread>0&&(e.$after.find(".i-mark").show(),e.$message.text(t.unread))}),this.$after.show()},bindEvent:function(){this.$loginBtn.on("click",function(){Userbridge.invokeLogin(function(e){location.reload()})}),this.$regBtn.on("click",function(){Userbridge.invokeReg(function(e){location.reload()})}),this.$logoutBtn.on("click",function(e){e.preventDefault(),e.stopPropagation(),Userbridge.invokeLogout(function(e){location.reload()})}),this.$userName.on("click",function(){window.open(App.api.apiUser)}),this.$message.parents(".user-infos-item").on("click",function(e){e.preventDefault(),e.stopPropagation(),window.open(App.api.apiUser+"/message"),self.$after.find(".i-mark").hide()}),this.$signBtn.on("click",function(e){e.preventDefault(),e.stopPropagation(),window.open(App.api.apiUser+"/integralcalendar")})}},r={init:function(){var e=$.cookie("B_SHOP_TIPS");e?this.hideTips():this.showTips(),this.bindEvent()},showTips:function(){$(".lottery-guide-sm").show()},hideTips:function(){$(".lottery-guide-sm").hide()},bindEvent:function(){var e=this;$(".lottery-guide-sm .close-btn").on("click",function(t){t.preventDefault(),t.stopPropagation(),feb.monitor.view({bk:"click_顶部气泡关闭"}),e.setCookieTips(1),e.hideTips()})},setCookieTips:function(e){var t=new Date,n=t.getFullYear(),r=t.getMonth(),i=t.getDate();$.cookie("B_SHOP_TIPS",e,{expires:new Date(n,r,i+1),domain:".btime.com"})}};$(function(){e.init(),n.init(),t.init(),r.init()})})();