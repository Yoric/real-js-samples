!function(e){function t(i){if(r[i])return r[i].exports;var n=r[i]={exports:{},id:i,loaded:!1};return e[i].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){var i,n;i=[r(1),r(7),r(5),r(19),r(20)],n=function(e,t,r,i,n){"use strict";var a,s=r.getHTTPParam("debug");r.debugLevel=s&&(a=parseInt(s))?a:0,window.nanowebrtc={user:e,tools:r,const:t,audioprocess:i,version:n.webrtc.release_version,release_description:n.webrtc.release_description}}.apply(t,i),!(void 0!==n&&(e.exports=n))},function(e,t,r){var i,n;i=[r(2),r(9),r(10),r(11),r(7),r(5),r(6),r(18)],n=function(e,t,r,i,n,a,s,o){"use strict";function c(){s.call(this),this._server=void 0,this._userName=void 0,this._userId=Math.round(1e9*Math.random()).toString(),this._room=void 0,this._serverUserName=void 0,this._serverPassword=void 0,this._token=void 0,this._bintuApiKey=void 0,this._iceServers=[{urls:["stun:stun.l.google.com:19302"]},{urls:["stun:stun.nanocosmos.net:80"],username:"nano",credential:"nano"}],this._optionalConfig={codecs:{videoCodec:"VP8"},bitrates:{videoSendInitialBitrate:0,videoSendBitrate:0},sdpPatches:{preventReplaceSendReceive:!1}},this._streamProtected=!1,this._statsEnabled=!1,this._statsIntervalTime=1e3,this._isSignedIn=!1,this._isBroadcasting=!1,this._mediaController=new e,this._userList=new t(this._userId),this._channels=new r,this._audioMixer=new o,c.checkSupport()}var d=a.getElement,u=a.print_,h=a.debug_,l=a.warning_,m=a.error_,p=a.parseJSON,f=a.isObject,v=a.isString,_=a.isBool,g=c.prototype=Object.create(s.prototype);return c.browserSupport={supportLevel:-1,supportText:""},c.checkSupport=function(){var e=a.browserInfo.browser,t=parseInt(a.browserInfo.browserVersion.split(".")[0],10),r=a.browserInfo.mobile,i="Your browser: "+e+" V "+t,n="Please use newest Chrome or Firefox or visit https://webrtc.live for support.",s="",o=-1;switch(h(i),e){case"Chrome":o=0,t<55&&(o=2,t<50&&(o=3));break;case"Firefox":o=0,t<50&&(o=2,t<42&&(o=3));break;case"Opera":o=0,t<42&&(o=2,t<40&&(o=3));break;case"Microsoft Edge":o=3;break;case"Safari":o=0,(t<11||r)&&(o=3);break;default:o=1}return o>0&&(s=i+" is not supported. ",o>1&&(s+="You may try to use it, but it may show issues. "+n,m(s))),c.browserSupport.supportLevel=o,c.browserSupport.supportText=s,c.browserSupport},g._listenToMediaController=function(e){e.on("StreamActive",this._onStreamActive.bind(this)),e.on("StreamInactive",this._onStreamInactive.bind(this)),e.on("StreamTrackEnded",this._onStreamTrackEnded.bind(this)),e.on("StreamAddTrack",this._onStreamAddTrack.bind(this)),e.on("StreamRemoveTrack",this._onStreamRemoveTrack.bind(this))},g._listenToChannelMember=function(e){e.getRole()!==n.ROLE_BROADCASTER&&(e.on("PeerListUpdated",this._onPeerlistUpdated.bind(this)),e.on("PeerEntryUpdated",this._onPeerEntryUpdated.bind(this))),e.on("SignInSuccess",this._onSignInSuccess.bind(this)),e.on("SignInError",this._onSignInError.bind(this)),e.on("SignOutSuccess",this._onSignOutSuccess.bind(this)),e.on("SignOutError",this._onSignOutError.bind(this)),e.on("Handshake",this._onHandshake.bind(this)),e.on("CallIncoming",this._onCallIncoming.bind(this)),e.on("CallRejected",this._onCallRejected.bind(this)),e.on("RemotePeerDisconnected",this._onRemotePeerDisconnected.bind(this)),e.on("RemoteStreamAdded",this._onRemoteStreamAdded.bind(this)),e.on("GetBusy",this._onGetBusy.bind(this)),e.on("SignalingStateChanged",this._onSignalingStateChanged.bind(this)),e.on("HangingGetError",this._onHangingGetError.bind(this)),e.on("HangingGetServerStatus",this._onHangingGetServerStatus.bind(this)),e.on("CallActive",this._onCallActive.bind(this)),e.on("ReceivedWebRTCStats",this._onReceivedWebRTCStats.bind(this)),e.on("CallAgainStable",this._onCallAgainStable.bind(this)),e.on("CallUnstable",this._onCallUnstable.bind(this)),e.on("CallDropped",this._onCallDropped.bind(this)),e.on("CallHandshakeWon",this._onCallHandshakeWon.bind(this)),e.on("CallState",this._onCallState.bind(this))},g._onSignInSuccess=function(e){if(this._channels.add(e.target),e.target.getRole()===n.ROLE_CHATTER&&1===this._channels.getChatters().length&&(e.name="EnterRoomSuccess",this._isSignedIn=!0),e.target.getRole()!==n.ROLE_BROADCASTER&&!this._channels.getFreeChatter()){var t=this;setTimeout(function(){t._signInChannelMember(n.ROLE_CHATTER)},0)}this._streamInUse(),this.emit(e.name,e)},g._onSignInError=function(e){e.target.getRole()===n.ROLE_CHATTER&&0===this._channels.getChatters().length?e.name="EnterRoomError":e.target.getRole()===n.ROLE_BROADCASTER&&(e.name="StartBroadcastError"),this._streamInUse(),this.emit(e.name,e)},g._onSignOutSuccess=function(e){if(this._channels.remove(e.target),e.target.getRole()===n.ROLE_CHATTER&&0===this._channels.getChatters().length?(e.name="LeaveRoomSuccess",this._isSignedIn=!1):e.target.getRole()===n.ROLE_BROADCASTER&&(e.name="StopBroadcastSuccess",this._isBroadcasting=!1),e.target.getRole()!==n.ROLE_BROADCASTER&&0!==this._channels.getChatters().length&&!this._channels.getFreeChatter()){var t=this;setTimeout(function(){t._signInChannelMember(n.ROLE_CHATTER)},0)}this._streamInUse(),this.emit(e.name,e)},g._onSignOutError=function(e){l("RTC: SignOutError"),this._channels.remove(e.target),e.target.getState()===n.CHANNEL_IDLE&&0===this._channels.getChatters().length?e.name="LeaveRoomError":e.target.getRole()===n.ROLE_BROADCASTER&&(e.name="StopBroadcastError"),this._streamInUse(),this.emit(e.name,e)},g._emitPeerListUpdated=function(){this.emitSimple("PeerListUpdated",{userlist:this._userList.createPublicUserList()})},g._onPeerlistUpdated=function(e){var t,r,i,a,s=e.data.userlist,o={};for(i=0,a=s.length;i<a;i++)r=s[i].name.split("_"),t=r[0],this._userId!==t&&(o[t]||(o[t]=[r[1]]),o[t].push(s[i].id));var c,d;for(t in o)for(d=o[t],d.unshift(n.CHANNEL_SIGNED_IN),i=2,a=d.length;i<a;i++)if(c=this._channels.findByRemoteId(d[i])){d[0]=c.getState();break}this._userList._list=o,e.data.userlist=this._userList.createPublicUserList(),this.emit(e.name,e)},g._onHandshake=function(e){this._userList.updateEntryState(e.target)&&this._emitPeerListUpdated()},g._onPeerEntryUpdated=function(e){this._userList.updateEntry(e),this._emitPeerListUpdated()},g._onRemotePeerDisconnected=function(e){l("RTC: onRemotePeerDisconnected: "+e.target.getPeerId()+" remote: "+e.target.getRemotePeerId());var t;(t=e.target.getRole()===n.ROLE_BROADCASTER)?(this._isBroadcasting?(e.name="BroadcastError",e.data.text="The broadcast server is disconnected!"):(e.name="StartBroadcastError",e.data.text="The broadcast server is disconnected!"),this._isBroadcasting=!1):e.target.getState()===n.CHANNEL_CALLING?e.name="CallDeclined":e.target.getState()>n.CHANNEL_SIGNED_IN&&e.target.getState()!==n.CHANNEL_CALL_ACTIVE&&(e.name="CallRejected"),t?this._channels.signOutBroadcaster():this._signOutChannelMember(e.data.remoteUserId),this.emit(e.name,e)},g._onGetBusy=function(e){if(l("RTC: "+e.target.getPeerId()+" busy"),e.target.getRole()===n.ROLE_BROADCASTER)return void l("RTC:  - ignoring (broadcaster)");this._userList.updateEntryState(e.target)&&this._emitPeerListUpdated();var t=this;setTimeout(function(){t._signInChannelMember(n.ROLE_CHATTER)},0)},g._onCallIncoming=function(e){var t=this;if(e.target.getRole()===n.ROLE_BROADCASTER){var r=e.target;r&&(this._attachStreamToChannelMember(r,this._mediaController.getLocalMediaStream()),r.answerCall().catch(function(e){t._emitError("Could not answer to broadcast client")}))}else this._userList.updateEntryState(e.target)&&this._emitPeerListUpdated(),this.emit(e.name,e)},g._onCallRejected=function(e){if(h("RTC: onCallRejected: "+t),e.target.getRole()===n.ROLE_BROADCASTER)return void h("RTC: ignoring reject - we are a broadcaster");var t=e.data.remoteUserName;e.data.remoteUserId;this._userList.updateEntryState(e.target)&&this._emitPeerListUpdated(),this.emit(e.name,e)},g._onRemoteStreamAdded=function(e){if(e.target.getRole()!==n.ROLE_BROADCASTER){e.data.stream&&"default"===e.data.stream.id;var t=this;this._mediaController.addRemoteMedia(e.target.getRemoteUserName(),this._mediaController.getRemoteMedias().length),this._mediaController.getRemoteMediaById(e.target.getRemoteUserName()).addMediaStream(e.data.stream,function(r){for(var i in r.data)e.data.hasOwnProperty(i)||(e.data[i]=r.data[i]);t.emit(e.name,e)},function(r){for(var i in r.data)e.data.hasOwnProperty(i)||(e.data[i]=r.data[i]);e.name="RemoteStreamError",t.emit(e.name,e)})}},g._onSignalingStateChanged=function(e){this.emit(e.name,e)},g._onHangingGetError=function(e){h("RTC: onHangingGetError: Server or Network down, close all calls, broadcasts and leave room!"),this._mediaController.removeRemoteMedia(),this._channels.signOutChatters(1),this._channels.signOutBroadcaster(1),this._streamInUse(),e.name="ServerError",this.emit(e.name,e),e.name="LeaveRoomSuccess",this.emit(e.name,e),e.name="StopBroadcastSuccess",this.emit(e.name,e)},g._onHangingGetServerStatus=function(e){e.name="ServerStatus",this.emit(e.name,e)},g._onCallActive=function(e){e.target.getRole()===n.ROLE_BROADCASTER?this._isBroadcasting||(e.name="StartBroadcastSuccess",this._isBroadcasting=!0,this.emit(e.name,e)):(this._userList.updateEntryState(e.target)&&this._emitPeerListUpdated(),this.emit(e.name,e))},g._onReceivedRtmpStatus=function(e){if(h("RTC: ReceivedRtmpStatus from channelmember "+e.target.getPeerId()+" with role "+e.target.getRole()),e.target.getRole()!==n.ROLE_BROADCASTER)return void h("RTC: ignoring (broadcaster)");switch(e.data.status){case"status":switch(e.data.text){case"connected":e.name="BroadcastStatus",this.emit(e.name,e);break;case"reconnecting":e.name="BroadcastStatus",this.emit(e.name,e)}break;case"error":switch(e.data.number){case 4711:this._isBroadcasting?e.name="StartBroadcastError":e.name="BroadcastError",this._isBroadcasting=!1,this._channels.signOutBroadcaster(),this.emit(e.name,e)}e.name="BroadcastStatus",this.emit(e.name,e)}},g._onReceivedWebRTCStats=function(e){this.emit(e.name,e)},g._onCallUnstable=function(e){e.target.getRole()!==n.ROLE_BROADCASTER&&(this._userList.updateEntryState(e.target)&&this._emitPeerListUpdated(),this.emit(e.name,e))},g._onCallDropped=function(e){e.target.getRole()===n.ROLE_BROADCASTER?(this._isBroadcasting?(e.name="BroadcastError",e.data.text="The broadcast connection has dropped! Stopping!"):(e.name="StartBroadcastError",e.data.text="The broadcast connection has dropped!"),this._channels.signOutBroadcaster()):this._userList.updateEntryState(e.target)&&this._emitPeerListUpdated(),this.emit(e.name,e)},g._onCallAgainStable=function(e){e.target.getRole()!==n.ROLE_BROADCASTER&&(this._userList.updateEntryState(e.target)&&this._emitPeerListUpdated(),this.emit(e.name,e))},g._onCallHandshakeWon=function(e){var t=e.data.remoteUserName,r=e.data.remoteUserId,i=e.data.remotePeerId;h("RTC: We ("+e.target.getPeerId()+') won the handshake, now calling "'+t+" "+r+" with peer "+i),this._doCall(e.target)},g._onCallState=function(e){e.target.getRole()!==n.ROLE_BROADCASTER&&this._userList.updateEntryState(e.target)&&this._emitPeerListUpdated()},g._onStreamActive=function(e){h("RTC: MediaStream Event: "+e.type)},g._onStreamInactive=function(e){h("RTC: MediaStream Event: "+e.type)},g._onStreamTrackEnded=function(e){h("RTC: MediaStream Event: "+e.target.kind+" track "+e.type+' from device "'+e.target.label+'"'),e.name="MediaStreamError",e.data.error=e.target.kind+" track "+e.type+' from device "'+e.target.label+'", maybe in use or device stopped working',this.emit(e.name,e)},g._onStreamAddTrack=function(e){h("RTC: MediaStream Event: "+e.type)},g._onStreamRemoveTrack=function(e){h("RTC: MediaStream Event: "+e.type)},g._emitError=function(e,t){this.emitSimple("Error",{error:e,originalError:t|e})},g._attachStreamToChannelMember=function(e,t){e.addStream(t)},g._signInChannelMember=function(e){var t=new i(this._server,this._userName,this._userId,this._room,e,this._token,this._serverUserName,this._serverPassword,this._bintuApiKey);t.setConfig(this._optionalConfig),t.setIceServers(this._iceServers),t.enableStats(this._statsEnabled),this._listenToChannelMember(t),t.signIn()},g._signOutChannelMember=function(e){var t=this._channels.findByRemoteUserId(e);t&&(h("RTC: signOutChannelmember "+t.getPeerId()),this._mediaController.removeRemoteMedia(t.getRemoteUserName()),t.signOut(),this._userList.updateEntryState(t)&&this._emitPeerListUpdated())},g._streamInUse=function(){var e=this._channels.getChatters().length>1||!!this._channels.getBroadcaster();this._streamProtected=e,this.emitSimple("StreamInUse",{streaminuse:this._streamProtected,onlybroadcast:!!this._channels.getBroadcaster()&&this._channels.getChatters().length<2,onlychat:!this._channels.getBroadcaster()&&this._channels.getChatters().length>1})},g._getDevicesSuccess=function(e){this.emitSimple("ReceivedDeviceList",e.data)},g._getDevicesError=function(e){var t=e.data.error.message||e.data.error.toString();m(t)},g.addLocalMedia=function(e,t,r,i){this._mediaController.addLocalMedia(e,t,r,i)},g.isScreenCaptureAvailable=function(){return this._mediaController.screenCaptureAvailable()},g.setConfig=function(e,t,r,i,n,a,s){this._server=e,this._userName=t,this._room=r,this._token=i,this._serverUserName=n,this._serverPassword=a,this._bintuApiKey=s},g.setOptionalConfig=function(e){return e?(e.codecs&&"string"==typeof e.codecs.videoCodec?this._optionalConfig.codecs.videoCodec=e.codecs.videoCodec:"undefined"!=typeof e.codecs.videoCodec&&this._emitError("setOptionalConfig: config.bitrates.videoCodec must be of type string"),e.bitrates&&("number"==typeof e.bitrates.videoSendInitialBitrate?this._optionalConfig.bitrates.videoSendInitialBitrate=e.bitrates.videoSendInitialBitrate:"undefined"!=typeof e.bitrates.videoSendInitialBitrate&&this._emitError("setOptionalConfig: config.bitrates.videoSendInitialBitrate must be of type number"),"number"==typeof e.bitrates.videoSendBitrate?this._optionalConfig.bitrates.videoSendBitrate=e.bitrates.videoSendBitrate:"undefined"!=typeof e.bitrates.videoSendBitrate&&this._emitError("setOptionalConfig: config.bitrates.videoSendBitrate must be of type number")),void(e.sdpPatches&&(_(e.sdpPatches.preventReplaceSendReceive)?this._optionalConfig.sdpPatches.preventReplaceSendReceive=e.sdpPatches.preventReplaceSendReceive:this._emitError("setOptionalConfig: config.sdpPatches.preventReplaceSendReceive must be of type bool")))):void l("setOptionalConfig: config is undefined")},g.setIceServers=function(e){this._iceServers=e},g.checkServer=function(e){function t(){200===this.status&&i.emitSimple("ReceivedServerStats",{stats:p(this.responseText)||{error:{message:"Could not parse response from server",code:-1,userinfo:null}}})}function r(){console.log("error checking server.")}var i=this,n=new XMLHttpRequest;n.withCredentials=!0,n.onload=t,n.onerror=r;var a=e||this._server;a&&(n.open("GET",a+"/status.json"),n.send())},g.startBroadcast=function(e){u("RTC: startBroadcast"),u(e);var t=new i(this._server,this._userName,this._userId,this._room,n.ROLE_BROADCASTER,this._token,this._serverUserName,this._serverPassword,this._bintuApiKey);t.setConfig(this._optionalConfig),t.setIceServers(this._iceServers),t.enableStats(this._statsEnabled,this._statsIntervalTime),this._listenToChannelMember(t);var r=this._mediaController.getLocalMediaStream(),a=this._mediaController.getLocalMediaMetaData(r.id);e.transcodingTargets.videowidth=a[0].width,e.transcodingTargets.videoheight=a[0].height,t.setTranscodingSettings(e.transcodingTargets),this._attachStreamToChannelMember(t,r),t.on("ReceivedRtmpStatus",this._onReceivedRtmpStatus.bind(this)),t.signIn()},g.stopBroadcast=function(e){l("RTC: stopBroadcast"),this._isBroadcasting&&this._channels.signOutBroadcaster(e)},g.sendMetaData=function(e,t){if(h("RTC: sendMetadata"),!v(e))return void m("RTC: Param handlerName must be of string type, not sending metadata.");if(!f(t))return void m("RTC: Param metaData must be of object type, not sending metadata.");if(this._isBroadcasting){var r=this._channels.getBroadcaster();r.sendMetaData(e,t)}else l("RTC: no broadcast active, not sending metadata.")},g.enterRoom=function(){this._signInChannelMember(n.ROLE_CHATTER)},g.leaveRoom=function(e){if(this._mediaController.removeRemoteMedia(),0===this._channels.getChatters().length){var t={};return t.name="LeaveRoomSuccess",void this.emit(t.name,t)}this._channels.signOutChatters(e),this._isSignedIn=!1},g.enableStats=function(e,t){this._statsEnabled="undefined"==typeof e||e,this._statsIntervalTime=t||1e3},g.invokeCall=function(e){var t,r=this._userList.getUserStateByRemoteUserId(e);if(r>n.CHANNEL_SIGNED_IN)t=this._userList.getUserNameByRemoteUserId(e),this.emitSimple("CallStillActive",{remoteUserName:t,remoteUserId:e});else{var i=this._channels.getFreeChatter(),a=this._userList.getFreePeerIdByRemoteUserId(e);i&&i.invokeCall(a)}},g._doCall=function(e){var t,r=e.getRemoteUserId(),i=this._userList.getUserStateByRemoteUserId(r);i>n.CHANNEL_HANDSHAKE?(t=this._userList.getUserNameByRemoteUserId(r),this.emitSimple("CallStillActive",{remoteUserName:t,remoteUserId:r})):(this._attachStreamToChannelMember(e,this._mediaController.getLocalMediaStream()),e.doCall())},g.hangUpCall=function(e){this._signOutChannelMember(e)},g.answerCall=function(e){var t=this,r=this._channels.findByRemoteUserId(e);r?(this._attachStreamToChannelMember(r,this._mediaController.getLocalMediaStream()),r.answerCall().catch(function(e){t._emitError("answerCall error:"+e)})):this._emitError("answerCall: User with id: "+e+" not found")},g.declineCall=function(e){this._signOutChannelMember(e)},g.isSignedIn=function(){return this._isSignedIn},g.getDevices=function(e){this._mediaController.getDevices(e,this._getDevicesSuccess.bind(this),this._getDevicesError.bind(this))},g.setVideoDevice=function(e,t){this._streamProtected||this._mediaController.setVideoDevice(e,t)},g.setAudioDevice=function(e,t){this._streamProtected||this._mediaController.setAudioDevice(e,t)},g._getStream=function(e,t){this._mediaController.getUserMedia(e,function(e){t(e,void 0)},function(e){t(void 0,e)})},g._stopStream=function(e,t){this._mediaController.deleteUserMedia(e,function(e){t(e,void 0)},function(e){t(void 0,e)})},g.startPreview=function(e,t,r,i){if(!this._streamProtected){this.setVideoDevice(e,t),this.setAudioDevice(e,r);var n=this;this._getStream(e,function(e,t){if(e&&e.data&&e.data.stream){n._listenToMediaController(n._mediaController);var r=e.data.stream;i&&(d(i).srcObject=r),e.name="StartPreviewSuccess",n.emit(e.name,e)}else{var e=t;if(e.data=e.data||{},e.name="StartPreviewError",t.data.error&&t.data.error.name){var a,s=t.data.error;s.message&&(a=s.message),"NotFoundError"===s.name&&(a="No device found, please attach a media device."),e.data.error=s.name,e.data.error+=s.code?" (code "+s.code+")":"",e.data.error+=a?": "+a:"",e.data.error+=s.constraintName?' in constraint "'+s.constraintName+'"':""}n.emit(e.name,e)}})}},g.stopPreview=function(e){if(!this._streamProtected){var t=this;this._stopStream(e,function(e,r){var i=e;null===i.data.stream?i.name="StopPreviewSuccess":(i=r||{},i.data=i.data||{},i.name="StopPreviewError",i.data.error=i.data.error?i.data.error:"unknown error"),t.emit(i.name,i)})}},g.muteVideo=function(e,t){this._mediaController.muteVideoTracks(e,t)},g.muteAudio=function(e,t){this._mediaController.muteAudioTracks(e,t)},g._mixExternalAudio=function(e){if(!e)return Promise.reject(new Error("No external stream passed"));var t,r,i=this;return Promise.resolve(this._mediaController.getLocalMediaStream()).then(function(e){if(e&&e[0])return e[0];throw new Error("No local stream")}).then(function(e){if(t=e,r=t.getAudioTracks(),r.length>0)return i._audioMixer.connect(t,0);throw new Error("Local stream has no audio")}).then(function(){return i._audioMixer.connect(e,1)}).then(function(){return i._audioMixer.getOutputStream()}).then(function(e){var i=r[0],n=e.getAudioTracks(),a=n[0];t.removeTrack(i),t.addTrack(a)}).catch(function(e){throw m("Could not mix audioTracks - error: "+e),e})},g.injectExternalMediaStream=function(e){return e&&e.stream?a.isArray(e.tracks)&&e.tracks.length?this._streamProtected?Promise.reject(new Error("Cant inject, stream is already beeing used")):e.tracks.indexOf("audio")!==-1?this._mixExternalAudio(e.stream):Promise.reject(new Error('Mixing in tracks other than "audio" is not supported at the moment')):Promise.reject(new Error("Parameter config.tracks must contain an array with track types to be replaced")):Promise.reject(new Error("You need to provide a stream config object"))},c}.apply(t,i),!(void 0!==n&&(e.exports=n))},function(e,t,r){var i,n;i=[r(3),r(8),r(7),r(6),r(5)],n=function(e,t,r,i,n){"use strict";function a(){i.call(this),this._localMedia=[],this._remoteMedia=[]}var s=n.isInt,o=n.isString,c=a.prototype=Object.create(i.prototype);return c._findBy=function(e,t,r){var i,n;r=r||"local";var a=this["_"+r+"Media"];for(i=0,n=a.length;i<n;i++)if(a[i][e]===t)return a[i];return null},c._find=function(e,t,r){var i,n;r=r||"local";var a=this["_"+r+"Media"];for(i=0,n=a.length;i<n;i++)if(a[i]===t)return a[i][e];return null},c._reemit=function(e){this.emit(e.name,e)},c._return=function(e,t,r,i){var n;if(s(t))return n=this["get"+i+"MediaByIndex"].call(this,t),[n[e].apply(n,r)];if(o(t))return n=this["get"+i+"MediaById"].call(this,t),[n[e].apply(n,r)];var a,c,d=[];r.pop(),r.unshift(t);var u=this["_"+i.toLowerCase()+"Media"];for(a=0,c=u.length;a<c;a++)d.push(u[a][e].apply(u[a],r));return d},c._addMedia=function(r,i,n,a,c){var d,u;o(r)||__error("MediaController: param mediaId must be of type string",2),s(i)||__error("MediaController: param mediaIndex must be an integer",2);var h="Local"===c?new e(r,i,n,a):new t(r,i);h.on("StreamActive",this._reemit.bind(this)),h.on("StreamInactive",this._reemit.bind(this)),h.on("StreamTrackEnded",this._reemit.bind(this)),h.on("StreamAddTrack",this._reemit.bind(this)),h.on("StreamRemoveTrack",this._reemit.bind(this));var l=this["_"+c.toLowerCase()+"Media"];for(d=0,u=l.length;d<u;d++)l[d].getMediaId()===r&&l.splice(d,1);l.push(h)},c._removeMedia=function(e,t){var r,i,n;if(s(e))n=this["get"+t+"MediaByIndex"].call(this,e);else{if(!o(e))return void(this["_"+t.toLowerCase()+"Media"]=[]);n=this["get"+t+"MediaById"].call(this,e)}var a=this["_"+t.toLowerCase()+"Media"];for(r=0,i=a.length;r<i;r++)a[r]===n&&a.splice(r,1)},c.addLocalMedia=function(e,t,r,i){this._addMedia(e,t,r,i,"Local")},c.removeLocalMedia=function(e){this._removeMedia(e,"Local")},c.getLocalMediaIndexes=function(){var e,t,r=[];for(e=0,t=this._localMedia.length;e<t;e++)r.push(this.getLocalMediaIndex(this._localMedia.getMediaIndex()));return r},c.getLocalMediaIds=function(){var e,t,r=[];for(e=0,t=this._localMedia.length;e<t;e++)r.push(this.getLocalMediaIndex(this._localMedia.getMediaId()));return r},c.getLocalMedias=function(){return this._localMedia},c.getLocalMediaByIndex=function(e){return this._findBy("_mediaIndex",e,"local")},c.getLocalMediaById=function(e){return this._findBy("_mediaId",e,"local")},c.getLocalMediaIndex=function(e){return this._find("_mediaIndex",e,"local")},c.getLocalMediaId=function(e){return this._find("_mediaId",e,"local")},c.getLocalMediaIdByIndex=function(e){return this.getLocalMediaByIndex(e)?this.getLocalMediaByIndex(e).getMediaId():null},c.getLocalMediaIndexById=function(e){return this.getLocalMediaById(e)?this.getLocalMediaById(e).getMediaIndex():null},c.getLocalMediaMetaData=function(e){return this._return("getMetaData",e,[],"Local")},c.getLocalMediaStream=function(e){return this._return("getLocalMediaStream",e,[],"Local")},c.getUserMediaConstraints=function(e){return this._return("getUserMediaConstraints",e,[],"Local")},c.screenCaptureAvailable=function(e){return!(!n.isArray(this._localMedia)||!this._localMedia[0]._nanoScreenCapture)&&this._localMedia[0].screenCaptureAvailable()},c.getLocalMediaStreamState=function(e){return this._return("getLocalMediaStreamState",e,[],"Local")},c.getDevices=function(e,t,r){this._return("getDevices",e,[t,r],"Local")},c.getStoredVideoDevices=function(e,t){this._return("getStoredVideoDevices",e,[t],"Local")},c.getStoredAudioDevices=function(e,t){this._return("getStoredAudioDevices",e,[t],"Local")},c.getStoredDevices=function(e,t){this._return("getStoredDevices",e,[t],"Local")},c.setVideoDevice=function(e,t){return this._return("setVideoDevice",e,[t],"Local")},c.setAudioDevice=function(e,t){return this._return("setAudioDevice",e,[t],"Local")},c.getUserMedia=function(e,t,r){this._return("getUserMedia",e,[t,r],"Local")},c.deleteUserMedia=function(e,t,r){this._return("deleteUserMedia",e,[t,r],"Local")},c.muteVideoTracks=function(e,t){this._return("muteVideoTracks",e,[t],"Local")},c.muteAudioTracks=function(e,t){this._return("muteAudioTracks",e,[t],"Local")},c.addRemoteMedia=function(e,t){this._addMedia(e,t,void 0,void 0,"Remote")},c.removeRemoteMedia=function(e){this._removeMedia(e,"Remote")},c.getRemoteMediaIndexes=function(){var e,t,r=[];for(e=0,t=this._remoteMedia.length;e<t;e++)r.push(this.getRemoteMediaIndex(this._remoteMedia.getMediaIndex()));return r},c.getRemoteMediaIds=function(){var e,t,r=[];for(e=0,t=this._remoteMedia.length;e<t;e++)r.push(this.getRemoteMediaIndex(this._remoteMedia.getMediaId()));return r},c.getRemoteMedias=function(){return this._remoteMedia},c.getRemoteMediaByIndex=function(e){return this._findBy("_mediaIndex",e,"remote")},c.getRemoteMediaById=function(e){return this._findBy("_mediaId",e,"remote")},c.getRemoteMediaIndex=function(e){return this._find("_mediaIndex",e,"remote")},c.getRemoteMediaId=function(e){return this._find("_mediaId",e,"remote")},c.getRemoteMediaIdByIndex=function(e){return this.getRemoteMediaByIndex(e).getMediaId()},c.getRemoteMediaIndexById=function(e){return this.getRemoteMediaById(e).getMediaIndex()},c.getRemoteMediaStream=function(e){return this._return("getRemoteMediaStream",e,[],"Remote")},c.getRemoteMediaStreamState=function(e){return this._return("getRemoteMediaStreamState",e,[],"Remote")},c.addRemoteMediaStream=function(e,t,r){this._return("addRemoteMediaStream",e,[t,r],"Remote")},c.removeRemoteMediaStream=function(e,t,r){this._return("removeRemoteMediaStream",e,[t,r],"Remote")},a}.apply(t,i),!(void 0!==n&&(e.exports=n))},function(e,t,r){var i,n;i=[r(4),r(7),r(5),r(6)],n=function(e,t,r,i){"use strict";function n(r,n,a,s){i.call(this),u(r)||o("LocalMedia: param mediaId must be of type string",2),d(n)||o("LocalMedia: param mediaIndex must be an integer",2),this._mediaId=r,this._mediaIndex=n,this._mediaType="local",this._useScreenCapture=!!a,this._nanoScreenCapture=new e(u(a)?a:"nanoScreenCapture"),this._useScreenCaptureOnly=!!s,this._timeoutScreenCapture=2e3,this._getDevicesWithoutSC=!1,this._nanoScreenCapture._mediaId=this._mediaId,this._nanoScreenCapture._mediaIndex=this._mediaIndex,this._devices={video:[],audio:[],listed:{video:[],audio:[]},selected:{video:!0,audio:!0},muted:{video:!1,audio:!1},constraints:{video:!0,audio:!0},stream:null,enumerated:!1,state:t.STREAM_NOMEDIASTREAM,metaData:{hasAudio:!1,hasVideo:!1,width:0,height:0,framerate:0},gotMetaData:!1,tags:{video:void 0,audio:void 0}},this._videoDeviceConfig={},this.defineEvents(["StreamActive","StreamInactive","StreamAddTrack","StreamRemoveTrack","StreamTrackEnded"])}var a=r.debug_,s=r.warning_,o=r.error_,c=(r.success_,r.isBool),d=r.isUint,u=r.isString,h=r.isFunction,l=r.parseJSON,m=n.prototype=Object.create(i.prototype);return m.getMetaData=function(){return this._devices.metaData},m.getMediaId=function(){return this._mediaId},m.getMediaIndex=function(){return this._mediaIndex},m.getMediaType=function(){return this._mediaType},m.getLocalMediaStream=function(){return this._devices.stream},m.getUserMediaConstraints=function(){return this._devices.constraints},m.screenCaptureAvailable=function(){return this._nanoScreenCapture.isScreenCaptureAvailable()},m._addPayload=function(e){return e=e||{},e.data={},e.data.mediaId=this._mediaId,e.data.mediaIndex=this._mediaIndex,e.data.mediaType=this._mediaType,e},m.getMediaStreamState=function(){return this._devices.state=this._devices.stream?this._devices.stream.active?t.STREAM_ACTIVE:t.STREAM_INACTIVE:t.STREAM_NOMEDIASTREAM,this._devices.state},m.getDevices=function(e,t){if(null===this.screenCaptureAvailable()&&this._useScreenCapture){var r=this;setTimeout(function(){r._getDevicesWithoutSC=!0},r._timeoutScreenCapture)}this._getDevices(e,t)},m._getDevices=function(e,t){var r,i=this;if(null===this.screenCaptureAvailable()&&this._useScreenCapture&&!this._getDevicesWithoutSC)return void setTimeout(function(){i._getDevices(e,t)},250);if(this._getDevicesWithoutSC=!1,h(e)){if(t=h(t)?t:console.error,this._devices.enumerated=!1,this._devices.video=[],this._devices.audio=[],!this.screenCaptureAvailable()&&this._useScreenCaptureOnly)return r=this._addPayload(),r.data.error=new Error("screen capture not available, but should only be used"),void t(r);var n=navigator.mediaDevices;return n&&n.enumerateDevices?void n.enumerateDevices().then(function(t){i._onDevicesEnumerated(t,e)}).catch(function(e){var r=i._addPayload();r.data.error=new Error("enumerating devices failed: "+e),t(r)}):(r=this._addPayload(),r.data.error=new Error("cant enumerate devices"),void t(r))}},m._onDevicesEnumerated=function(e,t){var r,i,n,a,s=0,o=0;if(!this._useScreenCaptureOnly)for(r=0,i=e.length;r<i;r++)a=e[r],n="videoinput"===a.kind?"video":"audioinput"===a.kind?"audio":"unknown","unknown"!==n&&(this._devices[n].push({label:this._createDeviceLabel(a,n),kind:a.kind,deviceId:a.deviceId,groupId:a.groupId}),this._devices.listed[n].push({id:this._createDeviceLabel(a,n),index:"videoinput"===a.kind?s:o}),"videoinput"===a.kind?s++:o++);this.screenCaptureAvailable()&&(this._useScreenCapture||this._useScreenCaptureOnly)&&(this._devices.video.push({label:this._nanoScreenCapture.getScreenCaptureName()+" (Chrome)",kind:"videoinput",deviceId:"screen",groupId:"",index:s}),this._devices.listed.video.push({id:this._nanoScreenCapture.getScreenCaptureName()+" (Chrome)",index:s})),this._devices.enumerated=!0;var c=this._addPayload();c.data.devices={audiodevices:this._devices.listed.audio,videodevices:this._devices.listed.video},t(c)},m._createDeviceLabel=function(e,t){return e.label.length?e.label:t+"device ID: "+e.deviceId.substr(0,10)},m.getStoredVideoDevices=function(e){this._getStoredDevices("video",e)},m.getStoredAudioDevices=function(e){this._getStoredDevices("audio",e)},m.getStoredDevices=function(e){this._getStoredDevices("both",e)},m._getStoredDevices=function(e,t){if(h(t)){var r=this._addPayload();r.data.devices="video"===e?this._devices.listed.video:"audio"===e?this._devices.listed.audio:"both"===e?{videodevices:this._devices.listed.video,audiodevices:this._devices.listed.audio}:void 0,this._devices.enumerated?t(r):setTimeout(this._getStoredDevices.bind(this,e,t),250)}},m.setVideoDevice=function(e){return this._setDevice(e,"video")},m.setAudioDevice=function(e){return this._setDevice(e,"audio")},m._setDevice=function(e,t){var r;if("video"===t||"audio"===t){var i=e.device;c(i)||(i=this._devices[t][i]);var n=this._devices.selected;if(i)if(i.deviceId){for(i=l(i),n[t]=!1,r=0;r<this._devices[t].length;r++)if(i.deviceId===this._devices[t][r].deviceId){n[t]=i;break}}else n[t]=!0;else n[t]=!1;return"video"===t&&this._setVideoDeviceConfig(e),n[t]}},m._setVideoDeviceConfig=function(e){e=e||{};var t=e.width||0,r=e.height||0,i=e.framerate||0,n=e.minFramerate||0;i<n&&(s("Framerate is smaller than minFramerate, setting framerate and minFramerate to minFramerate("+n+")"),i=n),this._videoDeviceConfig={},t>0&&r>0&&(this._videoDeviceConfig.width={min:t,max:t,ideal:t},this._videoDeviceConfig.height={min:r,max:r,ideal:r}),i>0&&(this._videoDeviceConfig.frameRate={min:n,max:i,ideal:i}),a("videoDeviceConfig: "+JSON.stringify(this._videoDeviceConfig))},m.getUserMedia=function(e,t){var r;if(h(e)){t=h(t)?t:console.error;try{this.deleteUserMedia();var i=this._devices.selected;if(!i.video&&!i.audio)return r=this._addPayload(),r.data.error="no media set for getUserMedia",void t(r);if(!c(i.video)&&"screen"===i.video.deviceId&&this.screenCaptureAvailable()){var n=this;this._nanoScreenCapture.once("PermissionDenied",t),
this._nanoScreenCapture.getSourceId(function(){n._setConstraints(["screen"]),n._gum(n._promiseUserMediaAudio,e,t)})}else this._promiseUserMedia(e,t)}catch(e){r=this._addPayload(),r.data.error=e,t(r)}}},m.deleteUserMedia=function(e,r){var i,n;try{if(null!==this._devices.stream){this._devices.stream.onactive=void 0,this._devices.stream.oninactive=void 0,this._devices.stream.onaddtrack=void 0,this._devices.stream.onremovetrack=void 0;var a=[].concat(this._devices.stream.getVideoTracks()).concat(this._devices.stream.getAudioTracks());for(i=0;i<a.length;i++)a[i].onended=void 0}this._stopTracks(this._devices.stream.getVideoTracks()),this._stopTracks(this._devices.stream.getAudioTracks()),this._devices.stream=null,this._devices.state=t.STREAM_NOMEDIASTREAM,this._devices.metaData={hasAudio:!1,hasVideo:!1,width:0,height:0,framerate:0},this._devices.gotMetaData=!1,n=this._addPayload(),n.data.stream=this._devices.stream,h(e)&&e(n)}catch(e){n=this._addPayload(),n.data.error=e,h(r)&&r(n)}},m._gum=function(e,t,r){var i=navigator.mediaDevices;if(!i||!h(i.getUserMedia))return void r(new Error("navigator.mediaDevices.getUserMedia() not defined"));var n=this;i.getUserMedia(this._devices.constraints).then(function(i){e.call(n,i,t,r)}).catch(function(e){var t=n._addPayload();t.data.error=e,r(t)})},m._promiseUserMediaAudio=function(e,t,r){this._devices.selected.audio?(this.deleteUserMedia(),this._devices.stream=e,this._setConstraints(["audio"]),this._gum(this._onGetUserMediaAudio,t,r)):this._replaceMediaStream(e,t,r)},m._promiseUserMedia=function(e,t){this._setConstraints(["video","audio"]),this._gum(this._replaceMediaStream,e,t)},m._onGetUserMediaAudio=function(e,t,r){var i=e.getAudioTracks()[0];if(!i){var n=this._addPayload();return n.data.error=new Error('in "getUserMedia": no audio track to add'),void r(n)}this._devices.stream.addTrack(i);var a=this._nanoScreenCapture.getScreenConstraints(this._videoDeviceConfig);this._devices.constraints.video=a.video,this._installMediaStream(),this._prepareMediaStream(t,r)},m._replaceMediaStream=function(e,t,r){this.deleteUserMedia(),this._devices.stream=e,this._installMediaStream(),this._prepareMediaStream(t,r)},m._installMediaStream=function(){var e;this._devices.stream.onactive=this._onActive.bind(this),this._devices.stream.oninactive=this._onInactive.bind(this),this._devices.stream.onaddtrack=this._onAddTrack.bind(this),this._devices.stream.onremovetrack=this._onRemoveTrack.bind(this);var r=[].concat(this._devices.stream.getVideoTracks()).concat(this._devices.stream.getAudioTracks());for(e=0;e<r.length;e++)r[e].onended=this._onTrackEnded.bind(this);this._devices.state=t.STREAM_ACTIVE},m._prepareMediaStream=function(e,t){var r,i=this,n=this._devices.stream.getVideoTracks(),a=this._devices.stream.getAudioTracks(),s=[].concat(n).concat(a),o=!!s.length;if(o){var c,d,u=!0;for(c=0;c<s.length;c++)if(d=s[c],d.readyState&&(!u||"live"!==d.readyState)){u=!1,r=this._addPayload(),r.data.error="media stream received but no "+s[c].kind+' data from device "'+s[c].label+'", maybe in use from another app',t(r);break}if(!u)return;n.length?(this._devices.tags.video=document.createElement("video"),this._devices.tags.video.onloadedmetadata=function(){i._onMetaData(this,n,a,e,t)},this._devices.tags.video.autoplay=!0,this._devices.tags.video.setAttribute("playsinline",""),this._devices.tags.video.muted=!0,this._devices.tags.video.srcObject=this._devices.stream):a.length&&(this._devices.tags.audio=document.createElement("audio"),this._devices.tags.audio.onloadedmetadata=function(){i._onMetaData(this,n,a,e,t)},this._devices.tags.audio.autoplay=!0,this._devices.tags.audio.muted=!0,this._devices.tags.audio.srcObject=this._devices.stream)}else r=this._addPayload(),r.data.error="media stream received, but no tracks",t(r)},m._onMetaData=function(e,r,i,n,a){var s;if(!this._devices.gotMetaData){if(this._devices.gotMetaData=!0,e.videoWidth&&e.videoHeight&&0<e.videoWidth&&e.videoWidth<10||0<e.videoHeight&&e.videoHeight<10)s=this._addPayload(),s.data.error="media stream received but no video data from device "+r[0].label+", maybe in use from another app",a(s);else if(e.duration&&e.duration!==1/0||e.ended||e.error)s=this._addPayload(),s.data.error="media stream received but no audio data from device "+i[0].label+", maybe in use from another app",a(s);else{var o=this._devices.metaData;o.hasVideo=!!r.length,o.hasAudio=!!i.length,o.width=e.videoWidth||0,o.height=e.videoHeight||0,o.framerate=e.playbackRate;try{s=this._addPayload(),s.data.stream=this._devices.stream,s.data.metadata=this._devices.metaData,s.data.constraints=this._devices.constraints,this._state=t.STREAM_ACTIVE,n(s)}catch(e){s=this._addPayload(),s.data.error=e,a(s)}}this._devices.tags.video&&(this._devices.tags.video.src="",this._devices.tags.video=void 0),this._devices.tags.audio&&(this._devices.tags.audio.src="",this._devices.tags.audio=void 0)}},m._onActive=function(e){this._devices.state=t.STREAM_ACTIVE;var r=this._addPayload(e);r.name="StreamActive",this.emit(r.name,r)},m._onInactive=function(e){this._devices.state=t.STREAM_INACTIVE;var r=this._addPayload(e);r.name="StreamInactive",this.emit(r.name,r)},m._onAddTrack=function(e){var t=this._addPayload(e);t.name="StreamAddTrack",this.emit(t.name,t)},m._onRemoveTrack=function(e){var t=this._addPayload(e);t.name="StreamRemoveTrack",this.emit(t.name,t)},m._onTrackEnded=function(e){this._devices.state=t.STREAM_ENDED;var r=this._addPayload(e);r.name="StreamTrackEnded",this.emit(r.name,r)},m._stopTracks=function(e){var t;for(t=0;t<e.length;t++)e[t].stop()},m._setConstraints=function(e){var t,r,i={audio:!1,video:!1};for(t=0,r=e.length;t<r;t++)switch(e[t]){case"video":c(this._devices.selected.video)?i.video=this._devices.selected.video:(i.video=this._videoDeviceConfig,i.video.sourceId=this._devices.selected.video.deviceId);break;case"audio":c(this._devices.selected.audio)?i.audio=this._devices.selected.audio:(i.audio={},i.audio.sourceId=this._devices.selected.audio.deviceId);break;case"screen":i=this._nanoScreenCapture.getScreenConstraints(this._videoDeviceConfig)}this._devices.constraints=i,a("constraints: "+JSON.stringify(i))},m.muteVideoTracks=function(e){this._muteTracks("video",e)},m.muteAudioTracks=function(e){this._muteTracks("audio",e)},m._muteTracks=function(e,t){var r;if(this._devices.stream){var i="video"===e?this._devices.stream.getVideoTracks():"audio"===e?this._devices.stream.getAudioTracks():void 0;if(i){for(r=0;r<i.length;r++)i[r].enabled=!t;this._devices.muted[e]=t}}},n}.apply(t,i),!(void 0!==n&&(e.exports=n))},function(e,t,r){var i,n;i=[r(5),r(6)],n=function(e,t){"use strict";function r(e){t.call(this),this._screenCaptureName=e||"nanoScreenCapture",this._mediaType="local",this._sourceId=null,this._screenConstraints="",this.width=0,this.height=0,this.maxWidth=1920,this.maxHeight=1080,this.framerate=3,this.screenCaptureAvailable=null,this._onGetSourceId=null,this._onReleaseSourceId=null;var r=this;window.addEventListener("message",function(e){if(e.origin===window.location.origin&&r._isValidType(e.data.type)&&e.data.command)if("message"===e.data.command)"isReady"===e.data.value?(r.screenCaptureAvailable=!0,i(r._screenCaptureName+" event screenCaptureAvailable / isReady ")):"isLoaded"===e.data.value?(r.screenCaptureAvailable=!0,i(r._screenCaptureName+" event screenCaptureAvailable / isLoaded")):"isReleased"===e.data.value&&(i(r._screenCaptureName+" event isReleased"),r._sourceId=null,r._onReleaseSourceId&&r._onReleaseSourceId(),n.name="ReleaseSourceId",r.emit(n.name,n));else if("error"===e.data.command){var t=r._screenCaptureName+" error: "+e.data.value;if(i(t),"PermissionDeniedError"===e.data.value){var n=r._addPayload();n.name="PermissionDenied",n.data.error="ScreenCapture (Chrome) - "+e.data.value,r.emit(n.name,n)}}else if("setSourceId"===e.data.command){var a=e.data.value;i(r._screenCaptureName+" event setSourceId"),r._setSourceId(a)}}),this.checkAlive()}var i=e.debug_,n=e.isFunction,a=r.prototype=Object.create(t.prototype);return a._mediaId=String(""),a._mediaIndex=Number(-1),a._addPayload=function(e){return e=e||{},e.data={},e.data.mediaId=this._mediaId,e.data.mediaIndex=this._mediaIndex,e.data.mediaType=this._mediaType,e},a._toWindow=function(e,t,r){i(this._screenCaptureName+" _toWindow --> { type: "+e+", command: "+t+", value: "+r+" }"),window.postMessage({type:e,command:t,value:r},"*")},a._isValidType=function(e){return e==this._screenCaptureName},a._setSourceId=function(e){"undefined"!=typeof e?this._sourceId=e:this._sourceId=null,this._onGetSourceId&&this._onGetSourceId()},a.getScreenCaptureName=function(){return this._screenCaptureName},a.isScreenCaptureAvailable=function(){return this.screenCaptureAvailable},a.checkAlive=function(){if(null===this.screenCaptureAvailable){var e=this;setTimeout(function(){e.screenCaptureAvailable||(e.screenCaptureAvailable=!1)},500)}i(this._screenCaptureName+" alive?"),this._toWindow(this._screenCaptureName,"isAlive","")},a.getSourceId=function(e){n(e)&&(this._onGetSourceId=e,i(this._screenCaptureName+" getSourceId"),this._toWindow(this._screenCaptureName,"getSourceId",""))},a.releaseSourceId=function(e){n(e)&&(this._onReleaseSourceId=e,i(this._screenCaptureName+" releaseSourceId"),null!==this._sourceId&&this._toWindow(this._screenCaptureName,"releaseSourceId",""))},a.getScreenConstraints=function(e){var t=window.screen.width,r=window.screen.height;this.width>0&&(t=this.width),this.height>0&&(r=this.height),t>this.maxWidth&&(t=this.maxWidth),r>this.maxHeight&&(r=this.maxHeight);var i,n=this.framerate,a=null,s=null;return e.frameRate&&(a=e.frameRate.max,s=e.frameRate.min,i=e.frameRate.ideal,n=i),this._screenConstraints={audio:!1,video:{mandatory:{maxWidth:t,maxHeight:r},optional:[]}},t>0&&r>0&&(this._screenConstraints.video.optional.push({minWidth:t}),this._screenConstraints.video.optional.push({minHeight:r}),this._screenConstraints.video.optional.push({maxWidth:t}),this._screenConstraints.video.optional.push({maxHeight:r})),n>0&&(this._screenConstraints.video.optional.push({minFrameRate:s||n}),this._screenConstraints.video.optional.push({maxFrameRate:a||n})),navigator.webkitGetUserMedia?(this._screenConstraints.video.mandatory.chromeMediaSource="desktop",""==this._sourceId&&(this._sourceId=null)):this._screenConstraints.video.mediaSource="screen",this._screenConstraints.video.mandatory.chromeMediaSourceId=this._sourceId,this._screenConstraints},r}.apply(t,i),!(void 0!==n&&(e.exports=n))},function(e,t,r){var i,n;i=[],n=function(){"use strict";var e=Math.floor,t=Math.random,r={browserInfo:void 0,HTTPParams:void 0,logTime:!0,debugLevel:0,debugCount:0,debugMax:30,ELEMENT_DEBUG:"debug",ELEMENT_MESSAGES:"messages",ELEMENT_ERRORS:"errors"};return r.parseJSON=function(e,t,i){if("object"==typeof e)return e;try{return JSON.parse(e,t)}catch(t){r.error_("Error:"+t+" parsing from json: "+e,i)}},r.stringifyJSON=function(e,t,i,n){if(r.isString(e))return e;try{return JSON.stringify(e,t,i)}catch(t){r.error_("Error:"+t+" stringifying to json: "+e,n)}},r.getHTTPParam=function(e){var t,i;if(!r.HTTPParams){r.HTTPParams=[];var n=document.location.search.substr(1,document.location.search.length),a=document.location.href;if(""===n&&a.indexOf("?")!==-1&&(n=a.slice(a.indexOf("?")+1)),""!==n)for(n=n.split("&"),t=0,i=n.length;t<i;t++){var s=n[t].split("="),o=s[0],c=s.length>1?s[1]:"";r.HTTPParams[unescape(o)]=unescape(c)}}return r.HTTPParams[e]},r.encodeURIComponent=function(e,t){return r.isString(e)?decodeURIComponent(e)===e?encodeURIComponent(e):e:void r.error_("Error: could not uri encode: "+e+"(must be of type string)",t)},r.getElement=function(e){var t=document.getElementById(e);return t?t:(r.debug_("DOM element not found "+e),{value:void 0,checked:void 0,enabled:void 0,textContent:void 0,options:{length:0},style:{},innerHTML:"",src:"",classList:"",click:function(){return null},show:function(){return null},hide:function(){return null},removeChild:function(){return null}})},r.elementExists=function(e){return!!document.getElementById(e)},r.showElement=function(e,t){var i=r.getElement(e);i&&(t||"undefined"==typeof t?i.style.display="block":i.style.display="none")},r.disableElement=function(e){var t=r.getElement(e);t&&(r.getElement(e).disabled=!0)},r.print_=function(e){r._log(e,"messages")},r.success_=function(e){r._log(e,"messages","green")},r.warning_=function(e){r._log(e,"messages","orange")},r.error_=function(e,t){t||(t=1),r._log(e,r.ELEMENT_MESSAGES,"red"),r._log(e,r.ELEMENT_ERRORS,"red",t)},r.debug_=function(e){0!==r.debugLevel&&r._log(e,r.ELEMENT_DEBUG)},r._log=function(e,t,i,n){r.isObject(e)&&(e=r.stringifyJSON(e,null," "));var a="";if(r.logTime&&window.performance){var s=(window.performance.now()/1e3).toFixed(3);a=s+": "}switch(i){case"green":e="Success: "+e;break;case"orange":e="Warning: "+e;break;case"red":e="Error: "+e;break;default:i=""}i?console.log("%c"+e,"color:"+i):console.log(e);var o=document.getElementById(t);if(o&&(t===r.ELEMENT_DEBUG&&r.debugCount>r.debugMax&&(o.removeChild(o.firstChild),r.debugCount++),o.innerHTML+="<span"+(i?' style="color:'+i+';">':">")+e+"</span><br>"),n>1)throw new Error(e)},r.contains=function(e,t){var r,i,n=0,a=0,s=t.split("*");for(r=0,i=s.length;r<i;r++)0!==s[r].length&&(a++,e.indexOf(s[r])!==-1&&n++);return n===a},r.isBool=function(e){return e===!0||e===!1},r.isIntString=function(e){return r.isString(e)&&r.isInt(Number(e))},r.isNumber=function(e){return Number(e)===e&&isFinite(e)},r.isInt=function(e){return e===Number(e)&&e%1===0},r.isUint=function(e){return e===Number(e)&&e%1===0&&e>=0},r.isString=function(e){return"string"==typeof e||e instanceof String},r.isFunction=function(e){return"function"==typeof e},r.isObject=function(e){return!!e&&e.constructor!==Array&&("object"==typeof e||e instanceof Object)},r.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},r.showRtcStats=function(e,t,i){var n,a,s="";if(i)for(n=0;n<i.length;++n){var o=i[n],c=o.id;if(c){var d=!1;if(d=!0,"bweforvideo"===c&&(d=!0),c.length>19&&"ssrc"===c.substring(0,4)&&c.indexOf("send")!==-1&&(d=!0),c.indexOf("Certific")===-1&&c.indexOf("LibjingleSession")===-1||(d=!1),d&&o.names){r.debug_("RTC-Stat-ID: "+c+"\n");var u=o.names();if(u){for(s+="["+c+"]: ",a=0;a<u.length;++a){var h=u[a];if(!h.indexOf("Certific")!==-1)try{h.length>4&&"goog"===h.substring(0,4)&&(h=h.substring(4)),s+=h,s+=" : ",s+=o.stat(u[a])+" "}catch(e){r.debug_(e)}}s+="\r\n"}}}else s+=t}if(s.length>1){r.debug_("RTC Status:"+s);var l=document.getElementById(e);if(l){var m=s.replace(/\r?\n|\r/g,"<br>").replace(/\[/g,"<b>[").replace(/\]/g,"]</b>");l.innerHTML="<b>RTC Status:</b><br>"+m}}},r.showRtmpStats=function(e,t){var i=document.getElementById(e);i?(r.debug_("RTMP Status: "+t),i.innerHTML="<b>RTMP Stats:</b><br>"+t):r.success_(event.text+": "+t)},r.getRandomUint=function(i){return i=r.isUint(i)?i:10,e(t()*i)},r.getRandomString=function(e,t){var i,n,a,s,o="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",c="0123456789abcdefghijklmnopqrstuvwxyz",d="0123456789";switch(e){case 0:s=d;break;case 1:s=c;break;case 2:s=o;break;default:s=c}var u="",h=r.getRandomUint;for(i=0,n=r.isUint(t)?t:6,a=s.length;i<n;i++)u+=s[h(a)];return u},r.shortenText=function(e,t){t=r.isUint(t)?t:40;var i=e.replace(/[\n\r]/g,"");return i.length>t?i.substr(0,t)+" ...":i},r.findIndexInObjectArray=function(e,t){var r,i;for(r=0,i=e.length;r<i;r++)if(e[r][t])return r;return null},r.findValueInObjectArray=function(e,t){var i=r.findIndexInObjectArray(e,t);return i?e[i][t]:null},r.createBrowserInfo=function(){var e,t,i="Unknown",n="";if(screen.width){var a=screen.width?screen.width:"",s=screen.height?screen.height:"";n+=""+a+" x "+s}var o,c,d,u=navigator.appVersion,h=navigator.userAgent,l=navigator.appName,m=""+parseFloat(u),p=parseInt(u,10);(c=h.indexOf("Opera"))!==-1&&(l="Opera",m=h.substring(c+6),(c=h.indexOf("Version"))!==-1&&(m=h.substring(c+8))),(c=h.indexOf("OPR/"))!==-1?(l="Opera",m=h.substring(c+4)):(c=h.indexOf("MSIE"))!==-1?(l="Microsoft Internet Explorer",m=h.substring(c+5)):"Netscape"===l&&(c=h.indexOf("Trident/"))!==-1?(l="Microsoft Internet Explorer",m=h.substring(c+8),(c=h.indexOf("rv:"))!==-1&&(m=h.substring(c+3))):"Netscape"===l&&(c=h.indexOf("Edge/"))!==-1?(l="Microsoft Edge",m=h.substring(c+5)):(c=h.indexOf("Chrome"))!==-1?(l="Chrome",m=h.substring(c+7)):(c=h.indexOf("Safari"))!==-1?(l="Safari",m=h.substring(c+7),(c=h.indexOf("Version"))!==-1&&(m=h.substring(c+8)),h.indexOf("CriOS")!==-1&&(l="Chrome")):(c=h.indexOf("Firefox"))!==-1?(l="Firefox",m=h.substring(c+8)):(o=h.lastIndexOf(" ")+1)<(c=h.lastIndexOf("/"))&&(l=h.substring(o,c),m=h.substring(c+1),l.toLowerCase()===l.toUpperCase()&&(l=navigator.appName)),(d=m.indexOf(";"))!==-1&&(m=m.substring(0,d)),(d=m.indexOf(" "))!==-1&&(m=m.substring(0,d)),(d=m.indexOf(")"))!==-1&&(m=m.substring(0,d)),p=parseInt(""+m,10),isNaN(p)&&(m=""+parseFloat(u),p=parseInt(u,10));var f=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(u),v=navigator.cookieEnabled;"undefined"!=typeof navigator.cookieEnabled||v||(document.cookie="testcookie",v=document.cookie.indexOf("testcookie")!==-1);var _=i,g=[{os:"Windows XP",regex:/(Windows NT 5.1|Windows XP)/},{os:"Windows Server 2003",regex:/Windows NT 5.2/},{os:"Windows Vista",regex:/Windows NT 6.0/},{os:"Windows 7",regex:/(Windows 7|Windows NT 6.1)/},{os:"Windows 8.1",regex:/(Windows 8.1|Windows NT 6.3)/},{os:"Windows 8",regex:/(Windows 8|Windows NT 6.2)/},{os:"Windows NT 4.0",regex:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{os:"Windows ME",regex:/Windows ME/},{os:"Android",regex:/Android/},{os:"Open BSD",regex:/OpenBSD/},{os:"Sun OS",regex:/SunOS/},{os:"Linux",regex:/(Linux|X11)/},{os:"iOS",regex:/(iPhone|iPad|iPod)/},{os:"Mac OS X",regex:/Mac OS X/},{os:"Mac OS",regex:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{os:"QNX",regex:/QNX/},{os:"UNIX",regex:/UNIX/},{os:"BeOS",regex:/BeOS/},{os:"OS/2",regex:/OS\/2/},{os:"Search Bot",regex:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(e=0,t=g.length;e<t;++e)if(g[e].regex.test(h)){_=g[e].os;break}var S=i;switch(/Windows/.test(_)&&(S=(/Windows (.*)/.exec(_)||[])[1],_="Windows"),_){case"Mac OS X":S=(/Mac OS X (10[\.\_\d]+)/.exec(h)||[])[1];break;case"Android":S=(/Android ([\.\_\d]+)/.exec(h)||[])[1];break;case"iOS":S=/OS (\d+)_(\d+)_?(\d+)?/.exec(u)||[],S=S[1]+"."+S[2]+"."+(0|S[3])}r.browserInfo={screenSize:n,browser:l,browserVersion:m,mobile:f,os:_,osVersion:S,cookiesEnabled:v}},r.createBrowserInfo(),r}.apply(t,i),/**
	 * @license NanoTools 2.1.0 
	 * Copyright (c) 2016-2017 nanocosmos IT GmbH. All rights reserved.
	 * http://www.nanocosmos.de
	 * debug/log
	 * RtcStats
	 */
!(void 0!==n&&(e.exports=n))},function(e,t,r){var i;(function(){"use strict";function t(){}function n(e,t){for(var r=e.length;r--;)if(e[r].listener===t)return r;return-1}function a(e){return function(){return this[e].apply(this,arguments)}}var s=t.prototype,o=this,c=o.EventEmitter;s.getListeners=function(e){var t,r,i=this._getEvents();if(e instanceof RegExp){t={};for(r in i)i.hasOwnProperty(r)&&e.test(r)&&(t[r]=i[r])}else t=i[e]||(i[e]=[]);return t},s.flattenListeners=function(e){var t,r=[];for(t=0;t<e.length;t+=1)r.push(e[t].listener);return r},s.getListenersAsObject=function(e){var t,r=this.getListeners(e);return r instanceof Array&&(t={},t[e]=r),t||r},s.addListener=function(e,t){var r,i=this.getListenersAsObject(e),a="object"==typeof t;for(r in i)i.hasOwnProperty(r)&&n(i[r],t)===-1&&i[r].push(a?t:{listener:t,once:!1});return this},s.on=a("addListener"),s.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},s.once=a("addOnceListener"),s.defineEvent=function(e){return this.getListeners(e),this},s.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},s.removeListener=function(e,t){var r,i,a=this.getListenersAsObject(e);for(i in a)a.hasOwnProperty(i)&&(r=n(a[i],t),r!==-1&&a[i].splice(r,1));return this},s.off=a("removeListener"),s.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},s.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},s.manipulateListeners=function(e,t,r){var i,n,a=e?this.removeListener:this.addListener,s=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(i=r.length;i--;)a.call(this,t,r[i]);else for(i in t)t.hasOwnProperty(i)&&(n=t[i])&&("function"==typeof n?a.call(this,i,n):s.call(this,i,n));return this},s.removeEvent=function(e){var t,r=typeof e,i=this._getEvents();if("string"===r)delete i[e];else if(e instanceof RegExp)for(t in i)i.hasOwnProperty(t)&&e.test(t)&&delete i[t];else delete this._events;return this},s.removeAllListeners=a("removeEvent"),s.emitEvent=function(e,t){var r,i,n,a,s,o=this.getListenersAsObject(e);for(a in o)if(o.hasOwnProperty(a))for(r=o[a].slice(0),n=r.length;n--;)i=r[n],i.once===!0&&this.removeListener(e,i.listener),s=i.listener.apply(this,t||[]),s===this._getOnceReturnValue()&&this.removeListener(e,i.listener);return this},s.trigger=a("emitEvent"),s.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},s.emitSimple=function(e,t,r){return this.emitEvent(e,[{name:e||"AnonymousEvent",target:r||this,data:t||{}}])},s.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},s._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},s._getEvents=function(){return this._events||(this._events={})},t.noConflict=function(){return o.EventEmitter=c,t},i=function(){return t}.call(o,r,o,e),!(void 0!==i&&(e.exports=i))}).call(this)},function(e,t,r){var i,n;i=[],n=function(){"use strict";var e={ROLE_BROADCASTER:0,ROLE_VIEWER:1,ROLE_MONITOR:2,ROLE_MIXED:3,ROLE_CHATTER:4,ROLE_TRANSCODER:100,CHANNEL_IDLE:1,CHANNEL_SIGNED_IN:2,CHANNEL_HANDSHAKE:3,CHANNEL_CALLING:4,CHANNEL_CALL_INCOMING:5,CHANNEL_CALL_NEGOTIATING:6,CHANNEL_CALL_ACTIVE:7,CHANNEL_CALL_DROPPED:8,CHANNEL_CALL_UNSTABLE:9,CHANNEL_CALL_REJECTED:10,HANDSHAKE_IDLE:1,HANDSHAKE_CALLYOU:2,HANDSHAKE_CALLME:3,HANDSHAKE_DONE:4,STREAM_NOMEDIASTREAM:1,STREAM_ACTIVE:2,STREAM_INACTIVE:3,STREAM_ENDED:4};return e}.apply(t,i),!(void 0!==n&&(e.exports=n))},function(e,t,r){var i,n;i=[r(7),r(5),r(6)],n=function(e,t,r){"use strict";function i(t,i){return r.call(this),"string"==typeof t||t instanceof String?Number(i)!==i||i%1!==0?void n("RemoteMedia: param mediaIndex must be an integer",2):(this._mediaId=t,this._mediaIndex=i,this._mediaType="remote",this._state=e.STREAM_NOMEDIASTREAM,this._metaData={hasAudio:!1,hasVideo:!1,width:0,height:0,framerate:0},this._gotMetaData=!1,this._tags={video:void 0,audio:void 0},void this.defineEvents(["StreamActive","StreamInactive","StreamAddTrack","StreamRemoveTrack","StreamTrackEnded"])):void n("RemoteMedia: param mediaId must be of type string",2)}var n=(t.debug_,t.warning_,t.error_),a=(t.success_,i.prototype=Object.create(r.prototype));return a.getMediaId=function(){return this._mediaId},a.getMediaIndex=function(){return this._mediaIndex},a.getMediaType=function(){return this._mediaType},a.getRemoteMediaStream=function(){return this._stream},a._addPayload=function(e){return e=e||{},e.data={},e.data.mediaId=this._mediaId,e.data.mediaIndex=this._mediaIndex,e.data.mediaType=this._mediaType,e},a.getMediaStreamState=function(){return this._state=this._stream?this._stream.active?e.STREAM_ACTIVE:e.STREAM_INACTIVE:e.STREAM_NOMEDIASTREAM,this._state},a.addMediaStream=function(e,t,r){this.removeMediaStream(),this._stream=e,this._installMediaStream(),this._prepareMediaStream(t,r)},a._installMediaStream=function(e,t){this._stream.onactive=this._onActive.bind(this),this._stream.oninactive=this._onInactive.bind(this),this._stream.onaddtrack=this._onAddTrack.bind(this),this._stream.onremovetrack=this._onRemoveTrack.bind(this);for(var r=[].concat(this._stream.getVideoTracks()).concat(this._stream.getAudioTracks()),i=0,n=r.length;i<n;i++)r[i].onended=this._onTrackEnded.bind(this)},a._prepareMediaStream=function(e,t){var r=this,i=this._stream.getVideoTracks(),n=this._stream.getAudioTracks(),a=[].concat(i).concat(n),s=!!a.length;if(s)i.length?(this._tags.video=document.createElement("video"),this._tags.video.onloadedmetadata=function(){r._onMetaData(this,i,n,e,t)},this._tags.video.autoplay=!0,this._tags.video.setAttribute("playsinline",""),this._tags.video.muted=!0,this._tags.video.srcObject=this._stream):n.length&&(this._tags.audio=document.createElement("audio"),this._tags.audio.onloadedmetadata=function(){r._onMetaData(this,i,n,e,t)},this._tags.audio.autoplay=!0,this._tags.audio.muted=!0,this._tags.audio.srcObject=this._stream);else{var o=this._addPayload();o.data.error="media stream added, but no tracks",t(o)}},a._onMetaData=function(t,r,i,n,a){if(!this._gotMetaData){this._gotMetaData=!0,this._metaData.hasVideo=!!r.length,this._metaData.hasAudio=!!i.length,this._metaData.width=t.videoWidth?t.videoWidth:0,this._metaData.height=t.videoHeight?t.videoHeight:0,this._metaData.framerate=t.playbackRate;try{var s=this._addPayload();s.data.stream=this._stream,s.data.metadata=this._metaData,this._state=e.STREAM_ACTIVE,n(s)}catch(e){var s=this._addPayload();s.data.error=e,a(s)}this._tags.video&&(this._tags.video.src="",this._tags.video=void 0),this._tags.audio&&(this._tags.audio.src="",this._tags.audio=void 0)}},a._onActive=function(t){this._state=e.STREAM_ACTIVE;var r=this._addPayload(t);r.name="StreamActive",this.emit(r.name,r)},a._onInactive=function(t){this._state=e.STREAM_INACTIVE;var r=this._addPayload(t);r.name="StreamInactive",this.emit(r.name,r)},a._onAddTrack=function(e){var t=this._addPayload(e);t.name="StreamAddTrack",this.emit(t.name,t)},a._onRemoveTrack=function(e){var t=this._addPayload(e);t.name="StreamRemoveTrack",this.emit(t.name,t)},a._onTrackEnded=function(t){this._state=e.STREAM_ENDED;var r=this._addPayload(t);r.name="StreamTrackEnded",this.emit(r.name,r)},a.removeMediaStream=function(t,r){try{if(null!==this._stream){this._stream.onactive=void 0,this._stream.oninactive=void 0,this._stream.onaddtrack=void 0,this._stream.onremovetrack=void 0;for(var i=[].concat(this._stream.getVideoTracks()).concat(this._stream.getAudioTracks()),n=0,a=i.length;n<a;n++)i[n].onended=void 0}this._stopTracks(this._stream.getVideoTracks()),this._stopTracks(this._stream.getAudioTracks()),this._stream=null,this._state=e.STREAM_NOMEDIASTREAM,this._metaData={hasAudio:!1,hasVideo:!1,width:0,height:0,framerate:0},this._gotMetaData=!1;var s=this._addPayload();s.data.stream=this._stream,!!t&&t(s)}catch(e){var s=this._addPayload();s.data.error=e,!!r&&r(s)}},a._stopTracks=function(e){for(var t=0,r=e.length;t<r;t++)e[t].stop()},a.muteVideoTracks=function(e){this._muteTracks("video",e)},a.muteAudioTracks=function(e){this._muteTracks("audio",e)},a._muteTracks=function(e,t){if(this._stream){var r="video"===e?this._stream.getVideoTracks():"audio"===e?this._stream.getAudioTracks():void 0;if(r){for(var i=0,n=r.length;i<n;i++)r[i].enabled=!t;this._muted[e]=t}}},i}.apply(t,i),!(void 0!==n&&(e.exports=n))},function(e,t,r){var i,n;i=[r(7),r(5)],n=function(e,t){"use strict";function r(e){this._ownerId=e,this._list={}}var i=t.debug_,n=t.stringifyJSON,a=r.prototype;return a.createPublicUserList=function(){var e=[],t=this._list;for(var r in t){var a=t[r];e.push({remoteUserId:r,remotePeerId:a[a.length-1],remoteUserName:a[1],state:a[0]})}return e.sort(function(e,t){if(e.remotePeerId<t.remotePeerId)return 1}),i("userlist::createPublicUserList: "+n(e)),e},a.updateEntry=function(e){var t=e.data,r=t.remotePeerName.split("_");r[0]!==""+this._ownerId&&(i("userList::updateEntry: name="+r[1]+", userId="+r[0]+", "+n(t)),1===t.connected?this._add(r[0],r[1],t.remotePeerId):this._remove(r[0],t.remotePeerId,e.target.getRemotePeerId()))},a._add=function(t,r,a){this._list[t]?this._list[t].push(a):this._list[t]=[e.CHANNEL_SIGNED_IN,r,a],i("userList::add: name="+r+", userId="+t+", "+n(this._list))},a._remove=function(t,r,a){var s=this._list[t];if(s){for(var o,c=2,d=s.length;c<d;c++)s[c]===r&&(s.splice(c,1),r===a&&(s[0]=e.CHANNEL_SIGNED_IN),o=s[1],2===s.length&&delete this._list[t]);i("userList::remove: name="+o+", userId="+t+", "+n(this._list))}},a.updateEntryState=function(t){if(t.getRole()===e.ROLE_BROADCASTER)return!1;var r,a,s,o=!1,c=!1;for(var d in this._list){s=this._list[d];for(var u=2,h=s.length;u<h;u++)s[u]==t.getRemotePeerId()&&(i("userList::updateEntryState: state(old)="+s[0]+", name="+s[1]+", userId="+d+", "+n(this._list)),r=t.getState(),a=s[0],r===e.CHANNEL_IDLE?(i("userList::updateEntryState:  CM REMOVED state=1, name="+s[1]+", userId="+d+", "+n(this._list)),s.splice(u,0),s[0]=e.CHANNEL_SIGNED_IN,2===s.length&&(delete this._list[d],i("userList::updateEntryState:  USER REMOVED state=1, name="+s[1]+", userId="+d+", "+n(this._list))),c=!0):r!==a?(s[0]=r,i("userList::updateEntryState: state(new)="+s[0]+", name="+s[1]+", userId="+d+", "+n(this._list)),c=!0):(i("userList::updateEntryState: NO UPDATE state="+s[0]+", name="+s[1]+", userId="+d+", "+n(this._list)),c=!1),o=!0);if(o||d===t.getRemoteUserId()&&t.getState()===e.CHANNEL_IDLE&&(i("userList::updateEntryState: state(old)="+s[0]+", name="+s[1]+", userId="+d+", "+n(this._list)),s[0]=e.CHANNEL_SIGNED_IN,2===s.length&&(delete this._list[d],i("userList::updateEntryState:  USER REMOVED state=1, name="+s[1]+", userId="+d+", "+n(this._list))),o=!0,c=!0),o)break}return c},a.getUserNameByRemotePeerId=function(e){return this._getByRemotePeerId(e,"name")},a.getUserStateByRemotePeerId=function(e){return this._getByRemotePeerId(e,"state")},a.getUserIdByRemotePeerId=function(e){return this._getByRemotePeerId(e,"remoteUserId")},a.getUserStateByRemoteUserId=function(e){return this._getByRemoteUserId(e,"state")},a.getUserNameByRemoteUserId=function(e){return this._getByRemoteUserId(e,"name")},a.getFreePeerIdByRemoteUserId=function(e){return this._getByRemoteUserId(e,"freePeer")},a._getByRemotePeerId=function(e,t){var r,i,n=this._list;for(r in n){i=n[r];for(var a=2,s=i.length;a<s;a++)if(e===i[a])return"remoteUserId"===t?r:"state"===t?i[0]:"name"===t?i[1]:void 0}},a._getByRemoteUserId=function(e,t){var r,i=this._list;for(var n in i)if(n===e)return r=i[n],r["state"===t?0:"name"===t?1:"freePeer"===t?r.length-1:void 0]},r}.apply(t,i),!(void 0!==n&&(e.exports=n))},function(e,t,r){var i,n;i=[r(7),r(5)],n=function(e,t){"use strict";function r(){this._broadcaster=void 0,this._chatters=[],this._viewers=[]}var i=t.debug_,n=r.prototype;return n.getFreeChatter=function(){var t=this._chatters.length>0&&this._chatters[this._chatters.length-1].getState()===e.CHANNEL_SIGNED_IN?this._chatters[this._chatters.length-1]:null;if(t)return i("ChannelMemberlist::getFreeChatter: Chatter "+t.getPeerId()+" with state "+t.getState()),t},n.getBroadcaster=function(){return this._broadcaster},n.findById=function(e){return this._findBy("_peerId",e)},n.findByRemoteId=function(e){return this._findBy("_remotePeerId",e)},n.findByRemoteUserId=function(e){return this._findBy("_remoteUserId",e)},n._findBy=function(e,t){var r,i,n=this._chatters;for(r=0,i=n.length;r<i;r++)if(n[r][e]===t)return n[r]},n.add=function(t){switch(t.getRole()){case e.ROLE_BROADCASTER:if(this._broadcaster)throw new Error("only one broadcaster atm, you tried to make a second");this._broadcaster=t,i("ChannelMemberlist::add: Broadcaster "+t.getPeerId()+" added ");break;case e.ROLE_VIEWER:this._viewers.push(t),i("ChannelMemberList::add: Viewer "+t.getPeerId()+" added ");break;case e.ROLE_MONITOR:break;case e.ROLE_MIXED:break;case e.ROLE_CHATTER:this._chatters.push(t),i("ChannelMemberList::add: Chatter "+t.getPeerId()+" added ("+this._listChatters()+")");break;case e.ROLE_TRANSCODER:break;default:throw new Error("unknown channelmember role")}},n.remove=function(e){var t,r,n=this._chatters;for(t=0,r=n.length;t<r;t++)if(n[t]===e)return i("ChannelMemberList::remove: Chatter "+e.getPeerId()+" removed ("+this._listChatters()+")"),void n.splice(t,1);e===this._broadcaster&&(this._broadcaster=void 0)},n.getChatters=function(){return i("ChannelMemberList::getChatters: ("+this._listChatters()+")"),this._chatters},n.signOutChatters=function(t){i("ChannelMemberList::signOutChatters: ("+this._listChatters()+")");var r,n,a=this._chatters;for(r=0,n=a.length;r<n;r++)a[r]&&a[r].getState()!==e.CHANNEL_IDLE&&a[r].signOut(t);a.length=0},n.signOutBroadcaster=function(e){this._broadcaster&&(i("ChannelMemberList::signOutBroadcaster: ("+this._broadcaster.getPeerId()+")"),this._broadcaster.signOut(e)),this._broadcaster=void 0},n._listChatters=function(){var e,t,r=this._chatters,n="chatter count: "+r.length+" [";for(e=0,t=r.length;e<t;e+=1)n+=r[e].getPeerId(),n+=e<t-1?",":"";return n+="]",i("ChannelMemberList::listChatters: ("+n+")"),n},r}.apply(t,i),!(void 0!==n&&(e.exports=n))},function(e,t,r){var i,n;i=[r(12),r(13),r(7),r(6),r(5),r(17)],n=function(e,t,r,i,n,a){"use strict";function s(e,t,n,a,s,o,c,u,h){i.call(this),l(e)||d("ChannelMember: param server must be a string",2),l(t)||d("ChannelMember: param userName must be a string",2),l(a)||d("ChannelMember: param room must be a string",2),m(s)||d("ChannelMember: param role must be an integer",2),p(n)||d("ChannelMember: param userId must be an integer",2),o&&!l(o)&&d("ChannelMember: param serverUserName must be a string",2),c&&!l(c)&&d("ChannelMember: param serverUserName must be a string",2),u&&!l(u)&&d("ChannelMember: param serverPassword must be a string",2),h&&!l(h)&&d("ChannelMember: param serverPassword must be a string",2),this._server=e,this._userName=t,this._userId=n,this._peerId=void 0,this._remotePeerId=void 0,this._remoteUserId=void 0,this._remoteUserName=void 0,this._room=a,this._role=s,0===s&&(this._remoteUserId=n,this._remoteUserName="webrtc2H264"),this._serverUserName=c,this._serverPassword=u,this._token=o,this._bintuApiKey=h,this._hangingGet=void 0,this._pcClient=void 0,this._streams=[],this._transcodingSettings={output:null,streamname:null,videobitrate:null,videowidth:null,videoheight:null,audiobitrate:null,framerate:null,mirror:null,dropframes:null,h264passthrough:null,icecast_audio:null,output2:null,videobitrate2:null,audiobitrate2:null,framerate2:null,rtmpconnectinfo:null},this._startTime=null,this._iceServers=[],this._config={},this._state=void 0,this._setState(r.CHANNEL_IDLE),this._handshakeState=void 0,this._setHandshakeState(r.HANDSHAKE_IDLE),this._messageQueue=[],this._remoteStream=null,this._callActive=!1,this._statsEnabled=!1,this._statsIntervalTime=1e3,this._statsInterval=0,this._rtcStats=null}var o=n.debug_,c=n.warning_,d=n.error_,u=n.success_,h=n.shortenText,l=n.isString,m=n.isInt,p=n.isIntString,f=n.parseJSON,v=n.stringifyJSON,_=n.isObject,g=n.isArray,S=n.encodeURIComponent,C=s.prototype=Object.create(i.prototype);return C.sendMetaData=function(e,t){this.getState()===r.CHANNEL_CALL_ACTIVE?(o("[CM "+this._peerId+"] sending metaData: "+e+" - "+v(t)),this._sendMessageToPeer(this._remotePeerId,{eventType:"metaData",eventName:e,strLabel:this._streams[0].id,payload:t})):d("[CM "+this._peerId+"]Tried to send metaData but channelmember is not in active state")},C.setName=function(e){this._userName=e},C.setRoom=function(e){this._room=e},C.setRemoteUserName=function(e){this._remoteUserName=e},C.setRemoteUserId=function(e){this._remoteUserId=e},C.setIceServers=function(e){this._iceServers=e},C.setConfig=function(e){this._config=e},C.getRemotePeerId=function(){return this._remotePeerId},C.getRemoteUserName=function(){return this._remoteUserName},C.getRemoteUserId=function(){return this._remoteUserId},C.getState=function(){return this._state},C.getRole=function(){return this._role},C.getStreams=function(){return this._streams},C.getPeerId=function(){return this._peerId},C.getRoom=function(){return this._room},C.setTranscodingSettings=function(e){this._role!==r.ROLE_BROADCASTER&&c("[CM "+this._peerId+"] you are setting a transcode-target but role is not 0 (it is "+this._role+")");var t;for(t in e)this._transcodingSettings.hasOwnProperty(t)&&(this._transcodingSettings[t]=e[t])},C._getSignInParams=function(){var e="peer="+this._userId+"_"+this._userName+"_room_"+this._room+"&unique="+this._userId+"&room="+this._room+"&role="+this._role+(this._token?"&token="+this._token:"")+(this._serverUserName?"&username="+this._serverUserName:"")+(this._serverPassword?"&password="+this._serverPassword:"")+(this._bintuApiKey?"&bintu_api_key="+this._bintuApiKey:"");return e},C._getBroadcasterSignInParams=function(){var e,t="";for(e in this._transcodingSettings){var r=this._transcodingSettings[e];null!==r&&((_(r)||l(r))&&(r=S(v(r))),t+="&"+e.toString()+"="+r)}return t+=this._streams[0]&&this._streams[0].id?"&stream_label="+this._streams[0].id:"",t+=this._streams[1]&&this._streams[1].id?"&stream_label2="+this._streams[1].id:"",t+=this._config.codecs.videoCodec?"&videocodec="+this._config.codecs.videoCodec:"VP8",this._streams.length>0&&(t+=this._streams[0].getAudioTracks().length>0?"&audio=1":"&audio=0",t+=this._streams[0].getVideoTracks().length>0?"&video=1":"&video=0"),t},C.signIn=function(e,t){try{var i=this,n=new XMLHttpRequest;n.withCredentials=!0;var a=0;n.onloadstart=function(e){o("SignIn [CM "+i._peerId+"] : XHR loadstart")},n.onloadend=function(e){o("SignIn [CM "+i._peerId+"] : XHR loadend")},n.onerror=function(e){d("SignIn [CM "+i._peerId+"] : XHR error."),i._emitRequestEvent(n,"SignInError","maybe network or server issue!")},n.onabort=function(e){d("SignIn [CM "+i._peerId+"] : XHR aborted."),i._emitRequestEvent(n,"SignInError","Request aborted!")},n.onreadystatechange=function(e){if(0===n.status&&(a++,a<2&&o("SignIn [CM "+i._peerId+"] : http status 0 (unsent) - ok."),a>1&&(c("SignIn [CM "+i._peerId+"] : Server not (yet) up or wrong params passed"),i._emitRequestEvent(n,"SignInError","Server not (yet) up or wrong params passed"))),4===n.readyState)if(403===n.status)d("SignIn [CM "+i._peerId+"] : SignIn Error "+n.status+": "+n.responseText),i._emitRequestEvent(n,"SignInError");else if(509===n.status)n.abort(),i._role===r.ROLE_BROADCASTER?(d("SignIn [CM "+i._peerId+"] : SignIn Error "+n.status+": Could not start broadcast: too many active broadcasts on server."),i._emitRequestEvent(n,"SignInError","Too many active broadcasts on server")):(d("SignIn [CM "+i._peerId+"] : SignIn Error "+n.status+": unknown cause."),i._emitRequestEvent(n,"SignInError"));else if(200===n.status)i._peerId=parseInt(e.currentTarget.response.split(",")[1],10),i._setState(r.CHANNEL_SIGNED_IN),i._initializePeerList(e.currentTarget.response),i._startHangingGet(),u("SignIn [CM "+i._peerId+"] : SignInSuccess"),i.emitSimple("SignInSuccess",{request:n,server:i._server,status:e.currentTarget.status});else{var t="Connect failed for unknown reason";d("SignIn [CM "+i._peerId+"] : SignIn Error "+n.status+": "+t),n.responseText.length>0&&(t=n.responseText,d("[CM "+i._peerId+"] "+t)),i._emitRequestEvent(n,"SignInError",t)}};var s=this._server+"/sign_in?"+i._getSignInParams();this._role===r.ROLE_BROADCASTER&&this._streams.length>0&&(s+=i._getBroadcasterSignInParams()),o("SignIn [CM "+i._peerId+"] : GET: "+s),n.open("GET",s,!0),n.send()}catch(e){d("SignIn [CM "+i._peerId+"] : SignInRequest failed - "+e.message),this._emitRequestEvent(n,"SignInError",e.message)}},C.signOut=function(e){this._setState(r.CHANNEL_IDLE),this._closePCClient(),this._hangingGet&&this._hangingGet.abort();try{var t=new XMLHttpRequest;t.withCredentials=!0;var i=0,n=this;t.onloadstart=function(e){o("SignOut [CM "+n._peerId+"] : XHR loadstart")},t.onloadend=function(e){o("SignOut [CM "+n._peerId+"] : XHR loadend")},t.onerror=function(e){d("SignOut [CM "+n._peerId+"] : XHR error."),n._emitRequestEvent(t,"SignOutError","maybe network or server issue!")},t.onabort=function(e){d("SignOut [CM "+n._peerId+"] : XHR aborted."),n._emitRequestEvent(t,"SignOutError","Request aborted!")},t.onreadystatechange=function(){if(o("SignOut [CM "+n._peerId+"] : XHR Connect state: "+t.status+", "+t.readyState+", "+h(t.responseText)),0===t.status){if(i++,i<2&&o("SignOut [CM "+n._peerId+"] : http status 0 (unsent) - ok."),i>1)return c("SignOut [CM "+n._peerId+"] : Server not (yet) up or wrong params passed"),void n._emitRequestEvent(t,"SignOutError","Server not (yet) up or wrong params passed")}else if(4===t.readyState)if(200===t.status)u("SignOut [CM "+n._peerId+"] : Signed out from server"),n._emitRequestEvent(t,"SignOutSuccess");else if(410===t.status)c("SignOut [CM "+n._peerId+"] : Signed out, but peerserver is disconnected"),n._emitRequestEvent(t,"SignOutSuccess");else{var e="Disconnect failed for unknown reason";d("SignOut [CM "+n._peerId+"] : SignOut Error "+t.status+": "+e),t.responseText.length>0&&(e=t.responseText,d(e)),n._emitRequestEvent(t,"SignOutError",e)}};var a=!e;t.open("GET",this._server+"/sign_out?peer_id="+this._peerId,a),t.send()}catch(e){d("SignOut [CM "+n._peerId+"] : SignOutRequest failed - "+e.message),this._emitRequestEvent(t,"SignOutError",e.message)}finally{this._setState(r.CHANNEL_IDLE)}},C._addEventPayload=function(e){return e=e||{},e.target=this,e.data=e.data||{},e.data.remoteUserName=this._remoteUserName,e.data.remoteUserId=this._remoteUserId,e},C._emitRequestEvent=function(e,t,r){this.emitSimple(t,{request:e,server:this._server,status:e.status,text:r||e.responseText})},C.enableStats=function(e,t){this._statsEnabled="undefined"==typeof e||e,this._statsIntervalTime=t||1e3,this._rtcStats=null,this._statsEnabled&&(this._rtcStats=new a,this._rtcStats.on("ReceivedWebRTCStats",this._reemit.bind(this)))},C.preparePeerConnection=function(){this._pcClient||this._createPCClient()},C.invokeCall=function(e){if(this._handshakeState!==r.HANDSHAKE_DONE){if(!m(e))return void d("[CM "+this._peerId+"] remotePeerId must be set and must be an integer!");if(this._state>r.CHANNEL_HANDSHAKE)return c("[CM "+this._peerId+"] invokeCall: state should be SIGNED_IN or HANDSHAKE --> return"),void this._reportState();this._reportState(),this._remotePeerId=e,this._handshakeState===r.HANDSHAKE_IDLE?this._doHandshake():c("[CM "+this._peerId+"] invokeCall: we are still doing an handshake --> return!")}},C._doHandshake=function(){this._setState(r.CHANNEL_HANDSHAKE),this._setHandshakeState(r.HANDSHAKE_CALLYOU),this._onSignalingMessage({data:{type:"callyou"}}),this.emitSimple("GetBusy"),this.emitSimple("Handshake",{remotePeerId:this._remotePeerId},this)},C.doCall=function(){this._handshakeState===r.HANDSHAKE_CALLYOU&&(this._setHandshakeState(r.HANDSHAKE_DONE),this.preparePeerConnection(),this._pcClient.startAsCaller(null),this._setState(r.CHANNEL_CALLING))},C.answerCall=function(){var e=this;return new Promise(function(t,i){if(!e._remotePeerId){var n="No remote peer set!";d(n),i(n)}if(e._state!==r.CHANNEL_CALL_INCOMING){e._reportState();var n="No call incoming!";d(n),i(n)}t(e._reportState())}).then(function(){e.preparePeerConnection(),e._pcClient.startAsCallee(e._messageQueue),e._setState(r.CHANNEL_CALL_NEGOTIATING)}).catch(function(t){throw new Error("[CM "+e._peerId+"] "+t)})},C._getPeerConnectionConfig=function(){var e={iceServers:this._iceServers,iceTransports:"all"},t={optional:[],mandatory:[]};t.optional.push({googCpuOveruseDetection:!1}),t.optional.push({RtpDataChannels:!1});var i={mediaConstraints:{audio:!0,video:!0},sdpPatches:this._config.sdpPatches,peerConnectionConfig:e,peerConnectionConstraints:t,send:0!==this._streams.length,receive:this._role!==r.ROLE_BROADCASTER,videoSendCodec:this._config.codecs.videoCodec||"VP8",videoRecvCodec:this._config.codecs.videoCodec||"VP8",videoSendBitrate:this._config.bitrates.videoSendBitrate||0,videoSendInitialBitrate:this._config.bitrates.videoSendInitialBitrate||0};return i},C._createPCClient=function(){function e(e,t){o("Callstats Monitoring status: "+e+" msg: "+t)}if(this._pcClient)return void o("[CM "+this._peerId+"] PeerConnection still alive, do not create!");try{if(this._pcClient=new t(this._getPeerConnectionConfig(),this._startTime),"object"==typeof callstats&&callstats&&callstats.fabricUsage)try{var r=callstats.fabricUsage.multiplex,i=this._remoteUserName,n=this._userName+"-"+this._remoteUserName+"_"+this._peerId+"_"+this._userId+"__"+this._remotePeerId+"_"+this._remoteUserId+"_"+this._room;callstats.addNewFabric(this._pcClient._pc,i,r,n,e)}catch(e){c("Error in callstats")}this._pcClient.on("ReceivedRtmpStatus",this._reemit.bind(this)),this._pcClient.on("SignalingStateChanged",this._onSignalingStateChanged.bind(this)),this._pcClient.on("SignalingMessage",this._onSignalingMessage.bind(this)),this._pcClient.on("PeerConnectionCreated",this._reemit.bind(this)),this._pcClient.on("PeerConnectionClosed",this._reemit.bind(this)),this._pcClient.on("PeerConnectionError",this._reemit.bind(this)),this._pcClient.on("RemoteSDPSet",this._reemit.bind(this)),this._pcClient.on("RemoteStreamRemoved",this._onRemoteStreamRemoved.bind(this)),this._pcClient.on("RemoteStreamAdded",this._onRemoteStreamAdded.bind(this)),this._pcClient.on("RemoteHangUp",this._onRemoteHangUp.bind(this)),this._pcClient.on("NewIceCandidate",this._reemit.bind(this)),this._pcClient.on("IceConnectionStateChange",this._onIceConnectionStateChange.bind(this)),this._pcClient.on("NegotiationNeeded",this._onNegotiationNeeded.bind(this));for(var a=0;a<this._streams.length;a++)this._pcClient.addStream(this._streams[a]);u("Created PeerConnectionClient"),this.emitSimple("CreatePeerConnectionClientSuccess",{streams:this._streams})}catch(e){d("[CM "+this._peerId+"] Create PeerConnection exception: "+e.message),this.emitSimple("CreatePeerConnectionClientError")}},C._setState=function(e){var t=this._state;this._state=e,this._reportState(!0,t),this.emitSimple("CallState",{state:this._state},this)},C._reportState=function(e,t){var i=e&&this._state!==t?t?"changed state ":"set state ":"report state ";for(var n in r)if(n.indexOf("CHANNEL_")!==-1&&r[n]===this._state){if(e)for(var a in r)a.indexOf("CHANNEL_")!==-1&&r[a]===t&&(i+='from "'+a+'" to "');o("[CM "+this._peerId+"] "+this._buildStateText(i,n));break}},C._setHandshakeState=function(e){this._handshakeState=e;var t="set handshake state ";for(var i in r)if(i.indexOf("HANDSHAKE_")!==-1&&r[i]===this._handshakeState){o("[CM "+this._peerId+"] "+this._buildStateText(t,i));break}},C._buildStateText=function(e,t){return e+='"'+t+'": (we:',e+=this._userName?" "+this._userName:" ",e+=this._userId?" "+this._userId:" ",e+=this._peerId?" "+this._peerId:" ",e+=")",(this._state>2||this._remotePeerId)&&(e+=" with (remote:",e+=this._remoteUserName?" "+this._remoteUserName:" ",e+=this._remoteUserId?" "+this._remoteUserId:" ",e+=this._remotePeerId?" "+this._remotePeerId:" ",e+=")"),e},C._reemit=function(e){e=this._addEventPayload(e),this.emit(e.name,e)},C._onSignalingStateChanged=function(e){o("[CM "+this._peerId+"] sigstate: "+e.data.state),e=this._addEventPayload(e),this.emit(e.name,e)},C._onIceConnectionStateChange=function(e){switch(e=this._addEventPayload(e),e.data.state){case"new":break;case"checking":break;case"connected":this._setCallActive(e);break;case"completed":this._setCallActive(e);break;case"failed":this._setState(r.CHANNEL_CALL_DROPPED),e.name="CallDropped",this.emit(e.name,e);break;case"disconnected":this._setState(r.CHANNEL_CALL_UNSTABLE),e.name="CallUnstable",this.emit(e.name,e);break;case"closed":}},C._onNegotiationNeeded=function(e){this.emit(e.name,e)},C._onRemoteStreamAdded=function(e){this._remoteStream=e.data.stream},C._onRemoteStreamRemoved=function(e){this._remoteStream=null},C._setCallActive=function(e){if(this._state!==r.CHANNEL_CALL_ACTIVE){if(this._callActive)return this._setState(r.CHANNEL_CALL_ACTIVE),e.name="CallAgainStable",void this.emit(e.name,e);this._setState(r.CHANNEL_CALL_ACTIVE),this._callActive=!0,(navigator.mozGetUserMedia||navigator.webkitGetUserMedia)&&this._statsEnabled&&this._pcClient&&this._collectRtcStats(),this.emitSimple("CallActive",{remoteUserName:this._remoteUserName,remoteUserId:this._remoteUserId},this),null!==this._remoteStream&&(e.name="RemoteStreamAdded",e.data.stream=this._remoteStream,this.emit(e.name,e))}},C._collectRtcStats=function(){var e=this;clearInterval(e._statsInterval),this._statsInterval=setInterval(function(){return e._pcClient?void e._pcClient.getStats().then(function(t){e._rtcStats||(e._rtcStats=new a),e._rtcStats.putReport(t)}).catch(function(t){d("[CM "+e._peerId+"] "+t)}):void clearInterval(e._statsInterval)},this._statsIntervalTime)},C._closePCClient=function(){if(this._pcClient){var e,t,r=this._streams;for(e=0,t=r.length;e<t;++e)try{this._pcClient.removeStream(r[e])}catch(e){d("[CM "+this._peerId+"] Could not remove stream from peerconnectionclient")}this._pcClient.close(),this._pcClient=null}},C.addStream=function(e){return e?2===this._streams.length?void c("[CM "+this._peerId+"] stream count is already=2, we only support 2 streams/ChannelMember"):void(g(e)?this._streams=e:this._streams.push(e)):void d("[CM "+this._peerId+'] parameter "stream" must not be undefined')},C.removeStreams=function(){for(var e=0,t=this._streams.length;e<t;e++)this._streams[e]=null;this._streams=[]},C._initializePeerList=function(e){if(this._role!==r.ROLE_BROADCASTER){var t=[],i=e.split("\n");if(1===i.length)return null;for(var n,a=0;a<i.length;a++)0!==i[a].length&&(n=i[a].split(","),t.push({id:parseInt(n[1],10),name:n[0]}));this.emitSimple("PeerListUpdated",{userlist:t},this)}},C._updatePeerEntry=function(e,t,i){this._state===r.CHANNEL_SIGNED_IN&&this.emitSimple("PeerEntryUpdated",{remotePeerName:e,remotePeerId:t,connected:i},this)},C._parseReceivedServerNotification=function(e,t,r){return this._peerId===t?void c("[CM "+this._peerId+"] handleServerConnect: cannot connect to myself "+e+", id "+t):(this._reportState(),t===this._remotePeerId&&0===r&&(c("[CM "+this._peerId+"] Our remote peer "+this._remotePeerId+" ("+this._remoteUserName+" "+this._remoteUserId+") is disconnected"),this.emitSimple("RemotePeerDisconnected",{remoteUserName:this._remoteUserName,remoteUserId:this._remoteUserId},this)),void this._updatePeerEntry(e,t,r))},C._onReceivedServerNotification=function(e){410===e.data.status&&(e.data.response=""+this.getRemoteUserId()+"_"+this.getRemoteUserName()+"_room_"+this.getRoom()+","+this.getRemotePeerId()+",0");var t=e.data.response;o("[MSG RECV NOTIFY "+this._peerId+"] Message from server: "+t);var r=t.split(","),i=r[0],n=parseInt(r[1],10),a=parseInt(r[2],10);this._parseReceivedServerNotification(i,n,a)},C._startHangingGet=function(t,r){this._startTime=window.performance.now(),this._hangingGet=new e(this._server,this._peerId),this._hangingGet.on("HangingGetServerStatus",this._onHangingGetServerStatus.bind(this)),this._hangingGet.on("ReceivedServerMessage",this._onReceivedServerMessage.bind(this)),this._hangingGet.on("ReceivedServerNotification",this._onReceivedServerNotification.bind(this)),this._hangingGet.on("HangingGetError",this._onHangingGetError.bind(this)),
this._hangingGet.start()},C._onHangingGetError=function(e){e=this._addEventPayload(e),o("[MSG RECV ERROR "+this._peerId+"] HangingGet error!"),this.emit(e.name,e)},C._onHangingGetServerStatus=function(e){e=this._addEventPayload(e),o("[MSG RECV STATUS "+this._peerId+"] HangingGet Server Status changed!"),this.emit(e.name,e)},C._onReceivedServerMessage=function(e){if(this._state!==r.CHANNEL_CALL_REJECTED){var t=e.data.peerId,i=e.data.response;if(isNaN(t)||0===t)return void c("[MSG RECV CM "+this._peerId+"] Invalid Message (no peerid): "+i);if(o("[MSG RECV CM "+this._peerId+"] from "+t+(this._debug?": "+i:"")),this._remotePeerId&&t!==this._remotePeerId)return o("[MSG RECV CM "+this._peerId+"] from "+t+(this._debug?": "+i:"")+", but its not our remote!"),void this._onSignalingMessage({data:{type:"callbusy",otherId:t}});switch(this._remotePeerId||this.emitSimple("GetBusy"),o("[CM "+this._peerId+"] "+i),i=f(i),i.userId&&(this._remoteUserId=i.userId),i.userName&&(this._remoteUserName=i.userName),this._remotePeerId=i.peerId||t,i.type){case"callbusy":return this._setState(r.CHANNEL_CALL_REJECTED),e=this._addEventPayload(),e.name="CallRejected",void this.emit(e.name,e);case"callyou":if(this._state>r.CHANNEL_HANDSHAKE)break;this._setState(r.CHANNEL_HANDSHAKE),this._remotePeerId=t;var a=this._handshakeState!==r.HANDSHAKE_IDLE&&this._remotePeerId<this._peerId,s="Firefox"===i.agent&&"Firefox"!==n.browserInfo.browser;return void(a||s?(this._setHandshakeState(r.HANDSHAKE_CALLYOU),e=this._addEventPayload(),e.name="CallHandshakeWon",e.data.remotePeerId=this._remotePeerId,this.emit(e.name,e)):(this._setHandshakeState(r.HANDSHAKE_CALLME),this._onSignalingMessage({data:{type:"callme"}})));case"callme":if(this._state>r.CHANNEL_HANDSHAKE)break;return void(this._handshakeState!==r.HANDSHAKE_DONE&&(this._setState(r.CHANNEL_HANDSHAKE),this._setHandshakeState(r.HANDSHAKE_CALLYOU),this._remotePeerId=t,e=this._addEventPayload(),e.name="CallHandshakeWon",e.data.remotePeerId=this._remotePeerId,this.emit(e.name,e)))}if(this._state<=r.CHANNEL_HANDSHAKE)return o("[CM "+this._peerId+"] We are being called!"),this._messageQueue.push(i),this._setState(r.CHANNEL_CALL_INCOMING),void this.emitSimple("CallIncoming",{remoteUserName:this._remoteUserName,remoteUserId:this._remoteUserId},this);if(this._state===r.CHANNEL_CALL_INCOMING)return o("[CM "+this._peerId+"] We have an incoming call and answer now!"),this._messageQueue.push(i),void this._reportState();if(this._state===r.CHANNEL_CALLING){if("offer"===i.type)return void c("[CM "+this._peerId+"] We have an offer, but we should receive an answer!");o("We are calling and the other side answer us!"),this._setState(r.CHANNEL_CALL_NEGOTIATING)}this._pcClient&&this._pcClient.receiveSignalingMessage(i)}},C._restartHangingGet=function(){this._hangingGet.restart()},C._sendMessageToPeer=function(e,t){var r=this._server+"/message?peer_id="+this._peerId+"&to="+e,i=new XMLHttpRequest;i.withCredentials=!0,i.open("POST",r,!0),i.setRequestHeader("Content-Type","text/plain");var n=v(t);o("[MSG SEND CM "+this._peerId+"] -> peer "+e+": "+n);var a=this;i.onload=function(e){410===i.status&&(_debug("Remote peer has disconnected, signing out"),a.signOut())},i.send(n)},C._onSignalingMessage=function(e){if(o("[MSG RECV SIGNAL CM "+this._peerId+"]"),!this._remotePeerId)return void d("Trying to send message, but no remote peer set! This should not happen!");e.data.agent=n.browserInfo.browser,e.data.userName=this._userName,e.data.userId=this._userId,e.data.peerId=this._peerId;var t=e.data.otherId||this._remotePeerId;this._sendMessageToPeer(t,e.data)},C._onRemoteHangUp=function(){this.emitSimple("RemoteHangup",{remotePeerID:this._remotePeerId,remotePeerName:this._remoteUserName}),this._closePCClient(),this._restartHangingGet()},s}.apply(t,i),!(void 0!==n&&(e.exports=n))},function(e,t,r){var i,n;i=[r(6),r(5)],n=function(e,t){"use strict";function r(t,r){e.call(this),this._prefix="[MSG CM "+r+" HangingGet] ",s(t)||a(this._prefix+"param server must be of type string",2),o(r)||a(this._prefix+"param id must be an integer",2),this._server=t,this._peerId=r,this._callUrl=t+"/wait?peer_id="+this._peerId,this._aborted=!1,this._request=void 0,this._errorCount=0,this._lastErrorTime=0,this._connectRetries=0,this._lastConnectRetryTime=0}var i=t.debug_,n=t.warning_,a=t.error_,s=t.isString,o=t.isInt,c=2500,d=10,u=5,h=r.prototype=Object.create(e.prototype);return h.start=function(){this._aborted||(this._request=new XMLHttpRequest,this._request.withCredentials=!0,this._listenToRequest(),i(this._prefix+this._callUrl),this._request.open("GET",this._callUrl,!0),this._request.timeout=6e4,this._request.send())},h.abort=function(){this._request&&this._request.abort(),this._aborted=!0,this._request=void 0},h.restart=function(){var e=this;window.setTimeout(function(){e.start()},100)},h._onReadyStateChange=function(){if(this._request&&4===this._request.readyState){var e=this._request.status;switch(e){case 0:return;case 200:this._errorCount=0;break;case 410:return n(this._prefix+"Warning "+e+" from server: peer gone..."),void this.emitSimple("ReceivedServerNotification",{status:e});case 504:n(this._prefix+"Warning "+e+" from server: gateway timeout... ignoring...");break;default:n(this._prefix+"Warning "+e+" from server: "+this._request.statusText),this.emitSimple("HangingGetServerStatus",{request:this._request,server:this._server,status:e,text:this._request.statusText})}var t=this._readResponseHeader("Pragma");if(0===t){var r=(new Date).getTime(),s=r-this._lastConnectRetryTime;if(this._lastConnectRetryTime=r,s<c&&(this._connectRetries++,i(this._prefix+"XHR result error - increasing error counter. retries="+this._connectRetries+" t="+s)),this._connectRetries>d)return a(this._prefix+"XHR result error - invalid response - stopping (maxRetries reached)"),void this.emitSimple("HangingGetError",{request:this._request,server:this._server,status:e,text:"Server not (yet) up"});n(this._prefix+"XHR result error - invalid response - but retrying - "+this._connectRetries+" t="+s)}else t===this._peerId?(this._connectRetries=0,this.emitSimple("ReceivedServerNotification",{response:this._request.responseText,status:e})):(this._connectRetries=0,this.emitSimple("ReceivedServerMessage",{response:this._request.responseText,peerId:t}));this.restart()}},h._onError=function(e){if(this._request){var t=!0;try{n(this._prefix+" XHR hanging error."+e);var r=e.timeStamp,s=r-this._lastErrorTime;if(this._lastErrorTime=r,s<c&&(i(this._prefix+" XHR hanging error - increasing error counter. "+this._errorCount+" t="+s),this._errorCount++),this._errorCount>u){var o="XHR too many errors, disconnecting.";a(this._prefix+o),this.emitSimple("HangingGetError",{request:this._request,server:this._server,status:e,text:o}),t=!1}}catch(r){a(this._prefix+"Error in request.onerror: "+r),this.emitSimple("HangingGetError",{request:this._request,server:this._server,status:e,text:"Error in request.onerror: "+r}),t=!1}if(t){var d=this;setTimeout(function(){d._errorCount>0&&i(d._prefix+"XHR restart... "+d._errorCount+" t="+d.diff),d.start()},1e3)}}},h._listenToRequest=function(){if(!this._request)return void a(this._prefix+" Request not initialized!");var e=this;this._request.onreadystatechange=function(t){e._onReadyStateChange()},this._request.onerror=function(t){e._onError(t)},this._request.ontimeout=function(t){i(this._prefix+"XHR hanging timeout with status="+t+". retrying..."),e.start()},this._request.onabort=function(e){i(this._prefix+"XHR hanging aborted with status="+e)},this._request.onprogress=function(e){},this._request.onloadstart=function(e){},this._request.onloadend=function(e){}},h._readResponseHeader=function(e){var t=this._request.getResponseHeader(e);return null===t||0===t.length||isNaN(t)?0:parseInt(t,10)},r}.apply(t,i),!(void 0!==n&&(e.exports=n))},function(e,t,r){var i,n;i=[r(14),r(6),r(5),r(16)],n=function(e,t,r,i){"use strict";function n(e,r){t.call(this),a("Creating RTCPeerConnnection with:\n  config: '"+d(e.peerConnectionConfig)+"';\n  constraints: '"+d(e.peerConnectionConstraints)+"'."),this._params=e,this._startTime=r,this._pc=null,this._hasRemoteSdp=!1,this._messageQueue=[],this._isInitiator=!1,this._started=!1,this._passThrough=!1,this.create()}var a=r.debug_,s=r.error_,o=r.success_,c=r.parseJSON,d=r.stringifyJSON,u=r.isFunction,h={offerToReceiveAudio:!0,offerToReceiveVideo:!0},l=n.prototype=Object.create(t.prototype);return l.isStarted=function(){return this._started},l.isInitiator=function(){return this._isInitiator},l._reset=function(){this._pc=null,this._hasRemoteSdp=!1,this._messageQueue=[],this._isInitiator=!1,this._started=!1,this._passThrough=!1},l.create=function(){this.close();try{this._pc=new RTCPeerConnection(this._params.peerConnectionConfig,this._params.peerConnectionConstraints),this._pc.onicecandidate=this._onIceCandidate.bind(this),this._pc.ontrack=this._onRemoteStreamAdded.bind(this),this._pc.onremovestream=this._onRemoteStreamRemoved.bind(this),this._pc.onsignalingstatechange=this._onSignalingStateChanged.bind(this),this._pc.oniceconnectionstatechange=this._onIceConnectionStateChanged.bind(this),this._pc.onnegotiationneeded=this._onNegotiationNeeded.bind(this),a("PeerConnectionCreated"),this.emitSimple("PeerConnectionCreated")}catch(e){this._onError("CreatePeerConnection",e)}},l.close=function(){this._pc&&(this._pc.close(),this._reset(),o("Peer connection closed"),this.emitSimple("PeerConnectionClosed"))},l.addStream=function(e){this._pc&&this._pc.addStream(e)},l.removeStream=function(e){var t,r,i;if(this._pc)if(u(this._pc.removeTrack)&&u(this._pc.getSenders)){var n=e.getTracks(),a=this._pc.getSenders();for(t=0,i=a.length;t<i;++t)for(r=0,i=n.length;r<i;++r)a[t].track===n[r]&&this._pc.removeTrack(a[t])}else u(this._pc.removeStream)&&this._pc.removeStream(e)},l.startAsCaller=function(e){if(this._pc&&!this._started){this._isInitiator=!0,this._started=!0;var t=this._buildConstraints(e);a("Sending offer to peer with constraints: \n'"+d(t)+"'.");var r=this;this._pc.createOffer(t).then(function(e){r._setLocalSdpAndNotify(e)}).catch(function(e){r._onError("createAnswer",e)})}},l.startAsCallee=function(e){var t,r;if(this._pc&&!this._started)if(this._isInitiator=!1,this._started=!0,e&&e.length>0)for(t=0,r=e.length;t<r;t++)this.receiveSignalingMessage(e[t]);else this._messageQueue.length>0&&this._drainMessageQueue()},l.receiveSignalingMessage=function(e){var t=c(e);if(t){if((this._isInitiator||this._passThrough)&&"answer"===t.type||(!this._isInitiator||this._passThrough)&&"offer"===t.type)this._hasRemoteSdp=!0,this._messageQueue.unshift(t);else if(t.candidate)this._messageQueue.push(t);else if("bye"===t.type)this.emitSimple("RemoteHangUp"),this._started=!1;else if(t.rtmp)return t.text=t.message,t.status&&t.number||(t.status="unknown",t.number=0),void this.emitSimple("ReceivedRtmpStatus",t);this._drainMessageQueue()}},l.getStats=function(){if(!this._pc)return Promise.reject(new Error("No PeerConnection"));var e;if(u(this._pc.getSenders)){var t=this._pc.getSenders().filter(function(e){return"video"===e.track.kind});t&&t.length&&(e=t[0].track)}else{var r,i=this._pc.getRemoteStreams();i&&i.length&&(r=i[0].getVideoTracks(),r.length&&(e=r[0]))}return e?this._pc.getStats(e):Promise.reject(new Error("Could not call getStats on PeerConnection. No video track available"))},l._doAnswer=function(){var e=this._buildConstraints();a("Sending answer to peer with constraints: "+d(e,null," "));var t=this;this._pc.createAnswer(e).then(function(e){t._setLocalSdpAndNotify(e)}).catch(function(e){t._onError("createAnswer",e)})},l._modifySDPFirefoxAnswer=function(e){if("Firefox"===r.browserInfo.browser&&e.indexOf("a=msid-semantic:WMS *")>0){var t,i=e.split("\r\n"),n="",s=-1,o="";["video","audio"].forEach(function(e){for(t=0,o="";t<i.length;t++)if(o){if(0===i[t].indexOf("a=ssrc:")){var r=i[t].split(":")[1].split(" ")[0];i.splice(t+1,0,"a=ssrc:"+r+" msid:"+n+" "+o,"a=ssrc:"+r+" mslabel:default","a=ssrc:"+r+" label:"+o);break}if(0===i[t].indexOf("a=mid:"))break}else if(0===i[t].indexOf("a=msid:")&&t>0&&0===i[t-1].indexOf("a=mid:"+e)){var a=i[t].split(":")[1].split(" ");n=a[0],o=a[1],s=!0}}),e=i.join("\r\n"),a("Parsed answer SDP for firefox")}return e},l._setLocalSdpAndNotify=function(e){try{this._params.sdpPatches&&!this._params.sdpPatches.preventReplaceSendReceive&&(e.sdp=this._replaceSendReceive(e.sdp,this._params.send,this._params.receive)),e.sdp=maybePreferVideoReceiveCodec(e.sdp,this._params)}catch(e){a("_setLocalSdpAndNotify: error: "+e)}var t=this;this._pc.setLocalDescription(e).then(function(){a("Set session description success.")}).catch(function(e){t._onError("setLocalDescription",e)}),this.emitSimple("SignalingMessage",{sdp:e.sdp,type:e.type})},l._buildConstraints=function(e){return mergeConstraints(e,h)},l._setRemoteSdp=function(e){e.sdp=maybePreferVideoReceiveCodec(e.sdp,this._params),e.sdp=maybePreferVideoSendCodec(e.sdp,this._params),this._params.videoSendBitrate&&(e.sdp=maybeSetVideoSendBitRate(e.sdp,this._params)),this._params.videoSendInitialBitrate&&(e.sdp=maybeSetVideoSendInitialBitRate(e.sdp,this._params)),this._pc.setRemoteDescription(new RTCSessionDescription(e)).then(this._onSetRemoteDescriptionSuccess.bind(this)).catch(this._onError.bind(this,"setRemoteDescription"))},l._onSetRemoteDescriptionSuccess=function(){var e,t;if(u(this._pc.getReceivers)){var r=this._pc.getReceivers().filter(function(e){return"video"===e.track.kind||"audio"===e.track.kind});r&&r.length&&(e=!0)}else t=this._pc.getRemoteStreams(),e=t.length&&t[0].getVideoTracks().length;a("Set remote session description success"),this.emitSimple("RemoteSDPSet",{hasremotetrack:e,remotestreams:t})},l._drainMessageQueue=function(){var e,t;if(this._pc&&this._started&&this._hasRemoteSdp){for(e=0,t=this._messageQueue.length;e<t;e++)this._processSignalingMessage(this._messageQueue[e]);this._messageQueue=[]}},l._processSignalingMessage=function(e){if(a("MSG:"),a(e),"offer"!==e.type||this._isInitiator&&!this._passThrough)if("answer"===e.type&&(this._isInitiator||this._passThrough)){if("have-local-offer"!==this._pc.signalingState)return void a("MSG: ERROR: remote answer received in unexpected state: "+this._pc.signalingState);this._setRemoteSdp(e)}else if(e.candidate||"candidate"===e.type){a("MSG: new ice candidate");var t=new RTCIceCandidate({sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid,candidate:e.candidate});this._recordIceCandidate("Remote",t);var r=this;this._pc.addIceCandidate(t).then(function(){a("MSG: Remote candidate added successfully.")}).catch(function(e){r._onError("addIceCandidate",e)})}else a("WARNING: MSG: unexpected message: "+d(e));else{if(a("MSG: new ice offer"),"stable"!==this._pc.signalingState)return void a("ERROR: remote offer received in unexpected state: "+this._pc.signalingState);this._setRemoteSdp(e),this._doAnswer()}},l._onIceCandidate=function(e){var t=e.candidate;return t?void(this._isValidIceCandidate(t)&&(this.emitSimple("SignalingMessage",{sdpMLineIndex:t.sdpMLineIndex,sdpMid:t.sdpMid,candidate:t.candidate}),this._recordIceCandidate("Local",t))):void a("End of candidates.")},l._isValidIceCandidate=function(e){var t=e.candidate;return t.indexOf("tcp")===-1&&("relay"!==this._params.peerConnectionConfig.iceTransports||"relay"===iceCandidateType(t))},l._onSignalingStateChanged=function(){return!!this._pc&&(a("Signaling state changed to: "+this._pc.signalingState),void this.emitSimple("SignalingStateChanged",{state:this._pc.signalingState}))},l._onIceConnectionStateChanged=function(){return!!this._pc&&("completed"===this._pc.iceConnectionState&&a("ICE complete time: "+(window.performance.now()-this._startTime).toFixed(0)+"ms."),a("ICE connection state changed to: "+this._pc.iceConnectionState),void this.emitSimple("IceConnectionStateChange",{state:this._pc.iceConnectionState}))},l._onNegotiationNeeded=function(e){return!!this._pc&&(a("NegotiationNeeded Event"),void this.emitSimple("NegotiationNeeded",e))},l._recordIceCandidate=function(e,t){a("New ICE candidate for "+e),this.emitSimple("NewIceCandidate",{location:e,candidate:t})},l._onRemoteStreamAdded=function(e){a("Remote stream added to peer connection"),this.emitSimple("RemoteStreamAdded",{stream:e.streams[0]})},l._onRemoteStreamRemoved=function(e){a("Remote stream removed from peer connection"),this.emitSimple("RemoteStreamRemoved",{stream:e.stream})},l._onError=function(e,t){s('Error in "'+e+'": '+t.toString()),this.emitSimple("PeerConnectionError",{tag:e,error:t.toString()})},l._replaceSendReceive=function(e,t,r){var i,n,a="";t&&r?a="a=sendrecv":t?a="a=sendonly":r&&(a="a=recvonly");var s,o=e.split("\r\n");for(i=0,n=o.length;i<n;i++)s=o[i],s.indexOf("a=sendrecv")===-1&&s.indexOf("a=sendonly")===-1&&s.indexOf("a=recvonly")===-1||(o[i]=a);return o.join("\r\n")},n}.apply(t,i),!(void 0!==n&&(e.exports=n))},function(e,t,r){var i,n;i=[r(15)],n=function(e){window.trace=function(e){if("\n"===e[e.length-1]&&(e=e.substring(0,e.length-1)),window.performance){var t=(window.performance.now()/1e3).toFixed(3);console.log(t+": "+e)}else console.log(e)}}.apply(t,i),!(void 0!==n&&(e.exports=n))},function(e,t){"use strict";window.mergeConstraints=function(e,t){if(!e||!t)return e||t;var r=e;for(var i in t)r[i]=t[i];return r},window.iceCandidateType=function(e){return e.split(" ")[7]},window.formatTypePreference=function(e){if("chrome"===adapter.browserDetails.browser)switch(e){case 0:return"TURN/TLS";case 1:return"TURN/TCP";case 2:return"TURN/UDP"}else if("firefox"===adapter.browserDetails.browser)switch(e){case 0:return"TURN/TCP";case 5:return"TURN/UDP"}return""},window.maybeSetOpusOptions=function(e,t){return"true"===t.opusStereo?e=setCodecParam(e,"opus/48000","stereo","1"):"false"===t.opusStereo&&(e=removeCodecParam(e,"opus/48000","stereo")),"true"===t.opusFec?e=setCodecParam(e,"opus/48000","useinbandfec","1"):"false"===t.opusFec&&(e=removeCodecParam(e,"opus/48000","useinbandfec")),"true"===t.opusDtx?e=setCodecParam(e,"opus/48000","usedtx","1"):"false"===t.opusDtx&&(e=removeCodecParam(e,"opus/48000","usedtx")),t.opusMaxPbr&&(e=setCodecParam(e,"opus/48000","maxplaybackrate",t.opusMaxPbr)),e},window.maybeSetAudioSendBitRate=function(e,t){return t.audioSendBitrate?(trace("Prefer audio send bitrate: "+t.audioSendBitrate),preferBitRate(e,t.audioSendBitrate,"audio")):e},window.maybeSetAudioReceiveBitRate=function(e,t){return t.audioRecvBitrate?(trace("Prefer audio receive bitrate: "+t.audioRecvBitrate),preferBitRate(e,t.audioRecvBitrate,"audio")):e},window.maybeSetVideoSendBitRate=function(e,t){return t.videoSendBitrate?(trace("Prefer video send bitrate: "+t.videoSendBitrate),preferBitRate(e,t.videoSendBitrate,"video")):e},window.maybeSetVideoReceiveBitRate=function(e,t){return t.videoRecvBitrate?(trace("Prefer video receive bitrate: "+t.videoRecvBitrate),preferBitRate(e,t.videoRecvBitrate,"video")):e},window.preferBitRate=function(e,t,r){var i=e.split("\r\n"),n=findLine(i,"m=",r);if(null===n)return trace("Failed to add bandwidth line to sdp, as no m-line found"),e;var a=findLineInRange(i,n+1,-1,"m=");null===a&&(a=i.length);var s=findLineInRange(i,n+1,a,"c=");if(null===s)return trace("Failed to add bandwidth line to sdp, as no c-line found"),e;var o=findLineInRange(i,s+1,a,"b=AS");o&&i.splice(o,1);var c="b=AS:"+t;return i.splice(s+1,0,c),e=i.join("\r\n")},window.maybeSetVideoSendInitialBitRate=function(e,t){var r=t.videoSendInitialBitrate;if(!r)return e;var i=r,n=t.videoSendBitrate;n&&(r>n&&(trace("Clamping initial bitrate to max bitrate of "+n+" kbps."),r=n,t.videoSendInitialBitrate=r),i=n);var a=e.split("\r\n"),s=findLine(a,"m=","video");if(null===s)return trace("Failed to find video m-line"),e;var o=t.videoRecvCodec;return e=setCodecParam(e,o,"x-google-min-bitrate",t.videoSendInitialBitrate.toString()),e=setCodecParam(e,o,"x-google-max-bitrate",i.toString())},window.removePayloadTypeFromMline=function(e,t){e=e.split(" ");for(var r=0;r<e.length;++r)e[r]===t.toString()&&e.splice(r,1);return e.join(" ")},window.removeCodecByName=function(e,t){var r=findLine(e,"a=rtpmap",t);if(null===r)return e;var i=getCodecPayloadTypeFromLine(e[r]);e.splice(r,1);var n=findLine(e,"m=","video");return null===n?e:(e[n]=removePayloadTypeFromMline(e[n],i),e)},window.removeCodecByPayloadType=function(e,t){var r=findLine(e,"a=rtpmap",t.toString());if(null===r)return e;e.splice(r,1);var i=findLine(e,"m=","video");return null===i?e:(e[i]=removePayloadTypeFromMline(e[i],t),e)},window.maybeRemoveVideoFec=function(e,t){if("false"!==t.videoFec)return e;var r=e.split("\r\n"),i=findLine(r,"a=rtpmap","red");if(null===i)return e;var n=getCodecPayloadTypeFromLine(r[i]);if(r=removeCodecByPayloadType(r,n),r=removeCodecByName(r,"ulpfec"),i=findLine(r,"a=fmtp",n.toString()),null===i)return e;var a=parseFmtpLine(r[i]),s=a.pt;return null===s?e:(r.splice(i,1),r=removeCodecByPayloadType(r,s),r.join("\r\n"))},window.maybePreferAudioSendCodec=function(e,t){return maybePreferCodec(e,"audio","send",t.audioSendCodec)},window.maybePreferAudioReceiveCodec=function(e,t){return maybePreferCodec(e,"audio","receive",t.audioRecvCodec)},window.maybePreferVideoSendCodec=function(e,t){return maybePreferCodec(e,"video","send",t.videoSendCodec)},window.maybePreferVideoReceiveCodec=function(e,t){return maybePreferCodec(e,"video","receive",t.videoRecvCodec)},window.maybePreferCodec=function(e,t,r,i){var n=t+" "+r+" codec";if(!i)return trace("No preference on "+n+"."),e;trace("Prefer "+n+": "+i);var a=e.split("\r\n"),s=findLine(a,"m=",t);if(null===s)return e;var o=getCodecPayloadType(a,i);return o&&(a[s]=setDefaultCodec(a[s],o)),e=a.join("\r\n")},window.setCodecParam=function(e,t,r,i){var n=e.split("\r\n"),a=findFmtpLine(n,t),s={};if(null===a){var o=findLine(n,"a=rtpmap",t);if(null===o)return e;var c=getCodecPayloadTypeFromLine(n[o]);s.pt=c.toString(),s.params={},s.params[r]=i,n.splice(o+1,0,writeFmtpLine(s))}else s=parseFmtpLine(n[a]),s.params[r]=i,n[a]=writeFmtpLine(s);return e=n.join("\r\n")},window.removeCodecParam=function(e,t,r){var i=e.split("\r\n"),n=findFmtpLine(i,t);if(null===n)return e;var a=parseFmtpLine(i[n]);delete a.params[r];var s=writeFmtpLine(a);return null===s?i.splice(n,1):i[n]=s,e=i.join("\r\n")},window.parseFmtpLine=function(e){var t={},r=e.indexOf(" "),i=e.substring(r+1).split("; "),n=new RegExp("a=fmtp:(\\d+)"),a=e.match(n);if(!a||2!==a.length)return null;t.pt=a[1];for(var s={},o=0;o<i.length;++o){var c=i[o].split("=");2===c.length&&(s[c[0]]=c[1])}return t.params=s,t},window.writeFmtpLine=function(e){if(!e.hasOwnProperty("pt")||!e.hasOwnProperty("params"))return null;var t=e.pt,r=e.params,i=[],n=0;for(var a in r)i[n]=a+"="+r[a],++n;return 0===n?null:"a=fmtp:"+t.toString()+" "+i.join("; ")},window.findFmtpLine=function(e,t){var r=getCodecPayloadType(e,t);return r?findLine(e,"a=fmtp:"+r.toString()):null},window.findLine=function(e,t,r){return findLineInRange(e,0,-1,t,r)},window.findLineInRange=function(e,t,r,i,n){for(var a=r!==-1?r:e.length,s=t;s<a;++s)if(0===e[s].indexOf(i)&&(!n||e[s].toLowerCase().indexOf(n.toLowerCase())!==-1))return s;return null},window.getCodecPayloadType=function(e,t){var r=findLine(e,"a=rtpmap",t);return r?getCodecPayloadTypeFromLine(e[r]):null},window.getCodecPayloadTypeFromLine=function(e){var t=new RegExp("a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+"),r=e.match(t);return r&&2===r.length?r[1]:null},window.setDefaultCodec=function(e,t){var r=e.split(" "),i=r.slice(0,3);i.push(t);for(var n=3;n<r.length;n++)r[n]!==t&&i.push(r[n]);return i.join(" ")}},function(e,t,r){var i,i;(function(t){!function(t){e.exports=t()}(function(){return function e(t,r,n){function a(o,c){if(!r[o]){if(!t[o]){var d="function"==typeof i&&i;if(!c&&d)return i(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var h=r[o]={exports:{}};t[o][0].call(h.exports,function(e){var r=t[o][1][e];return a(r?r:e)},h,h.exports,e,t,r,n)}return r[o].exports}for(var s="function"==typeof i&&i,o=0;o<n.length;o++)a(n[o]);return a}({1:[function(e,t,r){"use strict";function i(e,t,r,i){var n=c.writeRtpDescription(e.kind,t);if(n+=c.writeIceParameters(e.iceGatherer.getLocalParameters()),n+=c.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),n+="a=mid:"+e.mid+"\r\n",n+=e.direction?"a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";n+="a="+a,n+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,n+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return n+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+c.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+c.localCName+"\r\n"),n}function n(e,t){var r=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(function(e){if(e&&(e.urls||e.url)){var i=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var n="string"==typeof i;return n&&(i=[i]),i=i.filter(function(e){var i=0===e.indexOf("turn:")&&e.indexOf("transport=udp")!==-1&&e.indexOf("turn:[")===-1&&!r;return i?(r=!0,!0):0===e.indexOf("stun:")&&t>=14393&&e.indexOf("?transport=udp")===-1}),delete e.url,e.urls=n?i[0]:i,!!i.length}return!1})}function a(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},i=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},n=function(e,t,r,n){var a=i(e.parameters.apt,r),s=i(t.parameters.apt,n);return a&&s&&a.name.toLowerCase()===s.name.toLowerCase()};return e.codecs.forEach(function(i){for(var a=0;a<t.codecs.length;a++){var s=t.codecs[a];if(i.name.toLowerCase()===s.name.toLowerCase()&&i.clockRate===s.clockRate){if("rtx"===i.name.toLowerCase()&&i.parameters&&s.parameters.apt&&!n(i,s,e.codecs,t.codecs))continue;s=JSON.parse(JSON.stringify(s)),s.numChannels=Math.min(i.numChannels,s.numChannels),r.codecs.push(s),s.rtcpFeedback=s.rtcpFeedback.filter(function(e){for(var t=0;t<i.rtcpFeedback.length;t++)if(i.rtcpFeedback[t].type===e.type&&i.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var i=0;i<t.headerExtensions.length;i++){var n=t.headerExtensions[i];if(e.uri===n.uri){r.headerExtensions.push(n);break}}}),r}function s(e,t,r){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)!==-1}function o(e,t){var r=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return r||e.addRemoteCandidate(t),!r}var c=e("sdp");t.exports=function(e,t){var r=function(r){var i=this,a=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){i[e]=a[e].bind(a)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onicegatheringstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this.localDescription=null,this.remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy){var s=new Error("rtcpMuxPolicy 'negotiate' is not supported");throw s.name="NotSupportedError",s}switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=n(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var o=r.iceCandidatePoolSize;o>0;o--)this._iceGatherers=new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy});else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=c.generateSessionId(),this._sdpSessionVersion=0};return r.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this.dispatchEvent(e),"function"==typeof this.onicegatheringstatechange&&this.onicegatheringstatechange(e)},r.prototype.getConfiguration=function(){return this._config},r.prototype.getLocalStreams=function(){return this.localStreams},r.prototype.getRemoteStreams=function(){return this.remoteStreams},r.prototype._createTransceiver=function(e){var t=this.transceivers.length>0,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,wantReceive:!0};if(this.usingBundle&&t)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();r.iceTransport=i.iceTransport,r.dtlsTransport=i.dtlsTransport}return this.transceivers.push(r),r},r.prototype.addTrack=function(t,r){for(var i,n=0;n<this.transceivers.length;n++)this.transceivers[n].track||this.transceivers[n].kind!==t.kind||(i=this.transceivers[n]);return i||(i=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(r)===-1&&this.localStreams.push(r),i.track=t,i.stream=r,i.rtpSender=new e.RTCRtpSender(t,i.dtlsTransport),i.rtpSender},r.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach(function(t){r.addTrack(t,e)});else{var i=e.clone();e.getTracks().forEach(function(e,t){var r=i.getTracks()[t];e.addEventListener("enabled",function(e){r.enabled=e.enabled})}),i.getTracks().forEach(function(e){r.addTrack(e,i)})}},r.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},r.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},r.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},r.prototype._createIceGatherer=function(t,r){var i=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var n=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(n,"state",{value:"new",writable:!0}),this.transceivers[t].candidates=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;n.state=r?"completed":"gathering",null!==i.transceivers[t].candidates&&i.transceivers[t].candidates.push(e.candidate)},n.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),n},r.prototype._gather=function(t,r){var i=this,n=this.transceivers[r].iceGatherer;if(!n.onlocalcandidate){var a=this.transceivers[r].candidates;this.transceivers[r].candidates=null,n.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),n.onlocalcandidate=function(e){if(!(i.usingBundle&&r>0)){var a=new Event("icecandidate");a.candidate={sdpMid:t,sdpMLineIndex:r};var s=e.candidate,o=!s||0===Object.keys(s).length;o?"new"!==n.state&&"gathering"!==n.state||(n.state="completed"):("new"===n.state&&(n.state="gathering"),s.component=1,a.candidate.candidate=c.writeCandidate(s));var d=c.splitSections(i.localDescription.sdp);o?d[a.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n":d[a.candidate.sdpMLineIndex+1]+="a="+a.candidate.candidate+"\r\n",
i.localDescription.sdp=d.join("");var u=i.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),o||(i.dispatchEvent(a),"function"==typeof i.onicecandidate&&i.onicecandidate(a)),u&&(i.dispatchEvent(new Event("icecandidate")),"function"==typeof i.onicecandidate&&i.onicecandidate(new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout(function(){a.forEach(function(e){var t=new Event("RTCIceGatherEvent");t.candidate=e,n.onlocalcandidate(t)})},0)}},r.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateConnectionState()};var i=new e.RTCDtlsTransport(r);return i.ondtlsstatechange=function(){t._updateConnectionState()},i.onerror=function(){Object.defineProperty(i,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:i}},r.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var i=this.transceivers[e].dtlsTransport;i&&(delete i.ondtlsstatechange,delete i.onerror,delete this.transceivers[e].dtlsTransport)},r.prototype._transceive=function(e,r,i){var n=a(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(n.encodings=e.sendEncodingParameters,n.rtcp={cname:c.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(n.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(n)),i&&e.rtpReceiver&&n.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),n.encodings=e.recvEncodingParameters,n.rtcp={cname:e.rtcpParameters.cname,compound:e.rtcpParameters.compound},e.sendEncodingParameters.length&&(n.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(n))},r.prototype.setLocalDescription=function(e){var t=this,r=arguments;if(!s("setLocalDescription",e.type,this.signalingState))return new Promise(function(i,n){var a=new Error("Can not set local "+e.type+" in state "+t.signalingState);a.name="InvalidStateError",r.length>2&&"function"==typeof r[2]&&r[2].apply(null,[a]),n(a)});var i,n;if("offer"===e.type)i=c.splitSections(e.sdp),n=i.shift(),i.forEach(function(e,r){var i=c.parseRtpParameters(e);t.transceivers[r].localCapabilities=i}),this.transceivers.forEach(function(e,r){t._gather(e.mid,r)});else if("answer"===e.type){i=c.splitSections(t.remoteDescription.sdp),n=i.shift();var o=c.matchPrefix(n,"a=ice-lite").length>0;i.forEach(function(e,r){var i=t.transceivers[r],s=i.iceGatherer,d=i.iceTransport,u=i.dtlsTransport,h=i.localCapabilities,l=i.remoteCapabilities,m=c.isRejected(e)&&1===!c.matchPrefix(e,"a=bundle-only").length;if(!m&&!i.isDatachannel){var p=c.getIceParameters(e,n),f=c.getDtlsParameters(e,n);o&&(f.role="server"),t.usingBundle&&0!==r||(t._gather(i.mid,r),"new"===d.state&&d.start(s,p,o?"controlling":"controlled"),"new"===u.state&&u.start(f));var v=a(h,l);t._transceive(i,v.codecs.length>0,!1)}})}switch(this.localDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var d=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(e){d&&d.apply(null),e()})},r.prototype.setRemoteDescription=function(r){var i=this,n=arguments;if(!s("setRemoteDescription",r.type,this.signalingState))return new Promise(function(e,t){var a=new Error("Can not set remote "+r.type+" in state "+i.signalingState);a.name="InvalidStateError",n.length>2&&"function"==typeof n[2]&&n[2].apply(null,[a]),t(a)});var a={};this.remoteStreams.forEach(function(e){a[e.id]=e});var d=[],u=c.splitSections(r.sdp),h=u.shift(),l=c.matchPrefix(h,"a=ice-lite").length>0,m=c.matchPrefix(h,"a=group:BUNDLE ").length>0;this.usingBundle=m;var p=c.matchPrefix(h,"a=ice-options:")[0];switch(p?this.canTrickleIceCandidates=p.substr(14).split(" ").indexOf("trickle")>=0:this.canTrickleIceCandidates=!1,u.forEach(function(n,s){var u=c.splitLines(n),p=c.getKind(n),f=c.isRejected(n)&&1===!c.matchPrefix(n,"a=bundle-only").length,v=u[0].substr(2).split(" ")[2],_=c.getDirection(n,h),g=c.parseMsid(n),S=c.getMid(n)||c.generateIdentifier();if("application"===p&&"DTLS/SCTP"===v)return void(i.transceivers[s]={mid:S,isDatachannel:!0});var C,y,b,R,E,T,I,P,w,M,L,k=c.parseRtpParameters(n);f||(M=c.getIceParameters(n,h),L=c.getDtlsParameters(n,h),L.role="client"),I=c.parseRtpEncodingParameters(n);var A=c.parseRtcpParameters(n),O=c.matchPrefix(n,"a=end-of-candidates",h).length>0,x=c.matchPrefix(n,"a=candidate:").map(function(e){return c.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===r.type||"answer"===r.type)&&!f&&m&&s>0&&i.transceivers[s]&&(i._disposeIceAndDtlsTransports(s),i.transceivers[s].iceGatherer=i.transceivers[0].iceGatherer,i.transceivers[s].iceTransport=i.transceivers[0].iceTransport,i.transceivers[s].dtlsTransport=i.transceivers[0].dtlsTransport,i.transceivers[s].rtpSender&&i.transceivers[s].rtpSender.setTransport(i.transceivers[0].dtlsTransport),i.transceivers[s].rtpReceiver&&i.transceivers[s].rtpReceiver.setTransport(i.transceivers[0].dtlsTransport)),"offer"!==r.type||f)"answer"!==r.type||f||(C=i.transceivers[s],y=C.iceGatherer,b=C.iceTransport,R=C.dtlsTransport,E=C.rtpReceiver,T=C.sendEncodingParameters,P=C.localCapabilities,i.transceivers[s].recvEncodingParameters=I,i.transceivers[s].remoteCapabilities=k,i.transceivers[s].rtcpParameters=A,x.length&&(!l&&!O||m&&0!==s||"new"!==b.state?x.forEach(function(e){o(C.iceTransport,e)}):b.setRemoteCandidates(x)),m&&0!==s||("new"===b.state&&b.start(y,M,"controlling"),"new"===R.state&&R.start(L)),i._transceive(C,"sendrecv"===_||"recvonly"===_,"sendrecv"===_||"sendonly"===_),!E||"sendrecv"!==_&&"sendonly"!==_?delete C.rtpReceiver:(w=E.track,g?(a[g.stream]||(a[g.stream]=new e.MediaStream),a[g.stream].addTrack(w),d.push([w,E,a[g.stream]])):(a.default||(a.default=new e.MediaStream),a.default.addTrack(w),d.push([w,E,a.default]))));else{if(C=i.transceivers[s]||i._createTransceiver(p),C.mid=S,C.iceGatherer||(C.iceGatherer=i._createIceGatherer(s,m)),x.length&&"new"===C.iceTransport.state&&(!O||m&&0!==s?x.forEach(function(e){o(C.iceTransport,e)}):C.iceTransport.setRemoteCandidates(x)),P=e.RTCRtpReceiver.getCapabilities(p),t<15019&&(P.codecs=P.codecs.filter(function(e){return"rtx"!==e.name})),T=[{ssrc:1001*(2*s+2)}],"sendrecv"===_||"sendonly"===_){var N=!C.rtpReceiver;if(E=C.rtpReceiver||new e.RTCRtpReceiver(C.dtlsTransport,p),N){var D;w=E.track,g?(a[g.stream]||(a[g.stream]=new e.MediaStream,Object.defineProperty(a[g.stream],"id",{get:function(){return g.stream}})),Object.defineProperty(w,"id",{get:function(){return g.track}}),D=a[g.stream]):(a.default||(a.default=new e.MediaStream),D=a.default),D.addTrack(w),d.push([w,E,D])}}C.localCapabilities=P,C.remoteCapabilities=k,C.rtpReceiver=E,C.rtcpParameters=A,C.sendEncodingParameters=T,C.recvEncodingParameters=I,i._transceive(i.transceivers[s],!1,"sendrecv"===_||"sendonly"===_)}}),this.remoteDescription={type:r.type,sdp:r.sdp},r.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+r.type+'"')}return Object.keys(a).forEach(function(t){var r=a[t];if(r.getTracks().length){if(i.remoteStreams.indexOf(r)===-1){i.remoteStreams.push(r);var n=new Event("addstream");n.stream=r,e.setTimeout(function(){i.dispatchEvent(n),"function"==typeof i.onaddstream&&i.onaddstream(n)})}d.forEach(function(t){var n=t[0],a=t[1];if(r.id===t[2].id){var s=new Event("track");s.track=n,s.receiver=a,s.transceiver={receiver:a},s.streams=[r],e.setTimeout(function(){i.dispatchEvent(s),"function"==typeof i.ontrack&&i.ontrack(s)})}})}}),e.setTimeout(function(){i&&i.transceivers&&i.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),new Promise(function(e){n.length>1&&"function"==typeof n[1]&&n[1].apply(null),e()})},r.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},r.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this.dispatchEvent(t),"function"==typeof this.onsignalingstatechange&&this.onsignalingstatechange(t)},r.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&this.needNegotiation!==!0&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation!==!1){t.needNegotiation=!1;var e=new Event("negotiationneeded");t.dispatchEvent(e),"function"==typeof t.onnegotiationneeded&&t.onnegotiationneeded(e)}},0))},r.prototype._updateConnectionState=function(){var e,t=this,r={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){r[e.iceTransport.state]++,r[e.dtlsTransport.state]++}),r.connected+=r.completed,e="new",r.failed>0?e="failed":r.connecting>0||r.checking>0?e="connecting":r.disconnected>0?e="disconnected":r.new>0?e="new":(r.connected>0||r.completed>0)&&(e="connected"),e!==t.iceConnectionState){t.iceConnectionState=e;var i=new Event("iceconnectionstatechange");this.dispatchEvent(i),"function"==typeof this.oniceconnectionstatechange&&this.oniceconnectionstatechange(i)}},r.prototype.createOffer=function(){var r,n=this,a=arguments;1===arguments.length&&"function"!=typeof arguments[0]?r=arguments[0]:3===arguments.length&&(r=arguments[2]);var s=this.transceivers.filter(function(e){return"audio"===e.kind}).length,o=this.transceivers.filter(function(e){return"video"===e.kind}).length;if(r){if(r.mandatory||r.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==r.offerToReceiveAudio&&(s=r.offerToReceiveAudio===!0?1:r.offerToReceiveAudio===!1?0:r.offerToReceiveAudio),void 0!==r.offerToReceiveVideo&&(o=r.offerToReceiveVideo===!0?1:r.offerToReceiveVideo===!1?0:r.offerToReceiveVideo)}for(this.transceivers.forEach(function(e){"audio"===e.kind?(s--,s<0&&(e.wantReceive=!1)):"video"===e.kind&&(o--,o<0&&(e.wantReceive=!1))});s>0||o>0;)s>0&&(this._createTransceiver("audio"),s--),o>0&&(this._createTransceiver("video"),o--);var d=c.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);this.transceivers.forEach(function(r,i){var a=r.track,s=r.kind,o=c.generateIdentifier();r.mid=o,r.iceGatherer||(r.iceGatherer=n._createIceGatherer(i,n.usingBundle));var d=e.RTCRtpSender.getCapabilities(s);t<15019&&(d.codecs=d.codecs.filter(function(e){return"rtx"!==e.name})),d.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1")});var u=[{ssrc:1001*(2*i+1)}];a&&t>=15019&&"video"===s&&(u[0].rtx={ssrc:1001*(2*i+1)+1}),r.wantReceive&&(r.rtpReceiver=new e.RTCRtpReceiver(r.dtlsTransport,s)),r.localCapabilities=d,r.sendEncodingParameters=u}),"max-compat"!==this._config.bundlePolicy&&(d+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),d+="a=ice-options:trickle\r\n",this.transceivers.forEach(function(e,t){d+=i(e,e.localCapabilities,"offer",e.stream),d+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,d+="a="+c.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(d+="a=end-of-candidates\r\n"))});var u=new e.RTCSessionDescription({type:"offer",sdp:d});return new Promise(function(e){return a.length>0&&"function"==typeof a[0]?(a[0].apply(null,[u]),void e()):void e(u)})},r.prototype.createAnswer=function(){var r=arguments,n=c.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);this.usingBundle&&(n+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n");var s=c.splitSections(this.remoteDescription.sdp).length-1;this.transceivers.forEach(function(e,r){if(!(r+1>s)){if(e.isDatachannel)return void(n+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+e.mid+"\r\n");if(e.stream){var o;"audio"===e.kind?o=e.stream.getAudioTracks()[0]:"video"===e.kind&&(o=e.stream.getVideoTracks()[0]),o&&t>=15019&&"video"===e.kind&&(e.sendEncodingParameters[0].rtx={ssrc:1001*(2*r+2)+1})}var c=a(e.localCapabilities,e.remoteCapabilities),d=c.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length;!d&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,n+=i(e,c,"answer",e.stream),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(n+="a=rtcp-rsize\r\n")}});var o=new e.RTCSessionDescription({type:"answer",sdp:n});return new Promise(function(e){return r.length>0&&"function"==typeof r[0]?(r[0].apply(null,[o]),void e()):void e(o)})},r.prototype.addIceCandidate=function(e){var t,r;if(e&&""!==e.candidate){if(!e.sdpMLineIndex&&!e.sdpMid)throw new TypeError("sdpMLineIndex or sdpMid required");if(this.remoteDescription){var i=e.sdpMLineIndex;if(e.sdpMid)for(var n=0;n<this.transceivers.length;n++)if(this.transceivers[n].mid===e.sdpMid){i=n;break}var a=this.transceivers[i];if(a){if(a.isDatachannel)return Promise.resolve();var s=Object.keys(e.candidate).length>0?c.parseCandidate(e.candidate):{};if("tcp"===s.protocol&&(0===s.port||9===s.port))return Promise.resolve();if(s.component&&1!==s.component)return Promise.resolve();if((0===i||i>0&&a.iceTransport!==this.transceivers[0].iceTransport)&&(o(a.iceTransport,s)||(t=new Error("Can not add ICE candidate"),t.name="OperationError")),!t){var d=e.candidate.trim();0===d.indexOf("a=")&&(d=d.substr(2)),r=c.splitSections(this.remoteDescription.sdp),r[i+1]+="a="+(s.type?d:"end-of-candidates")+"\r\n",this.remoteDescription.sdp=r.join("")}}else t=new Error("Can not add ICE candidate"),t.name="OperationError"}else t=new Error("Can not add ICE candidate without a remote description"),t.name="InvalidStateError"}else for(var u=0;u<this.transceivers.length&&(this.transceivers[u].isDatachannel||(this.transceivers[u].iceTransport.addRemoteCandidate({}),r=c.splitSections(this.remoteDescription.sdp),r[u+1]+="a=end-of-candidates\r\n",this.remoteDescription.sdp=r.join(""),!this.usingBundle));u++);var h=arguments;return new Promise(function(e,r){t?(h.length>2&&"function"==typeof h[2]&&h[2].apply(null,[t]),r(t)):(h.length>1&&"function"==typeof h[1]&&h[1].apply(null),e())})},r.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(r){t[r]&&e.push(t[r].getStats())})});var t=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1],r=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};return new Promise(function(i){var n=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){e[t].type=r(e[t]),n.set(t,e[t])})}),t&&t.apply(null,n),i(n)})})},r}},{sdp:2}],2:[function(e,t,r){"use strict";var i={};i.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},i.localCName=i.generateIdentifier(),i.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},i.splitSections=function(e){var t=e.split("\nm=");return t.map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},i.matchPrefix=function(e,t){return i.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},i.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var r={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},i=8;i<t.length;i+=2)switch(t[i]){case"raddr":r.relatedAddress=t[i+1];break;case"rport":r.relatedPort=parseInt(t[i+1],10);break;case"tcptype":r.tcpType=t[i+1];break;case"ufrag":r.ufrag=t[i+1],r.usernameFragment=t[i+1];break;default:r[t[i]]=t[i+1]}return r},i.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),e.ufrag&&(t.push("ufrag"),t.push(e.ufrag)),"candidate:"+t.join(" ")},i.parseIceOptions=function(e){return e.substr(14).split(" ")},i.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.numChannels=3===t.length?parseInt(t[2],10):1,r},i.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},i.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},i.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},i.parseFmtp=function(e){for(var t,r={},i=e.substr(e.indexOf(" ")+1).split(";"),n=0;n<i.length;n++)t=i[n].trim().split("="),r[t[0].trim()]=t[1];return r},i.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var i=[];Object.keys(e.parameters).forEach(function(t){i.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+r+" "+i.join(";")+"\r\n"}return t},i.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},i.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},i.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},i=e.indexOf(":",t);return i>-1?(r.attribute=e.substr(t+1,i-t-1),r.value=e.substr(i+1)):r.attribute=e.substr(t+1),r},i.getMid=function(e){var t=i.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},i.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},i.getDtlsParameters=function(e,t){var r=i.matchPrefix(e+t,"a=fingerprint:");return{role:"auto",fingerprints:r.map(i.parseFingerprint)}},i.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},i.getIceParameters=function(e,t){var r=i.splitLines(e);r=r.concat(i.splitLines(t));var n={usernameFragment:r.filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:r.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)};return n},i.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},i.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=i.splitLines(e),n=r[0].split(" "),a=3;a<n.length;a++){var s=n[a],o=i.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(o){var c=i.parseRtpMap(o),d=i.matchPrefix(e,"a=fmtp:"+s+" ");switch(c.parameters=d.length?i.parseFmtp(d[0]):{},c.rtcpFeedback=i.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(i.parseRtcpFb),t.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase())}}}return i.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(i.parseExtmap(e))}),t},i.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r+=i.writeRtpMap(e),r+=i.writeFmtp(e),r+=i.writeRtcpFb(e)});var n=0;return t.codecs.forEach(function(e){e.maxptime>n&&(n=e.maxptime)}),n>0&&(r+="a=maxptime:"+n+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions.forEach(function(e){r+=i.writeExtmap(e)}),r},i.parseRtpEncodingParameters=function(e){var t,r=[],n=i.parseRtpParameters(e),a=n.fecMechanisms.indexOf("RED")!==-1,s=n.fecMechanisms.indexOf("ULPFEC")!==-1,o=i.matchPrefix(e,"a=ssrc:").map(function(e){return i.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=o.length>0&&o[0].ssrc,d=i.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});d.length>0&&d[0].length>1&&d[0][0]===c&&(t=d[0][1]),n.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var i={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:t}};r.push(i),a&&(i=JSON.parse(JSON.stringify(i)),i.fec={ssrc:t,mechanism:s?"red+ulpfec":"red"},r.push(i))}}),0===r.length&&c&&r.push({ssrc:c});var u=i.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,r.forEach(function(e){e.maxBitrate=u})),r},i.parseRtcpParameters=function(e){var t={},r=i.matchPrefix(e,"a=ssrc:").map(function(e){return i.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var n=i.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=n.length>0,t.compound=0===n.length;var a=i.matchPrefix(e,"a=rtcp-mux");return t.mux=a.length>0,t},i.parseMsid=function(e){var t,r=i.matchPrefix(e,"a=msid:");if(1===r.length)return t=r[0].substr(7).split(" "),{stream:t[0],track:t[1]};var n=i.matchPrefix(e,"a=ssrc:").map(function(e){return i.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return n.length>0?(t=n[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},i.generateSessionId=function(){return Math.random().toString().substr(2,21)},i.writeSessionBoilerplate=function(e,t){var r,n=void 0!==t?t:2;return r=e?e:i.generateSessionId(),"v=0\r\no=thisisadapterortc "+r+" "+n+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},i.writeMediaSection=function(e,t,r,n){var a=i.writeRtpDescription(e.kind,t);if(a+=i.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=i.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),a+="a=mid:"+e.mid+"\r\n",a+=e.direction?"a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender){var s="msid:"+n.id+" "+e.rtpSender.track.id+"\r\n";a+="a="+s,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+i.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+i.localCName+"\r\n"),a},i.getDirection=function(e,t){for(var r=i.splitLines(e),n=0;n<r.length;n++)switch(r[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[n].substr(2)}return t?i.getDirection(t):"sendrecv"},i.getKind=function(e){var t=i.splitLines(e),r=t[0].split(" ");return r[0].substr(2)},i.isRejected=function(e){return"0"===e.split(" ",2)[1]},i.parseMLine=function(e){var t=i.splitLines(e),r=t[0].split(" ");return{kind:r[0].substr(2),port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},"object"==typeof t&&(t.exports=i)},{}],3:[function(e,r,i){(function(t){"use strict";var i=e("./adapter_factory.js");r.exports=i({window:t.window})}).call(this,"undefined"!=typeof t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter_factory.js":4}],4:[function(e,t,r){"use strict";var i=e("./utils");t.exports=function(t,r){var n=t&&t.window,a={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var s in r)hasOwnProperty.call(r,s)&&(a[s]=r[s]);var o=i.log,c=i.detectBrowser(n),d={browserDetails:c,extractVersion:i.extractVersion,disableLog:i.disableLog,disableWarnings:i.disableWarnings},u=e("./chrome/chrome_shim")||null,h=e("./edge/edge_shim")||null,l=e("./firefox/firefox_shim")||null,m=e("./safari/safari_shim")||null,p=e("./common_shim")||null;switch(c.browser){case"chrome":if(!u||!u.shimPeerConnection||!a.shimChrome)return o("Chrome shim is not included in this adapter release."),d;o("adapter.js shimming chrome."),d.browserShim=u,p.shimCreateObjectURL(n),u.shimGetUserMedia(n),u.shimMediaStream(n),u.shimSourceObject(n),u.shimPeerConnection(n),u.shimOnTrack(n),u.shimAddTrackRemoveTrack(n),u.shimGetSendersWithDtmf(n),p.shimRTCIceCandidate(n);break;case"firefox":if(!l||!l.shimPeerConnection||!a.shimFirefox)return o("Firefox shim is not included in this adapter release."),d;o("adapter.js shimming firefox."),d.browserShim=l,p.shimCreateObjectURL(n),l.shimGetUserMedia(n),l.shimSourceObject(n),l.shimPeerConnection(n),l.shimOnTrack(n),p.shimRTCIceCandidate(n);break;case"edge":if(!h||!h.shimPeerConnection||!a.shimEdge)return o("MS edge shim is not included in this adapter release."),d;o("adapter.js shimming edge."),d.browserShim=h,p.shimCreateObjectURL(n),h.shimGetUserMedia(n),h.shimPeerConnection(n),h.shimReplaceTrack(n);break;case"safari":if(!m||!a.shimSafari)return o("Safari shim is not included in this adapter release."),d;o("adapter.js shimming safari."),d.browserShim=m,p.shimCreateObjectURL(n),m.shimRTCIceServerUrls(n),m.shimCallbacksAPI(n),m.shimLocalStreamsAPI(n),m.shimRemoteStreamsAPI(n),m.shimTrackEventTransceiver(n),m.shimGetUserMedia(n),p.shimRTCIceCandidate(n);break;default:o("Unsupported browser!")}return d}},{"./chrome/chrome_shim":5,"./common_shim":7,"./edge/edge_shim":8,"./firefox/firefox_shim":10,"./safari/safari_shim":12,"./utils":13}],5:[function(e,t,r){"use strict";var i=e("../utils.js"),n=i.log,a={shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return r._ontrackpoly||(r._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(i){var n;n=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===i.track.id}):{track:i.track};var a=new Event("track");a.track=i.track,a.receiver=n,a.transceiver={receiver:n},a.streams=[t.stream],r.dispatchEvent(a)}),t.stream.getTracks().forEach(function(i){var n;n=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find(function(e){return e.track&&e.track.id===i.id}):{track:i};var a=new Event("track");a.track=i,a.receiver=n,a.transceiver={receiver:n},a.streams=[t.stream],r.dispatchEvent(a)})},r.addEventListener("addstream",r._ontrackpoly)),t.apply(r,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){var n=this,a=r.apply(n,arguments);return a||(a=t(n,e),n._senders.push(a)),a};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;i.apply(t,arguments);var r=t._senders.indexOf(e);r!==-1&&t._senders.splice(r,1)}}var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;r._senders=r._senders||[],n.apply(r,[e]),e.getTracks().forEach(function(e){r._senders.push(t(r,e))})};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],a.apply(t,[t._streams[e.id]||e]),e.getTracks().forEach(function(e){var r=t._senders.find(function(t){return t.track===e});r&&t._senders.splice(t._senders.indexOf(r),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var s=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=s.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSourceObject:function(e){var t=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var r=this;return this._srcObject=e,this.src&&t.revokeObjectURL(this.src),e?(this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){r.src&&t.revokeObjectURL(r.src),r.src=t.createObjectURL(e)}),void e.addEventListener("removetrack",function(){r.src&&t.revokeObjectURL(r.src),r.src=t.createObjectURL(e)})):void(this.src="")}}))},shimAddTrackRemoveTrack:function(e){function t(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var i=e._reverseStreams[t],n=e._streams[i.id];r=r.replace(new RegExp(n.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:r})}function r(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var i=e._reverseStreams[t],n=e._streams[i.id];r=r.replace(new RegExp(i.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:r})}var n=i.detectBrowser(e);if(!(e.RTCPeerConnection.prototype.addTrack&&n.version>=62)){var a=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=a.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{},t.getTracks().forEach(function(e){var t=r.getSenders().find(function(t){return t.track===e});if(t)throw new DOMException("Track already exists.","InvalidAccessError")}),!r._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());r._streams[t.id]=i,r._reverseStreams[i.id]=t,t=i}s.apply(r,[t])};var o=e.RTCPeerConnection.prototype.removeStream;
e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},o.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var i=this;if("closed"===i.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var a=i.getSenders().find(function(e){return e.track===t});if(a)throw new DOMException("Track already exists.","InvalidAccessError");i._streams=i._streams||{},i._reverseStreams=i._reverseStreams||{};var s=i._streams[r.id];if(s)s.addTrack(t),Promise.resolve().then(function(){i.dispatchEvent(new Event("negotiationneeded"))});else{var o=new e.MediaStream([t]);i._streams[r.id]=o,i._reverseStreams[o.id]=r,i.addStream(o)}return i.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(r){var i=e.RTCPeerConnection.prototype[r];e.RTCPeerConnection.prototype[r]=function(){var e=this,r=arguments,n=arguments.length&&"function"==typeof arguments[0];return n?i.apply(e,[function(i){var n=t(e,i);r[0].apply(null,[n])},function(e){r[1]&&r[1].apply(null,e)},arguments[2]]):i.apply(e,arguments).then(function(r){return t(e,r)})}});var c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this;return arguments.length&&arguments[0].type?(arguments[0]=r(e,arguments[0]),c.apply(e,arguments)):c.apply(e,arguments)};var d=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=this,r=d.get.apply(this);return""===r.type?r:t(e,r)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===t.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");var r=e._pc===t;if(!r)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");t._streams=t._streams||{};var i;Object.keys(t._streams).forEach(function(r){var n=t._streams[r].getTracks().find(function(t){return e.track===t});n&&(i=t._streams[r])}),i&&(1===i.getTracks().length?t.removeStream(i):i.removeTrack(e.track),t.dispatchEvent(new Event("negotiationneeded")))}}},shimPeerConnection:function(e){var t=i.detectBrowser(e);if(e.RTCPeerConnection){var r=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var n=[],a=0;a<e.iceServers.length;a++){var s=e.iceServers[a];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(i.deprecated("RTCIceServer.url","RTCIceServer.urls"),s=JSON.parse(JSON.stringify(s)),s.urls=s.url,n.push(s)):n.push(e.iceServers[a])}e.iceServers=n}return new r(e,t)},e.RTCPeerConnection.prototype=r.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return r.generateCertificate}})}else e.RTCPeerConnection=function(t,r){return n("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,r)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}});var a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,r){var i=this,n=arguments;if(arguments.length>0&&"function"==typeof e)return a.apply(this,arguments);if(0===a.length&&(0===arguments.length||"function"!=typeof arguments[0]))return a.apply(this,[]);var s=function(e){var t={},r=e.result();return r.forEach(function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){r[t]=e.stat(t)}),t[r.id]=r}),t},o=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){var c=function(e){n[1](o(s(e)))};return a.apply(this,[c,arguments[0]])}return new Promise(function(e,t){a.apply(i,[function(t){e(o(s(t)))},t])}).then(t,r)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,i=new Promise(function(i,n){r.apply(t,[e[0],i,n])});return e.length<2?i:i.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(i,n){r.apply(e,[i,n,t])})}return r.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var s=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};t.exports={shimMediaStream:a.shimMediaStream,shimOnTrack:a.shimOnTrack,shimAddTrackRemoveTrack:a.shimAddTrackRemoveTrack,shimGetSendersWithDtmf:a.shimGetSendersWithDtmf,shimSourceObject:a.shimSourceObject,shimPeerConnection:a.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils.js":13,"./getusermedia":6}],6:[function(e,t,r){"use strict";var i=e("../utils.js"),n=i.log;t.exports=function(e){var t=i.detectBrowser(e),r=e&&e.navigator,a=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var i="object"==typeof e[r]?e[r]:{ideal:e[r]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var n=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];var a={};"number"==typeof i.ideal?(a[n("min",r)]=i.ideal,t.optional.push(a),a={},a[n("max",r)]=i.ideal,t.optional.push(a)):(a[n("",r)]=i.ideal,t.optional.push(a))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[n("",r)]=i.exact):["min","max"].forEach(function(e){void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[n(e,r)]=i[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},s=function(e,i){if(e=JSON.parse(JSON.stringify(e)),e&&"object"==typeof e.audio){var s=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};e=JSON.parse(JSON.stringify(e)),s(e.audio,"autoGainControl","googAutoGainControl"),s(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=a(e.audio)}if(e&&"object"==typeof e.video){var o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});var c=t.version<61;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||c)){delete e.video.facingMode;var d;if("environment"===o.exact||"environment"===o.ideal?d=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(d=["front"]),d)return r.mediaDevices.enumerateDevices().then(function(t){t=t.filter(function(e){return"videoinput"===e.kind});var r=t.find(function(e){return d.some(function(t){return e.label.toLowerCase().indexOf(t)!==-1})});return!r&&t.length&&d.indexOf("back")!==-1&&(r=t[t.length-1]),r&&(e.video.deviceId=o.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=a(e.video),n("chrome: "+JSON.stringify(e)),i(e)})}e.video=a(e.video)}return n("chrome: "+JSON.stringify(e)),i(e)},o=function(e){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},c=function(e,t,i){s(e,function(e){r.webkitGetUserMedia(e,t,function(e){i&&i(o(e))})})};r.getUserMedia=c;var d=function(e){return new Promise(function(t,i){r.getUserMedia(e,t,i)})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:d,enumerateDevices:function(){return new Promise(function(t){var r={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:r[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),r.mediaDevices.getUserMedia){var u=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return s(e,function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(o(e))})})}}else r.mediaDevices.getUserMedia=function(e){return d(e)};"undefined"==typeof r.mediaDevices.addEventListener&&(r.mediaDevices.addEventListener=function(){n("Dummy mediaDevices.addEventListener called.")}),"undefined"==typeof r.mediaDevices.removeEventListener&&(r.mediaDevices.removeEventListener=function(){n("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":13}],7:[function(e,t,r){"use strict";function i(e,t,r){if(e.RTCPeerConnection){var i=e.RTCPeerConnection.prototype,n=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return n.apply(this,arguments);var a=function(e){i(r(e))};return this._eventMap=this._eventMap||{},this._eventMap[i]=a,n.apply(this,[e,a])};var a=i.removeEventListener;i.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[r])return a.apply(this,arguments);var i=this._eventMap[r];return delete this._eventMap[r],a.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)}})}}var n=e("sdp"),a=e("./utils");t.exports={shimRTCIceCandidate:function(e){if(!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){"object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&(e=JSON.parse(JSON.stringify(e)),e.candidate=e.candidate.substr(2));var r=new t(e),i=n.parseCandidate(e.candidate),a=Object.assign(r,i);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a},i(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var r=t.createObjectURL.bind(t),i=t.revokeObjectURL.bind(t),n=new Map,s=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++s;return n.set(t,e),a.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return r(e)},t.revokeObjectURL=function(e){i(e),n.delete(e)};var o=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return o.get.apply(this)},set:function(e){return this.srcObject=n.get(e)||null,o.set.apply(this,[e])}});var c=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=n.get(arguments[1])||null),c.apply(this,arguments)}}}}},{"./utils":13,sdp:2}],8:[function(e,t,r){"use strict";var i=e("../utils"),n=e("rtcpeerconnection-shim");t.exports={shimGetUserMedia:e("./getusermedia"),shimPeerConnection:function(e){var t=i.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCPeerConnection=n(e,t.version)},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},{"../utils":13,"./getusermedia":9,"rtcpeerconnection-shim":1}],9:[function(e,t,r){"use strict";t.exports=function(e){var t=e&&e.navigator,r=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},i=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return i(e).catch(function(e){return Promise.reject(r(e))})}}},{}],10:[function(e,t,r){"use strict";var i=e("../utils"),n={shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var r=new Event("track");r.track=t,r.receiver={track:t},r.transceiver={receiver:r.receiver},r.streams=[e.stream],this.dispatchEvent(r)}.bind(this))}.bind(this))}}),"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=i.detectBrowser(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(r,i){if(t.version<38&&r&&r.iceServers){for(var n=[],a=0;a<r.iceServers.length;a++){var s=r.iceServers[a];if(s.hasOwnProperty("urls"))for(var o=0;o<s.urls.length;o++){var c={url:s.urls[o]};0===s.urls[o].indexOf("turn")&&(c.username=s.username,c.credential=s.credential),n.push(c)}else n.push(r.iceServers[a])}r.iceServers=n}return new e.mozRTCPeerConnection(r,i)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var n=function(e){var t=new Map;return Object.keys(e).forEach(function(r){t.set(r,e[r]),t[r]=e[r]}),t},a={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,r,i){return s.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=n(e)),t.version<53&&!r)try{e.forEach(function(e){e.type=a[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,r){e.set(r,Object.assign({},t,{type:a[t.type]||t.type}))})}return e}).then(r,i)}}}};t.exports={shimOnTrack:n.shimOnTrack,shimSourceObject:n.shimSourceObject,shimPeerConnection:n.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils":13,"./getusermedia":11}],11:[function(e,t,r){"use strict";var i=e("../utils"),n=i.log;t.exports=function(e){var t=i.detectBrowser(e),r=e&&e.navigator,a=e&&e.MediaStreamTrack,s=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},o=function(e,i,a){var o=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var i=e[r]="object"==typeof e[r]?e[r]:{ideal:e[r]};if(void 0===i.min&&void 0===i.max&&void 0===i.exact||t.push(r),void 0!==i.exact&&("number"==typeof i.exact?i.min=i.max=i.exact:e[r]=i.exact,delete i.exact),void 0!==i.ideal){e.advanced=e.advanced||[];var n={};"number"==typeof i.ideal?n[r]={min:i.ideal,max:i.ideal}:n[r]=i.ideal,e.advanced.push(n),delete i.ideal,Object.keys(i).length||delete e[r]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(n("spec: "+JSON.stringify(e)),e.audio&&(e.audio=o(e.audio)),e.video&&(e.video=o(e.video)),n("ff37: "+JSON.stringify(e))),r.mozGetUserMedia(e,i,function(e){a(s(e))})},c=function(e){return new Promise(function(t,r){o(e,t,r)})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:c,addEventListener:function(){},removeEventListener:function(){}}),r.mediaDevices.enumerateDevices=r.mediaDevices.enumerateDevices||function(){return new Promise(function(e){var t=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];e(t)})},t.version<41){var d=r.mediaDevices.enumerateDevices.bind(r.mediaDevices);r.mediaDevices.enumerateDevices=function(){return d().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var u=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(s(e))})}}if(!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var h=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},l=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),h(e.audio,"autoGainControl","mozAutoGainControl"),h(e.audio,"noiseSuppression","mozNoiseSuppression")),l(e)},a&&a.prototype.getSettings){var m=a.prototype.getSettings;a.prototype.getSettings=function(){var e=m.apply(this,arguments);return h(e,"mozAutoGainControl","autoGainControl"),h(e,"mozNoiseSuppression","noiseSuppression"),e}}if(a&&a.prototype.applyConstraints){var p=a.prototype.applyConstraints;a.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),h(e,"autoGainControl","mozAutoGainControl"),h(e,"noiseSuppression","mozNoiseSuppression")),p.apply(this,[e])}}}r.getUserMedia=function(e,n,a){return t.version<44?o(e,n,a):(i.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),void r.mediaDevices.getUserMedia(e).then(n,a))}}},{"../utils":13}],12:[function(e,t,r){"use strict";var i=e("../utils"),n={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(r){r.id===e&&(t=r)}),this._remoteStreams&&this._remoteStreams.forEach(function(r){r.id===e&&(t=r)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.indexOf(e)===-1&&this._localStreams.push(e);var r=this;e.getTracks().forEach(function(i){t.call(r,i,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,r){r&&(this._localStreams?this._localStreams.indexOf(r)===-1&&this._localStreams.push(r):this._localStreams=[r]),t.call(this,e,r)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(t!==-1){this._localStreams.splice(t,1);var r=this,i=e.getTracks();this.getSenders().forEach(function(e){i.indexOf(e.track)!==-1&&r.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){"object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){var t=e.streams[0];if(this._remoteStreams||(this._remoteStreams=[]),!(this._remoteStreams.indexOf(t)>=0)){this._remoteStreams.push(t);var r=new Event("addstream");r.stream=e.streams[0],this.dispatchEvent(r)}}.bind(this))}}))},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,i=t.createAnswer,n=t.setLocalDescription,a=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){var i=arguments.length>=2?arguments[2]:arguments[0],n=r.apply(this,[i]);return t?(n.then(e,t),Promise.resolve()):n},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],n=i.apply(this,[r]);return t?(n.then(e,t),Promise.resolve()):n};var o=function(e,t,r){var i=n.apply(this,[e]);return r?(i.then(t,r),Promise.resolve()):i};t.setLocalDescription=o,o=function(e,t,r){var i=a.apply(this,[e]);return r?(i.then(t,r),Promise.resolve()):i},t.setRemoteDescription=o,o=function(e,t,r){var i=s.apply(this,[e]);return r?(i.then(t,r),Promise.resolve()):i},t.addIceCandidate=o}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,i){t.mediaDevices.getUserMedia(e).then(r,i)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var n=[],a=0;a<e.iceServers.length;a++){var s=e.iceServers[a];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(i.deprecated("RTCIceServer.url","RTCIceServer.urls"),s=JSON.parse(JSON.stringify(s)),s.urls=s.url,delete s.url,n.push(s)):n.push(e.iceServers[a])}e.iceServers=n}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}};t.exports={shimCallbacksAPI:n.shimCallbacksAPI,shimLocalStreamsAPI:n.shimLocalStreamsAPI,shimRemoteStreamsAPI:n.shimRemoteStreamsAPI,shimGetUserMedia:n.shimGetUserMedia,shimRTCIceServerUrls:n.shimRTCIceServerUrls,shimTrackEventTransceiver:n.shimTrackEventTransceiver}},{"../utils":13}],13:[function(e,t,r){"use strict";var i=!0,n=!0,a={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(i=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(n=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(i)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){n&&console.warn(e+" is deprecated, please use "+t+" instead.")},extractVersion:function(e,t,r){var i=e.match(t);return i&&i.length>=r&&parseInt(i[r],10)},detectBrowser:function(e){var t=e&&e.navigator,r={};if(r.browser=null,r.version=null,"undefined"==typeof e||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=this.extractVersion(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)if(e.webkitRTCPeerConnection)r.browser="chrome",r.version=this.extractVersion(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!t.userAgent.match(/Version\/(\d+).(\d+)/))return r.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",r;r.browser="safari",r.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=this.extractVersion(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!t.mediaDevices||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return r}};t.exports={log:a.log,deprecated:a.deprecated,disableLog:a.disableLog,disableWarnings:a.disableWarnings,extractVersion:a.extractVersion,shimCreateObjectURL:a.shimCreateObjectURL,detectBrowser:a.detectBrowser.bind(a)}},{}]},{},[3])(3)})}).call(t,function(){return this}())},function(e,t,r){var i,n;i=[r(5),r(6)],n=function(e,t){"use strict";function r(){t.call(this),this.keysChromeEncoding=["googCodecName","googFrameWidthSent","googFrameHeightSent","googFrameRateInput","googFrameRateSent"],this.keysChromeBandwidth=["googActualEncBitrate","googAvailableReceiveBandwidth","googAvailableSendBandwidth","googTargetEncBitrate","googTransmitBitrate"],this.timestampPrev=null,this.framesPrev=null}var i=e.debug_,n=e.warning_,a=r.prototype=Object.create(t.prototype);return a.putReport=function(e){var t=this._filterReport(e),i=r._formatResults(t);this.emitSimple("ReceivedWebRTCStats",{results:i})},a._filterReport=function(t){var r;return"Firefox"===e.browserInfo.browser?r=this._filterStatsFirefox(t):"Chrome"===e.browserInfo.browser?r=t.get("bweforvideo")?this._filterStatsChromeOld(t):this._filterStatsChrome(t):(r={},n("RtcStats not implemented for browser: "+e.browserInfo.browser+" ("+e.browserInfo.browserVersion+")")),r},a._filterStatsFirefox=function(e){var t={};return t.outBoundBitrate=e.outbound_rtp_video_1?e.outbound_rtp_video_1.bitrateMean:0,t.outBoundFramerate=e.outbound_rtp_video_1?e.outbound_rtp_video_1.framerateMean:0,t.inBoundBitrate=e.inbound_rtp_video_1?e.inbound_rtp_video_1.bitrateMean:0,t.inBoundFramerate=e.inbound_rtp_video_1?e.inbound_rtp_video_1.framerateMean:0,t},a._filterStatsChromeOld=function(e){var t=e.get("bweforvideo"),r=this._filterKeys(t,this.keysChromeBandwidth);return r},a._filterStatsChrome=function(e){var t={},r=this;return e.forEach(function(n){if("track"===n.type&&"video"===n.kind&&(n.frameWidth?(t.frameWidth=n.frameWidth,t.frameHeight=n.frameHeight):i("video track has no dimensions, ignoring...")),"video"===n.mediaType&&"outbound-rtp"===n.type&&n.codecId){var a=e.get(n.codecId),s=a.mimeType;t.codec=s}if("outbound-rtp"===n.type&&"video"===n.mediaType){var o=n.timestamp;if(n.bytesSent){var c,d=n.bytesSent;r.timestampPrev&&(c=8*(d-r.bytesPrev)/(o-r.timestampPrev),t.bitrate=1e3*c),r.bytesPrev=d}if(n.framesEncoded&&r.timestampPrev){if(r.framesPrev){var u=1e3*(n.framesEncoded-r.framesPrev)/(o-r.timestampPrev);t.framerate=u}r.framesPrev=n.framesEncoded}r.timestampPrev=o}}),t},a._filterKeys=function(e,t,r){var n,a,s,o={},c="[BW]: ";for(n=0,a=t.length;n<a;n++)s=t[n],o[s]=e[s],c+=e[s]+",";return r&&i(c),o},r._formatResults=function(e){var t={};return Object.keys(e).forEach(function(i){Object.assign(t,r._formatEntry(i,e[i]))}),t},r._formatEntry=function(e,t){var r={};e.length>4&&"goog"===e.substring(0,4)&&(e=e.substring(4));var i=e.toLowerCase();return i.includes("framerate")?t=Math.round(10*t)/10+" fps":(i.includes("bitrate")||i.includes("bandwidth"))&&(t=Number(t)?Math.round(parseInt(t,10)/1e3)+"k":t),r[e]=t,r},r}.apply(t,i),!(void 0!==n&&(e.exports=n))},function(e,t,r){var i,n;i=[r(6),r(5)],n=function(e,t){"use strict";function r(){e.call(this),this._name="AudioMixer",this._audioContext,this._streams=[],this._output}var i=(t.debug_,t.error_,t.success_,t.isNumber),n=r.prototype=Object.create(e.prototype);return n.connect=function(e,t){if(!e||0===e.getAudioTracks().length)return Promise.reject(new Error(this._name+'.connect parameter "stream" must contain a AudioStreamTrack'));if(!i(t)||t>1)return Promise.reject(new Error(this._name+'.connect parameter "input" must be 0 or 1'));var r=e.clone();return this._streams[t]=r,this._listenToStream(r)},n.disconnect=function(e){},n.getOutputStream=function(){return this._streams.length<2?Promise.reject(new Error(this._name+" needs exactly 2 input streams")):this._getMixedStream()},n._listenToStream=function(e){return e.onactive=this._onactive.bind(this),e.oninactive=this._oninactive.bind(this),e.onaddtrack=this._onaddtrack.bind(this),e.onended=this._onended.bind(this),Promise.resolve()},n._unregisterAudioTrackListeners=function(e){},n._onactive=function(e){console.log(this._name+" - ONINACTIVE: "+e)},n._oninactive=function(e){console.log(this._name+" - ONINACTIVE: "+e)},n._onaddtrack=function(e){console.log(this._name+" - ONADDTRACK: "+e)},n._onended=function(e){console.log(this._name+" - ONLOAD: "+e)},n._getMixedStream=function(){this._audioContext||(this._audioContext=new AudioContext);var e=this._audioContext.createMediaStreamSource(this._streams[0]),t=this._audioContext.createMediaStreamSource(this._streams[1]),r=this._audioContext.createChannelSplitter(2),i=this._audioContext.createChannelSplitter(2);
e.connect(r),t.connect(i);var n=this._audioContext.createChannelMerger(4);r.connect(n,0,0),r.connect(n,1,1),i.connect(n,0,2),i.connect(n,1,3);var a=this._createDownMixerNode();return n.connect(a),this._output=this._audioContext.createMediaStreamDestination(),a.connect(this._output),Promise.resolve(this._output.stream)},n._createDownMixerNode=function(){var e=this._audioContext.createScriptProcessor(4096,4,2);return e.onaudioprocess=function(e){for(var t,r=(e.inputBuffer,e.outputBuffer,e.inputBuffer.getChannelData(0)),i=e.inputBuffer.getChannelData(1),n=e.inputBuffer.getChannelData(2),a=e.inputBuffer.getChannelData(3),s=e.outputBuffer.getChannelData(0),o=e.outputBuffer.getChannelData(1),c=0;c<r.length;c++)t=.25*(r[c]+i[c])+.25*(n[c]+a[c]),s[c]=t,o[c]=t},e},r}.apply(t,i),!(void 0!==n&&(e.exports=n))},function(e,t,r){var i,n;i=[r(6),r(5)],n=function(e,t){"use strict";function r(){e.call(this),this._bufferSize=1024,this._numInputChannels=2,this._numOutputChannels=2,this._channels=[],this._microphone=null,this._scriptProcessorNode=null,this.active=!1;var t=window.AudioContext||window.webkitAudioContext;c(t)?this._audioContext=new t:(s("no browser audio context found"),this._audioContext=null)}function i(e,t){e=e||{},o(t)||s("AudioChannel: param audioProcess must be of type object",2),this._audioProcess=t,this._level=0,this._maxLevel=0,this._oldLevel=0,this._id=e.id,this._name=e.name,this._channelData=void 0}var n=Math.max,a=Math.sqrt,s=(t.warning_,t.error_),o=t.isObject,c=t.isFunction,d=r.prototype=Object.create(e.prototype);return d.connect=function(e,t){var r,n;for(t=t||{channels:[]},this._bufferSize=t.bufferSize||1024,this._numInputChannels=t.numInputChannels||2,this._numOutputChannels=t.numOutputChannels||2,this._channels=[],r=0,n=t.channels.length;r<n;r++)this._channels.push(new i(t.channels[r],this));if(!e)return void this.emitSimple("AudioNoStream",{stream:e});var a=e.getAudioTracks();if(a&&a.length>0){var s=this._scriptProcessorNode=this._audioContext.createScriptProcessor(this._bufferSize,this._numInputChannels,this._numOutputChannels);this._microphone=this._audioContext.createMediaStreamSource(e),this._microphone.connect(s),s.connect(this._audioContext.destination),s.onaudioprocess=this._onAudioProcess.bind(this),this.active=!0}else this.emitSimple("AudioNoTrack",{stream:e})},d.reset=function(){this.active=!1,this._microphone=null,this._scriptProcessorNode=null},d._onAudioProcess=function(e){if(this.active){var t,r,i=e.inputBuffer,n=this._channels,a=this;setTimeout(function(){var e=[];for(t=0,r=n.length;t<r;t++)n[t].update(i.getChannelData(t)),e.push(n[t].getChannelData());a.emitSimple("AudioProcess",{channels:e})},0)}},i.prototype.update=function(e){this._channelData=e;var t,r=0,i=e.length;for(t=0;t<i;t++)r+=e[t]*e[t];this._level=a(r/(i||1)),this._maxLevel=n(this._level,this._maxLevel),this._oldLevel=n(this._level,this._oldLevel-.008)},i.prototype.getChannelData=function(){return{maxLevel:this._maxLevel,oldLevel:this._oldLevel,avgLevel:this._level,name:this._name,id:this._id}},r}.apply(t,i),!(void 0!==n&&(e.exports=n))},function(e,t,r){var i,n;i=[],n=function(){"use strict";var e={webrtc:{release_version:"4.6.22",release_description:"main"}};return JSON.parse(JSON.stringify(e))}.apply(t,i),/**
	 * @license WebRTC Release Version 4.5
	 * Copyright (c) 2016 nanocosmos IT GmbH. All rights reserved.
	 * http://www.nanocosmos.de
	 */
!(void 0!==n&&(e.exports=n))}]);