//20171228
!function(t){var n={},i={getNode:function(n){return t('[node-type="'+n+'"]')},cookie:function(){var t={};return t.getCookie=function(t){t=t.replace(/([\.\[\]\$])/g,"\\$1");var n=new RegExp(t+"=([^;]*)?;","i"),i=document.cookie+";",o=i.match(n);return o?unescape(o[1])||"":""},t.setCookie=function(t,n,i,o,e,a){var s=[];if(s.push(t+"="+escape(n)),i){var r=new Date,d=r.getTime()+36e5*i;r.setTime(d),s.push("expires="+r.toGMTString())}o&&s.push("path="+o),e&&s.push("domain="+e),a&&s.push(a),document.cookie=s.join(";")},t.deleteCookie=function(t){document.cookie=t+"=;expires=Fri, 31 Dec 1999 23:59:59 GMT;"},t}(),addAnimate:function(t,n,i){var o=n||"";animationNames=["animation","WebkitAnimation","OAnimation","msAnimation","MozAnimation"],animationName=function(){for(var n,i,o=animationNames.length,e=0;o>e;e++)if(n=animationNames[e],t[0].style[n]!==i)return n;return!1}(),aniEndName={animation:"animationend",WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",MozAnimation:"mozAnimationEnd"}[animationName],animationName in t[0].style?(t.addClass(o),t.on(aniEndName,function(){t.off(aniEndName),t.removeClass(o),i&&i()})):i&&i()}},o=function(n){var i={currentSize:18,article:"article_content",adjustFontSizeUp:"increase-fs",adjustFontSizeDown:"decrease-fs",cookieKey:"NewsArtiFSize",normalClass:"article-18",upClass:"article-20",downClass:"article-16"};this.options=t.extend(i,n),this.init()};o.prototype={init:function(){var n=this,o=n.options;n.articleBody=t("#"+o.article),n.UpBtn=i.getNode(o.adjustFontSizeUp),n.DownBtn=i.getNode(o.adjustFontSizeDown);var e=i.cookie.getCookie(o.cookieKey);e=window.parseInt(e),e||(e=18),n.options.currentSize=e,n._render(),this._bindEvent()},_render:function(){var t=this,n=t.options;switch(t.articleBody.removeClass(n.upClass).removeClass(n.downClass).removeClass(n.normalClass).addClass("article-"+t.options.currentSize),t.options.currentSize){case 20:t.DownBtn.removeClass("disable").attr("title","\u51cf\u5c0f\u5b57\u53f7"),t.UpBtn.addClass("disable").attr("title","");break;case 18:t.DownBtn.removeClass("disable").attr("title","\u51cf\u5c0f\u5b57\u53f7"),t.UpBtn.removeClass("disable").attr("title","");break;case 16:t.DownBtn.addClass("disable").attr("title","\u51cf\u5c0f\u5b57\u53f7"),t.UpBtn.removeClass("disable").attr("title","")}},_bindEvent:function(){var n=this;n.UpBtn.on("click",function(o){var e=t(this),a=e.attr("ani-click");n.options.currentSize<20&&(n.options.currentSize+=2,i.cookie.setCookie(n.options.cookieKey,n.options.currentSize,240,"/","news.sina.com.cn"),i.addAnimate(t(this),"ani "+a,function(){n._render()})),o.preventDefault()}),n.DownBtn.on("click",function(o){var e=t(this),a=e.attr("ani-click");n.options.currentSize>16&&(n.options.currentSize-=2,i.cookie.setCookie(n.options.cookieKey,n.options.currentSize,240,"/","news.sina.com.cn"),i.addAnimate(t(this),"ani "+a,function(){n._render()})),o.preventDefault()})}};var e=function(n){var i={btnNode:"add-fav",docId:"",addedClass:"favorited",checkApi:"//fav.mix.sina.com.cn/api/fav/check",addApi:"//fav.mix.sina.com.cn/api/fav/add",onClick:function(){},afterCheck:function(){},afterAdd:function(){}};this.options=t.extend(i,n),this.init()};e.prototype={init:function(){var t=this,n=t.options;t.btnAdd=i.getNode(n.btnNode),t.bindEvent(),t.check()},bindEvent:function(){var t=this,n=t.options;t.btnAdd.on("click",function(i){if(n.onClick.call(this,i),!t.favorited)if(window.SINA_OUTLOGIN_LAYER&&SINA_OUTLOGIN_LAYER.isLogin())t.favorited||(t.add(),i.preventDefault());else if(window.SINA_USER_PANEL){var o=SINA_USER_PANEL;try{o.setOutLoginMiddle(),o.getOutLogin().show()}catch(e){n.error({type:"no_login_init",msg:"user_panel is not inited!"})}}else n.error({type:"no_login_panel",msg:"user_panel is not loaded!"})})},triggerToggle:function(){var t=this,n=t.btnAdd,i=t.options;t.favorited?(n.addClass(i.addedClass).attr("href","http://my.sina.com.cn/#location=fav"),n.attr("target","_blank")):(n.removeClass(i.addedClass).attr("href","javascript:;"),n.attr("target",""))},check:function(){var t=this,n=t.options,i=document.domain;document.domain="sina.com.cn",t.iframePost(n.checkApi,{docid:n.docid,category:"1",source:"1"},function(n){var o=!1;n&&n.result&&n.result.status&&12===n.result.status.code&&(o=!0,t.favorited=o,t.triggerToggle(),t.opt.afterCheck.call(t),document.domain=i)},"scCheckCallback")},add:function(){var t=this,n=t.options,i=document.domain;document.domain="sina.com.cn",t.iframePost(n.addApi,{docid:n.docid,category:"1",source:"1"},function(n){var o=!1;n&&n.result&&n.result.status&&0===n.result.status.code&&(o=!0,t.favorited=o,t.triggerToggle(),t.opt.afterAdd.call(t),document.domain=i)},"scAddCallback")},iframePost:function(n,i,o,e){var a=t("body"),s=Math.abs((new Date).getTime())+"_"+Math.round(1e8*Math.random()),r="ijax_iframe_"+s,d=t('<iframe style="position:absolute;top:-9999px;height:0px;overflow:hidden;" frameborder="0" name="'+r+'" id="'+r+'"></iframe>'),c=function(t){var n=[];for(var i in t){var o=t[i];n.push('<input type="hidden" name="'+i+'" value="'+o+'" />')}return n.join("")}(i);e=e||"ijax_"+s,window[e]=function(t){"function"==typeof o&&o(t),setTimeout(function(){l.remove(),d.remove()},1e3)};var l=t('<form action="'+n+"?callback="+e+'" method="post" target="'+r+'">'+c+"</form>");a.append(d),a.append(l),l.submit()}};var a=function(n){var i={attr:"",event:"",aniClass:"",disableClass:"",onClick:function(){},onAnimationEnd:function(){}};this.options=t.extend(i,n),this.init()};a.prototype={init:function(){this.bindEvent()},bindEvent:function(){var n=this,o=n.options,e=t("["+o.attr+"]");e.on(o.event,function(){var e=t(this),a=e.attr(o.attr);e.hasClass(o.disableClass)||i.addAnimate(e,o.aniClass+" "+a,function(){o.onAnimationEnd&&o.onAnimationEnd.call(n)})})}};var s=function(n){var i={wrap:"",start:"",end:"",fixedClass:"",onFixed:function(){},onUnFixed:function(){}};this.options=t.extend(i,n),this.init()};s.prototype={init:function(){var n=this,i=n.options;n.obj=t("#"+i.wrap),n.startObj=t("#"+i.start),""!=i.end&&(n.endObj=t("#"+i.end)),this.bindEvent()},bindEvent:function(){var n=this,o=n.options;t(window).on("scroll",function(){var e=t(window).scrollTop(),a=n.startObj.offset().top;if(""!=o.end){var s=n.endObj.offset().top;n.endObj.offset().top+n.obj.height()}""!=o.end&&s>a?a>e?(n.obj.removeClass(o.fixedClass),n.obj.attr("data-isFix","0"),o.onUnFixed&&o.onUnFixed.call(n)):e>=a&&s>=e?"1"!=n.obj.attr("data-isFix")&&(n.obj.attr("data-isFix","1"),setTimeout(function(){t(window).scrollTop()>=a&&t(window).scrollTop()<=s&&(n.obj.addClass(o.fixedClass),o.onFixed&&o.onFixed.call(n),i.addAnimate(n.obj,"fadeInTop",function(){}))},600)):e>s&&(n.obj.attr("data-isFix","0"),i.addAnimate(n.obj,"fadeOutTop",function(){n.obj.removeClass(o.fixedClass)}),o.onUnFixed&&o.onUnFixed.call(n)):""==o.end&&(e>=a?(n.obj.addClass(o.fixedClass),o.onFixed&&o.onFixed.call(n)):(n.obj.removeClass(o.fixedClass),o.onUnFixed&&o.onUnFixed.call(n)))})}};var r=function(n){var i={tplId:"",wrap:"",api:"",dataType:"jsonp",apiData:{},hasData:function(t){var n;return n=!1},formatData:function(t){return t},onSuccess:function(t){},onError:function(t){}};this.options=t.extend(i,n),this.init()};r.prototype={init:function(){var n=this,i=n.options;n.TPL=t("#"+i.tplId),n.wrapObj=t("#"+i.wrap),n.getData()},getData:function(){var n=this,i=n.options,o={type:"GET",url:i.api,dataType:i.dataType,data:i.apiData,success:function(t){if(1==i.hasData(t)){var o=i.formatData(t);n.randerDom(o),i.onSuccess.call(n)}},error:function(t){i.onError.call(n)}};i.jsonpCallback&&(o.jsonpCallback=i.jsonpCallback),t.ajax(o)},randerDom:function(t){var n=this,i=n.TPL.html(),o=doT.template(i);n.wrapObj.html(o(t))}},n.AddFavorite=e,n.FontAdjustor=o,n.AddAniByAttr=a,n.SetScrollFixed=s,n.TPLRander=r,n.utils=i,window.PageTool=n}(window.jQuery);