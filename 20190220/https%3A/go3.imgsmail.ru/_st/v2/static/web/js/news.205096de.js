var affix=function(){var a,b,c=500,d=null,e=0,f=function(c,d){b=$(window),a=c,e=d,b.on("scroll.affix",g),g()},g=function(){var b=h(e);d!==b&&(d=b,a.toggleClass("affix",!b))},h=function(a){if(b.height()<c)return!0;var e=b.scrollTop();return null!==a&&d?e<a:null!==a&&e<=a};return{init:f}}(),clusterResults=function(){var a,b,c,d,e,f,g,h,i,j,k="/news_cluster_sources",l="/news_cluster_top",m=10,n=10,o=null,p=function(){c=$("#clusterResults"),d=$("#clusterLoadMore"),e=$("#clusterLoadMoreBtn"),f=$("#newsModal"),g=f.find(".modal__body"),h=f.find(".modal__title"),i=f.find("#newsSourcesPanel"),j=f.find("#newsPhotoPanel"),b=parseInt(c.attr("data-count")),a={num:n,sf:m,zqrub_msk:STP.zqrub_msk,nosp:STP.nosp,user_type:STP.userType};var k=c.attr("data-doc");k&&(a.except_doc_uid=k),x(),w(),e.on("click",v);var l=$(".cluster");l.on("click",".cluster__li:not(.cluster__li_expanded)",q).on("click",".cluster__li_expanded .js-cluster-action",z),STP.detector_touch?(l.on("click",".js-share-open-btn",r),$(document).on("click",t)):l.on("mouseover",".js-share-block",s),f.on("click",".js-modal-tab",D)},q=function(a){a.preventDefault();var b=$(this),c=b.height();b.addClass("cluster__li_expanded");var d=b.height();b.height(c),b[0].offsetHeight,b.addClass("cluster__li_animate"),b.height(d),b.transitionEnd(function(){$(this).removeClass("cluster__li_animate").height("")}),pxt("ncluster_open",b.attr("data-num"))},r=function(){var a=$(this).closest(".js-share-block"),b=a.hasClass("share_open");t(),b||(a.addClass("share_open"),o=a,u(a))},s=function(){u($(this))},t=function(a){null===o||a&&$(a.target).closest(".share_open").length||(o.removeClass("share_open"),o=null)},u=function(a){if(!a.data("plugin_share")){var b=a.closest(".cluster__li"),c=b.attr("data-doc"),d=b.attr("data-num"),e=new URI("http://go.mail.ru/news");e.setSearch("doc_uid",c),a.share({url:e.href(),text:b.find(".cluster__title-link").text()+" - Поиск Mail.Ru",image:$(".js-cluster-sources-img").attr("src").replace(/^\/\//,"https://").replace(/&(q|h)=\d+/g,""),pxtName:"nshare",pxtParams:[c,d]})}},v=function(){e.hasClass("load-more__btn_disabled")||(y(),pxt("nclmore",a.sf,a.zqrub_msk||0),$.ajax({type:"GET",url:l,data:a}).always(function(){x(),pingCounters(),$.ajax({url:(STP.pxt_host?"//"+STP.pxt_host:"")+"/0c.gif?megarandom="+STP.qid_for_load+"&h="+STP.rch,cache:!1})}).done(function(b){a.sf+=n,c.append(b),w()}))},w=function(){a.sf>=b&&d.hide()},x=function(){e.text("Показать ещё").removeClass("load-more__btn_disabled")},y=function(){e.text("Загрузка…").addClass("load-more__btn_disabled")},z=function(){var a=$(this),b=a.closest(".cluster__li");A(b.find(".cluster__title").text()),B("Загрузка…"),C(b.find(".js-cluster-sources-link")),$("#"+a.attr("data-tab")).trigger("click"),f.modal("show"),$.ajax({type:"GET",dataType:"json",url:k,data:{doc_uid:b.attr("data-doc"),rch:STP.rch}}).done(function(a){B(a.data.news_sources.results),setTimeout(function(){g.scrollTop(0)},0)}).fail(function(){B("Произошла ошибка, попробуйте еще раз.")})},A=function(a){h.text(a)},B=function(a){if("string"==typeof a)i.text(a);else if(a.length){for(var b,c,d,e=$('<ul class="result"></ul>'),f=0;f<a.length;f++)b=$('<li class="result__li"></li>'),c=$('<div class="result__wrap"></div>'),d=$('<div class="result__info">'),a[f].url&&d.append('<a class="result__sname" href="'+a[f].url+'" data-redir="'+a[f].redir_url+'" target="_blank" data-pxt="nmsrc|u|[href]|'+a[f].src_uid+"|"+a[f].number+'|extern">'+a[f].sname+"</a>"),d.append('<span class="result__pub-time js-tooltip" title="'+timeUtils.dateFull(a[f].pub_time)+" в "+timeUtils.chrono(a[f].pub_time)+'">'+timeUtils.news(a[f].pub_time)+"</span>"),c.append(d).append('<h4 class="result__title"><a class="result__title-link" href="'+a[f].url+'" data-redir="'+a[f].redir_url+'" target="_blank" data-pxt="nmsrc|h|[href]|'+a[f].src_uid+"|"+a[f].number+'|extern">'+a[f].title+"</a></h4>"),b.append(c),e.append(b);i.empty().append(e)}else i.text("Источников пока нет")},C=function(a){if(a.length){var b=$('<ul class="photo"></ul>'),c=1;a.each(function(){var a=$(this),d=a.find(".js-cluster-sources-name").text(),e=new URI(a.find(".js-cluster-sources-img").attr("src"));e.setSearch("h",190),b.append('<li class="photo__li"><a class="photo__link" href="'+this.href+'" data-redir="'+a.data("redir")+'" target="_blank" data-pxt="nmpic|[href]|'+c++ +'|extern"><img class="photo__img" src="'+e.href()+'"><span class="photo__sname">'+d+"</span></a></li>")}),j.empty().append(b)}else j.text("Фотографий пока нет")},D=function(){var a=$(this);a.hasClass("clt-actions__item_active")||(g.scrollTop(0),f.find(".clt-actions__item").removeClass("clt-actions__item_active"),a.closest(".clt-actions__item").addClass("clt-actions__item_active"),f.find(".modal__panel").removeClass("modal__panel_active"),$("#"+a.attr("data-tab")).addClass("modal__panel_active"))};return{init:p}}();direct=function(){var a=function(a,b,c){return{stat_id:a,ad_format:"direct",font_size:1,type:b,limit:c,title_font_size:1,site_bg_color:"FFFFFF",title_color:"0053BB",url_color:"1F7E00",text_color:"444444",hover_color:"F26D00",header_bg_color:"",no_sitelinks:!0,direct_favicon:!1}},b=function(){var b=document.getElementById("yaDirect"),c=document.getElementById("yaDirectBottom");if(null!==b&&null!==c){var d="yandex_context_callbacks";window[d]=window[d]||[],window[d].push(function(){Ya.Direct.insertInto(132681,"yaDirect",a(100615,"vertical",3),function(){b.className=""}),Ya.Direct.insertInto(132681,"yaDirectBottom",a(51015,"horizontal",2),function(){c.className=""}),b.className="yadirect__inner",c.className="yadirect__inner"});var e=document.getElementById("yaDirectContext");e&&e.parentNode.removeChild(e),e=document.createElement("script"),e.setAttribute("id","yaDirectContext"),e.src="//an.yandex.ru/system/context.js",e.type="text/javascript",e.async=!0;var f=document.getElementsByTagName("script")[0];f.parentNode.insertBefore(e,f)}};return{insert:b}}(),function(){var a=function(a,b,c,d){var e,c=c||"",b=b||"",d=d||100,f=new URI(a),g=f.query(!0);return f.query(_.extend(g,{w:b,h:c,q:d})),e={url:f.href()}},b=function(b,c,d,e){if(b){var c="string"==typeof c||"number"==typeof c?c:"",d="string"==typeof d||"number"==typeof d?d:"",e="string"==typeof e||"number"==typeof e?e:"";return a(b,c,d,e).url}};Handlebars.registerHelper("_preview",b)}();try{rT.profile("jsinit")}catch(e){}var STP=STP||{};!function(){$(document).on("headerReady",function(){FoundCount.init(),SearchFormSuggest.init(),Header.init(),clusterResults.init(),newsResults.init(),$("#newsModal").modal({fullHeight:!0}),$(document).tooltip({selector:".js-tooltip",delay:100,trigger:"hover focus click"}),direct.insert(),hotKeyUsage(),PageReloader.initDeferred()}),$(window).on("load",function(){if(!$(document.documentElement).hasClass("platform-TABLET")){var a=$("#newsRubrics");a.length||(a=$("#newsTop"));var b=850;a.length&&affix.init(a,b)}})}();try{rT.profile("jsinit")}catch(e){}var newsResults=function(){var a,b,c,d,e="/news",f=10,g=function(){var e=STP.query||"nwstty",f=$("#clusterResults").length&&STP.q?5:10;a={q:e,sf:f,ajax:1,nosp:STP.nosp,user_type:STP.userType,zvsrc_uid:STP.zvsrc_uid,zqrub_msk:STP.zqrub_msk},b=$("#newsResults"),c=$("#loadMore"),d=$("#loadMoreBtn"),$(document).on("mousedown","a",function(a){h(a)}),k(),j(),d.on("click",i)},h=function(a){var b=$(a.currentTarget),c=b.data("redir");c&&b.attr("href",c)},i=function(){d.hasClass("load-more__btn_disabled")||(l(),pxt("nmore",a.sf),$.ajax({type:"GET",url:e,data:a}).fail(function(){k()}).done(function(c){var d=$(c);pingCounters(),"antirobot"===d.attr("id")?antirobot.showHtmlModal(d,k):(a.sf+=f,b.append(d),k(),j(!d.hasClass("result__li")),$.ajax({url:(STP.pxt_host?"//"+STP.pxt_host:"")+"/0c.gif?megarandom="+STP.qid_for_load+"&h="+STP.rch,cache:!1}))}))},j=function(b){(b||a.sf>=STP.foundCountOld)&&c.hide()},k=function(){d.text("Показать ещё").removeClass("load-more__btn_disabled")},l=function(){d.text("Загрузка…").addClass("load-more__btn_disabled")};return{init:g}}();!function(a){var b="tooltip",c={animation:!0,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip__arrow"></div><div class="tooltip__inner"></div></div>',trigger:"hover focus",title:"",delay:0,container:!1,viewport:{selector:"body",padding:0}},d=function(d,e){this.enabled=!0,this.$element=a(d),this.options=a.extend({},c,e),this.options.delay&&"number"==typeof this.options.delay&&(this.options.delay={show:this.options.delay,hide:this.options.delay}),this._defaults=c,this._name=b,this.$viewport=this.options.viewport&&a(this.options.viewport.selector||this.options.viewport),this.timeout=null,this.hoverState=null,this.inState={click:!1,hover:!1,focus:!1},this.init()};d.prototype.init=function(){if(this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this._name+" on the window.document object!");for(var b=this.options.trigger.split(" "),c=b.length;c--;){var d=b[c];if("click"===d)this.$element.on("click."+this._name,this.options.selector,a.proxy(this.toggle,this));else if("manual"!==d){var e="hover"===d?"mouseenter":"focusin",f="hover"===d?"mouseleave":"focusout";this.$element.on(e+"."+this._name,this.options.selector,a.proxy(this.enter,this)),this.$element.on(f+"."+this._name,this.options.selector,a.proxy(this.leave,this))}}this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},d.prototype.getDelegateOptions=function(){var b={},c=this._defaults;return this._options&&a.each(this._options,function(a,d){c[a]!==d&&(b[a]=d)}),b},d.prototype.enter=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("plugin_"+this._name);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("plugin_"+this._name,c)),b instanceof a.Event&&(c.inState["focusin"===b._name?"focus":"hover"]=!0),c.tip().hasClass("tooltip_animate")||"in"===c.hoverState?void(c.hoverState="in"):(clearTimeout(c.timeout),c.hoverState="in",c.options.delay&&c.options.delay.show?void(c.timeout=setTimeout(function(){"in"===c.hoverState&&c.show()},c.options.delay.show)):c.show())},d.prototype.isInStateTrue=function(){for(var a in this.inState)if(this.inState[a])return!0;return!1},d.prototype.leave=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("plugin_"+this._name);if(c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("plugin_"+this._name,c)),b instanceof a.Event&&(c.inState["focusout"===b._name?"focus":"hover"]=!1),!c.isInStateTrue())return clearTimeout(c.timeout),c.hoverState="out",c.options.delay&&c.options.delay.hide?void(c.timeout=setTimeout(function(){"out"===c.hoverState&&c.hide()},c.options.delay.hide)):c.hide()},d.prototype.show=function(){if(this.hasContent()&&this.enabled){var b=a.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(!b)return;var c=this,d=this.tip();this.setContent(),this.options.animation&&d.addClass("tooltip_fade"),d.detach().css({top:0,left:0,display:"block"}).data("plugin_"+this._name,this),this.options.container?d.appendTo(this.options.container):d.insertAfter(this.$element);var e=this.getPosition(),f=d[0].offsetWidth,g=d[0].offsetHeight,h=this.getCalculatedOffset(e,f,g);this.applyPlacement(h);var i=function(){var a=c.hoverState;c.hoverState=null,"out"===a&&c.leave(c)};a.support.transitionEnd&&this.$tip.hasClass("tooltip_fade")?d.transitionEnd(i):i()}},d.prototype.applyPlacement=function(b){var c=this.tip(),d=c[0].offsetWidth,e=c[0].offsetHeight,f=parseInt(c.css("margin-top"),10),g=parseInt(c.css("margin-left"),10);isNaN(f)&&(f=0),isNaN(g)&&(g=0),b.top+=f,b.left+=g,a.offset.setOffset(c[0],a.extend({using:function(a){c.css({top:Math.round(a.top),left:Math.round(a.left)})}},b),0),c.addClass("tooltip_animate");var h=c[0].offsetWidth,i=c[0].offsetHeight;i!==e&&(b.top=b.top+e-i);var j=this.getViewportAdjustedDelta(b,h);j.left?b.left+=j.left:b.top+=j.top;var k=2*j.left-d+h;c.offset(b),this.replaceArrow(k,c[0].offsetWidth)},d.prototype.replaceArrow=function(a,b){this.arrow().css({left:50*(1-a/b)+"%",top:""})},d.prototype.setContent=function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip__inner").text(b),a.removeClass("tooltip_fade tooltip_animate")},d.prototype.hide=function(b){function c(){"in"!==d.hoverState&&e.detach(),b&&b()}var d=this,e=a(this.$tip);return e.removeClass("tooltip_animate"),a.support.transitionEnd&&this.$tip.hasClass("tooltip_fade")?e.transitionEnd(c):c(),this.hoverState=null,this},d.prototype.fixTitle=function(){(this.$element.attr("title")||"string"!=typeof this.$element.attr("data-original-title"))&&this.$element.attr("data-original-title",this.$element.attr("title")||"").attr("title","")},d.prototype.hasContent=function(){return this.getTitle()},d.prototype.getPosition=function(b){b=b||this.$element;var c=b[0],d="BODY"===c.tagName,e=c.getBoundingClientRect();null===e.width&&(e=a.extend({},e,{width:e.right-e.left,height:e.bottom-e.top}));var f=d?{top:0,left:0}:b.offset(),g={scroll:d?document.documentElement.scrollTop||document.body.scrollTop:b.scrollTop()},h=d?{width:a(window).width(),height:a(window).height()}:null;return a.extend({},e,g,h,f)},d.prototype.getCalculatedOffset=function(a,b,c){return{top:a.top-c,left:a.left+a.width/2-b/2}},d.prototype.getViewportAdjustedDelta=function(a,b){var c={top:0,left:0};if(!this.$viewport)return c;var d=this.options.viewport&&this.options.viewport.padding||0,e=this.getPosition(this.$viewport),f=a.left-d,g=a.left+d+b;return f<e.left?c.left=e.left-f:g>e.right&&(c.left=e.left+e.width-g),c},d.prototype.getTitle=function(){return this.$element.attr("data-original-title")||this.options.title},d.prototype.tip=function(){if(!this.$tip&&(this.$tip=a(this.options.template),1!==this.$tip.length))throw new Error(this._name+" `template` option must consist of exactly 1 top-level element!");return this.$tip},d.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip__arrow")},d.prototype.enable=function(){this.enabled=!0},d.prototype.disable=function(){this.enabled=!1},d.prototype.toggleEnabled=function(){this.enabled=!this.enabled},d.prototype.toggle=function(b){var c=this;b?(c=a(b.currentTarget).data("plugin_"+this._name),c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("plugin_"+this._name,c),c.inState.click=!c.inState.click,c.isInStateTrue()?c.enter(c):c.leave(c))):c.tip().hasClass("tooltip_animate")?c.leave(c):c.enter(c)},d.prototype.destroy=function(){var a=this;clearTimeout(this.timeout),this.hide(function(){a.$element.off("."+a._name).removeData("plugin_"+a._name),a.$tip&&a.$tip.detach(),a.$tip=null,a.$arrow=null,a.$viewport=null})},a.fn[b]=function(c){return this.each(function(){var e="object"==typeof c&&c,f=a.data(this,"plugin_"+b);if(!f){if(/destroy|hide/.test(c))return;a.data(this,"plugin_"+b,f=new d(this,e))}"string"==typeof c&&f[c]()})}}(jQuery);