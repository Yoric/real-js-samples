/*global window, global, document, setTimeout, setInterval, location, console, APP, Element */
function log(){"use strict";var c=global.console;c&&(c.log.apply?c.log.apply(c,arguments):c.log(Array.prototype.join.call(arguments,", ")))}if(void 0===global)var global=this;!function(obj,fn,arr){"use strict";function assign(target){var args=slice.call(arguments,1);try{args.forEach(function(source){Object.keys(source||{}).forEach(function(key){target[key]=source[key]},target)})}catch(ex){console.error(ex)}return target}var hasOwn=obj.hasOwnProperty,toString=obj.toString,slice=arr.slice,define;fn.setter=function(){var fn=this;return function(){var oThis=this,args=Array.prototype.slice.call(arguments),a=args[0];return a?"string"==typeof a?(fn.apply(this,args),this):((Object.keys(Object(a))||[]).forEach(function(name){args.slice(2),args.splice(0,0,name,a[name]),fn.apply(oThis,args)}),this):this}},fn.getter=function(){var oThis=this;return function(a){var args,result,i;if("string"!=typeof a?args=a:arguments.length>1&&(args=arguments),args)for(result={},i=0;i<args.length;i+=1)result[args[i]]=oThis.call(this,args[i]);else result=oThis.call(this,a);return result}},fn.inherits=function(proto){var ext=slice.call(arguments,1)[0]||{},func=this,uber=proto,p=this.prototype;return ext.constructor={value:func},proto&&Object!==proto.constructor?("function"==typeof proto?proto=proto.prototype:uber=proto.constructor,ext.uber={value:uber.prototype,configurable:!0,writable:!0},this.prototype=Object.create(proto,ext),Object.assign(func.prototype,p),this):(ext.uber={value:Object.prototype,configurable:!0,writable:!0},Object.defineProperties(this.prototype,ext),this)},define=function(name,value){var isDescriptor;if(hasOwn.call(this,name)||void 0===value)return this;isDescriptor="[object Object]"===toString.call(value)&&void 0!==value.value;try{Object.defineProperty(this,name,isDescriptor?value:{value:value,configurable:!0,enumerable:!0,writable:!0})}catch(ex){this[name]=isDescriptor?value.value:value}return this}.setter(),define.call(fn,{assign:function(name,value){define.call(this,name,value)}.setter(),implement:function(name,value){define.call(this.prototype,name,value)}.setter()}),fn.augment=fn.assign,Object.augment({is:function(a,b){return 0===a&&0===b?1/a==1/b:a!==a?b!==b:a===b},mixin:function(target,source){var property;try{Object.keys(source).forEach(function(property){Object.defineProperty(target,property,Object.getOwnPropertyDescriptor(source,property))})}catch(ex){for(property in source)source.hasOwnProperty(property)&&(target[property]=source[property])}return target},create:function(proto){function F(){}return F.prototype=proto,proto&&(F.prototype.constructor=F),new F},keys:function(o){var ret=[],k;for(k in o)Object.prototype.hasOwnProperty.call(o,k)&&ret.push(k);return ret},setPrototypeOf:function(obj,proto){try{obj.__proto__=proto}catch(ex){if("object"!=typeof obj&&!/^(object|function)$/i.test(typeof proto))throw new TypeError("Expected both the arguments to be objects.");var F=function(obj){var ownPropertyNames=Object.getOwnPropertyNames(obj),ln=ownPropertyNames.length,ownPropertyName,i;for(i=0;i<ln;i+=1)ownPropertyName=ownPropertyNames[i],this[ownPropertyName]=obj[ownPropertyName]};return F.prototype=proto,new F(obj)}return obj}}),hasOwn.call(Object,"assign")||Object.defineProperty(Object,"assign",{value:function(target){var to,args;try{if(void 0===target||null===target)throw new TypeError("Cannot convert first argument to object");to=Object(target),args=slice.call(arguments,1),args.forEach(function(source){var keys;void 0!==source&&null!==source&&(keys=Object.keys(Object(source)),keys.forEach(function(key){var desc=Object.getOwnPropertyDescriptor(source,key);void 0!==desc&&desc.enumerable&&(to[key]=source[key])}))})}catch(ex){assign.apply(Object,slice.call(arguments))}return to},configurable:!0}),Function.implement({bind:function(context){var oThis=this,args=slice.call(arguments,1);return function(){return oThis.apply(context,args.concat(slice.call(arguments)))}},memoize:function(){var oThis=this,cache={};return void 0===JSON?oThis:function(){var args=Array.prototype.slice.call(arguments),key=JSON.stringify(args);return cache[key]||(cache[key]=oThis.apply(oThis,args)),cache[key]}},pass:function(args,bind){var oThis=this;return args=args?slice.call(args):[],function(){return oThis.apply(bind||global,args||arguments)}},delay:function(time,bind,args){return setTimeout(this.pass(args||[],bind),time)},cyclic:function(time,bind,args){return setInterval(this.pass(args||[],bind),time)},getName:function(){var m=this.toString().match(/^function\s(\w+)/);return m?m[1]:"anonymous"},require:function(req,bind,args){return APP.require(req,this.pass(args||[],bind))}}),String.implement({trim:function(){return this.replace(/(^[\s\xA0]+|[\s\xA0]+$)/g,"")},contains:function(){return-1!==String.prototype.indexOf.apply(this,arguments)},includes:function(searchElement){var O=Object(this),ln=Number.parseInt(O.length)||0,fromIndex,index,currentElement;if(0===ln)return!1;for(fromIndex=Number.parseInt(arguments[1])||0,fromIndex>=0?index=fromIndex:(index=ln+fromIndex)<0&&(index=0);index<ln;){if(currentElement=O[index],searchElement===currentElement||searchElement!==searchElement&&currentElement!==currentElement)return!0;index+=1}return!1},endsWith:function(searchString,position){position=position||this.length,position-=searchString.length;var lastIndex=this.lastIndexOf(searchString);return-1!==lastIndex&&lastIndex===position},startsWith:function(searchString,position){return position=position||0,this.indexOf(searchString,position)===position},repeat:function(count){return new Array(0<=count?Number.parseInt(count,10)+1:-1).join(this)},trimToSpace:function(glue){return this.trim().replace(/(\s+)/gm,void 0!==glue?glue:" ")},toCamelCase:function(){return String(this).replace(/-\D/g,function(match){return match.charAt(1).toUpperCase()})},toDash:function(){return this.replace(/([A-Z])/g,function(match){return"-"+match.toLowerCase()})},ucfirst:function(){return this.charAt(0).toUpperCase()+this.substr(1)},test:function(regexp){return regexp.test(this)},toInt:function(base){return parseInt(this,base||10)},toFloat:function(){return parseFloat(this)},stripScripts:function stripScripts(text){return this.replace(/(<\s*script[^>]*>[\s\S]*?<\s*\/\s*script[^>]*>|<\s*(\/\s*)?script[^>]*>)/gim,text||"")},htmlEncode:function(){var chars={"<":"&lt;",">":"&gt;",'"':"&quot;"};return this.replace(new RegExp(Object.keys(chars).join("|"),"mg"),function(char){return chars[char]})}}),Array.assign({isArray:function(o){return"[object Array]"===Object.prototype.toString.call(o)||o instanceof Array},of:function(){return slice.call(arguments)},from:function(arrayLike,mapfn,thisArg){return Object(arrayLike).length?arr.map.call(arrayLike,"function"==typeof mapfn?mapfn:function(item){return item},thisArg):[]}}),Array.implement({contains:{value:function contains(item){return-1<arr.indexOf.call(this,item)},writable:!0,enumerable:!1,configurable:!0},empty:{value:function empty(){return this.length=0,this},writable:!0,enumerable:!1,configurable:!0},chunk:function(n){return this.length?[this.slice(0,n)].concat(this.slice(n).chunk(n)):[]},includes:function(element,fromIndex){for(var i=fromIndex||0;i<this.length;i++)if(element===this[i]||element!==element&&this[i]!==this[i])return!0;return!1}}),Number.assign({sign:function(value){var number=+value;return 0===number?number:isNaN(number)?number:number<0?-1:1},isInteger:function isInteger(nVal){return"number"==typeof nVal&&Number.isFinite(nVal)&&nVal>-9007199254740992&&nVal<9007199254740992&&Math.floor(nVal)===nVal},parseInt:global.parseInt,parseFloat:global.parseFloat,isNaN:global.isNaN,isFinite:global.isFinite}),Number.implement({limit:function(min,max){return Math.min(max,Math.max(min,this))}}),Date.augment({now:function(){return+new Date}}),define.call(JSON,{evalToObject:function(str){try{return str=/^[\{|\[].*[\]\}]/.test(str)?"("+str+")":"({"+str+"})",eval(str)}catch(ex){return""}},splitToParse:function(str,glue){var sp,tmp,ln,i,ret={};if(!str)return null;for(sp=str.split(glue||","),i=0,ln=sp.length;i<ln;i+=1)tmp=sp[i].split(":"),tmp[0]&&(ret[tmp[0].trim()]=(tmp.slice(1).join(":")||"").trim());return ret}}),function(){function namespace(object,key){var store={identity:key},valueOf=object.valueOf;return Object.defineProperty(object,"valueOf",{value:function(value){return value!==key||this!==object?valueOf.apply(this,slice.call(arguments)):store},configurable:!0}),store}function name(){var key={};return function(object){var store=object.valueOf(key);return void 0!==store&&store!==object&&store.identity===key?store:namespace(object,key)}}function guard(key){if(key!==Object(key))throw new TypeError("value is not a non-null object");return key}function WeakMap(){var privates=name();return{has:function(object){return"value"in privates(object)},get:function(object,fallback){var store=privates(guard(object));return store.hasOwnProperty("value")?store.value:fallback},set:function(object,value){privates(guard(object)).value=value},delete:function(key){return delete privates(guard(key)).value}}}var slice=Array.prototype.slice;global.WeakMap||Object.defineProperties(global,{WeakMap:{value:WeakMap}})}(),function(){function Map(){if(!(this instanceof Map))return new Map;privates.has(this)||privates.set(this,{keys:[],values:[]})}function Set(){var args,priv=[];if(!(this instanceof Set))return new Set;privates.set(this,[]),args=Array.prototype.slice.call(arguments),args.length&&priv.push.apply(priv,args),privates.set(this,priv)}var privates=new WeakMap;Object.defineProperties(Map.prototype,{size:{get:function(){return privates.get(this).keys.length},configurable:!0},clear:{value:function(){var priv=privates.get(this);priv.keys.length=0,priv.values.length=0},configurable:!0,enumerable:!1,writable:!0},delete:{value:function(key){var priv=privates.get(this),index=priv.keys.indexOf(key);return-1!==index&&(priv.keys.splice(index,1),priv.values.splice(index,1),!0)},configurable:!0,enumerable:!1,writable:!0},entries:{value:function(){},configurable:!0,enumerable:!1,writable:!0},forEach:{value:function(callbackfn,thisArg){var priv=privates.get(this),result,ln=this.size,i;for(i=0;i<ln;i+=1)if(priv.keys[i]&&priv.values[i]&&!1===(result=callbackfn.call(thisArg||this,priv.values[i],priv.keys[i])))throw new TypeError},configurable:!0,enumerable:!1,writable:!0},get:{value:function(key){var priv=privates.get(this),index=priv.keys.indexOf(key);if(-1!==index)return priv.values[index]},configurable:!0,enumerable:!1,writable:!0},has:{value:function(key){var priv=privates.get(this);return priv&&priv.keys&&-1!==priv.keys.indexOf(key)},configurable:!0,enumerable:!1,writable:!0},iterator:{value:function(){},configurable:!0,enumerable:!1,writable:!0},keys:{value:function(){},configurable:!0,enumerable:!1,writable:!0},set:{value:function(key,value){var priv=privates.get(this),index;index=priv.keys.indexOf(key),-1===index?(priv.keys.push(key),priv.values.push(value)):priv.values[index]=value},configurable:!0,enumerable:!1,writable:!0}}),Object.defineProperties(Set.prototype,{size:{get:function(){return privates.get(this).length}},add:{value:function(value){var data=privates.get(this),index=data.indexOf(value);-1===index?data.push(value):data[index]=value}},clear:{value:function(){privates.get(this).length=0}},delete:{value:function(value){var data=privates.get(this),index=data.indexOf(value);return-1!==index&&(data.splice(index,1),!0)}},entries:{value:function(){}},forEach:{value:function(callbackfn,thisArg){privates.get(this).forEach(callbackfn,thisArg)}},has:{value:function(value){return-1!==privates.get(this).indexOf(value)}},iterator:{value:function(){}},keys:{value:function(){}},values:{value:function(){}}}),global.Map||Object.defineProperties(global,{Map:{value:Map},Set:{value:Set}})}(),/*!
     * Object.observe polyfill - v0.2.4
     * by Massimo Artizzu (MaxArt2501)
     *
     * https://github.com/MaxArt2501/object-observe
     *
     * Licensed under the MIT License
     * See LICENSE for details
     */
Object.observe||function(O,A,root,_undefined){var observed,handlers,defaultAcceptList=["add","update","delete","reconfigure","setPrototype","preventExtensions"],inArray=A.prototype.indexOf?A.indexOf||function(array,pivot,start){return A.prototype.indexOf.call(array,pivot,start)}:function(array,pivot,start){for(var i=start||0;i<array.length;i+=1)if(array[i]===pivot)return i;return-1},createMap=function(){return new Map},getProps=O.getOwnPropertyNames,getPrototype=O.getPrototypeOf,getDescriptor=O.defineProperties&&O.getOwnPropertyDescriptor,nextFrame=root.requestAnimationFrame||root.webkitRequestAnimationFrame||function(){var initial=+new Date,last=initial;return function(func){return setTimeout(function(){func((last=+new Date)-initial)},17)}}(),doObserve=function(object,handler,acceptList){var data=observed.get(object);data?(performPropertyChecks(data,object),setHandler(object,data,handler,acceptList)):(data=createObjectData(object),setHandler(object,data,handler,acceptList),1===observed.size&&nextFrame(runGlobalLoop))},createObjectData=function(object,data){var props=getProps(object),values=[],descs,i=0;if(data={handlers:createMap(),frozen:!!O.isFrozen&&O.isFrozen(object),extensible:!O.isExtensible||O.isExtensible(object),proto:getPrototype&&getPrototype(object),properties:props,values:values,notifier:retrieveNotifier(object,data)},getDescriptor)for(descs=data.descriptors=[];i<props.length;)descs[i]=getDescriptor(object,props[i]),values[i]=object[props[i++]];else for(;i<props.length;)values[i]=object[props[i++]];return observed.set(object,data),data},performPropertyChecks=function(){var updateCheck=getDescriptor?function(object,data,idx,except,descr){var key=data.properties[idx],value=object[key],ovalue=data.values[idx],odesc=data.descriptors[idx];"value"in descr&&(ovalue===value?0===ovalue&&1/ovalue!=1/value:ovalue===ovalue||value===value)&&(addChangeRecord(object,data,{name:key,type:"update",object:object,oldValue:ovalue},except),data.values[idx]=value),!odesc.configurable||descr.configurable&&descr.writable===odesc.writable&&descr.enumerable===odesc.enumerable&&descr.get===odesc.get&&descr.set===odesc.set||(addChangeRecord(object,data,{name:key,type:"reconfigure",object:object,oldValue:ovalue},except),data.descriptors[idx]=descr)}:function(object,data,idx,except){var key=data.properties[idx],value=object[key],ovalue=data.values[idx];(ovalue===value?0===ovalue&&1/ovalue!=1/value:ovalue===ovalue||value===value)&&(addChangeRecord(object,data,{name:key,type:"update",object:object,oldValue:ovalue},except),data.values[idx]=value)},deletionCheck=getDescriptor?function(object,props,proplen,data,except){for(var i=props.length,descr;proplen&&i--;)null!==props[i]&&(descr=getDescriptor(object,props[i]),proplen--,descr?updateCheck(object,data,i,except,descr):(addChangeRecord(object,data,{name:props[i],type:"delete",object:object,oldValue:data.values[i]},except),data.properties.splice(i,1),data.values.splice(i,1),data.descriptors.splice(i,1)))}:function(object,props,proplen,data,except){for(var i=props.length;proplen&&i--;)null!==props[i]&&(addChangeRecord(object,data,{name:props[i],type:"delete",object:object,oldValue:data.values[i]},except),data.properties.splice(i,1),data.values.splice(i,1),proplen--)};return function(data,object,except){if(data.handlers.size&&!data.frozen){var props,proplen,keys,values=data.values,descs=data.descriptors,i=0,idx,key,value,proto,descr;if(data.extensible)if(props=data.properties.slice(),proplen=props.length,keys=getProps(object),descs){for(;i<keys.length;)key=keys[i++],idx=inArray(props,key),descr=getDescriptor(object,key),-1===idx?(addChangeRecord(object,data,{name:key,type:"add",object:object},except),data.properties.push(key),values.push(object[key]),descs.push(descr)):(props[idx]=null,proplen--,updateCheck(object,data,idx,except,descr));deletionCheck(object,props,proplen,data,except),O.isExtensible(object)||(data.extensible=!1,addChangeRecord(object,data,{type:"preventExtensions",object:object},except),data.frozen=O.isFrozen(object))}else{for(;i<keys.length;)key=keys[i++],idx=inArray(props,key),value=object[key],-1===idx?(addChangeRecord(object,data,{name:key,type:"add",object:object},except),data.properties.push(key),values.push(value)):(props[idx]=null,proplen--,updateCheck(object,data,idx,except));deletionCheck(object,props,proplen,data,except)}else if(!data.frozen){for(;i<props.length;i++)key=props[i],updateCheck(object,data,i,except,getDescriptor(object,key));O.isFrozen(object)&&(data.frozen=!0)}getPrototype&&(proto=getPrototype(object))!==data.proto&&(addChangeRecord(object,data,{type:"setPrototype",name:"__proto__",object:object,oldValue:data.proto}),data.proto=proto)}}}(),runGlobalLoop=function(){observed.size&&(observed.forEach(performPropertyChecks),handlers.forEach(deliverHandlerRecords),nextFrame(runGlobalLoop))},deliverHandlerRecords=function(hdata,handler){var records=hdata.changeRecords;records.length&&(hdata.changeRecords=[],handler(records))},retrieveNotifier=function(object,data){return arguments.length<2&&(data=observed.get(object)),data&&data.notifier||{notify:function(changeRecord){var test=changeRecord.type,data=observed.get(object);if(data){var recordCopy={object:object},prop;for(prop in changeRecord)"object"!==prop&&(recordCopy[prop]=changeRecord[prop]);addChangeRecord(object,data,recordCopy)}},performChange:function(changeType,func){if("string"!=typeof changeType)throw new TypeError("Invalid non-string changeType");if("function"!=typeof func)throw new TypeError("Cannot perform non-function");var data=observed.get(object),prop,changeRecord,thisObj=arguments[2],result=thisObj===_undefined?func():func.call(thisObj);if(data&&performPropertyChecks(data,object,changeType),data&&result&&"object"==typeof result){changeRecord={object:object,type:changeType};for(prop in result)"object"!==prop&&"type"!==prop&&(changeRecord[prop]=result[prop]);addChangeRecord(object,data,changeRecord)}}}},setHandler=function(object,data,handler,acceptList){var hdata=handlers.get(handler);hdata||handlers.set(handler,hdata={observed:createMap(),changeRecords:[]}),hdata.observed.set(object,{acceptList:acceptList.slice(),data:data}),data.handlers.set(handler,hdata)},addChangeRecord=function(object,data,changeRecord,except){data.handlers.forEach(function(hdata){var acceptList=hdata.observed.get(object).acceptList;("string"!=typeof except||-1===inArray(acceptList,except))&&inArray(acceptList,changeRecord.type)>-1&&hdata.changeRecords.push(changeRecord)})};observed=createMap(),handlers=createMap(),O.observe=function observe(object,handler,acceptList){if(!object||"object"!=typeof object&&"function"!=typeof object)throw new TypeError("Object.observe cannot observe non-object");if("function"!=typeof handler)throw new TypeError("Object.observe cannot deliver to non-function");if(O.isFrozen&&O.isFrozen(handler))throw new TypeError("Object.observe cannot deliver to a frozen function object");if(acceptList===_undefined)acceptList=defaultAcceptList;else if(!acceptList||"object"!=typeof acceptList)throw new TypeError("Third argument to Object.observe must be an array of strings.");return doObserve(object,handler,acceptList),object},O.unobserve=function unobserve(object,handler){if(null===object||"object"!=typeof object&&"function"!=typeof object)throw new TypeError("Object.unobserve cannot unobserve non-object");if("function"!=typeof handler)throw new TypeError("Object.unobserve cannot deliver to non-function");var hdata=handlers.get(handler),odata;return hdata&&(odata=hdata.observed.get(object))&&(hdata.observed.forEach(function(odata,object){performPropertyChecks(odata.data,object)}),nextFrame(function(){deliverHandlerRecords(hdata,handler)}),1===hdata.observed.size&&hdata.observed.has(object)?handlers.delete(handler):hdata.observed.delete(object),1===odata.data.handlers.size?observed.delete(object):odata.data.handlers.delete(handler)),object},O.getNotifier=function getNotifier(object){if(null===object||"object"!=typeof object&&"function"!=typeof object)throw new TypeError("Object.getNotifier cannot getNotifier non-object");return O.isFrozen&&O.isFrozen(object)?null:retrieveNotifier(object)},O.deliverChangeRecords=function deliverChangeRecords(handler){if("function"!=typeof handler)throw new TypeError("Object.deliverChangeRecords cannot deliver to non-function");var hdata=handlers.get(handler);hdata&&(hdata.observed.forEach(function(odata,object){performPropertyChecks(odata.data,object)}),deliverHandlerRecords(hdata,handler))}}(Object,Array,global)}(Object.prototype,Function.prototype,Array.prototype,String.prototype),global.APP=function APP(){"use strict";var args=Array.prototype.slice.call(arguments),fn,box=APP.box,appbeta=APP.beta||"on"===global.localStorage.appbeta;if(3===args.length&&/string/.test(typeof args[1])&&Array.isArray(args[1])&&"function"==typeof args[2])return APP.define.apply(APP(),args);if(appbeta&&1<args.length&&"function"==typeof args[args.length-1])return fn=args.pop(),args.push(fn.bind(box)),APP.require.apply(APP,args);switch(APP.typeOf(args[0])){case"string":if(!args[0])break;if(/^[a-zA-Z0-9]{32}$/i.test(args[0])){APP.require.apply(APP,args);break}if(APP.core.hasModule(args[0])){APP.core.start.apply(APP.core,args);break}return APP.autoload.apply(APP,args);case"function":if(appbeta)return fn=args[0],fn.apply(box,args.slice(1));box.domready(args[0])}return box},APP.version="1.5 beta",function(app){"use strict";function Namespace(){throw new TypeError("Illegal constructor")}function Observer(){throw new TypeError("Illegal constructor")}function Sandbox(){throw new TypeError("Illegal constructor")}var hasOwn=Object.prototype.hasOwnProperty,toString=Object.prototype.toString,slice=Array.prototype.slice,box,mediator,filesMD5={},filesMap={},globalDefine=global.define,listeners=new WeakMap;mediator=function(){var register=Object.create(Namespace.prototype),channels=Object.create(Namespace.prototype),handles=[];return{subscribe:function(name,handle){var ix,k;{if(!name||!handle||"object"!=typeof handle)return"function"!=typeof handle?this:(handles&&!handles.contains(handle)&&(ix=handles.push(handle),channels.setArrayItem(name,ix-1)),this);for(k in handle)handle.hasOwnProperty(k)&&this.subscribe(name+"."+k,handle[k])}}.setter(),unsubscribe:function(name,handle){var index,ix,list;if(!handle)return void channels.removeItem(name);index=handles.indexOf(handle),list=channels.getItem(name)||[],ix=list.indexOf(index),list.splice(ix,1)},publish:function(name){var args=slice.call(arguments,1),results=[],list,ln,i;for(name||log(channels),list=channels.getItem(name)||[],i=0,ln=list.length;i<ln;i+=1)try{results.push(handles[list[i]].apply(this,args))}catch(ex){log("Mediator publish error: "+ex+" | channel name: "+name),console.error(ex.stack)}return results.length>1?results:results[0]},setItem:function(name,value){return register.setItem(name,value)},getItem:function(name){return register.getItem(name)},removeItem:function(name){return register.removeItem(name)}}}(),Namespace.implement({setItem:function(name,value){var parent=this,parts=name.split("."),last=parts.pop(),ln=parts.length,i;for(i=0;i<ln;i+=1)parent=parent[parts[i]]=parent[parts[i]]||{};if((typeof parent).test(/string|number|boolean|undefined/))throw new TypeError("Element is not object");parent[last]=value}.setter(),getItem:function(name){var parts,parent=this,ln,i;if(!name)return parent;for(parts=name.split("."),i=0,ln=parts.length;i<ln;i+=1)if(!(parent=parent[parts[i]]))return;return parent},removeItem:function(name){var parts=(name||"").split("."),last=parts.pop();return delete Namespace.prototype.getItem.call(this,parts.join("."))[last]},hasItem:function(name){return!!Namespace.prototype.getItem.call(this,name)},setArrayItem:function(name,value){var parts=name.split("."),parent=this,ln=parts.length,i;for(i=0;i<ln;i+=1)parent=parent[parts[i]]=parent[parts[i]]||[],parent.contains(value)||parent.push(value);return parent},removeArrayItem:function(name,value){var parts=name.split("."),parent=this,parentsData=[],index;parts.every(function(part){var oldParent=parent;return!!(parent=parent[part])&&(parentsData.unshift({parent:oldParent,part:part}),index=parent.indexOf(value),-1!==index&&parent.splice(index,1),!0)}),parentsData.every(function(data){var parent=data.parent,part=data.part;return 0===parent[part].length&&(delete parent[part],!0)})}}),Observer.assign({prepare:function(obj){var opt;return listeners.has(obj)?listeners.get(obj):(opt={handles:{}},Array.isArray(obj.handles)&&(opt.handles=obj.handles),listeners.set(obj,opt),listeners.get(obj))}}).implement({on:function(type,handle){var handles,handleType=APP.typeOf(handle),ix,k;{if(!type||!handle||"object"!==handleType){if("function"!==handleType)throw new TypeError("Handle must be a function");if(!type)throw new TypeError("Event type can not be empty");return handles=Observer.prepare(this).handles,ix=Array.prototype.indexOf.call(handles,handle),-1===ix&&(ix=Array.prototype.push.call(handles,handle)-1),"string"===APP.typeOf(type)&&(type=type.split(/\s+/)),type.forEach(function(name){Namespace.prototype.setArrayItem.call(handles,name,handle)}),this}for(k in handle)handle.hasOwnProperty(k)&&this.on(type+"."+k,handle[k])}}.setter(),off:function(type,handle){var listeners=Observer.prepare(this),handles=listeners.handles;if(handles){if("number"==typeof handle&&(handle=handles[handle]),!handle)return void(Namespace.prototype.getItem.call(handles,type)||[]).slice().forEach(function(handle){this.off(type,handle)}.bind(this));Namespace.prototype.removeArrayItem.call(handles,type,handle)}},notify:function(type){var args=slice.call(arguments,1),listeners=Observer.prepare(this),handles=listeners.handles,results=[],list,ln,i;if(handles){if(!type)return void log(handles);for(list=Namespace.prototype.getItem.call(handles,type)||[],i=0,ln=list.length;i<ln;i+=1)try{results.push(list[i].apply(this.context||this,args))}catch(ex){console.error("Observer "+(this.observername||"[noname]")+" notify error: "+ex+" | type : "+type),console.error(ex.stack)}return results.length>1?results:results[0]}}}),Observer.implement({trigger:Observer.prototype.notify,fire:Observer.prototype.notify}),Sandbox.prototype=Object.create(mediator,{constructor:{value:Sandbox}}),Sandbox.implement({plugin:Sandbox.implement.bind(Sandbox),define:function(name,value){Namespace.prototype.setItem.call(this,name,value)}.setter()}),app.box=box=Object.create(Sandbox.prototype),box.plugin({namespace:{add:function(name,value,cx){return Namespace.prototype.setItem.call(cx||this,name,value)},grab:function(name,cx){return Namespace.prototype.getItem.call(cx||this,name)},remove:function(name,cx){return Namespace.prototype.removeItem.call(cx||this,name)}}}),app.mixin=app.extend=function(){var args=slice.call(arguments),target=args[0];return"boolean"==typeof target&&(args=slice.call(args,1)),target=target||{},Object.assign.apply(target,args)},app.assign({files:function(){var ret=Object.create(Array.prototype);return ret.prepareList=function(list){var k;for(k in list)hasOwn.call(list,k)&&(app.files.push(k),filesMD5[k]=list[k])},ret.prepareLists=function(list){var k;for(k in list)hasOwn.call(list,k)&&ret.prepareList(list[k])},ret.getItem=function(name,nocompress){var src;return name?(src=filesMD5[name]||filesMap[name],src&&(nocompress||app.files.nocompress)&&(src=src.replace(/(-rev.*)\.(js|css)$/i,function($0,$1,$2){return["js"===$2?".src-verified.async":"src.async",$2].join(".")})),src):Object.assign({},filesMD5,filesMap)},ret.setNamespace=function(src,name){var ext;/^[a-zA-Z0-9]{32}$/i.test(src)&&(src=APP.files.getItem(src)),src&&(src=src.replace(/\?.*$/,""),(ext=/[^.]+$/i.exec(src)[0])&&("string"!==app.typeOf(name)&&(name=src.replace(/(.*)\/([^\/]+)$/,function($0,$1,$2){var n=$1.split("/").pop();return/^(core|common)$/i.test(n)?n="":n+=".",n+$2.replace(/(\.src|-rev)(.*)\.(js|css)/i,"")})),filesMap[name]=src,Namespace.prototype.setItem.call(app.files[ext],name,src)))}.setter(),ret.js={},ret.css={},ret.nocompress=Boolean(localStorage.filesNoCompress),ret}(),typeOf:function(element,comparison){var type=toString.call(element),match=/\[.*\s(.*)\]/gi.exec(type);return match&&match[1]&&(type=match[1]),comparison?comparison===type.toLowerCase():type.toLowerCase()},each:function(obj,func,context){var k;if(context=context||obj,Array.isArray(obj))obj.forEach(func,context);else for(k in obj)if(hasOwn.call(obj,k)&&!1===func.call(context,k,obj[k],obj))break;return obj},UID:function(max){var now=Date.now()+1,ch=now.toString(36),ln=ch.length-1,rand,ret=[],i;for(i=0;i<36;i+=1)rand=Math.floor(10*Math.random()),ln<rand&&(rand=ln-1),ret.push(ch.charAt(rand));return ret.slice(0,max||5).join("")},exports:{},namespace:function(ext){return!0===ext?Namespace.prototype:Object.create(Namespace.prototype,ext)},observer:function(ext){return!0===ext?Observer.prototype:Object.create(Observer.prototype,ext)},Namespace:Namespace,Observer:Observer}),app.assign(mediator),APP.Module=function(){function ModuleRegister(name,builder){this.name=name,this.builder=builder}function Module(){throw new TypeError("Illegal constructor")}var privatevar=new WeakMap;return ModuleRegister.assign({create:function(){return Object.create(ModuleRegister.prototype)}}).inherits(APP.Namespace).implement({require:function(required){var oThis=this;APP().require(required,function(){oThis.register(required)})},register:function(name,builder,required){if(!name)return void Object.assign(global.exports,builder.call(builder,APP.box));this.setItem(name,{name:name,require:required,define:builder,instance:null})}}),Module.assign({create:function(){var object=Object.create(Module.prototype);return privatevar.set(object,ModuleRegister.create()),object}}).implement({define:function(){var args=slice.call(arguments),modules=privatevar.get(this),module,callback,name,required;if(0!==args.length){if(modules||(modules=ModuleRegister.create(),privatevar.set(this,modules)),callback=args.pop(),name=args.shift(),required=args.length&&args[0],Array.isArray(name)&&!required&&(required=name,name=""),module=modules.register(name,callback,required),required)return void modules.require(required);modules.register(name,callback)}},start:function(name,data,sandbox){var module=privatevar.get(this).getItem(name);if(sandbox=sandbox||APP.box,module){if(!module.instance)switch(APP.typeOf(module.define)){case"function":module.instance=module.define.call(sandbox,sandbox)}if(module.instance&&module.instance.init)return module.instance.init(data);box.subscribe(name,module.instance)}},startAll:function(data,sandbox){var modules=privatevar.get(this).getItem(),keys=Object.keys(modules)||[],start=this.start.bind(this);keys.forEach(function(name){start(name,data,sandbox)})},stop:function(name){var module=privatevar.get(this).getItem(name);module&&module.instance&&module.instance.destroy&&(module.instance.destroy(),module.instance=null)},stopAll:function(){var modules=privatevar.get(this).getItem();(Object.keys(modules)||[]).forEach(this.stop.bind(this))},getSandbox:function(){return APP.box},applyMethod:function(name,method,args){var module=privatevar.get(this).getItem(name),md;return module.instance||app.core.start(name),md=module.instance[method],md?md.apply(module.instance,args):void console.warn("[APP.Module.applyMethod] modul "+module.name+" nie ma metody "+method)},hasModule:function(name){return privatevar.get(this).hasItem(name)}}),APP.core=Module.create(),APP.prototype.define=APP.core.define.bind(APP.prototype),Module}(),app.assign({sandbox:function(){return{plugin:function(name,builder){box.define(name,builder())}}}(),autoload:function(){var args=slice.call(arguments),files=APP.files&&APP.files.js,def=args.shift(),parts=def.split(":"),names=parts.pop().split("."),module=names.shift();parts=parts.join(""),names=names.join("."),parts?APP.files.getItem(parts)||(parts+=(parts.lastIndexOf("/")!==parts.length-1?"/":"")+(module?module+".js":"")):parts="js"===names?module+"."+names:files[module],parts&&APP.require(parts,module?function(){var hasMod=APP.core.hasModule(module),md;return hasMod?!names.length||/init|start/.test(names)?void APP.core.start(module):APP.core.applyMethod(module,names,args):(global[module]||"function"==typeof module&&(global[module]=module()),void("function"==typeof(md=APP().namespace.grab(names,global.module))&&md.apply(global.module,args)))}:void 0)},define:function(){var args=slice.call(arguments),fn=args[args.length-1];if("function"==typeof fn&&(args[args.length-1]=fn.bind(APP.box)),"function"==typeof globalDefine)return globalDefine.apply(APP.box,args)}}),app.assign({evalToObject:function(str){try{return str=/^[\{|\[].*[\]\}]/.test(str)?"("+str+")":"({"+str+"})",eval(str)}catch(ex){return""}},splitToParse:function(str,glue){var sp,tmp,ln,i,ret={};if(!str)return null;for(sp=str.split(glue||","),i=0,ln=sp.length;i<ln;i+=1)tmp=sp[i].split(":"),tmp[0]&&(ret[tmp[0].trim()]=(tmp.slice(1).join(":")||"").trim());return ret}}),window.define=APP.define}(APP),function(){"use strict";function insertAdjacentElement(where,content){switch(where){case"afterBegin":this.insertBefore(content,this.firstChild);break;case"beforeBegin":this.parentNode.insertBefore(content,this);break;case"afterEnd":this.parentNode.insertBefore(content,this.nextSibling);break;default:this.appendChild(content)}}var testElement=document.createElement("div");try{testElement.insertAdjacentHTML||Element.implement("insertAdjacentHTML",function insertAdjacentHTML(where,html){var range,frg;range=document.createRange(),frg=range.createContextualFragment(html),insertAdjacentElement.call(this,where,frg)}),testElement.insertAdjacentElement||Element.implement("insertAdjacentElement",insertAdjacentElement),testElement.insertAdjacentText||Element.implement("insertAdjacentText",function insertAdjacentText(where,text){var textNodeToInsert=document.createTextNode(text);insertAdjacentElement.call(this,where,textNodeToInsert)})}catch(ex){}}(),function(win,doc){"use strict";function getFileType(src){var ext;if(!src||"string"!=typeof src)return"";switch(src=src.replace(/\?.*$/,""),ext=/[^.]+$/i.exec(src)[0]){case"js":return"javascript";default:return"css"}}function applyCallbacks(cb){for(var fn=cb.shift();fn;)"function"==typeof fn&&fn(),fn=cb.shift()}function loadFile(reg){if(reg.loaded)return void applyCallbacks(reg.callbacks);loadFile[reg.type]&&loadFile[reg.type](reg)}function iterator(list,callback){var ln=list.length,iter=function(ix){var el;ix!==ln&&("object"==typeof(el=list[ix])&&el.defined&&win[el.defined]||APP.require(el&&(el.src||el),function(){el.callback&&el.callback(),ix+=1,iter(ix),ix===ln&&callback&&callback.call(APP())}))};return iter}var slice=Array.prototype.slice,data=[],head=doc.head||doc.getElementsByTagName("head")[0],loc=location,origin=loc.origin||loc.protocol+"//"+loc.host,firstTime=!1,require;data.setItem=function(value){var ix,src=value.src.replace(origin,"");return ix=this.push(src),ix-=1,value.index=ix,this["_"+ix]=value,ix},data.getItem=function(src){var ix;if(src=src.replace(origin,""),-1!==(ix=this.indexOf(src)))return this["_"+ix]},loadFile.javascript=function(reg){var s;s=doc.createElement("script"),s.async=!0,s[null===s.onreadystatechange?"onreadystatechange":"onload"]=function(){this.readyState&&!/loaded|complete/.test(this.readyState)||(reg.loaded=!0,applyCallbacks(reg.callbacks))},s.onerror=function(){applyCallbacks(reg.callbacks)},s.setAttribute("type","text/javascript"),s.setAttribute("src",reg.src),head.appendChild(s)},loadFile.css=function(reg){var s=doc.createElement("link");s.setAttribute("type","text/css"),s.setAttribute("rel","stylesheet"),s.setAttribute("href",reg.src),data.lastCSS?data.lastCSS.parentNode.insertBefore(s,data.lastCSS.nextSibling):data.firstCSS?data.firstCSS=data.firstCSS.parentNode.insertBefore(s,data.firstCSS):head.appendChild(s),data.lastCSS=s,reg.loaded=!0,applyCallbacks(reg.callbacks)},require=function(){var args=slice.call(arguments),src=args[0],callback=args[1],reg,alreadyLoaded=function(){switch(src){case APP.files.js.templateBuilder:return!!APP().templateBuilder;default:return!1}}();if(firstTime||(APP.require.register(document.scripts||document.querySelectorAll("script")),APP.require.register(document.styleSheets||document.querySelectorAll("link")),firstTime=!0),src)return APP.typeOf(callback,"function")||(callback=null),/array|object/.test(APP.typeOf(src))?void iterator(src,callback)(0):(src=APP.files.getItem(src)||src,(reg=data.getItem(src))?reg.loaded?void(callback&&callback()):void(callback&&reg.callbacks.push(callback)):(reg={loaded:!!alreadyLoaded,src:src,origin:src.replace(origin,""),callbacks:[],type:getFileType(src)},callback&&reg.callbacks.push(callback),data.setItem(reg),void loadFile(reg)))},APP.require=require,APP.box.plugin("require",require),APP.require.register=function(cycle){function regFile(scripts){var ln=scripts.length,i;if(ln){for(i=0;i<ln;i+=1)cycle((scripts[i].src||"stylesheet"===scripts[i].rel&&scripts[i].href||"").replace(/\?.*$/,""));/link/i.test(scripts[ln-1])?(data.firstCSS=scripts[0],data.lastCSS=scripts[ln-1]):(data.firstJS=scripts[0],data.lastJS=scripts[ln-1])}}return regFile}(function(src){src&&"string"==typeof src&&data.setItem({loaded:!0,src:src,static:!0,type:getFileType(src)})}),window.DATAFILE=data}(window,window.document),function(win,doc){"use strict";function domReady(){var ln,i;if(!isReady&&(isReady=!0,readyList)){for(i=0,ln=readyList.length;i<ln;i+=1)readyList[i].call(window,[]);readyList=[]}}function doScrollCheck(){if(!isReady){try{doc.documentElement.doScroll("left")}catch(ex){return void win.setTimeout(doScrollCheck,1)}domReady()}}function bindReady(){var toplevel;if(!readyBound){if(readyBound=!0,"complete"===doc.readyState)return domReady();if(doc.addEventListener)doc.addEventListener("DOMContentLoaded",DOMContentLoaded,!1),win.addEventListener("load",domReady,!1);else if(doc.attachEvent){doc.attachEvent("onreadystatechange",DOMContentLoaded),win.attachEvent("onload",domReady),toplevel=!1;try{toplevel=null===win.frameElement}catch(ex){}doc.documentElement.doScroll&&toplevel&&doScrollCheck()}}}var readyBound=!1,isReady=!1,readyList=[],DOMContentLoaded;DOMContentLoaded=doc.addEventListener?function(){doc.removeEventListener("DOMContentLoaded",DOMContentLoaded,!1),domReady()}:function(){"complete"===doc.readyState&&(doc.detachEvent("onreadystatechange",DOMContentLoaded),domReady())},APP.box.plugin("domready",function(fn){bindReady(),isReady?fn.call(win,APP.box):readyList.push(function(){return fn.call(win,APP.box)})}),APP.domready=APP.box.domready}(window,window.document),function(){"use strict";var i18nLoadedList=[];APP.box.define({pKey:function(){return{translate:{},notImplemented:Object.create(Array.prototype),getItem:function(name,defaultValue){var args=Array.prototype.slice.call(arguments),context,value,isBetaTester=APP.getItem("isBetaTester");if(0===args.length)return this.translate;if(2<args.length){switch(APP.typeOf(args[0])){case"object":context=args[0];break;case"string":context=APP.box.namespace.grab(args[0],this.translate)}name=args[1],defaultValue=args[2],value=context[name]}else value=this.translate[name];return void 0===value?(window.localStorage.getItem("logTranslations")&&log&&(this.notImplemented.contains(name)||(log("\t<+> ",name,"\t",defaultValue||""),this.notImplemented.push(name),this.notImplemented[name]=defaultValue||"brak wartosci klucza")),defaultValue||name):value},setItem:function(name,value){var k;{if("object"!=typeof name)return this.translate[name]=value,this;for(k in name)Object.prototype.hasOwnProperty.call(name,k)&&this.setItem(k,name[k])}}.setter(),create:function(ext){var tr=this.translate;return this.translate=Object.create(tr),ext&&this.setItem(ext),this}}}()}),APP.augment({i18n:function(){return function(page,isBetaTester,async){var url=this.i18n.url||"";"string"!=typeof page&&(page=(window.location.pathname||document.location.pathname).replace("/","").split("/")[0]),url+=page,APP.setItem("isBetaTester",!!isBetaTester||"yes"===global.isBetaTester),i18nLoadedList.contains(url)||(i18nLoadedList.push(url),i18nLoadedList.push(url.replace(/&groups=.*?(&|$)/,"")),function(xhr){xhr[null===xhr.onload?"onload":"onreadystatechange"]=function(){var data;if(4===this.readyState&&200===this.status){try{data=JSON.parse(this.responseText)}catch(ex){return}if(data.error||!data.table)return;APP.box.pKey.setItem(data.table)}},xhr.open("GET",url,!!async),xhr.send()}(new XMLHttpRequest))}.assign({url:"/ajax_get_page_translations.html?short_name="})}()})}(),APP.getItem("pKey")||APP.setItem("pKey",APP().pKey),global.implementationRemoved=global.implementationRemoved||function(comment){"use strict";var stack;comment=comment||"Implementation removed. Remove the use of this function";try{throw global.Error("err")}catch(e){stack=e.stack}log("!!! "+comment+" !!!",stack)},function(){"use strict";try{APP().domready(function(){document.documentElement.setAttribute("data-ats-loaded","html")}),global.addEventListener("load",function(){document.documentElement.setAttribute("data-ats-loaded","document")},!1)}catch(ex){}}();