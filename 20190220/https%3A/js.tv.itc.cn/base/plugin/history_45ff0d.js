/* sohutv 2017-03-16 14:26:29 */
sohuHD.history=function(){var e=function(){},t={delUrl:"//his.tv.sohu.com/his/del.do",cleanUrl:"//his.tv.sohu.com/his/delAll.do",getUrl:"//his.tv.sohu.com/his/get.do?&c=1&callback=?",getOneUrl:"//his.tv.sohu.com/his/getonehistory.do",importUrl:"//his.tv.sohu.com/his/pingbatch.do",encode:document.charset||document.characterSet||"gbk",pagesize:20,page:1,getPassport:function(){return sohuHD.passport.getPassport()},islogin:function(){return!!this.getPassport()},getLocalHistory:function(){var e=sohuHD.cookie("savehistory");if(!e)return[];e=e.split("%2C");for(var t,i=[],o=0,r=e.length;r>o;o++)t=e[o].split("^"),i.push({pid:t[0],vid:t[1],order:t[2],t:t[3],spaceTime:t[4],url:t[5],title:unescape(t[6]),timestamp:parseInt(t[7]),nurl:t[8],countTime:parseInt(t[9]),coverImg:t[10]||""});return i.reverse()},getRemoteHistory:function(i){var o=i.passport,r=i.pagesize||t.pagesize,s=i.page||t.page,n=i.encode||t.encode,l=i.scope||window,c=i.callback||e,a=i.error||e,u=i.htype||"0",p=i.videotype||"2";o||(o=t.getPassport()),o&&sohuHD.getJSONP(t.getUrl+"&passport="+o+"&encode="+n+"&pagesize="+r+"&page="+s+"&videotype="+p+"&htype="+u+"&uid="+sohuHD.user.uid,function(e){c.call(l,e)},null,function(){a.call(l)})},delLocalItems:function(){var e=Array.prototype.slice.call(arguments);if(0==e.length)return void t.clearLocal();var i=function(t){for(var i=0,o=e.length;o>i;i++)if(t.vid==e[i])return!0;return!1},o=function(e){for(var t=[],o=0,r=e.length;r>o;o++)i(e[o])||t.push(e[o]);return t.reverse()},r=function(e){for(var t,i=[],o=0,r=e.length;r>o;o++)t=e[o],i.push([t.pid,t.vid,t.order,t.newTime,t.mix,t.url,t.title,t.playTime,t.nurl,t.countTime,t.coverImg].join("^"));return i.join(escape(","))};sohuHD.cookie("savehistory",r(o(t.getLocalHistory())),{path:"/",domain:"tv.sohu.com",expires:1e3})},delRemoteItems:function(i,o,r,s,n){n||(n=t.getPassport()),"[object Object]"==Object.prototype.toString.call(i)&&(i=[i]),o=o||e,r=r||e,s=s||window;var l=function(e){for(var t=[],i=0,o=e.length;o>i;i++)t.push(e[i].vid+"|"+e[i].pid);return t.join(";")};n&&i.length&&sohuHD.getJSONP(this.delUrl+"?callback=?&passport="+n+"&vs="+l(i)+"&c=1",function(e){o.call(s,e)},null,function(){r.call(s)})},clearLocal:function(){sohuHD.cookie("savehistory","",{path:"/",domain:"tv.sohu.com",expires:-1})},clearRemote:function(e){var i=t.getPassport();i&&sohuHD.getJSONP(this.cleanUrl+"?callback=?&passport="+i,function(t){e&&e(t)})},clear:function(){t.clearLocal(),t.clearRemote()},imports:function(i,o,r,s,n){n||(n=t.getPassport()),o=o||e,r=r||e,s=s||window,"[object Object]"==Object.prototype.toString.call(i)&&(i=[i]);for(var l=[],c=0,a=i.length;a>c;c++)l.push(i[c].vid+"|"+i[c].t+"|"+i[c].timestamp);sohuHD.getJSONP(this.importUrl+"?&encode="+this.encode+"&passport="+n+"&callback=?&c=1&vts="+l.reverse().join(";"),function(e){o.call(s,e)},null,function(){r.call(s)})},getOneHistory:function(i,o,r,s){o=o||e,r=r||e,s=s||this;var n=t.getPassport();if(n){var l=[];if(l.push("htype="+(i.htype?"1":"0")),i.plid)l.push("sid="+i.plid);else{if(!i.vid)return void r.call(s);l.push("vid="+i.sid)}sohuHD.getJSONP(this.getOneUrl+"?&encode="+this.encode+"&passport="+n+"&callback=?&c=1&"+l.join("&"),function(e){var t=null;if(e&&1===e.status&&e.videos){var i=e.videos[0];t={title:i.title,pid:"",plid:i.sid,cid:i.cid,vid:i.vid,url:i.url,t:i.t,viewTime:new Date(i.viewTime.replace(/-/g,"/")),c:i.c}}o.call(s,t)},null,function(){r.call(s)})}else{for(var c,a=this.getLocalHistory(),u=null,p=0;c=a[p];p++)if(i.pid&&i.pid===c.pid||i.vid&&i.vid===c.vid){u={title:c.title,pid:c.pid,plid:"",cid:"",vid:c.vid,url:c.url,t:c.t,viewTime:new Date(c.timestamp),c:1};break}o.call(s,u)}}};return t}();