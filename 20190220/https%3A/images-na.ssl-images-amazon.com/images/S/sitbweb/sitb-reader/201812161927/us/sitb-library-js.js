var SitbReader=null;P.when("jQuery").register("SitbReader",function(c){return SitbReader=SITBReaderLoad(c,{available:function(c,U){P.when(c).execute(U)},declareAvailable:function(c){P.register(c,function(){})}})});
function SITBReaderLoad(c,p){var U,W,X,Y;function l(a){if(a&&typeof(a!=="string"))return!1;else if(a&&!za.test(a))return!1;return!0}function Aa(a){var b=c(document.createElement("div"));b.html(a);return b.text()}function v(a,e,d,f){var g=ga,k=b.encodingProperties;if(k&&k.on)a[k.name]=k.value;f&&(g+="/ref="+f);c.ajax({url:g,async:!0,type:"POST",data:a,cache:!1,dataType:"json",timeout:ha,error:d?d:Ba,success:e})}function Ba(a,e){M(e,b.RefTag.Timeout.generic);b.ReaderActions.showAjaxErrorMessage()}function M(a,
e){b.metrics.count("ajaxerrors");a=="timeout"&&b.metrics.count("ajaxtimeouts");b.RefTag.post(b.RefTag.Actions.timeout,e)}function ia(a,e){b.metrics.count("ajaxerrors","pagenavajaxerrors");a=="timeout"&&b.metrics.count("ajaxtimeouts","pagenavajaxtimeouts");b.RefTag.post(b.RefTag.Actions.timeout,e)}function z(a){a.cancelBubble=!0;a.stopPropagation&&a.stopPropagation();a.preventDefault&&a.preventDefault()}function ja(){var a=navigator.userAgent,b=c.browser.version||"0";return a.match(/iPad/i)?"ipad":
a.match(/iPhone/i)?"iphone":a.match(/silk/i)?"fire":a.match(/Android\s2/i)?"android2":a.match(/Android\s3/i)?"android3":a.match(/Android\s4/i)?"android4":c.browser.msie?b.match(/^7/)?"ie7":b.match(/^6/)?"ie6":b.match(/^8/)?"ie8":b.match(/^9/)?"ie9":"ie":c.browser.safari?a.match(/Chrome/i)?"cr":"sf":a.match(/FireFox/i)?"ff":"others"}function ka(){if(G){var a=c("#sitbReaderMenu-content").height();c(".sitbReaderMenu-bottomborder-content").css("top",a);c(".sitbReaderMenu-leftborder-content").height(a-
7);c(".sitbReaderMenu-rightborder-content").height(a-7)}}function la(a,b){if(l(a))return a;var d=c("<div/>").html(a).text();if(d.length<=b)return a;var f=d.substring(0,b);/\s/.test(d[b])?f+="...":f=f.replace(/(.*)\s+[^\s]*$/,"$1")+"...";return c("<div/>").text(f).html()}function N(a){var b=c(window),d=b.width()/2-a.width()/2,b=b.scrollTop()+b.height()/2-a.height()/2;return a.css({left:d,top:b})}function ma(a){var b=[];if(typeof a=="string"&&a.match("((\\d+|\\d+-\\d+),)*(\\d+|\\d+-\\d+)"))for(var a=
a.split(","),d=0;d<a.length;d++)if(a[d].match("^\\d+$"))b.push(parseInt(a[d]));else if(/(\d+)-(\d+)/.test(a[d]))for(var c=a[d].split("-"),g=parseInt(c[0]),c=parseInt(c[1]);g<=c;g++)b.push(g);return b}function Z(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function h(a,b){var d=SITB_STR_LANG[a];typeof b!="undefined"&&(d=d.replace(/\#{([^{]+)}/g,function(a,d){return b[d]}));return d}function H(a){return a.args?h(a.key,a.args):h(a.key)}function na(a){var b=Math.random()*
100,d=0,c;for(c in a)if(defaultValue=c,d+=a[c],b<d)return c;return 0}function $(a,b){var a=a.toLowerCase(),d=Ca[a];d&&--d.c==0&&window.ue&&b&&(ues("id","sitbReader",b),uet(a,"sitbReader"),uex("ld","sitbReader"))}function I(a){function b(){}b.prototype=a;return new b}function aa(){}function O(){}function Q(){}function R(){}function w(){this.format=U}function Da(){this.createKindleRenderer=function(a){var b=new w;if(a&&a.sampleFormat&&a.sampleFormat.length)switch(a.sampleFormat){case "mobi7":b=new x;
this.format=W;break;case "mobi8":b=new y;this.format=X;break;case "mobi8FixedFormat":if(a.html&&a.css&&a.resources)b=new n(a.html,a.css,a.resources),this.format=Y}return b}}function x(){this.format="mobi7"}function y(){this.format="mobi8"}function n(a,b,d){this.format="mobi8FixedFormat";this.htmlUrls=a;this.cssUrls=b;this.resourceUrls=d}function j(){}function t(a){this.book=a;this.customerReviewDiv=this.createCustomerReviewDiv();this.bookBuyingDiv=this.createBookBuyingDiv();this.sendSampleDiv=this.createSendSampleDiv();
this.kcpAppDiv=""}function C(a){t.call(this,a)}function A(a){t.call(this,a)}function D(a){this.book=a}function E(a,b){this.book=a;this.book2=b}function oa(){this.addLearnMoreHtml=function(a){a.push("<div class='sitbReaderHelpTableRow'>");a.push("<div class='sitbReaderHelpTableCol1 sitbReaderHelpYellowBullet'>&#0155;</div>");a.push("<div class='sitbReaderHelpTableCol3'>");a.push("<div class='sitbReaderHelpQuestionText' id='sitbReaderHelpLearnMore' onclick='SitbReader.HelpWidget._navigateToHelpPage();'>"+
h("LEARN_MORE_LITB")+"</div>");a.push("</div></div>")};this.addGeneralHelpQuestions=function(a){a.push(h("SLIGHTLY_DIFFERENT_CONTENT"));a.push(h("ADJUST_SIZE_TEXT"));a.push(h("WHAT_IS_BROWSING_HISTORY"));return a};this.addGeneralHelpAnswers=function(a){a.push(h("SLIGHTLY_DIFFERENT_CONTENT_ANSWER"));a.push(h("ADJUST_SIZE_TEXT_ANSWER"));a.push(h("WHAT_IS_BROWSING_HISTORY_ANSWER"));return a}}function J(){}function K(){}function pa(){this.initialize=function(){c("#sitbReaderMode").empty()}}function ba(){}
function S(){}(function(a){var b,d,c,g;function k(b){return a.data(b,"sitbReader-tooltip")}function h(b){k(this).delay?q=setTimeout(j,k(this).delay):j();s=!!k(this).track;a(document.body).bind("mousemove",l);l(b)}function o(){if(!a.tooltip.blocked&&!(this==m||!this.tooltipText&&!k(this).bodyHandler)){m=this;p=this.tooltipText;if(k(this).bodyHandler){d.hide();var o=k(this).bodyHandler.call(this);o.nodeType||o.jquery?c.empty().append(o):c.html(o);c.show()}else if(k(this).showBody){o=p.split(k(this).showBody);
d.html(o.shift()).show();c.empty();for(var j=0,qa;qa=o[j];j++)j>0&&c.append("<br/>"),c.append(qa);c.hideWhenEmpty()}else d.html(p).show(),c.hide();k(this).showURL&&a(this).url()?g.html(a(this).url().replace("http://","")).show():g.hide();b.addClass(k(this).extraClass);k(this).fixPNG&&b.fixPNG();h.apply(this,arguments)}}function j(){q=null;(!r||!a.fn.bgiframe)&&k(m).fade?b.is(":animated")?b.stop().show().fadeTo(k(m).fade,m.tOpacity):b.is(":visible")?b.fadeTo(k(m).fade,m.tOpacity):b.fadeIn(k(m).fade):
b.show();l()}function l(d){if(!a.tooltip.blocked&&!(d&&d.target.tagName=="OPTION"))if(!s&&b.is(":visible")&&a(document.body).unbind("mousemove",l),m==null)a(document.body).unbind("mousemove",l);else{b.removeClass("viewport-right").removeClass("viewport-bottom");var c=b[0].offsetLeft,f=b[0].offsetTop;d&&(c=d.pageX+k(m).left,f=d.pageY+k(m).top,d="auto",k(m).positionLeft&&(d=a(window).width()-c,c="auto"),b.css({left:c,right:d,top:f}));var d=a(window).scrollLeft(),g=a(window).scrollTop(),h=a(window).width(),
Ea=a(window).height(),o=b[0];d+h<o.offsetLeft+o.offsetWidth&&(c-=o.offsetWidth+20+k(m).left,b.css({left:c+"px"}).addClass("viewport-right"));g+Ea<o.offsetTop+o.offsetHeight&&(f-=o.offsetHeight+20+k(m).top,b.css({top:f+"px"}).addClass("viewport-bottom"))}}function n(){function d(){b.removeClass(c.extraClass).hide().css("opacity","")}if(!a.tooltip.blocked){q&&clearTimeout(q);m=null;var c=k(this);(!r||!a.fn.bgiframe)&&c.fade?b.is(":animated")?b.stop().fadeTo(c.fade,0,d):b.stop().fadeOut(c.fade,d):d();
k(this).fixPNG&&b.unfixPNG()}}b=void 0;d=void 0;c=void 0;g=void 0;var m,p,q,r=a.browser.msie&&/MSIE\s(5\.5|6\.)/.test(navigator.userAgent),s=!1;a.tooltip={blocked:!1,defaults:{delay:200,fade:!1,showURL:!0,extraClass:"",top:15,left:15,id:"sitbReader-tooltip"},block:function(){a.tooltip.blocked=!a.tooltip.blocked}};a.fn.extend({tooltip:function(k){k=a.extend({},a.tooltip.defaults,k);b||(b=a('<div id="'+k.id+'"><span></span><div class="body"></div><div class="url"></div></div>').appendTo(document.body).hide(),
a.fn.bgiframe&&b.bgiframe(),d=a("span",b),c=a("div.body",b),g=a("div.url",b));return this.each(function(){a.data(this,"sitbReader-tooltip",k);this.tOpacity=b.css("opacity");this.tooltipText=this.title;a(this).removeAttr("title");this.alt=""}).mouseover(o).mouseout(n).click(n)},fixPNG:r?function(){return this.each(function(){var b=a(this).css("backgroundImage");if(b.match(/^url\(["']?(.*\.png)["']?\)$/i))b=RegExp.$1,a(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+
b+"')"}).each(function(){var b=a(this).css("position");b!="absolute"&&b!="relative"&&a(this).css("position","relative")})})}:function(){return this},unfixPNG:r?function(){return this.each(function(){a(this).css({filter:"",backgroundImage:""})})}:function(){return this},hideWhenEmpty:function(){return this.each(function(){a(this)[a(this).html()?"show":"hide"]()})},url:function(){return this.attr("href")||this.attr("src")}})})(c);p.available("jQuery",function(){typeof c.historyInit!="function"&&(c.extend({historyCurrentHash:void 0,
historyCallback:void 0,historyIframeSrc:void 0,historyNeedIframe:c.browser.msie&&(c.browser.version<8||document.documentMode<8),historyInit:function(a,b){c.historyCallback=a;if(b)c.historyIframeSrc=b;var d=location.hash.replace(/\?.*$/,"");c.historyCurrentHash=d;if(c.historyNeedIframe){if(c.historyCurrentHash=="")c.historyCurrentHash="#_";c("body").prepend('<iframe id="jQuery_history" style="display: none;" src="javascript:false;"></iframe>');var f=c("#jQuery_history")[0].contentWindow.document;f.open();
f.close();f.location.hash=c.historyCurrentHash}else if(c.browser.safari&&c.browser.version<533)c.historyBackStack=[],c.historyBackStack.length=history.length,c.historyForwardStack=[],c.lastHistoryLength=history.length,c.isFirst=!0;d&&c.historyCallback(d.replace(/^#/,""));var g=setInterval(c.historyCheck,100);c(window).unload(function(){window.clearInterval(g)})},historyAddHistory:function(a){c.historyBackStack.push(a);c.historyForwardStack.length=0;this.isFirst=!0},historyCheck:function(){if(c.historyNeedIframe){var a=
c("#jQuery_history")[0],a=(a.contentDocument||a.contentWindow.document).location.hash.replace(/\?.*$/,"");if(a!=c.historyCurrentHash)location.hash=a,c.historyCurrentHash=a,c.historyCallback(a.replace(/^#/,""))}else if(c.browser.safari&&c.browser.version<533){if(c.lastHistoryLength==history.length&&c.historyBackStack.length>c.lastHistoryLength&&c.historyBackStack.shift(),!c.dontCheck)if(a=history.length-c.historyBackStack.length,c.lastHistoryLength=history.length,a){c.isFirst=!1;if(a<0)for(var b=0;b<
Math.abs(a);b++)c.historyForwardStack.unshift(c.historyBackStack.pop());else for(b=0;b<a;b++)c.historyBackStack.push(c.historyForwardStack.shift());a=c.historyBackStack[c.historyBackStack.length-1];if(a!=void 0)c.historyCurrentHash=location.hash.replace(/\?.*$/,""),c.historyCallback(a)}else if(c.historyBackStack[c.historyBackStack.length-1]==void 0&&!c.isFirst)location.hash?c.historyCallback(location.hash.replace(/^#/,"")):c.historyCallback(""),c.isFirst=!0}else if(a=location.hash.replace(/\?.*$/,
""),a!=c.historyCurrentHash)c.historyCurrentHash=a,c.historyCallback(a.replace(/^#/,""))},historyLoad:function(a){var b,a=decodeURIComponent(a.replace(/\?.*$/,""));c.browser.safari&&c.browser.version<533?b=a:(b="#"+a,location.hash=b);c.historyCurrentHash=b;if(c.historyNeedIframe){var d=c("#jQuery_history")[0].contentWindow.document;d.open();d.close();d.location.hash=b;c.lastHistoryLength=history.length;c.historyCallback(a)}else c.browser.safari&&c.browser.version<533?(c.dontCheck=!0,this.historyAddHistory(a),
window.setTimeout(function(){c.dontCheck=!1},200),c.historyCallback(a),location.hash=b):c.historyCallback(a)}}),function(a){if(!c.browser.safari){var b={},d="",f="";if(p.history===void 0)p.history={};var g=function(a){var c=a.replace(/_.*$/,""),g="";c!=a&&(g=a.replace(/^[^_]*_/,""));if(b&&b[d])b[d](c,g,d,f);if(c!=d&&b&&b[c])b[c](c,g,d,f);d=c;f=g};a.historyInit(g);p.history.create=function(b,e){a.historyLoad(b+"_"+e)};p.history.change=function(d,c){b[d]=c;var f=a.historyCurrentHash.replace(/^.*#/,
"");d+"_"==f.replace(/_.*$/,"_")&&g(f)};p.history.back=function(){window.history.back()};p.history.go=function(a){window.history.go(a)};p.declareAvailable("AmazonHistory")}}(c))});var b={},m=document.location.protocol==="https:"?h("SITB_IMAGE_BASE_SECURE"):h("SITB_IMAGE_BASE"),L=m+"sitbreader-sprites._V1_.png",s=m+"sitbreader-vert-sprites._V1_.png",T=m+"sitbreader-horz-sprites._V1_.png",ra=m+"pho._V1_.cur",ca=m+"phc._V1_.cur",sa=h("DEFAULT_ERROR_MSG_HEADER"),ta=h("DEFAULT_ERROR_MSG_TEXT"),Fa=h("DEFAULT_RELATED_EDITION_MSG"),
Ga=h("DEFAULT_RELATED_EDITION_XREF_PRINT_MSG"),Ha=h("DEFAULT_RELATED_EDITION_XREF_KINDLE_MSG"),Ia=h("JUST_SO_YOU_KNOW"),ua=h("IN_STANDARDVIEW_TEXT"),Ja=h("IN_FULLSCREEN_TEXT"),Ka=h("TTIP_ZOOM_IN"),La=h("TTIP_ZOOM_OUT"),Ma=h("TTIP_NEXT_PAGE"),Na=h("TTIP_PREV_PAGE"),Oa=h("TTIP_READER_CLOSE"),Pa=h("TTIP_SEARCH_CLOSE"),Qa=h("TTIP_SEARCH_GO"),Ra=h("TTIP_SEARCH_INPUT"),Sa=h("TTIP_MORE_RESULTS"),ha=1E4,Ta=m+"po_right._V1_.png",Ua=m+"po_left._V1_.png",Va=m+"po_top._V1_.png",Wa=m+"po_bottom._V1_.png",Xa=m+
"po_top_right._V1_.png",Ya=m+"po_top_left._V1_.png",Za=m+"po_bottom_left._V1_.png",$a=m+"po_bottom_right._V1_.png",u=20,da=c(document).width()-74,ga="/gp/search-inside/service-data",q=c.browser.msie,V=q&&c.browser.version<7,G=!1,G=q?!document||!document.documentMode?!0:document.documentMode<8:!1,va=c.browser.mozilla;c.browser.mozilla&&c.browser.version.substr(0,3);var ea=[37,39,38,40,33,34,32,35,48,96,109,129,189,61,107,187,36],wa=/\.\s*$/,za=/^\s*$/,xa=h("SB_HIST_LINK"),ab=h("SB_OFF_HIST_LINK"),
bb=h("SB_NO_HIST_LINK"),cb=h("SB_NO_HIST_TEXT"),db=h("SB_OFF_HIST_TEXT"),eb=h("SB_ERR_HIST_TEXT"),fb=h("SB_NO_SIMS"),gb=280+u+18+214,fa=h("TTIP_SB_PANE_CLD"),hb=h("TTIP_SB_PANE_OPN");h("TTIP_SB_TITLE");h("TTIP_SB_LITB_BUTTON");var ib=h("TTIP_SB_HIST_LINK"),jb=h("TTIP_LP_TAB");Y="mobi8FixedFormat";W="mobi7Reflowable";X="mobi8Reflowable";U="unknown";var B=void 0,F;navigator.userAgent.toLowerCase().indexOf("iphone")!=-1||navigator.userAgent.toLowerCase().indexOf("ipad")!=-1?B=1:navigator.userAgent.toLowerCase().indexOf("silk")!=
-1?B=4:navigator.userAgent.toLowerCase().indexOf("android 4")!=-1?B=void 0:navigator.userAgent.toLowerCase().indexOf("android 3")!=-1?B=3:navigator.userAgent.toLowerCase().indexOf("android 2")!=-1?B=2:"createTouch"in document&&(B=5);F=B!==void 0;var kb=h("SITB_REGION_MAGNIFICATION");c.fn.menufy=function(a,b,d,f){this.unbind("click");typeof f=="undefined"&&(f=6*(a.length+1));return this.click(function(){c("#sitbReaderMenu-title").text()!=a&&(c("#sitbReaderMenu-title").html(a).unbind("click").click(function(){c("#sitbReaderHelpMenu").hide()}).css("cursor",
"pointer"),c("#sitbReaderMenu-content-center").html(b));c(window).unbind("click.sitbreader");c(window).bind("click.sitbreader",function(a){a=c(a.target);!a.parents().is("#sitbReaderHelpMenu")&&!a.parents().is("#sitbReaderTBLinks")&&(c("#sitbReaderHelpMenu").hide(),c(window).unbind("click.sitbreader"))});window.weblabs&&window.weblabs.booksUDP&&c("#sitbReaderMenu-topcontent").css("width",18+f+"px");G?(c("#sitbReaderMenu-topcontent").css("padding-right","9px"),c("#sitbReaderMenu-rightborder-top").height(25),
c("#sitbReaderMenu-leftborder").height(25),c("#sitbReaderMenu-topright-top").css("left",16+f+"px"),c("#sitbReaderMenu-topborder-top").css("width",13+f+"px"),(!window.weblabs||!window.weblabs.booksUDP)&&c("#sitbReaderMenu-topcontent").css("width",18+f+"px"),c("#sitbReaderMenu-rightborder-top").css("left",20+f+"px"),c("#sitbReaderMenu-close").css("right","10px")):(!window.weblabs||!window.weblabs.booksUDP)&&c("#sitbReaderMenu-topcontent").css("width",2+f+"px");c("#sitbReaderMenu-content").css("left",
-300+(f+12)+"px");c("#sitbReaderMenu-topborder-content").css("width",284-f+"px");c("#sitbReaderHelpMenu").css("left",c("#"+this.id).offset().left-c("#sitbReaderTBLinks").offset().left-16);c("#sitbReaderHelpMenu").show();ka();d&&c.isFunction(d)&&d()})};var Ca={cf:{c:2}};b.BorderElement=function(a,e,d,c,g,k,h){this.spriteUrl=a;this.ie6Url=e;this.spriteOffset={};this.spriteOffset.x=d;this.spriteOffset.y=c;this.offsets=h;this.width=g;this.height=k;this.handle=null;for(var o in b.Border.borderOffsets)this.offsets[b.Border.borderOffsets[o]]||
(this.offsets[b.Border.borderOffsets[o]]=null)};b.Border={orientations:"t,b,l,r,tr,tl,br,bl".split(","),borderOffsets:["right","left","top","bottom"],applyBorderSet:function(a,b,d){var f=c(a).width(),g=c(a).height(),k;for(k in this.orientations)d[this.orientations[k]]&&this.attachBorderWithOrientation(a,f,g,b,d[this.orientations[k]],this.orientations[k])},isVertical:function(a){return a=="r"||a=="l"?!0:!1},isCorner:function(a){return a.length=="2"?!0:!1},isTop:function(a){return a.substr(0,1)=="t"?
!0:!1},isRight:function(a){return a.length=="2"&&a.substr(1,1)=="r"||a.substr(0,1)=="r"?!0:!1},attachBorderWithOrientation:function(a,b,d,f,g,k){var h,o,j={};o=g.width;h=g.height;var l=!0;this.isRight(k)?j.right=-1*o+g.offsets.right:j.left=-1*o+g.offsets.left;this.isTop(k)?j.top=-1*h+g.offsets.top:j.bottom=-1*h+g.offsets.bottom;this.isCorner(k)?(g.handle?(f=g.handle,l=!1):(f=this.createTransPngDiv(f,g,"no-repeat"),g.handle=f),j.width=o,j.height=h):this.isVertical(k)?(b=j.top=g.offsets.top+0,h=g.offsets.bottom+
0,g.handle?(f=g.handle,l=!1):(f=this.createTransPngDiv(f,g,"repeat-y"),g.handle=f),j.width=o,j.height=d-(b+h)):(o=j.left=g.offsets.left+0,d=g.offsets.right+0,g.handle?(f=g.handle,l=!1):(f=this.createTransPngDiv(f,g,"repeat-x"),g.handle=f),j.width=b-(o+d),j.height=h);j["font-size"]="1px";c(f).css(j);if(l)c(a).append(f),g.parent=!0},createTransPngDiv:function(a,b,d){var f=document.createElement("div");c(f).addClass(a);c(f).css("position","absolute");V?(a="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+
b.ie6Url+"', sizingMethod=scale)",f=c(f).css("filter",a)):f=c(f).css({background:'url("'+b.spriteUrl+'") '+d,"background-position":"-"+b.spriteOffset.x+"px -"+b.spriteOffset.y+"px"});return f}};b.Metrics=function(){this.counters={};this.timers={}};b.Metrics.prototype.start=function(){this.sessionStart=(new Date).getTime()};b.Metrics.prototype.end=function(){if(this.sessionStart){var a=(new Date).getTime();if(b.currentBook.isPrint())for(var e=b.currentBook.pages,d=1;d<e.length;d++)e[d].visibleStart>
0&&a-e[d].visibleStart>1E4&&this.count("twirly");reftag=b.pageSequence.collectPageMetrics();a-=this.sessionStart;var e=[],f;for(f in this.counters)e.push(f+":"+this.counters[f]);f=[];for(var g in this.timers)d=this.timers[g],d.count>0&&f.push(g+":"+parseInt(d.sum/d.count)+":"+d.count);this.counters={};this.timers={};this.sessionStart=null;c.ajax({url:"/gp/search-inside/performance/ref="+reftag,data:{sessionTime:a,counters:e.join(","),timing:f.join(",")}})}};b.Metrics.prototype.count=function(){for(var a=
0;a<arguments.length;a++)this.counters[arguments[a]]?this.counters[arguments[a]]++:this.counters[arguments[a]]=1};b.Metrics.prototype.startTimer=function(a){var b=this.timers[a];b?b.start?this.count("ub"+a):b.start=(new Date).getTime():this.timers[a]={start:(new Date).getTime(),sum:0,count:0}};b.Metrics.prototype.endTimer=function(a){var b=this.timers[a];b&&b.start?(b.sum+=(new Date).getTime()-b.start,b.count++,b.start=null):this.count("ub"+a)};b.Metrics.prototype.recordTimer=function(a,b){var d=
this.timers[a];d||(d={sum:0,count:0},this.timers[a]=d);d.sum+=b;d.count++};b.RefTag={httpGet:function(a){c.get("/gp/search-inside/reftag/ref="+a+"?asin="+b.currentBook.buyingAsin)},post:function(a,e,d){setTimeout(function(){b.RefTag.httpGet(b.RefTag.getFormatedRefTag(a,e,d))},10)},tokenizeLandingPage:function(a){var b="";switch(a){case h("FRONT_COVER"):b="fcv";break;case h("FRONT_FLAP"):b="ffl";break;case h("COPYRIGHT"):b="cpy";break;case h("TOC"):b="toc";break;case h("FIRST_PAGES"):b="txt";break;
case h("INDEX"):b="idx";break;case h("BACK_FLAP"):b="bfl";break;case h("BACK_COVER"):b="bcv";break;default:b="cst"}return b},getFormatedRefTag:function(a,e,d){var c="rdr_";b.currentBook&&b.currentBook.isKindle()&&(c+="kindle_");if(a&&e&&!d)c+=a+"_"+e;else if(a&&e&&d)firstRefTag=c+a+"_"+e,b.RefTag.httpGet(firstRefTag),c+=a+"_"+d;else if(a&&!e&&!d)c+=a;else throw"No support for "+arguments.length+" parameters";return c},getKindleWorkflowButtonRefTag:function(a,b){var d=a+(b?"WithRedirection":"");Vellum.detailPageType&&
(d+=Vellum.detailPageType=="print"?"FromPrintDetailPage":"FromKindleDetailPage");return this.getFormatedRefTag(this.Actions.exit,this.ExitMethod[d])},getCheckoutRefTag:function(a){return this.getKindleWorkflowButtonRefTag("checkout",a)},getSendSampleRefTag:function(a){return this.getKindleWorkflowButtonRefTag("sendSample",a)},getOneClickBuyRefTag:function(a){return this.getKindleWorkflowButtonRefTag("oneClickBuy",a)}};b.RefTag.Actions={zoom:"zom",zoomIn:"zmi",zoomOut:"zmo",help:"hlp",next:"nxt",previous:"prv",
section:"sec",samplePage:"sam",searchExecuted:"sch",sampleSearchExecuted:"ssch",searchResult:"spg",message:"msg",closeMessage:"msc",exit:"ext",panel:"pan",feedback:"fdb",standardView:"vw_lb",fullscreenView:"vw_fs",leftSeperator:"bk_sep",sbBookHistory:"sb_bh",sbSeperator:"sb_sep",sbPage:"sb_pg",clickToc:"toc",mode:"mode",bottomButton:"bbt",sendCustomerRequest:"scr",scrolledToEnd:"sc_end",moreSearchResults:"rdr_bar_moreres",sbPaneItem:"rdr_ext_sb_pi",sbTitle:"rdr_ext_sb_ti",sbLookInside:"rdr_sb_li",
sbReview:"rdr_ext_cr_",touch:"touch",timeout:"tot",error:"err"};b.RefTag.LandingPage={frontCover:"fcv",frontFlap:"ffl",toc:"toc",copyright:"cpy",frontMatter:"fma",excerpt:"exc",otherText:"txt",backMatter:"bma",index:"idx",backFlap:"bfl",backCover:"bcv",searchResults:"sch",sitb:"sitb"};b.RefTag.MessageType={relatedEditions:"rel",pictureSupression:"pic",notLoggedIn:"login",skipped:"skip",partialContent:"partial",regionMagnification:"mobi8_ff_rm"};b.RefTag.PanelAction={openSections:"seo",closeSections:"sec",
openSearch:"sro",closeSearch:"src",open:"opn",close:"cls"};b.RefTag.SerendipityBar={history:"hist",similarities:"sims"};b.RefTag.ExitMethod={thumbnail:"tmb",title:"tit",author:"aut",cart:"atc",usedNew:"uan",link:"cls",button:"clx",exterior:"clg",keyboard:"clk",backbutton:"bck",oneClickBuy:"ocb",oneClickBuyFromKindleDetailPage:"ocb_kndl_dp",oneClickBuyFromPrintDetailPage:"ocb_prnt_dp",checkout:"chk",checkoutFromKindleDetailPage:"chk_kndl_dp",checkoutFromPrintDetailPage:"chk_prnt_dp",sendSample:"ssm",
sendSampleFromKindleDetailPage:"ssm_kndl_dp",sendSampleFromPrintDetailPage:"ssm_prnt_dp",oneClickBuyWithRedirection:"ocb_rdt",oneClickBuyWithRedirectionFromKindleDetailPage:"ocb_rdt_kndl_dp",oneClickBuyWithRedirectionFromPrintDetailPage:"ocb_rdt_prnt_dp",checkoutWithRedirection:"chk_rdt",checkoutWithRedirectionFromKindleDetailPage:"chk_rdt_kndl_dp",checkoutWithRedirectionFromPrintDetailPage:"chk_rdt_prnt_dp",sendSampleWithRedirection:"ssm_rdt",sendSampleWithRedirectionFromKindleDetailPage:"ssm_rdt_kndl_dp",
sendSampleWithRedirectionFromPrintDetailPage:"ssm_rdt_prnt_dp",customerRequestKindle:"crb_kdl",customerRequestKindleApps:"crb_kra",customerRequestBooks:"crb_book",endOfSampleBuyLink:"eos_buy",endOfSampleBuy1ClickLink:"eos_ocb",endOfSampleMoreDetail:"eos_detail"};b.RefTag.Performance={onDocumentReadyLoadStart:"load_start",onDocumentReadyLoadEnd:"load_end"};b.RefTag.Application={kindle_dp:"sib_dp_kndl_dp",print_dp:"sib_dp_prnt_dp",kindle_show:"sib_dp_kndl_show",print_show:"sib_dp_prnt_show",dp_tag:"sib_dp"};
b.RefTag.Touch={ios:"ios",android2:"and2",android3:"and3",android4:"and4",fire:"fire",other:"oth"};b.RefTag.Timeout={readerOpen:"opn",serendipityBar:"sb",highlights:"hgl",toc:"toc",relatedEdition:"rled",pageUrls:"purl",search:"srch",kindleSample:"kdls",generic:"gnrc"};b.RefTag.Error={empty_sample:"emp_sam"};b.Book=function(a){this.type=a.type=="kps"?3:a.type=="html"?2:1;this.originalBookType=a.original_book_type=="print"?1:2;this.asin=a.ASIN;this.buyingAsin=a.buyingAsin;this.kindleAsin=a.kindleAsin;
this.sitbAsin=a.sitbAsin;this.originalAsin=a.originalAsin;this.marketplaceId=a.marketplaceId;this.title=a.title;this.authorNameList=a.authorNameList;this.thumbnailImage=a.thumbnailImage.replace(/\._.+_/,"");this.binding=a.binding;this.usedAndNewCount=a.usedAndNewCount;this.usedAndNewLowestPrice=a.usedAndNewLowestPrice;this.buyingPrice=a.buyingPrice;this.shouldPreorder=a.shouldPreorder;this.displayPriceWithCurrency=a.displayPriceWithCurrency;this.displayPriceWithCORCurrency=a.displayPriceWithCORCurrency;
this.displayPriceWithMPCurrency=a.displayPriceWithMPCurrency;this.smallBuyButton=a.smallBuyButton;this.smallSampleButton=a.smallSampleButton;this.smallAdditionalBuyWith1ClickButton=a.smallBuyWith1ClickButton;this.buyButtonText=a.buyButtonText;this.purchaseArgs=a.purchaseArgs;this.sampleArgs=a.sampleArgs;this.additionalBuyWith1ClickArgs=a.buyWith1ClickArgs;this.fastTrack=a.fastTrack;this.fastTrackTimerStarted=!1;this.sampleFormat=a.sampleFormat;this.orientation=a.orientation?a.orientation:"lrtb";this.isRightToLeftOrientation=
this.orientation.indexOf("rl")>-1&&this.type!=1;this.isPreorder=!1;if(this.purchaseArgs&&this.purchaseArgs.isPreorder)this.isPreorder=this.purchaseArgs.isPreorder.toString()!="0";var e=a.book2;if(e)e.isBook2=!0,e.asin=e.ASIN?e.ASIN:e.asin,e.isKindle=function(){return e.isKindleBook},e.isPrint=function(){return!e.isKindleBook},e.hasValidOffer=function(){return e.buyingPrice||e.buyingPrice===0},e.thumbnailImage=e.thumbnailImage.replace(/\._.+_/,""),e.sessionId=a.sessionId,e.usedBookDisabled=typeof e.usedBookDisabled!=
"undefined"?e.usedBookDisabled:!1,e.showUsedAndNew=typeof e.showUsedAndNew!="undefined"?e.showUsedAndNew:!0;this.book2=e;this.twisterKindleAsin=a.twisterKindleAsin;this.samplePrice=a.samplePrice;this.shouldHideKindleBuy=!this.buyingPrice||this.twisterKindleAsin&&this.buyingAsin!=this.twisterKindleAsin;this.relatedEditionAsin=a.relatedEditionAsin;this.hasKindleEdition=a.hasKindleEdition;this.searchable=a.searchable?a.searchable:!1;this.hasFullAccess=a.hasFullAccess?a.hasFullAccess:!1;this.hasPartialContent=
a.hasPartialContent?a.hasPartialContent:!1;this.numPages=a.numPages;this.bookmarks=new b.Bookmarks(a.bookmarks);this.pageLabels=new b.Pagelabel(a.pageLabelSet,this.numPages,this.bookmarks);this.sips=a.sampleSearches;this.bookDataLoaded=!0;this.sessionId=a.sessionId;this.reviewStarsImageTag=a.reviewStarsImageTag;this.pages=null;this.st=parseInt(a.st);this.pt=parseInt(a.pt);this.litbPages=a.litbPages;this.zoomable=a.zoomable;this.isAmazonOffer=a.isAmazonOffer?a.isAmazonOffer:!1;this.xPages=ma(a.xPages);
this.isImage()?this.initializePages(a,this.bookmarks):this.sample=a.sample;this.kindleDevices=l(a.kindleDeviceListHTML)?"":a.kindleDeviceListHTML;this.kindleBuyItURL=l(a.buyItURL)?"":a.buyItURL;this.kindleSendSampleURL=a.sendSampleURL;this.kindleAdditionalBuyWith1ClickURL=l(a.buyWith1ClickURL)?"":a.buyWith1ClickURL;this.merchantID=l(a.merchantID)?"":a.merchantID;this.offerListingID=l(a.offerListingID)?"":a.offerListingID;this.kcpAppWidget=a.kcpAppWidget;this.enableAdditionalBuy1Click=this.kindleAdditionalBuyWith1ClickURL!=
"";if(e)e.kindleDevices=l(e.kindleDeviceListHTML)?"":e.kindleDeviceListHTML,e.kindleBuyItURL=l(e.buyItURL)?"":e.buyItURL,e.kindleSendSampleURL=e.sendSampleURL,e.kindleAdditionalBuyWith1ClickURL=l(e.buyWith1ClickURL)?"":e.buyWith1ClickURL,e.kcpAppWidget=e.kcpAppWidget,e.enableAdditionalBuy1Click=e.kindleAdditionalBuyWith1ClickURL!=""};b.Book.prototype.initializePages=function(a,e){this.pages=[];var d=[];a.cPages=ma(a.cPages);var f=b.pageSequence;if(b.availability.level==1)for(var g in a.t1Tokens){g=
parseInt(g);for(var k=g-2;k<=g+2;k++)d.push(k)}for(g=1;g<=this.numPages;g++)c.inArray(g,this.xPages)>=0?(this.pages[g]=new b.BookPage(g,e,null,null,null,-1),b.availability.irreversibleXPages[g]=!0):c.inArray(g,a.litbPages)>=0||!this.inTextPages(g)?(k=typeof a.largeImageUrls[g]!="undefined"&&typeof a.jumboImageUrls[g]!="undefined"?new b.BookPage(g,e,a.largeImageUrls[g],a.jumboImageUrls[g],null,1):new b.BookPage(g,e,null,null,null,1),this.pages[g]=k,f.lastAvailablePageNumber=g):(b.availability.isFPS&&
c.inArray(g,a.cPages)>=0?(k=1,f.lastAvailablePageNumber=g):b.availability.level==2&&!b.availability.isFPS?k=2:b.availability.numRemPages<=0?k=-1:(k=0,f.lastAvailablePageNumber=g),this.pages[g]=new b.BookPage(g,e,null,null,null,k));if(this.isKPS())this.numPages++,k=new b.BookPage(this.numPages,e,null,null,null,1),k.renderType="pageHtml",k.render=function(){var a=c("div#"+this.divId);if(a.size()==1){var e="<div id='sitbReaderHighlights-"+this.pageNumber+"'></div>"+("<div id=sitbReaderKindleSample>"+
b.Message.getHtmlBuyMessage()+"</div>");a.html(e).css("font-size",b.ZoomModel.getFontSize()+"px")}},k.getScaledDimensions=function(){var a=b.ZoomModel.getPageWidth(),e=c("div#"+this.divId).height();return{width:a,height:e}},this.pages[this.numPages]=k,f.lastAvailablePageNumber=this.numPages;if(b.availability.level<2){k=this.getLastTextPage();for(g=this.st;g<=k;g++)if(this.pages[g].isQ()&&c.inArray(g,d)<0)this.pages[g].state=-1}if(b.availability.isFPS&&a.numRemPages>0&&b.availability.level==1)for(g in a.t1Tokens)this.initializeTokens(g,
a.t1Tokens[g]);if(this.pages[f.lastAvailablePageNumber].isX())for(g=f.lastAvailablePageNumber;g>0;g--)if(this.pages[g].isC()||this.pages[g].isQ()){f.lastAvailablePageNumber=g;break}if(this.pages[f.firstAvailablePageNumber].isX())for(g=f.firstAvailablePageNumber;g<=f.lastAvailablePageNumber;g++)if(this.pages[g].isC()||this.pages[g].isQ()){f.firstAvailablePageNumber=g;break}};b.Book.prototype.initializeTokens=function(a,b){for(var a=parseInt(a),d=Math.max(a-2,1);d<=Math.min(a+2,this.numPages);d++)if(this.pages[d].token=
b,this.pages[d].state!=1)this.pages[d].state=0};b.Book.prototype.getPage=function(a){return this.pages[a]};b.Book.prototype.getLastTextPage=function(){return this.st+this.pt<=this.numPages?this.st+this.pt-1:this.numPages};b.Book.prototype.inTextPages=function(a){return a>=this.st&&a<=this.getLastTextPage()};b.Book.prototype.getType=function(){return this.type};b.Book.prototype.isHTML=function(){return this.type==2};b.Book.prototype.isKPS=function(){return this.type==3};b.Book.prototype.isPrint=function(){return this.type==
1};b.Book.prototype.isImage=function(){return this.type==1||this.type==3};b.Book.prototype.isKindle=function(){return this.type==2||this.type==3};b.Book.prototype.isMobi8FixedFormat=function(){return this.sampleFormat==Y};b.Book.prototype.isOriginalBookPrint=function(){return this.originalBookType==1};b.Book.prototype.hasPrintAsin=function(){return!l(this.sitbAsin)};b.Book.prototype.hasKindleAsin=function(){return!l(this.kindleAsin)};b.Book.prototype.isPrintBookWithOnlyKindleSample=function(){return this.isOriginalBookPrint()&&
!this.hasPrintAsin()&&this.hasKindleAsin()};b.Book.prototype.isKindleBookWithOnlyPrintSample=function(){return!this.isOriginalBookPrint()&&this.hasPrintAsin()&&!this.hasKindleAsin()};b.Book.prototype.shouldShowTellThePublisher=function(){return!this.hasKindleEdition};b.Book.prototype.getRelatedAsin=function(){if(this.buyingAsin&&this.asin!=this.buyingAsin||this.originalAsin)return this.originalAsin?this.originalAsin:this.asin};b.Book.prototype.hasValidOffer=function(){return this.buyingPrice||this.buyingPrice===
0};b.Book.prototype.sitbReaderCreateCustomizedZoomModel=function(){return this.isKPS()?this.isRightToLeftOrientation?new R:new Q:new O};b.BookPage=function(a,b,d,c,g,k){typeof d=="undefined"&&(c=d=null);typeof g=="undefined"&&(g=null);typeof k=="undefined"&&(k=0);this.pageNumber=a;this.divId="sitbReaderPage-"+a;this.renderType="pageImage";this.largeUrl=d;this.jumboUrl=c;this.jumboImageHeight=this.jumboImageWidth=this.largeImageHeight=this.largeImageWidth=this.jumboImage=this.largeImage=null;this.loaded=
!1;this.token=g;this.loadableToken=!1;this.state=k;this.highlights={};this.links=null;this.fetchingUrls=!1;this.isTOC=b.getBookmarkForPage(a)==h("TOC");this.visibleStart=0};b.BookPage.prototype.getAspectRatio=function(){return typeof this.aspectRatio!="undefined"?this.aspectRatio:b.pageSequence.defaultAspectRatio};b.BookPage.prototype.isLoaded=function(a){if(this.isX())return!0;a=b.ZoomModel.isLargeImageZoomLevel(a)?this.largeImage:this.jumboImage;return a!=null&&a.width>=300};b.BookPage.prototype.getScaledDimensions=
function(){var a=b.ZoomModel.getPageWidth(),e=Math.round(a*this.getAspectRatio());return{width:a,height:e}};b.BookPage.prototype.getImageUrlSet=function(a){return b.ZoomModel.isLargeImageZoomLevel()^a?{image:this.largeImage,url:this.largeUrl}:{image:this.jumboImage,url:this.jumboUrl}};b.BookPage.prototype.loadImage=function(){if(!this.isX()&&!(this.fetchingUrls||this.pageNumber!=1&&!c("#sitbReaderPlaceholder").is(":visible"))){var a=this.getImageUrlSet().image,e=this.getImageUrlSet().url;if(e==null)this.fetchingUrls=
!0,function(a){b.PageSequenceActions.loadPageUrls(a,function(){a.fetchingUrls=!1;a.render.call(a)})}(this);else if(a==null?a=b.ZoomModel.isLargeImageZoomLevel()?this.largeImage=new Image:this.jumboImage=new Image:b.currentSearch&&b.currentSearch.numResults>0&&this.hasHighlights(b.currentSearch.currentQuery),a.width==0||a.width==28&&a.height==30){var d=this;a.onload=function(){if(b.LightboxActions.pageNotLoaded)$("cf",b.LightboxActions.requestId),b.LightboxActions.pageNotLoaded=!1;if(d._shouldObfuscate())d.setState(-1),
d.largeImage=null,d.jumboImage=null,b.availability.irreversibleXPages[d.pageNumber]=!0;else{if(d.visibleStart>0){var a=(new Date).getTime()-d.visibleStart;d.visibleStart=0;b.metrics.recordTimer("wait",a);b.LightboxActions.weblab&&b.LightboxActions.weblab!=""&&b.metrics.recordTimer("wait"+b.LightboxActions.weblab,a)}this.onload=function(){};d.setAspectRatio(this);d.render();d.pageNumber==1&&b.ZoomActions.updateFitToScreenZoomLevel(d)}};a.onerror=function(){b.availability.handlePageLoadError(d)};a.src=
e}}};b.BookPage.prototype.render=function(){var a=c("div#"+this.divId);if(a.size()==1){var e="<div class='imageOverlay' id='sitbReaderHighlights-"+this.pageNumber+"'></div>"+this.generateImageHtml(),d=this.getScaledDimensions();a.html(e).width(d.width).height(d.height).parent().width(d.width).height(d.height);b.ReaderWidget.renderPageOverlay(this.pageNumber)}};b.BookPage.prototype.generateImageHtml=function(){if(this.isX()||this.isY())return"";var a=this.getImageUrlSet();if(a.url==null)return this.loadImage(),
"";if(!this.isLoaded())if(this.loadImage(),this.canFaux())a=this.getImageUrlSet(!0);else return"";var b=this.getScaledDimensions();return'<img src="'+a.url+'" height="'+b.height+'" width="'+b.width+'"/>'};b.BookPage.prototype.setVisible=function(){if(!this.isLoaded()&&!this.canFaux()&&this.visibleStart==0)this.visibleStart=(new Date).getTime()};b.BookPage.prototype.canFaux=function(){return this.aspectRatio!=null};b.BookPage.prototype.setAspectRatio=function(a){var e=a.width*this.getAspectRatio();
this.aspectRatio=a.height/a.width;b.pageSequence.addAspectRatio(this.aspectRatio);Math.abs(a.height-e)>5&&b.PageSequenceWidget.requestRedraw()};b.BookPage.prototype.addUrls=function(a,b){this.fetchingUrls=!1;if(!this.largeUrl||this.largeUrl=="")this.largeUrl=a,this.jumboUrl=b};b.BookPage.prototype.hasHighlights=function(a){if(this.highlights[a]==!1)return!1;if(typeof this.highlights[a]=="string")return!0;if(c.inArray(this.pageNumber,b.currentSearch.resultPageNumbers)<0)return this.highlights[a]=!1;
this.loadHighlights(a);return!1};b.BookPage.prototype.loadHighlights=function(a){this.highlights[a]=!1;var e=this;v({method:"getPositionData",asin:b.currentBook.asin,page:this.pageNumber,token:this.token,query:encodeURIComponent(a)},function(d){d.highlights&&d.highlights[e.pageNumber]&&(e.highlights[a]=b.SearchWidget.renderHighlights(d.highlights[e.pageNumber]),b.ReaderWidget.renderPageOverlay(e.pageNumber))},function(a,e){ia(e,b.RefTag.Timeout.loadHighlights)})};b.BookPage.prototype.setState=function(a){if(a==
this.state)return!1;if(this.state==-1&&b.availability.irreversibleXPages[this.pageNumber])return!1;b.pageSequence.updateFirstOrLastAvailablePageNumber(this.pageNumber,this.state,a,!1);b.pageSequence.updateFirstOrLastAvailablePageNumber(this.pageNumber,this.state,a,!0);if(a==-1)this.visibleStart=0;(a==-1&&this.state!=2||this.state==2||this.state==-1)&&b.PageSequenceWidget.requestRedraw();this.state=a;a==-1&&b.currentSearch&&b.currentSearch.numResults>0&&(a=c.inArray(this.pageNumber,b.currentSearch.resultPageNumbers),
a>=0&&c("#sitbReaderSearch-result-"+a+" a").addClass("sitbReader-link-disabled"));return!0};b.BookPage.prototype._hasImages=function(){return!(this.largeImage==null&&this.jumboImage==null)};b.BookPage.prototype._shouldObfuscate=function(){var a=b.availability;if(this._canBeObfuscated()){var e=this._getAdjacentPageCount(-1,!0),d=this._getAdjacentPageCount(1,!0);if(e==0&&d==0){if(e=this._getAdjacentPageCount(-1,!1),d=this._getAdjacentPageCount(1,!1),Math.min(e,d)<a.getSkipPagesNumber())return!0}else return e+
d<=a.getConsecPagesNumber()-1?!1:!0;return!1}};b.BookPage.prototype._getAdjacentPageCount=function(a,e){var d=b.currentBook.pages,c=b.availability,g=0;if(d)for(var k=a>0?this.pageNumber+1:this.pageNumber-1;g<c.maxConsecPages+1&&(k<d.length&&a>0||k>0&&a<0);k+=a)if(e==d[k]._hasImages()&&d[k]._canBeObfuscated())g++;else break;return g};b.BookPage.prototype._canBeObfuscated=function(){var a=b.currentBook.bookmarks,e=b.availability;if(b.currentBook.isKPS())return!1;a=a.getBookmarkInfo(this.pageNumber);
return a!=null&&(a.name!=h("FIRST_PAGES")||a.name==h("FIRST_PAGES")&&a.index<e.minimumTextLitbPages)?!1:!0};b.BookPage.prototype.isC=function(){return this.state==1};b.BookPage.prototype.isQ=function(){return this.state==0};b.BookPage.prototype.isX=function(){return this.state==-1};b.BookPage.prototype.isY=function(){return this.state==2};b.Bookmarks=function(a){this.list=[];this.allBookmarkPages=[];for(index in a){var e=new b.Section(a[index][0],a[index][1],a[index][2]);this.list[index]=e;for(var d=
e.firstPageNumber;d<e.firstPageNumber+e.numPages;d++)this.allBookmarkPages[d]={name:e.name,index:d-e.firstPageNumber}}this.size=l(a)?0:a.length};b.Bookmarks.prototype.getName=function(a){return this.list[a].name};b.Bookmarks.prototype.getNameById=function(a){for(i in this.list)if(a==this.list[i].name.toLowerCase().replace(/[^A-z_]/g,""))return this.list[i].name;return null};b.Bookmarks.prototype.getSize=function(){return this.size};b.Bookmarks.prototype.getFirstPageNumber=function(a){return this.list[a].firstPageNumber};
b.Bookmarks.prototype.getFirstAndLastPageNumberByName=function(a){for(var b=0;b<this.list.length;b++)if(this.list[b].name==a)return{first:this.list[b].firstPageNumber,last:this.list[b].firstPageNumber+this.list[b].numPages};return{first:null,last:null}};b.Bookmarks.prototype.getIndex=function(a){for(var b=0;b<this.size;b++){var d=this.list[b].firstPageNumber+this.list[b].numPages-1;if(a>=this.list[b].firstPageNumber&&a<=d)return b}return null};b.Bookmarks.prototype.isInABookmark=function(a){return this.allBookmarkPages[a]!=
null};b.Bookmarks.prototype.getBookmarkForPage=function(a){a=this.getIndex(a);return a==null?null:this.getName(a)};b.Bookmarks.prototype.getBookmarkInfo=function(a){return this.allBookmarkPages[a]};b.Section=function(a,b,d){this.name=a;this.firstPageNumber=b;this.numPages=d};b.Excerpt=function(a){this.excerpt=a;this.boldAreas=[];this.backClear=this.frontClear=0;this.findBoldAreas();this.length=this.excerpt.length-this.boldAreas.length*7};b.Excerpt.prototype.findBoldAreas=function(){for(var a=0,b,
d;(b=this.excerpt.indexOf("<b>",a))!=-1;)a=b+3,d=this.excerpt.indexOf("</b>",a),this.boldAreas.push({start:b,end:d});this.boldAreas.length>0?(this.frontClear=this.boldAreas[0].start-1,this.backClear=this.excerpt.length-(this.boldAreas[this.boldAreas.length-1].end+4)):(this.frontClear=0,this.backClear=this.excerpt.length)};b.Excerpt.prototype.removeChars=function(a){if(a<=this.backClear)return this.extractString(0,this.excerpt.length-a);else if(a<=this.backClear+this.frontClear){var b;for(b=0;a-b>
this.backClear&&b>=0;b=this.excerpt.indexOf(" ",b)+1);return this.extractString(b,this.excerpt.length-(a-b))}else{var a=this.frontClear+(this.length-a),d=!1;for(b in this.boldAreas)if(b=parseInt(b),a>this.boldAreas[b].start)if(a+=3,a>this.boldAreas[b].end)a+=4;else{d=!0;break}else break;return this.extractString(this.frontClear,a,d)}};b.Excerpt.prototype.extractString=function(a,b,d){this.excerpt[b+1]=="."&&b++;b=this.excerpt.substring(a,b);if(d||!wa.test(b))b=b+(d?"</b>":"")+"&#8230;";if(a>0&&!(b.substring(0,
3).indexOf(".")!=-1||wa.test(this.excerpt.substring(0,a-1))))b="&#8230;"+b;return b};b.Search=function(a){this.currentQuery=a;this.previousDisplayedResult=this.numDisplayedResults=this.numResults=0;this.resultsList=[];this.previousDisplayedResultIndex=this.currentDisplayedResultIndex=0;this.resultPageNumbers=[];this.currentResultsPage=0;this.totalResultsPages=-1;this.fetchNumber=20};b.Search.prototype.update=function(a){this.numResults=a.totalResults;this.previousDisplayedResult=this.numDisplayedResults;
if(a=a.results){for(var e=0;e<a.length;e++){if(c.inArray(a[e][0],this.resultPageNumbers)>=0)return;this.resultPageNumbers.push(a[e][0]);this.numDisplayedResults++;b.currentBook.pageLabels.hasLabels&&(a[e][1]=b.currentBook.pageLabels.getLabel(a[e][0],!0));a[e][2]=new b.Excerpt(a[e][2]);a[e][4]=!1;this.resultsList.push(a[e])}this.resultPageNumbers.sort(function(a,b){return a-b})}};b.Search.prototype.setCurrentResultIndex=function(a){this.previousDisplayedResultIndex=this.currentDisplayedResultIndex;
this.currentDisplayedResultIndex=a};b.Search.prototype.getPageNumber=function(a){return this.resultsList[a][0]};b.Search.prototype.getLongExcerpt=function(a){return this.resultsList[a][2].excerpt.replace(/\"/g,"&quot;")};b.Search.prototype.getExcerpt=function(a){return this.resultsList[a][2]};b.Search.prototype.getToken=function(a){return this.resultsList[a][3]};b.Search.prototype.getPageTitle=function(a){return this.resultsList[a][1]};b.Search.prototype.setVisited=function(a){this.resultsList[a][4]=
!0};b.Search.prototype.isVisited=function(a){return this.resultsList[a][4]};b.Search.prototype.getFirstAvailablePageNumber=function(){for(var a=null,e=0;e<this.numDisplayedResults;e++)if(b.currentBook.pages[this.resultsList[e][0]].isC()||b.currentBook.pages[this.resultsList[e][0]].isQ()){a=this.resultsList[e][0];break}return a};b.Search.prototype.getIndex=function(a){for(var b=0;b<this.numDisplayedResults;b++)if(this.resultsList[b][0]==a)return b;return null};b.Search.prototype.findNextResult=function(a,
e,d){for(var c=a.length,g=-1,k;c-g>1;)a[k=c+g>>1]<e?g=k:c=k;d>0?((a[c]<=e||c<0)&&c++,c>=a.length&&(c=0)):((a[c]>=e||c>=a.length)&&c--,c<0&&(c=a.length-1));e=c;for(g=a.length;b.currentBook.pages[a[c]].isX();)if(c+=d,c+=g,c%=g,c==e)break;return a[c]};O.prototype=new aa;O.prototype.constructor=O;O.prototype.initialize=function(a){a.defaultZoomLevel=1;a.zoomFonts=[10,18,26,34,42];a.zoomWidths=[-1,600,800,1E3,1200]};Q.prototype=new aa;Q.prototype.constructor=Q;Q.prototype.initialize=function(a){a.defaultZoomLevel=
2;a.zoomFonts=[12,18,24,30,36];a.zoomWidths=[-1,768,1024,1280,1536]};R.prototype=new aa;R.prototype.constructor=R;R.prototype.initialize=function(a){a.defaultZoomLevel=0;a.zoomFonts=[12,18,24,30,36];var e=Math.round(c("#sitbReaderPageContainer").height()/b.pageSequence.defaultAspectRatio);a.zoomWidths=[e,e*1.25,e*1.5,e*1.75,e*2]};b.ZoomModel={defaultZoomLevel:1,zoomWidths:[-1,600,800,1E3,1200],zoomFonts:[10,18,26,34,42],zoomLevel:1,minZoomLevel:0,fitPageZoomLevel:0,userDefinedZoomLevel:!0,previousZoomLevel:1,
MAX_PAGE_WIDTH_FOR_PAGE_FIT:600,LARGE_IMAGE_MAX_ZOOM:1,ZOOM_FONT_WEIGHTS:[0.5,0.75,1,1.2,1.4,1.6,1.8],ZOOM_LINE_HEIGHT:[100,100,100,100,100],initialize:function(){b.currentBook.sitbReaderCreateCustomizedZoomModel().initialize(this);this.zoomLevel=this.defaultZoomLevel},isFitPageZoomLevel:function(){return this.fitPageZoomLevel==this.zoomLevel},canZoomIn:function(){return b.currentBook.zoomable?this.zoomLevel<this.zoomWidths.length-1:this.zoomLevel<this.LARGE_IMAGE_MAX_ZOOM},canZoomOut:function(){return this.zoomLevel>
this.minZoomLevel},isValidZoomLevel:function(a){return a>=b.ZoomModel.minZoomLevel&&a<=b.ZoomModel.zoomWidths.length-1},isLargeImageZoomLevel:function(a){if(typeof a=="undefined")a=this.zoomLevel;return a<=this.LARGE_IMAGE_MAX_ZOOM},isFitToScreenZoomLevel:function(){return this.zoomLevel==this.minZoomLevel},getPageWidth:function(){if(b.currentBook.isImage())return this.zoomWidths[this.zoomLevel];else{var a=b.ReaderWidget;return 0.95*(c("#sitbReaderPageContainer").width()-(u+2*(a.PAGE_TURNER_WIDTH+
a.PAGE_TURNER_PAGE_SPACING+a.PAGE_TURNER_SPACING)))}},getFontSize:function(){return this.zoomFonts[this.zoomLevel]},getZoomFontSizes:function(){for(var a=this.getFontSize(),b="",d=1;d<8;d++)b+=".sitb-font-size-"+d+"{ font-size: "+a*this.ZOOM_FONT_WEIGHTS[d-1]+"px; }\n";return b},getLineHeight:function(){return this.ZOOM_LINE_HEIGHT[this.zoomLevel]},setNativeLargeZoomLevel:function(a){this.zoomLevel=this.defaultZoomLevel;this.zoomWidths[this.zoomLevel]=a},setFitPageZoomLevel:function(a){this.zoomWidths[0]=
Math.round(a)},updateMinZoomLevel:function(){this.minZoomLevel=this.zoomWidths[0]<this.zoomWidths[1]?0:1},setNativePageWidth:function(a){this.zoomWidths[this.defaultZoomLevel]=a},getNativePageWidth:function(){return this.zoomWidths[this.defaultZoomLevel]},isZoomLevelChanged:function(){return this.zoomLevel!=this.previousZoomLevel},updatePreviousZoomLevel:function(){this.previousZoomLevel=this.zoomLevel}};b.SBBookItem=function(a,e,d){this.thumbnailUrl=a.thumbnailImageURL.replace(/(.*)_SL75_(.*)/,"$1_SX35_$2");
if(this.thumbnailUrl.match(/.*_SX35_.*/)==null&&this.thumbnailUrl.match(/.*_V\d+_.*/))this.thumbnailUrl=this.thumbnailUrl.replace(/(.*_V\d+_)(.*)/,"$1SX35_$2");this.fulltitle=a.title;this.title=la(a.title,19);this.authors=a.authorList;this.price=a.price;this.rating=a.rating;this.asin=a.asin;this.showSitbLink=a.isSITB;if(this.authors&&this.authors.length>2)this.authors=this.authors.slice(0,2),this.authors.push("et al.");this.pane=e;this.index=parseInt(d)+1;this.getTitleUrl=function(a){return"/dp/"+
this.asin+"/ref="+a+"_"+this.pane+"_"+this.index};this.getAuthorLine=function(){return this.authors?" "+h("BY",{AUTHORS:la(this.authors.join(", "),19)}):""};this.getReviewsSpan=function(){var a="";this.rating.starsImageTag&&this.rating.count&&(a+='<span class="review" onclick="window.location=\'/product-reviews/'+this.asin+"/"+b.RefTag.Actions.sbReview+this.pane+"'\">"+this.rating.starsImageTag+' (<span id="count">'+this.rating.count+"</span>)</span>");return a}};b.SBBookItem.prototype.render=function(a){var e=
c('<div class=book>   <div  title="'+h("TTIP_SB_TITLE",{TITLE:this.fulltitle})+'">       <a href="'+this.getTitleUrl(b.RefTag.Actions.sbPaneItem)+'">           <img class="sitbReaderBookThumbnail" title="'+h("TTIP_SB_TITLE",{TITLE:this.fulltitle})+'" alt="Thumbnail for '+this.title+'" src="'+this.thumbnailUrl+'" onload=\'var h=this.height;if(h>54)return;var b=6;if(h%1)b++;b+=Math.floor((54-h)/2);SitbReader.jQuery(this).css({"margin-top":Math.floor((54-h)/2),"margin-bottom":b})\'/>       </a>       <a href="'+
this.getTitleUrl(b.RefTag.Actions.sbTitle)+'">'+this.title+"       </a>   </div>"+this.getAuthorLine()+'   <div id="info">'+this.getReviewsSpan()+'      <span id="price">'+this.price+"</span>   </div>"+this.createBuyButton()+this.createLITBButton()+"</div>");a.append(e);return e};b.SBBookItem.prototype.createBuyButton=function(){return this.showBuyButton?'<div id="buybutton"><form id="sitbReaderSBBuy-'+this.asin+'" action="/gp/legacy-handle-buy-box.html" method="post"><input type="hidden" value="1" name="asin.'+
this.asin+'"/><input type="hidden" value="1" name="'+this.asin+'"/><input type="hidden" value="undefined" name="0"/><input type="hidden" value="books" name="store-name"/><input type="hidden" value="1" name="maw"/><span class="a-button a-button-primary a-button-icon"><span class="a-button-inner"><i class="a-icon a-icon-cart"></i><button class="a-button-text" type="button" onclick="SitbReader.jQuery(\'#sitbReaderSBBuy-'+this.asin+"').submit();\">"+h("add_to_cart")+"</button></span></span></form></div>":
""};b.SBBookItem.prototype.createLITBButton=function(){return this.showSitbLink?'<span class="a-button a-button-base a-button-small"><span class="a-button-inner"><button class="a-button-text" type="button" onclick="SitbReader.SerendipityBar.goToOtherReader(\''+this.asin+"','"+this.pane+"','"+this.index+"');\">"+h("look_inside_this_book")+"</button></span></span>":""};b.SerendipityBar={isOn:!0,historyBooks:[],recommendedBooks:[],dataLoaded:!1,loadBooksFromData:function(a){if(!b.SerendipityBar.dataloaded){b.metrics.startTimer("SBdraw");
var e=a.history;typeof a.history_off!="undefined"&&a.history_off?b.SBWidget.historyLoadOff():typeof e=="undefined"?b.SBWidget.historyLoadEmpty():e.length>0&&b.SBWidget.historyLoadSuccess();for(var d in e)l(e[d].title)||b.SerendipityBar.historyBooks.push(new b.SBBookItem(e[d],b.RefTag.SerendipityBar.history,d));a=a.recommendations;for(d in a)l(a[d].title)||b.SerendipityBar.recommendedBooks.push(new b.SBBookItem(a[d],b.RefTag.SerendipityBar.similarities,d));a?c("#sitbReaderSB #simsinfo").hide():b.SBWidget.noSims();
b.SerendipityBar.dataLoaded=!0;b.SBWidget.hideLoading();b.SBWidget.resize();b.metrics.endTimer("SBdraw");b.metrics.endTimer("SBshow")}},goToOtherReader:function(a,e,d){window.location="/reader/"+a+"/ref="+b.RefTag.Actions.sbLookInside+"_"+e+"_"+d+"&state="+b.LightboxActions.getLightboxStateAttribute()}};b.ClickableTOC={hasPages:{},visitedPages:{},initialize:function(){b.ClickableTOC.hasPages={}},addPage:function(a,e){if(a){if(e!=null&&b.currentBook.pages[a])b.currentBook.pages[a].links=e;b.ClickableTOC.hasPages[a]=
!0;b.PageSequenceActions.addTOCLinks(e)}}};b.PageSequence=function(){this.lastPageVisited=null;this.lastAvailablePageNumber=this.currentPage=0;this.firstAvailablePageNumber=1;this.zoomLevel=null;this.displayScroll=[];this.scrollHeight=0;this.PARTIAL_DIVS_NUM=5;this.visibleElementIndices=[];this.viewedPages={};this.defaultAspectRatio=1.6;this.pageAspectsForDefault=[];this.visibleElementIndicesPointer=0;if(b.PageSequence.readingLocationCache===void 0)b.PageSequence.readingLocationCache=[]};b.PageSequence.prototype.getCurrentBookmarkName=
function(){var a=b.currentBook.bookmarks.getIndex(b.pageSequence.currentPage);return a!=null?b.currentBook.bookmarks.getName(a):null};b.PageSequence.prototype.getDisplayElement=function(a){return this.displayScroll[a]};b.PageSequence.prototype.pushDisplayElement=function(a){this.displayScroll.push(a)};b.PageSequence.prototype.getLastDisplayElement=function(){return this.getDisplayElement(this.getPageDisplayIndex(this.lastAvailablePageNumber))};b.PageSequence.prototype.replaceDisplayElement=function(a,
b){a>0&&a<this.displayScroll.length&&(this.displayScroll[a]=b)};b.PageSequence.prototype.getScrollLength=function(){return this.displayScroll.length};b.PageSequence.prototype.emptyScroll=function(){this.displayScroll=[];this.visibleElementIndices=[];this.visibleElementIndicesPointer=this.scrollHeight=0;this._cleanPartialDivs()};b.PageSequence.prototype.updateScrollHeight=function(a){this.scrollHeight+=a};b.PageSequence.prototype.addAspectRatio=function(a){if(!(this.pageAspectsForDefault.length>=7)){this.pageAspectsForDefault.push(a);
if(this.pageAspectsForDefault.length==1)this.defaultAspectRatio=a;if(!(this.pageAspectsForDefault.length<3))this.pageAspectsForDefault.sort(),this.defaultAspectRatio=this.pageAspectsForDefault[parseInt(this.pageAspectsForDefault.length/2)]}};b.PageSequence.prototype.getPageDisplayIndex=function(a){for(var a=parseInt(a),b=this.displayScroll.length,d=-1,c=0;b-d>1;)if(c=b+d>>1,this.displayScroll[c].pageNumber==a)break;else this.displayScroll[c].pageNumber>a?b=c:d=c;return c};b.PageSequence.prototype.getPartialDivIndex=
function(a){var a=this.getPageDisplayIndex(a),b;for(b in this.visibleElementIndices)if(this.visibleElementIndices[b]==a)return b;return null};b.PageSequence.prototype.findVisibleElementIndices=function(a,b){for(var d=[],c=this.displayScroll.length,g=-1,k=0,h;c-g>1;)if(k=c+g>>1,h=this.displayScroll[k].visibleCompare(a,b),h==0)break;else h<0?c=k:g=k;for(;this.displayScroll[--k]&&this.displayScroll[k].visibleCompare(a,b)==0;);for(;this.displayScroll[++k]&&this.displayScroll[k].visibleCompare(a,b)==0;)d.push(k);
return d};b.PageSequence.prototype.setVisibleElements=function(a,b){for(var d=[],f=0;f<this.PARTIAL_DIVS_NUM;f++)d.push(null);for(f=0;f<a.length;f++)if(!(c.inArray(a[f],this.visibleElementIndices)>=0))for(var g,k=0;k<this.PARTIAL_DIVS_NUM;k++,this.visibleElementIndicesPointer++)if(g=this.visibleElementIndicesPointer%this.PARTIAL_DIVS_NUM,this.visibleElementIndices[g]==null){this.visibleElementIndices[g]=a[f];d[g]=a[f];break}else if(c.inArray(this.visibleElementIndices[g],b)<0){this.displayScroll[this.visibleElementIndices[g]].isDisplayed=
!1;this.displayScroll[this.visibleElementIndices[g]].containerObj=null;this.visibleElementIndices[g]=a[f];d[g]=a[f];break}for(f=0;f<this.PARTIAL_DIVS_NUM;f++)c.inArray(this.visibleElementIndices[f],b)<0&&(this.visibleElementIndices[f]=null);for(f=0;f<d.length;f++)d[f]!=null&&this.displayScroll[d[f]].setOnPartialDiv(f);this._cleanPartialDivs()};b.PageSequence.prototype._cleanPartialDivs=function(){for(var a=0;a<this.PARTIAL_DIVS_NUM;a++)this.visibleElementIndices[a]==null&&c("#scrollElm-"+a).removeClass().css({height:"",
top:"",width:""}).empty()};b.PageSequence.prototype.findElementsRangeToSet=function(a){for(var a=Math.max(Math.min(a-parseInt(this.PARTIAL_DIVS_NUM/2),this.displayScroll.length-this.PARTIAL_DIVS_NUM),0),b=[],d=a;d<a+this.PARTIAL_DIVS_NUM&&d<this.displayScroll.length;d++)b.push(d);return b};b.PageSequence.prototype.findElementsToSet=function(a){if(a.length<1)return[];for(var b=a[a.length-1];b<this.displayScroll.length-1&&a.length<this.PARTIAL_DIVS_NUM;)if(a.push(++b),this.displayScroll[b].type==1)break;
return a};b.PageSequence.prototype.updateFirstOrLastAvailablePageNumber=function(a,e,d,c){var g=c?this.firstAvailablePageNumber:this.lastAvailablePageNumber;if(a==g&&d==-1&&(e==0||e==1))if(e=b.currentBook.pages,c)for(a+=1;a<=this.lastAvailablePageNumber;a++){if(e[a].state==1||e[a].state==0){this.firstAvailablePageNumber=a;break}}else for(a-=1;a>=1;a--){if(e[a].state==1||e[a].state==0){this.lastAvailablePageNumber=a;break}}else if((c&&a<g||!c&&a>g)&&(d==1||d==0)&&(e==-1||e==2))c?this.firstAvailablePageNumber=
a:this.lastAvailablePageNumber=a};b.PageSequence.prototype.selectCurrentPageNumber=function(a,b,d){if(a.length!=0){for(var c=this.displayScroll[a[0]].pageNumber,g=0,k=0;k<a.length;k++){var h=this.displayScroll[a[k]];if(h.type==1){if(h.isEntirelyInViewport(b,d)){c=h.pageNumber;break}var j=h.getViewportPercentage(b,d);if(j>g&&(g=j,c=h.pageNumber,g>0.5))break}}this.currentPage=c;this.viewedPages[this.currentPage]=!0}};b.PageSequence.prototype.collectPageMetrics=function(){var a=b.currentBook,e=a.st,
d=a.pt,f=e+d,g=0,a=b.metrics;a.count("cs");a.count("level_"+b.availability.level);b.availability.isFPS&&a.count("fps");a.count("browser_"+ja());for(var k in this.viewedPages)e<=k&&k<f?(a.count("text"),g++):a.count("nontext");e=parseInt(g*100/d);a.recordTimer("pct",e);k=c(window).height();d=c(window).width();k>0&&d>0&&(a.recordTimer("height",parseInt(6E5/k)),a.recordTimer("width",parseInt(1E6/d)));return"rdr_txt_"+e};b.PageSequence.prototype.getReadingLocation=function(a,e){var d=b.PageSequence.readingLocationCache[a];
d===void 0&&e==1?d={lrl:1}:d===void 0&&e==2&&(d={lrl:"srl"});return d.lrl};b.PageSequence.prototype.updateAvailablePages=function(a){a=b.PageSequence.readingLocationCache[a];if(a!==void 0)this.firstAvailablePageNumber=a.fap,this.lastAvailablePageNumber=a.lap};b.PageSequence.prototype.putReadingLocation=function(a,e){b.PageSequence.readingLocationCache[a]={lrl:e,fap:this.firstAvailablePageNumber,lap:this.lastAvailablePageNumber}};b.PageSequence.prototype.resetReadingLocationCache=function(){b.PageSequence.readingLocationCache=
[]};b.DisplayElement=function(a,e,d,c,g,k){this.top=a;this.height=e;this.type=d;this.pageNumber=parseInt(c);if(d==1&&null==g)this.page=b.currentBook.pages[this.pageNumber];this.htmlContent=g;this.msgType=k};b.DisplayElement.prototype.setOnPartialDiv=function(a){var a=c("#scrollElm-"+a),e=b.ZoomModel.getPageWidth();this.type==1?(a.removeClass().css({height:this.height,top:this.top,width:e,"font-size":"","line-height":""}).addClass(this.page.renderType).html("<div id='"+this.page.divId+"'/>"),this.page.render()):
a.removeClass().addClass("scrollMessage").css({height:"",top:this.top,"font-size":"","line-height":"",width:e}).empty().html(this.htmlContent)};b.DisplayElement.prototype.visibleCompare=function(a,b){var d=this.top+this.height;return a<=this.top&&this.top<=b||d>=a&&d<b||d>=b&&this.top<=a?0:this.top>b?-1:1};b.DisplayElement.prototype.getViewportPercentage=function(a,b){var d=b-a,c=this.top+this.height;return this.top>b||c<a?0:this.top<=a&&c>=a&&c<=b?(c-a)/d:this.top<=b&&this.top>=a&&c>=b?(b-this.top)/
d:this.top<=a&&c>=b?1:this.top>=a&&c<=b?this.height/d:0};b.DisplayElement.prototype.isEntirelyInViewport=function(a,b){var d=this.top+this.height;return this.top>=a&&d<=b};b.Message={relatedEditionMessage:null,pictureSuppressed:null,randomPageLoginMessage:null,partialContentMessage:null,mobi8FixedFormatMessage:null,messagesDismissed:!1,messagesDisplayed:!1,noPagesStdMsg:h("SOME_PAGES_OMITTED"),t2NonFPSMsg:h("PLEASE_USE_SURPRISE_OR_SITB"),priorityMap:{1:10,2:10,3:10,4:10,5:20},cleanupMessages:function(){this.partialContentMessage=
this.randomPageLoginMessage=this.pictureSuppressed=this.relatedEditionMessage=null},haveMessagesToShow:function(){return!(l(this.relatedEditionMessage)&&l(this.randomPageLoginMessage)&&l(this.pictureSuppressed)&&l(this.partialContentMessage)&&l(this.mobi8FixedFormatMessage))},getSkipMessageText:function(a,e){var d=b.currentBook.pageLabels;if(a>e)var c=a,a=e,e=c;c=d.getLabel(a).replace(/\D+/g,"");d=d.getLabel(e).replace(/\D+/g,"");d=b.currentBook.pageLabels.hasLabels?l(c)||l(d)?this.noPagesStdMsg:
a==e?h("PAGE_NOT_INCLUDED",{LABEL_START:c}):h("PAGES_NOT_INCLUDED",{LABEL_START:c,LABEL_END:d}):this.noPagesStdMsg;if(b.availability.numRemPages>0&&(b.availability.isT2NonFPS()||b.currentBook.pages[a].isY()))d=this.t2NonFPSMsg;return d},getSignInMessageText:function(a){return h("PLEASE_SIGN_IN",{ASIN:b.currentBook.buyingAsin,PAGE:a})},setRandomSignInMessageText:function(){this.randomPageLoginMessage=h("THIS_IS_A_RANDOM_PAGE",{ASIN:b.currentBook.buyingAsin})},getMessagePriority:function(a){return this.priorityMap[a]},
getHtmlBuyMessage:function(){txtEndOfPreview=h("END_OF_PREVIEW");!b.currentBook.enableAdditionalBuy1Click||b.currentBook.isPreorder?(txtBuyType=b.currentBook.isPreorder?h("PREORDER_WITH_1_CLICK"):h("BUY_WITH_1_CLICK"),txtBuy=b.currentBook.shouldHideKindleBuy?"":"<br />"+h("END_OF_PREVIEW_BUY",{BUYING_ASIN:b.currentBook.buyingAsin,BUY_TYPE:txtBuyType,BUY_ACTION:"javascript:SitbReader.KindleContentActions.endOfSampleBuyLink()",REFTAG:b.RefTag.getFormatedRefTag(b.RefTag.Actions.exit,b.RefTag.ExitMethod.endOfSampleMoreDetail)})):
(txtBuyNowType=h("BUY_WITH_1_CLICK"),txtBuy1ClickType=h("ADDITIONAL_BUY_WITH_1_CLICK"),txtBuy=b.currentBook.shouldHideKindleBuy?"":"<br />"+h("END_OF_PREVIEW_BUY_DUAL",{BUYING_ASIN:b.currentBook.buyingAsin,BUY_NOW_TYPE:txtBuyNowType,BUY_NOW_ACTION:"javascript:SitbReader.KindleContentActions.endOfSampleBuyLink()",BUY_1_CLICK_TYPE:txtBuy1ClickType,BUY_1_CLICK_ACTION:"javascript:SitbReader.KindleContentActions.endOfSampleBuy1ClickLink()",REFTAG:b.RefTag.getFormatedRefTag(b.RefTag.Actions.exit,b.RefTag.ExitMethod.endOfSampleMoreDetail)}));
return htmlContent="<div class='sitb-buy-box' style='margin-top: 25px; margin-bottom: 25px'><hr />"+txtEndOfPreview+txtBuy+"<hr /></div>"},getMobi8FixedFormatHtmlBuyMessage:function(){var a=b.Message.getHtmlBuyMessage(),a=a.replace("SitbReader","parent.parent.SitbReader");return"<html><head><style>.sitb-buy-box { text-indent: 0px; text-align: center; line-height: 150%; height: 182px; }</style></head><body><base target='_blank' />"+a+"</body></html>"}};b.MessageBox=function(a,b){this.messageBoxType=
a;switch(a){case 1:this.htmlContent=this.getCustomerRequestMessage(b);break;case 3:this.htmlContent=this.getErrorMessage(b)}var d=c(document.createElement("div"));d.attr("id","sitbReaderMessageBoxWrapper");d.html(this.htmlContent);this.fragment=document.createDocumentFragment();this.fragment.appendChild(d[0])};b.MessageBox.prototype.getCustomerRequestMessage=function(a){htmlContent=this.getInputMessageBox();htmlContent+='<div id="sitbReaderMessageBoxInputHead">'+a.header+"</div>";htmlContent+='<div id="sitbReaderMessageBoxInputBody">'+
a.text+"</div>";return htmlContent};b.MessageBox.prototype.getErrorMessage=function(a){htmlContent=this.getPlainMessageBox();htmlContent+='<div id="sitbReaderMessageBoxInfoHead">'+a.header+"</div>";htmlContent+='<div id="sitbReaderMessageBoxInfoBody">'+a.text+"</div>";return htmlContent};b.MessageBox.prototype.getPlainMessageBox=function(){htmlContent='<div id="sitbReaderMessageBoxInfoMessageIcon"></div>';htmlContent+='<div id="sitbReaderMessageBoxCloseButton"></div>';htmlContent+='<a id="sitbReaderMessageBoxCloseLink" class="sitbReaderClose">'+
h("CLOSE")+"</a>";return htmlContent};b.MessageBox.prototype.getInputMessageBox=function(){htmlContent='<div id="sitbReaderMessageBoxCloseButton"></div>';htmlContent+='<a id="sitbReaderMessageBoxCloseLink" class="sitbReaderClose">'+h("CLOSE")+"</a>";return htmlContent};b.Pagelabel=function(a,b,d){this.labels=[];for(var c=0;c<b;c++){var g=d.getBookmarkForPage(c+1);g!=null?this.labels.push(g):this.labels.push(!1)}if(a==null)this.hasLabels=!1;else{this.hasLabels=!0;a=a.split("),");this.romans=",c,cc,ccc,cd,d,dc,dcc,dccc,cm,,x,xx,xxx,xl,l,lx,lxx,lxxx,xc,,i,ii,iii,iv,v,vi,vii,viii,ix".split(",");
for(var k in a){a[k]=a[k].replace("(","");a[k]=a[k].replace(")","");d=a[k].split(",");g=parseInt(d[0]);for(c=g-1;c<b;c++)if(reg=RegExp("/"+h("FRONT_COVER")+"|"+h("BACK_COVER")+"|"+h("FRONT_FLAP")+"|"+h("BACK_FLAP")+"/"),!this.labels[c]||!this.labels[c].match(reg))d[1]=="a"?this.labels[c]=h("PAGE",{PAGE:c-g+1+parseInt(d[2])}):d[1]=="r"?this.labels[c]=h("PAGE",{PAGE:this.toRoman(c-g+1+parseInt(d[2]))}):d[1]=="i"&&(this.labels[c]=h("INSERT"))}}};b.Pagelabel.prototype.getLabel=function(a,e){var c=this.labels[a-
1];c==!1&&(c=e?a>b.currentBook.numPages/2?h("BACK_MATTER"):h("FRONT_MATTER"):"");return c};b.Pagelabel.prototype.toRoman=function(a){for(var a=String(parseInt(a)).split(""),b="",c=3;c--;)b=(this.romans[parseInt(a.pop())+c*10]||"")+b;return b};w.prototype.getHtmlFragment=function(){};w.prototype.updateTOCLink=function(){};w.prototype.getLocation=function(){};w.prototype.adjustHeight=function(){};w.prototype.updateContent=function(){};x.prototype=I(w.prototype);x.prototype.constructor=x;x.prototype.getHtmlFragment=
function(a,e){var d=document.createDocumentFragment(),f="<style id='sitbKindleFontStyle' type='text/css'>"+b.ZoomModel.getZoomFontSizes()+"</style>",g=c(document.createElement("div"));g.attr("id","sitbReaderKindleSample");g.css("visibility","hidden");g[0].innerHTML=f+e+a;g.append(b.Message.getHtmlBuyMessage());g.append("<div id='sitbReaderEndOfSample' />");d.appendChild(g[0]);return d};x.prototype.updateTOCLink=function(){var a=c("a",this._contentHolder);c.each(a,function(a,d){var f=c(d);if(d.className.indexOf("sitb-filepos_src")!=
-1){var g=d.href.split("#")[1];d.href="javascript:void(0)";f.unbind("click").bind("click",{anchor:g},function(a){b.KindleContentActions.goToLocation(a.data.anchor,"name",!1)||c("#sitbReaderPageContainer").scrollTop(b.KindleContentActions._contentHolder.height())})}else if((d.href.lastIndexOf("http:",0)===0||d.href.lastIndexOf("https:",0)===0)&&d.className!=="sitb-buy-box")d.target="_new"})};x.prototype.getLocation=function(a,b){var d=void 0;l(b)||b=="class"?d=c("."+a):b=="name"&&(d=c("a[name='"+a+
"']"));return d};x.prototype.adjustHeight=function(a,e){var d=b.ZoomModel;d.getPageWidth();c("#sitbReaderPageContainer");var f=c("img",a);c.each(f,function(a,e){var d=c(e),f=d.css("font-size"),f=b.ZoomModel.getPageWidth()-parseFloat(f.substring(0,f.length-2))-120,h=d.data("realPicWidth");e.width>f||h&&h>f?e.width=f:d.removeAttr("width")});a.css({"font-size":d.getFontSize()+"px"});c("#sitbKindleFontStyle").remove();c("#sitbReaderKindleSample").prepend("<style id='sitbKindleFontStyle' type='text/css'>"+
b.ZoomModel.getZoomFontSizes()+"</style>");d=e.position().top;a.parent().parent().css("height",d);a.parent().css("height",d);a.css({height:d});return d};x.prototype.updateContent=function(){var a=c("#sitbReaderKindleSample"),a=c("img",a);b.KindleContentWidget._imageCount=a.length;var e=b.KindleContentActions._contentCache[b.currentBook.asin].srl,d=void 0,d=void 0!=e?c("a[name='"+e+"']"):c(".sitb-srl");if(d!=void 0&&d.position()!=void 0)b.KindleContentWidget._srlOffsetTop=d.position().top;c.each(a,
function(a,e){var d=c(e);l(d.attr("src"))||(d.position().top<b.KindleContentWidget._srlOffsetTop&&(b.KindleContentWidget._imagesPreSRL+=1),d.load(b.KindleContentWidget._handleImage).error(b.KindleContentWidget._handleImage))})};y.prototype=I(w.prototype);y.prototype.constructor=y;y.prototype.getHtmlFragment=function(a,e){var d=document.createDocumentFragment(),f=c(document.createElement("div"));f.attr("id","sitbReaderKindleSample");f.css("visibility","hidden");var g=c(document.createElement("iframe"));
g.attr("id","sitbReaderFrame");g.attr("scrolling","no");g.attr("frameborder","0");f.append(g);f.append(b.Message.getHtmlBuyMessage());q?(this.sampleDefaultCSSForIE="body{font-family: Bookerly, Georgia, Arial; user-select: none; -o-user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none;} ",this.sampleBookCSSForIE=e,this.sampleBodyForIE="<body>"+a+"<div id='sitbReaderEndOfSampleInFrame'/></body>"):this.sampleHtml="<head><style>body{font-family: Bookerly, Georgia, Arial; user-select: none; -o-user-select: none; -moz-user-select: none; -khtml-user-select: none; -webkit-user-select: none;} </style>"+
e+"</head><body>"+a+"<div id='sitbReaderEndOfSampleInFrame'/></body>";f.append("<div id='sitbReaderEndOfSample' />");d.appendChild(f[0]);return d};y.prototype.updateTOCLink=function(){var a=c("a",c("#sitbReaderFrame").contents());c.each(a,function(a,d){var f=c(d);if(typeof f.attr("sitblink")!="undefined"){if(f.attr("sitblink").indexOf("filepos_src")!=-1){var g=d.href.split("#")[1];d.href="javascript:void(0)";f.unbind("click").bind("click",{anchor:g},function(a){b.KindleContentActions.goToLocation(a.data.anchor,
"name",!1)||c("#sitbReaderPageContainer").scrollTop(b.KindleContentActions._contentHolder.height())})}}else if((d.href.lastIndexOf("http:",0)===0||d.href.lastIndexOf("https:",0)===0)&&d.className!=="sitb-buy-box")d.target="_new"})};y.prototype.getLocation=function(a,b){var d=void 0;l(b)||b=="class"?d=c("#sitbReaderFrame").contents().find("."+a):b=="name"&&(d=c("#sitbReaderFrame").contents().find("a[name='"+a+"']"));return d};y.prototype.adjustHeight=function(a,e){c("#sitbReaderFrame").contents().find("html").css("font-size",
b.ZoomModel.getFontSize());b.ZoomModel.getPageWidth();c("#sitbReaderPageContainer");var d=c("img",c("#sitbReaderFrame").contents());c.each(d,function(a,e){var d=c(e),h=d.css("font-size"),h=b.ZoomModel.getPageWidth()-parseFloat(h.substring(0,h.length-2))-120,j=d.data("realPicWidth");if(e.width>h||j&&j>h){d.css("max-width",h);d.css("height","auto");for(h=d;h.parent().is("div");)h=h.parent(),h.css("height","auto")}e.naturalHeight&&e.height>e.naturalHeight&&(d.css("max-height",e.naturalHeight),d.css("height",
"auto"))});d=c("#sitbReaderFrame").contents().find("#sitbReaderEndOfSampleInFrame").position().top+10;c("#sitbReaderFrame").css("height",d);d=e.position().top;a.parent().parent().css("height",d);a.parent().css("height",d);a.css({height:d});return d};y.prototype.updateContent=function(){var a=document.getElementById("sitbReaderFrame");a.contentDocument.open();a.contentDocument.close();if(q){var e=document.createElement("style");e.setAttribute("type","text/css");e.styleSheet.cssText=this.sampleDefaultCSSForIE;
a.contentDocument.getElementsByTagName("head")[0].appendChild(e);var e=this.sampleBookCSSForIE.match(/href="(.*)"/),d=document.createElement("link");d.href=e[1];d.rel="StyleSheet";a.contentDocument.getElementsByTagName("head")[0].appendChild(d);e=document.createElement("div");e.innerHTML="<div>"+this.sampleBodyForIE+"</div>";a.contentDocument.getElementsByTagName("body")[0].appendChild(e.firstChild)}else a.contentDocument.getElementsByTagName("html")[0].innerHTML=this.sampleHtml;a=c("#sitbReaderFrame").contents();
a=c("img",a);b.KindleContentWidget._imageCount=a.length;c.each(a,function(a,e){var d=c(e);l(d.attr("src"))||(d.position().top<b.KindleContentWidget._srlOffsetTop&&(b.KindleContentWidget._imagesPreSRL+=1),d.load(b.KindleContentWidget._handleImage).error(b.KindleContentWidget._handleImage))})};n.prototype=I(w.prototype);n.prototype.constructor=n;n.prototype.getHtmlFragment=function(){var a=document.createDocumentFragment(),b=c(document.createElement("div"));b.attr("id","sitbReaderKindleSample");b.css("visibility",
"hidden");var d=c(document.createElement("iframe"));d.attr("id","sitbReaderFrame");b.append(d);b.append("<div id='sitbReaderEndOfSample' />");a.appendChild(b[0]);return a};n.prototype.isMobi8FixedFormat=function(){return this.htmlUrls&&this.format=="mobi8FixedFormat"};n.prototype.gotoPrevPage=function(){return this.changePage(!1)};n.prototype.gotoNextPage=function(){return this.changePage(!0)};n.prototype.changePage=function(a){if(j.changeElement(!a,a))return!0;for(var e=c("#sitbReaderFrame").contents(),
d=e.find("iframe"),f=0;f<d.length;f++){var g=d[f],k=j.isInternetExplorer8()?g.offsetTop:c(g).position().top,g=c(g).height(),g=k+g;if(a&&this.isTopPage(k)||!a&&this.isBottomPage(g)){e.scrollTop(k);break}}j.globalCurrentZoomable.setCurrentZoomable(null);b.ReaderWidget.updatePageTurnersState();return!0};n.prototype.isTopPage=function(a){return this.checkPage(!0,a)};n.prototype.isBottomPage=function(a){return this.checkPage(!1,a)};n.prototype.getScrollTop=function(a){return j.isInternetExplorer8()&&a[0]&&
a[0].documentElement?a[0].documentElement.scrollTop:a.scrollTop()};n.prototype.checkPage=function(a,b){var d=c("#sitbReaderPageContainer"),f=this.getScrollTop(c("#sitbReaderFrame").contents()),d=f+d.height();return b>(a?f+10:f-10)&&b<d};n.prototype.hasNextPage=function(){if(j.globalCurrentZoomable.getCurrentZoomable&&j.globalCurrentZoomable.getCurrentZoomable()!=null)return j.globalCurrentZoomable.getCurrentZoomable().hasNext();var a=c("#sitbReaderFrame"),b=a.contents();return b.height()>this.getScrollTop(b)+
a.height()+20};n.prototype.hasPrevPage=function(){return j.globalCurrentZoomable.getCurrentZoomable&&j.globalCurrentZoomable.getCurrentZoomable()!=null?j.globalCurrentZoomable.getCurrentZoomable().hasPrevious():this.getScrollTop(c("#sitbReaderFrame").contents())>10};n.prototype.getLocation=function(a,b){var d=void 0;l(b)||b=="class"?d=c("#sitbReaderFrame").contents().find("."+a):b=="name"&&(d=c("#sitbReaderFrame").contents().find("a[name='"+a+"']"));return d};n.prototype.adjustHeight=function(){b.ZoomWidget.disableZoomIn();
b.ZoomWidget.disableZoomOut();var a=c("#sitbReaderPageScroll").find("#scrollElm-0");(!a||!a.hasClass("pageHtml"))&&setTimeout(this.adjustHeight(),100);var e=(c("#sitbReaderPageContainer").width()-a.width())/2;c("#sitbReaderPageScroll").css("left",e);c("#sitbReaderPageScroll").height("100%");a.css("margin-left",0);a.height("100%").height(a.height()-9);a.find("#sitbReaderKindleSample").height("100%");a.find("#sitbReaderKindleSample").width("100%");a.find("#sitbReaderKindleSample").css("margin",0);c("#sitbReaderBottomButton").css("display",
"none");c("#sitbReaderPageContainer").find("#scrollElm-0").css("font-size","14px")};n.prototype.updateContent=function(){c("#sitbReaderPageScroll").find("#scrollElm-0").css("visibility","hidden");var a=c("#sitbReaderFrame").contents()[0];a.open();for(var e=0;e<this.htmlUrls.length+1;e++){var d='<iframe id="'+this.getInnerFrameName(e)+'" frameborder="0" scrolling="no" tabindex="-1" style="width: 100%; height: 100%; margin: 0px auto; display: block; visibility: visible; top: 0px;"></iframe>';a.write(d)}a.close();
this.insertPage(this.htmlUrls.length,null);this.pagesAdded=0;if(this.html&&this.html.length==this.htmlUrls.length)for(a=0;a<this.html.length;a++)this.insertPage(a,this.html[a]);else{this.html=[];for(a=0;a<this.htmlUrls.length;a++)this.extractJSONFromUrl(this.htmlUrls[a],a)}c(j.getIframeWindow(frames.sitbReaderFrame)).scroll(function(){b.ReaderWidget.updatePageTurnersState()})};n.prototype.extractJSONFromUrl=function(a,b){if(c.browser.msie&&window.XDomainRequest){var d=new XDomainRequest;d.open("get",
a);d.onload=function(a,b){return function(){b.onJSONDownload(c.parseJSON(d.responseText),a)}}(b,this);d.onprogress=function(){};d.ontimeout=function(){};d.onerror=function(){};setTimeout(function(){d.send()},0)}else c.ajax({dataType:"json",url:a,success:function(a){this.onJSONDownload(a,b)},context:this})};n.prototype.onJSONDownload=function(a,b){if(a.content){this.html[b]=[];for(var c=0;c<a.content.length;c++){var f=a.content[c];this.html[b][c]=f[0]=="CSS"&&f.length==2?this.cssUrls[f[1]]:f[0]=="RESOURCE"&&
f.length==2?this.resourceUrls[f[1]]:f[0]}this.insertPage(b,this.html[b])}};n.prototype.insertPage=function(a,e){var d,f=c("#sitbReaderFrame").contents().find("#"+this.getInnerFrameName(a));a<this.htmlUrls.length?d=e:(d=b.Message.getMobi8FixedFormatHtmlBuyMessage(),c(f).height(182));var g=this;c(f).load(function(){g.pagesAdded++;g.pagesAdded==g.htmlUrls.length&&j.setupMobi8FixedFormatRenderer()});var k=c(f).contents()[0];k.open();c.each(d,function(a,b){k.write(b)});k.close()};n.prototype.getInnerFrameName=
function(a){return"book_page_"+a};n.prototype.waitUntilLoaded=function(a,b){a.readyState!="complete"?setTimeout(b,1):c().ready(b)};var ya=function(){function a(a,b){return a!==void 0&&b!==void 0&&a.data!==void 0&&b.data!==void 0&&a.data&&b.data?a.data.ordinal!==void 0&&b.data.ordinal!==void 0?a.data.ordinal-b.data.ordinal:a.data.ordinal===void 0&&b.data.ordinal===void 0?0:a.data.ordinal!==void 0?-1:1:!a.data&&!b.data?0:a.data?-1:1}function b(a){a.setActive=function(a){if(this.sourceElement){var b=
this.sourceElement.ownerDocument;if(b&&this.data.targetId){var e=c(b).find("#"+this.data.targetId),d=null;a?(this.data.sourceId&&(d=c(b).find("#"+this.data.sourceId),c.trim(e.html()).length===0&&(a=d.clone(),a.css({visibility:"visible",color:"black"}),c(e).append(a)),d.hide()),e.show()):(e.hide(),this.data.sourceId&&(d=c(b).find("#"+this.data.sourceId),d.show()))}}};a.isSame=function(a){return a.internalComparison(this.sourceElement)};a.internalComparison=function(a){return this.sourceElement===a};
a.hasNext=function(){return this.nextElement};a.hasPrevious=function(){return this.previousElement};a.setNext=function(a){this.nextElement=a};a.setPrevious=function(a){this.previousElement=a};a.activateNext=function(){return this.hasNext()&&typeof this.nextElement.activate=="function"?(this.setActive(!1),this.nextElement.activate(),this.nextElement):null};a.activatePrevious=function(){return this.hasPrevious()&&typeof this.previousElement.activate=="function"?(this.setActive(!1),this.previousElement.activate(),
this.previousElement):null};a.setFrame=function(a,b,e){this.frameId=a;this.outerFrameId=b;this.frameCallback=e};a.jumpToPage=function(){typeof this.frameCallback!="undefined"&&this.frameCallback(this.outerFrameId,this.frameId)}}function d(a,b){a.activate=function(){return b.setActive(!0)};a.deactivate=function(){return b.setActive(!1)};a.activateNext=function(){var e=b.activateNext();return e?e:a};a.activatePrevious=function(){var e=b.activatePrevious();return e?e:a};a.hasNext=function(){return b.hasNext()};
a.hasPrevious=function(){return b.hasPrevious()};a.setNext=function(a){b.setNext(a)};a.setPrevious=function(a){b.setPrevious(a)};a.setFrame=function(a,e,c){b.setFrame(a,e,c)};a.jumpToPage=function(){b.jumpToPage()};a.isSame=function(a){return b.isSame(a)};a.internalComparison=function(a){return b.internalComparison(a)}}function f(a,b,e,d){a.sourceElement=b;var f=b.getAttribute(g);a.data=JSON.parse(f);c(e).find("#"+a.data.targetId).click(function(){j.regionMagnification(a.data.ordinal,0,d)});c(b).click(function(){j.regionMagnification(a.data.ordinal,
1,d)})}var g="data-app-amzn-magnify";return{buildList:function(g,h){var j=[],l=c(g).find(".app-amzn-magnify").get();if(typeof l!="undefined")for(var m=0;m<l.length;m++)try{var n={};f(n,l[m],g,h);b(n);j.push(n)}catch(q){}j.sort(a);l=[];if(j)for(m=0;m<j.length;m++)n={},d(n,j[m]),l.push(n);return l},createExternalZoomable:function(a,c){b(c);d(a,c)}}}();j.regionMagnification=function(a,e,c){c<j.frameRegion2DList.length&&j.frameRegion2DList[c]&&(j.deactivateAllZoomables(j.frameRegion2DList),e&&a>0&&a-
1<j.frameRegion2DList[c].length?(a=j.frameRegion2DList[c][a-1],a.activate(),a.jumpToPage(),j.globalCurrentZoomable.setCurrentZoomable(a)):j.globalCurrentZoomable.setCurrentZoomable(null));b.MessageWidget.hide()};j.deactivateAllZoomables=function(a){if(a)for(var b=0;b<a.length;b++)for(var c=0;c<a[b].length;c++)typeof a[b][c].deactivate=="function"&&a[b][c].deactivate()};j.regionMagnificationScrollHandler=function(a){a.body.addEventListener?a.body.addEventListener("keydown",this.changeElementKeyDownHandler):
a.body.attachEvent("onkeydown",this.changeElementKeyDownHandler);c(a.body).bind("DOMMouseScroll mousewheel wheel",function(a){return!j.changeElement(a.deltaY<0||a.originalEvent.deltaY<0||a.wheelDelta>0,a.deltaY>0||a.originalEvent.deltaY>0||a.wheelDelta<0)})};j.changeElementKeyDownHandler=function(a){return j.changeElement(a.keyCode==37||a.keyCode==38,a.keyCode==39||a.keyCode==40,a)};j.changeElement=function(a,b,c){return j.globalCurrentZoomable&&typeof j.globalCurrentZoomable.getCurrentZoomable==
"function"&&j.globalCurrentZoomable.getCurrentZoomable()&&j.globalCurrentZoomable.getCurrentZoomable()!=null?(b&&(j.globalCurrentZoomable.setCurrentZoomable(j.globalCurrentZoomable.getCurrentZoomable().activateNext()),j.globalCurrentZoomable.getCurrentZoomable().jumpToPage()),a&&(j.globalCurrentZoomable.setCurrentZoomable(j.globalCurrentZoomable.getCurrentZoomable().activatePrevious()),j.globalCurrentZoomable.getCurrentZoomable().jumpToPage()),c&&c.preventDefault&&c.preventDefault(),!0):!1};j.resizeIframe=
function(a,b){for(var d=0;d<b.length;d++){var f=c(b[d].window.frameElement),g=j.getIframeWindow(a);if(f&&g&&f.contents().find("div.sitb-buy-box").length==0){var h=g.innerHeight,g=g.innerWidth;j.isInternetExplorer8()&&(h=c(a).height(),g=c(a).width());h={height:h,width:g-25};b[d].frameElement.id=="book_page_0"?f.width("100%"):f.width(0);f.height("100%");h=j.scaleContentToViewport(b[d],h);h.height>0&&(f.height(h.height),f.width(h.width))}}};j.getIframeWindow=function(a){if(a.contentWindow)return a.contentWindow;
else if(a.window)return a.window;return null};j.pageCallback=function(a,b){var d=c("#"+a).contents().find("#"+b),d=j.isInternetExplorer8()?d[0].offsetTop:d.position().top;c("#"+a).contents().scrollTop(d)};j.addDeactivateClickEvent=function(a,b){c(a).click(function(){j.deactivateAllZoomables(b);j.globalCurrentZoomable.setCurrentZoomable(null)})};j.setup2DLinkedList=function(a){for(var b=null,c=0;c<a.length;c++)for(var f=0;f<a[c].length;f++)b!=null&&(a[c][f].setPrevious(b),b.setNext(a[c][f])),b=a[c][f]};
j.addDummyZoomable=function(a,b,c,f){var g={},h=[];ya.createExternalZoomable(g,{});g.setFrame(b,c,f);h.push(g);a.push(h)};j.hasZoomables=!1;j.frameRegion2DList=[];j.globalCurrentZoomable={getCurrentZoomable:function(){return this.currentZoomable},setCurrentZoomable:function(a){this.currentZoomable=a;a==null&&j.deactivateAllZoomables(j.frameRegion2DList)}};j.setupMobi8FixedFormatRenderer=function(){j.frameRegion2DList=[];sitbOuterFrameId="sitbReaderFrame";readerIframe=frames[sitbOuterFrameId];if((readerIframeWindow=
j.getIframeWindow(readerIframe))&&readerIframeWindow.document)if((readerIframeDocument=readerIframeWindow.document)&&readerIframeWindow.frames){readerPageFrames=readerIframeWindow.frames;readerIframeWindow.onresize=function(){j.resizeIframe(readerIframe,readerPageFrames)};c("#sitbReaderPageScroll").find("#scrollElm-0").resize(function(){j.resizeIframe(readerIframe,readerPageFrames)});for(var a=0;a<readerPageFrames.length;a++){var e=ya.buildList(readerPageFrames[a].document,a),d=e.length,f=readerPageFrames[a].window.frameElement.id;
if(d==0)j.addDummyZoomable(j.frameRegion2DList,f,sitbOuterFrameId,j.pageCallback);else{for(var g=0;g<d;g++)e[g].setFrame(f,sitbOuterFrameId,j.pageCallback);j.hasZoomables=!0;j.frameRegion2DList.push(e)}c(readerPageFrames[a].document).find("div.sitb-buy-box").length>0&&j.addDeactivateClickEvent(readerPageFrames[a].document.body,j.frameRegion2DList);j.regionMagnificationScrollHandler(readerPageFrames[a].document)}setTimeout(function(){j.resizeIframe(readerIframe,readerPageFrames)},2E3);j.setup2DLinkedList(j.frameRegion2DList);
j.addDeactivateClickEvent(readerIframeDocument.body,j.frameRegion2DList);j.regionMagnificationScrollHandler(readerIframeDocument);j.resizeIframe(readerIframe,readerPageFrames)}b.kindleRenderer.adjustHeight();c("#sitbReaderPageScroll").find("#scrollElm-0").css("visibility","visible");b.MessageActions.getMobi8FixedFormatMessage();b.MessageWidget.show()};j.getScaleFactor=function(a,b){return a.width>0&&a.height>0?Math.min(b.width/a.width,b.height/a.height):1};j.isInternetExplorer8=function(){return c.browser.msie&&
(c.browser.version.substring(0,2)=="8."||c.browser.version<=8)};j.scaleContentToViewport=function(a,b){if(b.width>0&&b.height>0){var d=a.document.body,f={height:c(d).height(),width:c(d).width()},g=c(a.document.body).children(".fs")[0];g===void 0&&(g=d);f.width=c(g).outerWidth(!0);f.height=c(g).outerHeight(!0);g=c(a.document.head).find("meta[name='viewport']");if(g.length>0){g=g[0];g=c(g).attr("content");g=g.split(",");for(i=0;i<g.length;i++){var h=g[i].trim().split("=");if(h[0].trim()==="height")f.height=
h[1].trim();else if(h[0].trim()==="width")f.width=h[1].trim()}}a.frameElement.id!="book_page_0"&&c(d).css({height:f.height,width:f.width});f=j.getScaleFactor(f,b);a.frameElement.id!="book_page_0"&&(g="scale("+f+")",c(d).css({"-moz-transform":g,"-moz-transform-origin":"left top","-webkit-transform":g,"-webkit-transform-origin":"left top","-o-transform":g,"-o-transform-origin":"left top","ms-transform":g,"ms-transform-origin":"left top","-ms-transform":g,"-ms-transform-origin":"left top",transform:g,
"transform-origin":"left top"}),this.isInternetExplorer8()&&c(d).css("zoom",f));navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")!=-1&&c(d).css("image-rendering","-webkit-optimize-contrast")}return{width:c(d).width()*f,height:c(d).height()*f}};b.HistoryActions={useBack:!0,loadTagged:!1,suppressClosing:!1,userInitiatedClose:!1,initialized:!1,initialize:function(){if(!b.HistoryActions.initialized&&!c.browser.safari)b.HistoryActions.initialized=!0,p.available("AmazonHistory",
function(){p.history.change("reader",function(a,c){b.HistoryActions.onHistoryChange(a+"_"+c)})})},onHistoryChange:function(a){if(b.HistoryActions.suppressClosing==!0)b.HistoryActions.suppressClosing=!1,window.location.replace("#reader_"+b.currentBook.buyingAsin);else if(a.substr(0,6)=="reader"){if(b.LightboxActions.openMutex==0&&(a=a.substr(7),/^\w{10}$/.test(a)))Vellum.o(a),b.HistoryActions.loadTagged=!0}else b.LightboxActions.openMutex==1&&b.HistoryActions.loadTagged==!1?(b.HistoryActions.loadTagged=
!0,p.history.create("reader",b.currentBook.buyingAsin)):b.LightboxActions.openMutex==1&&(b.HistoryActions.userInitiatedClose||b.RefTag.post(b.RefTag.Actions.exit,b.RefTag.ExitMethod.backbutton),b.LightboxActions.close())},automaticOpen:function(a){c.browser.safari?b.HistoryActions.useBack=!1:(b.HistoryActions.useBack=!1,b.HistoryActions.suppressClosing=a,b.HistoryActions.loadTagged=!0)}};b.LightboxActions={oldScrollYPos:-1E8,oldScrollXPos:-1E8,openMutex:0,resizeTimeout:null,didLod:!1,currentAsin:null,
openTime:0,switchTime:0,readerReady:!1,bookCache:[],requestId:null,pageNotLoaded:!0,weblab:null,resetState:function(){var a=b.SBWidget.isOpened;b.SBWidget.isOpened=null;b.SBActions.isLoading=!1;b.SerendipityBar.dataLoaded=!1;b.SerendipityBar.recommendedBooks=[];b.SerendipityBar.historyBooks=[];b.Message.messagesDisplayed=!1;b.MessageWidget.supressMessages=!1;b.PageSequenceActions.reset();b.SearchWidget.clearResults();a&&b.SBWidget.show(!0)},initialize:function(a){var e=a.ASIN;if(e!=this.currentAsin){this.resetState();
if(Vellum.ao)b.HistoryActions.automaticOpen(!0),Vellum.ao=!1;if(!b.metrics)b.metrics=new b.Metrics;window.sitbLodStart||b.metrics.startTimer("initialize");this.setInitialLightboxState(window.sitbState);if(window.sitbWeblab!="")this.weblab=window.sitbWeblab;this.bookCache[e]||(this.bookCache[e]={book:void 0,availability:void 0});if(!this.bookCache[e].availability)this.bookCache[e].availability=new b.Availability(a);b.availability=this.bookCache[e].availability;b.pageSequence=new b.PageSequence;b.pageSequence.updateAvailablePages(a.buyingAsin);
if(!this.bookCache[e].book)this.bookCache[e].book=new b.Book(a);b.currentBook=this.bookCache[e].book;b.currentSearch=new b.Search;b.Message.pictureSuppressed=a.pictureSuppressed?h("PIC_SUPP_MSG"):null;b.Message.partialContentMessage=a.partialContent?h("PARTIAL_CONTENT_MSG"):null;b.LightboxActions.load();b.currentBook.isImage()&&(e=b.currentBook.bookmarks.getFirstPageNumber(0),(e=b.currentBook.getPage(e))&&e.loadImage(1));window.sitbLodStart?(b.metrics.count("lodload"),b.LightboxActions.didLod=!0,
b.metrics.recordTimer("initialize",(new Date).getTime()-window.sitbLodStart)):b.metrics.endTimer("initialize");this.currentAsin=a.ASIN;var e=b,a=a.intlField,d={on:!1},f=/<input type="hidden" name="(.*)" value="(.*)" \/>/g;if(typeof a=="string"&&a.match(f))d.on=!0,d.name=RegExp.$1,d.value=RegExp.$2;e.encodingProperties=d;a=c("body");e=a.css("overflow");d=a.css("overflow","hidden").width();a.css("overflow","scroll");d-=a.width();d||(d=a.width()-a[0].clientWidth);a.css("overflow",e);u=d}},openReader:function(a){Vellum.o(Vellum.asin,
a);return!1},openReaderToRandomPage:function(a){Vellum.r(Vellum.asin,a);return!1},openReaderToSearchResults:function(a,b){Vellum.q(Vellum.asin,a,b);return!1},openReaderToPage:function(a,b,c){Vellum.p(Vellum.asin,a,b,c);return!1},_openReader:function(a){openReaderCallback=function(){b.currentBook.isImage()&&b.PageSequenceActions.goTo(1)};b.LightboxActions.openReaderHelper(a,openReaderCallback)||b.LightboxActions.reloadReaderHelper(openReaderCallback)},_openReaderToRandomPage:function(a){openReaderToRandomPageCallback=
function(){b.currentBook.isPrint()&&b.PageSequenceActions.goToRandomPage()};b.LightboxActions.openReaderHelper(a,openReaderToRandomPageCallback)||b.LightboxActions.reloadReaderHelper(openReaderToRandomPageCallback)},_openReaderToSearchResults:function(a,c){openReaderToSearchResultsCallback=function(){a!=""?b.SearchActions.search(a):b.currentBook.isImage()&&b.PageSequenceActions.goTo(1)};b.LightboxActions.openReaderHelper(c,openReaderToSearchResultsCallback)||b.LightboxActions.reloadReaderHelper(openReaderToSearchResultsCallback);
return!1},_openReaderToPage:function(a,c,d){c&&b.PageSequenceActions.installToken(a,c);openReaderToPageCallback=function(){b.currentBook.isImage()&&b.PageSequenceActions.goTo(a)};b.LightboxActions.openReaderHelper(d,openReaderToPageCallback)||b.LightboxActions.reloadReaderHelper(openReaderToPageCallback)},openReaderHelper:function(a,e){if(b.LightboxActions.openMutex==0){if(b.LightboxActions.openMutex++,b.LightboxActions.openMutex>1)return b.LightboxActions.openMutex--,!1}else return!1;b.metrics.start();
var d=b.currentBook;ja()=="ie6"?c(window).unbind("beforeunload.sitbreader").bind("beforeunload.sitbreader",b.LightboxActions.unload):c(window).unbind("unload.sitbreader").bind("unload.sitbreader",b.LightboxActions.unload);!b.LightboxActions.didLod&&!b.sitbReaderOpenStart&&(d.isPrint()?(b.metrics.startTimer("show_print"),b.metrics.startTimer("show_print_other")):(b.metrics.startTimer("show_kindle"),b.metrics.startTimer("show_kindle_other")));b.MessageActions.getRelatedEditionMessage();c(window).bind("scroll.sitbreader",
function(a){z(a)});c("body").css("overflow","hidden");b.LightboxWidget.dimTheLights();b.metrics.startTimer("showDelay");setTimeout(function(){b.LightboxActions.openTime=(new Date).getTime();b.metrics.endTimer("showDelay");b.metrics.startTimer("showRenderLightbox");b.LightboxActions.load(!1);b.LightboxActions.show();e();b.LightboxActions.readerReady=d.isPrint();b.metrics.endTimer("showRenderLightbox");$("cf",b.LightboxActions.requestId);b.LightboxActions.didLod?(b.metrics.recordTimer(d.isPrint()?"show_print":
"show_kindle",(new Date).getTime()-window.sitbLodStart),b.metrics.recordTimer(d.isPrint()?"show_print_LoD":"show_kindle_LoD",(new Date).getTime()-window.sitbLodStart),window.sitbLodStart=!1,b.LightboxActions.didLod=!1):b.sitbReaderOpenStart?(b.metrics.recordTimer(d.isPrint()?"show_print":"show_kindle",(new Date).getTime()-b.sitbReaderOpenStart),b.metrics.recordTimer(d.isPrint()?"show_print_normal":"show_kindle_normal",(new Date).getTime()-b.sitbReaderOpenStart),b.sitbReaderOpenStart=!1):(b.metrics.endTimer(d.isPrint()?
"show_print":"show_kindle"),b.metrics.endTimer(d.isPrint()?"show_print_other":"show_kindle_other"));setTimeout(function(){d.isOriginalBookPrint()?b.RefTag.httpGet(b.RefTag.Application.print_dp):b.RefTag.httpGet(b.RefTag.Application.kindle_dp);d.isPrint()?b.RefTag.httpGet(b.RefTag.Application.print_show):b.RefTag.httpGet(b.RefTag.Application.kindle_show);if(Vellum.onReaderOpen)Vellum.onReaderOpen();if(p.history&&window.location.hash.substring(0,7)!="#reader")b.HistoryActions.loadTagged=!0,p.history.create("reader",
b.currentBook.buyingAsin)},0);F&&setTimeout(function(){var a=void 0;switch(B){case 1:a=b.RefTag.Touch.ios;break;case 2:a=b.RefTag.Touch.android2;break;case 3:a=b.RefTag.Touch.android3;break;case void 0:a=b.RefTag.Touch.android4;break;case 4:a=b.RefTag.Touch.fire;break;case 5:a=b.RefTag.Touch.other}b.RefTag.post(b.RefTag.Actions.touch,a)},0)},200);return!0},reloadReaderHelper:function(a){b.LightboxActions.readerReady=!1;b.LightboxActions.switchTime=(new Date).getTime();b.metrics.startTimer("reload_pageSequenceWidget_show");
b.PageSequenceWidget.show(!1);b.metrics.endTimer("reload_pageSequenceWidget_show");setTimeout(function(){b.MessageActions.getRelatedEditionMessage();b.MessageWidget.show();b.currentBook.searchable&&(b.SearchWidget.load(),b.SearchWidget.show(),b.BookmarksWidget.show());b.currentBook.isImage()?(b.PageSequenceWidget.redrawCallback=function(){b.PageSequenceWidget.redrawCallback=void 0;a.call();b.LightboxActions.readerReady=!0},b.PageSequenceWidget.redraw()):(b.LightboxActions.handleResize(),a.call(),
b.LightboxActions.readerReady=!0)},0);c("#vellumLdgIco").hide()},show:function(){c("#bookpopover").hide();V&&b.LightboxWidget.toggleSelextBoxes(!1);c("#sitbReaderPlaceholder").show();b.ErrorMessageWidget.hide();b.ReaderKeyboardActions.load();b.metrics.startTimer("show_lightboxwidget_show");b.LightboxWidget.show(!0);b.metrics.endTimer("show_lightboxwidget_show");b.ZoomModel.initialize();b.metrics.startTimer("show_pageSequenceWidget_show");b.PageSequenceWidget.show(!0);b.metrics.endTimer("show_pageSequenceWidget_show");
b.ReaderWidget.show();b.ZoomWidget.show();b.SearchWidget.show();b.BookmarksWidget.show();b.LeftPaneWidget.show();b.SBWidget.show(!0);b.MessageWidget.show();b.BottomButtonWidget.show();this._registerResizeHandler();b.pageSequence.resetReadingLocationCache();c("#vellumLdgIco").hide()},handleResize:function(){b.metrics.startTimer("resize");b.LightboxWidget.resizeShade();b.LightboxWidget.show();b.ReaderWidget.updateOnResize();b.SearchWidget.setResultsHeight();b.BookmarksWidget.updateHeight();b.ErrorMessageWidget.resize();
b.BottomButtonWidget.handleResize();b.MessageBoxWidget.resize();b.metrics.startTimer("SBresize");b.SBWidget.resize();b.metrics.endTimer("SBresize");c("#vellumLdgIco").hide();b.metrics.endTimer("resize")},load:function(){if(b.loadedBook!=b.currentBook){b.HistoryActions.initialize();var a=c("#sitbReaderPlaceholder");l(a.html())&&a.html('<div id="sitbLightbox">    <div id="sitbLBHeader">       <div id="sitbReaderAmazonLogo"></div>       <div id="sitbReaderLookInside"></div>       <div id="sitbReaderMode">           <div class="readerModeTab" id="readerModeTabKindle">              <div class="readerModeTabBorder readerModeTabBorderLeft"/>               <div class="readerModeTabContent">'+
h("KINDLE_PREVIEW")+'</div>              <div class="readerModeTabBorder readerModeTabBorderRight"/>               <div id="sitbReaderCustomerRequestContainer">                  <div id="sitbReaderCustomerRequestWrapper">                      <div id="sitbReaderCustomerRequestContent"></div>                  </div>              </div>           </div>           <div class="readerModeTab" id="readerModeTabPrint">              <div class="readerModeTabBorder readerModeTabBorderLeft"/>               <div class="readerModeTabContent">'+
h("PRINT_PREVIEW")+'</div>              <div class="readerModeTabBorder readerModeTabBorderRight"/>            </div>       </div>       <div id="sitbReaderZoomToolbar">           <button id="sitbReaderTitlebarZoomIn" title="'+Ka+'"/>            <button id="sitbReaderTitlebarZoomOut" title="'+La+'"/>        </div>       <div id="sitbReaderTBLinks">           <div id="sitbReaderHelpMenu"></div>           <a href="javascript:void(0)" id="sitbReaderHelpLink">'+h("HELP")+'</a>&nbsp;|&nbsp;           <a href="javascript:void(0)" id="sitbReaderFullscreenLink" onclick="SitbReader.LightboxWidget.toggleFullscreen();">'+
ua+'</a>&nbsp;|&nbsp;           <a href="javascript:void(0)" id="sitbReaderCloseLink" class="sitbReaderClose" onclick="SitbReader.LightboxActions.back(SitbReader.RefTag.ExitMethod.link, true)">'+h("CLOSE")+'</a>       </div>       <div id="sitbReaderCloseButton" class="sitbReaderClose" onclick="SitbReader.LightboxActions.back(SitbReader.RefTag.ExitMethod.button, true)" title="'+Oa+'"></div>       <div id="sitbReaderHeaderSpacer" />    </div>  <div id="sitbReaderMiddle">    <div id="sitbReader-leftnav">      <div id="sitbReaderLeftPane">      \t  <div id="sitbReaderLeftStaticHeight">           <div id="sitbReaderBuyContent" class="sitbReaderBuyBox">           <div>                <a href="javascript:void(0)" id="sitbReaderBookThumbnailHolder"></a>              <div id="sitbReaderBookTitle"><a href="javascript:void(0)"></a> <span id="sitbReaderBinding"></span></div>              <div id="sitbReaderAuthorBlock"></div>            </div>            <div id="sitbReaderPriceBlock"></div>            <div id="sitbReaderFastTrackBlock"></div>            <div id="sitbReaderDeviceBlock"></div>            <div id="sitbReaderUsedDiv">              &nbsp;            </div>          </div>           <div id="sitbReaderPriceBlock1"></div>           <div id="sitbReaderPriceBlock2"></div>           <div id="sitbReaderBookmarks">'+
b.BookmarksWidget.paneTitleWidget.getHtml()+'               <div id="sitbReaderBookmarks-pages"></div>           </div>\t\t   </div>           <div id="sitbReaderSearch">               <div id="sitbReaderSearch-loading"></div>'+b.SearchWidget.paneTitleWidget.getHtml()+'                   <div id="sitbReaderSearch-contents">                       <div id="sitbReaderSearch-headerheight">                           <div id="sitbReaderSearch-input">                               <form id="sitbReaderSearch-form">                                   <input type="text" class="sitbReaderSearch-inputbox"                                          title="'+
Qa+'"                                          onfocus="SitbReader.ReaderKeyboardActions.isKeyHandler = false"                                          onblur="SitbReader.ReaderKeyboardActions.isKeyHandler = true">                                   <input type="button" class="sitbReaderSearch-button" title="'+Ra+'" onclick="SitbReader.SearchWidget.submitSearch();"></input>                               </form>                           </div>                           <div id="sitbReaderSearch-count">                           <div class="sitbReader-horizontal-gray-dash-border"></div>                           <div class="sitbReader-horizontal-white-border"></div>                           <div class="sitbReaderSearch-count-block">                               <div id="sitbReaderSearch-close" title="'+
Pa+'" onclick="SitbReader.SearchActions.closeCurrentSearch();"></div>                               <span id="sitbReaderSearch-count-text"></span>                           </div>                           <div class="sitbReader-horizontal-white-border"></div>                           <div class="sitbReader-horizontal-gray-dash-border"></div>                       </div>                       <div id="sitbReaderSearch-sips"></div>\t\t\t        </div>                   <div id="sitbReaderSearch-all-results"                        onfocus="SitbReader.ReaderKeyboardActions.isKeyHandler = false"                        onblur="SitbReader.ReaderKeyboardActions.isKeyHandler = true">                   </div>               </div>           </div>      </div>      <div id="sitbReaderBorderOverlay"></div>      <div id="sitbReaderSplitter" class="sitbReaderSplitter"            onclick="SitbReader.LeftPaneWidget.toggle()"            onmouseover="SitbReader.LeftPaneWidget.splitterOnMouseHelper(\'onMouseOver\')"            onmouseout="SitbReader.LeftPaneWidget.splitterOnMouseHelper(\'onMouseOut\')">      </div>      <div id="sitbReaderSplitter_bottom" class="sitbReaderSplitter"></div>      <div id="sitbReaderCollapser"            onclick="SitbReader.LeftPaneWidget.toggle()"            onmouseover="SitbReader.LeftPaneWidget.splitterOnMouseHelper(\'onMouseOver\')"            onmouseout="SitbReader.LeftPaneWidget.splitterOnMouseHelper(\'onMouseOut\')">      </div></div>    <div id="sitbReader-pagearea">      <div id="sitbReaderPageContainerVerticalScroller">        <button id="sitbReaderLeftPageTurner" title="'+
Na+'"></button>        <button id="sitbReaderRightPageTurner" title="'+Ma+'"></button>      </div>      <div id="sitbReaderLoadingPageMessage"/>      <div id="sitbReaderErrorMessageContainer">        <div id="sitbReaderErrorMessageIcon"></div>        <div id="sitbReaderErrorMessageHeader"></div>        <div id="sitbReaderErrorMessageText"></div>        <div id="sitbReaderErrorMessageClose"></div>      </div>      <div id="sitbReaderMessageContainer">        <div id="sitbReaderInfoMessageIcon"></div>        <div id="sitbReaderMessageHeader">'+
Ia+'</div>        <br/>        <ul id="sitbReaderMessageList">        </ul>        <div class="sitbReaderErrorMessageClose" onclick="SitbReader.MessageWidget.close(true);"></div>      </div>      <div id="sitbReaderMessageBoxContainer">      </div>      <div id="sitbReaderPageContainer">         <div id="sitbReaderPageScroll"></div>      </div>      <div id="sitbReaderBottomButton">          <div class="readerBottomButton" id="sitbReaderBottomButtonLeft" />          <div id="sitbReaderPageLabel"/>          <div class="readerBottomButton" id="sitbReaderBottomButtonRight" />      </div>'+
b.SBWidget.getHtml()+"</div>");b.ReaderWidget.load();b.BookmarksWidget.load(b.currentBook.bookmarks);b.BookmarksWidget.show();b.LightboxWidget.load(b.currentBook.title);b.BuyWidget.load(b.currentBook);b.SearchWidget.load();b.HelpWidget.load();b.ModeSwitchWidget.load();b.BottomButtonWidget.load();b.CustomerRequestWidget.load();b.loadedBook=b.currentBook;b.ClickableTOC.hasPages={};b.ClickableTOCActions.loadTOCallMade={}}},close:function(){c(window).unbind(".sitbreader").unbind("orientationchange");
b.ReaderKeyboardActions.tearDown();c("#sitbReaderPageContainer").unbind();b.PageSequenceActions.reset();V?c(window).unbind("beforeunload.sitbreader"):c(window).unbind("unload.sitbreader");b.ReaderWidget.setPageTurnersDisplay(!1);b.ErrorMessageWidget.hide();b.MessageWidget.close();b.BookmarksWidget.slideDown();c("#sitbReaderHelpMenu").hide();b.BuyActions.slideDown(1);b.BuyActions.slideDown(2);c("#sitbReaderMessageContainer").hide();c("#sitbReaderPlaceholder").hide();c("#vellumMsg").hide();b.SearchActions.closeCurrentSearch();
b.SearchWidget.slideDown();b.LightboxWidget.documentIsReady=!0;b.LightboxWidget.toggleSelextBoxes(!0);b.LightboxWidget.removeOverlay();c("body").css("overflow","auto");if(c.browser.safari){var a=c(window).scrollTop();c(window).scrollTop(a+1);c(window).scrollTop(a)}b.metrics.end();b.LightboxActions.openMutex=0;b.LightboxActions.lightboxOpened=!1;b.HistoryActions.userInitiatedClose=!1},unload:function(){b.metrics.count("unanounced");b.metrics.end()},back:function(a,e){if(e)b.HistoryActions.userInitiatedClose=
!0;b.RefTag.post(b.RefTag.Actions.exit,a);p.history&&b.HistoryActions.useBack&&!c.browser.safari&&p.history.back();b.LightboxActions.close();q&&setTimeout(function(){b.LightboxActions.close()},100)},setInitialLightboxState:function(a){if(/^[0|1]{4}[0-9]$/.test(a)){b.LightboxWidget.isFullscreen=a.charAt(0)=="1";b.LeftPaneWidget.isOpened=a.charAt(1)=="1";b.SBWidget.isOpened=a.charAt(2)=="1";var c=b.ZoomModel;c.userDefinedZoomLevel=a.charAt(3)=="1";a=parseInt(a.charAt(4));if(a!=0&&c.userDefinedZoomLevel&&
c.isValidZoomLevel(a))c.zoomLevel=a}},getLightboxStateAttribute:function(){return(b.LightboxWidget.isFullscreen?"1":"0")+(b.LeftPaneWidget.isOpened?"1":"0")+(b.SBWidget.isOpened?"1":"0")+(b.ZoomModel.userDefinedZoomLevel?"1":"0")+b.ZoomModel.zoomLevel},_registerResizeHandler:function(){F&&c(window).bind("orientationchange",function(){da=c(document).width()-74;b.LightboxActions.handleResize()});c(window).unbind("resize.sitbreader").bind("resize.sitbreader",function(){b.LightboxActions.resizeTimeout&&
clearTimeout(b.LightboxActions.resizeTimeout);b.LightboxActions.resizeTimeout=setTimeout(function(){b.LightboxActions._realHandleResize()},250)})},_realHandleResize:function(){this.resizeTimeout=null;this.handleResize()}};b.BuyActions={goToDetailPageFromTitle:function(){b.LightboxActions.back(b.RefTag.ExitMethod.title,!0)},goToDetailPageFromThumbnail:function(){b.LightboxActions.back(b.RefTag.ExitMethod.thumbnail,!0)},oneClickOrder:function(){},toggleBuyboxPane:function(a){this.isBuyBoxWidgetHidden(a)?
(this.slideDown(a),b.RefTag.post(b.RefTag.Actions.panel,b.RefTag.PanelAction.openSections)):(this.slideUp(a),b.RefTag.post(b.RefTag.Actions.panel,b.RefTag.PanelAction.closeSections))},getBuyBoxWidgetId:function(a){return"#sitbReaderPriceBlockContent"+a},isBuyBoxWidgetHidden:function(a){return c(this.getBuyBoxWidgetId(a)).is(":hidden")},getPaneTitleWidget:function(a){return a==1?b.BuyWidget.paneTitleWidget1:b.BuyWidget.paneTitleWidget2},slideUp:function(a){this.isBuyBoxWidgetHidden(a)||(c(this.getBuyBoxWidgetId(a)).slideUp("slow",
function(){b.SearchWidget.setResultsHeight()}),this.getPaneTitleWidget(a).slideUp())},slideDown:function(a){if(this.isBuyBoxWidgetHidden(a)){var e=b.SearchWidget.calculateSearchResultSpace();c("#sitbReaderSearch-all-results").height(e);b.SearchWidget.resultsHeight=e;b.SearchWidget.setResultsHeight(300);c(this.getBuyBoxWidgetId(a)).slideDown("slow",function(){b.SearchWidget.setResultsHeight()});this.getPaneTitleWidget(a).slideDown()}}};b.BookmarksActions={goToBookmark:function(a){if(b.currentBook.isHTML())switch(a){case "cvr":b.KindleContentActions.goToCover();
break;case "srl":b.KindleContentActions.goToSRL();break;default:b.KindleContentActions.goToLocation(a,"name")}else{var c=b.currentBook.bookmarks.getFirstAndLastPageNumberByName(a).first;b.PageSequenceActions.goTo(c);b.RefTag.post(b.RefTag.Actions.section,b.RefTag.tokenizeLandingPage(a));b.metrics.count("bookmark")}},update:function(){var a=b.currentBook.bookmarks.getIndex(b.pageSequence.currentPage);b.BookmarksWidget.unselect();a!=null&&b.BookmarksWidget.select(a)},toggleBookmarksPane:function(){c("#sitbReaderBookmarks-pages").is(":hidden")?
(b.BookmarksWidget.slideDown(),b.RefTag.post(b.RefTag.Actions.panel,b.RefTag.PanelAction.openSections)):(b.BookmarksWidget.slideUp(),b.RefTag.post(b.RefTag.Actions.panel,b.RefTag.PanelAction.closeSections))}};b.SearchActions={search:function(a,c){if(b.currentBook.searchable&&!l(a)){b.metrics.startTimer("search");b.currentSearch=new b.Search(a);b.currentSearch.fetchNumber=20;b.SearchWidget.showLoading(!0);b.SearchActions.searchCall(b.SearchActions.loadFirstQueryResults);if(c==void 0)c=b.RefTag.Actions.searchExecuted;
b.RefTag.post(c)}},goToSearchResult:function(a){b.PageSequenceActions.goTo(b.currentSearch.resultPageNumbers[a])},canFetchMoreResults:function(){return b.currentBook.searchable&&b.currentSearch.numDisplayedResults!=b.currentSearch.numResults},fetchMoreResults:function(){if(this.canFetchMoreResults())b.metrics.startTimer("moreSearch"),b.SearchWidget.showLoading(!1),b.currentSearch.fetchNumber=20,b.SearchActions.searchCall(b.SearchActions.loadMoreQueryResults,b.RefTag.Actions.moreSearchResults)},toggleSearchPane:function(){c("#sitbReaderSearch-contents").is(":hidden")?
(b.SearchWidget.slideDown(),b.RefTag.post(b.RefTag.Actions.panel,b.RefTag.PanelAction.openSearch)):(b.SearchWidget.slideUp(),b.RefTag.post(b.RefTag.Actions.panel,b.RefTag.PanelAction.closeSearch))},closeCurrentSearch:function(){b.currentSearch=new b.Search;b.SearchWidget.clearResults();b.SearchWidget.showSampleSearches();b.PageSequenceWidget.redraw()},loadFirstQueryResults:function(a){if(a&&a!={}){if(b.currentSearch.update(a),b.SearchActions.loadSearchResults(a),b.currentSearch.totalResultsPages=
Math.ceil(b.currentSearch.numResults/20),b.currentSearch.currentResultsPage=1,b.PageSequenceWidget.redraw(),b.BookmarksWidget.slideUp(),b.SearchWidget.hideSampleSearches(),b.SearchWidget.showResults(!0),b.SearchWidget.addMoreResultsLink(),b.SearchWidget.hookTooltips(),b.currentSearch.numResults==0){b.SearchWidget.showSampleSearches();return}}else b.SearchWidget.hideLoading();a=b.currentSearch.getFirstAvailablePageNumber();a!=null&&b.PageSequenceActions.goTo(a);b.metrics.endTimer("search")},loadSearchResults:function(a){var c=
b.PageSequenceActions,d;for(d in a.results)c.installToken(a.results[d][0],a.results[d][3]);c.setPageUrls(a)},loadMoreQueryResults:function(a){a.results&&a.results.length>0&&(b.currentSearch.currentResultsPage++,b.currentSearch.update(a),b.SearchActions.loadSearchResults(a),b.SearchWidget.showResults(!1),b.SearchWidget.addMoreResultsLink(),b.SearchWidget.hookTooltips());b.metrics.endTimer("moreSearch")},searchCall:function(a,c){v({method:"getSearchResults",asin:b.currentBook.asin,buyingAsin:b.currentBook.buyingAsin,
query:encodeURIComponent(b.currentSearch.currentQuery),pageSize:b.currentSearch.fetchNumber,pageNumber:b.currentSearch.currentResultsPage+1},a,b.SearchActions.searchErrorCallback,c)},searchErrorCallback:function(a,c){b.metrics.count("ajaxerrors","searchajaxerrors");c=="timeout"&&b.metrics.count("ajaxtimeouts","searchajaxtimeouts");b.SearchWidget.hideLoading();b.ReaderActions.showAjaxErrorMessage();b.RefTag.post(b.RefTag.Actions.timeout,b.RefTag.Timeout.search)}};b.ReaderActions={oldMouseX:-1,oldMouseY:-1,
currentScrollX:-1,currentScrollY:-1,nextPageUrl:"",LIGHTBOX_CLEAR_SPACE:30,isPanningSet:!1,setPageTurners:function(){b.ReaderWidget.setPageTurnersDisplay(!0);b.ReaderWidget.updatePageTurnersState()},goToNextPage:function(){b.PageSequenceActions.next();b.RefTag.post(b.RefTag.Actions.next,b.RefTag.tokenizeLandingPage(b.pageSequence.getCurrentBookmarkName()));b.metrics.count("next")},goToPrevPage:function(){b.PageSequenceActions.prev();b.RefTag.post(b.RefTag.Actions.previous,b.RefTag.tokenizeLandingPage(b.pageSequence.getCurrentBookmarkName()));
b.metrics.count("prev")},updatePageImageOnResize:function(){b.ZoomModel.isFitPageZoomLevel()&&this.showPageImage(b.currentBook.pages[b.pageSequence.currentPage])},enablePanningControl:function(){if(!b.ReaderActions.isPanningSet)c("#sitbReaderPageScroll").unbind("mousedown").mouseover(function(){c("#sitbReaderPageScroll").css("cursor","url("+ra+"), default")}).mouseout(function(){c("#sitbReaderPageScroll").css("cursor","default").unbind("mousemove")}).mousedown(function(a){c(document).css("cursor",
"url("+ca+"), default");c("#sitbReaderPageScroll").css("cursor","url("+ca+"), default");z(a);var e=b.ReaderActions;e.oldMouseX=a.pageX;e.oldMouseY=a.pageY;e.currentScrollX=c("#sitbReaderPageContainer").scrollLeft();e.currentScrollY=c("#sitbReaderPageContainer").scrollTop();c("#sitbReaderPageScroll").css("cursor","url("+ca+"), default");c(this).mousemove(function(a){b.metrics.startTimer("panning");z(a);var e=b.ReaderActions,g=e.currentScrollX-(a.pageX-e.oldMouseX),a=e.currentScrollY-(a.pageY-e.oldMouseY);
c("#sitbReaderPageContainer").scrollLeft(Math.max(0,g));c("#sitbReaderPageContainer").scrollTop(Math.max(0,a));b.metrics.endTimer("panning");c(document).css("cursor","default");return!1}).mouseup(function(){c("#sitbReaderPageScroll").unbind("mousemove").css("cursor","url("+ra+"), default")})}),b.ReaderActions.isPanningSet=!0},disablePanningControl:function(){if(b.ReaderActions.isPanningSet)c("body").css("cursor","default"),c("#sitbReaderPageScroll").unbind(),b.ReaderActions.isPanningSet=!1},setPanning:function(){var a=
c("#sitbReaderPageScroll").width(),b=c("#sitbReaderPageContainer").width(),d=c("#sitbReaderPageScroll").height(),f=c("#sitbReaderPageContainer").height();a>b-u||d>f?this.enablePanningControl():(this.disablePanningControl(),c("#sitbReaderPageScroll").unbind("mousedown"),c("#sitbReaderPageScroll").mousedown(function(a){z(a)}))},checkAndHandleError:function(a){if(a=={}||a.error){if(!a.error)a.error={};b.ErrorMessageWidget.show(H(a.error.title),H(a.error.text));b.RefTag.httpGet(a.error.reftag);return!0}else return!1},
checkForError:function(a){if(a=={}||a.error){if(!a.error)a.error={};b.RefTag.httpGet(a.error.reftag);return!0}else return!1},showAjaxErrorMessage:function(a,c){a||(a=sa);c||(c=ta);b.ErrorMessageWidget.show(a,c);b.SearchWidget.hideLoading()}};b.ReaderKeyboardActions={SINGLE_ACTIONS:[35,61,107,187,109,129,189,48,96,36],REPEATED_ACTIONS:[32,37,39,38,40,33,34],SCROLL_LINE_HEIGHT:function(){return b.currentBook.isImage()?20:b.ZoomModel.getLineHeight()/2},TIMER_TICK:80,_activeTimers:[],isKeyHandler:!0,
_handleKeyPress:function(a){var e=b.ReaderKeyboardActions,d=a.which==0?a.keyCode:a.which;c.inArray(d,ea)>=0&&e.isKeyHandler&&(z(a),c.inArray(d,e.REPEATED_ACTIONS)>=0&&va&&(b.metrics.count("keystroke"),e._getRepeatedAction(d).call()))},_handleKeyDown:function(a){var e=b.ReaderKeyboardActions,d=a.which==0?a.keyCode:a.which;c.inArray(d,ea)>=0&&e.isKeyHandler&&(z(a),c.inArray(d,e.REPEATED_ACTIONS)>=0&&q&&!e._activeTimers["timer_"+d]&&(e._activeTimers["timer_"+d]=setInterval(e._getRepeatedAction(d),e.TIMER_TICK)))},
_handleKeyUp:function(a){var e=b.ReaderKeyboardActions,d=a.which==0?a.keyCode:a.which;c.inArray(d,ea)>=0&&e.isKeyHandler&&(z(a),c.inArray(d,e.REPEATED_ACTIONS)>=0&&!va&&!q&&e._getRepeatedAction(d).call(),c.inArray(d,e.REPEATED_ACTIONS)>=0&&q?(clearInterval(e._activeTimers["timer_"+d]),delete e._activeTimers["timer_"+d]):c.inArray(d,e.SINGLE_ACTIONS)>=0&&e._handleSingleAction(d,a.ctrlKey))},_handleSingleAction:function(a,e){switch(a){case 36:b.currentBook.isImage()?b.PageSequenceActions.goTo(1):b.KindleContentActions.goToSRL();
break;case 35:c("#sitbReaderPageContainer").scrollTop(b.pageSequence.scrollHeight);break;case 61:case 107:case 187:e&&b.ZoomActions.zoomIn();break;case 109:case 129:case 189:e&&!q&&b.ZoomActions.zoomOut();break;case 48:case 96:e&&!q&&(b.ZoomActions.setZoom(b.ZoomModel.defaultZoomLevel),b.ZoomWidget.setZoomControls())}},_getRepeatedAction:function(a){var c=void 0;switch(a){case 32:c=function(){b.PageSequenceActions.next()};break;case 39:c=b.ReaderWidget.getRightTurnerAction();break;case 37:c=b.ReaderWidget.getLeftTurnerAction();
break;case 38:c=function(){b.ReaderKeyboardActions._scrollByArrow(-1)};break;case 40:c=function(){b.ReaderKeyboardActions._scrollByArrow(1)};break;case 33:c=function(){b.PageSequenceActions.prev()};break;case 34:c=function(){b.PageSequenceActions.next()}}return c},_scrollByArrow:function(a){var e=c("#sitbReaderPageContainer"),d=e.scrollTop(),f=b.ReaderKeyboardActions.SCROLL_LINE_HEIGHT(),g=b.pageSequence.scrollHeight;a<0&&(d==0||d-f<0)?e.scrollTop(0):a>0&&(d==g||d+f>g)?e.scrollTop(g):e.scrollTop(d+
f*a)},load:function(){F||(c(document).unbind("keydown").keydown(this._handleKeyDown),c(document).unbind("keyup").keyup(this._handleKeyUp),c(document).unbind("keypress").keypress(this._handleKeyPress))},tearDown:function(){c(document).unbind("keydown");c(document).unbind("keyup");c(document).unbind("keypress")}};b.ZoomActions={getPageImageForZoomLevel:function(a){var e=b.ZoomModel,e=e.isLargeImageZoomLevel(e.zoomLevel)?a.largeImage:a.jumboImage,e=c(e);e.css({width:a.getScaledDimensions().width,height:a.getScaledDimensions().height});
return e},updateFitToScreenZoomLevel:function(a){this.updateFitToScreenByDimension(a.getScaledDimensions())},updateFitToScreenByDimension:function(a){var e=b.ZoomModel,d=b.ReaderWidget.getImageHeight();if(d<a.height)var f=d/a.height,f=Math.min(d/a.height,1),a=a.width*f;else a=a.width;d=c("#sitbReaderPageContainer").width()-u;d=Math.min(d,e.MAX_PAGE_WIDTH_FOR_PAGE_FIT);a=Math.min(a,d);e.setFitPageZoomLevel(a);e.updateMinZoomLevel()},isFitToHeightPage:function(a){a=b.currentBook.bookmarks.getIndex(a);
return a!=null?(a=b.currentBook.bookmarks.getName(a),a.indexOf(h("BACK_COVER"))>-1||a.indexOf(h("FRONT_COVER"))>-1||a.indexOf(h("BACK_FLAP"))>-1||a.indexOf(h("FRONT_FLAP"))>-1):!1},zoomIn:function(){var a=b.ZoomModel.zoomLevel+1,c=b.ZoomModel.zoomLevel;b.ZoomActions._doSetZoom(a);b.ZoomWidget.setZoomControls();b.ZoomModel.zoomLevel!=c&&b.RefTag.post(b.RefTag.Actions.zoomIn,a);b.ReaderWidget.setWidth()},zoomOut:function(){var a=b.ZoomModel.zoomLevel-1,c=b.ZoomModel.zoomLevel;b.ZoomActions._doSetZoom(a);
b.ZoomWidget.setZoomControls();b.ZoomModel.zoomLevel!=c&&b.RefTag.post(b.RefTag.Actions.zoomOut,a);b.MessageWidget.resize();b.ReaderWidget.setWidth()},setZoom:function(a){b.ZoomActions._doSetZoom(a);b.RefTag.post(b.RefTag.Actions.zoom,a)},_doSetZoom:function(a){var c=b.ZoomModel;if(c.isValidZoomLevel(a))c.userDefinedZoomLevel=!0,c.updatePreviousZoomLevel(),c.zoomLevel=a,b.currentBook.isImage()?b.PageSequenceActions.zoom(a):b.KindleContentActions.zoom();b.ReaderWidget.updateVerticalScroller()}};b.MessageActions=
{sendReftag:function(a,c){a&&!b.MessageWidget.reftagsFired[c]&&(b.RefTag.post(b.RefTag.Actions.message,c),b.MessageWidget.reftagsFired[c]=!0)},getMobi8FixedFormatMessage:function(){b.Message.mobi8FixedFormatMessage=b.currentBook.isMobi8FixedFormat()&&j.hasZoomables&&c("#readerModeTabKindle").hasClass("activeReaderModeTab")&&!b.Message.messagesDismissed?kb:null},getRelatedEditionMessage:function(){var a=b.currentBook,c=a.getRelatedAsin();c&&v({method:"getRelatedEdition",asin:a.originalAsin?a.buyingAsin:
c,buyingAsin:a.originalAsin?c:a.buyingAsin},b.MessageActions.getRelEdMsgCallBack,function(c,e){M(e,b.RefTag.Timeout.relatedEdition);if(a.originalAsin)if(a.originalAsin&&a.isPrint())b.Message.relatedEditionMessage=Ga;else{if(a.originalAsin&&a.isKindle())b.Message.relatedEditionMessage=Ha}else b.Message.relatedEditionMessage=Fa;b.MessageWidget.calledShow&&b.MessageWidget.show()})},getRelEdMsgCallBack:function(a){var c=a.relatedEditionMessage;if(c.args){var a={},d=b.currentBook;a.RELATED_YEAR_DISP=l(c.args.RELATED_YEAR)?
"":" ("+c.args.RELATED_YEAR+")";a.RELATED_LINK_TEXT=l(c.args.RELATED_NAME)?h("RELATED_EDITION"):h("EDITION_NAME",{NAME:c.args.RELATED_NAME.replace(RegExp("("+h("EDITION")+")","gi"),"").replace(/^\s+|\s+$/g,"")});a.RELATED_PUB_DISP=l(c.args.RELATED_PUB)?"":h("PUB_NAME",{NAME:c.args.RELATED_PUB});a.AUTHORITY_YEAR_DISP=l(c.args.AUTHORITY_YEAR)?"":" ("+c.args.AUTHORITY_YEAR+")";a.AUTHORITY_LINK_TEXT=l(c.args.AUTHORITY_NAME)?h("AUTHORITY_EDITION"):h("EDITION_NAME",{NAME:c.args.AUTHORITY_NAME.replace(RegExp("("+
h("EDITION")+")","i"),"").replace(/^\s+|\s+$/g,"")});a.AUTHORITY_PUB_DISP=l(c.args.AUTHORITY_PUB)?"":h("PUB_NAME",{NAME:c.args.AUTHORITY_PUB});a.AUTHORITY_LINK=c.args.AUTHORITY_LINK.replace("#{AUTHORITY_LINK_TEXT}",a.AUTHORITY_LINK_TEXT);a.RELATED_LINK=c.args.RELATED_LINK.replace("#{RELATED_LINK_TEXT}",a.RELATED_LINK_TEXT);d.buyButtonText&&(a.BUY_BUTTON_TEXT='"'+d.buyButtonText+'"');c="";d.originalAsin?d.isPrint()?c="REL_ED_XREF_MSG_PRINT":(c="REL_ED_XREF_MSG_KINDLE_V2",d.hasValidOffer()||(a.AUTHORITY_LINK=
a.AUTHORITY_LINK_TEXT)):d.isPrint()?c="REL_ED_MSG_PRINT":(d.samplePrice||d.samplePrice===0||(a.AUTHORITY_LINK=a.AUTHORITY_LINK_TEXT),c=d.hasValidOffer()?d.buyButtonText?"REL_ED_MSG_KINDLE_WITH_BUTTON_TEXT":"REL_ED_MSG_KINDLE":"REL_ED_MSG_KINDLE_WITHOUT_VALID_OFFER");b.Message.relatedEditionMessage=h(c,a);b.MessageWidget.calledShow&&b.MessageWidget.show()}}};b.MessageBoxActions={toggleMessageBox:function(a,c){if(b.MessageBoxWidget.messageBoxDisplayed.messageBoxType!=a){b.MessageBoxWidget.close();var d=
new b.MessageBox(a,c);b.MessageBoxWidget.show(d,c)}else b.MessageBoxWidget.close()}};b.SBActions={isLoading:!1,loadSBDataCall:function(a,c){if(!b.SBActions.isLoading)b.SBActions.isLoading=!0,b.SerendipityBar.historyBooks.length||v({method:"getSBData",asin:b.currentBook.buyingAsin,type:b.currentBook.type},a,b.SBActions.errorCallback,c)},errorCallback:function(a,e){M(e,b.RefTag.Timeout.serendipityBar);b.SBWidget.hideLoading();b.SBWidget.historyLoadFailure();b.SBWidget.noSims();c("#sitbReaderSB #historyholder").height(8);
b.metrics.endTimer("SBshow")},toggleHistoryPane:function(){b.metrics.startTimer("SBtogglehistory");c("#sitbReaderSB-history-content").is(":hidden")?b.SBWidget.historySlideDown():b.SBWidget.historySlideUp();b.metrics.endTimer("SBtogglehistory")},toggleRecsPane:function(){b.metrics.startTimer("SBtogglesims");c("#sitbReaderSB-recs-content").is(":hidden")?b.SBWidget.recsSlideDown():b.SBWidget.recsSlideUp();b.metrics.endTimer("SBtogglesims")}};b.PageSequenceActions={reset:function(){var a=b.pageSequence;
if(typeof a!="undefined")a.emptyScroll(),a.scrollHeight=0,a.visibleElementIndices=[]},setPageUrls:function(a){var c=b.currentBook.pages;if(a.largeImageUrls&&a.jumboImageUrls)for(var d in a.largeImageUrls)d>0&&d<=c.length-1&&(c[d].addUrls(a.largeImageUrls[d],a.jumboImageUrls[d]),c[d].setState(1)&&b.availability.handleNumRemPages(d))},next:function(){if(b.currentBook.isImage())this.goTo(b.availability.getNextAvailablePageNumber(b.pageSequence.currentPage,1),1);else if(b.kindleRenderer.isMobi8FixedFormat&&
b.kindleRenderer.isMobi8FixedFormat()&&b.kindleRenderer.hasNextPage())b.kindleRenderer.gotoNextPage();else{var a=c("#sitbReaderPageContainer"),e=b.ZoomModel.getLineHeight(),e=Math.min(parseInt(a.scrollTop()+a.height()-e),b.pageSequence.scrollHeight);a.scrollTop(e)}},prev:function(){if(b.currentBook.isImage()){var a=b.availability.getNextAvailablePageNumber(b.pageSequence.currentPage,-1);a!=b.currentBook.numPages&&this.goTo(a,-1)}else if(b.kindleRenderer.isMobi8FixedFormat&&b.kindleRenderer.isMobi8FixedFormat()&&
b.kindleRenderer.hasPrevPage())b.kindleRenderer.gotoPrevPage();else{var a=c("#sitbReaderPageContainer"),e=b.ZoomModel.getLineHeight(),e=Math.max(a.scrollTop()-a.height()+e,0);a.scrollTop(e)}},goTo:function(a,c){var d=b.PageSequenceWidget;d.goToStartTime=d.goToStartTime==-1?0:(new Date).getTime();d.immediateScroll=!0;d.scrollToPageTop(a,c)},zoom:function(){var a=b.pageSequence.currentPage;b.PageSequenceWidget.redraw();this.goTo(a)},loadPageUrls:function(a,c){b.availability.canRequestImages(a.pageNumber)&&
v({method:"goToPage",asin:b.currentBook.asin,buyingAsin:b.currentBook.buyingAsin,page:a.pageNumber,token:a.token},function(d){if(b.currentBook.isImage())d.error?(b.availability.handlePageLoadError(a),c.call()):(b.PageSequenceActions.urlCallback(d,c),b.availability.pageErrorCount=0),b.availability.updatePageStates()},function(c,e){ia(e,b.RefTag.Timeout.pageUrls);b.availability.handlePageLoadError(a)})},urlCallback:function(a,b){this.setPageUrls(a);b.call()},addTOCLinks:function(a){for(var b in a)this.installToken(a[b].dest,
a[b].token)},installToken:function(a,c){if(b.availability.level<1||b.availability.numRemPages<=0)return!1;for(var d=b.currentBook.pages,f=!1,a=parseInt(a),g=Math.max(a-2,1);g<=Math.min(a+2,b.currentBook.numPages);g++)d[g].token=c,d[g].state!=1&&(f|=d[g].setState(0));return f},getRandomAvailablePageNumber:function(){for(var a=b.currentBook.pages,c=1,d=0,f=1;f<=b.currentBook.numPages;f++)a[f].isC()&&(d++,Math.random()<1/d&&(c=f));return c},goToRandomPage:function(a){!b.currentBook.searchable||a||b.availability.level!=
2||b.availability.numRemPages<=0?(this.goTo(this.getRandomAvailablePageNumber()),!b.currentBook.hasFullAccess&&b.availability.level==0&&b.MessageWidget.displayRandomPageLoginMessage(),b.RefTag.post(b.RefTag.Actions.samplePage,b.RefTag.LandingPage.excerpt)):v({method:"getRandomPage",asin:b.currentBook.asin,buyingAsin:b.currentBook.buyingAsin},this.goToRandomPageCallBack,function(){b.PageSequenceActions.goToRandomPage(!0)})},goToRandomPageCallBack:function(a){a.error?b.PageSequenceActions.goToRandomPage(!0):
(b.PageSequenceActions.setPageUrls(a),b.PageSequenceActions.installToken(a.pageNumber,a.token),b.PageSequenceActions.goTo(a.pageNumber))}};b.ClickableTOCActions={loadTOCallMade:{},loadTOCDataCall:function(a,c,d){this.loadTOCallMade[a]||(this.loadTOCallMade[a]=!0,v({method:"getTOCLinks",asin:b.currentBook.asin,page:a},c,b.ClickableTOCActions.errorCallback,d))},errorCallback:function(a,c){b.metrics&&M(c,b.RefTag.Timeout.toc)},preCachePage:function(a){b.ClickableTOCActions.loadTOCDataCall(a,b.ClickableTOCActions.storePageFromData)},
storePageFromData:function(a){a!=null&&b.ClickableTOC.addPage(a.page,a.links)},storeAndShow:function(a){a!=null&&(b.ClickableTOC.addPage(a.page,a.links),b.ReaderWidget.renderPageOverlay(a.page))},goToPage:function(a){b.ClickableTOC.visitedPages[a]=!0;b.PageSequenceActions.goTo(a);b.RefTag.post(b.RefTag.Actions.clickToc)}};b.Availability=function(a){this.level=a.level;this.knownCustomer=a.isCustomer;this.numRemPages=a.numRemPages?a.numRemPages:0;this.pageErrorCount=0;this.isFPS=a.isFPS=="1";this.maxConsecPages=
5;this.PAGE_ERROR_COUNT_THRESHOLD=3;this.skipPagesProbabilities={1:60,2:20,3:20};this.consecPagesProbabilities={4:20,5:80};this.minimumTextLitbPages=6;this.irreversibleXPages=[]};b.Availability.prototype.getNextAvailablePageNumber=function(a,c,d){typeof d=="undefined"&&(d=!1);var f=b.currentBook.pages,g=a;do if(c>0?g++:g--,g>b.currentBook.numPages&&(g=1),g<=0)g=b.currentBook.numPages;while((d?!f[g].isC():f[g].isX()||f[g].isY())&&g!=a);return g};b.Availability.prototype.updatePageStates=function(){if(!(this.level<
2||this.isT2NonFPS())){var a=b.currentBook,c=b.pageSequence.currentPage;if(a.inTextPages(c)&&!a.bookmarks.isInABookmark(c)){for(var d=c;d>a.st&&a.pages[d].isC();)d--;for(d-1>=1&&d-1>=a.st&&d--;c<=a.getLastTextPage()&&a.pages[c].isC();)c++;c+1<=a.getLastTextPage()&&c++;c=Math.min(c,a.pages.length-1);return c-d<=this.maxConsecPages?void 0:this.updatePageStatesHelper(d,c,1)|this.updatePageStatesHelper(c,d,-1)}}};b.Availability.prototype.updatePageStatesHelper=function(a,c,d){if(!(a>c&&d>0||a<c&&d<0||
d==0)){for(var f=b.currentBook,g=0,h=!1;a<=c&&d>0||a>c&&d<0;a+=d)!f.pages[a].isC()||f.bookmarks.isInABookmark(a)?g=0:(g++,g>=this.maxConsecPages&&(f.pages[a+d]&&!f.pages[a+d].isX()&&(f.pages[a+d].setState(-1),h=!0),g=0));return h}};b.Availability.prototype.handlePageLoadError=function(a){this.pageErrorCount++;a.setState(-1);if(this.pageErrorCount>=this.PAGE_ERROR_COUNT_THRESHOLD)b.metrics.count("page_error_threshold"),this.collapseNonCPages(a.pageNumber),this.pageErrorCount=0};b.Availability.prototype.collapseNonCPages=
function(a){for(var c=b.currentBook,d=c.pages,f=a;f>=1&&!d[f].isC();)d[f--].setState(-1);for(f=a;f>=1&&f<=c.numPages&&!d[f].isC();)d[f++].setState(-1);return f};b.Availability.prototype.collapseAllNonCPages=function(){for(var a=b.currentBook.pages,c=!1,d=1;d<a.length;d++)a[d].isC()||(c|=a[d].setState(-1));return c};b.Availability.prototype.isT2NonFPS=function(){return this.level==2&&!this.isFPS};b.Availability.prototype.handleNumRemPages=function(a){var a=parseInt(a),e=b.currentBook;this.numRemPages<=
0||this.level<1||!e.inTextPages(a)||c.inArray(a,e.litbPages)>=0||(this.numRemPages--,this.numRemPages<=0&&this.collapseAllNonCPages())};b.Availability.prototype.canRequestImages=function(a){var c=b.currentBook.pages[a];return c.isC()&&(l(c.largeUrl)||l(c.jumboUrl))||c.isQ()&&(this.isFPS||!b.currentBook.inTextPages(a)||!l(c.token))};b.Availability.prototype.getSkipPagesNumber=function(){return na(this.skipPagesProbabilities)};b.Availability.prototype.getConsecPagesNumber=function(){return na(this.consecPagesProbabilities)};
b.ModeSwitchActions={pathCache:[],_storePath:function(a,b){this.pathCache[a]=b},switchMode:function(a,e){var d=b.currentBook,f=b.pageSequence;e!=d.type&&(e==1?b.metrics.startTimer("ModeSwitchToPrint"):b.metrics.startTimer("ModeSwitchToKindle"),b.ReaderWidget.setPageTurnersDisplay(!1),b.MessageWidget.close(),b.LightboxWidget.showLoadingLightboxMessage(),b.BookmarksWidget.slideDown(),d.type==1?f.putReadingLocation(d.buyingAsin,f.currentPage):f.putReadingLocation(d.buyingAsin,c("#sitbReaderPageContainer").scrollTop()),
this._storePath(a,d.buyingAsin),Vellum.p(a,f.getReadingLocation(a,e)),e==1?b.metrics.endTimer("ModeSwitchToPrint"):b.metrics.endTimer("ModeSwitchToKindle"),b.RefTag.post(b.RefTag.Actions.mode,e==1?"print":"kindle"))},getPath:function(a){return this.pathCache[a]},hasPath:function(a){return!l(this.pathCache[a])}};b.BottomButtonActions={moveNextPage:function(){b.RefTag.post(b.RefTag.Actions.bottomButton);b.metrics.count("bottom_button");b.ReaderActions.goToNextPage()}};b.KindleContentActions={_contentCache:{},
_contentWidget:void 0,_contentHolder:void 0,_fetchKindleContent:function(a){if(this._contentCache[a]){var e=b.KindleContentActions;e._contentWidget.updateContent(this._contentCache[a].sample);e._contentHolder=e._contentWidget.jQContentHolder;e.zoom()}else{b.metrics.startTimer("load_html_sample");a={method:b.currentBook.sampleFormat==W?"getMobi7Sample":b.currentBook.sampleFormat==X?"getMobi8Sample":b.currentBook.isMobi8FixedFormat()?"getMobi8FixedFormatSample":"getMobi7Sample",asin:b.currentBook.asin};
if(window.sitbMainRequestId)a.requestId=window.sitbMainRequestId;c.ajax({url:ga,async:!0,type:"POST",data:a,cache:!1,dataType:"json",timeout:6E4,error:b.KindleContentActions._fetchErrorCallback,success:b.KindleContentActions._fetchCallback})}},_fetchCallback:function(a){a.error?(b.metrics.count("rc_failed"),b.ErrorMessageWidget.show(H(a.error.title),H(a.error.text)),a.sample="",a.stylesheet=""):a.sample?a.stylesheet?a.sample.length<100&&(b.RefTag.post(b.RefTag.Actions.error,b.RefTag.Error.empty_sample),
b.metrics.count("empty_sample")):(a.stylesheet="",b.metrics.count("stylesheet_undefined")):(a.sample="",b.metrics.count("sample_undefined"));var c=new Da;b.kindleRenderer=c.createKindleRenderer(a);c=b.kindleRenderer.getHtmlFragment(a.sample,a.stylesheet);b.LightboxActions.requestId=a.requestId;var d=b.KindleContentActions;d._cache(c,a.srl);d._contentWidget.updateContent(c);d._contentHolder=d._contentWidget.jQContentHolder},_fetchErrorCallback:function(a,e){M(e,b.RefTag.Timeout.kindleSample);c("#vellumMsgTxt").html(h("INFORMATION_UNAVAILABLE"));
c("#vellumMsgHdr").html(h("SERVER_TIMEOUT"));N(c("#vellumMsg")).show()},_cache:function(a,c){this._contentCache[b.currentBook.asin]={sample:a,toc:void 0,srl:c}},_registerSampleTOC:function(){b.kindleRenderer.updateTOCLink()},initialize:function(a){this._contentWidget=a;this._fetchKindleContent(b.currentBook.asin)},registerEvents:function(){this._registerSampleTOC()},handleResize:function(){this._contentWidget.resize(!1)},goToLocation:function(a,e,d){d=void 0==d||null==d?!0:d;e=b.kindleRenderer.getLocation(a,
e);if(e.length!=0)return a=c("#sitbReaderPageContainer"),a.scrollTop(c(e[0]).position().top),!0;else if(e.length==0&&(a=="sitb-srl"||a=="sitb-cover")&&d)a=c("#sitbReaderPageContainer"),a.scrollTop(0);return!1},goToSRL:function(){(!this._contentCache[b.currentBook.asin].srl||!this.goToLocation(this._contentCache[b.currentBook.asin].srl,"name",!1))&&this.goToLocation("sitb-srl","class",!0)},goToCover:function(){this.goToLocation("sitb-cover","class")},goToLRL:function(){var a=b.pageSequence.getReadingLocation(b.currentBook.buyingAsin,
2);a=="srl"?this.goToSRL():c("#sitbReaderPageContainer").scrollTop(parseInt(a));b.LightboxActions.readerReady=!0},zoom:function(){this._contentWidget.resize(!0)},endOfSampleBuyLink:function(){var a=c("#sitbReaderCart-form");a.attr("action",b.currentBook.kindleBuyItURL.replace("/ref=","")+"/ref="+b.RefTag.getFormatedRefTag(b.RefTag.Actions.exit,b.RefTag.ExitMethod.endOfSampleBuyLink));a.submit()},endOfSampleBuy1ClickLink:function(){var a=c("#sitbReaderCartBuy1Click-form");a.attr("action",b.currentBook.kindleAdditionalBuyWith1ClickURL.replace("/ref=",
"")+"/ref="+b.RefTag.getFormatedRefTag(b.RefTag.Actions.exit,b.RefTag.ExitMethod.endOfSampleBuy1ClickLink));a.submit()}};b.CustomerRequestActions={sendRequest:function(){this._sendRequestLoadingIcon();var a="/gp/digital/fiona/detail/request-kindle-edition/ref="+b.RefTag.getFormatedRefTag(b.RefTag.Actions.sendCustomerRequest)+"?a="+b.currentBook.asin;c.ajax({url:a,async:!0,type:"POST",data:null,cache:!1,timeout:ha,error:b.CustomerRequestActions._sendRequestErrorCallback,success:b.CustomerRequestActions._sendRequestCallback})},
_sendRequestErrorCallback:function(){c("#sitbReaderCustomerRequestContent").html(h("SEND_CUSTOMER_REQUEST_ERROR"))},_sendRequestCallback:function(){c("#sitbReaderCustomerRequestContent").html(h("SEND_CUSTOMER_REQUEST_SUCCESS",{ASIN:b.currentBook.asin,TITLE:b.currentBook.title}))},_sendRequestLoadingIcon:function(){c("#sitbReaderCustomerRequestContent").html('<div id="sitbReaderCustomerRequest-loading"></div>')}};b.LightboxWidget={documentIsReady:!1,isFullscreen:!1,load:function(){this.lbBorders={};
this.lbBorders.r=new b.BorderElement(T,Ta,41,0,34,1,{right:16});this.lbBorders.l=new b.BorderElement(T,Ua,6,0,34,1,{left:16});this.lbBorders.t=new b.BorderElement(s,Va,0,140,1,34,{right:16,left:16});this.lbBorders.b=new b.BorderElement(s,Wa,0,175,1,34,{right:16,left:16});this.lbBorders.tr=new b.BorderElement(s,Xa,0,35,34,34,{right:16});this.lbBorders.tl=new b.BorderElement(s,Ya,0,0,34,34,{left:16});this.lbBorders.br=new b.BorderElement(s,$a,0,105,34,34,{right:16});this.lbBorders.bl=new b.BorderElement(s,
Za,0,70,34,34,{left:16});c("#sitbLBHeader,#sitbLBHeaderLC,#sitbLBHeaderRC").css("background-image","url("+s+")")},show:function(a){if(a&&this._isSmallScreen())this.isFullscreen=!0;this.setFullscreenText();a=this.getLightboxHeight();c("#sitbLightbox").css({position:"absolute",top:this.getLightboxTop()+c(window).scrollTop(),left:this.getLightboxLeft(),width:this.getLightboxWidth(),height:a});c("#sitbReaderPageContainer").height(a+8);this.updateBorder()},toggleFullscreen:function(){this.isFullscreen=
!this.isFullscreen;da=c(document).width()-2*this.getLightboxLeft()-15;b.LightboxActions.handleResize();this.setFullscreenText();this.isFullscreen?b.RefTag.post(b.RefTag.Actions.fullscreenView):b.RefTag.post(b.RefTag.Actions.standardView)},setFullscreenText:function(){var a=this.isFullscreen?Ja:ua;c("#sitbReaderFullscreenLink").text(a)},setWidth:function(){var a=c("#sitbLightbox").width(),e=this.getLightboxWidth();e!=a&&(c("#sitbLightbox").width(e),this.updateBorder());b.ReaderWidget.setWidth()},updateBorder:function(){b.Border.applyBorderSet("#sitbLightbox",
"slbborder",this.lbBorders)},toggleSelextBoxes:function(a){if(V)for(var b=document.documentElement.getElementsByTagName("select"),a=a?"visible":"hidden",c=0;c<b.length;c++)b[c].style.visibility=a},resizeShade:function(){var a=F?c(document):c(window);c("#vellumShade").css({display:"block",left:0,top:a.scrollTop(),height:a.height(),width:a.width()})},dimTheLights:function(){b.LightboxWidget.resizeShade();b.LightboxWidget.showLoadingLightboxMessage()},removeOverlay:function(){c("#vellumShade").hide()},
handleMouseScroll:function(a){window.scrollBy(0,a.detail*12)},centerDiv:function(a,b){var d=c(a),f=c(b),g=parseInt(f.css("left"));g-=u;g=f.width()/2-d.width()/2+g;f=f.height()/2-d.height()/2;d.css("left",g);d.css("top",f)},showLoadingLightboxMessage:function(){N(c("#vellumLdgIco")).show()},_isSmallScreen:function(){return c(window).height()<=414},getLightboxTop:function(){return this.isFullscreen?27:60},getLightboxLeft:function(){return this.isFullscreen?q?3:5:37},getLightboxWidth:function(){return F?
Math.min(da,c(document).width()-this.getLightboxLeft()*2):c(window).width()-this.getLightboxLeft()*2},getLightboxHeight:function(){var a=this.isFullscreen?17:41;return c(window).height()-this.getLightboxTop()-a}};t.prototype.getCustomerReviewDiv=function(){return this.customerReviewDiv};t.prototype.getBookBuyingDiv=function(){return this.bookBuyingDiv};t.prototype.getSendSampleDiv=function(){return this.sendSampleDiv};t.prototype.createCustomerReviewDiv=function(){var a="";this.book.reviewStarsImageTag&&
(a='<span id="sitbReaderCustomerReviews">'+this.book.reviewStarsImageTag+"</span><br/>");return a};t.prototype.getPrimaryPriceString=function(){return this.book.buyingPrice};t.prototype.createBookBuyingDiv=function(){if(!this.book.hasValidOffer())return"";var a="";this.book.isBook2&&(a="_2");var b="";b+='<div id="sitbReaderOfferName'+a+'">';b+='<a href="/dp/'+this.book.buyingAsin+'">';b+=this.book.binding;b+="</a> ";b+="</div>";b+='<div id="sitbReaderOfferPrice'+a+'">';b+='<span class="sitbReaderPrice">'+
this.getPrimaryPriceString()+"</span>";this.book.displayPriceWithCORCurrency&&(b+='<div class="sitbReaderAlternativePrice">('+this.book.displayPriceWithCORCurrency+")</div>");b+="</div>";b+='<div id="sitbReaderCartDiv'+a+'">';this.kcpAppDiv="";if(this.book.kcpAppWidget&&this.book.kcpAppWidget.displayKCPWidget)a=this.book.isKindle()?"kcp_sitb_getfreeapp_ebooks":"kcp_sitb_getfreeapp_pbooks",this.kcpAppDiv='<div id="sitbKCPAppsWidget">'+h(a,{kcp_app_link:'<a id="sitbKcpAppsPopOver" class="sitbKcpAppsPopOver" href="'+
this.book.kcpAppWidget.fDocLink+'">'})+"</div>";b+=this.createCustomizedBuyingDiv();b+="</div>";return b};t.prototype.createCustomizedBuyingDiv=function(){throw"Not implemented exception";};t.prototype.createSendSampleDiv=function(){throw"Not implemented exception";};C.prototype=I(t.prototype);C.prototype.constructor=C;C.prototype.createCustomizedBuyingDiv=function(){var a="",e=b.RefTag;e.getFormatedRefTag(e.Actions.exit,e.ExitMethod.oneClickBuy);if(this.book.fastTrack&&!this.book.fastTrackTimerStarted)e=
"<div id='sitbReaderFastTrack'>"+this.book.fastTrack+"</div>",c("#sitbReaderFastTrackBlock").html(e),c(this.book.fastTrack).filter("script").each(function(){c.globalEval((this.text||this.textContent||this.innerHTML||"").replace(/<\!--\s*([\s\S]*?)\s*--\>/,"$1"))}),this.book.fastTrackTimerStarted=!0;var e=this.book.shouldPreorder?"a-button-preorder":"a-button-primary",d=this.book.shouldPreorder?h("preorder_add_to_cart"):h("add_to_cart");a+='  <form id="sitbReaderCart-form" method="post" action="/gp/legacy-handle-buy-box.html/ref=rdr_ext_atc">    <input type="hidden" name="asin.'+
this.book.buyingAsin+'" value="1" />    <input type="hidden" name="'+this.book.buyingAsin+'" value="1" />    <input type="hidden" name="session-id" value="'+this.book.sessionId+'" />    <input type="hidden" name="store-name" value="books" />    <input type="hidden" name="maw" value="1" />    <span class="'+("a-button "+e+" a-button-small a-button-icon")+'"><span class="a-button-inner"><input class="a-button-input" type="submit"><span class="a-button-text" aria-hidden="true">'+d+"</span></span></span>  </form>";
!c("#sitbReaderBuyContent #sitbKCPAppsWidgetPbook").length&&this.kcpAppDiv.search(/div/i)!=-1&&c(this.kcpAppDiv).attr("id","sitbKCPAppsWidgetPbook").appendTo(c("#sitbReaderBuyContent"));c("#sitbReaderBuyContent #sitbKCPAppsWidgetPbook").show();return a};C.prototype.createSendSampleDiv=function(){return""};A.prototype=I(t.prototype);A.prototype.constructor=A;A.prototype.getPurchaseArgsHtml=function(a,b){if(!a)return"";var d="";c.each(a,function(a,c){a!="target-fiona.0"&&(a=="subtype.0"&&(c=b?"FREE_CHAPTER":
"STANDARD"),d+='    <input type="hidden" name="'+a+'" value="'+c+'" />')});b&&(d+='  <input type="hidden" id="sitbReaderDeviceID" name="target-fiona.0" value="" /></div>');return d};A.prototype.createCustomizedBuyingDiv=function(){var a=b.RefTag,c="",d=a.getCheckoutRefTag(!1),f=a.getCheckoutRefTag(!0),g=a.getOneClickBuyRefTag(!1),a=a.getOneClickBuyRefTag(!0);c+='<form id="sitbReaderCart-form" method="post" action="/gp/search-inside/ref-proxy/ref='+(this.book.enableAdditionalBuy1Click?f:a)+'">';c+=
'<input type="hidden" name="sitbWorkflowURL" value="'+this.book.kindleBuyItURL.replace("/ref=","")+"/ref="+(this.book.enableAdditionalBuy1Click?d:g)+'">';this.book.purchaseArgs&&(c+=this.getPurchaseArgsHtml(this.book.purchaseArgs,!1));this.book.smallBuyButton&&(d=h("BUY_WITH_1_CLICK"),c+='<span class="a-button a-button-oneclick a-button-small a-button-icon"><span class="a-button-inner"><input class="a-button-input" type="submit"><span class="a-button-text" aria-hidden="true">'+d+"</span></span></span>");
this.book.enableAdditionalBuy1Click&&(c+="</form>",c+='<form id="sitbReaderCartBuy1Click-form" method="post" action="/gp/search-inside/ref-proxy/ref='+a+'">',c+='<input type="hidden" name="sitbWorkflowURL" value="'+this.book.kindleAdditionalBuyWith1ClickURL.replace("/ref=","")+"/ref="+g+'">',this.book.additionalBuyWith1ClickArgs&&(c+=this.getPurchaseArgsHtml(this.book.additionalBuyWith1ClickArgs,!1)),this.book.smallAdditionalBuyWith1ClickButton&&(d=h("BUY_WITH_1_CLICK"),c+='<span class="a-button a-button-oneclick a-button-small a-button-icon"><span class="a-button-inner"><input class="a-button-input" type="submit"><span class="a-button-text" aria-hidden="true">'+
d+"</span></span></span>"));c+=this.kcpAppDiv;this.book.kindleDevices!=""&&(c+='<div id="sitbKindleReaderDeliverToText">'+h("DELIVER_TO")+"</div>"+this.book.kindleDevices);c+="</form>";return c};A.prototype.createSendSampleDiv=function(){if(!this.book.hasValidOffer())return"";var a=b.RefTag,c="",d=a.getSendSampleRefTag(!1),a=a.getSendSampleRefTag(!0),f=this.book.buyingPrice.search(/[1-9]/)>=0;this.book.asin==this.book.buyingAsin&&!this.book.isPreorder&&f&&(c+='<div id="sitbKindleReaderSendSampleText">'+
h("SEND_SAMPLE")+"</div>",f=this.book.kindleSendSampleURL?this.book.kindleSendSampleURL:this.book.kindleBuyItURL,f=f.replace("/ref=","")+"/ref="+d,c+='<div id="sitbReaderSendSampleDiv"><form id="sitbReaderSendSample-form" method="post" action="/gp/search-inside/ref-proxy/ref='+a+'">',c+='<input type="hidden" name="sitbWorkflowURL" value="'+f+'">',this.book.sampleArgs&&(c+=this.getPurchaseArgsHtml(this.book.sampleArgs,!0)),this.book.smallSampleButton&&(d=h("try_a_sample"),c+='<span class="a-button a-button-base a-button-small"><span class="a-button-inner"><input class="a-button-input" type="button" onclick="SitbReader.jQuery(\'#sitbReaderDeviceID\').val(SitbReader.jQuery(\'#sitbReaderDeviceSelect\').val());SitbReader.jQuery(\'#sitbReaderSendSample-form\').submit();"><span class="a-button-text" aria-hidden="true">'+
d+"</span></span></span>"),c+="</form><br/>");return c};D.prototype.setBindingText=function(){this.book.binding&&c("#sitbReaderBinding").html("("+this.book.binding+")")};D.prototype.createUsedAndNew=function(a,b){a.isPrint()&&a.usedAndNewCount&&(a.usedAndNewCount>1||a.usedAndNewCount==1&&!a.isAmazonOffer)?a.usedBookDisabled?c(b).html(h("NEW_FROM",{ASIN:a.buyingAsin,COUNT:a.usedAndNewCount,PRICE:a.usedAndNewLowestPrice})).show():c(b).html(h("USED_AND_NEW_FROM",{ASIN:a.buyingAsin,COUNT:a.usedAndNewCount,
PRICE:a.usedAndNewLowestPrice})).show():c(b).hide()};D.prototype.setBuyBoxHtml=function(){if(this.book){var a=this.book.isKindle()?new A(this.book):new C(this.book),b=a.getCustomerReviewDiv(),d=a.getBookBuyingDiv(),a=a.getSendSampleDiv();c("#sitbReaderPriceBlock").html(b+d+a);c("#sitbReaderUsedDiv").html("&nbsp;");this.createUsedAndNew(this.book,"#sitbReaderUsedDiv")}};D.prototype.getTitleBook=function(){return this.book};E.prototype=I(D.prototype);E.prototype.constructor=E;E.prototype.setBindingText=
function(){this.book2||D.prototype.setBindingText.call(this)};E.prototype.renderBuyBoxHtml=function(a,e){b.BuyWidget["paneTitleWidget"+e]=new b.PaneTitleWidget(a.binding,"sitbReaderPriceBlock"+e,"SitbReader.BuyActions.toggleBuyboxPane("+e+")");var d=a.isKindle()?new A(a):new C(a),f=d.getBookBuyingDiv(),g=d.getSendSampleDiv();c("#sitbReaderPriceBlock"+e).html(b.BuyWidget["paneTitleWidget"+e].getHtml()+'<div id="sitbReaderPriceBlockContent'+e+'" class="sitbReaderBuyBox">'+f+g+'<div id="sitbReaderUsedDiv'+
e+'"></div></div>');a.showUsedAndNew&&this.createUsedAndNew(a,"#sitbReaderUsedDiv"+e);return d};E.prototype.setBuyBoxHtml=function(){var a=[];this.book.isOriginalBookPrint()?this.book.shouldHideKindleBuy?a.push(this.book2):(a.push(this.book2),a.push(this.book)):(this.book2&&a.push(this.book2),a.push(this.book));for(var b=0;b<a.length;b++){var d=b+1,f=this.renderBuyBoxHtml(a[b],d);d==1&&(f=f.getCustomerReviewDiv(),c("#sitbReaderPriceBlock").html(f));c("#sitbReaderPriceBlockContent"+d).text().trim()==
""?c("#sitbReaderPriceBlock"+d).hide():c("#sitbReaderPriceBlock"+d).show()}c("#sitbReaderUsedDiv").html("")};E.prototype.getTitleBook=function(){return this.book2?this.book2:this.book};b.BuyWidget={paneTitleWidget1:null,paneTitleWidget2:null,load:function(a){var e=b.RefTag,d=new D(a),f=d.getTitleBook(),g=Aa(f.title),k=c("#sitbReaderBookTitle a");k.text(g.substring(0,45));g.length>45&&k.append("&#0133;");k.attr({title:h("GO_TO_BOOK_PAGE",{BOOK_TITLE:g})});c("#sitbKCPAppsWidgetPbook").hide();var k=
f.thumbnailImage.replace(/\.(...)$/,"._SX35_.$1"),j=c("#sitbReaderBookThumbnailHolder"),l=new Image;l.onload=function(){var a=this.height;if(!(a>54)){var b=6;a%1&&b++;b+=Math.floor((54-a)/2);j.css({"margin-top":Math.floor((54-a)/2),"margin-bottom":b})}};l.title=l.alt=h("GO_TO_BOOK_PAGE",{BOOK_TITLE:g});l.src=k;l.setAttribute("id","sitbReaderBookThumbnail");j.html(l);b.currentBook.buyingAsin?(g=e.getFormatedRefTag(e.Actions.exit,e.ExitMethod.thumbnail),c("#sitbReaderBuyContent a").attr({href:"/dp/"+
f.buyingAsin+"/ref="+g})):c("#sitbReaderBuyContent a").click(function(){b.BuyActions.goToDetailPageFromThumbnail();return!1});if(f.authorNameList){g=[];e=e.getFormatedRefTag(e.Actions.exit,e.ExitMethod.author);k=f.isKindle()?"&search-alias=digital-text":"";for(l=0;l<f.authorNameList.length;l++)g[l]='<a href="/s/ref='+e+"?_encoding=UTF8&index=books&field-author="+f.authorNameList[l]+k+'">'+f.authorNameList[l]+"</a>";c("#sitbReaderAuthorBlock").html(h("BY",{AUTHORS:g.join(", ")}))}d.setBindingText();
d.setBuyBoxHtml();a.isPrint()?c("#sitbReaderFastTrackBlock").show():c("#sitbReaderFastTrackBlock").hide();window.P&&window.P.AUI_BUILD_DATE?this.createAuiKcpAppsWidget():c("#sitbKcpAppsPopOver").unbind("click").bind("click",{isKindle:a.isKindle()},this.getKcpAppsWidget)},createAuiKcpAppsWidget:function(){P.when("A","jQuery","a-modal").execute(function(a,e,d){a=b.currentBook.isKindle()?"_eb":"_pb";e=e("#sitbKcpPopoverTrigger");a={name:"kcp_sitb_widget",header:h("kcp_get_reading_app_dialog_title"),
closeButton:!0,url:"/gp/kindle/kcpAppsWidget.html/ref=kcpapp_sitb"+a+"?context=sitb"+a+"&isAUI=1",ajaxFailMsg:'<span style="color: red;">'+h("kcp_loading_error")+"</span>",closeButtonLabel:h("kcp_close"),width:h("kcp_sitb_widget_width")||675};d.create(e,a);P.when("A").execute(function(a){a.on("a:popover:show:kcp_sitb_widget",function(){b.ReaderKeyboardActions.tearDown()});a.on("a:popover:hide:kcp_sitb_widget",function(){b.ReaderKeyboardActions.load()});a.on("a:popover:afterHide:kcp_sitb_widget",function(){setTimeout(function(){c("body").css("overflow",
"hidden")},500)})})});c("#sitbKcpAppsPopOver").unbind("click").bind("click",function(){c("#sitbKcpPopoverTrigger").click()})},getKcpAppsWidget:function(a){var e=a.data.isKindle?"_eb":"_pb";p.onReady("popover",function(){c.AmazonPopover.displayPopover({title:h("kcp_get_reading_app_dialog_title"),showCloseButton:!0,closeEventInclude:["CLICK_OUTSIDE"],destination:"/gp/kindle/kcpAppsWidget.html/ref=kcpapp_sitb"+e+"?context=sitb"+e,ajaxErrorContent:'<span style="color: red;">'+h("kcp_loading_error")+"</span>",
modal:"true",closeText:h("kcp_close"),width:h("kcp_sitb_widget_width")||675,onShow:b.ReaderKeyboardActions.tearDown,onHide:b.ReaderKeyboardActions.load});var a=parseInt(c("#sitbReaderMiddle").css("z-index"))||2E5;c("#ap_overlay, .ap_popover").css("z-index",a+100)});return!1}};b.PaneTitleWidget=function(a,b,c){this.title=a;this.idPrefix=b;this.toggleActionString=c};b.PaneTitleWidget.prototype.getHtml=function(){return'<div id="'+this.idPrefix+'-title" class="sitbReader-pane-title" onclick="'+this.toggleActionString+
'">\n    <div class="sitbReader-horizontal-white-border"></div>\n    <div id="'+this.idPrefix+'-toggle" class="sitbReader-toggle-opened"></div>\n    <div id="'+this.idPrefix+'-title-text" class="sitbReader-pane-title-text">'+this.title+'</div>\n    <div id="'+this.idPrefix+'-white-border-btm" class="sitbReader-horizontal-white-border-bottom"></div>\n</div>\n'};b.PaneTitleWidget.prototype.slideUp=function(){c("#"+this.idPrefix+"-toggle").removeClass("sitbReader-toggle-opened").addClass("sitbReader-toggle-closed")};
b.PaneTitleWidget.prototype.slideDown=function(){c("#"+this.idPrefix+"-toggle").removeClass("sitbReader-toggle-closed").addClass("sitbReader-toggle-opened")};b.PaneTitleWidget.prototype.patchCSS=function(){};b.BookmarksWidget={numBookmarks:0,paneTitleWidget:new b.PaneTitleWidget(h("BOOK_SECTIONS"),"sitbReaderBookmarks","SitbReader.BookmarksActions.toggleBookmarksPane()"),load:function(a){if(b.currentBook.isMobi8FixedFormat())b.BookmarksWidget.hide();else{var e=[];if(b.currentBook.isHTML())e.push('<a class="sitbReader-bookmark" href="javascript:void(0)"'),
e.push("   onclick=\"SitbReader.BookmarksActions.goToBookmark('cvr')\">"),e.push(h("KINDLE_COVER")+"</a><br>"),e.push('<a class="sitbReader-bookmark" href="javascript:void(0)"'),e.push("   onclick=\"SitbReader.BookmarksActions.goToBookmark('srl')\">"),e.push(h("KINDLE_START_READING_LOCATION")+"</a><br>"),this.numBookmarks=2;else{for(var d=0;d<a.getSize();d++)c.inArray(a.getFirstPageNumber(d),b.currentBook.xPages)>=0?(e.push('<span class="sitbReader-bookmark-disabled">'),e.push(a.getName(d)+"</span><br>")):
(e.push('<a class="sitbReader-bookmark" href="javascript:void(0)"'),e.push("   onclick=\"SitbReader.BookmarksActions.goToBookmark('"+a.getName(d)+"')\">"),e.push(a.getName(d)+"</a><br>"));this.numBookmarks=a.getSize();b.currentBook.isPrint()&&(e.push('<a class="sitbReader-bookmark-surprise" href="javascript:void(0)"'),e.push('onclick="SitbReader.PageSequenceActions.goToRandomPage()">'),e.push("   "+h("SURPRISE_ME")+"</a><br>"),this.numBookmarks++)}c("#sitbReaderBookmarks-pages").html(e.join(""))}},
select:function(a){a=c("a.sitbReader-bookmark").eq(a);a.addClass("sitbReader-link-visited");a.addClass("sitbReader-link-selected")},unselect:function(){c("a.sitbReader-bookmark").removeClass("sitbReader-link-selected")},slideUp:function(){c("#sitbReaderBookmarks-pages").is(":hidden")||(c("#sitbReaderBookmarks-pages").height(),c("#sitbReaderBookmarks-pages").slideUp("slow",function(){b.SearchWidget.setResultsHeight()}),this.paneTitleWidget.slideUp())},slideDown:function(){if(c("#sitbReaderBookmarks-pages").is(":hidden")){var a=
b.SearchWidget.calculateSearchResultSpace();c("#sitbReaderSearch-all-results").height(a);b.SearchWidget.resultsHeight=a;b.SearchWidget.setResultsHeight(300);c("#sitbReaderBookmarks-pages").slideDown("slow",function(){b.SearchWidget.setResultsHeight()});this.paneTitleWidget.slideDown()}},show:function(){b.currentBook.isMobi8FixedFormat()?b.BookmarksWidget.hide():(b.BookmarksWidget.updateHeight(),c("#sitbReaderBookmarks").show(),this.paneTitleWidget.patchCSS())},hide:function(){c("#sitbReaderBookmarks").hide()},
updateHeight:function(){var a=b.BookmarksWidget.getFullHeight(),e=c("#sitbReaderLeftPane").height()-c("#sitbReaderBuyContent").outerHeight()-c("#sitbReaderBookmarks-title").outerHeight()-c("#sitbReaderSearch-title").outerHeight()-c("#sitbReaderSearch-input").outerHeight(),d=c("#sitbReaderBookmarks-pages");e-=d.outerHeight()-d.height();e<42?e=42:e>a&&(e=a);this.setHeight(e)},getFullHeight:function(){if(this.numBookmarks>1){var a=c("a.sitbReader-bookmark");return this.numBookmarks*(a.eq(1).offset().top-
a.eq(0).offset().top)}else return this.numBookmarks*parseInt(c("#sitbReaderBookmarks-pages").css("line-height"))},setHeight:function(a){c("#sitbReaderBookmarks-pages").height(a)}};b.SearchWidget={resultsHeight:0,headerHeight:0,highlightOpacity:G?"filter:alpha(opacity=50)":"opacity:0.5",paneTitleWidget:new b.PaneTitleWidget(h("SEARCH_INSIDE_THIS_BOOK"),"sitbReaderSearch","SitbReader.SearchActions.toggleSearchPane()"),load:function(){c("#sitbReaderSearch-title");b.currentBook.searchable?(c("#sitbReaderSearch").show(),
c("#sitbReaderSearch-form").submit(function(){b.SearchWidget.submitSearch();return!1}),this.showSampleSearches(),this.headerHeight=c("#sitbReaderSearch-headerheight").height()):c("#sitbReaderSearch").hide()},show:function(){this.showSampleSearches();this.setResultsHeight()},submitSearch:function(){var a=c(".sitbReaderSearch-inputbox").attr("value");b.SearchActions.search(a)},showSampleSearches:function(){var a=b.currentBook&&b.currentBook.sips||[],e=c("#sitbReaderSearch-sips");if(e.html()!="")e.show();
else if(a&&a.length){var d=[];d.push(h("SAMPLE_SEARCHES")+"<br>");for(var f=0;f<a.length;f++)d.push('<a class="sitbReader-sips" href="javascript:void(0)" '),d.push("onclick=\"SitbReader.SearchActions.search('"+a[f]+"',SitbReader.RefTag.Actions.sampleSearchExecuted);\">"),d.push(a[f]+"</a><br>");e.html(d.join(""))}},hideSampleSearches:function(){c("#sitbReaderSearch-sips").css("display","none")},clearResults:function(){c("#sitbReaderSearch-count").hide();c("#sitbReaderSearch-count-text").empty();c("#sitbReaderSearch-all-results").empty();
c(".sitbReaderSearch-inputbox").val("")},calculateSearchResultSpace:function(){return c("#sitbReaderLeftPane").height()+c("#sitbReaderLeftPane").offset().top-c("#sitbReaderSearch-all-results").offset().top-2},showResults:function(a){b.metrics.startTimer("searchDisplay");b.SearchWidget.hideLoading();if(a){b.SearchWidget.clearResults();var e=b.currentBook.buyingAsin,d="";!b.currentBook.hasFullAccess&&!b.availability.knownCustomer&&b.currentSearch.numResults>0&&(d="<br><b>"+h("SIGN_IN_TO_VIEW",{ASIN:e,
QUERY:encodeURIComponent(b.currentSearch.currentQuery)})+"</b>");c("#sitbReaderSearch-count").show();c("#sitbReaderSearch-count-text").append(b.currentSearch.numResults!=1?h("RESULTS_FOR",{HTML_REPLACE:Z(b.currentSearch.currentQuery),RESULT_NUM:b.currentSearch.numResults,SIGN_IN_MSG:d}):h("RESULT_FOR",{HTML_REPLACE:Z(b.currentSearch.currentQuery),RESULT_NUM:b.currentSearch.numResults,SIGN_IN_MSG:d}))}this.setResultsHeight();e=c("#sitbReaderSearch-all-results");if(b.currentSearch.numResults>0)for(var f=
d="",g=b.currentSearch.previousDisplayedResult;g<b.currentSearch.numDisplayedResults;g++)b.currentBook.pages[b.currentSearch.resultPageNumbers[g]].isX()?(d='""',f='"sitbReader-result-link sitbReader-link-disabled"'):(d='"SitbReader.RefTag.post(SitbReader.RefTag.Actions.searchResult,SitbReader.RefTag.LandingPage.excerpt); SitbReader.SearchActions.goToSearchResult('+g+')"',f='"sitbReader-result-link"'),e.append('<div id="sitbReaderSearch-result-'+g+'" class="sitbReaderSearch-result"><a class='+f+'   href="javascript:void(0)"    onclick= '+
d+'   title="'+Z(b.currentSearch.getLongExcerpt(g))+'"></a><div>'),this.fillDiv(b.currentSearch.getExcerpt(g),"<span class='sitbReaderSearch-result-page'>"+b.currentSearch.getPageTitle(g)+"</span> ","#sitbReaderSearch-result-"+g+" a",45);a&&e.scrollTop(0);b.SearchWidget.headerHeight=c("#sitbReaderSearch-headerheight").height();b.SearchWidget.resultsHeight=c("#sitbReaderSearch-all-results").height();b.metrics.endTimer("searchDisplay")},addMoreResultsLink:function(){var a=b.currentSearch.numResults-
20*b.currentSearch.currentResultsPage;b.currentSearch.totalResultsPages-b.currentSearch.currentResultsPage>0&&a>0&&(a=Math.min(b.currentSearch.numResults-20*b.currentSearch.currentResultsPage,20),c("#sitbReaderSearch-all-results").append('<div class="sitbReaderSearch-more-results"><a href="javascript:void(0)">'+(a>1?h("SHOW_MORE_RESULTS",{RESULTS_TO_LOAD:a}):h("SHOW_MORE_RESULT",{RESULT_TO_LOAD:a})+"</a></div>")),c(".sitbReaderSearch-more-results").attr("title",Sa),c(".sitbReaderSearch-more-results").unbind("click"),
c(".sitbReaderSearch-more-results").click(function(){b.SearchActions.fetchMoreResults()}))},hookTooltips:function(){c(document).ready(function(){c(".sitbReader-result-link").each(function(){c(this).tooltip({track:!0,delay:0,showURL:!1})})})},fillDiv:function(a,b,d,f){for(var g=0,h=a.length;g<h&&h-g>4;){var j=Math.ceil(g+(h-g)/2);c(d).html(b+a.removeChars(a.length-j));c(d).height()<=f?g=j:h=j}if(a.length-g<=4&&(c(d).html(b+a.excerpt),c(d).height()<f))return a.length;c(d).html(b+a.removeChars(a.length-
g));return g},select:function(a){c("a.sitbReader-result-link").removeClass("sitbReader-link-selected");a>-1&&(c("a.sitbReader-result-link").eq(a).addClass("sitbReader-link-visited"),c("a.sitbReader-result-link").eq(a).addClass("sitbReader-link-selected"))},unselect:function(a){c("a.sitbReader-result-link").eq(a).removeClass("sitbReader-link-selected");b.currentSearch.isVisited(a)?c("a.sitbReader-result-link").eq(a).addClass("sitbReader-link-visited"):c("a.sitbReader-result-link").eq(a).addClass("sitbReader-link-unselected")},
slideUp:function(){c("#sitbReaderSearch-contents").is(":hidden")||(c("#sitbReaderSearch-contents").slideUp("slow"),this.paneTitleWidget.slideUp())},slideDown:function(){c("#sitbReaderSearch-contents").is(":hidden")&&(c("#sitbReaderSearch-contents").slideDown("slow",function(){b.SearchWidget.setResultsHeight()}),this.paneTitleWidget.slideDown())},setResultsHeight:function(a){var e=b.SearchWidget.calculateSearchResultSpace();a!=null&&(e-=a);b.currentSearch.numResults>0&&c("#sitbReaderSearch-all-results").height(e);
b.SearchWidget.resultsHeight=e},showLoading:function(a){a?(b.SearchWidget.hideSampleSearches(),b.SearchWidget.clearResults(),a=0,a=c(window).height()+c(window).scrollTop()>c("#sitbLightbox").offset().top+c("#sitbLightbox").height()?c("#sitbLightbox").offset().top+c("#sitbLightbox").height():c(window).height()+c(window).scrollTop(),a=Math.round((a+c("#sitbReaderSearch-headerheight").height()-c("#sitbReaderSearch-headerheight").offset().top+14)/2),a<65&&(a=65),c("#sitbReaderSearch-loading").css("top",
a),c("#sitbReaderSearch-loading").show()):(c(".sitbReaderSearch-more-results").html(""),c(".sitbReaderSearch-more-results").addClass("sitbReaderSearch-more-results-loading"))},hideLoading:function(){c("#sitbReaderSearch-loading").hide();c(".sitbReaderSearch-more-results").hide();c(".sitbReaderSearch-more-results").remove()},adjustScrollBar:function(a){if(!(a<0||a>b.currentSearch.numDisplayedResults)){var e=c("#sitbReaderSearch-all-results").offset().top,a=c("#sitbReaderSearch-result-"+a).offset().top,
d=c("#sitbReaderSearch-all-results").scrollTop(),f=e+c("#sitbReaderSearch-all-results").height()<a+25;a<e&&c("#sitbReaderSearch-all-results").scrollTop(d-(e-a));f&&c("#sitbReaderSearch-all-results").scrollTop(a-e+d)}},renderHighlights:function(a){if(a&&a.length>0){for(var b=[],c,f,g,h,j=0;j<a.length;j++)c=a[j][0]*0.09765625,f=a[j][1]*0.09765625,g=a[j][2]*0.09765625,h=a[j][3]*0.09765625,b.push("<div id='sitbReaderSearch-highlight' style='"+this.highlightOpacity+";left:"+c+"%;top:"+f+"%;width:"+g+"%;height:"+
h+"%'/>");return b.join("")}else return""}};b.ReaderWidget={immediateMode:!0,pageImageWidth:0,imageWidth:0,imageHeight:0,PAGE_WIDTH_DELTA:55,PAGE_TURNER_WIDTH:14,PAGE_TURNER_SPACING:12,PAGE_TURNER_PAGE_SPACING:20,divid:"#sitbReaderPageContainer",lastScroll:Number.MIN_VALUE,turners:{},nextTurner:{},prevTurner:{},pageBorders:{r:new b.BorderElement(T,m+"bookImg_dshadow_side._V1_.png",0,0,5,1,{right:2,top:4,bottom:2}),tr:new b.BorderElement(s,m+"bookImg_dshadow_RTopSide._V1_.png",0,240,5,4,{top:4,right:2}),
br:new b.BorderElement(s,m+"bookImg_dshadow_RBtmCorner._V1_.png",0,235,5,4,{right:2,bottom:2}),bl:new b.BorderElement(s,m+"bookImg_dshadow_LBtm._V1_.png",0,230,4,4,{left:2,bottom:2}),b:new b.BorderElement(s,m+"bookImg_dshadow_bottom._V1_.png",0,225,1,4,{left:2,right:2,bottom:2})},load:function(){this.turners.l={divid:"#sitbReaderLeftPageTurner",offsets:"0 -3596px",top:0,state:null,visibility:!0};this.turners.r={divid:"#sitbReaderRightPageTurner",offsets:"0 -3625px",top:0,state:null,visibility:!0};
b.currentBook.isRightToLeftOrientation?(this.turners.l.action=b.ReaderActions.goToNextPage,this.turners.r.action=b.ReaderActions.goToPrevPage,this.nextTurner=this.turners.l,this.prevTurner=this.turners.r):(this.turners.l.action=b.ReaderActions.goToPrevPage,this.turners.r.action=b.ReaderActions.goToNextPage,this.nextTurner=this.turners.r,this.prevTurner=this.turners.l)},show:function(){var a=c(window),e=a.scrollTop(),a=a.height(),d=c("#sitbReaderPageContainer").offset().top;c("#sitbReaderPageContainerVerticalScroller").css("top",
(a+e-d)/2);this.centerVerticalScrollerOnPage();this.setWidth();this.centerPageImage();b.ZoomWidget.centerToolbarButtons();b.currentBook.isImage()?b.ZoomActions.updateFitToScreenZoomLevel(b.currentBook.pages[1]):b.PageSequenceWidget.redraw();setTimeout(function(){b.ReaderWidget.updateOnResize()},0)},disableTurner:function(a){var b=c(a.divid);if(l(b.css("background"))||a.state!=!1)b.unbind("click").css("cursor","auto").css("background","transparent"),b.hide(),a.state=!1},enableTurner:function(a){if(a.state!=
!0){var b=c(a.divid);b.unbind("click").bind("click",a.action).css("cursor","pointer").css("background","url("+L+") "+a.offsets);b.show();a.state=!0}},disableNextPageButton:function(){this.disableTurner(this.nextTurner)},disablePrevPageButton:function(){this.disableTurner(this.prevTurner)},enableNextPageButton:function(){this.enableTurner(this.nextTurner)},enablePrevPageButton:function(){this.enableTurner(this.prevTurner)},getLeftTurnerAction:function(){return this.turners.l.action},getRightTurnerAction:function(){return this.turners.r.action},
isOnLastPage:function(a,c){if(a==b.pageSequence.lastAvailablePageNumber)return!0;de=b.pageSequence.getLastDisplayElement();return de!=null&&de.isEntirelyInViewport(c.scrollTop(),c.scrollTop()+c.height())?!0:!1},updatePageTurnersState:function(){var a=b.pageSequence.currentPage,e=c("#sitbReaderPageContainer"),d=b.currentBook.isImage()?a>b.pageSequence.firstAvailablePageNumber:e.scrollTop()!=0||b.kindleRenderer&&b.kindleRenderer.isMobi8FixedFormat&&b.kindleRenderer.isMobi8FixedFormat()&&b.kindleRenderer.hasPrevPage();
(a=b.currentBook.isImage()?!this.isOnLastPage(a,e):e.scrollTop()<c("#sitbReaderPageScroll").height()-e.height()||b.kindleRenderer&&b.kindleRenderer.isMobi8FixedFormat&&b.kindleRenderer.isMobi8FixedFormat()&&b.kindleRenderer.hasNextPage())?this.enableNextPageButton():this.disableNextPageButton();d?this.enablePrevPageButton():this.disablePrevPageButton();b.BottomButtonWidget.setEnabled(a)},setPageTurnersDisplay:function(a){a?(c("#sitbReaderRightPageTurner").show(),c("#sitbReaderLeftPageTurner").show()):
(c("#sitbReaderRightPageTurner").hide(),c("#sitbReaderLeftPageTurner").hide())},updateOnResize:function(){this.setWidth();b.currentBook.isHTML()&&(c("#sitbReaderPageScroll").width(b.ZoomModel.getPageWidth()),b.KindleContentActions.handleResize());var a=c("#sitbReaderPageScroll").height();this.centerPageImage(c("#sitbReaderPageScroll").width(),a);b.ZoomWidget.centerToolbarButtons();this.updateVerticalScroller();b.PagelabelWidget.update();b.MessageWidget.resize();b.ReaderActions.setPanning();b.BottomButtonWidget.handleResize();
b.ReaderActions.setPageTurners();this.setContainerTurnerEvents();N(c("#vellumMsg"))},updateVerticalScroller:function(){this.centerVerticalScrollerOnPage();this.setVerticalScrollerWidth()},centerVerticalScrollerOnPage:function(){var a=c("#sitbReaderPageContainer").height()/2;c("#sitbReaderPageContainerVerticalScroller").css("top",a)},setVerticalScrollerWidth:function(){c(window).scrollLeft();c(window).width();var a=parseInt(c("#sitbReaderPageScroll").css("left")),e=c("#sitbReaderPageScroll").width(),
d=c("#sitbReaderPageContainer").width(),f=0,g=0,g=b.LeftPaneWidget.getWidth();this.isSmallReader(d,e)?(f=d-this.PAGE_TURNER_SPACING,g+=this.PAGE_TURNER_SPACING,f-=u):(f=e+2*this.PAGE_TURNER_WIDTH+2*this.PAGE_TURNER_PAGE_SPACING,g=a+g-this.PAGE_TURNER_WIDTH-this.PAGE_TURNER_PAGE_SPACING-2);c("#sitbReaderPageContainerVerticalScroller").width(f);c("#sitbReaderPageContainerVerticalScroller").css("left",g)},centerPageImage:function(a,b){var d=c("#sitbReaderPageScroll");typeof a=="undefined"&&(a=d.width());
typeof b=="undefined"&&d.height();var f=c("#sitbReaderPageContainer").width()-u;a<f?d.css("left",(f-a)/2):d.css("left","0px")},updatePageShadow:function(){this.drawPageShadow()},drawPageShadow:function(){b.Border.applyBorderSet("#sitbReaderPage","spborder",this.pageBorders)},setWidth:function(){c("#sitbReaderPageContainer").width(this.getContainerWidth())},getImageHeight:function(){return c("#sitbReaderPageContainer").height()-12},getContainerWidth:function(){var a=b.LightboxWidget.getLightboxWidth()-
20;a-=b.LeftPaneWidget.isOpened?206:12;b.SBWidget.isOpened&&(a-=214);return a},renderPageOverlay:function(a){var e=b.currentBook.pages[a],d=c("#sitbReaderHighlights-"+a),f=b.currentSearch.currentQuery;d.size()==1&&(d.empty(),b.currentSearch.numResults>0&&e.hasHighlights(f)&&d.append(e.highlights[f]),e.isTOC&&b.ClickableTOCWidget.show(a))},isSmallReader:function(a,b){return a-2*(this.PAGE_TURNER_WIDTH+this.PAGE_TURNER_PAGE_SPACING+u)<b},setContainerTurnerEvents:function(){var a=c("#sitbReaderPageContainer"),
e=c("#sitbReaderPageScroll");this.isSmallReader(a.width(),e.width())||a.unbind("mousemove").click(function(a){if((new Date).getTime()-b.ReaderWidget.lastScroll>200)(a=b.ReaderWidget.getPageTurnerByPosition(a.pageX))&&c(a.divid).trigger("click"),b.ReaderWidget.lastScroll=(new Date).getTime()})},getPageTurnerByPosition:function(a){var e=c("#sitbReaderPageScroll"),d=e.offset(),e=d.left+e.width();return a<d.left?b.ReaderWidget.turners.l:a>e?b.ReaderWidget.turners.r:null}};b.ZoomWidget={show:function(){this.setZoomControls()},
setZoomControls:function(){var a=b.ZoomModel;a.canZoomIn()?this.enableZoomIn():this.disableZoomIn();a.canZoomOut()?this.enableZoomOut():this.disableZoomOut()},centerToolbarButtons:function(){var a=c("#sitbReaderZoomToolbar"),e=c("#sitbReaderTBLinks"),d=c("#sitbReaderPageContainer").width()/2+b.LeftPaneWidget.getWidth(),f=b.LightboxWidget.isFullscreen?5:37;e.offset().left>d+53+f+10?a.css("left",d):(e=e.offset().left-(d+53+f),a.css("left",d+e-10))},enableZoomInHoverEffect:function(){c("#sitbReaderTitlebarZoomIn").bind("mouseover",
function(){c("#sitbReaderTitlebarZoomIn").css("background-position","0 -2031px")}).bind("mouseout",function(){c("#sitbReaderTitlebarZoomIn").css("background-position","0 -2013px")})},enableZoomOutHoverEffect:function(){c("#sitbReaderTitlebarZoomOut").bind("mouseover",function(){c("#sitbReaderTitlebarZoomOut").css("background-position","0 -1977px")}).bind("mouseout",function(){c("#sitbReaderTitlebarZoomOut").css("background-position","0 -1959px")})},disableZoomInHoverEffect:function(){c("#sitbReaderTitlebarZoomIn").unbind("mouseout").unbind("mouseover")},
disableZoomOutHoverEffect:function(){c("#sitbReaderTitlebarZoomOut").unbind("mouseout").unbind("mouseover")},disableZoomIn:function(){c("#sitbReaderTitlebarZoomIn").unbind("click").css("background","url("+L+") 0 -2049px");this.disableZoomInHoverEffect()},disableZoomOut:function(){c("#sitbReaderTitlebarZoomOut").unbind("click").css("background","url("+L+") 0 -1995px");this.disableZoomOutHoverEffect()},enableZoomIn:function(){c("#sitbReaderTitlebarZoomIn").unbind("click").bind("click",b.ZoomActions.zoomIn).css("background",
"url("+L+") 0 -2013px");this.enableZoomInHoverEffect()},enableZoomOut:function(){c("#sitbReaderTitlebarZoomOut").unbind("click").bind("click",b.ZoomActions.zoomOut).css("background","url("+L+") 0 -1959px");this.enableZoomOutHoverEffect()}};b.ErrorMessageWidget={divid:"#sitbReaderErrorMessageContainer",containingDivid:"#sitbReaderPageContainer",msgDisplayed:!1,show:function(a,e){var d=c(this.divid);c("#sitbReaderErrorMessageHeader").html(a?a:sa);c("#sitbReaderErrorMessageText").html(e?e:ta);b.LightboxWidget.centerDiv(this.divid,
this.containingDivid);d.show();c("#sitbReaderErrorMessageClose").unbind("click");c("#sitbReaderErrorMessageClose").click(function(){b.ErrorMessageWidget.hide()});this.msgDisplayed=!0},resize:function(){this.msgDisplayed&&(b.LightboxWidget.centerDiv(this.divid,this.containingDivid),c(this.divid).show())},hide:function(){c(this.divid).hide();this.msgDisplayed=!1}};b.MessageWidget={calledShow:!1,reftagsFired:{},randomSignInMsgFirst:!1,load:function(){},close:function(a){this.calledShow=!1;if(b.Message.messagesDisplayed)if(this.randomSignInMsgFirst)this.randomSignInMsgFirst=
!1;else{c("#sitbReaderMessageContainer").fadeOut("normal");b.Message.cleanupMessages();if(a)for(var e in this.reftagsFired)b.RefTag.post(b.RefTag.Actions.closeMessage,e);this.reftagsFired={};b.Message.messagesDisplayed=!1;b.Message.messagesDismissed=!0}},show:function(){this.calledShow=!0;b.MessageActions.getMobi8FixedFormatMessage();if(b.Message.haveMessagesToShow())b.Message.messagesDisplayed=!0,c("#sitbReaderMessageContainer").hide(),c("#sitbReaderMessageList").children().remove(),this.addAllMessages(),
this.resize(),c("#sitbReaderMessageContainer").stop(),c("#sitbReaderMessageContainer").show()},hide:function(){c("#sitbReaderMessageContainer").hide()},displayRandomPageLoginMessage:function(){b.Message.setRandomSignInMessageText();if(this.calledShow)this.randomSignInMsgFirst=!0,this.show()},addMessage:function(a,e){if(!l(a)){b.MessageActions.sendReftag(a,e);var d=document.createElement("li");c(d).html(a);c("#sitbReaderMessageList").append(d)}},addAllMessages:function(){this.addMessage(b.Message.relatedEditionMessage,
b.RefTag.MessageType.relatedEditions);this.addMessage(b.Message.pictureSuppressed,b.RefTag.MessageType.pictureSupression);this.addMessage(b.Message.randomPageLoginMessage,b.RefTag.MessageType.notLoggedIn);this.addMessage(b.Message.partialContentMessage,b.RefTag.MessageType.partialContent);this.addMessage(b.Message.mobi8FixedFormatMessage,b.RefTag.MessageType.regionMagnification)},resize:function(){if(b.Message.messagesDisplayed){var a=c("#sitbReaderPageContainer").width(),e=u,a=b.currentBook.isMobi8FixedFormat()?
a+6:a-e,e=b.LeftPaneWidget.getWidth();c("#sitbReaderMessageContainer").width(a).css("left",e+1)}},getTop:function(a){a=c(a).css("top");return typeof a=="undefined"?0:a=parseInt(a.substring(0,a.length-2))},getDisplayElementMessage:function(a,c){var d,f=40;switch(a){case 1:d=b.Message.getSignInMessageText(c.pageNumber-1);break;case 3:f=90;d=b.Message.getSignInMessageText(c.pageNumber-1);break;case 2:d=b.Message.getSkipMessageText(c.skipStart,c.skipEnd);break;case 4:d=b.Message.getSkipMessageText(c.skipStart,
c.skipEnd);break;case 5:d=h("THIS_IS_A_PREVIEW")}return new b.DisplayElement(c.top,f,2,c.pageNumber,"<div style='text-align: center;'>    <div class='sitbReaderScrollInfoMessageIcon' />    <div class='sitbReaderScrollInfoMessageText'>"+d+"</div>  </div>",a)}};b.MessageBoxWidget={messageBoxDisplayed:!1,load:function(){},show:function(a){var e=c("#sitbReaderMessageBoxContainer");e.hide().empty().append(!q?a.fragment.cloneNode(!0):a.fragment.firstChild.cloneNode(!0));this.messageBoxDisplayed=a;this.resize();
c("#sitbReaderMessageBoxCloseLink").bind("click",function(){b.MessageBoxWidget.close()});c("#sitbReaderMessageBoxCloseButton").bind("click",function(){b.MessageBoxWidget.close()});e.show()},close:function(){c("#sitbReaderMessageBoxContainer").hide();this.messageBoxDisplayed=!1},resize:function(){this.messageBoxDisplayed&&b.LightboxWidget.centerDiv("#sitbReaderMessageBoxContainer","#sitbReaderPageContainer")}};J.prototype=new oa;J.prototype.constructor=J;J.prototype.addLearnMoreHtml=function(){};J.prototype.getHelpContentsQuestions=
function(){return this.addGeneralHelpQuestions([])};J.prototype.getHelpContentsAnswers=function(){return this.addGeneralHelpAnswers([])};K.prototype=new oa;K.prototype.constructor=K;K.prototype.getHelpContentsQuestions=function(){var a=[];a.push(h("NEED_TO_SIGN_IN"));a.push(h("MY_PRIOR_PURCHASE"));b.currentBook.searchable&&a.push(h("SEARCH_MORE_EFFECTIVELY"));return this.addGeneralHelpQuestions(a)};K.prototype.getHelpContentsAnswers=function(){var a=[];a.push(h("NEED_TO_SIGN_IN_ANSWER"));a.push(h("MY_PRIOR_PURCHASE_ANSWER"));
b.currentBook.searchable&&a.push(h("SEARCH_MORE_EFFECTIVELY_ANSWER"));return this.addGeneralHelpAnswers(a)};b.HelpWidget={activeAnswer:-1,customizedHelpWidget:new K,load:function(){c("#sitbReaderHelpMenu").html('   <div id="sitbReaderMenu-top">       <div>           <div class="sitbReaderMenu-topleft"></div>           <div id="sitbReaderMenu-topborder-top" class="sitbReaderMenu-topborder sitbReaderMenu-topborder-top"></div>           <div id="sitbReaderMenu-topright-top" class="sitbReaderMenu-topright sitbReaderMenu-topright-top"></div>       </div>       <div>           <div class="sitbReaderMenu-leftborder"></div>           <div id="sitbReaderMenu-topcontent" class="sitbReaderMenu-content">               <div id="sitbReaderMenu-title"></div>               <div id="sitbReaderMenu-close" onclick="SitbReader.jQuery(\'#sitbReaderHelpMenu\').hide();"></div>           </div>           <div id="sitbReaderMenu-rightborder-top" class="sitbReaderMenu-rightborder sitbReaderMenu-rightborder-top"></div>       </div>   </div>   <div id="sitbReaderMenu-content">       <div>           <div class="sitbReaderMenu-topleft"></div>           <div id="sitbReaderMenu-topborder-content" class="sitbReaderMenu-topborder sitbReaderMenu-topborder-content"></div>           <div id="sitbReaderMenu-rightborder-content-top" class="sitbReaderMenu-rightborder sitbReaderMenu-rightborder-content-top"></div>       </div>       <div>           <div class="sitbReaderMenu-leftborder sitbReaderMenu-leftborder-content"></div>           <div id="sitbReaderMenu-content-center" class="sitbReaderMenu-content sitbReaderMenu-content-center">           </div>           <div id="sitbReaderMenu-rightborder-content" class="sitbReaderMenu-rightborder sitbReaderMenu-rightborder-content"></div>       </div>       <div>           <div class="sitbReaderMenu-bottomleft"></div>           <div id="sitbReaderMenu-bottomborder-content" class="sitbReaderMenu-bottomborder sitbReaderMenu-bottomborder-content"></div>           <div id="sitbReaderMenu-bottomright-content" class="sitbReaderMenu-bottomright sitbReaderMenu-bottomright-content"></div>       </div>   </div>');
c("#sitbReaderHelpLink").menufy(h("HELP"),b.HelpWidget._getHelpContentsHtml(),this.menufyCallback,41)},menufyCallback:function(){b.RefTag.post(b.RefTag.Actions.help)},toggleHelpAnswer:function(a){var e="#sitbReaderHelpQuestion"+a,d="#sitbReaderHelpQuestionIcon"+a,f="#sitbReaderHelpAnswer"+a,g="#sitbReaderHelpQuestion"+b.HelpWidget.activeAnswer,h="#sitbReaderHelpQuestionIcon"+b.HelpWidget.activeAnswer,j="#sitbReaderHelpAnswer"+b.HelpWidget.activeAnswer;c(g).removeClass("sitbReaderHelpQuestionActive");
c(g).addClass("sitbReaderHelpQuestionInactive");c(h).removeClass("sitbReaderHelpQuestionIconActive");c(h).addClass("sitbReaderHelpQuestionIconInactive");b.HelpWidget.activeAnswer!=a?(c(j).hide(),c(f).show(),c(e).removeClass("sitbReaderHelpQuestionInactive"),c(e).addClass("sitbReaderHelpQuestionActive"),c(d).removeClass("sitbReaderHelpQuestionIconInactive"),c(d).addClass("sitbReaderHelpQuestionIconActive"),b.HelpWidget.activeAnswer=a):(c(f).hide(),b.HelpWidget.activeAnswer=-1);ka()},_navigateToHelpPage:function(){window.open(h("HELP_PAGE"));
return!1},_getHelpContentsHtml:function(){var a=[];a.push(G?"<div class='sitbReaderHelpTable'>":"<table class='sitbReaderHelpTable'><tr><td>");a.push("<div class='sitbReaderFaqHeader'>"+h("FAQ")+"</div><br>");for(var b=this.customizedHelpWidget.getHelpContentsQuestions(),c=this.customizedHelpWidget.getHelpContentsAnswers(),f=0;f<b.length;f++)a.push("<div class='sitbReaderHelpTableRow'>"),a.push("<div class='sitbReaderHelpTableCol1'><div class='sitbReaderHelpQuestionIcon sitbReaderHelpQuestionIconInactive' id='sitbReaderHelpQuestionIcon"+
f+"' "),a.push("onclick='javascript:SitbReader.HelpWidget.toggleHelpAnswer("+f+");' ></div></div>"),a.push("<div class='sitbReaderHelpTableCol2'>"),a.push("<div id='sitbReaderHelpQuestion"+f+"' class='sitbReaderHelpQuestionText' onclick='javascript:SitbReader.HelpWidget.toggleHelpAnswer("+f+");'>"),a.push(b[f]),a.push("</div>"),a.push("<div class='sitbReaderHelpAnswer' id='sitbReaderHelpAnswer"+f+"'>"+c[f]+"</div></div>"),a.push("</div>");this.customizedHelpWidget.addLearnMoreHtml(a);a.push(G?"</div>":
"</td></tr></table>");return a.join("")}};b.LeftPaneWidget={isOpened:!0,buyBoxHeight:130,show:function(){var a=c("#sitbReaderBuyContent").height();if(a>0)this.buyBoxHeight=a;a=this.buyBoxHeight+9;c("#sitbReaderCollapser").css("top",a+"px");this.isOpened||this.close()},toggle:function(){b.metrics.startTimer("leftpanetoggle");c("#sitbReaderLeftPane").is(":hidden")?(b.RefTag.post(b.RefTag.Actions.leftSeperator,b.RefTag.PanelAction.open),this.open()):(b.RefTag.post(b.RefTag.Actions.leftSeperator,b.RefTag.PanelAction.close),
this.close());b.currentBook.isHTML()&&b.ReaderWidget.updateOnResize();b.metrics.endTimer("leftpanetoggle")},open:function(){this.isOpened=!1;this._animate("open");c("#sitbReaderCollapser").css({"background-position":"0 -3140px",width:"16px"}).attr("title","");var a={background:"url("+T+")","background-position":"-90px 0",width:"6px"};c("#sitbReaderSplitter").css(a);c("#sitbReaderSplitter_bottom").css(a)},close:function(){this.isOpened=!1;this._animate("close");c("#sitbReaderCollapser").css({"background-position":"0 -3234px",
width:"22px"}).attr("title",jb);var a={background:"url("+T+")","background-position":"-97px 0",width:"12px"};c("#sitbReaderSplitter").css(a);c("#sitbReaderSplitter_bottom").css(a)},getWidth:function(){return this.isOpened?206:12},splitterOnMouseHelper:function(a){var b=c("#sitbReaderCollapser"),d=c(".sitbReaderSplitter");a=="onMouseOver"?this.isOpened?(b.css("background-position","0 -3187px"),d.css({"background-position":"-110px 0",width:"6px"})):(b.css("background-position","0 -3281px"),d.css({"background-position":"-117px 0",
width:"12px"})):this.isOpened?(b.css("background-position","0 -3140px"),d.css({"background-position":"-90px 0",width:"6px"})):(b.css("background-position","0 -3234px"),d.css({"background-position":"-97px 0",width:"12px"}))},_animate:function(a){a=(this.isOpened=a=="open"?!0:!1)?200:0;this.isOpened?c("#sitbReaderLeftPane").css("display","inline"):c("#sitbReaderLeftPane").css("display","none");c("#sitbReaderSplitter").css("left",a);c("#sitbReaderSplitter_bottom").css("left",a);c("#sitbReaderCollapser").css("left",
a);a=b.ReaderWidget;a.setWidth();a.centerPageImage();c("#sitbReaderPageContainer").css("left",this.getWidth());a.updateVerticalScroller();b.ZoomWidget.centerToolbarButtons();b.MessageWidget.resize();b.ErrorMessageWidget.resize();b.PagelabelWidget.update()}};b.SBWidget={containerPageOffsets:[],recDivId:"#sitbReaderSB #recs",histDivId:"#sitbReaderSB #history",JQO:{},recMargin:0,recHeight:0,recHolderHeight:0,hideCount:0,isOpened:null,curBookTarget:[],hidden:{"#sitbReaderSB #recs":!1,"#sitbReaderSB #history":!1},
navHolder:{"#sitbReaderSB #recs":"#sitbReaderSB-recs","#sitbReaderSB #history":"#sitbReaderSB-history"},paneRefTag:{"#sitbReaderSB #recs":b.RefTag.SerendipityBar.similarities,"#sitbReaderSB #history":b.RefTag.SerendipityBar.history},books:{"#sitbReaderSB #history":function(){return b.SerendipityBar.historyBooks},"#sitbReaderSB #recs":function(){return b.SerendipityBar.recommendedBooks}},historyPaneWidget:new b.PaneTitleWidget(h("BROWSING_HISTORY"),"sitbReaderSB-history","SitbReader.SBActions.toggleHistoryPane()"),
recsPaneWidget:new b.PaneTitleWidget(h("CUSTOMER_ALSO_BOUGHT"),"sitbReaderSB-recs","SitbReader.SBActions.toggleRecsPane()"),pageCounts:[],curPage:[],_shouldOpen:function(){if(this.isOpened!=null)return this.isOpened;var a=(b.currentBook.isHTML()?b.ZoomModel.MAX_PAGE_WIDTH_FOR_PAGE_FIT:b.ZoomModel.getPageWidth())+gb;return this.isOpened=c(window).width()>=a},setIsOpened:function(a){this.isOpened=a},show:function(a){this.resize();a&&this._shouldOpen()?(b.metrics.startTimer("SBshow"),this.open(),setTimeout(function(){b.SBActions.loadSBDataCall(b.SerendipityBar.loadBooksFromData,
"")},200),b.currentBook.isHTML()&&b.ReaderWidget.updateOnResize()):c("#sitbReaderSBOpener").css("background-position","0 -2613px").attr("title",fa)},resize:function(){var a=b.LeftPaneWidget.buyBoxHeight-13;c("#sitbReaderSBOpener").css("top",a+"px");b.SerendipityBar.dataLoaded&&(this.hidden[this.histDivId]==!1&&this.historyHandleResize(),this.hidden[this.recDivId]==!1&&this.books[this.recDivId]().length&&this.recHandleResize())},toggle:function(){c("#sitbReaderSB").width()==0?(b.RefTag.post(b.RefTag.Actions.sbSeperator,
b.RefTag.PanelAction.open),this.open()):(b.RefTag.post(b.RefTag.Actions.sbSeperator,b.RefTag.PanelAction.close),this.close());b.currentBook.isHTML()&&b.ReaderWidget.updateOnResize()},open:function(){this.setIsOpened(!0);b.metrics.startTimer("SBopen");b.SerendipityBar.dataLoaded||setTimeout(function(){b.SBActions.loadSBDataCall(b.SerendipityBar.loadBooksFromData,"")},200);this._animate("open");c("#sitbReaderSBOpener").css("background-position","0 -2086px").unbind().attr("title",hb);b.metrics.endTimer("SBopen")},
close:function(){this.setIsOpened(!1);b.metrics.startTimer("SBclose");this._animate("close");c("#sitbReaderSBOpener").css("background-position","0 -2613px").unbind().attr("title",fa);b.metrics.endTimer("SBclose")},hideLoading:function(){c(".sitbReaderSB-content").css("background","none");c(".hideforloading").css("display","block")},getAvailHeightForRecs:function(){return c("#sitbReaderSB").height()-(c("#sitbReaderSB-recs-title").offset().top-c("#sitbReaderSB").offset().top)-38},getAvailHeightForHistory:function(){return this.getSBContentHeight()-
c("#sitbReaderSB-history #nav").height()-c("#sitbReaderSB #historyinfo").height()-c("#sitbReaderSB-history-title").height()-13},_animate:function(a){isOpen=a=="open"?!0:!1;this.setIsOpened(isOpen);a=isOpen?214:0;c("#sitbReaderSB").width(a);c("#sitbReaderSBSplitter").css("right",a);c("#sitbReaderSBSplitter_bottom").css("right",a);c("#sitbReaderSBOpener").css("right",a);a=b.ReaderWidget;a.setWidth();a.centerPageImage();a.updateVerticalScroller();b.ZoomWidget.centerToolbarButtons();b.MessageWidget.resize();
b.ErrorMessageWidget.resize();b.PagelabelWidget.update()},drawBook:function(a,b,d){var f=c(b),g=c("<div class=pager></div>");f.append(g);var h=1;typeof this.curBookTarget[b]=="undefined"&&(this.curBookTarget[b]=0);this.containerPageOffsets[b]=[];this.containerPageOffsets[b][0]=0;this.curPage[b]=0;for(var j in a)if(a.hasOwnProperty(j)){var l=a[j].render(g);g.height()>d&&(l.remove(),g=c("<div class=pager></div>"),f.append(g),g.append(l),this.containerPageOffsets[b][h]=parseInt(j),h++)}h<2&&b==this.histDivId&&
c("#sitbReaderSB #historyholder").height(g.height());f.width(h*214);this.pageCounts[b]=h},findBestPage:function(a,b){for(var c=this.containerPageOffsets[b],f=c.length,g=-1,h;f-g>1;)c[h=f+g>>1]>a?f=h:g=h;return g},showNextRecs:function(){this.panePageTransition(this.recDivId,1)},showPrevRecs:function(){this.panePageTransition(this.recDivId,-1)},showNextHist:function(){this.panePageTransition(this.histDivId,1)},showPrevHist:function(){this.panePageTransition(this.histDivId,-1)},panePageTransition:function(a,
c){if(this.curPage[a]+c>=0&&this.curPage[a]+c<this.pageCounts[a]){var d=a==this.recDivId?"SBpagetransitionsims":"SBpagetransitionhistory";b.metrics.startTimer(d);this.curPage[a]+=c;this.JQO[a].animate({marginLeft:this.curPage[a]*-214},"normal");this.curBookTarget[a]=this.containerPageOffsets[a][this.curPage[a]];this.updateNavInfo(a,this.navHolder[a]);b.RefTag.post(b.RefTag.Actions.sbPage,this.paneRefTag[a]);b.metrics.endTimer(d)}},recHandleResize:function(){var a=this.getAvailHeightForRecs();c("#sitbReaderSB #recholder").height(a);
this.sbCatResize(this.recDivId,a)},sbCatResize:function(a,e){if(b.SerendipityBar.dataLoaded){this.JQO[a]=c(a);this.JQO[a].empty();this.drawBook(this.books[a](),a,e);var d=this.findBestPage(this.curBookTarget[a],a);this.curPage[a]=d;this.JQO[a].css("marginLeft",d*-214);this.updateNavInfo(a,this.navHolder[a])}},updateNavInfo:function(a,b){var d=this.curPage[a],f=this.pageCounts[a];c(b+" #curpage").html(d+1);c(b+" #pagecount").html(f);d<f-1?c(b+" #nav #next").addClass("enabled"):c(b+" #nav #next").removeClass("enabled sbhighlight");
d>0?c(b+" #nav #prev").addClass("enabled"):c(b+" #nav #prev").removeClass("enabled sbhighlight")},historyHandleResize:function(){var a=this.getAvailHeightForHistory();c("#sitbReaderSB #historyholder").height(a);this.sbCatResize(this.histDivId,a)},historySlideUp:function(){var a=c("#sitbReaderSB-history-content");a.is(":hidden")||(this.hideCount++,this.hidden[this.histDivId]=!0,b.SBWidget.resize(),a.slideUp("slow",function(){b.SBWidget.resize()}),this.historyPaneWidget.slideUp())},historySlideDown:function(){var a=
c("#sitbReaderSB-history-content");a.is(":hidden")&&(this.hideCount--,this.hidden[this.histDivId]=!1,b.SBWidget.resize(),a.slideDown("slow",function(){b.SBWidget.resize()}),this.historyPaneWidget.slideDown())},recsSlideUp:function(){var a=c("#sitbReaderSB-recs-content");a.is(":hidden")||(this.hideCount++,this.hidden[this.recDivId]=!0,a.slideUp("slow",function(){b.SBWidget.resize()}),this.recsPaneWidget.slideUp())},recsSlideDown:function(){var a=c("#sitbReaderSB-recs-content");a.is(":hidden")&&(this.hideCount--,
this.hidden[this.recDivId]=!1,b.SBWidget.resize(),a.slideDown("slow",function(){b.SBWidget.resize()}),this.recsPaneWidget.slideDown())},getSBContentHeight:function(){var a=c("#sitbReaderSBSplitter").height()+8-c("#sitbReaderSB-history-title").height()-c("#sitbReaderSB-recs-title").height();this.hideCount<=0&&(a/=2);return a},historyLoadSuccess:function(){c("#sitbReaderSB #historyinfo #histlinktext").html(xa);c("#sitbReaderSB #historyinfo #histstatustext").hide()},historyLoadFailure:function(){c("#sitbReaderSB #historyinfo #histlinktext").html(bb);
c("#sitbReaderSB #historyinfo #histstatustext").html(eb).css("display","block");c("#sitbReaderSB #sitbReaderSB-history #nav").remove()},historyLoadEmpty:function(){c("#sitbReaderSB #historyinfo #histlinktext").html(xa);c("#sitbReaderSB #historyinfo #histstatustext").html(cb).css("display","block");c("#sitbReaderSB #sitbReaderSB-history #nav").remove()},historyLoadOff:function(){c("#sitbReaderSB #historyinfo #histlinktext").html(ab);c("#sitbReaderSB #historyinfo #histstatustext").html(db).css("display",
"block");c("#sitbReaderSB #sitbReaderSB-history #nav").remove()},noSims:function(){c("#sitbReaderSB #simsinfo").html(fb).show();c("#sitbReaderSB #sitbReaderSB-recs-content #nav").remove();c("#sitbReaderSB #recholder").height(8)},splitterOnMouseHelper:function(a){var b=c("#sitbReaderSBOpener"),d=c(".sitbReaderSBSplitter");a=="onMouseOver"?(this.isOpened?b.css("background-position","0 -2350px"):b.css("background-position","0 -2877px"),d.css("background-position","-117px 0")):(this.isOpened?b.css("background-position",
"0 -2086px"):b.css("background-position","0 -2613px"),d.css("background-position","-97px 0"))},getHtml:function(){return!b.SerendipityBar.isOn?"":'<div id="sitbReader-sbarea">    <div id="sitbReaderSBSplitter" class="sitbReaderSBSplitter"          onclick="SitbReader.SBWidget.toggle()"          onmouseover="SitbReader.SBWidget.splitterOnMouseHelper(\'onMouseOver\')"         onmouseout="SitbReader.SBWidget.splitterOnMouseHelper(\'onMouseOut\')">        <div id="sitbReaderSBSplitter_mid" class="sitbReaderSBSplitter"></div>        <div id="sitbReaderSBSplitter_btm" class="sitbReaderSBSplitter"></div>    </div>    <div id="sitbReaderSBOpener" title="'+
fa+'"          onclick="SitbReader.SBWidget.toggle()"          onmouseover="SitbReader.SBWidget.splitterOnMouseHelper(\'onMouseOver\')"         onmouseout="SitbReader.SBWidget.splitterOnMouseHelper(\'onMouseOut\')">   </div>    <div id="sitbReaderSB">        <div id="sitbReaderSB-history">'+this.historyPaneWidget.getHtml()+'            <div id="sitbReaderSB-history-content" class="sitbReaderSB-content">                <div id="nav" class="hideforloading">                    <button id="prev" onmouseover="if (SitbReader.jQuery(this).hasClass(\'enabled\')) SitbReader.jQuery(this).addClass(\'sbhighlight\');" onmouseout="SitbReader.jQuery(this).removeClass(\'sbhighlight\');" onclick="SitbReader.SBWidget.showPrevHist()"/> <div id="navinfo"> '+
h("PAGE_OF",{HTML_START:'<span id="curpage"></span>',HTML_END:'<span id="pagecount"></span>'})+'</div>                    <button id="next" onmouseover="if (SitbReader.jQuery(this).hasClass(\'enabled\')) SitbReader.jQuery(this).addClass(\'sbhighlight\');" onmouseout="SitbReader.jQuery(this).removeClass(\'sbhighlight\');" onclick="SitbReader.SBWidget.showNextHist()"/>                </div>                <div id="historyholder"><div id="history"></div>            </div>            <div id="historyinfo" class="hideforloading"><div id="histstatustext"/>&gt;                <a href="/gp/history/?ybhGroup=Books/ref=rdr_'+
b.RefTag.Actions.sbBookHistory+'" title="'+ib+'">                    <span id="histlinktext"/>                </a>            </div>        </div>    </div>    <div id="sitbReaderSB-recs">'+this.recsPaneWidget.getHtml()+'        <div id="sitbReaderSB-recs-content" class="sitbReaderSB-content">            <div id="nav" class="hideforloading">                <div id="prev" onmouseover="if (SitbReader.jQuery(this).hasClass(\'enabled\')) SitbReader.jQuery(this).addClass(\'sbhighlight\');" onmouseout="SitbReader.jQuery(this).removeClass(\'sbhighlight\');" onclick="SitbReader.SBWidget.showPrevRecs()"/> <div id="navinfo"> '+
h("PAGE_OF",{HTML_START:'<span id="curpage"></span>',HTML_END:'<span id="pagecount"></span>'})+'</div>                <div id="next" onmouseover="if (SitbReader.jQuery(this).hasClass(\'enabled\')) SitbReader.jQuery(this).addClass(\'sbhighlight\');" onmouseout="SitbReader.jQuery(this).removeClass(\'sbhighlight\');" onclick="SitbReader.SBWidget.showNextRecs()"/></div><div id="recholder">                <div id="recs"></div></div>                <div id="simsinfo"/>            </div>        </div>    </div></div>'}};
b.ClickableTOCWidget={show:function(a){if(a=parseInt(a))if(b.ClickableTOC.hasPages[a]){var e=b.currentBook.pages[a].links;b.ClickableTOCActions.preCachePage(parseInt(a)+1);for(var d in e)if(e.hasOwnProperty(d)){var f=c("<div class='toclink tocdest-"+e[d].dest+"' style='left:"+e[d].box[0]*100+"%; top:"+e[d].box[1]*100+"%; width:"+e[d].box[2]*100+"%; height:"+e[d].box[3]*100+"%'><div/></div>");b.currentBook.pages[e[d].dest].isX()?(f.addClass("tocunavailable"),f.attr("title",h("PAGE_NOT_AVAILABLE"))):
(b.ClickableTOC.visitedPages[e[d].dest]&&f.addClass("tocvisited"),function(a){f.click(function(){b.ClickableTOCActions.goToPage(a)});f.hover(function(){c("#sitbReaderPageScroll .toclink.tocdest-"+a).addClass("tochover")},function(){c("#sitbReaderPageScroll .toclink.tocdest-"+a).removeClass("tochover")})}(e[d].dest));c("#sitbReaderHighlights-"+a).append(f)}}else b.ClickableTOCActions.loadTOCDataCall(a,b.ClickableTOCActions.storeAndShow)}};b.PageSequenceWidget={scrollTimer:200,slowScrollTimer:500,redrawTimer:50,
scrollTimeout:null,scrollSequenceStart:0,minScrollTrigger:0,maxScrollTrigger:3E3,scrollEventCount:0,deferredRedraw:null,bigScroll:!1,goToStartTime:-1,immediateScroll:!1,redrawCallback:void 0,reachedEndOfScroll:!1,scrollNow:function(){var a=b.PageSequenceWidget;if(a.immediateScroll)return a.immediateScroll=!1,!0;if(a.scrollEventCount%10==0&&!a.bigScroll){var e=(new Date).getTime(),d=c("#sitbReaderPageContainer").scrollTop();if(a.scrollEventCount==0){if(a.scrollSequenceStart=e,d<a.minScrollTrigger||
d>a.maxScrollTrigger)a.bigScroll=!0}else if(d<a.minScrollTrigger||d>a.maxScrollTrigger)if(e-a.scrollSequenceStart>a.slowScrollTimer)return!0;else a.bigScroll=!0}return!1},show:function(a){b.PageSequenceWidget.reachedEndOfScroll=!1;var e=b.ZoomModel.getPageWidth();a?this._createDisplayScroll():(c("#sitbReaderPageContainer").scrollTop(0),b.currentBook.isHTML()&&this._createDisplayElements(b.currentBook));this.showDisplayElementByScroll();c("#sitbReaderPageContainer").scroll(function(){var a=b.PageSequenceWidget;
clearTimeout(a.scrollTimeout);a.scrollNow()?a._scrollReleaseCallback():a.scrollTimeout=setTimeout(a._scrollReleaseCallback,a.scrollTimer,top);a.scrollEventCount++});c("#sitbReaderPageScroll").css({height:b.pageSequence.scrollHeight,width:e}).bind("contextmenu",function(a){z(a);return!1});F&&(c("#sitbReaderPlaceholder").bind("touchmove",function(a){a.originalEvent.touches.length==1&&a.preventDefault()}).bind("touchend",function(a){a.originalEvent.touches.length>1&&b.LightboxActions.handleResize()}),
c("#vellumShade").bind("touchmove",function(a){a.originalEvent.touches.length==1&&a.preventDefault()}).bind("touchend",function(a){a.originalEvent.touches.length>1&&b.LightboxActions.handleResize()}),c("#sitbReaderPageContainer").bind("touchstart",function(a){if(a.originalEvent.touches.length==1)b.ReaderWidget.lastPosition=a.originalEvent.touches[0].pageY}).bind("touchmove",function(a){if(a.originalEvent.touches.length==1)a.preventDefault(),a=a.originalEvent.touches[0].pageY,adjustedScrollTop=Math.max(0,
c("#sitbReaderPageContainer").scrollTop()+b.ReaderWidget.lastPosition-a),c("#sitbReaderPageContainer").scrollTop(adjustedScrollTop),b.ReaderWidget.lastPosition=a}).bind("touchend",function(a){a.originalEvent.touches.length>1&&b.LightboxActions.handleResize()}))},_scrollReleaseCallback:function(){var a=b.PageSequenceWidget,e=c("#sitbReaderPageContainer")[0].offsetHeight,d=c("#sitbReaderPageContainer").scrollTop(),f=c("#sitbReaderPageContainer")[0].scrollHeight,g=80,h=!0;b.currentBook.isHTML()&&(c("div.sitb-buy-box").length>
0?g=c("div.sitb-buy-box").outerHeight(!0)/2:h=!1);if(a.reachedEndOfScroll==!1&&h==!0&&e+d+g>=f)b.RefTag.post(b.RefTag.Actions.scrolledToEnd),a.reachedEndOfScroll=!0;b.currentBook.isImage()?a.showDisplayElementByScroll(!0):(b.ReaderWidget.updatePageTurnersState(),a._handleScrollMetrics())},_createDisplayScroll:function(){var a=b.pageSequence;this._createDisplayElements(b.currentBook);for(var e=b.ZoomModel.getPageWidth(),d=[],f=0;f<a.PARTIAL_DIVS_NUM;f++)d.push('<div id="scrollElm-'+f+'"></div>');c("#sitbReaderPageScroll").html(d.join("")).css({height:b.pageSequence.scrollHeight,
width:e})},_createDisplayElements:function(a,c){a.isKPS()?b.PageSequenceWidget._createKPSDisplayElements(a,c):a.isImage()?b.PageSequenceWidget._createPrintDisplayElements(a,c):b.PageSequenceWidget._createHtmlDisplayElements(a)},_createPrintDisplayElements:function(a,c){var d=b.pageSequence;d.emptyScroll();var f=a.pages,g=a.numPages,k=null,j,l,m=!1,n=a.bookmarks.getFirstAndLastPageNumberByName(h("FIRST_PAGES")),p=n.last?n.last+1:null,n=n.first?n.first:null,s=b.availability.level,t=b.MessageWidget,
u=q?8:10,r;for(r=1;r<=g;r++){if(r==2||r==n)j=t.getDisplayElementMessage(5,{top:d.scrollHeight,pageNumber:r}),this._addOrReplaceMessageElement(j,d);r==p&&s==0&&!b.currentBook.hasFullAccess&&(j=t.getDisplayElementMessage(1,{top:d.scrollHeight,pageNumber:r}),this._addOrReplaceMessageElement(j,d));if(!f[r].isX()&&!f[r].isY()){if(m&&(m=!1,j=r-1,d.getDisplayElement(d.getScrollLength()-1).type!=2)){var v;v=b.availability.isT2NonFPS()?4:2;j=t.getDisplayElementMessage(v,{top:d.scrollHeight,pageNumber:j,skipStart:l,
skipEnd:j});d.pushDisplayElement(j);d.scrollHeight+=j.height;c&&c<r&&k==null&&(k=j)}j=f[r].getScaledDimensions().height;j=new b.DisplayElement(d.scrollHeight,j,1,r);d.pushDisplayElement(j);d.scrollHeight+=j.height+u;c==r&&(k=j)}else m||(m=!0,l=r)}return k},_createHtmlDisplayElements:function(){var a=b.pageSequence,c=new b.KindleContentWidget;a.pushDisplayElement(c);return c},_addOrReplaceMessageElement:function(a,c){var d=c.getDisplayElement(c.getScrollLength()-1);if(d&&d.type==2)if(b.Message.getMessagePriority(d.msgType)<
b.Message.getMessagePriority(a.msgType))a.top-=d.height,c.replaceDisplayElement(c.getScrollLength()-1,a),c.scrollHeight-=d.height;else return;else c.pushDisplayElement(a);c.scrollHeight+=a.height},showDisplayElementByScroll:function(a,e){a&&b.metrics.startTimer("scroll");var d=c("#sitbReaderPageContainer").height(),f=b.pageSequence;if(!e||e<0)e=c("#sitbReaderPageContainer").scrollTop();var g=e+d,h=f.findVisibleElementIndices(e,g),j;for(j in h)if(h.hasOwnProperty(j)){var l=f.getDisplayElement(h[j]);
l&&l.hasOwnProperty("page")&&f.getDisplayElement(h[j]).page.setVisible()}j=f.currentPage;var l=h[parseInt(h.length/2)],l=f.findElementsRangeToSet(l),m=f.findElementsToSet(h);if(m.length>1)this.minScrollTrigger=f.getDisplayElement(m[1]).top,this.maxScrollTrigger=f.getDisplayElement(m[m.length-1]).top-d;this.scrollEventCount=0;this.bigScroll=!1;f.setVisibleElements(m,l);f.selectCurrentPageNumber(h,e,g);if(f.currentPage!=j||b.currentBook.isHTML())this.onPageChange(f.currentPage);b.ReaderActions.setPageTurners();
if(a)this.goToStartTime>0?(b.metrics.recordTimer("page",(new Date).getTime()-this.goToStartTime),this.goToStartTime=0):this._handleScrollMetrics(),b.metrics.endTimer("scroll")},onPageChange:function(a){b.PagelabelWidget.update();b.BookmarksActions.update();b.currentSearch.numResults>0&&(a=c.inArray(a,b.currentSearch.resultPageNumbers),b.SearchWidget.select(a),b.SearchWidget.adjustScrollBar(a),b.currentSearch.numDisplayedResults-a<=2&&b.SearchActions.fetchMoreResults())},scrollToPageTop:function(a,
e){var d=b.pageSequence,f=d.getPageDisplayIndex(a),g=d.displayScroll[f].top;e>0&&f-1>0&&d.getDisplayElement(f-1).type==2?g=d.getDisplayElement(f-1).top:e<0&&f+1<d.getScrollLength()&&d.getDisplayElement(f+1).type==2&&(g=c("#sitbReaderPageContainer").height(),g=d.getDisplayElement(f+1).top-g+d.getDisplayElement(f+1).height);c("#sitbReaderPageContainer").scrollTop()!=g&&c("#sitbReaderPageContainer").scrollTop(g)},redraw:function(){var a=b.pageSequence,e=-1,d=-1;if(b.currentBook.isImage()){if(a.currentPage){e=
a.getDisplayElement(a.getPageDisplayIndex(a.currentPage));if(l(e))return;e=(e.top-c("#sitbReaderPageContainer").scrollTop())/e.height}var f=this._createDisplayElements(b.currentBook,a.currentPage);a.currentPage&&f&&(d=Math.round(f.top-f.height*e));this.showDisplayElementByScroll(!1,d);d!=-1&&c("#sitbReaderPageContainer").scrollTop(d)}typeof c("#sitbReaderPageScroll").height=="function"&&typeof c("#sitbReaderPageScroll").height(b.pageSequence.scrollHeight).width=="function"&&c("#sitbReaderPageScroll").height(b.pageSequence.scrollHeight).width(b.ZoomModel.getPageWidth());
b.ReaderWidget.updateOnResize();this.redrawCallback!==void 0&&this.redrawCallback.call()},_handleScrollMetrics:function(){var a=c("#sitbReaderPageContainer").scrollTop(),e=c("#sitbReaderPageContainer").height(),e=Math.abs(a-this.lastTop)/e;this.lastTop=a;b.metrics.count("scroll_"+(e>3?"large":e>0.75?"medium":"small"))},requestRedraw:function(){if(!this.deferredRedraw)this.deferredRedraw=setTimeout("SitbReader.PageSequenceWidget.deferredRedraw = false; SitbReader.PageSequenceWidget.redraw()",this.redrawTimer)},
_createKPSDisplayElements:function(a,c){var d=b.pageSequence;d.emptyScroll();var f=a.pages,g=a.numPages,j=null,l;a.bookmarks.getFirstAndLastPageNumberByName(h("FIRST_PAGES"));var m=q?8:10,n;for(n=1;n<=g;n++)if(!f[n].isX()&&!f[n].isY())c&&c<n&&j==null&&(j=l),l=f[n].getScaledDimensions().height,l=new b.DisplayElement(d.scrollHeight,l,1,n),d.pushDisplayElement(l),d.scrollHeight+=l.height+m,c==n&&(j=l);return j}};b.PagelabelWidget={update:function(){var a=c("#sitbReaderPageLabel"),e=a.css("display")==
"block";b.currentBook.pageLabels.hasLabels&&!e?a.show():!b.currentBook.pageLabels.hasLabels&&e&&a.hide();e&&(e=c("#sitbReaderBottomButton").width(),a.html(b.currentBook.pageLabels.getLabel(b.pageSequence.currentPage)),a=e/2-a.width()/2,c("#sitbReaderPageLabel")&&c("#sitbReaderPageLabel").css("left",a))}};ba.prototype=new pa;ba.prototype.constructor=ba;S.prototype=new pa;S.prototype.constructor=S;S.prototype.initialize=function(a){a.modeTabs.print.tabObject=c(a.modeTabs.print.oid);a.modeTabs.kindle.tabObject=
c(a.modeTabs.kindle.oid);a._resetTabs();a._updateTabs()};b.ModeSwitchWidget={modeTabs:{print:{oid:"#readerModeTabPrint",tabObject:void 0},kindle:{oid:"#readerModeTabKindle",tabObject:void 0}},customizedWidget:new S,load:function(){c(".readerModeTab, .readerModeTab div.readerModeTabBorder").each(function(){c(this).css("background-image","url("+s+")")});this.customizedWidget.initialize(this)},_resetTabs:function(){this.modeTabs.print.tabObject.unbind("click").removeClass("activeReaderModeTab").removeClass("deactivatedReaderModeTab");
this.modeTabs.kindle.tabObject.unbind("click").removeClass("activeReaderModeTab").removeClass("deactivatedReaderModeTab")},_updateTabs:function(){var a=this.modeTabs.print.tabObject,c=this.modeTabs.kindle.tabObject,d=b.currentBook,f=b.ModeSwitchActions,g=d.buyingAsin;d.isPrint()?(a.addClass("activeReaderModeTab"),!d.hasKindleAsin()&&!f.hasPath(g)||d.originalAsin?c.addClass("deactivatedReaderModeTab"):c.unbind("click").click(function(){f.switchMode(f.hasPath(g)?f.getPath(g):d.kindleAsin,2)}),b.kindleRenderer&&
b.kindleRenderer.isMobi8FixedFormat&&b.kindleRenderer.isMobi8FixedFormat()&&b.ZoomWidget.show()):(c.addClass("activeReaderModeTab"),!d.hasPrintAsin()&&!f.hasPath(g)||d.originalAsin?a.addClass("deactivatedReaderModeTab"):a.unbind("click").click(function(){f.switchMode(f.hasPath(g)?f.getPath(g):d.sitbAsin,1)}),b.kindleRenderer&&b.kindleRenderer.isMobi8FixedFormat&&b.kindleRenderer.isMobi8FixedFormat()&&(b.ZoomWidget.disableZoomIn(),b.ZoomWidget.disableZoomOut()))}};b.BottomButtonWidget={BOTTOM_BUTTON_INVISIBLE_OPACITY:0.01,
BOTTOM_BUTTON_HOVER_OPACITY:0.9,jQBottomButtonId:"#sitbReaderBottomButton",load:function(){this.jQBottomButton=c(this.jQBottomButtonId);this.jQBottomButton.unbind("mouseover").unbind("click").unbind("mouseout").bind("mouseover",function(){b.BottomButtonWidget.jQBottomButton.fadeTo(250,b.BottomButtonWidget.BOTTOM_BUTTON_HOVER_OPACITY)}).bind("mouseout",function(){b.BottomButtonWidget.jQBottomButton.fadeTo(1E3,b.BottomButtonWidget.BOTTOM_BUTTON_INVISIBLE_OPACITY)}).css("background","url("+s+") repeat-x 0px -489px").click(b.BottomButtonActions.moveNextPage);
c(".readerBottomButton").each(function(){c(this).css("background","url("+L+") no-repeat 0px -3584px")})},show:function(){this.handleResize();setTimeout(function(){b.BottomButtonWidget.jQBottomButton.fadeTo(1E3,b.BottomButtonWidget.BOTTOM_BUTTON_INVISIBLE_OPACITY)},1E3)},handleResize:function(){var a=c("#sitbReaderPageContainer"),e=-8;a[0].scrollWidth>a.width()&&(e+=u);this.jQBottomButton.css({width:Math.max(0,a.innerWidth()-u),left:b.LeftPaneWidget.getWidth(),bottom:e});b.PagelabelWidget.update()},
setEnabled:function(a){this.jQBottomButton.unbind("click");a&&this.jQBottomButton.click(b.BottomButtonActions.moveNextPage)}};b.KindleContentWidget=function(){this.jQPartialDiv=this.jQContentHolder=void 0;this.hasContent=!1;this.height=this.top=0;this.type=3;this.pageNumber=1;this.pagePadding=120;b.KindleContentWidget._imageCount=0;b.KindleContentWidget._srlOffsetTop=0;b.KindleContentWidget._imagesPreSRL=0;b.KindleContentWidget._adjustmentMutex=0;b.KindleContentWidget._visibleWidget=void 0};b.KindleContentWidget.prototype.setOnPartialDiv=
function(a){this.jQPartialDiv=c("#scrollElm-"+a);c("#sitbReaderPageScroll");this.resize(!1);b.KindleContentActions.initialize(this)};b.KindleContentWidget.prototype.updateContent=function(a){this.hasContent=!0;b.kindleRenderer&&b.kindleRenderer.isMobi8FixedFormat&&b.kindleRenderer.isMobi8FixedFormat()?c("#scrollElm-0").append(!q?a.cloneNode(!0):a.firstChild.cloneNode(!0)):this.jQPartialDiv.append(!q?a.cloneNode(!0):a.firstChild.cloneNode(!0));this.jQContentHolder=c("#sitbReaderKindleSample");b.KindleContentWidget._visibleWidget=
this;b.kindleRenderer.updateContent();this.resize(!1);b.KindleContentWidget._imagesPreSRL==0&&b.KindleContentWidget._showSample();if(!b.KindleContentActions._contentCache[b.currentBook.asin].loaded)b.KindleContentActions._contentCache[b.currentBook.asin].loaded=!0,$("cf",b.LightboxActions.requestId),b.metrics.endTimer("load_html_sample");b.KindleContentActions.registerEvents()};b.KindleContentWidget.prototype.resize=function(a){var e=c("#sitbReaderPageContainer"),d=c("#sitbReaderPageScroll"),f=b.ZoomModel,
g=f.getPageWidth()+"px",h=f.getPageWidth()-this.pagePadding+"px";d.css("width",g);this.jQPartialDiv.css("width",g);this.jQContentHolder&&(b.kindleRenderer&&b.kindleRenderer.adjustHeight&&b.currentBook.isMobi8FixedFormat()?this.jQContentHolder.css("width","100%"):this.jQContentHolder.css("width",h));this.hasContent?b.KindleContentWidget._adjustHeight(a):(this.jQPartialDiv.addClass("pageHtml").addClass("loadingLarge").css({height:e.height()+"px","font-size":f.getFontSize()+"px"}),d.css("height",e.height()+
"px"))};b.KindleContentWidget._handleImage=function(a){var e=c(this);e.unbind("load").unbind("error");e.data("realPicWidth",this.width);a.type=="error"&&e.hide();e.position().top<b.KindleContentWidget._srlOffsetTop&&b.KindleContentWidget._imagesPreSRL--;b.KindleContentWidget._imageCount--;(b.KindleContentWidget._imagesPreSRL==0||b.KindleContentWidget._imageCount==0)&&b.KindleContentWidget._showSample();b.KindleContentWidget._imageCount==0&&b.KindleContentWidget._adjustHeight(!1)};b.KindleContentWidget._showSample=
function(){b.KindleContentWidget._imagesPreSRL=void 0;b.KindleContentWidget._adjustHeight(!1);b.KindleContentActions.goToLRL();b.KindleContentWidget._visibleWidget.jQPartialDiv.removeClass("loadingLarge");b.KindleContentWidget._visibleWidget.jQContentHolder.css("visibility","visible")};b.KindleContentWidget._adjustHeight=function(a){if(b.KindleContentWidget._adjustmentMutex==1)b.KindleContentWidget._adjustmentMutex=2;else if(b.KindleContentWidget._adjustmentMutex>1)return;b.KindleContentWidget._adjustmentMutex=
1;var e=c("#sitbReaderPageContainer"),d=c("#sitbReaderKindleSample"),f=c("#sitbReaderEndOfSample",d);if(!(f.length==0||l(f))){if(a)for(var a=0,g=null;!g&&a<=100;){var h=c("#sitbLightbox").offset(),g=h.left+d.offset().left+100,h=Math.max(0,h.top-c(document).scrollTop())+c("#sitbLBHeader").height()+a;(g=document.elementFromPoint(g,h))&&g.className.match("sitb-")!="sitb-"&&g.nodeName.match("^H")!="H"&&g.id.match("^amazon")!="amazon"&&(g=null);a+=10}d=b.kindleRenderer.adjustHeight(d,f);b.pageSequence.scrollHeight=
d;b.ReaderActions.setPanning();b.ReaderWidget.updatePageTurnersState();b.BottomButtonWidget.handleResize();g&&e.scrollTop(c(g).position().top);b.KindleContentWidget._adjustmentMutex--;b.KindleContentWidget._adjustmentMutex==2&&b.KindleContentWidget._adjustHeight(!1)}};b.KindleContentWidget.prototype.visibleCompare=function(a,b){var c=this.top+this.height;return a<=this.top&&this.top<=b||c>=a&&c<b||c>=b&&this.top<=a?0:this.top>b?-1:1};b.KindleContentWidget.prototype.getViewportPercentage=function(a,
b){var c=b-a,f=this.top+this.height;return this.top>b||f<a?0:this.top<=a&&f>=a&&f<=b?(f-a)/c:this.top<=b&&this.top>=a&&f>=b?(b-this.top)/c:this.top<=a&&f>=b?1:this.top>=a&&f<=b?this.height/c:0};b.CustomerRequestWidget={load:function(){if(b.currentBook.shouldShowTellThePublisher()&&b.currentBook.isPrint()&&!b.ModeSwitchActions.hasPath(b.currentBook.buyingAsin)){var a=c("#readerModeTabKindle");a.bind("mouseover",function(){b.CustomerRequestWidget.show()});a.bind("mouseout",function(){b.CustomerRequestWidget.hide()});
a=this._getContent();c("#sitbReaderCustomerRequestContent").html(a);c("#sitbReaderCustomerRequestLink").bind("click",function(){b.CustomerRequestActions.sendRequest()})}},show:function(){c("#sitbReaderCustomerRequestContainer").show()},hide:function(){c("#sitbReaderCustomerRequestContainer").hide()},_getContent:function(){return h("SEND_CUSTOMER_REQUEST")}};b.LODActions={_bookdataCache:[],_cacheIndex:0,_currentRequests:{},_openFor:{},open:function(a,c){b.LODActions.lightBoxOpenMethod=function(){b.LightboxActions._openReader(c)};
b.LODActions.loadBookData(a)},openToRandom:function(a,c){b.LODActions.lightBoxOpenMethod=function(){b.LightboxActions._openReaderToRandomPage(c)};b.LODActions.loadBookData(a)},openToQuery:function(a,c,d){b.LODActions.lightBoxOpenMethod=function(){b.LightboxActions._openReaderToSearchResults(c,d)};b.LODActions.loadBookData(a)},openToPage:function(a,c,d,f){b.LODActions.lightBoxOpenMethod=function(){b.LightboxActions._openReaderToPage(c,d,f)};b.LODActions.loadBookData(a)},loadBookData:function(a){window.ue&&
(uet("tc","sitbReader"),ues("t0","sitbReader",new Date),window.sitbLodStart||ues("ctb","sitbReader","1"));b.sitbReaderOpenStart=(new Date).getTime();c("body").css("overflow","hidden");b.LightboxWidget.dimTheLights();var e=this._getFromCache(a);if(b.currentBook&&b.currentBook.buyingAsin==a)b.LODActions.lightBoxOpenMethod();else if(e)this.callback(e);else if(b.LODActions._currentRequests[a])b.LODActions._openFor[a]=!0;else{b.LODActions._currentRequests[a]=!0;e={method:"getBookData",asin:a};if(window.sitbMainRequestId)e.requestId=
window.sitbMainRequestId;v(e,function(c){delete b.LODActions._currentRequests[a];b.LODActions.callback(c)},function(c,e,g){delete b.LODActions._currentRequests[a];b.LODActions.errorCallback(c,e,g)})}},cache:function(a){!b.LODActions._getFromCache(a)&&!b.LODActions._currentRequests[a]&&(b.LODActions._currentRequests[a]=!0,v({method:"getBookData",asin:a},function(c){delete b.LODActions._currentRequests[a];b.LODActions.cacheCallback(c,a)},function(){b.LODActions._openFor[a]&&(delete b.LODActions._currentRequests[a],
b.LODActions.errorCallback())}))},callback:function(a){typeof a.error!="undefined"?(c("#vellumMsgTxt").html(H(a.error.text)),c("#vellumMsgHdr").html(H(a.error.title)),N(c("#vellumMsg")).show(),(new Image).src="/gp/search-inside/reftag/ref="+a.error.reftag):(b.LODActions.cacheAndInitialize(a),b.LODActions.lightBoxOpenMethod())},cacheCallback:function(a,c){b.LODActions._openFor[c]?b.LODActions.callback(a):typeof a.error=="undefined"&&b.LODActions.cacheAndInitialize(a)},cacheAndInitialize:function(a){b.LightboxActions.requestId=
a.requestId;b.LODActions._putInCache(a.buyingAsin,a);b.LightboxActions.initialize(a)},errorCallback:function(){c("#vellumMsgTxt").html(h("INFORMATION_UNAVAILABLE"));c("#vellumMsgHdr").html(h("SERVER_TIMEOUT"));N(c("#vellumMsg")).show();(new Image).src="/gp/search-inside/reftag/ref=rdr_bar_jsto";b.RefTag.httpGet(b.RefTag.getFormatedRefTag(b.RefTag.Actions.timeout,b.RefTag.Timeout.readerOpen))},_putInCache:function(a,b){this._getFromCache(a)||(this._bookdataCache[this._cacheIndex++%3]=b)},_getFromCache:function(a){for(var b=
0;b<this._bookdataCache.length;b++)if(this._bookdataCache[b]&&this._bookdataCache[b].buyingAsin==a)return this._bookdataCache[b];return null},lodMethod:Vellum.mt,lodArguments:Vellum.rg};Vellum={c:b.LODActions.cache,o:b.LODActions.open,r:b.LODActions.openToRandom,q:b.LODActions.openToQuery,p:b.LODActions.openToPage,h:function(){c("#vellumMsg").hide();c("#vellumShade").hide();c("#vellumLdgIco").hide();c("body").css("overflow","auto");b.LightboxActions.back(b.RefTag.ExitMethod.exterior,!0)},x:function(){},
pl:function(){},ao:Vellum.ao,asin:Vellum.asin,detailPageType:Vellum.detailPageType,onReaderOpen:Vellum.onReaderOpen};b.LODActions.lodMethod&&Vellum[b.LODActions.lodMethod].apply(b.LODActions,b.LODActions.lodArguments);if(b!=null)b.jQuery=c;return b};
