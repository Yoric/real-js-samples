(function(m){var e=window.AmazonUIPageJS||window.P,r=e._namespace||e.attributeErrors,d=r?r("PageRefreshAsset",""):e;d.guardFatal?d.guardFatal(m)(d,window):d.execute(function(){m(d,window)})})(function(m,e,r){m.when("A","page-refresh-state","web-ajax-utility","alt-page-refresh-measurement","state-aware-feature-consolidator","page-refresh-utils").register("page-refresh-handler",function(d,g,h,b,c,f){var a={},k=d.$,p={},t="",m,l=function(a,g,e,l,r){var n=this;n.clientId=a;n.clientName=g.toLowerCase();
n.doPageRefresh=function(b,f,g){var l,q;q="";l=b["Non-Persistent"];l.hasOwnProperty("triggerEvent")&&(q=l.triggerEvent);if(void 0!==q&&""!==q&&" "!==q){l=c.getStateAwareParameters();p=k.extend(!0,p,b.Persistent);u();q=d.copy(t);k.extend(!0,q,p,b["Non-Persistent"],l);b=e;l=d.contains(b,"?");b+=l?"\x26":"?";q=v(q);for(var m in q)if(null!=q[m]){l=q[m];var n=b.slice(-1);b+="?"===n||"\x26"===n?"":"\x26";b+=m+"\x3d"+l}h.getInstance(a,b,f,g,r).getContent()}else throw"triggerEvent parameter missing or invalid";
};n.addParams=function(a){p=k.extend(!0,p,a);return!0};n.removeParams=function(a){d.each(a,function(a,b){delete p[a];delete t[a]});return!0};n.createCustomParamsMap=function(a,b){var c={Persistent:{},"Non-Persistent":{}};k.each(a,function(a,b){c.Persistent[a]=b});k.each(b,function(a,b){c["Non-Persistent"][a]=b});return c};n.startMeasurement=function(a,b,c,k){this.pageRefreshMeasurement&&this.pageRefreshMeasurement.start(a,b,c,k)};n.stampImageLoad=function(a){this.pageRefreshMeasurement&&this.pageRefreshMeasurement.stampImageLoad(a)};
n.stampFeature=function(a,b){this.pageRefreshMeasurement&&this.pageRefreshMeasurement.stampFeature(a,b)};n.fadeInFeatures=function(a){"undefined"!==typeof a&&a.length||(a=m[n.clientName]);f.fadeInFeatures(a)};var u=function(){k.each(t,function(a,b){p.hasOwnProperty(a)&&(t[a]=p[a])})},v=function(a){var b={},c=Object.keys(a);c.sort();k.each(c,function(c,k){b[k]=a[k]});return b};(function(){if(l){var a=l.config;n.pageRefreshMeasurement=new b(k,a.atf.marker,a.cf.marker);n.pageRefreshMeasurement.init(l.storeID,
l.productGroupID,l.triggerEvent)}})()};(function(){var a=g.fetchPageRefreshData();t=a.pageRefreshUrlParams;m=a.divToUpdateData})();return{getHandlerInstance:function(b,c,k,f){(null==b||""===b)&&e.ueLogError&&e.ueLogError({message:"Invalid ClientId"},{logLevel:"FATAL",attribution:"PageRefreshAPI",message:"Invalid ClientId passed to getHandlerInstance of dpRefreshHandler"});a[b]||(a[b]=new l(b,c,k,f));return a[b]},getPersistentParams:function(){return p}}});"use strict";m.when("A","page-refresh-handler").register("dp-refresh-handler",
function(d,g){function h(b,c,f,a){this.featureTriggeringRefresh=b.featureName;this.deviceTypeStateData=d.state("detail-page-device-type");"undefined"===typeof this.deviceTypeStateData&&(this.deviceTypeStateData=d.state("page-refresh-device-type"));this.deviceType=this.deviceTypeStateData&&this.deviceTypeStateData.deviceType?this.deviceTypeStateData.deviceType:"web";this.pageRefreshUrl=f&&f.pageRefreshUrl?f.pageRefreshUrl:"/gp/page/refresh";this.clientId="PageRefresh_"+this.deviceType+"_"+this.featureTriggeringRefresh+
"_Client";this.DPRefreshHandler=g.getHandlerInstance(this.clientId,this.featureTriggeringRefresh,this.pageRefreshUrl,c,a)}h.prototype={doPageRefresh:function(b,c,f){try{this.DPRefreshHandler.doPageRefresh(b,c,f)}catch(a){e.ueLogError&&e.ueLogError(a,{logLevel:"ERROR",attribution:this.featureTriggeringRefresh,message:"This error is caused by the doPageRefresh method triggered by - "+this.featureTriggeringRefresh+": "+a})}},createCustomParamsMap:function(b,c){var f={};try{f=this.DPRefreshHandler.createCustomParamsMap(b,
c)}catch(a){e.ueLogError&&e.ueLogError(a,{logLevel:"ERROR",attribution:this.featureTriggeringRefresh,message:"This error is caused by the createCustomParamsMap method triggered by - "+this.featureTriggeringRefresh+": "+a})}return f},addParams:function(b){return b&&"object"==typeof b?this.DPRefreshHandler.addParams(b):!1},removeParams:function(b){return b&&"object"==typeof b?this.DPRefreshHandler.removeParams(b):!1},startMeasurement:function(b,c,f,a){try{this.DPRefreshHandler.startMeasurement(b,c,
f,a)}catch(k){e.ueLogError&&e.ueLogError(k,{logLevel:"ERROR",attribution:this.featureTriggeringRefresh,message:"This error is caused by the startMeasurement method triggered by - "+this.featureTriggeringRefresh+": "+k})}},stampImageLoad:function(b){try{this.DPRefreshHandler.stampImageLoad(b)}catch(c){e.ueLogError&&e.ueLogError(c,{logLevel:"ERROR",attribution:this.featureTriggeringRefresh,message:"This error is caused by the startMeasurement method triggered by - "+this.featureTriggeringRefresh+": "+
c})}},stampFeature:function(b,c){try{this.DPRefreshHandler.stampFeature(b,c)}catch(f){e.ueLogError&&e.ueLogError(f,{logLevel:"ERROR",attribution:this.featureTriggeringRefresh,message:"This error is caused by the startMeasurement method triggered by - "+this.featureTriggeringRefresh+": "+f})}},fadeInFeatures:function(b){try{this.DPRefreshHandler.fadeInFeatures(b)}catch(c){e.ueLogError&&e.ueLogError(c,{logLevel:"ERROR",attribution:this.featureTriggeringRefresh,message:"This error is caused by the fadeInFeatures method triggered by - "+
this.featureTriggeringRefresh+": "+c})}}};return h});m.when("A","jQuery").register("alt-page-refresh-ajax-scope",function(d,g){return function(g,b,c){this.scopeName=b;this.url=c;ues("t0",b,e.newTwisterInteractionStartTime);ues("ctb",b,"1");this.signalMarker=function(a){!this.markers[a]||0>=this.markers[a].conditions||0===--this.markers[a].conditions&&"function"==typeof this.markers[a].handler&&this.markers[a].handler()};this.addlongPoleTag=function(a,b){a=a.toLowerCase();this.markers[a]&&0==this.markers[a].conditions&&
0==this.markers[a].conditions&&e.ue&&"function"===typeof ue.tag&&ue.tag(b)};this.postData=function(){var a=this.scopeName;g.ajax({url:this.url,dataType:"text",timeout:4E4,error:function(){},success:function(b,c,f){ues("id",a,b);uex("ld",a)}})};var f=this;this.markers={image:{conditions:1,handler:function(){uet("ne",b);f.signalMarker("af")}},af:{conditions:Twister.atfMarkerCount?Twister.atfMarkerCount:2,handler:function(){d.trigger("PageRefresh:ATF");uet("af",b);uet("cf",b);f.signalMarker("cf")}},
cf:{conditions:Twister.cfMarkerCount?Twister.cfMarkerCount:2,handler:function(){d.trigger("PageRefresh:CF");uet("cf",b);f.postData()}}}}});m.when("A","jQuery","alt-page-refresh-ajax-scope").register("alt-page-refresh-measurement",function(d,g,h){return function(b,c,f){this.atfMarker=c;this.cfMarker=f;this.scopeCount={};this.ajaxScopes={};this.url="";this.init=function(a,b,c){this.url="/gp/twister/dynamic-update/ajax-measurement.html/?s\x3d"+a+"\x26pgid\x3d"+b+"\x26deviceType\x3d"+Twister.deviceType+
"\x26triggerEvent\x3d"+c;Twister.isInstaTwisterEnabled&&(this.url+="\x26ptd\x3d"+Twister.productTypeName)};this.start=function(a,c,f,d){if(e.ue){this.scopeCount[a]||(this.scopeCount[a]=0);var g=a+(this.scopeCount[a]+1);this.scopeCount[a]++;var l=this.url;c&&(l+="\x26dimensionType\x3d"+c);"undefined"!==typeof f&&(l+="\x26dimensionCount\x3d"+f);"undefined"!==typeof d&&(l+="\x26dimensionsDisplayType\x3d"+d);this.ajaxScopes[a]=new h(b,g,l)}};this.stampImageLoad=function(a){this.ajaxScopes[a]&&(this.ajaxScopes[a].signalMarker("image"),
Twister.cfImageLongPollTag&&this.ajaxScopes[a].addlongPoleTag("cf",Twister.cfImageLongPollTag))};this.stampFeature=function(a,b){this.ajaxScopes[b]&&(a===this.atfMarker&&this.ajaxScopes[b].signalMarker("af"),a===this.cfMarker&&(this.ajaxScopes[b].signalMarker("cf"),Twister.cfHtmlLongPollTag&&this.ajaxScopes[b].addlongPoleTag("cf",Twister.cfHtmlLongPollTag)))};this.stampCustomMetrics=function(a,b){this.ajaxScopes[b]&&uet(a,this.ajaxScopes[b].scopeName)}}});m.when("A","ready","page-refresh-js-init-dpx-data",
"page-refresh-js-init-mason-data").register("page-refresh-state",function(d,g,h,b){function c(){var a=f.extend(!0,{},h.divToUpdateData,b.divToUpdateData),c={};d.each(a,function(a,b){c[b]=[];d.each(a,function(a){(a=a.divToUpdate)&&c[b].push(a)})});return c}var f=d.$,a=d.state("page-refresh-data-mason"),k=d.state("page-refresh-data-dpx"),p=d.state("detail-page-device-type"),e={};"undefined"===typeof p&&(p=d.state("page-refresh-device-type"));return{fetchPageRefreshData:function(){var b=a&&a.pageRefreshUrlParams?
a.pageRefreshUrlParams:{},d=k&&k.pageRefreshUrlParams?k.pageRefreshUrlParams:{};e.pageRefreshUrlParams={};f.extend(!0,e.pageRefreshUrlParams,b,d);"undefined"!==typeof p&&(e.deviceType=p.deviceType);e.divToUpdateData=c();return e}}});m.when("A","jQuery","page-refresh-utils","cache").register("web-ajax-utility",function(d,g,h,b){function c(a,b,c,f,d){this.scope=a;this.url=b;this.options=c;this.useCustomRefreshBehavior=d;this.status=0;this.selected=!1;this.error=this.successData=this.xhr=this._status=
void 0;this.chunks=[];this.doNotAbort=f||!1}var f=new b;c._objects={};c.prototype._initializeChunks=function(){var a=!1;f.exists(this.url)&&(a=!0,this.chunks=f.get(this.url));return a};c.prototype._callback=function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);"function"===typeof a&&a.apply(self,b)};c.prototype._canAbort=function(){return!this.doNotAbort&&1===this.status};c.prototype._isAborted=function(){return 3===this.status};c.prototype._getUrl=function(){return this.url};c.prototype._abort=
function(){if(1===this.status)try{this.ajaxRequestRefence.abort(),this.status=3}catch(b){var a={message:"Could not abort ajax request. "};"string"===typeof b&&(a.message+=b,b=void 0);a.logLevel="FATAL";e.ueLogError&&e.ueLogError(b,a)}};c.prototype._flushChunkData=function(){var a=this;a.chunks.length&&g.map(a.chunks,function(b){a.useCustomRefreshBehavior||h.refreshFeature(b);a._callback(a.options.chunk,b)})};c.prototype._request=function(){var a=this;a.ajaxRequestRefence=d.get(a.url,{params:a.options.params,
success:function(b,c,g){a.status=4;a.successData=b;a._status=c;a.xhr=g;f.put(a.url,a.chunks);a.chunks=[];a.selected&&(a.useCustomRefreshBehavior||h.removeOverlayForAllFeatures(),a._callback(a.options.success,b,c,g));d.trigger("PageRefresh:Success")},error:function(b,c,f){a.status=2;a.xhr=b;a._status=c;a.error=f;a.selected&&(a.useCustomRefreshBehavior||h.removeOverlayForAllFeatures(),a._callback(a.options.error,b,c,f))},abort:function(b){a.status=3;a.xhr=b;a.selected&&a._callback(a.options.abort,b)},
chunk:function(b){b&&(a.chunks.push(b),a.selected&&(a.useCustomRefreshBehavior||h.refreshFeature(b),a._callback(a.options.chunk,b)))},timeout:a.options.timeout||4E4})};c.prototype.getContent=function(){c._abortRequestsExcept(this);this.selected=!0;var a=this._initializeChunks();a&&(this.status=4);0===this.status?(this.status=1,this._request()):1===this.status?this._flushChunkData():4===this.status&&(a?(this._flushChunkData(),this.useCustomRefreshBehavior||h.removeOverlayForAllFeatures(),this._callback(this.options.success,
this.successData,this._status,this.xhr),d.trigger("a:pageUpdate"),d.trigger("PageRefresh:Success")):(this.status=1,this._request()))};c._abortRequestsExcept=function(a){g.each(c._objects[a.scope],function(b,c){c._canAbort()&&b!==a._getUrl()&&c._abort()})};c.getInstance=function(a,b,f,d,g){if(!a||!b||"object"!==typeof f)throw"Incorrect parameter passed.";g=g||!1;c._objects[a]=c._objects[a]||{};var e=c._objects[a][b];e&&e._isAborted()&&(delete c._objects[a][b],e=void 0);e||(c._objects[a][b]=new c(a,
b,f,d,g,this));return c._objects[a][b]};return c});m.when("A").register("state-aware-critical-features",function(d){return function(){var d=[];this.add=function(e,b){for(var c=e.featureName,f=!1,a=0;a<d.length;a++)if(d[a].featureName===c){f=!0;break}if(f)throw"Critical Feature "+e.featureName+" already registered for State Aware Messaging!";e={};e.featureName=c;e.callback=b;d.push(e)};this.getAllCriticalFeatures=function(){return d}}});m.when("A","state-aware-parameter-handler").register("state-aware-feature-consolidator",
function(d,e){return{getStateAwareParameters:function(){return e.getStateAwareParameters()}}});m.when("A","state-aware-critical-features","state-aware-parameters").register("state-aware-parameter-handler",function(d,g,h){return new function(){var b=new g,c=new h;this.registerCriticalFeature=function(c,a){try{if("function"===typeof a)b.add(c,a);else throw"callback needs to be a function!";}catch(d){e.ueLogError&&e.ueLogError(d,{logLevel:"ERROR",attribution:c.featureName,message:"StateAwareExceptionMessaging:- This error is caused by the feature "+
c.featureName+" while registering itself as a critical feature for State Aware Messaging. "+d})}};this.getStateAwareParameters=function(){for(var f=b.getAllCriticalFeatures(),a=0;a<f.length;a++){var d=f[a],g=d.featureName,d=d.callback.apply();try{c.putParameters(g,d)}catch(h){e.ueLogError&&e.ueLogError(h,{logLevel:"ERROR",attribution:g,message:"StateAwareMessaging:- This error is caused by the feature "+g+" while injecting state aware parameters. "+h})}}return c.getAllStateAwareParameters()}}});m.when("A").register("state-aware-parameters",
function(){return function(){var d={};this.putParameters=function(e,h){var b=!0;for(feature in d)if(d.hasOwnProperty(feature)&&e!==feature){var c=this.getParameters(feature);if(b){var b=h,f=!1;for(paramKey in b)if(b.hasOwnProperty(paramKey)&&c.hasOwnProperty(paramKey)){f=!0;break}b=!f}}if(b)for(paramKey in h)h.hasOwnProperty(paramKey)&&(c=h[paramKey],d[e]||(d[e]={}),d[e][paramKey]=c);else throw"Duplicate Parameters found for other Critical Feature!";};this.getParameters=function(e){return d[e]};this.getAllStateAwareParameters=
function(){var e={},h;for(h in d)if(d.hasOwnProperty(h)){var b=this.getParameters(h),c;for(c in b)b.hasOwnProperty(c)&&(e[c]=b[c])}return e}}});m.when("A").register("page-refresh-utils",function(d){var g=d.$,h={intermediateEOS:1,EOS:1};return{fadeInFeatures:function(b){g.each(b,function(c,a){"#"!==a[0]&&(b[c]="#"+a)});var c=b.join(",");g(c).addClass("js-feature-refresh-overlay");g(c).css("opacity",.5)},refreshFeature:function(b){var c=b.Value;b=b.FeatureName;if(!h[b]){var d,a;try{b&&c&&c.content&&
(a=c.content[b],"undefined"!==typeof a&&(d=g("#"+b),d.html(a),d.removeClass("js-feature-refresh-overlay"),d.css("opacity","")))}catch(k){c={message:"Error in feature"+(b||"NoFeatureName"),logLevel:"FATAL"},e.ueLogError&&e.ueLogError(k,c)}}},removeOverlayForAllFeatures:function(b){b=g("body").find(".js-feature-refresh-overlay");for(var c=0;c<b.length;c++){var d=b[c];g(d).removeClass("js-feature-refresh-overlay");g(d).css("opacity","")}}}})});