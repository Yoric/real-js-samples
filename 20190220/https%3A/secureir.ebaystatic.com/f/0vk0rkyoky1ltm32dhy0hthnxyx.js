var DFP=function(e,t){"use strict";DFP.TAGS_DELIMITER="&";DFP.TAGS_PARAM_DELIMITER="|";DFP.MOBILE_TAGS="mobileTags";DFP.EQUALS="=";var n=function(e,t){this.inputMid=t.mid;this.lsoVer=t.flashTagVersion;this.isUpgrade=t.flashTagUpgrade;var n={};var r={movie:t.swfURL,allowscriptaccess:"always",quality:"high",allownetworking:"external",menu:false,wmode:"transparent"};var i={id:"flash_flashkrb",name:"flash_flashkrb",width:0,height:0};var s=e;var o=$("<div></div>");o.attr("id","flashContent");if(s){s.append(o)}else{$("body").append(o)}if(!DFP.isNullOrEmpty(typeof swfobject)&&!DFP.isNullOrEmpty(swfobject.embedSWF)){swfobject.embedSWF(t.swfURL,"flashContent","1","1","9.0.28",null,n,r,i)}};n.prototype.processFlash=function(){var e=-1,t=false,n=DFP.flashDFPData;if(this.lsoVer){e=parseInt(this.lsoVer,10)}if(this.isUpgrade&&this.isUpgrade==="1"){t=true}if(this.processToken){this.processToken(this.inputMid,e,t)}if(n.kgstate&&(n.kgstate==="w"||n.kgstate==="u")){n.mid=this.inputMid}};n.prototype.getFlashObj=function(e){if(!DFP.isNullOrEmpty(typeof swfobject)&&!DFP.isNullOrEmpty(swfobject.getObjectById)){return swfobject.getObjectById(e)}};n.prototype.processToken=function(e,t,n){var r="flash_flashkrb",i,s;i=this.getFlashObj(r);try{if(i){if(e!==null&&e.length>0){if(i.processToken){i.processToken(e,t,n)}}else{if(i.getTokenValue){s=i.getTokenValue();setVariable("mid",s)}}}}catch(o){}};DFP.flashDFPData={};var r=function(e){this.dfpContext=e;r.DELIMITER="|";this.silverLightURL=t.slURL;this.tagValue=e.mid;this.silverlightDFPData={}};r.prototype.process=function(e){var t=r.isSilverLightInstalled();if(!t||DFP.isNullOrEmpty(e)||DFP.isNullOrEmpty(typeof this.silverLightURL)){return}this.loadSilverLightObject(e)};r.prototype.loadSilverLightObject=function(e){var t='<object id="kgsl" data="data:application/x-silverlight-2," type="application/x-silverlight-2" width="0" height="0" tabindex="-1">'+'<param name="source" value="'+this.silverLightURL+'" />'+'<param name="onLoad" value="readWriteSLTagCB"/>'+'<param name="enableHtmlAccess" value="true" />'+'<param name="onError" value="onSLLoadError"/>'+'<param name="background" value="Transparent"/>'+'<param name="windowless" value="true"/>'+'<param name="minRuntimeVersion" value="4.0.50826.0" />'+'<param name="autoUpgrade" value="false" />'+'<param name="allowFullScreen" value="true" />'+"<div></div>"+"</object>";$(e).append(t)};r.prototype.getSLTag=function(){var e=r.getSilverLightData(r.DEVICE_TAG_KEY);var t={};if(!DFP.isNullOrEmpty(e)){var n=this.tagValue===e,i="";if(e){i=encodeURIComponent(e)}t.sl=i;t.slnew=n}return t};r.DEVICE_TAG_KEY="kgv";r.isSilverLightInstalled=function(){var e=false;try{try{new ActiveXObject("AgControl.AgControl");e=true}catch(t){if(navigator.plugins["Silverlight Plug-In"]){e=true}}}catch(t){e=false}return e};r.getSLElementContent=function(){var e=document.getElementById("kgsl");try{if(e){return e.Content.mySLapp}}catch(t){}};r.getSilverLightData=function(){var e=null,t;try{t=r.getSLElementContent();if(t){e=t.getSilverLightTag()}}catch(n){}return e};r.setSilverLightData=function(e,t){var n=r.getSLElementContent();if(n){try{n.setSilverLightTag(e,t)}catch(i){}}};DFP.DFPSilverLight={getSLElementContent:r.getSLElementContent,setSilverLightData:r.setSilverLightData,DEVICE_TAG_KEY:r.DEVICE_TAG_KEY,getSilverLightData:r.getSilverLightData,slTagValue:t.mid};var i=function(e,t){this.tmxSrcURI=e;this.tmxSessionId=t};i.prototype.initTmxHandler=function(){var e=this;if(DFP.isNullOrEmpty(e.tmxSrcURI)){e.tmxSessionId="";return}setTimeout(function(){var t=$("Body");if(t){t.append("<iframe src="+e.tmxSrcURI+' style="display:none" height="0" width=0 tabindex="-1"></iframe>')}},1)};var s=function(e){s.HTML5_TAG_KEY="kgv";s.DELIMITER="|";this.newTagValue=e;this.storageMediaPresent={};this.html5TagaData={};this.HTML5_GET_METHOD_LIST={getLocalStorage:this.getLocalStorage,getGlobalStorage:this.getGlobalStorage,getSessionStorage:this.getSessionStorage,getUserData:this.getUserData};this.HTML5_SET_METHOD_MAP={getLocalStorage:this.setLocalStorage,getGlobalStorage:this.setGlobalStorage,getSessionStorage:this.setSessionStorage,getUserData:this.setUserData,handleDBStorage:this.setTagToDBStorage}};s.prototype.getHTML5Tag=function(e){var t=null,n=this;$.each(this.HTML5_GET_METHOD_LIST,function(r,i){t=i(e);if(!DFP.isNullOrEmpty(t)){n.storageMediaPresent[r]=1;return false}});return t};s.prototype.setHTML5Tag=function(e,t,n){var r=this;$.each(this.HTML5_SET_METHOD_MAP,function(e,n){if(r.storageMediaPresent[e]!==1){n(s.HTML5_TAG_KEY,t)}})};s.prototype.getLocalStorage=function(e){try{if(localStorage){return localStorage.getItem(e)}}catch(t){}};s.prototype.setLocalStorage=function(e,t){try{if(localStorage){if(t!==undefined){localStorage.setItem(e,t)}}}catch(n){}};s.prototype.getSessionStorage=function(e){try{if(sessionStorage){return sessionStorage.getItem(e)}}catch(t){}};s.prototype.setSessionStorage=function(e,t){try{if(sessionStorage){if(t!==undefined){sessionStorage.setItem(e,t)}}}catch(n){}};s.prototype.getGlobalStorage=function(e){if(typeof globalStorage!="undefined"){try{return globalStorage[getHost()][e]}catch(t){}}};s.prototype.setGlobalStorage=function(e,t){if(typeof globalStorage!="undefined"){try{if(t!==undefined){globalStorage[getHost()][e]=t}}catch(n){}}};s.prototype.getUserData=function(e){try{var t=createUserElement();t.style.behavior="url(#default#userData)";t.load(e);return t.getAttribute(e)}catch(n){}};s.prototype.setUserData=function(e,t){try{var n=createUserElement();n.style.behavior="url(#default#userData)";n.setAttribute(e,t);n.save(e)}catch(r){}};s.prototype.createUserElement=function(){var e="userdataElement";var t;if(document.getElementById(e)){t=document.getElementById(e)}else{t=document.createElement("div");t.style.visibility="hidden";t.style.position="absolute";t.setAttribute("id",e);document.body.appendChild(t)}return t};s.prototype.handleDBStorage=function(e){if(!window.openDatabase){return false}if(!e){return}var t;try{var n=window.openDatabase("ebay","1.0","ebay database storage",1024*1024);n.transaction(function(n){n.executeSql("SELECT value FROM kg WHERE key=?",[s.HTML5_TAG_KEY],function(n,r){if(r.rows.item(0)){t=r.rows.item(0).value;e.handleSetTags(t)}},function(t,n){e.handleSetTags(null)})})}catch(r){e.handleSetTags(null)}return true};s.prototype.getHost=function(){return window.location.host.replace("www.","")};s.prototype.setTagToDBStorage=function(e,t){try{if(window.openDatabase){var n=window.openDatabase("ebay","1.0","ebay database storage",1024*1024);n.transaction(function(n){n.executeSql("CREATE TABLE IF NOT EXISTS kg ("+"id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, "+"key TEXT NOT NULL, "+"value TEXT NOT NULL, "+"UNIQUE (key)"+")",[],function(e,t){},function(e,t){});n.executeSql("INSERT OR REPLACE INTO kg(key, value) "+"VALUES(?, ?)",[e,t],function(e,t){},function(e,t){})})}}catch(r){}};s.prototype.handleSetTags=function(e){var t=false,n=e;if(DFP.isNullOrEmpty(e)){t=true;n=this.newTagValue}else{this.storageMediaPresent.handleDBStorage=1}this.setHTML5Tag(s.HTML5_TAG_KEY,n,t)};s.prototype.process=function(){var e,t=true;e=this.getHTML5Tag(s.HTML5_TAG_KEY);if(DFP.isNullOrEmpty(e)){t=this.handleDBStorage(this);if(t===false){e=this.newTagValue}else{return}}this.setHTML5Tag(s.HTML5_TAG_KEY,e)};s.prototype.getTag=function(){var e=this.getHTML5Tag(s.HTML5_TAG_KEY),t={};t.ht5=encodeURIComponent(e);t.ht5new=e===this.newTagValue;return t};var o=function(t,o){t.parentEle=e;t.oContextObj=o;if(o&&o.mobileTags&&!$.isEmptyObject($.parseJSON(o.mobileTags))){return}if(o.enableFlashTagging==="true"){setTimeout(function(){t.oDfpFlash=new n(t.parentEle,o)},1)}if(o.enableSLTagging==="true"){setTimeout(function(){t.oDFPSL=new r(o);t.oDFPSL.process(t.parentEle)},1)}if(o.enableTMXTagging==="true"){setTimeout(function(){t.oDFPTMXHandler=new i(o.tmxDfpUrl,o.tmxSessionId);t.oDFPTMXHandler.initTmxHandler()},1)}if(o.enableHTML5Tagging==="true"){setTimeout(function(){t.oHtmlStorageHandlerObj=new s(o.mid);t.oHtmlStorageHandlerObj.process()},1)}};this.getAggregateResult=function(e){var t="";$.each(e,function(n,r){var i=u(e[n]);if(DFP.isNullOrEmpty(i)===false){t=t+DFP.TAGS_DELIMITER+i}});return t.substring(1,t.length)};var u=function(e){var t="",n=this;$.each(e,function(e,n){t=t+DFP.TAGS_PARAM_DELIMITER+e+"="+n});return t.substring(1,t.length)};o(this,t);DFP.isNullOrEmpty=function(e){if(!e||e===null||e===undefined||e==="undefined"){return true}return e.length===0};DFP.isInValidCharSet=function(e){for(var t=0;t<e.length;t++){var n=e.charCodeAt(t);if(n>=65&&n<91||n>=97&&n<123||n>=48&&n<58){continue}var r=e.charAt(t);if(r=="+"||r=="*"||r=="/"||r=="="){continue}return true}return false};return this};DFP.prototype.getFingerPrintDetails=function(){var e={},t=this.oContextObj;if(t.mobileTags&&!$.isEmptyObject($.parseJSON(t.mobileTags))){e.tagInfo=DFP.MOBILE_TAGS+DFP.EQUALS+encodeURIComponent(t.mobileTags)}else{if(t.enableFlashTagging==="true"){this.oDfpFlash.processFlash();e.flash=DFP.flashDFPData}if(t.enableSLTagging==="true"){e.SilverLight=this.oDFPSL.getSLTag()}if(t.enableHTML5Tagging==="true"){e.html5=this.oHtmlStorageHandlerObj.getTag()}if(t.enableTMXTagging==="true"){e.usid={usid:this.oDFPTMXHandler.tmxSessionId}}e.tagInfo=encodeURIComponent(this.getAggregateResult(e))}return e};var setVariable=function(e,t){var n=DFP.flashDFPData;if(DFP.isInValidCharSet(t)){n.isTagDataBad=true;return}n[e]=t};var flashAlert=function(e){};var onSLLoadError=function(e,t){};var readWriteSLTagCB=function(e,t,n){var r="",i=DFP.DFPSilverLight;r=i.getSilverLightData();if(DFP.isInValidCharSet(r)){return}if(DFP.isNullOrEmpty(r)){i.setSilverLightData(i.DEVICE_TAG_KEY,i.slTagValue)}}