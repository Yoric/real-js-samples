var itemSpec=function(){var o,r,c,i,s,l=function(a,t){var i=_.map(_.pairs(a),function(a){return a.join("_")});if(1<s.length){var n=t&&[t,a[t]].join(["_"]);p(i,n)}var e=$(".cate-item").not(".disable");$.each(e,function(a,t){var n=$(t).find("a").data("catevalue");_.contains(i,n)&&$(t).addClass("cur")}),f()},u=function(a){a||(a=d());var t=_.findKey(c,a);return i[t]},f=function(){var a=!0;return $(".cate").each(function(){$(this).find(".cate-list .cur:not(.disable)").length?$(this).removeClass("needselect"):(a=!1,$(this).addClass("needselect"))}),a},d=function(){var t={};return $(".cate-item.cur").not(".disable").each(function(){var a=$(this).find("a").data("catevalue").split("_");t[a[0]]=a[1]}),t},p=function(a,t){var n,i,e,c,s,l=(n=a,i=[],e=[],c=[],s=$.map(n,function(a){return a.split("_")[0]}),_.map(n,function(a){c.push(r[a])}),i=_.uniq(_.flatten(c)),1==s.length?o&&_.each(o,function(t){t.globalId==s[0]&&_.each(t.values,function(a){e.push(t.globalId+"_"+a.globalId)})}):(e=_.reduce(c,function(a,t,n){return _.intersection(a,t)}),i=_.filter(i,function(a){return _.contains(s,a.split("_")[0])})),conCateLists=i.concat(e),_.uniq(conCateLists));$(".cate-list .cate-item").addClass("disable").removeClass("cur");var u=$(".cate-item");$.each(u,function(a,t){var n=$(t).find("a").data("catevalue");_.contains(l,n)&&$(t).removeClass("disable")})},t=function(){$(".cate-list .cate-item").on("click",function(a){$(this).hasClass("cur")||function(a){var t=d(),n=a.split("_"),i=n[0],e=n[1];t[i]=e;var c=u(t);if(c){if(_.size(t)==s.length)return location.href="/shop/item?item_id="+c}else(t={})[i]=e;l(t,i)}($(this).find("a").data("catevalue"))})};return{init:function(n){c={},_.each(n.specificationItemMap,function(a,t){c[t]=n.specificationKeys[t]}),i=n.specificationItemMap;var a=n.specificationKey;!function(a){s=_.pluck(a.spuSpecifications,"globalId");var i=_.values(c),e=[];_.map(a.spuSpecifications,function(t){var n=_.uniq(_.pluck(i,t.globalId));t.values=_.filter(t.values,function(a){return _.contains(n,a.globalId)}),_.map(n,function(a){e.push([t.globalId,a].join("_"))})}),o=a.spuSpecifications;var n=_.map(i,function(a){return _.map(_.pairs(a),function(a){return a.join("_")})});r={},_.each(e,function(t){var a=_.filter(n,function(a){return _.contains(a,t)});r[t]=_.uniq(_.flatten(a))})}(n),o&&(o&&$.each(o,function(a,n){var t=$('<div class="cate"><span class="cate-label">'+n.name+'</span><ul class="cate-list" data-catename="'+n.globalId+'"></ul></div>'),i=t.find(".cate-list");$.each(n.values,function(a,t){i.append('<li class="cate-item"><a href="javascript:;" data-catevalue="'+n.globalId+"_"+t.globalId+'">'+t.value+"</a></li>")}),i.append('<li class="cate-tips"><i class="cate-icon"></i>\u8bf7\u9009\u62e9'+n.name+"</li>"),t.appendTo("#item-cate")}),a&&l(c[a]),t())},getItemid:u}}();window.itemSpec=itemSpec;