var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__assign,Multimedia,ImageDetailSwipe;(function(n){var t;(function(){var r=ImageVisualSearchCropBox.CropBoxClientConfig,t=MmGeometry.Rectangle,u=VisualSearchCropBoxUtils.OverlayView,f=n.ImageDetailUtils.setCropBoxAnimationProperty,e=n.ImageDetailUtils.isRTL,o=n.ImageDetailUtils.calculateRegionDifference,i=ImageDetailReducers,s=function(n){function s(){var r=n.call(this)||this;return r.lastCropCoordinates=null,r.cropBoxAnimationTime=1e3,r.px="px",r.startAnimationClassName="start",r.endAnimationClassName="end",r.readyAnimationClassName="ready",r.cropboxHintShown="mm.detail.crophint",r.isHintShown=!1,r.cropBoxContentAnimationTime=1e3,r.cropBoxHintAnimationTime=3500,r.animationsRunning=!0,r.mouseButtonDown=!1,r.multiTouchMove=!1,r.containerHeight=null,r.containerWidth=null,r.hint=null,r.cropConfig=null,r.componentWillUnmount=function(){r.setSessionStorage();r.handleEventsSetting(!1)},r.setSessionStorage=function(){r.isHintShown||typeof sessionStorage=="undefined"||(sessionStorage.setItem(r.cropboxHintShown,"1"),r.isHintShown=!0)},r.getViewRect=function(){if(!r.imageElement)return null;var n=r.imageElement.clientLeft,i=r.imageElement.clientTop,u=Math.min(r.imageElement.clientWidth,r.containerWidth),f=Math.min(r.imageElement.clientHeight,r.containerHeight),e={x:n,y:i},o={x:n+u,y:i+f};return new t(e,o)},r.getCropRect=function(n){if(!r.imageElement)return null;var o=r.imageElement.clientLeft,s=r.imageElement.clientTop,i=Math.min(r.imageElement.clientWidth,r.containerWidth),u=Math.min(r.imageElement.clientHeight,r.containerHeight),f=o+Math.round(i*n.left()),e=s+Math.round(u*n.top()),h=f+Math.round(i*n.width()),c=e+Math.round(u*n.height()),l={x:f,y:e},a={x:h,y:c};return new t(l,a)},r.start=function(n){r.overlayView!=null&&(r.startCropRect=r.overlayView.cropRect().clone(),r.overlayView.setStartPoint(n))},r.move=function(n){r.overlayView!=null&&r.startCropRect!=null&&(r.overlayView.setCurrPoint(n),r.overlayView.setCropRect(r.startCropRect.clone()),r.overlayView.update(),r.updateCropBoxStyle())},r.end=function(){r.throttleCropBoxChange()},r.cropBoxChange=function(){var n=r.getCropCoordinates(),t;n==null||r.isTinyChange(r.lastCropCoordinates,n)||(t={left:n.left(),top:n.top(),right:n.right(),bottom:n.bottom()},r.props.changeCropCoordinates(t),r.lastCropCoordinates=n)},r.setCropBoxState=function(n,i){r.startCropRect=new t(n,i);r.overlayView.setCropRect(r.startCropRect);r.overlayView.setStartPoint(n);r.overlayView.setCurrPoint(n);r.overlayView.update();r.updateCropBoxStyle()},r.updateCropBoxStyle=function(){if(r.overlayView!=null){var n=r.overlayView.cropRect();r.update(n)}},r.getCropCoordinates=function(){var u,i,n,f,e;return r.overlayView!=null&&(i=r.overlayView.cropRect(),n=r.overlayView.viewRect(),n.width()>0&&n.height()>0&&(f={x:i.left()/n.width(),y:i.top()/n.height()},e={x:i.right()/n.width(),y:i.bottom()/n.height()},u=new t(f,e))),u},r.isTinyChange=function(n,t){if(r.overlayView!=null&&r.overlayView.cropRect()!=null&&r.overlayView.cropRect().width()<=r.config.minDelta&&r.overlayView.cropRect().height()<=r.config.minDelta)return!0;if(n&&t){var i=o(n.transformToRegion(),t.transformToRegion());if(i<r.config.minDelta)return!0}return!1},r.throttle=function(n,t){var i,r;return function(){clearTimeout(r);var f=this,e=arguments,u=Number(new Date);i&&u<i+t?r=setTimeout(function(){i=u;n.apply(f,e)},i+t-u):(i=u,n.apply(f,e))}},r.cancelAnimation=function(n){n&&(n.classList.remove(r.startAnimationClassName),n.classList.add(r.endAnimationClassName))},r.startAnimation=function(n){n&&(n.classList.add(r.readyAnimationClassName),r.isAnimationEnabled()&&n.classList.add(r.startAnimationClassName))},r.endAnimation=function(n,t){if(n){var i=r.cancelAnimation;r.isAnimationEnabled()?setTimeout(function(){i(n)},t):r.cancelAnimation(n)}},r.setAnimations=function(){r.startAnimation(r.cropBox);r.startAnimation(r.cropBoxContent);r.startAnimation(r.cropBoxHint);r.endAnimation(r.cropBox,r.cropBoxAnimationTime);r.endAnimation(r.cropBoxContent,r.cropBoxContentAnimationTime);r.endAnimation(r.cropBoxHint,r.cropBoxHintAnimationTime)},r.cancelAnimations=function(){r.animationsRunning&&(r.cancelAnimation(r.cropBox),r.cancelAnimation(r.cropBoxContent),r.cancelAnimation(r.cropBoxHint));r.animationsRunning=!1},r.update=function(n){r.cropBox&&n&&(e?r.cropBox.style.right=n.left()+r.px:r.cropBox.style.left=n.left()+r.px,r.cropBox.style.top=n.top()+r.px,r.cropBox.style.width=n.width()+r.px,r.cropBox.style.height=n.height()+r.px)},r.getOffsetPosition=function(n,t,i){var r=n.getBoundingClientRect(),u=t-r.left,f=i-r.top;return{x:u,y:f}},r.getTouchPosition=function(n,t){return n&&n.touches?r.getOffsetPosition(r.imageElement,n.touches[t].clientX,n.touches[t].clientY):null},r.getMousePosition=function(n){return r.getOffsetPosition(r.imageElement,n.clientX,n.clientY)},r.onTouchStart=function(n){if(n&&n.touches)r.start(r.getTouchPosition(n,0));else r.onMouseDown(n)},r.onMouseDown=function(n){if(r.isPositionWithinBoundary(r.imageElement,n.clientX,n.clientY)){r.mouseButtonDown=!0;var t=r.getMousePosition(n);r.start(t)}},r.onTouchMove=function(n){if(n&&n.touches)if(r.config.enableMultiTouchRedraw&&n.touches.length>=2){r.multiTouchMove=!0;var t=r.getTouchPosition(n,0),i=r.getTouchPosition(n,1);r.setCropBoxState(t,i);r.stopPropagation(n)}else!r.multiTouchMove&&r.overlayView.isTransforming()&&(r.move(r.getTouchPosition(n,0)),r.stopPropagation(n));else r.onMouseMove(n)},r.onMouseMove=function(n){var t,i,u;r.mouseButtonDown&&(t=r.getMousePosition(n),r.overlayView.isTransforming()?r.move(t):r.config.enableMouseRedraw&&(i={x:t.x,y:t.y},u={x:t.x+1,y:t.y+1},r.setCropBoxState(i,u)),r.stopPropagation(n))},r.onTouchEnd=function(n){if(n&&n.touches)r.end(),n.touches.length===0&&(r.multiTouchMove=!1),r.stopPropagation(n);else r.onMouseUp(n)},r.onMouseUp=function(){r.mouseButtonDown=!1;typeof _w!="undefined"&&_w.getSelection().removeAllRanges();r.end()},r.isPositionWithinBoundary=function(n,t,i){var r=n.getBoundingClientRect();return t<r.left||t>r.right||i<r.top||i>r.bottom?!1:!0},r.handleEventsSetting=function(n){var t=n?sj_be:sj_ue;"ontouchstart"in sb_de?(t(r.imageElement,"touchstart",r.onTouchStart,!0),t(r.imageElement,"touchmove",r.onTouchMove,!0),t(r.imageElement,"touchend",r.onTouchEnd,!0)):window.navigator.msPointerEnabled?(r.imageElement.style.msTouchAction="none",r.imageElement.style.touchAction="none",t(r.imageElement,"MSPointerDown",r.onTouchStart,!0),t(r.imageElement,"MSPointerMove",r.onTouchMove,!0),t(r.imageElement,"MSPointerUp",r.onTouchEnd,!0),t(_d,"MSPointerUp",r.onTouchEnd,!0)):"onpointermove"in sb_de&&(r.imageElement.style.msTouchAction="none",r.imageElement.style.touchAction="none",t(r.imageElement,"pointerdown",r.onTouchStart,!0),t(r.imageElement,"pointermove",r.onTouchMove,!0),t(r.imageElement,"pointerup",r.onTouchEnd,!0),t(_d,"pointerup",r.onTouchEnd,!0));t(r.imageElement,"mousedown",r.onMouseDown,!0);t(r.imageElement,"mousemove",r.onMouseMove,!0);t(r.imageElement,"mouseup",r.onMouseUp,!0)},r.hint=i.getResourceString("VSHint"),r.cropConfig=i.getCropConfig(),r.isHintShown=typeof sessionStorage!="undefined"&&sessionStorage.getItem(r.cropboxHintShown)=="1",r}return __extends(s,n),s.prototype.componentWillMount=function(){this.props&&(this.config=new r(this.cropConfig),this.cropBoxAnimationTime=this.config.animationDuration,this.containerWidth=this.props.containerWidth,this.containerHeight=this.props.containerHeight)},s.prototype.componentDidMount=function(){var i,r,n;this.throttleCropBoxChange=this.throttle(this.cropBoxChange,this.config.eventTimeThreshold);i=this.props.cropCoordinates?this.props.cropCoordinates:this.config;r=new t({x:i.left,y:i.top},{x:i.right,y:i.bottom});this.overlayView=new u(this.getViewRect(),this.getCropRect(r),this.config);n=this.overlayView.cropRect();n&&f(n.width(),n.height(),n.left(),n.top());this.isAnimationEnabled()?setTimeout(this.updateCropBoxStyle,this.cropBoxAnimationTime):this.updateCropBoxStyle();this.setAnimations();this.props.cropCoordinates?this.lastCropCoordinates=r:this.throttleCropBoxChange();this.handleEventsSetting(!0)},s.prototype.componentWillReceiveProps=function(n){if(n.cropCoordinates&&this.overlayView!=null){var i=new t({x:n.cropCoordinates.left,y:n.cropCoordinates.top},{x:n.cropCoordinates.right,y:n.cropCoordinates.bottom});i.equals(this.lastCropCoordinates)&&this.containerHeight==n.containerHeight&&this.containerWidth==n.containerWidth||(this.overlayView.setViewRect(this.getViewRect()),this.overlayView.setCropRect(this.getCropRect(i)),this.updateCropBoxStyle(),this.containerHeight=n.containerHeight,this.containerWidth=n.containerWidth,this.setState({coordinates:i,containerHeight:n.containerHeight,containerWidth:n.containerWidth}))}},s.prototype.isAnimationEnabled=function(){return this.config.enableAnimations&&!this.props.isFromOverlayElement},s.prototype.stopPropagation=function(n){n.preventDefault();n.stopPropagation()},s.prototype.render=function(){var n=this;return this.props?React.createElement("div",{id:"overlay_view",className:"overlayView",ref:function(t){n.imageElement=t}},React.createElement("div",{id:"crop_rect",className:"cropRect",ref:function(t){n.cropBox=t}},React.createElement("div",{className:"content",ref:function(t){n.cropBoxContent=t}},React.createElement("div",{className:"left"}),React.createElement("div",{className:"right"}),React.createElement("div",{className:"top"}),React.createElement("div",{className:"bottom"}),React.createElement("div",{className:"leftTop"}),React.createElement("div",{className:"rightTop"}),React.createElement("div",{className:"leftBottom"}),React.createElement("div",{className:"rightBottom"}))),!this.isHintShown&&React.createElement("span",{className:"cropBoxHint",ref:function(t){n.cropBoxHint=t}},this.hint)):null},s}(React.Component),h=function(n){return{changeCropCoordinates:function(t){t&&n(ImageDetailActions.changeCropCoordinates(t))}}},c=function(n){var t=i.getIsHotspotClick(n)||i.getClickedEntity(n);return{cropCoordinates:i.getCropCoordinates(n),isFromOverlayElement:t}};n.ImageDetail.ImageCropBox=ReactRedux.connect(c,h)(s)})(t=n.ImageDetail||(n.ImageDetail={}))})(Multimedia||(Multimedia={})),function(n){var t;(function(t){var r=SharedComponent.AccessibleComponent,i=ImageDetailReducers;n.ImageDetail.VisualSearchButton=function(u){if(u.onclick){var f=u.enableVSNotification&&!n.ImageDetailUtils.getVSNotificationCookie("0")?"show":"",e=i.getResourceString("VSNotificationTitle"),o=i.getResourceString("VSNotification");return React.createElement(r,{elementName:"span",id:"vsbutton",className:f,onClick:u.onclick,role:"button","aria-label":u.visualSearchTooltip,"data-tooltip":u.visualSearchTooltip},React.createElement("span",{className:"icon"}),u.enableVSNotification&&!n.ImageDetailUtils.getVSNotificationCookie("0")&&React.createElement(t.NotificationContainer,{notificationTitle:e,notificationText:o,getCookie:n.ImageDetailUtils.getVSNotificationCookie,setCookie:n.ImageDetailUtils.setVSNotificationCookie}))}return null};n.ImageDetail.VisualSearchButton.displayName="VisualSearchButton"})(t=n.ImageDetail||(n.ImageDetail={}))}(Multimedia||(Multimedia={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}();__assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},function(n){var t;(function(t){var r=n.InstrumentationUtils.l,u=ImageDetailReducers.getResourceString,f=ImageDetailActions.IImageDetailViewType,e=ImageDetailActions.IImageDetailOverlayElement,i=ImageDetailReducers,o=function(f){function e(n){var t=f.call(this,n)||this;return t.hotSpots=[],t.defaultHoverShown=!1,t.hoverTimeout=2e3,t.showHotspotClassName="show",t.hotSpotTooltip=null,t.isUnMounted=!1,t.changeCropCoordinatesAndLoadVisualSearch=function(n){if(n){t.props.changeCropCoordinates(n);t.props.changeSelectedModule();var i=ImageDetailActions.IImageDetailViewType.VisualSearch;t.props.viewType!==i&&(t.props.addToDetailStateHistory(),t.props.changeInsightsStatus(t.props.ig),t.props.changePageView())}},t.stopPropagation=function(n){n.stopPropagation();n.preventDefault()},t.handleUserAction=function(n,i){var f,u,e;t.stopPropagation(n);f=t.props.detectedObjects[i].boundingBox;u=f;t.changeCropCoordinatesAndLoadVisualSearch(u);e="left:"+u.left+", top:"+u.top;t.props.imageData&&t.props.imageData.instInfo&&r(t.props.imageData.instInfo.appNS,t.props.imageData.instInfo.kValue,"CI.Click","ObjectDetectionHotSpot",t.props.ig,{Mid:t.props.imageData.id,Info:e})},t.runHotSpotRoutine=i.isMobileViewEnabled()?t.runMobileRoutine:t.runDesktopRoutine,t.hotspotDelay=n.config?n.config.ShowHotSpotDelay:1,t.hotSpotTooltip=u("HSTooltip"),t}return __extends(e,f),e.prototype.runDesktopRoutine=function(){var t=this,i,r;if(this.defaultHoverShown){if(this.props&&this.props.config&&this.props.config.EnableFlash){for(i=0;i<this.hotSpots.length;i++)r=this.hotSpots[i],r.style.animationName="",r.style.webkitAnimationName="";setTimeout(function(){for(var i,n=0;n<t.hotSpots.length;n++)i=t.hotSpots[n],i.style.animationName="flash",i.style.webkitAnimationName="flash"},1)}}else(!this.props.enableVSNotification||n.ImageDetailUtils.getHSNotificationCookie("0"))&&setTimeout(function(){t.defaultHoverShown=!0;t.isUnMounted||t.setState({defaultHoverShown:t.defaultHoverShown})},this.hoverTimeout)},e.prototype.runMobileRoutine=function(){for(var i,n=this,t=0;t<this.hotSpots.length;t++)i=this.hotSpots[t],i.classList.remove(this.showHotspotClassName);setTimeout(function(){for(var i,t=0;t<n.hotSpots.length;t++)i=n.hotSpots[t],i.classList.add(n.showHotspotClassName)},this.hotspotDelay)},e.prototype.componentDidMount=function(){this.hotSpots&&this.hotSpots.length>0&&this.runHotSpotRoutine()},e.prototype.componentWillUpdate=function(){this.hotSpots=[]},e.prototype.componentDidUpdate=function(){this.hotSpots&&this.hotSpots.length>0&&this.runHotSpotRoutine()},e.prototype.componentWillUnmount=function(){this.isUnMounted=!0},e.prototype.render=function(){var r=this,u=ImageDetailActions.IImageDetailViewType.VisualSearch,o=!this.props.enableVSNotification||this.props.viewType==u||n.ImageDetailUtils.getVSNotificationCookie("0"),f=!this.props.enableVSNotification||this.props.viewType!=u||n.ImageDetailUtils.getHSNotificationCookie("0");if(this.props&&this.props.config&&this.props.config.Enabled&&this.props.detectedObjects&&this.props.detectedObjects.length>0&&o){var e=this.props.config.EnableTooltip&&f?this.hotSpotTooltip:"",s=e?{"data-tooltip":e}:{},h=i.getResourceString("HSNotification"),c=!f||this.props.showHotspotWithoutHover?"obj_det_container show":"obj_det_container";return React.createElement("div",{className:c,id:"obj_det_container"},this.props.detectedObjects.map(function(i,f){if(i.hotspot){var e=f==0&&r.props.config.EnableNotification&&!r.defaultHoverShown?"obj_det hover":"obj_det",o={left:i.hotspot.left*100+"%",top:i.hotspot.top*100+"%"};return React.createElement("span",__assign({},s,{className:e,key:f,style:o,onMouseDown:function(n){return r.handleUserAction(n,f)},onTouchEnd:function(n){return r.handleUserAction(n,f)},ref:function(n){n&&r.hotSpots.push(n)}}),React.createElement("span",{className:"core"}),r.props.enableVSNotification&&r.props.viewType==u&&f==0&&React.createElement(t.NotificationContainer,{notificationTitle:null,notificationText:h,getCookie:n.ImageDetailUtils.getHSNotificationCookie,setCookie:n.ImageDetailUtils.setHSNotificationCookie}))}}))}return null},e}(React.Component),s=function(n){return{changeCropCoordinates:function(t){n(ImageDetailActions.changeCropCoordinates(t,!0))},addToDetailStateHistory:function(){n(ImageDetailActions.addToDetailStateHistory())},changePageView:function(){n(ImageDetailActions.changePageView(f.VisualSearch))},changeSelectedModule:function(){n(ImageDetailActions.changeInsightsSelectedModule("similarproduct"))},changeInsightsStatus:function(t){n(ImageDetailActions.changeInsightStatus(!0,t,"ObjectDetection"))}}},h=function(n){var t=i.getCurrentResult(n),u=i.getPageConfig().disAdltSimImg,f=u&&t&&t.isAdult?null:i.getDetectedObjects(n),r=i.getVisibleOverlayElements(n),o=r&&r.some(function(n){return n.type==e.Hotspot&&n.id==null});return{detectedObjects:f,config:i.getObjectDetectionConfig(n),detailScenario:i.getDetailScenario(n),showHotspotWithoutHover:o,imageData:t,viewType:i.getViewType(n),ig:i.getCurrentImpressionId(n)}};n.ImageDetail.ObjectDetection=ReactRedux.connect(h,s)(o);n.ImageDetail.ObjectDetection.displayName="ObjectDetection"})(t=n.ImageDetail||(n.ImageDetail={}))}(Multimedia||(Multimedia={}));__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t;(function(t){var e=n.ImageDetailUtils.getMouseClickPosition,o=n.ImageDetailUtils.getParentContainer,s=n.InstrumentationUtils.l,u=ImageDetailActions.IImageDetailViewType,f=ImageDetailActions.IImageDetailOverlayElement,i=ImageDetailReducers,r=i.gentc(),h=function(n){function f(t){var f=n.call(this,t)||this;return f.entities=[],f.isEventListenerAttached=!1,f.isAnimationShown=!1,f.entityModuleEnabled=!1,f.visualSearchOnClickEnabled=!1,f.config=null,f.dismissEntityPane=function(){f.setState({clickedElement:null,style:null});typeof document!="undefined"&&(f.isEventListenerAttached=!1,document.removeEventListener("click",f.dismissEntityPane),document.removeEventListener("touchend",f.dismissEntityPane))},f.changeCropCoordinatesAndLoadVisualSearch=function(n,t){if(n){f.props.changeCropCoordinates(n,t);f.props.changeSelectedModule();var i=u.VisualSearch;f.props.viewType!==i&&(f.props.addToDetailStateHistory(),f.props.changeInsightsStatus(f.props.ig),f.props.changePageView())}},f.stopPropagation=function(n){n.stopPropagation();n.preventDefault()},f.handleOnClick=function(n,t){var i,o,h;if(f.entityModuleEnabled&&f.visualSearchOnClickEnabled){f.stopPropagation(n);var r=f.props.recognizedObjects[t],u=r.entity.bingId,c=r.region;f.props.changeEntityVisibility(!1,u);f.changeCropCoordinatesAndLoadVisualSearch(c,u)}else{if(f.isEventListenerAttached)return;f.stopPropagation(n);i=e(n,f.config.EntityPaneXOffset,f.config.EntityPaneYOffset);o=sj_et(n);i=f.adjustPositionToParent(o,i);h=f.props.recognizedObjects[t];f.setState({clickedElement:h,style:{left:i[0]+"px",top:i[1]+"px",width:f.config.EntityPaneWidth+"px",height:f.config.EntityPaneHeight+"px"}});typeof document!="undefined"&&(f.isEventListenerAttached=!0,document.addEventListener("click",f.dismissEntityPane),document.addEventListener("touchend",f.dismissEntityPane))}f.props.imageData&&f.props.imageData.instInfo&&s(f.props.imageData.instInfo.appNS,f.props.imageData.instInfo.kValue,"CI.Click","objectRecognitionFaceRect",f.props.ig,{Mid:f.props.imageData.id})},f.onMouseOver=function(n){f.props.changeEntityVisibility(!0,n)},f.onMouseLeave=function(n){f.props.changeEntityVisibility(!1,n)},f.config=i.getObjectRecognitionConfig(),f.entityModuleEnabled=r!=null&&i.getMainImageConfig().EnableEntitiesModule,f.visualSearchOnClickEnabled=r&&r.EnableVSClick,f}return __extends(f,n),f.prototype.componentWillUpdate=function(){this.entities=[]},f.prototype.componentWillReceiveProps=function(){this.entities=[];this.isAnimationShown=!1;this.dismissEntityPane()},f.prototype.componentDidUpdate=function(){var t=this,n,i;if(this.entities&&this.entities.length>0&&!this.isAnimationShown&&this.config.EnableFlash){for(n=0;n<this.entities.length;n++)i=this.entities[n],i.style.animationName="",i.style.webkitAnimationName="";setTimeout(function(){for(var i,n=0;n<t.entities.length;n++)i=t.entities[n],i.style.animationName="flash",i.style.webkitAnimationName="flash";t.isAnimationShown=!0},1)}},f.prototype.componentWillUnMount=function(){typeof document!="undefined"&&this.isEventListenerAttached&&(document.removeEventListener("click",this.dismissEntityPane),document.removeEventListener("touchend",this.dismissEntityPane))},f.prototype.render=function(){var n=this,i;return this.config.Enabled&&this.props.recognizedObjects&&this.props.recognizedObjects.length>0?(i="obj_rec"+(this.props.showEntitiesWithoutHover?" show":""),React.createElement("div",{className:i,id:"obj_rec"},this.props.recognizedObjects.map(function(t,i){if(t.entity&&t.entity.imageUrl){var r=t.entity.bingId,u="feature objrec "+(n.props.visibleEntityId==r?" show":"")+(n.props.clickedEntityId==r?" hidden":""),f={left:t.region.left*100+"%",top:t.region.top*100+"%",width:(t.region.right-t.region.left)*100+"%",height:(t.region.bottom-t.region.top)*100+"%"};return React.createElement("span",{"data-index":i,className:u,key:i,style:f,onClick:function(t){return n.handleOnClick(t,i)},onMouseOver:n.entityModuleEnabled?function(){return n.onMouseOver(r)}:null,onMouseLeave:n.entityModuleEnabled?function(){return n.onMouseLeave(r)}:null,ref:function(t){t&&n.entities.push(t)}})}return null}),this.state&&this.state.clickedElement&&React.createElement(t.ImageEntityPane,{entity:this.state.clickedElement.entity,style:this.state.style,ig:this.props.ig,imageData:this.props.imageData}))):null},f.prototype.adjustPositionToParent=function(n,t){var r=o(n,"DIV","imgContainer");if(r){var i=r.getClientRects()[0],u=this.calculateNewPosition(t[0],this.config.EntityPaneWidth,i.left,i.right),f=this.calculateNewPosition(t[1],this.config.EntityPaneHeight,i.top,i.bottom);return[u,f]}return t},f.prototype.calculateNewPosition=function(n,t,i,r){var u,e,f;return n<0?0:(u=r-i,u<t)?u:(e=20,f=r-(i+n+t),f>0?n:Math.max(0,n+f-e))},f}(React.Component),c=function(n){return{changeCropCoordinates:function(t,i){n(ImageDetailActions.changeCropCoordinates(t,!1,i))},addToDetailStateHistory:function(){n(ImageDetailActions.addToDetailStateHistory())},changePageView:function(){n(ImageDetailActions.changePageView(u.VisualSearch))},changeSelectedModule:function(){n(ImageDetailActions.changeInsightsSelectedModule("entities"))},changeInsightsStatus:function(t){n(ImageDetailActions.changeInsightStatus(!0,t,"ObjectRecognition"))},changeEntityVisibility:function(t,i){var r=t?[{type:f.Entity,id:i}]:[];n(ImageDetailActions.changeVisibleOverlayElements(r))}}},l=function(n){var o=i.getCurrentResult(n),e=i.getRecognizedEntities(n,r!=null,r&&r.RemoveQueryEntity,!0),t=i.getVisibleOverlayElements(n,f.Entity),u=t&&t.length>0?t[0].id:null;return{recognizedObjects:e,imageData:i.getCurrentResult(n),ig:i.getCurrentImpressionId(n),viewType:i.getViewType(n),showEntitiesWithoutHover:t&&t.length>0&&u==null,visibleEntityId:u,clickedEntityId:i.getClickedEntity(n)}};n.ImageDetail.ObjectRecognition=ReactRedux.connect(l,c)(h);n.ImageDetail.ObjectRecognition.displayName="ObjectRecognition"})(t=n.ImageDetail||(n.ImageDetail={}))}(Multimedia||(Multimedia={})),function(n){var t=function(){function n(n,t,i,r,u,f,e,o,s){e===void 0&&(e=!0);o===void 0&&(o=5);s===void 0&&(s=!1);var h=this;if(this.utils=pMMUtils,this.moved=!1,this.doubletap=!1,this.touchStartPoint=null,this.touchStartElementLeft=0,this.nowtouchpid=0,this.swipeDelta=null,this.touchStartTime=0,this.timeDelta=0,this.captureEvent=!0,this.enableEndHandlerWithoutMove=!1,this.moveSensitivity=5,this.cleanUp=function(){h.handleEventsSetting(!1)},this.isMoved=function(){return h.moved},this.resetMoved=function(){h.moved=!1},this.handleEventsSetting=function(n){var t=n?sj_be:sj_ue;typeof sb_de!="undefined"&&("ontouchstart"in sb_de?(t(h.touchElement,"touchstart",h.touchStart,h.captureEvent),t(h.touchElement,"touchmove",h.touchMove,h.captureEvent),t(h.touchElement,"touchend",h.touchEnd,h.captureEvent)):window.navigator.msPointerEnabled?(h.touchElement.style.msTouchAction="none",h.touchElement.style.touchAction="none",t(h.touchElement,"MSPointerDown",h.touchStart,h.captureEvent),t(h.touchElement,"MSPointerMove",h.touchMove,h.captureEvent),t(h.touchElement,"MSPointerUp",h.touchEnd,h.captureEvent),t(_d,"MSPointerUp",h.touchEnd,h.captureEvent)):"onpointermove"in sb_de&&(h.touchElement.style.msTouchAction="none",h.touchElement.style.touchAction="none",t(h.touchElement,"pointerdown",h.touchStart,h.captureEvent),t(h.touchElement,"pointermove",h.touchMove,h.captureEvent),t(h.touchElement,"pointerup",h.touchEnd,h.captureEvent),t(_d,"pointerup",h.touchEnd,h.captureEvent)),t(_d,"mousedown",h.resetMoved,!0))},this.getHandlerOrEmpty=function(n){return n!=null?n:h.Empty},this.Empty=function(){},this.setMoved=function(n){n===void 0&&(n=!1);h.moved=n},this.checkIfDoubleTap=function(){return sb_gt()-h.touchStartTime<250&&!!h.doubleTapHandler&&!h.isMoved()},this.touchStart=function(n){if(h.isTouchEvent(n)&&(h.doubletap=h.checkIfDoubleTap(),!h.doubletap)){h.setMoved(!1);h.touchStartPoint=h.getTouchPointFromEvent(n);var t=h.utils.gcs(h.touchElement);h.touchStartElementLeft=parseInt(typeof _G!="undefined"&&_G.RTL?t.marginRight:t.marginLeft);h.touchStartTime=sb_gt();!n.pointerId||(h.nowtouchpid=n.pointerId);h.touchStartHandler(n)}},this.touchMove=function(n){if(h.isTouchEvent(n)&&h.isValidTouch(n)){var t=h.getTouchPointFromEvent(n);if(!h.touchStartPoint||!t)return;h.swipeDelta=h.getDistanceBetweenPoints(h.touchStartPoint,t);h.setMoved(Math.abs(h.swipeDelta.X)>h.moveSensitivity||Math.abs(h.swipeDelta.Y)>h.moveSensitivity);h.isMoved()&&!h.doubletap&&h.touchMoveHandler(h.touchStartElementLeft,h.swipeDelta)&&h.preventDefault(n)}},this.touchEnd=function(n){var t=h.isMoved(),i;h.isTouchEvent(n)&&(h.doubletap&&!h.isMoved()?(h.doubleTapHandler(n),h.preventDefault(n),h.doubletap=!1):(t||h.enableEndHandlerWithoutMove)&&h.isValidTouch(n)&&(h.timeDelta=sb_gt()-h.touchStartTime,i=t?h.swipeDelta:h.getNewPoint(),h.touchEndHandler(h.touchStartElementLeft,i,h.timeDelta)&&h.preventDefault(n)),sj_ue(_d,"mousedown",h.resetMoved,!0),sb_st(function(){sj_be(_d,"mousedown",this.resetMoved,!0)},150))},this.preventDefault=function(n){n.stopPropagation();n.preventDefault()},this.getTouchPointFromEvent=function(n){var t=h.getNewPoint();return t.X=n.touches?n.touches[0].pageX:n.pageX!=undefined&&n.pageX!=0?n.pageX:0,t.Y=n.touches?n.touches[0].pageY:n.pageY!=undefined&&n.pageY!=0?n.pageY:0,t},this.getDistanceBetweenPoints=function(n,t){var i=h.getNewPoint();return i.X=t.X-n.X,i.Y=t.Y-n.Y,i},this.getNewPoint=function(){return{X:0,Y:0}},this.isTouchEvent=function(n){return typeof n.pointerType=="undefined"||n.pointerType==2||n.pointerType=="touch"||n.pointerType=="pen"},this.isValidTouch=function(n){return!n.pointerId||n.pointerId==h.nowtouchpid},!n)throw"container cannot be null!";this.container=n;this.touchElement=!t?this.container:t;this.touchStartHandler=this.getHandlerOrEmpty(i);this.touchMoveHandler=this.getHandlerOrEmpty(r);this.touchEndHandler=this.getHandlerOrEmpty(u);this.doubleTapHandler=this.getHandlerOrEmpty(f);this.enableEndHandlerWithoutMove=s;this.captureEvent=e;this.moveSensitivity=o;this.handleEventsSetting(!0)}return n}();n.MmReactSwipe=t}(ImageDetailSwipe||(ImageDetailSwipe={}));!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):n.ResizeObserver=t()}(this,function(){"use strict";function u(n){return parseFloat(n)||0}function v(n){for(var i=[],t=arguments.length-1;t-->0;)i[t]=arguments[t+1];return i.reduce(function(t,i){return t+u(n["border-"+i+"-width"])},0)}function g(n){var s=n.clientWidth,h=n.clientHeight,y,p;if(!s&&!h)return a;var w,t=i(n).getComputedStyle(n),r=function(n){for(var i,e,r={},t=0,f=["top","right","bottom","left"];t<f.length;t+=1)i=f[t],e=n["padding-"+i],r[i]=u(e);return r}(t),c=r.left+r.right,l=r.top+r.bottom,e=u(t.width),o=u(t.height);return("border-box"===t.boxSizing&&(Math.round(e+c)!==s&&(e-=v(t,"left","right")+c),Math.round(o+l)!==h&&(o-=v(t,"top","bottom")+l)),(w=n)!==i(w).document.documentElement)&&(y=Math.round(e+c)-s,p=Math.round(o+l)-h,1!==Math.abs(y)&&(e-=y),1!==Math.abs(p)&&(o-=p)),f(r.left,r.top,e,o)}function nt(n){return s?y(n)?f(0,0,(t=n.getBBox()).width,t.height):g(n):a;var t}function f(n,t,i,r){return{x:n,y:t,width:i,height:r}}var c=function(){function n(n,t){var i=-1;return n.some(function(n,r){return n[0]===t&&(i=r,!0)}),i}return"undefined"!=typeof Map?Map:function(){function t(){this.__entries__=[]}var i={size:{configurable:!0}};return i.size.get=function(){return this.__entries__.length},t.prototype.get=function(t){var r=n(this.__entries__,t),i=this.__entries__[r];return i&&i[1]},t.prototype.set=function(t,i){var r=n(this.__entries__,t);~r?this.__entries__[r][1]=i:this.__entries__.push([t,i])},t.prototype.delete=function(t){var i=this.__entries__,r=n(i,t);~r&&i.splice(r,1)},t.prototype.has=function(t){return!!~n(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(n,t){var i,r,u;for(void 0===t&&(t=null),i=0,r=this.__entries__;i<r.length;i+=1)u=r[i],n.call(t,u[1],u[0])},Object.defineProperties(t.prototype,i),t}()}(),s="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,r="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),w="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(r):function(n){return setTimeout(function(){return n(Date.now())},1e3/60)},b=2,k=["top","right","bottom","left","width","height","size","weight"],d="undefined"!=typeof MutationObserver,n=function(){this.connected_=!1;this.mutationEventsAdded_=!1;this.mutationsObserver_=null;this.observers_=[];this.onTransitionEnd_=this.onTransitionEnd_.bind(this);this.refresh=function(n,t){function e(){i&&(i=!1,n());r&&f()}function o(){w(e)}function f(){var n=Date.now();if(i){if(n-u<b)return;r=!0}else i=!0,r=!1,setTimeout(o,t);u=n}var i=!1,r=!1,u=0;return f}(this.refresh.bind(this),20)},y,e,p,t,h,o;n.prototype.addObserver=function(n){~this.observers_.indexOf(n)||this.observers_.push(n);this.connected_||this.connect_()};n.prototype.removeObserver=function(n){var t=this.observers_,i=t.indexOf(n);~i&&t.splice(i,1);!t.length&&this.connected_&&this.disconnect_()};n.prototype.refresh=function(){this.updateObservers_()&&this.refresh()};n.prototype.updateObservers_=function(){var n=this.observers_.filter(function(n){return n.gatherActive(),n.hasActive()});return n.forEach(function(n){return n.broadcastActive()}),n.length>0};n.prototype.connect_=function(){s&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),d?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)};n.prototype.disconnect_=function(){s&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)};n.prototype.onTransitionEnd_=function(n){var t=n.propertyName;void 0===t&&(t="");k.some(function(n){return!!~t.indexOf(n)})&&this.refresh()};n.getInstance=function(){return this.instance_||(this.instance_=new n),this.instance_};n.instance_=null;var l=function(n,t){for(var u,i=0,r=Object.keys(t);i<r.length;i+=1)u=r[i],Object.defineProperty(n,u,{value:t[u],enumerable:!1,writable:!1,configurable:!0});return n},i=function(n){return n&&n.ownerDocument&&n.ownerDocument.defaultView||r},a=f(0,0,0,0);return y="undefined"!=typeof SVGGraphicsElement?function(n){return n instanceof i(n).SVGGraphicsElement}:function(n){return n instanceof i(n).SVGElement&&"function"==typeof n.getBBox},e=function(n){this.broadcastWidth=0;this.broadcastHeight=0;this.contentRect_=f(0,0,0,0);this.target=n},e.prototype.isActive=function(){var n=nt(this.target);return this.contentRect_=n,n.width!==this.broadcastWidth||n.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var n=this.contentRect_;return this.broadcastWidth=n.width,this.broadcastHeight=n.height,n},p=function(n,t){var i,r,u,f,e,s,o,h=(r=(i=t).x,u=i.y,f=i.width,e=i.height,s="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,o=Object.create(s.prototype),l(o,{x:r,y:u,width:f,height:e,top:u,right:r+f,bottom:e+u,left:r}),o);l(this,{target:n,contentRect:h})},t=function(n,t,i){if(this.activeObservations_=[],this.observations_=new c,"function"!=typeof n)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=n;this.controller_=t;this.callbackCtx_=i},t.prototype.observe=function(n){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(n instanceof i(n).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(n)||(t.set(n,new e(n)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(n){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(n instanceof i(n).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(n)&&(t.delete(n),t.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive();this.observations_.clear();this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var n=this;this.clearActive();this.observations_.forEach(function(t){t.isActive()&&n.activeObservations_.push(t)})},t.prototype.broadcastActive=function(){if(this.hasActive()){var n=this.callbackCtx_,t=this.activeObservations_.map(function(n){return new p(n.target,n.broadcastRect())});this.callback_.call(n,t,n);this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},h="undefined"!=typeof WeakMap?new WeakMap:new c,o=function(i){if(!(this instanceof o))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var r=n.getInstance(),u=new t(i,r,this);h.set(this,u)},["observe","unobserve","disconnect"].forEach(function(n){o.prototype[n]=function(){return(t=h.get(this))[n].apply(t,arguments);var t}}),void 0!==r.ResizeObserver?r.ResizeObserver:o})