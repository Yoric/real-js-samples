/**import from `/static/js/v4/pages/index.js` **//**
 * 首页js逻辑
 * @author: qiantianbing
 * @update: 2018-04-18 10:27:57
 * */feb.require(["feb/phenix","feb/feed"],function(e,t){e($(".module-videos"),{type:"even_images",bk:"时间视野",hideHead:!0,lineCount:2,list:App.data.video_live&&App.data.video_live.news||[]}),e($(".module-jingcaisudi"),{type:"even_images",title:"精彩速递",lineCount:2,list:App.data.express&&App.data.express.news||[]}),$("#j-header-nav").trigger("detach.ScrollToFixed").scrollToFixed({limit:$("#j-infoflow-tabs").offset().top}),$(".module-recommend .list-group-item").has("a[data-bold=1]").addClass("list-group-item-bold");var n={infoflowObj:{},$tabHds:$(".infoflow-channel-item"),$tabBds:$(".infoflow-content-item"),baseConf:{parent:$(".module-infoflow"),unreadTop:$("#j-header-nav").height()+$("#j-infoflow-tabs").height(),container:null,thresholdTime:100,thresholdPos:100,remindTime:5,remindDisable:!0,disLike:!1,reqData:{channel:"",request_pos:"index"},url_get_infoflow:App.api.apiDomain+"/btimeweb/getInfoFlow"},init:function(){$("#j-infoflow-tabs").scrollToFixed({}),this.createInfoflow(),this.bindTabSwitch()},bindTabSwitch:function(){var e=this,t=function(t){var n=e.$tabHds.eq(t),r=e.$tabBds.eq(t),i=e.$tabHds.filter(".active").data("channel");e.infoflowObj[i]&&e.infoflowObj[i]._lockScroll(),n.addClass("active").siblings().removeClass("active"),r.show().siblings().hide(),e.createInfoflow()},n;$(".infoflow-channel-item").hover(function(){var e=$(this).index();n=setTimeout(function(){t(e)},600)},function(){clearTimeout(n)})},createInfoflow:function(e){var n=this.$tabHds.filter(".active"),e=n.data("channel"),r=n.data("channelStr"),i=$("#j-infoflow-channel-"+e),s=$.extend(this.baseConf,{container:i});s.reqData.channel=r,this.infoflowObj[e]?this.infoflowObj[e]._unlockScroll():($("#j-infoflow-tabs").hasClass("scroll-to-fixed-fixed")&&$(window).scrollTop(this.baseConf.parent.offset().top-$("#j-header-nav").height()),this.infoflowObj[e]=new t(s))}},r={$btvHd:$(".module-btv .tabs-title .title"),$btvBd:$(".module-btv .content-item"),init:function(){this.bindSwitch(),this.render()},bindSwitch:function(){var e=this;this.$btvHd.hover(function(){var t=$(this).index();$(this).addClass("active").siblings().removeClass("active"),e.$btvBd.eq(t).show().siblings().hide()},function(){})},fetchData:function(){return $.ajax({url:App.api.apiDomain+"/btimeweb/getindexRight?target=v4",dataType:"jsonp",data:{from:App.config.from}})},render:function(){var t=this;this.fetchData().then(function(n){if(n.errno!=0||!n.data)return;var r=n.data.RBC&&n.data.RBC.data||[],i=n.data.CHNCPA&&n.data.CHNCPA.data||[];e(t.$btvBd.eq(0),{type:"title_list",bk:"北京人民广播电视台",hideHead:!0,dot:!0,list:r}),e(t.$btvBd.eq(1),{type:"title_list",bk:"国家大剧院",hideHead:!0,dot:!0,list:i}),t.setUrl(n.data)})},setUrl:function(e){this.$btvHd.each(function(){var t=$(this).data("name");$(this).find("a").attr("href",e[t].url)})}},i={$hotHd:$(".hots-video-wraper .tabs-title .title"),$hotBd:$(".module-hots .content-item"),init:function(){this.bindSwitch(),e(this.$hotBd.eq(0),{type:"title_list",hideHead:!0,list:App.data.focus&&App.data.focus.news||[]}),e(this.$hotBd.eq(1),{type:"title_list",hideHead:!0,list:App.data.local&&App.data.local.news||[]})},bindSwitch:function(){var e=this;this.$hotHd.hover(function(){var t=$(this).index();$(this).addClass("active").siblings().removeClass("active"),e.$hotBd.eq(t).show().siblings().hide()},function(){})}},s={$timeContainer:$(".time-channel-list"),init:function(){this.renderTimer()},renderTimer:function(){function i(e){if(!e||e.length==0)return;n.push(e.splice(0,1)[0]),r.push(e.splice(0,3)),i(e)}var t=App.data.btime_observe&&App.data.btime_observe.news||[],n=[],r=[];i(t),this.$timeContainer.html(template.compile($("#j-tpl-time-list").html())({list:n})),this.$timeContainer.find(".content-list").each(function(t){e($(this),{type:"title_list",hideHead:!0,lineCount:2,dot:!0,list:r[t]})}),this.timerHover(r)},timerHover:function(e){if(!e||e.length==0)return;var t=[],n={},r=!1;e.forEach(function(e){t=t.concat(e||[])}),n=_.keyBy(t,"gid"),this.$timeContainer.find(".list-group-item").each(function(){var e=$(this).data("gid"),t=n[e].data.covers&&n[e].data.covers[0],r=n[e].open_url;if(!t)return;var i=$utils.dmfd(t,"160","90");$(this).append('<a href="'+r+'"><img src="'+i+'" /></a>')});var i={};this.$timeContainer.on("mouseenter",".list-group-item",function(){var e=$(this).data("gid"),t=$(this).find("img");t.length>0&&(clearTimeout(i["hideTimer-"+e]),i["showTimer-"+e]=setTimeout(function(){t.stop().slideDown("fast")},300))}).on("mouseleave",".list-group-item",function(){var e=$(this).data("gid"),t=$(this).find("img");t.length>0&&(clearTimeout(i["showTimer-"+e]),i["hideTimer-"+e]=setTimeout(function(){t.stop().slideUp("fast")},1e3))})}},o={leftData:App.data.indexData.left,centerData:App.data.indexData.center,rightData:App.data.indexData.right,init:function(){this.shijpk(),this.renderRight(),this.renderCenter(),this.renderLeft()},renderRight:function(){var t=this.rightData,n=$("#j-phenix-right .phenix-module");t.forEach(function(t,r){if(r>=n.length)return;$(n[r]).show(),e(n[r],{type:t.module,title:t.title,lineCount:t.lineCount,bk:t.title,list:t.news})}),this.adScrollFix()},renderLeft:function(){var t=this.leftData,n=$("#j-phenix-left .phenix-module");t.forEach(function(t,r){if(r>=n.length)return;$(n[r]).show(),e(n[r],{type:t.module,title:t.title,lineCount:t.lineCount,bk:t.title,list:t.news})}),this.leftScrollFix()},renderCenter:function(){var t=this.centerData,n=$("#j-phenix-center .phenix-module");t.forEach(function(t,r){if(r>=n.length)return;$(n[r]).show(),e(n[r],{type:t.module,title:t.title,lineCount:t.lineCount,bk:t.title,list:t.news})})},adScrollFix:function(){var e=setInterval(function(){var t=$("#j-ad-last");t.children().length&&(clearInterval(e),t.scrollToFixed({marginTop:20}))},100)},leftScrollFix:function(){$("#j-phenix-left").scrollToFixed({marginTop:20,zIndex:10})},shijpk:function(){$(".shijpk-entry").on("click",function(){Userbridge.isLogin()?window.open("//user.btime.com/timeplayer"):Userbridge.invokeLogin(function(){window.open("//user.btime.com/timeplayer"),location.reload()})})}};$(function(){s.init(),i.init(),r.init(),n.init(),o.init()})});