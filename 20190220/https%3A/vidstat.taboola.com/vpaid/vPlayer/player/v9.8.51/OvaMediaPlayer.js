!function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){t.exports=i(36)},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){if(!t)return!1;var e=parseInt(t.get("ga_factor"));if(null!==$||!e)return $;if(1===e)return $=!0;e>100&&(e=100);var i=p(0,e);return $=i===e}function s(t,e,i){r(i)&&u(t,e,i)}function o(t,e,i,n){r(n)&&h(t,e,i,n)}function a(t,e,i){r(i)&&c(t,e,i)}function d(t){return t?1:0}function l(t){return""+(t.requiredViewabilityDrawn?"!ronrv":"")+(t.moatSampling?"!mtsmp":"")}function u(t,e,i){var n=i.get("player_version"),r=i.get("ab_test")||"";r=""+r+l(e.tag);var s=new XMLHttpRequest;s.open("POST",i.get("kbnul")+"/putes",!0);var o={event:t,timestamp:(new Date).toISOString(),version:n,abTest:r};o=Object.assign(o,e),s.send(V(o))}function h(t,e,i,n){var r=n.get("player_version"),s=n.get("ab_test")||"",o=new XMLHttpRequest;o.open("POST",n.get("kbnul")+"/putes/"+t,!0);var a={event:e,timestamp:(new Date).toISOString(),version:r,abTest:s};a=Object.assign(a,i),o.send(V(a))}function c(t,e,i){var n=i.get("player_version"),r=new XMLHttpRequest;r.open("POST",i.get("kbnul")+"/putes/vast",!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t=Object.assign(t,{version:n,timestamp:(new Date).toISOString()},e),r.send(V(t))}function p(t,e){var i=Math.floor(Math.random()*(e-t+1))+t;return i}function f(t,e){var i=K,n=[],r=0;for(e=e||i.length,t=t||22,r=0;r<t;r++)n[r]=i[0|Math.random()*e];return n.join("")}function v(t){return"string"!=typeof t?t:(t=t.replace(/^(http[s]?:|ftp:)/g,""),0!==t.indexOf("//")&&(t="//"+t),t)}function m(t){if(!t||"string"!=typeof t)return 0;var e;t=_(t);var i="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D";"undefined"==typeof e&&(e=0);var n=0,r=0;e^=-1;for(var s=0,o=t.length;s<o;s++)r=255&(e^t.charCodeAt(s)),n="0x"+i.substr(9*r,8),e=e>>>8^n;return e^-1}function g(t){t=t||{};for(var e,i=function(){},n=["debug","error","info","log","warn"],r=n.length;r--;)e=n[r],t[e]&&(t[e]=i)}function y(t){var e=/^(?:https?:\/\/)?(?:[^@\n]+@)?(?:www\.)?([^:\/\n]+)/im.exec(t);return e&&e.length?e[1]:null}function _(t){t=t.replace(/\r\n/g,"\n");for(var e="",i=0;i<t.length;i++){var n=t.charCodeAt(i);n<128?e+=String.fromCharCode(n):n>127&&n<2048?(e+=String.fromCharCode(n>>6|192),e+=String.fromCharCode(63&n|128)):(e+=String.fromCharCode(n>>12|224),e+=String.fromCharCode(n>>6&63|128),e+=String.fromCharCode(63&n|128))}return e}function b(t){var e=0,i={"pre-roll":0,preroll:0,"mid-roll":-1,midroll:-1,"post-roll":-2,postroll:-2};return i.hasOwnProperty(t)&&(e=i[t]),e}function w(t){return t.replace(/\s/g,"")}function A(t,e){t.className.indexOf(e)===-1&&(t.className+=" "+e),t.className=t.className.split("  ").join(" ")}function k(t,e){t.className=t.className.split(e).join("").split("  ").join(" ")}function T(t){var e={};for(var i in t)if(t.hasOwnProperty(i))if("object"==Q(t[i])){var n=T(t[i]);for(var r in n)n.hasOwnProperty(r)&&"function"!=typeof n[r]&&(e[i+"_"+r]=n[r])}else e[i]=t[i];return e}function C(t){try{return JSON.parse(V(t))}catch(t){return{}}}function E(t,e,i,n,r){var s=this;try{!r&&t.contentWindow.console.error&&(t.contentWindow.console.error=function(){});var o="iframe"==t.tagName.toLowerCase()?t.contentDocument:t;if(!o)return;var a=o.querySelectorAll(e);a.forEach(function(t){s.DOMIterator(t,e,i,n,r)}),i(o.querySelectorAll(n))}catch(t){return}}function P(t){if(!t)return null;for(var e=t.querySelector("iframe");e;)try{e=e.contentDocument.querySelector("iframe")}catch(t){break}return e}function S(t,e){return{current:t,hasNext:function(){try{return!e&&t.contentWindow.console.error&&(this.current.contentWindow.console.error=function(){}),this.current=this.current.contentDocument.querySelector("iframe"),!0}catch(t){return!1}}}}function I(t){try{return/\{\s*\[native code\]\s*\}/.test(t.toString())}catch(t){return!0}}function V(t,e){try{var i,n=[],r=null;I(Array.prototype.toJSON)||(r=Array.prototype.toJSON,delete Array.prototype.toJSON),i=JSON.stringify(t,function(t,e){if(null!=e&&"object"==("undefined"==typeof e?"undefined":Q(e))){if(n.indexOf(e)>-1)return;n.push(e)}return e},e)}catch(t){i=""}return null!==r&&(Array.prototype.toJSON=r),i}function x(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];t&&t.push(e,i,n,r)}function O(t){return t>1?t/100:t}function D(t){return parseInt(t)}function M(t){return t<1e3?1e3*t:t}function F(t,e){var i=window.cmTag&&window.cmTag.config?window.cmTag.config:{baseReportD:"taboola.com",dataCenter:"am"},n=e.get("baseReportD")||i.baseReportD,r=e.get("dataCenter")||i.dataCenter,s={baseReportD:n,dataCenter:r,cijs:"convusmp",ttype:t,cisd:"convusmp",cipid:e.get("cipid")||"",crid:e.get("creativeId")||"",dast:e.get("auc_dast")||"",cmcv:"",uv:e.get("unit_version")||"",unm:e.get("unit_type")||"",cb:Date.now(),abt:e.get("ab_test")||""};return s}function L(t){var e="//conv"+t.dataCenter+"mp."+t.baseReportD+"/st?";for(var i in t)e+=i+"="+t[i]+"&";var n=document.createElement("img");n.src=e}function R(t,e){return t.filter(function(t){var i=e&&t.hasOwnProperty(e)?t[e]:t;return void 0!==i})}function B(t){var e={};return t.forEach(function(t){e[t.key]=t.value}),e}function j(t,e){for(var i in t)if(t[i]===e)return i;return""}function U(t){var e=t.split("."),i=e[0],n=i.split(":"),r=0,s=1;for(2===e.length&&(r+=parseInt(e[1])/1e3);n.length>0;)r+=s*parseInt(n.pop(),10),s*=60;return r}function W(t,e,i){var n=e.get("creatives"),r=encodeURIComponent(n.VIDEO_URL&&n.VIDEO_URL.url?n.VIDEO_URL.url:n.VIDEO_URL),s=(new Date).getTime(),o=null;return i&&(o=e.get("adxCardSize")),t=t.replace(/%%referrer%%/gi,n.REFERRER),t=t.replace(/%%domain%%/gi,n.DOMAIN),t=t.replace(/%%video-url%%/gi,r),t=t.replace(/%%page-url%%/gi,n.PAGE_URL),t=t.replace(/%%player-width%%/gi,o?o.width:n.PLAYER_WIDTH),t=t.replace(/%%player-height%%/gi,o?o.height:n.PLAYER_HEIGHT),t=t.replace(/%%timestamp%%/gi,Math.floor(s/1e3)),t=t.replace(/%%vidlength%%/gi,n.VIDLENGTH),t=t.replace(/%%keywords%%/gi,n.KEY_WORDS),t=t.replace(/%%description%%/gi,n.DESCRIPTION),t=t.replace(/%%vertical%%/gi,n.VERTICAL),t=t.replace(/%%tag%%/gi,n.TAG?n.TAG:""),t=t.replace(/%%title%%/gi,n.TITLE),t=t.replace(/%%cirf%%/gi,encodeURIComponent(decodeURIComponent(n.CIRF))),t=t.replace(/%%cb%%/gi,"R0."+s),t=t.replace(/%%country%%/gi,e.get("country")),t=t.replace(/%%ip%%/gi,e.get("ip")),t=t.replace(/%%ua%%/gi,encodeURIComponent(navigator.userAgent)),t=t.replace(/%%dast%%/gi,e.get("auc_dast")||""),t=t.replace(/%%[^%]*%%/gi,"")}function N(){return Y.UAParser(window.navigator.userAgent)}function H(t){for(var e,i=JSON.stringify(t),n="",r="PlAyER",s=0;s<i.length;s++)e=s%r.length,n+=String.fromCharCode(i[s].charCodeAt(0).toString(10)^r[e].charCodeAt(0).toString(10));try{n=btoa(n)}catch(t){return!1}return n}function q(t,e,i){var n=t.document.createElement("script");n.type="text/javascript",n.innerHTML=e,n.onload=function(){i&&i()},n.onerror=function(t){i&&i(t)},t.document.head.appendChild(n)}function z(t){return t.get("usscrtgurl")||"https:"===window.location.protocol&&t.get("httpsOverride")}function G(t){return"https:"===window.location.protocol&&t.get("scrmf")}Object.defineProperty(e,"__esModule",{value:!0});var Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.shouldReport=r,e.reportDb=s,e.reportDebug=o,e.reportVastToDb=a,e.boolToInt=d,e.addAbTests=l,e.getRandomInt=p,e.generateGuid=f,e.setUrlPrefix=v,e.crc32=m,e._suppressConsoleMethods=g,e.stripDomain=y,e.getStreamType=b,e.trim=w,e.addClass=A,e.removeClass=k,e.flattenObject=T,e.deepClone=C,e.DOMIterator=E,e.getDeepestIframe=P,e.domIframeIterator=S,e.isNativeCode=I,e.stringify=V,e.logToBI=x,e.normalizeVolume=O,e.roundNumericValue=D,e.normalizeMilliseconds=M,e.createPixelParams=F,e.sendPixel=L,e.filterUndefinededValues=R,e.flattenKeys=B,e.getObjectKeyByValue=j,e.hmsmToSecondsOnly=U,e.replaceMacros=W,e.parseUserAgent=N,e.encodeText=H,e.injectResource=q,e.shouldSecureWfUrl=z,e.shouldSecureWrapperAndMediaFile=G;var X=i(112),Y=n(X),$=null,K="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split("")},function(t,e,i){(function(e,n){"use strict";function r(){try{var t=P;return P=null,t.apply(this,arguments)}catch(t){return V.e=t,V}}function s(t){return P=t,r}function o(t){return null==t||t===!0||t===!1||"string"==typeof t||"number"==typeof t}function a(t){return"function"==typeof t||"object"==typeof t&&null!==t}function d(t){return o(t)?new Error(g(t)):t}function l(t,e){var i,n=t.length,r=new Array(n+1);for(i=0;i<n;++i)r[i]=t[i];return r[i]=e,r}function u(t,e,i){if(!S.isES5)return{}.hasOwnProperty.call(t,e)?t[e]:void 0;var n=Object.getOwnPropertyDescriptor(t,e);return null!=n?null==n.get&&null==n.set?n.value:i:void 0}function h(t,e,i){if(o(t))return t;var n={value:i,configurable:!0,enumerable:!1,writable:!0};return S.defineProperty(t,e,n),t}function c(t){throw t}function p(t){try{if("function"==typeof t){var e=S.names(t.prototype),i=S.isES5&&e.length>1,n=e.length>0&&!(1===e.length&&"constructor"===e[0]),r=M.test(t+"")&&S.names(t).length>0;if(i||n||r)return!0}return!1}catch(t){return!1}}function f(t){function e(){}e.prototype=t;for(var i=8;i--;)new e;return t}function v(t){return F.test(t)}function m(t,e,i){for(var n=new Array(t),r=0;r<t;++r)n[r]=e+r+i;return n}function g(t){try{return t+""}catch(t){return"[no string representation]"}}function y(t){return t instanceof Error||null!==t&&"object"==typeof t&&"string"==typeof t.message&&"string"==typeof t.name}function _(t){try{h(t,"isOperational",!0)}catch(t){}}function b(t){return null!=t&&(t instanceof Error.__BluebirdErrorTypes__.OperationalError||t.isOperational===!0)}function w(t){return y(t)&&S.propertyIsWritable(t,"stack")}function A(t){return{}.toString.call(t)}function k(t,e,i){for(var n=S.names(t),r=0;r<n.length;++r){var s=n[r];if(i(s))try{S.defineProperty(e,s,S.getDescriptor(t,s))}catch(t){}}}function T(t){return U?n.env[t]:void 0}function C(){if("function"==typeof Promise)try{var t=new Promise(function(){});if("[object Promise]"==={}.toString.call(t))return Promise}catch(t){}}function E(t,e){return t.bind(e)}var P,S=i(9),I="undefined"==typeof navigator,V={e:{}},x="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof e?e:void 0!==this?this:null,O=function(t,e){function i(){this.constructor=t,this.constructor$=e;for(var i in e.prototype)n.call(e.prototype,i)&&"$"!==i.charAt(i.length-1)&&(this[i+"$"]=e.prototype[i])}var n={}.hasOwnProperty;return i.prototype=e.prototype,t.prototype=new i,t.prototype},D=function(){var t=[Array.prototype,Object.prototype,Function.prototype],e=function(e){for(var i=0;i<t.length;++i)if(t[i]===e)return!0;return!1};if(S.isES5){var i=Object.getOwnPropertyNames;return function(t){for(var n=[],r=Object.create(null);null!=t&&!e(t);){var s;try{s=i(t)}catch(t){return n}for(var o=0;o<s.length;++o){var a=s[o];if(!r[a]){r[a]=!0;var d=Object.getOwnPropertyDescriptor(t,a);null!=d&&null==d.get&&null==d.set&&n.push(a)}}t=S.getPrototypeOf(t)}return n}}var n={}.hasOwnProperty;return function(i){if(e(i))return[];var r=[];t:for(var s in i)if(n.call(i,s))r.push(s);else{for(var o=0;o<t.length;++o)if(n.call(t[o],s))continue t;r.push(s)}return r}}(),M=/this\s*\.\s*\S+\s*=/,F=/^[a-z$_][a-z$_0-9]*$/i,L=function(){return"stack"in new Error?function(t){return w(t)?t:new Error(g(t))}:function(t){if(w(t))return t;try{throw new Error(g(t))}catch(t){return t}}}(),R=function(t){return S.isArray(t)?t:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var B="function"==typeof Array.from?function(t){return Array.from(t)}:function(t){for(var e,i=[],n=t[Symbol.iterator]();!(e=n.next()).done;)i.push(e.value);return i};R=function(t){return S.isArray(t)?t:null!=t&&"function"==typeof t[Symbol.iterator]?B(t):null}}var j="undefined"!=typeof n&&"[object process]"===A(n).toLowerCase(),U="undefined"!=typeof n&&"undefined"!=typeof n.env,W={isClass:p,isIdentifier:v,inheritedDataKeys:D,getDataPropertyOrDefault:u,thrower:c,isArray:S.isArray,asArray:R,notEnumerableProp:h,isPrimitive:o,isObject:a,isError:y,canEvaluate:I,errorObj:V,tryCatch:s,inherits:O,withAppended:l,maybeWrapAsError:d,toFastProperties:f,filledRange:m,toString:g,canAttachTrace:w,ensureErrorObject:L,originatesFromRejection:b,markAsOriginatingFromRejection:_,classString:A,copyDescriptors:k,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:j,hasEnvVariables:U,env:T,global:x,getNativePromise:C,domainBind:E};W.isRecentNode=W.isNode&&function(){var t=n.versions.node.split(".").map(Number);return 0===t[0]&&t[1]>10||t[0]>0}(),W.isNode&&W.toFastProperties(n);try{throw new Error}catch(t){W.lastLineError=t}t.exports=W}).call(e,function(){return this}(),i(11))},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function(){function t(e){i(this,t),this.label="["+e+"]",this.isDevelopModeOn=this.debugLevels.indexOf("develop")>-1,this.isTrackerOn=this.debugLevels.indexOf("*")>-1||this.debugLevels.indexOf("qa")>-1||this.isDevelopModeOn}return n(t,[{key:"table",value:function(t){this.isDevelopModeOn&&console.table(t)}},{key:"_templateLogging",value:function(t,e,i,n){if(this.isTrackerOn){var r="";for(var s in i)r+=s+": "+i[s]+"; ";"string"==typeof e?console[n]("%c"+this.label+" ["+t+"] "+e,r):console[n]("%c"+this.label+" ["+t+"]",r,e)}}},{key:"debug",value:function(t,e,i){}},{key:"error",value:function(t,e,i){this._templateLogging(t,e,i,"error")}},{key:"warn",value:function(t,e,i){this._templateLogging(t,e,i,"warn")}},{key:"info",value:function(t,e,i){this._templateLogging(t,e,i,"info")}},{key:"log",value:function(t,e,i){this._templateLogging(t,e,i,"log")}}]),t}();r.prototype.debugLevels="",e.default=r},function(t,e,i){"use strict";function n(t,e){function i(n){return this instanceof i?(h(this,"message","string"==typeof n?n:e),h(this,"name",t),void(Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this))):new i(n)}return u(i,Error),i}function r(t){return this instanceof r?(h(this,"name","OperationalError"),h(this,"message",t),this.cause=t,this.isOperational=!0,void(t instanceof Error?(h(this,"message",t.message),h(this,"stack",t.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new r(t)}var s,o,a=i(9),d=a.freeze,l=i(2),u=l.inherits,h=l.notEnumerableProp,c=n("Warning","warning"),p=n("CancellationError","cancellation error"),f=n("TimeoutError","timeout error"),v=n("AggregateError","aggregate error");try{s=TypeError,o=RangeError}catch(t){s=n("TypeError","type error"),o=n("RangeError","range error")}for(var m="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),g=0;g<m.length;++g)"function"==typeof Array.prototype[m[g]]&&(v.prototype[m[g]]=Array.prototype[m[g]]);a.defineProperty(v.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),v.prototype.isOperational=!0;var y=0;v.prototype.toString=function(){var t=Array(4*y+1).join(" "),e="\n"+t+"AggregateError of:\n";y++,t=Array(4*y+1).join(" ");for(var i=0;i<this.length;++i){for(var n=this[i]===this?"[Circular AggregateError]":this[i]+"",r=n.split("\n"),s=0;s<r.length;++s)r[s]=t+r[s];n=r.join("\n"),e+=n+"\n"}return y--,e},u(r,Error);var _=Error.__BluebirdErrorTypes__;_||(_=d({CancellationError:p,TimeoutError:f,OperationalError:r,RejectionError:r,AggregateError:v}),a.defineProperty(Error,"__BluebirdErrorTypes__",{value:_,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error:Error,TypeError:s,RangeError:o,CancellationError:_.CancellationError,OperationalError:_.OperationalError,TimeoutError:_.TimeoutError,AggregateError:_.AggregateError,Warning:c}},function(t,e){"use strict";t.exports={AdLoaded:"AdLoaded",AdStarted:"AdStarted",AdStopped:"AdStopped",AdSkipped:"AdSkipped",AdSkippableStateChange:"AdSkippableStateChange",AdSizeChange:"AdSizeChange",AdLinearChange:"AdLinearChange",AdDurationChange:"AdDurationChange",AdExpandedChange:"AdExpandedChange",AdVolumeChange:"AdVolumeChange",AdImpression:"AdImpression",AdVideoStart:"AdVideoStart",AdVideoFirstQuartile:"AdVideoFirstQuartile",AdVideoMidpoint:"AdVideoMidpoint",AdVideoThirdQuartile:"AdVideoThirdQuartile",AdVideoComplete:"AdVideoComplete",AdClickThru:"AdClickThru",AdInteraction:"AdInteraction",AdUserAcceptInvitation:"AdUserAcceptInvitation",AdUserMinimize:"AdUserMinimize",AdUserClose:"AdUserClose",AdPaused:"AdPaused",AdPlaying:"AdPlaying",AdLog:"AdLog",AdError:"AdError",SoundViolation:"SoundViolation",HijackAttempt:"HijackAttempt",Progress:"Progress"}},function(t,e){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(t){return"function"==typeof t}function r(t){return"number"==typeof t}function s(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(t){if(!r(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},i.prototype.emit=function(t){var e,i,r,a,d,l;if(this._events||(this._events={}),"error"===t&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;var u=new Error('Uncaught, unspecified "error" event. ('+e+")");throw u.context=e,u}if(i=this._events[t],o(i))return!1;if(n(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),i.apply(this,a)}else if(s(i))for(a=Array.prototype.slice.call(arguments,1),l=i.slice(),r=l.length,d=0;d<r;d++)l[d].apply(this,a);return!0},i.prototype.addListener=function(t,e){var r;if(!n(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,n(e.listener)?e.listener:e),this._events[t]?s(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,s(this._events[t])&&!this._events[t].warned&&(r=o(this._maxListeners)?i.defaultMaxListeners:this._maxListeners,r&&r>0&&this._events[t].length>r&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(t,e){function i(){this.removeListener(t,i),r||(r=!0,e.apply(this,arguments))}if(!n(e))throw TypeError("listener must be a function");var r=!1;return i.listener=e,this.on(t,i),this},i.prototype.removeListener=function(t,e){var i,r,o,a;if(!n(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(i=this._events[t],o=i.length,r=-1,i===e||n(i.listener)&&i.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(s(i)){for(a=o;a-- >0;)if(i[a]===e||i[a].listener&&i[a].listener===e){r=a;break}if(r<0)return this;1===i.length?(i.length=0,delete this._events[t]):i.splice(r,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},i.prototype.removeAllListeners=function(t){var e,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[t],n(i))this.removeListener(t,i);else if(i)for(;i.length;)this.removeListener(t,i[i.length-1]);return delete this._events[t],this},i.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?n(this._events[t])?[this._events[t]]:this._events[t].slice():[]},i.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(n(e))return 1;if(e)return e.length}return 0},i.listenerCount=function(t,e){return t.listenerCount(e)}},function(t,e){"use strict";function i(t,e,i,n,r,s){function o(t,e,i,n,r,s,o){if(!t)return!1;e=e||"";var d=new XMLHttpRequest,l=e?"POST":"GET";return d.open(l,t,!0),d.withCredentials=!0,s===!1&&(d.withCredentials=!1),d.setRequestHeader("Content-type",u),d.async=void 0==r||r,d.callback="function"==typeof i?i:function(){},d.fallback="function"==typeof n?n:function(){},d.timeout=o,d.gotResponse=!1,d.addEventListener("error",function(t){this.gotResponse||(this.gotResponse=!0,d.fallback())}),d.addEventListener("load",function(t){this.gotResponse||(this.gotResponse=!0,d.fallback())}),d.addEventListener("abort",function(t){this.gotResponse||(this.gotResponse=!0,d.fallback())}),d.addEventListener("timeout",function(t){this.gotResponse||(this.gotResponse=!0,d.fallback())}),d.addEventListener("readystatechange",function(s){if(4==this.readyState){if(this.gotResponse)return;switch(this.gotResponse=!0,this.status+""){case"200":case"204":case"460":this.callback(this.responseText,p,t);break;default:if(!c)return p.push(this.status),void a(t,e,i,n,r,!1,o,this.status);p.push(this.status),this.fallback(p,t)}}}),d.send(e),!0}function a(t,e,i,n,r,s,a,l){c=!0,d&&(t+=(t.indexOf("?")>-1?"&":"?")+"rt=1&prst="+(l||"")),o(t,e,i,n,r,!1,a)}var d=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5e3,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"application/x-www-form-urlencoded",h=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],c=!h,p=[];o(t,e,i,n,r,s,l)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=i},function(t,e){"use strict";t.exports={tagStarted:0,tagImpression:1,vastFecthError:2,emptyVast:3,mediaFileNotSupported:4,adError:5,filterVastByRegex:6,playerClosed:7,vastError:8,totalTimeout:9,adErrorBeforeLoad:10,networkError:11,adUnitLoadFailed:12,queueExpired:13,queueTrimmed:14,globalTimeout:15,adtoTimeout:16,adSkiped:17,adloadedTimeout:18,hijackAttempt:19,idleMode:20,firstImpression:99,videoFirstQuartile:21,videoMidpoint:22,videoThirdQuartile:23,videoComplete:24,newCompletion:25,replayAd:27,soundViolation:34,firstWfMeasurment:35,playerClosedMeasurment:36,maxNetworkCalls:39,adPlaying:40,adLoaded:41,startAd:42,globalAdTimeout:53,adUnmuted:58,unloadPage:60,adDropped:61,fallBackCanvas:70}},function(t,e){var i=function(){"use strict";return void 0===this}();if(i)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:i,propertyIsWritable:function(t,e){var i=Object.getOwnPropertyDescriptor(t,e);return!(i&&!i.writable&&!i.set)}};else{var n={}.hasOwnProperty,r={}.toString,s={}.constructor.prototype,o=function(t){var e=[];for(var i in t)n.call(t,i)&&e.push(i);return e},a=function(t,e){return{value:t[e]}},d=function(t,e,i){return t[e]=i.value,t},l=function(t){return t},u=function(t){try{return Object(t).constructor.prototype}catch(t){return s}},h=function(t){try{return"[object Array]"===r.call(t)}catch(t){return!1}};t.exports={isArray:h,keys:o,names:o,defineProperty:d,getDescriptor:a,freeze:l,getPrototypeOf:u,isES5:i,propertyIsWritable:function(){return!0}}}},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function t(e){i(this,t),this.parent=e,this.events={},this.dispatchEvent=function t(e,i,n){var r=t.beacon;if(void 0==i&&(i={}),e&&r.events[e]){for(var s=0;s<r.events[e].useCapture.length;s++)r.events[e].useCapture[s].assignedFunction.apply(r.parent,[{dispatcher:n?n:r.parent,type:e,eventData:i,staticData:r.events[e].useCapture[s].static_data}]);for(var s=0;s<r.events[e].noCapture.length;s++)r.events[e].noCapture[s].assignedFunction.apply(r.parent,[{dispatcher:n?n:r.parent,type:e,eventData:i,staticData:r.events[e].noCapture[s].static_data}])}},this.dispatchEvent.beacon=this,this.removeEventListener=function t(e,i){var n=t.beacon;if(e){if(void 0==i&&n.events[e])return void(n.events[e]={useCapture:[],noCapture:[]});if(i&&n.events[e]&&"function"==typeof i){for(var r=[],s=0;s<n.events[e].useCapture.length;s++)n.events[e].useCapture[s].assignedFunction!=i&&r.push(n.events[e].useCapture[s]);n.events[e].useCapture=r,r=[];for(var s=0;s<n.events[e].noCapture.length;s++)n.events[e].noCapture[s].assignedFunction==i&&r.push(n.events[e].noCapture[s]);n.events[e].noCapture=r}}},this.removeEventListener.beacon=this,this.addEventListener=function t(e,i,n){var r=t.beacon;if(e&&"function"==typeof i){for(var s=[],o=3;o<arguments.length;o++)s.push(arguments[o]);r.events[e]||(r.events[e]={useCapture:[],noCapture:[]}),n?r.events[e].useCapture.push({assignedFunction:i,static_data:s}):r.events[e].noCapture.push({assignedFunction:i,static_data:s})}},this.addEventListener.beacon=this,this.listEvents=function t(){return Object.keys(t.beacon.events)},this.listEvents.beacon=this,this.listEventHandlers=function(t){var e=dispatchEvent.beacon;if(!t||!e.events[t])return[];var i,n=[];i=e.events[t].useCapture;for(var r=0;r<i;r++)n.push(e.events[t].useCapture[r]);i=e.events[t].noCapture;for(var r=0;r<i;r++)n.push(e.events[t].noCapture[r]);return n},this.listEventHandlers.beacon=this,this.destroy=function(){for(var t in self.events)self.events[t]=null;self.events={}}};e.default=n},function(t,e){function i(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function r(t){if(u===setTimeout)return setTimeout(t,0);if((u===i||!u)&&setTimeout)return u=setTimeout,setTimeout(t,0);try{return u(t,0)}catch(e){try{return u.call(null,t,0)}catch(e){return u.call(this,t,0)}}}function s(t){if(h===clearTimeout)return clearTimeout(t);if((h===n||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(t);try{return h(t)}catch(e){try{return h.call(null,t)}catch(e){return h.call(this,t)}}}function o(){v&&p&&(v=!1,p.length?f=p.concat(f):m=-1,f.length&&a())}function a(){if(!v){var t=r(o);v=!0;for(var e=f.length;e;){for(p=f,f=[];++m<e;)p&&p[m].run();m=-1,e=f.length}p=null,v=!1,s(t)}}function d(t,e){this.fun=t,this.array=e}function l(){}var u,h,c=t.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:i}catch(t){u=i}try{h="function"==typeof clearTimeout?clearTimeout:n}catch(t){h=n}}();var p,f=[],v=!1,m=-1;c.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];f.push(new d(t,e)),1!==f.length||v||r(a)},d.prototype.run=function(){this.fun.apply(null,this.array)},c.title="browser",c.browser=!0,c.env={},c.argv=[],c.version="",c.versions={},c.on=l,c.addListener=l,c.once=l,c.off=l,c.removeListener=l,c.removeAllListeners=l,c.emit=l,c.prependListener=l,c.prependOnceListener=l,c.listeners=function(t){return[]},c.binding=function(t){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(t){throw new Error("process.chdir is not supported")},c.umask=function(){return 0}},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=i(3),u=(r(l),i(6)),h=i(1),c=n(h),p=i(5),f=r(p),v=i(70),m=2e3,g=function(t){function e(t,i,n,r,a,d,l){s(this,e);var u=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return u.video=t,u.target=l,u.store=a,u.createCanvas(),u.modifyVideo(t),u.owner=i,u.shouldAutoPlay=n||!1,u.canvasCss=r||{},u.bypass=!1,u.clntRedirRslvWhiteList=u.store.get("mpgclrslv")||[],u.ready=!1,u.loop=d,u.vidAttr={},t.muted=!0,u.status="LOADING",u.quartiles=[{event:f.default.AdVideoFirstQuartile,percentage:.25},{event:f.default.AdVideoMidpoint,percentage:.5},{event:f.default.AdVideoThirdQuartile,percentage:.75}],u.owner&&c.logToBI(u.owner.vpaidLog,"canvas",{ctor:!0}),u}return a(e,t),d(e,[{key:"emitStartAd",value:function(){
var t=this;this.stratAdCalled=!0,this._playTimeout=setTimeout(function(){t._play()},m)}},{key:"backToVideoTag",value:function(t){var e=this;if(!this.bypass&&this.src){this.bypass=!0;var i=this.jsmpeg.currentTime,n=this.video.style,r=this.video.parentElement||this.target,s=parseInt(this.canvas.style.zIndex),o=this.jsmpeg.loop;this.newVid=r.insertBefore(document.createElement("video"),this.canvas),this.newVid.className="mc-loud-video",this.newVid.setAttribute("playsinline",""),this.newVid.setAttribute("autoplay",""),o&&this.newVid.setAttribute("loop",""),this.newVid.style.height=n.height,this.newVid.style.width=n.width,this.newVid.style.top=n.top?n.top:"0",this.newVid.style.left=n.left?n.left:"0",this.newVid.style.background="#000000",this.newVid.style.zIndex=s,this.newVid.style.display="none",this.newVid.src=this.src,this.newVid.volume="muteChanged"===t.type?this.store.get("dfltvlm"):0,this.newVid.muted=0===this.newVid.volume,this.newVid.addEventListener("ended",function(t){e.dispatchDOM("ended")},!1),this.newVid.addEventListener("click",function(t){e.dispatchDOM("click",t)});var a=function(){e.tuTicker=clearInterval(e.tuTicker),e.jsmpeg.stop(),e.jsmpeg=void 0,e.newVid.style.display="block",e.canvas.style.display="none",e.video.style.display="none",("playChanged"===t.type||e.video.paused)&&e._pause(),e.emit("newVidCreated",e.newVid)},d=function t(){if(0!==e.newVid.duration){e.newVid.removeEventListener("durationchange",t);var n=e.jsmpeg&&e.jsmpeg.currentTime>0?e.jsmpeg.currentTime:i;if(0===e.newVid.currentTime||e.newVid.currentTime<n){e.newVid.currentTime=n;var r=function t(){e.newVid.currentTime>n&&(e.newVid.removeEventListener("timeupdate",t),a())};e.newVid.addEventListener("timeupdate",r)}}};this.newVid.addEventListener("durationchange",d),this.newVid.currentTime=i,this.newVid.play().then(function(){e.newVid.currentTime=i}),this.isCanvasFinished=!1}}},{key:"mpegFinish",value:function(){this.isCanvasFinished||(this.emit("canvasEnded"),this.dispatchDOM("ended"),this.isCanvasFinished=!0)}},{key:"onLoad",value:function(){var t=this;if(!this.loaded){this.loaded=!0;var e=parseInt(this.store.get("width")),i=parseInt(this.store.get("height"));this.onResize(e,i),setTimeout(function(){t.ready=!0,t.emit("ready"),t.dispatchDOM("loadedmetadata")},0)}}},{key:"createCanvas",value:function(){var t=this,e=document.createElement("canvas");e.className="mc-canvas",this.store.get("isMultiVpaidUnit")&&c.addClass(e,"multi-vpaids");var i=this.video.parentElement||this.target;this.canvas=i.appendChild(e),i.className+=" mpegcnv";var n=this;this.video&&this.video.addEventListener("resize",function(t){n.onResize(t.target.clientWidth,t.target.clientHeight)}),this.canvas.addEventListener("click",function(e){t.dispatchDOM("click",e)})}},{key:"_getAspectRatio",value:function(){var t=this.store.get("playerAspectRatio");if(t&&t.indexOf(":")){var e=t.split(":");if(2===e.length&&e[0]&&e[1])return e}return!1}},{key:"onResize",value:function(t,e){var i,n;if(t||e){var r=this._getAspectRatio();r?t?(e=e||this.store.get("height"),n=t,i=Math.floor(parseFloat(t)*parseInt(r[1])/parseInt(r[0]))):(t=this.store.get("width"),i=e,n=Math.floor(parseFloat(e)*parseInt(r[0])/parseInt(r[1]))):(n=t,i=e),this.jsmpeg&&this.canvas&&(this.canvas.style.position="absolute",this.canvas.style.top="0px",this.canvas.style.width=n+"px",this.canvas.style.height=i+"px",this.canvas.style.marginTop=(e-i)/2+"px",this.canvas.style.marginLeft=(t-n)/2+"px"),this.height=e,this.width=t}}},{key:"hookProp",value:function(t,e,i,n){var r="alt_"+e;t.hasOwnProperty(r)||(t[r]="",Object.defineProperty(t,e,{get:function(){var t=i?i():this[r];return t},set:function(i){this[r]=i,n&&n(i)&&t.setAttribute(e,i)}}))}},{key:"hookMethod",value:function(t,e,i){this.hooks||(this.hooks=[]),this.hooks[e]=t[e];var n=this;t[e]=function(){var t={};if(i(arguments,t)){if(!n.hooks.hasOwnProperty(e)||"function"!=typeof n.hooks[e])return!1;var r=n.hooks[e].apply(this,arguments);return t.res?t.res:r}}}},{key:"dispatchDOM",value:function(t,e){if(this.video){var i=new Event(t);this.video.dispatchEvent(i)}}},{key:"errHndlr",value:function(t){this.owner&&(c.logToBI(this.owner.vpaidLog,"jsmpegError",t),this.owner._onPlayerError&&this.owner._onPlayerError())}},{key:"isUrlInRslvWhiteList",value:function(t){if(!this.clntRedirRslvWhiteList.length)return!0;for(var e=0;e<this.clntRedirRslvWhiteList.length;++e)if(t.indexOf(this.clntRedirRslvWhiteList[e])>-1)return!0;return!1}},{key:"setSrc",value:function(t){if(t=t.trim(),t&&!this.hasVidUrl){c.logToBI(this.owner.vpaidLog,"canvasUrl",{url:t},!1,!1),this.hasVidUrl=!0,this.owner.vpaid&&this.video&&this.video._vidSetAttr("src",t),this.src=t;var e=this.store.get("cnvsldrt"),i=parseInt(this.store.get("width")),n=parseInt(this.store.get("height")),r={loadeReadyRate:e,canvas:this.canvas,audio:!1,centerVertically:!0,autoplay:this.shouldAutoPlay,loop:this.loop||!1,pcy:n,pcx:i,onload:this.onLoad.bind(this),errHndlr:this.errHndlr.bind(this),onfinished:this.mpegFinish.bind(this),progressive:!1,canvasCss:this.canvasCss,disableGl:this.store.get("dsbgl")},s=this.store.get("gtvid2"),o=s+"="+encodeURIComponent(t);return(/\.mpg$/.test(t)||/\.mpeg$/.test(t))&&(o=t),this.jsmpeg=new v(o,r,this),this._setVideoDuration(this.src),!1}}},{key:"_play",value:function(){var t=this;if(!this.blockActions){if(clearTimeout(this._playTimeout),this._timeUpdateTicker(),!this.ready)return void this.on("ready",function(){t.emit("play"),t._play()});this.newVid?this.newVid.play():this.jsmpeg.play(),this.dispatchDOM("playing"),this.status="PLAYING",this._render()}}},{key:"_timeUpdateTicker",value:function(){var t=this;clearInterval(this.tuTicker),this.tuTicker=setInterval(function(){t.dispatchDOM("timeupdate"),t.quartiles.length>0&&t.video.currentTime/t.video.duration>=t.quartiles[0].percentage&&c.logToBI(t.owner.vpaidLog,"canvas_quartiles",{event:t.quartiles.shift().event})},250)}},{key:"_pause",value:function(){this.stopped||(this.status="PAUSED",this._render(),this.newVid?this.newVid.pause():this.jsmpeg?this.jsmpeg.pause():"")}},{key:"muteButtonClick",value:function(t){if(!this.stopped){var e=!!this.newVid&&!this.newVid.muted;if(c.logToBI(this.owner.vpaidLog,"canvasMuteToggle",{muted:e}),!this.newVid)return void this.backToVideoTag({type:"muteChanged"});this.newVid.volume=this.newVid.muted?this.store.get("dfltvlm"):0,this.newVid.muted=0===this.newVid.volume}}},{key:"playButtonClick",value:function(t){if(!this.stopped){var e="PLAYING"===this.status?"PAUSED":"PLAYING";if(c.logToBI(this.owner.vpaidLog,"canvasPlayToggle",{status:e,view:this.newVid?"newVid":"canvas"}),this.status=e,!this.newVid)return void this.backToVideoTag({type:"playChanged"});var i=this.newVid||this.jsmpeg;"PLAYING"===this.status?i.play():i.pause(),this._render()}}},{key:"modifyVideo",value:function(t){var e=this;if(!this.stopped){var i=this;t._vidSetAttr=t.setAttribute,t.getAttribute=function(t,i){return e.vidAttr[t]},t.setAttribute=function(n,r){if(!i.stopped)return e.vidAttr[n]=r,"volume"===n&&(e._volume=r),c.logToBI(i.owner.vpaidLog,"hookSetAttribute",{key:n,val:r}),"src"===n?void e.setSrc(r):t._vidSetAttr(n,r)},this.hookMethod(t,"play",function(){if(!i.stopped)return i._play(),i.dispatchDOM("playing"),!1}),this.hookMethod(t,"pause",function(){if(!i.stopped)return i._pause(),!0}),this.hookMethod(t,"stop",function(){if(!i.stopped)return i.jsmpeg.stop(),!0}),this.hookProp(t,"paused",function(){return"PAUSED"===this.status}.bind(this),null),this.hookProp(t,"src",null,this.setSrc.bind(this)),this.hookProp(this.video,"volume",function(){return e.newVid?e.newVid.volume:e._volume},function(t){return e._volume=t,!0}),this.hookProp(t,"currentTime",function(){var t=i.newVid||i.jsmpeg;return t?t.currentTime:0},null),this.hookProp(t,"duration",function(){if(i.duration)return i.duration},function(t){i.duration=t})}}},{key:"_setVideoDuration",value:function(t){var e=this,i=document.createElement("video");i.src=t,i.addEventListener("loadedmetadata",function(){e.video&&(e.video.duration=i.duration),i.src="",i=void 0}),i.load()}},{key:"_render",value:function(){this.newVid||this.canvas}},{key:"hide",value:function(){this.stopped||(this.canvas.style.display="none",this._render())}},{key:"show",value:function(){this.stopped||(this.canvas.style.display="block",this._render())}},{key:"removeDomMember",value:function(t){var e=t.parentNode;e.removeChild(t)}},{key:"restartAd",value:function(){var t=this;this.stopped||(this.newVid?(this.newVid.currentTime=0,this.newVid.play()):this.jsmpeg&&(this.blockActions=!0,this.jsmpeg.stop(),setTimeout(function(){t.jsmpeg.play()},20),setTimeout(function(){t.blockActions=!1},2e3)))}},{key:"destroy",value:function(){clearTimeout(this._playTimeout),clearInterval(this.tuTicker),this.jsmpeg=void 0;var t=this._events;for(var e in t)this.removeAllListeners(e);this.removeDomMember(this.canvas),this.canvas=void 0}}]),e}(u.EventEmitter);e.default=g},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=i(1),a=n(o),d={undefinedIframeSrc:"undefinedIframeSrc",event_AdImpression:"conversion",event_SoundViolation:"soundViolation",adStartTimeout:"adStartTimeout",AutoKill:"auto_kill",AdStopADTO:"before_startAd_timeout",queueTrimmed:"queueTrimmed",adPlayTimeout:"adPlayTimeout",queueExpired:"removed_from_queue",tagError:"tagError",vastFilterdByRegex:"vast_blacklisted",event_AdLoaded:"adLoaded",fetchVastXhr:"fetchVastXhr",fetchVastFallToXhr:"fetchVastFallToXhr",vpaidTimeout_AdLoaded:"adload_timeout",creatingVpaidHandler:"initVpaid",createdVpaidHandler:"before_adload",creatingVpaidHandlerError:"creatingVpaidHandlerError",networkError:"networkError",adUnitLoadFailed:"vpaid_unit_failed",adloadedTimeout:"adload_timeout",adImpressionTimeout:"adImpressionTimeout",playerClosed:"playerClosed",idleMode:"idleMode",hijackAttempt:"vpaid_blacklisted_url"},l=["conversion","soundViolation","timeout","bfRon","adPlayTimeout","vast_blacklisted","tagError","queueTrimmed","before_startAd_timeout","auto_kill","vpaidTimeout","creatingVpaidHandlerError","networkError","vpaid_unit_failed","adload_timeout","adImpressionTimeout","idleMode","vpaid_blacklisted_url","removed_from_queue"],u={NoMediaFiles:"empty_vast",event_AdError:"ad_error",vastxhrerror_noflash:"vast_fetch_fail",WrapperError:"wrapper_error",ParsingError:"xml_parsing_error",NoMediaFileAfterSort:"unsupported_mediafile"},h={BfRon:!0},c={difa:"idfa",aid:"appId",aname:"appName"},p=1e4,f=function(){function t(e,i){var n=this;r(this,t),this.tag=e,this.store=i,this.created=Date.now(),this.dataChanged=!1,this.friendlyVideoUrl=!1,this.iframesDetector=this.store.get("iframesDetector");var s=this.store.get("dast"),o="";s&&(o=s.cicmp);var d=this.store.get("subUnitType");this.sessionStarted=this.store.get("session_started")||this.created,this.data={_id:a.generateGuid(10),player_id:this.store.get("player_id"),tag:e,isMobile:e.isMobile,created:(new Date).toISOString(),timeSinceSessionStarted:this.created-this.sessionStarted,dp:e.dp,status:"new",statuses:["new"],itemScore:-1,fullPageUrl:this.store.get("fullPageUrl"),documentVisible:!document.hidden,oneAuction:this.store.get("mltads"),su:void 0!=d?d:-99999,redId:this.store.get("red_id")||"na",displayLineItem:o,updatesCount:0,serverSideDataSaver:this.store.get("serverSideDataSaver")||"na",clientSideDataSaver:this.store.get("clientSideDataSaver")||"na",dataSaver:this.store.get("dataSaver"),taboolaVpaid:this.store.get("istblvpd"),hasDsm:!!this.store.get("dsm"),hasVpaidAnalytics:!!this.store.get("analyticsFuncString"),isAmp:this.store.get("isAmp"),isCPCV:e.isCPCV},Object.assign(this.data,this._getDastData()),this.isReportDb=!1,this.dtor=!1,this._dataModified=!0,this.updatingInterval=setInterval(function(){n._dataModified&&n._sendData()},p)}return s(t,[{key:"_getDastData",value:function(){var t=this.store.get("dast")||{},e={},i=!1;for(var n in c){var r=t[n];if(r){var s=c[n];e[s]=r,i=!0}}return e.inApp=i,this.store.set("isInApp",i),e}},{key:"push",value:function(t,e,i){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(this.data){if(t.indexOf("AdError")>-1||"event_SoundViolation"===t)this._addStatus(this._prettyErrorStatus(t,e));else if(d.hasOwnProperty(t)&&"conversion"!==this.data.status)this._addStatus(d[t]);else if(h.hasOwnProperty(t)){var r="is"+t;this.data[r]=!0}if(n){var s=Date.now(),o=s-this.created;e.time=o}if(this._dataChanged(),!i&&this.data.hasOwnProperty(t))return Array.isArray(this.data[t])||(this.data[t]=[this.data[t]]),this.data[t].push(e),void(this.data[t].length>3&&this.data[t].splice(0,1));this.data[t]=e,l.indexOf(this.data.status)!==-1&&this._setDpStats()}}},{key:"_dataChanged",value:function(){this._dataModified=!0}},{key:"_sendData",value:function(){this._collectDataFromVpaidAnalytics(),this.data&&this.data.updatesCount++,a.reportDb("VpaidLog",this.data,this.store),this._dataModified=!1}},{key:"_collectDataFromVpaidAnalytics",value:function(){try{if(this.getVpaidAnalyticsReport){var t=this.getVpaidAnalyticsReport();t.realTotalRequestsCounter=t.totalRequestsCounter,this._wrappersCount&&(t.totalRequestsCounter+=this._wrappersCount,t.wrappersCount=this._wrappersCount);var e=this.iframesDetector.detect(t.iframes,this.friendlyVideoUrl);t.totalRequestsCounter+=this.iframesDetector.calculateWeightsByIframeType(e),t.totalRequestsCounter-=t.iframes.length,this.push("vpaidAnalytics",t,!0),this.push("vpaidIframesDetection",e,!0)}}catch(t){this.push("vpaidAnalyticsCollectFail",{ex:t})}}},{key:"_prettyErrorStatus",value:function(t,e){var i=e.errType?e.errType:t;return u.hasOwnProperty(i)?u[i]:"error_"+i}},{key:"_setDpStats",value:function(){if(!this.isDPStatusSet&&!this.store.get("static_schedule")){var t=Date.now();if(this.data.dtor=!0,this.data.timeFromLastPlayFromQueue=t-this.store.get("playFromQueue"),this.data.timeFromLastPlayFromQueueFound=t-this.store.get("playFromQueueFound"),this.isDPStatusSet=!0,this._incrStats(".tries"),"conversion"===this.data.status){this._incrStats(".conversions"),this.store.set(this.tag.dp+".failsRow",0);var e=this.store.get(this.tag.lineItem+".failsRow");this.store.set(this.tag.lineItem+".failsInARowTillConversion",e<0?0:e),this.store.set(this.tag.lineItem+".failsRow",0)}else this._incrStats(".fails"),this.store.get(this.tag.lineItem+".failsRow")<0?this.store.set(this.tag.lineItem+".failsRow",1):this._incrStats(".failsRow");var i=this.store.get(this.tag.dp)||{fails:0,failsRow:0,conversions:0},n=this.store.get(this.tag.lineItem)||{};n.fails||(n.fails=0),n.failsRow||(n.failsRow=0),n.conversions||(n.conversions=0),i.lineItems=i.lineItems||[],i.lineItems.indexOf(this.tag.lineItem)===-1&&i.lineItems.push(this.tag.lineItem),this.data.lineItemLog=n,this.data.dpLog=i,this.data.conversionsCount=this.store.get("conversionsCount"),this.data.unit={width:this.store.get("width"),height:this.store.get("height")};var r=this.store.get("lineItems")||[];r.indexOf(this.tag.lineItem)===-1&&(r.push(this.tag.lineItem),this.store.set("lineItems",r)),this.store.set(this.tag.lineItem,n)}}},{key:"_incrStats",value:function(t){this.store.incr(this.tag.dp+t),this.store.incr(this.tag.lineItem+t)}},{key:"saveToDb",value:function(){if(this.data){this._collectDataFromVpaidAnalytics(),this._setDpStats();var t;try{t=cmTag.utils.getLoopTime()}catch(t){}t&&(this.data.loopTime=t),this._reportDb()}}},{key:"_reportDb",value:function(){this.isReportDb||(this.data.updatesCount++,a.reportDb("VpaidLog",this.data,this.store),this.tag=null,this.data=null,this.store=null,this.isReportDb=!0,this._dataModified=!1,clearInterval(this.updatingInterval))}},{key:"_addStatus",value:function(t){var e=this;l.indexOf(this.data.status)===-1&&(this.data.status=t,this.data.statuses.push(t),"conversion"===t&&setTimeout(function(){e._sendData()},2e3))}},{key:"toString",value:function(){return a.stringify(this.data,4)}},{key:"setVastWrapperCount",value:function(t){this._wrappersCount=t}}]),t}();e.default=f},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(3),d=r(a),l=i(5),u=r(l),h=i(10),c=r(h),p=i(1),f=n(p),v=function(){function t(e,i,n){s(this,t),this.vpaidLog=i,this.store=n,this.type="adx",this.stopped=!1,this.target=e.slot,this.adxScript=e.tag.url,this.isAmp=this.store.get("isAmp"),this.debugTracker=new d.default("AdxVpaid"),this.baseUrl=this.store.get("base_url"),this._onError=e.onError,this.vpaidEvents=Object.assign({},u.default),this.beacon=new c.default(this),this.gotAd=!1,this.adxCardSize=this.store.get("adxCardSize"),this.isAmp?this._buildAmpMethods():this._buildNonAmpMethods(),f.logToBI(this.vpaidLog,"adxCard",{width:this.adxCardSize.width,height:this.adxCardSize.height,card:this.adxScript}),setTimeout(e.onReady,2)}return o(t,[{key:"_buildNonAmpMethods",value:function(){this._initAd=this._initOnNonAmpPage.bind(this),this._parseScript=this._parseScriptOnNonAmpPage.bind(this),this._startAd=this._startOnNonAmpPage.bind(this),this._didConvert=this._didConvertOnNonAmpPage.bind(this)}},{key:"_buildAmpMethods",value:function(){this._initAd=this._initOnAmpPage.bind(this),this._parseScript=this._parseScriptOnAmpPage.bind(this),this._startAd=this._startOnAmpPage.bind(this),this._didConvert=this._didConvertOnAmpPage.bind(this)}},{key:"subscribe",value:function(t,e){this.vpaidEvents[e]&&this.beacon.addEventListener(e,t)}},{key:"unsubscribe",value:function(t,e){if(this.vpaidEvents[e]){if(!t)return;this.beacon.removeEventListener(e,t)}}},{key:"handshakeVersion",value:function(t){return"2.0"}},{key:"initAd",value:function(t,e,i,n,r,s){if(!this.stopped){var o=this._parseScript((new DOMParser).parseFromString(this.adxScript,"text/html"));if(!o)return void this.beacon.dispatchEvent(this.vpaidEvents.AdError,{error:"parsingIssue"});this.adxContainer=document.createElement("div"),this.adxContainer.style.textAlign="center",this.resizeAd(this.store.get("width"),this.store.get("height")),this.target.appendChild(this.adxContainer),this._initAd(),this.beacon.dispatchEvent(this.vpaidEvents.AdLoaded,{})}}},{key:"_initOnNonAmpPage",value:function(){this.adxContainer.id=this.adxDivElement.id;var t=document.createElement("script"),e=document.createElement("script");t.src=this.adxScriptElements[0].src,t.async=!0,this.adxContainer.appendChild(t),e.innerText=this.adxScriptElements[1].innerText,this.adxContainer.appendChild(e)}},{key:"_initOnAmpPage",value:function(){var t=document.createElement("script");t.src="https://cdn.ampproject.org/amp4ads-v0.js",t.async=!0,document.head.appendChild(t)}},{key:"_parseScriptOnNonAmpPage",value:function(t){return this.adxScriptElements=t.getElementsByTagName("script"),this.adxDivElement=t.getElementsByTagName("div")[0],3===this.adxScriptElements.length}},{key:"_parseScriptOnAmpPage",value:function(t){return this.adxAmpAdElement=t.getElementsByTagName("amp-ad")[0],this.adxAmpAdElement}},{key:"_getMediaUrl",value:function(){return""}},{key:"startAd",value:function(){if(!this.stopped){var t=this._startAd();this.adxContainer.appendChild(t),this._waitForConversion()}}},{key:"_startOnNonAmpPage",value:function(){var t=document.createElement("script");return t.innerText=this.adxScriptElements[2].innerText,t}},{key:"_startOnAmpPage",value:function(){for(var t=document.createElement("amp-ad"),e=0;e<this.adxAmpAdElement.attributes.length;e++)t.setAttribute(this.adxAmpAdElement.attributes[e].name,this.adxAmpAdElement.attributes[e].value);return t}},{key:"_waitForConversion",value:function(){var t=this,e=Date.now();this.lookForAdxAdInterval=setInterval(function(){t.stopped||t._didGotAdxAd()&&(t.gotAd=!0,t.lookForAdxAdInterval=clearInterval(t.lookForAdxAdInterval),t.didGotAdxAdTimeout=clearTimeout(t.didGotAdxAdTimeout),f.logToBI(t.vpaidLog,"adxCard",{gotAd:!0,timeToImpression:Date.now()-e}),t.beacon.dispatchEvent(t.vpaidEvents.AdImpression))},100),this.didGotAdxAdTimeout=setTimeout(function(){t.stopped||(t.lookForAdxAdInterval=clearInterval(t.lookForAdxAdInterval),f.logToBI(t.vpaidLog,"adxCard",{gotAd:!1},!0),t.beacon.dispatchEvent(t.vpaidEvents.AdError,{error:"noFill"}))},this.store.get("adxcrdgtadtmt")||5e3)}},{key:"_didGotAdxAd",value:function(){try{for(var t=this.adxContainer.querySelectorAll("iframe"),e=0;e<t.length;e++)if(this._didConvert(t[e]))return!0}catch(t){}return!1}},{key:"_didConvertOnNonAmpPage",value:function(t){return t&&t.getAttribute("data-load-complete")}},{key:"_didConvertOnAmpPage",value:function(t){return t&&t.src}},{key:"isReplayable",value:function(){return!1}},{key:"resizeAd",value:function(t,e,i){this.stopped||(this.width=t,this.height=e,this.adxContainer.style.width=t+"px",this.adxContainer.style.height=e+"px",this.adxContainer.style.marginTop=this._calcMarginTop())}},{key:"_calcMarginTop",value:function(){return this.height<=this.adxCardSize.height?"0px":(this.height-this.adxCardSize.height)/2+"px"}},{key:"getAdWidth",value:function(){return this.width}},{key:"getAdHeight",value:function(){return this.height}},{key:"getDOMContainer",value:function(){return this.adxContainer}},{key:"getVideoUrl",value:function(){return""}},{key:"getVPAIDVideoElement",value:function(){return null}},{key:"stopAd",value:function(){this.stopped=!0,this.adxContainer=this.injectionMethods=this._initAd=this._parseScript=this._startAd=this._didConvert=void 0,this.lookForAdxAdInterval=clearInterval(this.lookForAdxAdInterval),this.didGotAdxAdTimeout=clearTimeout(this.didGotAdxAdTimeout)}},{key:"pauseAd",value:function(){}},{key:"resumeAd",value:function(){}},{key:"skipAd",value:function(){}},{key:"expandAd",value:function(){}},{key:"collapseAd",value:function(){}},{key:"getAdSkippableRemainingTime",value:function(){}},{key:"getAdRemainingTime",value:function(){}},{key:"getAdDuration",value:function(){}},{key:"getAdSkippableState",value:function(){}},{key:"getAdVolume",value:function(){}},{key:"getAdIcons",value:function(){}},{key:"getAdCompanions",value:function(){}},{key:"getAdExpanded",value:function(){}},{key:"getAdLinear",value:function(){}},{key:"logVideoUrl",value:function(){}}]),t}();e.default={type:18,vpaid:v,selectValidSize:function(t){for(var e=t.get("creatives"),i=e.PLAYER_WIDTH||t.get("width"),n=e.PLAYER_HEIGHT||t.get("height"),r=300,s=250,o=(t.get("adtnladxsprtdszs")||[],[{width:580,height:400},{width:336,height:280},{width:300,height:250}].concat(t.get("adtnladxsprtdszs")||[]).sort(function(t,e){var i=t.width-e.width,n=t.height-e.height;return 0===i&&0===n?0:i>0||0===i&&n>0?-1:1})),a=0;a<o.length;a++)if(i>=o[a].width&&n>=o[a].height){r=o[a].width,s=o[a].height;break}t.set("adxCardSize",{width:r,height:s})}}},function(t,e){"use strict";function i(){}function n(t,e){return t?null:new Error(e)}function r(t){var e=v[t];e&&(clearTimeout(e),delete v[t])}function s(t,e,n){var s,o;return o=setTimeout(function(){e=i,delete o[s],n()},t),s=function(){e.apply(this,arguments)&&r(s)},v[s]=o,s}function o(t,e,i){var n=document.createElement(e);return i&&(n.id=i),t.appendChild(n),n}function a(t,e,i){var n=d(t,null,i.zIndex);if(h(n,u(e,i)))return n}function d(t,e,i){var n=document.createElement("iframe");return n.src=e||"about:blank",n.marginWidth="0",n.marginHeight="0",n.frameBorder="0",n.width="100%",n.height="100%",l(n),i&&(n.style.zIndex=i),n.setAttribute("SCROLLING","NO"),t.innerHTML="",t.appendChild(n),n}function l(t){t.style.position="absolute",t.style.left="0",t.style.top="0",t.style.margin="0px",t.style.padding="0px",t.style.border="none",t.style.width="100%",t.style.height="100%"}function u(t,e){return Object.keys(e).forEach(function(i){var n="object"===("undefined"==typeof n?"undefined":f(n))?JSON.stringify(e[i]):e[i];t=t.replace(new RegExp("{{"+i+"}}","g"),n)}),t}function h(t,e){var i=t.contentWindow&&t.contentWindow.document;return!!i&&(i.write(e),!0)}function c(t,e){return Object.keys(e).forEach(function(i){t[i]=e[i]}),t}function p(t){var e=-1;return function(){return t+"_"+ ++e}}var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v={};t.exports={noop:i,validate:n,clearCallbackTimeout:r,callbackTimeout:s,createElementInEl:o,createIframeWithContent:a,createIframe:d,setFullSizeStyle:l,simpleTemplate:u,setIframeContent:h,extend:c,unique:p}},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),d=i(1),l=n(d),u=i(6),h="ad",c=function(t){function e(t,i,n,o,a){r(this,e);var d=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return d.store=i,d.video=t,d.target=t.parentElement||n,d.isMobile=d.store.get("isMobile"),d.useVideoControls=d.store.get("useVideoControls"),d.disclosureText=d.store.get("disctxt"),d.defaultVolume=d.store.get("dfltvlm"),d.hideAdsPlayPauseButton=d.store.get("hdeadsplypusbtn"),d.showAdMuteButton=d.store.get("shwadmtebtn"),d.initBg=!1,d.vpaidWrapper=a,d.mutedChangeByUserGesture=!1,d.state={},d._onSoundChange=function(){},d.isMobile?d._buildMobileControls():d._buildDesktopControls(),d._createElements(),d._addControlsEventListeres(),d._addSoundEventListener(),d._setInitialState(o),d.store.on("playerStatusChanged",d._onPlayerStatusChanged.bind(d)),d}return o(e,t),a(e,[{key:"_setInitialState",value:function(t){var e={volume:0,volumeBeforeMute:0,adDuration:0,adCurrentTime:0,adTickerId:0,adLastTickTime:0,isMuted:0===this.store.get("volume")||this.isMobile||!!this.canvas,isPaused:!1,playerState:t,vidDuration:30,vidCurrentTime:0,isVisible:t!==h};this.setState(e)}},{key:"_buildDesktopControls",value:function(){this._createElements=this._createDesktopElements.bind(this),this._addControlsEventListeres=this._addDesktopControlsEventListeners.bind(this),this._renderControls=this._renderDesktopControls.bind(this),this._onVolumeStateChanged=this._onDesktopVolumeStateChanged.bind(this),this._destroyControlsEvents=this._destroyDesktopControlsEvents.bind(this)}},{key:"_buildMobileControls",value:function(){this._createElements=this._createMobileElements.bind(this),this._addControlsEventListeres=this._addMobileControlsEventListeners.bind(this),this._renderControls=this._renderMobileControls.bind(this),this._onVolumeStateChanged=this._onMobileVolumeStateChanged.bind(this),this._destroyControlsEvents=this._destroyMobileControlsEvents.bind(this),this._toggleVpaidMute=this.resetAdControls=function(){}}},{key:"resetAdControls",value:function(){this._isAdState()&&this.vpaidWrapper&&this.setState({preventAdTicker:""!==this.vpaidWrapper.getVideoUrl(),isMuted:!0})}},{key:"_onPlayerStatusChanged",value:function(t){this.setState({playerState:t})}},{key:"_isAdState",value:function(){return this.state.playerState===h}},{key:"_isWorkingVpaid",value:function(t){return this._isAdState()&&t.workingVpaid}},{key:"_onControlsVisibilityChanged",value:function(){var t=this;this.useVideoControls&&requestAnimationFrame(function(){l.removeClass(t.element,t.state.isVisible?"hide":"show"),l.addClass(t.element,t.state.isVisible?"show":"hide")})}},{key:"_addDesktopControlsEventListeners",value:function(){this.target.addEventListener("dragstart",function(){}),this.element.addEventListener("click",function(t){t.stopPropagation()}),this._bindedOnProgressBarDown=this._onProgressBarDown.bind(this),this.progressBarArea.addEventListener("mousedown",this._bindedOnProgressBarDown),this._bindedOnPlayPauseClicked=this._onDesktopPlayPauseClicked.bind(this),this.playBtn.addEventListener("click",this._bindedOnPlayPauseClicked),this.pauseBtn.addEventListener("click",this._bindedOnPlayPauseClicked),this._bindedOnProgressBarOut=this._onProgressBarOut.bind(this),this._bindedOnProgressBarMove=this._onProgressBarMove.bind(this),this._addContentVideoEventListeners(),this._bindedOnMuteClicked=this._onDesktopMuteClicked.bind(this)}},{key:"_addMobileControlsEventListeners",value:function(){this._bindedOnPlayPauseClicked=this._onMobilePlayPauseClicked.bind(this),this._bindedOnMuteClicked=this._onMobileMuteClicked.bind(this),this._bindedOnVideoEvent=this._onVideoEvent.bind(this),this.playPauseArea.addEventListener("click",this._bindedOnPlayPauseClicked),this.video&&this.video.addEventListener("timeupdate",this._bindedOnVideoEvent)}},{key:"_addSoundEventListener",value:function(){this.soundElement.addEventListener("click",this._bindedOnMuteClicked)}},{key:"_createDesktopElements",value:function(){this.element=document.createElement("div"),this.element.className="video_controls hide",this.element.innerHTML="<div class='video_controls video_controls_main_area'>\n                <div class='title text'>"+this.disclosureText+"</div>\n                <div class='cm_video_controls_progressbar_area'>\n                    <div class='cm_video_controls_progressbar_bg white_bg'></div>\n                    <div class='cm_video_controls_progressbar blue_bg'></div>\n                </div>\n                <div class='cm_video_controls_mute interactive display_mute'></div>\n                <div class='cm_video_controls_playpause interactive hide'>\n                    <div class='pause hide'></div>\n                    <div class='play'></div>\n                </div>\n            </div>",this.target.appendChild(this.element),this.mainArea=this.element.children[0],this.progressBarArea=this.mainArea.children[1],this.progressBarBg=this.progressBarArea.children[0],this.progressBarPercentager=this.progressBarArea.children[1],this.soundElement=this.mainArea.children[2],this.playPauseArea=this.mainArea.children[3],this.pauseBtn=this.playPauseArea.children[0],this.playBtn=this.playPauseArea.children[1],this.store.get("can_opt_out")||l.addClass(this.mainArea.children[0],"opt-out-hidden")}},{key:"_createMobileElements",value:function(){this.element=document.createElement("div"),this.element.className="video_controls_mobile",this.element.innerHTML='<div class="mc-pause hide" style="pointer-events: all;"></div>\n            <div class="speaker mute" style="pointer-events: all;"></div>\n            <div class="mc-progressbar_area">\n                <div class=\'mc-progressbar_bg white_bg\'></div>\n                <div class=\'mc-progressbar_bg blue_bg\'></div>\n            </div>\n            <div class="tbl-text">'+this.disclosureText+"</div>",
(this.video.parentElement||this.target).appendChild(this.element),this.playPauseArea=this.element.children[0],this.soundElement=this.element.children[1],this.progressBarArea=this.element.children[2],this.progressBarBg=this.progressBarArea.children[0],this.progressBarPercentager=this.progressBarArea.children[1]}},{key:"_setVideoProgress",value:function(){var t=this;requestAnimationFrame(function(){var e=(t.state.vidDuration-t.state.vidCurrentTime)/t.state.vidDuration*100,i=100-e,n=i+"%";if(t.progressBarPercentager.style.width!==n){var r=parseInt(t.progressBarPercentager.style.width);isNaN(r)||parseInt(i)<r?t.initBg||(t.initBg=!0,l.addClass(t.progressBarPercentager,"init_bg")):t.initBg&&(t.initBg=!1,l.removeClass(t.progressBarPercentager,"init_bg")),t.progressBarPercentager.style.width=n}})}},{key:"_addContentVideoEventListeners",value:function(){this._bindedOnVideoEvent=this._onVideoEvent.bind(this),this._bindedOnVideoClick=this._onVideoClick.bind(this),this.video.addEventListener("durationchange",this._bindedOnVideoEvent),this.video.addEventListener("progress",this._bindedOnVideoEvent),this.video.addEventListener("timeupdate",this._bindedOnVideoEvent),this.video.addEventListener("playing",this._bindedOnVideoEvent),this.video.addEventListener("pause",this._bindedOnVideoEvent),this.video.addEventListener("click",this._bindedOnVideoClick)}},{key:"_onVideoClick",value:function(t){this.video.currentTime===this.video.duration&&(this._isAdState()||(this.video.play(),t.stopPropagation()))}},{key:"_onVideoEvent",value:function(t){if(!this._isAdState()){if("timeupdate"===t.type)return void this.setState({vidDuration:this.video.duration,vidCurrentTime:this.video.currentTime});var e={volume:this.video.volume,isMuted:0===this.video.volume};"pause"!==t.type&&"playing"!==t.type||(e.isPaused="pause"===t.type),this.setState(e)}}},{key:"setVpaidHandler",value:function(t){this.vpaid=t,this._addVpaidListeners()}},{key:"_addVpaidListeners",value:function(){this._bindedOnVpaidEvent=this._onVpaidEvent.bind(this),this.vpaid.on("AdVolumeChange",this._bindedOnVpaidEvent),this.vpaid.on("AdPaused",this._bindedOnVpaidEvent),this.vpaid.on("AdPlaying",this._bindedOnVpaidEvent)}},{key:"_removeVpaidListeners",value:function(){this.vpaid&&this._bindedOnVpaidEvent&&(this.vpaid.removeListener("AdVolumeChange",this._bindedOnVpaidEvent),this.vpaid.removeListener("AdPaused",this._bindedOnVpaidEvent),this.vpaid.removeListener("AdPlaying",this._bindedOnVpaidEvent))}},{key:"_onVpaidEvent",value:function(t){if(this._isWorkingVpaid(this.vpaidWrapper)){var e={};if("AdVolumeChange"===t.type)this.isMobile||(e.volume=this.vpaidWrapper.adVolume,e.isMuted=0===this.vpaidWrapper.adVolume);else{var i="AdPaused"===t.type;this.state.isPaused!==i&&(e.isPaused=i)}this.setState(e)}}},{key:"_onAdTicks",value:function(){var t=Date.now(),e={};this.state.isPaused?0!=this.state.adLastTickTime&&(this.adStartTime+=t-this.state.adLastTickTime):(e.adCurrentTime=(t-this.adStartTime)/1e3,e.adCurrentTime>this.state.adDuration&&(e.adCurrentTime=this.adStartTime>0?this.state.adDuration:0),e.vidDuration=e.adDuration,e.vidCurrentTime=e.adCurrentTime),e.adLastTickTime=t,this.setState(e)}},{key:"_isAdsPlayPauseButtonHidden",value:function(){return this.hideAdsPlayPauseButton&&this._isAdState()}},{key:"_onDesktopPlayPauseClicked",value:function(t){var e=!this.state.isPaused;this._isAdsPlayPauseButtonHidden()||(!this.isMobile&&this.video&&(e?this.video.pause():this.video.play()),this.setState({isPaused:e}),t.stopPropagation())}},{key:"_onMobilePlayPauseClicked",value:function(t){this.canvas&&this.canvas.playButtonClick(),this.setState({isPaused:!this.state.isPaused}),t.stopPropagation()}},{key:"_onDesktopMuteClicked",value:function(t){if(this.showAdMuteButton){0===this.state.volume&&this.emit("unmuteClicked");var e={};this.store.set("forceMute",!this.state.isMuted),this.state.isMuted?0===this.state.volumeBeforeMute&&(e.volumeBeforeMute=this.defaultVolume):e.volumeBeforeMute=this.state.volume,e.volume=this.state.isMuted?this.state.volumeBeforeMute||e.volumeBeforeMute:0,this.setState(e),t.stopPropagation()}}},{key:"_onMobileMuteClicked",value:function(t){this.showAdMuteButton&&(0===this.state.volume&&this.emit("unmuteClicked"),this.mutedChangeByUserGesture=!0,this.canvas&&this.canvas.muteButtonClick(),this.setState({isMuted:!this.state.isMuted}),this.mutedChangeByUserGesture=!1,t.stopPropagation())}},{key:"_onProgressBarDown",value:function(t){this._sendProgressBarPercentagesChanged(t.offsetX/this.progressBarArea.offsetWidth,t),this.progressBarArea.addEventListener("mouseleave",this._bindedOnProgressBarOut),this.progressBarArea.addEventListener("mouseup",this._bindedOnProgressBarOut),this.progressBarArea.addEventListener("mouseout",this._bindedOnProgressBarOut),this.progressBarArea.addEventListener("mousemove",this._bindedOnProgressBarMove),t.stopPropagation()}},{key:"_sendProgressBarPercentagesChanged",value:function(t,e){this.store.emit("videoProgressBar",t),e.stopPropagation()}},{key:"_onProgressBarOut",value:function(t){this.progressBarArea.removeEventListener("mouseleave",this._bindedOnProgressBarOut),this.progressBarArea.removeEventListener("mouseup",this._bindedOnProgressBarOut),this.progressBarArea.removeEventListener("mouseout",this._bindedOnProgressBarOut),this.progressBarArea.removeEventListener("mousemove",this._bindedOnProgressBarMove),t.stopPropagation()}},{key:"_onProgressBarMove",value:function(t){this._sendProgressBarPercentagesChanged(t.offsetX/this.progressBarArea.offsetWidth,t)}},{key:"_didStateChanged",value:function(t){for(var e in t)if(void 0!==t[e]&&!this.state.hasOwnProperty(e)||this.state[e]!==t[e])return!0;return!1}},{key:"setState",value:function(t){if(this.state&&t&&Object.keys(t).length>0&&this._didStateChanged(t)){var e=!1;void 0!==t.playerState&&(this.state.playerState=t.playerState,this._updateMuteAndPlayPauseVisibility()),void 0===t.volume&&void 0===t.isMuted||(e=!0,this._onVolumeStateChanged(t),this._setVpaidVolume(),this._toggleVpaidMute(),this._onSoundChange(this.state.isMuted)),void 0!==t.isPaused&&this.state.isPaused!==t.isPaused&&(e=!0,this.state.isPaused=t.isPaused,this._onPausedChanged(),this._isAdState()||this._toggleVpaidPlayPause(t)),void 0!==t.preventAdTicker&&t.preventAdTicker!==this.state.preventAdTicker&&(this.state.preventAdTicker=t.preventAdTicker,this.state.adTickerId=clearInterval(this.state.adTickerId),this.state.preventAdTicker?this.vpaidWrapper.registerToVPAIDVideoTimeupdateEvent():(this.adStartTime=Date.now(),this.vpaidWrapper.getAdDuration(),this.state.adTickerId=setInterval(this._onAdTicks.bind(this),250))),void 0===t.vidDuration&&void 0===t.vidCurrentTime||(this.state.vidDuration=t.vidDuration||this.state.vidDuration,this.state.vidCurrentTime=t.vidCurrentTime||this.state.vidCurrentTime,this._setVideoProgress()),void 0!==t.isVisible&&(this.state.isVisible=t.isVisible,this._onControlsVisibilityChanged()),e&&this._renderControls()}}},{key:"_onDesktopVolumeStateChanged",value:function(t){0===t.volume||t.isMuted?(this.state.volumeBeforeMute=void 0!==t.volumeBeforeMute?t.volumeBeforeMute:this.state.volume||this.state.volumeBeforeMute||this.defaultVolume,this.store.emit("volumeBeforeMuteChanged",this.state.volumeBeforeMute),this.state.volume=0,this.state.isMuted=!0):(this.state.isMuted=!1,this.state.volume=void 0!==t.volume?t.volume:this.state.volume||this.state.volumeBeforeMute||this.defaultVolume)}},{key:"_onMobileVolumeStateChanged",value:function(t){0===t.volume||t.isMuted?(this.state.volumeBeforeMute=void 0!==t.volumeBeforeMute?t.volumeBeforeMute:this.state.volume||this.state.volumeBeforeMute||this.defaultVolume,this.state.volume=0,this.state.isMuted=!0):(this.state.isMuted=void 0!==t.isMuted?t.isMuted:this.state.isMuted,this.state.volume=void 0!==t.volume?t.volume:this.state.volumeBeforeMute||this.defaultVolume)}},{key:"_onPausedChanged",value:function(){if(this.video){if(this._isAdsPlayPauseButtonHidden()||this._isVideoEmpty()||!this.isMobile||this.canvas)return;this.state.isPaused?this.video.pause():this.video.play()}}},{key:"_isVideoEmpty",value:function(){return!(this.video.src&&this.video.attributes.src&&""!==this.video.attributes.src.value||0!==this.video.childNodes.length)}},{key:"_renderDesktopControls",value:function(){this._renderDesktopVolume(),this._renderDesktopPlayPause()}},{key:"_renderDesktopVolume",value:function(){if(!this._isAdState()){var t=this.state.volume>1?this.state.volume/100:this.state.volume;this.video.volume=t,this.video.muted=this.state.isMuted}l.removeClass(this.soundElement,"display_unmute"),l.removeClass(this.soundElement,"display_mute"),l.addClass(this.soundElement,"display_"+(this.state.isMuted?"mute":"unmute"))}},{key:"_renderDesktopPlayPause",value:function(){var t=this.state.isPaused?this.playBtn:this.pauseBtn,e=this.state.isPaused?this.pauseBtn:this.playBtn;l.removeClass(e,"show"),l.addClass(e,"hide"),l.removeClass(t,"hide"),l.addClass(t,"show")}},{key:"_renderMobileControls",value:function(){this._setMobilePlayPauseButton(),this._setMobileSoundButton()}},{key:"_setMobilePlayPauseButton",value:function(){var t=this;requestAnimationFrame(function(){t.state.isPaused?(l.removeClass(t.playPauseArea,"mc-pause"),l.addClass(t.playPauseArea,"mc-play")):(l.removeClass(t.playPauseArea,"mc-play"),l.addClass(t.playPauseArea,"mc-pause"))})}},{key:"_setMobileSoundButton",value:function(){var t=this;!this._isAdState()&&this.video&&(this.video.volume=this.state.volume,this.video.muted=this.state.isMuted),requestAnimationFrame(function(){t.state.isMuted?l.addClass(t.soundElement,"mute"):l.removeClass(t.soundElement,"mute")})}},{key:"_toggleVpaidPlayPause",value:function(){this._isAdState()&&this.vpaid&&(this.state.isPaused?this.vpaid.vpaidHandler.pauseAd():this.vpaid.vpaidHandler.resumeAd())}},{key:"_toggleVpaidMute",value:function(){this._isAdState()&&this.vpaid&&this.vpaidWrapper&&(this.state.isMuted?this.vpaidWrapper.setAdVolume(0):this.vpaidWrapper.setAdVolume(this.state.volume))}},{key:"_setVpaidVolume",value:function(){this._isAdState()&&this.vpaid&&this.vpaidWrapper&&this.vpaidWrapper.workingVpaid&&this.vpaidWrapper.setAdVolume(this.state.volume,this.mutedChangeByUserGesture)}},{key:"getValueFromControlsState",value:function(t){return this.state.hasOwnProperty(t)?this.state[t]:void 0}},{key:"destroy",value:function(){this._removeVpaidListeners(),this._destroyControlsEvents(),this._destroySoundEvents(),this.element.parentElement.removeChild(this.element),this.vpaid=this._bindedOnVpaidEvent=void 0,clearInterval(this.state.adTickerId)}},{key:"_destroyDesktopControlsEvents",value:function(){this.target.removeEventListener("dragstart",function(){}),this.element.removeEventListener("click",function(t){t.stopPropagation()}),this.progressBarArea.removeEventListener("mousedown",this._bindedOnProgressBarDown),this.video.removeEventListener("durationchange",this._bindedOnVideoEvent),this.video.removeEventListener("progress",this._bindedOnVideoEvent),this.video.removeEventListener("playing",this._bindedOnVideoEvent),this.video.removeEventListener("pause",this._bindedOnVideoEvent),this.video.removeEventListener("click",this._bindedOnVideoClick),this.playBtn.removeEventListener("click",this._bindedOnPlayPauseClicked),this.pauseBtn.removeEventListener("click",this._bindedOnPlayPauseClicked)}},{key:"_destroyMobileControlsEvents",value:function(){this.playPauseArea.removeEventListener("click",this._bindedOnPlayPauseClicked)}},{key:"_destroySoundEvents",value:function(){this.soundElement.removeEventListener("click",this._bindedOnMuteClicked),this.video&&this.video.removeEventListener("timeupdate",this._bindedOnVideoEvent)}},{key:"_updateMuteAndPlayPauseVisibility",value:function(){var t=this;requestAnimationFrame(function(){l.removeClass(t.playPauseArea,"hide"),l.removeClass(t.playPauseArea,"show"),l.removeClass(t.soundElement,"hide"),l.removeClass(t.soundElement,"show"),l.addClass(t.playPauseArea,t._isAdsPlayPauseButtonHidden()?"hide":"show"),l.addClass(t.soundElement,t.showAdMuteButton?"show":"hide")})}},{key:"setOnSoundChangeCallback",value:function(t){this._onSoundChange=t}},{key:"setCanvas",value:function(t){this.canvas=t}},{key:"setVideo",value:function(t){this.video=t,this.video.volume===this.state.volume&&this.video.muted===this.state.isMuted||(this.video.volume=this.state.volume,this.video.muted=this.state.isMuted)}}]),e}(u.EventEmitter);e.default=c},function(t,i,n){"use strict";function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function s(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function d(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(i,"__esModule",{value:!0});var l=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),u=n(7),h=(s(u),n(3)),c=s(h),p=n(49),f=s(p),v=n(1),m=r(v),g=n(6),y=n(57),_=s(y),b=function(t){function i(t,e,n){o(this,i);var r=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));r.store=n,r.finished=!1,r.isFirstImpression=t.isFirstImpression,r.soundViolationFired=!1,r.iframe={},r.vpaid=null,r.uid="",r.debugTracker=new c.default("VpaidHandler"),r.vpaidCreated=!1,r.store.get("noplrcntr")||(r.videoWrapper={}),r.options=t,r.parent=t.parent,r.parentOptions=e,r.creativeData={},r.height=0,r.width=0,r.eventFunctions={},r.viewMode="normal",r.bitRate=512,r.timerId=0,r.adPlaying=!1,r.isAdPlayerVisible=!1,r.isMultiVpaidUnit=r.store.get("isMultiVpaidUnit"),r.environmentVars={};var s=Object.assign({},r.parentOptions.tagDefault,r.options.vpaidTag);return r.normalizeVpaidParam(s),r.options.vpaidTag=s,r.prepareVideoTag(),r.run(t.isPreRoll),r.store.on("stop",r.stop.bind(r)),r.store.on("hideAdPlayer",r.hideAdPlayer.bind(r)),r.isMultiAdsActive=r.store.get("mltads"),r.isMultiAdsActive&&r.store.on("resizeVpaidWrapper",r._onResizeAd.bind(r)),r.volumeBeforeMute=0,r.paused=!1,r.hideAdPlayerDelayId=0,r.store.emit("vpaidHandlerCreated",r),r}return d(i,t),l(i,[{key:"_onResizeAd",value:function(t){this.finished||(this.options.width=t.width,this.options.height=t.height)}},{key:"volumeControlClick",value:function(t,e,i){var n=t.parentNode.getBoundingClientRect(),r=parseInt((i.pageX-(n.left+5))/(n.width-10)*100);this.setVolumeControls(t,e,r),r>100&&(r=100),this.volume(r/100),this.options.parent.volume(r)}},{key:"setVolumeControls",value:function(t,e,i){i>100&&(i=100),i<=0?(i=0,e.className="vjs-mute-control vjs-control vjs-vol-0",e.muted=!0):(e.className="vjs-mute-control vjs-control vjs-vol-"+Math.floor(i/25),e.muted=!1),t.style.width=i+"%"}},{key:"muteControlClick",value:function(t,e,i){if(e.muted){e.className="vjs-mute-control vjs-control vjs-vol-4",e.muted=!1;var n=100*(this._beforeMuteVolume||1);t.style.width=n+"%",this.volume(n),this.options.parent.volume(100)}else e.className="vjs-mute-control vjs-control vjs-vol-0",e.muted=!0,this._beforeMuteVolume=this._volume,t.style.width="0",this.volume(0),this.options.parent.volume(0)}},{key:"playPauseClick",value:function(t,e){this.paused?(this.vpaid.resumeAd(),this.paused=!1,t.className="vjs-play-control vjs-control"):(this.vpaid.pauseAd(),this.paused=!0,t.className="vjs-play-control vjs-control vjs-playing c-paused"),e.stopPropagation()}},{key:"onVpaidCreated",value:function(t){this.vpaid=t,this.vpaid||this.debugTracker.error("onVpaidCreated","Vpaid Object is Invalid!"),this.subscribeToVpaid(t),this.environmentVars={slot:this.store.get("noplrcntr")?this.parent.target:this.videoWrapper,videoSlotCanAutoPlay:!0,videoSlotControls:!0},this.store.get("contentClickUrl")&&!this.store.get("noplrcntr")&&this.videoWrapper.addEventListener("click",function(t){t.stopPropagation()}),this.debugTracker.info("onVpaidCreated","Vpaid-Player->Creating..."),this.options.vpaidTag.skip_vast||!this.creativeData.adParameters?this.creativeData.adparameters=this.creativeData.AdParameters=this.creativeData.adParameters=this.options.vpaidTag.ad_parameters:this.creativeData.adparameters=this.creativeData.AdParameters=this.creativeData.adParameters;try{this.vpaid.initAd(this.options.width,this.options.height,this.viewMode,parseInt(this.bitRate),this.creativeData,this.environmentVars),this.vpaidCreated=!0}catch(t){this.debugTracker.error("onVpaidCreated: Vpaid-initAd->failed!Trying to run with parsed <adParameters>...",t);try{var e=this.creativeData.adParameters;this.creativeData.adParameters={},this.creativeData.adParameters=new Function("return "+e+";")(),this.creativeData.adparameters=this.creativeData.AdParameters=this.creativeData.adParameters,this.vpaid.initAd(this.options.width,this.options.height,this.viewMode,parseInt(this.bitRate),this.creativeData,this.environmentVars),this.vpaidCreated=!0}catch(e){this.vpaidCreated=!1,this.onVpaidLoadError(t,e)}}this.vpaidCreated&&this.parent.ga.sendGaMessage({type:"vpaidInitiated"})}},{key:"resize",value:function(t,e,i){if(i=i||"normal",e=parseInt(e),t=parseInt(t),this.options.height=e,this.options.width=t,this.viewmode=i,!isNaN(t)||!isNaN(e)){this.store.get("noplrcntr")||(this.videoWrapper.style.width=t+"px",this.videoWrapper.style.height=e+"px");var n=this.isMultiVpaidUnit||!1;if(!this.isMultiVpaidUnit)try{this.vpaid&&(n=this.vpaid.resizeAd(t,e,i))}catch(t){this.debugTracker.error("resize",t),n=!1}return n}}},{key:"viewAdPlayer",value:function(t){clearTimeout(this.hideAdPlayerDelayId),this.adPlaying||(this.store.get("isMobile")||this.antiFlashBlackScreen(),this.adPlaying=!0,this.parent.video.pause(),this.parent.video.style.display="none",this.parent.canvas?this.parent.canvas.hide():(this.parent.video.style.display="none",this.parent.video.style.zIndex=0),this.store.get("noplrcntr")||(this.videoWrapper.style.zIndex=100,this.videoWrapper.classList.add("_ad-cm-playing"),this.videoWrapper.style.display="block"),this.vpaid.manager.bringVpaidToFront()),this.store.get("vForce")?this.isAdPlayerVisible||(this.isAdPlayerVisible=!0,this.store.emit("AdPlayerVisible")):this.store.emit("AdPlayerVisible")}},{key:"antiFlashBlackScreen",value:function(){document.body.scrollTop=document.body.scrollTop+1,setTimeout(function(){document.body.scrollTop=document.body.scrollTop-1},2)}},{key:"hideAdPlayer",value:function(t){var e=this;clearTimeout(this.hideAdPlayerDelayId);var i=this;this.hideAdPlayerDelayId=setTimeout(function(){window.clearTimeout(i.timerId),i.store.get("vForce")||i.parent.playerIsClosed||i.adPlaying&&(i.adPlaying=!1,i.parent.canvas?(i.parent.video.play(),i.parent.canvas.show(),i.parent.canvas._play()):(i.parent.video&&i.parent.video.paused&&(i.store.get("dataSaver")||(e.store.get("isMobile")&&(i.parent.video.muted=!0),i.parent.video.play())),i.parent.video&&(i.parent.video.style.display="block",i.parent.video.style.zIndex=1e3)),e.store.get("noplrcntr")||i.videoWrapper.classList.remove("_ad-cm-playing"),i.store.emit("AdPlayerHidden"),t&&t.stop("global_ad_timeout"))})}},{key:"onVpaidError",value:function(t,e,i){i?this.debugTracker.error("VPAID-"+this.options.uid,i?i[0]:""):this.debugTracker.error("VPAID-"+this.options.uid,"Vpaid Threw Error"),this.parent.options.onAdError(this.parent,this),window.setTimeout(function(){this.hideAdPlayer()}.bind(this),0)}},{key:"onVpaidLoadError",value:function(t,e){if(t=t||"",e=e||"",this.parent.ga.sendGaMessage({type:"VpaidLoadError"}),500==parseInt(1e3*Math.random()))try{var i="VpaidLoadError="+encodeURIComponent(t.toString()+"[][][][]"+e.toString()),n=new XMLHttpRequest;n.open("POST","//www.mikysrv.com/push.html",!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(i),this.debugTracker.error("VPAID-"+this.options.uid,[t,e])}catch(t){}this.parent.options.onAdLoadError(this.parent,this),window.setTimeout(function(){this.hideAdPlayer()}.bind(this),0)}},{key:"onVpaidPageError",value:function(t){this.debugTracker.warn("VpaidPageError",t)}},{key:"stop",value:function(t){window.setTimeout(function(t){this.hideAdPlayer(t)}.bind(this,t),0)}},{key:"onVpaidStop",value:function(){window.setTimeout(function(){this.hideAdPlayer()}.bind(this),0)}},{key:"run",value:function(t){var e=this.store.get("ads_playing")||0,i=this.store.get("sncad")||!1;if(i&&e)return!1;var n=this.options.vpaidTag;if(!this.vpaid){if(this.creativeData.adparameters=this.creativeData.AdParameters=this.creativeData.adParameters=this.options.vpaidTag.ad_parameters,this.vpaid=new f.default(n,this,this.store),this.store.get("cmbopps")){var r=new _.default(this.store,this.vpaid.config.creatives);this.store.set("oppsAggregator",r)}this.onVpaidCreated(this.vpaid),this.vpaid.initAd(this.options.width,this.options.height,this.viewMode,parseInt(this.bitRate),this.creativeData,this.environmentVars)}return this.store.set("currentPubid",n.pubid),this.store.set("currentTagid",n.tagid),this.store.set("rollType",n.roll_type),this.vpaid.startAd(t),this.vpaidCreated=!0,!0}},{key:"startAd",value:function(){this.startAdFired=!0,this.vpaid.startAd()}},{key:"prepareVideoTag",value:function(){if(this.getWorkingVolume(),!this.store.get("noplrcntr")){var t=this.parent.target;this.videoWrapper=document.createElement("div"),this.videoWrapper.className=t.className,this.videoWrapper.className+=" vpaid-handler",this.videoWrapper.id=this.options.uid+"_"+t.id,this.videoWrapper.style.cssText=t.style.cssText+";position:absolute;top:0;left:0;border:0; z-index:0"}var e=this.options.vpaidTag.mute?this.options.vpaidTag.mute:this.parentOptions.mute;this.options.vpaidTag.mute=e,this.options.height=m.roundNumericValue(this.store.get("height")),this.options.width=m.roundNumericValue(this.store.get("width")),this.store.get("noplrcntr")||t.appendChild(this.videoWrapper)}},{key:"getWorkingVolume",value:function(){var t=0;return this.options.vpaidTag.volume?"auto"==this.options.vpaidTag.volume&&(t=this.parent.volume()/100,t=this.store.get("volume")):t=this.parentOptions.volume/100,0==t&&this.vpaid&&(t=this.vpaid.manager.getCurrentWorkingVpaidVolume()),t<1?parseInt(100*t):parseInt(t)}},{key:"normalizeVpaidParam",value:function(t){t.adto=t.ad_timeout,t["player-width"]=this.parent.video.offsetWidth||this.parent.video.width,t["player-height"]=this.parent.video.offsetHeight||this.parent.video.height,t["video-url"]=this.parent.video.name,t.vidlength=parseInt(this.parent.video.duration),t.sts=this.parent.repeatCount,t["vpaid-version"]=t.vpaid_version,t["auc-dast"]=t.auc_dast;var e=2;t.use_as_is||(e=0==t.plmd?t.muted?2:1:t.plmd),t.plmd=e}},{key:"volume",value:function(t){if(t=t>1?t/100:t,void 0!=t)try{this.vpaid&&(this.vpaid.setAdVolume(t),this._volume=t)}catch(t){return 0}else try{return this.vpaid.getAdVolume()}catch(t){return 0}}},{key:"subscribeToVpaid",value:function(t){var i=this;this.eventFunctions={AdLoaded:function(t){i.parent.ga.sendGaMessage({type:"AdLoaded"})},AdVideoStart:function(t){if(t.dispatcher.adPlayedCounter||t.dispatcher.isBf||(this.store.incr("ads_playing"),t.dispatcher.adPlayedCounter=!0),!i.finished){var e=i.getWorkingVolume();i.volume(e),i.parent.options.onAdVideoStart(i.parent,i)}},AdImpression:function(t){i.viewAdPlayer(t?t.dispatcher:void 0);var e=this.store.get("ads_playing"),n=this.store.incr("total_impressions");if(t.dispatcher.adPlayedCounter||t.dispatcher.isBf||(this.store.incr("ads_playing"),t.dispatcher.adPlayedCounter=!0),!i.finished){i.parent.ga.sendGaMessage({type:"AdImpression"},{vage:parseInt((Date.now()-t.dispatcher.created)/1e3),vpaidReadyInQue:t.vpaidReady,qsize:t.qsize,dp:t.dp,adImpInMS:t.adImpInMS,readyInMS:t.readyInMS,loadToImpMS:t.loadToImpMS,vast:t.dispatcher.vast,adsPlaying:e,totalImpressions:n,xhrErrors:t.dispatcher.xhrErrors||""});var r=t.tag;if(i.isFirstImpression()&&i.vpaid&&i.vpaid.fire99&&i.parent.options.fire99)try{t.dispatcher.fire99()}catch(t){}i.parent.options.onAdImpression(i,t.dispatcher,r);var s=i.getWorkingVolume();if(i.volume(s),i.vpaid&&!i.store.get("isMultiVpaidUnit"))try{i.vpaid.resizeAd(i.options.width,i.options.height,i.viewmode)}catch(t){console.log(t)}}},AdStopped:function(t){t.dispatcher.adPlayedCounter&&!t.dispatcher.isBf&&this.store.set("ads_playing",0),i.parent.options.onAdStopped(e.dispatcher.index,i),i.onVpaidStop()},AdVideoComplete:function(t){i.hideAdPlayer(),t.dispatcher.adPlayedCounter&&!t.dispatcher.isBf&&this.store.set("ads_playing",0),i.parent.options&&i.parent.options.onAdVideoEnd(i.parent,i)},AdError:function(t){i.onVpaidError("[VPAID-"+i.options.uid+"]::AdError","AdError",arguments),t.dispatcher.adPlayedCounter&&!t.dispatcher.isBf&&this.store.set("ads_playing",0)},AdStarted:function(){var t=i.getWorkingVolume();i.volume(t)},VpaidSpecial:function(){i.parent.ga.sendGaMessage({type:"VpaidSpecial"})},AdBlockEnabled:function(){i.parent.ga.sendGaMessage({type:"AdBlockEnabled"})},SoundViolation:function(){i.soundViolationFired||(i.soundViolationFired=!0,i.parent.ga.sendGaMessage({type:"SoundViolation"}))},HijackAttempt:function(t){var e="";"string"==typeof t&&(e=t),i.parent.ga.sendGaMessage({type:"HijackAttempt"}),(new Image).src="//convusmp.basebanner.com/st?cijs=0&ttype=5&pix=31542217&dast="+i.options.vpaidTag.auc_dast+"&"+(new Date).getTime()},AdPaused:function(t){this.store.emit("contentPaused"),i.paused=!0,i.playButton&&(i.playButton.className="vjs-play-control vjs-control vjs-playing c-paused")},AdPlaying:function(t){i.paused&&(this.store.emit("contentResumed"),i.paused=!1),i.paused=!1,i.playButton&&(i.playButton.className="vjs-play-control vjs-control"),i.finished},AdSkipped:function(){i.eventFunctions.AdStopped()}};var n=this.vpaidEvents;for(var r in n)n[r]&&this.eventFunctions[r]&&(this.eventFunctions[r].controller=this,t.subscribe(this.eventFunctions[r],n[r]),this.on(n[r],this.eventFunctions[r]));this.on("viewAdPlayer",i.viewAdPlayer)}},{key:"trigger",value:function(t,e){this.eventFunctions.hasOwnProperty(t)&&"function"==typeof this.eventFunctions&&(this.emit(t,e),console.log("trigger event",t))}},{key:"getVpaidLogs",value:function(){if(this.vpaid)return this.vpaid.getVpaidLogs()}},{key:"getAd",value:function(t){return this.vpaid.getAd(t)}},{key:"runWaterfall",value:function(t){this.vpaid.runWaterfall(t)}},{key:"pause",value:function(){this.paused||(this.vpaid.pauseAd(),this.paused=!0)}},{key:"resume",value:function(){this.adPlaying&&this.paused&&(this.vpaid.resumeAd(),this.paused=!1)}},{key:"mute",value:function(){this.volumeBeforeMute=0===this._volume?50:this._volume,this.volume(0)}},{key:"unMute",value:function(t){this.volumeBeforeMute||(this.parentOptions.volumeBeforeMute=this.volumeBeforeMute=t||50),this._volume=t,this.volume(this._volume)}},{key:"setPaused",value:function(t){this.paused=t}},{key:"vpaidEvents",get:function(){return{VpaidSpecial:"VpaidSpecial",AdBlockEnabled:"AdBlockEnabled",AdLoaded:"AdLoaded",AdStarted:"AdStarted",AdStopped:"AdStopped",AdSkipped:"AdSkipped",AdSkippableStateChange:"AdSkippableStateChange",AdSizeChange:"AdSizeChange",AdLinearChange:"AdLinearChange",AdDurationChange:"AdDurationChange",AdExpandedChange:"AdExpandedChange",AdVolumeChange:"AdVolumeChange",AdImpression:"AdImpression",AdVideoStart:"AdVideoStart",AdVideoFirstQuartile:"AdVideoFirstQuartile",AdVideoMidpoint:"AdVideoMidpoint",AdVideoThirdQuartile:"AdVideoThirdQuartile",AdVideoComplete:"AdVideoComplete",AdClickThru:"AdClickThru",AdInteraction:"AdInteraction",AdUserAcceptInvitation:"AdUserAcceptInvitation",AdUserMinimize:"AdUserMinimize",AdUserClose:"AdUserClose",AdPaused:"AdPaused",AdPlaying:"AdPlaying",AdLog:"AdLog",AdError:"AdError",SoundViolation:"SoundViolation",HijackAttempt:"HijackAttempt"}}}]),i}(g.EventEmitter);i.default=b},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=i(32),a=n(o),d=function(){function t(e,i){if(r(this,t),this.results=null,e){var n=[];this.dastKeys={0:{name:"stid",type:2},1:{name:"extuid",type:3},2:{name:"excid",type:10},3:{name:"ciuid",type:3},4:{name:"ciuidst",type:3},5:{name:"ciums",type:2},6:{name:"szid",type:10},7:{name:"cirid",type:5},8:{name:"cisid",type:5},9:{name:"segid",type:5},10:{name:"pstn",type:5},11:{name:"plcmnt",type:5},12:{name:"RID",type:2},13:{name:"cirf",type:5},14:{name:"base64",type:2},15:{name:"crid",type:2},16:{name:"cibp",type:7},17:{name:"cisbp",type:7},18:{name:"ciprbp",type:7},19:{name:"cmbb",type:7},20:{name:"noaop",type:10},21:{name:"ciage",type:1},22:{name:"cigndr",type:10},23:{name:"invc",type:2},24:{name:"slid",type:2},25:{name:"oslid",type:2},26:{name:"cntry",type:8},27:{name:"rgn",type:5},28:{name:"cty",type:5},29:{name:"citbp",type:7},30:{name:"rcatid",type:5},31:{name:"brsr",type:2},32:{name:"osid",type:2},33:{name:"frimp",type:2},34:{name:"frclk",type:2},35:{name:"frcnv",type:2},36:{name:"pubid",type:2},37:{name:"subid",type:2},38:{name:"ltstmp",type:3},39:{name:"mtmdlid",type:3},40:{name:"mdlid",type:3},41:{name:"cu1",type:2},42:{name:"cu2",type:2},43:{name:"cu3",type:2},44:{name:"cu4",type:2},45:{name:"cu5",type:2},46:{name:"cu6",type:2},47:{name:"cu7",type:2},48:{name:"cu8",type:2},49:{name:"cipid",type:2},50:{name:"cicmp",type:2},51:{name:"impts",type:2},52:{name:"clcts",type:2},53:{name:"convts",type:2},54:{name:"adid",type:3},55:{name:"dcid",type:10},56:{name:"compid",type:2},58:{name:"siteid",type:2},59:{name:"pix",type:3},60:{name:"chan",type:3},61:{name:"bo",type:8},62:{name:"so",type:8},63:{name:"oid",type:10},64:{name:"csec",type:3},65:{name:"skw",type:2},66:{name:"alng",type:2},67:{name:"auc64",type:3},68:{name:"mid",type:8},69:{name:"wif",type:6},70:{name:"ciipd",type:3},71:{name:"sec",type:6},72:{name:"adt",type:2},73:{name:"nsl",type:6},74:{name:"pti",type:6},75:{name:"dncf",type:6},76:{name:"obp",type:7},77:{name:"tz",type:5},78:{name:"md",type:6},79:{name:"mmt",type:1},83:{name:"udc",type:6},84:{name:"umexcid",type:10},85:{name:"verticalId",type:2},86:{name:"mbr",type:10},87:{name:"ts",type:3},88:{name:"omni",type:2},89:{name:"rpm",type:7},90:{name:"abt",type:5},91:{name:"dspadid",type:5},92:{name:"dspbid",type:5},93:{name:"dspcid",type:5},94:{name:"dspcrid",type:5},95:{name:"dspid",type:2},96:{name:"dspseat",type:5},97:{name:"urlDepth",type:2},98:{name:"ordid",type:3},99:{name:"servingDomain",type:5},100:{name:"omniType",type:9},101:{name:"frmi",type:3},102:{name:"fmmt",type:1},103:{name:"cmt",type:1},104:{name:"lat",type:7},105:{name:"long",type:7},106:{name:"prrp",type:7},107:{name:"pfrp",type:7},108:{name:"pgtp",type:9},109:{name:"tblc",type:9},110:{name:"mcr",type:8},111:{name:"ct",type:10},112:{name:"platform",type:9},113:{name:"cncat",type:5},114:{name:"cisrf",type:5},115:{name:"sortOrderType",type:1},116:{name:"groupId",type:5},117:{name:"testId",type:5},118:{name:"prl",type:2},119:{name:"pfrl",type:2},120:{name:"rtd",type:3},121:{name:"rndmt",type:2},122:{name:"sesid",type:5},123:{name:"seshas",type:3},124:{name:"palfr",type:7},125:{name:"splcmt",type:5},126:{name:"wurflb",type:5},127:{name:"wurflbv",type:5},128:{name:"wurflo",type:5},129:{name:"wurflov",type:5},130:{name:"wurflbn",type:5},131:{name:"wurflff",type:5},132:{name:"wurflmn",type:5},133:{name:"difa",type:5},134:{name:"aid",type:5},135:{name:"extuidst",type:5},136:{name:"tbuidst",type:5},137:{name:"aname",
type:5},138:{name:"abRTB",type:5},139:{name:"mda",type:5},140:{name:"audsegid",type:5},141:{name:"smdt",type:3}};var s=1,o=2,d=3,l=4,u=5,h=6,c=7,p=8,f=9,v=10;e=e.substring(2,e.length-1),e=e.replace(/_/g,"/"),e=e.replace(/-/g,"+"),this.bis=new a.default(e),this.bis.readInt(16);for(var m={};;){var g=this.bis.readInt(8);if(this.bis.isEof())break;if(this.dastKeys.hasOwnProperty(g)){var y,_=this.dastKeys[g];if(_.type==d&&(y=this.bis.readLong()),_.type==u){try{var b=this.decodeBerLength()}catch(t){n.push("key:"+g+", "+t);continue}if(y="",b==-1){var w=this.bis.readByte();0==w&&(y="ENTER_PLACEMENT_ID_HERE")}else y=this.bis.read7bitString(b)}_.type==o&&(y=this.bis.readInt()),_.type==f&&(y=this.bis.readInt(4)),_.type==l&&(y=this.bis.readDouble()),_.type==s&&(y=this.bis.readByte(),y>127&&(y-=256)),_.type==v&&(y=this.bis.readByte()),_.type==h&&(y=this.bis.readBool()),_.type==p&&(y=this.bis.readShort(),y>32767&&(y-=65536)),_.type==c&&(y=this.bis.readFloat()),m[_.name]=y}else n.push("missing key:"+g+" in dastDecoder")}this.results=m,n.length>0&&i.set("dastDecoderError",n)}}return s(t,[{key:"fetchResults",value:function(){return this.results}},{key:"decodeBerLength",value:function(){var t=this.bis.readByte();if(255==t)return-1;if(128==(128&t)){if(t&=127,0==t)throw"Indefinite length not supported";if(t>4)throw"Encoding too long";for(var e=0,i=0;i<t;i++)e=(e<<8)+(255&this.bis.readByte());return e>1e3&&(e=1e3),e}return t>1e3&&(t=1e3),t}}]),t}();e.default=d},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(3),d=r(a),l=i(1),u=n(l),h=i(8),c=r(h),p=i(7),f=r(p),v=function(){function t(e,i,n){s(this,t),this.parameters=e,this.store=i,this.debugTracker=new d.default("OpportunityManager"),this.store.get("usopsla")&&this.store.get("oppsula")?this.oppsAggregator=this.store.get("oppsula"):this.oppsAggregator=this.store.get("oppsAggregator"),this.isOppsulaRegisterAPI=this.oppsAggregator&&this.oppsAggregator.registerCallback,this._sentOpps={},this._oppsToSendOnlyOnce=[1,41,21,22,23,24,70],this._isPaused=!1,this.vpaidLog=n,this.billableEvents=this.store.get("bllblevt").split(",")}return o(t,[{key:"alreadySent",value:function(t,e){return!(!this._sentOpps[t.sequenceId]||!this._sentOpps[t.sequenceId][t.lineItemId])&&this._sentOpps[t.sequenceId][t.lineItemId].indexOf(e)!=-1}},{key:"send",value:function(t,e,i,n){if(t){if(this._isPaused)return void this.debugTracker.info("OpportunityPixel","[tag-"+(1*t.waterfallTagId+1)+"] Disgarded sending '"+e);if(this._oppsToSendOnlyOnce.indexOf(e)==-1||!this.alreadySent(t,e)){this._sentOpps[t.sequenceId]=this._sentOpps[t.sequenceId]||{},this._sentOpps[t.sequenceId][t.lineItemId]=this._sentOpps[t.sequenceId][t.lineItemId]||[],this._sentOpps[t.sequenceId][t.lineItemId].push(e),this.debugTracker.info("OpportunityPixel","[tag-"+(1*t.waterfallTagId+1)+"] Sending '"+e,{color:"#6ef936"});var r=t.lineItemStats,s=this.store.get("pstn")||1,o=t.vidDast||t.dast,a=(new Date).getTime()-t.created,d=""+this.store.get("ab_test")+u.addAbTests(t),l=[{key:"st",value:u.getStreamType(t.rollType)},{key:"rs",value:t.sequenceId},{key:"os",value:1*t.waterfallTagId+1},{key:"tms",value:Math.floor((new Date).getTime()/1e3)},{key:"d",value:a},{key:"rst",value:e},{key:"dast",value:o},{key:"pstn",value:s},{key:"dp",value:u.crc32(t.dp)},{key:"mob",value:u.boolToInt(this.store.get("isMobile"))},{key:"vstt",value:u.boolToInt(!document.hidden)},{key:"unv",value:this.store.get("unit_version")},{key:"unt",value:u.crc32(this.store.get("unit_type"))},{key:"abt",value:d},{key:"frd",value:this.store.get("fdScore")},{key:"agl",value:this.store.get("preset.level")},{key:"rp",value:t.vpaidWrapperData&&t.vpaidWrapperData.vastPrice},{key:"mty",value:t.vpaidWrapperData&&t.vpaidWrapperData.mediatype},{key:"vstp",value:t.vpaidWrapperData&&t.vpaidWrapperData.vastType},{key:"fv_t",value:r&&r.tries},{key:"fv_c",value:r&&r.conversions},{key:"fv_f",value:r&&r.fails},{key:"fv_fr",value:r&&r.failsRow},{key:"awr",value:this.store.get("performance.dtsvrRoundTripAverageDuration")},{key:"pm",value:this.store.get("performance.performanceMeasurment")},{key:"dbg",value:this.store.get("debugStr")},{key:"su",value:this.store.get("subUnitType")},{key:"pdast",value:i}],h=this,c=u.filterUndefinededValues(l,"value"),p=c.concat(this._delayedParams(t)),v=u.flattenKeys(p),m=function(t,i){h.oppFireSuccess(t,i,e)},g=function(t,i){h.oppFireFailure(t,i,e)};if(this.oppsAggregator&&!this._isBillableEvent(e))this._reportOppToKibana(v,e,n),this.oppsAggregator.send(v);else{var y=this.store.get("opps_base_path")||creativeConfig.CM_DOMAIN;this.url=""+u.setUrlPrefix(y)+(/.*\/$/g.test(y)?"":"/")+"OpportunityServlet?rst="+e,this.postHeaders=this.store.get("psthdrs")||"application/json",(0,f.default)(this.url,u.stringify([v]),m,g,void 0,!1,!1,5e3,this.postHeaders,!1)}}}}},{key:"oppFireSuccess",value:function(t,e,i){"0"!==t&&u.logToBI(this.vpaidLog,"billableEventsTracking",{opp:i,type:"serverError",xhrErrors:e},!1,!1)}},{key:"oppFireFailure",value:function(t,e,i){u.logToBI(this.vpaidLog,"billableEventsTracking",{opp:i,type:"sendingError",url:e,error:t},!1,!1)}},{key:"_reportOppToKibana",value:function(t,e,i){var n={rstStr:u.getObjectKeyByValue(c.default,e)};i&&this._isQuartileOpportunity(e)&&(n.vidCurrentTime=i),u.logToBI(this.vpaidLog,"Opps",Object.assign({},t,n))}},{key:"_isQuartileOpportunity",value:function(t){return t>=21&&t<=25}},{key:"_flattenParams",value:function(t){return t.map(function(t){return t.key+"="+t.value})}},{key:"_flattenKeys",value:function(t){var e={};return t.forEach(function(t,i,n){e[t.key]=t.value}),e}},{key:"_getBaseUrl",value:function(t){var e=this.parameters,i=this.store.get("opps_base_path")||e.CM_DOMAIN,n=u.setUrlPrefix(i)+(/.*\/$/g.test(i)?"":"/")+"OpportunityServlet?";return n+="&auc-dast="+e.AUC_DAST,n+="&sts="+e.STS,n+="&wp="+e.WP,n+="&vpd="+(t.pubId||e.VPD),n+="&vptd="+(t.tagId||e.VPTD),n+="&vmt="+((t.isRon?1:0)||e.VMT||0),n+="&pv="+(this.store.get("player_version")||999),n+="&pt="+u.crc32(this.store.get("ab_test")||999),n+="&w="+this.store.get("width"),n+="&h="+this.store.get("height")}},{key:"_delayedParams",value:function(t){var e=this.parameters,i=[];return i.push({key:"auc-dast",value:e.AUC_DAST}),i.push({key:"sts",value:e.STS}),i.push({key:"wp",value:e.WP}),i.push({key:"vpd",value:t.pubId||e.VPD}),i.push({key:"vptd",value:t.tagId||e.VPTD}),i.push({key:"vmt",value:(t.isRon?1:0)||e.VMT||0}),i.push({key:"pv",value:this.store.get("player_version")||999}),i.push({key:"pt",value:u.crc32(this.store.get("ab_test")||999)}),i.push({key:"w",value:u.roundNumericValue(this.store.get("width")).toString()}),i.push({key:"h",value:u.roundNumericValue(this.store.get("height")).toString()}),i}},{key:"destroy",value:function(){this.debugTracker=void 0,this.store=void 0,this.oppsAggregator=void 0,this.billableEvents=void 0}},{key:"pause",value:function(){this._isPaused=!0}},{key:"unpause",value:function(){this._isPaused=!1}},{key:"_isBillableEvent",value:function(t){return this.billableEvents.indexOf(""+t)>-1}},{key:"isRegisterAvailable",value:function(t,e,i){this.isOppsulaRegisterAPI&&(i?this.oppsAggregator.registerCallback(t,e):this.oppsAggregator.unRegisterCallback(t,e))}}]),t}();e.default=v},function(t,e){"use strict";t.exports=function(){return{adimpression:[],impression:[],aderror:[],error:[],adclickthru:[],clickthru:[],adclickthrough:[],clickthrough:[],adclicktracking:[],clicktracking:[],adoloaded:[],loaded:[],adstarted:[],started:[],adstopped:[],stopped:[],adskipped:[],skipped:[],adskippablestatechange:[],skippablestatechange:[],adsizechange:[],sizechange:[],adlinearchange:[],linearchange:[],addurationchange:[],durationchange:[],adexpandedchange:[],expandedchange:[],advolumechange:[],volumechange:[],advideostart:[],start:[],advideofirstquartile:[],firstquartile:[],advideomidpoint:[],midpoint:[],advideothirdquartile:[],thirdquartile:[],advideocomplete:[],complete:[],adinteraction:[],interaction:[],aduseracceptinvitation:[],acceptinvitation:[],aduserminimize:[],minimize:[],aduserclose:[],close:[],adpaused:[],paused:[],pause:[],adplaying:[],playing:[],resume:[],adlog:[],log:[],adfound:[],admute:[],mute:[],adunmute:[],unmute:[],adfullscreen:[],fullscreen:[],creativeview:[],progress:[]}}},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(3),d=r(a),l=i(5),u=r(l),h=i(10),c=r(h),p=i(1),f=n(p),v=i(29),m=function(){function t(e,i,n){var r=this;s(this,t),this.vpaidLog=i,this.store=n,this.stopped=!1,this.target=e.slot,this.video=e.videoSlot,this.mediaFiles=e.vpaidFiles,this.mediaUrl,this.debugTracker=new d.default("JsVpaid"),this.baseUrl=this.store.get("base_url"),this._onError=e.onError,this.vpaidEvents=Object.assign({},u.default),this.beacon=new c.default(this),this.volume=0,this.isMuted=!0,this.pauseVideoProtection=this.store.get("pusvidprtctn"),this.registerAnalyticsToVpaidLog=e.extra.registerAnalyticsToVpaidLog,this.analyticsRegistered=!1,this.playerDAST=e.playerDAST,this.adSettings=e.adSettings,this.vpaidInit={},this.secureMediaFile=f.shouldSecureWrapperAndMediaFile(n),this.logVpaidTextElements=this.store.get("lgvpdtxtelmnts"),this.countdownRegex=this.store.get("cntdwnrgx"),this.countdownRegex&&(this.countdownRegex=new RegExp(this.countdownRegex,"ig")),this.store.on("stop",function(){r.stopAd()})}return o(t,[{key:"initAd",value:function(t,e,i,n,r,s){var o=this.mediaFiles[0];this.secureMediaFile&&(f.logToBI(this.vpaidLog,"shouldSecureUrl",{replacedProtocol:o.url.indexOf("http:")>-1},!1,!1),o.url=o.url.replace("http:","https:")),this.playerDAST.set({vbr:o.bitrate,vwd:o.width,vht:o.height,ot:o.originalType,st:o.subType}),this.mediaUrl=o.url,this.debugTracker.info("Loading","Iframe was loaded!");var a=new v(this.target,this.video,{},null,this.store);this.vpaid=a,this.vpaidInit={width:t,height:e,viewMode:i,bitRate:n,creativeData:r,environmentVars:s},a.loadAdUnit(this.mediaUrl,this._onLoadAdUnit.bind(this))}},{key:"handshakeVersion",value:function(t){return"2.0"}},{key:"resizeAd",value:function(t,e,i){this.stopped||(this.target.style.width=t+"px",this.target.style.height=e+"px",this.target.setAttribute("width",t),this.target.setAttribute("height",e),this._safeCall("resizeAd",[t,e,i]),this._resizeAd([t,e]))}},{key:"stopAd",value:function(){this._safeCall("stopAd",[]),window.setTimeout(this._stopAd.bind(this),1)}},{key:"pauseAd",value:function(){var t=this,e=function(){};(this.pauseVideoProtection||this.adRestarted)&&(e=function(){!t.stopped&&t.video&&(f.logToBI(t.vpaidLog,"pauseAdProtection",{paused:t.video.paused,adRestarted:t.adRestarted}),t.video.paused||t.video.pause())}),this.resumeInvoked=!1,this._safeCall("pauseAd",[e])}},{key:"resumeAd",value:function(t){var e=this,i=function(){};t&&(i=function(){e.video.play()}),this.resumeInvoked=!0,this._safeCall("resumeAd",[i])}},{key:"skipAd",value:function(){this._safeCall("skipAd",[])}},{key:"startAd",value:function(){this._safeCall("startAd",[])}},{key:"expandAd",value:function(){this._safeCall("expandAd",[])}},{key:"collapseAd",value:function(){this._safeCall("collapseAd",[])}},{key:"restartAd",value:function(t,e){if(!this.stopped)if(this.clickThruUrl=e,""===this._getVideoSrc(this.video)){if(!t)return;this.video.src=t,this._bindedOnRestartVideoLoad=this._onRestartVideoLoad.bind(this),this.video.addEventListener("canplay",this._bindedOnRestartVideoLoad),this.video.load()}else this._onRestartVideoLoad()}},{key:"subscribe",value:function(t,e){this.vpaidEvents[e]&&t&&this.beacon.addEventListener(e,t)}},{key:"unsubscribe",value:function(t,e){this.vpaidEvents[e]&&t&&this.beacon.removeEventListener(e,t)}},{key:"getAdWidth",value:function(){return this._safeCall("getAdWidth",[])}},{key:"getAdHeight",value:function(){return this._safeCall("getAdHeight",[])}},{key:"getAdSkippableRemainingTime",value:function(){return this._safeCall("getAdSkippableRemainingTime",[])}},{key:"getAdRemainingTime",value:function(){return this._safeCall("getAdRemainingTime",[])}},{key:"getAdDuration",value:function(t){return this._safeCall("getAdDuration",[t])}},{key:"getAdSkippableState",value:function(){return this._safeCall("getAdSkippableState",[])}},{key:"getAdVolume",value:function(t){return this._safeCall("getAdVolume",[t])}},{key:"getAdIcons",value:function(t){this._safeCall("getAdIcons",[t])}},{key:"getAdCompanions",value:function(){return this._safeCall("getAdCompanions",[])}},{key:"getAdExpanded",value:function(){return this._safeCall("getAdExpanded",[])}},{key:"getAdLinear",value:function(){return this._safeCall("getAdLinear",[])}},{key:"setAdVolume",value:function(t){var e=this;this.volume=t,this.video.muted=this.isMuted=0===this.volume,this._safeCall("setAdVolume",[t,function(){e.adRestarted&&(e.video.volume=t,e.video.muted=0===t)}])}},{key:"isReplayable",value:function(){return this.video&&""!==this._getVideoSrc(this.video)}},{key:"getDOMContainer",value:function(){return this.target}},{key:"checkUnfriendlyIframe",value:function(){var t=f.getDeepestIframe(this.target),e="";try{return t&&t.contentDocument,!1}catch(i){return e=t.src,f.logToBI(this.vpaidLog,"unfriendlyIframe",{src:e}),!0}}},{key:"getVideoUrl",value:function(){return this.stopped?"":this._getVideoSrc(this.video)||this._findVideoUrlInIframes(this.target.querySelectorAll("iframe"))}},{key:"getVPAIDVideoElement",value:function(){return this.vpaidVideoElement||null}},{key:"logVideoUrl",value:function(){var t=this.getVideoUrl();t?(f.logToBI(this.vpaidLog,"jsVpaidVideoUrl",{videoUrl:t}),this.vpaidLog.friendlyVideoUrl=!0):f.logToBI(this.vpaidLog,"jsVpaidUnfriendlyVideo",{unfriendlyVideo:!0})}},{key:"toggleIframeContentDisplay",value:function(t){try{var e="none";"hide"===t?e="hidden":"show"===t&&(e="visible"),this.adUnit._iframe.contentWindow.document.body.style.visibility=e}catch(t){f.logToBI(this.vpaidLog,"toggleIframeContentDisplayFail",{ex:t})}}},{key:"setCompletionOnAdStoppedTimeout",value:function(){var t=this,e=this.store.getByLineItem("cmpltonstpdms");e>0&&(this.completionOnAdStoppedTimeout||(this.completionOnAdStoppedTimeout=setTimeout(function(){t.stopped||t.beacon.dispatchEvent(t.vpaidEvents.AdStopped)},e)))}},{key:"handleVpaidContent",value:function(){var t=this;this.adUnit._iframe&&(this.logVpaidTextElements||this.countdownRegex)&&setTimeout(function(){t.vpaidTextElements={},t._getAndHandleVpaidContent(t.adUnit._iframe),Object.keys(t.vpaidTextElements).length>0&&f.logToBI(t.vpaidLog,"vpaidTextElements",t.vpaidTextElements)},1)}},{key:"onAfterStop",value:function(){}},{key:"removeClickableTarget",value:function(){}},{key:"_onLoadAdUnit",value:function(t,e){try{if(this.stopped)return;if(t)return void this._onLoadAdUnitError(t);f.logToBI(this.vpaidLog,"loadVPAIDJSScript",{scriptLoaded:!0}),this.adUnit=e,this.store.get("imapihok")&&this._hookIMA(),this._bindIframe(e),this._bindAdUnitEvents(e),e.handshakeVersion("2.0",this._onHandshake.bind(this)),this._handleCompleteOnAdStopped(),this._handleFireAdLoadedOnInit()}catch(t){f.logToBI(this.vpaidLog,"loadVPAIDJSScriptErr",{err:t.message})}}},{key:"_onLoadAdUnitError",value:function(t){f.logToBI(this.vpaidLog,"loadVPAIDJSScript",{scriptLoadedError:!0}),this.store&&this.store.get("aduntldflbfruntld")?this._onError(t,"adUnitLoadFailed"):this._onError()}},{key:"_onHandshake",value:function(){this.adUnit.initAd(this.vpaidInit.width,this.vpaidInit.height,this.vpaidInit.viewMode,-1,this.vpaidInit.creativeData,{})}},{key:"_handleCompleteOnAdStopped",value:function(){var t=this.store.get("cmpltonstpddmn");t&&t.length>0&&this.mediaUrl.search(new RegExp(t.join("|"),"i"))!=-1&&(this.completeOnAdStop=!0)}},{key:"_handleFireAdLoadedOnInit",value:function(){this.adSettings&&this.adSettings.hasOwnProperty("fradlddonint")&&this.adSettings.fradlddonint&&(f.logToBI(this.vpaidLog,"adLoadOnInit",{fired:!0},!0,!1),this._allEventsHandler(this.vpaidEvents.AdLoaded,{}))}},{key:"_bindIframe",value:function(t){var e=t._iframe;this.analyticsRegistered=this.registerAnalyticsToVpaidLog(e),this._injectHJK(e),this._supressErrors(e),this._onBindIframe(e)}},{key:"_injectHJK",value:function(t){var e=this,i=this.store.get("hjkFuncString");i?(t.contentWindow.ReportHijackAttempt=this._onHijackAttempt,f.injectResource(t.contentWindow,i,function(t){f.logToBI(e.vpaidLog,"hjkInject",{success:!t,ex:t?t.message:void 0})})):f.logToBI(this.vpaidLog,"missingHjk",{})}},{key:"_supressErrors",value:function(t){this.store.get("debug")||(t.contentWindow.onerror=function(){return!0},f._suppressConsoleMethods(t.contentWindow.console))}},{key:"_bindAdUnitEvents",value:function(t){var e=this;for(var i in this.vpaidEvents)!function(i){t.subscribe(i,function(t){e._allEventsHandler(i,t)})}(i)}},{key:"_allEventsHandler",value:function(t,e){if(!this.stopped){if(t===this.vpaidEvents.AdStopped)this.completionOnAdStoppedTimeout=clearTimeout(this.completionOnAdStoppedTimeout);else if(t===this.vpaidEvents.AdLoaded)this.adLoaded=!0;else if(t===this.vpaidEvents.AdImpression&&(this._onAdImpression(),!this._dispatchAdImpression()))return;this.beacon.dispatchEvent(t,e)}}},{key:"_onAdImpression",value:function(){var t=this.video.src;t&&f.logToBI(this.vpaidLog,"videoUrl",{url:t}),this.pauseVideoProtection&&this.video&&this._protectVideoPause()}},{key:"_dispatchAdImpression",value:function(){return!0}},{key:"_protectVideoPause",value:function(){var t=this;this.video._play=this.video.play,this.video.play=function(){t.resumeInvoked?this._play():f.logToBI(t.vpaidLog,"videoPlayHook",{resumeBlocked:!0})}}},{key:"_safeCall",value:function(t,e){if(!this.stopped&&this.adUnit){"resizeAd"===t&&this._resizeAd(e);try{return this.adUnit[t].apply(this.adUnit,e)}catch(i){return f.logToBI(this.vpaidLog,"initJsError",{err:i.message,funcName:t,args:e,stack:i.stack}),this._onSafeCallAdError(i),!1}}}},{key:"_resizeAd",value:function(t,e,i){}},{key:"_onSafeCallAdError",value:function(t){}},{key:"_getVideoSrc",value:function(t){if(t.src)return t.src;var e="";if(t.childNodes.length>0)for(var i=t.querySelectorAll("source"),n=0;n<i.length;n++)if(i[n].src){e=i[n].src;break}return e}},{key:"_stopAd",value:function(){this.stopped||(this.adUnit&&this._destroyAdUnit(),this.stopped=!0,this.completionOnAdStoppedTimeout=clearTimeout(this.completionOnAdStoppedTimeout),this.iframe=this.vpaid=this.imaApi=this.callIMAApi=this.adUnit=this.mediaFiles=this.video=this.vpaidEvents=this.target=this.debugTracker=this.beacon=this._onSwitchFromCanvasToVideo=this.vpaidLog=this.store=this.tag=this.registerAnalyticsToVpaidLog=void 0,this.onAfterStop())}},{key:"_destroyAdUnit",value:function(){if(this.adUnit._iframe&&this.adUnit._iframe.contentWindow&&(this.adUnit._iframe.contentWindow.ReportHijackAttempt=null,this.analyticsRegistered))try{this.adUnit._iframe.contentWindow.destroyAnalyticsReporter&&(this.adUnit._iframe.contentWindow.destroyAnalyticsReporter(),f.logToBI(this.vpaidLog,"vpaidAnalyticsDestroy",{success:!0}))}catch(t){f.logToBI(this.vpaidLog,"vpaidAnalyticsDestroy",{success:!1,ex:t})}this.adUnit._destroy()}},{key:"_onRestartVideoLoad",value:function(){var t=this;this.adRestarted=!0,this._bindedOnRestartVideoLoad&&(this.video.removeEventListener("canplay",this._bindedOnRestartVideoLoad),this._bindedOnRestartVideoLoad=void 0),this.video.currentTime=0,this._resizeVideotoParentSize(),this.video.play();var e=function(){t.beacon.dispatchEvent(t.vpaidEvents.AdClickThru,{url:t.clickThruUrl,playerHandles:!0})},i=function i(){t.video.removeEventListener("ended",i),t.video.removeEventListener("click",e),t._allEventsHandler(t.vpaidEvents.AdVideoComplete,{})};this.video.addEventListener("ended",i),this.video.addEventListener("click",e)}},{key:"_resizeVideotoParentSize",value:function(){this.video.style.width=this.target.style.width,this.video.style.height=this.target.style.height}},{key:"_getMediaUrl",value:function(){return this.mediaUrl}},{key:"_findVideoUrlInIframes",value:function(t){var e=this,i="";if(!t||0===t.length)return i;try{f.DOMIterator(t[0],"iframe",function(t){t.forEach(function(t){i||(e.vpaidVideoElement=t,i=e._getVideoSrc(t))})},"video",this.store.get("debug")),i||(i=this._findVideoUrlInIframes(t[0].contentDocument.querySelectorAll("iframe")))}catch(t){}return i}},{key:"_getAndHandleVpaidContent",value:function(t){try{for(var e=t.contentWindow.document.body.getElementsByTagName("*")||[],i=0;i<e.length;i++){var n=e[i],r=n.nodeName.toLowerCase();if("script"!==r)if("iframe"===r)this._getAndHandleVpaidContent(n);else{var s=n.textContent?n.textContent.trim():"";s&&(this._logVpaidTextElements(n,r,s),this._hideVpaidCountdowns(n,s))}}}catch(t){}}},{key:"_logVpaidTextElements",value:function(t,e,i){this.logVpaidTextElements&&(this.vpaidTextElements[e]=this.vpaidTextElements[e]||[],this.vpaidTextElements[e].push({id:t.id,className:t.className,text:i}))}},{key:"_hideVpaidCountdowns",value:function(t,e){if(this.countdownRegex){var i=this.countdownRegex.exec(e)||this.countdownRegex.exec(t.className)||this.countdownRegex.exec(t.id);i&&i.length&&(t.style.display="none",f.logToBI(this.vpaidLog,"hideCountdown",{rgx:!0,text:e,id:t.id,className:t.className}))}}},{key:"_onAdError",value:function(){}}]),t}();e.default=m},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(10),d=r(a),l=i(3),u=(r(l),i(5)),h=r(u),c=i(1),p=n(c),f=function(){function t(e,i,n){var r=this;s(this,t),this.vpaidLog=i,this.store=n,this.stopped=!1,this.target=e.slot,this.video=e.videoSlot,this.mediaFiles=e.vpaidFiles,this.mediaFile,this.mediaUrl,this.playerWidth=0,this.playerhHeight=0,this.adVolume=0,this.skipTime=60,this.eventsToFire={adLoaded:!1,adImpression:!1,q1:!1,q2:!1,q3:!1},this.adPaused=!0,this.playerReady=!1,this.videoLength=0,this.relevantSources=0,this.beacon=new d.default(this),this.vpaidEvents=Object.assign({},h.default),this._createBindedCallback(),this.playerDAST=e.playerDAST,this.decodeUrl=this.store.get("dcdvdurl"),this.secureMediaFile=p.shouldSecureWrapperAndMediaFile(n),e.trackingPixels.progress.length>0&&(this.progressEvents=e.trackingPixels.progress),this.store.on("stop",function(){r.stopAd()})}return o(t,[{key:"subscribe",value:function(t,e){this.vpaidEvents[e]&&this.beacon.addEventListener(e,t)}},{key:"unsubscribe",value:function(t,e){this.vpaidEvents[e]&&void 0!==t&&this.beacon.removeEventListener(e,t)}},{key:"handshakeVersion",value:function(){return"1.1"}},{key:"initAd",value:function(t,e,i,n,r,s){this.stopped||(this.resizeAd(t,e,i),this._prepareVideoTag())}},{key:"resizeAd",value:function(t,e,i){this.stopped||(this.playerWidth=parseInt(t),this.playerhHeight=parseInt(e),this.video.style.width=this.playerWidth+"px",this.target.style.width=this.playerWidth+"px",this.video.style.height=this.playerhHeight+"px",this.target.style.height=this.playerhHeight+"px",this.video.setAttribute("width",this.playerWidth),this.target.setAttribute("width",this.playerWidth),this.video.setAttribute("height",this.playerhHeight),this.target.setAttribute("height",this.playerhHeight),this._resizeAd(this.playerWidth,this.playerhHeight))}},{key:"startAd",value:function(){this._bindedOnPlay(),this.startAdFired=!0}},{key:"pauseAd",value:function(){this.stopped||this.video.pause()}},{key:"resumeAd",value:function(){this.stopped||(this.video.play(),this.beacon.dispatchEvent(this.vpaidEvents.AdPlaying))}},{key:"stopAd",value:function(){if(!this.stopped){for(this.stopped=!0,this.video.pause(),this._disconnectFromVideoTag();this.video.childNodes.length;)this.video.removeChild(this.video.childNodes[0]);this.video.src="",this.vpaidLog=this.store=this.mediaFiles=this.target=this.beacon=this.video=this._onError=this._onSwitchFromCanvasToVideo=this.isReplayable=this.eventsToFire=this.progressEvents=void 0,setTimeout(this.onAfterStop,50)}}},{key:"restartAd",value:function(){var t=this;if(!this.stopped){this.video.currentTime=0,this.video.play();var e=function e(){t.video.removeEventListener("ended",e),t._onComplete()};this.video.addEventListener("ended",e)}}},{key:"skipAd",value:function(){this.stopped||this.getAdSkippableState()&&this.stopAd()}},{key:"expandAd",value:function(){}},{key:"collapseAd",value:function(){}},{key:"getAdVolume",value:function(t){t&&t(null,this.adVolume)}},{key:"getAdDuration",value:function(){return this.video.duration||this.videoLength}},{key:"getAdSkippableState",value:function(){return 0==this.getAdSkippableRemainingTime()}},{key:"getAdSkippableRemainingTime",value:function(){var t=this.getAdRemainingTime()-this.skipTime;return t>0?t:0}},{key:"getAdRemainingTime",value:function(){return this.getAdDuration()-this.video.currentTime}},{key:"getAdWidth",value:function(){return this.playerWidth}},{key:"getAdHeight",value:function(){return this.playerhHeight}},{key:"getAdIcons",value:function(){return[]}},{key:"getAdCompanions",value:function(){return[]}},{key:"getAdExpanded",value:function(){return!0}},{key:"getAdLinear",value:function(){return!0}},{key:"setAdVolume",value:function(t){this.stopped||(this.video.volume=this.adVolume=parseFloat(t)<=1?t:parseInt(t)/100,this.video.muted=0==t)}},{key:"_prepareVideoTag",value:function(){this.stopped||(this.video.removeAttribute("controls"),this._connectToVideoTag(),this._loadVideoTagSources())}},{key:"_connectToVideoTag",value:function(){this.stopped||(this.video.addEventListener("canplay",this._bindedOnCanPlay,!0),this.video.addEventListener("play",this._bindedOnPlay,!0),this.video.addEventListener("pause",this._bindedOnPause,!0),this.video.addEventListener("ended",this._bindedOnComplete,!0),this.video.addEventListener("error",this._bindedOnPlayerError,!0),this.video.addEventListener("click",this._bindedOnClickThru,!0),this.video.addEventListener("volumechange",this._bindedOnVolumeChange,!0),this.video.addEventListener("timeupdate",this._bindedOnTimeUpdate,!0),this.video.addEventListener("durationchange",this._bindedOnDurationChange,!0),this.video.addEventListener("waiting",this._bindedOnWaiting,!0))}},{key:"_disconnectFromVideoTag",value:function(){this.video.removeEventListener("canplay",this._bindedOnCanPlay,!0),this.video.removeEventListener("play",this._bindedOnPlay,!0),this.video.removeEventListener("pause",this._bindedOnPause,!0),this.video.removeEventListener("ended",this._bindedOnComplete,!0),this.video.removeEventListener("error",this._bindedOnPlayerError,!0),this.video.removeEventListener("click",this._bindedOnClickThru,!0),this.video.removeEventListener("volumechange",this._bindedOnVolumeChange,!0),this.video.removeEventListener("timeupdate",this._bindedOnTimeUpdate,!0),this.video.removeEventListener("durationchange",this._bindedOnDurationChange,!0),this.video.removeEventListener("waiting",this._bindedOnWaiting,!0),this._bindedOnCanPlay=this._bindedOnPlay=this._bindedOnPause=this._bindedOnComplete=this._bindedOnPlayerError=this._bindedOnVolumeChange=this._bindedOnTimeUpdate=this._bindedOnDurationChange=this._bindedOnWaiting=this._bindedOnPlaying=this._bindedOnClickThru=void 0}},{key:"_loadVideoTagSources",value:function(){if(!this.stopped){this._clearVideoSources();for(var t=0;t<this.mediaFiles.length;t++)this._addVideoSource(this.mediaFiles[t]);this.mediaUrl&&this.mediaFile&&this.playerDAST.set({vu:this.mediaUrl,vbr:this.mediaFile.bitrate,vwd:this.mediaFile.width,vht:this.mediaFile.height,ot:this.mediaFile.originalType,st:this.mediaFile.subType})}}},{key:"_createBindedCallback",value:function(){this._bindedOnCanPlay=this._onCanPlay.bind(this),this._bindedOnPause=this._onPause.bind(this),this._bindedOnComplete=this._onComplete.bind(this),this._bindedOnPlayerError=this._onPlayerError.bind(this),this._bindedOnVolumeChange=this._onVolumeChange.bind(this),this._bindedOnTimeUpdate=this._onTimeUpdate.bind(this),this._bindedOnDurationChange=this._onDurationChange.bind(this),this._bindedOnWaiting=this._onWaiting.bind(this),this._bindedOnPlay=this._onPlay.bind(this),this._bindedOnClickThru=this._onClickThru.bind(this)}},{key:"_onCanPlay",value:function(){this.stopped||(this.videoLength=this.video.duration,p.logToBI(this.vpaidLog,"canplay",{videoCanPlay:!0}),this.logVideoBuffer("Canplay"),this.playerReady||(this.playerReady=!0,this._fireAdLoaded(),this.adPaused||this._fireAdImpression()))}},{key:"_onPlay",value:function(t,e){this.stopped||(this.adPaused?(this.adPaused=!1,t&&setTimeout(function(){this._fireAdImpression()}.bind(this),e)):this.beacon.dispatchEvent(this.vpaidEvents.AdPlaying))}},{key:"_onPause",value:function(){this.stopped||(this.adPaused=!0,parseInt(this.video.currentTime)<parseInt(this.video.duration)&&this.beacon.dispatchEvent(this.vpaidEvents.AdPaused))}},{key:"_onComplete",value:function(){this.stopped||(this.beacon.dispatchEvent(this.vpaidEvents.AdVideoComplete),this.beacon&&!this.stayAlive&&this.beacon.dispatchEvent(this.vpaidEvents.AdStopped))}},{key:"_onPlayerError",value:function(){this.stopped||--this.relevantSources>0||this.beacon.dispatchEvent(this.vpaidEvents.AdError)}},{key:"_onVolumeChange",value:function(){this.stopped||this.beacon.dispatchEvent(this.vpaidEvents.AdVolumeChange,{volume:this.video.volume})}},{key:"_onTimeUpdate",value:function(){if(!this.stopped&&(this.videoLength=this.getAdDuration(),this.videoLength)){var t=this.video.currentTime/this.videoLength;this._fireQuartileEvent(t),this.progressEvents&&this.progressEvents.length>0&&this._fireProgressEvent(t)}}},{key:"_onDurationChange",value:function(){this.stopped||this.beacon.dispatchEvent(this.vpaidEvents.AdDurationChange)}},{key:"_onWaiting",value:function(){p.logToBI(this.vpaidLog,"waiting",{videoCurrentTime:this.video.currentTime})}},{key:"_onClickThru",value:function(t){t?(this.video.play(),this.beacon.dispatchEvent(this.vpaidEvents.AdPlaying)):(this.beacon.dispatchEvent(this.vpaidEvents.AdClickThru,{playerHandles:!0}),this.video.pause())}},{key:"_clearVideoSources",value:function(){for(;this.video.childNodes.length;)this.video.removeChild(this.video.childNodes[0])}},{key:"_addVideoSource",value:function(t){var e=t.url;this.decodeUrl&&(e=decodeURI(e)),this.secureMediaFile&&(p.logToBI(this.vpaidLog,"shouldSecureUrl",{replacedProtocol:e.indexOf("http:")>-1},!1,!1),e=e.replace("http:","https:")),this.video.canPlayType(t.originalType)&&(this.relevantSources++,this.mediaUrl||(this.mediaFile=t,this.mediaUrl=e),this._appendVideoSource(e,t.originalType))}},{key:"_appendVideoSource",value:function(t,e){var i=document.createElement("source");i.src=t,i.setAttribute("type",e),this.video.appendChild(i)}},{key:"_fireAdLoaded",value:function(){this.eventsToFire.adLoaded||this.beacon.dispatchEvent(this.vpaidEvents.AdLoaded),this.eventsToFire.adLoaded=!0;
}},{key:"_fireAdImpression",value:function(){this.stopped||this.eventsToFire.adImpression||(this.beacon.dispatchEvent(this.vpaidEvents.AdVideoStart),this.beacon.dispatchEvent(this.vpaidEvents.AdImpression),this.eventsToFire.adImpression=!0,this.adPaused=!1)}},{key:"_fireQuartileEvent",value:function(t){t<.25||t>.75&&this.eventsToFire.q3||(t>=.25&&!this.eventsToFire.q1?(this.eventsToFire.q1=!0,this.beacon.dispatchEvent(this.vpaidEvents.AdVideoFirstQuartile)):t>=.5&&!this.eventsToFire.q2?(this.eventsToFire.q2=!0,this.beacon.dispatchEvent(this.vpaidEvents.AdVideoMidpoint)):t>=.75&&(this.eventsToFire.q3=!0,this.beacon.dispatchEvent(this.vpaidEvents.AdVideoThirdQuartile)))}},{key:"_fireProgressEvent",value:function(t){for(var e=0;e<this.progressEvents.length;e++){var i=this.progressEvents[e].offset<=("time"===this.progressEvents[e].offsetType?this.video.currentTime:t);i&&!this.progressEvents[e].fired&&(this.progressEvents[e].fired=!0,this.beacon.dispatchEvent(this.vpaidEvents.Progress,this.progressEvents[e]),this.progressEvents.splice(e,1))}}},{key:"getDOMContainer",value:function(){return this.target}},{key:"getVideoUrl",value:function(){if(this.stopped)return"";if(this.video.src)return this.video.src;var t="";if(this.video.childNodes.length>0)for(var e=this.video.querySelectorAll("source"),i=0;i<e.length;i++)if(e[i].src){t=e[i].src;break}return t}},{key:"dontDie",value:function(){}},{key:"onAfterStop",value:function(){}},{key:"removeClickableTarget",value:function(){}},{key:"logVideoBuffer",value:function(t){if(this.video.buffered){if(this.video.buffered.length>0&&0===this.video.buffered.start(0)){var e=this.video.buffered.end(0)-this.video.buffered.start(0);return void p.logToBI(this.vpaidLog,"videoBufferOn"+t,{buffered:e},!1,!1)}p.logToBI(this.vpaidLog,"videoBufferOn"+t,{buffered:0},!1,!1)}}},{key:"_getMediaUrl",value:function(){return this.mediaUrl}},{key:"_resizeAd",value:function(t,e){}}]),t}();e.default=f},function(t,e,i){"use strict";function n(){try{Promise===s&&(Promise=r)}catch(t){}return s}var r;"undefined"!=typeof Promise&&(r=Promise);var s=i(94)();s.noConflict=n,t.exports=s},function(t,e,i){"use strict";t.exports=function(t){function e(e,i,a){return function(d){var l=a._boundValue();t:for(var u=0;u<e.length;++u){var h=e[u];if(h===Error||null!=h&&h.prototype instanceof Error){if(d instanceof h)return s(i).call(l,d)}else if("function"==typeof h){var c=s(h).call(l,d);if(c===o)return c;if(c)return s(i).call(l,d)}else if(n.isObject(d)){for(var p=r(h),f=0;f<p.length;++f){var v=p[f];if(h[v]!=d[v])continue t}return s(i).call(l,d)}}return t}}var n=i(2),r=i(9).keys,s=n.tryCatch,o=n.errorObj;return e}},function(t,e,i){"use strict";function n(t){return t instanceof Error&&u.getPrototypeOf(t)===Error.prototype}function r(t){var e;if(n(t)){e=new l(t),e.name=t.name,e.message=t.message,e.stack=t.stack;for(var i=u.keys(t),r=0;r<i.length;++r){var s=i[r];h.test(s)||(e[s]=t[s])}return e}return o.markAsOriginatingFromRejection(t),t}function s(t,e){return function(i,n){if(null!==t){if(i){var s=r(a(i));t._attachExtraTrace(s),t._reject(s)}else if(e){for(var o=arguments.length,d=new Array(Math.max(o-1,0)),l=1;l<o;++l)d[l-1]=arguments[l];t._fulfill(d)}else t._fulfill(n);t=null}}}var o=i(2),a=o.maybeWrapAsError,d=i(4),l=d.OperationalError,u=i(9),h=/^(?:name|message|stack|cause)$/;t.exports=s},function(t,e,i){!function(e,i){t.exports=i()}(window,function(){return function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}({"./index.js":function(t,e,i){"use strict";var n=i("./options.js"),r=i("./utils.js"),s=function(t,e){if("trc"===n.mcrsrvcsnmspc)try{return window.TRC[t][e]}catch(t){}if("cmTag"===n.mcrsrvcsnmspc)try{return window.cmTag.config.ms[t][e]}catch(t){}return null};t.exports={get:function(t,e,i,o){t=r.cleanServiceName(t),e=e||function(t){return n.serviceDefaultVersion[t]}(t);var a=s(t,e);if(a)i&&i(a);else{var d=document.createElement("script"),l=r.setUrlPrefix(n.base_url);d.async=n.async,d.type="text/javascript",d.src=l+(/.*\/$/g.test(l)?"":"/")+t+"/"+e+"/"+t+".js",d.onload=function(){document.head.removeChild(d);try{i&&i(s(t,e))}catch(t){o&&o()}},d.onerror=function(){document.head.removeChild(d),o&&o()},document.head.appendChild(d)}},init:function(t){for(var e in n)t.hasOwnProperty(e)&&(n[e]=t[e])}}},"./options.js":function(t,e,i){"use strict";t.exports={base_url:"//vidstat.taboola.com/",async:!0,mcrsrvcsnmspc:"trc",serviceDefaultVersion:{oppsula:"1.0.1"}}},"./utils.js":function(t,e,i){"use strict";t.exports={setUrlPrefix:function(t){return"string"!=typeof t?t:(0!==(t=t.replace(/^(http[s]?:|ftp:)/g,"")).indexOf("//")&&(t="//"+t),t)},cleanServiceName:function(t){return t.replace(/.js$/,"")}}},0:function(t,e,i){t.exports=i("./index.js")}})})},function(t,e){"use strict";function i(t,e,i){}function n(t,e,i){Object.defineProperty(t,e,{writable:!1,configurable:!1,value:i})}var r=["handshakeVersion","initAd","startAd","stopAd","skipAd","resizeAd","pauseAd","resumeAd","expandAd","collapseAd","subscribe","unsubscribe"],s=["AdLoaded","AdStarted","AdStopped","AdSkipped","AdSkippableStateChange","AdSizeChange","AdLinearChange","AdDurationChange","AdExpandedChange","AdRemainingTimeChange","AdVolumeChange","AdImpression","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdClickThru","AdInteraction","AdUserAcceptInvitation","AdUserMinimize","AdUserClose","AdPaused","AdPlaying","AdLog","AdError"],o=["getAdLinear","getAdWidth","getAdHeight","getAdExpanded","getAdSkippableState","getAdRemainingTime","getAdDuration","getAdVolume","getAdCompanions","getAdIcons"],a=["setAdVolume"];i.prototype.handshakeVersion=function(t,e){},i.prototype.initAd=function(t,e,i,n,r,s,o){},i.prototype.startAd=function(t){},i.prototype.stopAd=function(t){},i.prototype.skipAd=function(t){},i.prototype.resizeAd=function(t,e,i,n){},i.prototype.pauseAd=function(t){},i.prototype.resumeAd=function(t){},i.prototype.expandAd=function(t){},i.prototype.collapseAd=function(t){},i.prototype.subscribe=function(t,e,i){},i.prototype.unsubscribe=function(t,e){},i.prototype.getAdLinear=function(t){},i.prototype.getAdWidth=function(t){},i.prototype.getAdHeight=function(t){},i.prototype.getAdExpanded=function(t){},i.prototype.getAdSkippableState=function(t){},i.prototype.getAdRemainingTime=function(t){},i.prototype.getAdDuration=function(t){},i.prototype.getAdVolume=function(t){},i.prototype.getAdCompanions=function(t){},i.prototype.getAdIcons=function(t){},i.prototype.setAdVolume=function(t,e){},n(i,"METHODS",r),n(i,"GETTERS",o),n(i,"SETTERS",a),n(i,"EVENTS",s);var d=r.filter(function(t){return["skipAd"].indexOf(t)===-1});n(i,"checkVPAIDInterface",function(t){var e=d.every(function(e){return"function"==typeof t[e]});return e}),t.exports=i},function(t,e,i){"use strict";function n(t,e,i,n){this._isValid=u(t),this._isValid&&(this._creative=t,this._el=e,this._videoEl=i,this._iframe=n,this._subscribers=new l,h.setFullSizeStyle(e),r.call(this))}function r(){if(f.forEach(function(t){this._creative.subscribe(o.bind(this,t),t)}.bind(this)),this._creative.subscribe(s.bind(this),p),this._videoEl){var t=this._iframe.contentDocument.documentElement,e=this._videoEl;t.addEventListener("click",function(i){i.target===t&&e.click()})}}function s(t,e,i){this._subscribers.triggerSync(p,{url:t,id:e,playerHandles:i})}function o(t){this._subscribers.trigger(t,Array.prototype.slice.call(arguments).slice(1))}function a(t,e,i,n){t?t(i,n):i&&e.trigger(c,i)}var d=i(27),l=i(30),u=d.checkVPAIDInterface,h=i(15),c=(d.METHODS,"AdError"),p="AdClickThru",f=d.EVENTS.filter(function(t){return t!=p});n.prototype=Object.create(d.prototype),n.prototype.isValidVPAIDAd=function(){return this._isValid},d.METHODS.forEach(function(t){var e=["subscribe","unsubscribe","initAd"];e.indexOf(t)===-1&&(n.prototype[t]=function(){var e=d.prototype[t].length,i=Array.prototype.slice.call(arguments),n=e===i.length?i.pop():void 0;setTimeout(function(){var e,r=null;try{e=this._creative[t].apply(this._creative,i)}catch(t){r=t}a(n,this._subscribers,r,e)}.bind(this),0)})}),n.prototype.initAd=function(t,e,i,n,r,s,o){r=r||{},s=h.extend({slot:this._el,videoSlot:this._videoEl},s||{}),setTimeout(function(){var d;try{this._creative.initAd(t,e,i,n,r,s)}catch(t){d=t}a(o,this._subscribers,d)}.bind(this),0)},n.prototype.subscribe=function(t,e,i){this._subscribers.subscribe(e,t,i)},n.prototype.unsubscribe=function(t,e){this._subscribers.unsubscribe(e,t)},n.prototype.on=n.prototype.subscribe,n.prototype.off=n.prototype.unsubscribe,d.GETTERS.forEach(function(t){n.prototype[t]=function(e){setTimeout(function(){var i,n=null;try{i=this._creative[t]()}catch(t){n=t}a(e,this._subscribers,n,i)}.bind(this),0)}}),n.prototype.setAdVolume=function(t,e){setTimeout(function(){var i,n=null;try{this._creative.setAdVolume(t),i=this._creative.getAdVolume()}catch(t){}a(e,this._subscribers,n,i)}.bind(this),0)},n.prototype._destroy=function(){this.stopAd(),this._subscribers.unsubscribeAll()},t.exports=n},function(t,e,i){"use strict";function n(t,e,i,n,r){i=i||{},this._id=p(),this._destroyed=!1,this.store=r,this._frameContainer=c.createElementInEl(t,"div"),this._frameContainer.style.position="initial",this._videoEl=e,this._vpaidOptions=n||{timeout:1e4},this._templateConfig={template:i.template||v,extraOptions:i.extraOptions||{}}}function r(t){var e=this[t];e&&(e.remove&&e.remove(),delete this[t])}function s(){a.call(this),delete this._adUnit}function o(){a.call(this),l.call(this)}function a(){r.call(this,"_frame"),d.call(this)}function d(){this._onLoad&&(window.removeEventListener("message",this._onLoad),c.clearCallbackTimeout(this._onLoad),delete this._onLoad)}function l(){this._adUnit&&(this._adUnit.stopAd(),delete this._adUnit)}function u(){if(this._destroyed)throw new Error("VPAIDHTML5Client already destroyed!")}function h(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}var c=i(15),p=c.unique("vpaidIframe"),f=i(28),v='<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"></head><body style="margin:0;padding:0"><div class="ad-element"></div><script type="text/javascript" src="{{iframeURL_JS}}"></script><script type="text/javascript">window.parent.postMessage(\'{"event": "ready", "id": "{{iframeID}}"}\', \'{{origin}}\');</script></body></html>',m="AdStopped";n.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,o.call(this))},n.prototype.isDestroyed=function(){return this._destroyed},n.prototype.loadAdUnit=function(t,e){function i(t){if(t.origin===h()){var i;try{i=JSON.parse(t.data)}catch(t){i={}}if(i.id===r.getID()){var n,o,a;if(r._frame.contentWindow?(a=r._frame.contentWindow.getVPAIDAd,o=c.validate("function"==typeof a,"the ad didn't return a function to create an ad")):o="the iframe is not anymore in the DOM tree",!o){var l=r._frame.contentWindow.document.querySelector(".ad-element");n=new f(a(),l,r._videoEl,r._frame),n.subscribe(m,s.bind(r)),o=c.validate(n.isValidVPAIDAd(),"the add is not fully complaint with VPAID specification")}return r._adUnit=n,d.call(r),e(o,o?null:n),!0}}}function n(){e("timeout",null)}u.call(this),o.call(this);var r=this,a=c.createIframeWithContent(this._frameContainer,this._templateConfig.template,c.extend({iframeURL_JS:t,iframeID:this.getID(),origin:h()},this._templateConfig.extraOptions));this.store.get("msnifrmsrchk")&&(a._src=a.src,Object.defineProperty(a,"src",{get:function(){return a._src},set:function(t){}})),this._frame=a,this._onLoad=c.callbackTimeout(this._vpaidOptions.timeout,i.bind(this),n.bind(this)),window.addEventListener("message",this._onLoad)},n.prototype.unloadAdUnit=function(){o.call(this)},n.prototype.getID=function(){return this._id},t.exports=n},function(t,e){"use strict";function i(){this._subscribers={}}function n(t,e){setTimeout(function(){t.handler.call(t.context,e)},0)}i.prototype.subscribe=function(t,e,i){this.isHandlerAttached(t,e)||this.get(e).push({handler:t,context:i,eventName:e})},i.prototype.unsubscribe=function(t,e){this._subscribers[e]=this.get(e).filter(function(e){return t!==e.handler})},i.prototype.unsubscribeAll=function(){this._subscribers={}},i.prototype.trigger=function(t,e){for(var i=this.get(t),r=0;r<i.length;r++)n(i[r],e)},i.prototype.triggerSync=function(t,e){var i=this.get(t);i.forEach(function(t){t.handler.call(t.context,e)})},i.prototype.get=function(t){return this._subscribers[t]||(this._subscribers[t]=[]),this._subscribers[t]||[]},i.prototype.isHandlerAttached=function(t,e){return this.get(e).some(function(e){return t===e.handler})},t.exports=i},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function(){function t(e){i(this,t),this.os=e.os.name,this.osVersion=parseInt(e.os.version),this.browserName=e.browser.name,this.browserMajorVersion=parseInt(e.browser.major)}return n(t,[{key:"isAutoplaySupported",value:function(){switch(this.os){case"Android":return this.isAutoplaySupportedAndroid();case"iOS":return this.isAutoplaySupportedIOS();default:return!1}}},{key:"isAutoplaySupportedIOS",value:function(){if(this.osVersion<10)return!1;switch(this.browserName){case"Firefox":return this.browserMajorVersion>=7;default:return!0}}},{key:"isAutoplaySupportedAndroid",value:function(){switch(this.browserName){case"Chrome":case"Chrome WebView":return parseInt(this.browserMajorVersion)>=53;case"Firefox":return parseInt(this.browserMajorVersion)>=49;case"Android Browser":return parseInt(this.browserMajorVersion)>=7;default:return!1}}}]),t}();e.default=r},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function(){function t(e){i(this,t),this.decodedData=atob(e),this.nextBits=0,this.numBitsRemaining=0,this.isEndOfStream=!1,this.pointerInDecodedData=0}return n(t,[{key:"getNextByte",value:function(){return this.pointerInDecodedData===this.decodedData.length?-1:this.decodedData.charCodeAt(this.pointerInDecodedData++)}},{key:"read",value:function(){if(this.isEndOfStream)return-1;if(0===this.numBitsRemaining){if(this.nextBits=this.getNextByte(),this.nextBits===-1)return this.isEndOfStream=!0,-1;this.numBitsRemaining=8}return this.numBitsRemaining--,this.nextBits>>7-this.numBitsRemaining&1}},{key:"isEof",value:function(){return this.isEndOfStream||0==this.numBitsRemaining&&this.pointerInDecodedData==this.decodedData.length-1}},{key:"readChar",value:function(){for(var t=0,e=0;e<7;e++){var i=this.read();t|=i<<e}return String.fromCharCode(t)}},{key:"readByte",value:function(){for(var t=0,e=0;e<8;e++){var i=this.read();t|=i<<e}return t}},{key:"read7bitString",value:function(t){for(var e="",i=0;i<t;i++)e+=this.readChar();return e}},{key:"read8bitString",value:function(t){for(var e="",i=0;i<t;i++)e+=String.fromCharCode(this.readByte());return e}},{key:"readBytes",value:function(t){for(var e=new ArrayBuffer(t),i=0;i<t;i++)e[i]=this.readByte();return e}},{key:"readInt",value:function(t){if(void 0!==t){for(var e=0,i=0;i<t;i++){var n=this.read();e|=n<<i}return e}for(var r=0,i=3;i>=0;i--)r+=this.readByte(),i>0&&(r<<=8);return r}},{key:"readLong",value:function(){for(var t=0,e=7;e>=0;e--)t+=this.readByte(),e>0&&(t<<=8);return t}},{key:"readShort",value:function(){for(var t=0,e=1;e>=0;e--)t+=this.readByte(),e>0&&(t<<=8);return t}},{key:"readFloat",value:function(){for(var t=new ArrayBuffer(4),e=new DataView(t),i=0;i<4;i++)e.setUint8(i,this.readByte());var n=e.getFloat32(0);return n}},{key:"readDouble",value:function(){for(var t=new ArrayBuffer(8),e=new DataView(t),i=0;i<8;i++)e.setUint8(i,this.readByte());var n=e.getFloat64(0);return n}},{key:"readBool",value:function(){return this.read()>0}}]),t}();e.default=r},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function(){function t(e){i(this,t),this.store=e,this.effectiveTypes={"slow-2g":1,"2g":2,"3g":3,"4g":4},this.types={bluetooth:1,cellular:2,ethernet:3,none:4,wifi:5,wimax:6,other:7,unknown:8},this.navigatorConnection={},this._detectConnectionType()}return n(t,[{key:"_detectConnectionType",value:function(){var t=this,e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(e){var i=function(){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection,i=e.effectiveType||"",n=e.type||"";t.navigatorConnection={browserSupport:!0,downlink:e.downlink||0,effectiveType:i,type:n,effectiveTypeId:t.effectiveTypes.hasOwnProperty(i)?t.effectiveTypes[i]:0,typeId:t.types.hasOwnProperty(n)?t.types[n]:0,rtt:e.rtt||0,saveData:e.saveData||!1},t.store.set("navigatorConnection",t.navigatorConnection),t.store.emit("navigatorConnectionChange",t.navigatorConnection)};e.onchange=i,i()}else this.navigatorConnection={browserSupport:!1},this.store.set("navigatorConnection",this.navigatorConnection)}}]),t}();e.default=r},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(37),d=r(a),l=i(8),u=r(l),h=i(1),c=n(h),p=70,f=function(){function t(e,i){s(this,t),this._store=e,this._intervalDuration=this._store.get("kpitrvldrt"),this._numOfSamplesPerMeasurment=this._store.get("prfsmpmsnt"),this._durationOfSamplePerMeasurment=this._store.get("prfsmitrvpmsnt"),this._playerOpportunityManager=i,this.dataSaverUrl=this._store.get("dtsvrurl"),this._addListeners(),this._startLoopTimeInterval(),this._measure(),this._runFirstMeasurmentCycle()}return o(t,[{key:"_addListeners",value:function(){this._store.once("stop",this._onStop.bind(this)),this._store.once("beforeunload",this._onBeforeunload.bind(this))}},{key:"_startLoopTimeInterval",value:function(){var t=this._store.get("msrkpifctr")||100;if(t=Math.min(100,t),1===t||c.getRandomInt(0,t)===t){var e=c.normalizeMilliseconds(this._store.get("msrkpiintvl")||15);this._loopInterval=setInterval(this._sendLoopKpiPixel.bind(this),e)}}},{key:"_sendLoopKpiPixel",value:function(){var t=c.createPixelParams(p,this._store);t.kpipm=this._store.get("performance.performanceMeasurment"),t.kpinw=this._store.get("performance.wfRoundTripAverageDuration"),c.sendPixel(t,this._store)}},{key:"_measure",value:function(){var t=this;this._running=!0,this._runSampling("first_kpi"),this.intervalMeasureId=setInterval(function(){t._runSampling("last_kpi")},this._intervalDuration)}},{key:"_runSampling",value:function(t){var e=this,i=new d.default;i.runEventLoopSampling(this._numOfSamplesPerMeasurment,this._durationOfSamplePerMeasurment).then(function(n){e._store.set(t,n),e._saveData(n),i.cleanResources()}),this._measureDataSaverRoundtripDuration()}},{key:"_measureDataSaverRoundtripDuration",value:function(){var t=this;if(this.dataSaverUrl){var e=(new Date).getTime(),i=new XMLHttpRequest;i.onreadystatechange=function(){i.readyState==XMLHttpRequest.DONE&&t._store.set("performance.dtsvrRoundTripAverageDuration",(new Date).getTime()-e)},i.open("GET",this.dataSaverUrl,!0),i.send(null)}}},{key:"_sendOpp",value:function(t){this._playerOpportunityManager.send(t)}},{key:"_runFirstMeasurmentCycle",value:function(){var t=this,e=new d.default;e.runOneEventLoopSampling().then(function(e){t._saveData(e),t._sendOpp(u.default.firstWfMeasurment)})}},{key:"_saveData",value:function(t){this._store.set("performance.wfRoundTripAverageDuration",this._store.get("waterfall_data.average_duration")),this._store.set("performance.performanceMeasurment",Math.round(t))}},{key:"_onBeforeunload",value:function(){this._destroy()}},{key:"_onStop",value:function(){this._destroy()}},{key:"_destroy",value:function(){this._running&&(clearInterval(this.intervalMeasureId),clearInterval(this._loopInterval),this._running=!1,this._saveData(this._store.get("last_kpi")),this._sendOpp(u.default.playerClosedMeasurment))}}]),t}();e.default=f},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function(){function t(e,n){i(this,t),this.parent=e,this.getAdSkippableRemainingTime=this.build_vpaid_get_controller(e,"getAdSkippableRemainingTime",-1),this.getAdLinear=this.build_vpaid_get_controller(e,"getAdLinear",!0),this.getAdWidth=this.build_vpaid_get_controller(e,"getAdWidth",0,"width"),this.getAdHeight=this.build_vpaid_get_controller(e,"getAdHeight",0,"height"),this.getAdExpanded=this.build_vpaid_get_controller(e,"getAdExpanded",!0),this.getAdSkippableState=this.build_vpaid_get_controller(e,"getAdSkippableState",!0),this.getAdRemainingTime=this.build_vpaid_get_controller(e,"getAdRemainingTime",-1),this.getAdDuration=this.build_vpaid_get_controller(e,"getAdDuration",-1),this.getAdCompanions=this.build_vpaid_get_controller(e,"getAdCompanions",[]),this.getAdIcons=this.build_vpaid_get_controller(e,"getAdIcons",[]),this.pauseAd=this.build_vpaid_set_controller(e,"pauseAd"),this.resumeAd=this.build_vpaid_set_controller(e,"resumeAd"),this.expandAd=this.build_vpaid_set_controller(e,"expandAd"),this.collapseAd=this.build_vpaid_set_controller(e,"collapseAd"),this.skipAd=this.build_vpaid_set_controller(e,"skipAd"),this.stopAd=this.build_vpaid_set_controller(e,"stopAd"),this.store=n,this.isMultiAdsActive=this.store.get("mltads")}return n(t,[{key:"startAd",value:function(){this.parent.vpaidHandler.startAd()}},{key:"getAdVolume",value:function(){if(!this.isMultiAdsActive){var t=this.parent.volume();return t}}},{key:"setAdVolume",value:function(t,e){this.isMultiAdsActive||this.store.get("forceMute")&&t>0||(this.parent.volume(t),this.parent.runningVpaid&&this.parent.runningVpaid.vpaid&&this.parent.runningVpaid.vpaid.setAdVolume(t))}},{key:"resizeAd",value:function(t,e,i){if(!this.isMultiAdsActive)return!!this.parent.runningVpaid&&this.parent.runningVpaid.resize(t,e,i)}},{key:"muteAd",value:function(){}},{key:"unmuteAd",value:function(){}},{key:"setParam",value:function(t,e){return this.store(t,e)}},{key:"getParam",value:function(t){return this.store(t)}},{key:"build_vpaid_set_controller",value:function(t,e){var i=function e(){return!!t.scheduleMaster.gotVpaid&&!!t.scheduleMaster.runningVpaid.vpaid[e.type]&&t.scheduleMaster.vpaid[e.type]()};return i.proxy=t,i.type=e,i}},{key:"build_vpaid_get_controller",value:function(t,e,i,n){var r=function e(){return t.scheduleMaster.gotVpaid?t.scheduleMaster.vpaid[e.type]():e.default_value_key&&void 0!=t.options[e.default_value_key]?t.options[e.default_value_key]:e.default_value};return r.proxy=t,r.default_value=i,n?r.default_value_key=n:r.default_value_key=void 0,r.type=e,r}},{key:"gotVpaid",get:function(){return!!(this.parent&&this.parent.scheduleMaster&&this.parent.scheduleMaster.gotVpaid)}},{key:"gotAd",get:function(){return!(!this.gotVpaid||!this.parent.scheduleMaster.runningVpaid.adPlaying)}}]),t}();e.default=r,r.prototype.getAdSkippableRemainingTime=r.prototype.build_vpaid_get_controller(parent,"getAdSkippableRemainingTime",-1)},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function s(t){function e(){if(this.isMobile){var t=this.store.get("forcecnvsmpg"),e=this.store.get("useapforcntnt");if(t&&!e)return this.store.set("hasAutoPlay",!1),void(this.hasAutoPlay=!1);var i=this.store.get("ua"),n=new E.default(i);n.isAutoplaySupported()?(this.store.set("hasAutoPlay",!0),this.hasAutoPlay=!0):(this.store.set("hasAutoPlay",!1),this.hasAutoPlay=!1)}}var i=this,n=81;this.overrideWindowMethods=function(){Object.assign=function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}};var r=A.parseUserAgent(),s=void 0==Object.assign||!A.isNativeCode(Object.assign);s&&this.overrideWindowMethods(),this.status="loading",this.videoLength=0,this.ga_set=!1,this.video=void 0,this.repeatCount=0,this.schedule={},this.playerIsClosed=!1,this.options=(0,c.getDefaults)(t);var o=Object.assign((0,c.getUnitParams)(),t.dplayerSettings);this.options=Object.assign({},this.options,o);var d=new f.default(this.options);this.store=d;var u=A.createPixelParams(n,this.store);A.sendPixel(u),this.store.set("player_id",Date.now()+"_"+A.generateGuid(30)),this.store.set("fullPageUrl",window.location.href),this.store.set("forcePause",!1),this.store.set("forceMute",!1),this.store.set("dataSaverDetected",!1),this.store.set("conversionsCount",0),this.store.set("failsCount",0),this.store.set("getAdData.count",0),this.store.set("playerAspectRatio",this.options.aspect_ratio),this.store.set("noplrcntr",this.store.get("noplrcntr")&&this.store.get("isMultiVpaidUnit")),this.store.set("isAmp",window.TRC&&window.TRC.isAMP),h.default.prototype.debugLevels=this.store.get("debugLevels")||"",this.logConnectionType=function(t){var e="unknown",i={1:"dialup",2:"wired",3:"wifi",4:"mobile",5:"satellite"};t&&(e=i.hasOwnProperty(t)?i[t]:t.toString()),this.store.set("connectionType",{type:e})},this._preventAutoplay=!this.store.get("isMobile")&&this.store.get("prvaupl")&&r&&r.browser&&r.browser.name&&"firefox"==r.browser.name.toLowerCase();var p={};try{var v=new V.default(t.auc_dast,this.store);p=v.fetchResults(),p&&(p.sesid&&this.store.set("sessionId",p.sesid),this.logConnectionType(p.ct))}catch(t){this.store.set("dastDecoderError",A.stringify(t))}this.store.set("dast",p),p.hasOwnProperty("abt")&&(this.store.set("dast_AbTest",p.abt),this.store.set("abTest",this.store.get("abTest")?this.store.get("abTest")+"|"+p.abt:p.abt));var g=this.store.get("isMobile"),_=this.store.get("measureKPI");(g||_)&&(this.playerOpportunityManager=new L.default(this.store)),this.store.get("base_url")&&0!==this.store.get("base_url").length||(this.store.set("original_base_url","empty"),this.store.set("href",window.location.href),this.store.set("base_url","//www.cmbestsrv.com")),this.resourceLoader=new O.default(this.store),this.store.get("loadrsrc")&&this.resourceLoader.loadCSSResources(),this.connectionTypeDetector=new H.default(this.store),this.store.set("queueLength",0),this.store.set("vpaidReadyCount",0),this.store.set("document.visible",!document.hidden),A.reportDebug("player_options","ctor1",{type:"debug",message:"ctor1",options:this.store.data},this.store),d.set("ads_playing",0),d.set("ads_started",0),d.set("total_impressions",0),this.dependenciesLoader=new W.default(this.store),this.dependenciesLoader.getDynamicSettings();var w=this.store.getLatestVersion("hjk");if(w&&w.value){var k=w.value.match(/(?:\/vpaid\/hjk.)(.*).js/);if(k&&2===k.length){var C=k[1];this.dependenciesLoader.get("hjk",C,"hjkFuncString",w.value,this.store.get("hjkclb"),function(){i.store.get("hjkbldomsencdd")&&i.store.get("hjkbldomsencdd").length>0?i.store.set("hjkFuncString",i.store.get("hjkFuncString").replace('"%%%TEMP%%%"',A.stringify(i.store.get("hjkbldomsencdd")))):i.store.set("hjkFuncString",i.store.get("hjkFuncString").replace('"%%%TEMP%%%"',A.stringify(i.store.get("hjkbldoms"))))})}}var P=this.store.getLatestVersion("anltcsurl");if(P&&P.value){var I=P.value.match(/(?:\/vpaid\/vpaidAnalytics.)(.*).js/);if(I&&2===I.length){var x=I[1];this.dependenciesLoader.get("vpaidAnalytics",x,"analyticsFuncString",P.value,this.store.get("anltcsclb"))}}_&&(this.KPIsRecorder=new T.default(this.store,this.playerOpportunityManager)),this.options.schedule&&this.options.schedule.length&&this.options.schedule[0].ad_parameters&&this.options.schedule[0].ad_parameters.length>2&&d.set("static_schedule",this.options.schedule),this.overrideNonNativeFunctions=function(){var t=this.store.get("ovrdnonntvfnclst");if(Object.keys(t).length>0){var e=document.createElement("iframe");e.style.width=0,e.style.height=0,e.style.visibility="hidden",e.style.display="none",document.body.appendChild(e);for(var i in t)A.isNativeCode(window[i])||(window[i]=t[i](e))}},this.overrideNonNativeFunctions(),this.isMobile=this.store.get("isMobile"),e.call(this),this.isMultiVpaidUnit=this.store.get("isMultiVpaidUnit");var D=this;window.addEventListener("beforeunload",function(t){i.store.emit("beforeunload")}),this.store.on("AdImpression",function(){D.killAfterXWithNoConversion()}),this.playerStatus="content",this.store.on("AdPlayerVisible",function(){if(!this.playerIsClosed){this.playerStatus="ad";var t={playerState:this.playerStatus,isVisible:!1};this.VideoControls&&(this.isMobile?this.VideoControls.setState(t):(this.wasContentPausedBeforeAd=this.VideoControls.getValueFromControlsState("isPaused"),t.isPaused=!1,this.VideoControls.setState(t),this.runningVpaid&&(this.runningVpaid.vpaid.vpaidHandler.setPaused(!1),this.runningVpaid.vpaid.vpaidHandler.volume(this.VideoControls.getValueFromControlsState("volume")))),this.store.emit("playerStatusChanged",this.playerStatus))}}.bind(this)),this.store.on("AdPlayerHidden",function(){if(!this.playerIsClosed){this.playerStatus="content";var t={playerState:this.playerStatus,isVisible:!0};this.VideoControls&&(this.isMobile?(this.volume(0),this.VideoControls.setState(t)):(t.isPaused=this.wasContentPausedBeforeAd,this.VideoControls.setState(t),this.volume(this.VideoControls.getValueFromControlsState("volume"))),this.store.emit("playerStatusChanged",this.playerStatus))}}.bind(this)),this.debugTracker=new h.default("OvaMediaPlayer"),this.debugTracker.info("unit-version: "+this.store.get("unit_loader_version")+", player-version: "+this.store.get("player_version"),this.store,{color:"#D15EFF"}),this.seek=function(t){if(!this._isAdState()&&this.video.currentTime!==t)try{if(void 0==t)return this.video.currentTime;if(isNaN(parseFloat(t)))return;this.video.currentTime=parseFloat(t)}catch(t){return 0}},this.killAfterXWithNoConversion=function(){var t=this.store.get("kaxwnc");t&&(this.kaxwnc&&clearTimeout(this.kaxwnc),this.kaxwnc=setTimeout(function(){D.closeCleanPlayer("killAfterXWithNoConversion")},t))},this.killAfterXWithNoConversion(),this.play=function(){if(!this.store.get("forcePause"))return this._isAdState()?void this.vpaidHandler.vpaid.manager.play():void this.video.play();
},this.pause=function(){return this._isAdState()?void this.vpaidHandler.vpaid.manager.pause():(this.store.emit("contentPaused"),void this.video.pause())},this.resume=function(){return this._isAdState()?void this.vpaidHandler.vpaid.manager.play():(this.store.emit("contentResumed"),void("paused"==this.status&&this.video.play()))},this.stop=function(){try{if("stopped"==this.status||this._isAdState())return;this.status="stopping",this.video.pause(),this.seek(0),this.status="stopped",this.options.onPlayerStop(this)}catch(t){}},this.resize=function(t,e,i){this.vpaidManager&&this.vpaidManager.resize(t,e);var n=0,r=0,s=0;try{(void 0==t||isNaN(parseInt(t)))&&(t=!1),(void 0==e||isNaN(parseInt(e)))&&(e=!1),t||e||(this.debugTracker.error("resize","No `height` or `width` specified!"),t=this.store.get("width"),e=this.store.get("height")),e&&t?(this.options.height=e+"",this.options.width=t+"",this.setVideoSize(this.options.width.search(/px$/g)>-1?this.options.width:this.options.width+"px",this.options.height.search(/px$/g)>-1?this.options.height:this.options.height+"px")):(i&&i.split(":").length>1&&(this.options.aspect_ratio=i),t?(this.options.height=!1,this.options.width=t+"",s=this.options.aspect_ratio.split(":")[1]/this.options.aspect_ratio.split(":")[0],n=this.options.width.search(/px$/g)>-1?this.options.width:parseFloat(this.options.width)+"px",r=Math.floor(parseFloat(n)*s)+"px",this.setVideoSize(n,r)):(this.options.width=!1,this.options.height=e+"",s=this.options.aspect_ratio.split(":")[0]/this.options.aspect_ratio.split(":")[1],r=this.options.height.search(/px$/g)>-1?this.options.height:parseFloat(this.options.height)+"px",n=Math.floor(parseFloat(r)*s)+"px",this.setVideoSize(n,r)))}catch(t){this.debugTracker.error("resize","Resizing component failed!")}},this.setVideoSize=function(t,e){this.isMultiVpaidUnit||(this.store.get("noplrcntr")||(this.target.style.width=t,this.target.style.height=e,this.target.setAttribute("width",parseInt(t)),this.target.setAttribute("height",parseInt(e))),this.video.style.width=t,this.video.style.height=e,this.video.setAttribute("width",parseInt(t)),this.video.setAttribute("height",parseInt(e))),this.scheduleMaster.runningVpaid&&!this.scheduleMaster.runningVpaid.finished&&this.scheduleMaster.runningVpaid.resize(parseInt(t),parseInt(e))},this.handleTarget=function(t){var e;return e=this.store.get("noplrcntr")?document.querySelector(t):"string"==typeof t?document.getElementById(t):t},this.stringToSeconds=function(t){for(var e=t.split(":"),i=[],n=0;n<e.length;n++)i.push(isNaN(parseInt(e[n]))?0:parseInt(e[n]));var r=0;switch(i.length){case 1:r=parseInt(t);break;case 2:r=60*parseInt(i[0])+parseInt(i[1]);break;case 3:r=3600*parseInt(i[1])+60*parseInt(i[1])+parseInt(i[2])}return r},this.secondsToString=function(t){t=Math.floor(t);var e=(t-t%3600)/3600;e=e<10?"0"+e:e,t-=3600*e;var i=(t-t%60)/60;return i=i<10?"0"+i:i,t-=60*i,t=t<10?"0"+t:t,(e>0?e+":":"")+i+":"+t},this.generateId=function(){for(var t="vpaid-"+Math.floor(65536*(1+Math.random()));document.getElementById(t);)t="vpaid-"+Math.floor(1e5*Math.random());return t},this.ova=new a.default(this,this.store),this.initVpaidManager=function(){this.vpaidManager=new b.default(this.store,this)},this.store.on("closePlayer",function(){i.closePlayer()}),this.initScheduleMaster=function(){this.scheduleMaster=new l.default(this,this.store),this.store.get("vForce")&&this.scheduleMaster.disable()},this.initScheduleMaster(),this.handlePlayerPause=function(){if(!this.playerIsClosed)switch(this.status){case"loading-play":case"playing":this.status="paused",this.options.onPlayerPause(this);break;default:return}},this.handlePlayerPlay=function(){if(!this.playerIsClosed)switch(this.status){case"loading":this.status="loading-play";break;case"ended":this.status="playing",window.setTimeout(function(){!this.playerIsClosed&&this.options._onPlayerRepeat&&this.options._onPlayerRepeat()}.bind(this),0),window.setTimeout(function(){!this.playerIsClosed&&this.options._onPlayerRepeat&&this.options._onPlayerRepeat()}.bind(this),0),window.setTimeout(function(){!this.playerIsClosed&&this.options.onPlayerPlay&&this.options.onPlayerPlay()}.bind(this),0);break;case"loading-play":case"stopped":case"paused":this.status="playing",window.setTimeout(function(){!this.playerIsClosed&&this.options.onPlayerResume&&this.options.onPlayerResume()}.bind(this),0);break;default:return}},this._onPlayerRepeat=function(){this.repeatCount++},this.handleOnCanPlay=function(){if(!this.playerIsClosed)switch(this.status){case"loading-play":this.status="playing",this.createSchedule(),window.setTimeout(function(){this.onPlayerReadyRun(),this.options.onPlayerReady()}.bind(this),0),window.setTimeout(function(){this.options.onPlayerPlay()}.bind(this),0);break;case"loading":this.createSchedule(),window.setTimeout(function(){this.onPlayerReadyRun(),this.options.onPlayerReady()}.bind(this),0);break;default:return}},this.handlePlayerEnd=function(){if(!this.playerIsClosed)switch(this.store.emit("contentChanged"),this.status){case"playing":window.setTimeout(function(){this.options.onPlayerPause()}.bind(this),0);case"paused":this.status="ended",this.options.repeat?window.setTimeout(function(t){t.play()}.bind(this,this.video),0):(this.options.onPlayerComplete(this),this.options.onPlayerStop(this));break;default:return}},this.handlePlayerSeeked=function(t){this.playerIsClosed||window.setTimeout(function(){this.options.onPlayerSeek()}.bind(this),0)},this.handlePlayerError=function(t){this.status="stopping",this.video.pause(),this.status="loading",this.options.onPlayerError(this,t)},this.handlePlayerVolume=function(){this.debugTracker.info("Event","Player Volume Was Changed!")},this.muteToggle=function(){this.options.mute?this.unMute():this.mute()},this.mute=function(){return this._isAdState()?void this.vpaidHandler.vpaid.manager.mute():(this.video.muted=this.options.mute=!0,this.vpaidManager&&this.vpaidManager.mute(),void this.volume(0))},this.unMute=function(){return this._isAdState()?void this.vpaidHandler.vpaid.manager.unmute():(this.video.muted=this.options.mute=!1,this.vpaidManager&&this.vpaidManager.unmute(this.options.volume>1?this.options.volume/100:this.options.volume),void this.volume(this.options.volumeBeforeMute))},this.volume=function(t){if("stopped"!=this.status&&!(this.store.get("forceMute")&&t>0)){if(this.vpaidManager&&this.vpaidManager.volume(t),void 0==t)return this._getCurrentVolume();if(!(this.options.videoControlsForceMute&&t>0))return 0===t&&0!=this.options.volume&&(this.options.volumeBeforeMute=this.options.volume),this.options.volume=t,t=t>1?t/100:t,0==t?(this.video.muted=this.options.mute=!0,this.video.volume=0):(this.video.muted=this.options.mute=!1,this.video.volume=t),D.store.set("volume",t),this.VideoControls&&this.VideoControls.setState({volume:t}),t}},this._getCurrentVolume=function(){return this._isAdState()?this.vpaidHandler.vpaid.manager.getCurrentWorkingVpaidVolume():this.options.volume},this.onPlayerReadyRun=function(){var t=this.onPlayerReadyActions.length;if(0!=t){for(var e=0;e<t;e++)this.onPlayerReadyActions[e].apply(this,[]);this.onPlayerReadyActions=new Array}},this.onPlayerReadyActions=new Array,this.attachEventsToVideo=function(t){var e=this,i=this,n=function t(e){t.player.handlePlayerSeeked(e)};n.player=this,t.addEventListener("seeked",n,!0);var r=function t(){t.player.handleOnCanPlay()};r.player=this,t.addEventListener("canplay",r,!0);var s=function t(){t.player.handlePlayerPlay()};s.player=this,t.addEventListener("play",s,!0);var o=function t(){t.player.handlePlayerPause()};o.player=this,t.addEventListener("pause",o,!0);var a=function t(){t.player.handlePlayerEnd()};a.player=this,t.addEventListener("ended",a,!0);var d=function(t){i.isMobile||i.handlePlayerError(t)};d.player=this;var i=this;t.addEventListener("error",d,!0),t.addEventListener("click",function(){0===t.currentTime&&this.store.get("dataSaverDetected")&&(t.play(),i.VideoControls&&i.VideoControls.setState({isPaused:!1}))}),this.contentInterval=setInterval(function(){var t=i.video.currentTime,n=i.video.duration;e.store.set("contentTime",t),e.store.set("contentDuration",n)},5e3)},this._switchToCanvas=function(t){var e=this;if(this.playerOpportunityManager.send(M.default.fallBackCanvas),this._shouldPlayContent()){var i=this,n=function(){i.canvas.destroy(),i.store.set("sncad",!0),i.canvas=!1},r="";t.src?r=t.src:this.options.files.map(function(t){if(!r){if(/\.mpg$/.test(t.url)||/\.mpeg$/.test(t.url))return;r=t.url}}),this.canvas=new y.default(t,{_onPlayerError:n},!0,{position:"absolute",zIndex:102},this.store,this.store.get("repeat"),this.target),this.canvas.on("newVidCreated",this._onNewVidCreated.bind(this)),setTimeout(function(){t._vidSetAttr("src",""),setTimeout(function(){e.canvas&&(e.canvas.setSrc(r),t.style.display="none",e.handleOnCanPlay())},2e3)},2)}},this.createMediaPlayer=function(){this.store.get("noplrcntr")||(this.target.className+=" vpaid-player-container",this.isMultiVpaidUnit&&A.addClass(this.target,"multi-vpaids"));var e=document.createElement("video");if(this.playerTag=e,e.id=this.generateId(),e.className=this.options.video_class_name,this.isMultiVpaidUnit&&A.addClass(e,"multi-vpaids"),e.style.cssText="position: relative; z-index:99; cursor:pointer; display:block",e.setAttribute("playsinline",""),e.setAttribute("muted",""),this._preventAutoplay||e.setAttribute("autoplay",""),this.isMobile&&this.hasAutoPlay){var i=this.store.get("ua");if("Android"===i.os.name){var n=function(){this.store.get("dataSaver")&&(this.store.set("forcecnvsmpg",!0),this._switchToCanvas(e),this.VideoControls&&this.VideoControls.setCanvas(this.canvas))};this.store.get("dtsvr")?(d.on("dataSaverDetectionFinished",n.bind(this)),S.default.detect(this.store)):this.store.get("dataSaver")?(this.store.set("serverSideDataSaver","on"),n.call(this)):this.store.set("serverSideDataSaver","off")}else"iOS"===i.os.name&&(e.removeAttribute("autoplay",""),e.setAttribute("muted",""),e.muted=!0)}if(this.attachEventsToVideo(e),this.isMultiVpaidUnit)if(this.options.height||this.options.width)if(this.options.height&&this.options.width)e.style.height=this.options.height.search(/px$/g)>-1?this.options.height:this.options.height+"px",e.style.width=this.options.width.search(/px$/g)>-1?this.options.width:this.options.width+"px";else if(this.options.width){var r=this.options.aspect_ratio.split(":")[1]/this.options.aspect_ratio.split(":")[0];e.style.width=this.options.width.search(/px$/g)>-1?this.options.width:parseFloat(this.options.width)+"px",e.style.height=Math.floor(parseFloat(e.style.width)*r)+"px"}else{var s=this.options.aspect_ratio.split(":")[0]/this.options.aspect_ratio.split(":")[1];e.style.height=this.options.height.search(/px$/g)>-1?this.options.height:parseFloat(this.options.height)+"px",e.style.width=Math.floor(parseFloat(e.style.height)*s)+"px"}else this.debugTracker.error("createMediaPlayer","No `height` or `width` specified!");e.muted=!0,e.setAttribute("width",parseFloat(e.style.width)+""),e.setAttribute("height",parseFloat(e.style.height)+""),e.setAttribute("playsinline","");var o=this;setTimeout(function(){try{o.handleOnCanPlay()}catch(t){}},200),this.options.repeat&&(e.playerRepeat=!0),this.options.image&&e.setAttribute("poster",this.options.image);try{if(this._shouldPlayContent())for(var a=0;a<this.options.files.length;a++){var l=this.options.files[a];if(!/\.mpg$/.test(l.url)&&!/\.mpeg$/.test(l.url))if(this.isMobile&&!this.hasAutoPlay)this.playerTag.src=l.url;else{var u=document.createElement("source");u.setAttribute("type",l.type),u.src=l.url,e.name||(e.name=l.name?l.name:l.url),e.appendChild(u)}}}catch(t){this.debugTracker.error("createMediaPlayer","Files array supplied is corrupted or malformed!")}this._shouldPlayContent()&&this.target.appendChild(e),this.video=e,this.store.get("noplrcntr")||(this.target.id="_cm-css-reset"),this.isMobile&&!this.hasAutoPlay?this._switchToCanvas(e):e.volume=this.options.volume/100;var h=!this.isMobile&&(this.options.controls||this.store.get("ad_controls"))||this.isMobile&&this.options.controls;this.store.set("useVideoControls",!0),h&&this._shouldPlayContent()&&this.addVideoControls(),this.volume(this.options.mute?0:this.options.volume),this.setVideoSize(t.width+"px",t.height+"px"),this.VideoControls&&this.VideoControls.setState({playerState:this.playerStatus})},this._shouldPlayContent=function(){return!this.store.get("vForce")||this.store.get("cntonvfrc")},this._onNewVidCreated=function(t){this.video.parentElement.removeChild(this.video),this.video=t,this.canvas=!1,this.VideoControls&&(this.VideoControls.setCanvas(this.canvas),this.VideoControls.setVideo(this.video))},this.addVideoControls=function(){this.VideoControls=new m.default(this.video,this.store,this.target,"content"),this.canvas&&this.VideoControls.setCanvas(this.canvas),this.store.on("videoControlsVolume",this._onVideoControlVolumeChanged.bind(this)),this.store.on("volumeBeforeMuteChanged",this._onVideoControlsVolumeBeforeMuteChanged.bind(this)),this.isMobile||(this.store.on("videoControlsMute",this._onVideoControlMuteChanged.bind(this)),this.store.on("videoControlsPause",this._onVideoControlPauseChanged.bind(this)),this.store.on("videoProgressBar",this._onVideoProgressBarChanged.bind(this)))},this._onVideoControlsVolumeBeforeMuteChanged=function(t){this.options.volumeBeforeMute=t},this._isAdState=function(){return"ad"===this.playerStatus},this._onVideoControlMuteChanged=function(t){this.options.videoControlsForceMute=t,this.store.set("forceMute",t),t?this.mute():this.unMute()},this._onVideoControlVolumeChanged=function(t){this.options.videoControlsForceMute=!1,this.store.set("forceMute",0===t),this.volume(t)},this._onVideoControlPauseChanged=function(t){this.store.set("forcePause",t),t?this.pause():this.video.currentTime===this.video.duration?this.play():this.resume()},this._onVideoProgressBarChanged=function(t){if(!this._isAdState()){var e=Math.floor(t*this.video.duration);this.store.emit("videoProgressBarTransition",this.video.duration,e),this.video.currentTime=e}},this.onVpaidCreated=function(t){this.runningVpaid=t,this.vpaidHandler=t}.bind(this),this.store.on("vpaidHandlerCreated",this.onVpaidCreated),this.ga={sendGaMessage:function(){}};var D=this;if(this.createGA=function(){},this.removeGA=function(){this.ga_set},this.convertPreMidPostToTime=function(t,e){var e=Math.round(e),i={},n=this.options.schedule_auto,r=void 0;if(r=t["pre-roll"].length>0?t["pre-roll"][0]:t["mid-roll"].length>0?t["mid-roll"][0]:t["post-roll"].length>0?t["post-roll"][0]:void 0,void 0==r)return this.debugTracker.error("PreMidPostToTime","Error creating automatic schedule!Pleace check the schedule preset!"),{};i["00:00"]=r;var s=[];t["mid-roll"].length>0?s=t["mid-roll"]:t["post-roll"].length>0?s=t["post-roll"]:s.push(r);var o=void 0;for(o=t["post-roll"].length>0?t["post-roll"][0]:s[0];n<e;){var a=this.secondsToString(n),d=s.shift();s.push(d),n+=this.options.schedule_auto,n>e&&(d=o),i[a]=d}return i},this.createSchedule=function(){if(!this.scheduleCreated&&!this.store.get("vForce")){this.scheduleCreated=!0,this.videoLength=this.video.duration,this.videoLength=this.videoLength||120;var t=this.options.schedule,e={},i=this.options.schedule_auto;0===this.options.schedule_auto&&(this.options.schedule_auto=1);for(var n=0;n<t.length;n++){var r=t[n];if(this.options.schedule_auto)e[r.roll_type]||(e[r.roll_type]=[]),e[r.roll_type].push(r);else for(var s=0;s<r.positions.length;s++)!e[r.positions[s]]&&this.videoLength-this.options.min_vpaid_run_time>this.stringToSeconds(r.positions[s])&&(e[r.positions[s]]=r)}this.options.schedule_auto&&(e["pre-roll"]||(e["pre-roll"]=[]),e["mid-roll"]||(e["mid-roll"]=[]),e["post-roll"]||(e["post-roll"]=[]),e=this.convertPreMidPostToTime(e,this.videoLength)),this.options.schedule_auto=i,this.scheduleMaster.schedule=e,this.store.set("contentSchedule",e),this.scheduleMaster.start()}},this.setVideoFile=function(t,e,i){for(;this.video.childNodes.length;)this.video.removeChild(this.video.childNodes[0]);e?this.video.setAttribute("poster",e):this.video.removeAttribute("poster"),i?(this.status="loading",this._preventAutoplay||this.video.setAttribute("autoplay","true")):this.video.removeAttribute("autoplay");try{if(this.canvas)t.length&&(this.video.src=t[0].url,this.video.play());else{this.video.removeAttribute("src");for(var n=0;n<t.length;n++){var r=t[n],s=document.createElement("source");s.setAttribute("type",r.type),s.src=r.url,this.video.name||(this.video.name=r.name?r.name:r.url),this.video.appendChild(s)}this.video.load()}}catch(t){this.debugTracker.error("setVideoFile","Error creating video sources!")}},this._onVpaidClosed=function(){},this._pausePlayer=function(){this.scheduleMaster.stop(!0),this.seek(0),this.stop(),this.store.emit("pausePlayer")},this.closePlayer=function(){this._onVpaidClosed=this.closeCleanPlayer.bind(this,"_onVpaidClosed"),this.options.onPlayerClose(this),this.scheduleMaster.stop()},this.closeCleanPlayer=function(t){var e=this;this.store.set("playerClosed",!0),setTimeout(function(){if(t=t||"none",e.store.emit("stop","close:"+t),!e.playerIsClosed){if(clearInterval(e.contentInterval),e.vpaidManager&&e.vpaidManager.stop(),e.VideoControls&&e.VideoControls.destroy(),e.playerIsClosed=!0,e._onVpaidClosed=function(){},e.stop(),e.removeGA(),!e.store.get("noplrcntr"))for(;e.target.childNodes.length;)e.target.removeChild(e.target.childNodes[0]);e.onPlayerReadyActions=e.debugTracker=e.video=e.schedule=e.ova=e.ga=e.scheduleMaster=e.KPIsRecorder=e.VideoControls=void 0,e.options=e.target=void 0}},0)},this.target=this.handleTarget(t.target_id),!this.target||!this.target.appendChild)return void this.debugTracker.error("Constructor","No player target!Can't build player in ["+this.target+"]... aborting!");this.store.set("can_opt_out",this.store.get("can_opt_out")||null!==this.target.parentElement.querySelector("#_cm-opt-out-view")),this.options.htmlVideoSupport?this.createMediaPlayer():(this.debugTracker.error("Constructor","Browser does not support <video> Tag!Nothing to do, aborting..."),this.options.onPlayerLoadError(this)),this.store.get("base_url"),this.set=function(t,e){this.store.set(t,e)},this.get=function(t){return this.store.get(t)},this.on=function(t,e){this.store.on(t,e)},this.off=function(t,e){this.store.removeListener(t,e)},this.getVpaidLogs=function(){return this.vpaidManager?this.vpaidManager.getVpaidLogs():this.scheduleMaster?this.scheduleMaster.getVpaidLogs():void 0},this.startWaterfall=function(){try{this.scheduleMaster.vpaid.waterfallManager.start()}catch(t){return!1}return!0},this.stopWaterfall=function(){try{this.scheduleMaster.vpaid.waterfallManager.stop()}catch(t){return!1}return!0},this.emit=function(t,e){t&&this.store.emit(t,e)};var F=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;F&&setTimeout(function(){D.handleOnCanPlay()},500),this.store.get("vForce")&&this.initVpaidManager(),this.getAd=function(t){if(this.vpaidManager)return this.vpaidManager.getAd(t)},this.startIdleMode=function(){this.store.set("isIdleMode",!0)},this.stopIdleMode=function(){this.store.set("isIdleMode",!1)},this.startWf=function(){this.store.emit("startWf")},this.getPlayerDAST=function(){return this._isAdState()?this.vpaidHandler.vpaid.manager.getPlayerDAST():""},this.dropAds=function(t){this.vpaidHandler.vpaid.manager.cleanQueue(this.store.get("queue_size")||10,t),this.vpaidHandler.vpaid.waterfallManager.dropAds(t)}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var o=i(35),a=r(o),d=i(39),l=r(d),u=i(3),h=r(u),c=i(48),p=i(41),f=r(p),v=i(16),m=r(v),g=i(12),y=r(g),_=i(42),b=r(_),w=i(1),A=n(w),k=i(34),T=r(k),C=i(31),E=r(C),P=i(46),S=r(P),I=i(18),V=r(I),x=i(38),O=r(x),D=i(8),M=r(D),F=i(60),L=r(F),R=i(43),B=(n(R),i(44)),j=(n(B),i(45)),U=(n(j),i(47)),W=r(U),N=i(33),H=r(N);window.OvaMediaPlayer=s},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=i(40),a=n(o),d=i(23),l=n(d),u=function(){function t(){r(this,t),this._stopwatchs=[]}return s(t,[{key:"startSampling",value:function(){var t=new a.default;return this._stopwatchs.push(t),t.start(),this._stopwatchs.length-1}},{key:"stopSampling",value:function(t){this._stopwatchs[t].stop()}},{key:"getDuration",value:function(t){return this._stopwatchs[t].duration()}},{key:"runOneEventLoopSampling",value:function(){var t=this;return new l.default(function(e){var i=t.startSampling();setTimeout(function(){t.stopSampling(i),e(t.getDuration(i))},0)})}},{key:"runEventLoopSampling",value:function(t,e){var i=this;return new l.default(function(n){var r=[],s=0,o=setInterval(function(){s<t?(r.push(i.runOneEventLoopSampling()),s++):(clearInterval(o),l.default.all(r).then(function(t){var e=t.reduce(function(t,e){return Math.max(t,e)},0);n(e)}))},e)})}},{key:"cleanResources",value:function(){this._stopwatchs.length=0}}]),t}();e.default=u},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function(){function t(e){i(this,t),this.store=e,this.baseUrl=this.store.get("base_url"),this.playerVersion=this.store.get("full_player_version"),this.deployFolder="/vpaid/vPlayer/player/v",this.filename=this.store.get("plyrcss"),this.playerCssUrl=""+this.baseUrl+this.deployFolder+this.playerVersion+"/assets/"+this.filename+".css"}return n(t,[{key:"loadCSSResources",value:function(){var t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=this.playerCssUrl,document.head.appendChild(t)}},{key:"loadExternalResource",value:function(t,e){var i=document.createElement("script");i.src=t,i.type="text/javascript",i.async=!0,i.onload=function(t){document.head.removeChild(i),e&&e(t)},document.head.appendChild(i)}}]),t}();e.default=r},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=i(17),a=n(o),d=i(3),l=(n(d),500),u=function(){function t(e,i){r(this,t),this.schedule={},this.parent=e,this.savedTime=-1,this.runningVpaid=!1,this.runningVpaidTagData={},this.runTimeId=0,this.bug_feature=e.options.bug_feature,this.vpaidCount=0,this._firstImpression=!1,this.minTimeBetweenRuns=5e3,this.store=i,this.lastEndedPlayedVpaid=-1e6,this.timeBetweenAds=this.store.get("schedule_auto"),this.store.on("stop",this.stop.bind(this)),this.useNewScheduler=this.store.get("evtbsschdl"),this.useNewScheduler&&(this._bindedLoop2=this._loop2.bind(this),this._bindedOnVpaidReady=this._onVpaidReady.bind(this),this._bindedOnVpaidEnded=this._onVpaidEnded.bind(this),this.loop2Ticker=setInterval(this._bindedLoop2,l))}return s(t,[{key:"stop",value:function(){this.stopped=!0,window.clearTimeout(this.runTimeId),this.runningVpaid&&!this.runningVpaid.finished?(this.runningVpaid.stop(),this.savedTime=-1,this.parent=void 0,this.runningVpaid=void 0,this.schedule=void 0):(this.parent,this.savedTime=-1,this.parent=void 0,this.runningVpaid=void 0,this.schedule=void 0),this.useNewScheduler&&(this.store.removeListener("vpaidReady",this._bindedOnVpaidReady),this.store.removeListener("vpaidEnded",this._bindedOnVpaidEnded),clearInterval(this.loop2Ticker))}},{key:"stopVpaid",value:function(){this.runningVpaid&&!this.runningVpaid.finished&&this.runningVpaid.stop()}},{key:"start",value:function(){window.clearTimeout(this.runTimeId),this.useNewScheduler?(this.vpaidToRun={vpaid:this.schedule["00:00"],time:"00:00"},this.store.on("vpaidReady",this._bindedOnVpaidReady),this.store.on("vpaidEnded",this._bindedOnVpaidEnded),this._bindedLoop2()):this._loop()}},{key:"disable",value:function(){this.isDisabled=!0}},{key:"_onVpaidReady",value:function(t){this._loop2()}},{key:"_onVpaidEnded",value:function(t){t.hadImpression&&(this.lastEndedPlayedVpaid=Date.now()),this._loop2()}},{key:"_loop2",value:function(){if(!this.stopped&&!this.store.get("playerClosed")&&!this.isDisabled&&0===this.store.get("ads_started")){var t=Date.now()-this.lastEndedPlayedVpaid;t>=1e3*this.timeBetweenAds&&this.runVpaid(this.vpaidToRun.vpaid,this.vpaidToRun.time)}}},{key:"_loop",value:function(){if(!this.isDisabled){window.clearTimeout(this.runTimeId);var t=this,e=Math.floor(this.parent.video.currentTime);if(this._isContentPaused()&&(e=NaN),1===this.timeBetweenAds||e!=this.savedTime&&!isNaN(e)&&"repeating"!=this.parent.status){this.savedTime>e&&(this.savedTime=-1);var i=(new Date).getTime();if(i-this.lastRun<this.minTimeBetweenRuns)return void(t.runTimeId=window.setTimeout(function(){t._loop()},1e3));isNaN(this.savedTime)&&(this.savedTime=0);var n=this.savedTime+1;n>e&&(n=e);for(var r={vpaid:!1,time:0};n<=e;){var s=this.parent.secondsToString(n);this.schedule[s]&&(r.vpaid=this.schedule[s],r.time=s),n++}if(r.vpaid){window.lastRun=Date.now();var o=this.runVpaid(r.vpaid,r.time);o&&(this.lastRun=i)}this.savedTime=e}t.runTimeId=window.setTimeout(function(e){t._loop()},700)}}},{key:"_isContentPaused",value:function(){return this.parent.canvas?"PAUSED"===this.parent.canvas.status:this.parent.video&&this.parent.video.paused}},{key:"runVpaid",value:function(t,e){return this.runningVpaidTagData=t,this.vpaidCount++,t.vpaidCount=this.vpaidCount,this.runningVpaid?this.runningVpaid.run():(this.runningVpaid=new a.default({isFirstImpression:this.isFirstImpression,vpaidTag:t,uid:e,parent:this.parent,isPreRoll:"00:00"===e&&0===this.vpaidCount},this.parent.options,this.store),!0)}},{key:"_checkFirstImpression",value:function(){var t=!this._firstImpression;return this._firstImpression=!0,t}},{key:"getTagData",value:function(){return!!this.gotVpaid&&this.runningVpaidTagData}},{key:"getVpaidLogs",value:function(){if(this.runningVpaid)return this.runningVpaid.getVpaidLogs()}},{key:"isFirstImpression",get:function(){return this._checkFirstImpression.bind(this)}},{key:"tagVolume",set:function(t){this.runningVpaidTagData.volume=t}},{key:"vpaid",get:function(){return this.gotVpaid?this.runningVpaid.vpaid:{}}},{key:"gotVpaid",get:function(){return!(!this.runningVpaid||this.runningVpaid.finished||!this.runningVpaid.vpaidCreated)}}]),t}();e.default=u},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function(){function t(){i(this,t),this._startTime=0,this._stopTime=0,this._now=window.performance?window.performance.now.bind(window.performance):Date.now.bind(Date)}return n(t,[{key:"now",value:function(){return parseInt(this._now())}},{key:"start",value:function(){this._startTime=this.now()}},{key:"stop",value:function(){this._stopTime=this.now()}},{key:"reset",value:function(){this._stopTime=this._startTime=0}},{key:"duration",value:function(){if(this._startTime&&this._stopTime)return this._stopTime-this._startTime;throw"You did not use the stopwatch as expected!"}}]),t}();e.default=r},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),d=i(6),l=i(1),u=n(l),h=function(t){function e(t){r(this,e);var i=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));i._maxListeners=100,i.data={},Object.assign(i.data,t);var n="9.8.51";i.data.full_player_version=n,n=n.replace(/\./g,""),n=parseInt(n),i.data.debugLevels=t.debug?t.debug:"",i.data.debug=t.debug.indexOf("*")!=-1,i.data.player_version=n;var o="",a="",d="";try{a=t.unit_name,o=t.abTest,d=t.unit_main_version}catch(t){}return i.data.ab_test=o,i.data.unit_type=a,i.data.unit_version=d,i.data.session_started=Date.now(),window.cmTag&&window.cmTag.config&&window.cmTag.config.contentClickUrl&&(i.data.contentClickUrl=window.cmTag.config.contentClickUrl),i.set("ua",u.parseUserAgent()),i}return o(e,t),a(e,[{key:"incr",value:function(t){c.exists(t,this.data)||c.set(t,0,this.data);var e=c.get(t,!0,this.data)||0;if("number"==typeof e)return c.set(t,e+1,this.data),c.get(t,!1,this.data)}},{key:"decr",value:function(t){var e=c.get(t,!1,this.data);if("number"==typeof e)return c.set(t,e-1,this.data),c.get(t,!1,this.data)}},{key:"get",value:function(t){return t=t.toString(),t.indexOf(".")===-1?this.data[t]:c.get(t,!1,this.data)}},{key:"getByAdvId",value:function(t,e){var i=this.get("dsm")||{};return i&&i.hasOwnProperty(e)&&i[e].hasOwnProperty(t)?i[e][t]:this.get(t,!1,this.data)}},{key:"getByLineItem",value:function(t,e){var i=this.get("dsm")||{},n=e?e.lineItem:"";return i&&i.hasOwnProperty(n)&&i[n].hasOwnProperty(t)?i[n][t]:this.getByCampaignId(t,e)}},{key:"getByTech",value:function(t,e){var i=this.get("dsm")||{};return i&&i.hasOwnProperty(e)&&i[e].hasOwnProperty(t)?i[e][t]:null}},{key:"getByCampaignId",value:function(t,e){var i=this.get("dsm")||{},n=e?e.campaignId:"";return i&&i.hasOwnProperty(n)&&i[n].hasOwnProperty(t)?i[n][t]:this.getByAdvId(t,e?e.advId:"")}},{key:"getByAdInline",value:function(t){var e=this.get("dsm")||{},i=Object.keys(e);if(i.length>0)for(var n=new RegExp(Object.keys(e).join("|"),"gi"),r=0;r<t.length;r++){var s=t[r],o=s.as&&s.as.match(n)||s.at&&s.at.match(n);if(o&&o.length>0)return e[o[0].toLowerCase()]}return this.get("adstngs")}},{key:"getLatestVersion",value:function(t){t=t.toString();var e=t+"_latest",i=this.get(e);if(void 0!==i)return i;var n=new RegExp(t+"[v]*\\d+$"),r={value:void 0,version:0};for(var s in this.data)if(n.exec(s)){var o=parseInt(s.match(/\d+$/)[0]);(!r.value||r.version<o)&&this.data[s]&&(r.version=o,r.value=this.data[s])}else 0===r.version&&s===t&&(r.value=this.data[s]);return this.set(e,r),r}},{key:"set",value:function(t,e){t=t.toString(),c.set(t,e,this.data)}},{key:"getWfData",value:function(){var t=this.get("dsm")||{},e=[];for(var i in t)/^\d+$/.test(i)&&t[i]&&t[i].hasOwnProperty("ftchVst")&&e.push({id:i,fv:t[i].ftchVst});return e}}]),e}(d.EventEmitter);e.default=h;var c=function(){var t=function(t,e,i){for(var n,r=i||data,s=0;r&&(n=t[s]);s++)r=n in r?r[n]:e?r[n]={}:void 0;return r};return{set:function(e,i,n){var r=e.split("."),s=r.pop(),o=t(r,!0,n);return o&&s?o[s]=i:void 0},get:function(e,i,n){
return t(e.split("."),i,n)},exists:function(t,e){return void 0!==this.get(t,!1,e)}}}()},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=i(17),a=n(o),d=0,l=function(){function t(e,i){r(this,t),this.store=e,this.parent=i,this.initVpaid(),this.hadFirstImpression=!1}return s(t,[{key:"initVpaid",value:function(){var t=this.getVpaidTag(),e={"00:00":t,"00:01":t};this.store.set("contentSchedule",e),this.store.set("autoplay_on_pre_roll",!1),this.vpaidHandler=new a.default({isFirstImpression:this.isFirstImpression,vpaidTag:t,uid:d++,parent:this.parent},this.parent.options,this.store),this.vpaidHandler.runWaterfall("vforceInit")}},{key:"getVpaidTag",value:function(){var t=this.store.get("schedule"),e={};return t.forEach(function(t){t&&"pre-roll"===t.roll_type&&(e=t)}),e}},{key:"isFirstImpression",value:function(){return!this.hadFirstImpression&&(this.hadFirstImpression=!0,!0)}},{key:"getVpaidLogs",value:function(){if(this.vpaidHandler)return this.vpaidHandler.getVpaidLogs()}},{key:"getAd",value:function(t){return this.vpaidHandler.getAd(t)}},{key:"stop",value:function(){this.vpaidHandler&&!this.vpaidHandler.finished?this.vpaidHandler.stop():this.parent&&this.parent._onVpaidClosed(),this.vpaidHandler=void 0,this.schedule=void 0,this.parent=void 0,this.savedTime=-1}},{key:"pause",value:function(){this.vpaidHandler.pause()}},{key:"resume",value:function(){this.vpaidHandler.resume()}},{key:"volume",value:function(t){this.vpaidHandler.volume(t)}},{key:"mute",value:function(){this.volume(0)}},{key:"unmute",value:function(t){this.volume(t)}},{key:"resize",value:function(t,e,i){this.vpaidHandler.resize(t,e,i)}}]),t}();e.default=l},function(t,e){"use strict";var i=i||{};i.dSettings={203745:{fkadchcs:!0,moat:!0,mtfctr:20},203735:{adto:999999999,fkadchcs:!0,moat:!0,mtfctr:20},203391:{pxlnotsmtp:!0},1544895:{ad_controls:!1},1699035:{cstmdl:14,vpdcss:{".cm_video_controls_mute":{right:"3px",bottom:"25px"}}},1731795:{cstmdl:14,vpdcss:{".cm_video_controls_mute":{right:"3px",bottom:"25px"}}},1727795:{cstmdl:14,vpdcss:{".cm_video_controls_mute":{right:"3px",bottom:"25px"}}},1725135:{cstmdl:14,vpdcss:{".cm_video_controls_mute":{right:"3px",bottom:"25px"}}},204595:{fkadchcs:!0,global_ad_timeout:6e4},202697:{fkadchcs:!0},1746345:{cmpltonstpd:!0},1746335:{cmpltonstpd:!0},1749845:{cmpltonstpd:!0},1749835:{cmpltonstpd:!0},1775385:{adddsttotvpaid:!0},178348:{global_ad_timeout:6e4},187788:{global_ad_timeout:6e4},181578:{global_ad_timeout:6e4},200847:{global_ad_timeout:6e4},200947:{global_ad_timeout:6e4},66214145:{global_ad_timeout:6e4},204425:{global_ad_timeout:6e4},200437:{global_ad_timeout:6e4},201707:{global_ad_timeout:6e4},203805:{global_ad_timeout:6e4},185198:{global_ad_timeout:6e4},66214125:{global_ad_timeout:6e4},66214385:{global_ad_timeout:6e4},204475:{global_ad_timeout:6e4},200967:{global_ad_timeout:6e4},204505:{global_ad_timeout:6e4},203531:{global_ad_timeout:6e4},195717:{global_ad_timeout:6e4},200567:{global_ad_timeout:6e4},182908:{global_ad_timeout:6e4},66214505:{global_ad_timeout:6e4},66214105:{global_ad_timeout:6e4},202037:{global_ad_timeout:6e4},183028:{global_ad_timeout:6e4},202817:{global_ad_timeout:6e4},192657:{global_ad_timeout:6e4},66214465:{global_ad_timeout:6e4},202177:{global_ad_timeout:6e4},204075:{global_ad_timeout:6e4},187278:{global_ad_timeout:6e4},197287:{global_ad_timeout:6e4},188158:{global_ad_timeout:6e4},178358:{global_ad_timeout:6e4},200777:{global_ad_timeout:6e4},176568:{global_ad_timeout:6e4},200417:{global_ad_timeout:6e4},66285475:{global_ad_timeout:1e5},204635:{moat:!0,mtfctr:20},203795:{moat:!0,mtfctr:20},66214295:{moat:!0,mtfctr:20},204005:{moat:!0,mtfctr:20},66214095:{moat:!0,mtfctr:20},66214435:{moat:!0,mtfctr:20},wirewax:{dlypus:100,dlyrsm:250,fradlddonint:!0},"the trade desk":{extwnprc:!0,wnprcfld:"wp"},dbm:{extwnprc:!0,wnprcfld:"pr"}},window.TRC&&(window.TRC.dsm=window.TRC.dsm||{},window.TRC.dsm[158]=i.dSettings)},function(t,e){"use strict";var i='function startProtection(){window.ReportHijackAttempt=window.ReportHijackAttempt||function(){};var e="%%%TEMP%%%",r=new RegExp(e.map(function(e){try{return atob(e)}catch(t){return e}}).join("|"),"i"),o="//convusmp.basebanner.com/st?cijs=0&ttype=5&pix=51591248&dast=&";function p(t){return!!e.length&&r.test(t)}function i(t,e){(new Image).src=o+(new Date).getTime(),window.ReportHijackAttempt(t,e)}function n(t){if(t.src)return t.src;if(t.childNodes.length)for(var e=0;e<t.childNodes.length;e++)if(t.childNodes[e]&&t.childNodes[e].src)return t.childNodes[e].src;return t.outerHTML}try{!function(){for(var t=document.scripts||[],e=0;e<t.length;e++)t[e].src&&p(t[e].src);var r=document.querySelectorAll("iframe")||[];for(e=0;e<r.length;e++)if(p(r[e].src)){i(r[e].src,!0);break}}(),HTMLIFrameElement.prototype.hasOwnProperty("_src")||(Object.defineProperty(HTMLIFrameElement.prototype,"_src",Object.getOwnPropertyDescriptor(HTMLIFrameElement.prototype,"src")),Object.defineProperty(HTMLIFrameElement.prototype,"src",{get:function(){return this._src},set:function(t){p(t)?i(t,!1):this._src=t}})),HTMLIFrameElement.prototype._setAttribute=HTMLIFrameElement.prototype.setAttribute,HTMLIFrameElement.prototype.setAttribute=function(t,e){"src"==t.toLowerCase()&&p(e)?i(e,!1):this._setAttribute(t,e)},HTMLElement.prototype._insertBefore=HTMLElement.prototype.insertBefore,HTMLElement.prototype.insertBefore=function(t,e){if(!p(t.outerHTML))return this._insertBefore(t,e);i(n(t),!1)},HTMLElement.prototype._appendChild=HTMLElement.prototype.appendChild,HTMLElement.prototype.appendChild=function(t){if(!p(t.outerHTML))return this._appendChild(t);i(n(t),!1)},HTMLScriptElement.prototype.hasOwnProperty("_src")||(Object.defineProperty(HTMLScriptElement.prototype,"_src",Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,"src")),Object.defineProperty(HTMLScriptElement.prototype,"src",{get:function(){return this._src},set:function(t){p(t)?i(t,!1):this._src=t}})),HTMLScriptElement.prototype._setAttribute=HTMLScriptElement.prototype.setAttribute,HTMLScriptElement.prototype.setAttribute=function(t,e){"src"==t.toLowerCase()&&p(e)?i(e,!1):this._setAttribute(t,e)},HTMLObjectElement.prototype._scrollIntoView=HTMLObjectElement.prototype.scrollIntoView,HTMLObjectElement.prototype.scrollIntoView=function(){return!1},HTMLDivElement.prototype._scrollIntoView=HTMLDivElement.prototype.scrollIntoView,HTMLDivElement.prototype.scrollIntoView=function(){return!1},XMLHttpRequest.prototype._open=XMLHttpRequest.prototype.open,XMLHttpRequest.prototype.open=function(t,e,r,o,n){p(e)?i(e,!1):this._open.apply(this,arguments)}}catch(t){}}startProtection();';try{HijackResponse(i)}catch(t){}window.TRC=window.TRC||{},window.TRC.hjk=window.TRC.hjk||{},window.TRC.hjk[218]=i},function(t,e){"use strict";var i="!function(){if((window.ignoreGetVpaidAd||'function'==typeof window.getVPAIDAd)&&function(){try{return window.self!==window.top}catch(e){return!0}}()){function e(){for(var e=document.scripts||[],t=[],r=0;r<e.length;r++)t.push(e[r].src);return t}function t(e){for(var t=document.querySelectorAll('iframe'),r=[],i=0;i<t.length;i++)r.push(t[i].src),t[i].src&&'undefined'===t[i].src.substr(0,9)&&e&&e(url);return r}function r(r,i,o){var n=window._vaThis||this;if(window._vaThis){var s=e(),a=t(n._onUndefinedRelativeIframeSrcError);n.scripts=n.scripts.concat(s),n.iframes=n.iframes.concat(a),n.firstCount+=a.length+s.length}else n.data={},n.XHRUrls=[],n.XHRResponses=[],n.iframes=t(n._onUndefinedRelativeIframeSrcError),n.scripts=e(),n.firstCount=n.iframes.length+n.scripts.length,n.timeoutLength=o.timeout||3e3,n.callback=i,n.adImpressionEvent='AdImpression',n.networkCallCounter=0,n.maxNetworkCalls=o.maxNetworkCalls||!1,n.networkCallsLimitExceeded=!1,n.latencies=[],n.iframesWeights={gen:8,ggl:4,pxls:2},n.isVideoUrlPublic=void 0,n.requestId=0,n.requestStartTimes={},Object.defineProperty(n,'AnalyticsData',{get:function(){return n.data},enumerable:!0,configurable:!1}),r&&n.subscribeToAdImpression(r);if(o&&(o.withXHR&&window.XMLHttpRequest&&this.createXMLHTTPHook(),o.withIframes&&void 0!==window.HTMLIFrameElement&&this.createIframesSrcHook(o),o.withScripts&&void 0!==window.HTMLScriptElement&&this.createScriptsSrcHook(),o.timeout&&(n.timeoutLength=o.timeout),o.iframesWeights))for(var c in o.iframesWeights)n.iframesWeights[c]=o.iframesWeights[c];window.destroyAnalyticsReporter=function(){n.data=n.XHRUrls=n.XHRResponses=n.iframes=n.scripts=n.timeoutLength=n.iframesWeights=n.requestStartTimes=void 0,window.getVpaidAnalyticsReport=window.destroyAnalyticsReporter=window.onNetworkCallsLimitExceeded=window.setIsVideoUrlPublic=void 0,window.AnalyticsReporter=void 0},window.getVpaidAnalyticsReport=function(){var t=window._vaThis||this,r=[],i={scripts:t.scripts.length>0?t.scripts.slice():e(),XHRUrls:t.XHRUrls.slice(),iframes:t.iframes.slice()};for(var o in i)r=r.concat(i[o]);i.totalRequests=r,i.totalRequestsCounter=r.length,i.firstCount=t.firstCount,i.latencies=t.latencies.slice();var n=i.latencies.reduce(function(e,t){return e+t},0);return i.averageLatency=i.latencies.length?n/i.latencies.length:0,i.averageIntLatency=parseInt(i.averageLatency),i}.bind(n),window.setIsVideoUrlPublic=function(e){(window._vaThis||this).isVideoUrlPublic=e}.bind(n)}r.prototype.subscribeToAdImpression=function(e){var t=window._vaThis||this;e.subscribe(function(){t.adImpFired=!0,setTimeout(function(){t.sendData()},t.timeoutLength)},t.adImpressionEvent,t)},r.prototype.sendData=function(){var e=window._vaThis||this;e.collectData(e.adImpressionEvent),e.callback(e.adImpressionEvent,e.AnalyticsData)},r.prototype.collectData=function(t){var r=window._vaThis||this,i={};i.eventName=t,i.scripts=r.scripts.length>0?r.scripts.slice():e(),i.XHRUrls=r.XHRUrls.slice(),i.XHRResponses=r.XHRResponses.slice(),i.iframes=r.iframes.slice(),r.data[t]=i},r.prototype.onUrlHooked=function(e,t,r){var i=window._vaThis||this;i[e].push(t),r._id=i.requestId++,i.requestStartTimes[r._id]=Date.now();var o=function(){i.requestStartTimes.hasOwnProperty(this._id)&&(i.latencies.push(Date.now()-i.requestStartTimes[this._id]),delete i.requestStartTimes[this._id]),this.removeEventListener('load',o)}.bind(r);r.addEventListener('load',o),'iframes'!==e||void 0===i.isVideoUrlPublic?i.networkCallCounter++:i.networkCallCounter+=i.getIframeWeight(t),i.isMaxNetworkCallsLimitExceeded()&&i.onNetworkCallsLimitExceeded()},r.prototype.getIframeWeight=function(e){var t=window._vaThis||this;return e.indexOf('imasdk')?t.iframesWeights.ggl:t.isVideoUrlPublic?t.iframesWeights.pxls:t.iframesWeights.gen},r.prototype.createXMLHTTPHook=function(){var e=window._vaThis||this;window.XMLHttpRequest.prototype._vaOpen=window.XMLHttpRequest.prototype.open,window.XMLHttpRequest.prototype.open=function(t,r,i,o,n){return e.onUrlHooked('XHRUrls',r,this),this.addEventListener('load',function(){e.XHRResponses.push('load: '+this.responseText)}),window.XMLHttpRequest.prototype._vaOpen.apply(this,arguments)}},r.prototype.createIframesSrcHook=function(e){var t=window._vaThis||this;Object.defineProperty(HTMLIFrameElement.prototype,'_vaSrc',Object.getOwnPropertyDescriptor(HTMLIFrameElement.prototype,'src'));var r=function(r,i){if(t.onUrlHooked('iframes',r,i),r&&'undefined'===r.substr(0,9)&&t._onUndefinedRelativeIframeSrcError(r),e.deepIframes){var o=function(){try{i.removeEventListener('load',o),i.contentWindow.ignoreGetVpaidAd=!0,i.contentWindow._vaThis=t;var r=i.contentWindow.document.createElement('script');r.innerText=t.vpaidAnalyticsFunc,i.contentWindow.document.head.appendChild(r),new i.contentWindow.AnalyticsReporter(null,function(){},e)}catch(e){}};i.addEventListener('load',o)}};Object.defineProperty(HTMLIFrameElement.prototype,'src',{get:function(){return this._vaSrc},set:function(e){r(e,this),this._vaSrc=e}}),HTMLIFrameElement.prototype._vaSetAttribute=HTMLIFrameElement.prototype.setAttribute,HTMLIFrameElement.prototype.setAttribute=function(e,t){'src'===e&&r(t,this),this._vaSetAttribute(e,t)}},r.prototype.createScriptsSrcHook=function(){var e=window._vaThis||this;Object.defineProperty(HTMLScriptElement.prototype,'_vaSrc',Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,'src')),Object.defineProperty(HTMLScriptElement.prototype,'src',{get:function(){return this._vaSrc},set:function(t){e.onUrlHooked('scripts',t,this),this._vaSrc=t}}),HTMLScriptElement.prototype._vaSetAttribute=HTMLScriptElement.prototype.setAttribute,HTMLScriptElement.prototype.setAttribute=function(t,r){'src'===t&&e.onUrlHooked('scripts',r,this),this._vaSetAttribute(t,r)}},r.prototype.unHook=function(){var e=Object.getOwnPropertyDescriptor(HTMLIFrameElement.prototype,'_vaSrc'),t=Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,'_vaSrc');e&&(Object.defineProperty(HTMLIFrameElement.prototype,'src',e),HTMLIFrameElement.prototype.setAttribute=HTMLIFrameElement.prototype._vaSetAttribute),t&&(Object.defineProperty(HTMLIFrameElement.prototype,'src',t),HTMLScriptElement.prototype.setAttribute=HTMLScriptElement.prototype._vaSetAttribute),window.XMLHttpRequest.prototype._vaOpen&&(window.XMLHttpRequest.prototype.open=window.XMLHttpRequest.prototype._vaOpen)},r.prototype.onNetworkCallsLimitExceeded=function(){var e=window._vaThis||this;e.networkCallsLimitExceeded||(e.adImpFired||e.unHook(),e.networkCallsLimitExceeded=!0,e.sendData(),window.onNetworkCallsLimitExceeded())},r.prototype.isMaxNetworkCallsLimitExceeded=function(){var e=window._vaThis||this;return e.networkCallsLimitExceeded||e.maxNetworkCalls&&e.networkCallCounter>=e.maxNetworkCalls},window.AnalyticsReporter=r}}();";try{VpaidAnalytics(i)}catch(t){}window.TRC=window.TRC||{},window.TRC.vpaidAnalytics=window.TRC.vpaidAnalytics||{},window.TRC.vpaidAnalytics[31]=i},function(t,e){"use strict";function i(t){var e=t.get("dtsvrurl"),i=new XMLHttpRequest;i.open("GET",e,!0),i.onreadystatechange=function(){if(i.readyState==XMLHttpRequest.DONE){var e=i.responseText,r={};try{r=JSON.parse(e)}catch(t){}n(r,t)}},i.send(null)}function n(t,e){var i=!!t.dataSaver;e&&(e.set(r,i),e.set("clientSideDataSaver",i),e.emit("dataSaverDetectionFinished"))}var r="dataSaver";t.exports={detect:i}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=i(54),a=n(o),d=function(){function t(e){r(this,t),this.ServiceLoader=i(26),this.ServiceLoader.init(e.data),this.store=e}return s(t,[{key:"get",value:function(t,e,i,n,r,s){var o=this;this.ServiceLoader.get(t,e,function(t){o.store.get(i)||o.store.set(i,t),s&&s()},function(){o.store.get("JSONPHandler")||(o.JSONPHandler=new a.default(o.store.get("base_url"))),o.JSONPHandler.load(n,r,function(t){o.store.get(i)||o.store.set(i,t),s&&s()})})}},{key:"getDynamicSettings",value:function(){var t=this,e=this.store.get("dsu"),i=e.match(/(?:\/vpaid\/ds\/)(.*)\//);if(i&&2===i.length){var n=i[1];this.ServiceLoader.get("dsm",n,function(e){t.store.set("dsm",e)},function(){var e=t.store.get("base_url"),i=e+t.store.get("dsu");t.getScript(i,function(){t.store.set("dsm",cmTag.dSettings)})})}}},{key:"getScript",value:function(t,e){var i=document.createElement("script"),n=document.getElementsByTagName("script")[0];i.src=t,n.parentNode.insertBefore(i,n),i.onload=function(){e()}}}]),t}();e.default=d},function(t,e){"use strict";function i(t){var e={domain:window.location.hostname,cirf:"",referrer:document.referrer?document.referrer.split("//")[1]:window.location.hostname,vertical:"default",auc_dast:"0",title:"",description:"",keywords:"",default_ad_parameters:"",files:[],image:!1,target_id:"",height:!1,width:!1,controls:!0,aspect_ratio:"16:9",repeat:!0,mute:!1,oid:0,default_ad_timeout:30,volume:0,video_class_name:"video-js vjs-default-skin",schedule:[],schedule_auto:1,min_vpaid_run_time:4,debug:[],htmlVideoSupport:function(){return!!document.createElement("video").canPlayType}(),ga_factor:1,fire99:!0,ad_controls:!1,time_between_waterfall:10,tmbtwfs:function(t,e,i,n){return i.get("time_between_waterfall")},mntmbtwfsf:function(t,e,i,n){return i.get("mintimwf")},mintimwf:5e3,mntmbtwfs:5,mxtmbtwfs:900,queue_size:6,max_ready_vpaid:3,waterfall_watermark:0,base_url:"//vidstat.taboola.com",wf_path:"VideoBidRequestHandlerServlet",run_wf_when_empty:!0,kaxwnc:18e5,pstflrs:!0,pvpd:"javascript",pvidtp:"",sncad:!1,blkflshjs:!0,altmot:6e4,adimptmot:0,prtctv2:"/vpaid/hjk.184.js",hjkclb:"HijackResponse",jsnoflshdtct:!1,qsrtscr:function(t,e){return 100*e.alfrox},psthdrs:"text/plain",rstmrai:!0,vstprxy:!1,pxyurl:"http://vid.mikysrv.com/fetch?url=",global_ad_timeout:18e4,mprdct:void 0,uscnvsmpg:!0,forcecnvsmpg:!1,gtvid2:"//mpg.taboola.com/getts?url",cnvsldrt:5,mpgclrslv:["gcdn.2mdn.net"],dsu:"/vpaid/ds/117/dsm.js",run_wf_on_init:!0,useapforcntnt:!1,wf_dynmc_ps:!0,sprssviderr:!1,vForce:!1,get_ad_timeout_seconds:10,wf_manual:!1,disctxt:"By Taboola",httpsOverride:!1,usscrtgurl:!1,evtbsschdl:!0,timbtopps:2e3,cmbopps:!0,anltcsurlv4:"",anltcsurlv5:"",anltcsclb:"VpaidAnalytics",anltcsOptions:{withXHR:!0,withIframes:!0,withScripts:!0,maxNetworkCalls:0,timeout:3e3,deepIframes:!0,hideCountdown:!0},moat:!1,measureKPI:!1,prfsmpmsnt:5,prfsmitrvpmsnt:1500,kpitrvldrt:15e3,msrkpifctr:0,msrkpiintvl:15,moatPartnerCode:"taboolajsvideo2446883476",sndvltopp:!0,novdtrm:!1,dcdvdurl:!1,firstWaterfallNoaop:0,mxlifls:0,kbnul:"//vidanalytics.taboola.com",frcmtfrms:!0,frcvlm:!1,pxlnotsmtp:!1,cntonvfrc:!0,mxemptwf:0,dtsvrurl:"//vidutils.taboola.com",dtsvr:!1,mltads:!1,erlyai:!1,frcadvlmtrvl:1e3,dbncadvltm:50,stpfrcvlevnt:"AdVideoFirstQuartile",imapihok:!1,trmrdyvpaid:!0,dfltvlm:.4,usstrckisyn:!1,dlywf:!1,adto:3e5,vakll:3e5,ovrtgbydc:!1,strgprvdrttl:6048e5,frstlk:!1,pusvidprtctn:!1,encwfrs:!1,dsktmouttoadcmpltn:0,mbltmouttoadcmpltn:0,loadrsrc:!1,wfv:1,aderrbfradlddopactv:!1,isMultiVpaidUnit:!1,hdeadsplypusbtn:!0,isIdleMode:!1,mttst:"",mxntwrkclls:0,rplvpdactv:!1,rvfctr:0,dnapmxvl:0,usopsla:!1,opslavrsn:"1.0.7",mcrsrvcsnmspc:"trc",bllblevt:"",ifrmswghts:{gen:15,ggl:6,pxls:30},dskVidMuted:!1,ovrdnonntvfnclst:{},fkadchcs:!1,istblvpd:!1,mtdhkactv:!1,addprld:!1,blckbrngtofrnt:!1,tglifrmcntndsplyactv:!1,cmpltonstpddmn:["innovid.com"],cmpltonstpdms:0,aduntldflbfruntld:!1,adwrprstoplrdst:!0,bckflldlyms:5e3,mxbckflldlyitms:0,bfprty:0,lgvpdtxtelmnts:!1,shwadmtebtn:!0,wtfradpsdbfrrsmad:!1,mtfctr:0,noplrcntr:!1,plyrcss:"player",vpdcntrcstmcss:"",flbktovdo:!1,dsbgl:!1,cntdwnrgx:"",msnifrmsrchk:!0,prvaupl:!1,stpvpdonudfndsrc:!1,sprtnnvidvpd:!1,adxcrdgtadtmt:5e3,adtnladxsprtdszs:[],stpvpdonrltvsrc:!1,rvfrquesttsemttr:!0,cntgtad:!1,dftgprc:void 0,scrmf:!1,hjkbldoms:[],rtryonfl:!0,hjkbldomsencdd:[],cpcvcmpgntps:[14,17],cstmdltps:{tags:7,dCPM:9,externalCPCV:14,internalCPCV:17},drpbletps:["singleAd","adjacencyAd"],onPlayerReady:function(t){},onPlayerLoadError:function(t){},onPlayerError:function(t){},onPlayerPlay:function(t){},onPlayerStop:function(t){},onPlayerClose:function(t){},onPlayerPause:function(t){},onPlayerResume:function(t){},onPlayerSeek:function(t){},onPlayerRepeat:function(t){},onPlayerComplete:function(t){},onAdLoadError:function(t,e){},onAdError:function(t,e){},onAdStopped:function(t,e){},onAdImpression:function(t,e){},onAdVideoStart:function(t,e){},onAdVideoEnd:function(t,e){},onAdClick:function(t,e,i){}};for(var i in e)void 0==t[i]&&(t[i]=e[i]);t.description||(t.description=t.title),t.keywords||(t.keywords=t.title),parseFloat(t.width)||parseFloat(t.height)||(t.width="377",t.height="314");var n=parseInt(100*Math.random())+1<=t.ron_percent;return t.tagDefault={ad_controls:t.ad_controls,url:"",pubid:"",tagid:"",vidlength:"",video_url:t.files[0],title:t.title,cirf:t.cirf,description:t.description,keywords:t.keywords,ad_parameters:t.default_ad_parameters,muted:t.mute?1:0,auc_dast:t.auc_dast,referrer:t.referrer,domain:t.domain,vertical:t.vertical,roll_type:"mid-roll",oid:t.oid,ad_timeout:t.default_ad_timeout,rs:"1",st:"1",sts:"1",type:"wf",noaop:"10",sortOrderType:0,mfp:4,afbp:t.use_flash_bypass,isRon:n,isvideo:0,mindur:1,maxdur:t.default_ad_timeout,minbr:1,maxbr:1e4,plmd:0,defaultTagTimeout:30,totaltimeout:60,use_as_is:!1,skip_vast:!1},t}function n(){var t={};try{t=window.cmTag.config}catch(t){return{}}var e={};for(var i in t)if(0===i.indexOf("player.settings.")){var n=i.substr(16,i.length-16);e[n]=r(t[i])}return e}function r(t){var e=/^\d+$/.test(t);if(e)return parseInt(t);var i=/^true$|^false$/g.test(t);return i?"true"===t||t===!0:t}Object.defineProperty(e,"__esModule",{value:!0}),e.getDefaults=i,e.getUnitParams=n},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(10),d=n(a),l=i(7),u=(n(l),i(55)),h=n(u),c=i(3),p=n(c),f=i(65),v=n(f),m=i(5),g=n(m),y=i(52),_=n(y),b=i(26),w=(i(110),0),A=function(){function t(e,i,n){r(this,t),this.vpaidHandler=i,this.store=n,this.vpaidCount=1,this.version="VPAID-1.0.0",this.VPAIDversion="1.1",this.debugTracker=new p.default(this.version),this.beacon=new d.default(this),this.vpaidParameters=this._defaultVpaidParameters,this.config=this._defaultVpaidConfig;var s={};this._createIframesDetector(),this.store.get("mltads")&&this.store.on("resizeVpaidWrapper",this._onResizeAd.bind(this));for(var o in e)s[o.toUpperCase()]=e[o];this.config.creatives=Object.assign({},this._defaultVpaidParameters,s),this.store.get("cmbopps")&&this.store.get("usopsla")&&this._loadOppsula(),this.manager=!1,this._initWaterfall();for(var a in this.vpaidEvents)this.beacon.addEventListener(this.vpaidEvents[a],this._runEventFunction.bind(this));this.beacon.dispatchEvent(this.vpaidEvents.AdLoaded,""),this.store.emit("mainVpaidCreated",this.config)}return o(t,[{key:"_createIframesDetector",value:function(){this.store.set("iframesDetector",new _.default(this.store.get("ifrmswghts")))}},{key:"setVpaidId",value:function(t){this.version="["+t.wfIndex+"_"+t.dp+"]"}},{key:"_loadOppsula",value:function(){var t=this;b.init(this.store.data),b.get("oppsula",this.store.get("opslavrsn"),function(e){t.store.set("ms_data",{opps_base_path:t.store.get("opps_base_path")||t.config.creatives.CM_DOMAIN});var i=new e(t.store.get("unit_model"),t.store);t.store.set("oppsula",i),t.store.emit("oppsulaCreated",i)},function(){t.debugTracker.error("Load Oppsula","Error while loading from service loader")})}},{key:"_onResizeAd",value:function(t){this.config&&(this.config.width=t.width,this.config.height=t.height)}},{key:"trigger",value:function(t,e){this.vpaidHandler.emit(t,e)}},{key:"runWaterfall",value:function(t){this.waterfallManager.runWaterfall(t)}},{key:"getVpaidReadyCount",value:function(){return this.manager.getVpaidReadyCount()}},{key:"_initWaterfall",value:function(){this.waterfallManager=new v.default(this.store),this.config.creativeData=this._getCreativeData(this.config),this.waterfallManager.init(this.config.creatives,this.config.creativeData.AdParameters),this.waterfallManager.SetWaterfallError(this._waterfallError.bind(this)),this.waterfallManager.SetWaterfallSuccess(this._waterfallSuccess.bind(this));var t=this;this.waterfallManager.SetShouldRun(function(){var e=this.store.get("max_ready_vpaid")||2,i=this.store.get("waterfall_watermark")||0;return!t.manager||t.manager.getVpaidReadyCount()+i<e})}},{key:"_getSlot",value:function(t){var e=!1;switch("undefined"==typeof t?"undefined":s(t)){case"string":document.getElementById(t)&&(e=document.getElementById(t));break;case"object":t.style&&t.tagName&&(e=t);break;default:this.debugTracker.error("initAd","Bad slot in 'environmentVars'")}return e}},{key:"_getCreativeData",value:function(t){var e=!1;switch("undefined"==typeof t?"undefined":s(t)){case"object":Object.keys(t).length>0&&(e=!0);break;case"string":if(t.length>0)try{t=new Function("return "+t+";")(),e=!0}catch(t){}}if(e){for(var i in this.config.creatives)(void 0==t[i]||this.config.protectedCreatives.indexOf(i)>-1)&&(t[i]=this.config.creatives[i]);t.AdParameters&&(t.AdParameters=this._handleAdParams(t.AdParameters))}return t}},{key:"_handleAdParams",value:function(t){var e={};switch("undefined"==typeof t?"undefined":s(t)){case"object":Object.keys(t).length>0&&(e=t);break;case"string":if(t.length>0)try{e=new Function("return "+t+";")()}catch(t){}}return e}},{key:"_dataFromUrl",value:function(t){var e=t.replace(/\?\?+/g,"?").replace(/&&+/g,"&").split(/\?(.+)?/gi,2);if(2!=e.length)return this.debugTracker.warn("dataFromUrl","Bad source parameter!"),this.vpaidParameters;var i=e[1].split(/\?|&/gi);for(var n in i)if(i[n]){var r=i[n].split(/=(.+)?/gi,2);if(2==r.length){var s=r[0].replace(/\-/gi,"_").toUpperCase();if(void 0!=this.vpaidParameters[s])switch(s){case"ISVIDEO":case"PLMD":case"MINDUR":case"MAXDUR":case"MINBR":case"MAXBR":case"VPD":case"VPTD":case"RS":case"ST":case"PLAYER_WIDTH":case"PLAYER_HEIGHT":case"PUBID":case"STS":case"MFP":case"ADTO":case"B2B":case"VMT":case"SORTORDERTYPE":case"TAGID":case"VIDLENGTH":case"DEFAULTTAGTIMEOUT":case"TOTALTIMEOUT":this.vpaidParameters[s]=isNaN(parseInt(r[1]))?0:parseInt(r[1]);break;case"MUTED":case"AFBP":case"DEBUG":case"PAUSE_ON_START":switch(r[1]){case"1":case"true":case"TRUE":this.vpaidParameters[s]=!0;break;case"0":case"false":case"FALSE":this.vpaidParameters[s]=!1}break;case"WP":case"SERVICE":case"PV":case"PT":case"SDID":break;default:this.vpaidParameters[s]=r[1]}else this.debugTracker.warn("dataFromUrl","Parameter '"+r[0]+"' is not supported!")}}return this.vpaidParameters}},{key:"_runEventFunction",value:function(t){this["on"+t.type]&&this["on"+t.type](t)}},{key:"_waterfallError",value:function(t){w||(w=!0)}},{key:"_waterfallSuccess",value:function(t,e){this.manager&&(this.config.waterfall=t,this.manager.fillSchedule(t,e))}},{key:"_onManagerStopped",value:function(){this.beacon.dispatchEvent(this.vpaidEvents.AdStopped)}},{key:"getTime",value:function(){var t=new Date;return t.getTime()}},{key:"initAd",value:function(t,e,i,n,r,s){this.config.inited||(this.config.target=this._getSlot(s.slot),this.config.target&&(this.config.videoSlotControls=this.store.get("ad_controls"),this.config.videoSlotCanAutoPlay=!0,this.config.width=parseInt(t),this.config.height=parseInt(e),this.config.bitrate=n,this.config.viewMode=i,this.config.creatives.PLAYER_WIDTH=this.config.width,this.config.creatives.PLAYER_HEIGHT=this.config.height,this.config.creativeData=this._getCreativeData(r),this.config.inited=!0,this.manager||(this.manager=new h.default(this,this.store)),this.manager.onStop=this._onManagerStopped.bind(this),this.beacon.dispatchEvent(this.vpaidEvents.AdLoaded,"")))}},{key:"subscribe",value:function(t,e){return this.beacon?void(this.vpaidEvents[e]&&this.beacon.addEventListener(e,t)):void this.debugTracker.error("subscribe"," Null ConvertVpaidMain::Beacon ")}},{key:"unsubscribe",value:function(t,e){if(this.vpaidEvents[e]){if(void 0==t)return;this.beacon.removeEventListener(e,t)}}},{key:"handshakeVersion",value:function(t){return this.VPAIDversion}},{key:"startAd",value:function(t){this.manager.playFromQueue(t),this.config.started=!0}},{key:"fire99",value:function(t,e){this.manager&&this.manager.fire99({waterfallTagId:t,dast:e})}},{key:"resizeAd",value:function(t,e,i){this.config.width=t,this.config.height=e,this.config.viewMode=i,this.manager&&this.manager.resizeAd(t,e,i)}},{key:"stopAd",value:function(){this.manager?this.manager.stop():this.beacon.dispatchEvent(this.vpaidEvents.AdStopped)}},{key:"setAdVolume",value:function(t){if(!this.store.get("isMobile"))return t=t>1?t/100:t,!isNaN(parseFloat(t))&&void(this.manager&&!this.store.get("isMobile")&&this.manager.setAdVolume(t))}},{key:"getAdVolume",value:function(){return this.manager?this.manager.callWorkingVpaid("getAdVolume",[],0):0}},{key:"getAdLinear",value:function(){return!this.manager||this.manager.callWorkingVpaid("getAdLinear",[],!0)}},{key:"getAdWidth",value:function(){return this.manager?this.manager.callWorkingVpaid("getAdWidth",[],this.config.width):this.config.width}},{key:"getAdHeight",value:function(){return this.manager?this.manager.callWorkingVpaid("getAdHeight",[],this.config.height):this.config.height}},{key:"getAdExpanded",value:function(){return!this.manager||this.manager.callWorkingVpaid("getAdExpanded",[],!0)}},{key:"getAdSkippableState",value:function(){return!!this.manager&&this.manager.callWorkingVpaid("getAdSkippableState",[],!1)}},{key:"getAdSkippableRemainingTime",value:function(){return this.manager?this.manager.callWorkingVpaid("getAdSkippableRemainingTime",[],-1):-1}},{key:"getAdRemainingTime",value:function(){return this.manager?this.manager.callWorkingVpaid("getAdRemainingTime",[],-1):-1}},{key:"getAdDuration",value:function(){return this.manager?this.manager.callWorkingVpaid("getAdDuration",[],-1):-1}},{key:"getAdCompanions",value:function(){return this.manager?this.manager.callWorkingVpaid("getAdCompanions",[],[]):[]}},{key:"getAdIcons",value:function(){return this.manager?this.manager.callWorkingVpaid("getAdIcons",[],[]):[]}},{key:"pauseAd",value:function(){this.manager&&this.manager.callWorkingVpaid("pauseAd",[],!0)}},{key:"resumeAd",value:function(){this.manager&&this.manager.callWorkingVpaid("resumeAd",[],!0)}},{key:"expandAd",value:function(){this.manager&&this.manager.callWorkingVpaid("expandAd",[],!0)}},{key:"collapseAd",value:function(){this.manager&&this.manager.callWorkingVpaid("collapseAd",[],!0)}},{key:"skipAd",value:function(){this.manager&&this.manager.callWorkingVpaid("skipAd",[],!0)}},{key:"getVpaidLogs",value:function(){if(this.manager)return this.manager.getVpaidLogs()}},{key:"getAd",value:function(t){if(this.manager)return this.manager.getAd(t)}},{key:"onAdLoaded",value:function(){}},{key:"onAdStarted",value:function(){}},{key:"onAdStopped",value:function(){}},{key:"onAdSkipped",value:function(){}},{key:"onAdSkippableStateChange",value:function(){}},{key:"onAdSizeChange",value:function(){}},{key:"onAdLinearChange",value:function(){}},{key:"onAdDurationChange",value:function(){}},{key:"onAdExpandedChange",value:function(){}},{key:"onAdVolumeChange",value:function(){}},{key:"onAdImpression",value:function(){}},{key:"onAdVideoStart",value:function(){}},{key:"onAdVideoFirstQuartile",value:function(){}},{key:"onAdVideoMidpoint",value:function(){}},{key:"onAdVideoThirdQuartile",value:function(){}},{key:"onAdVideoComplete",value:function(){}},{key:"onAdClickThru",value:function(){}},{key:"onAdInteraction",value:function(){}},{key:"onAdUserAcceptInvitation",value:function(){}},{key:"onAdUserMinimize",value:function(){}},{key:"onAdUserClose",value:function(){}},{key:"onAdPaused",value:function(){}},{key:"onAdPlaying",value:function(){}},{key:"onAdLog",value:function(){}},{key:"onAdError",value:function(){}},{key:"onVpaidSpecial",value:function(){}},{key:"onSonudViolation",value:function(){}},{key:"vpaidEvents",set:function(t){},get:function(){return g.default}},{key:"_defaultVpaidParameters",set:function(t){},get:function(){return{VIEW_MODE:"normal",REFERRER:"",VIDEO_URL:"",DOMAIN:"",PUBID:0,TAGID:0,
VPD:0,VPTD:0,AUC_DAST:"",VIDLENGTH:0,KEY_WORDS:"",DESCRIPTION:"",SERVICE:"WhiteLabelBidRequestHandlerServlet",VERTICAL:"",SCHEMA:"vast2-vpaid",TYPE:"application/javascript",PV:this.version,RS:1,ST:1,WP:1,PT:5,CIRF:"",SDID:1,STS:0,CB:"",VOLUME:0,TAG:"",PAGE_URL:"",TIME_STAMP:"",TITLE:"",MFP:4,ISVIDEO:1,PLMD:2,MINDUR:1,MAXDUR:60,MINBR:1,MAXBR:512,AFBP:!1,ADTO:60,B2B:1,VMT:0,SORTORDERTYPE:0,DEFAULTTAGTIMEOUT:30,OID:"",NOAOP:"",TOTALTIMEOUT:60,CM_DOMAIN:"http://exchange.basebanner.com",OFFSET:0,MODE:"paralel",MUTED:!1,DEBUG:!1,PAUSE_ON_START:!1,PLAYER_WIDTH:0,PLAYER_HEIGHT:0}}},{key:"_defaultVpaidConfig",set:function(t){},get:function(){return{waterfall:{},source:this.src,videoSlotCanAutoPlay:!0,videoSlotControls:!1,vpaid_protect_path:!1,running:!1,inited:!1,stopped:!1,started:!1,target:!1,video:!1,bitrate:512,creatives:{},protectedCreatives:["WP","PV","PT","SDID","CM_DOMAIN","SERVICE"]}}}]),t}();e.default=A},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=null,s=function(){function t(e){if(i(this,t),!r){this.costModels={};var n=e.get("cpcvcmpgntps"),s=e.get("cstmdltps");for(var o in s){var a=s[o];this.costModels[a]={costModel:a,type:o,isCPCV:n.indexOf(a)>-1}}r=this}return r}return n(t,[{key:"isCPCV",value:function(t){return this.costModels.hasOwnProperty(t)&&this.costModels[t].isCPCV}}]),t}();e.default=s},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),d=i(6),l=i(1),u=n(l),h=function(t){function e(t,i,n){r(this,e);var o=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return o.creativeExtensions=t,o.target=i,o.vpaidLog=n,o.stopped=!1,o}return o(e,t),a(e,[{key:"handleExternalScripts",value:function(){if(!this.stopped)for(var t=0;t<this.creativeExtensions.length;t++){var e=this.creativeExtensions[t].attributes.type?this.creativeExtensions[t].attributes.type.toLowerCase():null;e&&(e=e.toLowerCase(),u.logToBI(this.vpaidLog,"creativeExtensions",{type:e,src:this.creativeExtensions[t].element}),"gdn"===e||"ias"===e?this._appendExternalScripts(this.creativeExtensions[t].element):"moat"===e&&this._pushExternalMoatTracker(this.creativeExtensions[t].element))}}},{key:"_appendExternalScripts",value:function(t){for(var e=(new DOMParser).parseFromString(t,"text/html"),i=e.getElementsByTagName("script"),n=0;n<i.length;n++)this.target.appendChild(this._generateScriptElement(i[n]))}},{key:"_generateScriptElement",value:function(t){for(var e=document.createElement("script"),i=0;i<t.attributes.length;i++)e.setAttribute(t.attributes[i].name,t.attributes[i].value);return e.innerHTML=t.innerHTML,e}},{key:"_pushExternalMoatTracker",value:function(t){this.emit("externalMoat",t)}},{key:"destroy",value:function(){this.stopped=!0,this.creativeExtensions=this.target=this.vpaidLog=void 0}}]),e}(d.EventEmitter);e.default=h},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function(){function t(e){i(this,t),this.iframesWeights=e}return n(t,[{key:"detect",value:function(t,e){var i=this,n={};return t.map(function(t){var r=i._detectIframeTypeFromUrl(t,e);n[r]=n[r]||{urls:[],counter:0},n[r].urls.push(t),n[r].counter++}),n}},{key:"_detectIframeTypeFromUrl",value:function(t,e){return t.indexOf("imasdk")>-1?"ggl":e?"pxls":"gen"}},{key:"calculateWeightsByIframeType",value:function(t){var e=0;for(var i in t)e+=this.iframesWeights[i]*t[i].counter;return e}}]),t}();e.default=r},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=i(1),a=n(o),d=function(){function t(e,i,n){r(this,t),this.iframe=e,this.channel=void 0,this.sid=void 0,this.store=i,this.vpaidLog=n,this.protocol=this.store.get("httpsOverride")?"https:":window.location.protocol||"http:"}return s(t,[{key:"listenToMessages",value:function(){this.iframe.contentWindow.addEventListener("message",this.onmessage.bind(this))}},{key:"removeMessagesListener",value:function(){this.iframe.contentWindow.removeEventListener("message",this.onmessage.bind(this))}},{key:"onmessage",value:function(t){if(t){var e={};try{e=JSON.parse(t.data.replace("ima://",""))}catch(t){return}"viewabilityMeasurement"!==e.type&&(void 0!==e.channel&&void 0===this.channel&&(this.channel=e.channel),void 0!==e.sid&&"*"!==e.sid&&void 0===this.sid&&(this.sid=e.sid)),void 0!==this.channel&&void 0!==this.sid&&this.removeMessagesListener()}}},{key:"callApi",value:function(t,e){if(this.channel&&this.sid&&this.iframe){var i={name:"adsManager",type:t.replace("Ad",""),sid:this.sid,channel:this.channel};"volume"==t&&(i.data={volume:e});var n="\n                    var ifrms = document.querySelectorAll('iframe');\n\n                    ifrms.forEach(ifrm => {\n                        if (ifrm.src.indexOf('imasdk.googleapis.com') > -1 && ifrm.src.indexOf('bridge') > -1 && (ifrm.src.indexOf('#"+this.sid+"') > -1 || ifrm.src.indexOf('#"+this.channel+"') > -1)) {\n                            ifrm.contentWindow.postMessage('ima://"+a.stringify(i)+"', '"+this.protocol+"//imasdk.googleapis.com');\n                        }\n                    });\n                ";a.injectResource(this.iframe.contentWindow,n)}}}]),t}();e.default=d},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function(){function t(e){i(this,t),this.baseUrl=e}return n(t,[{key:"load",value:function(t,e,i){t&&t.length&&window.cmTag&&(this._setWindowLoaderObject(),this._registerOnLoaderResponse(e),this._loadScript(t,e,i))}},{key:"_setWindowLoaderObject",value:function(){window.cmTag.cmLoader||(window.cmTag.cmLoader={addLoaderCb:function(t,e){window.cmTag.cmLoader[t]=window.cmTag.cmLoader[t]||{callbacks:[]},window.cmTag.cmLoader[t].callbacks.push(e)}})}},{key:"_registerOnLoaderResponse",value:function(t){window[t]||(window[t]=function(e){window.cmTag.cmLoader[t].callbacks.map(function(t){try{t(e)}catch(t){}})})}},{key:"_loadScript",value:function(t,e,i){window.cmTag.cmLoader.addLoaderCb(e,i);var n=document.createElement("script");n.src=this.baseUrl+t,document.body.appendChild(n)}}]),t}();e.default=r},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(64),d=r(a),l=i(3),u=r(l),h=i(72),c=r(h),p=i(8),f=r(p),v=i(23),m=r(v),g=i(1),y=n(g),_=i(61),b=r(_);m.default.config({cancellation:!0});var w=function(){function t(e,i){var n=this;s(this,t),this.mainVpaid=e,this.store=i,this.time=(new Date).getTime(),this.sequenceId=((new Date).getTime()+"").substring(3,11),this.loops=0,this.stopped=!1,this.started=!1,this.schedule=[],this.timedTimeout=0,this.waterfall={},this.adSlots=1,this.filledSlots=0,this.adIsPlaying=!1,this.debugTracker=new u.default("Manager"),this.supportNonVideoVpaid=this.store.get("sprtnnvidvpd")&&this.store.get("mltads"),this.droppableTypes=this.store.get("drpbletps")||[],this.oppsID=f.default,this.queueSize=this.store.get("queue_size")||10,this.isVforce=i.get("vForce"),this.store.on("stop",this.stop.bind(this)),this.store.on("emitQueueStatus",this._emitQueueStatus.bind(this,"queueStatus")),this.queueStatus=new b.default(this.store),this.supportNonVideoVpaid&&(this.nonVideoItem=null,this.store.on("nonVideoItemInWaterfall",this._onNonVideoItemInWaterfall.bind(this))),this.store.get("debug")&&setInterval(function(){n._postMessageSchedule()},1e3),this.dontTrimMp4=this.store.get("novdtrm"),this.maxBackfillDelayItems=this.store.get("mxbckflldlyitms"),this.maxBackfillDelayItems&&(this.backfilldelayTime=this.store.get("bckflldlyms"),this.backfillPriority=this.store.get("bfprty")),this.continueGetAdFlow=this.store.get("cntgtad")}return o(t,[{key:"_postMessageSchedule",value:function(){if(window.cmPlayerDeubg){var t=this.schedule,e=this.store;try{window.cmPlayerDeubg({schedule:t,store:e})}catch(t){console.log(t)}}}},{key:"trigger",value:function(t,e,i){if(this._handleAllEvents({type:t,dispatcher:e}),this.store.emit(t,e),e.working||t===this.mainVpaid.vpaidEvents.AdImpression){var n={type:t,dispatcher:e};t===this.mainVpaid.vpaidEvents.AdImpression&&(n.tag=e.tag),n.vpaidReady=this.getVpaidReadyCount(),n.qsize=this.schedule.length,n.dp=e&&e.tag?e.tag.dp:"na",n.adImpMS=e?e.adImpInMS:0,n.readyInMS=e?e.readyInMS:0,n.loadToImpMS=e?e.adImpInMS-e.readyInMS:0,n.clickThru={url:i?i.url:"",playerHandles:i&&i.playerHandles!==!1},this.mainVpaid.trigger(t,n)}}},{key:"getVpaidReadyCount",value:function(){var t=0;return this.schedule.map(function(e){e&&e.vpaidWrapper&&"ready"===e.vpaidWrapper.status&&t++}),t}},{key:"subscribeToVpaid",value:function(t){this.stopped||t.subscribe(this._handleError.bind(this),this.mainVpaid.vpaidEvents.AdError)}},{key:"_handleAllEvents",value:function(t){var e=this;t.type!==this.mainVpaid.vpaidEvents.AdVideoStart&&t.type!==this.mainVpaid.vpaidEvents.AdImpression&&t.type!==this.mainVpaid.vpaidEvents.AdPlaying||!t.dispatcher.isPlaying||this.trigger("viewAdPlayer",t.dispatcher.tag),t.type===this.mainVpaid.vpaidEvents.AdLoaded&&this.shouldPlayWhenAvialable&&!this.store.get("evtbsschdl")&&(setTimeout(function(){e.playFromQueue(e.shouldPlayWhenAvialable)},2),t.dispatcher?t.dispatcher.tag:{},this.shouldPlayWhenAvialable=!1),t.type===this.mainVpaid.vpaidEvents.AdImpression&&(t.dispatcher.options&&t.dispatcher.options.getAdContext?(t.dispatcher.gotAd=!0,this.debugTracker.info("gotAd",t.dispatcher,{color:"#5EB9FF"}),y.logToBI(t.dispatcher.vpaidLog,"getAdContexIsEmpty",{empty:!1}),t.dispatcher.options.getAdContext.getAdCallback(t.dispatcher)):t.dispatcher&&t.dispatcher.vpaidLog&&y.logToBI(t.dispatcher.vpaidLog,"getAdContexIsEmpty",{empty:!0}))}},{key:"_runNextAd",value:function(){}},{key:"_handleError",value:function(t){var e=t.dispatcher;this.adIsPlaying&&e.isStarted&&!e.hadImpression&&!this.store.get("evtbsschdl")&&this.playFromQueue()}},{key:"initVpaidInQue",value:function(t){if(!this.stopped)for(var e=this.schedule,i={},n="",r=0;r<e.length;r++)i=e[r],n=r+"-"+i.waterfallTagId,i.vpaidWrapper||(this.maxBackfillDelayItems&&i.priority===this.backfillPriority?i.backfillDelay=setTimeout(this._createVpaidWrapper.bind(this,i,n,t),this.backfilldelayTime):this._createVpaidWrapper(i,n,t))}},{key:"_createVpaidWrapper",value:function(t,e,i){t.backfillDelay&&(t.backfillDelay=window.clearTimeout(t.backfillDelay),t.isBackfillDelayed=!0),t.sequenceId=t.wfIndex,t.vpaidWrapper=new d.default({tag:t,creatives:this.mainVpaid.config.creatives,vpaidEvents:this.mainVpaid.vpaidEvents,config:this.mainVpaid.config,tagid:e,manager:this,wfStats:t.wfStats},this.mainVpaid,this.store,i);var n=this;t.vpaidWrapper.on("vpaidCleaned",function(){n.cleanQueue(n.queueSize),n.continueGetAdFlow&&this.options&&this.adStarted&&!this.hadImpression&&n.getAdFromQueue(this.options),n.queueStatus.onScheduleChange(n.schedule,n.supportNonVideoVpaid&&null!==n.nonVideoItem)}),this.subscribeToVpaid(t.vpaidWrapper)}},{key:"unsubscribeFromVpaid",value:function(t){this.stopped||(t.unsubscribe(null,this.mainVpaid.vpaidEvents.AdError),t.unsubscribe(null,this.mainVpaid.vpaidEvents.AdFound),t.unsubscribe(null,this.mainVpaid.vpaidEvents.AdStopped),t.unsubscribe(null,this.mainVpaid.vpaidEvents.AdSkipped),t.unsubscribe(null,this.mainVpaid.vpaidEvents.AdImpression),t.unsubscribe(null,this.mainVpaid.vpaidEvents.AdSkippableStateChange),t.unsubscribe(null,this.mainVpaid.vpaidEvents.AdSizeChange),t.unsubscribe(null,this.mainVpaid.vpaidEvents.AdLinearChange),t.unsubscribe(null,this.mainVpaid.vpaidEvents.AdDurationChange),t.unsubscribe(null,this.mainVpaid.vpaidEvents.AdExpandedChange),t.unsubscribe(null,this.mainVpaid.vpaidEvents.AdVolumeChange),t.unsubscribe(null,this.mainVpaid.vpaidEvents.AdVideoStart),t.unsubscribe(null,this.mainVpaid.vpaidEvents.AdVideoFirstQuartile),t.unsubscribe(null,this.mainVpaid.vpaidEvents.AdVideoMidpoint),t.unsubscribe(null,this.mainVpaid.vpaidEvents.AdVideoThirdQuartile),t.unsubscribe(null,this.mainVpaid.vpaidEvents.AdVideoComplete),t.unsubscribe(null,this.mainVpaid.vpaidEvents.AdClickThru),t.unsubscribe(null,this.mainVpaid.vpaidEvents.AdInteraction),t.unsubscribe(null,this.mainVpaid.vpaidEvents.AdUserAcceptInvitation),t.unsubscribe(null,this.mainVpaid.vpaidEvents.AdUserMinimize),t.unsubscribe(null,this.mainVpaid.vpaidEvents.AdUserClose),t.unsubscribe(null,this.mainVpaid.vpaidEvents.AdPaused),t.unsubscribe(null,this.mainVpaid.vpaidEvents.AdPlaying),t.unsubscribe(null,this.mainVpaid.vpaidEvents.AdLog))}},{key:"_shouldDropAd",value:function(t,e){return this.droppableTypes.indexOf(t)>-1&&e.hasOwnProperty(t)&&e[t]}},{key:"cleanQueue",value:function(t,e){var i=this;if(this.schedule.map(function(t,n){if(t&&t.vpaidWrapper&&!t.vpaidWrapper.working){var r=!1,s=null;if("error"===t.vpaidWrapper.status||"stopped"===t.vpaidWrapper.status){r=!0;var o="error"===t.vpaidWrapper.status;s=o?i.oppsID.vastError:i.oppsID.adError}else e&&i._shouldDropAd(e,t)&&(r=!0,s=i.oppsID.adDropped);r&&(i.queueStatus.onItemRemovedFromQueue(t),t.vpaidWrapper._status=t.vpaidWrapper.status,i.unsubscribeFromVpaid(i.schedule[n].vpaidWrapper),i.schedule[n].vpaidWrapper.stop("cleanExpierd",s),i.schedule[n]&&(i.schedule[n].vpaidWrapper=null),i.schedule[n]=void 0)}}),this.schedule=this.schedule.filter(function(t){return t}),this.schedule=c.default.sort(this.schedule,this.store),this.schedule.length>t){var n=(this.mainVpaid.config.creatives,this.mainVpaid.config.creatives.ADTO||6e4),r=this.store.get("trmrdyvpaid");this.schedule.map(function(e,s){if(i.schedule[s]&&!e.vpaidWrapper.working&&(r||"ready"!==e.vpaidWrapper.status)){var o=Date.now()-i.schedule[s].vpaidWrapper.created;if(e&&(s<i.schedule.length-t||o>n)){i.queueStatus.onItemRemovedFromQueue(e),i.unsubscribeFromVpaid(i.schedule[s].vpaidWrapper);var a=o>n?"queueExpired":"queueTrimmed";if(!i._canTrim(a,e))return;i.schedule[s].vpaidWrapper.stop(a,i.oppsID[a]),i.schedule[s]=void 0}}})}this.schedule=this.schedule.filter(function(t){return t})}},{key:"_canTrim",value:function(t,e){return"queueTrimmed"!==t||!(e.vpaidWrapper&&"mp4"===e.vpaidWrapper.type&&this.dontTrimMp4)}},{key:"fillSchedule",value:function(t,e){this.schedule.length>this.queueSize&&this.cleanQueue(this.queueSize),this.started=!0,this.stopped=!1;var i={},n=0,r=this.mainVpaid.config.creatives;r.ADTO=parseInt(r.ADTO)>1?parseInt(r.ADTO):60,r.ADTO=r.ADTO<1e3?1e3*r.ADTO:r.ADTO,this.adSlots=parseInt(r.B2B)&&parseInt(r.B2B)>1?parseInt(r.B2B):1;var s=0,o=r.DEFAULTTAGTIMEOUT<1e3?1e3*r.DEFAULTTAGTIMEOUT:r.DEFAULTTAGTIMEOUT;for(n=0;n<t.tags.length;n++)this._shouldInsertToQueue(t.tags[n])?(i=t.tags[n],i.active=!1,i.adFound=!1,i.offset=s,i.tagStart=s,i.tagTimeout=o,i.queueNumber=0,i.ADTO=r.ADTO,i.vpaidWrapper=!1,i.tagEnd=1*i.tagStart+1*i.tagTimeout,i.wfStats=t.data,this.store.get("frstlk")&&this._updateItemFirstLook(i),this.schedule.push(i)):e.push("tagResponse_"+n+"_backfillThrown",!0);this._printQueue(this.schedule),this.mainVpaid.setVpaidId(i),this.time=(new Date).getTime(),this.initVpaidInQue(e),this.store.set("queueLength",this.schedule.length),this.store.set("vpaidReadyCount",this.getVpaidReadyCount()),this.queueStatus.onScheduleChange(this.schedule,this.supportNonVideoVpaid&&null!==this.nonVideoItem)}},{key:"_shouldInsertToQueue",value:function(t){return!this.maxBackfillDelayItems||t.priority!==this.backfillPriority||t.priority===this.backfillPriority&&this._getBackfillCount()<this.maxBackfillDelayItems}},{key:"_printQueue",value:function(t){var e=t.map(function(t){return{dp:t.dp,lineItem:t.lineItem,alfrox:t.alfrox,waterfallIndex:t.wfIndex,status:t.vpaidWrapper?t.vpaidWrapper.status:"",videoUrl:t.vpaidWrapper?t.vpaidWrapper.getVideoUrl():""}});this.debugTracker.table(e)}},{key:"_updateItemFirstLook",value:function(t){t.flad&&(this.store.get("first_look_ad_loaded")?(t.flad_delay=t.flad,delete t.flad):this._startFladTimeout(t.flad))}},{key:"_startFladTimeout",value:function(t){this.store.set("first_look_ad_loaded",t),this.fladTimeout=setTimeout(this._onFladTimeout.bind(this),1e3*t)}},{key:"_onFladTimeout",value:function(){for(var t=null,e=0;e<this.schedule.length;e++)if(t=this.schedule[e],t.flad_delay)return t.flad=t.flad_delay,delete t.flad_delay,void this._startFladTimeout(t.flad);this.store.set("first_look_ad_loaded",!1),this.store.emit("fladInactive")}},{key:"stop",value:function(){if(!this.stopped){this.stopped=!0,window.clearTimeout(this.timedTimeout);for(var t=0;t<this.schedule.length;t++)this.schedule[t].backfillDelay?window.clearTimeout(this.schedule[t].backfillDelay):this.schedule[t].vpaidWrapper.stop("playerClosed",this.oppsID.playerClosed);this.nonVideoItem=null}}},{key:"managerEnd",value:function(){}},{key:"playFromQueue",value:function(t){if(!this.store.get("isIdleMode")&&!this.stopped){var e=Date.now();this.store.set("playFromQueue",e);var i=this.getVpaidReadyCount();(0===i||t)&&(this.store.get("vForce")||(this.shouldPlayWhenAvialable=!0)),this.store.get("first_look")||this.store.get("first_look_ad_loaded")||(this.schedule=c.default.sort(this.schedule,this.store));var n=this.mainVpaid.config.creatives.ADTO||6e4;n+=1e4;for(var r=!1,s=this._getItemScores(),o=(this._getItemDps(),this.schedule.length-1);o>=0;o--){var a=this.schedule[o];a&&(this._setItemScores(a,o,s),"ready"!==a.vpaidWrapper.status||a.vpaidWrapper.working||a.vpaidWrapper.isStarted||r||this.store.get("first_look_ad_loaded")&&!a.flad||(this.store.set("playFromQueueFound",e),a.vpaidWrapper.workingVpaid=!0,this.store.set("ad_controls",this.store.getByLineItem("ad_controls",a.vpaidWrapper.tag)!==!1),a.vpaidWrapper.working=!0,a.vpaidWrapper.isPlaying=!0,this.adIsPlaying=!0,r=!0,a.vpaidWrapper.startAd(),y.logToBI(a.vpaidWrapper.vpaidLog,"startFromQ",{score:a.score})))}var d=this.store.get("run_wf_when_empty");d&&0===i&&this.store.emit("playFromEmptyQueue")}}},{key:"bringVpaidToFront",value:function(){for(var t=this.schedule.length-1;t>=0;t--){var e=this.schedule[t];if(e&&e.vpaidWrapper.workingVpaid){e.vpaidWrapper.bringToFront();break}}}},{key:"_getItemScores",value:function(){for(var t=[],e=this.schedule.length-1;e>=0;e--){var i=this.schedule[e];i&&t.push(i.score)}return t}},{key:"_getItemDps",value:function(){for(var t=[],e=this.schedule.length-1;e>=0;e--){var i=this.schedule[e];i&&t.push(i.dp)}return t}},{key:"_setItemScores",value:function(t,e,i){t.vpaidWrapper&&t.vpaidWrapper.vpaidLog&&t.vpaidWrapper.vpaidLog.data&&(t.vpaidWrapper.vpaidLog.data.itemScore=t.score,i&&y.logToBI(t.vpaidWrapper.vpaidLog,"itemScores",{index:e,scores:i},!1,!1))}},{key:"resizeAd",value:function(t,e,i){if(!this.stopped){this.mainVpaid.config.creatives.PLAYER_WIDTH=this.mainVpaid.config.width=parseInt(t),this.mainVpaid.config.creatives.PLAYER_HEIGHT=this.mainVpaid.config.height=parseInt(e),this.mainVpaid.config.creatives.VIEW_MODE=this.mainVpaid.config.viewMode=i;for(var n=0;n<this.schedule.length;n++)this.schedule[n].vpaidWrapper&&!this.schedule[n].vpaidWrapper.stopped&&this.schedule[n].vpaidWrapper.callVpaidMethod("resizeAd",[t,e,i],0)}}},{key:"setAdVolume",value:function(t,e){if(!this.stopped){if(t=t>1?t/100:t,isNaN(parseFloat(t)))return!1;t=parseFloat(t),e||(this.mainVpaid.config.creatives.VOLUME=t),this.mainVpaid.config.creatives.MUTED=0==t;for(var i=0;i<this.schedule.length;i++)this.schedule[i].vpaidWrapper&&!this.schedule[i].vpaidWrapper.stopped&&this.schedule[i].vpaidWrapper.workingVpaid&&this.schedule[i].vpaidWrapper.setAdVolume(t)}}},{key:"callWorkingVpaid",value:function(t,e,i){if(!this.stopped)for(var n=0;n<this.schedule.length;n++){var r=this.schedule[n].vpaidWrapper;if(r&&r.workingVpaid)return r.callVpaidMethod(t,e,i)}}},{key:"getVpaidLogs",value:function(){for(var t=[],e=0;e<this.schedule.length;e++){var i=this.schedule[e];i&&i.vpaidWrapper&&i.vpaidWrapper.vpaidLog&&t.push(i.vpaidWrapper.vpaidLog)}return t}},{key:"getAd",value:function(t){this.store.incr("getAdData.count");var e=this;return this.debugTracker.info("getAd",t?t:"empty getAd",{color:"#5EB9FF"}),new m.default(function(i,n,r){t=t||{};var s={getAdCallback:i};t.getAdContext=s,t.getAdRetries=0,t.getAdContext.getAdTimeout=setTimeout(function(){t.getAdContext=void 0,n({name:"error",message:"couldn't find a suitable ad to play"})},1e3*(t.getAdTimeout||e.store.get("get_ad_timeout_seconds"))),e.getAdFromQueue(t),r(function(){e.cancelGetAd(t),this.debugTracker.info("getAd","getAd cancelled!",{color:"#5EB9FF"})}.bind(e))})}},{key:"cancelGetAd",value:function(t){this.store.decr("getAdData.count"),clearTimeout(t.getAdContext.getAdTimeout),t.getAdContext=void 0}},{key:"getAdFromQueue",value:function(t){if(!this.store.get("isIdleMode")&&!this.stopped&&(t=t||{},t&&t.getAdContext&&(!t.requiredViewability||!document.hidden))){this.store.get("first_look")||this.store.get("first_look_ad_loaded")||(this.schedule=c.default.sort(this.schedule,this.store));for(var e=!1,i=this._getItemScores(),n=this.schedule.length-1;n>=0;n--){var r=this.schedule[n];if(this._updateStatusesOnGetAd(r,t),this._setItemScores(r,n,i),this.isViewabilityMatch(r,t)&&this._canPullItem(r)){this._pullItemFromQueue(r,t),e=!0;break}}var s=this.store.get("run_wf_when_empty");if(s&&0==this.getVpaidReadyCount()&&this.store.emit("playFromEmptyQueue"),!e){if(this._canPullAdxCard(t))return void this._pullAdxCard(t);this.nextAdFromQueue=setTimeout(this.getAdFromQueue.bind(this,t),1e3)}}}},{key:"_canPullItem",value:function(t){return"ready"===t.vpaidWrapper.status&&!t.vpaidWrapper.working&&!t.vpaidWrapper.isStarted&&(!this.store.get("first_look_ad_loaded")||t.flad)}},{key:"_pullAdxCard",value:function(t){this.nonVideoItem.adx=!0,this._pullItemFromQueue(this.nonVideoItem,t)}},{key:"_canPullAdxCard",value:function(t){return t.requiredViewability&&this.nonVideoItem&&this.nonVideoItem.vpaidWrapper&&this._canPullItem(this.nonVideoItem)}},{key:"_pullItemFromQueue",value:function(t,e){t.vpaidWrapper.working=!0,t.vpaidWrapper.isPlaying=!0,this.adIsPlaying=!0,t.vpaidWrapper.bringToFront(),"mp4"===t.vpaidWrapper.type&&t.vpaidWrapper.vpaidHandler.logVideoBuffer("StartFromQ"),t.vpaidWrapper.startAd(e),y.logToBI(t.vpaidWrapper.vpaidLog,"startFromQ",{score:t.score,adx:t.adx}),clearTimeout(e.getAdContext.getAdTimeout),e.getAdContext.getAdTimeout=void 0,e.getAdRetries++}},{key:"_updateStatusesOnGetAd",value:function(t,e){t.vpaidWrapper&&t.vpaidWrapper.vpaidLog&&!t.vpaidWrapper.gotAd&&t.vpaidWrapper.updateStatusesOnGetAd(e)}},{key:"isViewabilityMatch",value:function(t,e){return!(!t||!t.vpaidWrapper)&&("undefined"==typeof e.requiredViewability||(e.requiredViewability?t.requiredViewability:!t.requiredViewability))}},{key:"onStop",value:function(){}},{key:"isActivePausedAd",value:function(){for(var t=0;t<this.schedule.length;t++){var e=this.schedule[t];if(e&&e.vpaidWrapper&&e.vpaidWrapper.isPlaying&&!e.vpaidWrapper.isUnPaused)return!0}return!1}},{key:"isWorkingVpaidItem",value:function(t){var e=!1;return this.schedule.map(function(i){i&&i.vpaidWrapper&&i.vpaidWrapper==t&&i.vpaidWrapper.working&&(e=!0)}),e}},{key:"_saveCountersToStore",value:function(t,e,i){!e&&this.store&&i&&this.store.set(t,i)}},{key:"callAllWorkingVpaids",value:function(t){return this.schedule.map(function(e){if(e.vpaidWrapper&&!e.vpaidWrapper.stopped&&e.vpaidWrapper.workingVpaid)return t(e.vpaidWrapper)})}},{key:"mute",value:function(){this.callAllWorkingVpaids(function(t){return t.mute()})}},{key:"unmute",value:function(){this.callAllWorkingVpaids(function(t){return t.unmute()})}},{key:"play",value:function(){this.callAllWorkingVpaids(function(t){return t.resumeAd()})}},{key:"pause",value:function(){this.callAllWorkingVpaids(function(t){return t.pauseAd()})}},{key:"getCurrentWorkingVpaidVolume",value:function(){var t=null;return this.callAllWorkingVpaids(function(e){null===t&&(t=e.getCurrentVolume())}),t||0}},{key:"_emitQueueStatus",value:function(t){this.queueStatus.onScheduleChange(this.schedule,this.supportNonVideoVpaid&&null!==this.nonVideoItem,t)}},{key:"_getBackfillCount",value:function(){var t=this,e=0;return this.schedule.map(function(i){i&&i.priority===t.backfillPriority&&e++}),e}},{key:"_onNonVideoItemInWaterfall",value:function(t){this.stopped||this.nonVideoItem||(this.nonVideoItem=t.item,this.nonVideoItemWflog=t.wflog,this._createVpaidWrapper(this.nonVideoItem,"adx-"+this.nonVideoItem.waterfallTagId,this.nonVideoItemWflog))}},{key:"getPlayerDAST",value:function(){for(var t=this.callAllWorkingVpaids(function(t){return t.playerDAST.get()}),e=0;e<t.length;e++)if(t[e])return t[e];return""}}]),t}();e.default=w},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e,i,n,r){var s=document.createElement("script"),o=[];e={adData:{ids:e,duration:i,url:r},dispatchEvent:function(t){this.sendEvent?(o&&(o.push(t),t=o,o=!1),this.sendEvent(t)):o.push(t)}},i="_moatApi"+Math.floor(1e8*Math.random());var a,d;try{a=t.ownerDocument,d=a.defaultView||a.parentWindow}catch(t){a=document,d=window}return d[i]=e,s.type="text/javascript",t&&t.insertBefore(s,t.childNodes[0]||null),s.src="https://z.moatads.com/"+n+"/moatvideo.js#"+i,e}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),d=i(1),l=r(d),u=i(5),h=n(u),c=function(){function t(e){s(this,t),this.options=e,this.moatAbTest=this.options.store.getByLineItem("mttst",this.options.tag),this.moatAbTest&&(this.moatAbTest+="_"),this.moatAbTest=""+this.moatAbTest+(this.options.store.get("unit_type")||"")+(this.options.store.get("isMobile")?"_Mobile":"");var i=this._createLevels(),n=this.options.moatTag?new Function(this.options.moatTag):o;this.moatApiReference=n(this.options.container||document.body,i,this.options.duration||0,this.options.moatPartnerCode,this.options.url),l.logToBI(this.options.vpaidLog,"moatTracker",{}),this.events=[h.default.AdLoaded,"startAd",h.default.AdStarted,h.default.AdImpression,h.default.AdVideoStart,h.default.AdClickThru,h.default.AdStopped,h.default.AdPlaying,h.default.AdPaused,h.default.AdVideoFirstQuartile,h.default.AdVideoMidpoint,h.default.AdVideoThirdQuartile,h.default.AdVideoComplete],this.stopped=!1}return a(t,[{key:"_createLevels",value:function(){return this.options.moatTag?{}:this.options.tag?{level1:this.moatAbTest,level2:this.options.tag.advId,level3:this.options.tag.lineItemId,level4:this.options.store.get("domain")||"",slicer1:this.options.url,slicer2:this.options.tag.tagId}:{level1:"",level2:"",level3:"",level4:"",slicer1:"",slicer2:""}}},{key:"dispatch",value:function(t){this.stopped||this.events.indexOf(t.type)>-1&&this.moatApiReference.dispatchEvent(t)}},{key:"dispose",value:function(){this.stopped=!0,this.moatApiReference=this.events=this.options=void 0}}]),t}();e.default=c},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(3),d=r(a),l=i(1),u=n(l),h=i(7),c=r(h),p=function(){function t(e,i){s(this,t),this.store=e,this.debugTracker=new d.default("OpportunityAggregator"),this.opps=[];var n=this.store.get("opps_base_path")||i.CM_DOMAIN;this.url=u.setUrlPrefix(n)+(/.*\/$/g.test(n)?"":"/")+"OpportunityServlet",this.postHeaders=this.store.get("psthdrs")||"application/json",this.onFail=this._onFail.bind(this),this.onSuccess=this._onSuccess.bind(this);var r=this._sendTicker.bind(this);setInterval(r,this.store.get("timbtopps")),this.store.on("sendOpps",r),this.store.on("beforeunload",r)}return o(t,[{key:"send",value:function(t){this.opps.push(t)}},{key:"_sendTicker",value:function(){this.opps.length>0&&(0,c.default)(this.url,u.stringify(this.opps),this.onSuccess,this.onFail,void 0,!1,!1,5e3,this.postHeaders,!1),this.opps=[]}},{key:"_onSuccess",value:function(t){}},{key:"_onFail",value:function(t){this.debugTracker.warn("Error Firing Opps",t)}}]),t}();e.default=p},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(3),d=(r(a),i(20)),l=n(d),u=i(69),h=n(u),c=i(1),p=(n(c),
i(5)),f=r(p),v=function(){function t(e){s(this,t),this.trackingPixels=Object.assign({},l),this.pixelDataLoaded=!1,this.events=[],this.done=[],this.store=e,this.vpaidEvents=f.default,this.state="",this.clickThruUrl="",this._isPaused=!1,this.buildPixelsRestrictions(),this._isPaused=!1}return o(t,[{key:"buildPixelsRestrictions",value:function(){this.pixelsRestrictions={},this.pixelsRestrictions.baseState=this.vpaidEvents.AdVideoThirdQuartile,this.pixelsRestrictions[this.vpaidEvents.AdVideoComplete]=this.vpaidEvents.AdVideoThirdQuartile}},{key:"loadPixelData",value:function(t){this.pixelDataLoaded,this.pixelDataLoaded=!0,this.trackingPixels=t}},{key:"getClickThruUrl",value:function(){if(!this.clickThruUrl)for(var t=["adclickthrough","clickthrough","adclickthru","clickthru"],e=0;e<t.length;e++){var i=t[e];if(this.trackingPixels.hasOwnProperty(i)&&this.trackingPixels[i].length>0){this.clickThruUrl=this.trackingPixels[i][0];break}}return this.clickThruUrl}},{key:"firePixel",value:function(t,e,i){if(this._isPaused)return!1;if(!this.isValid(t,i))return!1;for(var n=this._getPixels(t,i),r=0;r<n.length;r++)this._sendPixel(n[r],t,e);return this.events.push(t),""===this.state&&t===this.pixelsRestrictions.baseState&&(this.state=this.pixelsRestrictions.baseState),!0}},{key:"_cleanPixelType",value:function(t){return t.toLowerCase().replace(/^advideo|^aduser|^ad/gi,"")}},{key:"_getAllLinkedPixelTypes",value:function(t){t=this._cleanPixelType(t);var e=[];return"clickthrough"===t||"clickthru"===t?e.push("adclicktracking","clicktracking"):("start"===t&&e.push("creativeview"),e.push(t,"aduser"+t,"advideo"+t,"ad"+t)),e}},{key:"_getPixels",value:function(t,e){var i=[];if("progress"!==t.toLowerCase())for(var n=this._getAllLinkedPixelTypes(t),r=0;r<n.length;r++)this.trackingPixels.hasOwnProperty(n[r])&&(i=i.concat(this._checkConcatPixels(this.trackingPixels[n[r]])));else e&&e.hasOwnProperty("eventData")&&e.eventData.hasOwnProperty("pixel")&&e.eventData.pixel&&(i=i.concat(e.eventData.pixel));return i}},{key:"_removePixel",value:function(t,e){for(var i=this._getAllLinkedPixelTypes(t),n=0;n<i.length;n++)if(this.trackingPixels.hasOwnProperty(i[n])){var r=this.trackingPixels[i[n]].indexOf(e);r>-1&&this.trackingPixels[i[n]].splice(r,1)}}},{key:"isValid",value:function(t,e){if(!this.pixelsRestrictions.hasOwnProperty(t))return!0;if(t===this.vpaidEvents.AdVideoComplete&&e&&e.newCompletion===!0)return!0;var i=this.pixelsRestrictions[t];return i===this.state&&(this.state=t,!0)}},{key:"destroy",value:function(){this.trackingPixels=this.done=this.events=this.vpaidEvents=this.pixelsRestrictions=this.state=this.clickThruUrl=void 0}},{key:"_checkConcatPixels",value:function(t){return t&&t.length?t:[]}},{key:"_sendPixel",value:function(t,e,i){var n=i?i.data:null;if(h.reportPixel(t,e,n),this.done.indexOf(t)===-1){h.reportCleanPixel(t,e,n);var r=i&&i.tag?i.tag.advId:null;this.done.push(t);try{return t=this._replaceMacros(t),r&&(this.store.getByAdvId("pxlnotsmtp",r)||(t+=(t.search(/\?/)>-1?"&":"?")+(new Date).getTime())),(new Image).src=t,!0}catch(t){return!1}}}},{key:"_replaceMacros",value:function(t){var e=Date.now().toString(),i=e.substring(5);return t=t.replace("[CACHEBUSTING]",i)}},{key:"pause",value:function(){this._isPaused=!0}},{key:"extractWinningPrice",value:function(t,e){var i=this._getPixels(this.vpaidEvents.AdImpression),n=void 0;if(i.length>0)for(var r=new RegExp(t+"=(.*?)(&|$)","gi"),s=0;s<i.length;s++){var o=r.exec(i[s]);o&&(o.length>1&&o[1]?n={found:!0,price:o[1]}:(n||(n={found:!1}),e&&this._removePixel(this.vpaidEvents.AdImpression,i[s])))}return n}}]),t}();e.default=v},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=i(1),a=n(o),d=function(){function t(e){r(this,t),this.store=e,this.hadImpression=!1,this.onNavigatorConnectionChange=this._onNavigatorConnectionChange.bind(this),this.store.on("navigatorConnectionChange",this.onNavigatorConnectionChange);var i=this.store.get("navigatorConnection")||{};this.dast={vdr:void 0,edr:void 0,vwd:void 0,ewd:void 0,vht:void 0,eht:void 0,vbr:void 0,vu:void 0,vt:void 0,ot:void 0,st:void 0,ect:i.effectiveTypeId,ct:i.typeId,vst:[],cnv:!1,ctv:!1,vuc:!1,wp:void 0}}return s(t,[{key:"set",value:function(t){this.stopped||(t.hasOwnProperty("vu")&&""!==t.vu&&(t.vt=this._getVideoTypeFromUrl(t.vu),this.hadImpression&&t.vu!==this.dast.vu&&(this.dast.vuc=!0)),this.dast=Object.assign(this.dast,t))}},{key:"_getVideoTypeFromUrl",value:function(t){var e=void 0,i=t.match(/\.([^\/#?]+)([#?][^\/]*)?$/);return i&&i.length>1&&(e=i[1]),e}},{key:"addWrapper",value:function(t){this.stopped||(t.hasOwnProperty("wu")&&""!==t.wu&&(t.wu=this._getHostnameFromWrapperUrl(t.wu)),this.dast.vst.push(t))}},{key:"_getHostnameFromWrapperUrl",value:function(t){var e=document.createElement("a"),i="";return e.href=t,i=e.hostname,e=null,i}},{key:"_onNavigatorConnectionChange",value:function(t){this.stopped||(this.dast.ect=t.effectiveTypeId,this.dast.ct=t.typeId)}},{key:"get",value:function(){if(!this.stopped)return this._escapeBase64(btoa(unescape(encodeURIComponent(a.stringify(this.dast)))))}},{key:"_escapeBase64",value:function(t){return t.replace(/\//g,"_").replace(/\+/g,"-")}},{key:"destroy",value:function(){this.stopped=!0,this.store.removeListener("navigatorConnectionChange",this.onNavigatorConnectionChange),this.store=this.onNavigatorConnectionChange=this.dast=void 0}},{key:"onImpression",value:function(){this.hadImpression=!0}},{key:"getWrappers",value:function(){return this.dast.vst}}]),t}();e.default=d},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=i(19),a=n(o),d=function(){function t(e){r(this,t),this.store=e,this.data=[],this.useOppsula=this.store.get("usopsla")&&this.store.get("cmbopps"),this.oppsula=this.store.get("oppsula"),this.useOppsula&&!this.oppsula&&this.store.once("oppsulaCreated",this._onOppsulaCreated.bind(this)),this.store.once("waterfallData",this._onWaterfallData.bind(this)),this.store.once("mainVpaidCreated",this._onMainVpaidCreated.bind(this))}return s(t,[{key:"send",value:function(t){this.opportunityManager?this.opportunityManager.send(this._fixedItem,t):this.data.push(t)}},{key:"_sendData",value:function(){var t=this;this.data.forEach(function(e){t.send(e)}),this.data=[]}},{key:"_onWaterfallData",value:function(t){this._fixedItem||(this._fixedItem=t.tags[0],this._createNewPom())}},{key:"_onOppsulaCreated",value:function(t){this.oppsula=t,this._createNewPom()}},{key:"_createNewPom",value:function(){this._fixedItem&&this.config&&(this.useOppsula&&!this.oppsula||this._fixedItem&&this.config&&(this.opportunityManager=new a.default({CM_DOMAIN:this.config.creatives.CM_DOMAIN,AUC_DAST:this.config.creatives.AUC_DAST,sequenceId:this._fixedItem.sequenceId,ST:this.config.creatives.ST,STS:this.config.creatives.STS,SDID:this.config.creatives.SDID,PT:this.config.creatives.PT,PV:this.config.creatives.PV,WP:this.config.creatives.WP,VPD:this.config.creatives.PUBID,VPTD:this.config.creatives.TAGID,VMT:this.config.creatives.VMT},this.store),this._sendData()))}},{key:"_onMainVpaidCreated",value:function(t){this.config=t}}]),t}();e.default=d},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=function(){function t(e){i(this,t),this.store=e,this.event="queueStatusChanged",this.backfillPriority=this.store.get("mxbckflldlyitms")?this.store.get("bfprty"):void 0,this.previousQueue=[],this._initQueueStatus()}return n(t,[{key:"_initQueueStatus",value:function(){this.queueStatus={requiredViewabilityCount:0,nonRVCount:0,adLoadedCount:0,adxCard:!1,size:0,singleAd:!1,items:[],previousQueue:[]}}},{key:"onItemRemovedFromQueue",value:function(t){var e=this._getItemFromQueue(t);e&&(e=Object.assign({},e),e.vw=t.vpaidWrapper?t.vpaidWrapper.getVpaidStatus():{},this.previousQueue.push(Object.assign({},e)))}},{key:"_getItemFromQueue",value:function(t){for(var e=0;e<this.queueStatus.items.length;e++){var i=this.queueStatus.items[e];if(t.wfIndex===i.seq&&parseInt(t.waterfallTagId)===i.wti)return i}return!1}},{key:"onScheduleChange",value:function(t,e,i){this._initQueueStatus(),this.queueStatus.size=t.length,this.queueStatus.adxCard=e,this.queueStatus.previousQueue=this.previousQueue;for(var n=0;n<t.length;n++){var r=t[n];r.requiredViewability?this.queueStatus.requiredViewabilityCount++:this.queueStatus.nonRVCount++,r.vpaidWrapper.adLoadedFired&&this.queueStatus.adLoadedCount++,r.singleAd&&(this.queueStatus.singleAd=!0),this.queueStatus.items.push(this._getItemStatus(r))}this.emit(i)}},{key:"_getItemStatus",value:function(t){return{aid:t.advId,bf:t.priority===this.backfillPriority,br:t.brand,cmpid:t.campaignId,crid:t.creativeId,cstmdl:t.cstmdl,dp:t.dp,t:t.itemType,li:t.lineItemId,pid:t.pubId,rv:t.requiredViewability,pr:t.vpaidWrapper?t.vpaidWrapper.getPrice():"",sa:t.singleAd,seq:t.wfIndex,wti:parseInt(t.waterfallTagId),vw:t.vpaidWrapper?t.vpaidWrapper.getVpaidStatus():{}}}},{key:"emit",value:function(t){this.store.emit(t||this.event,this.queueStatus)}}]),t}();e.default=r},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=i(6),u=i(3),h=r(u),c=i(1),p=n(c),f=i(20),v=r(f),m=i(13),g=(r(m),i(8)),y=r(g),_=i(7),b=r(_),w=i(71),A=r(w);window.vpaidId=Date.now()+"-"+parseInt(1e4*Math.random());var k=function(t){function e(t,i){s(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.vpaidWrapper=t.vpaidWrapper,n.trackingPixels=(0,v.default)(),n.trackingPixels.adimpression=[t.internalPixel].concat(t.tag.conversionPixels),n.store=i,n.preferdVpaid=n.store.get("pvpd")||"javascript",n.tag=t.tag,n.preferdVpaid=n.store.getByAdvId("pvpd",n.tag.advId)||n.preferdVpaid,n.pvidtp=n.store.getByLineItem("pvidtp",n.tag),n.vpaidLog=t.vpaidLog,n.stopped=!1,n.destroyed=!1,n.debugTracker=new h.default("VastParser"),n.width=parseInt(t.width||n.store.get("width")),n.height=parseInt(t.height||n.store.get("height")),n.bitrate=parseInt(t.bitrate),n.redirCount=0,n.isMobile=n.store.get("isMobile"),n.handlerOptions=t.handlerOptions,n.secureWrapperUrls=p.shouldSecureWrapperAndMediaFile(i),n.fileTypes=["flv","wmv","mp4","webm","ogg","mov"],n.vastUrls=[],n.wrappersCount=0,n.addWrappersToPlayerDAST=n.store.get("adwrprstoplrdst"),n}return a(e,t),d(e,[{key:"_fetch",value:function(t,e,i,n){var r=this,s=cmTag.$||s;s.ajax({url:t,beforeSend:function(t){i&&(t.withCredentials=!0)},timeout:1e4,complete:function(t,i,n){t.responseText&&e(null,t.responseText)},error:function(i,s,o){return n?e(s):void r._fetch(t,e,!1,!0)}})}},{key:"parseVastFromUrl",value:function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t&&(t=p.trim(t)),t=this._replaceMacros(t),p.logToBI(this.vpaidLog,"parseVastFromUrl",{url:t},!1,!1),this.vastUrls.push(t);var e=this.store.get("vstprxy");return e?this._fetchVastByProxy(t):void this._fetchVastXhr(t)}},{key:"_fetchVastByProxy",value:function(t){var e=this.store.get("pxyurl"),i=e+t;this._fetchVastXhr(i)}},{key:"_fetchVastXhr",value:function(t){var e=this;(0,b.default)(t,"",this._onTagResponse.bind(this),function(){e._onTagResponseError("vastxhrerror_noflash",t)})}},{key:"parseVastFromString",value:function(t){p.logToBI(this.vpaidLog,"parseVastFromString",{xml:t},!1,!1),this._onTagResponse(t)}},{key:"stop",value:function(){this.stopped=!0,this.vpaidLog=null,this.debugTracker=this.trackingPixels=void 0}},{key:"_extractDuration",value:function(t){var e=this._extractTag("duration",t),i=30;return e&&e.length&&e[0].textContent&&(i=parseInt(e[0].textContent.replace("00:00:",""))),this.duration=i,i}},{key:"_extractMediaFile",value:function(t,e,i,n){if(!this.stopped){for(var r=!1,s=!1,o=this._getFilesTemplate(),a={},d=[],l=0;l<t.length;l++){var u=this._getMediaFileType(t[l]);if(u&&u.url){if((0,A.default)(u.url,this.store)){p.logToBI(this.vpaidLog,"badMediaFile",{url:u.url});continue}d.push(u.url)}switch(u.type){case"vpaid":"javascript"==u.subType&&(r&&"javascript"!=r?s=!0:r="javascript",a.javascript=1,o.vpaid.javascript.push(u));break;case"video":r&&"video"!=r?s=!0:r="video",a.video=1,o.videoFiles[u.subType].push(u);break;default:s=!0,o.mixed.push(u)}}var h={flag:s,vpaid:1===a.javascript,video:1===a.video,mixed:o.mixed.length>0};s&&(this.mixedFilesFlag=h.vpaid&&h.video),s&&this.preferdVpaid&&a.hasOwnProperty(this.preferdVpaid)&&(r=this.preferdVpaid),"video"===r&&(o=this.onVideoWrapperMode(o)),d.length&&p.logToBI(this.vpaidLog,"vastMediaFiles",{urls:d},!1,!1),this.storedMediaFiles=o,this.publishParseTagResults(r,o,e,i,n)}}},{key:"onVideoWrapperMode",value:function(t){for(var e=null,i=0;i<this.fileTypes.length;i++){var n=t.videoFiles[this.fileTypes[i]];e||n.length>0&&n[0].url&&(e=n[0]);var r=this._chooseBestVideoFile(n,this.bitrate,this.width,this.height);r&&r.url&&t.video.push(r)}return 0===t.video.length&&null!==e&&t.video.push(e),this._sortVideos(t.video),t}},{key:"_sortVideos",value:function(t){var e=this;t.length&&this.pvidtp&&(t=t.sort(function(t,i){return t.url.indexOf(e.pvidtp)!=-1?-1:i.url.indexOf(e.pvidtp)!=-1?1:0}))}},{key:"publishParseTagResults",value:function(t,e,i,n,r){if(!this.stopped){var s=!1;switch(t){case"javascript":e.vpaid.javascript.length>0&&(s=!0);break;case"video":e.video.length>0&&(s=!0)}s?this._onWrapperFound(t,e,i,r):(this._onVastError("NoMediaFileAfterSort",n,y.default.mediaFileNotSupported),p.logToBI(this.vpaidLog,"noMediaFileAfterSort",{}))}}},{key:"_onWrapperFound",value:function(t,e,i,n){p.logToBI(this.vpaidLog,"vpiadWrapperFound",{wrapperMode:t},!1,!1),this.handlerOptions.adParams=i,this.handlerOptions.vpaidFiles=e,this.handlerOptions.extra.duration=n,this.handlerOptions.trackingPixels=this.trackingPixels,this.emit("handlerCreated",{type:t,handlerOptions:this.handlerOptions})}},{key:"_chooseBestVideoFile",value:function(t,e,i,n){if(this.stopped)return!1;for(var r=!1,s=this.store.get("isMobile"),o=n/i,a=99999999,d=0;d<t.length;d++)t[d].ratioFactor=Math.abs(o-t[d].ratio),t[d].sizeFactor=Math.abs(i-t[d].width)+Math.abs(n-t[d].height),t[d].rateFactor=Math.abs(e-t[d].bitrate),t[d].weight=0,s&&(t[d].rateFactor*=-1,this._isRtmp(t[d].url)&&(t[d].weight=1e6)),t[d].score=100*t[d].ratioFactor+1*t[d].sizeFactor+t[d].rateFactor+t[d].weight,a>t[d].score&&(a=t[d].score,r=t[d]);return r}},{key:"_isRtmp",value:function(t){return 0===t.indexOf("rtmp://")}},{key:"_getFilesTemplate",value:function(){for(var t={video:[],videoFiles:{},vpaid:{flash:[],javascript:[]},mixed:[]},e=0;e<this.fileTypes.length;e++)t.videoFiles[this.fileTypes[e]]=[];return t}},{key:"_getMediaFileType",value:function(t){if(this.stopped)return{};var e={};e.url=t.textContent,e.url&&(e.url=e.url.trim());var i=parseInt(t.getAttribute("bitrate"));e.bitrate=i?i:0;var n=parseInt(t.getAttribute("width"));e.width=n?n:0;var r=parseInt(t.getAttribute("height"));switch(e.height=r?r:0,e.originalType=t.getAttribute("type"),e.originalType){case"video/x-flv":e.type="video",e.subType="flv";break;case"video/x-ms-wmv":e.type="video",e.subType="wmv";break;case"video/mp4":e.type="video",e.subType="mp4";break;case"video/webm":e.type="video",e.subType="webm";break;case"video/ogg":e.type="video",e.subType="ogg";break;case"video/quicktime":var s=this.store.get("ua");"Safari"!==s.browser.name?(e.originalType="video/mp4",e.type="video",e.subType="mp4"):(e.type="video",e.subType="mov");break;case"application/javascript":case"application/x-javascript":case"text/javascript":e.type="vpaid",e.subType="javascript";break;case"application/x-shockwave-flash":e.type="vpaid",e.subType="flash";break;default:p.logToBI(this.vpaidLog,"unknownMediaFileType",{type:e.originalType}),e.type="unknown",e.subType="unknown"}return e.width&&e.height?e.ratio=e.height/e.width:e.ratio="1:1",e}},{key:"_extractTrackingEvents",value:function(t){if(!this.stopped){this._checkForSpecificEvent("impression",t),this._checkForSpecificEvent("error",t),this._checkForSpecificEvent("clickthru",t),this._checkForSpecificEvent("clickthrough",t),this._checkForSpecificEvent("clicktracking",t);var e=this._extractTag("trackingevents",t);if(e.length>0)for(var i=this._extractTag("tracking",e[0]),n=0;n<i.length;n++){var r=i[n].getAttribute("event");if(r)if("progress"===r.toLowerCase()){var s,o=i[n].getAttribute("offset");o&&(s=o.indexOf("%")===-1?"time":"precentage"),this._addEventPixel(r.toLowerCase(),this._extractTagUrl(i[n]),o,s)}else this._addEventPixel(r.toLowerCase(),this._extractTagUrl(i[n]))}}}},{key:"_extractTagUrl",value:function(t){if(!this.stopped){var e=this._extractTag("url",t),i="";return i=e.length>0?e[0].textContent:t.textContent}}},{key:"_extractTag",value:function(t,e){if(!this.stopped){for(var i=e.childNodes,n=[],r=Array.isArray(t),s=0;s<i.length;s++)if(i[s].tagName){var o=i[s].tagName.toLowerCase(),a=r?t.indexOf(o)>-1:o==t;a?n.push(i[s]):n=n.concat(this._extractTag(t,i[s]))}return n}}},{key:"_extractTagArttibute",value:function(t,e,i){if(!this.stopped){for(var n=e.childNodes,r=[],s=0;s<n.length;s++)if(n[s].tagName){var o=n[s].tagName.toLowerCase();if(o==t){var a=n[s].getAttribute(i);r.push(a)}else r=r.concat(this._extractTagArttibute(t,n[s],i))}return r}}},{key:"_filterVastByRegex",value:function(t){var e=this.store.getByAdvId("regx",this.tag.advId);if(!e)return!1;var i=new RegExp(e),n=i.exec(t);return!(!n||!n.length)}},{key:"_onTagResponse",value:function(t,e){if(!this.stopped){if(this.debugTracker.info("Vast was loaded",{vast:t}),p.logToBI(this.vpaidLog,"tagResponse",{response:t,xhrErrors:e},!1,!1),this._filterVastByRegex(t))return p.logToBI(this.vpaidLog,"vastFilterdByRegex",{regex:this.store.getByAdvId("regx",this.tag.advId)}),void this._onVastFilterdByRegexError("VastFilterdByRegex",t,y.default.filterVastByRegex);var i=this._parseXml(t);if(null==i||this._extractTag(["parsererror"],i).length)return void this._onVastError("ParsingError",t,y.default.vastError);this.vastVersion=this._extractTagArttibute("vast",i,"version").shift()||"1.1",p.logToBI(this.vpaidLog,"vastVersion",{version:this.vastVersion},!1,!1),this.vpaidWrapper.setVastPrice(this._readTagPrice(i)),this.store.get("vastTypeMap")&&this.vpaidWrapper.setVastType(this._readType(t)),this.icons||(this.icons=this._getIcons(i),this.vpaidWrapper.setVastIcons(this.icons));var n=this._getCreativeExtensions(i);this.vpaidWrapper.setExternalScripts(n);var r=this._extractDuration(i),s=this._extractTag("mediafiles",i);if(s&&1==s.length&&s[0].childNodes.length){var o=this._extractTag("mediafile",s[0]);0==o.length?(this.debugTracker.error("Vast","No media files!"),this._onVastError("ParsingError",t,y.default.vastError,"noMediaFile")):(this._extractMediaFileAnalysisToPlayerDAST(i,r),this._extractTrackingEvents(i),this._extractMediaFile(o,this._getAdParameters(i),t,r))}else{var a=this._extractTag("wrapper",i);1==a.length?(this._extractTrackingEvents(i),this._onWrapper(a[0],t,i,r)):this._onVastError("NoMediaFiles",t,y.default.emptyVast,"noMediaFilesAndWrapper")}}}},{key:"_extractMediaFileAnalysisToPlayerDAST",value:function(t,e,i){var n={vr:this.vastVersion},r=this._extractTag("ad",t).shift();r&&(n.aid=this._extractAttributeFromTag(r,"id"));var s=this._extractTag("adsystem",t).shift();s&&(n.as=this._extractTextFromTag(s),p.logToBI(this.vpaidLog,"adSystem",{system:n.as},!1,!1));var o=this._extractTag("adtitle",t).shift();o&&(n.at=this._extractTextFromTag(o)),i&&(n.wu=i),this.vpaidWrapper.playerDAST.set({vdr:e}),this.vpaidWrapper.playerDAST.addWrapper(n)}},{key:"_extractAttributeFromTag",value:function(t,e){return t.getAttribute(e)||""}},{key:"_extractTextFromTag",value:function(t){return t.textContent||""}},{key:"_readTagPrice",value:function(t){var e=this._extractTag(["price","pricing"],t).shift(),i=0;if(e){var n=e.textContent;try{isNaN(Number(n))&&n.indexOf("DATA")!=-1&&(i=n.replace(/[^0-9.]/g,"")),i=Number(n),i=i.toFixed(3),i=Number(i)}catch(t){i=0}}return i}},{key:"_readType",value:function(t){var e=this.store.get("vastTypeMap"),i=void 0;for(var n in e)t.search(new RegExp(n,"i"))!=-1&&(i=e[n]);return i}},{key:"_decodeType",value:function(t){var e=t.attributes,i={};for(var n in e)e[n].value?i[e[n].name]=e[n].value.toLowerCase():null;return i}},{key:"_getCreativeExtensions",value:function(t){for(var e=[],i=this._extractTag(["creativeextension"],t),n=0;n<i.length;n++){var r={};r.element=i[n].textContent.trim(),r.attributes=this._decodeType(i[n]),e.push(r)}return e}},{key:"_getIcons",value:function(t){for(var e=[],i=this._extractTag(["icon"],t),n=0;n<i.length;n++){var r={},s=this._isIconClicksExists(i[n]);s&&(r.clickThroughUrl=this._decodeIconData(i[n],"iconclickthrough").shift()),r.staticresource=this._decodeIconData(i[n],"staticresource").shift(),r.staticresource||(r.htmlresource=this._decodeIconData(i[n],"htmlresource").shift()),!r.htmlresource&&!r.staticresource||s&&!r.clickThroughUrl||(r.iconViewTracking=this._decodeIconData(i[n],"iconviewtracking"),r.clickTracking=this._decodeIconData(i[n],"iconclicktracking"),r.attributes=this._decodeIconAttributes(i[n]),e.push(r))}return e}},{key:"_isIconClicksExists",value:function(t){var e=this._extractTag(["iconclicks"],t).shift(),i=!!e;return i}},{key:"_decodeIconAttributes",value:function(t){var e=t.attributes,i={};for(var n in e)e[n].value?i[e[n].name]=e[n].value.toLowerCase():null,"width"===e[n].name||"height"===e[n].name?i[e[n].name]+="px":null;return i}},{key:"_decodeIconData",value:function(t,e){try{var i=this._extractTag([e],t),n=i.map(function(t){return t.textContent.trim()});return n}catch(t){return this.debugTracker.warn("Vast","decode Icon "+e,t),""}}},{key:"_onWrapper",value:function(t,e,i,n){if(!this.stopped){this.wrappersCount++;var r=this._extractTag("vastadtagurl",t);if(0==r.length&&(r=this._extractTag("vastadtaguri",t),0==r.length))return this._onVastError("WrapperError",e,y.default.vastWrapperError,"EmptyWrapper");var s=this._extractTagUrl(r[0]);if(!s)return this._onVastError("WrapperError",e,y.default.vastWrapperError,"NoUrl");this.secureWrapperUrls&&(s=s.replace("http:","https:")),0===this.redirCount&&p.logToBI(this.vpaidLog,"VastWrapper",{type:"wrapper"}),this.redirCount++,this.addWrappersToPlayerDAST&&this._extractMediaFileAnalysisToPlayerDAST(i,n,s),this.parseVastFromUrl(s)}}},{key:"_getAdParameters",value:function(t){if(!this.stopped){var e="",i=this._extractTag("adparameters",t);return i.length>0&&i[0].textContent&&(e=i[0].textContent),e}}},{key:"_checkForSpecificEvent",value:function(t,e){if(!this.stopped)for(var i=this._extractTag(t,e),n=0;n<i.length;n++)this._addEventPixel(t,this._extractTagUrl(i[n]))}},{key:"_addEventPixel",value:function(t,e,i,n){if(!this.stopped&&void 0!=this.trackingPixels[t]&&e)if("progress"===t){if(i&&n)try{this.trackingPixels[t].push({pixel:e,offset:"time"===n?p.hmsmToSecondsOnly(i):parseInt(i.replace("%",""))/100,offsetType:n,fired:!1})}catch(t){}}else this.trackingPixels[t].push(e)}},{key:"_parseXml",value:function(t){if(this.stopped)return null;var e=null;if(window.DOMParser)try{e=(new DOMParser).parseFromString(t,"text/xml")}catch(t){e=null}else if(window.ActiveXObject)try{e=new ActiveXObject("Microsoft.XMLDOM"),e.async=!1,e.loadXML(t)||(e=null)}catch(t){e=null}return e}},{key:"_onTagResponseError",value:function(t,e){if(!this.stopped){if(this.vpaidWrapper.vpaidHandler)return void p.logToBI(this.vpaidLog,"VastParserOnTagResponseError",{type:"wrapper has handler"});this.debugTracker.error("Vast","Vast url was not loaded!aborting..."),this._reportToServer(t,"VastLoadError="+t+"&URL="+encodeURIComponent(e)),t&&Array.isArray(t)?this.emit("networkFail",t):this.emit("parserError",{type:t})}}},{key:"_onVastError",value:function(t,e,i,n){this.stopped||(this.debugTracker.error("VAST-ERROR",t),p.logToBI(this.vpaidLog,"vastParseError",{reason:n}),this.emit("parserError",{type:t,oppsId:i}))}},{key:"_onVastFilterdByRegexError",value:function(t,e,i){this.stopped||(this.debugTracker.error("VAST-ERROR",t),this.emit("parserError",{type:t,oppsId:i}))}},{key:"_sampleVastXml",value:function(t){this.stopped}},{key:"_reportToServer",value:function(t,e){}},{key:"destroy",value:function(){this.stopped=!0,this.destroyed=!0,this.vpaidLog=null,this.vastUrls=null,this.tag=null,this.trackingPixels=this.debugTracker=this.fileTypes=void 0,this._onTagResponse=this._onTagResponseError=function(){}}},{key:"_replaceMacros",value:function(t){return t=t.replace(/\[CACHEBUSTER\]/,Date.now())}},{key:"hasMixedFiles",value:function(){return this.mixedFilesFlag===!0}}]),e}(l.EventEmitter);e.default=k},function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r={new:{id:0,name:"new"},adLoaded:{id:1,name:"adLoaded",timeKey:"ldd"},startAd:{id:2,name:"startAd",timeKey:"st"},adImpression:{id:3,name:"adImpression",timeKey:"imp"},adPlay:{id:4,name:"adPlay",timeKey:"pl"},adError:{id:5,name:"adError",timeKey:"err"},adComplete:{id:6,name:"adComplete",timeKey:"cmp"}},s=function(){function t(){i(this,t),this.statuses=r,this.status=this.statuses.new.id,this.timeBetweenStatuses={},this._startTimer()}return n(t,[{key:"setStatus",value:function(t){this.timeBetweenStatuses[t.name]=this._getTime(),this.status=t.id,this._startTimer()}},{key:"get",value:function(){var t={cs:this._getTime()};for(var e in this.timeBetweenStatuses)t[this.statuses[e].timeKey]=this.timeBetweenStatuses[e];return{st:this.status,ts:t}}},{key:"_startTimer",value:function(){this.time=Date.now()}},{key:"_getTime",value:function(){return Date.now()-this.time}}]),t}();t.exports={Statuses:r,VpaidStatus:s}},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=i(10),u=r(l),h=i(3),c=r(h),p=i(62),f=r(p),v=i(1),m=n(v),g=i(58),y=r(g),_=i(13),b=r(_),w=i(19),A=r(w),k=i(8),T=r(k),C=i(6),E=i(56),P=r(E),S=i(108),I=r(S),V=i(16),x=r(V),O=i(50),D=r(O),M=i(59),F=r(M),L=i(63),R=r(L),B=i(14),j=r(B),U=i(77),W=r(U),N=i(68),H=r(N),q=i(51),z=r(q),G=i(109),Q=0,X=0,Y=function(t){function e(t,i,n,r){s(this,e);var a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));a.mainVpaid=i,a.store=n,a.wflog=r,a.wflog&&a.wflog.increaseNumberOfConnectedVpaids(),a.isVForceActive=a.store.get("vForce"),a.created=Date.now(),a.loadedEvent="",a.manager=t.manager,a.clickThoughHandler=new H.default(a.store,a.manager.mainVpaid.vpaidHandler.parent),a.index=++Q,a.vpaidWrapperIndex="VpaidWrapper"+a.index,a.tagid=t.tagid,a.tag=t.tag,a.tag.vpaidWrapperData={},a.error="",a.readyInMS=0,a.isMultiAdsActive=a.store.get("mltads"),a.isMultiVpaidUnit=a.store.get("isMultiVpaidUnit"),a.isAdErrorBeforeAdLoadedActive=a.store.get("aderrbfradlddopactv"),a.adLoadedFired=!1,a.hijackFired=!1,a.latestVpaidAnalytics=a.store.getLatestVersion("anltcsurl"),a.registerAnalytics=a.latestVpaidAnalytics&&a.latestVpaidAnalytics.value||a.store.get("mltprpsrvsurl")?a._registerAnalytics.bind(a):function(){},a.maxNetworkCalls=a.store.getByLineItem("mxntwrkclls",a.tag)||0,a.iframesWeights=a.store.get("ifrmswghts"),a.blockBringToFront=a.isMultiVpaidUnit&&a.store.get("blckbrngtofrnt"),a.toggleIframeContentDisplayActive=a.store.get("tglifrmcntndsplyactv"),a.waitForAdPausedBeforeResumeAd=a.store.get("wtfradpsdbfrrsmad"),a.nonVideoVpaid=a.tag.itemType===j.default.type,a.defaultTagPrice=a.store.get("dftgprc"),a.moatTrackers=[];var d=a.store.getByLineItem("cstmdl",a.tag);void 0===d&&(d=a.tag.cstmdl);var l=new D.default(a.store);if(a.isCPCV=a.fireCompletionPixelOnNewCompletionEvent=l.isCPCV(d),a.playerDAST=new F.default(a.store),a.vpaidStatuses=R.default.Statuses,a.vpaidStatus=new R.default.VpaidStatus,a.creatives={},a.stayAlive=!1,a.oldStatus="",a.stopReason="",a.config={},a.vast=[],a.iconsPrograms=[],a.isMobile=a.store.get("isMobile")||!1,a.isIOS=!1,a.isMobile){var h=a.store.get("ua");a.isIOS="iOS"===h.os.name}a.timeoutLengthToAdCompletion=a.store.getByLineItem((a.isMobile?"mbl":"dsk")+"tmouttoadcmpltn",a.tag),a.fireNewCompletionPixel=a.timeoutLengthToAdCompletion>0,a.fireNewCompletionPixel&&(a.timeoutLengthToAdCompletion=m.normalizeMilliseconds(a.timeoutLengthToAdCompletion)),a.timeoutToAdCompletion=null,a.timeoutToAdCompletionStartTime=0,a.newCompletionEventFired=!1,a.globalAdTimeout=null,a.globalAdTimeoutStartTime=0,a.globalAdTimeoutLength=a.store.getByLineItem("global_ad_timeout",a.tag),a.globalAdTimeoutLength&&a.globalAdTimeoutLength>0&&(a.globalAdTimeoutLength=m.normalizeMilliseconds(a.globalAdTimeoutLength)),a.store.get("dbncadvltm")?a.setAdVolume=G(a._setAdVolume,a.store.get("dbncadvltm"),{leading:!0}):a.setAdVolume=a._setAdVolume,a.tag.advId&&a._pushUniqueAdvIdsToWaterfallLog(),a.tag.moatSampling=a._decideMoat();var p={auctionId:a.tag.auctionId,advId:a.tag.advId,dast:a.tag.dast,price:a.tag.price,queueNumber:a.tag.queueNumber,cpmFloor:a.tag.cpmFloor,dp:a.tag.dp,
rollType:a.tag.rollType,lineItem:a.tag.lineItem,unitType:a.store.get("unit_type"),unitVersion:a.store.get("unit_version"),isMobile:a.isMobile,rpox:a.tag.rpox,alfrox:a.tag.alfrox,frox:a.tag.frox,waterfallIndex:a.tag.wfIndex,itemType:a.tag.itemType,requiredViewability:a.tag.requiredViewability,requiredViewabilityDrawn:a.tag.requiredViewabilityDrawn,flad:a.tag.flad||a.tag.flad_delay||0,brand:a.tag.brand,priority:a.tag.priority,isCPCV:a.isCPCV,backfillDelayed:!!a.tag.isBackfillDelayed,moatSampling:a.tag.moatSampling};if(a.tag.crId){var v={stId:a.tag.stId,cmpgnId:a.tag.cmpgnId,itemType:a.tag.itemType};p=Object.assign(p,v)}a.pwov=a.tag.pwov,a.vpaidLog=new b.default(p,a.store),a._copyFromStoreToBi("connectionType",!1);var g=a.store.get("navigatorConnection");if(m.logToBI(a.vpaidLog,"navigatorConnection",{effectiveTypeId:g.effectiveTypeId,typeId:g.typeId},!1,!1),a._wfStats=t.wfStats,a._wfStats.increaseVpaidsCount(),a.oppsID=T.default,a.shouldMuteVid=a.store.get("dskVidMuted")&&!a.store.get("isMobile"),a.opportunityManager=new A.default({CM_DOMAIN:i.config.creatives.CM_DOMAIN,AUC_DAST:i.config.creatives.AUC_DAST,sequenceId:a.sequenceId,ST:i.config.creatives.ST,STS:i.config.creatives.STS,SDID:i.config.creatives.SDID,PT:i.config.creatives.PT,PV:i.config.creatives.PV,WP:i.config.creatives.WP,VPD:i.config.creatives.PUBID,VPTD:i.config.creatives.TAGID,VMT:i.config.creatives.VMT},a.store,a.vpaidLog),a.vpaidEventToPixelId={},a.vpaidEventToPixelId[a.mainVpaid.vpaidEvents.AdVideoFirstQuartile]=a.oppsID.videoFirstQuartile,a.vpaidEventToPixelId[a.mainVpaid.vpaidEvents.AdVideoMidpoint]=a.oppsID.videoMidpoint,a.vpaidEventToPixelId[a.mainVpaid.vpaidEvents.AdVideoThirdQuartile]=a.oppsID.videoThirdQuartile,a.vpaidEventToPixelId[a.mainVpaid.vpaidEvents.AdVideoComplete]=a.oppsID.videoComplete,a._sendOpp(a.oppsID.tagStarted),a.unloadCallback=function(t){a._sendOpp(a.oppsID.unloadPage)},a.opportunityManager.isRegisterAvailable("unloadCallbacks",a.unloadCallback,!0),a.debugTracker=new c.default(a.vpaidWrapperIndex),a.pixelManager=new y.default(n),t.creatives)for(var _ in t.creatives)a.creatives[_]=t.creatives[_];if(t.config)for(var _ in t.config)a.config[_]=t.config[_];return a.adVolume=m.normalizeVolume(parseInt(a.config.VOLUME)?parseInt(a.config.VOLUME):0),a.vpaidEvents=t.vpaidEvents,a.localTarget=a._createLocalTarget(a.config.target),a.vpaidHandlersFactory=new W.default(a.vpaidLog,a.store),a.handlerOptions={applyBypass:!!a.creatives.AFBP,slot:a.localTarget,videoSlotControls:!!a.config.videoSlotControls,videoSlotCanAutoPlay:!!a.config.videoSlotCanAutoPlay,protection:a.config.vpaid_protect_path,tag:a.tag,onReady:a._onHandlerCreated.bind(a),onError:a._onHandlerError.bind(a),onSwitchFromCanvasToVideo:a._onSwitchFromCanvasToVideo.bind(a),playerDAST:a.playerDAST,extra:{registerAnalyticsToVpaidLog:a.registerAnalytics}},a.nonVideoVpaid?(a._createNonVideoVpaid(),o(a)):(a.store.get("vpdcntrcstmcss")&&((a.adTarget||a.localTarget).style.cssText+=a.store.get("vpdcntrcstmcss")),a.isIOS&&(a.clickableTarget=a._createClickableTarget(a.localTarget)),a.localVideo=a._createLocalVideo(a.localTarget),a.handlerOptions.videoSlot=a.localVideo,a.handlerOptions.clickableTarget=a.clickableTarget||null,a.beacon=new u.default(a),a.parser=new f.default({vpaidLog:a.vpaidLog,width:a.config.width,height:a.config.height,bitrate:a.config.bitrate,internalPixel:a.tag.pixel,tag:a.tag,vpaidWrapper:a,handlerOptions:a.handlerOptions},a.store),a.parser.on("handlerCreated",a._createHandler.bind(a)),a.parser.on("parserError",a._onParserError.bind(a)),a.parser.on("networkFail",a._onNetworkError.bind(a)),a.adFoundDispatched=!1,a.vpaidHandler=!1,a.stopped=!1,a._startParser(),a.isVForceActive=a.store.get("vForce")||!1,m.logToBI(a.vpaidLog,"vForce",{vForceIsActive:a.isVForceActive},!1,!1),a._initTimers(),a.store.get("useVideoControls")&&a.store.getByLineItem("ad_controls",a.tag)!==!1&&(a.VideoControls=new x.default(a.localVideo,a.store,a.localTarget,"ad",a),a.VideoControls.setVpaidHandler(a),a.VideoControls.setOnSoundChangeCallback(a._onSoundChange.bind(a)),a.VideoControls.once("unmuteClicked",a._sendFirstUnmuteOpp.bind(a))),a.handelsEarlyAI=a.store.get("erlyai"),a._handleDataSaver(),a.store.get("debug")&&a._addCopyToClipboardBtn(),a.isReplayable=!1,a._onGotAdIconsBinded=a._onGotAdIcons.bind(a),a._appendVpaidCSS(),a)}return a(e,t),d(e,[{key:"_decideMoat",value:function(){if(this.store.get("isInApp")||!this.store.getByLineItem("moat",this.tag))return!1;if(this.store.get("moat"))return!0;var t=this.store.getByLineItem("mtfctr",this.tag);return void 0===t||m.getRandomInt(0,100)<=t}},{key:"_createNonVideoVpaid",value:function(){this.beacon=new u.default(this),this.vpaidHandler=!1,this.stopped=!1,this.isVForceActive=this.store.get("vForce")||!1,this.isReplayable=!1,this._createHandler({type:"adx",handlerOptions:this.handlerOptions})}},{key:"_addCopyToClipboardBtn",value:function(){var t=this,e=document.createElement("div");e.className="playerSaveButton",e.style.zIndex=X+10,e.innerHTML="SAVE",this.localVideo.parentElement.appendChild(e),e.addEventListener("click",function(){(0,I.default)(t.vpaidLog.toString())})}},{key:"_startParser",value:function(){this.parser.stopped||(this.tag.vast?this.parser.parseVastFromString(this.tag.vast):this.parser.parseVastFromUrl(this.tag.url))}},{key:"_initTimers",value:function(){this._waitForEvent(this.vpaidEvents.AdLoaded,this.store.getByLineItem("altmot",this.tag)||this.tag.ADTO,this._onAdLoadedEvent.bind(this),this._onAdLoadedTimeout.bind(this)),this._setTimers()}},{key:"_setTimers",value:function(){var t=this._initTimersStart?Date.now()-this._initTimersStart:0;this._initTimersStart=Date.now(),this._initTillAdstartTimeout(t),this._initAutoKillTimeOut(t)}},{key:"_initTillAdstartTimeout",value:function(t){var e=this;this.tillAdstartTimeout&&clearTimeout(this.tillAdstartTimeout);var i=this.type&&this.store.getByTech("adto",this.type)||this.store.getByLineItem("adto",this.tag)||this.tag.ADTO;i-=t,i>0&&(this.tillAdstartTimeout=setTimeout(function(){m.logToBI(e.vpaidLog,"AdStopADTO",{}),e.error="adto",e.stop(e.error,e.oppsID.adtoTimeout)},i))}},{key:"_initAutoKillTimeOut",value:function(t){var e=this;this.autoKill&&clearTimeout(this.autoKill);var i=this.type&&this.store.getByTech("vakll",this.type)||this.store.getByLineItem("vakll",this.tag)||9e4;i-=t,i>0&&(this.autoKill=setTimeout(function(){m.logToBI(e.vpaidLog,"AutoKill",{timeout:i}),e.error="autoKill",e.beacon.dispatchEvent(e.vpaidEvents.AdVideoComplete,e),e.stop(e.error,e.oppsID.globalTimeout)},i))}},{key:"_killTimers",value:function(){if(clearTimeout(this.autoKill),clearTimeout(this.tillAdstartTimeout),clearTimeout(this.adloadedTimeout),this.pendingEvents)for(var t in this.pendingEvents)this.pendingEvents[t].timeoutId!=-1&&clearTimeout(this.pendingEvents[t].timeoutId);this.pendingEvents={}}},{key:"_createClickableTarget",value:function(t){if(!this.stopped){var e=document.createElement("div"),i=this.store.get("width"),n=this.store.get("height");return e.className="cm-ad-click-target",e.style.cssText="width: "+i+"px; height: "+n+"px; cursor: pointer; position: absolute; top: 0px; left: 0px;",e.style.display="",e.setAttribute("width",i),e.setAttribute("height",n),t.appendChild(e),e}}},{key:"_createLocalVideo",value:function(t){var e=this;if(!this.stopped){var i=document.createElement("video"),n=this.store.get("width"),r=this.store.get("height");return i.className="cm-ad-player",i.style.cssText="width: "+n+"px; height: "+r+"px;",i.style.display="",i.volume=0,this.shouldMuteVid&&(i.muted=!0),i.setAttribute("width",n),i.setAttribute("height",r),this.isMobile&&(i.muted=!0,i.setAttribute("muted","")),i.addEventListener("timeupdate",function(t){e._onTimeupdate(i)}),this.config.videoSlotControls&&i.removeAttribute("controls"),this.store.get("addprld")&&i.setAttribute("preload","auto"),t.appendChild(i),i}}},{key:"_createLocalTarget",value:function(t){if(!this.stopped){var e=document.createElement("div");return this.store.get("noplrcntr")&&(e.id="_cm-css-reset"),e=this._styleElement(e,t),this._createAdTargetElement(e),t.appendChild(this.adTarget?this.adTarget:e),e}}},{key:"_styleElement",value:function(t,e){return this.store.get("noplrcntr")||(t.style.cssText=e.style.cssText),t.style.position="absolute",t.style.overflow="hidden",t.style.top="0",t.style.height="0",t.style.left="0",t.style.zIndex="1",t.style.background="transparent",this.store.get("noplrcntr")?t.className=this.vpaidWrapperIndex:t.className=(e.className?e.className:"")+" "+this.vpaidWrapperIndex,this.isMultiAdsActive&&t.className.indexOf("_cm-video-ad")<0&&(t.className="_cm-video-ad "+t.className),t}},{key:"_createAdTargetElement",value:function(t){(this.isMultiVpaidUnit||this.isMultiAdsActive)&&(m.removeClass(t,"multi-vpaids"),this.adTarget=document.createElement("div"),this.adTarget.className="_cm-ad",this.adTarget.id="_cm-css-reset",this.adTarget.appendChild(t))}},{key:"_onHandlerError",value:function(t,e){m.logToBI(this.vpaidLog,"earlyError",{errMsg:t}),this._tryFallbackFromJsToMp4()||this.loadedEvent||(this.status="error",this.stopped||(this.beacon.dispatchEvent(this.vpaidEvents.AdError,t),"adUnitLoadFailed"===e&&(m.logToBI(this.vpaidLog,"adUnitLoadFailed",{errMsg:t}),this.stop("adUnitLoadFailed",T.default.adUnitLoadFailed))))}},{key:"_onHandlerCreated",value:function(){this.stopped||(m.logToBI(this.vpaidLog,"createdVpaidHandler",{}),this._connectToVpaidHandler(),this.vpaidHandler.handshakeVersion("2.0"),m.logToBI(this.vpaidLog,"initAd",{}),this.VideoControls&&this.vpaidHandler.canvas&&this.VideoControls.setCanvas(this.vpaidHandler.canvas),this.vpaidHandler.initAd(this.config.width,this.config.height,this.config.viewMode,this.config.bitrate,{AdParameters:this.creatives.AdParameters},{slot:this.localTarget,videoSlot:this.localVideo,videoSlotControls:!!this.config.videoSlotControls,videoSlotCanAutoPlay:!!this.config.videoSlotCanAutoPlay}))}},{key:"_connectToVpaidHandler",value:function(){if(!this.stopped)for(var t in this.vpaidEvents)this.vpaidHandler.subscribe(this._handleVpaidEvents.bind(this,this.vpaidEvents[t]),this.vpaidEvents[t])}},{key:"_adLoadedHandler",value:function(t){var e=this;if(!this.stopped){if(this.adLoadedFired=!0,this.loadedEvent=this.loadedEvent+" "+t,this.readyInMS=Date.now()-this.created,this.debugTracker.info("Ad loaded now => pause it srcEvent",t),this._sendOpp(T.default.adLoaded),this.vpaidStatus.setStatus(this.vpaidStatuses.adLoaded),this.isMobile&&this.vpaidHandler.canvas&&(this.muted=!0),this.status="ready",this.isUnPaused=!0,this.store.emit("vpaidReady",this),this.asyncAdimpression=this.store.getByLineItem("asyncAdimpression",this.tag),this.asyncAdimpression){var i=this.store.getByLineItem("aaViewability",this.tag)?"unit::viewability":"unit::conversion";m.logToBI(this.vpaidLog,"asyncAdimpression",{event:i}),this.on(i,function(){m.logToBI(e.vpaidLog,"asyncAdimpressionEvent",{event:i}),e.onAsyncAdmpression()})}this.setAdVolume(this.adVolume),this.adFoundDispatched=!0,this.vpaidHandler.checkUnfriendlyIframe&&(this.isUnfriendlyIframe=this.vpaidHandler.checkUnfriendlyIframe()),this.type&&"javascript"==this.type&&this.logVpaidFamily(),this.setVpaidAnalyticsIsVideoUrlPublic&&this.setVpaidAnalyticsIsVideoUrlPublic(""!==this.getVideoUrl());var n=this.store.get("rvfrquesttsemttr");"any"!==n&&this.tag.requiredViewability!==n||this.store.emit("emitQueueStatus")}}},{key:"startAd",value:function(t){var e=this;this.adStarted=!0,this.setAdVolume(this.adVolume),this._startForceAdVolumeInterval(),this.options=Object.assign(t||{},this.store.get("getAdData")),this.isStarted=!0,this.store.incr("ads_started"),this._sendOpp(this.oppsID.startAd),this.vpaidStatus.setStatus(this.vpaidStatuses.startAd),this._dispatchToMoat("startAd"),m.logToBI(this.vpaidLog,"adOptions",{count:this.options.count,getAdRetries:this.options.getAdRetries,requiredViewability:this.options.requiredViewability},!1,!1),m.logToBI(this.vpaidLog,"startAd",{}),this.earlyAdImpression||this._waitForEvent(this.vpaidEvents.AdImpression,this.store.get("adimptmot"),this._onAdImpressionEvent.bind(this),this._onAdImpressionTimeout.bind(this)),this.isUnPaused?this.vpaidHandler.startAd():this.vpaidHandler.resumeAd(),clearTimeout(this.tillAdstartTimeout),this.working=!0,this.earlyAdImpression&&setTimeout(function(){e._onAdImpression()},500)}},{key:"_startForceAdVolumeInterval",value:function(){var t=this;if(!this.isMobile&&!this.nonVideoVpaid){var e=this.store.get("frcadvlmtrvl");if(!this.setAdVolumeInterval&&e>0){var i=this.store.get("stpfrcvlevnt")||this.vpaidEvents.AdVideoFirstQuartile;this.vpaidHandler.subscribe(function(){t._stopForceAdVolumeInterval()},i),this.setAdVolumeInterval=setInterval(function(){t.vpaidHandler&&!t.vpaidHandler.stopped?t.setAdVolume(t.adVolume):clearInterval(t.setAdVolumeInterval)},e)}}}},{key:"_stopForceAdVolumeInterval",value:function(){this.isMobile||(clearInterval(this.setAdVolumeInterval),this.setAdVolumeInterval=0)}},{key:"restartAd",value:function(){var t=this;this.isReplayable&&(this.opportunityManager.unpause(),this._sendOpp(this.oppsID.replayAd),this.opportunityManager.pause(),this.pixelManager.pause(),this.working=this.isStarted=this.adStarted=!0,this.store.incr("ads_started"),this._setClickThroughData(),this.vpaidHandler.restartAd(this.getVideoUrl(),this.clickThruUrl),setTimeout(function(){t.bringToFront()}))}},{key:"isReplayableVpaid",value:function(){return this.isVForceActive&&this.store.getByLineItem("rplvpdactv",this.tag)&&this.vpaidHandler&&this.vpaidHandler.isReplayable()}},{key:"dontDie",value:function(){this.stayAlive=!0,this.vpaidHandler&&this.vpaidHandler.dontDie&&this.vpaidHandler.dontDie(),this._killTimers()}},{key:"_handleStopped",value:function(t){this.moveToBack(),this.stop(t.type,t.oppType),this.working=!1}},{key:"pauseAd",value:function(){if(!this.stopped){var t=this._getAdSettingValue("dlypus");t?setTimeout(this._pauseAd.bind(this),t):this._pauseAd()}}},{key:"_pauseAd",value:function(){this.stopped||(this.waitForAdPausedBeforeResumeAd&&(this.isUnPaused&&(this.adPausedFired=!1),this.resumeOnAdPaused&&(this.resumeOnAdPaused=!1)),this.pauseAdStartTime=Date.now(),this.working=!1,this.vpaidHandler.pauseAd(),this._pauseAdTimeoutToCompletion(),this._pauseGlobalAdTimeout())}},{key:"resumeAd",value:function(){if(!this.stopped){var t=this._getAdSettingValue("dlyrsm");t?setTimeout(this._resumeAd.bind(this),t):this._resumeAd()}}},{key:"_resumeAd",value:function(){if(!this.stopped&&(this.isMultiAdsActive||!this.store.get("forcePause"))){if(this.waitForAdPausedBeforeResumeAd&&!this.adPausedFired)return void(this.resumeOnAdPaused=!0);this.resumeOnAdPaused=!1,this.working=!0,this.vpaidHandler.resumeAd(),this.isMultiVpaidUnit&&this.resizeAd(this.store.get("width"),this.store.get("height")),this.VideoControls&&!this.workingVpaid&&(this.VideoControls.resetAdControls(),this.isMobile&&this.store.emit("playerStatusChanged","ad")),this.store.set("ad_controls",this.store.getByLineItem("ad_controls",this.tag)!==!1),this.workingVpaid=!0,this.isVForceActive&&!this.nonVideoVpaid&&(this._setTimeoutToAdCompletion(),this._setGlobalAdTimeout(),this.vpaidHandler&&this.vpaidHandler.handleVpaidContent&&this.vpaidHandler.handleVpaidContent())}}},{key:"_setGlobalAdTimeout",value:function(){var t=this;this.globalAdTimeoutLength&&this.globalAdTimeoutLength>0&&!this.globalAdTimeout&&(this.globalAdTimeoutStartTime=Date.now(),this.globalAdTimeout=setTimeout(function(){t.stopped||t.stop("global_ad_timeout",t.oppsID.globalAdTimeout)},this.globalAdTimeoutLength))}},{key:"_pauseGlobalAdTimeout",value:function(){this.globalAdTimeout&&(this.globalAdTimeout=clearTimeout(this.globalAdTimeout),this.globalAdTimeoutLength-=Date.now()-this.globalAdTimeoutStartTime)}},{key:"_setTimeoutToAdCompletion",value:function(){var t=this;!this.timeoutToAdCompletion&&this.timeoutLengthToAdCompletion>0&&!this.newCompletionEventFired&&(this.timeoutToAdCompletionStartTime=Date.now(),this.timeoutToAdCompletion=setTimeout(function(){t.stopped||t._newCompletionHandler("timerEnded")},this.timeoutLengthToAdCompletion))}},{key:"_pauseAdTimeoutToCompletion",value:function(){this.timeoutToAdCompletion&&(this.timeoutToAdCompletion=clearTimeout(this.timeoutToAdCompletion),this.timeoutLengthToAdCompletion-=Date.now()-this.timeoutToAdCompletionStartTime)}},{key:"_fireNewCompletionEvent",value:function(t){this.newCompletionEventFired||(this.localVideo.currentTime,this._sendOpp(this.oppsID.newCompletion),this.vpaidStatus.setStatus(this.vpaidStatuses.adComplete),this.newCompletionEventFired=!0)}},{key:"getVideoUrl",value:function(){return this.videoUrl||(this.videoUrl=this.vpaidHandler.getVideoUrl?this.vpaidHandler.getVideoUrl():""),this.videoUrl}},{key:"_setVideoDataToPlayerDAST",value:function(){var t={vu:this.getVideoUrl()},e=this.localVideo;this.vpaidHandler&&this.vpaidHandler.getVPAIDVideoElement&&(e=this.vpaidHandler.getVPAIDVideoElement()||e),e&&(t.edr=e.duration,t.ewd=parseInt(e.videoWidth),t.eht=parseInt(e.videoHeight)),this.playerDAST.set(t)}},{key:"_logVideoUrlCounter",value:function(){var t=this.getVideoUrl();t||(t="na");var e=this.store.get("videoUrlsCounter")||{};e[t]=e.hasOwnProperty(t)?++e[t]:1,m.logToBI(this.vpaidLog,"videoUrlCounter",{videoUrl:t,counter:e[t]},!1,!1);var i=Object.keys(e);m.logToBI(this.vpaidLog,"sessionUniqueVideoUrls",{counter:i.length,urls:i},!0,!1),this.store.set("videoUrlsCounter",e)}},{key:"_tryFallbackFromJsToMp4",value:function(){if(this.store.getByLineItem("flbktovdo")&&"javascript"===this.type&&!this.hadImpression){if(this.fallbackToMp4)return!1;this.fallbackToMp4=!0;var t=null,e=!1;try{this.parser&&this.parser.hasMixedFiles()&&(this.vpaidHandler&&this.vpaidHandler.stopAd(),this.localVideo&&(this.localVideo.parentElement.removeChild(this.localVideo),this.localVideo=this._createLocalVideo(this.localTarget)),this._cleanIframe(),this.parser.onVideoWrapperMode(this.parser.storedMediaFiles),this.parser.publishParseTagResults("video",this.parser.storedMediaFiles,this.creatives.AdParameters,"",this.parser.duration),e=!0)}catch(e){t=e}return e}}},{key:"_dispatchToMoat",value:function(t,e){if(e!==!1)for(var i=0;i<this.moatTrackers.length;i++)this.moatTrackers[i].dispatch({type:t,adVolume:this.adVolume})}},{key:"_handleVpaidEvents",value:function(t,e){var i=this;if(this.vpaidEvents){if("javascript"===this.type&&(this.store.getByLineItem("cmpltonstpd",this.tag)||this._getAdSettingValue("cmpltonstpd")||this.vpaidHandler.completeOnAdStop)){if(t===this.vpaidEvents.AdVideoComplete)return void(this.vpaidHandler&&this.vpaidHandler.setCompletionOnAdStoppedTimeout&&this.vpaidHandler.setCompletionOnAdStoppedTimeout());t===this.vpaidEvents.AdStopped&&(t=this.vpaidEvents.AdVideoComplete)}!this.isFirstVpaidEvent&&this.vpaidHandler._getMediaUrl()&&(this.isFirstVpaidEvent=!0,m.logToBI(this.vpaidLog,"mediaUrl",{url:this.vpaidHandler._getMediaUrl()},!1,!1),this._checkIfGoogle());var n=!0;if(!this.stopped){var r=this._firePixel(t,e);switch(this.debugTracker.info("VpaidHandler-event",t),this._dispatchToMoat(t,r),this._onEvent(t),t){case this.vpaidEvents.AdLoaded:if(this._adLoadedHandler(t),this.vpaidLog.getVpaidAnalyticsReport){var s=this.vpaidLog.getVpaidAnalyticsReport();m.logToBI(this.vpaidLog,"vpaidAnalyticsUntilAdloaded",s)}this.vpaidHandler.getAdIcons&&this.vpaidHandler.getAdIcons(this._onGotAdIconsBinded);break;case this.vpaidEvents.AdImpression:if(this._setVideoDataToPlayerDAST(),n=this._onAdImpression(t),this._pushConversionDataToWaterfallLog(),this._logVideoUrlCounter(),this.earlyAdImpression)return;this.isVForceActive||(this._setTimeoutToAdCompletion(),this._setGlobalAdTimeout(),this.vpaidHandler&&this.vpaidHandler.handleVpaidContent&&this.vpaidHandler.handleVpaidContent());break;case this.vpaidEvents.AdVideoStart:this.setAdVolume(this.adVolume),this.adFoundDispatched||(this.adFoundDispatched=!0,this.beacon.dispatchEvent(this.vpaidEvents.AdFound)),this.beacon.dispatchEvent(this.vpaidEvents.AdVideoStart);break;case this.vpaidEvents.AdSkipped:this.adStoppedHandler(t),this._handleStopped({type:t,oppType:this.oppsID.adSkiped});break;case this.vpaidEvents.AdStopped:this.adStoppedHandler(t),this._handleStopped({type:t});break;case this.vpaidEvents.AdLog:this.debugTracker.info("VpaidHandler-Log",arguments);break;case this.vpaidEvents.AdError:if(this._tryFallbackFromJsToMp4())return;this.vpaidStatus.setStatus(this.vpaidStatuses.adError);var o=this.oppsID.adError;this.isAdErrorBeforeAdLoadedActive&&!this.adLoadedFired&&(o=this.oppsID.adErrorBeforeLoad),"video"===this.type?this.stop("Mp4AdError",o):this.stop("AdError",o,e);break;case this.vpaidEvents.SoundViolation:this.store.get("sndvltopp")&&!this.alreadySentSoundViolation&&(this.alreadySentSoundViolation=!0,this._sendOpp(this.oppsID.soundViolation));break;case this.vpaidEvents.AdPaused:this.pauseAdStartTime=void 0,this.adPausedFired=!0,this.waitForAdPausedBeforeResumeAd&&this.resumeOnAdPaused&&this.resumeAd();case this.vpaidEvents.AdClickThru:e=this._adClickThroughData(e),this.isUnPaused=!1,this._pauseAdTimeoutToCompletion(),this._pauseGlobalAdTimeout();break;case this.vpaidEvents.AdPlaying:this._setTimeoutToAdCompletion(),this._setGlobalAdTimeout(),this._fireAdPlaying();case this.vpaidEvents.AdStarted:case this.vpaidEvents.AdVideoStart:this.isUnPaused=!0;break;case this.vpaidEvents.AdVideoFirstQuartile:this.beacon.dispatchEvent(t);break;case this.vpaidEvents.AdVolumeChange:this.isMobile&&e&&e.eventData&&e.eventData.volume&&(this.adVolume=m.normalizeVolume(e.eventData.volume));break;default:this.beacon.dispatchEvent(t)}this.emit(t,{type:t,data:e});var a=this.nonVideoVpaid?0:this.localVideo.currentTime,d=["AdDurationChange","AdSizeChange","AdLinearChange","AdLog","AdSkippableStateChange","AdExpandedChange","AdInteraction","AdUserClose","AdSkipped","Progress","AdVolumeChange"];if(d.indexOf(t)===-1&&m.logToBI(this.vpaidLog,"event_"+t,{isViewable:!document.hidden,vidCurrentime:a,eventDataStr:e?m.stringify(e.eventData):null}),r&&this.vpaidEventToPixelId.hasOwnProperty(t)&&this.hadImpression&&this._sendOpp(this.vpaidEventToPixelId[t]),this.vpaidEvents)if(t===this.vpaidEvents.AdClickThru)this.clickThruUrl=e&&e.eventData?e.eventData.url:"",this.clickThoughHandler.invokeClick(e.eventData);else if(t==this.vpaidEvents.AdVideoComplete){if(this._newCompletionHandler(this.vpaidEvents.AdVideoComplete,r),this.stayAlive)return this.globalAdTimeout&&(this.globalAdTimeout=clearTimeout(this.globalAdTimeout)),void this.emit("end");this.vpaidHandler.stopAd(),setTimeout(function(){i.working=!1,i.workingVpaid=!1,i.stop("AdVideoComplete"),i.status="stopped"},2)}this.manager&&n&&this.manager.trigger(t,this,e?e.eventData:null)}}}},{key:"_onGotAdIcons",value:function(t,e){m.logToBI(this.vpaidLog,"ad_choices",{vpaid:{error:t,result:e}},!1,!1)}},{key:"_newCompletionHandler",value:function(t,e){if(!this.newCompletionEventFired&&(this.timeoutToAdCompletion||this.fireNewCompletionPixel)){if(this.timeoutToAdCompletion=clearTimeout(this.timeoutToAdCompletion),this._validateNewCompletionFiring(t,e))return void this._fireNewCompletionEvent(t);m.logToBI(this.vpaidLog,"fireNewCompletionPrevented",{reason:t},!1,!1)}}},{key:"_validateNewCompletionFiring",value:function(t,e){return t===this.vpaidEvents.AdVideoComplete?e&&this.opportunityManager.alreadySent(this.tag,this.oppsID.videoComplete):"timerEnded"===t&&this.opportunityManager.alreadySent(this.tag,this.oppsID.videoFirstQuartile)}},{key:"_setClickThroughData",value:function(){this.clickThruUrl=this.clickThruUrl||this.pixelManager.getClickThruUrl()}},{key:"_adClickThroughData",value:function(t){if(t&&t.eventData&&t.eventData.url)return t;var e=this.pixelManager.getClickThruUrl();if(e){var i={url:e};t?t.eventData=Object.assign(t.eventData||{},i):t={eventData:i}}return t}},{key:"_checkIfGoogle",value:function(){var t=this.localTarget.querySelector("iframe");if(t){var e=m.domIframeIterator(t,this.store.get("debug"));for(this.isGoogleIframe=!1;!this.isGoogleIframe&&e.hasNext();)this._isGoogleIframe(e.current)&&(this.isGoogleIframe=!0)}}},{key:"_isGoogleIframe",value:function(t){return t&&t.src.indexOf("imasdk.googleapis.com")>-1&&t.src.indexOf("bridge")>-1}},{key:"_onAdImpression",value:function(){var t=!0,e=this.store.get("rstmrai");if(this.fireViewTracking&&this.fireViewTracking(),e&&this._killTimers(),!this.adStarted&&this.handelsEarlyAI)return this.earlyAdImpression=!0,this.pauseAd(),this.isUnPaused=!1,m.logToBI(this.vpaidLog,"earlyAdImpression",{early:!0}),clearTimeout(this.tillAdstartTimeout),this._fireAdImpression(),!1;if(this.hadImpression)t=!1;else{var i=this.store.get("conversionsCount")+1;this.store.set("conversionsCount",i),m.logToBI(this.vpaidLog,"success",{count:i},!0,!1),this.setAdVolume(this.adVolume),this.beacon.dispatchEvent(this.vpaidEvents.AdImpression),this._fireAdImpression(),this.adImpInMS=Date.now()-this.created,this.hadImpression=!0,this._wfStats.increaseSuccess(),this.vpaidHandler&&this.vpaidHandler.logVideoUrl&&this.vpaidHandler.logVideoUrl(),this.isReplayable=this.isReplayableVpaid(),m.logToBI(this.vpaidLog,"restartAd",{isReplayable:this.isReplayable},!1,!1),this.playerDAST.onImpression()}return this.earlyAdImpression&&this.manager&&this.manager.trigger("AdImpression",this,null),t}},{key:"_firePixel",value:function(t,e){return!!("AdVideoComplete"===t&&!this.hadImpression||t===this.vpaidEvents.AdImpression&&this.hadImpression||this.asyncAdimpression)||this.pixelManager.firePixel(t,this.vpaidLog,e)}},{key:"_fireAdImpression",value:function(t){this.adimpFired||(this.asyncAdimpression&&!t||(m.logToBI(this.vpaidLog,"fireAsyncAdimpression",{end:!0}),this._sendOpp(this.oppsID.tagImpression),this.pixelManager.firePixel(this.vpaidEvents.AdImpression,this.vpaidLog),this.adimpFired=!0),this.vpaidStatus.setStatus(this.vpaidStatuses.adImpression))}},{key:"_fireAdPlaying",value:function(){!this.adPlayingFired&&this.hadImpression&&this.workingVpaid&&(this.adPlayingFired=!0,this._sendOpp(this.oppsID.adPlaying),this.vpaidStatus.setStatus(this.vpaidStatuses.adPlay))}},{key:"onAsyncAdmpression",value:function(){m.logToBI(this.vpaidLog,"fireAsyncAdimpression",{start:!0}),this._fireAdImpression(!0)}},{key:"adStoppedHandler",value:function(t){var e=this;this.stop(),setTimeout(function(){e._cleanVpaid()},1e4)}},{key:"_setAdVolume",value:function(t,e){this.stopped||this.nonVideoVpaid||(t=m.normalizeVolume(t),this.adVolume=t,this.shouldMuteVid&&(this.localVideo.volume=t,this.localVideo.muted=0===t),this.adVolume>0&&this.setAdVolumeInterval&&this._stopForceAdVolumeInterval(),this.store.get("frcmtfrms")&&this._setVolumeInIframes(this.localTarget.getElementsByTagName("iframe"),t),this.vpaidHandler&&(this.vpaidHandler.setAdVolume(t,e),this.vpaidHandler.callIMAApi&&this.vpaidHandler.callIMAApi("volume",t)))}},{key:"_setVolumeInIframes",value:function(t,e){var i=this;m.DOMIterator(t[0],"iframe",function(t){t.forEach(function(t){i._overideVolumeInIframe(t),t.setAttribute("tbvol",e),t.volume=e,i.shouldMuteVid&&(t.muted=0===e)})},"video",this.store.get("debug"))}},{key:"_overideVolumeInIframe",value:function(t){if(!t||!t.sv){var e=this;t.sv=!0,t.addEventListener("volumechange",function(){t.volume!==parseFloat(this.getAttribute("tbvol"))?(t.volume=0,e.beacon.dispatchEvent(e.vpaidEvents.SoundViolation,{})):t.volume=e.adVolume})}}},{key:"_onParserError",value:function(t){this.stopped||(this.status="error",this.error=t.type||"",this.isPlaying=!1,m.logToBI(this.vpaidLog,"AdError",{errType:t.type,handlerType:t.handlerType,isPraserError:!0}),this.stop(this.error,t.oppsId))}},{key:"_onNetworkError",value:function(t){this.stopped||(this.status="error",this.error=t?"xhrStatuses_"+t:"",this.isPlaying=!1,this.stop(this.error,T.default.networkError))}},{key:"_updateAdVideoDurationOnVideoControls",value:function(t){this.VideoControls&&this.VideoControls.setState({vidDuration:t,vidCurrentTime:0})}},{key:"_registerAnalytics",value:function(t,e,i){var n=this,r=this.store.get("analyticsFuncString");if(r)try{var s=this.store.get("anltcsOptions");this.maxNetworkCalls&&(s.maxNetworkCalls=this.maxNetworkCalls),this.iframesWeights&&(s.iframesWeights=this.iframesWeights),m.injectResource(t.contentWindow,r,function(t){m.logToBI(n.vpaidLog,"vpaidAnalyticsInject",{success:!t,ex:t?t.message:void 0})}),s.deepIframes&&(t.contentWindow.AnalyticsReporter.prototype.vpaidAnalyticsFunc=r),s.hideCountdown&&(t.contentWindow.AnalyticsReporter.prototype._onHideCountdown=function(){m.logToBI(n.vpaidLog,"hideCountdown",{analytics:!0})});var o=this.store.get("stpvpdonudfndsrc");return t.contentWindow.AnalyticsReporter.prototype._onUndefinedRelativeIframeSrcError=function(t){m.logToBI(n.vpaidLog,"undefinedRelativeIframeSrcError",{url:t}),o&&n.stop("undefinedIframeSrc",T.default.networkError)},new t.contentWindow.AnalyticsReporter(e||this.vpaidHandler,i||function(){},s),t.contentWindow.setIsVideoUrlPublic&&(this.setVpaidAnalyticsIsVideoUrlPublic=t.contentWindow.setIsVideoUrlPublic),this.vpaidLog.getVpaidAnalyticsReport=t.contentWindow.getVpaidAnalyticsReport,t.contentWindow.onNetworkCallsLimitExceeded=function(){n.stopped||(m.logToBI(n.vpaidLog,"vpaidAnalyticsCallLimit",{adImpression:n.adimpFired,limitExceeded:!0,maxNetworkCalls:n.maxNetworkCalls}),n.adimpFired||n.stop("networkCallsLimitExceeded",T.default.maxNetworkCalls))},m.logToBI(this.vpaidLog,"vpaidAnalyticsEval",{success:!0,maxNetworkCalls:this.maxNetworkCalls,vaVersion:this.latestVpaidAnalytics}),!0}catch(t){m.logToBI(this.vpaidLog,"vpaidAnalyticsEval",{success:!1,ex:t},!0)}return!1}},{key:"_getMediaType",value:function(){return"video"===this.type?1:"javascript"===this.type?2:"adx"===this.type?5:void 0}},{key:"_createHandler",value:function(t){if(!this.stopped)return this.nonVideoVpaid||(this.vpaidLog.setVastWrapperCount(this.parser.wrappersCount),this._setTimers(),this.creatives.AdParameters=t.handlerOptions.adParams,t.handlerOptions.adSettings=this._getAdSettings()),this.vpaidHandler=this.vpaidHandlersFactory.create(t.type,t.handlerOptions),this.vpaidHandler?void(this.nonVideoVpaid||(this.type=t.type,this.tag.vpaidWrapperData.mediatype=this._getMediaType(),this.debugTracker.info("ParserResponded["+this.type+"-"+(this.isMobile?"mob":"desk")+"]",t.handlerOptions.vpaidFiles),this.pixelManager.loadPixelData(t.handlerOptions.trackingPixels),this._setClickThroughData(),this._updateAdVideoDurationOnVideoControls(t.handlerOptions.extra.duration),this.vpaidHandler.removeClickableTarget(),this.vpaidHandler._onHijackAttempt=this.hijackAttempt.bind(this),this._createMoatTracker())):void this._onParserError({type:"handlerCreatingFail",handlerType:t.type,oppsId:this.oppsID.mediaFileNotSupported})}},{key:"_createMoatTracker",value:function(t){var e=this.moatTrackersCreativeExtensions||[];this.tag.moatSampling&&e.push(void 0);for(var i=0;i<e.length;i++)this.moatTrackers.push(new P.default({moatTag:e[i],container:this.vpaidHandler.getDOMContainer(),tag:this.tag,moatPartnerCode:this.store.getByLineItem("moatPartnerCode",this.tag),duration:this.vpaidHandler.getAdDuration(),url:this.vpaidHandler.mediaFiles[0].url,store:this.store,vpaidLog:this.vpaidLog}));this._extractWinningPrice()}},{key:"_getAdSettings",value:function(t){return this.adSettings=this.store.getByAdInline(this.playerDAST.getWrappers())||{},Object.keys(this.adSettings).length>0&&m.logToBI(this.vpaidLog,"adSettings",this.adSettings,!0,!1),this.adSettings}},{key:"_cleanIframe",value:function(){var t=this.localTarget.querySelectorAll("iframe");this._clearIframe(t&&t.length?t[0]:null)}},{key:"_cleanVpaid",value:function(){if(!(this.clean||this.stayAlive&&this.isReplayable)){this.clean=!0,this.vpaidLog&&(this.vpaidLog.saveToDb(),this.vpaidLog.getVpaidAnalyticsReport=void 0),this.wflog&&(this.wflog.complete(),this.wflog=void 0),this.pixelManager&&this.pixelManager.destroy(),this.beacon&&(this.beacon.listEvents(),this.beacon.destroy()),this.localTarget&&(this.localVideo&&this.localVideo.parentElement&&this.localTarget.removeChild(this.localVideo),this._cleanIframe(),this.localTarget.parentNode.removeChild(this.localTarget)),this.adTarget&&this.adTarget.parentNode&&this.adTarget.parentNode.removeChild(this.adTarget),
this.timeoutToAdCompletion=clearTimeout(this.timeoutToAdCompletion),this.globalAdTimeout=clearTimeout(this.globalAdTimeout),this._killTimers(),this.nonVideoVpaid||this.parser.destroy(),this.vpaidHandler&&(this.vpaidHandler._onHijackAttempt=null);for(var t=0;t<this.moatTrackers.length;t++)this.moatTrackers[t].dispose();this.creativeExtensionsHandler&&(this.creativeExtensionsHandler.removeEventListener("externalMoat",this.pushExternalMoatTracker),this.creativeExtensionsHandler.destroy()),this.status="stopped",this.working=!1,this.VideoControls&&this.VideoControls.destroy(),this.playerDAST&&this.playerDAST.destroy(),this.vpaidHandlersFactory&&this.vpaidHandlersFactory.destroy(),this.store&&(this._bindedOnAdLoadVideoThrottleDelayEnd&&(this.store.removeListener(this.onThrottleEndEventName,this._bindedOnAdLoadVideoThrottleDelayEnd),this._bindedOnAdLoadVideoThrottleDelayEnd=void 0),this._bindedOnRemovedFromVideoThrottleListeners&&(this.store.removeListener(this.onRemovedFromThrottleListenersEventName,this._bindedOnRemovedFromVideoThrottleListeners),this._bindedOnRemovedFromVideoThrottleListeners=void 0)),this.creatives=this.vpaidLog=this.parser=this.debugTracker=this.manager=this.tag=this.vast=this.beacon=this.pixelManager=this.config=this.vpaidEvents=this.localTarget=this.vpaidHandler=this.store=this._wfStats=this.localVideo=this.VideoControls=this.adSettings=this.creativeExtensionsHandler=this.moatTrackers=this.moatTrackersCreativeExtensions=void 0,this.isPlaying=!1,window.setTimeout(this.onAfterStop,0),this.emit("vpaidCleaned")}}},{key:"_clearIframe",value:function(t){t&&(m.DOMIterator(t,"iframe",function(t){var e=cmTag.$;t.forEach(function(t){e(t).remove()})},"*",this.store.get("debug")),t&&t.parentNode.removeChild(t))}},{key:"bringToFront",value:function(){if(this.localTarget&&!this.blockBringToFront){var t=this.store.get("height");this.localTarget.style.display="block",this.localTarget.style.height=t+"px";var e=X++ +99;this.localTarget.style.zIndex=e,this.clickableTarget&&(this.clickableTarget.style.zIndex=e),this.vpaidHandler&&(this.vpaidHandler.zIndex=e),this.VideoControls&&this.VideoControls.setState({isVisible:!0}),this.toggleIframeContentDisplay("hide")}}},{key:"moveToBack",value:function(){this.localTarget&&(this.localTarget.style.zIndex=0,this.clickableTarget&&(this.clickableTarget.style.zIndex=0))}},{key:"subscribe",value:function(t,e){this.stopped||this.vpaidEvents[e]&&this.beacon.addEventListener(e,t)}},{key:"unsubscribe",value:function(t,e){this.vpaidEvents&&this.vpaidEvents[e]&&this.beacon.removeEventListener(e,t)}},{key:"stop",value:function(t,e,i){var n=this;if(!("global_ad_timeout"!==t&&"undefinedIframeSrc"!==t&&this.stayAlive&&this.isReplayable||this.stopped)){if(this.opportunityManager.isRegisterAvailable("unloadCallbacks",this.unloadCallback,!1),t&&"hijackAttempt"!==t&&(i&&i.eventData?m.logToBI(this.vpaidLog,t,{eventDataStr:m.stringify(i.eventData),status:this.status}):m.logToBI(this.vpaidLog,t,{status:this.status})),this._stopForceAdVolumeInterval(),!this.hadImpression){var r=this.store.get("failsCount")+1;this.store.set("failsCount",r),m.logToBI(this.vpaidLog,"fails",{count:r},!0,!1)}this._wfStats&&(this.hadImpression||this._wfStats.increaseFailure(),m.logToBI(this.vpaidLog,"wfStats",{data:this._wfStats.getData()},!1,!1)),this.isStarted&&this.store.decr("ads_started"),this.stopReason=t,this.oldStatus+=this.status,this.isPlaying=!1,void 0!==e&&this._sendOpp(e),"playerClosed"===t&&this.hadImpression&&this.pixelManager.firePixel("close",this.vpaidLog,{}),this.stopped=!0,this.vpaidHandler&&(this.vpaidHandler.onAfterStop=this._cleanVpaid.bind(this),this.vpaidHandler.stopAd()),this.emit("end"),this.store.emit("vpaidEnded",this),setTimeout(function(){n._cleanVpaid()},2),"global_ad_timeout"===t&&(this.isReplayable=!1,this.isVForceActive||this.store.emit("hideAdPlayer"))}}},{key:"callVpaidMethod",value:function(t,e,i){if(!this.stopped){if(this.vpaidHandler&&this.vpaidHandler.callIMAApi&&("pauseAd"!=t&&"resumeAd"!=t||this.vpaidHandler.callIMAApi(t)),"resizeAd"!==t&&m.logToBI(this.vpaidLog,"vpaidApi_"+t,{}),"setAdVolume"==t&&(this.adVolume=m.normalizeVolume(e[0])),"pauseAd"==t&&(this.isUnPaused=!1),"resizeAd"==t&&this._resizeContainers(e[0],e[1],e[2]),!this.vpaidHandler||!this.vpaidHandler[t])return i;try{return this.vpaidHandler[t].apply(this.vpaidHandler,e)}catch(t){return i}}}},{key:"_resizeContainers",value:function(t,e,i){this.localVideo.style.width=t+"px",this.localVideo.style.height=e+"px",this.localVideo.setAttribute("width",t),this.localVideo.setAttribute("height",e),this.localTarget.style.width=t+"px",this.localTarget.style.height=e+"px",this.localTarget.setAttribute("width",t),this.localTarget.setAttribute("height",e)}},{key:"onAfterStop",value:function(){}},{key:"hijackAttempt",value:function(t,e){if(!this.hijackFired){this.hijackFired=!0,(new Image).src="//convusmp.basebanner.com/st?cijs=0&ttype=5&pix=31542217&dast="+this.tag.dast+"&"+(new Date).getTime(),m.logToBI(this.vpaidLog,"hijackAttempt",{badUrl:t,earlyHijack:!!e&&e},!1,!1);var i=this.store.get("hjkstp")!==!1;i&&this.stop("hijackAttempt",T.default.hijackAttempt)}}},{key:"fire99",value:function(){this._sendOpp(this.oppsID.firstImpression)}},{key:"_onEvent",value:function(t,e){if(this.pendingEvents&&this.pendingEvents.hasOwnProperty(t)){var i=this.pendingEvents[t];i.timeoutId!=-1&&clearTimeout(i.timeoutId),i.cb&&"function"==typeof i.cb&&i.cb(e),delete this.pendingEvents[t]}}},{key:"_waitForEvent",value:function(t,e,i,n){var r=function(){},s=-1,o=this;e>0&&n&&"function"==typeof n&&(s=setTimeout(function(){m.logToBI(this.vpaidLog,"vpaidTimeout_"+t,{}),n(),delete o.pendingEvents[t],s=null,i=r,n=r}.bind(this),e)),this.pendingEvents||(this.pendingEvents={}),this.pendingEvents[t]={cb:i,timeoutId:s}}},{key:"_onAdLoadedTimeout",value:function(){this.error="adloadedTimeout",this.stop(this.error,this.oppsID.adloadedTimeout)}},{key:"_onAdLoadedEvent",value:function(){}},{key:"_onAdImpressionTimeout",value:function(){this.error="adImpressionTimeout",this.stop(this.error)}},{key:"_onAdImpressionEvent",value:function(){}},{key:"setVastPrice",value:function(t){this.tag.vpaidWrapperData.vastPrice=t,t>0&&m.logToBI(this.vpaidLog,"vastPrice",{value:t})}},{key:"setVastType",value:function(t){this.tag.vpaidWrapperData.vastType=t}},{key:"setExternalScripts",value:function(t){0!==t.length&&(this.pushExternalMoatTracker=this._pushExternalMoatTracker.bind(this),this.creativeExtensionsHandler=new z.default(t,this.localTarget,this.vpaidLog),this.creativeExtensionsHandler.on("externalMoat",this.pushExternalMoatTracker),this.creativeExtensionsHandler.handleExternalScripts())}},{key:"_pushExternalMoatTracker",value:function(t){this.moatTrackersCreativeExtensions=this.moatTrackersCreativeExtensions||[],this.moatTrackersCreativeExtensions.push(t)}},{key:"setVastIcons",value:function(t){var e=this.store.getByLineItem("fkadchcs",this.tag);e?(this.hasAdChoices=!0,m.logToBI(this.vpaidLog,"ad_choices",{fakeAdChoices:!0})):(this.tag.vpaidWrapperData.icons=t,this.hasAdChoices=t.length,this.hasAdChoices&&this._addAdChoiceDiv(t))}},{key:"_addAdChoiceDiv",value:function(t){var e=!0,i=!1,n=void 0;try{for(var r,s=t[Symbol.iterator]();!(e=(r=s.next()).done);e=!0){var o=r.value;if(o.attributes.program&&this.iconsPrograms.indexOf(o.attributes.program)===-1){this.iconsPrograms.push(o.attributes.program);var a=document.createElement("div");a.className="_cm-ad-choices-player",a.style.zIndex=1,o.attributes.xPosition&&(a.style.left="initial",a.style[o.attributes.xPosition]="13px"),o.attributes.yPosition&&(a.style.top="initial",a.style[o.attributes.yPosition]="16px");var d=document.createElement("a");if(o.clickThroughUrl&&(d.href=o.clickThroughUrl),d.onclick=this._appendOnClick(o),d.target="_blank",d.className="_cm-ad-choices-player-anchor",d.style.width=o.attributes.width||"19px",d.style.height=o.attributes.height||"15px",o.staticresource?d.style.background="#fff url("+o.staticresource+") no-repeat center center":o.htmlresource&&(d.innerHTML+=o.htmlresource),o.iconViewTracking.length){var l=o.iconViewTracking;this.fireViewTracking=function(){setTimeout(function(t){var e=!0,i=!1,n=void 0;try{for(var r,s=t[Symbol.iterator]();!(e=(r=s.next()).done);e=!0){var o=r.value;(new Image).src=o}}catch(t){i=!0,n=t}finally{try{!e&&s.return&&s.return()}finally{if(i)throw n}}},5e3,l)}}a.appendChild(d),this.localVideo.parentElement.appendChild(a)}}}catch(t){i=!0,n=t}finally{try{!e&&s.return&&s.return()}finally{if(i)throw n}}}},{key:"_appendOnClick",value:function(t){return function(){var e=!0,i=!1,n=void 0;try{for(var r,s=t.clickTracking[Symbol.iterator]();!(e=(r=s.next()).done);e=!0){var o=r.value;(new Image).src=o}}catch(t){i=!0,n=t}finally{try{!e&&s.return&&s.return()}finally{if(i)throw n}}}}},{key:"_copyFromStoreToBi",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.store.get(t)&&m.logToBI(this.vpaidLog,t,this.store.get(t),!1,e)}},{key:"_handleDataSaver",value:function(){this.isMobile&&!this.vpaidHandler.canvas&&this.store.get("dataSaverDetected")&&(this.isUnPaused=!1,m.logToBI(this.vpaidLog,"dataSaverDetected",{value:!0}))}},{key:"mute",value:function(){this.vpaidHandler.canvas&&this.adVolume>0&&this.vpaidHandler.canvas.muteButtonClick(),this.adVolume=0,this.VideoControls&&this.VideoControls.setState({isMuted:!0})}},{key:"unmute",value:function(){if(this.vpaidHandler.canvas&&0===this.adVolume&&this.vpaidHandler.canvas.muteButtonClick(),this.adVolume=m.normalizeVolume(this.store.get("dfltvlm")),this.VideoControls){if(this.store.get("forceMute"))return void(this.adVolume=0);this.VideoControls.setState({isMuted:!1}),this.adVolume=m.normalizeVolume(this.VideoControls.getValueFromControlsState("volume"))}}},{key:"updateStatusesOnGetAd",value:function(t){m.logToBI(this.vpaidLog,"statusesOnGetAd",{status:this.status,hadImpression:!!this.hadImpression,isStarted:!!this.isStarted,requiredViewability:t.requiredViewability})}},{key:"logVpaidFamily",value:function(){var t=[],e=[];if(this.vpaidHandler.adUnit._iframe&&this.vpaidHandler.adUnit._iframe.contentWindow)for(var i=this.vpaidHandler.adUnit._iframe.contentWindow.document.scripts,n=0;n<i.length;n++)if(i[n].src.indexOf("z.moatads.com")>-1&&i[n].src.split("/").length>4&&t.push(i[n].src.split("/")[3]),i[n].src.indexOf("sc.iasds01.com")>-1){var r=i[n].src.match(/EntityId=([^&]*)/);2===r.length&&e.push("ias-"+r[1])}var s=""+this.tag.dp+(t.length>0?t.join("_"):"")+(e.length>0?e.join("_"):"")+(this.isGoogleIframe?"_ggl":"")+(this.isUnfriendlyIframe?"_ui":"");s!==this.tag.dp&&m.logToBI(this.vpaidLog,"vpaidFamily",{family:s})}},{key:"resizeAd",value:function(t,e,i){if(!this.stopped)try{(void 0==t||isNaN(parseInt(t)))&&(t=!1),(void 0==e||isNaN(parseInt(e)))&&(e=!1);var n=0,r=0;if(!t&&!e)return void this.debugTracker.error("resize","No `height` or `width` specified!");if(e&&t)r=this._convertSizeFromNumberToPixels(e),n=this._convertSizeFromNumberToPixels(t);else{var s;i=i&&i.split(":").length>1?i:this.store.get("playerAspectRatio"),i=i.split(":"),t?(s=parseInt(fullAspectRatio[1])/parseInt(fullAspectRatio[0]),n=this._convertSizeFromNumberToPixels(t),r=this._convertSizeFromNumberToPixels(Math.floor(parseFloat(n)*s))):(s=parseInt(fullAspectRatio[0])/parseInt(fullAspectRatio[1]),r=this._convertSizeFromNumberToPixels(e),n=this._convertSizeFromNumberToPixels(Math.floor(parseFloat(r)*s)))}if(n&&r){var o=parseFloat(n),a=parseFloat(r);this.localTarget.style.width=n,this.localTarget.style.height=r,this.localTarget.setAttribute("width",o),this.localTarget.setAttribute("height",a),this.nonVideoVpaid||(this.localVideo.style.width=n,this.localVideo.style.height=r,this.localVideo.setAttribute("width",o),this.localVideo.setAttribute("height",a)),this.isMultiAdsActive&&(this.store.set("width",o.toString()),this.store.set("height",a.toString()),this.store.emit("resizeVpaidWrapper",{width:o,height:a}),this.vpaidHandler.resizeAd(o,a,this.config.viewMode||"normal"))}this.blockBringToFront&&(this.blockBringToFront=!1,this.bringToFront())}catch(t){this.debugTracker.error("resize","Resizing component failed!")}}},{key:"_convertSizeFromNumberToPixels",value:function(t){var e=t+"";return e.search(/px$/g)<0&&(e+="px"),e}},{key:"getCurrentVolume",value:function(){return this.VideoControls?this.VideoControls.getValueFromControlsState("volume"):this.adVolume}},{key:"_onSoundChange",value:function(t){this.vpaidHandler&&this.vpaidHandler.onMuteChanged&&this.vpaidHandler.onMuteChanged(t)}},{key:"_pushConversionDataToWaterfallLog",value:function(){if(this.wflog){var t=this.getVideoUrl();if(t){var e=this.store.get("wfLogUniqueVideoUrls_"+this.wflog.index)||[];e.indexOf(t)<0&&(e.push(t),this.wflog.push("uniqueVideoUrlsCounter",e.length),this.store.set("wfLogUniqueVideoUrls_"+this.wflog.index,e))}this.wflog.push("wfConversionsCounter",this.wflog.get("wfConversionsCounter",0)+1),this.wflog.sendDataOnConversion()}}},{key:"_pushUniqueAdvIdsToWaterfallLog",value:function(){if(this.wflog){var t=this.store.get("wfLogUniqueAdvIds_"+this.wflog.index)||[];t.indexOf(this.tag.advId)<0&&(t.push(this.tag.advId),this.wflog.push("uniqueAdvIdsCounter",t.length),this.store.set("wfLogUniqueAdvIds_"+this.wflog.index,t))}}},{key:"_appendVpaidCSS",value:function(){var t=this.store.getByLineItem("vpdcss",this.tag),e=[];if(void 0!==t){for(var i in t){var n=null;if(n=this.localTarget.className.indexOf(i)>-1?this.localTarget:this.localTarget.querySelectorAll(i)[0])for(var r in t[i])n.style[r]=t[i][r];else e.push("No element matching "+i)}m.logToBI(this.vpaidLog,"appendVpaidCSS",{success:0===e.length,style:m.stringify(t),errors:e.join(",")})}}},{key:"toggleIframeContentDisplay",value:function(t){this.isMultiVpaidUnit&&this.toggleIframeContentDisplayActive&&this.vpaidHandler.toggleIframeContentDisplay&&this.vpaidHandler.toggleIframeContentDisplay(t)}},{key:"_sendOpp",value:function(t){!this.stopped&&this.opportunityManager&&this.opportunityManager.send(this.tag,t,this.playerDAST.get(),this.localVideo?this.localVideo.currentTime:void 0)}},{key:"getAdDuration",value:function(){var t=this;isNaN(this.localVideo.duration)?this.vpaidHandler&&this.vpaidHandler.getAdDuration(function(e,i){t._setVideoControlsDuration(i)}):this._setVideoControlsDuration(this.localVideo.duration)}},{key:"_setVideoControlsDuration",value:function(t){this.VideoControls&&this.VideoControls.setState({vidDuration:t})}},{key:"registerToVPAIDVideoTimeupdateEvent",value:function(){var t=this;if(this.vpaidHandler&&this.vpaidHandler.getVPAIDVideoElement){var e=this.vpaidHandler.getVPAIDVideoElement();null!==e&&e.addEventListener("timeupdate",function(i){t._onTimeupdate(e)})}}},{key:"_onTimeupdate",value:function(t){this.workingVpaid&&t.currentTime>0&&this.VideoControls&&this.VideoControls.setState({preventAdTicker:!0,vidDuration:t.duration,vidCurrentTime:t.currentTime})}},{key:"_onSwitchFromCanvasToVideo",value:function(t){var e=this;t&&t.addEventListener("timeupdate",function(i){e._onTimeupdate(t)})}},{key:"getVpaidStatus",value:function(){return this.vpaidStatus.get()}},{key:"_sendFirstUnmuteOpp",value:function(){this._sendOpp(this.oppsID.adUnmuted)}},{key:"getPrice",value:function(){var t=this.tag.vpaidWrapperData&&this.tag.vpaidWrapperData.vastPrice?this.tag.vpaidWrapperData.vastPrice:this.tag.price;return t||void 0!==this.defaultTagPrice?m.encodeText(t):""}},{key:"_getAdSettingValue",value:function(t){return this.adSettings&&this.adSettings.hasOwnProperty(t)?this.adSettings[t]:void 0}},{key:"_extractWinningPrice",value:function(){if(this._getAdSettingValue("extwnprc")){var t=this._getAdSettingValue("wnprcfld"),e=this._getAdSettingValue("blkemptywp"),i=this.pixelManager.extractWinningPrice(t,e);i&&(m.logToBI(this.vpaidLog,"winningPrice",i,!1,!1),this.playerDAST.set({wp:i}))}}},{key:"getVpaidData",value:function(){return this.stopped?{}:{adjacency:this.tag.adjacencyAd,singleAd:this.tag.singleAd,rv:this.tag.requiredViewability,replayable:this.isReplayable}}}]),e}(C.EventEmitter);e.default=Y},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(3),d=r(a),l=i(7),u=r(l),h=i(1),c=n(h),p=i(13),f=(r(p),i(67)),v=r(f),m=i(66),g=r(m),y=i(18),_=r(y),b=i(14),w=r(b),A=-1,k=1,T=function(){function t(e){var i=this;s(this,t),this.store=e,this.store.set("waterfallFailsInARow",0),this.store.set("waterfallSuccessesInARow",0),this.store.set("waterfallIndex",k),this.encryptWaterfallResponse=this.store.get("encwfrs"),this.wfv=this.store.get("wfv"),this.requiredViewabilityFactor=this.store.get("rvfctr"),this.dynamicNoaopMaxValue=this.store.get("dnapmxvl"),this.retryOnFail=this.store.get("rtryonfl"),this.defaultTagPrice=this.store.get("dftgprc"),this.queueSize=this.store.get("queue_size")||10,this.wfSequences=[];var n=this.store.get("drpbletps")||[];this.adsToDrop={};for(var r=0;r<n.length;r++)this.adsToDrop[n[r]]=!1;this.mimeEnum=[{id:5,mime:"application/javascript",video:!1},{id:8,mime:"video/x-ms-wmv",video:!0},{id:10,mime:"video/mp4",video:!0},{id:11,mime:"video/ogg",video:!0},{id:12,mime:"video/webm",video:!0}],this.creatives={},this.debugTracker=new d.default("WaterfallManager"),this.cachedTags=!1,this.cacheAge=0,this.staticWf=this.store.get("static_schedule"),this.shouldRun=function(){return!0},this._runBindedWaterfallTicker=this._runWaterfallTicker.bind(this),this._roundTripAverageDuration=0,this._roundTripsCount=0,this._initDynamicWfsValues(),this.store.get("wf_manual")||this.startNextWfTimeout(),this.store.on("stop",this._stop.bind(this)),this.store.on("pausePlayer",this._stop.bind(this)),this.store.on("queueStatusChanged",this._onQueueStatusChanged.bind(this));var o=this.store.get("wf_dynmc_ps");o&&(this.store.on("contentPaused",this._stop.bind(this)),this.store.on("contentResumed",this.startNextWfTimeout.bind(this))),this.isFirstRun=!0,this.igonreWfWhenHidden=this.store.get("ignrwfhdn"),this.lineitemMaxFails=this.store.get("mxlifls"),this._registerQueueEvent(),this.maxAllowedEmptyWaterfalls=this.store.get("mxemptwf"),this.store.set("emptyWaterfallsInARow",0),this.supportNonVideoVpaid=this.store.get("sprtnnvidvpd")&&this.store.get("mltads"),this.store.on("startWf",function(){i.store.set("dlywf",!1),i.runWaterfall("startWf")})}return o(t,[{key:"_shouldDelayWaterfall",value:function(){return this.store.get("dlywf")}},{key:"startNextWfTimeout",value:function(){var t=this;this.wfInterval&&clearTimeout(this.wfInterval),this._calcDynamicWfsValues(),this._delayBetweenWfs>0?this.wfInterval=setTimeout(function(){t._runBindedWaterfallTicker()},this._delayBetweenWfs):this.store.emit("closePlayer")}},{key:"_initDynamicWfsValues",value:function(){this.maxTimeBetweenWaterfalls=this.store.get("mxtmbtwfs"),this.minTimeBetweenWaterfalls=this.store.get("mntmbtwfs"),this.defaultTimeBetweenWaterfalls=this.store.get("time_between_waterfall"),this.timeBetweenWfFunc=this.store.get("tmbtwfs"),"function"!=typeof this.timeBetweenWfFunc&&(this.timeBetweenWfFunc=void 0),this.minTimeBetweenWfFunc=this.store.get("mntmbtwfsf"),"function"!=typeof this.minTimeBetweenWfFunc&&(this.minTimeBetweenWfFunc=void 0),this.defaultMinTimeBetweenWf=this.store.get("mintimwf")||5e3,this.store.set("dynamicWf.lastDelayBetweenWfs",-1),this.store.set("dynamicWf.currentDelayBetweenWfs",-1),this._calcDynamicWfsValues()}},{key:"_calcDynamicWfsValues",value:function(){this._delayBetweenWfs=1e3*this._calcDelayBetweenWf(),this._delayBetweenWfs>0&&(this._minTimeBetweenWf=this._calcMinDelayBetweenWfs()),this._saveDynamicWfsValues()}},{key:"_calcDelayBetweenWf",value:function(){var t=A;if(this.timeBetweenWfFunc)try{t=this.timeBetweenWfFunc(this.store.get("waterfallSuccessesInARow"),this.store.get("waterfallFailsInARow"),this.store,!document.hidden)}catch(e){t=this.defaultTimeBetweenWaterfalls}return t>this.maxTimeBetweenWaterfalls?t=A:t<this.minTimeBetweenWaterfalls&&(t=this.minTimeBetweenWaterfalls),t}},{key:"_calcMinDelayBetweenWfs",value:function(){var t=this.defaultMinTimeBetweenWf;if(this.minTimeBetweenWfFunc)try{t=this.minTimeBetweenWfFunc(this.store.get("waterfallSuccessesInARow"),this.store.get("waterfallFailsInARow"),this.store,!document.hidden)}catch(e){t=this.defaultMinTimeBetweenWf}return t}},{key:"_saveDynamicWfsValues",value:function(){this.store.set("dynamicWf.lastDelayBetweenWfs",this.store.get("dynamicWf.currentDelayBetweenWfs")),this.store.set("dynamicWf.currentDelayBetweenWfs",this._delayBetweenWfs)}},{key:"_registerQueueEvent",value:function(){var t=this.store.get("run_wf_when_empty");t&&this.store.on("playFromEmptyQueue",this.runWaterfall.bind(this,"queueEmpty"))}},{key:"_isInIdleMode",value:function(){return this.store.get("isIdleMode")}},{key:"_runWaterfallTicker",value:function(){this.startNextWfTimeout(),this.runWaterfall("interval")}},{key:"init",value:function(t,e){this.creatives=t,this.store.set("creatives",t),this.adParams=e,this.supportNonVideoVpaid&&w.default.selectValidSize(this.store),this._shouldRunWaterfallOnInit()&&this.runWaterfall("run_wf_on_init")}},{key:"_shouldRunWaterfallOnInit",value:function(){return this.store.get("run_wf_on_init")}},{key:"_serveStaticWf",value:function(t){this._getRollType();var e=0;"mid-roll"==this.currentRollType?e=1:"post-roll"==this.currentRollType&&(e=2);var i=new Function("try { return "+this.staticWf[e].ad_parameters+";} catch(e){}")();this._handleWaterfallSuccess(c.stringify(i.waterfall),t)}},{key:"runWaterfall",value:function(t){var e=this;if(!this.passedMaxEmptyWaterfalls()&&!this.store.get("first_look")&&("function"!=typeof this.shouldRun||this.shouldRun())&&!this._shouldDelayWaterfall()&&!this._isInIdleMode()){var i=this,n=(new Date).getTime(),r=this.lastRun?n-this.lastRun:this._minTimeBetweenWf;if(!(r<this._minTimeBetweenWf)){this.lastRun=n;var s=new v.default(this.store);if(this.staticWf)return void setTimeout(function(){e._serveStaticWf(s)},20);1===k&&c.reportDebug("player_waterfall","firstwf",{type:"debug",message:"firstwf",fullPageUrl:this.store.get("fullPageUrl"),player_id:this.store.get("player_id")},this.store);var o=this.store.get("pstflrs")===!0,a=this.store.get("psthdrs")||"application/json";this.lastRun=n,s.requestTime=Date.now(),s.ignoredLineitems=[],s.push("reason",t),s.push("waterfallIndex",k),s.push("sinceLastWf",r),s.push("queueLength",this.store.get("queueLength")),s.push("vpaidReadyCount",this.store.get("vpaidReadyCount")),s.push("vpaidPendingCount",this.store.get("queueLength")-this.store.get("vpaidReadyCount")),s.push("failsInARow",this.store.get("waterfallFailsInARow")),s.push("successesInARow",this.store.get("waterfallSuccessesInARow")),s.push("lastDelayBetweenWfs",this.store.get("dynamicWf.lastDelayBetweenWfs")),s.push("currentDelayBetweenWfs",this.store.get("dynamicWf.currentDelayBetweenWfs")),s.push("emptyWaterfallsInARow",this.store.get("emptyWaterfallsInARow")),s.push("maxAllowedEmptyWaterfalls",this.maxAllowedEmptyWaterfalls),s.push("encryptedResponse",this.encryptWaterfallResponse),s.push("waterfallVersion",this.wfv),s.push("navigatorConnection",this.store.get("navigatorConnection"));var d=function(t,e){i._handleWaterfallError(t,s,e)},l=function(t,e,n){i._handleWaterfallSuccess(t,s,n)},h=this._generateWaterfallUrl(this.creatives,this._runMimeTypeCheck(),s);s.push("url",h);try{for(var p,f=h.split("?")[1].split("&"),m={},g=0;g<f.length;g++)p=f[g],m[p.split("=")[0]]=p.split("=")[1];s.push("urlParams",m)}catch(t){}if(s.push("noaop",this.isFirstRun?this.store.get("firstWaterfallNoaop"):this.creatives.NOAOP),h){if(this.adParams&&this.adParams.waterfall)window.setTimeout(this._handleWaterfallSuccess.bind(this,c.stringify(this.adParams.waterfall)),0);else{if(!o)return(0,u.default)(h,"",l,d,!0,!0,!0,5e3,a,this.retryOnFail),k++,this.store.set("waterfallIndex",k),void(this.isFirstRun&&(this.isFirstRun=!1));var y=this._buildPostData();s.push("postData",y),(0,u.default)(h,y,l,d,!0,!0,!0,5e3,a,this.retryOnFail),this.isFirstRun&&(this.isFirstRun=!1)}k++,this.store.set("waterfallIndex",k)}}}}},{key:"_buildPostData",value:function(){var t={fv:[]},e=this.store.get("sessionData");e&&(t.sd=e),this.encryptWaterfallResponse&&(t.en=1),t.wfv=this.wfv;var i=this.store.get("lineItems")||[];if(i.length>0){var n=this;i.map(function(e){var i=n.store.get(e);t.fv.push({li:e,f:i.fails,fr:i.failsRow,c:i.conversions,t:i.tries})})}var r=this.store.getWfData();t.adv=r,!this.sentCookiesData&&this.store.get("EP_PLAYER")&&(t.ls=this.store.get("EP_PLAYER"),this.sentCookiesData=!0);var s=this.store.get("navigatorConnection")||{};t.cdl=s.downlink||0,t.cet=s.effectiveTypeId||0,t.ct=s.typeId||0,t.crt=s.rtt||0,t.csd=s.saveData===!0?1:0,t.q=this.queueStatus?this.queueStatus.items:[],t.qs=this.queueStatus?this.queueStatus.size:0,t.pq=this.queueStatus?this.queueStatus.prevItems:[],t.drp=btoa(c.stringify(this._getAdTypesToDrop()));var o=c.stringify(t);return o}},{key:"_getAdTypesToDrop",value:function(){var t=[];for(var e in this.adsToDrop)this.adsToDrop[e]&&t.push(e);return t}},{key:"_runMimeTypeCheck",value:function(){var t=document.createElement("video"),e=[];e.push(5);for(var i=0;i<this.mimeEnum.length;i++){var n=this.mimeEnum[i];n.video&&t.canPlayType(n.mime)&&e.push(n.id)}return t=void 0,e}},{key:"passedMaxEmptyWaterfalls",value:function(){return!!this.maxAllowedEmptyWaterfalls&&this.store.get("emptyWaterfallsInARow")>this.maxAllowedEmptyWaterfalls}},{key:"_handleWaterfallSuccess",value:function(t,e,i){if(this.store.incr("emptyWaterfallsInARow"),!this.igonreWfWhenHidden){if(this._addRoundTripDuration(),!t)return this.debugTracker.info("runWaterfall","Empty Waterfall!"),this.store.incr("waterfallFailsInARow"),this.store.set("waterfallSuccessesInARow",0),void this._handleWaterfallError("empty-response",e,i);this.encryptWaterfallResponse&&(t=this._decodeText(t));var n=new Function("try { return "+t+";} catch(e){}")();if(!(n&&n.tags&&n.tags.length)){var r=n&&n.tags?"Failed to decode empty server response":"Failed to decode server response!";return this.debugTracker.warn("runWaterfall",r),this.store.incr("waterfallFailsInARow"),this.store.set("waterfallSuccessesInARow",0),void this._handleWaterfallError("no-tags",e,i)}this.store.set("emptyWaterfallsInARow",0),this.debugTracker.info("Waterfall number "+(e.index+1)+" received",n.tags,{color:"#D15EFF"}),this.store.set("sessionData",n.sd),n&&n.pixel_piggies&&this._firePiggies(n.pixel_piggies);var s=[],o=!1;for(var a in n.tags){var d=n.tags[a];if(d.url||d.vast){var l=d.t===w.default.type;if(d.score=-1,d.waterfallTagId=a,d.created=(new Date).getTime(),d.dp=(d.lp&&d.lp.length>0&&d.lp[0]?d.lp[0]:"").replace(/http:\/\/|.com|https:\/\/|.com/g,"")||"na",d.dpFull=d.lp&&d.lp.length>0?d.lp[0]:"na",d.conversionPixels=d.conversionPixels||[],d.ts=Date.now(),d.wfIndex=e?e.get("waterfallIndex",-1):k,d.url=d.url?c.replaceMacros(d.url,this.store,l):"",d.vast=d.vast?c.replaceMacros(d.vast,this.store):"",d.pixel=d.pixel?this._getPixel(d.pixel):"",d.brand=d.brand||"",d.rollType=this.currentRollType,d.pubId=this.pubid,d.tagId=this.tagid,d.isRon=this.isRon,d.cstmdl=d.cstmdl||-1,d.singleAd=1===d.sa,d.adjacencyAd=1===d.adjac,this._shouldDropAd(d))continue;void 0!==this.defaultTagPrice&&(d.price=d.price||this.defaultTagPrice);var u=d.pixel.match("cirid=([^&]*)");if(u&&u.length&&(d.cirid=u[1]),d.dast=d.pixel?this._getDastFromPixel(d.pixel):"",d.vidDast=d.pixel?this._getVidDastFromPixel(d.pixel):"",d.campaignId=this._getCampaignId(d.vidDast),d.lineItem=d.lineItemId||this._getDastVal(d.dast,"cicmp"),d.lineItem=d.lineItem.toString(),d.url&&0===d.url.indexOf("http:")&&c.shouldSecureWfUrl(this.store)&&(d.url=d.url.replace("http:","https:")),this._overrideParamsByDemand(d),this._decodeItemParams(d),this.requiredViewabilityFactor>0&&!d.requiredViewability&&(d.requiredViewability=this._drawRequiredViewabilityByFactor(d)),l){o=!0,e.push("tagResponse_adx",c.flattenObject(d)),d.wfStats=new g.default(this.store,k),this.store.emit("nonVideoItemInWaterfall",{item:d,wflog:e});continue}this._ignoreLineitem(d.lineItem)?(e.ignoredLineitems.push(d.lineItem),e.push("ignoreLineitems",e.ignoredLineitems),this.store.get(d.lineItem+".failsRow")?this.store.incr(d.lineItem+".failsRow"):this.store.set(d.lineItem+".failsRow",1)):s.push(d),this.store.get(d.lineItem)||this.store.set(d.lineItem,{failsRow:0,tries:0,conversions:0,fails:0}),d.lineItemStats=c.deepClone(this.store.get(d.lineItem))}}s.length>0?(this._pushTagsResponseToWaterfallLog(e,s),n.tags=s,n.data=new g.default(this.store,k),this.onWaterfallSuccess(n,e),e&&(e.push("duration",Date.now()-e.requestTime),e.push("response",t),e.push("tagsCount",s.length),e.push("success",!0),this._sendWfLog(e)),this.store.emit("waterfallData",n),this._logRetry(e,i,!0)):o||(this.debugTracker.error("runWaterfall","Failed to get any tags!"),this._handleWaterfallError("no-clean-tags",e,i))}}},{key:"_shouldDropAd",value:function(t){for(var e in this.adsToDrop)if(this.adsToDrop[e]&&t.hasOwnProperty(e)&&t[e])return!0;return!1}},{key:"_logRetry",value:function(t,e,i){if(t&&e){var n=e.indexOf("rt=1")>-1;if(!n)return;var r=e.match(/prst=(.*?)(&|$)/);t.push("retry",!0),t.push("statusBeforeRetry",r&&r.length>1?r[1]:"0"),t.push("successOnRetry",i)}}},{key:"_drawRequiredViewabilityByFactor",value:function(t){var e=!!(c.getRandomInt(0,100)<=this.requiredViewabilityFactor&&t&&t.brand);return e&&(t.requiredViewabilityDrawn=!0),e}},{key:"_pushTagsResponseToWaterfallLog",value:function(t,e){t&&e.map(function(e,i){var n=Object.assign({},e);t.push("tagResponse_"+i,c.flattenObject(n))})}},{key:"_overrideParamsByDemand",value:function(t){this.store.get("ovrtgbydc")&&(t=Object.assign(t,this.store.getByAdvId("ovrdtag",t.advId)))}},{key:"_sendWfLog",value:function(t){var e={wfRoundTripAverageDuration:this.store.get("performance.wfRoundTripAverageDuration"),performanceMeasurment:this.store.get("performance.performanceMeasurment")};t.push("performance",e),t.push("conversionsCount",this.store.get("conversionsCount")),t.push("unit",{width:this.store.get("width"),height:this.store.get("height")}),this.store.get("vForce")&&t.push("getAdData",this.store.get("getAdData"))}},{key:"_addRoundTripDuration",value:function(){var t=Date.now()-this.lastRun;this._roundTripAverageDuration=parseInt((this._roundTripAverageDuration*this._roundTripsCount+t)/(this._roundTripsCount+1)),this.store.set("waterfall_data.last_duration",t),this.store.set("waterfall_data.average_duration",this._roundTripAverageDuration),this._roundTripsCount++}},{key:"_ignoreLineitem",value:function(t){if(this.lineitemMaxFails>0){var e=this.store.get(t),i=e?e.failsRow:-1;return i>this.lineitemMaxFails}return!1}},{key:"_getVidDastFromPixel",value:function(t){var e=t.match('vid-dast=([^&|"]*)');return e&&e.length?e[1]:""}},{key:"_decodeItemParams",value:function(t){t.rpox=this._decodeValue(t.rpox),t.alfrox=this._decodeValue(t.alfrox),t.frox=this._decodeValue(t.frox),t.ex&&(t.crId=t.ex.ecrid,t.stId=t.ex.s,t.cmpgnId=t.ex.ecid,t.ex.b&&(t.brand=this.encryptWaterfallResponse?t.ex.b:this._decodeText(t.ex.b))),t.itemType=t.t}},{key:"_decodeValue",value:function(t){return this.encryptWaterfallResponse?t:(2530^t)/1e3}},{key:"_decodeText",value:function(t){var e;try{e=atob(t)}catch(t){return!1}for(var i,n="",r="PlAyER",s=0;s<e.length;s++)i=s%r.length,n+=String.fromCharCode(e[s].charCodeAt(0).toString(10)^r[i].charCodeAt(0).toString(10));return n}},{key:"_firePiggies",value:function(t){var e=this.store.get("fire_piggies");if(e&&!(k>=5))for(var i=0;i<t.length;i++){var n=t[i];if(n.url){var r=c.setUrlPrefix(n.url);try{(new Image).src=r}catch(t){this.debugTracker.error("_fireIframePig - Malformed url!",t);
}}}}},{key:"_fireIframePig",value:function(t){var e=document.createElement("iframe");e.src=t,e.style.display="none";var i=document.getElementsByTagName("body")[0];i||(i=document.getElementsByTagName("html")[0]),i||(i=document.getElementsByTagName("div")[0]),i?i.appendChild(e):this.debugTracker.warn("_fireIframePig","Failed to fire piggies.")}},{key:"_handleWaterfallError",value:function(t,e,i){this.store.incr("emptyWaterfallsInARow"),this._addRoundTripDuration(),e&&(this._logRetry(e,i,!1),e.push("duration",Date.now()-e.requestTime),e.push("error",t),e.push("success",!1),this._sendWfLog(e)),this.onWaterfallError(t)}},{key:"_decideNoap",value:function(t){var e;if(this.isFirstRun)e=this.store.get("firstWaterfallNoaop");else if(this.dynamicNoaopMaxValue>0){var i=this.store.get("max_ready_vpaid")||0,n=this.store.get("vpaidReadyCount")||0;e=Math.min(this.dynamicNoaopMaxValue,i-n)}else e=t;return e||t}},{key:"_generateWaterfallUrl",value:function(t,e,i){var n=this.store.get("wf_base_path")||t.CM_DOMAIN;n+=/.*\/$/g.test(n)?"":"/",n=c.setUrlPrefix(n);var r=[],s=!document.hidden,o=this._getRollType();if(!o)return"";var a=(new Date).getTimezoneOffset();a*=-1;var d=t.SORTORDERTYPE,l=this.store.get("ab_test"),u=this.store.get("mprdct");r.push("oid="+t.OID),r.push("width="+(t.PLAYER_WIDTH||t["PLAYER-WIDTH"])),r.push("height="+(t.PLAYER_HEIGHT||t["PLAYER-HEIGHT"])),r.push("pubid="+(this.pubid||t.PUBID)),r.push("tagid="+(this.tagid||t.TAGID)),r.push("crid="+(this.store.get("creativeId")||"")),r.push("noaop="+this._decideNoap(t.NOAOP)),r.push("sortOrderType="+d),r.push("cb="+(new Date).getTime()),r.push("mimes="+e.join(",")),r.push("isvideo="+t.ISVIDEO),r.push("plmd="+t.PLMD),r.push("mindur="+t.MINDUR),r.push("maxdur="+t.MAXDUR),r.push("minbr="+t.MINBR),r.push("maxbr="+t.MAXBR),r.push("st="+c.getStreamType(o.roll_type)),r.push("seq="+k),r.push("pv="+(this.store.get("player_version")||999)),r.push("pt="+c.crc32(l||999)),r.push("tz="+a),r.push("viewable="+s),r.push("ddast="+this.store.get("auc_dast")),r.push("proto=2,3,5,6"),this.store.get("dtagid")&&r.push("dtagid="+this.store.get("dtagid")),this.store.get("dpubid")&&r.push("dpubid="+this.store.get("dpubid")),l&&r.push("abtst="+l),"undefined"!=typeof u&&r.push("mPre="+u),r.push("encoded=1");var h=this.store.get("pstn")||1;r.push("pstn="+h),t.CIRF&&r.push("cirf="+encodeURIComponent(decodeURIComponent(t.CIRF))),r.push("callback=");var p=this.store.get("wf_xrta");p&&r.push(p),this.encryptWaterfallResponse&&r.push("en=1"),r.push("wfv="+this.wfv),r.push("cdb="+(this.store.get("cdb")||"")),r.push("gdprApplies="+(this.store.get("gdprApplies")||!1)),r.push("amp="+(this.store.get("isAmp")?"1":"0")),r.push("qsz="+this.queueSize);var f=this.store.get("wf_path")||t.SERVICE;return window.lastWfUrl=n+f+"?"+r.join("&"),this.wfSequences.indexOf(k)>-1&&i.push("duplicateSequence",k),this.wfSequences.push(k),n+f+"?"+r.join("&")}},{key:"_getPixel",value:function(t){var e=t.split(/<script.*?src="(.*?)"/g);if(1==e.length){if(e=t.split(/<script.*?src='(.*?)'/g),e[1])return e[1].replace(/^http(s:|:)/g,"")}else if(e[1])return e[1].replace(/^http(s:|:)/g,"");return t.replace(/^http(s:|:)/g,"")}},{key:"_getDastFromPixel",value:function(t){var e=t.replace(/\?\?+/g,"?").replace(/&&+/g,"&").split(/\?(.+)?/gi,2);if(2!=e.length)return"";var i=e[1].split(/\?|&/gi);for(var n in i)if(i[n]){var r=i[n].split(/=(.+)?/gi,2);if(2==r.length&&"dast"==r[0])return r[1]}return""}},{key:"onWaterfallError",value:function(){}},{key:"onWaterfallSuccess",value:function(){}},{key:"SetWaterfallError",value:function(t){this.onWaterfallError=t}},{key:"SetWaterfallSuccess",value:function(t){this.onWaterfallSuccess=t}},{key:"SetShouldRun",value:function(t){this.shouldRun=t||function(){}}},{key:"GetCounter",value:function(){return k}},{key:"_getRollType",value:function(){var t,e=this.store.get("contentSchedule")||{},i=null,n=Object.keys(e)||[];return 1===k?(t=n[0],i=e[t]):n.length>0&&(t=n[1],i=e[t]),this.currentRollType=i?i.roll_type:"",this.pubid=i?i.pubid:0,this.tagid=i?i.tagid:0,i}},{key:"_getDastVal",value:function(t,e){var i="";try{i=atob(t)}catch(t){return}var n=i.match(e+"=([^&]*)");return n&&n.length>1?n[1]:""}},{key:"_stop",value:function(){clearTimeout(this.wfInterval)}},{key:"start",value:function(){this.startNextWfTimeout()}},{key:"stop",value:function(){this._stop()}},{key:"_getCampaignId",value:function(t){try{var e=new _.default(t,this.store),i=e.fetchResults();return i&&i.cipid?i.cipid:-1}catch(t){return-1}}},{key:"_onQueueStatusChanged",value:function(t){var e=function(t){var e=Object.assign({},t);return e.aid=e.cstmdl=e.dp=e.pid=void 0,""===e.br&&(e.br=void 0),e};this.queueStatus={size:t.size,prevItems:t.previousQueue.map(e),items:t.items.map(e)}}},{key:"dropAds",value:function(t){this.adsToDrop.hasOwnProperty(t)&&!this.adsToDrop[t]&&(this.adsToDrop[t]=!0)}}]),t}();e.default=T},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=i(1),a=n(o),d=function(){function t(e,i){r(this,t),this.id=Date.now()+"_"+a.generateGuid(20),this.index=i,this.store=e,this.vpaidsCount=0,this.reportedVpaidsCount=0,this.success=0,this.fails=0,this.isSuccessed=!1}return s(t,[{key:"increaseVpaidsCount",value:function(){this.vpaidsCount++}},{key:"increaseSuccess",value:function(){this.success++,this._update()}},{key:"increaseFailure",value:function(){this.fails++,this._update()}},{key:"_update",value:function(){this.reportedVpaidsCount++,this.isSuccessed||(1===this.success?(this.store.incr("waterfallSuccessesInARow"),this.store.set("waterfallFailsInARow",0),this.isSuccessed=!0):this.reportedVpaidsCount===this.vpaidsCount&&(this.store.incr("waterfallFailsInARow"),this.store.set("waterfallSuccessesInARow",0)))}},{key:"getData",value:function(){return{id:this.id,index:this.index,allVpaidsReported:this.vpaidsCount===this.reportedVpaidsCount,wf_sr:this.store.get("waterfallSuccessesInARow"),wf_fr:this.store.get("waterfallFailsInARow")}}}]),t}();e.default=d},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(1),d=n(a),l=0,u=1e4,h=function(){function t(e){var i=this;r(this,t),this.index=l++,this.numberOfConnectedVpaids=0,this.dataChanged=!0,this.store=e,this.created=Date.now(),this.data={_id:d.generateGuid(10),player_id:this.store.get("player_id"),isMobile:this.store.get("isMobile"),created:(new Date).toISOString(),unitType:this.store.get("unit_type"),fullPageUrl:this.store.get("fullPageUrl"),updatesCount:0,taboolaVpaid:this.store.get("istblvpd")},this.sendDataInterval=setInterval(function(){i.dataChanged&&i._sendData()},u)}return o(t,[{key:"push",value:function(t,e){this.data.hasOwnProperty(t)&&!this._hasValueChanged(this.data,t,e)||(this.dataChanged=!0),this.data[t]=e}},{key:"_hasValueChanged",value:function(t,e,i){if("object"!==("undefined"==typeof i?"undefined":s(i)))return t[e]!==i;if(Array.isArray(i)){for(var n=0;n<i.length;n++)if(t[e].indexOf(i[n])<0)return!0;return!1}for(var r in i)if(this._hasValueChanged(this.data[e],r,i[r]))return!0;return!1}},{key:"get",value:function(t,e){return this.data.hasOwnProperty(t)?this.data[t]:e}},{key:"_sendData",value:function(){this.data&&(this.data.updatesCount++,d.reportDebug("player_waterfall","WfLog",this.data,this.store),this.dataChanged=!1)}},{key:"sendDataOnConversion",value:function(){var t=this;setTimeout(function(){t._sendData()},2e3)}},{key:"increaseNumberOfConnectedVpaids",value:function(){this.numberOfConnectedVpaids++}},{key:"complete",value:function(){0==--this.numberOfConnectedVpaids&&(this._sendData(),this.data=this.store=void 0,this.sendDataInterval=clearInterval(this.sendDataInterval))}}]),t}();e.default=h},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(1),d=r(a),l=i(3),u=n(l),h=void 0,c=function(){function t(e,i){return s(this,t),h?h:(this.debugTracker=new u.default("ClickThroughHandler"),this.store=e,this.ovaMediaPlayer=i,this.isMultiAdsActive=this.store.get("mltads"),void(h=this))}return o(t,[{key:"invokeClick",value:function(t){this.isMultiAdsActive||this.store.set("forcePause",!1),t&&t.url&&(t.playerHandles&&t.url&&this._openClickThroughUrl(t.url),this.ovaMediaPlayer.options.onAdClick(this.ovaMediaPlayer,this,t.url))}},{key:"_openClickThroughUrl",value:function(t){if(this.debugTracker.info("Opening Url","Opening url: "+t),t=d.replaceMacros(t,this.store),this.store.get("isInApp")&&window.taboolaMobile&&window.tbNativeBridge){var e=window.tbNativeBridge;if(e.invoke)return void e.invoke("onClick",["",t,t,!1,0,"video"])}window.open(t)}}]),t}();e.default=c},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t,e,i){u.indexOf(t)>-1||u.push(t)}function s(t,e,i){u.indexOf(t)>-1||u.push(t)}function o(t){var e=l.crc32(t);u.indexOf(e)>-1||h.push(t)}function a(t,e,i,n){var r=l.crc32(t),s=r+":"+e;return c.indexOf(s)>-1?void l.reportDebug("player_waterfall","doubleOppsPerVidDast",{crcVidDast:r,oppsID:e,tagItem:l.stringify(i)},n):void c.push(s)}Object.defineProperty(e,"__esModule",{value:!0}),e.reportOppsPerVidDastDuplications=e.reportCleanPixel=e.reportVast=e.reportPixel=void 0;var d=i(1),l=n(d),u=[],h=[],c=[];e.reportPixel=r,e.reportVast=o,e.reportCleanPixel=s,e.reportOppsPerVidDastDuplications=a},function(t,e){"use strict";function i(t,e){return new r.Player(t,e)}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r={Player:null,VideoElement:null,BitBuffer:null,Source:{},Demuxer:{},Decoder:{},Renderer:{},AudioOutput:{},Now:function(){return window.performance?window.performance.now()/1e3:Date.now()/1e3},CreateVideoElements:function(){for(var t=document.querySelectorAll(".jsmpeg"),e=0;e<t.length;e++)new r.VideoElement(t[e])},Fill:function(t,e){if(t.fill)t.fill(e);else for(var i=0;i<t.length;i++)t[i]=e}};"complete"===document.readyState?r.CreateVideoElements():document.addEventListener("DOMContentLoaded",r.CreateVideoElements),r.VideoElement=function(){var t=function t(e){var i=e.dataset.url;if(!i)throw"VideoElement has no `data-url` attribute";var n=function(t,e){for(var i in e)t.style[i]=e[i]};this.container=e,n(this.container,{display:"inline-block",position:"relative",minWidth:"80px",minHeight:"80px"}),this.canvas=document.createElement("canvas"),this.canvas.width=960,this.canvas.height=540,n(this.canvas,{display:"block",width:"100%"}),this.container.appendChild(this.canvas),this.playButton=document.createElement("div"),this.playButton.innerHTML=t.PLAY_BUTTON,n(this.playButton,{zIndex:2,position:"absolute",top:"0",bottom:"0",left:"0",right:"0",maxWidth:"75px",maxHeight:"75px",margin:"auto",opacity:"0.7",cursor:"pointer"}),this.container.appendChild(this.playButton);var s={canvas:this.canvas};for(var o in e.dataset)try{s[o]=JSON.parse(e.dataset[o])}catch(t){s[o]=e.dataset[o]}if(this.player=new r.Player(i,s),!s.poster||s.autoplay||this.player.options.streaming||(s.decodeFirstFrame=!1,this.poster=new Image,this.poster.src=s.poster,this.poster.addEventListener("load",this.posterLoaded),n(this.poster,{display:"block",zIndex:1,position:"absolute",top:0,left:0,bottom:0,right:0}),this.container.appendChild(this.poster)),this.player.options.streaming||this.container.addEventListener("click",this.onClick.bind(this)),(s.autoplay||this.player.options.streaming)&&(this.playButton.style.display="none"),this.player.audioOut&&!this.player.audioOut.unlocked){var a=this.container;(s.autoplay||this.player.options.streaming)&&(this.unmuteButton=document.createElement("div"),this.unmuteButton.innerHTML=t.UNMUTE_BUTTON,n(this.unmuteButton,{zIndex:2,position:"absolute",bottom:"10px",right:"20px",width:"75px",height:"75px",margin:"auto",opacity:"0.7",cursor:"pointer"}),this.container.appendChild(this.unmuteButton),a=this.unmuteButton),this.unlockAudioBound=this.onUnlockAudio.bind(this,a),a.addEventListener("touchstart",this.unlockAudioBound,!1),a.addEventListener("click",this.unlockAudioBound,!0)}};return t.prototype.onUnlockAudio=function(t,e){this.unmuteButton&&(e.preventDefault(),e.stopPropagation()),this.player.audioOut.unlock(function(){this.unmuteButton&&(this.unmuteButton.style.display="none"),t.removeEventListener("touchstart",this.unlockAudioBound),t.removeEventListener("click",this.unlockAudioBound)}.bind(this))},t.prototype.onClick=function(t){this.player.isPlaying?(this.player.pause(),this.playButton.style.display="block"):(this.player.play(),this.playButton.style.display="none",this.poster&&(this.poster.style.display="none"))},t.PLAY_BUTTON='<svg style="max-width: 75px; max-height: 75px;" viewBox="0 0 200 200" alt="Play video"><circle cx="100" cy="100" r="90" fill="none" stroke-width="15" stroke="#fff"/><polygon points="70, 55 70, 145 145, 100" fill="#fff"/></svg>',t.UNMUTE_BUTTON='<svg style="max-width: 75px; max-height: 75px;" viewBox="0 0 75 75"><polygon class="audio-speaker" stroke="none" fill="#fff" points="39,13 22,28 6,28 6,47 21,47 39,62 39,13"/><g stroke="#fff" stroke-width="5"><path d="M 49,50 69,26"/><path d="M 69,50 49,26"/></g></svg>',t}(),r.Player=function(){var t=function(t,e){this.options=e||{},t.match(/^wss?:\/\//)?(this.source=new r.Source.WebSocket(t,e),e.streaming=!0):e.progressive!==!1?(this.source=new r.Source.AjaxProgressive(t,e),e.streaming=!1):(this.source=new r.Source.Ajax(t,e),e.streaming=!1),this.maxAudioLag=e.maxAudioLag||.25,this.loop=e.loop!==!1,this.autoplay=!!e.autoplay||e.streaming,this.onFinished=e.onfinished,this.demuxer=new r.Demuxer.TS(e),this.source.connect(this.demuxer),e.video!==!1&&(this.video=new r.Decoder.MPEG1Video(e),this.renderer=!e.disableGl&&r.Renderer.WebGL.IsSupported()?new r.Renderer.WebGL(e):new r.Renderer.Canvas2D(e),this.demuxer.connect(r.Demuxer.TS.STREAM.VIDEO_1,this.video),this.video.connect(this.renderer)),e.audio!==!1&&r.AudioOutput.WebAudio.IsSupported()&&(this.audio=new r.Decoder.MP2Audio(e),this.audioOut=new r.AudioOutput.WebAudio(e),this.demuxer.connect(r.Demuxer.TS.STREAM.AUDIO_1,this.audio),this.audio.connect(this.audioOut)),Object.defineProperty(this,"currentTime",{get:this.getCurrentTime,set:this.setCurrentTime}),Object.defineProperty(this,"volume",{get:this.getVolume,set:this.setVolume}),this.unpauseOnShow=!1,e.pauseWhenHidden!==!1&&document.addEventListener("visibilitychange",this.showHide.bind(this)),this.source.start(),this.autoplay&&this.play()};return t.prototype.showHide=function(t){"hidden"===document.visibilityState?(this.unpauseOnShow=this.wantsToPlay,this.pause()):this.unpauseOnShow&&this.play()},t.prototype.play=function(t){this.animationId=requestAnimationFrame(this.update.bind(this)),this.wantsToPlay=!0},t.prototype.pause=function(t){cancelAnimationFrame(this.animationId),this.wantsToPlay=!1,this.isPlaying=!1,this.audio&&this.audio.canPlay&&(this.audioOut.stop(),this.seek(this.currentTime))},t.prototype.getVolume=function(){return this.audioOut?this.audioOut.volume:0},t.prototype.setVolume=function(t){this.audioOut&&(this.audioOut.volume=t)},t.prototype.stop=function(t){this.pause(),this.seek(0),this.video&&this.options.decodeFirstFrame!==!1&&this.video.decode()},t.prototype.seek=function(t){var e=this.audio&&this.audio.canPlay?this.audio.startTime:this.video.startTime;this.video&&this.video.seek(t+e),this.audio&&this.audio.seek(t+e),this.startTime=r.Now()-t},t.prototype.getCurrentTime=function(){return this.audio&&this.audio.canPlay?this.audio.currentTime-this.audio.startTime:this.video.currentTime-this.video.startTime},t.prototype.setCurrentTime=function(t){this.seek(t)},t.prototype.update=function(){return this.animationId=requestAnimationFrame(this.update.bind(this)),this.source.established?(this.isPlaying||(this.isPlaying=!0,this.startTime=r.Now()-this.currentTime),void(this.options.streaming?this.updateForStreaming():this.updateForStaticFile())):void(this.renderer&&this.renderer.renderProgress(this.source.progress))},t.prototype.updateForStreaming=function(){if(this.video&&this.video.decode(),this.audio){var t=!1;do this.audioOut.enqueuedTime>this.maxAudioLag&&(this.audioOut.resetEnqueuedTime(),this.audioOut.enabled=!1),t=this.audio.decode();while(t);this.audioOut.enabled=!0}},t.prototype.updateForStaticFile=function(){var t=this,e=!1,i=0;if(this.audio&&this.audio.canPlay){for(;!e&&this.audio.decodedTime-this.audio.currentTime<.25;)e=!this.audio.decode();this.video&&this.video.currentTime<this.audio.currentTime&&(e=!this.video.decode()),i=this.demuxer.currentTime-this.audio.currentTime}else if(this.video){var n=r.Now()-this.startTime+this.video.startTime,s=n-this.video.currentTime,o=1/this.video.frameRate;this.video&&s>0&&(s>2*o&&(this.startTime+=s),e=!this.video.decode()),i=this.demuxer.currentTime-n}this.source.resume(i),e&&this.source.completed&&(this.loop?this.seek(0):(this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout(function(){t.onFinished()},500),this.pause()))},t}(),r.BitBuffer=function(){var t=function t(e,i){"object"===("undefined"==typeof e?"undefined":n(e))?(this.bytes=e instanceof Uint8Array?e:new Uint8Array(e),this.byteLength=this.bytes.length):(this.bytes=new Uint8Array(e||1048576),this.byteLength=0),this.mode=i||t.MODE.EXPAND,this.index=0};return t.prototype.resize=function(t){var e=new Uint8Array(t);0!==this.byteLength&&(this.byteLength=Math.min(this.byteLength,t),e.set(this.bytes,0,this.byteLength)),this.bytes=e,this.index=Math.min(this.index,this.byteLength<<3)},t.prototype.evict=function(t){var e=this.index>>3,i=this.bytes.length-this.byteLength;return this.index===this.byteLength<<3||t>i+e?(this.byteLength=0,void(this.index=0)):void(0!==e&&(this.bytes.copyWithin?this.bytes.copyWithin(0,e,this.byteLength):this.bytes.set(this.bytes.subarray(e,this.byteLength)),this.byteLength=this.byteLength-e,this.index-=e<<3))},t.prototype.write=function(e){var i="object"===n(e[0]),r=0,s=this.bytes.length-this.byteLength;if(i)for(var r=0,o=0;o<e.length;o++)r+=e[o].byteLength;else r=e.byteLength;if(r>s)if(this.mode===t.MODE.EXPAND){var a=Math.max(2*this.bytes.length,r-s);this.resize(a)}else this.evict(r);if(i)for(var o=0;o<e.length;o++)this.appendSingleBuffer(e[o]);else this.appendSingleBuffer(e)},t.prototype.appendSingleBuffer=function(t){t=t instanceof Uint8Array?t:new Uint8Array(t),this.bytes.set(t,this.byteLength),this.byteLength+=t.length},t.prototype.findNextStartCode=function(){for(var t=this.index+7>>3;t<this.byteLength;t++)if(0==this.bytes[t]&&0==this.bytes[t+1]&&1==this.bytes[t+2])return this.index=t+4<<3,this.bytes[t+3];return this.index=this.byteLength<<3,-1},t.prototype.findStartCode=function(t){for(var e=0;;)if(e=this.findNextStartCode(),e===t||e===-1)return e;return-1},t.prototype.nextBytesAreStartCode=function(){var t=this.index+7>>3;return t>=this.byteLength||0==this.bytes[t]&&0==this.bytes[t+1]&&1==this.bytes[t+2]},t.prototype.peek=function(t){for(var e=this.index,i=0;t;){var n=this.bytes[e>>3],r=8-(7&e),s=r<t?r:t,o=r-s,a=255>>8-s;i=i<<s|(n&a<<o)>>o,e+=s,t-=s}return i},t.prototype.read=function(t){var e=this.peek(t);return this.index+=t,e},t.prototype.skip=function(t){return this.index+=t},t.prototype.rewind=function(t){this.index=Math.max(this.index-t,0)},t.prototype.has=function(t){return(this.byteLength<<3)-this.index>=t},t.MODE={EVICT:1,EXPAND:2},t}(),r.Source.Ajax=function(){var t=function(t,e){this.url=t,this.destination=null,this.request=null,this.completed=!1,this.established=!1,this.progress=0,this.onReadyCblk=e.onload,this.errHandler=e.errHndlr};return t.prototype.connect=function(t){this.destination=t},t.prototype.start=function(){this.request=new XMLHttpRequest,this.request.onreadystatechange=function(){this.request.readyState===this.request.DONE&&200===this.request.status&&(this.onLoad(this.request.response),this.onReadyCblk()),500!==this.request.status&&502!==this.request.status||this.errHandler({err:"error status "+this.request.status+" received for url:"+this.url})}.bind(this),this.request.onprogress=this.onProgress.bind(this),this.request.open("GET",this.url),this.request.responseType="arraybuffer",this.request.send()},t.prototype.resume=function(t){},t.prototype.abort=function(){this.request.abort()},t.prototype.onProgress=function(t){this.progress=t.loaded/t.total},t.prototype.onLoad=function(t){this.established=!0,this.completed=!0,this.progress=1,this.destination&&this.destination.write(t)},t}(),r.Source.AjaxProgressive=function(){var t=function(t,e){this.url=t,this.destination=null,this.request=null,this.completed=!1,this.established=!1,this.progress=0,this.fileSize=0,this.loadedSize=0,this.chunkSize=e.chunkSize||1048576,this.isLoading=!1,this.loadStartTime=0,this.throttled=e.throttled!==!1};return t.prototype.connect=function(t){this.destination=t},t.prototype.start=function(){this.request=new XMLHttpRequest,this.request.onreadystatechange=function(){this.request.readyState===this.request.DONE&&(this.fileSize=parseInt(this.request.getResponseHeader("Content-Length")),this.loadNextChunk())}.bind(this),this.request.onprogress=this.onProgress.bind(this),this.request.open("HEAD",this.url),this.request.send()},t.prototype.resume=function(t){if(!this.isLoading&&this.throttled){var e=8*this.loadTime+2;e>t&&this.loadNextChunk()}},t.prototype.abort=function(){this.request.abort()},t.prototype.loadNextChunk=function(){var t=this.loadedSize,e=Math.min(this.loadedSize+this.chunkSize-1,this.fileSize-1);return t>=this.fileSize?void(this.completed=!0):(this.isLoading=!0,this.loadStartTime=r.Now(),this.request=new XMLHttpRequest,this.request.onreadystatechange=function(){this.request.readyState===this.request.DONE&&this.request.status>=200&&this.request.status<300?this.onChunkLoad(this.request.response):this.request.readyState===this.request.DONE&&this.loadFails++<3&&this.loadNextChunk()}.bind(this),0===t&&(this.request.onprogress=this.onProgress.bind(this)),this.request.open("GET",this.url+"?"+t+"-"+e),this.request.setRequestHeader("Range","bytes="+t+"-"+e),this.request.responseType="arraybuffer",void this.request.send())},t.prototype.onProgress=function(t){this.progress=t.loaded/t.total},t.prototype.onChunkLoad=function(t){this.established=!0,this.progress=1,this.loadedSize+=t.byteLength,this.loadFails=0,this.isLoading=!1,this.destination&&this.destination.write(t),this.loadTime=r.Now()-this.loadStartTime,this.throttled||this.loadNextChunk()},t}(),r.Source.WebSocket=function(){var t=function(t,e){this.url=t,this.socket=null,this.callbacks={connect:[],data:[]},this.destination=null,this.reconnectInterval=e.reconnectInterval||5,this.shouldAttemptReconnect=!!this.reconnectInterval,this.completed=!1,this.established=!1,this.progress=0};return t.prototype.connect=function(t){this.destination=t},t.prototype.abort=function(){this.shouldAttemptReconnect=!1,this.socket.close()},t.prototype.start=function(){this.shouldAttemptReconnect=!!this.reconnectInterval,this.progress=0,this.established=!1,this.socket=new WebSocket(this.url),this.socket.binaryType="arraybuffer",this.socket.onmessage=this.onMessage.bind(this),this.socket.onopen=this.onOpen.bind(this),this.socket.onerror=this.onClose.bind(this),this.socket.onclose=this.onClose.bind(this)},t.prototype.resume=function(t){},t.prototype.onOpen=function(){this.progress=1,this.established=!0},t.prototype.onClose=function(){this.shouldAttemptReconnect&&setTimeout(function(){this.start()}.bind(this),1e3*this.reconnectInterval)},t.prototype.onMessage=function(t){this.destination&&this.destination.write(t.data)},t}(),r.Demuxer.TS=function(){var t=function(t){this.bits=null,this.leftoverBytes=null,this.guessVideoFrameEnd=!0,this.pidsToStreamIds={},this.pesPacketInfo={},this.startTime=0,this.currentTime=0};return t.prototype.connect=function(t,e){this.pesPacketInfo[t]={destination:e,currentLength:0,totalLength:0,pts:0,buffers:[]}},t.prototype.write=function(t){if(this.leftoverBytes){var e=t.byteLength+this.leftoverBytes.byteLength;this.bits=new r.BitBuffer(e),this.bits.write([this.leftoverBytes,t])}else this.bits=new r.BitBuffer(t);for(;this.bits.has(1504);)this.parsePacket();var i=this.bits.byteLength-(this.bits.index>>3);this.leftoverBytes=i>0?this.bits.bytes.subarray(this.bits.index>>3):null},t.prototype.parsePacket=function(){var t=(this.bits.index>>3)+188;if(71!==this.bits.read(8))throw"Sync Token not found";var e=(this.bits.read(1),this.bits.read(1)),i=(this.bits.read(1),this.bits.read(13)),n=(this.bits.read(2),this.bits.read(2)),r=(this.bits.read(4),this.pidsToStreamIds[i]);if(e&&r){var s=this.pesPacketInfo[r];s&&s.currentLength&&this.packetComplete(s)}if(1&n){if(2&n){var o=this.bits.read(8);this.bits.skip(o<<3)}if(e&&this.bits.nextBytesAreStartCode()){this.bits.skip(24),r=this.bits.read(8),this.pidsToStreamIds[i]=r;var a=this.bits.read(16);this.bits.skip(8);var d=this.bits.read(2);this.bits.skip(6);var l=this.bits.read(8),u=this.bits.index+(l<<3),s=this.pesPacketInfo[r];if(s){var h=0;if(2&d){this.bits.skip(4);var c=this.bits.read(3);this.bits.skip(1);var p=this.bits.read(15);this.bits.skip(1);var f=this.bits.read(15);this.bits.skip(1),h=(1073741824*c+32768*p+f)/9e4,this.currentTime=h,this.startTime===-1&&(this.startTime=h)}var v=a?a-l-3:0;this.packetStart(s,h,v)}this.bits.index=u}if(r){var s=this.pesPacketInfo[r];if(s){var m=this.bits.index>>3,g=this.packetAddData(s,m,t),y=!e&&2&n;(g||this.guessVideoFrameEnd&&y)&&this.packetComplete(s)}}}this.bits.index=t<<3},t.prototype.packetStart=function(t,e,i){t.totalLength=i,t.currentLength=0,t.pts=e},t.prototype.packetAddData=function(t,e,i){t.buffers.push(this.bits.bytes.subarray(e,i)),t.currentLength+=i-e;var n=0!==t.totalLength&&t.currentLength>=t.totalLength;return n},t.prototype.packetComplete=function(t){t.destination.write(t.pts,t.buffers),t.totalLength=0,t.currentLength=0,t.buffers=[]},t.STREAM={PACK_HEADER:186,SYSTEM_HEADER:187,PROGRAM_MAP:188,PRIVATE_1:189,PADDING:190,PRIVATE_2:191,AUDIO_1:192,VIDEO_1:224,DIRECTORY:255},t}(),r.Decoder.Base=function(){var t=function(t){this.destination=null,this.canPlay=!1,this.collectTimestamps=!t.streaming,this.timestamps=[],this.timestampIndex=0,this.startTime=0,this.decodedTime=0,Object.defineProperty(this,"currentTime",{get:this.getCurrentTime})};return t.prototype.connect=function(t){this.destination=t},t.prototype.write=function(t,e){this.collectTimestamps&&(0===this.timestamps.length&&(this.startTime=t,this.decodedTime=t),this.timestamps.push({index:this.bits.byteLength<<3,time:t})),this.bits.write(e),this.canPlay=!0},t.prototype.seek=function(t){if(this.collectTimestamps){this.timestampIndex=0;for(var e=0;e<this.timestamps.length&&!(this.timestamps[e].time>t);e++)this.timestampIndex=e;var i=this.timestamps[this.timestampIndex];i?(this.bits.index=i.index,this.decodedTime=i.time):(this.bits.index=0,this.decodedTime=this.startTime)}},t.prototype.decode=function(){this.advanceDecodedTime(0)},t.prototype.advanceDecodedTime=function(t){if(this.collectTimestamps){for(var e=-1,i=this.timestampIndex;i<this.timestamps.length&&!(this.timestamps[i].index>this.bits.index);i++)e=i;if(e!==-1&&e!==this.timestampIndex)return this.timestampIndex=e,void(this.decodedTime=this.timestamps[this.timestampIndex].time)}this.decodedTime+=t},t.prototype.getCurrentTime=function(){return this.decodedTime},t}(),r.Decoder.MPEG1Video=function(){var t=function(t){r.Decoder.Base.call(this,t);var e=t.videoBufferSize||524288,i=t.streaming?r.BitBuffer.MODE.EVICT:r.BitBuffer.MODE.EXPAND;this.bits=new r.BitBuffer(e,i),this.customIntraQuantMatrix=new Uint8Array(64),this.customNonIntraQuantMatrix=new Uint8Array(64),this.blockData=new Int32Array(64),this.currentFrame=0,this.decodeFirstFrame=t.decodeFirstFrame!==!1};return t.prototype=Object.create(r.Decoder.Base.prototype),t.prototype.constructor=t,t.prototype.write=function(e,i){if(r.Decoder.Base.prototype.write.call(this,e,i),!this.hasSequenceHeader){if(this.bits.findStartCode(t.START.SEQUENCE)===-1)return!1;this.decodeSequenceHeader(),this.decodeFirstFrame&&this.decode()}},t.prototype.decode=function(){return!!this.hasSequenceHeader&&(this.bits.findStartCode(t.START.PICTURE)===-1?(this.bits.byteLength-(this.bits.index>>3),!1):(this.decodePicture(),this.advanceDecodedTime(1/this.frameRate),!0))},t.prototype.readHuffman=function(t){var e=0;do e=t[e+this.bits.read(1)];while(e>=0&&0!==t[e]);return t[e+2]},t.prototype.frameRate=30,t.prototype.decodeSequenceHeader=function(){var e=this.bits.read(12),i=this.bits.read(12);if(this.bits.skip(4),this.frameRate=t.PICTURE_RATE[this.bits.read(4)],this.bits.skip(30),e===this.width&&i===this.height||(this.width=e,this.height=i,this.initBuffers(),this.destination&&this.destination.resize(e,i)),this.bits.read(1)){for(var n=0;n<64;n++)this.customIntraQuantMatrix[t.ZIG_ZAG[n]]=this.bits.read(8);this.intraQuantMatrix=this.customIntraQuantMatrix}if(this.bits.read(1)){for(var n=0;n<64;n++){var r=t.ZIG_ZAG[n];this.customNonIntraQuantMatrix[r]=this.bits.read(8)}this.nonIntraQuantMatrix=this.customNonIntraQuantMatrix}this.hasSequenceHeader=!0},t.prototype.initBuffers=function(){this.intraQuantMatrix=t.DEFAULT_INTRA_QUANT_MATRIX,this.nonIntraQuantMatrix=t.DEFAULT_NON_INTRA_QUANT_MATRIX,this.mbWidth=this.width+15>>4,this.mbHeight=this.height+15>>4,this.mbSize=this.mbWidth*this.mbHeight,this.codedWidth=this.mbWidth<<4,this.codedHeight=this.mbHeight<<4,this.codedSize=this.codedWidth*this.codedHeight,this.halfWidth=this.mbWidth<<3,this.halfHeight=this.mbHeight<<3,this.currentY=new Uint8ClampedArray(this.codedSize),this.currentY32=new Uint32Array(this.currentY.buffer),this.currentCr=new Uint8ClampedArray(this.codedSize>>2),this.currentCr32=new Uint32Array(this.currentCr.buffer),this.currentCb=new Uint8ClampedArray(this.codedSize>>2),this.currentCb32=new Uint32Array(this.currentCb.buffer),this.forwardY=new Uint8ClampedArray(this.codedSize),this.forwardY32=new Uint32Array(this.forwardY.buffer),this.forwardCr=new Uint8ClampedArray(this.codedSize>>2),this.forwardCr32=new Uint32Array(this.forwardCr.buffer),this.forwardCb=new Uint8ClampedArray(this.codedSize>>2),this.forwardCb32=new Uint32Array(this.forwardCb.buffer)},t.prototype.currentY=null,t.prototype.currentCr=null,t.prototype.currentCb=null,t.prototype.pictureType=0,t.prototype.forwardY=null,t.prototype.forwardCr=null,t.prototype.forwardCb=null,
t.prototype.fullPelForward=!1,t.prototype.forwardFCode=0,t.prototype.forwardRSize=0,t.prototype.forwardF=0,t.prototype.decodePicture=function(e){if(this.currentFrame++,this.bits.skip(10),this.pictureType=this.bits.read(3),this.bits.skip(16),!(this.pictureType<=0||this.pictureType>=t.PICTURE_TYPE.B)){if(this.pictureType===t.PICTURE_TYPE.PREDICTIVE){if(this.fullPelForward=this.bits.read(1),this.forwardFCode=this.bits.read(3),0===this.forwardFCode)return;this.forwardRSize=this.forwardFCode-1,this.forwardF=1<<this.forwardRSize}var i=0;do i=this.bits.findNextStartCode();while(i===t.START.EXTENSION||i===t.START.USER_DATA);for(;i>=t.START.SLICE_FIRST&&i<=t.START.SLICE_LAST;)this.decodeSlice(255&i),i=this.bits.findNextStartCode();if(i!==-1&&this.bits.rewind(32),this.destination&&this.destination.render(this.currentY,this.currentCr,this.currentCb),this.pictureType===t.PICTURE_TYPE.INTRA||this.pictureType===t.PICTURE_TYPE.PREDICTIVE){var n=this.forwardY,r=this.forwardY32,s=this.forwardCr,o=this.forwardCr32,a=this.forwardCb,d=this.forwardCb32;this.forwardY=this.currentY,this.forwardY32=this.currentY32,this.forwardCr=this.currentCr,this.forwardCr32=this.currentCr32,this.forwardCb=this.currentCb,this.forwardCb32=this.currentCb32,this.currentY=n,this.currentY32=r,this.currentCr=s,this.currentCr32=o,this.currentCb=a,this.currentCb32=d}}},t.prototype.quantizerScale=0,t.prototype.sliceBegin=!1,t.prototype.decodeSlice=function(t){for(this.sliceBegin=!0,this.macroblockAddress=(t-1)*this.mbWidth-1,this.motionFwH=this.motionFwHPrev=0,this.motionFwV=this.motionFwVPrev=0,this.dcPredictorY=128,this.dcPredictorCr=128,this.dcPredictorCb=128,this.quantizerScale=this.bits.read(5);this.bits.read(1);)this.bits.skip(8);do this.decodeMacroblock();while(!this.bits.nextBytesAreStartCode())},t.prototype.macroblockAddress=0,t.prototype.mbRow=0,t.prototype.mbCol=0,t.prototype.macroblockType=0,t.prototype.macroblockIntra=!1,t.prototype.macroblockMotFw=!1,t.prototype.motionFwH=0,t.prototype.motionFwV=0,t.prototype.motionFwHPrev=0,t.prototype.motionFwVPrev=0,t.prototype.decodeMacroblock=function(){for(var e=0,i=this.readHuffman(t.MACROBLOCK_ADDRESS_INCREMENT);34===i;)i=this.readHuffman(t.MACROBLOCK_ADDRESS_INCREMENT);for(;35===i;)e+=33,i=this.readHuffman(t.MACROBLOCK_ADDRESS_INCREMENT);if(e+=i,this.sliceBegin)this.sliceBegin=!1,this.macroblockAddress+=e;else{if(this.macroblockAddress+e>=this.mbSize)return;for(e>1&&(this.dcPredictorY=128,this.dcPredictorCr=128,this.dcPredictorCb=128,this.pictureType===t.PICTURE_TYPE.PREDICTIVE&&(this.motionFwH=this.motionFwHPrev=0,this.motionFwV=this.motionFwVPrev=0));e>1;)this.macroblockAddress++,this.mbRow=this.macroblockAddress/this.mbWidth|0,this.mbCol=this.macroblockAddress%this.mbWidth,this.copyMacroblock(this.motionFwH,this.motionFwV,this.forwardY,this.forwardCr,this.forwardCb),e--;this.macroblockAddress++}this.mbRow=this.macroblockAddress/this.mbWidth|0,this.mbCol=this.macroblockAddress%this.mbWidth;var n=t.MACROBLOCK_TYPE[this.pictureType];this.macroblockType=this.readHuffman(n),this.macroblockIntra=1&this.macroblockType,this.macroblockMotFw=8&this.macroblockType,0!==(16&this.macroblockType)&&(this.quantizerScale=this.bits.read(5)),this.macroblockIntra?(this.motionFwH=this.motionFwHPrev=0,this.motionFwV=this.motionFwVPrev=0):(this.dcPredictorY=128,this.dcPredictorCr=128,this.dcPredictorCb=128,this.decodeMotionVectors(),this.copyMacroblock(this.motionFwH,this.motionFwV,this.forwardY,this.forwardCr,this.forwardCb));for(var r=0!==(2&this.macroblockType)?this.readHuffman(t.CODE_BLOCK_PATTERN):this.macroblockIntra?63:0,s=0,o=32;s<6;s++)0!==(r&o)&&this.decodeBlock(s),o>>=1},t.prototype.decodeMotionVectors=function(){var e,i,n=0;this.macroblockMotFw?(e=this.readHuffman(t.MOTION),0!==e&&1!==this.forwardF?(n=this.bits.read(this.forwardRSize),i=(Math.abs(e)-1<<this.forwardRSize)+n+1,e<0&&(i=-i)):i=e,this.motionFwHPrev+=i,this.motionFwHPrev>(this.forwardF<<4)-1?this.motionFwHPrev-=this.forwardF<<5:this.motionFwHPrev<-this.forwardF<<4&&(this.motionFwHPrev+=this.forwardF<<5),this.motionFwH=this.motionFwHPrev,this.fullPelForward&&(this.motionFwH<<=1),e=this.readHuffman(t.MOTION),0!==e&&1!==this.forwardF?(n=this.bits.read(this.forwardRSize),i=(Math.abs(e)-1<<this.forwardRSize)+n+1,e<0&&(i=-i)):i=e,this.motionFwVPrev+=i,this.motionFwVPrev>(this.forwardF<<4)-1?this.motionFwVPrev-=this.forwardF<<5:this.motionFwVPrev<-this.forwardF<<4&&(this.motionFwVPrev+=this.forwardF<<5),this.motionFwV=this.motionFwVPrev,this.fullPelForward&&(this.motionFwV<<=1)):this.pictureType===t.PICTURE_TYPE.PREDICTIVE&&(this.motionFwH=this.motionFwHPrev=0,this.motionFwV=this.motionFwVPrev=0)},t.prototype.copyMacroblock=function(t,e,i,n,r){var s,o,a,d,l,u,h,c,p,f=this.currentY32,v=this.currentCb32,m=this.currentCr32;s=this.codedWidth,o=s-16,a=t>>1,d=e>>1,l=1===(1&t),u=1===(1&e),h=((this.mbRow<<4)+d)*s+(this.mbCol<<4)+a,c=this.mbRow*s+this.mbCol<<2,p=c+(s<<2);var g,y,_,b;if(l)if(u)for(;c<p;){for(y=i[h]+i[h+s],h++,g=0;g<4;g++)_=i[h]+i[h+s],h++,b=y+_+2>>2&255,y=i[h]+i[h+s],h++,b|=y+_+2<<6&65280,_=i[h]+i[h+s],h++,b|=y+_+2<<14&16711680,y=i[h]+i[h+s],h++,b|=y+_+2<<22&4278190080,f[c++]=b;c+=o>>2,h+=o-1}else for(;c<p;){for(y=i[h++],g=0;g<4;g++)_=i[h++],b=y+_+1>>1&255,y=i[h++],b|=y+_+1<<7&65280,_=i[h++],b|=y+_+1<<15&16711680,y=i[h++],b|=y+_+1<<23&4278190080,f[c++]=b;c+=o>>2,h+=o-1}else if(u)for(;c<p;){for(g=0;g<4;g++)b=i[h]+i[h+s]+1>>1&255,h++,b|=i[h]+i[h+s]+1<<7&65280,h++,b|=i[h]+i[h+s]+1<<15&16711680,h++,b|=i[h]+i[h+s]+1<<23&4278190080,h++,f[c++]=b;c+=o>>2,h+=o}else for(;c<p;){for(g=0;g<4;g++)b=i[h],h++,b|=i[h]<<8,h++,b|=i[h]<<16,h++,b|=i[h]<<24,h++,f[c++]=b;c+=o>>2,h+=o}s=this.halfWidth,o=s-8,a=t/2>>1,d=e/2>>1,l=1===(t/2&1),u=1===(e/2&1),h=((this.mbRow<<3)+d)*s+(this.mbCol<<3)+a,c=this.mbRow*s+this.mbCol<<1,p=c+(s<<1);var w,A,k,T,C,E;if(l)if(u)for(;c<p;){for(w=n[h]+n[h+s],T=r[h]+r[h+s],h++,g=0;g<2;g++)A=n[h]+n[h+s],C=r[h]+r[h+s],h++,k=w+A+2>>2&255,E=T+C+2>>2&255,w=n[h]+n[h+s],T=r[h]+r[h+s],h++,k|=w+A+2<<6&65280,E|=T+C+2<<6&65280,A=n[h]+n[h+s],C=r[h]+r[h+s],h++,k|=w+A+2<<14&16711680,E|=T+C+2<<14&16711680,w=n[h]+n[h+s],T=r[h]+r[h+s],h++,k|=w+A+2<<22&4278190080,E|=T+C+2<<22&4278190080,m[c]=k,v[c]=E,c++;c+=o>>2,h+=o-1}else for(;c<p;){for(w=n[h],T=r[h],h++,g=0;g<2;g++)A=n[h],C=r[h++],k=w+A+1>>1&255,E=T+C+1>>1&255,w=n[h],T=r[h++],k|=w+A+1<<7&65280,E|=T+C+1<<7&65280,A=n[h],C=r[h++],k|=w+A+1<<15&16711680,E|=T+C+1<<15&16711680,w=n[h],T=r[h++],k|=w+A+1<<23&4278190080,E|=T+C+1<<23&4278190080,m[c]=k,v[c]=E,c++;c+=o>>2,h+=o-1}else if(u)for(;c<p;){for(g=0;g<2;g++)k=n[h]+n[h+s]+1>>1&255,E=r[h]+r[h+s]+1>>1&255,h++,k|=n[h]+n[h+s]+1<<7&65280,E|=r[h]+r[h+s]+1<<7&65280,h++,k|=n[h]+n[h+s]+1<<15&16711680,E|=r[h]+r[h+s]+1<<15&16711680,h++,k|=n[h]+n[h+s]+1<<23&4278190080,E|=r[h]+r[h+s]+1<<23&4278190080,h++,m[c]=k,v[c]=E,c++;c+=o>>2,h+=o}else for(;c<p;){for(g=0;g<2;g++)k=n[h],E=r[h],h++,k|=n[h]<<8,E|=r[h]<<8,h++,k|=n[h]<<16,E|=r[h]<<16,h++,k|=n[h]<<24,E|=r[h]<<24,h++,m[c]=k,v[c]=E,c++;c+=o>>2,h+=o}},t.prototype.dcPredictorY=0,t.prototype.dcPredictorCr=0,t.prototype.dcPredictorCb=0,t.prototype.blockData=null,t.prototype.decodeBlock=function(e){var i,n=0;if(this.macroblockIntra){var s,o;if(e<4?(s=this.dcPredictorY,o=this.readHuffman(t.DCT_DC_SIZE_LUMINANCE)):(s=4===e?this.dcPredictorCr:this.dcPredictorCb,o=this.readHuffman(t.DCT_DC_SIZE_CHROMINANCE)),o>0){var a=this.bits.read(o);0!==(a&1<<o-1)?this.blockData[0]=s+a:this.blockData[0]=s+(-1<<o|a+1)}else this.blockData[0]=s;e<4?this.dcPredictorY=this.blockData[0]:4===e?this.dcPredictorCr=this.blockData[0]:this.dcPredictorCb=this.blockData[0],this.blockData[0]<<=8,i=this.intraQuantMatrix,n=1}else i=this.nonIntraQuantMatrix;for(var d=0;;){var l=0,u=this.readHuffman(t.DCT_COEFF);if(1===u&&n>0&&0===this.bits.read(1))break;65535===u?(l=this.bits.read(6),d=this.bits.read(8),0===d?d=this.bits.read(8):128===d?d=this.bits.read(8)-256:d>128&&(d-=256)):(l=u>>8,d=255&u,this.bits.read(1)&&(d=-d)),n+=l;var h=t.ZIG_ZAG[n];n++,d<<=1,this.macroblockIntra||(d+=d<0?-1:1),d=d*this.quantizerScale*i[h]>>4,0===(1&d)&&(d-=d>0?1:-1),d>2047?d=2047:d<-2048&&(d=-2048),this.blockData[h]=d*t.PREMULTIPLIER_MATRIX[h]}var c,p,f;e<4?(c=this.currentY,f=this.codedWidth-8,p=this.mbRow*this.codedWidth+this.mbCol<<4,0!==(1&e)&&(p+=8),0!==(2&e)&&(p+=this.codedWidth<<3)):(c=4===e?this.currentCb:this.currentCr,f=(this.codedWidth>>1)-8,p=(this.mbRow*this.codedWidth<<2)+(this.mbCol<<3)),this.macroblockIntra?1===n?(t.CopyValueToDestination(this.blockData[0]+128>>8,c,p,f),this.blockData[0]=0):(t.IDCT(this.blockData),t.CopyBlockToDestination(this.blockData,c,p,f),r.Fill(this.blockData,0)):1===n?(t.AddValueToDestination(this.blockData[0]+128>>8,c,p,f),this.blockData[0]=0):(t.IDCT(this.blockData),t.AddBlockToDestination(this.blockData,c,p,f),r.Fill(this.blockData,0)),n=0},t.CopyBlockToDestination=function(t,e,i,n){for(var r=0;r<64;r+=8,i+=n+8)e[i+0]=t[r+0],e[i+1]=t[r+1],e[i+2]=t[r+2],e[i+3]=t[r+3],e[i+4]=t[r+4],e[i+5]=t[r+5],e[i+6]=t[r+6],e[i+7]=t[r+7]},t.AddBlockToDestination=function(t,e,i,n){for(var r=0;r<64;r+=8,i+=n+8)e[i+0]+=t[r+0],e[i+1]+=t[r+1],e[i+2]+=t[r+2],e[i+3]+=t[r+3],e[i+4]+=t[r+4],e[i+5]+=t[r+5],e[i+6]+=t[r+6],e[i+7]+=t[r+7]},t.CopyValueToDestination=function(t,e,i,n){for(var r=0;r<64;r+=8,i+=n+8)e[i+0]=t,e[i+1]=t,e[i+2]=t,e[i+3]=t,e[i+4]=t,e[i+5]=t,e[i+6]=t,e[i+7]=t},t.AddValueToDestination=function(t,e,i,n){for(var r=0;r<64;r+=8,i+=n+8)e[i+0]+=t,e[i+1]+=t,e[i+2]+=t,e[i+3]+=t,e[i+4]+=t,e[i+5]+=t,e[i+6]+=t,e[i+7]+=t},t.IDCT=function(t){for(var e,i,n,r,s,o,a,d,l,u,h,c,p,f,v,m,g,y,_=0;_<8;++_)e=t[32+_],i=t[16+_]+t[48+_],n=t[40+_]-t[24+_],o=t[8+_]+t[56+_],a=t[24+_]+t[40+_],r=t[8+_]-t[56+_],s=o+a,d=t[0+_],p=(473*r-196*n+128>>8)-s,l=p-(362*(o-a)+128>>8),u=d-e,h=(362*(t[16+_]-t[48+_])+128>>8)-i,c=d+e,f=u+h,v=c+i,m=u-h,g=c-i,y=-l-(473*n+196*r+128>>8),t[0+_]=s+v,t[8+_]=p+f,t[16+_]=m-l,t[24+_]=g-y,t[32+_]=g+y,t[40+_]=l+m,t[48+_]=f-p,t[56+_]=v-s;for(var _=0;_<64;_+=8)e=t[4+_],i=t[2+_]+t[6+_],n=t[5+_]-t[3+_],o=t[1+_]+t[7+_],a=t[3+_]+t[5+_],r=t[1+_]-t[7+_],s=o+a,d=t[0+_],p=(473*r-196*n+128>>8)-s,l=p-(362*(o-a)+128>>8),u=d-e,h=(362*(t[2+_]-t[6+_])+128>>8)-i,c=d+e,f=u+h,v=c+i,m=u-h,g=c-i,y=-l-(473*n+196*r+128>>8),t[0+_]=s+v+128>>8,t[1+_]=p+f+128>>8,t[2+_]=m-l+128>>8,t[3+_]=g-y+128>>8,t[4+_]=g+y+128>>8,t[5+_]=l+m+128>>8,t[6+_]=f-p+128>>8,t[7+_]=v-s+128>>8},t.PICTURE_RATE=[0,23.976,24,25,29.97,30,50,59.94,60,0,0,0,0,0,0,0],t.ZIG_ZAG=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),t.DEFAULT_INTRA_QUANT_MATRIX=new Uint8Array([8,16,19,22,26,27,29,34,16,16,22,24,27,29,34,37,19,22,26,27,29,34,34,38,22,22,26,27,29,34,37,40,22,26,27,29,32,35,40,48,26,27,29,32,35,40,48,58,26,27,29,34,38,46,56,69,27,29,35,38,46,56,69,83]),t.DEFAULT_NON_INTRA_QUANT_MATRIX=new Uint8Array([16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16]),t.PREMULTIPLIER_MATRIX=new Uint8Array([32,44,42,38,32,25,17,9,44,62,58,52,44,35,24,12,42,58,55,49,42,33,23,12,38,52,49,44,38,30,20,10,32,44,42,38,32,25,17,9,25,35,33,30,25,20,14,7,17,24,23,20,17,14,9,5,9,12,12,10,9,7,5,2]),t.MACROBLOCK_ADDRESS_INCREMENT=new Int16Array([3,6,0,9,12,0,0,0,1,15,18,0,21,24,0,27,30,0,33,36,0,0,0,3,0,0,2,39,42,0,45,48,0,0,0,5,0,0,4,51,54,0,57,60,0,0,0,7,0,0,6,63,66,0,69,72,0,75,78,0,81,84,0,-1,87,0,-1,90,0,93,96,0,99,102,0,105,108,0,111,114,0,0,0,9,0,0,8,117,120,0,123,126,0,129,132,0,135,138,0,0,0,15,0,0,14,0,0,13,0,0,12,0,0,11,0,0,10,141,-1,0,-1,144,0,147,150,0,153,156,0,159,162,0,165,168,0,171,174,0,177,180,0,183,-1,0,-1,186,0,189,192,0,195,198,0,201,204,0,207,210,0,213,216,0,219,222,0,0,0,21,0,0,20,0,0,19,0,0,18,0,0,17,0,0,16,0,0,35,0,0,34,0,0,33,0,0,32,0,0,31,0,0,30,0,0,29,0,0,28,0,0,27,0,0,26,0,0,25,0,0,24,0,0,23,0,0,22]),t.MACROBLOCK_TYPE_INTRA=new Int8Array([3,6,0,-1,9,0,0,0,1,0,0,17]),t.MACROBLOCK_TYPE_PREDICTIVE=new Int8Array([3,6,0,9,12,0,0,0,10,15,18,0,0,0,2,21,24,0,0,0,8,27,30,0,33,36,0,-1,39,0,0,0,18,0,0,26,0,0,1,0,0,17]),t.MACROBLOCK_TYPE_B=new Int8Array([3,6,0,9,15,0,12,18,0,24,21,0,0,0,12,27,30,0,0,0,14,39,42,0,36,33,0,0,0,4,0,0,6,54,48,0,45,51,0,0,0,8,0,0,10,-1,57,0,0,0,1,60,63,0,0,0,30,0,0,17,0,0,22,0,0,26]),t.MACROBLOCK_TYPE=[null,t.MACROBLOCK_TYPE_INTRA,t.MACROBLOCK_TYPE_PREDICTIVE,t.MACROBLOCK_TYPE_B],t.CODE_BLOCK_PATTERN=new Int16Array([6,3,0,9,18,0,12,15,0,24,33,0,36,39,0,27,21,0,30,42,0,60,57,0,54,48,0,69,51,0,81,75,0,63,84,0,45,66,0,72,78,0,0,0,60,105,120,0,132,144,0,114,108,0,126,141,0,87,93,0,117,96,0,0,0,32,135,138,0,99,123,0,129,102,0,0,0,4,90,111,0,0,0,8,0,0,16,0,0,44,150,168,0,0,0,28,0,0,52,0,0,62,183,177,0,156,180,0,0,0,1,165,162,0,0,0,61,0,0,56,171,174,0,0,0,2,0,0,40,153,186,0,0,0,48,192,189,0,147,159,0,0,0,20,0,0,12,240,249,0,0,0,63,231,225,0,195,219,0,252,198,0,0,0,24,0,0,36,0,0,3,207,261,0,243,237,0,204,213,0,210,234,0,201,228,0,216,222,0,258,255,0,264,246,0,-1,282,0,285,291,0,0,0,33,0,0,9,318,330,0,306,348,0,0,0,5,0,0,10,279,267,0,0,0,6,0,0,18,0,0,17,0,0,34,339,357,0,309,312,0,270,276,0,327,321,0,351,354,0,303,297,0,294,288,0,300,273,0,342,345,0,315,324,0,336,333,0,363,375,0,0,0,41,0,0,14,0,0,21,372,366,0,360,369,0,0,0,11,0,0,19,0,0,7,0,0,35,0,0,13,0,0,50,0,0,49,0,0,58,0,0,37,0,0,25,0,0,45,0,0,57,0,0,26,0,0,29,0,0,38,0,0,53,0,0,23,0,0,43,0,0,46,0,0,42,0,0,22,0,0,54,0,0,51,0,0,15,0,0,30,0,0,39,0,0,47,0,0,55,0,0,27,0,0,59,0,0,31]),t.MOTION=new Int16Array([3,6,0,12,9,0,0,0,0,18,15,0,24,21,0,0,0,-1,0,0,1,27,30,0,36,33,0,0,0,2,0,0,-2,42,45,0,48,39,0,60,54,0,0,0,3,0,0,-3,51,57,0,-1,69,0,81,75,0,78,63,0,72,66,0,96,84,0,87,93,0,-1,99,0,108,105,0,0,0,-4,90,102,0,0,0,4,0,0,-7,0,0,5,111,123,0,0,0,-5,0,0,7,114,120,0,126,117,0,0,0,-6,0,0,6,153,162,0,150,147,0,135,138,0,156,141,0,129,159,0,132,144,0,0,0,10,0,0,9,0,0,8,0,0,-8,171,198,0,0,0,-9,180,192,0,168,183,0,165,186,0,174,189,0,0,0,-10,177,195,0,0,0,12,0,0,16,0,0,13,0,0,14,0,0,11,0,0,15,0,0,-16,0,0,-12,0,0,-14,0,0,-15,0,0,-11,0,0,-13]),t.DCT_DC_SIZE_LUMINANCE=new Int8Array([6,3,0,18,15,0,9,12,0,0,0,1,0,0,2,27,24,0,21,30,0,0,0,0,36,33,0,0,0,4,0,0,3,39,42,0,0,0,5,0,0,6,48,45,0,51,-1,0,0,0,7,0,0,8]),t.DCT_DC_SIZE_CHROMINANCE=new Int8Array([6,3,0,12,9,0,18,15,0,24,21,0,0,0,2,0,0,1,0,0,0,30,27,0,0,0,3,36,33,0,0,0,4,42,39,0,0,0,5,48,45,0,0,0,6,51,-1,0,0,0,7,0,0,8]),t.DCT_COEFF=new Int32Array([3,6,0,12,9,0,0,0,1,21,24,0,18,15,0,39,27,0,33,30,0,42,36,0,0,0,257,60,66,0,54,63,0,48,57,0,0,0,513,51,45,0,0,0,2,0,0,3,81,75,0,87,93,0,72,78,0,96,90,0,0,0,1025,69,84,0,0,0,769,0,0,258,0,0,1793,0,0,65535,0,0,1537,111,108,0,0,0,1281,105,102,0,117,114,0,99,126,0,120,123,0,156,150,0,162,159,0,144,147,0,129,135,0,138,132,0,0,0,2049,0,0,4,0,0,514,0,0,2305,153,141,0,165,171,0,180,168,0,177,174,0,183,186,0,0,0,2561,0,0,3329,0,0,6,0,0,259,0,0,5,0,0,770,0,0,2817,0,0,3073,228,225,0,201,210,0,219,213,0,234,222,0,216,231,0,207,192,0,204,189,0,198,195,0,243,261,0,273,240,0,246,237,0,249,258,0,279,276,0,252,255,0,270,282,0,264,267,0,0,0,515,0,0,260,0,0,7,0,0,1026,0,0,1282,0,0,4097,0,0,3841,0,0,3585,315,321,0,333,342,0,312,291,0,375,357,0,288,294,0,-1,369,0,285,303,0,318,363,0,297,306,0,339,309,0,336,348,0,330,300,0,372,345,0,351,366,0,327,354,0,360,324,0,381,408,0,417,420,0,390,378,0,435,438,0,384,387,0,0,0,2050,396,402,0,465,462,0,0,0,8,411,399,0,429,432,0,453,414,0,426,423,0,0,0,10,0,0,9,0,0,11,0,0,5377,0,0,1538,0,0,771,0,0,5121,0,0,1794,0,0,4353,0,0,4609,0,0,4865,444,456,0,0,0,1027,459,450,0,0,0,261,393,405,0,0,0,516,447,441,0,516,519,0,486,474,0,510,483,0,504,498,0,471,537,0,507,501,0,522,513,0,534,531,0,468,477,0,492,495,0,549,546,0,525,528,0,0,0,263,0,0,2562,0,0,2306,0,0,5633,0,0,5889,0,0,6401,0,0,6145,0,0,1283,0,0,772,0,0,13,0,0,12,0,0,14,0,0,15,0,0,517,0,0,6657,0,0,262,540,543,0,480,489,0,588,597,0,0,0,27,609,555,0,606,603,0,0,0,19,0,0,22,591,621,0,0,0,18,573,576,0,564,570,0,0,0,20,552,582,0,0,0,21,558,579,0,0,0,23,612,594,0,0,0,25,0,0,24,600,615,0,0,0,31,0,0,30,0,0,28,0,0,29,0,0,26,0,0,17,0,0,16,567,618,0,561,585,0,654,633,0,0,0,37,645,648,0,0,0,36,630,636,0,0,0,34,639,627,0,663,666,0,657,624,0,651,642,0,669,660,0,0,0,35,0,0,267,0,0,40,0,0,268,0,0,266,0,0,32,0,0,264,0,0,265,0,0,38,0,0,269,0,0,270,0,0,33,0,0,39,0,0,7937,0,0,6913,0,0,7681,0,0,4098,0,0,7425,0,0,7169,0,0,271,0,0,274,0,0,273,0,0,272,0,0,1539,0,0,2818,0,0,3586,0,0,3330,0,0,3074,0,0,3842]),t.PICTURE_TYPE={INTRA:1,PREDICTIVE:2,B:3},t.START={SEQUENCE:179,SLICE_FIRST:1,SLICE_LAST:175,PICTURE:0,EXTENSION:181,USER_DATA:178},t}(),r.Decoder.MP2Audio=function(){var t=function t(e){r.Decoder.Base.call(this,e);var i=e.audioBufferSize||131072,n=e.streaming?r.BitBuffer.MODE.EVICT:r.BitBuffer.MODE.EXPAND;this.bits=new r.BitBuffer(i,n),this.left=new Float32Array(1152),this.right=new Float32Array(1152),this.sampleRate=44100,this.D=new Float32Array(1024),this.D.set(t.SYNTHESIS_WINDOW,0),this.D.set(t.SYNTHESIS_WINDOW,512),this.V=new Float32Array(1024),this.U=new Int32Array(32),this.VPos=0,this.allocation=[new Array(32),new Array(32)],this.scaleFactorInfo=[new Uint8Array(32),new Uint8Array(32)],this.scaleFactor=[new Array(32),new Array(32)],this.sample=[new Array(32),new Array(32)];for(var s=0;s<2;s++)for(var o=0;o<32;o++)this.scaleFactor[s][o]=[0,0,0],this.sample[s][o]=[0,0,0]};return t.prototype=Object.create(r.Decoder.Base.prototype),t.prototype.constructor=t,t.prototype.decode=function(){var t=this.bits.index>>3;if(t>=this.bits.byteLength)return!1;var e=this.decodeFrame(this.left,this.right);return this.bits.index=t+e<<3,!!e&&(this.destination&&this.destination.play(this.sampleRate,this.left,this.right),this.advanceDecodedTime(this.left.length/this.sampleRate),!0)},t.prototype.getCurrentTime=function(){var t=this.destination?this.destination.enqueuedTime:0;return this.decodedTime-t},t.prototype.decodeFrame=function(e,i){var n=this.bits.read(11),s=this.bits.read(2),o=this.bits.read(2),a=!this.bits.read(1);if(n!==t.FRAME_SYNC||s!==t.VERSION.MPEG_1||o!==t.LAYER.II)return 0;var d=this.bits.read(4)-1;if(d>13)return 0;var l=this.bits.read(2),u=t.SAMPLE_RATE[l];if(3===l)return 0;s===t.VERSION.MPEG_2&&(l+=4,d+=14);var h=this.bits.read(1),c=(this.bits.read(1),this.bits.read(2)),p=0;c===t.MODE.JOINT_STEREO?p=this.bits.read(2)+1<<2:(this.bits.skip(2),p=c===t.MODE.MONO?0:32),this.bits.skip(4),a&&this.bits.skip(16);var f=t.BIT_RATE[d],u=t.SAMPLE_RATE[l],v=144e3*f/u+h|0,m=0,g=0;if(s===t.VERSION.MPEG_2)m=2,g=30;else{var y=c===t.MODE.MONO?0:1,_=t.QUANT_LUT_STEP_1[y][d];m=t.QUANT_LUT_STEP_2[_][l],g=63&m,m>>=6}p>g&&(p=g);for(var b=0;b<p;b++)this.allocation[0][b]=this.readAllocation(b,m),this.allocation[1][b]=this.readAllocation(b,m);for(var b=p;b<g;b++)this.allocation[0][b]=this.allocation[1][b]=this.readAllocation(b,m);for(var w=c===t.MODE.MONO?1:2,b=0;b<g;b++){for(A=0;A<w;A++)this.allocation[A][b]&&(this.scaleFactorInfo[A][b]=this.bits.read(2));c===t.MODE.MONO&&(this.scaleFactorInfo[1][b]=this.scaleFactorInfo[0][b])}for(var b=0;b<g;b++){for(var A=0;A<w;A++)if(this.allocation[A][b]){var k=this.scaleFactor[A][b];switch(this.scaleFactorInfo[A][b]){case 0:k[0]=this.bits.read(6),k[1]=this.bits.read(6),k[2]=this.bits.read(6);break;case 1:k[0]=k[1]=this.bits.read(6),k[2]=this.bits.read(6);break;case 2:k[0]=k[1]=k[2]=this.bits.read(6);break;case 3:k[0]=this.bits.read(6),k[1]=k[2]=this.bits.read(6)}}c===t.MODE.MONO&&(this.scaleFactor[1][b][0]=this.scaleFactor[0][b][0],this.scaleFactor[1][b][1]=this.scaleFactor[0][b][1],this.scaleFactor[1][b][2]=this.scaleFactor[0][b][2])}for(var T=0,C=0;C<3;C++)for(var E=0;E<4;E++){for(var b=0;b<p;b++)this.readSamples(0,b,C),this.readSamples(1,b,C);for(var b=p;b<g;b++)this.readSamples(0,b,C),this.sample[1][b][0]=this.sample[0][b][0],this.sample[1][b][1]=this.sample[0][b][1],this.sample[1][b][2]=this.sample[0][b][2];for(var b=g;b<32;b++)this.sample[0][b][0]=0,this.sample[0][b][1]=0,this.sample[0][b][2]=0,this.sample[1][b][0]=0,this.sample[1][b][1]=0,this.sample[1][b][2]=0;for(var P=0;P<3;P++){this.VPos=this.VPos-64&1023;for(var A=0;A<2;A++){t.MatrixTransform(this.sample[A],P,this.V,this.VPos),r.Fill(this.U,0);for(var S=512-(this.VPos>>1),I=this.VPos%128>>1;I<1024;){for(var V=0;V<32;++V)this.U[V]+=this.D[S++]*this.V[I++];I+=96,S+=32}for(I=1120-I,S-=480;I<1024;){for(var V=0;V<32;++V)this.U[V]+=this.D[S++]*this.V[I++];I+=96,S+=32}for(var x=0===A?e:i,O=0;O<32;O++)x[T+O]=this.U[O]/2147418112}T+=32}}return this.sampleRate=u,v},t.prototype.readAllocation=function(e,i){var n=t.QUANT_LUT_STEP_3[i][e],r=t.QUANT_LUT_STEP4[15&n][this.bits.read(n>>4)];return r?t.QUANT_TAB[r-1]:0},t.prototype.readSamples=function(e,i,n){var r=this.allocation[e][i],s=this.scaleFactor[e][i][n],o=this.sample[e][i],a=0;if(!r)return void(o[0]=o[1]=o[2]=0);if(63===s)s=0;else{var d=s/3|0;s=t.SCALEFACTOR_BASE[s%3]+(1<<d>>1)>>d}var l=r.levels;r.group?(a=this.bits.read(r.bits),o[0]=a%l,a=a/l|0,o[1]=a%l,o[2]=a/l|0):(o[0]=this.bits.read(r.bits),o[1]=this.bits.read(r.bits),o[2]=this.bits.read(r.bits));var u=65536/(l+1)|0;l=(l+1>>1)-1,a=(l-o[0])*u,o[0]=a*(s>>12)+(a*(4095&s)+2048>>12)>>12,a=(l-o[1])*u,o[1]=a*(s>>12)+(a*(4095&s)+2048>>12)>>12,a=(l-o[2])*u,o[2]=a*(s>>12)+(a*(4095&s)+2048>>12)>>12},t.MatrixTransform=function(t,e,i,n){var r,s,o,a,d,l,u,h,c,p,f,v,m,g,y,_,b,w,A,k,T,C,E,P,S,I,V,x,O,D,M,F,L;r=t[0][e]+t[31][e],s=.500602998235*(t[0][e]-t[31][e]),o=t[1][e]+t[30][e],a=.505470959898*(t[1][e]-t[30][e]),d=t[2][e]+t[29][e],l=.515447309923*(t[2][e]-t[29][e]),u=t[3][e]+t[28][e],h=.53104259109*(t[3][e]-t[28][e]),c=t[4][e]+t[27][e],p=.553103896034*(t[4][e]-t[27][e]),f=t[5][e]+t[26][e],v=.582934968206*(t[5][e]-t[26][e]),m=t[6][e]+t[25][e],g=.622504123036*(t[6][e]-t[25][e]),y=t[7][e]+t[24][e],_=.674808341455*(t[7][e]-t[24][e]),b=t[8][e]+t[23][e],w=.744536271002*(t[8][e]-t[23][e]),A=t[9][e]+t[22][e],k=.839349645416*(t[9][e]-t[22][e]),T=t[10][e]+t[21][e],C=.972568237862*(t[10][e]-t[21][e]),E=t[11][e]+t[20][e],P=1.16943993343*(t[11][e]-t[20][e]),S=t[12][e]+t[19][e],I=1.48416461631*(t[12][e]-t[19][e]),V=t[13][e]+t[18][e],x=2.05778100995*(t[13][e]-t[18][e]),O=t[14][e]+t[17][e],D=3.40760841847*(t[14][e]-t[17][e]),M=t[15][e]+t[16][e],F=10.1900081235*(t[15][e]-t[16][e]),L=r+M,M=.502419286188*(r-M),r=o+O,O=.52249861494*(o-O),o=d+V,V=.566944034816*(d-V),d=u+S,S=.64682178336*(u-S),u=c+E,E=.788154623451*(c-E),c=f+T,T=1.06067768599*(f-T),f=m+A,A=1.72244709824*(m-A),m=y+b,b=5.10114861869*(y-b),y=L+m,m=.509795579104*(L-m),L=r+f,r=.601344886935*(r-f),f=o+c,c=.899976223136*(o-c),o=d+u,u=2.56291544774*(d-u),d=y+o,y=.541196100146*(y-o),o=L+f,f=1.30656296488*(L-f),L=d+o,d=.707106781187*(d-o),o=y+f,y=.707106781187*(y-f),o+=y,f=m+u,m=.541196100146*(m-u),u=r+c,c=1.30656296488*(r-c),r=f+u,u=.707106781187*(f-u),f=m+c,m=.707106781187*(m-c),f+=m,r+=f,f+=u,u+=m,c=M+b,M=.509795579104*(M-b),b=O+A,O=.601344886935*(O-A),A=V+T,T=.899976223136*(V-T),V=S+E,E=2.56291544774*(S-E),S=c+V,c=.541196100146*(c-V),V=b+A,A=1.30656296488*(b-A),b=S+V,V=.707106781187*(S-V),S=c+A,A=.707106781187*(c-A),S+=A,c=M+E,M=.541196100146*(M-E),E=O+T,T=1.30656296488*(O-T),O=c+E,E=.707106781187*(c-E),c=M+T,M=.707106781187*(M-T),c+=M,O+=c,c+=E,E+=M,b+=O,O+=S,S+=c,c+=V,V+=E,E+=A,A+=M,T=s+F,s=.502419286188*(s-F),F=a+D,a=.52249861494*(a-D),D=l+x,x=.566944034816*(l-x),l=h+I,h=.64682178336*(h-I),I=p+P,p=.788154623451*(p-P),P=v+C,C=1.06067768599*(v-C),v=g+k,k=1.72244709824*(g-k),g=_+w,_=5.10114861869*(_-w),w=T+g,g=.509795579104*(T-g),T=F+v,F=.601344886935*(F-v),v=D+P,P=.899976223136*(D-P),D=l+I,I=2.56291544774*(l-I),l=w+D,w=.541196100146*(w-D),D=T+v,v=1.30656296488*(T-v),T=l+D,D=.707106781187*(l-D),l=w+v,v=.707106781187*(w-v),l+=v,w=g+I,I=.541196100146*(g-I),g=F+P,P=1.30656296488*(F-P),F=w+g,g=.707106781187*(w-g),w=I+P,P=.707106781187*(I-P),w+=P,F+=w,w+=g,I=g+P,g=s+_,s=.509795579104*(s-_),_=a+k,a=.601344886935*(a-k),k=x+C,C=.899976223136*(x-C),x=h+p,p=2.56291544774*(h-p),h=g+x,g=.541196100146*(g-x),x=_+k,k=1.30656296488*(_-k),_=h+x,x=.707106781187*(h-x),h=g+k,k=.707106781187*(g-k),h+=k,g=s+p,s=.541196100146*(s-p),p=a+C,C=1.30656296488*(a-C),a=g+p,p=.707106781187*(g-p),g=s+C,s=.707106781187*(s-C),g+=s,a+=g,g+=p,p+=s,_+=a,a+=h,h+=g,g+=x,x+=p,p+=k,k+=s,T+=_,_+=F,F+=a,a+=l,l+=h,h+=w;w+=g;g+=D,D+=x,x+=I,I+=p,p+=v,v+=k,k+=P,P+=s,i[n+48]=-L,i[n+49]=i[n+47]=-T,i[n+50]=i[n+46]=-b,i[n+51]=i[n+45]=-_,i[n+52]=i[n+44]=-r,i[n+53]=i[n+43]=-F,i[n+54]=i[n+42]=-O,i[n+55]=i[n+41]=-a,i[n+56]=i[n+40]=-o,i[n+57]=i[n+39]=-l,i[n+58]=i[n+38]=-S,i[n+59]=i[n+37]=-h,i[n+60]=i[n+36]=-f,i[n+61]=i[n+35]=-w,i[n+62]=i[n+34]=-c,i[n+63]=i[n+33]=-g,i[n+32]=-d,i[n+0]=d,i[n+31]=-D,i[n+1]=D,i[n+30]=-V,i[n+2]=V,i[n+29]=-x,i[n+3]=x,i[n+28]=-u,i[n+4]=u,i[n+27]=-I,i[n+5]=I,i[n+26]=-E,i[n+6]=E,i[n+25]=-p,i[n+7]=p,i[n+24]=-y,i[n+8]=y,i[n+23]=-v,i[n+9]=v,i[n+22]=-A,i[n+10]=A,i[n+21]=-k,i[n+11]=k,i[n+20]=-m,i[n+12]=m,i[n+19]=-P,i[n+13]=P,i[n+18]=-M,i[n+14]=M,i[n+17]=-s,i[n+15]=s,i[n+16]=0},t.FRAME_SYNC=2047,t.VERSION={MPEG_2_5:0,MPEG_2:2,MPEG_1:3},t.LAYER={III:1,II:2,I:3},t.MODE={STEREO:0,JOINT_STEREO:1,DUAL_CHANNEL:2,MONO:3},t.SAMPLE_RATE=new Uint16Array([44100,48e3,32e3,0,22050,24e3,16e3,0]),t.BIT_RATE=new Uint16Array([32,48,56,64,80,96,112,128,160,192,224,256,320,384,8,16,24,32,40,48,56,64,80,96,112,128,144,160]),t.SCALEFACTOR_BASE=new Uint32Array([33554432,26632170,21137968]),t.SYNTHESIS_WINDOW=new Float32Array([0,-.5,-.5,-.5,-.5,-.5,-.5,-1,-1,-1,-1,-1.5,-1.5,-2,-2,-2.5,-2.5,-3,-3.5,-3.5,-4,-4.5,-5,-5.5,-6.5,-7,-8,-8.5,-9.5,-10.5,-12,-13,-14.5,-15.5,-17.5,-19,-20.5,-22.5,-24.5,-26.5,-29,-31.5,-34,-36.5,-39.5,-42.5,-45.5,-48.5,-52,-55.5,-58.5,-62.5,-66,-69.5,-73.5,-77,-80.5,-84.5,-88,-91.5,-95,-98,-101,-104,106.5,109,111,112.5,113.5,114,114,113.5,112,110.5,107.5,104,100,94.5,88.5,81.5,73,63.5,53,41.5,28.5,14.5,-1,-18,-36,-55.5,-76.5,-98.5,-122,-147,-173.5,-200.5,-229.5,-259.5,-290.5,-322.5,-355.5,-389.5,-424,-459.5,-495.5,-532,-568.5,-605,-641.5,-678,-714,-749,-783.5,-817,-849,-879.5,-908.5,-935,-959.5,-981,-1000.5,-1016,-1028.5,-1037.5,-1042.5,-1043.5,-1040,-1031.5,1018.5,1e3,976,946.5,911,869.5,822,767.5,707,640,565.5,485,397,302.5,201,92.5,-22.5,-144,-272.5,-407,-547.5,-694,-846,-1003,-1165,-1331.5,-1502,-1675.5,-1852.5,-2031.5,-2212.5,-2394,-2576.5,-2758.5,-2939.5,-3118.5,-3294.5,-3467.5,-3635.5,-3798.5,-3955,-4104.5,-4245.5,-4377.5,-4499,-4609.5,-4708,-4792.5,-4863.5,-4919,-4958,-4979.5,-4983,-4967.5,-4931.5,-4875,-4796,-4694.5,-4569.5,-4420,-4246,-4046,-3820,-3567,3287,2979.5,2644,2280.5,1888,1467.5,1018.5,541,35,-499,-1061,-1650,-2266.5,-2909,-3577,-4270,-4987.5,-5727.5,-6490,-7274,-8077.5,-8899.5,-9739,-10594.5,-11464.5,-12347,-13241,-14144.5,-15056,-15973.5,-16895.5,-17820,-18744.5,-19668,-20588,-21503,-22410.5,-23308.5,-24195,-25068.5,-25926.5,-26767,-27589,-28389,-29166.5,-29919,-30644.5,-31342,-32009.5,-32645,-33247,-33814.5,-34346,-34839.5,-35295,-35710,-36084.5,-36417.5,-36707.5,-36954,-37156.5,-37315,-37428,-37496,37519,37496,37428,37315,37156.5,36954,36707.5,36417.5,36084.5,35710,35295,34839.5,34346,33814.5,33247,32645,32009.5,31342,30644.5,29919,29166.5,28389,27589,26767,25926.5,25068.5,24195,23308.5,22410.5,21503,20588,19668,18744.5,17820,16895.5,15973.5,15056,14144.5,13241,12347,11464.5,10594.5,9739,8899.5,8077.5,7274,6490,5727.5,4987.5,4270,3577,2909,2266.5,1650,1061,499,-35,-541,-1018.5,-1467.5,-1888,-2280.5,-2644,-2979.5,3287,3567,3820,4046,4246,4420,4569.5,4694.5,4796,4875,4931.5,4967.5,4983,4979.5,4958,4919,4863.5,4792.5,4708,4609.5,4499,4377.5,4245.5,4104.5,3955,3798.5,3635.5,3467.5,3294.5,3118.5,2939.5,2758.5,2576.5,2394,2212.5,2031.5,1852.5,1675.5,1502,1331.5,1165,1003,846,694,547.5,407,272.5,144,22.5,-92.5,-201,-302.5,-397,-485,-565.5,-640,-707,-767.5,-822,-869.5,-911,-946.5,-976,-1e3,1018.5,1031.5,1040,1043.5,1042.5,1037.5,1028.5,1016,1000.5,981,959.5,935,908.5,879.5,849,817,783.5,749,714,678,641.5,605,568.5,532,495.5,459.5,424,389.5,355.5,322.5,290.5,259.5,229.5,200.5,173.5,147,122,98.5,76.5,55.5,36,18,1,-14.5,-28.5,-41.5,-53,-63.5,-73,-81.5,-88.5,-94.5,-100,-104,-107.5,-110.5,-112,-113.5,-114,-114,-113.5,-112.5,-111,-109,106.5,104,101,98,95,91.5,88,84.5,80.5,77,73.5,69.5,66,62.5,58.5,55.5,52,48.5,45.5,42.5,39.5,36.5,34,31.5,29,26.5,24.5,22.5,20.5,19,17.5,15.5,14.5,13,12,10.5,9.5,8.5,8,7,6.5,5.5,5,4.5,4,3.5,3.5,3,2.5,2.5,2,2,1.5,1.5,1,1,1,1,.5,.5,.5,.5,.5,.5]),t.QUANT_LUT_STEP_1=[[0,0,1,1,1,2,2,2,2,2,2,2,2,2],[0,0,0,0,0,0,1,1,1,2,2,2,2,2]],t.QUANT_TAB={A:91,B:94,C:8,D:12},t.QUANT_LUT_STEP_2=[[t.QUANT_TAB.C,t.QUANT_TAB.C,t.QUANT_TAB.D],[t.QUANT_TAB.A,t.QUANT_TAB.A,t.QUANT_TAB.A],[t.QUANT_TAB.B,t.QUANT_TAB.A,t.QUANT_TAB.B]],t.QUANT_LUT_STEP_3=[[68,68,52,52,52,52,52,52,52,52,52,52],[67,67,67,66,66,66,66,66,66,66,66,49,49,49,49,49,49,49,49,49,49,49,49,32,32,32,32,32,32,32],[69,69,69,69,52,52,52,52,52,52,52,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36]],t.QUANT_LUT_STEP4=[[0,1,2,17],[0,1,2,3,4,5,6,17],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,17],[0,1,3,5,6,7,8,9,10,11,12,13,14,15,16,17],[0,1,2,4,5,6,7,8,9,10,11,12,13,14,15,17],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]],t.QUANT_TAB=[{levels:3,group:1,bits:5},{levels:5,group:1,bits:7},{levels:7,group:0,bits:3},{levels:9,group:1,bits:10},{levels:15,group:0,bits:4},{levels:31,group:0,bits:5},{levels:63,group:0,bits:6},{levels:127,group:0,bits:7},{levels:255,group:0,bits:8},{levels:511,group:0,bits:9},{levels:1023,group:0,bits:10},{levels:2047,group:0,bits:11},{levels:4095,group:0,bits:12},{levels:8191,group:0,bits:13},{levels:16383,group:0,bits:14},{levels:32767,group:0,bits:15},{levels:65535,group:0,bits:16}],t}(),r.Renderer.WebGL=function(){var t=function t(e){this.canvas=e.canvas||document.createElement("canvas"),this.width=this.canvas.width,this.height=this.canvas.height,this.enabled=!0;var i={preserveDrawingBuffer:!!e.preserveDrawingBuffer,alpha:!1,depth:!1,stencil:!1,antialias:!1};if(this.gl=this.canvas.getContext("webgl",i)||this.canvas.getContext("experimental-webgl",i),!this.gl)throw new Error("Failed to get WebGL Context");var n=this.gl,r=null,s=n.createBuffer(),o=new Float32Array([0,0,0,1,1,0,1,1]);n.bindBuffer(n.ARRAY_BUFFER,s),n.bufferData(n.ARRAY_BUFFER,o,n.STATIC_DRAW),this.program=this.createProgram(t.SHADER.VERTEX_IDENTITY,t.SHADER.FRAGMENT_YCRCB_TO_RGBA),r=n.getAttribLocation(this.program,"vertex"),n.enableVertexAttribArray(r),n.vertexAttribPointer(r,2,n.FLOAT,!1,0,0),this.textureY=this.createTexture(0,"textureY"),this.textureCb=this.createTexture(1,"textureCb"),this.textureCr=this.createTexture(2,"textureCr"),this.loadingProgram=this.createProgram(t.SHADER.VERTEX_IDENTITY,t.SHADER.FRAGMENT_LOADING),r=n.getAttribLocation(this.loadingProgram,"vertex"),n.enableVertexAttribArray(r),n.vertexAttribPointer(r,2,n.FLOAT,!1,0,0),this.shouldCreateUnclampedViews=!this.allowsClampedTextureData()};return t.prototype.resize=function(t,e){this.width=0|t,this.height=0|e,this.canvas.width=this.width,this.canvas.height=this.height,this.gl.useProgram(this.program),this.gl.viewport(0,0,this.width,this.height)},t.prototype.createTexture=function(t,e){var i=this.gl,n=i.createTexture();return i.bindTexture(i.TEXTURE_2D,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.uniform1i(i.getUniformLocation(this.program,e),t),n},t.prototype.createProgram=function(t,e){var i=this.gl,n=i.createProgram();return i.attachShader(n,this.compileShader(i.VERTEX_SHADER,t)),i.attachShader(n,this.compileShader(i.FRAGMENT_SHADER,e)),i.linkProgram(n),i.useProgram(n),n},t.prototype.compileShader=function(t,e){var i=this.gl,n=i.createShader(t);if(i.shaderSource(n,e),i.compileShader(n),!i.getShaderParameter(n,i.COMPILE_STATUS))throw new Error(i.getShaderInfoLog(n));return n},t.prototype.allowsClampedTextureData=function(){var t=this.gl,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,1,1,0,t.LUMINANCE,t.UNSIGNED_BYTE,new Uint8ClampedArray([0])),0===t.getError()},t.prototype.renderProgress=function(t){var e=this.gl,i=e.getUniformLocation(this.loadingProgram,"progress");e.uniform1f(i,t),e.drawArrays(e.TRIANGLE_STRIP,0,4);
},t.prototype.render=function(t,e,i){if(this.enabled){var n=this.gl,r=this.width+15>>4<<4,s=this.height,o=r>>1,a=s>>1;this.shouldCreateUnclampedViews&&(t=new Uint8Array(t.buffer),e=new Uint8Array(e.buffer),i=new Uint8Array(i.buffer)),this.updateTexture(n.TEXTURE0,this.textureY,r,s,t),this.updateTexture(n.TEXTURE1,this.textureCb,o,a,e),this.updateTexture(n.TEXTURE2,this.textureCr,o,a,i),n.drawArrays(n.TRIANGLE_STRIP,0,4)}},t.prototype.updateTexture=function(t,e,i,n,r){var s=this.gl;s.activeTexture(t),s.bindTexture(s.TEXTURE_2D,e),s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,i,n,0,s.LUMINANCE,s.UNSIGNED_BYTE,r)},t.IsSupported=function(){try{if(!window.WebGLRenderingContext)return!1;var t=document.createElement("canvas");return!(!t.getContext("webgl")&&!t.getContext("experimental-webgl"))}catch(t){return!1}},t.SHADER={FRAGMENT_YCRCB_TO_RGBA:["precision mediump float;","uniform sampler2D textureY;","uniform sampler2D textureCb;","uniform sampler2D textureCr;","varying vec2 texCoord;","mat4 rec601 = mat4(","1.16438,  0.00000,  1.59603, -0.87079,","1.16438, -0.39176, -0.81297,  0.52959,","1.16438,  2.01723,  0.00000, -1.08139,","0, 0, 0, 1",");","void main() {","float y = texture2D(textureY, texCoord).r;","float cb = texture2D(textureCb, texCoord).r;","float cr = texture2D(textureCr, texCoord).r;","gl_FragColor = vec4(y, cr, cb, 1.0) * rec601;","}"].join("\n"),FRAGMENT_LOADING:["precision mediump float;","uniform float progress;","varying vec2 texCoord;","void main() {","float c = ceil(progress-(1.0-texCoord.y));","gl_FragColor = vec4(c,c,c,1);","}"].join("\n"),VERTEX_IDENTITY:["attribute vec2 vertex;","varying vec2 texCoord;","void main() {","texCoord = vertex;","gl_Position = vec4((vertex * 2.0 - 1.0) * vec2(1, -1), 0.0, 1.0);","}"].join("\n")},t}(),r.Renderer.Canvas2D=function(){var t=function(t){this.canvas=t.canvas||document.createElement("canvas"),this.width=this.canvas.width,this.height=this.canvas.height,this.enabled=!0,this.context=this.canvas.getContext("2d")};return t.prototype.resize=function(t,e){this.width=0|t,this.height=0|e,this.canvas.width=this.width,this.canvas.height=this.height,this.imageData=this.context.getImageData(0,0,this.width,this.height),r.Fill(this.imageData.data,255)},t.prototype.renderProgress=function(t){var e=this.canvas.width,i=this.canvas.height,n=this.context;n.fillStyle="#222",n.fillRect(0,0,e,i),n.fillStyle="#fff",n.fillRect(0,i-i*t,e,i*t)},t.prototype.render=function(t,e,i){this.YCbCrToRGBA(t,e,i,this.imageData.data),this.context.putImageData(this.imageData,0,0)},t.prototype.YCbCrToRGBA=function(t,e,i,n){if(this.enabled)for(var r,s,o,a,d,l=this.width+15>>4<<4,u=l>>1,h=0,c=l,p=l+(l-this.width),f=0,v=u-(this.width>>1),m=0,g=4*this.width,y=4*this.width,_=this.width>>1,b=this.height>>1,w=0;w<b;w++){for(var A=0;A<_;A++){r=e[f],s=i[f],f++,o=r+(103*r>>8)-179,a=(88*s>>8)-44+(183*r>>8)-91,d=s+(198*s>>8)-227;var k=t[h++],T=t[h++];n[m]=k+o,n[m+1]=k-a,n[m+2]=k+d,n[m+4]=T+o,n[m+5]=T-a,n[m+6]=T+d,m+=8;var C=t[c++],E=t[c++];n[g]=C+o,n[g+1]=C-a,n[g+2]=C+d,n[g+4]=E+o,n[g+5]=E-a,n[g+6]=E+d,g+=8}h+=p,c+=p,m+=y,g+=y,f+=v}},t}(),r.AudioOutput.WebAudio=function(){var t=function t(e){this.context=t.CachedContext=t.CachedContext||new(window.AudioContext||window.webkitAudioContext),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.destination=this.gain,this.startTime=0,this.buffer=null,this.wallclockStartTime=0,this.volume=1,this.enabled=!0,this.unlocked=!t.NeedsUnlocking(),Object.defineProperty(this,"enqueuedTime",{get:this.getEnqueuedTime})};return t.prototype.play=function(t,e,i){if(this.enabled){if(!this.unlocked){var n=r.Now();return this.wallclockStartTime<n&&(this.wallclockStartTime=n),void(this.wallclockStartTime+=e.length/t)}this.gain.gain.value=this.volume;var s=this.context.createBuffer(2,e.length,t);s.getChannelData(0).set(e),s.getChannelData(1).set(i);var o=this.context.createBufferSource();o.buffer=s,o.connect(this.destination);var a=this.context.currentTime,d=s.duration;this.startTime<a&&(this.startTime=a,this.wallclockStartTime=r.Now()),o.start(this.startTime),this.startTime+=d,this.wallclockStartTime+=d}},t.prototype.stop=function(){this.gain.gain.value=0},t.prototype.getEnqueuedTime=function(){return Math.max(this.wallclockStartTime-r.Now(),0)},t.prototype.resetEnqueuedTime=function(){this.startTime=this.context.currentTime,this.wallclockStartTime=r.Now()},t.prototype.unlock=function(t){if(this.unlocked)return void(t&&t());this.unlockCallback=t;var e=this.context.createBuffer(1,1,22050),i=this.context.createBufferSource();i.buffer=e,i.connect(this.destination),i.start(0),setTimeout(this.checkIfUnlocked.bind(this,i,0),0)},t.prototype.checkIfUnlocked=function(t,e){t.playbackState===t.PLAYING_STATE||t.playbackState===t.FINISHED_STATE?(this.unlocked=!0,this.unlockCallback&&(this.unlockCallback(),this.unlockCallback=null)):e<10&&setTimeout(this.checkIfUnlocked.bind(this,t,e+1),100)},t.NeedsUnlocking=function(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)},t.IsSupported=function(){return window.AudioContext||window.webkitAudioContext},t.CachedContext=null,t}(),t.exports=i},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){var n=e.get("dsm")||{},r=n.bl||[],s=i.concat(r),o=!1;return s.map(function(e){e.indexOf(t)!==-1&&(o=!0)}),o};var i=[".rtbauction.com","video.leadzu.com"]},function(t,e){"use strict";function i(t,e){function i(t,i){var r=n(t,e),s=n(i,e);return r>s?1:-1}var r=t.sort(i);return r}function n(t,e){var i=0,n=s(t.wfIndex),o=s(t.waterfallTagId),a=s(t.cpmFloor),d=s(t.fillrate),l=e.getByAdvId("scoreBoost",t.advId)||0,u=r(t.type)||1,h={wg:n,wi:o,fr:d,cf:a,mt:u,advb:l};t.scoreSummary=h;var i=1,c=e.get("qsrtscr");if(c&&"function"==typeof c)try{i=c(h,t,e)}catch(t){i=999999}return t.score=i,i}function r(t){return"flash"===t?1:"javascript"===t?2:3}function s(t){return t=t||0,parseInt(t)}t.exports={sort:i}},function(t,i,n){"use strict";function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function s(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function d(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(i,"__esModule",{value:!0});var l=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),u=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var s=Object.getPrototypeOf(e);return null===s?void 0:t(s,i,n)}if("value"in r)return r.value;var o=r.get;return void 0!==o?o.call(n):void 0},h=n(21),c=s(h),p=n(53),f=s(p),v=n(1),m=r(v),g=function(t){function i(t,e,n){o(this,i);var r=a(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,e,n));return r._initVpaid(t),setTimeout(t.onReady,2),r}return d(i,t),l(i,[{key:"resumeAd",value:function(){u(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"resumeAd",this).call(this,this.adRestarted)}},{key:"setAdVolume",value:function(t){this.store.get("frcvlm")&&(this.video.volume=t,this.beacon.dispatchEvent(this.vpaidEvents.AdVolumeChange,{dispatcher:this})),u(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"setAdVolume",this).call(this,t)}},{key:"onMuteChanged",value:function(t){this.isMuted=t}},{key:"_initVpaid",value:function(t){this.pauseVideoProtection=this.store.get("pusvidprtctn"),this.adLoaded=!1,this.callIMAApi=void 0}},{key:"_hookIMA",value:function(){this.imaApi=new f.default(this.adUnit._iframe,this.store,this.vpaidLog),this.imaApi.listenToMessages(),this.callIMAApi=this.imaApi.callApi.bind(this.imaApi)}},{key:"_onBindIframe",value:function(t){this._soundProtection(this.video),this._blockDOMObjectInWin(t.contentWindow)}},{key:"_soundProtection",value:function(t){var e=this;t.addEventListener("volumechange",function(){e.adLoaded&&e.isMuted&&0!=t.volume&&e.beacon.dispatchEvent(e.vpaidEvents.SoundViolation,{vol:t.volume}),t.volume!==e.volume&&(m.logToBI(this.vpaidLog,"soundProtection",{selfSound:e.volume,videoSound:t.volume}),t.volume=e.volume)})}},{key:"_blockDOMObjectInWin",value:function(t){var e="window.navigator.__defineGetter__('plugins', function () { return []; });",i="\n        "+(this.store.get("jsnoflshdtct")?e:"")+'\n\n        Object.defineProperty(\n            HTMLObjectElement.prototype,\n            "_data",\n            Object.getOwnPropertyDescriptor(\n                HTMLObjectElement.prototype,\n                "data"\n            )\n        );\n\n        Object.defineProperty(\n            HTMLObjectElement.prototype,\n            "data", {\n                set : function(val){\n                    console.log(\'HTMLObjectElement block\');\n                    return;\n                }\n            }\n        );';try{m.injectResource(t,i)}catch(t){console.log(t)}}},{key:"_onSafeCallAdError",value:function(t){this._onAdError(e)}}]),i}(c.default);i.default=g},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var s=Object.getPrototypeOf(e);return null===s?void 0:t(s,i,n)}if("value"in r)return r.value;var o=r.get;return void 0!==o?o.call(n):void 0},u=i(21),h=r(u),c=i(12),p=r(c),f=i(1),v=n(f),m=function(t){function e(t,i,n){s(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n));return r._initVpaid(t),setTimeout(t.onReady,2),r}return a(e,t),d(e,[{key:"resumeAd",value:function(){l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"resumeAd",this).call(this,this.canvas&&!this.newVidCreated||this.adRestarted)}},{key:"startAd",value:function(){this.video.muted=!0,this.video.setAttribute("playsinline",""),this.canvas&&this.canvas.emitStartAd(),l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"startAd",this).call(this)}},{key:"setAdVolume",value:function(t,i){this.video._mutedChangeByUserGesture=i,l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setAdVolume",this).call(this,t)}},{key:"isReplayable",value:function(){return!this.canvas&&this.video&&""!==this._getVideoSrc(this.video)}},{key:"removeClickableTarget",value:function(){this.isIOS&&this.clickableTarget&&this.clickableTarget.parentNode.removeChild(this.clickableTarget)}},{key:"_initVpaid",value:function(t){var e=this;this.pauseVideoProtection=this.store.get("pusvidprtctn")&&!this.isCanvasMpeg,this.tag=t.tag,this.store.get("sprssviderr")&&this._hookEventListener(t.videoSlot);var i=this.store.get("ua");this.isIOS="iOS"===i.os.name,this.clickableTarget=t.clickableTarget,this.video.muted=!0,this.video.setAttribute("playsinline",""),this.useCanvasMpeg=this.store.get("uscnvsmpg")||!1,this.hasAutoPlay=this.store.get("hasAutoPlay")||!1,this.isCanvasMpeg=this._decideCanvas(),this.canvasReady=!1,this.isCanvasMpeg&&this._initCanvas(t),v.logToBI(this.vpaidLog,"vpaidInit",{hasAutoPlay:this.hasAutoPlay,isCanvasMpeg:this.isCanvasMpeg,forceCavnas:this.store.get("forcecnvsmpg")}),this.canvas&&this.canvas.on("canvasEnded",function(){e._allEventsHandler(e.vpaidEvents.AdVideoComplete,[])})}},{key:"_decideCanvas",value:function(){if(!this.store.get("uscnvsmpg"))return!1;var t=this.store.get("dsm")||{},e=t.mobAp||[],i=this.tag.advId;return e.indexOf(i)>-1?(v.logToBI(this.vpaidLog,"canvasOptOutByAdvId",{advId:i}),!1):this.useCanvasMpeg&&!this.hasAutoPlay||this.store.get("forcecnvsmpg")||!1}},{key:"_hookEventListener",value:function(t){var e=t.addEventListener;t.addEventListener=function(i,n){"error"!==i&&e.apply(t,[i,n])}}},{key:"_initCanvas",value:function(t){var e=this;this.playerDAST.set({cnv:!0}),this.canvas=new p.default(this.video,this,null,null,this.store),this._onSwitchFromCanvasToVideo=t.onSwitchFromCanvasToVideo,this.canvas.on("ready",function(){}),this.canvas.on("play",function(){e.beacon.dispatchEvent(e.vpaidEvents.AdStarted)}),this.canvas.on("newVidCreated",function(t){e.playerDAST.set({ctv:!0}),e.newVidCreated=!0,v.logToBI(e.vpaidLog,"canvasToVideo",{newVidCreated:!0}),t.addEventListener("ended",function(){e.beacon.dispatchEvent(e.vpaidEvents.AdVideoComplete)}),e._onSwitchFromCanvasToVideo&&e._onSwitchFromCanvasToVideo(t),e.newVid=t})}},{key:"_onBindIframe",value:function(t){this._unmuteHook()}},{key:"_unmuteHook",value:function(){this.store.get("mtdhkactv")&&(this.video.__defineSetter__("_muted",this.video.__lookupSetter__("muted")),this.video.__defineSetter__("muted",function(t){return this._mutedChangeByUserGesture?(this._muted=t,void this.__defineSetter__("muted",this.__lookupSetter__("_muted"))):void(this._muted=!0)}))}},{key:"_onAdImpression",value:function(){var t=this;l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_onAdImpression",this).call(this),this.canvasLoadedOnImpression=!0,this._isCanvasLoaded()||(this.canvasLoadedOnImpression=!1,this.canvas.on("ready",function(){t.beacon.dispatchEvent(t.vpaidEvents.AdImpression,[])}))}},{key:"_isCanvasLoaded",value:function(){return!this.canvas||this.canvas.loaded}},{key:"_dispatchAdImpression",value:function(){return this.canvasLoadedOnImpression}},{key:"_resizeAd",value:function(t){this.stopped||(this.canvas&&!this.newVidCreated?this.canvas.onResize(t[0],t[1]):this.newVid&&(this.newVid.style.width=t[0]+"px",this.newVid.style.height=t[1]+"px"))}},{key:"_stopAd",value:function(){this.stopped||(this.canvas&&this.canvas.destroy(),l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_stopAd",this).call(this))}}]),e}(h.default);e.default=m},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),d=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var s=Object.getPrototypeOf(e);return null===s?void 0:t(s,i,n)}if("value"in r)return r.value;var o=r.get;return void 0!==o?o.call(n):void 0},l=i(22),u=n(l),h=function(t){function e(t,i,n){r(this,e);var o=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n));return window.setTimeout(t.onReady,0),o}return o(e,t),a(e,[{key:"startAd",value:function(){this.video.play(),d(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"startAd",this).call(this)}},{key:"_onCanPlay",value:function(){this.playerReady||this.video.pause(),d(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_onCanPlay",this).call(this)}},{key:"_onPlay",value:function(){this.startAdFired&&d(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_onPlay",this).call(this,this.playerReady,200)}},{key:"_onClickThru",value:function(){this.stopped||(this.store.set("forcePause",!1),d(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_onClickThru",this).call(this,this.adPaused))}},{key:"isReplayable",value:function(){return!0}},{key:"dontDie",value:function(){this.stayAlive=!0}}]),e}(u.default);e.default=h},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var s=Object.getPrototypeOf(e);return null===s?void 0:t(s,i,n)}if("value"in r)return r.value;var o=r.get;return void 0!==o?o.call(n):void 0},u=i(22),h=r(u),c=i(12),p=r(c),f=i(1),v=n(f),m=function(t){function e(t,i,n){s(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n));return r._initVpaid(t),window.setTimeout(t.onReady,0),r}return a(e,t),d(e,[{key:"resizeAd",value:function(t,i,n){l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"resizeAd",this).call(this,t,i,n),this.canvas&&this.canvas.onResize(t,i)}},{key:"stopAd",value:function(){this.stopped||(this.timeUpdateInterval=clearTimeout(this.timeUpdateInterval),this.canvas&&this.canvas.destroy(),l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"stopAd",this).call(this))}},{key:"_createBindedCallback",value:function(){l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_createBindedCallback",this).call(this),this._bindedOnPlaying=this._onPlaying.bind(this)}},{key:"_prepareVideoTag",value:function(){this.stopped||(this.video.muted=!0,this.video.setAttribute("playsinline",""),l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_prepareVideoTag",this).call(this))}},{key:"_connectToVideoTag",value:function(){this.stopped||(l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_connectToVideoTag",this).call(this),this.video.addEventListener("playing",this._bindedOnPlaying,!0),this.isIOS&&this.clickableTarget&&this.clickableTarget.addEventListener("click",this._bindedOnClickThru,!0))}},{key:"_disconnectFromVideoTag",value:function(){this.video.removeEventListener("playing",this._bindedOnPlaying,!0),this.isIOS&&this.clickableTarget&&this.clickableTarget.removeEventListener("click",this._bindedOnClickThru,!0)}},{key:"_loadVideoTagSources",value:function(){this.stopped||(this._sortMediaFiles(),l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_loadVideoTagSources",this).call(this))}},{key:"_appendVideoSource",value:function(t,i){this.isCanvasMpeg?(this.video.setAttribute("src",t),this.video.setAttribute("type",i)):l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_appendVideoSource",this).call(this,t,i)}},{key:"_onPlaying",value:function(){this.stopped||(this.eventsToFire.adImpression&&(this.adPaused=!1),v.logToBI(this.vpaidLog,"videoPlaying",{vidCurrentTime:this.video.currentTime}))}},{key:"_onPlay",value:function(){var t=this;if(!this.stopped){if(!this.canvas&&this.store.get("dataSaverDetected")||this.video.play(),this.startAdFired)return this.beacon.dispatchEvent(this.vpaidEvents.AdPlaying),!0;this.beacon.dispatchEvent(this.vpaidEvents.AdVideoStart),l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_onPlay",this).call(this,!0,2e3),this.timeUpdateInterval=setInterval(function(){t.stopped||t._onTimeUpdate()},250)}}},{key:"_onPlayerError",value:function(){this.isCanvasMpeg||l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_onPlayerError",this).call(this)}},{key:"_onClickThru",value:function(){if(event.preventDefault(),event.stopPropagation(),!this.stopped){if(this.isIOS){var t=(new Date).getTime();if(null!==this.lastClickTime&&t-this.lastClickTime<=100)return;this.lastClickTime=t}l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_onClickThru",this).call(this,this.adPaused||this.store.get("dataSaverDetected")&&0===this.video.currentTime)}}},{key:"isReplayable",value:function(){return!this.canvas}},{key:"_initVpaid",value:function(t){var e=this.store.get("ua");this.videoLength=t.extra.duration||30,this.clickableTarget=t.clickableTarget||null,this.useCanvasMpeg=this.store.get("uscnvsmpg")||!1,this.hasAutoPlay=this.store.get("hasAutoPlay")||!1,this.tag=t.tag,this.isCanvasMpeg=this._decideCanvas(),this.lastClickTime=null,this.isIOS="iOS"===e.os.name,this.isCanvasMpeg?this._initCanvas(t):setTimeout(this._fireAdLoaded.bind(this),2e3),v.logToBI(this.vpaidLog,"vpaidInit",{hasAutoPlay:this.hasAutoPlay,isCanvasMpeg:this.isCanvasMpeg,forceCavnas:this.store.get("forcecnvsmpg")})}},{key:"_decideCanvas",value:function(){if(!this.store.get("uscnvsmpg"))return!1;var t=this.store.get("dsm")||{},e=t.mobAp||[],i=this.tag.advId;if(e.indexOf(i)>-1)return v.logToBI(this.vpaidLog,"canvasOptOutByAdvId",{advId:i}),!1;var n=this.store.get("forcecnvsmpg")||!1;return this.useCanvasMpeg&&!this.hasAutoPlay||n}},{key:"_initCanvas",value:function(t){var e=this;this.playerDAST.set({cnv:!0}),this.canvas=new p.default(this.video,this,null,null,this.store),this._onSwitchFromCanvasToVideo=t.onSwitchFromCanvasToVideo,this.canvas.on("newVidCreated",function(t){e.playerDAST.set({ctv:!0}),e.newVidCreated=!0,v.logToBI(e.vpaidLog,"canvasToVideo",{newVidCreated:!0}),t.style.pointerEvents="all",t.style.zIndex=t.style.zIndex||e.zIndex,e.adPaused=t.paused,e._onSwitchFromCanvasToVideo&&e._onSwitchFromCanvasToVideo(t),e.newVid=t}),this.canvas.on("ready",function(){e._fireAdLoaded()})}},{key:"_sortMediaFiles",value:function(){var t=this.playerWidth;this.mediaFiles.sort(function(e,i){var n=Math.abs(t-e.width),r=Math.abs(t-i.width);return n-r}).sort(function(t,e){return t.bitRate-e.bitRate})}},{key:"_resizeAd",value:function(t,e){this.newVidCreated&&this.newVid&&(this.newVid.style.width=t+"px",this.newVid.style.height=e+"px")}}]),e}(h.default);e.default=m},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(75),d=r(a),l=i(76),u=r(l),h=i(73),c=r(h),p=i(74),f=r(p),v=i(14),m=r(v),g=i(1),y=n(g),_=function(){function t(e,i){s(this,t),this.vpaidLog=e,this.store=i,this.isMobile=this.store.get("isMobile"),this.handlers={video:{handlerType:"VideoVpaid"+(this.isMobile?"Mobile":""),handler:this.isMobile?u.default:d.default,filterVpaidFiles:function(t){return t.vpaidFiles.video}},javascript:{handlerType:"JsVpaid"+(this.isMobile?"Mobile":""),handler:this.isMobile?f.default:c.default,filterVpaidFiles:function(t){return t.vpaidFiles.vpaid.javascript}},adx:{handlerType:"Adx",handler:m.default.vpaid}}}return o(t,[{key:"create",value:function(t,e){if(!this.stopped){if(!this.handlers.hasOwnProperty(t))return y.logToBI(this.vpaidLog,"creatingVpaidHandler",{error:"typeNotFound",type:t}),null;var i=this.handlers[t].handler;return this.handlers[t].hasOwnProperty("filterVpaidFiles")&&(e.vpaidFiles=this.handlers[t].filterVpaidFiles(e)),y.logToBI(this.vpaidLog,"creatingVpaidHandler",{type:this.handlers[t].handlerType}),new i(e,this.vpaidLog,this.store)}}},{key:"destroy",value:function(){this.stopped=!0,this.vpaidLog=this.store=this.handlers=void 0}}]),t}();e.default=_},function(t,e){"use strict";t.exports=function(t){function e(t){var e=new i(t),n=e.promise();return e.setHowMany(1),e.setUnwrap(),e.init(),n}var i=t._SomePromiseArray;t.any=function(t){return e(t)},t.prototype.any=function(){return e(this)}}},function(t,e,i){(function(e){"use strict";function n(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new l(16),this._normalQueue=new l(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var t=this;this.drainQueues=function(){t._drainQueues()},this._schedule=d}function r(t,e,i){this._lateQueue.push(t,e,i),this._queueTick()}function s(t,e,i){this._normalQueue.push(t,e,i),this._queueTick()}function o(t){this._normalQueue._pushOne(t),this._queueTick()}var a;try{throw new Error}catch(t){a=t}var d=i(101),l=i(98),u=i(2);n.prototype.setScheduler=function(t){var e=this._schedule;return this._schedule=t,this._customScheduler=!0,e},n.prototype.hasCustomScheduler=function(){return this._customScheduler},n.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},n.prototype.disableTrampolineIfNecessary=function(){u.hasDevTools&&(this._trampolineEnabled=!1)},n.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},n.prototype.fatalError=function(t,i){i?(e.stderr.write("Fatal "+(t instanceof Error?t.stack:t)+"\n"),e.exit(2)):this.throwLater(t)},n.prototype.throwLater=function(t,e){if(1===arguments.length&&(e=t,t=function(){throw e}),"undefined"!=typeof setTimeout)setTimeout(function(){t(e)},0);else try{this._schedule(function(){t(e)})}catch(t){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},u.hasDevTools?(n.prototype.invokeLater=function(t,e,i){this._trampolineEnabled?r.call(this,t,e,i):this._schedule(function(){setTimeout(function(){t.call(e,i)},100)})},n.prototype.invoke=function(t,e,i){this._trampolineEnabled?s.call(this,t,e,i):this._schedule(function(){t.call(e,i)})},n.prototype.settlePromises=function(t){this._trampolineEnabled?o.call(this,t):this._schedule(function(){t._settlePromises()})}):(n.prototype.invokeLater=r,n.prototype.invoke=s,n.prototype.settlePromises=o),n.prototype._drainQueue=function(t){for(;t.length()>0;){var e=t.shift();if("function"==typeof e){var i=t.shift(),n=t.shift();e.call(i,n)}else e._settlePromises()}},n.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},n.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},n.prototype._reset=function(){this._isTickUsed=!1},t.exports=n,t.exports.firstLineError=a}).call(e,i(11))},function(t,e){"use strict";t.exports=function(t,e,i,n){var r=!1,s=function(t,e){this._reject(e)},o=function(t,e){e.promiseRejectionQueued=!0,e.bindingPromise._then(s,s,null,this,t)},a=function(t,e){0===(50397184&this._bitField)&&this._resolveCallback(e.target)},d=function(t,e){e.promiseRejectionQueued||this._reject(t)};t.prototype.bind=function(s){r||(r=!0,t.prototype._propagateFrom=n.propagateFromFunction(),t.prototype._boundValue=n.boundValueFunction());var l=i(s),u=new t(e);u._propagateFrom(this,1);var h=this._target();if(u._setBoundTo(l),l instanceof t){var c={promiseRejectionQueued:!1,promise:u,target:h,bindingPromise:l};h._then(e,o,void 0,u,c),l._then(a,d,void 0,u,c),u._setOnCancel(l)}else u._resolveCallback(h);return u},t.prototype._setBoundTo=function(t){void 0!==t?(this._bitField=2097152|this._bitField,this._boundTo=t):this._bitField=this._bitField&-2097153},t.prototype._isBound=function(){return 2097152===(2097152&this._bitField)},t.bind=function(e,i){return t.resolve(i).bind(e)}}},function(t,e,i){"use strict";var n=Object.create;if(n){var r=n(null),s=n(null);r[" size"]=s[" size"]=0}t.exports=function(t){function e(e,i){var n;if(null!=e&&(n=e[i]),"function"!=typeof n){var r="Object "+u.classString(e)+" has no method '"+u.toString(i)+"'";throw new t.TypeError(r)}return n}function n(t){var i=this.pop(),n=e(t,i);return n.apply(t,this)}function o(t){return t[this]}function a(t){var e=+this;return e<0&&(e=Math.max(0,e+t.length)),t[e]}var d,l,u=i(2),h=u.canEvaluate,c=u.isIdentifier,p=function(t){return new Function("ensureMethod","                                    \n\t        return function(obj) {                                               \n\t            'use strict'                                                     \n\t            var len = this.length;                                           \n\t            ensureMethod(obj, 'methodName');                                 \n\t            switch(len) {                                                    \n\t                case 1: return obj.methodName(this[0]);                      \n\t                case 2: return obj.methodName(this[0], this[1]);             \n\t                case 3: return obj.methodName(this[0], this[1], this[2]);    \n\t                case 0: return obj.methodName();                             \n\t                default:                                                     \n\t                    return obj.methodName.apply(obj, this);                  \n\t            }                                                                \n\t        };                                                                   \n\t        ".replace(/methodName/g,t))(e)},f=function(t){return new Function("obj","                                             \n\t        'use strict';                                                        \n\t        return obj.propertyName;                                             \n\t        ".replace("propertyName",t))},v=function(t,e,i){var n=i[t];if("function"!=typeof n){if(!c(t))return null;if(n=e(t),i[t]=n,i[" size"]++,i[" size"]>512){for(var r=Object.keys(i),s=0;s<256;++s)delete i[r[s]];i[" size"]=r.length-256}}return n};d=function(t){return v(t,p,r)},l=function(t){return v(t,f,s)},t.prototype.call=function(t){for(var e=arguments.length,i=new Array(Math.max(e-1,0)),r=1;r<e;++r)i[r-1]=arguments[r];if(h){var s=d(t);if(null!==s)return this._then(s,void 0,void 0,i,void 0)}return i.push(t),this._then(n,void 0,void 0,i,void 0)},t.prototype.get=function(t){var e,i="number"==typeof t;if(i)e=a;else if(h){var n=l(t);e=null!==n?n:o}else e=o;return this._then(e,void 0,void 0,t,void 0)}}},function(t,e,i){"use strict";t.exports=function(t,e,n,r){var s=i(2),o=s.tryCatch,a=s.errorObj,d=t._async;
t.prototype.break=t.prototype.cancel=function(){if(!r.cancellation())return this._warn("cancellation is disabled");for(var t=this,e=t;t._isCancellable();){if(!t._cancelBy(e)){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}var i=t._cancellationParent;if(null==i||!i._isCancellable()){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}t._isFollowing()&&t._followee().cancel(),t._setWillBeCancelled(),e=t,t=i}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},t.prototype._cancelBy=function(t){return t===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),d.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(t,e){if(s.isArray(t))for(var i=0;i<t.length;++i)this._doInvokeOnCancel(t[i],e);else if(void 0!==t)if("function"==typeof t){if(!e){var n=o(t).call(this._boundValue());n===a&&(this._attachExtraTrace(n.e),d.throwLater(n.e))}}else t._resultCancelled(this)},t.prototype._invokeOnCancel=function(){var t=this._onCancel();this._unsetOnCancel(),d.invoke(this._doInvokeOnCancel,this,t)},t.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},function(t,e){"use strict";t.exports=function(t){function e(){this._trace=new e.CapturedTrace(n())}function i(){if(r)return new e}function n(){var t=s.length-1;if(t>=0)return s[t]}var r=!1,s=[];return t.prototype._promiseCreated=function(){},t.prototype._pushContext=function(){},t.prototype._popContext=function(){return null},t._peekContext=t.prototype._peekContext=function(){},e.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,s.push(this._trace))},e.prototype._popContext=function(){if(void 0!==this._trace){var t=s.pop(),e=t._promiseCreated;return t._promiseCreated=null,e}return null},e.CapturedTrace=null,e.create=i,e.deactivateLongStackTraces=function(){},e.activateLongStackTraces=function(){var i=t.prototype._pushContext,s=t.prototype._popContext,o=t._peekContext,a=t.prototype._peekContext,d=t.prototype._promiseCreated;e.deactivateLongStackTraces=function(){t.prototype._pushContext=i,t.prototype._popContext=s,t._peekContext=o,t.prototype._peekContext=a,t.prototype._promiseCreated=d,r=!1},r=!0,t.prototype._pushContext=e.prototype._pushContext,t.prototype._popContext=e.prototype._popContext,t._peekContext=t.prototype._peekContext=n,t.prototype._promiseCreated=function(){var t=this._peekContext();t&&null==t._promiseCreated&&(t._promiseCreated=this)}},e}},function(t,e,i){(function(e){"use strict";t.exports=function(t,n){function r(t,e){return{promise:e}}function s(){return!1}function o(t,e,i){var n=this;try{t(e,i,function(t){if("function"!=typeof t)throw new TypeError("onCancel must be a function, got: "+j.toString(t));n._attachCancellationCallback(t)})}catch(t){return t}}function a(t){if(!this._isCancellable())return this;var e=this._onCancel();void 0!==e?j.isArray(e)?e.push(t):this._setOnCancel([e,t]):this._setOnCancel(t)}function d(){return this._onCancelField}function l(t){this._onCancelField=t}function u(){this._cancellationParent=void 0,this._onCancelField=void 0}function h(t,e){if(0!==(1&e)){this._cancellationParent=t;var i=t._branchesRemainingToCancel;void 0===i&&(i=0),t._branchesRemainingToCancel=i+1}0!==(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}function c(t,e){0!==(2&e)&&t._isBound()&&this._setBoundTo(t._boundTo)}function p(){var e=this._boundTo;return void 0!==e&&e instanceof t?e.isFulfilled()?e.value():void 0:e}function f(){this._trace=new O(this._peekContext())}function v(t,e){if(U(t)){var i=this._trace;if(void 0!==i&&e&&(i=i._parent),void 0!==i)i.attachExtraTrace(t);else if(!t.__stackCleaned__){var n=T(t);j.notEnumerableProp(t,"stack",n.message+"\n"+n.stack.join("\n")),j.notEnumerableProp(t,"__stackCleaned__",!0)}}}function m(t,e,i,n,r){if(void 0===t&&null!==e&&$){if(void 0!==r&&r._returnedNonUndefined())return;if(0===(65535&n._bitField))return;i&&(i+=" ");var s="",o="";if(e._trace){for(var a=e._trace.stack.split("\n"),d=A(a),l=d.length-1;l>=0;--l){var u=d[l];if(!N.test(u)){var h=u.match(H);h&&(s="at "+h[1]+":"+h[2]+":"+h[3]+" ");break}}if(d.length>0)for(var c=d[0],l=0;l<a.length;++l)if(a[l]===c){l>0&&(o="\n"+a[l-1]);break}}var p="a promise was created in a "+i+"handler "+s+"but was not returned from it, see http://goo.gl/rRqMUw"+o;n._warn(p,!0,e)}}function g(t,e){var i=t+" is deprecated and will be removed in a future version.";return e&&(i+=" Use "+e+" instead."),y(i)}function y(e,i,n){if(ot.warnings){var r,s=new B(e);if(i)n._attachExtraTrace(s);else if(ot.longStackTraces&&(r=t._peekContext()))r.attachExtraTrace(s);else{var o=T(s);s.stack=o.message+"\n"+o.stack.join("\n")}et("warning",s)||C(s,"",!0)}}function _(t,e){for(var i=0;i<e.length-1;++i)e[i].push("From previous event:"),e[i]=e[i].join("\n");return i<e.length&&(e[i]=e[i].join("\n")),t+"\n"+e.join("\n")}function b(t){for(var e=0;e<t.length;++e)(0===t[e].length||e+1<t.length&&t[e][0]===t[e+1][0])&&(t.splice(e,1),e--)}function w(t){for(var e=t[0],i=1;i<t.length;++i){for(var n=t[i],r=e.length-1,s=e[r],o=-1,a=n.length-1;a>=0;--a)if(n[a]===s){o=a;break}for(var a=o;a>=0;--a){var d=n[a];if(e[r]!==d)break;e.pop(),r--}e=n}}function A(t){for(var e=[],i=0;i<t.length;++i){var n=t[i],r="    (No stack trace)"===n||q.test(n),s=r&&nt(n);r&&!s&&(G&&" "!==n.charAt(0)&&(n="    "+n),e.push(n))}return e}function k(t){for(var e=t.stack.replace(/\s+$/g,"").split("\n"),i=0;i<e.length;++i){var n=e[i];if("    (No stack trace)"===n||q.test(n))break}return i>0&&"SyntaxError"!=t.name&&(e=e.slice(i)),e}function T(t){var e=t.stack,i=t.toString();return e="string"==typeof e&&e.length>0?k(t):["    (No stack trace)"],{message:i,stack:"SyntaxError"==t.name?e:A(e)}}function C(t,e,i){if("undefined"!=typeof console){var n;if(j.isObject(t)){var r=t.stack;n=e+z(r,t)}else n=e+String(t);"function"==typeof F?F(n,i):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(n)}}function E(t,e,i,n){var r=!1;try{"function"==typeof e&&(r=!0,"rejectionHandled"===t?e(n):e(i,n))}catch(t){R.throwLater(t)}"unhandledRejection"===t?et(t,i,n)||r||C(i,"Unhandled rejection "):et(t,n)}function P(t){var e;if("function"==typeof t)e="[function "+(t.name||"anonymous")+"]";else{e=t&&"function"==typeof t.toString?t.toString():j.toString(t);var i=/\[object [a-zA-Z0-9$_]+\]/;if(i.test(e))try{var n=JSON.stringify(t);e=n}catch(t){}0===e.length&&(e="(empty array)")}return"(<"+S(e)+">, no stack trace)"}function S(t){var e=41;return t.length<e?t:t.substr(0,e-3)+"..."}function I(){return"function"==typeof st}function V(t){var e=t.match(rt);if(e)return{fileName:e[1],line:parseInt(e[2],10)}}function x(t,e){if(I()){for(var i,n,r=t.stack.split("\n"),s=e.stack.split("\n"),o=-1,a=-1,d=0;d<r.length;++d){var l=V(r[d]);if(l){i=l.fileName,o=l.line;break}}for(var d=0;d<s.length;++d){var l=V(s[d]);if(l){n=l.fileName,a=l.line;break}}o<0||a<0||!i||!n||i!==n||o>=a||(nt=function(t){if(W.test(t))return!0;var e=V(t);return!!(e&&e.fileName===i&&o<=e.line&&e.line<=a)})}}function O(t){this._parent=t,this._promisesCreated=0;var e=this._length=1+(void 0===t?0:t._length);st(this,O),e>32&&this.uncycle()}var D,M,F,L=t._getDomain,R=t._async,B=i(4).Warning,j=i(2),U=j.canAttachTrace,W=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,N=/\((?:timers\.js):\d+:\d+\)/,H=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,q=null,z=null,G=!1,Q=!(0==j.env("BLUEBIRD_DEBUG")||!j.env("BLUEBIRD_DEBUG")&&"development"!==j.env("NODE_ENV")),X=!(0==j.env("BLUEBIRD_WARNINGS")||!Q&&!j.env("BLUEBIRD_WARNINGS")),Y=!(0==j.env("BLUEBIRD_LONG_STACK_TRACES")||!Q&&!j.env("BLUEBIRD_LONG_STACK_TRACES")),$=0!=j.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(X||!!j.env("BLUEBIRD_W_FORGOTTEN_RETURN"));t.prototype.suppressUnhandledRejections=function(){var t=this._target();t._bitField=t._bitField&-1048577|524288},t.prototype._ensurePossibleRejectionHandled=function(){if(0===(524288&this._bitField)){this._setRejectionIsUnhandled();var t=this;setTimeout(function(){t._notifyUnhandledRejection()},1)}},t.prototype._notifyUnhandledRejectionIsHandled=function(){E("rejectionHandled",D,void 0,this)},t.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},t.prototype._returnedNonUndefined=function(){return 0!==(268435456&this._bitField)},t.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var t=this._settledValue();this._setUnhandledRejectionIsNotified(),E("unhandledRejection",M,t,this)}},t.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},t.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=this._bitField&-262145},t.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},t.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},t.prototype._unsetRejectionIsUnhandled=function(){this._bitField=this._bitField&-1048577,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},t.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},t.prototype._warn=function(t,e,i){return y(t,e,i||this)},t.onPossiblyUnhandledRejection=function(t){var e=L();M="function"==typeof t?null===e?t:j.domainBind(e,t):void 0},t.onUnhandledRejectionHandled=function(t){var e=L();D="function"==typeof t?null===e?t:j.domainBind(e,t):void 0};var K=function(){};t.longStackTraces=function(){if(R.haveItemsQueued()&&!ot.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!ot.longStackTraces&&I()){var e=t.prototype._captureStackTrace,i=t.prototype._attachExtraTrace;ot.longStackTraces=!0,K=function(){if(R.haveItemsQueued()&&!ot.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");t.prototype._captureStackTrace=e,t.prototype._attachExtraTrace=i,n.deactivateLongStackTraces(),R.enableTrampoline(),ot.longStackTraces=!1},t.prototype._captureStackTrace=f,t.prototype._attachExtraTrace=v,n.activateLongStackTraces(),R.disableTrampolineIfNecessary()}},t.hasLongStackTraces=function(){return ot.longStackTraces&&I()};var J=function(){try{if("function"==typeof CustomEvent){var t=new CustomEvent("CustomEvent");return j.global.dispatchEvent(t),function(t,e){var i=new CustomEvent(t.toLowerCase(),{detail:e,cancelable:!0});return!j.global.dispatchEvent(i)}}if("function"==typeof Event){var t=new Event("CustomEvent");return j.global.dispatchEvent(t),function(t,e){var i=new Event(t.toLowerCase(),{cancelable:!0});return i.detail=e,!j.global.dispatchEvent(i)}}var t=document.createEvent("CustomEvent");return t.initCustomEvent("testingtheevent",!1,!0,{}),j.global.dispatchEvent(t),function(t,e){var i=document.createEvent("CustomEvent");return i.initCustomEvent(t.toLowerCase(),!1,!0,e),!j.global.dispatchEvent(i)}}catch(t){}return function(){return!1}}(),Z=function(){return j.isNode?function(){return e.emit.apply(e,arguments)}:j.global?function(t){var e="on"+t.toLowerCase(),i=j.global[e];return!!i&&(i.apply(j.global,[].slice.call(arguments,1)),!0)}:function(){return!1}}(),tt={promiseCreated:r,promiseFulfilled:r,promiseRejected:r,promiseResolved:r,promiseCancelled:r,promiseChained:function(t,e,i){return{promise:e,child:i}},warning:function(t,e){return{warning:e}},unhandledRejection:function(t,e,i){return{reason:e,promise:i}},rejectionHandled:r},et=function(t){var e=!1;try{e=Z.apply(null,arguments)}catch(t){R.throwLater(t),e=!0}var i=!1;try{i=J(t,tt[t].apply(null,arguments))}catch(t){R.throwLater(t),i=!0}return i||e};t.config=function(e){if(e=Object(e),"longStackTraces"in e&&(e.longStackTraces?t.longStackTraces():!e.longStackTraces&&t.hasLongStackTraces()&&K()),"warnings"in e){var i=e.warnings;ot.warnings=!!i,$=ot.warnings,j.isObject(i)&&"wForgottenReturn"in i&&($=!!i.wForgottenReturn)}if("cancellation"in e&&e.cancellation&&!ot.cancellation){if(R.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");t.prototype._clearCancellationData=u,t.prototype._propagateFrom=h,t.prototype._onCancel=d,t.prototype._setOnCancel=l,t.prototype._attachCancellationCallback=a,t.prototype._execute=o,it=h,ot.cancellation=!0}return"monitoring"in e&&(e.monitoring&&!ot.monitoring?(ot.monitoring=!0,t.prototype._fireEvent=et):!e.monitoring&&ot.monitoring&&(ot.monitoring=!1,t.prototype._fireEvent=s)),t},t.prototype._fireEvent=s,t.prototype._execute=function(t,e,i){try{t(e,i)}catch(t){return t}},t.prototype._onCancel=function(){},t.prototype._setOnCancel=function(t){},t.prototype._attachCancellationCallback=function(t){},t.prototype._captureStackTrace=function(){},t.prototype._attachExtraTrace=function(){},t.prototype._clearCancellationData=function(){},t.prototype._propagateFrom=function(t,e){};var it=c,nt=function(){return!1},rt=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;j.inherits(O,Error),n.CapturedTrace=O,O.prototype.uncycle=function(){var t=this._length;if(!(t<2)){for(var e=[],i={},n=0,r=this;void 0!==r;++n)e.push(r),r=r._parent;t=this._length=n;for(var n=t-1;n>=0;--n){var s=e[n].stack;void 0===i[s]&&(i[s]=n)}for(var n=0;n<t;++n){var o=e[n].stack,a=i[o];if(void 0!==a&&a!==n){a>0&&(e[a-1]._parent=void 0,e[a-1]._length=1),e[n]._parent=void 0,e[n]._length=1;var d=n>0?e[n-1]:this;a<t-1?(d._parent=e[a+1],d._parent.uncycle(),d._length=d._parent._length+1):(d._parent=void 0,d._length=1);for(var l=d._length+1,u=n-2;u>=0;--u)e[u]._length=l,l++;return}}}},O.prototype.attachExtraTrace=function(t){if(!t.__stackCleaned__){this.uncycle();for(var e=T(t),i=e.message,n=[e.stack],r=this;void 0!==r;)n.push(A(r.stack.split("\n"))),r=r._parent;w(n),b(n),j.notEnumerableProp(t,"stack",_(i,n)),j.notEnumerableProp(t,"__stackCleaned__",!0)}};var st=function(){var t=/^\s*at\s*/,e=function(t,e){return"string"==typeof t?t:void 0!==e.name&&void 0!==e.message?e.toString():P(e)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,q=t,z=e;var i=Error.captureStackTrace;return nt=function(t){return W.test(t)},function(t,e){Error.stackTraceLimit+=6,i(t,e),Error.stackTraceLimit-=6}}var n=new Error;if("string"==typeof n.stack&&n.stack.split("\n")[0].indexOf("stackDetection@")>=0)return q=/@/,z=e,G=!0,function(t){t.stack=(new Error).stack};var r;try{throw new Error}catch(t){r="stack"in t}return"stack"in n||!r||"number"!=typeof Error.stackTraceLimit?(z=function(t,e){return"string"==typeof t?t:"object"!=typeof e&&"function"!=typeof e||void 0===e.name||void 0===e.message?P(e):e.toString()},null):(q=t,z=e,function(t){Error.stackTraceLimit+=6;try{throw new Error}catch(e){t.stack=e.stack}Error.stackTraceLimit-=6})}([]);"undefined"!=typeof console&&"undefined"!=typeof console.warn&&(F=function(t){console.warn(t)},j.isNode&&e.stderr.isTTY?F=function(t,e){var i=e?"[33m":"[31m";console.warn(i+t+"[0m\n")}:j.isNode||"string"!=typeof(new Error).stack||(F=function(t,e){console.warn("%c"+t,e?"color: darkorange":"color: red")}));var ot={warnings:X,longStackTraces:!1,cancellation:!1,monitoring:!1};return Y&&t.longStackTraces(),{longStackTraces:function(){return ot.longStackTraces},warnings:function(){return ot.warnings},cancellation:function(){return ot.cancellation},monitoring:function(){return ot.monitoring},propagateFromFunction:function(){return it},boundValueFunction:function(){return p},checkForgottenReturns:m,setBounds:x,warn:y,deprecated:g,CapturedTrace:O,fireDomEvent:J,fireGlobalEvent:Z}}}).call(e,i(11))},function(t,e){"use strict";t.exports=function(t){function e(){return this.value}function i(){throw this.reason}t.prototype.return=t.prototype.thenReturn=function(i){return i instanceof t&&i.suppressUnhandledRejections(),this._then(e,void 0,void 0,{value:i},void 0)},t.prototype.throw=t.prototype.thenThrow=function(t){return this._then(i,void 0,void 0,{reason:t},void 0)},t.prototype.catchThrow=function(t){if(arguments.length<=1)return this._then(void 0,i,void 0,{reason:t},void 0);var e=arguments[1],n=function(){throw e};return this.caught(t,n)},t.prototype.catchReturn=function(i){if(arguments.length<=1)return i instanceof t&&i.suppressUnhandledRejections(),this._then(void 0,e,void 0,{value:i},void 0);var n=arguments[1];n instanceof t&&n.suppressUnhandledRejections();var r=function(){return n};return this.caught(i,r)}}},function(t,e){"use strict";t.exports=function(t,e){function i(){return s(this)}function n(t,i){return r(t,i,e,e)}var r=t.reduce,s=t.all;t.prototype.each=function(t){return r(this,t,e,0)._then(i,void 0,void 0,this,void 0)},t.prototype.mapSeries=function(t){return r(this,t,e,e)},t.each=function(t,n){return r(t,n,e,0)._then(i,void 0,void 0,t,void 0)},t.mapSeries=n}},function(t,e){"use strict";t.exports=function(t,e){var i=t.map;t.prototype.filter=function(t,n){return i(this,t,n,e)},t.filter=function(t,n,r){return i(t,n,r,e)}}},function(t,e,i){"use strict";t.exports=function(t,e,n){function r(t,e,i){this.promise=t,this.type=e,this.handler=i,this.called=!1,this.cancelPromise=null}function s(t){this.finallyHandler=t}function o(t,e){return null!=t.cancelPromise&&(arguments.length>1?t.cancelPromise._reject(e):t.cancelPromise._cancel(),t.cancelPromise=null,!0)}function a(){return l.call(this,this.promise._target()._settledValue())}function d(t){if(!o(this,t))return c.e=t,c}function l(i){var r=this.promise,l=this.handler;if(!this.called){this.called=!0;var u=this.isFinallyHandler()?l.call(r._boundValue()):l.call(r._boundValue(),i);if(u===n)return u;if(void 0!==u){r._setReturnedNonUndefined();var p=e(u,r);if(p instanceof t){if(null!=this.cancelPromise){if(p._isCancelled()){var f=new h("late cancellation observer");return r._attachExtraTrace(f),c.e=f,c}p.isPending()&&p._attachCancellationCallback(new s(this))}return p._then(a,d,void 0,this,void 0)}}}return r.isRejected()?(o(this),c.e=i,c):(o(this),i)}var u=i(2),h=t.CancellationError,c=u.errorObj,p=i(24)(n);return r.prototype.isFinallyHandler=function(){return 0===this.type},s.prototype._resultCancelled=function(){o(this.finallyHandler)},t.prototype._passThrough=function(t,e,i,n){return"function"!=typeof t?this.then():this._then(i,n,void 0,new r(this,e,t),void 0)},t.prototype.lastly=t.prototype.finally=function(t){return this._passThrough(t,0,l,l)},t.prototype.tap=function(t){return this._passThrough(t,1,l)},t.prototype.tapCatch=function(e){var i=arguments.length;if(1===i)return this._passThrough(e,1,void 0,l);var n,r=new Array(i-1),s=0;for(n=0;n<i-1;++n){var o=arguments[n];if(!u.isObject(o))return t.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+u.classString(o)));r[s++]=o}r.length=s;var a=arguments[n];return this._passThrough(p(r,a,this),1,void 0,l)},r}},function(t,e,i){"use strict";t.exports=function(t,e,n,r,s,o){function a(e,i,n){for(var s=0;s<i.length;++s){n._pushContext();var o=p(i[s])(e);if(n._popContext(),o===c){n._pushContext();var a=t.reject(c.e);return n._popContext(),a}var d=r(o,n);if(d instanceof t)return d}return null}function d(e,i,r,s){if(o.cancellation()){var a=new t(n),d=this._finallyPromise=new t(n);this._promise=a.lastly(function(){return d}),a._captureStackTrace(),a._setOnCancel(this)}else{var l=this._promise=new t(n);l._captureStackTrace()}this._stack=s,this._generatorFunction=e,this._receiver=i,this._generator=void 0,this._yieldHandlers="function"==typeof r?[r].concat(f):f,this._yieldedPromise=null,this._cancellationPhase=!1}var l=i(4),u=l.TypeError,h=i(2),c=h.errorObj,p=h.tryCatch,f=[];h.inherits(d,s),d.prototype._isResolved=function(){return null===this._promise},d.prototype._cleanup=function(){this._promise=this._generator=null,o.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},d.prototype._promiseCancelled=function(){if(!this._isResolved()){var e,i="undefined"!=typeof this._generator.return;if(i)this._promise._pushContext(),e=p(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var n=new t.CancellationError("generator .return() sentinel");t.coroutine.returnSentinel=n,this._promise._attachExtraTrace(n),this._promise._pushContext(),e=p(this._generator.throw).call(this._generator,n),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(e)}},d.prototype._promiseFulfilled=function(t){this._yieldedPromise=null,this._promise._pushContext();var e=p(this._generator.next).call(this._generator,t);this._promise._popContext(),this._continue(e)},d.prototype._promiseRejected=function(t){this._yieldedPromise=null,this._promise._attachExtraTrace(t),this._promise._pushContext();var e=p(this._generator.throw).call(this._generator,t);this._promise._popContext(),this._continue(e)},d.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var e=this._yieldedPromise;this._yieldedPromise=null,e.cancel()}},d.prototype.promise=function(){return this._promise},d.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},d.prototype._continue=function(e){var i=this._promise;if(e===c)return this._cleanup(),this._cancellationPhase?i.cancel():i._rejectCallback(e.e,!1);var n=e.value;if(e.done===!0)return this._cleanup(),this._cancellationPhase?i.cancel():i._resolveCallback(n);var s=r(n,this._promise);if(!(s instanceof t)&&(s=a(s,this._yieldHandlers,this._promise),null===s))return void this._promiseRejected(new u("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(n))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));s=s._target();var o=s._bitField;0===(50397184&o)?(this._yieldedPromise=s,s._proxy(this,null)):0!==(33554432&o)?t._async.invoke(this._promiseFulfilled,this,s._value()):0!==(16777216&o)?t._async.invoke(this._promiseRejected,this,s._reason()):this._promiseCancelled()},t.coroutine=function(t,e){if("function"!=typeof t)throw new u("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var i=Object(e).yieldHandler,n=d,r=(new Error).stack;return function(){var e=t.apply(this,arguments),s=new n(void 0,void 0,i,r),o=s.promise();return s._generator=e,s._promiseFulfilled(void 0),o}},t.coroutine.addYieldHandler=function(t){if("function"!=typeof t)throw new u("expecting a function but got "+h.classString(t));f.push(t)},t.spawn=function(i){if(o.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof i)return e("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=new d(i,this),r=n.promise();return n._run(t.spawn),r}}},function(t,e,i){"use strict";t.exports=function(t,e,n,r,s,o){var a,d=i(2),l=d.canEvaluate,u=d.tryCatch,h=d.errorObj;if(l){for(var c=function(t){return new Function("value","holder","                             \n\t            'use strict';                                                    \n\t            holder.pIndex = value;                                           \n\t            holder.checkFulfillment(this);                                   \n\t            ".replace(/Index/g,t))},p=function(t){return new Function("promise","holder","                           \n\t            'use strict';                                                    \n\t            holder.pIndex = promise;                                         \n\t            ".replace(/Index/g,t))},f=function(e){for(var i=new Array(e),n=0;n<i.length;++n)i[n]="this.p"+(n+1);var r=i.join(" = ")+" = null;",o="var promise;\n"+i.map(function(t){return"                                                         \n\t                promise = "+t+";                                      \n\t                if (promise instanceof Promise) {                            \n\t                    promise.cancel();                                        \n\t                }                                                            \n\t            "}).join("\n"),a=i.join(", "),d="Holder$"+e,l="return function(tryCatch, errorObj, Promise, async) {    \n\t            'use strict';                                                    \n\t            function [TheName](fn) {                                         \n\t                [TheProperties]                                              \n\t                this.fn = fn;                                                \n\t                this.asyncNeeded = true;                                     \n\t                this.now = 0;                                                \n\t            }                                                                \n\t                                                                             \n\t            [TheName].prototype._callFunction = function(promise) {          \n\t                promise._pushContext();                                      \n\t                var ret = tryCatch(this.fn)([ThePassedArguments]);           \n\t                promise._popContext();                                       \n\t                if (ret === errorObj) {                                      \n\t                    promise._rejectCallback(ret.e, false);                   \n\t                } else {                                                     \n\t                    promise._resolveCallback(ret);                           \n\t                }                                                            \n\t            };                                                               \n\t                                                                             \n\t            [TheName].prototype.checkFulfillment = function(promise) {       \n\t                var now = ++this.now;                                        \n\t                if (now === [TheTotal]) {                                    \n\t                    if (this.asyncNeeded) {                                  \n\t                        async.invoke(this._callFunction, this, promise);     \n\t                    } else {                                                 \n\t                        this._callFunction(promise);                         \n\t                    }                                                        \n\t                                                                             \n\t                }                                                            \n\t            };                                                               \n\t                                                                             \n\t            [TheName].prototype._resultCancelled = function() {              \n\t                [CancellationCode]                                           \n\t            };                                                               \n\t                                                                             \n\t            return [TheName];                                                \n\t        }(tryCatch, errorObj, Promise, async);                               \n\t        ";return l=l.replace(/\[TheName\]/g,d).replace(/\[TheTotal\]/g,e).replace(/\[ThePassedArguments\]/g,a).replace(/\[TheProperties\]/g,r).replace(/\[CancellationCode\]/g,o),new Function("tryCatch","errorObj","Promise","async",l)(u,h,t,s)},v=[],m=[],g=[],y=0;y<8;++y)v.push(f(y+1)),m.push(c(y+1)),g.push(p(y+1));a=function(t){this._reject(t)}}t.join=function(){var i,s=arguments.length-1;if(s>0&&"function"==typeof arguments[s]&&(i=arguments[s],s<=8&&l)){var u=new t(r);u._captureStackTrace();for(var h=v[s-1],c=new h(i),p=m,f=0;f<s;++f){var y=n(arguments[f],u);if(y instanceof t){y=y._target();var _=y._bitField;0===(50397184&_)?(y._then(p[f],a,void 0,u,c),g[f](y,c),c.asyncNeeded=!1):0!==(33554432&_)?p[f].call(u,y._value(),c):0!==(16777216&_)?u._reject(y._reason()):u._cancel()}else p[f].call(u,y,c)}if(!u._isFateSealed()){if(c.asyncNeeded){var b=o();null!==b&&(c.fn=d.domainBind(b,c.fn))}u._setAsyncGuaranteed(),u._setOnCancel(c)}return u}for(var w=arguments.length,A=new Array(w),k=0;k<w;++k)A[k]=arguments[k];i&&A.pop();var u=new e(A).promise();return void 0!==i?u.spread(i):u}}},function(t,e,i){"use strict";t.exports=function(t,e,n,r,s,o){function a(t,e,i,n){this.constructor$(t),this._promise._captureStackTrace();var r=l();this._callback=null===r?e:u.domainBind(r,e),this._preservedValues=n===s?new Array(this.length()):null,this._limit=i,this._inFlight=0,this._queue=[],p.invoke(this._asyncInit,this,void 0)}function d(e,i,r,s){if("function"!=typeof i)return n("expecting a function but got "+u.classString(i));var o=0;if(void 0!==r){if("object"!=typeof r||null===r)return t.reject(new TypeError("options argument must be an object but it is "+u.classString(r)));if("number"!=typeof r.concurrency)return t.reject(new TypeError("'concurrency' must be a number but it is "+u.classString(r.concurrency)));o=r.concurrency}return o="number"==typeof o&&isFinite(o)&&o>=1?o:0,new a(e,i,o,s).promise()}var l=t._getDomain,u=i(2),h=u.tryCatch,c=u.errorObj,p=t._async;u.inherits(a,e),a.prototype._asyncInit=function(){this._init$(void 0,-2)},a.prototype._init=function(){},a.prototype._promiseFulfilled=function(e,i){var n=this._values,s=this.length(),a=this._preservedValues,d=this._limit;if(i<0){if(i=i*-1-1,n[i]=e,d>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(d>=1&&this._inFlight>=d)return n[i]=e,this._queue.push(i),!1;null!==a&&(a[i]=e);var l=this._promise,u=this._callback,p=l._boundValue();l._pushContext();var f=h(u).call(p,e,i,s),v=l._popContext();if(o.checkForgottenReturns(f,v,null!==a?"Promise.filter":"Promise.map",l),f===c)return this._reject(f.e),!0;var m=r(f,this._promise);if(m instanceof t){m=m._target();var g=m._bitField;if(0===(50397184&g))return d>=1&&this._inFlight++,n[i]=m,m._proxy(this,(i+1)*-1),!1;if(0===(33554432&g))return 0!==(16777216&g)?(this._reject(m._reason()),!0):(this._cancel(),!0);f=m._value()}n[i]=f}var y=++this._totalResolved;return y>=s&&(null!==a?this._filter(n,a):this._resolve(n),!0)},a.prototype._drainQueue=function(){for(var t=this._queue,e=this._limit,i=this._values;t.length>0&&this._inFlight<e;){if(this._isResolved())return;var n=t.pop();this._promiseFulfilled(i[n],n)}},a.prototype._filter=function(t,e){for(var i=e.length,n=new Array(i),r=0,s=0;s<i;++s)t[s]&&(n[r++]=e[s]);n.length=r,this._resolve(n)},a.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(t,e){return d(this,t,e,null)},t.map=function(t,e,i,n){return d(t,e,i,n)}}},function(t,e,i){"use strict";t.exports=function(t,e,n,r,s){var o=i(2),a=o.tryCatch;t.method=function(i){if("function"!=typeof i)throw new t.TypeError("expecting a function but got "+o.classString(i));return function(){var n=new t(e);n._captureStackTrace(),n._pushContext();var r=a(i).apply(this,arguments),o=n._popContext();return s.checkForgottenReturns(r,o,"Promise.method",n),n._resolveFromSyncValue(r),n}},t.attempt=t.try=function(i){if("function"!=typeof i)return r("expecting a function but got "+o.classString(i));var n=new t(e);n._captureStackTrace(),n._pushContext();var d;if(arguments.length>1){s.deprecated("calling Promise.try with more than 1 argument");
var l=arguments[1],u=arguments[2];d=o.isArray(l)?a(i).apply(u,l):a(i).call(u,l)}else d=a(i)();var h=n._popContext();return s.checkForgottenReturns(d,h,"Promise.try",n),n._resolveFromSyncValue(d),n},t.prototype._resolveFromSyncValue=function(t){t===o.errorObj?this._rejectCallback(t.e,!1):this._resolveCallback(t,!0)}}},function(t,e,i){"use strict";t.exports=function(t){function e(t,e){var i=this;if(!s.isArray(t))return n.call(i,t,e);var r=a(e).apply(i._boundValue(),[null].concat(t));r===d&&o.throwLater(r.e)}function n(t,e){var i=this,n=i._boundValue(),r=void 0===t?a(e).call(n,null):a(e).call(n,null,t);r===d&&o.throwLater(r.e)}function r(t,e){var i=this;if(!t){var n=new Error(t+"");n.cause=t,t=n}var r=a(e).call(i._boundValue(),t);r===d&&o.throwLater(r.e)}var s=i(2),o=t._async,a=s.tryCatch,d=s.errorObj;t.prototype.asCallback=t.prototype.nodeify=function(t,i){if("function"==typeof t){var s=n;void 0!==i&&Object(i).spread&&(s=e),this._then(s,r,void 0,this,t)}return this}}},function(t,e,i){(function(e){"use strict";t.exports=function(){function n(){}function r(t,e){if(null==t||t.constructor!==s)throw new _("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof e)throw new _("expecting a function but got "+f.classString(e))}function s(t){t!==w&&r(this,t),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(t),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function o(t){this.promise._resolveCallback(t)}function a(t){this.promise._rejectCallback(t,!1)}function d(t){var e=new s(w);e._fulfillmentHandler0=t,e._rejectionHandler0=t,e._promise0=t,e._receiver0=t}var l,u=function(){return new _("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},h=function(){return new s.PromiseInspection(this._target())},c=function(t){return s.reject(new _(t))},p={},f=i(2);l=f.isNode?function(){var t=e.domain;return void 0===t&&(t=null),t}:function(){return null},f.notEnumerableProp(s,"_getDomain",l);var v=i(9),m=i(79),g=new m;v.defineProperty(s,"_async",{value:g});var y=i(4),_=s.TypeError=y.TypeError;s.RangeError=y.RangeError;var b=s.CancellationError=y.CancellationError;s.TimeoutError=y.TimeoutError,s.OperationalError=y.OperationalError,s.RejectionError=y.OperationalError,s.AggregateError=y.AggregateError;var w=function(){},A={},k={},T=i(105)(s,w),C=i(95)(s,w,T,c,n),E=i(83)(s),P=E.create,S=i(84)(s,E),I=(S.CapturedTrace,i(88)(s,T,k)),V=i(24)(k),x=i(25),O=f.errorObj,D=f.tryCatch;return s.prototype.toString=function(){return"[object Promise]"},s.prototype.caught=s.prototype.catch=function(t){var e=arguments.length;if(e>1){var i,n=new Array(e-1),r=0;for(i=0;i<e-1;++i){var s=arguments[i];if(!f.isObject(s))return c("Catch statement predicate: expecting an object but got "+f.classString(s));n[r++]=s}return n.length=r,t=arguments[i],this.then(void 0,V(n,t,this))}return this.then(void 0,t)},s.prototype.reflect=function(){return this._then(h,h,void 0,this,void 0)},s.prototype.then=function(t,e){if(S.warnings()&&arguments.length>0&&"function"!=typeof t&&"function"!=typeof e){var i=".then() only accepts functions but was passed: "+f.classString(t);arguments.length>1&&(i+=", "+f.classString(e)),this._warn(i)}return this._then(t,e,void 0,void 0,void 0)},s.prototype.done=function(t,e){var i=this._then(t,e,void 0,void 0,void 0);i._setIsFinal()},s.prototype.spread=function(t){return"function"!=typeof t?c("expecting a function but got "+f.classString(t)):this.all()._then(t,void 0,void 0,A,void 0)},s.prototype.toJSON=function(){var t={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(t.fulfillmentValue=this.value(),t.isFulfilled=!0):this.isRejected()&&(t.rejectionReason=this.reason(),t.isRejected=!0),t},s.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new C(this).promise()},s.prototype.error=function(t){return this.caught(f.originatesFromRejection,t)},s.getNewLibraryCopy=t.exports,s.is=function(t){return t instanceof s},s.fromNode=s.fromCallback=function(t){var e=new s(w);e._captureStackTrace();var i=arguments.length>1&&!!Object(arguments[1]).multiArgs,n=D(t)(x(e,i));return n===O&&e._rejectCallback(n.e,!0),e._isFateSealed()||e._setAsyncGuaranteed(),e},s.all=function(t){return new C(t).promise()},s.cast=function(t){var e=T(t);return e instanceof s||(e=new s(w),e._captureStackTrace(),e._setFulfilled(),e._rejectionHandler0=t),e},s.resolve=s.fulfilled=s.cast,s.reject=s.rejected=function(t){var e=new s(w);return e._captureStackTrace(),e._rejectCallback(t,!0),e},s.setScheduler=function(t){if("function"!=typeof t)throw new _("expecting a function but got "+f.classString(t));return g.setScheduler(t)},s.prototype._then=function(t,e,i,n,r){var o=void 0!==r,a=o?r:new s(w),d=this._target(),u=d._bitField;o||(a._propagateFrom(this,3),a._captureStackTrace(),void 0===n&&0!==(2097152&this._bitField)&&(n=0!==(50397184&u)?this._boundValue():d===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,a));var h=l();if(0!==(50397184&u)){var c,p,v=d._settlePromiseCtx;0!==(33554432&u)?(p=d._rejectionHandler0,c=t):0!==(16777216&u)?(p=d._fulfillmentHandler0,c=e,d._unsetRejectionIsUnhandled()):(v=d._settlePromiseLateCancellationObserver,p=new b("late cancellation observer"),d._attachExtraTrace(p),c=e),g.invoke(v,d,{handler:null===h?c:"function"==typeof c&&f.domainBind(h,c),promise:a,receiver:n,value:p})}else d._addCallbacks(t,e,a,n,h);return a},s.prototype._length=function(){return 65535&this._bitField},s.prototype._isFateSealed=function(){return 0!==(117506048&this._bitField)},s.prototype._isFollowing=function(){return 67108864===(67108864&this._bitField)},s.prototype._setLength=function(t){this._bitField=this._bitField&-65536|65535&t},s.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},s.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},s.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},s.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},s.prototype._isFinal=function(){return(4194304&this._bitField)>0},s.prototype._unsetCancelled=function(){this._bitField=this._bitField&-65537},s.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},s.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},s.prototype._setAsyncGuaranteed=function(){g.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},s.prototype._receiverAt=function(t){var e=0===t?this._receiver0:this[4*t-4+3];if(e!==p)return void 0===e&&this._isBound()?this._boundValue():e},s.prototype._promiseAt=function(t){return this[4*t-4+2]},s.prototype._fulfillmentHandlerAt=function(t){return this[4*t-4+0]},s.prototype._rejectionHandlerAt=function(t){return this[4*t-4+1]},s.prototype._boundValue=function(){},s.prototype._migrateCallback0=function(t){var e=(t._bitField,t._fulfillmentHandler0),i=t._rejectionHandler0,n=t._promise0,r=t._receiverAt(0);void 0===r&&(r=p),this._addCallbacks(e,i,n,r,null)},s.prototype._migrateCallbackAt=function(t,e){var i=t._fulfillmentHandlerAt(e),n=t._rejectionHandlerAt(e),r=t._promiseAt(e),s=t._receiverAt(e);void 0===s&&(s=p),this._addCallbacks(i,n,r,s,null)},s.prototype._addCallbacks=function(t,e,i,n,r){var s=this._length();if(s>=65531&&(s=0,this._setLength(0)),0===s)this._promise0=i,this._receiver0=n,"function"==typeof t&&(this._fulfillmentHandler0=null===r?t:f.domainBind(r,t)),"function"==typeof e&&(this._rejectionHandler0=null===r?e:f.domainBind(r,e));else{var o=4*s-4;this[o+2]=i,this[o+3]=n,"function"==typeof t&&(this[o+0]=null===r?t:f.domainBind(r,t)),"function"==typeof e&&(this[o+1]=null===r?e:f.domainBind(r,e))}return this._setLength(s+1),s},s.prototype._proxy=function(t,e){this._addCallbacks(void 0,void 0,e,t,null)},s.prototype._resolveCallback=function(t,e){if(0===(117506048&this._bitField)){if(t===this)return this._rejectCallback(u(),!1);var i=T(t,this);if(!(i instanceof s))return this._fulfill(t);e&&this._propagateFrom(i,2);var n=i._target();if(n===this)return void this._reject(u());var r=n._bitField;if(0===(50397184&r)){var o=this._length();o>0&&n._migrateCallback0(this);for(var a=1;a<o;++a)n._migrateCallbackAt(this,a);this._setFollowing(),this._setLength(0),this._setFollowee(n)}else if(0!==(33554432&r))this._fulfill(n._value());else if(0!==(16777216&r))this._reject(n._reason());else{var d=new b("late cancellation observer");n._attachExtraTrace(d),this._reject(d)}}},s.prototype._rejectCallback=function(t,e,i){var n=f.ensureErrorObject(t),r=n===t;if(!r&&!i&&S.warnings()){var s="a promise was rejected with a non-error: "+f.classString(t);this._warn(s,!0)}this._attachExtraTrace(n,!!e&&r),this._reject(t)},s.prototype._resolveFromExecutor=function(t){if(t!==w){var e=this;this._captureStackTrace(),this._pushContext();var i=!0,n=this._execute(t,function(t){e._resolveCallback(t)},function(t){e._rejectCallback(t,i)});i=!1,this._popContext(),void 0!==n&&e._rejectCallback(n,!0)}},s.prototype._settlePromiseFromHandler=function(t,e,i,n){var r=n._bitField;if(0===(65536&r)){n._pushContext();var s;e===A?i&&"number"==typeof i.length?s=D(t).apply(this._boundValue(),i):(s=O,s.e=new _("cannot .spread() a non-array: "+f.classString(i))):s=D(t).call(e,i);var o=n._popContext();r=n._bitField,0===(65536&r)&&(s===k?n._reject(i):s===O?n._rejectCallback(s.e,!1):(S.checkForgottenReturns(s,o,"",n,this),n._resolveCallback(s)))}},s.prototype._target=function(){for(var t=this;t._isFollowing();)t=t._followee();return t},s.prototype._followee=function(){return this._rejectionHandler0},s.prototype._setFollowee=function(t){this._rejectionHandler0=t},s.prototype._settlePromise=function(t,e,i,r){var o=t instanceof s,a=this._bitField,d=0!==(134217728&a);0!==(65536&a)?(o&&t._invokeInternalOnCancel(),i instanceof I&&i.isFinallyHandler()?(i.cancelPromise=t,D(e).call(i,r)===O&&t._reject(O.e)):e===h?t._fulfill(h.call(i)):i instanceof n?i._promiseCancelled(t):o||t instanceof C?t._cancel():i.cancel()):"function"==typeof e?o?(d&&t._setAsyncGuaranteed(),this._settlePromiseFromHandler(e,i,r,t)):e.call(i,r,t):i instanceof n?i._isResolved()||(0!==(33554432&a)?i._promiseFulfilled(r,t):i._promiseRejected(r,t)):o&&(d&&t._setAsyncGuaranteed(),0!==(33554432&a)?t._fulfill(r):t._reject(r))},s.prototype._settlePromiseLateCancellationObserver=function(t){var e=t.handler,i=t.promise,n=t.receiver,r=t.value;"function"==typeof e?i instanceof s?this._settlePromiseFromHandler(e,n,r,i):e.call(n,r,i):i instanceof s&&i._reject(r)},s.prototype._settlePromiseCtx=function(t){this._settlePromise(t.promise,t.handler,t.receiver,t.value)},s.prototype._settlePromise0=function(t,e,i){var n=this._promise0,r=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(n,t,r,e)},s.prototype._clearCallbackDataAtIndex=function(t){var e=4*t-4;this[e+2]=this[e+3]=this[e+0]=this[e+1]=void 0},s.prototype._fulfill=function(t){var e=this._bitField;if(!((117506048&e)>>>16)){if(t===this){var i=u();return this._attachExtraTrace(i),this._reject(i)}this._setFulfilled(),this._rejectionHandler0=t,(65535&e)>0&&(0!==(134217728&e)?this._settlePromises():g.settlePromises(this))}},s.prototype._reject=function(t){var e=this._bitField;if(!((117506048&e)>>>16))return this._setRejected(),this._fulfillmentHandler0=t,this._isFinal()?g.fatalError(t,f.isNode):void((65535&e)>0?g.settlePromises(this):this._ensurePossibleRejectionHandled())},s.prototype._fulfillPromises=function(t,e){for(var i=1;i<t;i++){var n=this._fulfillmentHandlerAt(i),r=this._promiseAt(i),s=this._receiverAt(i);this._clearCallbackDataAtIndex(i),this._settlePromise(r,n,s,e)}},s.prototype._rejectPromises=function(t,e){for(var i=1;i<t;i++){var n=this._rejectionHandlerAt(i),r=this._promiseAt(i),s=this._receiverAt(i);this._clearCallbackDataAtIndex(i),this._settlePromise(r,n,s,e)}},s.prototype._settlePromises=function(){var t=this._bitField,e=65535&t;if(e>0){if(0!==(16842752&t)){var i=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,i,t),this._rejectPromises(e,i)}else{var n=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,n,t),this._fulfillPromises(e,n)}this._setLength(0)}this._clearCancellationData()},s.prototype._settledValue=function(){var t=this._bitField;return 0!==(33554432&t)?this._rejectionHandler0:0!==(16777216&t)?this._fulfillmentHandler0:void 0},s.defer=s.pending=function(){S.deprecated("Promise.defer","new Promise");var t=new s(w);return{promise:t,resolve:o,reject:a}},f.notEnumerableProp(s,"_makeSelfResolutionError",u),i(92)(s,w,T,c,S),i(80)(s,w,T,S),i(82)(s,C,c,S),i(85)(s),i(104)(s),i(90)(s,C,T,w,g,l),s.Promise=s,s.version="3.5.1",i(91)(s,C,c,T,w,S),i(81)(s),i(107)(s,c,T,P,w,S),i(106)(s,w,S),i(89)(s,c,w,T,n,S),i(93)(s),i(96)(s,w),i(97)(s,C,T,c),i(99)(s,w,T,c),i(100)(s,C,c,T,w,S),i(102)(s,C,S),i(103)(s,C,c),i(87)(s,w),i(86)(s,w),i(78)(s),f.toFastProperties(s),f.toFastProperties(s.prototype),d({a:1}),d({b:2}),d({c:3}),d(1),d(function(){}),d(void 0),d(!1),d(new s(w)),S.setBounds(m.firstLineError,f.lastLineError),s}}).call(e,i(11))},function(t,e,i){"use strict";t.exports=function(t,e,n,r,s){function o(t){switch(t){case-2:return[];case-3:return{};case-6:return new Map}}function a(i){var n=this._promise=new t(e);i instanceof t&&n._propagateFrom(i,3),n._setOnCancel(this),this._values=i,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var d=i(2);return d.isArray,d.inherits(a,s),a.prototype.length=function(){return this._length},a.prototype.promise=function(){return this._promise},a.prototype._init=function e(i,s){var a=n(this._values,this._promise);if(a instanceof t){a=a._target();var l=a._bitField;if(this._values=a,0===(50397184&l))return this._promise._setAsyncGuaranteed(),a._then(e,this._reject,void 0,this,s);if(0===(33554432&l))return 0!==(16777216&l)?this._reject(a._reason()):this._cancel();a=a._value()}if(a=d.asArray(a),null===a){var u=r("expecting an array or an iterable object but got "+d.classString(a)).reason();return void this._promise._rejectCallback(u,!1)}return 0===a.length?void(s===-5?this._resolveEmptyArray():this._resolve(o(s))):void this._iterate(a)},a.prototype._iterate=function(e){var i=this.getActualLength(e.length);this._length=i,this._values=this.shouldCopyValues()?new Array(i):this._values;for(var r=this._promise,s=!1,o=null,a=0;a<i;++a){var d=n(e[a],r);d instanceof t?(d=d._target(),o=d._bitField):o=null,s?null!==o&&d.suppressUnhandledRejections():null!==o?0===(50397184&o)?(d._proxy(this,a),this._values[a]=d):s=0!==(33554432&o)?this._promiseFulfilled(d._value(),a):0!==(16777216&o)?this._promiseRejected(d._reason(),a):this._promiseCancelled(a):s=this._promiseFulfilled(d,a)}s||r._setAsyncGuaranteed()},a.prototype._isResolved=function(){return null===this._values},a.prototype._resolve=function(t){this._values=null,this._promise._fulfill(t)},a.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},a.prototype._reject=function(t){this._values=null,this._promise._rejectCallback(t,!1)},a.prototype._promiseFulfilled=function(t,e){this._values[e]=t;var i=++this._totalResolved;return i>=this._length&&(this._resolve(this._values),!0)},a.prototype._promiseCancelled=function(){return this._cancel(),!0},a.prototype._promiseRejected=function(t){return this._totalResolved++,this._reject(t),!0},a.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof t)e.cancel();else for(var i=0;i<e.length;++i)e[i]instanceof t&&e[i].cancel()}},a.prototype.shouldCopyValues=function(){return!0},a.prototype.getActualLength=function(t){return t},a}},function(t,e,i){"use strict";t.exports=function(t,e){function n(t){return!A.test(t)}function r(t){try{return t.__isPromisified__===!0}catch(t){return!1}}function s(t,e,i){var n=p.getDataPropertyOrDefault(t,e+i,b);return!!n&&r(n)}function o(t,e,i){for(var n=0;n<t.length;n+=2){var r=t[n];if(i.test(r))for(var s=r.replace(i,""),o=0;o<t.length;o+=2)if(t[o]===s)throw new y("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",e))}}function a(t,e,i,n){for(var a=p.inheritedDataKeys(t),d=[],l=0;l<a.length;++l){var u=a[l],h=t[u],c=n===k||k(u,h,t);"function"!=typeof h||r(h)||s(t,u,e)||!n(u,h,t,c)||d.push(u,h)}return o(d,e,i),d}function d(i,n,r,s,o,a){function d(){var r=n;n===c&&(r=this);var s=new t(e);s._captureStackTrace();var o="string"==typeof u&&this!==l?this[u]:i,d=f(s,a);try{o.apply(r,v(arguments,d))}catch(t){s._rejectCallback(m(t),!0,!0)}return s._isFateSealed()||s._setAsyncGuaranteed(),s}var l=function(){return this}(),u=i;return"string"==typeof u&&(i=s),p.notEnumerableProp(d,"__isPromisified__",!0),d}function l(t,e,i,n,r){for(var s=new RegExp(T(e)+"$"),o=a(t,e,s,i),d=0,l=o.length;d<l;d+=2){var u=o[d],h=o[d+1],f=u+e;if(n===I)t[f]=I(u,c,u,h,e,r);else{var v=n(h,function(){return I(u,c,u,h,e,r)});p.notEnumerableProp(v,"__isPromisified__",!0),t[f]=v}}return p.toFastProperties(t),t}function u(t,e,i){return I(t,e,void 0,t,null,i)}var h,c={},p=i(2),f=i(25),v=p.withAppended,m=p.maybeWrapAsError,g=p.canEvaluate,y=i(4).TypeError,_="Async",b={__isPromisified__:!0},w=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],A=new RegExp("^(?:"+w.join("|")+")$"),k=function(t){return p.isIdentifier(t)&&"_"!==t.charAt(0)&&"constructor"!==t},T=function(t){return t.replace(/([$])/,"\\$")},C=function(t){for(var e=[t],i=Math.max(0,t-1-3),n=t-1;n>=i;--n)e.push(n);for(var n=t+1;n<=3;++n)e.push(n);return e},E=function(t){return p.filledRange(t,"_arg","")},P=function(t){return p.filledRange(Math.max(t,3),"_arg","")},S=function(t){return"number"==typeof t.length?Math.max(Math.min(t.length,1024),0):0};h=function(i,n,r,s,o,a){function d(t){var e,i=E(t).join(", "),r=t>0?", ":"";return e=g?"ret = callback.call(this, {{args}}, nodeback); break;\n":void 0===n?"ret = callback({{args}}, nodeback); break;\n":"ret = callback.call(receiver, {{args}}, nodeback); break;\n",e.replace("{{args}}",i).replace(", ",r)}function l(){for(var t="",e=0;e<h.length;++e)t+="case "+h[e]+":"+d(h[e]);return t+="                                                             \n\t        default:                                                             \n\t            var args = new Array(len + 1);                                   \n\t            var i = 0;                                                       \n\t            for (var i = 0; i < len; ++i) {                                  \n\t               args[i] = arguments[i];                                       \n\t            }                                                                \n\t            args[i] = nodeback;                                              \n\t            [CodeForCall]                                                    \n\t            break;                                                           \n\t        ".replace("[CodeForCall]",g?"ret = callback.apply(this, args);\n":"ret = callback.apply(receiver, args);\n")}var u=Math.max(0,S(s)-1),h=C(u),g="string"==typeof i||n===c,y="string"==typeof i?"this != null ? this['"+i+"'] : fn":"fn",_="'use strict';                                                \n\t        var ret = function (Parameters) {                                    \n\t            'use strict';                                                    \n\t            var len = arguments.length;                                      \n\t            var promise = new Promise(INTERNAL);                             \n\t            promise._captureStackTrace();                                    \n\t            var nodeback = nodebackForPromise(promise, "+a+");   \n\t            var ret;                                                         \n\t            var callback = tryCatch([GetFunctionCode]);                      \n\t            switch(len) {                                                    \n\t                [CodeForSwitchCase]                                          \n\t            }                                                                \n\t            if (ret === errorObj) {                                          \n\t                promise._rejectCallback(maybeWrapAsError(ret.e), true, true);\n\t            }                                                                \n\t            if (!promise._isFateSealed()) promise._setAsyncGuaranteed();     \n\t            return promise;                                                  \n\t        };                                                                   \n\t        notEnumerableProp(ret, '__isPromisified__', true);                   \n\t        return ret;                                                          \n\t    ".replace("[CodeForSwitchCase]",l()).replace("[GetFunctionCode]",y);return _=_.replace("Parameters",P(u)),new Function("Promise","fn","receiver","withAppended","maybeWrapAsError","nodebackForPromise","tryCatch","errorObj","notEnumerableProp","INTERNAL",_)(t,s,n,v,m,f,p.tryCatch,p.errorObj,p.notEnumerableProp,e)};var I=g?h:d;t.promisify=function(t,e){if("function"!=typeof t)throw new y("expecting a function but got "+p.classString(t));if(r(t))return t;e=Object(e);var i=void 0===e.context?c:e.context,s=!!e.multiArgs,o=u(t,i,s);return p.copyDescriptors(t,o,n),o},t.promisifyAll=function(t,e){if("function"!=typeof t&&"object"!=typeof t)throw new y("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");e=Object(e);var i=!!e.multiArgs,n=e.suffix;"string"!=typeof n&&(n=_);var r=e.filter;"function"!=typeof r&&(r=k);var s=e.promisifier;if("function"!=typeof s&&(s=I),!p.isIdentifier(n))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var o=p.inheritedDataKeys(t),a=0;a<o.length;++a){var d=t[o[a]];"constructor"!==o[a]&&p.isClass(d)&&(l(d.prototype,n,r,s,i),l(d,n,r,s,i))}return l(t,n,r,s,i)}}},function(t,e,i){"use strict";t.exports=function(t,e,n,r){function s(t){var e,i=!1;if(void 0!==a&&t instanceof a)e=h(t),i=!0;else{var n=u.keys(t),r=n.length;e=new Array(2*r);for(var s=0;s<r;++s){var o=n[s];e[s]=t[o],e[s+r]=o}}this.constructor$(e),this._isMap=i,this._init$(void 0,i?-6:-3)}function o(e){var i,o=n(e);return l(o)?(i=o instanceof t?o._then(t.props,void 0,void 0,void 0,void 0):new s(o).promise(),o instanceof t&&i._propagateFrom(o,2),i):r("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var a,d=i(2),l=d.isObject,u=i(9);"function"==typeof Map&&(a=Map);var h=function(){function t(t,n){this[e]=t,this[e+i]=n,e++}var e=0,i=0;return function(n){i=n.size,e=0;var r=new Array(2*n.size);return n.forEach(t,r),r}}(),c=function(t){for(var e=new a,i=t.length/2|0,n=0;n<i;++n){var r=t[i+n],s=t[n];e.set(r,s)}return e};d.inherits(s,e),s.prototype._init=function(){},s.prototype._promiseFulfilled=function(t,e){this._values[e]=t;var i=++this._totalResolved;if(i>=this._length){var n;if(this._isMap)n=c(this._values);else{n={};for(var r=this.length(),s=0,o=this.length();s<o;++s)n[this._values[s+r]]=this._values[s]}return this._resolve(n),!0}return!1},s.prototype.shouldCopyValues=function(){return!1},s.prototype.getActualLength=function(t){return t>>1},t.prototype.props=function(){return o(this)},t.props=function(t){return o(t)}}},function(t,e){"use strict";function i(t,e,i,n,r){for(var s=0;s<r;++s)i[s+n]=t[s+e],t[s+e]=void 0}function n(t){this._capacity=t,this._length=0,this._front=0}n.prototype._willBeOverCapacity=function(t){return this._capacity<t},n.prototype._pushOne=function(t){var e=this.length();this._checkCapacity(e+1);var i=this._front+e&this._capacity-1;this[i]=t,this._length=e+1},n.prototype.push=function(t,e,i){var n=this.length()+3;if(this._willBeOverCapacity(n))return this._pushOne(t),this._pushOne(e),void this._pushOne(i);var r=this._front+n-3;this._checkCapacity(n);var s=this._capacity-1;this[r+0&s]=t,this[r+1&s]=e,this[r+2&s]=i,this._length=n},n.prototype.shift=function(){var t=this._front,e=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length--,e},n.prototype.length=function(){return this._length},n.prototype._checkCapacity=function(t){this._capacity<t&&this._resizeTo(this._capacity<<1)},n.prototype._resizeTo=function(t){var e=this._capacity;this._capacity=t;var n=this._front,r=this._length,s=n+r&e-1;i(this,0,this,e,s)},t.exports=n},function(t,e,i){"use strict";t.exports=function(t,e,n,r){function s(i,s){var d=n(i);if(d instanceof t)return a(d);if(i=o.asArray(i),null===i)return r("expecting an array or an iterable object but got "+o.classString(i));var l=new t(e);void 0!==s&&l._propagateFrom(s,3);for(var u=l._fulfill,h=l._reject,c=0,p=i.length;c<p;++c){var f=i[c];(void 0!==f||c in i)&&t.cast(f)._then(u,h,void 0,l,null)}return l}var o=i(2),a=function(t){return t.then(function(e){return s(e,t)})};t.race=function(t){return s(t,void 0)},t.prototype.race=function(){return s(this,void 0)}}},function(t,e,i){"use strict";t.exports=function(t,e,n,r,s,o){function a(e,i,n,r){this.constructor$(e);var o=c();this._fn=null===o?i:p.domainBind(o,i),void 0!==n&&(n=t.resolve(n),n._attachCancellationCallback(this)),this._initialValue=n,this._currentCancellable=null,r===s?this._eachValues=Array(this._length):0===r?this._eachValues=null:this._eachValues=void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function d(t,e){this.isFulfilled()?e._resolve(t):e._reject(t)}function l(t,e,i,r){if("function"!=typeof e)return n("expecting a function but got "+p.classString(e));var s=new a(t,e,i,r);return s.promise()}function u(e){this.accum=e,this.array._gotAccum(e);var i=r(this.value,this.array._promise);return i instanceof t?(this.array._currentCancellable=i,i._then(h,void 0,void 0,this,void 0)):h.call(this,i)}function h(e){var i=this.array,n=i._promise,r=f(i._fn);n._pushContext();var s;s=void 0!==i._eachValues?r.call(n._boundValue(),e,this.index,this.length):r.call(n._boundValue(),this.accum,e,this.index,this.length),s instanceof t&&(i._currentCancellable=s);var a=n._popContext();return o.checkForgottenReturns(s,a,void 0!==i._eachValues?"Promise.each":"Promise.reduce",n),s}var c=t._getDomain,p=i(2),f=p.tryCatch;p.inherits(a,e),a.prototype._gotAccum=function(t){void 0!==this._eachValues&&null!==this._eachValues&&t!==s&&this._eachValues.push(t)},a.prototype._eachComplete=function(t){return null!==this._eachValues&&this._eachValues.push(t),this._eachValues},a.prototype._init=function(){},a.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},a.prototype.shouldCopyValues=function(){return!1},a.prototype._resolve=function(t){this._promise._resolveCallback(t),this._values=null},a.prototype._resultCancelled=function(e){return e===this._initialValue?this._cancel():void(this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel()))},a.prototype._iterate=function(e){this._values=e;var i,n,r=e.length;if(void 0!==this._initialValue?(i=this._initialValue,n=0):(i=t.resolve(e[0]),n=1),this._currentCancellable=i,!i.isRejected())for(;n<r;++n){var s={accum:null,value:e[n],index:n,length:r,array:this};i=i._then(u,void 0,void 0,s,void 0)}void 0!==this._eachValues&&(i=i._then(this._eachComplete,void 0,void 0,this,void 0)),i._then(d,d,void 0,i,this)},t.prototype.reduce=function(t,e){return l(this,t,e,null)},t.reduce=function(t,e,i,n){return l(t,e,i,n)}}},function(t,e,i){(function(e,n){"use strict";var r,s=i(2),o=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")},a=s.getNativePromise();if(s.isNode&&"undefined"==typeof MutationObserver){var d=e.setImmediate,l=n.nextTick;r=s.isRecentNode?function(t){d.call(e,t)}:function(t){l.call(n,t)}}else if("function"==typeof a&&"function"==typeof a.resolve){var u=a.resolve();r=function(t){u.then(t)}}else r="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?"undefined"!=typeof setImmediate?function(t){setImmediate(t)}:"undefined"!=typeof setTimeout?function(t){setTimeout(t,0)}:o:function(){var t=document.createElement("div"),e={attributes:!0},i=!1,n=document.createElement("div"),r=new MutationObserver(function(){t.classList.toggle("foo"),i=!1});r.observe(n,e);var s=function(){i||(i=!0,n.classList.toggle("foo"))};return function(i){var n=new MutationObserver(function(){n.disconnect(),i()});n.observe(t,e),s()}}();t.exports=r}).call(e,function(){return this}(),i(11))},function(t,e,i){"use strict";t.exports=function(t,e,n){function r(t){this.constructor$(t)}var s=t.PromiseInspection,o=i(2);o.inherits(r,e),r.prototype._promiseResolved=function(t,e){this._values[t]=e;var i=++this._totalResolved;return i>=this._length&&(this._resolve(this._values),!0)},r.prototype._promiseFulfilled=function(t,e){var i=new s;return i._bitField=33554432,i._settledValueField=t,this._promiseResolved(e,i)},r.prototype._promiseRejected=function(t,e){var i=new s;return i._bitField=16777216,i._settledValueField=t,this._promiseResolved(e,i)},t.settle=function(t){return n.deprecated(".settle()",".reflect()"),new r(t).promise()},t.prototype.settle=function(){return t.settle(this)}}},function(t,e,i){"use strict";t.exports=function(t,e,n){function r(t){this.constructor$(t),this._howMany=0,this._unwrap=!1,this._initialized=!1}function s(t,e){if((0|e)!==e||e<0)return n("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var i=new r(t),s=i.promise();return i.setHowMany(e),i.init(),s}var o=i(2),a=i(4).RangeError,d=i(4).AggregateError,l=o.isArray,u={};o.inherits(r,e),r.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var t=l(this._values);!this._isResolved()&&t&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},r.prototype.init=function(){this._initialized=!0,this._init()},r.prototype.setUnwrap=function(){this._unwrap=!0},r.prototype.howMany=function(){return this._howMany},r.prototype.setHowMany=function(t){this._howMany=t},r.prototype._promiseFulfilled=function(t){return this._addFulfilled(t),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},r.prototype._promiseRejected=function(t){return this._addRejected(t),this._checkOutcome()},r.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(u),this._checkOutcome())},r.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var t=new d,e=this.length();e<this._values.length;++e)this._values[e]!==u&&t.push(this._values[e]);return t.length>0?this._reject(t):this._cancel(),!0}return!1},r.prototype._fulfilled=function(){return this._totalResolved},r.prototype._rejected=function(){return this._values.length-this.length()},r.prototype._addRejected=function(t){this._values.push(t)},r.prototype._addFulfilled=function(t){this._values[this._totalResolved++]=t},r.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},r.prototype._getRangeError=function(t){var e="Input array must contain at least "+this._howMany+" items but contains only "+t+" items";return new a(e)},r.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(t,e){return s(t,e)},t.prototype.some=function(t){return s(this,t)},t._SomePromiseArray=r}},function(t,e){"use strict";t.exports=function(t){function e(t){void 0!==t?(t=t._target(),this._bitField=t._bitField,
this._settledValueField=t._isFateSealed()?t._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}e.prototype._settledValue=function(){return this._settledValueField};var i=e.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},n=e.prototype.error=e.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=e.prototype.isFulfilled=function(){return 0!==(33554432&this._bitField)},s=e.prototype.isRejected=function(){return 0!==(16777216&this._bitField)},o=e.prototype.isPending=function(){return 0===(50397184&this._bitField)},a=e.prototype.isResolved=function(){return 0!==(50331648&this._bitField)};e.prototype.isCancelled=function(){return 0!==(8454144&this._bitField)},t.prototype.__isCancelled=function(){return 65536===(65536&this._bitField)},t.prototype._isCancelled=function(){return this._target().__isCancelled()},t.prototype.isCancelled=function(){return 0!==(8454144&this._target()._bitField)},t.prototype.isPending=function(){return o.call(this._target())},t.prototype.isRejected=function(){return s.call(this._target())},t.prototype.isFulfilled=function(){return r.call(this._target())},t.prototype.isResolved=function(){return a.call(this._target())},t.prototype.value=function(){return i.call(this._target())},t.prototype.reason=function(){var t=this._target();return t._unsetRejectionIsUnhandled(),n.call(t)},t.prototype._value=function(){return this._settledValue()},t.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},t.PromiseInspection=e}},function(t,e,i){"use strict";t.exports=function(t,e){function n(i,n){if(u(i)){if(i instanceof t)return i;var r=s(i);if(r===l){n&&n._pushContext();var d=t.reject(r.e);return n&&n._popContext(),d}if("function"==typeof r){if(o(i)){var d=new t(e);return i._then(d._fulfill,d._reject,void 0,d,null),d}return a(i,r,n)}}return i}function r(t){return t.then}function s(t){try{return r(t)}catch(t){return l.e=t,l}}function o(t){try{return h.call(t,"_promise0")}catch(t){return!1}}function a(i,n,r){function s(t){a&&(a._resolveCallback(t),a=null)}function o(t){a&&(a._rejectCallback(t,h,!0),a=null)}var a=new t(e),u=a;r&&r._pushContext(),a._captureStackTrace(),r&&r._popContext();var h=!0,c=d.tryCatch(n).call(i,s,o);return h=!1,a&&c===l&&(a._rejectCallback(c.e,!0,!0),a=null),u}var d=i(2),l=d.errorObj,u=d.isObject,h={}.hasOwnProperty;return n}},function(t,e,i){"use strict";t.exports=function(t,e,n){function r(t){this.handle=t}function s(t){return clearTimeout(this.handle),t}function o(t){throw clearTimeout(this.handle),t}var a=i(2),d=t.TimeoutError;r.prototype._resultCancelled=function(){clearTimeout(this.handle)};var l=function(t){return u(+this).thenReturn(t)},u=t.delay=function(i,s){var o,a;return void 0!==s?(o=t.resolve(s)._then(l,null,null,i,void 0),n.cancellation()&&s instanceof t&&o._setOnCancel(s)):(o=new t(e),a=setTimeout(function(){o._fulfill()},+i),n.cancellation()&&o._setOnCancel(new r(a)),o._captureStackTrace()),o._setAsyncGuaranteed(),o};t.prototype.delay=function(t){return u(t,this)};var h=function(t,e,i){var n;n="string"!=typeof e?e instanceof Error?e:new d("operation timed out"):new d(e),a.markAsOriginatingFromRejection(n),t._attachExtraTrace(n),t._reject(n),null!=i&&i.cancel()};t.prototype.timeout=function(t,e){t=+t;var i,a,d=new r(setTimeout(function(){i.isPending()&&h(i,e,a)},t));return n.cancellation()?(a=this.then(),i=a._then(s,o,void 0,d,void 0),i._setOnCancel(d)):i=this._then(s,o,void 0,d,void 0),i}}},function(t,e,i){"use strict";t.exports=function(t,e,n,r,s,o){function a(t){setTimeout(function(){throw t},0)}function d(t){var e=n(t);return e!==t&&"function"==typeof t._isDisposable&&"function"==typeof t._getDisposer&&t._isDisposable()&&e._setDisposable(t._getDisposer()),e}function l(e,i){function r(){if(o>=l)return u._fulfill();var s=d(e[o++]);if(s instanceof t&&s._isDisposable()){try{s=n(s._getDisposer().tryDispose(i),e.promise)}catch(t){return a(t)}if(s instanceof t)return s._then(r,a,null,null,null)}r()}var o=0,l=e.length,u=new t(s);return r(),u}function u(t,e,i){this._data=t,this._promise=e,this._context=i}function h(t,e,i){this.constructor$(t,e,i)}function c(t){return u.isDisposer(t)?(this.resources[this.index]._setDisposable(t),t.promise()):t}function p(t){this.length=t,this.promise=null,this[t-1]=null}var f=i(2),v=i(4).TypeError,m=i(2).inherits,g=f.errorObj,y=f.tryCatch,_={};u.prototype.data=function(){return this._data},u.prototype.promise=function(){return this._promise},u.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():_},u.prototype.tryDispose=function(t){var e=this.resource(),i=this._context;void 0!==i&&i._pushContext();var n=e!==_?this.doDispose(e,t):null;return void 0!==i&&i._popContext(),this._promise._unsetDisposable(),this._data=null,n},u.isDisposer=function(t){return null!=t&&"function"==typeof t.resource&&"function"==typeof t.tryDispose},m(h,u),h.prototype.doDispose=function(t,e){var i=this.data();return i.call(t,t,e)},p.prototype._resultCancelled=function(){for(var e=this.length,i=0;i<e;++i){var n=this[i];n instanceof t&&n.cancel()}},t.using=function(){var i=arguments.length;if(i<2)return e("you must pass at least 2 arguments to Promise.using");var r=arguments[i-1];if("function"!=typeof r)return e("expecting a function but got "+f.classString(r));var s,a=!0;2===i&&Array.isArray(arguments[0])?(s=arguments[0],i=s.length,a=!1):(s=arguments,i--);for(var d=new p(i),h=0;h<i;++h){var v=s[h];if(u.isDisposer(v)){var m=v;v=v.promise(),v._setDisposable(m)}else{var _=n(v);_ instanceof t&&(v=_._then(c,null,null,{resources:d,index:h},void 0))}d[h]=v}for(var b=new Array(d.length),h=0;h<b.length;++h)b[h]=t.resolve(d[h]).reflect();var w=t.all(b).then(function(t){for(var e=0;e<t.length;++e){var i=t[e];if(i.isRejected())return g.e=i.error(),g;if(!i.isFulfilled())return void w.cancel();t[e]=i.value()}A._pushContext(),r=y(r);var n=a?r.apply(void 0,t):r(t),s=A._popContext();return o.checkForgottenReturns(n,s,"Promise.using",A),n}),A=w.lastly(function(){var e=new t.PromiseInspection(w);return l(d,e)});return d.promise=A,A._setOnCancel(d),A},t.prototype._setDisposable=function(t){this._bitField=131072|this._bitField,this._disposer=t},t.prototype._isDisposable=function(){return(131072&this._bitField)>0},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField=this._bitField&-131073,this._disposer=void 0},t.prototype.disposer=function(t){if("function"==typeof t)return new h(t,this,r());throw new v}}},function(t,e,i){"use strict";function n(t){var e=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C";return t.replace(/#{\s*key\s*}/g,e)}function r(t,e){var i,r,a,d,l,u,h=!1;e||(e={}),i=e.debug||!1;try{a=s(),d=document.createRange(),l=document.getSelection(),u=document.createElement("span"),u.textContent=t,u.style.all="unset",u.style.position="fixed",u.style.top=0,u.style.clip="rect(0, 0, 0, 0)",u.style.whiteSpace="pre",u.style.webkitUserSelect="text",u.style.MozUserSelect="text",u.style.msUserSelect="text",u.style.userSelect="text",document.body.appendChild(u),d.selectNode(u),l.addRange(d);var c=document.execCommand("copy");if(!c)throw new Error("copy command was unsuccessful");h=!0}catch(s){i&&console.error("unable to copy using execCommand: ",s),i&&console.warn("trying IE specific stuff");try{window.clipboardData.setData("text",t),h=!0}catch(s){i&&console.error("unable to copy using clipboardData: ",s),i&&console.error("falling back to prompt"),r=n("message"in e?e.message:o),window.prompt(r,t)}}finally{l&&("function"==typeof l.removeRange?l.removeRange(d):l.removeAllRanges()),u&&document.body.removeChild(u),a()}return h}var s=i(111),o="Copy to clipboard: #{key}, Enter";t.exports=r},function(t,e){(function(e){function i(t,e,i){function r(e){var i=v,n=m;return v=m=void 0,T=e,y=t.apply(n,i)}function s(t){return T=t,_=setTimeout(u,e),C?r(t):y}function d(t){var i=t-k,n=t-T,r=e-i;return E?w(r,g-n):r}function l(t){var i=t-k,n=t-T;return void 0===k||i>=e||i<0||E&&n>=g}function u(){var t=A();return l(t)?h(t):void(_=setTimeout(u,d(t)))}function h(t){return _=void 0,P&&v?r(t):(v=m=void 0,y)}function c(){void 0!==_&&clearTimeout(_),T=0,v=k=m=_=void 0}function p(){return void 0===_?y:h(A())}function f(){var t=A(),i=l(t);if(v=arguments,m=this,k=t,i){if(void 0===_)return s(k);if(E)return _=setTimeout(u,e),r(k)}return void 0===_&&(_=setTimeout(u,e)),y}var v,m,g,y,_,k,T=0,C=!1,E=!1,P=!0;if("function"!=typeof t)throw new TypeError(a);return e=o(e)||0,n(i)&&(C=!!i.leading,E="maxWait"in i,g=E?b(o(i.maxWait)||0,e):g,P="trailing"in i?!!i.trailing:P),f.cancel=c,f.flush=p,f}function n(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function r(t){return!!t&&"object"==typeof t}function s(t){return"symbol"==typeof t||r(t)&&_.call(t)==l}function o(t){if("number"==typeof t)return t;if(s(t))return d;if(n(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=n(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(u,"");var i=c.test(t);return i||p.test(t)?f(t.slice(2),i?2:8):h.test(t)?d:+t}var a="Expected a function",d=NaN,l="[object Symbol]",u=/^\s+|\s+$/g,h=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,p=/^0o[0-7]+$/i,f=parseInt,v="object"==typeof e&&e&&e.Object===Object&&e,m="object"==typeof self&&self&&self.Object===Object&&self,g=v||m||Function("return this")(),y=Object.prototype,_=y.toString,b=Math.max,w=Math.min,A=function(){return g.Date.now()};t.exports=i}).call(e,function(){return this}())},function(t,e,i){!function(e,i){t.exports=i()}(this,function(){return function(t){function e(t){delete installedChunks[t]}function i(t){var e=document.getElementsByTagName("head")[0],i=document.createElement("script");i.type="text/javascript",i.charset="utf-8",i.src=p.p+"hot_updater/hot-update.js",e.appendChild(i)}function n(){return new Promise(function(t,e){if("undefined"==typeof XMLHttpRequest)return e(new Error("No browser support"));try{var i=new XMLHttpRequest,n=p.p+"hot_updater/hot-update.json";i.open("GET",n,!0),i.timeout=1e4,i.send(null)}catch(t){return e(t)}i.onreadystatechange=function(){if(4===i.readyState)if(0===i.status)e(new Error("Manifest request to "+n+" timed out."));else if(404===i.status)t();else if(200!==i.status&&304!==i.status)e(new Error("Manifest request to "+n+" failed."));else{try{var r=JSON.parse(i.responseText)}catch(t){return void e(t)}t(r)}}})}function r(t){var e=x[t];if(!e)return p;var i=function(i){return e.hot.active?(x[i]?x[i].parents.indexOf(t)<0&&x[i].parents.push(t):(A=[t],v=i),e.children.indexOf(i)<0&&e.children.push(i)):(console.warn("[HMR] unexpected require("+i+") from disposed module "+t),A=[]),p(i)};for(var n in p)Object.prototype.hasOwnProperty.call(p,n)&&"e"!==n&&Object.defineProperty(i,n,function(t){return{configurable:!0,enumerable:!0,get:function(){return p[t]},set:function(e){p[t]=e}}}(n));return i.e=function(t){function e(){P--,"prepare"===C&&(S[t]||u(t),0===P&&0===E&&h())}return"ready"===C&&o("prepare"),P++,p.e(t).then(e,function(t){throw e(),t})},i}function s(t){var e={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:v!==t,active:!0,accept:function(t,i){if(void 0===t)e._selfAccepted=!0;else if("function"==typeof t)e._selfAccepted=t;else if("object"==typeof t)for(var n=0;n<t.length;n++)e._acceptedDependencies[t[n]]=i||function(){};else e._acceptedDependencies[t]=i||function(){}},decline:function(t){if(void 0===t)e._selfDeclined=!0;else if("object"==typeof t)for(var i=0;i<t.length;i++)e._declinedDependencies[t[i]]=!0;else e._declinedDependencies[t]=!0},dispose:function(t){e._disposeHandlers.push(t)},addDisposeHandler:function(t){e._disposeHandlers.push(t)},removeDisposeHandler:function(t){var i=e._disposeHandlers.indexOf(t);i>=0&&e._disposeHandlers.splice(i,1)},check:d,apply:c,status:function(t){return t?void T.push(t):C},addStatusHandler:function(t){T.push(t)},removeStatusHandler:function(t){var e=T.indexOf(t);e>=0&&T.splice(e,1)},data:w[t]};return v=void 0,e}function o(t){C=t;for(var e=0;e<T.length;e++)T[e].call(null,t)}function a(t){return+t+""===t?+t:t}function d(t){if("idle"!==C)throw new Error("check() is only allowed in idle status");return _=t,o("check"),n().then(function(t){if(!t)return o("idle"),null;I={},S={},V=t.c,y=t.h,o("prepare");var e=new Promise(function(t,e){m={resolve:t,reject:e}});return g={},u(0),"prepare"===C&&0===P&&0===E&&h(),e})}function l(t,e){if(V[t]&&I[t]){I[t]=!1;for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(g[i]=e[i]);0==--E&&0===P&&h()}}function u(t){V[t]?(I[t]=!0,E++,i(t)):S[t]=!0}function h(){o("ready");var t=m;if(m=null,t)if(_)c(_).then(function(e){t.resolve(e)},function(e){t.reject(e)});else{var e=[];for(var i in g)Object.prototype.hasOwnProperty.call(g,i)&&e.push(a(i));t.resolve(e)}}function c(i){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];t.indexOf(n)<0&&t.push(n)}}if("ready"!==C)throw new Error("apply() is only allowed in ready status");i=i||{};var r,s,d,l,u,h={},c=[],f={},v=function(){console.warn("[HMR] unexpected require("+_.moduleId+") to disposed module")};for(var m in g)if(Object.prototype.hasOwnProperty.call(g,m)){u=a(m);var _;_=g[m]?function(t){for(var e=[t],i={},r=e.slice().map(function(t){return{chain:[t],id:t}});r.length>0;){var s=r.pop(),o=s.id,a=s.chain;if((l=x[o])&&!l.hot._selfAccepted){if(l.hot._selfDeclined)return{type:"self-declined",chain:a,moduleId:o};if(l.hot._main)return{type:"unaccepted",chain:a,moduleId:o};for(var d=0;d<l.parents.length;d++){var u=l.parents[d],h=x[u];if(h){if(h.hot._declinedDependencies[o])return{type:"declined",chain:a.concat([u]),moduleId:o,parentId:u};e.indexOf(u)>=0||(h.hot._acceptedDependencies[o]?(i[u]||(i[u]=[]),n(i[u],[o])):(delete i[u],e.push(u),r.push({chain:a.concat([u]),id:u})))}}}}return{type:"accepted",moduleId:t,outdatedModules:e,outdatedDependencies:i}}(u):{type:"disposed",moduleId:m};var k=!1,T=!1,E=!1,P="";switch(_.chain&&(P="\nUpdate propagation: "+_.chain.join(" -> ")),_.type){case"self-declined":i.onDeclined&&i.onDeclined(_),i.ignoreDeclined||(k=new Error("Aborted because of self decline: "+_.moduleId+P));break;case"declined":i.onDeclined&&i.onDeclined(_),i.ignoreDeclined||(k=new Error("Aborted because of declined dependency: "+_.moduleId+" in "+_.parentId+P));break;case"unaccepted":i.onUnaccepted&&i.onUnaccepted(_),i.ignoreUnaccepted||(k=new Error("Aborted because "+u+" is not accepted"+P));break;case"accepted":i.onAccepted&&i.onAccepted(_),T=!0;break;case"disposed":i.onDisposed&&i.onDisposed(_),E=!0;break;default:throw new Error("Unexception type "+_.type)}if(k)return o("abort"),Promise.reject(k);if(T){f[u]=g[u],n(c,_.outdatedModules);for(u in _.outdatedDependencies)Object.prototype.hasOwnProperty.call(_.outdatedDependencies,u)&&(h[u]||(h[u]=[]),n(h[u],_.outdatedDependencies[u]))}E&&(n(c,[_.moduleId]),f[u]=v)}var S=[];for(s=0;s<c.length;s++)u=c[s],x[u]&&x[u].hot._selfAccepted&&S.push({module:u,errorHandler:x[u].hot._selfAccepted});o("dispose"),Object.keys(V).forEach(function(t){!1===V[t]&&e(t)});for(var I,O=c.slice();O.length>0;)if(u=O.pop(),l=x[u]){var D={},M=l.hot._disposeHandlers;for(d=0;d<M.length;d++)(r=M[d])(D);for(w[u]=D,l.hot.active=!1,delete x[u],d=0;d<l.children.length;d++){var F=x[l.children[d]];F&&(I=F.parents.indexOf(u))>=0&&F.parents.splice(I,1)}}var L,R;for(u in h)if(Object.prototype.hasOwnProperty.call(h,u)&&(l=x[u]))for(R=h[u],d=0;d<R.length;d++)L=R[d],(I=l.children.indexOf(L))>=0&&l.children.splice(I,1);o("apply"),b=y;for(u in f)Object.prototype.hasOwnProperty.call(f,u)&&(t[u]=f[u]);var B=null;for(u in h)if(Object.prototype.hasOwnProperty.call(h,u)){l=x[u],R=h[u];var j=[];for(s=0;s<R.length;s++)L=R[s],r=l.hot._acceptedDependencies[L],j.indexOf(r)>=0||j.push(r);for(s=0;s<j.length;s++){r=j[s];try{r(R)}catch(t){i.onErrored&&i.onErrored({type:"accept-errored",moduleId:u,dependencyId:R[s],error:t}),i.ignoreErrored||B||(B=t)}}}for(s=0;s<S.length;s++){var U=S[s];u=U.module,A=[u];try{p(u)}catch(t){if("function"==typeof U.errorHandler)try{U.errorHandler(t)}catch(e){i.onErrored&&i.onErrored({type:"self-accept-error-handler-errored",moduleId:u,error:e,orginalError:t}),i.ignoreErrored||B||(B=e),B||(B=t)}else i.onErrored&&i.onErrored({type:"self-accept-errored",moduleId:u,error:t}),i.ignoreErrored||B||(B=t)}}return B?(o("fail"),Promise.reject(B)):(o("idle"),new Promise(function(t){t(c)}))}function p(e){if(x[e])return x[e].exports;var i=x[e]={i:e,l:!1,exports:{},hot:s(e),parents:(k=A,A=[],k),children:[]};return t[e].call(i.exports,i,i.exports,r(e)),i.l=!0,i.exports}var f=this.webpackHotUpdate;this.webpackHotUpdate=function(t,e){l(t,e),f&&f(t,e)};var v,m,g,y,_=!0,b="4fb492c9fa94d833f8a9",w={},A=[],k=[],T=[],C="idle",E=0,P=0,S={},I={},V={},x={};return p.m=t,p.c=x,p.i=function(t){return t},p.d=function(t,e,i){p.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},p.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return p.d(e,"a",e),e},p.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},p.p="",p.h=function(){return b},r(0)(p.s=0)}({"./src/index.js":function(t,e,i){"use strict";var n=i("./src/oppsula.js");try{if(window.cmTag){var r=window.cmTag.config.ms||{};r.oppsula=r.oppsula||{},r.oppsula["1.3.5"]=n,window.cmTag.set("ms",r)}window.TRC&&(window.TRC.oppsula=window.TRC.oppsula||{},window.TRC.oppsula["1.3.5"]=n)}catch(t){}t.exports={}},"./src/opportunityType.js":function(t,e,i){"use strict";t.exports={tagStarted:0,tagImpression:1,vastFecthError:2,emptyVast:3,mediaFileNotSupported:4,adError:5,filterVastByRegex:6,playerClosed:7,vastError:8,totalTimeout:9,adErrorBeforeLoad:10,networkError:11,adUnitLoadFailed:12,queueExpired:13,queueTrimmed:14,globalTimeout:15,adtoTimeout:16,adSkiped:17,adloadedTimeout:18,hijackAttempt:19,idleMode:20,firstImpression:99,videoFirstQuartile:21,videoMidpoint:22,videoThirdQuartile:23,videoComplete:24,newCompletion:25,replayAd:27,soundViolation:34,firstWfMeasurment:35,playerClosedMeasurment:36,maxNetworkCalls:39,adLoaded:41,startAd:42,videoThrottle:43}},"./src/oppsula.js":function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=i("./src/xhr.js"),o=i("./src/store.js"),a=i("./src/utils.js"),d=i("./src/opportunityType.js"),l={},u=function(){function t(e,i){n(this,t);var r=this._getRedId(e)||this._getRedId(i)||"red_id";return l.hasOwnProperty(r)||(this.redId=r,this.store=new o(e,i),this.baseUrl=a.getOppsServletBaseUrl(this.store),this.xhr=new s(this.baseUrl,this.store.get("psthdrs")),this.opps=[],this.fireOppsInterval=null,this.stopped=!1,this.billableEvents=(this.store.get("bllblevt")||"").split(","),this.unloadCallbacks=[],this.fireOppsCallbacks=[],this._setFireOppsInterval(),this._setFireOppsBeforeUnload(),l[r]=this),l[r]}return r(t,[{key:"registerCallback",value:function(t,e){this[t].push(e)}},{key:"unRegisterCallback",value:function(t,e){this[t].splice(this[t].indexOf(e),1)}},{key:"_activateCallbacks",value:function(t){for(var e=0;e<this[t].length;e++){var i=this[t][e];this[t].splice(this[t].indexOf(i),1),i()}}},{key:"_getRedId",value:function(t){if(t)return t.get("redId")||t.get("red_id")}},{key:"send",value:function(t){t.tms=Math.floor((new Date).getTime()/1e3),this.stopped||(this._isBillableEvent(t.rst)||!this.store.get("cmbopps")?this.xhr.send(a.stringify([t]),t.rst):this.opps.push(t))}},{key:"_setFireOppsInterval",value:function(){this.stopped||this.fireOppsInterval||(this.fireOpps=this._fireOpps.bind(this),this.fireOppsInterval=setInterval(this.fireOpps,this.store.get("timbtopps")))}},{key:"destroy",value:function(){this.stopped||(this._activateCallbacks("unloadCallbacks"),window.removeEventListener("beforeunload",this._destroy),this.fireOppsInterval=clearInterval(this.fireOppsInterval),this._fireOpps(),this.stopped=!0,this.store&&this.store.destroy(),this.opps=this.store=this.fireOpps=this.xhr=this._destroy=void 0,l[this.redId]=void 0)}},{key:"_fireOpps",value:function(){this.stopped||(this._activateCallbacks("fireOppsCallbacks"),this.opps.length>0&&this.xhr.send(a.stringify(this.opps)),this.opps=[])}},{key:"_setFireOppsBeforeUnload",value:function(){this._destroy=this.destroy.bind(this),window.addEventListener("beforeunload",this._destroy)}},{key:"_isBillableEvent",value:function(t){return this.billableEvents.indexOf(""+t)>-1}},{key:"OppsID",get:function(){return d}}]),t}();t.exports=u},"./src/store.js":function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=(i("./src/utils.js"),function(){function t(e,i){n(this,t),this.unitModel=e,this.playerModel=i,this.data={psthdrs:"application/json",timbtopps:2e3}}return r(t,[{key:"get",value:function(t){return this._getFromPlayerModel(t)}},{key:"_getFromPlayerModel",value:function(t){var e=this.playerModel?this.playerModel.get(t):void 0;return void 0!==e?e:this._getFromUnitModel(t)}},{key:"_getFromUnitModel",value:function(t){var e=this.unitModel?this.unitModel.get(t):void 0;return void 0!==e?e:this._getFromData(t)}},{key:"_getFromData",value:function(t){return t=t.toString(),-1===t.indexOf(".")?this.data[t]:o.get(t,!1,this.data)}},{key:"set",value:function(t,e){t=t.toString(),o.set(t,e,this.data)}},{key:"destroy",value:function(){this.unitModel=this.playerModel=this.data=void 0}}]),t}()),o=function(){var t=function(t,e,i){for(var n,r=i||data,s=0;r&&(n=t[s]);s++)r=n in r?r[n]:e?r[n]={}:void 0;return r};return{set:function(e,i,n){var r=e.split("."),s=r.pop(),o=t(r,!0,n);return o&&s?o[s]=i:void 0},get:function(e,i,n){return t(e.split("."),i,n)},exists:function(t,e){return void 0!==this.get(t,!1,e)}}}();t.exports=s},"./src/utils.js":function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.exports={getOppsServletBaseUrl:function(t){var e=t.get("ms_data.opps_base_path");return this.setUrlPrefix(e)+(/.*\/$/g.test(e)?"":"/")+"OpportunityServlet"},setUrlPrefix:function(t){return"string"!=typeof t?t:(t=t.replace(/^(http[s]?:|ftp:)/g,""),0!==t.indexOf("//")&&(t="//"+t),t)},stringify:function(t,e){try{var i=[];return JSON.stringify(t,function(t,e){if(null!=e&&"object"==(void 0===e?"undefined":n(e))){if(i.indexOf(e)>-1)return;i.push(e)}return e},e)}catch(t){return""}},fireOpp:function(t){try{(new Image).src=t}catch(t){}},flattenParams:function(t){var e=[];for(var i in t)e.push(i+"="+t[i]);return e.join("&")}}},"./src/xhr.js":function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),s=(i("./src/utils.js"),function(){function t(e,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;arguments.length>5&&void 0!==arguments[5]&&arguments[5],n(this,t),this.baseUrl=e,this.async=void 0==r||r,this.withCredentials=void 0==s||s,this.timeout=o||5e3,this.contentType=i||"application/x-www-form-urlencoded"}return r(t,[{key:"_onFail",value:function(){this.gotResponse||(this.gotResponse=!0)}},{key:"send",value:function(t,e){if(this.baseUrl){var i=this.baseUrl+(void 0!==e?"?rst="+e:""),n=new XMLHttpRequest;return t=t||"",n.open(t?"POST":"GET",i,!0),n.withCredentials=this.withCredentials,n.setRequestHeader("Content-type",this.contentType),n.async=this.async,n.timeout=this.timeout,n.gotResponse=!1,n.addEventListener("error",this._onFail),n.addEventListener("abort",this._onFail),n.addEventListener("timeout",this._onFail),n.addEventListener("readystatechange",function(t){if(4==this.readyState){if(this.gotResponse)return;this.gotResponse=!0}}),n.send(t),!0}}}]),t}());t.exports=s},0:function(t,e,i){t.exports=i("./src/index.js")}})})},function(t,e){t.exports=function(){var t=document.getSelection();if(!t.rangeCount)return function(){};for(var e=document.activeElement,i=[],n=0;n<t.rangeCount;n++)i.push(t.getRangeAt(n));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null}return t.removeAllRanges(),function(){"Caret"===t.type&&t.removeAllRanges(),t.rangeCount||i.forEach(function(e){t.addRange(e)}),e&&e.focus()}}},function(t,e,i){var n;!function(r,s){"use strict";var o="0.7.12",a="",d="?",l="function",u="undefined",h="object",c="string",p="major",f="model",v="name",m="type",g="vendor",y="version",_="architecture",b="console",w="mobile",A="tablet",k="smarttv",T="wearable",C="embedded",E={extend:function(t,e){var i={};for(var n in t)e[n]&&e[n].length%2===0?i[n]=e[n].concat(t[n]):i[n]=t[n];return i},has:function(t,e){return"string"==typeof t&&e.toLowerCase().indexOf(t.toLowerCase())!==-1},lowerize:function(t){return t.toLowerCase()},major:function(t){return typeof t===c?t.replace(/[^\d\.]/g,"").split(".")[0]:s},trim:function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},P={rgx:function(){for(var t,e,i,n,r,o,a,d=0,c=arguments;d<c.length&&!o;){var p=c[d],f=c[d+1];if(typeof t===u){t={};for(n in f)f.hasOwnProperty(n)&&(r=f[n],typeof r===h?t[r[0]]=s:t[r]=s)}for(e=i=0;e<p.length&&!o;)if(o=p[e++].exec(this.getUA()))for(n=0;n<f.length;n++)a=o[++i],r=f[n],typeof r===h&&r.length>0?2==r.length?typeof r[1]==l?t[r[0]]=r[1].call(this,a):t[r[0]]=r[1]:3==r.length?typeof r[1]!==l||r[1].exec&&r[1].test?t[r[0]]=a?a.replace(r[1],r[2]):s:t[r[0]]=a?r[1].call(this,a,r[2]):s:4==r.length&&(t[r[0]]=a?r[3].call(this,a.replace(r[1],r[2])):s):t[r]=a?a:s;d+=2}return t},str:function(t,e){for(var i in e)if(typeof e[i]===h&&e[i].length>0){for(var n=0;n<e[i].length;n++)if(E.has(e[i][n],t))return i===d?s:i}else if(E.has(e[i],t))return i===d?s:i;return t}},S={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},I={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[v,y],[/(opios)[\/\s]+([\w\.]+)/i],[[v,"Opera Mini"],y],[/\s(opr)\/([\w\.]+)/i],[[v,"Opera"],y],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs)\/([\w\.-]+)/i],[v,y],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[v,"IE"],y],[/(edge)\/((\d+)?[\w\.]+)/i],[v,y],[/(yabrowser)\/([\w\.]+)/i],[[v,"Yandex"],y],[/(comodo_dragon)\/([\w\.]+)/i],[[v,/_/g," "],y],[/(micromessenger)\/([\w\.]+)/i],[[v,"WeChat"],y],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[y,[v,"MIUI Browser"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[v,/(.+)/,"$1 WebView"],y],[/android.+samsungbrowser\/([\w\.]+)/i,/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[y,[v,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(qqbrowser)[\/\s]?([\w\.]+)/i],[v,y],[/(uc\s?browser)[\/\s]?([\w\.]+)/i,/ucweb.+(ucbrowser)[\/\s]?([\w\.]+)/i,/juc.+(ucweb)[\/\s]?([\w\.]+)/i],[[v,"UCBrowser"],y],[/(dolfin)\/([\w\.]+)/i],[[v,"Dolphin"],y],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[v,"Chrome"],y],[/;fbav\/([\w\.]+);/i],[y,[v,"Facebook"]],[/fxios\/([\w\.-]+)/i],[y,[v,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[y,[v,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[y,v],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[v,[y,P.str,S.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[v,y],[/(navigator|netscape)\/([\w\.-]+)/i],[[v,"Netscape"],y],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[v,y]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[_,"amd64"]],[/(ia32(?=;))/i],[[_,E.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[_,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[_,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[_,/ower/,"",E.lowerize]],[/(sun4\w)[;\)]/i],[[_,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[_,E.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[f,g,[m,A]],[/applecoremedia\/[\w\.]+ \((ipad)/],[f,[g,"Apple"],[m,A]],[/(apple\s{0,1}tv)/i],[[f,"Apple TV"],[g,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[g,f,[m,A]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[f,[g,"Amazon"],[m,A]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[f,P.str,S.device.amazon.model],[g,"Amazon"],[m,w]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[f,g,[m,w]],[/\((ip[honed|\s\w*]+);/i],[f,[g,"Apple"],[m,w]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[g,f,[m,w]],[/\(bb10;\s(\w+)/i],[f,[g,"BlackBerry"],[m,w]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[f,[g,"Asus"],[m,A]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[g,"Sony"],[f,"Xperia Tablet"],[m,A]],[/(?:sony)?(?:(?:(?:c|d)\d{4})|(?:so[-l].+))\sbuild\//i],[[g,"Sony"],[f,"Xperia Phone"],[m,w]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[g,f,[m,b]],[/android.+;\s(shield)\sbuild/i],[f,[g,"Nvidia"],[m,b]],[/(playstation\s[34portablevi]+)/i],[f,[g,"Sony"],[m,b]],[/(sprint\s(\w+))/i],[[g,P.str,S.device.sprint.vendor],[f,P.str,S.device.sprint.model],[m,w]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[g,f,[m,A]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[g,[f,/_/g," "],[m,w]],[/(nexus\s9)/i],[f,[g,"HTC"],[m,A]],[/(nexus\s6p)/i],[f,[g,"Huawei"],[m,w]],[/(microsoft);\s(lumia[\s\w]+)/i],[g,f,[m,w]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[f,[g,"Microsoft"],[m,b]],[/(kin\.[onetw]{3})/i],[[f,/\./g," "],[g,"Microsoft"],[m,w]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[f,[g,"Motorola"],[m,w]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[f,[g,"Motorola"],[m,A]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[g,E.trim],[f,E.trim],[m,k]],[/hbbtv.+maple;(\d+)/i],[[f,/^/,"SmartTV"],[g,"Samsung"],[m,k]],[/\(dtv[\);].+(aquos)/i],[f,[g,"Sharp"],[m,k]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[g,"Samsung"],f,[m,A]],[/smart-tv.+(samsung)/i],[g,[m,k],f],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[g,"Samsung"],f,[m,w]],[/sie-(\w+)*/i],[f,[g,"Siemens"],[m,w]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[g,"Nokia"],f,[m,w]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[f,[g,"Acer"],[m,A]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[g,"LG"],f,[m,A]],[/(lg) netcast\.tv/i],[g,f,[m,k]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i],[f,[g,"LG"],[m,w]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[f,[g,"Lenovo"],[m,A]],[/linux;.+((jolla));/i],[g,f,[m,w]],[/((pebble))app\/[\d\.]+\s/i],[g,f,[m,T]],[/android.+;\s(glass)\s\d/i],[f,[g,"Google"],[m,T]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d\w)?)\s+build/i],[[f,/_/g," "],[g,"Xiaomi"],[m,w]],[/android.+a000(1)\s+build/i],[f,[g,"OnePlus"],[m,w]],[/\s(tablet)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[m,E.lowerize],g,f]],
engine:[[/windows.+\sedge\/([\w\.]+)/i],[y,[v,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[v,y],[/rv\:([\w\.]+).*(gecko)/i],[y,v]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[v,y],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s]+\w)*/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[v,[y,P.str,S.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[v,"Windows"],[y,P.str,S.os.windows.version]],[/\((bb)(10);/i],[[v,"BlackBerry"],y],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[v,y],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[v,"Symbian"],y],[/\((series40);/i],[v],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[v,"Firefox OS"],y],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[v,y],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[v,"Chromium OS"],y],[/(sunos)\s?([\w\.]+\d)*/i],[[v,"Solaris"],y],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[v,y],[/(haiku)\s(\w+)/i],[v,y],[/(ip[honead]+)(?:.*os\s([\w]+)*\slike\smac|;\sopera)/i],[[v,"iOS"],[y,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[v,"Mac OS"],[y,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[v,y]]},V=function(t,e){if(!(this instanceof V))return new V(t,e).getResult();var i=t||(r&&r.navigator&&r.navigator.userAgent?r.navigator.userAgent:a),n=e?E.extend(I,e):I;return this.getBrowser=function(){var t=P.rgx.apply(this,n.browser);return t.major=E.major(t.version),t},this.getCPU=function(){return P.rgx.apply(this,n.cpu)},this.getDevice=function(){return P.rgx.apply(this,n.device)},this.getEngine=function(){return P.rgx.apply(this,n.engine)},this.getOS=function(){return P.rgx.apply(this,n.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(t){return i=t,this},this};V.VERSION=o,V.BROWSER={NAME:v,MAJOR:p,VERSION:y},V.CPU={ARCHITECTURE:_},V.DEVICE={MODEL:f,VENDOR:g,TYPE:m,CONSOLE:b,MOBILE:w,SMARTTV:k,TABLET:A,WEARABLE:T,EMBEDDED:C},V.ENGINE={NAME:v,VERSION:y},V.OS={NAME:v,VERSION:y},typeof e!==u?(typeof t!==u&&t.exports&&(e=t.exports=V),e.UAParser=V):"function"===l&&i(113)?(n=function(){return V}.call(e,i,e,t),!(n!==s&&(t.exports=n))):r.UAParser=V;var x=r.jQuery||r.Zepto;if(typeof x!==u){var O=new V;x.ua=O.getResult(),x.ua.get=function(){return O.getUA()},x.ua.set=function(t){O.setUA(t);var e=O.getResult();for(var i in e)x.ua[i]=e[i]}}}("object"==typeof window?window:this)},function(t,e){(function(e){t.exports=e}).call(e,{})}]);