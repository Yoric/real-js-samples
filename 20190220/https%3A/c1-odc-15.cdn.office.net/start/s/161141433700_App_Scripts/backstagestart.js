var Utils,MruHandler,UploadHandler,TemplatesHandler,SettingsHandler,PlacesHandler,WhatsNewHandler;(function(n){function i(n,t){n.innerText!=undefined?n.innerText=t:n.textContent=t}function r(n,t){n.className.indexOf(t)==-1&&(n.className+=" "+t)}function u(n,t){n.className=n.className.replace(new RegExp(t),"")}function f(n,t){n.style.backgroundImage="url("+t+")"}function e(n,i,r){var u=function(n){var t=s(n);i(t)};t(n,null,u,r,"GET")}function o(n,i,r,u){t(n,i,r,u,"POST")}function s(n){n=n.trim();return n.trim()==""?null:JSON.parse(n)}function t(n,t,i,r,u){var f={url:n,complete:function(n){n.readyState==4&&(n.status==200?i(n.responseText):r(n.status))},type:u,data:t==null?null:t.toString(),beforeSend:function(n){n.setRequestHeader("x-Key",g_canary)}};$.ajax(f)}function h(n,t,i,r){c(n,t,i,r,"POST")}function c(n,t,i,r,u){var f={url:n,complete:function(n){n.readyState==4&&(n.status==200?i(n.responseText):r(n.status))},type:u,data:t,processData:!1,contentType:"multipart/form-data",beforeSend:function(n){n.setRequestHeader("Canary",g_canary)}};$.ajax(f)}n.SetInnerText=i;n.AddClass=r;n.RemoveClass=u;n.SetBackgroundImage=f;n.MakeGetXhr=e;n.MakePostXhr=o;n.MakePostFileXhr=h})(Utils||(Utils={})),function(n){function t(){Utils.MakeGetXhr(g_urlMru,i,r)}function i(n){var r=document.getElementById("mrucontents"),i,t,e;if(r.className=r.className.replace(/loading/,""),n&&n.length&&n.length!=0)for(t=0;t<g_cMruItems&&t<n.length;t++){if(!u())break;e=n[t];e.mruIndex=t;f(e)}else i=document.createElement("div"),i.className="mruwelcome uifont",Utils.SetInnerText(i,g_strMruWelcome),r.appendChild(i)}function r(n){var t,i;Diag.ULS.sendTraceTag(21771075,g_msoulscat_Wac_WebAppsPortal,Diag.ULSTraceLevel.info,"Failed to fetch MRU.  Status code: {0}",n);t=document.getElementById("mrucontents");t.className=t.className.replace(/loading/,"");i=document.createElement("div");i.className="mruwelcome uifont";Utils.SetInnerText(i,g_strMruError);t.appendChild(i)}function u(){var n=document.getElementById("b_dialogpanel").clientHeight,t=document.getElementById("b_mrucontainer").clientHeight,i=document.getElementById("b_opencontainer").clientHeight,r=n-t-i;return r>=46}function f(n){var f=document.createElement("li"),t=document.createElement("a"),i,r,u,e;t.className="mruitem uifont";t.href=n.DocumentUrl;t.id="mruitem_"+n.mruIndex;t.title=n.FileName;t.setAttribute("aria-labeledby","mruitemname_"+n.mruIndex);t.setAttribute("aria-describedby","mruitempath_"+n.mruIndex);t.setAttribute("role","menuitem");i=document.createElement("img");i.className="mruicon";i.setAttribute("role","presentation");i.src=g_urlMruIcon;r=document.createElement("div");r.className="mruitemname uifontlarge";r.id="mruitemname_"+n.mruIndex;Utils.SetInnerText(r,n.FileName);u=document.createElement("div");u.className="mruitempath uifontsmall";u.id="mruitempath_"+n.mruIndex;Utils.SetInnerText(u,n.PathList.join(g_fUIRtl?" « ":" » "));e=document.getElementById("mrucontents");t.appendChild(i);t.appendChild(r);t.appendChild(u);f.appendChild(t);e.appendChild(f)}n.FetchMru=t}(MruHandler||(MruHandler={})),function(n){function c(){var n,t,i;g_isUploadEnabled&&(n=document.getElementById("upload-entry"),n.innerHTML===""&&(t=document.createElement("img"),t.className="uploadicon",t.setAttribute("role","presentation"),t.src=g_urlUploadIcon,n.appendChild(t),i=document.createElement("span"),i.className="uploaddetails",i.title=g_strAppSpecificUpload,Utils.SetInnerText(i,g_strAppSpecificUpload),n.appendChild(i)),n.addEventListener("keypress",function(t){t.preventDefault();t.stopImmediatePropagation();t.keyCode==13&&n.click()}))}function l(){var n=document.getElementById("upload-entry");n!=null&&Utils.SetInnerText(n,"")}function a(){f=(new Date).getTime();Diag.ULS.sendTraceTag(21771076,g_msoulscat_Wac_WebAppsPortal,Diag.ULSTraceLevel.info,"file upload button clicked");var n=document.getElementById("fileElem");n.click()}function v(n){var i,f,u,t;n.length&&(n.length>1&&Diag.ULS.sendTraceTag(21771077,g_msoulscat_Wac_WebAppsPortal,Diag.ULSTraceLevel.info,"Multiple file upload attempted"),i=n[0],r=i.size,f=y(i.name),u=PlacesHandler.GetHost(),f?r<g_nUploadMaxRequestSizeBytes?(g(i.name,u),t=g_uploadTargetUrl,t=t.replace("{HOST}",u),t=t.replace("{FILENAME}",encodeURIComponent(i.name)),g_authType==="OrgId"&&(t=t.replace("{ORGURL}",encodeURIComponent(g_orgidDestinationUrl))),Utils.MakePostFileXhr(t,i,function(n){tt(n,u)},function(n){h(n,u,"MakePostFileXhr fail")})):(Diag.ULS.sendTraceTag(21771078,g_msoulscat_Wac_WebAppsPortal,Diag.ULSTraceLevel.info,"Large file of size {0} in {1}",i.size,g_appName),b(u)):w(u))}function y(n){for(var u,i="."+n.match(/\.([^.]+)$/)[1],r=g_acceptExt.split(","),t=0;t<r.length;t++)if(u=r[t],i==u)return!0;return p(i)}function p(n){return Diag.ULS.sendTraceTag(21771079,g_msoulscat_Wac_WebAppsPortal,Diag.ULSTraceLevel.info,"Invalid extension {0} in {1}",n,g_appName),!1}function w(n){var r,f;u();r=g_strUploadErrorMsg.replace("{0}",g_acceptExt);t(r);f=g_strUploadErrorTryAgain.replace("{0}",n);i(f);o(n)}function b(n){var r,f;u();r=g_strUploadFileSizeError;t(r);f=g_strUploadFileSizeErrorRedirect.replace("{0}",n);i(f);nt(n)}function u(){var n=document.getElementById("uploadingband");n.setAttribute("style","initial")}function e(){var n=document.getElementById("b_errorButtonRow");n.setAttribute("style","initial")}function t(n){var t=document.getElementById("b_dialogtitle");Utils.SetInnerText(t,n)}function i(n){var t=document.getElementById("b_taglinefont");Utils.SetInnerText(t,n)}function k(){var n=document.getElementById("spinner"),t=document.getElementById("b_dialogcontents");t.removeChild(n)}function d(){var t=document.getElementById("uploadingband"),n;t.setAttribute("style","display:none");n=document.getElementById("b_errorLeftButton");n.setAttribute("onclick","")}function g(n,r){var o=n.substr(0,n.lastIndexOf(".")),c=document.getElementById("b_errorButtonRow"),f,e,s,h;c.setAttribute("style","display:none");u();t(g_strUploading);f=g_strUploadingACopy.replace("{0}",o);f=f.replace("{0}",o);f=f.replace("{1}",r);i(f);e=document.createElement("div");e.id="spinner";e.setAttribute("class","uploadloading loading");s=document.getElementById("b_dialogcontents");h=document.getElementById("b_errorButtonRow");s.insertBefore(e,h)}function o(n){var t,i,r;e();t=document.getElementById("b_errorLeftButton");t.setAttribute("href","#");t.setAttribute("onclick","UploadHandler.RemoveResetUploadBand();return false;");Utils.SetInnerText(t,g_strUploadTryAgainButton);i=document.getElementById("b_errorRightButton");i.setAttribute("href",g_urlGoToHost);r=g_strUploadGoToButton.replace("{0}",n);Utils.SetInnerText(i,r)}function nt(n){var t,i,r;e();t=document.getElementById("b_errorLeftButton");t.setAttribute("href","#");t.setAttribute("onclick","UploadHandler.RemoveResetUploadBand();return false;");Utils.SetInnerText(t,g_strUploadBackButton);i=document.getElementById("b_errorRightButton");i.setAttribute("href",g_urlGoToHost);r=g_strUploadGoToButton.replace("{0}",n);Utils.SetInnerText(i,r)}function s(n,t){var i=n-f;Diag.ULS.sendTraceTag(21771080,g_msoulscat_Wac_WebAppsPortal,Diag.ULSTraceLevel.info,"File of size {0} hit {1} state in {2} ms",r,t,i)}function tt(n,t){var i=JSON.parse(n),u=i.NewDocumentUrl,r=i.StatusCode;r===201?(Diag.ULS.sendTraceTag(21771081,g_msoulscat_Wac_WebAppsPortal,Diag.ULSTraceLevel.info,"File uploaded successfully to {0}",g_appName),s((new Date).getTime(),"success"),window.location.assign(u)):h(r,t,"UploadLocalToHost handler failure")}function h(n,r,u){s((new Date).getTime(),"failure");Diag.ULS.sendTraceTag(21771082,g_msoulscat_Wac_WebAppsPortal,Diag.ULSTraceLevel.warning,"Failed to upload local file. {0}",{operation:u,statusCode:n});k();t(g_strUploadSorryError);var f=g_strUploadErrorTryAgain.replace("{0}",r);i(f);o(r)}var f,r;n.AddUploadEntryPoint=c;n.RemoveUploadEntryPoint=l;n.OpenFilePicker=a;n.UploadFileToHost=v;n.RemoveResetUploadBand=d}(UploadHandler||(UploadHandler={})),function(n){function i(){var n={AssetId:"blank",Title:g_strBlankDocName,Thumbnails:[]};t(n,!0,!1);Utils.MakeGetXhr(g_urlTemplates,r,f)}function r(n){var r=document.getElementById("b_templateslist"),i;for(r.className=r.className.replace(/loading/,""),i=0;i<n.length;i++)t(n[i])}function t(n,t,i){var s,h,r,f,e,o;t===void 0&&(t=!1);i===void 0&&(i=!0);s=document.createElement("li");s.className="templatewrapper";h=document.getElementById("b_templateslist");r=document.createElement("a");r.className="template";r.onclick=function(n){return function(){var t,i;return typeof g_instantCreateNewIsEnabled!="undefined"&&g_instantCreateNewIsEnabled&&typeof g_instantCreateNewPath!="undefined"&&g_instantCreateNewPath&&(i=g_instantCreateNewPath+"&wdtpl="+encodeURIComponent(n)),t=g_urlCreateNew+"&tpl="+encodeURIComponent(n),t=PlacesHandler.UpdateHostInCreateNewUploadUrl(t),CreateNewDocument(t,i),!1}}(n.AssetId);r.href="#";r.id="template_"+n.AssetId;r.title=i?g_strTemplateTooltip.replace("{0}",n.Title):n.Title;e=u(n);e?(f=document.createElement("img"),f.className="templateimg",f.src=e.Url,f.style.width=e.Width+"px",f.style.height=e.Height+"px",e.Width>155&&(h.className="landscapesupport")):(f=document.createElement("div"),f.className="templateblank");f.setAttribute("role","presentation");o=document.createElement("div");o.className="templatecaption uifont";e&&(o.style.width=e.Width+"px");Utils.SetInnerText(o,n.Title);r.appendChild(f);r.appendChild(o);s.appendChild(r);h.appendChild(s);t&&r.focus()}function u(n){for(var t=0;t<n.Thumbnails.length;t++)if(n.Thumbnails[t].ImageType=="MT")return n.Thumbnails[t];return null}function f(n){Diag.ULS.sendTraceTag(21771083,g_msoulscat_Wac_WebAppsPortal,Diag.ULSTraceLevel.info,"Failed to fetch templates.  Status code: {0}",n);var t=document.getElementById("b_templateslist");t.className=t.className.replace(/loading/,"")}n.FetchTemplates=i}(TemplatesHandler||(TemplatesHandler={})),function(n){function c(){g_fCheckTenantSettings?Utils.MakeGetXhr(g_urlTenantSettings,a,h):(i={Allow3rdParties:g_fTenantSettingsDefault},r=!0);var n=g_roamingServiceUrl.replace("{ACTION}","getAppPageSettings");Utils.MakeGetXhr(n,l,s)}function l(n){if(n==null){s(200);return}t=n;f=!0;u()}function s(n){Diag.ULS.sendTraceTag(21771084,g_msoulscat_Wac_WebAppsPortal,Diag.ULSTraceLevel.info,"Failed to fetch settings.  Status code: {0}",n);t=null;f=!0;u()}function a(n){if(n==null){h(200);return}i=n;r=!0;u()}function h(n){Diag.ULS.sendTraceTag(21771085,g_msoulscat_Wac_WebAppsPortal,Diag.ULSTraceLevel.info,"Failed to fetch tenant settings.  Status code: {0}",n);i={Allow3rdParties:g_fTenantSettingsDefault};r=!0;u()}function u(){if(r&&f){if(!t||!i){PlacesHandler.OnSettingsFailed();WhatsNewHandler.OnSettingsFailed();return}i.Allow3rdParties||(t.places=t.places.filter(function(n){return!n.is3rdParty}));PlacesHandler.OnSettingsFetched(t.places);WhatsNewHandler.OnSettingsFetched(t.whatsNew,i.Allow3rdParties)}}function v(n){Diag.ULS.sendTraceTag(21771086,g_msoulscat_Wac_WebAppsPortal,Diag.ULSTraceLevel.info,"Saving added places: {0}",{value:n});var t=g_roamingServiceUrl.replace("{ACTION}","savePlaces");Utils.MakePostXhr(t,n,e,function(n){o(n,"SavePlaces")})}function y(n){Diag.ULS.sendTraceTag(21771087,g_msoulscat_Wac_WebAppsPortal,Diag.ULSTraceLevel.info,"Saving 'New In' target location: {0}",{value:n});var t=g_roamingServiceUrl.replace("{ACTION}","saveNewInTargetLocation");Utils.MakePostXhr(t,n,e,function(n){o(n,"SaveNewInTargetStorageLocation")})}function p(n){Diag.ULS.sendTraceTag(21771088,g_msoulscat_Wac_WebAppsPortal,Diag.ULSTraceLevel.info,"Saving what's new version: {0}",{value:n});var t=g_roamingServiceUrl.replace("{ACTION}","saveWhatsNew");Utils.MakePostXhr(t,n,e,function(n){o(n,"SaveWhatsNew")})}function e(){}function o(n,t){Diag.ULS.sendTraceTag(21771089,g_msoulscat_Wac_WebAppsPortal,Diag.ULSTraceLevel.info,"Failed to save. {0}",{operation:t,statusCode:n})}var f,r,t,i;n.FetchSettings=c;n.SaveStorageLocationSelection=v;n.SaveNewInTargetStorageLocationSelection=y;n.SaveWhatsNewVersion=p}(SettingsHandler||(SettingsHandler={})),function(n){function v(n){o(n)}function y(){var t=document.getElementById("b_opencontainer"),n;t.style.display="none";n={name:"onedrive",value:1,isAdded:!0,isSelectedAsNewInTarget:!0,is3rdParty:!1};o([n])}function o(n){var s,r,o,h,c,l,a,v;for(t={},s=0;s<n.length;s++)r=n[s],o={name:r.name,value:r.value,isAdded:r.isAdded,isSelectedAsNewInTarget:r.isSelectedAsNewInTarget,is3rdParty:r.is3rdParty,label:g_placeLabels[r.name],openURL:g_placeUrls[r.name],scriptLibrary:g_placeScriptInfos[r.name],whiteIconUrl:g_placeWhiteIcons[r.name],colorIconUrl:g_placeColorIcons[r.name],createNewHostName:g_createNewHostNames[r.name]},t[r.name]=o,p(o),o.isSelectedAsNewInTarget&&r.isAdded&&(i=o.name);h=document.getElementById("b_opencontainer");h.className=h.className.replace(/loading/,"");c=document.getElementById("places");l=document.getElementById("addPlaces");l.onclick=function(){$(c).toggle(300)};a=document.getElementById("newinplace");a.onclick=function(){ft()};v=document.getElementById("placesoverlay");v.onclick=function(){f()};e=document.getElementById("b_dialogpanel").style.zIndex;(i==undefined||i=="")&&(i="onedrive");u()}function p(n){var i=document.getElementById("places"),t;b(n,i);it(n);t=document.getElementById("newindropdown");w(n,t);n.isAdded&&s(n.name,!0);n.isSelectedAsNewInTarget&&r(n.name,!0)}function w(n,t){var i=document.createElement("a"),u;i.href="#";i.onclick=function(n){return function(){return r(n),!1}}(n.name);i.title=g_strNewInTooltip.replace("{0}",n.label);Utils.SetInnerText(i,n.label);Utils.SetBackgroundImage(i,n.colorIconUrl);i.setAttribute("role","menuitem");u=document.createElement("li");u.id="newin_"+n.name;u.className="newinitem";u.appendChild(i);t.appendChild(u)}function b(n,t){var f=n.name==="onedrive",i=document.createElement("a"),r,u;i.className="openitem";f?i.setAttribute("aria-disabled","true"):(i.onclick=function(n){return function(){return h(n),!1}}(n.name),i.href="#");i.id="place_"+n.name;i.title=n.label;i.setAttribute("role","menuitemcheckbox");r=document.createElement("img");r.className="openicon";r.src=n.whiteIconUrl;r.setAttribute("role","presentation");u=document.createElement("span");u.className="openitemlabel";Utils.SetInnerText(u,n.label);i.appendChild(r);i.appendChild(u);t.appendChild(i)}function k(n){var i=t[n];return i==undefined?!1:i.isAdded}function s(n,t){var i,f,e;t===void 0&&(t=!1);i=document.getElementById("place_"+n);Utils.AddClass(i,"added");i.setAttribute("aria-checked","true");f=document.getElementById("openfrom_"+n);f.style.display="block";e=document.getElementById("newin_"+n);e.style.display="block";t||r(n);u();g(n)}function d(n){var t=document.getElementById("place_"+n),f,e;Utils.RemoveClass(t,"added");t.setAttribute("aria-checked","false");f=document.getElementById("openfrom_"+n);f.style.display="none";e=document.getElementById("newin_"+n);e.style.display="none";i===n&&r("onedrive");u()}function h(n){var i=t[n],r;i!=undefined&&(r=!i.isAdded,t[n].isAdded=!i.isAdded,r?s(n):d(n),SettingsHandler.SaveStorageLocationSelection(nt()),u())}function g(n){var f=t[n],i=f.scriptLibrary,r,u;if(i){if(i.IsLocal||!i.Id){Diag.ULS.sendTraceTag(21771090,g_msoulscat_Wac_WebAppsPortal,Diag.ULSTraceLevel.error,"Script file definition for {0} is incorrect; can't add place.",n);return}if(r=document.createElement("script"),r.id=i.Id,r.defer=i.Defer,r.src=i.FileName,i.DataAttributes)for(u in i.DataAttributes)i.DataAttributes.hasOwnProperty(u)&&r.setAttribute("data-"+i.DataAttributes[u].Key,i.DataAttributes[u].Value);document.body.appendChild(r)}}function nt(){var i=0,r,n;for(r in t)n=t[r],n.isAdded&&(i|=n.value);return i}function tt(){WhatsNewHandler.DismissWhatsNew();k("dropbox")?r("dropbox"):$("#places").delay(300).toggle(500).delay(500).queue(function(){h("dropbox");$(this).dequeue()}).delay(1e3).toggle(500)}function it(n){var t=document.createElement("a"),u,i,r,f;t.className="openitem";t.href="#";n.openURL!=undefined?t.href=n.openURL:t.onclick=function(n){return function(){return rt(n),!1}}(n.name);t.id="openfrom_"+n.name;u=g_strOpenFromPattern.replace("{0}",n.label);t.title=u;i=document.createElement("img");i.className="openicon";i.src=n.whiteIconUrl;i.setAttribute("role","presentation");r=document.createElement("span");r.className="openitemlabel";Utils.SetInnerText(r,u);t.appendChild(i);t.appendChild(r);f=document.getElementById("openfromcontainer");f.appendChild(t)}function rt(n){switch(n){case"dropbox":c(0)}}function c(n){if(typeof Dropbox=="undefined"){n<10?window.setTimeout(function(){c(++n)},500):Diag.ULS.sendTraceTag(21771091,g_msoulscat_Wac_WebAppsPortal,Diag.ULSTraceLevel.error,"Dropbox script library still didn't load 5 seconds after user clicked Open.");return}var t={success:function(n){ut(n[0].link)},cancel:function(){},linkType:"preview",multiselect:!1,extensions:g_supportedFileExtensions};Dropbox.choose(t)}function ut(n){var t=g_dropboxEditRedirectionUrl.replace("{0}",encodeURIComponent(n));g_sid&&(t+="&wdPreviousSession="+encodeURIComponent(g_sid));g_cid&&(t+="&wdPreviousCorrelation="+encodeURIComponent(g_cid));window.location.assign(t)}function u(){var n=document.getElementById("newinplace");l()>1?(Utils.AddClass(n,"clickable"),n.setAttribute("role","button"),n.setAttribute("aria-haspopup","true"),n.href="#"):(Utils.RemoveClass(n,"clickable"),n.hasAttribute("href")&&n.attributes.removeNamedItem("href"))}function l(){var n=0,i,r;for(i in t)r=t[i],r.isAdded&&n++;return n}function ft(){var n=document.getElementById("newindropdown");return n.style.display=="block"?f():l()>1&&et(),!1}function r(n,r){var u,e;r===void 0&&(r=!1);u=document.getElementById("newinhostname");Utils.SetInnerText(u,t[n].label);e=t[n];Utils.SetBackgroundImage(u,e.colorIconUrl);t[n].name==="onedrive"?UploadHandler.AddUploadEntryPoint():UploadHandler.RemoveUploadEntryPoint();i=n;r||(SettingsHandler.SaveNewInTargetStorageLocationSelection(t[n].value),f())}function et(){var t=document.getElementById("newindropdown"),i,r,n,u;t.style.display="block";i=document.getElementById("placesoverlay");i.style.display="block";r=document.getElementById("b_dialogpanel");r.style.zIndex="auto";n=document.getElementById("newinplace");u=Math.round(n.getBoundingClientRect().width)-2;t.style.width=u.toString()+"px";Utils.AddClass(n,"opened")}function f(){var r=document.getElementById("newindropdown"),n,t,i;r.style.display="none";n=document.getElementById("placesoverlay");n.style.display="none";t=document.getElementById("b_dialogpanel");t.style.zIndex=e;i=document.getElementById("newinplace");Utils.RemoveClass(i,"opened")}function ot(n){var t=a();return n.replace("{HOST}",encodeURIComponent(t))}function a(){var r=g_strDefaultCreateNewHostname,n;return typeof t!="undefined"&&(n=t[i],n.createNewHostName&&(r=n.createNewHostName)),r}var t,e,i;n.OnSettingsFetched=v;n.OnSettingsFailed=y;n.ForceEnableDropbox=tt;n.UpdateHostInCreateNewUploadUrl=ot;n.GetHost=a}(PlacesHandler||(PlacesHandler={})),function(n){function f(n,i){if(g_fWhatsNewForced&&g_nWhatsNewVersion>0){t();return}(!g_fWhatsNewDependsOnAddPlaces||i)&&g_nWhatsNewVersion>n.version&&t()}function e(){}function t(){$("#wn_overlay").show();$("#wn_panel").show();$("#b_dismissWhatsNew").focus();$(document).keydown(r);$(document).keyup(u)}function i(){$("template_blank").focus();$("#wn_overlay").hide();$("#wn_panel").hide();$(document).unbind("keydown",r);$(document).unbind("keyup",u);SettingsHandler.SaveWhatsNewVersion(g_nWhatsNewVersion)}function o(){window.open("https://sway.com")}function s(){window.open(g_learningToolsLearnMoreUrl)}function r(n){if(n.which==9){var t=g_strWhatsNewFirstButtonId?g_strWhatsNewFirstButtonId:"b_dismissWhatsNew";TabLoop(n,t,"b_dismissWhatsNew")}}function u(n){n.which==27&&i()}n.OnSettingsFetched=f;n.OnSettingsFailed=e;n.DismissWhatsNew=i;n.SwayLearnMore=o;n.LearningToolsLearnMore=s}(WhatsNewHandler||(WhatsNewHandler={}));