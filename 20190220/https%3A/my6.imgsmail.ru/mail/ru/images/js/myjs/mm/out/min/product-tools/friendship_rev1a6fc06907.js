define(["jquery","client-server","counters","factory"],function(a,b,c,d){var e="addfriend",f={progress:"progress",done:"done",error:"error"},g={added_users:!0,already_friends_users:!0,already_request_sent_users:!0,request_sent_users:!0,ratelimited_emails:!1,invalid_emails:!1,banned_users:!1,blacklist_emails:!1},h={};return{create:function(){return{onLoad:function(a){h=JSON.parse(a.html())},onUnload:function(){h={}}}},checkConfig:function(){var b=a(".b-friendship-options");h=JSON.parse(b.html())},onBrowserEvent:function(b){var c,d,g=a(b.target),i=g.attr("type");return this.checkConfig(),"click"===b.type&&i===e&&(g.hasClass(f.progress)||g.hasClass(f.done)||(d=g.attr("data-email"),d&&(g.addClass(f.progress),c=this.add(d),c.done(function(a){g.removeClass(f.progress).toggleClass(f.done,"reset_to_initial"!==a),g.html(h.doneMessages[a]||h.done)}).fail(function(a,b){g.removeClass(f.progress).addClass(f.error),g.html(h.errorMessages[a]||h.error)})))),c},add:function(b){var e=a.Deferred();return this.checkConfig(),c.mygrst("monitoring.friendship.add.adding"),d("models/user/user",function(a){var d=new a({email:b});d.friendship().then(function(a){var b=a[0];g[b]?(c.mygrst("monitoring.friendship.add.added"),e.resolve(b,h.doneMessages[b]||h.done)):e.reject(b,h.errorMessages[b]||h.error)},function(a){a&&"VerifyAccount"===a[1]?e.resolve("reset_to_initial",h.done):(c.mygrst("monitoring.friendship.add.xhrerror"),e.reject("",h.error))})}),e.promise()}}});