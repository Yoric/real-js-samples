$(function(){});var sa=sa||{};sa.bid="cpfSale";sa.openAPI=true;sa.cpfdfptoken="";var version;var receiveParamObj=receiveParamObj||{};var coupon2=coupon2||{};var isReceiving=false;coupon2.receive=(function(e){var c=function(l,n,i,m,k,j,g,h){ensureLogin(function(){receiveParamObj.actId=l;receiveParamObj.voucherId=n;var o="//yzdh.suning.com/yzdh-web/voucher/sendVoucher.do";var p=encodeURIComponent(bd.rst());if(isReceiving){return}isReceiving=true;var q={voucherId:n,couponGetSource:"1001",detect:p,sliderToken:i,smsCode:m,vcsCode:k,uuid:"",callback:"callbackSendVoucherFun"};e.ajax({url:o,type:"get",dataType:"jsonp",data:q,timeout:5000,success:function(r){isReceiving=false;a(r,j,g)},error:function(r){isReceiving=false;f()}})})};var a=function(g,i,h){if(g.resultCode=="0"){d("兑换成功","小狮子恭喜你，获得一张优惠券哦～");h.hide().siblings().show()}else{if(g.resultCode=="VOUCHER_1002"){d("兑换失败","云钻余额不足啦，先去赚云钻吧～")}else{if(g.resultCode=="VOUCHER_1003"||g.resultCode=="VOUCHER_1011"){d("兑换失败","唉，手太慢，今天已兑完了～")}else{if(g.resultCode=="VOUCHER_1005"){d("兑换失败","已经兑换过啦，快去使用吧～");h.hide().siblings().show()}else{if(g.resultCode=="VOUCHER_1006"||g.resultCode=="VOUCHER_1016"){d("兑换失败","券还不能兑换哦，看看其它好券吧～")}else{if(g.resultCode=="VOUCHER_1008"||g.resultCode=="VOUCHER_1010"){d("兑换失败","别心急，活动还未开始哦～")}else{if(g.resultCode=="VOUCHER_1009"){d("兑换失败","来迟啦，活动已结束了～")}else{if(g.resultCode=="VOUCHER_1012"){coupon2.sillerCode.sillerAlertBox(g,i,h)}else{if(g.resultCode=="VOUCHER_1013"||g.resultCode=="VOUCHER_1014"){d("兑换失败","账户不符合要求！")}else{if(g.resultCode=="VOUCHER_1015"){d("兑换失败","别贪心哦，已经兑换过同类型的券啦～");h.hide().siblings().show()}else{if(g.resultCode=="VOUCHER_1017"||g.resultCode=="VOUCHER_1023"){d("兑换失败","为了你的账户安全，建议绑定手机呢～")}else{if(g.resultCode=="VOUCHER_1018"){d("兑换失败","为了你的账户安全，建议认证账户呢～")}else{if(g.resultCode=="VOUCHER_1019"){d("兑换失败","账户不符合要求，想哭～")}else{if(g.resultCode=="VOUCHER_1020"){d("兑换失败","唉，手太慢，券已兑完了");h.hide().siblings(".state").html("已抢光").show()}else{if(g.resultCode=="VOUCHER_1021"){coupon2.sms.smsAlertBox(g,i,h)}else{if(g.resultCode=="VOUCHER_1022"){coupon2.imageCode.imageAlertBox(g,i,h)}else{if(g.resultCode=="VOUCHER_1023"){d("兑换失败","唉，手太慢，券已兑完了");h.hide().siblings(".state").html("已抢光").show()}else{if(g.resultCode=="VOUCHER_1024"){d("兑换失败","验证失败")}else{if(g.resultCode=="VOUCHER_1025"){d("兑换失败","错误次数过多，请重新获取！")}else{if(g.resultCode=="VOUCHER_1026"){d("兑换失败","校验失败了，不要放弃哦～")}else{if(g.resultCode=="VOUCHER_1027"){d("兑换失败","请刷新页面后再试！")}else{if(g.resultCode=="VOUCHER_9999"){d("兑换失败","小狮子正在奔跑中，稍后再试吧～")}}}}}}}}}}}}}}}}}}}}}coupon2.analytics.sendSAErrorMessage("coupon_receive_api_pc",g.resultCode+"&&1&&"+g.resultMsg+"&&")}if("1"==g.dfpTokenFlag){coupon2.init.dfpTokenInit()}};var f=function(){d("兑换失败","请重试!!!")};var b=function(j,h,i,g){ensureLogin(function(){receiveParamObj.actId=j;var k="//m.suning.com/ticket/private/checkTicket.do";if(isReceiving){return}isReceiving=true;var m=e("#dfptoken").val();var n=bd.ptoken();var l={activityCode:j,terminalType:"PC",egoToken:"",token:n};e.ajax({url:k,dataType:"jsonp",type:"get",data:l,timeout:5000,jsonpCallback:"checkTicket",success:function(o){isReceiving=false;if(o.data.responseCode=="0000"){d("领券成功！","您可以使用已领到的优惠券啦");g.hide().siblings().show()}else{d("领券失败！",o.data.responseMsg)}},error:function(o){isReceiving=false;d("领券失败","小苏太忙，请稍后再试（E0000）");coupon2.analytics.sendSAErrorMessage("couponCenter_lqmx_pc","&&"+j+"&&小苏太忙，请稍后再试（E0000）&&"+getCookie("custno"))}})})};var d=function(i,h){var g='<div class="coupon-use">  <div class="quanUse-error">    <div class="bindCoupon-box quanUseDilog">      <div class="bindCoupon-title">        <a href="javascript:void(0)" class="close" title="&#x5173;&#x95ED;"></a>        <strong>'+i+'</strong>      </div>      <div class="bindCoupon-content-success">        <p><span></span><em id="alertMsg">'+h+'</em></p>        <div class="bindCoupon-success-btn">          <a href="javascript:void(0)" class="close">关闭</a>        </div>      </div>    </div>  </div></div>';e.mDialog({css:{width:"448px",height:"250px"},title:"",message:g,fadeIn:300,fadeOut:0,callback:function(){e(".m-dialog .title, .m-dialog .btn").remove()}})};return{receiveCloudCoupon:c,receiveFinancialCoupon:b,resultAlert:d}})(jQuery);coupon2.imageCode=(function(f){var d="";var c="";var a=function(i,l,j){d=i.uuid;c=i.sceneId;var k="//vcs.suning.com/vcs/imageCode.htm?uuid="+d+"&yys="+new Date().getTime()+"&sceneId="+c;f("#imgCode").attr("src",k);f("#imageCodeDiv").show();f("#sillerCodeDiv").hide();f("#inputCode").removeClass("error-input");f("#inputCode").val("");f("#tipCode").removeClass("tip-icon tip-ok-16 tip-ok l");f("#tipCode").hide();f(".siller-confirm").off("click").on("click",function(){coupon2.imageCode.validateCode(1,l)});f("#failMsg").html(i.resultMsg);f(".dialog-siller,.dialog-siller-fiexd").show()};var e=function(i,l,j){var k=f("#inputCode").val();k=k.replace(/\s+/g,"");if(k==""||k==undefined){f("#tipCode").hide();f("#inputCode").addClass("error-input");f("#inputCode").val("");f("#inputCode").attr("placeholder","请输入正确的验证码");coupon2.imageCode.changeCode();return}var m="code="+k+"&uuid="+d+"&delFlag=0";f.ajax({type:"get",url:"//vcs.suning.com/vcs/validate_jsonp.htm",data:m,dataType:"jsonp",success:function(n){if(n[0].result=="true"){f("#tipCode").addClass("tip-icon tip-ok-16 tip-ok l");f("#tipCode").show();f("#inputCode").removeClass("error-input");if(i=="1"){f(".checkout").removeClass("checkout-loading");f(".checkout").trigger("click");coupon2.init.closeValidateAlert();if(l==1){coupon2.receive.receiveCloudCoupon(receiveParamObj.actId,receiveParamObj.voucherId,"","",e,l,j)}else{if(l==2){coupon2.receive.receiveFinancialCoupon(receiveParamObj.actId,receiveParamObj.actKey,l,j)}}}}else{f("#tipCode").hide();f("#inputCode").addClass("error-input");f("#inputCode").val("");f("#inputCode").attr("placeholder","请输入正确的验证码");coupon2.imageCode.changeCode()}}})};var b=function(){var i="//vcs.suning.com/vcs/imageCode.htm?uuid="+d+"&yys="+new Date().getTime()+"&sceneId="+c;f("#imgCode").attr("src",i)};var h=function(){var j=f("#inputCode").val();j=j.replace(/\s+/g,"");var i=j.length;if(i>=4){coupon2.imageCode.validateCode(0)}};var g=function(){f("#inputCode").removeClass("error-input");f("#inputCode").attr("placeholder","以下字符不区分大小写")};return{imageAlertBox:a,changeCode:b,keyupFunc:h,focusFunc:g,validateCode:e}})(jQuery);coupon2.sillerCode=(function(d){var a=function(e,g,f){siller.reset();d("#imageCodeDiv").hide();d("#sillerCodeDiv").show();d(".siller-confirm").off("click").on("click",function(){coupon2.sillerCode.receiveCouponAgain(g,f)});d("#failMsg").html(e.resultMsg);d(".dialog-siller,.dialog-siller-fiexd").show()};var b=function(){siller.init({tip1:"滑动完成",backWidth:"300px",backHeight:"36px",slWidth:"36px",slHeight:"36px",fontSize:"12px",target:"sillerCodeDiv",url:"//dt.suning.com/detect/dt/dragDetect.json"});d("#sillerCodeDiv").find("div").css({height:"42px"});siller.show()};var c=function(h,e){if(siller.status==1){coupon2.init.closeValidateAlert();var g=siller.queryToken();var f={actId:receiveParamObj.actId,actKey:receiveParamObj.actKey,cityId:receiveParamObj.cityId,validateCode:siller.queryToken(),sourceId:receiveParamObj.sourceId};if(h==0){coupon2.receive.receiveCouponAjax(f,receiveParamObj.callback,true,h)}else{if(h==1){coupon2.receive.receiveCloudCoupon(receiveParamObj.actId,receiveParamObj.voucherId,g,"","",h,e)}else{if(h==2){coupon2.receive.receiveFinancialCoupon(receiveParamObj.actId,receiveParamObj.actKey,h,e)}}}}};return{sillerAlertBox:a,receiveCouponAgain:c,initSillerCode:b}})(jQuery);coupon2.sms=(function(e){var d=function(g){e(".again i").text(g);if(g>=0){setTimeout(function(){coupon2.sms.count(--g)},1000)}else{e(".get-sms").show();e(".again").hide()}};var c=function(){var g="//quan.suning.com/sms/getSmsCode.do?callback=?";ajaxCrossDomain(g,"",function(h){b(h)},function(){a()},coupon2.common.passport_config)};var b=function(g){if("1001"==g.errcode){e(".get-sms").hide();e(".again").show();coupon2.sms.count(60);e(".error span").hide()}else{if(g.errcode=="1001"){e(".get-sms").hide();e(".has-none").show();e(".error span").hide()}else{if(g.errcode=="1104"||g.errcode=="1106"){e(".error span").text("验证码发送失败，请重新获取");e(".error span").show()}else{if(g.errcode=="1002"){e(".error span").text("您的操作过于频繁，请1分钟后再试");e(".error span").show()}}}}};var a=function(){};var f=function(g,j,h){var i='<div class="sms"> <div class="sms-content"> <div class="sms-title"> <a href="javascript:void(0)" class="close" title="&#x5173;&#x95ED;"></a> <strong>活动过于火爆，请进行短信安全验证</strong></div> <div class="sms-con"> <p id="smsPhoneNo">'+g.phoneNo+'</p> <div class="sms-input"> <input type="text" placeholder="&#x8BF7;&#x8F93;&#x5165;&#x9A8C;&#x8BC1;&#x7801;"> <a class="get-sms" href="javascript:void(0)">获取验证码</a> <a style="display: none;" class="again" href="javascript:void(0)">重新获取(<i>60</i>)</a> <a style="display: none;" class="has-none" href="javascript:void(0)">今日次数用完</a> </div>     <p class="error">';if(g.resultCode=="2005"){i+="          <span>验证码错误</span>"}else{if(g.resultCode=="2006"){i+="          <span>验证码错误次数过多，请重新获取</span>"}else{i+='          <span style="display: none;">验证码错误</span>'}}i+='      </p>       <div class="sms-btn">      <a class="sms-submit" href="javascript:void(0)">确定</a>     <a class="close" href="javascript:void(0)">取消</a>  </div></div>';e.mDialog({css:{width:"448px",height:"250px"},title:"",message:i,fadeIn:300,fadeOut:0,callback:function(){e(".m-dialog .title, .m-dialog .btn").remove();e(".again,.has-none").hide();e(".get-sms").off("click").on("click",function(){c()});e(".sms-input input").off("focus").on("focus",function(){e(".error span").hide()});e(".sms-submit").off("click").on("click",function(){var l=e(".sms-input input").val();if(l==""){e(".error span").text("请输入验证码");e(".error span").show();return}e.unmDialog();var k={actId:receiveParamObj.actId,actKey:receiveParamObj.actKey,cityId:receiveParamObj.cityId,validateCode:l,sourceId:receiveParamObj.sourceId};if(j==0){coupon2.receive.receiveCouponAjax(k,receiveParamObj.callback,true,j)}else{if(j==1){coupon2.receive.receiveCloudCoupon(receiveParamObj.actId,receiveParamObj.voucherId,"",l,"",j,h)}else{if(j==2){coupon2.receive.receiveFinancialCoupon(receiveParamObj.actId,receiveParamObj.actKey,j,h)}}}})}})};return{smsAlertBox:f,count:d}})(jQuery);coupon2.common=(function(c){var a={base:"//quan.suning.com/",loginTheme:"b2c_pop"};var i=document.getElementsByTagName("script");var h=document.getElementsByTagName("link");var e=function(k,m){if(m){for(var l=0;l<i.length;l++){if(i[l][m?"src":"href"].indexOf(k)!=-1){return true}}return false}else{for(var l=0;l<h.length;l++){if(h[l][m?"src":"href"].indexOf(k)!=-1){return true}}return false}};var f=function(o){if(e(o,true)){return}var p=o;var n=document.getElementsByTagName("script");for(var k=0;k<n.length;k++){if(n[k].src==p){return}}var l=document.createElement("script");l.type="text/javascript";l.async=true;l.src=p;var m=n[0];m.parentNode.insertBefore(l,m)};var b=function(m,k){if(e(m,true)){k();return}var l=document.createElement("script");l.type="text/javascript",void 0!==k&&(l.readyState?l.onreadystatechange=function(){"loaded"!=l.readyState&&"complete"!=l.readyState||(l.onreadystatechange=null,k())}:l.onload=function(){k()}),l.src=m,document.body.appendChild(l)};var g=function(o){if(e(o,false)){return}var p=o;var n=document.getElementsByTagName("link");for(var k=0;k<n.length;k++){if(n[k].src==p){return}}var l=document.createElement("link");l.type="text/css";l.rel="stylesheet";l.async=true;l.href=p;var m=n[0];m.parentNode.insertBefore(l,m)};var d=function(k){var l=new RegExp("(^|&)"+k+"=([^&]*)(&|$)","i");var m=window.location.search.substr(1).match(l);if(m!=null){return decodeURI(m[2])}return""};var j=function(k,l){var o=window.location.href;o=o.substring(o.indexOf("//")+2);o=o.substring(0,o.indexOf("/"));if(o.indexOf(".")>0){o=o.substring(o.indexOf("."))}var m=o;var n="/";var p=k+"="+encodeURIComponent(l)+";domain="+m+";path="+n;document.cookie=p};return{isInclude:e,_loadAsyncJs:f,_loadScript:b,_loadAsyncCss:g,getUrlParam:d,setCookie:j,passport_config:a}})(jQuery);coupon2.analytics=(function(b){var a=function(h,d){var c=d.split("&&");var g={type_name:h,error_type:c[1],error_code:c[0],error_detail:c[2],member_id:c[3],member_level:"",region:"",bid:"cpfSale"};try{sa.openAPI.sendMsgV2(g);sa.openAPI.sendMessage(h,d)}catch(f){}};return{sendSAErrorMessage:a}})(jQuery);coupon2.init=(function(d){var c=function(){var f='<div class="m-lion-dialog-fiexd dialog-siller-fiexd" style="display: none;position:fixed;z-index:8002;top:0;left:0;right:0;bottom:0;background-color:#000;filter:alpha(opacity=30);opacity:0.3"></div><div class="m-lion-dialog dialog-siller" style="width: 448px; height: 260px; margin-left: -224px; margin-top: -130px; top: 50%; display: none;">  <div class="container">     <div class="title"><h3>领取优惠券</h3></div>    <a href="javascript:coupon2.init.closeValidateAlert();" class="btn close" title="关闭" style="z-index: 10;"></a>      <div class="content">          <div class="coupon-dialog has-get" style="padding: 52px 0;">               <p class="tips"><i class="tip-icon tip-info-24"></i><span id="failMsg"></span></p>             <div id="sillerCodeDiv" class="dt_parent float" style="margin:30px auto 50px;display: none;"></div>                <div class="dialog-common identify-code" id="imageCodeDiv" style="display: none;">                 <div class="code-input clearfix">                      <dl>                       <dt class="l">验证码</dt>                         <dd class="l">                             <p class="item-ide">                                   <input autocomplete="off" onkeyup="coupon2.imageCode.keyupFunc();" onfocus="coupon2.imageCode.focusFunc();" class="ui-text l" type="text" placeholder="以下字符不区分大小写" id="inputCode" >                                  <i id="tipCode" ></i>                              </p>                               <p class="item-ide">                                   <img onclick="coupon2.imageCode.changeCode();" id="imgCode" class="l" src="" />                                 <span class="change l">看不清楚？<a href="javascript:void(0);" onclick="coupon2.imageCode.changeCode();">换一张</a></span>                              </p>                           </dd>                      </dl>                  </div>             </div>             <div class="coupon-dialog-btn" style="margin-top: 20px;">                  <a href="javascript:coupon2.init.closeValidateAlert();" class="siller-close closeThis">关闭</a>                   <a href="javascript:;" class="siller-confirm">确定</a>               </div>         </div>     </div>  </div></div>';d("body").append(f)};var e=function(){d(".dialog-siller,.dialog-siller-fiexd").hide()};var b=function(){if(typeof(_dfp)!="undefined"){_dfp.init({appCode:"UfggrFD1MpeUazVs",env:"prd",success:function(f){sa.cpfdfptoken=f},error:function(f){}})}};var a=function(){if(typeof(bd)!="undefined"){bd.init({token:"other",system:"CPF",url:"//dt.suning.com/detect/dt/portoToken.json"})}};return{alertValidateHtml:c,closeValidateAlert:e,dfpTokenInit:b,detectInit:a}})(jQuery);$(function(){});