SVK.register("kit.extra.imgReady",function(a){var b=function(){var a=[],b=null,c=function(){var b=0;for(;b<a.length;b++)a[b].end?a.splice(b--,1):a[b]();!a.length&&d()},d=function(){clearInterval(b);b=null};return function(d,e,f,g){var h,i,j,k,l,m=new Image;m.src=d;if(m.complete){e(m.width,m.height);f&&f(m.width,m.height);return}i=m.width;j=m.height;h=function(){k=m.width;l=m.height;if(k!==i||l!==j||k*l>100){e(k,l);h.end=!0}};h();m.onerror=function(){g&&g();h.end=!0;m=m.onload=m.onerror=null};m.onload=function(){f&&f(m.width,m.height);!h.end&&h();m=m.onload=m.onerror=null};if(!h.end){a.push(h);b===null&&(b=setInterval(c,40))}}}();return b});
SVK.register("widget.focusSlide.video",function(a){var b=jQuery,c=function(a,c){var c=c||"node-type",d=b("["+c+"]",a),e={};e.wrap=a;d.each(function(a){var d=b(this);e[d.attr(c)]=d});return e},d=function(a){if(typeof a!="string")return a;var b=a.split("&"),c={},d,e,f;for(var g=0,h=b.length;g<h;g++)if(b[g]){d=b[g].split("=");f=d[0];e=d[1]||"";c[f]=e}return c},e=function(a,c){var d=this,e={aspectRatio:4/3,poster:"",prefix:"slider_video_",closeClz:"close",videoClz:"video"};d.wrap=b(a);d.config=b.extend(e,c);d.inited=!1;d.init()};e.prototype={init:function(){var a=this;if(a.inited)return;var b=a.config,c=(new Date).getTime(),d=b.prefix,e=d+c,f=d+"wrap_"+c;a.setDom(f);var g=a.dom.video.width(),h={url:"",container:f,id:e,width:"100%",height:g/b.aspectRatio,params:{allowNetworking:"all",allowScriptAccess:"always",wmode:"opaque",allowFullScreen:"true",quality:"high"},attributes:{},flashvars:{autoPlay:1,loop:0,autoLoad:1,thumbUrl:b.poster,tj:1,as:1},h5attr:{autoPlay:!1,controls:!0,loop:!1,poster:b.poster,preload:"auto"}};if(!window.playVideo)throw new Error("缺少视频组件:http://sjs0.sinajs.cn/video/sinaplayer/js/page/player.js");a.player=playVideo(h);a.bind();a.inited=!0},setDom:function(a){var b=this,d=b.config,e=d.prefix.replace(/_/g,"-");b.wrap.css({visibility:"hidden"});b.wrap.html('<div id="'+a+'" '+e+'type="video" class="'+d.videoClz+'"></div><a title="关闭" '+e+'type="close" class="'+d.closeClz+'" href="javascript:;">关闭</a>');b.dom=c(b.wrap,e+"type")},bind:function(){var a=this;a.dom.close.on("click",function(){a.hideAndPause()})},pause:function(){this.player.pause()},play:function(a){a=d(a);this.player.playVideo(a)},hideAndPause:function(){this.wrap.css({visibility:"hidden"});this.pause()},showAndPlay:function(a){this.wrap.css({visibility:"visible"});this.play(a)},resize:function(a,c){var d=this,e=b(d.player.player);e.width(a);e.height(c)}};return e});
SVK.register("widget.focusSlide.slider",function(a){var b=typeof window.ontouchstart!="undefined",c=function(a){this.config=$.extend({wrap:null,itemSelector:"li",sameSize:!0,startOn:0,scrollBy:1,speed:6,isVertical:!1,isLoop:!0,autoPlay:!0,autoInterval:3,absoluteAni:!1,easing:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},onReady:function(a){},onAniStart:function(a,b){},onAniEnd:function(a,b){},onEdge:function(a){}},a);this._initDoms();this._initStates();this._initEvents();this._launch()};c.prototype={_prefix:function(){function d(a){if(c==="")return a;a=a.charAt(0).toUpperCase()+a.substr(1);return c+a}var a;if(this.css3Key)return this.css3Key;var b=document.createElement("div").style,c=function(){var a="t,webkitT,MozT,msT,OT".split(","),c,d=0,e=a.length;for(;d<e;d++){c=a[d]+"ransform";if(c in b)return c=="msTransform"?!1:a[d].substr(0,a[d].length-1)}return!1}();a=c==""?"transitionend":c+"TransitionEnd";this.css3Key={support:typeof c=="boolean"?!1:!0,vendor:c,cssVendor:c?"-"+c.toLowerCase()+"-":"",transform:d("transform"),transition:d("transition"),transitionProperty:d("transitionProperty"),transitionDuration:d("transitionDuration"),transformOrigin:d("transformOrigin"),transitionTimingFunction:d("transitionTimingFunction"),transitionDelay:d("transitionDelay"),transitionEnd:a};return this.css3Key},_initDoms:function(a){var b=this,c=this.config,d=$(c.wrap),e=d.html(),f,g,h;if(!c.wrap||d.length===0)throw new Error("缺少wrap参数");c.isLoop?f='				<div style="'+(c.isVertical?"height":"width")+':999999px;zoom:1;">					<div style="float:left;">'+e+'</div>					<div style="float:left;">'+e+"</div>				</div>":f='<div style="'+(c.isVertical?"height":"width")+':999999px;zoom:1;">'+e+"</div>";d.html(f);g=d.children("div");g.css({position:"relative"});h=d.find(c.itemSelector);h.css({"float":c.isVertical?"none":"left"});this.doms={wrap:d,aniWrap:g,items:h,oldInnerHTML:e}},_initStates:function(a){var c=this,d=this.config,e=this.doms,f=e.items,g=this._prefix(),h,i,j,k,l,m,n,o,p,q,r;j=d.isVertical?"v":"h";l=d.isVertical?e.wrap.height():e.wrap.width();k=d.scrollDis?d.isLoop?Math.ceil(e.wrap[0].getElementsByTagName("div")[0].width()*2/d.scrollDis):Math.ceil(e.wrap[0].getElementsByTagName("div")[0].width())/d.scrollDis:f.length;m=d.speed/10;h=e.wrap.width()*d.scrollBy;n=d.isVertical?d.absoluteAni?"top":"marginTop":d.absoluteAni?"left":"marginLeft";g.vendor==""?q="transform "+m+"s ease-out":g.vendor!==!1&&(q="-"+g.vendor+"-transform "+m+"s ease-out");r=function(){var a=c.config,b=c.doms,d=c.states,e=c._prefix();a.onAniEnd&&a.onAniEnd.call(c);d.animating=!1;b.aniWrap[0].removeEventListener(e.transitionEnd,arguments.callee,!1)};this.states={curIndex:d.startOn,scrollType:j,wrapSize:l,total:k,scrollDis:h,duration:m,isTouchDev:b,cssProterty:n,to:null,now:0,fromPos:null,movedPos:null,animating:!1,transitionAni:q,onTransitionEnd:r}},_initEvents:function(a){var c=this,d=this.config,f=this.doms,g=this.states,h=f.wrap;h.on("mouseover",function(){if(d.autoPlay){clearInterval(c.autoTimerId);c.autoTimerId=null}});h.on("mouseout",function(){d.autoPlay&&c.autoSlide()});if(b){h.on("touchstart",function(a){e=a.originalEvent;c._touchstart(e)});h.on("touchmove",function(a){e=a.originalEvent;c._touchmove(e)});h.on("touchend",function(a){e=a.originalEvent;c._touchend(e)})}},_launch:function(){var a=this.config,b=this.doms,c=this.states;if(a.startOn){this._moveToEle(a.startOn);c.fromPos=-c.wrapSize*a.startOnPos}else if(a.startOnPos){this._moveByPx(a.startOnPos,!0);c.fromPos=-a.startOnPos}a.onReady&&a.onReady.call(this);a.autoPlay&&this.autoSlide();if(!a.isLoop){a.startOn=Math.max(a.startOn,0);a.startOn=Math.min(a.startOn,c.total-1);a.startOn===0&&a.onEdge&&a.onEdge.call(this,!0);a.startOn===c.total-1&&a.onEdge&&a.onEdge.call(this,!1)}},_touchstart:function(a){var b=this,c=this.config,d=this.doms,e=this.states,f=this._prefix();if(a.touches.length!==1)return;if(c.isLoop){e.curIndex==0&&(e.curIndex+=e.total/2);e.curIndex==e.total-1&&(e.curIndex-=e.total/2);d.aniWrap.css(f.transition,"all 0s ease-out");this._moveToEle(e.curIndex)}clearInterval(this.autoTimerId);this.autoTimerId=null;this.touchInitPos=a.touches[0].pageX;this.touchInitPosY=a.touches[0].pageY;this.deltaX1=this.touchInitPos;this.startPos=-e.curIndex*e.scrollDis;e.touched=!0},_touchmove:function(a){var b=this,c=this.config,d=this.doms,e=this.states,f=this._prefix(),g;if(a.touches.length!==1)return;var h=a.touches[0].pageX,i=a.touches[0].pageY,j=h-this.touchInitPos,k=i-this.touchInitPosY;(Math.abs(k)===0||Math.abs(j)/Math.abs(k)>=1)&&a.preventDefault();this.deltaX2=h-this.deltaX1;var g=this.startPos+j,l=g+"px,0",m=c.isVertical?"translate3d(0,"+g+"px,0)":"translate3d("+g+"px,0,0)";d.aniWrap.css(f.transform,"translate3d("+l+", 0)")},_touchend:function(a){var b=this,c=this.config,d=this.doms,e=this.states,f=this._prefix(),g;if(this.deltaX2<-30){this.next();this.deltaX2=0}else if(this.deltaX2>30){this.prev();this.deltaX2=0}else this._slideToCss3(e.curIndex);e.touched=!1},_moveToEle:function(a,b,c){var d=this,e=this.config,f=this.doms,g=this.states,h=g.curIndex,i=b?h+a:a,j=f.aniWrap,k=f.items,l=k[i],m=this._prefix(),n,o;a!==h&&e.onIndexChanged&&e.onIndexChanged.call(this,a);n=e.isVertical?-l.offsetTop:-l.offsetLeft;o=e.isVertical?"translate3d(0,"+n+"px,0)":"translate3d("+n+"px,0,0)";if(m.vendor!==!1){g.animating&&j[0].removeEventListener(m.transitionEnd,g.onTransitionEnd,!1);j.css(m.transition,"all 0s ease-out");j.css(m.transform,o);g.curIndex=i;setTimeout(function(){c&&c.call(d)},20)}else{j.css(g.cssProterty,n);g.curIndex=a;c&&c.call(this)}},_slideToCss3:function(a){var b=this,c=this.config,d=this.doms,e=this.states,f=d.items,g=d.aniWrap,h=this._prefix(),i,j;g.css(h.transition,e.transitionAni);i=c.isVertical?-f[a].offsetTop:-f[a].offsetLeft;j=c.isVertical?"translate3d(0,"+i+"px,0)":"translate3d("+i+"px,0,0)";g.css(h.transform,j);e.animating&&g[0].removeEventListener(h.transitionEnd,e.onTransitionEnd,!1);g.css(h.transform,j);g[0].addEventListener(h.transitionEnd,e.onTransitionEnd,!1);e.curIndex=a},_slideToTdt:function(a){var b=this,c=this.config,d=this.doms,e=this.states,f=d.aniWrap,g=e.cssProterty,h=e.duration*1e3,i=e.now,j=e.wrapSize,k;if(e.to===null||e.to==a)e.fromPos=-e.curIndex*j;else{e.fromPos=e.movedPos;e.now=0}if(h-i<20){f.css(g,-a*j+"px");f.css({cssProterty:-a*j+"px"});e.curIndex=a;clearTimeout(this.aniInterval);this.aniInterval=null;e.now=0;e.to=null;e.fromPos=-e.curIndex*j;e.movedPos=null;c.onAniEnd&&c.onAniEnd.call(this);e.animating=!1;return}k=c.easing(i,e.fromPos,-a*j-e.fromPos,h);f.css(g,k+"px");e.now+=20;e.movedPos=k;this.aniInterval=setTimeout(function(){b._slideToTdt(a)},20)},prev:function(){var a=this.config,b=this.doms,c=this.states,d=c.curIndex,e;if(a.isLoop&&d==0)this._moveToEle(c.total/2,!1,function(){e=c.curIndex-a.scrollBy;this.slideTo(e)});else{e=c.curIndex-a.scrollBy;this.slideTo(e)}},next:function(){var a=this.config,b=this.doms,c=this.states,d=c.curIndex,e;if(a.isLoop&&d==c.total-1)this._moveToEle(c.total/2-1,!1,function(){e=c.curIndex+a.scrollBy;this.slideTo(e)});else{e=c.curIndex+a.scrollBy;this.slideTo(e)}},slideByEle:function(a){var b=this.states.curIndex+a;this.slideTo(b)},slideTo:function(a){var c=this,d=this.config,e=this.doms,f=this.states,g=f.curIndex,h=f.total,i=this._prefix(),j,k;if(!d.isLoop){a===0&&d.onEdge&&d.onEdge.call(this,!0);a===f.total-1&&d.onEdge&&d.onEdge.call(this,!1);if(a<0||a>f.total-1){a=Math.max(a,0);a=Math.min(a,f.total-1);b&&this._slideToCss3(a);return}}j=a>h-1?a%h:a<0?h+a%h:a;if(j===g)return;d.onIndexChanged&&d.onIndexChanged.call(this,j);f.animating=!0;d.autoPlay&&this.autoSlide();d.onAniStart&&d.onAniStart.call(this);i.vendor!==!1?this._slideToCss3(j):this._slideToTdt(j)},autoSlide:function(){var a=this;if(this.autoTimerId){clearInterval(this.autoTimerId);this.autoTimerId=null}this.autoTimerId=setInterval(function(){a.next()},this.config.autoInterval*1e3)},disableAuto:function(){if(this.autoTimerId){clearInterval(this.autoTimerId);this.autoTimerId=null}},insertItem:function(a){},refresh:function(a){var b=this,a=this.config,c=this.doms,d=this.states,e=this._prefix(),f;f=a&&a.width?a.width:a.isVertical?c.wrap.height():c.wrap.width();d.scrollDis=f*a.scrollBy;d.animating&&d.onTransitionEnd();c.aniWrap.css(e.transition,"all 0s ease-out");this._moveToEle(d.curIndex)},destroy:function(){}};return c});
SVK.register("widget.focusSlide.index",function(a){var b=a.kit.extra.imgReady,c=a.widget.focusSlide.video,d=a.widget.focusSlide.slider,e=function(a,b){var b=b||"node-type",c=$("["+b+"]",a),d={};d.wrap=a;c.each(function(a){var c=$(this);d[c.attr(b)]=c});return d},f=function(a){var b,c;if(typeof a=="string"){c=a.split("/");c.length===2?b=c[0]/c[1]:b=parseFloat(a)}else b=parseFloat(a);isNaN(b)&&(b=4/3);return b},g=function(a,b){a=$(a);this.dom=e(a,"slide-type");this.config=$.extend({itemSelector:"[slide-type=item]",speed:6,isLoop:!0,autoPlay:!1,navEvent:"click",imgAspectRatio:4/3,videoAspectRatio:4/3,videoPrefix:"slider_video_",videoCloseClz:"icon_del",videoPlayerClz:"slide-video-player",imgMaxHeight:750},b);this.config.imgAspectRatio=f(this.config.imgAspectRatio);this.config.videoAspectRatio=f(this.config.videoAspectRatio);this.init()};g.prototype={init:function(){var a=this;a.sliderInit();a.videoInit();a.bind();a.resize()},sliderInit:function(){var a=this,b=a.config,c=b.isLoop,e=a.dom,f=function(a){var d=a.states.total;c&&(d/=2);var f=e.dotsWrap,g=[],h="cur";for(var i=0;i<d;i++)g.push('<a title="'+(i+1)+'" href="javascript:;" class="'+(i===0?h:"")+'"></a>');f.html(g.join(""));f.on(b.navEvent,"a",function(){var b=$(this);f.find("a."+h).removeClass(h);a.slideTo(b.index());b.addClass(h)})},g=function(a,b){var c="disable",d=a.find("i");a.data("title")||a.data("title",a.attr("title"));var e="";if(b){e=a.data("title");d.removeClass(c)}else d.addClass(c);a.attr("title",e)},h=function(a){e.prev.on("click",function(){a.prev()});e.next.on("click",function(){a.next()})},i=function(a){var b=e.dotsWrap,c=b.outerWidth();a.doms.items.find("[slide-type=txt]").css("margin-right",c)};a.slider=new d({wrap:e.imgWrap,itemSelector:b.itemSelector,speed:b.speed,isLoop:c,autoPlay:b.autoPlay,onReady:function(){var a=this.states.total;f(this);h(this);i(this);c&&(a/=2);if(a===1){g(e.next,!1);g(e.prev,!1)}},onIndexChanged:function(a){var b=this.states.total;c&&(b/=2);a>=b&&(a-=b);var d=e.dotsWrap.find("a");d.removeClass("cur");d.eq(a).addClass("cur");if(b!==1&&a!==0&&a!==b-1){g(e.next,!0);g(e.prev,!0)}},onEdge:function(a){var b=this.states.total;c&&(b/=2);if(b!==1)if(a){g(e.next,!0);g(e.prev,!1)}else{g(e.prev,!0);g(e.next,!1)}}})},videoInit:function(){var a=this,b=a.config;a.video=new c(a.dom.videoWrap,{aspectRatio:b.videoAspectRatio,prefix:b.videoPrefix,closeClz:b.videoCloseClz,videoClz:b.videoPlayerClz})},resize:function(){var a=this,c=a.config,d=a.dom,e=d.imgWrap,f=function(a,c,d){var e=function(a){var b=a.attr("slide-image-size"),c=b.split("_");return c.length===2?{width:c[0],height:c[1]}:null},f=function(a,b,c){a.attr("slide-image-size",b+"_"+c)},g=function(a,b,c){var d,f,g=e(a),h=g.width,i=g.height;if(b/c>h/i){f=c;d=c*h/i}else{d=b;f=b*i/h}d=Math.min(d,h);f=d*i/h;d<=h&&a.css({width:d,height:f})},h=a.find("img");h.each(function(){var a=$(this),h=e(a);h?g(a,c,d):b(a.attr("src"),function(b,e){f(a,b,e);g(a,c,d)})})},g=e.width(),h=g/c.imgAspectRatio;h=Math.min(h,c.imgMaxHeight);e.height(h);a.dom.videoWrap.height(h);e.find(c.itemSelector).css({width:g,lineHeight:h+"px"});a.slider.refresh();f(e,g,h);a.video&&a.video.resize(g,h)},bind:function(){var a=this;$(window).on("resize",function(){a.resize()});$("[slide-video-data]",a.dom.imgWrap).on("click",function(){a.video.showAndPlay($(this).attr("slide-video-data"));a.resize()})}};return g});
