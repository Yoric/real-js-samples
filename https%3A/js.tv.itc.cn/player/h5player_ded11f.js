/* sohutv 2019-02-18 10:32:34 */
!function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=33)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=[],a={logs:r,stringify:function(){var e="";return r.forEach(function(t){e+=t.level+" "+t.time+"\n",e+=t.content+"<br>"}),e}};["log","info","warn","error"].forEach(function(e){return a[e]=function(){for(var t=arguments.length,i=Array(t),a=0;a<t;a++)i[a]=arguments[a];var s=[],o="";i.forEach(function(e){o+="string"==typeof e||"number"==typeof e?e:JSON.stringify(e,function(e,t){if("player"!==e){if("object"===(void 0===t?"undefined":n(t))&&null!==t){if(-1!==s.indexOf(t))return;s.push(t)}return t}},2)}),r.push({level:"["+e+"]",time:function(e,t){"[object Date]"!={}.toString.call(e)&&(e=new Date(parseInt(e)));var i={"y+":e.getFullYear(),"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds()};for(var n in i)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,("00"+i[n]).substr(1+~RegExp.$1.length)));return t}(Date.now(),"yyyy-MM-dd hh:mm:ss"),content:o})}}),t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.addEventEmitter=function(e){return l(e,{__emitter:new u,on:function(){var e;(e=this.__emitter).on.apply(e,arguments)},off:function(){var e;(e=this.__emitter).off.apply(e,arguments)},one:function(){var e;(e=this.__emitter).one.apply(e,arguments)},emit:function(){var e;(e=this.__emitter).emit.apply(e,arguments)}}),e};var a=function(e){return function(t){return{}.toString.call(t)=="[object "+e+"]"}},s=a("Object"),o=a("Function"),l=function(e,t){if(t&&"object"==(void 0===t?"undefined":r(t)))for(var i in t)e[i]=t[i]},u=t.EventEmitter=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.__events={}}return n(e,[{key:"addEventListener",value:function(e,t,i){if(e&&t){this.__events[e]=this.__events[e]||[];var n,r=this.__events[e],a=!0,s=!1,o=void 0;try{for(var l,u=r[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){if(l.value.h==t){n=!0;break}}}catch(e){s=!0,o=e}finally{try{!a&&u.return&&u.return()}finally{if(s)throw o}}n||r.push({h:t,one:i})}}},{key:"removeEventListener",value:function(e,t){if(e||t)if(t)for(var i=this.__events[e]||[],n=0;n<i.length;)t===i[n].h?i.splice(n,1):n++;else delete this.__events[e];else this.__events={}}},{key:"emit",value:function(e,t){if(e)for(var i,n=this.__events[e]||[],r=0;r<n.length;){var a=n[r];i=a.h,o(i)?i.call(null,t,e):s(i)&&o(i.handleEvent)&&i.handleEvent.call(i,e,t),a.one?n.splice(r,1):r++}}},{key:"one",value:function(e,t){this.addEventListener(e,t,!0)}}]),e}();u.prototype.on=u.prototype.addEventListener,u.prototype.off=u.prototype.removeEventListener},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function r(e){for(var t=(e=e.toLowerCase().split("-"))[0],i=1,n=e.length;i<n;i++)t+=e[i].replace(/\b(\w)|\s+(\w)/g,function(e){return e.toUpperCase()});return t}function a(e,t){var i=r(t=t.toLowerCase()),n=null;return e.style[i]?n=e.style[i]:e.currentStyle?n=e.currentStyle[i]:document.defaultView&&document.defaultView.getComputedStyle&&(n=document.defaultView.getComputedStyle(e,null))&&(n=n.getPropertyValue(t)),n}var s=["webkit","moz","ms","o"],o={hide:function(e){e&&(e.style.display="none")},show:function(e,t){e&&(t=t||"block",e.style.display=t)},hasClass:function(e,t){return e.classList.contains(t)},addClass:function(e,t){this.hasClass(e,t)||e.classList.add(t)},removeClass:function(e,t){e.classList.remove(t)},css:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];if(!(t.length<=1))return 2==t.length&&"string"==typeof t[1]?a.apply(null,t):function(){if(!(arguments.length<=1)){var e=arguments[0],t=arguments[1],i={};if("object"===(void 0===t?"undefined":n(t)))for(var s in t)i[s]=a(e,s),e.style[r(s)]=t[s];else i[arguments[1]]=a(e,arguments[1]),e.style[r(arguments[1])]=arguments[2];return i}}.apply(null,t)},setCss3:function(e,t,i){var n,r=s.length;for(e.style[t]=i,n=0;n<r;n++)e.style[s[n]+t.substring(0,1).toUpperCase()+t.substring(1)]=i},width:function(){if(!(arguments.length<1)){var e=arguments.length<=0?void 0:arguments[0];if(1==arguments.length){if("none"!=this.css(e,"display"))return e.offsetWidth||parseInt(this.css(e,"width"));var t=this.css(e,{display:"",visibility:"hidden",position:"absolute"}),i=e.clientWidth||parseInt(this.css(e,"width"));return this.css(e,t),i}i=""+(arguments.length<=1?void 0:arguments[1]),/^\d+$/.test(i)&&(i+="px"),o.css(e,"width",i)}},height:function(){if(!(arguments.length<1)){var e=arguments.length<=0?void 0:arguments[0];if(1==arguments.length){if("none"!=this.css(e,"display"))return e.offsetHeight||parseInt(this.css(e,"height"));var t=this.css(e,{display:"",visibility:"hidden",position:"absolute"}),i=e.clientHeight||parseInt(this.css(e,"height"));return this.css(e,t),i}i=""+(arguments.length<=1?void 0:arguments[1]),/^\d+$/.test(i)&&(i+="px"),o.css(e,"height",i)}}};t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r={getQueryData:function(e){for(var t,i=(e=e.replace(/^\?+/,"").replace(/&amp;/,"&")).split("&"),n=0,r={};n<i.length;){if((t=i[n].split("="))[0]){var a=t[1]||"";try{a=decodeURIComponent(a)}catch(e){a=unescape(a)}a="null"===a?null:a,r[decodeURIComponent(t[0])]=a}n++}return r},getQueryString:function(e){var t,i=window.location.search.substring(1).replace(/[?&]sohuaction=(.*)/,"");return e in(t=r.getQueryData(i))?t[e]:null},getParam:function(e,t){var i,n;void 0===t?(n=window.location.href,i=new RegExp("(^|&?)"+e+"=([^&]*)(&|$)","i")):(n=e,i=new RegExp("(^|&?)"+t+"=([^&]*)(&|$)","i"));var r=n.match(i);return null!==r?decodeURIComponent(r[2]):null},stringify:function(e){if("object"!==(void 0===e?"undefined":n(e)))return"";var t,i,r=[];for(t in e){i=e[t];var a=Object.prototype.toString.call(i);"[object Array]"===a?r.push(t+"="+JSON.stringify(i)):"[object Object]"===a?r.push(t+"="+JSON.stringify(i)):r.push(t+"="+encodeURIComponent(void 0===i?"":i))}return r.join("&")}};t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e){return function(t){return{}.toString.call(t)=="[object "+e+"]"}},a=r("Object"),s=r("Function"),o=Array.isArray||r("Array"),l=r("String");t.default={extend:function e(t,i,r){if(r&&e(t,r),i&&"object"==(void 0===i?"undefined":n(i)))for(var a in i)t[a]=i[a];return t},applyIf:function(e,t){if(e)for(var i in t)void 0===e[i]&&(e[i]=t[i]);return e},isObject:a,isFunction:s,isArray:o,isString:l,createUUID:function(){for(var e="",t=0;t<8;t++)e+="0123456789abcdef".charAt(Math.round(15*Math.random()));for(t=0;t<3;t++){e+="-";for(var i=0;i<4;i++)e+="0123456789abcdef".charAt(Math.round(15*Math.random()))}for(e+="-",e+=("000000000"+Date.now().toString(16)).substr(-8),t=0;t<4;t++)e+="0123456789abcdef".charAt(Math.round(15*Math.random()));return e},createFUID:function(){var e=1e3+Math.pow(10,7),t=Math.random();t=t<.1?t+.1:t;var i=Math.floor(1e3+t*e);return(new Date).getTime().toString()+i.toString()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=o(i(42)),s=o(i(4));function o(e){return e&&e.__esModule?e:{default:e}}var l={h:{name:"helper",dir:"helper"}},u=/(^\s*)|(\s*$)/g,d="".trim?function(e){return e.trim()}:function(e){return(e||"").replace(u,"")},c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.content=t||"",this.helper=new a.default}return r(e,[{key:"setContent",value:function(e){this.fn=null,this.directive=null,this.content=e}},{key:"render",value:function(e){this.compile();var t,i,n=this.directive||{};for(var r in l){if(i=l[r],e[t=void 0===n[r]?i.name:n[r]])throw new Error("\u6307\u4ee4{ "+t+" }\u51b2\u7a81...");e[t]=this[i.dir]}var a=this.fn(e);for(r in l)i=l[r],delete e[t=void 0===n[r]?i.name:n[r]];return a}},{key:"compile",value:function(){if(!this.fn){this.directive={};var e=this,t="var p = [];with(obj){p.push('"+this.content.replace(/[\r\t\n]/g," ").replace(/<%@(.*?)%>/g,function(t,i){return i&&(t=i.split(":"))&&t.length&&(e.directive[d(t[0])]=d(t[1])),""}).replace(/<%!--(.*?)--%>/g,"").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');";this.fn=new Function("obj",t)}return this}},{key:"registHelper",value:function(){for(var e=this[l.h.dir],t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];2==i.length&&"string"==typeof i[0]?e[i[0]]=i[1]:"1"==i.length&&"object"==n(i[0])&&s.default.extend(e,i[0])}}],[{key:"render",value:function(t,i){return new e(t).render(i)}},{key:"registHelper",value:function(){for(var e={},t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];2==i.length&&"string"==typeof i[0]?e[i[0]]=i[1]:"1"==i.length&&"object"==n(i[0])&&(e=i[0]),e&&s.default.extend(a.default.prototype,e)}}]),e}();t.default=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r={},a=r.toString;function s(e,t){var i,n;if(function(e){return"number"==typeof e.length}(e)){for(i=0;i<e.length;i++)if(!1===t.call(e[i],i,e[i]))return e}else for(n in e)if(!1===t.call(e[n],n,e[n]))return e;return e}s("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){r["[object "+t+"]"]=t.toLowerCase()});var o=function(e){return function(t){return{}.toString.call(t)=="[object "+e+"]"}},l=o("Object"),u=o("Function"),d=Array.isArray||o("Array"),c=o("String");var h,p,f=0,v=window.document,y=/^(?:text|application)\/javascript/i,m=/^(?:text|application)\/xml/i,g="application/json",b="text/html",_=/^\s*$/,w=v.createElement("a");w.href=window.location.href;var k=encodeURIComponent;function x(e,t){var i=t.context;if(!1===t.beforeSend.call(i,e,t))return!1}function S(e,t,i,n){var r=i.context;i.success.call(r,e,"success",t),n({data:e,status:"success",xhr:t}),T("success",t,i)}function E(e,t,i,n,r){var a=n.context;n.error.call(a,i,t,e),r({xhr:i,type:t,error:e}),T(t,i,n)}function T(e,t,i){var n=i.context;i.complete.call(n,t,e)}function P(){}var A={type:"GET",beforeSend:P,success:P,error:P,complete:P,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:g,xml:"application/xml, text/xml",html:b,text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0};function C(e,t){return""==t?e:(e+"&"+t).replace(/[&?]{1,2}/,"?")}function D(e,t){var i=[];return i.add=function(e,t){u(t)&&(t=t()),null==t&&(t=""),this.push(k(e)+"="+k(t))},function e(t,i,n,o){var u,c=d(i),h=function(e){return l(e)&&!function(e){return null!=e&&e==e.window}(e)&&Object.getPrototypeOf(e)==Object.prototype}(i);s(i,function(i,s){u=function(e){return null==e?String(e):r[a.call(e)]||"object"}(s),o&&(i=n?o:o+"["+(h||"object"==u||"array"==u?i:"")+"]"),!o&&c?t.add(s.name,s.value):"array"==u||!n&&"object"==u?e(t,s,n,i):t.add(i,s)})}(i,e,t),i.join("&").replace(/%20/g,"+")}function L(e){var t,i,r=function e(t,i,r){if(r&&e(t,r),i&&"object"==(void 0===i?"undefined":n(i)))for(var a in i)t[a]=i[a];return t}({},e||{});for(h in A)void 0===r[h]&&(r[h]=A[h]);r.crossDomain||((t=v.createElement("a")).href=r.url,t.href=t.href,r.crossDomain=w.protocol+"//"+w.host!=t.protocol+"//"+t.host),r.url||(r.url=window.location.toString()),(i=r.url.indexOf("#"))>-1&&(r.url=r.url.slice(0,i)),function(e){e.processData&&e.data&&!c(e.data)&&(e.data=D(e.data,e.traditional)),!e.data||e.type&&"GET"!=e.type.toUpperCase()||(e.url=C(e.url,e.data),e.data=void 0)}(r);var a=r.dataType,s=/\?.+=\?/.test(r.url);if(s&&(a="jsonp"),!1!==r.cache&&(e&&!0===e.cache||"script"!=a&&"jsonp"!=a)||(r.url=C(r.url,"_="+Date.now())),"jsonp"==a)return s||(r.url=C(r.url,r.jsonp?r.jsonp+"=?":!1===r.jsonp?"":"callback=?")),function(e,t){if(!("type"in e))return L(e);return new Promise(function(t,i){var n,r,a=e.jsonpCallback,s=(u(a)?a():a)||"jsonpx"+((new Date).getTime()+Math.round(1e3*Math.random())+ ++f),o=v.createElement("script"),l=window[s],d=function(e){i({errorType:e})},c={abort:d};function h(){o.onload=o.onreadystatechange=null,v.head.removeChild(o),o=null,clearTimeout(r),S(n&&n.length?n[0]:null,c,e,t),window[s]=l,n&&u(l)&&l(n[0]),l=n=void 0}!1!==x(c,e)?("onload"in o?o.onload=h:o.onreadystatechange=function(){/loaded|complete/.test(o.readyState)&&h()},o.onerror=function(){E(null,"error",c,e,i)},window[s]=function(){n=arguments},o.src=e.url.replace(/\?(.+)=\?/,"?$1="+s),v.head.appendChild(o),e.timeout>0&&(r=setTimeout(function(){d("timeout")},e.timeout))):d("abort")})}(r);var o,l=r.accepts[a],d={},k=function(e,t){d[e.toLowerCase()]=[e,t]},T=/^([\w-]+:)\/\//.test(r.url)?RegExp.$1:window.location.protocol,B=r.xhr(),O=B.setRequestHeader;if(r.crossDomain||k("X-Requested-With","XMLHttpRequest"),k("Accept",l||"*/*"),(l=r.mimeType||l)&&(l.indexOf(",")>-1&&(l=l.split(",",2)[0]),B.overrideMimeType&&B.overrideMimeType(l)),(r.contentType||!1!==r.contentType&&r.data&&"GET"!=r.type.toUpperCase())&&k("Content-Type",r.contentType||"application/x-www-form-urlencoded"),r.headers)for(p in r.headers)k(p,r.headers[p]);return B.setRequestHeader=k,new Promise(function(e,t){if(B.onreadystatechange=function(){if(4==B.readyState){B.onreadystatechange=P,clearTimeout(o);var i,n=!1;if(B.status>=200&&B.status<300||304==B.status||0==B.status&&"file:"==T){a=a||function(e){return e&&(e=e.split(";",2)[0]),e&&(e==b?"html":e==g?"json":y.test(e)?"script":m.test(e)&&"xml")||"text"}(r.mimeType||B.getResponseHeader("content-type")),i=B.responseText;try{"script"==a?(0,eval)(i):"xml"==a?i=B.responseXML:"json"==a&&(i=_.test(i)?null:JSON.parse(i))}catch(e){n=e}n?E(n,"parsererror",B,r,t):S(i,B,r,e)}else E(B.statusText||null,B.status?"error":"abort",B,r,t)}},!1===x(B,r))return B.abort(),void E(null,"abort",B,r,t);if(r.xhrFields)for(p in r.xhrFields)B[p]=r.xhrFields[p];var i=!("async"in r)||r.async;for(p in B.open(r.type,r.url,i,r.username,r.password),d)O.apply(B,d[p]);r.timeout>0&&(o=setTimeout(function(){B.onreadystatechange=P,B.abort(),E(null,"timeout",B,r,t)},r.timeout)),B.send(r.data?r.data:null)})}function B(e,t,i,n){return u(t)&&(n=i,i=t,t=void 0),u(i)||(n=i,i=void 0),{url:e,data:t,success:i,dataType:n}}L.get=function(){return L(B.apply(null,arguments))},L.post=function(){var e=B.apply(null,arguments);return e.type="POST",L(e)},L.getJSON=function(){var e=B.apply(null,arguments);return e.dataType="json",L(e)},L.getScript=function(e,t){return new Promise(function(i,n){var r=v.createElement("script"),a=v.head||v.getElementsByTagName("head")[0]||v.documentElement;function s(){r.onload=r.onreadystatechange=null,a.removeChild(r),r=null,i()}r.type="text/javascript",r.async=!0,t&&(r.charset=t),r.src=e,"onload"in r?r.onload=s:r.onreadystatechange=function(){/loaded|complete/.test(r.readyState)&&s()},a.insertBefore(r,a.firstChild)})},t.default=L},function(e,t,i){"use strict";function n(e,t,i){if(void 0===t){var n=new RegExp("(?:^|; )"+e+"=([^;]*)").exec(document.cookie);return n&&n[1]||""}i=i||{},null===t&&(t="",i.expires=-1);var r,a="";i.expires&&("number"==typeof i.expires||i.expires.toUTCString)&&("number"==typeof i.expires?(r=new Date).setTime(r.getTime()+24*i.expires*60*60*1e3):r=i.expires,a="; expires="+r.toUTCString());var s=i.path?"; path="+i.path:"",o=i.domain?"; domain="+i.domain:"",l=i.secure?"; secure":"";document.cookie=[e,"=",t,a,s,o,l].join("")}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n,n.isEnable=function(){var e=!0,t="____test";return n(t,1),1!=n(t)&&(e=!1),n(t,null),e}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){this.logoutTimes=0,this.loginTimes=0};(n.prototype={getAppid:function(){return this.getInfo().appid||""},getPassport:function(){return this.getInfo().userid||""},getUid:function(){return this.getInfo().uid||""},getUUID:function(){return this.getInfo().uuid||""},getQname:function(){return this.getInfo().uniqname||""}}).b64_423=function(e){for(var t=new Array("A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","-","_"),i="",n=0;n<e.length;n++){for(var r=0;r<64;r++)if(e.charAt(n)==t[r]){var a=r.toString(2);i+=("000000"+a).substr(a.length);break}if(64==r)return 2==n?i.substr(0,8):i.substr(0,16)}return i},n.prototype.b2i=function(e){for(var t=0,i=128,n=0;n<8;n++,i/=2)"1"==e.charAt(n)&&(t+=i);return String.fromCharCode(t)},n.prototype.b64_decodex=function(e){var t,i=[],n="";for(t=0;t<e.length;t+=4)n+=this.b64_423(e.substr(t,4));for(t=0;t<n.length;t+=8)i+=this.b2i(n.substr(t,8));return i},n.prototype.utf8to16=function(e){var t,i,n,r,a,s,o,l;for(t=[],r=e.length,i=n=0;i<r;){switch((a=e.charCodeAt(i++))>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t[n++]=e.charAt(i-1);break;case 12:case 13:s=e.charCodeAt(i++),t[n++]=String.fromCharCode((31&a)<<6|63&s);break;case 14:s=e.charCodeAt(i++),o=e.charCodeAt(i++),t[n++]=String.fromCharCode((15&a)<<12|(63&s)<<6|63&o);break;case 15:switch(15&a){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l=(7&a)<<18|(63&(s=e.charCodeAt(i++)))<<12|(63&(o=e.charCodeAt(i++)))<<6|(63&e.charCodeAt(i++))-65536,t[n]=0<=l&&l<=1048575?String.fromCharCode(l>>>10&1023|55296,1023&l|56320):"?";break;case 8:case 9:case 10:case 11:i+=4,t[n]="?";break;case 12:case 13:i+=5,t[n]="?"}}n++}return t.join("")},n.prototype.selectInfo=function(){var e,t,i,n=["ppinf","ppinfo","passport"];for(e=0,t=n.length;e<t;e++)if((i=new RegExp("\\b"+n[e]+"\\b=(.*?)(?:$|;)").exec(document.cookie))&&i.length){i=i[1];break}return i},n.prototype.decodeInfo=function(e){var t;try{return"1"!=(e=unescape(e).split("|"))[0]&&"2"!=e[0]||(t=this.utf8to16(this.b64_decodex(e[3]))),t}catch(e){console.log(e)}},n.prototype.analyzeInfo=function(e){e=e||"";var t,i,n,r={};try{for(e=e.split("|"),t=0,i=e.length;t<i;t++)(n=e[t].split(":")).length>1&&(r[n[0]]=n[2])}catch(e){console.log(e)}return r},n.prototype.getInfo=function(){return this.analyzeInfo(this.decodeInfo(this.selectInfo()))},t.default=new n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getHardflag=t.getNonLinearResource=t.getNonLinear=t.getNonLinearAndResouce=t.NonLinearAdv=void 0;var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=f(i(10)),s=i(1),o=f(i(0)),l=f(i(22)),u=f(i(28)),d=f(i(29)),c=i(14),h=i(15),p=f(i(23));function f(e){return e&&e.__esModule?e:{default:e}}var v=function(e){e=e||[];var t=null,i=null,n=null;e:for(var r,a=0;r=e[a++];)for(var s,o=(r.InLine.Creatives||{}).Creative||[],l=0;s=o[l++];)for(var u,d=(s.NonLinearAds||{}).NonLinear||[],c=0;u=d[c++];)if(y(u)){t=u,i=s.NonLinearAds,n=r;break e}return{nonLinearAds:i,nonLinear:t,ad:n}},y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={StaticResource:h.STATIC_RESOURCE,IFrameResource:h.IFRAME_RESOURCE,HTMLResource:h.HTML_RESOURCE},i=null;return["StaticResource","IFrameResource","HTMLResource"].some(function(n){if(e[n]&&e[n].length)return(i=e[n][0]).__type=t[n],!0}),i},m=(0,u.default)(function(e){var t=e.nonLinearAds,i=e.nonLinear;return{nonLinearAds:t,nonLinear:i,resource:y(i)}},v),g=0,b=function(e){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return n.player=e,n.config=i,n.pt=i.pt,n.style=h.STYLE_MAP[n.pt],n._ads=[],n._initEvent(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.EventEmitter),n(t,[{key:"_initEvent",value:function(){var e=this;this.on("loaded",function(){e.isEmpty()&&e.reportEmpty()})}},{key:"reportEmpty",value:function(){var e=this,t=this.macroData;this.ads.forEach(function(){(((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).InLine||{}).Impression||[]).forEach(function(i){i.__done||(i.__done=!0,(0,c.advPingback)(i["@value"],t),o.default.log("[\u5e7f\u544a]"+e.pt+"\u7a7a\u5e7f\u544a\u4e0a\u62a5\u5730\u5740"+i["@value"]))})})}},{key:"onStart",value:function(){var e=this;this.startTime=Date.now(),this.onTimeupdate(),this.timeupdateTimer=setInterval(function(){return e.onTimeupdate()},1e3);var t=v(this.ads).ad.InLine.Impression||[],i=this.macroData;t.forEach(function(e){e.__done||(e.__done=!0,(0,c.advPingback)(e["@value"],i))})}},{key:"onEnded",value:function(){clearInterval(this.timeupdateTimer),this.timeupdateTimer=null;var e=this.macroData,t=Date.now()-this.startTime;((v(this.ads).nonLinearAds.TrackingEvents||{}).Tracking||[]).forEach(function(i){if(!i.__done){var n=i["@attr"].event,r=i["@attr"].offset;!i.__done&&(-1!=["complete"].indexOf(n)||"progress"==n&&t>=r)&&(i.__done=!0,(0,c.advPingback)(i["@value"],e))}})}},{key:"onClick",value:function(){var e=this.macroData;(v(this.ads).nonLinear.NonLinearClickTracking||[]).forEach(function(t){return(0,c.advPingback)(t["@value"],e)})}},{key:"onTimeupdate",value:function(){var e=this.macroData,t=Date.now()-this.startTime,i=v(this.ads).nonLinearAds;(i&&(i.TrackingEvents||{}).Tracking||[]).forEach(function(i){if(!i.__done){var n=i["@attr"].event,r=i["@attr"].offset;(-1!=["creativeView, start"].indexOf(n)||"progress"==n&&t>=r)&&(i.__done=!0,(0,c.advPingback)(i["@value"],e))}})}},{key:"loadData",value:function(){var e=this;this.state=1,function(t){var i=(0,p.default)(e.player,{pt:e.pt});o.default.log("[\u5e7f\u544a]nonlinear adv --\x3e ",i),(0,a.default)(i,{credentials:"include"},3e3).then(function(i){if(t===g)return i.ok?i.text():e.emit("load.error")}).then(function(t){return e.process(t)}).catch(function(t){o.default.error("[\u5e7f\u544a]nonlinear request error--\x3e",t),e.emit("load.error")})}(++g)}},{key:"process",value:function(e){var t=this;if(1!=this.state)return this.state=3;this.state=2,(0,d.default)(e).then(function(e){e.Ad||(e.Error||[]).forEach(function(e){var t=e["@value"];(0,u.default)(l.default,function(e){return(0,c.macroURL)(e,{"[ERRORCODE]":"303"})})(t)});var i=e.Ad;t.vast=e,t._ads=t.filter(i),o.default.log("[\u5e7f\u544a]nonlinear adv--\x3e",t.ads),t.emit("loaded",t.ads)}).catch(function(e){o.default.error("[\u5e7f\u544a]nonlinear parse error--\x3e",e),t.cancel(),t.emit("load.error")})}},{key:"filter",value:function(){var e=this;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.ads).filter(function(t){return!((0,c.getAdType)(t)!==h.NONLINEAR_AD||(0,c.getAdStyle)(t)!==e.style||t["@attr"]&&t["@attr"].standby)}).map(function(e){if(e.__error)for(var t,i=0;t=e[i++];){var n=e["@attr"]||{},r=t["@attr"]||{};if(n.master&&n.master==r.standby)return t}return e}).filter(function(e){return!e.__error||!e.InLine})}},{key:"isEmpty",value:function(){return!v(this.ads).nonLinear}},{key:"cancel",value:function(){1==this.state&&(this.state=3)}},{key:"macroData",get:function(){return{"[CONTENTPLAYHEAD]":this.player.movieCurrentTime}}},{key:"ads",get:function(){return this._ads}}]),t}();t.NonLinearAdv=b,t.getNonLinearAndResouce=m,t.getNonLinear=v,t.getNonLinearResource=y,t.getHardflag=function(e){var t=-1,i=v(e).ad;if(i)for(var n,a=((i.InLine||{}).Extensions||{}).Extension||[],s=0;n=a[s++];){var o=n.AdParams||{};if(o.Hardflag&&"object"==r(o.Hardflag)){t=o.Hardflag["@value"];break}}return t}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i(21);t.default=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return new Promise(function(e,i){var n;"number"==typeof t[t.length-1]&&(n=t[t.length-1],t=t.slice(0,-1)),fetch.apply(void 0,function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(t)).then(function(t){return e(t)}).catch(function(e){return i(e)}),n&&setTimeout(function(){var e=new Error("timeout--\x3e"+n);e.code=501,i(e)},n)})}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SetBtnAnimation=t.NextBtnAnimation=t.MuteBtnAnimation=t.FSBtnAnimation=t.PlayBtnAnimation=void 0;var n=l(i(45)),r=l(i(48)),a=l(i(49)),s=l(i(50)),o=l(i(51));function l(e){return e&&e.__esModule?e:{default:e}}t.PlayBtnAnimation=n.default,t.FSBtnAnimation=r.default,t.MuteBtnAnimation=a.default,t.NextBtnAnimation=s.default,t.SetBtnAnimation=o.default},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(58);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var r=i(60);Object.keys(r).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return r[e]}})});var a=i(9);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var s=i(61);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var o=i(62);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var l=i(63);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})});var u=i(64);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var d=i(65);Object.keys(d).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}})})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(15),r=i(12);t.default=function(e){var t=(0,r.getNonLinearAndResouce)(e),i=t.nonLinear,a=t.resource,s=(0,r.getHardflag)(e),o=a["@value"],l=i.NonLinearClickThrough,u=l?l["@value"]:null,d=a.__type,c=i["@attr"]&&i["@attr"].width?i["@attr"].width:null,h=i["@attr"]&&i["@attr"].height?i["@attr"].height:null,p=null;if(d===n.STATIC_RESOURCE){var f=(a["@attr"]&&a["@attr"].creativeType||"").toLowerCase();/^image\//.test(f)?p=u?'<a class="x-adv-nonlinear-link" target="_blank" href ="'+u+'">\n        <img src="'+o+'" alt="">\n        </a>':'<img src="'+o+'" alt="">':"application/x-shockwave-flash"==f&&(p=u?'\n        <embed src="'+o+'"\n        type="application/x-shockwave-flash"\n        wmode="transparent"\n        flashvars="clickthru='+escape(u)+'"\n        allowscriptaccess="always"\n        allowfullscreen="true" />\n        ':'\n        <embed src="'+o+'"\n        type="application/x-shockwave-flash"\n        wmode="transparent"\n        allowscriptaccess="always"\n        allowfullscreen="true" />\n        ')}else d===n.IFRAME_RESOURCE?p='<iframe src="'+o+'" frameborder="0"></frame>':n.HTML_RESOURCE;return{content:p,width:c,height:h,hardflag:s}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getThirdAdUrl=t.getAdStyle=t.getAdType=t.merge=t.advPingback=t.removeWhiteSpace=t.macroURL=t.encodeTime=t.parseTime=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=d(i(0)),a=d(i(18)),s=d(i(22)),o=d(i(30)),l=d(i(17)),u=i(15);function d(e){return e&&e.__esModule?e:{default:e}}var c=function(e){return(0,a.default)(e,"hh:mm:ss")},h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(e=e||"").replace(/\[CACHEBUSTING\]/,(new Array(9).join(1)+Math.round(1e8*Math.random())).slice(-8)).replace(/(\[ERRORCODE\])/,function(e,i){return t[i]||i}).replace(/(\[CONTENTPLAYHEAD\])/,function(e,i){return t[i]?c(t[i]):i}).replace(/(\[ASSETURI\])/,function(e,i){return t[i]?encodeURIComponent(t[i]):i}).replace(/(\[SKIPTIME\])/,function(e,i){return t[i]||i})};t.parseTime=function(e,t){return e?/^(\d{1,3})%$/.test(e)?t*parseInt(RegExp.$1)/100:/^(\d{2}):(\d{2}):(\d{2})(?:\.(\d{3}))?$/.test(e)?3600*parseInt(RegExp.$1)+60*parseInt(RegExp.$2)+parseInt(RegExp.$3):Number(e):null},t.encodeTime=c,t.macroURL=h,t.removeWhiteSpace=function(e){return e?e.replace(/[\r\n\t\s]*/g,""):e},t.advPingback=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.default)(function(e){var t=e.slice(e.indexOf("?")+1);return e+"&encrypt="+o.default.encryptToString((0,l.default)(t),47985)}(h(e,t)))},t.merge=function e(t,i){for(var r in i)Array.isArray(t[r])&&Array.isArray(i[r])?t[r]=i[r].concat(t[r]):"object"===n(t[r])&&"object"===n(i[r])?t[r]=e(t[r],i[r]):null!=i[r]&&(t[r]=i[r]);return t},t.getAdType=function(e){if(!e||!e.InLine||!e.InLine.Creatives)return r.default.error("[\u4e3b\u64ad\u653e\u5668] getAdType--\x3e",e),null;var t=e.InLine.Creatives.Creative,i=null;return t.some(function(e){if(e.Linear)return i=u.LINEAR_AD,!0}),i||(t.some(function(e){if(e.NonLinearAds)return i=u.NONLINEAR_AD,!0}),i||i)},t.getAdStyle=function(e){var t=e.InLine.Extensions,i=e.InLine.Extensions.Extension||[],n=null;return 0===i.length&&i.push(t),i.some(function(t){var i=(t.Adparams||t.AdParams||{})["@attr"]||{};if(i.adStyle){switch(i.adStyle){case"oad":var r="optional"===e["@attr"].type;n=r?u.STYLE_SELECT:u.STYLE_OAD;break;case"preoad":case"sufoad":n=u.STYLE_OAD;break;case"ead":n=u.STYLE_EAD;break;case"mad":n=u.STYLE_MAD;break;case"pad":n=u.STYLE_PAD;break;case"flogo":n=u.STYLE_FLOGO;break;case"band":n=u.STYLE_BAND;break;case"fbarad":n=u.STYLE_CTRLBAR;break;case"wrapframe":n=u.STYLE_BACKGROUND}return!0}}),n},t.getThirdAdUrl=function(e){var t=e.url.split("|"),i=window.getPageFocus(),n={1:(new Date).getTime(),2:e.width+"*"+e.height,3:"",4:"1.0",5:"1",6:"1",7:"",8:i},r=(0,l.default)(t[1]+e.randomNum),a="&vx="+e.vx+"&vd="+JSON.stringify(n)+"&vf="+r;return t[0]+a+"|"+t[1].replace("&o=",a+"&o=")}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.LINEAR_AD="LINEAR_AD",t.SKIPPABLE_LINEAR_AD="SKIPPABLE_LINEAR_AD",t.COMPANION_AD="COMPANION_AD",t.NONLINEAR_AD="NONLINEAR_AD",t.STATIC_RESOURCE="STATIC_RESOURCE",t.IFRAME_RESOURCE="IFRAME_RESOURCE",t.HTML_RESOURCE="HTML_RESOURCE",t.STYLE_SELECT="STYLE_SELECT",t.STYLE_OAD="STYLE_OAD",t.STYLE_EAD="STYLE_EAD",t.STYLE_MAD="STYLE_MAD";var n=t.STYLE_PAD="STYLE_PAD",r=t.STYLE_FLOGO="STYLE_FLOGO",a=t.STYLE_BAND="STYLE_BAND",s=t.STYLE_CTRLBAR="STYLE_CTRLBAR",o=t.STYLE_BACKGROUND="STYLE_BACKGROUND";t.STYLE_MAP={pad:n,flogo:r,band:a,ctrlAd:s,wrapframe:o}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(i(7)),r=a(i(4));function a(e){return e&&e.__esModule?e:{default:e}}var s={uid:function(){var e=(0,n.default)("fuid");return e||(e=r.default.createFUID(),(0,n.default)("fuid",e,{domain:"tv.sohu.com",path:"/",expires:100})),e}(),vipuser:(0,n.default)("fee_status")?1:0};t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.default=function(e){return r.MD5(e)};var r={};r.MD5=function(e){function t(e){var t=(e>>>0).toString(16);return"00000000".substr(0,8-t.length)+t}function i(e,t,i){return e&t|~e&i}function r(e,t,i){return i&e|~i&t}function a(e,t,i){return e^t^i}function s(e,t,i){return t^(e|~i)}function o(e,t){return e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]}function l(e){for(var t=[],i=0;i<e.length;i++)if(e.charCodeAt(i)<=127)t.push(e.charCodeAt(i));else for(var n=encodeURIComponent(e.charAt(i)).substr(1).split("%"),r=0;r<n.length;r++)t.push(parseInt(n[r],16));return t}function u(e){for(var t=new Array(e.length),i=0;i<e.length;i++)t[i]=e[i];return t}var d=null,c=null;function h(e,t){return 4294967295&e+t}return"string"==typeof e?d=l(e):e.constructor==Array?0===e.length?d=e:"string"==typeof e[0]?d=function(e){for(var t=[],i=0;i<e.length;i++)t=t.concat(l(e[i]));return t}(e):"number"==typeof e[0]?d=e:c=n(e[0]):"undefined"!=typeof ArrayBuffer?e instanceof ArrayBuffer?d=u(new Uint8Array(e)):e instanceof Uint8Array||e instanceof Int8Array?d=u(e):e instanceof Uint32Array||e instanceof Int32Array||e instanceof Uint16Array||e instanceof Int16Array||e instanceof Float32Array||e instanceof Float64Array?d=u(new Uint8Array(e.buffer)):c=void 0===e?"undefined":n(e):c=void 0===e?"undefined":n(e),c&&alert("MD5 type mismatch, cannot process "+c),function(){function e(e,t,i,n){var r=b;b=g,g=m,m=h(m,function(e,t){return e<<t&4294967295|e>>>32-t}(h(y,h(e,h(t,i))),n)),y=r}var n=d.length;d.push(128);var l=d.length%64;if(l>56){for(var u=0;u<64-l;u++)d.push(0);l=d.length%64}for(u=0;u<56-l;u++)d.push(0);d=d.concat(function(e){for(var t=[],i=0;i<8;i++)t.push(255&e),e>>>=8;return t}(8*n));var c=1732584193,p=4023233417,f=2562383102,v=271733878,y=0,m=0,g=0,b=0;for(u=0;u<d.length/64;u++){y=c;var _=64*u;e(i(m=p,g=f,b=v),3614090360,o(d,_),7),e(i(m,g,b),3905402710,o(d,_+4),12),e(i(m,g,b),606105819,o(d,_+8),17),e(i(m,g,b),3250441966,o(d,_+12),22),e(i(m,g,b),4118548399,o(d,_+16),7),e(i(m,g,b),1200080426,o(d,_+20),12),e(i(m,g,b),2821735955,o(d,_+24),17),e(i(m,g,b),4249261313,o(d,_+28),22),e(i(m,g,b),1770035416,o(d,_+32),7),e(i(m,g,b),2336552879,o(d,_+36),12),e(i(m,g,b),4294925233,o(d,_+40),17),e(i(m,g,b),2304563134,o(d,_+44),22),e(i(m,g,b),1804603682,o(d,_+48),7),e(i(m,g,b),4254626195,o(d,_+52),12),e(i(m,g,b),2792965006,o(d,_+56),17),e(i(m,g,b),1236535329,o(d,_+60),22),e(r(m,g,b),4129170786,o(d,_+4),5),e(r(m,g,b),3225465664,o(d,_+24),9),e(r(m,g,b),643717713,o(d,_+44),14),e(r(m,g,b),3921069994,o(d,_),20),e(r(m,g,b),3593408605,o(d,_+20),5),e(r(m,g,b),38016083,o(d,_+40),9),e(r(m,g,b),3634488961,o(d,_+60),14),e(r(m,g,b),3889429448,o(d,_+16),20),e(r(m,g,b),568446438,o(d,_+36),5),e(r(m,g,b),3275163606,o(d,_+56),9),e(r(m,g,b),4107603335,o(d,_+12),14),e(r(m,g,b),1163531501,o(d,_+32),20),e(r(m,g,b),2850285829,o(d,_+52),5),e(r(m,g,b),4243563512,o(d,_+8),9),e(r(m,g,b),1735328473,o(d,_+28),14),e(r(m,g,b),2368359562,o(d,_+48),20),e(a(m,g,b),4294588738,o(d,_+20),4),e(a(m,g,b),2272392833,o(d,_+32),11),e(a(m,g,b),1839030562,o(d,_+44),16),e(a(m,g,b),4259657740,o(d,_+56),23),e(a(m,g,b),2763975236,o(d,_+4),4),e(a(m,g,b),1272893353,o(d,_+16),11),e(a(m,g,b),4139469664,o(d,_+28),16),e(a(m,g,b),3200236656,o(d,_+40),23),e(a(m,g,b),681279174,o(d,_+52),4),e(a(m,g,b),3936430074,o(d,_),11),e(a(m,g,b),3572445317,o(d,_+12),16),e(a(m,g,b),76029189,o(d,_+24),23),e(a(m,g,b),3654602809,o(d,_+36),4),e(a(m,g,b),3873151461,o(d,_+48),11),e(a(m,g,b),530742520,o(d,_+60),16),e(a(m,g,b),3299628645,o(d,_+8),23),e(s(m,g,b),4096336452,o(d,_),6),e(s(m,g,b),1126891415,o(d,_+28),10),e(s(m,g,b),2878612391,o(d,_+56),15),e(s(m,g,b),4237533241,o(d,_+20),21),e(s(m,g,b),1700485571,o(d,_+48),6),e(s(m,g,b),2399980690,o(d,_+12),10),e(s(m,g,b),4293915773,o(d,_+40),15),e(s(m,g,b),2240044497,o(d,_+4),21),e(s(m,g,b),1873313359,o(d,_+32),6),e(s(m,g,b),4264355552,o(d,_+60),10),e(s(m,g,b),2734768916,o(d,_+24),15),e(s(m,g,b),1309151649,o(d,_+52),21),e(s(m,g,b),4149444226,o(d,_+16),6),e(s(m,g,b),3174756917,o(d,_+44),10),e(s(m,g,b),718787259,o(d,_+8),15),e(s(m,g,b),3951481745,o(d,_+36),21),c=h(c,y),p=h(p,m),f=h(f,g),v=h(v,b)}return function(e,i,n,r){for(var a="",s=0,o=0,l=3;l>=0;l--)s=255&(o=arguments[l]),s<<=8,s|=255&(o>>>=8),s<<=8,s|=255&(o>>>=8),s<<=8,a+=t(s|=o>>>=8);return a}(v,f,p,c).toUpperCase()}()}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e,t){e/=1;var i={};for(var n in/h+/.test(t)?(i["h+"]=Math.floor(e/3600),i["m+"]=Math.floor((e-3600*i["h+"])/60),i["s+"]=e%60):i={"m+":Math.floor(e/60),"s+":e%60},t=t.replace(/(h+)/,function(e,t){var n=t,r=(""+i["h+"]).length;return t&&r>t.length&&(n=new Array(r+1).join("h")),n}).replace(/(m+)/,function(e,t){var n=t,r=(""+i["m+"]).length;return t&&r>t.length&&(n=new Array(r+1).join("m")),n}),i)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,("00"+i[n]).slice(1+~RegExp.$1.length)));return t}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(i(27)),r=a(i(7));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){return function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"click",a=e.dataModel||{},s={type:i,txid:t,url:escape(location.href||""),refer:escape(document.referrer||""),sid:(0,r.default)("SUV"),fuid:(0,r.default)("fuid")||"",playlistid:a.plid||"",vid:a.vid||"",catecode:escape(a.catecode||""),cid:a.cid||"",ver:e.version,_:Date.now()};(0,n.default)("//pv.hd.sohu.com/mc.gif?",s)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PLAYRATE_MODE=t.RESOLUTION_MODE=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(i(4));var r={},a=(t.RESOLUTION_MODE={2:"\u6807\u6e05",1:"\u9ad8\u6e05",21:"\u8d85\u6e05",31:"\u539f\u753b"},t.PLAYRATE_MODE={.8:"0.8x",1:"1.0x",1.5:"1.5x",2:"2.0x"},{autoplay:!0,playType:"vod"});r.initConfig=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.default.extend({},e,a)},t.default=r},function(e,t,i){i(59),e.exports=self.fetch.bind(self)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e){if(e){var t=new Image;t.onload=t.onerror=function(){return t=null},t.src=e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=u(i(30)),a=u(i(4)),s=u(i(7)),o=u(i(16)),l=u(i(17));function u(e){return e&&e.__esModule?e:{default:e}}var d=new Uint8Array([173,173,202,254,186,190,173,173]),c=function(e){for(var t=new Uint8Array(d.length),i=0,n=d.length;i<n;i++)t[i]=d[i]^e;return t};t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.dataModel,u=(0,s.default)("fee_status")?1:0,d=o.default.uid,h=i.vid,p=i.fee?1:0,f=escape(escape(location.href)),v=Math.floor(128*Math.random()),y="&vid="+h+"&uid="+d+"&fee="+p+"&vu="+u+"&pageUrl="+f,m=encodeURIComponent(r.default.encryptToString(y,c(v)))+"_"+v,g=document.documentElement.clientWidth+"_"+document.documentElement.clientHeight+"/"+e.version,b=r.default.encryptToString(g,c(v))+(parseInt(document.documentElement.clientWidth%127*(document.documentElement.clientHeight%127)%127)+100),_=d+Date.now(),w=(0,l.default)(_);return"//v.aty.sohu.com/v?"+function(e){if("object"!==(void 0===e?"undefined":n(e)))return"";var t,i,r=[];for(t in e){i=e[t];var a=Object.prototype.toString.call(i);"[object Array]"===a?r.push(t+"="+JSON.stringify(i)):"[object Object]"===a?r.push(t+"="+JSON.stringify(i)):r.push(t+"="+(void 0===i?"":i))}return r.join("&")}(a.default.extend({prot:"vast",cat:i.cmscat,c:i.ch,vc:i.catecode,type:1==i.site?"vrs":"my",pver:e.version,al:i.plid,act:i.act,st:i.mainActorId,ar:i.areaid,ye:i.year,du:i.duration,vid:i.vid,tvid:i.tvid,out:function(){var e=1,t=document.domain;return-1!=t.indexOf("sohu.com")?e=0:["56.com","focus.cn","chinaren.com"].some(function(e){return-1!=t.indexOf(e)})&&(e=2),e}(),TUV:d,uid:d,autoPlay:e.config.autoplay?1:0,ag:i.age,ti:encodeURIComponent(i.title),fee:p,pageUrl:escape(escape(location.href)),lid:i.lid,ak:e.config.data.api_key?e.config.data.api_key:"Pc",vu:u,isIf:window.top===window?0:1,qd:"",pagerefer:encodeURIComponent(document.referrer),lrd:(0,s.default)("landingrefer"),ran:m,crid:i.crid,oth:(0,s.default)("_LQD"),cd:(0,s.default)("_LCODE"),sz:document.documentElement.clientWidth+"_"+document.documentElement.clientHeight,md:b,txid:(0,s.default)("_TXID"),myTvUid:i.myTvUid,tag:i.tag,ugu:i.wm_data.ugu,ugcode:i.wm_data.ugcode,isHplayer:1,uuid:_,guid:w,w:e.width,h:e.height},t))}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=function(e){return e&&e.__esModule?e:{default:e}}(i(72));var a=function(){n&&(document.body.removeChild(n),n=null)},s={copy:function(e){return s.process(e,"copy")},cut:function(e){return s.process(e,"cut")},process:function(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"copy";a(),(n=document.createElement("textarea")).style.fontSize="12pt",n.style.border="0",n.style.padding="0",n.style.margin="0",n.style.position="fixed",n.style.left="-9999px",document.body.appendChild(n),n.value=e,(0,r.default)(n);try{t=document.execCommand(i)}catch(i){try{var s=new ClipboardEvent("copy");s.clipboardData.setData("text/plain",e),s.preventDefault(),n.dispatchEvent(s),t=!0}catch(e){t=!1}}return a(),t}};t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t,i){var n=i||t.length;return function(){return arguments.length>=n?t.apply(null,[].slice.call(arguments)):e(function(e){var t=[].slice.call(arguments,1);return function(){return e.apply(null,t.concat([].slice.call(arguments)))}}.apply(null,[t].concat([].slice.call(arguments))),n-arguments.length)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=navigator.userAgent,r=navigator.platform,a=n.toLowerCase(),s={},o={},l={},u=n.match(/Web[kK]it[\/]{0,1}([\d.]+)/),d=n.match(/(Android);?[\s\/]+([\d.]+)?/),c=!!n.match(/\(Macintosh\; Intel /),h=n.match(/(iPad).*OS\s([\d_]+)/),p=n.match(/(iPod)(.*OS\s([\d_]+))?/),f=!h&&n.match(/(iPhone\sOS)\s([\d_]+)/),v=n.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),y=/Win\d{2}|Windows/.test(r),m=n.match(/Windows Phone ([\d.]+)/),g=v&&n.match(/TouchPad/),b=n.match(/Kindle\/([\d.]+)/),_=n.match(/Silk\/([\d._]+)/),w=n.match(/(BlackBerry).*Version\/([\d.]+)/),k=n.match(/(BB10).*Version\/([\d.]+)/),x=n.match(/(RIM\sTablet\sOS)\s([\d.]+)/),S=n.match(/PlayBook/),E=n.match(/Chrome\/([\d.]+)/)||n.match(/CriOS\/([\d.]+)/),T=n.match(/Firefox\/([\d.]+)/),P=n.match(/\((?:Mobile|Tablet); rv:([\d.]+)\).*Firefox\/[\d.]+/),A=n.match(/MSIE\s([\d.]+)/)||n.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),C=!E&&n.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),D=C||n.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/);(o.webkit=!!u)&&(o.version=u[1]),d&&(s.android=!0,s.version=d[2]),f&&!p&&(s.ios=s.iphone=!0,s.version=f[2].replace(/_/g,".")),h&&(s.ios=s.ipad=!0,s.version=h[2].replace(/_/g,".")),p&&(s.ios=s.ipod=!0,s.version=p[3]?p[3].replace(/_/g,"."):null),m&&(s.wp=!0,s.version=m[1]),v&&(s.webos=!0,s.version=v[2]),g&&(s.touchpad=!0),w&&(s.blackberry=!0,s.version=w[2]),k&&(s.bb10=!0,s.version=k[2]),x&&(s.rimtabletos=!0,s.version=x[2]),S&&(o.playbook=!0),b&&(s.kindle=!0,s.version=b[1]),_&&(o.silk=!0,o.version=_[1]),!_&&s.android&&n.match(/Kindle Fire/)&&(o.silk=!0),E&&(o.chrome=!0,o.version=E[1]),T&&(o.firefox=!0,o.version=T[1]),P&&(s.firefoxos=!0,s.version=P[1]),A&&(o.ie=!0,o.version=A[1]),D&&(c||s.ios||y)&&(o.safari=!0,s.ios||(o.version=D[1])),C&&(o.webview=!0),c&&(s.osx=!0),s.tablet=!!(h||S||d&&!n.match(/Mobile/)||T&&n.match(/Tablet/)||A&&!n.match(/Phone/)&&n.match(/Touch/)),s.phone=!(s.tablet||s.ipod||!(d||f||v||w||k||E&&n.match(/Android/)||E&&n.match(/CriOS\/([\d.]+)/)||T&&n.match(/Mobile/)||A&&n.match(/Touch/)));var L,B=n.toLowerCase().match(/\bm?qqbrowser\/([0-9.]+)/),O=n.match(/SogouMobileBrowser/i),M=a.match(/\bmiuibrowser\/([0-9.]+)/),U=n.match(/baidubrowser/i),I=n.match(/baiduboxapp/i),R=n.match(/SohuVideoMobile/i),F=a.match(/\bmicromessenger\/([\d.]+)/);L=a.indexOf("ucbrowser/")>=0?a.match(/\bucbrowser\/([0-9.]+)/):a.indexOf("ubrowser/")>=0?a.match(/\bubrowser\/([0-9.]+)/):/\buc\/[0-9]/.test(a)?a.match(/\buc\/([0-9.]+)/):a.indexOf("ucweb")>=0?a.match(/\bucweb([0-9.]+)?/):a.match(/\b(?:ucbrowser|uc)\b/);var z=n.match(/Windows\sPad/i);B&&(o.qq=!0,o.version=B[1]),O&&(o.sogou=!0),M&&(o.mi=!0,o.version=M[1]),U&&(o.baidu=!0),I&&(o.baiduboxapp=!0),R&&(o.sohuVideoApp=!0),F&&(o.weixin=!0,o.wx=!0,o.version=F[1]),L&&(o.uc=!0,o.version=L[1]),z&&(s.winpad=!0);var N,j,H=a.match(/\bcoolpad[_ ]?([a-z0-9]+)/);M=a.match(/\bmi[ \-]?([a-z0-9 ]+(?= build|\)))/);N=-1!==a.indexOf("samsung")?a.match(/\bsamsung(?:[ \-](?:sgh|gt|sm))?-([a-z0-9]+)/):a.match(/\b(?:sgh|sch|gt|sm)-([a-z0-9]+)/),j=/\bhtc[a-z0-9 _\-]+(?= build\b)/.test(a)?a.match(/\bhtc[ _\-]?([a-z0-9 ]+(?= build))/):a.match(/\bhtc[ _\-]?([a-z0-9 ]+)/),H&&(l.coolpad=!0,l.version=H[1]),M&&(l.mi=!0,l.version=M[1]),N&&(l.samsung=!0,l.version=N[1]),j&&(l.htc=!0,l.version=j[1]),s.pixelRatio=function(){var e=1;try{e=void 0!==window.screen.systemXDPI&&void 0!==window.screen.logicalXDPI&&window.screen.systemXDPI>window.screen.logicalXDPI?window.screen.systemXDPI/window.screen.logicalXDPI:(window.devicePixelRatio,window.devicePixelRatio),e=parseFloat(e)||1}catch(e){}return e}(),s.screenSizeCorrect=1,s.android&&(window.screen.width/window.innerWidth).toFixed(2)===s.pixelRatio.toFixed(2)&&(s.screenSizeCorrect=1/s.pixelRatio),s.androidpad=s.androidPad=function(){var e=1,t=!1,i=(s.screenSizeCorrect||1)*s.pixelRatio,r=Math.floor(window.screen.width*i),a=Math.floor(window.screen.height*i),o=1;try{e=parseFloat(Math.sqrt(r*r+a*a)),o=parseFloat(e/(160*s.pixelRatio))}catch(e){}if("ontouchstart"in window&&s.android){var l=!!/\bpad\b|XiaoMi\/MiPad|lepad|YOGA|MediaPad|GT-P|SM-T|GT-N5100|sch-i800|HUAWEI\s?[MTS]\d+-\w+|Nexus\s7|Nexus\s8|Nexus\s11|Kindle Fire HD|Tablet|tab/i.test(n);/mobile/i.test(n)&&!l?t=!1:l?t=!0:!t&&(e>=2500||o>7)&&(t=!0)}return t}(),s.type=function(){if(s.ios)return"ios";if(s.android)return"android";if(s.osx)return"Mac";var e="X11"==navigator.platform&&!s.win&&!s.osx,t=String(navigator.platform).indexOf("Linux")>-1;return e?"Unix":t?"Linux":s.win?n.indexOf("Windows NT 5.0")>-1||n.indexOf("Windows 2000")>-1?"Win2000":n.indexOf("Windows NT 5.1")>-1||n.indexOf("Windows XP")>-1?"WinXP":n.indexOf("Windows NT 5.2")>-1||n.indexOf("Windows 2003")>-1?"Win2003":n.indexOf("Windows NT 6.0")>-1||n.indexOf("Windows Vista")>-1?"WinVista":n.indexOf("Windows NT 6.1")>-1||n.indexOf("Windows 7")>-1?"Win7":n.indexOf("Windows NT 6.2")>-1||n.indexOf("Windows 8")>-1?"Win8":"windows":"other"}(),s.platform=s.ipad?"ipad":s.iphone?"iphone":s.ipod?"ipod":s.android?"android":s.androidPad?"androidpad":s.wp?"windowsphone":s.win?(plat64=n.indexOf("WOW64")>-1||n.indexOf("Win64")>-1)?"Win64":"Win32":navigator.platform,o.protocol=window.location.protocol,t.os=s,t.browser=o,t.device=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(i(3));t.default=function(e,t){e&&((new Image).src=e+n.default.stringify(t))}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];if(0===t.length)return function(e){return e};if(1===t.length)return t[0];var n=t[t.length-1],r=t.slice(0,-1);return function(){return r.reduceRight(function(e,t){return t(e)},n.apply(void 0,arguments))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(i(10)),r=i(14);var a=["error","ad","impression","category","survey","viewable","notViewable","viewUndetermined","creative","creativeExtension","mediaFile","InteractiveCreativeFile","clickTracking","customClick","icon","iconViewTracking","iconClickTracking","nonLinear","nonLinearClickTracking","companion","companionClickTracking","tracking","staticResource","iFrameResource","htmlResource","verification","javaScriptResource","flashResource","extension"].map(function(e){return e.toLowerCase()}),s=["duration","offset","minSuggestedDuration","intervalDuration","display","skipoffset"].map(function(e){return e.toLowerCase()});function o(e){return!/[^\t\n\r ]/.test(e.data)}var l=function(e){return new Promise(function(t){if(e.Wrapper){var i=e.Wrapper.VASTAdTagURI["@value"];(0,n.default)(i,3e3).then(function(i){if(i.ok)return i.text();e.__error=!0,t(e)}).then(function(i){u(i).then(function(i){if(!i.Ad||!i.Ad.length)return e.__error=!0,t(e);i=i.Ad[0],e={"@attr":e["@attr"],InLine:(0,r.merge)(e.Wrapper,i.InLine)},t(e)}).catch(function(){e.__error=!0,t(e)})}).catch(function(){e.__error=!0,t(e)})}else t(e)})},u=function(e){var t=function e(t){var i,n,l,u,d={};if(1===t.nodeType&&t.attributes.length)for(d["@attr"]={},i=0,n=t.attributes.length;i<n;i++)l=t.attributes.item(i),d["@attr"][l.nodeName]=-1!=s.indexOf(l.nodeName.toLowerCase())?(0,r.parseTime)((0,r.removeWhiteSpace)(l.nodeValue)):l.nodeValue;if(t.hasChildNodes())for(i=0;u=t.childNodes.item(i++);)if(1===u.nodeType){var c=u.nodeName;-1!=a.indexOf(c.toLowerCase())?(Array.isArray(d[c])||(d[c]=[]),d[c].push(e(u))):d[c]=e(u)}else 3!==u.nodeType&&4!==u.nodeType||o(u)||(d["@value"]=-1!=s.indexOf(t.nodeName.toLowerCase())?(0,r.parseTime)((0,r.removeWhiteSpace)(u.nodeValue)):(0,r.removeWhiteSpace)(u.nodeValue));return d}(e="string"==typeof e?(new DOMParser).parseFromString(e,"text/xml"):e).VAST;return t.Ad&&t.Ad.length?new Promise(function(e,i){Promise.all(t.Ad.map(function(e){return l(e)})).then(function(i){t.Ad=i,e(t)}).catch(function(e){return i(e)})}):Promise.resolve(t)};t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=!0;try{String.fromCharCode.apply(String,new Uint8Array([1,2]))}catch(e){n=!1,Object.defineProperty(Array.prototype,"subarray",{value:Array.prototype.slice})}var r=2654435769;function a(e,t){var i=e.length,n=i<<2;if(t){var r=e[i-1];if(r<(n-=4)-3||r>n)return null;n=r}for(var a=new Uint8Array(n),s=0;s<n;++s)a[s]=e[s>>2]>>((3&s)<<3);return a}function s(e,t){var i,n=e.length,r=n>>2;0!=(3&n)&&++r,t?(i=new Uint32Array(r+1))[r]=n:i=new Uint32Array(r);for(var a=0;a<n;++a)i[a>>2]|=e[a]<<((3&a)<<3);return i}function o(e){return 4294967295&e}function l(e,t,i,n,r,a){return(i>>>5^t<<2)+(t>>>3^i<<4)^(e^t)+(a[3&n^r]^i)}function u(e){if(e.length<16){var t=new Uint8Array(16);t.set(e),e=t}return e}function d(e){for(var t=e.length,i=new Uint8Array(3*t),n=0,r=0;r<t;r++){var a=e.charCodeAt(r);if(a<128)i[n++]=a;else if(a<2048)i[n++]=192|a>>6,i[n++]=128|63&a;else{if(!(a<55296||a>57343)){if(r+1<t){var s=e.charCodeAt(r+1);if(a<56320&&56320<=s&&s<=57343){var o=65536+((1023&a)<<10|1023&s);i[n++]=240|o>>18,i[n++]=128|o>>12&63,i[n++]=128|o>>6&63,i[n++]=128|63&o,r++;continue}}throw new Error("Malformed string")}i[n++]=224|a>>12,i[n++]=128|a>>6&63,i[n++]=128|63&a}}return i.subarray(0,n)}function c(e){var t=e.length;return 0===t?"":t<65535?function(e,t){for(var i=new Array(t),n=0,r=0,a=e.length;n<t&&r<a;n++){var s=e[r++];switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:i[n]=s;break;case 12:case 13:if(!(r<a))throw new Error("Unfinished UTF-8 octet sequence");i[n]=(31&s)<<6|63&e[r++];break;case 14:if(!(r+1<a))throw new Error("Unfinished UTF-8 octet sequence");i[n]=(15&s)<<12|(63&e[r++])<<6|63&e[r++];break;case 15:if(!(r+2<a))throw new Error("Unfinished UTF-8 octet sequence");var o=((7&s)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;if(!(0<=o&&o<=1048575))throw new Error("Character outside valid Unicode range: 0x"+o.toString(16));i[n++]=o>>10&1023|55296,i[n]=1023&o|56320;break;default:throw new Error("Bad UTF-8 encoding 0x"+s.toString(16))}}return n<t&&(i.length=n),String.fromCharCode.apply(String,i)}(e,t):function(e,t){for(var i=[],n=new Array(32768),r=0,a=0,s=e.length;r<t&&a<s;r++){var o=e[a++];switch(o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:n[r]=o;break;case 12:case 13:if(!(a<s))throw new Error("Unfinished UTF-8 octet sequence");n[r]=(31&o)<<6|63&e[a++];break;case 14:if(!(a+1<s))throw new Error("Unfinished UTF-8 octet sequence");n[r]=(15&o)<<12|(63&e[a++])<<6|63&e[a++];break;case 15:if(!(a+2<s))throw new Error("Unfinished UTF-8 octet sequence");var l=((7&o)<<18|(63&e[a++])<<12|(63&e[a++])<<6|63&e[a++])-65536;if(!(0<=l&&l<=1048575))throw new Error("Character outside valid Unicode range: 0x"+l.toString(16));n[r++]=l>>10&1023|55296,n[r]=1023&l|56320;break;default:throw new Error("Bad UTF-8 encoding 0x"+o.toString(16))}if(r>=32766){var u=r+1;n.length=u,i.push(String.fromCharCode.apply(String,n)),t-=u,r=-1}}return r>0&&(n.length=r,i.push(String.fromCharCode.apply(String,n))),i.join("")}(e,t)}function h(e){var t=e.length;if(0===t)return"";var i=n?e:function(e){for(var t=e.length,i=new Array(e.length),n=0;n<t;++n)i[n]=e[n];return i}(e);if(t<65535)return String.fromCharCode.apply(String,i);for(var r=32767&t,a=t>>15,s=new Array(r?a+1:a),o=0;o<a;++o)s[o]=String.fromCharCode.apply(String,i.subarray(o<<15,o+1<<15));return r&&(s[a]=String.fromCharCode.apply(String,i.subarray(a<<15,t))),s.join("")}function p(e,t){return"string"==typeof e&&(e=d(e)),"string"==typeof t&&(t=d(t)),void 0===e||null===e||0===e.length?e:a(function(e,t){var i,n,a,s,u,d,c=e.length,h=c-1;for(n=e[h],a=0,d=0|Math.floor(6+52/c);d>0;--d){for(s=(a=o(a+r))>>>2&3,u=0;u<h;++u)i=e[u+1],n=e[u]=o(e[u]+l(a,i,n,u,s,t));i=e[0],n=e[h]=o(e[h]+l(a,i,n,h,s,t))}return e}(s(e,!0),s(u(t),!1)),!1)}function f(e,t){return"string"==typeof e&&(e=function(e){for(var t=window.atob(e),i=t.length,n=new Uint8Array(i),r=0;r<i;r++)n[r]=t.charCodeAt(r);return n}(e)),"string"==typeof t&&(t=d(t)),void 0===e||null===e||0===e.length?e:a(function(e,t){var i,n,a,s,u,d=e.length,c=d-1;for(i=e[0],a=o(Math.floor(6+52/d)*r);0!==a;a=o(a-r)){for(s=a>>>2&3,u=c;u>0;--u)n=e[u-1],i=e[u]=o(e[u]-l(a,i,n,u,s,t));n=e[c],i=e[0]=o(e[0]-l(a,i,n,0,s,t))}return e}(s(e,!1),s(u(t),!1)),!0)}var v=Object.create(null,{toBytes:{value:d},toString:{value:c},encrypt:{value:p},encryptToString:{value:function(e,t){return window.btoa(h(p(e,t)))}},decrypt:{value:f},decryptToString:{value:function(e,t){return c(f(e,t))}}});t.default=v},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(i(0)),r=a(i(6));function a(e){return e&&e.__esModule?e:{default:e}}t.default={getLogId:function(){(0,r.default)({url:"//feedback.vrs.sohu.com/uploadLog.html",dataType:"json",type:"post",async:!1,data:{log:encodeURI(encodeURI(n.default.stringify()))}}).then(function(e){"success"==e.status&&e.data.logId?window.open("//feedback.vrs.sohu.com/feedback.html?type=q4&logId="+e.data.logId):window.open("//feedback.vrs.sohu.com/feedback.html?type=q4")}).catch(function(e){n.default.log("[\u4e3b\u64ad\u653e\u5668]exception feedback \u8bf7\u6c42\u5931\u8d25"+e),window.open("//feedback.vrs.sohu.com/feedback.html?type=q4")})}}},function(e,t,i){"use strict";function n(){}Object.defineProperty(t,"__esModule",{value:!0});var r={},a=window.document,s=/\/\.\//g,o=/([^:])\/+\//g,l=/\/[^/]+\/\.\.\//,u=/^[^:/]+:\/\//,d=/^(?:[a-zA-Z]+?:)?\/\/.+?/,c=/(\.[^.]+)(?=[?#]|$)/,h=a.head||a.getElementsByTagName("head")[0]||a.documentElement,p=function(e){return function(t){return{}.toString.call(t)=="[object "+e+"]"}},f=p("Object"),v=p("Function"),y=p("String");var m={events:{},on:function(e,t,i){if(e&&t){this.events[e]=this.events[e]||[];for(var n,r=this.events[e],a=r.length-1;a>=0;a--)if(r[a].h==t){n=!0;break}n||r.push({h:t,one:i})}},emit:function(e,t){if(e)for(var i,n,r=this.events[e]||[],a=0;a<r.length;)n=(i=r[a]).h,v(n)?n.call(null,t,e):f(n)&&v(n.handleEvent)&&n.handleEvent.call(n,e,t),i.one?r.splice(a,1):a++},one:function(e,t){this.on(e,t,!0)}};function g(e){var t,i=c.exec(e);return i&&(t=i[1]),t}var b={path:"//js.tv.itc.cn/"},_={},w={},k={},x={};function S(e){var t=x[e];return t||(t={path:e}),t}function E(e){for(e=e||"",d.test(e)||(e=b.path+"/"+e),e=e.replace(s,"/").replace(o,"$1/");l.test(e);)e=e.replace(l,"/");return u.test(e)||(e=document.location.protocol+e),e}function T(e,t){var i=a.createElement("link");i.type="text/css",i.rel="stylesheet",i.href=e,i.setAttribute("href",e),t&&(i.charset=t),h.insertBefore(i,h.firstChild)}function P(e,t,i){i=i||n;var r=a.createElement("script");function s(){r.onload=r.onreadystatechange=null,h.removeChild(r),r=null,i()}r.type="text/javascript",r.async=!0,t&&(r.charset=t),r.src=e,"onload"in r?r.onload=s:r.onreadystatechange=function(){/loaded|complete/.test(r.readyState)&&s()},h.insertBefore(r,h.firstChild)}function A(){var e=[].slice.call(arguments),t=n;v(e[e.length-1])&&(t=e.pop()),e.length?function e(t,i){i=i||n;var a=0;function s(){(a-=1)<=0&&i()}var o,l,u,d,c,h=0,p=t.length;if(t&&t.length){for(;h<p;h++)l=E((o=S(t[h])).path),u=o.requires,d=o.charset,"css"!=o.type&&".css"!=g(l)?_[l]||(a+=1,m.on(l,s),w[l]||(c=function(e,t){return function(){w[e]||_[e]||(w[e]=r,P(e,t,function(){delete w[e],_[e]=r,m.emit(e)}))}}(l,d),u&&u.length?e(u,c):c())):k[l]||(k[l]=r,T(l,o.charset));0==a&&s()}else i()}(e,t):t()}A.add=function(e,t){var i;y(e)&&(y(t)?i={path:t}:f(t)&&t.path&&(i=t),i&&(x[e]=i))},A.config=function(e){!function(e,t){if(e&&t)for(var i in t)e[i]=t[i]}(b,e)},t.default=A},function(e,t,i){"use strict";var n=function(e){return e&&e.__esModule?e:{default:e}}(i(34));i(115),window.playerFactory=n.default},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(i(35)),r=a(i(32));function a(e){return e&&e.__esModule?e:{default:e}}(0,r.default)(location.protocol+"//css.tv.itc.cn/player/player.css");try{for(var s,o=document.styleSheets,l=o.length,u=0,d=!1;u<l;u++)if((s=o[u]).href&&-1!=s.href.indexOf("css.tv.itc.cn/player/player.css")){d=!0;break}d||(0,r.default)("//css.tv.itc.cn/player/player.css")}catch(e){(0,r.default)("//css.tv.itc.cn/player/player.css")}var c={createPlayer:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.data=t.data||{},void 0===t.data.site&&(t.data.site=9001==t.data.cid?2:1),new n.default(e,t)}};t.default=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=x(i(0)),a=i(1),s=x(i(36)),o=x(i(37)),l=x(i(39)),u=x(i(40)),d=x(i(99)),c=x(i(103)),h=x(i(20)),p=x(i(4)),f=i(104),v=x(i(107)),y=x(i(32)),m=x(i(7)),g=x(i(16)),b=x(i(108)),_=x(i(112)),w=x(i(113)),k=i(12);function x(e){return e&&e.__esModule?e:{default:e}}var S=function(){},E={canplay:"onCanplay",canplaythrough:"onCanplaythrough",durationchange:"onDurationchange",emptied:"onEmptied",loadstart:"onLoadstart",ratechange:"onRatechange",seeked:"onSeeked",seeking:"onSeeking",suspend:"onSuspend",volumechange:"onVolumechange",waiting:"onWaiting",playing:"onPlaying",loadedmetadata:"onLoadedmetadata",timeupdate:"onTimeupdate",progress:"onProgress",pause:"onPause",play:"onPlay",abort:"onAbort"},T={};Object.keys(E).forEach(function(e){T[E[e]]=S});var P=1,A=function(e){function t(e,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));for(var r in n.selector=e,n.el=document.querySelector(n.selector),n.originalConfig=i,n.config=h.default.initConfig(i),n.config.autoplay=!0===n.config.autoplay||"true"===n.config.autoplay,n.pauseAdv=new k.PauseAdv(n),n.flogoAdv=new k.FlogoAdv(n),n.bandAdv=new k.BandAdv(n),n.ctrlAdv=new k.CtrlAdv(n),n.selectAdv=new k.SelectAdv(n),n.bgAdv=new k.BackgroundAdv(n),n.adPod=new k.AdPod(n),n.ui=new u.default(n,n.config),n.statis=new o.default(n),n.qs=new l.default(n),n.playList=new b.default(n,{pagesize:20,disablePlaylist:n.config.disablePlaylist}),n.playerCache=new _.default(n),n.playRecord=new w.default(n),n.uuid=p.default.createUUID(),p.default.extend(n,{willplayEventEmited:!1,showFeeTipEventEmited:!1,skipEndEventEmited:!1,loadBgAdEventEmited:!1,showBgAdEventEmited:!1,state:P,adKernels:[]}),E){var a=E[r];n[a]=n[a].bind(n)}return n.onEnded=n.onEnded.bind(n),n.onError=n.onError.bind(n),n.init(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.EventEmitter),n(t,[{key:"init",value:function(){var e=this;r.default.log("[\u4e3b\u64ad\u653e\u5668]========H5\u64ad\u653e\u5668log\u5f00\u59cb==========="),this.emit("player.init"),this.videoWrap=this.el.querySelector(".x-video"),this.video=this.el.querySelector("video"),this.p2pkernel=new f.P2PKernel,this.p2pkernel.initialize(this.video,"h5_pc",!0),r.default.log("[\u4e3b\u64ad\u653e\u5668]==p2p=="+f.P2PKernel.VERSION),this.resolutionKernel=null,this.initEvent();var t=this.config.list||[],i=this.config.data;i||t&&t.length&&(i=t[0]),this.videoData=i,this.isSelect=!1,this.currentRate=1;var n=!1;this.storage={};var a=setTimeout(function(){i&&(e.doPlay(i),n=!0)},2e3);this.one("localstorage.ok",function(){n||(clearTimeout(a),i&&e.doPlay(i))}),this.config.pjax&&history.replaceState(this.videoData,null),this.seekTime=parseInt(document.location.href.split("#")[1])||0,this.seekTimeFirst=!0}},{key:"initVolume",value:function(){var e=this.getSavedVolume();e=null==e?.5:e,this.config.isMute&&(e=0),this.volume=e,this.emit("volumechange")}},{key:"initEvent",value:function(){var e=this;this.addVideoEventListeners(),this.addKernelEventListeners(),this.on("ended",function(){e.playList.next()?e.playNext():(e.reset(),e.emit("list.ended"),0!=e.config.data.showRecommend&&e.emit("showrec"))}),this.on("timeupdate",function(){if(3==e.state){var t=e.currentTime,i=e.duration;0!=e.storage.skip_e&&0!=e.dataModel.eT&&t>=e.dataModel.eT&&!e.skipEndEventEmited&&(e.skipEndEventEmited=!0,e.onEnded()),(i-t<10||0!=e.storage.skip_e&&0!=e.dataModel.eT&&e.dataModel.eT-t<10)&&e.playList.hasNext()&&e.config.disablePlaylist?e.willplayEventEmited||(e.willplayEventEmited=!0,e.emit("willplay",e.playList.next())):(e.willplayEventEmited=!1,e.emit("exitWillplay")),e.dataModel.pay_data!={}&&e.dataModel.previewTime>0&&(t>1&&!e.showFeeTipEventEmited&&(e.showFeeTipEventEmited=!0,e.emit("feeTipShow",e.dataModel.previewTime)),(t>=e.dataModel.previewTime||Math.abs(t-e.dataModel.previewTime)<2)&&setTimeout(function(){window.tryPlayOver(1)},1e3));var n=function(){for(var i,n,r=0;i=e.dataModel.adpo[r++];)if((n=Math.round(i.s-t))>=0&&n<=10)return{item:i,distance:n,index:r};return{}}(),a=n.item,s=n.distance,o=n.index;a?s<=10&&s>4?(e.adPod.__lock=!1,e.adPod.__time=a.s,e.adPod.type=e.adPod.MID_ROLL,e.adPod.loadData({index:o,count:e.dataModel.adpo.length,ptime:a.s})):s<=4&&s>=0?e.adPod.type!=e.adPod.MID_ROLL||e.adPod.isEmpty()||e.adPod.__time!=a.s?(e.cancelRequestPodAD(),0==s&&e.emit("adv.ended")):(e.adPod.__lock||(e.adPod.__lock=!0,e.emit("adv.lock")),0==s&&(r.default.log("[\u5e7f\u544a]============\u64ad\u653e\u4e2d\u63d2\u5e7f\u544a=========="),e.startPlayAD())):e.adPod.__lock=!1:e.adPod.__lock=!1;var l=function(){for(var i,n,r=0;i=e.dataModel.bandpo[r++];)if((n=Math.round(i.band_t-t))>=0&&n<=10)return{item1:i,distance1:n};return{}}(),u=l.item1,d=l.distance1;u&&(d<=5&&d>=3?e.bandAdv.loadData({ptime:u.band_t}):d<3&&d>=0&&0==d&&u.band_t>4&&e.emit("adv.band.start",e.bandAdv.ads)),!((e.dataModel.eT>0&&0!=e.storage.skip_e?e.dataModel.eT:i)-t>40&&(e.dataModel.eT>0&&0!=e.storage.skip_e?e.dataModel.eT:i)-t<120)||e.dataModel.vr&&0!=e.dataModel.vr||e.loadBgAdEventEmited||(e.loadBgAdEventEmited=!0,e.bgAdv.loadData()),e.width>=540&&e.height>=300&&e.dataModel&&0==e.dataModel.myTvRotate&&1==e.currentRate&&1!=g.default.vipuser&&(!e.dataModel.vr||0==e.dataModel.vr)&&e.bgAdv.hasAd&&e.loadBgAdEventEmited&&((e.dataModel.eT>0&&0!=e.storage.skip_e?e.dataModel.eT:i)-t<e.bgAdv.bgAdDuration&&!e.showBgAdEventEmited&&(e.showBgAdEventEmited=!0,e.emit("adv.bgad.start",e.bgAdv.ads)),(e.dataModel.eT>0?e.dataModel.eT:i)-t>e.bgAdv.bgAdDuration&&e.showBgAdEventEmited&&(e.showBgAdEventEmited=!1,e.emit("adv.bgad.hide")))}}),this.on("exitFullscreen",function(){}),window.addEventListener("resize",function(){return e.emit("resize")},!1),window.addEventListener("popstate",function(t){return e.onPopstate(t)},!1),this.adPod.on("loaded",function(t){return e.onAdLoaded({ads:t})}),this.adPod.on("timeout",function(t){return e.onAdLoaded({e:t})}),this.adPod.on("load.error",function(t){return e.onAdLoaded({e:t})}),this.on("adv.seg.ended",function(){for(var t,i=0;t=e.adKernels[i];i++){var n=t,a=n.video,s=n.kernel;if(n.isPlaying){t.isPlaying=!1,delete t.isPlaying,e.removeVideoEventListeners(a),e.removeKernelEventListeners(s);try{s.close()}catch(e){r.default.error("[\u5e7f\u544a]close ad kernel error--\x3e",e)}t.video=null,t.kernel=null;break}}setTimeout(function(){return e.playNextAd()},0)}),this.on("adv.ended",function(){return e.onAdvEnded()}),this.ui.on("adv.linear.click",function(t){var i=t.index,n=t.evt;return e.emit("adv.linear.click",{index:i,evt:n})}),this.ui.on("adv.skipoad.click",function(){return e.skipAds()}),this.ui.on("cancleMute",function(){e.video.muted=!1}),this.ui.on("loaded",function(){return e.onAdLoaded()}),this.ui.on("adv.select.clickOne",function(t){e.isSelect=!0,e.selectAds=t.ads,e.onAdLoaded(),e.emit("adv.select.clickOne",t)}),this.ui.on("pwd-submit",function(t){e.config.data.pwd=t,e.doPlay(e.config.data)}),this.initPauseAdEvent(),this.initFlogoAdEvent(),this.initBandAdEvent(),this.initCtrlAdEvent(),this.initBgAdEvent()}},{key:"initPauseAdEvent",value:function(){var e=this;this.ui.on("pause.nonlinear.end",function(){return e.emit("pause.nonlinear.end")}),this.ui.on("pause.nonlinear.click",function(){return e.emit("pause.nonlinear.click")}),this.pauseAdv.on("loaded",function(t){!e.pauseAdv.isEmpty()&&e.paused&&3===e.state&&e.emit("pause.nonlinear.start",t)})}},{key:"initBandAdEvent",value:function(){var e=this;this.bandAdv.on("autohide",function(){return e.emit("adv.band.autohide")}),this.ui.on("adv.band.click",function(){return e.emit("adv.band.click")})}},{key:"initFlogoAdEvent",value:function(){var e=this;this.flogoAdv.on("display",function(t){3===e.state&&e.emit("adv.flogo.start",t)}),this.flogoAdv.on("autohide",function(){return e.emit("adv.flogo.autohide")}),this.ui.on("adv.flogo.close",function(){return e.emit("adv.flogo.end")}),this.ui.on("adv.flogo.click",function(){return e.emit("adv.flogo.click")})}},{key:"initCtrlAdEvent",value:function(){var e=this;this.ctrlAdv.on("display",function(t){return e.emit("adv.ctrlAd.show",t)}),this.ui.on("adv.ctrlAd.click",function(){return e.emit("adv.ctrlAd.click")})}},{key:"initBgAdEvent",value:function(){var e=this;this.ui.on("adv.bgAd.click",function(){return e.emit("adv.bgAd.click")})}},{key:"addVideoEventListeners",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.video;for(var t in E){var i=E[t];e.addEventListener(t,this[i],!1)}}},{key:"removeVideoEventListeners",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.video;for(var t in E){var i=E[t];e.removeEventListener(t,this[i],!1)}e.removeEventListener("ended",this.onEnded,!1)}},{key:"addKernelEventListeners",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.p2pkernel;e.on("ended",this.onEnded),e.on("error",this.onError)}},{key:"removeKernelEventListeners",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.p2pkernel;e.off("ended",this.onEnded),e.off("error",this.onError)}},{key:"doPlay",value:function(e){var t=this;if(null!=this.adKernels&&this.adKernels.length>0){for(var i,n=0;i=this.adKernels[n];n++){var a=i.kernel;try{a.close()}catch(e){r.default.error("close ad kernel error--\x3e",e)}this.adKernels=[]}this.onEnded()}this.reset(),this.initVolume(),e.resolution=this.getSavedResolution(),this.videoData=e;try{this.p2pkernel&&(this.p2pkernel.close(),this.p2pkernel.initialize(this.video,"h5_pc",!0))}catch(e){r.default.error("[\u4e3b\u64ad\u653e\u5668]init p2p565"+e)}this.emit("data.loading"),s.default.playerLoadMediaDataStartTime=Date.now(),d.default.loadData(e).then(function(e){s.default.playerLoadMediaDataEndTime=Date.now(),r.default.log("[\u4e3b\u64ad\u653e\u5668]\u89c6\u9891\u6570\u636e\u83b7\u53d6\u5b8c\u6210, \u8017\u65f6---\x3e"+(s.default.playerLoadMediaDataEndTime-s.default.playerLoadMediaDataStartTime)/1e3),t.emit("data.loaded"),200==e.code?(t.dataModel=new c.default(t,e.vdata),r.default.log("[\u4e3b\u64ad\u653e\u5668]config"+JSON.stringify(t.config)+"&pageurl:"+escape(escape(location.href))+"&uuid:"+t.uuid+"&os:"+navigator.userAgent),r.default.log("[\u4e3b\u64ad\u653e\u5668]====================\u89c6\u9891\u4fe1\u606fjson\u5f00\u59cb====================="),r.default.log(t.dataModel),r.default.log("[\u4e3b\u64ad\u653e\u5668]====================\u89c6\u9891\u4fe1\u606fjson\u7ed3\u675f====================="),r.default.log("===\u662f\u5426\u662fdrm\u89c6\u9891==="+t.dataModel.isDrm),t.videoData.resolution=t.dataModel.resolution,t.p2pkernel.play(p.default.extend({},t.dataModel.data,{isPause:!0,uid:g.default.uid})),r.default.log("[\u4e3b\u64ad\u653e\u5668]\u8c03\u7528\u4e86play\u5e76\u6682\u505c"+t.config.autoplay),t.config.autoplay&&(r.default.log("[\u4e3b\u64ad\u653e\u5668]\u81ea\u52a8\u64ad\u653e\uff0c\u53bbplay"),t.play()),t.dataModel.vr&&0!=t.dataModel.vr&&(t.vr?t.vr.reset():(0,y.default)("player/three_6b40da.js",function(){return t.vr=new v.default(t)})),t.emit("data.ok",t.dataModel)):(t.emit("data.exception",e),102==e.code&&t.isFullscreen()&&t.exitFullscreen())}),this.emit("playvideo",this.videoData)}},{key:"onPopstate",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).state;e&&e.vid&&(this.reset(),this.doPlay(e))}},{key:"onLoadedmetadata",value:function(){this.emit("loadedmetadata")}},{key:"onWaiting",value:function(){this.emit("waiting")}},{key:"onPlaying",value:function(){this.emit("playing")}},{key:"onTimeupdate",value:function(){this.emit("timeupdate")}},{key:"onPlay",value:function(){this.emit("play")}},{key:"onPause",value:function(){var e,t=0,i=!1;if(2==this.state)for(;e=this.adKernels[t];t++){var n=e,r=n.video;if(n.isPlaying){r.duration-r.currentTime<=.01&&(i=!0);break}}i||this.emit("pause")}},{key:"onVolumechange",value:function(e){this.emit("volumechange",e)}},{key:"onSeeked",value:function(){this.emit("seeked")}},{key:"onEnded",value:function(){r.default.log("[\u4e3b\u64ad\u653e\u5668]ended--\x3e",Date.now()),2==this.state?this.emit("adv.seg.ended"):(this.movieEnded=!0,this.emit("movie.ended"),this.adPod.type=this.adPod.POST_ROLL,this.adPod.isEmpty()?this.emit("adv.ended"):this.startPlayAD())}},{key:"onError",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(r.default.error("[\u4e3b\u64ad\u653e\u5668]receive from p2p errorCode=="+t.code),903!=Number(t.code))this.emit("error",t);else{var i=this.currentTime;if(this.p2pkernel){this.p2pkernel.close(),this.p2pkernel.initialize(this.video,"h5_pc",!0),this.dataModel.data.iswebp2p=0,this.p2pkernel.play(p.default.extend({},this.dataModel.data,{uid:g.default.uid}));this.video.addEventListener("playing",function t(){e.video.removeEventListener("playing",t,!1),e.p2pkernel.seek(i),2===e.state&&e.video.pause()},!1)}}}},{key:"onAbort",value:function(){this.emit("abort")}},{key:"playByData",value:function(e){if(e){var t=e.url;t&&this.config.pjax&&function(e){var t=document.createElement("a");return t.href=e,t.hostname==document.location.hostname}()&&history.pushState(e,e.title||"",t),this.reset(),this.doPlay(e)}}},{key:"onAdLoaded",value:function(e){var t=this;if(this.emit("adv.dataok"),e&&e.e)return setTimeout(function(){return t.emit("adv.ended")},0);e&&e.ads&&e.ads.length>0?setTimeout(function(){return t.emit("adv.select.show",e.ads)},0):this.adPod.type===this.adPod.PRE_ROLL&&(this.startPlayAD(),setTimeout(function(){return t.emit("pre.vast.loaded",t.adPod.vast)},0))}},{key:"cancelRequestPodAD",value:function(){this.adPod.__time=null,this.adPod.cancel()}},{key:"startPlayAD",value:function(){var e=this;this.state=2,this.video.pause();var t=0;this.isSelect&&(t=(0,k.getLinearDuration)(this.selectAds[0])),this.emit("adv.start",t);try{for(var i=this.isSelect?this.selectAds:this.adPod.ads,n=!1,a=function(t){if(o=i[t],l=(0,k.getLinearCreative)(o),u=(0,k.getLinearDuration)(o),l&&u){d=document.createElement("video"),c=new f.ADKernel,d.volume=e.config.isMute?0:.5;var a=(0,k.getLinearMedia)(l);h=a.media,p=a.index,r.default.log("[\u5e7f\u544a]"+o["@attr"].master+"\u7684\u5730\u5740==="+h["@value"]+"\u5e7f\u544a\u65f6\u957f::"+u),c.addEventListener("loadAdError",function(){r.default.log("[\u5e7f\u544a]\u7b2c"+t+"\u6761\u5e7f\u544a\u52a0\u8f7d\u5931\u8d25"),e.adKernels[t].state=!1,t==e.adIndex&&e.emit("adv.seg.ended")}),c.download(d,{url:h["@value"],duration:u}),e.adKernels[t]={video:d,kernel:c,mediaIndex:p,duration:u,state:!0}}else e.adKernels[t]={video:null,kernel:null,duration:0,state:!1};e.adKernels[t].state&&!n&&(n=!0,e.playNextAd())},s=0;s<i.length;s++){var o,l,u,d,c,h,p;a(s)}}catch(t){r.default.error("[\u5e7f\u544a]pod ad error--\x3e",t),setTimeout(function(){return e.emit("adv.ended")},0)}n||this.playNextAd()}},{key:"playNextAd",value:function(){for(var e=0,t=this.adKernels.length;e<t&&null==this.adKernels[e].kernel;e++);if(e>=t)this.emit("adv.ended");else{this.adKernels[e].isPlaying=!0;var i=this.adKernels[e],n=i.video,a=i.kernel;this.addVideoEventListeners(n),this.addKernelEventListeners(a),n.addEventListener("ended",this.onEnded,!1),this.emit("adv.seg.start",{index:e,video:n,data:this.isSelect?this.selectAds[0]:this.adPod.getDataByIndex(e)}),this.adKernels[e].state?a.play():this.emit("adv.seg.ended"),this.adIndex=e,r.default.log("[\u5e7f\u544a]playad index="+e),this.emit("volumechange")}}},{key:"onAdvEnded",value:function(){var e=this;if(r.default.log("[\u5e7f\u544a]===\u6240\u6709\u5e7f\u544a\u7ed3\u675f==="),this.adKernels=[],this.movieEnded)this.emit("ended");else if(2===this.state){this.isSelect=!1,this.state=3;try{this.playerCache.setLocalStorage({__shtvid__:this.dataModel.tvid+"@"+Date.now()})}catch(e){r.default.error("localStorage error"+e)}if(this.seekTime>0&&this.seekTimeFirst){var t=navigator.userAgent.toLowerCase();t.indexOf("safari")>=0&&t.indexOf("chrome")<0?setTimeout(function(){e.seek(e.seekTime),e.seekTimeFirst=!1},1e3):(this.seek(this.seekTime),this.seekTimeFirst=!1)}this.p2pkernel.play(),r.default.log("[\u4e3b\u64ad\u653e\u5668]\u5e7f\u544a\u7ed3\u675f\u8c03\u7528\u4e86play"),this.emit("player.playp2p"),setTimeout(function(){e.changeShape(e.dataModel.myTvRotate,e.dataModel.myTvSize)},300),!this.dataModel.isUgcFeeVideo||this.dataModel.isUgcPreview||this.showFeeTipEventEmited||1==this.dataModel.isSelf||this.ui.dashTip.show({s:"\u8be5\u89c6\u9891\u4e3a\u4ed8\u8d39\u89c6\u9891\uff0c\u60a8\u5df2\u8d2d\u4e70\u53ef\u5b8c\u6574\u89c2\u770b",time:1e4}),this.p2pkernel.on("playError",function(t){0==t&&(r.default.error("[\u4e3b\u64ad\u653e\u5668]\u64ad\u653e\u6b63\u7247\u89e6\u53d1\u6d4f\u89c8\u5668\u64ad\u653e\u7b56\u7565\uff0c\u88ab\u9759\u97f3\uff0cplayError="+t),e.volume=0,e.ui.showVolumeBezel())}),this.emit("volumechange")}}},{key:"skipAds",value:function(){this.emit("adv.skip"),this.emit("adv.seg.ended",1)}},{key:"playNext",value:function(){if(r.default.log("[\u4e3b\u64ad\u653e\u5668]playNext"+this.adKernels),null!=this.adKernels&&this.adKernels.length>0){for(var e,t=0;e=this.adKernels[t];t++){var i=e.kernel;try{i.close()}catch(e){r.default.error("[\u4e3b\u64ad\u653e\u5668]close ad kernel error--\x3e",e)}this.adKernels=[]}this.onEnded()}this.reset(),this.state=3;var n=this.playList.next();n&&(this.playByData(n),this.video.playbackRate=1,this.currentRate=1,this.emit("switchState"))}},{key:"play",value:function(e){var t=this;if(e)this.playByData();else if(this.dataModel&&(3===this.state?(this.p2pkernel.play(),r.default.log("[\u4e3b\u64ad\u653e\u5668]play\u65b9\u6cd5\u8c03\u7528\u4e86play"),setTimeout(function(){t.changeShape(t.dataModel.myTvRotate,t.dataModel.myTvSize)},300)):2!==this.state&&(this.state=2,this.adPod.type=this.adPod.PRE_ROLL,this.emit("adv.ready"),this.adPod.loadData(),this.emit("adv.loading")),2===this.state&&this.adKernels.length))for(var i,n=0;i=(a=this.adKernels[n]).kernel,a;n++){var a;if(i){i.play(),i.on("playAdError",function(e){r.default.error("[\u5e7f\u544a]playAdError="+e),0==e&&(t.volume=0,t.ui.showVolumeBezel())});break}}}},{key:"replay",value:function(){this.p2pkernel&&(this.p2pkernel.close(),this.p2pkernel.initialize(this.video,"h5_pc",!0),this.p2pkernel.play(p.default.extend({},this.dataModel.data,{isPause:!0,uid:g.default.uid})),r.default.log("[\u4e3b\u64ad\u653e\u5668]replay\u4e2d\u8c03\u7528\u4e86play")),this.seek(0)}},{key:"pause",value:function(){2==this.state?this.adKernels.forEach(function(e){var t=e.video;return t&&t.pause()}):this.p2pkernel.pause()}},{key:"playOrPause",value:function(){this.paused?this.play():this.pause()}},{key:"saveResolution",value:function(e){try{this.playerCache.setLocalStorage({sh_rsl:e})}catch(t){(0,m.default)("sh_rsl",e,{path:"/",expires:100})}}},{key:"getSavedResolution",value:function(){var e=null;try{e=this.storage.sh_rsl}catch(t){e=(0,m.default)("sh_rsl")}return e}},{key:"saveVolume",value:function(e){try{this.playerCache.setLocalStorage({sh_volume:e})}catch(t){(0,m.default)("sh_volume",e,{path:"/",expires:100})}}},{key:"getSavedVolume",value:function(){var e=null;try{e=this.storage.sh_volume}catch(t){e=(0,m.default)("sh_volume")}return e}},{key:"addVolume",value:function(e){void 0!==e&&(e=parseFloat(e),isNaN(e)||(e=this.volume+e,this.volume=e))}},{key:"switchPlayrate",value:function(e){this.video.playbackRate=e,this.currentRate=e}},{key:"switchResolution",value:function(e){var t=this,i=this.dataModel;if(i.hasResolution(e)&&i.resolution!=e){r.default.log("[\u4e3b\u64ad\u653e\u5668]\u5f00\u59cb\u5207\u6362\u6e05\u6670\u5ea6--\x3e",e),this.resolutionKernel&&(this.resolutionKernel.close(),this.resolutionKernel=null);var n=p.default.extend({},{resolution:e,suspend:!0,orifee:i.orifee,aid:i.plid,tvid:i.tvid},this.videoData);d.default.loadData(n,!0).then(function(i){if(n.vid==t.videoData.vid)if(200==i.code){t.saveResolution(e);var a=document.createElement("video");a.volume=0,a.id=Date.now(),t.resolutionKernel=new f.P2PKernel;var s=t.resolutionKernel;s.initialize(a,"h5_pc",!0);var o=new c.default(t,i.vdata);s.play(p.default.extend({},o.data,{uid:g.default.uid})),r.default.log("[\u4e3b\u64ad\u653e\u5668]\u8c03\u7528\u4e86play");a.addEventListener("playing",function e(){if(a.removeEventListener("playing",e,!1),n.vid!=t.videoData.vid)return s.close(),void(s=null);s.seek(t.currentTime)},!1),s.one("seeked",function(){if(n.vid!=t.videoData.vid)return s.close(),void(s=null);r.default.log("[\u4e3b\u64ad\u653e\u5668]\u6e05\u6670\u5ea6\u5207\u6362\u5b8c\u6210--\x3e",e),t.videoWrap.replaceChild(a,t.video),a.volume=t.volume,t.removeVideoEventListeners(),t.removeKernelEventListeners(),t.video=null,t.p2pkernel.close(),t.p2pkernel=s,t.video=a,t.dataModel=o,t.addVideoEventListeners(),t.addKernelEventListeners(),t.resolutionKernel=null,3===t.state&&(t.emit("resolution.switched",e),t.video.playbackRate=t.currentRate||1,t.emit("play")),2===t.state&&t.video.pause()}),t.emit("switch.data.ok",i)}else r.default.error("[\u4e3b\u64ad\u653e\u5668]\u8bf7\u6c42\u6570\u636e\u5931\u8d25--\x3e",i.code),t.emit("resolution.to.dmstate"),t.emit("data.exception",i)}),this.emit("resolution.switching",e)}}},{key:"requestFullscreen",value:function(){var e=this.el.querySelector(".x-player");if(e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen(),this.emit("resize"),this.dataModel.myTvRotate&&0!=this.dataModel.myTvRotate||1!=this.dataModel.myTvSize)var t=0,i=this,n=setInterval(function(){5===(t+=1)&&clearInterval(n),i.changeShape(i.dataModel.myTvRotate,i.dataModel.myTvSize)},500)}},{key:"exitFullscreen",value:function(){if(document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():document.cancelFullScreen&&document.cancelFullScreen(),this.emit("exitFullscreen"),this.emit("resize"),this.dataModel.myTvRotate&&0!=this.dataModel.myTvRotate||1!=this.dataModel.myTvSize)var e=0,t=this,i=setInterval(function(){5===(e+=1)&&clearInterval(i),t.changeShape(t.dataModel.myTvRotate,t.dataModel.myTvSize)},500)}},{key:"isFullscreen",value:function(){return(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)===this.el.querySelector(".x-player")}},{key:"resize",value:function(){!this.dataModel||0==this.dataModel.myTvRotate&&1==this.dataModel.myTvSize||this.changeShape(this.dataModel.myTvRotate,this.dataModel.myTvSize),this.emit("resize")}},{key:"isNavtiveFullscreen",value:function(){return!!this.video.webkitDisplayingFullscreen}},{key:"seek",value:function(e){2!==this.state&&((e/=1)<0||(e=Math.floor(Math.min(e,this.duration)),r.default.log("[\u4e3b\u64ad\u653e\u5668]seek--\x3e",e),this.p2pkernel.seek(e),this.play(),this.emit("seek",e)))}},{key:"seekBy",value:function(e){var t=this.currentTime;e=parseFloat(e),isNaN(t)||isNaN(e)||this.seek(t+e)}},{key:"getDMStat",value:function(){var e={};return this.p2pkernel&&(e=this.p2pkernel.getDMStat()),e}},{key:"reset",value:function(){this.uuid=p.default.createUUID(),this.willplayEventEmited=!1,this.showFeeTipEventEmited=!1,this.skipEndEventEmited=!1,this.loadBgAdEventEmited=!1,this.showBgAdEventEmited=!1,this.movieEnded=!1,this.state=P,this.adIndex=0,this.emit("reset")}},{key:"changeShape",value:function(e,t){this.dataModel.myTvRotate=e,this.dataModel.myTvSize=t;var i=Math.abs(e)/90%2;this.video.style.cssText=1==i?"transform:rotate("+e+"deg) scale("+t+");width:"+this.height+"px;height:"+this.width+"px;right:0;bottom:0;margin: auto;":"transform:rotate("+e+"deg) scale("+t+");"}},{key:"ctrlBarVisible",value:function(e){this.emit("player-state",e),r.default.log("[\u4e3b\u64ad\u653e\u5668]\u8ff7\u4f60\u5c0f\u7a97\u6a21\u5f0f\uff1a"+e)}},{key:"width",get:function(){return this.ui.width}},{key:"height",get:function(){return this.ui.height}},{key:"panelZlock",get:function(){return this.ui.panelZlock}},{key:"volume",set:function(e){void 0!==e&&(e=parseFloat(e),isNaN(e)||(e=Math.min(1,Math.max(e,0)),2==this.state?this.adKernels.forEach(function(t){var i=t.video;return i&&(i.volume=e)}):(this.video.volume=e,this.config.isMute&&0==e||(this.saveVolume(e),r.default.log("[\u4e3b\u64ad\u653e\u5668]\u4fdd\u5b58\u58f0\u97f3\u5230\u7f13\u5b58"+e)))))},get:function(){return this.currentVideo.volume}},{key:"clientIp",get:function(){return this.p2pkernel?this.p2pkernel.myPublicIP:""}},{key:"cdnIp",get:function(){return this.p2pkernel?this.p2pkernel.lastCdnIP:""}},{key:"dataModel",get:function(){return this._dataModel},set:function(e){this._dataModel=e}},{key:"seeking",get:function(){return this.currentVideo.seeking}},{key:"currentVideo",get:function(){var e=this.video;if(2===this.state)for(var t,i=0;t=this.adKernels[i];i++)if(t.isPlaying){e=t.video;break}return e}},{key:"videoCurrentTime",get:function(){return this.currentVideo.currentTime}},{key:"currentTime",get:function(){var e=this.video,t=0;if(2===this.state)for(var i,n=0;i=this.adKernels[n];n++){if(i.isPlaying){t+=i.video.currentTime;break}t+=i.duration}else t=e.currentTime||0;return t}},{key:"movieCurrentTime",get:function(){return this.video.currentTime}},{key:"duration",get:function(){return 2===this.state?this.adPod.duration||0:this.dataModel?this.dataModel.getDuration():0}},{key:"skipDuration",get:function(){if(2===this.state)var e=this.adPod.skipDuration||0;return e}},{key:"movieDuration",get:function(){return this.dataModel?this.dataModel.getDuration():0}},{key:"buffered",get:function(){var e=this.video.buffered,t=0;try{t=e.end(0)}catch(e){}return t}},{key:"paused",get:function(){return this.currentVideo.paused}},{key:"isMiniH5",get:function(){return 1==this.config.data.isMiniPlayer}},{key:"isHideTips",get:function(){return 0==this.config.data.showTipHistory}},{key:"outType",get:function(){var e=1,t=document.domain;return-1!=t.indexOf("sohu.com")?e=0:["56.com","focus.cn","chinaren.com"].some(function(e){return-1!=t.indexOf(e)})&&(e=2),e}}]),t}();t.default=A,p.default.applyIf(A.prototype,T),p.default.extend(A.prototype,{version:"1550456717176",p2pver:f.P2PKernel.VERSION,ua:"h5pc",STATE_INIT:P,STATE_ADV:2,STATE_MOIVE:3})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=c(i(7)),a=c(i(8)),s=c(i(3)),o=c(i(38)),l=c(i(16)),u=c(i(4)),d=c(i(17));function c(e){return e&&e.__esModule?e:{default:e}}var h=function(){};function p(e){if(e)for(var t=e.split("|"),i=0,n=t.length;i<n;i++)(new Image).src=t[i]}var f=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.player=t,this.config=i||{},this.realVVDone=!1,this.vvDone=!1,this.endedDone=!1,this.heartTime,this.bandwidthTimer=null,this.playedTime=[],this.heartCounter={},this.init()}return n(e,[{key:"init",value:function(){this.observPlayer()}},{key:"observPlayer",value:function(){var e=this;this.player.on("data.ok",function(){e.reset();var t=e.player.dataModel;e.heartTime=t.duration>180?30:10,e.stamp=Date.now(),e.vv()}),this.player.on("play",function(){e.vv()}),this.player.on("playing",function(){e.vv(),e.realVV(),e.startBandwidthPingback(),e.setStartTime()}),this.player.on("pause",function(){e.stopBandwidthPingback(),e.setEndTime()}),this.player.on("ended",function(){e.setEndTime(),e.endStatis(),e.reset()}),this.player.on("timeupdate",function(){e.heart()})}},{key:"setStartTime",value:function(){var e=this.playedTime[this.playedTime.length-1]||{};e.startTime&&!e.endTime||(!e.startTime||e.startTime&&e.endTime)&&(e={startTime:Date.now()},this.playedTime.push(e))}},{key:"setEndTime",value:function(){var e=this.playedTime[this.playedTime.length-1];e&&!e.endTime&&(e.endTime=Date.now())}},{key:"getPlayedTime",value:function(){var e=0,t=this.playedTime.length,i=this.playedTime[t-1];return this.playedTime.forEach(function(i,n){n!=t-1&&i.endTime&&(e+=i.endTime-i.startTime)}),i&&(i.endTime?e+=i.endTime-i.startTime:e+=Date.now()-i.startTime),e}},{key:"heart",value:function(){var e=0,t=this.playedTime.length,i=this.playedTime[t-1];if(i){this.playedTime.forEach(function(i,n){n!=t-1&&i.endTime&&(e+=i.endTime-i.startTime)}),e+=Date.now()-i.startTime,e=Math.round(e/1e3);var n=Math.floor(e/this.heartTime);n<=0||(e=n*this.heartTime,this.heartCounter[""+e]||(this.heartCounter[""+e]=h,this.dmHeartPing(e)))}}},{key:"dmHeartPing",value:function(e){var t=this.player.dataModel,i={fver:this.player.version,tc:e,passport:a.default.getPassport(),isHD:t.resolution,isp2p:o.default.p2p?1:0,cateid:t.areaid,sid:(0,r.default)("SUV"),heart:this.heartTime,playListId:t.plid,systype:1==t.site?0:1,t:Date.now(),td:Math.floor(t.duration),uid:l.default.uid,url:encodeURIComponent(location.href),vid:t.vid,tvid:t.tvid,atype:this.player.ua,lb:2==(0,r.default)("series_video")?2:0,uuid:this.player.uuid,catcode:t.catecode||"",autoplay:this.player.config.autoplay?1:0,refer:encodeURIComponent(document.referrer)};p("//pb.hd.sohu.com.cn/stats.gif?"+s.default.stringify(i))}},{key:"bandwidthPingback",value:function(){var e=this.player.dataModel,t=this.player.getDMStat();p("//pv.hd.sohu.com/p.gif?pid="+(e.pid||"")+"&playlistid="+e.plid+"&systype="+(1==e.site?0:1)+"&vid="+e.vid+"&p=&nid="+e.ch+"&cnt=&c="+(t.cdn||0)+"&t="+(t.total||0)+"&ua="+this.player.ua+"&uid="+l.default.uid+"&url="+encodeURIComponent(location.href)+"&uuid="+this.player.uuid+"&catcode="+(e.catecode||"")+"&isp2p="+(o.default.p2p?1:0)+"&_="+Date.now())}},{key:"startBandwidthPingback",value:function(){var e=this;this.bandwidthTimer||(this.bandwidthTimer=setInterval(function(){return e.bandwidthPingback()},3e4))}},{key:"stopBandwidthPingback",value:function(){clearInterval(this.bandwidthTimer),this.bandwidthTimer=null}},{key:"DMPingback",value:function(e){var t=this.player.dataModel,i=t.serverTime+Date.now()-this.stamp,n=t.vid,c=l.default.uid,h=(0,d.default)(""+n/1%127+c+i%127);e=u.default.extend({fver:this.player.version,isHD:t.resolution,playListId:t.plid,systype:1==t.site?0:1,heart:this.heartTime,t:i,ts:h,uid:c,vid:n,url:encodeURIComponent(location.href),tvid:t.tvid,areaid:t.areaid,ltype:t.ltype,refer:encodeURIComponent(document.referrer),sid:(0,r.default)("SUV"),uuid:this.player.uuid,td:Math.floor(t.duration),atype:this.player.ua,lb:2==(0,r.default)("series_video")?2:0,autoplay:this.player.config.autoplay?1:0,passport:a.default.getPassport(),catcode:t.catecode||"",isp2p:o.default.p2p?1:0,_:Date.now()},e),p("//pb.hd.sohu.com.cn/hdpb.gif?"+s.default.stringify(e))}},{key:"vv",value:function(){this.vvDone||(this.vvDone=!0,this.DMPingback({msg:"playCount",time:0}),p("//h11-"+this.player.dataModel.vid+".z1.irs01.com/?p=h11&ts="+Date.now()))}},{key:"realVV",value:function(){this.realVVDone||(this.realVVDone=!0,this.DMPingback({msg:"videoStart",time:0}))}},{key:"endStatis",value:function(){this.endedDone||(this.endedDone=!0,this.DMPingback({msg:"videoEnds",time:Math.floor(this.getPlayedTime()/1e3)}))}},{key:"reset",value:function(){this.realVVDone=!1,this.vvDone=!1,this.endedDone=!1,clearInterval(this.bandwidthTimer),this.bandwidthTimer=null,this.playedTime=[],this.heartCounter={}}}]),e}();t.default=f},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=!(!window.MediaSource&&!window.WebkitMediaSource),r=!!window.WebGLRenderingContext,a=!!(window.PeerConnection||window.webkitPeerConnection00||window.webkitRTCPeerConnection||window.mozRTCPeerConnection),s=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),o=a&&s,l={mse:n,webgl:r,PeerConnection:a,getUserMedia:s,webrtc:o,p2p:o};t.default=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=u(i(7)),a=u(i(3)),s=u(i(4)),o=u(i(25)),l=i(26);function u(e){return e&&e.__esModule?e:{default:e}}var d=(0,o.default)(function(e,t){e&&((new Image).src=e+a.default.stringify(t))})("//"+(Math.random()>.5?"qf1":"qf2")+".hd.sohu.com.cn/dov.do?"),c=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.player=t,this.config=i||{},this.setDefault(),this.observPlayer()}return n(e,[{key:"observPlayer",value:function(){var e=this;this.player.on("data.exception",function(t){e.allno+=1;var i=t.vdata,n=t.code;"201"==t.code&&(1==i.play&&2==i.status?n=502:1==i.play&&3==i.status?n=503:1==i.play&&4==i.status?n=504:1==i.play&&5==i.status&&(n=505)),e.ping({code:2,vvmark:0,error:n})}),this.player.on("timeupdate",function(){e.player.state!=e.player.STATE_MOIVE||e.vvDone||(e.vvDone=!0,e.ping({code:2,vvmark:1}))}),this.player.on("resolution.switched",function(){e.switchResolution=1,e.ping({code:2,vvmark:1})}),this.player.on("playing",function(){e.player.state==e.player.STATE_MOIVE&&(e.setStartTime(),e.playingTime||(e.playingTime=Date.now()))}),this.player.on("pause",function(){return e.setEndTime()}),this.player.on("movie.ended",function(){e.setEndTime(),e.reset()}),this.player.on("error",function(t){var i;e.allno+=1,700<=t.code&&t.code<800?(e.all700no+=1,i=3,e.all700no<3&&e.ping({code:i,error:t.code})):800<=t.code&&t.code<900?(e.all800no+=1,i=4,e.all800no<3&&e.ping({code:i,error:t.code})):900<=t.code&&t.code<1e3&&(i=96,e.ping({code:i,error:t.code}))}),this.player.on("waiting",function(){e.player.state==e.player.STATE_MOIVE&&e.playingTime&&(e.allbufno+=1,1==e.allbufno?e.ping({code:12,fbt:Math.ceil((Date.now()-e.playingTime)/1e3),bd:Math.ceil(e.player.currentTime)}):3==e.allbufno&&e.ping({code:5}))})}},{key:"ping",value:function(e){d(s.default.extend(e,this.params))}},{key:"setDefault",value:function(){s.default.extend(this,{vvDone:!1,playingTime:null,_playedTime:[],allbufno:0,allno:0,all700no:0,switchResolution:0})}},{key:"setStartTime",value:function(){var e=this._playedTime[this._playedTime.length-1]||{};e.startTime&&!e.endTime||(!e.startTime||e.startTime&&e.endTime)&&(e={startTime:Date.now()},this._playedTime.push(e))}},{key:"setEndTime",value:function(){var e=this._playedTime[this._playedTime.length-1];e&&!e.endTime&&(e.endTime=Date.now())}},{key:"reset",value:function(){this.setDefault()}},{key:"params",get:function(){var e=this.player.dataModel||{},t=this.player.getDMStat(),i=this.player.videoData;return{vid:i.vid,isHD:i.resolution,pid:i.plid,uid:(0,r.default)("fuid")||(0,r.default)("SUV")||s.default.createUUID(),sid:(0,r.default)("SUV"),cid:e.cid||"",uuid:this.player.uuid,dom:e&&e.data?e.data.videos[0].fileName:"",os:l.os.platform+l.os.version,allbufno:this.allbufno,allno:this.allno,drag:this.player.seeking?0:-1,fver:this.player.version,ref:document.referrer,isdl:1,node:t.cdn,cdnid:t.cdn,cdnip:this.player.cdnIp,seekto:this.switchResolution,all700no:this.all700no,clientIp:this.player.clientIp,totTime:this.player.movieDuration,caid:e.catecode||"",pt:45,vt:this.playedTime,type:1==i.site?"vrs":"my",isp2p:1,autoplay:this.player.config.autoplay?1:0,_:Date.now()}}},{key:"playedTime",get:function(){var e=0,t=this._playedTime.length,i=this._playedTime[t-1];return this._playedTime.forEach(function(i,n){n!=t-1&&i.endTime&&(e+=i.endTime-i.startTime)}),i&&(i.endTime?e+=i.endTime-i.startTime:e+=Date.now()-i.startTime),Math.ceil(e/1e3)}}]),e}();t.default=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=j(i(0)),a=i(1),s=j(i(2)),o=j(i(8)),l=j(i(18)),u=j(i(19)),d=j(i(41)),c=j(i(43)),h=j(i(44)),p=j(i(52)),f=j(i(53)),v=j(i(54)),y=j(i(55)),m=j(i(56)),g=j(i(57)),b=j(i(66)),_=j(i(67)),w=j(i(68)),k=j(i(69)),x=j(i(70)),S=j(i(71)),E=j(i(73)),T=j(i(74)),P=j(i(75)),A=j(i(76)),C=j(i(77)),D=j(i(78)),L=j(i(79)),B=j(i(80)),O=j(i(81)),M=j(i(82)),U=j(i(87)),I=j(i(88)),R=j(i(90)),F=j(i(91)),z=j(i(95)),N=j(i(98));function j(e){return e&&e.__esModule?e:{default:e}}var H,V=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(0,l.default)(parseInt(e),"mm:ss")},G=function(e){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.player=e,n.config=i,H=(0,u.default)(n.player),n.txidPing=H,n.el=n.player.el,n.tmpl=d.default,n.idleTimer=null,n.isFirstPlaying=!0,n.dashBoardHideTimer=null,n.isManualSeek=!1,n.lock=!1,n.eventDefaultState=!0,n.init(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.EventEmitter),n(t,[{key:"init",value:function(){var e=this;this.el.innerHTML=this.tmpl.render({config:this.config,version:this.player.version}),this.container=this.el.querySelector(".x-player"),this.elposter=this.el.querySelector(".x-poster"),this.elposterinner=this.el.querySelector(".x-poster-inner"),this.elCurrentTime=this.el.querySelector(".x-time-current"),this.elDurationTime=this.el.querySelector(".x-time-duration"),this.elTitle=this.el.querySelector(".x-title"),this.config.cover&&(this.elposter.style.backgroundImage="url("+this.config.cover+")",s.default.css(this.elposter,"display","block"),s.default.css(this.elposterinner,"display","none")),this.btnTip=new C.default(this),this.loadingUI=new D.default(this),this.dashBoard=new L.default(this),this.progressBar=new c.default(this),this.volumeBar=new h.default(this),this.clock=new p.default(this),this.resolutionPanel=new f.default(this),this.playRatePanel=new v.default(this),this.fullScreen=new y.default(this),this.recommend=new M.default(this),this.share=null,this.playRecordTip=new R.default(this),1==this.config.data.isShowDm&&(this.danmu=new F.default(this)),this.volumeBar.on("cancleMute",function(){return e.emit("cancleMute")}),this.progressBar.on("storyboard.willupdate",function(){return e.panelZlock=!0}),this.progressBar.on("storyboard.hide",function(){return e.panelZlock=!1}),this.selectAdvui=new m.default(this,this.config.data.isPlayPage),this.selectAdvui.on("select.finish",function(){return e.emit("loaded")}),this.selectAdvui.on("adv.select.clickOne",function(t){return e.emit("adv.select.clickOne",t)}),this.podAdvui=new g.default(this,this.config.data.isPlayPage),this.podAdvui.on("adv.linear.click",function(t){var i=t.index,n=t.evt;return e.emit("adv.linear.click",{index:i,evt:n})}),this.podAdvui.on("adv.skipoad.click",function(){return e.emit("adv.skipoad.click")}),this.pauseAdvui=new b.default(this),this.pauseAdvui.on("pause.nonlinear.end",function(){return e.emit("pause.nonlinear.end")}),this.pauseAdvui.on("pause.nonlinear.click",function(){return e.emit("pause.nonlinear.click")}),this.flogoAdvui=new _.default(this),this.flogoAdvui.on("adv.flogo.close",function(){return e.emit("adv.flogo.end")}),this.flogoAdvui.on("adv.flogo.click",function(){return e.emit("adv.flogo.click")}),this.bandAdvui=new w.default(this),this.bandAdvui.on("adv.band.click",function(){return e.emit("adv.band.click")}),this.ctrlAdui=new k.default(this),this.ctrlAdui.on("adv.ctrlAd.click",function(){return e.emit("adv.ctrlAd.click")}),this.backgroundAdvUI=new x.default(this),this.backgroundAdvUI.on("adv.bgAd.click",function(){return e.emit("adv.bgAd.click")}),this.ctxmenu=new S.default(this),this.vipPanelui=new E.default(this),this.vipPanelui.on("vip-panel-s",function(){return e.panelZlock=!0}),this.vipPanelui.on("vip-panel-c",function(){return e.panelZlock=!1}),this.playBtn=new T.default(this),this.nextBtn=new P.default(this),this.setBtn=new A.default(this,this.config.data.isPlayPage),this.dashBoard.on("show",function(){return e.emit("dashboard.show")}),this.dashBoard.on("hide",function(){e.resolutionPanel.hide(),e.btnTip.hide(),e.emit("dashboard.hide")}),this.dashTip=new B.default(this),this.bezel=new O.default(this),this.exceptionPanel=new I.default(this),this.exceptionPanel.on("pwd-submit",function(t){return e.emit("pwd-submit",t)}),this.interActionUi=new z.default(this),this.loggerui=new N.default(this),this.initEvent()}},{key:"initEvent",value:function(){var e=this;this.observePlayer();var t=function(){var e;return"onfullscreenchange"in document?e="fullscreenchange":"onwebkitfullscreenchange"in document?e="webkitfullscreenchange":"onmozfullscreenchange"in document?e="mozfullscreenchange":"msRequestFullscreen"in document&&(e="MSFullscreenChange"),e}();t&&document.addEventListener(t,function(t){return e.onfullscreenchange(t)}),this.container.addEventListener("mousedown",function(t){e.container.dataset.mousedownTime=Date.now(),e.container.dataset.mousedownClinetX=t.clientX,e.container.dataset.mousedownClientY=t.clientY},!1),this.container.addEventListener("mouseup",function(t){e.container.dataset.mouseupTime=Date.now(),e.container.dataset.mouseupClinetX=t.clientX,e.container.dataset.mouseupClientY=t.clientY},!1),this.container.addEventListener("click",function(t){if(t.stopPropagation(),!e.lock&&e.player.state!==e.player.STATE_ADV){var i=e.container.dataset.mousedownTime,n=e.container.dataset.mouseupTime,r=e.container.dataset.mousedownClinetX,a=e.container.dataset.mousedownClientY,s=e.container.dataset.mouseupClinetX,o=e.container.dataset.mouseupClientY;!i||!n||n/1-i/1>200||!r||!a||!s||!o||Math.abs(s/1-r/1)>30||Math.abs(o/1-a/1)>30||(e.container.dataset.clickcount=(e.container.dataset.clickcount||0)/1+1,e.container.dataset.clicktimer||(e.container.dataset.clicktimer=setTimeout(function(){clearTimeout(e.container.dataset.clicktimer),e.container.dataset.clicktimer&&delete e.container.dataset.clicktimer,e.container.focus(),e.container.dataset.clickcount/1==1&&(e.container.dataset.replay||(e.player.paused?H("pl_control_play_mouse"):H("pl_control_pause_mouse"),e.playOrPause())),e.container.dataset.clickcount=0},300)))}},!1),this.container.addEventListener("dblclick",function(t){t.stopPropagation(),e.player.isFullscreen()?(e.player.exitFullscreen(),H("pl_control_exitfullscreen_dclick")):(e.player.requestFullscreen(),H("pl_control_fullscreen_dclick"))},!1),this.container.addEventListener("keydown",function(t){t.stopPropagation(),e.eventDefaultState&&t.preventDefault(),32==t.keyCode?e.playOrPause():38==t.keyCode?(e.addVolume(.1),H("pl_control_upvolume_keyboard")):40==t.keyCode?(e.addVolume(-.1),H("pl_control_downvolume_keyboard")):37==t.keyCode?(e.seekBy(-20),H("pl_progressbar_barkward")):39==t.keyCode&&(e.seekBy(20),H("pl_progressbar_forward")),-1!=[38,40,37,39].indexOf(t.keyCode)&&e.activeUI()},!1),this.container.addEventListener("mouseenter",function(){e.dashBoard.show()},!1),this.container.addEventListener("mouseleave",function(){e.player.paused&&!e.player.isMiniH5||e.dashBoard.hide(),e.resolutionPanel.hide()},!1),this.container.addEventListener("mousemove",function(){e.activeUI()},!1),this.on("play.click",function(){return e.showBezel("\u64ad\u653e")}),this.on("pause.click",function(){return e.showBezel("\u6682\u505c")})}},{key:"observePlayer",value:function(){var e=this;this.player.on("playing",function(){return e.onPlaying()}),this.player.on("error",function(t){return e.onError(t)}),this.player.on("data.ok",function(){e.updateUI(),e.updateShare()}),this.player.on("timeupdate",function(){return e.onTimeupdate()}),this.player.on("seeked",function(){return e.onSeeked()}),this.player.on("pause",function(){return e.onPause()}),this.player.on("play",function(){return e.onPlay()}),this.player.on("reset",function(){return e.reset()}),this.player.on("seek",function(){e.updateTime()}),this.player.on("ended",function(){return e.onEnded()}),this.player.on("movie.ended",function(){var t=e.player.duration,i=e.player.currentTime;Math.abs(t-i)>=1&&H("pl_video_timelag"),e.elCurrentTime.innerHTML=e.elDurationTime.innerHTML}),this.player.on("willplay",function(t){e.dashTip.show({s:"\u5373\u5c06\u64ad\u653e\uff1a"+t.title+(0==e.player.outType&&1==e.player.dataModel.site?'\n      <div class="x-tip-btn x-tip-just-watch">\u7acb\u5373\u89c2\u770b</div>\n      ':""),type:"willplay"}),0==e.player.outType&&(e.justWatchBtn=e.container.querySelector(".x-tip-just-watch"),e.justWatchBtn.addEventListener("mousedown",function(t){t.stopPropagation(),e.player.playNext(),H("player_videonext_words")})),H("pl_playnext_show","impress")}),this.player.on("exitWillplay",function(){"willplay"==e.dashTip.type&&e.dashTip.hide()}),this.player.on("feeTipShow",function(t){e.barLock=!0,s.default.hide(e.elDragTime),e.isDragging=!1;var i,n='\n      <div class="x-tip-btn x-tip-just-play">\u7acb\u5373\u70b9\u64ad</div>\n      ';if(e.player.dataModel.isUgcPreview){var r=String(t%60);i="\u53ef\u514d\u8d39\u8bd5\u770b"+(String(Math.floor(t/60))+":"+(r.length<2?"0"+r:r))+'\uff0c\u8d2d\u4e70\u540e\u53ef\u5b8c\u6574\u89c2\u770b\uff0c\n      <div class="x-tip-btn x-tip-just-buy">\u7acb\u5373\u8d2d\u4e70</div>\n      ',""==o.default.getPassport()&&(i+='\u5982\u5df2\u8d2d\u4e70\u8bf7\n      <div class="x-tip-btn x-tip-just-login">\u767b\u5f55</div>\n      ')}else i=t>0&&t<=300?"\u60a8\u53ef\u4ee5\u8bd5\u770b5\u5206\u949f\uff0c\u70b9\u51fb\u89c2\u770b\u5b8c\u6574\u7248"+n:t>300&&t<=600?"\u60a8\u53ef\u4ee5\u8bd5\u770b10\u5206\u949f\uff0c\u70b9\u51fb\u89c2\u770b\u5b8c\u6574\u7248"+n:"\u60a8\u53ef\u4ee5\u8bd5\u770b"+Math.round(t/60)+"\u5206\u949f\uff0c\u70b9\u51fb\u89c2\u770b\u5b8c\u6574\u7248"+n;e.dashTip.show({s:i}),e.player.dataModel.isUgcPreview?(e.buyBtn=e.container.querySelector(".x-tip-just-buy"),e.buyBtn.addEventListener("mousedown",function(e){e.stopPropagation(),window.tryPlayOver(0)}),""==o.default.getPassport()&&(e.loginBtn=e.container.querySelector(".x-tip-just-login"),e.loginBtn.addEventListener("mousedown",function(e){e.stopPropagation(),window.sohuHD.showLoginWinbox()}))):(e.justPlayBtn=e.container.querySelector(".x-tip-just-play"),e.justPlayBtn.addEventListener("mousedown",function(t){t.stopPropagation(),window.open("//film.sohu.com/album/"+e.player.dataModel.plid+".html?channeled=1211040001")}))}),this.player.on("playvideo",function(){"willplay"==e.dashTip.type&&e.dashTip.hide()}),this.player.on("adv.lock",function(){e.lock=!0,e.dashTip.show({s:"\u4f11\u606f\u4e00\u4e0b\uff0c\u9a6c\u4e0a\u56de\u6765..."}),e.container.classList.add("x-state-lock"),s.default.hide(e.elDragTime),e.isDragging=!1}),this.player.on("adv.start",function(){e.updateState()}),this.player.on("adv.ended",function(){e.lock=!1,e.dashTip.hide()}),this.player.on("data.exception",function(){e.eventDefaultState=!1})}},{key:"addTipAbility",value:function(e,t){this.btnTip.addTipAbility(e,t)}},{key:"showBtnTip",value:function(e,t){this.btnTip.show(e,t)}},{key:"seek",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.isManualSeek=t,this.player.seek(e),this.container.dataset.replay&&(this.onPlay(),delete this.container.dataset.replay),H("pl_progressbar_seek")}},{key:"seekBy",value:function(e){this.isManualSeek=!0,this.player.seekBy(e)}},{key:"onfullscreenchange",value:function(){var e=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement,t=this.el.querySelector(".x-player");e==t?(t.classList.add("x-fs"),this.emit("fs")):null==e&&(t.classList.remove("x-fs"),this.emit("exitfs")),this.emit("fullscreenchange")}},{key:"replay",value:function(){this.progressBar.updatePlayedTrack(0),this.onPlay(),this.player.replay(),this.container.dataset.replay&&delete this.container.dataset.replay}},{key:"playOrPause",value:function(){var e=this.player;e.paused?(e.play(),this.emit("play.click")):(e.pause(),this.emit("pause.click"))}},{key:"playNextVideo",value:function(){this.player.playNext()}},{key:"activeUI",value:function(){var e=this;this.player.isFullscreen()&&this.dashBoard.show(),clearTimeout(this.container.dataset.activeendtimer),this.container.classList.remove("x-active-end"),this.container.dataset.activeendtimer=setTimeout(function(){e.container.classList.add("x-active-end"),e.player.isFullscreen()&&e.dashBoard.hide()},3e3)}},{key:"addVolume",value:function(e){this.player.addVolume(e),this.showVolumeBezel()}},{key:"showVolumeBezel",value:function(){var e=this.player.volume;0==(e=Math.min(100,(100*e).toFixed(0)))?this.showBezel2("\u9759\u97f3"):this.showBezel2("\u97f3\u91cf\uff1a"+e+"%")}},{key:"showBezel",value:function(e){this.bezel.show(e)}},{key:"showBezel2",value:function(e){this.bezel.show2(e)}},{key:"showLogPanel",value:function(){this.loggerui.show()}},{key:"isDashBoardDisplaying",value:function(){return this.dashBoard.isDisplaying()}},{key:"onTimeupdate",value:function(){this.player.state!==this.player.STATE_ADV&&this.updateTime(),this.isShowRecommend=!1}},{key:"onSeeked",value:function(){this.isManualSeek&&this.showBezel2(V(this.player.currentTime)),this.isManualSeek=!1}},{key:"onPlay",value:function(){this.updateState(),this.container.dataset.replay&&delete this.container.dataset.replay,this.emit("play")}},{key:"onPause",value:function(){this.emit("pause")}},{key:"onPlaying",value:function(){this.updateState(),s.default.hide(this.elposter),this.container.dataset.replay&&delete this.container.dataset.replay,this.emit("playing")}},{key:"updateState",value:function(){var e=this.player,t=this.container;e.state===e.STATE_INIT?t.classList.add("x-state-init"):t.classList.remove("x-state-init"),e.state===e.STATE_ADV?t.classList.add("x-state-ad"):t.classList.remove("x-state-ad"),e.state===e.STATE_MOIVE?t.classList.add("x-state-movie"):t.classList.remove("x-state-movie"),this.container.classList.remove("x-state-lock")}},{key:"updateTime",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player.currentTime,t=this.player.duration;e=Math.min(Math.round(e),t),this.elCurrentTime.innerHTML=V(e),this.elDurationTime.innerHTML=V(t)}},{key:"updateUI",value:function(){var e=this.player.movieDuration,t=this.player.dataModel;this.elDurationTime.innerHTML=V(e),this.elTitle.innerHTML=t.title,1==t.orifee?this.container.classList.add("x-ori-fee"):this.container.classList.remove("x-ori-fee"),s.default.show(this.elposter)}},{key:"onEnded",value:function(){this.elCurrentTime.innerHTML=this.elDurationTime.innerHTML,this.container.dataset.replay=1,this.isManualSeek=!1,this.emit("ended"),this.player.isMiniH5&&this.updateUI()}},{key:"onError",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r.default.error("[\u4e3b\u64ad\u653e\u5668]\u64ad\u653e\u5931\u8d25--\x3e",e)}},{key:"updateShare",value:function(){this.share=null,this.share=new U.default(this)}},{key:"reset",value:function(){this.panelZlock=!1,this.updateState()}},{key:"width",get:function(){return s.default.width(this.container)}},{key:"height",get:function(){return s.default.height(this.container)}},{key:"dashboardEl",get:function(){return this.dashBoard.el}}]),t}();t.default=G},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(i(5));var r={player:'<%@ h:helper %>\n    <div class="x-player" tabindex="-1">\n        <div class="x-adv-bg-panel">\n            <div class="x-adv-bg-inner"></div>\n            <span class="x-adv-hardflag">\u5e7f\u544a</span>\n        </div>\n        <div class="x-video">\n            <video></video>\n        </div>\n        <div class="x-video-adv"></div>\n        <div class="x-webgl-control"></div>\n        <div class="x-poster">\n            <div class="x-poster-inner"></div>\n        </div>\n        <div class="x-gradient-top"></div>\n        <div class="x-player-mask" style="display:none">\n            <div class="x-info-panel">\n                <div class="x-title"></div>\n                <div class="x-clock"></div>\n                <button class="x-fullscreen-btn2" data-title="\u9000\u51fa\u5168\u5c4f"></button>\n            </div>\n            <div class="x-gradient-bottom"></div>\n            <div class="x-adv-band-panel">\n                <div class="x-adv-band-inner"></div>\n                <span class="x-adv-hardflag">\u5e7f\u544a</span>\n            </div>\n            <div class="x-adv-flogo-panel">\n                <div class="x-adv-flogo-inner"></div>\n                <button class="x-adv-flogo-close-btn"></button>\n                <span class="x-adv-hardflag">\u5e7f\u544a</span>\n            </div>\n            <div class="x-adv-pause-nonlinear-panel">\n                <div class="x-adv-pause-nonlinear-inner"></div>\n                <button class="x-adv-pause-nonlinear-close-btn"></button>\n                <span class="x-adv-hardflag">\u5e7f\u544a</span>\n            </div>\n            <div class="x-adv-select-panel">\n            </div>\n            <div class="x-adv-linear-panel">\n                <a class="x-adv-linear-link" href="#" target="_blank">\n                    <span>\u4e86\u89e3\u8be6\u60c5 &gt;</span>\n                </a>\n                <div class="x-adv-linear-time-wrap">\n                    <span class="x-adv-linear-time-span"></span>\n                    <a class="x-adv-linear-campaign">\u53bb\u5e7f\u544a</a>\n                    <span class="x-adv-linear-skip-time-span"></span>\n                    <div class="x-adv-linear-skip">\u79d2\u540e\u8df3\u8fc7\u5e7f\u544a</div>\n                </div>\n            </div>\n            <div class="x-interact-panel"></div>\n            <div class="x-vip-panel">\n              <h3>\u5f00\u901a\u641c\u72d0\u89c6\u9891\u9ec4\u91d1\u4f1a\u5458\uff0c\u5c0a\u4eab\u66f4\u9ad8\u54c1\u8d28\u4f53\u9a8c\uff01</h3>\n              <p>1080P\u53ca\u4ee5\u4e0a\u753b\u8d28\u4ec5\u4e3a<a target="_blank" href="https://film.sohu.com/vip.html?channeled=120083">\u9ec4\u91d1\u4f1a\u5458\u4e13\u4eab></a></p>\n              <a class="x-vip-buy-btn" target="_blank" href="https://film.sohu.com/vip.html?channeled=120083">\u5f00\u901a/\u7eed\u8d39\u4f1a\u5458</a>\n              <button class="x-vip-close-btn"></button>\n            </div>\n            <div class="x-bezel">\u64ad\u653e</div>\n            <div class="x-bezel2"></div>\n            <div class="x-story-preview">\n              <div class="x-ep-panel-2"></div>\n              <div class="x-story-preview-bg">\n                <div class="x-story-preview-time"></div>\n              </div>\n            </div>\n            <div class="x-ep-panel-1"></div>\n            <div class="x-story-frame">\n              <div class="x-story-frame-img"></div>\n            </div>\n            <div class="x-storyboard">\n              <div class="x-storyboard-list"></div>\n              <div class="x-storyboard-hand">\n                <div class="x-storyboard-hand-bg">\n                  <div class="x-storyboard-hand-time"></div>\n                </div>\n              </div>\n            </div>\n            <div class="x-error-panel x-hide">\n              <div class="x-error-panel-content">\n                <div class="x-error-panel-icon"></div>\n                <p class="x-error-panel-title">\u62b1\u6b49\uff0c\u60a8\u89c2\u770b\u7684\u89c6\u9891\u52a0\u8f7d\u5931\u8d25</p>\n                <div class="x-error-panel-encrypt"></div>\n                <div class="x-error-panel-msg">\n                  <span class="x-error-panel-txt">\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5\u540e\u91cd\u8bd5\uff0c\u6709\u8bdd\u8981\u8bf4\uff1f\u8bf7\u70b9\u51fb</span>\n                  <a class="x-error-panel-feedback">\u6211\u8981\u53cd\u9988>></a>\n                </div>\n\n              </div>\n            </div>\n            <div class="x-dash-tip-panel">\n                <span class="x-dash-tip-span">\u6b63\u5728\u5207\u6362\u6e05\u6670\u5ea6...</span><button class="x-close-btn"></button>\n            </div>\n            <div class="x-tooltip">\u64ad\u653e</div>\n            <div class="x-dashboard">\n                <div class="x-drag-time">00:00</div>\n                <div class="x-progress-bar">\n                    <div class="x-progress-padding"></div>\n                    <div class="x-progress-list">\n                        <div class="x-progress-buffer-track"></div>\n                        <div class="x-progress-play-track"></div>\n                        <div class="x-progress-pointer"></div>\n                        <div class="x-progress-ep-list"></div>\n                    </div>\n                    <div class="x-seek-btn"></div>\n                </div>\n                <div class="x-progress-bar-ad">\n                    <div class="x-progress-play-track-ad"></div>\n                </div>\n                <div class="x-controls">\n                    <div class="x-controls-left">\n                        <button class="x-play-btn" data-title="\u64ad\u653e"></button>\n                        <div class="x-nextbtn-mask"></div>\n                        <button class="x-next-btn" data-title="\u4e0b\u4e00\u96c6"></button>\n                        <div class="x-time-display">\n                            <span class="x-time-current">00:00</span>\n                            <span class="x-time-separator"> / </span>\n                            <span class="x-time-duration">00:00</span>\n                        </div>\n                    </div>\n                    <div class="x-adv-ctrlBar-panel">\n                        <div class="x-adv-ctrlBar-inner"></div>\n                        <span class="x-adv-hardflag">\u5e7f\u544a</span>\n                    </div>\n                    <div class="x-controls-right">\n                        <button class="x-mute-btn" data-title="\u9759\u97f3"></button>\n                        <div class="x-volume-slider" data-title="\u97f3\u91cf">\n                            <div class="x-volume-handle"></div>\n                        </div>\n                        <button class="x-resolution-btn"></button>\n                        <button class="x-playrate-btn">\u500d\u901f</button>\n                        <button class="x-set-btn"></button>\n                        <button class="x-fullscreen-btn" data-title="\u5168\u5c4f"></button>\n                    </div>\n                </div>\n            </div>\n            <div class="x-resolution-panel"></div>\n            <div class="x-playrate-panel"></div>\n            <div class="x-set-panel"></div>\n            <div class="x-player-loading-panel">\n                <div class="x-player-loading"></div>\n            </div>\n            <div class="x-danmu-panel">\n                <div class="x-danmu-inner">\n                    <div class="x-danmu-box"></div>\n                    <div class="x-danmu-mouse-heart"></div>\n                </div>\n            </div>\n            <div class="x-share-mask"></div>\n            <div class="x-end-panel">\n                <div class="x-share-panel">\n                    <div class="x-share-btn">\u5206\u4eab</div>\n                </div>\n                <div class="x-recommend-panel">\n                    <ul class="x-recommend-inner"></ul>\n                </div>\n                <div class="x-share-inner"></div>\n            </div>\n            <div class="x-log-panel">\n            </div>\n        </div>\n    </div> '};t.default=new n.default(r.player)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,[{key:"dateFormat",value:function(e,t){"[object Date]"!={}.toString.call(e)&&(e=new Date(parseInt(e)));var i={"y+":e.getFullYear(),"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds()};for(var n in i)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,("00"+i[n]).substr(1+~RegExp.$1.length)));return t}},{key:"formatCount",value:function(e){var t=/(\d{1,3})(?=(\d{3})+(?:$|\.))/g;return e=e>=1e8?(e=Math.round(10*parseFloat(e/1e8))/10).toString().replace(t,"$1,")+"\u4ebf":e>=1e5?parseInt(e/1e4).toString().replace(t,"$1,")+"\u4e07":e.toString().replace(t,"$1,")}},{key:"timeFormat",value:function(e,t){e/=1;var i={"m+":Math.floor(e/60),"s+":e%60};for(var n in t=t.replace(/(m+)/,function(e,t){var n=t,r=(""+i["m+"]).length;return t&&r>t.length&&(n=new Array(r+1).join("m")),n}),i)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,("00"+i[n]).slice(1+~RegExp.$1.length)));return t}},{key:"truncate",value:function(e,t,i,n){return(e=e||"").length<=t?e:(e=e.substr(0,t),i&&(e+=n||"..."),e)}},{key:"truncateCN",value:function(e,t,i,n){e=e||"";var r=/[^\x00-\xff]/g;if(i=i||!1,n=n||"...",t>0&&e.replace(r,"mm").length>t)for(var a=Math.floor(t/2);a<e.length;a++)if(e.substr(0,a).replace(r,"mm").length>=t)return e.substr(0,a)+(i?n:"");return e}},{key:"numberGroup",value:function(e,t,i){if(e=e||"1234567345345.000",t=t||3,i=i||",",!/^(\+|-)?(\d+)(\.\d+)?$/.test(e=""+e))return e;for(var n=RegExp.$1,r=RegExp.$2,a=RegExp.$3,s=new RegExp("(\\d+)(\\d{"+t+"})("+i+"|$)");s.test(r);)r=r.replace(s,"$1"+i+"$2$3");return n+r+a}},{key:"escapeXSS",value:function(e){return(e||"").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(1),a=l(i(2)),s=l(i(18)),o=l(i(5));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(0,s.default)(parseInt(e),"mm:ss")},d=function(e,t,i,n,r){return c(r).then(function(r){var a=r.width,s=r.height;return{bgwidth:a*e/i,bgheight:s*t/n}})},c=function(){var e,t,i;return function(n){return new Promise(function(r){if(n&&n==e)r({width:t,height:i});else{e=n;var a=new Image;a.onload=function(){t=a.naturalWidth,i=a.naturalHeight,r({width:t,height:i})},a.src=n}})}}(),h=function(e,t,i,n){var r=Math.max(0,Math.ceil(e/t)-1);return{left:-r%50*i,top:-Math.floor(r/50)*n,index:r}},p=function(e,t,i){return{left:-e%50*t,top:-Math.floor(e/50)*i}},f=new o.default('\n<%@ h:helper %>\n<div class="x-storyboard-item"\n  style="width:<%= width %>px; height: <%= height %>px; transform: translateX(<%= x %>px); background:url(<%= img %>) <%= pos.left %>px <%= pos.top %>px / <%= bgwidth %>px <%= bgheight %>px;"></div>\n'),v=new o.default('\n<%@ h:helper %>\n<div class="x-progress-ep-item" style="left:<%= x %>px;" data-t="<%= t %>" data-title="<%= title %>" data-type="<%= type %>">\n</div>\n'),y=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.ui=e,i.player=e.player,i.timespace=0,i.storyPreviewTimer=null,i.storyPreviewPlaying=!1,i.storyPreviewTime=null,i.storyBoardTimer=null,i.storyBoardDisplaying=!1,i.bw=200,i.sw=160,i.originalWidth=160,i.originalHeight=90,i.init(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.EventEmitter),n(t,[{key:"init",value:function(){var e=this.ui.container;this.elProgressBar=e.querySelector(".x-progress-bar"),this.elPlaytrack=e.querySelector(".x-progress-play-track"),this.elBuffertrack=e.querySelector(".x-progress-buffer-track"),this.seekBtn=e.querySelector(".x-seek-btn"),this.elDragTime=e.querySelector(".x-drag-time"),this.elProgressPointer=e.querySelector(".x-progress-pointer"),this.storyPreviewEl=e.querySelector(".x-story-preview"),this.storyPreviewBgEl=e.querySelector(".x-story-preview-bg"),this.storyPreviewTimeEl=e.querySelector(".x-story-preview-time"),this.storyBoardEl=e.querySelector(".x-storyboard"),this.storyHandEl=e.querySelector(".x-storyboard-hand"),this.storyHandBgEl=e.querySelector(".x-storyboard-hand-bg"),this.storyHandTimeEl=e.querySelector(".x-storyboard-hand-time"),this.storyListEl=e.querySelector(".x-storyboard-list"),this.storyFrameEl=e.querySelector(".x-story-frame"),this.storyFrameImgEl=e.querySelector(".x-story-frame-img"),this.epListEl=e.querySelector(".x-progress-ep-list"),this.epPanel1El=e.querySelector(".x-ep-panel-1"),this.epPanel2El=e.querySelector(".x-ep-panel-2"),this.enableSeek(),this.initEvent()}},{key:"initEvent",value:function(){var e=this;this.observePlayer();var t=this.ui.player;this.elProgressBar.addEventListener("mouseenter",function(i){t.state!==t.STATE_MOIVE||e.ui.lock||e.ui.barLock||(e.elProgressBar.classList.add("x-progress-bar-hover"),e.elProgressBar.dataset.mouseleave=0,e.updateDragTime(),a.default.show(e.elDragTime),e.storyPreviewTime=e.getSeekTime(i),e.storyPreviewTimer=setTimeout(function(){e.storyPreviewPlaying=!0,e.updatePreview(e.storyPreviewTime),e.updateEPView(i)},200))},!1),this.elProgressBar.addEventListener("mousemove",function(t){var i=e.getSeekTime(t);e.updateDragTime(i),e.storyPreviewTime=i,e.storyPreviewPlaying&&(e.updatePreview(e.storyPreviewTime),e.updateEPView(t))},!1),this.elProgressBar.addEventListener("mouseleave",function(){e.elProgressBar.dataset.mouseleave=1,e.isDragging||(e.elProgressBar.classList.remove("x-progress-bar-hover"),a.default.hide(e.elDragTime)),e.hideStoryPreview()},!1)}},{key:"observePlayer",value:function(){var e=this;this.player.on("resize",function(){return e.updatePlayedTrack()}),this.player.on("resize",function(){e.isSafari()&&e.player.isFullscreen()?setTimeout(function(){e.setEP()},500):e.setEP()}),this.player.on("interaction-ready",function(){return e.setEP()}),this.player.on("timeupdate",function(){return e.onTimeupdate()});this.player.on("data.ok",function(){e.bufferTickTimer||function t(){e.updateBufferedTrack(),e.bufferTickTimer=setTimeout(t,300)}();var t=e.player.movieDuration||0;e.timespace=t>600?15:t>=240?5:t>=120?3:2;var i=e.player.dataModel.storypic.big;if(i){var n=/big_(\d*)_(\d*)/.exec(i);n&&(e.originalWidth=n[1]/1,e.originalHeight=n[2]/1,e.bw=e.originalWidth,e.sw=.8*e.bw,e.bh=e.originalHeight,e.sh=e.sw*e.originalHeight/e.originalWidth,e.storyPreviewBgEl.style.width=e.bw+"px",e.storyPreviewBgEl.style.height=e.bh+"px",e.storyHandBgEl.style.width=e.bw+"px",e.storyHandBgEl.style.height=e.bh+"px",e.epPanel2El.style.width=e.bw+"px")}e.setEP()}),this.player.on("seek",function(){return e.updatePlayedTrack()}),this.player.on("movie.ended",function(){return e.updatePlayedTrack(0)}),this.player.on("adv.lock",function(){e.elProgressBar.dataset.mouseleave=1,e.elProgressBar.classList.remove("x-progress-bar-hover")})}},{key:"onTimeupdate",value:function(){this.player.state!==this.player.STATE_ADV&&this.updateProgress()}},{key:"enableSeek",value:function(){var e,t=this,i=!1,n=function(i){i.preventDefault(),i.stopPropagation(),t.isDragging||(t.isDragging=!0,i.target!=t.seekBtn&&(e=t.getSeekTime(i),t.ui.seek(e),t.updatePlayedTrack(e),t.updateDragTime(e)),t.storyBoardTimer=setTimeout(function(){return t.updateStoryBoard(e)},200),t.hideStoryPreview())};this.elProgressBar.addEventListener("mousedown",function(e){t.ui.lock||t.ui.barLock||t.player.state===t.player.STATE_ADV||n(e)}),this.seekBtn.addEventListener("mousedown",n),document.addEventListener("mousemove",function(n){t.isDragging&&(n.preventDefault(),n.stopPropagation(),i=!0,"number"==typeof(e=t.getSeekTime(n))&&(t.updatePlayedTrack(e),t.updateDragTime(e),a.default.show(t.elDragTime),t.updateStoryBoard(e)))}),document.addEventListener("mouseup",function(n){n.stopPropagation(),t.isDragging&&"number"==typeof e&&(i&&t.ui.seek(e),t.isDragging=!1,i=!1,t.hideStoryBoard(),1==t.elProgressBar.dataset.mouseleave&&(t.elProgressBar.classList.remove("x-progress-bar-hover"),a.default.hide(t.elDragTime)))})}},{key:"updatePlayedTrack",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player.currentTime;if(this.player.state!==this.player.STATE_ADV){var t=this.player.duration;this.elPlaytrack.style.transform="scaleX("+Math.min(e/t,1)+")";var i=a.default.width(this.elPlaytrack),n=Math.min(i*e/t,i);a.default.css(this.seekBtn,"left",n+"px")}}},{key:"updateDragTime",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player.currentTime;this.elDragTime.innerHTML=u(e);var t=this.player.duration,i=a.default.width(this.elPlaytrack),n=i*e/t,r=a.default.width(this.elDragTime);a.default.css(this.elProgressPointer,"left",n+"px");var s=this.elPlaytrack.getBoundingClientRect().left-this.ui.dashboardEl.getBoundingClientRect().left;(n=Math.max(s,n+s-r/2))+r>=i+s&&(n=i+s-r),a.default.css(this.elDragTime,"left",n+"px")}},{key:"updateProgress",value:function(){this.isDragging||this.updatePlayedTrack()}},{key:"updateBufferedTrack",value:function(){var e=this.player,t=e.movieDuration,i=e.buffered;t&&!window.isNaN(t)&&(this.elBuffertrack.style.transform="scaleX("+Math.min(i/t,1)+")")}},{key:"getSeekTime",value:function(e){var t=this.player.duration;return Math.max(0,Math.min((e.clientX-this.elPlaytrack.getBoundingClientRect().left)*t/a.default.width(this.elPlaytrack),t))}},{key:"updatePreview",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player.currentTime,i=this.player.dataModel.storypic.big;if(i&&!this.storyBoardDisplaying&&/big_(\d*)_(\d*)/.exec(i)){"none"==a.default.css(this.storyPreviewEl,"display")&&this.ui.txidPing("pl_preview_hoverShow"),a.default.show(this.storyPreviewEl),a.default.show(this.storyPreviewTimeEl),a.default.hide(this.elDragTime),this.storyPreviewTimeEl.innerHTML=u(t),d(this.bw,this.bh,this.originalWidth,this.originalHeight,i).then(function(n){var r=n.bgwidth,a=n.bgheight,s=h(t,e.timespace,e.bw,e.bh),o=s.left,l=s.top,u="url("+i+") "+o+"px "+l+"px / "+r+"px "+a+"px";e.storyPreviewBgEl.style.background=u});var n=this.player.movieDuration,r=a.default.width(this.elPlaytrack),s=a.default.width(this.storyPreviewEl),o=r*t/n,l=this.elPlaytrack.getBoundingClientRect().left-this.ui.dashboardEl.getBoundingClientRect().left;(o=Math.max(l,o+l-s/2))+s>=r+l&&(o=r+l-s),this.storyPreviewEl.style.transform="translateX("+o+"px)"}}},{key:"updateStoryBoard",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player.currentTime;this.player.dataModel.storypic.big&&(this.emit("storyboard.willupdate"),"none"==a.default.css(this.storyBoardEl,"display")&&this.ui.txidPing("pl_preview_dragShow"),this.storyBoardDisplaying=!0,a.default.show(this.storyBoardEl),a.default.hide(this.elDragTime),this.updateStoryHand(e),this.updateStoryList(e),this.updateStoryFrame(e))}},{key:"updateStoryHand",value:function(e){var t=this;this.storyHandTimeEl.innerHTML=u(e);var i=this.player.dataModel.storypic.big,n=(this.ui.width-this.bw)/2;this.storyHandEl.style.left=n+"px",d(this.bw,this.bh,this.originalWidth,this.originalHeight,i).then(function(n){var r=n.bgwidth,a=n.bgheight,s=h(e,t.timespace,t.bw,t.bh),o=s.left,l=s.top,u="url("+i+") "+o+"px "+l+"px / "+r+"px "+a+"px";t.storyHandBgEl.style.background=u})}},{key:"updateStoryList",value:function(e){var t=this,i=this.player.dataModel.storypic.big,n=this.player.movieDuration,r=Math.ceil(n/this.timespace)+1,a=h(e,this.timespace,this.sw,this.sh),s=a.left,o=a.top,l=a.index,u=this.sw,c=this.sh,v=Math.ceil((this.ui.width-this.sw)/2/(this.sw+2)),y="",m="",g=(this.ui.width-this.sw)/2;d(this.sw,this.sh,this.originalWidth,this.originalHeight,i).then(function(e){for(var n=e.bgwidth,a=e.bgheight,d=l-1,h=1;h<=v&&d>=0;d--,h++)y+=f.render({bgwidth:n,bgheight:a,width:u,height:c,x:g-(u+2)*h,img:i,pos:p(d,u,c)});for(var b=l+1,_=1;_<=v&&b<r;b++,_++)m+=f.render({bgwidth:n,bgheight:a,width:u,height:c,img:i,x:g+(u+2)*_,pos:p(b,u,c)});var w=y+f.render({bgwidth:n,bgheight:a,width:u,height:c,x:g,img:i,pos:{left:s,top:o}})+m;t.storyListEl.innerHTML=w})}},{key:"updateStoryFrame",value:function(e){var t,i,n=this,r=this.player.dataModel.storypic.big,s=this.ui.width,o=this.ui.height;s/o>this.bw/this.bh?i=(t=s)*this.bh/this.bw:t=(i=o)*this.bw/this.bh,d(t,i,this.originalWidth,this.originalHeight,r).then(function(a){var s=a.bgwidth,o=a.bgheight,l=h(e,n.timespace,t,i),u=l.left,d=l.top,c="url("+r+") "+u+"px "+d+"px / "+s+"px "+o+"px";n.storyFrameImgEl.style.background=c}),a.default.show(this.storyFrameEl)}},{key:"hideStoryBoard",value:function(){clearTimeout(this.storyBoardTimer),this.storyBoardDisplaying=!1,a.default.hide(this.storyBoardEl),a.default.hide(this.storyFrameEl),this.emit("storyboard.hide")}},{key:"hideStoryPreview",value:function(){a.default.hide(this.storyPreviewEl),a.default.hide(this.epPanel1El),this.storyPreviewPlaying=!1,clearTimeout(this.storyPreviewTimer)}},{key:"setEP",value:function(){if(this.player.dataModel){var e=this.player.dataModel.ep||[],t=this.player.movieDuration;if(this.epListEl.innerHTML="",e.length){var i="",n=a.default.width(this.elProgressBar);e.forEach(function(e){var r=e.v,a=e.k,s=a*n/t,o=e.type||0;i+=v.render({title:r,t:a,x:s,type:o})}),this.epListEl.innerHTML=i}}}},{key:"updateEPView",value:function(e){if(!e||!e.target||!e.target.classList.contains("x-progress-ep-item"))return a.default.hide(this.epPanel1El),void a.default.hide(this.epPanel2El);"none"==a.default.css(this.epPanel1El,"display")&&"none"==a.default.css(this.epPanel2El,"display")&&this.ui.txidPing("pl_focus_Show");var t=e.target,i=t.dataset.t/1,n=t.dataset.title,r=t.dataset.type,s=u(i)+" | "+n+(1==r?'<div class="x-ep1-easybuy"></div>':"");if(this.epPanel1El.innerHTML=s,this.epPanel2El.innerHTML=s,this.storyPreviewPlaying&&1!=r)a.default.show(this.epPanel2El),a.default.hide(this.storyPreviewTimeEl);else{var o=this.player.movieDuration,l=a.default.width(this.epPanel1El),d=a.default.width(this.elPlaytrack),c=this.elPlaytrack.getBoundingClientRect().left-this.ui.dashboardEl.getBoundingClientRect().left,h=d*i/o;(h=Math.max(c,h+c-l/2))+l>=d+c&&(h=d+c-l),this.epPanel1El.style.transform="translateX("+h+"px)",a.default.show(this.epPanel1El),a.default.hide(this.storyPreviewEl),a.default.hide(this.storyPreviewTimeEl)}}},{key:"isSafari",value:function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("safari")>=0&&e.indexOf("chrome")<0}}]),t}();t.default=y},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(1),a=i(11),s=function(e){return e&&e.__esModule?e:{default:e}}(i(2));var o=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.ui=e,i.player=e.player,i.init(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.EventEmitter),n(t,[{key:"init",value:function(){var e=this.ui.container;this.volumeSlider=e.querySelector(".x-volume-slider"),this.player.isMiniH5&&s.default.css(this.volumeSlider,"display","none"),this.volumeHandle=e.querySelector(".x-volume-handle"),this.muteBtn=e.querySelector(".x-mute-btn"),this.ui.addTipAbility(this.muteBtn),this.enableVolume(),this.initEvent(),new a.MuteBtnAnimation(this,this.muteBtn)}},{key:"initEvent",value:function(){var e=this;this.observePlayer(),this.muteBtn.addEventListener("click",function(){e.emit("cancleMute");var t=e.player.volume;t>0?(e.muteBtn.dataset.volume=t,e.player.volume=0,e.muteBtn.dataset.title="\u53d6\u6d88\u9759\u97f3",e.ui.showBtnTip(e.muteBtn),e.ui.txidPing("pl_control_mute")):(e.player.volume=e.muteBtn.dataset.volume||.5,e.muteBtn.dataset.title="\u9759\u97f3",e.ui.showBtnTip(e.muteBtn),e.ui.txidPing("pl_control_unmute")),e.ui.showVolumeBezel()},!1)}},{key:"observePlayer",value:function(){var e=this;this.player.on("volumechange",function(t){return e.onVolumechange(t)})}},{key:"onVolumechange",value:function(){var e=this.player.volume;this.updateVolume(e),this.emit("volumechange",e)}},{key:"updateVolume",value:function(e){var t=(this.volumeSlider.getBoundingClientRect().width-this.volumeHandle.getBoundingClientRect().width)*e;0==t&&e>0&&(t=24),s.default.css(this.volumeHandle,"left",t+"px")}},{key:"showVolumeBezel",value:function(){var e=this.player.volume;0==(e=Math.min(100,(100*e).toFixed(0)))?this.ui.showBezel2("\u9759\u97f3"):this.ui.showBezel2("\u97f3\u91cf\uff1a"+e+"%")}},{key:"enableVolume",value:function(){var e,t,i=this,n=!1,r=function(r){if(r.preventDefault(),r.stopPropagation(),n=!0,e=i.player.volume,t=e,r.target==i.volumeSlider){var a=Math.max(0,Math.min((r.clientX-i.volumeSlider.getBoundingClientRect().left)/s.default.width(i.volumeSlider),1));e=a,i.player.volume=a,i.showVolumeBezel(a)}};this.volumeSlider.addEventListener("mousedown",r),this.volumeHandle.addEventListener("mousedown",r),document.addEventListener("mousemove",function(e){if(n){e.preventDefault(),e.stopPropagation();var t=Math.max(0,Math.min((e.clientX-i.volumeSlider.getBoundingClientRect().left)/s.default.width(i.volumeSlider),1));i.player.volume=t,i.showVolumeBezel()}}),document.addEventListener("mouseup",function(r){n&&(i.emit("cancleMute"),r.stopPropagation(),r.preventDefault(),n=!1,0!=i.player.volume&&(e=i.player.volume),i.muteBtn.dataset.volume=e,t>e?i.ui.txidPing("pl_control_downvolume_bar"):t<e&&i.ui.txidPing("pl_control_upvolume_bar"))})}}]),t}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(46);var a=function(){function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ui=t,this.btn=i,this.config=n||{},this.init()}return n(e,[{key:"init",value:function(){var e=this;this.btn.innerHTML='<svg version="1.1"xmlns="http://www.w3.org/2000/svg"xmlns:xlink="http://www.w3.org/1999/xlink"width="100%"height="100%"viewBox="0 0 40 40"><defs><path id="x-svg-play-btn" d="M28.594,19.991c0-0.715-0.631-1.021-0.631-1.021l-14.138-8.356c0,0-0.899-0.608-1.347-0.607 c-1.076,0.002-1.072,0.986-1.072,0.986v17.985c0,0,0,0.842,1.072,1c0.682,0.1,1.453-0.375,1.453-0.375l14.028-8.618 C27.959,20.985,28.594,20.694,28.594,19.991"/><g id="x-svg-pause-btn"><path id="x-svg-pause-btn-1" d="M18,12c0-0.552-0.448-1-1-1h-4c-0.552,0-1,0.448-1,1v18c0,0.552,0.448,1,1,1h4c0.552,0,1-0.448,1-1 V12z"/><path id="x-svg-pause-btn-2" d="M29,12c0-0.552-0.448-1-1-1h-4c-0.552,0-1,0.448-1,1v18c0,0.552,0.448,1,1,1h4c0.552,0,1-0.448,1-1 V12z"/></g><path opacity="0" id="x-svg-replay-btn" d="M21.994,9c-2.617,0-4.996,1.019-6.78,2.671l1.347,1.474C17.989,11.818,19.896,11,21.994,11 c4.411,0,8,3.589,8,8s-3.589,8-8,8c-3.351,0-6.221-2.072-7.411-5h4.359c0,0,0.463-0.223,0.55-0.65 c0.056-0.271-0.206-0.69-0.206-0.69l-4.743-5.642c0,0-0.161-0.308-0.547-0.308c-0.394,0-0.562,0.251-0.562,0.251L8.835,20.59 c0,0-0.335,0.581-0.335,0.76C8.501,21.778,9.043,22,9.043,22h3.426c1.277,4.051,5.059,7,9.525,7c5.514,0,10-4.486,10-10 S27.508,9,21.994,9" /></defs><use xlink:href="#x-svg-replay-btn" class="x-svg-shadow"></use><use xlink:href="#x-svg-replay-btn" class="x-svg-fill"></use><use xlink:href="#x-svg-play-btn" class="x-svg-shadow"></use><use xlink:href="#x-svg-play-btn" class="x-svg-fill"></use><use xlink:href="#x-svg-pause-btn" class="x-svg-shadow"></use><use xlink:href="#x-svg-pause-btn" class="x-svg-fill"></use></svg>',this.pauseSVGPath1=this.btn.querySelector("#x-svg-pause-btn-1"),this.pauseSVGPath2=this.btn.querySelector("#x-svg-pause-btn-2"),this.playSVGPath=this.btn.querySelector("#x-svg-play-btn"),this.pauseSVGPath=this.btn.querySelector("#x-svg-pause-btn"),this.pauseSVGPath.setAttribute("opacity",0),this.playSVGPath.setAttribute("opacity",1),this.replaySVGPath=this.btn.querySelector("#x-svg-replay-btn"),this.state=1,this.ui.on("play",function(){return e.rotateToPauseBtn()}),this.ui.on("playing",function(){return e.rotateToPauseBtn()}),this.ui.on("pause",function(){return e.rotateToPlayBtn()}),this.ui.on("ended",function(){e.playSVGPath.setAttribute("opacity",0),e.pauseSVGPath.setAttribute("opacity",0),e.replaySVGPath.setAttribute("opacity",1),e.state=3})}},{key:"rotateToPlayBtn",value:function(){var e=this;if(1!=this.state){this.replaySVGPath.setAttribute("opacity",0),this.pauseSVGPath.setAttribute("opacity",1),this.state=1;var t=(0,r.rotate)({btn:this.pauseSVGPath1,originalValue:0,targetValue:120}),i=(0,r.rotate)({btn:this.pauseSVGPath2,originalValue:0,targetValue:60});Promise.all([t,i]).then(function(){1!=e.replaySVGPath.getAttribute("opacity")&&1==e.state&&(e.pauseSVGPath.setAttribute("opacity",0),e.playSVGPath.setAttribute("opacity",1))})}}},{key:"rotateToPauseBtn",value:function(){2!=this.state&&(this.state=2,this.pauseSVGPath.setAttribute("opacity",1),this.playSVGPath.setAttribute("opacity",0),this.replaySVGPath.setAttribute("opacity",0),(0,r.rotate)({btn:this.pauseSVGPath1,originalValue:120,targetValue:180}),(0,r.rotate)({btn:this.pauseSVGPath2,originalValue:60,targetValue:180,rx:20,ry:20}))}}]),e}();t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.rotate=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(i(47));t.rotate=n.default},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.btn,i=e.originalValue,n=e.targetValue,r=e.duration,a=void 0===r?100:r,s=e.rx,o=void 0===s?20:s,l=e.ry,u=void 0===l?20:l,d=Date.now(),c=n-i;return new Promise(function(e){requestAnimationFrame(function n(){var r=Math.min(1,(Date.now()-d)/a);t.setAttribute("transform","rotate("+(i+c*r)+","+o+", "+u+")"),r>=1?e():requestAnimationFrame(n)})})}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var r=function(){function e(t,i,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ui=t,this.fsBtn=i,this.fsBtn2=n,this.config=r||{},this.init()}return n(e,[{key:"init",value:function(){var e=this;this.fsBtn.innerHTML='\n            <svg version="1.1"\n                xmlns="http://www.w3.org/2000/svg"\n                xmlns:xlink="http://www.w3.org/1999/xlink"\n                width="100%"\n                height="100%"\n                viewBox="0 0 40 40">\n                <defs>\n                    <g id="x-svg-fs-btn">\n                        <polygon id="x-svg-fs-btn1" points="28.059,22.184 28.051,26.687 22.742,21.346 21.381,22.714 26.641,28.012 22.25,28.039 22.247,30 30,30 30,22.187"/>\n                        <polygon id="x-svg-fs-btn2" points="17.802,11.938 17.805,10 10,10 10,17.768 11.966,17.771 11.988,13.268 17.303,18.609 18.667,17.241 13.41,11.942"/>\n                    </g>\n                </defs>\n                <use xlink:href="#x-svg-fs-btn" class="x-svg-shadow"></use>\n                <use xlink:href="#x-svg-fs-btn" class="x-svg-fill"></use>\n            </svg>\n        ',this.fsBtn2.innerHTML='\n            <svg version="1.1"\n                xmlns="http://www.w3.org/2000/svg"\n                xmlns:xlink="http://www.w3.org/1999/xlink"\n                width="100%"\n                height="100%"\n                viewBox="0 0 40 40">\n                <defs>\n                    <g id="x-svg-fs-btn2">\n                        <polygon id="x-svg-fs2-btn1" points="16.029,14.665 10.721,9.324 9.36,10.692 14.618,15.99 10.228,16.017 10.225,17.978 17.979,17.978 17.979,10.165 16.038,10.162"/>\n                        <polygon id="x-svg-fs2-btn2" points="25.432,23.965 29.824,23.961 29.826,22.022 22.021,22.022 22.021,29.791 23.988,29.793 24.01,25.291 29.324,30.632 30.688,29.264"/>\n                    </g>\n                </defs>\n                <use xlink:href="#x-svg-fs-btn2" class="x-svg-shadow"></use>\n                <use xlink:href="#x-svg-fs-btn2" class="x-svg-fill"></use>\n            </svg>\n        ';var t=this.fsBtn.querySelector("#x-svg-fs-btn1"),i=this.fsBtn.querySelector("#x-svg-fs-btn2");this.ui.on("fs",function(){e.fsBtn.dataset.title="\u9000\u51fa\u5168\u5c4f",t.setAttribute("points","16.029,14.665 10.721,9.324 9.36,10.692 14.618,15.99 10.228,16.017 10.225,17.978 17.979,17.978 17.979,10.165 16.038,10.162"),i.setAttribute("points","25.432,23.965 29.824,23.961 29.826,22.022 22.021,22.022 22.021,29.791 23.988,29.793 24.01,25.291 29.324,30.632 30.688,29.264")}),this.ui.on("exitfs",function(){e.fsBtn.dataset.title="\u5168\u5c4f",t.setAttribute("points","28.059,22.184 28.051,26.687 22.742,21.346 21.381,22.714 26.641,28.012 22.25,28.039 22.247,30 30,30 30,22.187"),i.setAttribute("points","17.802,11.938 17.805,10 10,10 10,17.768 11.966,17.771 11.988,13.268 17.303,18.609 18.667,17.241 13.41,11.942")})}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var r=function(){function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ui=t,this.btn=i,this.config=n||{},this.init()}return n(e,[{key:"init",value:function(){var e=this;this.btn.innerHTML='\n            <svg version="1.1"\n                xmlns="http://www.w3.org/2000/svg"\n                xmlns:xlink="http://www.w3.org/1999/xlink"\n                width="100%"\n                height="100%"\n                viewBox="0 0 40 40">\n                <defs>\n                    <path id="x-svg-mute-1" d="M18.811,10.991L14.107,16h-3.264C10.293,16,10,16.465,10,17.015v6C10,23.565,10.293,24,10.843,24 h3.469l4.392,4.692C19.329,29.242,20,28.844,20,28.016V11.797C20,10.906,19.343,10.617,18.811,10.991"/>\n                    <path id="x-svg-mute-2" d="M22,14.972v1.776c0.939,0.732,1.557,1.862,1.557,3.146c0,1.283-0.617,2.414-1.557,3.146v1.775 c1.811-0.9,3.057-2.764,3.057-4.922C25.057,17.735,23.811,15.874,22,14.972"/>\n                    <path id="x-svg-mute-3" d="M24,10.466v1.69c2.688,1.557,4.5,4.457,4.5,7.786c0,3.33-1.812,6.229-4.5,7.787v1.689 c3.544-1.688,6-5.29,6-9.476S27.544,12.152,24,10.466"/>\n                </defs>\n                <use xlink:href="#x-svg-mute-1" class="x-svg-mute-1 x-svg-shadow"></use>\n                <use xlink:href="#x-svg-mute-1" class="x-svg-mute-1 x-svg-fill"></use>\n                <use xlink:href="#x-svg-mute-2" class="x-svg-mute-2 x-svg-shadow"></use>\n                <use xlink:href="#x-svg-mute-2" class="x-svg-mute-2 x-svg-fill"></use>\n                <use xlink:href="#x-svg-mute-3" class="x-svg-mute-3 x-svg-shadow"></use>\n                <use xlink:href="#x-svg-mute-3" class="x-svg-mute-3 x-svg-fill"></use>\n                <svg class="x-svg-mute-group" style="opacity:0">\n                    <defs>\n                        <g id="x-svg-mute-btn">\n                            <path d="M18.811,10.968L14.107,16h-3.264C10.293,16,10,16.419,10,16.969v6C10,23.519,10.293,24,10.843,24 h3.469l4.392,4.669c0.624,0.55,1.296,0.128,1.296-0.7V11.75C20,10.86,19.343,10.594,18.811,10.968"/>\n                            <polygon points="29.999,17.127 30,16 28.867,16 25.539,19.333 22.201,16 21,16 21,17.114 24.373,20.451 21.052,23.83 21.07,25 22.201,25 25.539,21.666 28.869,25 30,25 30,23.781 26.671,20.454 "/>\n                        </g>\n                    </defs>\n                    <use xlink:href="#x-svg-mute-btn" class="x-svg-shadow"></use>\n                    <use xlink:href="#x-svg-mute-btn" class="x-svg-fill"></use>\n                </svg>\n            </svg>\n        ',this.ui.on("volumechange",function(t){t>0?(e.btn.dataset.title="\u9759\u97f3",e.btn.querySelector(".x-svg-mute-group").style.opacity=0,t<=.5?([].slice.call(e.btn.querySelectorAll(".x-svg-mute-3")).forEach(function(e){return e.style.opacity=0}),[].slice.call(e.btn.querySelectorAll(".x-svg-mute-2")).forEach(function(e){return e.style.opacity=1})):([].slice.call(e.btn.querySelectorAll(".x-svg-mute-3")).forEach(function(e){return e.style.opacity=1}),[].slice.call(e.btn.querySelectorAll(".x-svg-mute-2")).forEach(function(e){return e.style.opacity=1}))):(e.btn.dataset.title="\u53d6\u6d88\u9759\u97f3",[].slice.call(e.btn.querySelectorAll(".x-svg-mute-3")).forEach(function(e){return e.style.opacity=0}),[].slice.call(e.btn.querySelectorAll(".x-svg-mute-2")).forEach(function(e){return e.style.opacity=0}),e.btn.querySelector(".x-svg-mute-group").style.opacity=1)})}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var r=function(){function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ui=t,this.btn=i,this.config=n||{},this.init()}return n(e,[{key:"init",value:function(){this.btn.innerHTML='<svg version="1.1"xmlns="http://www.w3.org/2000/svg"width="100%"height="100%"viewBox="0 1 40 40"><defs><g id="x-svg-next-btn"><path id="x-svg-next-btn-1" d="M25.9,20.5c0-0.6-0.5-0.9-0.5-0.9l-11.5-7.5c0,0-0.7-0.5-1.1-0.5c-0.9,0-0.9,0.9-0.9,0.9v16.2  c0,0,0,0.8,0.9,0.9c0.6,0.1,1.2-0.3,1.2-0.3l11.4-7.8C25.4,21.4,25.9,21.1,25.9,20.5"/><path id="x-svg-next-btn-2" d="M31.3,12.4c0-0.5-0.2-0.9-0.5-0.9h-2c-0.3,0-0.5,0.4-0.5,0.9v16.2c0,0.5,0.2,0.9,0.5,0.9h2  c0.3,0,0.5-0.4,0.5-0.9V12.4z"/></g></defs><use xlink:href="#x-svg-next-btn" class="x-svg-shadow"></use><use xlink:href="#x-svg-next-btn" class="x-svg-fill"></use></svg>',this.nextSVGPath=this.btn.querySelector("#x-svg-next-btn")}},{key:"setBtnState",value:function(e){this.nextSVGPath.setAttribute("opacity",e)}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var r=function(){function e(t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ui=t,this.btn=i,this.config=n||{},this.init()}return n(e,[{key:"init",value:function(){this.btn.innerHTML='<svg version="1.1"xmlns="http://www.w3.org/2000/svg"width="100%"height="100%"viewBox="0 1 40 40"><defs><g id="x-svg-set-btn"><path id="x-svg-set-btn-1" d="M29,23.5h-1.5    c-0.2,0.9-0.5,1.7-1,2.4l1,1c0.2,0.2,0.2,0.6,0,0.9l-1.8,1.8c-0.2,0.2-0.6,0.2-0.9,0l-1-1c-0.7,0.4-1.5,0.8-2.4,1V31    c0,0.3-0.3,0.6-0.6,0.6h-2.5c-0.3,0-0.6-0.3-0.6-0.6v-1.5c-0.9-0.2-1.7-0.6-2.4-1l-1,1c-0.2,0.2-0.6,0.2-0.9,0l-1.8-1.8    c-0.2-0.2-0.2-0.6,0-0.9l1-1c-0.5-0.7-0.8-1.5-1-2.4h-1.5c-0.3,0-0.6-0.3-0.6-0.6v-2.5c0-0.3,0.3-0.6,0.6-0.6h1.5    c0.2-0.9,0.5-1.7,1-2.4l-1-1c-0.2-0.2-0.2-0.6,0-0.9l1.8-1.8c0.2-0.2,0.6-0.2,0.9,0l1,1c0.7-0.4,1.5-0.8,2.4-1v-1.5    c0-0.3,0.3-0.6,0.6-0.6h2.5c0.3,0,0.6,0.3,0.6,0.6v1.5c0.9,0.2,1.7,0.6,2.4,1l1-1c0.2-0.2,0.6-0.2,0.9,0l1.8,1.8    c0.2,0.2,0.2,0.6,0,0.9l-1,1c0.5,0.7,0.8,1.5,1,2.4H29c0.3,0,0.6,0.3,0.6,0.6v2.5C29.6,23.2,29.3,23.5,29,23.5z M19.6,16    c-3.1,0-5.6,2.5-5.6,5.6s2.5,5.6,5.6,5.6c3.1,0,5.6-2.5,5.6-5.6S22.7,16,19.6,16z"/></g></defs><use xlink:href="#x-svg-set-btn" class="x-svg-shadow"></use><use xlink:href="#x-svg-set-btn" class="x-svg-fill"></use></svg>',this.setSVGPath=this.btn.querySelector("#x-svg-set-btn")}},{key:"setBtnState",value:function(e){this.setSVGPath.setAttribute("opacity",e)}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ui=t,this.player=t.player,this.init()}return n(e,[{key:"init",value:function(){var e=this;this.elClock=this.ui.container.querySelector(".x-clock");var t=function(){var t=new Date;e.elClock.innerHTML=t.getHours()+":"+("0"+t.getMinutes()).slice(-2)};setInterval(t,1e3),t()}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(1),a=u(i(2)),s=u(i(5)),o=i(20),l=u(i(0));function u(e){return e&&e.__esModule?e:{default:e}}var d={resolution:'<%@ h:helper %>\n    <% var i = resolutionList.length - 1, resolution, title;%>\n    <% for (; resolution = resolutionList[i]; i--) { %>\n        <%\n            title = RESOLUTION_MODE[resolution];\n        %>\n        <button class="x-resolution-item<%= resolution == currentResolution ? " on" : "" %>" data-resolution="<%= resolution %>"><%= title %></button>\n    <% } %>'},c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.ui=e,i.player=e.player,i.tmpl=new s.default(d.resolution),i.init(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.EventEmitter),n(t,[{key:"init",value:function(){var e=this.ui.container;this.resolutionBtn=e.querySelector(".x-resolution-btn"),this.player.isMiniH5&&a.default.css(this.resolutionBtn,"display","none"),this.resolutionPanel=e.querySelector(".x-resolution-panel"),this.initEvent()}},{key:"initEvent",value:function(){var e=this;this.observePlayer(),this.resolutionBtn.addEventListener("mouseenter",function(t){t.stopPropagation(),e.resolutionBtn.classList.contains("x-disable")||e.player.state===e.player.STATE_ADV||e.lock||(clearTimeout(e.resolutionBtn.dataset.timer),e.resolutionBtn.dataset.timer=setTimeout(function(){e.resolutionBtn.classList.add("on"),e.show()},200))},!1),this.resolutionBtn.addEventListener("mouseleave",function(t){t.stopPropagation(),e.resolutionBtn.classList.contains("x-disable")||(clearTimeout(e.resolutionBtn.dataset.timer),e.resolutionBtn.dataset.timer=setTimeout(function(){e.resolutionBtn.classList.remove("on"),e.hide()},200))},!1),this.resolutionPanel.addEventListener("mouseenter",function(t){t.stopPropagation(),clearTimeout(e.resolutionBtn.dataset.timer)},!1),this.resolutionPanel.addEventListener("mouseleave",function(t){t.stopPropagation(),e.resolutionBtn.dataset.timer=setTimeout(function(){e.resolutionBtn.classList.remove("on"),e.hide()},200)},!1),this.resolutionPanel.addEventListener("click",function(t){t.stopPropagation();var i=t.target;if(i.classList.contains("x-resolution-item")&&!i.classList.contains("on")){var n=i.dataset.resolution;if(1!=e.player.dataModel.isDrm){e.setResolutionItemState(n),e.player.switchResolution(n),e.hide();e.ui.txidPing({2:"pl_control_resolution_320p",1:"pl_control_resolution_480p",21:"pl_control_resolution_720p",31:"pl_control_resolution_1080p"}[n])}else{e.player.exitFullscreen();var r=e.player.dataModel.plid+"_"+e.player.dataModel.vid+"_"+1e3*e.player.currentTime+"_"+(1==e.player.dataModel.site?"0":"1")+"_"+e.player.dataModel.resolution;try{window.flashPlayDrm(!1,r)}catch(t){l.default.error("flashPlayDrm error")}}}})}},{key:"observePlayer",value:function(){var e=this;this.player.on("data.ok",function(){var t=e.player.dataModel;e.resolutionPanel.innerHTML=e.tmpl.render({resolutionList:t.resolutionList,currentResolution:t.resolution,RESOLUTION_MODE:o.RESOLUTION_MODE}),e.resolutionBtn.innerHTML=o.RESOLUTION_MODE[t.resolution]}),this.player.on("resolution.switching",function(t){e.ui.dashTip.show({s:"\u6b63\u5728\u5207\u6362\u6e05\u6670\u5ea6...",time:1e4});for(var i,n=e.resolutionPanel.querySelectorAll(".x-resolution-item");i<n.length;i++)n[i].dataset.resolution==t?n[i].classList.add("on"):n[i].classList.remove("on")}),this.player.on("resolution.switched",function(t){e.ui.dashTip.show({s:"\u5df2\u4e3a\u60a8\u5207\u6362\u81f3<em>"+o.RESOLUTION_MODE[t]+"</em>\u64ad\u653e",time:3e3}),e.resolutionBtn.innerHTML=o.RESOLUTION_MODE[t]}),this.player.on("play",function(){e.resolutionBtn.classList.remove("x-disable")}),this.player.on("playing",function(){e.resolutionBtn.classList.remove("x-disable")}),this.player.on("ended",function(){e.hide(),e.resolutionBtn.classList.add("x-disable")}),this.player.on("data.exception",function(){try{var t=e.player.dataModel;e.setResolutionItemState(t.resolution)}catch(e){}})}},{key:"setResolutionItemState",value:function(e){for(var t,i=this.resolutionPanel.querySelectorAll(".x-resolution-item"),n=0;t=i[n++];)t.dataset.resolution==e?t.classList.add("on"):t.classList.remove("on")}},{key:"show",value:function(){var e=this.ui.container,t=this.resolutionBtn,i=this.resolutionPanel,n=e.getBoundingClientRect().right-t.getBoundingClientRect().right;n=(a.default.width(t)-a.default.width(i))/2+n,a.default.css(i,"right",n+"px"),this.resolutionPanel.classList.add("active"),this.ui.txidPing("pl_control_resolution","impress")}},{key:"hide",value:function(){this.resolutionBtn.classList.remove("on"),this.resolutionPanel.classList.remove("active")}}]),t}();t.default=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(1),a=l(i(5)),s=i(20),o=l(i(2));function l(e){return e&&e.__esModule?e:{default:e}}var u=["0.8","1","1.5","2"],d="1",c='<%@ h:helper %>\n    <% var i = playrateList.length-1,playrate,title;%>\n    <% for(; playrate = playrateList[i];i--){ %>\n        <%\n            title = PLAYRATE_MODE[playrate];\n        %>\n        <button class="x-playrate-item<%= playrate == currentPlayrate ?\n        " on" : ""%>" data-playrate="<%= playrate %>"><%= title %></button>\n    <% }%>',h=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.ui=e,i.player=e.player,i.tmpl=new a.default(c),i.init(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.EventEmitter),n(t,[{key:"init",value:function(){var e=this.ui.container;this.playRateBtn=e.querySelector(".x-playrate-btn"),this.player.isMiniH5&&o.default.css(this.playRateBtn,"display","none"),this.playRatePanel=e.querySelector(".x-playrate-panel"),this.initEvent()}},{key:"initEvent",value:function(){var e=this;this.observePlayer(),this.playRateBtn.addEventListener("mouseenter",function(t){t.stopPropagation(),e.playRateBtn.classList.contains("x-disable")||e.player.state!==e.player.STATE_ADV&&(clearTimeout(e.playRateBtn.dataset.timer),e.playRateBtn.dataset.timer=setTimeout(function(){e.playRateBtn.classList.add("on"),e.show()},200))},!1),this.playRateBtn.addEventListener("mouseleave",function(t){t.stopPropagation(),e.playRateBtn.classList.contains("x-disable")||(clearTimeout(e.playRateBtn.dataset.timer),e.playRateBtn.dataset.timer=setTimeout(function(){e.playRateBtn.classList.remove("on"),e.hide()},200))},!1),this.playRatePanel.addEventListener("mouseenter",function(t){t.stopPropagation(),clearTimeout(e.playRateBtn.dataset.timer)},!1),this.playRatePanel.addEventListener("mouseleave",function(t){t.stopPropagation(),e.playRateBtn.dataset.timer=setTimeout(function(){e.playRateBtn.classList.remove("on"),e.hide()},200)},!1),this.playRatePanel.addEventListener("click",function(t){t.stopPropagation();var i=t.target;if(i.classList.contains("x-playrate-item")&&!i.classList.contains("on")){var n=i.dataset.playrate;e.setPlayrateItemState(n),e.player.switchPlayrate(n),e.hide(),e.playRateBtn.innerHTML="1"==n?"\u500d\u901f":s.PLAYRATE_MODE[n];e.ui.txidPing({.8:"player_speed_0.8",1:"player_speed_1",1.5:"player_speed_1.5",2:"player_speed_2"}[n])}})}},{key:"observePlayer",value:function(){var e=this;this.player.on("data.ok",function(){e.playRatePanel.innerHTML=e.tmpl.render({playrateList:u,PLAYRATE_MODE:s.PLAYRATE_MODE,currentPlayrate:d})}),this.player.on("play",function(){e.playRateBtn.classList.remove("x-disable")}),this.player.on("playing",function(){e.playRateBtn.classList.remove("x-disable")}),this.player.on("ended",function(){d="1",e.playRateBtn.innerHTML="\u500d\u901f",e.setPlayrateItemState(d),e.player.switchPlayrate(d),e.hide(),e.playRateBtn.classList.add("x-disable")}),this.player.on("switchState",function(){e.playRateBtn.innerHTML="\u500d\u901f"})}},{key:"show",value:function(){var e=this.ui.container,t=this.playRateBtn,i=this.playRatePanel,n=e.getBoundingClientRect().right-t.getBoundingClientRect().right;n=(o.default.width(t)-o.default.width(i))/2+n,o.default.css(i,"right",n+"px"),this.playRatePanel.classList.add("active")}},{key:"hide",value:function(){this.playRateBtn.classList.remove("on"),this.playRatePanel.classList.remove("active")}},{key:"setPlayrateItemState",value:function(e){for(var t,i=this.playRatePanel.querySelectorAll(".x-playrate-item"),n=0;t=i[n++];)t.dataset.playrate==e?t.classList.add("on"):t.classList.remove("on")}}]),t}();t.default=h},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(1),a=i(11);var s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.ui=e,i.player=e.player,i.init(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.EventEmitter),n(t,[{key:"init",value:function(){var e=this.ui.container;this.fsBtn=e.querySelector(".x-fullscreen-btn"),this.fsBtn2=e.querySelector(".x-fullscreen-btn2"),this.ui.addTipAbility(this.fsBtn),this.initEvent(),new a.FSBtnAnimation(this,this.fsBtn,this.fsBtn2)}},{key:"initEvent",value:function(){var e=this;this.fsBtn.addEventListener("click",function(){e.player.isFullscreen()?(e.player.exitFullscreen(),e.ui.txidPing("pl_control_exitfullscreen")):(e.player.requestFullscreen(),e.ui.txidPing("pl_control_fullscreen"))}),this.fsBtn2.addEventListener("click",function(t){t.stopPropagation(),t.preventDefault(),e.player.exitFullscreen(),e.ui.txidPing("pl_control_exitfullscreen")},!1),this.ui.on("fs",function(){return e.emit("fs")}),this.ui.on("exitfs",function(){return e.emit("exitfs")})}}]),t}();t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=l(i(5)),a=l(i(2)),s=i(1),o=l(i(0));function l(e){return e&&e.__esModule?e:{default:e}}var u='<%@ h:helper %>\n            <div class="x-adv-select-time-wrap">\n                <span class="x-adv-select-time-span"><%= time %></span>\n                <a class="x-adv-select-campaign">\u53bb\u5e7f\u544a</a>\n            </div>\n            <audio class="x-adv-select-bgSound" src="<%= sound %>" autoplay="autoplay"></audio>\n            <div class="container">            \n                <div class="content">\n                    <div class="bg"><img src="<%= big1 %>" width="240" height="240"></div>\n                    <div class="floatPanel"></div>\n                    <div class="logo"><img src="<%= logo1 %>" width="100" height="20"></div>\n                    <div class="title"><%= title1 %></div>\n                    <div class="select_button" data-id="1"><%= btnTxt1 %></div>\n                </div>\n                <div class="content">\n                    <div class="bg"><img src="<%= big2 %>" width="240" height="240"></div>\n                    <div class="floatPanel"></div>\n                    <div class="logo"><img src="<%= logo2 %>" width="100" height="20"></div>\n                    <div class="title"><%= title2 %></div>\n                    <div class="select_button" data-id="2"><%= btnTxt2 %></div>\n                </div>\n                <div class="select_tip"><img src="<%= photo %>" width="270" height="21"></div>\n                <div class="clock-box">\n                    <svg class="circle">\n                        <circle cx="18" cy="18" r="13" fill="transparent" stroke="#fff" stroke-opacity="0.3" stroke-width="2"></circle>\n                        <circle class="sec-circle" cx="18" cy="18" r="13" fill="transparent" stroke="#fff" stroke-width="3" transform="rotate(-90 18 18)"  stroke-dasharray="93" style="stroke-dashoffset:0"></circle>\n                    </svg>\n                    <div class="clock-text">10</div>\n                </div>\n            </div>',d=function(e){function t(e,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.ui=e,n.isPlayPage=i,n.player=e.player,n.tmpl=new r.default(u),n.observePlayer(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.EventEmitter),n(t,[{key:"initEvent",value:function(){}},{key:"observePlayer",value:function(){var e=this;this.player.on("adv.select.show",function(t){e.ads=t,e.parseAd(t),e.init(),a.default.css(e.dashboard,"display","none"),e.show(),e.setCircle()}),this.player.on("resize",function(){return e.resize()})}},{key:"init",value:function(){var e=this,t=this.ui.container;this.dashboard=t.querySelector(".x-dashboard"),this.selectPanel=t.querySelector(".x-adv-select-panel"),this.selectPanel.innerHTML=this.tmpl.render({photo:this.photo,logo1:this.logo1,logo2:this.logo2,big1:this.big1,big2:this.big2,title1:this.title1,title2:this.title2,btnTxt1:this.btnTxt1,btnTxt2:this.btnTxt2,time:this.duration,sound:this.sound}),this.removeAdBtn=t.querySelector(".x-adv-select-campaign"),this.selectTimeSpan=this.selectPanel.querySelector(".x-adv-select-time-span"),this.selectTimeSpan.innerHTML=this.duration,this.inner=this.selectPanel.querySelector(".container"),this.selectPanel.querySelectorAll(".select_button").forEach(function(t){t.addEventListener("click",function(t){return e.selectAd(t)})}),this.removeAdBtn.addEventListener("click",function(){e.player.isFullscreen()&&e.player.exitFullscreen(),1==e.isPlayPage?(window.openPayVip(),e.ui.playOrPause()):window.open("//film.sohu.com/album/"+e.player.dataModel.plid+".html?channeled=1211040001")}),this.circle=this.selectPanel.querySelector(".sec-circle"),this.text=this.selectPanel.querySelector(".clock-text"),this.bgSound=t.querySelector(".x-adv-select-bgSound"),this.resize()}},{key:"parseAd",value:function(e){o.default.log("[\u5e7f\u544a]select"+e);var t=e[0].InLine.Creatives.Creative[0].Linear.Companion[0],i=e[1].InLine.Creatives.Creative[0].Linear.Companion[0];this.logo1=t.LogoPicture["@value"],this.big1=t.StaticResource[0]["@value"],this.title1=t.AltText["@value"],this.btnTxt1=t.ButtonText["@value"],this.logo2=i.LogoPicture["@value"],this.big2=i.StaticResource[0]["@value"],this.title2=i.AltText["@value"],this.btnTxt2=i.ButtonText["@value"],this.duration=t["@attr"].minSuggestedDuration,this.photo=t.NotifyImage["@value"],this.sound=t.NotifyAudio["@value"]}},{key:"resize",value:function(){try{var e=(this.player.height-291)/2,t=(this.player.width-480)/2;a.default.css(this.inner,"top",e+"px"),a.default.css(this.inner,"left",t+"px")}catch(e){}}},{key:"selectAd",value:function(e){clearInterval(this.circleTime),this.bgSound.src="";var t=Number(e.target.getAttribute("data-id")),i=[];i.push(this.ads[t-1]),a.default.css(this.dashboard,"display","block"),this.emit("adv.select.clickOne",{ads:i,time:this.duration}),this.hide()}},{key:"updateUI",value:function(){var e=this.player.currentTime,t=this.player.duration;this.elLinearTimeSpan.innerHTML=Math.ceil(Math.max(t-e,1))}},{key:"setCircle",value:function(){this.text.innerHTML=this.duration,this.circleTime=setInterval(function(e){e.turn()},1e3,this)}},{key:"turn",value:function(){if(0==this.duration)clearInterval(this.circleTime),this.bgSound.src="",this.emit("select.finish"),a.default.css(this.dashboard,"display","block"),this.hide();else{this.duration-=1,this.selectTimeSpan.innerHTML=this.duration,this.text.innerHTML=this.duration;var e=Math.round(this.duration/10*93);this.circle.style.strokeDashoffset=e-93}}},{key:"show",value:function(){a.default.show(this.selectPanel),this.ui.txidPing("")}},{key:"hide",value:function(){a.default.hide(this.selectPanel)}}]),t}();t.default=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(1),a=l(i(0)),s=l(i(2)),o=i(12);function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.ui=e,n.isPlayPage=i,n.player=e.player,n.clickAble=!1,n.init(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.EventEmitter),n(t,[{key:"init",value:function(){var e=this.ui.container;this.linearPanel=e.querySelector(".x-adv-linear-panel"),this.elLinearLink=this.linearPanel.querySelector(".x-adv-linear-link"),this.elLinearTimeSpan=this.linearPanel.querySelector(".x-adv-linear-time-span"),this.skipTimeSpan=this.linearPanel.querySelector(".x-adv-linear-skip-time-span"),this.skipBtn=this.linearPanel.querySelector(".x-adv-linear-skip"),this.removeAdBtn=this.linearPanel.querySelector(".x-adv-linear-campaign"),this.initEvent()}},{key:"initEvent",value:function(){var e=this;this.observePlayer(),this.linearPanel.addEventListener("click",function(e){return e.stopPropagation()}),this.elLinearLink.addEventListener("click",function(t){return e.emit("adv.linear.click",{index:e.elLinearLink.dataset.index,evt:t})}),this.removeAdBtn.addEventListener("click",function(){e.player.isFullscreen()&&e.player.exitFullscreen(),1==e.isPlayPage?(window.openPayVip(),e.ui.playOrPause()):window.open("//film.sohu.com/album/"+e.player.dataModel.plid+".html?channeled=1211040001")}),this.skipBtn.addEventListener("click",function(){e.clickAble&&e.emit("adv.skipoad.click")})}},{key:"observePlayer",value:function(){var e=this;this.player.on("adv.start",function(t){e.selectDuration=t||0,e.elLinearTimeSpan.innerHTML=t||e.player.duration,e.skipTimeSpan.innerHTML=e.player.skipDuration,s.default.css(e.skipTimeSpan,"display","none"),s.default.css(e.skipBtn,"display","none")}),this.player.on("adv.seg.start",function(t){var i=t.data,n=void 0===i?{}:i,r=t.index,a=t.video;e.ui.container.querySelector(".x-video-adv").appendChild(a);var s=(0,o.getVideoClicks)(n);s.ClickThrough&&s.ClickThrough["@value"]?(e.elLinearLink.style.display="block",e.elLinearLink.href=s.ClickThrough["@value"],e.elLinearLink.dataset.index=r):(e.elLinearLink.style.display="none",e.elLinearLink.dataset.index&&delete e.elLinearLink.dataset.index),e.ui.dashTip.hide()}),this.player.on("adv.seg.ended",function(){var t=e.ui.container.querySelector(".x-video-adv"),i=t.querySelector("video");try{t.contains(i)&&t.removeChild(i)}catch(e){a.default.error("[\u5e7f\u544a]adv.seg.ended remove video node--\x3e",e)}}),this.player.on("timeupdate",function(){e.player.state===e.player.STATE_ADV&&e.updateUI()})}},{key:"updateUI",value:function(){var e=this.player.currentTime,t=0===this.selectDuration?this.player.duration:this.selectDuration,i=this.player.skipDuration;this.elLinearTimeSpan.innerHTML=Math.ceil(Math.max(t-e,1)),i>0&&(s.default.css(this.skipTimeSpan,"display","inline-block"),s.default.css(this.skipBtn,"display","inline-block"),i-e>0?(this.clickAble=!1,this.skipTimeSpan.innerHTML=Math.ceil(i-e),this.skipBtn.innerHTML="\u79d2\u540e\u8df3\u8fc7\u5e7f\u544a",this.skipBtn.classList.contains("x-adv-linear-skip-click")&&this.skipBtn.classList.remove("x-adv-linear-skip-click")):(this.clickAble=!0,this.skipTimeSpan.innerHTML="",this.skipBtn.innerHTML="\u8df3\u8fc7\u5e7f\u544a",this.skipBtn.classList.add("x-adv-linear-skip-click")))}}]),t}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SelectAdv=void 0;var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(9),a=i(14);var s=function(e){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i.pt="";var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return n.observePlayer(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.NonLinearAdv),n(t,[{key:"observePlayer",value:function(){this.player.on("adv.select.show",function(e){e.forEach(function(e){var t=e.InLine.Creatives.Creative[0].Linear.Companion[0].CompanionImpression["@value"].replace(/(\[ERRORCODE\])/,"0");(0,a.advPingback)(t)})}),this.player.on("adv.select.clickOne",function(e){e.ads.forEach(function(t){var i=t.InLine.Creatives.Creative[0].Linear.Companion[0].CompanionClickTracking[0]["@value"].replace(/(\[SKIPTIME\])/,e.time);(0,a.advPingback)(i)})})}}]),t}();t.SelectAdv=s},function(e,t,i){"use strict";i.r(t),i.d(t,"Headers",function(){return u}),i.d(t,"Request",function(){return y}),i.d(t,"Response",function(){return g}),i.d(t,"DOMException",function(){return _}),i.d(t,"fetch",function(){return w});var n={searchParams:"URLSearchParams"in self,iterable:"Symbol"in self&&"iterator"in Symbol,blob:"FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in self,arrayBuffer:"ArrayBuffer"in self};if(n.arrayBuffer)var r=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=ArrayBuffer.isView||function(e){return e&&r.indexOf(Object.prototype.toString.call(e))>-1};function s(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function o(e){return"string"!=typeof e&&(e=String(e)),e}function l(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n.iterable&&(t[Symbol.iterator]=function(){return t}),t}function u(e){this.map={},e instanceof u?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function d(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function c(e){return new Promise(function(t,i){e.onload=function(){t(e.result)},e.onerror=function(){i(e.error)}})}function h(e){var t=new FileReader,i=c(t);return t.readAsArrayBuffer(e),i}function p(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function f(){return this.bodyUsed=!1,this._initBody=function(e){this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:n.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:n.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:n.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():n.arrayBuffer&&n.blob&&function(e){return e&&DataView.prototype.isPrototypeOf(e)}(e)?(this._bodyArrayBuffer=p(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):n.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||a(e))?this._bodyArrayBuffer=p(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},n.blob&&(this.blob=function(){var e=d(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?d(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(h)}),this.text=function(){var e=d(this);if(e)return e;if(this._bodyBlob)return function(e){var t=new FileReader,i=c(t);return t.readAsText(e),i}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),i=new Array(t.length),n=0;n<t.length;n++)i[n]=String.fromCharCode(t[n]);return i.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},n.formData&&(this.formData=function(){return this.text().then(m)}),this.json=function(){return this.text().then(JSON.parse)},this}u.prototype.append=function(e,t){e=s(e),t=o(t);var i=this.map[e];this.map[e]=i?i+", "+t:t},u.prototype.delete=function(e){delete this.map[s(e)]},u.prototype.get=function(e){return e=s(e),this.has(e)?this.map[e]:null},u.prototype.has=function(e){return this.map.hasOwnProperty(s(e))},u.prototype.set=function(e,t){this.map[s(e)]=o(t)},u.prototype.forEach=function(e,t){for(var i in this.map)this.map.hasOwnProperty(i)&&e.call(t,this.map[i],i,this)},u.prototype.keys=function(){var e=[];return this.forEach(function(t,i){e.push(i)}),l(e)},u.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),l(e)},u.prototype.entries=function(){var e=[];return this.forEach(function(t,i){e.push([i,t])}),l(e)},n.iterable&&(u.prototype[Symbol.iterator]=u.prototype.entries);var v=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function y(e,t){var i=(t=t||{}).body;if(e instanceof y){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new u(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new u(t.headers)),this.method=function(e){var t=e.toUpperCase();return v.indexOf(t)>-1?t:e}(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function m(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var i=e.split("="),n=i.shift().replace(/\+/g," "),r=i.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(r))}}),t}function g(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new u(t.headers),this.url=t.url||"",this._initBody(e)}y.prototype.clone=function(){return new y(this,{body:this._bodyInit})},f.call(y.prototype),f.call(g.prototype),g.prototype.clone=function(){return new g(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new u(this.headers),url:this.url})},g.error=function(){var e=new g(null,{status:0,statusText:""});return e.type="error",e};var b=[301,302,303,307,308];g.redirect=function(e,t){if(-1===b.indexOf(t))throw new RangeError("Invalid status code");return new g(null,{status:t,headers:{location:e}})};var _=self.DOMException;try{new _}catch(e){(_=function(e,t){this.message=e,this.name=t;var i=Error(e);this.stack=i.stack}).prototype=Object.create(Error.prototype),_.prototype.constructor=_}function w(e,t){return new Promise(function(i,r){var a=new y(e,t);if(a.signal&&a.signal.aborted)return r(new _("Aborted","AbortError"));var s=new XMLHttpRequest;function o(){s.abort()}s.onload=function(){var e={status:s.status,statusText:s.statusText,headers:function(e){var t=new u;return e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var i=e.split(":"),n=i.shift().trim();if(n){var r=i.join(":").trim();t.append(n,r)}}),t}(s.getAllResponseHeaders()||"")};e.url="responseURL"in s?s.responseURL:e.headers.get("X-Request-URL");var t="response"in s?s.response:s.responseText;i(new g(t,e))},s.onerror=function(){r(new TypeError("Network request failed"))},s.ontimeout=function(){r(new TypeError("Network request failed"))},s.onabort=function(){r(new _("Aborted","AbortError"))},s.open(a.method,a.url,!0),"include"===a.credentials?s.withCredentials=!0:"omit"===a.credentials&&(s.withCredentials=!1),"responseType"in s&&n.blob&&(s.responseType="blob"),a.headers.forEach(function(e,t){s.setRequestHeader(t,e)}),a.signal&&(a.signal.addEventListener("abort",o),s.onreadystatechange=function(){4===s.readyState&&a.signal.removeEventListener("abort",o)}),s.send(void 0===a._bodyInit?null:a._bodyInit)})}w.polyfill=!0,self.fetch||(self.fetch=w,self.Headers=u,self.Request=y,self.Response=g)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getVideoClicks=t.getLinearMedia=t.getLinearDuration=t.getLinearCreative=t.AdPod=void 0;var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=v(i(10)),a=i(1),s=v(i(0)),o=v(i(22)),l=v(i(28)),u=v(i(4)),d=v(i(29)),c=v(i(3)),h=i(14),p=i(15),f=v(i(23));function v(e){return e&&e.__esModule?e:{default:e}}var y=3,m=p.STYLE_OAD,g=p.STYLE_MAD,b=p.STYLE_EAD,_=0,w=function(e){if(!e.InLine||!e.InLine.Creatives)return null;var t=null;return(e.InLine.Creatives.Creative||[]).some(function(e){if(e.Linear)return t=e.Linear,!0}),t},k=function(e){if(!e)return{media:null,index:null};for(var t,i=e.MediaFiles.MediaFile,n=0;(t=i[n])&&"video/mp4"!=t["@attr"].type;n++);return i.length&&!t&&(n=-100),{media:t,index:n}},x=function(e){var t=w(e)||{};return t.Duration&&void 0!==t.Duration["@value"]?t.Duration["@value"]:0},S=function(e){return(e&&e.TrackingEvents||{}).Tracking||[]},E=function(e){var t=w(e);return t?t.VideoClicks||{}:null},T=function(e){var t=null;return(e.InLine.Extensions.Extension||[]).some(function(e){var i=(e.AdParams||e.Adparams||{})["@attr"]||{};if(i.adStyle)return t=i.adStyle,!0}),t},P=function(e,t){return e.filter(function(e){return!((0,h.getAdStyle)(e)!==t||e["@attr"]&&e["@attr"].standby)}).map(function(e){if(e.__error)for(var t,i=0;t=e[i++];){var n=e["@attr"]||{},r=t["@attr"]||{};if(n.master&&n.master==r.standby)return t}return e}).filter(function(e){return!e.__error}).sort(function(e,t){var i=e["@attr"]||{},n=t["@attr"]||{},r=i.sequence,a=n.sequence;return void 0===a?-1:void 0===r?1:r/1-a/1}).sort(function(e,t){var i=T(e);return"preoad"==T(t)?1:"sufoad"==i?-1:0})},A=function(e){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return n.player=e,n.config=i,n._selects=[],n._oads=[],n._eads=[],n._mads=[],n.index=null,n.type=m,n.state=y,n.initEvent(),n.observePlayer(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.EventEmitter),n(t,[{key:"initEvent",value:function(){var e=this;this.on("loaded",function(){e.isEmpty()&&e.reportEmpty()})}},{key:"observePlayer",value:function(){var e=this;this.player.on("timeupdate",function(){return e.onTimeupdate()}),this.player.on("error",function(){return e.onError()}),this.player.on("adv.seg.start",function(t){return e.onAdvSegStart(t)}),this.player.on("adv.seg.ended",function(t){return e.onAdvSegEnded(t)}),this.player.on("adv.ended",function(){return e.onAdvEnded()}),this.player.on("adv.skip",function(){return e.onAdvSkip()}),this.player.on("adv.select.clickOne",function(t){e.soad=t.ads}),this.player.on("adv.linear.click",function(t){var i=t.evt,n=E(e.getDataByIndex()).ClickTracking||[],r=e.macroData,a={oadcx:i.offsetX,oadcy:i.offsetY,displayMetrics:window.screen.width+"*"+window.screen.height};n.forEach(function(e){return(0,h.advPingback)(e["@value"]+"&"+c.default.stringify(a),r)})})}},{key:"reportEmpty",value:function(){var e=this.macroData;this.ads.forEach(function(){(((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).InLine||{}).Impression||[]).forEach(function(t){t.__done||(t.__done=!0,(0,h.advPingback)(t["@value"],e),s.default.log("[\u5e7f\u544a]\u7a7a\u5e7f\u544a\u4e0a\u62a5\u5730\u5740\uff1a\uff1a"+t["@value"]))})})}},{key:"onTimeupdate",value:function(){var e=this;if(this.player.state==this.player.STATE_ADV){for(var t,i=0,n=this.index,r=this.macroData;i<=n&&(t=this.getDataByIndex(i++));)(t.InLine.Impression||[]).forEach(function(t){t.__done||(t.__done=!0,(0,h.advPingback)(t["@value"],r),s.default.log("[\u5e7f\u544a]\u7b2c"+e.index+"\u6bb5\u4e0a\u62a5\u5730\u5740\uff1a\uff1a"+t["@value"]))});if(this.creative){var a,o=this.creative,l=S(o),u=this.player.videoCurrentTime,d=o.Duration["@value"],c=u/d;l.forEach(function(t){if(!t.__done){var i=t["@attr"].event;if("thirdav"==i&&""!=t["@value"]){var n=(new Date).getTime();!t.__mzDone1&&u>=0&&(t.__mzDone1=!0,a=(0,h.getThirdAdUrl)({url:t["@value"],width:e.player.width,height:e.player.height,vx:0,randomNum:n}),a.split("|").forEach(function(t){(0,h.advPingback)(t),s.default.log("[\u5e7f\u544a]\u7b2c"+e.index+"\u6bb5\u79d2\u9488\u53ef\u89c1\u4e0a\u62a5\u5730\u5740\uff1a\uff1a"+t)})),!t.__mzDone2&&u>=2&&u<d&&window.isHalfInScreen()&&window.isHalfInView()&&window.getPageFocus()&&(t.__mzDone2=!0,a=(0,h.getThirdAdUrl)({url:t["@value"],width:e.player.width,height:e.player.height,vx:1,randomNum:n}),a.split("|").forEach(function(t){(0,h.advPingback)(t),s.default.log("[\u5e7f\u544a]\u7b2c"+e.index+"\u6bb5\u7b2c\u4e09\u65b9\u5e7f\u544a\u4e0a\u62a5\u5730\u5740\uff1a\uff1a"+t)})),!t.__mzDone2&&u>=d&&(t.__mzDone2=!0,a=(0,h.getThirdAdUrl)({url:t["@value"],width:e.player.width,height:e.player.height,vx:4,randomNum:n}),a.split("|").forEach(function(t){(0,h.advPingback)(t),s.default.log("[\u5e7f\u544a]\u7b2c"+e.index+"\u6bb5\u79d2\u9488\u53ef\u89c1\u66dd\u5149\u4e0a\u62a5\u5730\u5740\uff1a\uff1a"+t)}))}!t.__done&&(-1!=["creativeView, start"].indexOf(i)||"firstQuartile"==i&&c>=.25||"midpoint"==i&&c>=.5||"thirdQuartile"==i&&c>=.75||"progress"==i&&u>=t["@attr"].offset)&&(t.__done=!0,void 0!=t["@value"]&&((0,h.advPingback)(t["@value"],r),s.default.log("[\u5e7f\u544a]\u7b2c"+e.index+"\u6bb5\u4e2d\u95f4\u4e0a\u62a5\u5730\u5740"+t["@value"])))}})}}}},{key:"onError",value:function(e){var t=this.macroData;e&&(t["[ERRORCODE]"]=e),((this.getDataByIndex()||{}).Error||[]).forEach(function(e){return(0,h.advPingback)(e,t)})}},{key:"onAdvSegStart",value:function(e){var t=e.index;this.index=t}},{key:"onAdvSegEnded",value:function(e){var t=this;if(1!==e){var i=this.creative,n=S(i),r=this.macroData;n.forEach(function(e){if(!e.__done){var i=e["@attr"].event;e.__done||"complete"!=i||(e.__done=!0,(0,h.advPingback)(e["@value"],r),s.default.log("[\u5e7f\u544a]\u7b2c"+t.index+"\u6bb5\u7ed3\u675f\u4e0a\u62a5\u5730\u5740"+e["@value"]))}})}}},{key:"onAdvEnded",value:function(){for(var e,t=0;e=this.getDataByIndex(t++);)(e.InLine.Impression||[]).forEach(function(e){e.__done||(e.__done=!0,(0,h.advPingback)(e["@value"]),s.default.log("[\u5e7f\u544a]\u6240\u6709\u5e7f\u544a\u7ed3\u675f\u4e0a\u62a5\u5730\u5740"+e["@value"]))});this.type===b?(this._selects=[],this._oads=[],this._eads=[],this.type=m):this.type===g&&(this._mads=[]),this.state=y,this.index=null,this._duration=0,this._skipDuration=0}},{key:"onAdvSkip",value:function(){var e=this.creative,t=S(e),i=this.macroData;t.forEach(function(e){if(!e.__done){var t=e["@attr"].event;e.__done||"skip"!=t||(e.__done=!0,(0,h.advPingback)(e["@value"],i),s.default.log("[\u5e7f\u544a]\u8df3\u8fc7\u5e7f\u544a\u4e0a\u62a5\u5730\u5740"+e["@value"]))}})}},{key:"loadData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.index,n=t.count,a=t.ptime;if(this.state===y){this.state=1;var o={};switch(this.type){case m:o.pt="";break;case g:o.pt="mad",o.inx=i,o.tot=n,o.ptime=a;break;case b:o.pt="ead"}this.isIgnorePrePod?o.ooab=1:o.ooab=0,function(t){var i=(0,f.default)(e.player,o);s.default.log("[\u5e7f\u544a]pod adv --\x3e ",i),(0,r.default)(i,{credentials:"include"},3e3).then(function(i){if(t===_)return i.ok?i.text():(e.cancel(),e.emit("load.error",new Error))}).then(function(t){return e.process(t)}).catch(function(t){s.default.error("[\u5e7f\u544a]pre-roll error--\x3e",t),e.cancel(),e.emit("load.error",t)})}(++_)}}},{key:"process",value:function(e){var t=this;if(1!=this.state)return this.state=y;this.state=2,(0,d.default)(e).then(function(e){e.Ad||(e.Error||[]).forEach(function(e){var t=e["@value"];(0,l.default)(o.default,function(e){return(0,h.macroURL)(e,{"[ERRORCODE]":"303"})})(t)});var i=e.Ad;t.type===g?(t._mads=P(i,p.STYLE_MAD),s.default.log("[\u5e7f\u544a]linear mad--\x3e",t._mads)):(t.vast=e,1==t.player.config.data.isMiniPlayer?t._eads=[]:t._eads=P(i,p.STYLE_EAD),t.isIgnorePrePod||1==t.player.config.data.isMiniPlayer?(t._oads=[],t._selects=[]):(t._oads=P(i,p.STYLE_OAD),t._selects=P(i,p.STYLE_SELECT))),t._duration=t.ads.reduce(function(e,t){return e+x(t)},0),t.ads[0].InLine.Creatives.Creative[0].Linear["@attr"]&&(t._skipDuration=t.ads[0].InLine.Creatives.Creative[0].Linear["@attr"].skipoffset),setTimeout(function(){return t.emit("loaded",t._selects)},0)}).catch(function(e){s.default.error("[\u5e7f\u544a]load.error"+e),t.emit("load.error",e)})}},{key:"cancel",value:function(){1==this.state&&(this.state=y)}},{key:"isEmpty",value:function(){return 0===this.duration}},{key:"getDataByIndex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.index;return this.ads[e]}},{key:"macroData",get:function(){var e=this.creative,t=k(e).media;return{"[CONTENTPLAYHEAD]":this.player.videoCurrentTime,"[ASSETURI]":t&&t["@value"]?t["@value"]:"","[ERRORCODE]":"0","[SKIPTIME]":Math.floor(this.player.videoCurrentTime)}}},{key:"creative",get:function(){return w(this.getDataByIndex()||{})}},{key:"isIgnorePrePod",get:function(){var e=this,t=!1;if(this.type===m){var i=function(){var t=e.player.storage.__shtvid__||null;return t?{tvid:(t=t.split("@"))[0],time:parseInt(t[1])}:{tvid:null,time:0}}(),n=i.tvid,r=i.time;this.player.dataModel.tvid==n&&Date.now()-r<=3e5&&(t=!0)}return t}},{key:"ads",get:function(){var e=null;switch(this.type){case m:e=this.player.isSelect?this.soad:this._oads;break;case g:e=this._mads;break;case b:e=this._eads}return e}},{key:"duration",get:function(){return this._duration}},{key:"skipDuration",get:function(){return this._skipDuration}},{key:"type",set:function(e){this._type=e,this.type===b&&(this._duration=this.ads.reduce(function(e,t){return e+x(t)},0),this.isEmpty()&&this.reportEmpty())},get:function(){return this._type}}]),t}();u.default.extend(A.prototype,{PRE_ROLL:m,MID_ROLL:g,POST_ROLL:b}),t.AdPod=A,t.getLinearCreative=w,t.getLinearDuration=x,t.getLinearMedia=k,t.getVideoClicks=E},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PauseAdv=void 0;var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(9);var a=function(e){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i.pt="pad";var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return n.tid=null,n.observePlayer(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.NonLinearAdv),n(t,[{key:"observePlayer",value:function(){var e=this,t=this.player;this.player.on("pause.nonlinear.start",function(){return e.onStart()}),this.player.on("pause.nonlinear.end",function(){return e.onEnded()}),this.player.on("pause.nonlinear.click",function(){return e.onClick()}),this.player.on("pause",function(){e.player.state!=e.player.STATE_MOIVE||e.player.panelZlock||(clearTimeout(e.tid),e.tid=setTimeout(function(){t.state===t.STATE_MOIVE&&t.paused&&!e.player.movieEnded&&e.loadData()},500))}),this.player.on("playing",function(){return e.cancel()}),this.player.on("play",function(){return e.cancel()})}},{key:"cancel",value:function(){clearTimeout(this.tid),function e(t,i,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,i);if(void 0===r){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in r)return r.value;var s=r.get;return void 0!==s?s.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"cancel",this).call(this)}}]),t}();t.PauseAdv=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFlogoLocation=t.FlogoAdv=void 0;var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(e){return e&&e.__esModule?e:{default:e}}(i(25)),a=i(9);var s=function(e,t,i){return e&&"string"==typeof t?((((e.InLine||{}).Extensions||{}).Extension||[]).some(function(e){var i=e.AdParams,r=void 0===i?{}:i;if(r[t])return n=r[t]["@value"],!0}),void 0===n&&void 0!==i?i:n):null;var n},o=function(e,t){if(!t)return null;var i=t["@attr"]||{};return void 0!==i[e]?i[e]:null},l=(0,r.default)(o)("minSuggestedDuration"),u=(0,r.default)(o)("intervalDuration"),d=function(e){var t=(0,a.getNonLinear)(e).nonLinear,i=l(t);return i&&i>=36e3},c=function(e){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i.pt="flogo";var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return n.displayEd=!1,n.displaying=!1,n.autoHideTimer=null,n.intervalTimer=null,n.initEvent(),n.observePlayer(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.NonLinearAdv),n(t,[{key:"observePlayer",value:function(){var e=this,t=this.player;t.on("pre.vast.loaded",function(t){e._ads=e.filter(t.Ad||[]),e.isEmpty()&&e.reportEmpty()}),t.on("playing",function(){return e.display()}),t.on("adv.flogo.start",function(){e.displaying=!0,e.onStart();var t=(0,a.getNonLinear)(e.ads),i=t.nonLinear,n=function(e){return s(e,"display",0)}(t.ad),r=u(i);d(e.ads)||(clearTimeout(e.autoHideTimer),e.autoHideTimer=setTimeout(function(){e.autoHideTimer=null,e.autoHide()},1e3*n),r&&(e.intervalTimer=setTimeout(function(){e.intervalTimer=null,e.loadData()},1e3*r)))}),t.on("adv.flogo.end",function(){clearTimeout(e.autoHideTimer),e.autoHideTimer=null,e.displaying=!1,e.onEnded()}),t.on("adv.flogo.click",function(){return e.onClick()}),t.on("movie.ended",function(){e.autoHide(),clearTimeout(e.autoHideTimer),clearTimeout(e.intervalTimer),e.autoHideTimer=null,e.intervalTimer=null,e.displaying=!1,e.displayEd=!1,e._ads=[]})}},{key:"initEvent",value:function(){var e=this;this.on("loaded",function(){e.isEmpty()?e.reportEmpty():(e.displaying&&e.autoHide(),e.displayEd=!1,e.display())})}},{key:"autoHide",value:function(){this.emit("autohide")}},{key:"display",value:function(){var e=this,t=this.player;if(t.state!==t.STATE_MOIVE||this.displayEd||this.isEmpty()||(this.displayEd=!0,d(this.ads)&&(this.ads.__fulltime=!0),this.emit("display",this.ads)),t.state===t.STATE_MOIVE&&this.isEmpty()){this.displayEd=!0;var i=(0,a.getNonLinear)(this.ads).nonLinear,n=u(i);n&&!this.intervalTimer&&(this.intervalTimer=setTimeout(function(){e.intervalTimer=null,e.loadData()},1e3*n))}}}]),t}();t.FlogoAdv=c,t.getFlogoLocation=function(e){return s(e,"flogolocation",1)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBandLocation=t.BandAdv=void 0;var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=u(i(3)),a=u(i(23)),s=u(i(10)),o=u(i(0)),l=i(9);function u(e){return e&&e.__esModule?e:{default:e}}var d=3,c=function(e,t,i){return e&&"string"==typeof t?((((e.InLine||{}).Extensions||{}).Extension||[]).some(function(e){var i=e.AdParams,r=void 0===i?{}:i;if(r[t])return n=r[t]["@value"],!0}),void 0===n&&void 0!==i?i:n):null;var n},h=function(e){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i.pt="band";var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return n.displaying=!1,n.autoHideTimer=null,n.state=d,n.initEvent(),n.observePlayer(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,l.NonLinearAdv),n(t,[{key:"observePlayer",value:function(){var e=this,t=this.player;t.on("data.ok",function(t){var i=t,n={vid:t.vid,tvid:t.tvid,vc:t.catecode,du:t.duration};e.loadPoData(n).then(function(e){i.bandpo=e,2==e.length&&o.default.log("[\u5e7f\u544a]\u70b9\u4f4dband info=="+e[0].band_t,e[1].band_t)})}),t.on("adv.band.start",function(){e.displaying=!0,e.ads&&e.ads.length!=[]&&e.onStart();var t=function(e){return c(e,"display",8)}((0,l.getNonLinear)(e.ads).ad);clearTimeout(e.autoHideTimer),e.autoHideTimer=setTimeout(function(){e.autoHideTimer=null,e.autoHide()},1e3*t)}),t.on("adv.band.click",function(){return e.onClick()}),t.on("movie.ended",function(){e.autoHide(),clearTimeout(e.autoHideTimer),e.autoHideTimer=null,e.displaying=!1})}},{key:"initEvent",value:function(){var e=this;this.on("loaded",function(){e.isEmpty()?e.reportEmpty():e.displaying&&e.autoHide()})}},{key:"autoHide",value:function(){this.emit("autohide"),this.displaying=!1,this.state=d}},{key:"loadData",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).ptime;if(this.state===d){this.state=1;var i={pt:"band"};i.ptime=t,function(){var t=(0,a.default)(e.player,i);o.default.log("[\u5e7f\u544a]band --\x3e ",t),(0,s.default)(t,{credentials:"include"},3e3).then(function(e){if(e.ok)return e.text()}).then(function(t){return e.process(t)}).catch(function(t){o.default.error("[\u5e7f\u544a]band error--\x3e",t),e.cancel()})}(0)}}},{key:"loadPoData",value:function(e){return new Promise(function(t,i){fetch("//v.aty.sohu.com/band?"+r.default.stringify(e)).then(function(e){if(e.ok)return e.json();throw Error(e.statusText)}).then(function(e){return t(e)}).catch(function(e){return i(e)})})}}]),t}();t.BandAdv=h,t.getBandLocation=function(e){return c(e,"bandlocation",1)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CtrlAdv=void 0;var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(9);var a=function(e){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i.pt="ctrlAd";var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return n.initEvent(),n.observePlayer(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.NonLinearAdv),n(t,[{key:"initEvent",value:function(){var e=this;this.on("loaded",function(){e.isEmpty()?e.reportEmpty():e.display()})}},{key:"observePlayer",value:function(){var e=this;this.player.on("pre.vast.loaded",function(t){e._ads=e.filter(t.Ad||[]),e.isEmpty()&&e.reportEmpty()}),this.player.on("playing",function(){return e.display()}),this.player.on("movie.ended",function(){e._ads=[]}),this.player.on("adv.ctrlAd.click",function(){return e.onClick()})}},{key:"display",value:function(){this.isEmpty()||(this.emit("display",this.ads),this.onStart())}}]),t}();t.CtrlAdv=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BackgroundAdv=void 0;var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(9),a=function(e){return e&&e.__esModule?e:{default:e}}(i(0));var s=function(e){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i.pt="wrapframe";var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return n.initEvent(),n.observePlayer(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.NonLinearAdv),n(t,[{key:"observePlayer",value:function(){var e=this;this.player.on("adv.bgAd.click",function(){return e.onClick()}),this.player.on("adv.bgad.start",function(){return e.onStart()})}},{key:"initEvent",value:function(){var e=this;this.on("loaded",function(t){try{e.duration=t[0].InLine.Creatives.Creative[0].NonLinearAds.NonLinear[0]["@attr"].minSuggestedDuration,e.source=t[0].InLine.Creatives.Creative[0].NonLinearAds.NonLinear[0].StaticResource[0]["@value"],e.source&&""!=e.source||a.default.log("[\u4e3b\u64ad\u653e\u5668]\u80cc\u666f\u5e7f\u544a\u6570\u636e\u4e3a\u7a7a")}catch(e){a.default.log("[\u4e3b\u64ad\u653e\u5668]\u80cc\u666f\u5e7f\u544a\u6570\u636e\u4e3a\u7a7a")}e.isEmpty()&&e.reportEmpty()})}},{key:"hasAd",get:function(){return!(!this.source||""==this.source)}},{key:"bgAdDuration",get:function(){return this.duration}}]),t}();t.BackgroundAdv=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(1),a=l(i(13)),s=l(i(0)),o=l(i(2));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.ui=e,i.player=e.player,i.init(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.EventEmitter),n(t,[{key:"init",value:function(){var e=this.ui.container;this.pauseNonLinearPanel=e.querySelector(".x-adv-pause-nonlinear-panel"),this.pauseNonLinearInner=this.pauseNonLinearPanel.querySelector(".x-adv-pause-nonlinear-inner"),this.initEvent()}},{key:"initEvent",value:function(){var e=this;this.observePlayer(),this.pauseNonLinearPanel.addEventListener("click",function(t){if(t.stopPropagation(),t.target.classList.contains("x-adv-pause-nonlinear-close-btn"))return e.hide();for(var i=t.target;e.pauseNonLinearPanel.contains(i);){if(i.classList.contains("x-adv-nonlinear-link"))return setTimeout(function(){return e.emit("pause.nonlinear.click")},0);i=i.parentNode}}),this.ui.on("fullscreenchange",function(){return e.resize()})}},{key:"observePlayer",value:function(){var e=this;this.player.on("data.ok",function(){return e.inCommon=!0}),this.player.on("resize",function(){return e.resize()}),this.player.on("pause.nonlinear.start",function(t){e.player.isMiniH5||e.show(t)}),this.player.on("playing",function(){return e.hide()}),this.player.on("play",function(){return e.hide()}),this.player.on("data.exception",function(){return e.hide()}),this.player.on("player-state",function(t){var i="none";0==t?i="none":e.isShowing&&(i="block"),o.default.css(e.pauseNonLinearPanel,"display",i),e.inCommon=0!=t,s.default.log("[\u5e7f\u544a]\u6682\u505c\u5e7f\u544a\u753b\u4e2d\u753b\u6a21\u5f0f\uff1a"+e.inCommon)}),this.player.on("adv.bgad.start",function(){e.bgadState=!0,e.isShowing&&o.default.css(e.pauseNonLinearPanel,"display","none")}),this.player.on("adv.bgad.hide",function(){e.bgadState=!1,e.isShowing&&o.default.css(e.pauseNonLinearPanel,"display","block")})}},{key:"show",value:function(e){var t=this;if(!this.bgadState){this.isShowing=!0;var i=(0,a.default)(e),n=i.content,r=i.width,s=i.height,l=i.hardflag;this.pauseNonLinearInner.innerHTML=n,this.pauseNonLinearPanel.dataset.width=r,this.pauseNonLinearPanel.dataset.height=s,this.pauseNonLinearPanel.style.display="block",0!=l?this.pauseNonLinearPanel.classList.add("x-adv-hardflag-type-"+l):[1,2,3,4].forEach(function(e){return t.pauseNonLinearPanel.classList.remove("x-adv-hardflag-type-"+e)}),this.resize(),o.default.css(this.pauseNonLinearPanel,"display",this.inCommon?"block":"none")}}},{key:"hide",value:function(){this.isShowing=!1,"block"===this.pauseNonLinearPanel.style.display&&(this.pauseNonLinearPanel.style.display="none",this.emit("pause.nonlinear.end"))}},{key:"resize",value:function(){function e(e,t){return"%"===t||r?e:5*e/8}var t=/^\d+(\S*)$/,i=this.pauseNonLinearPanel.dataset.width,n=this.pauseNonLinearPanel.dataset.height,r=this.player.isFullscreen(),a=this.width,s=this.height;i=(i||"").replace(",",""),n=(n||"").replace(",","");var o=parseInt(i),l=parseInt(n);t.test(i);var u=RegExp.$1||"px";t.test(n);var d=RegExp.$1||"px";i<640&&n<480?(i=parseInt(i),n=parseInt(n)):(i=e(parseInt(i),u),n=e(parseInt(n),d)),i>a&&(n=(i=a)*l/o),n>s&&(i=(n=s)*o/l),i+=u,n+=d,this.pauseNonLinearPanel.style.width=i,this.pauseNonLinearPanel.style.height=n;var c=parseInt(this.pauseNonLinearPanel.style.width),h=parseInt(this.pauseNonLinearPanel.style.height);this.pauseNonLinearPanel.style.marginLeft=c/-2+"px",this.pauseNonLinearPanel.style.marginTop=h/-2+"px"}}]),t}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(1),a=l(i(13)),s=l(i(2)),o=i(12);function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.ui=e,i.player=e.player,i.bgadState=!1,i.init(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.EventEmitter),n(t,[{key:"init",value:function(){var e=this.ui.container;this.flogoPanel=e.querySelector(".x-adv-flogo-panel"),this.flogoInner=e.querySelector(".x-adv-flogo-inner"),this.initEvent()}},{key:"initEvent",value:function(){var e=this;this.observePlayer(),this.flogoPanel.addEventListener("click",function(t){if(t.stopPropagation(),t.target.classList.contains("x-adv-flogo-close-btn"))return e.hide();for(var i=t.target;e.flogoPanel.contains(i);){if(i.classList.contains("x-adv-nonlinear-link"))return setTimeout(function(){return e.emit("adv.flogo.click")},0);i=i.parentNode}}),this.ui.on("dashboard.show",function(){return e.resetPoition()}),this.ui.on("dashboard.hide",function(){return e.resetPoition()}),this.ui.on("fullscreenchange",function(){return e.resetPoition()})}},{key:"observePlayer",value:function(){var e=this;this.player.on("data.ok",function(){return e.inCommon=!0}),this.player.on("resize",function(){return e.resetPoition()}),this.player.on("adv.flogo.start",function(t){return e.show(t)}),this.player.on("adv.flogo.autohide",function(){return e.hide()}),this.player.on("player-state",function(t){var i="none";0==t?i="none":e.isShowing&&(i="block"),s.default.css(e.flogoPanel,"display",i),e.inCommon=0!=t}),this.player.on("adv.bgad.start",function(){e.bgadState=!0,e.isShowing&&s.default.css(e.flogoPanel,"display","none")}),this.player.on("adv.bgad.hide",function(){e.bgadState=!1,e.isShowing&&s.default.css(e.flogoPanel,"display","block")})}},{key:"show",value:function(e){var t=this;if(!this.bgadState){this.isShowing=!0;var i=(0,a.default)(e),n=i.content,r=i.width,l=i.height,u=i.hardflag;this.flogoInner.innerHTML=n,this.flogoPanel.style.width=r+"px",this.flogoPanel.style.height=l+"px",this.flogoPanel.style.display="block",this.flogoPanel.querySelector(".x-adv-flogo-close-btn").style.display=e.__fulltime?"none":"block";var d=(0,o.getNonLinear)(e).ad,c=(0,o.getFlogoLocation)(d),h="x-adv-flogo-right";1==c?h="x-adv-flogo-right":2==c&&(h="x-adv-flogo-left"),this.flogoPanel.classList.add(h),0!=u?this.flogoPanel.classList.add("x-adv-hardflag-type-"+u):[1,2,3,4].forEach(function(e){return t.flogoPanel.classList.remove("x-adv-hardflag-type-"+e)}),s.default.css(this.flogoPanel,"display",this.inCommon?"block":"none"),this.resetPoition()}}},{key:"resetPoition",value:function(){var e=this.player.dataModel;if(e){var t,i,n,r=this.width,a=this.height,s=e.width,o=e.height;s/o>r/a?(t=(a-r*o/s)/2+5,this.flogoPanel.classList.contains("x-adv-flogo-left")?i=5:n=5):(this.flogoPanel.classList.contains("x-adv-flogo-left")?i=(r-a*s/o)/2+5:n=(r-a*s/o)/2+5,t=5),this.ui.isDashBoardDisplaying()&&(t=Math.max(t,70)),this.flogoPanel.style.bottom=t+"px",i&&(this.flogoPanel.style.left=i+"px"),n&&(this.flogoPanel.style.right=n+"px")}}},{key:"hide",value:function(){this.isShowing=!1,"block"===this.flogoPanel.style.display&&(this.flogoPanel.style.display="none",this.emit("adv.flogo.close"))}}]),t}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(1),s=u(i(13)),o=u(i(2)),l=i(12);function u(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.ui=e,i.player=e.player,i.init(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.EventEmitter),r(t,[{key:"init",value:function(){var e=this.ui.container;this.bandPanel=e.querySelector(".x-adv-band-panel"),this.bandInner=e.querySelector(".x-adv-band-inner"),this.initEvent()}},{key:"initEvent",value:function(){var e=this;this.observePlayer(),this.bandPanel.addEventListener("click",function(t){t.stopPropagation();for(var i=t.target;e.bandPanel.contains(i);){if(i.classList.contains("x-adv-nonlinear-link"))return setTimeout(function(){return e.emit("adv.band.click")},0);i=i.parentNode}}),this.ui.on("dashboard.show",function(){return e.resetPosition()}),this.ui.on("dashboard.hide",function(){return e.resetPosition()}),this.ui.on("fullscreenchange",function(){return e.resetPosition()})}},{key:"observePlayer",value:function(){var e=this;this.player.on("data.ok",function(){return e.inCommon=!0}),this.player.on("resize",function(){return e.resetPosition()}),this.player.on("adv.band.start",function(t){return e.show(t)}),this.player.on("adv.band.autohide",function(){return e.hide()}),this.player.on("player-state",function(t){var i="none";0==t?i="none":e.isShowing&&(i="block"),o.default.css(e.bandPanel,"display",i),e.inCommon=0!=t})}},{key:"show",value:function(e){var t=this;this.isShowing=!0;var i=(0,s.default)(e),r=i.content,a=i.width,u=i.height,d=i.hardflag;this.bandInner.innerHTML=r,n=a,this.bandPanel.style.width=a+"px",this.bandPanel.style.height=u+"px",this.bandPanel.style.display="block";var c=(0,l.getNonLinear)(e).ad,h=(0,l.getBandLocation)(c),p="x-adv-band-right";1==h?p="x-adv-band-right":2==h?p="x-adv-band-left":3==h&&(p="x-adv-band-center"),this.bandPanel.classList.add(p),0!=d?this.bandPanel.classList.add("x-adv-hardflag-type-"+d):[1,2,3,4].forEach(function(e){return t.bandPanel.classList.remove("x-adv-hardflag-type-"+e)}),o.default.css(this.bandPanel,"display",this.inCommon?"block":"none"),this.resetPosition()}},{key:"resetPosition",value:function(){var e=this.player.dataModel;if(e){var t,i,r,a,s=this.width,o=this.height,l=e.width,u=e.height;l/u>s/o?(t=(o-s*u/l)/2+5,this.bandPanel.classList.contains("x-adv-band-left")?i=5:this.bandPanel.classList.contains("x-adv-band-right")?r=5:a=(this.player.width-n)/2):this.bandPanel.classList.contains("x-adv-band-left")?i=(s-o*l/u)/2+5:this.bandPanel.classList.contains("x-adv-band-right")?r=(s-o*l/u)/2+5:a=(this.player.width-n)/2,t=5,this.ui.isDashBoardDisplaying()&&(t=Math.max(t,70)),this.bandPanel.style.bottom=t+"px",i&&(this.bandPanel.style.left=i+"px"),r&&(this.bandPanel.style.right=r+"px"),a&&(this.bandPanel.style.left=a+"px")}}},{key:"hide",value:function(){this.isShowing=!1,"block"===this.bandPanel.style.display&&(this.bandPanel.style.display="none",this.emit("adv.band.close"))}}]),t}();t.default=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(1),a=function(e){return e&&e.__esModule?e:{default:e}}(i(13));var s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.ui=e,i.player=e.player,i.init(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.EventEmitter),n(t,[{key:"init",value:function(){var e=this.ui.container;this.ctrlAdPanel=e.querySelector(".x-adv-ctrlBar-panel"),this.ctrlAdInner=e.querySelector(".x-adv-ctrlBar-inner"),this.initEvent()}},{key:"initEvent",value:function(){var e=this;this.observePlayer(),this.ctrlAdPanel.addEventListener("click",function(t){t.stopPropagation(),e.emit("adv.ctrlAd.click")})}},{key:"observePlayer",value:function(){var e=this;this.player.on("resize",function(){return e.resetPoition()}),this.player.on("adv.ctrlAd.show",function(t){return e.show(t)})}},{key:"show",value:function(e){var t=this,i=(0,a.default)(e),n=i.content,r=i.width,s=i.height,o=i.hardflag;this.ctrlAdInner.innerHTML=n,this.width=r,this.height=s,this.ctrlAdInner.style.height=s+"px",this.ctrlAdPanel.style.height=s+"px",this.ctrlAdPanel.style.width=r+"px",0!=o?this.ctrlAdPanel.classList.add("x-adv-hardflag-type-"+o):[1,2,3,4].forEach(function(e){return t.ctrlAdPanel.classList.remove("x-adv-hardflag-type-"+e)}),this.resetPoition()}},{key:"resetPoition",value:function(){var e,t;this.player.width-160-270<280?this.ctrlAdPanel.style.display="none":(this.ctrlAdPanel.style.display="block",e=(this.player.width+160-270-this.width)/2,t=10,this.ctrlAdPanel.style.left=e+"px",this.ctrlAdPanel.style.bottom=t+"px")}},{key:"hide",value:function(){"block"===this.ctrlAdPanel.style.display&&(this.ctrlAdPanel.style.display="none",this.emit("adv.ctrlAd.close"))}}]),t}();t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(1),a=function(e){return e&&e.__esModule?e:{default:e}}(i(13));var s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.ui=e,i.player=e.player,i.init(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.EventEmitter),n(t,[{key:"init",value:function(){var e=this.ui.container;this.videoPanel=e.querySelector(".x-video"),this.bgAdPanel=e.querySelector(".x-adv-bg-panel"),this.bgAdInner=e.querySelector(".x-adv-bg-inner"),this.initEvent()}},{key:"initEvent",value:function(){var e=this;this.observePlayer(),this.bgAdPanel.addEventListener("click",function(t){t.stopPropagation();for(var i=t.target;e.bgAdPanel.contains(i);){if(i.classList.contains("x-adv-nonlinear-link"))return setTimeout(function(){return e.emit("adv.bgAd.click")},0);i=i.parentNode}})}},{key:"observePlayer",value:function(){var e=this;this.player.on("data.ok",function(){e.inCommon=!0,e.hide()}),this.player.on("resize",function(){e.isSafari()&&e.player.isFullscreen()?setTimeout(function(){e.resize()},500):e.resize()}),this.player.on("adv.bgad.start",function(t){return e.show(t)}),this.player.on("adv.bgad.hide",function(){return e.hide()}),this.player.on("movie.ended",function(){return e.hide()}),this.player.on("player-state",function(){return e.resize()})}},{key:"show",value:function(e){var t=this;this.isShowing=!0,this.videoPanel.classList.add("x-video-bgad");var i=(0,a.default)(e),n=i.content,r=i.width,s=i.height,o=i.hardflag,l=e[0].InLine.Extensions.Extension[0].AdParams.baseColor&&e[0].InLine.Extensions.Extension[0].AdParams.baseColor["@value"]||"#000";this.ui.container.style.background=l,this.bgAdInner.innerHTML=n,this.bgAdPanel.dataset.width=r,this.bgAdPanel.dataset.height=s,this.bgAdPanel.style.width=this.player.width+"px",this.bgAdPanel.style.height=this.player.height+"px",this.bgAdPanel.style.display="block",0!=o?this.bgAdPanel.classList.add("x-adv-hardflag-type-"+o):[1,2,3,4].forEach(function(e){return t.bgAdPanel.classList.remove("x-adv-hardflag-type-"+e)}),this.resize()}},{key:"hide",value:function(){this.isShowing=!1,this.ui.container.style.background="#000",this.videoPanel.classList.remove("x-video-bgad"),"block"===this.bgAdPanel.style.display&&(this.bgAdPanel.style.display="none")}},{key:"resize",value:function(){var e,t=this.bgAdPanel.dataset.width,i=this.bgAdPanel.dataset.height,n=this.player.width,r=this.player.height,a=n/t,s=r/i;e=a<=s?a:s,a<s?(this.bgAdPanel.style.marginTop=(r-i*e)/2+"px",this.bgAdPanel.style.marginLeft=0):(this.bgAdPanel.style.marginLeft=(n-t*e)/2+"px",this.bgAdPanel.style.marginTop=0),this.bgAdPanel.style.width=t*e+"px",this.bgAdPanel.style.height=i*e+"px"}},{key:"isSafari",value:function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("safari")>=0&&e.indexOf("chrome")<0}}]),t}();t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(1),a=c(i(5)),s=i(26),o=c(i(0)),l=c(i(2)),u=c(i(24)),d=c(i(31));function c(e){return e&&e.__esModule?e:{default:e}}var h={ctxmenu:'<%@ h:helper %>\n  <div class="x-ctx-menu-item" data-role="x-copy-log-btn">\u590d\u5236\u8c03\u8bd5\u4fe1\u606f</div>\n  <div class="x-ctx-menu-item x-ctx-show-logPanel">\u67e5\u770blog\u4fe1\u606f</div>\n  <div class="x-ctx-menu-item x-ctx-feedback">\u610f\u89c1\u53cd\u9988</div>\n  <div class="x-ctx-menu-item">H5player:<%= version %></div>\n  <div class="x-ctx-menu-item">p2p:<%= p2pver %></div>\n'},p=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.ui=e,i.player=e.player,i.init(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.EventEmitter),n(t,[{key:"init",value:function(){this.ctxmenuPanel=document.createElement("div"),this.ctxmenuPanel.classList.add("x-ctx-menu-panel"),this.ctxmenuPanel.innerHTML=a.default.render(h.ctxmenu,{version:this.dataFormat(this.player.version),p2pver:this.player.p2pver}),document.body.appendChild(this.ctxmenuPanel),this.initEvent()}},{key:"initEvent",value:function(){var e=this,t=this.ui.container;document.addEventListener("click",function(){return e.hide()},!1),document.addEventListener("contextmenu",function(){return e.hide()},!1),t.addEventListener("click",function(){return e.hide()},!1),this.ctxmenuPanel.addEventListener("contextmenu",function(e){e.stopPropagation(),e.preventDefault()}),this.ctxmenuPanel.addEventListener("click",function(t){t.stopPropagation(),t.preventDefault(),e.hide()}),t.addEventListener("contextmenu",function(t){if(t.stopPropagation(),t.preventDefault(),!(s.browser.safari&&parseInt(s.browser.version)<10)){e.show();var i=t.clientX,n=t.clientY,r=l.default.width(e.ctxmenuPanel),a=l.default.height(e.ctxmenuPanel),o=document.documentElement.clientWidth,u=document.documentElement.clientHeight;i=Math.min(i,o-r),n=Math.min(n,u-a),e.ctxmenuPanel.style.top=n+"px",e.ctxmenuPanel.style.left=i+"px"}},!1),this.ui.on("fs",function(){t.appendChild(e.ctxmenuPanel)}),this.ui.on("exitfs",function(){document.body.appendChild(e.ctxmenuPanel)}),this.ctxmenuPanel.querySelector('[data-role="x-copy-log-btn"]').addEventListener("click",function(){try{u.default.copy(o.default.stringify()),e.ui.showBezel("\u5df2\u590d\u5236")}catch(e){o.default.error("[\u4e3b\u64ad\u653e\u5668]log copy e--\x3e",e)}}),this.ctxmenuPanel.querySelector(".x-ctx-show-logPanel").addEventListener("click",function(){e.ui.showLogPanel()}),this.ctxmenuPanel.querySelector(".x-ctx-feedback").addEventListener("click",function(){d.default.getLogId()})}},{key:"show",value:function(e,t){"number"==typeof e&&(this.ctxmenuPanel.style.left=e+"px"),"number"==typeof t&&(this.ctxmenuPanel.style.top=t+"px"),this.ctxmenuPanel.style.display="block"}},{key:"hide",value:function(){this.ctxmenuPanel.style.display="none"}},{key:"dataFormat",value:function(e){return"[object Date]"!={}.toString.call(e)&&(e=new Date(parseInt(e))),e.getMonth()+1+"."+e.getDate()+"."+e.getHours()+e.getMinutes()}}]),t}();t.default=p},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e){var t="";return"INPUT"!=e.nodeName&&"TEXTAREA"!=e.nodeName||(e.select(),e.setSelectionRange(0,e.value.length),t=e.value),t}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(1);var a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.ui=e,i.player=e.player,i.init(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.EventEmitter),n(t,[{key:"init",value:function(){this.container=this.ui.container,this.vipPanel=this.container.querySelector(".x-vip-panel"),this.vipCloseBtn=this.container.querySelector(".x-vip-close-btn"),this.initEvent(),this.observePlayer()}},{key:"initEvent",value:function(){var e=this;this.vipCloseBtn.addEventListener("click",function(t){t.stopPropagation(),e.container.classList.remove("x-s-vip-panel"),e.player.play(),e.emit("vip-panel-c"),e.ui.txidPing("pl_goldvip_close")},!1),this.vipPanel.addEventListener("click",function(t){t.stopPropagation(),"A"==t.target.tagName&&e.ui.txidPing("pl_goldvip_click")},!1)}},{key:"observePlayer",value:function(){var e=this;this.player.on("data.exception",function(t){103==t.code&&(e.container.classList.add("x-s-vip-panel"),e.ui.dashTip.hide(),e.player.pause(),e.ui.txidPing("pl_goldvip_show"),e.emit("vip-panel-s"))})}}]),t}();t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(1),a=i(11),s=function(e){return e&&e.__esModule?e:{default:e}}(i(2));var o=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.ui=e,i.player=e.player,i.init(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.EventEmitter),n(t,[{key:"init",value:function(){var e=this.ui.container;this.playBtn=e.querySelector(".x-play-btn"),this.ui.addTipAbility(this.playBtn),this.initEvent(),new a.PlayBtnAnimation(this.ui,this.playBtn)}},{key:"initEvent",value:function(){var e=this;this.observePlayer(),this.playBtn.addEventListener("click",function(t){t.stopPropagation(),e.ui.lock||e.ui.panelZlock||e.player.state===e.player.STATE_ADV||(e.playBtn.dataset.replay?(e.ui.replay(),delete e.playBtn.dataset.replay,e.ui.txidPing("pl_control_replay")):(e.player.paused?e.ui.txidPing("pl_control_play"):e.ui.txidPing("pl_control_pause"),e.ui.playOrPause()),s.default.hide(e.ui.elBtnTip))})}},{key:"observePlayer",value:function(){var e=this;this.player.on("play",function(){e.playBtn.dataset.title="\u6682\u505c",e.playBtn.dataset.replay=""}),this.player.on("playing",function(){e.playBtn.dataset.title="\u6682\u505c",e.playBtn.dataset.replay=""}),this.player.on("pause",function(){e.playBtn.dataset.title="\u64ad\u653e",e.playBtn.dataset.replay=""}),this.player.on("ended",function(){e.player.playList.next()||(e.playBtn.dataset.title="\u91cd\u64ad",e.playBtn.dataset.replay=1)})}}]),t}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(1),a=i(11),s=function(e){return e&&e.__esModule?e:{default:e}}(i(2));var o=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.ui=e,i.player=e.player,i.init(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.EventEmitter),n(t,[{key:"init",value:function(){var e=this.ui.container;this.nextBtn=e.querySelector(".x-next-btn"),this.nextBtnMask=e.querySelector(".x-nextbtn-mask"),s.default.css(this.nextBtn,"display","none"),this.ui.addTipAbility(this.nextBtn),this.initEvent(),this.nextBtnAnimation=new a.NextBtnAnimation(this.ui,this.nextBtn)}},{key:"initEvent",value:function(){var e=this;this.observePlayer(),this.nextBtn.addEventListener("click",function(t){t.stopPropagation(),e.ui.txidPing("player_videonext"),e.ui.playNextVideo(),s.default.hide(e.ui.elBtnTip)})}},{key:"observePlayer",value:function(){var e=this;this.player.on("data.ok",function(t){0!=e.player.outType||1!=t.site||e.player.isMiniH5||e.isFilm()?s.default.css(e.nextBtn,"display","none"):s.default.css(e.nextBtn,"display","block")}),this.player.on("play",function(){e.player.playList.next()?(e.nextBtnAnimation.setBtnState(1),s.default.css(e.nextBtnMask,"display","none")):(e.nextBtnAnimation.setBtnState(.4),s.default.css(e.nextBtnMask,"display","block"))})}},{key:"isFilm",value:function(){var e=window.location.host;return"film.sohu.com"==e||"t1.film.sohu.com"==e}}]),t}();t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(1),a=i(11),s=u(i(2)),o=u(i(5)),l=u(i(0));function u(e){return e&&e.__esModule?e:{default:e}}var d='<%@ h:helper %>\n  <div class="x-set-inner">\n    <div class="set-item x-set-skip" style="display:<%= site==1?\'block\':\'none\' %>">\n      <span class="x-set-txt">\u7247\u5934\u7247\u5c3e\uff1a</span>\n      <span class="set-btns">\n        <button class="x-set-btn-item x-set-panel-skip x-set-skip-s" data-num=1>\u8df3\u8fc7\u7247\u5934</button>\n        <button class="x-set-btn-item x-set-panel-skip x-set-skip-e" data-num=2>\u8df3\u8fc7\u7247\u5c3e</button>\n      </span>\n    </div>\n    <div class="set-item x-set-size" style="display:<%= site==2?\'block\':\'none\' %>">\n      <span class="x-set-txt">\u753b\u9762\u5c3a\u5bf8\uff1a</span>\n      <span class="set-btns">\n        <button class="x-set-btn-item x-set-panel-size" data-type="size"\n        data-num=3>50%</button>\n        <button class="x-set-btn-item x-set-panel-size" data-type="size" data-num=4>75%</button>\n        <button class="x-set-btn-item x-set-panel-size on" data-type="size" data-num=5>100%</button>\n      </span>\n    </div>\n    <div class="set-item x-set-rotate" style="display:<%= site==2?\'block\':\'none\' %>">\n      <span class="x-set-txt">\u65cb\u8f6c\u753b\u9762\uff1a</span>\n      <span class="set-btns">\n        <button class="x-set-btn-item x-set-panel-rotate" data-type="rotate" data-num=6>\u5411\u5de6\u8f6c</button>\n        <button class="x-set-btn-item x-set-panel-rotate" data-type="rotate" data-num=7>\u5411\u53f3\u8f6c</button>\n      </span>\n    </div>\n    <div class="set-item x-set-change">\n      <span class="x-set-btn-txt">\u5207\u6362\u64ad\u653e\u5668\uff1a</span>\n      <span class="set-btns">\n        <button class="x-set-btn-item x-set-panel-change" data-num=8>\u4f7f\u7528FLASH\u64ad\u653e\u5668</button>\n        </span>\n    </div>\n  </div>\n  ',c=function(e){function t(e,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.ui=e,n.isPage=i,n.player=e.player,n.tmpl=new o.default(d),n.init(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.EventEmitter),n(t,[{key:"init",value:function(){var e=this.ui.container;this.setBtn=e.querySelector(".x-set-btn"),this.player.isMiniH5&&s.default.css(this.setBtn,"display","none"),this.setPanel=e.querySelector(".x-set-panel"),this.size=1,this.initEvent(),this.setBtnAnimation=new a.SetBtnAnimation(this.ui,this.setBtn)}},{key:"initEvent",value:function(){var e=this;this.observePlayer(),this.setBtn.addEventListener("mouseenter",function(t){t.stopPropagation(),e.setBtn.classList.contains("x-disable")||e.player.state!==e.player.STATE_ADV&&(clearTimeout(e.setBtn.dataset.timer),e.setBtn.dataset.timer=setTimeout(function(){e.setBtn.classList.add("on"),e.show()},200))},!1),this.setBtn.addEventListener("mouseleave",function(t){t.stopPropagation(),e.setBtn.classList.contains("x-disable")||(clearTimeout(e.setBtn.dataset.timer),e.setBtn.dataset.timer=setTimeout(function(){e.setBtn.classList.remove("on"),e.hide()},200))},!1),this.setPanel.addEventListener("mouseenter",function(t){t.stopPropagation(),clearTimeout(e.setBtn.dataset.timer)},!1),this.setPanel.addEventListener("mouseleave",function(t){t.stopPropagation(),e.setBtn.dataset.timer=setTimeout(function(){e.setBtn.classList.remove("on"),e.hide()},200)},!1),this.setPanel.addEventListener("dblclick",function(e){e.stopPropagation()}),this.setPanel.addEventListener("click",function(t){t.stopPropagation();var i=t.target,n=i.dataset.type||"",r=i.dataset.num;if(i.classList.contains("x-set-btn-item")){switch(r){case"1":e.skipSState="0"==e.skipSState?"1":"0";try{e.player.playerCache.setLocalStorage({skip_s:e.skipSState})}catch(t){}break;case"2":e.skipEState="0"==e.skipEState?"1":"0";try{e.player.playerCache.setLocalStorage({skip_e:e.skipEState})}catch(t){}break;case"3":e.size=.5,e.player.changeShape(e.rotate,e.size);break;case"4":e.size=.75,e.player.changeShape(e.rotate,e.size);break;case"5":e.size=1,e.player.changeShape(e.rotate,e.size);break;case"6":e.rotate-=90,360==Math.abs(e.rotate)&&(e.rotate=0),e.player.changeShape(e.rotate,e.size);break;case"7":e.rotate+=90,360==Math.abs(e.rotate)&&(e.rotate=0),e.player.changeShape(e.rotate,e.size);break;case"8":if(1!=e.isPage)return;try{window.switchPlayer("flash")}catch(t){l.default.error("[\u4e3b\u64ad\u653e\u5668]change flash e--\x3e",t)}}"7"!=r&&"6"!=r&&(i.classList.contains("on")?i.classList.remove("on"):i.classList.add("on"),""!=n&&e.setItemState(n,r))}})}},{key:"observePlayer",value:function(){var e=this;this.player.on("data.ok",function(t){e.rotate=t.myTvRotate,e.size=t.myTvSize,e.setPanel.innerHTML=e.tmpl.render({site:t.site}),e.skipSBtn=e.ui.container.querySelector(".x-set-skip-s"),e.skipEBtn=e.ui.container.querySelector(".x-set-skip-e"),e.skipSState=e.player.storage.skip_s||"1",e.skipEState=e.player.storage.skip_e||"1",e.setSizeBtn=e.ui.container.querySelector(".x-set-size"),e.setRotateBtn=e.ui.container.querySelector(".x-set-rotate"),"1"==e.skipSState?e.skipSBtn.classList.add("on"):e.skipSBtn.classList.remove("on"),"1"==e.skipEState?e.skipEBtn.classList.add("on"):e.skipEBtn.classList.remove("on"),e.changePlayerBtn=e.ui.container.querySelector(".x-set-panel-change"),1==e.isPage?e.changePlayerBtn.classList.remove("disable"):e.changePlayerBtn.classList.add("disable")}),this.player.on("play",function(){e.setBtn.classList.remove("x-disable")}),this.player.on("playing",function(){e.setBtn.classList.remove("x-disable")}),this.player.on("adv.bgad.start",function(){e.bgadState=!0,s.default.hide(e.setSizeBtn),s.default.hide(e.setRotateBtn)}),this.player.on("adv.bgad.hide",function(){e.bgadState=!1,s.default.show(e.setSizeBtn),s.default.show(e.setRotateBtn)})}},{key:"show",value:function(){s.default.css(this.setPanel,"right","10px"),this.setPanel.classList.add("active")}},{key:"hide",value:function(){this.setBtn.classList.remove("on"),this.setPanel.classList.remove("active")}},{key:"setItemState",value:function(e,t){var i;"size"==e&&(i=this.setPanel.querySelectorAll(".x-set-panel-size"));for(var n,r=0;n=i[r++];)n.dataset.num==t?n.classList.add("on"):n.classList.remove("on")}}]),t}();t.default=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(e){return e&&e.__esModule?e:{default:e}}(i(2));var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ui=t,this.player=t.player,this.init()}return n(e,[{key:"init",value:function(){var e=this.ui.container;this.elBtnTip=e.querySelector(".x-tooltip")}},{key:"show",value:function(e){var t=this.ui.container;r.default.show(this.elBtnTip),this.elBtnTip.innerHTML=e.dataset.title,r.default.css(this.elBtnTip,"left",0);var i=e.getBoundingClientRect().left-this.ui.dashboardEl.getBoundingClientRect().left,n=r.default.width(e),a=r.default.width(this.elBtnTip),s=r.default.width(t);i+=(n-a)/2,(i=Math.max(i,0))+a>s&&(i=s-a),r.default.css(this.elBtnTip,"left",i+"px")}},{key:"hide",value:function(){r.default.hide(this.elBtnTip)}},{key:"addTipAbility",value:function(e){var t=this;e.addEventListener("mouseenter",function(){t.elBtnTip.dataset.timer&&clearTimeout(t.elBtnTip.dataset.timer),t.elBtnTip.dataset.timer=setTimeout(function(){return t.show(e)},200)},!1),e.addEventListener("mouseleave",function(){t.elBtnTip.dataset.timer&&(clearTimeout(t.elBtnTip.dataset.timer),t.elBtnTip.dataset.timer&&delete t.elBtnTip.dataset.timer),r.default.hide(t.elBtnTip)},!1)}}]),e}();t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(e){return e&&e.__esModule?e:{default:e}}(i(2));var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ui=t,this.player=t.player,this.init()}return n(e,[{key:"init",value:function(){var e=this.ui.container;this.loadingPanle=e.querySelector(".x-player-loading-panel"),this.initEvent()}},{key:"initEvent",value:function(){this.observePlayer()}},{key:"observePlayer",value:function(){var e=this;this.player.on("waiting",function(){return e.show()}),this.player.on("data.loading",function(){return e.show()}),this.player.on("data.loaded",function(){return e.hide()}),this.player.on("adv.loading",function(){return e.show()}),this.player.on("playing",function(){return e.hide()}),this.player.on("ended",function(){return e.hide()}),this.player.on("error",function(){return e.hide()}),this.player.on("seeked",function(){return e.hide()})}},{key:"show",value:function(){r.default.show(this.loadingPanle)}},{key:"hide",value:function(){r.default.hide(this.loadingPanle)}}]),e}();t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(1),a=function(e){return e&&e.__esModule?e:{default:e}}(i(2));var s=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.ui=e,i.player=e.player,i.idleTimer=null,i.isFirstPlaying=!0,i.init(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.EventEmitter),n(t,[{key:"init",value:function(){var e=this.ui.container;this.elDashboard=e.querySelector(".x-dashboard"),this.el=this.elDashboard,this.initEvent()}},{key:"initEvent",value:function(){var e=this;this.observePlayer(),this.elDashboard.addEventListener("click",function(e){return e.stopPropagation()},!1),this.elDashboard.addEventListener("dblclick",function(e){return e.stopPropagation()},!1),this.elDashboard.addEventListener("mousemove",function(){clearTimeout(e.idleTimer)},!1)}},{key:"observePlayer",value:function(){var e=this;this.player.on("data.ok",function(){e.player.isMiniH5&&e.hide()}),this.player.on("pause",function(){e.player.isMiniH5||e.show()}),this.player.on("playing",function(){e.isFirstPlaying&&(e.isFirstPlaying=!1,e.idleTimer=setTimeout(function(){e.hide()},4e3))}),this.player.on("player-state",function(t){a.default.css(e.elDashboard,"display",0==t?"none":"block")})}},{key:"show",value:function(){clearTimeout(this.idleTimer),this.ui.container.classList.remove("x-autohide"),this.emit("show")}},{key:"hide",value:function(){clearTimeout(this.idleTimer),this.player.paused&&!this.player.isMiniH5||(this.ui.container.classList.add("x-autohide"),this.emit("hide"))}},{key:"isDisplaying",value:function(){return!this.ui.container.classList.contains("x-autohide")}}]),t}();t.default=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(e){return e&&e.__esModule?e:{default:e}}(i(2));var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ui=t,this.player=t.player,this.type=null,this.timer=null,this.init()}return n(e,[{key:"init",value:function(){var e=this.ui.container;this.el=e.querySelector(".x-dash-tip-panel"),this.closeBtn=this.el.querySelector(".x-close-btn"),this.initEvent()}},{key:"initEvent",value:function(){var e=this;this.closeBtn.addEventListener("click",function(t){t.stopPropagation(),e.hide()}),this.player.on("data.ok",function(){return e.inCommon=!0}),this.player.on("player-state",function(t){var i="none";0==t?i="none":e.isShowing&&(i="block"),r.default.css(e.el,"display",i),e.inCommon=0!=t})}},{key:"show",value:function(e){var t=this,i=e.s,n=e.time,a=e.type;this.player.isHideTips||(this.isShowing=!0,this.inCommon&&r.default.show(this.el),this.el.querySelector("span").innerHTML=i,this.timer&&clearTimeout(this.timer),n&&(this.timer=setTimeout(function(){return t.hide()},n)),this.type=a)}},{key:"hide",value:function(){this.isShowing=!1,"willplay"==this.type&&this.ui.txidPing("pl_playnext_close"),r.default.hide(this.el),this.timer&&(clearTimeout(this.timer),this.timer=null),this.type=null}}]),e}();t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ui=t,this.player=t.player,this.init()}return n(e,[{key:"init",value:function(){var e=this.ui.container;this.bezel=e.querySelector(".x-bezel"),this.bezel2=e.querySelector(".x-bezel2")}},{key:"show",value:function(e){var t=this,i=this.ui.container;this.bezel.dataset.timer&&(clearTimeout(this.bezel.dataset.timer),this.bezel.dataset.timer&&delete this.bezel.dataset.timer,i.classList.remove("x-bezel-transition")),this.bezel.innerHTML=e,i.classList.add("x-bezel-transition"),this.bezel.dataset.timer=setTimeout(function(){i.classList.remove("x-bezel-transition"),t.bezel.dataset.timer&&delete t.bezel.dataset.timer},700)}},{key:"show2",value:function(e){var t=this;this.bezel2.dataset.timer&&(clearTimeout(this.bezel2.dataset.timer),this.bezel2.dataset.timer&&delete this.bezel2.dataset.timer,this.bezel2.classList.remove("x-bezel-transition")),this.bezel2.innerHTML=e,this.bezel2.classList.add("x-bezel-transition"),this.bezel2.dataset.timer=setTimeout(function(){t.bezel2.classList.remove("x-bezel-transition"),t.bezel2.dataset.timer&&delete t.bezel2.dataset.timer},700)}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=o(i(5)),a=o(i(2)),s=o(i(83));function o(e){return e&&e.__esModule?e:{default:e}}var l='<%@ h:helper %>\n <% var i = 0, len = videos.length, video; %>\n        <% for(; i < len; i++) {%>\n        <% video = videos[i]; %>\n        <li class="x-recommend-item">\n            <a href="<%= video.videoUrl %>" class="x-recommend-item-origin x-player-loading" target="_blank">\n                <img _src="<%= video.videoPic9||video.videoBigPic||video.v_170_110 %>" width="170px" height="110px">\n                <div class="x-recommend-item-shadow"></div>\n            </a>\n            <a href="<%= video.videoUrl %>" class="x-recommend-item-mask" style="background-image:url(<%= video.videoPic9||video.videoBigPic||video.v_170_110 %>);" target="_blank">\n                  <div class="x-recommend-item-mask-inner">\n                     <p><%= video.videoName %></p>\n                    <div>\n                        <span class="x-recommend-item-count"><%= pcounts ? helper.formatCount(pcounts[i].count) : 0 %></span>\n                        <span class="x-recommend-item-remark"><%= ccounts ? helper.formatCount( site == 1 ? ccounts.result[video.vid].comments : ccounts.result[\'bk\' + video.vid].comments) : 0 %></span>\n                    </div>\n                  </div>\n            </a>\n        </li>\n        <% } %> ',u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ui=t,this.player=t.player,this.tmpl=new r.default(l),this.recommendData=new s.default(this.player),this.init()}return n(e,[{key:"init",value:function(){var e=this.ui.container;this.recommendPanel=e.querySelector(".x-end-panel"),this.recommendList=e.querySelector(".x-recommend-inner"),this.sharePanel=e.querySelector(".x-share-panel"),this.initEvent()}},{key:"initEvent",value:function(){this.observePlayer()}},{key:"observePlayer",value:function(){var e=this;this.player.on("showrec",function(){setTimeout(function(){e.renderHTMLPanel()},2e3)}),this.player.on("play",function(){e.hide()})}},{key:"renderHTMLPanel",value:function(){var e=this;this.changeList(),this.recommendData.getAllData().then(function(t){e.recommendList.innerHTML=e.tmpl.render({site:e.player.dataModel.site,videos:t.videoData,pcounts:t.playCountData,ccounts:t.commentCount}),Array.prototype.slice.call(e.recommendList.querySelectorAll(".x-recommend-item-origin")).forEach(function(t){e.txid(t.parentNode);var i=t.getElementsByTagName("img")[0];i.onload=function(){a.default.removeClass(i.parentNode,"x-player-loading")},i.src=i.getAttribute("_src")});var i=e.throttle(e.changeList,e,300);e.player.on("resize",i)})}},{key:"txid",value:function(e){var t=this;e.addEventListener("click",function(){t.ui.txidPing("pl_bview_vrsClick")},!1)}},{key:"throttle",value:function(e,t,i){var n=null;return function(){var r=arguments;clearTimeout(n),n=setTimeout(function(){e.apply(t,r)},i)}}},{key:"changeList",value:function(){if(this.player.video.ended){var e=this.recommendList,t=a.default.height(this.ui.container.querySelector(".x-dashboard")),i=a.default.height(this.sharePanel),n=this.player.width-20,r=this.player.height-t-2*i-20,s=Math.min(190*Math.floor(n/190),950),o=Math.min(130*Math.floor(r/130),520);a.default.css(e,"width",s+"px"),a.default.css(e,"height",o+"px"),o&&s>=380?this.show():this.hide()}}},{key:"show",value:function(){a.default.show(this.recommendPanel),a.default.show(this.sharePanel),this.ui.txidPing("pl_bview_show")}},{key:"hide",value:function(){a.default.hide(this.recommendPanel),a.default.hide(this.sharePanel)}}]),e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=l(i(84)),a=l(i(85)),s=l(i(86)),o=l(i(0));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.player=t,this.videoList=[],this.videoId=[],this.bkVideoId=[]}return n(e,[{key:"getVideoId",value:function(e){var t=this;e.forEach(function(e){t.videoId.push(e.vid)})}},{key:"getBkVideoId",value:function(e,t){var i=this;2==t&&e.forEach(function(e){i.bkVideoId.push("bk"+e.vid)})}},{key:"getAllData",value:function(){var e=this;return new Promise(function(t){(0,r.default)(e.player.dataModel).then(function(i){e.videoList=i.data.videos,e.getVideoId(e.videoList),e.getBkVideoId(e.videoList,e.player.dataModel.site);var n=(0,a.default)(e.player.dataModel.site);Promise.all([n(e.videoId),(0,s.default)(e.bkVideoId.length>0?e.bkVideoId:e.videoId)]).then(function(i){var n,r;o.default.log("[\u4e3b\u64ad\u653e\u5668]recommend"+i),n=i[0],r=i[1],t({videoData:e.videoList,playCountData:n.data.videos?n.data.videos:n.data,commentCount:r.data})})})})}}]),e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){n.default.log("[\u4e3b\u64ad\u653e\u5668]\u83b7\u53d6\u540e\u63a8\u8350\u6570\u636e--\x3e",e);var t=e.vid||"",i=e.plid||"",o=e.cid||9001,l=(0,s.default)("fuid")||"",u=a.default.getPassport(),d="cb"+(Math.random()+"").slice(2),c={vid:t,cid:o,pid:i,u:l,y:"",p:u,pageNum:1,pageSize:24,var:d},h=document.domain.indexOf("56.com")>-1?"//rc.vrs.sohu.com/blog":"//search.vrs.sohu.com/p";return new Promise(function(e,t){(0,r.default)({url:h,data:c,dataType:"jsonp"}).then(function(t){n.default.log("[\u4e3b\u64ad\u653e\u5668]\u540e\u63a8\u8350\u6570\u636e\u83b7\u53d6\u5b8c\u6210"),"success"===t.status&&(t.data=window[d]),e(t)}).catch(function(e){t(e)})})};var n=o(i(0)),r=o(i(6)),a=o(i(8)),s=o(i(7));function o(e){return e&&e.__esModule?e:{default:e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return 1==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)?r:a};var n=function(e){return e&&e.__esModule?e:{default:e}}(i(6));function r(e){var t={videoId:e.join(","),jsonp:"h5sohudcwVrs"};return(0,n.default)({url:"//count.vrs.sohu.com/count/query.action",data:t,dataType:"jsonp"}).then(function(e){if("success"===e.status)return e.data=window.h5sohudcwVrs,e})}function a(e){var t={v:e.join("|"),method:"getVideoPlayCount"};return(0,n.default)({url:"//vstat.v.blog.sohu.com/dostat.do",data:t,dataType:"jsonp"})}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={topic_source_id:e.join(","),client_id:"cyqyBluaj"};return(0,n.default)({url:"//changyan.sohu.com/api/2/topic/count?callback=?",data:t,dataType:"jsonp"})};var n=function(e){return e&&e.__esModule?e:{default:e}}(i(6))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(1),a=o(i(2)),s=o(i(24));function o(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.ui=e,i.player=e.player,i.init(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.EventEmitter),n(t,[{key:"init",value:function(){var e=this.ui.container;this.shareBtn=e.querySelector(".x-share-btn"),this.mask=e.querySelector(".x-share-mask"),this.shareInner=e.querySelector(".x-share-inner"),this.url=document.location.href,this.shareInner.innerHTML=this.getShare(),this.closeBtn=this.shareInner.querySelector("s"),this.copyBtn=this.shareInner.querySelector(".x-copy-btn"),this.inputBtn=this.shareInner.querySelector(".x-copy-input"),this.shareTip=this.shareInner.querySelector(".share-tip"),this.shareItems=Array.prototype.slice.call(this.shareInner.querySelectorAll(".item a")),this.initEvent()}},{key:"getShare",value:function(){var e=encodeURIComponent(this.player.dataModel.title||""),t=encodeURIComponent(this.url),i=encodeURIComponent(window.cover||"");return'\n    <s></s>\n    <div class="share-left">\n        <p class="share-text">\u5206\u4eab\u7ed9\u5fae\u4fe1\u597d\u53cb</p>\n        <img src="//my.tv.sohu.com/user/a/wvideo/getQRCode.do?text='+t+'&width=160&amp;height=160&amp;picType=2" alt="\u4e8c\u7ef4\u7801" width="160" height="160">\n    </div>\n    <div class="share-split"></div>\n    <div class="share-right">\n        <ul>\n            <li class="item share-weibo"><a data-txid="pl_bview_weiboShare" target="_blank"  href="//service.t.sina.com.cn/share/share.php?appkey=1753462873&url='+t+"&title="+e+"&pic="+i+'"></a><span>\u5fae\u535a</span></li>\n            <li class="item share-qq"><a data-txid="pl_bview_qqShare" target="_blank" href="//connect.qq.com/widget/shareqq/index.html?url='+t+"&desc="+e+"&pics="+i+'"></a><span>QQ</span></li>\n            <li class="item share-zone"><a data-txid="pl_bview_qqzoneShare" target="_blank" href="//sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url='+t+"&title="+e+"&pics="+i+'"></a><span>QQ\u7a7a\u95f4</span></li>\n        </ul>\n        <div class="share-right-url">\n            <p class="share-text">\u89c6\u9891\u5730\u5740</p>\n            <input placeholder="\u70b9\u51fb\u53f3\u4fa7\u6309\u94ae\u590d\u5236\u89c6\u9891\u5730\u5740" type="text" value="" class="x-copy-input"><a class="x-copy-btn" href="javascript:;">\u590d\u5236</a>\n            <p class="share-tip">\u590d\u5236\u6210\u529f</p>\n        </div>\n    </div> \n  '}},{key:"initEvent",value:function(){var e=this;this.observePlayer(),this.shareBtn.addEventListener("click",function(t){t.stopPropagation(),e.show(),e.ui.txidPing("pl_bview_shareClick")}),this.closeBtn.addEventListener("click",function(t){t.stopPropagation(),e.hide(),e.ui.txidPing("pl_bview_shareClose")}),this.copyBtn.addEventListener("click",function(){e.copy()},!1),this.inputBtn.addEventListener("keydown",function(e){e.stopPropagation()},!1),this.inputBtn.addEventListener("dblclick",function(e){e.stopPropagation()},!1),this.inputBtn.addEventListener("click",function(t){t.stopPropagation(),e.copy()},!1),this.shareItems.forEach(function(t){var i=t.getAttribute("data-txid");t.addEventListener("click",function(){e.ui.txidPing(i)})})}},{key:"copy",value:function(){var e=this;this.inputBtn.value=this.url,s.default.copy(this.url),this.ui.txidPing("pl_bview_adressCopy"),a.default.show(this.shareTip),setTimeout(function(){a.default.hide(e.shareTip)},1e3)}},{key:"observePlayer",value:function(){var e=this;this.player.on("play",function(){e.hide()})}},{key:"show",value:function(){a.default.addClass(this.shareBtn,"active"),a.default.show(this.mask),a.default.show(this.shareInner)}},{key:"hide",value:function(){a.default.removeClass(this.shareBtn,"active"),a.default.hide(this.mask),a.default.hide(this.shareInner)}}]),t}();t.default=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=d(i(89)),s=d(i(2)),o=i(1),l=d(i(31)),u=d(i(0));function d(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.ui=e,i.player=e.player,i.errorCount=0,i.init(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.EventEmitter),r(t,[{key:"init",value:function(){var e=this.ui.container;this.panelEl=e.querySelector(".x-error-panel"),this.titleEl=e.querySelector(".x-error-panel-title"),this.txtEl=e.querySelector(".x-error-panel-txt"),this.iconEl=e.querySelector(".x-error-panel-icon"),this.inputEl=e.querySelector(".x-error-panel-encrypt"),this.feedback=e.querySelector(".x-error-panel-feedback"),this.msgEl=e.querySelector(".x-error-panel-msg"),s.default.hide(this.inputEl),this.observePlayer()}},{key:"observePlayer",value:function(){var e=this;this.player.on("data.exception",function(t){return e.process(t)}),this.player.on("error",function(t){return e.process(t)}),this.player.on("loading",function(){return e.hide()}),this.player.on("data.ok",function(){return e.hide()}),this.player.on("timeupdate",function(){return e.hide()}),this.player.on("resize",function(){return e.resize()}),this.panelEl.addEventListener("click",function(e){e.stopPropagation()})}},{key:"process",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.code,r=t.vdata||{};if(i>=700&&i<1e3){if(this.errorCount++,this.errorCount<5)return;this.errorCount=0}if(!(i>100&&i<200)){201==i&&(1==r.play&&2==r.status?i=502:1==r.play&&3==r.status?i=503:1==r.play&&4==r.status?i=504:1==r.play&&5==r.status?i=40==r.code||9==r.code?515:505:1==r.play&&11==r.status&&(s.default.show(this.inputEl),i=516,this.inputEl.innerHTML='\n  <div class="x-error-panel-input">\n    <input type="password" class="x-error-panel-pwd" name="password" placeholder="\u8bf7\u8f93\u5165\u5bc6\u7801\u89c2\u770b" autocomplete="off">\n  </div>\n  <span class="x-error-panel-submit">\u63d0\u4ea4</span>\n  ',this.inputTxt=this.ui.container.querySelector(".x-error-panel-pwd"),this.submitBtn=this.ui.container.querySelector(".x-error-panel-submit"),this.submitBtn.addEventListener("mousedown",function(t){t.stopPropagation();var i=e.inputTxt.value;""!=i&&e.emit("pwd-submit",i)})));var o,d=515==i?r.mytvmsg:a.default[""+i],c=d;"object"==(void 0===d?"undefined":n(d))&&(c=d.t1,o=d.t2||""),u.default.log("[\u4e3b\u64ad\u653e\u5668]\u64ad\u653e\u9047\u5230\u95ee\u9898=="+c+"\uff08"+i+"\uff09"),o=o?o+"\uff0c\u6709\u8bdd\u8981\u8bf4\uff1f":"\u6709\u8bdd\u8981\u8bf4\uff1f";try{this.titleEl.innerHTML=c+"\uff08"+i+"\uff09",this.txtEl.innerHTML=o}catch(t){}this.iconEl.classList.remove("x-error-panel-icon-warn","x-error-panel-icon-lock","x-error-panel-icon-clock");var h="x-error-panel-icon-warn";503!=i&&505!=i||(h="x-error-panel-icon-clock"),this.iconEl.classList.add(h),this.feedback.addEventListener("click",function(){l.default.getLogId()}),this.resize(),this.show()}}},{key:"hide",value:function(){this.panelEl.classList.add("x-hide")}},{key:"show",value:function(){this.panelEl.classList.remove("x-hide")}},{key:"resize",value:function(){this.player.width<=360||this.player.height<=160?(this.iconEl.classList.add("icon-mini-state"),this.titleEl.classList.add("title-mini-state"),this.msgEl.classList.add("msg-mini-state")):(this.iconEl.classList.remove("icon-mini-state"),this.titleEl.classList.remove("title-mini-state"),this.msgEl.classList.remove("msg-mini-state"))}}]),t}();t.default=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={1:"\u4e0b\u8f7d\u4e2d\u65ad\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5",2:"\u4e0b\u8f7d\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5",3:"\u89e3\u7801\u9519\u8bef",4:"\u7cfb\u7edf\u4e0d\u652f\u6301\u6b64\u683c\u5f0f\u7684\u89c6\u9891",100:"\u60a8\u6240\u5728\u7684\u56fd\u5bb6\u6216\u5730\u533a\uff0c\u4e0d\u5728\u6240\u64ad\u653e\u7684\u8282\u76ee\u7248\u6743\u8303\u56f4",101:"\u8be5\u89c6\u9891\u7248\u6743\u5df2\u5230\u671f\uff0c\u65e0\u6cd5\u89c2\u770b",102:"\u89c2\u770b\u672c\u96c6\u8bf7\u524d\u5f80\u641c\u72d0\u89c6\u9891\u5ba2\u6237\u7aef",200:"\u6570\u636e\u5904\u7406\u5b8c\u6210",201:"\u65e0\u6548\u89c6\u9891\u6570\u636e,\u8bf7\u5237\u65b0\u91cd\u8bd5",202:"\u65e0\u6548\u89c6\u9891\u6570\u636e",203:"\u6570\u636e\u7ed3\u6784\u9519\u8bef",204:"\u89e3\u6790\u6570\u636e\u51fa\u9519",300:"\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u64ad\u653e\u529f\u80fd\uff0c\u8bf7\u4f7f\u7528\u641c\u72d0\u89c6\u9891\u5ba2\u6237\u7aef",301:"\u8be5\u89c6\u9891\u76ee\u524d\u53ea\u652f\u63015\u5206\u949f\u89c2\u770b\uff0c\u89c2\u770b\u5b8c\u6574\u89c6\u9891\uff0c\u8bf7\u4f7f\u7528\u641c\u72d0\u89c6\u9891\u5ba2\u6237\u7aef",302:"UC\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u64ad\u653e\u529f\u80fd\uff0c\u5efa\u8bae\u4f7f\u7528\u7cfb\u7edf\u6d4f\u89c8\u5668\u6216\u8bf7\u4f7f\u7528\u641c\u72d0\u89c6\u9891\u5ba2\u6237\u7aef",303:"\u76f4\u64ad\u8bf7\u4f7f\u7528\u641c\u72d0\u89c6\u9891\u5ba2\u6237\u7aef",304:"\u672c\u7247\u4ec5\u4f9b\u8bd5\u770b\uff0c\u5982\u679c\u9700\u8981\u89c2\u770b\u66f4\u591a\u5185\u5bb9\uff0c\u8bf7\u4e0b\u8f7d\u641c\u72d0\u89c6\u9891App",305:"\u60a8\u7684\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u76f4\u64ad\u529f\u80fd\uff0c\u8bf7\u4f7f\u7528\u641c\u72d0\u89c6\u9891\u5ba2\u6237\u7aef",306:"\u64ad\u653e\u5730\u5740\u65e0\u6548\uff0c\u5982\u679c\u9700\u8981\u89c2\u770b\u66f4\u591a\u5185\u5bb9\uff0c\u8bf7\u4e0b\u8f7d\u641c\u72d0\u89c6\u9891App",400:"\u7f51\u7edc\u8d85\u65f6\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5",401:"playinfo\u63a5\u53e3\u8bf7\u6c42\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5",402:"playinfo\u63a5\u53e3\u53c2\u6570\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5",403:"playinfo\u63a5\u53e3\u8d85\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5",404:"\u6e20\u9053\u63a5\u53e3\u8bf7\u6c42\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5",405:"\u6e20\u9053\u63a5\u53e3\u53c2\u6570\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5",406:"\u6e20\u9053\u63a5\u53e3\u8d85\u65f6\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5",407:"copyright\u63a5\u53e3\u8bf7\u6c42\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5",408:"56/svp\u63a5\u53e3\u8bf7\u6c42\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5",500:{t1:"\u62b1\u6b49\uff0c\u89c6\u9891\u5185\u5bb9\u52a0\u8f7d\u5931\u8d25",t2:"\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5\u540e\u91cd\u8bd5"},501:{t1:"\u62b1\u6b49\uff0c\u89c6\u9891\u5185\u5bb9\u52a0\u8f7d\u5931\u8d25",t2:"\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5\u540e\u91cd\u8bd5"},502:{t1:"\u62b1\u6b49\uff0c\u89c6\u9891\u5185\u5bb9\u89e3\u6790\u5931\u8d25",t2:"\u8bf7\u5237\u65b0\u9875\u9762\u540e\u91cd\u8bd5"},503:{t1:"\u62b1\u6b49\uff0c\u89c6\u9891\u7248\u6743\u5df2\u5230\u671f"},504:{t1:"\u62b1\u6b49\uff0c\u89c6\u9891\u5df2\u88ab\u7981\u64ad"},505:{t1:"\u62b1\u6b49\uff0c\u89c6\u9891\u7248\u6743\u5df2\u5230\u671f"},516:{t1:"\u8be5\u89c6\u9891\u5df2\u52a0\u5bc6"},700:"\u62b1\u6b49\uff0c\u89c6\u9891\u670d\u52a1\u5668\u53d1\u751f\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u540e\u91cd\u8bd5",701:"\u62b1\u6b49\uff0c\u89c6\u9891\u670d\u52a1\u5668\u53d1\u751f\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u540e\u91cd\u8bd5",702:"\u62b1\u6b49\uff0c\u89c6\u9891\u670d\u52a1\u5668\u53d1\u751f\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u540e\u91cd\u8bd5",704:"\u62b1\u6b49\uff0c\u89c6\u9891\u670d\u52a1\u5668\u53d1\u751f\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u540e\u91cd\u8bd5",800:"\u62b1\u6b49\uff0c\u89c6\u9891\u670d\u52a1\u5668\u53d1\u751f\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u540e\u91cd\u8bd5",801:"\u62b1\u6b49\uff0c\u89c6\u9891\u670d\u52a1\u5668\u53d1\u751f\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u540e\u91cd\u8bd5",802:"\u62b1\u6b49\uff0c\u89c6\u9891\u670d\u52a1\u5668\u53d1\u751f\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u540e\u91cd\u8bd5",803:"\u62b1\u6b49\uff0c\u89c6\u9891\u89e3\u6790\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u540e\u91cd\u8bd5",804:"\u62b1\u6b49\uff0c\u89c6\u9891\u89e3\u6790\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u540e\u91cd\u8bd5",901:"\u62b1\u6b49\uff0c\u89c6\u9891\u53d6\u56de\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u540e\u91cd\u8bd5",902:"\u62b1\u6b49\uff0c\u89c6\u9891\u53d6\u56de\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u540e\u91cd\u8bd5",903:"\u62b1\u6b49\uff0c\u89c6\u9891\u53d6\u56de\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u540e\u91cd\u8bd5",904:"\u62b1\u6b49\uff0c\u60a8\u89c2\u770b\u7684\u89c6\u9891/\u97f3\u9891\u4e0d\u652f\u6301\u64ad\u653e",END:"\u76f4\u64ad\u7ed3\u675f"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ui=t,this.container=this.ui.container,this.player=this.ui.player,this.observePlayer()}return n(e,[{key:"observePlayer",value:function(){var e=this;this.player.on("playrecord",function(t){e.ui.dashTip.show({s:"\u5df2\u4e3a\u60a8\u7eed\u64ad\u5230\u4e0a\u6b21\u89c2\u770b\u65f6\u95f4"+e.parseTime(t)+'\uff0c\u60a8\u4e5f\u53ef\u4ee5\n  <div class="x-tip-btn x-tip-restartBtn">\u4ece\u5934\u89c2\u770b</div>\n  ',time:5e3}),e.restartBtn=e.container.querySelector(".x-tip-restartBtn"),e.restartBtn.addEventListener("mousedown",function(t){t.stopPropagation(),e.player.seek(0)})}),this.player.on("playrecord-skip-start",function(){e.ui.dashTip.show({s:"\u5df2\u4e3a\u60a8\u8df3\u8fc7\u7247\u5934",time:5e3})})}},{key:"parseTime",value:function(e){var t=String(e%60);return String(Math.floor(e/60))+":"+(t.length<2?"0"+t:t)}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=l(i(92)),a=l(i(2)),s=l(i(5)),o=l(i(0));function l(e){return e&&e.__esModule?e:{default:e}}var u='<%@ h:helper %>\n      <div class="x-danmu-item" data-time="<%= oneDmObj.vtime %>" data-roll="<%= oneDmObj.roll %>" data-line="<%= line %>" data-color="<%= oneDmObj.color==\'16777215\' ? 0 : 1 %>" style="transition-property:transform;transition-timing-function:linear;transform:translateX(0);transition-duration:0s;color:<%= color %>;top:<%= top %>;font-size:<%= fontsize %>" data-id="<%= oneDmObj.id %>">\n          <span class="x-danmu-star-bg" style="display:<%= oneDmObj.star===1?\'inline-block\':\'none\' %>"></span>\n          <span class="x-danmu-add" style="display:none">+1</span>\n          <span class="x-danmu-star-photo" style="display:<%= oneDmObj.star===1?\'inline-block\':\'none\' %>"><img src="<%= oneDmObj.photo %>"></span>\n          <span class="x-danmu-item-text"><%= content %></span>\n          <span class="x-danmu-item-upvote" style="display:<%= oneDmObj.fcount>=10?\'inline-block\':\'none\' %>"><span class="img"></span>\n          <span class="x-danmu-item-votenum"><%= oneDmObj.fcount %></span></span>\n          </div>',d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ui=t,this.player=t.player,this.tmpl=new s.default(u),this.dmModule=new r.default(this.player),this.pauseState=!1,this.mouseOverState=!1,this.midState=!1,this.switchState=!1,this.bgadState=!1,this.isAllow=0,this.eventObj={color:"setColor",type:"setType",position:"setPosition",opacity:"setOpacity",filterColor:"setFliterColor",filter:"setFliterPosition",size:"setSize"},this.init()}return n(e,[{key:"init",value:function(){var e=this.ui.container;this.panel=e.querySelector(".x-danmu-panel"),a.default.css(this.panel,"display","block"),this.dmPanel=e.querySelector(".x-danmu-box"),this.heart=e.querySelector(".x-danmu-mouse-heart"),this.infoPanel=e.querySelector(".x-info-panel"),a.default.css(this.heart,"display","none"),this.initEvent()}},{key:"initEvent",value:function(){this.observePlayer()}},{key:"observePlayer",value:function(){var e=this;this.player.on("play",function(){return e.playDm()}),this.player.on("pause",function(){return e.pauseMovingDm()}),this.player.on("seeked",function(){return e.seek()}),this.player.on("resize",function(){return e.resize()}),this.player.on("resolution.switching",function(){return e.resolutionSwitch()}),this.player.on("resolution.switched",function(){return e.resolutionSwitched()}),this.player.on("resolution.to.dmstate",function(){return e.resolutionSwitched()}),this.player.on("movie.ended",function(){return e.endDm()}),this.player.on("adv.loading",function(){return e.inputAllow(0)}),this.player.on("adv.lock",function(){e.inputAllow(0)}),this.player.on("adv.ended",function(){e.midState=!1,Math.abs(e.player.dataModel.duration-e.player.currentTime)<10?e.inputAllow(0):e.inputAllow(1)}),this.player.on("adv.start",function(){e.midState=!0,e.clearDm()}),this.player.on("reset",function(){e.dmReset()}),this.player.on("showrec",function(){return e.inputAllow(0)}),this.player.on("adv.bgad.start",function(){e.bgadState=!0,a.default.css(e.panel,"display","none")}),this.player.on("adv.bgad.hide",function(){e.bgadState=!1,a.default.css(e.panel,"display","block")}),this.player.on("timeupdate",function(){e.player.state!==e.player.STATE_MOIVE||e.midState||e.switchState||e.bgadState||"1"!=e.dmModule.config.dmOn&&(e.dmArr=e.dmModule.updatePlayTime(),e.startGenerateDm(e.dmArr))}),this.player.on("dm.open",function(){return e.openDanmu()}),this.player.on("dm.close",function(){return e.closeDanmu()}),this.player.on("dm.send",function(t){return e.sendDanmu(t)}),this.player.on("dm.set",function(t){var i=t.key,n=t.val,r=e.eventObj[i];e[r](n)}),this.player.on("dm.getPageData",function(t){var i=t.page,n=t.len,r=t.callback;return e.getData(i,n,r)}),this.player.on("player-state",function(t){a.default.css(e.panel,"display",0==t?"none":"block"),e.dmPanel.innerHTML=""})}},{key:"playDm",value:function(){a.default.css(this.heart,"display","none"),this.player.state===this.player.STATE_MOIVE&&(this.restartMovingDm(),this.pauseState=!1,this.inputAllow(1))}},{key:"endDm",value:function(){this.clearDm(),this.inputAllow(0),this.dmModule.config.currentSecond=0}},{key:"inputAllow",value:function(e){this.isAllow!==e&&(this.dmModule.setDMContorl(e),this.isAllow=e)}},{key:"resize",value:function(){this.pauseState||this.clearDm(),this.player.isFullscreen()?(a.default.css(this.dmPanel,"top","40px"),a.default.css(this.infoPanel,"z-index","10")):(a.default.css(this.dmPanel,"top","0px"),a.default.css(this.infoPanel,"z-index","0"));var e=Math.floor(.75*this.player.height/this.dmModule.config.danmuHeight);this.dmModule.config.totalLine=e;for(var t=this.dmPanel.querySelectorAll(".x-danmu-item"),i=0;i<t.length;i++){t[i].getAttribute("data-line")>e&&t[i].parentNode.removeChild(t[i])}}},{key:"startGenerateDm",value:function(e){var t=this;if(e)for(var i=function(i){var n=e[i],o=t.buildOneDmEle({oneDmObj:n,self:!1}),l=void 0;if(o&&t.checkFilterColor("16777215"==n.color?"0":"1")){if(t.dmPanel.appendChild(o),"l"==n.roll){l=t.player.width+"px",o.addEventListener("transitionend",t.danmuEnd);var u=Number(t.dmModule.getDmDuration(t.player.width,o.offsetWidth))+"s";a.default.setCss3(o,"transitionDuration",u);var d="translateX("+(-(t.player.width+o.offsetWidth+100)+"px")+")";a.default.setCss3(o,"transform",d)}else l=(t.player.width-o.offsetWidth)/2+"px",r=setTimeout(function(){try{o.parentNode.removeChild(o)}catch(e){}},1e3*t.dmModule.config.fixDmTimer),o.setAttribute("data-timeOutId",r);a.default.setCss3(o,"left",l),s=n.fcount<10?o.offsetWidth:o.offsetWidth+75,a.default.setCss3(o,"width",s+"px"),a.default.setCss3(o.querySelector(".x-danmu-star-bg"),"width",s+"px"),t.checkFilterPosition(o.getAttribute("data-line"))?(a.default.setCss3(o,"opacity",t.dmModule.config.opacity),a.default.css(o,"cursor","pointer")):(a.default.setCss3(o,"opacity",0),a.default.css(o,"cursor","default")),t.heart.addEventListener("mouseover",function(e){e.stopPropagation(),e.preventDefault()}),o.addEventListener("mouseover",function(e){if(a.default.hasClass(e.currentTarget,"x-danmu-voted")||"1"!==a.default.css(e.currentTarget,"opacity")||a.default.css(t.heart,"display","inline-block"),!t.mouseOverState){if(t.mouseOverState=!0,e.stopPropagation(),a.default.css(e.currentTarget,"z-index",100),t.pauseState)return;t.pauseOneDm(e.currentTarget)}}),o.addEventListener("mouseleave",function(e){if(t.mouseOverState){if(t.mouseOverState=!1,e.stopPropagation(),a.default.css(t.heart,"display","none"),t.pauseState)return;t.restartOneDm(e.currentTarget)}}),o.addEventListener("mousedown",function(e){e.stopPropagation();var i=e.currentTarget,n=i.getAttribute("data-id"),r=e.currentTarget.querySelector(".x-danmu-add");if(a.default.hasClass(r,"x-danmu-add-click")||(a.default.css(r,"display","inline-block"),a.default.css(r,"left",e.offsetX+"px"),a.default.addClass(r,"x-danmu-add-click"),setTimeout(function(){a.default.css(r,"display","none")},400)),!a.default.hasClass(i,"x-danmu-voted")){a.default.addClass(i,"x-danmu-voted"),a.default.css(t.heart,"display","none");var s=Number(i.querySelector(".x-danmu-item-votenum").innerHTML)+1;i.querySelector(".x-danmu-item-votenum").innerHTML=s,t.dmModule.upvoteDanmu({dmid:n})}}),o.addEventListener("mousemove",function(e){e.stopPropagation();var i=-4+Number(a.default.css(e.currentTarget,"top").replace("px",""))+Number(t.player.isFullscreen()?40:0),n=t.dmPanel.getBoundingClientRect().left;a.default.css(t.heart,"left",e.clientX-n+20+"px"),a.default.css(t.heart,"top",i+"px")})}},n=0;n<e.length;n++){var r,s;i(n)}}},{key:"buildOneDmEle",value:function(e){var t=e.oneDmObj,i=e.self,n=t.star,r=1===n?t.name+":"+t.content:t.content,s="#"+(+t.color).toString(16),o="s"==t.size?this.dmModule.config.smallFontSize:"m"==t.size?this.dmModule.config.midFontSize:this.dmModule.config.largeFontSize,l=void 0;if(0!==(l="l"==t.roll?this.getLine(i):this.getLine(i,t.place))){var u=(l-1)*this.dmModule.config.danmuHeight+"px",d=document.createElement("div");d.innerHTML=this.tmpl.render({oneDmObj:t,line:l,color:s,top:u,fontsize:o,content:r});var c=d.children[0];1===n&&a.default.addClass(c,"x-danmu-star");var h=c.querySelector(".x-danmu-item-upvote");return"l"==t.size&&a.default.css(h,"top","5px"),i&&(c.style.border="solid 1px red"),c}}},{key:"restartMovingDm",value:function(){if(this.pauseState){var e=this.dmPanel.querySelectorAll(".x-danmu-item");if(0!=e.length){for(var t=0;t<e.length;t++){var i=e[t];this.restartOneDm(i)}this.pauseState=!1}}}},{key:"restartOneDm",value:function(e){var t=e.getAttribute("data-roll"),i=e.getAttribute("data-lefttime");if("l"==t){a.default.setCss3(e,"transitionDuration",i+"s");var n="translateX("+(-(this.player.width+e.offsetWidth+100)+"px")+")";a.default.setCss3(e,"transform",n)}else setTimeout(function(){try{e.parentNode.removeChild(e)}catch(e){}},1e3*i)}},{key:"pauseMovingDm",value:function(){this.pauseState=!0;for(var e=this.dmPanel.querySelectorAll(".x-danmu-item"),t=e.length,i=0;i<t;i++){var n=e[i];this.pauseOneDm(n)}}},{key:"pauseOneDm",value:function(e){var t,i=void 0;if(t=this.player.currentTime,"l"==e.getAttribute("data-roll")){var n=this.player.width+this.getTranslateX(e);i=Number(this.dmModule.getDmLeftDuration(n,e.offsetWidth)),a.default.setCss3(e,"transitionDuration","0s"),a.default.setCss3(e,"transform","translateX("+this.getTranslateX(e)+"px)")}else{(i=Number(e.getAttribute("data-time"))+Number(this.dmModule.config.fixDmTimer)-Number(t))<0&&(i=3);var r=e.getAttribute("data-timeOutId");clearTimeout(r)}e.setAttribute("data-lefttime",i)}},{key:"clearDm",value:function(){this.dmPanel.innerHTML=""}},{key:"seek",value:function(){this.clearDm(),this.dmModule.config.currentSecond=this.player.currentTime}},{key:"resolutionSwitch",value:function(){this.switchState=!0,this.clearDm()}},{key:"resolutionSwitched",value:function(){this.switchState=!1,this.dmModule.config.currentSecond=this.player.currentTime}},{key:"getLine",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"t",i=void 0,n=void 0,r=this.dmModule.config.totalLine;if("t"==t)for(var s=1;s<r+1;s++){if(0==(n=this.dmPanel.querySelectorAll('[data-line="'+s+'"]')).length)return s;if(i=n[n.length-1],-this.getTranslateX(i)>Number(a.default.css(i,"width").slice(0,-2))+60)return s}else for(var o=r;o>0;o--){if(0==(n=this.dmPanel.querySelectorAll('[data-line="'+o+'"]')).length)return o;if(i=n[n.length-1],-this.getTranslateX(i)>Number(a.default.css(i,"width").slice(0,-2))+60)return o}return e?1:0}},{key:"getTranslateX",value:function(e){return+window.getComputedStyle(e).transform.slice(7,-1).split(",")[4]}},{key:"danmuEnd",value:function(e){var t=e.target;t.removeEventListener("transitionend",this.danmuEnd),this.parentNode.removeChild(t)}},{key:"danmuFixEnd",value:function(e){this.dmPanel.removeChild(e)}},{key:"sendDanmu",value:function(e){o.default.log("[\u4e3b\u64ad\u653e\u5668]sendDanmu"+e);var t={};if(t.content=e.hasOwnProperty("content")?e.content:"",!(null==t.content||t.content.length<1)){t.roll="r"==this.dmModule.config.sendType?"l":"f",t.color=this.dmModule.config.sendColor,t.size=this.dmModule.config.sendFontSize,t.place=this.dmModule.config.sendPosition,t.vtime=this.player.currentTime,this.createSendDanmu(t);var i='{"c":"'+t.color+'","s":"'+t.size+'","m":"'+t.roll+'","p":"'+t.place+'","l":"n"}',n={content:t.content,flv_time:t.vtime,options:i};this.dmModule.sendDanmu(n)}}},{key:"createSendDanmu",value:function(e){var t=this,i=this.buildOneDmEle({oneDmObj:e,self:!0}),n=void 0,r=void 0,s=void 0,o=void 0;if(i){if(this.dmPanel.appendChild(i),"l"==e.roll){this.pauseState?(r="0s",s=-(n=this.player.width-30+"px")+"px",o=Number(this.dmModule.getDmDuration(this.player.width,i.offsetWidth)),i.setAttribute("data-lefttime",o)):(n=this.player.width+"px",r=Number(this.dmModule.getDmDuration(this.player.width,i.offsetWidth))+"s",s=-(this.player.width+i.offsetWidth+100)+"px"),i.addEventListener("transitionend",this.danmuEnd),a.default.setCss3(i,"transitionDuration",r);var l="translateX("+s+")";a.default.setCss3(i,"transform",l)}else{var u;n=(this.player.width-i.offsetWidth)/2+"px",this.pauseState?(u=(new Date).getTime(),i.setAttribute("data-lefttime",this.dmModule.config.fixDmTimer)):(u=setTimeout(function(){try{i.parentNode.removeChild(i)}catch(e){}},1e3*this.dmModule.config.fixDmTimer),i.setAttribute("data-timeOutId",u))}a.default.setCss3(i,"left",n),i.addEventListener("mouseover",function(e){if(!t.mouseOverState){if(e.stopPropagation(),a.default.css(e.currentTarget,"z-index",100),t.pauseState)return;t.pauseOneDm(e.currentTarget),t.mouseOverState=!0}}),i.addEventListener("mouseleave",function(e){if(t.mouseOverState){if(e.stopPropagation(),t.pauseState)return;t.restartOneDm(e.currentTarget),t.mouseOverState=!1}}),i.addEventListener("mousedown",function(e){e.stopPropagation()})}}},{key:"setOpacity",value:function(e){a.default.setCss3(this.dmPanel,"opacity",Number(e))}},{key:"setFliterPosition",value:function(e){o.default.log("[\u4e3b\u64ad\u653e\u5668]setFliterPosition=="+e.place+"::"+e.show);var t=e.place,i=e.show;"t"===t?this.dmModule.config.filterPositionT=i:this.dmModule.config.filterPositionB=i;for(var n=this.dmPanel.querySelectorAll(".x-danmu-item"),r=0;r<n.length;r++){var s=n[r].getAttribute("data-line");"t"==t&&s<=Math.round(this.dmModule.config.totalLine/2)?0===i?(a.default.css(n[r],"opacity",0),a.default.css(n[r],"cursor","default")):this.checkFilterColor(n[r].getAttribute("data-color"))&&(a.default.css(n[r],"opacity",this.dmModule.config.opacity),a.default.css(n[r],"cursor","pointer")):"b"==t&&s>Math.round(this.dmModule.config.totalLine/2)&&(0===i?(a.default.css(n[r],"opacity",0),a.default.css(n[r],"cursor","default")):this.checkFilterColor(n[r].getAttribute("data-color"))&&(a.default.css(n[r],"opacity",this.dmModule.config.opacity),a.default.css(n[r],"cursor","pointer")))}}},{key:"openDanmu",value:function(){o.default.log("[\u4e3b\u64ad\u653e\u5668]opendm"),a.default.css(this.panel,"display","block"),this.dmModule.config.dmOn="2";try{this.player.playerCache.setLocalStorage({dm_open:"2"})}catch(e){}}},{key:"closeDanmu",value:function(){o.default.log("[\u4e3b\u64ad\u653e\u5668]closedm"),a.default.css(this.panel,"display","none"),this.dmModule.config.dmOn="1",this.dmPanel.innerHTML="";try{this.player.playerCache.setLocalStorage({dm_open:"1"})}catch(e){}}},{key:"setFliterColor",value:function(e){this.dmModule.config.filterColor=""===e?0:1,this.setColorDisplay(this.dmModule.config.filterColor)}},{key:"setColorDisplay",value:function(e){var t=this.dmPanel.querySelectorAll('[data-color="1"]'),i=t.length;if(0!=i)for(var n=0;n<i;n++)1==e?(a.default.css(t[n],"opacity",0),a.default.css(t[n],"cursor","default")):this.checkFilterPosition(t[n].getAttribute("data-line"))&&(a.default.css(t[n],"opacity",this.dmModule.config.opacity),a.default.css(t[n],"cursor","pointer"))}},{key:"checkFilterColor",value:function(e){return 0===this.dmModule.config.filterColor||"0"===e}},{key:"checkFilterPosition",value:function(e){return!(e<=Math.round(this.dmModule.config.totalLine/2)&&0===this.dmModule.config.filterPositionT)&&!(e>Math.round(this.dmModule.config.totalLine/2)&&0===this.dmModule.config.filterPositionB)}},{key:"setColor",value:function(e){this.player.playerCache.setLocalStorage({dm_color:e}),this.dmModule.config.sendColor=e}},{key:"setSize",value:function(e){this.player.playerCache.setLocalStorage({dm_fontSize:e}),this.dmModule.config.sendFontSize=e}},{key:"setPosition",value:function(e){this.player.playerCache.setLocalStorage({dm_position:e}),this.dmModule.config.sendPosition=e}},{key:"setType",value:function(e){this.player.playerCache.setLocalStorage({dm_type:e}),this.dmModule.config.sendType=e}},{key:"getData",value:function(e,t,i){var n=this.dmModule.getData(e,t);i&&i(n)}},{key:"dmReset",value:function(){this.dmModule.config.currentSecond=0}}]),e}();t.default=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=h(i(93)),a=h(i(6)),s=h(i(8)),o=h(i(7)),l=h(i(3)),u=h(i(19)),d=h(i(27)),c=h(i(0));function h(e){return e&&e.__esModule?e:{default:e}}var p=60,f=3,v=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.player=t,this.dmLists=[],this.dataModel,this.txidPing=(0,u.default)(this.player),this.timeRecordArr=[],this.config={currentSecond:0,midFontSize:"22px",largeFontSize:"26px",smallFontSize:"18px",danmuHeight:35,widthNormal:640,maxLine:20,duration:10,totalLine:1,danmuNum:1e3,dmOn:"2",perTime:p,fixDmTimer:f,sendType:"r",sendColor:"16777215",sendFontSize:"m",opacity:"1",sendPosition:"t",css:[],filterColor:0,filterPositionT:1,filterPositionB:1,timeRecord:0},this.init()}return n(e,[{key:"init",value:function(){this.initEvent()}},{key:"initConfig",value:function(e){c.default.log("[\u4e3b\u64ad\u653e\u5668]\u5f39\u5e55dminitConfig="+e.dm_open),this.config.dmOn=e.dm_open?e.dm_open:"2",this.config.sendPosition=e.dm_position?e.dm_position:"t",this.config.sendFontSize=e.dm_fontSize?e.dm_fontSize:"m",this.config.sendType=e.dm_type?e.dm_type:"r",this.config.sendColor=e.dm_color?e.dm_color:"16777215",this.initDmPage()}},{key:"initDmPage",value:function(){var e={fliter:[],dmOpen:this.config.dmOn,place:this.config.sendPosition,size:this.config.sendFontSize,type:this.config.sendType,color:Number(this.config.sendColor).toString(16)};window.messagebus.publish("player.dm_init_setting",e)}},{key:"initEvent",value:function(){this.observePlayer()}},{key:"observePlayer",value:function(){var e=this;this.player.on("data.ok",function(){e.timeRecordArr=[],e.config.timeRecord=0,e.initDMData(!0)}),this.player.on("localstorage.ok",function(){e.initConfig(e.player.storage)}),this.player.on("timeupdate",function(){Math.floor(e.player.currentTime/300)!=e.config.timeRecord&&(e.config.timeRecord=Math.floor(e.player.currentTime/300),e.getContain()&&e.initDMData())})}},{key:"initDMData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.timeRecordArr.push(this.config.timeRecord),this.dataModel=this.player.dataModel,this.config.totalLine=Math.floor(.75*this.player.height/this.config.danmuHeight);var i={model:this.dataModel,type:"1",begin:300*this.config.timeRecord,end:300*(this.config.timeRecord+1),first:t};r.default.loadData(i).then(function(i){if(e.dmLists=i,t){var n=e.getData(1,50);e.outputDMData(n)}}).catch(function(e){c.default.error("[\u4e3b\u64ad\u653e\u5668]\u5f39\u5e55dmdata error--\x3e",e)})}},{key:"getContain",value:function(){var e,t=this.timeRecordArr.length;for(e=0;e<t;e++)if(this.timeRecordArr[e]==this.config.timeRecord)return!1;return!0}},{key:"updatePlayTime",value:function(){if(Math.floor(this.player.currentTime)>this.config.currentSecond)return this.config.currentSecond=Math.floor(this.player.currentTime),this.getCurrentDanmu(this.config.currentSecond)}},{key:"getCurrentDanmu",value:function(e){if(this.dmLists){for(var t=this.dmLists.length,i=[],n=0;n<t;n++){var r=this.dmLists[n];Math.floor(r.vtime)==Math.floor(e)&&i.push(r)}return i}}},{key:"getDmDuration",value:function(e,t){return(e+t)*this.config.duration/(this.config.widthNormal+t)}},{key:"getDmLeftDuration",value:function(e,t){return(e+t)*this.config.duration/(this.config.widthNormal+t)}},{key:"sendDanmu",value:function(e){var t=document.domain.indexOf("56.com")>-1?1:1==this.dataModel.site?2:3,i=document.domain.indexOf("56.com")>-1?"PlayerType.WOLE":1==this.dataModel.site?"PlayerType.SOHU_VRS":"PlayerType.SOHU_UGC",n=(0,o.default)("fuid")||"",r=s.default.getPassport(),l={vid:this.dataModel.vid||"",content:e.content||"",options:e.options,flv_time:e.flv_time,pct:t,from:i,puid:r,aid:this.dataModel.plid,uid:n};(0,a.default)({url:"//api.danmu.tv.sohu.com/danmu?act=dmfire_v2&dct=1",dataType:"json",data:l,type:"post",xhrFields:{withCredentials:!0}}),this.txidPing("pg_barrage_danmusent")}},{key:"upvotePingback",value:function(){this.txidPing("PL_S_PromotionShow_upvote"),(0,d.default)("//click.hd.sohu.com.cn/s.gif?type=PL_S_PromotionShow_upvote?",{_:Date.now()})}},{key:"upvoteDanmu",value:function(e){this.upvotePingback();var t=document.domain.indexOf("56.com")>-1?1:1==this.dataModel.site?2:3,i=document.domain.indexOf("56.com")>-1?"PlayerType.WOLE":1==this.dataModel.site?"PlayerType.SOHU_VRS":"PlayerType.SOHU_UGC",n=(0,o.default)("fuid")||"",r={vid:this.dataModel.vid||"",pct:t,request_from:i,aid:this.dataModel.plid,dm_id:e.dmid,flash_id:n};(0,a.default)({url:"//api.danmu.tv.sohu.com/dm_v2/favor_v2.json?act=favor_v2&dct=1&o=4&"+l.default.stringify(r),dataType:"json",data:r,type:"post",xhrFields:{withCredentials:!0}}).catch(function(e){c.default.error("[\u4e3b\u64ad\u653e\u5668]\u5f39\u5e55\u70b9\u8d5e\u5931\u8d25"+e)})}},{key:"setDMContorl",value:function(e){try{window.s2j_inputAllow(e)}catch(e){}}},{key:"getData",value:function(e,t){var i=(e-1)*t,n=e*t,a=[],s=r.default.getPageTurn();try{var o;n>this.dmLists.length?(n=this.dmLists.length,0):i<0&&(i=0,e=1),i>this.dmLists.length&&c.default.log("\u5f39\u5e55\u5217\u8868\u5df2\u7ecf\u5230\u4e86\u6700\u540e\u4e00\u9875");for(var l=i;l<n;l++)o=this.dmLists[l],a.push(o);return{page:e,flip:n>=this.dmLists.length&&!s?0:1,data:a}}catch(e){}}},{key:"outputDMData",value:function(e){try{window.messagebus.publish("dm.data",e)}catch(e){}}}]),e}();t.default=v},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(i(94)),r=a(i(0));function a(e){return e&&e.__esModule?e:{default:e}}var s,o=[];function l(e){return function(t,i){var n=Number(t[e]),r=Number(i[e]);return n<r?1:n>r?-1:0}}t.default={loadData:function(e){var t=e.model,i=e.type,a=e.begin,u=e.end,d=e.first;if(d&&(o=[]),"1"==i)return new Promise(function(e,i){(0,n.default)({model:t,begin:a,end:u}).then(function(t){var i=function(e){if(!e.info)return;var t=e.info.comments.length;if(e.status<=0)return void r.default.error("[\u4e3b\u64ad\u653e\u5668]\u5f39\u5e55\u6570\u636e\u5f02\u5e38status="+e.status);if(1==e.status&&0==t)return void r.default.log("[\u4e3b\u64ad\u653e\u5668]\u5f39\u5e55\u6570\u636e\u4e3a\u7a7a");s=e.info.pg;for(var i=e.info.comments,n=e.info.dfopt,a=e.info.dfd,l=i.length,u=0;u<l;u++){var d=i[u],c=d.t,h="df"==c?String(n.s):String(d.t.s),p={fcount:d.fcount,id:d.i,vtime:d.v,dtime:1e3*(d.dd+a),size:h,color:"df"==c?String(n.c):String(d.t.c),frame:"n",place:"df"==c?String(n.p):String(d.t.p),roll:"df"==c?String(n.m):String(d.t.m),author:"",content:d.c,star:d.star,photo:d.photo,name:d.name};o.push(p)}return o}(t);r.default.log("[\u4e3b\u64ad\u653e\u5668]\u5f39\u5e55total dm len="+o.length),o.sort(l("dtime")),o.sort(l("fcount")),e(i)}).catch(function(e){i(e)})})},getPageTurn:function(){return s}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.model,i=e.begin,s=e.end;r.default.log("[\u4e3b\u64ad\u653e\u5668]\u83b7\u53d6\u5f39\u5e55\u52a8\u6001\u5217\u8868--\x3e");var l={vid:t.vid||"",page:1,pct:document.domain.indexOf("56.com")>-1?1:1==t.site?2:3,from:document.domain.indexOf("56.com")>-1?"PlayerType.WOLE":1==t.site?"PlayerType.SOHU_VRS":"PlayerType.SOHU_UGC",o:4,aid:t.plid||"",time_begin:i,time_end:s};return new Promise(function(e,t){(0,n.default)({url:o+a.default.stringify(l),dataType:"json",type:"get"}).then(function(t){"success"==t.status&&r.default.log("[\u4e3b\u64ad\u653e\u5668]\u5f39\u5e55\u52a8\u6001\u6570\u636e\u83b7\u53d6\u6210\u529f::\u63a5\u53e3\u72b6\u6001"+t.data.status),e(t.data)}).catch(function(e){r.default.error("[\u4e3b\u64ad\u653e\u5668]\u5f39\u5e55\u52a8\u6001\u6570\u636e\u83b7\u53d6\u5931\u8d25"),t(e)})})};var n=s(i(6)),r=s(i(0)),a=s(i(3));function s(e){return e&&e.__esModule?e:{default:e}}var o="//api.danmu.tv.sohu.com/dm_v2/dmlist_v3.do?act=dmlist_v2&dct=1&request_from=h5_js&"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(1),a=l(i(5)),s=l(i(2)),o=l(i(96));function l(e){return e&&e.__esModule?e:{default:e}}var u='<%@ h:helper %>\n          <div class="x-interact-icon"></div>\n          <div class="x-interact-close"></div>\n          <div class="x-interact-pic">\n            <div class="x-interact-info">\n                <div class="x-interact-info-title"><%= title %></div>\n                <div class="x-interact-info-details">\n                  <span class="x-interact-price-lab" style="opacity:<%= price==0?0:1%>">\u4ef7\u683c\uff1a</span>\n                  <span class="x-interact-price-val" style="opacity:<%= price==0?0:1%>"><%= price %></span> \n                  <a class="x-interact-buy-btn"><%= btntxt %></a>\n                </div>\n            </div>\n          </div>\n          \n    ',d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.ui=e,i.player=e.player,i.beginTimeArr=[],i.tmpl=new a.default(u),i.interactModule=new o.default(i.player),i.init(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.EventEmitter),n(t,[{key:"init",value:function(){this.initEvent(),this.interactPanel=this.ui.container.querySelector(".x-interact-panel"),s.default.hide(this.interactPanel),this.interactPanel.addEventListener("mousedown",function(e){e.stopPropagation()}),this.interactPanel.addEventListener("dblclick",function(e){e.stopPropagation()})}},{key:"initEvent",value:function(){this.observePlayer()}},{key:"observePlayer",value:function(){var e=this;this.player.on("data.ok",function(t){e.inCommon=!0,e.beginTimeArr=[],e.durationArr=[],e.showInteractFlagArr=[],1!=t.isai&&1!=t.wm_data.wm_video||e.interactModule.getInteractData(t).then(function(i){if(i){e.info=i;for(var n=0;n<i.length;n++)1==i[n].type&&(e.showInteractFlagArr[n]=!1,e.beginTimeArr.push(i[n].interactionInfo.beginTime),e.durationArr.push(i[n].interactionInfo.sustainTime),0!=i[n].interactionInfo.itemMoney&&t.ep.push({k:i[n].interactionInfo.beginTime,v:i[n].interactionInfo.slogan,type:1}));e.player.emit("interaction-ready")}})}),this.player.on("timeupdate",function(){for(var t=e.player.currentTime,i=0;i<e.beginTimeArr.length;i++){var n=e.beginTimeArr[i];Math.floor(t)>=n-1&&Math.floor(t)<n+14&&!e.showInteractFlagArr[i]&&e.show(i)}}),this.player.on("player-state",function(t){var i="none";0==t?i="none":e.isShowing&&(i="block"),s.default.css(e.interactPanel,"display",i),e.inCommon=0!=t})}},{key:"show",value:function(e){for(var t=this,i=0;i<this.beginTimeArr.length;i++)this.showInteractFlagArr[i]=e==i;this.isShowing=!0,this.interactPanel.innerHTML=this.tmpl.render({title:this.info[e].interactionInfo.slogan,price:this.info[e].interactionInfo.itemMoney,btntxt:0==this.info[e].interactionInfo.itemMoney?"\u53bb\u770b\u770b":"\u8d2d\u4e70"}),s.default.show(this.interactPanel),s.default.css(this.interactPanel,"display",this.inCommon?"block":"none"),this.icon=this.ui.container.querySelector(".x-interact-icon"),this.close=this.ui.container.querySelector(".x-interact-close"),this.pic=this.ui.container.querySelector(".x-interact-pic"),this.actinfo=this.ui.container.querySelector(".x-interact-info"),this.buyBtn=this.ui.container.querySelector(".x-interact-buy-btn"),this.adImg=this.info[e].interactionInfo.adImage,this.pic.addEventListener("mousedown",function(i){i.stopPropagation(),window.open(t.info[e].interactionInfo.adHref),t.ui.txidPing("pg_player_adgameplay")}),this.close.addEventListener("mousedown",function(e){e.stopPropagation(),t.hide(!1)}),this.icon.style.cssText="transition: all .5s linear; opacity: 1;",this.pic.style.cssText="transition: all .3s linear .5s; height: 75px;background: url("+this.adImg+") no-repeat;background-size:cover;background-position: bottom;",this.close.style.cssText="transition: all .3s linear 2.5s;opacity:1 ",this.actinfo.style.cssText="animation: showInfo 4.5s linear 1.5s;",setTimeout(function(){t.icon.style.cssText="transition: all .5s linear; opacity: 0;"},2500),this.autoHideTimer&&clearTimeout(this.autoHideTimer);var n=1e3*Number(this.durationArr[e]);this.autoHideTimer=setTimeout(function(){t.autoHideTimer=null,t.hide(!0)},n)}},{key:"hide",value:function(e){if(s.default.hide(this.interactPanel),e)for(var t=0;t<this.beginTimeArr.length;t++)this.showInteractFlagArr[t]=!1;this.isShowing=!1}}]),t}();t.default=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(e){return e&&e.__esModule?e:{default:e}}(i(97));var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.player=t}return n(e,[{key:"getInteractData",value:function(e){return new Promise(function(t){(0,r.default)({model:e}).then(function(e){t(e.data)})})}}]),e}();t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.model,i=1==t.isai,o={vid:t.tvid||"",sid:t.plid||"",passport:r.default.getPassport(),vtype:i?"0":"1",plat:1};return(0,n.default)({url:(i?l:u)+s.default.stringify(o),dataType:"jsonp",type:"post"}).then(function(e){if(e&&1==e.data.status)return e.data}).catch(function(e){a.default.log("[\u4e3b\u64ad\u653e\u5668]\u4e92\u52a8\u6570\u636e\u83b7\u53d6\u5931\u8d25"+e)})};var n=o(i(6)),r=o(i(8)),a=o(i(0)),s=o(i(3));function o(e){return e&&e.__esModule?e:{default:e}}var l="//my.tv.sohu.com/interaction/get/getListByVidForVrs.do?",u="//my.tv.sohu.com/interaction/get/getListByVid.do?"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=l(i(2)),a=l(i(0)),s=i(1),o=l(i(24));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.ui=e,i.player=e.player,i.init(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.EventEmitter),n(t,[{key:"init",value:function(){var e=this;this.logPanel=this.ui.container.querySelector(".x-log-panel"),this.logPanel.innerHTML='\n  <button class="x-log-close-btn">\u5173\u95ed</button>\n  <div class="x-log-info">\n      <div class="x-log-info-txt"></div>\n      <div class="x-log-btns">\n        <div class="x-log-btns-container">\n          <span class="x-log-btn x-log-send-btn">\u53d1\u9001\u5168\u90e8log</span>\n          <span class="x-log-btn x-log-btn x-log-copy-btn"  data-role="x-copy-log-btn">\u590d\u5236\u5168\u90e8log</span>\n          <span class="x-log-btn x-log-mail-btn">MailTo\uff1aFANKUI</span>\n        </div>\n      </div>\n  </div>\n  \n',this.logInfo=this.ui.container.querySelector(".x-log-info"),this.logInfoTxt=this.ui.container.querySelector(".x-log-info-txt"),this.closebtn=this.ui.container.querySelector(".x-log-close-btn"),this.closebtn.addEventListener("click",function(t){t.stopPropagation(),e.hide()}),this.logPanel.addEventListener("click",function(e){e.stopPropagation()}),this.logPanel.addEventListener("dblclick",function(e){e.stopPropagation()}),this.logPanel.querySelector('[data-role="x-copy-log-btn"]').addEventListener("click",function(t){t.stopPropagation();try{o.default.copy(a.default.stringify()),a.default.log("[\u4e3b\u64ad\u653e\u5668]\u64ad\u653e\u5668log\u5df2\u590d\u5236"),setTimeout(function(){e.logInfoTxt.scrollTop=e.logInfoTxt.scrollHeight},100)}catch(t){a.default.error("[\u4e3b\u64ad\u653e\u5668]copy e--\x3e",t)}}),this.logPanel.querySelector(".x-log-send-btn").addEventListener("click",function(e){e.stopPropagation(),window.saveFlashLog("H5\u64ad\u653e\u5668\u65e5\u5fd7\uff1a "+a.default.stringify())}),this.logPanel.querySelector(".x-log-mail-btn").addEventListener("click",function(e){e.stopPropagation(),window.location="mailto:fankui@sohu-inc.com;tvjs@sohu-inc.com?subject=SohuTVPlayerLogsH5("+new Date+")&body=Please paste:%0a%0d"}),this.hide(),this.observePlayer()}},{key:"observePlayer",value:function(){var e=this;this.player.on("resize",function(){e.isSafari()&&e.player.isFullscreen()?setTimeout(function(){e.resize()},500):e.resize()}),this.player.on("timeupdate",function(){e.pwidth=e.player.width})}},{key:"show",value:function(){var e=this;this.logInfoTxt.innerHTML=a.default.stringify(),setTimeout(function(){e.logInfoTxt.scrollTop=e.logInfoTxt.scrollHeight},100),this.logTimeId=setInterval(function(){e.logInfoTxt.innerHTML=a.default.stringify()},1e3),r.default.css(this.logPanel,"display","block"),r.default.css(this.logPanel,"width",this.player.width-1+"px"),r.default.css(this.logPanel,"height",this.player.height-60+"px"),r.default.css(this.logInfoTxt,"height",this.player.height-140+"px")}},{key:"hide",value:function(){this.logTimeId&&clearInterval(this.logTimeId),this.logInfoTxt.innerHTML="",r.default.css(this.logPanel,"display","none")}},{key:"resize",value:function(){r.default.css(this.logPanel,"width",this.player.width-1+"px"),r.default.css(this.logPanel,"height",this.player.height-60+"px"),r.default.css(this.logInfoTxt,"height",this.player.height-140+"px")}},{key:"isSafari",value:function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("safari")>=0&&e.indexOf("chrome")<0}}]),t}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(i(100)),r=o(i(101)),a=o(i(102)),s=o(i(4));function o(e){return e&&e.__esModule?e:{default:e}}t.default={loadData:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i={code:200};return new Promise(function(r){(0,a.default)(e).then(function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i.authenData=a;var o=a.data||{};if(1!=o.state){if(1==e.fee)return i.code=102,r(i);if(1==e.orifee&&t)return i.code=103,r(i)}n.default.loadData(s.default.extend({},e,{mkey:o.mkey})).then(function(e){i.code=e.code,i.vdata=e.data,r(i)})})})},loadLiveData:function(e){return r.default.loadData(e)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s(i(0)),r=s(i(3)),a=s(i(10));function s(e){return e&&e.__esModule?e:{default:e}}var o=3,l=4,u="//bkhot.vrs.sohu.com/vrs_flash.action?usebk=1&",d=function(e,t){return new Promise(function(i){var r=0,s=2;!function d(){s+=3,(r+=1)>=l&&(e=u+e.split("?")[1],n.default.log("[\u4e3b\u64ad\u653e\u5668]\u542f\u7528hotvrs\u5907\u7528\u63a5\u53e3 --\x3e",e)),(0,a.default)(e,t?{credentials:"include"}:{},1e3*s).then(function(e){if(e.ok)return e.json();throw Error(e.status)}).then(function(e){1==e.play?1==e.status?i({code:"200",data:e}):i({code:"201",data:e}):i({code:"100",data:e})}).catch(function(){r>=o?!t&&r<l?d():i({code:501}):d()})}()})};t.default={loadData:function(e){var t=e.vid,i=e.resolution,a=e.site,s=e.mkey,o=e.fee,l=e.pwd;return 1==a?function(e){var t=e.vid,i=e.resolution,a=e.mkey,s=e.fkey,o={vid:t,ver:i,af:void 0===i?1:0,ssl:0==window.location.href.indexOf("https")?1:2,pflag:"pch5"};a&&(o.mkey=a),s&&(o.fkey=s);var l="//hot.vrs.sohu.com/vrs_flash.action?"+r.default.stringify(o);return n.default.log("[\u4e3b\u64ad\u653e\u5668]vurl --\x3e",l),d(l,!1)}({vid:t,resolution:i,mkey:s,fee:o}):function(e){var t=e.vid,i=e.resolution,a=e.pwd,s={vid:t,ver:i,ssl:0==window.location.href.indexOf("https")?1:2,referer:window.location.href,t:(new Date).getTime()};a&&""!=a&&(s.passwd=a);var o="//my.tv.sohu.com/play/videonew.do?"+r.default.stringify(s);return n.default.log("[\u4e3b\u64ad\u653e\u5668]vurl --\x3e",o),d(o,!0)}({vid:t,resolution:i,pwd:l})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(i(10));var r=3;t.default={loadData:function(e){return function(e){return new Promise(function(t){var i=0;!function a(){i+=1,(0,n.default)(e,3e3).then(function(e){if(e.ok)return e.json();throw Error(e.status)}).then(function(e){var i=e.status,n=e.data;200==i&&t({code:200,data:n})}).catch(function(){i>=r?t({code:501}):a()})}()})}("//testapi.hd.sohu.com/live/distribute_json.jhtml?prod=h5pc&encoding=utf8&lid="+e.lid+"&type="+e.type+"&ssl="+(0==window.location.href.indexOf("https")?1:2))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(i(6)),r=a(i(8));function a(e){return e&&e.__esModule?e:{default:e}}var s=3;t.default=function(e){return new Promise(function(t){if(1!=e.fee&&(void 0!==e.orifee&&1!=e.orifee||31!=e.resolution))return setTimeout(function(){return t({data:{state:1}})},0);if((1==e.fee||1==e.orifee&&31==e.resolution)&&!r.default.getPassport())return setTimeout(function(){return t({status:200,data:{state:-2}})},0);var i=0,a="https://api.store.sohu.com/film/pc/checkpermission?callback=?&aid="+e.plid+"&vid="+e.vid+"&tvid="+e.tvid;!function e(){i+=1,n.default.getJSON(a).then(function(e){var i=e.data;return t(void 0===i?{}:i)}).catch(function(){i>=s?t({data:{state:-2}}):e()})}()})}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(e){return e&&e.__esModule?e:{default:e}}(i(4));var a=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.player=t,this.originalData=i,this.init(i)}return n(e,[{key:"init",value:function(e){var t={};t.vid=""+e.id,t.ch=e.data.ch,t.iswebp2p=e.iswebp2p||1,t.allot=e.allot,t.reserveIp=e.reserveIp,t.videos=[];for(var i=e.data.su,n=e.data.hc,a=e.data.ck,s=e.data.clipsDuration,o=e.data.clipsBytes,l=e.data.clipsURL,u=0,d=0,c=0,h=i.length;c<h;c++)t.videos.push({fileName:4==e.prot?"":i[c],code:n[c],key:a[c],duration:s[c],size:o[c],clipsURL:l[c]}),u+=s[c],d+=o[c];this.data=t,this.duration=e.data.totalDuration||u,this.size=d,this.isDrm=e.tvPlayType||0,this.norVid=e.data.norVid||0,this.highVid=e.data.highVid||0,this.superVid=e.data.superVid||0,this.oriVid=e.data.oriVid||0,this.h2644kVid=e.data.h2644kVid||0,this.lowestResolution=0!=this.norVid?"2":0!=this.highVid?"1":0!=this.superVid?"21":0!=this.oriVid?"31":this.h2644kVid,this.title=e.data.tvName,this.vid=this.player.videoData.vid,this.tvid=e.tvid,this.plid=e.pid,this.cid=e.plcatid||e.caid,this.serverTime=e.syst,this.areaid=e.areaId||"",this.ltype=0,this.catecode=e.catcode||"",this.site=this.player.videoData.site,this.vr=e.vr,this.ch=e.data.ch,this.width=e.data.width,this.height=e.data.height,this.storypic=e.pvpic||{},this.ep=e.data.eP||[],this.adpo=e.data.adpo||[{s:895,t:"mad",k:""}],this.myTvRotate=e.rotate||0,this.sT=e.data.sT||0,this.eT=e.data.eT||0,this.myTvSize=1,r.default.extend(this,{fee:e.fee,crid:e.crid,year:e.year,act:e.act,mainActorId:e.mainActorId,age:e.age,myTvUid:e.data.myTvUid,tag:e.data.tag,pay_data:e.pay_data||{},wm_data:e.wm_data||{},cmscat:e.cmscat||"",orifee:e.data.orifee}),this.pay_data!={}?(this.isUgcFeeVideo=1==this.pay_data.isPayVideo,this.isUgcPreview=0==this.pay_data.isPay,this.previewTime=this.pay_data.trailerTime):(this.isUgcFeeVideo=!1,this.isUgcPreview=!1,this.previewTime=0),this.isSelf=e.isSelf||0,this.isai=e.isai||0,this.bandpo=[{band_inx:1,band_t:120},{band_inx:2,band_t:240}],this.initResolution(e)}},{key:"initResolution",value:function(e){var t=e.data;this.resolution=1==this.isDrm?this.lowestResolution:t.version,this.resolutionList=[{t:"norVid",v:2},{t:"highVid",v:1},{t:"superVid",v:21},{t:"oriVid",v:31}].filter(function(e){return t[e.t]&&0!=t[e.t]}).map(function(e){return e.v})}},{key:"hasResolution",value:function(e){return-1!=this.resolutionList.indexOf(e/1)}},{key:"getDuration",value:function(){return this.duration}},{key:"getSize",value:function(){return this.size}}]),e}();t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(105);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ADKernel=t.P2PKernel=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=i(1),a=i(106),s=function(e){return e&&e.__esModule?e:{default:e}}(i(0));function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var d=function(){var e=new Date,t=4;return{setLogLevel:function(e){t=e==this.debug?1:e==this.info?2:e==this.warn?3:(this.error,4)},debug:function(i,n){1>=t&&console.debug("["+d.getDurationString(new Date-e,1e3)+"]","["+i+"]",n)},info:function(i,n){2>=t&&console.info("["+d.getDurationString(new Date-e,1e3)+"]","["+i+"]",n)},warn:function(i,n){3>=t&&console.warn("["+d.getDurationString(new Date-e,1e3)+"]","["+i+"]",n)},error:function(i,n){4>=t&&console.error("["+d.getDurationString(new Date-e,1e3)+"]","["+i+"]",n)}}}();d.getDurationString=function(e,t){function i(e,t){for(var i=(""+e).split(".");i[0].length<t;)i[0]="0"+i[0];return i.join(".")}var n=e/(t||1),r=Math.floor(n/3600);n-=3600*r;var a=Math.floor(n/60),s=1e3*(n-=60*a);return s-=1e3*(n=Math.floor(n)),s=Math.floor(s),r+":"+i(a,2)+":"+i(n,2)+"."+i(s,3)},d.printRanges=function(e){var t=e.length;if(t>0){for(var i="",n=0;n<t;n++)n>0&&(i+=","),i+="["+d.getDurationString(e.start(n))+","+d.getDurationString(e.end(n))+"]";return i}return"(empty)"};var c={ERR_NOT_ENOUGH_DATA:0,OK:1,boxCodes:["mdat","idat","free","skip","avcC","hvcC","ftyp","styp","payl","vttC","rtp ","sdp ","btrt","frma","trpy","tpyl","totl","tpay","dmed","dimm","drep","nump","npck","maxr","tmin","tmax","dmax","pmax","payt","vmhd","smhd","hmhd","idat","meco","udta","strk","free","skip"],fullBoxCodes:["mvhd","tkhd","mdhd","hdlr","vmhd","smhd","hmhd","nmhd","url ","urn ","ctts","cslg","stco","co64","stsc","stss","stsz","stz2","stts","stsh","mehd","trex","mfhd","tfhd","trun","tfdt","esds","subs","txtC","sidx","emsg","prft","pssh","elst","dref","url ","urn ","sbgp","sgpd","cprt","iods","ssix","tfra","mfro","pdin","tsel","trep","leva","stri","stsg","schm","stvi","padb","stdp","sdtp","saio","saiz","meta","xml ","bxml","iloc","pitm","ipro","iinf","infe","iref","mere","kind","elng"],containerBoxCodes:[["moov",["trak","sidx"]],["trak"],["edts"],["mdia"],["minf"],["dinf"],["stbl",["sgpd"]],["mvex",["trex"]],["moof",["traf"]],["traf",["trun"]],["vttc"],["tref"],["iref"],["udta"],["mfra"],["meco"],["hnti"],["hinf"],["strk"],["strd"],["sinf"],["rinf"],["schi"],["trgr"],["udta",["kind"]],["iprp"]],sampleEntryCodes:[{prefix:"Visual",types:["mp4v","avc1","avc2","avc3","avc4","avcp","drac","encv","mjp2","mvc1","mvc2","resv","s263","svc1","vc-1","hvc1","hev1"]},{prefix:"Audio",types:["mp4a","ac-3","alac","dra1","dtsc","dtse",,"dtsh","dtsl","ec-3","enca","g719","g726","m4ae","mlpa","raw ","samr","sawb","sawp","sevc","sqcp","ssmv","twos",".mp3"]},{prefix:"Hint",types:["fdp ","m2ts","pm2t","prtp","rm2t","rrtp","rsrp","rtp ","sm2t","srtp"]},{prefix:"Metadata",types:["metx","mett","urim"]},{prefix:"Subtitle",types:["stpp","wvtt","sbtt","tx3g","stxt"]},{prefix:"System",types:["mp4s"]}],sampleGroupEntryCodes:["roll","prol","alst","rap ","tele","avss","avll","sync","tscl","tsas","stsa","scif","mvif","scnm","dtrt","vipr","tele","rash"],trackGroupTypes:["msrc"],initialize:function(){var e,t,i;for(c.FullBox.prototype=new c.Box,c.ContainerBox.prototype=new c.Box,c.SampleEntry.prototype=new c.FullBox,c.TrackGroupTypeBox.prototype=new c.FullBox,i=c.boxCodes.length,e=0;e<i;e++)c[c.boxCodes[e]+"Box"]=function(e){return function(t){c.Box.call(this,c.boxCodes[e],t)}}(e),c[c.boxCodes[e]+"Box"].prototype=new c.Box;for(i=c.fullBoxCodes.length,e=0;e<i;e++)c[c.fullBoxCodes[e]+"Box"]=function(e){return function(t){c.FullBox.call(this,c.fullBoxCodes[e],t)}}(e),c[c.fullBoxCodes[e]+"Box"].prototype=new c.FullBox;for(i=c.containerBoxCodes.length,e=0;e<i;e++)c[c.containerBoxCodes[e][0]+"Box"]=function(e,t){return function(i){if(c.ContainerBox.call(this,c.containerBoxCodes[e][0],i),t){this.subBoxNames=t;for(var n=t.length,r=0;r<n;r++)this[t[r]+"s"]=[]}}}(e,c.containerBoxCodes[e][1]),c[c.containerBoxCodes[e][0]+"Box"].prototype=new c.ContainerBox;for(i=c.sampleEntryCodes.length,t=0;t<i;t++){var n=c.sampleEntryCodes[t].prefix,r=c.sampleEntryCodes[t].types,a=r.length;for(c[n+"SampleEntry"]=function(e,t){c.SampleEntry.call(this,e,t)},c[n+"SampleEntry"].prototype=new c.SampleEntry,e=0;e<a;e++)c[r[e]+"SampleEntry"]=function(e,t){return function(i){c[c.sampleEntryCodes[e].prefix+"SampleEntry"].call(this,c.sampleEntryCodes[e].types[t],i)}}(t,e),c[r[e]+"SampleEntry"].prototype=new c[n+"SampleEntry"]}for(i=c.sampleGroupEntryCodes.length,e=0;e<i;e++)c[c.sampleGroupEntryCodes[e]+"SampleGroupEntry"]=function(e){return function(t){c.SampleGroupEntry.call(this,c.sampleGroupEntryCodes[e],t)}}(e),c[c.sampleGroupEntryCodes[e]+"SampleGroupEntry"].prototype=new c.SampleGroupEntry;for(i=c.trackGroupTypes.length,e=0;e<i;e++)c[c.trackGroupTypes[e]+"Box"]=function(e){return function(t){c.TrackGroupTypeBox.call(this,c.trackGroupTypes[e],t)}}(e),c[c.trackGroupTypes[e]+"Box"].prototype=new c.TrackGroupTypeBox},Box:function(e,t){this.type=e,this.size=t},FullBox:function(e,t){c.Box.call(this,e,t),this.flags=0,this.version=0},ContainerBox:function(e,t){c.Box.call(this,e,t),this.boxes=[]},SampleEntry:function(e,t,i,n){c.Box.call(this,e,t),this.hdr_size=i,this.start=n,this.boxes=[]},SampleGroupEntry:function(e){this.grouping_type=e},TrackGroupTypeBox:function(e,t){c.FullBox.call(this,e,t)}};c.initialize(),c.TKHD_FLAG_ENABLED=1,c.TKHD_FLAG_IN_MOVIE=2,c.TKHD_FLAG_IN_PREVIEW=4,c.TFHD_FLAG_BASE_DATA_OFFSET=1,c.TFHD_FLAG_SAMPLE_DESC=2,c.TFHD_FLAG_SAMPLE_DUR=8,c.TFHD_FLAG_SAMPLE_SIZE=16,c.TFHD_FLAG_SAMPLE_FLAGS=32,c.TFHD_FLAG_DUR_EMPTY=65536,c.TFHD_FLAG_DEFAULT_BASE_IS_MOOF=131072,c.TRUN_FLAGS_DATA_OFFSET=1,c.TRUN_FLAGS_FIRST_FLAG=4,c.TRUN_FLAGS_DURATION=256,c.TRUN_FLAGS_SIZE=512,c.TRUN_FLAGS_FLAGS=1024,c.TRUN_FLAGS_CTS_OFFSET=2048,c.parseOneBox=function(e,t){var i,n,r=e.getPosition(),a=0;if(e.getEndPosition()-r<8)return d.debug("BoxParser","Not enough data in stream to parse the type and size of the box"),{code:c.ERR_NOT_ENOUGH_DATA};var s=e.readUint32(),o=e.readString(4);if(d.debug("BoxParser","Found box of type "+o+" and size "+s+" at position "+r),a=8,"uuid"==o&&(n=e.readUint8Array(16),a+=16),1==s){if(e.getEndPosition()-e.getPosition()<8)return e.seek(r),d.warn("BoxParser",'Not enough data in stream to parse the extended size of the "'+o+'" box'),{code:c.ERR_NOT_ENOUGH_DATA};s=e.readUint64(),a+=8}else if(0===s&&"mdat"!==o)throw"Unlimited box size not supported";return r+s>e.getEndPosition()?(e.seek(r),d.warn("BoxParser",'Not enough data in stream to parse the entire "'+o+'" box'),{code:c.ERR_NOT_ENOUGH_DATA,type:o,size:s,hdr_size:a,start:r}):t?{code:c.OK,type:o,size:s,hdr_size:a,start:r}:(c[o+"Box"]?i=new c[o+"Box"](s):("uuid"!==o&&d.warn("BoxParser","Unknown box type: "+o),i=new c.Box(o,s),n&&(i.uuid=n)),i.hdr_size=a,i.start=r,i.write===c.Box.prototype.write&&"mdat"!==i.type&&(d.warn("BoxParser",i.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),i.parseDataAndRewind(e)),i.parse(e),{code:c.OK,box:i,size:s})},c.Box.prototype.parse=function(e){"mdat"!=this.type?this.data=e.readUint8Array(this.size-this.hdr_size):0===this.size?e.seek(e.getEndPosition()):e.seek(this.start+this.size)},c.Box.prototype.parseDataAndRewind=function(e){this.data=e.readUint8Array(this.size-this.hdr_size),e.position-=this.size-this.hdr_size},c.FullBox.prototype.parseDataAndRewind=function(e){this.parseFullHeader(e),this.data=e.readUint8Array(this.size-this.hdr_size),this.hdr_size-=4,e.position-=this.size-this.hdr_size},c.FullBox.prototype.parseFullHeader=function(e){this.version=e.readUint8(),this.flags=e.readUint24(),this.hdr_size+=4},c.FullBox.prototype.parse=function(e){this.parseFullHeader(e),this.data=e.readUint8Array(this.size-this.hdr_size)},c.ContainerBox.prototype.parse=function(e){for(var t;e.getPosition()<this.start+this.size;)t=c.parseOneBox(e,!1).box,this.boxes.push(t),this.subBoxNames&&-1!=this.subBoxNames.indexOf(t.type)?this[this.subBoxNames[this.subBoxNames.indexOf(t.type)]+"s"].push(t):this[t.type]=t},c.Box.prototype.parseLanguage=function(e){this.language=e.readUint16();var t=[];t[0]=this.language>>10&31,t[1]=this.language>>5&31,t[2]=31&this.language,this.languageString=String.fromCharCode(t[0]+96,t[1]+96,t[2]+96)};var h=function(e){if(!(e instanceof ArrayBuffer))throw"Needs an array buffer";this.buffer=e,this.uint8=new Uint8Array(e),this.position=0};h.prototype.getPosition=function(){return this.position},h.prototype.getEndPosition=function(){return this.buffer.byteLength},h.prototype.getLength=function(){return this.buffer.byteLength},h.prototype.seek=function(e){var t=Math.max(0,Math.min(this.uint8.length,e));this.position=isNaN(t)||!isFinite(t)?0:t},h.prototype.isEos=function(){return this.getPosition()>=this.getEndPosition()},h.prototype.readUint8=function(){var e;if(this.position+1<=this.uint8.length)return e=this.uint8[this.position],this.position++,e;throw"Not enough bytes in buffer"},h.prototype.readUint16=function(){var e,t;if(this.position+2<=this.uint8.length)return e=this.uint8[this.position],this.position++,t=this.uint8[this.position],this.position++,e<<8|t;throw"Not enough bytes in buffer"},h.prototype.readUint24=function(){var e;if(this.position+3<=this.uint8.length)return e=this.uint8[this.position]<<16,this.position++,e|=this.uint8[this.position]<<8,this.position++,e|=this.uint8[this.position],this.position++,e;throw"Not enough bytes in buffer"},h.prototype.readUint32=function(){var e;if(this.position+4<=this.uint8.length)return e=this.uint8[this.position]<<24,this.position++,e|=this.uint8[this.position]<<16,this.position++,e|=this.uint8[this.position]<<8,this.position++,e|=this.uint8[this.position],this.position++,e;throw"Not enough bytes in buffer"},h.prototype.readUint64=function(){var e;if(this.position+8<=this.uint8.length)return e=this.readUint32()<<32,e|=this.readUint32();throw"Not enough bytes in buffer"},h.prototype.readString=function(e){if(this.position+e<=this.uint8.length){for(var t="",i=0;i<e;i++)t+=String.fromCharCode(this.readUint8());return t}throw"Not enough bytes in buffer"},h.prototype.readCString=function(){for(var e=[];;){var t=this.readUint8();if(0===t)break;e.push(t)}return String.fromCharCode.apply(null,e)},h.prototype.readInt8=function(){return this.readUint8()},h.prototype.readInt16=function(){return this.readUint16()},h.prototype.readInt32=function(){return this.readUint32()},h.prototype.readUint8Array=function(e){for(var t=[],i=0;i<e;i++)t[i]=this.readUint8();return t},h.prototype.readInt16Array=function(e){for(var t=[],i=0;i<e;i++)t[i]=this.readUint16();return t},h.prototype.readUint32Array=function(e){for(var t=[],i=0;i<e;i++)t[i]=this.readUint32();return t},h.prototype.readInt32Array=function(e){for(var t=[],i=0;i<e;i++)t[i]=this.readInt32();return t},c.stscBox.prototype.parse=function(e){var t,i;if(this.parseFullHeader(e),t=e.readUint32(),this.first_chunk=[],this.samples_per_chunk=[],this.sample_description_index=[],0===this.version)for(i=0;i<t;i++)this.first_chunk.push(e.readUint32()),this.samples_per_chunk.push(e.readUint32()),this.sample_description_index.push(e.readUint32());else this.data=e.readUint8Array(this.size-this.hdr_size-4)},c.avcCBox.prototype.parse=function(e){var t,i,n,r;for(this.configurationVersion=e.readUint8(),this.AVCProfileIndication=e.readUint8(),this.profile_compatibility=e.readUint8(),this.AVCLevelIndication=e.readUint8(),this.lengthSizeMinusOne=3&e.readUint8(),i=31&e.readUint8(),r=this.size-this.hdr_size-6,this.SPS=new Array(i),t=0;t<i;t++)n=e.readUint16(),this.SPS[t]=e.readUint8Array(n),r-=2+n;for(i=e.readUint8(),r--,this.PPS=new Array(i),t=0;t<i;t++)n=e.readUint16(),this.PPS[t]=e.readUint8Array(n),r-=2+n;r>0&&(this.ext=e.readUint8Array(r))},c.striBox.prototype.parse=function(e){this.parseFullHeader(e),this.switch_group=e.readUint16(),this.alternate_group=e.readUint16(),this.sub_track_id=e.readUint32();var t=(this.size-this.hdr_size-8)/4;this.attribute_list=[];for(var i=0;i<t;i++)this.attribute_list[i]=e.readUint32()},c.scifSampleGroupEntry.prototype.parse=function(e){d.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")},c.alstSampleGroupEntry.prototype.parse=function(e){var t,i=e.readUint16();for(this.first_output_sample=e.readUint16(),this.sample_offset=[],t=0;t<i;t++)this.sample_offset[t]=e.readUint32();var n=this.description_length-4-4*i;for(this.num_output_samples=[],this.num_total_samples=[],t=0;t<n/4;t++)this.num_output_samples[t]=e.readUint16(),this.num_total_samples[t]=e.readUint16()},c.prolSampleGroupEntry.prototype.parse=function(e){this.roll_distance=e.readInt16()},c.stsaSampleGroupEntry.prototype.parse=function(e){d.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")},c.scnmSampleGroupEntry.prototype.parse=function(e){d.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")},c.avssSampleGroupEntry.prototype.parse=function(e){this.subSequenceIdentifier=e.readUint16(),this.layerNumber=e.readUint8();var t=e.readUint8();this.durationFlag=t>>7,this.avgRateFlag=t>>6&1,this.durationFlag&&(this.duration=e.readUint32()),this.avgRateFlag&&(this.accurateStatisticsFlag=e.readUint8(),this.avgBitRate=e.readUint16(),this.avgFrameRate=e.readUint16()),this.dependency=[];for(var i=e.readUint8(),n=0;n<i;n++){var r={};this.dependency.push(r),r.subSeqDirectionFlag=e.readUint8(),r.layerNumber=e.readUint8(),r.subSequenceIdentifier=e.readUint16()}},c.tsasSampleGroupEntry.prototype.parse=function(e){d.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")},c.syncSampleGroupEntry.prototype.parse=function(e){var t=e.readUint8();this.NAL_unit_type=63&t},c.dtrtSampleGroupEntry.prototype.parse=function(e){d.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")},c.tsclSampleGroupEntry.prototype.parse=function(e){d.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")},c.avllSampleGroupEntry.prototype.parse=function(e){this.layerNumber=e.readUint8(),this.accurateStatisticsFlag=e.readUint8(),this.avgBitRate=e.readUint16(),this.avgFrameRate=e.readUint16()},c.rollSampleGroupEntry.prototype.parse=function(e){this.roll_distance=e.readInt16()},c.viprSampleGroupEntry.prototype.parse=function(e){d.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")},c["rap SampleGroupEntry"].prototype.parse=function(e){var t=e.readUint8();this.num_leading_samples_known=t>>7,this.num_leading_samples=127&t},c.teleSampleGroupEntry.prototype.parse=function(e){var t=e.readUint8();this.level_independently_decodable=t>>7},c.rashSampleGroupEntry.prototype.parse=function(e){if(this.operation_point_count=e.readUint16(),this.description_length!==2+(1===this.operation_point_count?2:6*this.operation_point_count)+9)d.warn("BoxParser","Mismatch in "+this.grouping_type+" sample group length"),this.data=e.readUint8Array(this.description_length-2);else{if(1===this.operation_point_count)this.target_rate_share=e.readUint16();else{this.target_rate_share=[],this.available_bitrate=[];for(var t=0;t<this.operation_point_count;t++)this.available_bitrate[t]=e.readUint32(),this.target_rate_share[t]=e.readUint16()}this.maximum_bitrate=e.readUint32(),this.minimum_bitrate=e.readUint32(),this.discard_priority=e.readUint8()}},c.mvifSampleGroupEntry.prototype.parse=function(e){d.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")},c.SampleGroupEntry.prototype.parse=function(e){d.warn("BoxParser","Unknown Sample Group type: "+this.grouping_type),this.data=e.readUint8Array(this.description_length)},c.drefBox.prototype.parse=function(e){var t;this.parseFullHeader(e),this.entries=[];for(var i=e.readUint32(),n=0;n<i;n++)t=c.parseOneBox(e,!1).box,this.entries.push(t)},c.schmBox.prototype.parse=function(e){this.parseFullHeader(e),this.scheme_type=e.readString(4),this.scheme_version=e.readUint32(),1&this.flags&&(this.scheme_uri=e.readString(this.size-this.hdr_size-8))},c.infeBox.prototype.parse=function(e){if(this.parseFullHeader(e),0!==this.version&&1!==this.version||(this.item_ID=e.readUint16(),this.item_protection_index=e.readUint16(),this.item_name=e.readCString(),this.content_type=e.readCString(),this.content_encoding=e.readCString()),1===this.version)return this.extension_type=e.readString(4),d.warn("BoxParser","Cannot parse extension type"),void e.seek(this.start+this.size);this.version>=2&&(2===this.version?this.item_ID=e.readUint16():3===this.version&&(this.item_ID=e.readUint32()),this.item_protection_index=e.readUint16(),this.item_type=e.readString(4),this.name=e.readCString(),"mime"===this.item_type?(this.content_type=e.readCString(),this.content_encoding=e.readCString()):"uri "===this.item_type&&(this.item_uri_type=e.readCString())),e.getPosition()>this.start+this.size&&(d.warn("BoxParser","Parsed more than the size of the box (null-terminated string problem?)"),e.seek(this.start+this.size))},c.tfhdBox.prototype.parse=function(e){var t=0;this.parseFullHeader(e),this.track_id=e.readUint32(),this.size-this.hdr_size>t&&this.flags&c.TFHD_FLAG_BASE_DATA_OFFSET?(this.base_data_offset=e.readUint64(),t+=8):this.base_data_offset=0,this.size-this.hdr_size>t&&this.flags&c.TFHD_FLAG_SAMPLE_DESC?(this.default_sample_description_index=e.readUint32(),t+=4):this.default_sample_description_index=0,this.size-this.hdr_size>t&&this.flags&c.TFHD_FLAG_SAMPLE_DUR?(this.default_sample_duration=e.readUint32(),t+=4):this.default_sample_duration=0,this.size-this.hdr_size>t&&this.flags&c.TFHD_FLAG_SAMPLE_SIZE?(this.default_sample_size=e.readUint32(),t+=4):this.default_sample_size=0,this.size-this.hdr_size>t&&this.flags&c.TFHD_FLAG_SAMPLE_FLAGS?(this.default_sample_flags=e.readUint32(),t+=4):this.default_sample_flags=0},c.dimmBox.prototype.parse=function(e){this.bytessent=e.readUint64()},c.hvcCBox.prototype.parse=function(e){var t,i,n,r;this.configurationVersion=e.readUint8(),r=e.readUint8(),this.general_profile_space=r>>6,this.general_tier_flag=(32&r)>>5,this.general_profile_idc=31&r,this.general_profile_compatibility=e.readUint32(),this.general_constraint_indicator=e.readUint8Array(6),this.general_level_idc=e.readUint8(),this.min_spatial_segmentation_idc=4095&e.readUint16(),this.parallelismType=3&e.readUint8(),this.chromaFormat=3&e.readUint8(),this.bitDepthLumaMinus8=7&e.readUint8(),this.bitDepthChromaMinus8=7&e.readUint8(),this.avgFrameRate=e.readUint16(),r=e.readUint8(),this.constantFrameRate=r>>6,this.numTemporalLayers=(13&r)>>3,this.temporalIdNested=(4&r)>>2,this.lengthSizeMinusOne=3&r,this.nalu_arrays=[];var a=e.readUint8();for(t=0;t<a;t++){var s=[];this.nalu_arrays.push(s),r=e.readUint8(),s.completeness=(128&r)>>7,s.nalu_type=63&r;var o=e.readUint16();for(i=0;i<o;i++){var l={};s.push(l),n=e.readUint16(),l.data=e.readUint8Array(n)}}},c.TrackReferenceTypeBox=function(e,t,i,n){c.Box.call(this,e,t),this.hdr_size=i,this.start=n},c.TrackReferenceTypeBox.prototype=new c.Box,c.TrackReferenceTypeBox.prototype.parse=function(e){this.track_ids=e.readUint32Array((this.size-this.hdr_size)/4)},c.hdlrBox.prototype.parse=function(e){this.parseFullHeader(e),0===this.version?(e.readUint32(),this.handler=e.readString(4),e.readUint32Array(3),this.name=e.readString(this.size-this.hdr_size-20),"\0"===this.name[this.name.length-1]&&(this.name=this.name.slice(0,-1))):this.data=e.readUint8Array(this.size-this.hdr_size)},c.stz2Box.prototype.parse=function(e){var t,i;if(this.parseFullHeader(e),this.sample_sizes=[],0===this.version)if(this.reserved=e.readUint24(),this.field_size=e.readUint8(),i=e.readUint32(),4===this.field_size)for(t=0;t<i;t+=2){var n=e.readUint8();this.sample_sizes[t]=n>>4&15,this.sample_sizes[t+1]=15&n}else if(8===this.field_size)for(t=0;t<i;t++)this.sample_sizes[t]=e.readUint8();else if(16===this.field_size)for(t=0;t<i;t++)this.sample_sizes[t]=e.readUint16();else d.error("BoxParser","Error in length field in stz2 box");else this.data=e.readUint8Array(this.size-this.hdr_size)},c.mehdBox.prototype.parse=function(e){this.parseFullHeader(e),1==this.version?this.fragment_duration=e.readUint64():this.fragment_duration=e.readUint32()},c.stcoBox.prototype.parse=function(e){var t;this.parseFullHeader(e),t=e.readUint32(),0===this.version?this.chunk_offsets=e.readUint32Array(t):this.data=e.readUint8Array(this.size-this.hdr_size-4)},c.tpayBox.prototype.parse=function(e){this.bytessent=e.readUint32()},c.drepBox.prototype.parse=function(e){this.bytessent=e.readUint64()},c.trunBox.prototype.parse=function(e){var t=0;if(this.parseFullHeader(e),this.sample_count=e.readUint32(),t+=4,this.size-this.hdr_size>t&&this.flags&c.TRUN_FLAGS_DATA_OFFSET?(this.data_offset=e.readInt32(),t+=4):this.data_offset=0,this.size-this.hdr_size>t&&this.flags&c.TRUN_FLAGS_FIRST_FLAG?(this.first_sample_flags=e.readUint32(),t+=4):this.first_sample_flags=0,this.sample_duration=[],this.sample_size=[],this.sample_flags=[],this.sample_composition_time_offset=[],this.size-this.hdr_size>t)for(var i=0;i<this.sample_count;i++)this.flags&c.TRUN_FLAGS_DURATION&&(this.sample_duration[i]=e.readUint32()),this.flags&c.TRUN_FLAGS_SIZE&&(this.sample_size[i]=e.readUint32()),this.flags&c.TRUN_FLAGS_FLAGS&&(this.sample_flags[i]=e.readUint32()),this.flags&c.TRUN_FLAGS_CTS_OFFSET&&(0===this.version?this.sample_composition_time_offset[i]=e.readUint32():this.sample_composition_time_offset[i]=e.readInt32())},c.mvhdBox.prototype.parse=function(e){this.flags=0,this.parseFullHeader(e),1==this.version?(this.creation_time=e.readUint64(),this.modification_time=e.readUint64(),this.timescale=e.readUint32(),this.duration=e.readUint64()):(this.creation_time=e.readUint32(),this.modification_time=e.readUint32(),this.timescale=e.readUint32(),this.duration=e.readUint32()),this.rate=e.readUint32(),this.volume=e.readUint16()>>8,e.readUint16(),e.readUint32Array(2),this.matrix=e.readUint32Array(9),e.readUint32Array(6),this.next_track_id=e.readUint32()},c.psshBox.prototype.parse=function(e){if(this.parseFullHeader(e),this.system_id=e.readUint8Array(16),this.version>0){var t=e.readUint32();this.kid=[];for(var i=0;i<t;i++)this.kid[i]=e.readUint8Array(16)}var n=e.readUint32();n>0&&(this.data=e.readUint8Array(n))},c.stypBox.prototype.parse=function(e){c.ftypBox.prototype.parse.call(this,e)},c.tpylBox.prototype.parse=function(e){this.bytessent=e.readUint64()},c.ftypBox.prototype.parse=function(e){var t=this.size-this.hdr_size;this.major_brand=e.readString(4),this.minor_version=e.readUint32(),t-=8,this.compatible_brands=[];for(var i=0;t>=4;)this.compatible_brands[i]=e.readString(4),t-=4,i++},c.metaBox.prototype.parse=function(e){this.parseFullHeader(e),this.boxes=[],c.ContainerBox.prototype.parse.call(this,e)},c.pmaxBox.prototype.parse=function(e){this.bytes=e.readUint32()},c.btrtBox.prototype.parse=function(e){this.bufferSizeDB=e.readUint32(),this.maxBitrate=e.readUint32(),this.avgBitrate=e.readUint32()},c.ilocBox.prototype.parse=function(e){var t;this.parseFullHeader(e),t=e.readUint8(),this.offset_size=t>>4&15,this.length_size=15&t,t=e.readUint8(),this.base_offset_size=t>>4&15,1===this.version||2===this.version?this.index_size=15&t:this.index_size=0,this.items=[];var i=0;if(this.version<2)i=e.readUint16();else{if(2!==this.version)throw"version of iloc box not supported";i=e.readUint32()}for(var n=0;n<i;n++){var r={};if(this.items.push(r),this.version<2)r.item_ID=e.readUint16();else{if(2!==this.version)throw"version of iloc box not supported";r.item_ID=e.readUint16()}switch(1!==this.version&&2!==this.version||(r.construction_method=15&e.readUint16()),r.data_reference_index=e.readUint16(),this.base_offset_size){case 0:r.base_offset=0;break;case 4:r.base_offset=e.readUint32();break;case 8:r.base_offset=e.readUint64();break;default:throw"Error reading base offset size"}var a=e.readUint16();r.extents=[];for(var s=0;s<a;s++){var o={};if(r.extents.push(o),1===this.version||2===this.version)switch(this.index_size){case 0:o.extent_index=0;break;case 4:o.extent_index=e.readUint32();break;case 8:o.extent_index=e.readUint64();break;default:throw"Error reading extent index"}switch(this.offset_size){case 0:o.extent_offset=0;break;case 4:o.extent_offset=e.readUint32();break;case 8:o.extent_offset=e.readUint64();break;default:throw"Error reading extent index"}switch(this.length_size){case 0:o.extent_length=0;break;case 4:o.extent_length=e.readUint32();break;case 8:o.extent_length=e.readUint64();break;default:throw"Error reading extent index"}}}},c["urn Box"].prototype.parse=function(e){this.parseFullHeader(e),this.name=e.readCString(),this.size-this.hdr_size-this.name.length-1>0&&(this.location=e.readCString())},c.pitmBox.prototype.parse=function(e){this.parseFullHeader(e),0===this.version?this.item_id=e.readUint16():this.item_id=e.readUint32()},c.vmhdBox.prototype.parse=function(e){this.parseFullHeader(e),this.graphicsmode=e.readUint16(),this.opcolor=e.readUint16Array(3)},c.sdtpBox.prototype.parse=function(e){var t;this.parseFullHeader(e);var i=this.size-this.hdr_size;this.is_leading=[],this.sample_depends_on=[],this.sample_is_depended_on=[],this.sample_has_redundancy=[];for(var n=0;n<i;n++)t=e.readUint8(),this.is_leading[n]=t>>6,this.sample_depends_on[n]=t>>4&3,this.sample_is_depended_on[n]=t>>2&3,this.sample_has_redundancy[n]=3&t},c["sdp Box"].prototype.parse=function(e){this.sdptext=e.readString(this.size-this.hdr_size)},c.sgpdBox.prototype.parse=function(e){this.parseFullHeader(e),this.grouping_type=e.readString(4),d.debug("BoxParser","Found Sample Groups of type "+this.grouping_type),1===this.version?this.default_length=e.readUint32():this.default_length=0,this.version>=2&&(this.default_group_description_index=e.readUint32()),this.entries=[];for(var t=e.readUint32(),i=0;i<t;i++){var n;n=c[this.grouping_type+"SampleGroupEntry"]?new c[this.grouping_type+"SampleGroupEntry"](this.grouping_type):new c.SampleGroupEntry(this.grouping_type),this.entries.push(n),1===this.version&&0===this.default_length?n.description_length=e.readUint32():n.description_length=this.default_length,n.write===c.SampleGroupEntry.prototype.write&&(d.warn("BoxParser"," SampleEntry for type "+this.grouping_type+" writing not yet implemented, keeping unparsed data in memory for later write"),n.data=e.readUint8Array(n.description_length),e.position-=n.description_length),n.parse(e)}},c.levaBox.prototype.parse=function(e){this.parseFullHeader(e);var t=e.readUint8();this.levels=[];for(var i=0;i<t;i++){var n={};this.levels[i]=n,n.track_ID=e.readUint32();var r=e.readUint8();switch(n.padding_flag=r>>7,n.assignment_type=127&r,n.assignment_type){case 0:n.grouping_type=e.readUint32();break;case 1:n.grouping_type=e.readUint32(),n.grouping_type_parameter=e.readUint32();break;case 2:case 3:break;case 4:n.sub_track_id=e.readUint32();break;default:d.warn("BoxParser","Unknown leva assignement type")}}},c.tfraBox.prototype.parse=function(e){this.parseFullHeader(e),this.track_ID=e.readUint32(),e.readUint24();var t=e.readUint8();this.length_size_of_traf_num=t>>4&3,this.length_size_of_trun_num=t>>2&3,this.length_size_of_sample_num=3&t,this.entries=[];for(var i=e.readUint32(),n=0;n<i;n++)1===this.version?(this.time=e.readUint64(),this.moof_offset=e.readUint64()):(this.time=e.readUint32(),this.moof_offset=e.readUint32()),this.traf_number=e["readUint"+8*(this.length_size_of_traf_num+1)](),this.trun_number=e["readUint"+8*(this.length_size_of_trun_num+1)](),this.sample_number=e["readUint"+8*(this.length_size_of_sample_num+1)]()},c.paytBox.prototype.parse=function(e){this.payloadID=e.readUint32();var t=e.readUint8();this.rtpmap_string=e.readString(t)},c.sttsBox.prototype.parse=function(e){var t,i,n;if(this.parseFullHeader(e),t=e.readUint32(),this.sample_counts=[],this.sample_deltas=[],0===this.version)for(i=0;i<t;i++)this.sample_counts.push(e.readUint32()),(n=e.readInt32())<0&&(d.warn("BoxParser","File uses negative stts sample delta, using value 1 instead, sync may be lost!"),n=1),this.sample_deltas.push(n);else this.data=e.readUint8Array(this.size-this.hdr_size-4)},c.npckBox.prototype.parse=function(e){this.packetssent=e.readUint32()},c.subsBox.prototype.parse=function(e){var t,i,n,r;for(this.parseFullHeader(e),n=e.readUint32(),this.samples=[],t=0;t<n;t++){var a={};if(this.samples[t]=a,a.sample_delta=e.readUint32(),a.subsamples=[],(r=e.readUint16())>0)for(i=0;i<r;i++){var s={};a.subsamples.push(s),1==this.version?s.size=e.readUint32():s.size=e.readUint16(),s.priority=e.readUint8(),s.discardable=e.readUint8(),s.reserved=e.readUint32()}}},c.paylBox.prototype.parse=function(e){this.text=e.readString(this.size-this.hdr_size)},c.tfdtBox.prototype.parse=function(e){this.parseFullHeader(e),1==this.version?this.baseMediaDecodeTime=e.readUint64():this.baseMediaDecodeTime=e.readUint32()},c.pdinBox.prototype.parse=function(e){this.parseFullHeader(e);var t=(this.size-this.hdr_size)/8;this.rate=[],this.initial_delay=[];for(var i=0;i<t;i++)this.rate[i]=e.readUint32(),this.initial_delay[i]=e.readUint32()},c.mfroBox.prototype.parse=function(e){this.parseFullHeader(e),this.size=e.readUint32()},c.dmaxBox.prototype.parse=function(e){this.time=e.readUint32()},c.vttCBox.prototype.parse=function(e){this.text=e.readString(this.size-this.hdr_size)},c.cprtBox.prototype.parse=function(e){this.parseFullHeader(e),this.parseLanguage(e),this.notice=e.readCString(),e.getPosition()>this.start+this.size&&(d.warn("BoxParser","Parsed more than the size of the box (null-terminated string problem?)"),e.seek(this.start+this.size))},c.elngBox.prototype.parse=function(e){this.parseFullHeader(e),this.extended_language=e.readString(this.size-this.hdr_size)},c.SampleEntry.prototype.parseHeader=function(e){e.readUint8Array(6),this.data_reference_index=e.readUint16(),this.hdr_size+=8},c.SampleEntry.prototype.parse=function(e){this.parseHeader(e),this.data=e.readUint8Array(this.size-this.hdr_size)},c.SampleEntry.prototype.parseDataAndRewind=function(e){this.parseHeader(e),this.data=e.readUint8Array(this.size-this.hdr_size),this.hdr_size-=8,e.position-=this.size-this.hdr_size},c.SampleEntry.prototype.parseFooter=function(e){for(var t;e.getPosition()<this.start+this.size;)t=c.parseOneBox(e,!1).box,this.boxes.push(t),this[t.type]=t},c.VisualSampleEntry.prototype.parse=function(e){this.parseHeader(e),e.readUint16(),e.readUint16(),e.readUint32Array(3),this.width=e.readUint16(),this.height=e.readUint16(),this.horizresolution=e.readUint32(),this.vertresolution=e.readUint32(),e.readUint32(),this.frame_count=e.readUint16(),this.compressorname=e.readString(32),this.depth=e.readUint16(),e.readUint16(),this.parseFooter(e)},c.AudioSampleEntry.prototype.parse=function(e){this.parseHeader(e),e.readUint32Array(2),this.channel_count=e.readUint16(),this.samplesize=e.readUint16(),e.readUint16(),e.readUint16(),this.samplerate=e.readUint32()/65536,this.parseFooter(e)},c.stppSampleEntry.prototype.parse=function(e){this.parseHeader(e),this.namespace=e.readCString(),this.schema_location=e.readCString(),this.auxiliary_mime_types=e.readCString(),this.parseFooter(e)},c.metxSampleEntry.prototype.parse=function(e){this.parseHeader(e),this.content_encoding=e.readCString(),this.namespace=e.readCString(),this.schema_location=e.readCString(),this.parseFooter(e)},c.tx3gSampleEntry.prototype.parse=function(e){this.parseHeader(e),this.displayFlags=e.readUint32(),this.horizontal_justification=e.readInt8(),this.vertical_justification=e.readInt8(),this.bg_color_rgba=e.readUint8Array(4),this.box_record=e.readInt16Array(4),this.style_record=e.readUint8Array(12),this.parseFooter(e)},c.stxtSampleEntry.prototype.parse=function(e){this.parseHeader(e),this.content_encoding=e.readCString(),this.mime_format=e.readCString(),this.parseFooter(e)},c.sbttSampleEntry.prototype.parse=function(e){this.parseHeader(e),this.content_encoding=e.readCString(),this.mime_format=e.readCString(),this.parseFooter(e)},c.mettSampleEntry.prototype.parse=function(e){this.parseHeader(e),this.content_encoding=e.readCString(),this.mime_format=e.readCString(),this.parseFooter(e)},c.TrackGroupTypeBox.prototype.parse=function(e){this.parseFullHeader(e),this.track_group_id=e.readUint32()},c.mdhdBox.prototype.parse=function(e){this.parseFullHeader(e),1==this.version?(this.creation_time=e.readUint64(),this.modification_time=e.readUint64(),this.timescale=e.readUint32(),this.duration=e.readUint64()):(this.creation_time=e.readUint32(),this.modification_time=e.readUint32(),this.timescale=e.readUint32(),this.duration=e.readUint32()),this.parseLanguage(e),e.readUint16()},c.stviBox.prototype.parse=function(e){this.parseFullHeader(e);var t=e.readUint32();this.single_view_allowed=3&t,this.stereo_scheme=e.readUint32();var i,n=e.readUint32();for(this.stereo_indication_type=e.readString(n),this.boxes=[];e.getPosition()<this.start+this.size;)i=c.parseOneBox(e,!1).box,this.boxes.push(i),this[i.type]=i},c.irefBox=function(e){c.FullBox.call(this,"iref",e),this.references=[]},c.irefBox.prototype=new c.FullBox,c.irefBox.prototype.parse=function(e){var t,i;for(this.parseFullHeader(e);e.getPosition()<this.start+this.size;)t=c.parseOneBox(e,!0),(i=0===this.version?new c.SingleItemTypeReferenceBox(t.type,t.size,t.hdr_size,t.start):new c.SingleItemTypeReferenceBoxLarge(t.type,t.size,t.hdr_size,t.start)).write===c.Box.prototype.write&&"mdat"!==i.type&&(d.warn("BoxParser",i.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),i.parseDataAndRewind(e)),i.parse(e),this.references.push(i)},c.iinfBox.prototype.parse=function(e){var t;this.parseFullHeader(e),0===this.version?this.entry_count=e.readUint16():this.entry_count=e.readUint32(),this.item_infos=[];for(var i=0;i<this.entry_count;i++)"infe"!==(t=c.parseOneBox(e,!1)).box.type&&d.error("BoxParser","Expected 'infe' box, got "+t.box.type),this.item_infos[i]=t.box},c.stszBox.prototype.parse=function(e){var t;if(this.parseFullHeader(e),this.sample_sizes=[],0===this.version)if(this.sample_size=e.readUint32(),this.sample_count=e.readUint32(),0===this.sample_size)this.sample_sizes=e.readUint32Array(this.sample_count);else for(t=0;t<this.sample_count;t++)this.sample_sizes[t]=this.sample_size;else this.data=e.readUint8Array(this.size-this.hdr_size)},c.stsdBox=function(e){c.FullBox.call(this,"stsd",e),this.entries=[]},c.stsdBox.prototype=new c.FullBox,c.stsdBox.prototype.parse=function(e){var t,i,n,r;for(this.parseFullHeader(e),n=e.readUint32(),t=1;t<=n;t++)i=c.parseOneBox(e,!0),c[i.type+"SampleEntry"]?((r=new c[i.type+"SampleEntry"](i.size)).hdr_size=i.hdr_size,r.start=i.start):(d.warn("BoxParser","Unknown sample entry type: "+i.type),r=new c.SampleEntry(i.type,i.size,i.hdr_size,i.start)),r.write===c.SampleEntry.prototype.write&&(d.warn("BoxParser",r.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),r.parseDataAndRewind(e)),r.parse(e),this.entries.push(r)},c.saizBox.prototype.parse=function(e){this.parseFullHeader(e),1&this.flags&&(this.aux_info_type=e.readUint32(),this.aux_info_type_parameter=e.readUint32()),this.default_sample_info_size=e.readUint8();var t=e.readUint32();if(this.sample_info_size=[],0===this.default_sample_info_size)for(var i=0;i<t;i++)this.sample_info_size[i]=e.readUint32()},c.padbBox.prototype.parse=function(e){this.parseFullHeader(e);var t=e.readUint32();this.padbits=[];for(var i=0;i<Math.floor((t+1)/2);i++)this.padbits=e.readUint8()},c.tx3gSampleEntry.prototype.parse=function(e){this.parseHeader(e),this.displayFlags=e.readUint32(),this.horizontal_justification=e.readInt8(),this.vertical_justification=e.readInt8(),this.bg_color_rgba=e.readUint8Array(4),this.box_record=e.readInt16Array(4),this.style_record=e.readUint8Array(12),this.parseFooter(e)},c.cslgBox.prototype.parse=function(e){this.parseFullHeader(e),0===this.version?(this.compositionToDTSShift=e.readInt32(),this.leastDecodeToDisplayDelta=e.readInt32(),this.greatestDecodeToDisplayDelta=e.readInt32(),this.compositionStartTime=e.readInt32(),this.compositionEndTime=e.readInt32()):this.data=e.readUint8Array(this.size-this.hdr_size-4)},c.kindBox=function(e){c.FullBox.call(this,"kind",e),this.schemeURI="",this.value=""},c.kindBox.prototype=new c.FullBox,c.kindBox.prototype.parse=function(e){this.parseFullHeader(e),this.schemeURI=e.readCString(),this.value=e.readCString()},c.mfhdBox.prototype.parse=function(e){this.parseFullHeader(e),this.sequence_number=e.readUint32()},c.stshBox.prototype.parse=function(e){var t,i;if(this.parseFullHeader(e),t=e.readUint32(),this.shadowed_sample_numbers=[],this.sync_sample_numbers=[],0===this.version)for(i=0;i<t;i++)this.shadowed_sample_numbers.push(e.readUint32()),this.sync_sample_numbers.push(e.readUint32());else this.data=e.readUint8Array(this.size-this.hdr_size-4)},c.prftBox.prototype.parse=function(e){this.parseFullHeader(e),this.ref_track_id=e.readUint32(),this.ntp_timestamp=e.readUint64(),0===this.version?this.media_time=e.readUint32():this.media_time=e.readUint64()},c.SingleItemTypeReferenceBox=function(e,t,i,n){c.Box.call(this,e,t),this.hdr_size=i,this.start=n},c.SingleItemTypeReferenceBox.prototype=new c.Box,c.SingleItemTypeReferenceBox.prototype.parse=function(e){this.from_item_ID=e.readUint16();var t=e.readUint16();this.references=[];for(var i=0;i<t;i++)this.references[i]=e.readUint16()},c["rtp Box"].prototype.parse=function(e){this.descriptionformat=e.readString(4),this.sdptext=e.readString(this.size-this.hdr_size-4)},c.numpBox.prototype.parse=function(e){this.packetssent=e.readUint64()},c.ssixBox.prototype.parse=function(e){this.parseFullHeader(e),this.subsegments=[];for(var t=e.readUint32(),i=0;i<t;i++){var n={};this.subsegments.push(n),n.ranges=[];for(var r=e.readUint32(),a=0;a<r;a++){var s={};n.ranges.push(s),s.level=e.readUint8(),s.range_size=e.readUint24()}}},c.dmedBox.prototype.parse=function(e){this.bytessent=e.readUint64()},c.SingleItemTypeReferenceBoxLarge=function(e,t,i,n){c.Box.call(this,e,t),this.hdr_size=i,this.start=n},c.SingleItemTypeReferenceBoxLarge.prototype=new c.Box,c.SingleItemTypeReferenceBoxLarge.prototype.parse=function(e){this.from_item_ID=e.readUint32();var t=e.readUint16();this.references=[];for(var i=0;i<t;i++)this.references[i]=e.readUint32()},c.frmaBox.prototype.parse=function(e){this.data_format=e.readString(4)},c.sidxBox.prototype.parse=function(e){this.parseFullHeader(e),this.reference_ID=e.readUint32(),this.timescale=e.readUint32(),0===this.version?(this.earliest_presentation_time=e.readUint32(),this.first_offset=e.readUint32()):(this.earliest_presentation_time=e.readUint64(),this.first_offset=e.readUint64()),e.readUint16(),this.references=[];for(var t=e.readUint16(),i=0;i<t;i++){var n={};this.references.push(n);var r=e.readUint32();n.reference_type=r>>31&1,n.referenced_size=2147483647&r,n.subsegment_duration=e.readUint32(),r=e.readUint32(),n.starts_with_SAP=r>>31&1,n.SAP_type=r>>28&7,n.SAP_delta_time=268435455&r}},c.totlBox.prototype.parse=function(e){this.bytessent=e.readUint32()},c.elstBox.prototype.parse=function(e){this.parseFullHeader(e),this.entries=[];for(var t=e.readUint32(),i=0;i<t;i++){var n={};this.entries.push(n),1===this.version?(n.segment_duration=e.readUint64(),n.media_time=e.readInt64()):(n.segment_duration=e.readUint32(),n.media_time=e.readInt32()),n.media_rate_integer=e.readInt16(),n.media_rate_fraction=e.readInt16()}},c.tmaxBox.prototype.parse=function(e){this.time=e.readUint32()},c.stdpBox.prototype.parse=function(e){this.parseFullHeader(e);var t=(this.size-this.hdr_size)/2;this.priority=[];for(var i=0;i<t;i++)this.priority[i]=e.readUint16()},c.maxrBox.prototype.parse=function(e){this.period=e.readUint32(),this.bytes=e.readUint32()},c.esdsBox.prototype.parse=function(e){this.parseFullHeader(e);var t=e.readUint8Array(this.size-this.hdr_size);if(void 0!==f){var i=new f;this.esd=i.parseOneDescriptor(new a.DataStream(t.buffer,0,a.DataStream.BIG_ENDIAN))}},c.cttsBox.prototype.parse=function(e){var t,i;if(this.parseFullHeader(e),t=e.readUint32(),this.sample_counts=[],this.sample_offsets=[],0===this.version)for(i=0;i<t;i++)this.sample_counts.push(e.readUint32()),this.sample_offsets.push(e.readInt32());else if(1==this.version)for(i=0;i<t;i++)this.sample_counts.push(e.readUint32()),this.sample_offsets.push(e.readInt32());else this.data=e.readUint8Array(this.size-this.hdr_size-4)},c.sbgpBox.prototype.parse=function(e){this.parseFullHeader(e),this.grouping_type=e.readString(4),1===this.version?this.grouping_type_parameter=e.readUint32():this.grouping_type_parameter=0,this.entries=[];for(var t=e.readUint32(),i=0;i<t;i++){var n={};this.entries.push(n),n.sample_count=e.readInt32(),n.group_description_index=e.readInt32()}},c.trefBox.prototype.parse=function(e){for(var t,i;e.getPosition()<this.start+this.size;)t=c.parseOneBox(e,!0),(i=new c.TrackReferenceTypeBox(t.type,t.size,t.hdr_size,t.start)).write===c.Box.prototype.write&&"mdat"!==i.type&&(d.warn("BoxParser",i.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),i.parseDataAndRewind(e)),i.parse(e),this.boxes.push(i)},c.tminBox.prototype.parse=function(e){this.time=e.readUint32()},c.trexBox.prototype.parse=function(e){this.parseFullHeader(e),this.track_id=e.readUint32(),this.default_sample_description_index=e.readUint32(),this.default_sample_duration=e.readUint32(),this.default_sample_size=e.readUint32(),this.default_sample_flags=e.readUint32()},c.trpyBox.prototype.parse=function(e){this.bytessent=e.readUint64()},c.co64Box.prototype.parse=function(e){var t,i;if(this.parseFullHeader(e),t=e.readUint32(),this.chunk_offsets=[],0===this.version)for(i=0;i<t;i++)this.chunk_offsets.push(e.readUint64());else this.data=e.readUint8Array(this.size-this.hdr_size-4)},c.stssBox.prototype.parse=function(e){var t,i;if(this.parseFullHeader(e),i=e.readUint32(),0===this.version)for(this.sample_numbers=[],t=0;t<i;t++)this.sample_numbers.push(e.readUint32());else this.data=e.readUint8Array(this.size-this.hdr_size-4)},c.stxtSampleEntry.prototype.parse=function(e){this.parseHeader(e),this.content_encoding=e.readCString(),this.mime_format=e.readCString(),this.parseFooter(e)},c["url Box"].prototype.parse=function(e){this.parseFullHeader(e),1!==this.flags?this.location=e.readCString():this.size-this.hdr_size&&(d.warn("BoxParser","Invalid urlBox - contains data but flag not set"),this.location=e.readString(this.size-this.hdr_size))},c.trepBox.prototype.parse=function(e){var t;for(this.parseFullHeader(e),this.track_ID=e.readUint32(),this.boxes=[];e.getPosition()<this.start+this.size;)t=c.parseOneBox(e,!1).box,this.boxes.push(t)},c.tkhdBox.prototype.parse=function(e){this.parseFullHeader(e),1==this.version?(this.creation_time=e.readUint64(),this.modification_time=e.readUint64(),this.track_id=e.readUint32(),e.readUint32(),this.duration=e.readUint64()):(this.creation_time=e.readUint32(),this.modification_time=e.readUint32(),this.track_id=e.readUint32(),e.readUint32(),this.duration=e.readUint32()),e.readUint32Array(2),this.layer=e.readInt16(),this.alternate_group=e.readInt16(),this.volume=e.readInt16()>>8,e.readUint16(),this.matrix=e.readInt32Array(9),this.width=e.readUint32(),this.height=e.readUint32()},c.txtCBox.prototype.parse=function(e){this.parseFullHeader(e),this.config=e.readCString()},c.stsgBox.prototype.parse=function(e){this.parseFullHeader(e),this.grouping_type=e.readUint32();var t=e.readUint16();this.group_description_index=[];for(var i=0;i<t;i++)this.group_description_index[i]=e.readUint32()},c.saioBox.prototype.parse=function(e){this.parseFullHeader(e),1&this.flags&&(this.aux_info_type=e.readUint32(),this.aux_info_type_parameter=e.readUint32());var t=e.readUint32();this.offset=[];for(var i=0;i<t;i++)0===this.version?this.offset[i]=e.readUint32():this.offset[i]=e.readUint64()},c.tselBox.prototype.parse=function(e){this.parseFullHeader(e),this.switch_group=e.readUint32();var t=(this.size-this.hdr_size-4)/4;this.attribute_list=[];for(var i=0;i<t;i++)this.attribute_list[i]=e.readUint32()},c.emsgBox.prototype.parse=function(e){this.parseFullHeader(e),this.scheme_id_uri=e.readCString(),this.value=e.readCString(),this.timescale=e.readUint32(),this.presentation_time_delta=e.readUint32(),this.event_duration=e.readUint32(),this.id=e.readUint32();var t=this.size-this.hdr_size-(16+(this.scheme_id_uri.length+1)+(this.value.length+1));this.message_data=e.readUint8Array(t)};var p=function(e){this.stream=e,this.boxes=[],this.mdats=[],this.moofs=[],this.isProgressive=!1,this.moovStartFound=!1};p.prototype.parse=function(){var e,t;if(!this.restoreParsePosition||this.restoreParsePosition())for(;;){if(this.hasIncompleteMdat&&this.hasIncompleteMdat()){if(this.processIncompleteMdat())continue;return}if(this.saveParsePosition&&this.saveParsePosition(),(e=c.parseOneBox(this.stream,!1)).code===c.ERR_NOT_ENOUGH_DATA){if(this.processIncompleteBox){if(this.processIncompleteBox(e))continue;return}return}switch(t=e.box,this.boxes.push(t),t.type){case"mdat":this.mdats.push(t);break;case"moof":this.moofs.push(t);break;case"moov":this.moovStartFound=!0,0===this.mdats.length&&(this.isProgressive=!0);default:void 0!==this[t.type]&&d.warn("ISOFile","Duplicate Box of type: "+t.type+", overriding previous occurrence"),this[t.type]=t}this.updateUsedBytes&&this.updateUsedBytes(t,e)}},p.prototype.getBox=function(e){var t=this.getBoxes(e,!0);return t.length?t[0]:null},p.prototype.getBoxes=function(e,t){var i=[];return p._sweep.call(this,e,i,t),i},p._sweep=function(e,t,i){for(var n in this.type&&this.type==e&&t.push(this),this.boxes){if(t.length&&i)return;p._sweep.call(this.boxes[n],e,t,i)}},p.prototype.lastBoxStartPosition=0,p.prototype.parsingMdat=null,p.prototype.nextParsePosition=0,p.prototype.discardMdatData=!1,p.prototype.processIncompleteBox=function(e){var t;return"mdat"===e.type?(t=new c[e.type+"Box"](e.size),this.parsingMdat=t,this.boxes.push(t),this.mdats.push(t),t.start=e.start,t.hdr_size=e.hdr_size,this.stream.addUsedBytes(t.hdr_size),this.lastBoxStartPosition=t.start+t.size,this.stream.seek(t.start+t.size,!1,this.discardMdatData)?(this.parsingMdat=null,!0):(this.moovStartFound?this.nextParsePosition=this.stream.findEndContiguousBuf():this.nextParsePosition=t.start+t.size,!1)):("moov"===e.type&&(this.moovStartFound=!0,0===this.mdats.length&&(this.isProgressive=!0)),this.stream.mergeNextBuffer()?(this.nextParsePosition=this.stream.getEndPosition(),!0):(e.type?this.moovStartFound?this.nextParsePosition=this.stream.getEndPosition():this.nextParsePosition=this.stream.getPosition()+e.size:this.nextParsePosition=this.stream.getEndPosition(),!1))},p.prototype.hasIncompleteMdat=function(){return null!==this.parsingMdat},p.prototype.processIncompleteMdat=function(){var e;return e=this.parsingMdat,this.stream.seek(e.start+e.size,!1,this.discardMdatData)?(d.debug("ISOFile","Found 'mdat' end in buffered data"),this.parsingMdat=null,!0):(this.nextParsePosition=this.stream.findEndContiguousBuf(),!1)},p.prototype.restoreParsePosition=function(){return this.stream.seek(this.lastBoxStartPosition,!0,this.discardMdatData)},p.prototype.saveParsePosition=function(){this.lastBoxStartPosition=this.stream.getPosition()},p.prototype.updateUsedBytes=function(e,t){"mdat"===e.type?(this.stream.addUsedBytes(e.hdr_size),this.discardMdatData&&this.stream.addUsedBytes(e.size-e.hdr_size)):this.stream.addUsedBytes(e.size)},c.Box.prototype.writeHeader=function(e,t){this.size+=8,this.size>a.MAX_SIZE&&(this.size+=8),"uuid"===this.type&&(this.size+=16),d.debug("BoxWriter","Writing box "+this.type+" of size: "+this.size+" at position "+e.getPosition()+(t||"")),this.size>a.MAX_SIZE?e.writeUint32(1):(this.sizePosition=e.getPosition(),e.writeUint32(this.size)),e.writeString(this.type,null,4),"uuid"===this.type&&e.writeUint8Array(this.uuid),this.size>a.MAX_SIZE&&e.writeUint64(this.size)},c.FullBox.prototype.writeHeader=function(e){this.size+=4,c.Box.prototype.writeHeader.call(this,e," v="+this.version+" f="+this.flags),e.writeUint8(this.version),e.writeUint24(this.flags)},c.Box.prototype.write=function(e){"mdat"===this.type?this.data&&(this.size=this.data.length,this.writeHeader(e),e.writeUint8Array(this.data)):(this.size=this.data.length,this.writeHeader(e),e.writeUint8Array(this.data))},c.ContainerBox.prototype.write=function(e){this.size=0,this.writeHeader(e);for(var t=0;t<this.boxes.length;t++)this.boxes[t]&&(this.boxes[t].write(e),this.size+=this.boxes[t].size);d.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),e.adjustUint32(this.sizePosition,this.size)},c.TrackReferenceTypeBox.prototype.write=function(e){this.size=4*this.track_ids.length,this.writeHeader(e),e.writeUint32Array(this.track_ids)},p.prototype.items=[],p.prototype.itemsDataSize=0,p.prototype.flattenItemInfo=function(){var e,t,i,n=this.items,r=this.meta;if(null!==r&&void 0!==r&&void 0!==r.hdlr&&void 0!==r.iinf){for(e=0;e<r.iinf.item_infos.length;e++)(i={}).id=r.iinf.item_infos[e].item_ID,n[i.id]=i,i.ref_to=[],i.name=r.iinf.item_infos[e].item_name,r.iinf.item_infos[e].protection_index>0&&(i.protection=r.ipro.protections[r.iinf.item_infos[e].protection_index-1]),r.iinf.item_infos[e].item_type?i.type=r.iinf.item_infos[e].item_type:i.type="mime",i.content_type=r.iinf.item_infos[e].content_type,i.content_encoding=r.iinf.item_infos[e].content_encoding;if(r.iloc)for(e=0;e<r.iloc.items.length;e++){var a=r.iloc.items[e];if(i=n[a.item_ID],0!==a.data_reference_index&&(d.warn("Item storage with reference to other files: not supported"),i.source=r.dinf.boxes[a.data_reference_index-1]),void 0!==a.construction_method)d.warn("Item storage with construction_method : not supported"),a.construction_method;else for(i.extents=[],i.size=0,t=0;t<a.extents.length;t++)i.extents[t]={},i.extents[t].offset=a.extents[t].extent_offset+a.base_offset,i.extents[t].length=a.extents[t].extent_length,i.extents[t].alreadyRead=0,i.size+=i.extents[t].length}if(r.pitm&&(n[r.pitm.item_id].primary=!0),r.iref)for(e=0;e<r.iref.references.length;e++){var s=r.iref.references[e];for(t=0;t<s.references.length;t++)n[s.from_item_ID].ref_to.push({type:s.type,id:s.references[t]})}}},p.prototype.getItem=function(e){var t,i;if(!this.meta)return null;if(!(i=this.items[e]).data&&i.size)i.data=new Uint8Array(i.size),i.alreadyRead=0,this.itemsDataSize+=i.size,d.debug("ISOFile","Allocating item #"+e+" of size "+i.size+" (total: "+this.itemsDataSize+")");else if(i.alreadyRead===i.size)return i;for(var n=0;n<i.extents.length;n++){var r=i.extents[n];if(r.alreadyRead!==r.length){var s=this.stream.findPosition(!0,r.offset+r.alreadyRead,!1);if(!(s>-1))return null;var o=(t=this.stream.buffers[s]).byteLength-(r.offset+r.alreadyRead-t.fileStart);if(!(r.length-r.alreadyRead<=o))return d.debug("ISOFile","Getting item #"+e+" extent #"+n+" partial data (alreadyRead: "+r.alreadyRead+" offset: "+(r.offset+r.alreadyRead-t.fileStart)+" read size: "+o+" full extent size: "+r.length+" full item size: "+i.size+")"),a.DataStream.memcpy(i.data.buffer,i.alreadyRead,t,r.offset+r.alreadyRead-t.fileStart,o),r.alreadyRead+=o,i.alreadyRead+=o,t.usedBytes+=o,this.stream.logBufferLevel(),null;d.debug("ISOFile","Getting item #"+e+" extent #"+n+" data (alreadyRead: "+r.alreadyRead+" offset: "+(r.offset+r.alreadyRead-t.fileStart)+" read size: "+(r.length-r.alreadyRead)+" full extent size: "+r.length+" full item size: "+i.size+")"),a.DataStream.memcpy(i.data.buffer,i.alreadyRead,t,r.offset+r.alreadyRead-t.fileStart,r.length-r.alreadyRead),t.usedBytes+=r.length-r.alreadyRead,this.stream.logBufferLevel(),r.alreadyRead=r.length,i.alreadyRead+=r.length}}return i.alreadyRead===i.size?i:null},p.prototype.releaseItem=function(e){var t=this.items[e];if(t.data){this.itemsDataSize-=t.size,t.data=null,t.alreadyRead=0;for(var i=0;i<t.extents.length;i++){t.extents[i].alreadyRead=0}return t.size}return 0},p.prototype.processItems=function(e){for(var t in this.items){var i=this.items[t];this.getItem(i.id),e&&!i.sent&&(e(i),i.sent=!0,i.data=null)}},p.prototype.hasItem=function(e){for(var t in this.items){var i=this.items[t];if(i.name===e)return i.id}return-1},p.prototype.getMetaHandler=function(){return this.meta?this.meta.hdlr.handler:null},p.prototype.getPrimaryItem=function(){return this.meta&&this.meta.pitm?this.getItem(this.meta.pitm.item_id):null},c.cttsBox.prototype.unpack=function(e){var t,i,n;for(n=0,t=0;t<this.sample_counts.length;t++)for(i=0;i<this.sample_counts[t];i++)e[n].pts=e[n].dts+this.sample_offsets[t],n++},c.sttsBox.prototype.unpack=function(e){var t,i,n;for(n=0,t=0;t<this.sample_counts.length;t++)for(i=0;i<this.sample_counts[t];i++)e[n].dts=0===n?0:e[n-1].dts+this.sample_deltas[t],n++},c.stcoBox.prototype.unpack=function(e){var t;for(t=0;t<this.chunk_offsets.length;t++)e[t].offset=this.chunk_offsets[t]},c.stscBox.prototype.unpack=function(e){var t,i,n,r,a;for(r=0,a=0,t=0;t<this.first_chunk.length;t++)for(i=0;i<(t+1<this.first_chunk.length?this.first_chunk[t+1]:1/0);i++)for(a++,n=0;n<this.samples_per_chunk[t];n++){if(!e[r])return;e[r].description_index=this.sample_description_index[t],e[r].chunk_index=a,r++}},c.stszBox.prototype.unpack=function(e){var t;for(t=0;t<this.sample_sizes.length;t++)e[t].size=this.sample_sizes[t]};var f=function(){var e=[];e[3]="ES_Descriptor",e[4]="DecoderConfigDescriptor",e[5]="DecoderSpecificInfo",e[6]="SLConfigDescriptor";var t=this,i={};return this.parseOneDescriptor=function(t){var n,r,a,s=0;for(n=t.readUint8(),0,a=t.readUint8(),0;128&a;)s=(127&a)<<7,a=t.readUint8(),0;return s+=127&a,d.debug("MPEG4DescriptorParser","Found "+(e[n]||"Descriptor "+n)+", size "+s+" at position "+t.getPosition()),(r=e[n]?new i[e[n]](s):new i.Descriptor(s)).parse(t),r},i.Descriptor=function(e,t){this.tag=e,this.size=t,this.descs=[]},i.Descriptor.prototype.parse=function(e){this.data=e.readUint8Array(this.size)},i.Descriptor.prototype.findDescriptor=function(e){for(var t=0;t<this.descs.length;t++)if(this.descs[t].tag==e)return this.descs[t];return null},i.Descriptor.prototype.parseRemainingDescriptors=function(e){for(var i=e.position;e.position<i+this.size;){var n=t.parseOneDescriptor(e);this.descs.push(n)}},i.ES_Descriptor=function(e){i.Descriptor.call(this,3,e)},i.ES_Descriptor.prototype=new i.Descriptor,i.ES_Descriptor.prototype.parse=function(e){if(this.ES_ID=e.readUint16(),this.flags=e.readUint8(),this.size-=3,128&this.flags?(this.dependsOn_ES_ID=e.readUint16(),this.size-=2):this.dependsOn_ES_ID=0,64&this.flags){var t=e.readUint8();this.URL=e.readString(t),this.size-=t+1}else this.URL=null;32&this.flags?(this.OCR_ES_ID=e.readUint16(),this.size-=2):this.OCR_ES_ID=0,this.parseRemainingDescriptors(e)},i.ES_Descriptor.prototype.getOTI=function(e){var t=this.findDescriptor(4);return t?t.oti:0},i.ES_Descriptor.prototype.getAudioConfig=function(e){var t=this.findDescriptor(4);if(!t)return null;var i=t.findDescriptor(5);return i&&i.data?(248&i.data[0])>>3:null},i.DecoderConfigDescriptor=function(e){i.Descriptor.call(this,4,e)},i.DecoderConfigDescriptor.prototype=new i.Descriptor,i.DecoderConfigDescriptor.prototype.parse=function(e){this.oti=e.readUint8(),this.streamType=e.readUint8(),this.bufferSize=e.readUint24(),this.maxBitrate=e.readUint32(),this.avgBitrate=e.readUint32(),this.size-=13,this.parseRemainingDescriptors(e)},i.DecoderSpecificInfo=function(e){i.Descriptor.call(this,5,e)},i.DecoderSpecificInfo.prototype=new i.Descriptor,i.SLConfigDescriptor=function(e){i.Descriptor.call(this,6,e)},i.SLConfigDescriptor.prototype=new i.Descriptor,this};p.prototype.lastMoofIndex=0,p.prototype.samplesDataSize=0,p.prototype.resetTables=function(){var e,t,i,n,r,a;for(this.initial_duration=this.moov.mvhd.duration,this.moov.mvhd.duration=0,e=0;e<this.moov.traks.length;e++){(t=this.moov.traks[e]).tkhd.duration=0,t.mdia.mdhd.duration=0,(t.mdia.minf.stbl.stco||t.mdia.minf.stbl.co64).chunk_offsets=[],(i=t.mdia.minf.stbl.stsc).first_chunk=[],i.samples_per_chunk=[],i.sample_description_index=[],(t.mdia.minf.stbl.stsz||t.mdia.minf.stbl.stz2).sample_sizes=[],(n=t.mdia.minf.stbl.stts).sample_counts=[],n.sample_deltas=[],(r=t.mdia.minf.stbl.ctts)&&(r.sample_counts=[],r.sample_offsets=[]),a=t.mdia.minf.stbl.stss;var s=t.mdia.minf.stbl.boxes.indexOf(a);-1!=s&&(t.mdia.minf.stbl.boxes[s]=null)}},p.prototype.buildSampleLists=function(e){var t,i,n,r,a,s,o,l,u,d,c,h,p,f,v,y,m,g,b,_,w,k,x,S=0;for(t=0;t<this.moov.traks.length;t++){for("vide"===(n=this.moov.traks[t]).mdia.hdlr.handler?n.is_video=!0:n.is_video=!1,n.samples=[],r=n.mdia.minf.stbl.stco||n.mdia.minf.stbl.co64,a=n.mdia.minf.stbl.stsc,s=n.mdia.minf.stbl.stsz||n.mdia.minf.stbl.stz2,o=n.mdia.minf.stbl.stts,l=n.mdia.minf.stbl.ctts,u=n.mdia.minf.stbl.stss,d=n.mdia.minf.stbl.stsd,c=n.mdia.minf.stbl.subs,m=-1,g=-1,b=-1,_=-1,w=0,k=0,x=0,i=0;i<s.sample_sizes.length;i++){var E={};E.number=i,E.track_id=n.tkhd.track_id,E.timescale=n.mdia.mdhd.timescale,E.alreadyRead=0,n.samples[i]=E,E.size=s.sample_sizes[i],0===i?(p=1,h=0,E.chunk_index=p,E.chunk_run_index=h,y=a.samples_per_chunk[h],v=0,f=h+1<a.first_chunk.length?a.first_chunk[h+1]-1:1/0):i<y?(E.chunk_index=p,E.chunk_run_index=h):(p++,E.chunk_index=p,v=0,p<=f||(f=++h+1<a.first_chunk.length?a.first_chunk[h+1]-1:1/0),E.chunk_run_index=h,y+=a.samples_per_chunk[h]),E.description_index=a.sample_description_index[E.chunk_run_index]-1,E.description=d.entries[E.description_index],E.offset=r.chunk_offsets[E.chunk_index-1]+v,v+=E.size,i>m&&(g++,m<0&&(m=0),m+=o.sample_counts[g]),i>0?(n.samples[i-1].duration=o.sample_deltas[g],E.dts=n.samples[i-1].dts+n.samples[i-1].duration):e.lastSamplesDtss[t]?E.dts=e.lastSamplesDtss[t]:(E.dts=0,e.lastSamplesDtss.push(0)),l?(i>=b&&(_++,b<0&&(b=0),b+=l.sample_counts[_]),E.cts=n.samples[i].dts+l.sample_offsets[_]):E.cts=E.dts,u?i==u.sample_numbers[w]-1?(E.is_rap=!0,w++):E.is_rap=!1:E.is_rap=!0,c&&c.samples[k].sample_delta+x==i&&(E.subsamples=c.samples[k].subsamples,x+=c.samples[k].sample_delta)}i>0&&(n.samples[i-1].duration=e.lastSamplesDtss[t]+n.mdia.mdhd.duration-n.samples[i-1].dts)}for(t=0;t<this.moov.traks.length;t++){n=this.moov.traks[t];var T=parseFloat(n.mdia.mdhd.duration+e.lastSamplesDtss[t]);(T/=n.mdia.mdhd.timescale)>S&&(S=T)}for(t=0;t<this.moov.traks.length;t++)n=this.moov.traks[t],e.lastSamplesDtss[t]=parseInt(S*n.mdia.mdhd.timescale)},p.prototype.updateSampleLists=function(){var e,t,i,n,r,a,s,o,l,u,d,h,p,f,v;if(void 0!==this.moov)for(;this.lastMoofIndex<this.moofs.length;)if(l=this.moofs[this.lastMoofIndex],this.lastMoofIndex++,"moof"==l.type)for(u=l,e=0;e<u.trafs.length;e++){for(d=u.trafs[e],h=this.getTrackById(d.tfhd.track_id),p=this.getTrexById(d.tfhd.track_id),n=d.tfhd.flags&c.TFHD_FLAG_SAMPLE_DESC?d.tfhd.default_sample_description_index:p?p.default_sample_description_index:1,r=d.tfhd.flags&c.TFHD_FLAG_SAMPLE_DUR?d.tfhd.default_sample_duration:p?p.default_sample_duration:0,a=d.tfhd.flags&c.TFHD_FLAG_SAMPLE_SIZE?d.tfhd.default_sample_size:p?p.default_sample_size:0,s=d.tfhd.flags&c.TFHD_FLAG_SAMPLE_FLAGS?d.tfhd.default_sample_flags:p?p.default_sample_flags:0,t=0;t<d.truns.length;t++){var y=d.truns[t];for(i=0;i<y.sample_count;i++){(f={}).number=h.samples.length,d.first_sample_index=h.samples.length,h.samples.push(f),f.track_id=h.tkhd.track_id,f.timescale=h.mdia.mdhd.timescale,f.description_index=n-1,f.description=h.mdia.minf.stbl.stsd.entries[f.description_index],f.size=a,y.flags&c.TRUN_FLAGS_SIZE&&(f.size=y.sample_size[i]),f.duration=r,y.flags&c.TRUN_FLAGS_DURATION&&(f.duration=y.sample_duration[i]),h.first_traf_merged||i>0?f.dts=h.samples[h.samples.length-2].dts+h.samples[h.samples.length-2].duration:(d.tfdt?f.dts=d.tfdt.baseMediaDecodeTime:f.dts=0,h.first_traf_merged=!0),f.cts=f.dts,y.flags&c.TRUN_FLAGS_CTS_OFFSET&&(f.cts=f.dts+y.sample_composition_time_offset[i]),v=s,y.flags&c.TRUN_FLAGS_FLAGS?v=y.sample_flags[i]:0===i&&y.flags&c.TRUN_FLAGS_FIRST_FLAG&&(v=y.first_sample_flags),f.is_rap=!(v>>16&1);var m=!!(d.tfhd.flags&c.TFHD_FLAG_BASE_DATA_OFFSET),g=!!(d.tfhd.flags&c.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),b=!!(y.flags&c.TRUN_FLAGS_DATA_OFFSET),_=0;_=m?d.tfhd.base_data_offset:g?u.start:0===t?u.start:o,f.offset=0===t&&0===i?b?_+y.data_offset:_:o,o=f.offset+f.size}}if(d.subs){var w=d.first_sample_index;for(t=0;t<d.subs.samples.length;t++)w+=d.subs.samples[t].sample_delta,(f=h.samples[w-1]).subsamples=d.subs.samples[t].subsamples}}},p.prototype.getSample=function(e,t){var i,n=e.samples[t];if(!this.moov)return null;if(n.data){if(n.alreadyRead==n.size)return n}else if(n.data=new Uint8Array(n.size),n.alreadyRead=0,this.samplesDataSize+=n.size,n.is_dup){var r=e.samples[t-1];return a.DataStream.memcpy(n.data.buffer,n.alreadyRead,r.data.buffer,0,n.size),n.alreadyRead=n.size,n}for(;;){var s=this.stream.findPosition(!0,n.offset+n.alreadyRead,!1);if(!(s>-1))return null;var o=(i=this.stream.buffers[s]).byteLength-(n.offset+n.alreadyRead-i.fileStart);if(0===o)return null;if(n.size-n.alreadyRead<=o)return a.DataStream.memcpy(n.data.buffer,n.alreadyRead,i,n.offset+n.alreadyRead-i.fileStart,n.size-n.alreadyRead),i.usedBytes+=n.size-n.alreadyRead,this.stream.logBufferLevel(),n.alreadyRead=n.size,n;a.DataStream.memcpy(n.data.buffer,n.alreadyRead,i,n.offset+n.alreadyRead-i.fileStart,o),n.alreadyRead+=o,i.usedBytes+=o,this.stream.cleanBuffers()}return null},p.prototype.releaseSample=function(e,t){var i=e.samples[t];return i.data?(this.samplesDataSize-=i.size,i.data=null,i.alreadyRead=0,i.size):0},p.prototype.getAllocatedSampleDataSize=function(){return this.samplesDataSize},p.prototype.getCodecs=function(){var e,t="";for(e=0;e<this.moov.traks.length;e++){var i=this.moov.traks[e];e>0&&(t+=","),t+=i.mdia.minf.stbl.stsd.entries[0].getCodec()}return t},p.prototype.getTrexById=function(e){var t;if(!this.moov||!this.moov.mvex)return null;for(t=0;t<this.moov.mvex.trexs.length;t++){var i=this.moov.mvex.trexs[t];if(i.track_id==e)return i}return null},p.prototype.getTrackById=function(e){if(void 0===this.moov)return null;for(var t=0;t<this.moov.traks.length;t++){var i=this.moov.traks[t];if(i.tkhd.track_id==e)return i}return null};var v=function(){};v.prototype.parseSample=function(e){var t,i,n=new h(e.buffer);for(t=[];!n.isEos();)(i=c.parseOneBox(n,!1)).code===c.OK&&"vttc"===i.box.type&&t.push(i.box);return t},v.prototype.getText=function(e,t,i){function n(e,t,i){return i=i||"0",(e+="").length>=t?e:new Array(t-e.length+1).join(i)+e}function r(e){var t=Math.floor(e/3600),i=Math.floor((e-3600*t)/60),r=Math.floor(e-3600*t-60*i),a=Math.floor(1e3*(e-3600*t-60*i-r));return n(t,2)+":"+n(i,2)+":"+n(r,2)+"."+n(a,3)}for(var a=this.parseSample(i),s="",o=0;o<a.length;o++){var l=a[o];s+=r(e)+" --\x3e "+r(t)+"\r\n",s+=l.payl.text}return s};var y=function(){};y.prototype.parseSample=function(e){return new h(e.data.buffer).readString(e.data.length)},y.prototype.parseConfig=function(e){var t=new h(e.buffer);return t.readUint32(),t.readCString()},c.stscBox.prototype.write=function(e){var t;for(this.version=0,this.flags=0,this.size=4+12*this.first_chunk.length,this.writeHeader(e),e.writeUint32(this.first_chunk.length),t=0;t<this.first_chunk.length;t++)e.writeUint32(this.first_chunk[t]),e.writeUint32(this.samples_per_chunk[t]),e.writeUint32(this.sample_description_index[t])},c.avcCBox.prototype.write=function(e){var t;for(this.size=7,t=0;t<this.SPS.length;t++)this.size+=2+this.SPS[t].length;for(t=0;t<this.PPS.length;t++)this.size+=2+this.PPS[t].length;for(this.ext&&(this.size+=this.ext.length),this.writeHeader(e),e.writeUint8(this.configurationVersion),e.writeUint8(this.AVCProfileIndication),e.writeUint8(this.profile_compatibility),e.writeUint8(this.AVCLevelIndication),e.writeUint8(this.lengthSizeMinusOne+252),e.writeUint8(this.SPS.length+224),t=0;t<this.SPS.length;t++)e.writeUint16(this.SPS[t].length),e.writeUint8Array(this.SPS[t]);for(e.writeUint8(this.PPS.length),t=0;t<this.PPS.length;t++)e.writeUint16(this.PPS[t].length),e.writeUint8Array(this.PPS[t]);this.ext&&e.writeUint8Array(this.ext)},c.SampleGroupEntry.prototype.write=function(e){e.writeUint8Array(this.data)},c.SampleEntry.prototype.writeHeader=function(e){this.size=8,c.Box.prototype.writeHeader.call(this,e),e.writeUint8(0),e.writeUint8(0),e.writeUint8(0),e.writeUint8(0),e.writeUint8(0),e.writeUint8(0),e.writeUint16(this.data_reference_index)},c.SampleEntry.prototype.writeFooter=function(e){for(var t=0;t<this.boxes.length;t++)this.boxes[t].write(e),this.size+=this.boxes[t].size;d.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),e.adjustUint32(this.sizePosition,this.size)},c.SampleEntry.prototype.write=function(e){this.writeHeader(e),e.writeUint8Array(this.data),this.size+=this.data.length,d.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),e.adjustUint32(this.sizePosition,this.size)},c.VisualSampleEntry.prototype.write=function(e){this.writeHeader(e),this.size+=70,e.writeUint16(0),e.writeUint16(0),e.writeUint32(0),e.writeUint32(0),e.writeUint32(0),e.writeUint16(this.width),e.writeUint16(this.height),e.writeUint32(this.horizresolution),e.writeUint32(this.vertresolution),e.writeUint32(0),e.writeUint16(this.frame_count),e.writeString(this.compressorname,null,32),e.writeUint16(this.depth),e.writeInt16(-1),this.writeFooter(e)},c.AudioSampleEntry.prototype.write=function(e){this.writeHeader(e),this.size+=20,e.writeUint32(0),e.writeUint32(0),e.writeUint16(this.channel_count),e.writeUint16(this.samplesize),e.writeUint16(0),e.writeUint16(0),e.writeUint32(this.samplerate<<16),this.writeFooter(e)},c.drefBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=4,this.writeHeader(e),e.writeUint32(this.entries.length);for(var t=0;t<this.entries.length;t++)this.entries[t].write(e),this.size+=this.entries[t].size;d.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),e.adjustUint32(this.sizePosition,this.size)},c.tfhdBox.prototype.write=function(e){this.version=0,this.size=4,this.flags&c.TFHD_FLAG_BASE_DATA_OFFSET&&(this.size+=8),this.flags&c.TFHD_FLAG_SAMPLE_DESC&&(this.size+=4),this.flags&c.TFHD_FLAG_SAMPLE_DUR&&(this.size+=4),this.flags&c.TFHD_FLAG_SAMPLE_SIZE&&(this.size+=4),this.flags&c.TFHD_FLAG_SAMPLE_FLAGS&&(this.size+=4),this.writeHeader(e),e.writeUint32(this.track_id),this.flags&c.TFHD_FLAG_BASE_DATA_OFFSET&&e.writeUint64(this.base_data_offset),this.flags&c.TFHD_FLAG_SAMPLE_DESC&&e.writeUint32(this.default_sample_description_index),this.flags&c.TFHD_FLAG_SAMPLE_DUR&&e.writeUint32(this.default_sample_duration),this.flags&c.TFHD_FLAG_SAMPLE_SIZE&&e.writeUint32(this.default_sample_size),this.flags&c.TFHD_FLAG_SAMPLE_FLAGS&&e.writeUint32(this.default_sample_flags)},c.hdlrBox.prototype.write=function(e){this.size=20+this.name.length+1,this.version=0,this.flags=0,this.writeHeader(e),e.writeUint32(0),e.writeString(this.handler,null,4),e.writeUint32(0),e.writeUint32(0),e.writeUint32(0),e.writeCString(this.name)},c.mehdBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=4,this.writeHeader(e),e.writeUint32(this.fragment_duration)},c.stcoBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=4+4*this.chunk_offsets.length,this.writeHeader(e),e.writeUint32(this.chunk_offsets.length),e.writeUint32Array(this.chunk_offsets)},c.trunBox.prototype.write=function(e){this.version=0,this.size=4,this.flags&c.TRUN_FLAGS_DATA_OFFSET&&(this.size+=4),this.flags&c.TRUN_FLAGS_FIRST_FLAG&&(this.size+=4),this.flags&c.TRUN_FLAGS_DURATION&&(this.size+=4*this.sample_duration.length),this.flags&c.TRUN_FLAGS_SIZE&&(this.size+=4*this.sample_size.length),this.flags&c.TRUN_FLAGS_FLAGS&&(this.size+=4*this.sample_flags.length),this.flags&c.TRUN_FLAGS_CTS_OFFSET&&(this.size+=4*this.sample_composition_time_offset.length),this.writeHeader(e),e.writeUint32(this.sample_count),this.flags&c.TRUN_FLAGS_DATA_OFFSET&&(this.data_offset_position=e.getPosition(),e.writeInt32(this.data_offset)),this.flags&c.TRUN_FLAGS_FIRST_FLAG&&e.writeUint32(this.first_sample_flags);for(var t=0;t<this.sample_count;t++)this.flags&c.TRUN_FLAGS_DURATION&&e.writeUint32(this.sample_duration[t]),this.flags&c.TRUN_FLAGS_SIZE&&e.writeUint32(this.sample_size[t]),this.flags&c.TRUN_FLAGS_FLAGS&&e.writeUint32(this.sample_flags[t]),this.flags&c.TRUN_FLAGS_CTS_OFFSET&&(0===this.version?e.writeUint32(this.sample_composition_time_offset[t]):e.writeInt32(this.sample_composition_time_offset[t]))},c.mvhdBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=96,this.writeHeader(e),e.writeUint32(this.creation_time),e.writeUint32(this.modification_time),e.writeUint32(this.timescale),e.writeUint32(this.duration),e.writeUint32(this.rate),e.writeUint16(this.volume<<8),e.writeUint16(0),e.writeUint32(0),e.writeUint32(0),e.writeUint32Array(this.matrix),e.writeUint32(0),e.writeUint32(0),e.writeUint32(0),e.writeUint32(0),e.writeUint32(0),e.writeUint32(0),e.writeUint32(this.next_track_id)},c.ftypBox.prototype.write=function(e){this.size=8+4*this.compatible_brands.length,this.writeHeader(e),e.writeString(this.major_brand,null,4),e.writeUint32(this.minor_version);for(var t=0;t<this.compatible_brands.length;t++)e.writeString(this.compatible_brands[t],null,4)},c["urn Box"].prototype.write=function(e){this.version=0,this.flags=0,this.size=this.name.length+1+(this.location?this.location.length+1:0),this.writeHeader(e),e.writeCString(this.name),this.location&&e.writeCString(this.location)},c.vmhdBox.prototype.write=function(e){this.version=0,this.flags=1,this.size=8,this.writeHeader(e),e.writeUint16(this.graphicsmode),e.writeUint16Array(this.opcolor)},c.sgpdBox.prototype.write=function(e){var t,i;for(this.flags=0,this.size=12,t=0;t<this.entries.length;t++)i=this.entries[t],1===this.version&&(0===this.default_length&&(this.size+=4),this.size+=i.data.length);for(this.writeHeader(e),e.writeString(this.grouping_type,null,4),1===this.version&&e.writeUint32(this.default_length),this.version>=2&&e.writeUint32(this.default_sample_description_index),e.writeUint32(this.entries.length),t=0;t<this.entries.length;t++)i=this.entries[t],1===this.version&&0===this.default_length&&e.writeUint32(i.description_length),i.write(e)},c.sttsBox.prototype.write=function(e){var t;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(e),e.writeUint32(this.sample_counts.length),t=0;t<this.sample_counts.length;t++)e.writeUint32(this.sample_counts[t]),e.writeUint32(this.sample_deltas[t])},c.tfdtBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=4,1===this.version&&(this.size+=4),this.writeHeader(e),1===this.version?e.writeUint64(this.baseMediaDecodeTime):e.writeUint32(this.baseMediaDecodeTime)},c.elngBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=this.extended_language.length,this.writeHeader(e),e.writeString(this.extended_language)},c.mdhdBox.prototype.write=function(e){this.size=20,this.flags=0,this.version=0,this.writeHeader(e),e.writeUint32(this.creation_time),e.writeUint32(this.modification_time),e.writeUint32(this.timescale),e.writeUint32(this.duration),e.writeUint16(this.language),e.writeUint16(0)},c.stszBox.prototype.write=function(e){var t,i=!0;if(this.version=0,this.flags=0,this.sample_sizes.length>0)for(t=0;t+1<this.sample_sizes.length;){if(this.sample_sizes[t+1]!==this.sample_sizes[0]){i=!1;break}t++}else i=!1;this.size=8,i||(this.size+=4*this.sample_sizes.length),this.writeHeader(e),i?e.writeUint32(this.sample_sizes[0]):e.writeUint32(0),e.writeUint32(this.sample_sizes.length),i||e.writeUint32Array(this.sample_sizes)},c.stsdBox.prototype.write=function(e){var t;for(this.version=0,this.flags=0,this.size=0,this.writeHeader(e),e.writeUint32(this.entries.length),this.size+=4,t=0;t<this.entries.length;t++)this.entries[t].write(e),this.size+=this.entries[t].size;d.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),e.adjustUint32(this.sizePosition,this.size)},c.cslgBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=20,this.writeHeader(e),e.writeInt32(this.compositionToDTSShift),e.writeInt32(this.leastDecodeToDisplayDelta),e.writeInt32(this.greatestDecodeToDisplayDelta),e.writeInt32(this.compositionStartTime),e.writeInt32(this.compositionEndTime)},c.kindBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=this.schemeURI.length+1+(this.value.length+1),this.writeHeader(e),e.writeCString(this.schemeURI),e.writeCString(this.value)},c.mfhdBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=4,this.writeHeader(e),e.writeUint32(this.sequence_number)},c.stshBox.prototype.write=function(e){var t;for(this.version=0,this.flags=0,this.size=4+8*this.shadowed_sample_numbers.length,this.writeHeader(e),e.writeUint32(this.shadowed_sample_numbers.length),t=0;t<this.shadowed_sample_numbers.length;t++)e.writeUint32(this.shadowed_sample_numbers[t]),e.writeUint32(this.sync_sample_numbers[t])},c.sidxBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=20+12*this.references.length,this.writeHeader(e),e.writeUint32(this.reference_ID),e.writeUint32(this.timescale),e.writeUint32(this.earliest_presentation_time),e.writeUint32(this.first_offset),e.writeUint16(0),e.writeUint16(this.references.length);for(var t=0;t<this.references.length;t++){var i=this.references[t];e.writeUint32(i.reference_type<<31|i.referenced_size),e.writeUint32(i.subsegment_duration),e.writeUint32(i.starts_with_SAP<<31|i.SAP_type<<28|i.SAP_delta_time)}},c.elstBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=4+12*this.entries.length,this.writeHeader(e),e.writeUint32(this.entries.length);for(var t=0;t<this.entries.length;t++){var i=this.entries[t];e.writeUint32(i.segment_duration),e.writeInt32(i.media_time),e.writeInt16(i.media_rate_integer),e.writeInt16(i.media_rate_fraction)}},c.cttsBox.prototype.write=function(e){var t;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(e),e.writeUint32(this.sample_counts.length),t=0;t<this.sample_counts.length;t++)e.writeUint32(this.sample_counts[t]),1===this.version?e.writeInt32(this.sample_offsets[t]):e.writeUint32(this.sample_offsets[t])},c.sbgpBox.prototype.write=function(e){this.version=1,this.flags=0,this.size=12+8*this.entries.length,this.writeHeader(e),e.writeString(this.grouping_type,null,4),e.writeUint32(this.grouping_type_parameter),e.writeUint32(this.entries.length);for(var t=0;t<this.entries.length;t++){var i=this.entries[t];e.writeInt32(i.sample_count),e.writeInt32(i.group_description_index)}},c.trexBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=20,this.writeHeader(e),e.writeUint32(this.track_id),e.writeUint32(this.default_sample_description_index),e.writeUint32(this.default_sample_duration),e.writeUint32(this.default_sample_size),e.writeUint32(this.default_sample_flags)},c.co64Box.prototype.write=function(e){var t;for(this.version=0,this.flags=0,this.size=4+8*this.chunk_offsets.length,this.writeHeader(e),e.writeUint32(this.chunk_offsets.length),t=0;t<this.chunk_offsets.length;t++)e.writeUint64(this.chunk_offsets[t])},c.stssBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=4+4*this.sample_numbers.length,this.writeHeader(e),e.writeUint32(this.sample_numbers.length),e.writeUint32Array(this.sample_numbers)},c["url Box"].prototype.write=function(e){this.version=0,this.location?(this.flags=0,this.size=this.location.length+1):(this.flags=1,this.size=0),this.writeHeader(e),this.location&&e.writeCString(this.location)},c.tkhdBox.prototype.write=function(e){this.version=0,this.size=80,this.writeHeader(e),e.writeUint32(this.creation_time),e.writeUint32(this.modification_time),e.writeUint32(this.track_id),e.writeUint32(0),e.writeUint32(this.duration),e.writeUint32(0),e.writeUint32(0),e.writeInt16(this.layer),e.writeInt16(this.alternate_group),e.writeInt16(this.volume<<8),e.writeUint16(0),e.writeInt32Array(this.matrix),e.writeUint32(this.width),e.writeUint32(this.height)},c.emsgBox.prototype.write=function(e){this.version=0,this.flags=0,this.size=16+this.message_data.length+(this.scheme_id_uri.length+1)+(this.value.length+1),this.writeHeader(e),e.writeCString(this.scheme_id_uri),e.writeCString(this.value),e.writeUint32(this.timescale),e.writeUint32(this.presentation_time_delta),e.writeUint32(this.event_duration),e.writeUint32(this.id),e.writeUint8Array(this.message_data)},p.prototype.write=function(e){for(var t=0;t<this.boxes.length;t++)this.boxes[t].write(e)},p.writeInitializationSegment=function(e,t,i){var n,r;d.debug("ISOFile","Generating initialization segment");var s=new a.DataStream;for(s.endianness=a.DataStream.BIG_ENDIAN,e.write(s),t.mvex=new c.mvexBox,t.boxes.push(t.mvex),i&&(t.mvhd.duration=i,t.mvex.mehd=new c.mehdBox,t.mvex.boxes.push(t.mvex.mehd),t.mvex.mehd.fragment_duration=i),n=0;n<t.traks.length;n++)r=new c.trexBox,t.mvex.boxes.push(r),t.mvex.trexs.push(r),i&&(t.traks[n].tkhd.duration=i),r.track_id=t.traks[n].tkhd.track_id,r.default_sample_description_index=1,r.default_sample_duration=0,r.default_sample_size=0,r.default_sample_flags=0;return t.write(s),s.buffer},c.SampleEntry.prototype.isVideo=function(){return!1},c.SampleEntry.prototype.isAudio=function(){return!1},c.SampleEntry.prototype.isSubtitle=function(){return!1},c.SampleEntry.prototype.isMetadata=function(){return!1},c.SampleEntry.prototype.isHint=function(){return!1},c.SampleEntry.prototype.getCodec=function(){return this.type.replace(".","")},c.SampleEntry.prototype.getWidth=function(){return""},c.SampleEntry.prototype.getHeight=function(){return""},c.SampleEntry.prototype.getChannelCount=function(){return""},c.SampleEntry.prototype.getSampleRate=function(){return""},c.SampleEntry.prototype.getSampleSize=function(){return""},c.VisualSampleEntry.prototype.isVideo=function(){return!0},c.VisualSampleEntry.prototype.getWidth=function(){return this.width},c.VisualSampleEntry.prototype.getHeight=function(){return this.height},c.AudioSampleEntry.prototype.isAudio=function(){return!0},c.AudioSampleEntry.prototype.getChannelCount=function(){return this.channel_count},c.AudioSampleEntry.prototype.getSampleRate=function(){return this.samplerate},c.AudioSampleEntry.prototype.getSampleSize=function(){return this.samplesize},c.SubtitleSampleEntry.prototype.isSubtitle=function(){return!0},c.MetadataSampleEntry.prototype.isMetadata=function(){return!0},c.decimalToHex=function(e,t){var i=Number(e).toString(16);for(t=void 0===t||null===t?t=2:t;i.length<t;)i="0"+i;return i},c.avc1SampleEntry.prototype.getCodec=function(){var e=c.SampleEntry.prototype.getCodec.call(this);return this.avcC?e+"."+c.decimalToHex(this.avcC.AVCProfileIndication)+c.decimalToHex(this.avcC.profile_compatibility)+c.decimalToHex(this.avcC.AVCLevelIndication):e},c.hvc1SampleEntry.prototype.getCodec=function(){var e,t=c.SampleEntry.prototype.getCodec.call(this);if(this.hvcC){switch(t+=".",this.hvcC.general_profile_space){case 0:t+="";break;case 1:t+="A";break;case 2:t+="B";break;case 3:t+="C"}t+=this.hvcC.general_profile_idc,t+=".";var i=this.hvcC.general_profile_compatibility,n=0;for(e=0;e<32&&(n|=1&i,31!=e);e++)n<<=1,i>>=1;t+=c.decimalToHex(n,0),t+=".",0===this.hvcC.general_tier_flag?t+="L":t+="H",t+=this.hvcC.general_level_idc;var r=!1,a="";for(e=5;e>=0;e--)(this.hvcC.general_constraint_indicator[e]||r)&&(a="."+c.decimalToHex(this.hvcC.general_constraint_indicator[e],0)+a,r=!0);t+=a}return t},c.mp4aSampleEntry.prototype.getCodec=function(){var e=c.SampleEntry.prototype.getCodec.call(this);if(this.esds&&this.esds.esd){var t=this.esds.esd.getOTI(),i=this.esds.esd.getAudioConfig();return e+"."+c.decimalToHex(t)+(i?"."+i:"")}return e},c.stxtSampleEntry.prototype.getCodec=function(){var e=c.SampleEntry.prototype.getCodec.call(this);return this.mime_format?e+"."+this.mime_format:e};var m=function(e){this.inputStream=new a.MultiBufferStream,this.keepMdatData=void 0===e||e,this.inputIsoFile=new p(this.inputStream),this.inputIsoFile.discardMdatData=!this.keepMdatData,this.onMoovStart=null,this.moovStartSent=!1,this.onReady=null,this.readySent=!1,this.onSegment=null,this.onSamples=null,this.onError=null,this.sampleListBuilt=!1,this.fragmentedTracks=[],this.extractedTracks=[],this.isFragmentationInitialized=!1,this.sampleProcessingStarted=!1,this.nextMoofNumber=1,this.itemListBuilt=!1,this.lastSamplesDtss=[],this.forwardOver=0,this.movieTime=0,this.onBeginNextMP4=null,this.media=null,this.anchor_cursor=null,this.last_cursor=null};m.prototype.setSegmentOptions=function(e,t,i){var n=this.inputIsoFile.getTrackById(e);if(n){var r={};this.fragmentedTracks.push(r),r.id=e,r.user=t,r.trak=n,n.nextSample=0,r.fragment_duration=2e3,r.rapAlignement=!0,r.samples=[],r.mdatSize=0,r.fragmentIndex=0,n.is_video&&(this.anchor_cursor=r),i&&(i.fragment_duration&&(r.fragment_duration=i.fragment_duration),i.rapAlignement&&(r.rapAlignement=i.rapAlignement))}},m.prototype.unsetSegmentOptions=function(e){for(var t=-1,i=0;i<this.fragmentedTracks.length;i++){this.fragmentedTracks[i].id==e&&(t=i)}t>-1&&this.fragmentedTracks.splice(t,1)},m.prototype.setExtractionOptions=function(e,t,i){var n=this.inputIsoFile.getTrackById(e);if(n){var r={};this.extractedTracks.push(r),r.id=e,r.user=t,r.trak=n,n.nextSample=0,r.nb_samples=1e3,r.samples=[],i&&i.nbSamples&&(r.nb_samples=i.nbSamples)}},m.prototype.unsetExtractionOptions=function(e){for(var t=-1,i=0;i<this.extractedTracks.length;i++){this.extractedTracks[i].id==e&&(t=i)}t>-1&&this.extractedTracks.splice(t,1)},m.prototype.createSampleMoof=function(e,t){var i=new c.moofBox,n=new c.mfhdBox;n.sequence_number=this.nextMoofNumber,this.nextMoofNumber++,i.boxes.push(n);var r=new c.trafBox;i.boxes.push(r);var s=new c.tfhdBox;r.boxes.push(s),s.track_id=e.id,s.flags=c.TFHD_FLAG_DEFAULT_BASE_IS_MOOF,e.trak.is_video&&(s.flags|=c.TFHD_FLAG_SAMPLE_FLAGS,s.default_sample_flags=16842752);var o=new c.tfdtBox;r.boxes.push(o),o.baseMediaDecodeTime=e.samples[0].dts;var l=new c.trunBox;r.boxes.push(l),i.trun=l,l.flags=c.TRUN_FLAGS_DATA_OFFSET|c.TRUN_FLAGS_DURATION|c.TRUN_FLAGS_SIZE;var u=0;e.trak.is_video&&(l.flags|=c.TRUN_FLAGS_FIRST_FLAG,u=33554432),l.data_offset=0,l.first_sample_flags=u;var d,h=e.samples.length;l.sample_count=h,l.sample_duration=[],l.sample_size=[],l.sample_composition_time_offset=[],t.data=new Uint8Array(e.mdatSize);for(var p=0,f=0;f<h;f++){d=e.samples[f],l.sample_duration.push(d.duration),l.sample_size.push(d.size);var v=d.cts-d.dts;v&&(l.flags|=c.TRUN_FLAGS_CTS_OFFSET),l.sample_composition_time_offset.push(v),a.DataStream.memcpy(t.data.buffer,p,d.data.buffer,0,d.size),p+=d.size}return i},m.prototype.createFragment=function(e){var t=new a.DataStream;t.endianness=a.DataStream.BIG_ENDIAN;var i=new c.mdatBox,n=this.createSampleMoof(e,i);return n.write(t),n.trun.data_offset=n.size+8,d.debug("MP4Box","Adjusting data_offset with new value "+n.trun.data_offset),t.adjustUint32(n.trun.data_offset_position,n.trun.data_offset),i.write(t),t},m.prototype.convertTime=function(e,t,i){if(0===t)return 0;var n=parseFloat(i)/parseFloat(t);return parseInt(.5+parseFloat(e)*n)},m.prototype.processSamples=function(){var e,t,i;if(this.sampleProcessingStarted){if(this.isFragmentationInitialized&&null!==this.onSegment)for(var n=!1;!1===n&&null!==this.anchor_cursor;){if(null===this.last_cursor){for(e=0;e<this.fragmentedTracks.length;e++)if(!(this.fragmentedTracks[e].trak.nextSample>=this.fragmentedTracks[e].trak.samples.length)&&this.fragmentedTracks[e].fragmentIndex<this.anchor_cursor.fragmentIndex){this.last_cursor=this.fragmentedTracks[e];break}if(null===this.last_cursor){if(this.anchor_cursor.trak.nextSample>=this.anchor_cursor.trak.samples.length){for(this.anchor_cursor=null,t=0;t<this.fragmentedTracks.length;t++)this.fragmentedTracks[t].trak.nextSample>=this.fragmentedTracks[t].trak.samples.length||null===this.anchor_cursor&&(this.anchor_cursor=this.fragmentedTracks[t]);if(null===this.anchor_cursor){n=!0;break}}this.last_cursor=this.anchor_cursor}}if(i=this.last_cursor.trak,void 0===this.last_cursor.target_dts){var r=this.last_cursor.fragment_duration;if(g=i.samples[i.nextSample],this.last_cursor===this.anchor_cursor){var a=this.convertTime(g.dts,i.mdia.mdhd.timescale,1e3),s=parseInt((a+r/2)/r);this.last_cursor.target_dts=this.convertTime(r*(s+1),1e3,i.mdia.mdhd.timescale)}else{var o;if(this.anchor_cursor.trak.nextSample==this.anchor_cursor.trak.samples.length){var l=this.anchor_cursor.trak.samples[this.anchor_cursor.trak.nextSample-1];o=l.dts+l.duration}else o=this.anchor_cursor.trak.samples[this.anchor_cursor.trak.nextSample].dts;this.last_cursor.target_dts=this.convertTime(o,this.anchor_cursor.trak.mdia.mdhd.timescale,this.last_cursor.trak.mdia.mdhd.timescale),this.last_cursor.target_dts<=g.dts&&(this.last_cursor.target_dts=this.convertTime(r*(this.last_cursor.fragmentIndex+1),1e3,this.last_cursor.trak.mdia.mdhd.timescale),this.last_cursor.target_dts<=g.dts&&(this.last_cursor.target_dts=g.dts+this.convertTime(r,1e3,this.last_cursor.trak.mdia.mdhd.timescale)))}var u=i.samples.length,c=3.2451855365842673e32;for(e=i.nextSample+1;e<=i.samples.length;e++){var h;if(e<i.samples.length){if(!(g=i.samples[e]).is_rap)continue;h=g.dts}else h=(g=i.samples[e-1]).dts+g.duration;var p=h-this.last_cursor.target_dts,f=p<0?-p:p;if(f<c&&(u=e,c=f),p>=0)break}this.last_cursor.end_sample_index=u}for(;;){if(null===(g=this.inputIsoFile.getSample(i,i.nextSample))){n=!0;break}if(this.last_cursor.samples.push(g),this.last_cursor.mdatSize+=g.size,i.nextSample++,i.nextSample>=this.last_cursor.end_sample_index){var v=this.createFragment(this.last_cursor);this.onSegment(this.last_cursor.id,this.last_cursor.user,v.buffer,i.nextSample),this.last_cursor.fragmentIndex++,delete this.last_cursor.end_sample_index,this.last_cursor.samples=[],this.last_cursor.mdatSize=0,delete this.last_cursor.target_dts,this.last_cursor=null;var y=0;for(t=0;t<this.fragmentedTracks.length&&this.fragmentedTracks[t].trak.nextSample>=this.fragmentedTracks[t].trak.samples.length;t++)y++;this.fragmentedTracks.length===y&&(n=!0);break}}}if(null!==this.onSamples)for(e=0;e<this.extractedTracks.length;e++){var m=this.extractedTracks[e];for(i=m.trak;i.nextSample<i.samples.length&&this.sampleProcessingStarted;){var g;if(d.debug("MP4Box","Exporting on track #"+m.id+" sample #"+i.nextSample),!(g=this.inputIsoFile.getSample(i,i.nextSample)))break;if(i.nextSample++,m.samples.push(g),(i.nextSample%m.nb_samples==0||i.nextSample>=i.samples.length)&&(d.debug("MP4Box","Sending samples on track #"+m.id+" for sample "+i.nextSample),this.onSamples&&this.onSamples(m.id,m.user,m.samples),m.samples=[],m!==this.extractedTracks[e]))break}}}},m.prototype.checkBuffer=function(e){if(null===e||void 0===e)throw"Buffer must be defined and non empty";if(void 0===e.fileStart)throw"Buffer must have a fileStart property";return 0===e.byteLength?(d.warn("MP4Box","Ignoring empty buffer (fileStart: "+e.fileStart+")"),this.inputStream.logBufferLevel(),!1):(d.info("MP4Box","Processing buffer (fileStart: "+e.fileStart+")"),e.usedBytes=0,this.inputStream.insertBuffer(e),this.inputStream.logBufferLevel(),!!this.inputStream.initialized()||(d.warn("MP4Box","Not ready to start parsing"),!1))},m.prototype.appendBuffer=function(e,t,i){var n;if(!this.checkBuffer||this.checkBuffer(e)){if(this.inputIsoFile.parse(),void 0!==t)for(var r=this.inputIsoFile.moov.traks,a=0;a<r.length;a++){var s=r[a];this.lastSamplesDtss[a]=parseInt(t*s.mdia.mdhd.timescale)}if(this.inputIsoFile.moovStartFound&&!this.moovStartSent&&(this.moovStartSent=!0,this.onMoovStart&&this.onMoovStart()),this.inputIsoFile.moov){if(this.processSamples){if(!this.sampleListBuilt){void 0!==i&&(i.duration=this.inputIsoFile.moov.mvhd.duration/this.inputIsoFile.moov.mvhd.timescale),this.inputIsoFile.buildSampleLists(this),this.sampleListBuilt=!0;for(a=0;a<this.fragmentedTracks.length;a++){var o=this.fragmentedTracks[a];(s=this.inputIsoFile.getTrackById(o.id))&&(o.trak=s,s.nextSample=0)}}this.inputIsoFile.updateSampleLists()}this.onReady&&!this.readySent&&(this.readySent=!0,this.onReady(this.getInfo())),this.processSamples&&this.processSamples(),this.nextSeekPosition?(n=this.nextSeekPosition,this.nextSeekPosition=void 0):n=this.inputIsoFile.nextParsePosition,this.inputStream.getEndFilePositionAfter&&(n=this.inputStream.getEndFilePositionAfter(n))}else n=null!==this.inputIsoFile?this.inputIsoFile.nextParsePosition:0;return this.inputIsoFile.meta&&(this.inputIsoFile.flattenItemInfo&&!this.itemListBuilt&&(this.inputIsoFile.flattenItemInfo(),this.itemListBuilt=!0),this.inputIsoFile.processItems&&this.inputIsoFile.processItems(this.onItem)),this.inputStream.cleanBuffers&&(d.info("MP4Box","Done processing buffer (fileStart: "+e.fileStart+") - next buffer to fetch should have a fileStart position of "+n),this.inputStream.logBufferLevel(),this.inputStream.cleanBuffers(),this.inputStream.logBufferLevel(!0),d.info("MP4Box","Sample data size in memory: "+this.inputIsoFile.getAllocatedSampleDataSize())),n}},m.prototype.getInfo=function(){var e,t,i,n,r,a={},s=new Date(4,0,1,0,0,0,0).getTime();if(this.inputIsoFile.moov)for(a.hasMoov=!0,a.duration=this.inputIsoFile.moov.mvhd.duration,a.timescale=this.inputIsoFile.moov.mvhd.timescale,a.isFragmented=null!=this.inputIsoFile.moov.mvex,a.isFragmented&&this.inputIsoFile.moov.mvex.mehd?a.fragment_duration=this.inputIsoFile.moov.mvex.mehd.fragment_duration:a.fragment_duration=0,a.isProgressive=this.inputIsoFile.isProgressive,a.hasIOD=null!=this.inputIsoFile.moov.iods,a.brands=[],a.brands.push(this.inputIsoFile.ftyp.major_brand),a.brands=a.brands.concat(this.inputIsoFile.ftyp.compatible_brands),a.created=new Date(s+1e3*this.inputIsoFile.moov.mvhd.creation_time),a.modified=new Date(s+1e3*this.inputIsoFile.moov.mvhd.modification_time),a.tracks=[],a.audioTracks=[],a.videoTracks=[],a.subtitleTracks=[],a.metadataTracks=[],a.hintTracks=[],a.otherTracks=[],e=0;e<this.inputIsoFile.moov.traks.length;e++){if(r=(i=this.inputIsoFile.moov.traks[e]).mdia.minf.stbl.stsd.entries[0],n={},a.tracks.push(n),n.id=i.tkhd.track_id,n.references=[],i.tref)for(t=0;t<i.tref.boxes.length;t++){var o={};n.references.push(o),o.type=i.tref.boxes[t].type,o.track_ids=i.tref.boxes[t].track_ids}for(n.created=new Date(s+1e3*i.tkhd.creation_time),n.modified=new Date(s+1e3*i.tkhd.modification_time),n.movie_duration=i.tkhd.duration,n.layer=i.tkhd.layer,n.alternate_group=i.tkhd.alternate_group,n.volume=i.tkhd.volume,n.matrix=i.tkhd.matrix,n.track_width=i.tkhd.width/65536,n.track_height=i.tkhd.height/65536,n.timescale=i.mdia.mdhd.timescale,n.duration=i.mdia.mdhd.duration,n.codec=r.getCodec(),n.kind=i.udta&&i.udta.kinds.length?i.udta.kinds[0]:{schemeURI:"",value:""},n.language=i.mdia.elng?i.mdia.elng.extended_language:i.mdia.mdhd.languageString,n.nb_samples=i.samples.length,n.size=0,t=0;t<n.nb_samples;t++)n.size+=i.samples[t].size;n.bitrate=8*n.size*n.timescale/n.duration,r.isAudio()?(a.audioTracks.push(n),n.audio={},n.audio.sample_rate=r.getSampleRate(),n.audio.channel_count=r.getChannelCount(),n.audio.sample_size=r.getSampleSize()):r.isVideo()?(a.videoTracks.push(n),n.video={},n.video.width=r.getWidth(),n.video.height=r.getHeight()):r.isSubtitle()?a.subtitleTracks.push(n):r.isHint()?a.hintTracks.push(n):r.isMetadata()?a.metadataTracks.push(n):a.otherTracks.push(n)}else a.hasMoov=!1;return a},m.prototype.writeFile=function(){var e=new a.DataStream;return e.endianness=a.DataStream.BIG_ENDIAN,this.inputIsoFile.write(e),e.buffer},m.prototype.initializeSegmentation=function(){var e,t,i;null===this.onSegment&&d.warn("MP4Box","No segmentation callback set!"),this.isFragmentationInitialized||(this.isFragmentationInitialized=!0,this.nextMoofNumber=1,this.inputIsoFile.resetTables()),(i={}).id=1;var n=new c.moovBox;for(n.mvhd=this.inputIsoFile.moov.mvhd,n.boxes.push(n.mvhd),e=0;e<this.fragmentedTracks.length;e++)t=this.inputIsoFile.getTrackById(this.fragmentedTracks[e].id),n.boxes.push(t),n.traks.push(t),i.user=this.fragmentedTracks[e].user;var r=new c.ftypBox;r.major_brand="isom",r.minor_version=512,r.compatible_brands=[],r.compatible_brands.push("isom"),r.compatible_brands.push("iso2"),r.compatible_brands.push("avc1"),r.compatible_brands.push("mp41"),r.compatible_brands.push("iso5");var a=this.movieTime*this.inputIsoFile.moov.mvhd.timescale;return i.buffer=p.writeInitializationSegment(r,n,a),i},m.prototype.resetNext=function(){this.inputStream=new a.MultiBufferStream,this.inputIsoFile&&(delete this.inputIsoFile,this.inputIsoFile=new p(this.inputStream),this.inputIsoFile.discardMdatData=!this.keepMdatData),this.sampleListBuilt=!1,this.forwardOver=0;for(var e=0;e<this.fragmentedTracks.length;e++){var t=this.fragmentedTracks[e];t.fragmentIndex=0,delete t.end_sample_index,t.samples=[],t.mdatSize=0,delete t.target_dts,t.trak.is_video&&(this.anchor_cursor=t)}this.last_cursor=null},m.prototype.releaseUsedSamples=function(e,t){var i=0,n=this.inputIsoFile.getTrackById(e);n.lastValidSample||(n.lastValidSample=0);for(var r=n.lastValidSample;r<t;r++)i+=this.inputIsoFile.releaseSample(n,r);d.info("MP4Box","Track #"+e+" released samples up to "+t+" (released size: "+i+", remaining: "+this.inputIsoFile.samplesDataSize+")"),n.lastValidSample=t,this.onBeginNextMP4&&n.lastValidSample>=n.samples.length&&(this.forwardOver++,this.forwardOver===this.inputIsoFile.moov.traks.length&&(this.resetNext(),this.onBeginNextMP4()))},m.prototype.flush=function(){d.info("MP4Box","Flushing remaining samples"),this.inputIsoFile.updateSampleLists(),this.processSamples(),this.inputStream.cleanBuffers(),this.inputStream.logBufferLevel(!0)},m.prototype.seekTrack=function(e,t,i){var n,r,a,s=1/0,o=0,l=0;if(0===i.samples.length)return d.info("MP4Box","No sample in track, cannot seek! Using time "+d.getDurationString(0,1)+" and offset: 0"),{offset:0,time:0};for(n=0;n<i.samples.length;n++){if(r=i.samples[n],0===n)l=0,a=r.timescale;else if(r.cts>e*r.timescale){l=n-1;break}t&&r.is_rap&&(o=n)}for(t&&(l=o),e=i.samples[l].cts,i.nextSample=l;i.samples[l].alreadyRead===i.samples[l].size;)l++;return 0<l?(s=i.samples[l-1].offset+i.samples[l-1].alreadyRead,e=i.samples[l-1].cts):s=i.samples[l].offset+i.samples[l].alreadyRead,d.info("MP4Box","Seeking to "+(t?"RAP":"")+" sample #"+i.nextSample+" on track "+i.tkhd.track_id+", time "+d.getDurationString(e,a)+" and offset: "+s),{offset:s,time:e/a}},m.prototype.seek=function(e,t){var i,n,r,a=this.inputIsoFile.moov,s={offset:1/0,time:1/0};if(this.inputIsoFile.moov){for(r=0;r<a.traks.length;r++)i=a.traks[r],n=this.seekTrack(e,t,i),!1!==i.is_video&&(n.offset<s.offset&&(s.offset=n.offset),n.time<s.time&&(s.time=n.time));return d.info("MP4Box","Seeking at time "+d.getDurationString(s.time,1)+" needs a buffer with a fileStart position of "+s.offset),s.offset===1/0?s={offset:this.inputIsoFile.nextParsePosition,time:0}:s.offset=this.inputStream.getEndFilePositionAfter(s.offset),d.info("MP4Box","Adjusted seek position (after checking data already in buffer): "+s.offset),s}throw"Cannot seek: moov not received!"},m.prototype.getTrackSamplesInfo=function(e){var t=this.inputIsoFile.getTrackById(e);return t?t.samples:void 0},m.prototype.getTrackSample=function(e,t){var i=this.inputIsoFile.getTrackById(e);return this.inputIsoFile.getSample(i,t)},m.prototype.start=function(){this.sampleProcessingStarted=!0,this.processSamples()},m.prototype.stop=function(){this.sampleProcessingStarted=!1};var g=function(e){this.kernel=e,this.close()};g.prototype.close=function(){this.mediaSource&&(this.releaseBuffers(),this.removeBuffers()),this.mediaSource=null,this.video=null,this.movieInfo=null,this.mp4box=null,this.onCanFillNext=null,this.rate=0,this.seeking=!1},g.prototype.initialize=function(e){return void 0===e||null===e?(this.kernel.sendLog("P2PMedia of initializtion is fialed.","error"),!1):(this.video=e,this.resetMediaSource(),d.setLogLevel(d.LOG_LEVEL_INFO),!0)},g.prototype.setMoiveDuration=function(e,t){this.rate=t/e,this.mp4box.movieTime=e},g.prototype.play=function(e){if(e)return this.video.src=e.url,void(e.ispause||this.video.play());this.video.play()},g.prototype.appendBuffer=function(e,t,i){this.mp4box.appendBuffer(e,t,i)},g.prototype.getSurplusDuration=function(){var e,t,i,n=0;for(e=0;e<this.video.buffered.length;e++)if(t=this.video.buffered.start(e),i=this.video.buffered.end(e),!(this.video.currentTime>=i)){if(t>this.video.currentTime){if(!0===this.video.seeking)return 0;var r="getSurplusDuration this.video.buffered.length: "+this.video.buffered.length+" i: "+e+" start: "+t+" end: "+i+" currentTime: "+this.video.currentTime;this.kernel.sendLog(r),0===this.video.currentTime?this.video.currentTime=t+1:this.video.currentTime=t+15,i<this.video.currentTime&&(this.video.currentTime=i)}if(!(.1>(n=i-this.video.currentTime)))return n}return n},g.prototype.seek=function(){if(!1!==this.seeking){var e="seek to "+this.video.currentTime;this.kernel.sendLog(e),this.video.lastSeekTime=this.video.currentTime;for(var t=this.video.lastSeekTime,i=void 0,n=0,r=0;r<this.kernel.fileManager.videos.length&&!(t<(i=this.kernel.fileManager.videos[r]).duration+n);r++)n+=i.duration;this.kernel.downloader.releaseAllPeer(),this.kernel.downloader.releaseAllCDN(),this.kernel.downloader.oldCdnNid="",this.kernel.downloader.isCheck=!1;var a=i.dispatch+"&headeronly=1",s=new S;s.currentTime=t,s.offsetDuration=n,s.video=i,s.dispatchByUrl(a,this)}},g.prototype.change=function(e){this.currentTime=this.video.currentTime,this.kernel.downloader.releaseAllPeer(),this.kernel.downloader.releaseAllCDN(),this.releaseBuffers(),this.removeBuffers(),this.resetMediaSource(),this.setMoiveDuration(e.totalDuration,e.totalSize)},g.prototype.onDownloadCDN=function(e,t){if(e.currentTime===this.video.lastSeekTime){var i,n,r;for(this.kernel.downloader.isCheck=!0,this.kernel.downloader.beginPeerTime=0,this.kernel.downloader.dataPeerSize=0,this.kernel.downloader.averagePeerSpeed=0,this.kernel.downloader.averagePeerSpeedAry=[],i=0;i<this.video.buffered.length;i++)if(n=this.video.buffered.start(i),r=this.video.buffered.end(i),this.video.currentTime>=n&&this.video.currentTime<=r){var a=new m;return t.fileStart=0,a.appendBuffer(t,e.offsetDuration,e.video),this.seekIFrame(e.currentTime,a),a=null,this.seeking=!1,void(this.kernel.isSeeked=!0)}this.releaseBuffers(),this.mp4box.resetNext(),t.fileStart=0;var s=this.mp4box.sampleProcessingStarted;this.mp4box.sampleProcessingStarted=!1,this.appendBuffer(t,e.offsetDuration,e.video),this.mp4box.sampleProcessingStarted=s,this.seeking=!1,this.kernel.isSeeked=!0;var o=this.seekIFrame(e.currentTime,this.mp4box);this.kernel.fileManager.seek(e.video,o),!0===this.video.paused&&this.video.play()}},g.prototype.seekIFrame=function(e,t){var i=t.seek(e,!0);return e=i.time,i=t.seek(e,!0),this.video.currentTime=e,this.video.lastSeekTime=e,i.offset},g.prototype.onDownloadCDNFailed=function(e){this.kernel.sendLog("seek failed"),this.video.lastSeekTime=this.video.lastSeekTime-1,this.seek()},g.prototype.releaseBuffers=function(){for(var e=0;e<this.mediaSource.activeSourceBuffers.length;e++){var t=this.mediaSource.activeSourceBuffers[e];t.pendingAppends=[],t.rubbishAppends=[];for(var i=0;i<t.buffered.length;i++){var n=t.buffered.start(i),r=t.buffered.end(i);1!=t.updating&&t.remove(n,r)}}},g.prototype.removeBuffers=function(){for(var e=this.mediaSource;0<e.sourceBuffers.length;){var t=e.sourceBuffers[0];e.removeSourceBuffer(t)}},g.prototype.resetMediaSource=function(){window.MediaSource=window.MediaSource||window.WebkitMediaSource,this.mediaSource&&delete this.mediaSource,this.mediaSource=new MediaSource,this.mediaSource.media=this,this.mediaSource.video=this.video,this.video.ms=this.mediaSource,this.mediaSource.addEventListener("sourceopen",g.onSourceOpen,!1),this.mediaSource.addEventListener("webkitsourceopen",g.onSourceOpen,!1),this.mediaSource.addEventListener("sourceclose",g.onSourceClose,!1),this.mediaSource.addEventListener("webkitsourceclose",g.onSourceClose,!1),this.video.src=window.URL.createObjectURL(this.mediaSource),this.mp4box&&delete this.mp4box,this.mp4box=new m,this.mp4box.media=this,this.mediaSource.mp4box=this.mp4box,this.mp4box.onMoovStart=function(){},this.mp4box.onReady=function(e){this.media.kernel.sendLog("Starting to parse movie information onReady","info"),this.media.movieInfo||(this.media.movieInfo=e,this.media.initializeAllSourceBuffers())},this.mp4box.onSegment=function(e,t,i,n){var r=t;r.segmentIndex++,r.pendingAppends.push({id:e,buffer:i,sampleNum:n}),g.onUpdate.call(r)},this.mp4box.onBeginNextMP4=function(){null!==this.media.onCanFillNext&&(this.media.kernel.downloader.oldCdnNid="",this.media.onCanFillNext())}},g.prototype.initializeAllSourceBuffers=function(){var e,t=this.movieInfo;e=1==t.tracks.length?'video/mp4; codecs="'+t.tracks[0].codec+'"':'video/mp4; codecs="'+t.tracks[0].codec+", "+t.tracks[1].codec+'"',window.MediaSource.isTypeSupported(e)?setTimeout(this.waitForSouceOpen.bind(this),50,e):this.kernel.sendLog("not support "+e,"error")},g.prototype.waitForSouceOpen=function(e){if("open"==this.mediaSource.readyState){var t=this.movieInfo,i=this.mediaSource.addSourceBuffer(e);i.ms=this.mediaSource,i.pendingAppends=[],i.rubbishAppends=[],this.kernel.downloader&&(this.kernel.downloader.sb=i);for(var n=0;n<t.tracks.length;n++){var r=t.tracks[n];this._addBuffer(r.id,i)}this._addInitSegments2SourceBuffers(),this.mp4box.start()}else setTimeout(this.waitForSouceOpen.bind(this),50,e)},g.prototype._addBuffer=function(e,t){this.mp4box.setSegmentOptions(e,t,{fragment_duration:2e3})},g.prototype._addInitSegments2SourceBuffers=function(){var e=this.mp4box.initializeSegmentation(),t=e.user;t.segmentIndex=0,t.appendBuffer(e.buffer),t.addEventListener("updateend",g.onUpdateEnd.bind(t)),g.onUpdate.call(t)},g.onUpdate=function(){if("open"===this.ms.readyState&&!1===this.updating&&this.pendingAppends.length>0){var e=this.pendingAppends.shift();this.appendBuffer(e.buffer),this.rubbishAppends.push({id:e.id,sampleNum:e.sampleNum})}},g.onUpdateEnd=function(){if(this.rubbishAppends.length>0){var e=this.rubbishAppends.shift();this.ms.mp4box.releaseUsedSamples(e.id,e.sampleNum)}if("open"===this.ms.readyState&&!1===this.updating)if(this.pendingAppends.length>0){var t=this.pendingAppends.shift();this.appendBuffer(t.buffer),this.rubbishAppends.push({id:t.id,sampleNum:t.sampleNum})}else this.ms.media.kernel.isAD&&this.ms.endOfStream()},g.onSourceClose=function(e){var t=e.target;t.media.kernel.sendLog("Source closed","info"),t.media.kernel.fileManager&&(t.media.kernel.fileManager.isAppend=!1)},g.onSourceOpen=function(e){var t=e.target.media;t.kernel.sendLog("Source opened","info"),t.kernel.fileManager&&(t.kernel.fileManager.isAppend=!0),t.currentTime&&(t.video.currentTime=t.currentTime,delete t.currentTime,t.play())};var b=function e(){this.kernel=null,this.rtcPeerConnection=null,this.dataChannel=null,this.otherP2PID=0,this.otherTrackerIP=0,this.id=0,this.readyState=e.PEER_STATE_INIT,this.lastRecvTime=z.getMillisecond(),this.task={chunks:[]},this.speed=0,this.beginCheckTime=0};b.PEER_STATE_INIT=0,b.PEER_STATE_LISTEN=1,b.PEER_STATE_CONNECT=2,b.PEER_STATE_CLOSE=3,b.PEER_OP_GET_DATA=0,b.PEER_OP_SEND_DATA=1,b.prototype.close=function(){if(b.PEER_STATE_CLOSE!==this.readyState){if(this.dataChannel&&(this.dataChannel.close(),this.dataChannel=null),this.rtcPeerConnection&&(this.rtcPeerConnection.close(),this.rtcPeerConnection=null),b.PEER_STATE_CONNECT===this.readyState){for(var e in this.task.chunks)this.kernel.fileManager.lostChunk(this.task.chunks[e].index);this.kernel.downloader.clearPeerLoad(this),this.task.chunks=[]}else b.PEER_STATE_LISTEN===this.readyState&&this.kernel.uploader.clearPeerLoad(this);this.kernel&&delete this.kernel.tracker.peers[this.id],this.readyState=b.PEER_STATE_CLOSE}},b.prototype.connect=function(e,t,i){if(this.id=i<<32,this.id|=t,e.tracker.peers[this.id])return!1;this.kernel=e,this.readyState=b.PEER_STATE_CONNECT,this.rtcPeerConnection=new RTCPeerConnection(e.tracker.configuration);try{this.dataChannel=this.rtcPeerConnection.createDataChannel("sendDataChannel")}catch(e){return this.kernel.sendLog("not support createDataChannel,close p2p"),void(_.ISWEBP2P=0)}this.initializeChannel();var n=this;return this.rtcPeerConnection.onicecandidate=function(n){n.candidate&&e.tracker.sendCandidate(n.candidate,t,i)},this.otherP2PID=t,this.otherTrackerIP=i,e.tracker.peers[this.id]=this,this.rtcPeerConnection.createOffer().then(function(e){n.rtcPeerConnection.setLocalDescription(new RTCSessionDescription(e)).then(function(){n.kernel.tracker.sendOffer(e,n.otherP2PID,n.otherTrackerIP)})}).catch(b.onConnectPeerError.bind(n)),!0},b.prototype.listen=function(e,t,i,n){if(this.id=i<<32,this.id|=t,e.tracker.peers[this.id])return!1;this.kernel=e,this.readyState=b.PEER_STATE_LISTEN,this.rtcPeerConnection=new RTCPeerConnection(e.tracker.configuration);var r=this;return this.rtcPeerConnection.ondatachannel=function(e){r.dataChannel=e.channel,r.initializeChannel()},this.rtcPeerConnection.onicecandidate=function(n){n.candidate&&e.tracker.sendCandidate(n.candidate,t,i)},this.otherP2PID=t,this.otherTrackerIP=i,e.tracker.peers[this.id]=this,this.rtcPeerConnection.setRemoteDescription(new RTCSessionDescription(n)).then(function(){r.rtcPeerConnection.createAnswer().then(function(e){r.rtcPeerConnection.setLocalDescription(new RTCSessionDescription(e)).then(function(){r.kernel.tracker.sendAnswer(e,r.otherP2PID,r.otherTrackerIP)})})}).catch(b.onConnectPeerError.bind(r)),!0},b.prototype.getData=function(e){if(b.PEER_STATE_CONNECT!==this.readyState)return this.kernel.sendLog("the peer "+this.id+" is not conneted, current state is "+this.readyState,"warn"),!1;if(this.task=this.kernel.fileManager.getChunkByCount(e),0===this.task.count)return this.kernel.sendLog("get some task from "+this.id+", but there is no any chunks","warn"),!1;var t={};for(var i in t.vid=this.task.vid,t.count=this.task.count,t.indexs=[],this.task.chunks)t.indexs.push(i);var n=JSON.stringify(t),r=new a.DataStream;r.endianness=a.DataStream.BIG_ENDIAN,r.writeUint16(b.PEER_OP_GET_DATA),r.writeUint16(n.length),r.writeString(n);try{this.dataChannel.send(r.buffer)}catch(e){return this.kernel.sendLog("peer send failed, "+e.message,"warn"),!1}return!0},b.prototype.initializeChannel=function(){var e=this;this.dataChannel.binaryType="arraybuffer",this.dataChannel.onopen=function(){b.PEER_STATE_CONNECT===e.readyState?!1===e.kernel.downloader.addPeer(e)||!1===e.getData(1)?e.close():e.beginCheckTime=z.getMillisecond():b.PEER_STATE_LISTEN===e.readyState&&!1===e.kernel.uploader.addPeer(e)&&e.close()},this.dataChannel.onclose=function(t){e.close()},this.dataChannel.onerror=function(t){e.kernel.sendLog("data channel is error for peer "+e.otherP2PID+", error "+t,"info"),e.close()},this.dataChannel.onmessage=function(t){e.lastRecvTime=z.getMillisecond();var i=new a.DataStream(t.data,0,a.DataStream.BIG_ENDIAN),n=i.readUint16();b.PEER_OP_GET_DATA===n?e.sendDataForPeer(i):b.PEER_OP_SEND_DATA===n&&e.recvDatafromPeer(i)}},b.prototype.sendDataForPeer=function(e){var t=e.readUint16();try{for(var i=JSON.parse(e.readString(t)),n=i.vid,r=i.count,s=0;s<r;s++){var o={},l=i.indexs[s];o.vid=n,o.index=l;var u=new a.DataStream;u.endianness=a.DataStream.BIG_ENDIAN,u.writeUint16(b.PEER_OP_SEND_DATA);var d=this.kernel.fileManager.getCompleteChunk(n,l);try{if(null===d){o.codetype=0,o.code=0;var c=JSON.stringify(o);return u.writeUint16(c.length),u.writeString(c),u.writeUint32(0),void this.dataChannel.send(u.buffer)}o.codetype=d.codetype,o.code=d.code;c=JSON.stringify(o);u.writeUint16(c.length),u.writeString(c),u.writeUint32(d.size),u.writeUint8Array(d.data),this.dataChannel.send(u.buffer)}catch(e){return this.kernel.sendLog("peer send failed, "+e.message,"warn"),void this.close()}}}catch(e){this.kernel.sendLog("senddata json parse failed ","warn")}},b.prototype.recvDatafromPeer=function(e){var t=e.readUint16();try{var i=JSON.parse(e.readString(t)),n=i.index,r=(i.codetype,i.code),s=i.vid,o=e.readUint32();if(0===o||0===r)return this.kernel.sendLog("index:"+n+" peer "+this.id+" is not more data for me","info"),void this.close();var l=this.task.chunks[n];if(void 0===l||s!==l.video.vid||o!==l.size)return;if(l.data=new Uint8Array(o),a.DataStream.memcpy(l.data.buffer,0,e.buffer,e.position,o),P.getCode(l.data)!=r)return;l.code=r,l.codetype="peer",l.completeByPeer(),this.task.count--,delete this.task.chunks[n],this.task.completeSize+=o;var u=z.getMillisecond();if(this.speed=this.task.completeSize/(u-this.task.create)*1e3,0===this.task.count){var d=5,c=this.kernel.downloader.getAveragePeerSpeed(u);if(c){var h=this.speed/c*10;0===(d=parseInt(h))&&(d=1)}!1===this.getData(d)&&this.close()}}catch(e){console.warn(z.getTimeNow(),"recvdata json parse failed "),this.kernel.sendLog("recvdata json parse failed ","warn")}},b.prototype.checkDownload=function(e,t){if(1e3>e-this.beginCheckTime)return!0;if(0===this.speed)return!1;var i=void 0;for(var n in this.task.chunks){i=this.task.chunks[n];break}return this.kernel.media.mp4box.movieTime*((i.index+1)/this.kernel.fileManager.chunks.length)-this.kernel.media.video.currentTime-(this.task.totalSize-this.task.completeSize)/this.speed>t},b.prototype.check=function(e){return z.MAX_PEER_UNINTERACTION_TIME>e-this.lastRecvTime},b.prototype.getSmallOffer=function(e){for(var t=e.split("\n"),i="",n=0,r=0,a=0;a<t.length;a++)-1==t[a].search("a=group")?-1==t[a].search("m=audio")?-1==t[a].search("m=video")?(-1!=t[a].search("m=application")&&(n=0,r=0),0==n&&0==r&&(i+=t[a]+(a!=t.length-1?"\n":""))):r=a:n=a:i+="a=group:BUNDLE data\n";return i},b.onConnectPeerError=function(e){this.kernel.sendLog("connect peer "+this.id+" failed, "+e,"warn"),this.readyState=b.PEER_STATE_CLOSE,this.close()},b.onCreateOffer=function(e){var t=this;t.rtcPeerConnection.setLocalDescription(new RTCSessionDescription(e),function(){t.kernel.tracker.sendOffer(e,t.otherP2PID,t.otherTrackerIP)},b.onConnectPeerError.bind(t))},b.onCreateAnswer=function(e){var t=this;t.rtcPeerConnection.setLocalDescription(new RTCSessionDescription(e),function(){t.kernel.tracker.sendAnswer(e,t.otherP2PID,t.otherTrackerIP)},b.onConnectPeerError.bind(t))};var _=function(e){this.kernel=e,this.close()};_.TRACKER_STATE_DISCONNECT=0,_.TRACKER_STATE_CONNECTING=1,_.TRACKER_STATE_CONNECT=2,_.TRACKER_PROTOCOL_LOGIN=257,_.TRACKER_PROTOCOL_ADD=258,_.TRACKER_PROTOCOL_REMOVE=259,_.TRACKER_PROTOCOL_GETPEER=268,_.TRACKER_PROTOCOL_OFFER=269,_.TRACKER_PROTOCOL_ANSWER=270,_.TRACKER_PROTOCOL_PUNCH=271,_.TRACKER_PROTOCOL_HEART=1,_.TRACKER_PROTOCOL_GATEWAY=261,_.TRACKER_PROTOCOL_STAT=272,_.ISWEBP2P=0,_.prototype.close=function(){if(this.socket&&(this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket.close()),this.socket=null,this.trackerIP=0,this.sp=1,this.prov=40,this.nat=2,this.ver=Number(z.VERSION.slice(-4)),this.exVer=3,this.p2pID=0,this.peers)for(var e in this.peers)this.peers[e].close();this.peers=[],this.readyState=_.TRACKER_STATE_DISCONNECT,this.fileKeys=[],this.sendTime=z.getMillisecond(),this.configuration={},this.isGateway=!0},_.prototype.connect=function(e){this.socket=new WebSocket(e),this.readyState=_.TRACKER_STATE_CONNECTING;var t=this;this.socket.onopen=function(){!0===t.isGateway?t.sendGateway():t.sendLogin()},this.socket.onmessage=function(e){t.processMessage(e)},this.socket.onerror=function(e){t.trackerError(e)},this.socket.onclose=function(e){t.trackerClose(e)}},_.prototype.trackerError=function(e){this.kernel.sendLog("tracker of socket is error ","info"),this.readyState=_.TRACKER_STATE_DISCONNECT,this.socket=null,this.isGateway=!0},_.prototype.trackerClose=function(e){this.kernel.sendLog("tracker of socket is closed ","info"),this.readyState=_.TRACKER_STATE_DISCONNECT,this.socket=null,this.isGateway=!0},_.prototype.processMessage=function(e){var t;try{t=JSON.parse(e.data)}catch(e){return void this.kernel.sendLog("tracker of json is error, "+e.message,"warn")}_.TRACKER_PROTOCOL_GETPEER==t.op?this.getPeer(t):_.TRACKER_PROTOCOL_OFFER===t.op?this.offer(t):_.TRACKER_PROTOCOL_ANSWER===t.op?this.answer(t):_.TRACKER_PROTOCOL_PUNCH===t.op?this.icecandidate(t):_.TRACKER_PROTOCOL_LOGIN===t.op?this.login(t):_.TRACKER_PROTOCOL_GATEWAY===t.op?this.gateway(t):this.kernel.sendLog("unkown op, "+t.toString(),"warn")},_.prototype.gateway=function(e){this.isGateway=!1,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket.close(),this.socket=null,this.sp=e.sp,this.prov=e.prov,this.configuration.iceServers=[],this.configuration.iceServers.push({urls:e.stun}),this.kernel.myPublicIP=e.cip,this.connect("wss://"+e.tracker)},_.prototype.login=function(e){for(var t in this.isGateway=!0,this.p2pID=e.id,this.trackerIP=e.tracker,this.readyState=_.TRACKER_STATE_CONNECT,this.kernel.sendLog("my p2pID is "+this.p2pID+",trackerIP is "+this.trackerIP,"info"),this.fileKeys)this.sendAddFile(t)},_.prototype.getPeer=function(e){if(_.ISWEBP2P&&null!==e.peers&&void 0!==e.peers)for(var t=0;t<e.peers.length;t++){var i=new b;!1===i.connect(this.kernel,e.peers[t].id,e.peers[t].tracker)&&(i=null)}},_.prototype.offer=function(e){var t={};t.sdp=e.sdp,t.type="offer",(new b).listen(this.kernel,e.id,e.tracker,t)},_.prototype.answer=function(e){var t=e.tracker;t|=e.id;var i=this.peers[t];if(void 0!==i){var n={};n.sdp=e.sdp,n.type="answer",i.rtcPeerConnection.setRemoteDescription(new RTCSessionDescription(n))}},_.prototype.icecandidate=function(e){var t=e.tracker;t|=e.id;var i=this.peers[t];void 0!==i&&e.candidate&&e.candidate.candidate&&void 0!==e.candidate.sdpMLineIndex&&i.rtcPeerConnection.addIceCandidate(new RTCIceCandidate({sdpMLineIndex:e.candidate.sdpMLineIndex,candidate:e.candidate.candidate}))},_.prototype.sendGetPeer=function(e){if(_.TRACKER_STATE_CONNECT===this.readyState)try{this.socket.send(JSON.stringify({op:_.TRACKER_PROTOCOL_GETPEER,file:e})),this.sendTime=z.getMillisecond()}catch(e){this.kernel.sendLog("tracker send faild, "+e.message,"warn"),this.trackerError(e)}},_.prototype.sendAddFile=function(e){if(void 0===this.fileKeys[e]&&(this.fileKeys[e]=e),_.TRACKER_STATE_CONNECT===this.readyState)try{this.socket.send(JSON.stringify({op:_.TRACKER_PROTOCOL_ADD,file:e})),this.sendTime=z.getMillisecond()}catch(e){this.kernel.sendLog("tracker send faild, "+e.message,"warn"),this.trackerError(e)}},_.prototype.sendRemoveFile=function(e){if(delete this.fileKeys[e],_.TRACKER_STATE_CONNECT===this.readyState)try{this.socket.send(JSON.stringify({op:_.TRACKER_PROTOCOL_REMOVE,file:e})),this.sendTime=z.getMillisecond()}catch(e){this.kernel.sendLog("tracker send faild, "+e.message,"warn"),this.trackerError(e)}},_.prototype.sendGateway=function(){if(_.TRACKER_STATE_CONNECTING===this.readyState)try{this.socket.send(JSON.stringify({op:_.TRACKER_PROTOCOL_GATEWAY,vid:this.kernel.fileManager.vid})),this.sendTime=z.getMillisecond()}catch(e){this.kernel.sendLog("tracker send faild, "+e.message,"warn"),this.trackerError(e)}},_.prototype.sendLogin=function(){if(_.TRACKER_STATE_CONNECTING===this.readyState)try{this.socket.send(JSON.stringify({op:_.TRACKER_PROTOCOL_LOGIN,ver:this.ver,ex_ver:this.exVer,nat:this.nat,sp:this.sp,prov:this.prov})),this.sendTime=z.getMillisecond()}catch(e){this.kernel.sendLog("tracker send faild, "+e.message,"warn"),this.trackerError(e)}},_.prototype.sendHeart=function(){if(_.TRACKER_STATE_CONNECT===this.readyState)try{this.socket.send(JSON.stringify({op:_.TRACKER_PROTOCOL_HEART})),this.sendTime=z.getMillisecond()}catch(e){this.kernel.sendLog("tracker send faild, "+e.message,"warn"),this.trackerError(e)}},_.prototype.sendCandidate=function(e,t,i){if(_.TRACKER_STATE_CONNECT===this.readyState)try{this.socket.send(JSON.stringify({op:_.TRACKER_PROTOCOL_PUNCH,id:t,tracker:i,candidate:e})),this.sendTime=z.getMillisecond()}catch(e){this.kernel.sendLog("tracker send faild, "+e.message,"warn"),this.trackerError(e)}},_.prototype.sendOffer=function(e,t,i){if(_.TRACKER_STATE_CONNECT===this.readyState)try{this.socket.send(JSON.stringify({op:_.TRACKER_PROTOCOL_OFFER,id:t,tracker:i,sdp:e.sdp})),this.sendTime=z.getMillisecond()}catch(e){this.kernel.sendLog("tracker send faild, "+e.message,"warn"),this.trackerError(e)}},_.prototype.sendAnswer=function(e,t,i){if(_.TRACKER_STATE_CONNECT===this.readyState)try{this.socket.send(JSON.stringify({op:_.TRACKER_PROTOCOL_ANSWER,id:t,tracker:i,sdp:e.sdp})),this.sendTime=z.getMillisecond()}catch(e){this.kernel.sendLog("tracker send faild, "+e.message,"warn"),this.trackerError(e)}},_.prototype.sendStat=function(e){if(_.TRACKER_STATE_CONNECT===this.readyState)try{this.socket.send(JSON.stringify({op:_.TRACKER_PROTOCOL_STAT,log:"H5Report ["+this.kernel.myPublicIP+"] "+e})),this.sendTime=z.getMillisecond()}catch(e){this.kernel.sendLog("tracker send faild, "+e.message,"warn"),this.trackerError(e)}},_.prototype.check=function(e){if(0!=this.kernel.downloader.isCheck&&!(5e3>e-this.lastCheckTime)){if(this.lastCheckTime=e,_.TRACKER_STATE_DISCONNECT===this.readyState)return this.kernel.sendLog("tracker is not connected,so we will connect it.","info"),void this.connect(z.TRACKER_DOMAIN);for(var t in _.TRACKER_STATE_CONNECT===this.readyState&&6e4<e-this.sendTime&&this.sendHeart(),this.peers)0==this.peers[t].check(e)&&this.peers[t].close()}};var w=function(e){this.kernel=e,this.close();var t=this;this.kernel.media.onCanFillNext=function(){t.currentVideoIndex++,t.appendBuffer()}};w.REPORT_CHUNK_SIZE=2097152,w.PEER_CHUNK_SIZE=1024,w.prototype.close=function(){this.chunks=[],this.videos=[],this.getIndex=0,this.minCompleteIndex=0,this.currentVideoIndex=0,this.isAppend=!1,this.display=""},w.prototype.initialize=function(e){if(void 0===e.vid)return this.kernel.sendLog("filemanager initialize failed, vid is undefined","error"),!1;this.vid=e.vid,this.setDisplayBegin(e);for(var t,i=0,n=0,r=0;r<e.videos.length;r++){var a=e.videos[r];if(!a.dispatch)return;if(void 0===a.dispatch||void 0===a.code||void 0===a.duration||void 0===a.size)return this.kernel.sendLog("filemanager initialize failed, movieInfo is error","error"),!1;var s={};s.vid=this.vid,s.dispatch=a.dispatch,s.code=a.code,s.duration=a.duration,s.size=a.size,s.index=r,s.chunkIndex=i,this.videos.push(s);for(var o=0,l=0;;){var u={};if(u.code=s.code+"_"+l,!(s.size>=o+w.REPORT_CHUNK_SIZE)){var d=s.size-o;u.complete=parseInt(d/w.PEER_CHUNK_SIZE),u.download=0;c=0;for(c=0;c<u.complete;c++){this.kernel.isTest&&0==i%64&&((t={}).code="div"+n++,t.type=0,t.complete=0,t.download=0,this.setDisplay(t.code)),(h=new k).manager=this,h.video=s,h.report=u,h.size=w.PEER_CHUNK_SIZE,h.fileStart=o+c*w.PEER_CHUNK_SIZE,h.index=i++,this.chunks.push(h),d-=w.PEER_CHUNK_SIZE,this.kernel.isTest&&(h.display=t,t.complete++)}if(d)this.kernel.isTest&&0==i%64&&((t={}).code="div"+n++,t.type=0,t.complete=0,t.download=0,this.setDisplay(t.code)),u.complete++,(h=new k).manager=this,h.video=s,h.report=u,h.size=d,h.fileStart=o+c*w.PEER_CHUNK_SIZE,h.index=i++,this.chunks.push(h),this.kernel.isTest&&(h.display=t,t.complete++);break}u.complete=w.REPORT_CHUNK_SIZE/w.PEER_CHUNK_SIZE,u.download=0;for(var c=0;c<u.complete;c++){var h;this.kernel.isTest&&0==i%64&&((t={}).code="div"+n++,t.type=0,t.complete=0,t.download=0,this.setDisplay(t.code)),(h=new k).manager=this,h.video=s,h.report=u,h.size=w.PEER_CHUNK_SIZE,h.fileStart=o+c*w.PEER_CHUNK_SIZE,h.index=i++,this.chunks.push(h),this.kernel.isTest&&(h.display=t,t.complete++)}o+=w.REPORT_CHUNK_SIZE,l++}}return this.setDisplayEnd(),!0},w.prototype.getChunk=function(){for(;this.getIndex<this.chunks.length;this.getIndex++){var e=this.chunks[this.getIndex];if(k.CHUNK_STATE_INIT===e.readyState)return this.getIndex++,e}return null},w.prototype.getChunkBySize=function(e){for(var t=[],i=0,n=void 0,r=void 0;;){var a=this.getChunk();if(null===a)return t;if(void 0===n&&(n=a.video.index),void 0===r&&(r=a.index-1),n!==a.video.index)return this.lostChunk(a.index),t;if(r+1!==a.index)return this.lostChunk(a.index),t;if(r=a.index,i+=a.size,t.push(a),i>e)return t}},w.prototype.getChunkByCount=function(e){for(var t={chunks:[],count:0,vid:this.vid,create:z.getMillisecond(),totalSize:0,completeSize:0},i=0;i<e;i++){var n=this.getChunk();if(null===n)break;t.chunks[n.index]=n,t.count++,t.totalSize+=n.size}return t},w.prototype.lostChunk=function(e){this.chunks[e].readyState=k.CHUNK_STATE_INIT,this.getIndex>e&&(this.getIndex=e)},w.prototype.completeChunk=function(e){var t=this.chunks[e];if(t.readyState=k.CHUNK_STATE_COMPLETE,t.report.download++,!0===this.kernel.share&&t.report.complete===t.report.download&&this.kernel.tracker.sendAddFile(t.report.code),this.kernel.isTest&&t.display.complete===++t.display.download){var i=document.getElementById(t.display.code);k.TEST_DISPLAY_TYPE_CDN===t.display.type?i.className="cdndown":k.TEST_DISPLAY_TYPE_PEER===t.display.type?i.className="peerdown":k.TEST_DISPLAY_TYPE_MIXTURE===t.display.type&&(i.className="mixturedown")}this.appendBuffer()},w.prototype.appendBuffer=function(){if(!1!==this.isAppend)for(;this.minCompleteIndex<this.chunks.length;this.minCompleteIndex++){var e=this.chunks[this.minCompleteIndex];if(this.currentVideoIndex!==e.video.index||k.CHUNK_STATE_COMPLETE!==e.readyState)break;e.data.buffer.fileStart=e.fileStart,this.kernel.media.appendBuffer(e.data.buffer,void 0,e.video),!1===this.kernel.share&&(e.readyState=k.CHUNK_STATE_INIT,delete e.data)}},w.prototype.getCurrentFileKey=function(){var e=this.chunks[this.getIndex];if(void 0!==e)return e.report.code},w.prototype.getCompleteChunk=function(e,t){if(0>t||this.chunks.length<=t)return null;var i=this.chunks[t];return k.CHUNK_STATE_COMPLETE!==i.readyState?null:i},w.prototype.seek=function(e,t){var i,n;for(i=e.chunkIndex;i<this.chunks.length&&!(t<=(n=this.chunks[i]).fileStart+n.size);i++);this.minCompleteIndex=i,this.currentVideoIndex=e.index,this.getIndex=i,this.appendBuffer(),k.CHUNK_STATE_COMPLETE!==n.readyState&&(this.kernel.downloader.lowerCDN=null,this.kernel.downloader.lastUseCDNTime=0,this.kernel.downloader.intervalCDNTime=0,this.kernel.downloader.check(z.getMillisecond(),!0))},w.prototype.setDisplayBegin=function(e){this.kernel.isTest&&(this.displayCDNSize=0,this.displayPeerSize=0,this.display+="<div>",this.display+="<table>",this.display+="<tr><td>",this.display+='<div class="s80blank"></div>',this.display+='<div class="sundown"></div><label class="slabel">blank</label><div class="s10blank"></div>',this.display+='<div class="scdndown"></div><label class="slabel">cdn</label><div class="s10blank"></div>',this.display+='<div class="speerdown"></div><label class="slabel">peer</label><div class="s10blank"></div>',this.display+='<div class="smixturedown"></div><label class="slabel">mixture</label><div class="s180blank"></div>',this.display+='<label class="slabel">total:</label><div class="s10blank"></div><label id="stotal" class="slabel">'+e.totalSize+"</label>",this.display+='<div class="s20blank"></div>',this.display+='<label class="slabel">cdn:</label><div class="s10blank"></div><label id="scdn" class="slabel">0</label>',this.display+='<div class="s20blank"></div>',this.display+='<label class="slabel">peer:</label><div class="s10blank"></div><label id="speer" class="slabel">0</label>',this.display+="</td></tr><tr><td>",this.reportCount=0)},w.prototype.setDisplay=function(e){this.kernel.isTest&&(this.reportCount++,this.display+="<div id="+e+' class="undown"></div><div class="rightblank"></div>',0==this.reportCount%110&&(this.display+="<br>"))},w.prototype.setDisplayEnd=function(){this.kernel.isTest&&(this.display+="</td></tr>",this.display+="</table>",this.display+="</div>")};var k=function e(){this.readyState=e.CHUNK_STATE_INIT};k.CHUNK_STATE_INIT=0,k.CHUNK_STATE_DOWNING=1,k.CHUNK_STATE_COMPLETE=2,k.TEST_DISPLAY_TYPE_CDN=1,k.TEST_DISPLAY_TYPE_PEER=2,k.TEST_DISPLAY_TYPE_MIXTURE=3,k.prototype.completeByCDN=function(){this.display&&(this.display.type|=k.TEST_DISPLAY_TYPE_CDN,this.manager.displayCDNSize+=this.size,void 0===this.manager.displayCDNLabel&&(this.manager.displayCDNLabel=document.getElementById("scdn")),this.manager.displayCDNLabel.innerText=this.manager.displayCDNSize),this.manager.kernel.dmStat.cdn+=this.size,this.manager.completeChunk(this.index)},k.prototype.completeByPeer=function(){this.display&&(this.display.type|=k.TEST_DISPLAY_TYPE_PEER,this.manager.displayPeerSize+=this.size,void 0===this.manager.displayPeerLabel&&(this.manager.displayPeerLabel=document.getElementById("speer")),this.manager.displayPeerLabel.innerText=this.manager.displayPeerSize),this.manager.kernel.downloader.dataPeerSize+=this.size,this.manager.kernel.dmStat.peer+=this.size,this.manager.completeChunk(this.index)};var x=function(e){this.kernel=e,this.close()};x.START_LEVEL=30,x.DOWNLOAD_CDN_SIZE=1572864,x.prototype.close=function(){this.downloadPeers&&this.releaseAllPeer(),this.downloadPeers=[],this.downloadPeerCount=0,this.waitGetPeerTime=0,this.beginPeerTime=0,this.dataPeerSize=0,this.averagePeerSpeed=0,this.averagePeerSpeedAry=[],this.downloadCDNs&&this.releaseAllCDN(),this.downloadCDNs=[],this.cdnID=0,this.lastUseCDNTime=0,this.intervalCDNTime=0,this.cdn_level=z.MIN_DOWNLOAD_SECONDS,this.cdn_speed=5e5,this.isCheck=!0,this.oldCurtime=0,this.oldCdnNid="",this.autoSeekIdx=2,this.onendTimeout=0},x.prototype.start=function(){var e=x.START_LEVEL*this.kernel.media.rate;this.downloadFromCDN(e)},x.prototype.downloadFromCDN=function(e){for(var t,i=void 0,n=[],r=x.DOWNLOAD_CDN_SIZE;e>0&&(e<r&&(r=e),0!==(t=this.kernel.fileManager.getChunkBySize(r)).length);)if((i=new S).id=this.cdnID++,i.chunks=t,i.isRange=!0,i.create=z.getMillisecond(),this.downloadCDNs[i.id]=i,this.lastUseCDNTime=i.create,this.intervalCDNTime+=t.length*w.PEER_CHUNK_SIZE/this.kernel.media.rate,e-=x.DOWNLOAD_CDN_SIZE,void 0==n[t[0].video.dispatch]){var a={};a.video=t[0].video,a.loaders=[],a.loaders.push(i),n[t[0].video.dispatch]=a}else n[t[0].video.dispatch].loaders.push(i);if(i){var s=this.oldCdnNid;for(var o in n)S.dispatchByVideo(n[o].video,n[o].loaders,this,s);return this.oldCdnNid="",!0}return!1},x.prototype.checkCDNLoad=function(e){if(this.downloadCDNs[e.id]){var t=this.downloadCDNs[e.id].chunks[0].video.cdn_nid.toString();for(var i in""==this.oldCdnNid?this.oldCdnNid=t:-1==this.oldCdnNid.indexOf(t)&&(this.oldCdnNid+=","+t),delete this.downloadCDNs[e.id],this.downloadCDNs)return!0;return this.lastUseCDNTime=0,this.intervalCDNTime=0,this.downloadCDNs=[],!0}return!1},x.prototype.onDownloadCDN=function(e,t){if(!1!==this.checkCDNLoad(e)){if(this.cdn_speed=t.byteLength/(z.getMillisecond()-e.create),this.cdn_speed*=1e3,this.kernel.media.rate>this.cdn_speed){var i="cdn_error 1000 "+this.kernel.media.rate+" "+this.cdn_speed+" "+e.url;this.kernel.tracker.sendStat(i),this.kernel.sendLog(i,"warn"),this.onDownloadCDNFailed(e)}else if(this.downloadCDNs[e.id]){var n=this.downloadCDNs[e.id].chunks[0].video.cdn_nid.toString();-1!=this.oldCdnNid.indexOf(n)&&(this.oldCdnNid="")}for(var r=0,s=0;s<e.chunks.length;s++){var o=e.chunks[s];o.data=new Uint8Array(o.size),a.DataStream.memcpy(o.data.buffer,0,t,r,o.size),r+=o.size,o.codetype="cdn",o.code=String(P.getCode(o.data)),o.completeByCDN()}}},x.prototype.setCDNRange=function(e,t){var i=S.getRange(e.chunks);t.setRequestHeader("Range","bytes="+i.start+"-"+(i.end-1))},x.prototype.onDownloadCDNFailed=function(e){e.error&&this.kernel.tracker.sendStat(e.error),!1!==this.checkCDNLoad(e)&&this.releaseChunks(e)},x.prototype.releaseAllCDN=function(){for(var e in this.downloadCDNs)this.releaseChunks(this.downloadCDNs[e]);this.downloadCDNs=[],this.lastUseCDNTime=0,this.intervalCDNTime=0},x.prototype.releaseChunks=function(e){for(var t=0;t<e.chunks.length;t++)this.kernel.fileManager.lostChunk(e.chunks[t].index)},x.prototype.clearPeerLoad=function(e){this.downloadPeers[e.id]&&(delete this.downloadPeers[e.id],this.downloadPeerCount--)},x.prototype.addPeer=function(e){return!this.downloadPeers[e.id]&&(!(z.MAX_DOWNLOAD_PEER_COUNT<this.downloadPeerCount)&&(this.downloadPeers[e.id]=e,this.downloadPeerCount++,0===this.beginPeerTime&&(this.beginPeerTime=z.getMillisecond()),!0))},x.prototype.releaseAllPeer=function(){for(var e in this.downloadPeers){this.downloadPeers[e].close()}this.downloadPeers=[],this.downloadPeerCount=0},x.prototype.getAveragePeerSpeed=function(e){var t=e-this.beginPeerTime;return 0===t&&(t=1),(this.averagePeerSpeed+this.dataPeerSize/t*1e3)/2},x.prototype.paused=function(){this.oldCurtime=0,this.autoSeekIdx=2},x.prototype.check=function(e,t){if(!1!==this.isCheck){if(this.kernel.media.video.paused||this.kernel.isSeeked||(0!=this.oldCurtime&&this.oldCurtime==this.kernel.media.video.currentTime?this.autoSeekIdx?this.autoSeekIdx--:(this.autoSeekIdx=2,this.oldCurtime+=2.5,this.kernel.seek(this.oldCurtime)):(this.autoSeekIdx=2,this.oldCurtime=this.kernel.media.video.currentTime)),0!==this.beginPeerTime&&6e4<e-this.beginPeerTime){5<this.averagePeerSpeedAry.length&&this.averagePeerSpeedAry.splice(0,1);var i=this.dataPeerSize/(e-this.beginPeerTime)*1e3;this.averagePeerSpeedAry.push(i);for(var n=0,r=0;r<this.averagePeerSpeedAry.length;r++)n+=this.averagePeerSpeedAry[r];this.averagePeerSpeed=n/this.averagePeerSpeedAry.length,this.dataPeerSize=0,this.beginPeerTime=e}var a=0;if(t||0===this.downloadCDNs.length&&this.intervalCDNTime<=e-this.lastUseCDNTime&&void 0!==this.sb&&!1===this.sb.updating){var s=this.kernel.media.getSurplusDuration(),o=z.MAX_DOWNLOAD_SECONDS;if(0!==(i=this.getAveragePeerSpeed(e))){var l=i/this.kernel.media.rate;o=this.cdn_level*(1/l)*1.6,z.MIN_DOWNLOAD_SECONDS>o?o=z.MIN_DOWNLOAD_SECONDS:z.MAX_DOWNLOAD_SECONDS<o&&(o=z.MAX_DOWNLOAD_SECONDS)}if(a=z.STANDARD_DOWNLOAD_SECONDS+o*this.kernel.media.rate/this.cdn_speed,Math.ceil(a)>=Math.floor(s)){this.releaseAllPeer(),this.waitGetPeerTime=0,this.releaseAllCDN();var u=o*this.kernel.media.rate;if(!1===this.downloadFromCDN(u)&&this.kernel.media.video.currentTime+1.2>=this.kernel.media.mp4box.movieTime){if(1.5>s&&this.kernel.fileManager.currentVideoIndex===this.kernel.fileManager.videos.length){var d="play over, call mediaSource.endOfStream()  currentTime\uff1a"+this.kernel.media.video.currentTime+" movieTime:"+this.kernel.media.mp4box.movieTime;this.kernel.sendLog(d,"info"),"open"===this.kernel.media.mediaSource.readyState&&this.kernel.media.mediaSource.endOfStream();var c=this.kernel.media.mp4box.movieTime-this.kernel.media.video.currentTime;c=1e3*c+200,this.onendTimeout=setTimeout(this.kernel.onEndedMth.bind(this.kernel),c>0?Math.ceil(c):0),this.isCheck=!1}return}}}if(!0===this.kernel.isWebrtc&&z.MAX_DOWNLOAD_PEER_COUNT>this.downloadPeerCount&&5e3<e-this.waitGetPeerTime){this.waitGetPeerTime=e;var h=this.kernel.fileManager.getCurrentFileKey();h&&this.kernel.tracker.sendGetPeer(h)}if(0!==a)for(var r in a*=2,this.downloadPeers){var p=this.downloadPeers[r];!1===p.checkDownload(e,a)&&p.close()}}};var S=function(){};S.prototype.dispatchByUrl=function(e,t){var i=this,n=new XMLHttpRequest;n.open("GET",e,!0),t.kernel.sendLog("request dispatch "+e),n.timeout=3e3,n.ontimeout=function(){i.error="dispatch_error 701 "+e,console.warn(z.getTimeNow(),i.error+" timeout"),t.kernel.sendLog(i.error)},n.send(),n.onerror=function(n){t.kernel.reportError(701,"dispatch timeout"),i.error="dispatch_error 701 timeout "+e,t.kernel.sendLog(i.error),t.onDownloadCDNFailed(i)},n.onreadystatechange=function(r){if(n.readyState==this.DONE)if(200==n.status||206==n.status||304==n.status||416==n.status)try{var a=JSON.parse(n.response);i.download(a.servers[0].url,t)}catch(e){t.kernel.reportError(704,"error invalid json"),t.kernel.sendLog("dipatch failed, "+e.message),t.onDownloadCDNFailed(i)}else 0==n.status?(t.kernel.reportError(701,"dispatch timeout"),i.error="dispatch_error 701 timeout "+n.status+" "+e):(t.kernel.reportError(704,"http error "+n.status.toString()),i.error="dispatch_error "+n.status+" "+e),t.kernel.sendLog(i.error),t.onDownloadCDNFailed(i)}},S.dispatchByVideo=function(e,t,i,n){var r=z.getMillisecond();if(e.cdn_url&&3e5>r-e.cdn_url_cache)for(var a in t)t[a].download(e.cdn_url,i);else{var s=e.dispatch+(""==n?"":"&idc="+n);i.kernel.sendLog("request dispatch: "+s);var o=new XMLHttpRequest;o.open("GET",s,!0),o.timeout=5e3,o.ontimeout=function(e){var t="dispatch_error 701 timeout"+s;i.kernel.sendLog(t)},o.send(),o.onerror=function(e){var n;for(var r in i.kernel.reportError(701,"dispatch timeout"),t)(n=t[r]).error="dispatch_error 701 timeout "+s,i.kernel.sendLog(n.error),i.onDownloadCDNFailed(n)},o.onreadystatechange=function(n){if(o.readyState==this.DONE)if(200==o.status||206==o.status||304==o.status||416==o.status)try{var a=JSON.parse(o.response);for(var l in t)t[l].download(a.servers[0].url,i);e.cdn_url=a.servers[0].url,e.cdn_url_cache=r,e.cdn_nid=a.servers[0].nid}catch(e){var u;for(var l in i.kernel.reportError(704,"error invalid json"),t)u=t[l],i.kernel.sendLog("dipatch failed, "+e.message),i.onDownloadCDNFailed(u)}else for(var l in t)u=t[l],0==o.status?(i.kernel.reportError(701,"dispatch timeout"),u.error="dispatch_error 701 timeout "+o.status+" "+s):(i.kernel.reportError(704,"error http "+o.status.toString()),u.error="dispatch_error "+o.status+" "+s),i.kernel.sendLog(u.error),i.onDownloadCDNFailed(u)}}},S.prototype.download=function(e,t){e=e,t.kernel.setCdnIP(e);var i=this;i.url=e;var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",i.isRange&&t.setCDNRange(i,n),n.timeout=18e4,n.send(),n.onerror=function(n){i.error="cdn_error 801 timeout "+e,t.kernel.sendLog(i.error),t.kernel.reportError(801,"cdn timeout"),t.onDownloadCDNFailed(i)},n.onreadystatechange=function(r){n.readyState==this.DONE&&(200==n.status||206==n.status||304==n.status||416==n.status?t.onDownloadCDN(i,n.response):(0==n.status?(i.error="cdn_error 801 timeout "+n.status+" "+e,t.kernel.sendLog(i.error),t.kernel.reportError(801,"cdn timeout")):(i.error="cdn_error "+n.status+" "+e,t.kernel.sendLog(i.error),t.kernel.reportError(804,"error http "+n.status.toString())),t.onDownloadCDNFailed(i)))}},S.getRange=function(e){var t=e[0].fileStart,i=e[e.length-1];return{start:t,end:i.fileStart+i.size}};var E=function(e){this.kernel=e,this.close()};E.prototype.close=function(){this.uploadPeers=[],this.uploadPeerCount=0},E.prototype.addPeer=function(e){return!this.uploadPeers[e.id]&&(!(z.MAX_UPLOAD_PEER_COUNT<this.uploadPeerCount)&&(this.uploadPeers[e.id]=e,this.uploadPeerCount++,!0))},E.prototype.clearPeerLoad=function(e){this.uploadPeers&&this.uploadPeers[e.id]&&(delete this.uploadPeers[e.id],this.uploadPeerCount--)};var T="00000000\xa077073096\xa0EE0E612C\xa0990951BA\xa0076DC419\xa0706AF48F\xa0E963A535\xa09E6495A3\xa00EDB8832\xa079DCB8A4\xa0E0D5E91E\xa097D2D988\xa009B64C2B\xa07EB17CBD\xa0E7B82D07\xa090BF1D91\xa01DB71064\xa06AB020F2\xa0F3B97148\xa084BE41DE\xa01ADAD47D\xa06DDDE4EB\xa0F4D4B551\xa083D385C7\xa0136C9856\xa0646BA8C0\xa0FD62F97A\xa08A65C9EC\xa014015C4F\xa063066CD9\xa0FA0F3D63\xa08D080DF5\xa03B6E20C8\xa04C69105E\xa0D56041E4\xa0A2677172\xa03C03E4D1\xa04B04D447\xa0D20D85FD\xa0A50AB56B\xa035B5A8FA\xa042B2986C\xa0DBBBC9D6\xa0ACBCF940\xa032D86CE3\xa045DF5C75\xa0DCD60DCF\xa0ABD13D59\xa026D930AC\xa051DE003A\xa0C8D75180\xa0BFD06116\xa021B4F4B5\xa056B3C423\xa0CFBA9599\xa0B8BDA50F\xa02802B89E\xa05F058808\xa0C60CD9B2\xa0B10BE924\xa02F6F7C87\xa058684C11\xa0C1611DAB\xa0B6662D3D\xa076DC4190\xa001DB7106\xa098D220BC\xa0EFD5102A\xa071B18589\xa006B6B51F\xa09FBFE4A5\xa0E8B8D433\xa07807C9A2\xa00F00F934\xa09609A88E\xa0E10E9818\xa07F6A0DBB\xa0086D3D2D\xa091646C97\xa0E6635C01\xa06B6B51F4\xa01C6C6162\xa0856530D8\xa0F262004E\xa06C0695ED\xa01B01A57B\xa08208F4C1\xa0F50FC457\xa065B0D9C6\xa012B7E950\xa08BBEB8EA\xa0FCB9887C\xa062DD1DDF\xa015DA2D49\xa08CD37CF3\xa0FBD44C65\xa04DB26158\xa03AB551CE\xa0A3BC0074\xa0D4BB30E2\xa04ADFA541\xa03DD895D7\xa0A4D1C46D\xa0D3D6F4FB\xa04369E96A\xa0346ED9FC\xa0AD678846\xa0DA60B8D0\xa044042D73\xa033031DE5\xa0AA0A4C5F\xa0DD0D7CC9\xa05005713C\xa0270241AA\xa0BE0B1010\xa0C90C2086\xa05768B525\xa0206F85B3\xa0B966D409\xa0CE61E49F\xa05EDEF90E\xa029D9C998\xa0B0D09822\xa0C7D7A8B4\xa059B33D17\xa02EB40D81\xa0B7BD5C3B\xa0C0BA6CAD\xa0EDB88320\xa09ABFB3B6\xa003B6E20C\xa074B1D29A\xa0EAD54739\xa09DD277AF\xa004DB2615\xa073DC1683\xa0E3630B12\xa094643B84\xa00D6D6A3E\xa07A6A5AA8\xa0E40ECF0B\xa09309FF9D\xa00A00AE27\xa07D079EB1\xa0F00F9344\xa08708A3D2\xa01E01F268\xa06906C2FE\xa0F762575D\xa0806567CB\xa0196C3671\xa06E6B06E7\xa0FED41B76\xa089D32BE0\xa010DA7A5A\xa067DD4ACC\xa0F9B9DF6F\xa08EBEEFF9\xa017B7BE43\xa060B08ED5\xa0D6D6A3E8\xa0A1D1937E\xa038D8C2C4\xa04FDFF252\xa0D1BB67F1\xa0A6BC5767\xa03FB506DD\xa048B2364B\xa0D80D2BDA\xa0AF0A1B4C\xa036034AF6\xa041047A60\xa0DF60EFC3\xa0A867DF55\xa0316E8EEF\xa04669BE79\xa0CB61B38C\xa0BC66831A\xa0256FD2A0\xa05268E236\xa0CC0C7795\xa0BB0B4703\xa0220216B9\xa05505262F\xa0C5BA3BBE\xa0B2BD0B28\xa02BB45A92\xa05CB36A04\xa0C2D7FFA7\xa0B5D0CF31\xa02CD99E8B\xa05BDEAE1D\xa09B64C2B0\xa0EC63F226\xa0756AA39C\xa0026D930A\xa09C0906A9\xa0EB0E363F\xa072076785\xa005005713\xa095BF4A82\xa0E2B87A14\xa07BB12BAE\xa00CB61B38\xa092D28E9B\xa0E5D5BE0D\xa07CDCEFB7\xa00BDBDF21\xa086D3D2D4\xa0F1D4E242\xa068DDB3F8\xa01FDA836E\xa081BE16CD\xa0F6B9265B\xa06FB077E1\xa018B74777\xa088085AE6\xa0FF0F6A70\xa066063BCA\xa011010B5C\xa08F659EFF\xa0F862AE69\xa0616BFFD3\xa0166CCF45\xa0A00AE278\xa0D70DD2EE\xa04E048354\xa03903B3C2\xa0A7672661\xa0D06016F7\xa04969474D\xa03E6E77DB\xa0AED16A4A\xa0D9D65ADC\xa040DF0B66\xa037D83BF0\xa0A9BCAE53\xa0DEBB9EC5\xa047B2CF7F\xa030B5FFE9\xa0BDBDF21C\xa0CABAC28A\xa053B39330\xa024B4A3A6\xa0BAD03605\xa0CDD70693\xa054DE5729\xa023D967BF\xa0B3667A2E\xa0C4614AB8\xa05D681B02\xa02A6F2B94\xa0B40BBE37\xa0C30C8EA1\xa05A05DF1B\xa02D02EF8D";var P=function(){};P.getCode=function(e){return function(e,t){t==window.undefined&&(t=0);var i=0;t^=-1;for(var n=0,r=e.length;n<r;n++)i=255&(t^e.charCodeAt(n)),t=t>>>8^"0x"+T.substr(9*i,8);return-1^t}(function(e){var t,i,n,r,a,s;for(t="",n=e.length,i=0;i<n;)switch((r=e[i++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=String.fromCharCode(r);break;case 12:case 13:a=e[i++],t+=String.fromCharCode((31&r)<<6|63&a);break;case 14:a=e[i++],s=e[i++],t+=String.fromCharCode((15&r)<<12|(63&a)<<6|(63&s)<<0)}return t}(e)).toString(16)};var A=null,C=null,D=null,L={log:function(){},extractVersion:function(e,t,i){var n=e.match(t);return n&&n.length>=i&&parseInt(n[i],10)}};if("object"===("undefined"==typeof window?"undefined":n(window))&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return"mozSrcObject"in this?this.mozSrcObject:this._srcObject},set:function(e){"mozSrcObject"in this?this.mozSrcObject=e:(this._srcObject=e,this.src=URL.createObjectURL(e))}}),A=window.navigator&&window.navigator.getUserMedia),function(e,t){e.srcObject=t},function(e,t){e.srcObject=t.srcObject},"undefined"!=typeof window&&window.navigator)if(navigator.mozGetUserMedia){if(L.log("This appears to be Firefox"),C="firefox",D=L.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1),31,window.RTCPeerConnection||(window.RTCPeerConnection=function(e,t){if(D<38&&e&&e.iceServers){for(var i=[],n=0;n<e.iceServers.length;n++){var r=e.iceServers[n];if(r.hasOwnProperty("urls"))for(var a=0;a<r.urls.length;a++){var s={url:r.urls[a]};0===r.urls[a].indexOf("turn")&&(s.username=r.username,s.credential=r.credential),i.push(s)}else i.push(e.iceServers[n])}e.iceServers=i}return new mozRTCPeerConnection(e,t)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return arguments.length?mozRTCPeerConnection.generateCertificate.apply(null,arguments):mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),A=function(e,t,i){var r=function(e){if("object"!==(void 0===e?"undefined":n(e))||e.require)return e;var t=[];return Object.keys(e).forEach(function(i){if("require"!==i&&"advanced"!==i&&"mediaSource"!==i){var r=e[i]="object"===n(e[i])?e[i]:{ideal:e[i]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||t.push(i),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[i]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var a={};"number"==typeof r.ideal?a[i]={min:r.ideal,max:r.ideal}:a[i]=r.ideal,e.advanced.push(a),delete r.ideal,Object.keys(r).length||delete e[i]}}}),t.length&&(e.require=t),e};return D<38&&(L.log("spec: "+JSON.stringify(e)),e.audio&&(e.audio=r(e.audio)),e.video&&(e.video=r(e.video)),L.log("ff37: "+JSON.stringify(e))),navigator.mozGetUserMedia(e,t,i)},navigator.getUserMedia=A,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:F,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},D<41){var B=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return B().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}}else if(navigator.webkitGetUserMedia&&window.webkitRTCPeerConnection){L.log("This appears to be Chrome"),C="chrome",D=L.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),38,window.RTCPeerConnection=function(e,t){e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy);var i=new webkitRTCPeerConnection(e,t),n=i.getStats.bind(i);return i.getStats=function(e,t,i){var r=this,a=arguments;if(arguments.length>0&&"function"==typeof e)return n(e,t);var s=function(e){var t={};return e.result().forEach(function(e){var i={id:e.id,timestamp:e.timestamp,type:e.type};e.names().forEach(function(t){i[t]=e.stat(t)}),t[i.id]=i}),t};if(arguments.length>=2){return n.apply(this,[function(e){a[1](s(e))},arguments[0]])}return new Promise(function(t,i){1===a.length&&null===e?n.apply(r,[function(e){t.apply(null,[s(e)])},i]):n.apply(r,[t,i])})},i},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return arguments.length?webkitRTCPeerConnection.generateCertificate.apply(null,arguments):webkitRTCPeerConnection.generateCertificate}}),["createOffer","createAnswer"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"===n(arguments[0])){var i=1===arguments.length?arguments[0]:void 0;return new Promise(function(n,r){t.apply(e,[n,r,i])})}return t.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=arguments,i=this;return new Promise(function(n,r){t.apply(i,[e[0],function(){n(),e.length>=2&&e[1].apply(null,[])},function(t){r(t),e.length>=3&&e[2].apply(null,[t])}])})}});var O=function(e){if("object"!==(void 0===e?"undefined":n(e))||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(i){if("require"!==i&&"advanced"!==i&&"mediaSource"!==i){var r="object"===n(e[i])?e[i]:{ideal:e[i]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var a=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var s={};"number"==typeof r.ideal?(s[a("min",i)]=r.ideal,t.optional.push(s),(s={})[a("max",i)]=r.ideal,t.optional.push(s)):(s[a("",i)]=r.ideal,t.optional.push(s))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[a("",i)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[a(e,i)]=r[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t};if(A=function(e,t,i){return e.audio&&(e.audio=O(e.audio)),e.video&&(e.video=O(e.video)),L.log("chrome: "+JSON.stringify(e)),navigator.webkitGetUserMedia(e,t,i)},navigator.getUserMedia=A,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:F,enumerateDevices:function(){return new Promise(function(e){var t={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(i){e(i.map(function(e){return{label:e.label,kind:t[e.kind],deviceId:e.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){var M=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return L.log("spec:   "+JSON.stringify(e)),e.audio=O(e.audio),e.video=O(e.video),L.log("chrome: "+JSON.stringify(e)),M(e)}}else navigator.mediaDevices.getUserMedia=function(e){return F(e)};void 0===navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){L.log("Dummy mediaDevices.addEventListener called.")}),void 0===navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){L.log("Dummy mediaDevices.removeEventListener called.")}),function(e,t){D>=43?e.srcObject=t:void 0!==e.src?e.src=URL.createObjectURL(t):L.log("Error attaching stream to element.")},function(e,t){D>=43?e.srcObject=t.srcObject:e.src=t.src}}else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)){if(L.log("This appears to be Edge"),C="edge",D=L.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),10547,window.RTCIceGatherer){var U=function(){return Math.random().toString(36).substr(2,10)},I=U(),R={splitLines:function(e){return e.trim().split("\n").map(function(e){return e.trim()})},splitSections:function(e){return e.split("\r\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},matchPrefix:function(e,t){return R.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},parseCandidate:function(e){for(var t,i={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":i.relatedAddress=t[n+1];break;case"rport":i.relatedPort=parseInt(t[n+1],10);break;case"tcptype":i.tcpType=t[n+1]}return i},writeCandidate:function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),"candidate:"+t.join(" ")},parseRtpMap:function(e){var t=e.substr(9).split(" "),i={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),i.name=t[0],i.clockRate=parseInt(t[1],10),i.numChannels=3===t.length?parseInt(t[2],10):1,i},writeRtpMap:function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},parseFmtp:function(e){for(var t,i={},n=e.substr(e.indexOf(" ")+1).split(";"),r=0;r<n.length;r++)i[(t=n[r].trim().split("="))[0].trim()]=t[1];return i},writeFtmp:function(e){var t="",i=e.payloadType;if(void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.parameters&&e.parameters.length){var n=[];Object.keys(e.parameters).forEach(function(t){n.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+i+" "+n.join(";")+"\r\n"}return t},parseRtcpFb:function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},writeRtcpFb:function(e){var t="",i=e.payloadType;return void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+i+" "+e.type+" "+e.parameter+"\r\n"}),t},parseSsrcMedia:function(e){var t=e.indexOf(" "),i={ssrc:e.substr(7,t-7)},n=e.indexOf(":",t);return n>-1?(i.attribute=e.substr(t+1,n-t-1),i.value=e.substr(n+1)):i.attribute=e.substr(t+1),i},getDtlsParameters:function(e,t){var i=R.splitLines(e),n=(i=i.concat(R.splitLines(t))).filter(function(e){return 0===e.indexOf("a=fingerprint:")})[0].substr(14);return{role:"auto",fingerprints:[{algorithm:n.split(" ")[0],value:n.split(" ")[1]}]}},writeDtlsParameters:function(e,t){var i="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){i+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),i},getIceParameters:function(e,t){var i=R.splitLines(e);return{usernameFragment:(i=i.concat(R.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:i.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},writeIceParameters:function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},parseRtpParameters:function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=R.splitLines(e)[0].split(" "),n=3;n<i.length;n++){var r=i[n],a=R.matchPrefix(e,"a=rtpmap:"+r+" ")[0];if(a){var s=R.parseRtpMap(a),o=R.matchPrefix(e,"a=fmtp:"+r+" ");s.parameters=o.length?R.parseFmtp(o[0]):{},s.rtcpFeedback=R.matchPrefix(e,"a=rtcp-fb:"+r+" ").map(R.parseRtcpFb),t.codecs.push(s)}}return t},writeRtpDescription:function(e,t){var i="";return i+="m="+e+" ",i+=t.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){i+=R.writeRtpMap(e),i+=R.writeFtmp(e),i+=R.writeRtcpFb(e)}),i+="a=rtcp-mux\r\n"},writeSessionBoilerplate:function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},writeMediaSection:function(e,t,i,n){var r=R.writeRtpDescription(e.kind,t);if(r+=R.writeIceParameters(e.iceGatherer.getLocalParameters()),r+=R.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":"active"),r+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?r+="a=sendrecv\r\n":e.rtpSender?r+="a=sendonly\r\n":e.rtpReceiver?r+="a=recvonly\r\n":r+="a=inactive\r\n",e.rtpSender){var a="msid:"+n.id+" "+e.rtpSender.track.id+"\r\n";r+="a="+a,r+="a=ssrc:"+e.sendSsrc+" "+a}return r+="a=ssrc:"+e.sendSsrc+" cname:"+I+"\r\n"},getDirection:function(e,t){for(var i=R.splitLines(e),n=0;n<i.length;n++)switch(i[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[n].substr(2)}return t?R.getDirection(t):"sendrecv"}};window.RTCIceCandidate||(window.RTCIceCandidate=function(e){return e}),window.RTCSessionDescription||(window.RTCSessionDescription=function(e){return e}),window.RTCPeerConnection=function(e){var t=this;if(this.onicecandidate=null,this.onaddstream=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return t.localStreams},this.getRemoteStreams=function(){return t.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},e&&e.iceTransportPolicy)switch(e.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=e.iceTransportPolicy;break;case"none":throw new TypeError('iceTransportPolicy "none" not supported')}e&&e.iceServers&&e.iceServers.forEach(function(e){var i;e.urls&&(-1!==(i="string"==typeof e.urls?e.urls:e.urls[0]).indexOf("transport=udp")&&t.iceServers.push({username:e.username,credential:e.credential,urls:i}))}),this.transceivers=[],this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var e=this;this._localIceCandidatesBuffer.forEach(function(t){null!==e.onicecandidate&&e.onicecandidate(t)}),this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype.addStream=function(e){this.localStreams.push(e.clone()),this._maybeFireNegotiationNeeded()},window.RTCPeerConnection.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},window.RTCPeerConnection.prototype._getCommonCapabilities=function(e,t){var i={codecs:[],headerExtensions:[],fecMechanisms:[]};return e.codecs.forEach(function(e){for(var n=0;n<t.codecs.length;n++){var r=t.codecs[n];if(e.name.toLowerCase()===r.name.toLowerCase()&&e.clockRate===r.clockRate&&e.numChannels===r.numChannels){i.codecs.push(r);break}}}),e.headerExtensions.forEach(function(e){for(var n=0;n<t.headerExtensions.length;n++){var r=t.headerExtensions[n];if(e.uri===r.uri){i.headerExtensions.push(r);break}}}),i},window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(e,t){var i=this,n=new RTCIceGatherer(i.iceOptions),r=new RTCIceTransport(n);n.onlocalcandidate=function(a){var s={};s.candidate={sdpMid:e,sdpMLineIndex:t};var o=a.candidate;o&&0!==Object.keys(o).length?(o.component="RTCP"===r.component?2:1,s.candidate.candidate=R.writeCandidate(o)):(void 0===n.state&&(n.state="completed"),s.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates");var l=i.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});null!==i.onicecandidate&&(i.localDescription&&""===i.localDescription.type?(i._localIceCandidatesBuffer.push(s),l&&i._localIceCandidatesBuffer.push({})):(i.onicecandidate(s),l&&i.onicecandidate({})))},r.onicestatechange=function(){i._updateConnectionState()};var a=new RTCDtlsTransport(r);return a.ondtlsstatechange=function(){i._updateConnectionState()},a.onerror=function(){a.state="failed",i._updateConnectionState()},{iceGatherer:n,iceTransport:r,dtlsTransport:a}},window.RTCPeerConnection.prototype._transceive=function(e,t,i){var n=this._getCommonCapabilities(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(n.encodings=[{ssrc:e.sendSsrc}],n.rtcp={cname:I,ssrc:e.recvSsrc},e.rtpSender.send(n)),i&&e.rtpReceiver&&(n.encodings=[{ssrc:e.recvSsrc}],n.rtcp={cname:e.cname,ssrc:e.sendSsrc},e.rtpReceiver.receive(n))},window.RTCPeerConnection.prototype.setLocalDescription=function(e){var t=this;if("offer"===e.type)this._pendingOffer&&(this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===e.type){var i=R.splitSections(t.remoteDescription.sdp),n=i.shift();i.forEach(function(e,i){var r=t.transceivers[i],a=r.iceGatherer,s=r.iceTransport,o=r.dtlsTransport,l=r.localCapabilities,u=r.remoteCapabilities;if(!("0"===e.split("\n",1)[0].split(" ",2)[1])){var d=R.getIceParameters(e,n);s.start(a,d,"controlled");var c=R.getDtlsParameters(e,n);o.start(c);var h=t._getCommonCapabilities(l,u);t._transceive(r,h.codecs.length>0,!1)}})}switch(this.localDescription=e,e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var r=arguments.length>1&&"function"==typeof arguments[1];if(r){var a=arguments[1];window.setTimeout(function(){a(),t._emitBufferedCandidates()},0)}var s=Promise.resolve();return s.then(function(){r||window.setTimeout(t._emitBufferedCandidates.bind(t),0)}),s},window.RTCPeerConnection.prototype.setRemoteDescription=function(e){var t=this,i=new MediaStream,n=R.splitSections(e.sdp),r=n.shift();switch(n.forEach(function(n,a){var s,o,l,u,d,c,h,p,f,v,y,m=R.splitLines(n)[0].substr(2).split(" "),g=m[0],b="0"===m[1],_=R.getDirection(n,r),w=R.parseRtpParameters(n);b||(v=R.getIceParameters(n,r),y=R.getDtlsParameters(n,r));var k,x=R.matchPrefix(n,"a=mid:")[0].substr(6),S=R.matchPrefix(n,"a=ssrc:").map(function(e){return R.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];if(S&&(p=parseInt(S.ssrc,10),k=S.value),"offer"===e.type){var E=t._createIceAndDtlsTransports(x,a);if(f=RTCRtpReceiver.getCapabilities(g),h=1001*(2*a+2),c=new RTCRtpReceiver(E.dtlsTransport,g),i.addTrack(c.track),t.localStreams.length>0&&t.localStreams[0].getTracks().length>=a){var T=t.localStreams[0].getTracks()[a];d=new RTCRtpSender(T,E.dtlsTransport)}t.transceivers[a]={iceGatherer:E.iceGatherer,iceTransport:E.iceTransport,dtlsTransport:E.dtlsTransport,localCapabilities:f,remoteCapabilities:w,rtpSender:d,rtpReceiver:c,kind:g,mid:x,cname:k,sendSsrc:h,recvSsrc:p},t._transceive(t.transceivers[a],!1,"sendrecv"===_||"sendonly"===_)}else"answer"!==e.type||b||(o=(s=t.transceivers[a]).iceGatherer,l=s.iceTransport,u=s.dtlsTransport,d=s.rtpSender,c=s.rtpReceiver,h=s.sendSsrc,f=s.localCapabilities,t.transceivers[a].recvSsrc=p,t.transceivers[a].remoteCapabilities=w,t.transceivers[a].cname=k,l.start(o,v,"controlling"),u.start(y),t._transceive(s,"sendrecv"===_||"recvonly"===_,"sendrecv"===_||"sendonly"===_),!c||"sendrecv"!==_&&"sendonly"!==_?delete s.rtpReceiver:i.addTrack(c.track))}),this.remoteDescription=e,e.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}return window.setTimeout(function(){null!==t.onaddstream&&i.getTracks().length&&(t.remoteStreams.push(i),window.setTimeout(function(){t.onaddstream({stream:i})},0))},0),arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},window.RTCPeerConnection.prototype._updateSignalingState=function(e){this.signalingState=e,null!==this.onsignalingstatechange&&this.onsignalingstatechange()},window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){null!==this.onnegotiationneeded&&this.onnegotiationneeded()},window.RTCPeerConnection.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0||t.checking>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":(t.connecting>0||t.completed>0)&&(e="connected"),e!==this.iceConnectionState&&(this.iceConnectionState=e,null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange())},window.RTCPeerConnection.prototype.createOffer=function(){var e,t=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");1===arguments.length&&"function"!=typeof arguments[0]?e=arguments[0]:3===arguments.length&&(e=arguments[2]);var i=[],n=0,r=0;if(this.localStreams.length&&(n=this.localStreams[0].getAudioTracks().length,r=this.localStreams[0].getVideoTracks().length),e){if(e.mandatory||e.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==e.offerToReceiveAudio&&(n=e.offerToReceiveAudio),void 0!==e.offerToReceiveVideo&&(r=e.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(e){i.push({kind:e.kind,track:e,wantReceive:"audio"===e.kind?n>0:r>0}),"audio"===e.kind?n--:"video"===e.kind&&r--});n>0||r>0;)n>0&&(i.push({kind:"audio",wantReceive:!0}),n--),r>0&&(i.push({kind:"video",wantReceive:!0}),r--);var a=R.writeSessionBoilerplate(),s=[];i.forEach(function(e,i){var n,r,o=e.track,l=e.kind,u=U(),d=t._createIceAndDtlsTransports(u,i),c=RTCRtpSender.getCapabilities(l),h=1001*(2*i+1);o&&(n=new RTCRtpSender(o,d.dtlsTransport)),e.wantReceive&&(r=new RTCRtpReceiver(d.dtlsTransport,l)),s[i]={iceGatherer:d.iceGatherer,iceTransport:d.iceTransport,dtlsTransport:d.dtlsTransport,localCapabilities:c,remoteCapabilities:null,rtpSender:n,rtpReceiver:r,kind:l,mid:u,sendSsrc:h,recvSsrc:null};var p=s[i];a+=R.writeMediaSection(p,p.localCapabilities,"offer",t.localStreams[0])}),this._pendingOffer=s;var o=new RTCSessionDescription({type:"offer",sdp:a});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,o),Promise.resolve(o)},window.RTCPeerConnection.prototype.createAnswer=function(){var e=this;1===arguments.length&&"function"!=typeof arguments[0]?arguments[0]:3===arguments.length&&arguments[2];var t=R.writeSessionBoilerplate();this.transceivers.forEach(function(i){var n=e._getCommonCapabilities(i.localCapabilities,i.remoteCapabilities);t+=R.writeMediaSection(i,n,"answer",e.localStreams[0])});var i=new RTCSessionDescription({type:"answer",sdp:t});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,i),Promise.resolve(i)},window.RTCPeerConnection.prototype.addIceCandidate=function(e){var t=e.sdpMLineIndex;if(e.sdpMid)for(var i=0;i<this.transceivers.length;i++)if(this.transceivers[i].mid===e.sdpMid){t=i;break}var n=this.transceivers[t];if(n){var r=Object.keys(e.candidate).length>0?R.parseCandidate(e.candidate):{};if("tcp"===r.protocol&&0===r.port)return;if("1"!==r.component)return;"endOfCandidates"===r.type&&(r={}),n.iceTransport.addRemoteCandidate(r)}return arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(i){t[i]&&e.push(t[i].getStats())})});var t=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(i){var n={};Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){n[t]=e[t]})}),t&&window.setTimeout(t,0,n),i(n)})})}}}else L.log("Browser does not appear to be WebRTC-capable");else L.log("This does not appear to be a browser"),C="not a browser";function F(e){return new Promise(function(t,i){A(e,t,i)})}"object"!==("undefined"==typeof window?"undefined":n(window))||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){var t=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){"chrome"===C&&e.stream.addEventListener("addtrack",function(i){var n=new Event("track");n.track=i.track,n.receiver={track:i.track},n.streams=[e.stream],t.dispatchEvent(n)}),e.stream.getTracks().forEach(function(t){var i=new Event("track");i.track=t,i.receiver={track:t},i.streams=[e.stream],this.dispatchEvent(i)}.bind(this))}.bind(this))}});try{Object.defineProperty({},"version",{set:function(e){D=e}})}catch(e){}var z=function(e){function t(){o(this,t);var e=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.close(),e}return u(t,r.EventEmitter),t}();z.prototype.close=function(){this.timerID&&window.clearInterval(this.timerID),this.timerID=null,this.tracker&&this.tracker.close(),this.tracker=null,this.downloader&&this.downloader.close(),this.downloader=null,this.fileManager&&this.fileManager.close(),this.fileManager=null,this.media&&this.media.close(),this.media=null,this.uploader&&this.uploader.close(),this.uploader=null,this.platform="unkown",this.share=!0,this.dmStat={cdn:0,peer:0},this.last_dmStat={cdn:0,peer:0},this.qsStat={},this.myPublicIP="unkown",this.lastCdnIP="unkown",this.isSeeked=!1},z.prototype.initialize=function(e,t,i){return this.share=i,void 0===window.RTCPeerConnection&&void 0===window.mozRTCPeerConnection&&void 0===window.webkitRTCPeerConnection?(this.sendLog("your browser is not supported by webrtc","warn"),this.share=!1,this.isWebrtc=!1):this.isWebrtc=!0,void 0===e.isKernelEvent&&(e.isKernelEvent=!0,e.addEventListener("seeking",z.onSeeking.bind(this)),e.addEventListener("seeked",z.onSeeked.bind(this)),e.addEventListener("ended",z.onEnded.bind(this)),e.addEventListener("error",z.onError.bind(this))),this.platform=t,this.media=new g(this),this.fileManager=new w(this),this.media.initialize(e)},z.prototype.play=function(e){var t,i=this;if(this.timerID&&(window.clearInterval(this.timerID),this.timerID=null),void 0===e){this.downloader&&(this.downloader.isCheck=!0);var n=this.media.video.play();return n?n.then(function(){i.emit("playError",1),i.sendLog("play ok 1","info")}).catch(function(e){var t=i.media.video;i.sendLog("play fail "+e.code,"info"),0==e.code?(i.media.video.muted=!0,i.media.video.pause(),setTimeout(function(){t.play()},150),i.emit("playError",0)):setTimeout(function(){t.play()},150)}):(this.sendLog("play ok","info"),this.media.video.play()),this.downloader&&(this.timerID=window.setInterval(z.check.bind(this),500)),!0}if(!1===this.checkMovieInfo(e))return this.sendLog("This format of hot is error.","error"),!1;if(!1===this.fileManager.initialize(e))return!1;if(this.media.setMoiveDuration(e.totalDuration,e.totalSize),!e.videos[0].dispatch){t=e.videos[0].clipsURL;var r={};return r.url=t,r.ispause=e.isPause,this.media.play(r),!0}return void 0!==e.isPause&&!1!==e.isPause||this.media.play(),this.downloader=new x(this),this.downloader.start(),this.uploader=new E(this),_.ISWEBP2P=Number(e.iswebp2p),this.tracker=new _(this),this.tracker.connect(z.TRACKER_DOMAIN),this.media.video.paused||(this.timerID=window.setInterval(z.check.bind(this),500)),!0},z.prototype.seek=function(e){return 0<=e&&this.media.mp4box.movieTime>e&&(this.media.seeking=!0,this.media.video.currentTime=e,!0)},z.prototype.pause=function(){this.downloader?(this.downloader.isCheck=!1,this.downloader.beginPeerTime=0,this.downloader.dataPeerSize=0,this.downloader.averagePeerSpeed=0,this.downloader.averagePeerSpeedAry=[],this.downloader.releaseAllPeer(),this.downloader.releaseAllCDN(),this.media.video.pause(),this.timerID&&(window.clearInterval(this.timerID),this.timerID=null),this.downloader.paused()):this.media.video.pause()},z.prototype.getDMStat=function(){var e={},t=this.dmStat.cdn-this.last_dmStat.cdn,i=this.dmStat.peer-this.last_dmStat.peer;return this.last_dmStat.cdn=this.dmStat.cdn,this.last_dmStat.peer=this.dmStat.peer,e.cdn=t,e.total=t+i,e},z.prototype.change=function(e){return!1===this.checkMovieInfo(e)?(this.sendLog("This format of hot is error.","error"),!1):(delete this.fileManager,this.fileManager=new w(this),!1!==this.fileManager.initialize(e)&&(this.media.change(e),!0))},z.prototype.getPlayTime=function(){return this.media?this.media.video.currentTime:0},z.prototype.getTimeRanges=function(){var e=[];if(null===this.media)return e;for(var t,i,n=this.media.video,r=0;r<n.buffered.length;r++)t=n.buffered.start(r),i=n.buffered.end(r),e.push({start:t,end:i});return e},z.prototype.checkMovieInfo=function(e){if(void 0===e.vid||void 0===e.ch||void 0===e.videos)return!1;this.sendLog("start playing, vid is "+e.vid,"info"),e.totalDuration=0,e.totalSize=0;var t="data.vod.itc.cn";e.allot&&(t=e.allot);for(var i=0;i<e.videos.length;i++){var n=e.videos[i];void 0===n.dispatch&&(n.fileName?n.dispatch="https://"+t+"/ip?new="+n.fileName+"&num=1&key="+n.key+"&ch="+e.ch+"&pt=1&pg=2&prod=h5n&uid="+e.uid:n.clipsurl=n.clipsURL),e.totalDuration+=Number(n.duration),e.totalSize+=Number(n.size)}return!0},z.prototype.reportError=function(e,t){var i={};i.code=e,i.msg=t,this.onerror?this.onerror(i):this.emit("error",i)},z.prototype.setCdnIP=function(e){var t=e.split("/");this.lastCdnIP=t[2]},z.prototype.sendLog=function(e,t){t?s.default[t]("p2p:"+e):s.default.log("p2p:"+e)},z.isP2PSupported=function(){return void 0!==window.MediaSource||void 0!==window.WebkitMediaSource||(this.sendLog("your browser is not supported by MediaSource","warn"),!1)},z.getTimeNow=function(){var e=new Date;return"["+e.toLocaleString()+"."+e.getMilliseconds()+"]"},z.getMillisecond=function(){return(new Date).getTime()},z.check=function(){var e=z.getMillisecond();this.downloader.check(e,!1),this.tracker.check(e)},z.onSeeking=function(){this.downloader&&this.media.seek()},z.onEnded=function(){this.downloader&&this.downloader.onendTimeout&&clearTimeout(this.downloader.onendTimeout),this.sendLog("onEnded","info"),this.onEndedMth()},z.prototype.onEndedMth=function(){this.sendLog("onEnded is runing, we will reset media","info"),this.onended?this.onended(this.media.video):this.emit("ended",this.media.video),this.media&&"ended"===this.media.mediaSource.readyState&&this.media.releaseBuffers()},z.onSeeked=function(){!1!==this.isSeeked&&(this.isSeeked=!1,this.sendLog("onSeeked is runing, seeking is over","info"),this.media.seeking=!1,this.onseeked?this.onseeked(this.media.video):this.emit("seeked",this.media.video))},z.onError=function(){this.sendLog("video onError, error is "+this.media.video.error.toString(),"info");var e="";switch(this.media.video.error.code){case this.media.video.error.MEDIA_ERR_ABORTED:e="fetching process aborted by user";break;case this.media.video.error.MEDIA_ERR_NETWORK:e="error occurred when downloading";break;case this.media.video.error.MEDIA_ERR_DECODE:e="error occurred when decoding";break;case this.media.video.error.MEDIA_ERR_SRC_NOT_SUPPORTED:e="audio/video not supported"}this.reportError(900+this.media.video.error.code,e)},z.MAX_PEER_UNINTERACTION_TIME=12e4,z.MAX_DOWNLOAD_PEER_COUNT=10,z.MAX_UPLOAD_PEER_COUNT=15,z.STANDARD_DOWNLOAD_SECONDS=15,z.MIN_DOWNLOAD_SECONDS=2*z.STANDARD_DOWNLOAD_SECONDS,z.MAX_DOWNLOAD_SECONDS=3*z.STANDARD_DOWNLOAD_SECONDS,z.TRACKER_DOMAIN="wss://p2p.vod.tv.sohu.com",z.VERSION="201902111430";var N=function(e){function t(){o(this,t);var e=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.close(),e}return u(t,r.EventEmitter),t}();N.REQUEST_RANGE_SIZE=131072,N.prototype.close=function(){this.media&&this.media.close(),this.media=null,this.isDispatch=!0,this.isAD=!0,this.videoTag,this.adInfo},N.prototype.download=function(e,t){if(e.addEventListener("ended",N.onEnded.bind(this)),this.videoTag=e,this.adInfo=t,void 0!=t.isp2p){this.media=new g(this),this.media.initialize(e),this.media.setMoiveDuration(t.duration,0),this.sendLog("download ad from cdn "+t.url,"info");var i=t.url.split("?");this.httpGet(i[0]+"ip?"+i[1])}else e.src=t.url},N.prototype.play=function(){var e,t=this;void 0!=this.adInfo.isp2p?(e=this.media.video.play())?e.then(function(){t.emit("playAdError",1),t.sendLog("play ok 1")}).catch(function(e){t.media.video.muted=!0,t.media.video.pause(),t.media.video.play(),t.emit("playAdError",0),t.sendLog("play fail 0")}):this.media.video.play():(e=this.videoTag.play())?e.then(function(){t.emit("playAdError",1),t.sendLog("play ok 1")}).catch(function(e){t.videoTag.muted=!0,t.videoTag.pause(),t.videoTag.play(),t.emit("playAdError",0),t.sendLog("play fail 0")}):this.videoTag.play()},N.prototype.sendLog=function(e,t){t?s.default[t]("adp2p:"+e):s.default.log("adp2p:"+e)},N.getTimeNow=function(){var e=new Date;return"["+e.toLocaleString()+"."+e.getMilliseconds()+"]"},N.getMillisecond=function(){return(new Date).getTime()},N.prototype.httpGet=function(e){var t=this,i=new XMLHttpRequest;i.open("GET",e,!0),!1===t.isDispatch&&(i.responseType="arraybuffer"),i.timeout=18e4,i.send(),i.onerror=function(i){t.error="ad cdn_error 801 timeout "+e,t.emit("loadAdError",t.error),t.sendLog(t.error,"warn")},i.onreadystatechange=function(n){if(i.readyState==this.DONE)if(200==i.status||206==i.status||304==i.status||416==i.status)if(t.isDispatch){t.isDispatch=!1;try{var r=JSON.parse(i.response);t.httpGet(r.servers[0].url)}catch(e){var a="dipatch failed, "+e.message;t.emit("loadAdError",a),t.sendLog("dipatch failed, "+e.message,"warn")}}else i.response.fileStart=0,t.media.appendBuffer(i.response,void 0,void 0),t.emit("loadAdSuc");else 0==i.status?t.error="ad cdn_error 801 timeout "+i.status+" "+e:t.error="ad cdn_error "+i.status+" "+e,t.emit("loadAdError",t.error),t.sendLog(t.error,"warn")}},N.onEnded=function(){void 0!=this.adInfo.isp2p?(this.emit("ended",this.media.video),null!=this.media&&null!=this.media.mediaSource&&"ended"===this.media.mediaSource.readyState&&this.media.releaseBuffers()):this.emit("ended",this.videoTag)},t.P2PKernel=z,t.ADKernel=N},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function e(t,i,r){this._byteOffset=i||0,t instanceof ArrayBuffer?this.buffer=t:"object"==(void 0===t?"undefined":n(t))?(this.dataView=t,i&&(this._byteOffset+=i)):this.buffer=new ArrayBuffer(t||0),this.position=0,this.endianness=null==r?e.LITTLE_ENDIAN:r};(r.prototype={}).getPosition=function(){return this.position},r.prototype._realloc=function(e){if(this._dynamicSize){var t=this._byteOffset+this.position+e,i=this._buffer.byteLength;if(t<=i)t>this._byteLength&&(this._byteLength=t);else{for(i<1&&(i=1);t>i;)i*=2;var n=new ArrayBuffer(i),r=new Uint8Array(this._buffer);new Uint8Array(n,0,r.length).set(r),this.buffer=n,this._byteLength=t}}},r.prototype._trimAlloc=function(){if(this._byteLength!=this._buffer.byteLength){var e=new ArrayBuffer(this._byteLength),t=new Uint8Array(e),i=new Uint8Array(this._buffer,0,t.length);t.set(i),this.buffer=e}},r.BIG_ENDIAN=!1,r.LITTLE_ENDIAN=!0,r.prototype._byteLength=0,Object.defineProperty(r.prototype,"byteLength",{get:function(){return this._byteLength-this._byteOffset}}),Object.defineProperty(r.prototype,"buffer",{get:function(){return this._trimAlloc(),this._buffer},set:function(e){this._buffer=e,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(r.prototype,"byteOffset",{get:function(){return this._byteOffset},set:function(e){this._byteOffset=e,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(r.prototype,"dataView",{get:function(){return this._dataView},set:function(e){this._byteOffset=e.byteOffset,this._buffer=e.buffer,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._byteOffset+e.byteLength}}),r.prototype.seek=function(e){var t=Math.max(0,Math.min(this.byteLength,e));this.position=isNaN(t)||!isFinite(t)?0:t},r.prototype.isEof=function(){return this.position>=this._byteLength},r.prototype.mapUint8Array=function(e){this._realloc(1*e);var t=new Uint8Array(this._buffer,this.byteOffset+this.position,e);return this.position+=1*e,t},r.prototype.readInt32Array=function(e,t){e=null==e?this.byteLength-this.position/4:e;var i=new Int32Array(e);return r.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,e*i.BYTES_PER_ELEMENT),r.arrayToNative(i,null==t?this.endianness:t),this.position+=i.byteLength,i},r.prototype.readInt16Array=function(e,t){e=null==e?this.byteLength-this.position/2:e;var i=new Int16Array(e);return r.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,e*i.BYTES_PER_ELEMENT),r.arrayToNative(i,null==t?this.endianness:t),this.position+=i.byteLength,i},r.prototype.readInt8Array=function(e){e=null==e?this.byteLength-this.position:e;var t=new Int8Array(e);return r.memcpy(t.buffer,0,this.buffer,this.byteOffset+this.position,e*t.BYTES_PER_ELEMENT),this.position+=t.byteLength,t},r.prototype.readUint32Array=function(e,t){e=null==e?this.byteLength-this.position/4:e;var i=new Uint32Array(e);return r.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,e*i.BYTES_PER_ELEMENT),r.arrayToNative(i,null==t?this.endianness:t),this.position+=i.byteLength,i},r.prototype.readUint16Array=function(e,t){e=null==e?this.byteLength-this.position/2:e;var i=new Uint16Array(e);return r.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,e*i.BYTES_PER_ELEMENT),r.arrayToNative(i,null==t?this.endianness:t),this.position+=i.byteLength,i},r.prototype.readUint8Array=function(e){e=null==e?this.byteLength-this.position:e;var t=new Uint8Array(e);return r.memcpy(t.buffer,0,this.buffer,this.byteOffset+this.position,e*t.BYTES_PER_ELEMENT),this.position+=t.byteLength,t},r.prototype.readFloat64Array=function(e,t){e=null==e?this.byteLength-this.position/8:e;var i=new Float64Array(e);return r.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,e*i.BYTES_PER_ELEMENT),r.arrayToNative(i,null==t?this.endianness:t),this.position+=i.byteLength,i},r.prototype.readFloat32Array=function(e,t){e=null==e?this.byteLength-this.position/4:e;var i=new Float32Array(e);return r.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,e*i.BYTES_PER_ELEMENT),r.arrayToNative(i,null==t?this.endianness:t),this.position+=i.byteLength,i},r.prototype.readInt32=function(e){var t=this._dataView.getInt32(this.position,null==e?this.endianness:e);return this.position+=4,t},r.prototype.readInt16=function(e){var t=this._dataView.getInt16(this.position,null==e?this.endianness:e);return this.position+=2,t},r.prototype.readInt8=function(){var e=this._dataView.getInt8(this.position);return this.position+=1,e},r.prototype.readUint32=function(e){var t=this._dataView.getUint32(this.position,null==e?this.endianness:e);return this.position+=4,t},r.prototype.readUint16=function(e){var t=this._dataView.getUint16(this.position,null==e?this.endianness:e);return this.position+=2,t},r.prototype.readUint8=function(){var e=this._dataView.getUint8(this.position);return this.position+=1,e},r.prototype.readFloat32=function(e){var t=this._dataView.getFloat32(this.position,null==e?this.endianness:e);return this.position+=4,t},r.prototype.readFloat64=function(e){var t=this._dataView.getFloat64(this.position,null==e?this.endianness:e);return this.position+=8,t},r.endianness=new Int8Array(new Int16Array([1]).buffer)[0]>0,r.memcpy=function(e,t,i,n,r){var a=new Uint8Array(e,t,r),s=new Uint8Array(i,n,r);a.set(s)},r.arrayToNative=function(e,t){return t==this.endianness?e:this.flipArrayEndianness(e)},r.nativeToEndian=function(e,t){return this.endianness==t?e:this.flipArrayEndianness(e)},r.flipArrayEndianness=function(e){for(var t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),i=0;i<e.byteLength;i+=e.BYTES_PER_ELEMENT)for(var n=i+e.BYTES_PER_ELEMENT-1,r=i;n>r;n--,r++){var a=t[r];t[r]=t[n],t[n]=a}return e},r.prototype.failurePosition=0,String.fromCharCodeUint8=function(e){for(var t=[],i=0;i<e.length;i++)t[i]=e[i];return String.fromCharCode.apply(null,t)},r.prototype.readString=function(e,t){return null==t||"ASCII"==t?String.fromCharCodeUint8.apply(null,[this.mapUint8Array(null==e?this.byteLength-this.position:e)]):new TextDecoder(t).decode(this.mapUint8Array(e))},r.prototype.readCString=function(e){var t=this.byteLength-this.position,i=new Uint8Array(this._buffer,this._byteOffset+this.position),n=t;null!=e&&(n=Math.min(e,t));for(var r=0;r<n&&0!==i[r];r++);var a=String.fromCharCodeUint8.apply(null,[this.mapUint8Array(r)]);return null!=e?this.position+=n-r:r!=t&&(this.position+=1),a};var a=Math.pow(2,32);r.prototype.readUint64=function(){return this.endianness===r.LITTLE_ENDIAN?this.readUint32()+this.readUint32()*a:this.readUint32()*a+this.readUint32()},r.prototype.readUint24=function(){return(this.readUint8()<<16)+(this.readUint8()<<8)+this.readUint8()},r.prototype.save=function(e){var t=new Blob([this.buffer]),i=window.webkitURL||window.URL;if(!i||!i.createObjectURL)throw"DataStream.save: Can't create object URL.";var n=i.createObjectURL(t),r=document.createElement("a");r.setAttribute("href",n),r.setAttribute("download",e),r.click(),i.revokeObjectURL(n)},r.prototype._dynamicSize=!0,Object.defineProperty(r.prototype,"dynamicSize",{get:function(){return this._dynamicSize},set:function(e){e||this._trimAlloc(),this._dynamicSize=e}}),r.prototype.shift=function(e){var t=new ArrayBuffer(this._byteLength-e),i=new Uint8Array(t),n=new Uint8Array(this._buffer,e,i.length);i.set(n),this.buffer=t,this.position-=e},r.prototype.writeInt32Array=function(e,t){if(this._realloc(4*e.length),e instanceof Int32Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT===0)r.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapInt32Array(e.length,t);else for(var i=0;i<e.length;i++)this.writeInt32(e[i],t)},r.prototype.writeInt16Array=function(e,t){if(this._realloc(2*e.length),e instanceof Int16Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT===0)r.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapInt16Array(e.length,t);else for(var i=0;i<e.length;i++)this.writeInt16(e[i],t)},r.prototype.writeInt8Array=function(e){if(this._realloc(1*e.length),e instanceof Int8Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT===0)r.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapInt8Array(e.length);else for(var t=0;t<e.length;t++)this.writeInt8(e[t])},r.prototype.writeUint32Array=function(e,t){if(this._realloc(4*e.length),e instanceof Uint32Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT===0)r.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapUint32Array(e.length,t);else for(var i=0;i<e.length;i++)this.writeUint32(e[i],t)},r.prototype.writeUint16Array=function(e,t){if(this._realloc(2*e.length),e instanceof Uint16Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT===0)r.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapUint16Array(e.length,t);else for(var i=0;i<e.length;i++)this.writeUint16(e[i],t)},r.prototype.writeUint8Array=function(e){if(this._realloc(1*e.length),e instanceof Uint8Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT===0)r.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapUint8Array(e.length);else for(var t=0;t<e.length;t++)this.writeUint8(e[t])},r.prototype.writeFloat64Array=function(e,t){if(this._realloc(8*e.length),e instanceof Float64Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT===0)r.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapFloat64Array(e.length,t);else for(var i=0;i<e.length;i++)this.writeFloat64(e[i],t)},r.prototype.writeFloat32Array=function(e,t){if(this._realloc(4*e.length),e instanceof Float32Array&&this.byteOffset+this.position%e.BYTES_PER_ELEMENT===0)r.memcpy(this._buffer,this.byteOffset+this.position,e.buffer,0,e.byteLength),this.mapFloat32Array(e.length,t);else for(var i=0;i<e.length;i++)this.writeFloat32(e[i],t)},r.prototype.writeInt32=function(e,t){this._realloc(4),this._dataView.setInt32(this.position,e,null==t?this.endianness:t),this.position+=4},r.prototype.writeInt16=function(e,t){this._realloc(2),this._dataView.setInt16(this.position,e,null==t?this.endianness:t),this.position+=2},r.prototype.writeInt8=function(e){this._realloc(1),this._dataView.setInt8(this.position,e),this.position+=1},r.prototype.writeUint32=function(e,t){this._realloc(4),this._dataView.setUint32(this.position,e,null==t?this.endianness:t),this.position+=4},r.prototype.writeUint16=function(e,t){this._realloc(2),this._dataView.setUint16(this.position,e,null==t?this.endianness:t),this.position+=2},r.prototype.writeUint8=function(e){this._realloc(1),this._dataView.setUint8(this.position,e),this.position+=1},r.prototype.writeFloat32=function(e,t){this._realloc(4),this._dataView.setFloat32(this.position,e,null==t?this.endianness:t),this.position+=4},r.prototype.writeFloat64=function(e,t){this._realloc(8),this._dataView.setFloat64(this.position,e,null==t?this.endianness:t),this.position+=8},r.prototype.writeUCS2String=function(e,t,i){null==i&&(i=e.length);for(var n=0;n<e.length&&n<i;n++)this.writeUint16(e.charCodeAt(n),t);for(;n<i;n++)this.writeUint16(0)},r.prototype.writeString=function(e,t,i){var n=0;if(null==t||"ASCII"==t)if(null!=i){var r=Math.min(e.length,i);for(n=0;n<r;n++)this.writeUint8(e.charCodeAt(n));for(;n<i;n++)this.writeUint8(0)}else for(n=0;n<e.length;n++)this.writeUint8(e.charCodeAt(n));else this.writeUint8Array(new TextEncoder(t).encode(e.substring(0,i)))},r.prototype.writeCString=function(e,t){var i=0;if(null!=t){var n=Math.min(e.length,t);for(i=0;i<n;i++)this.writeUint8(e.charCodeAt(i));for(;i<t;i++)this.writeUint8(0)}else{for(i=0;i<e.length;i++)this.writeUint8(e.charCodeAt(i));this.writeUint8(0)}},r.prototype.writeStruct=function(e,t){for(var i=0;i<e.length;i+=2){var n=e[i+1];this.writeType(n,t[e[i]],t)}},r.prototype.writeType=function(e,t,i){var a;if("function"==typeof e)return e(this,t);if("object"==(void 0===e?"undefined":n(e))&&!(e instanceof Array))return e.set(this,t,i);var s=null,o="ASCII",l=this.position;switch("string"==typeof e&&/:/.test(e)&&(e=(a=e.split(":"))[0],s=parseInt(a[1])),"string"==typeof e&&/,/.test(e)&&(e=(a=e.split(","))[0],o=parseInt(a[1])),e){case"uint8":this.writeUint8(t);break;case"int8":this.writeInt8(t);break;case"uint16":this.writeUint16(t,this.endianness);break;case"int16":this.writeInt16(t,this.endianness);break;case"uint32":this.writeUint32(t,this.endianness);break;case"int32":this.writeInt32(t,this.endianness);break;case"float32":this.writeFloat32(t,this.endianness);break;case"float64":this.writeFloat64(t,this.endianness);break;case"uint16be":this.writeUint16(t,r.BIG_ENDIAN);break;case"int16be":this.writeInt16(t,r.BIG_ENDIAN);break;case"uint32be":this.writeUint32(t,r.BIG_ENDIAN);break;case"int32be":this.writeInt32(t,r.BIG_ENDIAN);break;case"float32be":this.writeFloat32(t,r.BIG_ENDIAN);break;case"float64be":this.writeFloat64(t,r.BIG_ENDIAN);break;case"uint16le":this.writeUint16(t,r.LITTLE_ENDIAN);break;case"int16le":this.writeInt16(t,r.LITTLE_ENDIAN);break;case"uint32le":this.writeUint32(t,r.LITTLE_ENDIAN);break;case"int32le":this.writeInt32(t,r.LITTLE_ENDIAN);break;case"float32le":this.writeFloat32(t,r.LITTLE_ENDIAN);break;case"float64le":this.writeFloat64(t,r.LITTLE_ENDIAN);break;case"cstring":this.writeCString(t,s);break;case"string":this.writeString(t,o,s);break;case"u16string":this.writeUCS2String(t,this.endianness,s);break;case"u16stringle":this.writeUCS2String(t,r.LITTLE_ENDIAN,s);break;case"u16stringbe":this.writeUCS2String(t,r.BIG_ENDIAN,s);break;default:if(3==e.length){for(var u=e[1],d=0;d<t.length;d++)this.writeType(u,t[d]);break}this.writeStruct(e,t)}null!=s&&(this.position=l,this._realloc(s),this.position=l+s)},r.prototype.writeUint64=function(e){var t=Math.floor(e/a);this.writeUint32(t),this.writeUint32(4294967295&e)},r.prototype.writeUint24=function(e){this.writeUint8((16711680&e)>>16),this.writeUint8((65280&e)>>8),this.writeUint8(255&e)},r.prototype.adjustUint32=function(e,t){var i=this.position;this.seek(e),this.writeUint32(t),this.seek(i)},r.prototype.mapInt32Array=function(e,t){this._realloc(4*e);var i=new Int32Array(this._buffer,this.byteOffset+this.position,e);return r.arrayToNative(i,null==t?this.endianness:t),this.position+=4*e,i},r.prototype.mapInt16Array=function(e,t){this._realloc(2*e);var i=new Int16Array(this._buffer,this.byteOffset+this.position,e);return r.arrayToNative(i,null==t?this.endianness:t),this.position+=2*e,i},r.prototype.mapInt8Array=function(e){this._realloc(1*e);var t=new Int8Array(this._buffer,this.byteOffset+this.position,e);return this.position+=1*e,t},r.prototype.mapUint32Array=function(e,t){this._realloc(4*e);var i=new Uint32Array(this._buffer,this.byteOffset+this.position,e);return r.arrayToNative(i,null==t?this.endianness:t),this.position+=4*e,i},r.prototype.mapUint16Array=function(e,t){this._realloc(2*e);var i=new Uint16Array(this._buffer,this.byteOffset+this.position,e);return r.arrayToNative(i,null==t?this.endianness:t),this.position+=2*e,i},r.prototype.mapFloat64Array=function(e,t){this._realloc(8*e);var i=new Float64Array(this._buffer,this.byteOffset+this.position,e);return r.arrayToNative(i,null==t?this.endianness:t),this.position+=8*e,i},r.prototype.mapFloat32Array=function(e,t){this._realloc(4*e);var i=new Float32Array(this._buffer,this.byteOffset+this.position,e);return r.arrayToNative(i,null==t?this.endianness:t),this.position+=4*e,i},r.prototype.readStruct=function(e){for(var t,i,n={},r=this.position,a=0;a<e.length;a+=2){if(t=e[a+1],null==(i=this.readType(t,n)))return 0===this.failurePosition&&(this.failurePosition=this.position),this.position=r,null;n[e[a]]=i}return n},r.prototype.readUCS2String=function(e,t){return String.fromCharCode.apply(null,this.readUint16Array(e,t))},r.prototype.readType=function(e,t){if("function"==typeof e)return e(this,t);if(!("object"!=(void 0===e?"undefined":n(e))||e instanceof Array))return e.get(this,t);if(e instanceof Array&&3!=e.length)return this.readStruct(e,t);var i,a,s,o=null,l=null,u="ASCII",d=this.position;switch("string"==typeof e&&/:/.test(e)&&(e=(i=e.split(":"))[0],l=parseInt(i[1])),"string"==typeof e&&/,/.test(e)&&(e=(i=e.split(","))[0],u=parseInt(i[1])),e){case"uint8":o=this.readUint8();break;case"int8":o=this.readInt8();break;case"uint16":o=this.readUint16(this.endianness);break;case"int16":o=this.readInt16(this.endianness);break;case"uint32":o=this.readUint32(this.endianness);break;case"int32":o=this.readInt32(this.endianness);break;case"float32":o=this.readFloat32(this.endianness);break;case"float64":o=this.readFloat64(this.endianness);break;case"uint16be":o=this.readUint16(r.BIG_ENDIAN);break;case"int16be":o=this.readInt16(r.BIG_ENDIAN);break;case"uint32be":o=this.readUint32(r.BIG_ENDIAN);break;case"int32be":o=this.readInt32(r.BIG_ENDIAN);break;case"float32be":o=this.readFloat32(r.BIG_ENDIAN);break;case"float64be":o=this.readFloat64(r.BIG_ENDIAN);break;case"uint16le":o=this.readUint16(r.LITTLE_ENDIAN);break;case"int16le":o=this.readInt16(r.LITTLE_ENDIAN);break;case"uint32le":o=this.readUint32(r.LITTLE_ENDIAN);break;case"int32le":o=this.readInt32(r.LITTLE_ENDIAN);break;case"float32le":o=this.readFloat32(r.LITTLE_ENDIAN);break;case"float64le":o=this.readFloat64(r.LITTLE_ENDIAN);break;case"cstring":o=this.readCString(l);break;case"string":o=this.readString(l,u);break;case"u16string":o=this.readUCS2String(l,this.endianness);break;case"u16stringle":o=this.readUCS2String(l,r.LITTLE_ENDIAN);break;case"u16stringbe":o=this.readUCS2String(l,r.BIG_ENDIAN);break;default:if(3==e.length){var c=e[1],h=e[2],p=0;if(p="function"==typeof h?h(t,this,e):"string"==typeof h&&null!=t[h]?parseInt(t[h]):parseInt(h),"string"==typeof c){var f=c.replace(/(le|be)$/,""),v=null;switch(/le$/.test(c)?v=r.LITTLE_ENDIAN:/be$/.test(c)&&(v=r.BIG_ENDIAN),"*"==h&&(p=null),f){case"uint8":o=this.readUint8Array(p);break;case"uint16":o=this.readUint16Array(p,v);break;case"uint32":o=this.readUint32Array(p,v);break;case"int8":o=this.readInt8Array(p);break;case"int16":o=this.readInt16Array(p,v);break;case"int32":o=this.readInt32Array(p,v);break;case"float32":o=this.readFloat32Array(p,v);break;case"float64":o=this.readFloat64Array(p,v);break;case"cstring":case"utf16string":case"string":if(null==p)for(o=[];!this.isEof()&&null!=(s=this.readType(c,t));)o.push(s);else for(o=new Array(p),a=0;a<p;a++)o[a]=this.readType(c,t)}}else if("*"==h){o=[];for(this.buffer;;){var y=this.position;try{var m=this.readType(c,t);if(null==m){this.position=y;break}o.push(m)}catch(e){this.position=y;break}}}else for(o=new Array(p),a=0;a<p;a++){if(null==(s=this.readType(c,t)))return null;o[a]=s}break}}return null!=l&&(this.position=d+l),o};var s=function(e){this.buffers=[],this.bufferIndex=-1,e&&(this.insertBuffer(e),this.bufferIndex=0)};(s.prototype=new r(new ArrayBuffer,0,r.BIG_ENDIAN)).initialized=function(){var e;return this.bufferIndex>-1||(this.buffers.length>0&&0===(e=this.buffers[0]).fileStart?(this.buffer=e,this.bufferIndex=0,!0):(this.logBufferLevel(),!1))},ArrayBuffer.concat=function(e,t){var i=new Uint8Array(e.byteLength+t.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(t),e.byteLength),i.buffer},s.prototype.reduceBuffer=function(e,t,i){var n;return(n=new Uint8Array(i)).set(new Uint8Array(e,t,i)),n.buffer.fileStart=e.fileStart+t,n.buffer.usedBytes=0,n.buffer},s.prototype.insertBuffer=function(e){for(var t=!0,i=0;i<this.buffers.length;i++){var n=this.buffers[i];if(e.fileStart<=n.fileStart){if(e.fileStart===n.fileStart){if(e.byteLength>n.byteLength){this.buffers.splice(i,1),i--;continue}}else e.fileStart+e.byteLength<=n.fileStart||(e=this.reduceBuffer(e,0,n.fileStart-e.fileStart)),this.buffers.splice(i,0,e),0===i&&(this.buffer=e);t=!1;break}if(e.fileStart<n.fileStart+n.byteLength){var r=n.fileStart+n.byteLength-e.fileStart,a=e.byteLength-r;if(!(a>0)){t=!1;break}e=this.reduceBuffer(e,r,a)}}t&&(this.buffers.push(e),0===i&&(this.buffer=e))},s.prototype.logBufferLevel=function(e){},s.prototype.cleanBuffers=function(){var e,t;for(e=0;e<this.buffers.length;e++)(t=this.buffers[e]).usedBytes===t.byteLength&&(this.buffers.splice(e,1),e--)},s.prototype.mergeNextBuffer=function(){var e;if(this.bufferIndex+1<this.buffers.length){if((e=this.buffers[this.bufferIndex+1]).fileStart===this.buffer.fileStart+this.buffer.byteLength){this.buffer.byteLength;var t=this.buffer.usedBytes,i=this.buffer.fileStart;return this.buffers[this.bufferIndex]=ArrayBuffer.concat(this.buffer,e),this.buffer=this.buffers[this.bufferIndex],this.buffers.splice(this.bufferIndex+1,1),this.buffer.usedBytes=t,this.buffer.fileStart=i,!0}return!1}return!1},s.prototype.findPosition=function(e,t,i){var n,r=null,a=-1;for(n=!0===e?0:this.bufferIndex;n<this.buffers.length&&(r=this.buffers[n]).fileStart<=t;)a=n,i&&(r.fileStart+r.byteLength<=t?r.usedBytes=r.byteLength:r.usedBytes=t-r.fileStart,this.logBufferLevel()),n++;return-1!==a&&(r=this.buffers[a]).fileStart+r.byteLength>=t?a:-1},s.prototype.findEndContiguousBuf=function(e){var t,i,n,r=void 0!==e?e:this.bufferIndex;if(i=this.buffers[r],this.buffers.length>r+1)for(t=r+1;t<this.buffers.length&&(n=this.buffers[t]).fileStart===i.fileStart+i.byteLength;t++)i=n;return i.fileStart+i.byteLength},s.prototype.getEndFilePositionAfter=function(e){var t=this.findPosition(!0,e,!1);return-1!==t?this.findEndContiguousBuf(t):e},s.prototype.addUsedBytes=function(e){this.buffer.usedBytes+=e,this.logBufferLevel()},s.prototype.setAllUsedBytes=function(){this.buffer.usedBytes=this.buffer.byteLength,this.logBufferLevel()},s.prototype.seek=function(e,t,i){var n;return-1!==(n=this.findPosition(t,e,i))&&(this.buffer=this.buffers[n],this.bufferIndex=n,this.position=e-this.buffer.fileStart,!0)},s.prototype.getPosition=function(){if(-1===this.bufferIndex||null===this.buffers[this.bufferIndex])throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.position},s.prototype.getLength=function(){return this.byteLength},s.prototype.getEndPosition=function(){if(-1===this.bufferIndex||null===this.buffers[this.bufferIndex])throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.byteLength},t.DataStream=r,t.MultiBufferStream=s,t.MAX_SIZE=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=u(i(4)),s=u(i(2)),o=u(i(7)),l=u(i(19));function u(e){return e&&e.__esModule?e:{default:e}}var d,c={crossOrigin:"anonymous",clickAndDrag:!0,fov:35,fovMin:3,fovMax:100,lon:180,lat:0,flatProjection:!1},h=null;function p(){window.cancelAnimationFrame(h)}function f(e){var t=e.obj,i=e.propName,n=e.originalValue,r=e.targetValue,a=e.duration,s=void 0===a?500:a;p();var o=Date.now(),l=r-n;h=requestAnimationFrame(function e(){var r=(Date.now()-o)/s;r>1?h=null:(t[i]=n+l*Math.sin(Math.PI/2*r),h=requestAnimationFrame(e))})}function v(e){var t=e.obj,i=e.propName,n=e.step,r=void 0===n?2:n;p(),function e(){t[i]+=r,h=requestAnimationFrame(e)}()}var y=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n=window.SHTHREE,this.player=t,this.el=this.player.el,d=(0,l.default)(this.player),this.options=a.default.extend({},i,c),a.default.extend(this,{requestAnimationId:null,mouseDown:!1,dragStart:{},time:null,updateTime:Date.now(),moveEd:!1}),this.lat=this._lat=this.options.lat,this.lon=this._lon=this.options.lon,this.fov=this._fov=this.options.fov,this.step=50,this.infiniteStep=2,this.initMode(),this.init()}return r(e,[{key:"init",value:function(){this.video=this.el.querySelector("video");var e=this.video.parentNode;this.container=document.createElement("div"),e.appendChild(this.container),this.container.classList.add("x-webgl"),this.controlEl=this.el.querySelector(".x-webgl-control"),this.controlEl.innerHTML='<button type="button" class="x-webgl-switch-btn"></button><div class="x-webgl-spherical-panel"></div>',this.switchBtn=this.controlEl.querySelector(".x-webgl-switch-btn"),this.spherePanel=this.controlEl.querySelector(".x-webgl-spherical-panel"),this.switchBtn.innerHTML='<svg version="1.1"xmlns="http://www.w3.org/2000/svg"xmlns:xlink="http://www.w3.org/1999/xlink"x="0px"y="0px"width="100%"height="100%"viewBox="0 0 33 33"><use xlink:href="#x-svg-webgl-switch-01" class="x-svg-shadow2"></use><circle id="x-svg-webgl-switch-01" cx="16.406" cy="16.5" r="15"/><circle style="fill:#FFFFFF;" cx="16.312" cy="16.5" r="2"/><path style="fill:#FFFFFF;" d="M16.406,6.5c-1.661,0-3.144,1.074-4.22,2.834h1.208c0.839-1.146,1.88-1.834,3.012-1.834 c2.757,0,5,4.038,5,9c0,4.963-2.243,9-5,9s-5-4.037-5-9c0-0.748,0.057-1.471,0.152-2.166h-1.014 c-0.089,0.696-0.139,1.419-0.139,2.166c0,5.607,2.636,10,6,10s6-4.393,6-10S19.771,6.5,16.406,6.5z"/><path style="fill:#FFFFFF;" d="M16.406,10.5c-5.607,0-10,2.636-10,6s4.393,6,10,6c0.75,0,1.477-0.051,2.176-0.141v-1.014 c-0.699,0.098-1.425,0.154-2.176,0.154c-4.962,0-9-2.243-9-5s4.038-5,9-5c4.963,0,9,2.243,9,5c0,1.129-0.685,2.168-1.824,3.006 v1.208c1.754-1.076,2.824-2.556,2.824-4.214C26.406,13.136,22.014,10.5,16.406,10.5z"/></svg>',this.spherePanel.innerHTML='<svg version="1.1"xmlns="http://www.w3.org/2000/svg"xmlns:xlink="http://www.w3.org/1999/xlink"x="0px"y="0px"width="94px"height="94px"viewBox="0 0 94 94"><g id="x-svg-webgl-sphere-right-btn"><use xlink:href="#x-svg-webgl-sphere-right" class="x-svg-shadow2"></use><path id="x-svg-webgl-sphere-right" class="x-svg-webgl-sphere-fill" d="M65.226,29.754c4.115,4.457,6.632,10.41,6.632,16.954c0,6.543-2.517,12.499-6.633,16.954 l14.143,14.143c7.732-8.08,12.49-19.029,12.49-31.096c0-12.066-4.758-23.015-12.49-31.096L65.226,29.754z"/><polygon style="fill:#FFFFFF;" points="77.953,38.853 77.953,41.681 82.98,46.708 77.953,51.736 77.953,54.564 85.809,46.708"/></g><g id="x-svg-webgl-sphere-left-btn"><use xlink:href="#x-svg-webgl-sphere-left" class="x-svg-shadow2"></use><path id="x-svg-webgl-sphere-left" class="x-svg-webgl-sphere-fill" d="M28.49,63.662c-4.115-4.457-6.632-10.41-6.632-16.954c0-6.544,2.517-12.498,6.633-16.954 L14.349,15.613c-7.732,8.08-12.49,19.029-12.49,31.096c0,12.067,4.758,23.014,12.49,31.096L28.49,63.662z"/><polygon style="fill:#FFFFFF;" points="15.697,38.853 15.697,41.681 10.67,46.708 15.697,51.736 15.697,54.564 7.842,46.708"/></g><g id="x-svg-webgl-sphere-up-btn"><use xlink:href="#x-svg-webgl-sphere-up" class="x-svg-shadow2"></use><path id="x-svg-webgl-sphere-up" class="x-svg-webgl-sphere-fill" d="M29.903,28.34c4.457-4.115,10.41-6.632,16.954-6.632s12.498,2.517,16.954,6.633l14.142-14.143 c-8.08-7.732-19.029-12.49-31.096-12.49s-23.015,4.758-31.096,12.49L29.903,28.34z"/><polygon style="fill:#FFFFFF;" points="38.549,16.025 41.377,16.025 46.404,10.998 51.432,16.025 54.26,16.025 46.404,8.169"/></g><g id="x-svg-webgl-sphere-down-btn"><use xlink:href="#x-svg-webgl-sphere-down" class="x-svg-shadow2"></use><path id="x-svg-webgl-sphere-down" class="x-svg-webgl-sphere-fill" d="M29.903,65.076c4.457,4.115,10.41,6.633,16.954,6.633s12.498-2.518,16.954-6.633l14.142,14.143 c-8.08,7.732-19.029,12.49-31.096,12.49s-23.015-4.758-31.096-12.49L29.903,65.076z"/><polygon style="fill:#FFFFFF;" points="39.012,77.691 41.84,77.691 46.867,82.719 51.895,77.691 54.723,77.691 46.867,85.547"/></g><g id="x-svg-webgl-sphere-reset-btn"><use xlink:href="#x-svg-webgl-sphere-center" class="x-svg-shadow2"></use><circle id="x-svg-webgl-sphere-center" class="x-svg-webgl-sphere-fill" cx="46.857" cy="46.708" r="23"/><circle style="fill:none;stroke:#FFFFFF;stroke-width:2;stroke-miterlimit:10;" cx="46.888" cy="46.625" r="11"/><rect x="36.013" y="45.521" style="fill:#FFFFFF;" width="4" height="2"/><rect x="53.763" y="45.521" style="fill:#FFFFFF;" width="4" height="2"/><rect x="45.867" y="53.73" style="fill:#FFFFFF;" width="2" height="4"/><rect x="45.867" y="35.521" style="fill:#FFFFFF;" width="2" height="4"/><circle style="fill:#FFFFFF;" cx="46.888" cy="46.625" r="3"/></g></svg>',this.createVRPlayer(),this.initEvent(),this.observePlayer(),this.setMode(this.mode)}},{key:"initMode",value:function(){var e=null;try{e=localStorage.getItem("sh_vr_mode")}catch(t){e=(0,o.default)("sh_vr_mode")}this.mode=e||this.player.dataModel.vr}},{key:"createVRPlayer",value:function(){var e=s.default.width(this.container),t=s.default.height(this.container);this.scene=new n.Scene,this.camera=new n.PerspectiveCamera(this.fov,e/t,.1,1e3),this.camera.setLens(this.fov),this.renderer=new n.WebGLRenderer,this.renderer.setSize(e,t),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.autoClear=!1,this.renderer.setClearColor(3355443,1),this.container.appendChild(this.renderer.domElement),this.scene.add(this.createMesh())}},{key:"createMesh",value:function(){return this.video.setAttribute("crossorigin",this.options.crossOrigin),this.video.style.display="none",this.texture=new n.VideoTexture(this.video),this.texture.generateMipmaps=!1,this.texture.minFilter=n.LinearFilter,this.texture.magFilter=n.LinearFilter,this.texture.format=n.RGBFormat,this.geometry=new n.SphereGeometry(500,80,50),this.geometry.scale(-1,1,1),this.mesh=new n.Mesh(this.geometry,new n.MeshBasicMaterial({map:this.texture})),this.mesh}},{key:"tick",value:function(){var e=this;this.requestAnimationId=requestAnimationFrame(function(){return e.tick()}),this.render()}},{key:"render",value:function(){this.lat=Math.max(-85,Math.min(85,this.lat)),this.phi=(90-this.lat)*Math.PI/180,this.theta=this.lon*Math.PI/180;var e=500*Math.sin(this.phi)*Math.cos(this.theta),t=500*Math.cos(this.phi),i=500*Math.sin(this.phi)*Math.sin(this.theta);this.camera.lookAt(new n.Vector3(e,t,i)),this.options.flatProjection?(this.camera.position.x=0,this.camera.position.y=0,this.camera.position.z=0):(this.camera.position.x=-e,this.camera.position.y=-t,this.camera.position.z=-i),this.renderer.clear(),this.renderer.render(this.scene,this.camera)}},{key:"initEvent",value:function(){var e=this;document.addEventListener("mousemove",function(t){return e.onMouseMove(t)},!1),this.container.addEventListener("mousewheel",function(t){return e.onMouseWheel(t)},!1),this.container.addEventListener("DOMMouseScroll",function(t){return e.onMouseWheel(t)},!1),this.container.addEventListener("mousedown",function(t){return e.onMouseDown(t)},!1),document.addEventListener("mouseup",function(t){return e.onMouseUp(t)},!1),this.container.addEventListener("click",function(t){return e.onClick(t)},!1),this.container.addEventListener("touchstart",function(t){return e.onMouseDown(t)},!1),this.container.addEventListener("touchmove",function(t){return e.onMouseMove(t)},!1),this.container.addEventListener("touchend",function(t){return e.onMouseUp(t)},!1),this.controlEl.addEventListener("dblclick",function(e){return e.stopPropagation()},!1),this.spherePanel.addEventListener("mouseup",function(e){e.stopPropagation(),p()},!1),this.spherePanel.addEventListener("mouseleave",function(e){e.stopPropagation(),p()},!1);var t=null,i=this.controlEl.querySelector("#x-svg-webgl-sphere-right-btn");i.addEventListener("click",function(i){i.stopPropagation(),Date.now()-t<200&&e.moveXByAnimation(e.step),d("pl_360play_clickdragbutton")},!1),i.addEventListener("mousedown",function(i){i.stopPropagation(),t=Date.now(),v({obj:e,propName:"lon",step:e.infiniteStep})},!1);var n=this.controlEl.querySelector("#x-svg-webgl-sphere-left-btn");n.addEventListener("click",function(i){i.stopPropagation(),Date.now()-t<200&&e.moveXByAnimation(-1*e.step),d("pl_360play_clickdragbutton")},!1),n.addEventListener("mousedown",function(i){i.stopPropagation(),t=Date.now(),v({obj:e,propName:"lon",step:-1*e.infiniteStep})},!1);var r=this.controlEl.querySelector("#x-svg-webgl-sphere-up-btn");r.addEventListener("click",function(i){i.stopPropagation(),Date.now()-t<200&&e.moveYByAnimation(e.step),d("pl_360play_clickdragbutton")},!1),r.addEventListener("mousedown",function(t){t.stopPropagation(),v({obj:e,propName:"lat",step:e.infiniteStep})},!1);var a=this.controlEl.querySelector("#x-svg-webgl-sphere-down-btn");a.addEventListener("click",function(i){i.stopPropagation(),Date.now()-t<200&&e.moveYByAnimation(-1*e.step)},!1),a.addEventListener("mousedown",function(t){t.stopPropagation(),v({obj:e,propName:"lat",step:-1*e.infiniteStep})},!1),this.controlEl.querySelector("#x-svg-webgl-sphere-reset-btn").addEventListener("click",function(t){t.stopPropagation(),e.resetState(),d("pl_360play_reset")},!1),this.switchBtn.addEventListener("click",function(t){t.stopPropagation(),e.switchMode()},!1)}},{key:"observePlayer",value:function(){var e=this;this.player.on("data.ok",function(){e.inCommon=!0,e.isShowing=!1,s.default.hide(e.controlEl)}),this.player.on("resolution.switched",function(){e.scene.remove(),e.video=e.player.video,e.scene.add(e.createMesh()),e.setMode(e.mode)}),this.player.on("resize",function(){return e.resize()}),this.player.on("adv.start",function(){e.isShowing=!1,s.default.hide(e.controlEl)}),this.player.on("adv.ended",function(){e.isShowing=!0,e.inCommon&&s.default.show(e.controlEl)}),this.player.on("player-state",function(t){e.inCommon=0!=t,0==t?s.default.hide(e.controlEl):e.isShowing&&s.default.show(e.controlEl)})}},{key:"switchMode",value:function(){if(this.mode=1==this.mode?2:1,this.setMode(this.mode),2==this.mode)try{localStorage.setItem("sh_vr_mode",this.mode)}catch(e){(0,o.default)("sh_vr_mode",this.mode,{path:"/",expires:100})}else try{localStorage.removeItem("sh_vr_mode")}catch(e){(0,o.default)("sh_vr_mode",null)}}},{key:"setMode",value:function(e){1==e?(this.container.style.display="block",this.video.style.display="none",null==this.requestAnimationId&&this.tick(),this.el.classList.add("x-vr")):(this.container.style.display="none",this.video.style.display="block",cancelAnimationFrame(this.requestAnimationId),this.requestAnimationId=null,this.el.classList.remove("x-vr"))}},{key:"moveXByAnimation",value:function(e){null!==e&&void 0!==e&&f({obj:this,propName:"lon",originalValue:this.lon,targetValue:this.lon+e})}},{key:"moveYByAnimation",value:function(e){null!==e&&void 0!==e&&f({obj:this,propName:"lat",originalValue:this.lat,targetValue:this.lat+e})}},{key:"moveYBy",value:function(e){null!==e&&void 0!==e&&(this.lat+=e)}},{key:"moveBy",value:function(e,t){null!==e&&void 0!==e&&(this.lon+=e),null!==t&&void 0!==t&&(this.lat+=t)}},{key:"resetState",value:function(){this.lat=this._lat,this.lon=this._lon,this.fov=this._fov,this.camera.setLens(this.fov)}},{key:"onClick",value:function(e){Date.now()-this.time>200&&e.stopPropagation()}},{key:"onMouseDown",value:function(e){this.mouseDown=!0,this.dragStart.x=e.pageX,this.dragStart.y=e.pageY,this.time=Date.now(),this.container.classList.add("x-grabbing")}},{key:"onMouseUp",value:function(e){this.moveEd&&this.container.classList.contains("x-grabbing")&&d("pl_300play_clickdragmouse"),this.moveEd=!1,this.mouseDown=!1,this.container.classList.remove("x-grabbing"),e.stopPropagation()}},{key:"onMouseMove",value:function(e){var t,i;this.options.clickAndDrag&&this.mouseDown&&(t=this.dragStart.x-e.pageX,i=this.dragStart.y-e.pageY,this.dragStart.x=e.pageX,this.dragStart.y=e.pageY,this.moveBy(.1*t,.1*-i),this.moveEd=!0)}},{key:"onMouseWheel",value:function(e){e.wheelDeltaY?this.fov-=-.01*e.wheelDeltaY:e.wheelDelta?this.fov-=-.01*e.wheelDelta:e.detail&&(this.fov+=1*e.detail),this.fov<this.options.fovMin?this.fov=this.options.fovMin:this.fov>this.options.fovMax&&(this.fov=this.options.fovMax),this.camera.setLens(this.fov),e.preventDefault()}},{key:"resize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s.default.width(this.container),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.default.height(this.container);this.renderer.setSize(e,t),this.camera.aspect=e/t,this.camera.updateProjectionMatrix()}},{key:"reset",value:function(){this.resetState(),this.initMode(),this.setMode(this.mode)}}]),e}();t.default=y},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(e){return e&&e.__esModule?e:{default:e}}(i(109));var a=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{pagesize:999};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.player=t,this.config=i,this.pagesize=999,this.videos=[],this.prevideos=[],this.config.disablePlaylist||this.observePlayer()}return n(e,[{key:"observePlayer",value:function(){var e=this;this.player.on("data.ok",function(t){if(2!=t.site)if(e.model)e.isLast()&&e.hasNextPage()&&e.loadNextPage();else{e.model={vid:t.vid,plid:t.plid,cid:t.cid,site:t.site},e.loader=(0,r.default)(t.site);var i=e.model;1==i.site?([13,24,25].indexOf(e.model.cid/1)>-1?(e.order=1,e.pageRule=2):e.order=0,window.isPianhua&&(e.order=1)):e.order=0,e.loader({vid:i.vid,plid:i.plid,order:e.order,pagesize:e.pagesize,pageRule:e.pageRule}).then(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.videos=e.formatVideoList(t.videos||[]),e.prevideos=e.formatVideoList(t.prevideos||[]),delete t.videos,delete t.prevideos,e.listData=t,e.hasNextPage()?e.isLast()&&e.loadNextPage():e.videos=e.videos.concat(e.prevideos)})}})}},{key:"next",value:function(){for(var e=this.player.dataModel.vid,t=this.videos,i=-1,n=0,r=t.length;n<r;n++)if(e==t[n].vid){i=n+1;break}return t[i]}},{key:"hasNext",value:function(){return!!this.next()}},{key:"isLast",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player.dataModel.vid,t=this.videos;return!(e&&t&&t.length)||e==t[t.length-1].vid}},{key:"hasNextPage",value:function(){var e=!1,t=this.listData,i=this.pagesize;return t&&(e=Math.ceil(t.size/i)>t.currentPage),e}},{key:"loadNextPage",value:function(){var e=this,t=this.model;this.loader({plid:t.plid,order:this.order,pagesize:this.pagesize,page:this.listData.currentPage+1,pageRule:this.pageRule}).then(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.videos||[];e.videos=e.videos.concat(e.formatVideoList(i)),e.hasNextPage()||(e.videos=e.videos.concat(e.prevideos)),delete t.videos,delete t.prevideos,e.listData=t})}},{key:"formatVideoList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=[],i=this.model.site,n=this.model.plid;return e.forEach(function(e,r){t[r]={url:e.pageUrl,title:e.subName||e.name||e.showName,vid:e.vid,site:i,fee:e.tvIsFee,tvid:e.tvId,plid:n}}),t}}]),e}();t.default=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return 1==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)?n.default:r.default};var n=a(i(110)),r=a(i(111));function a(e){return e&&e.__esModule?e:{default:e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.vid,i=e.plid,a=e.page,s=e.pagesize,o=e.order,l=e.pageRule,u={playlistid:i,pagenum:a,vid:t,pagesize:s,order:o,pageRule:l,encoding:"utf-8",ssl:0==window.location.href.indexOf("https")?1:2},d={};for(var c in u)null!=u[c]&&void 0!==u[c]&&(d[c]=u[c]);return new Promise(function(e,t){fetch(r+"?"+n.default.stringify(d)).then(function(e){if(e.ok)return e.json();throw Error(e.statusText)}).then(function(t){return e(t)}).catch(function(e){return t(e)})})},i(21);var n=function(e){return e&&e.__esModule?e:{default:e}}(i(3));var r="//pl.hd.sohu.com/videolist"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.vid,i=e.plid,a=e.page,s=e.pagesize,o=e.order,l={playlistid:i,pagenum:a,vid:t,pagesize:s,order:o,ssl:0==window.location.href.indexOf("https")?1:2},u={};for(var d in l)null!=l[d]&&void 0!==l[d]&&(u[d]=l[d]);return new Promise(function(e,t){fetch(r+"?"+n.default.stringify(u)).then(function(e){if(e.ok)return e.json();throw Error(e.statusText)}).then(function(t){return e(t)}).catch(function(e){return t(e)})})},i(21);var n=function(e){return e&&e.__esModule?e:{default:e}}(i(3));var r="//my.tv.sohu.com/play/getvideolist.do"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.player=t,this.agentPageUrl="https://tv.sohu.com/upload/static/h5player/agent.html",this.init()}return n(e,[{key:"init",value:function(){var e=this.iframe=document.createElement("iframe");e.src=this.agentPageUrl,e.width=0,e.height=0,document.documentElement.appendChild(e),this.childWindow=e.contentWindow,this.initEvent()}},{key:"initEvent",value:function(){var e=this;window.addEventListener("message",function(t){var i=t.origin||t.originalEvent.origin;/sohu\.com/.test(i)&&t.data._is_player_cache&&(e.player.storage=t.data,e.player.emit("localstorage.ok"))}),this.iframe.addEventListener("load",function(){e.updateLocalStorage()})}},{key:"post",value:function(e,t){(t=t||{}).code=e,this.childWindow.postMessage(t,this.agentPageUrl)}},{key:"updateLocalStorage",value:function(){this.post("update")}},{key:"setLocalStorage",value:function(e){var t=this,i={};Object.keys(e).forEach(function(n){"code"!==n&&(i["_player_"+n]=t.player.storage[n]=e[n])}),this.post("set",i)}},{key:"getLocalStorage",value:function(e,t){e="_player_"+e;window.addEventListener("message",function i(n){t&&t(n.data[e]),window.removeEventListener("message",i)}),this.post("get",{key:e})}}]),e}();t.default=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=l(i(8)),a=l(i(0)),s=l(i(6)),o=l(i(114));function l(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.player=t,this.uid=r.default.getUid(),this.pp=r.default.getPassport(),this.observePlayer()}return n(e,[{key:"observePlayer",value:function(){var e=this;this.player.on("data.ok",function(){e.advPre=!0}),this.player.on("adv.ended",function(){if(e.advPre){e.advPre=!1,e.start=3;var t=e.pp&&""!=e.pp?e.getPlayRecord():e.getLocalPlayRecord(),i=e.player.dataModel.isUgcFeeVideo;t.then(function(t){if(!i&&e.player.seekTime<=0){e.player.emit("playrecord",t),e.player.dataModel.playRecord=t;var n=navigator.userAgent.toLowerCase();n.indexOf("safari")>=0&&n.indexOf("chrome")<0?(a.default.log("[\u4e3b\u64ad\u653e\u5668]=====\u5f53\u524d\u4f7f\u7528safari\u6d4f\u89c8\u5668===="),setTimeout(function(){return e.player.seek(t)},1e3)):e.player.seek(t),e.start=e.player.currentTime}}).catch(function(t){a.default.log("[\u4e3b\u64ad\u653e\u5668]playrecord \u672a\u627e\u5230--\x3e"+t),0!=e.player.dataModel.sT&&0!=e.player.storage.skip_s&&(e.player.emit("playrecord-skip-start"),e.player.seek(e.player.dataModel.sT))})}}),this.player.on("timeupdate",function(){var t=e.player.currentTime;null!==e.start&&Math.abs(t-e.start)>=60&&(e.start=t,e.savePlayRecord())})}},{key:"getPlayRecord",value:function(){var e=this;return(0,o.default)({pp:this.pp}).then(function(t){if(t&&t.attachment&&0===t.attachment.status&&t.attachment.videos&&t.attachment.videos.length>0){var i=e.getCurrentPlayRecord(t.attachment.videos);return 0===i?(a.default.log("[\u4e3b\u64ad\u653e\u5668]-----\x3e\u4e91\u8ff9\u4e2d\u6ca1\u6709\u64ad\u653e\u8bb0\u5f55\uff1a"),e.getLocalPlayRecord()):(a.default.log("[\u4e3b\u64ad\u653e\u5668]-----\x3e\u4ece\u4e91\u8ff9\u4e2d\u627e\u5230\u5f53\u524d\u89c6\u9891\u64ad\u653e\u8bb0\u5f55\uff1a"+i),i)}return e.getLocalPlayRecord()})}},{key:"getLocalPlayRecord",value:function(){var e=this;return new Promise(function(t,i){var n;try{n=JSON.parse(e.player.storage.sh_player_list)}catch(e){a.default.log("[\u4e3b\u64ad\u653e\u5668]\u6ca1\u6709\u627e\u5230recordList")}if(n){var r=e.getCurrentPlayRecord(n);0!==r?(a.default.log("[\u4e3b\u64ad\u653e\u5668]-----\x3e\u4ece\u672c\u5730\u5b58\u50a8\u4e2d\u627e\u5230\u5f53\u524d\u89c6\u9891\u64ad\u653e\u8bb0\u5f55\uff1a"+r),t(r)):i()}else i()})}},{key:"getCurrentPlayRecord",value:function(e){var t=this.player.dataModel.vid;if(0===e.length)return 0;for(var i=0;i<e.length;i++)if(e[i].vid==t)return e[i].t;return 0}},{key:"sendPlayRecord",value:function(){var e={passport:this.pp,vid:this.player.dataModel.vid,sid:this.player.dataModel.plid,ismytv:1==this.player.dataModel.site?0:3,t:Math.floor(this.player.currentTime),c:"35"};(0,s.default)({url:"//his.tv.sohu.com/his/ping.do?",data:e,dataType:"jsonp"})}},{key:"saveRecord2Local",value:function(){var e=this,t={vid:this.player.dataModel.vid,sid:this.player.dataModel.plid,t:Math.floor(this.player.currentTime)},i=[];try{i=JSON.parse(this.player.storage.sh_player_list)}catch(e){}for((i=i.filter(function(t){return t.sid!==e.player.dataModel.plid})).push(t);i.length>20;)i.shift();this.player.playerCache.setLocalStorage({sh_player_list:JSON.stringify(i)})}},{key:"savePlayRecord",value:function(){this.pp&&this.sendPlayRecord(),this.saveRecord2Local()}}]),e}();t.default=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={passport:e.pp||null,c:"35",videotype:"2"};return(0,r.default)({url:"//his.tv.sohu.com/his/get_new.do",data:t,dataType:"jsonp"}).then(function(e){return e.data&&"success"===e.status&&n.default.log("[\u4e3b\u64ad\u653e\u5668]------\x3e\u4e91\u8ff9\u6570\u636e\u83b7\u53d6\u6210\u529f"),e.data})};var n=a(i(0)),r=a(i(6));function a(e){return e&&e.__esModule?e:{default:e}}},function(e,t){}]);