define("github-rollup-marketplace",["@github/query-selector","@github/sortablejs","github/fetch-json","github/text","invariant","selector-observer","delegated-events","github/onfocus","github/remote-form","github/form","github/fetch"],function(e,t,n,s,a,r,l,o,c,i,u){"use strict";function d(t){return e.querySelectorAll(t,"input:checked",HTMLInputElement).map(e=>e.value).filter(e=>e.length>0)}function p(t){const n=e.closest(t,".js-marketplace-listing-form-container");e.query(n,".js-marketplace-listing-error-container").classList.remove("visible")}function m(t,n){const s=e.closest(t,".js-marketplace-listing-form-container"),a=e.query(s,".js-marketplace-listing-error-container");a.classList.add("visible"),e.query(a,".js-marketplace-listing-error").textContent=n}function g(e){const t=e.querySelector(".js-marketplace-listing-save-notice");t&&(t.classList.add("visible"),setTimeout(()=>t.classList.remove("visible"),1500))}function f(t,n){const s=e.closest(t,".js-marketplace-listing-form-container").querySelectorAll(".js-marketplace-listing-bgcolor");for(const e of s)e.style.backgroundColor=`#${n}`}function j(e){const t=document.querySelector(".js-hero-listing-container .js-hero-listing-bgcolor");t&&(t.style.backgroundColor=`#${e}`)}function k(t,n,r){a(r instanceof HTMLElement,"app/assets/modules/github/marketplace/edit.js:98");const l=e.closest(r,".js-listing-characters-remaining-container"),o=e.query(l,".js-listing-characters-remaining"),c=String(o.getAttribute("data-suffix")),i=n-s.getUtf8StringLength(t);o.textContent=`${i} ${c}`,o.classList.toggle("text-red",i<=5)}function h(t){const n=t.item;n.setAttribute("data-old-index",String(t.oldIndex));const s=e.query(n,".js-marketplace-listing-screenshot-resequence-form",HTMLFormElement),r=s.elements.namedItem("marketplace_listing_screenshot[previousScreenshotId]");a(r instanceof HTMLInputElement,"app/assets/modules/github/marketplace/edit.js:279");const l=n.previousElementSibling;l instanceof HTMLElement?r.value=e.getAttribute(l,"data-screenshot-id"):r.value="",i.submit(s)}function L(e){for(const t of e)t.removeAttribute("disabled")}function y(e){for(const t of e)t.setAttribute("disabled","")}async function b(t){const n=t.target;a(n instanceof HTMLInputElement,"app/assets/modules/github/marketplace/order.js:11");const s=parseInt(n.value,10).toFixed(),r=e.getAttribute(n,"data-url"),l=new URL(r,window.location.origin),o=new URLSearchParams(l.search.slice(1));o.set("quantity",s),l.search=o.toString();const c=await u.fetchSafeDocumentFragment(document,l),i=e.query(document,".js-marketplace-order-preview");i.innerHTML="",i.appendChild(c)}t=t&&t.hasOwnProperty("default")?t.default:t,a=a&&a.hasOwnProperty("default")?a.default:a,l.on("selectmenu:selected",".js-languages-select-menu",function(t){const n=t.currentTarget;!function(t,n){const s=e.query(t,".js-preview-supported-languages-container"),a=e.query(t,".js-no-supported-languages-container"),r=n.length>0;a.classList.toggle("d-none",r),s.classList.toggle("d-none",!r),s.textContent=n.join(", ")}(n,d(n))}),o.onInput(".js-marketplace-short-description-field",function(t){const n=t.target;a(n instanceof HTMLInputElement,"app/assets/modules/github/marketplace/edit.js:112");const s=e.closest(n,".form-group");n.validity.patternMismatch?s.classList.add("errored"):s.classList.remove("errored")}),l.on("click",".js-marketplace-error-dismiss",function(e){p(e.currentTarget)}),l.on("change",".js-marketplace-listing-light-text",function(e){const t=e.target;a(t instanceof HTMLSelectElement,"app/assets/modules/github/marketplace/edit.js:128"),function(e){const t=document.querySelector(".js-hero-listing-name");t&&("true"===e?(t.classList.add("text-white"),t.classList.remove("text-gray-dark")):(t.classList.remove("text-white"),t.classList.add("text-gray-dark")))}(t.value)}),l.on("change",".js-marketplace-listing-logo-background-color",function(t){const n=t.target;a(n instanceof HTMLInputElement,"app/assets/modules/github/marketplace/edit.js:134"),f(e.closest(t.target,"form",HTMLFormElement),n.value),j(n.value)}),c.remoteForm(".js-marketplace-listing-form",async function(e,t){let n;p(e);try{n=await t.json()}catch(s){if(!s.response)throw s;return void m(e,s.response.json.error)}if(n.json.path){const e=window.location.pathname,t=n.json.path;if(e!==t)return void(window.location.href=t)}n.json.bgcolor&&(f(e,n.json.bgcolor),j(n.json.bgcolor)),n.json.short_description&&function(e){const t=document.querySelector(".js-hero-listing-description");t&&(t.textContent=e)}(n.json.short_description),g(e)}),c.remoteForm(".js-marketplace-listing-screenshot-update-form",async function(t,n){try{await n.text()}catch(l){return void function(e){const t=e.querySelector(".js-marketplace-listing-save-error");t&&(t.classList.add("visible"),setTimeout(()=>t.classList.remove("visible"),1500))}(t)}const s=e.query(t,".js-marketplace-listing-screenshot-caption-field",HTMLInputElement),a=e.query(t,".js-marketplace-listing-screenshot-caption-present"),r=e.query(t,".js-marketplace-listing-screenshot-caption-empty");a.textContent=s.value,s.value.trim().length<1?(a.classList.add("d-none"),r.classList.remove("d-none")):(a.classList.remove("d-none"),r.classList.add("d-none")),g(t)}),c.remoteForm(".js-marketplace-listing-screenshot-delete-form",async function(t,n){p(t),e.query(t,".js-marketplace-listing-screenshot-delete-button",HTMLButtonElement).disabled=!0;try{await n.text()}catch(s){if(s.response){try{m(t,s.response.json.error)}catch(a){throw s}finally{e.query(t,".js-marketplace-listing-screenshot-delete-button",HTMLButtonElement).disabled=!1}return}throw s}e.closest(t,".js-marketplace-listing-screenshot-container").remove()}),o.onInput("textarea.js-listing-characters-remaining-field",function(e){const t=e.target;a(t instanceof HTMLTextAreaElement,"app/assets/modules/github/marketplace/edit.js:231");const n=parseInt(t.getAttribute("data-character-limit"),10);k(t.value,n,t)}),o.onInput("input.js-listing-characters-remaining-field",function(e){const t=e.target;a(t instanceof HTMLInputElement,"app/assets/modules/github/marketplace/edit.js:239");const n=t.maxLength;k(t.value,n,t)}),l.on("menu:deactivate",".js-edit-marketplace-listing-supported-languages .js-select-menu",async function(t){const s=t.currentTarget,a=(s.getAttribute("data-supported-language-names")||"").split(","),r=d(s),l=e.closest(s,"form",HTMLFormElement);if(!function(e,t){const n=e.sort(),s=t.sort();return n.length===s.length&&n.every((e,t)=>e===s[t])}(a,r)){if(0===r.length){e.query(s,".js-no-selected-languages",HTMLInputElement).checked=!0}try{await n.fetchJSON(l.action,{method:l.method,body:new FormData(l)}),s.setAttribute("data-supported-language-names",r.toString()),g(l)}catch(o){m(l,"Something went wrong")}}}),r.observe(".js-draggable-screenshots-container",function(e){t.create(e,{animation:150,draggable:".js-draggable-screenshot",onUpdate:h})}),l.on("selectmenu:selected",".js-marketplace-edit-price-model",function(t){const n=t.currentTarget,s=t.target,a=e.closest(n,".js-marketplace-edit-plan-editor"),r=s.getAttribute("data-value"),l=String(s.getAttribute("data-note")),o=e.query(a,".js-marketplace-plan-edit-unit-note"),c=e.query(t.currentTarget,".js-marketplace-edit-hidden-price-model",HTMLInputElement),i=e.querySelectorAll(a,".js-marketplace-plan-price-field-group",HTMLInputElement),u=e.querySelectorAll(a,".js-marketplace-plan-free-trial-field-group",HTMLInputElement),d=e.querySelectorAll(a,".js-marketplace-plan-unit-field-group",HTMLInputElement);null!=r&&(a.setAttribute("data-model",r),c.value=r),o.textContent=l,["FLAT_RATE","PER_UNIT"].includes(r)?L(i):y(i),!function(e){return["FLAT_RATE","PER_UNIT"].includes(e)}(r)?y(u):L(u),!function(e){return"PER_UNIT"===e}(r)?y(d):L(d);const p="PER_UNIT"===r;e.query(a,".js-marketplace-plan-unit-name-field",HTMLInputElement).required=p}),l.on("selectmenu:selected",".js-marketplace-edit-account-type",function(t){const n=t.target.getAttribute("data-value"),s=e.query(t.currentTarget,".js-marketplace-edit-hidden-account-type",HTMLInputElement);null!=n&&(s.value=n)}),l.on("click",".js-marketplace-plan-update",function(t){t.preventDefault();const n=e.closest(t.currentTarget,".js-marketplace-edit-plan-container"),s=e.query(n,".js-marketplace-edit-hidden-price-model");a(t.currentTarget instanceof HTMLButtonElement,"app/assets/modules/github/marketplace/edit-pricing.js:178");const r=t.currentTarget.form;s.removeAttribute("disabled"),r&&r.submit()}),l.on("click",".js-marketplace-plan-preview-toggle",function(t){const n=e.closest(t.currentTarget,".js-marketplace-edit-plan-container"),s=e.query(n,".js-marketplace-plan-editor-toggle"),a=e.query(n,".js-marketplace-edit-plan-editor"),r=e.query(n,".js-marketplace-edit-plan-preview");r.classList.contains("d-none")&&(t.currentTarget.classList.add("selected"),s.classList.remove("selected"),r.classList.remove("d-none"),a.classList.add("d-none"),function(t,n){const s=e.query(n,".js-marketplace-plan-name"),a=e.query(t,".js-marketplace-plan-name-field",HTMLInputElement).value;s.textContent=a;const r=e.query(n,".js-marketplace-free-trial-container"),l=e.query(n,".js-marketplace-no-trial-container"),o=e.query(n,".js-marketplace-direct-billing-container");e.query(t,".js-marketplace-free-trial-field",HTMLInputElement).checked?(r.classList.remove("d-none"),o.classList.add("d-none"),l.classList.add("d-none")):(l.classList.remove("d-none"),r.classList.add("d-none"),o.classList.add("d-none"));const c=e.query(t,".js-marketplace-edit-hidden-price-model",HTMLInputElement).value,i=n.querySelectorAll(".js-marketplace-plan-unit-name"),u=e.query(n,".js-marketplace-plan-per-unit-info");if("PER_UNIT"===c){const n=e.query(t,".js-marketplace-plan-unit-name-field",HTMLInputElement).value;for(const e of i)e.textContent=n,e.classList.remove("d-none");u.classList.remove("d-none")}else{for(const e of i)e.classList.add("d-none");u.classList.add("d-none")}if("FREE"===c||"DIRECT_BILLING"===c){const e=n.querySelectorAll(".js-marketplace-plan-dollars-container");for(const t of e)t.classList.add("d-none")}else{const s=e.query(n,".js-marketplace-plan-monthly-dollars"),a=e.query(t,".js-marketplace-plan-monthly-price-field",HTMLInputElement).value;s.textContent=a,e.closest(s,".js-marketplace-plan-dollars-container").classList.remove("d-none");const r=e.query(n,".js-marketplace-plan-yearly-dollars"),l=e.query(t,".js-marketplace-plan-yearly-price-field",HTMLInputElement).value;r.textContent=l,e.closest(r,".js-marketplace-plan-dollars-container").classList.remove("d-none")}"DIRECT_BILLING"===c&&(l.classList.add("d-none"),r.classList.add("d-none"),o.classList.remove("d-none"));const d=e.query(n,".js-marketplace-plan-bullets");d.innerHTML="";const p=e.querySelectorAll(t,".js-marketplace-plan-bullet-field",HTMLInputElement),m=e.query(n,".js-marketplace-plan-bullet-template",HTMLTemplateElement);for(const j of p){const t=j.value;if(t.trim().length<1)continue;const n=m.content.cloneNode(!0);e.query(n,".js-marketplace-plan-bullet").textContent=t,d.appendChild(n)}const g=e.query(n,".js-marketplace-plan-description"),f=e.query(t,".js-marketplace-plan-description-field",HTMLInputElement).value;g.textContent=f}(a,r))}),l.on("click",".js-marketplace-plan-editor-toggle",function(t){const n=e.closest(t.currentTarget,".js-marketplace-edit-plan-container"),s=e.query(n,".js-marketplace-plan-preview-toggle"),a=e.query(n,".js-marketplace-edit-plan-editor"),r=e.query(n,".js-marketplace-edit-plan-preview");a.classList.contains("d-none")&&(t.currentTarget.classList.add("selected"),s.classList.remove("selected"),r.classList.add("d-none"),a.classList.remove("d-none"))}),l.on("change",".js-marketplace-plan-dollar-field",function(t){const n=t.currentTarget;a(n instanceof HTMLInputElement,"app/assets/modules/github/marketplace/edit-pricing.js:226"),e.closest(n,".js-marketplace-plan-dollar-field-container").classList.toggle("is-errored",!n.checkValidity())}),r.observe(".js-marketplace-order-quantity",function(e){e.addEventListener("input",b)}),l.on("change","input.js-grant-oap-checkbox",function(t){const n=t.currentTarget;a(n instanceof HTMLInputElement,"app/assets/modules/github/marketplace/order.js:31");const s=e.query(document,".js-marketplace-complete-order",HTMLButtonElement);s&&(s.disabled=!n.checked)}),l.on("click",".js-marketplace-complete-order",function(e){e.preventDefault();const t=e.currentTarget;a(t instanceof HTMLButtonElement,"app/assets/modules/github/marketplace/order.js:41");const n=t.form,s=document.querySelector(".js-marketplace-billing-modal");"true"===t.getAttribute("data-show-billing-modal")&&s?s.setAttribute("open","true"):n&&n.submit()})});

//# sourceMappingURL=marketplace-fcc910cdfd0965b909f71cd4cdbc923e.js.map
