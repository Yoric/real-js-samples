_.Module.define({path:"tbui/widget/LoginDialog",sub:{_config:{apiOpt:{staticPage:$.tb.location.getProtocol()+"//"+$.tb.location.getHost()+"/tb/static-common/html/pass/v3Jump.html",product:"tb",charset:PageData.charset?PageData.charset:"UTF-8",u:$.tb.location.getHref(),memberPass:!0,safeFlag:0,qrcodeCfg:{appName:"\u624b\u673a\u8d34\u5427 - \u6211\u7684",appHref:"http://tieba.baidu.com/c/s/download/pc"}},cache:!0,onLoginSuccess:function(t){t.returnValue=!1,$.tb.location.reload(),$.stats.track("\u8d34\u5427\u767b\u5f55\u7edf\u8ba1","\u767b\u5f55\u6210\u529f","","click")},onShow:function(){$.stats.track("\u8d34\u5427\u767b\u5f55\u7edf\u8ba1","\u767b\u5f55\u6846\u6253\u5f00","","view")},onHide:function(){$.stats.track("\u8d34\u5427\u767b\u5f55\u7edf\u8ba1","\u767b\u5f55\u6846\u5173\u95ed","","view")},registerLink:"https://passport.baidu.com/v2/?reg&tpl=tb&u=//tieba.baidu.com",tangram:!0,forgetLink:"https://passport.baidu.com/?getpass_index"},initial:function(){var t=this;!function(a){var e="undefined"!=typeof Env&&Env.server_time?Env.server_time:(new Date).getTime(),o="https://passport";a.JsLoadManager.use([o+".baidu.com/passApi/js/uni_login_wrapper.js?cdnversion="+Math.floor(e/6e4)],function(){a.passPopInstance||(a.passPopInstance=passport.pop.init(t._config)),a.passPopInstance.show()},!0,"utf-8")}(window.jQuery)}}});_.Module.define({path:"encourage-payment/widget/tdou_open_type",sub:{openTypeList:{1001001e3:"dialog",2000118:"dialog"},initial:function(){this.normalType="dialog"},getOpenType:function(e){var i=this.openTypeList[e]||this.normalType;return i}}});_.Module.define({path:"user/widget/user_api",sub:{initial:function(){},checkUniversalMembershipOf:function(e){return $.getPageData("mParr_props.level.props_id",0,e)>0&&1e3*$.getPageData("mParr_props.level.end_time",0,e)>1*new Date},checkSuperMemberShipOf:function(e){return 2==this.getUniversalMemberLevelOf(e)},checkOverdueSuperMembershipOf:function(e){return 2===+$.getPageData("mParr_props.level.props_id",0,e)&&1e3*$.getPageData("mParr_props.level.end_time",0,e)<+new Date},checkSingleForumMembershipOf:function(e,r){var t=$.getPageData("mParr_props.forum_member",0,e);return t?t[r]&&1e3*t[r].end_time>1*new Date:!1},getUniversalMemberLevelOf:function(e){return this.checkUniversalMembershipOf(e)?$.getPageData("mParr_props.level.props_id",0,e):0}}});_.Module.define({path:"user/widget/icons/icons_card",sub:{_option:{},_j_card:null,_open_timer:null,_close_timer:null,_is_show:!1,_is_first_show:!0,_default_option:{content:"",arrow_dir:"down",arrow_pos:{},card_css:{width:170,"z-index":1001},arrow_req:!0,auto_positon:!1,event_target:null,offset:{x:0,y:0},card_leave_display:!1,card_hover_show:!0,card_leave_hide:!1,attr:"",wrap:$("body")},initial:function(o){var i=this;i._option=$.extend(!0,{},i._default_option,o),this._buildCard()},_buildCard:function(){var o=this._option,i=this._genericTpl(),t=o.wrap;this._j_card=$(i),this._j_card.find(".j_content").html(o.content),t.append(this._j_card),delete o.card_css.height,this._j_card.css(o.card_css),o.card_css.height=this._j_card.find(".j_content").outerHeight(!0),this._arrow=this._j_card.find(".j_ui_white_arrow"),void 0===o.arrow_pos.left&&(this._arrow_left=o.card_css.width/2-10,this._arrow.css({left:this._arrow_left})),this._arrow.css(o.arrow_pos),o.arrow_req||this._j_card.find(".j_ui_white_arrow").hide(),o.auto_positon&&this._autoPosition()},_autoPosition:function(){var o=this._option,i={},t=$(window).height(),e=$(window).width(),n=($(document).scrollLeft(),$(document).scrollTop()),_=(o.event_target.innerWidth(),o.event_target.innerHeight()),a="",s={x:o.event_target.offset().left-o.card_css.width/2+o.event_target.outerWidth(!0)/2,y:o.event_target.offset().top-o.card_css.height-10,width:this._j_card.innerWidth(),height:this._j_card.innerHeight()+this._arrow.innerHeight()};i.left=s.x,i.top=s.y;var c=o.arrow_pos.left||this._arrow_left,r=15,l=e;e<$(document).width()&&(l=$(document).width());var d=l-(o.card_css.width+r);i.left<r?(c+=i.left-r,i.left=r):i.left>d&&(c+=i.left-d,i.left=d),i.top<n?(a="up",i.top+=_+(s.height||0),i.top-=o.offset.y):(i.top+=i.top+_>n+t?-_-(s.height||0):0,a="down",i.top+=o.offset.y),this._arrow.removeClass("icon_white_down").removeClass("icon_white_up").addClass("icon_white_"+a).css({left:c}),this._j_card.css(i)},_genericTpl:function(){var o=this._option.attr,i=this._option.arrow_dir,t=['<div class="icon_card_wrap" '+o+' style="visibility: hidden">','<div class="j_content icon_card_content ">',"</div>",'<span class="j_ui_white_arrow arrow icon_white_'+i+'"></span>',"</div>"].join("");return t},showCard:function(o){var i=this;i._close_timer&&clearTimeout(i._close_timer),o&&"delayShow"==o.type?(i._open_timer&&clearTimeout(i._open_timer),i._open_timer=setTimeout(function(){i._showCardDo()},o.time)):i._showCardDo()},closeCard:function(o){var i=this;i._open_timer&&clearTimeout(i._open_timer),o&&"delayClose"==o.type?i._close_timer=setTimeout(function(){i._closeCardDo()},o.time):i._closeCardDo()},hideCard:function(o){var i=this;i._open_timer&&clearTimeout(i._open_timer),o&&"delayHide"==o.type?i._close_timer=setTimeout(function(){i._hideCardDo()},o.time):i._hideCardDo()},_showCardDo:function(){var o=this;o._is_first_show,this._j_card.css({visibility:"visible"})},_closeCardDo:function(){var o=this;this._j_card&&!this._is_show&&o._j_card.remove()},_hideCardDo:function(){var o=this;this._j_card&&!this._is_show&&o._j_card.css({visibility:"hidden"})},setContent:function(o){var i=this._option;if(null!==this._j_card){var t=this._j_card.find(".j_content");t.html(o),i.card_css.height=t.outerHeight(!0),this._j_card.css({height:i.card_css.height}),i.auto_positon&&this._autoPosition()}}}}),_.Module.define({requires:["user/widget/icons/icons_book_common"],path:"user/widget/icons/icons_book_view",sub:{tabIconsContentCongfig:{},_collect_icon_title:{101:"\u96c6\u9f5032\u4e2a\u56fd\u65d7\u5370\u8bb0\u5956\u52b1\u3010\u8d34\u5427\u4e16\u754c\u676f\u3011\u5370\u8bb0",102:"\u96c6\u9f5012\u4e2a\u661f\u5ea7\u5370\u8bb0\u53ef\u4ee5\u83b7\u5f9712\u4e2a\u9ec4\u91d1\u7248\u661f\u5ea7\u5370\u8bb0",103:"",104:""},spriteImgSize:36,initial:function(){},_getTabPanelTpl:function(){var o=['<div id="icon_book_wrap" class="_j_icon_book_wrap">','<div  class="icon_book">','<div class="icon_book_tab">','<ul  class="icon_book_tab_head">',"#{tabHead}","</ul>",'<div id="tab_body"  class="icon_book_tab_body">',"#{tabContent}","</div>","</div>","</div>",'<div class="icon_book_close"></div>',"</div>"].join("");return o},getTabItem:function(o){var i=this,t=['<li id="tab_head_#{index}" data-categoryId="#{category_id}" class="tab_deactive">','<div class="head_inner #{separator_cls}">','<button type="button" class="tab_button" hidefocus="true"  > ','<a href="javascript:void(0)">#{title}</a></button></div></li>'].join(""),e=['<div id="tab_content_#{index}" class=" tab_body_item ">',"</div>"].join(""),n="",_="",a=0;for(var s in o)a++;var c=0;for(var s in o){var r={index:c,category_id:s,title:o[s].name,separator_cls:c==a-1?"":"space"};c++,n+=$.tb.format(t,r),_+=$.tb.format(e,r)}var l={tabHead:n,tabContent:_},d=i._getTabPanelTpl();return $.tb.format(d,l)},getTabContent:function(o,i,t){var e="",n="",_=this,a=0,s=0;if(o=o||{},o.normal&&!o.advanced){var c=o.normal||[],r=c.length;return a=5,s=1>=r/50?10:r%a==0?Math.floor(r/a):Math.floor(r/a)+1,e+=_._getPositionIconListHtml(c,s,i,t),n=_._getCommIconWrap(null,a,s,e),_.tabIconsContentCongfig.comm={row:a,col:10,total_col:s},n}if(o.advanced&&o.advanced){var c=o.normal||[],l=o.advanced||[],r=c.length,d=l.length,u="";return a=2,s=1>=r/20?10:r%a==0?Math.floor(r/a):Math.floor(r/a)+1,e+=_._getPositionIconListHtml(c,s,i,t),n=_._getCommIconWrap(null,a,s,e),_.tabIconsContentCongfig.comm={row:a,col:10,total_col:s},n+=_._getDownArrowHtml(),s=1>=d/20?10:r%2==0?Math.floor(d/2):Math.floor(d/2)+1,u+=_._getPositionIconListHtml(l,s,null,t),n+=_._getAdvancedIconWrap(null,a,s,u,t),_.tabIconsContentCongfig.adv={row:a,col:10,total_col:s},n}return n},_getCommIconWrap:function(o,i,t,e){var n={arrow_top:5==i?100:45,arrow_visiblity:t>10?"visible":"hidden",height_cls:5==i?"icon_wrap_5":"",icon_list:e,total_col:t},_=['<div class="icon_wrap #{height_cls}">','<div class="icon_wrap_scroll_arrow icon_wrap_left_arrow arrow_disable" style="visibility: #{arrow_visiblity}">','<div class="left_arrow arrow_block" style=" top:#{arrow_top}px;"></div></div>','<div class="icon_view"  total-col="#{total_col}">','<div class="icon_list_wrap" >','<ul class="icon_list" style="left: 0px;" >',"#{icon_list}","</ul>","</div>","</div>",'<div class="icon_wrap_scroll_arrow icon_wrap_right_arrow " style="visibility: #{arrow_visiblity}">','<div class=" right_arrow arrow_block "  style=" top:#{arrow_top}px;"></div></div>',"</div>"].join("");return $.tb.format(_,n)},_getAdvancedIconWrap:function(o,i,t,e,n){var _=this,a={title:_._collect_icon_title[n],arrow_visiblity:t>10?"visible":"hidden",icon_list:e,total_col:t},s=['<div class="collect_icon_wrap">','<div class="collect_icon_title"><span>#{title}</span></div>','<div class="collect_wrap">','<div class="icon_wrap_scroll_arrow icon_wrap_left_arrow arrow_disable" style="visibility: #{arrow_visiblity}">','<div class="  left_arrow arrow_block" style="top:45px;"></div></div>','<div class="icon_view" total-col="#{total_col}">','<div class="icon_list_wrap" >','<ul class="icon_list" style="left: 0px;" >',"#{icon_list}","</ul>","</div>","</div>",'<div class="icon_wrap_scroll_arrow icon_wrap_right_arrow  " style="visibility: #{arrow_visiblity}">','<div class=" right_arrow arrow_block "  style=" top:45px;"></div></div>',"</div>","</div>"].join("");return $.tb.format(s,a)},_getDownArrowHtml:function(){return'<div class="wrap_donw_arrow"></div>'},_getPositionIconListHtml:function(o,i,t,e){for(var n="",_=this,a=!1,s=o.length,c=0,r=0,l=0;s>l;l++){c=Math.floor(l/i),r=l%i;var d=55*c,u=55*r;a=t&&t==o[l].name?!0:!1;var b="";b=0==o[l].is_advanced?_._getCommonIconTpl(o[l],d,u,e,a):_._getAdvIconTpl(o[l],d,u,e),n+=b}return n},_getCommonIconTpl:function(o,i,t,e,n){var _=this,a=o.sprite[o.value].split(","),s="//tb1.bdstatic.com/tb/cms/com/icon/"+e+"_"+_.spriteImgSize+".png",c=50,r=a[0],l=a[1],d=0,u=l*c,b="background: url("+s+"?stamp="+r+") no-repeat -"+u+"px -"+d+"px;",v={icon_top:i,icon_left:t,name:o.name,in_use:o.in_use,in_use_cls:1==o.in_use?"":" icon_not_use",selected_cls:n?" icon_selected":"",level:o.value,background:b,locked_cls:0==o.in_use?" icon_locked":""};_._judgeCommIconInSlot(o)&&(v.selected_cls="icon_selected");var p=["<li>",'<div id="icon_book_id_#{name}" data-id="#{name}" data-level="#{level}" class="icon_box_place #{in_use_cls}" style="top: #{icon_top}px; left: #{icon_left}px;">','<div class="icon_box icon_border "></div>','<div class="icon_box icon_icon" style="#{background}"></div>','<div class="j_icon_subscript icon_subscript #{selected_cls} #{locked_cls}" ></div>',"</div>","</li>"].join("");return $.tb.format(p,v)},_judgeCommIconInSlot:function(o){var i=this,t=o.name,e={};for(var n in e){if("1"==n&&$.isEmptyObject(e[n])){var _=this._getOldIconinfoInSlot();if(t==_)return!0}if(e[n].name==t){i.common=this.requireInstance("user/widget/icons/icons_book_common");var a=i.common.isShowDurationIcon(o);return a?!0:!1}}return!1},_getOldIconinfoInSlot:function(){var o=$(".j_icon_slot").first();if(o){var i=o.tbattr("data-slot");return i}return null},_getAdvIconTpl:function(o,i,t,e){var n=this,_=o.sprite[o.value].split(","),a=50,s=_[0],c=_[1],r=2*a,r=0,l=c*a,d="//tb1.bdstatic.com/tb/cms/com/icon/"+e+"_"+n.spriteImgSize+".png",u="background: url("+d+"?stamp="+s+") no-repeat -"+l+"px -"+r+"px;",b=o.is_collected,v={icon_top:i,icon_left:t,name:o.name,in_use:o.in_use,clocked_cls:1==b?" ":" icon_locked",level:o.value,background:u},p=["<li>",'<div id="icon_book_id_#{name}" data-id="#{name}" data-level="#{level}" class="icon_box_place " style="top: #{icon_top}px; left: #{icon_left}px;">','<div class="icon_box icon_border "></div>','<div class="icon_box icon_icon" style="#{background}"></div>','<div class="icon_subscript #{clocked_cls}" ></div>',"</div>","</li>"].join("");return $.tb.format(p,v)},_judgeAdvIconLocked:function(o,i){var t=!1;switch(i=parseInt(i)){case 101:break;case 102:if(o){for(var e=0;e<o.length;e++)if(!o[e].in_use){t=!0;break}t=12==e&&0==t?!1:!0}else t=!0;break;case 103:break;case 104:}return t}}}),_.Module.define({requires:["user/widget/icons/icons_book_common","user/widget/icons/icons_book_messagebox"],path:"user/widget/icons/icons_book_tip",sub:{_icon_book_tip:null,_icon_data:null,_ajax:null,_control:null,_msgbox:null,_option:{width:"535px"},_is_show:!1,spriteImgSize:36,initial:function(o){var i=this;i.common=this.requireInstance("user/widget/icons/icons_book_common"),i._control=o[0]},getControl:function(){return this._control},showTip:function(o,i){if(o){var t=this,e=$("#icon_book_tip");0==e.length&&$(".icon_card_wrap").append(this._getWrapTpl()),e=$("#icon_book_tip"),t._setContent(o);var n=$(".j_icon_book_tip .j_tip_up_arrow"),a=i.position(),s=a.top,c=a.left-5,r=i.parents(".icon_view"),l=r.position(),d=parseInt(l.left)+15,u=s+106;i.parents(".collect_wrap").length>0&&(u+=146),e.css({display:"block",visibility:"visible",top:u+"px",left:d+"px","z-index":2e4});var b=parseInt(c)+25;n.css({left:b+"px"}),t._bindEvents(),$(".icon_book_tip .j_tip_icon_price").html("\u6d88\u8017"+o.icon_info.price+"T\u8c46"),t._icon_data=o,$("#j_icon_book_action_btn").one("click",function(){var i=!0,e=0,n=PageData.user.Parr_scores;n&&(e=n.scores_other+n.scores_money);var a=-1;if(a=t._icon_data.price?t._icon_data.price:t._icon_data.icon_info.price,a>0&&0>e-a&&(i=!1,$(".icon_book_tip .icon_action_wrap").html(t._getNoRemainTip()),$("#j_icon_book_recharge_btn").click(function(){_.Module.use("common/widget/TchargeDialog")})),o.in_use)1==parseInt(o.slot_no)?t._replaceIcon4FirstSlot(o):t._replaceIcon4OtherSlot(o);else if(i){var s=$("#j_icon_book_action_btn em");s.length>0&&s.html("\u8d2d\u4e70\u4e2d"),t._buyIconRequest(o)}})}},hideTip:function(){var o=this;o._is_show||o.closeTip()},closeTip:function(){tip=$("#icon_book_tip"),(tip||0!=tip.length)&&tip.remove()},_bindEvents:function(){var o=$("#icon_book_tip"),i=this;o.bind("mouseenter",function(){i._is_show=!0}).bind("mouseleave",function(){i._is_show=!1,i.hideTip()})},_replaceIcon4FirstSlot:function(o){var i=this;i._control.closeIconBook(),i._msgbox||(i._msgbox=i.requireInstance("user/widget/icons/icons_book_messagebox"));var t=$(".icon_wrap .icon_slot_refresh");i._msgbox.showReplaceFirstSlotBox(o,t,i._replaceIcon4OtherSlot,i)},_replaceIcon4OtherSlot:function(o){var i=this,t={ie:"utf-8"};t.tbs=PageData.tbs,t.icon_name=o.icon_id,t.slot_no=o.slot_no,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/seticon",data:t,dataType:"json"}).success(function(o){if(o&&0===o.no){var t=o.data;i._refreshAfterReplace(t.icon_info)}else o&&2270028===o.no?(i._msgbox||(i._msgbox=i.requireInstance("user/widget/icons/icons_book_messagebox")),i._msgbox.hasNotEnoughTdou()):o&&2380009===o.no?$.dialog.alert("\u540c\u540dicon\u53ea\u80fd\u4f69\u6234\u4e00\u4e2a\uff01"):$.dialog.alert("\u672a\u77e5\u9519\u8bef\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5\uff01")})},_refreshAfterReplace:function(){var o=this;setTimeout(function(){o.closeTip()},0),o._msgbox||(o._msgbox=o.requireInstance("user/widget/icons/icons_book_messagebox")),o._msgbox.replaceIconSuccess(o)},_buyIcon:function(o){var i=this;i._control.closeIconBook(),i._msgbox||(i._msgbox=i.requireInstance("user/widget/icons/icons_book_messagebox"));var t=$(".icon_wrap .icon_slot_refresh");i._msgbox.showBuyIconBox(o,t,i._buyIconRequest,i)},_buyIconRequest:function(o){var i=this,t={ie:"utf-8"};t.tbs=PageData.tbs,t.icon_name=o.icon_id,t.level=o.value,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/buyIcon",data:t,dataType:"json"}).success(function(o){if(o&&0===o.no){var t=o.data;parr=PageData.user.Parr_scores,parr.scores_fetch=t.scores_fetch||0,parr.scores_money=t.scores_money||0,parr.scores_other=t.scores_other||0,parr.scores_total=t.scores_total,$(".j_userinfo_scores_num").html(parr.scores_money+parr.scores_other);for(var e=$(".tab_body_item_active .icon_view .icon_box_place"),n=0;n<e.length;n++){var _=$(e[n]);if(_.tbattr("data-id")==t.icon_name){_.removeClass("icon_not_use"),_.find(".j_icon_subscript").removeClass("icon_locked"),i.closeTip();break}}}else o&&2270028===o.no&&(i._msgbox||(i._msgbox=i.requireInstance("user/widget/icons/icons_book_messagebox")),i._msgbox.hasNotEnoughTdou())})},_refreshAfterBuy:function(o){this._refreshAfterReplace(o)},_setContent:function(o){var i=this._getTpl(o);$("#icon_book_tip").html(i)},_getWrapTpl:function(){var o=['<div id="icon_book_tip" class="icon_tip_card_wrap">',"</div>"].join("");return o},_getNoRemainTip:function(){var o=['<div class="icon_action" style="padding-top: 10px">','<div class="j_tip_icon_price tip_icon_price" style="height: 12px; margin-bottom:5px;display: block">T\u8c46\u4e0d\u8db3</div>','<a href="javascript:void(0)" id="j_icon_book_recharge_btn" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px;"><span><em>\u5145\u503c</em></span></a>',"</div>"].join("");return o},_getTpl:function(o){var i=this,t=o.icon_info,e=t.sprite[t.value].split(","),n=50,_=e[0],a=e[1],s=0,c=a*n,r="//tb1.bdstatic.com/tb/cms/com/icon/"+t.category_id+"_"+i.spriteImgSize+".png",l=" background:url("+r+"?stamp="+_+") no-repeat -"+c+"px -"+s+"px;",d="",u=i.common.getIconExpired(t);u>-1&&(d='<span style="margin-left: 20px;">\u5269\u4f59\u65f6\u95f4\uff1a'+u+"\u5929</span>");var b=t.title,v=t.intro,p=t.intro_url,h={background_img:l,desc_title:b+d||"\u5370\u8bb0",desc_detail:v||"",desc_link:p||"//tieba.baidu.com/",btn_value:o.in_use?"\u66ff\u6362":"\u8d2d\u4e70",price_info_display:1==o.in_use?"none":"block",padding_top:o.in_use?"20":"10",in_use_display:"none",in_use_text:"",button_display:0==o.in_use&&0==t.price?"none":"block"};i._judgeCommIconInSlot(o.icon_id)&&(h.button_display="none"),"none"==h.button_display&&(h.in_use_display="display",h.in_use_text="\u4f7f\u7528\u4e2d",h.price_info_display="none"),0==o.in_use&&0==t.price&&(h.in_use_text="\u6d3b\u52a8\u83b7\u53d6");var m=['<div class="icon_book_tip j_icon_book_tip">','<div class="tip_up_arrow j_tip_up_arrow"></div>','<div class="tip_body">','<div class="tip_icon">','<div class="tip_icon_img" style="#{background_img}}"></div>',"</div>",'<div class="icon_desc">','<div class="icon_desc_title"><span>#{desc_title}</span></div>','<div class="icon_desc_detail"><span>#{desc_detail}</span><a href="#{desc_link}"  target="_blank"><span style="padding-left:5px;">\u8be6\u60c5 >></span></a></div>',"</div>",'<div class="icon_action_wrap">','<div class="icon_action" style="padding-top:#{padding_top}px">','<div class="j_tip_icon_price tip_icon_price" style="height: 12px; margin-bottom:5px;display: #{price_info_display}"></div>','<div class="j_tip_icon_use tip_icon_use" style=" margin-bottom:5px;display: #{in_use_display}">#{in_use_text}</div>','<a href="javascript:void(0)" id="j_icon_book_action_btn" class="ui_btn ui_btn_m icon_book_action_btn" style="height: 27px; border-radius: 3px;display: #{button_display}"><span><em>#{btn_value}</em></span></a>',"</div>","</div>","</div>","</div>"].join("");return $.tb.format(m,h)},_judgeCommIconInSlot:function(o){var i={};for(var t in i){var e=this.common.isShowDurationIcon(i[t]);if(i[t].name==o&&e)return!0}return!1}}}),_.Module.define({requires:["user/widget/icons/icons_book_common","user/widget/icons/icons_card"],path:"user/widget/icons/icons_book_messagebox",sub:{_icon_book_message_box:null,_icon_data:null,_is_show:!1,_option:{width:290},is_leave_close:!1,spriteImgSize:36,setLeaveClose:function(o){this.is_leave_close=o},initial:function(){this.common=this.requireInstance("user/widget/icons/icons_book_common")},showBox:function(o,i){var t=this;t._showBox(i),t.generatorBuySlot(o),t._bindEvents()},hideBox:function(){var o=this;o._is_show||o._icon_book_message_box&&(o._icon_book_message_box.closeCard(),o._icon_book_message_box=null)},_bindEvents:function(){var o=this,i=$(".icon_card_wrap");i.bind("mouseenter",function(){o.is_leave_close&&(o._is_show=!0)}),i.bind("mouseleave",function(){o.is_leave_close&&(o._is_show=!1,o.hideBox())})},generatorBuySlot:function(o){var i=this,t=i._getBuySlotTpl(o);$(".icon_book_msgbox_body").html(t),$(".icon_book_msgbox .ui_btn").one("click",function(){i.buySlot(o)})},showReplaceFirstSlotBox:function(o,i,t,e){var n=this;setTimeout(function(){e.closeTip()},0),n._showBox(i);var _=n._getReplaceFirstSlotTipTpl(o);$(".icon_book_msgbox_body").html(_),$(".icon_book_msgbox .ui_btn").click(function(){t.call(e,o)})},showBuyIconBox:function(o,i,t,e){var n=this;setTimeout(function(){e.closeTip()},0),n._showBox(i);var a=n._getBuyIconTpl(o);$(".icon_book_msgbox_body").html(a),$(".icon_book_msgbox .ui_btn").click(function(){var i=0,a=PageData.user.Parr_scores;if(a&&(i=a.scores_other+a.scores_money),i-o.icon_info.price<0){var s=n._hasNotEnoughTdou();return $(".icon_book_msgbox_body").html(s),$(".j_tdou_not_enough").on("click",function(){_.Module.use("common/widget/TchargeDialog")}),void 0}t.call(e,o.icon_info,function(){var o=n._buyIconSuccess();$(".icon_book_msgbox_body").html(o)})})},buySlot:function(o){var i=this,t=0,e=PageData.user.Parr_scores;e&&(t=e.scores_other+e.scores_money+e.scores_fetch);var n=-1;if(n=o.price?o.price:o.icon_info.price,n>0&&0>t-n){var a=i._hasNotEnoughTdou();return $(".icon_book_msgbox_body").html(a),$(".j_tdou_not_enough").on("click",function(){_.Module.use("common/widget/TchargeDialog")}),void 0}var s={ie:"utf-8",slot_no:o.add_slot_no||1};s.tbs=PageData.tbs,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/addslot",data:s,dataType:"json"}).success(function(o){if(o&&0===o.no){var t=o.data,e=i._addSuccess();$(".icon_book_msgbox_body").html(e),i._refreshSlotList(),t.scores_other||0,t.scores_money||0,i._updateTdouAccount(t.scores_other,t.scores_money,t.scores_fetch)}else if(o&&2270028===o.no)i.hasNotEnoughTdou();else{var n='<div class="icon_book_error">\u672a\u77e5\u9519\u8bef<a href="javascript:void(0)" id="icon_book_reload" class="icon_book_reload">\u5237\u65b0</a></div>';$(".icon_book_msgbox_body").html(n),$("#icon_book_reload").on("click",function(){return $.tb.location.reload(),!1})}})},_updateTdouAccount:function(o,i,t){var e=PageData.user.Parr_scores;e&&(e.scores_other=o,e.scores_money=i,e.scores_fetch=t,$(".j_userinfo_scores_num").html(o+i))},_showBox:function(o){var i=this;i.hideBox();var t=i._getTpl(),e={content:t,card_css:{width:i._option.width,zIndex:$.getcurzIndex()},auto_positon:!0,event_target:o,attr:"id='icon_book_message_box'",wrap:$("body")};i._icon_book_message_box=i.requireInstance("user/widget/icons/icons_card",e),i._icon_book_message_box.showCard({type:"delayShow",time:200}),i._bindCloseEvent()},_bindCloseEvent:function(){var o=this;$(".icon_book_msgbox .icon_book_msgbox_close").click(function(){o._icon_book_message_box?(o._icon_book_message_box.closeCard(),o._icon_book_message_box=null):$("#icon_book_message_box").length>0&&$("#icon_book_message_box").remove(),$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh")}),$(".icon_book_msgbox .icon_book_msgbox_close").hover(function(){$(this).addClass("icon_book_msgbox_close_hover")},function(){$(this).removeClass("icon_book_msgbox_close_hover")})},_getTpl:function(){var o=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">',"</div>",'<div class="icon_book_msgbox_close"></div>',"</div>",'<div class="icon_book_down_arrow"></div>',"</div>"].join("");return o},_refreshSlotList:function(){var o=$(".j_icon_slot").length,i=28*o,t='<a href="javascript:void(0)" data-slot="'+(o+1)+'" data-name="" title="\u70b9\u51fb\u6dfb\u52a0\u5370\u8bb0" class="j_slot_null_icon j_icon_slot icon_slot_null_icon" style="top:0px;left:'+i+'px"><div class=" j_icon_slot_refresh"></div></a>';$(".icon_slot_wrap .icon_add_solt").css({left:28*(o+1)}),$(".icon_slot_wrap .icon_add_solt").before(t),8==$(".j_icon_slot").length&&$(".icon_add_solt").remove()},_addSuccess:function(){var o=['<div class="icon_msgbox_title"></div>','<div class="icon_msgbox_detail">\u606d\u559c\u60a8\u83b7\u5f97\u4e86\u4e00\u679a\u5370\u8bb0\u63d2\u69fd</div>'].join("");return o},_buyIconSuccess:function(){var o=['<div class="icon_msgbox_title">\u606d\u559c\u60a8\u83b7\u5f97\u4e86\u4e00\u679a\u65b0\u5370\u8bb0</div>','<div class="icon_msgbox_detail"></div>','<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m j_tdou_not_enough" style="height: 27px; border-radius: 3px;"><span><em>\u5feb\u53bb\u56fe\u9274\u770b\u770b\u5427</em></span></a>',"</div>"].join("");return o},_replaceIconSuccess:function(){var o=['<div class="icon_msgbox_title">\u5370\u8bb0\u66ff\u6362\u6210\u529f</div>','<div class="icon_msgbox_detail"></div>','<div class="icon_msgbox_action">','<a  href="javascript:void(0)" class="ui_btn ui_btn_m j_replace_ok" style="height: 27px; border-radius: 3px;"><span><em>\u786e\u5b9a</em></span></a>',"</div>"].join("");return o},_hasNotEnoughTdou:function(){var o=['<div class="icon_msgbox_title">T\u8c46\u4e0d\u8db3</div>','<div class="icon_msgbox_detail"></div>','<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m j_tdou_not_enough" style="height: 27px; border-radius: 3px;"><span><em>\u7acb\u5373\u5145\u503c</em></span></a>',"</div>"].join("");return o},_getBuySlotTpl:function(o){var i={price:o.price},t=['<div class="icon_msgbox_title">\u9700\u8981\u6d88\u8017#{price}T\u8c46\u5f00\u542f\u5370\u8bb0\u63d2\u69fd</div>','<div class="icon_msgbox_detail" style="padding-top:15px;">(\u5f00\u542f\u540e\u514d\u8d39\u66f4\u6362\u5370\u8bb0)</div>','<div class="icon_msgbox_action" style="padding-top: 25px;">','<a href="javascript:void(0)" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px;"><span><em>\u5f00\u542f</em></span></a>',"</div>"].join("");return $.tb.format(t,i)},_getReplaceFirstSlotTipTpl:function(o){var i=this,t=o.old_icon_info,e=o.icon_info,n=this.common.isShowDurationIcon(t),_=n?i._getIconBackground(t):"",a=i._getIconBackground(e),s={old_background:_,background:a},c=['<div class="icon_msgbox_title">\u70b9\u51fb\u66ff\u6362\u5f53\u524d\u5370\u8bb0</div>','<div class="icon_msgbox_icon_replace_detail">','<div class="msg_icon_replace_current" style="#{old_background}"></div>','<div class="msg_icon_replace_arrow"></div>','<div class="msg_icon_replace_new" style="#{background}"></div>',"</div>",'<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px"><span><em>\u66ff\u6362</em></span></a>',"</div>"].join("");return $.tb.format(c,s)},_getIconBackground:function(o){var i=0,t=0,e="//tb1.bdstatic.com/tb/cms/com/icon/"+o.category_id+"_"+this.spriteImgSize+".png";if(o){var n=o.sprite[o.value].split(","),_=50,a=n[0],s=n[1];i=0,t=s*_;var c="background: url("+e+"?stamp="+a+") no-repeat -"+t+"px -"+i+"px;";return c}return""},_getBuyIconTpl:function(o){var i=this,t=i._getIconBackground(o.icon_info),e={price:o.icon_info.price,background:t},n=['<div class="icon_msgbox_title">\u9700\u8981\u6d88\u801710000T\u8c46\u8d2d\u4e70\u8be5\u5370\u8bb0</div>','<div class="icon_msgbox_icon_buy">','<div class="msg_icon_buy_icon" style="#{background}}"></div>',"</div>",'<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m">',"<span><em>\u8d2d\u4e70</em></span>","</a>","</div>"].join("");return $.tb.format(n,e)},hasNotEnoughTdou:function(o){var i=this;o||(o=$(".icon_wrap .j_icon_slot_refresh")),i._showBox(o);var t=i._hasNotEnoughTdou();$(".icon_book_msgbox_body").html(t),$(".j_tdou_not_enough").on("click",function(){_.Module.use("common/widget/TchargeDialog")})},replaceIconSuccess:function(o){var i=this,t=$(".icon_wrap .icon_slot_refresh");t&&(t=t.parent()),i._showBox(t);var e=i._replaceIconSuccess();if($(".icon_book_msgbox_body").html(e),$(".icon_book_msgbox_body .j_replace_ok").on("click",function(){$.tb.location.reload()}),$(".icon_book_msgbox .icon_book_msgbox_close").click(function(){$.tb.location.reload()}),o){var n=o.getControl();n&&n.closeIconBook()}}}}),_.Module.define({requires:["user/widget/icons/icons_book_common"],path:"user/widget/icons/icons_book_get_icon",sub:{_dialog:null,initial:function(){this.common=this.requireInstance("user/widget/icons/icons_book_common")},get:function(){return this._dialog},show:function(){this._dialog.show()},hide:function(){this._dialog.hide()},close:function(){this._dialog.close()},_init:function(o){var i={modal:!0,showTitle:!1,fixed:!0,width:290,height:180},t=this;i.html='<div class="icon_book_dialog_wrap">'+o+"</div>",this._dialog=new $.dialog(i),this._dialog.element.find(".icon_book_dialog_wrap .icon_book_msgbox_close").click(function(o){o.preventDefault(),t._dialog.close()}),this._dialog.element.find(".icon_book_dialog_wrap .icon_book_msgbox_close").hover(function(){$(this).addClass("icon_book_msgbox_close_hover")},function(){$(this).removeClass("icon_book_msgbox_close_hover")})},getOneIcon:function(o){var i=this;if(!o)return i._handleError(),void 0;var t={ie:"utf-8"};t.tbs=PageData.tbs,t.icon_name=o,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/seticon",data:t,dataType:"json"}).success(function(o){if(o&&0===o.no){var t=o.data;if(!t.icon_info)return i._handleError(),void 0;i.showOneIcon(t.icon_info)}else o&&2380009===o.no?$.dialog.alert("\u540c\u540dicon\u53ea\u80fd\u4f69\u6234\u4e00\u4e2a\uff01"):i._handleError()})},_handleError:function(){var o=this,i=o._getErrorTpl();o._init(i),o.show(),this._dialog.element.find(".icon_book_dialog_wrap .ui_btn").click(function(){$.tb.location.reload()})},showOneIcon:function(o){var i=this,t=i._getOneIconTpl(o);i._init(t),i.show()},_getOneIconTpl:function(o){if(o){var i=this._getIconStyle(o),t={styleBg:i,iconTitle:o.title},e=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">','<div class="icon_msgbox_title">\u606d\u559c\u4f60\u83b7\u5f97\u4e86#{iconTitle}</div>','<div class="icon_msgbox_get_icon">','<div class="msg_icon_get_one" style="left:110px;background: #{styleBg}"></div>','<div class="msg_icon_get_two"></div>','<div class="msg_icon_get_three"></div>',"</div>",'<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m">',"<span><em>\u5feb\u53bb\u770b\u770b\u6211\u7684\u56fe\u9274</em></span>","</a>","</div>","</div>",'<div class="icon_book_msgbox_close"></div>',"</div>","</div>"].join("");return $.tb.format(e,t)}},showDurationIcon:function(o,i){var t=[];t.push(o),this.showIconList(t,i,"duration")},showIconList:function(o,i,t){var e=this,n={hide_btn:!1,close_callback:function(){},close_time:0};n=$.extend(n,i);var _=e._getIconListTpl(o,n.hide_btn,t);e._init(_),e.show(),n.close_time&&parseInt(n.close_time)>0&&setTimeout(function(){e._dialog.close()},parseInt(n.close_time)),n.close_callback&&"function"==typeof n.close_callback&&e._dialog.onclose(function(){n.close_callback()})},_getIconListTpl:function(o,i,t){var e=this,n=PageData.user.portrait;if(o||$.isArray(o)){for(var _=[],a=[],s="",c=i?"":['<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m">',"<span><em>\u5feb\u53bb\u770b\u770b\u6211\u7684\u56fe\u9274</em></span>","</a>","</div>"].join(""),r=0;r<o.length;r++){var l=e._getIconFormatInfo(o[r],o.length);_.push(l.iconTitle),a.push(l.iconTpl)}if(_=_.join(","),a=a.join(""),t&&"duration"==t){var d=this.common.getIconExpired(o[0]);d>-1&&(s="<span>\u6709\u6548\u5929\u6570\uff1a"+d+"</span><br>")}var u=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">','<div class="icon_msgbox_title">\u606d\u559c\u4f60\u83b7\u5f97\u4e86'+_+"</div>",'<div class="icon_msgbox_get_icon clearfix">',a,"</div>",c,'<p class="icon_book_go_home">',s,'<a href="/home/main?id='+n+'&fr=icon" target="_blank">\u53bb\u6211\u7684\u4e2a\u4eba\u4e2d\u5fc3\u67e5\u770b>></a>',"</p>","</div>",'<div class="icon_book_msgbox_close"></div>',"</div>","</div>"].join("");return u}},_getIconFormatInfo:function(o,i){var t=this._getIconStyle(o),e={iconTpl:'<div class="msg_icon_get msg_icon_get_'+parseInt(i)+'" style="left:110px;'+t+'"></div>',styleBg:t,iconTitle:o.title};return e},_getIconStyle:function(o){var i=0,t=0,e="//tb1.bdstatic.com/tb/cms/com/icon/icon_sprite.png",n=o.sprite[o.value].split(","),_=50,a=n[0],s=n[1];i=2*_,t=s*_;var c="background: url("+e+"?stamp="+a+") no-repeat -"+t+"px -"+i+"px;";return c},_getErrorTpl:function(){var o=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">','<div class="icon_msgbox_title">\u672a\u77e5\u9519\u8bef</div>','<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px;">',"<span><em>\u5237\u65b0</em></span>","</a>","</div>","</div>",'<div class="icon_book_msgbox_close"></div>',"</div>","</div>"].join("");return o}}}),_.Module.define({requires:["user/widget/icons/icons_book_view","user/widget/icons/icons_book_messagebox","user/widget/icons/icons_card","user/widget/icons/icons_book_tip"],path:"user/widget/icons/icons_book_control",sub:{_icon_book:null,_icon_book_ajax:null,_icon_user_action:"",_icon_tab_loaded:{},_tip:null,_messagebox:null,tabLen:0,_slot_no:0,_icon_info:{},_current_tab_index:0,_selected_icon_name:"",_target_ele:null,_option:{width:655},_slot_buy_price:[0,0,100,1e4,3e4,5e4,1e4,2e4,1e5],initial:function(){var o=this;o._wrap=$("body"),o._view=o.requireInstance("user/widget/icons/icons_book_view");var i=PageData.category_info,t=i.category_list||[{category_id:"101",category_name:"\u8db3\u7403"},{category_id:"102",category_name:"\u661f\u5ea7"},{category_id:"104",category_name:"\u5176\u4ed6"}];o.defaultCategoryId=o._getDefaultCategoryId(i.default_category),o.bindIconBookHookEvents(t)},bindIconBookHookEvents:function(o){var i=this;i._wrap.delegate(".j_icon_slot_buy","mouseenter",function(){i.__timeoutId&&clearTimeout(i.__timeoutId),i.closeAllCard(),i._icon_user_action="buy_slot",i._target_ele=$(this),i._selected_icon_name="";var o=$(".j_icon_slot").length;return i._slot_no=1,i.buySlot({add_slot_no:o+1,price:i._slot_buy_price[o+1],action:"buy_slot"},$(this)),!1}),i._wrap.delegate(".j_icon_slot_buy","mouseleave",function(){return i.__timeoutId&&clearTimeout(i.__timeoutId),i.__timeoutId=setTimeout(function(){i._messagebox&&i._messagebox.hideBox()
},200),!1}),i._wrap.delegate(".j_icon_slot","click",function(t){i.closeAllCard(),i._setIconRefresh($(this)),i._icon_user_action="replace_icon",i._target_ele=$(this);var e=$(this).tbattr("data-slot"),n=$(this).tbattr("data-name");i._selected_icon_name=n,i._slot_no=e;var _="",a={};for(var s in a)a[s].name==n&&(_=a[s].category_id);i.initIconBook({slot_no:e,category_info:o,icon_id:n,action:"replace_icon",category_id:_},$(this)),t.preventDefault()}),i._wrap.delegate(".j_slot_null_icon","click",function(t){t.preventDefault(),i.closeAllCard(),i._selected_icon_name="",i._setIconRefresh($(this)),i._icon_user_action="buy_icon",i._target_ele=$(this);var e=$(this).tbattr("data-slot");i._slot_no=e,i.initIconBook({slot_no:e,category_info:o,icon_id:"",action:"buy_icon"},$(this))}),i._wrap.delegate(".j_icon_slot","hover",function(o){var i=$(this);if(!i.hasClass("j_slot_null_icon")){var t=$(this).tbattr("data-name"),e=($(this).tbattr("data-slot"),{});if(e){var n=null;for(var _ in e)if(e[_].name==t){n=e[_];break}if(n&&n["level_"+n.value]){var a=n["level_"+n.value],s="url("+a.icon_1+") no-repeat",c=o||event;if("mouseenter"==c.type){var r={background:s},l=i.css("background");l||(l=i[0].style.background),i.data({bg:l}),i.css(r),i.addClass("icon_slot_hover"),i.children(".j_icon_slot_refresh").addClass("icon_slot_refresh_hover")}else{var l=i.data("bg"),r={background:l};i.css(r),i.removeClass("icon_slot_hover"),i.children(".j_icon_slot_refresh").removeClass("icon_slot_refresh_hover")}}}}})},buySlot:function(o,i){var t=this;t._messagebox||(t._messagebox=t.requireInstance("user/widget/icons/icons_book_messagebox")),t._messagebox.is_leave_close=!0,t._messagebox.showBox(o,i)},initIconBook:function(o,i){var t=this,e=o.category_info;t.closeIconBook();var n=t._view.getTabItem(e),_={content:n,card_css:{width:t._option.width,zIndex:$.getcurzIndex()},auto_positon:!0,event_target:i,attr:"id='icon_book_tab'",wrap:$("body")};if(t._icon_book=t.requireInstance("user/widget/icons/icons_card",_),t._icon_book.showCard({type:"delayShow",time:200}),t.initTab(),o.icon_id){var a=t._getTabIdByCategory(o.category_id);t._selected_icon_name=o.icon_id,t._showTab(a,o.icon_id)}else t._showTab(t._getDefaultIndex(t.defaultCategoryId))},closeIconBook:function(){var o=this;o._tip&&o._tip.closeTip(),o._icon_book&&(o._icon_book.closeCard(),o._icon_book=null)},initTab:function(){var o=this;o.tabLen=$(".icon_book_tab_head li").length,o._bindHeadEvents()},_bindHeadEvents:function(){var o=this;$(".icon_book_tab_head").delegate("li","click",function(){var i=$(this).index();o._showTab(i),o._tip&&o._tip.hideTip()}),$(".icon_book_close").click(function(){return $("#icon_book_tab").remove(),o._tip&&(o._tip.hideTip(),o._tip=null),$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh"),!1}),$(".icon_book_close").hover(function(){$(this).addClass("icon_book_close_hover")},function(){$(this).removeClass("icon_book_close_hover")})},_showTab:function(o,i){var t=this;$(".icon_book_tab_head .head_inner").each(function(){!$(this).hasClass("space")&&$(this).parent().index()<t.tabLen-1&&$(this).addClass("space")}),0>o?"0":$("#tab_head_"+(o-1)+" div.space").removeClass("space"),$(".icon_book_tab_head li.tab_active").removeClass("tab_active").addClass("tab_deactive"),$("#tab_head_"+o).removeClass("tab_deactive").addClass("tab_active"),$(".icon_book_tab_body div.tab_body_item_active").removeClass("tab_body_item_active"),$("#tab_content_"+o).addClass("tab_body_item_active"),i=i||t._selected_icon_name,t._loadTabContent(o,i),t._current_tab_index=i},_loadTabContent:function(o,i){var t=this,e='<div class="icon_book_error">\u6b63\u5728\u52aa\u529b\u52a0\u8f7d\uff0c\u8bf7\u7a0d\u540e...</div>';$("#tab_content_"+o).html(e);var n={ie:"utf-8"},_=$("#tab_head_"+o).tbattr("data-categoryId");n.tbs=PageData.tbs,n.category_id=_,t._icon_book_ajax&&t._icon_book_ajax.abort(),t._icon_book_ajax=$.ajax({type:"post",url:"/icon/submit/icon",data:n,dataType:"json"}).success(function(e){if(e&&0===e.no){var n=e.data,a=n.icon_info,s=t._view.getTabContent(a,i,_);$("#tab_content_"+o).html(s),t._bindTabContenEvent(o),t.initScroll(o),t._icon_tab_loaded[o]=!0,t._icon_info["category_"+o]=n.icon_info}else{var s='<div class="icon_book_error">\u672a\u77e5\u9519\u8bef<a href="javascript:void(0)" id="icon_book_reload" class="icon_book_reload">\u5237\u65b0</a></div>';$("#tab_content_"+o).html(s),$("#icon_book_reload").on("click",function(){return t._loadTabContent(o),!1})}})},_bindTabContenEvent:function(){var o=this;o._tip||(o._tip=o.requireInstance("user/widget/icons/icons_book_tip",[o]));var i=$("#icon_book_wrap");i.on("mouseenter",".tab_body_item_active .icon_box_place",function(){$(this).children(".icon_border").addClass("icon_border_hover")}).on("mouseleave",".tab_body_item_active .icon_box_place",function(){$(this).children(".icon_border").removeClass("icon_border_hover")}),i.delegate(".icon_wrap .icon_box_place","mouseenter",function(){var i=o._target_ele.tbattr("data-name"),t=$(this).tbattr("data-id"),e=$(this).tbattr("data-level"),n=$(this).hasClass("icon_not_use"),_=$(".icon_book .tab_body_item_active")[0].id.replace("tab_content_",""),a=o._icon_info["category_"+_],s=null,c=null;if(a){a=a.normal||[];for(var r=0;r<a.length;r++)a[r].name==t&&(s=a[r]),i&&a[r].name==i&&(c=a[r])}var l={icon_id:t,in_use:!n,slot_no:o._slot_no,value:e,icon_info:s,old_icon_id:i,old_icon_info:c};o._tip.showTip(l,$(this))}),i.delegate(".icon_view","mouseleave",function(){setTimeout(function(){o._tip&&o._tip.hideTip&&o._tip.hideTip()},1500)}),i.delegate(".collect_icon_wrap .icon_box_place","mouseenter",function(){if(!($(this).children(".icon_locked").length>0)){var i=o._target_ele.tbattr("data-name"),t=$(this).tbattr("data-id"),e=$(this).tbattr("data-level"),n=$(this).hasClass("icon_not_use"),_=$(".icon_book .tab_body_item_active")[0].id.replace("tab_content_",""),a=o._icon_info["category_"+_],s=null,c=null;if(a){a=a.advanced||[];for(var r=0;r<a.length;r++)a[r].name==t&&(s=a[r]),i&&a[r].name==i&&(c=a[r])}var l={icon_id:t,in_use:!n,slot_no:o._slot_no,value:e,icon_info:s,old_icon_id:i,old_icon_info:c};o._tip.showTip(l,$(this))}}),i.delegate(".collect_icon_wrap .icon_box_place","mouseleave",function(){setTimeout(function(){o._tip.hideTip()},6e3)})},_getTabIdByCategory:function(o){for(var i=this,t=$(".icon_book_tab_head li"),e=0;e<t.length;e++)if($(t[e]).tbattr("data-categoryId")==o)return e;return i._getDefaultIndex(i.defaultCategoryId)},_getDefaultCategoryId:function(o){var i="";for(var t in o)i=t;return i},_getDefaultIndex:function(o){for(var i=$(".icon_book_tab_head li"),t=0;t<i.length;t++)if($(i[t]).tbattr("data-categoryId")==o)return t},initScroll:function(o){var i=this,t=$("#tab_content_"+o+" .icon_wrap");t&&t.length>0&&i.bindArrowScrollEvent("icon_wrap");var e=$("#tab_content_"+o+" .collect_icon_wrap");e&&e.length>0&&i.bindArrowScrollEvent("collect_icon_wrap")},bindArrowScrollEvent:function(o){var i=this;$("."+o).delegate(".icon_wrap_scroll_arrow","hover",function(){$(this).hasClass("arrow_disable")||$(this).toggleClass("arrow_hover")}),$("."+o).delegate(".right_arrow","click",function(){i._move("left",o),i._tip&&i._tip.hideTip()}),$("."+o).delegate(".left_arrow","click",function(){i._move("right",o),i._tip&&i._tip.hideTip()})},_move:function(o,i){var t=this,e=0,n=$($(".tab_body_item_active ."+i+" .icon_view")[0]).tbattr("total-col");switch(n=parseInt(n),o){case"left":e=t._moveLeft(n,i);break;case"right":e=t._moveRight(n,i)}e&&$(".tab_body_item_active .icon_wrap .icon_list").animate({left:e},300);var _=55*n;e&&(e=Math.abs(parseInt(e)),e+550>=_?($(".tab_body_item_active ."+i+" .icon_wrap_right_arrow").addClass("arrow_disable"),$(".tab_body_item_active ."+i+" .icon_wrap_left_arrow").removeClass("arrow_disable")):($(".tab_body_item_active ."+i+" .icon_wrap_right_arrow").removeClass("arrow_disable"),$(".tab_body_item_active ."+i+" .icon_wrap_left_arrow").removeClass("arrow_disable")),0==e&&($(".tab_body_item_active ."+i+" .icon_wrap_right_arrow").removeClass("arrow_disable"),$(".tab_body_item_active ."+i+" .icon_wrap_left_arrow").addClass("arrow_disable")))},_moveLeft:function(o,i){var t=0,e=o;if(!(10>=e)){var n=55*e,_=$(".tab_body_item_active ."+i+" .icon_list").css("left"),a=Math.abs(parseInt(_));a%55!=0&&(a=a%55*55);var s=n-a;if(s>550)return t=a+165,"-"+t+"px"}},_moveRight:function(o,i){var t=0,e=o;if(!(10>=e)){var n=$(".tab_body_item_active ."+i+" .icon_list").css("left"),_=parseInt(n);if(!(_>=0))return t=Math.abs(_)-165,0>t&&(t=0),"-"+t+"px"}},closeAllCard:function(){var o=this;o._tip&&o._tip.closeTip(),o._messagebox&&o._messagebox.hideBox(),o.closeIconBook(),o._removeIconRefresh()},_setIconRefresh:function(o){$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh"),o.children(".j_icon_slot_refresh").addClass("icon_slot_refresh")},_removeIconRefresh:function(){$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh")}}}),_.Module.define({path:"user/widget/icons/icons_book_common",requires:[],sub:{initial:function(){},isDurationIcon:function(o){return o?4==o.type?!0:!1:!1},getIconExpired:function(o){var i=-1;if(!o)return i;var t=o.type,e=o.end_time,n=(new Date).getTime()/1e3;return 4==t&&e>=n&&(i=((e-n)/86400).toFixed(1)),i},isShowDurationIcon:function(o){if(!o)return!1;var i=o.type,t=o.end_time,e=(new Date).getTime()/1e3;return 4!=i?!0:t>=e?!0:!1}}}),_.Module.define({path:"user/widget/icons",requires:["user/widget/user_api","user/widget/icons/icons_book_common"],sub:{iconClassList:{0:"",1:"icon-crown-vip",2:["icon-crown-super-vip","icon-crown-super-v1","icon-crown-super-v2","icon-crown-super-v3","icon-crown-super-v4","icon-crown-super-v5"],3:["icon-crown-year-vip","icon-crown-year-v1","icon-crown-year-v2","icon-crown-year-v3","icon-crown-year-v4","icon-crown-year-v5"]},overdueSuperIconList:["icon-crown-super-non","icon-crown-super-non1","icon-crown-super-non2","icon-crown-super-non3","icon-crown-super-non4","icon-crown-super-non5"],initial:function(){this._buySlot=$(".j_icon_slot_buy"),this._icon_book_wrap=$(".j_book_icon"),this.common=this.requireInstance("user/widget/icons/icons_book_common"),PageUnit.load("icons_category"),this.userApi=this.requireInstance("user/widget/user_api",[])},getCrownIconClass:function(o,i){var t=$.getPageData("vipInfo.v_level",0,o),e=this.userApi.getUniversalMemberLevelOf(o),n=$.getPageData("vipInfo.v_status",0,o);n=parseInt(n,10),e=3===n?3:e;var _="";if(i){if(this.userApi.checkOverdueSuperMembershipOf(o))return this.overdueSuperIconList[t];if(0===e)return _="icon-crown-super-non"}switch(e){case 0:_=this.iconClassList[e];break;case 1:_=this.iconClassList[e];break;case 2:case 3:_=this.iconClassList[e][t]}return _},getPreIconHtml:function(o,i,t){var e={};e.mParr_props=o,i=i||e;var n,_=["\u8d34\u5427\u4f1a\u5458","\u8d34\u5427\u8d85\u7ea7\u4f1a\u5458"],a="",s=Math.round((new Date).getTime()/1e3),c=((new Date).getTime(),$.getPageData("forum.id",0)),r="";return this.userApi.checkSingleForumMembershipOf(i,c)&&(a='<div class="pre_icon_wrap pre_icon_wrap_theme"><a class="icon_tbworld icon-vip3-16" title="\u672c\u5427\u4f1a\u5458" href="/tbmall/tshow" onclick="return false" target="_blank"></a></div>'),o&&o.level&&o.level.end_time>s?(r=this.getCrownIconClass(i),a='<div class="pre_icon_wrap pre_icon_wrap_theme1">',n=$.getPageData("level.props_id",0,o),a+='<a class="icon_tbworld '+r+'" href="/tbmall/tshow" target="_blank" title="'+_[n-1]+'"></a>',a+="</div>"):t&&(r=this.getCrownIconClass(i,!0),a='<span class="pre_icon_wrap pre_icon_wrap_theme1">',n=$.getPageData("level.props_id",0,o),a+='<a class="icon_tbworld '+r+'" href="/tbmall/tshow" target="_blank" title="'+_[n-1]+'"></a>',a+="</span>"),a},getTbvipIconHtml:function(o,i,t){i=i?i:1,t=t?t:"";var e="";return o&&o.type&&(e='<span class="tbvip_icon_wrap tbvip_icon_wrap_theme'+i+" "+t+'"><a class="icon_tbvip icon_tbvip_type'+o.type+'" href="/tbvip/index"target="_blank" title="'+o.intro+'"></a></span>'),e},getIconsHtml:function(o,i,t,e){var n,_=$("<div>"),t=t?t:5,a=o.new_iconinfo,s=0;for(var c in a)s++;var r='<span class="icon_wrap  icon_wrap_theme1">',l=0;if(!a){var d=o.iconinfo;if(d){var u=d[0];n=this._getOldHtml(u,1),r+=e?_.html($(n).tbattr("data-field",this.getCommonIconDataNeed(u)).addClass("j_icon_slot")).html():n}}for(var b in a){var v=a[b];if(l==t)break;if($.isEmptyObject(v)){if("1"==b){var d=o.iconinfo;if(!$.isEmptyObject(d)){var u=this._getReplaceIcon(d,a);if(!u)continue;n=this._getOldHtml(u,1),r+=e?_.html($(n).tbattr("data-field",this.getCommonIconDataNeed(u)).addClass("j_icon_slot")).html():n,l++}}}else this.common.isShowDurationIcon(v)&&(n=this._getIconHtml(v,1),r+=e?_.html($(n).tbattr("data-field",this.getCommonIconDataNeed(v)).addClass("j_icon_slot")).html():n,l++)}return r+="</span>"},_getReplaceIcon:function(o,i){if($.isEmptyObject(i))return o[0];for(var t=0;t<o.length;t++){var e=o[t];if(!this._judgeIconInNewiconinfo(i,e))return e}return null},_judgeIconInNewiconinfo:function(o,i){if($.isEmptyObject(o))return!1;if($.isEmptyObject(i))return!1;for(var t in o){var e=o[t];if(e&&e.name==i.name)return!0}return!1},_imgSize:{1:14,2:18},_oldIconTitle:{is_lottery_1:"\u94c1\u724c\u4e16\u754c\u676f\u8fbe\u4eba",is_lottery_2:"\u94dc\u724c\u4e16\u754c\u676f\u8fbe\u4eba",is_lottery_3:"\u94f6\u724c\u4e16\u754c\u676f\u8fbe\u4eba",is_lottery_4:"\u91d1\u724c\u4e16\u754c\u676f\u8fbe\u4eba",is_coreuser_1:"\u8d34\u5427\u6838\u5fc3\u7528\u6237",is_verify_1:"\u767e\u5ea6\u8d34\u5427\u5b98\u65b9\u5e73\u53f0\u8ba4\u8bc1",user_type_1:"\u8d34\u5427\u5b9e\u540d\u8ba4\u8bc1",is_battle_1:"\u8d34\u5427\u62f3\u738b",is_welfare_1:"\u798f\u5229\u5370\u8bb0"},_getOldHtml:function(o,i){var t="",e=o.sprite[o.value];if(!e)for(var n in o.sprite){if(o.sprite[n]&&(0!=o.value||"meizhi_level"==o.name)){e=o.sprite[n];break}return t}var _=o.icon+"?stamp="+e.split(",")[0];switch(background='style="background: url('+_+") no-repeat center center; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+_+',sizingMethod=scale); background-size: 14px 14px"',o.name){case"meizhi_level":var a=o.value;a=a?a:0,a>=2&&(a-=2,t+='<a class="old_icon_size" '+background+' class="maizhi_link" href="/p/'+o.meizhi_thread_id+'" target="_blank" title="\u8d34\u5427\u59b9\u7eb8\u8ba4\u8bc1"><span class="icon_meizhi meizhi_level_'+a+'"></span></a>');break;case"is_member":t+='<a class="old_icon_size" '+background+' target="_blank"  class=" icon_fanclub"  title="\u7c89\u4e1d\u4f1a\u5458"></a>';break;default:t+=o.title_url?'<a class="old_icon_size" '+background+' target="_blank"  href="'+o.title_url+'"  title="'+o.title+'"  locate="'+o.name+"_"+o.value+'"> </a>':'<span class="old_icon_size" '+background+' title="'+this._oldIconTitle[o.name+"_"+o.value]+'"  locate="'+o.name+"_"+o.value+'"></span>'}return t},_getIconHtml:function(o,i){var t,e,n,_,a,i=i||1,s=50,c="",r="//tb1.bdst",l=r+"atic.com/tb/cms/com/icon/";if(t=o.sprite[o.value],!t)for(var d in o.sprite){if(o.sprite[d]&&(0!=o.value||"meizhi_level"==o.name)){t=o.sprite[d];break}return c}e=t.split(","),n=e[0],_=e[1];var u=l+o.category_id+"_"+this._imgSize[i]+".png?stamp="+n;switch(a='style="background: url('+u+") no-repeat -"+_*s+"px  -"+(i-1)*s+'px;"',o.name){case"meizhi_level":var b=o.value;b=b?b:0,b>=2&&(b-=2,c+="<a "+a+' class="maizhi_link" href="/p/'+o.meizhi_thread_id+'" target="_blank" title="\u8d34\u5427\u59b9\u7eb8\u8ba4\u8bc1"><span class="icon_meizhi meizhi_level_'+b+'"></span></a>');break;case"is_member":c+="<a "+a+' target="_blank"  class=" icon_fanclub" ></a>';break;default:if(o.title_url)c+="<a "+a+' target="_blank"  href="'+o.title_url+'"  title="'+o.title+'"  locate="'+o.name+"_"+o.value+'"> </a>';else{{o.title}c+="<span "+a+' title="'+o.title+'"  locate="'+o.name+"_"+o.value+'"></span>'}}return c},getCommonIconDataNeed:function(o){var i={};return i.name=o.name,i.end_time=o.end_time,i.category_id=o.category_id,i.slot_no=o.slot_no,i.title=o.title,i.intro=o.intro,i.intro_url=o.intro_url,i.price=o.price,i.value=o.value,i.sprite=o.sprite,JSON.stringify(i)}}});!function(){var e={},a={};_.Module.define({path:"encourage-payment/widget/base_user_data",requires:[],sub:{initial:function(r){r&&(r=$.extend({},r),e=r.scores||e,a=r.level||a)},route:{getTdou:"//tieba.baidu.com/tbmall/getUserTd"},_item_cache_last_total_tdou:0,_parrScores:null,_parrProps:null,getUserName:function(){return PageData.user.name||PageData.user.name_url},getUserTdou:function(){var e=window.EncourageData.userScore,a=(PageData.user,this._parrScores||e);return a&&!$.isEmptyObject(a)?a.scores_money+a.scores_other:0},getShowName:function(){return PageData.user.name_show||PageData.user.user_name},isMemeber:function(){var e=this._getMaxLevel(a);return!!e},getMemberLevel:function(){var e=this._getMaxLevel(a);return e},getMemberIcon:function(){var e=e||window.EncourageData.userLevel,a=this._getMaxLevelExpire(e),r=this.getMemberIconByLevel(a);return console.log("level",a,r),r},getMemberIconByLevel:function(e){e&&(e=parseInt(e));var a="",r="",t="";switch(e){case-1:a=" icon-vip1-gray-18 base_member_icon",r="\u8d34\u5427\u4f1a\u5458",t="\u7eed\u8d39\u8d34\u5427\u4f1a\u5458";break;case 1:a=" icon-vip1-18 base_member_icon",r="\u7eed\u8d39\u8d34\u5427\u4f1a\u5458",t="\u5f00\u901a\u8d34\u5427\u4f1a\u5458";break;case-2:a=" icon-vip2-gray-18 base_member_icon",r="\u7eed\u8d39\u8d34\u5427\u8d85\u7ea7\u4f1a\u5458",t="\u5f00\u901a\u8d34\u5427\u8d85\u7ea7\u4f1a\u5458";break;case 2:a=" icon-vip2-18 base_member_icon",r="\u8d34\u5427\u8d85\u7ea7\u4f1a\u5458",t="\u7eed\u8d39\u8d34\u5427\u8d85\u7ea7\u4f1a\u5458";break;default:a="",r=""}var n={icon:a,title:r,action_title:t,level:e};return n},isLogin:function(){return PageData.user.is_login},needUpdateTdou:function(){var r=a,t=e;return!(r&&t)},_getMaxLevel:function(e){var a=0,r=(new Date).getTime(),t=e||window.EncourageData.userLevel||{};return t&&1e3*t.end_time>r&&parseInt(t.props_id,10)>a&&(a=parseInt(t.props_id,10)),a},_getMaxLevelExpire:function(e){var a=0,r=(new Date).getTime(),t=e||window.EncourageData.userLevel;return t&&parseInt(t.props_id,10)>a&&(a=parseInt(t.props_id,10),1e3*t.end_time<=r&&(a=0-a)),a},getTdou:function(e,a,r){var t=this;t._get_tdou_ajax&&t._get_tdou_ajax.abort(),t._get_tdou_ajax=$.ajax({type:"get",url:t.route.getTdou+"?"+new Date,data:{},cache:!1,dataType:"json"}).success(function(t){e.call(a,t,r)})},getSimpleUserData:function(){return{mParr_props:{level:EncourageData.userLevel},Parr_scores:EncourageData.userScore,vipInfo:EncourageData.vipInfo}},getUserTreasure:function(){return window.EncourageData.userScore?window.EncourageData.userScore.treasure_coin_total||0:0}}})}();_.Module.define({path:"encourage-payment/widget/base_dialog_user_bar",requires:["encourage-payment/widget/base_user_data","user/widget/icons"],sub:{tpl:'<div class="base_dialog_user_bar base_user_data">      <%if(!is_tdou_info_display){%>      <div class="header_title_member">          <span>\u73a9\u8d34\u5427 \u4eab\u7279\u6743</span>      </div>      <%}else{%>        <div class="header_title">      <span class="header_icon"></span>      <span>          <%=title%>      </span>      </div>      <div class="user_info">      <span class="title_acc">\u8d26\u53f7\uff1a          <%= userIcon %>          <a class="title_acc_name <%=member_red%> ">              <%=user_name%>          </a>      </span>      <span class="tdou_remain">T\u8c46\u4f59\u989d\uff1a          <span class="tdou_remain_num">          <span class="user_tdou_icon"></span>          <span class="j_tdou">              <%=tdou_num%>          </span>          </span>      </span>      </div>      <%}%>        <a class="header_close j_header_close"></a>  </div>  ',initial:function(){this.dataProxy=this.requireInstance("encourage-payment/widget/base_user_data"),this.member=this.dataProxy.getMemberIcon(),this.icon=this.requireInstance("user/widget/icons")},getUserBarTemplate:function(e){var a=this,s="",t=!0;e&&"getmember"==e?(s=a.member.action_title,t=!1):s="\u83b7\u53d6T\u8c46";var r="",i=a.member.icon;("ordinary_member_icon"==$.trim(i)||"super_member_icon"==$.trim(i)||i.indexOf("vip1-18")>0||i.indexOf("vip2-18")>0)&&(r=" member_red ");var n=this.dataProxy.getSimpleUserData(),_=this.icon.getPreIconHtml($.getPageData("mParr_props",{},n),n,!0),d={user_name:a.dataProxy.getUserName(),tdou_num:a.dataProxy.getUserTdou(),member:a.member.icon,member_red:r,title:s,is_tdou_info_display:t,userIcon:_},o=window._.template(a.tpl,d);return o}}});_.Module.define({path:"encourage-payment/widget/qianbao_cashier_dialog",requires:["encourage-payment/widget/base_user_data"],sub:{iframeContainerId:"qianbao_cashier_payment_channel_wrap",qianbaoLbscashierUrl:"//zhifu.baidu.com/static/epic/fe_wallet_cashier/page/iframe/cashier.js?t="+(new Date).getTime(),services:{createOrder:"/tbmall/getPayUrl",getOrder:"/tbmall/getorder"},initial:function(){this.dataProxy=this.requireInstance("encourage-payment/widget/base_user_data")},createMain:function(a,e,t){var i=this;window.qianbaoCashier=function(){return i}(),i.setLoading(),$.isFunction(t)&&t(i.$root),i.changeoPayAmount(a,e),i.qianbao_params_json=i.getParams(a)},buildCashier:function(a,e){var t=this;t.cashier?t.cashier.updateOrder(a):(1==e?t.cashier=new window.lbscashier({onmessage:t.onMessage,containerId:t.iframeContainerId,data:a,height:340}):2==e&&(t.cashier=new window.lbscashier({onmessage:t.onMessage,containerId:t.iframeContainerId,data:a,height:420})),$("#cashier-iframe").css({border:"none"}))},onMessage:function(a){var e=window.qianbaoCashier;if(!a)return console.log("onmessage null"),void 0;var t=a.type,i=a.data,o=a.option,s=o&&o.channel,n=!1;if("updateOrder"===t)e.clearPayLoading();else if("pay"===t)switch(i){case"submit":if("wechat"===s||"alipayqr"===s||"gameyeepay"===s||"mobileyeepay"===s)return;e.showPaymentTip(),e.track("pay-submit");break;case"addcard":break;case"success":e.track("pay-success");var c="wechat"===s||"alipayqr"===s||"gameyeepay"===s||"mobileyeepay"===s?!0:!1;c?(n=!0,e.checkQrcodePaymentResult()):e.showPaymentTip(c)}else if("qrcodeAlipay"===t)switch(i){case"success":e.showPaymentTip(),e.track("alipay-qrcode-success")}else if("qrcodeWechat"===t)switch(i){case"success":e.showPaymentTip(),e.track("wechat-qrcode-success")}n||e.clearLoading()},getSmallUser:function(){var a=PageData.user.id,e=a%2;return!e},showDialog:function(a,e,t,i){var o=this;1==t?$.stats.track("all","\u6253\u5f00\u4f1a\u5458\u6536\u94f6\u53f0","all","show"):2==t&&$.stats.track("all","\u6253\u5f00T\u8c46\u8ba2\u5355\u652f\u4ed8\u9875","all","show");var s=a.qianbao_params;o.product=a.product,$.JsLoadManager.loadUrl(o.qianbaoLbscashierUrl,function(){o.buildDialog(e),o.createMain(s,t,i)})},buildDialog:function(a){var e=this;if(e._iframe_dialog){if(!$(".qianbao_cashier_iframe_dialog").is(":hidden"))return;$(".qianbao_cashier_iframe_dialog").remove()}var t=e.getDialogTpl(a),i={modal:!0,showTitle:!1,fixed:!0,width:717,height:638,hideOnclose:!1,holderClassName:"qianbao_cashier_iframe_dialog",draggable:!0,html:t};e._iframe_dialog=new $.dialog(i),e._iframe_dialog.show(),e._setBody(),e.$root=e._iframe_dialog.element,e.track("show")},_setBody:function(){$("body").css({height:$(window).height(),overflow:"hidden"}),$(".dialogJmodal").css({height:$(window).outerHeight(),width:$(window).outerWidth(),position:"fixed",top:0,left:0})},_hideBody:function(){$("body").css({height:"inherit",overflow:"auto"})},getDialogTpl:function(a){var e=this,t="member"===e.product?'<div class="qianbao_cashier_agreement">\u8bf7\u52a1\u5fc5\u5ba1\u9605\u5e76\u63a5\u53d7<a href="https://tieba.baidu.com/tb/vip_eula.html">\u300a\u8d34\u5427\u4f1a\u5458\u670d\u52a1\u534f\u300b</a>\u6240\u6709\u6761\u6b3e\uff0c\u5426\u5219\u60a8\u65e0\u6743\u4f7f\u7528\u672c\u670d\u52a1</div>':'<div class="qianbao_cashier_agreement">\u8bf7\u52a1\u5fc5\u5ba1\u9605\u5e76\u63a5\u53d7<a href="https://tieba.baidu.com/tb/tdouprecautions.html">\u300aT\u8c46\u8d2d\u4e70\u987b\u77e5\u300b</a>\u6240\u6709\u6761\u6b3e\uff0c\u5426\u5219\u60a8\u65e0\u6743\u4f7f\u7528\u672c\u670d\u52a1\u3002<div class="protocol"><a target="_blank" href="https://tieba.baidu.com/tb/tdou_highpay_pc.html">\u5145\u503c\u653b\u7565</a>|<a target="_blank" href="https://tieba.baidu.com/tb/tdou_highpay_show.html">\u9650\u989d\u67e5\u8be2</a></div></div>',i='<div class="qianbao_cashier_dialog j_qianbao_cashier_dialog"><!-- htmlcs-disable -->  <div class="loading j_qianbao_cashier_loading">      <table height="100%" width="100%">          <tbody><tr>              <td valign="middle" align="center">                  <img src="//tb2.bdstatic.com/tb/static-common/widget/qianbao_cashier_dialog/images/charging_f0da091.gif">                  <p class="j_loading_text">\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019...</p>              </td>          </tr>          </tbody>      </table>  </div><!-- htmlcs-disable -->  <div class="qiaobao_pay_loading j_pay_loading">      <table height="100%" width="100%">          <tbody>          <tr>              <td valign="middle" align="center">                  <img src="//tb2.bdstatic.com/tb/static-common/widget/qianbao_cashier_dialog/images/charging_f0da091.gif">                    <p class="j_loading_text">\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019~</p>              </td>          </tr>          </tbody>      </table>  </div><div class="qianbao_cashier_payment_goods_wrap">#{goodsShowTpl}</div><div class="qianbao_cashier_payment_channel_wrap" id="'+e.iframeContainerId+'"></div>'+t+"</div>",o={goodsShowTpl:a};return i=$.tb.format(i,o)},qianbaoSecure:function(){var a={};a.templist=[];var e="passport.baidu.com";return a.set_pass_domain=function(a){switch(a){case"passport.baidu.com":case"wappass.baidu.com":case"passport.rdtest.baidu.com":case"passport.qatest.baidu.com":e=a}},a.pin=function(e,t){var i=window.Image?new Image:document.craeteElement("img"),o=function(a){o=function(){},t&&t(a)};i.onload=function(){o()},i.onerror=function(){o("failed")},a.templist.push(i),i.src=e},a.checkAuthorication=function(e){function t(){i&&o&&e&&e()}var i=!1,o=!1;a.sync_login("www.baifubao.com",function(){i=!0,t()}),a.sync_login("wallet.baidu.com",function(){o=!0,t()})},a.sync_login=function(t,i){a.pin("https://"+e+"/v3/login/api/auth/?return_type=3&tpl=bp&u=https://"+t+"/api/0/sync_login/0",i)},a}(),changeoPayAmount:function(a,e){var t=this,i=a;t.qianbao_params_json=t.getParams(a),t.qianbaoSecure.checkAuthorication(function(){t.buildCashier(i,e)})},closeDialog:function(){var a=this,e=a._iframe_dialog;e&&e.close(),this._hideBody(),delete window.qianbaoCashier,clearTimeout(a.timerId),a.track("\u5173\u95ed\u7a97\u53e3")},getParams:function(a){var e={};if(!a)return e;var t=/orderId=[^&]*/,i=t.exec(a);if(1==i.length){var o=i[0].split("=");e.orderId=o[1]||""}return e},getPageUrl:function(){var a=$.tb.location.getHref();return a=a.replace(/&customerId=.*|\?customerId=.*/g,"")},checkPaymentResult:function(){var a=this;a.getPaymentResult("ok",function(e){a.showPaymentSuccess(e)},function(e){a.showPaymentFailure(e)})},checkQrcodePaymentResult:function(){this.setLoading("check"),this.checkPaymentResult()},getPaymentResult:function(a,e,t){var i=this;i.setLoading();var o={order_id:i.qianbao_params_json.orderId},s={product:i.product,userName:i.dataProxy.getUserName()};i._checkPaymentResult&&i._checkPaymentResult.abort();var n=5,c=function(){n--,o.polling=5-n,clearTimeout(i.checkPaymentId),i._checkPaymentResult=$.ajax({type:"GET",url:i.services.getOrder,data:o,dataType:"json"}).success(function(o){var r=o.data.db_money||0;r/=100;var l=o.data.scores_total;if(!l){var d=o.data.given_scores||0;l=1e3*r+d+i.dataProxy.getUserTdou()}s=$.extend(s,{payAmount:r.toFixed(2),totalScores:l,payTdou:(o.data.given_scores||0)+(10*o.data.db_money||0)});var p=o.data.member_info;if(p){var _="yyyy-MM-dd",u=1e3*parseInt(p.create_time),m=1e3*parseInt(p.end_time);s=$.extend(s,{create_time:$.dateFormat(new Date(u),_),end_time:$.dateFormat(new Date(m),_)})}0==o.no?(i.clearLoading(),clearTimeout(i.checkPaymentId),e&&e(s),n=5):n>0&&"ok"===a?i.checkPaymentId=setTimeout(c,1e3):(i.clearLoading(),t&&t(s))})};i.checkPaymentId=setTimeout(c,1e3)},setLoading:function(a){var e=this,t=e.$root.find(".j_qianbao_cashier_loading");if(!t.is(":visible")){var i={loading:"\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019...",paying:"\u5f88\u52aa\u529b\u7684\u5145\u503c\u4e2d...",check:"\u67e5\u8be2\u5145\u503c\u7ed3\u679c\u4e2d..."};t.show(),t.find(".j_loading_text").html(i[a]||i.loading)}},clearLoading:function(){var a=this,e=a.$root.find(".j_qianbao_cashier_loading");1==e.length&&e.hide()},showPaymentTip:function(a){var e=this,t=e.$root.find(".j_qianbao_payment_tip");1==t.length&&t.remove(),e.$root.find(".j_qianbao_cashier_dialog").append(baidu.template('<!-- htmlcs-disable -->  <section class="qianbao_payment_tip j_qianbao_payment_tip ">      <div class="tip_dialog">          <div class="tip_dialog_content">              <%if(isQuickPay){%>              <p class="description">\u60a8\u5df2\u6210\u529f\u652f\u4ed8</p>              <%} else {%>              <p class="description">\u8bf7\u5728\u65b0\u6253\u5f00\u9875\u9762\u4e0a\u5b8c\u6210\u5145\u503c</p>              <%}%>              <p class="description-tips">\u4ed8\u6b3e\u5b8c\u6210\u524d\u8bf7\u4e0d\u8981\u5173\u95ed\u6216\u5237\u65b0\u6b64\u7a97\u53e3</p>              <div class="center">                  <a class="btn_default btn_sub btn-middle j_close qianbao_pay_tip_btn j_try_pay_again" style="margin-right: 20px;">\u5931\u8d25\uff0c\u91cd\u65b0\u652f\u4ed8</a>                  <a class="btn_default btn-middle btn-encourage j_pay_ok qianbao_pay_tip_btn">\u652f\u4ed8\u6210\u529f</a>              </div>          </div>          <span class="tip_dialog_close j_close"></span>      </div>      <span class="middle-helper"></span>  </section>',{isQuickPay:a})),t=e.$root.find(".j_qianbao_payment_tip"),t.find(".j_close").on("click",function(){e.hidePaymentTip(),e.getPaymentResult("fail",function(a){e.showPaymentSuccess(a)},function(){e.trigger("event_tdou_qianbao_pay_again")})}),t.find(".j_pay_ok").on("click",function(){e.checkPaymentResult(),e.hidePaymentTip()})},hidePaymentTip:function(){var a=this,e=a.$root.find(".j_qianbao_payment_tip");e&&e.remove()},showPayLoading:function(){var a=this,e=a.$root.find(".j_pay_loading");e.show(),e.find(".j_loading_text").html("\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019...")},clearPayLoading:function(){var a=this,e=a.$root.find(".j_pay_loading");1==e.length&&e.hide()},showPaymentSuccess:function(a){var e=this,t=baidu.template('<!-- htmlcs-disable -->  <div class="qiaobao_pay_result_dialog j_qiaobao_pay_result_dialog">      <div class="result_title">          <span class="result_pic success_pic"></span>          <%if(product == \'tdou\'){%>          <span class="result_txt">\u83b7\u53d6\u6210\u529f\uff01</span>          <p style="text-align:center">\u60a8\u53ef\u4ee5\u5728<span class="pay_amount">\u6211\u7684T\u8c46\u94b1\u5305</span>\u4e2d\u67e5\u770b\u8be6\u7ec6\u4fe1\u606f</p>          <%}else if(product == \'member\'){%>          <span class="result_txt">\u5145\u503c\u6210\u529f\uff01</span>          <%}%>      </div>        <%if(product == \'tdou\'){%>      <p><label>\u8d26\u53f7\uff1a</label><%=userName%></p>      <p><label>\u83b7\u8d60T\u8c46\uff1a</label><span class="pay_amount"><%=payTdou%></span>T\u8c46</p>      <p><label>\u652f\u4ed8\u91d1\u989d\uff1a</label><span class="pay_amount"><%=payAmount%></span>\u5143</p>      <%}else if(product == \'member\'){%>      <p><label>\u4f1a\u5458\u8d77\u59cb\u65e5\u671f\uff1a</label><span class="member_date"><%=create_time%></span></p>        <p><label>\u4f1a\u5458\u7ed3\u675f\u65e5\u671f\uff1a</label><span class="member_date"><%=end_time%></span></p>      <%}%>        <div class="button_container">          <a class="btn_default btn-middle btn-encourage qianbao_pay_result_btn j_close ">              <%if(product == \'tdou\'){%>              \u7ee7\u7eed\u83b7\u53d6              <%}else if(product == \'member\'){%>              \u7ee7\u7eed\u5145\u503c              <%}%>          </a>      </div>      <p style="text-align:center"><span class=" second j_second">5</span>\u79d2\u540e\u5173\u95ed\u7a97\u53e3</p>  </div>',a);e.updateUserInfo(a.totalScores),e.showPaymentResult(t)},showPaymentFailure:function(a){var e=this,t=baidu.template('<!-- htmlcs-disable -->  <div class="qiaobao_pay_result_dialog j_qiaobao_pay_result_dialog">      <div class="result_title">          <span class="result_pic fialed_pic"></span>          <%if(product == \'tdou\'){%>          <span class="result_txt">\u83b7\u53d6\u5931\u8d25\uff01</span>          <%}else if(product == \'member\'){%>          <span class="result_txt">\u5145\u503c\u5931\u8d25\uff01</span>          <%}%>      </div>      <p><label>\u8d26\u53f7\uff1a</label><%=userName%></p>      <p><label>\u83b7\u8d60T\u8c46\uff1a</label><span class="pay_amount"><%=payTdou%></span>T\u8c46</p>      <p><label>\u652f\u4ed8\u91d1\u989d\uff1a</label><span class="pay_amount"><%=payAmount%></span>\u5143</p>        <div class="button_container">          <a class="btn_default btn-middle btn-encourage qianbao_pay_result_btn j_repay ">              <%if(product == \'tdou\'){%>              \u91cd\u65b0\u83b7\u53d6              <%}else if(product == \'member\'){%>              \u91cd\u65b0\u5145\u503c              <%}%>          </a>      </div>        <p style="text-align:center">          <span class="second j_second">5</span>\u79d2\u540e\u5173\u95ed\u7a97\u53e3          <a href="//tieba.baidu.com/hermes/feedback?category=pay">\u8fdb\u884c\u53cd\u9988</a>      </p>  </div>',a);e.showPaymentResult(t)},updateUserInfo:function(a){EncourageData.userScore.scores_total=a,this.$root.find(".j_tdou").html(a)},showPaymentResult:function(a){var e=this;e.$root.find(".j_qianbao_cashier_dialog").append($(a));var t=e.$root.find(".j_qiaobao_pay_result_dialog .j_second"),i=5,o=function(){return i--,0==i?(e.closeDialog(),void 0):(t.html(i),e.timerId=setTimeout(o,1e3),void 0)};e.timerId=setTimeout(o,1e3),e.$root.on("click",".j_qiaobao_pay_result_dialog .j_close",function(){e.closeDialog()}).on("click",".j_qiaobao_pay_result_dialog .j_repay",function(){clearTimeout(e.timerId),e.$root.find(".qiaobao_pay_result_dialog").remove(),e.trigger("event_tdou_qianbao_pay_again")})},track:function(a,e,t){var i=this;$.stats.track(a,e||"qianbaoCashierDialog-"+i.product,PageData.product+"-"+(t||"qianbao-cashier-"+i.product),"click")}}});_.Module.define({path:"encourage-payment/widget/qianbao_purchase_member",requires:["encourage-payment/widget/qianbao_cashier_dialog","encourage-payment/widget/base_user_data","encourage-payment/widget/base_dialog_user_bar"],sub:{$root:null,memberOptions:null,id:"qianbao_purchase_member",carouselA:null,carouselB:null,target:"",defaultA:"",defaultB:"",size:"",is_autopay:"",initial:function(){var e=this;window.pageUnit=window.pageUnit||{};var t=window.pageUnit;t[this.id]||(t[this.id]=$.ajax({url:"/theme/getPage",type:"GET",data:{id:["qianbao_purchase_member_hot_message","qianbao_purchase_member_member_types"]},dataType:"json"}).done(function(i){i=i.data||{},t[e.id]={hotMessage:i.qianbao_purchase_member_hot_message||"\u8fd8\u7b49\u4ec0\u4e48\u5347\u7ea7\u5e74\u8d39\u4f1a\u5458\uff0c\u7ecf\u9a8c\u589e\u957f\u66f4\u5feb\uff01",memberTypes:i.qianbao_purchase_member_member_types||"super, normal"},t[e.id].memberTypes=t[e.id].memberTypes.split(/\s*,\s*/g)}).fail(function(){t[e.id]={hotMessage:"\u8fd8\u7b49\u4ec0\u4e48\u5347\u7ea7\u5e74\u8d39\u4f1a\u5458\uff0c\u7ecf\u9a8c\u589e\u957f\u66f4\u5feb\uff01",memberTypes:["super","normal"]}})),e.cashierDialog=e.requireInstance("encourage-payment/widget/qianbao_cashier_dialog"),e.baseData=e.requireInstance("encourage-payment/widget/base_user_data"),e.baseDialogUserBar=this.requireInstance("encourage-payment/widget/base_dialog_user_bar"),e.vip3Src="//tb2.bdstatic.com/tb/img/tb-plus-vip3_8f36413.png",e.vip4Src="//tb2.bdstatic.com/tb/img/tb-plus-vip4_e08e4b7.png",e.icon1Src="//tb2.bdstatic.com/tb/img/icon_tbvip_super_first_pc_e823616.png",e.icon2Src="//tb2.bdstatic.com/tb/img/icon_tbvip_super_second_pc_d108f6e.png",e.icon3Src="//tb2.bdstatic.com/tb/img/icon_tbvip_super_third_pc_f46f401.png",e.icon4Src="//tb2.bdstatic.com/tb/img/icon_tbvip_normal_first_pc_9173390.png",e.icon5Src="//tb2.bdstatic.com/tb/img/icon_tbvip_normal_second_pc_f31f951.png",e.icon3Tip="//tb2.bdstatic.com/tb/img/icon_tbvip_attention_pc_0b9f249.png",e.return_url=e.cashierDialog.getPageUrl(),e.cashierDialog.bind("event_tdou_qianbao_pay_again",e.payAgain,e)},memberInit:function(){$.ajax({type:"GET",url:"/tbmall/member/recharge",cache:!1,dataType:"json"}).success(function(e){if(0==e.no){var t=e.user.name;if(e.goods_info.member){var i=e.goods_info.member.money_info;$(".j_list_1050001").html("");for(var a=0;a<i.length;a++){var n=i[a].discount?i[a].discount:"",o=1==i[a].default?" selected":"",s=i[a].tag_name?'<div class="tag_name">'+i[a].tag_name+"</div>":"";$(".j_list_1050001").append('<li class="time_item j_order_update j_time_item j_vip_month_'+i[a].months+o+'">'+s+'<div class="time-type vip_money" for="vip_money_'+i[a].months+'" id="vip_money_'+i[a].months+'" data-value='+i[a].months+o+'><div class="money_icon"></div>'+i[a].money/100+'</div><div class="time-type vip_des" for="vip_des_'+i[a].months+'" id="vip_des_'+i[a].months+'" data-value="'+i[a].months+'">'+n+'</div><div class="time-type vip_month" for="vip_month_'+i[a].months+'" id="vip_month_'+i[a].months+'" data-value='+i[a].months+">"+i[a].months+"\u4e2a\u6708</div></li>")}}else $(".j_type_1050001").css("display","none");if(e.goods_info.adv_member){var r=e.goods_info.adv_member.money_info;$(".j_list_1050002").html("");for(var a=0;a<r.length;a++){var n=r[a].discount?r[a].discount:"",o=1==r[a].default?" selected":"",s=r[a].tag_name?'<div class="tag_name">'+r[a].tag_name+"</div>":"",l=2==r[a].goods_type?"is_autopay_1":"",c=1==r[a].has_autopay_goods?"has_autopay_goods_"+r[a].months:"";$(".j_list_1050002").append('<li class="time_item '+l+" "+c+" j_order_update j_time_item j_vip_month_"+r[a].months+o+'" data-isAutoplay='+r[a].is_autopay+">"+s+'<div class="time-type '+c+' vip_money" for="vip_money_'+r[a].months+'" id="vip_money_'+r[a].months+'" data-value='+r[a].months+o+'><div class="money_icon"></div>'+r[a].money/100+'</div><div class="time-type '+c+' vip_des" for="vip_des_'+r[a].months+'" id="vip_des_'+r[a].months+'" data-value="'+r[a].months+'">'+n+'</div><div class="time-type '+c+' vip_month" for="vip_month_'+r[a].months+'" id="vip_month_'+r[a].months+'" data-value='+r[a].months+">"+r[a].months+"\u4e2a\u6708</div></li>")}}else $(".j_type_1050002").css("display","none");$(".member-info .user-name").html(t)}})},carouselIcon:function(e,t){function i(e,t){s=1,l++,n(l,t),l==t&&($(".slide-div ."+e+"-icon").css("left",0),l=1),$(".slide-div ."+e+"-icon").stop().animate({left:-l*r},1e3);setTimeout(function(){s=0},1e3)}function a(e,t){s=1,l--,n(l,t),-1==l&&($(".slide-div ."+e+"-icon").css({left:-(t-1)*r}),l=t-2),$(".slide-div ."+e+"-icon").animate({left:-l*r},1e3);setTimeout(function(){s=0},1e3)}function n(e,t){0==e||e==t-1?$(".button-left").addClass("no-optional"):$(".button-left").removeClass("no-optional"),e==t-2?$(".button-right").addClass("no-optional"):$(".button-right").removeClass("no-optional")}var o=this,s=0;o.target=e,o.size=t,$(".slide-div ."+e+"-icon").css("left","0");var r=300,l=0;$(".j_qianbao_cashier_dialog").off("click").on("click",".button-left",function(){$(this).hasClass("no-optional")||0!=s||a(o.target,o.size)}).on("click",".button-right",function(){$(this).hasClass("no-optional")||0!=s||i(o.target,o.size)})},payAgain:function(){var e=this;e.showDialog(e.memberOptions)},showDialog:function(e){var t=this;t.product=e.product||"member",t.memberOptions=e,t.member=t.baseData.getMemberIcon(),t.initMemberId="1050002",t.initMemberCount="3",t.is_autopay="0",t.getPayMemberOrder(t.initMemberId,t.initMemberCount,t.is_autopay,function(e){var i={qianbao_params:e};t.showMember(i);var a=t.cashierDialog.getParams(e);t.orderId=a.orderId})},showMember:function(e){var t=this,i=window.pageUnit;if(i[this.id].done)return i[this.id]=i[this.id].done(function(){t.showMember(e)}),void 0;e.hotMessage=e.hotMessage||i[this.id].hotMessage,e.memberTypes=e.memberTypes||i[this.id].memberTypes;var a=e.qianbao_params||"",n=$.extend(e,{baseDialogUserBarTpl:t.baseDialogUserBar.getUserBarTemplate("getmember"),vip3Src:t.vip3Src,vip4Src:t.vip4Src,icon1Src:t.icon1Src,icon2Src:t.icon2Src,icon3Src:t.icon3Src,icon4Src:t.icon4Src,icon5Src:t.icon5Src,icon1Tip:t.icon1Tip,icon2Tip:t.icon2Tip,icon3Tip:t.icon3Tip,type_1050001:2==t.member.level||-2==t.member.level?" hide_type_1050001":""}),o=window.baidu.template('<!-- htmlcs-disable -->\r\n<div class="qianbao_cashier_purchase_member base_user_data">\r\n    <%- baseDialogUserBarTpl %>\r\n        <div class="member_cashier_wrap j_member_cashier_wrap" id="member_cashier_wrap">\r\n            <div class="member_wrap">\r\n                <ul class="member_list j_member_list">\r\n                    <li class="member_item recommend j_order_update  j_type_1050002">\r\n                        <div class="member-type" id="ptype-1050002" data-name="\u8d34\u5427\u8d85\u7ea7\u4f1a\u5458" data-value="1050002">\r\n                            <img src="<%- vip4Src %>">\u8d34\u5427\u8d85\u7ea7\u4f1a\u5458\r\n                        </div>\r\n                    </li>\r\n                    <li class="member_item j_order_update j_type_1050001 <%- type_1050001 %>">\r\n                        <div class="member-type" id="ptype-1050001" data-name="\u8d34\u5427\u4f1a\u5458" data-value="1050001">\r\n                            <img src="<%- vip3Src %>">\u8d34\u5427\u4f1a\u5458\r\n                        </div>\r\n                    </li>\r\n                </ul>\r\n            </div>\r\n            <div class="member-info">\r\n                <div>\u5145\u503c\u8d26\u53f7\uff1a\r\n                    <span class="user-name"></span>\r\n                </div>\r\n                <div class="slide-content">\r\n                    <div class="slide-title">\u5f00\u901a\u540e\u83b7\u5f97: </div>\r\n                    <div class="slide-div j_slide_1050002">\r\n                        <ul class="super-icon">\r\n                            <li>\r\n                                <img src="<%- icon1Src %>">\r\n                            </li>\r\n                            <li>\r\n                                <img src="<%- icon2Src %>">\r\n                            </li>\r\n                            <li>\r\n                                <img src="<%- icon3Src %>">\r\n                            </li>\r\n                        </ul>\r\n                    </div>\r\n                    <div class="slide-div j_slide_1050001 no-picked" style="display: none">\r\n                        <ul class="member-icon">\r\n                            <li>\r\n                                <img src="<%- icon4Src %>">\r\n                            </li>\r\n                            <li>\r\n                                <img src="<%- icon5Src %>">\r\n                            </li>\r\n                            <li>\r\n                                <img src="<%- icon4Src %>">\r\n                            </li>\r\n                        </ul>\r\n                    </div>\r\n                    <ul id="controler">\r\n                        <li class="button-left no-optional"></li>\r\n                        <li class="button-right"></li>\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n            <div class="member_time_wrap">\r\n                <ul class="time_list j_time_list j_list_1050002"></ul>\r\n                <ul class="time_list j_time_list j_list_1050001"></ul>\r\n                <div class="form-tip">\r\n                    <div class="single_selection"></div>\r\n                    <span>\u5230\u671f\u540e\u81ea\u52a8\u7eed\u8d39 (\u53ef\u968f\u65f6\u53d6\u6d88) </span>\r\n                    <a target="_blank" href="//tieba.baidu.com/tb/viprenew_eula.html" class="rule-tip"><img src="<%- icon3Tip %>"></a>\r\n                </div>\r\n            </div>\r\n        </div>\r\n</div>',n),s={qianbao_params:a,product:"member"},r=1;t.cashierDialog.showDialog(s,o,r,function(e){t.$root=e,t.initUI(t.initMemberId,t.initMemberCount,t.is_autopay),t.bindEvents()})},initUI:function(e,t,i){var a=this;a.selectedUI(e,t,i),a.memberInit(),a.carouselIcon("super",4)},selectedUI:function(e,t){var i=this;i.$root.find(".j_member_list li").removeClass("selected"),i.$root.find(".j_type_"+e).addClass("selected"),i.$root.find(".slide-div").css("display","none"),i.$root.find(".j_slide_"+e).css("display","block"),i.$root.find("#controler .button-left").addClass("no-optional"),i.$root.find("#controler .button-right").removeClass("no-optional"),i.$root.find(".j_time_list").css("display","none"),i.$root.find(".j_list_"+e).css("display","flex"),i.$root.find(".j_time_list li").removeClass("selected");var a=i.$root.find("#vip_month_"+t);$(".j_type_"+e).hasClass("selected")&&($(".j_type_icon").css("display","none"),$(".j_type_icon_"+e).css("display","block")),a.length?(a.parents("li.j_time_item").addClass("selected"),i.$root.find("#month-custum").val("")):i.$root.find(".j_custum_time").addClass("selected")},updatePayUI:function(e,t,i){var a=this;a.cashierDialog.showPayLoading(),e&&t&&a.getPayMemberOrder(e,t,i,function(e){a.cashierDialog.changeoPayAmount(e)})},bindEvents:function(){var e=this,t=120,i=0;e.$root.find(".single_selection").off("click").on("click",function(t){t.stopPropagation(),$(this).hasClass("picked")?($(this).removeClass("picked"),$(".j_vip_month_1").css("display","block"),$(".is_autopay_1.j_vip_month_1").css("display","none"),i=0):($(this).addClass("picked"),$(".j_vip_month_1").css("display","none"),$(".is_autopay_1.j_vip_month_1").css("display","block"),i=1),e.selectedUI("1050002","1",i),e.updatePayUI("1050002","1",i)}),e.$root.find(".qianbao_cashier_agreement a").on("click",function(e){e.stopPropagation(),$.stats.track("\u4ed8\u6b3e\u5f39\u7a97\u5e95\u90e8","\u5f00\u901a/\u7eed\u8d39\u4f1a\u5458\u670d\u52a1\u534f\u8bae\u70b9\u51fb",PageData.page?PageData.page:"other","click")}),e.$root.on("click",".member_item",function(t){t.stopPropagation(),t.preventDefault();var a=$(t.target),n="",o="";n=a.data("value"),o=e.$root.find(".j_time_list li.selected .time-type").data("value"),o||(o=e.$root.find("#month-custum").val()),$(".form-tip").css("display","none"),"1050001"==n?(i=0,""!==e.defaultA?o=e.defaultA:"",e.carouselIcon("member",3),$(".j_vip_month_1").css("display","block"),$(".is_autopay_1.j_vip_month_1").css("display","none")):"1050002"==n&&(""!==e.defaultB?o=e.defaultB:"",e.carouselIcon("super",4)),e.selectedUI(n,o,i),e.updatePayUI(n,o,i),$.stats.track("swich_membertype_"+("1050001"==n?"\u8d34\u5427\u4f1a\u5458":"\u8d34\u5427\u8d85\u7ea7\u4f1a\u5458"),"membertype-switch",PageData.page,"click")}),e.$root.on("click",".time-type",function(t){var a="",n="",o=e.$root.find(".j_member_list li.selected .member-type");t.stopPropagation(),t.preventDefault();var s=$(t.target);e.$root.find("#month-custum").val(""),n=s.data("value"),a=o.data("value"),1050001==a&&($(".form-tip").css("display","none"),i=0),$(".single_selection").removeClass("picked"),$(".j_vip_month_1").css("display","block"),$(".is_autopay_1.j_vip_month_1").css("display","none"),s.hasClass("has_autopay_goods_1")?$(".form-tip").css("display","flex"):($(".form-tip").css("display","none"),i=0),e.selectedUI(a,n,i),e.updatePayUI(a,n,i),$.stats.track("choose_custom_"+n,"memberCashier",PageData.page?PageData.page:"other","click",{member_type:o.data("name")})}),e.$root.find("#month-custum").on("input propertychange",function(){var i=/^[1-9]\d*$/,a=$(this),n=a.val();(n&&!i.test(n)||i.test(n)&&n>t)&&(n=n.replace(/\D/g,"").replace(/^0(\d*)$/,"$1"),n=Math.min(t,n),0==n&&(n=1),a.val(n),e.showCustomMonthBubble());var o=e.$root.find(".j_member_list li.selected .member-type").data("value");e.updatePayUI(o,n)}).on("focus",function(i){var a=$(i.target);e.$root.find(".j_time_list li").removeClass("selected"),e.$root.find(".j_custum_time").addClass("selected"),e.cashierDialog.showPayLoading();var n=a.val(),o=/^[1-9]\d*$/;(n&&!o.test(n)||o.test(n)&&n>t)&&(n=n.replace(/\D/g,"").replace(/^0(\d*)$/,"$1"),n=Math.min(t,n),0==n&&(n=1),a.val(n),e.showCustomMonthBubble());var s=e.$root.find(".j_member_list li.selected .member-type").data("value");e.updatePayUI(s,n)}),e.$root.find(".j_header_close").on("click",function(){e.cashierDialog.closeDialog()}),e.$root.find(".j_vip_month_12").hover(function(){e.showMonth12Bubble()},function(){e.hideMonth12Bubble()})},getPayMemberOrder:function(e,t,i,a){var n=this,o={terminal:"pc",pay_type:1,channel:2,memberId:e,memberCount:t,pageUrl:n.return_url,fr:""};1==i?o.is_autopay=1:"",o.fr=1==i?203:129,n._getPayMemberAjax&&n._getPayMemberAjax.abort(),n._getPayMemberAjax=$.ajax({type:"GET",url:"/tbmall/getPayUrl",data:o,cache:!1,dataType:"json"}).success(function(e){if(0==e.no)a&&a(e.data.return_url);else if(1990055==e.error_code)if("undefined"==typeof passport||"undefined"==typeof passport.pop.init){var t="undefined"!=typeof Env&&Env.server_time?Env.server_time:(new Date).getTime(),i="https://passport";$.JsLoadManager.use([i+".baidu.com/passApi/js/uni_login_wrapper.js?cdnversion="+Math.floor(t/6e4),i+".baidu.com/passApi/js/wrapper.js?cdnversion="+Math.floor(t/6e4)],function(){window.realname=passport.pop.init({type:"accRealName",apiOpt:{product:"tb",staticPage:"//tieba.baidu.com/tb/static-common/html/pass/v3Jump.html"},tangram:!0,color:"green"}),window.realname.show()},!0,"utf-8")}else window.realname.show()})},updatePayMemberOrder:function(e,t,i,a){var n=this,o={terminal:"pc",pay_type:1,channel:2,order_id:i,memberId:e,memberCount:t,pageUrl:n.return_url,fr:n.memberOptions.fr||""};n._upPayMemberAjax&&n._upPayMemberAjax.abort(),n._upPayMemberAjax=$.ajax({type:"GET",url:"/tbmall/upOrder",data:o,cache:!1,dataType:"json"}).success(function(e){0==e.no&&a&&a(e.data)})},createBubble:function(e){$.extend(e,{arrow_dir:"down",arrow_pos:{left:30},closeBtn:!1,level:1,arrowReq:!0})},showMonth12Bubble:function(){var e=this;e.hideCustomMonthBubble();var t=e.$root.find(".j_vip_month_12");if(!e.bubble_month_12){var i={content:"\u4e00\u6b21\u6027\u5f00\u901a12\u4e2a\u6708\u4ee5\u4e0a\u4f1a\u5458\uff0c\u8d60\u9001\u8fde\u7eed\u7b7e\u5230\u53613\u5f20",bubble_css:{top:0,right:-100,width:280},wrap:t};e.bubble_month_12=e.createBubble(i)}},hideMonth12Bubble:function(){var e=this;e.bubble_month_12&&e.bubble_month_12.hideBubble()},showCustomMonthBubble:function(){var e=this,t=e.$root.find(".j_custum_time");if(!e.bubble_custom_month){var i={content:"\u4e00\u6b21\u6027\u53ea\u80fd\u5f00\u901a120\u4e2a\u6708\u8d34\u5427\u4f1a\u5458",bubble_css:{top:0,right:-100,width:280},wrap:t};e.bubble_custom_month=e.createBubble(i)}},hideCustomMonthBubble:function(){var e=this;e.bubble_custom_month&&e.bubble_custom_month.hideBubble()}}});_.Module.define({path:"tbui/widget/messenger/messengerProcesser",requires:["tbui/widget/login_dialog"],sub:{_failCommandCacheList:{},initial:function(){this.commandMap={common_login:$.proxy(this.common_login,this),common_register:$.proxy(this.common_register,this),exception_all:$.proxy(this.exception_all,this)}},registerCommand:function(e){this.checkExistCommand(e)&&(this.commandMap=$.extend(this.commandMap,e)),this.processFailCommand(e)},checkExistCommand:function(e){var i;for(i in e)if(e.hasOwnProperty(i)&&i in this.commandMap)return window.console&&console.warn('The command "'+i+'" is already exist'),void 0;return!0},processFailCommand:function(e){var i;for(i in e){var t=this._failCommandCacheList[i];e.hasOwnProperty(i)&&t&&this.process(t)}},process:function(e){if(!(e.command&&e.command in this.commandMap))return this._failCommandCacheList[e.command]=e,window.console&&console.warn("Please check or register the data processing command"),void 0;var i=this.commandMap[e.command];return i(e.data)},common_login:function(){PageData&&PageData.user&&!PageData.user.is_login&&this.requireInstance("tbui/widget/login_dialog")},common_register:function(e){var i=e.return_url||"//tieba.baidu.com",t="https://passport.baidu.com/v2/?reg&tpl=tb&u="+i;window.open(t)},exception_all:function(){throw new Error("Processing data exception")}}}),_.Module.define({path:"tbui/widget/messenger/messengerTarget",requires:[],sub:{initial:function(e,i,t){var n="";if(arguments.length<3?n="Target error: target and name are both requied":"object"!=typeof i?n="Target error: target itself must be window object":"string"!=typeof t&&(n="Target error: target name must be string type"),n)throw new Error(n);this.prefix=e,this.target=i,this.name=t},send:function(e){var i="postMessage"in window;if(i)this.target.postMessage(this.prefix+e,"*");else{var t=window.navigator[this.prefix+this.name];if("function"!=typeof t)throw new Error("Target error: target callback function is not defined");var n=$.tb.location,r={origin:n.getProtocol()+"//"+n.getHost(),data:this.prefix+e};t(r,window)}}}}),_.Module.define({path:"tbui/widget/messenger",requires:["tbui/widget/messenger/messengerProcesser","tbui/widget/messenger/messengerTarget"],sub:{initial:function(e,i){if(!e)throw new Error("Messenger name must be asigned");var t=i||"[PROJECT_NAME]";this.name=e,this.prefix=t.toString(),this.supportPostMessage="postMessage"in window,this.origins=[],this.processer=this.requireInstance("tbui/widget/messenger/messengerProcesser"),this.targets={},this._initListen()},addTarget:function(e,i){this.targets[i]=this.requireInstance("tbui/widget/messenger/messengerTarget",[this.prefix,e,i])},registerCommand:function(e){this.processer.registerCommand(e)},registerOrigin:function(e){var i=0;for("string"==typeof e&&(e=[e]),i;i<e.length;i++)this.origins.push(e[i])},send:function(e){var i,t=this.targets;for(i in t)t.hasOwnProperty(i)&&t[i].send(e)},_warn:function(e){window.console&&window.console.warn&&window.console.warn(e)},_initListen:function(){var e=this,i=function(i){var t="";if("object"==typeof i){if(!i.data||"string"!=typeof i.data)return window.console&&console.warn("The received message is not type of string"),void 0;if(t=i.data,/^ignoredProject/.test(t))return;if(t.substring(0,e.prefix.length)!==e.prefix)return window.console&&console.warn("The msg type is not avaliable in project "+e.prefix),void 0;if(i.origin&&!e._checkOrigin(i.origin))return window.console&&console.warn("The post origin is not avaliable in project "+e.prefix),void 0}else if(t=i,/^ignoredProject/.test(t))return;t=t.slice(e.prefix.length),t=e._escapeHTML(t);try{t=$.parseJSON(t)}catch(n){throw new Error("The JSON string is not valid")}var r=e.processer.process(t)||{};t.command&&t.shake&&t.shake_id&&e.send($.json.encode({command:t.command+"@"+t.shake_id+"@success",shake:!0,shake_id:t.shake_id,data:r}))};window.messenger=e,this.supportPostMessage?"addEventListener"in document?window.addEventListener("message",i,!1):"attachEvent"in document&&window.attachEvent("onmessage",i):window.navigator[this.prefix+this.name]=i},_escapeHTML:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\s/g,"&nbsp;").replace(/\\"/g,"&quot;")},_checkOrigin:function(e){var i=0,t=this.origins.length;for(i;t>i;i++)if(this.origins[i]===e)return!0;return!1}}});_.Module.define({path:"encourage-payment/widget/cashier_dialog",requires:["encourage-payment/widget/base_user_data","tbui/widget/messenger"],sub:{sub_iframe_name:"cashier_dialog_iframe",windowId:"window_iframe_app_"+(new Date).getMilliseconds(),_iframe_dialog:null,initial:function(){this.dataProxy=this.requireInstance("encourage-payment/widget/base_user_data"),this.member=this.dataProxy.getMemberIcon()},getTpl:function(){var e='<div class="cashier_dialog base_user_data"><div class="cashier_dialog_header"><div class="header_title"><span class="header_icon"></span>#{title}</div><div class="user_info"><span class="title_acc">\u8d26\u53f7\uff1a<span class="#{member} j_member_icon"></span><a class="title_acc_name j_member_red">#{user_name}</a></span><span class="title_remain">T\u8c46\u4f59\u989d\uff1a<span class="title_remain_num"><span class="user_tdou_icon"></span><span  class="j_tdou">#{tdou_num}<span></span></span></span></div><a class="header_close j_header_close"></a></div><div class="tdou_cashier_wrap" id="tdou_cashier_wrap"><iframe id="cashier_dialog_iframe" class="cashier_dialog_iframe" src="#{cashier_url}" frameborder="0" style="border: 0"></iframe></div></div>';return e},buildCashierIframe:function(e){return $.tb.format(this.getTpl(),e)},showDialog:function(e){var a=this;a._iframe_dialog&&$(".tdou_member_cashier_iframe_dialog").remove(),this.options=e||{},this.pay_fr=e.fr,this.pay_track=e.track;var i=e.cashier_url,s=this.member.action_title,t={user_name:this.dataProxy.getUserName(),tdou_num:0,member:this.member.icon,cashier_url:i,title:s||"\u5f00\u901a\u8d34\u5427\u8d85\u7ea7\u4f1a\u5458"},r=a.buildCashierIframe(t),n={modal:!0,showTitle:!1,fixed:!0,width:726,height:564,hideOnclose:!1,holderClassName:"tdou_member_cashier_iframe_dialog",draggable:!0,html:r};a._setBody(),a._iframe_dialog=new $.dialog(n),a._iframe_dialog.show(),("ordinary_member_icon"==$.trim(this.member.icon)||"super_member_icon"==$.trim(this.member.icon))&&a._iframe_dialog.element.find(".j_member_red").addClass("member_red"),a.updateTdou(),a.wrap=a._iframe_dialog.element,window.tdou_dianquan_iframe_dialog=a._iframe_dialog,a.track("show"),a.bindEvent(),a.initMessager()},_setBody:function(){$("body").css({height:$(window).height(),overflow:"hidden"}),$(".dialogJmodal").css({height:$(window).outerHeight(),width:$(window).outerWidth(),position:"fixed",top:0,left:0})},bindEvent:function(){var e=this;e.wrap.find(".j_header_close").on("click",function(){e.closeMain()})},closeMain:function(){var e=window.tdou_dianquan_iframe_dialog;e&&e.close(),this._hideBody(),delete window.tdou_dianquan_iframe_dialog,this.track("\u5173\u95ed\u7a97\u53e3")},_hideBody:function(){$("body").css({height:"inherit",overflow:"auto"})},initMessager:function(){var e=this;if(!e.MessageInstance){e.MessageInstance=e.requireInstance("tbui/widget/messenger",[e.windowId,"tdou_pay"]);var a=window.document.getElementById(e.sub_iframe_name);e.MessageInstance.addTarget(a.contentWindow,e.sub_iframe_name);var i=["http://db.baidu.com","http://pay.baidu.com"];e.MessageInstance.registerOrigin(i),e.MessageInstance.registerCommand({encourage_dianquan_readystatechange:$.proxy(e.onReadyStateChange,this),encourage_dianquan_close:$.proxy(e.onClose,this)})}},sendMessage:function(e){var a=this;if(a.MessageInstance){var i="";"object"==typeof e&&(i=JSON.stringify(e)),a.MessageInstance.targets[a.sub_iframe_name].send(i)}},onReadyStateChange:function(e){if(e)switch(e.status){case 2e3:this.updateMember(e.data),this.track("\u652f\u4ed8\u6210\u529f");break;case 3e3:this.onClose();break;case 3001:this.onClose(),this.track("\u518d\u6b21\u8d2d\u4e70")}},onClose:function(){this.closeMain()},updateTdou:function(){var e=this;e.dataProxy.getTdou(function(e){if(e&&0===e.no){var a=e.data.Parr_scores,i=a?a.scores_money+a.scores_other:0;$(".tdou_member_cashier_iframe_dialog .j_tdou").html(i)}},this)},updateMember:function(e){var a=this,i=a.dataProxy.getMemberIconByLevel(e.user_level);$(".tdou_member_cashier_iframe_dialog .j_member_icon").addClass(i.icon);var s=e.user_level;s&&(s=parseInt(s),s>0&&$(".tdou_member_cashier_iframe_dialog .j_member_red").addClass("member_red"))},track:function(e){$.stats.track(this.pay_track||"memberpay","cashierDialog-"+this.pay_fr,PageData.product,e||"click")}}});_.Module.define({path:"encourage-payment/widget/pay_member",requires:["encourage-payment/widget/base_user_data","encourage-payment/widget/cashier_dialog","encourage-payment/widget/qianbao_purchase_member","encourage-payment/widget/TdouOpenType"],sub:{pay_member_url:"/tbmall/getPayUrl",PayMemberUrl:"/tbmall/getMyPayType",CASHIER:1,QIANBAO:2,initial:function(e){var a=this;e=$.extend({},e),a.requireInstance("encourage-payment/widget/base_user_data",{scores:e.scores,level:e.level}),a.cashierDialog=a.requireInstance("encourage-payment/widget/cashier_dialog"),a.qianbaoPayMember=a.requireInstance("encourage-payment/widget/qianbao_purchase_member"),a.openTypeList=a.requireInstance("encourage-payment/widget/TdouOpenType",{type:"member"})},showCashier:function(e){var a=this,t=e||{};$.extend(t,{fr:t.fr||"",track:"memberpay"}),this.opt=t,a._openCtrl("dialog"),a.payType=a.QIANBAO,a.payTypeCtrl()},_openCtrl:function(e){var a=this,t=a.openTypeList.getOpenType(a.opt.scene_id);switch(e="win"===e||"dialog"===e?e:t){case"win":a.openNewWindow();break;case"dialog":}},openNewWindow:function(){this.win=window.open("")},openDialog:function(){var e=this.opt;this.payType==this.CASHIER?this.cashierDialog.showDialog(e):this.qianbaoPayMember.showDialog(e)},_getPayType:function(e){var a=this,t=this.opt.scene_id;e?(a.payType=e,a.payTypeCtrl()):(e=1,$.ajax({type:"GET",dataType:"json",url:a.PayMemberUrl,data:{terminal:"pc",pay_type:"member",id:t},success:function(t){0==t.no&&(e=Number(t.data.pay_type_id)||1),a.payType=e,a.payTypeCtrl()}}))},payTypeCtrl:function(){var e=this;e.win||e.payType!=e.QIANBAO?$.get("/tbmall/getPayUrl?terminal=pc&pay_type=1&fr="+this.opt.fr,function(a){if(a&&1990055===a.error_code)if("undefined"==typeof passport||"undefined"==typeof passport.pop.init){var t="undefined"!=typeof Env&&Env.server_time?Env.server_time:(new Date).getTime(),i="https://passport";$.JsLoadManager.use([i+".baidu.com/passApi/js/uni_login_wrapper.js?cdnversion="+Math.floor(t/6e4),i+".baidu.com/passApi/js/wrapper.js?cdnversion="+Math.floor(t/6e4)],function(){window.realname=passport.pop.init({type:"accRealName",apiOpt:{product:"tb",staticPage:"//tieba.baidu.com/tb/static-common/html/pass/v3Jump.html"},tangram:!0,color:"green"}),window.realname.show()},!0,"utf-8")}else window.realname.show();else a.data&&(e.win?e.win.location.href=a.data:(a.data+="&embed=1",e.opt.cashier_url=a.data,e.openDialog()))}):e.openDialog()},isQianbaoHitSmallFlow:function(){var e=PageData&&PageData.user&&PageData.user.id;return e?"1157380926"==e||"707573940"==e||"963463500"==e||"1093896819"==e||"1496"==e||"1134652730"==e||"982451133"==e?!0:(e=parseInt(e),e%1===0):!0}}});F.module("common/widget/eventCenter",function(){var e=$({}),t=function(){var e;return e=("0000"+parseInt(Math.random()*Math.pow(36,4),10).toString(36)).slice(-4),function(t,n){var a,o,r,l,u,i,s,c,f;return a=navigator.userAgent.indexOf("MSIE ")>-1||navigator.userAgent.indexOf("Trident/")>-1,o="onstorage"in document&&a,r=function(e){var n;n=new Date,n.setTime(n.getTime()+1e3),document.cookie="tabHub_emit_"+t+"="+e+"; expires="+n.toUTCString()+"; path=/"},u=0,l=o?function(n){var a,o,l,i;for(c.lastValue=n,i="data:"+e+":"+c.lastValue,r(i),localStorage.setItem(t,i),a=0,o=s.length;o>a;a++)l=s[a],l.call(null,n);return u+=1}:function(n){var a,o,r;for(c.lastValue=n,localStorage.setItem(t,"data:"+e+":"+c.lastValue),a=0,o=s.length;o>a;a++)r=s[a],r.call(null,n);return u+=1},s=[],i=$.noop,o?$(document).on("storage.noop",i):$(window).on("storage.noop",i),n?(o&&r("readable:"+e),localStorage.setItem(t,"readable:"+e),$(document).ready(function(){return setTimeout(function(){return f(),u>0?void 0:(n(l),o?$(document).off("storage.noop"):$(window).off("storage.noop"))},100)})):$(document).ready(function(){setTimeout(function(){f(),$(document).off("storage.noop"),$(window).off("storage.noop")})}),f=function(){var n,l,u,i;return n=function(n){var a,o,r,l,u,i,f,d,g;if(u=n.originalEvent.key,f=localStorage.getItem(t),u===t&&f===n.originalEvent.newValue)switch(a=f.split(":"),r=a[0],o=a[2],r){case"readable":if(null!=c.lastValue)return localStorage.setItem(t,"data:"+e+":"+c.lastValue);break;case"data":if(null!=o){for(g=[],l=0,i=s.length;i>l;l++)d=s[l],g.push(d.call(null,o));return c.lastValue=o,g}}},i=function(n){var a,o,r,l,u,i,f,d,g,m;if(i=n.originalEvent.key,d=n.originalEvent.newValue,i===t){if(a=d.split(":"),l=a[0],r=a[1],o=a[2],r===e)return;switch(l){case"readable":if(null!=c.lastValue)return setTimeout(function(){var n;return n=localStorage.getItem(t),null!=n&&"readable"===n.split(":")["0"]?localStorage.setItem(t,"data:"+e+":"+c.lastValue):void 0},0);break;case"data":if(null!=o){for(m=[],u=0,f=s.length;f>u;u++)g=s[u],m.push(g.call(null,o));return c.lastValue=o,m}}}},u=function(){var n,a,o,l,u,i,f,d,g;if(f=document.cookie.replace(RegExp("(?:(?:^|.*;\\s*)tabHub_emit_"+t+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1")){if(n=f.split(":"),l=n[0],o=n[1],a=n[2],o===e)return;if(null==f)return;switch(l){case"readable":if(null!=c.lastValue)return setTimeout(function(){var n,a;return n=localStorage.getItem(t),null!=n&&"readable"===n.split(":")["0"]?(a="data:"+e+":"+c.lastValue,r(a),localStorage.setItem(t,a)):void 0},0);break;case"data":if(null!=a){for(g=[],u=0,i=s.length;i>u;u++)d=s[u],g.push(d.call(null,a));return c.lastValue=a,g}}}},o?($(document).on("storage."+t,u),$(window).on("unload",function(){return $(document).off("storage")})):(l=a?i:n,$(window).on("storage."+t,l),$(window).on("unload",function(){return $(window).off("storage")}))},c={destory:function(){return $(window).off("storage."+t)},onValue:function(e){return s.push(e),function(){var t;return t=$.inArray(e,s),-1!==t?s.splice(t,1):void 0}},lastValue:null,emit:l,guid:e}}}();return e.TabHub=t,e});_.Module.define({require:["common/widget/eventCenter"],path:"common/widget/newMessageSystem",requires:["common/widget/Userbar/DropDownList"],sub:{favUrl:{get:"/sysmsg/userpost/queryStoreUpdateNum",clear:"/sysmsg/userpost/clearStoreUpdateNum"},favData:{type:"favts",category_name:"\u6211\u7684\u6536\u85cf",unread_count:0,category_href:"&type=storethread"},notifyData:[],messageData:[{type:"",category_name:"\u67e5\u770b\u79c1\u4fe1",unread_count:0,category_href:"/im/pcmsg"}],msgType:{reply:"1",atme:"2",friendapply:"3",fans:"4"},setNotifyStorage:function(e){$.tb.Storage.set(this.localStorageKey,$.json.encode(e),this.expire)},initial:function(e){this.options=e,this.$el=$(".userbar .u_news");var t=$('<div class="u_menu_item u_menu_news"><a href="#" class="u_news_wrap j_news" onclick="return false;">\u6d88\u606f<span></span><i class="i-arrow-down"></i></a></div>'),a=this.requireInstance("common/widget/Userbar/DropDownList",[this.$el,t]);this.$newsTips=t.find(".j_news span"),this.localStorageKey="notifyData"+PageData.user.id,this.expire=(new Date).getTime()+18e5,this.eventCenter=this.require("common/widget/eventCenter"),this.$el.append(t);var s=baidu.template('<div id="u_notify">     <div class="u_notity_bd">         <ul class="sys_notify j_sys_notify j_category_list">         </ul>         <ul class="sys_notify_last">             <li class="category_item  category_item_last j_category_item_last">                 <a target="_blank" href="/sysmsg/index?type=notity">                     \u6211\u7684\u901a\u77e5<span class="unread-num">0</span>                 </a>                 <ul class="new_message j_new_message j_category_list">                 </ul>             </li>         </ul>      </div> </div> ',{portrait:PageData.user.portrait});a.innerContent("top",s),this.$categoryList=this.$el.find(".j_category_list"),this.$systemNotifyList=this.$categoryList.eq(1),this.$systemMessageCountSpan=this.$el.find(".j_category_item_last .unread-num"),this.initLcs(),this.fetchNotifyList(),this.bindEvents()},initLcs:function(){TbCom.addEvent("User","infoComplete",function(){TbCom.process("UserMessage","init",null)})},fetchNotifyList:function(){var e=this,t=$.tb.Storage.get(this.localStorageKey),a=$("<a href="+document.referrer+"></a>")[0].host;return t&&document.referrer&&$.tb.location.getHost()===a?(t=$.json.decode(t),e.notifyData=t,e.renderNotify(t,1),void 0):($.getJSON("/sysmsg/query/userunread",function(t){var a=t.data;0===t.errno&&(e.notifyData=a,e.renderNotify(a,1),e.setNotifyStorage(a))}),void 0)},initMessagePanel:function(e){var t=this,a=[{type:"reply",category_name:"\u67e5\u770b\u56de\u590d",unread_count:e[3]||0,category_href:"&type=replyme"},{type:"atme",category_name:"\u67e5\u770b@\u63d0\u5230\u6211",unread_count:e[8]||0,category_href:"&type=atme"},{type:"friendapply",category_name:"\u67e5\u770b\u597d\u53cb\u7533\u8bf7",unread_count:e[21]||0,category_href:"&type=friendapply"},{type:"fans",category_name:"\u67e5\u770b\u65b0\u7c89\u4e1d",unread_count:e[0]||0,category_href:"&type=fans"}];a.push(this.favData),$.each(a,function(e,t){a[e].category_href="/i/sys/jump?u="+PageData.user.portrait+t.category_href}),a=[this.messageData[0]].concat(a),this.messageData=a,this.getFavNum(function(){t.renderNotify(t.messageData,0)})},renderNotify:function(e,t){0===t&&this.$categoryList.eq(t).html(baidu.template('<div id="u_notify_item">     <%for (var i = 0; i < list.length; i++) {%>     <li class="category_item <% if(list[i].unread_count == 0) {%>category_item_empty<%}%>">         <%if ( list[i].category_href ) {%>         <a class="j_cleardata" href="<%=list[i].category_href%>" target="_blank" data-type="<%=list[i].type%>"><%=list[i].category_name%>             <% if(list[i].unread_count != 0) {%>             <span class="unread-num"><%=list[i].unread_count%></span>             <% } %>         </a>         <%} else {%>         <a href="/sysmsg/index?type=notity&category_id=<%=list[i].category_id%>" target="_blank"            data-type="<%=list[i].type%>"><%=list[i].category_name%>             <% if(list[i].unread_count != 0) {%>             <span class="unread-num"><%=list[i].unread_count%></span>             <% } %>         </a>         <% } %>     </li>     <%}%> </div> ',{list:e})).find(".j_cleardata").eq(0).tbattr("target","sixin"),this.renderNotifyTips()},renderNotifyTips:function(){var e=this.getTotalMessageCount(),t=this.getSystemMessageCount();this.$systemMessageCountSpan.html(t);var a=e>99?"99+":e;this.$newsTips.html("("+a+")"),t?this.$systemMessageCountSpan.show():this.$systemMessageCountSpan.hide(),e>0?this.$newsTips.show():this.$newsTips.hide()},getTotalMessageCount:function(){var e=0;return e=this.getNotifyMessageCount()+this.getSystemMessageCount()},getNotifyMessageCount:function(){var e=0;return $.each(this.messageData,function(t,a){e+=parseInt(a.unread_count,10)}),e},getSystemMessageCount:function(){var e=0;return $.each(this.notifyData,function(t,a){e+=parseInt(a.unread_count,10)}),e},bindEvents:function(){var e=this;e.eventCenter.bind("sysmsg.readmsg",function(t,a){for(var s=0,n=e.notifyData.length;n>s;s++){var i=e.notifyData[s];if(a.category_id==i.category_id){i.unread_count=parseInt(i.unread_count,10)-1,i.unread_count<0&&(i.unread_count=0),e.renderNotify(e.notifyData,1),this.setNotifyStorage(e.notifyData);break}}}),TbCom.on("msgsystem_initall",function(t){e.initMessagePanel(t)}),TbCom.on("msgsystem_message",function(t){t=t[1]||{};var a=t.type,s=t.content;a&&"undefined"!=typeof s&&("all_msg"!==a?(e.messageData[e.msgType[a]].unread_count=parseInt(s,10),e.renderNotify(e.messageData,0)):e.initMessagePanel(s.split(",")))}),e.$categoryList.on("click",".j_cleardata",function(t){var a=$(t.currentTarget),s=a.tbattr("data-type");return"favts"===s?(e.clearFavNum(),void 0):(s&&TbCom.process("UserMessage","clearData",s),void 0)});var t=this.eventCenter.TabHub,a=t("messageCount",function(){a.getUnreadDebounce()});a.getUnreadDebounce=_.debounce(function(){$.ajax({url:"/im/pcmsg/query/getAllUnread",dataType:"json",cache:!1,type:"GET"}).done(function(e){0===parseInt(e.errno)&&a.emit(e.unread)})},100),a.onValue(function(t){e.messageData[0].unread_count=parseInt(t,10),e.renderNotify(e.messageData,0),$(document).off("visibilitychange.message"),$(window).off("focus.message")}),this.eventCenter.data("tabHub.message",a),$.lcsFlash&&$.lcsFlash.on(202006,function(e){return 6===e.multiMsg[0].data.groupType?document.hasFocus()||document.hidden===!1?(a.getUnreadDebounce(),void 0):("undefined"!=typeof document.hidden?$(document).off("visibilitychange.message").one("visibilitychange.message",a.getUnreadDebounce):$(window).off("focus.message").one("focus.message",a.getUnreadDebounce),void 0):void 0})},getFavNum:function(e){var t=this;$.get(this.favUrl.get,function(a){if(0===a.errno){t.favData.unread_count=a.num;var s=t.messageData[5];s&&(s.unread_count=a.num),t.renderNotify(t.messageData,0)}return $.isFunction(e)?(e.apply(t),void 0):void 0})},clearFavNum:function(){var e=this;$.get(this.favUrl.clear,function(t){if(0===t.errno){e.favData.unread_count=0;var a=e.messageData[5];a&&(a.unread_count=0),e.renderNotify(e.messageData,0)}})}}});_.Module.define({path:"encourage-member/widget/join_vip_dialog",requires:["tbui/widget/login_dialog","encourage-payment/widget/pay_member"],sub:{objGet:function(e,i,t){t=void 0===t?null:t,i=i.split(".");var o,n=e;for(o in i){if(!("object"==typeof n&&i[o]in n))return t;n=n[i[o]]}return n},objSet:function(e,i,t){return e[i]=t,e},initial:function(e){this.options=$.extend({},e)},getMemberDialog:function(e,i){return this.objGet(window,"PageData.user.is_login",!1)?(this.gotoCashier(e,i),!1):(this.requireInstance("tbui/widget/login_dialog"),!1)},gotoCashier:function(e,i){var t=this,o=this.requireInstance("encourage-payment/widget/pay_member",{scores:t.options.scores,level:t.options.level}),n=this.objSet({},"fr",e||"\u8d2d\u4e70\u4f1a\u5458");n=this.objSet(n,"scene_id",i||0),o.showCashier(n)}}});_.Module.define({path:"user/widget/user_head",sub:{initial:function(){this.initOptions()},initOptions:function(){this.options={gif:["1100001","1100002","1100003","1100013","1100015","1100016","1100017","1100019","1100116","1100133","1100135"],filter:[]}},getImgFormat:function(t){var r="png";return-1!=$.inArray(t,this.options.gif)&&(r="gif"),r},getHeadUrl:function(t){var r=t.mParr_props&&t.mParr_props.portrait||"",i="";return i=r.end_time>(new Date).getTime()/1e3?r.url:"https:"===document.location.protocol?"https://gss0.bdstatic.com/6LZ1dD3d1sgCo2Kml5_Y_D3/sys/portrait/item/"+t.portrait:"https://gss0.bdstatic.com/6LZ1dD3d1sgCo2Kml5_Y_D3/sys/portrait/item/"+t.portrait},getHeadFrameStyle:function(t,r){var i=t.mParr_props&&t.mParr_props.avatarframe||"",e="",o=null,s={hasFrame:!1,stylestr:""};return i.end_time>(new Date).getTime()/1e3&&(e=i.props_id,o=["width:"+r+"px","height:"+r+"px","padding:10px","background:url(/tb/static-common/img/props/"+r+"/"+e+"."+this.getImgFormat(e)+") no-repeat","border:none","left:-6px","top:-6px"],s={hasFrame:!0,stylestr:o.join(";")}),s}}});_.Module.define({path:"tbui/widget/JsPager",sub:{_cfg:{},_amount:0,_center_pos:0,_jwrapper:null,_isNew:!0,_page_template:{normal:'<a href="#url#" index="#page#" #special#>#page#</a>',current:"<span #special#>#page#</span>",prev:'<a href="#url#" index="#page#" #special#>\u4e0a\u4e00\u9875</a>',next:'<a href="#url#" index="#page#" #special#>\u4e0b\u4e00\u9875</a>',head:'<a href="#url#" index="#page#" #special#>\u9996\u9875</a>',tail:'<a href="#url#" index="#page#" #special#>\u5c3e\u9875</a>',prev_disable:'<a href="#url#" index="#page#" #special#>\u4e0a\u4e00\u9875</a>',next_disable:'<a href="#url#" index="#page#" #special#>\u4e0b\u4e00\u9875</a>',head_disable:'<a href="#url#" index="#page#" #special#>\u9996\u9875</a>',tail_disable:'<a href="#url#" index="#page#" #special#>\u5c3e\u9875</a>',status:'<span #special#><span class="js_pager_idx">#page#</span>/<span class="js_pager_total">#total#</span></span>'},_default_cfg:{container:$("body"),amount:10,isHtml:!1,current:1,total:10,mode:0,url:"##",openInNew:!1,showStatus:!1,statusPos:"head",showDisableItem:!1,template:{},classname:{wrapper:"tbui_js_pager",normal:"",current:"current",prev:"prev",next:"next",head:"head",tail:"tail",status:"status",prev_disable:"prev_disable",next_disable:"next_disable",head_disable:"head_disable",tail_disable:"tail_disable"}},initial:function(e){var a=this;if(a._isNew){a._cfg=$.extend({},a._default_cfg,e);var t=a._cfg;t.template=$.extend({},a._page_template,t.template),t.amount=parseInt(t.amount),t.current=parseInt(t.current),t.total=parseInt(t.total),a._amount=t.total>t.amount?t.amount:t.total,a._center_pos=parseInt((a._amount+1)/2)}else a._cfg=$.extend(a._cfg,e);a._amount<=1||(a._cfg.isHtml||a._render(),a._isNew=!1)},_render:function(){var e=this,a=e._cfg,t=[],r="";if(a.showStatus&&"head"===a.statusPos&&t.push(e._generateHtml("status",a.current,a.total)),a.current>1?(t.push(e._generateHtml("head",1)),t.push(e._generateHtml("prev",a.current-1))):a.showDisableItem&&(t.push(e._generateHtml("head_disable",1)),t.push(e._generateHtml("prev_disable",a.current-1))),e._amount){var n,s,l,p;n=a.current-parseInt((e._amount-1)/2),s=a.current+e._center_pos,1>n?(l=1-n,n=1,s+=l,s=s>a.total?a.total:s):s>a.total&&(l=s-a.total,s=a.total,n-=l,n=1>n?1:n);for(var i=n;s>=i;i++)p=i==a.current?"current":"normal",t.push(e._generateHtml(p,i))}if(a.current<a.total?(t.push(e._generateHtml("next",a.current+1)),t.push(e._generateHtml("tail",a.total))):a.showDisableItem&&(t.push(e._generateHtml("next_disable",a.current+1)),t.push(e._generateHtml("tail_disable",a.total))),a.showStatus&&"tail"===a.statusPos&&t.push(e._generateHtml("status",a.current,a.total)),r=t.join(""),e._isNew&&(e._jwrapper=$("<div>",{"class":a.classname.wrapper}),e._jwrapper.bind("click",function(t){return"A"==t.target.nodeName&&("0"!==$(t.target).tbattr("ok")&&e.trigger("pageChange",parseInt($(t.target).tbattr("index"))),0==a.mode)?!1:void 0}),!a.isHtml)){var u="string"==typeof a.container?$("#"+a.container):$(a.container);u.empty(),u.append(this._jwrapper)}return a.isHtml?r:(e._jwrapper.html(r),void 0)},_generateHtml:function(e,a,t){var r="",n=this._cfg;r=n.template[e],r=r.replace(/#page#/g,a),r=r.replace(/#url#/g,n.url.replace(/\{page\}/g,a)),"undefined"!=typeof t&&(r=r.replace(/#total#/g,t));var s="";return n.classname[e]&&(s+='class="'+n.classname[e]+'"'),n.openInNew&&(s+=" target=_blank"),-1!==e.indexOf("disable")&&(s+=' ok="0"'),r=r.replace(/#special#/,s)}}});_.Module.define({path:"encourage-payment/widget/wallet_dialog",requires:["tbui/widget/JsPager","tbui/widget/LoginDialog","user/widget/UserHead","user/widget/icons"],sub:{isMember:!1,dialog:null,$content:null,$historyListWrapper:null,$historyEmpty:null,timestamp:+new Date,api:{expend:"/tbmall/mall/getConsumeOrder",income:"/tbmall/mall/getIncomeOrder",charge:"/tbmall/mall/getPayOrder"},listPage:{expend:0,income:0,charge:0},objGet:function(e,i,t){t=void 0===t?null:t,i=i.split(".");var s,a=e;for(s in i){if(!("object"==typeof a&&i[s]in a))return t;a=a[i[s]]}return a},objSet:function(e,i,t){return e[i]=t,e},initial:function(){var e=this;e.icon=e.requireInstance("user/widget/icons"),e.initUi(),e.initHistory(),e.initEvent(),e.initTrack()},show:function(e){var i=this;i.options=e||{},i.dialog.show(),i.$content.trigger("show")},hide:function(){this.dialog.hide()},initUi:function(){var e,i=this;$.ajax({url:i.api.expend,type:"GET",data:{pn:1,c:5,t:i.timestamp},dataType:"json",async:!1,success:function(t){if(0===t.no){var s=i.objGet(t,"data.user",{}),a=i.requireInstance("user/widget/UserHead"),n=i.objGet(s,"Parr_props.level",{}),o=i.objGet(n,"end_time",0),r=i.objGet(n,"props_id",0);s.scoresTotal=i.objGet(s,"Parr_scores.scores_total",0),i.isMember=r&&o>+new Date/1e3,s.isMember=i.isMember?"ismember":"isnotmember",s.memberLevel="ismember"===s.isMember?r:2,s.userIcon=i.icon.getPreIconHtml(s.mParr_props,s,!0),s.memberExpire="",s.isMember&&(o=new Date(1e3*o),s.memberExpire=[o.getFullYear(),o.getMonth()+1,o.getDate()].join("/")),s.homeUrl="/home/main?ie=utf-8&un="+encodeURIComponent(i.objGet(s,"user_name_utf8")),s.avatarStyle=a.getHeadFrameStyle(s,80).stylestr,s.avatarFrame=s.avatarStyle?"with":"not-with",s.avatar=a.getHeadUrl(s),s.iconinfo="";var d=["/tbmall/tshow?tab=detail&c=0","\u5c0a\u8d35\u8eab\u4efd, \u5c0a\u8d35\u6807\u8bc6","/tbmall/tshow?tab=detail&c=112","\u4e2a\u6027\u94ed\u724c, \u72ec\u4e00\u65e0\u4e8c","/tbmall/tshow?tab=detail&c=110","\u70ab\u9177\u88c5\u626e, \u95ea\u4eae\u5934\u50cf","/tbmall/tshow?tab=detail&c=103","\u8da3\u5473\u53d1\u5e16, \u4e2a\u6027\u6c34\u5370","/tbmall/tshow?tab=detail&c=108","\u9b54\u6cd5\u9053\u5177, \u7b7e\u5230\u795e\u5668"];for(e=0;e<d.length/2;e++)s.iconinfo+=_.template('<a href="<%= url %>" title="<%= title %>" target="_blank">     <span class="wd-icon-new hidden image-radius">NEW</span>     <span class="wd-icon image-round" style="background-position: <%= bgPosition %>">&nbsp;</span> </a>')({url:d[2*e],title:d[2*e+1],bgPosition:"-"+36*e+"px 0"});s.setpass=s.setpass?"\u4fee\u6539\u5bc6\u7801":"\u8bbe\u7f6e\u652f\u4ed8\u5bc6\u7801",s.umoneyLimit="\u6b63\u5728\u67e5\u8be2...";var l=_.template('<div class="wallet-dialog-main clearfix">     <div class="wd-userinfo-wrapper">         <div class="wd-userinfo <%= user.isMember %>">             <div class="wd-member">                 <div class="wd-avatar-wrapper wd-avatar-<%= user.avatarFrame %>-frame">                     <a class="wd-avatar" href="<%= user.homeUrl %>" style="<%= user.avatarStyle %>">                         <img src="<%= user.avatar %>" alt="avatar"/>                     </a>                 </div>                 <div class="wd-iconinfo-wrapper">                     <div class="wd-username-wrapper">                         <%= user.userIcon %>                         <span class="wd-username text-overflow"><%= user.user_name_utf8 %></span>                         <span class="wd-welcome wd-<%= user.isMember %>">\u5c0a\u8d35\u4f1a\u5458, \u60a8\u597d!</span>                         <span class="wd-welcome wd-not-<%= user.isMember %>">\u8d34\u5427\u7528\u6237, \u60a8\u597d!</span>                     </div>                     <div class="wd-icon-wrapper"><%= user.iconinfo %></div>                     <div class="wd-memberinfo-wrapper">                         <div class="wd-member-icon image-radius">                             <i class="icon-vip<%= user.memberLevel %>-16"></i>                             <span class="wd-<%= user.isMember %>">\u7eed\u8d39\u8d85\u7ea7\u4f1a\u5458</span>                             <span class="wd-not-<%= user.isMember %>">\u5f00\u901a\u4f1a\u5458</span>                         </div>                         <div class="wd-member-intro">                             <span class="wd-<%= user.isMember %>">\u5230\u671f: <%= user.memberExpire %></span>                             <span class="wd-not-<%= user.isMember %>">\u5f00\u901a\u4f1a\u5458\u5373\u4eab\u53d7\u4ee5\u4e0a\u7279\u6743</span>                         </div>                     </div>                 </div>             </div>             <div class="wd-tbean">                 <h2>\u6211\u7684T\u8c46:</h2>                  <div class="wd-tbeaninfo-wrapper">                     <div class="wd-tbean-num"><i class="icon-tbean"></i><%= user.scoresTotal %></div>                     <button class="wd-btn-tbeanget image-radius">\u83b7\u53d6T\u8c46</button>                     <a href="/tbmall/pass/set" target="_blank"><%= user.setpass %></a>                 </div>             </div>         </div>     </div>     <div class="wd-history-wrapper">         <div class="wd-fast-forward hidden"></div>         <div class="wd-history">             <div class="wd-history-type-wrapper">                 <div class="expend active" data-type="expend">\u652f\u51fa\u8bb0\u5f55</div>                 <div class="income" data-type="income">\u6536\u5165\u8bb0\u5f55</div>                 <div class="charge" data-type="charge">\u5145\u503c\u8bb0\u5f55</div>             </div>             <div class="wd-list-wrapper">                 <div class="wd-list-empty">                     <div class="wd-empty-content">                         <div>                             <h2 class="wd-empty-title">\u60a8\u8fd8\u6ca1\u6709<span class="wd-empty-type">\u652f\u51fa\u8bb0\u5f55</span>\u54e6</h2>                         </div>                     </div>                 </div>                 <div class="wd-list-category expend active hidden">                     <div class="wd-history-list"></div>                     <div class="wd-history-page-wrapper">                     </div>                 </div>                 <div class="wd-list-category income hidden">                     <div class="wd-history-list"></div>                     <div class="wd-history-page-wrapper">                     </div>                 </div>                 <div class="wd-list-category charge hidden">                     <div class="wd-history-list"></div>                     <div class="wd-history-page-wrapper">                     </div>                 </div>                 <div class="wd-history-more">                     <a href="javascript:">\u67e5\u770b\u66f4\u591a\u8bb0\u5f55>></a>                 </div>             </div>         </div>     </div> </div>')({user:s});i.dialog=new $.dialog({title:"\u6211\u7684T\u8c46\u94b1\u5305",html:l,show:!1,width:699}),i.dialog.element.addClass("wallet-dialog"),i.$content=i.dialog.element.find(".dialogJcontent"),i.$historyEmpty=i.$content.find(".wd-list-empty"),i.initPager("expend",i.objGet(t,"data.total_count",0),!0),i.parseExpendList(i.objGet(t,"data.order_list",0))}else 11e4===t.no&&(i.dialog.hide(),i.requireInstance("tbui/widget/LoginDialog",[]))}})},initUmoney:function(){var e=this,i='<a target="_blank" href="/f?ie=utf-8&kw=%B0%D9%B6%C8%D3%D0%C7%AE%CF%FB%B7%D1%BD%F0%C8%DA">',t="";$.get("/tbapp/umoney/queryQualification",{},function(s){0===s.no?0!==s.data.status?$.get("/tbapp/umoney/queryUserInfo",{},function(s){0===s.no&&(s=s.data.data,t=1===s.status?i+"\u7533\u8bf7</a>\u6210\u4e3a\u767e\u5ea6\u6709\u94b1\u7528\u6237, \u5c0a\u4eab\u65e0\u9650\u7279\u6743":2===s.status?"\u60a8\u7684\u7533\u8bf7\u6b63\u5728\u529e\u7406\u4e2d":3===s.status?i+"\u767e\u5ea6\u6709\u94b1\u53ef\u7528\u989d\u5ea6: "+s.credit+"\u5143</a>":"\u5e10\u6237\u5df2\u5931\u6548, \u8bf7\u91cd\u65b0"+i+"\u7533\u8bf7</a>",e.$content.find(".wd-umoney-limit").html(t))},"json"):e.$content.find(".wd-umoney-limit").html(i+"\u7533\u8bf7</a>\u6210\u4e3a\u767e\u5ea6\u6709\u94b1\u7528\u6237, \u5c0a\u4eab\u65e0\u9650\u7279\u6743"):11e4===s.no&&(e.dialog.hide(),e.requireInstance("common/widget/LoginDialog",[]))})},initHistory:function(){var e=this;$.get(e.api.income,{pn:1,c:5,t:e.timestamp},function(i){0===i.no?(e.initPager("income",e.objGet(i,"data.total_count",0)),e.parseIncomeList(e.objGet(i,"data.order_list",[]))):11e4===i.no&&(e.dialog.hide(),e.requireInstance("user/widget/LoginDialog",[]))},"json"),$.get(e.api.charge,{pn:1,c:5,t:e.timestamp,showMemberRecord:1},function(i){0===i.no?(e.initPager("charge",e.objGet(i,"data.total_count",0)),e.parseChargeList(e.objGet(i,"data.order_list",[]))):11e4===i.no&&(e.dialog.hide(),e.requireInstance("user/widget/LoginDialog",[]))},"json")},parseDateTime:function(e){e=1e3*parseInt(e,10)||0;for(var i=new Date(e),t=[i.getFullYear(),i.getMonth()+1,i.getDate(),i.getHours(),i.getMinutes()],s=0;s<t.length;s++)t[s]<10&&(t[s]="0"+t[s]);return[t[0],t[1],t[2]+" "+t[3]+": "+t[4]].join("-")},parseExpendList:function(e){var i,t,s=this,a="";for(i in e)t=e[i],t.isProp="hidden",t.createTime=s.parseDateTime(s.objGet(t,"create_time")),a+=_.template('<div class="wd-history-item">     <div class="first-line">         <span>\u8ba2\u5355\u53f7: </span>         <span><%= history.order_id %></span>         <span class="pull-right"><%= history.createTime %></span>     </div>     <div class="second-line">         <div>             <div class="text-overflow">                 <span>\u5151\u6362\u5546\u54c1&nbsp;</span>                 <span class="<%= history.isProp %> col-33">\u9053\u5177 - </span>                 <span class="bold col-33"><%= history.title %></span>             </div>         </div>         <div>             <div class="col-33">                 <span>\u6d88\u8d39 </span>                 <span class="col-fb"><%= history.scores %></span>                 <span> T\u8c46</span>             </div>         </div>         <div>             <div class="col-33">\u5151\u6362\u6210\u529f</div>         </div>     </div> </div>')({history:t});s.$content.find(".wd-list-category.expend>.wd-history-list").html(a)},parseIncomeList:function(e){var i,t,s=this,a="";for(i in e)t=e[i],t.createTime=s.parseDateTime(s.objGet(t,"create_time")),t.status="\u83b7\u53d6\u6210\u529f",a+=_.template('<div class="wd-history-item">     <div class="first-line">         <span>\u8ba2\u5355\u53f7: </span>         <span><%= history.order_id %></span>         <span class="pull-right"><%= history.createTime %></span>     </div>     <div class="second-line">         <div>             <div class="text-overflow">                 <span>\u901a\u8fc7&nbsp;</span>                 <span class="bold col-33"><%= history.title %></span>             </div>         </div>         <div>             <div class="col-33">                 <span>\u83b7\u53d6 </span>                 <span class="col-fb"><%= history.scores %></span>                 <span> T\u8c46</span>             </div>         </div>         <div>             <div class="col-33"><%= history.status %></div>         </div>     </div> </div>')({history:t});s.$content.find(".wd-list-category.income>.wd-history-list").html(a)},parseChargeList:function(e){var i,t,s=this,a="";for(i in e)t=e[i],t.createTime=s.parseDateTime(s.objGet(t,"finish_time")),a+=_.template('<div class="wd-history-item">     <div class="first-line">         <span>\u8ba2\u5355\u53f7: </span>         <span><%= history.order_id %></span>         <span class="pull-right"><%= history.createTime %></span>     </div>     <div class="second-line">         <% if (history.scene_id == 100002) { %>         <div>             <div class="text-overflow">                 <span class="col-33 bold">T\u8c46</span>             </div>         </div>         <div>             <div class="col-33">                 <span>\u6d88\u8d39</span>                 <span class="col-fb"><%= history.money %></span>                 <span> \u5143</span>             </div>         </div>         <div>             <div class="col-33">                 <span>\u83b7\u53d6 </span>                 <span class="col-fb"><%= history.scores %></span>                 <span> T\u8c46</span>             </div>         </div>         <div>             <div class="col-33">\u83b7\u53d6\u6210\u529f</div>         </div>         <%         } else if (history.scene_id == 1050001 || history.scene_id == 1050002) {         %>         <div>             <div class="text-overflow">                 <span class="col-33 bold"><%= history.scene_id == 1050001 ? \'\u8d34\u5427\u4f1a\u5458\' : \'\u8d34\u5427\u8d85\u7ea7\u4f1a\u5458\' %></span>             </div>         </div>         <div>             <div class="col-33">                 <span>\u6d88\u8d39</span>                 <span class="col-fb"><%= history.money %></span>                 <span> \u5143</span>             </div>         </div>         <div>             <div class="col-33">                 <span class="col-fb"><%= history.time %></span>                 <span> \u4e2a\u6708</span>             </div>         </div>         <div>             <div class="col-33">\u83b7\u53d6\u6210\u529f</div>         </div>         <% } %>     </div> </div>')({history:t});s.$content.find(".wd-list-category.charge>.wd-history-list").html(a)},initPager:function(e,i,t){var s=this,a=Math.ceil(i/5),n=s.$content.find(".wd-list-category."+e),o=n.find(".wd-history-page-wrapper");if(s.listPage[e]=a,0===a)o.remove(),t&&s.$historyEmpty.show().siblings().hide();else{var r=s.use("tbui/widget/JsPager",{container:o,current:1,amount:4,total:a,classname:{wrapper:"wd-page-wrapper"}});r.bind("pageChange",function(i,t){r.initial({current:t}),s.routeParseData(e,t)}),t&&s.$historyEmpty.hide().siblings("."+e+", .wd-history-more").show()}},routeParseData:function(e,i){var t=this,s={pn:i,c:5,t:t.timestamp};"charge"===e&&(s.showMemberRecord=1),$.get(t.api[e],s,function(i){0===i.no?t["parse"+e.substr(0,1).toUpperCase()+e.substr(1)+"List"](t.objGet(i,"data.order_list")):11e4===i.no&&(t.dialog.hide(),t.requireInstance("user/widget/LoginDialog",[]))})},initEvent:function(){var e=this,i=e.$content.find(".wd-list-wrapper"),t=e.$content.find(".wd-fast-forward"),s=e.$content.find(".wd-history-more"),a=100;e.longHistory=!1,this.$content.on("click",".wd-history-more",function(){t.slideDown(a),s.slideUp(a),i.animate({height:410},a),e.longHistory=!0}).on("click",".wd-fast-forward",function(){var n=e.$content.find(".wd-list-type-wrapper").data("type");t.slideUp(a),0!==e.listPage[n]&&s.slideDown(a),i.animate({height:278},a),e.longHistory=!1}).on("click",".wd-history-type-wrapper>div:not(.active)",function(){var i=$(this),t=i.data("type");i.addClass("active").siblings(".active").removeClass("active"),0===e.listPage[t]?(e.$historyEmpty.show().siblings().hide(),e.$historyEmpty.find(".wd-empty-type").html(i.html())):($(".wd-list-category."+t).show().siblings().hide(),e.longHistory===!1&&s.show())}).on("click",".wd-umoney-show",function(){$(this).hide().prev().hide().next().next().show()}).on("click",".wd-member-icon",function(){e.requireInstance("encourage-member/widget/JoinVipDialog").getMemberDialog(129,1004001e3)}).on("click",".wd-btn-tbeanget",function(){e.requireInstance("encourage-payment/widget/tcharge_dialog",[e.objSet({},"consumption_path",130)])}).on("click",".wd-list-empty a",function(){e.requireInstance("encourage-payment/widget/tcharge_dialog",[e.objSet({},"consumption_path",131)])})},initTrack:function(){var e="t\u8c46\u94b1\u5305",i=this.isMember?"":"\u975e";this.$content.on("show",function(){$.stats.track("t\u8c46\u94b1\u5305\u5f39\u51fa",e)}).on("click",".wd-member-icon",function(){$.stats.track(i+"\u4f1a\u5458\u7528\u6237\u8d2d\u4e70",e)}).on("click",".wd-btn-tbeanget",function(){$.stats.track(i+"\u4f1a\u5458\u83b7\u53d6t_button",e)}).on("click",".wd-list-empty a",function(){$.stats.track(i+"\u4f1a\u5458\u4fc3\u9500\u70b9\u51fb",e)})}}});_.Module.define({path:"tbui/widget/card",requires:[],sub:{_option:{},_j_card:null,_open_timer:null,_close_timer:null,_is_show:!1,_is_first_show:!0,_default_option:{content:"",arrow_dir:"down",arrow_pos:{},card_css:{width:170,"z-index":1001},arrow_req:!0,auto_positon:!1,event_target:null,offset:{x:0,y:0},card_leave_display:!1,card_hover_show:!0,card_leave_hide:!1,attr:"",clazz:"",wrap:$("body")},initial:function(t){var i=this;i._option=$.extend(!0,{},i._default_option,t),this._buildCard()},_buildCard:function(){var t=this._option,i=this._genericTpl(),e=t.wrap;this._j_card=$(i),this._j_card.find(".j_content").html(t.content),e.append(this._j_card),delete t.card_css.height,this._j_card.css(t.card_css),t.card_css.height=this._j_card.find(".j_content").outerHeight(!0),this._arrow=this._j_card.find(".j_ui_white_arrow"),void 0===t.arrow_pos.left&&(this._arrow_left=t.card_css.width/2-10,this._arrow.css({left:this._arrow_left})),this._arrow.css(t.arrow_pos),t.arrow_req||this._j_card.find(".j_ui_white_arrow").hide(),t.auto_positon&&this._autoPosition()},_autoPosition:function(){var t=this._option,i={},e=$(window).height(),_=$(window).width(),o=($(document).scrollLeft(),$(document).scrollTop()),r=(t.event_target.innerWidth(),t.event_target.innerHeight()),s="",a={x:t.event_target.offset().left-t.card_css.width/2+t.event_target.outerWidth(!0)/2,y:t.event_target.offset().top-t.card_css.height-10,width:this._j_card.innerWidth(),height:this._j_card.innerHeight()+this._arrow.innerHeight()};i.left=a.x,i.top=a.y;var n=t.arrow_pos.left||this._arrow_left,d=15,h=_;_<$(document).width()&&(h=$(document).width());var c=h-(t.card_css.width+d);i.left<d?(n+=i.left-d,i.left=d):i.left>c&&(n+=i.left-c,i.left=c),i.top<o?(s="up",i.top+=r+(a.height||0),i.top-=t.offset.y):(i.top+=i.top+r>o+e?-r-(a.height||0):0,s="down",i.top+=t.offset.y),this._arrow.removeClass("ui_white_down").removeClass("ui_white_up").addClass("ui_white_"+s).css({left:n}),this._j_card.css(i)},_genericTpl:function(){var t=this._option.attr,i=this._option.arrow_dir,e=this._option.clazz,_=['<div class="ui_card_wrap '+e+'" '+t+' style="visibility: hidden">','<div class="j_content ui_card_content ">',"</div>",'<span class="j_ui_white_arrow arrow ui_white_'+i+'"></span>',"</div>"].join("");return _},showCard:function(t){var i=this;i._close_timer&&clearTimeout(i._close_timer),t&&"delayShow"==t.type?(i._open_timer&&clearTimeout(i._open_timer),i._open_timer=setTimeout(function(){i._showCardDo()},t.time)):i._showCardDo()},closeCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayClose"==t.type?i._close_timer=setTimeout(function(){i._closeCardDo()},t.time):i._closeCardDo()},hideCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayHide"==t.type?i._close_timer=setTimeout(function(){i._hideCardDo()},t.time):i._hideCardDo()},_showCardDo:function(){var t=this;t._is_first_show&&(this._j_card.bind("mouseenter",function(){t._option.card_hover_show&&(t._is_show=!0)}),this._j_card.bind("mouseleave",function(){return t._option.card_leave_display?!1:(t._is_show=!1,t._option.card_leave_hide?t.hideCard():t.closeCard(),void 0)}),t._is_first_show=!1),this._j_card.css({visibility:"visible"})},_closeCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.remove()},_hideCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.css({visibility:"hidden"})},setContent:function(t){var i=this._option;if(null!==this._j_card){var e=this._j_card.find(".j_content");e.html(t),i.card_css.height=e.outerHeight(!0),this._j_card.css({height:i.card_css.height}),i.auto_positon&&this._autoPosition()}}}});_.Module.define({path:"common/widget/Userbar",requires:["DropDownList","tbui/widget/Card","encourage-payment/widget/wallet_dialog","common/widget/newMessageSystem","encourage-payment/widget/cashierDialog","tbui/widget/messenger","encourage-payment/widget/baseUserData","encourage-payment/widget/payMember","tbui/widget/http_transform"],sub:{_btns:{},_userinfo:null,$root:null,_logoutTimer:null,_product:null,_self:this,_urls:{itb_home:"",my_itb:"",my_club:"",u_split:"",my_space:""},_ddls:{itb:null,club:null,space:null},_userDataRended:{my_forum:!1,club:!1,space:!1},initial:function(t){this.options=t,this._userinfo=PageData.user,this._product=t.page||"",this._userLevel=t.userLevel,this._userBarConfigData=t.userBarConfigData,TbCom.process("User","init",this._userinfo,this._product),this._buildLayout(),TbCom.process("MsgSystem","init"),EncourageData={userLevel:t.userLevel,userScore:t.userScore,vipInfo:t.vipInfo||{}},this._bluePush(t.bluePush)},_isDateTime:function(t){var e=864e5,i=t+e,s=Number(localStorage.getItem("tiebaPush"));return+new Date<i&&(s&&s!==t||!s)?!0:!1},_bluePush:function(t){if(t.diamond&&t.diamond.notice_time&&t.unit&&t.handle&&"open"===t.handle[0]){var e=1e3*Number(t.diamond.notice_time);if(this._isDateTime(e)){var i={acceptValue:t.unit.button[0],cancelValue:"\u5173\u95ed",onaccept:function(){window.open(t.unit.url[0])}};this._blue_dialog=new $.dialog.confirm(t.unit.text[0],i),localStorage.setItem("tiebaPush",e)}}},_bindEvent:function(t){t.delegate(".j_u_blue","click",function(){$.stats.track("\u70b9\u51fb\u7edf\u8ba1","\u6211\u7684\u84dd\u94bb")})},_initURLs:function(){this._urls.itb_st_param="st_mod=userbar&fr=tb0_"+this._product,this._urls.itb_home="/i/sys/jump?un="+this._userinfo.name_url+(this._userinfo.no_un?"&fr_noun=1":""),this._urls.my_favor=this._urls.itb_home+"&type=storethread&"+this._urls.itb_st_param,this._urls.itb_profile="/home/profile?un="+this._userinfo.name_url+(this._userinfo.no_un?"&fr_noun=1":"")},_buildLayout:function(t){var e=this,i="";-1!=$.inArray(this._product,["tbmall","livetool"])&&(i="userbar_theme2"),this.$root=$('<div id="com_userbar" class="userbar '+i+'"></div>');var s=$.getcurzIndex();(null==s||0>=s)&&(s=11e3),this.$root.css({"z-index":s});var a=t?$(t):$("body");if(a.prepend(this.$root),this.$root.on("click","a",function(){var t=$(this),e="\u9876\u90e8-";t.parents(".u_setting").length>0?e="\u8bbe\u7f6e-":t.parents(".u_news").length>0?e="\u6d88\u606f-":t.parents(".u_username").length>0&&(e="\u7528\u6237\u540d-");var i=$.trim($(this).text()).replace(/[(\s\d)]+/,"");(0==$.trim(t.html()).length||t.hasClass("u_username_wrap"))&&(i=t.tbattr("title")),t.hasClass("j_cleardata")&&(e="\u6d88\u606f-"),i=e+i,$.stats.track(i,"\u8d34\u5427\u9876\u90e8\u5bfc\u822a\u70b9\u51fb\u7edf\u8ba1")}),this._userinfo.is_login)this._buildLoginLayout(),this._buildNews(),e._buildOfflineCard(),TbCom.process("User","getUserInfoByRequest",function(t){e._initURLs(t),e._buildUsername(t),e._buildUSetting(t),e._buildToHome(t),e._buildToExtraUrl(),e._buildMember(t);var i=$("#com_userbar").width();$("#head .j_search_nav").css("margin-right",i)});else{this._buildLogoutLayout(),this._buildToHome(),this._buildToExtraUrl(),e._buildMember();var r=$("#com_userbar").width();$("#head .j_search_nav").css("margin-right",r)}this._bindEvent(a)},_buildLoginLayout:function(){var t=["<ul>",'<li class="u_split"></li>','<li class="u_bdhome"></li>','<li class="u_extraurl"></li>','<li class="u_username" id="j_u_username"></li>','<li class="u_news"></li>','<li class="u_member"></li>','<li class="u_setting"></li>',"</ul>"].join("");this.$root.html(t),this._btns.logout=$('<a href="#" >\u9000\u51fa</a>')},_buildLogoutLayout:function(){var t=["<ul>",'<li class="u_split"></li>','<li class="u_bdhome"></li>','<li class="u_extraurl"></li>','<li class="u_login"></li>','<li class="u_reg"></li>','<li class="u_hermes"></li>','<li class="u_member"></li>',"</ul>"].join("");this._btns.reg=$('<div class="u_menu_item"><a href="https://passport.baidu.com/v2/?reg&tpl=tb&u=http://tieba.baidu.com?tb_mod=userBar&tb_fr=index" onclick="return false;" >\u6ce8\u518c</a></div>'),this._btns.login=$('<div class="u_menu_item"><a href="#" onclick="return false;">\u767b\u5f55</a></div>'),this._btns.hermes=$('<div class="u_menu_item"><a href="/hermes/feedback">\u95ee\u9898\u53cd\u9988</a></div>'),this.$root.html(t),this.$root.find(".u_reg").append(this._btns.reg),this.$root.find(".u_login").append(this._btns.login),this.$root.find(".u_hermes").append(this._btns.hermes),this._btns.reg.click(function(){TbCom.process("User","buildRegisterFrame","userBar")}),this._btns.login.click(function(){_.Module.use("tbui/widget/LoginDialog",["","userBar"])})},_buildUsername:function(t){var e=this.$root.find(".u_username"),i=$('<div class="u_menu_item u_menu_username"></div>'),s=$.tb.transforEmoji(t.name_weak,t.name_show),a="",r="";r=t.no_un?"https:/passport.baidu.com/v2/?ucenteradduname&u="+encodeURIComponent(location.href):"//tieba.baidu.com/home/main?id="+t.portrait+"&fr=userbar";var n="";this._userLevel&&this._userLevel.end_time>+new Date/1e3&&(n='style="color:#FF0000;"'),a='<a href="'+r+'" title="\u70b9\u51fb\u5230\u4e2a\u4eba\u4e2d\u5fc3" class="u_username_wrap">'+a+'<span class="u_username_title" '+n+">"+s+'</span><i class="i-arrow-down"></i></a>',i.html(a),e.append(i);var o="";if(t.rt_room_id){var l="";for(var u in t.rt_room_id)u&&(l=u);o='<li class="u_liveroom"><a href="/show/'+l+'" target="_blank">\u6211\u8981\u76f4\u64ad</a></li>'}var _="",c='<ul><li class="u_itieba"><a href="/home/main?id='+t.portrait+'&fr=userbar" >\u6211\u7684\u8d34\u5427</a></li><li class="u_mytbmall"><a href="/tbmall/mymall" target="_blank">\u6211\u7684\u5546\u57ce</a></li><li class="u_favor" location="user_favor_ch"><a href="'+this._urls.my_favor+'" target="_blank">\u6211\u7684\u6536\u85cf</a></li><li class="u_pan"><a href="http://pan.baidu.com/" target="_blank">\u6211\u7684\u7f51\u76d8</a></li><li class="u_game"><a href="/game/index" target="_blank">\u6211\u7684\u6e38\u620f</a></li>'+o+'<li class="u_blue"><a class="j_u_blue" href="/f?ie=utf-8&kw=%E8%93%9D%E9%92%BB&fr=search" target="_blank">\u6211\u7684\u84dd\u94bb</a></li>'+_+"</ul>",d=this._ddls.uname=this.use("DropDownList",e,i,"uname");d.innerContent("top",c)},_buildUSetting:function(t){var e=this,i=this.$root.find(".u_setting"),s=$('<div class="u_menu_item u_menu_setting"><a class="u_setting_wrap" href="#" onclick="return false;">\u66f4\u591a<i class="i-arrow-down"></i></a></div>');i.append(s);var a=["<ul>",'<li><a href="https://tiebac.baidu.com/c/s/download/pc?src=webtbGF" target="_blank">\u624b\u673aAPP</a></li>','<li><a href="/f?kw=%D3%A6%D3%C3%D6%D0%D0%C4&fr=userbar" target="_blank">\u5e94\u7528\u4e2d\u5fc3</a></li>','<li><a href="//passport.baidu.com/?center&tpl=tb&aid=6&default_tab=3#3,0">\u5e10\u53f7\u8bbe\u7f6e</a></li>','<li class="u_tb_profile"><a href="',this._urls.itb_profile,'">\u8d34\u5427\u8bbe\u7f6e</a></li>','<li class="pm_center"><a href="//tieba.baidu.com/pmc" class="j_pmc-center" target="_blank">\u670d\u52a1\u4e2d\u5fc3</a></li>','<li class="fuwu_center"><a href="//tieba.baidu.com/hermes/feedback" class="j_help-center" target="_blank">\u95ee\u9898\u53cd\u9988</a></li>','<li class="u_logout"></li>',"</ul>"].join(""),r=this._ddls.usetting=this.use("DropDownList",i,s);r.innerContent("top",a),$("body").on("click.helpcenter",".j_help-center",function(){$.stats.track("helpcenter","UEG-track-click","userbar","click")}),t.no_un&&i.find(".u_tb_profile a").click(function(){return TbCom.process("User","buildUnameFrame"),!1}),i.find(".u_logout").append(this._btns.logout),this._btns.logout.click(function(){e._logout()})},_buildMember:function(t){var e=this,i=this.$root.find(".u_member"),s=$('<div class="u_menu_item u_menu_member"><a class="u_member_wrap" href="#" onclick="return false;"><i class="i-member"></i>\u4f1a\u5458<i class="i-arrow-down"></i></a></div>');i.append(s);var a=e._getJoinVip(t),r=["<ul>",'<li><a class="dropdown-dou j_wallet" href="#" onclick="return false"><i class="i-dropdown-dou"></i>T\u8c46\u94b1\u5305</a></li>','<li><a class="dropdown-tbmall" href="//tieba.baidu.com/tbmall/home" target="_blank"><i class="i-dropdown-tbmall"></i>T\u8c46\u5546\u57ce</a></li>',a,"</ul>"].join(""),n=this._ddls.usetting=this.use("DropDownList",i,s);n.innerContent("top",r),i.on("click",".j_wallet",function(t){$.stats.track("T\u8c46\u5bfc\u822a\u680f","\u4f1a\u5458\u5b98\u7f51\u7edf\u8ba1"),t.preventDefault(),e.requireInstance("encourage-payment/widget/wallet_dialog").show()}),i.on("click",".j_btn_getmember",function(){if(!PageData.user.is_login)return _.Module.use("tbui/widget/LoginDialog"),!1;if(e.isMemeber)e._flowRateTest();else{window.open("/tbmall/tshow")}return!1})},_flowRateTest:function(){var t=this.requireInstance("encourage-payment/widget/pay_member"),e={fr:"userbar",scene_id:1001001e3};t.showCashier(e)},_getJoinVip:function(){var t=!1,e="\u4f1a\u5458\u5b98\u7f51",i=+new Date;this._userLevel&&1e3*this._userLevel.end_time>i?(t=!0,e=(this._userLevel.props_id>1?"\u7eed\u8d39\u8d85\u7ea7":"\u5347\u7ea7\u8d85\u7ea7")+"\u4f1a\u5458"):this._userLevel&&1e3*this._userLevel.end_time<i&&(t=!0,e="\u5f00\u901a\u4f1a\u5458");var s='<li><a class="u_joinvip_wrap vip_red j_btn_getmember" href="javascript:;"  target="_blank"><i class="i-dropdown-member"></i>'+e+"</a></li>";return this.isMemeber=t,s},_buildToHome:function(){var t=this.$root.find(".u_bdhome"),e="\u767e\u5ea6\u9996\u9875",i=this.requireInstance("tbui/widget/http_transform"),s=i.httpTransform("http://www.baidu.com?tn=SE_hldp03480_530ir7bs"),a=$('<div class="u_menu_item u_menu_bdhome j_u_menu_bd_home_link"><a  href="'+s+'" target="_blank" onclick="$.stats.track(\'top_baiduhomepage_link\', \'ps_callback_statics\')">'+e+"</a></div>");t.html(a),t.on("click",".j_u_menu_bd_home_link",function(){$.stats.track("\u53ec\u5524\u5ea6\u5a18\u70b9\u51fb\u91cf","\u7528\u6237\u6761")})},_buildToExtraUrl:function(){if(this._userBarConfigData&&1===+this._userBarConfigData.switch){$.stats.track("\u6362\u91cf\u5bfc\u6d41","\u7528\u6237\u6761","","view");var t=this,e=this.$root.find(".u_extraurl"),i=this._userBarConfigData.word,s=t.requireInstance("tbui/widget/http_transform"),a=s.httpTransform(this._userBarConfigData.url),r=$('<div class="u_menu_item u_menu_extra_url j_u_menu_extra_url_link"><a  href="'+a+'" target="_blank" >'+i+"</a></div>");e.html(r),e.on("click",".j_u_menu_extra_url_link",function(){$.stats.track("\u6362\u91cf\u5bfc\u6d41","\u7528\u6237\u6761","","click")})}},_buildOfflineCard:function(){var t=this,e=1*new Date;e>1408032e6||$.tb.Storage.get("balv_tdou_update")>e||(t.offline_card=this.use("tbui/widget/Card",{content:'<span style="cursor:pointer;position: absolute;width: 10px; height: 10px; right: 5px; top: 6px;" class="j_close"></span><a target="_blank" class="j_link" href="/p/3199708402"><img style="margin: 4px 4px 0;" src="//tb1.bdstatic.com/tb/static-ucenter/img/offline1.png"></a>',clazz:"doupiao_offline",arrow_dir:"up",card_css:{width:172,"z-index":1010,right:10,top:30},arrow_pos:{left:70,top:-8},wrap:$("#com_userbar"),card_leave_display:!0}),t.offline_card._j_card.on("click",".j_close",function(){$.tb.Storage.set("balv_tdou_update",e+864e5),t.offline_card._j_card.remove()}).on("click",".j_link",function(){$.tb.Storage.set("balv_tdou_update",e+864e5),t.offline_card._j_card.remove()}),t.offline_card.showCard())},_buildNews:function(){this.use("common/widget/newMessageSystem",{sbduss:this.options.lcsKey})},_logout:function(){var t,e=this,i=0;try{t=PageData.user?PageData.user.name:""}catch(s){t=""}try{i="baidubrowser.tieba"==window.external.GetVersion("version")?!0:null}catch(s){i=null}(!$.cookie("baidu_broswer_setup_"+t)&&!i||"NaN"===$.cookie("baidu_broswer_setup_"+t))&&$.cookie("baidu_broswer_setup_"+t,0);var a=["<p>\u786e\u5b9a\u8981\u9000\u51fa\u5417\uff1f\u9000\u51fa\u540e\u5c06\u65e0\u6cd5\u6536\u5230\u5427\u53cb\u4e92\u52a8\u6d88\u606f</p>",'<p><span>\u60a8\u53ef\u4ee5\u9009\u62e9</span><span class = "switch_login">\uff3b\u5207\u6362\u8d26\u6237\uff3d</span></p>','<div class = "quit_logout btn_logout">\u9000\u51fa</div>','<div class = "cancel_logout btn_logout">\u53d6\u6d88</div>'],r=a.join(""),n=new $.dialog({html:r,height:"120px",width:"430px",title:"\u786e\u5b9a\u8981\u9000\u51fa\u5417\uff1f",holderClassName:"logout_dialog"});$(".logout_dialog").on("click",".switch_login",function(){return n.close(),e.requireInstance("tbui/widget/LoginDialog"),!1}).on("click",".cancel_logout",function(){n.close()}).on("click",".quit_logout",function(){TbCom.process("User","logout")})}}}),_.Module.define({path:"common/widget/Userbar/DropDownList",requires:[],sub:{_ite:null,_wrapper:null,key:null,_listWrapper:null,_conWrapper:null,_bottomConWrapper:null,_topConWrapper:null,initial:function(t,e,i){this._wrapper=t,this._ite=e,this.key=i,this._build()},_build:function(){var t=['<div class="u_ddl">','<div class="u_ddl_con">','<span class="u_ddl_arrow"> <em></em> </span>','<div class="u_ddl_con_top"></div>','<div class="d_ddl_con_bottom"></div>',"</div>","</div>"].join("");this._listWrapper=$(t),this._wrapper.append(this._listWrapper),this._conWrapper=this._listWrapper.find(".u_ddl_con:first"),this._topConWrapper=this._listWrapper.find(".u_ddl_con_top:first"),this._bottomConWrapper=this._listWrapper.find(".d_ddl_con_bottom:first"),this._bindEvents()},_bindEvents:function(){var t,e=this;e._wrapper.hover(function(){t&&clearTimeout(t),e.expand()},function(){t=setTimeout(function(){e.close()},0)})},_innerTopContent:function(t){"object"==typeof t?this._topConWrapper.append(t):"string"==typeof t&&this._topConWrapper.html(this._topConWrapper.html()+t)},_innerBottomContent:function(t){"object"==typeof t?this._bottomConWrapper.append(t):"string"==typeof t&&this._bottomConWrapper.html(this._bottomConWrapper.html()+t),this._bottomConWrapper.css("display","block")},expand:function(){var t=this._ite.innerWidth()-16,e=this._listWrapper.width(),i=(t-e)/2;this._listWrapper.css({display:"block",left:i+4})},close:function(){this._ite.removeClass("u_menu_hover"),this._listWrapper.css("display","none")},innerContent:function(t,e){"top"==t?this._innerTopContent(e):"bottom"==t&&this._innerBottomContent(e)}}});