_.Module.define({path:"tbui/widget/slide_show",sub:{defaultOptions:{delayLoadPic:!1,effect:"slide",activeClass:"tbui_slideshow_active",baseZIndex:0,interval:5e3,slide:{speed:500},fade:{speed:500},triggerHandler:"click",callBack:function(){}},initial:function(t){t=$.extend({},this.defaultOptions,t);var i=this;this.options=t,this.animating=!1,this.current=0,this.vendorPrefix=!1,this.$nav=$(t.nav),this.$navItem=this.$nav.children(),this.total=this.$navItem.size()||t.total,this.$container=$(t.target),this.$list=this.$container.children(".tbui_slideshow_list"),this.$tokens=this.$list.children(),t.width||(t.width=this.$container.width()),t.height||(t.height=this.$container.height()),this.$container.add(this.$list).css({width:t.width,height:t.height}),this.interval=t.interval||5e3,this.picLoadedIndex={},this.$navItem.first().addClass(t.activeClass),this.$tokens.first().show(),this.showOriPic(0),"click"==t.triggerHandler?this.$navItem.click(function(){var e=this;t.auto&&i.stop(),this.delayHandler=setTimeout(function(){i.delayHandler=null,i.setActive($(e).index())},10)}).bind("mouseout",function(){t.auto&&i.play(),this.delayHandler&&clearTimeout(this.delayHandler)}):"hover"==t.triggerHandler&&this.$navItem.hover(function(){var e=this;t.auto&&i.stop(),this.delayHandler=setTimeout(function(){i.delayHandler=null,i.setActive($(e).index())},200)},function(){t.auto&&i.play(),this.delayHandler&&clearTimeout(this.delayHandler)}),this.effectHandler=this["_"+t.effect],t.auto&&(this.play(),this.$list.hover(function(){i.stop()},function(){i.play()})),t.next&&$(t.next).click(function(t){t.preventDefault(),t.stopPropagation(),i.next()}),t.prev&&$(t.prev).click(function(t){t.preventDefault(),t.stopPropagation(),i.prev()})},setActive:function(t){return this.animating||t===this.current?!1:(this.$navItem.removeClass(this.options.activeClass).eq(t).addClass(this.options.activeClass),this.effectHandler(t),this.showOriPic(t),this.options.callBack&&this.options.callBack(t),!0)},next:function(){var t=this.current+1;t==this.total&&(t=0),this.setActive(t)},prev:function(){var t=this.current-1;-1==t&&(t=this.total-1),this.setActive(t)},play:function(){var t=this;null==this.autoHandler&&(this.autoHandler=setInterval(function(){t.next()},this.options.interval))},showOriPic:function(t){if(this.options.delayLoadPic&&!this.picLoadedIndex["_"+t]){for(var i,e=this.$tokens.eq(t).find("img"),n=e.length,s=0;n>s;s++){i=$(e[s]);var a=i.tbattr("orisrc");a&&i.tbattr("src",a)}this.picLoadedIndex["_"+t]=1}},stop:function(){clearInterval(this.autoHandler),this.autoHandler=null},_slide:function(t){var i,e,n,s,a,o,r,l=this;this.animating=!0,i=this.current,r=t>i?1:-1,e=t>i?-this.options.width:this.options.width,s=t,this.$tokens.eq(i).siblings().css({display:"none",left:0,zIndex:0+this.options.baseZIndex}),this.$tokens.eq(s).css({display:"block",left:r*this.options.width,zIndex:10+this.options.baseZIndex}),this.vendorPrefix?(a=this.vendorPrefix,o=a+"Transform",n=a+"TransitionDuration",this.$list[0].style[o]="translateX("+e+"px)",this.$list[0].style[n]=this.options.slide.speed+"ms",this.$list.on("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",function(){l.$list[0].style[o]="",l.$list[0].style[n]="",l.$tokens.eq(s).css({left:0}),l.$tokens.eq(i).css({display:"none",left:0,zIndex:0}),l.animating=!1,l.current=s,l.$list.unbind("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd"),l.trigger("animateEnd")})):l.$list.stop().animate({left:e},this.options.slide.speed,function(){l.$list.css({left:0}),l.$tokens.eq(s).css({left:0}),l.$tokens.eq(i).css({display:"none",left:0,zIndex:0}),l.current=s,l.animating=!1,l.trigger("animateEnd")})},_fade:function(t){var i,e,n=this;this.animating=!0,i=this.current,e=t,this.$tokens.eq(e).css({display:"none",left:0,zIndex:10+this.options.baseZIndex}),this.$tokens.eq(i).stop().fadeOut(this.options.fade.speed),this.$tokens.eq(e).stop().fadeIn(this.options.fade.speed,function(){n.$tokens.eq(e).css({zIndex:0+n.options.baseZIndex}),n.animating=!1,n.current=e,n.trigger("animateEnd")})},_getVendorPrefix:function(){var t,i,e,n,s;for(t=document.body||document.documentElement,e=t.style,n="Transition",s=["Moz","Webkit","Khtml","O","ms"],i=0;i<s.length;){if("string"==typeof e[s[i]+n])return s[i];i++}return!1}}});_.Module.define({path:"frs-list/widget/forum_recommend",requires:["tbui/widget/slide_show","tbui/widget/login_dialog"],sub:{_slideShow:null,_slideConfig:{nav:".recommend_nav",target:"#slide_show",activeClass:"active",interval:5e3,auto:!1,next:".exchange",prev:"",delayLoadPic:!0,slide:{speed:1e3}},initial:function(){$.stats.track("\u76f8\u5173\u5427\u63a8\u8350","\u5c55\u793a\u91cf","frs","click",{});var e=this,t=$("#forum_recommend"),i=t.find(".slide_nav li").length;e._slideShow=e.requireInstance("tbui/widget/slide_show",[e._slideConfig]),t.on("click",".j_recommend_flow_click",function(t){var i=$(t.currentTarget);if(!PageData.user.is_login)return e.requireInstance("tbui/widget/login_dialog"),!1;if("1"===$(this).tbattr("is_clicked"))return!1;var a={fid:$(this).getData("data-fid").fid,fname:$.tb.escapeHTML($(this).tbattr("title")),uid:PageData.user.name,ie:"gbk",tbs:$(this).getData("data-tbs").tbs};$.post("/f/like/commit/add",a,function(e){"undefined"==typeof e.no?$.dialog.alert("<p style='text-align: center;'>\u8bf7\u6c42\u5f02\u5e38\uff0c\u8bf7\u91cd\u8bd5\uff01</p>",{title:"\u5173\u6ce8\u7ed3\u679c",acceptValue:"\u786e\u5b9a"}):($.dialog.alert("<p style='text-align: center;'>\u5173\u6ce8\u6210\u529f\uff01</p>",{title:"\u5173\u6ce8\u7ed3\u679c",acceptValue:"\u786e\u5b9a"}),i.removeClass("btn-attention").addClass("btn-sub").text("\u5df2\u5173\u6ce8"),i.tbattr("is_clicked","1"))},"json"),$.stats.track("\u76f8\u5173\u5427\u63a8\u8350","\u5355\u4e2a\u5173\u6ce8\u7684\u70b9\u51fb\u91cf","frs","click",{})}),t.find(".all_attention").bind("click",function(){if(!PageData.user.is_login)return e.requireInstance("tbui/widget/login_dialog"),!1;$.stats.track("\u76f8\u5173\u5427\u63a8\u8350","\u4e00\u952e\u5173\u6ce8","frs","click",{});for(var a=t.find(".active"),n=a.children(".recommend_item"),c=0;c<n.length;c++){var s=n.eq(c).find("a.recommend_flow"),l={fid:s.getData("data-fid").fid,fname:$.tb.escapeHTML(s.tbattr("title")),uid:PageData.user.user_name,ie:"gbk",tbs:s.getData("data-tbs").tbs};$.post("/f/like/commit/add",l)}return $.dialog.alert("<p style='text-align: center;'>\u5173\u6ce8\u6210\u529f\uff01</p>",{title:"\u5173\u6ce8\u7ed3\u679c",acceptValue:"\u786e\u5b9a"}),1==i?(t.hide(),void 0):(a.remove(),i-=1,e._slideShow=e.requireInstance("tbui/widget/slide_show",e._slideConfig),1==i?t.find(".exchange").hide():e._slideShow.next(),void 0)}),t.on("click",".exchange",function(){$.stats.track("\u76f8\u5173\u5427\u63a8\u8350","\u6362\u4e00\u6362","frs","click",{})}),t.on("click",".recommend_forum_pic",function(){$.stats.track("\u76f8\u5173\u5427\u63a8\u8350","\u5427\u5934\u56fe\u7684\u70b9\u51fb\u91cf","frs","click",{})}),t.on("click",".recommend_item_p .name",function(){$.stats.track("\u76f8\u5173\u5427\u63a8\u8350","\u5427\u540d\u7684\u70b9\u51fb\u91cf","frs","click",{})}),t.on("click",".recommend_item",function(){$.stats.track("\u76f8\u5173\u5427\u63a8\u8350","\u56db\u4e2a\u63a8\u8350\u4f4d\u5206\u522b\u70b9\u51fb\u91cf","frs","click",{})})}}});