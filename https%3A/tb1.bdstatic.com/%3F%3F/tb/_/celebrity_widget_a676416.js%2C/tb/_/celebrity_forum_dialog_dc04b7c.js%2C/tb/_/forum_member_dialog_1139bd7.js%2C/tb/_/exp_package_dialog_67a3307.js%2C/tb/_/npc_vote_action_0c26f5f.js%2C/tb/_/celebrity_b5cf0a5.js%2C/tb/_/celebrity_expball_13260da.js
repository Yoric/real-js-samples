window._.Module.define({path:"encourage-celebrity/widget/celebrity_widget",sub:{initial:function(){this.tplLevel=this.parseTpl(' "<a href="<%= href %>" target="_blank" class="celebrity-level">     <span class="label">\u7b49\u7ea7: </span>     <span class="level">         <span class="level-text"><%= npc_info.cur_level %></span>     </span> </a>" ')},getLevelHtml:function(e,l){return l=null===l?"/f/like/level?kw="+e.npc_forum_name+"&ie=utf-8":l===!1?"javascript:":l,this.tplLevel($.extend({href:l},e))},parseTpl:function(e){return window.baidu.template(e.replace(/^ "|" $/g,""))}}});_.Module.define({path:"encourage-celebrity/widget/celebrity_forum_dialog",requires:["encourage-celebrity/widget/celebrity_widget"],sub:{initial:function(i){this._params=i,this._user=i.user,this.pageData=window.PageData||{},this.tbs=this.pageData.tbs,this.Dialog=$.dialog,this.widget=this.requireInstance("encourage-celebrity/widget/celebrity_widget"),this.tpl=this.widget.parseTpl(' "<div class="celebrity_forum_dialog_wrap">     <div class="dialog_content">         <div class="dialog_left">             <div class="npc_info">                 <a href="/celebrity/rankHome" target="_blank">                     <img src="https://gss0.baidu.com/7Ls0a8Sm2Q5IlBGlnYG/sys/portraitm/item/<%=npc_info.npc_avatar%>" width="140" height="140"/>                 </a>                  <div class="user_level">                     <p class="uname">                         <i class="icon-vip2-18"></i>                         <a href="/celebrity/rankHome" target="_blank"><%=npc_info.npc_name%></a>                         <i class="icon_red"></i>                     </p>                      <div class="level-wrapper"><%- levelHtml %></div>                     <div class="exp">                         <div class="exp_lable">\u7ecf\u9a8c\uff1a</div>                         <a class="exp_bar exp_bar_f" href="/f/like/level?kw=<%=encodeURIComponent(npc_info.npc_forum_name)%>&ie=utf-8" target="_blank">                             <div class="exp_bar_current exp_bar_current_f" style="width:<%=(npc_info.cur_score * 100) / (npc_info.cur_score + npc_info.score_left)%>%;"></div>                             <div class="exp_num">                                 <span class="exp_current_num"><%=npc_info.cur_score%></span>                                 <span>/<%=npc_info.cur_score + npc_info.score_left%></span>                             </div>                         </a>                     </div>                     <p>\u540d\u4eba\u699c\u6392\u540d\uff1a<span class="red_text"><%=npc_info.npc_rank%></span></p>                      <p><a href="/celebrity/rankHome" target="_blank">\u67e5\u770b\u540d\u4eba\u699c>></a></p>                 </div>             </div>             <div class="npc_sign_info">                 <div class="info_top">                     \u52a9\u653b\u8be6\u60c5                 </div>                 <div class="info_content">                     <p class="today">\u672c\u6708\u52a9\u653b\u4eba\u6570\uff1a<b><%=npc_info.total_person%></b></p>                      <div class="detail">                         <div class="col2_left">                             <p class="my-orange-text"><%=user.my_continue_days%></p>                              <p>\u6211\u8fde\u7eed\u52a9\u653b</p>                         </div>                         <div class="col2_right">                             <p class="my-orange-text"><%=user.my_total_days%></p>                              <p>\u6211\u7d2f\u79ef\u52a9\u653b</p>                         </div>                     </div>                 </div>             </div>             <div class="npc_sign">                 <a href="javascript:;" data-forumid="<%=npc_info.npc_forum_id%>" data-npcid="<%=npc_info.npc_id%>" class="sign_btn j_sign_btn <% if (user.is_signed) { %> disable <% } %>"><% if (user.is_signed) {                     %>\u4eca\u65e5\u5df2\u52a9\u653b<% } else { %>\u70b9\u6211\u52a9\u653b<% } %></a>             </div>         </div>         <div class="dialog_right">             <div class="scroll_wrapper">                 <ul>                     <% for (var i = 0, l = props.length; i < l; i++) { %>                     <li class="npc_prop_item">                         <div class="item_pic">                             <img src="<%=props[i].logo_picurl%>" width="70" height="70"/>                             <% if (props[i].is_unlock == 0) { %>                             <div class="lock" style="height: <%=100 - props[i].lock_npc_percent %>%"></div>                             <div class="lock_num">                                 <% if (props[i].lock_npc_percent == 0) { %>                                 <i class="icon_lock"></i>                                 <% } else { %>                                 <%= props[i].lock_npc_percent %>%                                 <% } %>                             </div>                             <% } %>                         </div>                         <div class="item_intro">                             <h4><%=props[i].title%></h4>                              <p class="title-sub-text">\u89e3\u9501\u6761\u4ef6\uff1a                                 <%=npc_info[\'npc_name\']%>\u8d26\u53f7\u8fbe\u5230<b><%=props[i].lock_npc_level%></b>\u7ea7</p>                              <p class="title-sub-text">\u9886\u53d6\u6761\u4ef6\uff1a                                 <% if (props[i].props_category == 300) { %>                                 \u6bcf\u5929\u53ef\u4f7f\u75281\u6b21\uff0c\u672c\u5427\u4f1a\u5458\u4f7f\u7528\u6b21\u6570\u4e0d\u9650                                 <% } else { %>                                 <% if (props[i].limit_sign_level == 0 && props[i].lock_need_vip == 0) { %>                                 \u65e0                                 <% }                                 if (props[i].limit_sign_level > 0) { %>                                 <%=npc_info[\'npc_fans_name\']%>\u8fde\u7eed\u52a9\u653b<b><%=props[i].limit_sign_level%></b>\u6b21                                 <% }                                 if ( props[i].lock_need_vip == 1 ) {                                 if (props[i].limit_sign_level > 0) {%>\uff0c<% } %>                                 <span class="red_text">\u672c\u5427\u4f1a\u5458\u4e13\u5c5e</span>                                 <% }                                 }                                 %>                             </p>                         </div>                         <div class="item_action">                             <% if (props[i].is_unlock == 0) { %>                             <button class="btn_sub btn_middle btn_disable">\u5f85\u89e3\u9501</button>                             <% } else if (props[i].can_get == 0) { %>                             <button class="btn_sub btn_middle btn_disable">\u5f85\u9886\u53d6</button>                             <% } else if (props[i].is_used == 0) { %>                             <button class="btn_default btn_middle j_btn_get" data-propsid="<%=props[i].props_id%>">&nbsp;\u9886&nbsp;&nbsp;\u53d6&nbsp;</button>                             <% } else if (props[i].props_category == 200 || props[i].props_category == 113 || props[i].props_category == 300) { %>                             <button class="btn_sub btn_middle btn_disable" data-propsid="<%=props[i].props_id%>">\u5df2\u83b7\u5f97</button>                             <% } else { %>                             <button class="btn_sub btn_middle j_btn_unuse" data-propsid="<%=props[i].props_id%>">\u53d6\u6d88\u4f7f\u7528</button>                             <% } %>                          </div>                     </li>                     <% } %>                 </ul>             </div>             <div class="privilege-wrapper">                 <p class="title-sub-text">\u5151\u6362\u672c\u5427\u4f1a\u5458\uff0c\u4eab\u53d7\u66f4\u591a\u7279\u6743</p>                  <div class="privilege-container">                     <div class="privilege-item">                         <i class="privilege-crown privilege-icon"></i>                         <br>                         <span>\u7687\u51a0\u8eab\u4efd</span>                     </div>                     <div class="privilege-item">                         <i class="privilege-red-name privilege-icon"></i>                         <br>                         <span>\u663e\u793a\u7ea2\u540d</span>                     </div>                     <div class="privilege-item">                         <i class="privilege-sign privilege-icon"></i>                         <br>                         <span>\u7b7e\u5230\u516d\u500d\u7ecf\u9a8c</span>                     </div>                     <div class="privilege-item">                         <i class="privilege-red-title privilege-icon"></i>                         <br>                         <span>\u53d1\u8d34\u7ea2\u8272\u6807\u9898</span>                     </div>                     <div class="privilege-item">                         <i class="privilege-mark privilege-icon"></i>                         <br>                         <span>\u672c\u5427\u4e13\u5c5e\u5370\u8bb0</span>                     </div>                     <div class="privilege-item">                         <i class="privilege-card-bg privilege-icon"></i>                         <br>                         <span>\u5236\u5b9a\u540d\u7247\u80cc\u666f</span>                     </div>                     <div class="privilege-item">                         <i class="privilege-top-thread privilege-icon"></i>                         <br>                         <span>\u9e23\u4eba\u81ea\u52a8\u9876\u8d34</span>                     </div>                     <div class="privilege-item">                         <i class="privilege-head-border privilege-icon"></i>                         <br>                         <span>\u5236\u5b9a\u5934\u50cf\u8fb9\u6846</span>                     </div>                 </div>             </div>         </div>     </div>     <div class="dialog_footer">         <p class="text-overflow">             <a class="btn_default btn_small j_buy_npc_member" data-fid="<%=npc_info[\'npc_forum_id\']%>" data-fname="<%=npc_info[\'npc_forum_name\']%>" href="javascript:;">\u5151\u6362\u672c\u5427\u4f1a\u5458</a>             <button class="btn-sub btn-small hide-privilege">\u6536\u8d77\u4f1a\u5458\u529f\u80fd<i class="triangle-down"></i></button>             <button class="btn-sub btn-small show-privilege">\u67e5\u770b\u4f1a\u5458\u529f\u80fd<i class="triangle-up"></i></button>             \u666e\u901a\u7b7e\u5230,\u672c\u5427\u7ecf\u9a8c<span class="my-orange-text">+1</span>,             <%=npc_info[\'npc_name\']%>\u7ecf\u9a8c<span class="my-orange-text">+0.01</span>             &nbsp;&nbsp;             <%=npc_info[\'npc_fans_name\']%>\u4f1a\u5458\u52a9\u653b,\u672c\u5427\u7ecf\u9a8c<span class="my-orange-text">+2</span>,             <%=npc_info[\'npc_name\']%>\u7ecf\u9a8c<span class="my-orange-text">+0.1</span>         </p>     </div> </div>" '),this._bindEvents()},_bindEvents:function(){var i=this._params.$root,s=this;i.on("click",function(){if(!s._user.is_login)return s.requireInstanceAsync("common/widget/LoginDialog"),void 0;var i=$(this).data("forumid")||s._params.forumId||s.pageData.forum.id,e={tbs:s.tbs};e.forum_id=i,$.post("/celebrity/submit/getForumSupport",e,function(i){i.data&&i.data.length>0&&s._showDialog(i.data[0])})})},_showDialog:function(i){i.npc_info=i.npc_info||{},i.levelHtml=this.widget.getLevelHtml(i,"/celebrity/rankHome");var s=this.tpl(i),e=i.npc_info,t="\u52a0\u5165"+e.npc_fans_name+", \u53c2\u52a0"+e.npc_forum_name+"\u517b\u6210\u8ba1\u5212";this._params.memberLastDays&&(t+='<span class="title-sub-text">\uff08\u60a8\u7684\u5355\u5427\u4f1a\u5458\u8fd8\u6709<span class="red-text">'+this._params.memberLastDays+"</span>\u5929\u5230\u671f\uff09</span>"),this._dialog=new this.Dialog({holderClassName:"celebrity_forum_dialog",html:s,width:745,height:526,title:t,draggable:!1}),this._bindDialogEvents(this._dialog)},_bindDialogEvents:function(i){var s=this,e=$(i.element),t=!1;e.find(".j_sign_btn").on("click",function(){if(!$(this).hasClass("disable")&&!t){t=!0;var i=$(this).data("npcid"),e=$(this).data("forumid"),a={tbs:s.tbs};a.forum_id=e,a.npc_id=i,$.post("/celebrity/submit/support",a,function(i){switch(i.no){case 0:s._dialog.close(),s._showDialog(i.data);break;case 340027:$.dialog.alert("\u5f88\u62b1\u6b49\uff0c\u5c01\u7981\u7528\u6237\u65e0\u6cd5\u52a9\u653b",{title:"\u63d0\u793a"});break;case 3110004:$.dialog.alert("\u4f60\u8fd8\u672a\u5173\u6ce8\u5f53\u524d\u5427\u54e6, \u5feb\u53bb\u5173\u6ce8\u5427~",{title:"\u63d0\u793a"});break;default:$.dialog.alert("\u62bd\u98ce\u4e86~",{title:"\u63d0\u793a"})}t=!1}).fail(function(){t=!1})}}),e.find(".j_buy_npc_member").on("click",function(){var i=$(this).data("fid"),e=$(this).data("fname"),t={};t.scores_money=0,t.scores_other=0;var a={callback:function(){$.tb.location.reload()}};a.is_show_features=!1,a.is_show_forum=!1,a.current_forum_id=i,a.current_forum_name=e,a.scores=s._user.Parr_scores||t,a.cnt_height=225,a.is_celebrity_forum=!0,s.requireInstance("encourage-member/widget/forum_member_dialog",a),s._dialog.close()}),e.on("click",".j_btn_get",function(){var i=$(this),e=i.data("propsid"),t={tbs:s.tbs};t.props_id=e,$.post("/celebrity/submit/getNpcProps",t,function(s){0===+s.no?200===+s.data.props_category||300===+s.data.props_category||113===+s.data.props_category?i.text("\u5df2\u83b7\u5f97").tbattr("class","btn_sub btn_middle btn_disable"):i.text("\u53d6\u6d88\u4f7f\u7528").tbattr("class","btn_sub btn_middle j_btn_unuse"):$.dialog.alert("\u62bd\u98ce\u4e86")})}),e.on("click",".j_btn_unuse",function(){var i=$(this),e=i.data("propsid"),t={tbs:s.tbs};t.props_id=e,$.post("/tbmall/post/closeProps",t,function(s){0===+s.no?i.html("&nbsp;\u9886&nbsp;&nbsp;\u53d6&nbsp;").tbattr("class","btn_default btn_middle j_btn_get"):$.dialog.alert("\u62bd\u98ce\u4e86")})});var a=e.find(".hide-privilege"),n=e.find(".show-privilege"),l=e.find(".privilege-wrapper");e.on("click",".hide-privilege",function(){a.hide(),n.show(),l.hide()}),e.on("click",".show-privilege",function(){a.show(),n.hide(),l.show()})}}});_.Module.define({path:"encourage-member/widget/forum_member_dialog",requires:["encourage-payment/widget/tbean_safe_ajax","encourage-member/widget/join_vip_dialog","encourage-payment/widget/tcharge_dialog","encourage-payment/widget/tdou_view_pay","user/widget/user_api"],sub:{opts:{},tplData:{forums:null,bdRpTime:[1,3,6,12]},tpl:{hd:'<p class="title"><i class="forum-member-dialog-title-icon"></i>#{title}</p>'},bt:window.baidu.template,pageData:window.PageData||{},Dialog:$.dialog,initial:function(e){if(!$.getPageData("user.is_login",0))return this.requireInstanceAsync("tbui/widget/LoginDialog",["","userBar"]),void 0;var t=this,i={};i.is_show_features=!0,i.is_show_forum=!0,i.current_time_order=1,i.current_option=null,i.current_time_unit=3,i.current_forum_id="",i.current_forum_name="",i.isCurForumMember=!1,i.forums=null,i.celebrity_type=-1,i.user={},this.opts=$.extend({},i,e),this.tplData.forums=this.opts.forums,this.opts.scores=this.opts.scores||this.pageData.scores,this.tdouInUser=t.opts.scores.scores_money+t.opts.scores.scores_other,this.forumMemberTitle="\u5355\u5427\u4f1a\u5458",!this.opts.isCurForumMember&&this._checkIsForumMember(),this.safeAjax=this.requireInstance("encourage-payment/widget/tbean_safe_ajax"),this.showDialog({showTitle:!1,width:710,html:t.buildInitHtml(),scrollable:!1}),t.bindEvents(),t.setDefaultContent()},setDefaultContent:function(){this._dialog.element.find(".j_pertime_unit:eq("+this.opts.current_time_order+")").click()},checkTdouEnough:function(){var e=this,t=e.getTimeValue(),i=parseInt(5e3*t,10);e.tdouInUser<i?(e._dialog.element.find(".not-enough-tbean-alert").css("display","inline-block"),e._dialog.element.find(".get-tdou-text").show(),e._dialog.element.find(".j_charge_tdou").addClass("btn-disabled")):(e._dialog.element.find(".not-enough-tbean-alert").hide(),e._dialog.element.find(".get-tdou-text").hide(),e._dialog.element.find(".j_charge_tdou").removeClass("btn-disabled"))},_checkIsForumMember:function(){var e=this.opts.current_forum_id;if(e){var t=$.getPageData("user.mParr_props.forum_member."+e);this.opts.isCurForumMember=t&&1e3*+t.end_time>+new Date}},bindEvents:function(){var e=this;this._dialog.element.on("click",".charge_tdou_agreement a",function(e){e.stopPropagation(),$.stats.track("\u5151\u6362\u5f39\u7a97\u5e95\u90e8","\u5151\u6362\u5355\u5427\u4f1a\u5458\u670d\u52a1\u534f\u8bae\u70b9\u51fb",PageData.page?PageData.page:"other","click")}),this._dialog.element.on("click",".j_charge_tdou",function(){if(!$(this).hasClass("btn-disabled")){if($.isArray(e.opts.forums)&&!e.opts.current_forum_id)return e.showForumError(),void 0;var t=e.getTimeValue();return e.util._isPositiveDigital(t)?parseInt($.trim(t),10)>120?(e._printTimeErrorInfo("\u6700\u591a\u5145\u503c120\u4e2a\u6708"),$(this).val(120),void 0):(e.initBuyMember(t),void 0):(e._printTimeErrorInfo("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u6570\u503c"),void 0)}}),this._dialog.element.on("click",".j_close_excharge",function(t){t.preventDefault(),e.closeDialog()}),this._dialog.element.on("click",".j_pertime_unit",function(t){t.preventDefault(),e.changeCurrentOpt($(this),"current_time_unit"),e._closeTipBubble(),e.changeTdouNum(),e.checkTdouEnough(),$("#customTime").val("")}),this._dialog.element.on("focus","#customTime",function(){e.changeCurrentOpt($(this).closest(".j_customTime_unit"),"current_time_unit"),e.changeTdouNum()}),this._dialog.element.on("keyup","#customTime",function(){var t=$(this).val();return $.trim(t).length>0&&!e.util._isPositiveDigital(t)?(e._printTimeErrorInfo("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u6570\u503c"),void 0):parseInt($.trim(t),10)>120?(e._printTimeErrorInfo("\u6700\u591a\u5145\u503c120\u4e2a\u6708"),$(this).val(120),e.changeTdouNum(),void 0):(e._closeTipBubble(),e.checkTdouEnough(),e.changeTdouNum(),void 0)});var t=e._dialog.element.find(".select-forum-list-container"),i=e._dialog.element.find(".select-forum-input");this._dialog.element.on("click",".select-forum-input",function(){e.hideForumError(),t.show()}),this._dialog.element.on("mouseleave",".sel_forum",function(){t.hide()}),this._dialog.element.on("click",".select-forum-list-container span",function(){e.opts.current_forum_id=$(this).data("id"),e.opts.current_forum_name=$(this).html(),e._checkIsForumMember(),i.val($(this).html()),t.hide()}),this._dialog.element.on("click",".open-super-member",function(){e.closeDialog();var t=e.requireInstance("encourage-member/widget/join_vip_dialog",[e.joinVipOptions]);t.getMemberDialog("quick_reply",1007001e3)}),this._dialog.element.on("click",".get-tdou-text",function(t){t.preventDefault(),e.closeDialog(),e.requireInstance("encourage-payment/widget/tcharge_dialog")})},initTdouNotEnough:function(e,t){var i=this,s=i.getTimeValue(),a={};a.month=s,a.baidu_charge=t,a.tdou_num=e,i.closeDialog();var o={};o.f_name=i.opts.current_forum_name,i.chargeFailFn($.extend({},a,o))},purchaseMember:function(e){var t=this,i={};i.open_id=e.open_id,i.order_id=e.order_id,i.timestamp=e.timestamp,i.scene_id=e.scene_id,i.pay_type=e.pay_type,i.from="\u5355\u5427\u4f1a\u5458\u4e2d\u5fc3",i.goods_name=e.goods_name,i.goods_image=e.goods_image||"",i.goods_price=e.goods_price,i.goods_amount=e.goods_amount,i.goods_unit="\u4e2a",i.goods_duration=e.goods_duration,i.free_vip_level=e.free_vip_level,i.tdou_num=e.tdou_num,i.chargeType="platform",t.payment=t.requireInstance("encourage-payment/widget/tdou_view_pay",function(e){"encourage_paid"===e.command&&"success"===$.getPageData("data.error","error",e)&&(t.closeDialog(),t.chargeSuccessFn(e.data||{}))}),t.payment.createMain(i)},initBuyMember:function(e){var t=this,i={from:"pc",tbs:t.pageData.tbs};i.props_id=t.opts.current_forum_id,i.forum_id=t.opts.current_forum_id,i.props_num=e,$.post("/celebrity/submit/genOrder",i,function(e){return 0===e.no?(t.opts.celebrity_type=e.data.celebrity_type,t.purchaseMember(e.data||{}),void 0):(t.closeDialog(),t.chargeFailFn(e),void 0)})},changeCurrentOpt:function(e,t){var i=this;i.opts.current_option&&i.opts.current_option.removeClass(t),i.opts.current_option=e,i.opts.current_option.addClass(t)},changeTdouNum:function(){var e=this;this._dialog.element.find(".sel_tdou .tdou_num").text(5e3*e.getTimeValue())},getTimeValue:function(){var e=$.trim($("#customTime").val());return this.opts.current_option&&this.opts.current_option.data("value")?this.opts.current_option.data("value"):0===e.length&&""===e?0:e},chargeFailFn:function(e){var t,i=this,s="auto";if(2270046===e.no)t=i.bt(' "<a class="outpage_close j_close_excharge" href="#"></a> <div class="excharge_bd excharge_enough_bd">     <p class="main_intro">\u60a8\u5df2\u5f00\u901a25\u4e2a\u5427\u7684\u7279\u6743\u5305\uff0c\u8fbe\u5230\u7279\u6743\u5305\u6570\u91cf\u4e0a\u9650</p>     <p class="sub_intro">\u7acb\u5373\u5f00\u901a\u8d34\u5427\u4f1a\u5458\uff0c\u5c3d\u4eab\u8d34\u5427\u7279\u6743\u65e0\u4e0a\u9650</p>     <a class="j_charge_confirm charge_tdou btn_default btn_small" href="#">\u5f00\u901a\u8d85\u7ea7\u4f1a\u5458</a> </div>" '.replace(/^ "|" $/g,"")),s=216;else if(2270074===e.no)t=i.bt(' "<a class="outpage_close j_close_excharge" href="#"></a> <div class="excharge_bd excharge_enough_bd">     <p class="main_intro"><%= mainContent %></p>     <p class="sub_intro"><%= subContent %></p> </div>" '.replace(/^ "|" $/g,""),{mainContent:"\u8d2d\u4e70\u5931\u8d25",subContent:"\u7528\u6237\u6700\u591a\u4e00\u6b21\u53ea\u80fd\u8d2d\u4e70120\u4e2a\u6708"}),s=216;else if(170003===e.no)t=i.bt(' "<a class="outpage_close j_close_excharge" href="#"></a> <div class="excharge_bd excharge_enough_bd">     <p class="main_intro"><%= mainContent %></p>     <p class="sub_intro"><%= subContent %></p> </div>" '.replace(/^ "|" $/g,""),{mainContent:"\u8d2d\u4e70\u5931\u8d25",subContent:"\u60a8\u8fd8\u672a\u5173\u6ce8\u8be5\u5427"}),s=216;else{if(1990018===e.no){var a=$.dialog.confirm("T\u8c46\u4e0d\u8db3\uff0c\u8bf7\u5151\u6362T\u8c46");return a.bind("onaccept",function(){i.requireInstance("encourage-payment/widget/tcharge_dialog"),i.dialog.close()}),void 0}t=i.bt(' "<a class="outpage_close j_close_excharge" href="#"></a> <div class="excharge_bd excharge_enough_bd">     <p class="main_intro"><%= mainContent %></p>     <p class="sub_intro"><%= subContent %></p> </div>" '.replace(/^ "|" $/g,""),{mainContent:"\u8d2d\u4e70\u5931\u8d25",subContent:"\u5f88\u9057\u61be\uff0c\u8d2d\u4e70\u5931\u8d25\u4e86..."}),s=216}i.showDialog({width:537,height:s,showTitle:!1,html:t}),$(".j_close_excharge, .j_excharge_confirm").on("click",function(e){e.preventDefault(),i.closeDialog()})},chargeSuccessFn:function(e){var t=this,i="",s="auto";0===+e.no&&(t.opts.scores=$.extend(t.opts.scores,e.data.left_scores),t.tdouInUser=t.opts.scores.scores_money+t.opts.scores.scores_other,i=t.buildSuccessHtml(e.data)),t.showDialog({width:708,height:s,showTitle:!1,html:i}),$(".j_close_excharge, .j_excharge_confirm").on("click",function(e){e.preventDefault(),t.closeDialog(),$.tb.location.reload()}),this._dialog.element.on("click",".get-exp-gift",function(){var e={};e.is_show_features=!1,e.is_show_forum=!1,e.current_forum_id=t.opts.current_forum_id,e.current_forum_name=t.opts.current_forum_name,e.scores=t.opts.scores,e.cnt_height=225,e.celebrity_type=t.opts.celebrity_type,e.isCurForumMember=t.opts.isCurForumMember,e.user=t.opts.user,t.requireInstanceAsync("encourage-member/widget/exp_package_dialog",e)})},getUserName:function(){var e=this.requireInstance("user/widget/user_api",[]),t="",i=this.pageData.user,s=$.getPageData("forum.id")||this.opts.current_forum_id;return t=e.checkSuperMemberShipOf(i)?'<i class="icon-vip2-16"></i> <a class="vip-red">'+$.getPageData("user.name")+"</a>":e.checkSingleForumMembershipOf(i,s)?'<i class="icon-vip3-16"></i> <a class="vip-red">'+$.getPageData("user.name")+"</a>":$.getPageData("user.name")},buildInitHtml:function(){var e=this,t="";t=e.opts.is_show_forum?"\u5151\u6362"+e.forumMemberTitle:"\u5151\u6362["+e.opts.current_forum_name+"\u5427]"+e.forumMemberTitle;var i=this.getUserName(),s={};return s.title=t,s.tdou_num=5e3*e.opts.current_time_unit,s.bdRpTime=e.tplData.bdRpTime,s.p_style=e.opts.is_celebrity_forum?'style="visibility: hidden;"':"",s.tip=e.opts.is_celebrity_forum?"\u8d85\u7ea7\u4f1a\u5458\u514d\u8d39\u62e5\u6709":"\u8d85\u7ea7\u4f1a\u5458\u514d\u8d39\u4f7f\u7528\u7279\u6743",s.tdouInUser=this.tdouInUser,s.username=i,s.forums=e.opts.forums,e.bt(' "<a class="outpage_close j_close_excharge" href="#"></a> <div class="excharge_hd">     <p class="title">         <i class="forum-member-dialog-title-icon"></i><%- title %>         <span class="user-info">             <span class="user-name">\u5e10\u53f7\uff1a<%- username %></span>             <span class="tdou-in-user">T\u8c46\u4f59\u989d\uff1a<span class="tdou-in-user-num"><%= tdouInUser %></span></span>         </span>     </p> </div> <div class="excharge_bd">     <div class="sel_member">         <span class="sel_label">\u9009\u62e9\u4f1a\u5458:</span>          <div class="single-forum-member">             <i class="single-forum-icon"></i>              <p class="member-label-title">\u5355\u5427\u4f1a\u5458</p>              <p>                 <span class="member-label-orange">5000</span>                 <span class="member-label-text">T\u8c46/\u6708</span>             </p>             <span class="decorate_icon"></span>         </div>         <span class="member-label-text">\u60f3\u76f4\u63a5\u5347\u7ea7\u4e3a800\u4e07\u4e2a\u5427\u7684\u5355\u5427\u4f1a\u5458\uff1f</span>         <span class="open-super-member">\u5f00\u901a\u8d85\u7ea7\u4f1a\u5458</span>     </div>     <% if($.isArray(forums)) { %>     <div class="sel_forum">         <span class="sel_label">\u9009\u62e9\u5427:</span>         <input class="select-forum-input" aria-readonly="true" readonly placeholder="\u9009\u62e9\u9700\u8981\u5f00\u901a\u4f1a\u5458\u7684\u5427"/>         <% if(!forums.length) { %>         <span style="line-height: 37px; color: #e64545;">* \u81f3\u5c11\u5173\u6ce8\u4e00\u4e2a\u5427\u624d\u80fd\u5f00\u901a\u5355\u5427\u4f1a\u5458\u54e6</span>         <% } %>         <div class="select-forum-list-container">             <div class="select-forum-list">                 <% for(var i = 0; i < forums.length; i++) { %>                 <span data-id="<%= forums[i].forum_id %>"><%= forums[i].forum_name %></span>                 <% } %>             </div>         </div>     </div>     <% } %>     <div class="sel_time">         <span class="sel_label">\u9009\u62e9\u65f6\u957f:</span>         <span class="sel_cnt">             <%for(var i = 0; i< bdRpTime.length; i++){%>             <a class="j_pertime_unit per_time_unit" data-value="<%=bdRpTime[i]%>">                 <strong><%=bdRpTime[i]%></strong>\u4e2a\u6708                 <span class="decorate_icon"></span>             </a>             <%}%>             <a class="j_customTime_unit per_time_unit custom_time">                 <input id="customTime" type="text" value="" placeholder="\u5176\u4ed6"/><span>\u4e2a\u6708</span>                 <span class="decorate_icon"></span>             </a>         </span>     </div>     <p class="long_time_warning" <%= p_style %>>\u7279\u6743\u5305\u65f6\u957f(\u7d2f\u8ba1\u8d85\u7ea7\u4f1a\u5458)\u6700\u591a\u8fde\u7eed24\u4e2a\u6708\uff0c\u8d85\u51fa\u90e8\u5206\u53ea\u8d60\u9001\u7ecf\u9a8c\u548c\u9053\u5177\u3002</p>     <div class="sel_tdou">         <span class="sel_label">\u8fd8\u9700\u652f\u4ed8:</span>         <span class="tdou_num"><%= tdou_num %></span>          <div class="not-enough-tbean-alert">             \u60a8\u7684T\u8c46\u4f59\u989d\u4e0d\u8db3\uff0c\u8bf7\u5148\u83b7\u53d6T\u8c46         </div>     </div>     <a class="j_charge_tdou btn-encourage btn-larger charge_tdou" onclick="return false;" href="#">\u7acb\u5373\u5151\u6362</a>     <span class="get-tdou-text">\u83b7\u53d6T\u8c46</span> </div> <div class="charge_tdou_agreement">   \u8bf7\u52a1\u5fc5\u5ba1\u9605\u5e76\u63a5\u53d7   <a href="https://tieba.baidu.com/tb/vip_eula.html" target="baidu_tb_member_agreement">\u300a\u8d34\u5427\u4f1a\u5458\u670d\u52a1\u534f\u8bae\u300b</a>   \u6240\u6709\u6761\u6b3e\uff0c\u5426\u5219\u60a8\u65e0\u6743\u4f7f\u7528\u672c\u670d\u52a1\u3002 </div> " '.replace(/^ "|" $/g,""),s)},buildSuccessHtml:function(e){var t=this,i={celebrityType:t.opts.celebrity_type,isCurForumMember:t.opts.isCurForumMember,forumName:t.opts.current_forum_name,endTime:t.util._getDate(e.member_end_time),userName:t.getUserName(),tdouInUser:t.tdouInUser};return t.bt(' "<div class="forum-member-success-dialog">     <div class="header">         <span class="pull-left">             <i class="icon-ori"></i>             <span class="exchange">\u5151\u6362[<%= forumName %>\u5427]\u5355\u5427\u4f1a\u5458</span>         </span>         <span class="pull-right">             <span class="user-name">\u5e10\u53f7: <%- userName %></span>             <span class="tbean-scores">                 T\u8c46\u4f59\u989d: <i class="icon icon-tbean"></i> <%- tdouInUser %>             </span>         </span>         <a class="outpage_close j_close_excharge" href="javascript:"></a>     </div>     <div class="body">         <div class="title">             <%= isCurForumMember             ? (\'\u60a8\u7684[\' + forumName + \'\u5427]\u4f1a\u5458\u7eed\u8d39\u6210\u529f\')             : (\'\u606d\u559c\u60a8\u6210\u4e3a[\' + forumName + \'\u5427]\u4f1a\u5458\')             %>         </div>         <ul class="pr-list">             <li>                 <i class="icon-pr pr-crown"></i>                 <span>\u7687\u51a0\u8eab\u4efd</span>             </li>             <li>                 <i class="icon-pr pr-red-name"></i>                 <span>\u663e\u793a\u7ea2\u540d</span>             </li>             <li>                 <i class="icon-pr pr-sign"></i>                 <span>\u7b7e\u52306\u500d\u7ecf\u9a8c</span>             </li>             <li>                 <i class="icon-pr pr-red-title"></i>                 <span>\u7ea2\u8272\u6807\u9898</span>             </li>             <% if (celebrityType === 1) { %>             <li>                 <i class="icon-pr pr-mark"></i>                 <span>\u672c\u5427\u4e13\u5c5e\u5370\u8bb0</span>             </li>             <li>                 <i class="icon-pr pr-card-bg"></i>                 <span>\u5b9a\u5236\u540d\u7247\u80cc\u666f</span>             </li>             <li>                 <i class="icon-pr pr-top-thread"></i>                 <span>\u540d\u4eba\u9876\u8d34</span>             </li>             <li>                 <i class="icon-pr pr-head-border"></i>                 <span>\u5b9a\u5236\u5934\u50cf\u8fb9\u6846</span>             </li>             <% } %>         </ul>         <div class="pr-tip<%= celebrityType === 0 ? \'\' : \' hidden\' %>">             <div class="tips">\u5427\u4e3b<a href="/celebrity/rankHome">\u7533\u8bf7\u540d\u4eba\u5802</a>\u540e, \u624d\u80fd\u89e3\u9501\u4ee5\u4e0b\u7279\u6743:</div>             <ul class="pr-tip-list">                 <li>                     <i class="icon-pr-sm pr-mark"></i>                     <span>\u672c\u5427\u4e13\u5c5e\u5370\u8bb0</span>                 </li>                 <li>                     <i class="icon-pr-sm pr-card-bg"></i>                     <span>\u5b9a\u5236\u540d\u7247\u80cc\u666f</span>                 </li>                 <li>                     <i class="icon-pr-sm pr-top-thread"></i>                     <span>\u540d\u4eba\u9876\u8d34</span>                 </li>                 <li>                     <i class="icon-pr-sm pr-head-border"></i>                     <span>\u5b9a\u5236\u5934\u50cf\u8fb9\u6846</span>                 </li>             </ul>         </div>         <div class="gift-title"><span>\u83b7\u5f97\u793c\u7269</span></div>         <ul class="gift-list">             <li>                 <i class="gift-icon gift-resign"></i>                 <span>\u8865\u7b7e\u5361x1</span>             </li>             <li>                 <i class="gift-icon gift-exp-privilege"></i>                 <span>\u672c\u5427\u7ecf\u9a8c\u4e66\u8d2d\u4e70\u6743</span>             </li>         </ul>     </div>     <div class="svpg-footer">         <button class="btn-sub btn-middle j_close_excharge">\u786e\u5b9a</button>         <button class="btn-encourage btn-middle get-exp-gift">\u8d2d\u4e70\u7ecf\u9a8c\u4e66</button>     </div> </div> " '.replace(/^ "|" $/g,""),i)},showErrorForum:function(){},hideErrorForum:function(){},checkHasForum:function(e,t){var i=this,s={};s.forum_name=encodeURIComponent(e),s.tbs=i.pageData.tbs,$.post("../get/checkForum",s).done(function(e){0===e.no&&(0===e.data.forum_id&&null===e.data.forum_name?i.showErrorForum("hasNot"):(i.hideErrorForum(),$.isFunction(t)&&t(e)))})},showDialog:function(e){this._dialog=new this.Dialog(e)},closeDialog:function(){this._dialog&&this._dialog.close()},showForumError:function(e){var t=this,i=t._dialog.element.find(".sel_forum"),s={content:e||"\u8bf7\u9009\u62e9\u8981\u8d2d\u4e70\u7684\u5427",attr:"",wrap:i,closeBtn:!0};s.bubble_css={top:54,left:100,zIndex:9999},s.arrow_pos={left:10},t._dialog.forumErrorBubble=t._dialog.forumErrorBubble||new window.UiBubbleTipBase(s),t._dialog.forumErrorBubble.showBubble()},hideForumError:function(){this._dialog.forumErrorBubble&&this._dialog.forumErrorBubble.hideBubble()},_buildTipBubble:function(e){var t=this,i={content:e,attr:"",wrap:$(".sel_time"),closeBtn:!0};i.arrow_dir="up",i.bubble_css={top:54,right:45,width:133,zIndex:9999},i.arrow_pos={left:10},this.opts.tip_bubble=new window.UiBubbleTipBase(i);var s=this.opts.tip_bubble;s.showBubble(),s.bind("onclose",function(){t._closeTipBubble()})},_closeTipBubble:function(){this.opts.tip_bubble&&this.opts.tip_bubble.hideBubble()},_showTipBubble:function(){this.opts.tip_bubble&&this.opts.tip_bubble.showBubble()},_printTimeErrorInfo:function(e){this.opts.tip_bubble?this._showTipBubble():this._buildTipBubble(e)},util:{_isEmpty:function(e){return 0===$.trim(e).length},_isPositiveDigital:function(e){return/^[1-9]+[0-9]*]*$/.test(e)},_getDate:function(e){var t=new Date(1e3*e),i=t.getFullYear(),s=t.getMonth()+1,a=t.getDate();return i+"\u5e74"+s+"\u6708"+a+"\u65e5"}}}});_.Module.define({path:"encourage-member/widget/exp_package_dialog",requires:["encourage-payment/widget/tbean_safe_ajax","user/widget/user_api","encourage-payment/widget/tdou_view_pay","encourage-payment/widget/tcharge_dialog","encourage-member/widget/forum_member_dialog"],sub:{opts:{},initial:function(e){var t=this,a={is_show_features:!0,is_show_forum:!0,current_time_order:1,current_option:null,current_time_unit:3,current_forum_id:"",current_forum_name:"",user:{},isCurForumMember:!1};this.opts=$.extend({},a,e),this.opts.scores=this.opts.scores||PageData.scores,this.tdouInUser=t.opts.scores.scores_money+t.opts.scores.scores_other,this.FORUM_MEMBER_TITLE=this.opts.is_celebrity_forum?"\u5355\u5427\u4f1a\u5458":"\u5427\u7279\u6743\u5305",this.safeAjax=this.requireInstance("encourage-payment/widget/tbean_safe_ajax"),this.showDialog(),this.bindEvents()},getUserName:function(){var e=this.requireInstance("user/widget/user_api",[]),t="",a=this.opts.user,n=this.opts.current_forum_id;return t=e.checkSuperMemberShipOf(a)?'<i class="icon-vip2-16"></i><a class="vip-red">'+$.getPageData("user.name")+"</a>":e.checkSingleForumMembershipOf(a,n)?'<i class="icon-vip3-16"></i><a class="vip-red">'+$.getPageData("user.name")+"</a>":$.getPageData("user.name")},showDialog:function(){var e=this,t=this.getUserName(),a=_.template('<div class="exp-pageckage-dialog">     <a class="outpage-close j-close-excharge" href="#"></a>     <p class="title">         <i class="forum-member-dialog-title-icon"></i>\u5151\u6362[<%= forumName %>\u5427]\u7ecf\u9a8c\u4e66         <span class="user-info">             <span class="user-name">\u5e10\u53f7\uff1a<%= username %></span>             <span class="tdou-in-user">T\u8c46\u4f59\u989d\uff1a<span class="tdou-in-user-num"><%= tdouInUser %></span></span>         </span>     </p>     <div class="exp-package-dialog-body">         <div class="exp-package-intro">             <i class="icon-exp-package-logo"></i>             <p>                 <i class="icon-tbean"></i>                 <span class="exp-orange-text">5000</span>/\u4e2a             </p>             <p>\uff08\u6bcf\u4e2a\u7ecf\u9a8c\u4e66<span class="exp-orange-text">+50</span>\uff0c\u8d2d\u4e70\u7acb\u5373\u751f\u6548\uff09</p>         </div>         <div class="exp-package-parchase-container">             <p class="input-container">                 <label>\u9009\u62e9\u65f6\u957f\uff1a</label>                 <span class="controller-input-container">                     <button class="cut-btn">-</button>                     <input class="exp-num-input" type="text" value="3"/>                     <button class="add-btn">+</button>                 </span>             </p>             <p class="input-container">                 <label>\u8fd8\u9700\u652f\u4ed8\uff1a</label>                 <i class="icon-tbean"></i>                 <span class="exp-orange-text exp-tbean-num">15000</span>             </p>             <%             if (!isCurForumMember) {             %>             <p class="open-member-text">\u5f00\u901a                 <i class="icon-vip3-16"></i>                 <span class="orange-text j-open-single-member">\u672c\u5427\u4f1a\u5458</span>                 \u4e4b\u540e\u624d\u80fd\u5151\u6362\u7ecf\u9a8c\u4e66             </p>             <button class="btn-middle btn-encourage single-member-btn j-open-single-member">\u5f00\u901a\u5355\u5427\u4f1a\u5458</button>             <% } else { %>             <button class="btn-middle btn-encourage exp-btn">\u7acb\u5373\u5151\u6362</button>             <% } %>         </div>     </div> </div>')({tdou_num:5e3*e.opts.current_time_unit,p_style:e.opts.is_celebrity_forum?'style="visibility: hidden;"':"",tip:e.opts.is_celebrity_forum?"\u8d85\u7ea7\u4f1a\u5458\u514d\u8d39\u62e5\u6709":"\u8d85\u7ea7\u4f1a\u5458\u514d\u8d39\u4f7f\u7528\u7279\u6743",tdouInUser:this.tdouInUser,forumName:$.getPageData("forum.name"),username:t,isCurForumMember:e.opts.isCurForumMember});this.dialog=new $.dialog({showTitle:!1,width:700,html:a})},_changeExpInputValue:function(e){e=e||0;var t=this.getExpInputValue();t+=e,t=0>t?0:t,this.$expInput.val(t)},getExpInputValue:function(){var e=parseInt(this.$expInput.val(),10)||0;return e},_updateView:function(e){this.dialog.element.find(".exp-tbean-num").html(e)},purchaseExp:function(e){var t=this,a={open_id:e.open_id,order_id:e.order_id,timestamp:e.timestamp,scene_id:e.scene_id,pay_type:e.pay_type,from:"\u5355\u5427\u4f1a\u5458\u7ecf\u9a8c\u4e66",goods_name:e.goods_name,goods_image:e.goods_image||"",goods_price:e.goods_price,goods_amount:e.goods_amount,goods_unit:"\u4e2a",goods_duration:e.goods_duration,free_vip_level:e.free_vip_level,tdou_num:e.tdou_num};$.extend(a,{chargeType:"platform"}),t.payment=t.requireInstance("encourage-payment/widget/tdou_view_pay",function(e){"encourage_paid"==e.command&&"success"==$.getPageData("data.error","error",e)&&$.tb.location.reload()}),t.payment.createMain(a)},bindEvents:function(){var e=this;this.$expInput=this.dialog.element.find(".exp-num-input"),this.dialog.element.on("click",".add-btn",function(){e._changeExpInputValue(1);var t=e.getExpInputValue();e._updateView(5e3*t)}),this.dialog.element.on("click",".cut-btn",function(){e._changeExpInputValue(-1);var t=e.getExpInputValue();e._updateView(5e3*t)}),this.dialog.element.on("click",".exp-btn",function(){var t=e.getExpInputValue();if(t>200)return $.dialog.alert("\u6700\u591a\u53ea\u80fd\u8d2d\u4e70200\u4e2a\u7ecf\u9a8c\u4e66"),void 0;var a={from:"pc",tbs:PageData.tbs};a.props_id=2000163,a.forum_id=$.getPageData("forum.id"),a.props_num=e.getExpInputValue(),$.post("/celebrity/submit/genOrder",a,function(t){if(1990043===t.no)$.dialog.alert("\u60a8\u4e0d\u662f\u6b64\u5427\u7684\u4f1a\u5458");else if(170003===t.no)$.dialog.alert("\u60a8\u8fd8\u672a\u5173\u6ce8\u6b64\u5427");else if(1990018===t.no){var a=$.dialog.confirm("T\u8c46\u4e0d\u8db3\uff0c\u8bf7\u5151\u6362T\u8c46");a.bind("onaccept",function(){e.requireInstance("encourage-payment/widget/tcharge_dialog"),e.dialog.close()})}else 0===t.no&&e.purchaseExp(t.data)})}),this.dialog.element.on("click",".j-open-single-member",function(){e.dialog.close();var t=PageData.forum;e.requireInstance("encourage-member/widget/forum_member_dialog",{is_show_features:!1,is_show_forum:!1,current_forum_id:t.id,current_forum_name:t.name,scores:e.opts.scores,cnt_height:225,isCurForumMember:e.opts.isCurForumMember,callback:function(){$.tb.location.reload()}})}),this.dialog.element.on("click",".j-close-excharge",function(){e.dialog.close()}),this.$expInput.keyup(function(){e._changeExpInputValue(0);var t=e.getExpInputValue();e._updateView(5e3*t)})}}});_.Module.define({path:"encourage-celebrity/widget/npc_vote_action",sub:{initial:function(e){this._opt=e,this._bindEvents()},_bindEvents:function(){var e=this,t=this._opt.$root;t.on("click",".j-btn-vote",function(){if(!PageData.user.is_login)return e.requireInstanceAsync("common/widget/LoginDialog"),void 0;var a=$(this).data("id"),n=$(this).data("forumname");$.post("/celebrity/submit/voteNpc",{tbs:PageData.tbs,id:a},function(a){switch(a.no){case 0:t.find(".j_vote_npc_"+a.data.id).find(".j_vote_num").text(a.data.vote_num),e._success();break;case 952710:e._attention(n);break;case 11e4:e.requireInstanceAsync("common/widget/LoginDialog");break;case 952711:e._alert({msg:"\u5427\u7b49\u7ea7\u8fbe\u5230"+(~~a.data+1)+"\u7ea7\u624d\u80fd\u652f\u6301\u672c\u5427\u54e6"});break;case 952712:e._alert({msg:"\u60a8\u7533\u8bf7\u7684\u540d\u4eba\u5df2\u522b\u7533\u8bf7\u8fc7\u4e86~"});break;case 952713:e._alert({msg:"\u672c\u671f\u6295\u7968\u7ed3\u675f\uff0c\u4e0b\u4e00\u671f\u5373\u5c06\u542f\u52a8\uff0c\u656c\u8bf7\u671f\u5f85"});break;case 952709:e._alert({msg:"\u5f53\u524d\u7528\u6237\u4e0d\u662f\u5427\u4e3b"});break;case 65534:e._alert({msg:"\u6bcf\u5929\u53ea\u80fd\u7ed93\u4e2a\u5427\u6295\u7968 \u0ca5_\u0ca5"});break;case 65533:e._alert({msg:"\u6bcf\u5929\u53ea\u80fd\u7ed9\u4e00\u4e2a\u5427\u62951\u7968\uff0c\u8bf7\u660e\u5929\u7ee7\u7eed\u652f\u6301"});break;case 65532:e._alert({msg:"IP\u4e00\u5929\u8d85\u8fc7500"});break;default:$.dialog.alert(a.error,{title:"\u63d0\u793a"})}})})},_success:function(){var e='<div class="npc-vote-dialog"><p>\u6295\u7968\u6210\u529f</p><div class="btn-group"><a href="/celebrity/rankHome#npc_vote" class="btn-default btn-small mr10 j-see-rank">\u67e5\u770b\u699c\u5355</a> <a href="javascript:;" class="btn-sub btn-small j_close">\u53d6 \u6d88</a></div></div>',t=this._alert({html:e});$(t.element).find(".j-see-rank").on("click",function(){t.close()})},_alert:function(e){var t=e.html||'<div class="npc-vote-dialog"><p>'+e.msg+'</p><div class="btn-group">  <a href="#" class="btn-default btn-small j_close">\u786e \u8ba4</a></div></div>',a=new $.dialog({width:380,html:t,title:"\u63d0\u793a",draggable:!1});return $(a.element).find(".j_close").on("click",function(){return a.close(),!1}),a},_attention:function(e){var t='<div class="npc-vote-dialog"><p>\u672a\u5173\u6ce8\u672c\u5427\u4e0d\u80fd\u6295\u7968\u54e6~</p><div class="btn-group"> <a href="/f?kw='+encodeURIComponent(e)+'" class="btn-default btn-small">\u53bb\u5173\u6ce8</a></div></div>';new $.dialog({width:350,html:t,title:"\u63d0\u793a",draggable:!1})}}});_.Module.define({path:"encourage-celebrity/widget/celebrity",requires:["encourage-payment/widget/tdou_view_pay","encourage-member/widget/forum_member_dialog","encourage-celebrity/widget/npc_vote_action","encourage-member/widget/exp_package_dialog","encourage-celebrity/widget/celebrity_forum_dialog"],sub:{initial:function(e){this.$root=$(".celebrity"),this.pageData=window.PageData,this.forum=this.pageData.forum,this.user=e.user,this.opt=e,this.isCelebrityForum=e.isCelebrityForum||!1,this.isCurForumMember=e.isCurForumMember||!1,this._bindEvents()},purchaseExp:function(e){var r=this,o=$.extend({from:"\u5355\u5427\u4f1a\u5458\u7ecf\u9a8c\u4e66",chargeType:"platform"},e);o.goods_unit="\u4e2a",r.payment=r.requireInstance("encourage-payment/widget/tdou_view_pay"),r.payment.createMain(o)},_bindEvents:function(){var e=this;this.$root.find(".j-gift-buy").on("click",function(){var r={};r.scores_money=0,r.scores_other=0;var o={};o.is_show_features=!1,o.is_show_forum=!1,o.current_forum_id=e.forum.id,o.current_forum_name=e.forum.name,o.scores=e.user.Parr_scores||r,o.cnt_height=225,o.is_celebrity_forum=e.isCelebrityForum,o.isCurForumMember=e.isCurForumMember,o.user=e.user,o.callback=function(){$.tb.location.reload()},e.requireInstance("encourage-member/widget/forum_member_dialog",o)}),this.$root.on("click",".open-btn",function(){e.$root.find(".first-show-container").hide(),e.$root.find(".second-show-container").show()}),this.$root.on("click",".close-btn",function(){e.$root.find(".first-show-container").show(),e.$root.find(".second-show-container").hide()}),this.requireInstance("encourage-celebrity/widget/npc_vote_action",{$root:e.$root}),this.$root.on("click",".celebrity-purchase-exp",function(){if(!$.getPageData("user.is_login",0))return e.requireInstanceAsync("tbui/widget/LoginDialog",["","userBar"]),void 0;var r={};r.scores_money=0,r.scores_other=0;var o={};o.is_show_features=!1,o.is_show_forum=!1,o.current_forum_id=e.forum.id,o.current_forum_name=e.forum.name,o.scores=e.user.Parr_scores||r,o.cnt_height=225,o.is_celebrity_forum=e.isCelebrityForum,o.isCurForumMember=e.isCurForumMember,o.user=e.user,e.requireInstance("encourage-member/widget/exp_package_dialog",[o])}),this.requireInstance("encourage-celebrity/widget/celebrity_forum_dialog",{$root:e.$root.find(".j-btn-celebrity"),celebrity:e.opt.celebrity,user:e.user,memberLastDays:e.opt.memberLastDays})}}});_.Module.define({requires:["encourage-celebrity/widget/celebrity_widget","encourage-props/widget/buy_controller","encourage-payment/widget/tdou_view_pay","encourage-member/widget/forum_member_dialog","encourage-payment/widget/pay_member","tbui/widget/login_dialog"],path:"encourage-celebrity/widget/celebrity_expball",sub:{resources:{expballPropsCategoryId:119,expballScore:200,expballPropsId:1190001,buyprops:"/tbmall/post/buyprops",voteNpc:"/celebrity/submit/voteNpc",ApiGenOrder:"/celebrity/submit/genOrder"},initial:function(e){e=e||{},this.pageData=e.pageData||{},this.parrProps=this.pageData.Parr_props||{},this.parrScores=this.pageData.Parr_scores||this.getEmptyScores(),this.pageData.scores=this.parrScores,this.tbs=window.PageData.tbs,this.forum=this.pageData.forum||{},this.user=this.pageData.user||{},this.widget=this.requireInstance("encourage-celebrity/widget/celebrity_widget"),this.tplMain=this.widget.parseTpl(' "<div class="celebrity-expball">      <div class="celebrity-expball-top">          <div class="celebrity-expball-top-left"></div>          <div class="celebrity-expball-top-right">              <h3>\u53cc\u500d\u7403\u53ef\u4ee5\u5e2e\u4f60\u7ffb\u500d\u6295\u7968\u7ecf\u9a8c\uff01</h3>              <button class="celebrity-expball-buy-btn btn-encourage btn-large" j-celebrity-expball-buy-btn>\u53bb\u4e70\u9053\u5177</button>          </div>        </div>      <div class="celebrity-expball-bottom">          <p>\u66f4\u591a\u7ffb\u500d\u7968\u6570\u7279\u6743</p>            <p>              \u672c\u5427\u4f1a\u5458\uff1a\u6295\u7968\u4e00\u6b21\uff0c\u7968\u6570+2;              <a href="javascript:" j-celebrity-expball-local-vip>\u5f00\u901a>> </a>          </p>      </div>  </div>" '),this.tplConfirm=this.widget.parseTpl(' "<div class="celebrity-expball">      <div class="celebrity-expball-vote">          <h3>\u53cc\u500d\u7403\u53ef\u4ee5\u5e2e\u4f60\u7ffb\u500d\u7968\u6570\u54e6!</h3>            <div class="celebrity-expball-vote-confirm-btn-wrapper">              <button class="btn-default celebrity-expball-vote-confirm-btn btn-middle" j-celebrity-expball-vote-use-btn>\u4f7f\u7528\u9053\u5177(\u8fd8\u5269<%=left_num %>\u4e2a)</button>              <button class="btn-sub celebrity-expball-vote-confirm-btn btn-middle" j-celebrity-expball-vote-no-use-btn>\u76f4\u63a5\u6295\u7968</button>          </div>      </div>  </div>" '),this.tplVote=this.widget.parseTpl(' "<div class="celebrity-expball">      <div class="celebrity-expball-top">          <div class="celebrity-expball-vote">              <h3><i class="celebrity-expball-vote-icon"></i>\u6295\u7968\u6210\u529f\uff0c<span class="orange-text">\u540d\u4eba\u7968\u6570+<%=add_vote_num %></span></h3>              <% if (left_vote_times != -1) { %>              <p class="celebrity-expball-vote-tip">\u4eca\u65e5\u8fd8\u5269<a><%=left_vote_times %></a>\u6b21\u6295\u7968\u673a\u4f1a</p>              <% } %>          </div>        </div>      <div class="celebrity-expball-bottom">          <p>\u7ffb\u500d\u7968\u6570\u7279\u6743</p>          <ul class="celebrity-expball-bottom-list">              <li>                  <span>\u53cc\u500d\u7403</span><span class="celebrity-expball-bottom-list-right">\u6295\u7968\u4e00\u6b21\uff0c\u7968\u6570*2 <a href="javascript:;" j-celebrity-expball-buy-btn>\u53bb\u8d2d\u4e70>> </a></span>              </li>              <li>                  <span>\u672c\u5427\u4f1a\u5458</span><span class="celebrity-expball-bottom-list-right">\u6295\u7968\u4e00\u6b21\uff0c\u7968\u6570+2 <a href="javascript:;" j-celebrity-expball-local-vip>\u5f00\u901a>> </a></span>              </li>          </ul>      </div>  </div>" '),this.bindEvent()},bindEvent:function(){var e=$(".celebrity"),t=this;e.on("click","[j-celebrity-vote-btn]",function(){var e=$(this);if(t.checkLogin()){var a=e.tbattr("data-id");t.hasExpBall(t.parrProps)?(t.showVoteConfirmDialog(),t.dialog.element.on("click","[j-celebrity-expball-vote-use-btn]",function(){t.vote(a,1)}).on("click","[j-celebrity-expball-vote-no-use-btn]",function(){t.vote(a,0)})):t.vote(a,0)}}).on("click","[j-celebrity-expball-show]",function(){t.tbmallBuy(this)})},hasExpBall:function(e){return+$.getPageData("119.1190001.left_num",0,e)||0},setCallback:function(e,t){this.callback=e,this.context=t},vote:function(e,t){var a=this,r={id:e,tbs:a.tbs};r.use_num=t,$.post(this.resources.voteNpc,r,function(e){if(e)switch(e.no){case 0:t>0&&a.hasExpBall(a.parrProps)&&(a.parrProps["119"]["1190001"].left_num-=t),a.showVoteSuccessDialog(e.data),a.callback&&(a.context?a.callback.call(a.context,e.data):a.callback(e.data));break;case 952710:a.showAlert("\u60a8\u672a\u5173\u6ce8\u672c\u5427");break;case 11e4:a.requireInstanceAsync("common/widget/LoginDialog");break;case 952711:a.showAlert("\u5427\u7b49\u7ea7\u8fbe\u5230"+(e.data+1)+"\u7ea7\u624d\u80fd\u652f\u6301\u672c\u5427\u54e6");break;case 952712:a.showAlert("\u60a8\u7533\u8bf7\u7684\u540d\u4eba\u5df2\u522b\u7533\u8bf7\u8fc7\u4e86~");break;case 952713:a.showAlert("\u672c\u671f\u6295\u7968\u7ed3\u675f\uff0c\u4e0b\u4e00\u671f\u5c06\u5728\u4e0b\u4e2a\u67081\u53f7\u65e9\u4e0a8\u70b9\u542f\u52a8\uff0c\u656c\u8bf7\u671f\u5f85");break;case 952724:a.showAlert("\u672c\u671f\u6295\u7968\u7ed3\u675f, \u4e0b\u671f\u6295\u7968\u5c06\u5728\u65e9\u4e0a8\u70b9\u542f\u52a8, \u656c\u8bf7\u671f\u5f85");break;case 952709:a.showAlert("\u5f53\u524d\u7528\u6237\u4e0d\u662f\u5427\u4e3b");break;case 65534:a.showAlert("\u6bcf\u5929\u53ea\u80fd\u7ed93\u4e2a\u5427\u6295\u7968 \u0ca5_\u0ca5");break;case 65533:a.showAlert("\u6bcf\u5929\u53ea\u80fd\u7ed9\u4e00\u4e2a\u5427\u62951\u7968\uff0c\u8bf7\u660e\u5929\u7ee7\u7eed\u652f\u6301");break;case 65532:a.showAlert("\u5f53\u524dIP\u5df2\u88ab\u9501\u5b9a");break;case 2160001:a.showAlert("\u89d2\u8272\u5df2\u6ee1\u4e00\u4e07\u7968");break;default:a.showAlert("\u64cd\u4f5c\u5931\u8d25,"+e.error)}})},tbmallBuy:function(e){var t=this,a={};a.props_id=this.resources.expballPropsId,a.props_category=this.resources.expballPropsCategoryId,a.props_type="1",a.scores="200",a.name="\u53cc\u500d\u7403",a.imgsrc="//tb2.bdstatic.com/tb/img/expball_buy_icon_552acff.jpg",a.free_user_level="0",a.time_interval="0",a.fetch_scores_limit="0",a.is_default_usedd="0";var r=this.parrScores.scores_total||0;return 200>r?(t.showAlert("T\u8c46\u4f59\u989d\u4e0d\u8db3, \u8bf7\u5148\u5151\u6362T\u8c46\u5427~"),void 0):(this.buyController=this.requireInstance("encourage-props/widget/buy_controller",[$(e),a,this.pageData]),this.buyController._buyDialog.element.off("click",".j_confirm_buy").on("click",".j_confirm_buy",function(){t.genOrder(+t.buyController._buyDialog.element.find(".j_count").val())}),void 0)},genOrder:function(e){var t=this,a={from:"pc",tbs:t.tbs};a.props_id=t.resources.expballPropsId,a.props_num=e,$.post(t.resources.ApiGenOrder,a,function(e){0===+e.no?t.payOrder(e.data||{}):t.showAlert("\u8ba2\u5355\u751f\u6210\u5931\u8d25, \u8bf7\u7a0d\u5019\u91cd\u8bd5")})},payOrder:function(e){var t=this,a={from:"\u540d\u4eba\u5802\u6295\u7968",chargeType:"platform"};a.goods_unit="\u4e2a";var r=$.extend(a,e),i=t.requireInstance("encourage-payment/widget/tdou_view_pay",function(e){e.data=e.data||{},"encourage_paid"===e.command&&0===+e.data.no&&(t.updatePageData($.getPageData("data.data.order_info",{},e)),t.buyController._buyDialog.close())});i.createMain(r)},updatePageData:function(e){var t=+e.tdou_num,a=+e.money_scores,r=+e.other_scores,i=t/200,o=this.hasExpBall(this.parrProps)+i;this.parrScores.scores_total-=t,this.parrScores.scores_money-=a,this.parrScores.scores_other-=r,this.parrProps["119"]=this.parrProps["119"]||{},this.parrProps["119"]["1190001"]=this.parrProps["119"]["1190001"]||{},this.parrProps["119"]["1190001"].left_num=o},getEmptyScores:function(){var e={};return e.scores_money=0,e.scores_total=0,e.scores_other=0,e},showExpBallDialog:function(){var e=this;this.showDialog(e.tplMain({})),e.dialog.element.on("click","[j-celebrity-expball-buy-btn]",function(){e.dialog.close(),e.tbmallBuy(this)}).on("click","[j-celebrity-expball-local-vip]",function(){e.dialog.close();var t={callback:function(){$.tb.location.reload()}};t.is_show_features=!1,t.is_show_forum=!1,t.current_forum_id=e.forum.forum_id,t.current_forum_name=e.forum.forum_name,t.scores=e.pageData.Parr_scores||e.getEmptyScores(),t.cnt_height=225,t.is_celebrity_forum=!0,e.requireInstance("encourage-member/widget/forum_member_dialog",t)}).on("click","[j-celebrity-expball-super-vip]",function(){e.dialog.close();var t=e.requireInstance("encourage-payment/widget/pay_member"),a={fr:"celebrity"};t.showCashier(a)})},showVoteSuccessDialog:function(e){var t=this;e.left_vote_times=e.left_vote_times||-1,this.showDialog(t.tplVote(e)),t.dialog.element.on("click","[j-celebrity-expball-buy-btn]",function(){t.dialog.close(),t.tbmallBuy(this)}).on("click","[j-celebrity-expball-local-vip]",function(){t.dialog.close();var e={callback:function(){$.tb.location.reload()}};e.is_show_features=!1,e.is_show_forum=!1,e.current_forum_id=t.forum.forum_id,e.current_forum_name=t.forum.forum_name,e.scores=t.pageData.Parr_scores||t.getEmptyScores(),e.cnt_height=225,e.is_celebrity_forum=!0,t.requireInstance("encourage-member/widget/forum_member_dialog",e)}).on("click","[j-celebrity-expball-super-vip]",function(){t.dialog.close();var e=t.requireInstance("encourage-payment/widget/pay_member"),a={fr:"celebrity"};e.showCashier(a)})},showVoteConfirmDialog:function(){var e={};e.left_num=this.hasExpBall(this.parrProps),this.showDialog(this.tplConfirm(e))},showAlert:function(e){$.dialog.alert(e,{title:"\u8d34\u5427\u63d0\u793a",acceptValue:"\u77e5\u9053\u5566",onaccept:function(){return!0}})},showDialog:function(e,t){this.dialog&&(this.dialog.close(),this.dialog=null);var a=$.dialog;this.dialog=new a({title:t,html:e,width:430})},checkLogin:function(){return window.PageData.user.is_login?!0:(this.requireInstance("tbui/widget/login_dialog"),!1)}}});