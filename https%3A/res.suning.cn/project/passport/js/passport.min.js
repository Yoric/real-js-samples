var loginCallbackStack=[];var intervalVar;var currentLocation;var wapPopSt=1;var isAppendLoginStyle=false;var safe_url_pattern=/.*?\.(gov|suningpptv|suningssc|suning|cnsuning|suningcloud|suningcloudsit|wuliuyun|snjijin|pptv|suninghotel|suningdangjian)\.(com|cn)$/;var default_ebuy="https://www.suning.com";function popupLoginContainer(a){if(typeof a=="undefined"){if(typeof passport_config!="undefined"){a=passport_config}else{alert("You must define passport_config var.");return}}currentLocation=window.location.href;var b=((typeof a.successCallbackUrl=="undefined")?(a.base+"popupLoginSuccess?"):a.successCallbackUrl)+"topLocation="+encodeURIComponent(currentLocation.split("#")[0])+"&loginTheme="+a.loginTheme;$modalOverlay=$("#modalOverlay");if($modalOverlay.length>0){$modalOverlay.remove()}$modalContainer=$("#modalContainer");if($modalContainer.length>0){$modalContainer.remove()}$("body").append('<div id="modalOverlay" style="opacity: 0.3;filter:Alpha(opacity=30);background:none repeat scroll 0 0 #000000;position: absolute;border: 0 none;width: 100%;height: 100%;top: 0;left: 0;z-index:1000097;"></div><div id="modalContainer" style="z-index:1000098;position:fixed;_position: absolute;"></div>');$("#modalOverlay").hide();$("#modalOverlay").css("height",$(document).height()+"px");$("#modalContainer").html('<iframe id="iframeLogin" style="position: fixed ;" width="1" height="1" src="'+b+'" frameborder="0" scrolling="no" allowtransparency="yes"></iframe>');if(typeof intervalVar!="undefined"){clearInterval(intervalVar)}intervalVar=window.setInterval(checkMsgFromLoginIframe,200)}function checkMsgFromLoginIframe(){var b=window.location.hash;if(b.length>1){var d=b.split("#");var e=d[1].split(":");switch(e[0]){case"resize":resizeContainer(e[1]);break;case"close":closeContainer();break;case"loginSuccess":loginSuccess();break;case"loginRedirect":var a=decodeURIComponent(e[1]);var c=getDomainForUrl(a);if(!safe_url_pattern.test(c)){a=default_ebuy}location.href=a;break;default:break}}}var ie6_num=0;function resizeContainer(g){$("#modalOverlay").show();var h=g.split(",");var b=h[0];var i=h[1];$iframe=$("#iframeLogin");$iframe.attr("width",b);$iframe.attr("height",i);var d=window.innerWidth?window.innerWidth:$(window).width();var a=window.innerHeight?window.innerHeight:$(window).height();var c=(d-b)/2;var f=(a-i)/2;var e=$(document).scrollTop();$modalContainer=$("#modalContainer");$modalContainer.css("top",Math.max(f,5));if(!window.XMLHttpRequest){ie6_num=1;f=f+e;$modalContainer.css("top",Math.max(f,5))}$modalContainer.css("left",c)}function closeContainer(){document.getElementById("modalOverlay").style.display="none";document.getElementById("modalContainer").style.display="none";$("html").removeClass("login-noscroll2");$("body").removeClass("login-noscroll");if(wapPopSt!=1){$("body").scrollTop(wapPopSt);wapPopSt=1}window.location.href=(currentLocation.indexOf("#")==-1)?currentLocation+"#unknown":currentLocation;clearInterval(intervalVar)}function loginSuccess(){closeContainer();var a=loginCallbackStack.pop();if(a!=null){a()}}function probeAuthStatus(c,b,a){if(typeof a=="undefined"){if(typeof passport_config!="undefined"){a=passport_config}else{alert("You must define passport_config var.");return}}$.ajax({url:a.base+"authStatus",crossDomain:true,cache:false,dataType:"jsonp",success:function(d){if(d.hasLogin){var e=d.principal;c(e)}else{b()}}})}function ensureLogin(b,a){if(typeof a=="undefined"){if(typeof passport_config!="undefined"){a=passport_config}else{alert("You must define passport_config var.");return}}loginCallbackStack.push(b);popupLoginContainer(a)}function ensureLoginWap(c,a){if(typeof a=="undefined"){if(typeof passport_config!="undefined"){a=passport_config}else{alert("You must define passport_config var.");return}}loginCallbackStack.push(c);currentLocation=window.location.href;var b=((typeof a.successCallbackUrl=="undefined")?(a.base+"popupLoginSuccess?"):a.successCallbackUrl)+"topLocation="+encodeURIComponent(currentLocation.split("#")[0])+"&loginTheme="+a.loginTheme;$modalOverlay=$("#modalOverlay");if($modalOverlay.length>0){$modalOverlay.remove()}$modalContainer=$("#modalContainer");if($modalContainer.length>0){$modalContainer.remove()}$("body").append('<div id="modalOverlay" style="position: absolute; top: 0; left: 0; z-index: 998;"></div><div id="modalContainer"></div>');$("#modalOverlay").height("100%").width("100%");$("#modalOverlay").html('<iframe id="iframeLogin"  src="'+b+'" width="100%" height="100%" scrolling="no" frameborder="0"></iframe>');if(!isAppendLoginStyle){$("head").append("<style>.login-noscroll{overflow:hidden;height:100%} .login-noscroll2{overflow:scroll;height:100%}</style>");isAppendLoginStyle=true}wapPopSt=$("body").scrollTop();$("html").addClass("login-noscroll2");$("body").addClass("login-noscroll");if(typeof intervalVar!="undefined"){clearInterval(intervalVar)}$("#iframeLogin").on("load",function(){intervalVar=window.setInterval(checkMsgFromLoginIframe,200)})}function ajaxInSameDomain(c,e,f,d,b,a){if(typeof a=="undefined"){if(typeof passport_config!="undefined"){a=passport_config}else{alert("You must define passport_config var.");return}}$.ajax({url:c,data:e,type:f,cache:false,error:b,success:function(g){if(g.idsIntercepted){var i=function(){ajaxInSameDomain(c,e,f,d,b,a)};if(g.policy=="GATEWAY"&&g.status=="UNKNOWN"){probeAuthStatus(i,i,a);return}if(g.policy="RESTRICTED"){if(g.status=="ANONYMOUS"){loginCallbackStack.push(i);popupLoginContainer(a);return}else{if(g.status=="UNKNOWN"){var h=function(){loginCallbackStack.push(i);popupLoginContainer(a)};probeAuthStatus(i,h,a);return}}}console.log("Illegal status.");return}d(g)}})}function ajaxCrossDomain(c,e,d,b,a){if(typeof a=="undefined"){if(typeof passport_config!="undefined"){a=passport_config}else{alert("You must define passport_config var.");return}}$.ajax({url:c,data:e==null?"crossDomainJsonpRequest=true":e+"&crossDomainJsonpRequest=true",crossDomain:true,dataType:"jsonp",cache:false,error:b,success:function(f){if(f.authStatusResponse){var g=function(){ajaxCrossDomain(c,e,d,b,a)};if(f.hasLogin){g()}else{loginCallbackStack.push(g);popupLoginContainer(a)}return}d(f)}})}if(!window.XMLHttpRequest){$(window).scroll(function(){var a=$(document).scrollTop();var b=$(window).height();var c=$("#modalContainer").find("iframe").height();var d=Math.max(0,(b-c)/2);$("#modalContainer").css({top:a+d})})}function ensureReg(b,a){probeAuthStatus(function(){if(b!=null){b()}},function(){popupRegContainer(b,a)},a)}function popupRegContainer(c,a){if(typeof a=="undefined"||a==null){if(typeof passport_config!="undefined"){a=passport_config}else{alert("You must define passport_config var.");return}}if(!a.hasOwnProperty("regDomain")){alert("You must define passport_config.regDomain");return}loginCallbackStack.push(c);currentLocation=window.location.href;var b=a.regDomain+"/popreg.do?topLocation="+encodeURIComponent(currentLocation.split("#")[0]);$modalOverlay=$("#modalOverlay");if($modalOverlay.length>0){$modalOverlay.remove()}$modalContainer=$("#modalContainer");if($modalContainer.length>0){$modalContainer.remove()}$("body").append('<div id="modalOverlay" style="opacity: 0.3;filter:Alpha(opacity=30);background:none repeat scroll 0 0 #000000;position: absolute;border: 0 none;width: 100%;height: 100%;top: 0;left: 0;z-index:1000097;"></div><div id="modalContainer" style="z-index:1000098;position:fixed;_position: absolute;"></div>');$("#modalOverlay").hide();$("#modalOverlay").css("height",$(document).height()+"px");$("#modalContainer").html('<iframe id="iframeLogin" style="position: fixed ;" width="412" height="1" src="'+b+'" frameborder="0" scrolling="no" allowtransparency="yes"></iframe>');if(typeof intervalVar!="undefined"){clearInterval(intervalVar)}intervalVar=window.setInterval(checkMsgFromLoginIframe,200)}function getDomainForUrl(j){var b=j;var a=0;var d=j.length;var f,h,l;var g=/^[\w|.|-]+$/;var e="";while((d>0)&&(j.charAt(d-1)<=" ")){d--}while((a<d)&&(j.charAt(a)<=" ")){a++}for(f=a;f<d;f++){h=j.charAt(f);if(h==":"){var k=j.substring(a,f).toLowerCase();b=b.substring(a=f+1,d);if(k!="http"&&k!="https"){return""}break}}while(j.charAt(a)=="/"){a++}for(f=a;f<d;f++){h=j.charAt(f);if(h=="/"||h=="?"||h=="#"){e=j.substring(a,f).toLowerCase();if(g.test(e)){return e}}}if(e==""){e=j.substring(a,d).toLowerCase();if(g.test(e)){return e}}return""};