!function e(t,i,o){function r(n,l){if(!i[n]){if(!t[n]){var s="function"==typeof require&&require;if(!l&&s)return s(n,!0);if(a)return a(n,!0);var d=new Error("Cannot find module '"+n+"'");throw d.code="MODULE_NOT_FOUND",d}var c=i[n]={exports:{}};t[n][0].call(c.exports,function(e){var i=t[n][1][e];return r(i?i:e)},c,c.exports,e,t,i,o)}return i[n].exports}for(var a="function"==typeof require&&require,n=0;n<o.length;n++)r(o[n]);return r}({1:[function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),n=e("../modules/helpers/browser"),l=e("./globalConfig"),s=o(l),d=function(){function e(){r(this,e),this.browser=n.browser,this.debugId=Math.floor(1e4*Math.random())+1,this.setDefaultGalleryItemConfig()}return a(e,[{key:"setDefaultGalleryItemConfig",value:function(){this.config={noimage:s.default.noimage,autoplay:s.default.autoplay,audio:s.default.audio,audioonce:s.default.audioonce,redirect:s.default.redirect&&!this.browser.isMobile(),redirecttext:s.default.redirecttext,ctatext:s.default.ctatext,hidectaicon:s.default.hidectaicon,sharewidget:s.default.sharewidget,redirectwithclick:s.default.redirectwithclick,pauseonhover:s.default.pauseonhover,pausehoveronce:s.default.pausehoveronce,redirectwithvid:s.default.redirectwithvid,isDisabled:!1,duration:0,isVertical:!1,videoRatio:!1}}}]),e}();i.default=d},{"../modules/helpers/browser":12,"./globalConfig":2}],2:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o={userid:!1,publickey:!1,ongalleryload:"",debug:!1,nomobile:!1,notablet:!1,aggressivelazy:!1,nocache:!1,idattribute:!1,scandivwbgattr:!1,ignorepicture:!1,imgignore:!1,divignore:!1,divignorelevels:!1,ignoreparentelement:!1,ignorehref:!1,optimizely:!1,optimizelyoff:!1,passivetracking:!1,redirect:!1,redirecttext:"Video Will Begin In...",ctatext:"See The Full Clip",redirectwithclick:!1,redirectwithclicktarget:!1,redirectwithvid:!1,hidectaicon:!1,sharewidget:!1,socialtext:"",autoplay:!1,pauseonhover:!1,pausehoveronce:!1,noimage:!1,audio:!1,audioonce:!1,resizeonscroll:!1,proactiveload:!1,urlregexp:"",disableall:!1,ignorecurrenturl:!1,preloadoffset:300,mobilepreload:!0,maxpreloadedvideos:5,allautoplay:!1,followscroll:!1,pulltochange:!1,initmobilequeue:!1,customimgsrc:"",smallgif:!1,ingnoreelementheight:"false",topviewportoffset:50,bottomviewportoffset:50,minscrolldistance:50,mobilecta:!1,mobilectaloopcount:1,previewdelay:0,forcesmallvideo:!1};i.default=o},{}],3:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o={vilynxUID:"",loaded:!1,savedEventsSended:!1,scrollDirection:!0,retryTime:1e3,maxRetries:0,galleryVersion:"4.5.0",sourceUrl:"//static.vilynx.com/gallery",iframeUrl:"https://static.vilynx.com/gallery/vtrk.html",serverUrl:"www.vilynx.com",bgImageRegex:/^url\("?.*$/};i.default=o},{}],4:[function(require,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),_exposed=require("./modules/helpers/exposed"),_domObserve=require("./modules/domObserve"),_domObserve2=_interopRequireDefault(_domObserve),_globalConfig=require("./config/globalConfig"),_globalConfig2=_interopRequireDefault(_globalConfig),_privateConfig=require("./config/privateConfig"),_privateConfig2=_interopRequireDefault(_privateConfig),_logger=require("./modules/helpers/logger"),_browser=require("./modules/helpers/browser");require("./polyfills/classList"),require("./polyfills/path"),require("./polyfills/assign"),require("./polyfills/closest");var Bootstrap=function(){function Bootstrap(){_classCallCheck(this,Bootstrap);var seleniumRunning=document.querySelector("script#vilynum");return seleniumRunning?(window.vilynxGallery=void 0,null):(_logger.logger.debug("Gallery Bootstraped"),this.insertVilynxIFrame(),void(this.loadConfig()&&(_globalConfig2.default.ongalleryload?setTimeout(function(){try{eval(_globalConfig2.default.ongalleryload)()}catch(e){_logger.logger.error("Error executing ongalleryload callback")}new _domObserve2.default},500):new _domObserve2.default,this.insertVilynxCss())))}return _createClass(Bootstrap,[{key:"loadConfig",value:function(){var e=document.querySelector('script[src*="gallery/vpg"]')||document.querySelector('script[src*="dev/vpg"]'),t=e.dataset;return _globalConfig2.default.debug||(_globalConfig2.default.debug=!!localStorage.getItem("vilynx_gallery_debug"),_logger.logger.info("Gallery debug enabled by localStorage")),e?(Object.keys(e.attributes).forEach(function(i){var o=e.attributes[i],r=o.name;t||(r=r.replace("data-","")),"undefined"==typeof _globalConfig2.default[r]?_logger.logger.warn("Config register not found: "+r):(_globalConfig2.default[r]=o.value,_logger.logger.debug("Config element loaded: "+r))}),e.dataset&&Object.keys(e.dataset).forEach(function(t){var i=t;"undefined"==typeof _globalConfig2.default[i]?_logger.logger.warn("Config register not found: "+i):(_globalConfig2.default[i]=e.dataset[t],_logger.logger.debug("Config element loaded: "+i))}),_globalConfig2.default.userid||_globalConfig2.default.publickey?_browser.browser.isMobile()&&_globalConfig2.default.nomobile||_browser.browser.isTablet()&&_globalConfig2.default.notablet?(_logger.logger.info("Vilynx Gallery deactivated in mobile"),!1):_browser.browser.isIe10()?(_logger.logger.info("Vilynx Gallery disabled on IE10 and lower"),!1):(_globalConfig2.default.publickey&&(_globalConfig2.default.userid=_globalConfig2.default.publickey),_logger.logger.info("Config loaded"),_privateConfig2.default.loaded=!0,!0):(_logger.logger.error("FUBAR: Can't find userid. Aborting"),!1)):(_logger.logger.warn("Vilynx Script not detected"),!1)}},{key:"insertVilynxCss",value:function(){var e=document.getElementsByTagName("head")[0],t=document.createElement("link");return t.rel="stylesheet",t.type="text/css",t.href=_privateConfig2.default.sourceUrl+"/vpg.min_85287.css",e.appendChild(t),!0}},{key:"insertVilynxIFrame",value:function(){var e=document.createElement("iframe");return e.style.display="none",e.src=_privateConfig2.default.iframeUrl,window.addEventListener("message",function(e){"https://static.vilynx.com"!==e.origin&&"https://static.test.vilynx.com"!==e.origin||(_privateConfig2.default.vilynxUID=e.data)},!1),document.querySelector("body").appendChild(e),!0}},{key:"initMixpanel",value:function(){return window.mixpanel||!function(e,t){if(!t.__SV){var i,o,r,a;window.mixpanel=t,i=e.createElement("script"),i.type="text/javascript",i.async=!0,i.src="https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js",o=e.getElementsByTagName("script")[0],o.parentNode.insertBefore(i,o),t._i=[],t.init=function(e,i,o){function n(e,t){var i=t.split(".");2==i.length&&(e=e[i[0]],t=i[1]),e[t]=function(){e.push([t].concat(Array.prototype.slice.call(arguments,0)))}}var l=t;for("undefined"!=typeof o?l=t[o]=[]:o="mixpanel",l.people=l.people||[],l.toString=function(e){var t="mixpanel";return"mixpanel"!==o&&(t+="."+o),e||(t+=" (stub)"),t},l.people.toString=function(){return l.toString(1)+".people (stub)"},r="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" "),a=0;a<r.length;a++)n(l,r[a]);t._i.push([e,i,o])},t.__SV=1.2}}(document,window.mixpanel||[]),"www.vilynx.com"===_privateConfig2.default.serverUrl?mixpanel.init("d364d05eafba7428fa30545c9bef1571",{cookie_name:"vilynx",loaded:function(){mixpanel.distinct_id&&(distinct_id=mixpanel.get_distinct_id())}},"vilynx"):mixpanel.init("6db11abe1b874135d21ec21a30f57680",{cookie_name:"vilynx",loaded:function(){mixpanel.distinct_id&&(distinct_id=mixpanel.get_distinct_id())}},"vilynx"),_logger.logger.debug("Mixpanel initialized"),!0}}]),Bootstrap}();new Bootstrap,window.vilynxGallery=_exposed.exposed},{"./config/globalConfig":2,"./config/privateConfig":3,"./modules/domObserve":5,"./modules/helpers/browser":12,"./modules/helpers/exposed":13,"./modules/helpers/logger":15,"./polyfills/assign":23,"./polyfills/classList":24,"./polyfills/closest":25,"./polyfills/path":26}],5:[function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),n=e("./../config/globalConfig"),l=o(n),s=e("./finder"),d=e("./helpers/logger"),c=e("./helpers/utils"),u=function(){function e(){r(this,e),d.logger.debug("Listener class initialized"),this.finder=s.finder,s.finder.hardScan(),this.mutationTarget=document.querySelector("body"),this.mutationObserverSettings={childList:!0,attributes:!1,characterData:!1,subtree:!0,attributeOldValue:!1},this.ignoreElementsQuery=".supra-wrapper",l.default.ignoreparentelement&&c.utils.validateQuery(l.default.ignoreparentelement)&&(this.ignoreElementsQuery+=", "+l.default.ignoreparentelement),this.addEs6DomChangesListener(),this.vilynxEnabledListener()}return a(e,[{key:"addEs6DomChangesListener",value:function(){var e=this;d.logger.debug("Adding ES6 MutationObserver");var t=new MutationObserver(function(t){var i=[],o=[];t.forEach(function(t){var r=Array.prototype.slice.call(t.addedNodes);r.forEach(function(t){if(t.childElementCount&&!t.closest(e.ignoreElementsQuery)&&(i.push(t),t.querySelectorAll(".vilynx_enabled").length>0||t.classList.contains("vilynx_enabled"))){if(t.classList.contains("vilynx_enabled"))o.push(t);else{var r=Array.prototype.slice.call(t.querySelectorAll(".vilynx_enabled"));o=o.concat(r)}e.vilynxEnabledListener(o)}})}),e.finder.softScan(i)});t.observe(this.mutationTarget,this.mutationObserverSettings)}},{key:"vilynxEnabledListener",value:function(e){var t=this,i=void 0,o=["vilynx-id","data-vilynx-id"];i="undefined"!=typeof e?e:document.querySelectorAll(".vilynx_enabled"),l.default.idattribute&&o.push(l.default.idattribute),Array.prototype.forEach.call(i,function(e){if(e&&!e.getAttribute("vilynx-id")&&!e.getAttribute("data-vilynx-id")&&(!l.default.idattribute||!e.getAttribute(l.default.idattribute))&&e.classList&&!e.classList.contains("vilynx_observe")){var i=new MutationObserver(function(){var i=[];e.classList&&!e.classList.contains("vilynx_registered")&&(i.push(e),t.finder.softScan(i))});i.observe(e,{childList:!1,subtree:!1,attributes:!0,characterData:!1,attributeFilter:o}),e.classList.add("vilynx_observe")}})}}]),e}();i.default=u},{"./../config/globalConfig":2,"./finder":6,"./helpers/logger":15,"./helpers/utils":18}],6:[function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0}),i.finder=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),n=e("./gallery/galleryItem"),l=o(n),s=e("./helpers/xhr"),d=o(s),c=e("../config/globalConfig"),u=o(c),g=e("./helpers/logger"),h=e("../config/privateConfig"),f=o(h),p=function(){function e(){r(this,e),this.domElementsArray=[],this.preparedDomElementsArray=[],this.finderTimeout=!0,this.selectorQuery="a:not(.vilynxignore):not(.vilynx_registered):not(.vilynx_disable), .vilynx_enabled:not(.vilynxignore):not(.vilynx_registered):not(.vilynx_disable), .teaser_enabled:not(.vilynxignore):not(.vilynx_registered):not(.vilynx_disable)",this.mixPanel=!1}return a(e,[{key:"hardScan",value:function(){u.default.disableall&&(this.selectorQuery=".vilynx_enabled:not(.vilynxignore):not(.vilynx_registered):not(.vilynx_disable), .teaser_enabled:not(.vilynxignore):not(.vilynx_registered):not(.vilynx_disable)"),this.privateScan(document,null)}},{key:"softScan",value:function(e){var t=this,i=[],o=[];[].forEach.call(e,function(e){if(!e||!e.tagName)return void g.logger.warn("This new node is not a valid element (tag have not a name): "+e);if(e.classList.contains("vilynx_registered")||e.classList.contains("supra-wrapper"))return void g.logger.warn("This new node is a gallery registered element (target have class vilynx_registered, supra-wrapper): "+e);if(e.classList.contains("vilynx_disable")||e.classList.contains("vilynxignore"))return void g.logger.warn("This new node is a disabled element ( has class vilynx_disable OR vilynxignore): "+e);if("a"===e.localName||e.classList.contains("vilynx_enabled")||e.classList.contains("teaser_enabled")){if(u.default.disableall&&!e.classList.contains("vilynx_enabled")&&!e.classList.contains("teaser_enabled"))return void g.logger.warn("Node does not have the class vilynx_enabled NOR teaser_enabled): "+e);var r=t.findElementWithBg(e);(e.querySelector("img")||r)&&i.push(e)}"img"===e.localName&&e.parentNode&&"a"===e.parentNode.localName&&(g.logger.info("New img node inserted in anchor, parent pushed as valid element"),i.push(e.parentNode)),o=e.querySelectorAll(t.selectorQuery),[].forEach.call(o,function(o){var r=t.findElementWithBg(e);o.closest(".vilynxignore")||!o.querySelector("img")&&!r||i.push(o)})}),e=[],o=[],0!==i.length&&(g.logger.info("New soft scan invoked"),g.logger.info(i),this.privateScan(null,i))}},{key:"privateScan",value:function(e,t){var i=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"undefined",r=[];return e?(g.logger.info('Starting Scan with query: "'+this.selectorQuery+'" over the element '+e.nodeName),r=e.querySelectorAll(this.selectorQuery),[].forEach.call(r,function(e){var t=!1,o={};t=i.findElementWithBg(e),e.closest(".vilynxignore")||!e.querySelector("img")&&!t||i.domElementsArray.some(function(t){return t.domObject===e})||(o.domObject=e,i.domElementsArray.push(o))})):t&&(g.logger.info("Pushing "+t.length+" elements to the extractor"),[].forEach.call(t,function(e){var t={};t.domObject=e,t.galleryItem=o,i.domElementsArray.some(function(e){return e.domObject===t.domObject})||i.domElementsArray.push(t)})),g.logger.info("----- SCAN RESULT ------"),g.logger.info("Found "+this.domElementsArray.length+" elements"),g.logger.info("/----- SCAN RESULT ------/"),0!==this.domElementsArray.length&&void(this.finderTimeout&&(this.finderTimeout=!1,this.getHashesDebounce()))}},{key:"getHashesDebounce",value:function(){var e=this,t=setTimeout(function(){e.prepareGetHashes(),e.finderTimeout=!0,clearTimeout(t)},250)}},{key:"prepareGetHashes",value:function(){var e=this;this.extractor(),0===this.preparedDomElementsArray.length?g.logger.info("All valid domElements were removed by extractor. Prevent call to get_hashes"):(g.logger.info("Call to get_hashes with "+this.preparedDomElementsArray.length+" elements"),this.getHashes(function(t){t.hashes.forEach(function(e){e.url=e.url[0],e.hash=e.hash[0],e.title?e.title=e.title[0]:e.title=""}),e.preparedDomElementsArray.forEach(function(e){t.hashes.forEach(function(t){t.url!==e.extractedUrl&&t.url.slice(0,-1)!==e.extractedUrl&&t.url!==e.extractedUrl.slice(0,-1)||(e.vilynxData=t)})});for(var i=e.preparedDomElementsArray.length-1;i>=0;i--){var o=e.preparedDomElementsArray[i];o.vilynxData&&(o.galleryItem&&"undefined"!==o.galleryItem?(o.galleryItem.galleryData.vilynxData=o.vilynxData,o.galleryItem.refreshVideoNode()):new l.default(o)),e.preparedDomElementsArray.splice(i,1)}}))}},{key:"extractor",value:function(){var e=u.default.idattribute,t=new RegExp(u.default.urlregexp),i=window.location.host+window.location.pathname;!u.default.ignorecurrenturl||"undefined"!=typeof this.currentUrl&&i.match(this.currentUrl)||(this.currentUrl=new RegExp("^(http:|https:)?(//)?("+i.replace(new RegExp("/$"),"")+")(/)?$"));for(var o=this.domElementsArray.length-1;o>=0;o--){var r=this.domElementsArray[o];if("undefined"==typeof r.extractedUrl){var a=r.domObject,n=void 0,l=!1;a.dataset&&a.dataset.vilynxId?l=a.dataset.vilynxId:a.attributes["vilynx-id"]?l=a.attributes["vilynx-id"].value:a.attributes["data-vilynx-id"]&&(l=a.attributes["data-vilynx-id"].value),l?n=l:e&&a.attributes[e]?n=a.attributes[e].value:!u.default.ignorehref&&"a"===a.localName&&a.attributes.href&&(n=a.href),u.default.urlregexp&&n&&(n=n.replace(t,"")),u.default.ignorecurrenturl&&n&&n.match(this.currentUrl)&&(g.logger.warn("url matches with current url. Removing from array"),n=!1),n?(r.extractedUrl=n,this.preparedDomElementsArray.push(r)):(g.logger.warn("Can't find URL for dom node. Removing from array"),g.logger.warn(a)),this.domElementsArray.splice(o,1)}}g.logger.info("Extractor job done. Got "+this.preparedDomElementsArray.length+" Items"),g.logger.debug(this.preparedDomElementsArray)}},{key:"getHashes",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o="//"+f.default.serverUrl+"/get_hashes.php",r="owner="+u.default.userid,a="",n=new d.default;this.preparedDomElementsArray.forEach(function(e){a+=e.extractedUrl+","}),a=encodeURIComponent(a),r+="&url="+a,u.default.sharewidget&&(r+="&title"),n.post(o,r,function(t){e(t)},function(o){t.preparedDomElementsArray=[],o&&(i+=1,i<=f.default.maxRetries?(g.logger.warn("Error executing XHR to  get_hashes, retry in "+f.default.retryTime+" ( Retry "+i+" of "+f.default.maxRetries+" )"),setTimeout(function(){t.getHashes(e,i)},f.default.retryTime)):g.logger.error("FUBAR: Can't  get video hashes. Aborting"))})}},{key:"findElementWithBg",value:function(e){var t="div, button";u.default.imgignore&&(t="div:not("+u.default.imgignore+"), button:not("+u.default.imgignore+")");var i=!1,o=e.querySelectorAll(t);return o.length>0&&[].forEach.call(o,function(e){(""!==e.style.backgroundImage&&f.default.bgImageRegex.test(e.style.backgroundImage)||e.attributes[u.default.scandivwbgattr])&&(i=!0,e.classList.add("vilynx_img"))}),i}}]),e}();i.finder=new p},{"../config/globalConfig":2,"../config/privateConfig":3,"./gallery/galleryItem":10,"./helpers/logger":15,"./helpers/xhr":20}],7:[function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),l=e("../../../config/globalConfig"),s=o(l),d=function(){function e(t){r(this,e),this.gallery=t,this.redirectDom={},this.targetImg=t.galleryData.domObject.querySelector(".vilynx_mainImg"),this.timeOuts={}}return n(e,[{key:"createRedirectDom",value:function(){var e=document.createElement("div"),t=document.createElement("div"),i=document.createElement("div"),o=document.createElement("div"),r=window.getComputedStyle(this.targetImg),a=parseFloat(r.height.replace("px",""));return this.redirectDom=e,t.classList.add("redirectCenter"),e.classList.add("redirectWrapper"),e.appendChild(t),i.classList.add("text"),i.innerHTML=this.gallery.config.redirecttext,o.id="counter",o.classList.add("counter"),o.innerHTML="3",t.appendChild(i),t.appendChild(o),this.redirectDom.querySelector(".redirectCenter").style.height=a+"px",e}},{key:"setHeight",value:function(e){this.redirectDom.querySelector(".redirectCenter").style.height=e+"px"}},{key:"setRedirectFontSize",value:function(e){var t=window.getComputedStyle(e),i=parseFloat(t.width.replace("px","")),o=Math.floor(.09*i);o>40&&(o=40),this.redirectDom&&(this.redirectDom.querySelector(".redirectCenter").style.fontSize=o+"px",this.redirectDom.querySelector("#counter").style.fontSize=Math.floor(1.5*o)+"px",this.redirectDom.querySelector("#counter").style.lineHeight=Math.floor(1.7*o)+"px",i<300?(this.redirectDom.querySelector(".redirectCenter .text").style.maxWidth=i+"px",this.redirectDom.querySelector(".redirectCenter .text").style.lineHeight="normal",this.redirectDom.querySelector(".redirectCenter .counter").style.maxWidth=i+"px",this.redirectDom.querySelector("#counter").style.fontSize=Math.floor(1.2*o)+"px",this.redirectDom.querySelector("#counter").style.lineHeight=Math.floor(1.5*o)+"px",this.redirectDom.querySelector("#counter").style.marginBottom=Math.floor(1.2*o)+"px",this.redirectDom.querySelector(".redirectCenter .text").style.marginBottom=0):(this.redirectDom.querySelector(".redirectCenter .text").style.maxWidth="unset",this.redirectDom.querySelector(".redirectCenter .text").style.marginBottom="10px",this.redirectDom.querySelector(".redirectCenter .counter").style.maxWidth="unset",this.redirectDom.querySelector("#counter").style.marginBottom="unset"))}},{key:"showRedirectWrapper",value:function(e){var t=e.galleryData.domObject,i=e.videoNode.duration;if(i<1)return e.logger.log("Video shorter than 1 sec, avoiding redirect","err"),void(e.timeOuts={});if(e.config.sharewidget&&"block"===window.getComputedStyle(t.querySelector(".shareGrid")).display)return e.logger.log("ShareWidget open, avoiding redirect"),void(e.timeOuts={});if(t.href||e.config.redirectwithclick!==!1||e.config.redirectwithvid!==!1){var o=function(){if(e.config.redirectwithvid){var o=new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i");if(o.test(e.galleryData.extractedUrl)===!1)return e.logger.log("vilynx-id is not a valid URL, abort redirect","err"),e.timeOuts={},{v:void 0}}var r=e.redirect.redirectDom,a=r.querySelector("#counter"),n=3;r.style.visibility="visible",r.style.zIndex=99999999,r.style.opacity="1",e.redirect.timeOuts={},i>3?(a.innerHTML="3",e.redirect.timeOuts.twoSec=setTimeout(function(){a.innerHTML="2"},1e3),e.redirect.timeOuts.oneSec=setTimeout(function(){a.innerHTML="1"},2e3)):i>2?(a.innerHTML="2",e.redirect.timeOuts.oneSec=setTimeout(function(){a.innerHTML="1"},1e3),n=2):i>1&&(a.innerHTML="1",n=1),e.redirect.timeOuts.zeroSecs=setTimeout(function(){if(e.mixpanel.trackViewDuration("redirect",e.config.duration+n),e.config.redirectwithclick&&!t)e.logger.log("No parent anchor found, avoiding redirect with .click()","err");else if(e.config.redirectwithclick&&t){e.logger.log("Cleaning redirect frame","debug"),e.doMouseLeave(!0);var i=e.galleryData.domObject.querySelector(s.default.redirectwithclicktarget);s.default.redirectwithclicktarget&&i?i.click():t.click()}else{e.logger.log("Cleaning redirect frame","debug"),e.doMouseLeave(!0),e.mixpanel.trackVideoPlay();var o=t.href;e.config.redirectwithvid&&(o=e.galleryData.extractedUrl),window.location.href=o}},1e3*n)}();if("object"===("undefined"==typeof o?"undefined":a(o)))return o.v}else e.logger.log("No parent anchor found, avoiding redirect","err"),e.timeOuts={}}},{key:"hideRedirectWrapper",value:function(e){if(e.redirect.timeOuts){var t=e.redirect.redirectDom;e.config.redirectOnTop&&(e.wrapperNode.style.zIndex=0,e.videoNode.style.zIndex=-5),Object.keys(e.redirect.timeOuts).forEach(function(t){e.logger.log("Clearing timeout "+t,"debug"),clearTimeout(e.redirect.timeOuts[t])}),t.querySelector("#counter").innerHTML="3",t.style.opacity="",t.style.visibility="",t.style.zIndex=""}}}]),e}();i.default=d},{"../../../config/globalConfig":2}],8:[function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0}),i.utils=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),n=e("../../../config/privateConfig"),l=o(n),s=e("../../../config/globalConfig"),d=o(s),c=e("../../helpers/browser"),u=function(){function e(){r(this,e)}return a(e,[{key:"getVideoUrl",value:function(e,t,i){var o=void 0,r=void 0,a=void 0,n=void 0,s=l.default.serverUrl.slice(4),u=void 0,g=e.hash,h=e.timestamp;return i?c.browser.isMobile()&&d.default.forcesmallvideo?(o="//public."+s+"/"+g+"/gallery.pro69.viwindow",n="//public."+s+"/"+g+"/pro69.viwindow0.jpg"):t>640?(o="//public."+s+"/"+g+"/pro69high.viwindow",n="//public."+s+"/"+g+"/pro69high.viwindow0.jpg"):t>360?(o="//public."+s+"/"+g+"/pro69.viwindow",n="//public."+s+"/"+g+"/pro69.viwindow0.jpg"):(o="//public."+s+"/"+g+"/gallery.pro69.viwindow",n="//public."+s+"/"+g+"/pro69.viwindow0.jpg"):c.browser.isMobile()&&d.default.forcesmallvideo?(o="//public."+s+"/"+g+"/gallery.short.viwindow",n="//public."+s+"/"+g+"/gallery.short.viwindow0.jpg"):t>360?(o="//public."+s+"/"+g+"/short.viwindow",n="//public."+s+"/"+g+"/short.viwindow0.jpg"):(o="//public."+s+"/"+g+"/gallery.short.viwindow",n="//public."+s+"/"+g+"/gallery.short.viwindow0.jpg"),r=o+".mp4?t="+h,a=o+".webm?t="+h,u={sources:{mp4:{url:r,mime:"video/mp4"},webm:{url:a,mime:"video/webm"}},posterUrl:n,is169:i}}},{key:"extractBGImageFromNode",value:function(e){return e.style.backgroundImage.slice(4,-1).replace(/["|']/g,"")}},{key:"createCopyImage",value:function(e){var t=document.createElement("img");return t.className="vilynx_wrapperImg",d.default.scandivwbgattr&&e.getAttribute(d.default.scandivwbgattr)?t.src=e.getAttribute(d.default.scandivwbgattr):""!==e.style.backgroundImage?t.src=this.extractBGImageFromNode(e):e.src&&e.src.length>0&&(t.src=e.src),t}},{key:"findActiveImage",value:function(e){var t=!1;return[].forEach.call(e,function(e){0!==e.offsetWidth&&0!==e.offsetHeight&&(t=e)}),t}},{key:"getTargetImgSize",value:function(e){var t=e.parentNode.getBoundingClientRect(),i=t.height,o=t.width,r=e.getBoundingClientRect(),a={width:r.width,height:r.height};return 0!==i&&0!==o&&(0!==i&&i<a.height&&(a.height=i),0!==o&&o<a.width&&(a.width=o)),a}}]),e}();i.utils=new u},{"../../../config/globalConfig":2,"../../../config/privateConfig":3,"../../helpers/browser":12}],9:[function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),n=e("../mixpanel"),l=o(n),s=e("../shareWidget"),d=o(s),c=e("../../config/globalConfig"),u=o(c),g=e("./blocks/redirect"),h=o(g),f=e("../helpers/exposed"),p=e("../helpers/scrollMonitor"),v=e("../helpers/browser"),y=e("./blocks/utils"),m=e("../finder"),w=function(){function e(t,i,o){r(this,e),this.logger=o,this.finder=m.finder,this.config=i,this.galleryData=t,this.redirect=null,this.sharingActive=!1;var a="desktop";this.config.autoplay&&(a="desktop_autoplay"),this.mixpanel=new l.default(t,a),t.domObject.querySelector(".vilynx_img")?this.imgSelectorQuery=".vilynx_img":(this.imgSelectorQuery="img:not(.vilynx_wrapperImg)",u.default.imgignore&&(this.imgSelectorQuery="img:not("+u.default.imgignore+"):not(.vilynx_wrapperImg)")),this.addConfigListener(),this.observeVilynxId(),this.onVideoEnd=[],this.onVideoCancel=[],this.tmp={},this.wrapperNode="",u.default.optimizely&&u.default.optimizelyoff||u.default.passivetracking?this.mouseClickListeners():this.monitorizeDesktop()}return a(e,[{key:"monitorizeDesktop",value:function(){var e=this,t=200;u.default.aggressivelazy&&(t=1e3),(void 0===window.scrollMonitor||!window.scrollMonitor.version||window.scrollMonitor.version<p.scrollMonitor.version)&&p.scrollMonitor.reFactory(),this.watcher=window.scrollMonitor.create(this.galleryData.domObject,t),this.watcher.enterViewport(function(){v.browser.isEdge()?e.tmp.waitToLoadTimeout=setTimeout(function(){e.watcher.isInViewport&&(e.logger.log("Item has been more than 350ms in viewport. Loading video!"),e.attachVideoNode())},350):e.attachVideoNode()}),this.watcher.exitViewport(function(){clearTimeout(e.tmp.waitToLoadTimeout),e.wrapperNode&&e.videoNode&&(e.logger.log("Exiting Viewport"),e.cleanVideoNode())})}},{key:"attachVideoNode",value:function(){try{var e=this.galleryData.domObject.classList.contains("vilynx_registered");if(this.config.isDisabled)return void this.logger.log("This element is disabled. Ignore enterViewport event");this.config.autoplay&&this.mixpanel.trackSummaryPlay(),e?!e||this.videoNode&&!this.videoNode.paused||(this.logger.log("reAttachVideoNode again"),this.reAttachVideoNode()):(this.logger.log("Entering viewport for first time"),this.initGallery())}catch(e){this.logger.log("Exception raised while processing the gallery attachVideoNode. Aborting item execution. Stack trace:","err"),this.logger.log(e,"err")}}},{key:"initGallery",value:function(){var e=this;if(this.galleryData.domObject.classList.add("vilynx_registered"),this.allIgnores=[],u.default.divignore&&!u.default.autoplay&&!this.config.autoplay){var t=this.galleryData.domObject;if(u.default.divignorelevels)for(var i=0;i<parseInt(u.default.divignorelevels,10);i++)t=t.parentNode;this.allIgnores=t.querySelectorAll(u.default.divignore),[].forEach.call(this.allIgnores,function(t){e.ignoreElementListeners(t)})}if(this.generateVideoUrl(),this.videoNode=this.createVideoDom(),this.wrapperNode=this.createWrapperDom(),this.setWrapperResize(),v.browser.isSafari()&&this.videoData.sources.mp4.url.includes("short")&&this.coverBackgroundWithPoster(),this.wrapperNode.appendChild(this.videoNode),this.setWrapperResize(),"absolute"!==window.getComputedStyle(this.galleryData.domObject).position&&"fixed"!==window.getComputedStyle(this.galleryData.domObject).position){var o=this.galleryData.domObject.querySelector(".vilynx_mainImg"),r=o.getBoundingClientRect(),a=this.galleryData.domObject.parentNode;if(a){var n=a.getBoundingClientRect();r.top===n.top&&r.left===n.left&&"relative"===window.getComputedStyle(a).position||(this.galleryData.domObject.style.position="relative")}}this.wrapperNode.clientHeight<100&&(this.config.sharewidget=!1),this.config.sharewidget&&(this.logger.log(this.wrapperNode.clientHeight),this.appendSocialWidget()),this.config.autoplay&&this.setVideoAutoplay(),this.mouseMoveListeners(),this.mouseClickListeners(),this.videoListeners(),this.config.redirect&&!this.config.autoplay&&(this.redirect=new h.default(this),this.wrapperNode.appendChild(this.redirect.createRedirectDom()),this.onVideoEnd.push(this.redirect.showRedirectWrapper),this.onVideoCancel.push(this.redirect.hideRedirectWrapper));var l=this.galleryData.domObject.querySelector(".vilynx_mainImg");l.classList.contains("vilynx_img")?this.observeBackgroundImage():this.observeOriginalImage(),this.resizeVideoNode(),this.responsiveListeners()}},{key:"cleanVideoNode",value:function(){if(this.config.autoplay&&!this.config.isDisabled)try{this.videoNode.pause()}catch(e){this.logger.log("Pause action failed.")}else this.wrapperNode.removeChild(this.videoNode),this.videoNode=""}},{key:"reAttachVideoNode",value:function(){if(this.config.autoplay)try{
this.videoNode.play()}catch(e){this.watcher.destroy(),this.logger.log("This element had a huge issue trying to do the play. Destroying watcher listeners ","warn")}else this.wrapperNode&&(this.generateVideoUrl(),this.videoNode=this.createVideoDom(),this.wrapperNode.appendChild(this.videoNode),v.browser.isSafari()&&this.videoData.sources.mp4.url.includes("short")&&this.coverBackgroundWithPoster(),this.resizeVideoNode(),this.videoListeners())}},{key:"generateVideoUrl",value:function(){var e=this.galleryData.domObject.querySelector(this.imgSelectorQuery);if(!e)return void this.logger.log("Cant generate video url. No valid image found","err");var t=e.clientWidth,i=t/e.clientHeight>=1.5;this.videoData=y.utils.getVideoUrl(this.galleryData.vilynxData,t,i),this.logger.log("Video url "+this.videoData.sources.mp4.url,"debug")}},{key:"coverBackgroundWithPoster",value:function(){this.wrapperNode&&(this.wrapperNode.style.backgroundImage="url( "+this.videoData.posterUrl+" )",this.wrapperNode.style.backgroundSize="cover",this.wrapperNode.style.backgroundPosition="center")}},{key:"createVideoDom",value:function(){var e=document.createElement("video"),t=document.createElement("source");return t.src=this.videoData.sources.mp4.url,t.type=this.videoData.sources.mp4.mime,e.appendChild(t),e.poster=this.videoData.posterUrl,e.preload="none",e.muted=!this.config.audio,e.countLoops=0,e.throttle=!0,e}},{key:"resizeVideoNode",value:function(){if(!this.config.isDisabled){try{this.videoNode.childNodes[0]}catch(e){return void this.logger.log("Cant resize video node. The video node seems to not be created")}var e=this.galleryData.domObject.querySelector(".vilynx_mainImg");if(!e)return void this.logger.log("Cant resize video node. No valid image found","err");var t=e.clientWidth,i=e.clientHeight,o=this.galleryData.domObject.querySelector(".vilynx_wrapperImg"),r=void 0,a="";0!==t&&0!==i&&(e.classList.contains("vilynx_img")?""!==e.style.backgroundImage&&(a=y.utils.extractBGImageFromNode(e)):a=e.currentSrc||e.src,a&&o.src!==a&&(o.src=a),this.setWrapperResize(),v.browser.isMsie()&&(r=this.videoData.is169&&this.config.isVertical===!1?16/9:4/3,t/r<i&&this.config.isVertical===!1?(this.videoNode.style.height=i+"px",this.videoNode.style.width=i*r+"px",this.videoNode.style.left=(t-i*r)/2+"px",this.videoNode.style.top=0):(this.videoNode.style.height=t/r+"px",this.videoNode.style.width=t+"px",this.videoNode.style.left=0,this.videoNode.style.top=(i-t/r)/2+"px",this.config.isVertical&&this.config.videoRatio&&(this.videoNode.style.height=t/this.config.videoRatio+"px",this.videoNode.style.top=Math.round((i-t/this.config.videoRatio)/2)+"px")),this.redirect&&this.redirect.setRedirectFontSize(e)))}}},{key:"createWrapperDom",value:function(){var e=void 0,t=window.getComputedStyle(this.galleryData.domObject),i=void 0;return e=document.createElement("div"),i=y.utils.createCopyImage(this.findMainImg()),e.appendChild(i),this.galleryData.domObject.insertBefore(e,this.galleryData.domObject.childNodes[0]),e.classList.add("supra-wrapper"),this.checkOtherElementszIndex(),"inline"===t.display&&v.browser.isMozilla()&&(this.galleryData.domObject.style.display="inline-block"),v.browser.isSafari()&&(i.style.transform="translateZ(0)"),e}},{key:"findMainImg",value:function(){var e=this.galleryData.domObject.querySelectorAll(this.imgSelectorQuery),t=void 0;return!!(t=y.utils.findActiveImage(e)||e[0])&&(t.classList.add("vilynx_mainImg"),this.config.noimage&&t.classList.add("vilynx-hide"),this.imageListeners(t),t)}},{key:"observeBackgroundImage",value:function(){var e=this,t=void 0,i=this.galleryData.domObject.querySelector(".vilynx_mainImg");t=new MutationObserver(function(){if(""!==i.style.backgroundImage){var t=y.utils.extractBGImageFromNode(i),o=e.galleryData.domObject.querySelector(".vilynx_wrapperImg").src;e.logger.log("Div with background now have url, proceed to assign src in wrapperImg"),t!==o&&(e.galleryData.domObject.querySelector(".vilynx_wrapperImg").src=t,e.resizeVideoNode())}}),t.observe(i,{attributes:!0,characterData:!0})}},{key:"observeOriginalImage",value:function(){var e=this,t=this.galleryData.domObject.querySelector(".vilynx_mainImg");t.addEventListener("load",function(){var i=t.currentSrc||t.src,o=e.galleryData.domObject.querySelector(".vilynx_wrapperImg").src;i!==o&&(e.galleryData.domObject.querySelector(".vilynx_wrapperImg").src=i,e.resizeVideoNode())})}},{key:"observeVilynxId",value:function(){var e=this,t=this.galleryData.domObject,i=new MutationObserver(function(){var t=[e.galleryData.domObject];e.finder.privateScan(null,t,e)}),o=["vilynx-id","data-vilynx-id"];u.default.idattribute&&o.push(u.default.idattribute),i.observe(t,{attributes:!0,attributeFilter:o})}},{key:"refreshVideoNode",value:function(){this.videoNode&&this.cleanVideoNode(),this.generateVideoUrl(),this.reAttachVideoNode()}},{key:"checkOtherElementszIndex",value:function(){var e=this,t=this.galleryData.domObject.getElementsByTagName("*"),i=2;[].forEach.call(t,function(t){var o=window.getComputedStyle(t);1!==t.nodeType||"absolute"!==o.position&&"relative"!==o.position||t.classList.contains("vilynx_registered")||t.classList.contains("supra-wrapper")||t.classList.contains("vilynx_mainImg")||""!==o.zIndex&&"1"!==o.zIndex&&"auto"!==o.zIndex||0===t.querySelectorAll(".vilynx_mainImg").length&&(e.logger.log("Absolute positioned element found, setting zIndex: "+i),t.style.zIndex=i)})}},{key:"appendSocialWidget",value:function(){this.widget=new d.default(this.galleryData),this.wrapperNode.appendChild(this.widget.getWidget())}},{key:"mouseMoveListeners",value:function(){var e=this,t=this.galleryData.domObject.querySelector(".vilynx_wrapperImg"),i=void 0;i=this.galleryData.domObject,i.addEventListener("mouseover",function(){if(t=e.galleryData.domObject.querySelector(".vilynx_wrapperImg"),!e.config.isDisabled)if(e.config.autoplay){if(!e.videoNode.paused&&e.config.pauseonhover){e.resizeVideoNode();try{e.videoNode.pause()}catch(t){e.logger.log("Pause action failed.")}e.videoNode.currentTime=0,t.classList.remove("vilynx_fading"),e.config.pausehoveronce&&(e.galleryData.domObject.classList.remove("vilynx_autoplay"),e.galleryData.domObject.classList.remove("vilynx_pauseonhover"),e.config.pauseonhover=!1,e.disableAutoplay())}}else e.videoNode.paused&&!e.sharingActive?e.playVideo(t):e.sharingActive===!0&&(e.sharingActive=!1)}),i.addEventListener("mouseleave",function(t){var i=!1;e.config.isDisabled||([].forEach.call(e.allIgnores,function(e){(t.relatedTarget===e||e.contains(t.relatedTarget))&&(i=!0)}),i||v.browser.isSafari()&&e.galleryData.domObject.matches(":hover")||e.doMouseLeave())})}},{key:"playVideo",value:function(e){var t=this;e.parentElement.classList&&e.parentElement.classList.contains("vilynx-hide")&&this.setWrapperResize(),this.resizeVideoNode(),this.videoNode.muted=!this.config.audio,v.browser.isSafari()&&v.browser.isSafari()<=9?this.tmp.fadeInterval||(this.tmp.fadeInterval=setInterval(function(){!t.videoNode.paused&&t.videoNode.currentTime>.01&&(e.classList.add("vilynx_fading"),clearInterval(t.tmp.fadeInterval),t.tmp.fadeInterval=!1)},50)):e.classList.add("vilynx_fading"),this.config.sharewidget&&(this.galleryData.domObject.querySelector("#sharewidget").style.display="block"),this.logger.log("Video play","timeStart");try{this.videoNode.play()}catch(e){this.logger.log("Play action failed.")}this.mixpanel.trackShowPlayer(),f.exposed.getOnPlay().forEach(function(e){e()}),this.trackSummaryPlayTimeout=setTimeout(function(){t.videoNode.paused||t.mixpanel.trackSummaryPlay()},500)}},{key:"doMouseLeave",value:function(e){var t=this,i=void 0,o=void 0;if(o=this.galleryData.domObject,i=this.galleryData.domObject.querySelector(".vilynx_wrapperImg"),this.config.autoplay&&this.config.pauseonhover)i.classList.add("vilynx_fading");else if(!this.config.autoplay){clearInterval(this.tmp.fadeInterval),this.tmp.fadeInterval=!1,this.videoNode.currentTime>.5&&!e&&this.mixpanel.trackViewDuration("mouseleave",this.videoNode.currentTime);try{this.videoNode.pause(),v.browser.isSafari()?this.videoNode.currentTime=.01:this.videoNode.currentTime=0,this.videoNode.countLoops-=1}catch(e){this.logger.log("Pause action failed.")}clearTimeout(this.trackSummaryPlayTimeout),e||this.onVideoCancel.forEach(function(e){e(t)}),f.exposed.getOnStop().forEach(function(e){e()}),this.config.sharewidget&&(this.widget.closeWidget(),o.querySelector("#sharewidget").style.display="none"),i.classList.remove("vilynx_fading"),this.wrapperNode.style.zIndex="",this.videoNode&&(this.videoNode.style.zIndex="")}}},{key:"setVideoAutoplay",value:function(){var e=this,t=this.galleryData.domObject.querySelector(".vilynx_wrapperImg");this.resizeVideoNode(),this.videoNode.loop=!0,this.videoNode.muted=!0,window.setTimeout(function(){try{e.videoNode.play()}catch(t){e.logger.log("Play action failed.")}t.classList.add("vilynx_fading")},100),this.logger.log("Autoplay video starts to play")}},{key:"responsiveListeners",value:function(){var e=this,t=this.galleryData.domObject.querySelector(".vilynx_mainImg"),i=void 0;window.addEventListener("resize",function(){e.requestPreviewResize()}),v.browser.isSafari()&&this.redirect&&window.addEventListener("beforeunload",function(){e.redirect.hideRedirectWrapper(e)}),this.imageListeners(t),i=new MutationObserver(function(){if(t=e.galleryData.domObject.querySelector(".vilynx_mainImg"),!t){var i=void 0;i=e.reassignTargetImage(),i&&(e.setWrapperResize(),e.resizeVideoNode())}}),i.observe(t.parentNode,{childList:!0}),u.default.resizeonscroll&&window.addEventListener("scroll",function(){e.requestPreviewResize()})}},{key:"imageListeners",value:function(e){var t=this;if(!this.observedImage||this.observedImage!==e){var i=new MutationObserver(function(){t.videoNode&&(t.setWrapperResize(),t.resizeVideoNode())});i.observe(e,{attributes:!0,characterData:!0}),this.logger.log("Vilynx_mainImg has changed, observing new image"),this.tmp.imageObserver&&this.tmp.imageObserver.disconnect(),this.observedImage&&this.observedImage.removeEventListener("transitionend",this.endTransition),e.addEventListener("transitionend",function(e){t.endTransition(e)}),this.tmp.imageObserver=i,this.observedImage=e}}},{key:"endTransition",value:function(e){var t=["all","top","right","bottom","left","margin-right","margin-left","width","height","size","weight"],i=e.propertyName,o=t.some(function(e){return i===e});o&&(this.logger.log("transition of type "+i+" has ended. Resizing"),this.requestPreviewResize())}},{key:"requestPreviewResize",value:function(){var e=this;this.resizeTimeout&&window.cancelAnimationFrame(this.resizeTimeout),this.resizeTimeout=window.requestAnimationFrame(function(){e.setWrapperResize(),e.resizeVideoNode()})}},{key:"setWrapperResize",value:function(){var e=this.reassignTargetImage();if(!e)return this.logger.log("No valid image found","err"),void(this.galleryData.domObject&&this.galleryData.domObject.querySelector&&this.galleryData.domObject.querySelector(".supra-wrapper")&&this.galleryData.domObject.querySelector(".supra-wrapper").classList.add("vilynx-hide"));this.setWrapperStyles();var t=y.utils.getTargetImgSize(e);this.wrapperNode.style.width=t.width+"px",this.wrapperNode.style.height=t.height+"px",this.redirect&&(this.redirect.setHeight(t.height),this.redirect.setRedirectFontSize(e))}},{key:"reassignTargetImage",value:function(){var e=this.galleryData.domObject.querySelector(".vilynx_mainImg");if(!e){if(e=this.findMainImg(),!e)return!1;this.galleryData.domObject.querySelector(".vilynx_wrapperImg").src=e.src}var t=e.clientWidth,i=e.clientHeight;if(0===t||0===i){this.logger.log("vilynx_mainImg is too small '"+t+"x"+i+"' searching a new image","warn");var o=this.galleryData.domObject.querySelectorAll(this.imgSelectorQuery),r=this.galleryData.domObject.querySelector(".vilynx_wrapperImg"),a=void 0;if(a=y.utils.findActiveImage(o),!a||a.naturalWidth<2&&!this.config.autoplay)return!1;e.classList.remove("vilynx_mainImg"),a.classList.add("vilynx_mainImg"),r.src=a.src,e=a,this.imageListeners(e),this.logger.log("Found new valid image updated vilynx_mainImg & src","warn")}return e}},{key:"setWrapperStyles",value:function(){var e=this.galleryData.domObject.querySelector(".vilynx_mainImg"),t=window.getComputedStyle(e);this.galleryData.domObject.querySelector(".supra-wrapper").classList.contains("vilynx-hide")&&(this.logger.log("Supra-wrapper was hidden but now is shown again","warn"),this.galleryData.domObject.querySelector(".supra-wrapper").classList.remove("vilynx-hide")),(t.cssFloat||t.float)&&(this.wrapperNode.style.float=t.cssFloat||t.float),t.marginLeft||t.marginRight||t.marginTop||t.marginBottom?(this.wrapperNode.style.marginLeft=t.marginLeft,this.wrapperNode.style.marginRight=t.marginRight,this.wrapperNode.style.marginTop=t.marginTop,this.wrapperNode.style.marginBottom=t.marginBottom):t.cssMargin&&(this.wrapperNode.style.margin=t.cssMargin.replace(",",".")),"none"===window.getComputedStyle(e.parentNode).maxHeight?this.wrapperNode.style.maxHeight="none":this.wrapperNode.style.maxHeight=window.getComputedStyle(e.parentNode).maxHeight,t.display.indexOf("inline")!==-1&&(e.style.display="block")}},{key:"mouseClickListeners",value:function(){var e=this,t=this.galleryData.domObject;t.addEventListener("click",function(t){e.onMouseClick(t)})}},{key:"onMouseClick",value:function(e){if(!this.config.isDisabled)if(!this.widget||e.path.indexOf(this.widget.shareGrid)<0){if(u.default.optimizely&&u.default.optimizelyoff||u.default.passivetracking)return void this.mixpanel.trackVideoPlay(!0);if(this.mixpanel.trackVideoPlay(),this.videoNode.currentTime>.5){var t=this.videoNode.currentTime;this.config.redirect&&this.redirect&&"table"===this.redirect.redirectDom.style.display&&this.redirect.timeOuts!=={}?t+=this.config.duration:this.config.autoplay&&(t=this.videoNode.countLoops*this.config.duration+t,this.logger.log("Autoplay engagementTime: "+t+"\n                    countLoops: "+this.videoNode.countLoops)),this.mixpanel.trackViewDuration("click",t)}}else e.stopPropagation(),this.sharingActive=!0,this.doMouseLeave(!0)}},{key:"videoListeners",value:function(){var e=this;0===this.config.duration&&this.videoNode.addEventListener("loadedmetadata",function(){e.logger.log("Video metadata ready, duration is: "+e.videoNode.duration),e.config.duration=e.videoNode.duration,e.config.videoRatio=e.videoNode.videoWidth/e.videoNode.videoHeight,e.config.videoRatio<1&&(e.logger.log("Video vertical found!"),e.config.isVertical=!0,e.setWrapperResize(),e.resizeVideoNode())}),this.videoNode.addEventListener("timeupdate",function(){var t=e.videoNode.currentTime;0===t&&(e.videoNode.throttle&&(e.videoNode.throttle=!1,e.videoNode.countLoops+=1,e.logger.log("Loop count: "+e.videoNode.countLoops)),setTimeout(function(){e.videoNode&&(e.videoNode.throttle=!0)},500))}),this.videoNode.addEventListener("play",function(){e.logger.log("Video play","timeEnd")}),this.videoNode.addEventListener("ended",function(){if(e.videoNode.muted=e.config.audioonce||!e.config.audio,!e.config.autoplay){e.videoNode.currentTime=0;try{e.videoNode.play()}catch(t){e.logger.log("Play action failed.")}e.logger.log("Video Ended, calling onEnd function stack"),e.onVideoEnd.forEach(function(t){t(e)})}})}},{key:"ignoreElementListeners",value:function(e){var t=this,i=this.galleryData.domObject.querySelector(this.imgSelectorQuery),o=void 0;o=this.galleryData.domObject,e.addEventListener("mouseover",function(){i=t.galleryData.domObject.querySelector(t.imgSelectorQuery),t.config.autoplay||t.videoNode.paused&&(t.tmp.waitToWrapperTimeout||(t.tmp.waitToWrapperTimeout=setTimeout(function(){t.playVideo(i)},10)))}),e.addEventListener("mouseleave",function(e){if(!t.config.autoplay){o=t.galleryData.domObject;var i=!1;[].forEach.call(t.allIgnores,function(t){(e.relatedTarget===t||t.contains(e.relatedTarget))&&(i=!0)}),e.relatedTarget===o||o.contains(e.relatedTarget)||i||t.videoNode.paused||t.doMouseLeave()}})}},{key:"addConfigListener",value:function(){var e=this;this.oldClasses=this.galleryData.domObject.getAttribute("class")||"";var t=this.galleryData.domObject,i={childList:!1,attributes:!0,characterData:!1,subtree:!1,attributeOldValue:!0},o=void 0;o=new MutationObserver(function(){e.listenConfigChanges()}),o.observe(t,i)}},{key:"listenConfigChanges",value:function(){this.config.autoplay&&this.oldClasses&&this.oldClasses.indexOf("vilynx_autoplay")!==-1&&!this.galleryData.domObject.classList.contains("vilynx_autoplay")?(this.logger.log("vilynx_autoplay class removed: Disable autoplay"),this.disableAutoplay()):!this.config.autoplay&&this.oldClasses&&this.oldClasses.indexOf("vilynx_autoplay")===-1&&this.galleryData.domObject.classList.contains("vilynx_autoplay")&&(this.logger.log("vilynx_autoplay class added: Enable autoplay"),this.enableAutoplay()),u.default.disableall?this.config.isDisabled?(this.galleryData.domObject.classList.contains("vilynx_enabled")||this.galleryData.domObject.classList.contains("teaser_enabled"))&&(this.logger.log("vilynx_enabled/teaser_enabled class added: Enable Gallery item"),this.enableNow()):this.galleryData.domObject.classList.contains("vilynx_enabled")||this.galleryData.domObject.classList.contains("teaser_enabled")||(this.logger.log("vilynx_enabled/teaser_enabled class removed: Disable Gallery item"),this.disableNow()):this.config.isDisabled?this.galleryData.domObject.classList.contains("vilynx_disabled")||(this.logger.log("vilynx_disabled class removed: Enable Gallery item"),this.enableNow()):this.galleryData.domObject.classList.contains("vilynx_disabled")&&(this.logger.log("vilynx_disabled class added: Disable Gallery item"),this.disableNow()),this.oldClasses=this.galleryData.domObject.getAttribute("class")||""}},{key:"enableNow",value:function(){var e=this.galleryData.domObject.querySelector(".vilynx_wrapperImg");this.config.isDisabled=!1,this.watcher.isInViewport&&this.reAttachVideoNode(),this.config.autoplay&&e.classList.add("vilynx_fading")}},{key:"disableNow",value:function(){var e=this.galleryData.domObject.querySelector(".vilynx_wrapperImg");this.config.isDisabled=!0,e.classList.remove("vilynx_fading"),this.watcher.isInViewport&&this.cleanVideoNode()}},{key:"enableAutoplay",value:function(){if(this.config.autoplay=!0,this.redirect&&(this.wrapperNode.removeChild(this.redirect.redirectDom),this.redirect=null),this.watcher.isInViewport)this.setVideoAutoplay();else if(this.wrapperNode){this.generateVideoUrl(),this.videoNode=this.createVideoDom(),this.wrapperNode.appendChild(this.videoNode),this.resizeVideoNode(),this.videoListeners();var e=this.galleryData.domObject.querySelector(".vilynx_wrapperImg");e.classList.add("vilynx_fading")}}},{key:"disableAutoplay",value:function(){var e=this,t=this.galleryData.domObject.querySelector(".vilynx_wrapperImg");if(this.config.autoplay=!1,this.videoNode.loop=!1,t.classList.remove("vilynx_fading"),this.watcher.isInViewport&&this.videoNode){try{this.videoNode.pause()}catch(e){this.logger.log("Pause action failed.")}this.videoNode.currentTime=0}if(this.config.redirect&&(this.redirect=new h.default(this),this.wrapperNode.appendChild(this.redirect.createRedirectDom()),this.onVideoEnd.push(this.redirect.showRedirectWrapper),this.onVideoCancel.push(this.redirect.hideRedirectWrapper),this.redirect.setRedirectFontSize(t)),u.default.divignore){var i=this.galleryData.domObject;if(u.default.divignorelevels)for(var o=0;o<parseInt(u.default.divignorelevels,10);o++)i=i.parentNode;this.allIgnores=i.querySelectorAll(u.default.divignore),[].forEach.call(this.allIgnores,function(t){e.ignoreElementListeners(t)})}}}]),e}();i.default=w},{"../../config/globalConfig":2,"../finder":6,"../helpers/browser":12,"../helpers/exposed":13,"../helpers/scrollMonitor":16,"../mixpanel":21,"../shareWidget":22,"./blocks/redirect":7,"./blocks/utils":8}],10:[function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var l=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),s=e("./desktopGallery"),d=o(s),c=e("./mobileGallery"),u=o(c),g=e("../helpers/galleryLogger"),h=o(g),f=e("../helpers/browser"),p=e("../../config/galleryItemConfig"),v=o(p),y=e("../../config/globalConfig"),m=o(y),w=e("../helpers/exposed"),b=function(e){function t(e){r(this,t);var i=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),o=!1;i.logger=new h.default(i.debugId),i.galleryData=e,m.default.debug&&e.domObject.setAttribute("vlx_dbg",i.debugId),m.default.ongalleryload&&w.exposed.getOnLoadGalleryItem().length>0&&w.exposed.getOnLoadGalleryItem().forEach(function(e){e(i.galleryData.domObject)});try{o=i.loadConfig()}catch(e){i.logger.log("Exception raised while loading the item config. Aborting item execution. Stack trace: ","err"),i.logger.log(e,"err")}if(o)try{f.browser.isMobile()?new u.default(e,i.config,i.logger):new d.default(e,i.config,i.logger)}catch(e){i.logger.log("Exception raised while processing the gallery item. Aborting item execution. Stack trace:","err"),i.logger.log(e,"err")}return i}return n(t,e),l(t,[{key:"loadConfig",value:function(){var e=this,t=this.galleryData.domObject;return t?([].forEach.call(t.classList,function(t){t=t.substr(7),"undefined"==typeof e.config[t]?e.logger.log("Gallery item Config register not found: "+t,"warn"):(e.config[t]=!0,e.logger.log("Gallery item Config element loaded: "+t,"debug"))}),Object.keys(t.attributes).forEach(function(i){var o=t.attributes[i];if(o){var r=o.name.replace("data-","");"undefined"!=typeof e.config[r]&&(e.config[r]=o.value)}}),!0):(this.logger.log("Element not detected","warn"),!1)}}]),t}(v.default);i.default=b},{"../../config/galleryItemConfig":1,"../../config/globalConfig":2,"../helpers/browser":12,"../helpers/exposed":13,"../helpers/galleryLogger":14,"./desktopGallery":9,"./mobileGallery":11}],11:[function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),n=e("../../config/globalConfig"),l=o(n),s=e("../mixpanel"),d=o(s),c=e("../helpers/scrollMonitor"),u=e("../helpers/viewportQueue"),g=e("../../config/privateConfig"),h=o(g),f=e("../helpers/browser"),p=e("./blocks/utils"),v=e("../finder"),y=function(){function e(t,i,o){if(r(this,e),this.nTry=0,this.logger=o,this.finder=v.finder,this.config=i,this.galleryData=t,this.onVideoEnd=[],this.onVideoCancel=[],this.mixpanel=new d.default(t,"mobile"),this.mouseClickListeners(),this.listenConfigChanges(),this.observeVilynxId(),l.default.optimizelyoff||l.default.passivetracking)this.watchThumbnailShown(),this.logger.log("Optimizely OFF variation","warn");else if(l.default.ingnoreelementheight||0!==this.galleryData.domObject.clientHeight)if(t.domObject.querySelector(".vilynx_img")?this.imgSelectorQuery=".vilynx_img:not(.vilynx_wrapperImg)":(this.imgSelectorQuery="img:not(.vilynx_wrapperImg)",l.default.imgignore&&(this.imgSelectorQuery="img:not("+l.default.imgignore+"):not(.vilynx_wrapperImg)")),l.default.allautoplay)if(f.browser.isIos()){var a=void 0,n=void 0;if(a=this.galleryData.domObject.querySelectorAll("img"),n=a[a.length-1],n&&l.default.customimgsrc)this.oldImageUrl=n[l.default.customimgsrc];else if(n)this.oldImageUrl=n.src;else{var s=this.galleryData.domObject.querySelectorAll(this.imgSelectorQuery),c=void 0;if(c=p.utils.findActiveImage(s),!c)return void this.logger.log("No valid image found","err");c.classList.add("vilynx_mainImg");var u=this.galleryData.domObject.querySelector(".vilynx_mainImg"),g=p.utils.extractBGImageFromNode(u);this.oldImageUrl=g}this.generateGifUrl(),this.monitorizeGif()}else this.monitorizeMp4();else this.monitorizeOneAutoplay();else this.logger.log("Element height is 0, Aborting!!!","warn")}return a(e,[{key:"listenConfigChanges",value:function(){var e=this,t=this.galleryData.domObject,i={childList:!1,attributes:!0,characterData:!1,subtree:!1,attributeOldValue:!0},o=void 0;o=new MutationObserver(function(){l.default.disableall?e.config.isDisabled?(e.galleryData.domObject.classList.contains("vilynx_enabled")||e.galleryData.domObject.classList.contains("teaser_enabled"))&&(e.logger.log("vilynx_enabled/teaser_enabled class added: Enable Gallery item"),e.enableNow()):e.galleryData.domObject.classList.contains("vilynx_enabled")||e.galleryData.domObject.classList.contains("teaser_enabled")||(e.logger.log("vilynx_enabled/teaser_enabled class removed: Disable Gallery item"),e.disableNow()):e.config.isDisabled?e.galleryData.domObject.classList.contains("vilynx_disabled")||(e.logger.log("vilynx_disabled class removed: Enable Gallery item"),e.enableNow()):e.galleryData.domObject.classList.contains("vilynx_disabled")&&(e.logger.log("vilynx_disabled class added: Disable Gallery item"),e.disableNow())}),o.observe(t,i)}},{key:"enableNow",value:function(){this.config.isDisabled=!1,this.watcher.isInViewport&&(l.default.allautoplay?this.initOrReattachGallery():u.viewportQueue.addToViewportQueue(this,this.watcher.top,!1))}},{key:"disableNow",value:function(){var e=this.galleryData.domObject.querySelector(".vilynx_wrapperImg");this.config.isDisabled=!0,e.classList.remove("vilynx_fading"),this.watcher.isInViewport&&this.wrapperNode&&this.videoNode?this.cleanVideoNode():u.viewportQueue.removeFromViewportQueue(this)}},{key:"monitorizeGif",value:function(){var e=this,t=0;parseFloat(l.default.previewdelay)&&(t=parseFloat(l.default.previewdelay)),(void 0===window.scrollMonitor||!window.scrollMonitor.version||window.scrollMonitor.version<c.scrollMonitor.version)&&c.scrollMonitor.reFactory(),this.watcher=window.scrollMonitor.create(this.galleryData.domObject),this.watcher.enterViewport(function(){e.logger.log("Entering Viewport"),setTimeout(function(){e.watcher.isInViewport&&(e.logger.log("User stops scrolling"),e.showGif())},1e3*t+300)}),this.watcher.exitViewport(function(){e.logger.log("Exiting Viewport"),e.hideGif()})}},{key:"monitorizeMp4",value:function(){var e=this;(void 0===window.scrollMonitor||!window.scrollMonitor.version||window.scrollMonitor.version<c.scrollMonitor.version)&&c.scrollMonitor.reFactory(),this.watcher=window.scrollMonitor.create(this.galleryData.domObject),this.watcher.enterViewport(function(){e.initOrReattachGallery()}),this.watcher.exitViewport(function(){e.wrapperNode&&e.videoNode&&(e.logger.log("Exiting Viewport"),e.cleanVideoNode())})}},{key:"monitorizeOneAutoplay",value:function(){var e=this,t=!1;!l.default.pulltochange&&!l.default.followscroll||l.default.scrollListenerAdded||(l.default.scrollListenerAdded=!0,u.viewportQueue.followScrollListener()),(void 0===window.scrollMonitor||!window.scrollMonitor.version||window.scrollMonitor.version<c.scrollMonitor.version)&&c.scrollMonitor.reFactory(),this.watcher=window.scrollMonitor.create(this.galleryData.domObject,{top:parseInt(l.default.topviewportoffset,10),bottom:parseInt(l.default.bottomviewportoffset,10)}),"false"!==l.default.mobilepreload&&(this.watcher.canPreload(function(){e.config.isDisabled||e.videoNode||0===e.galleryData.domObject.offsetHeight||u.viewportQueue.addToLoadedQueue(e)}),this.watcher.canUnload(function(){e.videoNode&&u.viewportQueue.removeToLoadedQueue(e)}),this.watcher.enterViewport(function(){e.videoNode||u.viewportQueue.addToLoadedQueue(e)})),this.watcher.fullyEnterViewport(function(){if(e.watcher.isInViewport){if(e.config.isDisabled)return void e.logger.log("Element is disabled, ignore watcher event");e.mixpanel.trackThumbnailShown(),l.default.initmobilequeue&&(l.default.initmobilequeue=!1,t=!0),"false"===l.default.mobilepreload?u.viewportQueue.addToViewportQueue(e,e.watcher.top,t):(e.logger.log("Video added to viewportQueue"),e.videoNode||u.viewportQueue.addToLoadedQueue(e),u.viewportQueue.addToViewportQueue(e,e.watcher.top,t))}}),this.watcher.partiallyExitViewport(function(){return e.config.isDisabled?void e.logger.log("Element is disabled, ignore watcher event"):(e.logger.log("Exiting Viewport"),h.default.scrollDirection=e.watcher.isAboveViewport,void(e.wrapperNode&&e.videoNode&&"false"===l.default.mobilepreload?e.cleanVideoNode():(u.viewportQueue.removeFromViewportQueue(e),u.viewportQueue.playNextInQueue(e.watcher.isAboveViewport,e.watcher.isBelowViewport))))})}},{key:"initOrReattachGallery",value:function(e){void 0===e&&(e=!0);var t=this.galleryData.domObject.classList.contains("vilynx_registered");return this.watcher.top<0||0===this.watcher.bottom?void this.logger.log("Element not really in viewport"):void(t?t&&!this.videoNode&&(this.logger.log("reAttachVideoNode again"),this.reAttachVideoNode(e)):(this.logger.log("Entering viewport for first time"),this.initGallery(e)))}},{key:"logMessage",value:function(e){this.logger.log(e)}},{key:"initGallery",value:function(e){this.galleryData.domObject.classList.add("vilynx_registered"),this.galleryData.domObject.classList.add("vilynx_activeSummary"),this.generateVideoUrl(),this.videoNode=this.createVideoDom(),this.wrapperNode=this.createWrapperDom(),this.wrapperNode.appendChild(this.videoNode),this.animateResize(),this.watcher.watchItem=this.wrapperNode,l.default.mobilecta&&(this.wrapperNode.appendChild(this.createRedirectDom()),this.onVideoEnd.push(this.showRedirectWrapper),this.onVideoCancel.push(this.hideRedirectWrapper));var t=this.galleryData.domObject.querySelector(".vilynx_mainImg");t.classList.contains("vilynx_img")?this.observeBackgroundImage():this.observeOriginalImage(),this.resizeVideoNode(),e&&this.showVideoNode(),this.videoListeners(),this.responsiveListeners()}},{key:"observeBackgroundImage",value:function(){var e=this,t=void 0,i=this.galleryData.domObject.querySelector(".vilynx_mainImg");t=new MutationObserver(function(){if(""!==i.style.backgroundImage){var t=p.utils.extractBGImageFromNode(i),o=e.galleryData.domObject.querySelector(".vilynx_wrapperImg").src;e.logger.log("Div with background now have url, proceed to assign src in wrapperImg"),t!==o&&(e.galleryData.domObject.querySelector(".vilynx_wrapperImg").src=t,e.resizeVideoNode())}}),t.observe(i,{attributes:!0,characterData:!0})}},{key:"observeOriginalImage",value:function(){var e=this,t=this.galleryData.domObject.querySelector(".vilynx_mainImg");t.addEventListener("load",function(){var i=t.currentSrc||t.src,o=e.galleryData.domObject.querySelector(".vilynx_wrapperImg").src;i!==o&&(e.galleryData.domObject.querySelector(".vilynx_wrapperImg").src=i,e.resizeVideoNode())})}},{key:"observeVilynxId",value:function(){var e=this,t=this.galleryData.domObject,i=new MutationObserver(function(){var t=[e.galleryData.domObject];e.finder.privateScan(null,t,e),e.refreshVideoNode()}),o=["vilynx-id","data-vilynx-id"];l.default.idattribute&&o.push(l.default.idattribute),i.observe(t,{attributes:!0,attributeFilter:o})}},{key:"refreshVideoNode",value:function(){this.videoNode&&this.cleanVideoNode(),this.generateVideoUrl(),this.initOrReattachGallery(!0)}},{key:"checkOtherElementszIndex",value:function(){var e=this,t=this.galleryData.domObject.getElementsByTagName("*"),i=2;[].forEach.call(t,function(t){var o=window.getComputedStyle(t);1!==t.nodeType||"absolute"!==o.position&&"relative"!==o.position||t.classList.contains("vilynx_registered")||t.classList.contains("supra-wrapper")||t.classList.contains("vilynx_mainImg")||""!==o.zIndex&&"1"!==o.zIndex&&"auto"!==o.zIndex||0===t.querySelectorAll(".vilynx_mainImg").length&&(e.logger.log("Absolute positioned element found, setting zIndex: "+i),
t.style.zIndex=i)})}},{key:"generateVideoUrl",value:function(){var e=this.galleryData.domObject.querySelector(this.imgSelectorQuery),t=e.clientWidth,i=t/e.clientHeight>=1.5;this.videoData=p.utils.getVideoUrl(this.galleryData.vilynxData,t,i),this.logger.log("Video url "+this.videoData.sources.mp4.url,"debug")}},{key:"createVideoDom",value:function(){var e=document.createElement("video"),t=document.createElement("source");return t.src=this.videoData.sources.mp4.url,t.type=this.videoData.sources.mp4.mime,e.appendChild(t),e.poster=this.videoData.posterUrl,e.setAttribute("playsinline","true"),e.muted=!0,parseFloat(l.default.previewdelay)||"false"!==l.default.mobilepreload||e.setAttribute("autoplay","true"),e.setAttribute("loop","true"),e.countLoops=0,e.throttle=!0,e}},{key:"showVideoNode",value:function(){var e=this;this.logger.log("Showing video node");var t=function t(){if(e.videoNode)if(e.watcher.isFullyInViewport){(l.default.previewdelay||"false"!==l.default.mobilepreload)&&(e.videoNode.parentNode||(e.videoNode=e.wrapperNode.querySelector("video")),f.browser.isIos()&&(e.videoNode.currentTime=.1,e.videoNode.countLoops=-1),e.videoNode.play());var i=e.galleryData.domObject.querySelector(".vilynx_wrapperImg");e.logger.log("Canplay callback, adding vilynx_fading class"),i.classList.add("vilynx_fading"),e.videoNode.removeEventListener("canplaythrough",t),e.mixpanel.trackShowPlayer(),e.trackSummaryPlayTimeout=setTimeout(function(){e.logger.log("Optimizely summary_play tracking"),e.mixpanel.trackSummaryPlay()},500)}else e.stopVideoPlaying()};this.videoNode.readyState>3&&"false"!==l.default.mobilepreload?t():parseFloat(l.default.previewdelay)?setTimeout(function(){e.videoNode&&(e.videoNode.readyState>3||f.browser.isIos()?t():e.videoNode.addEventListener("canplaythrough",t))},1e3*l.default.previewdelay):(f.browser.isIos()&&"false"!==l.default.mobilepreload&&(this.videoNode.countLoops=-1,0===this.videoNode.readyState?setTimeout(function(){e.videoNode&&e.watcher.isFullyInViewport&&(e.logger.log("readyState 0 -> replaying"),e.videoNode.play())},500):setTimeout(this.videoNode.play(),20)),this.videoNode.addEventListener("canplaythrough",t))}},{key:"resizeVideoNode",value:function(){if(!this.config.isDisabled){try{this.videoNode.childNodes[0]}catch(e){return void this.logger.log("Cant resize video node. The video node seems to not be created")}var e=this.galleryData.domObject.querySelector(".vilynx_mainImg"),t=e.clientWidth,i=e.clientHeight,o=this.galleryData.domObject.querySelector(".vilynx_wrapperImg"),r=void 0,a="";0!==t&&0!==i&&(e.classList.contains("vilynx_img")?""!==e.style.backgroundImage&&(a=p.utils.extractBGImageFromNode(e)):a=e.currentSrc||e.src,a&&o.src!==a&&(o.src=a),this.animateResize(),f.browser.isWindowsMobile()&&(r=this.videoData.is169?16/9:4/3,t/r<i?(this.videoNode.style.height=i+"px",this.videoNode.style.width=i*r+"px",this.videoNode.style.left=(t-i*r)/2+"px",this.videoNode.style.top=0):(this.videoNode.style.height=t/r+"px",this.videoNode.style.width=t+"px",this.videoNode.style.left=0,this.videoNode.style.top=(i-t/r)/2+"px")))}}},{key:"animateResize",value:function(e){var t=this.reassignTargetImage();if(!t)return this.logger.log("No valid image found","err"),void this.galleryData.domObject.querySelector(".supra-wrapper").classList.add("vilynx-hide");var i=this.galleryData.domObject.querySelector(".vilynx_wrapperImg"),o=i.getBoundingClientRect(),r=!e||e.width!==o.width||e.height!==o.height;r&&(e=p.utils.getTargetImgSize(t),this.setWrapperResize(),window.requestAnimationFrame(this.animateResize.bind(this,e)))}},{key:"setWrapperResize",value:function(){var e=this.reassignTargetImage();this.setWrapperStyles();var t=p.utils.getTargetImgSize(e);this.wrapperNode.style.width=t.width+"px",this.wrapperNode.style.height=t.height+"px",this.redirect&&(this.redirect.dom.querySelector(".redirectCenter").style.height=t.height+"px")}},{key:"reassignTargetImage",value:function(){var e=this,t=this.galleryData.domObject.querySelector(".vilynx_mainImg");if(!t){if(t=this.findMainImg(),!t)return!1;this.galleryData.domObject.querySelector(".vilynx_wrapperImg").src=t.src}var i=t.clientWidth,o=t.clientHeight;if(0===i||0===o){this.logger.log("vilynx_mainImg is too small '"+i+"x"+o+"' searching a new image","warn");var r=this.galleryData.domObject.querySelectorAll(this.imgSelectorQuery),a=this.galleryData.domObject.querySelector(".vilynx_wrapperImg"),n=void 0;if(n=p.utils.findActiveImage(r),!n)return this.nTry<5&&setTimeout(function(){e.nTry++,e.animateResize()},200),!1;t.classList.remove("vilynx_mainImg"),n.classList.add("vilynx_mainImg"),a.src=n.src,t=n,this.imageListeners(t),this.logger.log("Found new valid image updated vilynx_mainImg & src","warn")}return t}},{key:"setWrapperStyles",value:function(){var e=this.galleryData.domObject.querySelector(".vilynx_mainImg"),t=window.getComputedStyle(e);this.galleryData.domObject.querySelector(".supra-wrapper").classList.contains("vilynx-hide")&&(this.logger.log("Supra-wrapper was hidden but now is shown again","warn"),this.galleryData.domObject.querySelector(".supra-wrapper").classList.remove("vilynx-hide")),(t.cssFloat||t.float)&&(this.wrapperNode.style.float=t.cssFloat||t.float),t.margin?this.wrapperNode.style.margin=t.margin.replace(",","."):t.cssMargin&&(this.wrapperNode.style.margin=t.cssMargin.replace(",",".")),"none"===window.getComputedStyle(e.parentNode).maxHeight?this.wrapperNode.style.maxHeight="none":this.wrapperNode.style.maxHeight=window.getComputedStyle(e.parentNode).maxHeight,t.display.indexOf("inline")!==-1&&(e.style.display="block")}},{key:"createWrapperDom",value:function(){var e=void 0,t=this.galleryData.domObject.querySelectorAll(this.imgSelectorQuery),i=t[0],o=void 0;if(i=p.utils.findActiveImage(t)||i,e=document.createElement("div"),i.classList.add("vilynx_mainImg"),o=p.utils.createCopyImage(this.findMainImg()),e.appendChild(o),this.galleryData.domObject.insertBefore(e,this.galleryData.domObject.childNodes[0]),e.classList.add("supra-wrapper"),this.checkOtherElementszIndex(),"absolute"!==window.getComputedStyle(this.galleryData.domObject).position&&"fixed"!==window.getComputedStyle(this.galleryData.domObject).position){var r=i.getBoundingClientRect(),a=this.galleryData.domObject.parentNode;if(a){var n=a.getBoundingClientRect();r.top===n.top&&r.left===n.left&&"relative"===window.getComputedStyle(a).position||(this.galleryData.domObject.style.position="relative")}}return e}},{key:"findMainImg",value:function(){var e=this.galleryData.domObject.querySelectorAll(this.imgSelectorQuery),t=void 0;return!!(t=p.utils.findActiveImage(e)||e[0])&&(t.classList.add("vilynx_mainImg"),this.config.noimage&&t.classList.add("vilynx-hide"),this.imageListeners(t),t)}},{key:"responsiveListeners",value:function(){var e=this,t=this.galleryData.domObject.querySelector(".vilynx_mainImg"),i=void 0;window.addEventListener("resize",function(){e.requestPreviewResize()}),this.imageListeners(t),window.addEventListener("orientationchange",function(){e.requestPreviewResize()}),i=new MutationObserver(function(){if(t=e.galleryData.domObject.querySelector(".vilynx_mainImg"),!t){var i=void 0;i=e.reassignTargetImage(),i&&e.requestPreviewResize()}}),i.observe(t.parentNode,{childList:!0}),l.default.resizeonscroll&&window.addEventListener("scroll",function(){e.requestPreviewResize()})}},{key:"imageListeners",value:function(e){var t=this;if(!this.observedImage||this.observedImage!==e){var i=new MutationObserver(function(){t.videoNode&&t.requestPreviewResize()});i.observe(e,{attributes:!0,characterData:!0}),this.imageObserver&&this.imageObserver.disconnect(),this.imageObserver=i,this.observedImage=e}}},{key:"requestPreviewResize",value:function(){var e=this;this.resizeTimeout&&window.cancelAnimationFrame(this.resizeTimeout),this.resizeTimeout=window.requestAnimationFrame(function(){e.animateResize(),e.resizeVideoNode()})}},{key:"videoListeners",value:function(){var e=this;0===this.config.duration&&this.videoNode.addEventListener("loadedmetadata",function(){e.logger.log("Video metadata ready, duration is: "+e.videoNode.duration),void 0!==e.videoNode.duration&&(e.config.duration=e.videoNode.duration)}),this.videoNode.addEventListener("timeupdate",function(){var t=e.videoNode.currentTime;e.videoNode.countLoops!==-1&&0!==t||(e.videoNode.countLoops===-1?(e.videoNode.countLoops=0,e.videoNode.throttle=!1):e.videoNode.throttle&&(e.videoNode.throttle=!1,e.videoNode.countLoops+=1,l.default.mobilecta&&e.videoNode.countLoops>=l.default.mobilectaloopcount&&(e.logger.log("Showing redirectWrapper"),e.onVideoEnd.forEach(function(t){t(e)}))),setTimeout(function(){e.videoNode&&(e.videoNode.throttle=!0)},500)),t>.2&&t<.5?e.videoNode.paused&&(e.logger.log("Video is not playing, remove it from DOM","warn"),"false"===l.default.mobilepreload&&e.cleanVideoNode()):t>e.config.duration-.5&&(e.watcher.isInViewport||e.cleanVideoNode())})}},{key:"mouseClickListeners",value:function(){var e=this,t=this.galleryData.domObject;t.addEventListener("click",function(){if(e.config.isDisabled)return void e.logger.log("Element is disabled, ignore click event");if(e.mixpanel.trackVideoPlay(),e.videoNode){var t=e.videoNode.currentTime;t=e.videoNode.countLoops*e.config.duration+t,e.logger.log("EngagementTime: "+t+", countLoops: "+e.videoNode.countLoops),e.mixpanel.trackViewDuration("click",t)}})}},{key:"stopVideoPlaying",value:function(){if(this.videoNode&&!this.videoNode.paused){var e=this.galleryData.domObject.querySelector(".vilynx_wrapperImg"),t=this.videoNode.currentTime;this.logger.log("Removing class vilynx_fading"),e.classList.remove("vilynx_fading"),this.videoNode.pause(),t=this.videoNode.countLoops*this.config.duration+t,this.logger.log("Mobile engagementTime: "+t+", countLoops: "+this.videoNode.countLoops),"false"!==l.default.mobilepreload&&(this.videoNode.currentTime=.1,l.default.mobilecta&&this.hideRedirectWrapper(this)),this.mixpanel.trackViewDuration("leave_viewport",t)}}},{key:"cleanVideoNode",value:function(e){var t=this,i=this.galleryData.domObject.querySelector(".vilynx_wrapperImg");this.stopVideoPlaying(),this.onVideoCancel.forEach(function(e){e(t)}),clearTimeout(this.trackSummaryPlayTimeout),setTimeout(function(){t.logger.log("cleaning video node"),t.videoNode&&""!==t.videoNode&&t.wrapperNode.removeChild(t.videoNode),t.videoNode="",l.default.mobilecta&&t.hideRedirectWrapper(t),i&&i.classList.remove("vilynx_fading"),t.galleryData.domObject.classList.remove("vilynx_activeSummary"),e?u.viewportQueue.playNextWithToken(h.default.scrollDirection):(u.viewportQueue.removeFromViewportQueue(t),u.viewportQueue.playNextInQueue(t.watcher.isAboveViewport,t.watcher.isBelowViewport))},200)}},{key:"reAttachVideoNode",value:function(e){this.generateVideoUrl(),this.videoNode=this.createVideoDom(),void 0===this.wrapperNode&&(this.wrapperNode=this.galleryData.domObject.querySelector(".supra-wrapper")),this.wrapperNode.appendChild(this.videoNode),this.galleryData.domObject.classList.add("vilynx_activeSummary"),this.resizeVideoNode(),e&&this.showVideoNode(),this.videoListeners(),this.responsiveListeners()}},{key:"watchThumbnailShown",value:function(){var e=this;(void 0===window.scrollMonitor||!window.scrollMonitor.version||window.scrollMonitor.version<c.scrollMonitor.version)&&c.scrollMonitor.reFactory(),this.watcher=window.scrollMonitor.create(this.galleryData.domObject,{top:parseInt(l.default.topviewportoffset,10),bottom:parseInt(l.default.bottomviewportoffset,10)}),this.watcher.fullyEnterViewport(function(){e.logger.log("Optimizely OFF variation, track thumbnail_shown"),e.mixpanel.trackThumbnailShown()})}},{key:"showGif",value:function(){var e=this.galleryData.domObject.querySelectorAll("img"),t=void 0;if(t=e[e.length-1],t&&l.default.customimgsrc)t[l.default.customimgsrc]=this.gifUrl;else if(t)t.src=this.gifUrl;else{var i=this.galleryData.domObject.querySelector(".vilynx_mainImg");i.style.backgroundImage='url("'+this.gifUrl+'")'}}},{key:"hideGif",value:function(){var e=this.galleryData.domObject.querySelectorAll("img"),t=void 0;if(t=e[e.length-1],t&&l.default.customimgsrc)t[l.default.customimgsrc]=this.oldImageUrl;else if(t)t.src=this.oldImageUrl;else{var i=this.galleryData.domObject.querySelector(".vilynx_mainImg"),o=p.utils.extractBGImageFromNode(i);i.style.backgroundImage='url("'+o+'")'}}},{key:"generateGifUrl",value:function(){var e="",t=h.default.serverUrl.slice(4);e=l.default.smallgif?"//public."+t+"/"+this.galleryData.vilynxData.hash+"/pro69.viwindow_xs.gif":"//public."+t+"/"+this.galleryData.vilynxData.hash+"/pro69.viwindow.gif",this.gifUrl=e}},{key:"showRedirectWrapper",value:function(e){var t=e.redirect.dom;"visible"!==t.style.visibility&&((l.default.redirectontop||e.config.redirectontop)&&(e.wrapperNode.style.zIndex="auto",e.videoNode.style.zIndex=0),t.style.visibility="visible",t.style.opacity="1",e.redirect.timeOuts=!0)}},{key:"hideRedirectWrapper",value:function(e){if(e.redirect.timeOuts){var t=e.redirect.dom;(l.default.redirectOnTop||e.config.redirectOnTop)&&(e.wrapperNode.style.zIndex=0,e.videoNode.style.zIndex=-5),t.style.opacity="",t.style.visibility="",e.redirect.timeOuts=!1}}},{key:"createRedirectDom",value:function(){var e=document.createElement("div"),t=document.createElement("div"),i=document.createElement("div"),o=document.createElement("div"),r=this.galleryData.domObject.querySelector(this.imgSelectorQuery);return this.redirect={dom:e},t.classList.add("redirectCenter"),e.classList.add("redirectWrapper"),e.classList.add("mobilecta"),e.appendChild(t),i.classList.add("text"),i.innerHTML=this.config.ctatext,o.id="counter",o.classList.add("counter"),o.innerHTML="Play",t.appendChild(i),this.config.hidectaicon||t.appendChild(o),this.redirect.dom.querySelector(".redirectCenter").style.height=r.offsetHeight+"px",e}}]),e}();i.default=y},{"../../config/globalConfig":2,"../../config/privateConfig":3,"../finder":6,"../helpers/browser":12,"../helpers/scrollMonitor":16,"../helpers/viewportQueue":19,"../mixpanel":21,"./blocks/utils":8}],12:[function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),a=null,n=function(){function e(){return o(this,e),a||(a=this),this.ua=navigator.userAgent.toLowerCase(),a}return r(e,[{key:"isMozilla",value:function(){return this.dr("firefox")}},{key:"isWebkit",value:function(){return this.dr("webkit")}},{key:"isOpera",value:function(){return this.dr("opera")}},{key:"isMsie",value:function(){return this.dr("msie|trident|edge")}},{key:"isEdge",value:function(){return this.dr("edge")}},{key:"isIe10",value:function(){return this.dr("msie")}},{key:"isChrome",value:function(){return this.dr("chrome")}},{key:"isSafari",value:function(){var e=void 0,t=void 0;return!!this.dr("^((?!chrome).)*safari")&&(e=this.ua.search("version/"),t=parseInt(this.ua.substr(e+8,3),10))}},{key:"isAndroid",value:function(){return this.dr("android")}},{key:"isIos",value:function(){return this.dr("iphone|ipad|ipod")}},{key:"isIpad",value:function(){return this.dr("ipad")}},{key:"isAndroidTablet",value:function(){return this.isAndroid()&&this.dr("^mobile")}},{key:"isTablet",value:function(){return this.isIpad()||this.isAndroidTablet()}},{key:"isIphone",value:function(){return this.dr("iphone")}},{key:"isOperaMini",value:function(){return this.dr("opera mini")}},{key:"isWindowsMobile",value:function(){return this.dr("iemobile")}},{key:"isKindle",value:function(){return this.dr("kindle|silk|kftt|kfot|kfjwa|kfjwi")}},{key:"isMobile",value:function(){return this.isAndroid()||this.isIos()||this.isIphone()||this.isOperaMini()||this.isWindowsMobile()||this.isKindle()}},{key:"dr",value:function(e){var t=new RegExp(e);return t.test(this.ua)}}]),e}();i.browser=new n},{}],13:[function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0}),i.exposed=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),a=e("./logger"),n=e("./viewportQueue"),l=function(){function e(){o(this,e),this.onPlay=[],this.onStop=[],this.onTrackSummaryPlay=[],this.onTrackVideoPlay=[],this.onTrackThumbnailShown=[],this.hooks=[]}return r(e,[{key:"addOnPlay",value:function(e){return a.logger.debug("Pushed new function to OnPlay"),this.onPlay.push(e),this.onPlay}},{key:"getOnPlay",value:function(){return this.onPlay}},{key:"addOnStop",value:function(e){return a.logger.debug("Pushed new function to OnStop"),this.onStop.push(e),this.onStop}},{key:"getOnStop",value:function(){return this.onStop}},{key:"addOnTrackSummaryPlay",value:function(e){return a.logger.debug("Pushed new function to onTrackSummaryPlay"),this.onTrackSummaryPlay.push(e),this.onTrackSummaryPlay}},{key:"getOnTrackSummaryPlay",value:function(){return this.onTrackSummaryPlay}},{key:"addOnTrackVideoPlay",value:function(e){return a.logger.debug("Pushed new function to OnTrackVideoPlay"),this.onTrackVideoPlay.push(e),this.onTrackVideoPlay}},{key:"getOnTrackVideoPlay",value:function(){return this.onTrackVideoPlay}},{key:"addOnTrackThumbnailShown",value:function(e){return a.logger.debug("Pushed new function to onTrackThumbnailShown"),this.onTrackThumbnailShown.push(e),this.onTrackThumbnailShown}},{key:"getOnTrackThumbnailShown",value:function(){return this.onTrackThumbnailShown}},{key:"cleanQueues",value:function(){return a.logger.debug("Forced a play/preload queue clean."),n.viewportQueue.clearQueues(),!0}},{key:"testTmz",value:function(){return a.logger.debug("Test Tmz activated."),n.viewportQueue.isTmz(),!0}},{key:"addOnLoadGalleryItem",value:function(e){return a.logger.debug("Pushed new function to onLoadGalleryItem"),this.hooks.push(e),this.hooks}},{key:"getOnLoadGalleryItem",value:function(){return this.hooks}}]),e}();i.exposed=new l},{"./logger":15,"./viewportQueue":19}],14:[function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),a=e("./logger"),n=function(){function e(t){o(this,e),this.debugId=t}return r(e,[{key:"log",value:function(e,t){switch(t){case"debug":a.logger.debug("[vlx_dbg:"+this.debugId+"] "+e);break;case"info":a.logger.info("[vlx_dbg:"+this.debugId+"] "+e);break;case"warn":a.logger.warn("[vlx_dbg:"+this.debugId+"] "+e);break;case"err":a.logger.error("[vlx_dbg:"+this.debugId+"] "+e);break;case"timeStart":a.logger.timeStart("[vlx_dbg:"+this.debugId+"] "+e);break;case"timeEnd":a.logger.timeStop("[vlx_dbg:"+this.debugId+"] "+e);break;default:a.logger.debug("[vlx_dbg:"+this.debugId+"] "+e)}}}]),e}();i.default=n},{"./logger":15}],15:[function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0}),i.logger=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),n=e("../../config/globalConfig"),l=o(n),s=function(){function e(){r(this,e),this.info("Logger Enabled")}return a(e,[{key:"debug",value:function(e){!l.default.debug||console.info(e)}},{key:"info",value:function(e){!l.default.debug||console.info(e)}},{key:"warn",value:function(e){!l.default.debug||console.warn(e)}},{key:"error",value:function(e){!l.default.debug||console.error(e)}},{key:"timeStart",value:function(e){!l.default.debug||console.time(e)}},{key:"timeStop",value:function(e){!l.default.debug||console.timeEnd(e)}}]),e}();i.logger=new s},{"../../config/globalConfig":2}],16:[function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0}),i.scrollMonitor=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),n=e("../../config/globalConfig"),l=o(n),s=e("./logger"),d=e("../../config/privateConfig"),c=o(d),u=function(){function e(){var t=this;r(this,e);var i=setInterval(function(){c.default.loaded&&(s.logger.info("ScrollMonitor initialized"),window.scrollMonitor=t.factory(),clearInterval(i))},20)}return a(e,[{key:"factory",value:function(){function e(){if(u.viewportTop=d(),u.viewportBottom=u.viewportTop+u.viewportHeight,u.documentHeight=O(),u.viewportLeft=c(),u.viewportRight=u.viewportLeft+u.viewportWidth,u.documentWidth=I(),u.documentHeight!==D||u.documentWidth!==T){for(C=g.length;C--;)g[C].recalculateLocation();D=u.documentHeight,T=u.documentWidth}}function t(){u.viewportHeight=S(),u.viewportWidth=N(),e(),o()}function i(){clearTimeout(L),L=setTimeout(t,100)}function o(){for(V=g.length;V--;)g[V].recalculateLocation(),g[V].update();for(V=g.length;V--;)g[V].triggerCallbacks()}function r(e,t){function i(e){if(0!==e.length)for(g=e.length;g--;)S=e[g],S.callback.call(o,E),S.isOne&&e.splice(g,1)}var o=this;this.watchItem=e,t?t===+t?this.offsets={top:t,bottom:t}:this.offsets={top:t.top||_.top,bottom:t.bottom||_.bottom}:this.offsets=_,this.callbacks={};for(var r=0,a=k.length;r<a;r++)o.callbacks[k[r]]=[];this.locked=!1;var n,l,s,d,c,g,S,N=!0;this.triggerCallbacks=function(){switch(this.isInViewport&&!n&&i(this.callbacks[f]),this.isFullyInViewport&&!l&&i(this.callbacks[p]),this.isCanPreload&&!c&&i(this.callbacks[b]),this.isCanUnload&&!N&&i(this.callbacks[x]),this.isAboveViewport!==s&&this.isBelowViewport!==d&&(i(this.callbacks[h]),l||this.isFullyInViewport||(i(this.callbacks[p]),i(this.callbacks[y])),n||this.isInViewport||(i(this.callbacks[f]),i(this.callbacks[v]))),!this.isFullyInViewport&&l&&i(this.callbacks[y]),!this.isInViewport&&n&&i(this.callbacks[v]),this.isInViewport!==n&&i(this.callbacks[h]),!0){case n!==this.isInViewport:case l!==this.isFullyInViewport:case s!==this.isAboveViewport:case d!==this.isBelowViewport:i(this.callbacks[w])}n=this.isInViewport,l=this.isFullyInViewport,s=this.isAboveViewport,d=this.isBelowViewport,c=this.isCanPreload,N=this.isCanUnload},this.recalculateLocation=function(){if(!this.locked&&this.watchItem){var e=this.top,t=this.bottom;if(this.watchItem.nodeName){var o=this.watchItem.style.display;"none"===o&&(this.watchItem.style.display="");var r=this.watchItem.getBoundingClientRect();this.top=Math.ceil(r.top)+u.viewportTop,this.bottom=Math.floor(r.bottom)+u.viewportTop,this.left=Math.ceil(r.left)+u.viewportLeft,this.right=Math.floor(r.right)+u.viewportLeft,"none"===o&&(this.watchItem.style.display=o)}else this.watchItem===+this.watchItem?this.watchItem>0?this.top=this.bottom=this.watchItem:this.top=this.bottom=u.documentHeight-this.watchItem:(this.top=this.watchItem.top,this.bottom=this.watchItem.bottom);this.top-=this.offsets.top,this.bottom+=this.offsets.bottom,this.height=this.bottom-this.top,void 0===e&&void 0===t||this.top===e&&this.bottom===t||i(this.callbacks[m])}},this.recalculateLocation(),this.update(),n=this.isInViewport,l=this.isFullyInViewport,s=this.isAboveViewport,d=this.isBelowViewport}function a(t){E=t,e(),o()}this.version=1.1;var n="undefined"==typeof window,s=!n,d=function(){return n?0:"undefined"!=typeof showMarquee?-parseInt(showMarquee.content.$container.css("top")):window.pageYOffset||document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop},c=function(){if(n)return 0;var e=window.pageXOffset;return e>=0?0:window.pageXOffset||document.documentElement&&document.documentElement.scrollWidth||document.body.scrollWidth},u={},g=[],h="visibilityChange",f="enterViewport",p="fullyEnterViewport",v="exitViewport",y="partiallyExitViewport",m="locationChange",w="stateChange",b="canPreload",x="canUnload",k=[h,f,p,v,y,m,w,b,x],_={top:0,bottom:0},S=function(){return n?0:window.innerHeight||document.documentElement.clientHeight},N=function(){return n?0:window.innerWidth||document.documentElement.clientWidth},O=function(){return n?0:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight)},I=function(){return n?0:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth,document.documentElement.clientWidth)};u.viewportTop=null,u.viewportBottom=null,u.documentHeight=null,u.viewportHeight=S(),u.viewportWidth=N();var D,T,E,C,L,V;r.prototype={on:function(e,t,i){switch(!0){case e===h&&!this.isInViewport&&this.isAboveViewport:case e===f&&this.isInViewport:case e===p&&this.isFullyInViewport:case e===v&&this.isAboveViewport&&!this.isInViewport:case e===y&&this.isAboveViewport:case e===b&&this.isCanPreload:case e===x&&this.isCanUnload:if(t.call(this,E),i)return}if(!this.callbacks[e])throw new Error("Tried to add a scroll monitor listener of type "+e+". Your options are: "+k.join(", "));this.callbacks[e].push({callback:t,isOne:i||!1})},off:function(e,t){if(!this.callbacks[e])throw new Error("Tried to remove a scroll monitor listener of type "+e+". Your options are: "+k.join(", "));for(var i,o=0;i=this.callbacks[e][o];o++)if(i.callback===t){this.callbacks[e].splice(o,1);break}},one:function(e,t){this.on(e,t,!0)},recalculateSize:function(){this.height=this.watchItem.offsetHeight+this.offsets.top+this.offsets.bottom,this.bottom=this.top+this.height},update:function(){this.isAboveViewport=this.top<u.viewportTop,this.isBelowViewport=this.bottom>u.viewportBottom,this.isOverLeftViewport=this.left<u.viewportLeft,this.isOverRightViewport=this.right>u.viewportRight,this.isInViewport=this.top<=u.viewportBottom&&this.bottom>=u.viewportTop&&this.left<=u.viewportRight&&this.right>=u.viewportLeft,this.isFullyInViewport=!this.isAboveViewport&&!this.isBelowViewport&&!this.isOverLeftViewport&&!this.isOverRightViewport||!this.isAboveViewport&&!this.isBelowViewport&&this.isOverLeftViewport&&this.isOverRightViewport||this.isAboveViewport&&this.isBelowViewport,this.isCanPreload=this.top-l.default.preloadoffset<=u.viewportBottom&&this.bottom+l.default.preloadoffset>=u.viewportTop,this.isCanUnload=!this.isCanPreload},destroy:function(){var e=g.indexOf(this),t=this;g.splice(e,1);for(var i=0,o=k.length;i<o;i++)t.callbacks[k[i]].length=0},lock:function(){this.locked=!0},unlock:function(){this.locked=!1}};for(var j=function(e){return function(t,i){this.on.call(this,e,t,i)}},q=0,M=k.length;q<M;q++){var z=k[q];r.prototype[z]=j(z)}if(s)try{e()}catch(t){try{window.$(e)}catch(e){throw new Error("If you must put scrollMonitor in the <head>, you must use jQuery.")}}if(s){if(window.addEventListener){var P=!1;window.addEventListener("scroll",function(e){P||window.requestAnimationFrame(function(){a(e),P=!1}),P=!0},!0),window.addEventListener("resize",i)}else window.attachEvent("onscroll",a),window.attachEvent("onresize",i);l.default.proactiveload&&setInterval(function(){u.update(),a()},200)}return u.beget=u.create=function(e,t){"string"==typeof e?e=document.querySelector(e):e&&e.length>0&&(e=e[0]);var i=new r(e,t);return g.push(i),i.update(),i},u.update=function(){E=null,e(),o()},u.recalculateLocations=function(){u.documentHeight=0,u.update()},u.version=this.version,u}},{key:"reFactory",value:function(){s.logger.warn("ScrollMonitor create error, reFactory method called"),window.scrollMonitor=this.factory()}}]),e}();i.scrollMonitor=new u},{"../../config/globalConfig":2,"../../config/privateConfig":3,"./logger":15}],17:[function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0}),i.ss=void 0;var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),a=e("../logger"),n=function(){function e(){o(this,e),this.isSessionStorageAvailable=!0;try{var t="__storage_test__";sessionStorage.setItem(t,t),sessionStorage.removeItem(t)}catch(e){this.isSessionStorageAvailable=!1,a.logger.warn("SessionStorage is not available")}}return r(e,[{key:"get",value:function(e){if(!this.isSessionStorageAvailable)return a.logger.warn("SessionStorage is not available"),!1;a.logger.debug("Getting "+e+" from session storage");var t=sessionStorage.getItem(e);try{t=JSON.parse(t)||!1}catch(e){t=!1}return t}},{key:"set",value:function(e,t){if(!this.isSessionStorageAvailable)return a.logger.warn("SessionStorage is not available"),!1;a.logger.debug("Saving "+e+" to session storage");try{sessionStorage.setItem(e,JSON.stringify(t))}catch(e){a.logger.error(e),a.logger.error("Can't save to session storage. Maybe it's full.")}return!0}},{key:"remove",value:function(e){return this.isSessionStorageAvailable?(a.logger.debug("Removing "+e+" from session storage"),sessionStorage.removeItem(e),!0):(a.logger.warn("SessionStorage is not available"),!1)}}]),e}();i.ss=new n},{"../logger":15}],18:[function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0}),i.utils=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),n=e("./logger"),l=o(n),s=function(){function e(){r(this,e)}return a(e,[{key:"validateQuery",value:function(e){try{return document.querySelector(e),!0}catch(t){l.default.warn("Invalid selector query found! "+e)}return l.default.warn("Invalid selector query found! "+e),!1}}]),e}();i.utils=new s},{"./logger":15}],19:[function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0}),i.viewportQueue=void 0;var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),n=e("../../config/globalConfig"),l=o(n),s=e("./logger"),d=e("../../config/privateConfig"),c=o(d),u=function(){function e(){r(this,e),s.logger.info("Viewport Queue initialized"),this.testTmz=!1,this.windowChange=!1,this.queue=[],this.loadedQueue=[],this.playingVideo="",this.isPlaying=-1,this.lastToken="",this.lastTokenTop=0,this.passTokenNow=!0}return a(e,[{key:"clearQueues",value:function(){var e=this;this.windowChange=!0,this.loadedQueue.forEach(function(t){e.removeToLoadedQueue(t)}),this.queue.forEach(function(t){e.removeFromViewportQueue(t.gallery)}),this.queue=[],this.loadedQueue=[],this.playingVideo="",this.isPlaying=-1,this.lastToken="",this.lastTokenTop=0,this.passTokenNow=!0}},{key:"isTmz",value:function(){this.testTmz=!0}},{key:"tmz",value:function(){return this.testTmz}},{key:"addToViewportQueue",
value:function(e,t,i){var o=this,r={};return r.gallery=e,r.top=Math.round(t),r.token=!1,r.hadToken=!1,this.queue.push(r),this.isTokenFree()?i?window.setTimeout(function(){o.playNextInQueue(!0,null)},280):this.playNextInQueue(!0,null):s.logger.info("Elem "+e.logger.debugId+" is waiting to play"),!0}},{key:"removeFromViewportQueue",value:function(e){var t=-1;this.queue.forEach(function(i,o){i.gallery===e&&("false"!==l.default.mobilepreload&&(s.logger.info("stop video playing (but the element still loaded)"),i.gallery.stopVideoPlaying()),t=o)}),t!==-1&&this.queue.splice(t,1)}},{key:"addToLoadedQueue",value:function(e){var t=this,i=-1;e.logMessage("adding video to the queue!"),e.scrollPosition=e.galleryData.domObject.getBoundingClientRect().y,setTimeout(function(){if(Math.abs(e.scrollPosition-e.galleryData.domObject.getBoundingClientRect().y)<=200){if(t.loadedQueue.indexOf(e)!==-1)return;if(t.loadedQueue.length<l.default.maxpreloadedvideos)e.logMessage("Loaded queue isn't filled!"),t.loadedQueue.push(e),e.initOrReattachGallery(!1);else{var o=e.watcher.isInViewport;t.loadedQueue.forEach(function(e,t){!e.watcher.isCanUnload&&e.videoNode||i!==-1||(i=t)}),i===-1&&o&&(t.loadedQueue.forEach(function(t,o){t.watcher.isInViewport||i!==-1||(e.logMessage("Video with preference removes another which is not in the viewport!"),i=o)}),e.watcher.isFullyInViewport&&i===-1&&t.loadedQueue.forEach(function(t,o){t.watcher.isFullyInViewport||i!==-1||(e.logMessage("Video with preference removes another which is not in the viewport!"),e.logMessage("Video in "),t.logMessage("Video out"),i=o)})),i!==-1&&(t.loadedQueue[i].videoNode&&t.loadedQueue[i].cleanVideoNode(),t.loadedQueue[i]=e,e.initOrReattachGallery(t.playingVideo===e))}}},75)}},{key:"removeToLoadedQueue",value:function(e){var t=-1;this.loadedQueue.forEach(function(i,o){i.gallery===e&&(t=o)}),t!==-1&&(this.loadedQueue.splice(t,1),e.cleanVideoNode())}},{key:"passToken",value:function(){var e=this;this.queue.forEach(function(t){t.token===!0&&(t.token=!1,t.hadToken=!0,e.lastTokenTop=t.top,e.lastToken=t.gallery,s.logger.info("Token is free"))})}},{key:"resetHadToken",value:function(){this.queue.forEach(function(e){e.hadToken=!1})}},{key:"isTokenFree",value:function(){var e=!0;return this.queue.forEach(function(t){t.token===!0&&(t.gallery.logMessage("Playing token is taken"),e=!1)}),e}},{key:"playNextInQueue",value:function(e,t,i){var o=this;if(0!==this.queue.length&&this.isTokenFree()!==!1){var r=void 0,a=void 0,n=void 0;n=this.queue[0].top,a=0,i?!function(){s.logger.info("Playing next one due to scroll");var i=1e5,r=-1e5;e?o.queue.forEach(function(e,t){e.top>o.lastTokenTop&&e.top<i&&e.hadToken===!1&&(i=e.top,a=t)}):t&&(s.logger.info("Scrolling to top"),o.queue.forEach(function(e,t){e.top<o.lastTokenTop&&e.top>r&&e.hadToken===!1&&(r=e.top,a=t)}))}():e?this.queue.forEach(function(e,t){e.top<n&&(a=t)}):t&&(s.logger.info("Scrolling to top"),this.queue.forEach(function(e,t){e.top>n&&(a=t)})),this.queue[a].token=!0,r=this.queue[a],s.logger.info("Elem "+r.gallery.logger.debugId+" have the token now"),r.gallery.watcher.isFullyInViewport?(l.default.followscroll&&this.setPassTokenTimer(),"false"===l.default.mobilepreload?r.gallery.initOrReattachGallery():(r.gallery.logMessage("playing video!"),this.playVideo(r.gallery))):(s.logger.info("Element in queue but not visible any more"),"false"===l.default.mobilepreload?this.queue.splice(a,1):this.removeFromViewportQueue(r.gallery),this.playNextInQueue(e,t))}}},{key:"playVideo",value:function(e){var t=this;e.videoNode?e.showVideoNode():(e.logMessage("no videoNode, readding"),setTimeout(function(){e.videoNode?(e.logMessage("video found 100ms later"),e.showVideoNode()):(t.playingVideo=e,t.addToLoadedQueue(e))},100))}},{key:"playNextWithToken",value:function(e){this.playNextInQueue(e,!e,!0),this.resetHadToken()}},{key:"setPassTokenTimer",value:function(){var e=this;this.passTokenNow=!1,clearTimeout(this.passTokenTimer),this.passTokenTimer=setTimeout(function(){e.passTokenNow=!0,s.logger.info("passTokenTimer free"),e.isTokenFree()&&e.queue.length>0&&e.playNextWithToken(c.default.scrollDirection)},1e3)}},{key:"followScrollListener",value:function(){var e=this,t=void 0,i=pageYOffset||document.documentElement.scrollTop,o=void 0,r=void 0;s.logger.info("Follow scroll listener init"),window.addEventListener("scroll",function(){clearTimeout(t),t=setTimeout(function(){if(window.innerHeight+window.scrollY>=document.body.offsetHeight&&l.default.pulltochange)s.logger.info("Scrolling beyond bottom: change video"),e.queue.length>1&&e.anyVideoOnBottom()&&(e.passToken(),e.lastToken.cleanVideoNode(!0)),i=o;else if(l.default.followscroll){if(o=pageYOffset||document.documentElement.scrollTop,r=Math.abs(o-i),o>i?(s.logger.info("Scrolling to bottom with distance: "+r),c.default.scrollDirection=!0):(s.logger.info("Scrolling to top with distance: "+r),c.default.scrollDirection=!1),i=o,r<parseInt(l.default.minscrolldistance,10))return void s.logger.info("Scroll distance to short");if(e.passTokenNow===!1)return void s.logger.info("Token was recently passed");e.queue.length>1?(e.passToken(),e.lastToken.cleanVideoNode(!0)):s.logger.info("No other elements on queue")}},200)})}},{key:"anyVideoOnBottom",value:function(){var e=0,t=!1;return this.queue.forEach(function(t){t.token===!0&&(e=t.top)}),this.queue.forEach(function(i){i.top>e&&(t=!0,s.logger.info("More video/s on bottom to play"))}),t}}]),e}();i.viewportQueue=new u},{"../../config/globalConfig":2,"../../config/privateConfig":3,"./logger":15}],20:[function(e,t,i){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),a=e("./logger"),n=function(){function e(){o(this,e)}return r(e,[{key:"post",value:function(e,t,i,o){a.logger.info("Making Xhr Post to "+e);var r=new XMLHttpRequest;r.open("POST",e,!0),r.setRequestHeader("Accept","application/json, text/javascript, */*"),r.onreadystatechange=function(){4===r.readyState&&"2"===r.status.toString()[0]?(a.logger.info("Xhr Post to "+e+" successful with code "+r.status),r.response.length>1?i(JSON.parse(r.response)):(a.logger.warn("No JSON data found on the response"),o(!1))):4===r.readyState&&"2"!==r.status.toString()[0]&&(a.logger.error("Xhr Post to "+e+" erroneous with code "+r.status),o(!0))},r.send(t)}}]),e}();i.default=n},{"./logger":15}],21:[function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),n=(e("./helpers/browser"),e("../config/globalConfig")),l=o(n),s=e("../config/privateConfig"),d=o(s),c=(e("./helpers/logger"),e("./helpers/storage/sessionStorage")),u=e("./helpers/exposed"),g=function(){function e(){return r(this,e),l.default.optimizely&&this.initOptimizely(),!0}return a(e,[{key:"trackPlayersLoaded",value:function(){return!1}},{key:"trackShowPlayer",value:function(){return!1}},{key:"trackSummaryPlay",value:function(e){return this.summaryPlays+=1,l.default.optimizely&&window.optimizely&&window.optimizely.push(["trackEvent","summary_play"]),u.exposed.getOnTrackSummaryPlay().forEach(function(e){e()}),!1}},{key:"trackVideoPlay",value:function(){return l.default.optimizely&&window.optimizely&&window.optimizely.push(["trackEvent","summary_click"]),u.exposed.getOnTrackVideoPlay().forEach(function(e){e()}),!1}},{key:"trackThumbnailShown",value:function(){return l.default.optimizely&&window.optimizely&&window.optimizely.push(["trackEvent","thumbnail_shown"]),u.exposed.getOnTrackThumbnailShown().forEach(function(e){e()}),!1}},{key:"trackViewDuration",value:function(e,t){return!1}},{key:"saveEvent",value:function(e,t,i){this.saved=c.ss.get("vilynx_gallery_mpSavedEvents")||{},this.saved[e+t]={eventName:t,options:i},c.ss.set("vilynx_gallery_mpSavedEvents",this.saved)}},{key:"removeEvent",value:function(e){this.saved=c.ss.get("vilynx_gallery_mpSavedEvents")||{},"undefined"!=typeof this.saved[e]&&delete this.saved[e],c.ss.set("vilynx_gallery_mpSavedEvents",this.saved)}},{key:"sendSaved",value:function(){var e=c.ss.get("vilynx_gallery_mpSavedEvents")||{};d.default.savedEventsSended=!0,Object.keys(e).forEach(function(t){window.mixpanel.vilynx.track(e[t].eventName.replace("-"," "),e[t].options)}),c.ss.set("vilynx_gallery_mpSavedEvents",this.saved)}},{key:"trackCb",value:function(e,t){this.removeEvent(e+t)}},{key:"getCookie",value:function(e){var t="; "+document.cookie,i=t.split("; "+e+"=");if(2===i.length)return i.pop().split(";").shift()}},{key:"initOptimizely",value:function(){window.optimizely=window.optimizely||[]}},{key:"configureMixpanel",value:function(e,t){return!1}}]),e}();i.default=g},{"../config/globalConfig":2,"../config/privateConfig":3,"./helpers/browser":12,"./helpers/exposed":13,"./helpers/logger":15,"./helpers/storage/sessionStorage":17}],22:[function(e,t,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}(),n=e("../config/globalConfig"),l=o(n),s=function(){function e(t){r(this,e),this.galleryData=t,this.shareWidget=document.createElement("div"),this.shareWidget.className="shareicon",this.shareWidget.id="sharewidget",this.createOpenCloseButtons(),this.shareGrid=this.createshareGrid(),this.shareWidget.appendChild(this.shareGrid),this.widgetListeners()}return a(e,[{key:"widgetListeners",value:function(){var e=this,t=this.shareWidget.querySelector("button.share"),i=this.shareWidget.querySelector("span#closeshare");t.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.openWidget()}),i.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.closeWidget()})}},{key:"getWidget",value:function(){return this.shareWidget}},{key:"createOpenCloseButtons",value:function(){var e=document.createElement("button"),t=document.createElement("label"),i=document.createElement("i"),o=document.createElement("span");e.className="share",t.id="clickshare",t.textContent="Share",i.id="clickshare",o.id="closeshare",o.className="close share",e.appendChild(t),e.appendChild(i),this.shareWidget.appendChild(e),this.shareWidget.appendChild(o)}},{key:"createshareGrid",value:function(){var e=document.createElement("ul");return e.className="shareGrid",e.appendChild(this.createTwitterShare()),e.appendChild(this.createFbShare()),e.appendChild(this.createGplusShare()),e.appendChild(this.createPinterestShare()),e}},{key:"createTwitterShare",value:function(){var e=this.createBaseShare(),t=l.default.socialtext+encodeURIComponent(this.galleryData.vilynxData.title.substr(0,107));return e.className="button-twitter",e.querySelector("a").href="http://twitter.com/intent/tweet?text="+t+"&url="+this.galleryData.vilynxData.url,e.querySelector("span").className="sharetwitter",e}},{key:"createFbShare",value:function(){var e=this.createBaseShare(),t=this.galleryData.vilynxData.url;return"/"===t[0]&&(t=window.location.hostname+t),e.className="button-facebook",e.querySelector("a").href="http://www.facebook.com/share.php?u="+t+"&title="+l.default.socialtext+this.galleryData.vilynxData.title,e.querySelector("span").className="sharefacebook",e}},{key:"createGplusShare",value:function(){var e=this.createBaseShare();return e.className="button-gplus",e.querySelector("a").href="https://plus.google.com/share?url="+this.galleryData.vilynxData.url,e.querySelector("span").className="sharegoogle",e}},{key:"createPinterestShare",value:function(){var e=this.createBaseShare();return e.className="button-pinterest",e.querySelector("a").href="https://www.pinterest.com/pin/create/button/?url="+this.galleryData.vilynxData.url+"&media=https%3A%2F%2Fpublic.vilynx.com%2F"+this.galleryData.vilynxData.hash+"%2Fshort.viwindow0.jpg&amp;description="+l.default.socialtext+this.galleryData.vilynxData.title,e.querySelector("span").className="sharepinterest",e}},{key:"createBaseShare",value:function(){var e=document.createElement("li"),t=document.createElement("a"),i=document.createElement("span"),o=document.createElement("i");return e.appendChild(t),t.setAttribute("target","_blank"),t.appendChild(i),t.appendChild(o),e.cloneNode(!0)}},{key:"openWidget",value:function(){var e=this.shareWidget.querySelector("button.share"),t=this.shareWidget.querySelector("span#closeshare");this.shareWidget.querySelector("ul.shareGrid").style.display="block",t.style.display="block",e.style.display="none"}},{key:"closeWidget",value:function(){var e=this.shareWidget.querySelector("button.share"),t=this.shareWidget.querySelector("span#closeshare");this.shareWidget.querySelector("ul.shareGrid").style.display="none",t.style.display="none",e.style.display="block"}}]),e}();i.default=s},{"../config/globalConfig":2}],23:[function(e,t,i){"use strict";"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),o=1;o<arguments.length;o++){var r=arguments[o];if(null!=r)for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(i[a]=r[a])}return i},writable:!0,configurable:!0})},{}],24:[function(e,t,i){"use strict";"document"in self&&("classList"in document.createElement("_")?!function(){var e=document.createElement("_");if(e.classList.add("c1","c2"),!e.classList.contains("c2")){var t=function(e){var t=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(e){var i,o=arguments.length;for(i=0;i<o;i++)e=arguments[i],t.call(this,e)}};t("add"),t("remove")}if(e.classList.toggle("c3",!1),e.classList.contains("c3")){var i=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(e,t){return 1 in arguments&&!this.contains(e)==!t?t:i.call(this,e)}}e=null}():!function(e){if("Element"in e){var t="classList",i="prototype",o=e.Element[i],r=Object,a=String[i].trim||function(){return this.replace(/^\s+|\s+$/g,"")},n=Array[i].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1},l=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},s=function(e,t){if(""===t)throw new l("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new l("INVALID_CHARACTER_ERR","String contains an invalid character");return n.call(e,t)},d=function(e){for(var t=a.call(e.getAttribute("class")||""),i=t?t.split(/\s+/):[],o=0,r=i.length;o<r;o++)this.push(i[o]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},c=d[i]=[],u=function(){return new d(this)};if(l[i]=Error[i],c.item=function(e){return this[e]||null},c.contains=function(e){return e+="",s(this,e)!==-1},c.add=function(){var e,t=arguments,i=0,o=t.length,r=!1;do e=t[i]+"",s(this,e)===-1&&(this.push(e),r=!0);while(++i<o);r&&this._updateClassName()},c.remove=function(){var e,t,i=arguments,o=0,r=i.length,a=!1;do for(e=i[o]+"",t=s(this,e);t!==-1;)this.splice(t,1),a=!0,t=s(this,e);while(++o<r);a&&this._updateClassName()},c.toggle=function(e,t){e+="";var i=this.contains(e),o=i?t!==!0&&"remove":t!==!1&&"add";return o&&this[o](e),t===!0||t===!1?t:!i},c.toString=function(){return this.join(" ")},r.defineProperty){var g={get:u,enumerable:!0,configurable:!0};try{r.defineProperty(o,t,g)}catch(e){e.number===-2146823252&&(g.enumerable=!1,r.defineProperty(o,t,g))}}else r[i].__defineGetter__&&o.__defineGetter__(t,u)}}(self))},{}],25:[function(e,t,i){"use strict";window.Element&&!Element.prototype.closest&&(Element.prototype.closest=function(e){var t,i=(this.document||this.ownerDocument).querySelectorAll(e),o=this;do for(t=i.length;--t>=0&&i.item(t)!==o;);while(t<0&&(o=o.parentElement));return o})},{}],26:[function(e,t,i){"use strict";"path"in Event.prototype||Object.defineProperty(Event.prototype,"path",{get:function(){for(var e=[],t=this.target;t;)e.push(t),t=t.parentElement;return e.indexOf(window)===-1&&e.indexOf(document)===-1&&e.push(document),e.indexOf(window)===-1&&e.push(window),e}})},{}]},{},[4]);