define("OK/AjaxNavigationLog",["OK/logger"],function(j){var d="ajaxrequestdatatime.send.time";var c;var g;var i;var f;var e=false;function l(n,o,m){g=o;i=m;c=JSON.parse(n);e=true;}function k(p){var n=100,m=2000,o;if(p<n){return 1;}if(p>m){p=m;}o=~~(p/n);return n*o;}function b(n,m){if(e){var p=a(m);if(p.length>0){j.duration(d,n,i+"_"+p,g);var o=k(n);if(o){j.success("ad","ajax_"+i+"_"+p,o);}}}}function a(n){var m=h("st.cmd",n),r=h("cmd",n);for(var q=0;q<c.length;q++){var t=c[q];if(t.indexOf("_")>-1){var p=t.split("_");var o=p[0];var s=p[1];if("*"===o&&r===s){return s;}if(m===o&&r===s){return m+"_"+r;}}else{if(m===t){return t;}}}return"";}function h(r,m){var q=m.substring(Math.max(0,m.indexOf("?")+1)).split("&");for(var n=0;n<q.length;n++){var p=q[n];var o=p.indexOf(r+"=");if(o===0){return p.substr(r.length+1);}}return"";}return{log:b,activate:function(m){if(f){return;}l(m.textContent,m.getAttribute("data-region"),m.getAttribute("data-countrycode"));f=true;},deactivate:function(){c.length=0;g="";i="";f=false;}};});define("OK/utils/utils",["jquery","OK/logger","OK/AjaxNavigationLog"],function(e,l,b){var j=document.getElementById("hook_Cfg_GwtExperimentsCfg");var c=j?OK.util.parseJSON(j.innerHTML):{};var d="data-";function f(p,n,o){var m=p.split(OK.navigation.SPLITER);m.forEach(function(q,r){if(o[r]){OK.hookModel.setHookContent(o[r],q);}});}function i(p,n,o,m){var r=Date.now();var q=e.ajax(p);m.xhr=q;m.fail(function(){q.abort();});q.done(function(u,w,v){b.log(Date.now()-r,p.url);if(u&&v.responseText&&u.length===0&&v.responseText.length!==0&&v.responseText!="[]"){l.error("ajax",w);l.clob("ajax",JSON.stringify({requestData:p,response:v.responseText}));}var t=v.getResponseHeader("TKN");if(t){OK.tkn.set(t);}var s=v.getResponseHeader("Redirect-Location");if(s){n(s);m.reject(v,w,"Redirect");return;}m.resolve(u,w,v);});q.fail(function(s,u,t){if(o>0){if(u=="timeout"||!p.timeout){i(p,n,--o,m);}else{setTimeout(function(){i(p,n,--o,m);},p.timeout);}}else{m.reject(s,u,t);}});return m;}function a(o,m,p){var n=p.getResponseHeader(OK.navigation.HEADER);if(n){return n.split(",");}return null;}function k(p,n){if(typeof p==="string"){p=document.getElementById(p);}var q={};for(var o=0;o<p.attributes.length;o++){var m=p.attributes[o];if(m.name.indexOf(d)==0){q[m.name.substring(d.length)]=m.value;}}if(n){p.parentNode.removeChild(p);}return q;}function g(n,m){var p={};var o=Array.prototype.slice.call(n.elements);if(m){o=o.filter(m);}o.forEach(function(r){var q=r.name;if(q){if(r.type==="checkbox"){p[q]=r.checked?"on":"off";}else{p[q]=r.value;}}});return p;}function h(n){var m=n?n.replace(/<!--/ig,"").replace(/-->/ig,""):null;return m?JSON.parse(m):null;}return{ajax:function(n,m,p){if(arguments.length>1){if(typeof arguments[1]!=="function"){p=m;m=undefined;}}p=p||0;m=m||function(r){if(OK.navigation.redirect){OK.navigation.redirect(r);}else{document.location.href=decodeURIComponent(r);}};var q=n.data||{};var o=n.beforeSend;n.type=n.type||"POST";if(n.type==="POST"&&n.contentType&&n.contentType.indexOf("application/json")!=-1){if(typeof q!=="string"){q=JSON.stringify(q);}}else{q["gwt.requested"]=window.pageCtx.gwtHash;}n.data=q;n.beforeSend=function(s,r){s.setRequestHeader("TKN",OK.tkn.get());if(o){o.apply(this,arguments);}};return i(n,m,p,e.Deferred());},getBlockIds:a,updateBlockModelCallback:function(o,m,p){var n=a(o,m,p);if(n){f(o,m,n);}},updateBlocks:f,gwtExperimentsCfg:c,removeTags:function(m){return typeof m==="string"?m.replace(/<[^>]*>/g,""):m;},isElementInViewport:function(m){var n=m.getBoundingClientRect();if(n.top<0||n.left<0||n.bottom>window.innerHeight||n.right>window.innerWidth){return false;}return(m.contains(document.elementFromPoint(n.left,n.top))||m.contains(document.elementFromPoint(n.right,n.top))||m.contains(document.elementFromPoint(n.right,n.bottom))||m.contains(document.elementFromPoint(n.left,n.bottom)));},isElementPartiallyInViewport:function(q,n){if(!n){return this.isElementInViewport(q);}var r=q.getBoundingClientRect(),m=Math.min(r.bottom,window.innerHeight)-Math.max(0,r.top),o=Math.min(r.right,window.innerWidth)-Math.max(0,r.left),p=q.offsetHeight,s=q.offsetWidth;return p*n<=m&&s*n<=o;},extendDeep:function(m){m=m||{};for(var o=1;o<arguments.length;o++){var p=arguments[o];if(!p){continue;}for(var n in p){if(p.hasOwnProperty(n)){if(typeof p[n]==="object"&&!Array.isArray(p[n])){m[n]=this.extendDeep(m[n],p[n]);}else{m[n]=p[n];}}}}return m;},urlBase64ToUint8Array:function(s){var q=p("=",(4-s.length%4)%4);var m=(s+q).replace(/\-/g,"+").replace(/_/g,"/");var r=window.atob(m);var o=new Uint8Array(r.length);for(var n=0;n<r.length;++n){o[n]=r.charCodeAt(n);}return o;function p(u,v){var t="";while(v-->0){t+=u;}return t;}},deferred:function(){var n,m;return{promise:new Promise(function(p,o){n=p;m=o;}),resolve:n,reject:m};},getAttributesFromElement:k,getFormData:g,parseJson:h};});define("OK/utils/vanilla",["OK/AjaxNavigationLog"],function(d){function m(p){var n=[],r=function(s,t){n.push(encodeURIComponent(s)+"="+encodeURIComponent(t));};for(var o in p){if(p.hasOwnProperty(o)){var q=p[o];if(Array.isArray(q)){q.forEach(r.bind(null,o));}else{r(o,p[o]);}}}return n.join("&");}function l(n){var r=[],p=n&&n.indexOf("?");if(p>-1){var q=n.substr(p+1),o=q.split("&");o.forEach(function(t){if(t.indexOf("=")>-1){var s=t.split("="),u=s[0],v=s[1];v=decodeURIComponent(v.replace(/\+/g,"%20"));r[u]=v;}});}return r;}function k(s,n){var w=s.type||"POST",u=s.data||{},p=s.url||"",o=/^(https?:)?\/\//.test(p),v={xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},r=s.headers||{},q={},x=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,z=s.beforeOpen,y=new XMLHttpRequest();if(!n){n=function(B){if(OK.navigation.redirect){OK.navigation.redirect(B);}else{document.location.href=decodeURIComponent(B);}};}if((w==="POST")&&(typeof u!=="string")){if(s.isFileUpload){r["Content-Type"]="application/octet-stream";var t=(u.name||"1.jpg").replace(/[^\u0000-\u007F]+/gi,"_").substring(0,255);r["Content-Disposition"]='attachment; filename="'+t+'"';}else{r["Content-Type"]="application/x-www-form-urlencoded";if(window.pageCtx.gwtHash){u["gwt.requested"]=window.pageCtx.gwtHash;}u=m(u);}}if(s.contentType&&v.hasOwnProperty(s.contentType)&&!r.hasOwnProperty("Content-Type")){r["Content-Type"]=v[s.contentType];}if(s.dataType&&v.hasOwnProperty(s.dataType)&&!r.hasOwnProperty("Accept")){r.Accept=s.dataType==="*"?v[s.dataType]:v[s.dataType]+", */*; q=0.01";}if(!o&&!r.hasOwnProperty("TKN")){r.TKN=OK.tkn.get();}var A=new Promise(function(D,C){var B=Date.now();if(z){z({xhr:y});}y.open(w,p,true);for(var E in r){if(r.hasOwnProperty(E)){y.setRequestHeader(E,r[E]);}}y.onreadystatechange=function(){if(y.readyState===XMLHttpRequest.HEADERS_RECEIVED){var I=y.getAllResponseHeaders(),G;while(G=x.exec(I)){q[G[1].toLowerCase()]=G[2];}if(!o&&q["redirect-location"]){n(q["redirect-location"]);C(y,y.statusText,"Redirect");return;}}if(y.readyState!==XMLHttpRequest.DONE){return;}if(y.status>=200&&y.status<300||y.status===304){d.log(Date.now()-B,p);var F=y.responseText,J=F;if(s.dataType==="json"){try{J=JSON.parse(F);}catch(H){C(H);}}if(!o&&q.tkn){OK.tkn.set(q.tkn);}D({response:J,xhr:y});}else{C(y);}};y.onerror=function(){C(y);};y.send(u);});A.xhr=y;return A;}function i(n,o){return k({type:"GET",dataType:"json",url:n,data:o});}function e(o,n,p){if(!o||o.nodeType===3||o.nodeType===8){return;}var q=document.createEvent("CustomEvent");q.initCustomEvent(n,true,true,p);o.dispatchEvent(q);}function c(o){var n=document.createElement("div");n.innerText=o;return n.innerHTML;}function a(o){var n=o.getResponseHeader(OK.navigation.HEADER);if(n){return n.split(",");}return null;}function h(p,o){var n=p.split(OK.navigation.SPLITER);n.forEach(function(q,r){if(o[r]){OK.hookModel.setHookContent(o[r],q);}});}function g(n){return n.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'");}function b(o){return o.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ");}function f(o){var n=a(o.xhr);if(n){h(o.response,n);}}function j(n){return Array.prototype.slice.apply(n.getElementsByTagName("input")).reduce(function(p,o){if(o.name){p[o.name]=o.type==="checkbox"?(o.checked?"on":"off"):o.value;}return p;},{});}return{ajax:k,getJSON:i,trigger:e,encodeHtml:c,extractParams:l,getBlockIds:a,updateBlocks:h,updateBlockModelCallback:f,getFormData:j,unescapeXml:g,formatNumber:b};});define("OK/utils/throttle",[],function(){
/*!
     * jQuery throttle / debounce - v1.1 - 3/7/2010
     * http://benalman.com/projects/jquery-throttle-debounce-plugin/
     *
     * Copyright (c) 2010 "Cowboy" Ben Alman
     * Dual licensed under the MIT and GPL licenses.
     * http://benalman.com/about/license/
     */
return function a(c,d,h,g){var f,b=0;if(typeof d!=="boolean"){g=h;h=d;d=undefined;}return function e(){var m=this,k=Date.now()-b,l=arguments;function j(){b=Date.now();h.apply(m,l);}function i(){f=undefined;}if(g&&!f){j();}if(f){clearTimeout(f);}if(g===undefined&&k>c){j();}else{if(d!==true){f=setTimeout(g?i:j,g===undefined?c-k:c);}}};};});define("OK/utils/debounce",["OK/utils/throttle"],function(b){return function a(c,d,e){return e===undefined?b(c,d,false):b(c,e,d!==false);};});define("OK/utils/requireBlock",["OK/utils/utils"],function(a){function d(){a.ajax({url:this.getAttribute("data-url")}).done(a.updateBlockModelCallback);}function c(e){e.removeEventListener("click",d);}function b(e){e.addEventListener("click",d);}return{activate:b,deactivate:c};});define("OK/utils/dom",[],function(){function f(i,k){if(i){if(i.nodeType==11){var h=[];for(var l=0;l<i.childNodes.length;l++){var j=i.childNodes[l];if(j.getElementsByClassName){h=h.concat(Array.prototype.slice.call(j.getElementsByClassName(k)));}}return h;}return Array.prototype.slice.call(i.getElementsByClassName(k));}return[];}function g(h,i){var j=f(h,i);return j.length?j[0]:null;}function d(h,i,k,j){if(!j){h=h.parentElement;}while(h){if(!i||!h.classList||h.classList.contains(i)){return h;}if(k&&(k===h)){return null;}h=h.parentElement;}return h;}function b(i,j,l,k){if(!k){i=i.parentElement;}while(i){var h=j(i);if(h){return i;}if(l&&(l===i)){return null;}i=i.parentElement;}return i;}function e(i,h,l){var k=function(m){return m.getAttribute(h);},j=b(i,k,l,true);return j?k(j):null;}function a(i){if(!Array.isArray(i)){i=[i];}var h;i.forEach(function(j){h=j.parentNode;if(h){h.removeChild(j);}});}function c(h){var i=h.cloneNode(true);h.parentNode.replaceChild(i,h);return i;}return{byClass:f,firstByClass:g,parent:d,traverseParents:b,getParentsAttrValue:e,forEach:function(i,h){Array.prototype.slice.call(i).forEach(h);return i;},innerHeight:function(h){try{return window.getComputedStyle(h,null).getPropertyValue("height");}catch(i){return h.currentStyle.height;}},outerSize:function(k,l,i){var h=l?k.offsetWidth:k.offsetHeight;if(h!==null){if(i){var j=window.getComputedStyle?window.getComputedStyle(k,null):k.currentStyle;h+=l?parseInt(j.marginLeft,10)+parseInt(j.marginRight,10):parseInt(j.marginTop,10)+parseInt(j.marginBottom,10);}return h;}return 0;},remove:a,one:function(j,i,k){j.addEventListener(i,function h(l){l.target.removeEventListener(l.type,h);return k.call(this,l);});},removeAllListeners:c};});define("OK/utils/delegate",[],function(){function c(f){this.listenerMap=[{},{}];if(f){this.root(f);}this.handle=c.prototype.handle.bind(this);}c.prototype.root=function(f){var h=this.listenerMap;var g;if(this.rootElement){for(g in h[1]){if(h[1].hasOwnProperty(g)){this.rootElement.removeEventListener(g,this.handle,true);}}for(g in h[0]){if(h[0].hasOwnProperty(g)){this.rootElement.removeEventListener(g,this.handle,false);}}}if(!f||!f.addEventListener){if(this.rootElement){delete this.rootElement;}return this;}this.rootElement=f;for(g in h[1]){if(h[1].hasOwnProperty(g)){this.rootElement.addEventListener(g,this.handle,true);}}for(g in h[0]){if(h[0].hasOwnProperty(g)){this.rootElement.addEventListener(g,this.handle,false);}}return this;};c.prototype.captureForType=function(f){return["blur","error","focus","load","resize","scroll"].indexOf(f)!==-1;};c.prototype.on=function(f,k,q,h){var n,p,m,o;if(!f){throw new TypeError("Invalid event type: "+f);}if(typeof k==="function"){h=q;q=k;k=null;}if(h===undefined){h=this.captureForType(f);}if(typeof q!=="function"){throw new TypeError("Handler must be a type of Function");}n=this.rootElement;p=this.listenerMap[h?1:0];if(!p[f]){if(n){n.addEventListener(f,this.handle,h);}p[f]=[];}if(!k){o=null;m=e.bind(this);}else{if(/^[a-z]+$/i.test(k)){o=k;m=b;}else{if(/^#[a-z0-9\-_]+$/i.test(k)){o=k.slice(1);m=a;}else{o=k;m=d;}}}var g=p[f];var l,j;var r=false;for(l=g.length-1;l>=0;l--){j=g[l];if((!k||k===j.selector)&&(!q||q===j.handler)){r=true;break;}}if(!r){g.push({selector:k,handler:q,matcher:m,matcherParam:o});}return this;};c.prototype.off=function(g,l,o,j){var m,k,n,h,f;if(typeof l==="function"){j=o;o=l;l=null;}if(j===undefined){this.off(g,l,o,true);this.off(g,l,o,false);return this;}n=this.listenerMap[j?1:0];if(!g){for(f in n){if(n.hasOwnProperty(f)){this.off(f,l,o);}}return this;}h=n[g];if(!h||!h.length){return this;}for(m=h.length-1;m>=0;m--){k=h[m];if((!l||l===k.selector)&&(!o||o===k.handler)){h.splice(m,1);}}if(!h.length){delete n[g];if(this.rootElement){this.rootElement.removeEventListener(g,this.handle,j);}}return this;};c.prototype.handle=function(f){var n,k,p=f.type,q,r,j,m,g=[],o,h="ftLabsDelegateIgnore";if(f[h]===true){return;}o=f.target;if(o.nodeType===3){o=o.parentNode;}q=this.rootElement;r=f.eventPhase||(f.target!==f.currentTarget?3:2);switch(r){case 1:g=this.listenerMap[1][p];break;case 2:if(this.listenerMap[0]&&this.listenerMap[0][p]){g=g.concat(this.listenerMap[0][p]);}if(this.listenerMap[1]&&this.listenerMap[1][p]){g=g.concat(this.listenerMap[1][p]);}break;case 3:g=this.listenerMap[0][p];break;}k=g.length;while(o&&k){for(n=0;n<k;n++){j=g[n];if(!j){break;}if(j.matcher.call(o,j.matcherParam,o)){m=this.fire(f,o,j);}if(m===false){f[h]=true;f.preventDefault();return;}}if(o===q){break;}k=g.length;o=o.parentElement;}};c.prototype.fire=function(f,h,g){return g.handler.call(h,f,h);};var d=(function(f){if(!f){return;}var g=f.prototype;return(g.matches||g.matchesSelector||g.webkitMatchesSelector||g.mozMatchesSelector||g.msMatchesSelector||g.oMatchesSelector);}(Element));function b(g,f){return g.toLowerCase()===f.tagName.toLowerCase();}function e(f,g){if(this.rootElement===window){return g===document;}return this.rootElement===g;}function a(g,f){return g===f.id;}c.prototype.destroy=function(){this.off();this.root();};return c;});define("OK/utils/uuid",[],function(){var b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");function a(){var g=b,e=new Array(36),d=0,f,c;for(c=0;c<36;c++){if(c===8||c===13||c===18||c===23){e[c]="-";}else{if(c===14){e[c]="4";}else{if(d<=2){d=33554432+(Math.random()*16777216)|0;}f=d&15;d=d>>4;e[c]=g[(c===19)?(f&3)|8:f];}}}return e.join("");}return{generate:a};});define("OK/utils/StyleSheet",[],function(){function a(){this.style=document.createElement("style");document.head.appendChild(this.style);this.sheet=this.style.sheet?this.style.sheet:this.style.styleSheet;}a.prototype={set:function(b){var d=this.sheet;for(var c=0;c<b.length;c++){d.insertRule(b[c].el+"{"+b[c].style.join(";")+"}",0);}},clear:function(){var b=this.sheet,c=b.cssRules?b.cssRules:b.rules;while(c.length>0){b.deleteRule(0);}},destroy:function(){this.clear();document.head.removeChild(this.style);this.sheet=null;this.style=null;}};return a;});define("OK/cookie",[],function(){return{setCookie:function(c,d,a,e){var f="",b;if(a){a=a*1000*60*60*24;b=new Date();b.setTime(b.getTime()+(a));f=";expires="+b.toUTCString();}document.cookie=c+"="+encodeURIComponent(d)+f+((e)?";path="+e:"");},readCookie:function(b){var e=b+"=";var a=document.cookie.split(";");for(var d=0;d<a.length;d++){var f=a[d];while(f.charAt(0)==" "){f=f.substring(1,f.length);}if(f.indexOf(e)==0){return f.substring(e.length,f.length);}}return null;},clearCookie:function(a,b){this.setCookie(a,"",0,b);}};});define("OK/LogClicks",["OK/logger","OK/utils/dom"],function(q,h){var j="data-l",m="data-log-click",o="["+j+"],["+m+"]",p="data-force",f="click",i="log.click";function e(r,s,t){if(s&&Object.keys(s).length){r.push(s);if(s.target&&!t.okTarget){t.okTarget=s.target;}}}function l(r){OK.logging.info(f+" "+r);q.success(f,r);}function a(r){OK.logging.info(f+" "+r);q.force(f,r);}function n(r){OK.logging.alert(i+" "+r);q.error(i,r);}function c(s){if(!s){return null;}var r=s.getAttribute(j);if(!r){r=s.getAttribute(m);}return r;}var b={t:"target",ti:"targetId",mB:"mtBlockType",gA:"groupActionType",fF:"feedFeatures",fP:"feedPosition",fD:"feedDetails",fO:"feedOwners",fI:"feedId",".r":"remove",rM:"removeMenu",".c":"content",".k":"comment",re:"reshare",".l":"like",e1:"entity1",e2:"entity2",uL:"userLink",gL:"groupLink",".a":"action"};function k(w){var t=-2;try{if(!w||w.length==0||/^{|^null&/i.test(w)){t=-1;return JSON.parse(w);}t=0;var E={};var y=false;var A=true;var D="";var C="";var x="";var u=w.length;var r=0;var s=0;for(var v=0;v<u;v++){t=1;var B=w.charAt(v);if(y){y=false;s++;}else{if(B=="\\"){if(s>0){if(A){t=2;D+=w.substr(r,s);}else{t=3;C+=w.substr(r,s);}s=0;}r=v+1;y=true;}else{if(B==","){if(A){if(s>0){t=4;D+=w.substr(r,s);s=0;}A=false;}else{if(s>0){t=5;C+=w.substr(r,s);s=0;}A=true;x=b[D];if(x){D=x;}x=b[C];if(x){C=x;}E[D]=C;D="";C="";}r=v+1;}else{s++;}}}}t=6;if(y){n("err: escapeNow - "+w);}else{if(A){if(r!=u){n("err: keyNow - "+w);}}else{if(r<u){t=7;C+=w.substr(r);}x=b[D];if(x){D=x;}x=b[C];if(x){C=x;}E[D]=C;}}return E;}catch(z){n("unkn err: stepN = "+t+", data = "+w+", e = "+z);return{};}}function d(w){var s,u=false,r=[];try{s=c(w.target);if(s){e(r,k(s),w);}var v=w.target.parentElement;while(v){if(v.matches(o)){s=c(v);if(s){e(r,k(s),w);}}if(v.hasAttribute(p)){u=true;}v=v.parentElement;}if(r.length){if(u){a(JSON.stringify(r));}else{l(JSON.stringify(r));}}}catch(t){n(t);}}function g(r){r.addEventListener("click",d,true);OK.clickLog.incCounter();}return{activate:g,getLogDataAsString:c,parseLogData:k,getLogData:function(s){var r=c(s);if(r){return k(r);}},updateLogData:function(r,s){var u=j;if(r.getAttribute(m)){u=m;}var t=JSON.stringify(s);r.setAttribute(u,t);},copyLogData:function(t,s){var r=j;if(t.getAttribute(m)){r=m;}s.setAttribute(r,t.getAttribute(r));},getClosestLogClickElement:function(r){if(r.matches(o)){return r;}else{return h.traverseParents(r,function(s){return s.matches(o);});}},doLogOnElement:function(r){d({target:r});},LOG_ATTR_SELECTOR:o};});define("OK/NewsFetchCoordinator",["OK/logger","OK/cookie"],function(J,Q){var ab="/push?cmd=PeriodicManager&gwt.requested="+window.pageCtx.gwtHash,aG="p_sId",b="p_NLP",D="<!--SP-->",f="<!--SSP-->",aF=0,F=1,H=2,Z="TZD",aC="TZ",at="TD",e=30,ae={responseText:"",open:function(){},setRequestHeader:function(){},send:function(){},abort:function(){},getResponseHeader:function(){}},ao={pos:0,size:0,adaptive:0,tmzOffset:0,sum:0,values:[],updateDiff:function(aL){var aK=new Date(),aJ;var aM=aK.getTime()-aL;this.tmzOffset=-aK.getTimezoneOffset();this.values[this.pos++]=aM;this.pos%=20;this.sum+=aM;if(this.size<20){this.size++;}else{this.sum-=this.values[this.pos];}aJ=~~(this.sum/this.size);if(this.adaptive!==aJ){this.adaptive=aJ;return true;}return false;},getTimeZoneHh:function(){var aJ=~~(this.tmzOffset/e);if(aJ<-24||aJ>28){J.error("NFCI_TZ");}return aJ;},getTimeDiff:function(){if(isNaN(this.adaptive)){J.error("NFCI_TD");}return this.adaptive;}},G=100,o=5000,ad=0,a=0,w=false,aw=2097152,y=2,d=[],u=0,an=150000,s=180000,E=180000,k=0,ak=60000,p=180000,av={},aj=[],X=null,aq=null,aE=null,R=false,al=ae,au=0,am=0,I=aF,i=0,n=0,ay=0,U=0,aH="",C=0,r="LP",m,Y,A,L,B,aD=false,x=false,j=function(){try{return new window.XMLHttpRequest();}catch(aK){J.success("push","xhr");try{return new window.ActiveXObject("Microsoft.XMLHTTP");}catch(aJ){J.error("NFCI_AXO");return ae;}}},g=function(aJ){if(aJ>=1000){aJ=1000;}else{if(aJ>=500){aJ=500;}else{if(aJ>=100){aJ=100;}else{if(aJ>=50){aJ=50;}else{if(aJ>=10){aJ=10;}}}}}return aJ;},ar=function(aJ){try{if(ao.updateDiff(aJ)){var aK=ao.getTimeZoneHh(),aM=ao.getTimeDiff();Q.setCookie(Z,aK+"."+aM,0,"/");if(x){Q.setCookie(aC,aK,0,"/");Q.setCookie(at,aM,0,"/");}}}catch(aL){J.error("NFCI_AST");}},V=function(){var aJ="",aK;for(aK in av){if(av.hasOwnProperty(aK)){aJ+=aK+"="+av[aK]+"&";}}aJ+="blocks="+aj.join(",")+"&";return aJ+b+"="+a;},af=function(){return aG+"="+ad;},aA=function(){if(R||!ax()){q(o);}},M=function(){if(r==="SSE"){var aK=Date.now();var aJ=I===aF?ak:p;if(aK-aJ<au){p=aB();aE=setTimeout(M,p);return;}if(I===aF){N("Restore connection");J.success("push","restoresse");}if(aD||!S(al.responseText||"")){l("heartbeat-sse-"+aH+n);J.success("push","chunks",n+"_"+g(ay));J.success("push","chunks-all",n+"_"+g(U));if(++n>=y){r="LP";am=aK;}ai(G);}else{aD=true;X=setTimeout(t,0);aE=setTimeout(M,E);J.success("push","check");}}else{R=false;ad=0;l("heartbeat-lp");c(G);}},q=function(aJ){clearTimeout(aq);aq=setTimeout(aA,aJ);},t=function(){if(I!==aF){if(al.readyState===3){ag();}X=setTimeout(t,1000);}},c=function(aJ){G=aJ;q(G);},az=function(){clearTimeout(aq);aq=null;clearTimeout(aE);aE=null;R=false;if(I!==aF){l("stop-sse");}K();},ai=function(aJ){R=false;if(aq){q(aJ);}},aB=function(){return r==="SSE"?(ad==0?s:E):an;},ax=function(){try{N("send");if(r==="LP"&&k>0&&U>2&&w&&Date.now()-am>k){C++;J.success("push","recovery",C+"-"+g(U));aD=false;n=0;ad=0;r="SSE";}var aJ=r==="SSE";if(m){if(m()){return false;}}else{J.error("NFCI_ER","foe-udf");}clearTimeout(aE);p=aB();aE=setTimeout(M,p);R=true;if(Y){P(aJ);}else{J.error("NFCI_ER","prc-udf");ai(o);}}catch(aK){R=false;J.error("NFCI_ER","trc");return false;}return true;},P=function(aJ){al=j();al.open("POST",ab+(aJ?"&sse=true":"")+"&"+af(),true);al.setRequestHeader("Content-Type","application/x-www-form-urlencoded");al.setRequestHeader("Cache-Control","no-cache");al.setRequestHeader("TKN",OK.tkn.get());if(aJ){al.onreadystatechange=al.onprogress=ag;i=0;ay=0;I=F;}else{al.onreadystatechange=ah;}al.send(V());if(aJ&&aD){clearTimeout(X);X=setTimeout(t,0);}},ah=function(){if(al.readyState!==4){return;}if(al.status===200){if(O(al.getResponseHeader("Redirect-Location"))){J.success("push","redirect");ai(o);return;}z(al);ai(G);}else{J.success("push","status",""+al.status);ai(o);}},z=function(aL){var aJ=OK.lss&&OK.lss.isMaster(),aK=""+[aJ?OK.lss.getId():"",aL.responseText,aL.getResponseHeader("Rendered-Blocks"),aL.getResponseHeader("TKN")].join(D);if(aJ){T(aK);}Y(aK,false);},ag=function(){if(al.readyState<3){return;}if(I===F){if(al.status===200){if(O(al.getResponseHeader("Redirect-Location"))){l("redirect-sse");ai(o);return;}I=H;}else{l("status-sse-"+al.status);ai(o);}}else{if(I===H){switch(al.readyState){case 3:S(al.responseText||"");break;case 4:var aJ=G;if(al.status===0){aJ=o;}else{if(!S(al.responseText||"")&&al.getResponseHeader("Rendered-Blocks")){z(al);}}I=aF;ai(aJ);break;}}}},S=function(aM){var aN,aL,aJ,aK=false;while(~(aN=aM.indexOf(f,i))){aL=aM.substring(i,aN);if(aL){aJ=OK.lss&&OK.lss.isMaster();aL=""+[aJ?OK.lss.getId():"",aL].join(D);if(aJ){T(aL);}Y(aL,false);}i=aN+f.length;au=Date.now();aK=true;if(ay<1000){ay++;}if(U<1000){U++;}n=0;}if(i>aw){J.success("push","overflow");}return aK;},T=function(aM){try{localStorage.setItem("firePushContent",aM);}catch(aN){if(A){A();}else{J.error("NFCI_ER","dop-udf");}try{var aP=aN.message||"";var aJ=aM.length,aR="pushData";for(var aQ in localStorage){if(localStorage.hasOwnProperty(aQ)){var aL=localStorage.getItem(aQ).length;aP+="\n"+aQ+"="+aL;if(aL>aJ){aJ=aL;aR=aQ;}}}var aK=aJ;if(aK>3000000){aK=3000000;}else{if(aK>2000000){aK=2000000;}else{if(aK>1000000){aK=1000000;}else{if(aK>500000){aK=500000;}else{if(aK>100000){aK=100000;}else{if(aK>10000){aK=10000;}else{aK=1000;}}}}}}J.clob("push",aP,"NFCI_LSIS_"+aR,""+aK);}catch(aO){J.clob("push",aO.stack,"NFCI_LSISE");}}},l=function(aJ){if(r==="SSE"){I=aF;ad=0;}al.abort();J.success("push","abort",aJ);},O=function(aJ){if(aJ){if(OK.navigation.redirect){OK.navigation.redirect(aJ);}else{document.location.href=decodeURIComponent(aJ);}return true;}return false;},v=0,ap=0,W=0,h=null,aa=function(){var aJ=Date.now();if(v!=0&&aJ-v>ap){if(aE){clearTimeout(aE);aE=setTimeout(M,100);N("wakeup");}}if(v!=0&&!aE&&r==="SSE"){if(aJ-p>au){if(!m||!m()){J.success("push","noconnection");}}}v=aJ;},aI=function(aJ,aK){if(aJ>0&&OK.lss&&OK.lss.isMaster()){if(aJ!=W||!h){K();h=setInterval(aa,aJ);}}else{K();}W=aJ;ap=aK;},K=function(){if(h){clearInterval(h);h=null;}},ac=function(){var aJ=Q.readCookie("dme");return(aJ&&("true"===aJ.toLowerCase()))||document.getElementById("__gwtd__m");},N=function(aJ){if(ac()&&console){console.log(new Date(),aJ);}};return{isMaster:function(){return OK.lss&&OK.lss.isMaster();},getClientServerTimeDiff:function(){return ao.adaptive;},getCurrentServerTime:function(){return Date.now()-this.getClientServerTimeDiff();},updateParam:function(aJ,aK){av[aJ]=aK;},addBlock:function(aJ){aj.push(aJ);if(L){L();}for(var aK=0;aK<d.length;aK++){if(aJ===d[aK]){return;}}if(r==="SSE"){l("upd-block-"+aJ);ai(G);}},setConfiguration:function(aJ){var aM,aL;ad=aJ[aG]||ad;a=aJ[b]||a;an=aJ.p_LPR||150000;G=aJ.fetchTime||100;o=aJ.p_DFF||5000;aw=aJ.p_PSB||2097152;E=aJ.p_SRT||180000;s=aJ.p_SFRRT||180000;k=aJ.p_SLPT||0;y=aJ.p_SMF||2;ak=aJ.p_SWT||60000;x=aJ.sTZDc===true;d=(aJ.cBlocks||"").split(",");p=aB();aM=aJ.p_PSE===true;if(w!==aM){n=0;au=0;if(w&&I!==aF){az();r="LP";c(G);}w=aM;r=w?"SSE":"LP";}if(aJ.serverTime){ar(aJ.serverTime);}aL=aJ.p_CES||0;if(aL!==u){u=aL;B(u);}aI(aJ.p_WDI||0,aJ.p_WDTL||120000);var aK=aJ.params;if(aK){var aN;for(aN in aK){if(aK.hasOwnProperty(aN)){av[aN]=aK[aN];}}}},init:function(aL,aO,aM,aK,aN,aJ){m=aL;Y=aO;A=aM;L=aK;B=aN;aD=aJ;},getStateParamString:af,scheduleFetch:function(){ad=0;c(G);aI(W,ap);},stopScheduling:az};});define("OK/utils/scrollHelper",["jquery"],function(a){return{scrollToVisible:function(g,d){var j=a(d);var i=a(g);var e=i.offset().top;var h=i.scrollTop();var c=i.height();var b=e+c;var f=j.height();var k=j.offset().top;if(k+f>b){i.scrollTop(h+k+f-e-c+5);}else{if(k<e){i.scrollTop(h+k-e-5);}}},scrollInLoadMoreDataPosition:function(d){var b=a(d);var c=d.scrollHeight-b.scrollTop()-b.height();return c<=200;},isScrollingVisible:function(d){var b=d.offsetHeight||0;var c=d.scrollHeight||0;return c>b;}};});define("OK/suggest/suggestImpl",["jquery","OK/utils/scrollHelper"],function(b,a){return function(ap,J,ac){var ar={selectOnReload:false,correctSelection:true,minSearchQueryLength:0,getMaxItemsInSuggest:function(){return 5;},getMaxSelectedFriends:function(){return 5;},getMarkFriendDisabledMsg:function(){return"";},getSearchQuery:function(){return"";},onItemsChanged:function(){},onItemClicked:function(aB){},onSelectedItemChanged:function(aB){},onLoadingChanged:function(aB){},onSearchProgressChanged:function(aB){},onSearchInputChanged:function(){}};J=b.extend(J,b.extend(ar,J));var m=J.elementId;var at="mm_"+m,q="mo_"+m,F="mc_"+m;var N=J.selectOnReload;var aw=J.correctSelection;var ao=J.customCls||"";var ag=J.suggestElId||m;var ak=J.messageElId||m+"_msg";var ad=J.itemsElId||m+"_itms";var X=J.loadingElId||m+"_loading";function j(aB){return m+"_"+aB;}var Y=true;var c=J.getMaxItemsInSuggest()<=0;var C;var I;var aA;var U=false;var af;var w;var L;var aj;var D=[];var s=[];var ai=-1;var T=false;var ab;var am;function ae(){if(0<=ai&&ai<D.length){return ap.getItemById(D[ai]);}return null;}function Z(){if(am){return am;}am=b("#"+ag);if(am.length>0){if(c){var aC;var aB=function(){if(Y&&!aA&&aj&&a.scrollInLoadMoreDataPosition(am[0])){l(L);}};am.scroll(function(){if(aC){clearTimeout(aC);}aC=setTimeout(aB,300);});}}else{am=null;}return am;}function z(){if(c){if(Y&&!aA&&aj){var aB=Z();if(aB&&!a.isScrollingVisible(aB[0])){l(L);}}}}function W(aK,aE,aD){var aI=ai>=0&&ai<D.length?D[ai]:-1;Z();L=aK;aj=aD;if(D.length==aE.length||!c&&D.length>=J.getMaxItemsInSuggest()&&aE.length>=J.getMaxItemsInSuggest()){if(aE.length===0&&D.length===0){return false;}var aB={};var aJ;var aG=0;for(aJ=0;aJ<aE.length;aJ++){aB[aE[aJ]]=true;if(!c){if(!s[aE[aJ]]){aG++;}if(aG>=J.getMaxItemsInSuggest()){break;}}}var aC;var aH=0;for(aJ=0;aJ<D.length;aJ++){if(!aB[D[aJ]]){aC=true;break;}if(!c){if(!s[D[aJ]]){aH++;}if(aH>=J.getMaxItemsInSuggest()){break;}}}if(!c&&(aH!=aG||aH>=J.getMaxItemsInSuggest())){aC=true;}aJ=null;if(!aC){return false;}}ai=-1;T=true;var aF=D.length>0&&aE.length===0;p(aE);aF=aF||D.length>0;al(aI,false);V();if(aF){J.onItemsChanged();}return aF;}function p(aC){var aE="";var aG=0;D=[];var aF=0;for(var aD=0;aD<aC.length;aD++){var aI=aC[aD];var aL=ap.getItemById(aI);if(!aL){continue;}if(!c){if(!s[aI]){aF++;}if(aF>J.getMaxItemsInSuggest()){break;}}var aJ=v(aI,aG++,aL);var aH=document.createElement("div");aH.appendChild(aJ);aE+=aH.innerHTML;D.push(aI);}if(c){var aB=document.createElement("div");aB.appendChild(t());aE+=aB.innerHTML;}var aK=b("#"+ad);if(!J.mention||aK.html()!==aE){aK.html(aE);}}function H(){var aC=0;for(var aB=0;aB<D.length;aB++){if(!s[D[aB]]){aC++;}}return aC;}function av(aH,aC){Z();aj=aC;var aE;var aB=D.length;var aD=b("#"+ad);var aG=H();var aK;if(c){aK=b("#"+X);}for(var aF=0;aF<aH.length;aF++){var aI=aH[aF];var aL=ap.getItemById(aI);if(!aL){continue;}if(!c){if(!s[aI]){aG++;}if(aG>J.getMaxItemsInSuggest()){break;}}var aJ=v(aI,aB++,aL);if(c&&aK){aK.parent().remove();aK=null;}aD.append(aJ);D.push(aI);aE=true;}if(c&&aE){aD.append(t());}al(null,true);V();if(aE){J.onItemsChanged();}}function t(){var aB=document.createElement("li");aB.className="suggest_li "+(aA?"":" invisible");if(!J.disableLoadingProgress){aB.innerHTML='<div id="'+X+'" class="loader-controls in-progress"><div class="link-show-more_loading"><span class="fetching-hor">***</span></div></div>';}return aB;}function v(aE,aC,aD){aD.visible=!s[aE];var aB=document.createElement("li");aB.className="suggest_li"+(aD.visible?"":" invisible");aB.innerHTML=ac.createItemElement(aD);aB.setAttribute("id",j(aE));aB.setAttribute("onmousemove","OK.il.f(event,'"+at+"', "+aC+");");aB.setAttribute("onmouseover","OK.il.f(event,'"+q+"', "+aC+");");aB.setAttribute("onclick","OK.il.f(event,'"+F+"', "+aC+");");return aB;}function S(aD,aC){var aB=b("#"+j(aD));if(aB.length===0){return false;}aB.toggleClass("invisible",!aC);}function ax(aD){var aB=b("#"+j(aD));if(aB.length===0){return false;}var aC=!s[aD];S(aD,aC);return true;}function k(aE,aB){var aC=ap.getItemById(aE);var aD=b("#"+j(aE));ac.setItemSelected(aC,aD,aB);}function aa(aB){var aD=D[aB];var aC=ap.getItemById(aD);return aC.disabled;}function M(aB){return s[D[aB]];}function K(aB){return !M(aB)&&!aa(aB);}var az={id:at,handlerId:"h"+this.id,handle:function(aC,aB){if(C){return;}T=false;}};var P={id:q,handlerId:"h"+this.id,handle:function(aC,aB){if(C||I){return;}if(0<=aB&&aB<D.length){if(ai!==aB&&K(aB)){T=false;R(aB);}}}};var ay={id:F,handlerId:"h"+this.id,handle:function(aC,aB){if(C){return;}if(0<=aB&&aB<D.length&&K(aB)){T=false;R(aB);var aE=aC.target;var aD;while(aE!=null&&!aE.getAttribute("id")){aD=aE.getAttribute("data-action");if(aD){break;}aE=aE.parentNode;}J.onItemClicked(ap.getItemById(D[aB]),aD);}}};OK.il.ah(az);OK.il.ah(P);OK.il.ah(ay);function E(){OK.il.rh(az);OK.il.rh(P);OK.il.rh(ay);}function al(aF,aE){if(D.length===0){if(ai!==-1){R(-1);}return;}if(!aw){if(!aE){R(-1);}return;}if(N&&aF&&aF!=-1){for(var aC=0;aC<D.length;aC++){if(aF==D[aC]){if(K(aC)){R(aC);}return;}}return;}if(ai===-1){for(var aC=0;aC<D.length;aC++){if(K(aC)){R(aC);break;}}return;}if(M(ai)){for(var aB=ai+1;aB<D.length;aB++){if(K(aB)){R(aB);return;}}for(var aD=ai-1;aD>=0;aD--){if(K(aD)){R(aD);return;}}R(-1);}}function i(){if(D.length===0){return;}if(ai===-1){return;}for(var aB=ai-1;aB>=0;aB--){if(K(aB)){T=true;R(aB);break;}}}function au(){if(D.length===0){return;}for(var aB=ai+1;aB<D.length;aB++){if(K(aB)){T=true;R(aB);break;}}}function d(aC){for(var aB=0;aB<D.length;aB++){if(D[aB]==aC){if(K(aB)){T=true;R(aB);}break;}}}function R(aD){if((typeof aD)==="string"){aD=+aD;}var aE=ai!==aD;if(ai>=0&&ai<D.length){var aB=D[ai];if(aB){if(!aE){k(aB,!C);return;}k(aB,false);}}ai=-1;if(aD>=0&&aD<D.length){var aF=D[aD];var aC=!aF;if(aC||!K(aD)){return;}k(aF,!C);ai=aD;J.onSelectedItemChanged(ap.getItemById(aF));if(aE){V();}}}function V(){if(c&&T){var aC;if(ai>=0&&ai<D.length){aC=ai;}else{if(ai==-1){aC=0;}else{return;}}var aB=D[aC];if(aB){var aE=b("#"+j(aB));if(aE.length>0){var aD=Z();a.scrollToVisible(aD[0],aE[0]);}}}}var B=-1;var e=1;var O=2;var an=3;var u=4;var h=5;var n=function(aD,aH){var aC;var aB;ab=aD;var aF=aD.query;var aE=aD.itemIds;var aI=aD.hasMore;if(aF===L){av(aH,aI);aB=O;}else{if(aF==J.getSearchQuery()||aF.toString()==J.getSearchQuery().toString()){var aG=W(aF,aE,aI);aB=aG?an:u;}else{aC=true;aB=h;}}ah(false,true,aF,aB,aD);if(!aC){z();}};var o=function(aB,aC){w=aB;ah(false,false,aC,B);};function l(aC){ah(true,true,aC,e);aC=aC||J.getSearchQuery();var aB;if(J.getMaxItemsInSuggest()>0){aB=J.getMaxItemsInSuggest()+J.getMaxSelectedFriends();}else{aB=0;}ap.search(aC,aB,n,o);}function y(){var aB=L;L=null;l(aB);}function A(aB){if(Y!=aB){Y=aB;x();}}function ah(aF,aE,aD,aB,aC){if(aA!=aF){aA=aF;x();g();J.onLoadingChanged(aA,aE,aD,aB,aC);}}function f(aB){if(C!=aB){C=aB;x();}}function Q(aB){if(I!=aB){I=aB;}}function r(aB){if(U!=aB){U=aB;x();}}function G(aB){if(af!=aB){af=aB;aq();}}function x(){var aB=b("#"+ag);aB.toggleClass("__active",Y);aB.toggleClass("__disabled",C||aA);aB.toggleClass("__message",U);}function g(){if(!c||J.disableLoadingProgress){return;}var aC=b("#"+X);if(aC.length==0){return;}aC.toggleClass("invisible",!aA);if(aA){var aB=Z();if(aB){}}}function aq(){b("#"+ak).html(af);}return{createHtml:function(){return'<div id="'+ag+'" class="suggest'+(Y?" __active":"")+(c?" __scroll":"")+(C||aA?" __disabled":"")+(ao?" "+ao:"")+(U?" __message":"")+'"><div id="'+ak+'" class="suggest_tx">'+(af?af:"")+'</div><ul id="'+ad+'" class="suggest_ul"></ul></div>';},resetSelection:function(){var aC=Z();if(aC){aC.scrollTop(0);for(var aB=0;aB<D.length;aB++){if(K(aB)){R(aB);break;}}}},isVisible:function(){return !!Y;},setVisible:function(aB){A(aB);},setDisabled:function(aB){f(aB);},setMouseOverDisabled:Q,isMessageVisible:function(){return !!U;},setMessageVisible:function(aB){r(aB);},setMessage:function(aB){G(aB);},search:function(aB){l(aB||J.getSearchQuery());},isSearchDisabled:function(){return !!w;},getDisplayQuery:function(){return L;},hasVisibleItems:function(){for(var aB=0;aB<D.length;aB++){if(!s[D[aB]]){return true;}}return false;},hasHiddenItems:function(){for(var aB=0;aB<D.length;aB++){if(s[D[aB]]){return true;}}return false;},setHiddenItemId:function(aD,aC){var aB=(aC!=s[aD]);if(aB){s[aD]=aC;if(ax(aD)){if(!c){y();}else{al();J.onItemsChanged();if(aC){z();}}}}},resetHiddenItemIds:function(aD){aD=aD||{};var aC=s;s=aD;var aF;for(var aB=0;aB<D.length;aB++){var aE=D[aB];if(s[aE]&&!aC[aE]||!s[aE]&&aC[aE]){if(ax(aE)){aF=true;}}}if(aF){if(!c){y();}else{al();J.onItemsChanged();z();}}},resetItems:function(aB,aC){p(aB||D);_selectedItemId=-1;if(typeof aC!="undefined"){L=aC;}},getItemElId:j,selectPrevious:i,selectNext:au,selectItemById:d,getSelectedItem:ae,getSearchEntry:function(aB){return aB?ap.getSearchEntry(aB):ab;},SEARCH_RESULT_ERROR:B,SEARCH_RESULT_LOADING:e,SEARCH_RESULT_APPEND_ITEMS:O,SEARCH_RESULT_SET_ITEMS:an,SEARCH_RESULT_SET_ITEMS_CACHED:u,SEARCH_RESULT_UNKNOWN:h,destroy:function(){E();ap.clearCaches();J=null;}};};});define("OK/suggest/searchEngines",["jquery","OK/utils/utils","OK/utils/vanilla"],function(b,h,f){function c(l,k,m,n){return i("/dk?cmd="+l,k,m,n);}function e(l){var k=l.address;if(l.distance){if(k.length>0){k+=" ("+l.distance+")";}else{k=l.distance;}}l.latitude=parseFloat(l.latitude);l.longitude=parseFloat(l.longitude);l.text=f.encodeHtml(l.name);l.smallText=l.categoryName;l.smallText2=f.encodeHtml(k);}function g(m){for(var k=0;k<m.length;k++){var l=m[k];l.imageSrc=l.photo;l.text=f.encodeHtml(l.name);l.ui=""+l.id;l.ul=0+l.id;l.uf=f.encodeHtml(l.name);l.mkto=true;}}function j(k){k.id=k.ui;k.imageSrc=OK.userCache.getLinkOnUserAvatar(k);k.text=k.uf;var l=k.mkto;if(!l){k.disabled=true;}}function i(r,k,o,p){var q={};var m={};function n(w,t,y,z){if(!q[w]){q[w]={query:w,index:0,itemIds:[],hasMore:true,requestId:""};}var v=q[w];if(!v.hasMore||(t&&v.itemIds.length>=t)){y(v,[]);return v;}var x="search-d-"+new Date().getTime();v.requestId=x;var s={"gwt.requested":window.pageCtx.gwtHash,refId:v.requestId};var u=l.prepareRequest(w,v,s);if(u===false){return;}h.ajax({type:"POST",url:r,data:s,dataType:k,timeout:10000}).done(function(C,A,J){var B=J.getResponseHeader("TKN");if(B){OK.tkn.set(B);}if(v.requestId!==x||q.length==0){z(false,w);return;}var D;if(k=="html"){D=OK.util.parseJSON(C);}else{if(k=="json"){D=C;}}var G=l.processResponse(D,v);if(G){var F=[];for(var E=0;E<G.length;E++){var I=G[E];var H=I.id;v.itemIds.push(H);F.push(H);m[H]=I;}y(v,F);}else{z(true,w);}}).fail(function(A,C,B){z(false,w);});return v;}var l={search:n,prepareRequest:o,processResponse:p,clearCaches:function(){q={};m={};},getItemById:function(s){return m[s];},getSearchEntry:function(s){return q[s];}};return l;}function a(n,o){var p={};var l={};function m(u,r,v,w){if(!p[u]){p[u]={query:u,index:0,itemIds:[],requestId:""};}var t=p[u];if(t.itemIds.length){v(t,[]);return t;}t.requestId="search-d-"+new Date().getTime();var q={refId:t.requestId};var s=k.prepareRequest(u,t,q);if(s===false){return;}require(["OK/YandexMapsApi"],function(x){x.then(function(y){y.suggest(q.request,q.options).then(function(C){var z=k.processResponse(C,t);if(z){var D=[];for(var A=0;A<z.length;A++){var B=z[A];var E=B.id;t.itemIds.push(E);D.push(E);l[E]=B;}v(t,D);}else{w(true,u);}},function(){w(true,u);});});});return t;}var k={search:m,prepareRequest:n,processResponse:o,clearCaches:function(){p={};l={};},getItemById:function(q){return l[q];},getSearchEntry:function(q){return p[q];}};return k;}function d(k){var m={};var l=i("/web-api/suggest/locations/profile","json",function(p,o,n){n.q=o.query;if(k){n.cid=k.value;}},function(p,r){r.hasMore=false;var n=p||[];for(var q=0;q<n.length;q++){var o=n[q];o.id=o.cityId;o.text=o.city;o.smallText=o.regions?o.regions+", "+o.country:o.country;if(o.city){m[o.city.trim().toLowerCase()]=o;}}return n;});l.locationByCityCache=m;return l;}return{createSearchEngine:c,createYandexSearchEngineEndpoint:a,locationsSearchEngine:d(),createLocationsSearchEngine:d,friendsSearchEngine:c("FriendsSearch","html",function(n,m,l){var k="d.in";b.extend(l,{"d.sq":m.query,"d.o":m.index,"d.d":k});},function(l,k){var t=l.searchEnabled;if(t===false){return null;}var p=l["jsp.cc"];var s=l["jsp.stc"]||0;k.index=k.index+p;k.hasMore=k.index<s;k.totalCount=s;var q=[];var n=l["jsp.sr"]||[];var r=l["jsp.sl"]||[];if(r.length){r.forEach(function(u){n[u.ui]=u;});}OK.userCache.updateUserCache(n);if(!r.length){for(var o in n){if(Object.prototype.hasOwnProperty.call(n,o)){var m=n[o];j(m);q.push(m);}}}else{r.forEach(function(u){j(u);q.push(u);});}return q;}),prepareUsersForRenderer:function(l){for(var k=0;k<l.length;k++){j(l[k]);}},mentionsEngine:c("FriendsSearch","html",function(n,m,l){var k="d.in";b.extend(l,{"d.sq":m.query,"d.o":m.index,"d.d":k,"d.wg":"on"});},function(m,k){var v=m.searchEnabled;if(v===false){return null;}var q=m["jsp.cc"];var u=m["jsp.stc"]||0;k.index=k.index+q;k.hasMore=k.index<u;k.totalCount=u;var r=[];var o=m["jsp.sr"]||[];var t=m["jsp.sl"]||[];var l={};if(!t.length){for(var p in o){if(Object.prototype.hasOwnProperty.call(o,p)){var n=o[p];if(!n.group){l[p]=n;}}}}else{t.forEach(function(w){l[w.ui]=w;});}OK.userCache.updateUserCache(l);function s(w,x){w.id=w.ul;if(w.group){var z=w.photo;if(z){w.imageSrc=z;}}else{w.imageSrc=OK.userCache.getLinkOnUserAvatar(w);}w.text=w.uf;var y=w.mkto;if(!y){w.disabled=true;}x.push(w);}if(!t.length){for(p in o){if(Object.prototype.hasOwnProperty.call(o,p)){s(o[p],r);}}}else{t.forEach(function(w){s(w,r);});}return r;}),conversationsSearchEngine:c("ConversationsSearch","html",function(m,l,k){b.extend(k,{"st.query":l.query,"st.count":l.index});if(l.forwardMarker){b.extend(k,{"st.lastelem":l.forwardMarker});}},function(m,o){var p=m["jsp.cc"];o.hasMore=m["jsp.hm"];o.index=o.index+p;o.forwardMarker=m["jsp.fwd"];var l=[];var q=m["jsp.ch"];for(var n=0;n<q.length;++n){var k=q[n];k.disabled=false;k.mkto=true;k.uf=k.text;k.ui=k.id;k.ul=k.id;l.push(k);}return l;}),placesSearchEngine:c("PostingFormPlacesSearch","json",function(m,l,k){k["d.sq"]=m.query;k["d.o"]=l.index;k["ps.pin"]=m.pin;if(m.coords){k["ps.lt"]=m.coords[0];k["ps.lng"]=m.coords[1];}},function(m,p){var l=m.searchEnabled;if(l===false){return null;}var q=m["jsp.scc"]||0;var n=m["jsp.sr"]||[];var k=Math.min(m["jsp.stc"]||0,200);p.index=p.index+q;p.hasMore=p.index<k;p.totalCount=k;p.realTotalCount=m["jsp.str"]||0;for(var o=0;o<n.length;o++){e(n[o]);}return n;}),preparePlaceForRenderer:e,groupsSearchEngine:c("SearchCrossPostingGroups","json",function(m,l,k){k["d.sq"]=l.query;k["d.o"]=l.index;},function(m,o){if(m.searchEnabled===false){return null;}var q=m["jsp.cc"]||0;var l=m["jsp.stc"]||0;o.index=o.index+q;o.hasMore=o.index<l;o.totalCount=l;var k=m["jsp.sr"]||[];for(var n=0;n<k.length;n++){var p=k[n];p.imageSrc=p.photo;p.text=f.encodeHtml(p.name);}return k;}),userGroupsSearchEngine:i("/web-api/suggest/groups/portal","json",function(m,l,k){k.q=l.query;},function(l,n){n.hasMore=false;var k=l||[];for(var m=0;m<k.length;m++){var o=k[m];o.text=f.encodeHtml(o.name);}return k;}),prepareAdvertSelectionForRenderer:g,advertCatalogSearchEngine:function(k){return c("AdvertCatalogsSearch","json",function(n,m,l){l["d.sq"]=m.query;l["d.fwd"]=m.forwardMarker;l["d.gr"]=k;},function(l,n){if(l.searchEnabled===false){return null;}n.totalCount=l["jsp.stc"]||0;n.hasMore=l["jsp.hm"];n.forwardMarker=l["jsp.fwd"];var m=l["jsp.sr"]||[];g(m);return m;});},commentMentionsEngine:function(k){return c("ParticipantsSearch","html",function(o,n,l){var m=k();h.extendDeep(l,{"st.query":n.query,"st.did":m});},function(n,l){var w=n.searchEnabled;if(w===false){return null;}var s=n["jsp.cc"];var v=n["jsp.stc"]||0;l.index=l.index+s;l.hasMore=l.index<v;l.totalCount=v;var t=[];var q=n["jsp.sr"]||{};var m={};for(var r in q){if(Object.prototype.hasOwnProperty.call(q,r)){var o=q[r];if(!o.group){m[r]=o;}}}OK.userCache.updateUserCache(m);for(var r in q){if(Object.prototype.hasOwnProperty.call(q,r)){var o=q[r];o.id=r;if(o.group){var p=o.photo;if(p){o.imageSrc=p;}}else{o.imageSrc=OK.userCache.getLinkOnUserAvatar(o);}o.text=o.uf;var u=o.mkto;if(!u){o.disabled=true;}t.push(o);}}return t;});}};});define("OK/suggest/renderers",[],function(){function c(d){this.options=d;return this;}c.prototype.createItemElement=function(d){return'<div class="ucard-mini'+(d.selected?" __selected":"")+(d.disabled?" __na":"")+'">'+(d.imageSrc?'<img class="ucard-mini_img" src="'+d.imageSrc+'" alt="Image" width="32" height="32">':(d.stub?'<div class="ucard-mini_img '+d.stub+'"></div>':""))+'<div class="ucard-mini_cnt"><div class="ucard-mini_cnt_i ellip">'+(d.text?d.text:"")+"</div>"+(d.smallText?'<div class="ucard-mini_info">'+d.smallText+"</div>":"")+"</div></div>";};c.prototype.setItemSelected=function(e,f,d){f.find(".ucard-mini").toggleClass("__selected",d);};function a(d){this.options=d;return this;}a.prototype.createItemElement=function(d){return'<div class="ucard-mini'+(d.selected?" __selected":"")+(d.disabled?" __na":"")+'">'+d.image+'<div class="ucard-mini_cnt"><div class="ucard-mini_cnt_i ellip">'+(d.text?d.text:"")+"</div>"+(d.smallText?'<div class="ucard-mini_info">'+d.smallText+"</div>":"")+"</div></div>";};a.prototype.setItemSelected=function(e,f,d){f.find(".ucard-mini").toggleClass("__selected",d);};function b(d){this.options=d;return this;}b.prototype.createItemElement=function(d){return'<div class="ucard-v __xxs __h'+(d.selected?" __selected":"")+(d.disabled?" __na":"")+'">'+(d.imageSrc?'<div class="section"><div class="photo"><img class="photo_img" src="'+d.imageSrc+'" alt="Image" width="32" height="32"></div></div>':"")+'<div class="caption"><div class="ellip">'+(d.text?d.text:"")+"</div>"+(d.smallText?'<div class="info ellip">'+d.smallText+"</div>":"")+"</div></div>";};b.prototype.setItemSelected=function(e,f,d){f.find(".ucard-v").toggleClass("__selected",d);};return{MiniCard:c,UCard:b,ConversationCard:a};});define("OK/postingForm/mentions",["jquery","OK/suggest/suggestImpl","OK/suggest/searchEngines","OK/suggest/renderers","OK/logger"],function(g,f,h,e,l){var b="mediatopic.m";var a="pform_name";var d="__active";var c="data-name";var i=g("<span class='"+a+" o'></span>").get(0);var j=new RegExp("[W#$%!^&*()_+'']");function k(m){var q={ELEMENT_NODE:1,TEXT_NODE:3};function o(w){return w.nodeType==q.TEXT_NODE;}function t(x,w){return x.nodeType==q.ELEMENT_NODE&&x.tagName.toUpperCase()==w;}function n(w){return t(w,"BR");}function u(z){var y=t(z,"SPAN");if(y){var x=g(z);var w=!x.contents().is(function(){return !o(this);});if(w){if(z.className==a+" o"){x.removeAttr("style");return true;}else{return false;}}}return false;}function p(x){var y=t(x,"DIV");if(y){var w=g(x);w.removeAttr("style");w.removeAttr("class");}return y;}function r(w){return o(w)||n(w)||u(w);}function s(w){return p(w)&&!g(w).contents().is(function(){return !r(this);});}while(true){var v=m.contents().not(function(){return r(this)||s(this);});if(v.length==0){break;}v.filter(function(){return this.nodeType!=q.ELEMENT_NODE;}).remove().end().filter(function(){return this.nodeType==q.ELEMENT_NODE;}).replaceWith(function(){var w=g(this).contents();if(this.tagName.toUpperCase()=="DIV"||this.tagName.toUpperCase()=="P"){return w.filter(function(){return r(this);}).wrap("<div></div>").end();}else{return w;}});}}return function(n){var m={bindStep:0,getDebugStep:function(){return bindStep;},suggestCtx:{onItemClicked:g.noop,onLoadingChanged:g.noop,getMaxSelectedFriends:function(){return 1;},onItemsChanged:g.noop,onSelectedItemChanged:g.noop,getMaxItemsInSuggest:function(){return 5;},getMarkFriendDisabledMsg:function(){return m.markDisabledMsg;},elementId:n||"_mPF",mention:true,customCls:""},suggest:null,suggestElement:null,suggestElementVisible:false,mentionsCharStart:3,mentionsFirstCharUpperCase:true,cleanupOnPaste:true,redesign:false,customCls:"__mentions",searchTimer:false,searchTimerDelay:0,scMenuWidth:"300px",util:function(){l.error("mt.e","util");},selector:function(){l.error("mt.e","selector");},init:function(q,t,r,o,w){bindStep=1;m.markDisabledMsg=q;m.util=t;m.selector=r;bindStep=2;if(!document.getElementById(m.suggestCtx.elementId)){bindStep=3;var s=e.MiniCard;var u=new s();u.createItemElement=function(x){if(x.group){x.smallText=x.gi;}else{x.smallText=x.disabled?m.markDisabledMsg:"";}return s.prototype.createItemElement(x);};bindStep=4;var v=w!=undefined?w:(o?h.mentionsEngine:h.friendsSearchEngine);m.suggest=f(v,m.suggestCtx,u);bindStep=5;var p="sc-menu "+m.customCls;if(o){m.redesign=true;m.searchTimerDelay=300;p+=" __redesign";}g(document.body).append('<div id="'+m.suggestCtx.elementId+'" class="'+p+'">'+m.suggest.createHtml()+'<div class="sc-menu_arw_w"><div class="sc-menu_arw"></div></div></div>');bindStep=6;m.suggestElement=g("#"+m.suggestCtx.elementId).css({width:m.scMenuWidth});m.suggestElementVisible=true;bindStep=7;}},destroy:function(){m.suggest&&m.suggest.destroy();m.suggest=null;g("#"+m.suggestCtx.elementId).remove();},bind:function(s){var q=false;var C;var w=g(s);bindStep=8;var y=w.parent().find(".pform_name-bg");bindStep=9;if(y.length===0){y=g('<span class="pform_name-bg"></span>');y.insertBefore(w);}bindStep=10;z();bindStep=11;if(!m.selector.supportsRange()){l.success(b,"not_supported");return;}bindStep=12;var p;function v(){w.focus();if(p){m.selector.addRange(p);}}function r(){if(m.util.isFireFox){p=m.selector.getRange();}}if(!m.util.isFireFox){w.on("focusout.mentions",function(){p=m.selector.getRange();});}w.on("keydown.mentions",function(D){if((D.which===13||D.which===9||D.which===27||D.which===38||D.which===40)&&m.suggestElementVisible){D.preventDefault();if(D.which===9){D.stopPropagation();}if(D.which===27){D.stopPropagation();z();}}}).on("keyup.mentions",function(I){var H,G;m.suggestCtx.onItemClicked=g.noop;m.suggestCtx.getSearchQuery=function(){return H?H:"";};m.suggestCtx.onLoadingChanged=function(J){if(!J&&m.suggest.hasVisibleItems()){t(G,I);}if(!m.suggest.hasVisibleItems()){z();}};var E=m.selector.getRange();var D=m.util.getSelectedNode(E,E.startContainer,E.startOffset,true);if(m.util.isSpace(I.which)&&m.util.isSpan(D.parentNode)&&g(D.parentNode).hasClass(a)&&D.parentNode.lastChild===D&&(m.util.isText(D)&&D.nodeValue.length===E.startOffset)){B(D.parentNode,E);I.preventDefault();}H=o(D,E,I,q);if(H&&((H.length>=(m.mentionsCharStart>0?m.mentionsCharStart:3)&&(!m.mentionsFirstCharUpperCase||(m.mentionsFirstCharUpperCase&&H[0].toUpperCase()===H[0]&&!j.test(H[0]))))||H[0]==="@"||H[0]==="+")){var F=x(D,E);if(F){if(I.which===13||I.which===9){q=false;A(F,E);}else{G=F.getBoundingClientRect();l.success(b,"search");if(H[0]==="@"||H[0]==="+"){l.success(b,"trigger");H=H.substr(1);q=m.redesign;}m.searchTimer&&clearTimeout(m.searchTimer);if(!m.redesign||H[0]==="@"||H[0]==="+"||m.searchTimerDelay==0||m.suggestElementVisible){m.searchTimer=false;m.suggest.search(H);}else{m.searchTimer=setTimeout(function(){m.suggest.search(H);},m.searchTimerDelay);}m.suggestCtx.onItemClicked=function(){if(m.util.isInEditor(F.startContainer)){A(F,E);z();}};}}}if(!G||!m.suggest.hasVisibleItems()){z();}m.util.normalizeFont();u(I,E);r();}).on("paste.mentions",function(){setTimeout(function(){if(m.cleanupOnPaste){m.util.cleanWordComments(w);k(w);}r();},50);}).on("click.mentions",function(){w.focus();r();});function o(E,F,J,H){if(J.which===27){return null;}var I=F.startOffset;if(I<=0||!m.util.isText(E)||E.nodeValue.length<=0||!H&&m.util.isSpace(J.which)||g(E).parents("."+a).length!=0){return null;}var D=E.nodeValue;var G=D[I-1];if(!H&&m.util.isSpace(G)){return null;}if(H){for(C=I-1;C>=0;C-=1){if(D[C]=="+"||D[C]=="@"){break;}}}else{for(C=I-1;C>=0;C-=1){if(m.util.isSpace(D.charCodeAt(C))){C+=1;break;}}}if(C<0){C+=1;}return D.substring(C,I);}function x(D,E){var F;if(m.util.isText(D)&&C>=0){F=document.createRange();F.setStart(D,C);F.setEnd(D,E.startOffset);return F;}return null;}function A(F,E){var H,G=m.suggest&&m.suggest.getSelectedItem();if(F&&G&&!G.disabled){document.getSelection().removeAllRanges();document.getSelection().addRange(F);H=i.cloneNode(false);F.surroundContents(H);var D=g(H);D.html(G.un);D.attr(G.group?"data-group-id":"data-user-id",G.ul).attr(c,D.html());B(H,E);}}function B(E,D){var F=document.createTextNode(String.fromCharCode(160));w.focus();m.util.after(E,F);D.setStart(F,1);m.selector.addRange(D);}function t(M,G){var D;if(M){if(m.redesign){var P=w.offset().left;var E=w.width();var O=10;var F=1;var J=(O+F)*2;var I=300;var N=P+E+J>M.left+I;var L=M.bottom+g(window).scrollTop();if(N){m.suggestElement.css({left:M.left-O,top:L});}else{m.suggestElement.css({left:P+E+O*2-I,top:L});}var H=window.innerHeight;var K=m.suggestElement.outerHeight(true);if(L+K>H){m.suggestElement.css({top:L-M.height-K});}}else{m.suggestElement.css({left:M.left-140,top:M.bottom+g(window).scrollTop()});}m.suggestElement.removeClass("sc-menu__hidden");m.suggestElementVisible=true;D=y.parent().get(0).getBoundingClientRect();y.css({top:M.top-D.top-2,left:M.left-D.left,width:M.width,height:M.height});y.toggleClass(d,true);if(G.which==38){m.suggest&&m.suggest.selectPrevious();}else{if(G.which==40){m.suggest&&m.suggest.selectNext();}}l.success(b,"show_menu");}else{z();}}function z(){q=false;m.suggestElement.css({left:0,top:-1000});m.suggestElementVisible=false;m.suggest.resetSelection();y.css({top:0,left:0,width:0,height:0});y.removeClass(d);}function u(G,E){var D,F=true;if(G.which===8&&m.util.isFireFox){D=m.selector.getFocusElement(E);if(g(D).hasClass(a)){g(D.childNodes).each(function(H,I){if(m.util.isText(I)&&I.nodeValue.length>0){F=false;}});if(F&&s.innerHTML.indexOf(D.outerHTML)===0){g(D).replaceWith(document.createTextNode(String.fromCharCode(160)));w.focus();}}}}bindStep=14;return{unbind:function(){w.off(".mentions");y.remove();m.searchTimer&&clearTimeout(m.searchTimer);m.searchTimer=false;},getFocus:function(){return p;},restoreFocus:v,hide:z,log:function(){w.find("span."+a).each(function(D,E){if(this.innerHTML!==g(this).attr(c)){l.success(b,"mention_changed");}});}};}};return m;};});define("OK/suggest/inputChecker",[],function(){return function(i,d,b,e){b=b||0;e=e||500;var a=null;var f=i.val();var j=1;var h=2;var g=3;i.on("input propertychange",function(){var l=i.val();if(f!=l){f=l;k();if(l.length>0&&l.length<b){d(l,j);}else{d(l,h);a=window.setTimeout(c,e);}}});function c(){var l=i.val();if(l.length>0&&l.length<b){return;}f=l;d(l,g);}function k(){if(a){window.clearInterval(a);a=null;}}return{INPUT_CHANGE_MIN:j,INPUT_CHANGE:h,INPUT_TIMER:g,startSearchQueryCheck:function(){f=i.val();},endSearchQueryCheck:k,setInputValue:function(l){f=l;i.val(l);},destroy:function(){i.off();k();}};};});!function(d,g,c){var j=d.L,h={};h.version="0.7.3","object"==typeof module&&"object"==typeof module.exports?module.exports=h:"function"==typeof define&&define.amd&&define("leaflet",h),h.noConflict=function(){return d.L=j,this;},d.L=h,h.Util={extend:function(k){var m,a,q,p,l=Array.prototype.slice.call(arguments,1);for(a=0,q=l.length;q>a;a++){p=l[a]||{};for(m in p){p.hasOwnProperty(m)&&(k[m]=p[m]);}}return k;},bind:function(k,l){var a=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return k.apply(l,a||arguments);};},stamp:function(){var a=0,i="_leaflet_id";return function(e){return e[i]=e[i]||++a,e[i];};}(),invokeEach:function(k,l,a){var p,m;if("object"==typeof k){m=Array.prototype.slice.call(arguments,3);for(p in k){l.apply(a,[p,k[p]].concat(m));}return !0;}return !1;},limitExecByInterval:function(k,m,a){var q,p;return function l(){var e=arguments;return q?void (p=!0):(q=!0,setTimeout(function(){q=!1,p&&(l.apply(a,e),p=!1);},m),void k.apply(a,e));};},falseFn:function(){return !1;},formatNum:function(k,l){var a=Math.pow(10,l||5);return Math.round(k*a)/a;},trim:function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"");},splitWords:function(a){return h.Util.trim(a).split(/\s+/);},setOptions:function(a,i){return a.options=h.extend({},a.options,i),a.options;},getParamString:function(k,l,a){var p=[];for(var m in k){p.push(encodeURIComponent(a?m.toUpperCase():m)+"="+encodeURIComponent(k[m]));}return(l&&-1!==l.indexOf("?")?"&":"?")+p.join("&");},template:function(a,i){return a.replace(/\{ *([\w_]+) *\}/g,function(e,l){var k=i[l];if(k===c){throw new Error("No value provided for variable "+e);}return"function"==typeof k&&(k=k(i)),k;});},isArray:Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a);},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function o(q){var a,s,r=["webkit","moz","o","ms"];for(a=0;a<r.length&&!s;a++){s=d[r[a]+q];}return s;}function l(n){var a=+new Date,q=Math.max(0,16-(a-p));return p=a+q,d.setTimeout(n,q);}var p=0,m=d.requestAnimationFrame||o("RequestAnimationFrame")||l,k=d.cancelAnimationFrame||o("CancelAnimationFrame")||o("CancelRequestAnimationFrame")||function(a){d.clearTimeout(a);};h.Util.requestAnimFrame=function(s,t,i,q){return s=h.bind(s,t),i&&m===l?void s():m.call(d,s,q);},h.Util.cancelAnimFrame=function(a){a&&k.call(d,a);};}(),h.extend=h.Util.extend,h.bind=h.Util.bind,h.stamp=h.Util.stamp,h.setOptions=h.Util.setOptions,h.Class=function(){},h.Class.extend=function(m){var p=function(){this.initialize&&this.initialize.apply(this,arguments),this._initHooks&&this.callInitHooks();},l=function(){};l.prototype=this.prototype;var q=new l;q.constructor=p,p.prototype=q;for(var o in this){this.hasOwnProperty(o)&&"prototype"!==o&&(p[o]=this[o]);}m.statics&&(h.extend(p,m.statics),delete m.statics),m.includes&&(h.Util.extend.apply(null,[q].concat(m.includes)),delete m.includes),m.options&&q.options&&(m.options=h.extend({},q.options,m.options)),h.extend(q,m),q._initHooks=[];var k=this;return p.__super__=k.prototype,q.callInitHooks=function(){if(!this._initHooksCalled){k.prototype.callInitHooks&&k.prototype.callInitHooks.call(this),this._initHooksCalled=!0;for(var a=0,i=q._initHooks.length;i>a;a++){q._initHooks[a].call(this);}}},p;},h.Class.include=function(a){h.extend(this.prototype,a);},h.Class.mergeOptions=function(a){h.extend(this.prototype.options,a);},h.Class.addInitHook=function(k){var l=Array.prototype.slice.call(arguments,1),a="function"==typeof k?k:function(){this[k].apply(this,l);};this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(a);};var f="_leaflet_events";h.Mixin={},h.Mixin.Events={addEventListener:function(B,w,s){if(h.Util.invokeEach(B,this.addEventListener,this,w,s)){return this;}var o,z,k,v,q,A,y,x=this[f]=this[f]||{},m=s&&s!==this&&h.stamp(s);for(B=h.Util.splitWords(B),o=0,z=B.length;z>o;o++){k={action:w,context:s||this},v=B[o],m?(q=v+"_idx",A=q+"_len",y=x[q]=x[q]||{},y[m]||(y[m]=[],x[A]=(x[A]||0)+1),y[m].push(k)):(x[v]=x[v]||[],x[v].push(k));}return this;},hasEventListeners:function(a){var i=this[f];return !!i&&(a in i&&i[a].length>0||a+"_idx" in i&&i[a+"_idx_len"]>0);},removeEventListener:function(E,y,w){if(!this[f]){return this;}if(!E){return this.clearAllEventListeners();}if(h.Util.invokeEach(E,this.removeEventListener,this,y,w)){return this;}var q,B,k,x,v,D,A,z,o,C=this[f],s=w&&w!==this&&h.stamp(w);for(E=h.Util.splitWords(E),q=0,B=E.length;B>q;q++){if(k=E[q],D=k+"_idx",A=D+"_len",z=C[D],y){if(x=s&&z?z[s]:C[k]){for(v=x.length-1;v>=0;v--){x[v].action!==y||w&&x[v].context!==w||(o=x.splice(v,1),o[0].action=h.Util.falseFn);}w&&z&&0===x.length&&(delete z[s],C[A]--);}}else{delete C[k],delete C[D],delete C[A];}}return this;},clearAllEventListeners:function(){return delete this[f],this;},fireEvent:function(x,s){if(!this.hasEventListeners(x)){return this;}var p,m,v,k,q,o=h.Util.extend({},s,{type:x,target:this}),w=this[f];if(w[x]){for(p=w[x].slice(),m=0,v=p.length;v>m;m++){p[m].action.call(p[m].context,o);}}k=w[x+"_idx"];for(q in k){if(p=k[q].slice()){for(m=0,v=p.length;v>m;m++){p[m].action.call(p[m].context,o);}}}return this;},addOneTimeEventListener:function(k,l,a){if(h.Util.invokeEach(k,this.addOneTimeEventListener,this,l,a)){return this;}var m=h.bind(function(){this.removeEventListener(k,l,a).removeEventListener(k,m,a);},this);return this.addEventListener(k,l,a).addEventListener(k,m,a);}},h.Mixin.Events.on=h.Mixin.Events.addEventListener,h.Mixin.Events.off=h.Mixin.Events.removeEventListener,h.Mixin.Events.once=h.Mixin.Events.addOneTimeEventListener,h.Mixin.Events.fire=h.Mixin.Events.fireEvent,function(){var D="ActiveXObject" in d,A=D&&!g.addEventListener,M=navigator.userAgent.toLowerCase(),B=-1!==M.indexOf("webkit"),G=-1!==M.indexOf("chrome"),F=-1!==M.indexOf("phantom"),z=-1!==M.indexOf("android"),K=-1!==M.search("android [23]"),J=-1!==M.indexOf("gecko"),C=typeof orientation!=c+"",N=d.navigator&&d.navigator.msPointerEnabled&&d.navigator.msMaxTouchPoints&&!d.PointerEvent,E=d.PointerEvent&&d.navigator.pointerEnabled&&d.navigator.maxTouchPoints||N,I="devicePixelRatio" in d&&d.devicePixelRatio>1||"matchMedia" in d&&d.matchMedia("(min-resolution:144dpi)")&&d.matchMedia("(min-resolution:144dpi)").matches,H=g.documentElement,t=D&&"transition" in H.style,k="WebKitCSSMatrix" in d&&"m11" in new d.WebKitCSSMatrix&&!K,e="MozPerspective" in H.style,i="OTransition" in H.style,o=!d.L_DISABLE_3D&&(t||k||e||i)&&!F,q=!d.L_NO_TOUCH&&!F&&function(){var l="ontouchstart";if(E||l in H){return !0;}var a=g.createElement("div"),m=!1;return a.setAttribute?(a.setAttribute(l,"return;"),"function"==typeof a[l]&&(m=!0),a.removeAttribute(l),a=null,m):!1;}();h.Browser={ie:D,ielt9:A,webkit:B,gecko:J&&!B&&!d.opera&&!D,android:z,android23:K,chrome:G,ie3d:t,webkit3d:k,gecko3d:e,opera3d:i,any3d:o,mobile:C,mobileWebkit:C&&B,mobileWebkit3d:C&&k,mobileOpera:C&&d.opera,touch:q,msPointer:N,pointer:E,retina:I};}(),h.Point=function(k,l,a){this.x=a?Math.round(k):k,this.y=a?Math.round(l):l;},h.Point.prototype={clone:function(){return new h.Point(this.x,this.y);},add:function(a){return this.clone()._add(h.point(a));},_add:function(a){return this.x+=a.x,this.y+=a.y,this;},subtract:function(a){return this.clone()._subtract(h.point(a));},_subtract:function(a){return this.x-=a.x,this.y-=a.y,this;},divideBy:function(a){return this.clone()._divideBy(a);},_divideBy:function(a){return this.x/=a,this.y/=a,this;},multiplyBy:function(a){return this.clone()._multiplyBy(a);},_multiplyBy:function(a){return this.x*=a,this.y*=a,this;},round:function(){return this.clone()._round();},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this;},floor:function(){return this.clone()._floor();},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this;},distanceTo:function(k){k=h.point(k);var l=k.x-this.x,a=k.y-this.y;return Math.sqrt(l*l+a*a);},equals:function(a){return a=h.point(a),a.x===this.x&&a.y===this.y;},contains:function(a){return a=h.point(a),Math.abs(a.x)<=Math.abs(this.x)&&Math.abs(a.y)<=Math.abs(this.y);},toString:function(){return"Point("+h.Util.formatNum(this.x)+", "+h.Util.formatNum(this.y)+")";}},h.point=function(a,i,k){return a instanceof h.Point?a:h.Util.isArray(a)?new h.Point(a[0],a[1]):a===c||null===a?a:new h.Point(a,i,k);},h.Bounds=function(k,l){if(k){for(var a=l?[k,l]:k,p=0,m=a.length;m>p;p++){this.extend(a[p]);}}},h.Bounds.prototype={extend:function(a){return a=h.point(a),this.min||this.max?(this.min.x=Math.min(a.x,this.min.x),this.max.x=Math.max(a.x,this.max.x),this.min.y=Math.min(a.y,this.min.y),this.max.y=Math.max(a.y,this.max.y)):(this.min=a.clone(),this.max=a.clone()),this;},getCenter:function(a){return new h.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,a);},getBottomLeft:function(){return new h.Point(this.min.x,this.max.y);},getTopRight:function(){return new h.Point(this.max.x,this.min.y);},getSize:function(){return this.max.subtract(this.min);},contains:function(k){var l,a;return k="number"==typeof k[0]||k instanceof h.Point?h.point(k):h.bounds(k),k instanceof h.Bounds?(l=k.min,a=k.max):l=a=k,l.x>=this.min.x&&a.x<=this.max.x&&l.y>=this.min.y&&a.y<=this.max.y;},intersects:function(m){m=h.bounds(m);var q=this.min,l=this.max,u=m.min,o=m.max,k=o.x>=q.x&&u.x<=l.x,p=o.y>=q.y&&u.y<=l.y;return k&&p;},isValid:function(){return !(!this.min||!this.max);}},h.bounds=function(a,i){return !a||a instanceof h.Bounds?a:new h.Bounds(a,i);},h.Transformation=function(k,l,a,m){this._a=k,this._b=l,this._c=a,this._d=m;},h.Transformation.prototype={transform:function(a,i){return this._transform(a.clone(),i);},_transform:function(a,i){return i=i||1,a.x=i*(this._a*a.x+this._b),a.y=i*(this._c*a.y+this._d),a;},untransform:function(a,i){return i=i||1,new h.Point((a.x/i-this._b)/this._a,(a.y/i-this._d)/this._c);}},h.DomUtil={get:function(a){return"string"==typeof a?g.getElementById(a):a;},getStyle:function(e,a){var l=e.style[a];if(!l&&e.currentStyle&&(l=e.currentStyle[a]),(!l||"auto"===l)&&g.defaultView){var k=g.defaultView.getComputedStyle(e,null);l=k?k[a]:null;}return"auto"===l?null:l;},getViewportOffset:function(x){var o,k=0,y=0,v=x,e=g.body,p=g.documentElement;do{if(k+=v.offsetTop||0,y+=v.offsetLeft||0,k+=parseInt(h.DomUtil.getStyle(v,"borderTopWidth"),10)||0,y+=parseInt(h.DomUtil.getStyle(v,"borderLeftWidth"),10)||0,o=h.DomUtil.getStyle(v,"position"),v.offsetParent===e&&"absolute"===o){break;}if("fixed"===o){k+=e.scrollTop||p.scrollTop||0,y+=e.scrollLeft||p.scrollLeft||0;break;}if("relative"===o&&!v.offsetLeft){var m=h.DomUtil.getStyle(v,"width"),w=h.DomUtil.getStyle(v,"max-width"),q=v.getBoundingClientRect();("none"!==m||"none"!==w)&&(y+=q.left+v.clientLeft),k+=q.top+(e.scrollTop||p.scrollTop||0);break;}v=v.offsetParent;}while(v);v=x;do{if(v===e){break;}k-=v.scrollTop||0,y-=v.scrollLeft||0,v=v.parentNode;}while(v);return new h.Point(y,k);},documentIsLtr:function(){return h.DomUtil._docIsLtrCached||(h.DomUtil._docIsLtrCached=!0,h.DomUtil._docIsLtr="ltr"===h.DomUtil.getStyle(g.body,"direction")),h.DomUtil._docIsLtr;},create:function(e,a,l){var k=g.createElement(e);return k.className=a,l&&l.appendChild(k),k;},hasClass:function(a,i){if(a.classList!==c){return a.classList.contains(i);}var k=h.DomUtil._getClass(a);return k.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(k);},addClass:function(k,o){if(k.classList!==c){for(var p=h.Util.splitWords(o),l=0,i=p.length;i>l;l++){k.classList.add(p[l]);}}else{if(!h.DomUtil.hasClass(k,o)){var m=h.DomUtil._getClass(k);h.DomUtil._setClass(k,(m?m+" ":"")+o);}}},removeClass:function(a,i){a.classList!==c?a.classList.remove(i):h.DomUtil._setClass(a,h.Util.trim((" "+h.DomUtil._getClass(a)+" ").replace(" "+i+" "," ")));},_setClass:function(a,i){a.className.baseVal===c?a.className=i:a.className.baseVal=i;},_getClass:function(a){return a.className.baseVal===c?a.className:a.className.baseVal;},setOpacity:function(k,l){if("opacity" in k.style){k.style.opacity=l;}else{if("filter" in k.style){var a=!1,p="DXImageTransform.Microsoft.Alpha";try{a=k.filters.item(p);}catch(m){if(1===l){return;}}l=Math.round(100*l),a?(a.Enabled=100!==l,a.Opacity=l):k.style.filter+=" progid:"+p+"(opacity="+l+")";}}},testProp:function(e){for(var a=g.documentElement.style,k=0;k<e.length;k++){if(e[k] in a){return e[k];}}return !1;},getTranslateString:function(k){var l=h.Browser.webkit3d,a="translate"+(l?"3d":"")+"(",m=(l?",0":"")+")";return a+k.x+"px,"+k.y+"px"+m;},getScaleString:function(k,l){var a=h.DomUtil.getTranslateString(l.add(l.multiplyBy(-1*k))),m=" scale("+k+") ";return a+m;},setPosition:function(k,l,a){k._leaflet_pos=l,!a&&h.Browser.any3d?k.style[h.DomUtil.TRANSFORM]=h.DomUtil.getTranslateString(l):(k.style.left=l.x+"px",k.style.top=l.y+"px");},getPosition:function(a){return a._leaflet_pos;}},h.DomUtil.TRANSFORM=h.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),h.DomUtil.TRANSITION=h.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),h.DomUtil.TRANSITION_END="webkitTransition"===h.DomUtil.TRANSITION||"OTransition"===h.DomUtil.TRANSITION?h.DomUtil.TRANSITION+"End":"transitionend",function(){if("onselectstart" in g){h.extend(h.DomUtil,{disableTextSelection:function(){h.DomEvent.on(d,"selectstart",h.DomEvent.preventDefault);},enableTextSelection:function(){h.DomEvent.off(d,"selectstart",h.DomEvent.preventDefault);}});}else{var a=h.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);h.extend(h.DomUtil,{disableTextSelection:function(){if(a){var e=g.documentElement.style;this._userSelect=e[a],e[a]="none";}},enableTextSelection:function(){a&&(g.documentElement.style[a]=this._userSelect,delete this._userSelect);}});}h.extend(h.DomUtil,{disableImageDrag:function(){h.DomEvent.on(d,"dragstart",h.DomEvent.preventDefault);},enableImageDrag:function(){h.DomEvent.off(d,"dragstart",h.DomEvent.preventDefault);}});}(),h.LatLng=function(a,i,k){if(a=parseFloat(a),i=parseFloat(i),isNaN(a)||isNaN(i)){throw new Error("Invalid LatLng object: ("+a+", "+i+")");}this.lat=a,this.lng=i,k!==c&&(this.alt=parseFloat(k));},h.extend(h.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9}),h.LatLng.prototype={equals:function(a){if(!a){return !1;}a=h.latLng(a);var i=Math.max(Math.abs(this.lat-a.lat),Math.abs(this.lng-a.lng));return i<=h.LatLng.MAX_MARGIN;},toString:function(a){return"LatLng("+h.Util.formatNum(this.lat,a)+", "+h.Util.formatNum(this.lng,a)+")";},distanceTo:function(y){y=h.latLng(y);var v=6378137,p=h.LatLng.DEG_TO_RAD,m=(y.lat-this.lat)*p,z=(y.lng-this.lng)*p,w=this.lat*p,k=y.lat*p,q=Math.sin(m/2),o=Math.sin(z/2),x=q*q+o*o*Math.cos(w)*Math.cos(k);return 2*v*Math.atan2(Math.sqrt(x),Math.sqrt(1-x));},wrap:function(k,l){var a=this.lng;return k=k||-180,l=l||180,a=(a+l)%(l-k)+(k>a||a===l?l:k),new h.LatLng(this.lat,a);}},h.latLng=function(a,i){return a instanceof h.LatLng?a:h.Util.isArray(a)?"number"==typeof a[0]||"string"==typeof a[0]?new h.LatLng(a[0],a[1],a[2]):null:a===c||null===a?a:"object"==typeof a&&"lat" in a?new h.LatLng(a.lat,"lng" in a?a.lng:a.lon):i===c?null:new h.LatLng(a,i);},h.LatLngBounds=function(k,l){if(k){for(var a=l?[k,l]:k,p=0,m=a.length;m>p;p++){this.extend(a[p]);}}},h.LatLngBounds.prototype={extend:function(a){if(!a){return this;}var i=h.latLng(a);return a=null!==i?i:h.latLngBounds(a),a instanceof h.LatLng?this._southWest||this._northEast?(this._southWest.lat=Math.min(a.lat,this._southWest.lat),this._southWest.lng=Math.min(a.lng,this._southWest.lng),this._northEast.lat=Math.max(a.lat,this._northEast.lat),this._northEast.lng=Math.max(a.lng,this._northEast.lng)):(this._southWest=new h.LatLng(a.lat,a.lng),this._northEast=new h.LatLng(a.lat,a.lng)):a instanceof h.LatLngBounds&&(this.extend(a._southWest),this.extend(a._northEast)),this;},pad:function(k){var m=this._southWest,a=this._northEast,o=Math.abs(m.lat-a.lat)*k,l=Math.abs(m.lng-a.lng)*k;return new h.LatLngBounds(new h.LatLng(m.lat-o,m.lng-l),new h.LatLng(a.lat+o,a.lng+l));},getCenter:function(){return new h.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2);},getSouthWest:function(){return this._southWest;},getNorthEast:function(){return this._northEast;},getNorthWest:function(){return new h.LatLng(this.getNorth(),this.getWest());},getSouthEast:function(){return new h.LatLng(this.getSouth(),this.getEast());},getWest:function(){return this._southWest.lng;},getSouth:function(){return this._southWest.lat;},getEast:function(){return this._northEast.lng;},getNorth:function(){return this._northEast.lat;},contains:function(k){k="number"==typeof k[0]||k instanceof h.LatLng?h.latLng(k):h.latLngBounds(k);var m,a,o=this._southWest,l=this._northEast;return k instanceof h.LatLngBounds?(m=k.getSouthWest(),a=k.getNorthEast()):m=a=k,m.lat>=o.lat&&a.lat<=l.lat&&m.lng>=o.lng&&a.lng<=l.lng;},intersects:function(m){m=h.latLngBounds(m);var q=this._southWest,l=this._northEast,u=m.getSouthWest(),o=m.getNorthEast(),k=o.lat>=q.lat&&u.lat<=l.lat,p=o.lng>=q.lng&&u.lng<=l.lng;return k&&p;},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",");},equals:function(a){return a?(a=h.latLngBounds(a),this._southWest.equals(a.getSouthWest())&&this._northEast.equals(a.getNorthEast())):!1;},isValid:function(){return !(!this._southWest||!this._northEast);}},h.latLngBounds=function(a,i){return !a||a instanceof h.LatLngBounds?a:new h.LatLngBounds(a,i);},h.Projection={},h.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(m){var p=h.LatLng.DEG_TO_RAD,l=this.MAX_LATITUDE,q=Math.max(Math.min(l,m.lat),-l),o=m.lng*p,k=q*p;return k=Math.log(Math.tan(Math.PI/4+k/2)),new h.Point(o,k);},unproject:function(k){var l=h.LatLng.RAD_TO_DEG,a=k.x*l,m=(2*Math.atan(Math.exp(k.y))-Math.PI/2)*l;return new h.LatLng(m,a);}},h.Projection.LonLat={project:function(a){return new h.Point(a.lng,a.lat);},unproject:function(a){return new h.LatLng(a.y,a.x);}},h.CRS={latLngToPoint:function(k,l){var a=this.projection.project(k),m=this.scale(l);return this.transformation._transform(a,m);},pointToLatLng:function(k,l){var a=this.scale(l),m=this.transformation.untransform(k,a);return this.projection.unproject(m);},project:function(a){return this.projection.project(a);},scale:function(a){return 256*Math.pow(2,a);},getSize:function(a){var i=this.scale(a);return h.point(i,i);}},h.CRS.Simple=h.extend({},h.CRS,{projection:h.Projection.LonLat,transformation:new h.Transformation(1,0,-1,0),scale:function(a){return Math.pow(2,a);}}),h.CRS.EPSG3857=h.extend({},h.CRS,{code:"EPSG:3857",projection:h.Projection.SphericalMercator,transformation:new h.Transformation(0.5/Math.PI,0.5,-0.5/Math.PI,0.5),project:function(k){var l=this.projection.project(k),a=6378137;return l.multiplyBy(a);}}),h.CRS.EPSG900913=h.extend({},h.CRS.EPSG3857,{code:"EPSG:900913"}),h.CRS.EPSG4326=h.extend({},h.CRS,{code:"EPSG:4326",projection:h.Projection.LonLat,transformation:new h.Transformation(1/360,0.5,-1/360,0.5)}),h.Map=h.Class.extend({includes:h.Mixin.Events,options:{crs:h.CRS.EPSG3857,fadeAnimation:h.DomUtil.TRANSITION&&!h.Browser.android23,trackResize:!0,markerZoomAnimation:h.DomUtil.TRANSITION&&h.Browser.any3d},initialize:function(a,i){i=h.setOptions(this,i),this._initContainer(a),this._initLayout(),this._onResize=h.bind(this._onResize,this),this._initEvents(),i.maxBounds&&this.setMaxBounds(i.maxBounds),i.center&&i.zoom!==c&&this.setView(h.latLng(i.center),i.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._tileLayersNum=0,this.callInitHooks(),this._addLayers(i.layers);},setView:function(a,i){return i=i===c?this.getZoom():i,this._resetView(h.latLng(a),this._limitZoom(i)),this;},setZoom:function(a,i){return this._loaded?this.setView(this.getCenter(),a,{zoom:i}):(this._zoom=this._limitZoom(a),this);},zoomIn:function(a,i){return this.setZoom(this._zoom+(a||1),i);},zoomOut:function(a,i){return this.setZoom(this._zoom-(a||1),i);},setZoomAround:function(m,u,l){var v=this.getZoomScale(u),p=this.getSize().divideBy(2),k=m instanceof h.Point?m:this.latLngToContainerPoint(m),q=k.subtract(p).multiplyBy(1-1/v),o=this.containerPointToLatLng(p.add(q));return this.setView(o,u,{zoom:l});},fitBounds:function(w,u){u=u||{},w=w.getBounds?w.getBounds():h.latLngBounds(w);var p=h.point(u.paddingTopLeft||u.padding||[0,0]),m=h.point(u.paddingBottomRight||u.padding||[0,0]),x=this.getBoundsZoom(w,!1,p.add(m)),v=m.subtract(p).divideBy(2),k=this.project(w.getSouthWest(),x),q=this.project(w.getNorthEast(),x),o=this.unproject(k.add(q).divideBy(2).add(v),x);return x=u&&u.maxZoom?Math.min(u.maxZoom,x):x,this.setView(o,x,u);},fitWorld:function(a){return this.fitBounds([[-90,-180],[90,180]],a);},panTo:function(a,i){return this.setView(a,this._zoom,{pan:i});},panBy:function(a){return this.fire("movestart"),this._rawPanBy(h.point(a)),this.fire("move"),this.fire("moveend");},setMaxBounds:function(a){return a=h.latLngBounds(a),this.options.maxBounds=a,a?(this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds,this)):this.off("moveend",this._panInsideMaxBounds,this);},panInsideBounds:function(k,l){var a=this.getCenter(),m=this._limitCenter(a,this._zoom,k);return a.equals(m)?this:this.panTo(m,l);},addLayer:function(a){var i=h.stamp(a);return this._layers[i]?this:(this._layers[i]=a,!a.options||isNaN(a.options.maxZoom)&&isNaN(a.options.minZoom)||(this._zoomBoundLayers[i]=a,this._updateZoomLevels()),this.options.zoomAnimation&&h.TileLayer&&a instanceof h.TileLayer&&(this._tileLayersNum++,this._tileLayersToLoad++,a.on("load",this._onTileLayerLoad,this)),this._loaded&&this._layerAdd(a),this);},removeLayer:function(a){var i=h.stamp(a);return this._layers[i]?(this._loaded&&a.onRemove(this),delete this._layers[i],this._loaded&&this.fire("layerremove",{layer:a}),this._zoomBoundLayers[i]&&(delete this._zoomBoundLayers[i],this._updateZoomLevels()),this.options.zoomAnimation&&h.TileLayer&&a instanceof h.TileLayer&&(this._tileLayersNum--,this._tileLayersToLoad--,a.off("load",this._onTileLayerLoad,this)),this):this;},hasLayer:function(a){return a?h.stamp(a) in this._layers:!1;},eachLayer:function(k,l){for(var a in this._layers){k.call(l,this._layers[a]);}return this;},invalidateSize:function(m){if(!this._loaded){return this;}m=h.extend({animate:!1,pan:!0},m===!0?{animate:!0}:m);var p=this.getSize();this._sizeChanged=!0,this._initialCenter=null;var l=this.getSize(),q=p.divideBy(2).round(),o=l.divideBy(2).round(),k=q.subtract(o);return k.x||k.y?(m.animate&&m.pan?this.panBy(k):(m.pan&&this._rawPanBy(k),this.fire("move"),m.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(h.bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:p,newSize:l})):this;},addHandler:function(k,l){if(!l){return this;}var a=this[k]=new l(this);return this._handlers.push(a),this.options[k]&&a.enable(),this;},remove:function(){this._loaded&&this.fire("unload"),this._initEvents("off");try{delete this._container._leaflet;}catch(a){this._container._leaflet=c;}return this._clearPanes(),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this;},getCenter:function(){return this._checkIfLoaded(),this._initialCenter&&!this._moved()?this._initialCenter:this.layerPointToLatLng(this._getCenterLayerPoint());},getZoom:function(){return this._zoom;},getBounds:function(){var k=this.getPixelBounds(),l=this.unproject(k.getBottomLeft()),a=this.unproject(k.getTopRight());return new h.LatLngBounds(l,a);},getMinZoom:function(){return this.options.minZoom===c?this._layersMinZoom===c?0:this._layersMinZoom:this.options.minZoom;},getMaxZoom:function(){return this.options.maxZoom===c?this._layersMaxZoom===c?1/0:this._layersMaxZoom:this.options.maxZoom;},getBoundsZoom:function(y,v,p){y=h.latLngBounds(y);var m,z=this.getMinZoom()-(v?1:0),w=this.getMaxZoom(),k=this.getSize(),q=y.getNorthWest(),o=y.getSouthEast(),x=!0;p=h.point(p||[0,0]);do{z++,m=this.project(o,z).subtract(this.project(q,z)).add(p),x=v?m.x<k.x||m.y<k.y:k.contains(m);}while(x&&w>=z);return x&&v?null:v?z:z-1;},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new h.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1),this._size.clone();},getPixelBounds:function(){var a=this._getTopLeftPoint();return new h.Bounds(a,a.add(this.getSize()));},getPixelOrigin:function(){return this._checkIfLoaded(),this._initialTopLeftPoint;},getPanes:function(){return this._panes;},getContainer:function(){return this._container;},getZoomScale:function(a){var i=this.options.crs;return i.scale(a)/i.scale(this._zoom);},getScaleZoom:function(a){return this._zoom+Math.log(a)/Math.LN2;},project:function(a,i){return i=i===c?this._zoom:i,this.options.crs.latLngToPoint(h.latLng(a),i);},unproject:function(a,i){return i=i===c?this._zoom:i,this.options.crs.pointToLatLng(h.point(a),i);},layerPointToLatLng:function(a){var i=h.point(a).add(this.getPixelOrigin());return this.unproject(i);},latLngToLayerPoint:function(a){var i=this.project(h.latLng(a))._round();return i._subtract(this.getPixelOrigin());},containerPointToLayerPoint:function(a){return h.point(a).subtract(this._getMapPanePos());},layerPointToContainerPoint:function(a){return h.point(a).add(this._getMapPanePos());},containerPointToLatLng:function(a){var i=this.containerPointToLayerPoint(h.point(a));return this.layerPointToLatLng(i);},latLngToContainerPoint:function(a){return this.layerPointToContainerPoint(this.latLngToLayerPoint(h.latLng(a)));},mouseEventToContainerPoint:function(a){return h.DomEvent.getMousePosition(a,this._container);},mouseEventToLayerPoint:function(a){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(a));},mouseEventToLatLng:function(a){return this.layerPointToLatLng(this.mouseEventToLayerPoint(a));},_initContainer:function(a){var i=this._container=h.DomUtil.get(a);if(!i){throw new Error("Map container not found.");}if(i._leaflet){throw new Error("Map container is already initialized.");}i._leaflet=!0;},_initLayout:function(){var a=this._container;h.DomUtil.addClass(a,"leaflet-container"+(h.Browser.touch?" leaflet-touch":"")+(h.Browser.retina?" leaflet-retina":"")+(h.Browser.ielt9?" leaflet-oldie":"")+(this.options.fadeAnimation?" leaflet-fade-anim":""));var i=h.DomUtil.getStyle(a,"position");"absolute"!==i&&"relative"!==i&&"fixed"!==i&&(a.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos();},_initPanes:function(){var a=this._panes={};this._mapPane=a.mapPane=this._createPane("leaflet-map-pane",this._container),this._tilePane=a.tilePane=this._createPane("leaflet-tile-pane",this._mapPane),a.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane),a.shadowPane=this._createPane("leaflet-shadow-pane"),a.overlayPane=this._createPane("leaflet-overlay-pane"),a.markerPane=this._createPane("leaflet-marker-pane"),a.popupPane=this._createPane("leaflet-popup-pane");var i=" leaflet-zoom-hide";this.options.markerZoomAnimation||(h.DomUtil.addClass(a.markerPane,i),h.DomUtil.addClass(a.shadowPane,i),h.DomUtil.addClass(a.popupPane,i));},_createPane:function(a,i){return h.DomUtil.create("div",a,i||this._panes.objectsPane);},_clearPanes:function(){this._container.removeChild(this._mapPane);},_addLayers:function(k){k=k?h.Util.isArray(k)?k:[k]:[];for(var l=0,a=k.length;a>l;l++){this.addLayer(k[l]);}},_resetView:function(m,p,l,q){var o=this._zoom!==p;q||(this.fire("movestart"),o&&this.fire("zoomstart")),this._zoom=p,this._initialCenter=m,this._initialTopLeftPoint=this._getNewTopLeftPoint(m),l?this._initialTopLeftPoint._add(this._getMapPanePos()):h.DomUtil.setPosition(this._mapPane,new h.Point(0,0)),this._tileLayersToLoad=this._tileLayersNum;var k=!this._loaded;this._loaded=!0,this.fire("viewreset",{hard:!l}),k&&(this.fire("load"),this.eachLayer(this._layerAdd,this)),this.fire("move"),(o||q)&&this.fire("zoomend"),this.fire("moveend",{hard:!l});},_rawPanBy:function(a){h.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(a));},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom();},_updateZoomLevels:function(){var a,k=1/0,m=-1/0,l=this._getZoomSpan();for(a in this._zoomBoundLayers){var i=this._zoomBoundLayers[a];isNaN(i.options.minZoom)||(k=Math.min(k,i.options.minZoom)),isNaN(i.options.maxZoom)||(m=Math.max(m,i.options.maxZoom));}a===c?this._layersMaxZoom=this._layersMinZoom=c:(this._layersMaxZoom=m,this._layersMinZoom=k),l!==this._getZoomSpan()&&this.fire("zoomlevelschange");},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds);},_checkIfLoaded:function(){if(!this._loaded){throw new Error("Set map center and zoom first.");}},_initEvents:function(l){if(h.DomEvent){l=l||"on",h.DomEvent[l](this._container,"click",this._onMouseClick,this);var a,m,k=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"];for(a=0,m=k.length;m>a;a++){h.DomEvent[l](this._container,k[a],this._fireMouseEvent,this);}this.options.trackResize&&h.DomEvent[l](d,"resize",this._onResize,this);}},_onResize:function(){h.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=h.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0});},this,!1,this._container);},_onMouseClick:function(a){!this._loaded||!a._simulated&&(this.dragging&&this.dragging.moved()||this.boxZoom&&this.boxZoom.moved())||h.DomEvent._skipped(a)||(this.fire("preclick"),this._fireMouseEvent(a));},_fireMouseEvent:function(k){if(this._loaded&&!h.DomEvent._skipped(k)){var m=k.type;if(m="mouseenter"===m?"mouseover":"mouseleave"===m?"mouseout":m,this.hasEventListeners(m)){"contextmenu"===m&&h.DomEvent.preventDefault(k);var a=this.mouseEventToContainerPoint(k),o=this.containerPointToLayerPoint(a),l=this.layerPointToLatLng(o);this.fire(m,{latlng:l,layerPoint:o,containerPoint:a,originalEvent:k});}}},_onTileLayerLoad:function(){this._tileLayersToLoad--,this._tileLayersNum&&!this._tileLayersToLoad&&this.fire("tilelayersload");},_clearHandlers:function(){for(var a=0,i=this._handlers.length;i>a;a++){this._handlers[a].disable();}},whenReady:function(a,i){return this._loaded?a.call(i||this,this):this.on("load",a,i),this;},_layerAdd:function(a){a.onAdd(this),this.fire("layeradd",{layer:a});},_getMapPanePos:function(){return h.DomUtil.getPosition(this._mapPane);},_moved:function(){var a=this._getMapPanePos();return a&&!a.equals([0,0]);},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos());},_getNewTopLeftPoint:function(k,l){var a=this.getSize()._divideBy(2);return this.project(k,l)._subtract(a)._round();},_latLngToNewLayerPoint:function(k,l,a){var m=this._getNewTopLeftPoint(a,l).add(this._getMapPanePos());return this.project(k,l)._subtract(m);},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2));},_getCenterOffset:function(a){return this.latLngToLayerPoint(a).subtract(this._getCenterLayerPoint());},_limitCenter:function(m,q,l){if(!l){return m;}var u=this.project(m,q),o=this.getSize().divideBy(2),k=new h.Bounds(u.subtract(o),u.add(o)),p=this._getBoundsOffset(k,l,q);return this.unproject(u.add(p),q);},_limitOffset:function(k,l){if(!l){return k;}var a=this.getPixelBounds(),m=new h.Bounds(a.min.add(k),a.max.add(k));return k.add(this._getBoundsOffset(m,l));},_getBoundsOffset:function(m,q,l){var u=this.project(q.getNorthWest(),l).subtract(m.min),o=this.project(q.getSouthEast(),l).subtract(m.max),k=this._rebound(u.x,-o.x),p=this._rebound(u.y,-o.y);return new h.Point(k,p);},_rebound:function(a,i){return a+i>0?Math.round(a-i)/2:Math.max(0,Math.ceil(a))-Math.max(0,Math.floor(i));},_limitZoom:function(k){var l=this.getMinZoom(),a=this.getMaxZoom();return Math.max(l,Math.min(a,k));}}),h.map=function(a,i){return new h.Map(a,i);},h.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.314245179,R_MAJOR:6378137,project:function(A){var v=h.LatLng.DEG_TO_RAD,p=this.MAX_LATITUDE,m=Math.max(Math.min(p,A.lat),-p),B=this.R_MAJOR,y=this.R_MINOR,k=A.lng*v*B,q=m*v,o=y/B,z=Math.sqrt(1-o*o),x=z*Math.sin(q);x=Math.pow((1-x)/(1+x),0.5*z);var w=Math.tan(0.5*(0.5*Math.PI-q))/x;return q=-B*Math.log(w),new h.Point(k,q);},unproject:function(D){for(var x,v=h.LatLng.RAD_TO_DEG,o=this.R_MAJOR,E=this.R_MINOR,A=D.x*v/o,k=E/o,w=Math.sqrt(1-k*k),q=Math.exp(-D.y/o),C=Math.PI/2-2*Math.atan(q),z=15,y=1e-7,m=z,B=0.1;Math.abs(B)>y&&--m>0;){x=w*Math.sin(C),B=Math.PI/2-2*Math.atan(q*Math.pow((1-x)/(1+x),0.5*w))-C,C+=B;}return new h.LatLng(C*v,A);}},h.CRS.EPSG3395=h.extend({},h.CRS,{code:"EPSG:3395",projection:h.Projection.Mercator,transformation:function(){var k=h.Projection.Mercator,l=k.R_MAJOR,a=0.5/(Math.PI*l);return new h.Transformation(a,0.5,-a,0.5);}()}),h.TileLayer=h.Class.extend({includes:h.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:h.Browser.mobile,updateWhenIdle:h.Browser.mobile},initialize:function(k,l){l=h.setOptions(this,l),l.detectRetina&&h.Browser.retina&&l.maxZoom>0&&(l.tileSize=Math.floor(l.tileSize/2),l.zoomOffset++,l.minZoom>0&&l.minZoom--,this.options.maxZoom--),l.bounds&&(l.bounds=h.latLngBounds(l.bounds)),this._url=k;var a=this.options.subdomains;"string"==typeof a&&(this.options.subdomains=a.split(""));},onAdd:function(a){this._map=a,this._animated=a._zoomAnimated,this._initContainer(),a.on({viewreset:this._reset,moveend:this._update},this),this._animated&&a.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||(this._limitedUpdate=h.Util.limitExecByInterval(this._update,150,this),a.on("move",this._limitedUpdate,this)),this._reset(),this._update();},addTo:function(a){return a.addLayer(this),this;},onRemove:function(a){this._container.parentNode.removeChild(this._container),a.off({viewreset:this._reset,moveend:this._update},this),this._animated&&a.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||a.off("move",this._limitedUpdate,this),this._container=null,this._map=null;},bringToFront:function(){var a=this._map._panes.tilePane;return this._container&&(a.appendChild(this._container),this._setAutoZIndex(a,Math.max)),this;},bringToBack:function(){var a=this._map._panes.tilePane;return this._container&&(a.insertBefore(this._container,a.firstChild),this._setAutoZIndex(a,Math.min)),this;},getAttribution:function(){return this.options.attribution;},getContainer:function(){return this._container;},setOpacity:function(a){return this.options.opacity=a,this._map&&this._updateOpacity(),this;},setZIndex:function(a){return this.options.zIndex=a,this._updateZIndex(),this;},setUrl:function(a,i){return this._url=a,i||this.redraw(),this;},redraw:function(){return this._map&&(this._reset({hard:!0}),this._update()),this;},_updateZIndex:function(){this._container&&this.options.zIndex!==c&&(this._container.style.zIndex=this.options.zIndex);},_setAutoZIndex:function(m,q){var l,u,r,p=m.children,k=-q(1/0,-1/0);for(u=0,r=p.length;r>u;u++){p[u]!==this._container&&(l=parseInt(p[u].style.zIndex,10),isNaN(l)||(k=q(k,l)));}this.options.zIndex=this._container.style.zIndex=(isFinite(k)?k:0)+q(1,-1);},_updateOpacity:function(){var a,i=this._tiles;if(h.Browser.ielt9){for(a in i){h.DomUtil.setOpacity(i[a],this.options.opacity);}}else{h.DomUtil.setOpacity(this._container,this.options.opacity);}},_initContainer:function(){var a=this._map._panes.tilePane;if(!this._container){if(this._container=h.DomUtil.create("div","leaflet-layer"),this._updateZIndex(),this._animated){var i="leaflet-tile-container";this._bgBuffer=h.DomUtil.create("div",i,this._container),this._tileContainer=h.DomUtil.create("div",i,this._container);}else{this._tileContainer=this._container;}a.appendChild(this._container),this.options.opacity<1&&this._updateOpacity();}},_reset:function(a){for(var i in this._tiles){this.fire("tileunload",{tile:this._tiles[i]});}this._tiles={},this._tilesToLoad=0,this.options.reuseTiles&&(this._unusedTiles=[]),this._tileContainer.innerHTML="",this._animated&&a&&a.hard&&this._clearBgBuffer(),this._initContainer();},_getTileSize:function(){var k=this._map,l=k.getZoom()+this.options.zoomOffset,a=this.options.maxNativeZoom,m=this.options.tileSize;return a&&l>a&&(m=Math.round(k.getZoomScale(l)/k.getZoomScale(a)*m)),m;},_update:function(){if(this._map){var k=this._map,m=k.getPixelBounds(),a=k.getZoom(),o=this._getTileSize();if(!(a>this.options.maxZoom||a<this.options.minZoom)){var l=h.bounds(m.min.divideBy(o)._floor(),m.max.divideBy(o)._floor());this._addTilesFromCenterOut(l),(this.options.unloadInvisibleTiles||this.options.reuseTiles)&&this._removeOtherTiles(l);}}},_addTilesFromCenterOut:function(o){var m,v,q,k=[],u=o.getCenter();for(m=o.min.y;m<=o.max.y;m++){for(v=o.min.x;v<=o.max.x;v++){q=new h.Point(v,m),this._tileShouldBeLoaded(q)&&k.push(q);}}var p=k.length;if(0!==p){k.sort(function(a,i){return a.distanceTo(u)-i.distanceTo(u);});var e=g.createDocumentFragment();for(this._tilesToLoad||this.fire("loading"),this._tilesToLoad+=p,v=0;p>v;v++){this._addTile(k[v],e);}this._tileContainer.appendChild(e);}},_tileShouldBeLoaded:function(m){if(m.x+":"+m.y in this._tiles){return !1;}var u=this.options;if(!u.continuousWorld){var l=this._getWrapTileNum();if(u.noWrap&&(m.x<0||m.x>=l.x)||m.y<0||m.y>=l.y){return !1;}}if(u.bounds){var w=u.tileSize,v=m.multiplyBy(w),p=v.add([w,w]),k=this._map.unproject(v),q=this._map.unproject(p);if(u.continuousWorld||u.noWrap||(k=k.wrap(),q=q.wrap()),!u.bounds.intersects([k,q])){return !1;}}return !0;},_removeOtherTiles:function(k){var l,a,p,m;for(m in this._tiles){l=m.split(":"),a=parseInt(l[0],10),p=parseInt(l[1],10),(a<k.min.x||a>k.max.x||p<k.min.y||p>k.max.y)&&this._removeTile(m);}},_removeTile:function(a){var i=this._tiles[a];this.fire("tileunload",{tile:i,url:i.src}),this.options.reuseTiles?(h.DomUtil.removeClass(i,"leaflet-tile-loaded"),this._unusedTiles.push(i)):i.parentNode===this._tileContainer&&this._tileContainer.removeChild(i),h.Browser.android||(i.onload=null,i.src=h.Util.emptyImageUrl),delete this._tiles[a];},_addTile:function(k,l){var a=this._getTilePos(k),m=this._getTile();h.DomUtil.setPosition(m,a,h.Browser.chrome),this._tiles[k.x+":"+k.y]=m,this._loadTile(m,k),m.parentNode!==this._tileContainer&&l.appendChild(m);},_getZoomForUrl:function(){var a=this.options,i=this._map.getZoom();return a.zoomReverse&&(i=a.maxZoom-i),i+=a.zoomOffset,a.maxNativeZoom?Math.min(i,a.maxNativeZoom):i;},_getTilePos:function(k){var l=this._map.getPixelOrigin(),a=this._getTileSize();return k.multiplyBy(a).subtract(l);},getTileUrl:function(a){return h.Util.template(this._url,h.extend({s:this._getSubdomain(a),z:a.z,x:a.x,y:a.y},this.options));},_getWrapTileNum:function(){var a=this._map.options.crs,i=a.getSize(this._map.getZoom());return i.divideBy(this._getTileSize())._floor();},_adjustTilePoint:function(a){var i=this._getWrapTileNum();this.options.continuousWorld||this.options.noWrap||(a.x=(a.x%i.x+i.x)%i.x),this.options.tms&&(a.y=i.y-a.y-1),a.z=this._getZoomForUrl();},_getSubdomain:function(a){var i=Math.abs(a.x+a.y)%this.options.subdomains.length;return this.options.subdomains[i];},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var a=this._unusedTiles.pop();return this._resetTile(a),a;}return this._createTile();},_resetTile:function(){},_createTile:function(){var a=h.DomUtil.create("img","leaflet-tile");return a.style.width=a.style.height=this._getTileSize()+"px",a.galleryimg="no",a.onselectstart=a.onmousemove=h.Util.falseFn,h.Browser.ielt9&&this.options.opacity!==c&&h.DomUtil.setOpacity(a,this.options.opacity),h.Browser.mobileWebkit3d&&(a.style.WebkitBackfaceVisibility="hidden"),a;},_loadTile:function(a,i){a._layer=this,a.onload=this._tileOnLoad,a.onerror=this._tileOnError,this._adjustTilePoint(i),a.src=this.getTileUrl(i),this.fire("tileloadstart",{tile:a,url:a.src});},_tileLoaded:function(){this._tilesToLoad--,this._animated&&h.DomUtil.addClass(this._tileContainer,"leaflet-zoom-animated"),this._tilesToLoad||(this.fire("load"),this._animated&&(clearTimeout(this._clearBgBufferTimer),this._clearBgBufferTimer=setTimeout(h.bind(this._clearBgBuffer,this),500)));},_tileOnLoad:function(){var a=this._layer;this.src!==h.Util.emptyImageUrl&&(h.DomUtil.addClass(this,"leaflet-tile-loaded"),a.fire("tileload",{tile:this,url:this.src})),a._tileLoaded();},_tileOnError:function(){var a=this._layer;a.fire("tileerror",{tile:this,url:this.src});var i=a.options.errorTileUrl;i&&(this.src=i),a._tileLoaded();}}),h.tileLayer=function(a,i){return new h.TileLayer(a,i);},h.TileLayer.WMS=h.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1},initialize:function(k,m){this._url=k;var a=h.extend({},this.defaultWmsParams),o=m.tileSize||this.options.tileSize;a.width=a.height=m.detectRetina&&h.Browser.retina?2*o:o;for(var l in m){this.options.hasOwnProperty(l)||"crs"===l||(a[l]=m[l]);}this.wmsParams=a,h.setOptions(this,m);},onAdd:function(a){this._crs=this.options.crs||a.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var i=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[i]=this._crs.code,h.TileLayer.prototype.onAdd.call(this,a);},getTileUrl:function(w){var u=this._map,p=this.options.tileSize,m=w.multiplyBy(p),x=m.add([p,p]),v=this._crs.project(u.unproject(m,w.z)),k=this._crs.project(u.unproject(x,w.z)),q=this._wmsVersion>=1.3&&this._crs===h.CRS.EPSG4326?[k.y,v.x,v.y,k.x].join(","):[v.x,k.y,k.x,v.y].join(","),o=h.Util.template(this._url,{s:this._getSubdomain(w)});return o+h.Util.getParamString(this.wmsParams,o,!0)+"&BBOX="+q;},setParams:function(a,i){return h.extend(this.wmsParams,a),i||this.redraw(),this;}}),h.tileLayer.wms=function(a,i){return new h.TileLayer.WMS(a,i);},h.TileLayer.Canvas=h.TileLayer.extend({options:{async:!1},initialize:function(a){h.setOptions(this,a);},redraw:function(){this._map&&(this._reset({hard:!0}),this._update());for(var a in this._tiles){this._redrawTile(this._tiles[a]);}return this;},_redrawTile:function(a){this.drawTile(a,a._tilePoint,this._map._zoom);},_createTile:function(){var a=h.DomUtil.create("canvas","leaflet-tile");return a.width=a.height=this.options.tileSize,a.onselectstart=a.onmousemove=h.Util.falseFn,a;},_loadTile:function(a,i){a._layer=this,a._tilePoint=i,this._redrawTile(a),this.options.async||this.tileDrawn(a);},drawTile:function(){},tileDrawn:function(a){this._tileOnLoad.call(a);}}),h.tileLayer.canvas=function(a){return new h.TileLayer.Canvas(a);},h.ImageOverlay=h.Class.extend({includes:h.Mixin.Events,options:{opacity:1},initialize:function(k,l,a){this._url=k,this._bounds=h.latLngBounds(l),h.setOptions(this,a);},onAdd:function(a){this._map=a,this._image||this._initImage(),a._panes.overlayPane.appendChild(this._image),a.on("viewreset",this._reset,this),a.options.zoomAnimation&&h.Browser.any3d&&a.on("zoomanim",this._animateZoom,this),this._reset();},onRemove:function(a){a.getPanes().overlayPane.removeChild(this._image),a.off("viewreset",this._reset,this),a.options.zoomAnimation&&a.off("zoomanim",this._animateZoom,this);},addTo:function(a){return a.addLayer(this),this;},setOpacity:function(a){return this.options.opacity=a,this._updateOpacity(),this;},bringToFront:function(){return this._image&&this._map._panes.overlayPane.appendChild(this._image),this;},bringToBack:function(){var a=this._map._panes.overlayPane;return this._image&&a.insertBefore(this._image,a.firstChild),this;},setUrl:function(a){this._url=a,this._image.src=this._url;},getAttribution:function(){return this.options.attribution;},_initImage:function(){this._image=h.DomUtil.create("img","leaflet-image-layer"),this._map.options.zoomAnimation&&h.Browser.any3d?h.DomUtil.addClass(this._image,"leaflet-zoom-animated"):h.DomUtil.addClass(this._image,"leaflet-zoom-hide"),this._updateOpacity(),h.extend(this._image,{galleryimg:"no",onselectstart:h.Util.falseFn,onmousemove:h.Util.falseFn,onload:h.bind(this._onImageLoad,this),src:this._url});},_animateZoom:function(w){var u=this._map,p=this._image,m=u.getZoomScale(w.zoom),x=this._bounds.getNorthWest(),v=this._bounds.getSouthEast(),k=u._latLngToNewLayerPoint(x,w.zoom,w.center),q=u._latLngToNewLayerPoint(v,w.zoom,w.center)._subtract(k),o=k._add(q._multiplyBy(0.5*(1-1/m)));p.style[h.DomUtil.TRANSFORM]=h.DomUtil.getTranslateString(o)+" scale("+m+") ";},_reset:function(){var k=this._image,l=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),a=this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(l);h.DomUtil.setPosition(k,l),k.style.width=a.x+"px",k.style.height=a.y+"px";},_onImageLoad:function(){this.fire("load");},_updateOpacity:function(){h.DomUtil.setOpacity(this._image,this.options.opacity);}}),h.imageOverlay=function(k,l,a){return new h.ImageOverlay(k,l,a);},h.Icon=h.Class.extend({options:{className:""},initialize:function(a){h.setOptions(this,a);},createIcon:function(a){return this._createIcon("icon",a);},createShadow:function(a){return this._createIcon("shadow",a);},_createIcon:function(k,l){var a=this._getIconUrl(k);if(!a){if("icon"===k){throw new Error("iconUrl not set in Icon options (see the docs).");}return null;}var m;return m=l&&"IMG"===l.tagName?this._createImg(a,l):this._createImg(a),this._setIconStyles(m,k),m;},_setIconStyles:function(k,m){var a,o=this.options,l=h.point(o[m+"Size"]);a=h.point("shadow"===m?o.shadowAnchor||o.iconAnchor:o.iconAnchor),!a&&l&&(a=l.divideBy(2,!0)),k.className="leaflet-marker-"+m+" "+o.className,a&&(k.style.marginLeft=-a.x+"px",k.style.marginTop=-a.y+"px"),l&&(k.style.width=l.x+"px",k.style.height=l.y+"px");},_createImg:function(e,a){return a=a||g.createElement("img"),a.src=e,a;},_getIconUrl:function(a){return h.Browser.retina&&this.options[a+"RetinaUrl"]?this.options[a+"RetinaUrl"]:this.options[a+"Url"];}}),h.icon=function(a){return new h.Icon(a);},h.Icon.Default=h.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(k){var l=k+"Url";if(this.options[l]){return this.options[l];}h.Browser.retina&&"icon"===k&&(k+="-2x");var a=h.Icon.Default.imagePath;if(!a){throw new Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.");}return a+"/marker-"+k+".png";}}),h.Icon.Default.imagePath=function(){var l,k,u,q,m,e=g.getElementsByTagName("script"),p=/[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/;for(l=0,k=e.length;k>l;l++){if(u=e[l].src,q=u.match(p)){return m=u.split(p)[0],(m?m+"/":"")+"images";}}}(),h.Marker=h.Class.extend({includes:h.Mixin.Events,options:{icon:new h.Icon.Default,title:"",alt:"",clickable:!0,draggable:!1,keyboard:!0,zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250},initialize:function(a,i){h.setOptions(this,i),this._latlng=h.latLng(a);},onAdd:function(a){this._map=a,a.on("viewreset",this.update,this),this._initIcon(),this.update(),this.fire("add"),a.options.zoomAnimation&&a.options.markerZoomAnimation&&a.on("zoomanim",this._animateZoom,this);},addTo:function(a){return a.addLayer(this),this;},onRemove:function(a){this.dragging&&this.dragging.disable(),this._removeIcon(),this._removeShadow(),this.fire("remove"),a.off({viewreset:this.update,zoomanim:this._animateZoom},this),this._map=null;},getLatLng:function(){return this._latlng;},setLatLng:function(a){return this._latlng=h.latLng(a),this.update(),this.fire("move",{latlng:this._latlng});},setZIndexOffset:function(a){return this.options.zIndexOffset=a,this.update(),this;},setIcon:function(a){return this.options.icon=a,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup),this;},update:function(){if(this._icon){var a=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(a);}return this;},_initIcon:function(){var w=this.options,u=this._map,p=u.options.zoomAnimation&&u.options.markerZoomAnimation,m=p?"leaflet-zoom-animated":"leaflet-zoom-hide",x=w.icon.createIcon(this._icon),v=!1;x!==this._icon&&(this._icon&&this._removeIcon(),v=!0,w.title&&(x.title=w.title),w.alt&&(x.alt=w.alt)),h.DomUtil.addClass(x,m),w.keyboard&&(x.tabIndex="0"),this._icon=x,this._initInteraction(),w.riseOnHover&&h.DomEvent.on(x,"mouseover",this._bringToFront,this).on(x,"mouseout",this._resetZIndex,this);var k=w.icon.createShadow(this._shadow),q=!1;k!==this._shadow&&(this._removeShadow(),q=!0),k&&h.DomUtil.addClass(k,m),this._shadow=k,w.opacity<1&&this._updateOpacity();var o=this._map._panes;v&&o.markerPane.appendChild(this._icon),k&&q&&o.shadowPane.appendChild(this._shadow);},_removeIcon:function(){this.options.riseOnHover&&h.DomEvent.off(this._icon,"mouseover",this._bringToFront).off(this._icon,"mouseout",this._resetZIndex),this._map._panes.markerPane.removeChild(this._icon),this._icon=null;},_removeShadow:function(){this._shadow&&this._map._panes.shadowPane.removeChild(this._shadow),this._shadow=null;},_setPos:function(a){h.DomUtil.setPosition(this._icon,a),this._shadow&&h.DomUtil.setPosition(this._shadow,a),this._zIndex=a.y+this.options.zIndexOffset,this._resetZIndex();},_updateZIndex:function(a){this._icon.style.zIndex=this._zIndex+a;},_animateZoom:function(a){var i=this._map._latLngToNewLayerPoint(this._latlng,a.zoom,a.center).round();this._setPos(i);},_initInteraction:function(){if(this.options.clickable){var k=this._icon,l=["dblclick","mousedown","mouseover","mouseout","contextmenu"];h.DomUtil.addClass(k,"leaflet-clickable"),h.DomEvent.on(k,"click",this._onMouseClick,this),h.DomEvent.on(k,"keypress",this._onKeyPress,this);for(var a=0;a<l.length;a++){h.DomEvent.on(k,l[a],this._fireMouseEvent,this);}h.Handler.MarkerDrag&&(this.dragging=new h.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable());}},_onMouseClick:function(a){var i=this.dragging&&this.dragging.moved();(this.hasEventListeners(a.type)||i)&&h.DomEvent.stopPropagation(a),i||(this.dragging&&this.dragging._enabled||!this._map.dragging||!this._map.dragging.moved())&&this.fire(a.type,{originalEvent:a,latlng:this._latlng});},_onKeyPress:function(a){13===a.keyCode&&this.fire("click",{originalEvent:a,latlng:this._latlng});},_fireMouseEvent:function(a){this.fire(a.type,{originalEvent:a,latlng:this._latlng}),"contextmenu"===a.type&&this.hasEventListeners(a.type)&&h.DomEvent.preventDefault(a),"mousedown"!==a.type?h.DomEvent.stopPropagation(a):h.DomEvent.preventDefault(a);},setOpacity:function(a){return this.options.opacity=a,this._map&&this._updateOpacity(),this;},_updateOpacity:function(){h.DomUtil.setOpacity(this._icon,this.options.opacity),this._shadow&&h.DomUtil.setOpacity(this._shadow,this.options.opacity);},_bringToFront:function(){this._updateZIndex(this.options.riseOffset);},_resetZIndex:function(){this._updateZIndex(0);}}),h.marker=function(a,i){return new h.Marker(a,i);},h.DivIcon=h.Icon.extend({options:{iconSize:[12,12],className:"leaflet-div-icon",html:!1},createIcon:function(e){var a=e&&"DIV"===e.tagName?e:g.createElement("div"),k=this.options;return a.innerHTML=k.html!==!1?k.html:"",k.bgPos&&(a.style.backgroundPosition=-k.bgPos.x+"px "+-k.bgPos.y+"px"),this._setIconStyles(a,"icon"),a;},createShadow:function(){return null;}}),h.divIcon=function(a){return new h.DivIcon(a);},h.Map.mergeOptions({closePopupOnClick:!0}),h.Popup=h.Class.extend({includes:h.Mixin.Events,options:{minWidth:50,maxWidth:300,autoPan:!0,closeButton:!0,offset:[0,7],autoPanPadding:[5,5],keepInView:!1,className:"",zoomAnimation:!0},initialize:function(a,i){h.setOptions(this,a),this._source=i,this._animated=h.Browser.any3d&&this.options.zoomAnimation,this._isOpen=!1;},onAdd:function(a){this._map=a,this._container||this._initLayout();var i=a.options.fadeAnimation;i&&h.DomUtil.setOpacity(this._container,0),a._panes.popupPane.appendChild(this._container),a.on(this._getEvents(),this),this.update(),i&&h.DomUtil.setOpacity(this._container,1),this.fire("open"),a.fire("popupopen",{popup:this}),this._source&&this._source.fire("popupopen",{popup:this});},addTo:function(a){return a.addLayer(this),this;},openOn:function(a){return a.openPopup(this),this;},onRemove:function(a){a._panes.popupPane.removeChild(this._container),h.Util.falseFn(this._container.offsetWidth),a.off(this._getEvents(),this),a.options.fadeAnimation&&h.DomUtil.setOpacity(this._container,0),this._map=null,this.fire("close"),a.fire("popupclose",{popup:this}),this._source&&this._source.fire("popupclose",{popup:this});},getLatLng:function(){return this._latlng;},setLatLng:function(a){return this._latlng=h.latLng(a),this._map&&(this._updatePosition(),this._adjustPan()),this;},getContent:function(){return this._content;},setContent:function(a){return this._content=a,this.update(),this;},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan());},_getEvents:function(){var a={viewreset:this._updatePosition};return this._animated&&(a.zoomanim=this._zoomAnimation),("closeOnClick" in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(a.preclick=this._close),this.options.keepInView&&(a.moveend=this._adjustPan),a;},_close:function(){this._map&&this._map.closePopup(this);},_initLayout:function(){var k,m="leaflet-popup",a=m+" "+this.options.className+" leaflet-zoom-"+(this._animated?"animated":"hide"),o=this._container=h.DomUtil.create("div",a);this.options.closeButton&&(k=this._closeButton=h.DomUtil.create("a",m+"-close-button",o),k.href="#close",k.innerHTML="&#215;",h.DomEvent.disableClickPropagation(k),h.DomEvent.on(k,"click",this._onCloseButtonClick,this));var l=this._wrapper=h.DomUtil.create("div",m+"-content-wrapper",o);h.DomEvent.disableClickPropagation(l),this._contentNode=h.DomUtil.create("div",m+"-content",l),h.DomEvent.disableScrollPropagation(this._contentNode),h.DomEvent.on(l,"contextmenu",h.DomEvent.stopPropagation),this._tipContainer=h.DomUtil.create("div",m+"-tip-container",o),this._tip=h.DomUtil.create("div",m+"-tip",this._tipContainer);},_updateContent:function(){if(this._content){if("string"==typeof this._content){this._contentNode.innerHTML=this._content;}else{for(;this._contentNode.hasChildNodes();){this._contentNode.removeChild(this._contentNode.firstChild);}this._contentNode.appendChild(this._content);}this.fire("contentupdate");}},_updateLayout:function(){var m=this._contentNode,p=m.style;p.width="",p.whiteSpace="nowrap";var l=m.offsetWidth;l=Math.min(l,this.options.maxWidth),l=Math.max(l,this.options.minWidth),p.width=l+1+"px",p.whiteSpace="",p.height="";var q=m.offsetHeight,o=this.options.maxHeight,k="leaflet-popup-scrolled";o&&q>o?(p.height=o+"px",h.DomUtil.addClass(m,k)):h.DomUtil.removeClass(m,k),this._containerWidth=this._container.offsetWidth;},_updatePosition:function(){if(this._map){var k=this._map.latLngToLayerPoint(this._latlng),l=this._animated,a=h.point(this.options.offset);l&&h.DomUtil.setPosition(this._container,k),this._containerBottom=-a.y-(l?0:k.y),this._containerLeft=-Math.round(this._containerWidth/2)+a.x+(l?0:k.x),this._container.style.bottom=this._containerBottom+"px",this._container.style.left=this._containerLeft+"px";}},_zoomAnimation:function(a){var i=this._map._latLngToNewLayerPoint(this._latlng,a.zoom,a.center);h.DomUtil.setPosition(this._container,i);},_adjustPan:function(){if(this.options.autoPan){var z=this._map,v=this._container.offsetHeight,p=this._containerWidth,m=new h.Point(this._containerLeft,-v-this._containerBottom);this._animated&&m._add(h.DomUtil.getPosition(this._container));var A=z.layerPointToContainerPoint(m),x=h.point(this.options.autoPanPadding),k=h.point(this.options.autoPanPaddingTopLeft||x),q=h.point(this.options.autoPanPaddingBottomRight||x),o=z.getSize(),y=0,w=0;A.x+p+q.x>o.x&&(y=A.x+p-o.x+q.x),A.x-y-k.x<0&&(y=A.x-k.x),A.y+v+q.y>o.y&&(w=A.y+v-o.y+q.y),A.y-w-k.y<0&&(w=A.y-k.y),(y||w)&&z.fire("autopanstart").panBy([y,w]);}},_onCloseButtonClick:function(a){this._close(),h.DomEvent.stop(a);}}),h.popup=function(a,i){return new h.Popup(a,i);},h.Map.include({openPopup:function(k,l,a){if(this.closePopup(),!(k instanceof h.Popup)){var m=k;k=new h.Popup(a).setLatLng(l).setContent(m);}return k._isOpen=!0,this._popup=k,this.addLayer(k);},closePopup:function(a){return a&&a!==this._popup||(a=this._popup,this._popup=null),a&&(this.removeLayer(a),a._isOpen=!1),this;}}),h.Marker.include({openPopup:function(){return this._popup&&this._map&&!this._map.hasLayer(this._popup)&&(this._popup.setLatLng(this._latlng),this._map.openPopup(this._popup)),this;},closePopup:function(){return this._popup&&this._popup._close(),this;},togglePopup:function(){return this._popup&&(this._popup._isOpen?this.closePopup():this.openPopup()),this;},bindPopup:function(k,l){var a=h.point(this.options.icon.options.popupAnchor||[0,0]);return a=a.add(h.Popup.prototype.options.offset),l&&l.offset&&(a=a.add(l.offset)),l=h.extend({offset:a},l),this._popupHandlersAdded||(this.on("click",this.togglePopup,this).on("remove",this.closePopup,this).on("move",this._movePopup,this),this._popupHandlersAdded=!0),k instanceof h.Popup?(h.setOptions(k,l),this._popup=k):this._popup=new h.Popup(l,this).setContent(k),this;},setPopupContent:function(a){return this._popup&&this._popup.setContent(a),this;},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this.togglePopup,this).off("remove",this.closePopup,this).off("move",this._movePopup,this),this._popupHandlersAdded=!1),this;},getPopup:function(){return this._popup;},_movePopup:function(a){this._popup.setLatLng(a.latlng);}}),h.LayerGroup=h.Class.extend({initialize:function(k){this._layers={};var l,a;if(k){for(l=0,a=k.length;a>l;l++){this.addLayer(k[l]);}}},addLayer:function(a){var i=this.getLayerId(a);return this._layers[i]=a,this._map&&this._map.addLayer(a),this;},removeLayer:function(a){var i=a in this._layers?a:this.getLayerId(a);return this._map&&this._layers[i]&&this._map.removeLayer(this._layers[i]),delete this._layers[i],this;},hasLayer:function(a){return a?a in this._layers||this.getLayerId(a) in this._layers:!1;},clearLayers:function(){return this.eachLayer(this.removeLayer,this),this;},invoke:function(k){var l,a,m=Array.prototype.slice.call(arguments,1);for(l in this._layers){a=this._layers[l],a[k]&&a[k].apply(a,m);}return this;},onAdd:function(a){this._map=a,this.eachLayer(a.addLayer,a);},onRemove:function(a){this.eachLayer(a.removeLayer,a),this._map=null;},addTo:function(a){return a.addLayer(this),this;},eachLayer:function(k,l){for(var a in this._layers){k.call(l,this._layers[a]);}return this;},getLayer:function(a){return this._layers[a];},getLayers:function(){var a=[];for(var i in this._layers){a.push(this._layers[i]);}return a;},setZIndex:function(a){return this.invoke("setZIndex",a);},getLayerId:function(a){return h.stamp(a);}}),h.layerGroup=function(a){return new h.LayerGroup(a);},h.FeatureGroup=h.LayerGroup.extend({includes:h.Mixin.Events,statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose"},addLayer:function(a){return this.hasLayer(a)?this:("on" in a&&a.on(h.FeatureGroup.EVENTS,this._propagateEvent,this),h.LayerGroup.prototype.addLayer.call(this,a),this._popupContent&&a.bindPopup&&a.bindPopup(this._popupContent,this._popupOptions),this.fire("layeradd",{layer:a}));},removeLayer:function(a){return this.hasLayer(a)?(a in this._layers&&(a=this._layers[a]),a.off(h.FeatureGroup.EVENTS,this._propagateEvent,this),h.LayerGroup.prototype.removeLayer.call(this,a),this._popupContent&&this.invoke("unbindPopup"),this.fire("layerremove",{layer:a})):this;},bindPopup:function(a,i){return this._popupContent=a,this._popupOptions=i,this.invoke("bindPopup",a,i);},openPopup:function(a){for(var i in this._layers){this._layers[i].openPopup(a);break;}return this;},setStyle:function(a){return this.invoke("setStyle",a);},bringToFront:function(){return this.invoke("bringToFront");},bringToBack:function(){return this.invoke("bringToBack");},getBounds:function(){var a=new h.LatLngBounds;return this.eachLayer(function(i){a.extend(i instanceof h.Marker?i.getLatLng():i.getBounds());}),a;},_propagateEvent:function(a){a=h.extend({layer:a.target,target:this},a),this.fire(a.type,a);}}),h.featureGroup=function(a){return new h.FeatureGroup(a);},h.Path=h.Class.extend({includes:[h.Mixin.Events],statics:{CLIP_PADDING:function(){var k=h.Browser.mobile?1280:2000,a=(k/Math.max(d.outerWidth,d.outerHeight)-1)/2;return Math.max(0,Math.min(0.5,a));}()},options:{stroke:!0,color:"#0033ff",dashArray:null,lineCap:null,lineJoin:null,weight:5,opacity:0.5,fill:!1,fillColor:null,fillOpacity:0.2,clickable:!0},initialize:function(a){h.setOptions(this,a);},onAdd:function(a){this._map=a,this._container||(this._initElements(),this._initEvents()),this.projectLatlngs(),this._updatePath(),this._container&&this._map._pathRoot.appendChild(this._container),this.fire("add"),a.on({viewreset:this.projectLatlngs,moveend:this._updatePath},this);},addTo:function(a){return a.addLayer(this),this;},onRemove:function(a){a._pathRoot.removeChild(this._container),this.fire("remove"),this._map=null,h.Browser.vml&&(this._container=null,this._stroke=null,this._fill=null),a.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this);},projectLatlngs:function(){},setStyle:function(a){return h.setOptions(this,a),this._container&&this._updateStyle(),this;},redraw:function(){return this._map&&(this.projectLatlngs(),this._updatePath()),this;}}),h.Map.include({_updatePathViewport:function(){var k=h.Path.CLIP_PADDING,m=this.getSize(),a=h.DomUtil.getPosition(this._mapPane),o=a.multiplyBy(-1)._subtract(m.multiplyBy(k)._round()),l=o.add(m.multiplyBy(1+2*k)._round());this._pathViewport=new h.Bounds(o,l);}}),h.Path.SVG_NS="http://www.w3.org/2000/svg",h.Browser.svg=!(!g.createElementNS||!g.createElementNS(h.Path.SVG_NS,"svg").createSVGRect),h.Path=h.Path.extend({statics:{SVG:h.Browser.svg},bringToFront:function(){var a=this._map._pathRoot,i=this._container;return i&&a.lastChild!==i&&a.appendChild(i),this;},bringToBack:function(){var k=this._map._pathRoot,l=this._container,a=k.firstChild;return l&&a!==l&&k.insertBefore(l,a),this;},getPathString:function(){},_createElement:function(a){return g.createElementNS(h.Path.SVG_NS,a);},_initElements:function(){this._map._initPathRoot(),this._initPath(),this._initStyle();},_initPath:function(){this._container=this._createElement("g"),this._path=this._createElement("path"),this.options.className&&h.DomUtil.addClass(this._path,this.options.className),this._container.appendChild(this._path);},_initStyle:function(){this.options.stroke&&(this._path.setAttribute("stroke-linejoin","round"),this._path.setAttribute("stroke-linecap","round")),this.options.fill&&this._path.setAttribute("fill-rule","evenodd"),this.options.pointerEvents&&this._path.setAttribute("pointer-events",this.options.pointerEvents),this.options.clickable||this.options.pointerEvents||this._path.setAttribute("pointer-events","none"),this._updateStyle();},_updateStyle:function(){this.options.stroke?(this._path.setAttribute("stroke",this.options.color),this._path.setAttribute("stroke-opacity",this.options.opacity),this._path.setAttribute("stroke-width",this.options.weight),this.options.dashArray?this._path.setAttribute("stroke-dasharray",this.options.dashArray):this._path.removeAttribute("stroke-dasharray"),this.options.lineCap&&this._path.setAttribute("stroke-linecap",this.options.lineCap),this.options.lineJoin&&this._path.setAttribute("stroke-linejoin",this.options.lineJoin)):this._path.setAttribute("stroke","none"),this.options.fill?(this._path.setAttribute("fill",this.options.fillColor||this.options.color),this._path.setAttribute("fill-opacity",this.options.fillOpacity)):this._path.setAttribute("fill","none");},_updatePath:function(){var a=this.getPathString();a||(a="M0 0"),this._path.setAttribute("d",a);},_initEvents:function(){if(this.options.clickable){(h.Browser.svg||!h.Browser.vml)&&h.DomUtil.addClass(this._path,"leaflet-clickable"),h.DomEvent.on(this._container,"click",this._onMouseClick,this);for(var a=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"],i=0;i<a.length;i++){h.DomEvent.on(this._container,a[i],this._fireMouseEvent,this);}}},_onMouseClick:function(a){this._map.dragging&&this._map.dragging.moved()||this._fireMouseEvent(a);},_fireMouseEvent:function(k){if(this.hasEventListeners(k.type)){var m=this._map,a=m.mouseEventToContainerPoint(k),o=m.containerPointToLayerPoint(a),l=m.layerPointToLatLng(o);this.fire(k.type,{latlng:l,layerPoint:o,containerPoint:a,originalEvent:k}),"contextmenu"===k.type&&h.DomEvent.preventDefault(k),"mousemove"!==k.type&&h.DomEvent.stopPropagation(k);}}}),h.Map.include({_initPathRoot:function(){this._pathRoot||(this._pathRoot=h.Path.prototype._createElement("svg"),this._panes.overlayPane.appendChild(this._pathRoot),this.options.zoomAnimation&&h.Browser.any3d?(h.DomUtil.addClass(this._pathRoot,"leaflet-zoom-animated"),this.on({zoomanim:this._animatePathZoom,zoomend:this._endPathZoom})):h.DomUtil.addClass(this._pathRoot,"leaflet-zoom-hide"),this.on("moveend",this._updateSvgViewport),this._updateSvgViewport());},_animatePathZoom:function(k){var l=this.getZoomScale(k.zoom),a=this._getCenterOffset(k.center)._multiplyBy(-l)._add(this._pathViewport.min);this._pathRoot.style[h.DomUtil.TRANSFORM]=h.DomUtil.getTranslateString(a)+" scale("+l+") ",this._pathZooming=!0;},_endPathZoom:function(){this._pathZooming=!1;},_updateSvgViewport:function(){if(!this._pathZooming){this._updatePathViewport();var m=this._pathViewport,q=m.min,l=m.max,u=l.x-q.x,o=l.y-q.y,k=this._pathRoot,p=this._panes.overlayPane;h.Browser.mobileWebkit&&p.removeChild(k),h.DomUtil.setPosition(k,q),k.setAttribute("width",u),k.setAttribute("height",o),k.setAttribute("viewBox",[q.x,q.y,u,o].join(" ")),h.Browser.mobileWebkit&&p.appendChild(k);}}}),h.Path.include({bindPopup:function(a,i){return a instanceof h.Popup?this._popup=a:((!this._popup||i)&&(this._popup=new h.Popup(i,this)),this._popup.setContent(a)),this._popupHandlersAdded||(this.on("click",this._openPopup,this).on("remove",this.closePopup,this),this._popupHandlersAdded=!0),this;},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this._openPopup).off("remove",this.closePopup),this._popupHandlersAdded=!1),this;},openPopup:function(a){return this._popup&&(a=a||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)],this._openPopup({latlng:a})),this;},closePopup:function(){return this._popup&&this._popup._close(),this;},_openPopup:function(a){this._popup.setLatLng(a.latlng),this._map.openPopup(this._popup);}}),h.Browser.vml=!h.Browser.svg&&function(){try{var e=g.createElement("div");e.innerHTML='<v:shape adj="1"/>';var a=e.firstChild;return a.style.behavior="url(#default#VML)",a&&"object"==typeof a.adj;}catch(k){return !1;}}(),h.Path=h.Browser.svg||!h.Browser.vml?h.Path:h.Path.extend({statics:{VML:!0,CLIP_PADDING:0.02},_createElement:function(){try{return g.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(e){return g.createElement("<lvml:"+e+' class="lvml">');};}catch(a){return function(e){return g.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">');};}}(),_initPath:function(){var a=this._container=this._createElement("shape");h.DomUtil.addClass(a,"leaflet-vml-shape"+(this.options.className?" "+this.options.className:"")),this.options.clickable&&h.DomUtil.addClass(a,"leaflet-clickable"),a.coordsize="1 1",this._path=this._createElement("path"),a.appendChild(this._path),this._map._pathRoot.appendChild(a);},_initStyle:function(){this._updateStyle();},_updateStyle:function(){var k=this._stroke,l=this._fill,a=this.options,m=this._container;m.stroked=a.stroke,m.filled=a.fill,a.stroke?(k||(k=this._stroke=this._createElement("stroke"),k.endcap="round",m.appendChild(k)),k.weight=a.weight+"px",k.color=a.color,k.opacity=a.opacity,k.dashStyle=a.dashArray?h.Util.isArray(a.dashArray)?a.dashArray.join(" "):a.dashArray.replace(/( *, *)/g," "):"",a.lineCap&&(k.endcap=a.lineCap.replace("butt","flat")),a.lineJoin&&(k.joinstyle=a.lineJoin)):k&&(m.removeChild(k),this._stroke=null),a.fill?(l||(l=this._fill=this._createElement("fill"),m.appendChild(l)),l.color=a.fillColor||a.color,l.opacity=a.fillOpacity):l&&(m.removeChild(l),this._fill=null);},_updatePath:function(){var a=this._container.style;a.display="none",this._path.v=this.getPathString()+" ",a.display="";}}),h.Map.include(h.Browser.svg||!h.Browser.vml?{}:{_initPathRoot:function(){if(!this._pathRoot){var a=this._pathRoot=g.createElement("div");a.className="leaflet-vml-container",this._panes.overlayPane.appendChild(a),this.on("moveend",this._updatePathViewport),this._updatePathViewport();}}}),h.Browser.canvas=function(){return !!g.createElement("canvas").getContext;}(),h.Path=h.Path.SVG&&!d.L_PREFER_CANVAS||!h.Browser.canvas?h.Path:h.Path.extend({statics:{CANVAS:!0,SVG:!1},redraw:function(){return this._map&&(this.projectLatlngs(),this._requestUpdate()),this;},setStyle:function(a){return h.setOptions(this,a),this._map&&(this._updateStyle(),this._requestUpdate()),this;},onRemove:function(a){a.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this),this.options.clickable&&(this._map.off("click",this._onClick,this),this._map.off("mousemove",this._onMouseMove,this)),this._requestUpdate(),this.fire("remove"),this._map=null;},_requestUpdate:function(){this._map&&!h.Path._updateRequest&&(h.Path._updateRequest=h.Util.requestAnimFrame(this._fireMapMoveEnd,this._map));},_fireMapMoveEnd:function(){h.Path._updateRequest=null,this.fire("moveend");},_initElements:function(){this._map._initPathRoot(),this._ctx=this._map._canvasCtx;},_updateStyle:function(){var a=this.options;a.stroke&&(this._ctx.lineWidth=a.weight,this._ctx.strokeStyle=a.color),a.fill&&(this._ctx.fillStyle=a.fillColor||a.color);},_drawPath:function(){var m,p,l,q,o,k;for(this._ctx.beginPath(),m=0,l=this._parts.length;l>m;m++){for(p=0,q=this._parts[m].length;q>p;p++){o=this._parts[m][p],k=(0===p?"move":"line")+"To",this._ctx[k](o.x,o.y);}this instanceof h.Polygon&&this._ctx.closePath();}},_checkIfEmpty:function(){return !this._parts.length;},_updatePath:function(){if(!this._checkIfEmpty()){var a=this._ctx,i=this.options;this._drawPath(),a.save(),this._updateStyle(),i.fill&&(a.globalAlpha=i.fillOpacity,a.fill()),i.stroke&&(a.globalAlpha=i.opacity,a.stroke()),a.restore();}},_initEvents:function(){this.options.clickable&&(this._map.on("mousemove",this._onMouseMove,this),this._map.on("click",this._onClick,this));},_onClick:function(a){this._containsPoint(a.layerPoint)&&this.fire("click",a);},_onMouseMove:function(a){this._map&&!this._map._animatingZoom&&(this._containsPoint(a.layerPoint)?(this._ctx.canvas.style.cursor="pointer",this._mouseInside=!0,this.fire("mouseover",a)):this._mouseInside&&(this._ctx.canvas.style.cursor="",this._mouseInside=!1,this.fire("mouseout",a)));}}),h.Map.include(h.Path.SVG&&!d.L_PREFER_CANVAS||!h.Browser.canvas?{}:{_initPathRoot:function(){var e,a=this._pathRoot;a||(a=this._pathRoot=g.createElement("canvas"),a.style.position="absolute",e=this._canvasCtx=a.getContext("2d"),e.lineCap="round",e.lineJoin="round",this._panes.overlayPane.appendChild(a),this.options.zoomAnimation&&(this._pathRoot.className="leaflet-zoom-animated",this.on("zoomanim",this._animatePathZoom),this.on("zoomend",this._endPathZoom)),this.on("moveend",this._updateCanvasViewport),this._updateCanvasViewport());},_updateCanvasViewport:function(){if(!this._pathZooming){this._updatePathViewport();var k=this._pathViewport,l=k.min,a=k.max.subtract(l),m=this._pathRoot;h.DomUtil.setPosition(m,l),m.width=a.x,m.height=a.y,m.getContext("2d").translate(-l.x,-l.y);}}}),h.LineUtil={simplify:function(k,l){if(!l||!k.length){return k.slice();}var a=l*l;return k=this._reducePoints(k,a),k=this._simplifyDP(k,a);},pointToSegmentDistance:function(k,l,a){return Math.sqrt(this._sqClosestPointOnSegment(k,l,a,!0));},closestPointOnSegment:function(k,l,a){return this._sqClosestPointOnSegment(k,l,a);},_simplifyDP:function(k,p){var u=k.length,q=typeof Uint8Array!=c+""?Uint8Array:Array,l=new q(u);l[0]=l[u-1]=1,this._simplifyDPStep(k,l,p,0,u-1);var i,m=[];for(i=0;u>i;i++){l[i]&&m.push(k[i]);}return m;},_simplifyDPStep:function(w,u,p,m,l){var x,v,k,q=0;for(v=m+1;l-1>=v;v++){k=this._sqClosestPointOnSegment(w[v],w[m],w[l],!0),k>q&&(x=v,q=k);}q>p&&(u[x]=1,this._simplifyDPStep(w,u,p,m,x),this._simplifyDPStep(w,u,p,x,l));},_reducePoints:function(k,m){for(var a=[k[0]],q=1,p=0,l=k.length;l>q;q++){this._sqDist(k[q],k[p])>m&&(a.push(k[q]),p=q);}return l-1>p&&a.push(k[l-1]),a;},clipSegment:function(w,u,p,m){var l,x,v,k=m?this._lastCode:this._getBitCode(w,p),q=this._getBitCode(u,p);for(this._lastCode=q;;){if(!(k|q)){return[w,u];}if(k&q){return !1;}l=k||q,x=this._getEdgeIntersection(w,u,l,p),v=this._getBitCode(x,p),l===k?(w=x,k=v):(u=x,q=v);}},_getEdgeIntersection:function(m,u,l,v){var p=u.x-m.x,k=u.y-m.y,q=v.min,o=v.max;return 8&l?new h.Point(m.x+p*(o.y-m.y)/k,o.y):4&l?new h.Point(m.x+p*(q.y-m.y)/k,q.y):2&l?new h.Point(o.x,m.y+k*(o.x-m.x)/p):1&l?new h.Point(q.x,m.y+k*(q.x-m.x)/p):void 0;},_getBitCode:function(k,l){var a=0;return k.x<l.min.x?a|=1:k.x>l.max.x&&(a|=2),k.y<l.min.y?a|=4:k.y>l.max.y&&(a|=8),a;},_sqDist:function(k,l){var a=l.x-k.x,m=l.y-k.y;return a*a+m*m;},_sqClosestPointOnSegment:function(y,v,p,m){var z,w=v.x,k=v.y,q=p.x-w,o=p.y-k,x=q*q+o*o;return x>0&&(z=((y.x-w)*q+(y.y-k)*o)/x,z>1?(w=p.x,k=p.y):z>0&&(w+=q*z,k+=o*z)),q=y.x-w,o=y.y-k,m?q*q+o*o:new h.Point(w,k);}},h.Polyline=h.Path.extend({initialize:function(a,i){h.Path.prototype.initialize.call(this,i),this._latlngs=this._convertLatLngs(a);},options:{smoothFactor:1,noClip:!1},projectLatlngs:function(){this._originalPoints=[];for(var a=0,i=this._latlngs.length;i>a;a++){this._originalPoints[a]=this._map.latLngToLayerPoint(this._latlngs[a]);}},getPathString:function(){for(var k=0,l=this._parts.length,a="";l>k;k++){a+=this._getPathPartStr(this._parts[k]);}return a;},getLatLngs:function(){return this._latlngs;},setLatLngs:function(a){return this._latlngs=this._convertLatLngs(a),this.redraw();},addLatLng:function(a){return this._latlngs.push(h.latLng(a)),this.redraw();},spliceLatLngs:function(){var a=[].splice.apply(this._latlngs,arguments);return this._convertLatLngs(this._latlngs,!0),this.redraw(),a;},closestLayerPoint:function(A){for(var v,p,m=1/0,B=this._parts,y=null,k=0,q=B.length;q>k;k++){for(var o=B[k],z=1,x=o.length;x>z;z++){v=o[z-1],p=o[z];var w=h.LineUtil._sqClosestPointOnSegment(A,v,p,!0);m>w&&(m=w,y=h.LineUtil._sqClosestPointOnSegment(A,v,p));}}return y&&(y.distance=Math.sqrt(m)),y;},getBounds:function(){return new h.LatLngBounds(this.getLatLngs());},_convertLatLngs:function(k,m){var a,o,l=m?k:[];for(a=0,o=k.length;o>a;a++){if(h.Util.isArray(k[a])&&"number"!=typeof k[a][0]){return;}l[a]=h.latLng(k[a]);}return l;},_initEvents:function(){h.Path.prototype._initEvents.call(this);},_getPathPartStr:function(m){for(var p,l=h.Path.VML,q=0,o=m.length,k="";o>q;q++){p=m[q],l&&p._round(),k+=(q?"L":"M")+p.x+" "+p.y;}return k;},_clipPoints:function(){var m,u,l,v=this._originalPoints,p=v.length;if(this.options.noClip){return void (this._parts=[v]);}this._parts=[];var k=this._parts,q=this._map._pathViewport,o=h.LineUtil;for(m=0,u=0;p-1>m;m++){l=o.clipSegment(v[m],v[m+1],q,m),l&&(k[u]=k[u]||[],k[u].push(l[0]),(l[1]!==v[m+1]||m===p-2)&&(k[u].push(l[1]),u++));}},_simplifyPoints:function(){for(var k=this._parts,l=h.LineUtil,a=0,m=k.length;m>a;a++){k[a]=l.simplify(k[a],this.options.smoothFactor);}},_updatePath:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),h.Path.prototype._updatePath.call(this));}}),h.polyline=function(a,i){return new h.Polyline(a,i);},h.PolyUtil={},h.PolyUtil.clipPolygon=function(C,x){var v,o,D,A,k,w,q,B,z,y=[1,4,2,8],m=h.LineUtil;for(o=0,q=C.length;q>o;o++){C[o]._code=m._getBitCode(C[o],x);}for(A=0;4>A;A++){for(B=y[A],v=[],o=0,q=C.length,D=q-1;q>o;D=o++){k=C[o],w=C[D],k._code&B?w._code&B||(z=m._getEdgeIntersection(w,k,B,x),z._code=m._getBitCode(z,x),v.push(z)):(w._code&B&&(z=m._getEdgeIntersection(w,k,B,x),z._code=m._getBitCode(z,x),v.push(z)),v.push(k));}C=v;}return C;},h.Polygon=h.Polyline.extend({options:{fill:!0},initialize:function(a,i){h.Polyline.prototype.initialize.call(this,a,i),this._initWithHoles(a);},_initWithHoles:function(k){var l,a,m;if(k&&h.Util.isArray(k[0])&&"number"!=typeof k[0][0]){for(this._latlngs=this._convertLatLngs(k[0]),this._holes=k.slice(1),l=0,a=this._holes.length;a>l;l++){m=this._holes[l]=this._convertLatLngs(this._holes[l]),m[0].equals(m[m.length-1])&&m.pop();}}k=this._latlngs,k.length>=2&&k[0].equals(k[k.length-1])&&k.pop();},projectLatlngs:function(){if(h.Polyline.prototype.projectLatlngs.call(this),this._holePoints=[],this._holes){var k,l,a,m;for(k=0,a=this._holes.length;a>k;k++){for(this._holePoints[k]=[],l=0,m=this._holes[k].length;m>l;l++){this._holePoints[k][l]=this._map.latLngToLayerPoint(this._holes[k][l]);}}}},setLatLngs:function(a){return a&&h.Util.isArray(a[0])&&"number"!=typeof a[0][0]?(this._initWithHoles(a),this.redraw()):h.Polyline.prototype.setLatLngs.call(this,a);},_clipPoints:function(){var k=this._originalPoints,m=[];if(this._parts=[k].concat(this._holePoints),!this.options.noClip){for(var a=0,o=this._parts.length;o>a;a++){var l=h.PolyUtil.clipPolygon(this._parts[a],this._map._pathViewport);l.length&&m.push(l);}this._parts=m;}},_getPathPartStr:function(a){var i=h.Polyline.prototype._getPathPartStr.call(this,a);return i+(h.Browser.svg?"z":"x");}}),h.polygon=function(a,i){return new h.Polygon(a,i);},function(){function a(e){return h.FeatureGroup.extend({initialize:function(i,k){this._layers={},this._options=k,this.setLatLngs(i);},setLatLngs:function(l){var k=0,m=l.length;for(this.eachLayer(function(i){m>k?i.setLatLngs(l[k++]):this.removeLayer(i);},this);m>k;){this.addLayer(new e(l[k++],this._options));}return this;},getLatLngs:function(){var i=[];return this.eachLayer(function(k){i.push(k.getLatLngs());}),i;}});}h.MultiPolyline=a(h.Polyline),h.MultiPolygon=a(h.Polygon),h.multiPolyline=function(i,k){return new h.MultiPolyline(i,k);},h.multiPolygon=function(i,k){return new h.MultiPolygon(i,k);};}(),h.Rectangle=h.Polygon.extend({initialize:function(a,i){h.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(a),i);},setBounds:function(a){this.setLatLngs(this._boundsToLatLngs(a));},_boundsToLatLngs:function(a){return a=h.latLngBounds(a),[a.getSouthWest(),a.getNorthWest(),a.getNorthEast(),a.getSouthEast()];}}),h.rectangle=function(a,i){return new h.Rectangle(a,i);},h.Circle=h.Path.extend({initialize:function(k,l,a){h.Path.prototype.initialize.call(this,a),this._latlng=h.latLng(k),this._mRadius=l;},options:{fill:!0},setLatLng:function(a){return this._latlng=h.latLng(a),this.redraw();},setRadius:function(a){return this._mRadius=a,this.redraw();},projectLatlngs:function(){var k=this._getLngRadius(),l=this._latlng,a=this._map.latLngToLayerPoint([l.lat,l.lng-k]);this._point=this._map.latLngToLayerPoint(l),this._radius=Math.max(this._point.x-a.x,1);},getBounds:function(){var k=this._getLngRadius(),l=this._mRadius/40075017*360,a=this._latlng;return new h.LatLngBounds([a.lat-l,a.lng-k],[a.lat+l,a.lng+k]);},getLatLng:function(){return this._latlng;},getPathString:function(){var a=this._point,i=this._radius;return this._checkIfEmpty()?"":h.Browser.svg?"M"+a.x+","+(a.y-i)+"A"+i+","+i+",0,1,1,"+(a.x-0.1)+","+(a.y-i)+" z":(a._round(),i=Math.round(i),"AL "+a.x+","+a.y+" "+i+","+i+" 0,23592600");},getRadius:function(){return this._mRadius;},_getLatRadius:function(){return this._mRadius/40075017*360;},_getLngRadius:function(){return this._getLatRadius()/Math.cos(h.LatLng.DEG_TO_RAD*this._latlng.lat);},_checkIfEmpty:function(){if(!this._map){return !1;}var k=this._map._pathViewport,l=this._radius,a=this._point;return a.x-l>k.max.x||a.y-l>k.max.y||a.x+l<k.min.x||a.y+l<k.min.y;}}),h.circle=function(k,l,a){return new h.Circle(k,l,a);},h.CircleMarker=h.Circle.extend({options:{radius:10,weight:2},initialize:function(a,i){h.Circle.prototype.initialize.call(this,a,null,i),this._radius=this.options.radius;},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng);},_updateStyle:function(){h.Circle.prototype._updateStyle.call(this),this.setRadius(this.options.radius);},setLatLng:function(a){return h.Circle.prototype.setLatLng.call(this,a),this._popup&&this._popup._isOpen&&this._popup.setLatLng(a),this;},setRadius:function(a){return this.options.radius=this._radius=a,this.redraw();},getRadius:function(){return this._radius;}}),h.circleMarker=function(a,i){return new h.CircleMarker(a,i);},h.Polyline.include(h.Path.CANVAS?{_containsPoint:function(y,v){var p,m,z,w,k,q,o,x=this.options.weight/2;for(h.Browser.touch&&(x+=10),p=0,w=this._parts.length;w>p;p++){for(o=this._parts[p],m=0,k=o.length,z=k-1;k>m;z=m++){if((v||0!==m)&&(q=h.LineUtil.pointToSegmentDistance(y,o[z],o[m]),x>=q)){return !0;}}}return !1;}}:{}),h.Polygon.include(h.Path.CANVAS?{_containsPoint:function(y){var v,p,m,z,w,k,q,o,x=!1;if(h.Polyline.prototype._containsPoint.call(this,y,!0)){return !0;}for(z=0,q=this._parts.length;q>z;z++){for(v=this._parts[z],w=0,o=v.length,k=o-1;o>w;k=w++){p=v[w],m=v[k],p.y>y.y!=m.y>y.y&&y.x<(m.x-p.x)*(y.y-p.y)/(m.y-p.y)+p.x&&(x=!x);}}return x;}}:{}),h.Circle.include(h.Path.CANVAS?{_drawPath:function(){var a=this._point;this._ctx.beginPath(),this._ctx.arc(a.x,a.y,this._radius,0,2*Math.PI,!1);},_containsPoint:function(k){var l=this._point,a=this.options.stroke?this.options.weight/2:0;return k.distanceTo(l)<=this._radius+a;}}:{}),h.CircleMarker.include(h.Path.CANVAS?{_updateStyle:function(){h.Path.prototype._updateStyle.call(this);}}:{}),h.GeoJSON=h.FeatureGroup.extend({initialize:function(a,i){h.setOptions(this,i),this._layers={},a&&this.addData(a);},addData:function(m){var q,l,u,o=h.Util.isArray(m)?m:m.features;if(o){for(q=0,l=o.length;l>q;q++){u=o[q],(u.geometries||u.geometry||u.features||u.coordinates)&&this.addData(o[q]);}return this;}var k=this.options;if(!k.filter||k.filter(m)){var p=h.GeoJSON.geometryToLayer(m,k.pointToLayer,k.coordsToLatLng,k);return p.feature=h.GeoJSON.asFeature(m),p.defaultOptions=p.options,this.resetStyle(p),k.onEachFeature&&k.onEachFeature(m,p),this.addLayer(p);}},resetStyle:function(a){var i=this.options.style;i&&(h.Util.extend(a.options,a.defaultOptions),this._setLayerStyle(a,i));},setStyle:function(a){this.eachLayer(function(i){this._setLayerStyle(i,a);},this);},_setLayerStyle:function(a,i){"function"==typeof i&&(i=i(a.feature)),a.setStyle&&a.setStyle(i);}}),h.extend(h.GeoJSON,{geometryToLayer:function(z,v,p,m){var A,x,k,q,o="Feature"===z.type?z.geometry:z,y=o.coordinates,w=[];switch(p=p||this.coordsToLatLng,o.type){case"Point":return A=p(y),v?v(z,A):new h.Marker(A);case"MultiPoint":for(k=0,q=y.length;q>k;k++){A=p(y[k]),w.push(v?v(z,A):new h.Marker(A));}return new h.FeatureGroup(w);case"LineString":return x=this.coordsToLatLngs(y,0,p),new h.Polyline(x,m);case"Polygon":if(2===y.length&&!y[1].length){throw new Error("Invalid GeoJSON object.");}return x=this.coordsToLatLngs(y,1,p),new h.Polygon(x,m);case"MultiLineString":return x=this.coordsToLatLngs(y,1,p),new h.MultiPolyline(x,m);case"MultiPolygon":return x=this.coordsToLatLngs(y,2,p),new h.MultiPolygon(x,m);case"GeometryCollection":for(k=0,q=o.geometries.length;q>k;k++){w.push(this.geometryToLayer({geometry:o.geometries[k],type:"Feature",properties:z.properties},v,p,m));}return new h.FeatureGroup(w);default:throw new Error("Invalid GeoJSON object.");}},coordsToLatLng:function(a){return new h.LatLng(a[1],a[0],a[2]);},coordsToLatLngs:function(m,q,l){var u,r,p,k=[];for(r=0,p=m.length;p>r;r++){u=q?this.coordsToLatLngs(m[r],q-1,l):(l||this.coordsToLatLng)(m[r]),k.push(u);}return k;},latLngToCoords:function(a){var i=[a.lng,a.lat];return a.alt!==c&&i.push(a.alt),i;},latLngsToCoords:function(k){for(var l=[],a=0,m=k.length;m>a;a++){l.push(h.GeoJSON.latLngToCoords(k[a]));}return l;},getFeature:function(a,i){return a.feature?h.extend({},a.feature,{geometry:i}):h.GeoJSON.asFeature(i);},asFeature:function(a){return"Feature"===a.type?a:{type:"Feature",properties:{},geometry:a};}});var b={toGeoJSON:function(){return h.GeoJSON.getFeature(this,{type:"Point",coordinates:h.GeoJSON.latLngToCoords(this.getLatLng())});}};h.Marker.include(b),h.Circle.include(b),h.CircleMarker.include(b),h.Polyline.include({toGeoJSON:function(){return h.GeoJSON.getFeature(this,{type:"LineString",coordinates:h.GeoJSON.latLngsToCoords(this.getLatLngs())});}}),h.Polygon.include({toGeoJSON:function(){var k,l,a,m=[h.GeoJSON.latLngsToCoords(this.getLatLngs())];if(m[0].push(m[0][0]),this._holes){for(k=0,l=this._holes.length;l>k;k++){a=h.GeoJSON.latLngsToCoords(this._holes[k]),a.push(a[0]),m.push(a);}}return h.GeoJSON.getFeature(this,{type:"Polygon",coordinates:m});}}),function(){function a(e){return function(){var i=[];return this.eachLayer(function(k){i.push(k.toGeoJSON().geometry.coordinates);}),h.GeoJSON.getFeature(this,{type:e,coordinates:i});};}h.MultiPolyline.include({toGeoJSON:a("MultiLineString")}),h.MultiPolygon.include({toGeoJSON:a("MultiPolygon")}),h.LayerGroup.include({toGeoJSON:function(){var m,k=this.feature&&this.feature.geometry,o=[];if(k&&"MultiPoint"===k.type){return a("MultiPoint").call(this);}var l=k&&"GeometryCollection"===k.type;return this.eachLayer(function(e){e.toGeoJSON&&(m=e.toGeoJSON(),o.push(l?m.geometry:h.GeoJSON.asFeature(m)));}),l?h.GeoJSON.getFeature(this,{geometries:o,type:"GeometryCollection"}):{type:"FeatureCollection",features:o};}});}(),h.geoJson=function(a,i){return new h.GeoJSON(a,i);},h.DomEvent={addListener:function(w,u,p,m){var x,v,k,q=h.stamp(p),o="_leaflet_"+u+q;return w[o]?this:(x=function(a){return p.call(m||w,a||h.DomEvent._getEvent());},h.Browser.pointer&&0===u.indexOf("touch")?this.addPointerListener(w,u,x,q):(h.Browser.touch&&"dblclick"===u&&this.addDoubleTapListener&&this.addDoubleTapListener(w,x,q),"addEventListener" in w?"mousewheel"===u?(w.addEventListener("DOMMouseScroll",x,!1),w.addEventListener(u,x,!1)):"mouseenter"===u||"mouseleave"===u?(v=x,k="mouseenter"===u?"mouseover":"mouseout",x=function(a){return h.DomEvent._checkMouse(w,a)?v(a):void 0;},w.addEventListener(k,x,!1)):"click"===u&&h.Browser.android?(v=x,x=function(a){return h.DomEvent._filterClick(a,v);},w.addEventListener(u,x,!1)):w.addEventListener(u,x,!1):"attachEvent" in w&&w.attachEvent("on"+u,x),w[o]=x,this));},removeListener:function(m,p,l){var q=h.stamp(l),o="_leaflet_"+p+q,k=m[o];return k?(h.Browser.pointer&&0===p.indexOf("touch")?this.removePointerListener(m,p,q):h.Browser.touch&&"dblclick"===p&&this.removeDoubleTapListener?this.removeDoubleTapListener(m,q):"removeEventListener" in m?"mousewheel"===p?(m.removeEventListener("DOMMouseScroll",k,!1),m.removeEventListener(p,k,!1)):"mouseenter"===p||"mouseleave"===p?m.removeEventListener("mouseenter"===p?"mouseover":"mouseout",k,!1):m.removeEventListener(p,k,!1):"detachEvent" in m&&m.detachEvent("on"+p,k),m[o]=null,this):this;},stopPropagation:function(a){return a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,h.DomEvent._skipped(a),this;},disableScrollPropagation:function(a){var i=h.DomEvent.stopPropagation;return h.DomEvent.on(a,"mousewheel",i).on(a,"MozMousePixelScroll",i);},disableClickPropagation:function(k){for(var l=h.DomEvent.stopPropagation,a=h.Draggable.START.length-1;a>=0;a--){h.DomEvent.on(k,h.Draggable.START[a],l);}return h.DomEvent.on(k,"click",h.DomEvent._fakeStop).on(k,"dblclick",l);},preventDefault:function(a){return a.preventDefault?a.preventDefault():a.returnValue=!1,this;},stop:function(a){return h.DomEvent.preventDefault(a).stopPropagation(a);},getMousePosition:function(k,l){if(!l){return new h.Point(k.clientX,k.clientY);}var a=l.getBoundingClientRect();return new h.Point(k.clientX-a.left-l.clientLeft,k.clientY-a.top-l.clientTop);},getWheelDelta:function(a){var i=0;return a.wheelDelta&&(i=a.wheelDelta/120),a.detail&&(i=-a.detail/3),i;},_skipEvents:{},_fakeStop:function(a){h.DomEvent._skipEvents[a.type]=!0;},_skipped:function(a){var i=this._skipEvents[a.type];return this._skipEvents[a.type]=!1,i;},_checkMouse:function(k,l){var a=l.relatedTarget;if(!a){return !0;}try{for(;a&&a!==k;){a=a.parentNode;}}catch(m){return !1;}return a!==k;},_getEvent:function(){var k=d.event;if(!k){for(var a=arguments.callee.caller;a&&(k=a.arguments[0],!k||d.Event!==k.constructor);){a=a.caller;}}return k;},_filterClick:function(k,l){var a=k.timeStamp||k.originalEvent.timeStamp,m=h.DomEvent._lastClick&&a-h.DomEvent._lastClick;return m&&m>100&&500>m||k.target._simulatedClick&&!k._simulated?void h.DomEvent.stop(k):(h.DomEvent._lastClick=a,l(k));}},h.DomEvent.on=h.DomEvent.addListener,h.DomEvent.off=h.DomEvent.removeListener,h.Draggable=h.Class.extend({includes:h.Mixin.Events,statics:{START:h.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(a,i){this._element=a,this._dragStartTarget=i||a;},enable:function(){if(!this._enabled){for(var a=h.Draggable.START.length-1;a>=0;a--){h.DomEvent.on(this._dragStartTarget,h.Draggable.START[a],this._onDown,this);}this._enabled=!0;}},disable:function(){if(this._enabled){for(var a=h.Draggable.START.length-1;a>=0;a--){h.DomEvent.off(this._dragStartTarget,h.Draggable.START[a],this._onDown,this);}this._enabled=!1,this._moved=!1;}},_onDown:function(e){if(this._moved=!1,!(e.shiftKey||1!==e.which&&1!==e.button&&!e.touches||(h.DomEvent.stopPropagation(e),h.Draggable._disabled||(h.DomUtil.disableImageDrag(),h.DomUtil.disableTextSelection(),this._moving)))){var a=e.touches?e.touches[0]:e;this._startPoint=new h.Point(a.clientX,a.clientY),this._startPos=this._newPos=h.DomUtil.getPosition(this._element),h.DomEvent.on(g,h.Draggable.MOVE[e.type],this._onMove,this).on(g,h.Draggable.END[e.type],this._onUp,this);}},_onMove:function(e){if(e.touches&&e.touches.length>1){return void (this._moved=!0);}var a=e.touches&&1===e.touches.length?e.touches[0]:e,l=new h.Point(a.clientX,a.clientY),k=l.subtract(this._startPoint);(k.x||k.y)&&(h.Browser.touch&&Math.abs(k.x)+Math.abs(k.y)<3||(h.DomEvent.preventDefault(e),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=h.DomUtil.getPosition(this._element).subtract(k),h.DomUtil.addClass(g.body,"leaflet-dragging"),this._lastTarget=e.target||e.srcElement,h.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(k),this._moving=!0,h.Util.cancelAnimFrame(this._animRequest),this._animRequest=h.Util.requestAnimFrame(this._updatePosition,this,!0,this._dragStartTarget)));},_updatePosition:function(){this.fire("predrag"),h.DomUtil.setPosition(this._element,this._newPos),this.fire("drag");},_onUp:function(){h.DomUtil.removeClass(g.body,"leaflet-dragging"),this._lastTarget&&(h.DomUtil.removeClass(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null);for(var a in h.Draggable.MOVE){h.DomEvent.off(g,h.Draggable.MOVE[a],this._onMove).off(g,h.Draggable.END[a],this._onUp);}h.DomUtil.enableImageDrag(),h.DomUtil.enableTextSelection(),this._moved&&this._moving&&(h.Util.cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1;}}),h.Handler=h.Class.extend({initialize:function(a){this._map=a;},enable:function(){this._enabled||(this._enabled=!0,this.addHooks());},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks());},enabled:function(){return !!this._enabled;}}),h.Map.mergeOptions({dragging:!0,inertia:!h.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,inertiaThreshold:h.Browser.touch?32:18,easeLinearity:0.25,worldCopyJump:!1}),h.Map.Drag=h.Handler.extend({addHooks:function(){if(!this._draggable){var a=this._map;this._draggable=new h.Draggable(a._mapPane,a._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),a.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDrag,this),a.on("viewreset",this._onViewReset,this),a.whenReady(this._onViewReset,this));}this._draggable.enable();},removeHooks:function(){this._draggable.disable();},moved:function(){return this._draggable&&this._draggable._moved;},_onDragStart:function(){var a=this._map;a._panAnim&&a._panAnim.stop(),a.fire("movestart").fire("dragstart"),a.options.inertia&&(this._positions=[],this._times=[]);},_onDrag:function(){if(this._map.options.inertia){var a=this._lastTime=+new Date,i=this._lastPos=this._draggable._newPos;this._positions.push(i),this._times.push(a),a-this._times[0]>200&&(this._positions.shift(),this._times.shift());}this._map.fire("move").fire("drag");},_onViewReset:function(){var a=this._map.getSize()._divideBy(2),i=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=i.subtract(a).x,this._worldWidth=this._map.project([0,180]).x;},_onPreDrag:function(){var m=this._worldWidth,q=Math.round(m/2),l=this._initialWorldOffset,u=this._draggable._newPos.x,r=(u-q+l)%m+q-l,p=(u+q+l)%m-q-l,k=Math.abs(r+l)<Math.abs(p+l)?r:p;this._draggable._newPos.x=k;},_onDragEnd:function(D){var x=this._map,v=x.options,o=+new Date-this._lastTime,E=!v.inertia||o>v.inertiaThreshold||!this._positions[0];if(x.fire("dragend",D),E){x.fire("moveend");}else{var A=this._lastPos.subtract(this._positions[0]),k=(this._lastTime+o-this._times[0])/1000,w=v.easeLinearity,q=A.multiplyBy(w/k),C=q.distanceTo([0,0]),z=Math.min(v.inertiaMaxSpeed,C),y=q.multiplyBy(z/C),m=z/(v.inertiaDeceleration*w),B=y.multiplyBy(-m/2).round();B.x&&B.y?(B=x._limitOffset(B,x.options.maxBounds),h.Util.requestAnimFrame(function(){x.panBy(B,{duration:m,easeLinearity:w,noMoveStart:!0});})):x.fire("moveend");}}}),h.Map.addInitHook("addHandler","dragging",h.Map.Drag),h.Map.mergeOptions({doubleClickZoom:!0}),h.Map.DoubleClickZoom=h.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this);},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this);},_onDoubleClick:function(k){var l=this._map,a=l.getZoom()+(k.originalEvent.shiftKey?-1:1);"center"===l.options.doubleClickZoom?l.setZoom(a):l.setZoomAround(k.containerPoint,a);}}),h.Map.addInitHook("addHandler","doubleClickZoom",h.Map.DoubleClickZoom),h.Map.mergeOptions({scrollWheelZoom:!0}),h.Map.ScrollWheelZoom=h.Handler.extend({addHooks:function(){h.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this),h.DomEvent.on(this._map._container,"MozMousePixelScroll",h.DomEvent.preventDefault),this._delta=0;},removeHooks:function(){h.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll),h.DomEvent.off(this._map._container,"MozMousePixelScroll",h.DomEvent.preventDefault);},_onWheelScroll:function(k){var l=h.DomEvent.getWheelDelta(k);this._delta+=l,this._lastMousePos=this._map.mouseEventToContainerPoint(k),this._startTime||(this._startTime=+new Date);var a=Math.max(40-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(h.bind(this._performZoom,this),a),h.DomEvent.preventDefault(k),h.DomEvent.stopPropagation(k);},_performZoom:function(){var k=this._map,l=this._delta,a=k.getZoom();l=l>0?Math.ceil(l):Math.floor(l),l=Math.max(Math.min(l,4),-4),l=k._limitZoom(a+l)-a,this._delta=0,this._startTime=null,l&&("center"===k.options.scrollWheelZoom?k.setZoom(a+l):k.setZoomAround(this._lastMousePos,a+l));}}),h.Map.addInitHook("addHandler","scrollWheelZoom",h.Map.ScrollWheelZoom),h.extend(h.DomEvent,{_touchstart:h.Browser.msPointer?"MSPointerDown":h.Browser.pointer?"pointerdown":"touchstart",_touchend:h.Browser.msPointer?"MSPointerUp":h.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(D,w,o){function E(l){var m;if(h.Browser.pointer?(B.push(l.pointerId),m=B.length):m=l.touches.length,!(m>1)){var a=Date.now(),p=a-(e||a);x=l.touches?l.touches[0]:l,v=p>0&&C>=p,e=a;}}function A(l){if(h.Browser.pointer){var p=B.indexOf(l.pointerId);if(-1===p){return;}B.splice(p,1);}if(v){if(h.Browser.pointer){var r,m={};for(var i in x){r=x[i],m[i]="function"==typeof r?r.bind(x):r;}x=m;}x.type="dblclick",w(x),e=null;}}var e,x,v=!1,C=250,z="_leaflet_",y=this._touchstart,k=this._touchend,B=[];D[z+y+o]=E,D[z+k+o]=A;var q=h.Browser.pointer?g.documentElement:D;return D.addEventListener(y,E,!1),q.addEventListener(k,A,!1),h.Browser.pointer&&q.addEventListener(h.DomEvent.POINTER_CANCEL,A,!1),this;},removeDoubleTapListener:function(e,a){var k="_leaflet_";return e.removeEventListener(this._touchstart,e[k+this._touchstart+a],!1),(h.Browser.pointer?g.documentElement:e).removeEventListener(this._touchend,e[k+this._touchend+a],!1),h.Browser.pointer&&g.documentElement.removeEventListener(h.DomEvent.POINTER_CANCEL,e[k+this._touchend+a],!1),this;}}),h.extend(h.DomEvent,{POINTER_DOWN:h.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:h.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:h.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:h.Browser.msPointer?"MSPointerCancel":"pointercancel",_pointers:[],_pointerDocumentListener:!1,addPointerListener:function(k,l,a,m){switch(l){case"touchstart":return this.addPointerListenerStart(k,l,a,m);case"touchend":return this.addPointerListenerEnd(k,l,a,m);case"touchmove":return this.addPointerListenerMove(k,l,a,m);default:throw"Unknown touch event type";}},addPointerListenerStart:function(o,m,v,q){var k="_leaflet_",u=this._pointers,p=function(l){h.DomEvent.preventDefault(l);for(var n=!1,a=0;a<u.length;a++){if(u[a].pointerId===l.pointerId){n=!0;break;}}n||u.push(l),l.touches=u.slice(),l.changedTouches=[l],v(l);};if(o[k+"touchstart"+q]=p,o.addEventListener(this.POINTER_DOWN,p,!1),!this._pointerDocumentListener){var e=function(a){for(var i=0;i<u.length;i++){if(u[i].pointerId===a.pointerId){u.splice(i,1);break;}}};g.documentElement.addEventListener(this.POINTER_UP,e,!1),g.documentElement.addEventListener(this.POINTER_CANCEL,e,!1),this._pointerDocumentListener=!0;}return this;},addPointerListenerMove:function(m,q,l,u){function r(a){if(a.pointerType!==a.MSPOINTER_TYPE_MOUSE&&"mouse"!==a.pointerType||0!==a.buttons){for(var i=0;i<k.length;i++){if(k[i].pointerId===a.pointerId){k[i]=a;break;}}a.touches=k.slice(),a.changedTouches=[a],l(a);}}var p="_leaflet_",k=this._pointers;return m[p+"touchmove"+u]=r,m.addEventListener(this.POINTER_MOVE,r,!1),this;},addPointerListenerEnd:function(m,q,l,u){var r="_leaflet_",p=this._pointers,k=function(a){for(var i=0;i<p.length;i++){if(p[i].pointerId===a.pointerId){p.splice(i,1);break;}}a.touches=p.slice(),a.changedTouches=[a],l(a);};return m[r+"touchend"+u]=k,m.addEventListener(this.POINTER_UP,k,!1),m.addEventListener(this.POINTER_CANCEL,k,!1),this;},removePointerListener:function(k,l,a){var p="_leaflet_",m=k[p+l+a];switch(l){case"touchstart":k.removeEventListener(this.POINTER_DOWN,m,!1);break;case"touchmove":k.removeEventListener(this.POINTER_MOVE,m,!1);break;case"touchend":k.removeEventListener(this.POINTER_UP,m,!1),k.removeEventListener(this.POINTER_CANCEL,m,!1);}return this;}}),h.Map.mergeOptions({touchZoom:h.Browser.touch&&!h.Browser.android23,bounceAtZoomLimits:!0}),h.Map.TouchZoom=h.Handler.extend({addHooks:function(){h.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this);},removeHooks:function(){h.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this);},_onTouchStart:function(l){var k=this._map;if(l.touches&&2===l.touches.length&&!k._animatingZoom&&!this._zooming){var o=k.mouseEventToLayerPoint(l.touches[0]),m=k.mouseEventToLayerPoint(l.touches[1]),e=k._getCenterLayerPoint();this._startCenter=o.add(m)._divideBy(2),this._startDist=o.distanceTo(m),this._moved=!1,this._zooming=!0,this._centerOffset=e.subtract(this._startCenter),k._panAnim&&k._panAnim.stop(),h.DomEvent.on(g,"touchmove",this._onTouchMove,this).on(g,"touchend",this._onTouchEnd,this),h.DomEvent.preventDefault(l);}},_onTouchMove:function(k){var l=this._map;if(k.touches&&2===k.touches.length&&this._zooming){var a=l.mouseEventToLayerPoint(k.touches[0]),m=l.mouseEventToLayerPoint(k.touches[1]);this._scale=a.distanceTo(m)/this._startDist,this._delta=a._add(m)._divideBy(2)._subtract(this._startCenter),1!==this._scale&&(l.options.bounceAtZoomLimits||!(l.getZoom()===l.getMinZoom()&&this._scale<1||l.getZoom()===l.getMaxZoom()&&this._scale>1))&&(this._moved||(h.DomUtil.addClass(l._mapPane,"leaflet-touching"),l.fire("movestart").fire("zoomstart"),this._moved=!0),h.Util.cancelAnimFrame(this._animRequest),this._animRequest=h.Util.requestAnimFrame(this._updateOnMove,this,!0,this._map._container),h.DomEvent.preventDefault(k));}},_updateOnMove:function(){var k=this._map,l=this._getScaleOrigin(),a=k.layerPointToLatLng(l),m=k.getScaleZoom(this._scale);k._animateZoom(a,m,this._startCenter,this._scale,this._delta,!1,!0);},_onTouchEnd:function(){if(!this._moved||!this._zooming){return void (this._zooming=!1);}var o=this._map;this._zooming=!1,h.DomUtil.removeClass(o._mapPane,"leaflet-touching"),h.Util.cancelAnimFrame(this._animRequest),h.DomEvent.off(g,"touchmove",this._onTouchMove).off(g,"touchend",this._onTouchEnd);var m=this._getScaleOrigin(),v=o.layerPointToLatLng(m),q=o.getZoom(),k=o.getScaleZoom(this._scale)-q,u=k>0?Math.ceil(k):Math.floor(k),p=o._limitZoom(q+u),e=o.getZoomScale(p)/this._scale;o._animateZoom(v,p,m,e);},_getScaleOrigin:function(){var a=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(a);}}),h.Map.addInitHook("addHandler","touchZoom",h.Map.TouchZoom),h.Map.mergeOptions({tap:!0,tapTolerance:15}),h.Map.Tap=h.Handler.extend({addHooks:function(){h.DomEvent.on(this._map._container,"touchstart",this._onDown,this);},removeHooks:function(){h.DomEvent.off(this._map._container,"touchstart",this._onDown,this);},_onDown:function(e){if(e.touches){if(h.DomEvent.preventDefault(e),this._fireClick=!0,e.touches.length>1){return this._fireClick=!1,void clearTimeout(this._holdTimeout);}var a=e.touches[0],k=a.target;this._startPos=this._newPos=new h.Point(a.clientX,a.clientY),k.tagName&&"a"===k.tagName.toLowerCase()&&h.DomUtil.addClass(k,"leaflet-active"),this._holdTimeout=setTimeout(h.bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",a));},this),1000),h.DomEvent.on(g,"touchmove",this._onMove,this).on(g,"touchend",this._onUp,this);}},_onUp:function(e){if(clearTimeout(this._holdTimeout),h.DomEvent.off(g,"touchmove",this._onMove,this).off(g,"touchend",this._onUp,this),this._fireClick&&e&&e.changedTouches){var a=e.changedTouches[0],k=a.target;k&&k.tagName&&"a"===k.tagName.toLowerCase()&&h.DomUtil.removeClass(k,"leaflet-active"),this._isTapValid()&&this._simulateEvent("click",a);}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance;},_onMove:function(a){var i=a.touches[0];this._newPos=new h.Point(i.clientX,i.clientY);},_simulateEvent:function(a,k){var e=g.createEvent("MouseEvents");e._simulated=!0,k.target._simulatedClick=!0,e.initMouseEvent(a,!0,!0,d,1,k.screenX,k.screenY,k.clientX,k.clientY,!1,!1,!1,!1,0,null),k.target.dispatchEvent(e);}}),h.Browser.touch&&!h.Browser.pointer&&h.Map.addInitHook("addHandler","tap",h.Map.Tap),h.Map.mergeOptions({boxZoom:!0}),h.Map.BoxZoom=h.Handler.extend({initialize:function(a){this._map=a,this._container=a._container,this._pane=a._panes.overlayPane,this._moved=!1;},addHooks:function(){h.DomEvent.on(this._container,"mousedown",this._onMouseDown,this);},removeHooks:function(){h.DomEvent.off(this._container,"mousedown",this._onMouseDown),this._moved=!1;},moved:function(){return this._moved;},_onMouseDown:function(a){return this._moved=!1,!a.shiftKey||1!==a.which&&1!==a.button?!1:(h.DomUtil.disableTextSelection(),h.DomUtil.disableImageDrag(),this._startLayerPoint=this._map.mouseEventToLayerPoint(a),void h.DomEvent.on(g,"mousemove",this._onMouseMove,this).on(g,"mouseup",this._onMouseUp,this).on(g,"keydown",this._onKeyDown,this));},_onMouseMove:function(m){this._moved||(this._box=h.DomUtil.create("div","leaflet-zoom-box",this._pane),h.DomUtil.setPosition(this._box,this._startLayerPoint),this._container.style.cursor="crosshair",this._map.fire("boxzoomstart"));var p=this._startLayerPoint,l=this._box,q=this._map.mouseEventToLayerPoint(m),o=q.subtract(p),k=new h.Point(Math.min(q.x,p.x),Math.min(q.y,p.y));h.DomUtil.setPosition(l,k),this._moved=!0,l.style.width=Math.max(0,Math.abs(o.x)-4)+"px",l.style.height=Math.max(0,Math.abs(o.y)-4)+"px";},_finish:function(){this._moved&&(this._pane.removeChild(this._box),this._container.style.cursor=""),h.DomUtil.enableTextSelection(),h.DomUtil.enableImageDrag(),h.DomEvent.off(g,"mousemove",this._onMouseMove).off(g,"mouseup",this._onMouseUp).off(g,"keydown",this._onKeyDown);},_onMouseUp:function(k){this._finish();var l=this._map,a=l.mouseEventToLayerPoint(k);if(!this._startLayerPoint.equals(a)){var m=new h.LatLngBounds(l.layerPointToLatLng(this._startLayerPoint),l.layerPointToLatLng(a));l.fitBounds(m),l.fire("boxzoomend",{boxZoomBounds:m});}},_onKeyDown:function(a){27===a.keyCode&&this._finish();}}),h.Map.addInitHook("addHandler","boxZoom",h.Map.BoxZoom),h.Map.mergeOptions({keyboard:!0,keyboardPanOffset:80,keyboardZoomOffset:1}),h.Map.Keyboard=h.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,173]},initialize:function(a){this._map=a,this._setPanOffset(a.options.keyboardPanOffset),this._setZoomOffset(a.options.keyboardZoomOffset);},addHooks:function(){var a=this._map._container;-1===a.tabIndex&&(a.tabIndex="0"),h.DomEvent.on(a,"focus",this._onFocus,this).on(a,"blur",this._onBlur,this).on(a,"mousedown",this._onMouseDown,this),this._map.on("focus",this._addHooks,this).on("blur",this._removeHooks,this);},removeHooks:function(){this._removeHooks();var a=this._map._container;h.DomEvent.off(a,"focus",this._onFocus,this).off(a,"blur",this._onBlur,this).off(a,"mousedown",this._onMouseDown,this),this._map.off("focus",this._addHooks,this).off("blur",this._removeHooks,this);},_onMouseDown:function(){if(!this._focused){var a=g.body,l=g.documentElement,k=a.scrollTop||l.scrollTop,e=a.scrollLeft||l.scrollLeft;this._map._container.focus(),d.scrollTo(e,k);}},_onFocus:function(){this._focused=!0,this._map.fire("focus");},_onBlur:function(){this._focused=!1,this._map.fire("blur");},_setPanOffset:function(k){var l,a,p=this._panKeys={},m=this.keyCodes;for(l=0,a=m.left.length;a>l;l++){p[m.left[l]]=[-1*k,0];}for(l=0,a=m.right.length;a>l;l++){p[m.right[l]]=[k,0];}for(l=0,a=m.down.length;a>l;l++){p[m.down[l]]=[0,k];}for(l=0,a=m.up.length;a>l;l++){p[m.up[l]]=[0,-1*k];}},_setZoomOffset:function(k){var l,a,p=this._zoomKeys={},m=this.keyCodes;for(l=0,a=m.zoomIn.length;a>l;l++){p[m.zoomIn[l]]=k;}for(l=0,a=m.zoomOut.length;a>l;l++){p[m.zoomOut[l]]=-k;}},_addHooks:function(){h.DomEvent.on(g,"keydown",this._onKeyDown,this);},_removeHooks:function(){h.DomEvent.off(g,"keydown",this._onKeyDown,this);},_onKeyDown:function(k){var l=k.keyCode,a=this._map;if(l in this._panKeys){if(a._panAnim&&a._panAnim._inProgress){return;}a.panBy(this._panKeys[l]),a.options.maxBounds&&a.panInsideBounds(a.options.maxBounds);}else{if(!(l in this._zoomKeys)){return;}a.setZoom(a.getZoom()+this._zoomKeys[l]);}h.DomEvent.stop(k);}}),h.Map.addInitHook("addHandler","keyboard",h.Map.Keyboard),h.Handler.MarkerDrag=h.Handler.extend({initialize:function(a){this._marker=a;},addHooks:function(){var a=this._marker._icon;this._draggable||(this._draggable=new h.Draggable(a,a)),this._draggable.on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this),this._draggable.enable(),h.DomUtil.addClass(this._marker._icon,"leaflet-marker-draggable");},removeHooks:function(){this._draggable.off("dragstart",this._onDragStart,this).off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this),this._draggable.disable(),h.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable");},moved:function(){return this._draggable&&this._draggable._moved;},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart");},_onDrag:function(){var k=this._marker,l=k._shadow,a=h.DomUtil.getPosition(k._icon),m=k._map.layerPointToLatLng(a);l&&h.DomUtil.setPosition(l,a),k._latlng=m,k.fire("move",{latlng:m}).fire("drag");},_onDragEnd:function(a){this._marker.fire("moveend").fire("dragend",a);}}),h.Control=h.Class.extend({options:{position:"topright"},initialize:function(a){h.setOptions(this,a);},getPosition:function(){return this.options.position;},setPosition:function(a){var i=this._map;return i&&i.removeControl(this),this.options.position=a,i&&i.addControl(this),this;},getContainer:function(){return this._container;},addTo:function(k){this._map=k;var l=this._container=this.onAdd(k),a=this.getPosition(),m=k._controlCorners[a];return h.DomUtil.addClass(l,"leaflet-control"),-1!==a.indexOf("bottom")?m.insertBefore(l,m.firstChild):m.appendChild(l),this;},removeFrom:function(k){var l=this.getPosition(),a=k._controlCorners[l];return a.removeChild(this._container),this._map=null,this.onRemove&&this.onRemove(k),this;},_refocusOnMap:function(){this._map&&this._map.getContainer().focus();}}),h.control=function(a){return new h.Control(a);},h.Map.include({addControl:function(a){return a.addTo(this),this;},removeControl:function(a){return a.removeFrom(this),this;},_initControlPos:function(){function k(i,n){var e=a+i+" "+a+n;l[i+n]=h.DomUtil.create("div",e,m);}var l=this._controlCorners={},a="leaflet-",m=this._controlContainer=h.DomUtil.create("div",a+"control-container",this._container);k("top","left"),k("top","right"),k("bottom","left"),k("bottom","right");},_clearControlPos:function(){this._container.removeChild(this._controlContainer);}}),h.Control.Zoom=h.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(k){var l="leaflet-control-zoom",a=h.DomUtil.create("div",l+" leaflet-bar");return this._map=k,this._zoomInButton=this._createButton(this.options.zoomInText,this.options.zoomInTitle,l+"-in",a,this._zoomIn,this),this._zoomOutButton=this._createButton(this.options.zoomOutText,this.options.zoomOutTitle,l+"-out",a,this._zoomOut,this),this._updateDisabled(),k.on("zoomend zoomlevelschange",this._updateDisabled,this),a;},onRemove:function(a){a.off("zoomend zoomlevelschange",this._updateDisabled,this);},_zoomIn:function(a){this._map.zoomIn(a.shiftKey?3:1);},_zoomOut:function(a){this._map.zoomOut(a.shiftKey?3:1);},_createButton:function(m,u,l,v,p,k){var q=h.DomUtil.create("a",l,v);q.innerHTML=m,q.href="#",q.title=u;var o=h.DomEvent.stopPropagation;return h.DomEvent.on(q,"click",o).on(q,"mousedown",o).on(q,"dblclick",o).on(q,"click",h.DomEvent.preventDefault).on(q,"click",p,k).on(q,"click",this._refocusOnMap,k),q;},_updateDisabled:function(){var a=this._map,i="leaflet-disabled";h.DomUtil.removeClass(this._zoomInButton,i),h.DomUtil.removeClass(this._zoomOutButton,i),a._zoom===a.getMinZoom()&&h.DomUtil.addClass(this._zoomOutButton,i),a._zoom===a.getMaxZoom()&&h.DomUtil.addClass(this._zoomInButton,i);}}),h.Map.mergeOptions({zoomControl:!0}),h.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new h.Control.Zoom,this.addControl(this.zoomControl));}),h.control.zoom=function(a){return new h.Control.Zoom(a);},h.Control.Attribution=h.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(a){h.setOptions(this,a),this._attributions={};},onAdd:function(a){this._container=h.DomUtil.create("div","leaflet-control-attribution"),h.DomEvent.disableClickPropagation(this._container);for(var i in a._layers){a._layers[i].getAttribution&&this.addAttribution(a._layers[i].getAttribution());}return a.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this),this._update(),this._container;},onRemove:function(a){a.off("layeradd",this._onLayerAdd).off("layerremove",this._onLayerRemove);},setPrefix:function(a){return this.options.prefix=a,this._update(),this;},addAttribution:function(a){return a?(this._attributions[a]||(this._attributions[a]=0),this._attributions[a]++,this._update(),this):void 0;},removeAttribution:function(a){return a?(this._attributions[a]&&(this._attributions[a]--,this._update()),this):void 0;},_update:function(){if(this._map){var k=[];for(var l in this._attributions){this._attributions[l]&&k.push(l);}var a=[];this.options.prefix&&a.push(this.options.prefix),k.length&&a.push(k.join(", ")),this._container.innerHTML=a.join(" | ");}},_onLayerAdd:function(a){a.layer.getAttribution&&this.addAttribution(a.layer.getAttribution());},_onLayerRemove:function(a){a.layer.getAttribution&&this.removeAttribution(a.layer.getAttribution());}}),h.Map.mergeOptions({attributionControl:!0}),h.Map.addInitHook(function(){this.options.attributionControl&&(this.attributionControl=(new h.Control.Attribution).addTo(this));}),h.control.attribution=function(a){return new h.Control.Attribution(a);},h.Control.Scale=h.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0,updateWhenIdle:!1},onAdd:function(k){this._map=k;var l="leaflet-control-scale",a=h.DomUtil.create("div",l),m=this.options;return this._addScales(m,l,a),k.on(m.updateWhenIdle?"moveend":"move",this._update,this),k.whenReady(this._update,this),a;},onRemove:function(a){a.off(this.options.updateWhenIdle?"moveend":"move",this._update,this);},_addScales:function(k,l,a){k.metric&&(this._mScale=h.DomUtil.create("div",l+"-line",a)),k.imperial&&(this._iScale=h.DomUtil.create("div",l+"-line",a));},_update:function(){var m=this._map.getBounds(),q=m.getCenter().lat,l=6378137*Math.PI*Math.cos(q*Math.PI/180),u=l*(m.getNorthEast().lng-m.getSouthWest().lng)/180,r=this._map.getSize(),p=this.options,k=0;r.x>0&&(k=u*(p.maxWidth/r.x)),this._updateScales(p,k);},_updateScales:function(a,i){a.metric&&i&&this._updateMetric(i),a.imperial&&i&&this._updateImperial(i);},_updateMetric:function(a){var i=this._getRoundNum(a);this._mScale.style.width=this._getScaleWidth(i/a)+"px",this._mScale.innerHTML=1000>i?i+" m":i/1000+" km";},_updateImperial:function(k){var m,a,q,p=3.2808399*k,l=this._iScale;p>5280?(m=p/5280,a=this._getRoundNum(m),l.style.width=this._getScaleWidth(a/m)+"px",l.innerHTML=a+" mi"):(q=this._getRoundNum(p),l.style.width=this._getScaleWidth(q/p)+"px",l.innerHTML=q+" ft");},_getScaleWidth:function(a){return Math.round(this.options.maxWidth*a)-10;},_getRoundNum:function(k){var l=Math.pow(10,(Math.floor(k)+"").length-1),a=k/l;return a=a>=10?10:a>=5?5:a>=3?3:a>=2?2:1,l*a;}}),h.control.scale=function(a){return new h.Control.Scale(a);},h.Control.Layers=h.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0},initialize:function(k,l,a){h.setOptions(this,a),this._layers={},this._lastZIndex=0,this._handlingClick=!1;for(var m in k){this._addLayer(k[m],m);}for(m in l){this._addLayer(l[m],m,!0);}},onAdd:function(a){return this._initLayout(),this._update(),a.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this),this._container;},onRemove:function(a){a.off("layeradd",this._onLayerChange,this).off("layerremove",this._onLayerChange,this);},addBaseLayer:function(a,i){return this._addLayer(a,i),this._update(),this;},addOverlay:function(a,i){return this._addLayer(a,i,!0),this._update(),this;},removeLayer:function(a){var i=h.stamp(a);return delete this._layers[i],this._update(),this;},_initLayout:function(){var k="leaflet-control-layers",l=this._container=h.DomUtil.create("div",k);l.setAttribute("aria-haspopup",!0),h.Browser.touch?h.DomEvent.on(l,"click",h.DomEvent.stopPropagation):h.DomEvent.disableClickPropagation(l).disableScrollPropagation(l);var a=this._form=h.DomUtil.create("form",k+"-list");if(this.options.collapsed){h.Browser.android||h.DomEvent.on(l,"mouseover",this._expand,this).on(l,"mouseout",this._collapse,this);var m=this._layersLink=h.DomUtil.create("a",k+"-toggle",l);m.href="#",m.title="Layers",h.Browser.touch?h.DomEvent.on(m,"click",h.DomEvent.stop).on(m,"click",this._expand,this):h.DomEvent.on(m,"focus",this._expand,this),h.DomEvent.on(a,"click",function(){setTimeout(h.bind(this._onInputClick,this),0);},this),this._map.on("click",this._collapse,this);}else{this._expand();}this._baseLayersList=h.DomUtil.create("div",k+"-base",a),this._separator=h.DomUtil.create("div",k+"-separator",a),this._overlaysList=h.DomUtil.create("div",k+"-overlays",a),l.appendChild(a);},_addLayer:function(k,l,a){var m=h.stamp(k);this._layers[m]={layer:k,name:l,overlay:a},this.options.autoZIndex&&k.setZIndex&&(this._lastZIndex++,k.setZIndex(this._lastZIndex));},_update:function(){if(this._container){this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="";var k,l,a=!1,m=!1;for(k in this._layers){l=this._layers[k],this._addItem(l),m=m||l.overlay,a=a||!l.overlay;}this._separator.style.display=m&&a?"":"none";}},_onLayerChange:function(k){var l=this._layers[h.stamp(k.layer)];if(l){this._handlingClick||this._update();var a=l.overlay?"layeradd"===k.type?"overlayadd":"overlayremove":"layeradd"===k.type?"baselayerchange":null;a&&this._map.fire(a,l);}},_createRadioElement:function(e,a){var l='<input type="radio" class="leaflet-control-layers-selector" name="'+e+'"';a&&(l+=' checked="checked"'),l+="/>";var k=g.createElement("div");return k.innerHTML=l,k.firstChild;},_addItem:function(l){var k,p=g.createElement("label"),m=this._map.hasLayer(l.layer);l.overlay?(k=g.createElement("input"),k.type="checkbox",k.className="leaflet-control-layers-selector",k.defaultChecked=m):k=this._createRadioElement("leaflet-base-layers",m),k.layerId=h.stamp(l.layer),h.DomEvent.on(k,"click",this._onInputClick,this);var e=g.createElement("span");e.innerHTML=" "+l.name,p.appendChild(k),p.appendChild(e);var o=l.overlay?this._overlaysList:this._baseLayersList;return o.appendChild(p),p;},_onInputClick:function(){var k,l,a,p=this._form.getElementsByTagName("input"),m=p.length;for(this._handlingClick=!0,k=0;m>k;k++){l=p[k],a=this._layers[l.layerId],l.checked&&!this._map.hasLayer(a.layer)?this._map.addLayer(a.layer):!l.checked&&this._map.hasLayer(a.layer)&&this._map.removeLayer(a.layer);}this._handlingClick=!1,this._refocusOnMap();},_expand:function(){h.DomUtil.addClass(this._container,"leaflet-control-layers-expanded");},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","");}}),h.control.layers=function(k,l,a){return new h.Control.Layers(k,l,a);},h.PosAnimation=h.Class.extend({includes:h.Mixin.Events,run:function(k,l,a,m){this.stop(),this._el=k,this._inProgress=!0,this._newPos=l,this.fire("start"),k.style[h.DomUtil.TRANSITION]="all "+(a||0.25)+"s cubic-bezier(0,0,"+(m||0.5)+",1)",h.DomEvent.on(k,h.DomUtil.TRANSITION_END,this._onTransitionEnd,this),h.DomUtil.setPosition(k,l),h.Util.falseFn(k.offsetWidth),this._stepTimer=setInterval(h.bind(this._onStep,this),50);},stop:function(){this._inProgress&&(h.DomUtil.setPosition(this._el,this._getPos()),this._onTransitionEnd(),h.Util.falseFn(this._el.offsetWidth));},_onStep:function(){var a=this._getPos();return a?(this._el._leaflet_pos=a,void this.fire("step")):void this._onTransitionEnd();},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var o,l,p,m=this._el,k=d.getComputedStyle(m);if(h.Browser.any3d){if(p=k[h.DomUtil.TRANSFORM].match(this._transformRe),!p){return;}o=parseFloat(p[1]),l=parseFloat(p[2]);}else{o=parseFloat(k.left),l=parseFloat(k.top);}return new h.Point(o,l,!0);},_onTransitionEnd:function(){h.DomEvent.off(this._el,h.DomUtil.TRANSITION_END,this._onTransitionEnd,this),this._inProgress&&(this._inProgress=!1,this._el.style[h.DomUtil.TRANSITION]="",this._el._leaflet_pos=this._newPos,clearInterval(this._stepTimer),this.fire("step").fire("end"));}}),h.Map.include({setView:function(a,k,l){if(k=k===c?this._zoom:this._limitZoom(k),a=this._limitCenter(h.latLng(a),k,this.options.maxBounds),l=l||{},this._panAnim&&this._panAnim.stop(),this._loaded&&!l.reset&&l!==!0){l.animate!==c&&(l.zoom=h.extend({animate:l.animate},l.zoom),l.pan=h.extend({animate:l.animate},l.pan));var i=this._zoom!==k?this._tryAnimatedZoom&&this._tryAnimatedZoom(a,k,l.zoom):this._tryAnimatedPan(a,l.pan);if(i){return clearTimeout(this._sizeTimer),this;}}return this._resetView(a,k),this;},panBy:function(k,l){if(k=h.point(k).round(),l=l||{},!k.x&&!k.y){return this;}if(this._panAnim||(this._panAnim=new h.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),l.noMoveStart||this.fire("movestart"),l.animate!==!1){h.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var a=this._getMapPanePos().subtract(k);this._panAnim.run(this._mapPane,a,l.duration||0.25,l.easeLinearity);}else{this._rawPanBy(k),this.fire("move").fire("moveend");}return this;},_onPanTransitionStep:function(){this.fire("move");},_onPanTransitionEnd:function(){h.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend");},_tryAnimatedPan:function(k,l){var a=this._getCenterOffset(k)._floor();return(l&&l.animate)===!0||this.getSize().contains(a)?(this.panBy(a,l),!0):!1;}}),h.PosAnimation=h.DomUtil.TRANSITION?h.PosAnimation:h.PosAnimation.extend({run:function(k,l,a,m){this.stop(),this._el=k,this._inProgress=!0,this._duration=a||0.25,this._easeOutPower=1/Math.max(m||0.5,0.2),this._startPos=h.DomUtil.getPosition(k),this._offset=l.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate();},stop:function(){this._inProgress&&(this._step(),this._complete());},_animate:function(){this._animId=h.Util.requestAnimFrame(this._animate,this),this._step();},_step:function(){var a=+new Date-this._startTime,i=1000*this._duration;i>a?this._runFrame(this._easeOut(a/i)):(this._runFrame(1),this._complete());},_runFrame:function(a){var i=this._startPos.add(this._offset.multiplyBy(a));h.DomUtil.setPosition(this._el,i),this.fire("step");},_complete:function(){h.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end");},_easeOut:function(a){return 1-Math.pow(1-a,this._easeOutPower);}}),h.Map.mergeOptions({zoomAnimation:!0,zoomAnimationThreshold:4}),h.DomUtil.TRANSITION&&h.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation&&h.DomUtil.TRANSITION&&h.Browser.any3d&&!h.Browser.android23&&!h.Browser.mobileOpera,this._zoomAnimated&&h.DomEvent.on(this._mapPane,h.DomUtil.TRANSITION_END,this._catchTransitionEnd,this);}),h.Map.include(h.DomUtil.TRANSITION?{_catchTransitionEnd:function(a){this._animatingZoom&&a.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd();},_nothingToAnimate:function(){return !this._container.getElementsByClassName("leaflet-zoom-animated").length;},_tryAnimatedZoom:function(k,m,a){if(this._animatingZoom){return !0;}if(a=a||{},!this._zoomAnimated||a.animate===!1||this._nothingToAnimate()||Math.abs(m-this._zoom)>this.options.zoomAnimationThreshold){return !1;}var q=this.getZoomScale(m),p=this._getCenterOffset(k)._divideBy(1-1/q),l=this._getCenterLayerPoint()._add(p);return a.animate===!0||this.getSize().contains(p)?(this.fire("movestart").fire("zoomstart"),this._animateZoom(k,m,l,q,null,!0),!0):!1;},_animateZoom:function(m,q,l,u,o,k,p){p||(this._animatingZoom=!0),h.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim"),this._animateToCenter=m,this._animateToZoom=q,h.Draggable&&(h.Draggable._disabled=!0),h.Util.requestAnimFrame(function(){this.fire("zoomanim",{center:m,zoom:q,origin:l,scale:u,delta:o,backwards:k});},this);},_onZoomTransitionEnd:function(){this._animatingZoom=!1,h.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),this._resetView(this._animateToCenter,this._animateToZoom,!0,!0),h.Draggable&&(h.Draggable._disabled=!1);}}:{}),h.TileLayer.include({_animateZoom:function(k){this._animating||(this._animating=!0,this._prepareBgBuffer());var m=this._bgBuffer,a=h.DomUtil.TRANSFORM,o=k.delta?h.DomUtil.getTranslateString(k.delta):m.style[a],l=h.DomUtil.getScaleString(k.scale,k.origin);m.style[a]=k.backwards?l+" "+o:o+" "+l;},_endZoomAnim:function(){var a=this._tileContainer,i=this._bgBuffer;a.style.visibility="",a.parentNode.appendChild(a),h.Util.falseFn(i.offsetWidth),this._animating=!1;},_clearBgBuffer:function(){var a=this._map;!a||a._animatingZoom||a.touchZoom._zooming||(this._bgBuffer.innerHTML="",this._bgBuffer.style[h.DomUtil.TRANSFORM]="");},_prepareBgBuffer:function(){var k=this._tileContainer,l=this._bgBuffer,a=this._getLoadedTilesPercentage(l),m=this._getLoadedTilesPercentage(k);return l&&a>0.5&&0.5>m?(k.style.visibility="hidden",void this._stopLoadingImages(k)):(l.style.visibility="hidden",l.style[h.DomUtil.TRANSFORM]="",this._tileContainer=l,l=this._bgBuffer=k,this._stopLoadingImages(l),void clearTimeout(this._clearBgBufferTimer));},_getLoadedTilesPercentage:function(k){var l,a,p=k.getElementsByTagName("img"),m=0;for(l=0,a=p.length;a>l;l++){p[l].complete&&m++;}return m/a;},_stopLoadingImages:function(k){var m,a,o,l=Array.prototype.slice.call(k.getElementsByTagName("img"));for(m=0,a=l.length;a>m;m++){o=l[m],o.complete||(o.onload=h.Util.falseFn,o.onerror=h.Util.falseFn,o.src=h.Util.emptyImageUrl,o.parentNode.removeChild(o));}}}),h.Map.include({_defaultLocateOptions:{watch:!1,setView:!1,maxZoom:1/0,timeout:10000,maximumAge:0,enableHighAccuracy:!1},locate:function(k){if(k=this._locateOptions=h.extend(this._defaultLocateOptions,k),!navigator.geolocation){return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;}var l=h.bind(this._handleGeolocationResponse,this),a=h.bind(this._handleGeolocationError,this);return k.watch?this._locationWatchId=navigator.geolocation.watchPosition(l,a,k):navigator.geolocation.getCurrentPosition(l,a,k),this;},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this;},_handleGeolocationError:function(k){var l=k.code,a=k.message||(1===l?"permission denied":2===l?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:l,message:"Geolocation error: "+a+"."});},_handleGeolocationResponse:function(z){var v=z.coords.latitude,p=z.coords.longitude,m=new h.LatLng(v,p),A=180*z.coords.accuracy/40075017,x=A/Math.cos(h.LatLng.DEG_TO_RAD*v),k=h.latLngBounds([v-A,p-x],[v+A,p+x]),q=this._locateOptions;if(q.setView){var o=Math.min(this.getBoundsZoom(k),q.maxZoom);this.setView(m,o);}var y={latlng:m,bounds:k,timestamp:z.timestamp};for(var w in z.coords){"number"==typeof z.coords[w]&&(y[w]=z.coords[w]);}this.fire("locationfound",y);}});}(window,document);define("OK/Map",["jquery","leaflet","OK/suggest/searchEngines"],function(f,k,g){var c=17;var l=0.8;var e=320;var j="map-notactive";var h="map-notfound";var a="search-input_searching";var i="search-input_active";var d="http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";var b=function(){this.$element=null;this.$closeButton=null;this.map=null;this.mapSourceURL=null;this.latitude=null;this.longitude=null;this.zoom=c;this.marker=null;this.icon=k.icon({iconUrl:"/res/i/ic/place-new.png",iconSize:[45,45],iconAnchor:[22,45]});this.options={clickable:false};this.$outputField=null;this.$inputCityField=null;this.$inputAddressField=null;this.$inputAddressWrapper=null;this.searchEngine=g.placesSearchEngine;this.$searchButton=null;this.$mapWrapper=null;this.isMapActive=false;};b.prototype={activate:function(n){var q=function(){var C=this;var E=this.$element;this.latitude=E.data("lat");this.longitude=E.data("long");this.mapSourceURL=E.data("map-url");var r=E.data("zoom");if(r){this.zoom=r;}var D=E.data("height");E.css({height:D||e});var B=!!E.data("is-mini");var A=E.data("static");if(A||B){var J=this.options;this.options=f.extend(J,{dragging:false,zoomControl:false,scrollWheelZoom:false});}this.create(n,[this.latitude,this.longitude]);this.setMarker([this.latitude,this.longitude]);var K=this.map.getCenter();var v=E.data("output-field");if(v){this.$outputField=f("#"+v);}var s=E.data("input-city-field");var H=E.data("input-address-field");if(H&&s){this.$inputCityField=f("#"+s);this.$inputAddressField=f("#"+H);this.$inputAddressWrapper=this.$inputAddressField.closest(".it_w");}this.$mapWrapper=E.closest(".map");this.isMapActive=this.$mapWrapper===null||!this.$mapWrapper.hasClass(j);var t=E.data("start-geocoder-onload");var G=this.$outputField!==null;if(G){var L=function(M){if(C.isMapActive){if(M){C.setMarker(M.latlng);K=M.latlng;}C.$outputField.val(K.lng+","+K.lat+","+C.map.getZoom());}else{C.$outputField.val("");}};this.map.on("click.mapjs",L);if(this.$inputCityField&&this.$inputAddressField){var w=0;var x="";var I=false;var F=function(){if(C.$inputCityField.val()&&C.$inputAddressField.val()){var N=new Date().getTime();var M=C.$inputCityField.val()+", "+C.$inputAddressField.val();if(N-w<3000||x===M){return;}w=N;x=M;C.showSearching();C.setMarkerByQuery(M,function(P){if(P&&P.length){var Q=C.searchEngine.getItemById(P[0]);var O=k.latLng(Q.latitude,Q.longitude);C.setMarker(O);C.activeMap();K=O;L();}else{C.mapNotFound();if(B){C.$outputField.val("");}}I=false;C.hideSearch();});}};var u=E.data("search-button");if(u){this.$searchButton=f("#"+u);this.$searchButton.on("click.mapjs",F);}if(B){this.$inputAddressField.on("focus.mapjs blur.mapjs",F);}var y=function(M){if(M.which===13){M.preventDefault();F();}};var z=function(){var M=C.$inputCityField.val()&&C.$inputAddressField.val()&&((C.$inputCityField.val()+", "+C.$inputAddressField.val())!==x);if(I!==M){I=M;if(M){C.activeSearch();}else{C.hideSearch();}}};this.$inputAddressField.on("keydown.mapjs",y);this.$inputAddressField.on("change.mapjs keyup.mapjs",z);this.$inputCityField.on("keydown.mapjs",y);if(t){F();}}}};this.$element=f(n);var m=this;if(!this.$element.hasClass("invisible")){var p=this.$element.data("delay-load");if(p){setTimeout(function(){q.call(m);},200);}else{q.call(m);}}var o=this.$element.data("toggle-map-event");this.$element.on(o,function(){if(m.$element.hasClass("invisible")){m.$element.removeClass("invisible");if(m.map==null){q.call(m);}}else{m.$element.addClass("invisible");}});this.$closeButton=this.$element.find(".media-map_close");this.$closeButton.on("click",function(){m.$element.addClass("invisible");});},deactivate:function(){this.$element&&this.$element.off("loadMap");this.$closeButton&&this.$closeButton.off("click");this.map&&this.map.off(".mapjs");if(this.$searchButton!==null){this.$searchButton.off(".mapjs");}if(this.$inputAddressField!==null){this.$inputAddressField.off(".mapjs");}if(this.$inputCityField!==null){this.$inputCityField.off(".mapjs");}this.map&&this.map.remove();},create:function(n,m){this.map=k.map(n,this.options);if(m){this.map.setView(m,this.zoom);}this.map.attributionControl.setPrefix('<a target="_blank" href="http://maps.me" class="leaflet-mapsme"></a><a target="_blank" href="http://leafletjs.com">Leaflet</a>');if(!this.mapSourceURL){this.mapSourceURL=d;}k.tileLayer(this.mapSourceURL,{attribution:'&copy; <a target="_blank" href="http://openstreetmap.org">OpenStreetMap</a>'}).on("tileload",function(){OK.logging.logger.success("maps.leaflet","tileLoaded");}).addTo(this.map);},setMarker:function(m,n){if(!this.marker){this.marker=k.marker(m,this.options);this.marker.setIcon(this.icon).setOpacity(l).addTo(this.map);}else{this.marker.setLatLng(m).update();}if(!n){this.map.panTo(m);}},setMarkerByQuery:function(m,n){this.searchEngine.search({query:m,toString:function(){return this.query;}},0,function(o,p){n(p);});},removeMarker:function(){if(this.marker){this.map.removeLayer(this.marker);this.marker=null;}},setCenter:function(m){this.map.setView(m);},panTo:function(m){this.map.panTo(m);},setZoom:function(m){this.map.setZoom(m);},fitToViewport:function(){this.map.invalidateSize(true);},setMapSourceURL:function(m){if(m){this.mapSourceURL=m;}},getMap:function(){return this.map;},activeSearch:function(){this.$inputAddressWrapper.addClass(i);},showSearching:function(){this.$inputAddressWrapper.addClass(a);},hideSearch:function(){this.$inputAddressWrapper.removeClass(i);this.$inputAddressWrapper.removeClass(a);},activeMap:function(){if(this.$mapWrapper!==null){this.$mapWrapper.removeClass(j);this.$mapWrapper.removeClass(h);}this.isMapActive=true;this.fitToViewport();},mapNotFound:function(){if(this.$mapWrapper!==null){this.$mapWrapper.removeClass(j);this.$mapWrapper.addClass(h);}this.isMapActive=false;}};return b;});define("OK/postingForm/places",["require","jquery","OK/utils/utils","OK/utils/vanilla","OK/suggest/suggestImpl","OK/suggest/searchEngines","OK/suggest/inputChecker","OK/Map","OK/logger"],function(b){var d=b("jquery"),h=b("OK/utils/utils"),g=b("OK/utils/vanilla"),c=b("OK/suggest/suggestImpl"),e=b("OK/suggest/searchEngines"),a=b("OK/suggest/inputChecker"),f=b("OK/Map"),i=b("OK/logger");return function(I,aq){var D,aR,P,aY,aT,a6,ap,j,aD,a1,v,ay,aa,aZ,aU,r,a2,y;var aj=80;var aS;var a3={location:null,localeLanguage:"ru",mapEnabled:true,placeAddEnabled:true,OSMSourceURL:null,minSearchQueryLength:0,searchDelay:500,spamType:"ALL",postingFormType:"Status",place:null};var K=[55.751574,37.573856];var a0=12;var aA=false;var J;var Y;var w;var A;var X;var m;var a7;var z=false;var av=false;var ac;var C;var s,Z="addPlaceStepSelectPoint",p="addPlaceStepConfirm";var Q=false;var az={id:"firstPlaceItem"},a5={id:"lastPlaceItem"};aw();function aw(){P=d("#"+I+"_PlaceMain");if(P.length==0){P=null;return;}D=d("#hook_Block_PopLayer");aR=d("#"+I);aY=d("#"+I+"_PlaceMarker");aT=d("#"+I+"_PlaceSelection");a6=d("#"+I+"_PlaceSelectionText");ap=d("#"+I+"_PlaceCount");j=d("#"+I+"_PlaceSearchContainer");aD=d("#"+I+"_PlaceSearchInput");a1=d("#"+I+"_PlaceSearchItemsContainer");ay=d("#"+I+"_PlaceMapBack");v=d("#"+I+"_PlaceMap");aU=d("#"+I+"_PlaceMapAddInfo");r=d("#"+I+"_PlaceMapAddControls");a2=d("#"+I+"_PlaceMapAddControlOk");a2.on("click",an);d("#"+I+"_PlaceMapAddControlCancel").on("click",ai);aS=a1.find(".js-spamTitle").text();aa=d("#"+I+"_PlaceMapMessageTop");aZ=d("#"+I+"_PlaceMapMessageBottom");var be=d("#"+I+"_PlaceAddItem");be.remove();var bc=d("#"+I+"_PlaceSpamForm");y=bc.html();if(y&&y.length>7&&y.substring(0,4)=="<!--"&&y.substring(y.length-3)=="-->"){y=y.substring(4,y.length-3);}aY.on("click",at);ay.on("click",au);a6.on("click",at);d("#"+I+"_PlaceSelctionRemove").on("click",t);aD.on("keydown",ak);aD.on("blur",aN);P.on("mouseenter",function(){z=true;});P.on("mouseleave",function(){z=false;});var ba=d("#"+I+"_PlaceData");a3=OK.util.parseJSON(ba.html());var a8=e.placesSearchEngine;var bd=e.createSearchEngine("PostingFormPlacesSearch","json",a8.prepareRequest,function(bg,bi){var bf=bi.index==0;var bh=a8.processResponse(bg,bi);if(!bh){return bh;}var bj=!bi.hasMore;if(bf){bh.splice(0,0,az);}if(bj){bh.push(a5);}return bh;});var a9={elementId:I+"_PlaceSearch",suggestElId:I+"_PlaceSearchItemsContainer",itemsElId:I+"_PlaceSearchItems",correctSelection:false,getMaxItemsInSuggest:function(){return 0;},getSearchQuery:function(){var bf=!!w;var bh=aD.val();var bg={pin:bf,coords:Y,query:bh,toString:function(){return Y+"/"+bh+"/"+bf;}};return bg;},onItemClicked:af,onSelectedItemChanged:function(bg){if(A&&bg.latitude&&bg.longitude){var bf=[bg.latitude,bg.longitude];n(bf);A.panTo(bf,{delay:1000,flying:true});}},onLoadingChanged:function(bi,bj,bh,bf,bg){av=bi;W(av);k();if(!av&&s==Z){a2.removeClass("__disabled");}if(bf==ac.SEARCH_RESULT_SET_ITEMS&&m&&!P.hasClass("__map")){ac.selectItemById(az.id);}if(!av&&bj&&bg){ap.text(bg.realTotalCount==0?"":bg.realTotalCount);}}};var bb={createItemElement:function(bg){var bf;if(a3.spamType=="ALL"){bf=true;}else{if(a3.spamType=="USER"){bf=!!bg.userId;}}if(bg.id==az.id&&m){bg=m;}else{if(bg.id==a5.id&&a3.placeAddEnabled){return be.html();}}return'<div class="ucard'+(bg.selected?" __selected":"")+(bg.disabled?" __na":"")+'"><div class="ucard_img"><div class="ucard_img_a"><div class="stub-img__48 stub-place stub-place-'+(bg.category||"general")+'"></div></div></div><div class="ucard_info"><div class="ucard_info_name ellip">'+(bg.text?bg.text:"")+"</div>"+(bg.smallText?'<div class="ucard_add-info_i ellip">'+bg.smallText+"</div>":"")+(bg.smallText2?'<div class="ucard_add-info_i ellip">'+bg.smallText2+"</div>":"")+"</div>"+(bf?'<span class="ucard_ac ic12 ic12_i_warn" data-action="spam" title="'+aS+'"></span>':"")+"</div>";},setItemSelected:function(bg,bh,bf){bh.find(bg.id!=a5.id?".ucard":".js-AddPlaceItem").toggleClass("__selected",bf);}};ac=c(bd,a9,bb);C=a(aD,function(bg,bf){if(bf==C.INPUT_CHANGE_MIN){W(false);w=null;}else{if(bf==C.INPUT_CHANGE){W(true);w=null;}else{if(bf==C.INPUT_TIMER){ac.search();}}}L();},a3.minSearchQueryLength,a3.searchDelay);if(a3.place){e.preparePlaceForRenderer(a3.place);aK(a3.place,true);}}function k(a9){if(!a9&&!av){var a8=ac.getSearchEntry();if(!a8){if(!J){a9="NoBrowserCoords";}else{a9="LoadingError";}}else{if(a8.totalCount==0){var ba=a8.query;if(ba.pin){a9="NoPlacesPoint";}else{if(ba.length>0){a9="NoPlacesSearch";}else{a9="NoPlacesSearch";}}}else{if(a3.placeAddEnabled){if(!a8.hasMore){a9=s==p?"AddPlaceConfirm":"AddPlace";}else{if(s==p){a9="AddPlaceConfirmMessage";}}}}}}a1.find(".js-message").addClass("invisible");if(a9){a1.find(".js-"+a9).removeClass("invisible");i.success("mt.place","placeListMessage-"+a9,a3.postingFormType);}aa.toggleClass("__active",aa.find(".js-message:not(.invisible)").length>0);aZ.toggleClass("__active",aZ.find(".js-message:not(.invisible)").length>0);}function W(a8){j.toggleClass("search-input_searching",a8);a1.toggleClass("__process",a8);}function at(a9){if(m&&!P.hasClass("__active")&&!P.hasClass("__selected")){P.addClass("__selected");P.addClass("__nohide__");aT[0].scrollIntoView();aO(aW());return;}G();P.addClass("__active __search");P.removeClass("__selected");aD.focus();aH();Y=J;w=null;if(m){aD.val(m.name);ac.search();}else{aD.val("");}var a8=[];a8[m?m.id:az.id]=true;if(!a3.placeAddEnabled){a8[a5.id]=true;}ac.resetHiddenItemIds(a8);B();C.startSearchQueryCheck();ah(P,a1,aj);v.width("195");if(A){A.fitToViewport();}i.success("mt.place",(a9.target==aY[0]?"marker":"place")+(m?"Edit":"")+"Click",a3.postingFormType);aO(aW());}function t(a8){P.removeClass("__active __search __map");if(!P.hasClass("js-always-visible")){P.removeClass("__selected");}aO(aW());P.removeAttr("placeId");aD.val("");aJ();m=null;if(a8){i.success("mt.place","placeRemove",a3.postingFormType);}aq();}function l(){if(!P){return;}if(A){try{A.deactivate();}catch(a8){i.errorEx(a8,"mt.place","mapDestroy");}}A=X=m=null;aM();ac.destroy();C.destroy();ac=aR=P=aY=aT=a6=j=aD=a1=null;}function aM(){if(!P){return;}q();t();}function q(a8){aY.removeClass("__active");P.removeClass("__active __search __map");if(m){P.addClass("__selected");}aO(aW());C.endSearchQueryCheck();aD.val("");Y=J;w=null;ac.resetItems([],"");L();ah(aR,aR,aj);if(a8){i.success("mt.place","mapClose",a3.postingFormType);}}var O="PostingFormSpamLayer";function af(a9,a8){if(a8=="spam"){Q=true;a7=a9;D.html(y);D.show();aD.blur();d("#PostingFormPlaceSpamFormOk").on("click",F);d("#PostingFormPlaceSpamFormCancel,#PostingFormPlaceSpamFormClose,#popLayer_mo").on("click",u);OK.Layers.register(O,function(){u("cr_esc");},undefined,false);if(OK.Layers.onLayerShown){OK.Layers.onLayerShown();}ae();i.success("mt.place","showSpam",a3.postingFormType);}else{ax(a9);}}function F(){ac.setHiddenItemId(a7.id,true);h.ajax({type:"POST",url:"/dk?cmd=PopLayer",data:{"st.layer.cmd":"PopLayerRegisterSpam","st.layer.posted":"true",button_register:"true","st.layer.ids":a7.id,"st.layer.type":60}});u();}function u(a8){if(OK.Layers.onLayerHidden){OK.Layers.onLayerHidden();}D.html("");D.hide();if(a8!="cr_esc"){OK.Layers.remove(O);}aD.focus();a7=null;Q=false;}function ax(a8){if(a8.id==az.id){q();aK(m);}else{if(a8.id==a5.id){if(s==p){H();}else{ag();}}else{q();aK(a8);i.success("mt.place","placeSelect",a3.postingFormType);}}}function aK(a9,a8){m=a9;if(!a8){P.addClass("__selected");aO(aW());}a6.text(m.name);Y=[m.latitude,m.longitude];w=null;aq();}function x(){v.width("500");P.addClass("__map");if(A){A.fitToViewport();}}var aL;function ar(a8){if(P.hasClass("__map")){n(a8);w=Y=a8;if(++aL==2){C.setInputValue("");}if(s==Z){aU.removeClass("__active");i.success("mt.place","mapClickAddPlace",aL,a3.postingFormType);}else{i.success("mt.place","mapClick",aL,a3.postingFormType);}ac.search();}else{L();x();ay.addClass("__active");aL=0;i.success("mt.place","bigMap",a3.postingFormType);}}var aQ;function V(){if(s==Z){if(Date.now()>aQ+1500){aU.removeClass("__active");}}}function au(a8){v.width("195");P.removeClass("__map");ay.removeClass("__active");aU.removeClass("__active");r.removeClass("__active");if(A){A.fitToViewport();}if(s==Z){aJ();}else{if(w){A.panTo(w,{delay:0,flying:false});}}if(a8){i.success("mt.place","smallMap",a3.postingFormType);}}function aN(a8){if(Q){return;}if(!z){setTimeout(function(){q(a8);});}else{aD.focus();}}function L(a9){if(!s&&!a9){return;}if(s==a9){return;}var a8=s;s=a9;aU.toggleClass("__active",a9==Z);r.toggleClass("__active",a9==Z);if(a8==Z){au();}k();}function ag(){ac.resetSelection();var a8=ac.getSearchEntry();if(w&&a8&&a8.totalCount==0){aB();i.success("mt.place","placeAddNoConfirmPoint",a3.postingFormType);return;}x();if(w){n(w);A.panTo(w,{delay:0,flying:false});}else{aJ();if(Y){A.panTo(Y,{delay:0,flying:false});}}a2.toggleClass("__disabled",!w);L(Z);aQ=Date.now();aL=0;i.success("mt.place","placeAdd",a3.postingFormType);}function H(){aB();i.success("mt.place","placeAddConfirm",a3.postingFormType);}function ai(){L();i.success("mt.place","placeAddCancel",a3.postingFormType);}function an(){if(!w){return;}var a8=ac.getSearchEntry();if(a8){if(aL>0&&a8.totalCount>0){a1.scrollTop(0);L(p);i.success("mt.place","placeAddToConfirm",a3.postingFormType);}else{aB();i.success("mt.place","placeAddNoConfirm",a3.postingFormType);}}else{i.success("mt.place","addOkNoQueryError",a3.postingFormType);aB();}}var al,T,ao,aX,aC,o,E,ad,R,aV,N,aI,S,M,a4,aE,aP;function ae(){d("#modal_box").css("max-height",(d("#modal_cnt").height()+75)+"px");}function aB(){var a9="PostingFormPlaceAddPopLayer";var a8="placeAddDialog";h.ajax({type:"POST",url:"/dk?cmd=PopLayer",data:{"st.layer.cmd":a9,"st.layer.placeName":aD.val(),"st.layer.lat":w[0],"st.layer.lng":w[1],"st._aid":a8}}).done(function(bd,bf,be){Q=true;var ba=bd.split(OK.navigation.SPLITER),bc=be.getResponseHeader(OK.navigation.HEADER).split(",");for(var bb=0;bb<ba.length;bb++){OK.hookModel.setHookContent(bc[bb],ba[bb]);}al=d("#hook_Block_PopLayer");T=d("#PostingFormPlaceAddFormOk");ao=d("#PostingFormPlaceAddFormCancel");aX=d("#PostingFormPlaceAddCategory");aX.prop("selectedIndex",-1);aC=d("#PostingFormPlaceAddSubCategory");aX.on("change",ab);T.on("click",U);ao.on("click",aF);d("#nohook_modal_close,#popLayer_mo").on("click",aF);o=d("#PostingFormPlaceAddName");o.focus();E=d("#PostingFormPlaceAddCity");ad=d("#PostingFormPlaceAddStreet");R=d("#PostingFormPlaceAddHouse");aV=d("#PostingFormPlaceAddWebSite");N=d("#PostingFormPlaceAddOpeningHours");aI=d("#PostingFormPlaceAddPhone");S=d("#PostingFormPlaceAddDescription");a4=al.find('[class*="js-FieldContainer-"]');aE=al.find('[class*="js-FieldError-"]');M=d("#PostingFormPlaceAddFormShowMore").on("click",function(){M.remove();a4.show();ae();var bi=d("#modal_cnt");var bg=d("#modal_main");var bh=bi.height()-bg.innerHeight();if(bh>0){bg.scrollTop(bh);}});aP=OK.util.parseJSON(d("#hook_placeAddData_Data").html());});}function am(){L();OK.hookModel.setHookContent("PopLayer","");al=T=ao=aX=aC=o=E=ad=R=aV=N=aI=S=aP=null;Q=false;aD.focus();}function U(){if(!w){return;}var ba={lat:w[0],lng:w[1],name:d.trim(o.val()),category:d.trim(aC.val()),countryCode:aP.country,city:d.trim(E.val()),street:d.trim(ad.val()),houseNumber:d.trim(R.val()),website:d.trim(aV.val()),openingHours:d.trim(N.val()),phone:d.trim(aI.val()),description:d.trim(S.val())};var a9=d("#PostingFormPlaceAddSubCategory option:selected").text();if(aP.cityName==E.val()){ba.cityTownId=aP.cityId;}var a8={"gwt.requested":window.pageCtx.gwtHash};d.extend(a8,ba);h.ajax({type:"POST",url:"/dk?cmd=PostingFormPlaceAddValidate",data:a8,dataType:"json",timeout:3000}).done(function(bf,bc,bl){if(!bf){al.find(".js-FieldContainer-name").addClass("form_i__error");al.find(".js-FieldError-name").html(bc).show();return;}var bb=bf.valid;if(bb){function bm(){var bo="";for(var bp=0;bp<arguments.length;bp++){var bn=arguments[bp];if(bn){if(bo){bo+=", ";}bo+=g.encodeHtml(bn);}}return bo;}var bj=bm(ba.street,ba.houseNumber,ba.city,ba.countryCode);am();q();d.extend(ba,{id:"manual",text:ba.name,smallText:a9,smallText2:bj,latitude:ba.lat,longitude:ba.lng});e.preparePlaceForRenderer(ba);ax(ba);i.success("mt.place","placeAddSuccess",a3.postingFormType);}else{var bi=bf.errors;aE.hide();a4.removeClass("form_i__error");var bd="";for(var be=0;be<bi.length;be++){var bh=bi[be];var bk=bh.fieldName||"name";bd+=bk;var bg=bh.error;al.find(".js-FieldContainer-"+bk).addClass("form_i__error");al.find(".js-FieldError-"+bk).html(bg).show();}ae();i.success("mt.place","placeAddError",bd,a3.postingFormType);}}).fail(function(bb,bd,bc){al.find(".js-FieldContainer-name").addClass("form_i__error");al.find(".js-FieldError-name").text(bd+" "+bc).show();});i.success("mt.place","placeAddOk",a3.postingFormType);}function aF(){am();i.success("mt.place","placeAddCancel",a3.postingFormType);}function ab(){var bc=aP.categories[aX.val()];var a9="";if(bc&&bc.length){if(aC.attr("disabled")){aC.removeAttr("disabled");var a8=d("#PostingFormPlaceAddCategoryContainer");var bb=d("#PostingFormPlaceAddSubCategoryContainer");a8.removeClass("js-FieldContainer-category");bb.addClass("js-FieldContainer-category");var bd=a8.find(".js-FieldError-category").remove();bb.append(bd);}for(var ba=0;ba<bc.length;ba++){var be=bc[ba];a9+='<option value="'+be.category+'" >'+be.name+"</optoin>";}}aC.html(a9);aC.prop("selectedIndex",-1);}function ak(a8){if(!ac){return;}switch(a8.which){case 27:q(a8);break;case 13:var a9=ac.getSelectedItem();if(a9){ax(a9);}break;case 38:ac.selectPrevious();break;case 40:ac.selectNext();break;default:return;}a8.stopPropagation();a8.preventDefault();}function G(){if(!a3.mapEnabled){return null;}if(A){return A;}return aG();}function aG(){if(A){return A;}var a9=Y;if(m){a9=[m.latitude,m.longitude];}if(!a9){a9=K;}var a8=document.getElementById(I+"_PlaceMap");A=new f();A.setMapSourceURL(a3.OSMSourceURL);A.create(a8,a9);A.getMap().on("click",function(bb){var ba=bb.latlng;ar([ba.lat,ba.lng]);});A.getMap().on("moveend",V);if(m){aH(A);}}function n(a8){A.setMarker(a8);}function aJ(){if(X){try{A.removeMarker();}catch(a8){i.errorEx(a8,"mt.place","removeMapMark");}}X=false;}function aH(a8){if(!m){return;}if(!a8){a8=G();if(!a8){return;}}var a9=[m.latitude,m.longitude];n(a9,m.name);a8.panTo(a9,{delay:0,flying:false});}function B(){if(Y){ac.search();return;}var a8=function(){if(J||a3.location){ac.search();}else{if(!av){k();W(av);}}};if(aA){a8();return;}aA=true;if(!navigator.geolocation){i.success("mt.place","noBrowserGeolocation",a3.postingFormType);a8();return;}k("GetBrowserCoords");navigator.geolocation.getCurrentPosition(function(a9){J=Y=[a9.coords.latitude,a9.coords.longitude];if(!X&&A){A.panTo(J,{delay:0});}ac.search();i.success("mt.place","browserGeolocation",a3.postingFormType);},function(a9){a8();i.success("mt.place","browserGeolocationError",a9.code,a3.postingFormType);});}function ah(a9,be,ba){ba|=0;var bg=d(window);var bc=a9.offset().top-bg.scrollTop()-ba;var bd=be.offset().top+be.outerHeight(true)+5;var bf=bg.scrollTop()+bg.height()-bd;var bb=a9.offset().top-ba;if(bc<0){bg.scrollTop(bb);}else{if(bf<0){var a8=bd-bg.height();bg.scrollTop(Math.min(bb,a8));}}}var aO=function(){};function aW(){return P.hasClass("__active")||P.hasClass("__selected");}return{getPlace:function(){return m;},onPlaceVisible:function(a8){aO=a8;},hideSelectedIfNeeded:function(a8){if(P!=null&&!z&&P.hasClass("__selected")){if(P.hasClass("__nohide__")){P.removeClass("__nohide__");}else{P.removeClass("__selected");aO(aW());}}return false;},destroy:l,deactivate:aM,getEl:function(){return P?P[0]:null;}};};});define("OK/postingForm/xpost",["require","jquery","OK/suggest/suggestImpl","OK/suggest/searchEngines","OK/suggest/renderers","OK/suggest/inputChecker","OK/logger"],function(c){var e=c("jquery"),g=c("OK/suggest/suggestImpl"),d=c("OK/suggest/searchEngines"),a=c("OK/suggest/renderers"),f=c("OK/suggest/inputChecker"),b=c("OK/logger");return function(H,F){var n,j,x,B,z,R,v,G,C,m,p;var D;var N;var w;var y;var A=false;var r=a.MiniCard;var E=new r();var q;var i;var M;var k;L();function L(){n=e("#"+H+"_XpostMain");if(n.length==0){n=null;return;}M=n.attr("data-xpost-default")||"Status";k=n.attr("data-xpost-redesign");D=M;j=e("#"+H+"_XpostMenu");x=e("#"+H+"_XpostName");B=e("#"+H+"_XpostMenuItems");z=e("#"+H+"_XpostMenuItem"+M);R=e("#"+H+"_XpostGroup");v=e("#"+H+"_XpostGroupSuggest");G=e("#"+H+"_XpostGroupNameText");C=e("#"+H+"_XpostGroupNameInputContainer");m=e("#"+H+"_XpostGroupNameInput");p=e("#"+H+"_XpostGroupMessage");x.on("click",t);B.find("li").on("click",function(){O(this);}).on("mouseenter",function(){o(this);});G.on("click",u);m.on("keydown",P);m.on("focus",function(){v.addClass("__active");});m.on("blur",function(){if(y){m.focus();}else{l(false);}});v.on("mouseenter",function(){y=true;});v.on("mouseleave",function(){y=false;});B.on("mouseenter",function(){A=true;});B.on("mouseleave",function(){A=false;});e("html").on("click",K);var S={elementId:H+"_XpostGroupSuggest",suggestElId:H+"_XpostGroupSuggest",itemsElId:H+"_XpostGroupSuggestItems",disableLoadingProgress:true,getMaxItemsInSuggest:function(){return 0;},getMaxSelectedFriends:function(){return 0;},getSearchQuery:function(){return m.val();},onItemClicked:J,onLoadingChanged:s,onSearchProgressChanged:Q};q=g(d.groupsSearchEngine,S,E);i=f(m,function(U,T){if(T==i.INPUT_CHANGE_MIN){Q(false);}else{if(T==i.INPUT_CHANGE){Q(true);}else{if(T==i.INPUT_TIMER){q.search();}}}});if(k){R.show();l(!N);}}function K(){var S=j.hasClass("__active");if(S&&!A){j.removeClass("__active");event.stopPropagation();event.preventDefault();}}function t(U){var S=j.hasClass("__active");if(S){j.removeClass("__active");b.success("mt.xpost","hide");}else{j.addClass("__active");var V=D;if(V){var T=B.find('[data-item="'+V+'"]');if(T.length>0){o(T.get(0));}}b.success("mt.xpost","show");}U.stopPropagation();U.preventDefault();}function o(S){if(z){z.find(".suggest_a").removeClass("__selected");}z=e(S);z.find(".suggest_a").addClass("__selected");}function O(T){if(!j.hasClass("__active")){return;}o(T);var U=z.attr("data-item");var S=z.find("a div").text();D=U;x.text(S);b.success("mt.xpost","select."+U);if(U=="Group"){R.show();l(!N);}else{R.hide();i.endSearchQueryCheck();m.val("");}j.removeClass("__active");F();}function J(S){w=S;N=S.id;var T=S.name;G.text(T);l(false);y=false;b.success("mt.xpost","groupSelect");}function s(X,W,V,S,U){Q(X);if(X){var T=(V&&V.length)||0;b.success("mt.xpost","searhGroup",T);}if(!X&&W&&U){if(U.totalCount==0){v.addClass("__message");p.children().addClass("invisible");p.find(V.length==0?".NoGroups":".NoGroupsFound").removeClass("invisible");}else{v.removeClass("__message");}}}function Q(S){C.toggleClass("search-input_searching",S);}function u(){if(w){m.val(w.name);q.search();}l(true);b.success("mt.xpost","groupChange");}function l(T){if(T){R.addClass("__active");v.addClass("__active");i.startSearchQueryCheck();q.search();m.focus();}else{v.removeClass("__active");var S=D=="Group";if(!S||N){R.removeClass("__active");i.endSearchQueryCheck();}}}function P(S){if(!q){return;}if(S.which==27){l(false);b.success("mt.xpost","escape");}else{if(S.which==13){var T=q.getSelectedItem();if(T){J(T);}}else{if(S.which==38){q.selectPrevious();}else{if(S.which==40){q.selectNext();}else{return;}}}}S.preventDefault();OK.stop(S);}function h(){if(!n){return;}o(B.find('[data-item="'+M+'"]').get(0));D=M;var S=z.find("a div").text();x.text(S);R.removeClass("__active");v.removeClass("__active");N=null;G.text("");i.setInputValue("");i.endSearchQueryCheck();F();}function I(){if(!n){return;}e("html").off("click",K);mouseIn=false;K();q.destroy();n=j=x=B=z=R=v=G=C=m=p=q=null;}return{getXpostType:function(){return D;},getGroupId:function(){return N;},deactivate:h,destroy:I};};});define("OK/postingForm/canvasUrl",["OK/utils/dom"],function(a){return function(h){var d;var e;var j;var i;function k(){l(!f());}function l(n){if(n){d.classList.add("__active");d.classList.add("__search");if(i){i.focus();}}else{d.classList.remove("__active");d.classList.remove("__search");}}function f(){return d.classList.contains("__active");}function m(){var n=document.getElementById(h);j=a.byClass(n,"form-actions")[0];e=document.getElementById(h+"_CanvasMarker");i=document.getElementById(h+"_CanvasInput");e.addEventListener("click",k);j.addEventListener("click",c);i.addEventListener("blur",function(){setTimeout(function(){l(false);},200);});}function b(){a.removeAllListeners(e);a.removeAllListeners(i);j.removeEventListener("click",c);}function c(n){var o=n.target;if(o!==e){l(false);}}function g(){return i&&i.value;}d=document.getElementById(h+"_CanvasMain");if(d){m();return{deactivate:b,getUrl:g};}else{return null;}};});define("OK/postingForm",["jquery","OK/postingForm/mentions","OK/postingForm/places","OK/postingForm/xpost","OK/postingForm/canvasUrl"],function(d,c,b,e,a){return function(s,h,l,v,q,k){if(!d||!c||!b||!e){OK&&OK.logger&&OK.logger.error("mt.pf","init_r");return null;}var i=d;var r=i("#"+s);if(r.length==0){return null;}var z=i("#"+s+"-pfhead");var o=b(s,l),t=e(s,h),n=c("m_"+s),y=a(s);function m(B){var A="";if(OK&&OK.pf&&OK.pf.getBeforeUnloadMessage){A=OK.pf.getBeforeUnloadMessage(false);if(A==""){OK.pf.log("exit.system.empty");}else{OK.pf.log("exit.system.prompt");}}if(A!=""){B.returnValue=A;return A;}}function g(){i(window).unbind("beforeunload.pf").bind("beforeunload.pf",m);z.addClass("invisible");j();}function x(){p();i(window).unbind("beforeunload.pf");t&&t.destroy();o&&o.destroy();n&&n.destroy();t=o=n=y=null;}function f(){i(window).unbind("beforeunload.pf");z.removeClass("invisible");t&&t.deactivate();o&&o.deactivate();y&&y.deactivate();}var u;function w(A){require(["jquery.ui.sortable"],function(){var B=i("#"+A);if(B.length>0){if(!B.hasClass("ui-sortable")){u=B;u.sortable({handle:".posting-form_sctn__interac",cancel:".it_w, .itx",axis:"y",placeholder:"sortable-placeholder __posting-form",start:function(C,D){var E=D.item.attr("id");v(C,E);},stop:function(C,D){var E=D.item.attr("id");q(C,E);},update:function(C,D){var E=D.item.attr("id");k(C,E);}});}else{if(B.hasClass("ui-sortable-disabled")){u=B;u.sortable("enable");}}}});}function p(){require(["jquery.ui.sortable"],function(){if(u&&u.sortable){u.sortable("disable");u=null;}});}function j(){try{var A=document.getElementById("posting_form_text_field");if(A.tagName.toLowerCase()==="textarea"){var B=A.value;if(B&&B.length){A.selectionStart=A.selectionEnd=B.length;}}}catch(C){}}return{activateDnD:w,deactivateDnD:p,destroy:x,activate:g,deactivate:f,getPlace:function(){return o&&o.getPlace();},onPlaceVisible:function(A){if(o){o.onPlaceVisible(A);}},getXpostType:function(){return t&&t.getXpostType();},getXpostGroupId:function(){return t&&t.getGroupId();},handleClick:function(A){return o&&o.hideSelectedIfNeeded(A);},getCanvasUrl:function(){return y&&y.getUrl();},jQuery:d,mentions:n};};});define("OK/CommentWidgets",["OK/utils/dom"],function(d){var c={};var b=function(g,f){return f+"_"+g;},a=function(h,f){f=parseInt(f,10);if(isNaN(f)){return;}if(c[h]&&c[h]["count"]!==f){var g=c[h]["elements"];if(Array.isArray(g)){g.forEach(function(j){var i=d.firstByClass(j,"js-count");if(i){var k=d.parent(j,"widget");k.classList.toggle("__null",f<1);i.classList.toggle("__empty",f<1);var l=c[h]["maxCount"];if(l&&f>l){i.textContent=l+"+";}else{i.textContent=f;}}});}c[h]["count"]=f;}},e;return{setOpenDiscussionFn:function(f){e=f;},updateCount:function(j,h,i){i=parseInt(i,10);var g=b(j,h);if(c[g]){var f=c[g]["count"];if(f!==undefined&&!isNaN(f)){a(g,f+i);}}},setCount:function(f,i,h){h=parseInt(h,10);var g=b(f,i);a(g,h);},add:function(g,k,j){var i=b(g,k);var f=d.firstByClass(j,"js-count");if(j&&f){if(!c[i]){c[i]={maxCount:f.getAttribute("data-maxCount")||Infinity,elements:[]};}var l=f.textContent.replace(/\s/g,"");if(!isNaN(+l)){var h=parseInt(l,10);if(!isNaN(h)){c[i].elements&&c[i].elements.push(j);c[i].count=h;}}}},remove:function(f,l,i){var h=b(f,l),k=c[h];if(k&&i){var j=k.elements,g=j?j.indexOf(i):-1;if(g>-1){j.splice(g,1);j.length===0&&delete c[h];}}},clickHandler:function(h){h.preventDefault();if(e){var i=parseInt(this.getAttribute("data-id"),10),g=parseInt(this.getAttribute("data-type"),10),f=this.getAttribute("data-location");e(i,g,f);}},activate:function(g){if(g){var i=parseInt(g.getAttribute("data-id"),10),h=parseInt(g.getAttribute("data-type"),10),f=g.getAttribute("data-bind")!=="false";this.add(i,h,g);if(f){g.addEventListener("click",this.clickHandler);}}},deactivate:function(f){if(f){f.removeEventListener("click",this.clickHandler);this.remove(parseInt(f.getAttribute("data-id"),10),parseInt(f.getAttribute("data-type"),10),f);}}};});define("OK/scrollToTop",["OK/utils/dom","OK/utils/throttle"],function(d,k){var n="__bottom",e="__hidden",a="__active",h="__animated",l="__new",m="data-height",j="data-container",g="data-check-up",i="data-max-pause";function f(){this.button=null;this.container=null;}f.prototype.activate=function c(o){this.button=o;this.showBottom=this.button.hasAttribute(j);this.container=this.showBottom?document.getElementById(this.button.getAttribute(j)):window;if(!this.container){return;}this.scrollToTopHeight=parseInt(this.button.getAttribute(m)||0,10);this.scrollToBottomHeight=this.scrollToTopHeight;this.isBottom=this.button.classList.contains(n);this.link=d.firstByClass(this.button,"scroll-arrow_lk");this.newOnScrollUp=parseInt(this.button.getAttribute(g)||0,10);this.pauseToNew=parseInt(o.getAttribute(i)||0,10);this.onScrollSeenTimer=null;this.scrollStartTime=0;this.lastScrollTopPosition=0;this.boundClickHandler=this.onClick.bind(this);this.boundMouseEnterHandler=this.onMouseEnter.bind(this);this.boundMouseLeaveHandler=this.onMouseLeave.bind(this);this.boundScrollHandler=k(10,this.onScroll.bind(this));this.boundHide=this.hide.bind(this);this.boundHighlightNew=this.highlightNew.bind(this);this.button.addEventListener("click",this.boundClickHandler);this.button.addEventListener("mouseenter",this.boundMouseEnterHandler);this.button.addEventListener("mouseleave",this.boundMouseLeaveHandler);this.button.addEventListener("hideScrollElement",this.boundHide);this.container.addEventListener("scroll",this.boundScrollHandler);};f.prototype.deactivate=function b(){this.button.classList.remove(a,h);if(!this.container){return;}clearTimeout(this.onScrollSeenTimer);this.button.addEventListener("click",this.boundClickHandler);this.button.addEventListener("mouseenter",this.boundMouseEnterHandler);this.button.addEventListener("mouseleave",this.boundMouseLeaveHandler);this.button.addEventListener("hideScrollElement",this.boundHide);this.button=null;this.container.removeEventListener("scroll",this.boundScrollHandler);};f.prototype.getScrollTop=function(){return this.container===window?window.pageYOffset:this.container.scrollTop;};f.prototype.setScrollTop=function(o){if(this.container===window){window.scrollTo(0,o);}else{this.container.scrollTop=o;}};f.prototype.onMouseEnter=function(){if(this.isBottom&&this.getScrollTop()>=this.scrollToTopHeight){this.button.classList.remove(e);}};f.prototype.onMouseLeave=function(){if(this.isBottom){this.button.classList.add(e);}};f.prototype.highlightNew=function(){this.button.classList.add(l);};f.prototype.onScroll=function(){var p=this.getScrollTop();var o=Date.now();if(this.scrollStartTime&&this.newOnScrollUp&&this.scrollStartTime+this.newOnScrollUp<o){if(this.newOnScrollUp&&this.lastScrollTopPosition>p){this.highlightNew();}}else{if(!this.scrollStartTime&&this.newOnScrollUp){this.scrollStartTime=o;}}this.lastScrollTopPosition=p;if(this.onScrollSeenTimer){clearTimeout(this.onScrollSeenTimer);}if(this.pauseToNew){this.onScrollSeenTimer=setTimeout(this.boundHighlightNew,this.pauseToNew);}if(p>550){this.button.classList.remove(n,e);this.button.classList.add(a,h);this.isBottom=false;}else{if(p<500&&!this.isBottom){this.hide();}}};f.prototype.hide=function(){this.button.classList.remove(a);};f.prototype.onClick=function(o){if(this.isBottom){this.setScrollTop(this.scrollToBottomHeight);this.button.classList.remove(n);this.isBottom=false;}else{this.scrollToBottomHeight=this.getScrollTop();this.setScrollTop(this.scrollToTopHeight);if(this.showBottom){this.button.classList.add(n);this.isBottom=true;}}this.onScroll();if(this.button.classList.contains(l)&&this.link){this.link.click();}return OK.stop(o);};return f;});define("OK/mrg/projects",[],function(){var b="x-ph__menu_open",d="x-ph__menu_open_right",f="x-ph__menu_open_left",e,a;function c(){var g=this;this.toggleMenu=function(h){h.stopPropagation();clearTimeout(a);a=null;if(g.box.classList.contains(b)){g.hideMenu();}else{g.showMenu();}};this.hideMenu=function(){document.removeEventListener("click",g.hideMenu);g.box.classList.remove(b);g.box.classList.remove(d);g.box.classList.remove(f);};this.showMenu=function(){document.addEventListener("click",g.hideMenu);g.box.classList.add(b);if(document.documentElement.clientWidth<1200&&e.clientWidth>600){g.box.classList.add(d);}else{g.box.classList.add(f);}};this.onMouseOver=function(){clearTimeout(a);a=null;};this.onMouseOut=function(){clearTimeout(a);a=setTimeout(g.hideMenu,4000);};}c.prototype={activate:function(h){var g=this;this.link=h.querySelector(".portal-headline__menulink");this.menu=h.querySelector(".portal-headline__menu");this.box=h;e=document.getElementsByClassName("portal-headline__left")[0];if(this.link===null||this.menu===null||this.box===null){return;}this.link.addEventListener("click",g.toggleMenu,false);this.link.addEventListener("mouseout",g.onMouseOut,false);this.link.addEventListener("mouseover",g.onMouseOver,false);this.menu.addEventListener("mouseout",g.onMouseOut,false);this.menu.addEventListener("mouseover",g.onMouseOver,false);},deactivate:function(){var g=this;if(this.link){this.link.removeEventListener("click",g.toggleMenu,false);this.link.removeEventListener("mouseout",g.onMouseOut,false);this.link.removeEventListener("mouseover",g.onMouseOut,false);}if(this.menu){this.menu.removeEventListener("mouseout",g.onMouseOut,false);this.menu.removeEventListener("mouseover",g.onMouseOver,false);}this.link=this.menu=this.box=null;}};return c;});define("OK/mrg/Updater",["OK/utils/dom"],function(d){var a="x-ph__link_ext",b=document.head||document.getElementsByTagName("head")[0];function c(){this.counterStorage={};}c.prototype.createCounter=function(h,j){var k=Number(h.getAttribute("data-timeout"));var e=h.getAttribute("data-selector");var g=h.getAttribute("data-name");var f=h.getAttribute("data-url");if(f&&k>0){var i=d.byClass(h,e);if(this.counterStorage.hasOwnProperty(g)){this.counterStorage[g].counters=this.counterStorage[g].counters.concat(i);}else{this.counterStorage[g]={extract:j,counters:i,url:f,script:null,timer:null};window[g]=this.process.bind(this,g);}this.update(g);if(!this.counterStorage[g].timer){this.counterStorage[g].timer=setInterval(this.update.bind(this,g),k);}}};c.prototype.removeCounter=function(g){var f=g.getAttribute("data-name");var e=g.getAttribute("data-selector");var h=d.byClass(g,e);if(this.counterStorage.hasOwnProperty(f)){var i=this.counterStorage[f];h.forEach(function(j){var k=i.counters.indexOf(j);if(k!==-1){i.counters.splice(k,1);}});if(!i.counters.length){if(i.timer){clearInterval(i.timer);i.timer=null;}if(i.script){b.removeChild(i.script);i.script=null;}}}};c.prototype.update=function(f){var g=this.counterStorage[f];var e=document.createElement("script");e.type="text/javascript";e.src=g.url+"&JSONP_call="+f+"&rnd="+Math.random();if(g.script){b.removeChild(g.script);}b.appendChild(e);g.script=e;};c.prototype.process=function(e,h){var f=this.counterStorage[e].counters;var g=this.counterStorage[e].extract;f.slice().forEach(function(i){var j=g(h,i)||"";i.parentNode.classList.toggle(a,!!j);i.textContent=j;});};return new c();});define("OK/mrg/counters",["OK/mrg/Updater"],function(d){function b(g,e){var f=e.getAttribute("data-cnt");if(g&&g.status==="ok"&&g.data&&g.data[f]&&(g.data[f]>0||g.data[f]==="99+")){return g.data[f];}}function a(e){d.createCounter(e,b);}function c(e){d.removeCounter(e);}return{activate:a,deactivate:c};});define("OK/mrg/wamba",["OK/mrg/Updater"],function(d){function b(e){if(e&&e.counter){return e.counter;}}function a(e){d.createCounter(e,b);}function c(e){d.removeCounter(e);}return{activate:a,deactivate:c};});define("OK/HookModel",["OK/utils/utils"],function(a){var b={},c=a.deferred();return{init:function(d){c.resolve(d);},hookActivated:function(e){var d=b[e],g,f,h=new Promise(function(l,k){var j=OK.hookModel.getHookById(e);if(j){var i=j.getInstance?j.getInstance():undefined;l(i);return;}g=l;f=k;});if(g&&f){h.resolve=g;h.reject=f;if(!d||!d.length){d=[];b[e]=d;}d.push(h);}return h;},removeObserver:function(g,d){var f=b[d];if(f&&f.length){var e=f.indexOf(g);if(e!=-1){f.splice(e,1);}}},activatedCallback:function(e,d){var f=b[e];if(f){delete b[e];f.forEach(function(g){g.resolve(d);});}},extractHookId:function(d){return d.substring(d.lastIndexOf("_")+1);},createHook:function(e,d){c.promise.then(function(f){f.createHook(e,d);});}};});define("OK/ToolbarBubble",[],function(){var q={},b="notifications__hide",v="notifications__blink",o="notifications__reply",k="notifications__klass",w="notifications__emptySmall",t=[b,v,o,k,w],d=99,i=300,s=d+"+";function m(y,x){y.classList.add(x);}function p(y,x){y.classList.remove(x);}function a(y,x){return y.classList.contains(x);}function f(y){for(var x=0;x<t.length;x++){p(y,t[x]);}}function h(x){if(x>d){return s;}if(x<=0){return"";}return String(x);}function n(x,y,z){if(y){m(x,o);p(x,b);}if(z){m(x,k);p(x,b);}if(!y){p(x,o);}if(!z){p(x,k);}}function l(y){var x=document.getElementById(y);return x?new g(x):null;}function j(y){var x=q[y];if(!x){x=l(y);if(!x){return null;}q[y]=x;}return x;}function u(y){var x=q[y];if(x){delete q[y];}}function e(x){var y=x.getAttribute("id");if(y){j(y);}}function c(x){var y=x.getAttribute("id");if(y){u(y);}}function r(x){return x.classList.contains(k)||x.classList.contains(o)||x.classList.contains(w);}function g(x){this.bubbleElement=x;this.textElement=x.children[0]||x;this.val=(this.textElement.innerHTML&&parseInt(this.textElement.innerHTML,10))||0;}g.prototype={clearCustomClasses:function(){f(this.bubbleElement);},hide:function(){this.update(0);},decrease:function(x){this.update(this.val-x);},resetCustomIcon:function(){var x=this.bubbleElement;p(x,o);p(x,k);p(x,w);if(!this.val){m(x,b);}},update:function(B){B=(B<0)?0:B;this.val=B;var A=h(B),z=this.bubbleElement,x=this.textElement;if(!A){if(!r(z)){m(z,b);}x.innerHTML="";}else{var y=x.innerHTML;if(y!==A){x.innerHTML=A;if(!a(z,b)){m(z,v);setTimeout(function(){p(z,v);},i);}else{p(z,b);p(z,w);}}}},showSmall:function(){p(this.bubbleElement,b);m(this.bubbleElement,w);},resolveCustomIcon:function(x,y,z){n(this.bubbleElement,y,z);this.update(x);},getCount:function(){return this.val;},hasReply:function(){return a(this.bubbleElement,o);}};return{wrap:j,unwrap:u,create:l,activate:e,deactivate:c};});define("OK/ToolbarGrowl",["OK/logger","OK/utils/dom"],function(r,q){var d="CallApplication",p="appMain",b="__active",m="growl",e="click",a="data-id",g=(function(){var s,t,v=document.createElement("bootstrap"),u={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in u){if(u.hasOwnProperty(t)&&v.style[t]!==undefined){s=u[t];break;}}r.success(m,"transition",s);return s;}()),l=null,k={};function i(s){if(s){return parseInt(s.getAttribute("data-time"),10)||0;}return 0;}function f(){return OK.Layers&&OK.Layers.isAnyLayerOpened();}function n(){if(this.layerId=="messages"){var s=document.querySelector(".js-mheads");return s&&window.getComputedStyle(s).visibility=="visible";}return false;}function j(){return !(f()||document.getElementById(d)||OK.getCurrentDesktopModelId()===p||n.call(this));}function h(t){var s=document.createElement("div");s.innerHTML=t;return s.children.length?s.children[0]:null;}function c(s){return q.firstByClass(s,"growl_close");}function o(s){this.hookId=s;this.hidden=true;this.stash=null;}o.showAny=function(){var t,s;if(l){return;}for(t in k){if(k.hasOwnProperty(t)){s=k[t];if(s.hidden){s.show();if(!s.hidden){break;}}}}};o.hideAll=function(){if(l){l.hide();}};o.destroyByLayerId=function(s){var t=k[s];if(t){t.destroy();}};o.getByLayerId=function(s){return k[s];};o.prototype={activate:function(s){this.hook=this.getContentHook();this.layerId=s.getAttribute("data-layer");this.exclusive=s.getAttribute("data-exclusive")==="true";this.priority=parseInt(s.getAttribute("data-priority"),10)||0;k[this.layerId]=this;if(this.hook){this.elem=this.hook.element.firstChild;if(this.elem){this.activateGrowl();this.id=this.elem.getAttribute(a);this.time=i(this.elem);}}this.show();},activateGrowl:function(){var s=c(this.elem);if(s){s.addEventListener(e,this);}},deactivateGrowl:function(){var s=c(this.elem);if(s){s.removeEventListener(e,this);}},show:function(){if(this.id&&j.call(this)){if(l){if(this.priority<=l.priority){return;}else{r.success(m,"replace",this.layerId);l.hide();}}this.elem.classList.add(b);this.hidden=false;l=this;r.success(m,"show",this.layerId);}},hide:function(){if(this.elem){this.elem.classList.remove(b);this.hidden=true;if(this===l){l=null;}}},destroy:function(){if(this.elem){this.deactivateGrowl();this.hide();this.id=null;this.time=null;this.elem=null;}},setNewContent:function(u){var s=this,t=h(u),w,v;if(OK.Layers&&OK.Layers.isLayerOpened(s.layerId)){r.success(m,"ignore");}else{if(t){w=t.getAttribute(a);v=i(t);if(this.exclusive&&this.id&&this.id!==w){return;}if(s.id===w&&s.time===v){r.success(m,"equal",1);return;}if(s.hidden){this.setNewGrowl(u,w,v);}else{this.stash={html:u,id:w,time:v};this.elem.addEventListener(g,this,false);s.destroy();}}}},applyNewContent:function(){this.hidden=true;if(this.stash===null){OK.hookModel.setHookContent(this.getContentHookId(),"");}else{this.setNewGrowl(this.stash.html,this.stash.id,this.stash.time);r.success(m,"replace");this.stash=null;}},setNewGrowl:function(t,v,u){if(this.id===v&&this.time===u){r.success(m,"equal",2);return;}var s=this.getContentHook();OK.hookModel.setHookContent(s.id,t);this.elem=s.element.firstChild;this.id=v;this.time=u;this.activateGrowl();setTimeout(this.show.bind(this),30);},handleEvent:function(t){var s=t.type;if(s===e){if(this.time>this.crossTime){this.crossTime=this.time;}this.destroy();o.showAny();}else{if(s===g){if(t.propertyName==="opacity"){t.target.removeEventListener(g,this);this.applyNewContent();}}}},getContentHookId:function(){return this.hookId+"_Content";},getContentHook:function(){if(!this.hook){this.hook=OK.hookModel.getHookById(this.getContentHookId());}return this.hook;}};return o;});define("OK/banners/StickyBannerContainer",["OK/utils/throttle"],function(i){var h=document.documentElement.classList.contains("small-toolbar")?48:76;var b=h+12,j=12;var e={};var d;function f(l){this.hookEl=l;if(l&&l.hasChildNodes()){var k=l.getElementsByClassName("banner-sticky-container");this.bannerContainer=k.length>0?k[0]:l.firstElementChild;}this.currBannerContainerMinHeight=0;this.doReflow();}f.prototype.doReflow=function(){if(!this.bannerContainer){return;}var k=this.bannerContainer.clientHeight;if(this.currBannerContainerMinHeight!==k){this.hookEl.style.minHeight=k+"px";this.currBannerContainerMinHeight=k;}var m=this.hookEl.getBoundingClientRect();var n=m.top;if(n<=b){var o=document.getElementById("footer");var l=o.getBoundingClientRect();this.bannerContainer.style.position="fixed";if(k+b+j<l.top){this.bannerContainer.style.top=b+"px";this.bannerContainer.style.bottom="auto";}else{this.bannerContainer.style.top="auto";this.bannerContainer.style.bottom=document.documentElement.clientHeight-l.top+"px";}}else{this.bannerContainer.style.position="static";}};function c(k){if(!k||!k.id){return;}e[k.id]=new f(k);if(!d){d=i(10,g);window.addEventListener("scroll",d,false);window.addEventListener("resize",d,false);}}function g(){for(var l in e){if(!e.hasOwnProperty(l)){continue;}var k=e[l];k.doReflow();}}function a(k){if(!k||!k.id){return;}delete e[k.id];if(Object.keys(e).length===0){window.removeEventListener("scroll",d,false);window.removeEventListener("resize",d,false);d=null;}}return{activate:c,deactivate:a};});define("mrg-smokescreen/Utils",[],function(){var e=false;try{e=(new URL("http://example.com/")).href==="http://example.com/";}catch(c){}function h(j,i){return(Math.random()*(i-j+1)+j)|0;}var b;function d(){if(b===undefined){try{if(typeof window.getComputedStyle==="function"){var i=document.createElement("div");i.style.height="calc(30px + 30px)";document.getElementsByTagName("body")[0].appendChild(i);b=window.getComputedStyle(i,null).getPropertyValue("height")==="60px";i.parentNode.removeChild(i);}}catch(j){b=false;}}return b;}var a=function(i){return Array.prototype.slice.call(i);};var g=function(){var i=a(arguments);var j=i.shift();i.forEach(function(k){for(var l in k){j[l]=k[l];}});return j;};var f=function(){var i=a(arguments);var j=i.shift();i.forEach(function(k){for(var l in k){if(!j[l]){j[l]=k[l];}}});return j;};return{random:h,calcString:function(j,p){j=parseInt(j,10);if(d()){var n=[];var o=0;for(var m=0,k=h(1,6);m<k;m++){n.push(h(-100,100));o+=n[n.length-1];}if(o!==j){n.push(j-o);}return"calc("+n.map(function(i){return i.toString()+p;}).join(" + ")+")";}else{return j+p;}},replaceUrl:function(m,l,q){if(e&&l){var p=m.charAt(0);var k=(p==='"')||(p==="'");var n=0+k;var o;if(q){o=m.indexOf((k?p:"")+")");}else{o=k?m.indexOf(p,n+1):m.length;}var i=m.slice(n,o);try{i=(new URL(i,l)).href;}catch(j){}return m.slice(0,n)+i+m.slice(o);}else{return m;}},replaceContent:function(n){var q=n.charAt(0);var r=(q==='"')||(q==="'");var o=Number(r);var p=r?n.indexOf(q,o):n.indexOf(";",o);var m=n.slice(o,p);var l="";if(/^\\[a-z0-9]+$/.test(m)||!r){l=m;}else{for(var k=0;k<m.length;k++){var j=m[k].charCodeAt(0);if(isNaN(j)){continue;}l+="\\"+j.toString(16);}}return n.slice(0,o)+l+n.slice(p);},iterate:function(i,l,j){for(var k in i){if(Object.prototype.hasOwnProperty.call(i,k)&&k!=="length"){l.call(j||this,i[k],k);}}},extend:g,merge:f,toArray:a,isUrlConstructorExists:function(){return e;}};});define("mrg-smokescreen/StyleSheets.Item",["mrg-smokescreen/Utils"],function(b){function f(h){var i=document.createElement("style");i.appendChild(document.createTextNode(""));h=h||{};h.rel="stylesheet";h.type="text/css";h.media=h.media||"screen";b.iterate(h,function(k,j){if(k){i.setAttribute(j,k);}});return i;}function a(h){if(h){this.__rules.push(h);}}function d(h,i){this.__style=f(h);this.__style.__created=true;this.__rules=[];this.__originalNode=i;}function e(j,k,i){var h=k.getAttribute(j);if(h){i.setAttribute(j,h);}}function c(){if(this.__rules.length){this.__style.appendChild(document.createTextNode(this.__rules.join("\n")));}}function g(){var k=document.styleSheets;for(var h=k.length;h>0;h--){var j=k[h-1];if(j&&j.ownerNode&&j.ownerNode.parentNode){return j.ownerNode.parentNode;}}}d.prototype={constructor:d,insert:function(){a.apply(this,arguments);},insertBlock:function(i,h){a.apply(this,[i+"{"+h+"}"]);},setContent:function(h){this.__style.appendChild(document.createTextNode(h));},apply:function(){if(this.__originalNode&&this.__originalNode.parentNode){e("id",this.__originalNode,this.__style);this.__originalNode.parentNode.replaceChild(this.__style,this.__originalNode);}else{(g()||document.head).appendChild(this.__style);}c.apply(this);},getSheet:function(){return this.__style.sheet;}};return d;});define("mrg-smokescreen/StyleSheets.NativeParser",["mrg-smokescreen/Utils"],function(g){function e(j){try{return j.cssRules||j.rules;}catch(k){return null;}}function i(l,k){var j=true;return l.split("url(").map(function(m){if(j){j=false;return m;}return g.replaceUrl(m,k,true);}).join("url(");}var f=/content\s*:\s*/;function d(k){var j=true;return k.split(f).map(function(l){if(j){j=false;return l;}return g.replaceContent(l);}).join("content:");}function h(j){return j.replace(/-([a-z])/g,function(k){return k[1].toUpperCase();});}var b=/^(-?\d+)([a-z%]+)$/;var c=/\s(?![*+\-/]|[^()]+\)+|\(+)/;function a(u,t,s,w){var l="";var m=t(u.selectorText);for(var p=0;p<u.style.length;p++){var j=(u.style.getPropertyPriority(u.style[p])==="important")?" !important":"";var k=u.style[p];if(/background-(repeat|position)-[xy]/.test(k)){k=k.replace(/-[xy]$/,"");}var v=u.style[k]||u.style[h(k)];if(v===undefined||!v.length){k=k.replace(/-(value|(ltr|rtl)-source)$/g,"");v=u.style[k]||u.style[h(k)];}if(v===undefined&&k==="float"){v=u.style.cssFloat;}if(v!==undefined&&v.length){if(w.randomize&&w.randomize.length&&w.randomize.indexOf(k)>-1&&m!=u.selectorText){var o=v.split(c),n=o.length,r=[];while(n--){var q=b.exec(o[n]);r.unshift(q?g.calcString(q[1],q[2]):o[n]);}v=r.join(" ");}l+=k+": "+v+j+"; ";}}if(l.indexOf("url(")!==-1){l=i(l,s);}if(l.indexOf("content")!==-1){l=d(l,s);}return m+" { "+l+" }";}return{iterate:function(k,l,m,n,j){j=j||{};g.iterate(e(k),function(p){switch(p.type){case 1:n(a(p,l,m,j));break;case 4:var o=[];g.iterate(p.cssRules||p.rules,function(q){o.push(a(q,l,m,j));});n("@media "+p.media.mediaText+" { "+o.join(" ")+" }");break;default:n(p.cssText);break;}});}};});define("mrg-nano-xhr",[],function(){var b=new Function;var a=function(){var e={readyState:4,status:-1};e.open=e.send=b;try{e=new window.XMLHttpRequest();}catch(d){try{e=new window.ActiveXObject("Msxml2.XMLHTTP");}catch(d){try{e=new window.ActiveXObject("Microsoft.XMLHTTP");}catch(d){}}}return e;};var c={version:"0.0.15",request:function(h,p){var e=h,d="GET",m=null,o=false,k=false,l=a(),n=null,f=new Date,j={error:n,xhr:l};if(typeof h==="object"){e=h.url;d=h.method||d;m=h.body||m;o=h.sync||o;k=h.credentials||k;}l.withCredentials=k;l.url=e;var g=function(){if(!n&&l.readyState!==4){return;}g=b;j.error=n;l.duration=new Date-f;l.onerror=l.onreadystatechange=null;typeof p==="function"&&p(n,l);};try{l.onreadystatechange=g;l.onerror=function(q){n=q;g();};l.open(d,e,!o);l.send(m);}catch(i){n=i;g();}return j;}};return c;});define("mrg-smokescreen/StyleSheets",["mrg-smokescreen/StyleSheets.Item","mrg-smokescreen/StyleSheets.NativeParser","mrg-smokescreen/Utils","mrg-nano-xhr"],function(h,k,f,m){var b=/(^(https?:)?\/\/[^/]+|\?timestamp=\d+$)/g;function c(n){return n.replace(b,"");}function g(p,n){var o=p(n);return(o!==n?o+",":"")+n;}function l(o){var n=[];f.iterate(o,function(q,p){n.push(p+":"+q+";");});return"{"+n.join("\n")+"}";}function j(n){var p=m.request({url:n.href,sync:true});if(p.error){var o="[CSS LOADING ERROR] Cant load "+n.href;if(window.ajs&&window.ajs.log){window.ajs.log(o);}p.error.description=o;p.error.sheet=n;throw p.error;}return p.xhr.responseText;}function e(n,q){var o=n.map(function(r){return c(r);});function p(){f.iterate(document.styleSheets,function(s){if(s.ownerNode.tagName==="LINK"){var r=d(s).replace(b,"");o=o.filter(function(t){return r!==t;});}});if(o.length){setTimeout(p,100);}else{q();}}p();}function d(o){var n;if(o.ownerNode){n=o.ownerNode.href||o.ownerNode.getAttribute("x-href");n=c(n||"");}return n;}var i={};function a(n,p,o){if(Object.keys(i).length===n.length){p();}n.forEach(function(q){m.request({url:q,sync:false},function(r,s){if(r){o(r);}if(s.readyState!==4){return;}i[c(q)]=s.responseText;if(Object.keys(i).length===n.length){p();}});});}return{update:function(n,p,o){return new Promise(function(r,q){e(n,function(){var s=[].map.call(document.styleSheets,function(t){return t;});a(n,function(){s.forEach(function(w){if(!w.ownerNode||w.ownerNode.__created||w.__updated||w.ownerNode.tagName!=="LINK"){return;}var v=w;w.__updated=true;var u=d(w);if(u){try{var y=i[u];if(y){var z=new h({"x-href":u,media:w.media.mediaText},w.ownerNode);z.setContent(y);z.apply();v=z.getSheet();v.__updated=true;var t=new h({"x-href":u,media:w.media&&w.media.mediaText},v.ownerNode);t.__updated=true;k.iterate(v,g.bind(null,p),u,function(A){t.insert(A.toString());},o);t.apply();}}catch(x){q(x);}}});r();},function(t){q(t);});});});},remove:function(n){n=(n||[]).map(function(r){return(r||"").replace(/^https:/,"");});if(n.length){var q=[];f.iterate(document.styleSheets,function(s){var r=d(s);if(r&&n.indexOf(r)!==-1){q.push(s);}});for(var p=q.length-1;p>=0;p--){var o=q[p];o.ownerNode.parentNode.removeChild(o.ownerNode);}}},insert:function(o,q){var p=new h({});var n=g.bind(null,q);var s=function(t,u){return n(t)+l(u);};var r=function(w,u){if(/@(media|supports|document|page|keyframes|font-feature-values)/.test(u)){var t=[];var v=function(y,x){t.push(s(x,y));};f.iterate(w,v);p.insertBlock(u,t.join(""));}else{p.insert(s(u,w));}};f.iterate(o,r);p.apply();}};});define("mrg-smokescreen/Cid",[],function(){function d(j){var i=j.length,h,g;while(0!==i){g=Math.floor(Math.random()*i);i-=1;h=j[i];j[i]=j[g];j[g]=h;}return j;}var b=1000;var f=(function(h){for(var g=0;g<10;g++){h.push(g.toString());}for(var g=0;g<25;g++){h.push(String.fromCharCode(97+g));h.push(String.fromCharCode(65+g));}return d(h);})([]);var c=f.length;function a(g){return(g>=c?a((g/c>>0)-1):"")+f[g%c>>0];}var e=(function(){var g=[];for(var h=0;g.length<5&&h<f.length;h++){if(g.length>0||!/[0-9]/.test(f[h])){g.push(f[h]);}}return g.join("");})();return function(){return e+a(b++);};});define("mrg-smokescreen/Welter",["mrg-smokescreen/Cid","mrg-smokescreen/Utils"],function(f,d){var e=0;var c={};function b(){var g=f(true);c[g]=true;return g;}function a(j,l){var i=document.createDocumentFragment();for(var h=0,g=d.random(j/2,j);h<g;h++){var m=document.createElement("div");e++;if(d.random(0,l)){m.appendChild(a(j,l-1));}var k=0;if(!(d.random(0,j)%2)){m.id=b();k++;}if(!(d.random(0,j)%5)){m.setAttribute("data-bem",b());k++;}if(!(d.random(0,j)%6)){m.setAttribute("data-mnemo",b());k++;}if(!(d.random(0,j)%3)||!k){m.className=b();}i.appendChild(m);}return i;}return{isWelter:function(g){return c[g]!==undefined;},wrap:function(j,g){function i(k){k&&d.toArray(k.querySelectorAll(g)).forEach(function(n){if(n.classList.contains("js-welter-no-wrap")){return;}var l=a(5,5);var m=l.querySelectorAll("div");var o=m[d.random(0,m.length-1)];if(n&&o){n.originalParentNode=n.parentNode;n.parentNode.insertBefore(l,n);o.appendChild(n);}});}try{if(j.nodeType){i(j);}else{if(j.length>=0){if(j.length===1){i(j[0]);}else{d.toArray(j).forEach(i);}}else{console.warn('[Walter.wrap] this "context" not supported:',j);}}}catch(h){console.error(h);}}};});define("mrg-smokescreen/Locator",["mrg-smokescreen/StyleSheets","mrg-smokescreen/Welter","mrg-smokescreen/Utils","mrg-smokescreen/Cid"],function(A,c,f,p){var i=p();var e=0;var q={names:{},reverse:{},wraps:{}};var j={};var r=false;var n=[];var l;var w=/([@#:.]*)([\w$-]+)/gi;var d=[];var x={};var h=(function(){var D=["top","right","bottom","left"];var C=["margin","padding"];var B=["height","width","max-width","max-height","min-height","min-width"];C.forEach(function(E){D.forEach(function(F){B.push(E+"-"+F);});});return B.concat(D,C);})();function o(B){k(B);}function a(B){if(r&&B){return A.update(B,s,x);}}function u(B){if(B){d.push(B);}d.forEach(function(C){A.insert(C,s);});d=[];}function k(B,C){B=f.extend({},x,B||{});x=B;if(!!B.enable){r=true;}if(r){if(B.match&&B.match instanceof Array&&B.match.length>0){n=n.concat(B.match);l=new RegExp("^("+n.join("|")+")");}}if(B.randomize){B.randomize=B.randomize===true?h:B.randomize;}if(B.sheet){u(B.sheet);}}function g(B,C){return(C?C+"@@@":"")+B;}function t(D,E){var C=g(D,E);var B=q.names[C];if(!B&&(r&&l&&l.test(E||D))){B=p();q.names[C]=B;q.reverse[B]=D;}return B||D;}function z(C,D){var B=v(C);if(D){return t(B.elem,D)+(B.mod?"_"+t(B.mod,D):"");}else{return t(B.elem)+(B.mod?"_"+t(B.mod,B.elem):"");}}function v(D){var C=(D?""+D:"").match(/^(.*?[^_])(_([^_]+))?$/);var B;if(C){D=C[1];B=C[3];}return{elem:D,mod:B};}function s(B){return B.replace(w,function(E,D,C){if(!D||/:/.test(D)){return E;}return D+z(C);});}function m(C,D){var B=v(C);if(D){return(q.names[g(B.elem,D)]||B.elem)+(B.mod?"_"+(q.names[g(B.mod,D)]||B.mod):"");}else{return(q.names[B.elem]||B.elem)+(B.mod?"_"+(q.names[g(B.mod,B.elem)]||B.mod):"");}}function b(B,D,C){return(B||"").toString().split(/\s+/).map(function(E){return D(E,C);}).join(" ");}function y(C){var B=v(C);return(q.reverse[B.elem]||B.elem)+(B.mod?"_"+(q.reverse[B.mod]||B.mod):"");}o.prototype={constructor:o,setup:k,selector:function(C,B){var D=s(C);if(B||C==D){return D;}else{return D+", "+C;}},transform:function(B,C){return b(B,z,C);},lookup:function(B,C){return b(B,m,C);},updateSheets:a,removeSheets:function(B){if(r&&B){A.remove(B);}},insertSheet:u,reverse:function(B){return b(B,y);},isWelter:function(B){return c.isWelter(B);},wrap:function(D,B){if(r){var B=B||document;var E;if(B[i]){E=B[i];}else{E=++e;B[i]=E;}var C=j[E];if(C==null){C={};}D.forEach(function(G){if(!C[G]){var F=s(G);C[G]=F;j[E]=C;c.wrap(B,F);}});}},calcString:function(B,C){return r?f.calcString(B,C):B+C;},removeCache:function(B){delete j[B[i]];delete B[i];},isEnabled:function(){return r;}};return o;});define("OK/Smokescreen",["mrg-smokescreen/Locator"],function(b){var a=null;return{getLocator:function(c){if(a){return a;}a=new b({enable:true,randomize:c?c:false,match:[".*"]});return a;},getById:function(d){var c=document.getElementById(d);if(!c&&a){c=document.getElementById(a.transform(d));}return c?c:null;}};});define("mrg-smokescreen/Honeypot",["OK/logger"],function(d){function a(n){var l=/^([a-z][a-z0-9]*)/g;var j=/^\.([A-z0-9\-\_]+)/g;var m=/^#([A-z0-9\-\_]+)/g;var o=/^@([A-z0-9\-\_]+)="((?:[^"\\]|\\.)*)"/g;var k=/^\*(\d+)/g;var p=new RegExp('"',"g");var i=/\s+/;return n.map(function(v){var u=v.split(i);var q=(v.match(p)||[]).length;if(q>0&&q%2===0){var t=null;for(var r=0;r<u.length;r++){if(t===null){var s=(u[r].match(p)||[]).length;if(s&&s%2){t=r;}}else{u[t]+=" "+u[r];if(u[r].indexOf('"')!==-1){t=null;}u[r]=undefined;}}}return u.filter(function(w){return w;}).map(function(x){if(x){var w,y={multi:1};do{l.lastIndex=0;j.lastIndex=0;m.lastIndex=0;o.lastIndex=0;k.lastIndex=0;if(w=l.exec(x)){x=x.substr(l.lastIndex);y.tag=w[1];}else{if(w=j.exec(x)){x=x.substr(j.lastIndex);y.classes=y.classes||[];y.classes.push(w[1]);}else{if(w=m.exec(x)){x=x.substr(m.lastIndex);y.id=w[1];}else{if(w=o.exec(x)){x=x.substr(o.lastIndex);y.attrs=y.attrs||{};y.attrs[w[1]]=w[2].replace(/\\/g,"");}else{if(w=k.exec(x)){x=x.substr(k.lastIndex);y.multi=parseInt(w[1]);}}}}}}while(w&&x.length);if(x.length){throw new Error('Unparsed template: "'+x+'"');}return y;}});});}function f(j){var l=[],o=[];var n;while(n=j.pop()){var m=document.createElement(n.tag||"div");if(!n.attrs){n.attrs={};}if(n.id){n.attrs.id=n.id;}if(n.classes){n.attrs["class"]=n.classes.join(" ");}for(var k in n.attrs){if(n.attrs.hasOwnProperty(k)&&k!=="length"){m.setAttribute(k,n.attrs[k]);}}o.forEach(function(i){m.appendChild(i);});o=[];l.push(m);o.push(m);for(var k=1;k<n.multi;k++){var p=m.cloneNode(true);l.push(p);o.push(p);}}return{baits:l,nodes:o};}function e(i){return{available:typeof window.getComputedStyle==="function",styles:(i||[]).map(function(j){var k=j.split(/\s*:\s*/);return{field:k[0],value:k[1]};})};}function c(i){return i.offsetParent===null;}function g(j,i){if(i.available){i.styles.forEach(function(k){j.style[k.field]=k.value;});}}function h(k,j){var i;if(j.available){var l=window.getComputedStyle(k,null);j.styles.forEach(function(m){if(!i){i=l[m.field]!==m.value&&l[m.field]!=="auto";}});}return i;}function b(i){if((i||"").length){try{var j=new RegExp(i);return Object.keys(window).filter(function(l){return l.match(j);}).length>0;}catch(k){}}}return{version:"1.3.0",check:function(m,t,q){var l=document.getElementsByTagName("body")[0];if(l){try{var s=a(m);var u=e(t);if(b(q)){return true;}var p=[];var r=[];for(var k=0;k<s.length;k++){if(s[k]&&s[k].length){var j=f(s[k]);if(j.nodes&&j.baits&&j.baits.length){var o=document.createElement("div");o.style.position="absolute";o.style.visibility="hidden";j.nodes.forEach(function(i){o.appendChild(i);});l.appendChild(o);j.baits.forEach(function(i){g(i,u);});p=p.concat(j.baits);r.push(o);}}}return new Promise(function(i){window.setTimeout(function(){var v=false;p.forEach(function(w){if(c(w)||h(w,u)){v=true;}});r.forEach(function(w){l.removeChild(w);});i(v===true);},100);});}catch(n){d.success("nb_error","honeypot",n);}return false;}}};});define("OK/banners/blockDetect/honeypotBlockDetect",["mrg-smokescreen/Honeypot"],function(a){function b(d){var f=d.honeypotEnabled||false;if(!f){return Promise.resolve(false);}var g=d.honeypotRules||[".dialogWrapperBanner"];var e=d.honeypotCssRules||["position: relative"];var c=d.honeypotJsConfig||null;return a.check(g,e,c);}return b;});define("OK/banners/blockDetect/networkBlockDetect",[],function(){var b,c;function a(){return new Promise(function(e){function d(){e(true);}window.mailruEnabled=function(){e(false);};b=document.createElement("script");b.type="text/javascript";b.src="//ad.mail.ru/adq/?callback=mailruEnabled&"+Date.now();b.onerror=d;document.head.appendChild(b);c=setTimeout(d,4000);}).then(function(d){document.head.removeChild(b);window.mailruEnabled=null;b=null;clearTimeout(c);return d;});}return a;});define("OK/banners/blockDetect/blockDetect",["OK/logger","OK/cookie","OK/banners/blockDetect/honeypotBlockDetect","OK/banners/blockDetect/networkBlockDetect"],function(c,d,e,a){function f(g){c.success("nb_success","detect",g);}function b(g){if(document.documentElement.classList.contains("ie")){return Promise.resolve(false);}return Promise.all([a(g),e(g)]).then(function(h){var j=h[0],k=h[1],i=k||j;if(k&&j){f("all");}else{if(j){f("network");}if(k){f("honeypot");}}if(i){d.setCookie("nbp","1",15,"/");}else{d.clearCookie("nbp","/");}return i;}).then(null,function(h){c.success("nb_error","detect","catch");return false;});}return b;});define("OK/banners/moneySave",["OK/utils/dom","OK/logger","OK/utils/vanilla","OK/banners/StickyBannerContainer","OK/Smokescreen","mrg-smokescreen/Welter","mrg-smokescreen/Utils","OK/banners/blockDetect/blockDetect"],function(C,I,V,av,p,ak,S,ai){var t="nb_success";var P="nb_error";var i="hook_ViewportHeightAwareBanner_ViewportHeightAwareBannerInner",g="LeftColumnBannerInner";var v="wss://ad.mail.ru/mimic/v1/ws";var aF=true;var B=true;var aq=true;var K=true;var Q=false;var an=false;var au=false;var aj=false;var b=false;var T={topRight:"",message:"",discussion:"",bottomLeft:""};var af={topRight:"",message:"",discussion:"",bottomLeft:""};var k={topRight:3,message:3,discussion:3,bottomLeft:5};var G="";var ac=false;var ao={topRight:-1,message:-1,discussion:-1,bottomLeft:-1};var F="";var az;var ax="";var ar="";var l=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;var ap=C.byClass;var x=C.firstByClass;var R;var W;var a={topRight:[],message:[],discussion:[],bottomLeft:[]};var f;var e=new Promise(function(aJ){f=aJ;});var aH;var aI=new Promise(function(aJ){aH=aJ;});function N(aL,aK){var aJ=aL.getAttribute("style")||"";aL.setAttribute("style",aJ.indexOf(aK)!==-1?aJ:aJ+aK);}function aC(aJ){aJ.setAttribute("style","display: none !important");}function U(aJ){this.bannerPlace=aJ;this.stylesheetEl=null;this.styleData=[];this.updateStylesheet=function(aK){if(!this.stylesheetEl){return;}var aM=this.stylesheetEl.sheet;if(!aM){return;}for(var aL=aM.cssRules.length-1;aL>=0;aL--){aM.deleteRule(0);}var aO="";for(aL=0;aL<this.styleData.length;aL++){var aN="b-img-"+this.bannerPlace+aL;aO="."+aK.transform(aN)+" {width: "+this.styleData[aL].width+"px; height: "+this.styleData[aL].height+"px; background: url('"+this.styleData[aL].imgSrc+"') no-repeat;} ";aM.insertRule(aO,aL);}this.styleData=[];};this.registerImageStyle=function(aM,aL,aN){var aK=this.styleData.length;this.styleData.push({width:aM,height:aL,imgSrc:aN});return aK;};this.createStyleEl=function(){var aK=document.createElement("style");this.stylesheetEl=document.head.appendChild(aK);};}var J={bottomLeft:new U("bottomLeft"),topRight:new U("topRight")};function Z(aK){var aM=aK.children;aK.removeAttribute("style");var aJ=aM.length;for(var aL=0;aL<aJ;aL++){var aN=aM[aL];if(aN.classList.contains("delete-stub")){continue;}if(aN.tagName==="DIV"){Z(aN);}}}var aA;aA=function(){return e.then(function(){if(b){W=p.getLocator(["width"]);}else{W=p.getLocator();}if(aj){J.bottomLeft.createStyleEl();}if(aF){J.topRight.createStyleEl();}var aJ=W.updateSheets(R);aA=function(){return aJ;};return aJ;});};function A(aL,aM){var aJ=aL+"Smokescreen";try{aA().then(aM)["catch"](function(aN){I.success(P,aJ,aN);});}catch(aK){I.success(P,aJ,aK);}}function M(aK,aJ,aL,aM){if(aj&&aL==="bottomLeft"){A(aL,function(){var aO=document.getElementById("leftColumn");if(!aO){return;}var aN=document.getElementById("hook_Block_StickyBannerContainer");if(aN){ae();at(aN,["#hook_Block_CompactFooter"]);W.wrap(["#hook_Block_StickyBannerContainer"],aO);ak.wrap(aO,'#leftColumn > [id^="hook_Block"]');var aP=aa("stickyBannerHook");if(aP){aP.applySmokescreen(W);}}else{at(aK,["#hook_Block_CompactFooter"],true);}J.bottomLeft.updateStylesheet(W);aM();ad(aK,aL);});}else{if(aL==="topRight"&&Q){A(aL,function(){var aN=document.getElementById("fourthColumnWrapper");if(!aN){return;}var aO=document.getElementById("hook_Block_FrOln4thCol");if(aO){var aP=aO.id;s(aP,[".gifts-widget-w",".fr-motivator-portlet"]);W.wrap(["#"+aP],aN);ak.wrap(aN,'[id^="hook_"]');}else{aO=p.getById("hook_Block_FrOln4thCol");at(aO,[".gifts-widget-w",".fr-motivator-portlet"]);}J.topRight.updateStylesheet(W);aM();ad(aO,aL);});}else{aM();}}}function ad(aK,aL){var aJ=aK.parentNode;if(!aJ){return;}var aM=aK.cloneNode(true);ab(aM,aL);aJ.replaceChild(aM,aK);return aM;}function ab(aL,aQ){var aO=a[aQ];var aN=aL.getElementsByClassName(W.transform("b-js__href"));for(var aK=0;aK<aN.length;aK++){var aJ=aN[aK].getAttribute("data-nbh");if(aJ!=null){try{var aM=aO[parseInt(aJ,10)];if(aM){aN[aK].addEventListener("click",u.bind(aN[aK],aM,aQ));}}catch(aP){I.success(P,aQ+"Smokescreen",aP);}}aN[aK].removeAttribute("data-nbh");}q(aQ);}function ae(){var aK=document.getElementById("mainContent");var aJ=document.getElementById("hook_Block_StickyBannerContainer");if(aK&&aJ){if(aK.classList.contains("narrow-feed")){aJ.classList.add("narrow-feed");}if(aK.classList.contains("wide-profile")){aJ.classList.add("wide-profile");}if(aK.classList.contains("mainContentDoubleColumn")){aJ.classList.add("mainContentDoubleColumn");}}}function s(aL,aK){var aJ=document.getElementById(aL);if(aJ){at(aJ,aK);}}function at(aK,aP,aO){if(aP){for(var aN=0;aN<aP.length;++aN){if(aK.matches(aP[aN])){return;}}}if(!aO){j(aK);}var aM=aK.children;var aJ=aM.length;for(var aL=0;aL<aJ;aL++){at(aM[aL],aP);}}function j(aJ){if(aJ.id){aJ.id=W.transform(aJ.id);}if(aJ.className){aJ.className=W.transform(aJ.className);}else{aJ.removeAttribute("class");}aJ.removeAttribute("data-name");aJ.removeAttribute("data-params");if(aJ.hasAttribute("jsplace")){aJ.removeAttribute("jsplace");aJ.removeAttribute("style");}if(aJ.getAttribute("style")===""){aJ.removeAttribute("style");}}function r(aJ,aL){var aK=x(aJ,aL);if(aK){return aK;}else{if(W){return x(aJ,W.transform(aL));}else{return null;}}}function aa(aL){var aK=r(document,aL);var aJ=aK?aK.nativeHookImpl:null;return aJ;}function z(aK){if(!aK){return;}var aJ=x(aK,"js-banner-wrapper");if(aJ){var aL=x(aK,"feed_close");if(aL){aL.addEventListener("click",function(){Z(aK);});}}}function aG(){var aL=x(document,"feed-list");if(aL){var aK=aL.children;var aJ=aK.length;for(var aO=0;aO<aJ;aO++){z(aK[aO]);}if(l){var aN={attributes:false,childList:true,characterData:false},aM=new l(function(aP){aP.forEach(function(aQ){var aR=aQ.addedNodes[0];if(aR){var aS=x(aR,"feed");z(aS);}});});aM.observe(aL,aN);}}}var aD,y;function L(){if(!aD){aD=new Promise(function(aJ){y=aJ;});}return aD;}function aB(aJ){var aL=document.getElementById("hook_Block_MainContent");if(aL){if(l){var aK=new l(function(aM){aM.forEach(function(aN){if(aN.type==="childList"&&aN.addedNodes.length>0){aG();}});});aK.observe(aL,{childList:true});}}aG();Promise.all([aI,L()]).then(function(aM){if(aM[1]){ag();h();ay();d();}});ai(aJ).then(function(aM){y(aM);});}function ay(){var aK=document.getElementById("hook_ToolbarIconDiscussions_ToolbarDiscussions");var aJ=new l(function(aL){aL.forEach(function(aN){var aO=aN.attributeName;if(aO==="class"){if(!OK.util.is4ColumnActive()){return;}if(aN.target.classList.contains("toolbar_nav_a__discu__active")){var aM=x(document,"topPanel_d");if(aM){var aQ=x(aM,"dialogWrapperBanner");var aP=aQ?x(aQ,"dialogWrapperBanner__inner"):null;if(aP&&aP.innerHTML===""){E(aP,aQ,"discussion");}}}}});});if(aq&&aK){aJ.observe(aK,{attributes:true});}}function d(){var aM=document.getElementById("msg_layer_wrapper");var aN=document.getElementById("hook_Block_MessagesLayer");if(!B||!aN||!aM){return;}var aK=function(aO){var aQ=document.getElementById("hook_Block_MessagesAdsPanel");var aP=document.getElementById("hook_BannerNew_MessagesAdsPanelInner");if(aQ&&aP){if(aO){if(OK.util.is4ColumnActive()){E(aP,aQ,"message");}}else{aC(aQ);}}};var aJ=new l(function(aO){aK(true);aJ.disconnect();});aJ.observe(aN,{childList:true});var aL=new l(function(aO){aO.forEach(function(aP){if(aP.attributeName==="class"){aK(!aP.target.classList.contains("invisible"));}});});aL.observe(aM,{attributes:true});}function aE(aJ,aM,aL){aL();var aK=ao[aJ];if(ac&&aK>0){window.setTimeout(function(){if(document.body.contains(aM)&&aM.offsetParent){aE(aJ,aM,aL);}},aK*1000);}}function E(aK,aJ,aL,aM){return new Promise(function(aN){aE(aL,aK,function(){var aP=new o();aP.getAds(aL).then(function(aS){var aQ=(aL==="topRight"&&Q)||(aL==="bottomLeft"&&aj);var aR=H(aK,aS.result,k[aL],aL,aQ);M(aK,aJ,aL,function(){if(aM){var aU=aM(aK);if(aU>=0){aR=aU;}}I.success(t,"showDirectAd",aR);if(aR>0){D(aS.id,af[aL]);var aT=n(aS.result,aR);aP.sendCount(aL,aT).then(aO,aO);}else{aO();}aN();});});function aO(){aP.cleanup();}});});}function ag(){if(!aF){return;}var aL=document.getElementById("fourthColumnWrapper");if(!aL){return;}var aJ;if(l){aJ=new l(function(aO){aO.forEach(function(aP){var aQ=aP.attributeName;if(aQ==="jsplace"&&aP.target.id==="hook_BannerForthColumn_ForthColumnTopBannerInner"){var aR=aP.target;if(aR&&aR.innerHTML===""&&aR.getAttribute("jsplace")==="p4246"){aJ.disconnect();aN(aR).then(function(){setTimeout(aM,0);});}}});});}function aM(){if(aJ){aJ.observe(aL,{subtree:true,attributes:true});}}function aN(aO){aO.setAttribute("class","banner_new__loaded");return E(aO,aL,"topRight").then(function(){var aQ=x(document,"friendsOnlineHook");var aP=aQ?aQ.nativeHookImpl:null;if(aP){aP.doReflow();}});}var aK=document.getElementById("hook_BannerForthColumn_ForthColumnTopBannerInner");if(aK){aN(aK).then(aM);}else{aM();}}function h(){if(!K){return;}var aP=function(){return document.getElementById(i)||document.getElementById(g);};var aO=document.getElementById("mainContentLeftColumn");var aN=aP();if(!aN||!aO){return;}var aM=false;if(aN.id===g){var aL=r(aN,"banner-controller");if(aL){aM=(aL.getAttribute("data-sticky-banner")==="true");}}var aQ=function(aS,aR){E(aS,aR,"bottomLeft",function(){var aT=r(aS,"b-context");var aX=aT.children.length;var aY=0;var a0=0;for(var aZ=0;aZ<aX;++aZ){var a1=aT.children[aZ];aY+=a1.offsetHeight;if(aY>window.innerHeight*0.65){a1.classList.add(W.transform("b-invisible"));}else{a0++;}}var aV=(aS.id===g);if(aV){if(aM){var aU=C.parent(aS,"hookBlock");if(aU){av.activate(aU);}aM=false;}}else{var aW=aa("stickyBannerHook");if(aW){aW.doReflow();}}return a0;});};if(l){var aJ=new l(function(aR){aR.forEach(function(aS){var aT=aS.attributeName;if(aS.type==="childList"&&aS.addedNodes.length>0){var aV=aP();var aU=document.getElementById("mainContentLeftColumn");if(aV&&aU){aQ(aV,aU);}}});});var aK=document.getElementById("hook_Block_MainContent");aJ.observe(aK,{childList:true});}aQ(aN,aO);}function ah(aL,aK){var aJ=Date.now()+Math.floor((Math.random()*10000)+1);aK.location=ar||window.location.href;aK.agent=navigator.userAgent;return{jsonrpc:"2.0",method:aL,params:aK,id:aJ};}function c(aK,aJ){return new Promise(function(aM,aL){var aO;try{aO=JSON.parse(aJ);}catch(aN){I.success(P,"parseError");aL();return;}if(aO&&aO.error){I.success(P,aK+".respError",aO.error);aL();return;}if(!aO||!aO.result||!aO.id){I.success(P,aK+".badPayload");aL();return;}if(aO.result.status!==200){I.success(P,aK+".badStatus",aO.result.status);aL();return;}aM(aO);});}function am(aJ){return c("page",aJ);}function X(aJ){return c("count",aJ);}function o(){var aJ="/dk?cmd="+ax+"&gwt.requested="+window.pageCtx.gwtHash;this.getAds=function(aL){var aK="mt=page&pl="+window.encodeURIComponent(aL);return V.ajax({url:aJ,data:aK,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(aM){return am(aM.response);},function(aM){I.success(P,"xhrErr",aM.status);});};this.sendCount=function(aM,aL){var aK="mt=count&pl="+aM+"&cnt="+window.encodeURIComponent(aL);return V.ajax({url:aJ,data:aK,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(aN){return X(aN.response);});};this.cleanup=function(){};}function H(aO,aN,aL,aJ,aK){if(!aN||!aN.body||!aN.body.direct||!aN.body.direct.ads){I.success(P,"badDirectBlock");return;}var aS="";var aQ=aN.body.direct.ads;var aP=0;if(aQ.length===0){I.success(P,"emptyAds");return 0;}else{for(var aM=0;aM<aQ.length;++aM){if(aM>=aL){break;}var aR=aQ[aM];if(!aR){continue;}aS+=al(aR,aK,aJ);aP++;}}if(aS&&aO){aO.innerHTML='<div class="b-context">'+aS+"</div>";}return aP;}function n(aM,aJ){var aN=aM.body.direct.ads;var aL=aM.body.common.link_head.replace(/^.+\/count\//,"");for(var aK=0;aK<aJ;++aK){aL+=aN[aK].link_tail;}return aL;}function D(aK,aJ){new Image().src="//rs.mail.ru/d"+aJ+".gif?rnd="+aK+"&ts="+Date.now();}var w=function(aK){var aJ={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;"},aL=aK?/[&<>"']/g:/&(?!#?\w+;)|<|>|"|'/g;return function(aM){return aM?aM.toString().replace(aL,function(aN){return aJ[aN]||aN;}):"";};};var Y=w(false);function al(aU,aM,aJ){if(aM){var aL=aw(aU.url,aJ);var aO=aU.puny_domain?'<img class="b-context__favicon" src="//favicon.yandex.net/favicon/'+Y(aU.puny_domain)+'" alt=""/>':"";var aN='<div class="b-context__title b-context__title__link b-js__href" data-nbh="'+aL+'">'+aO+Y(aU.title)+"</div>";var aP="";if(aU.images&&aU.images[0]){var aS=J[aJ].registerImageStyle(Y(aU.images[0][1]),Y(aU.images[0][2]),Y(aU.images[0][0]));aP='<div class="b-context__picture b-js__href b-img-'+aJ+aS+'" data-nbh="'+aL+'"></div>';}var aT='<div class="b-context__content b-context__content__link b-js__href" data-nbh="'+aL+'">'+Y(aU.body)+"</div>";var aR=aU.region?'<span class="b-context__contacts__item">'+Y(aU.region)+"</span>":"";var aQ='<div class="b-context__contacts b-context__contacts__item b-context__contacts__item_link b-js__href" data-nbh="'+aL+'">'+Y(aU.domain)+aR+"</div>";var aK=aU.warning?'<div class="b-context__warning">'+Y(aU.warning)+"</div>":"";return'<div class="b-context__item">'+aN+aP+aT+aQ+aK+"</div>";}else{var aO=aU.puny_domain?'<img class="b-context__favicon" src="//favicon.yandex.net/favicon/'+Y(aU.puny_domain)+'" alt=""/>':"";var aN='<div class="b-context__title"><a class="b-context__title__link" href="'+Y(aU.url)+'" target="_blank">'+aO+Y(aU.title)+"</a></div>";var aP=(aU.images&&aU.images[0])?'<div class="b-context__picture"><a href="'+Y(aU.url)+'" target="_blank"><img src="'+Y(aU.images[0][0])+'" width="'+Y(aU.images[0][1])+'" height="'+Y(aU.images[0][2])+'" alt=""/></a></div>':"";var aT='<div class="b-context__content"><a class="b-context__content__link" href="'+Y(aU.url)+'" target="_blank">'+Y(aU.body)+"</a></div>";var aR=aU.region?'<span class="b-context__contacts__item">'+Y(aU.region)+"</span>":"";var aQ='<div class="b-context__contacts"><a class="b-context__contacts__item b-context__contacts__item_link" href="'+Y(aU.url)+'" target="_blank">'+Y(aU.domain)+"</a>"+aR+"</div>";var aK=aU.warning?'<div class="b-context__warning">'+Y(aU.warning)+"</div>":"";return'<div class="b-context__item">'+aN+aP+aT+aQ+aK+"</div>";}}function u(aK,aL,aJ){if(aK){I.success(t,aL,"click");window.open(aK);aJ.stopPropagation();}}function aw(aK,aL){var aJ=a[aL].length;a[aL].push(aK);return aJ;}function q(aJ){a[aJ]=[];}function m(aK){if(!aK){return null;}if(!S.isUrlConstructorExists()){return null;}var aJ=[];aK.forEach(function(aL){aJ.push(new URL(aL,window.location.href).href);});return aJ;}function O(aK){var aJ=JSON.parse(aK.getAttribute("data-config"));v=aJ.mimicUrl||v;aF=aJ.topRightBannerEnabled||false;B=aJ.messagesBannerEnabled||false;aq=aJ.discussionsBannerEnabled||false;K=aJ.bottomLeftBannerEnabled||false;T=aJ.statId||T;af=aJ.pixelId||af;ac=aJ.refreshEnabled||false;ao=aJ.refreshInterval||ao;G=aJ.pageId||G;F=aJ.whitelistSelector||F;ax=aJ.secretCmd||"";az=aJ.useHttp||false;ar=aJ.debugOrigin;Q=aJ.smokescreenTopRightEnabled||false;an=aJ.smokescreenDiscussionsEnabled||false;au=aJ.smokescreenMessagesEnabled||false;aj=aJ.smokescreenBottomLeftEnabled||false;b=aJ.smokescreenRandomizeCss||false;R=m(aJ.cssUrls);if(document.readyState==="interactive"||document.readyState==="complete"){aB(aJ);}else{document.addEventListener("DOMContentLoaded",function(){aB(aJ);});}f();}return{activate:O,onHooksReady:aH,detectAdBlock:L,obfuscate:function(aJ,aL,aK){return aA().then(function(){at(aJ,aL,aK);});}};});define("b/primary",["OK/utils/utils","OK/utils/vanilla","OK/utils/throttle","OK/utils/debounce","OK/utils/requireBlock","OK/utils/dom","OK/utils/delegate","OK/utils/uuid","OK/utils/StyleSheet","OK/cookie","OK/LogClicks","OK/NewsFetchCoordinator","OK/postingForm","OK/CommentWidgets","OK/scrollToTop","OK/mrg/projects","OK/mrg/counters","OK/mrg/wamba","OK/HookModel","OK/ToolbarBubble","OK/ToolbarGrowl","OK/banners/StickyBannerContainer","OK/banners/moneySave"],{});