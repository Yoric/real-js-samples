!function(t){function e(a){if(i[a])return i[a].exports;var o=i[a]={exports:{},id:a,loaded:!1};return t[a].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){t.exports=i(4)},function(t,e){var i={uncurryThis:function(t){return function(){return t.call.apply(t,arguments)}},curryThis:function(t){return function(){var e=Array.prototype.slice.call(arguments);return e.unshift(this),t.apply(null,e)}},bindFn:function(t,e){var i=Array.prototype.slice.call(arguments,2);return function(){return t.apply(e,i.concat(Array.prototype.slice.call(arguments)))}},extend:function(t,e){function i(){}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);return i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t,t.__super__=e.prototype,t},mixin:function(t){for(var e=Array.prototype.slice.call(arguments,1),i=0;i<e.length;i++){var a=e[i];for(var o in a)t[o]||(t[o]=a[o])}},distinctArray:function(t){for(var e,i=[],a={},o=0;o<t.length;o++){e=t[o];var s=e+":"+typeof e;a[s]||(i.push(e),a[s]=!0)}return i},browser:{version:function(){var t=navigator.userAgent;return navigator.appVersion,{trident:/Trident/i.test(t),presto:/Presto/i.test(t),webKit:/AppleWebKit/i.test(t),gecko:/Gecko/i.test(t)&&!/KHTML/i.test(t),mobile:/AppleWebKit.*Mobile.*/i.test(t),ios:/\(i[^;]+;( U;)? CPU.+Mac OS X/i.test(t),android:/Android/i.test(t)||/Linux/i.test(t),windowsphone:/Windows Phone/i.test(t),iPhone:/iPhone/i.test(t),iPad:/iPad/i.test(t),MicroMessenger:/MicroMessenger/i.test(t),webApp:!/Safari/i.test(t),edge:/edge/i.test(t),weibo:/Weibo/i.test(t),uc:/UCBrowser/i.test(t),qq:/MQQBrowser/i.test(t),baidu:/Baidu/i.test(t)}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase(),lteIE:function(t){return $.browser.msie&&parseInt($.browser.version)<=t}},cookie:{get:function(t){var e=""+document.cookie,i=e.indexOf(t+"=");if(i==-1||""==t)return"";var a=e.indexOf(";",i);return a==-1&&(a=e.length),unescape(e.substring(i+t.length+1,a))},set:function(t,e,i){i=void 0!==i?i:365;var a=new Date;a.setTime(a.getTime()+24*i*60*60*1e3),document.cookie=t+"="+escape(e)+";expires="+a.toGMTString()+"; path=/; domain=.bilibili.com"},delete:function(t){this.set(t,"",-1)}},readFromLocal:function(t){return this.localStorage._support?localStorage.getItem(t):this.cookie.get(t)},saveToLocal:function(t,e,i){return this.localStorage._support?localStorage.setItem(t,e):this.cookie.set(t,e,i)},localStorage:{_support:!(!window.localStorage||"object"!=typeof window.localStorage),getItem:function(t){return this._support?window.localStorage.getItem(t):null},setItem:function(t,e){this._support&&window.localStorage.setItem(t,e)},removeItem:function(t){this.getItem(t)&&window.localStorage.removeItem(t)}},unhtml:function(t,e){return t?t.replace(e||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp|#\d+);)?/g,function(t,e){return e?t:{"<":"","&":"",'"':"",">":"","'":""}[t]}):""},html:function(t){return t?t.replace(/&((g|l|quo)t|amp|#39|nbsp);/g,function(t){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'","&nbsp;":" "}[t]}):""},hashManage:{prependHash:"!",_change:function(t,e){var i,a=location.hash,o={},s="",n=0;a&&(a=a.substring(1),this.prependHash&&(a=a.replace(new RegExp("^"+this.prependHash.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")),""))),i=a.split("&");for(var r=0;r<i.length;r++){var l=i[r].split("=")[0],c=i[r].split("=")[1];l&&(o[l]=decodeURIComponent(c))}if("object"==typeof t)for(var d in t){var p=t[d];p?o[d]=encodeURIComponent(p):p===!1&&delete o[d]}else if(e)o[t]=encodeURIComponent(e);else{if(e!==!1)return"undefined"==typeof t?o:o[t]||null;delete o[t]}for(var u in o)s+=0!=n?"&":this.prependHash,s+=u+"="+o[u],n++;return location.hash=s,o},get:function(t){return this._change(t,null)},set:function(t,e){return this._change(t,e)},clear:function(){location.hash=""}},getColor16:function(t){function e(t){var e=parseInt(t).toString(16);return 1==e.length?"0"+e:e}function i(t){for(var i="#",a=0;a<3;a++)i+=e(t[a]);return i}var a="",o=[];return null!=t.match(/\((.*)\)/)?(o=t.match(/\((.*)\)/)[1].split(","),a=i(o)):null!=t.match(/,+/g)?(o=t.split(","),a=i(o)):a=e(t),a},serializeParam:function(t){var e=[];for(var i in t)if("function"!=(typeof t[i]).toLowerCase()&&"object"!=(typeof t[i]).toLowerCase())e.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));else if($.isArray(t[i]))for(var a=0;a<t[i].length;a++)e.push(encodeURIComponent(i)+"[]="+encodeURIComponent(t[i][a]));return e.join("&")},query2json:function(t){if($.isPlainObject(t))return t;if(void 0===t)return{};for(var e=t.split("&"),i={},a=0;a<e.length;a++){var o=e[a].split("=");i[o[0]]=o[1]}return i},hash2json:function(){return window.location.href.split("#").length>1?this.query2json(window.location.href.split("#")[1].split("?")[0].replace(/#/,"")):{}},query:{get:function(t){var e=i.query2json(this._getQuery());return t?e[t]:e},set:function(t,e){var a=i.query2json(this._getQuery()),o=i.hash2json();if("object"==typeof t)for(var s in t)this._set(a,s,t[s]);else this._set(a,t,e);return i.makeUrl("",a,o)},_set:function(t,e,i){return null===i?delete t[e]:t[e]=i,t},_getQuery:function(){return void 0!==window.location.search?window.location.search.substring(1):window.location.href.split("?")[1]?window.location.href.split("?")[1].split("#")[0]:""}},makeUrl:function(t,e,i){var a,o=this.serializeParam(e),s=this.serializeParam(i);return a=o?(t||location.pathname)+"?"+o:t||location.pathname,s&&(a=a+"#"+s),a},formatNum:function(t,e){if(void 0===t||"string"==typeof t&&isNaN(parseInt(t)))return"--";var i={"万":1e4},a="万";e="string"==typeof e?e:a;var o=i[e]||i[a];if(!("string"==typeof t&&t.indexOf(e)>=0)){if("string"==typeof t&&t.indexOf(",")>=0){for(var s=t.split(","),n="",r=0;r<s.length;r++)n+=s[r];t=n}return t=parseInt(t),t>=o&&(t=(t/o).toFixed(1)+e),t}},parseCardProps:function(t,e){var i={"data-gk":t.play,"data-sc":t.favorites,"data-pl":t.review,"data-dm":t.video_review,"data-up":t.author,"data-subtitle":t.subtitle,"data-lm":t.typename||"","data-tg":t.created?new Date(1e3*t.created).format("yyyy-MM-dd hh:mm"):t.create||t.created_at,"data-txt":t.description,"data-yb":t.coins},a="";if("string"==e){for(var o in i)""!=a&&(a+=" "),a+=o+'="'+i[o]+'"';return a}return i},newParseCardProps:function(t,e){var i={"data-gk":t.stat.view,"data-sc":t.stat.favorite,"data-pl":t.stat.reply,"data-dm":t.stat.danmaku,"data-up":t.owner.name,"data-lm":t.tname||"","data-tg":new Date(1e3*t.pubdate).format("yyyy-MM-dd hh:mm"),"data-txt":t.desc,"data-yb":t.stat.coin};return i},protocolRelative:function(t){return/http:|https:/.test(t)?t.replace(/http:|https:/,window.location.protocol):$.browser.msie&&parseInt($.browser.version)<=8?window.location.protocol+t:t},formatDuration:function(t,e,i){if("number"!=typeof t)return t;i=i||-1;var a=this.toFixed(t%60,2),o=e?this.toFixed(Math.floor(t%3600/60),2):this.toFixed(Math.floor(t/60),i),s=e?this.toFixed(Math.floor(t/3600),i):null;return null===s?[o,a].join(":"):[s,o,a].join(":")},isObject:function(t){return"object"==typeof t&&null!==t},isNothing:function(t){return null==t},isUndefined:function(t){return"undefined"==typeof t},join:function(){return Array.prototype.join.call(arguments,"")},random:function(t,e){return this.isNothing(e)&&(e=t,t=0),Math.floor(Math.random()*(e-t+1))+t},debounce:function(t,e,a){function o(){clearTimeout(s),a&&i.isNothing(s)&&t(),s=setTimeout(t,e||100)}var s;return o.clearNext=function(){clearTimeout(s)},o},throttle:function(t,e,i){function a(){n=i.head?0:(new Date).getTime(),s=null,t()}function o(){var o,r=(new Date).getTime();!n&&i.head&&(n=r),o=e-(r-n),o<=0||o>e?(clearTimeout(s),s=null,n=r,t()):s||i.tail||(s=setTimeout(a,o))}var s,n=0;return e=e||200,i=i||{},o.clearNext=function(){clearTimeout(s),s=null,n=0},o},toFixed:function(t,e){if("number"!=typeof t&&"string"!=typeof t)return t;for(t=String(t),e=Number(e)||2;t.length<e;)t="0"+t;return t.length>e?t:t.slice(-e)},thumbnail:function(t,e,i){if("string"!=typeof t)return t;if("undefined"==typeof e)return t;var a,o,s,n,r=t.split("?");return i=i||e,a={midfix:"/"+e+"_"+i,suffix:"_"+e+"x"+i},o={cdn:/^http.+i[0-2]\.hdslb\.com\//,bfs:/^http.+i\d\.hdslb\.com\/bfs\//,group1:/^http.+i\d\.hdslb\.com\/group1\//,other:/(^http.+i\d\.hdslb\.com)(\/.+)/},s={bfs:/_\d+x\d+\./,other:/\/\d+_\d+\//},o.cdn.test(r[0])?s.bfs.test(r[0])||s.other.test(r[0])?t:(o.bfs.test(r[0])||o.group1.test(r[0])?(r[0]+=a.suffix+r[0].slice(r[0].lastIndexOf(".")),t=r.join("?")):(n=o.other.exec(r[0]),n&&(r[0]=n[1]+a.midfix+n[2],t=r.join("?"))),t):t},isWebp:function(){try{return 0==document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp")}catch(t){return!1}}(),webp:function(t,e){if(!t)return t;var i=t.match(/(.*\.(jpg|jpeg|gif|png|bmp))(\?.*)?/),a=t.indexOf("/bfs/")!=-1;if(!i||"gif"===i[2]||"bmp"===i[2]||!a)return t;var o=e.w,s=e.h,n=o&&s?"@"+o+"w_"+s+"h":"@",e=i[3]?i[3]:"";return this.isWebp?i[1]+n+".webp"+e:i[1]+n+"."+i[2]+e},isAlpha:function(t,e){var i;return localStorage.getItem("machineDna")?i=localStorage.getItem("machineDna"):(i=parseInt(10*Math.random()+1),localStorage.setItem("machineDna",i)),!!(this.isBeta(t)||e<i)},isBeta:function(t){var e=!1,a=i.cookie.get("DedeUserID").slice(-1);return a&&$.isArray(t)&&(e=$.inArray(+a,t)>-1),e},trimHttp:function(t){return t?t.replace(/^http:/,""):""},getByteLen:function(t){for(var e=0,i=0;i<t.length;i++){var a=t.charAt(i);e+=null!=a.match(/[^\x00-\xff]/gi)?1:.5}return e},videoReport:function(t){window.spmReportData&&(window.spmReportData[t]=t)},customReport:function(t,e){if(window[reportConfig.msgObjects]){var i=window[reportConfig.msgObjects],a=e?e:t;i[t]=a}}};t.exports=i},function(t,e){function i(){}i.prototype={addBlacklist:function(t,e,i){var a=e?e:null;$.ajax({url:"//api.bilibili.com/x/relation/modify?cross_domain=true",type:"POST",data:{fid:t,act:5,re_src:i||15},xhrFields:{withCredentials:!0}}).done(function(t){a(t)})},follow:function(t,e,i){var a=e?e:null;$.ajax({url:"//api.bilibili.com/x/relation/modify?cross_domain=true",type:"POST",data:{fid:t,act:1,re_src:i||15},xhrFields:{withCredentials:!0}}).done(function(t){a(t)})},whisperUser:function(t,e){var i=e?e:null;this.todoFriend({act:"add",attention:0,format:"json",uid:t},i)},unFollow:function(t,e,i,a){var o=e?e:null;$.ajax({url:"//api.bilibili.com/x/relation/modify?cross_domain=true",type:"POST",data:{fid:t,act:i?4:2,re_src:a||15},xhrFields:{withCredentials:!0}}).done(function(t){o(t)})},delFans:function(t,e){var i=e?e:null;this.todoFriend({act:"delFans",attention:0,format:"json",uid:t},i)}},t.exports=i},function(t,e,i){function a(t){if(this.params={evType:"over",center:!0,Overlap:!1,focusShowPos:"up",zIndex:null,animation:"fade",position:null,event:null,bound:!0,margin:5,backdrop:!1,bindInput:!1},"string"==typeof t&&(t={evType:t}),"object"==typeof t)for(var e in this.params)t.hasOwnProperty(e)&&(this.params[e]=t[e])}i(7);var o=2e4;a.prototype={timer:null,msgbox:null,bindobj:null,backobj:null,incomingTimer:null,position:{},reverseMap:{up:"down",down:"up",left:"right",right:"left"},show:function(t,e,i,a,s){if(t=$(t),0!=this.params.Overlap||"yes"!=t.attr("hasMessageBox")){t.attr("hasMessageBox","yes"),"undefined"==typeof i&&(i=1e3),"undefined"==typeof a&&(a="msg"),"button"==i&&(s=a,a=i,i=1e3);var n=i;0==i&&(n=50);var r=this;return r.leftTimer=function(){"button"!=a&&(clearTimeout(r.timer),r.timer=setTimeout(function(){clearTimeout(r.timer),r.close(r)},n))},r.incomingTimer=function(){clearTimeout(r.timer)},this.bindobj=t,this.msgbox=$('<div class="m-layer m_layer"><div class="bg"><div class="content"><div class="mini"><div class="msg-text"><i class="b-icon"></i>'+e+"</div>"+("button"==a?'<div class="btnbox"><a class="b-btn ok">确认</a><a class="b-btn-cancel cancel">取消</a></div>':"")+"</div></div></div></div>").prependTo("body"),this.msgbox.addClass("m-"+a),r.params.backdrop&&(r.backobj=$('<div class="m-backdrop"></div>').css({position:"fixed",top:0,left:0,right:0,bottom:0,opacity:.6,backgroundColor:"#000",zIndex:(r.params.zIndex||o)-1}).appendTo("body")),"over"==this.params.evType?(t.bind("mouseleave",r.leftTimer),t.bind("mouseenter",r.incomingTimer),this.msgbox.bind("mouseenter",function(){clearTimeout(r.timer)}),this.msgbox.bind("mouseleave",r.leftTimer)):t.bind("blur",r.leftTimer),this.setPos(),this.msgbox.css("z-index",r.params.zIndex||o++),this.params.bindInput&&"error"==a&&(t.is(":text")||t.is("textarea")?t.addClass("error").on("focus.m-error",this.closeErrHandler()):t.find(":text,textarea").length>0&&t.addClass("error").find(":text,textarea").on("focus.m-error",this.closeErrHandler())),"button"==a&&(this.msgbox.find(".ok").click(function(){"undefined"!=typeof s&&0==s(r)||r.close()}),this.msgbox.find(".cancel").click(function(){r.close()})),0!=i&&r.leftTimer(),"fade"!=this.params.animation?this.msgbox.addClass(this.params.animation):this.moveIn(this.params.focusShowPos),this.bindobj.data("b-msgbox",this),this.msgbox}},close:function(){var t=this,e=function(){t.msgbox.remove(),t.params.backdrop&&t.backobj.remove(),"over"==t.params.evType&&t.bindobj.off("mouseenter",t.incomingTimer),t.bindobj.off("over"==t.params.evType?"mouseleave":"blur",t.leftTimer)};this.bindobj.attr("hasMessageBox",""),"fade"!=this.params.animation?this.msgbox.removeClass(this.params.animation).fadeOut(200,e):this.msgbox.fadeOut(200,e)},closeErrHandler:function(){var t=this;return function(){var e=t.bindobj.removeClass("error");t.close(),e.is(":text")||e.is("textarea")?e.off("focus.m-error"):e.find(":text,textarea").length>0&&e.find(":text,textarea").off("focus.m-error")}},moveIn:function(t){var e={opacity:1},i=5,a=5;switch(t){case"up":e.top="-=5",a=0;break;case"down":e.top="+=5",i=-i,a=0;break;case"left":e.left="-=5",i=0;break;case"right":e.left="+=5",a=-a,i=0;break;default:e.top="-=5",a=0}this.msgbox.show().css({top:this.position.top+i,left:this.position.left+a,opacity:0}),this.msgbox.animate(e,200)},setPos:function(){this.params.position?(this.position=this.params.position,this.resetBound()):this._pos(this.params.focusShowPos),this.msgbox.css("left",this.position.left),this.msgbox.css("top",this.position.top)},_pos:function(t,e){var i=this.bindobj;switch(this.params.focusShowPos=t,t){case"up":this.position.top=i.offset().top-this.msgbox.outerHeight()-this.params.margin,this.position.left=i.offset().left,this.params.center&&(this.position.left=this.position.left-this.msgbox.outerWidth()/2+i.outerWidth()/2);break;case"down":this.position.top=i.offset().top+i.outerHeight()+this.params.margin,this.position.left=i.offset().left,this.params.center&&(this.position.left=this.position.left-this.msgbox.outerWidth()/2+i.outerWidth()/2);break;case"left":this.position.top=i.offset().top,this.position.left=i.offset().left-this.msgbox.outerWidth()-this.params.margin;break;case"right":this.position.top=i.offset().top,this.position.left=i.offset().left+i.outerWidth()+this.params.margin}if(!this.checkBound(t)){if(e!==!0)return this._pos(this.reverseMap[t],!0);this.setBound("down"),this.setBound("left"),this.position.top-=10,this.position.left+=10}return this.resetBound(),this.position},resetBound:function(t){if(this.params.bound||t===!0)for(var e=["up","down","left","right"],i=0;i<e.length;i++){var a=e[i];this.checkBound(a)||this.setBound(a)}},checkBound:function(t){switch(t){case"up":return this.position.top>=$(window).scrollTop();case"down":return this.position.top+this.msgbox.outerHeight()<=$(window).height()+$(window).scrollTop();case"left":return this.position.left>=$(window).scrollLeft();case"right":return this.position.left+this.msgbox.outerWidth()<=$(window).width()+$(window).scrollLeft();default:return!0}},setBound:function(t){switch(t){case"up":this.position.top=$(window).scrollTop();break;case"down":this.position.top=$(window).height()+$(window).scrollTop()-this.msgbox.outerHeight();break;case"left":this.position.left=$(window).scrollLeft();break;case"right":this.position.left=$(window).width()+$(window).scrollLeft()-this.msgbox.outerWidth()}}},t.exports=a},function(t,e,i){i(11);var a=i(1),o=i(3),s=i(10),n=i(12),r=i(2),l=new r;i(5),function(t){var e=t.ajax;t.ajax=function(i,o){return"object"==typeof i&&(o=i,i=void 0),"post"!=o.type&&"POST"!=o.type||!o.data||o.data.csrf||t.extend(o.data,{csrf:a.cookie&&a.cookie.get("bili_jct")}),e(i,o)}}(jQuery),function(t){function e(t,e,i,a,o,s){this.noface="//static.hdslb.com/images/member/noface.gif";var r={isLogin:!1,face:this.noface,vipStatus:0,vipType:0};this.upId="",this.oid=e,this.pageType=i,this.$root=$(t),this.sort=0,this.loaded=!1,this.loading=!1,this.emojiLoaded=!1,this.userStatus=r,this.fbData=[],this.pageInfo={},this.jumpId=o,this.isViewHot=!1,this.blacklistCode=9,this.blacklist=0,this.assist=0,this._pos=-1,this.mounted=s&&s.mounted||null;var l=this;if(this.$root.length)return this._fixRootPosition(),this.userCard=new n(this.userStatus),this._registerEvent(),a?(this.userStatus=$.extend({},r,a),this.init()):$.ajax({url:"//api.bilibili.com/x/web-interface/nav",type:"GET",dataType:"jsonp",data:{jsonp:"jsonp"},xhrFields:{withCredentials:!0}}).done(function(t){t&&0==t.code&&(l.userStatus=$.extend({},r,t.data))}).always(function(){l.init()}),this}var i=10,r="//api.bilibili.com/x/v2/reply",c={reply:r,subReply:r+"/reply",report:r+"/report",blacklist:r+"/blacklist",add:r+"/add",emoji:r+"/web/emojis",setTop:r+"/top",like:r+"/action",hate:r+"/hate",del:r+"/del",jump:r+"/jump"},d={header:['<div class="comment-header clearfix">','<div class="tabs-order">','<ul class="clearfix">','<li class="on" data-sort="0">全部评论</li>','<li data-sort="2" class="hot-sort">按热度排序</li>',"</ul>","</div>",'<div class="header-page paging-box"></div>',"</div>"].join("")},p={},u=window.localStorage&&window.localStorage.getItem,m="commentNotice";e.prototype.quickLogin=function(){a.browser.version.mobile?location.href="//passport.bilibili.com/login":window.biliQuickLogin?window.biliQuickLogin(function(t){window.location.reload()}):$.getScript("https://static-s.bilibili.com/account/bili_quick_login.js",function(){window.biliQuickLogin(function(t){window.location.reload()})})},e.prototype.init=function(t){t&&(this.userStatus=$.extend({},defaultStatus,t));try{var e=['<div class="bb-comment '+(a.browser.version.mobile?"bb-comment-h5":"")+'">','<div class="reply-notice"></div>',d.header,'<div class="comment-list"></div>','<div class="bottom-page '+(a.browser.version.mobile?"paging-box":"paging-box-big")+'"></div>',"</div>"].join("");this.$root.html(e),this._getEmoji(),this.userCard.reset(this.userStatus)}catch(t){window.console&&window.console.log("[comment]",t)}},e.prototype._fixRootPosition=function(){"static"==this.$root.css("position")&&this.$root.css({position:"relative"})},e.prototype._getEmoji=function(){var t=this;t.emojiLoaded=!0,$.ajax({url:c.emoji,type:"GET",dataType:"jsonp",data:{jsonp:"jsonp"},cache:!0,jsonpCallback:"emoji"}).done(function(e){if(e&&e.data&&0===e.code){for(var i=e.data,o=0;o<i.length;o++)for(var s=0;s<i[o].emojis.length;s++){var n=i[o].emojis[s].name,r=a.trimHttp(i[o].emojis[s].url),l='<img src="'+a.trimHttp(a.webp(r,{w:50,h:50}))+'" alt="'+(n.split("_")[1]||"").slice(0,-1)+'">';p[n]=l}t.edata=i,t._showLoading("<span>loading...</span>"),t.jumpId?t.jumpToReply(t.jumpId):t._isInView(t.$root)&&t.loadPage(1)}}).fail(function(){t.emojiLoaded=!1,t.loaded||t._showLoading('<span>加载失败，<a class="reload-comment">点击重试</a></span>')})},e.prototype._renderNotice=function(t){if(t){var e="",i=u?+window.localStorage.getItem(m):0;if(t.id>i){var a=t.link;a&&a.indexOf("__MID__")!==-1&&a.indexOf("__REQUESTID__")!==-1&&this.userStatus.mid?t.link=a.replace("__MID__",this.userStatus.mid||"__MID__").replace("__REQUESTID__",t.id||"__REQUESTID__"):t.link=a,e+='<div class="notice-item" data-id="'+t.id+'"><i class="icon-close-notice"></i><i class="icon-notice"></i><a href="'+t.link+'" target="_blank">'+t.content+"</a></div>"}this.$root.find(".reply-notice").html(e)}},e.prototype._resolveEmoji=function(t){var e=new RegExp(/\[[^\]]+_[^\]]+\]/g);return t.replace(e,function(t){return p[t]})},e.prototype._resolveVote=function(t,e){return e.vote?t.replace(/\{vote:.*}/,'<a class="vote-link" data-id="'+e.vote.id+'" data-name="'+e.vote.title+'"><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIyLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IuWbvuWxgl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgMjggMjkiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDI4IDI5OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+Cjx0aXRsZT5Hcm91cCAyPC90aXRsZT4KPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CjxnIGlkPSJQYWdlLTEiIHN0eWxlPSJmaWxsOiMwMEExRDYiPgoJPGcgaWQ9IuWwgemdoiI+CgkJPGcgaWQ9Ikdyb3VwLTIiPgoJCQk8ZyBpZD0iUmVjdGFuZ2xlLTUiPgoJCQkJPHBhdGggZD0iTTMuMywyOC4zQzEuNSwyOC4zLDAsMjYuOSwwLDI1VjEwLjFjMC0xLjgsMS41LTMuMywzLjMtMy4zczMuMywxLjUsMy4zLDMuM1YyNUM2LjcsMjYuOSw1LjIsMjguMywzLjMsMjguM3ogTTMuMyw4CgkJCQkJYy0xLjIsMC0yLjEsMS0yLjEsMi4xVjI1YzAsMS4yLDEsMi4xLDIuMSwyLjFzMi4xLTEsMi4xLTIuMVYxMC4xQzUuNSw4LjksNC41LDgsMy4zLDh6Ii8+CgkJCTwvZz4KCQkJPGcgaWQ9IlJlY3RhbmdsZS01XzFfIj4KCQkJCTxwYXRoIGQ9Ik0xNCwyOC40Yy0xLjgsMC0zLjMtMS41LTMuMy0zLjNWMy4zQzEwLjcsMS41LDEyLjIsMCwxNCwwczMuMywxLjUsMy4zLDMuM1YyNUMxNy4zLDI2LjksMTUuOCwyOC40LDE0LDI4LjR6IE0xNCwxLjIKCQkJCQljLTEuMiwwLTIuMSwxLTIuMSwyLjFWMjVjMCwxLjIsMSwyLjEsMi4xLDIuMWMxLjIsMCwyLjEtMSwyLjEtMi4xVjMuM0MxNi4xLDIuMiwxNS4yLDEuMiwxNCwxLjJ6Ii8+CgkJCTwvZz4KCQkJPGcgaWQ9IlJlY3RhbmdsZS01XzJfIj4KCQkJCTxwYXRoIGQ9Ik0yNC43LDI4LjRjLTEuOCwwLTMuMy0xLjUtMy4zLTMuM3YtNi44YzAtMS44LDEuNS0zLjMsMy4zLTMuM3MzLjMsMS41LDMuMywzLjNWMjVDMjgsMjYuOSwyNi41LDI4LjQsMjQuNywyOC40egoJCQkJCSBNMjQuNywxNi4xYy0xLjIsMC0yLjEsMS0yLjEsMi4xVjI1YzAsMS4yLDEsMi4xLDIuMSwyLjFzMi4xLTEsMi4xLTIuMXYtNi44QzI2LjgsMTcsMjUuOCwxNi4xLDI0LjcsMTYuMXoiLz4KCQkJPC9nPgoJCTwvZz4KCTwvZz4KPC9nPgo8L3N2Zz4K" alt="" />'+e.vote.title+"</a>"):t},e.prototype._resolveAt=function(t,e){return t.replace(/@[^\s]+/g,function(t){return e[t.trim().substring(1)]||t}).replace(/\n/g,"<br />").replace(/av([0-9]+)/gi,'<a href="//www.bilibili.com/video/av$1/" target="_blank" data-view="$1">av$1</a>').replace(/cv([0-9]+)/gi,'<a href="//www.bilibili.com/read/cv$1/" target="_blank" data-view="$1">cv$1</a>')},e.prototype._formateMemberMap=function(t){for(var e,i={},o=0,s=t.length;o<s;++o)e=t[o],i[e.uname]='<a href="//space.bilibili.com/'+e.mid+'" target="_blank" data-usercard-mid="'+e.mid+'">@'+a.unhtml(e.uname)+" </a>";return i},e.prototype._createReplyBox=function(t){var e="",i="";return this.userStatus.isLogin?(this.userStatus.moral<60&&(e="no-login",a.browser.version.mobile?(e+=" moral",i='节操低于60，无法发送评论。<br>详情点击<a class="login-link b-btn" href="https://account.bilibili.com/site/record?type=moral" target="_blank">节操记录</a><a class="jc-help" href="//www.bilibili.com/blackboard/help.html#%E8%8A%82%E6%93%8D%E7%9B%B8%E5%85%B3" target="_blank"><i class="b-tip jc"></i>如何恢复？</a>'):i='你的节操已低于60，将无法发表评论，详情请点击<a class="login-link b-btn" href="https://account.bilibili.com/site/record?type=moral" target="_blank">我的节操记录</a><a class="jc-help" href="//www.bilibili.com/blackboard/help.html#%E8%8A%82%E6%93%8D%E7%9B%B8%E5%85%B3" target="_blank"><i class="b-tip jc"></i>如何恢复节操值？</a>'),this.userStatus.level_info&&this.userStatus.level_info.current_level<2&&this.userStatus.mid!=this.upId&&(e="no-login",i="您的等级不足，升级至Lv2可参与评论"),this.blacklist&&(e="no-login",i="由于UP主隐私设置，你无法评论！")):(i='请先<a class="b-btn btn-open-mini-Login">登录</a>后发表评论 (・ω・)',e="no-login"),t&&(i="当前稿件评论功能已关闭",e="no-login"),['<div class="comment-send '+e+'">','<div class="user-face">','<img class="user-head" src="'+a.trimHttp(a.webp(this.userStatus.face,{w:52,h:52}))+'" />',"</div>",'<div class="textarea-container">',i?'<div class="baffle-wrap"><div class="baffle">'+i+"</div></div>":"",'<i class="ipt-arrow"></i>','<textarea cols="80" name="msg" rows="5" placeholder="请自觉遵守互联网相关的政策法规，严禁发布色情、暴力、反动的言论。" class="ipt-txt"></textarea>','<button type="submit" class="comment-submit" '+(e?'disabled="disabled"':"")+">发表评论</button>","</div>",'<div class="comment-emoji">','<i class="face"></i>','<span class="text">表情</span>',"</div>","</div>"].join("")},e.prototype.loadPage=function(t,e){var i=this;i.loading=!0,e&&$(window).scrollTop(i.$root.offset().top),i.emoji||(i.emoji=new s(i.$root,i.userStatus.vipStatus,i.edata)),this._getReplyByPage(t).done(function(e){if(i._hideLoading(),i.loaded=!0,e&&0===e.code){if(e.data){e.data.hots?i.isViewHot=!0:i.isViewHot=!1;var a=$('.comment-header .tabs-order li[data-sort="2"]');e.data.page&&e.data.page.count>=20||e.data.hots||2===i.sort?a.show():a.hide(),i.blacklist=e.data.blacklist||0,i.assist=e.data.assist||0,i.pageInfo=e.data.page||{},i._renderNotice(e.data.notice),i._updateReplyListByData(e.data,t),i._renderTopPagination(i.pageInfo),i._renderBottomPagination(i.pageInfo),$(".common .b-head .results").html(e.data.page.acount||0).show(),e.data&&e.data.config&&e.data.config.showentry?$(".common .b-head .del-log").show():$(".common .b-head .del-log").remove(),i.$root.find(".bb-comment > .comment-send").remove(),$(i._createReplyBox()).insertBefore(i.$root.find(".comment-list"))}}else 12002==e.code&&(i.$root.find(".bb-comment > .comment-send").remove(),$(i._createReplyBox(!0)).insertBefore(i.$root.find(".comment-list")))}).fail(function(){i.loaded||i._showLoading('<span>加载失败，<a class="reload-comment">点击重试</a></span>')}).always(function(){i.loading=!1})},e.prototype._updateReplyListByData=function(t,e){var i=[],a=-1,o=this;o.upId=t.upper&&t.upper.mid,o.hasUpTop=t.upper&&t.upper.top,t.top&&1===o.pageInfo.num&&(t.top.isTop=!0,i.push(t.top)),t.upper&&t.upper.top&&1===o.pageInfo.num&&(t.upper.top.isUpTop=!0,i.push(t.upper.top)),t.upper&&t.upper.vote&&1===o.pageInfo.num&&(t.upper.vote.isUpTop=!0,i.push(t.upper.vote)),1===e&&0===o.sort&&(o.isViewHot&&(i=i.concat(t.hots||[])),a=t.hots&&t.hots.length>0?i.length:-1,o._pos=a);var s=i.length>0?o._uniq(i.concat(t.replies)):i.concat(t.replies);o._renderReplyList(s,a)},e.prototype._uniq=function(t){var e={};return t.filter(function(t){return!e.hasOwnProperty(t.rpid)&&(e[t.rpid]=!0)})},e.prototype._renderTopPagination=function(t){var e=this,i=Math.ceil(t.count/t.size);i>1?this.$root.find(".header-page").paging({pageCount:i,current:t.num,backFn:function(t){e.$root.trigger("replyPageChange",{p:t}),a.videoReport("playpage_comment_pageclick1")}}):this.$root.find(".header-page").html("")},e.prototype._renderBottomPagination=function(t){var e=this,i=Math.ceil(t.count/t.size);i>1?this.$root.find(".bottom-page").paging({pageCount:i,current:t.num,jump:!a.browser.version.mobile,backFn:function(t){e.$root.trigger("replyPageChange",{p:t,isBottom:!0}),a.videoReport("playpage_comment_pageclick2")}}):this.$root.find(".bottom-page").html("")},e.prototype._renderReplyList=function(t,e){var i="";if(t){this.fbData=t;try{if(0===t.length)i+='<div class="no-more-reply">没有更多信息</div>';else{this.$root.find(".no-more-reply").remove();for(var a=0,o=t.length;a<o;++a){var s=t[a];(a<e||s.isUpTop||s.isTop)&&(s.isHot=!0),i+=this._createReplyItem(s,a,e),e&&a===e-1&&this.isViewHot&&(i+='<div class="hot-line"><span>以上为热门评论，<a class="more-hot">查看更多</a></span></div>')}}this.$root.find(".comment-list").html(i),this.mounted&&this.mounted(t)}catch(t){window.console&&window.console.log("[comment] render ",t)}}},e.prototype._createReplyItem=function(t,e,i){return['<div class="list-item reply-wrap '+(t.isTop||t.isUpTop?"is-top":"")+'" data-id="'+t.rpid+'" data-index="'+e+'">',this._createUserFace(t),this._createListCon(t,e,i),"</div>"].join("")},e.prototype._createLegalizeIcon=function(t){var e="";return t&&0==t.type?e='<div class="legalize p-auth" title="个人认证"></div>':t&&1==t.type&&(e='<div class="legalize o-auth" title="企业/团体认证"></div>'),e},e.prototype._createUserFace=function(t){var e='<div class="user-face"><img src="'+this.noface+'"></div>',i=['<div class="user-face">','<a href="//space.bilibili.com/'+t.mid+'" target="_blank" data-usercard-mid="'+t.mid+'">','<img src="'+a.trimHttp(a.webp(t.member.avatar,a.browser.version.mobile?{w:45,h:45}:{w:52,h:52}))+'" alt="">',"</a>",t.member.pendant&&t.member.pendant.image?'<a href="//space.bilibili.com/'+t.mid+'" class="pendant" data-usercard-mid="'+t.mid+'" target="_blank"><img src="'+a.trimHttp(a.webp(t.member.pendant.image,a.browser.version.mobile?{w:71,h:71}:{w:86,h:86}))+'"></a>':"",this._createLegalizeIcon(t.member.official_verify),t.isHot?this._createFollowButton(t.member,t.rpid):"","</div>"].join("");return t.state===this.blacklistCode?e:i},e.prototype._createFollowButton=function(t,e){function i(t){$.ajax({url:"//api.bilibili.com/x/relation",data:{fid:t.mid,jsonp:"jsonp"},dataType:"jsonp"}).done(function(e){if(e&&0===e.code){var i=$('.follow-btn[data-mid="'+t.mid+'"]'),a=1===e.data.attribute||2===e.data.attribute||6===e.data.attribute,o=1===e.data.attribute;a&&i.addClass("followed").text("已关注"),o&&i.attr("quiet",!0)}})}var o=['<div class="hot-follow">','<button class="follow-btn" data-mid="'+t.mid+'" data-uname="'+a.unhtml(t.uname)+'" data-rpid="'+e+'">关注</button>',"</div>"].join("");return this.userStatus.isLogin&&i(t),o},e.prototype._createListCon=function(t,e,i){var o=this._parentBlacklistDom(t,e,i),s=['<div class="con '+(i==e?"no-border":"")+'">','<div class="user">'+this._identity(t.mid,t.assist,t.member.fans_detail),'<a data-usercard-mid="'+t.mid+'" href="//space.bilibili.com/'+t.mid+'" target="_blank" class="name '+this._createVipClass(t.member.vip.vipType,t.member.vip.vipStatus)+'">'+a.unhtml(t.member.uname)+'</a><a href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l'+t.member.level_info.current_level+'"></i></a>'+this._createNameplate(t.member.nameplate)+"</div>",this._createMsgContent(t),'<div class="info">',t.floor?'<span class="floor">#'+t.floor+"</span>":"",this._createPlatformDom(t.content.plat),'<span class="time">'+this._formateTime(t.ctime)+"</span>",'<span class="like '+(1==t.action?"liked":"")+'"><i></i><span>'+(t.like?t.like:"")+"</span></span>",'<span class="hate '+(2==t.action?"hated":"")+'"><i></i></span>',this._createReplyBtn(t.rcount),'<div class="operation"><div class="spot"></div><div class="opera-list"><ul>'+(this._canSetTop(t)?'<li class="set-top">'+(t.isUpTop?"取消置顶":"设为置顶")+"</li>":"")+(this._canBlackList(t.mid)?'<li class="blacklist">加入黑名单</li>':"")+(this._canReport(t.mid)?'<li class="report">举报</li>':"")+(this._canDel(t.mid)&&!t.isTop?'<li class="del" data-mid="'+t.mid+'">删除</li>':"")+"</ul></div></div>",this._createVoteContent(t.content),"</div>",'<div class="reply-box">',this._createSubReplyList(t.replies,t.rcount,!1,t.rpid),"</div>",'<div class="paging-box">',"</div>","</div>"].join("");return a.browser.version.mobile&&(s=['<div class="con '+(i==e?"no-border":"")+'">','<div class="user">'+this._identity(t.mid,t.assist,t.member.fans_detail),'<a data-usercard-mid="'+t.mid+'" href="//space.bilibili.com/'+t.mid+'" target="_blank" class="name '+this._createVipClass(t.member.vip.vipType,t.member.vip.vipStatus)+'">'+a.unhtml(t.member.uname)+'</a><a href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l'+t.member.level_info.current_level+'"></i></a>'+this._createNameplate(t.member.nameplate)+'<div class="right">',t.floor?'<span class="floor">#'+t.floor+"</span>":"",'<span class="time">'+this._formateMobileTime(t.ctime)+"</span></div>","</div>",this._createMsgContent(t),this._createVoteContent(t.content),'<div class="info">',this._createPlatformDom(t.content.plat),'<span class="like '+(1==t.action?"liked":"")+'"><i></i><span>'+(t.like?t.like:"")+"</span></span>",'<span class="hate '+(2==t.action?"hated":"")+'"><i></i></span>',this._createReplyBtn(t.rcount),'<div class="operation"><div class="spot"></div><div class="opera-list"><ul>'+(this._canSetTop(t)?'<li class="set-top">'+(t.isUpTop?"取消置顶":"设为置顶")+"</li>":"")+(this._canBlackList(t.mid)?'<li class="blacklist">加入黑名单</li>':"")+(this._canReport(t.mid)?'<li class="report">举报</li>':"")+(this._canDel(t.mid)&&!t.isTop?'<li class="del" data-mid="'+t.mid+'">删除</li>':"")+"</ul></div></div>","</div>",'<div class="reply-box">',this._createSubReplyList(t.replies,t.rcount,!1,t.rpid),"</div>",'<div class="paging-box">',"</div>","</div>"].join("")),
t.state===this.blacklistCode?o:s},e.prototype._createMsgContent=function(t){var e="";return e=1===t.state?'<a class="hidden-reply-toggle" href="javascript:;">[此楼层已被用户隐藏 点击查看]</a><div class="quote" style="display:none;">'+(t.isTop||t.isUpTop?'<span class="stick">置顶</span>':"")+this._resolveVote(this._resolveEmoji(this._resolveAt(t.content.message,this._formateMemberMap(t.content.members||[]))),t.content)+"</div>":[3,4].indexOf(t.state)!==-1?'<p><a href="javascript:;">***</a></p>':'<p class="text">'+(t.isTop||t.isUpTop?'<span class="stick">置顶</span>':"")+this._resolveVote(this._resolveEmoji(this._resolveAt(t.content.message,this._formateMemberMap(t.content.members||[]))),t.content)+"</p>"},e.prototype._createVoteContent=function(t){if(t.vote&&t.vote.id){var e=['<div class="vote-container" data-id="'+t.vote.id+'" data-name="'+t.vote.title+'">','<div class="image-area">','<div class="share-img"></div>',"</div>",'<div class="text-area">','<div class="text-content">'+t.vote.title+"</div>",'<div class="text-desc">'+t.vote.cnt+"人参与</div>",'<div class="vote-btn-box">','<div class="vote-btn">投票</div>',"</div>","</div>","</div>"].join("");return e}return""},e.prototype._canSetTop=function(t){return!!this.userStatus.isLogin&&+this.upId===+this.userStatus.mid&&!t.isTop},e.prototype._canReport=function(t){return+t!==+this.userStatus.mid},e.prototype._canBlackList=function(t){return+t!==+this.userStatus.mid},e.prototype._identity=function(t,e,i){if(+this.upId===t)return'<span class="stick assist">UP</span>';if(e)return'<span class="stick assist">骑士</span>';if(i){var a=["#2EBDA7","#5896DE","#A068F1","#FF86B2","#F68D18"],o=a[Math.ceil(i.level/5)-1];return'<span class="stick true-love" style="border-color:'+o+";color:"+o+'">'+i.medal_name+'<span class="medal-level" style="border-color:'+o+'">'+i.level+"</span></span>"}return""},e.prototype._canDel=function(t){return!!this.userStatus.isLogin&&(+this.upId===+this.userStatus.mid||+this.userStatus.mid===+t||this.assist)},e.prototype._createReplyBtn=function(t){return t>0?'<span class="reply btn-hover btn-highlight">回复</span>':'<span class="reply btn-hover">回复</span>'},e.prototype._createNameplate=function(t){return t.image_small?'<div class="nameplate"><a class="nameplate-icon"'+(a.browser.version.mobile?"":'href="https://account.bilibili.com/site/nameplate.html" target="_blank"')+'><img src="'+a.trimHttp(a.webp(t.image_small,{w:32,h:32}))+'"></a><div class="nameplate-card"><i class="nameplate-arrow"></i><img class="nameplate-pic" src="'+a.trimHttp(a.webp(t.image,{w:62,h:62}))+'"><div class="nameplate-text"><p class="n-name">'+t.name+'</p><p class="n-title">'+t.condition+'</p><p class="n-type"><span>'+t.level+'</span><a href="https://account.bilibili.com/site/nameplate.html" target="_blank">查看全部>></a></p></div></div></div>':""},e.prototype._createPlatformDom=function(t){var e="";return 2===t?e="安卓客户端":3===t?e="iOS客户端":4===t&&(e="Windows Phone客户端"),e&&'<span class="plad">来自<a href="//app.bilibili.com/" target="_blank">'+e+"</a></span>"},e.prototype._checkId=function(t,e){for(var i=0,a=t.length;i<a;++i)if(+t[i].rpid===+e)return!0;return!1},e.prototype._createSubReplyList=function(t,e,i,a){var o="";if(!t||0===t.length)return o;for(var s=!!this.jumpId&&this._checkId(t,this.jumpId),n=i||s?t.length:Math.min(t.length,3),r=0;r<n;++r){var l=t[r],c=this._createSubReplyItem(l,r),d=this._subBlacklistDom(l);o+=l.state===this.blacklistCode?d:c}return!i&&!s&&e>3&&(o+='<div class="view-more">共<b>'+e+'</b>条回复, <a class="btn-more" data-pid="'+a+'">点击查看</a></div>'),o},e.prototype._createSubReplyItem=function(t,e){var i=['<div class="reply-item reply-wrap" data-id="'+t.rpid+'" data-index="'+e+'">','<a href="//space.bilibili.com/'+t.mid+'" data-usercard-mid="'+t.mid+'" target="_blank" class="reply-face">','<img src="'+a.trimHttp(a.webp(t.member.avatar,{w:52,h:52}))+'" alt="">',"</a>",'<div class="reply-con">','<div class="user">','<a href="//space.bilibili.com/'+t.mid+'" target="_blank" data-usercard-mid="'+t.mid+'" class="name '+this._createVipClass(t.member.vip.vipType,t.member.vip.vipStatus)+'">'+a.unhtml(t.member.uname)+"</a>",'<a href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l'+t.member.level_info.current_level+'"></i></a>',this._createSubMsgContent(t),"</div>",'<div class="info">','<span class="time">'+this._formateTime(t.ctime)+"</span>",'<span class="like '+(1==t.action?"liked":"")+'"><i></i><span>'+(t.like?t.like:"")+"</span></span>",'<span class="reply btn-hover">回复</span>','<div class="operation btn-hover btn-hide-re"><div class="spot"></div><div class="opera-list"><ul>'+(this._canBlackList(t.mid)?'<li class="blacklist">加入黑名单</li>':"")+(this._canReport(t.mid)?'<li class="report">举报</li>':"")+(this._canDel(t.mid)?'<li class="del" data-mid="'+t.mid+'">删除</li>':"")+"</ul></div></div>","</div>","</div>","</div>"].join("");if(a.browser.version.mobile)var i=['<div class="reply-item reply-wrap" data-id="'+t.rpid+'" data-index="'+e+'">','<div class="reply-con">','<div class="user">','<a href="//space.bilibili.com/'+t.mid+'" target="_blank" data-usercard-mid="'+t.mid+'" class="name '+this._createVipClass(t.member.vip.vipType,t.member.vip.vipStatus)+'">'+a.unhtml(t.member.uname)+"</a>",'<a href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l'+t.member.level_info.current_level+'"></i>','<div class="right"><span class="time">'+this._formateMobileTime(t.ctime)+"</span></div>","</a>",this._createSubMsgContent(t),"</div>",'<div class="info">','<span class="like '+(1==t.action?"liked":"")+'"><i></i><span>'+(t.like?t.like:"")+"</span></span>",'<span class="reply btn-hover">回复</span>','<div class="operation btn-hover btn-hide-re"><div class="spot"></div><div class="opera-list"><ul>'+(this._canBlackList(t.mid)?'<li class="blacklist">加入黑名单</li>':"")+(this._canReport(t.mid)?'<li class="report">举报</li>':"")+(this._canDel(t.mid)?'<li class="del" data-mid="'+t.mid+'">删除</li>':"")+"</ul></div></div>","</div>","</div>","</div>"].join("");return i},e.prototype._createSubMsgContent=function(t){var e="";return e=1===t.state?'<a class="hidden-reply-toggle" href="javascript:;">[此楼层已被用户隐藏 点击查看]</a><div class="quote" style="display:none;">'+this._resolveAt(t.content.message,this._formateMemberMap(t.content.members||[]))+"</div>":[3,4].indexOf(t.state)!==-1?'<a href="javascript:;">***</a>':'<span class="text-con">'+this._resolveAt(t.content.message,this._formateMemberMap(t.content.members||[]))+"</span>"},e.prototype._formateTime=function(t){if(!+t)return t;var e=Math.floor((new Date).getTime()/1e3),i=new Date;if(i.setHours(0),i.setMinutes(0),i.setSeconds(0),i=Math.floor(i.getTime()/1e3),t>i&&e-t>=0){if(e-t<=50){var a=10*Math.floor((e-t)%60/10);return(t>10?a:10)+"秒前"}return e-t<3600?Math.ceil((e-t)/60)+"分钟前":Math.ceil((e-t)/3600)+"小时前"}var o=new Date;o.setTime(1e3*t);var s=o.getMonth()+1,n=o.getDate(),r=o.getHours(),l=o.getMinutes();return s<10&&(s="0"+s),n<10&&(n="0"+n),r<10&&(r="0"+r),l<10&&(l="0"+l),o.getFullYear()+"-"+s+"-"+n+" "+r+":"+l},e.prototype._formateMobileTime=function(t){if(!+t)return t;var e=Math.floor((new Date).getTime()/1e3);if(e-t>=0){if(e-t<=50){var i=10*Math.floor((e-t)%60/10);return(t>10?i:10)+"秒前"}return e-t<3600?Math.ceil((e-t)/60)+"分钟前":e-t<86400?Math.ceil((e-t)/3600)+"小时前":e-t<2592e3?Math.ceil((e-t)/3600/24)+"天前":e-t<31536e3?Math.ceil((e-t)/3600/24/30)+"月前":Math.ceil((e-t)/3600/24/365)+"年前"}},e.prototype._getReplyByPage=function(t){var e=this;return $.ajax({url:c.reply,data:{jsonp:"jsonp",pn:t,type:e.pageType,oid:e.oid,sort:e.sort},dataType:"jsonp"})},e.prototype._getSubReplyByPage=function(t,e){var a=this;return $.ajax({url:c.subReply,data:{jsonp:"jsonp",pn:e,type:a.pageType,oid:a.oid,ps:i,root:t},dataType:"jsonp"})},e.prototype._createVipClass=function(t,e){return 2===t&&1===e?"vip-red-name":""},e.prototype._sendMsg=function(t,e,i){var a=this,s=$(t).find(".comment-submit"),n=$(t).find("textarea"),r=this.isSubReply,l=new RegExp(/\[[^\]]+_[^\]]+\]/g),d=e.msg.replace(l,"");if(d=d.replace(/(^\s*)|(\s*$)/g,""),d.length>1e3||d.length<2)return(new o).show(s,"请发送2到1000字且非纯表情的评论",2e3,"error"),n.focus().parent().addClass("error"),!1;n.parent().removeClass("error"),s.text("发送中").addClass("disabled"),a.timer=setTimeout(function(){clearTimeout(a.timer),s.text("发表评论").removeClass("disabled"),(new o).show(t,"当前网速不太给力哦，请尝试重新提交~",2e3,"info")},5e3);var p=String(e.msg).replace(/\　{5,}/g,"　　　").replace(/\n{3,}/g,"\n\n\n")||e.msg,u={oid:this.oid,type:this.pageType,root:e.rid,parent:e.pid,message:(r?this.atMsg:"")+p,plat:e.plat,code:e.code,jsonp:"jsonp"};$.ajax({url:c.add,type:"POST",data:u,dataType:"json",xhrFields:{withCredentials:!0},success:function(e){if(e&&0===e.code){if(n.val(""),i&&i(e.data.rpid),e.data&&1==e.data.is_pending)return void(new o).show(s,"提交成功",2e3);(new o).show(s,"发送成功",2e3),a._removeCaptcha()}else 12041===e.code?a._blackroomExamFB():61001===e.code||61002===e.code?$.getScript("//static.hdslb.com/common/js/identityDialog.js",function(){IdentityDialog(e.code,e.message)}):e&&(new o).show(s,e.message||"操作失败",2e3,"error");e&&e.data&&e.data.need_captcha?a._renderCaptcha(t,e.data.url):a._removeCaptcha(),clearTimeout(a.timer),s.text("发表评论").removeClass("disabled")}})},e.prototype._renderCaptcha=function(t,e){var i='<div class="comment-captcha"><span>验证码：</span><input type="text" class="b-input" size="6" /><img src="'+a.trimHttp(e)+'"/></div>';t.find(".comment-captcha").remove(),t.append(i)},e.prototype._removeCaptcha=function(){$(".comment-captcha").remove()},e.prototype._reportFB=function(t,e,i,s){function n(t,a,n){$.ajax({url:c.report,type:"post",data:{oid:e,type:i,rpid:s,reason:t,content:a,jsonp:"jsonp"},xhrFields:{withCredentials:!0}}).done(function(t){0===t.code?((new o).show(n,"举报成功",1e3,"info"),$(".comment-report-bilibili-mask").remove()):12019==t.code?(new o).show(n,"举报过于频繁，请"+t.data.ttl+"秒后重试",1e3,"error"):(new o).show(n,t.message||"提交失败，请重试",1e3,"info")})}var r=['<div class="comment-bilibili-mask comment-report-bilibili-mask" style="height:'+$(document).height()+'px;">','<div class="comment-bilibili-con comment-report-bilibili">','<div class="t">请选择举报理由<i class="btn-close"></i></div>','<div class="con">','<div class="reason-box"></div>','<div class="other">','<p class="btn-other"><input type="radio" name="reason" id="other" value="0" /><label for="other">其他</label></p>','<div class="ta"><textarea placeholder="自定义理由" value=""></textarea></div></div>','<div class="btn"><a class="btn-cancel">取消</a><a class="btn-submit">确定</a><div>',"</div></div></div>"].join("");$(".comment-report-bilibili-mask").remove(),$("body").append(r);for(var l=[{type:"违反法律法规",list:[{name:"违法违规",reason:9},{name:"色情",reason:2},{name:"低俗",reason:10},{name:"赌博诈骗",reason:12}]},{type:"侵犯个人权益",list:[{name:"人身攻击",reason:7},{name:"侵犯隐私",reason:15}]},{type:"有害社区环境",list:[{name:"垃圾广告",reason:1},{name:"引战",reason:4},{name:"剧透",reason:5},{name:"刷屏",reason:3},{name:"抢楼",reason:16},{name:"视频不相关",reason:8},{name:"青少年不良信息",reason:17}]}],d=$(".comment-report-bilibili .reason-box"),p="",u=0,m=0;m<l.length;m++){p+='<dl class="clearfix"><dt>'+l[m].type+"</dt>";for(var h=0;h<l[m].list.length;h++)p+='<dd><input type="radio" name="reason" id="r'+u+'" value="'+l[m].list[h].reason+'" /><label for="r'+u+'">'+l[m].list[h].name+"</label></dd>",u++;p+="</dl>"}return d.append(p),$(".comment-report-bilibili").off("click.comment-report-close").on("click.comment-report-close",".btn-close,.btn-cancel",function(t){$(".comment-report-bilibili-mask").remove()}),$(".comment-report-bilibili").off("click.comment-report-label").on("click.comment-report-label","label",function(t){"other"===$(this).attr("for")?$(".comment-report-bilibili").find(".ta").show(200):$(".comment-report-bilibili").find(".ta").hide(200)}),$(".comment-report-bilibili").off("click.comment-report-submit").on("click.comment-report-submit",".btn-submit",function(t){var e=$(".comment-report-bilibili").find('input[type="radio"]:checked').val(),i=$(".comment-report-bilibili").find("textarea").val();e?"0"==e?i?a.getByteLen(i)>=2&&a.getByteLen(i)<=200?n(e,i,$(this)):(new o).show($(this),"自定义举报内容长度为2-200字符",1e3,"error"):(new o).show($(this),"请完善举报理由",1e3,"error"):n(e,i,$(this)):(new o).show($(this),"请选择举报理由",1e3,"error")}),!1},e.prototype._voteFB=function(t,e,i){var a=['<div class="comment-bilibili-mask comment-vote-bilibili-mask" style="height:'+$(document).height()+'px;">','<div class="comment-bilibili-con comment-vote-bilibili">','<div class="t">'+i+'<i class="btn-close"></i></div>','<div class="con">','<div class="vote-iframe"><iframe src="//t.bilibili.com/h5/dynamic/vote#/result?vote_id='+e+'&from=comment&isWeb=true" frameborder="0"></iframe></div>',"</div></div></div>"].join("");$(".comment-vote-bilibili-mask").remove(),$("body").append(a),$(".comment-vote-bilibili").off("click.comment-vote-close").on("click.comment-vote-close",".btn-close,.btn-cancel",function(t){$(".comment-vote-bilibili-mask").remove()})},e.prototype._blackListFB=function(t,e,i,a,s){var n=this,r=['<div class="comment-bilibili-mask comment-bilibili-blacklist" style="height:'+$(document).height()+'px;">','<div class="comment-bilibili-con">','<div class="t">确认拉黑该用户<i class="btn-close"></i></div>','<div class="con">','<div class="text">拉黑该用户之后，将自动取消对他的关注，<br>并禁止该用户与我进行互动。</div>','<div class="btn"><a class="btn-cancel">取消</a><a class="btn-submit">确定</a><div>',"</div></div></div>"].join("");$(".comment-bilibili-blacklist").remove(),$("body").append(r),$(".comment-bilibili-blacklist").off("click.comment-blacklist-close").on("click.comment-blacklist-close",".btn-close,.btn-cancel",function(t){$(".comment-bilibili-blacklist").remove()}),$(".comment-bilibili-blacklist").off("click.comment-blacklist-submit").on("click.comment-blacklist-submit",".btn-submit",function(e){var i=this;l.addBlacklist(a,function(e){if(0===e.code){var a="";if(s.hasClass("list-item")){var r=s.data("index"),l=n.fbData[r];a='<div class="user-face"><img src="'+n.noface+'"></div>'+n._parentBlacklistDom(l,r,n._pos),s.html(a)}if(s.hasClass("reply-item")){var r=s.parents(".list-item").data("index"),c=s.data("index"),l=n.fbData[r].replies[c];a=n._subBlacklistDom(l),$(a).insertAfter(s),s.remove()}(new o).show($(i),"加入黑名单成功",1e3,"info"),$(".comment-bilibili-blacklist").remove()}else(new o).show(t,"加入黑名单失败",1e3,"info"),$(".comment-bilibili-blacklist").remove()})})},e.prototype._blackroomExamFB=function(t,e,i,a,o){var s=['<div class="comment-bilibili-mask comment-bilibili-blackexam" style="height:'+$(document).height()+'px;">','<div class="comment-bilibili-con">','<div class="t no-title"><i class="btn-close"></i></div>','<div class="con">','<div class="text">该账号处于封禁中，点击申请答题</div>','<div class="btn"><a class="btn-cancel">取消</a><a class="btn-submit" target="_blank" href="//www.bilibili.com/blackroom/releaseexame.html">去答题</a><div>',"</div></div></div>"].join("");$("body").append(s),$(".comment-bilibili-blackexam").off("click.comment-blackexam-close").on("click.comment-blackexam-close",".btn-close,.btn-cancel,.btn-submit",function(t){$(".comment-bilibili-blackexam").remove()})},e.prototype._parentBlacklistDom=function(t,e,i){return['<div class="con '+(i==e?"no-border":"")+'">','<div class="user blacklist-font-color">黑名单用户</div>','<p class="text">由于黑名单设置，该评论已被隐藏。</p>','<div class="info">',t.floor?'<span class="floor">#'+t.floor+"</span>":"",this._createPlatformDom(t.content.plat),'<span class="time">'+this._formateTime(t.ctime)+"</span>",this._canDel(t.mid)?'<div class="operation btn-hover"><div class="spot"></div><div class="opera-list"><ul><li class="del" data-mid="'+t.mid+'">删除</li></ul></div></div>':"","</div>","</div>"].join("")},e.prototype._subBlacklistDom=function(t){return['<div class="reply-item reply-wrap" data-id="'+t.rpid+'">','<a class="reply-face"><img src="'+this.noface+'"></a>','<div class="reply-con">','<div class="user">','<span class="blacklist-font-color">黑名单用户 </span> <span class="text-con">由于黑名单设置，该回复已被隐藏。</span>',"</div>",'<div class="info">','<span class="time">'+this._formateTime(t.ctime)+"</span>",this._canDel(t.mid)?'<div class="operation btn-hover btn-hide-re"><div class="spot"></div><div class="opera-list"><ul><li class="del" data-mid="'+t.mid+'">删除</li></ul></div></div>':"","</div>","</div>","</div>"].join("")},e.prototype._setTop=function(t,e){return $.ajax({type:"post",url:c.setTop,dataType:"json",data:{oid:this.oid,type:this.pageType,rpid:t,action:e,jsonp:"jsonp"},xhrFields:{withCredentials:!0}})},e.prototype._delReply=function(t){return $.ajax({type:"POST",url:c.del,dataType:"json",data:{oid:this.oid,type:this.pageType,rpid:t,jsonp:"jsonp"},xhrFields:{withCredentials:!0}})},e.prototype._likeReply=function(t,e){return $.ajax({type:"POST",url:c.like,dataType:"json",data:{oid:this.oid,type:this.pageType,rpid:t,action:e,jsonp:"jsonp"},xhrFields:{withCredentials:!0}})},e.prototype._hateReply=function(t,e){return $.ajax({type:"POST",url:c.hate,dataType:"json",data:{oid:this.oid,type:this.pageType,rpid:t,action:e,jsonp:"jsonp"},xhrFields:{withCredentials:!0}})},e.prototype._updateSubReplyByPage=function(t,e,i,a){var o=this;this._getSubReplyByPage(t,e).done(function(s){if(s&&0===s.code){i.find(".reply-box").html(o._createSubReplyList(s.data.replies,s.data.page.count,!0,t));var n=Math.ceil(s.data.page.count/s.data.page.size),r=i.find(".paging-box");i.find(".reply-box").attr("data-page",e).attr("data-total",s.data.page.count),n>1?r.paging({pageCount:n,current:e,backFn:function(e){o.$root.trigger("subReplyPageChange",{pid:t,page:e,parent:i})}}):i.find(".paging-box").html(""),"function"==typeof a&&setTimeout(function(){a.call(null)},10)}}).fail(function(){})},e.prototype._registerEvent=function(){function t(){$(window).off("scroll.comment").on("scroll.comment",function(){var t=e.$root.find(".bb-comment > .comment-send"),i=e.$root.find(".bb-comment > .comment-header");!e._isInView(e.$root)||e.loaded||e.loading||(e._showLoading("<span>loading...</span>"),e.loadPage(1)),$(".comment-list").height()>$(window).height()&&(e._isInView(i,!0)?t.insertAfter(i):e._isInView(e.$root.find(".bottom-page"),!0)&&e.$root.find(".bb-comment").append(t))})}var e=this;this.$root.off("click"),this.$root.off("click.showMore").on("click.showMore",".btn-more",function(){var t=$(this).data("pid");e._updateSubReplyByPage(t,1,$(this).parents(".list-item:eq(0)"))}),this.$root.off("subReplyPageChange").on("subReplyPageChange",function(t,i){e._updateSubReplyByPage(i.pid,i.page,i.parent)}),this.$root.off("replyPageChange").on("replyPageChange",function(t,i){e.loadPage(i.p,i.isBottom)}),this.$root.on("click.openMiniLogin",".btn-open-mini-Login",function(){e.quickLogin()}),this.$root.on("click.emoji",".comment-emoji",function(t){var i=$(this).siblings(".textarea-container").find("textarea"),a=$(this).offset().left-e.$root.offset().left,o=$(this).offset().top-e.$root.offset().top+$(this).outerHeight(),s=$(this).parents(".comment-list").length>0;i.focus(),e.emoji.show(i,a,o,s),t.stopPropagation()}),this.$root.off("focus.textarea").on("focus.textarea","textarea",function(){$(this).parent().addClass("focus"),0===$(this).parents(".list-item").length&&(e.isSubReply=!1),a.browser.version.mobile&&$(window).off("scroll.comment")}),this.$root.off("blur.textarea").on("blur.textarea","textarea",function(){$(this).parent().removeClass("focus"),a.browser.version.mobile&&t()}),this.$root.off("input.textarea").on("input.textarea","textarea",function(){$(this).parent().removeClass("error")}),this.$root.on("click.sendMsg",".comment-submit",function(){var t=$(this).parent(),a=$(this).siblings("textarea").val()||"",o=void 0,s=t.find(".comment-captcha");if(!$(this).hasClass("disabled")){s.length>0&&(o=s.find("input").val());var n={rid:$(this).attr("data-rid"),pid:$(this).attr("data-pid"),msg:a,plat:1,code:o},r=$(this).parents(".list-item:eq(0)"),l=r.find(".reply-box"),c=+r.find(".reply-box").attr("data-page")||1,d=+r.find(".reply-box").attr("data-total")||0;e._sendMsg(t,n,function(t){n.rid?c!==Math.ceil(d/i)&&0!==d||e._appendSubReplyToTop(t,a,l):e._appendReplyToTop(t,a)})}}),this.$root.on("click.report",".report",function(){if(!e.userStatus.isLogin)return void e.quickLogin();var t=$(this).parents(".reply-wrap:eq(0)"),i=t.data("id");i&&e._reportFB($(this),e.oid,e.pageType,i)}),this.$root.on("click.blacklist",".blacklist",function(){if(!e.userStatus.isLogin)return void e.quickLogin();var t=$(this).parents(".reply-wrap:eq(0)"),i=t.find("[data-usercard-mid]:eq(0)").data("usercard-mid");i&&e._blackListFB($(this),e.oid,e.pageType,i,t)}),this.$root.on("click.reply",".reply",function(){var t=$(this).parents(".list-item:eq(0)"),i=$(this).parents(".reply-wrap:eq(0)"),a=i.hasClass("reply-item"),o=a?"回复 @"+i.find(".user .name").text()+" :":"请自觉遵守互联网相关的政策法规，严禁发布色情、暴力、反动的言论。";e.isSubReply=a,e.atMsg="回复 @"+i.find(".user .name").text()+" :";var s=t.attr("data-id"),n=i.attr("data-id"),r=!e.userStatus.isLogin||e.userStatus.level_info&&e.userStatus.level_info.current_level<2&&e.userStatus.mid!=e.upId&&1!=e.userStatus.vipStatus&&e.userStatus.official_verify&&e.userStatus.official_verify.type==-1;if(t.siblings(".list-item").removeClass("open-reply").find(".comment-send").remove(),t.hasClass("open-reply")){var l=t.find(".comment-send .comment-submit"),c=l.attr("data-rid")!==l.attr("data-pid");a||c?r?"":t.find(".comment-send textarea").focus().prop("placeholder",o).val(""):(t.find(".comment-send").remove(),t.removeClass("open-reply"))}else t.find(".con").append(e._createReplyBox()),t.addClass("open-reply"),r?"":t.find(".comment-send textarea").focus().prop("placeholder",o).val("");t.find(".comment-send button.comment-submit").attr("data-rid",s).attr("data-pid",n)}),this.$root.on("click",".follow-btn",function(){if(e.userStatus.isLogin){var t=$(this),i=$('.follow-btn[data-mid="'+t.data("mid")+'"]');t.hasClass("followed")?l.unFollow(t.data("mid"),function(s){0===s.code?(a.customReport("follow_click",{type:9,aid:e.oid,follow:!1}),i.removeClass("followed").text("关注"),(new o).show(t,"取消关注成功!",500,"ok")):(new o).show(t,s.message,500,"error")},t.attr("quiet"),122):l.follow(t.data("mid"),function(s){return 22006==s.code?void $.getScript("//static.hdslb.com/plugins/attentionLimitPopup/attentionLimitPopup.js",function(){new attentionLimitPopup}):void(0===s.code?(a.customReport("follow_click",{type:9,aid:e.oid,follow:!0}),i.addClass("followed").text("已关注"),a.browser.version.mobile||$.getScript("//static.hdslb.com/common/js/followGroupDialog.js",function(){followGroupDialog(t.data("mid"),t.data("uname"),{showErrMsgInDialog:!1,onAddTagError:function(t){(new o).show($(".follow-dialog-window .submit"),t||"添加分组失败")},onSubmitError:function(t){(new o).show($(".follow-dialog-window .submit-move"),t||"移动分组失败")},onSubmitSuccess:function(){(new o).show($(".follow-dialog-window"),"加入分组成功")},onEmptyTagSubmit:function(){(new o).show($(".follow-dialog-window"),"加入分组成功")}})})):(new o).show(t,s.message,500,"error"))},122)}else a.browser.version.mobile?location.href="//passport.bilibili.com/login":$.getScript("https://static-s.bilibili.com/account/bili_quick_login.js",function(){window.biliQuickLogin(function(t){window.location.reload()})})}),this.$root.on("click.delete",".del",function(){var t=$(this).parents(".reply-wrap:eq(0)"),i=+t.attr("data-id"),a=t.hasClass("list-item")?"删除评论后，评论下所有回复都会被删除":"删除评论后将不可恢复",s=$(this),n=s.attr("data-mid"),r=e.userStatus.mid==e.upId&&n!=e.upId;(new o).show(s,"<p>"+a+"</p><p>是否继续？</p>","button",function(){e._reportEvent(r?"upmaster_deletecomment":"user_deletecomment"),e._delReply(i).done(function(i){0===i.code?((new o).show(t,"删除成功"),t.hasClass("reply-item")?t.remove():e.loadPage(e.pageInfo.num||1)):(new o).show(t,i.message||"操作失败")})})}),this.$root.on("click.set-top",".set-top",function(){var t=$(this),i=t.parents(".list-item:eq(0)"),a=+i.attr("data-id"),s=i.hasClass("is-top"),n=s?0:1,r=s?"取消成功":"置顶成功";return e.hasUpTop&&!s?void(new o).show(i,"<p>您只能置顶一条评论哦</p><p>先取消原来的吧！</p>"):(e._setTop(a,n).done(function(t){t&&0===t.code?((new o).show(i,r),e.loadPage(1)):(new o).show(i,t.message||"操作失败")}),void e._reportEvent(s?"upmaster_cancelstick":"upmaster_stick"))}),this.$root.on("click.like",".like",function(){if(!e.userStatus.isLogin)return void e.quickLogin();var t,i=$(this),a=$(this).parents(".reply-wrap:eq(0)"),s=+a.attr("data-id"),n=i.siblings(".hate");t=i.hasClass("liked")?0:1,e._likeReply(s,t).then(function(e){if(e&&0===e.code){if(0===t){i.removeClass("liked");var a=+i.find("span").text()-1;i.find("span").text(a>0?a:"")}else if(1===t){i.addClass("liked");var a=+i.find("span").text()+1;i.find("span").text(a>0?a:""),n.removeClass("hated")}}else(new o).show(i,e.message||"操作失败")})}),this.$root.on("click.hate",".hate",function(){if(!e.userStatus.isLogin)return void e.quickLogin();var t,i=$(this),a=$(this).parents(".reply-wrap:eq(0)"),s=+a.attr("data-id"),n=i.siblings(".like");t=i.hasClass("hated")?0:1,e._hateReply(s,t).then(function(e){if(e&&0===e.code){if(0===t)i.removeClass("hated");else if(1===t&&(i.addClass("hated"),n.hasClass("liked"))){n.removeClass("liked");var a=+n.find("span").text()-1;n.find("span").text(a>0?a:"")}}else(new o).show(i,e.message||"操作失败")})}),this.$root.on("click.operation",".spot",function(t){$(".opera-list").hide(),$(this).siblings(".opera-list").show(),t.stopPropagation()}),$(document).off("click.hide-operation").on("click.hide-operation",function(){$(".opera-list").hide()}),this.$root.off("mouseleave.operation").on("mouseleave.operation",".opera-list",function(t){$(".opera-list").hide()}),this.$root.on("click.tab",".tabs-order li",function(){var t=$(this);t.hasClass("on")||(t.addClass("on").siblings().removeClass("on"),e.sort=+t.attr("data-sort"),e.loadPage(1)),"0"==t.attr("data-sort")&&a.videoReport("playpage_comment_allcomment"),"2"==t.attr("data-sort")&&a.videoReport("playpage_comment_hotcomment")}),this.$root.on("click.moreHot",".more-hot",function(){e.$root.find(".tabs-order li").removeClass("on"),e.$root.find('.tabs-order li[data-sort="2"]').addClass("on"),e.sort=2,e.loadPage(1,!0)}),this.$root.on("click.reload",".reload-comment",function(){e._showLoading("<span>loading...</span>"),e.loadPage(1)}),this.$root.on("click.notice",".reply-notice",function(){a.customReport("playpage_anoun")}),this.$root.on("click.deletNotice",".icon-close-notice",function(){var t=$(this).parent(),i=+t.attr("data-id");if(u){var o=+window.localStorage.getItem(m);i>o&&window.localStorage.setItem(m,i)}t.remove(),e._reportEvent("comment_notice_close"),a.customReport("playpage_anoun_delete")}),t(),this.$root.on("click.captcha",".comment-captcha > img",function(){var t=$(this).get(0),e=t.src.indexOf("&_ts=");t.src=t.src.substr(0,e===-1?t.src.length:e)+"&_ts="+Date.now()}),this.$root.on("click.hide",".hidden-reply-toggle",function(){$(this).siblings(".quote").slideToggle(200)}),this.$root.on("click.notice",".notice-item a",function(){e._reportEvent("comment_notice_click")}),this.$root.on("click.vote",".vote-container, .vote-link",function(){if(!e.userStatus.isLogin)return void e.quickLogin();var t=$(this).data("id"),i=$(this).data("name");a.browser.version.mobile&&(location.href="//t.bilibili.com/h5/dynamic/vote#/result?vote_id="+t+"&from=comment"),t&&e._voteFB($(this),t,i)})},e.prototype._isInView=function(t,e){if(t.length){var i=$(window).height(),a=t.offset().top-$(window).scrollTop();return e?a<=i&&a>=0:a<=i}},e.prototype._showLoading=function(t){this.$root.find(".comment-loading").remove(),this.$root.find(".bb-comment").append('<div class="comment-loading">'+t+"</div>")},e.prototype._hideLoading=function(){this.$root.find(".comment-loading").remove()},e.prototype.jumpToReply=function(t){var e=this;e.emoji||(e.emoji=new s(e.$root,e.userStatus.vipStatus,e.edata)),this.jumpId=t,e.loading=!0,$.ajax({url:c.jump,dataType:"jsonp",data:{jsonp:"jsonp",rpid:t,oid:e.oid,type:e.pageType}}).done(function(i){if(e._hideLoading(),e.loaded=!0,0===i.code){i.data.hots?e.isViewHot=!0:e.isViewHot=!1;var a=$('.comment-header .tabs-order li[data-sort="2"]');i.data.page&&i.data.page.count>=20||i.data.hots?a.show():a.hide(),e.blacklist=i.data.blacklist||0,e.assist=i.data.assist||0,e.pageInfo=i.data.page||{},e._renderNotice(i.data.notice),e._updateReplyListByData(i.data,e.pageInfo.num),e._renderTopPagination(e.pageInfo),e._renderBottomPagination(e.pageInfo),$(".common .b-head .results").html(i.data.page.acount||0).show(),i.data&&i.data.config&&i.data.config.showentry?$(".common .b-head .del-log").show():$(".common .b-head .del-log").remove(),e.$root.find(".bb-comment > .comment-send").remove(),$(e._createReplyBox()).insertBefore(e.$root.find(".comment-list")),e.jumpId="",setTimeout(function(){var i=$('[data-id="'+t+'"]');if(!i.length)return $(window).scrollTop(e.$root.offset().top),e._showMessage("评论已被删除",2500),void(window.console&&window.console.log("[comment] dom not find when jump"));if($(window).scrollTop(i.offset().top),i.hasClass("reply-item")){var a=i.parents(".list-item:eq(0)");e._updateSubReplyByPage(+a.attr("data-id"),e.pageInfo.rt_num,a,function(){$('[data-id="'+t+'"]').find(".reply").click()})}else i.hasClass("list-item")&&i.find(".con .reply").click()},100)}else 12002==i.code&&(e.$root.find(".bb-comment > .comment-send").remove(),$(e._createReplyBox(!0)).insertBefore(e.$root.find(".comment-list")))}).fail(function(){e.loaded||e._showLoading('<span>加载失败，<a class="reload-comment">点击重试</a></span>')}).always(function(){e.loading=!1})},e.prototype._showMessage=function(t,e){$("body").append('<div class="comment-msg"><span>'+t+"</span></div>"),setTimeout(function(){$(".comment-msg").remove()},e||2e3)},e.prototype._reportEvent=function(t,e){"function"==typeof window.rec_rp&&window.rec_rp("event",t,e)},e.prototype._appendReplyToTop=function(t,e){var i={rpid:t,mid:this.userStatus.mid,type:1,count:0,rcount:0,floor:"",state:0,attr:0,ctime:"刚刚",like:0,action:0,member:{mid:this.userStatus.mid,uname:a.unhtml(this.userStatus.uname),avatar:this.userStatus.face,level_info:this.userStatus.level_info,pendant:this.userStatus.pendant,nameplate:{nid:0,name:"",image:"",image_small:"",level:"",condition:""},official_verify:this.userStatus.officialVerify,vip:{vipType:this.userStatus.vipType,vipDueDate:this.userStatus.vipDueDate,dueRemark:this.userStatus.dueRemark,accessStatus:this.userStatus.accessStatus,vipStatus:this.userStatus.vipStatus,vipStatusWarn:""}},content:{message:a.unhtml(e),plat:1,device:"",members:[]},replies:null},o=$(this._createReplyItem(i,1)),s=this.$root.find(".comment-list .list-item:eq(0)");if(s.length>0?s.before(o):(this.$root.find(".no-more-reply").remove(),this.$root.find(".comment-list").append(o)),this.mounted){var n=this.fbData;n.unshift(i),this.mounted(n)}},e.prototype._appendSubReplyToTop=function(t,e,i){var o={rpid:t,mid:this.userStatus.mid,type:1,count:0,rcount:0,floor:"",state:0,attr:0,ctime:"刚刚",like:0,action:0,member:{mid:this.userStatus.mid,uname:a.unhtml(this.userStatus.uname),avatar:this.userStatus.face,level_info:this.userStatus.level_info,pendant:this.userStatus.pendant,nameplate:{nid:0,name:"",image:"",image_small:"",level:"",condition:""},official_verify:this.userStatus.officialVerify,vip:{vipType:this.userStatus.vipType,vipDueDate:this.userStatus.vipDueDate,dueRemark:this.userStatus.dueRemark,accessStatus:this.userStatus.accessStatus,vipStatus:this.userStatus.vipStatus,vipStatusWarn:""}},content:{message:a.unhtml(e),plat:1,device:"",members:[]},replies:null},s=$(this._createSubReplyItem(o));i.prepend(s)},t.bbComment=e}(window)},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e,i){function a(t,e,i){this.container=t,this.isVip=e,this.data=i,this.defaultEmojis=["(⌒▽⌒)","（￣▽￣）","(=・ω・=)","(｀・ω・´)","(〜￣△￣)〜","(･∀･)","(°∀°)ﾉ","(￣3￣)","╮(￣▽￣)╭","( ´_ゝ｀)","←_←","→_→","(<_<)","(>_>)","(;¬_¬)",'("▔□▔)/',"(ﾟДﾟ≡ﾟдﾟ)!?","Σ(ﾟдﾟ;)","Σ( ￣□￣||)","(´；ω；`)","（/TДT)/","(^・ω・^ )","(｡･ω･｡)","(●￣(ｴ)￣●)","ε=ε=(ノ≧∇≦)ノ","(´･_･`)","(-_-#)","（￣へ￣）","(￣ε(#￣) Σ","ヽ(`Д´)ﾉ","(╯°口°)╯(┴—┴","（#-_-)┯━┯","_(:3」∠)_","(笑)","(汗)","(泣)","(苦笑)"],
this.currentSelect=0,this.curPage=1,this.totalPage=1,this.tabNum=7,this.tabWidth=46,this.avalEmojiNum=1,this.emojiData=[{pname:"颜文字",pid:-1,pstate:0,emojis:this.defaultEmojis,purl:"//static.hdslb.com/images/base/emoji-tab-default.png"}],this.emojiDom="<div class='emoji-box'><div class='emoji-title'><span></span></div><div class='emoji-wrap'></div><div class='emoji-tabs'><div class='emoji-container'><div class='emoji-tab-wrap clearfix'></div></div></div></div>",this.init()}i(6);var o=i(1);a.prototype={init:function(){$(this.container).find(".emoji-box").remove(),$(this.container).append(this.emojiDom),this.emojiBox=$(this.container).find(".emoji-box"),this.hide();var t=$(this.container).find(".emoji-tabs"),e=$(this.container).find(".emoji-wrap"),i=$(this.container).find(".emoji-title"),a=this;if(this.isVip)for(var o=0;o<this.data.length;o++)this.emojiData.push(this.data[o]),0==this.data[o].pstate&&(this.avalEmojiNum++,0==this.currentSelect&&(this.currentSelect=o+1));this.createTabs(t),this.createEmoji(e,i),t.off("click.tab").on("click.tab",".tab-link",function(){a.currentSelect=+$(this).attr("data-index"),a.oldCurrentSelect=a.currentSelect,$(this).addClass("on").siblings(".tab-link").removeClass("on"),a.createEmoji(e,i)}),e.off("click").on("click",".emoji-list",function(t){var e=$(this).attr("data-emoji-text");a.insertAtCursor($(a.ta)[0],e),a.emojiBox.hide()}),$(document).off("click.offEmoji").on("click.offEmoji",function(t){a.emojiBox.is(t.target)||0!==a.emojiBox.has(t.target).length||a.emojiBox.hide()}),t.off("click.prev").on("click.prev",".prev",function(){a.curPage>1&&a.curPage--,a.updateTabSlide()}),t.off("click.next").on("click.next",".next",function(){a.curPage<a.totalPage&&a.curPage++,a.updateTabSlide()})},updateTabSlide:function(){var t=$(this.container).find(".emoji-tab-slider"),e=t.find(".prev"),i=t.find(".next");this.curPage>1?e.addClass("on"):e.removeClass("on"),this.curPage<this.totalPage?i.addClass("on"):i.removeClass("on"),$(this.container).find(".emoji-tab-wrap").css({left:-1*(this.curPage-1)*this.tabWidth*this.tabNum})},createTabs:function(t){var e="";this.totalPage=Math.ceil(this.avalEmojiNum/this.tabNum);for(var i=0;i<this.emojiData.length;i++)if(0==this.emojiData[i].pstate){var a=this.currentSelect==i?"on":"";e+="<a class='tab-link "+a+"' data-index='"+i+"'><img src='"+o.trimHttp(o.webp(this.emojiData[i].purl,{w:22,h:22}))+"'></a>"}t.find(".emoji-tab-wrap").html(e).css({width:this.emojiData.length*this.tabWidth,left:0}),t.find(".emoji-tab-slider").remove(),this.totalPage>1&&t.append('<div class="emoji-tab-slider clearfix"><span class="prev"></span><span class="next on"></span></div>')},createEmoji:function(t,e){if(e.find("span").text(this.emojiData[this.currentSelect].pname),0==this.currentSelect){for(var i="",a=0;a<this.emojiData[0].emojis.length;a++)i+="<a class='emoji-list emoji-text' data-emoji-text='"+this.emojiData[0].emojis[a]+"'>"+this.emojiData[0].emojis[a]+"</a>";t.html("").append(i)}else{for(var i="",s=this.emojiData[this.currentSelect].emojis,a=0;a<s.length;a++)0==s[a].state&&(i+="<a class='emoji-list emoji-icon' data-emoji-text='"+s[a].name+"'><img src='"+o.trimHttp(o.webp(s[a].url,{w:40,h:40}))+"' title='"+s[a].name+"'></a>");t.html("").append(i)}},insertAtCursor:function(t,e){if(document.selection)t.focus(),sel=document.selection.createRange(),sel.text=e,sel.select();else if(t.selectionStart||"0"==t.selectionStart){var i=t.selectionStart,a=t.selectionEnd,o=t.scrollTop;t.value=t.value.substring(0,i)+e+t.value.substring(a,t.value.length),o>0&&(t.scrollTop=o),t.focus(),t.selectionStart=i+e.length,t.selectionEnd=i+e.length}else t.value+=e,t.focus()},show:function(t,e,i,a){this.ta=t,this.emojiBox.show().css({left:e,top:i});var o=$(this.container).find(".emoji-tabs .tab-link"),s=$(this.container).find(".emoji-tab-slider");a?(this.currentSelect=0,o.eq(0).addClass("on").click(),o.eq(0).siblings().removeClass("on").hide(),s.hide(),this.curPage=1,this.updateTabSlide()):(o.show(),s.show())},hide:function(){this.emojiBox.hide()}},t.exports=a},function(t,e,i){i(8),function(t){var e={init:function(t,i){return function(){e.fillHtml(t,i),e.bindEvent(t,i)}()},fillHtml:function(t,e){return function(){t.empty(),e.pageCount>1&&!e.jump&&t.append('<span class="result">共'+e.pageCount+"页</span>"),e.current>1?t.append('<a href="javascript:;" class="prev">上一页</a>'):(t.remove(".prev"),t.append('<span class="disabled">上一页</span>')),1!=e.current&&e.current>=4&&4!=e.pageCount&&t.append('<a href="javascript:;" class="tcd-number">1</a>'),e.current-2>2&&e.current<=e.pageCount&&e.pageCount>5&&t.append('<span class="dian">...</span>');var i=e.current-2,a=e.current+2;for((i>1&&e.current<4||1==e.current)&&a++,e.current>e.pageCount-4&&e.current>=e.pageCount&&i--;i<=a;i++)i<=e.pageCount&&i>=1&&(i!=e.current?t.append('<a href="javascript:;" class="tcd-number">'+i+"</a>"):t.append('<span class="current">'+i+"</span>"));e.current+2<e.pageCount-1&&e.current>=1&&e.pageCount>5&&t.append('<span class="dian">...</span>'),e.current!=e.pageCount&&e.current<e.pageCount-2&&4!=e.pageCount&&t.append('<a href="javascript:;" class="tcd-number">'+e.pageCount+"</a>"),e.current<e.pageCount?t.append('<a href="javascript:;" class="next">下一页</a>'):(t.remove(".next"),t.append('<span class="disabled">下一页</span>')),e.pageCount>1&&e.jump&&t.append('<div class="page-jump">共<span>'+e.pageCount+'</span>页，跳至<input type="text" />页</div>')}()},bindEvent:function(i,a){return function(){i.off("click"),i.off("keydown"),i.on("click","a.tcd-number",function(){var o=parseInt(t(this).text());e.fillHtml(i,{current:o,pageCount:a.pageCount,jump:a.jump}),"function"==typeof a.backFn&&a.backFn(o)}),i.on("click","a.prev",function(){var t=parseInt(i.children("span.current").text());e.fillHtml(i,{current:t-1,pageCount:a.pageCount,jump:a.jump}),"function"==typeof a.backFn&&a.backFn(t-1)}),i.on("click","a.next",function(){var t=parseInt(i.children("span.current").text());e.fillHtml(i,{current:t+1,pageCount:a.pageCount,jump:a.jump}),"function"==typeof a.backFn&&a.backFn(t+1)}),i.on("keydown","input",function(o){if(13==o.keyCode){var s=Math.abs(parseInt(t(this).val())),n=s?s:1;n=n>a.pageCount?a.pageCount:n,e.fillHtml(i,{current:n,pageCount:a.pageCount,jump:a.jump}),"function"==typeof a.backFn&&a.backFn(n)}})}()}};t.fn.paging=function(i){var a=t.extend({pageCount:10,current:1,jump:!1,backFn:function(){}},i);e.init(this,a)}}(jQuery)},function(t,e,i){function a(t){if(!s.browser.version.mobile){var e={isLogin:!1,vipStatus:0,vipType:0,mid:null};this.userStatus=$.extend(e,t),s.browser.version.mobile||this._registerEvent()}}i(9);var o=i(2),s=i(1),n=i(3),r={},l=new o,c=0;a.prototype.reset=function(t){this.userStatus=t,r={}},a.prototype._renderCard=function(t){$(".user-card").remove(),$("body").append(this._createCard(t)),s.videoReport("playpage_namecard2")},a.prototype._renderErrorCard=function(){$(".user-card").remove(),$("body").append(this._createErrorCard())},a.prototype._renderLoadingCard=function(){$(".user-card").remove(),$("body").append(this._createLoadingCard())},a.prototype._isLikeMe=function(t){if(t.card&&t.card.attentions)for(var e=0,i=t.card.attentions.length;e<i;++e)if(t.card.attentions[e]===this.userStatus.mid)return!0;return!1},a.prototype._createCard=function(t){var e=t.space.s_img?t.space.s_img:"//i0.hdslb.com/bfs/static/c9dae917e24b4fc17c4d544caf6b6c0b17f8692b.jpg",i=0===t.card.official_verify.type?'<i title="个人认证" class="auth p-auth"></i>':"",a=1===t.card.official_verify.type?'<i title="企业/团体认证" class="auth o-auth"></i>':"",o="保密"===t.card.sex?"":"男"===t.card.sex?'<i class="sex men"></i>':'<i class="sex women"></i>',n=t.card.sign?'<p class="sign">'+s.unhtml(t.card.sign)+"</p>":"",r=2===t.card.vip.vipType&&1===t.card.vip.vipStatus?"vip-red-name":"",l=this._isLikeMe(t),c=t.following?"已关注":"+关注",d=t.following?"liked":"";return d+=l?" liked-me":"",'<div class="user-card"><div class="bg" style="background-image:url('+s.trimHttp(s.webp(e,{w:750,h:240}))+')"></div><a target="_blank" href="//space.bilibili.com/'+t.card.mid+'" class="face"><img src="'+s.trimHttp(s.webp(t.card.face,{w:50,h:50}))+'" />'+i+a+'</a><div class="info"><p class="user"><a target="_blank" href="//space.bilibili.com/'+t.card.mid+'" class="name '+r+'">'+s.unhtml(t.card.name)+"</a>"+o+'<a href="//www.bilibili.com/html/help.html#k_'+t.card.level_info.current_level+'" target="_blank"><i class="level l'+t.card.level_info.current_level+'"></i></a></p><p class="social"><a href="//space.bilibili.com/'+t.card.mid+'/#!/fans/follow" target="_blank">关注: <span class="like">'+t.card.friend+'</span></a><a href="//space.bilibili.com/'+t.card.mid+'/#!/fans/fans" target="_blank">粉丝: <span class="fans">'+s.formatNum(t.card.fans)+"</span></a></p>"+n+'</div><div class="btn-box"><a class="like '+d+'" mid="'+t.card.mid+'" uname="'+s.unhtml(t.card.name)+'"'+(t.quiet?' quiet="true"':"")+'><span class="default-text">'+c+'</span><span class="hover-text">取消关注</span></a><a href="//message.bilibili.com/#whisper/mid'+t.card.mid+'" target="_blank" class="message">发消息</a></div></div>'},a.prototype._createErrorCard=function(){return'<div class="user-card"><p class="error-card">加载失败</p></div>'},a.prototype._createLoadingCard=function(){return'<div class="user-card"><p class="loading-card">正在加载中...请稍后。</p></div>'},a.prototype._setPosition=function(t){var e=$(t).offset().left,i=$(t).offset().top;if($(t).outerWidth(),$(t).offset().top<$(window).scrollTop()+$(".user-card").height()+32)var a=i+$(t).outerHeight()+8;else var a=i-$(".user-card").height()-32;$(t.height),$(".user-card").css({left:e,top:a})},a.prototype._registerEvent=function(){var t=this;$("body").off("click.userCardAttention").on("click.userCardAttention",".user-card .btn-box .like",function(){if(t.userStatus.isLogin){var e=$(this).hasClass("liked"),i=($(this).hasClass("liked-me"),$(this).attr("mid")),a=$(this).attr("uname"),o=this;e?(l.unFollow(i,function(t){t&&0===t.code?($(o).removeClass("liked").find(".default-text").text("+关注"),delete r[i],(new n).show($(o),"取消关注成功!",1e3,"ok")):t&&(new n).show($(o),t.message,1e3,"error")},$(this).attr("quiet")),s.videoReport("playpage_unfollow2")):(l.follow(i,function(t){22006==t.code?$.getScript("//static.hdslb.com/plugins/attentionLimitPopup/attentionLimitPopup.js",function(){new attentionLimitPopup}):t&&0===t.code?($(o).text("取消关注").addClass("liked"),$.getScript("//static.hdslb.com/common/js/followGroupDialog.js",function(){$(".user-card").remove(),followGroupDialog(i,a,{showErrMsgInDialog:!1,onAddTagError:function(t){(new n).show($(".follow-dialog-window .submit"),t||"添加分组失败")},onSubmitError:function(t){(new n).show($(".follow-dialog-window .submit-move"),t||"移动分组失败")},onSubmitSuccess:function(){(new n).show($(".follow-dialog-window"),"加入分组成功")},onEmptyTagSubmit:function(){(new n).show($(".follow-dialog-window"),"加入分组成功")}})}),delete r[i]):t&&(new n).show($(o),t.message,1e3,"error")}),s.videoReport("playpage_follow2"))}else document.location.href="https://account.bilibili.com/login"}),$("body").on("mouseenter.data-userCard","[data-usercard-mid]",function(e){var i=$(this).attr("data-usercard-mid"),a=this;clearTimeout(c),c=setTimeout(function(){r[i]?(t._renderCard(r[i]),t._setPosition(a)):(t._renderLoadingCard(),t._setPosition(a),$.ajax({url:"//api.bilibili.com/x/web-interface/card",dataType:"jsonp",data:{mid:i,photo:1,jsonp:"jsonp"},dataType:"jsonp",cache:!0,success:function(e){e&&0===e.code&&$.ajax({url:"//api.bilibili.com/x/relation",data:{fid:i,jsonp:"jsonp"},dataType:"jsonp"}).done(function(i){i&&0===i.code?(e.data.following=1===i.data.attribute||2===i.data.attribute||6===i.data.attribute,e.data.quiet=1===i.data.attribute):e.data.following=!1,t._renderCard(e.data),t._setPosition(a),r[e.data.card.mid]=e.data}).fail(function(){t._renderErrorCard(),t._setPosition(a)})},error:function(){t._renderErrorCard(),t._setPosition(a)}}))},300)}),$("body").on("mouseleave.data-userCard","[data-usercard-mid]",function(t){clearTimeout(c),c=setTimeout(function(){$(".user-card").remove()},100)}),$("body").on("mouseenter.userCard",".user-card",function(t){clearTimeout(c)}),$("body").on("mouseleave.userCard",".user-card",function(t){$(".user-card").remove()})},t.exports=a}]);