!function(){var t,i="/search/q",l=searchHost,n=function(t,e){var r=$.extend({},e);r.q=void 0===r.q?"*":r.q;r.q;if("api"==t)var a=utils.path.encodeQueryJson(r),s=[l,i,"?",a].join("");else s=["/search/","?",a=utils.path.encodeQueryJson(r)].join("");return s},r=function(){var o=this;template.helper("cate_sel",function(t,e,r){return void 0===o.querys[t]&&0==e?r:o.querys[t]==e?r:""}),template.helper("cate_link",function(t,e){var r=$.extend({},o.querys);return r[t]=e,delete r.page,e||delete r[t],n("url",r)}),template.helper("option_sel",function(t,e,r){return void 0===o.querys[t]&&0==e?r:o.querys[t]==e?r:""}),template.helper("option_link",function(t,e){var r=$.extend({},o.querys);return r[t]?r[t]+=";"+e:r[t]=e,delete r.page,e||delete r[t],n("url",r)}),template.helper("selected_link",function(t,e){var r,a,s=$.extend({},o.querys),i="",l="";return o.querys[t]&&(r=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),(i=null!=(a=window.location.search.substr(1).match(r))?unescape(a[2]):null).match(e+";")?(l=i.replace(e+";",""),s[t]=l):i.match(";"+e)?(l=i.replace(";"+e,""),s[t]=l):i.match(e)&&delete s[t]),n("url",s)}),template.helper("catePath_link",function(t,e){var r=$.extend({},o.querys);return r[t]=e,delete r.page,e||delete r[t],n("url",r)}),template.helper("sort_sel",function(t,e){return void 0===t?""===o.querys.sort||void 0===o.querys.sort||"weight"===o.querys.sort?e:"":""!==o.querys.sort&&void 0!==o.querys.sort?e:""}),template.helper("sort_link",function(t){var e=$.extend({},o.querys);return""==t?delete e.sort:e.sort="asc"===e.sort?"desc":"asc",delete e.page,n("url",e)}),template.helper("sort_symbol",function(t,e,r){var a=$.extend({},o.querys);return""===a.sort||void 0===a.sort||"weight"===a.sort?t:"asc"==a.sort?e:r}),template.helper("stock_check",function(t){var e=$.extend({},o.querys);return void 0===e.stock||"0"===e.stock||""===e.stock?"":t}),template.helper("stock_lnk",function(){var t=$.extend({},o.querys);return void 0===t.stock||"0"===t.stock||""===t.stock?t.stock="1":delete t.stock,delete t.page,n("url",t)}),template.helper("price2yuan",function(t){var e=t/100;return Math.floor(e)===e?parseInt(e,10):e}),template.helper("sort_data_monitor",function(){return"asc"==$.extend({},o.querys).sort?"data-monitor=home_paixu_sort2":"data-monitor=home_paixu_sort1"})},e=function(){this.state={},this.querys={};var t=this;$(this).bind("stateChange",function(){t.render()})};e.prototype={_renderList:function(){r.apply(this);$(".list-container").removeClass("list-container-no-ret"),$(".breadcrumbs_box").html(template("tpl-breadcrumbs",this.state.search_list)),$(".filter-box").html(template("tpl-filters",this.state.search_list)),$(".filter-box").show(),$(".list-container").html(template("tpl-product-list",this.state.search_list)),$("img.lazy").lazyload({threshold:200});var t=utils.path.getFromHash("page");t=t<1?1:t;var e=Math.ceil(this.state.search_list.total/10);$(".clone-item").hide(),e<2?$(".pagelist").hide():($(".pagelist").show(),this._initPaginator(t)),filters.dealWithFindMoreVisible()},_renderNoData:function(){r.apply(this),$(".filter-box").hide(),$(".list-container").addClass("list-container-no-ret"),$(".breadcrumbs_box").html(template("tpl-breadcrumbs",this.state.search_list)),this.state.hot_list&&($(".list-container").html([template("tpl-no-ret"),template("tpl-hot-list",this.state.hot_list)]),$(".hotkeywords a").each(function(t,e){$(e).attr("href","/search/?q="+encodeURIComponent($(e).html()))}),$(".hotkeywords").show())},_getHotList:(t=!1,function(){var r=this;if(!t)return t=!0,$.ajax({url:"/index/gethotlist"}).then(function(t){if(0==(t="string"==typeof t?$.parseJSON(t):t).errno){var e=t.data.length;e%5!=0&&5<e&&(t.data=t.data.slice(0,5*Math.floor(e/5))),r.setState("hot_list",t)}}).always(function(){t=!1})}),_doSearch:function(t){var e=n("api",t),r=this,a=setTimeout(function(){$(".listwrap .layer").show()},200);$.ajax({url:e,dataType:"jsonp",timeout:5e3}).then(function(t){clearTimeout(a),$(".listwrap .layer").hide(),(t="string"==typeof(t=t)?$.parseJSON(t):t).errno?(r.setState("search_list",[]),r._getHotList()):t.data.list.length?r.setState("search_list",t.data):(r.setState("search_list",t.data),r._getHotList())},function(){r._getHotList(),$(".listwrap .layer").hide()}).always(function(){})},_initPaginator:function(t){if(!0===this.paginatorInited)return!1;var e=$.extend({},this.querys),r=this;kkpager.generPageHtml({pno:t,total:Math.ceil(r.state.search_list.total/20),totalRecords:r.state.search_list.total,mode:"click",isGoPage:!1,isShowCurrPage:!1,isShowTotalPage:!1,click:function(t){return e.page=t-1,this.selectPage(t),location.hash="#page="+t,$("html,body").animate({scrollTop:$(".listwrap").offset().top-6},500,"easeOutCubic",function(){r._doSearch(e)}),!1}}),this.paginatorInited=!0},getSearchList:function(){var t=utils.path.queryUrl(location.href);t.q=void 0===t.q?"*":t.q,this.querys=$.extend({},t);var e=t.q,r=setInterval(function(){$(".qowrds")&&(clearInterval(r),"*"===e?$(".qwords").html("\u5168\u90e8"):$(".qwords").html(e.toString().replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")))},50);if(""==$("#__mall_search_kw__").val()&&"*"!=this.querys.q){$("#__mall_search_kw__").val(this.querys.q);try{$("#__mall_search_kw__").focus(),$("#__mall_search_kw__").blur()}catch(t){}}this._doSearch(t)},setState:function(){var t=[].slice.call(arguments);t.length<1||(1==t.length?this.state=t[0]:this.state[t[0]]=t[1],$(this).trigger("stateChange"))},render:function(){this.state.search_list&&this.state.search_list.list&&this.state.search_list.list.length?this._renderList():this._renderNoData()}},window.ShopSearchEngine=new e}();