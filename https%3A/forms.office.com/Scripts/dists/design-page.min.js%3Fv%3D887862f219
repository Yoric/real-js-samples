function escapeRegExp(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function formatNumber(a,b){var c=a.toString();if(0>a)return c;if(b&&b>c.length)for(;b>c.length;)c="0"+c;return c}function extractDigits(a,b){b=b||a.length;var c=a.match(/^\d+/g),d=c&&c[0];return d?d.length<=b?d:d.substr(0,b):""}function removeQuatos(a){return stringDelimiter.test(a)?a.substr(1,a.length-2):a}function parseStringToDateLabels(a,b,c){var d={};if(null==a||null==b||null==c)return d;b.split(dateLabelsRegExp);return b.split(dateLabelsRegExp).forEach(function(b){var e;switch(b){case"d":case"dd":case"M":case"MM":case"h":case"hh":case"H":case"HH":case"m":case"mm":case"s":case"ss":e=2;case"yy":case"yyy":case"yyyy":e=e||4,d[b]=extractDigits(a,e),e=d[b].length;break;case"tt":e=0,a.toUpperCase().startsWith(c.DateTimeFormat.AMDesignator.toUpperCase())?e=c.DateTimeFormat.AMDesignator.length:a.toUpperCase().startsWith(c.DateTimeFormat.PMDesignator.toUpperCase())&&(e=c.DateTimeFormat.PMDesignator.length),d[b]=a.substr(0,e);break;default:e=0,b=removeQuatos(b),a.startsWith(b)&&(e=b.length)}a=a.slice(e)}),a.length>0?{}:d}function getTime(a,b){var c=parseInt(a.HH||a.H),d=parseInt(a.hh||a.h||a.time||12);if(isNaN(c)&&!isNaN(d)&&d>=1&&12>=d){if(null==a.tt)a.time||(c=0);else switch(a.tt.toUpperCase()){case b.DateTimeFormat.AMDesignator.toUpperCase():c=d;break;case b.DateTimeFormat.PMDesignator.toUpperCase():c=d%12+12}}var e=parseInt(a.mm||a.m||a.time||0),f=parseInt(a.ss||a.s||0);return isNaN(c)||isNaN(e)?NaN:1e3*(60*(60*c+e)+f)}function makeDOMException(){var e,tmp;try{return eval("new DOMException(DOMException.INVALID_CHARACTER_ERR)")}catch(tmp){var ex=new Error("DOM Exception 5");return ex.code=ex.number=5,ex.name=ex.description="INVALID_CHARACTER_ERR",ex.toString=function(){return"Error: "+ex.name+": "+ex.message},ex}}function getbyte64(a,b){var c=ALPHA_1.indexOf(a.charAt(b));if(-1===c)throw makeDOMException();return c}function decode(a){a=""+a;var b,c,d,e=a.length;if(0===e)return a;if(e%4!==0)throw makeDOMException();b=0,a.charAt(e-1)===PADCHAR_1&&(b=1,a.charAt(e-2)===PADCHAR_1&&(b=2),e-=4);var f=[];for(c=0;e>c;c+=4)d=getbyte64(a,c)<<18|getbyte64(a,c+1)<<12|getbyte64(a,c+2)<<6|getbyte64(a,c+3),f.push(String.fromCharCode(d>>16,d>>8&255,255&d));switch(b){case 1:d=getbyte64(a,c)<<18|getbyte64(a,c+1)<<12|getbyte64(a,c+2)<<6,f.push(String.fromCharCode(d>>16,d>>8&255));break;case 2:d=getbyte64(a,c)<<18|getbyte64(a,c+1)<<12,f.push(String.fromCharCode(d>>16))}return f.join("")}function getbyte(a,b){var c=a.charCodeAt(b);if(c>255)throw makeDOMException();return c}function encode(a){if(1!==arguments.length)throw new SyntaxError("Not enough arguments");var b,c,d=PADCHAR_1,e=ALPHA_1,f=[];a=""+a;var g=a.length-a.length%3;if(0===a.length)return a;for(b=0;g>b;b+=3)c=getbyte(a,b)<<16|getbyte(a,b+1)<<8|getbyte(a,b+2),f.push(e.charAt(c>>18)),f.push(e.charAt(c>>12&63)),f.push(e.charAt(c>>6&63)),f.push(e.charAt(63&c));switch(a.length-g){case 1:c=getbyte(a,b)<<16,f.push(e.charAt(c>>18)+e.charAt(c>>12&63)+d+d);break;case 2:c=getbyte(a,b)<<16|getbyte(a,b+1)<<8,f.push(e.charAt(c>>18)+e.charAt(c>>12&63)+e.charAt(c>>6&63)+d)}return f.join("")}var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),__assign=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a},NerveImplementation;!function(a){var b=function(){function b(b){this.master=b,this.observers=[],this.bulkChangingModeStackedCount=0,this.changingPeriod=$.Deferred().resolve(),this.changeNotifier=new a.CallLater(this.notifyChange.bind(this)),this.rules=[],this.initializeSnapshot(),this.resetChangeInfo()}return b.prototype.getSnapshot=function(a){if(!this.snapshotCache){for(var b in this.dirtyProperties)this.refreshSubSnapshot(this.dirtyProperties[b]);this.dirtyProperties={},this.snapshotCache=this.createSnapshotCache()}return this.snapshotCache},b.prototype.definitelyMarkAsChanged=function(a){this.defnitelyMarkedAsChanged=!0,this.markAsChanged(a)},b.prototype.markAsChanged=function(b,c){this.ensureChangingPeriodStarted();var d=b.FieldSchema,e=new a.FieldSchemaSet([d]);if(this.changedFields.addFieldSchema(d),c){this.subChanges.push(c);var f=c.FieldSchemas.map(d.__nerve__.shadowMapper);e.addFieldSchemas(f)}this.markFieldsAsChanged(e)},b.prototype.markAsDeleted=function(){this.markFieldsAsChanged([this.master.Schema])},b.prototype.startBulkEditMode=function(){++this.bulkChangingModeStackedCount},b.prototype.endBulkEditMode=function(){--this.bulkChangingModeStackedCount<=0&&(this.bulkChangingModeStackedCount=0,this.changeNotifier.flush())},b.prototype.observe=function(b,c){var d=this.observers[this.getIndexOfObserverInfo(b)];d?c?d.fieldSet.addFieldSchemas(c):d.fieldSet=this.getAllFields().clone():this.observers.push({callback:b,fieldSet:new a.FieldSchemaSet(c||this.getAllFields())})},b.prototype.unobserve=function(a,b){var c=this.getIndexOfObserverInfo(a),d=this.observers[c];d&&(b?b.forEach(function(a){d.fieldSet.removeFieldSchemas(a.__nerve__.allContainedFields)}):d.fieldSet.clear(),0===d.fieldSet.Count&&this.observers.splice(c,1))},b.prototype.addRule=function(a){this.rules.indexOf(a)<0&&this.rules.push(a)},b.prototype.removeRule=function(a){var b=this.rules.indexOf(a);b>=0&&this.rules.splice(b,1)},b.prototype.markSubSnapshotAsDirty=function(a){var b=this;if(a.length){this.snapshotCache=void 0,a.forEach(function(a){return b.dirtyProperties[a.Name]=a});var c=this.Master.__nerve__.membership,d=c&&c.Parent.__nerve__.changeManager;d&&d.markSubSnapshotAsDirty([c.Property])}},b.prototype.getChangingPeriod=function(){return this.changingPeriod.promise()},Object.defineProperty(b.prototype,"Master",{get:function(){return this.master},enumerable:!0,configurable:!0}),b.prototype.createChange=function(a){var b=this.Master.__nerve__.deleted&&!this.markedAsDeleted;return{BeingDeleted:b,DefinitelyMarked:this.defnitelyMarkedAsChanged,FieldSchemas:Object.freeze(a.toArray()),Master:this.Master,NewValues:b?null:this.getSnapshot(),OldValues:this.snapshotBeforeChange,SubChanges:Object.freeze(this.subChanges),UpdateNeeded:b}},b.prototype.resetChangeInfo=function(){this.changedFields=new a.FieldSchemaSet,this.subChanges=[],this.snapshotBeforeChange=this.getSnapshot(),this.markedAsDeleted=this.master.Deleted,this.defnitelyMarkedAsChanged=!1},b.prototype.notifyChangeIfNeed=function(){this.bulkChangingModeStackedCount>0?this.changeNotifier.callOnceLater():this.changeNotifier.callImmediately()},b.prototype.anythingChanged=function(){return this.changedFields.Count>0||this.Master.__nerve__.deleted},b.prototype.markFieldsAsChanged=function(a){this.changedFields.addFieldSchemas(a),this.underRuling?this.changedByRules=!0:this.notifyChangeIfNeed()},b.prototype.shouldObserverBeNotified=function(a,b){return a.fieldSet.intersect(b.FieldSchemas)},b.prototype.removeUnchangedFields=function(a,b){},b.prototype.getMembership=function(){return this.Master.__nerve__.membership},b.prototype.getParentChangeManager=function(){var a=this.Master.Parent;return a&&a.__nerve__.changeManager},b.prototype.getIndexOfObserverInfo=function(a){for(var b=0;b<this.observers.length;++b)if(this.observers[b].callback===a)return b},b.prototype.notifyChange=function(){var a=this;if(this.applyRules(),this.endCurrentChangingPeriod(),this.defnitelyMarkedAsChanged||this.Master.Deleted||this.removeUnchangedFields(this.changedFields,this.snapshotBeforeChange),this.anythingChanged()){var b=Object.freeze(this.createChange(this.changedFields));this.resetChangeInfo();var c=this.Master.__nerve__.membership;if(c&&c.Property.Mounted){var d=c.Parent.__nerve__.changeManager;d&&d.markAsChanged(c.Property,b)}this.observers.concat().forEach(function(c){a.shouldObserverBeNotified(c,b)&&c.callback(b)})}},b.prototype.applyRules=function(){var b=this;this.underRuling=!0;var c=0,d=this.changedFields,e=this.subChanges,f=[],g=function(){var g=h.rules.filter(function(a){return!a.InterestedFields||b.changedFields.intersect(a.InterestedFields)});if(!g.length)return"break";if(++c>8*h.rules.length)return h.warnForAgainstingRules(f),"break";var i=h.changedFields,j=h.subChanges;h.changedFields=new a.FieldSchemaSet,h.subChanges=[];var k=h.Master.__nerve__.deleted&&!h.markedAsDeleted;g.forEach(function(a){b.changedByRules=!1,a.onChange({Master:b.Master,BeingDeleted:k,FieldSchemas:i.toArray(),OldValues:b.snapshotBeforeChange,SubChanges:j}),b.changedByRules&&f.push(a)}),d.addFieldSchemas(h.changedFields),e.push.apply(e,h.subChanges)},h=this;do{var i=g();if("break"===i)break}while(this.changedFields.Count);this.underRuling=!1,this.changedFields=d,this.subChanges=e},b.prototype.warnForAgainstingRules=function(b){Nerve.Debugger.warn("following rules might do against each other: "+JSON.stringify(b.map(function(a){return a.Name}))+" (master: "+a.getMasterName(this.Master)+")")},b.prototype.getAllFields=function(){return this.Master.Schema.__nerve__.allContainedFields},b.prototype.ensureChangingPeriodStarted=function(){"pending"!==this.changingPeriod.state()&&(this.changingPeriod=$.Deferred())},b.prototype.endCurrentChangingPeriod=function(){this.changingPeriod.resolve()},b}();a.BranchChangeManager=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(){function a(a){this.popupRequired=a}return a.prototype.updateDirtiness=function(){if(this.popupRequired){var a=this.getProperty(),b=a.ParentMaster.__nerve__.dirtyChecker;b.setMemberDirtiness(a.Name,this.isDirty())}},a}();a.DirtyChecker=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(a){function b(b,c,d){var e=a.call(this,d)||this;return e.memberDirtinesses={},e.dirtinessCount=0,e.master=b,e.existingInSource=c,e}return __extends(b,a),Object.defineProperty(b.prototype,"Master",{get:function(){return this.master},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"ExistingInSource",{get:function(){return this.existingInSource},set:function(a){this.existingInSource=a,this.updateDirtiness()},enumerable:!0,configurable:!0}),b.prototype.isDirty=function(){if(this.master.__nerve__.deleted){var a=this.Master.Parent,b=a&&a.__nerve__.deleted;return!b&&this.existingInSource}return 0!==this.dirtinessCount},b.prototype.setMemberDirtiness=function(a,b){!this.memberDirtinesses[a]!=!b&&(b?(this.memberDirtinesses[a]=!0,0===this.dirtinessCount++&&this.updateDirtiness()):(delete this.memberDirtinesses[a],0===--this.dirtinessCount&&this.updateDirtiness()))},b.prototype.getDirtyKeys=function(){return Object.keys(this.memberDirtinesses)},b.prototype.getProperty=function(){return this.master.__nerve__.membership.Property},b}(a.DirtyChecker);a.BranchDirtyChecker=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.markAsChanged=function(a,c){c&&c.BeingDeleted?this.Master.deleteItems([a.getter()]):b.prototype.markAsChanged.call(this,a,c)},c.prototype.onPropertiesAdded=function(a){a.length&&(this.addedProperties=this.addedProperties.concat(a),this.snapshot=void 0,this.markSubSnapshotAsDirty(a),this.markFieldsAsChanged(this.Master.Schema.__nerve__.allContainedFields))},c.prototype.onPropertiesRemoved=function(a){var b=this;a.length&&(a.forEach(function(a){var c=b.addedProperties.indexOf(a);c>=0?b.addedProperties.splice(c,1):b.removedProperties.push(a),b.indexChanges[a.Name]&&(delete b.indexChanges[a.Name],--b.indexChangedPropertyCount)}),this.snapshot=void 0,this.markSubSnapshotAsDirty(a),this.markFieldsAsChanged(this.Master.Schema.__nerve__.allContainedFields))},c.prototype.onPropertyIndexChange=function(a,b){this.markSubSnapshotAsDirty([a]),this.indexChanges[a.Name]?this.indexChanges[a.Name].NewIndex=a.Index:(this.indexChanges[a.Name]={OldIndex:b,NewIndex:a.Index},++this.indexChangedPropertyCount),this.notifyChangeIfNeed()},c.prototype.initializeSnapshot=function(){var b=this.Master.Schema[0];a.FieldSchema.isLeaf(b)?this.getSubSnapshot=c.getSubSnapshotForLeafContent:this.getSubSnapshot=c.getSubSnapshotForMasterContent,this.createSnapshot()},c.prototype.refreshSubSnapshot=function(a){this.snapshot&&!a.Deleted&&(this.snapshot[a.Index]=this.getSubSnapshot(a.getter()))},c.prototype.createSnapshotCache=function(){return this.snapshot||this.createSnapshot(),this.snapshot.concat()},c.prototype.createChange=function(a){var c=this,d=b.prototype.createChange.call(this,a),e=function(a){return a.getter()},f=function(a){return c.getSubSnapshot(a)};d.AddedModels=Object.freeze(this.addedProperties.map(e)),d.AddedItemsAsSnapshots=Object.freeze(d.AddedModels.map(f)),d.RemovedModels=Object.freeze(this.removedProperties.map(e)),d.RemovedItemsAsSnapshots=Object.freeze(d.RemovedModels.map(f));var g={};Object.keys(this.indexChanges).forEach(function(a){var b=c.indexChanges[a];null!=b.NewIndex&&null!=b.OldIndex&&(g[b.NewIndex]=b.OldIndex)}),d.ChangedIndexMap=Object.freeze(g);var h=this.Master.Schema[0];return d.UpdateNeeded||h.__nerve__.info.Attributes.IsLocalField||(d.UpdateNeeded=d.AddedModels.length>0||d.RemovedModels.length>0||d.SubChanges.some(function(a){return a.UpdateNeeded})),d},c.prototype.resetChangeInfo=function(){b.prototype.resetChangeInfo.call(this),this.addedProperties=[],this.removedProperties=[],this.indexChanges={},this.indexChangedPropertyCount=0},c.prototype.anythingChanged=function(){return this.addedProperties.length>0||this.removedProperties.length>0||this.indexChangedPropertyCount>0||b.prototype.anythingChanged.call(this)},c.prototype.shouldObserverBeNotified=function(a,c){return Object.keys(c.ChangedIndexMap).length?!0:b.prototype.shouldObserverBeNotified.call(this,a,c)},c.prototype.createSnapshot=function(){this.snapshot=[];for(var a=this.Master.Model,b=0;b<a.length;++b)this.snapshot[b]=this.getSubSnapshot(a[b])},c.getSubSnapshotForLeafContent=function(a){return a},c.getSubSnapshotForMasterContent=function(b){return a.getMasterFromModel(b).getSnapshot()},c}(a.BranchChangeManager);a.CollectionChangeManager=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(b){function c(a,c,d){var e=b.call(this,a,c,d)||this;return e.updateMembersWithSourceData([]),e}return __extends(c,b),c.prototype.initializeSourceData=function(a){var b=this;this.updateMembersWithSourceData(a||[]),this.getProperties().forEach(function(a){var c=a.getDirtyChecker(),d=b.sourceData[b.getSourceIndexForProperty(a)];c.initializeSourceData(d)}),this.updateDirtinessForLength(this.Master.Model.length)},c.prototype.getDelta=function(){return Nerve.Debugger.todo("get delta for collection is not supported yet.")},c.prototype.getSnapshotToUpdate=function(){return this.getProperties().map(function(a){return a.getDirtyChecker()}).map(function(a){return a.getSnapshotToUpdate()})},c.prototype.getSourceData=function(){return a.FieldSchema.cloneSourceData(this.sourceData,this.Master.Schema)},c.prototype.setSourceData=function(a){this.setSourceDataInternal(a||[])},c.prototype.onSourceDataReceived=function(a){a=a||[],this.updateMembersWithSourceData(a),this.Master.Model.__nerve__.onSourceDataReceived(a),this.updateDirtinessForLength(this.Master.Model.length)},c.prototype.updateDirtinessForLength=function(a){this.setMemberDirtiness("length",a!==this.getSourceDataLength())},c.prototype.updateDirtinessForIndexChange=function(a){if(a.Deleted)this.setMemberDirtiness(a.Name,!1);else{var b=a.getDirtyChecker();b.setSourceData(this.sourceData[a.Index])}},c.prototype.getSourceDataLength=function(){return this.sourceData.length},c.prototype.setSourceDataInternal=function(b){var c=this;this.updateMembersWithSourceData(b),this.getProperties().forEach(function(b){var d=b.getDirtyChecker(),e=c.getSourceIndexForProperty(b);d.setSourceData(c.sourceData[e]),d instanceof a.BranchDirtyChecker&&(d.ExistingInSource=e<c.sourceData.length)}),this.updateDirtinessForLength(this.Master.Model.length)},c.prototype.getProperties=function(){return this.Master.Model.__nerve__.properties},c.prototype.updateMembersWithSourceData=function(a){var b=this;this.sourceData=a;var c=this.Master.Schema[0];c.__nerve__.withKey&&(this.sourceKeyIndexMap={},a.map(c.__nerve__.getKeyFromSourceData).forEach(function(a,c){a&&(b.sourceKeyIndexMap[a]=c)}))},c.prototype.getSourceIndexForProperty=function(a){var b=this.Master.Schema[0];return b.__nerve__.withKey?this.sourceKeyIndexMap[a.getKey()]:a.Index},c}(a.BranchDirtyChecker);a.CollectionDirtyChecker=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){function b(a,b,c,d){void 0===d&&(d=!0),o(a,b,{configurable:!1,enumerable:!!d,value:c,writable:!1})}function c(a,c,d){o(a,c,{configurable:!0,enumerable:!0,get:function(){var e=d();return delete a[c],b(a,c,e),e},set:function(){throw Error("Setting readonly field: "+c)}})}function d(a,b,c,d){d=d||function(){throw Error("Setting readonly field: "+b)},o(a,b,{configurable:!1,enumerable:!0,get:c,set:d})}function e(a,b){var c=a;for(var d in b)c[d]=b[d];return c}function f(a){return e({},a)}function g(a){Nerve.Debugger.assert(!Array.isArray(a),"array is not currently supported by readonly().");var c={};for(var d in a)b(c,d,a[d]);return c}function h(a,c){Nerve.Debugger.assert(c in a,"the field named "+c+" not been initialized yet."),b(a,c,a[c])}function i(a){return a?Array.prototype.slice.apply(a):[]}function j(a){return Array.isArray(a)?a:i(a)}function k(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];if(arguments.length){var d=$.Deferred();return d.resolve.apply(d,[a].concat(b)),d.promise()}return p}function l(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];if(arguments.length){var d=$.Deferred();return d.reject.apply(d,[a].concat(b)),d.promise()}return q}function m(a){return a.then(r,r)}function n(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];var c=$.Deferred(),d=a.length,e=[];return a.forEach(function(a,b){return a.done(function(a){return c.resolve(a)}).fail(function(a){e[b]=a,0===--d&&c.reject.apply(c,e)})}),c.promise()}function o(a,b,c){try{Object.defineProperty(a,b,c)}catch(d){var e=d&&d.message||"(no message)";Nerve.Debugger.throwError('Failed to set property "'+b+'": '+e)}}a.defineConstProperty=b,a.defineLazyProperty=c,a.defineProperty=d,a.extendObject=e,a.cloneObject=f,a.cloneAsReadonly=g,a.makePropertyReadonly=h,a.cloneCollectionAsArray=i,a.convertToArray=j;var p=$.Deferred().resolve().promise();a.getResolvedPromise=k;var q=$.Deferred().reject().promise();a.getRejectedPromise=l;var r=function(){return k()};a.always=m,a.anyoneResolved=n;var s=function(){function a(a,b){void 0===b&&(b=0),this.functionToCall=a,this.timeToWaitInMs=b}return a.prototype.callOnceLater=function(){var a=this;0!==this.timeToWaitInMs&&null!=this.handler&&this.clear(),null==this.handler&&(this.handler=setTimeout(function(){a.callImmediately()},this.timeToWaitInMs))},a.prototype.flush=function(){null!=this.handler&&(this.clear(),this.functionToCall())},a.prototype.callImmediately=function(){null!=this.handler&&this.clear(),this.functionToCall()},a.prototype.clear=function(){clearTimeout(this.handler),this.handler=void 0},a}();a.CallLater=s;var t=function(){function a(a){var b=this,c=$.Deferred();a.then(function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];b.canceled||c.resolve.apply(c,a)},function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];b.canceled||c.reject.apply(c,a)}),this.cancelablePromise=c.promise()}return a.prototype.promise=function(){return this.cancelablePromise},a.prototype.cancel=function(){this.canceled=!0},a}();a.Cancelable=t}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){function b(b,c,d){void 0===d&&(d=!1),a.defineConstProperty(b,"__nerve__",c,d)}var c=function(){function a(a){void 0===a&&(a={}),b(this,a)}return a}();a.NerveObject=c,a.defineNerveProperty=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){function b(b){return b instanceof a.ModelBase?b.__nerve__.master:void Nerve.Debugger.throwError("Invalid parameter: please use '<your master>.Model.*' for the parameter.")}function c(a){return d(a).__nerve__.masterName}function d(a){return a instanceof e?a.constructor:void Nerve.Debugger.throwError("the parameter is not a nerve master object.")}a.getMasterFromModel=b,a.getMasterName=c;var e=function(b){function c(c){var d=b.call(this)||this,e=d.__nerve__,g=c&&c.Reserved&&c.Reserved.Membership;g&&(e.membership=a.cloneAsReadonly(g),a.makePropertyReadonly(e,"membership"));var h=!1;return a.defineProperty(e,"deleted",function(){return h},function(a){if(!h&&a){h=!0,e.dirtyChecker.updateDirtiness();var b=e.changeManager;b.startBulkEditMode(),e.markChildrenAsDeleted(),b.markAsDeleted(),b.endBulkEditMode()}}),e.instanceId=(++f).toString(),a.makePropertyReadonly(e,"instanceId"),d}return __extends(c,b),Object.defineProperty(c.prototype,"Schema",{get:function(){return Nerve.Debugger.toBeOverridden()},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"Model",{get:function(){return this.__nerve__.model},set:function(a){this.setData(a,this.Schema.__nerve__.subFields.toArray())},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"Parent",{get:function(){var a=this.__nerve__.membership;return a&&a.Parent},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"Membership",{get:function(){var a=this.__nerve__.membership;return{Parent:a&&a.Parent,FieldSchema:a&&a.FieldSchema}},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"Deleted",{get:function(){return this.__nerve__.deleted},set:function(a){this.__nerve__.deleted=a},enumerable:!0,configurable:!0}),c.prototype.getInstanceId=function(){return this.__nerve__.instanceId},c.prototype.getSnapshot=function(a){return this.__nerve__.changeManager.getSnapshot(a)},c.prototype.bulkEdit=function(a){var b=this.__nerve__.changeManager;b&&b.startBulkEditMode();try{return a(this.Model)}finally{b&&b.endBulkEditMode()}},c.prototype.observe=function(a,b){return this.__nerve__.changeManager.observe(a,b)},c.prototype.unobserve=function(a,b){return this.__nerve__.changeManager.unobserve(a,b)},c.prototype.addRule=function(a){return this.__nerve__.changeManager.addRule(a)},c.prototype.removeRule=function(a){return this.__nerve__.changeManager.removeRule(a)},c}(a.NerveObject);a.MasterBase=e;var f=0}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){function b(a){var b=a;return!!b.__nerve__&&b.__nerve__.nerveObjectType===f}function c(a){return a instanceof g}function d(b,c){var d=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),Object.defineProperty(b,"Schema",{get:function(){return b.__nerve__.schema},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"Schema",{get:function(){return b.__nerve__.schema},enumerable:!0,configurable:!0}),b}(g);return a.defineNerveProperty(d,a.cloneAsReadonly({nerveObjectType:f,masterName:b}),!0),d.__nerve__.schema=a.FieldSchema.createRootFieldSchema(d,c),a.makePropertyReadonly(d.__nerve__,"schema"),d}function e(b){a.FieldSchema.isLeaf(b.Schema[0])||a.convertToArray(b.Model).map(a.getMasterFromModel).forEach(function(a){return a.Deleted=!0})}var f="collection master";a.isCollectionMasterClass=b,a.isCollectionMaster=c,a.createCollectionMasterClass=d;var g=function(b){function c(c){var d=this;c=c||{},d=b.call(this,c)||this;var f=d,g=d.__nerve__;g.markChildrenAsDeleted=function(){return e(f)},a.makePropertyReadonly(g,"markChildrenAsDeleted");var h=d.Schema.__nerve__,i=!h.withDataSource&&!h.info.Attributes.IsLocalField;return g.dirtyChecker=new a.CollectionDirtyChecker(f,c.ExistingInDataSource,i),a.makePropertyReadonly(g,"dirtyChecker"),g.model=new a.CollectionModel(f,c),a.makePropertyReadonly(g,"model"),g.changeManager=new a.CollectionChangeManager(f),a.makePropertyReadonly(g,"changeManager"),d}return __extends(c,b),c.prototype.addItems=function(a){return this.Model.__nerve__.addItems(a,!1).map(function(a){return a.getter()})},c.prototype.deleteItems=function(a){return this.Model.__nerve__.deleteItems(a,!1).map(function(a){return a.getter()})},c.prototype.itemsAddedInSource=function(a){return this.Model.__nerve__.addItems(a,!0).map(function(a){return a.getter()})},c.prototype.itemsDeletedInSource=function(a){return this.Model.__nerve__.deleteItems(a,!0).map(function(a){return a.getter()})},c.prototype.getItemWithKeyFields=function(a){var b=this.Schema[0].__nerve__.getKey(a),c=this.Model.__nerve__.keyToProperty[b];return c&&c.getter()},c.prototype.getIndexWithKeyFields=function(a){var b=this.Schema[0].__nerve__.getKey(a),c=this.Model.__nerve__.keyToProperty[b];return c?c.Index:-1},c.prototype.markAsChanged=function(a){var b=this.Model.__nerve__.properties[a];b&&this.__nerve__.changeManager.definitelyMarkAsChanged(b)},c.prototype.setComparer=function(a){this.Model.__nerve__.setComparer(a)},c.prototype.setData=function(b){this.Model.__nerve__.setData(a.convertToArray(b))},c}(a.MasterBase)}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.toJSON=function(){return this.__nerve__.master.getSnapshot()},b}(a.NerveObject);a.ModelBase=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){function b(a,b,e,f){var g=a.__nerve__.master,h=g.Schema[0],j=h.__nerve__.generateProperty,k=$.Deferred(),l=$.when(a.__nerve__.masterTreeReady,k.promise()),m=b.map(function(b){return j((++a.__nerve__.newestPropertyName).toString(),{InitialData:b,ExistingInDataSource:e,MasterTreeReady:l,Reserved:{Membership:{Parent:g,FieldSchema:h},ParentExistingInDataSource:f,Mounted:k}})});if(h.__nerve__.withKey){var n=a.__nerve__.keyToProperty;if(h.__nerve__.withDataSource){var o=h.__nerve__.keyFields.toArray();m.forEach(function(a){var b=a.Master;b.Synchronizer.ensureFieldsReady(o).done(function(){return c(n,a)})})}else m.forEach(function(a){return c(n,a)})}var p=a.__nerve__.properties,q=p.length;return g.bulkEdit(function(){p.push.apply(p,m),d(a);for(var b=q;b<p.length;++b)p[b].Index=b;g.__nerve__.dirtyChecker.updateDirtinessForLength(p.length);var c=a.__nerve__.propertyComparer;c&&i(a,c),k.resolve();var e=g.__nerve__.changeManager;e&&e.onPropertiesAdded(m)}),m}function c(b,c){var d=c.getKey();d in b&&Nerve.Debugger.throwError('duplicated key "'+d+'" at '+a.FieldSchema.getFieldPath(c.FieldSchema)+" is being added."),b[d]=c}function d(a){for(var b=a.__nerve__,c=b.properties.length;b.initializedLength<c;)e(a,b.initializedLength),++b.initializedLength}function e(b,c){a.defineProperty(b,c,function(){return this.__nerve__.properties[c].getter()},function(a){this.__nerve__.properties[c].setter(a)})}function f(a,b,c){var d=a.__nerve__.properties,e=d.filter(function(a){var c=a.getter();return b.some(function(a){return a===c})});return g(a,e,c),e}function g(a,b,c){var d=b.length;if(d>0){var e=a.__nerve__.properties,f=e.length,g=a.__nerve__.master;g.bulkEdit(function(){for(;d>0;--d){for(var i=b[d-1];--f>i.Index;)e[f].Index-=d;e.splice(f,1),i.markAsDeleted(c)}var j=g.Schema[0];if(j.__nerve__.withKey){var k=a.__nerve__.keyToProperty;if(j.__nerve__.withDataSource){var l=j.__nerve__.keyFields.toArray();b.forEach(function(a){var b=a.Master;b.Synchronizer.ensureFieldsReady(l).done(function(){return h(k,a)})})}else b.forEach(function(a){return h(k,a)})}g.__nerve__.dirtyChecker.updateDirtinessForLength(e.length),g.__nerve__.changeManager.onPropertiesRemoved(b)})}}function h(a,b){var c=b.getKey();b===a[c]&&delete a[c]}function i(a,b){b&&a.__nerve__.properties.sort(b);var c=a.__nerve__.master;c.bulkEdit(function(){a.__nerve__.properties.forEach(function(a,b){a.Index=b})})}function j(a,b){var c=a.__nerve__.master,d=a.__nerve__.master.Schema[0],e=a.__nerve__.properties,f={};b.map(d.__nerve__.getKey).forEach(function(a,b){return f[a]=b});var h={};e.forEach(function(a){return h[a.getKey()]=a});var j={};c.bulkEdit(function(){var c=[];for(var d in f){var e=f[d];if(d in h){var k=h[d];k.setter(b[e]),j[k.Name]=e,delete h[d]}else c.push(e)}var l=[];for(var d in h)l.push(h[d]);l.length&&(l.sort(function(a,b){return a.Index-b.Index}),g(a,l,!1)),c.length&&a.__nerve__.addItems(c.map(function(a){return b[a]}),!1).forEach(function(a,b){return j[a.Name]=c[b]});var m=function(a,b){return j[a.Name]-j[b.Name]},n=a.__nerve__.propertyComparer;n?i(a,function(a,b){return n(a,b)||m(a,b)}):i(a,m)})}function k(b,c){for(var d=b.__nerve__.master,e=(b.length,{}),f=a.convertToArray(b.__nerve__.master.getSnapshot()).slice(),h=[],j={},k=0;k<c.length;++k){var l=c[k],m=f.indexOf(l);0>m?h.push(l):(j[k]=m,f[m]=e)}for(var n=b.__nerve__.properties,o=[],k=0;k<f.length;++k)f[k]!==e&&o.push(n[k]);var p=n.slice();d.bulkEdit(function(){var a=b.__nerve__.addItems(h,!1);o.length&&(o.sort(function(a,b){return a.Index-b.Index}),g(b,o,!1)),Nerve.Debugger.assert(c.length===n.length,"All items should be updated into properties.");for(var d=0,e=0;e<c.length;++e)null==j[e]?n[e]=a[d++]:n[e]=p[j[e]];i(b,b.__nerve__.propertyComparer)})}function l(a,b){a.__nerve__.master.bulkEdit(function(){for(var c=a.length,d=Math.min(c,b.length),e=a.__nerve__.properties,f=0;d>f;++f)e[f].setter(b[f]);if(c<b.length)a.__nerve__.addItems(b.slice(a.length),!1);else if(c>b.length){var h=a.__nerve__.properties.slice(b.length);g(a,h,!1)}})}function m(b,c){var d=b.__nerve__.master;d.bulkEdit(function(){var e=d.Schema[0].__nerve__,f=b.__nerve__.keyToProperty,h={},j=[];c.map(e.getKeyFromSourceData).forEach(function(a,b){h[a]=b,a in f?f[a].getDirtyChecker().onSourceDataReceived(c[b]):j.push(c[b])});var k;k=e.withDataSource?function(a){var b=a.Master;return"resolved"===b.Synchronizer.existingInDataSource().state()&&!(a.getKey()in h)}:function(a){return!(a.getKey()in h)};var l=b.__nerve__.properties.filter(k);g(b,l,!0);var m=a.FieldSchema.convertFromSourceData(j,d.Schema);b.__nerve__.addItems(m,!0);var n=b.__nerve__.propertyComparer;n||(n=function(a,b){return h[a.getKey()]-h[b.getKey()]}),i(b,n)})}function n(b,c){var d=b.__nerve__.master;d.bulkEdit(function(){for(var e=b.length,f=Math.min(e,c.length),h=b.__nerve__.properties,i=0;f>i;++i)h[i].getDirtyChecker().onSourceDataReceived(c[i]);if(e<c.length){var j=c.slice(e),k=a.FieldSchema.convertFromSourceData(j,d.Schema);b.__nerve__.addItems(k,!0)}else if(e>c.length){var l=b.__nerve__.properties.slice(c.length);g(b,l,!0)}})}var o=function(c){function d(d,e){var g,h,o=this,p=d.Schema[0];p.__nerve__.withKey?(g=j,h=m):(g=p.__nerve__.info.IsLeaf?k:l,h=n);var q=e.Reserved&&e.Reserved.ParentExistingInDataSource;return o=c.call(this,{master:d,keyToProperty:p.__nerve__.withKey?{}:null,initializedLength:0,newestPropertyName:0,masterTreeReady:e.MasterTreeReady,properties:[],addItems:function(a,c){return b(o,a,c,q)},deleteItems:function(a,b){return f(o,a,b)},setData:function(a){return g(o,a)},onSourceDataReceived:function(a){return h(o,a)},setComparer:function(a){o.__nerve__.comparer=a,o.__nerve__.propertyComparer=a&&function(b,c){return a(b.getter(),c.getter())},a&&i(o,o.__nerve__.propertyComparer)}})||this,b(o,a.convertToArray(e.InitialData),e.ExistingInDataSource,q),o}return __extends(d,c),Object.defineProperty(d.prototype,"length",{get:function(){return this.__nerve__.properties.length},enumerable:!0,configurable:!0}),d}(a.ModelBase);a.CollectionModel=o}(NerveImplementation||(NerveImplementation={}));var Nerve;!function(a){var b;!function(a){function b(a,b){a||(console.assert(a,"Nerve - "+b),h("assert failed: "+b))}function c(a){return h("TODO: "+a)}function d(){return h("not implememented.")}function e(a,b){return b?b():void 0}function f(){
return h("to be overridden.")}function g(a){console.warn("Nerve - warning: "+a),i("warning: "+a)}function h(a){throw Error("Nerve - "+a)}function i(a){try{throw Error("NerveLog - "+a)}catch(b){OfficeForm.Event.ErrorEventDeprecated.logData({errorName:"ModelError",errorInfo:b.stack})}}a.assert=b,a.todo=c,a.notImplemented=d,a.fakeImplemented=e,a.toBeOverridden=f,a.warn=g,a.throwError=h}(b=a.Debugger||(a.Debugger={}))}(Nerve||(Nerve={}));var NerveImplementation;!function(a){var b=function(a){function b(b,c){var d=a.call(this,c)||this;return d.property=b,d}return __extends(b,a),b.prototype.isDirty=function(){return this.sourceData!==this.convertModelToSourceData()},b.prototype.initializeSourceData=function(a){this.setSourceData(a)},b.prototype.getDelta=function(){return this.convertModelToSourceData()},b.prototype.getSnapshotToUpdate=function(){return this.convertModelToSourceData()},b.prototype.getSourceData=function(){return this.sourceData},b.prototype.setSourceData=function(a){void 0===a&&(a=null),this.sourceData=a,this.updateDirtiness()},b.prototype.onSourceDataReceived=function(a){var b=this.isDirty();this.setSourceData(a),b||this.property.setter(this.convertFromSourceData(a))},b.prototype.getProperty=function(){return this.property},b.prototype.convertModelToSourceData=function(){return this.property.getter()},b.prototype.convertFromSourceData=function(a){return a},b}(a.DirtyChecker);a.LeafDirtyChecker=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.convertModelToSourceData=function(){return this.convert(this.getProperty().getter())},b.prototype.convertFromSourceData=function(a){return this.convert(a)},b.prototype.convert=function(a){if(null==a)return null;var b=this.getProperty().FieldSchema.__nerve__.enumType;return b[a]},b}(a.LeafDirtyChecker);a.EnumDirtyChecker=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b,c="FieldSchema";!function(b){function d(a){var b=a,d=b&&b.__nerve__;return d&&d.nerveObjectType===c}function e(a){if(!d(a))throw Error("Invalid parameter: please use '<your master [class]>.Schema.*' for the parameter.");return!0}function f(a){return e(a),a.__nerve__.info}function g(a){return e(a),a.__nerve__.subFields.toArray()}function h(a){return f(a).FieldId}function i(a){return f(a).Name}function j(a){return f(a).Path}function k(a){return u[a]}function l(c,d){if(b.isLeaf(d)){if(d.__nerve__.asEnum){var e=d.__nerve__.enumType;if(e&&"string"==typeof c&&c in e)return e[c]}return c}if(b.isCollection(d))return a.convertToArray(c).map(function(a){return l(a,d[0])});if(c){var f={},g=d.__nerve__.sourceNameToClientName;return Object.keys(c).forEach(function(a){if(a in g){var b=g[a],e=d[b];f[b]=l(c[a],e)}}),f}return null}function m(c,d){if(b.isLeaf(d)){if(d.__nerve__.asEnum){var e=d.__nerve__.enumType;if(e&&"number"==typeof c&&c in e)return e[c]}return c}if(b.isCollection(d))return a.convertToArray(c).map(function(a){return m(a,d[0])});if(c){var f={};return Object.keys(d).forEach(function(a){if(a in c){var b=d[a];if(!b.__nerve__.info.Attributes.IsLocalField){var e=b.__nerve__.sourceName;f[e]=m(c[a],b)}}}),f}return null}function n(c,d){if(b.isLeaf(d))return c;if(b.isCollection(d))return a.convertToArray(c).map(function(a){return n(a,d[0])});if(c){var e={},f=d.__nerve__.sourceNameToClientName;return Object.keys(c).forEach(function(a){if(a in f){var b=d[f[a]];e[a]=n(c[a],b)}}),e}return null}function o(b,c){var d=b.__nerve__.masterName,e={enumTypeGetter:null,getKeyForReferenceType:null,info:{Attributes:a.Spec.getAttributes(c),FieldId:r(),IsCollection:!(!a.Spec.isFieldSpec(c)||!c.__nerve__.isCollection),IsLeaf:!1,Name:d,Path:d},parentMasterClass:b,shadowParent:null,withDataSource:!!b.__nerve__.dataSourceFactory};e.info.IsCollection&&a.defineLazyProperty(e,"withDataSource",function(){return f[0].__nerve__.withDataSource});var f=p(e);return Object.keys(c).forEach(function(d){a.defineLazyProperty(f,d,s(b,d,c[d]))}),f}function p(b){var d={};return b.info=a.cloneAsReadonly(b.info),b.nerveObjectType=c,b.shadowParent=b.shadowParent||null,b.shadowRoot=b.shadowRoot||d,a.defineLazyProperty(b,"sourceFieldSet",function(){var c=b.subFields.toArray().filter(function(a){return!a.__nerve__.info.Attributes.IsLocalField});return new a.FieldSchemaSet(c)}),a.defineLazyProperty(b,"sourceName",function(){return b.info.Attributes.SourceFieldName||b.info.Name}),a.defineLazyProperty(b,"sourceNameToClientName",function(){var a={};return b.sourceFieldSet.toArray().forEach(function(b){a[b.__nerve__.sourceName]=b.__nerve__.info.Name}),Object.freeze(a)}),a.defineLazyProperty(b,"subFields",function(){var b=new a.FieldSchemaSet;return Object.keys(d).forEach(function(a){b.addFieldSchema(d[a])}),b}),a.defineLazyProperty(b,"allContainedFields",function(){var b=new a.FieldSchemaSet([d]);return Object.keys(d).forEach(function(a){var c=d[a];b.addFieldSchemas(c.__nerve__.allContainedFields)}),b}),a.defineLazyProperty(b,"asEnum",function(){return!!b.enumType&&!b.info.Attributes.IsNumberTypeInDataSource}),a.defineLazyProperty(b,"enumType",function(){return b.enumTypeGetter&&b.enumTypeGetter()}),b.info.IsLeaf?a.defineLazyProperty(b,"getKey",function(){return Nerve.Debugger.assert(b.getKeyForReferenceType,"getKey has been called but no keyGetter specified for "+b.info.Path),b.getKeyForReferenceType}):a.defineLazyProperty(b,"getKey",function(){var c=b.keyFields.toArray().map(i).sort();return Nerve.Debugger.assert(c.length>0,"getKey has been called but there's no key fields of "+b.info.Path),function(b){var d=c;if(b instanceof a.ObjectModel){var e=b.__nerve__.master;if(a.isObjectMasterWithDataSource(e)){var f=e;if(d=c.filter(function(a){return f.isFieldReady(a)}),!d.length)return void 0}}var g={};return d.forEach(function(a){return g[a]=b[a]}),JSON.stringify(g)}}),a.defineLazyProperty(b,"getKeyFromSourceData",function(){var a=b.keyFields.toArray(),c=b.sourceNameToClientName,d=a.map(function(a){return a.__nerve__.sourceName});return function(a){var e={};return d.forEach(function(b){var d=c[b];e[d]=a[b]}),b.getKey(e)}}),a.defineLazyProperty(b,"keyFields",function(){return new a.FieldSchemaSet(b.subFields.toArray().filter(function(a){return a.__nerve__.info.Attributes.IsKeyField}))}),b.info.IsLeaf?a.defineLazyProperty(b,"withKey",function(){return!!b.getKeyForReferenceType}):a.defineLazyProperty(b,"withKey",function(){return b.keyFields.Count>0}),a.defineNerveProperty(d,b),a.defineConstProperty(d,"toJSON",function(){return"[Nerve] FieldSchema: ("+b.info.Path+")>"},!1),b.info.IsCollection&&a.defineConstProperty(d,"length",1,!1),u[b.info.FieldId]=d,d}function q(a,b){return a+"/"+b}function r(){return(t++).toString()}function s(c,d,e){var f=r();return function(){var g,h=q(c.__nerve__.masterName,d);if(a.Spec.isFieldSpec(e)){if(e.__nerve__.isLeaf)return b.createLeaf(f,c,e,d,h);e.__nerve__.isCollection?g=a.createCollectionMasterClass(h,e):e.__nerve__.masterClassGetter&&(g=e.__nerve__.masterClassGetter())}g||(g=a.createObjectMasterClass(h,e));var i=a.Spec.getAttributes(e);return b.createWithSubmasterClass(f,c,g,d,h,i)}}b.isFieldSchema=d,b.assertFieldSchema=e,b.getFieldInfo=f,b.getSubFields=g,b.getFieldId=h,b.getFieldName=i,b.getFieldPath=j,b.getFieldSchemaById=k,b.convertFromSourceData=l,b.convertToSourceData=m,b.cloneSourceData=n,b.createRootFieldSchema=o,b.createFieldSchemaWithMembers=p,b.getPath=q,b.createFieldSchemaId=r;var t=1,u={}}(b=a.FieldSchema||(a.FieldSchema={}))}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b;!function(b){function c(a){return a.__nerve__.info.IsCollection}function d(c,d,h,i,j,k){var l=h.Schema,m=l.__nerve__,n=b.createFieldSchemaWithMembers({enumTypeGetter:m.enumTypeGetter,getKeyForReferenceType:m.getKeyForReferenceType,info:{Attributes:k,FieldId:c,IsCollection:m.info.IsCollection,IsLeaf:m.info.IsLeaf,Name:i,Path:j||i},parentMasterClass:d,parentSchema:d.__nerve__.schema,shadowParent:l,shadowRoot:l,subMasterClassGetter:function(){return h},withDataSource:m.withDataSource}),o={};return o[b.getFieldId(h.__nerve__.schema)]=n,n.__nerve__.generateProperty=e(n),a.makePropertyReadonly(n.__nerve__,"generateProperty"),n.__nerve__.shadowMapper=f(n,o),a.makePropertyReadonly(n.__nerve__,"shadowMapper"),g(n,h.Schema,o),n}function e(b){return function(c,d){return new a.PropertyAsBranch(c,b,d)}}function f(a,c){return function d(e){var f=b.getFieldId(e),g=c[f];if(!g){var h=e.__nerve__.parentSchema,i=void 0;i=b.isFieldSchema(h)?d(h):a,g=i[b.getFieldName(e)],Nerve.Debugger.assert(g===c[f],"the new shadow should be added into the shadow map.")}return g}}function g(b,c,d){Object.keys(c).forEach(function(e){a.defineLazyProperty(b,e,h(b,c,e,d))})}function h(a,c,d,e){return function(){var f=c[d],h=f.__nerve__,i=b.createFieldSchemaWithMembers({enumTypeGetter:h.enumTypeGetter,getKeyForReferenceType:h.getKeyForReferenceType,info:{Attributes:h.info.Attributes,FieldId:b.createFieldSchemaId(),IsCollection:h.info.IsCollection,IsLeaf:h.info.IsLeaf,Name:d,Path:b.getPath(a.__nerve__.info.Path,d)},parentSchema:a,parentMasterClass:a.__nerve__.parentMasterClass,shadowParent:f,shadowRoot:h.shadowRoot,subMasterClassGetter:h.subMasterClassGetter,withDataSource:h.withDataSource});return e[b.getFieldId(f)]=i,g(i,f,e),i}}b.isCollection=c,b.createWithSubmasterClass=d}(b=a.FieldSchema||(a.FieldSchema={}))}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b;!function(b){function c(a){return a.__nerve__.info.IsLeaf}function d(c,d,f,g,h){var i=b.createFieldSchemaWithMembers({enumTypeGetter:f.__nerve__.enumTypeGetter,getKeyForReferenceType:f.__nerve__.keyGetter,info:{Attributes:a.Spec.getAttributes(f),FieldId:c,IsLeaf:!0,IsCollection:!1,Name:g,Path:h||g},parentMasterClass:d,parentSchema:d.__nerve__.schema,withDataSource:!1});return i.__nerve__.generateProperty=e(i),a.makePropertyReadonly(i.__nerve__,"generateProperty"),i}function e(b){return b.__nerve__.asEnum?function(c,d){return new a.PropertyAsEnum(c,b,d)}:function(c,d){return new a.PropertyAsLeaf(c,b,d)}}b.isLeaf=c,b.createLeaf=d}(b=a.FieldSchema||(a.FieldSchema={}))}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(){function b(a){a instanceof b?this.setData(a.data):this.newData(a)}return Object.defineProperty(b.prototype,"Count",{get:function(){return this.data.fieldCount},enumerable:!0,configurable:!0}),b.prototype.has=function(b){return this.hasId(a.FieldSchema.getFieldId(b))},b.prototype.hasId=function(a){return!!this.data.map[a]},b.prototype.intersect=function(a){if(Array.isArray(a))return a.some(this.has.bind(this));var b=this,c=a;if(c.Count<b.Count){var d=b;b=c,c=d}for(var e in b.data.map)if(c.data.map[e])return!0;return!1},b.prototype.intersection=function(c){var d=this;if(Array.isArray(c))return new b(c.filter(function(b){return a.FieldSchema.isFieldSchema(b)&&d.has(b)}));if(c instanceof b){var e=this,f=c;if(f.Count<e.Count){var g=e;e=f,f=g}var h=new b;for(var i in e.data.map)f.hasId(i)&&h.addFieldSchema(a.FieldSchema.getFieldSchemaById(i));return h}return new b},b.prototype.toArray=function(){return Object.keys(this.data.map).map(a.FieldSchema.getFieldSchemaById)},b.prototype.clone=function(){return new b(this)},b.prototype.clear=function(){this.newData()},b.prototype.addFieldSchema=function(a){this.has(a)||(this.ensureDataOwnership(),this.internalAddFieldSchema(a))},b.prototype.addFieldSchemas=function(a){var c,d=this;if(c=a instanceof b?a.toArray():a,c=c.filter(function(a){return!d.has(a)}),c.length){this.ensureDataOwnership();this.internalAddFieldSchema.bind(this);c.forEach(function(a){return d.internalAddFieldSchema(a)})}},b.prototype.removeFieldSchema=function(a){this.has(a)&&(this.ensureDataOwnership(),this.internalRemoveFieldSchema(a))},b.prototype.removeFieldSchemas=function(a){var c,d=this;c=a instanceof b?a.toArray():a,c=c.filter(function(a){return d.has(a)}),c.length&&(this.ensureDataOwnership(),c.forEach(function(a){return d.internalRemoveFieldSchema(a)}))},b.prototype.ensureDataOwnership=function(){1!==this.data.referenceCount&&this.newData(this.toArray())},b.prototype.internalAddFieldSchema=function(b){var c=a.FieldSchema.getFieldId(b);this.data.map[c]||(this.data.map[c]=!0,++this.data.fieldCount)},b.prototype.internalRemoveFieldSchema=function(b){var c=a.FieldSchema.getFieldId(b);this.data.map[c]&&(delete this.data.map[c],--this.data.fieldCount)},b.prototype.newData=function(a){this.setData({map:{},fieldCount:0,referenceCount:0}),a&&this.addFieldSchemas(a)},b.prototype.setData=function(a){this.data&&--this.data.referenceCount,this.data=a,++this.data.referenceCount},b}();a.FieldSchemaSet=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.getSnapshot=function(c){var d=b.prototype.getSnapshot.call(this,c);if(!c)return d;var e={};return this.Master.Schema.__nerve__.subFields.intersection(c).toArray().map(a.FieldSchema.getFieldName).forEach(function(a){return e[a]=d[a]}),e},c.prototype.initializeSnapshot=function(){var b=this;this.snapshot={};var c=this.Master,d=c.Schema.__nerve__.subFields.toArray();if(a.isObjectMasterWithDataSource(c)){var e=c;d=d.filter(function(a){return e.isFieldReady(a)})}d.forEach(function(a){return b.refreshSubSnapshotWithFieldSchema(a)})},c.prototype.refreshSubSnapshot=function(a){this.refreshSubSnapshotWithFieldSchema(a.FieldSchema)},c.prototype.createSnapshotCache=function(){return Object.freeze(a.cloneObject(this.snapshot))},c.prototype.createChange=function(a){var c=b.prototype.createChange.call(this,a);return c.UpdateNeeded||(c.UpdateNeeded=a.toArray().some(function(a){return a.__nerve__.info.IsLeaf&&!a.__nerve__.info.Attributes.IsLocalField})),c.UpdateNeeded||(c.UpdateNeeded=c.SubChanges.filter(function(a){return a.UpdateNeeded}).some(function(b){var c=b.Master.Membership.FieldSchema;return a.has(c)&&!c.__nerve__.info.Attributes.IsLocalField})),c},c.prototype.removeUnchangedFields=function(b,c){var d=this,e=this.Master.Schema,f=b.toArray().filter(function(b){if(b.__nerve__.parentSchema===e&&a.FieldSchema.isLeaf(b)){var f=a.FieldSchema.getFieldName(b);return d.Master.Model[f]===c[f]}return!1});b.removeFieldSchemas(f)},c.prototype.refreshSubSnapshotWithFieldSchema=function(b){var c=a.FieldSchema.getFieldName(b),d=this.Master.Model[c];if(a.FieldSchema.isLeaf(b))this.snapshot[c]=d;else{var e=a.getMasterFromModel(d);this.snapshot[c]=e.getSnapshot()}},c}(a.BranchChangeManager);a.ObjectChangeManager=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.initializeSourceData=function(a){a=this.getNormalizedSourceData(a);var b=this.Master.Schema,c=this.Master.Model.__nerve__.properties;for(var d in c){var e=b[d].__nerve__.sourceName;c[d].getDirtyChecker().initializeSourceData(a[e])}},c.prototype.getDelta=function(){var a=this;if(!this.isDirty())return void 0;var b=this.Master.Schema,c=(this.Master.Model,{});return this.getDirtyKeys().sort().forEach(function(d){var e=b[d].__nerve__.sourceName;c[e]=a.getSubDirtyCheckerWithClientName(d).getSnapshotToUpdate()}),c},c.prototype.getSnapshotToUpdate=function(){var a={},b=this.Master.Schema,c=this.getSubDirtyCheckers();for(var d in c){var e=b[d].__nerve__.sourceName;a[e]=c[d].getSnapshotToUpdate()}return a},c.prototype.getSourceData=function(){var a={},b=this.Master.Schema,c=this.getSubDirtyCheckers();for(var d in c){var e=b[d].__nerve__.sourceName;a[e]=c[d].getSourceData()}return a},c.prototype.setSourceData=function(a){var b=this;a=this.getNormalizedSourceData(a),Object.keys(a).forEach(function(c){b.getSubDirtyCheckerWithSourceName(c).setSourceData(a[c])})},c.prototype.onSourceDataReceived=function(b){var c=this;b=this.getNormalizedSourceData(b);var d,e=this.Master;if(a.isObjectMasterWithDataSource(e)){d=$.Deferred();var f=this.Master.Schema,g=f.__nerve__.sourceNameToClientName,h=Object.keys(b).map(function(a){return g[a]}).filter(function(a){return a});e.Synchronizer.markFieldsAsReady(h,d.promise())}e.bulkEdit(function(){Object.keys(b).forEach(function(a){c.getSubDirtyCheckerWithSourceName(a).onSourceDataReceived(b[a])})}),d&&d.resolve()},c.prototype.getNormalizedSourceData=function(a){var b=this.Master.Schema.__nerve__.sourceNameToClientName,c={};return a?Object.keys(a).filter(function(a){return a in b}).forEach(function(b){return c[b]=a[b]}):Object.keys(b).forEach(function(a){return c[a]=null}),c},c.prototype.getSubDirtyCheckers=function(){var b=this.Master.Model.__nerve__.properties,c={};return this.Master.Schema.__nerve__.subFields.toArray().filter(function(a){return!a.__nerve__.info.Attributes.IsLocalField}).map(a.FieldSchema.getFieldName).forEach(function(a){return c[a]=b[a].getDirtyChecker()}),c},c.prototype.getSubDirtyCheckerWithClientName=function(a){var b=this.Master.Model.__nerve__.properties[a];return b.getDirtyChecker()},c.prototype.getSubDirtyCheckerWithSourceName=function(a){var b=this.Master.Schema.__nerve__.sourceNameToClientName[a];return this.getSubDirtyCheckerWithClientName(b)},c}(a.BranchDirtyChecker);a.ObjectDirtyChecker=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){function b(a){var b=a;return!!b.__nerve__&&b.__nerve__.nerveObjectType===j}function c(a){return a instanceof k}function d(a){var b=a,c=b.__nerve__;return!!c&&c.nerveObjectType===j&&!!c.dataSourceFactory}function e(a){return a instanceof l}function f(b,c,d){a.Spec.validateSpec(b,c);var e=d?l:k,f=function(a){function b(b,c){return a.call(this,b,c,d)||this}return __extends(b,a),Object.defineProperty(b,"Schema",{get:function(){return b.__nerve__.schema},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"Schema",{get:function(){return b.__nerve__.schema},enumerable:!0,configurable:!0}),b}(e);return a.defineNerveProperty(f,a.cloneAsReadonly({nerveObjectType:j,masterName:b,dataSourceFactory:d}),!0),f.__nerve__.schema=a.FieldSchema.createRootFieldSchema(f,c),a.makePropertyReadonly(f.__nerve__,"schema"),f}function g(b,c){return c.map(function(c){var d=b.Schema;if("string"==typeof c){var e=d[c];if(a.FieldSchema.isFieldSchema(e))return e}else if(a.FieldSchema.isFieldSchema(c))return h(b,c);Nerve.Debugger.throwError("field "+c+" doesn't exist in master "+a.getMasterName(b))})}function h(b,c){for(var d=b.Schema,e=[];c.__nerve__.shadowRoot!==d;){var f=a.FieldSchema.getFieldName(c);e.push(f),c=c.__nerve__.parentSchema,c||Nerve.Debugger.throwError("field schema ("+a.FieldSchema.getFieldPath(c)+") is not a member schema of master ("+a.getMasterName(b)+")")}for(var g=d;e.length;){var f=e.pop();g=g[f]}return g}function i(b){b.Schema.__nerve__.subFields.toArray().filter(function(b){return!a.FieldSchema.isLeaf(b)}).map(a.FieldSchema.getFieldName).map(function(a){return b.Model.__nerve__.properties[a]}).map(function(a){return a.Master}).forEach(function(a){return a.Deleted=!0})}var j="object master";a.isObjectMasterClass=b,a.isObjectMaster=c,a.isObjectMasterClassWithDataSource=d,a.isObjectMasterWithDataSource=e,a.createObjectMasterClass=f;var k=function(b){function c(c,d,e){var f=this;c=c||{},d=d||{},f=b.call(this,c)||this;var g=f.__nerve__;g.markChildrenAsDeleted=function(){return i(f)},a.makePropertyReadonly(g,"markChildrenAsDeleted");var h=$.Deferred(),j=$.when(d.MasterReady,h.promise()),k=!e&&g.membership&&!g.membership.FieldSchema.__nerve__.info.Attributes.IsLocalField;g.dirtyChecker=new a.ObjectDirtyChecker(f,c.ExistingInDataSource,k),a.makePropertyReadonly(g,"dirtyChecker");var l;if(e?(g.synchronizer=new a.ObjectSynchronizer(f,c,d,j,e),l=g.synchronizer.existingInDataSource()):(g.synchronizer=null,l=c.Reserved&&c.Reserved.ParentExistingInDataSource),a.makePropertyReadonly(g,"synchronizer"),g.model=new a.ObjectModel(f,c.InitialData||{},c.ExistingInDataSource,j,$.when(c.MasterTreeReady,j),l),a.makePropertyReadonly(g,"model"),g.changeManager=new a.ObjectChangeManager(f),a.makePropertyReadonly(g,"changeManager"),e){var m=c.ExistingInDataSource?c.InitialData:null,n=a.FieldSchema.convertToSourceData(m,f.Schema);g.dirtyChecker.initializeSourceData(n)}return h.resolve(),f}return __extends(c,b),c.prototype.setData=function(b,c){var d=this.Model;if(b!==d){b=b||{};var e;if(c)e=g(this,c);else{var f=this.Schema;e=Object.keys(b).map(function(a){return f[a]}).filter(function(a){return a})}var h=[];this.bulkEdit(function(){e.map(a.FieldSchema.getFieldName).forEach(function(a){a in d?d[a]=b[a]:h.push(a)})}),h.length&&Nerve.Debugger.warn("following field(s) not found in "+a.getMasterName(this)+": "+h)}},c.prototype.getModelByFieldSchema=function(b){var c=b;a.FieldSchema.assertFieldSchema(c),c=h(this,c);for(var d=this.Schema,e=[];c!==d;){if(e.push(c),c.__nerve__.info.IsCollection)throw Error("unable to get model/value from collection "+a.FieldSchema.getFieldPath(c)+".");c=c.__nerve__.parentSchema}var f=this.Model;do c=e.pop(),f=f[a.FieldSchema.getFieldName(c)];while(e.length);return f},c}(a.MasterBase),l=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),Object.defineProperty(b.prototype,"Synchronizer",{get:function(){return this.__nerve__.synchronizer},enumerable:!0,configurable:!0}),b.prototype.isFieldReady=function(a){return this.Synchronizer.isFieldReady(a)},b.prototype.ensureFieldsReady=function(a){return this.Synchronizer.ensureFieldsReady(a)},b.prototype.fieldsReady=function(a){return this.Synchronizer.fieldsReady(a)},b.prototype.getRelatedSourceFields=function(a){return a},b}(k);a.getTargetFieldSchemasOfObjectMaster=g}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){function b(b){return a.isObjectMasterWithDataSource(b)?function(c,d){var e=function(){if(!b.isFieldReady(d)){var c=a.FieldSchema.getFieldPath(d);Nerve.Debugger.throwError("The field ("+c+") not ready yet.")}};return{getter:function(){return e(),c.getter()},setter:function(a){e(),c.setter(a)}}}:function(a,b){return{getter:function(){return a.getter()},setter:function(b){return a.setter(b)}}}}var c=function(c){function d(d,e,f,g,h,i){var j=this,k={};j=c.call(this,{master:d,properties:k})||this;var l=b(d);return Object.keys(d.Schema).forEach(function(b){var c=d.Schema[b],m=c.__nerve__.generateProperty(b,{InitialData:e[b],ExistingInDataSource:f,MasterTreeReady:h,Reserved:{Membership:{FieldSchema:c,Parent:d},ParentExistingInDataSource:i,Mounted:g}});k[b]=m;var n=l(m,c);a.defineProperty(j,b,n.getter,n.setter)}),j}return __extends(d,c),d}(a.ModelBase);a.ObjectModel=c}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b;!function(b){function c(b,c){var d;return d=h(b)?a.cloneObject(b.__nerve__):k(),m(d,c),a.extendObject(l(d,c),b)}function d(a,b,c){var d=k();return d.isLeaf=!0,d.basicTypeName=a,d.keyGetter=c||null,m(d,b),l(d,b)}function e(a,b){var c=k();return c.isLeaf=!0,c.basicTypeName="enum",c.enumTypeGetter=a,m(c,b),l(c,b)}function f(b,c){var d=k();if(a.isObjectMasterClass(b))d.masterClassGetter=function(){return b};else{if(!(b instanceof Function))throw Error("The parameter of Spec.fromMasterClass should be a master class of a function.");d.masterClassGetter=b}return l(d,c)}function g(b,c){var d;d=h(b)?b:a.isObjectMasterClass(b)||b instanceof Function?f(b):b;var e=k();e.isCollection=!0;var g=l(e,c);return a.defineConstProperty(g,0,d),g}function h(a){var b=a;return b&&b.__nerve__&&b.__nerve__.nerveObjectType===p}function i(a,b){b?Object.keys(b).forEach(function(c){return n(a+c,b[c])}):o(a,"there's no spec passed")}function j(a){return h(a)?a.__nerve__.attributes:q}function k(){return{attributes:q,basicTypeName:null,enumTypeGetter:null,isCollection:!1,isLeaf:!1,keyGetter:null,masterClassGetter:null,nullable:!1,nerveObjectType:p}}function l(b,c){var d={};return m(b,c),a.defineNerveProperty(d,a.cloneAsReadonly(b)),d}function m(a,b){if(b=b||{},b.IsKeyField){switch(a.basicTypeName){case"boolean":case"string":case"number":break;default:Nerve.Debugger.throwError('"isKeyField" only supported for basic type fields')}b.IsLocalField&&Nerve.Debugger.throwError("a local field can't be key field.")}var c={IsSourceGenerated:!!b.IsSourceGenerated,IsExpandedField:!!b.IsExpandedField,IsKeyField:!!b.IsKeyField,IsLocalField:!!b.IsLocalField,IsNumberTypeInDataSource:!!b.IsNumberTypeInDataSource,SourceFieldName:b.SourceFieldName};a.attributes=Object.freeze(c)}function n(a,b){b?h(b)?b.__nerve__.isCollection&&n(a+"[0]",b[0]):i(a,b):o(a,"empty field spec")}function o(a,b){throw Error("Spec error of "+a+": "+b+".")}var p="Spec",q=Object.freeze({IsKeyField:!1,IsLocalField:!1,IsNumberTypeInDataSource:!1,IsSourceGenerated:!1});b.fromObject=c,b.createLeaf=d,b.createEnumeration=e,b.fromObjectMasterClass=f,b.collectionOf=g,b.isFieldSpec=h,b.validateSpec=i,b.getAttributes=j}(b=a.Spec||(a.Spec={}))}(NerveImplementation||(NerveImplementation={}));var Nerve;!function(a){function b(b){return function(c){for(var d=[],e=1;e<arguments.length;e++)d[e-1]=arguments[e];var f=a.getCollectionMasterFromModel(c),g=f[b];return g.apply(f,d)}}function c(a){return function(b,c){return f.createLeaf(a,b,c)}}a.convertToArray=NerveImplementation.convertToArray,NerveImplementation.makePropertyReadonly(a,"convertToArray"),a.getFieldSchemaInfo=NerveImplementation.FieldSchema.getFieldInfo,NerveImplementation.makePropertyReadonly(a,"getFieldSchemaInfo"),a.getSubFieldSchemas=NerveImplementation.FieldSchema.getSubFields,NerveImplementation.makePropertyReadonly(a,"getSubFieldSchemas"),a.convertFromSourceData=NerveImplementation.FieldSchema.convertFromSourceData,NerveImplementation.makePropertyReadonly(a,"convertFromSourceData"),a.convertToSourceData=NerveImplementation.FieldSchema.convertToSourceData,NerveImplementation.makePropertyReadonly(a,"convertToSourceData"),a.createObjectMasterClass=NerveImplementation.createObjectMasterClass,NerveImplementation.makePropertyReadonly(a,"createObjectMasterClass"),a.getObjectMasterFromModel=NerveImplementation.getMasterFromModel,NerveImplementation.makePropertyReadonly(a,"getObjectMasterFromModel"),a.getCollectionMasterFromModel=NerveImplementation.getMasterFromModel,NerveImplementation.makePropertyReadonly(a,"getCollectionMasterFromModel");var d={addItems:null,deleteItems:null,getIndexWithKeyFields:null,getItemWithKeyFields:null,itemsAddedInSource:null,itemsDeletedInSource:null,markAsChanged:null,setComparer:null};for(var e in d)d[e]=b(e);a.Collection=Object.freeze(d),NerveImplementation.makePropertyReadonly(a,"Collection");var f=NerveImplementation.Spec,g=(f.createLeaf("reference"),{create:f.fromObject,"boolean":c("boolean"),number:c("number"),string:c("string"),enumeration:f.createEnumeration,reference:c("reference"),collectionOf:f.collectionOf,fromMasterClass:f.fromObjectMasterClass});a.Spec=Object.freeze(g),NerveImplementation.makePropertyReadonly(a,"Spec")}(Nerve||(Nerve={}));var NerveImplementation;!function(a){var b=Nerve.Spec,c={InProcess:b["boolean"](),AllSucceeded:b["boolean"](),Scheduled:b["boolean"](),CreationError:b.reference(),CreationFailed:b["boolean"](),CreationInProcess:b["boolean"](),CreationScheduled:b["boolean"](),CreationRetryScheduled:b["boolean"](),QueryError:b.reference(),QueryFailed:b["boolean"](),QueryInProcess:b["boolean"](),UpdateError:b.reference(),UpdateFailed:b["boolean"](),UpdateInProcess:b["boolean"](),UpdateRetryScheduled:b["boolean"](),UpdateScheduled:b["boolean"]()},d=function(a){function b(){var b=a.call(this,{InitialData:{InProcess:!1,AllSucceeded:!0,Scheduled:!1,CreationError:null,CreationFailed:!1,CreationInProcess:!1,CreationRetryScheduled:!1,CreationScheduled:!1,QueryError:null,QueryFailed:!1,QueryInProcess:!1,UpdateError:null,UpdateFailed:!1,UpdateInProcess:!1,UpdateRetryScheduled:!1,UpdateScheduled:!1}})||this;return b.addRule(e),b.addRule(f),b.addRule(g),b}return __extends(b,a),b}(Nerve.createObjectMasterClass("Nerve.ObjectSynchronizerMaster",c));a.ObjectSynchronizerMaster=d;var e={Name:"InProcess",InterestedFields:[d.Schema.CreationInProcess,d.Schema.QueryInProcess,d.Schema.UpdateInProcess],onChange:function(a){var b=a.Master.Model;b.InProcess=b.CreationInProcess||b.QueryInProcess||b.UpdateInProcess}},f={Name:"AllSucceeded",InterestedFields:[d.Schema.CreationFailed,d.Schema.QueryFailed,d.Schema.UpdateFailed],onChange:function(a){var b=a.Master.Model;b.AllSucceeded=!(b.CreationFailed||b.QueryFailed||b.UpdateFailed)}},g={Name:"Scheduled",InterestedFields:[d.Schema.CreationScheduled,d.Schema.CreationRetryScheduled,d.Schema.UpdateScheduled,d.Schema.UpdateRetryScheduled],onChange:function(a){var b=a.Master.Model;b.Scheduled=b.CreationScheduled||b.CreationRetryScheduled||b.UpdateScheduled||b.UpdateRetryScheduled}}}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(b){function c(c,d,e,f,g){var h=b.call(this)||this;h.deletionJob=$.Deferred(),h.updateJob=$.Deferred(),h.fieldReadinesses={},h.fieldReadinesseDeferreds={},h.queryJobsPerField={},h.syncJobWithDataSource=$.Deferred().resolve().promise(),h.retryTimesForUpdate=0,h.dataReceivedDuringSync=[],h.master=c,h.scheduler=new a.SchedulerStabilizer(e.Scheduler),h.initializeUpdateJob();var i=d.Reserved&&d.Reserved.ParentExistingInDataSource;h.dataSourcePromise=$.when(d.MasterTreeReady,f,i).then(function(){return g(c,function(a){return h.onSourceDataReceived(a)},e.DataSourceContext)});var j=h.getReadyFieldNames(d);if(j.length){var k=$.Deferred().resolve();j.forEach(function(a){h.fieldReadinesses[a]=!0,h.fieldReadinesseDeferreds[a]=k})}f.done(function(){c.observe(function(a){a.UpdateNeeded&&h.checkForUpdate()})});var l=!d.ExistingInDataSource;return l?h.createWithDataSource():(h.creationJob=f,h.creationJob.done(function(){return h.checkForUpdate()})),h}return __extends(c,b),c.prototype.flush=function(){var a=this;return this.scheduler.flush(),this.creationJob.then(function(){return a.updateJob})},c.prototype.existingInDataSource=function(){return this.creationJob},c.prototype.deletedFromDataSource=function(){var b=this;return this.creationJob.then(function(){return b.deletionJob.promise()},function(){return a.getResolvedPromise()})},c.prototype.isFieldReady=function(b){b=this.master.getRelatedSourceFields([b])[0];var c=a.getTargetFieldSchemasOfObjectMaster(this.master,[b])[0],d=a.FieldSchema.getFieldName(c);return!!this.fieldReadinesses[d]},c.prototype.ensureFieldsReady=function(b){var c=this;b=this.master.getRelatedSourceFields(b);var d=a.getTargetFieldSchemasOfObjectMaster(this.master,b),e=d.filter(function(a){return!c.isFieldReady(a)});return e.length?this.creationJob.then(function(){var b=d.filter(function(a){return!c.isFieldReady(a)});return b.length?c.query(b):a.getResolvedPromise()}).then(function(){return c.getChangingPeriod()}):a.getResolvedPromise()},c.prototype.fieldsReady=function(b){var c=this;b=this.master.getRelatedSourceFields(b);var d=a.getTargetFieldSchemasOfObjectMaster(this.master,b),e=d.map(a.FieldSchema.getFieldName).map(function(a){return c.fieldReadinesseDeferreds[a]||(c.fieldReadinesseDeferreds[a]=$.Deferred()),c.fieldReadinesseDeferreds[a].promise()});return $.when.apply($,e).then(function(){return c.getChangingPeriod()})},c.prototype.query=function(b){var c=this;b=this.master.getRelatedSourceFields(b);var d=a.getTargetFieldSchemasOfObjectMaster(this.master,b);return this.creationJob.then(function(){var b=[],e=$.Deferred(),f=e.then(function(){return c.queryWithDataSource(b)}),g=[];return d.filter(function(a){return!a.__nerve__.info.Attributes.IsLocalField}).forEach(function(d){var e=a.FieldSchema.getFieldName(d),h=c.queryJobsPerField[e];h&&"pending"===h.state()||(c.queryJobsPerField[e]=f,b.push(d.__nerve__.sourceName)),g.push(c.queryJobsPerField[e])}),b.length?e.resolve():e.reject(),$.when.apply($,g)}).then(function(){return c.getChangingPeriod()})},c.prototype.onSourceDataReceived=function(b){
var c=this,d=a.FieldSchema.cloneSourceData(b,this.master.Schema);return this.dataReceivedDuringSync.push(d),this.syncJobWithDataSource.then(function(){return c.flushReceivedDataDuringSync()})},c.prototype.onDeletedInDataSource=function(){this.getDirtyChecker().ExistingInSource=!1,this.master.Deleted=!0},c.prototype.setFieldsQueryJob=function(b,c){var d=this,e=a.getTargetFieldSchemasOfObjectMaster(this.master,this.master.getRelatedSourceFields(b)).filter(function(a){return!a.__nerve__.info.Attributes.IsLocalField}),f=$.Deferred(),g=f.then(function(){return c}).then(function(a){var b={};return e.map(function(a){return a.__nerve__.sourceName}).forEach(function(c){return b[c]=a[c]}),d.onSourceDataReceived(b)});e.map(a.FieldSchema.getFieldName).forEach(function(b){var c=d.queryJobsPerField[b];c&&"pending"===c.state()?d.queryJobsPerField[b]=a.anyoneResolved(c,g):d.queryJobsPerField[b]=g}),f.resolve()},c.prototype.markFieldsAsReady=function(a,b){var c=this;a.forEach(function(a){return c.fieldReadinesses[a]=!0}),b.done(function(){var b=$.Deferred().resolve();a.forEach(function(a){c.fieldReadinesseDeferreds[a]?c.fieldReadinesseDeferreds[a].resolve():c.fieldReadinesseDeferreds[a]=b})})},c.prototype.initializeUpdateJob=function(){var a=this;this.updateJob=$.Deferred(),this.observe(function(){return a.changeUpdateJobState()},[this.Schema.UpdateError,this.Schema.UpdateFailed,this.Schema.UpdateInProcess,this.Schema.UpdateScheduled])},c.prototype.changeUpdateJobState=function(){var a=this.Model;a.UpdateScheduled||a.UpdateInProcess?"pending"!==this.updateJob.state()&&(this.updateJob=$.Deferred()):a.UpdateFailed?a.UpdateRetryScheduled||this.updateJob.reject(a.UpdateError):this.updateJob.resolve()},c.prototype.getReadyFieldNames=function(b){var c=this.master.Schema.__nerve__.subFields;if(b.ExistingInDataSource){var d=b.InitialData||{},e=[];return c.toArray().forEach(function(b){var c=a.FieldSchema.getFieldName(b);(b.__nerve__.info.Attributes.IsLocalField||c in d)&&e.push(c)}),e}return c.toArray().filter(function(a){return!a.__nerve__.info.Attributes.IsSourceGenerated}).map(a.FieldSchema.getFieldName)},c.prototype.checkForUpdate=function(){var a=this;this.getDirtyChecker().isDirty()?this.bulkEdit(function(){a.Model.UpdateScheduled=!0,$.when(a.creationJob,a.scheduler.scheduleUpdate()).done(function(){a.retryTimesForUpdate=0,a.update()})}):(this.scheduler.cancelUpdate(),this.Model.UpdateScheduled=!1)},c.prototype.update=function(){if(this.updating)return void(this.updatePended=!0);if(this.getDirtyChecker().isDirty()){if(this.onUpdateStart(),this.getDirtyChecker().isDirty())return this.master.__nerve__.deleted?this.deleteWithDataSource():this.updateWithDataSource();Nerve.Debugger.warn("onUpdateStart changes dirtiness."),this.onUpdateDone()}else this.onUpdateDone()},c.prototype.getDirtyChecker=function(){return this.master.__nerve__.dirtyChecker},c.prototype.createWithDataSource=function(){var a=this,b=$.Deferred();this.creationJob=b.promise();var c=this.master;this.bulkEdit(function(){a.Model.CreationScheduled=!0,a.dataSourcePromise.done(function(d){var e=function(){if(a.scheduler.cancelRetryForCreation(),c.__nerve__.deleted)return a.bulkEdit(function(){a.Model.CreationFailed=!1,a.Model.CreationInProcess=!1,a.Model.CreationRetryScheduled=!1,a.Model.CreationScheduled=!1});a.bulkEdit(function(){a.Model.CreationError=null,a.Model.CreationFailed=!1,a.Model.CreationInProcess=!0,a.Model.CreationRetryScheduled=!1,a.Model.CreationScheduled=!1});var g=a.getDirtyChecker(),h=g.getDelta()||{},i=g.getSnapshotToUpdate(),j=a.syncJobWithDataSource.then(function(){return d.add(h,{Master:c,Snapshot:i})}).then(function(d){c.bulkEdit(function(){g.ExistingInSource=!0,g.setSourceData(h),d&&a.onSourceDataReceivedInternal(d)}),a.bulkEdit(function(){a.Model.CreationInProcess=!1,a.checkForUpdate()}),b.resolve()}).fail(function(c){a.bulkEdit(function(){a.Model.CreationFailed=!0,a.Model.CreationError=c,a.Model.CreationInProcess=!1,a.Model.CreationRetryScheduled=!0,a.scheduler.retryForCreation(++f).done(e).fail(function(){a.Model.CreationRetryScheduled=!1,b.reject(c)})})});a.updateSyncJobWithDataSource(j)},f=0;e()})})},c.prototype.deleteWithDataSource=function(){var a=this,b=this.getDirtyChecker(),c=this.syncJobWithDataSource.then(function(){return a.dataSourcePromise}).then(function(c){var d=b.getSnapshotToUpdate();return c["delete"](d,{Master:a.master,Snapshot:d})}).then(function(){return b.ExistingInSource=!1});return this.updateSyncJobWithDataSource(c),c.done(function(){a.onUpdateDone(!1),a.deletionJob.resolve()}).fail(function(b){a.onUpdateFailed(b,!1,function(){a.deletionJob.reject(b)})})},c.prototype.queryWithDataSource=function(a){var b=this,c=this.syncJobWithDataSource.then(function(){return b.dataSourcePromise}).then(function(c){return b.bulkEdit(function(){b.Model.QueryError=null,b.Model.QueryInProcess=!0}),c.query(a,{Master:b.master,Snapshot:null})}).then(function(c){var d={};Object.keys(c).concat(a).forEach(function(a){return d[a]=c[a]}),b.onSourceDataReceivedInternal(d)});return this.updateSyncJobWithDataSource(c),c.done(function(){b.Model.QueryInProcess=!1}).fail(function(a){b.bulkEdit(function(){b.Model.QueryError=a,b.Model.QueryInProcess=!1})})},c.prototype.updateWithDataSource=function(){var a=this,b=this.getDirtyChecker(),c=b.getDelta(),d=b.getSnapshotToUpdate(),e=b.getSourceData();null==c&&Nerve.Debugger.warn("data is null when it's dirty.");var f=this.syncJobWithDataSource.then(function(){return a.dataSourcePromise}).then(function(b){return b.update(c,{Master:a.master,Snapshot:d,ValuesBefore:e})}).then(function(d){a.master.bulkEdit(function(){b.setSourceData(c),d&&a.onSourceDataReceivedInternal(d)})});return this.updateSyncJobWithDataSource(f),f.done(function(){return a.onUpdateDone(!0)}).fail(function(b){return a.onUpdateFailed(b,!0)})},c.prototype.onUpdateStart=function(){var a=this;this.updating=!0,this.updatePended=!1,this.scheduler.cancelRetryForUpdate(),this.bulkEdit(function(){a.Model.UpdateError=null,a.Model.UpdateFailed=!1,a.Model.UpdateInProcess=!0,a.Model.UpdateRetryScheduled=!1,a.Model.UpdateScheduled=!1})},c.prototype.onUpdateDone=function(a){var b=this;this.updating=!1,this.retryTimesForUpdate=0,this.scheduler.cancelRetryForUpdate(),this.bulkEdit(function(){b.Model.UpdateError=null,b.Model.UpdateFailed=!1,b.Model.UpdateInProcess=!1,b.Model.UpdateRetryScheduled=!1,b.Model.UpdateScheduled=!1,a&&(b.updatePended?b.update():b.checkForUpdate())})},c.prototype.onUpdateFailed=function(a,b,c){var d=this;return this.getDirtyChecker().isDirty()?(this.updating=!1,void this.bulkEdit(function(){d.Model.UpdateError=a,d.Model.UpdateFailed=!0,d.Model.UpdateInProcess=!1,d.Model.UpdateRetryScheduled=!0,d.Model.UpdateScheduled=!0,b&&d.updatePended?d.update():d.scheduler.retryForUpdate(++d.retryTimesForUpdate).done(function(){return d.update()}).fail(function(){d.bulkEdit(function(){d.Model.UpdateRetryScheduled=!1,d.Model.UpdateScheduled=!1}),c&&c()})})):void this.onUpdateDone()},c.prototype.onSourceDataReceivedInternal=function(b){var c=a.FieldSchema.cloneSourceData(b,this.master.Schema);this.getDirtyChecker().onSourceDataReceived(c)},c.prototype.updateSyncJobWithDataSource=function(b){var c=this;this.syncJobWithDataSource=a.always(b).then(function(){return c.flushReceivedDataDuringSync()})},c.prototype.flushReceivedDataDuringSync=function(){var a=this.getDirtyChecker(),b=this.dataReceivedDuringSync;this.dataReceivedDuringSync=[],this.master.bulkEdit(function(){b.forEach(function(b){return a.onSourceDataReceived(b)})})},c.prototype.getChangingPeriod=function(){return this.master.__nerve__.changeManager.getChangingPeriod()},c}(a.ObjectSynchronizerMaster);a.ObjectSynchronizer=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(){function a(a,b,c){var d=this;this.name=a,this.fieldSchema=b;var e=c.Reserved.Membership;this.parentMaster=e.Parent,e.Property=this,this.isMounted=!1,c.Reserved.Mounted.done(function(){return d.isMounted=!0})}return Object.defineProperty(a.prototype,"Name",{get:function(){return this.name},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"FieldSchema",{get:function(){return this.fieldSchema},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ParentMaster",{get:function(){return this.parentMaster},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Index",{get:function(){return this.index},set:function(a){if(a!==this.index){var b=this.index;this.index=a;var c=this.ParentMaster;this.indexDirtinessUpdateNeeded()&&c.__nerve__.dirtyChecker.updateDirtinessForIndexChange(this),this.Mounted&&c.__nerve__.changeManager.onPropertyIndexChange(this,b)}},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Mounted",{get:function(){return this.isMounted},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Deleted",{get:function(){return this.deleted},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ParentDirtyChecker",{get:function(){return this.ParentMaster.__nerve__.dirtyChecker},enumerable:!0,configurable:!0}),a.prototype.markAsDeleted=function(a){this.deleted=!0,this.Index=void 0},a.prototype.getKey=function(){return this.fieldSchema.__nerve__.getKey(this.getter())},a}();a.PropertyBase=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(a){function b(b,c,d){var e=a.call(this,b,c,d)||this,f=c.__nerve__.subMasterClassGetter();return e.master=new f(d),e}return __extends(b,a),Object.defineProperty(b.prototype,"Master",{get:function(){return this.master},enumerable:!0,configurable:!0}),b.prototype.getter=function(){return this.master.Model},b.prototype.setter=function(a){this.master.setData(a,this.master.Schema.__nerve__.subFields.toArray())},b.prototype.markAsDeleted=function(b){a.prototype.markAsDeleted.call(this,b),b&&(this.getDirtyChecker().ExistingInSource=!1),this.master.Deleted=!0},b.prototype.getDirtyChecker=function(){return this.master.__nerve__.dirtyChecker},b.prototype.indexDirtinessUpdateNeeded=function(){return!this.FieldSchema.__nerve__.withDataSource},b}(a.PropertyBase);a.PropertyAsBranch=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(b){function c(a,c,d){var e=b.call(this,a,c,d)||this;e.value=e.normalizeValue(d.InitialData);var f=!c.__nerve__.info.Attributes.IsLocalField;return e.dirtyChecker=e.createDirtyChecker(f),e}return __extends(c,b),c.prototype.getter=function(){return this.value},c.prototype.setter=function(a){if(a=this.normalizeValue(a),this.value!==a){this.value=a,this.dirtyChecker.updateDirtiness();var b=this.ParentMaster.__nerve__.changeManager;b.markSubSnapshotAsDirty([this]),b.markAsChanged(this)}},c.prototype.getDirtyChecker=function(){return this.dirtyChecker},c.prototype.normalizeValue=function(a){return null==a?null:a},c.prototype.createDirtyChecker=function(b){return new a.LeafDirtyChecker(this,b)},c.prototype.indexDirtinessUpdateNeeded=function(){return!0},c}(a.PropertyBase);a.PropertyAsLeaf=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.normalizeValue=function(a){var b=typeof a;if("string"===b||"number"===b){var c=this.FieldSchema.__nerve__.enumType;if(a in c)return"string"===b?c[a]:a}return null},c.prototype.createDirtyChecker=function(b){return new a.EnumDirtyChecker(this,b)},c}(a.PropertyAsLeaf);a.PropertyAsEnum=b}(NerveImplementation||(NerveImplementation={}));var NerveImplementation;!function(a){var b=function(){function b(a){a?(this.creationRetryStabilizer=new c({retry:a.retryForCreation&&a.retryForCreation.bind(a),cancel:a.cancelRetryForCreation&&a.cancelRetryForCreation.bind(a)}),this.updateRetryStabilizer=new c({retry:a.retryForUpdate&&a.retryForUpdate.bind(a),cancel:a.cancelRetryForUpdate&&a.cancelRetryForUpdate.bind(a)})):(this.creationRetryStabilizer=new c,this.updateRetryStabilizer=new c),this.scheduler=a||{}}return b.prototype.scheduleUpdate=function(){return this.outputUpdateScheduleDeferred?(this.scheduler.postponeUpdate&&this.scheduler.postponeUpdate(),this.outputUpdateScheduleDeferred.promise()):this.createUpdateSchedule()},b.prototype.postponeUpdate=function(){this.scheduler.postponeUpdate&&this.scheduler.postponeUpdate()},b.prototype.flush=function(){if(this.creationRetryStabilizer.flush(),this.updateRetryStabilizer.flush(),this.cancelableUpdateSchedule&&(this.cancelableUpdateSchedule.cancel(),this.cancelableUpdateSchedule=void 0,this.scheduler.cancelUpdate&&this.scheduler.cancelUpdate()),this.outputUpdateScheduleDeferred){var a=this.outputUpdateScheduleDeferred;this.outputUpdateScheduleDeferred=void 0,a.resolve()}},b.prototype.cancelUpdate=function(){this.outputUpdateScheduleDeferred&&(this.outputUpdateScheduleDeferred.reject(),this.scheduler.cancelUpdate&&this.scheduler.cancelUpdate())},b.prototype.retryForCreation=function(a){return this.creationRetryStabilizer.retry(a)},b.prototype.cancelRetryForCreation=function(){return this.creationRetryStabilizer.cancel()},b.prototype.retryForUpdate=function(a){return this.updateRetryStabilizer.retry(a)},b.prototype.cancelRetryForUpdate=function(){return this.updateRetryStabilizer.cancel()},b.prototype.createUpdateSchedule=function(){var b=this;this.outputUpdateScheduleDeferred||(this.outputUpdateScheduleDeferred=$.Deferred());var c,d=this.outputUpdateScheduleDeferred;return c=this.scheduler.scheduleUpdate?this.scheduler.scheduleUpdate():a.getResolvedPromise(),this.cancelableUpdateSchedule=new a.Cancelable(c),this.cancelableUpdateSchedule.promise().always(function(){b.outputUpdateScheduleDeferred=void 0,b.cancelableUpdateSchedule=void 0}).done(function(){return d.resolve()}).fail(function(){return d.reject()}),d.promise()},b}();a.SchedulerStabilizer=b;var c=function(){function b(a){this.scheduler=a||{}}return b.prototype.retry=function(b){var c=this;if(!this.scheduler.retry)return a.getRejectedPromise();this.cancel();var d=$.Deferred();return this.deferred=d,this.cancelable=new a.Cancelable(this.scheduler.retry(b)),this.cancelable.promise().always(function(){c.deferred=void 0,c.cancelable=void 0}).done(function(){return d.resolve()}).fail(function(){return d.reject()}),d.promise()},b.prototype.flush=function(){if(this.cancelable&&(this.cancelable.cancel(),this.cancelable=void 0,this.scheduler.cancel&&this.scheduler.cancel()),this.deferred){var a=this.deferred;this.deferred=void 0,a.resolve()}},b.prototype.cancel=function(){this.cancelable&&(this.cancelable.cancel(),this.deferred=void 0,this.cancelable=void 0,this.scheduler.cancel&&this.scheduler.cancel())},b}()}(NerveImplementation||(NerveImplementation={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(a){a[a.Aad=0]="Aad",a[a.Msa=1]="Msa"}(c=b.AuthProvider||(b.AuthProvider={}));var d=function(){function d(){return d._instance?d._instance:void(d._instance=this)}return d.getInstance=function(){return new d},d.prototype.redirectToSignIn=function(b){var c=encodeURIComponent(b||window.location.href),d=OfficeFormServerInfo.userInfo.IsMsa,e="Response"===a.EnvironmentConfig.getPageType(),f=OfficeFormServerInfo.signInLink;!d||e?f=a.Utilities.Html.updateUrlParam(f,"state",c):(f=OfficeFormServerInfo.signInLinkMsa,f=a.Utilities.Html.updateUrlParam(f,"redirecturl",c)),Forms.Common.replaceUrl(f)},d.prototype.redirectWithPatchedRedirectUrl=function(){var b=window.location.hash,c=a.Utilities.Html.getQueries().redirecturl;if(c&&-1===c.indexOf("#")&&b){window.location.hash="";var d=window.location.href;return d=a.Utilities.Html.updateUrlParam(d,"redirecturl",encodeURIComponent(c+b)),Forms.Common.redirectTo(d),!0}return!1},d.prototype.isUserLoggedIn=function(){return!!OfficeFormServerInfo.userInfo.UserId},d.prototype.isAuthTokenExpiredFailure=function(c){var e=c&&c.response&&c.response.statusCode;if(a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth)&&e===b.ErrorCode.HttpStatusCode.Unauthorized){if(c&&c.response&&"Expired"===c.response.headers["X-FailureReason"])return!0;var f=d.parseInnerCodeFromError(c);if(f===b.ErrorCode.InnerCode.TokenExpired)return!0}return!1},d.prototype.isAntiForgeryTokenValidationFailure=function(c){var e=c&&c.response&&c.response.statusCode;if(a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth)&&e===b.ErrorCode.HttpStatusCode.Forbidden){var f=d.parseInnerCodeFromError(c);if(f===b.ErrorCode.InnerCode.AntiForgeryTokenValidationError)return!0}return!1},d.prototype.refreshAuthToken=function(b,c){window.formsRefreshAuthTokenCallbacks||(window.formsRefreshAuthTokenCallbacks=[]);var e=function(a,d){!d&&a?b():c()};if(window.formsRefreshAuthTokenCallbacks.push(e),!window.formsRefreshAuthTokenCallback){var f=new a.Event.QosEventDeprecated(a.Event.QosEventNames.Auth.Auth.RefreshToken);f.start();var g=function(a,b){try{f.end({resultType:b?"ExpectedFailure":"Success",extraData:{loggedIn:a}}),$("#refreshAuthTokenFrame").remove();var c=window.formsRefreshAuthTokenCallbacks;if(b)c&&c.length>0&&c[0](a,b);else for(var d=0;d<c.length;++d)c[d](a,b)}finally{window.formsRefreshAuthTokenCallback=void 0,window.formsRefreshAuthTokenCallbacks=void 0}},h=!!a.Utilities.getCookie("AADState.forms");if(this.isUserLoggedIn()||h){var i=null;this.isUserLoggedIn()?i=OfficeFormServerInfo.userInfo.IsMsa?d.signInLinkSilentMsa:d.signInLinkSilent:h&&(a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.Auth.Auth.SilentSigninUsingAadState}),i=d.signInLinkSilent);var j=$("<iframe id='refreshAuthTokenFrame' style='display: none' src='"+i+"' />");j.on("load",null,null,function(a){window.setTimeout(function(){window.formsRefreshAuthTokenCallback&&window.formsRefreshAuthTokenCallback(!1,!0)},5e3)}),window.formsRefreshAuthTokenCallback=g,$(document.body).append(j)}else g(!1,!0)}},d.prototype.detectUserLoggedIn=function(){var b=this;return a.EnvironmentConfig.isOsi()?this.detectUserLoggedInWithProvider(c.Aad).then(function(a){return a?c.Aad:b.detectUserLoggedInWithProvider(c.Msa).then(function(a){return a?c.Msa:$.Deferred().reject().promise()})}):$.Deferred().reject().promise()},d.prototype.detectUserLoggedInWithProvider=function(b){var e="detect-user-loggedIn-frame",f=$.Deferred();if(window.formsDetectUserLoggedInCallback)f.reject();else{var g=b===c.Msa?a.Event.QosEventNames.Auth.Auth.DetectUserLoggedInMSA:a.Event.QosEventNames.Auth.Auth.DetectUserLoggedInAAD,h=new a.Event.QosEventDeprecated(g);h.start();var i=function(a,b){window.formsDetectUserLoggedInCallback=void 0,h.end({resultType:b?"ExpectedFailure":"Success"}),$("#"+e).remove(),f.resolve(a)},j=b===c.Msa?d.signInLinkSilentMsa:d.signInLinkSilent,k=$("<iframe id='"+e+"' style='display: none' src='"+j+"' />");k.on("load",null,null,function(a){window.setTimeout(function(){window.formsDetectUserLoggedInCallback&&window.formsDetectUserLoggedInCallback(!1,!0)},5e3)}),window.formsDetectUserLoggedInCallback=i,$(document.body).append(k)}return f.promise()},d.parseInnerCodeFromError=function(b){var c=b&&b.response&&a.Utilities.tryParseJson(b.response.body);return c.error&&parseInt(c.error.code)},d.signOutInIframe=function(){if(a.EnvironmentConfig.isOsi()){var b=new a.Event.QosEventDeprecated(a.Event.QosEventNames.Auth.Auth.SignOutInIframe);b.start();var c=$('<iframe style="display: none" src="'+OfficeFormServerInfo.signOutLink+'" />');c.on("load",null,null,function(a){b.end({resultType:"Success"})}),$(document.body).append(c)}},d.signInWithOtherAccount=function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.Error.ErrorPage.SignInWithOtherAccount}),a.EnvironmentConfig.isOsi()&&d.getInstance().detectUserLoggedInWithProvider(c.Msa).then(function(b){if(b)a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.Error.ErrorPage.SignOutInIframeInProgress}),Forms.Common.redirectTo(OfficeFormServerInfo.signOutLink);else{var c=window.location.origin+"#Login=True";Forms.Common.replaceUrl(c)}})},d.forceAadSignIn=function(){var b=window.location.href;b=a.Utilities.Html.updateUrlParam(b,a.EnvironmentSettings.AuthProviderParam,a.AuthProvider[a.AuthProvider.OrgId]),Forms.Common.replaceUrl(b)},d.signInLinkSilent=OfficeFormServerInfo.signInLinkSilent,d.signInLinkSilentMsa=OfficeFormServerInfo.signInLinkSilentMsa,d}();b.AuthTokenHelper=d}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){a[a.Succeeded=0]="Succeeded",a[a.Failed=1]="Failed"}(b=a.AsyncResultStatus||(a.AsyncResultStatus={}))}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){}(b=a.Exports||(a.Exports={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){a[a.BackSpace=8]="BackSpace",a[a.Tab=9]="Tab",a[a.Enter=13]="Enter",a[a.Shift=16]="Shift",a[a.Esc=27]="Esc",a[a.Space=32]="Space",a[a.End=35]="End",a[a.Home=36]="Home",a[a.ArrowLeft=37]="ArrowLeft",a[a.ArrowUp=38]="ArrowUp",a[a.ArrowRight=39]="ArrowRight",a[a.ArrowDown=40]="ArrowDown",a[a.Delete=46]="Delete",a[a.Eight=56]="Eight",a[a.PlaceHolder=229]="PlaceHolder"}(b=a.KeyCode||(a.KeyCode={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){a[a.Unauthorized=401]="Unauthorized",a[a.Forbidden=403]="Forbidden",a[a.NotFound=404]="NotFound"}(b=a.HttpStatusCode||(a.HttpStatusCode={}));var c;!function(a){a[a.UpdateFormFailed=609]="UpdateFormFailed",a[a.GetFormFailed=612]="GetFormFailed",a[a.CDBColumnNotFound=621]="CDBColumnNotFound",a[a.CDBTopLevelError=631]="CDBTopLevelError",a[a.ExceedMaximumFormLimition=650]="ExceedMaximumFormLimition",a[a.CDBTableNotFound=674]="CDBTableNotFound",a[a.TableReadOnly=636]="TableReadOnly",a[a.CDBTableMoved=639]="CDBTableMoved",a[a.NoPermission=700]="NoPermission",a[a.RequireLogin=701]="RequireLogin",a[a.UserNotAllowed=702]="UserNotAllowed",a[a.DisabledByTenantAdmin=703]="DisabledByTenantAdmin",a[a.AntiForgeryTokenValidationError=704]="AntiForgeryTokenValidationError",a[a.UserNeedMultiFactorAuth=705]="UserNeedMultiFactorAuth",a[a.CDBUnauthorizedAccess=707]="CDBUnauthorizedAccess",a[a.NotAllowedBySetting=708]="NotAllowedBySetting",a[a.TokenExpired=711]="TokenExpired",a[a.NotRolloutMsaUser=712]="NotRolloutMsaUser",a[a.CoAuthNotAllowedForMsa=715]="CoAuthNotAllowedForMsa",a[a.NotAllowedByResponseOwnership=716]="NotAllowedByResponseOwnership",a[a.FailedToCheckUserLicense=750]="FailedToCheckUserLicense",a[a.LicenseNotFound=751]="LicenseNotFound",a[a.LicenseNotValid=752]="LicenseNotValid",a[a.AbusedForm=6100]="AbusedForm",a[a.ImageNotFound=805]="ImageNotFound",a[a.InvalidFormId=1001]="InvalidFormId",a[a.NotSupportComposeFormId=1002]="NotSupportComposeFormId",a[a.ResponseNotFound=1007]="ResponseNotFound",a[a.FormClosed=5e3]="FormClosed",a[a.MultiResponseNotAllowed=5001]="MultiResponseNotAllowed",a[a.FormNotStarted=5002]="FormNotStarted",a[a.FormEnded=5003]="FormEnded",a[a.FormSettingJSONParseError=5004]="FormSettingJSONParseError",a[a.NoODPermissionForOpenInExcel=5117]="NoODPermissionForOpenInExcel",a[a.FailedToCreatePermission=5501]="FailedToCreatePermission",a[a.FailedToDeletePermission=5503]="FailedToDeletePermission",a[a.CreateInfoNotCompletePermission=5504]="CreateInfoNotCompletePermission",a[a.DeleteNotExistPermission=5506]="DeleteNotExistPermission",a[a.CopyNotAllowed=5550]="CopyNotAllowed",a[a.FailedToTurnOnAllowCopy=5551]="FailedToTurnOnAllowCopy",a[a.FailedToTurnOffAllowCopy=5552]="FailedToTurnOffAllowCopy",a[a.IncorrectShareToken=5553]="IncorrectShareToken",a[a.ImageUploadFailed=5200]="ImageUploadFailed",a[a.ImageTypeConvertFailed=5201]="ImageTypeConvertFailed",a[a.ImageProviderGetCDBTokenFailed=5202]="ImageProviderGetCDBTokenFailed",a[a.CdbServiceUnavailable=6503]="CdbServiceUnavailable",a[a.OriginalOwnerIsEmpty=6700]="OriginalOwnerIsEmpty",a[a.OriginalOwnerNotFound=6701]="OriginalOwnerNotFound",a[a.CurrentSignedUserIsNotDelegator=6702]="CurrentSignedUserIsNotDelegator",a[a.EmbedFormNeedAuth=10001]="EmbedFormNeedAuth",a[a.WorkBookLostFocus=10100]="WorkBookLostFocus",a[a.GetTableDataFailed=10101]="GetTableDataFailed",a[a.InvalidWorkBookSchema=10102]="InvalidWorkBookSchema",a[a.DeleteFormFailed=10201]="DeleteFormFailed",a[a.DeleteFormSuccessed=10202]="DeleteFormSuccessed",a[a.DownloadExcelFileFailed=10203]="DownloadExcelFileFailed",a[a.DownloadExcelFileFailedOnIos=10204]="DownloadExcelFileFailedOnIos",a[a.ReexportToExcelFailed=10205]="ReexportToExcelFailed",a[a.DownloadExcelFileTimeout=10206]="DownloadExcelFileTimeout",a[a.FormCreationFromQTIFailed=10300]="FormCreationFromQTIFailed",a[a.FormCreationFromQTITimeout=10301]="FormCreationFromQTITimeout",a[a.NetworkIssue=15001]="NetworkIssue",a[a.GetGraphAPITokenFailed=15002]="GetGraphAPITokenFailed",a[a.LoginNotSupportInCurrentBrowser=15003]="LoginNotSupportInCurrentBrowser"}(c=a.InnerCode||(a.InnerCode={}))}(b=a.ErrorCode||(a.ErrorCode={}))}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(b,c){if(!b&&!a.EnvironmentConfig.isProduction()&&!a.EnvironmentConfig.isProdAlternative()){var d=(new Error).stack;console.assert(b,c,d)}}function d(){return _.omit(L.getQueries(),"embed","oembedsso","themecolor","preview")}function e(){return!!L.getQueries().embed}function f(){return OfficeFormServerInfo.isOembedSPO}function g(){return!!L.getQueries().oembedsso&&!!L.getQueries().preview}function h(a){return void 0===a&&(a=!0),a&&(j()||i())?!0:!1}function i(){return a.EnvironmentSettings.IsTeamsIntegration&&a.EnvironmentConfig.isProduction()&&"Analyze"!==a.EnvironmentConfig.getPageType()?!0:!1}function j(){return a.EnvironmentSettings.IsAssignmentsIntegration}function k(a){return!!a}function l(){var a=navigator.userAgent.toLowerCase();return-1!==a.search("windows nt 10.")}function m(){var a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("msie")||-1!==a.indexOf("trident/")}function n(){var a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("edge/")}function o(){var a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("firefox/")}function p(){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))}function q(){return $(window).width()<=768}function r(){return/ip(hone|od|ad)/.test(navigator.userAgent.toLowerCase())&&!window.MSStream}function s(){var a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("mac os x")&&-1!==a.indexOf("version/9")&&-1!==a.indexOf("safari")}function t(){var a=navigator.userAgent;return!!a.match(/android/i)}function u(){var a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("tbs/")}function v(){var a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("micromessenger/")}function w(){var a,b;return a=document.createElement("div"),a.style.color="rgb(83,7,13)",document.body.appendChild(a),b=document.defaultView?document.defaultView.getComputedStyle(a,null).color:a.currentStyle.color,b=b.replace(/ /g,""),document.body.removeChild(a),"rgb(83,7,13)"!==b}function x(a){var b=_.clone(a);return _.each(b,function(a,c){_.isObject(a)&&(b[c]=x(a))}),b}function y(a){try{var b=JSON.parse(a);return b}catch(c){return a}}function z(a){return _.keys(a).filter($.isNumeric).map(function(a){return parseInt(a)})}function A(a){return _.keys(a).filter($.isNumeric).map(function(b){return a[b]})}function B(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];if(a=a.filter(function(a){return!!a}),!a.length)return $.Deferred().reject().promise();var c=$.Deferred(),d=a.length,e=function(a){0===--d&&c.reject(a)};return a.forEach(function(a){a.done(function(a){return c.resolve(a)}).fail(e)}),c.promise()}function C(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];var c=a.map(function(a){var b=$.Deferred();return a.then(function(a){return a?b.reject(!0).promise():b.resolve(!1).promise()},function(a){return b.resolve(!1).promise()})});return $.when.apply($,c).then(function(a){return $.Deferred().resolve(!1).promise()},function(a){return $.Deferred().resolve(!0).promise()})}function D(a,b,c){var d=new Date;d.setTime(d.getTime()+c);var e="expires="+d.toUTCString(),f="path=/";document.cookie=a+"="+b+"; "+e+"; "+f}function E(a){a+="=";var b=document.cookie.split(";").filter(function(b){return b.indexOf(a)>=0});if(b.length>0){var c=b[0].trim();return c.substring(a.length,c.length)}return null}function F(a){D(a,null,(new Date).getTime()-9999)}function G(a){for(var b=0,c=0;c<a.length;c++)b=a.charCodeAt(c)+((b<<5)-b);return b}function H(){return document&&document.body&&"rtl"===document.body.getAttribute("dir")}function I(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}a.Exports.Utilities=b;var J;!function(a){function b(a){return null===a?void 0:a}function c(a){return void 0===a?null:a}a.nullToUndefined=b,a.undefinedToNull=c}(J=b.Conversion||(b.Conversion={}));var K=function(){function a(){}return a.isLocalDateEqual=function(a,b){return a&&b?a.getFullYear()===b.getFullYear()&&a.getMonth()===b.getMonth()&&a.getDate()===b.getDate():void 0},a.compareLocalTime=function(a,b){if(a&&b){var c=1e3*(60*(60*a.getHours()+a.getMinutes())+a.getSeconds())+a.getMilliseconds(),d=1e3*(60*(60*b.getHours()+b.getMinutes())+b.getSeconds())+b.getMilliseconds();return c-d}return void 0},a.getTimeStamp=function(){return Date.now||(Date.now=function(){return(new Date).getTime()}),Math.floor(Date.now())},a}();b.DateTime=K;var L;!function(b){function c(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];var c=a.map(function(a){return a&&a.trim()}).filter(function(a){return!!a}).join(" ");return c||a.some(function(a){return""===a})||(c=void 0),c}function d(a){return f(a||window.location.search.substring(1))}function e(a){return f(a||window.location.hash.substring(1))}function f(a){var b={};return a&&a.trim().split("&").forEach(function(a){var c=a.split("="),d=c[0].trim();d&&(b[d]=decodeURIComponent(c[1]||"").trim())}),b}function g(a){var b=document.createElement("a");return b.href=a,b.href}function h(a){var b=document.createElement("a");return b.href=a,b.hostname}function i(a){
var b=document.createElement("a");return b.href=a,b.search}function j(a,b){var c=a.indexOf("#"),d=-1===c?"":a.substr(c);a=-1===c?a:a.substr(0,c);var e=a.indexOf("?"),g=-1===e?"":a.substr(e);a=-1===e?a:a.substr(0,e);var h={};return g&&(h=f(g.substr(1))),_.extend(h,b),a+"?"+$.param(h)+d}function k(a,b,c){var d=a.indexOf("#"),e=-1===d?"":a.substr(d);a=-1===d?a:a.substr(0,d);var f=new RegExp("([?&])"+b+"=.*?(&|$)","i"),g=-1!==a.indexOf("?")?"&":"?";return a=a.match(f)?a.replace(f,"$1"+b+"="+c+"$2"):a+g+b+"="+c,a+e}function l(a,b,c,d,e){d=d||0,c=c||0;var f=b.height(),g=a.outerHeight();if(a.offset()&&b.offset()){var h=a.offset().top-b.offset().top;if(0>h)return void b.scrollTop(b.scrollTop()+h-(g+c>f?0:c));var i=Math.min(g,f),j=h+i-f;f>g+c+d?(i=g+d,j=h+i-f):f>g+c&&(i=g+c,j=h-c),j>0&&(e?b.animate({scrollTop:b.scrollTop()+j},"fast"):b.scrollTop(b.scrollTop()+j))}}function m(a,b){void 0===b&&(b=!0);var c=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;");return b&&(c=c.replace(/'/g,"&apos;")),c}function n(a,b){var d=_.extend({},a);for(var e in b)switch(e){case"className":case"aria-labelledby":case"aria-describedby":d[e]=c(d[e],b[e]);break;case"children":case"defaultValue":case"value":null!=b[e]&&(null!=d[e]?d[e]=[].concat(d[e],b[e]):d[e]=b[e]);break;case"style":null!=d[e]?_.extend(d[e],b[e]):d[e]=b[e];break;case"onCopy":case"onCut":case"onPaste":case"onCompositionEnd":case"onCompositionStart":case"onCompositionUpdate":case"onFocus":case"onBlur":case"onChange":case"onInput":case"onSubmit":case"onLoad":case"onError":case"onKeyDown":case"onKeyPress":case"onKeyUp":case"onAbort":case"onCanPlay":case"onCanPlayThrough":case"onDurationChange":case"onEmptied":case"onEncrypted":case"onEnded":case"onLoadedData":case"onLoadedMetadata":case"onLoadStart":case"onPause":case"onPlay":case"onPlaying":case"onProgress":case"onRateChange":case"onSeeked":case"onSeeking":case"onStalled":case"onSuspend":case"onTimeUpdate":case"onVolumeChange":case"onWaiting":case"onClick":case"onContextMenu":case"onDoubleClick":case"onDrag":case"onDragEnd":case"onDragEnter":case"onDragExit":case"onDragLeave":case"onDragOver":case"onDragStart":case"onDrop":case"onMouseDown":case"onMouseEnter":case"onMouseLeave":case"onMouseMove":case"onMouseOut":case"onMouseOver":case"onMouseUp":case"onSelect":case"onTouchCancel":case"onTouchEnd":case"onTouchMove":case"onTouchStart":case"onScroll":case"onWheel":d[e]=o(d[e],b[e]);break;default:void 0!==b[e]&&(d[e]=b[e])}return d}function o(a,b){return function(c){a&&a(c),b&&b(c)}}function p(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];return function(c){(0===b.length||b.indexOf(c.keyCode)>=0)&&a(c)}}function q(a){var b=a.nativeEvent.explicitOriginalTarget;return a.relatedTarget||b||document.activeElement}function r(){return window.innerWidth}function s(b,c,d,e){if(a.EnvironmentSettings.IsTeamsIntegration){var f=$("<a></a>");return f.attr("href",b),c||(c="_blank"),f.attr("target",c),f[0].click(),f.remove(),null}return c||d||e?d||e?e?window.open(b,c,d,e):window.open(b,c,d):window.open(b,c):window.open(b)}function t(a){var b="hiddeon-open-iframe",c=document.getElementById(b);c&&c.parentNode.removeChild(c),c=document.createElement("iframe"),c.id=b,c.name=b,c.hidden=!0,document.body.appendChild(c),c.contentWindow.location.href=a}function u(a){var b=v(a);return w(b)}function v(a){var b=["b"],c=_.map(b,function(a){return"<"+a+">"}),d=_.map(b,function(a){return"</"+a+">"}),e=_.map(b,function(a){return"&lt;"+a+"&gt;"}),f=_.map(b,function(a){return"&lt;/"+a+"&gt;"}),g=_.escape(a);return b.forEach(function(a,b){g=g.replaceAll(e[b],c[b]).replaceAll(f[b],d[b])}),g}function w(a){var b=document.createElement("span");return b.innerHTML=a,a=b.innerHTML}b.combineAttributes=c,b.getQueries=d,b.getHashes=e,b.getAbsoluteUrl=g,b.getHostName=h,b.getSearchString=i,b.updateUrlParams=j,b.updateUrlParam=k,b.scrollToShowSubelement=l,b.encodeHTML=m,b.mergeReactProps=n,b.wrapReactEvent=o,b.onKeyboardEvent=p,b.getTargetElementOfFocusEvent=q,b.getWindowWidth=r,b.safeOpen=s,b.hiddenOpen=t,b.sanitize=u}(L=b.Html||(b.Html={}));var M;!function(a){function b(a){return k.test(a)&&l.test(a)}function c(){return e()}function d(a){var b=/[0-9a-fA-F]*/g,c=a.match(b),d="";return _.map(c,function(a){return d+=a}),!a||/^[0-]*$/.test(a)}function e(){var a=f();return h(a)}function f(){var a=[g()+g(),g(),g(),g(),g()+g()+g()];return a.join("-")}function g(){var a=Math.floor(65536*Math.random()).toString(16);return j(a,4,"0")}function h(a){var b=parseInt(a.charAt(19),16);b=3&b|8;var c=b.toString(16);return a=i(a,14,"4"),a=i(a,19,c)}function i(a,b,c){return a.substring(0,b)+c+a.substring(b+1)}function j(a,b,c){for(var d=a.length,e=c.length;b>d;d+=e)a=c+a;return a}var k=/^[0-9a-fA-F\-]*$/,l=/^[^\-]{8}(\-[^\-]{4}){4}[^\-]{8}$/;a.isValidGuid=b,a.newGuid=c,a.isNullOrEmpty=d}(M=b.Guid||(b.Guid={}));var N;!function(a){function b(a){var b=(a||"").trim().replace(/[,]/g,"");return $.isNumeric(b)}function c(a){var b=(a||"").trim().replace(/[,]/g,"");return $.isNumeric(b)?parseFloat(b).toString():""}function d(a){return Math.floor(a)===a}a.isFormatedAsFloat=b,a.formatAsFloat=c,a.isInteger=d}(N=b.NumberValidation||(b.NumberValidation={}));var O;!function(a){function b(a){return/^(https ?\:\/\/)?((www\.)?youtube\.com|youtu\.?be)\/.+$/.test(a)}a.isYouTubeUrl=b}(O=b.UrlValidation||(b.UrlValidation={}));var P;!function(a){var b=function(){function a(a,b){void 0===b&&(b=0),this.functionToCall=a,this.timeToWaitInMs=b}return a.prototype.callOnceLater=function(){var a=this;0!==this.timeToWaitInMs&&null!=this.handler&&this.clear(),null==this.handler&&(this.handler=setTimeout(function(){a.callImmediately()},this.timeToWaitInMs))},a.prototype.flush=function(){null!=this.handler&&(this.clear(),this.functionToCall())},a.prototype.callImmediately=function(){null!=this.handler&&this.clear(),this.functionToCall()},a.prototype.clear=function(){clearTimeout(this.handler),this.handler=void 0},a}();a.CallLater=b;var c=function(){function a(){this.callbacks=[]}return a.prototype.register=function(a){this.callbacks.push(a)},a.prototype.unregister=function(a){this.callbacks=_.without(this.callbacks,a)},a.prototype.trigger=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this.callbacks.forEach(function(b){return b.apply(void 0,a)})},a.prototype.clear=function(){this.callbacks=[]},a}();a.CallbackManager=c;var d=function(){function a(){this.buffer=[]}return a.prototype.setFunctionToCall=function(a){var b=this;if(this.functionToCall!==a)if(this.functionToCall=a,a){var c=this.buffer;delete this.buffer,c&&c.length&&c.forEach(function(a){return b.functionToCall.apply(void 0,a)})}else this.buffer=this.buffer||[]},Object.defineProperty(a.prototype,"queue",{get:function(){return this.functionToCall?this.functionToCall:this.defaultQueue},enumerable:!0,configurable:!0}),a.prototype.defaultQueue=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this.buffer.push(a)},a}();a.BufferForCall=d;var e=function(){function a(a){this.queue=[],this.jobCountLeft=a}return a.prototype.queueJob=function(a){a&&(this.queue.push(a),this.tryProcessQueuedJob())},a.prototype.stopProcessingNewJob=function(){this.jobCountLeft=-(1/0)},a.prototype.tryProcessQueuedJob=function(){for(var a=this;this.jobCountLeft>0&&this.queue.length;){--this.jobCountLeft;var b=this.queue.shift();b().always(function(){++a.jobCountLeft,a.tryProcessQueuedJob()})}},a}();a.Pool=e}(P=b.Process||(b.Process={}));var Q;!function(a){function b(a){var b=$.Deferred();return b.reject(a).promise()}function c(a){var b=$.Deferred();return b.resolve(a).promise()}function d(a){return a?a.then(null,function(){return c()}):c()}function e(a){var b=$.Deferred();return a.then(function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];return b.resolve.apply(b,a)})["catch"](function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];return b.reject.apply(b,a)}),b.promise()}a.getRejectedPromise=b,a.getResolvedPromise=c,a.always=d,a.fromJavaScriptPromise=e;var f=function(){function a(){}return Object.defineProperty(a,"Pending",{get:function(){return"pending"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Resolved",{get:function(){return"resolved"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Rejected",{get:function(){return"rejected"},enumerable:!0,configurable:!0}),a}();a.State=f}(Q=b.Promise||(b.Promise={}));var R;!function(c){function d(){return _.pick(L.getQueries(),["d"])}function e(){return p("debug")}function f(){return p("d")}function g(){return f()&&!a.EnvironmentConfig.isProduction()}function h(){return p("msa")}function i(){return p("oembedssotrial")&&a.EnvironmentConfig.isProduction()||p("oembedsso")}function j(){return f()&&!a.EnvironmentConfig.isProduction()}function k(){return p("standalone")&&!a.EnvironmentConfig.isProduction()}function l(){if(p("pptcontentsso")){var c=b.Html.getQueries().hostplatform;if("PC"===c&&a.Flighting.Flight.isEnabled(a.Flighting.Flights.PPTWin32ContentAddinSSO))return!0;if("OfficeOnline"===c&&a.Flighting.Flight.isEnabled(a.Flighting.Flights.PPTContentAddinSSO))return!0}return!1}function m(){return p("pptintegration")}function n(){return p("runtimeautorefresh")}function o(){return p("streamsso")}function p(a,b){void 0===b&&(b=!1);var c=L.getQueries()[a];return""===c?!0:c?(Array.isArray(c)&&(c=c[0]),b?"false"!==c.toLowerCase():"true"===c.toLowerCase()):b}c.getFlightQuery=d,c.isDebugMode=e,c.isDarkFunctionalitiesEnabled=f,c.isIvyChartEnabled=g,c.isMsaLoginEnabled=h,c.isOembedTrialSSOEnabled=i,c.isDebugOpenExcelInOneDrive=j,c.isStandalone=k,c.isPPTContentAddinSSOEnabled=l,c.isPPTIntegration=m,c.isRuntimePageAutoRefreshEnabled=n,c.isStreamSSOEnabled=o}(R=b.Flight||(b.Flight={}));var S;!function(a){function b(a){return"number"==typeof a}function c(a){return"string"==typeof a}a.isNumber=b,a.isString=c}(S=b.Type||(b.Type={}));var T;!function(a){function c(){if(OfficeFormServerInfo.isOembedSPO&&$(".office-form.office-form-theme-shadow").height()&&$(".office-form-footer-container").height()){var b=$(".office-form.office-form-theme-shadow").height()+$(".office-form-footer-container").height()+j;b+=$(".office-form-new-bottom-bar").height()?$(".office-form-new-bottom-bar").height():0;var c="ResponsePage";a.nofityPageHeightToParentWindow(c,b)}}function d(){if(OfficeFormServerInfo.isOembedSPO&&$(".analysis-page-content").height()){var b=$(".analysis-page-content").height()+i,c="AnalysisPage";a.nofityPageHeightToParentWindow(c,b)}}function e(b){OfficeFormServerInfo.isOembedSPO&&a.nofityPageHeightToParentWindow("ResponsePage",b)}function f(a,c){var d=b.Html.getQueries().hostId;if(d)parent.postMessage("FormsPageHeight:"+d+":"+c.toString(),"*");else{var e=b.Html.getQueries().id;parent.postMessage(a+"Height:"+e+":"+c.toString(),"*")}}function g(a){if(OfficeFormServerInfo.isOembedSPO){var c=a.Model.Title?a.Model.Title:"",d=a.Model.Description?a.Model.Description:"",e=b.Html.getQueries().hostId;parent.postMessage("FormsInfo:"+e+":"+encodeURIComponent(c)+":"+encodeURIComponent(d),"*")}}function h(a){if(OfficeFormServerInfo.isOembedSPO){var c=a&&(a.innerCode||a.message||""),d=b.Html.getQueries().hostId;parent.postMessage("FormsError:"+d+":"+encodeURIComponent(c),"*")}}var i=50,j=80;a.notifyResponsePageHeightToParentWindow=c,a.notifyAnalysisPageHeightToParentWindow=d,a.notifyResponsePageFixedHeightToParentWindow=e,a.nofityPageHeightToParentWindow=f,a.notifyFormInfoToParentWindow=g,a.notifyFormErrorToParentWindow=h}(T=b.OEmbed||(b.OEmbed={})),b.assert=c,b.getNonEmbedQuery=d,b.isOEmbed=e,b.isOEmbedSPO=f,b.isOEmbedSPOPreview=g,b.enterSSO=h,b.applyTeamSSO=i,b.applyAssignmentsSSO=j,b.isPhishingForm=k,b.isWin10=l,b.isIE=m,b.isEdge=n,b.isFireFox=o,b.isMobile=p,b.isSmallScreen=q,b.isIOS=r,b.isSafari9=s,b.isAndroid=t,b.isTbsBrowser=u,b.isMicroMessenger=v,b.isHighContrastMode=w,b.deepClone=x,b.tryParseJson=y,b.getAllEnumValues=z,b.getAllEnumValueNames=A,b.some=B,b.anyTrue=C,b.setCookie=D,b.getCookie=E,b.clearCookie=F,b.hashCode=G,b.isRtl=H;var U;!function(a){a.mathSeparator=""}(U=b.MathHelper||(b.MathHelper={}));var V;!function(a){a.waitingForExport="WaitingForExport"}(V=b.ExcelHelper||(b.ExcelHelper={})),b.regExpEscape=I}(b=a.Utilities||(a.Utilities={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function b(){}return b.setLogHandler=function(a){this.buffer.setFunctionToCall(a)},b.logData=function(b){a.Flighting.Flight.isEnabled(a.Flighting.Flights.UseRefactoredTelemetry)?Forms.Telemetry.log({eventName:b.errorName,eventType:"engagement_event",extraData:b.errorInfo}):this.buffer.queue(b)},b.buffer=new a.Utilities.Process.BufferForCall,b}();b.ErrorEventDeprecated=c}(b=a.Event||(a.Event={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(a){a[a.Start=0]="Start",a[a.End=1]="End",a[a.Log=2]="Log"}(c=b.QosEventType||(b.QosEventType={}));var d=function(){function b(b){this.qos=null,this.event={Name:b,Duration:0,CorrelationId:a.Utilities.Guid.newGuid(),Data:{}},a.Flighting.Flight.isEnabled(a.Flighting.Flights.UseRefactoredTelemetry)&&(this.qos=new Forms.Telemetry.QosEvent(b))}return b.setLogHandler=function(a){this.buffer.setFunctionToCall(a)},Object.defineProperty(b.prototype,"Name",{get:function(){return this.event.Name},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"Duration",{get:function(){return this.event.Duration},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"CorrelationId",{get:function(){return a.Flighting.Flight.isEnabled(a.Flighting.Flights.UseRefactoredTelemetry)?this.qos.CorrelationId:this.event.CorrelationId},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"Data",{get:function(){return this.event.Data},enumerable:!0,configurable:!0}),b.prototype.start=function(){this.startTime=a.Utilities.DateTime.getTimeStamp(),a.Flighting.Flight.isEnabled(a.Flighting.Flights.UseRefactoredTelemetry)?(this.qos.ExtraData=this.Data.extraData,this.qos.start()):b.buffer.queue(this.event,c.Start)},b.prototype.end=function(d){var e=this.prepareEvent(d);a.Flighting.Flight.isEnabled(a.Flighting.Flights.UseRefactoredTelemetry)?this.qos.end({resultCode:e.Data.resultCode,resultType:e.Data.resultType,logLevel:"Info",extraData:e.Data.extraData}):b.buffer.queue(e,c.End)},b.prototype.log=function(d){var e=this.prepareEvent(d);a.Flighting.Flight.isEnabled(a.Flighting.Flights.UseRefactoredTelemetry)?this.qos.log({resultCode:e.Data.resultCode,resultType:e.Data.resultType,logLevel:"Info",extraData:e.Data.extraData}):b.buffer.queue(e,c.Log)},b.prototype.prepareEvent=function(b){var c=_.clone(this.event);return _.extend(c.Data,b),null!=this.startTime?c.Duration=a.Utilities.DateTime.getTimeStamp()-this.startTime:c.Duration=-1,c},b.buffer=new a.Utilities.Process.BufferForCall,b}();b.QosEventDeprecated=d}(b=a.Event||(a.Event={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c;!function(a){var b=function(){function a(){}return a.AcquireToken="Auth.AcquireToken",a.DetectUserLoggedInAAD="Auth.DetectUserLoggedInAAD",a.GetToken="Auth.GetToken",a.RefreshToken="Auth.RefreshToken",a.DetectUserLoggedInMSA="Auth.DetectUserLoggedInMSA",a.SignOutInIframe="Auth.SignOutInIframe",a}();a.Auth=b}(c=b.Auth||(b.Auth={}));var d;!function(a){var b=function(){function a(){}return a.DataSync="AddinPage.SyncView.DataSync",a}();a.SyncView=b}(d=b.AddinPage||(b.AddinPage={}));var e;!function(a){var b=function(){function a(){}return a.InsertPoll="OutlookCreatePollPage.TaskPaneView.InsertPoll",a}();a.TaskPaneView=b}(e=b.OutlookCreatePollPage||(b.OutlookCreatePollPage={}));var f;!function(a){var b=function(){function a(){}return a.CreateExportFile="Action.CreateExportFile",a.CreateRespTable="Action.CreateRespTable",a.GetRespTable="Action.GetRespTable",a.OpenExcelInOneDrive="Action.OpenExcelInOneDrive",a.GetXlWorkbookId="Action.GetXlWorkbookId",a}();a.Action=b;var c=function(){function a(){}return a.ConnectToForms="Connection.ConnectToFormsSignalR",a.ConnectToCDB="Connection.ConnectToCDBSignalR",a.InvokeMethod="Connection.InvokeRemoteMethod",a}();a.Connection=c;var d=function(){function a(){}return a.BrowseImage="Decomposition.BrowseImage",a.SearchImage="Decomposition.SearchImage",a.GetCdbToken="Decomposition.GetCdbToken",a.GetOD4BToken="Decomposition.GetOD4BToken",a}();a.Decomposition=d;var e=function(){function a(){}return a.DuplicateFormForExcel="Excel.DuplicateFormForExcel",a}();a.Excel=e;var f=function(){function a(){}return a.GetGroups="Groups.Get",a.GetPhotoDefinition="Group.GetPhotoDefinition",a.GetPhotoValue="Group.GetPhotoValue",a.GetGroup="Group.Get",a.GetOwners="Group.GetOwners",a.GetMembers="Group.GetMembers",a.GetMemberPhotoDefinition="Group.GetMemberPhotoDefinition",a.GetMemberPhotoValue="Group.GetMemberPhotoValue",a}();a.Group=f;var g=function(){function a(){}return a.TurnOnFormSharing="FormDefinition.TurnOnFormSharing",a.TurnOffFormSharing="FormDefinition.TurnOffFormSharing",a.CreateForm="Form.Create",a.CreateImageFromUrl="FormImage.CreateFromUrl",a.DeleteForm="Form.Delete",a.GetForms="Forms.Get",a.SearchServerForms="Forms.SearchServer",a.SoftDeleted="Form.Updata.SoftDeleted",a.GetSharedWithMeForms="Forms.Get.SharedWithMe",a.GetDesignForm="DesignForm.Get",a.GetFormDefinition="FormDefinition.Get",a.GetRuntimeForm="ResponseForm.Get",a.GetRuntimeForm2="ResponseForm2.Get",a.GetAnalysisForm="AnalysisForm.Get",a.GetSharedForm="SharedForm.Get",a.SetFormDefinition="FormDefinition.Set",a.UpdateForm="Form.Update",a.CreateFormPermissionLink="FormDefinition.CreateFormPermissionLink",a.DeleteFormPermissionLink="FormDefinition.DeleteFormPermissionLink",a.GetFormPermissions="FormDefinition.GetFormPermissions",a.CreateFormPermissionToken="FormDefinition.CreateFormPermissionToken",a.DeleteFormPermissionToken="FormDefinition.DeleteFormPermissionToken",a.GetFormPermissionsToken="FormDefinition.GetFormPermissionsToken",a.CreateThemeImageFromUrl="ThemeImage.CreateFromUrl",a.GetIdentityProviderType="Form.GetIdentityProviderType",a.GetGroupId="Form.GetGroupId",a.GetTeamsInfo="Form.GetTeamsInfo",a.GetOrCreatePermissionToken="Form.GetOrCreatePermissionToken",a.GetInsights="Form.GetInsights",a.CreateOD4BSessionTempFolder="Form.CreateOD4BSessionTempFolder",a.PostShareAction="Form.PostShareAction",a}();a.Form=g;var h=function(){function a(){}return a.GetFormId="Function.GetFormId",a.GetUserInfo="Function.GetUserInfo",a.GetShellServiceInfo="Function.GetShellServiceInfo",a.GetConsumerShellServiceInfo="Function.GetConsumerShellServiceInfo",a.GetYouTubeVideoInfo="Function.GetYouTubeVideoInfo",a.DownloadExcelFileApi="Function.DownloadExcelFileApi",a.GetFormsTenantSettings="Function.GetFormsTenantSettings",a.GetRecentForms="Function.GetRecentForms",a.RemoveRecentForm="Function.RemoveRecentForm",a.MoveForm="Function.MoveForm",a.GetFormCreatorPhotoDefinition="Function.GetFormCreatorPhotoDefinition",a.GetFormCreatorPhotoValue="Function.GetFormCreatorPhotoValue",a.GetCurrentUserPhotoValue="Function.GetCurrentUserPhotoValue",a.GetMuid="Function.GetMuid",a.IsMemberOf="Function.IsMemberOf",a.GetPrivacySettings="Function.GetPrivacy",a}();a.Function=h;var i=function(){function a(){}return a.DeleteImage="Image.Delete",a.UploadImage="Image.Upload",a}();a.Image=i;var j=function(){function a(){}return a.SendMail="MSGraph.SendMail",a}();a.MSGraph=j;var k=function(){function a(){}return a.CreateFormFromQti="Qti.CreateForm",a}();a.Qti=k;var l=function(){function a(){}return a.CreateImageFromUrl="QuestionImage.CreateFromUrl",a.CreateQuestion="Question.Create",a.DeleteQuestion="Question.Delete",a.GetQuestion="Question.Get",a.GetQuestionCount="QuestionCount.Get",a.GetQuestions="Questions.Get",a.UpdateQuestion="Question.Update",a.TextAnalysis="Question.TextAnalysis",a.MathCalculation="Question.MathCalculation",a.MathQuestionGeneration="Question.MathQuestionGeneration",a}();a.Question=l;var m=function(){function a(){}return a.Create="DescriptiveElement.Create",a.Delete="DescriptiveElement.Delete",a.Get="DescriptiveElement.Get",a.Update="DescriptiveElements.Update",a}();a.DescriptiveElement=m;var n=function(){function a(){}return a.CreateChoice="Choice.Create",a.GetChoice="Choice.Get",a.UpdateChoice="Choice.Update",a.DeleteChoice="Choice.Delete",a}();a.Choice=n;var o=function(){function a(){}return a.DeleteResp="Response.Delete",a.DeleteResps="Responses.Delete",a.GetRespCount="ResponseCount.Get",a.GetResps="Responses.Get",a.GetRuntimeResps="RuntimeResponses.Get",a.GetRuntimeResponse="RuntimeResponse.Get",a.GetAnalysisTimeResponses="AnalysisTimeResponses.Get",a.GetRespFilter="Responses.Get.Filter",a.SubmitAnswer="Answer.Submit",a.SubmitResp="Response.Submit",a.AddComment="Comment.Add",a.SetReleaseDate="Response.Update",a}();a.Response=o;var p=function(){function a(){}return a.ReportAbuse="OnlineSafety.ReportAbuse",a}();a.OnlineSafety=p;var q=function(){function a(){}return a.AggregateSurveyData="Analysis.AggregateSurveyData",a.ResultSharingAggregateSurveyData="Analysis.ResultSharingAggregateSurveyData",a.AggregateQuizData="Analysis.AggregateQuizData",a.ResultSharingAggregateQuizData="Analysis.ResultSharingAggregateQuizData",a}();a.Analysis=q;var r=function(){function a(){}return a.MethodNameFormat="PageMethod.{0}",a}();a.PageMethod=r;var s=function(){function a(){}return a.GetUserSettings="UserSettings.Get",a.UpdateUserSettings="UserSettings.Update",a}();a.UserSettings=s;var t=function(){function a(){}return a.GetAllLocales="Locale.GetAll",a.GetLocale="Locale.Get",a.DeleteLocale="Locale.Delete",a.CreateLocaleItem="LocaleItem.Create",a.UpdateLocaleItem="LocaleItem.Update",a}();a.Multilingual=t}(f=b.ServiceEndpoints||(b.ServiceEndpoints={}));var g=function(){function a(){}return a.NPSLoad="OfficeNPS.load",a}();b.OfficeNPS=g,a.Exports.QosEventNames=b}(c=b.QosEventNames||(b.QosEventNames={}))}(b=a.Event||(a.Event={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b=function(){function a(){}return Object.defineProperty(a,"DefaultStorage",{get:function(){return a.defaultStorage||(a.defaultStorage=a.LocalStorage,a.defaultStorage instanceof c&&(a.defaultStorage=a.SessionStorage)),a.defaultStorage},enumerable:!0,configurable:!0}),Object.defineProperty(a,"LocalStorage",{get:function(){return a.localStorage||(a.supportsLocalStorage()?a.localStorage=window.localStorage:a.localStorage=a.NoStorage),a.localStorage},enumerable:!0,configurable:!0}),Object.defineProperty(a,"SessionStorage",{get:function(){return a.sessionStorage||(a.supportsSessionStorage()?a.sessionStorage=window.sessionStorage:a.sessionStorage=a.NoStorage),a.sessionStorage},enumerable:!0,configurable:!0}),Object.defineProperty(a,"NoStorage",{get:function(){return a.noStorage||(a.noStorage=new c),a.noStorage},enumerable:!0,configurable:!0}),a.supportsLocalStorage=function(){if(null==a.localStorageSupported)try{var b="officeforms.__storage_test__";localStorage.setItem(b,b),localStorage.removeItem(b),a.localStorageSupported=!0}catch(c){a.localStorageSupported=!1}return a.localStorageSupported},a.supportsSessionStorage=function(){if(null==a.sessionStorageSupported)try{var b="officeforms.__storage_test__";sessionStorage.setItem(b,b),sessionStorage.removeItem(b),a.sessionStorageSupported=!0}catch(c){a.sessionStorageSupported=!1}return a.sessionStorageSupported},a}();a.SafeStorage=b,a.Exports.SafeStorage=b;var c=function(){function a(){}return a.prototype.clear=function(){},a.prototype.getItem=function(a){},a.prototype.key=function(a){return null},a.prototype.removeItem=function(a){},a.prototype.setItem=function(a,b){},a}()}(OfficeForm||(OfficeForm={})),String.prototype.format||(String.prototype.format=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return this.replace(/{(\d+)}/g,function(b,c){return void 0!==a[c]?a[c]:b})}),String.prototype.trimEnd=function(a){for(var b=this,c=b.length;--c>=0&&!(a.indexOf(b.charAt(c))<0););return b.substr(0,c+1)},String.prototype.startsWith=function(a){if(null==a||0===a.length)return!0;var b=this;return null==b||b.length<a.length?!1:a===b.substr(0,a.length)},String.prototype.replaceAll=function(a,b){return this.replace(new RegExp(escapeRegExp(a),"g"),b)},"name"in Function.prototype||Object.defineProperty(Function.prototype,"name",{get:function(){var a=/function\s([^(]{1,})\(/,b=a.exec(this.toString());return b&&b.length>1?b[1].trim():""}});var stringDelimiter=/('[^']*'|"[^"]*")/g,dateLabelsRegExp=/('[^']*'|"[^"]*"|d{1,2}|M{1,2}|y{2,4}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|t{2})/g;Date.prototype.toFormatString=function(a,b){var c=this;if(null==c||null==a||null==b)return null;var d=a.split(dateLabelsRegExp).map(function(a){switch(a){case"d":case"dd":return formatNumber(c.getDate(),a.length);case"ddd":return b.DateTimeFormat.AbbreviatedDayNames[c.getDay()];case"M":case"MM":return formatNumber(c.getMonth()+1,a.length);case"MMM":return b.DateTimeFormat.AbbreviatedMonthNames[c.getMonth()];case"yy":var d=c.getFullYear(),e=formatNumber(d,4);return d>b.Calendar.TwoDigitYearMax-100&&d<=b.Calendar.TwoDigitYearMax?e.slice(2):e;case"yyy":case"yyyy":case"yyyyy":return formatNumber(c.getFullYear(),a.length);case"H":case"HH":return formatNumber(c.getHours(),a.length);case"h":case"hh":return formatNumber((c.getHours()+11)%12+1,a.length);case"m":case"mm":return formatNumber(c.getMinutes(),a.length);case"s":case"ss":return formatNumber(c.getSeconds(),a.length);case"t":case"tt":var f=c.getHours()<12?b.DateTimeFormat.AMDesignator:b.DateTimeFormat.PMDesignator;return 1===a.length?f.charAt(0):f;default:return removeQuatos(a)}}).join("");return d},Date.prototype.toDateShortString=function(a){var b=this;return b.toFormatString(a.DateTimeFormat.ShortDatePattern,a)},Date.prototype.toTimeShortString=function(a){var b=this;return b.toFormatString(a.DateTimeFormat.ShortTimePattern,a)},Date.parseDate=function(a,b,c){var d=parseStringToDateLabels(a,b,c),e=parseInt(d.yyyy||d.yyy),f=parseInt(d.yy);if(isNaN(e)&&!isNaN(f))if(f>=100)e=f;else{var g=OfficeFormServerInfo.cultureInfo.Calendar.TwoDigitYearMax%100;e=g>=f?OfficeFormServerInfo.cultureInfo.Calendar.TwoDigitYearMax-g+f:OfficeFormServerInfo.cultureInfo.Calendar.TwoDigitYearMax-g-100+f}var h=parseInt(d.MM||d.M),i=d.MMM;isNaN(h)&&i&&(h=c.DateTimeFormat.AbbreviatedMonthNames.indexOf(i)+1);var j=parseInt(d.dd||d.d),k=getTime(d,c);if(!(isNaN(e)||isNaN(h)||isNaN(j)||isNaN(k))){var l=new Date(e,h-1,j,0,0,0,k);if(l.getFullYear()===e&&l.getMonth()+1===h&&l.getDate()===j)return l}return null},Date.parseTime=function(a,b,c){var d=parseStringToDateLabels(a,b,c);return d.time=!0,getTime(d,c)};var OfficeForm;!function(a){var b=function(){function b(){}return b.getEnvironmentType=function(){if(null==b.currentEnvironmentType){var a=b.getHostUrl(),c=OfficeFormServerInfo.deployment.toLocaleLowerCase();c.indexOf("usgovdodproduction")>=0?b.currentEnvironmentType="USDoDProd":c.indexOf("usgovproduction")>=0?b.currentEnvironmentType="USGovProd":c.indexOf("usgovgccproduction")>=0?b.currentEnvironmentType="USGovGccProd":a.indexOf("forms.office.com")>=0||a.indexOf("forms.osi.office.net")>=0?b.currentEnvironmentType="WWProd":a.indexOf("forms.officeppe.com")>=0?b.currentEnvironmentType="EDog":a.indexOf("forms.office-int.com")>=0||a.indexOf("forms.osi.office-int.net")>=0?b.currentEnvironmentType="Int":a.indexOf("formweekly")>=0?b.currentEnvironmentType="Weekly":a.indexOf("formhotfix")>=0?b.currentEnvironmentType="Hotfix":a.indexOf("formdaily")>=0?b.currentEnvironmentType="Daily":a.indexOf("formpilot")>=0?b.currentEnvironmentType="Pilot":a.indexOf("formtrial")>=0?b.currentEnvironmentType="Trial":a.indexOf("formdrill")>=0?b.currentEnvironmentType="Drill":a.indexOf("localhost")>=0&&(b.currentEnvironmentType="DevHost")}return b.currentEnvironmentType},b.getMuidHost=function(){switch(b.getEnvironmentType()){case"WWProd":return"https://c.office.com";case"EDog":return"https://c.officeppe.com";case"Int":return"https://c.office-int.com";default:return null}},b.getPageType=function(){var a=window.location.pathname.toLowerCase();switch(a){case"/pages/designpage.aspx":case"/pages/teamsdesignpage.aspx":case"/pages/onenoteaddinpage.aspx":case"/pages/delegatepage.aspx":return"Design";case"/pages/responsepage.aspx":case"/pages/teamsresponsepage.aspx":return"Response";case"/pages/analysispage.aspx":return"Analyze";case"/pages/teamsconfigpage.aspx":return"TeamsConfig";default:return"Unknown"}},b.isProdAlternative=function(){var a=b.getHostUrl();return a.indexOf(".forms.osi.office.net")>0},b.isProduction=function(){var a=b.getEnvironmentType();return"WWProd"===a||"USGovProd"===a||"USDoDProd"===a||"USGovGccProd"===a},b.isSovereignProd=function(){var a=b.getEnvironmentType();return"USGovProd"===a||"USDoDProd"===a||"USGovGccProd"===a},b.isUSGovGccProd=function(){return"USGovGccProd"===b.getEnvironmentType()},b.isMsftProduction=function(){return"72f988bf-86f1-41af-91ab-2d7cd011db47"===OfficeFormServerInfo.userInfo.TenantId},b.isOsi=function(){switch(b.getEnvironmentType()){case"Int":case"EDog":case"WWProd":case"USGovProd":case"USDoDProd":case"USGovGccProd":return!0;default:return!1}},b.getAadInstance=function(){var a=Forms.AuthRelatedLocalStorage.UseLegacyLoginDomain;return b.isProduction()?a?"https://login.windows.net/":"https://login.microsoftonline.com/":"https://login.windows-ppe.net/"},b.getMSGraphAPIHost=function(){return b.isProduction()?"https://graph.microsoft.com/":"https://graph.microsoft-ppe.com"},b.getAadClientId=function(){return"USGovProd"===b.getEnvironmentType()||"USDoDProd"===b.getEnvironmentType()?"032e56fd-dfe5-4a50-8017-89692bcbcb0e":"038ed4f5-da78-47bc-8176-9153c79e0edb"},b.getFormsResourceId=function(){return"USGovProd"===b.getEnvironmentType()||"USDoDProd"===b.getEnvironmentType()?"153a74ba-783f-4394-bc9a-a109ef69f5c2":"c9a559d2-7aab-4f13-a6ed-e7e9c52aec87"},b.getUserInfoUrl=function(){return"https://portal.{0}/account/#personalinfo".format(b.isProduction()?b.getOffice365Domain(b.getEnvironmentType(),!0):b.getOffice365Domain("EDog",!0))},b.getConsumerInfoUrl=function(){return"https://account.{0}".format(b.isProduction()?b.getOffice365ConsumerDomain(b.getEnvironmentType()):b.getOffice365ConsumerDomain("EDog"))},b.getHrdV2Url=function(){var a=b.getExplictLocale();return"https://{0}/odc/v2.1/hrd?{1}Ver=16&app=111&p=6&hm=0&fpEnabled=1".format(b.getHrdV2Domain(),null!=a?"rs={0}&".format(a):"")},b.getHrdV2Domain=function(){return b.isProduction()?"odc.officeapps.live.com":"odc.edog.officeapps.live.com"},b.getCollabDBResourceId=function(a){return"https://lists."+b.getOffice365Domain(a)},b.getLorPickerOrigin=function(){var a=b.getEnvironmentType();switch(a){case"DevHost":return"https://educationresources-int.microsoft.com";case"Trial":return"https://educationresources-int.microsoft.com";case"Weekly":return"https://educationresources-int.microsoft.com";case"Daily":return"https://educationresources-int.microsoft.com";case"Int":return"https://educationresources-int.microsoft.com";case"EDog":return"https://educationresources-ppe.microsoft.com";case"WWProd":return"https://educationresources.microsoft.com";default:return"https://educationresources-int.microsoft.com"}},b.getLorPickerUrl=function(a){var c=b.getLorPickerOrigin(),d=b.getLorPickerHostParameter();return c+"/?supportedFormat=QTI&supportedResourceType=Assessment&host="+d+"&correlationId="+a},b.getMsftTenantId=function(){var a=b.getEnvironmentType();switch(a){case"WWProd":return"72f988bf-86f1-41af-91ab-2d7cd011db47";default:return"f686d426-8d16-42db-81b7-ab578e110ccd"}},b.getMsaTenantId=function(){var a=b.getEnvironmentType();switch(a){case"WWProd":case"EDog":return"9188040d-6c67-4c5b-b112-36a304b66dad";default:return"4925308c-f164-4d2d-bc7e-0631132e9375"}},b.getFastFoodTenantsId=function(){var a=b.getEnvironmentType();switch(a){case"WWProd":return["89d8a01e-e5db-493e-8720-b820d953ef20","b6338c92-533e-4f6d-a327-994263712399"];default:return["f686d426-8d16-42db-81b7-ab578e110ccd"]}},b.getExplictLocale=function(){return a.Utilities.Html.getQueries().lang||null},b.getEnvironmentTypeForNonOSI=function(){
var a=b.getDesiredProvider();if("int"===a)return"Int";if("edog"===a)return"EDog";switch(b.getEnvironmentType()){case"Trial":return"EDog";default:return"Int"}},b.getDesiredProvider=function(){var b=a.Utilities.Html.getQueries().dataprovider;switch(b){case"int":case"edog":return b;default:return null}},b.getOffice365Domain=function(a,c){switch(void 0===c&&(c=!1),null==a&&(a=b.getEnvironmentType()),a){case"USDoDProd":return c?"apps.mil":"osi.apps.mil";case"USGovProd":return c?"office365.us":"osi.office365.us";case"USGovGccProd":return c?"office.com":"gcc.osi.office365.us";case"WWProd":return"office.com";case"EDog":case"Trial":return"officeppe.com";default:return"office-int.com"}},b.getOffice365ConsumerDomain=function(a){switch(null==a&&(a=b.getEnvironmentType()),a){case"WWProd":return"microsoft.com";case"EDog":case"Trial":return"microsoft-ppe.com";default:return"microsoft-int.com"}},b.getHostUrl=function(){var a=window.location.host;return a.toLocaleLowerCase()},b.getLorPickerHostParameter=function(){var a=b.getEnvironmentType();switch(a){case"DevHost":return"msforms-dev";case"Trial":return"msforms-trial";case"Weekly":return"msforms-weekly";case"Daily":return"msforms-daily";case"Int":return"msforms-int";case"EDog":return"msforms-ppe";case"WWProd":return"msforms";default:return"msforms-trial"}},b}();a.EnvironmentConfig=b,a.Exports.EnvironmentConfig=b}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){a.Exports.Flighting=b;var c={},d={},e=function(){function b(){}return b.refreshFlights=function(){b.flights=OfficeFormServerInfo.flights&&OfficeFormServerInfo.flights.split(";")||b.flights},b.isEnabled=function(a){if(d[a]&&!d[a].every(b.isEnabled))return!1;var e=-1!==b.flightsOverride.indexOf("!"+g[a].toUpperCase());if(e)return!1;var f=-1!==b.flightsOverride.indexOf(g[a].toUpperCase());if(f)return!0;var h=-1!==b.flights.indexOf("!"+a)||-1!==b.flights.indexOf("!"+g[a]);if(h)return!1;var i=-1!==b.flights.indexOf(""+a)||-1!==b.flights.indexOf(g[a]);return i?!0:c[a]&&c[a].OnInCurrentEnvironment},b.foQuery=a.EnvironmentConfig.isProduction()&&!a.EnvironmentConfig.isProdAlternative()?"":a.Utilities.Html.getQueries().fo,b.flightsOverride=b.foQuery&&b.foQuery.split(";").map(function(a){return a.toUpperCase()})||[],b.flights=OfficeFormServerInfo.flights&&OfficeFormServerInfo.flights.split(";")||[],b}();b.Flight=e;var f;!function(a){a[a.OnDevBox=0]="OnDevBox",a[a.OnDevBoxAndDaily=1]="OnDevBoxAndDaily",a[a.AllOnNonOSI=2]="AllOnNonOSI",a[a.AllOnButEDogProd=3]="AllOnButEDogProd",a[a.AllOn=4]="AllOn",a[a.AllOff=5]="AllOff"}(f||(f={}));var g,h=function(){function b(a,b,c,d,e,g,h){if(null!=a)switch(a){case f.OnDevBox:this._onInDevhost=!0,this._onInDaily=!1,this._onInWeekly=!1,this._onInInt=!1,this._onInEDog=!1,this._onInProd=!1;break;case f.OnDevBoxAndDaily:this._onInDevhost=!0,this._onInDaily=!0,this._onInWeekly=!1,this._onInInt=!1,this._onInEDog=!1,this._onInProd=!1;break;case f.AllOnNonOSI:this._onInDevhost=!0,this._onInDaily=!0,this._onInWeekly=!0,this._onInInt=!1,this._onInEDog=!1,this._onInProd=!1;break;case f.AllOnButEDogProd:this._onInDevhost=!0,this._onInDaily=!0,this._onInWeekly=!0,this._onInInt=!0,this._onInEDog=!1,this._onInProd=!1;break;case f.AllOn:this._onInDevhost=!0,this._onInDaily=!0,this._onInWeekly=!0,this._onInInt=!0,this._onInEDog=!0,this._onInProd=!0;break;case f.AllOff:this._onInDevhost=!1,this._onInDaily=!1,this._onInWeekly=!1,this._onInInt=!1,this._onInEDog=!1,this._onInProd=!1}else this._onInDevhost=!!b,this._onInDaily=!!c,this._onInWeekly=!!d,this._onInInt=!!e,this._onInEDog=!!g,this._onInProd=!!h}return Object.defineProperty(b.prototype,"OnInCurrentEnvironment",{get:function(){var b=a.EnvironmentConfig.getEnvironmentType();switch(b){case"DevHost":return this._onInDevhost;case"Daily":case"Drill":case"Pilot":case"Trial":return this._onInDaily;case"Weekly":case"Hotfix":return this._onInWeekly;case"Int":return this._onInInt;case"EDog":return this._onInEDog;case"WWProd":case"USGovProd":case"USDoDProd":case"USGovGccProd":return this._onInProd}return!1},enumerable:!0,configurable:!0}),b}();!function(a){a[a.ResponseInApp=0]="ResponseInApp",a[a.ReExportToExcelButton=1]="ReExportToExcelButton",a[a.O365ConsumerWaffle=2]="O365ConsumerWaffle",a[a.EnableOnlineExcelForMSA=3]="EnableOnlineExcelForMSA",a[a.QRCodePlus=4]="QRCodePlus",a[a.ShareQuickSubmitPage=5]="ShareQuickSubmitPage",a[a.PageInitializationVerboseLogs=6]="PageInitializationVerboseLogs",a[a.FileUpload=7]="FileUpload",a[a.PartialPut=8]="PartialPut",a[a.FileUploadOnlyLargeFileAPI=9]="FileUploadOnlyLargeFileAPI",a[a.DropDown=10]="DropDown",a[a.CopyPasteForChoice=11]="CopyPasteForChoice",a[a.DisableOpenRedirection=12]="DisableOpenRedirection",a[a.PPTContentAddinSSO=13]="PPTContentAddinSSO",a[a.PreviewInfoBar=14]="PreviewInfoBar",a[a.RefreshServerInfoInFrame=15]="RefreshServerInfoInFrame",a[a.FileUploadTempFolder=16]="FileUploadTempFolder",a[a.MsaPreviewLabel=17]="MsaPreviewLabel",a[a.FormsBranding=18]="FormsBranding",a[a.EnableExperimentationClient=19]="EnableExperimentationClient",a[a.EmailHrdFallback=20]="EmailHrdFallback",a[a.PPTTaskpaneAddinSSO=21]="PPTTaskpaneAddinSSO",a[a.PPTWin32ContentAddinSSO=22]="PPTWin32ContentAddinSSO",a[a.AddCustomizeTheme=23]="AddCustomizeTheme",a[a.FormInsightFeedbackV2=24]="FormInsightFeedbackV2",a[a.NetPromoteScore=25]="NetPromoteScore",a[a.UseIdeas=26]="UseIdeas",a[a.WordCloudMultipleRatio=27]="WordCloudMultipleRatio",a[a.DisableBrandingForMSA=28]="DisableBrandingForMSA",a[a.RecordIdentityAdminSetting=29]="RecordIdentityAdminSetting",a[a.EnableMuidForAnonymousUsers=30]="EnableMuidForAnonymousUsers",a[a.IntelligenceTitleLogMetric=31]="IntelligenceTitleLogMetric",a[a.EnableNonAnonymousForMSA=32]="EnableNonAnonymousForMSA",a[a.OptionSuggestionFetchTimeout=33]="OptionSuggestionFetchTimeout",a[a.EmailReceipt=34]="EmailReceipt",a[a.MoveIntelligence=35]="MoveIntelligence",a[a.NpsForMSA=36]="NpsForMSA",a[a.PPTSlideShowNavigateButton=37]="PPTSlideShowNavigateButton",a[a.QuestionTagForIntelligence=38]="QuestionTagForIntelligence",a[a.MSASampleForm=39]="MSASampleForm",a[a.UserSettings=40]="UserSettings",a[a.UseRefactoredTelemetry=41]="UseRefactoredTelemetry",a[a.VerifyUserInResponsePage=42]="VerifyUserInResponsePage",a[a.MSATemplate=43]="MSATemplate",a[a.PPTWin32FirstPartySSOLegacyAPI=44]="PPTWin32FirstPartySSOLegacyAPI",a[a.CoGrading=45]="CoGrading",a[a.CoGradingPowertool=46]="CoGradingPowertool",a[a.QtiFormCreationTimeout=47]="QtiFormCreationTimeout",a[a.EnableLorForAllLocales=48]="EnableLorForAllLocales",a[a.PrintForm=49]="PrintForm",a[a.IsQtiFeatureEnabled=50]="IsQtiFeatureEnabled",a[a.IsStartTimeEndTimeManaged=51]="IsStartTimeEndTimeManaged",a[a.MathIncorrectAnswerSuggestions=52]="MathIncorrectAnswerSuggestions",a[a.MathQuestionGeneration=53]="MathQuestionGeneration",a[a.TextFieldMathAnswers=54]="TextFieldMathAnswers",a[a.CookieAuth=55]="CookieAuth",a[a.UseExternalCdn=56]="UseExternalCdn",a[a.CheckScriptLoading=57]="CheckScriptLoading",a[a.FormInsight=58]="FormInsight",a[a.EnableOptionSuggestsOption=59]="EnableOptionSuggestsOption",a[a.EnableTransferForm=60]="EnableTransferForm",a[a.SubmitTimeDistributionInsight=61]="SubmitTimeDistributionInsight",a[a.EnableNPSKeywordsInsight=62]="EnableNPSKeywordsInsight",a[a.EnablePartialOrderInsight=63]="EnablePartialOrderInsight",a[a.EnableResponseSentimentInsight=64]="EnableResponseSentimentInsight",a[a.EnableMsaContentValidation=65]="EnableMsaContentValidation",a[a.LogDownloadExcelErrorMessage=66]="LogDownloadExcelErrorMessage",a[a.StraightLineVizForCorrelationInsight=67]="StraightLineVizForCorrelationInsight",a[a.EnableFFUserGating=68]="EnableFFUserGating",a[a.SocialSharing=69]="SocialSharing",a[a.MSAIntroductionForResponder=70]="MSAIntroductionForResponder",a[a.Question200Limit=71]="Question200Limit",a[a.SectionMVP1=72]="SectionMVP1",a[a.MultiLingualMVP1=73]="MultiLingualMVP1",a[a.EnableFormsProRoute=74]="EnableFormsProRoute",a[a.UpgradeUxStateModel=75]="UpgradeUxStateModel"}(g=b.Flights||(b.Flights={})),c[g.CoGrading]=new h(f.OnDevBoxAndDaily),c[g.CoGradingPowertool]=new h(f.AllOff),c[g.QtiFormCreationTimeout]=new h(f.AllOn),c[g.EnableLorForAllLocales]=new h(f.AllOn),c[g.ResponseInApp]=new h(f.AllOnButEDogProd),c[g.MathIncorrectAnswerSuggestions]=new h(f.OnDevBoxAndDaily),c[g.MathQuestionGeneration]=new h(f.OnDevBoxAndDaily),c[g.TextFieldMathAnswers]=new h(f.OnDevBoxAndDaily),c[g.ReExportToExcelButton]=new h(f.AllOnButEDogProd),c[g.O365ConsumerWaffle]=new h(f.OnDevBox),c[g.EnableOnlineExcelForMSA]=new h(f.AllOff),c[g.QRCodePlus]=new h(f.AllOnButEDogProd),c[g.ShareQuickSubmitPage]=new h(f.AllOnButEDogProd),c[g.PageInitializationVerboseLogs]=new h(f.AllOnButEDogProd),c[g.FileUpload]=new h(f.AllOnButEDogProd),c[g.FormInsight]=new h(f.AllOnButEDogProd),c[g.PartialPut]=new h(f.OnDevBox),c[g.FileUploadOnlyLargeFileAPI]=new h(f.AllOnButEDogProd),c[g.DropDown]=new h(f.AllOnButEDogProd),c[g.CopyPasteForChoice]=new h(f.AllOnButEDogProd),c[g.DisableOpenRedirection]=new h(f.AllOnButEDogProd),c[g.PPTContentAddinSSO]=new h(f.AllOnButEDogProd),c[g.PPTWin32ContentAddinSSO]=new h(f.AllOnButEDogProd),c[g.PPTTaskpaneAddinSSO]=new h(f.AllOnButEDogProd),c[g.PreviewInfoBar]=new h(f.AllOnButEDogProd),c[g.RefreshServerInfoInFrame]=new h(f.AllOnButEDogProd),c[g.FileUploadTempFolder]=new h(f.AllOff),c[g.MsaPreviewLabel]=new h(f.AllOn),c[g.EnableOptionSuggestsOption]=new h(f.AllOnButEDogProd),c[g.PrintForm]=new h(f.OnDevBox),c[g.IsQtiFeatureEnabled]=new h(f.AllOn),c[g.IsStartTimeEndTimeManaged]=new h(f.AllOnButEDogProd),c[g.FormsBranding]=new h(f.OnDevBoxAndDaily),c[g.EnableExperimentationClient]=new h(f.AllOnButEDogProd),c[g.FormInsightFeedbackV2]=new h(f.AllOnButEDogProd),c[g.EmailHrdFallback]=new h(f.AllOnButEDogProd),c[g.UseIdeas]=new h(f.AllOnButEDogProd),c[g.AddCustomizeTheme]=new h(f.AllOnButEDogProd),c[g.NetPromoteScore]=new h(f.AllOnButEDogProd),c[g.WordCloudMultipleRatio]=new h(f.AllOnButEDogProd),c[g.LogDownloadExcelErrorMessage]=new h(f.AllOnButEDogProd),c[g.DisableBrandingForMSA]=new h(f.AllOff),c[g.RecordIdentityAdminSetting]=new h(f.AllOnButEDogProd),c[g.EnableMuidForAnonymousUsers]=new h(f.AllOnButEDogProd),c[g.IntelligenceTitleLogMetric]=new h(f.AllOnButEDogProd),c[g.EnableFFUserGating]=new h(f.AllOnButEDogProd),c[g.EnableNonAnonymousForMSA]=new h(f.AllOnButEDogProd),c[g.OptionSuggestionFetchTimeout]=new h(f.AllOnButEDogProd),c[g.EmailReceipt]=new h(f.AllOnButEDogProd),c[g.NpsForMSA]=new h(f.AllOnButEDogProd),c[g.MoveIntelligence]=new h(f.AllOnButEDogProd),c[g.PPTSlideShowNavigateButton]=new h(f.AllOnButEDogProd),c[g.SocialSharing]=new h(f.AllOnButEDogProd),c[g.MSAIntroductionForResponder]=new h(f.AllOnButEDogProd),c[g.QuestionTagForIntelligence]=new h(f.AllOff),c[g.MSASampleForm]=new h(f.AllOnButEDogProd),c[g.UserSettings]=new h(f.AllOnButEDogProd),c[g.Question200Limit]=new h(f.AllOnButEDogProd),c[g.UseRefactoredTelemetry]=new h(f.OnDevBoxAndDaily),c[g.VerifyUserInResponsePage]=new h(f.AllOnButEDogProd),c[g.SectionMVP1]=new h(f.AllOnButEDogProd),c[g.EnableFormsProRoute]=new h(f.AllOnButEDogProd),c[g.MSATemplate]=new h(f.AllOff),c[g.PPTWin32FirstPartySSOLegacyAPI]=new h(f.AllOnButEDogProd),c[g.UpgradeUxStateModel]=new h(f.AllOff),d[g.CoGradingPowertool]=[g.CoGrading]}(b=a.Flighting||(a.Flighting={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b=function(){function b(){this.deferred=null,this.muid=null}return Object.defineProperty(b,"Instance",{get:function(){return null==b.instance&&(b.instance=new b),b.instance},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"Muid",{get:function(){return this.muid},enumerable:!0,configurable:!0}),b.prototype.ensureMuid=function(){var c=this;if(null==this.deferred)if(this.deferred=$.Deferred(),this.muid=b.readMuid(),null==this.muid){var d=new a.Event.QosEventDeprecated(a.Event.QosEventNames.ServiceEndpoints.Function.GetMuid);d.start(),b.loadMuid(function(){c.muid=b.readMuid(),null!=c.muid?(c.deferred.resolve(c.muid),d.end({resultType:"Success"})):(c.deferred.reject(),d.end({resultType:navigator.cookieEnabled?"Failure":"ExpectedFailure"}))})}else this.deferred.resolve(this.muid);return this.deferred.promise()},b.loadMuid=function(b){var c=a.EnvironmentConfig.getMuidHost();if(c){var d=document.createElement("img");d.style.display="none",d.src=c+"/c.gif",d.hidden=!0,d["aria-hidden"]="true",d.onload=d.onerror=b}else b()},b.readMuid=function(){return a.Utilities.getCookie("MUID")},b.instance=null,b}();a.Muid=b,a.Exports.Muid=b}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function b(){}return Object.defineProperty(b,"EVENTNAME_SESSION_START",{get:function(){return"session_start"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"IntelligenceStatistic",{get:function(){return"IntelligenceStatistic"},enumerable:!0,configurable:!0}),b.setLogHandler=function(a){this.buffer.setFunctionToCall(a)},b.logData=function(b,c){(null==c||a.Flighting.Flight.isEnabled(c))&&(a.Flighting.Flight.isEnabled(a.Flighting.Flights.UseRefactoredTelemetry)?Forms.Telemetry.log({eventName:b.name,eventType:"engagement_event",extraData:b.extraData}):this.buffer.queue(b))},b.logSessionStartEvent=function(){a.Flighting.Flight.isEnabled(a.Flighting.Flights.EnableMuidForAnonymousUsers)&&a.Muid.Instance.ensureMuid(),a.Flighting.Flight.isEnabled(a.Flighting.Flights.UseRefactoredTelemetry)?Forms.Telemetry.log({eventName:b.EVENTNAME_SESSION_START,eventType:"session_start"}):b.logData({name:b.EVENTNAME_SESSION_START,extraData:{DbId:"",DeviceId:""}})},b.buffer=new a.Utilities.Process.BufferForCall,b}();b.EngagementEventDeprecated=c}(b=a.Event||(a.Event={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c;!function(a){a.FilteredOutForms="PortalPage.FilteredOutForms";var b=function(){function a(){}return a.MyFormsButton="DesignPage.Form.MyFormsButton",a.Duplicate="PortalPage.MyForms.Duplicate",a.CancelMoveToRecycleBin="PortalPage.MyForms.CancelMoveToRecycleBin",a.ConfirmMoveToRecycleBin="PortalPage.MyForms.ConfirmMoveToRecycleBin",a.MoveToRecycleBin="PortalPage.MyForms.MoveToRecycleBin",a.Load="PortalPage.MyForms.Load",a.Navigate="PortalPage.MyForms.Navigate",a.New="PortalPage.MyForms.New",a.OpenStoreButton="PortalPage.MyForms.OpenStoreButton",a.NewFormCopyAllDone="PortalPage.MyForms.NewFromCopy",a.NewFromCopyFailure="PortalPage.MyForms.NewFromCopy.Failure",a.AutoLoginSuccess="PortalPage.MyForms.AutoLoginSuccess",a.ReadyToCopyForm="PortalPage.MyForms.ReadyToCopyForm",a.NewFromCopyQuestionDone="PortalPage.MyForms.NewFromCopyQuestionDone",a.TryTemplate="PortalPage.MyForms.TryTemplate",a.CollapseTemplate="PortalPage.MyForms.CollapseTemplate",a.ExpandTemplate="PortalPage.MyForms.ExpandTemplate",a.NewForm="PortalPage.MyForms.NewForm",a.NewQuiz="PortalPage.MyForms.NewQuiz",a.FormCount="PortalPage.MyForms.FormCount",a.NewQuizFromLor="PortalPage.MyForms.NewQuizFromLor",a.Click="PortalPage.MyForms.Click",a.ExpandNewMenu="PortalPage.MyForms.ExpandNewMenu",a.ExceedFormQuota="PortalPage.MyForms.ExceedFormQuota",a}();a.MyForms=b;var c=function(){function a(){}return a.OtherFormsButton="DesignPage.Form.OtherFormsButton",a.Unpin="PortalPage.OtherForms.Unpin",a.Duplicate="PortalPage.OtherForms.Duplicate",a.FormCount="PortalPage.OtherForms.FormCount",a.Click="PortalPage.OtherForms.Click",a}();a.OtherForms=c;var d=function(){function a(){}return a.Click="PortalPage.SearchForms.Click",a}();a.SearchForms=d;var e=function(){function a(){}return a.Navigate="PortalPage.DelegateForms.Navigate",a}();a.DelegateForms=e;var f=function(){function a(){}return a.Navigate="PortalPage.FormIntroductionDialog.Navigate",a.CreatNewForm="PortalPage.FormIntroductionDialog.CreatNewForm",a.Close="PortalPage.FormIntroductionDialog.Close",a}();a.FormIntroductionDialog=f;var g=function(){function a(){}return a.GroupFormsButton="DesignPage.Form.GroupFormsButton",a}();a.GroupFormsPortal=g}(c=b.PortalPage||(b.PortalPage={}));var d;!function(a){var b=function(){function a(){}return a.StartGetResponses="AnalysisPage.Responses.StartGetResponses",a.Navigate="AnalysisPage.Analysis.Navigate",a}();a.Analysis=b}(d=b.AnalysisPage||(b.AnalysisPage={}));var e;!function(a){var b=function(){function a(){}return a.AddImage_Logo="DesignPage.Form.Logo.AddImage",a.SharedFormByOwner="DesignPage.Form.SharedFormByOwner",a.SharedOwnershipByOwner="DesignPage.Form.SharedOwnershipByOwner",a.Navigate="DesignPage.Form.Navigate",a.SuggestFormAdd="DesignPage.Form.SuggestFormAdd",a.SuggestFormTrigger="DesignPage.Form.SuggestFormTrigger",a}();a.Form=b;var c=function(){function a(){}return a.AddOption="DesignPage.Questions.AddOption",a.AddOtherOption="DesignPage.Questions.AddOtherOption",a.AnswerRequired="DesignPage.Questions.AnswerRequired",a.Create="DesignPage.Questions.Create",a.Delete="DesignPage.Questions.Delete",a.Duplicate="DesignPage.Questions.Duplicate",a.LongAnswer="DesignPage.Questions.LongAnswer",a.MoveDown="DesignPage.Questions.MoveDown",a.MoveUp="DesignPage.Questions.MoveUp",a.MultipleAnswers="DesignPage.Questions.MultipleAnswers",a.Navigate="DesignPage.Questions.Navigate",a.AddRankingOption="DesignPage.Questions.AddRankingOption",a.DeleteRankingOption="DesignPage.Questions.DeleteRankingOption",a.SortableInitialization="DesignPage.Questions.SortableInitialization",a.AddImage="DesignPage.Questions.AddImage",a.ToggleCorrectChoice="DesignPage.Questions.ToggleCorrectChoice",a.PasteChoiceOptions="DesignPage.Questions.PasteChoiceOptions",a.ShortTextAnswerAdded="DesignPage.Questions.ShortTextAnswerAdded",a.ShortTextAnswerDeleted="DesignPage.Questions.ShortTextAnswerDeleted",a.FirstShortTextAnswerAdded="DesignPage.Questions.FirstShortTextAnswerAdded",a.LastRemainingShortTextAnswerDeleted="DesignPage.Questions.LastRemainingShortTextAnswerDeleted",a.AddLikertSubquestion="DesignPage.Questions.AddLikertSubquestion",a.DeleteLikertSubquestion="DesignPage.Questions.DeleteLikertSubquestion",a.AddLikertOption="DesignPage.Questions.AddLikertOption",a.DeleteLikertOption="DesignPage.Questions.DeleteLikertOption",a.RatingLevelModified="DesignPage.Questions.RatingLevelModified",a.RatingValueOutOfBounds="DesignPage.Questions.RatingValueOutOfBounds",a}();a.Questions=c;var d=function(){function a(){}return a.MathOption="DesignPage.QuestionMenu.MathOption",a.Navigate="DesignPage.QuestionMenu.Navigate",a.Quiz="DesignPage.QuestionMenu.Quiz",a.RatingLabel="DesignPage.QuestionMenu.RatingLabel",a.ShuffleOptions="DesignPage.QuestionMenu.ShuffleOptions",a.Subtitle="DesignPage.QuestionMenu.Subtitle",a.Validation="DesignPage.QuestionMenu.Validation",a.DropDown="DesignPage.QuestionMenu.DropDown",a}();a.QuestionMenu=d;var e=function(){function a(){}return a.AnswerHint="DesignPage.Quiz.AnswerHint",a.Point="DesignPage.Quiz.Point",a.SwitchTextToMathInput="DesignPage.Quiz.SwitchTextToMathInput",a.SwitchMathToTextInput="DesignPage.Quiz.SwitchMathToTextInput",a.EditMathFormula="DesignPage.Quiz.EditMathFormula",a}();a.Quiz=e;var f=function(){function a(){}return a.DeleteAllResponses="DesignPage.Responses.DeleteAllResponses",a.DeleteSingleResponse="DesignPage.Responses.DeleteSingleResponse",a.DetialDialogPaging="DesignPage.Responses.DetailDialogPaging",a.DetailDialogQuestionNavigate="DesignPage.Responses.DetailDialogQuestionNavigate",a.DownloadExcelFile="DesignPage.Responses.DownloadExcelFile",a.DownloadExcelFileDecreaseFileSize="DesignPage.Responses.DownloadExcelFileDecreaseFileSize",a.DownloadExcelFileFailed="DesignPage.Responses.DownloadExcelFileFailed",a.DownloadExcelFileStart="DesignPage.Responses.DownloadExcelFileStart",a.DownloadExcelFileSuccess="DesignPage.Responses.DownloadExcelFileSuccess",a.DownloadMultipleExcelFiles="DesignPage.Responses.DownloadMultipleExcelFiles",a.DownloadOnePagingExcelFile="DesignPage.Responses.DownloadOnePagingExcelFile",a.GradeResults="DesignPage.Responses.GradeResults",a.GradeQtiResults="DesignPage.Responses.GradeQtiResults",a.IndividualPaging="DesignPage.Responses.IndividualPageing",a.IndividualPrint="DesignPage.Responses.IndividualPrint",a.MeetLegacyChoiceAnswer="DesignPage.Responses.MeetLegacyChoiceAnswer",a.Navigate="DesignPage.Responses.Navigate",a.OpenExcelInOneDrive="DesignPage.Responses.OpenExcelInOneDrive",a.OpenInExcel="DesignPage.Responses.OpenInExcel",a.PostQtiGrade="DesignPage.Responses.PostQtiGrade",a.PrintAnalyzeView="DesignPage.Responses.PrintAnalyzeView",a.ReExportToExcel="DesignPage.Responses.ReExportToExcel",a.GetSummaryResult="DesignPage.Responses.GetSummaryResult",a.ReleaseResults="DesignPage.Responses.ReleaseResults",a.ShowResponsesDetail="DesignPage.Responses.ShowResponsesDetail",a.SwitchView="DesignPage.Responses.SwitchView",a.SwitchIvyChartType="DesignPage.Responses.SwitchIvyChartType",a.SwitchResponder="DesignPage.Responses.SwitchResponder",a.ViewResults="DesignPage.Responses.ViewResults",a.ExportToOneDriveWithBigData="DesignPage.Responses.ExportToOneDriveWithBigData",a.CopySummaryLink="DesignPage.Responses.CopySummaryLink",a.StartGetResponses="DesignPage.Responses.StartGetResponses",a.OpenFileFolder="DesignPage.Responses.OpenFileFolder",a.PopupReExportToExcelDialog="DesignPage.Responses.PopupReExportToExcelDialog",a.ShowInsightEntryPoint="DesignPage.Responses.ShowInsightEntryPoint",a.ClickInsightEntryPoint="DesignPage.Responses.ClickInsightEntryPoint",a.ClickInsightPreviousButton="DesignPage.Responses.ClickInsightPreviousButton",a.ClickInsightNextButton="DesignPage.Responses.ClickInsightNextButton",a.ReleaseInsightView="DesignPage.Responses.ReleaseInsightView",a.ShowInsights="DesignPage.Responses.ShowInsights",a}();a.Analysis=f;var g=function(){function a(){}return a.Navigate="DesignPage.PreView.Navigate",a}();a.Preview=g;var h=function(){function a(){}return a.Navigate="DesignPage.Theme.Navigate",a.SwitchTheme="DesignPage.Theme.SwitchTheme",a.AddCustomizedTheme="DesignPage.Theme.AddCustomizedTheme",a.EditCustomizedTheme="DesignPage.Theme.EditCustomizedTheme",a.AddImage="DesignPage.Theme.AddImage",a.DeleteImage="DesignPage.Theme.DeleteImage",a.AddColor="DesignPage.Theme.AddColor",a.DeleteColor="DesignPage.Theme.DeleteColor",a.ColorTooLight="DesignPage.Theme.ColorTooLight",a}();a.Theme=h;var i=function(){function a(){}return a.AddImage="DesignPage.ImagePicker.AddImage",a.AddVideo="DesignPage.MediaPicker.AddVideo",a.AddVideoFailure="DesignPage.MediaPicker.AddVideoFailure",a.Back="DesignPage.MediaPicker.Back",a.BingSearch="DesignPage.ImagePicker.UploadBingSearch",a.BingSearchLicense="DesignPage.ImagePicker.BingSearchLicense",a.ChooseImage="DesignPage.MediaPicker.ChooseImage",a.ChooseVideo="DesignPage.MediaPicker.ChooseVideo",a.Local="DesignPage.ImagePicker.UploadLocal",a.Navigate="DesignPage.ImagePicker.Navigate",a.OD4B="DesignPage.ImagePicker.UploadOD4B",a.Search="DesignPage.ImagePicker.Search",a.URL="DesignPage.ImagePicker.URL",a}();a.MediaPicker=i;var j=function(){function a(){}return a.ImageSize="DesignPage.ImageLayout.ImageSize",a}();a.ImageLayout=j;var k=function(){function a(){}return a.AltText="DesignPage.ImageEditPane.AltText",a.Delete="DesignPage.ImageEditPane.Delete",a.Edit="DesignPage.ImageEditPane.Edit",a.Style="DesignPage.ImageEditPane.Style",a.Zoom="DesignPage.ImageEditPane.Zoom",a.ZoomIn="DesignPage.ImageEditPane.ZoomIn",a.ZoomOut="DesignPage.ImageEditPane.ZoomOut",a}();a.ImageEditPane=k;var l=function(){function a(){}return a.Delete="DesignPage.VideoEditPane.Delete",a}();a.VideoEditPane=l;var m=function(){function a(){}return a.AcceptResponse="DesignPage.Setting.AcceptResponse",a.AllowAnonymous="DesignPage.Setting.AllowAnonymous",a.ApplyDeadline="DesignPage.Setting.ApplyDeadline",a.ApplyStartTime="DesignPage.Setting.ApplyStartTime",a.EditCloseMessage="DesignPage.Setting.EditCloseMessage",a.Navigate="DesignPage.Setting.Navigate",a.RecordIdentity="DesignPage.Setting.RecrodIdentity",a.RequireUniqueResponse="DesignPage.Setting.RequireUniqueResponse",a.RespondInAppOnly="DesignPage.Setting.RespondInAppOnly",a.SetDeadline="DesignPage.Setting.SetDeadline",a.SetStartTime="DesignPage.Setting.SetStartTime",a.ShowGradedResults="DesignPage.Setting.ShowGradedResults",a.ShowGradedScores="DesignPage.Setting.ShowGradedScores",a.ShuffleOption="DesignPage.Setting.ShuffleOption",a.ShuffleQuestion="DesignPage.Setting.ShuffleQuestion",a.ShuffleAllQuestions="DesignPage.Setting.ShuffleAllQuestions",a.LockGivenQuestions="DesignPage.Setting.LockGivenQuestions",a.AutoReleaseGrade="DesignPage.Setting.AutoReleaseGrade",a.EmailNotification="DesignPage.Setting.EmailNotification",a.EmailReceipt="DesignPage.Setting.EmailReceipt",a.ThankYouMessage="DesignPage.Setting.ThankYouMessage",a}();a.Setting=m;var n=function(){function a(){}return a.Link="DesignPage.Send.Link",a.Email="DesignPage.Send.Email",a.Embed="DesignPage.Send.MoreOptions",a.Navigate="DesignPage.Send.Navigate",a.QRCode="DesignPage.Send.QRCode",a.Sharing="DesignPage.Send.Sharing",a.SocialShare="DesignPage.Send.Share",a.ActionFailed="DesignPage.Send.ActionFailed",a.ActionSuccess="DesignPage.Send.ActionSuccess",a.CopyEmbedCode="DesignPage.Send.CopyEmbedCode",a.CopyLink="DesignPage.Send.CopyLink",a.DownloadQRCode="DesignPage.Send.DownloadQRCode",a.SendEmails="DesignPage.Send.SendEmails",a.AllowCopyCheckBox="DesignPage.Send.AllowCopyCheckBox",a.ShareFormLink="DesignPage.Send.ShareFormLink",a}();a.Send=n;var o=function(){function a(){}return a.CopyShareAsTemplateLink="DesignPage.Share.CopyShareAsTemplateLink",a.CreateShareAsTemplateLink="DesignPage.Share.CreateShareAsTemplateLink",a.DeleteShareAsTemplateLink="DesignPage.Share.DeleteShareAsTemplateLink",a.CopyCollaborationLink="DesignPage.Share.CopyCollaborationLink",a.CreateCollaborationLink="DesignPage.Share.CreateCollaborationLink",a.DeleteCollaborationLink="DesignPage.Share.DeleteCollaborationLink",a.SwitchCollaborationLink="DesignPage.Share.SwitchCollaborationLink",a.CopyAnalysisResultLink="DesignPage.Share.CopyAnalysisResultLink",a.CreateAnalysisResulttLink="DesignPage.Share.CreateAnalysisResulttLink",a.DeleteAnalysisResultLink="DesignPage.Share.DeleteAnalysisResultLink",a.ChooseAllowAnonymous="DesignPage.Share.ChooseAllowAnonymous",a}();a.Share=o;var p=function(){function a(){}return a.Navigate="DesignPage.Feedback.Navigate",a.Suggestion="DesignPage.Feedback.Suggestion",a.Insights="DesignPage.Feedback.Insights",a}();a.Feedback=p;var q=function(){function a(){}return a.Navigate="DesignPage.Help.Navigate",a}();a.Help=q;var r=function(){function a(){}return a.Navigate="DesignPage.Menu.Navigate",a.SignOut="DesignPage.Menu.SignOut",a.UserInfo="DesignPage.Menu.UserInfo",a.PrintForm="DesignPage.Menu.PrintForm",a}();a.Menu=r;var s=function(){function a(){}return a.BranchChanged="DesignPage.Branch.BranchChanged",a.BranchDesignViewNavigate="DesignPage.Branch.BranchDesignViewNavigate",a}();a.Branch=s;var t=function(){function a(){}return a.GetShellServiceInfo="DesignPage.AppLauncher.GetShellServiceInfo",a.GetConsumerShellServiceInfo="DesignPage.AppLauncher.GetConsumerShellServiceInfo",a.LoadShellData="DesignPage.AppLauncher.LoadShellData",a.Navigate="DesignPage.AppLauncher.Navigate",a.RenderShellData="DesignPage.AppLauncher.RenderShellData",a.LoadError="DesignPage.AppLauncher.LoadShellData",a}();a.AppLauncher=t;var u=function(){function a(){}return a.Clipboard="DesignPage.ShortCut.Clipboard",a.UndoRedo="DesignPage.ShortCut.UndoRedo",a}();a.ShortCut=u;var v=function(){function a(){}return a.Navigate="DesignPage.MathKeyboard.Navigate",a}();a.MathKeyboard=v;var w=function(){function a(){}return a.ConnectionStarted="DesignPage.Notification.ConnectionStarted",a}();a.Notification=w;var x=function(){function a(){}return a.Navigate="DesignPage.QRCodePlus.Navigate",a.Download="DesignPage.QRCodePlus.Download",a.CopyUrlSuccess="DesignPage.QRCodePlus.Success",a.CopyUrlFail="DesignPage.QRCodePlus.Fail",a}();a.QRCodePlus=x}(e=b.DesignPage||(b.DesignPage={}));var f=function(){function a(){}return a.Navigate="DesignPage.RecycleBin.Navigate",a.formDelete="RecycleBin.MyForm.Delete",a.formRestore="RecycleBin.MyForm.Restore",a.groupBarClick="RecycleBin.GroupFormsRecycle.GroupBar.Click",a.groupFormDelete="RecycleBin.GroupForm.Delete",a.groupFormRestore="RecycleBin.GroupForm.Restore",a}();b.RecycleBin=f;var g;!function(a){var b=function(){function a(){}return a.Navigate="ResponsePage.Form.Navigate",a.QRCode="ResponsePage.Form.QRCode",a.Submit="ResponsePage.Form.Submit",a.SubmitQtiResponse="ResponsePage.Form.SubmitQtiResponse",a.OpenInTakeATest="ResponsePage.Form.OpenInTakeATest",a.TextQuestionInfoOfSubmit="ResponsePage.Form.TextQuestionInfoOfSubmit",a.SwitchTextToMathInput="ResponsePage.Form.SwitchTextToMathInput",a.SwitchMathToTextInput="ResponsePage.Form.SwitchMathToTextInput",a}();a.Form=b;var c=function(){function a(){}return a.LearnMoreForTakeATest="ResponsePage.ThanksView.LearnMoreForTakeATest",a.Navigate="ResponsePage.ThanksView.Navigate",a.NavigateToPortal="ResponsePage.ThanksView.NavigateToPortal",a.SubmitAnother="ResponsePage.ThanksView.SubmitAnother",a}();a.ThanksView=c;var d=function(){function a(){}return a.Navigate="ResponsePage.PollResultView.Navigate",a.NavigateToPortal="ResponsePage.PollResultView.NavigateToPortal",a.SubmitAnother="ResponsePage.PollResultView.SubmitAnother",a}();a.PollResultView=d;var e=function(){function a(){}return a.IsEmbeddedSession="ResponsePage.EmbedView.IsEmbeddedSession",a.BlockEmbed="ResponsePage.EmbedView.BlockEmbed",a.Navigate="ResponsePage.EmbedView.Navigate",a.NeedAuth="ResponsePage.EmbedView.NeedAuth",a.OpenInBrowser="ResponsePage.EmbedView.OpenInBrowser",a}();a.EmbedView=e;var f=function(){function a(){}return a.Navigate="ResponsePage.StudentView.Navigate",a}();a.StudentView=f;var g=function(){function a(){}return a.Navigate="ResponsePage.ViewResultView.Navigate",a}();a.ViewResultView=g;var h=function(){function a(){}return a.Error="ResponsePage.ErrorPage.Error",a.Information="ResponsePage.ErrorPage.Information",a}();a.ErrorPage=h;var i=function(){function a(){}return a.Failure="ResponsePage.LoadingScript.Failure",a.Start="ResponsePage.LoadingScript.Start",a.Success="ResponsePage.LoadingScript.Success",a}();a.LoadingScript=i}(g=b.ResponsePage||(b.ResponsePage={}));var h;!function(a){var b=function(){function a(){}return a.Navigate="ShareFormPage.Copy.Navigate",a.LoginToAutoCopy="ShareFormPage.Copy.LoginToAutoCopy",a.DuplicateButton="ShareFormPage.Copy.DuplicateButton",a}();a.Copy=b}(h=b.ShareFormPage||(b.ShareFormPage={}));var i;!function(a){a.Referrer="DefaultPage.Referrer";var b=function(){function a(){}return a.GetStarted="DefaultPage.LandingView.GetStarted",a.GetStartedHeaderBar="DefaultPage.LandingView.GetStartedHeaderBar",a.GetStartedWithForm="DefaultPage.LandingView.GetStartedWithForm",a.GetStartedSignIn="DefaultPage.LandingView.GetStartedSignIn",a.SignIn="DefaultPage.LandingView.SignIn",a.MsaSignIn="DefaultPage.LandingView.MsaSignIn",a.AadSignIn="DefaultPage.LandingView.AadSignIn",a.Navigate="DefaultPage.LandingView.Navigate",a.SignUp="DefaultPage.LandingView.SignUp",a.MsaSignUp="DefaultPage.LandingView.MsaSignUp",a.AadSignUp="DefaultPage.LandingView.AadSignUp",a.CloseSignDialog="DefaultPage.LandingView.CloseSignDialog",a.EmailHrdFailure="DefaultPage.LandingView.EmailHrdFailure",a.AccountNotInWhiteList="DefaultPage.LandingView.AccountNotInWhiteList",a.AccountTypeUnknown="DefaultPage.LandingView.AccountTypeUnknown",a.AccountTypeBoth="DefaultPage.LandingView.AccountTypeBoth",a.Office365="DefaultPage.LandingView.Office365",a.PowerApps="DefaultPage.LandingView.PowerApps",a}();a.LandingView=b;var c=function(){function a(){}return a.Loaded="DefaultPage.EmailHrd.Loaded",a.LoadFailed="DefaultPage.EmailHrd.LoadFailed",a.NextScreen="DefaultPage.EmailHrd.NextScreen",a}();a.EmailHrd=c}(i=b.DefaultPage||(b.DefaultPage={}));var j;!function(a){var b=function(){function a(){}return a.Success="Image.CanvasOnLoad.Success",a.Failure="Image.CanvasOnLoad.Failure",a}();a.CanvasOnLoad=b;var c=function(){function a(){}return a.Success="Image.CanvasRender.Success",a.Failure="Image.CanvasRender.Failure",a}();a.CanvasRender=c;var d=function(){function a(){}return a.Success="Image.ImageOnLoad.Success",
a.Failure="Image.ImageOnLoad.Failure",a}();a.ImageOnLoad=d}(j=b.Image||(b.Image={}));var k;!function(a){var b=function(){function a(){}return a.GotoRegisterPage="Error.ErrorPage.GotoRegisterPage",a.Error="Error.ErrorPage.Error",a.Information="Error.ErrorPage.Information",a.OriginErrorJudgementNotMatch="Error.ErrorPage.OriginErrorJudgementNotMatch",a.ErrorOutOfOrigin="Error.ErrorPage.ErrorOutOfOrigin",a.SignInWithOtherAccount="Error.ErrorPage.SignInWithOtherAccount",a.SignOutInIframeInProgress="Error.ErrorPage.SignOutInIframeInProgress",a}();a.ErrorPage=b;var c=function(){function a(){}return a.Hide="Error.ErrorMessageBar.Hide",a.Show="Error.ErrorMessageBar.Show",a}();a.ErrorMessageBar=c;var d=function(){function a(){}return a.ShowAtSubmitResponse="Error.InlineError.ShowAtSubmitResponse",a}();a.InlineError=d;var e=function(){function a(){}return a.FailedToLoadCss="Error.CssLoadingError.FailedToLoadCss",a}();a.CssLoadingError=e;var f=function(){function a(){}return a.KatexFallbackToMathJax="Error.MathRendering.KatexFallbackToMathJax",a}();a.MathRendering=f;var g=function(){function a(){}return a.UniversalHeaderAndFooterError="Error.UHF.UniversalHeaderAndFooterError",a}();a.UHF=g}(k=b.Error||(b.Error={}));var l;!function(a){var b=function(){function a(){}return a.DisabledByTenantAdmin="Auth.DisabledByTenantAdmin",a.LocalStorageNotSupported="Auth.LocalStorageNotSupported",a.NotOnboardedTenant="Auth.NotOnboardedTenant",a.ThirdPartyCookieSupport="Auth.ThirdPartyCookieSupport",a.UserNeedMultiFactorAuth="Auth.UserNeedMultiFactorAuth",a.SilentSigninUsingAadState="Auth.SilentSigninUsingAadState",a.NoUserInfoForNonanonymousForm="Auth.NoUserInfoForNonanonymousForm",a}();a.Auth=b}(l=b.Auth||(b.Auth={}));var m;!function(a){a.AllScriptsLoadDone="JsLoad.AllScriptsLoadDone",a.SomeScriptsLoadFailed="JsLoad.SomeScriptsLoadFailed",a.ScriptLoadDone="JsLoad.ScriptLoadDone",a.ScriptLoadFailed="JsLoad.ScriptLoadFailed"}(m=b.JsLoad||(b.JsLoad={}));var n;!function(a){var b=function(){function a(){}return a.Close="AddinPage.App.Close",a.Initial="AddinPage.App.Initial",a}();a.App=b;var c=function(){function a(){}return a.DataSync="AddinPage.SyncView.DataSync",a}();a.SyncView=c;var d=function(){function a(){}return a.GetAddinUserInfoSuccess="AddinPage.GetAddinUserInfo.Success",a.GetAddinUserInfoFailed="AddinPage.GetAddinUserInfo.Failed",a.GetFlightsSuccess="AddinPage.GetFlights.Success",a.GetFlightsFailed="AddinPage.GetFlights.Failed",a}();a.PageMethod=d}(n=b.AddinPage||(b.AddinPage={}));var o;!function(a){var b=function(){function a(){}return a.Close="OneNoteAddinPage.App.Close",a.Initial="OneNoteAddinPage.App.Initial",a}();a.App=b;var c=function(){function a(){}return a.Navigate="OneNoteAddinPage.AuthView.Navigate",a.Click="OneNoteAddinPage.AuthView.Click",a.Succeed="OneNoteAddinPage.AuthView.Succeed",a.NotLoggedIn="OneNoteAddinPage.AuthView.NotLoggedIn",a}();a.AuthView=c;var d=function(){function a(){}return a.Navigate="OneNoteAddinPage.SyncView.Navigate",a.IsNewUser="OneNoteAddinPage.SyncView.IsNewUser",a.InsertForm="OneNoteAddinPage.SyncView.InsertForm",a.InsertSuccess="OneNoteAddinPage.SyncView.InsertSuccess",a.CreateForm="OneNoteAddinPage.SyncView.CreateForm",a.CreateSuccess="OneNoteAddinPage.SyncView.CreateSuccess",a.EditForm="OneNoteAddinPage.SyncView.EditForm",a}();a.SyncView=d}(o=b.OneNoteAddinPage||(b.OneNoteAddinPage={}));var p;!function(a){var b=function(){function a(){}return a.GetToken="PowerPointTaskpaneAddinPage.Initialize.GetToken",a.GetTokenCompleted="PowerPointTaskpaneAddinPage.Initialize.GetTokenCompleted",a}();a.Initialize=b;var c=function(){function a(){}return a.Close="PowerPointTaskpaneAddinPage.App.Close",a.Initial="PowerPointTaskpaneAddinPage.App.Initial",a}();a.App=c;var d=function(){function a(){}return a.Navigate="PowerPointTaskpaneAddinPage.AuthView.Navigate",a.Click="PowerPointTaskpaneAddinPage.AuthView.Click",a.Succeed="PowerPointTaskpaneAddinPage.AuthView.Succeed",a.NotLoggedIn="PowerPointTaskpaneAddinPage.AuthView.NotLoggedIn",a}();a.AuthView=d;var e=function(){function a(){}return a.Navigate="PowerPointTaskpaneAddinPage.SyncView.Navigate",a.IsNewUser="PowerPointTaskpaneAddinPage.SyncView.IsNewUser",a.InsertForm="PowerPointTaskpaneAddinPage.SyncView.InsertForm",a.InsertSuccess="PowerPointTaskpaneAddinPage.SyncView.InsertSuccess",a.CreateForm="PowerPointTaskpaneAddinPage.SyncView.CreateForm",a.CreateSuccess="PowerPointTaskpaneAddinPage.SyncView.CreateSuccess",a.EditForm="PowerPointTaskpaneAddinPage.SyncView.EditForm",a.FetchFormList="PowerPointTaskpaneAddinPage.SyncView.FetchFormList",a.FetchFormListSuccess="PowerPointTaskpaneAddinPage.SyncView.FetchFormListSuccess",a}();a.SyncView=e}(p=b.PowerPointTaskpaneAddinPage||(b.PowerPointTaskpaneAddinPage={}));var q;!function(a){var b=function(){function a(){}return a.PrepareAddinContext="PowerPointContentAddinPage.Initialize.PrepareAddinContext",a.PrepareAddinContextCompleted="PowerPointContentAddinPage.Initialize.PrepareAddinContextCompleted",a.GetToken="PowerPointContentAddinPage.Initialize.GetToken",a.GetTokenCompleted="PowerPointContentAddinPage.Initialize.GetTokenCompleted",a.GetTokenThirdPartySSONotSupported="PowerPointContentAddinPage.Initialize.GetTokenThirdPartySSONotSupported",a}();a.Initialize=b;var c=function(){function a(){}return a.Click="PowerPointContentAddinPage.AuthView.Click",a.Succeed="PowerPointContentAddinPage.AuthView.Succeed",a.NotLoggedIn="PowerPointContentAddinPage.AuthView.NotLoggedIn",a}();a.AuthView=c;var d=function(){function a(){}return a.Render="PowerPointContentAddinPage.RenderView.Render",a.RenderFormPage="PowerPointContentAddinPage.RenderView.RenderFormPage",a.RenderSuccess="PowerPointContentAddinPage.RenderView.RenderSuccess",a.GetPPTView="PowerPointContentAddinPage.RenderView.GetPPTView",a.GetPPTViewSuccess="PowerPointContentAddinPage.RenderView.GetPPTViewSuccess",a.GetPPTViewNotSupported="PowerPointContentAddinPage.RenderView.GetPPTViewNotSupported",a.GetFormId="PowerPointContentAddinPage.RenderView.GetFormId",a.GetFormIdCompleted="PowerPointContentAddinPage.RenderView.GetFormIdCompleted",a.SaveFileSettings="PowerPointContentAddinPage.RenderView.SaveFileSettings",a.SaveFileSettingsCompleted="PowerPointContentAddinPage.RenderView.SaveFileSettingsCompleted",a.GetFormTitle="PowerPointContentAddinPage.RenderView.GetFormTitle",a.GetFormTitleCompleted="PowerPointContentAddinPage.RenderView.GetFormTitleCompleted",a.CheckAnonymous="PowerPointContentAddinPage.RenderView.CheckAnonymous",a.CheckAnonymousCompleted="PowerPointContentAddinPage.RenderView.CheckAnonymousCompleted",a.CookieBypass="PowerPointContentAddinPage.RenderView.CookieBypass",a.SSOBypass="PowerPointContentAddinPage.RenderView.SSOBypass",a}();a.RenderView=d;var e=function(){function a(){}return a.Click="PowerPointContentAddinPage.StartView.Click",a}();a.StartView=e}(q=b.PowerPointContentAddinPage||(b.PowerPointContentAddinPage={}));var r;!function(a){var b=function(){function a(){}return a.Navigate="AssignmentsFrame.Auth.Navigate",a.Success="AssignmentsFrame.Auth.Success",a.SsoSuccess="AssignmentsFrame.Auth.SsoSuccess",a}();a.Auth=b;var c=function(){function a(){}return a.Save="AssignmentsFrame.ConfigView.Save",a}();a.ConfigView=c}(r=b.AssignmentsFrame||(b.AssignmentsFrame={}));var s;!function(a){var b=function(){function a(){}return a.Navigate="TeamsTab.Auth.Navigate",a.Success="TeamsTab.Auth.Success",a.SsoSuccess="TeamsTab.Auth.SsoSuccess",a.RefreshInfoFailed="TeamsTab.Auth.RefreshInfoFailed",a}();a.Auth=b;var c=function(){function a(){}return a.Save="TeamsTab.ConfigView.Save",a}();a.ConfigView=c}(s=b.TeamsTab||(b.TeamsTab={}));var t;!function(a){var b=function(){function a(){}return a.Close="AgaveAddinPage.Agave.Close",a.Initial="AgaveAddinPage.Agave.Initial",a}();a.Agave=b}(t=b.AgaveAddinPage||(b.AgaveAddinPage={}));var u;!function(a){var b=function(){function a(){}return a.Close="OutlookCreatePollPage.App.Close",a.Initial="OutlookCreatePollPage.App.Initial",a}();a.App=b;var c=function(){function a(){}return a.Navigate="OutlookCreatePollPage.AuthView.Navigate",a.Click="OutlookCreatePollPage.AuthView.Click",a.Succeed="OutlookCreatePollPage.AuthView.Succeed",a.NotLoggedIn="OutlookCreatePollPage.AuthView.NotLoggedIn",a}();a.AuthView=c;var d=function(){function a(){}return a.Navigate="OutlookCreatePollPage.PollView.Navigate",a.Insert="OutlookCreatePollPage.PollView.Insert",a.OpenForms="OutlookCreatePollPage.PollView.OpenForms",a}();a.PollView=d;var e=function(){function a(){}return a.MultipleAnswers="OutlookCreatePollPage.Questions.MultipleAnswers",a}();a.Questions=e}(u=b.OutlookCreatePollPage||(b.OutlookCreatePollPage={}));var v;!function(a){var b=function(){function a(){}return a.ConnectionDisconnected="DataProvider.RealtimeClient.Connection.Disconnected",a.ConnectionError="DataProvider.RealtimeClient.Connection.Error",a.ConnectionFailed="DataProvider.RealtimeClient.Connection.Failed",a.ConnectionReconnected="DataProvider.RealtimeClient.Connection.Reconnected",a.ConnectionReconnecting="DataProvider.RealtimeClient.Connection.Reconnecting",a.ConnectionSlow="DataProvider.RealtimeClient.Connection.Slow",a.ConnectionStarting="DataProvider.RealtimeClient.Connection.Starting",a.ConnectionSuccess="DataProvider.RealtimeClient.Connection.Success",a}();a.RealtimeClient=b}(v=b.DataProvider||(b.DataProvider={}));var w;!function(a){var b=function(){function a(){}return a.Navigate="QuickSubmitPage.QuickSubmit.Navigate",a.Submit="QuickSubmitPage.QuickSubmit.Submit",a}();a.QuickSubmit=b}(w=b.QuickSubmitPage||(b.QuickSubmitPage={}));var x;!function(a){var b=function(){function a(){}return a.Show="IntelligenceStatistic.ChoiceOptionSuggestion.Show",a.NoShow="IntelligenceStatistic.ChoiceOptionSuggestion.NoShow",a.Choose="IntelligenceStatistic.ChoiceOptionSuggestion.Choose",a}();a.ChoiceOptionSuggestion=b;var c=function(){function a(){}return a.Show="IntelligenceStatistic.LikertOptionSuggestion.Show",a.Choose="IntelligenceStatistic.LikertOptionSuggestion.Choose",a}();a.LikertOptionSuggestion=c;var d=function(){function a(){}return a.Show="IntelligenceStatistic.QuestionSuggestion.Show",a}();a.QuestionSuggestion=d;var e=function(){function a(){}return a.Failure="IntelligenceStatistic.Templates.Failure",a}();a.TemplateSuggestion=e}(x=b.IntelligenceStatistic||(b.IntelligenceStatistic={}));var y;!function(a){var b=function(){function a(){}return a.Show="Intelligence.ChoiceOptionSuggestion.Show",a.Choose="Intelligence.ChoiceOptionSuggestion.Choose",a}();a.ChoiceOptionSuggestion=b;var c=function(){function a(){}return a.Show="Intelligence.LikertOptionSuggestion.Show",a.Choose="Intelligence.LikertOptionSuggestion.Choose",a}();a.LikertOptionSuggestion=c;var d=function(){function a(){}return a.Show="Intelligence.QuestionSuggestion.Show",a}();a.QuestionSuggestion=d;var e=function(){function a(){}return a.TagFailure="Intelligence.QuestionTagForIntelligence.Tag.Failure",a}();a.QuestionTagForIntelligence=e}(y=b.Intelligence||(b.Intelligence={})),a.Exports.EngagementEventNames=b}(c=b.EngagementEventNames||(b.EngagementEventNames={}))}(b=a.Event||(a.Event={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(Error);a.AuthError=b;var c=function(b){function c(c){var d=b.call(this,c)||this;return d.name=a.Form.ClientErrorNames.AuthNoStorageError,d}return __extends(c,b),c}(b);a.AuthErrorNoStorage=c;var d=function(){function b(){}return Object.defineProperty(b,"AuthContext",{get:function(){return b.authContext},enumerable:!0,configurable:!0}),b.hasUserLoggedIn=function(){return a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth)?a.DataProvider.AuthTokenHelper.getInstance().isUserLoggedIn():!!b.AuthContext.getCachedUser()},b.setUserAccountNameToStorage=function(c){a.SafeStorage.DefaultStorage.setItem(b.userAccountNameKey,JSON.stringify(c))},b.getUserAccountNameFromStorage=function(){var c=a.SafeStorage.DefaultStorage.getItem(b.userAccountNameKey);return c&&JSON.parse(c)},b.detectUserLoggedInAAD=function(a,c){var d=Forms.AuthRelatedLocalStorage;if(d.isSupported()){var e=!d.DetectAADInProgress;e&&b.initDetectUserLoggedInAAD();var f=setInterval(function(){d.DetectAADInProgress||(clearInterval(f),d.DetectAADResult?e?a():setTimeout(function(){return Forms.Common.reloadPage()},2e3):c())},100)}else c()},b.initDetectUserLoggedInAAD=function(){var c=Forms.AuthRelatedLocalStorage;c.DetectAADInProgress=!0,c.DetectAADResult=void 0;var d;d=a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth)?b.stateCookieAuthPrefix+a.Utilities.Guid.newGuid():b.statePrefix+a.Utilities.Guid.newGuid();var e={client_id:a.EnvironmentConfig.getAadClientId(),msafed:0,prompt:"none",redirect_uri:window.location.origin,resource:a.EnvironmentConfig.getFormsResourceId(),response_mode:"form_post",response_type:"token",state:d};a.SafeStorage.DefaultStorage.setItem(b.stateKey,d);var f=new a.Event.QosEventDeprecated(a.Event.QosEventNames.Auth.Auth.DetectUserLoggedInAAD);f.start(),window.formDetectUserLoggedInAADCallback=function(a){f.end({resultType:a?"ExpectedFailure":"Success"}),c.DetectAADInProgress=void 0,c.DetectAADResult=!a};var g=a.EnvironmentConfig.getAadInstance()+"common/oauth2/authorize?"+jQuery.param(e);$("body").append('<iframe id="detectAADAuthFrame" style="display:none;" src='+g+"><iframe>")},b.handleAuthForContentPage=function(c){return b.deferredHandleAuth||(b.deferredHandleAuth=$.Deferred(),a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth)?b.deferredHandleAuth.resolve():b.handleAuth().done(function(a){if(a.HasUserSignedIn||!c)b.populateUserInfo(),b.deferredHandleAuth.resolve();else{if(b.AuthContext.login(),!b.loginWithRedirectPromise)throw Error("Authenticator.redirectForAuthContextLogin not called.");b.loginWithRedirectPromise.done(function(){return b.deferredHandleAuth.resolve()}).fail(function(){return b.deferredHandleAuth.reject()})}}).fail(function(a){b.deferredHandleAuth.reject(a)})),b.deferredHandleAuth.promise()},b.handleAuthForAddinPage=function(){return b.deferredHandleAuth||(b.deferredHandleAuth=$.Deferred(),a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth)?b.deferredHandleAuth.resolve():b.handleAuth().done(function(a){a.HasUserSignedIn?(b.populateUserInfo(),b.deferredHandleAuth.resolve()):b.deferredHandleAuth.reject()})),b.deferredHandleAuth.promise()},b.registerSignInHandler=function(a){b.loginHandler=a},b.signIn=function(){return b.loginHandler?b.loginHandler():(b.redirectToLogin(),$.Deferred().promise())},b.signInThenRefresh=function(){b.signIn().then(function(){return Forms.Common.reloadPage(!0)})},b.redirectToLogin=function(){a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth)?a.DataProvider.AuthTokenHelper.getInstance().redirectToSignIn():a.Authenticator.AuthContext.login()},b.signOut=function(){a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth)?Forms.Common.redirectTo(OfficeFormServerInfo.signOutLink):(b.AuthContext.config.postLogoutRedirectUri=window.location.href,b.AuthContext.logOut())},b.handleAuth=function(){var d=a.SafeStorage.supportsLocalStorage(),e=a.SafeStorage.supportsSessionStorage();if(d||a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.Auth.Auth.LocalStorageNotSupported,extraData:{supportsSessionStorage:e}}),!d&&!e)return $.Deferred().reject(new c("local storage or session storage can't be used")).promise();var f=a.SafeStorage.DefaultStorage.getItem(b.userAccountNameKey),g="response_mode=form_post&msafed=0";g=f?g+"&username="+f:g;var h=window.location.origin,i={cacheLocation:d?"localStorage":"sessionStorage",clientId:a.EnvironmentConfig.getAadClientId(),displayCall:b.redirectForAuthContextLogin,extraQueryParameter:g,instance:a.EnvironmentConfig.getAadInstance(),postLogoutRedirectUri:h,redirectUri:h,tenant:""},j=new AuthenticationContext(i),k=j.isCallback(window.location.hash);if(j.handleWindowCallback(),k)return $.Deferred().promise();if(b.authContext=j,!a.Authenticator.hasUserLoggedIn())return $.Deferred().resolve({HasUserSignedIn:!1,UserSignedInBefore:!1}).promise();var l=$.Deferred();return j.acquireToken(a.EnvironmentConfig.getAadClientId(),function(b,c){var d=!b&&!!c;if(d){var e=j.getCachedUser();"live.com"===e.profile.idp&&(j.clearCache(),d=!1,a.Event.ErrorEventDeprecated.logData({errorName:"UnexpectedLiveId"}))}else a.Authenticator.AuthContext.clearCache();l.resolve({HasUserSignedIn:d,UserSignedInBefore:!0})}),l.promise()},b.handleDetectUserLoggedInAADCallback=function(){return b.isDetectUserLoggedInAADCallback(window.location.hash)?(window.parent&&window.parent.formDetectUserLoggedInAADCallback&&window.parent.formDetectUserLoggedInAADCallback(b.isDetectUserLoggedInAADCallbackError(window.location.hash)),!0):!1},b.isDetectUserLoggedInAADCallback=function(a){return-1!==a.indexOf("state="+b.statePrefix)},b.isDetectUserLoggedInAADCallbackError=function(c){var d=!1,e=a.Utilities.Html.getQueries(c.substring(1).trim());return e.state&&a.SafeStorage.DefaultStorage.getItem(b.stateKey)===e.state&&(d=!0),!d||-1!==c.indexOf("error_description=")},b.populateUserInfo=function(){var a=b.AuthContext.getCachedUser();if(a){var c=a.profile.oid;OfficeFormServerInfo.userInfo={DisplayName:a.profile.name,GivenName:a.profile.given_name||a.profile.name&&a.profile.name.split(" ")[0],Email:a.profile.unique_name,UserId:c,TenantId:a.profile.tid,PUID:c.replace(/-/g,"").substring(16),IsMsa:!1}}},b.redirectForAuthContextLogin=function(a){if(b.loginWithRedirectPromise)throw Error("login in progress.");Forms.Common.replaceUrl(a);var c=$.Deferred();b.loginWithRedirectPromise=c.promise(),setTimeout(function(){return c.reject()},3e3)},b.stateKey="officeforms.auth.state",b.statePrefix="form.detectUserLoggedInAAD.",b.stateCookieAuthPrefix=b.statePrefix+"cookieAuth.",b.userAccountNameKey="officeforms.userAccountNameKey",b}();a.Authenticator=d,a.Exports.Authenticator=d}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function a(){}return a.AADAcquireTokenError="AADAcquireTokenError",a.AADAcquireTokenMfaCheckError="AADAcquireTokenMfaCheckError",a.LoginIECrossZoneError="LoginIECrossZoneError",a.ThirdPartyCookieBlockedError="ThirdPartyCookieBlockedError",a.AuthNoStorageError="AuthNoStorageError",a.TeamSiteNoGroupError="TeamSiteNoGroupError",a.VariationMismatachError="VariationMismatachError",a}();b.ClientErrorNames=c,a.Exports.ClientErrorNames=c}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;if(function(a){var b;!function(b){function c(){return{R:255,G:255,B:255}}function d(){return{R:0,G:0,B:0}}function e(a){var b=[a.R,a.G,a.B].map(function(a){return a/=255,.03928>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)});return.2126*b[0]+.7152*b[1]+.0722*b[2]}function f(a){return(e(c())+.05)/(e(a)+.05)>q}function g(a){for(var b=r;!f(a)&&b>=s;){var c=k(a);c.V=.01*b,a=l(c),b--}return a}function h(a){return f(a)?c():d()}function i(a){var b=a.toString(16);return 1===b.length?"0"+b:b}function j(a){return"#"+i(a.R)+i(a.G)+i(a.B)}function k(a){var b,c=a.R,d=a.G,e=a.B,f=Math.max(c,d,e),g=Math.min(c,d,e),h=f-g,i=0===f?0:h/f,j=f/255;switch(f){case g:b=0;break;case c:b=d-e+h*(e>d?6:0),b/=6*h;break;case d:b=e-c+2*h,b/=6*h;break;case e:b=c-d+4*h,b/=6*h}return{H:b,S:i,V:j}}function l(a){var b,c,d,e,f,g,h,i,j=a.H,k=a.S,l=a.V;switch(e=Math.floor(6*j),f=6*j-e,g=l*(1-k),h=l*(1-f*k),i=l*(1-(1-f)*k),e%6){case 0:b=l,c=i,d=g;break;case 1:b=h,c=l,d=g;break;case 2:b=g,c=l,d=i;break;case 3:b=g,c=h,d=l;break;case 4:b=i,c=g,d=l;break;case 5:b=l,c=g,d=h}return{R:Math.round(255*b),G:Math.round(255*c),B:Math.round(255*d)}}function m(a){a.startsWith("#")&&(a=a.substring(1));var b=parseInt(a,16);return{R:b>>16&255,G:b>>8&255,B:255&b}}function n(a){var b=m(a),c=k(b);return e(b)>186&&(c.V=.45,b=l(c)),j(b)}function o(a){var b=k(m(a)),c=l({H:b.H,S:b.S,V:b.V-.1});return j(c)}function p(a){var b,c=k(m(a));return b=c.S>.05?.05:0,j(l({H:c.H,S:b,V:.95}))}a.Exports.ColorHelper=b;var q=4.5,r=46,s=25;b.isValidColorContrast=f,b.adjustPrimaryThemeColor=g,b.contrastingColor=h,b.colorToHex=j,b.rGBToHSV=k,b.hSVToRGB=l,b.hexToRGB=m,b.normalizePrimaryColor=n,b.primaryHexToSecondaryHex=o,b.primaryHexToBackgroundHex=p}(b=a.ColorHelper||(a.ColorHelper={}))}(OfficeForm||(OfficeForm={})),!window.atob||!window.btoa){window.atob=window.atob||decode,window.btoa=window.btoa||encode;var PADCHAR_1="=",ALPHA_1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}var OfficeForm;!function(a){var b;!function(b){function c(a){return h[a]||(h[a]=d(a)),h[a]}function d(b){var c=$.Deferred(),d=g[f[b]];if(!d)throw Error("No path for "+f[b]);var e=document.getElementsByTagName("head")[0];if(!e)return c.reject(Error("No head element found!")).promise();var h=document.createElement("link");return h.rel="stylesheet",h.href=d,h.onload=function(){return c.resolve()},h.onerror=function(){e.removeChild(h),c.reject(Error("Failed to load css file: "+d)),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.Error.CssLoadingError.FailedToLoadCss,extraData:{name:f[b],url:d}})},e.appendChild(h),c.promise()}function e(){var b="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.0/katex.min.css",c="../scripts/vendors/katex/katex.min.css";return a.EnvironmentConfig.isOsi()?c:b}var f;!function(a){a[a.Katex=0]="Katex"}(f=b.CssLibraries||(b.CssLibraries={})),b.loadCss=c;var g={Katex:e()},h=[]}(b=a.CssLoader||(a.CssLoader={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){a[a.Default=1]="Default",a[a.OfficeAPI=2]="OfficeAPI",a[a.TeamsAPI=3]="TeamsAPI"}(b=a.PopupNotifyType||(a.PopupNotifyType={}));var c;!function(a){a[a.Default=0]="Default",a[a.OrgId=1]="OrgId",a[a.WindowsLiveId=2]="WindowsLiveId"}(c=a.AuthProvider||(a.AuthProvider={}));var d;!function(a){a[a.OneNote=1]="OneNote",a[a.OneNoteUwp=2]="OneNoteUwp",a[a.Outlook=3]="Outlook",a[a.Teams=4]="Teams",a[a.Excel=5]="Excel",a[a.OneDrive=6]="OneDrive",a[a.Excel_Win32=7]="Excel_Win32",a[a.PowerPoint=8]="PowerPoint",a[a.Assignments=9]="Assignments",a[a.ProjectShimla=10]="ProjectShimla",a[a.Stream=11]="Stream",a[a.StreamMobile=12]="StreamMobile"}(d=a.HostApps||(a.HostApps={}));var e=function(){function b(){}return Object.defineProperty(b,"Host",{get:function(){return b._host||d[b.GetHostString()]},set:function(a){b._host=a},enumerable:!0,configurable:!0}),b.GetHostString=function(){return b._host&&d[b._host]||a.Utilities.Html.getQueries()[b.HostParam]||a.Utilities.Html.getHashes()[b.HostParam]},Object.defineProperty(b,"GroupId",{get:function(){return b._groupId||a.Utilities.Html.getQueries()[b.GroupParam]||a.Utilities.Html.getHashes()[b.GroupParam]},enumerable:!0,configurable:!0}),Object.defineProperty(b,"TenantId",{get:function(){return b._tenantId||a.Utilities.Html.getQueries()[b.TenantParam]||a.Utilities.Html.getHashes()[b.TenantParam]},enumerable:!0,configurable:!0}),b.setGroupInfo=function(a,c,d){void 0===a&&(a=!1),b._showGroupFormOnly=a,b._tenantId=c,b._groupId=d},Object.defineProperty(b,"IsIntegration",{get:function(){var a=b.GetHostString();return a&&d[a]?!0:OfficeFormServerInfo.isOembedSPO?!0:!1},enumerable:!0,configurable:!0}),Object.defineProperty(b,"IsTeamsIntegration",{get:function(){return b.Host===d.Teams&&"undefined"!=typeof microsoftTeams},enumerable:!0,configurable:!0}),Object.defineProperty(b,"IsTeamsLandingPage",{get:function(){return!!a.Utilities.Html.getQueries()[b.TeamsLandingParam]},enumerable:!0,configurable:!0}),Object.defineProperty(b,"IsMiniLandingView",{get:function(){return!!a.Utilities.Html.getQueries()[b.MiniLandingViewParam]},enumerable:!0,configurable:!0}),Object.defineProperty(b,"IsAssignmentsIntegration",{get:function(){return b.Host===d.Assignments},enumerable:!0,configurable:!0}),Object.defineProperty(b,"IsExternalIntegration",{get:function(){return this.IsTeamsIntegration||this.IsAssignmentsIntegration},enumerable:!0,configurable:!0}),Object.defineProperty(b,"IsPPTIntegration",{get:function(){return b.Host===d.PowerPoint},enumerable:!0,configurable:!0}),Object.defineProperty(b,"IsProjectShimlaIntegration",{get:function(){return b.Host===d.ProjectShimla},enumerable:!0,configurable:!0}),b.isDelegateMode=function(){if(null===b._isDelegateMode){var a=window.location.pathname.trimEnd("/").toLowerCase();b._isDelegateMode=a.lastIndexOf(b.DelegatePage)==a.length-b.DelegatePage.length}return b._isDelegateMode},b.setEnvironmentHostAppWithName=function(a){if(!(a in d))throw Error("hostAppName "+a+" doesn't exist.");b.Host=d[a]},b.PopupNotifyTypeParam="popupNotifyType",b.AuthProviderParam="auth_pvr",b.AuthUpnParam="auth_upn",b.ShareToCollabTokenParam="Token",b.HostParam="Host",b.TeamsLandingParam="TeamsLanding",b.MiniLandingViewParam="MiniLandingView",b.GroupParam="groupId",b.TenantParam="tid",b.DelegatePage="delegatepage.aspx",b._isDelegateMode=null,b}();a.EnvironmentSettings=e,a.Exports.EnvironmentSettings=e}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){function b(a,b,d,e){var f={};return f[s]=e?u:t,c(a,b,d,f)}function c(a,b,c,d){var e=g(a),i=g(b);d&&0!==Object.keys(d).length&&Object.keys(d).forEach(function(a){c+=r+a+"="+d[a]});var j=p-(n+o+c.length)%p;j=p>j?j:0,c=f(c,c.length+j,q);var k=h(c),l=e.concat(i,k),m=window.btoa(String.fromCharCode.apply(String,l));return m.replace(/\//g,"_").replace(/\+/g,"-")}function d(a){var b=e(a),c=!1;return b.MoreInfo&&b.MoreInfo[s]===u&&(c=!0),{OrgId:b.OrgId,OwnerId:b.OwnerId,TableId:b.TableId,IsGroupOwner:c}}function e(a){try{a=a.replace(/_/g,"/").replace(/-/g,"+");var b=i(a),c=b.slice(0,n),d=j(c),e=b.slice(n,n+o),f=j(e),g=b.slice(n+o),h=m(k(g),q),l={},p=h.split(r);if(p.length>1){h=p[0];for(var s=1;s<p.length;s++){var t=p[s].split("=");t&&2===t.length&&(l[t[0]]=t[1])}}return{OrgId:d,OwnerId:f,TableId:h,MoreInfo:l}}catch(u){return{OrgId:null,OwnerId:null,TableId:null,MoreInfo:null}}}function f(a,b,c){return a+Array(b-a.length+1).join(c||" ")}function g(a){var b=[];return a.split("-").forEach(function(a,c){var d=a.match(/.{2}/g);3>c&&(d=d.reverse()),d.forEach(function(a){b.push(parseInt(a,16))})}),b}function h(a){return a.split("").map(function(a){return a.charCodeAt(0)})}function i(a){return h(window.atob(a.replace(/ /g,"")))}function j(a){if(16!==a.length)return null;var b=[].concat(a.slice(0,4).reverse(),a.slice(4,6).reverse(),a.slice(6,8).reverse(),a.slice(8)),c=l(b);return c=c.slice(0,8)+"-"+c.slice(8,12)+"-"+c.slice(12,16)+"-"+c.slice(16,20)+"-"+c.slice(20)}function k(a){for(var b="",c=0;c<a.length;++c)b+=String.fromCharCode(a[c]);return b}function l(a){for(var b="",c="",d=0;d<a.length;d++)c=a[d].toString(16),c=1===c.length?"0"+c:c,b+=c;return b}function m(a,b){if(null===a||void 0===a||0===a.length)return a;for(var c=a.length;--c>=0&&!(b.indexOf(a.charAt(c))<0););return a.substr(0,c+1)}var n=16,o=16,p=3,q=".",r="$%@#",s="t",t="u",u="g";a.encodeFormId=b,a.decodeFormId=d}(b=a.FormId||(a.FormId={}))}(b=a.Utilities||(a.Utilities={}))}(OfficeForm||(OfficeForm={}));var Forms;!function(a){var b;!function(a){}(b=a.DesignPage||(a.DesignPage={}));var c;!function(a){}(c=a.Experimentation||(a.Experimentation={}));var d;!function(a){var b;!function(a){}(b=a.FormManager||(a.FormManager={}))}(d=a.Models||(a.Models={}));var e;!function(a){var b;!function(a){}(b=a.Utilities||(a.Utilities={}));var c;!function(a){}(c=a.Controls||(a.Controls={}));var d;!function(a){}(d=a.Analysis||(a.Analysis={}));var e;!function(a){}(e=a.FileUpload||(a.FileUpload={}));var f;!function(a){}(f=a.Intelligence||(a.Intelligence={}));var g;!function(a){}(g=a.RecycleBin||(a.RecycleBin={}));var h;!function(a){}(h=a.Renderer||(a.Renderer={}));var i;!function(a){}(i=a.Designer||(a.Designer={}));var j;!function(a){}(j=a.FlexPane||(a.FlexPane={}));var k;!function(a){}(k=a.FormDesignView||(a.FormDesignView={}));var l;!function(a){}(l=a.Addin||(a.Addin={}));var m;!function(a){}(m=a.PowerPoint||(a.PowerPoint={}))}(e=a.UX||(a.UX={})),function(a){var b;!function(a){}(b=a.FileUpload||(a.FileUpload={}))}(e=a.UX||(a.UX={}));var f;!function(a){}(f=a.Mru||(a.Mru={}));var g;!function(a){}(g=a.FileUploadProcess||(a.FileUploadProcess={}));var h;!function(a){}(h=a.Grading||(a.Grading={}));var i;!function(a){}(i=a.PrintTemplate||(a.PrintTemplate={}));var j;!function(a){}(j=a.Common||(a.Common={}));var k;!function(a){}(k=a.DataProvider||(a.DataProvider={}));var l;!function(a){}(l=a.Experiment||(a.Experiment={}));var m;!function(a){}(m=a.Templates||(a.Templates={}));var n;!function(a){}(n=a.Telemetry||(a.Telemetry={}));var o;!function(a){}(o=a.FormsProRelated||(a.FormsProRelated={}))}(Forms||(Forms={}));var OfficeForm;!function(a){var b;!function(b){function c(b){return $.when.apply($,b.map(d)).done(function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.JsLoad.AllScriptsLoadDone,extraData:{scripts:b}},a.Flighting.Flights.PageInitializationVerboseLogs)}).fail(function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.JsLoad.SomeScriptsLoadFailed,extraData:{scripts:b}},a.Flighting.Flights.PageInitializationVerboseLogs)})}function d(a){return l[a]||(l[a]=c(k[a]||[]).then(function(){return e(a)}),"undefined"!=typeof Forms&&Forms.PerformanceAnalysis&&Forms.PerformanceAnalysis.requestWithPromise("script:"+a,l[a])),l[a]}function e(b){var c=$.Deferred(),d=j[b];if(!d)throw Error("No script path for "+b);var e=document.getElementsByTagName("head")[0];if(!e)return c.reject(Error("No head element found!")).promise();var f=document.createElement("script");return f.type="text/javascript",f.async=!0,f.src=d,f.onload=function(){c.resolve(),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.JsLoad.ScriptLoadFailed,extraData:{name:b}},a.Flighting.Flights.PageInitializationVerboseLogs)},f.onerror=function(g){e.removeChild(f),c.reject(Error("Failed to load javascript file: "+d)),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.JsLoad.ScriptLoadFailed,extraData:{name:b,url:d,message:g&&g.message}},a.Flighting.Flights.PageInitializationVerboseLogs)},e.appendChild(f),c.promise()}function f(){var b="//cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML",c="../scripts/vendors/mathjax/MathJax.js?config=TeX-AMS_HTML";return a.EnvironmentConfig.isOsi()?c:b}function g(){var b="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.0/katex.min.js",c="../scripts/vendors/katex/katex.min.js";return a.EnvironmentConfig.isOsi()?c:b}function h(a,b){k[a]=b}a.Exports.JavaScriptLoader=b,b.loadJavaScripts=c,b.loadJavaScript=d;var i=OfficeFormServerInfo.scriptSuffix,j=("?v="+OfficeFormServerInfo.version,{"combined-design":"../Scripts/Vendors/combined/design_3fd6ce0.js","combined-response":"../Scripts/Vendors/combined/response_2e6ed61.js",BootStrap:a.Flighting.Flight.isEnabled(a.Flighting.Flights.UseExternalCdn)?"//ajax.aspnetcdn.com/ajax/bootstrap/3.3.5/bootstrap.min.js":"../Scripts/Vendors/bootstrap/3.3.5/bootstrap.min.js",DataTables:"../Scripts/Vendors/DataTables."+i,Chart:"../Scripts/Vendors/Chart-2.6."+i,Clipboard:"../Scripts/Vendors/clipboard-1.7.1.min.js",ColorThief:"../Scripts/Vendors/color-thief/color-thief.min.js",Cropper_Modified:"../Scripts/Vendors/cropper/cropper.modified."+i,D3:"../Scripts/Vendors/d3/d3."+i,FileSave:"../Scripts/Vendors/FileSaver.min.js",Heatmap:"../Scripts/Vendors/highcharts/heatmap.js",HighCharts:"../Scripts/Vendors/highcharts/highcharts.js",HighCharts_More:"../Scripts/Vendors/highcharts/highcharts-more.js",Ivy:"//edera.cloudapp.net/javascripts/api/ivy.js",OfficeBrowserFeedback:"../Scripts/Vendors/officebrowserfeedback/officebrowserfeedback_floodgate.js",JQuery_RateIt:"../Scripts/Vendors/rating-1.1.0/jquery.rateit."+i,JQuery_Picker:"../Scripts/Vendors/pickadate-3.5.6/picker."+i,JQuery_Picker_Date:"../Scripts/Vendors/pickadate-3.5.6/picker.date."+i,JQuery_Picker_Time:"../Scripts/Vendors/pickadate-3.5.6/picker.time."+i,JQuery_QRCode:"../Scripts/Vendors/jquery.qrcode.min.js",Katex:g(),Linkify:"../Scripts/Vendors/linkify/linkify.min.js",Linkify_JQuery:"../Scripts/Vendors/linkify/linkify-jquery.min.js",
MathJax:f(),MathQuill:"../Scripts/Vendors/mathquill/mathquill."+i,Pattern_Fill:"../Scripts/Vendors/highcharts/pattern-fill.js",Mark:"../Scripts/Vendors/markjs-8.9.0/mark."+i,SignalR:"../Scripts/Vendors/SignalR/jquery.signalR-2.2.0.min.js",Sortable:"../Scripts/Vendors/sortablejs-1.5.1/Sortable.modified."+i,WordCloud:"../Scripts/Vendors/highcharts/wordcloud.js",Xlsx:"../Scripts/Vendors/xlsx.core.min.js"}),k={};h("JQuery_Picker_Date",["JQuery_Picker"]),h("JQuery_Picker_Time",["JQuery_Picker"]),h("Linkify_JQuery",["Linkify"]),h("WordCloud",["HighCharts"]),h("HighCharts_More",["HighCharts"]),h("Heatmap",["HighCharts"]),h("Pattern_Fill",["HighCharts"]);var l={}}(b=a.JavaScriptLoader||(a.JavaScriptLoader={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b=function(){function a(b){this.margin=10,this.containerWidth=b,this.maxImageRatio=b/a.miniHight,this.miniImageRatio=b/a.maxHight}return Object.defineProperty(a.prototype,"Margin",{get:function(){return this.margin},set:function(a){this.margin=a},enumerable:!0,configurable:!0}),a.prototype.layoutContent=function(a){for(var b=[],c=a,d=0,e=c.length,f=[];e>d;d++){var g=this.groupItems([].concat(f,c[d])),h=g.length;0>=h||(e-1>d&&this.getSumRatio(g[h-1])<this.miniImageRatio?(f=g[h-1],g.length=h-1):f=[],b=b.concat.apply(b,g))}return b},a.prototype.groupItems=function(a){for(var b=this.groupItemsByNodeType(a),c=0;c<b.length;c++){var d=this.getRowHeight(b[c]);1===b[c].length&&b[c][0].NaturalRatio>this.maxImageRatio?(b[c][0].Height=d,b[c][0].Width=this.containerWidth-this.margin):b[c].forEach(function(a){a.Height=d,a.Width=d*a.NaturalRatio})}return b},a.prototype.groupItemsByNodeType=function(a){var b=a.filter(function(a){return a.Type===e.Folder}),c=a.filter(function(a){return a.Type===e.Image});if(b.length<=0)return this.selectAndGroupItems(c);var d=this.selectAndGroupItems(b),f=d[d.length-1],g=this.getSumRatio(f);if(g<this.miniImageRatio)for(var h=0;h<c.length&&5>h;h++){var i=c[h].NaturalRatio;if(g+i<this.miniImageRatio)g+=i,f.push(c[h]),c.splice(h--,1);else if(g+i<this.maxImageRatio){f.push(c[h]),c.splice(h,1);break}}return d.concat(this.selectAndGroupItems(c))},a.prototype.selectAndGroupItems=function(a){for(var b=[],c=[],d=0;d<a.length;d++){c.push([d]);for(var e=c.length-1,f=0;e>f;f++){var g=a[d].NaturalRatio;g+=c[f].map(function(b){return a[b].NaturalRatio}).reduce(function(a,b){return a+b},0);var h=c[f].slice(0);if(h.push(d),g<this.miniImageRatio)c.push(h);else if(g>=this.miniImageRatio&&g<=this.maxImageRatio){b.push(h.map(function(b){return a[b]}));for(var i=c.length-1;i>=0;i--)c[i].some(function(a){return h.indexOf(a)>=0})&&c.splice(i,1);break}}}for(var j=c.filter(function(a){return 1===a.length}).map(function(b){return a[b[0]]}),k=[],d=0;d<j.length;d++)k.push(j[d]),this.getSumRatio(k)>this.maxImageRatio&&(b.push(k),k=[]);return k.length>0&&b.push(k),b},a.prototype.getRowHeight=function(b){var c=this.getSumRatio(b);if(c>this.maxImageRatio&&1===b.length)return a.miniHight;if(c<this.miniImageRatio)return a.maxHight;var d=this.containerWidth-b.length*this.margin;return d/c},a.prototype.getSumRatio=function(a){return a.map(function(a){return a.NaturalRatio}).reduce(function(a,b){return a+b})},a.maxHight=200,a.miniHight=140,a}();a.LiquidLayout=b;var c=function(){function a(){}return Object.defineProperty(a.prototype,"Type",{get:function(){return e.Image},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Width",{get:function(){return this.width},set:function(a){this.width=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Height",{get:function(){return this.height},set:function(a){this.height=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"NaturalWidth",{get:function(){return this.naturalWidth},set:function(a){this.naturalWidth=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"NaturalHeight",{get:function(){return this.naturalHeight},set:function(a){this.naturalHeight=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"NaturalRatio",{get:function(){return this.naturalWidth&&this.naturalHeight?this.naturalWidth/this.naturalHeight:1},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Src",{get:function(){return this.src},set:function(a){this.src=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ThumbnailSrc",{get:function(){return this.thumbnailSrc},set:function(a){this.thumbnailSrc=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Title",{get:function(){return this.title},set:function(a){this.title=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Size",{get:function(){return this.size},set:function(a){this.size=a},enumerable:!0,configurable:!0}),a}();a.ImageLayoutNode=c;var d=function(){function a(){}return Object.defineProperty(a.prototype,"Type",{get:function(){return e.Folder},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"NaturalHeight",{get:function(){return 175},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"NaturalWidth",{get:function(){return 265},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"NaturalRatio",{get:function(){return this.NaturalWidth/this.NaturalHeight},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Height",{get:function(){return this.height},set:function(a){this.height=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Width",{get:function(){return this.width},set:function(a){this.width=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Title",{get:function(){return this.title},set:function(a){this.title=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"AlbumCount",{get:function(){return this.albumCount},set:function(a){this.albumCount=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ResourceId",{get:function(){return this.resourceId},set:function(a){this.resourceId=a},enumerable:!0,configurable:!0}),a}();a.FolderLayoutNode=d;var e;!function(a){a[a.Image=0]="Image",a[a.Folder=1]="Folder"}(e=a.NodeType||(a.NodeType={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b=function(){function a(a){this.setItems(a||[])}return a.prototype.toArray=function(){for(var a=[],b=this.head.Next;b!==this.head;b=b.Next)a.push(b.Data);return a},a.prototype.getCount=function(){return this.count},a.prototype.getById=function(a){var b=this.map[a];return b&&b.Data},a.prototype.append=function(a){this.insertBefore(a)},a.prototype.update=function(a){var b=this.getIdFromData(a),c=this.map[b];if(!c)throw Error("No matched data to update.");c.Data=a},a.prototype.getNext=function(a){var b=this.map[a];return b?b.Next.Data:void 0},a.prototype.getPrevious=function(a){var b=this.map[a];return b?b.Previous.Data:void 0},a.prototype.insertBefore=function(a,b){var c=this.getIdFromData(a);if(this.map[c])throw Error("Data with duplicate id: "+c);this.insertItemBefore({Data:a},this.map[b])},a.prototype.insertAfter=function(a,b){var c=this.getIdFromData(a);if(this.map[c])throw Error("Data with duplicate id: "+c);this.insertItemAfter({Data:a},this.map[b])},a.prototype.moveBefore=function(a,b){if(a!==b){var c=this.removeItemById(a);c&&this.insertItemBefore(c,this.map[b])}},a.prototype.moveAfter=function(a,b){if(a!==b){var c=this.removeItemById(a);c&&this.insertItemAfter(c,this.map[b])}},a.prototype.removeById=function(a){var b=this.removeItemById(a);return b&&b.Data},a.prototype.setItems=function(a){var b=this;this.count=0,this.map={},this.head={},this.head.Next=this.head.Previous=this.head,a.forEach(function(a){return b.insertItemBefore({Data:a},b.head)})},a.prototype.getIdFromData=function(a){throw Error("to be overridden.")},a.prototype.insertItemBefore=function(a,b){b=b||this.head,a.Next=b,a.Previous=b.Previous,b.Previous.Next=a,b.Previous=a,this.map[this.getIdFromData(a.Data)]=a,++this.count},a.prototype.insertItemAfter=function(a,b){b=b||this.head,a.Previous=b,a.Next=b.Next,b.Next.Previous=a,b.Next=a,this.map[this.getIdFromData(a.Data)]=a,++this.count},a.prototype.removeItemById=function(a){var b=this.map[a];return b?(b.Next.Previous=b.Previous,b.Previous.Next=b.Next,delete this.map[a],--this.count,b):void 0},a}();a.MappingList=b}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function b(){}return Object.defineProperty(b,"LocalizedStrings",{get:function(){return b.localizedStrings},enumerable:!0,configurable:!0}),Object.defineProperty(b,"UniversalHeaderAndFooter",{get:function(){return b.universalHeaderAndFooter},enumerable:!0,configurable:!0}),b.loadLocalizedStrings=function(){return b.deferredLocalizedStrings||(b.deferredLocalizedStrings=$.Deferred(),a.PageMethods.getResourceStrings(function(a){b.localizedStrings=a,b.deferredLocalizedStrings.resolve(a)},function(a){return b.deferredLocalizedStrings.reject(a)})),b.deferredLocalizedStrings.promise()},b.loadLanguageStrings=function(c){if(!c)return b.loadLocalizedStrings();var d=b.languageStrings[c];if(!d){var e=$.Deferred();d=e.then(function(a){return b.localizedStrings=a,a}),b.languageStrings[c]=d,a.PageMethods.getLocalizedResourceStrings(c,function(a){return e.resolve(a)},function(a){b.loadLocalizedStrings().done(function(a){return e.resolve(a)})})}return d},b.loadUniversalHeaderAndFooter=function(){var c=this;return b.deferredUniversalHeaderAndFooter||(b.deferredUniversalHeaderAndFooter=$.Deferred(),a.PageMethods.getUniversalHeaderAndFooter("headerId=OfficeFormsHeader&footerid=OfficeFormsFooter",function(a){c.universalHeaderAndFooter=a,b.deferredUniversalHeaderAndFooter.resolve(a)},function(a){return b.deferredUniversalHeaderAndFooter.reject(a)})),b.deferredUniversalHeaderAndFooter.promise()},b.languageStrings={},b}();b.Resources=c,a.Exports.Resources=c}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a,b){n("TryAcquireToken",void 0,void 0,a,b)}function d(a,b,c){var d="GetResourceStrings",e=void 0;a&&(e="lang="+a),n(d,e,void 0,b,c)}function e(b,c){var e=a.EnvironmentConfig.getExplictLocale();return d(e,b,c)}function f(a,b){n("GetRefreshedAntiForgeryToken",void 0,void 0,function(b){OfficeFormServerInfo.antiForgeryToken=b,a&&a()},b)}function g(a,b){n("GetUserInfo",void 0,void 0,function(b){OfficeFormServerInfo.userInfo=b,a&&a()},b)}function h(){return m("GetFormTemplates",void 0,void 0,void 0)}function i(){return m("GetMSATemplates",void 0,void 0,void 0)}function j(a){return m("GetUserInfo",void 0,void 0,l(a)).then(function(a){a&&(OfficeFormServerInfo.userInfo=a)})}function k(a){return m("GetFlights",void 0,void 0,l(a)).then(function(a){a&&(OfficeFormServerInfo.flights=a)})}function l(a){return{Accept:"application/json",Authorization:a?"Bearer "+a:""}}function m(b,c,d,e){var f;f="/"===window.location.pathname?"/Default.aspx/"+b:window.location.pathname+"/"+b,c&&(f+="?"+c);var g=new a.Event.QosEventDeprecated(a.Event.QosEventNames.ServiceEndpoints.PageMethod.MethodNameFormat.format(b));return g.start(),$.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:f,data:d||"{}",dataType:"json",headers:e}).then(function(a){return g.end({resultType:"Success"}),a.d},function(a,c,d){return g.end({resultType:"Failure",extraData:{url:f,message:d}}),{message:d,name:"PageMethod CallWebMethod Failure: "+b}})}function n(a,b,c,d,e){m(a,b,c,void 0).done(d).fail(e)}function o(b,c,d){var e=a.EnvironmentConfig.getExplictLocale()||navigator.language,f="https://uhf.microsoft.com/"+e+"/shell/xml/OfficeForms";b&&(f+="?"+b),$.ajax({type:"GET",url:f,dataType:"xml",success:function(a){c&&c(a)},error:function(b){d&&d(b),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.Error.UHF.UniversalHeaderAndFooterError,extraData:{error:b}})}})}a.Exports.PageMethods=b,b.tryAcquireToken=c,b.getLocalizedResourceStrings=d,b.getResourceStrings=e,b.refreshAntiForgeryToken=f,b.refreshUserInfo=g,b.getFormTemplates=h,b.getMSATemplates=i,b.refreshUserInfoWithToken=j,b.refreshFlightsWithToken=k,b.getUniversalHeaderAndFooter=o}(b=a.PageMethods||(a.PageMethods={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){function b(a,b,c){c&&c.stack&&console.log(c.stack);try{if(window.onerror){var d=ReactDOM.findDOMNode(a),e=d&&d.getAttribute("data-reactId")||"",f="Exception in "+a.constructor.name+"["+e+"]:"+b+".";c.message&&(f+=" Message: "+c.message),window.onerror(f,"",0,0,c)}}catch(c){}}function c(a){e.forEach(function(c){var d=a[c];d&&(a[c]=function(){try{return d.apply(a,arguments)}catch(e){return b(a,c,e),null}})})}var d=function(a){function b(b){var d=a.call(this,b)||this;return d.state={},c(d),d}return __extends(b,a),b}(React.Component);a.ReactComponent=d;var e=["componentWillMount","componentDidMount","componentWillReceiveProps","shouldComponentUpdate","componentWillUpdate","componentDidUpdate","componentWillUnmount","render"]}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b=function(){function a(){}return a.getId=function(b){return a.currentIds[b]||(a.currentIds[b]=1),b+a.currentIds[b]++},a.getLabelId=function(){return a.getId("l")},a.getDropdownId=function(){return a.getId("Dropdown")},a.currentIds={},a}();a.UniqueIdentifier=b}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){function b(){return c||(c=new d)}var c;a.getUserRepository=b;var d=function(){function b(){this.userStateChangeCallbackManager=new a.Utilities.Process.CallbackManager,this.users={}}return b.prototype.registerUsersStateChange=function(a){this.userStateChangeCallbackManager.register(a)},b.prototype.unregisterUsersStateChange=function(a){this.userStateChangeCallbackManager.unregister(a)},b.prototype.getUser=function(a){return _.clone(this.users[a])},b.prototype.getAllUsers=function(){return _.values(a.Utilities.deepClone(this.users))},b.prototype.getUserCount=function(){return _.keys(this.users).length},b.prototype.addOrUpdateUser=function(a){if(b.isValidUser(a)){var c=this.users[a.userId];if(null!=c){if(b.isValidUser(c))return;_.extend(c,a)}else this.users[a.userId]=a;this.userStateChangeCallbackManager.trigger()}},b.prototype.removeUser=function(a){delete this.users[a.userId]&&this.userStateChangeCallbackManager.trigger()},b.prototype.removeAllUsers=function(){this.getUserCount()>0&&(this.users={},this.userStateChangeCallbackManager.trigger())},b.isValidUser=function(a){return a&&a.userId&&a.displayName&&a.firstName&&a.lastName&&a.email&&a.imageUri?!0:!1},b}();a.UserRepository=d}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(f,__assign({},a))}function d(a){var b;b=_.clone(a)||{},b.children=a.Text;var d=b.HTMLAttributes&&b.HTMLAttributes.title;return!d&&a.Text&&(b.HTMLAttributes=_.clone(b.HTMLAttributes)||{},b.HTMLAttributes.title=a.Text),c(b)}var e;!function(a){a[a.None=0]="None",a[a.LightBackground=1]="LightBackground",a[a.DarkBackGround=2]="DarkBackGround"}(e=b.ButtonStyle||(b.ButtonStyle={})),b.createButton=c;var f=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.render=function(){var b=_.extend({},this.props.HTMLAttributes);switch(b.className=a.Utilities.Html.combineAttributes(b.className,"button-control"),b["aria-pressed"]=this.props.ToggleActive,this.props.ToggleActive&&(b.className=a.Utilities.Html.combineAttributes(b.className,"active")),this.props.ButtonStyle){case e.LightBackground:case"LightBackground":b.className=a.Utilities.Html.combineAttributes(b.className,"light-background-button");break;case e.DarkBackGround:case"DarkBackGround":b.className=a.Utilities.Html.combineAttributes(b.className,"dark-background-button");break;case e.None:case"None":}return React.createElement("button",__assign({},b),React.createElement("div",{className:"button-content"},this.props.children))},c.prototype.focus=function(){var a=ReactDOM.findDOMNode(this);a.focus()},c.prototype.setTabIndex=function(a){var b=ReactDOM.findDOMNode(this);b.setAttribute("tabIndex",a.toString())},c}(a.ReactComponent);b.Button=f,b.createTextButton=d}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(e,__assign({},a))}var d;!function(a){a[a.Bar=0]="Bar",a[a.Pie=1]="Pie"}(d=b.ChartType||(b.ChartType={})),b.createChartControl=c;var e=function(c){function e(){var a=null!==c&&c.apply(this,arguments)||this;return a.backgroundColors=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],a.highlightColors=[],a}return __extends(e,c),e.prototype.render=function(){return this.isValidChart()?React.createElement("div",{"aria-label":a.Form.Resources.LocalizedStrings.ChartControl_GroupContainer,className:"chart-control-container",tabIndex:-1},this.createChartLegend(),this.createChartCanvas()):null},e.prototype.componentDidMount=function(){this.updateChartDataView()},e.prototype.shouldComponentUpdate=function(a){return!_.isEqual(this.props,a)||!this.wasChartVisible},e.prototype.componentDidUpdate=function(){this.updateChartDataView()},e.prototype.componentWillUnmount=function(){this.destroyChart()},e.prototype.isValidChart=function(){return this.props.Labels&&this.props.Data&&this.props.Labels.length===this.props.Data.data.length&&this.props.Labels.length>0},e.prototype.destroyChart=function(){this.chartInstance&&(this.chartInstance.destroy(),this.chartInstance=null)},e.prototype.updateChartDataView=function(){if(this.isValidChart()){var a=ReactDOM.findDOMNode(this.refs.canvas);if(this.wasChartVisible=$(a).is(":visible"),this.wasChartVisible){var b=a.getContext("2d");switch(this.generateColors(),this.props.Type){case d.Bar:this.createBarChart(b),this.setChartLegend();break;case d.Pie:this.createPieChart(b),this.setChartLegend()}}}},e.prototype.getChartCanvasLabels=function(){return this.props.Labels?this.props.Labels.map(function(c,d){return null!=c.labelName?b.RichTextUtil.stripSupportedTagsButLeaveDangerousOnes(c.labelName):a.Form.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(d+1)}):void 0},e.prototype.createBarChart=function(a){var b="'wf_segoe-ui_light', 'Segoe UI Light','Segoe WP Light','Segoe UI','Segoe WP',Tahoma, Arial, sans-serif",c={responsive:!1,layout:{padding:{left:10}},animation:{duration:1e3},scales:{yAxes:[{ticks:{fontSize:10,min:0,fontFamily:b,fontColor:"#000000",callback:function(a){return a%1===0?a:void 0}}}],xAxes:[{ticks:{fontSize:10,fontFamily:b,fontColor:"#000000",callback:function(){return""}}}]},legend:{display:!1}};this.destroyChart(),this.chartInstance=new Chart(a,{type:"bar",data:this.generateChartData(),options:c})},e.prototype.generateColors=function(){var a=this;this.usingColors=this.props.Data.data.map(function(b,c){var d=a.backgroundColors[c%a.backgroundColors.length];return a.highlightColors.push(a.lightenDarkenColor(d,10)),d})},e.prototype.generateChartData=function(){var a={labels:this.getChartCanvasLabels(),datasets:[{backgroundColor:this.usingColors,data:this.props.Data.data,hoverBackgroundColor:this.highlightColors}]};return a},e.prototype.createPieChart=function(a){var b={responsive:!1,animation:{duration:1e3},cutoutPercentage:0,tooltips:{callbacks:{label:function(a,b){return b.labels[a.index]+": "+b.datasets[a.datasetIndex].data[a.index]+" ("+Math.round(this._active[0]._view.circumference/6.283*100)+"%)"}}},legend:{display:!1}};this.destroyChart(),this.chartInstance=new Chart(a,{type:"pie",data:this.generateChartData(),options:b})},e.prototype.lightenDarkenColor=function(a,b){var c=parseInt(a.slice(1),16),d=Math.round(2.55*b),e=(c>>16)+d,f=(c>>8&255)+d,g=(255&c)+d;return"#"+(16777216+65536*(255>e?1>e?0:e:255)+256*(255>f?1>f?0:f:255)+(255>g?1>g?0:g:255)).toString(16).slice(1)},e.prototype.setChartLegend=function(){var a=this;if(this.props.HasLegend){var b=ReactDOM.findDOMNode(this.refs["legend-table"]),c=ReactDOM.findDOMNode(this.refs["legend-table-tbody"]),d=c.childNodes;d&&d.length>0&&(_.each(d,function(b,c){Chart.helpers.addEvent(b,"mouseover",function(){a.handleEvent("mouseover",c)});var d=b.getElementsByClassName("chart-control-legend-canvas-color");if(d){var e=d[0].getContext("2d");e.fillStyle=a.chartInstance.data.datasets[0].backgroundColor[c],e.beginPath(),e.arc(7.5,7.5,7.5,0,2*Math.PI,!0),e.closePath(),e.fill()}}),Chart.helpers.addEvent(b,"mouseout",function(){a.handleEvent("mouseout",0)}))}},e.prototype.handleEvent=function(a,b){this.chartInstance.active="mouseout"===a?[]:[this.chartInstance.getDatasetMeta(0).data[b]],this.chartInstance.lastActive=this.chartInstance.lastActive||[],this.chartInstance.lastActive.length&&this.chartInstance.updateHoverStyle(this.chartInstance.lastActive,this.chartInstance.options.hover.mode,!1),this.chartInstance.active.length&&this.chartInstance.updateHoverStyle(this.chartInstance.active,this.chartInstance.options.hover.mode,!0);var c=!Chart.helpers.arrayEquals(this.chartInstance.active,this.chartInstance.lastActive);if(c){this.chartInstance.lastActive=this.chartInstance.active;var d=this.chartInstance.tooltip;d._active=this.chartInstance.active,d._lastActive=d._lastActive||[],d.update(!0),d.pivot();var e=this.chartInstance._bufferedRequest;e?this.chartInstance.render(e.duration,e.lazy):c&&!this.chartInstance.animating&&(this.chartInstance.stop(),this.chartInstance.render(this.chartInstance.options.hover.animationDuration,!0)),this.chartInstance._bufferedRender=!1,this.chartInstance._bufferedRequest=null}},e.prototype.createChartLegend=function(){var c=this;return this.props.HasLegend?React.createElement("div",{"aria-label":a.Form.Resources.LocalizedStrings.ChartControl_LegendGroup,className:"chart-control-legend",tabIndex:-1},React.createElement("table",{className:"chart-control-legend-table",ref:"legend-table"},React.createElement("tbody",{ref:"legend-table-tbody"},this.props.Labels.map(function(a,d){return React.createElement("tr",{className:"chart-control-legend-table-row",key:d},React.createElement("td",{role:"presentation"},React.createElement("canvas",{role:"presentation",className:"chart-control-legend-canvas-color",width:"15px",height:"15px"})),React.createElement("td",{role:"presentation",className:"chart-control-legend-label"},null!=a.displayElement?a.displayElement:React.createElement(b.UserTextRenderer,{Text:a.labelName,RenderMode:b.UserTextRenderMode.RichText})),React.createElement("td",{role:"presentation",className:"chart-control-legend-value"},c.props.Data.data[d]),c.getLegendCorrectTag(a.labelName))})))):void 0},e.prototype.createChartCanvas=function(){var b,c={className:"chart-control",tabIndex:-1,"aria-label":a.Form.Resources.LocalizedStrings.ChartControl_ChartGroup},e=a.Utilities.Html.getWindowWidth()<400||a.Utilities.isMobile(),f=e?187:250,g=e?300:400;return b=this.props.Type===d.Bar?{role:"presentation",className:"chart-control-canvas",width:g,height:f,ref:"canvas"}:{role:"presentation",className:"",width:300,height:150,ref:"canvas"},React.createElement("div",__assign({},c),React.createElement("canvas",__assign({},b)))},e.prototype.getLegendCorrectTag=function(c){var d,e={role:"presentation",className:"chart-control-legend-table-correct",title:this.props.TagLabels[c]?a.Form.Resources.LocalizedStrings.Quiz_CorrectAnswer:void 0};return this.props.TagLabels[c]&&(d=React.createElement(b.FontIconControl,{IconName:"CheckMark",HTMLAttributes:{className:"forms-icon-size14x14"}})),React.createElement("td",__assign({},e),d)},e}(a.ReactComponent);b.ChartControl=e}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.render=function(){var b=_.extend({},this.props.HTMLAttributes);return this.props.ValidationStyle&&(b.className=a.Utilities.Html.combineAttributes(b.className,this.props.ValidationStyle)),this.props.Hidden&&(b.style=b.style||{},b.style.display="none"),(c=React.DOM).div.apply(c,[b].concat(this.createReactNodes()));var c},c.prototype.createReactNodes=function(){throw Error("to be overridden.")},c}(a.ReactComponent);b.ControlBase=c}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(d,a)}b.createCheckBox=c;var d=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;return a.name=void 0,a}return __extends(d,c),d.prototype.componentWillMount=function(){this.props.RadioCheckbox&&(this.name=a.Utilities.Guid.newGuid())},d.prototype.createReactNodes=function(){var c=this.props,d=c.RadioCheckbox?"radio":"checkbox",e=c.Options,f=e&&e.classNameForInnerDiv,g=a.Utilities.Html.combineAttributes(d,e&&e.classNameForInnerLabel),h=c.Disabled,i=c.HelpText||void 0,j=a.Utilities.Html.mergeReactProps(e&&e.HTMLPropsForInnerElement,{checked:c.Value,disabled:h,name:this.name,type:d,onChange:this.onChange.bind(this),className:this.props.ClassName,ref:this.props.CheckboxRef,autoFocus:c.CheckboxAutoFocus}),k=([].concat(c.children),React.DOM.div({className:g},React.DOM.label({disabled:h},React.DOM.input(j),React.DOM.span({className:this.props.SpanClassName},c.Description),c.ShowRequiredStar?React.createElement(b.RequiredStar):void 0)));return[React.DOM.div({className:f,id:c.Id,disabled:h,title:i},k,c.children)]},d.prototype.onChange=function(a){this.props.onValueChange(a.nativeEvent.target.checked)},d}(b.ControlBase)}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function a(){}return Object.defineProperty(a,"None",{get:function(){return""},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Success",{get:function(){return"has-success"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Warning",{get:function(){return"has-warning"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"Error",{get:function(){return"has-error"},enumerable:!0,configurable:!0}),a}();b.ValidationStyles=c;var d=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.render=function(){return React.DOM.span({className:"required-star"})},b}(a.ReactComponent);b.RequiredStar=d}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){a.Exports.Control=b}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(e,a)}var d;!function(a){a[a.DatePicker=0]="DatePicker",a[a.TimePicker=1]="TimePicker",a[a.DateTimePicker=2]="DateTimePicker"}(d=b.PickerType||(b.PickerType={})),b.createDateTimePicker=c;var e=function(c){function e(){return null!==c&&c.apply(this,arguments)||this}return __extends(e,c),e.prototype.createReactNodes=function(){var a=this.props,b=a.Options,c=b&&b.classNameForInnerDiv,d=b&&b.classNameForInnerLabel,e=a.Disabled;return[a.Label?React.DOM.span({className:d,disabled:e},a.Label):void 0,React.DOM.div({className:c,disabled:e},this.hasDatePicker()?this.createDatePicker():void 0,this.hasTimePicker()?this.createTimePicker():void 0,a.children)]},e.prototype.componentWillMount=function(){void 0===e.timeFormat&&this.hasTimePicker()&&(e.timeFormat=OfficeFormServerInfo.cultureInfo.DateTimeFormat.ShortTimePattern,e.timeFormat=e.timeFormat.replace(/mm/g,"i").replace(/tt/g,"A").replace(/s/g,"0"),(e.timeFormat.indexOf("m")>=0||e.timeFormat.indexOf("t")>=0)&&(e.timeFormat=null))},e.prototype.componentDidMount=function(){var b=this,c=a.Form.Resources.LocalizedStrings;if(this.hasDatePicker()){var d=ReactDOM.findDOMNode(this.refs.date_picker),f=$(d).pickadate({monthsShort:OfficeFormServerInfo.cultureInfo.DateTimeFormat.AbbreviatedMonthNames,weekdaysShort:OfficeFormServerInfo.cultureInfo.DateTimeFormat.AbbreviatedDayNames,firstDay:OfficeFormServerInfo.cultureInfo.DateTimeFormat.FirstDayOfWeek,today:c.DateTimePicker_Button_Today||void 0,clear:this.props.ShowClearButton?c.DateTimePicker_Button_Clear||void 0:"",close:c.DateTimePicker_Button_Close||void 0,labelMonthNext:c.DateTimePicker_Label_NextMonth||void 0,labelMonthPrev:c.DateTimePicker_Label_PrevMonth||void 0,labelMonthSelect:c.DateTimePicker_Label_SelectMonth||void 0,labelYearSelect:c.DateTimePicker_Label_SelectYear||void 0,closeOnClear:!1,editable:!0,selectYears:200,selectMonths:!1,showMonthsShort:!0,onSet:function(c){if(void 0!==c.clear)return void b.setDate(void 0);if(null!=c.select){var d;d=a.Utilities.Type.isNumber(c.select)?new Date(c.select):c.select.obj,b.setDate(d)}}});this.datePicker=f.pickadate("picker")}if(this.hasTimePicker()){var g=ReactDOM.findDOMNode(this.refs.time_picker),h=$(g).pickatime({clear:"",format:e.timeFormat,editable:!0,interval:30,select:this.getTimeNumber(),onSet:function(c){if(null!=c.select){var d;if(b.hasDatePicker()){var e,f,g=new Date(b.props.Value);a.Utilities.Type.isNumber(c.select)?(e=c.select%60,f=(c.select-e)/60):(f=c.select.hour,e=c.select.mins),g.setHours(f,e,0,0),d=g.toJSON()}else d=c.select.toString();b.props.Value!==d&&(b.props.onValueChange(d),b.forceUpdate())}}});this.timePicker=h.pickatime("picker")}this.updateDateTimePickers()},e.prototype.componentDidUpdate=function(){this.updateDateTimePickers()},e.prototype.createDatePicker=function(){var c=this,d=this.props,e=d.Options&&d.Options.HTMLPropsForInnerElement;return React.DOM.div({className:"office-form-date-time-picker office-form-theme-focus-border"},React.DOM.input(a.Utilities.Html.mergeReactProps(e,{className:"form-control border-no-radius datepicker",disabled:d.Disabled,placeholder:d.Placeholder||OfficeFormServerInfo.cultureInfo.DateTimeFormat.ShortDatePattern,ref:"date_input",onFocus:function(){d.onValueValidation&&d.onValueValidation(!0,!0)},onBlur:function(){var a=ReactDOM.findDOMNode(c.refs.date_input),b=a.value,d=c.props;if(""===b&&null!=d.Value&&d.ShowClearButton)c.datePicker.clear(),c.setDate(void 0);else if(b&&b!==c.getDateString()){var e=Date.parseDate(b,OfficeFormServerInfo.cultureInfo.DateTimeFormat.ShortDatePattern,OfficeFormServerInfo.cultureInfo);null==e?d.onValueValidation&&d.onValueValidation(!1,!0):c.setDate(e)}},onClick:function(){d.Disabled||c.datePicker.open()},onKeyUp:a.Utilities.Html.onKeyboardEvent(function(a){return a.stopPropagation()},a.KeyCode.Esc)})),b.createGlyphButton({ButtonStyle:b.ButtonStyle.LightBackground,GlyphButtonStyle:b.GlyphButtonStyle.GlyphOnly,Icon:"Calendar",IconClassName:"dateIcon forms-icon-size20x20",HTMLAttributes:{disabled:d.Disabled,tabIndex:-1,onClick:function(){d.Disabled||c.datePicker.open()},title:d.DateTitle,"aria-label":d.DateTitle}}),React.DOM.input({ref:"date_picker",style:{display:"none"}}))},e.prototype.createTimePicker=function(){var c=this,d=this.props;return React.DOM.div({className:"office-form-date-time-picker office-form-theme-focus-border"},React.DOM.input({className:"form-control border-no-radius datepicker",disabled:d.Disabled,placeholder:OfficeFormServerInfo.cultureInfo.DateTimeFormat.ShortTimePattern,readOnly:!0,tabIndex:-1,ref:"time_picker",onFocus:function(){d.onValueValidation&&d.onValueValidation(!0,!1)},onBlur:function(){var a=ReactDOM.findDOMNode(c.refs.time_picker),b=a.value;if(b&&b!==c.getTimeString()){var d=c.props,e=void 0;e=c.hasDatePicker()?new Date(d.Value):new Date;var f=Date.parseTime(b,OfficeFormServerInfo.cultureInfo.DateTimeFormat.ShortTimePattern,OfficeFormServerInfo.cultureInfo);if(isNaN(f))d.onValueValidation&&d.onValueValidation(!1,!1);else{var g=Math.floor(f/1e3/60/60),h=f/1e3/60%60,i=f/1e3%60;e.setHours(g,h,i),c.setDate(e,!0)}}},onKeyUp:a.Utilities.Html.onKeyboardEvent(function(a){return a.stopPropagation()},a.KeyCode.Esc)}),b.createGlyphButton({ButtonStyle:b.ButtonStyle.LightBackground,GlyphButtonStyle:b.GlyphButtonStyle.GlyphOnly,Icon:"ChevronDown",IconClassName:"dateCaretDown forms-icon-size16x16",HTMLAttributes:a.Utilities.Html.mergeReactProps(d.Options&&d.Options.HTMLPropsForInnerElement,{disabled:d.Disabled,onClick:function(){d.Disabled||c.timePicker.open()},title:d.TimeTitle,
"aria-label":d.TimeTitle})}))},e.prototype.hasDatePicker=function(){return this.props.Type!==d.TimePicker},e.prototype.hasTimePicker=function(){return this.props.Type!==d.DatePicker},e.prototype.isValueInvalid=function(){var a=this.props.Value;return this.hasDatePicker()?isNaN(Date.parse(a)):isNaN(Number(a))},e.prototype.getDateNumber=function(){if(!this.hasDatePicker()||this.isValueInvalid())return void 0;if(this.props.IsLocaleInvariant){var a=e.parseLocaleInvariantString(this.props.Value);return a.valueOf()}return Date.parse(this.props.Value)},e.prototype.getDateString=function(){if(!this.hasDatePicker())return void 0;if(this.isValueInvalid())return"";var a=this.props.IsLocaleInvariant?Date.parseDate(this.props.Value,"yyyy-MM-dd",OfficeFormServerInfo.cultureInfo):new Date(this.props.Value);return a.toDateShortString(OfficeFormServerInfo.cultureInfo)},e.prototype.getTimeNumber=function(){if(!this.hasTimePicker()||this.isValueInvalid())return void 0;if(this.hasDatePicker()){var a=new Date(this.props.Value);return 60*a.getHours()+a.getMinutes()}return parseInt(this.props.Value)},e.prototype.getTimeString=function(){if(!this.hasTimePicker())return void 0;if(this.isValueInvalid())return"";var a=new Date(this.props.Value);return a.toLocaleTimeString(OfficeFormServerInfo.cultureInfo.Name)},e.prototype.setDate=function(a,b){var c=this.props,d=void 0;if(null!=a){var f=new Date(c.Value);f.setFullYear(a.getFullYear(),a.getMonth(),a.getDate()),b&&f.setHours(a.getHours(),a.getMinutes(),a.getSeconds()),d=c.IsLocaleInvariant?e.formatLocaleInvariantString(f,!this.hasTimePicker()):f.toJSON()}c.Value!==d&&(c.onValueChange(d),this.forceUpdate())},e.prototype.updateDateTimePickers=function(){var b=this.props,c=new Date(b.Value),d={Start:void 0,End:void 0},e=!1,f=!1;if(b.AllowedDateTime&&(b.AllowedDateTime.Start&&(d.Start=new Date(b.AllowedDateTime.Start.toJSON()),d.Start.setMinutes(60,0,0),e=a.Utilities.DateTime.isLocalDateEqual(d.Start,c),a.Utilities.DateTime.compareLocalTime(d.Start,c)>0&&d.Start.setDate(d.Start.getDate()+1)),b.AllowedDateTime.End&&(d.End=new Date(b.AllowedDateTime.End.toJSON()),d.End.setMinutes(0,0,0),f=a.Utilities.DateTime.isLocalDateEqual(d.End,c),a.Utilities.DateTime.compareLocalTime(d.End,c)<0&&d.End.setDate(d.End.getDate()-1))),this.hasDatePicker()){this.datePicker.set({min:void 0!==d.Start&&d.Start,max:void 0!==d.End&&d.End,select:this.getDateNumber()});var g=ReactDOM.findDOMNode(this.refs.date_input);g.value=this.getDateString()}this.hasTimePicker()&&this.timePicker.set({min:e&&d.Start,max:f&&d.End,select:this.getTimeNumber()})},e.formatLocaleInvariantString=function(a,b){var c=new Date;c.setUTCFullYear(a.getFullYear(),a.getMonth(),a.getDate()),c.setUTCHours(a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds());var d=c.toISOString();return d.slice(0,d.indexOf(b?"T":"Z"))},e.parseLocaleInvariantString=function(a){var b=new Date(a);return b.setFullYear(b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()),b.setHours(b.getUTCHours(),b.getUTCMinutes(),b.getUTCSeconds(),b.getUTCMilliseconds()),b},e.parseJSONArray=function(a){try{var b=JSON.parse(a);if(Array.isArray(b))return b}catch(c){}return void 0},e}(b.ControlBase)}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(d,__assign({},a))}b.createFontIconControl=c;var d=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.render=function(){var b=_.clone(this.props.HTMLAttributes)||{};return b.className=a.Utilities.Html.combineAttributes("ms-Icon",this.props.IconName?"ms-Icon--"+this.props.IconName:"",b.className),this.props.Accessible||(b.role="presentation",b["aria-hidden"]="true"),React.createElement("i",__assign({},b))},c}(a.ReactComponent);b.FontIconControl=d}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){function b(b){return a.createMathjaxFormulaRenderer(b)}a.createFormulaRenderer=b}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(d,__assign({},a))}b.createMathjaxFormulaRenderer=c;var d=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a.mounted=!0,a}return __extends(c,b),c.prototype.componentWillMount=function(){var b=this;a.JavaScriptLoader.loadJavaScript("MathJax").done(function(){b.mounted&&b.setState({MathJaxLoaded:!0}),MathJax.Hub.processSectionDelay=2})},c.prototype.componentDidMount=function(){this.state.MathJaxLoaded&&this.props.Formula&&this.renderFormula()},c.prototype.componentDidUpdate=function(){this.state.MathJaxLoaded&&this.props.Formula&&this.renderFormula()},c.prototype.componentWillUnmount=function(){this.mounted=!1},c.prototype.shouldComponentUpdate=function(a,b){return a.Formula!==this.props.Formula||b.MathJaxLoaded!==this.state.MathJaxLoaded},c.prototype.render=function(){if(this.props.Formula){var a="formula-renderer-container unselectable-text";return c.isSafari9&&(a+=" formula-renderer-container-safari9"),React.createElement("div",{className:a,"aria-hidden":"true",onContextMenu:function(){return!1}},React.createElement("div",{className:"formula-loading",ref:"formulaLoading"},React.createElement("div",{className:"spinner-tile-animation"})),React.createElement("span",{className:"NotVisible",ref:"formulaElement"},this.props.Formula?"$"+this.props.Formula+"$":""))}return React.createElement("div",{className:"formula-renderer-container"})},c.prototype.renderFormula=function(){var b=this,c=function(c){var d=ReactDOM.findDOMNode(b.refs.formulaElement);if(!d)return void(c&&c());var f=b.props.Formula,g=e.get(f);return g?(b.hideSpinnerAndShowFormula(d),d.innerHTML=g.dom,b.props.onRenderComplete&&b.props.onRenderComplete(g.originalText,g.mathML),void(c&&c())):(MathJax.Hub.Queue(["Typeset",MathJax.Hub,d]),void MathJax.Hub.Queue(function(){if(b.mounted){b.hideSpinnerAndShowFormula(d);var g=MathJax.Hub.getAllJax(d),h=null,i=null;if(g.length>0)try{h=g[0].root.toMathML(""),i=g[0].originalText}catch(j){a.Utilities.assert(!1,"Failed to get mathML:"+f)}e.set(f,{dom:d.innerHTML,originalText:i,mathML:h}),b.props.onRenderComplete&&b.props.onRenderComplete(i,h)}c&&c()}))};e.get(this.props.Formula)?c(null):f.enqueue(this.props.Formula,c)},c.prototype.hideSpinnerAndShowFormula=function(a){var b=ReactDOM.findDOMNode(this.refs.formulaLoading);b&&(b.className="dn"),a.className=""},c.isSafari9=a.Utilities.isSafari9(),c}(a.ReactComponent);b.MathjaxFormulaRenderer=d;var e=function(){function a(){}return a.set=function(b,c){if(b&&!a.cache[b]&&(a.order.push(b),a.cache[b]=c,a.order.length>a.cacheLimit)){var d=a.order.shift();delete a.cache[d]}},a.get=function(b){return b?a.cache[b]:null},a.cacheLimit=200,a.cache={},a.order=[],a}(),f=function(){function b(){}return b.enqueue=function(a,c){b.priorityMap[a]?(b.priorityMap[a].count++,b.internalEnqueue({key:a,priority:b.priorityMap[a].priority,task:c})):(b.currentPriority++,b.priorityMap[a]={priority:b.currentPriority,count:1},b.internalEnqueue({key:a,priority:b.currentPriority,task:c}))},b.internalEnqueue=function(a){b.queue.push(a),b.bubbleUp(b.queue.length-1),b.isProcessing||b.process()},b.process=function(){b.isProcessing=!0,b.queue[0].task(b.onRenderComplete)},b.onRenderComplete=function(){var c=b.queue.shift().key;b.priorityMap[c].count--,0===b.priorityMap[c].count&&delete b.priorityMap[c],b.queue.length>0?b.process():(a.Utilities.assert(_.isEqual(b.priorityMap,{}),"FormulaRenderQueue: priority map should be empty"),b.isProcessing=!1,b.currentPriority=0)},b.bubbleUp=function(a){for(var c=b.getParent(a);c>=0&&b.queue[c].priority>b.queue[a].priority;)b.swap(c,a),a=c,c=b.getParent(a)},b.swap=function(a,c){var d=b.queue[a];b.queue[a]=b.queue[c],b.queue[c]=d},b.getParent=function(a){return Math.floor((a-1)/2)},b.queue=[],b.priorityMap={},b.currentPriority=0,b.isProcessing=!1,b}()}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(c){var f=_.clone(c)||{};switch(f.HTMLAttributes=_.clone(f.HTMLAttributes)||{},c.GlyphButtonStyle){case d.Vertical:case"Vertical":f.HTMLAttributes.className=a.Utilities.Html.combineAttributes(f.HTMLAttributes.className,"glyph-button-control-vertical");break;case d.GlyphOnly:case"GlyphOnly":case d.Horizontal:case"Horizontal":default:f.HTMLAttributes.className=a.Utilities.Html.combineAttributes(f.HTMLAttributes.className,"glyph-button-control-horizontal")}!f.HTMLAttributes.title&&c.Text&&(f.HTMLAttributes.title=c.Text),!f.HTMLAttributes["aria-label"]&&c.Text&&(f.HTMLAttributes["aria-label"]=c.Text);var g;if(c.Icon){var h={HTMLAttributes:{className:c.IconClassName},IconName:c.Icon,key:"icon"};g=React.createElement(b.FontIconControl,__assign({},h))}f.ButtonStyle=c.ButtonStyle;var i;switch("GlyphOnly"!==c.GlyphButtonStyle&&c.GlyphButtonStyle!==d.GlyphOnly&&(i=React.DOM.span({className:c.TextClassName,key:"text"},c.Text)),c.GlyphLocation){case e.Right:f.children=[i,c.children,g];break;case e.Left:default:f.children=[g,i,c.children]}return b.createButton(f)}var d;!function(a){a[a.Horizontal=0]="Horizontal",a[a.Vertical=1]="Vertical",a[a.GlyphOnly=2]="GlyphOnly"}(d=b.GlyphButtonStyle||(b.GlyphButtonStyle={}));var e;!function(a){a[a.Left=0]="Left",a[a.Right=1]="Right"}(e=b.GlyphLocation||(b.GlyphLocation={})),b.createGlyphButton=c}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(a){a[a.Bar=0]="Bar",a[a.Pie=1]="Pie",a[a.PieMainOthers=2]="PieMainOthers"}(c=b.InsightChartType||(b.InsightChartType={}));var d=function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;return a.backgroundColors=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],a.highlightColors=[],a}return __extends(d,b),d.prototype.render=function(){if(this.isValidChart()){var a={className:"insight-chart-control-container",tabIndex:-1};return React.createElement("div",__assign({},a),this.createChartCanvas())}return null},d.prototype.componentDidMount=function(){this.updateChartDataView()},d.prototype.shouldComponentUpdate=function(a){return!_.isEqual(this.props,a)||!this.wasChartVisible},d.prototype.componentDidUpdate=function(){this.updateChartDataView()},d.prototype.componentWillUnmount=function(){this.destroyChart()},d.prototype.isValidChart=function(){return this.props.Labels&&this.props.DataSets&&this.props.Labels.length>0},d.prototype.destroyChart=function(){this.chartInstance&&(this.chartInstance.destroy(),this.chartInstance=null)},d.prototype.updateChartDataView=function(){if(this.isValidChart()){var a=ReactDOM.findDOMNode(this.refs.canvas);if(this.wasChartVisible=$(a).is(":visible"),this.wasChartVisible){var b=a.getContext("2d");switch(this.props.Type){case c.Bar:this.generateBarColors(),this.createBarChart(b);break;case c.PieMainOthers:case c.Pie:this.generatePieColors(),this.createPieChart(b)}}}},d.prototype.createBarChart=function(a){var b="'wf_segoe-ui_light', 'Segoe UI Light','Segoe WP Light','Segoe UI','Segoe WP',Tahoma, Arial, sans-serif",c={responsive:!1,layout:{padding:{left:10}},animation:{duration:1e3},scales:{yAxes:[{ticks:{fontSize:10,min:0,fontFamily:b,fontColor:"#000000"}}],xAxes:[{ticks:{fontSize:10,fontFamily:b,fontColor:"#000000"}}]},legend:{display:!0}};this.destroyChart(),this.chartInstance=new Chart(a,{type:"bar",data:this.generateBarChartData(),options:c})},d.prototype.generateBarColors=function(){var a=this;this.usingColors=this.props.DataSets.map(function(b,c){var d=a.backgroundColors[c%a.backgroundColors.length];return a.highlightColors.push(a.lightenDarkenColor(d,10)),d})},d.prototype.generatePieColors=function(){var a=this;this.props.Type===c.PieMainOthers?(this.usingColors=["#FFC000","#CFCFCF"],this.highlightColors=this.usingColors.map(function(b){return a.lightenDarkenColor(b,10)})):this.usingColors=this.props.Labels.map(function(b,c){var d=a.backgroundColors[c%a.backgroundColors.length];return a.highlightColors.push(a.lightenDarkenColor(d,10)),d})},d.prototype.generateBarChartData=function(){var a=this,b={labels:this.props.Labels,datasets:this.props.DataSets.map(function(b,c){return{label:b.Label,data:b.Data,backgroundColor:a.usingColors[c],hoverBackgroundColor:a.highlightColors[c]}})};return b},d.prototype.generatePieChartData=function(){var a=this,b={labels:this.props.Labels,datasets:this.props.DataSets.map(function(b){return{backgroundColor:a.usingColors,data:b.Data,hoverBackgroundColor:a.highlightColors}})};return b},d.prototype.createPieChart=function(a){var b={responsive:!1,animation:{duration:1e3},cutoutPercentage:0,tooltips:{callbacks:{label:function(a,b){return b.labels[a.index]+": "+b.datasets[a.datasetIndex].data[a.index]+" ("+Math.round(this._active[0]._view.circumference/6.283*100)+"%)"}}},legend:{display:!0,position:"bottom",labels:{boxWidth:15}}};this.destroyChart(),this.chartInstance=new Chart(a,{type:"pie",data:this.generatePieChartData(),options:b})},d.prototype.lightenDarkenColor=function(a,b){var c=parseInt(a.slice(1),16),d=Math.round(2.55*b),e=(c>>16)+d,f=(c>>8&255)+d,g=(255&c)+d;return"#"+(16777216+65536*(255>e?1>e?0:e:255)+256*(255>f?1>f?0:f:255)+(255>g?1>g?0:g:255)).toString(16).slice(1)},d.prototype.createChartCanvas=function(){var b={className:"insight-chart-control",tabIndex:-1},c=a.Utilities.Html.getWindowWidth()<400||a.Utilities.isMobile(),d=c?187:250,e=c?300:400,f={className:"insight-chart-control-canvas",width:e,height:d,ref:"canvas"};return React.createElement("div",__assign({},b),React.createElement("canvas",__assign({},f)))},d}(a.ReactComponent);b.InsightChartControl=d}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){function b(a){var b=d(a);return e(b)}function c(a){return f.openingTags.forEach(function(b){a=a.replaceAll(b,"")}),f.closingTags.forEach(function(b){a=a.replaceAll(b,"")}),a}function d(a){var b=_.escape(a);return f.tagNames.forEach(function(a,c){b=b.replaceAll(f.encodedOpeningTags[c],f.openingTags[c]).replaceAll(f.encodedClosingTags[c],f.closingTags[c])}),b}function e(a){var b=document.createElement("span");return b.innerHTML=a,a=b.innerHTML}var f=function(){function a(){}return a.tagNames=["strong","em","u","sup","sub"],a.openingTags=_.map(a.tagNames,function(a){return"<"+a+">"}),a.closingTags=_.map(a.tagNames,function(a){return"</"+a+">"}),a.encodedOpeningTags=_.map(a.tagNames,function(a){return"&lt;"+a+"&gt;"}),a.encodedClosingTags=_.map(a.tagNames,function(a){return"&lt;/"+a+"&gt;"}),a}();a.SupportedTags=f,a.keepOnlyRichTextHtml=b,a.stripSupportedTagsButLeaveDangerousOnes=c,a.escapeHtmlWhilePreservingSupportedTags=d}(b=a.RichTextUtil||(a.RichTextUtil={}))}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(d,__assign({},a))}b.createRichTextControl=c;var d=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),c.prototype.render=function(){var a=this.props,c=b.RichTextUtil.keepOnlyRichTextHtml(a.Html);return React.createElement("span",{dangerouslySetInnerHTML:{__html:c}})},c}(a.ReactComponent);b.RichTextControl=d}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(e,__assign({},a))}var d;!function(a){a[a.PlainText=0]="PlainText",a[a.RichText=1]="RichText"}(d=b.UserTextRenderMode||(b.UserTextRenderMode={})),b.createUserTextRenderer=c;var e=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),c.prototype.render=function(){var a=this.props.RenderMode||d.PlainText;return a===d.RichText?React.createElement(b.RichTextControl,{Html:this.props.Text}):React.createElement("span",null,this.props.Text)},c}(a.ReactComponent);b.UserTextRenderer=e}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){function b(a){return React.createElement(c,a)}a.createLabel=b;var c=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a.alerting=!1,a}return __extends(c,b),c.prototype.componentDidMount=function(){var a=this;this.alerting||window.setTimeout(function(){a.alerting=!0,a.forceUpdate()})},c.prototype.createReactNodes=function(){var b=this.props,c=b.ShowRequiredStar?React.createElement(a.RequiredStar):void 0,d=b.ShowOrdinal?React.DOM.span({className:"ordinal-number",key:"ordinalNumber"},this.props.Ordinal+"."):void 0;if(!b.Alert||this.alerting)var e=a.createUserTextRenderer({Text:b.Label,RenderMode:a.UserTextRenderMode.RichText});return b.Bold?[React.DOM.b(void 0,d,e,c),b.children]:[d,e,c,b.children]},c}(a.ControlBase);a.Label=c}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(d,__assign({},a))}b.createLikertChartControl=c;var d=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a.backgroundColors=["#FF7F0E","#FF993E","#FFB26E","#FFCC9F","#FFE5CF","#E5E5E5","#D2E4F0","#A5C9E1","#79ADD2","#4C92C3","#1F77B4"],a}return __extends(c,b),c.prototype.render=function(){if(this.isValidChart()){var b={className:"chart-control-container chart-likert-control-container",tabIndex:-1};return b["aria-label"]=a.Form.Resources.LocalizedStrings.ChartControl_GroupContainer,React.createElement("div",__assign({},b),this.createDetailLegend(),React.createElement("div",{className:"chart-likert-body-control-container"},this.createChartLegend(),this.createChartCanvas()))}return null},c.prototype.componentWillMount=function(){this.initializeChartData()},c.prototype.componentDidMount=function(){this.updateChartDataView()},c.prototype.shouldComponentUpdate=function(a){return!_.isEqual(this.props,a)||!this.wasChartVisible},c.prototype.componentDidUpdate=function(){this.updateChartDataView()},c.prototype.componentWillUnmount=function(){this.destroyChart()},c.prototype.isValidChart=function(){return this.props.Labels&&this.props.Labels.length>0&&this.props.Data&&this.props.Data.length>0},c.prototype.destroyChart=function(){this.chartInstance&&(this.chartInstance.destroy(),this.chartInstance=null)},c.prototype.updateChartDataView=function(){if(this.isValidChart()){var a=ReactDOM.findDOMNode(this.refs.canvas);if(this.wasChartVisible=$(a).is(":visible"),this.wasChartVisible){var b=a.getContext("2d");this.createStackedBarChart(b),this.setChartLegend()}}},c.prototype.generateChartOption=function(){var a=this,b="'wf_segoe-ui_light', 'Segoe UI Light','Segoe WP Light','Segoe UI','Segoe WP',Tahoma, Arial, sans-serif",c={responsive:!1,scales:{xAxes:[{gridLines:{display:!0,drawTicks:!1,drawBorder:!0,zeroLineColor:"#ECECEC",zeroLineWidth:1,zeroLineBorderDash:[5]},ticks:{display:!0,beginAtZero:!0,fontFamily:b,fontSize:12,min:-100,max:100,maxTicksLimit:3,callback:function(a,b,c){return Math.abs(a)+"%"}},stacked:!0}],yAxes:[{barPercentage:.67,categoryPercentage:1,gridLines:{display:!1,drawTicks:!1,drawBorder:!1},ticks:{display:!1},stacked:!0}]},tooltips:{enabled:!1,mode:"nearest",intersect:!0,bodyFontSize:12,bodyFontFamily:b,custom:function(b){var c=a.chartInstance.canvas.parentNode,d=c.getElementsByClassName("chart-custom-tooltip")[0];if(d||(d=document.createElement("div"),d.className="chart-custom-tooltip",d.innerHTML="<table></table>",c.appendChild(d)),0===b.opacity)return void(d.style.opacity="0");if(b.body){var e=b.body.map(function(a){return a.lines});if(e.length>1){var f=e.length/2;a.isOdd&&(e.splice(f,1),b.labelColors.splice(f,1));var g=e.splice(0,f).reverse();g=g.concat(e);var h=b.labelColors.splice(0,f).reverse();h=h.concat(b.labelColors),e=[];var i=[];g.forEach(function(a,b){/\:\s0%$/g.test(a[0])||(e.push(a),i.push(h[b]))}),b.labelColors=i}var j="";e.forEach(function(a,c){var d=b.labelColors[c],e="background:"+d.backgroundColor+";border-color:"+d.borderColor+"; border-width: 2px;",f='<span class="chart-custom-tooltip-box" style="'+e+'"></span>',g='<span class="chart-custom-tooltip-text">'+a+"</span>";j+="<tr><td>"+f+g+"</td></tr>"}),j+="</tbody>";var k=d.querySelector("table");k.innerHTML=j}var l=a.chartInstance.canvas.offsetTop,m=a.chartInstance.canvas.offsetLeft;d.style.opacity="1",d.style.left=m+b.caretX+"px",d.style.top=l+b.caretY+"px",d.style.fontFamily=b._bodyFontFamily,d.style.fontSize=b._bodyFontSize,d.style.fontStyle=b._fontStyle,d.style.padding=b.yPadding+"px "+b.xPadding+"px"},callbacks:{label:function(b,c){var d=c.datasets[b.datasetIndex].label+": ",e=b.xLabel;return a.isOdd&&(0===b.datasetIndex||c.datasets.length/2===b.datasetIndex)&&(e*=2),d+Math.abs(e)+"%"}}},legend:{display:!1}};return c},c.prototype.createStackedBarChart=function(a){var b=Math.floor(this.chartData.length/2);if(this.chartData.length%2===0){this.isOdd=!1;var c=this.chartData.splice(0,b);c.reverse().forEach(function(a,b){a.data=a.data.map(function(a){return-a})}),(g=this.chartData).splice.apply(g,[0,0].concat(c))}else{this.isOdd=!0;var c=this.chartData.splice(0,b+1);c.reverse(),c[0].data=c[0].data.map(function(a){return a/2});var d=_.clone(c[0]);c.forEach(function(a){a.data=a.data.map(function(a){return-a})}),c.push(d),(h=this.chartData).splice.apply(h,[0,0].concat(c))}var e={labels:this.props.Labels,datasets:this.chartData},f=this.generateChartOption();this.destroyChart(),this.chartInstance=new Chart(a,{type:"horizontalBar",data:e,options:f});var g,h},c.prototype.initializeChartData=function(){for(var a=this,b=[],c=function(a){b.push(d.props.Data.reduce(function(b,c){return b+c.data[a]},0))},d=this,e=0;e<this.props.Data[0].data.length;e++)c(e);var f=[[0],[0,10],[0,5,10],[0,2,8,10],[0,2,5,8,10],[0,2,4,6,8,10],[0,2,4,5,6,8,10],[0,2,3,4,6,7,8,10],[0,2,3,4,5,6,7,8,10],[0,1,2,3,4,6,7,8,9,10]];this.usingColors=f[Math.min(this.props.Data.length,f.length)-1].map(function(b){return a.backgroundColors[b]}),this.chartData=this.props.Data.map(function(c,d){var e=c.backgroundColor?c.backgroundColor:a.usingColors[d%a.usingColors.length];return{label:c.label,backgroundColor:e,hoverBackgroundColor:a.lightenDarkenColor(e,10),data:c.data.map(function(a,c){return b[c]?Math.round(1e3*a/b[c])/10:0})}})},c.prototype.lightenDarkenColor=function(a,b){function c(a,b){var c=parseInt(a.slice(1),16),d=Math.round(2.55*b),e=(c>>16)+d,f=(c>>8&255)+d,g=(255&c)+d;return"#"+(16777216+65536*(255>e?1>e?0:e:255)+256*(255>f?1>f?0:f:255)+(255>g?1>g?0:g:255)).toString(16).slice(1)}return _.isArray(a)?a.map(function(a){return c(a,b)}):c(a,b)},c.prototype.setChartLegend=function(){var a=this;if(this.props.HasLegend){var b=ReactDOM.findDOMNode(this.refs["legend-contaner"]),c=b.childNodes;c&&c.length>0&&(_.each(c,function(b,c){Chart.helpers.addEvent(b,"mouseover",function(){a.handleEvent("mouseover",c)})}),Chart.helpers.addEvent(b,"mouseout",function(){a.handleEvent("mouseout",0)}));var d=ReactDOM.findDOMNode(this.refs["stacked-detail-container"]),e=d.getElementsByClassName("chart-control-detail-canvas");e&&e.length>0&&_.each(e,function(b,c){var d=b.getContext("2d");d.fillStyle=a.props.Data[c].backgroundColor?a.props.Data[c].backgroundColor:a.usingColors[c%a.usingColors.length],d.beginPath(),d.fillRect(0,0,8,8),d.closePath(),d.fill()})}},c.prototype.handleEvent=function(a,b){var c=this;"mouseout"===a?this.chartInstance.active=[]:this.chartInstance.active=this.chartInstance.data.datasets.map(function(a,d){return c.chartInstance.getDatasetMeta(d).data[b]}),this.chartInstance.lastActive=this.chartInstance.lastActive||[],this.chartInstance.lastActive.length&&this.chartInstance.updateHoverStyle(this.chartInstance.lastActive,this.chartInstance.options.hover.mode,!1),this.chartInstance.active.length&&this.chartInstance.updateHoverStyle(this.chartInstance.active,this.chartInstance.options.hover.mode,!0);var d=!Chart.helpers.arrayEquals(this.chartInstance.active,this.chartInstance.lastActive);if(d){this.chartInstance.lastActive=this.chartInstance.active;var e=this.chartInstance.tooltip;e._active=this.chartInstance.active,e._lastActive=e._lastActive||[],e.update(!0),e.pivot();var f=this.chartInstance._bufferedRequest;f?this.chartInstance.render(f.duration,f.lazy):d&&!this.chartInstance.animating&&(this.chartInstance.stop(),this.chartInstance.render(this.chartInstance.options.hover.animationDuration,!0)),this.chartInstance._bufferedRender=!1,this.chartInstance._bufferedRequest=null}},c.prototype.createChartLegend=function(){if(this.props.HasLegend){var b={className:"chart-likert-control-legend",tabIndex:-1,ref:"legend-contaner"};b["aria-label"]=a.Form.Resources.LocalizedStrings.ChartControl_LegendGroup;var c=this.props.Labels.map(function(a,b){return React.createElement("div",{className:"chart-likert-control-legend-row",key:b},React.createElement("span",{className:"chart-likert-control-legend-label",title:a.toString()},a))});return React.createElement("div",__assign({},b),c)}},c.prototype.createChartCanvas=function(){var b={className:"chart-likert-control",tabIndex:-1};b["aria-label"]=a.Form.Resources.LocalizedStrings.ChartControl_ChartGroup;var c=a.Utilities.Html.getWindowWidth()<400||a.Utilities.isMobile(),d=c?300:432,e=18+48*this.props.Labels.length;e=c?300*e/350:e;var f={role:"presentation",className:"chart-control-canvas",width:d,height:e,ref:"canvas"};return React.createElement("div",__assign({},b),React.createElement("canvas",__assign({},f)))},c.prototype.createDetailLegend=function(){var a="chart-likert-control-detail-container",b="chart-likert-control-detail-item";return React.createElement("div",{className:a,ref:"stacked-detail-container"},this.props.Data.map(function(a){return React.createElement("div",{className:b,title:a.label},React.createElement("canvas",{role:"presentation",className:"chart-control-detail-canvas",width:"8",height:"8"}),React.createElement("span",null,a.label))}))},c}(a.ReactComponent);b.LikertChartControl=d}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(e,a)}var d;!function(a){a[a.None=0]="None",a[a.CheckMark=1]="CheckMark"}(d=b.ItemStyle||(b.ItemStyle={})),b.createList=c;var e=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),c.prototype.render=function(){return React.DOM.div({className:"list-control-contanier"},this.createList())},c.prototype.createList=function(){var a=this,b=this.props.ListItems,c=b.map(function(b,c){return React.DOM.li({key:c},a.createListItem(b))});return React.DOM.ul({className:"list-control-ul",role:"listbox"},c)},c.prototype.createListItem=function(a){var c=null;switch(this.props.ItemStyle){case d.CheckMark:c=b.createFontIconControl({HTMLAttributes:{className:"list-control-icon"},IconName:"CheckMark"})}return React.DOM.div({className:"list-control-item",title:a.Tooltip},c,React.DOM.span({className:"list-control-item-text"},a.DisplayName))},c}(a.ReactComponent);b.List=e}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.render=function(){var b=this.props.Ignorable?a.Utilities.Html.combineAttributes(this.props.ClassName,"optional-cell"):this.props.ClassName;return React.createElement("div",{className:b},React.createElement("div",{className:"loading-spinner-animation"}),this.createLoadingDescription())},c.prototype.createLoadingDescription=function(){return this.props.LoadingDescription?React.createElement("div",{className:"loading-control-description",role:"status"},this.props.LoadingDescription):void 0},c}(a.ReactComponent);b.LoadingControl=c}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(f,__assign({},a))}function d(){return{Active:!1,MenuItem:React.createElement("hr",{className:"menu-control-hr"})}}var e;!function(a){a[a.Normal=0]="Normal",a[a.CheckBox=1]="CheckBox",a[a.RadioButton=2]="RadioButton"}(e=b.MenuItemType||(b.MenuItemType={})),b.createMenuControl=c,b.createMenuBreakerProps=d;var f=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;return a.wasMenuExpanded=!1,a.controlId=_.uniqueId("menu"),a.state={FocusedOnMenuButton:!1,FocusedOnMenuItem:!1,MenuExpanded:!1},a}return __extends(d,c),d.prototype.componentWillReceiveProps=function(a){a.Reset&&(this.setState({FocusedOnMenuButton:!0,MenuExpanded:!1}),a.onMenuReset&&a.onMenuReset())},d.prototype.componentDidUpdate=function(){var a=this;this.menuItemsRefs&&(this.activeMenuItems=[],this.activeMenuItems=this.menuItemsRefs.map(function(b){return ReactDOM.findDOMNode(a.refs[b])})),this.updateFocusOnTriggerButton(),!this.wasMenuExpanded&&this.state.MenuExpanded&&this.state.FocusedOnMenuItem&&this.setFocusOnMenuItem(0),!this.wasMenuExpanded&&this.state.MenuExpanded&&this.props.onMenuExpand&&this.props.onMenuExpand(),this.wasMenuExpanded&&!this.state.MenuExpanded&&this.props.onMenuCollapse&&this.props.onMenuCollapse(),this.wasMenuExpanded=this.state.MenuExpanded},d.prototype.render=function(){var b=this.props.ClassNameForContainer;return this.state.MenuExpanded&&(b=a.Utilities.Html.combineAttributes(b,"menu-control-dropup")),React.createElement("div",{className:b},this.createMenuTriggerButton(),this.createMenuTable())},d.prototype.updateFocusOnTriggerButton=function(){if(this.state.FocusedOnMenuButton){var a=ReactDOM.findDOMNode(this.refs.menuButton);a&&a.focus()}},d.prototype.switchMenuExpandedState=function(a){void 0===a&&(a=!1),this.setState({FocusedOnMenuButton:this.state.MenuExpanded,FocusedOnMenuItem:!this.state.MenuExpanded&&a,MenuExpanded:!this.state.MenuExpanded})},d.prototype.createMenuTriggerButton=function(){var a=this,c=this.props.MenuTriggerButton,d={"aria-label":c.Description,"aria-expanded":this.state.MenuExpanded,"aria-haspopup":!0,"aria-controls":this.state.MenuExpanded?this.controlId:void 0,autoFocus:this.props.AutoFocused,className:c.ClassName,disabled:this.props.Disabled,title:c.Tooltip||c.Description,onClick:function(){return a.switchMenuExpandedState()},onFocus:this.props.onButtonFocus,onKeyDown:function(b){return a.onKeyDownForMenuTriggerButton(b)},onBlur:function(b){a.setState({FocusedOnMenuButton:!1}),a.onMenuBlur(b)}};return b.createButton({HTMLAttributes:d,ButtonStyle:c.ButtonStyle,children:c.ChildrenContent,ref:"menuButton"})},d.prototype.getNextActiveIndex=function(a){return this.activeMenuItems&&this.activeMenuItems.length&&a>=0&&a<this.activeMenuItems.length?(a+1)%this.activeMenuItems.length:-1},d.prototype.getPreviousActiveIndex=function(a){return this.activeMenuItems&&this.activeMenuItems.length&&a>=0&&a<this.activeMenuItems.length?(a+this.activeMenuItems.length-1)%this.activeMenuItems.length:-1},d.prototype.collapseMenu=function(){this.setState({FocusedOnMenuButton:!0,FocusedOnMenuItem:!1,MenuExpanded:!1})},d.prototype.getMenuItemRole=function(a){switch(a){case e.Normal:return"menuitem";case e.RadioButton:return"menuitemradio";case e.CheckBox:default:return"menuitemcheckbox"}},d.prototype.onMenuBlur=function(b){if(this.state.MenuExpanded){var c=a.Utilities.Html.getTargetElementOfFocusEvent(b),d=ReactDOM.findDOMNode(this.refs.menuTable),e=ReactDOM.findDOMNode(this.refs.menuButton);d&&!d.contains(c)&&e&&!e.contains(c)&&this.setState({FocusedOnMenuButton:!1,FocusedOnMenuItem:!1,MenuExpanded:!1})}},d.prototype.createUnorderedListMenuItem=function(c,d){var f=this,g=!!c.IsDisabled,h=function(){g||c.onExecute()},i={className:a.Utilities.Html.combineAttributes("separator",c.Checked?"checked":""),key:c.Key,title:c.Title},j={"aria-disabled":g,className:a.Utilities.Html.combineAttributes("menu-control-a",g?"menu-control-a-disabled":void 0),ref:d.toString(),role:this.getMenuItemRole(c.MenuItemType),tabIndex:-1,onClick:function(){h(),f.switchMenuExpandedState()},onBlur:function(a){return f.onMenuBlur(a)},onKeyDown:function(a){
return f.onKeyDownForMenuItem(a,h,e.CheckBox)},href:"javascript:;"};(c.MenuItemType==e.CheckBox||c.MenuItemType==e.RadioButton)&&(j["aria-checked"]=c.Checked);var k={HTMLAttributes:{className:"forms-icon-size18x18 question-menu-check-icon"},IconName:"CheckMark"},l=c.Checked?React.createElement(b.FontIconControl,__assign({},k)):void 0;return React.createElement("li",__assign({},i),React.createElement("a",__assign({},j),l,c.Description))},d.prototype.createUnorderListMenu=function(){var b=this;this.menuItemsRefs=[];var c=[],d=this.props.UnorderListMenuItems,e=!1;d&&d.filter(function(a){return!!a}).forEach(function(a,d){c.push(b.createUnorderedListMenuItem(a,d)),b.menuItemsRefs.push(d.toString()),e=e||a.Checked});var f={id:this.controlId,className:a.Utilities.Html.combineAttributes("dropdown-menu-control","menu-control","border-no-radius",e?"checked":""),ref:"menuTable",role:"menu"};return React.createElement("ul",__assign({},f),c)},d.prototype.createCustomizedMenu=function(){var b=this;this.menuItemsRefs=[];var c=[],d=this.props.CustomizedMenuItems;d&&(c=d.filter(function(a){return!!a.MenuItem}).map(function(a,c){if(a.Active){var d={className:"menu-control-item",key:c.toString(),ref:c.toString(),role:"menuitem",tabIndex:-1,onClick:function(c){c.stopPropagation(),c.preventDefault(),a.OnExecute&&a.OnExecute(),b.switchMenuExpandedState()},onKeyDown:function(c){return b.onKeyDownForMenuItem(c,a.OnExecute)},onBlur:function(a){return b.onMenuBlur(a)}};return b.menuItemsRefs.push(c.toString()),React.createElement("div",__assign({},d),a.MenuItem)}return React.createElement("div",{key:c.toString()},a.MenuItem)}));var e={className:a.Utilities.Html.combineAttributes("menu-control-options-box",this.props.ClassName),ref:"menuTable",role:"menu"};return React.createElement("div",{id:this.controlId,className:this.props.ShowBox?"menu-option-container":null},this.props.ShowBox&&React.createElement("div",{className:"menu-box"}),React.createElement("div",__assign({},e),c))},d.prototype.createMenuTable=function(){if(this.state.MenuExpanded){if(this.props.UnorderListMenuItems)return this.createUnorderListMenu();if(this.props.CustomizedMenuItems)return this.createCustomizedMenu()}return null},d.prototype.setFocusOnMenuItem=function(a){if(a>=0&&this.activeMenuItems&&this.activeMenuItems.length>a){var b=this.activeMenuItems[a];b&&(b.focus(),this.activeIndex=a)}},d.prototype.onKeyDownForMenuTriggerButton=function(b){if(b.keyCode!==a.KeyCode.Tab)switch(b.keyCode){case a.KeyCode.ArrowUp:if(this.state.MenuExpanded){this.setFocusOnMenuItem(this.getPreviousActiveIndex(0));break}case a.KeyCode.ArrowDown:if(this.state.MenuExpanded){this.setFocusOnMenuItem(0);break}case a.KeyCode.Enter:b.stopPropagation(),b.preventDefault(),this.switchMenuExpandedState(!0);break;case a.KeyCode.Esc:this.collapseMenu();break;case a.KeyCode.ArrowLeft:this.state.MenuExpanded&&(b.stopPropagation(),b.preventDefault(),this.switchMenuExpandedState(!1))}},d.prototype.onKeyDownForMenuItem=function(b,c,d){switch(b.stopPropagation(),b.preventDefault(),b.keyCode){case a.KeyCode.Space:c&&c(),d!==e.CheckBox&&this.switchMenuExpandedState();break;case a.KeyCode.Enter:c&&c(),this.switchMenuExpandedState();break;case a.KeyCode.Home:this.setFocusOnMenuItem(0);break;case a.KeyCode.End:this.setFocusOnMenuItem(this.getPreviousActiveIndex(0));break;case a.KeyCode.ArrowUp:this.setFocusOnMenuItem(this.getPreviousActiveIndex(this.activeIndex));break;case a.KeyCode.ArrowDown:this.setFocusOnMenuItem(this.getNextActiveIndex(this.activeIndex));break;case a.KeyCode.ArrowLeft:this.collapseMenu();break;case a.KeyCode.ArrowRight:this.setFocusOnMenuItem(this.getNextActiveIndex(this.activeIndex));break;case a.KeyCode.Esc:this.collapseMenu();break;case a.KeyCode.Tab:this.collapseMenu()}},d}(a.ReactComponent);b.MenuControl=f}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(d,a)}b.createNumberRating=c;var d=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;return a.ariaLabelId=_.uniqueId("ratingAccessibilityLabel."),a}return __extends(d,c),d.prototype.createReactNodes=function(){var c=this.props,d=null!=c.Value&&""!==c.Value;if(!d&&c.ToRenderIfNoRatingAlreadyGiven)return[c.ToRenderIfNoRatingAlreadyGiven];var e,f=10,g=c.MinRating;return null==g&&(g=1),e=c.ShowRatingLabel?b.RatingUtilities.createRatingContainer(b.RatingUtilities.RatingType.Number,null,c.LeftDescription,c.RightDescription,g.toString(),c.Length.toString(),this.createRatingTable(),c.Length,f):[React.createElement("div",{className:"office-form-question-rating-container"},this.createRatingTable())],c.ShouldAccessibleTextReadSelectedValue?[React.createElement("div",{"aria-labelledby":this.ariaLabelId},React.createElement("div",{id:this.ariaLabelId,className:"screenReaderVisible"},a.Form.Resources.LocalizedStrings.GradingView_RatingAnswer_LabelFormat.format(this.getSelectedValue(),c.Length)),React.createElement("div",{"aria-hidden":"true",role:"presentation"},e))]:e},d.prototype.createRatingTable=function(){var b=this,c=this.props.MinRating;null==c&&(c=1);var d=_.range(c,this.props.Length+1),e=this.getSelectedValue(),f=a.Utilities.Html.combineAttributes("office-form-question-rating-body","Center"===this.props.Layout?"justifyContentSpaceBetween":"");return React.createElement("div",{className:f},d.map(function(a){var c=e===a;return React.createElement("div",{className:"office-form-question-rating-item",key:a},React.createElement("label",{htmlFor:b.getRatingInputId(a)},a),React.createElement("input",{id:b.getRatingInputId(a),"aria-checked":c,"aria-label":""+a,"aria-posinset":a,"aria-setsize":d.length,type:"radio",disabled:b.props.Disabled,checked:c,onClick:function(){return b.props.onValueChange(a)}}))}))},d.prototype.getRatingInputId=function(a){return this.ariaLabelId+"-number-rating-"+a},d.prototype.getSelectedValue=function(){return parseInt(this.props.Value)},d}(b.ControlBase);b.NumberRating=d}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(e,__assign({},a))}var d;!function(a){a[a.QuizRanking=0]="QuizRanking",a[a.SurveyRanking=1]="SurveyRanking",a[a.Likert=2]="Likert"}(d=b.StackedBarType||(b.StackedBarType={})),b.createRankingChartControl=c;var e=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a.backgroundColors=["#FF7F0E","#FF993E","#FFB26E","#FFCC9F","#FFE5CF","#E5E5E5","#D2E4F0","#A5C9E1","#79ADD2","#4C92C3","#1F77B4"],a}return __extends(c,b),c.prototype.render=function(){if(this.isValidChart()){var b={className:"chart-control-container chart-stacked-control-container",tabIndex:-1};return b["aria-label"]=a.Form.Resources.LocalizedStrings.ChartControl_GroupContainer,React.createElement("div",__assign({},b),this.createChartLegend(),this.createChartCanvas())}return null},c.prototype.componentWillMount=function(){this.initializeChartData()},c.prototype.componentDidMount=function(){this.updateChartDataView()},c.prototype.shouldComponentUpdate=function(a){return!_.isEqual(this.props,a)||!this.wasChartVisible},c.prototype.componentDidUpdate=function(){this.updateChartDataView()},c.prototype.componentWillUnmount=function(){this.destroyChart()},c.prototype.isValidChart=function(){return this.props.Labels&&this.props.Labels.length>0&&this.props.Data&&this.props.Data.length>0},c.prototype.destroyChart=function(){this.chartInstance&&(this.chartInstance.destroy(),this.chartInstance=null)},c.prototype.updateChartDataView=function(){if(this.isValidChart()){var a=ReactDOM.findDOMNode(this.refs.canvas);if(this.wasChartVisible=$(a).is(":visible"),this.wasChartVisible){var b=a.getContext("2d");this.createStackedBarChart(b),this.setChartLegend()}}},c.prototype.generateChartOption=function(){var a={responsive:!1,scales:{xAxes:[{gridLines:{display:!1,drawTicks:!0,drawBorder:!0},ticks:{display:!1,min:0,max:100},stacked:!0}],yAxes:[{gridLines:{display:!1,drawTicks:!1,drawBorder:!0},ticks:{display:!1},stacked:!0}]},tooltips:{enabled:!0,filter:function(a){return 0!==a.xLabel},callbacks:{title:function(a){return a.length?a[0].yLabel:""},label:function(a,b){return b.datasets[a.datasetIndex].label+": "+a.xLabel+"%"}}},legend:{display:!1}};return a},c.prototype.createStackedBarChart=function(a){var b={labels:this.props.Labels,datasets:this.chartData},c=this.generateChartOption();this.destroyChart(),this.chartInstance=new Chart(a,{type:"horizontalBar",data:b,options:c})},c.prototype.initializeChartData=function(){for(var a=this,b=[],c=function(a){b.push(d.props.Data.reduce(function(b,c){return b+c.data[a]},0))},d=this,e=0;e<this.props.Data[0].data.length;e++)c(e);var f=[[0],[0,10],[0,5,10],[0,2,8,10],[0,2,5,8,10],[0,2,4,6,8,10],[0,2,4,5,6,8,10],[0,2,3,4,6,7,8,10],[0,2,3,4,5,6,7,8,10],[0,1,2,3,4,6,7,8,9,10]];this.usingColors=f[Math.min(this.props.Data.length,f.length)-1].map(function(b){return a.backgroundColors[b]}),this.chartData=this.props.Data.map(function(c,d){var e=c.backgroundColor?c.backgroundColor:a.usingColors[d%a.usingColors.length];return{label:c.label,borderWidth:1,borderColor:"#FFFFFF",backgroundColor:e,hoverBackgroundColor:a.lightenDarkenColor(e,10),data:c.data.map(function(a,c){return b[c]?Math.round(1e3*a/b[c])/10:0})}})},c.prototype.lightenDarkenColor=function(a,b){function c(a,b){var c=parseInt(a.slice(1),16),d=Math.round(2.55*b),e=(c>>16)+d,f=(c>>8&255)+d,g=(255&c)+d;return"#"+(16777216+65536*(255>e?1>e?0:e:255)+256*(255>f?1>f?0:f:255)+(255>g?1>g?0:g:255)).toString(16).slice(1)}return _.isArray(a)?a.map(function(a){return c(a,b)}):c(a,b)},c.prototype.setChartLegend=function(){var a=this;if(this.props.HasLegend){var b=ReactDOM.findDOMNode(this.refs["legend-table"]),c=ReactDOM.findDOMNode(this.refs["legend-table-tbody"]),d=c.childNodes;d&&d.length>0&&(_.each(d,function(b,c){Chart.helpers.addEvent(b,"mouseover",function(){a.handleEvent("mouseover",c)})}),Chart.helpers.addEvent(b,"mouseout",function(){a.handleEvent("mouseout",0)}));var e=ReactDOM.findDOMNode(this.refs["stacked-detail-container"]),f=e.getElementsByClassName("chart-control-detail-canvas");f&&f.length>0&&_.each(f,function(b,c){var d=b.getContext("2d");d.fillStyle=a.chartData[c].backgroundColor,d.beginPath(),d.fillRect(0,0,10,10),d.closePath(),d.fill()})}},c.prototype.handleEvent=function(a,b){var c=this;"mouseout"===a?this.chartInstance.active=[]:this.chartInstance.active=this.chartInstance.data.datasets.map(function(a,d){return c.chartInstance.getDatasetMeta(d).data[b]}),this.chartInstance.lastActive=this.chartInstance.lastActive||[],this.chartInstance.lastActive.length&&this.chartInstance.updateHoverStyle(this.chartInstance.lastActive,this.chartInstance.options.hover.mode,!1),this.chartInstance.active.length&&this.chartInstance.updateHoverStyle(this.chartInstance.active,this.chartInstance.options.hover.mode,!0);var d=!Chart.helpers.arrayEquals(this.chartInstance.active,this.chartInstance.lastActive);if(d){this.chartInstance.lastActive=this.chartInstance.active;var e=this.chartInstance.tooltip;e._active=this.chartInstance.active,e._lastActive=e._lastActive||[],e.update(!0),e.pivot();var f=this.chartInstance._bufferedRequest;f?this.chartInstance.render(f.duration,f.lazy):d&&!this.chartInstance.animating&&(this.chartInstance.stop(),this.chartInstance.render(this.chartInstance.options.hover.animationDuration,!0)),this.chartInstance._bufferedRender=!1,this.chartInstance._bufferedRequest=null}},c.prototype.createChartLegend=function(){var b=this;if(this.props.HasLegend){var c={className:"chart-control-legend",tabIndex:-1};c["aria-label"]=a.Form.Resources.LocalizedStrings.ChartControl_LegendGroup;var e=void 0,f=void 0;return this.props.Type===d.QuizRanking?(e=React.createElement("tr",{className:"chart-control-legend-table-title"},React.createElement("th",{className:"chart-control-legend-label"},""),React.createElement("th",{className:"chart-control-legend-value"},"")),f=this.props.Labels.map(function(a,c){return React.createElement("tr",{className:"chart-control-legend-table-row",key:c},React.createElement("td",{role:"presentation",className:"chart-control-legend-label",title:a.toString()},a),React.createElement("td",{role:"presentation",className:"chart-control-legend-value"},b.chartData[0].data[c]+"%"))})):(e=React.createElement("tr",{className:"chart-control-legend-table-title"},React.createElement("th",{role:"presentation",className:"chart-control-legend-value"},a.Form.Resources.LocalizedStrings.AnalyzeView_Chart_Rank),React.createElement("th",{role:"presentation",className:"chart-control-legend-label"},a.Form.Resources.LocalizedStrings.AnalyzeView_Chart_Options)),f=this.props.Labels.map(function(a,c){return React.createElement("tr",{className:"chart-control-legend-table-row",key:c},React.createElement("td",{role:"presentation",className:"chart-control-legend-value"},b.props.yLabels[c]),React.createElement("td",{role:"presentation",className:"chart-control-legend-label",title:a.toString()},a))})),React.createElement("div",__assign({},c),React.createElement("table",{className:"chart-control-legend-table",ref:"legend-table"},React.createElement("thead",null,e),React.createElement("tbody",{ref:"legend-table-tbody"},f)))}},c.prototype.createChartCanvas=function(){var b={"aria-label":a.Form.Resources.LocalizedStrings.ChartControl_ChartGroup,className:"chart-control chart-control-stacked",tabIndex:-1},c=a.Utilities.Html.getWindowWidth()<400||a.Utilities.isMobile(),d=c?300:350,e=10+31*this.props.Labels.length;e=c?300*e/350:e;var f={role:"presentation",className:"chart-control-canvas",width:d,height:e,ref:"canvas"};return React.createElement("div",__assign({},b),this.createDetailLegend(),React.createElement("canvas",__assign({},f)))},c.prototype.createDetailLegend=function(){var b=this;if(this.props.Type===d.SurveyRanking){var c=a.Form.Resources.LocalizedStrings.AnalyzeView_Chart_Pick;return React.createElement("div",{className:"chart-control-stacked-detail-container",ref:"stacked-detail-container"},this.props.Labels.map(function(d,e){return 0===e?React.createElement("div",{className:"chart-control-stacked-detail-item"},React.createElement("span",null,c.format(a.Form.Resources.LocalizedStrings.Ordinal_Numera_First)),React.createElement("canvas",{role:"presentation",className:"chart-control-detail-canvas",width:"10",height:"10"})):e===b.props.Labels.length-1?React.createElement("div",{className:"chart-control-stacked-detail-item"},React.createElement("canvas",{role:"presentation",className:"chart-control-detail-canvas",width:"10",height:"10"}),React.createElement("span",null,c.format(a.Form.Resources.LocalizedStrings.Ordinal_Numera_Last))):React.createElement("div",{className:"chart-control-stacked-detail-item"},React.createElement("canvas",{role:"presentation",className:"chart-control-detail-canvas",width:"10",height:"10"}))}))}return React.createElement("div",{className:"chart-control-stacked-detail-container",ref:"stacked-detail-container"},this.props.Data.map(function(a){return React.createElement("div",{className:"chart-control-stacked-detail-item",title:a.label},React.createElement("canvas",{role:"presentation",className:"chart-control-detail-canvas",width:"10",height:"10"}),React.createElement("span",null,a.label))}))},c}(a.ReactComponent);b.RankingChartControl=e}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(d,a)}b.createRating=c;var d=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;return a.containerRef=React.createRef(),a.containerWidth=0,a}return __extends(d,c),d.prototype.createReactNodes=function(){var a=this.props,c=10,d=this.containerRef.current;d&&d.clientWidth>0&&(this.containerWidth=d.clientWidth);var e=this.getRateitConfig(),f={className:"rateit margin-left office-form-theme-primary-foreground","data-rateit-icon":"","data-rateit-iconforempty":"","data-rateit-mode":"font","data-rateit-marginleft":e.MarginLeft,"data-rateit-marginright":e.MarginRight,"data-rateit-starwidth":e.FontSize,"data-rateit-max":a.Length,"data-rateit-value":a.Value,"data-rateit-step":1,"data-rateit-resetable":!1,"data-rateit-ispreset":!0,style:{fontSize:e.FontSize},ref:"rateit",key:"rateit"},g=React.DOM.div(f);return a.ShowRatingLabel?b.RatingUtilities.createRatingContainer(b.RatingUtilities.RatingType.Star,this.containerRef,a.LeftDescription,a.RightDescription,a.LeftDescriptionTitle,a.RightDescriptionTitle,g,a.Length,c,this.ratingDescriptionId):[React.DOM.div({className:"office-form-question-rating-container",key:"container",ref:this.containerRef},g)]},d.prototype.componentWillMount=function(){this.ratingDescriptionId=a.UniqueIdentifier.getLabelId(),this.adjustStarStyleWhenResize=this.adjustStarStyleWhenResize.bind(this)},d.prototype.componentDidMount=function(){this.initialzeRateit(),window.addEventListener("resize",this.adjustStarStyleWhenResize);var a=this.containerRef.current;a&&a.clientWidth>0?(this.containerWidth=a.clientWidth,this.forceUpdate()):this.updateRatingAttributes()},d.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.adjustStarStyleWhenResize)},d.prototype.componentDidUpdate=function(){this.updateRatingAttributes()},d.prototype.initialzeRateit=function(){var b=this,c=this.props,d=$(ReactDOM.findDOMNode(this.refs.rateit));d.rateit(),d.on("rated",function(){return c.onValueChange(d.rateit("value"))}),d.on("over",function(a,c){return b.updateTooltip(c)});var e=d.find(".rateit-range");if(e&&c.Options&&c.Options.HTMLPropsForInnerElement){e.removeAttr("aria-label");for(var f in c.Options.HTMLPropsForInnerElement)e.attr(f,c.Options.HTMLPropsForInnerElement[f])}if(e){var g=e.attr("aria-labelledby");g&&(g=a.Utilities.Html.combineAttributes(g,this.ratingDescriptionId),e.attr("aria-labelledby",g))}},d.prototype.adjustStarStyleWhenResize=function(){var a=this;this.resizeTimeId||(this.resizeTimeId=window.setTimeout(function(){a.resizeTimeId=null,a.forceUpdate()},100))},d.prototype.updateRatingAttributes=function(){var a=$(ReactDOM.findDOMNode(this.refs.rateit));if(a.rateit("readonly",this.props.Disabled),this.props.NoTabFocus){var b=a.find(".rateit-range");b&&b.removeAttr("tabindex")}var c=a.children(".rateit-range");c.removeAttr("aria-readonly");var d=this.getRateitConfig();a.rateit("batchUpdate",{value:this.props.Value,max:this.props.Length,starwidth:d.FontSize,marginleft:d.MarginLeft,marginright:d.MarginRight}),this.updateTooltip(),this.checkRatingValue()},d.prototype.updateTooltip=function(b){b=b||this.props.Value||0;var c=$(ReactDOM.findDOMNode(this.refs.rateit)),d=a.Form.Resources.LocalizedStrings.Renderer_RatingControlText.format(b);c.attr("title",d)},d.prototype.getRateitConfig=function(){var a={MarginLeft:4,MarginRight:4,FontSize:24};if(this.containerWidth>0)if(this.isMobile()){a.MarginLeft=4;var b=this.props.Length,c=b>6?24:28;a.FontSize=c,4>b?a.MarginRight=27:a.MarginRight=(this.containerWidth-a.MarginLeft*(b+1)-c*b)/(b-1)}else if(this.containerWidth>380)return{MarginLeft:5,MarginRight:5,FontSize:28};return a},d.prototype.checkRatingValue=function(){this.props.Value>this.props.Length&&a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Questions.RatingValueOutOfBounds,extraData:{operation:"RatingValueOutOfBounds"}})},d.prototype.isMobile=function(){return this.props.IsMobile||a.Utilities.isMobile()},d}(b.ControlBase);b.Rating=d}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){function c(b,c,e,f,g,h,i,j,k,l){var m;m=b===d.Star?"star":"number";var n={className:"office-form-rating-container-"+m+" container-margin-right"},o={className:"office-form-rating-container-"+m+" container-margin-left"};""===e&&(n.className=a.Utilities.Html.combineAttributes(n.className,"container-empty")),j===k&&(n.className=a.Utilities.Html.combineAttributes(n.className,"container-"+m+"-max-width"),o.className=a.Utilities.Html.combineAttributes(o.className,"container-"+m+"-max-width"));var p=React.DOM.div(n,React.DOM.div({className:"office-form-question-rating-description-"+m},e)),q=React.DOM.div(o,React.DOM.div({className:"office-form-question-rating-description-"+m},f));if(e||f){var r=React.DOM.div({className:"office-form-response-rating-description"},React.DOM.div({className:"office-form-rating-description-label"},g),React.DOM.div({className:"rating-option-description"},a.Form.Resources.LocalizedStrings.Colon.format(e))),s=React.DOM.div({className:"office-form-response-rating-description"},React.DOM.div({className:"office-form-rating-description-label"},h),React.DOM.div({className:"rating-option-description"},a.Form.Resources.LocalizedStrings.Colon.format(f))),t=React.DOM.div({className:"office-form-rating-description-container",id:l},r,s);return[React.DOM.div({className:"office-form-question-rating-container",key:"container",ref:c},p,i,q),t]}return[React.DOM.div({className:"office-form-question-rating-container",key:"container",ref:c},p,i,q)]}var d;!function(a){a[a.Star=0]="Star",a[a.Number=1]="Number"}(d=b.RatingType||(b.RatingType={})),b.createRatingContainer=c}(c=b.RatingUtilities||(b.RatingUtilities={}))}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(d,__assign({},a))}b.createRenderNewlines=c;var d=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.renderLine=function(a){return React.createElement("span",null,a,React.createElement("br",null))},b.prototype.splitContentIntoLines=function(){var a=this.props.content;return(_.isUndefined(this.props.trim)||this.props.trim)&&(a=a.trim()),a.split("\n")},b.prototype.render=function(){var a=this.splitContentIntoLines();return React.createElement("span",null,a.map(function(b,c){var d=c!==a.length-1,e=d?React.createElement("br",null):void 0;return React.createElement("span",null,b,e)}))},b}(a.ReactComponent);b.RenderNewlines=d}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(d,__assign({},a))}b.createSelect=c;var d=function(c){function d(a){var b=c.call(this,a)||this;return b.controlId=_.uniqueId(d.name),b.placeholderId=b.controlId+"_placeholder",b.placeholderRef=React.createRef(),b.onBlur=b.onBlur.bind(b),b.onKeyDown=b.onKeyDown.bind(b),b}return __extends(d,c),d.prototype.componentWillUpdate=function(a,b){var c=_.findIndex(a.SelectOptions,function(b){return b.Value===a.Value});this.selectedOptionKey=0>c?void 0:a.SelectOptions[c].Key},d.prototype.componentWillMount=function(){var a=this,b=_.findIndex(this.props.SelectOptions,function(b){return b.Value===a.props.Value});this.selectedOptionKey=0>b?void 0:this.props.SelectOptions[b].Key,this.setState({Expanded:!1})},d.prototype.componentDidUpdate=function(){if(this.scrollToSelectedOption(),this.state.Expanded){this.adjustOptionPanelLayout();var a=this.refs[this.selectedOptionKey];if(a){var b=ReactDOM.findDOMNode(a);b&&b.focus()}}},d.prototype.adjustOptionPanelLayout=function(){var a=document.getElementById(this.controlId),b=window.getComputedStyle(a),c=a.offsetWidth,d=ReactDOM.findDOMNode(this.refs.menu);(this.props.AllowWrap||d.offsetWidth<c)&&(d.style.width=c+"px"),d.style.top=a.offsetHeight-parseInt(b.borderTopWidth)+"px",d.style.left="-"+b.borderLeftWidth},d.prototype.render=function(){var b=this,c=_.extend({},this.props.HTMLAttributes),d=a.Utilities.Html.mergeReactProps(c,{"aria-describedby":this.placeholderId,"aria-expanded":this.state.Expanded,"aria-label":c["aria-label"]||this.props.Label||this.props.Placeholder,className:"select-control",id:this.controlId,onBlur:this.onBlur,onClick:c.disabled?void 0:function(){return b.onClick()},onKeyDown:this.onKeyDown,ref:this.placeholderRef,role:"combobox",tabIndex:c.disabled?-1:0});return React.createElement("div",__assign({},d),this.createPlaceholder(),this.createOptions())},d.prototype.createPlaceholder=function(){var a,b=this,c=_.findIndex(this.props.SelectOptions,function(a){return void 0===b.selectedOptionKey?a.Value===b.props.Value:a.Key===b.selectedOptionKey});c>=0&&(a=this.props.DisplayValue?this.props.Value:this.props.SelectOptions[c].DisplayContent||this.props.SelectOptions[c].DisplayName),a||(a=this.props.Placeholder||"");var d=this.selectedOptionKey?"select-placeholder-text":"select-placeholder-text default",e=this.state.Expanded?"off":"polite";return React.createElement("div",{className:"select-placeholder"},React.createElement("span",{"aria-live":e,id:this.placeholderId,className:d,role:"textbox"},a),this.createArrow())},d.prototype.createArrow=function(){var a={HTMLAttributes:{className:"select-placeholder-arrow forms-icon-size14x14"},IconName:this.state.Expanded?"ChevronUp":"ChevronDown"};return React.createElement(b.FontIconControl,__assign({},a))},d.prototype.createOptions=function(){var a=this;if(this.state.Expanded){var b={className:"select-option-menu-container",ref:"menu",onWheel:function(b){b.preventDefault();var c=b.deltaY,d=ReactDOM.findDOMNode(a.refs.menu),e=d.scrollTop+c;if(c>=0){var f=d.scrollHeight-d.clientHeight;d.scrollTop=Math.min(e,f)}else d.scrollTop=Math.max(e,0)},role:"listbox"};return React.createElement("ul",__assign({},b),this.props.SelectOptions.map(function(b){return a.createOption(b)}))}},d.prototype.createOption=function(c){var d=this,e=c.Key===this.selectedOptionKey,f={"aria-selected":e,"aria-disabled":c.Disabled,className:this.props.AllowWrap?"select-option-nocheck":"select-option",tabIndex:e?0:-1,key:c.Key,ref:c.Key&&c.Key.toString(),role:"option"};c.Disabled?f.className=a.Utilities.Html.combineAttributes(f.className,"disabled"):f.onClick=function(a){var b=ReactDOM.findDOMNode(d);b.focus(),d.selectedOptionKey&&d.selectedOptionKey===c.Key||d.props.onValueChange(c.Value),d.setState({Expanded:!1}),a.stopPropagation()};var g;this.props.AllowWrap||(g=React.createElement(b.FontIconControl,{HTMLAttributes:{className:"select-option-state forms-icon-size14x14"},IconName:"CheckMark"})),e&&(f.className=a.Utilities.Html.combineAttributes(f.className,"selected"));var h=c.DisplayContent;return h||(h=React.createElement("span",null,c.DisplayName)),React.createElement("li",__assign({},f),React.createElement("div",{className:"select-option-content"},g,h))},d.prototype.onBlur=function(b){var c=ReactDOM.findDOMNode(this),d=a.Utilities.Html.getTargetElementOfFocusEvent(b);c.contains(d)||this.setState({Expanded:!1})},d.prototype.onKeyDown=function(b){var c=this;switch(b.stopPropagation(),b.keyCode){case a.KeyCode.Space:this.setState({Expanded:!0}),b.preventDefault();break;case a.KeyCode.Enter:this.onClick(!0),b.preventDefault();break;case a.KeyCode.Tab:this.state.Expanded&&(this.setState({Expanded:!1},function(){c.placeholderRef.current&&c.placeholderRef.current.focus()}),b.preventDefault());break;case a.KeyCode.Esc:this.state.Expanded&&this.setState({Expanded:!1},function(){c.placeholderRef.current&&c.placeholderRef.current.focus()}),b.preventDefault();break;case a.KeyCode.ArrowLeft:case a.KeyCode.ArrowRight:this.state.Expanded||(b.keyCode===a.KeyCode.ArrowLeft?this.selectPreviousOption():this.selectNextOption()),b.preventDefault();break;case a.KeyCode.ArrowUp:case a.KeyCode.ArrowDown:b.altKey?this.setState({Expanded:!this.state.Expanded}):b.keyCode===a.KeyCode.ArrowUp?this.selectPreviousOption():this.selectNextOption(),b.preventDefault()}},d.prototype.selectPreviousOption=function(){for(var a=this,b=_.findIndex(this.props.SelectOptions,function(b){return b.Key===a.selectedOptionKey});b>0;){var c=this.props.SelectOptions[b-1];if(!c.Disabled){this.props.onValueChange(c.Value);break}b--}},d.prototype.selectNextOption=function(){for(var a=this,b=_.findIndex(this.props.SelectOptions,function(b){return b.Key===a.selectedOptionKey});b<this.props.SelectOptions.length-1;){var c=this.props.SelectOptions[b+1];if(!c.Disabled){this.props.onValueChange(c.Value);break}b++}},d.prototype.onClick=function(a){if(this.state.Expanded){var b=ReactDOM.findDOMNode(this);b.focus()}else a&&void 0===this.selectedOptionKey&&this.props.SelectOptions[0]&&this.props.onValueChange(this.props.SelectOptions[0].Value);this.setState({Expanded:!this.state.Expanded})},d.prototype.scrollToSelectedOption=function(){if(this.state.Expanded){var b=$(ReactDOM.findDOMNode(this.refs.menu)),c=b.find(".select-option.selected");a.Utilities.Html.scrollToShowSubelement(c,b)}},d.prototype.focus=function(){var a=ReactDOM.findDOMNode(this);a.focus()},d}(a.ReactComponent);b.Select=d}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(d,__assign({},a))}b.createSimpleDialog=c;var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.componentDidMount=function(){Forms.UX.Utilities.trapFocusInsideElement(ReactDOM.findDOMNode(this))},d.prototype.shouldComponentUpdate=function(a){return!_.isEqual(this.props,a)},d.prototype.render=function(){var b=this;if(this.props.ShowDialog){var c={className:this.props.ClassName||"simple-dialog-container",key:"dialogContainer",ref:"dialogContainer",tabIndex:-1,onBlur:function(c){var d=a.Utilities.Html.getTargetElementOfFocusEvent(c),e=ReactDOM.findDOMNode(b.refs.dialogContainer);e.contains(d)||b.props.onBlur&&b.props.onBlur()},onKeyDown:function(a){return b.onKeyDown(a)},onMouseLeave:this.props.onMouseLeave,onMouseOver:this.props.onMouseOver};return React.createElement("div",__assign({},c),this.createDescription(),this.createButtons())}return null},d.prototype.createDescription=function(){if(this.props.Description){var b=a.Utilities.Html.combineAttributes("description-container",this.props.TextClassName);return React.createElement("div",{className:b,key:"descriptionContainer"},this.props.Description)}return null},d.createButtonWithProps=function(c,d){return b.createGlyphButton({ButtonStyle:c.ButtonStyle,GlyphButtonStyle:c.GlyphButtonStyle,HTMLAttributes:{autoFocus:0===d,className:c.ClassName,title:c.Title,onClick:function(a){a.preventDefault(),a.stopPropagation(),c.onClick&&c.onClick(a)}},Icon:c.IconClass,IconClassName:a.Utilities.Html.combineAttributes(c.IconClassName,"forms-icon-size24x24"),key:c.Key,ref:c.ref,Text:c.Text,TextClassName:c.TextClassName})},d.prototype.createButtons=function(){var a=this.props.ButtonsProps||[],b="buttons-container";return React.createElement("div",{className:b,key:"buttonsContainer"},a.filter(function(a){return!!a}).map(d.createButtonWithProps))},d.prototype.onKeyDown=function(b){b.keyCode===a.KeyCode.Esc&&(b.stopPropagation(),b.preventDefault(),this.props.onDismiss&&this.props.onDismiss())},d}(a.ReactComponent);b.SimpleDialog=d}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(f,a)}function d(a){return React.createElement(g,a)}var e;!function(a){a[a.SingleLine=0]="SingleLine",a[a.FixHeightMultiline=1]="FixHeightMultiline",a[a.AutoHeightMultiline=2]="AutoHeightMultiline"}(e=b.TextFieldType||(b.TextFieldType={})),b.createTextField=c;var f=function(c){function f(){var a=null!==c&&c.apply(this,arguments)||this;return a.textFieldRef=React.createRef(),a}return __extends(f,c),f.prototype.focus=function(){this.textFieldRef.current&&this.textFieldRef.current.focus()},f.prototype.createReactNodes=function(){return[this.createLabel(),this.createValueContainer()]},f.prototype.createLabel=function(){var a=this.props,c=a.Options;return a.Label||a.ShowRequiredStar?React.DOM.div(null,React.DOM.span({className:c&&c.classNameForInnerLabel},a.Label),a.ShowRequiredStar?React.createElement(b.RequiredStar):void 0):void 0},f.prototype.createValueContainer=function(){var b,c,g,h=this,i=this.props,j=i.Options,k=a.Utilities.Html.mergeReactProps(j&&j.HTMLPropsForInnerElement,{autoFocus:this.props.AutoFocus,value:i.Value,className:"office-form-textfield-input form-control border-no-radius",
placeholder:i.Placeholder,ref:this.textFieldRef,style:{height:i.MinimalHeight+"px",overflowY:i.TextFieldType===e.FixHeightMultiline?"auto":void 0},spellCheck:!0,disabled:i.Disabled,onChange:this.onChange.bind(this),maxLength:i.MaxLength?i.MaxLength:a.Form.FormLimitation.DefaultTextLength,onFocus:i.AutoSelection?function(){if(h.textFieldRef.current){var a=ReactDOM.findDOMNode(h.textFieldRef.current);a&&a.select()}}:void 0,onKeyDown:a.Utilities.Html.onKeyboardEvent(function(b){if(b.ctrlKey){var c=new Date,d=String.fromCharCode(b.keyCode),e="Ctrl+"+d;switch(d){case"C":case"X":h.duration(f.prevTimeKeyDown,c.getTime())>f.minDuration&&h.logEngagementEvent(b,a.Event.EngagementEventNames.DesignPage.ShortCut.Clipboard,e),f.prevTimeKeyDown=c.getTime();break;case"V":h.logEngagementEvent(b,a.Event.EngagementEventNames.DesignPage.ShortCut.Clipboard,e);break;case"Y":case"Z":h.logEngagementEvent(b,a.Event.EngagementEventNames.DesignPage.ShortCut.UndoRedo,e)}}}),onCopy:function(b){var c=new Date;h.duration(f.prevTimeOnCopy,c.getTime())>f.minDuration&&h.logEngagementEvent(b,a.Event.EngagementEventNames.DesignPage.ShortCut.Clipboard,"onCopy"),f.prevTimeOnCopy=c.getTime()},onPaste:function(b){h.logEngagementEvent(b,a.Event.EngagementEventNames.DesignPage.ShortCut.Clipboard,"onPaste")},onCut:function(b){var c=new Date;h.duration(f.prevTimeOnCut,c.getTime())>f.minDuration&&h.logEngagementEvent(b,a.Event.EngagementEventNames.DesignPage.ShortCut.Clipboard,"onCut"),f.prevTimeOnCut=c.getTime()}});switch(i.TextFieldType){case e.AutoHeightMultiline:var l=80,m=k,n=null==i.MinimalHeight?l:i.MinimalHeight>0?i.MinimalHeight:0;m.MinHeight=n.toString()+"px",b=d(m);break;case e.FixHeightMultiline:c=React.DOM.textarea(k);break;case e.SingleLine:default:g=React.DOM.input(k)}var o;if(i.ShowCharCounter){var p=!i.Value||k.maxLength>i.Value.length?"office-form-textfield-counter":"office-form-textfield-counter textfield-counter-warning";o=React.DOM.label({className:p},this.getCounterString(i.Value,k.maxLength))}var q=a.Utilities.Html.combineAttributes("office-form-textfield",i.Options&&i.Options.classNameForInnerDiv);return React.DOM.div({className:q},b,c,g,o)},f.prototype.onChange=function(a){var b=a.target,c=b.value;if(c&&c.length>b.maxLength&&(c=c.slice(0,b.maxLength)),this.props.onValueChange(c),this.props.ShowCharCounter){var d=ReactDOM.findDOMNode(b).nextSibling;d&&(d.innerText=this.getCounterString(c,b.maxLength))}},f.prototype.getCounterString=function(a,b){return(a||"").length.toString()+" / "+b.toString()},f.prototype.logEngagementEvent=function(b,c,d){var e;this.props.HTMLAttributes&&(e=this.props.HTMLAttributes.className),a.Event.EngagementEventDeprecated.logData({name:c,extraData:{targetClassName:e,operation:d}})},f.prototype.duration=function(a,b){return b-a},f.prevTimeKeyDown=0,f.prevTimeOnCopy=0,f.prevTimeOnCut=0,f.minDuration=500,f}(b.ControlBase);b.TextField=f;var g=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.textFieldRef=React.createRef(),b}return __extends(b,a),b.prototype.componentDidMount=function(){this.updateHeight(),this.windowResizeCallback=this.updateHeight.bind(this),window.addEventListener("resize",this.windowResizeCallback)},b.prototype.componentDidUpdate=function(){this.updateHeight()},b.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.windowResizeCallback)},b.prototype.focus=function(){this.textFieldRef.current&&this.textFieldRef.current.focus()},b.prototype.render=function(){var a=_.clone(this.props);return a.ref=this.textFieldRef,delete a.MinHeight,React.DOM.textarea(a)},b.prototype.updateHeight=function(){var a=ReactDOM.findDOMNode(this),b=this.props,c=a.parentElement,d=c.style.height;c.style.height=window.getComputedStyle(c).height,a.style.height=b.MinHeight;var e=a.offsetHeight-a.clientHeight;a.style.height=a.scrollHeight+e+"px",c.style.height=d,a.style.minHeight=b.MinHeight},b}(a.ReactComponent)}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(d,a)}b.createToggleButton=c;var d=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.createReactNodes=function(){var a=[this.createToggleElement(),this.createLabel()];return a.concat(this.props.children)},c.prototype.createLabel=function(){var b=this.props.Options,c=b&&b.classNameForInnerLabel;return this.props.Disabled&&(c=a.Utilities.Html.combineAttributes(c,"disabled")),this.props.Label?React.DOM.span({className:c},this.props.Label):void 0},c.prototype.createToggleElement=function(){var b=this.props,c=b.Options,d=a.Utilities.Html.combineAttributes(c&&c.classNameForInnerDiv,b.Disabled?"toggle-button disabled":"toggle-button",b.Value?"office-form-theme-toggle active":void 0);return React.DOM.div({className:d,tabIndex:b.Disabled?-1:0,role:"button","aria-label":b.Label,"aria-pressed":!!b.Value,onClick:b.Disabled?function(){}:function(){b.onValueChange(!b.Value)},onKeyDown:function(c){(c.keyCode===a.KeyCode.Enter||c.keyCode===a.KeyCode.Space)&&b.onValueChange(!b.Value)}})},c}(b.ControlBase)}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){a.editorAndKeysContainerId="virtualkeyboard",a.algebraKeysContainerClass="vk-keys-algebrakeys",a.editorAndKeysContainerClass="vk-container",a.editorContainerClass="vk-editor-container",a.editorInputClass="vk-editor-input",a.keyClass="vk-keys-row-key",a.keysContainerClass="vk-keys-container",a.keysRowClass="vk-keys-row",a.keyCategoryAttribute="mq-category",a.keyCommandAttribute="mq-command",a.keyValueAttribute="mq-value",a.keyCategoryAlgebra="algebra",a.keyCategoryBasic="basic",a.keyCategoryCalculating="calculating",a.keyCategoryEmpty="empty",a.keyCategoryFunction="function",a.keyCommandWrite="write",a.keyCommandCmd="cmd",a.keyCommandStroke="keystroke",a.keyCommandSubmit="submit",a.keyTypeString="string",a.keyTypeSymbol="symbol",a.idNameJoiner="_";var b;!function(a){a[a.KeyEmpty=-1]="KeyEmpty",a[a.KeyZero=0]="KeyZero",a[a.KeyOne=1]="KeyOne",a[a.KeyTwo=2]="KeyTwo",a[a.KeyThree=3]="KeyThree",a[a.KeyFour=4]="KeyFour",a[a.KeyFive=5]="KeyFive",a[a.KeySix=6]="KeySix",a[a.KeySeven=7]="KeySeven",a[a.KeyEight=8]="KeyEight",a[a.KeyNine=9]="KeyNine",a[a.KeyEqual=10]="KeyEqual",a[a.KeyDot=11]="KeyDot",a[a.KeyComma=12]="KeyComma",a[a.KeyBackSpace=13]="KeyBackSpace",a[a.KeyLeftArrow=14]="KeyLeftArrow",a[a.KeyRightArrow=15]="KeyRightArrow",a[a.KeyAdd=16]="KeyAdd",a[a.KeyMinus=17]="KeyMinus",a[a.KeyMultiple=18]="KeyMultiple",a[a.KeyDivision=19]="KeyDivision",a[a.KeyGreaterOrEqual=20]="KeyGreaterOrEqual",a[a.KeyLessOrEqual=21]="KeyLessOrEqual",a[a.KeyParenthesis=22]="KeyParenthesis",a[a.KeyBracket=23]="KeyBracket",a[a.KeyAbs=24]="KeyAbs",a[a.KeyDenominator=25]="KeyDenominator",a[a.KeySquareRoot=26]="KeySquareRoot",a[a.KeyNthRoot=27]="KeyNthRoot",a[a.KeyX=28]="KeyX",a[a.KeyY=29]="KeyY",a[a.KeySquare=30]="KeySquare",a[a.KeyCaret=31]="KeyCaret",a[a.KeySubscript=32]="KeySubscript",a[a.KeyPi=33]="KeyPi",a[a.KeyAlpha=34]="KeyAlpha",a[a.KeyBeta=35]="KeyBeta",a[a.KeyDelta=36]="KeyDelta",a[a.KeyTheta=37]="KeyTheta",a[a.KeyGamma=38]="KeyGamma",a[a.KeySigma=39]="KeySigma",a[a.KeyLambda=40]="KeyLambda",a[a.KeyVarepsilon=41]="KeyVarepsilon",a[a.KeyCapitalSigma=42]="KeyCapitalSigma",a[a.KeyPhi=43]="KeyPhi",a[a.KeyCapitalDelta=44]="KeyCapitalDelta",a[a.KeyLog=45]="KeyLog",a[a.KeyLn=46]="KeyLn",a[a.KeyFactorial=47]="KeyFactorial",a[a.KeyInfinity=48]="KeyInfinity",a[a.KeyGreater=49]="KeyGreater",a[a.KeyLess=50]="KeyLess",a[a.KeyNotEqual=51]="KeyNotEqual",a[a.KeyMod=52]="KeyMod",a[a.KeyFloor=53]="KeyFloor",a[a.KeyCeil=54]="KeyCeil",a[a.KeySum=55]="KeySum",a[a.KeyProd=56]="KeyProd",a[a.KeyEnter=57]="KeyEnter",a[a.KeySin=58]="KeySin",a[a.KeyCos=59]="KeyCos",a[a.KeyTan=60]="KeyTan",a[a.KeyCot=61]="KeyCot",a[a.KeyDegree=62]="KeyDegree"}(b=a.KeyIdEnum||(a.KeyIdEnum={}));var c;!function(a){a[a.AlgebraKeyboard=0]="AlgebraKeyboard",a[a.BasicKeyboard=1]="BasicKeyboard"}(c=a.KeyboardTypeEnum||(a.KeyboardTypeEnum={})),a.cursorResetKeyIds=[b.KeyLog,b.KeyFactorial,b.KeyCeil,b.KeyFloor]}(b=a.KeyboardConstants||(a.KeyboardConstants={}))}(b=a.VirtualKeyboard||(a.VirtualKeyboard={}))}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=function(){function c(){this.keyStorage=[{id:b.KeyboardConstants.KeyIdEnum.KeyEmpty,command:null,type:null,value:null,displayValue:null,category:b.KeyboardConstants.keyCategoryEmpty,title:null},{id:b.KeyboardConstants.KeyIdEnum.KeyZero,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"0",displayValue:"0",category:b.KeyboardConstants.keyCategoryBasic,title:"0"},{id:b.KeyboardConstants.KeyIdEnum.KeyOne,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"1",displayValue:"1",category:b.KeyboardConstants.keyCategoryBasic,title:"1"},{id:b.KeyboardConstants.KeyIdEnum.KeyTwo,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"2",displayValue:"2",category:b.KeyboardConstants.keyCategoryBasic,title:"2"},{id:b.KeyboardConstants.KeyIdEnum.KeyThree,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"3",displayValue:"3",category:b.KeyboardConstants.keyCategoryBasic,title:"3"},{id:b.KeyboardConstants.KeyIdEnum.KeyFour,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"4",displayValue:"4",category:b.KeyboardConstants.keyCategoryBasic,title:"4"},{id:b.KeyboardConstants.KeyIdEnum.KeyFive,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"5",displayValue:"5",category:b.KeyboardConstants.keyCategoryBasic,title:"5"},{id:b.KeyboardConstants.KeyIdEnum.KeySix,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"6",displayValue:"6",category:b.KeyboardConstants.keyCategoryBasic,title:"6"},{id:b.KeyboardConstants.KeyIdEnum.KeySeven,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"7",displayValue:"7",category:b.KeyboardConstants.keyCategoryBasic,title:"7"},{id:b.KeyboardConstants.KeyIdEnum.KeyEight,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"8",displayValue:"8",category:b.KeyboardConstants.keyCategoryBasic,title:"8"},{id:b.KeyboardConstants.KeyIdEnum.KeyNine,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"9",displayValue:"9",category:b.KeyboardConstants.keyCategoryBasic,title:"9"},{id:b.KeyboardConstants.KeyIdEnum.KeyEqual,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"=",displayValue:"=",category:b.KeyboardConstants.keyCategoryCalculating,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Equal},{id:b.KeyboardConstants.KeyIdEnum.KeyDot,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:".",displayValue:".",category:b.KeyboardConstants.keyCategoryBasic,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Dot},{id:b.KeyboardConstants.KeyIdEnum.KeyComma,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:",",displayValue:",",category:b.KeyboardConstants.keyCategoryBasic,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Comma},{id:b.KeyboardConstants.KeyIdEnum.KeyBackSpace,command:b.KeyboardConstants.keyCommandStroke,type:b.KeyboardConstants.keyTypeString,value:"Backspace",displayValue:"CE",category:b.KeyboardConstants.keyCategoryFunction,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Backspace},{id:b.KeyboardConstants.KeyIdEnum.KeyLeftArrow,command:b.KeyboardConstants.keyCommandStroke,type:b.KeyboardConstants.keyTypeString,value:"Left",displayValue:"",category:b.KeyboardConstants.keyCategoryFunction,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Leftarrow},{id:b.KeyboardConstants.KeyIdEnum.KeyRightArrow,command:b.KeyboardConstants.keyCommandStroke,type:b.KeyboardConstants.keyTypeString,value:"Right",displayValue:"",category:b.KeyboardConstants.keyCategoryFunction,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Rightarrow},{id:b.KeyboardConstants.KeyIdEnum.KeyAdd,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"+",displayValue:"+",category:b.KeyboardConstants.keyCategoryCalculating,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Add},{id:b.KeyboardConstants.KeyIdEnum.KeyMinus,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"-",displayValue:"-",category:b.KeyboardConstants.keyCategoryCalculating,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Minus},{id:b.KeyboardConstants.KeyIdEnum.KeyMultiple,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\times",displayValue:"",category:b.KeyboardConstants.keyCategoryCalculating,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Multiply},{id:b.KeyboardConstants.KeyIdEnum.KeyDivision,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\div",displayValue:"",category:b.KeyboardConstants.keyCategoryCalculating,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Division},{id:b.KeyboardConstants.KeyIdEnum.KeyGreaterOrEqual,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\ge",displayValue:"",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_GreaterOrEqual},{id:b.KeyboardConstants.KeyIdEnum.KeyLessOrEqual,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\le",displayValue:"",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_LessOrEqual},{id:b.KeyboardConstants.KeyIdEnum.KeyParenthesis,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"(",displayValue:"( )",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Parenthesis},{id:b.KeyboardConstants.KeyIdEnum.KeyBracket,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"[",displayValue:"[ ]",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Bracket},{id:b.KeyboardConstants.KeyIdEnum.KeyAbs,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"|",displayValue:"|x|",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Absolute},{id:b.KeyboardConstants.KeyIdEnum.KeyDenominator,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeSymbol,value:"/",displayValue:"\\frac{x}{}",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Fraction},{id:b.KeyboardConstants.KeyIdEnum.KeySquareRoot,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeSymbol,value:"\\sqrt",displayValue:"\\sqrt{}",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_SquareRoot},{id:b.KeyboardConstants.KeyIdEnum.KeyNthRoot,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeSymbol,value:"\\nthroot",displayValue:"\\sqrt[]{}",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_NthRoot},{id:b.KeyboardConstants.KeyIdEnum.KeyX,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"x",displayValue:"x",category:b.KeyboardConstants.keyCategoryAlgebra,title:"x"},{id:b.KeyboardConstants.KeyIdEnum.KeyY,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"y",displayValue:"y",category:b.KeyboardConstants.keyCategoryAlgebra,title:"y"},{id:b.KeyboardConstants.KeyIdEnum.KeySquare,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeSymbol,value:"^2",displayValue:"x^2",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Square},{id:b.KeyboardConstants.KeyIdEnum.KeyCaret,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeSymbol,value:"^",displayValue:"x^{}",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Exponent},{id:b.KeyboardConstants.KeyIdEnum.KeySubscript,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeSymbol,value:"_",displayValue:"x_{}",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Subscript},{id:b.KeyboardConstants.KeyIdEnum.KeyPi,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\pi",displayValue:"",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Pi},{id:b.KeyboardConstants.KeyIdEnum.KeyAlpha,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\alpha",displayValue:"",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Alpha},{id:b.KeyboardConstants.KeyIdEnum.KeyBeta,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\beta",displayValue:"",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Beta},{id:b.KeyboardConstants.KeyIdEnum.KeyDelta,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\delta",displayValue:"",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Delta},{id:b.KeyboardConstants.KeyIdEnum.KeyTheta,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\theta",displayValue:"",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Theta},{id:b.KeyboardConstants.KeyIdEnum.KeyGamma,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\gamma",displayValue:"",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Gamma},{id:b.KeyboardConstants.KeyIdEnum.KeySigma,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\sigma",displayValue:"",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Sigma},{id:b.KeyboardConstants.KeyIdEnum.KeyLambda,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\lambda",displayValue:"",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Lambda},{id:b.KeyboardConstants.KeyIdEnum.KeyVarepsilon,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\varepsilon",displayValue:"",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Varepsilon},{id:b.KeyboardConstants.KeyIdEnum.KeyCapitalSigma,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\Sigma",displayValue:"",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_CapitalSigma},{id:b.KeyboardConstants.KeyIdEnum.KeyPhi,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\phi",displayValue:"",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Phi},{id:b.KeyboardConstants.KeyIdEnum.KeyCapitalDelta,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\Delta",displayValue:"",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_CapitalDelta},{id:b.KeyboardConstants.KeyIdEnum.KeyLog,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeSymbol,value:"\\log_{}",displayValue:"\\log_{}",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Log},{id:b.KeyboardConstants.KeyIdEnum.KeyLn,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\ln",displayValue:"ln",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Ln},{id:b.KeyboardConstants.KeyIdEnum.KeyFactorial,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"!",displayValue:"x!",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Factorial},{id:b.KeyboardConstants.KeyIdEnum.KeyInfinity,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\infty",displayValue:"",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Infinity},{id:b.KeyboardConstants.KeyIdEnum.KeyGreater,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:">",displayValue:">",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Greater},{id:b.KeyboardConstants.KeyIdEnum.KeyLess,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"<",displayValue:"<",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Less},{id:b.KeyboardConstants.KeyIdEnum.KeyNotEqual,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\neq",displayValue:"",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_NotEqual},{id:b.KeyboardConstants.KeyIdEnum.KeyMod,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\mod",displayValue:"mod",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Mod},{id:b.KeyboardConstants.KeyIdEnum.KeyFloor,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\lfloor{}\\rfloor",displayValue:"x",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Floor},{id:b.KeyboardConstants.KeyIdEnum.KeyCeil,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeString,value:"\\lceil{}\\rceil",displayValue:"x",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Ceil},{id:b.KeyboardConstants.KeyIdEnum.KeySum,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\sum",displayValue:"",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Sum},{id:b.KeyboardConstants.KeyIdEnum.KeyProd,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\prod",displayValue:"",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Prod},{id:b.KeyboardConstants.KeyIdEnum.KeyEnter,command:b.KeyboardConstants.keyCommandSubmit,type:b.KeyboardConstants.keyTypeString,value:"Enter",displayValue:"OK",category:b.KeyboardConstants.keyCategoryFunction,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Enter},{id:b.KeyboardConstants.KeyIdEnum.KeySin,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\sin",displayValue:"sin",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Sin},{id:b.KeyboardConstants.KeyIdEnum.KeyCos,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\cos",displayValue:"cos",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Cos},{id:b.KeyboardConstants.KeyIdEnum.KeyTan,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\tan",displayValue:"tan",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Tan},{id:b.KeyboardConstants.KeyIdEnum.KeyCot,command:b.KeyboardConstants.keyCommandCmd,type:b.KeyboardConstants.keyTypeString,value:"\\cot",displayValue:"cot",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Cot},{id:b.KeyboardConstants.KeyIdEnum.KeyDegree,command:b.KeyboardConstants.keyCommandWrite,type:b.KeyboardConstants.keyTypeSymbol,value:"^\\circ",displayValue:"^\\circ",category:b.KeyboardConstants.keyCategoryAlgebra,title:a.Form.Resources.LocalizedStrings.VirtualKeyboard_Button_Degree}]}return c.prototype.getDefinition=function(a){var b=this.keyStorage.filter(function(b){return b.id===a});return b[0]},c}();b.KeyStrokeManager=c}(c=b.VirtualKeyboard||(b.VirtualKeyboard={}))}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=function(){function c(){this.clickUsage={},this.keydownUsage={},this.keyCategory=[{id:b.KeyboardConstants.KeyIdEnum.KeyDot,category:d.Decimal},{id:b.KeyboardConstants.KeyIdEnum.KeyX,category:d.Variable},{id:b.KeyboardConstants.KeyIdEnum.KeyY,category:d.Variable},{id:b.KeyboardConstants.KeyIdEnum.KeySubscript,category:d.Variable},{id:b.KeyboardConstants.KeyIdEnum.KeyDenominator,category:d.Variable},{id:b.KeyboardConstants.KeyIdEnum.KeyPi,category:d.Constant},{id:b.KeyboardConstants.KeyIdEnum.KeyInfinity,category:d.Constant},{id:b.KeyboardConstants.KeyIdEnum.KeyBracket,category:d.Group},{id:b.KeyboardConstants.KeyIdEnum.KeyParenthesis,category:d.Group},{id:b.KeyboardConstants.KeyIdEnum.KeyGreater,category:d.Comparison},{id:b.KeyboardConstants.KeyIdEnum.KeyGreaterOrEqual,category:d.Comparison},{id:b.KeyboardConstants.KeyIdEnum.KeyLess,category:d.Comparison},{id:b.KeyboardConstants.KeyIdEnum.KeyLessOrEqual,category:d.Comparison},{id:b.KeyboardConstants.KeyIdEnum.KeyNotEqual,category:d.Comparison},{id:b.KeyboardConstants.KeyIdEnum.KeyNthRoot,category:d.Exponent},{id:b.KeyboardConstants.KeyIdEnum.KeySquareRoot,category:d.Exponent},{id:b.KeyboardConstants.KeyIdEnum.KeySquare,category:d.Exponent},{id:b.KeyboardConstants.KeyIdEnum.KeyCaret,category:d.Exponent},{id:b.KeyboardConstants.KeyIdEnum.KeyLog,category:d.Logarithm},{id:b.KeyboardConstants.KeyIdEnum.KeyLn,category:d.Logarithm},{id:b.KeyboardConstants.KeyIdEnum.KeyFactorial,category:d.Sequence},{id:b.KeyboardConstants.KeyIdEnum.KeySum,category:d.Sequence},{id:b.KeyboardConstants.KeyIdEnum.KeyProd,category:d.Sequence},{id:b.KeyboardConstants.KeyIdEnum.KeyCeil,category:d.Approximate},{id:b.KeyboardConstants.KeyIdEnum.KeyFloor,category:d.Approximate},{id:b.KeyboardConstants.KeyIdEnum.KeyAbs,category:d.Absolute},{id:b.KeyboardConstants.KeyIdEnum.KeyDegree,category:d.Degree}];for(var c=a.Utilities.getAllEnumValueNames(d),e=0;e<c.length;e++)this.clickUsage[c[e]]=0,this.keydownUsage[c[e]]=0}return c.prototype.setClickUsage=function(a){var b=this.getCategoryByKeyId(a);b>=0&&this.clickUsage[d[b]]++},c.prototype.setKeyDownUsage=function(a){var b=this.getCategoryByKeyId(a);b>=0&&this.keydownUsage[d[b]]++},c.prototype.getClickUsage=function(){return this.clickUsage},c.prototype.getKeyDownUsage=function(){return this.keydownUsage},c.prototype.getCategoryByKeyId=function(a){var b=this.keyCategory.filter(function(b){return b.id===a});return b&&b[0]?b[0].category:-1},c}();b.KeyUsageManager=c;var d;!function(a){a[a.Decimal=0]="Decimal",a[a.Variable=1]="Variable",a[a.Constant=2]="Constant",a[a.Group=3]="Group",a[a.Comparison=4]="Comparison",a[a.Exponent=5]="Exponent",a[a.Logarithm=6]="Logarithm",a[a.Sequence=7]="Sequence",a[a.Approximate=8]="Approximate",a[a.Absolute=9]="Absolute",a[a.Degree=10]="Degree"}(d||(d={}))}(c=b.VirtualKeyboard||(b.VirtualKeyboard={}))}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=function(){function c(c,d){this.controlId=null,this.isTabable=!0,this.isVisible=!1,this.isMouseDown=!1,this.onMathEditorInsertion=new a.Utilities.Process.CallbackManager,this.onInputCompleted=new a.Utilities.Process.CallbackManager,this.onExitEditingMath=new a.Utilities.Process.CallbackManager,this.mathEditor=null,this.editorAndKeysContainer=null,this.editorContainer=null,this.editorInput=null,this.keysContainer=null,this.keyMap=[],this.keyLayoutRowCount=null,this.keyLayoutColumnCount=null,this.keyStrokeManager=new b.KeyStrokeManager,this.keyUsageManager=new b.KeyUsageManager,this.outsiderContainerSelector="#body-scrollable-content",d?this.controlId=d:this.controlId=a.Utilities.Guid.newGuid(),this.createLayout(c),this.activateKeyboard()}return c.prototype.show=function(){this.isVisible||(this.editorAndKeysContainer.show(),this.mathEditor.focus(),this.isVisible=!0)},c.prototype.close=function(){var b=this.keyUsageManager.getClickUsage(),c=this.keyUsageManager.getKeyDownUsage();a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.MathKeyboard.Navigate,extraData:{clickCount:b,keydownCount:c}}),$(this.outsiderContainerSelector).off("click",this.onBodyClick),this.isVisible&&(this.editorAndKeysContainer.hide(),this.isVisible=!1)},c.prototype.attachEvent=function(a,c){if(c)switch(a){case b.KeyboardEventName.onMathEditorInsertion:this.onMathEditorInsertion.register(c);break;case b.KeyboardEventName.onInputCompleted:this.onInputCompleted.register(c);break;case b.KeyboardEventName.onExitEditingMath:this.onExitEditingMath.register(c)}},c.prototype.detachEvent=function(a,c){switch(a){case b.KeyboardEventName.onMathEditorInsertion:this.onMathEditorInsertion.unregister(c);break;case b.KeyboardEventName.onInputCompleted:this.onInputCompleted.unregister(c);break;case b.KeyboardEventName.onExitEditingMath:this.onExitEditingMath.unregister(c)}},c.prototype.setValue=function(a){this.mathEditor.select(),this.mathEditor.write(a),this.mathEditor.focus()},c.prototype.getValue=function(){return this.mathEditor.latex()},c.prototype.reset=function(){this.mathEditor.select(),this.mathEditor.keystroke("Backspace"),this.mathEditor.focus()},c.prototype.getElementId=function(a){return[this.controlId,a].join(b.KeyboardConstants.idNameJoiner)},c.prototype.parseKeyId=function(a){var c=a.split(b.KeyboardConstants.idNameJoiner);return c.length>=2?Number(c[1]):null},c.prototype.createLayout=function(a){this.editorAndKeysContainer=$("<div/>",{id:this.getElementId(b.KeyboardConstants.editorAndKeysContainerId),dir:"ltr"}).addClass(b.KeyboardConstants.editorAndKeysContainerClass).appendTo(a),this.createEditorLayout(),this.createKeysLayout()},c.prototype.activateKeyboard=function(){var a=this;this.onBodyClick=function(b){a.editorAndKeysContainer&&!a.editorAndKeysContainer.is(b.target)&&0===a.editorAndKeysContainer.has(b.target).length&&(a.isMouseDown?(b.preventDefault(),b.stopPropagation(),a.isMouseDown=!1):a.onInputCompleted.trigger(b))},$(this.outsiderContainerSelector).click(this.onBodyClick),this.editorInput.mousedown(function(b){b.preventDefault(),b.stopPropagation(),a.isMouseDown=!0}),this.editorInput.mouseup(function(b){a.isMouseDown=!1}),this.activateEditor(),this.activateKeys()},c.prototype.createEditorLayout=function(){this.editorContainer=$("<div/>").addClass(b.KeyboardConstants.editorContainerClass).attr({"aria-live":"polite"}).appendTo(this.editorAndKeysContainer),
this.editorInput=$("<span/>").addClass(b.KeyboardConstants.editorInputClass).appendTo(this.editorContainer)},c.prototype.createKeysLayout=function(){this.keysContainer=$("<div/>").addClass(b.KeyboardConstants.keysContainerClass).appendTo(this.editorAndKeysContainer);var a=$("<div/>").addClass(b.KeyboardConstants.algebraKeysContainerClass).attr({role:"grid"}).appendTo(this.keysContainer);this.createSubKeysLayout(a)},c.prototype.createSubKeysLayout=function(c){var d=this,e=c.attr("class"),f=[];if(e!==b.KeyboardConstants.algebraKeysContainerClass)throw Error("className is not found.");f=b.KeysLayoutManager.getAlgebraLayout(),f.forEach(function(e){var f=$("<div/>").addClass(b.KeyboardConstants.keysRowClass).attr({role:"row"}).appendTo(c);e.forEach(function(c){var e=d.keyStrokeManager.getDefinition(c);if(e){var g={"class":a.Utilities.Html.combineAttributes("office-form-theme-interactive-color",b.KeyboardConstants.keyClass),id:d.getElementId(e.id.toString()),tabindex:-1,title:e.title,role:"gridcell","aria-label":e.title};g[b.KeyboardConstants.keyCommandAttribute]=e.command,g[b.KeyboardConstants.keyValueAttribute]=e.value,g[b.KeyboardConstants.keyCategoryAttribute]=e.category;var h=e.id===b.KeyboardConstants.KeyIdEnum.KeyEmpty?$("<div/>"):$("<button/>");h.attr(g).appendTo(f);$("<span/>").addClass([b.KeyboardConstants.keyClass,e.type].join("-")).text(e.displayValue).attr({"aria-hidden":!0}).appendTo(h);d.isTabable&&(h.removeAttr("tabindex"),d.isTabable=!1),e.command===b.KeyboardConstants.keyCommandSubmit&&(h.removeClass("office-form-theme-interactive-color"),h.addClass("office-form-theme-button"),h.removeAttr(b.KeyboardConstants.keyCategoryAttribute))}})})},c.prototype.activateEditor=function(){var c=this;if(!(this.editorInput&&this.editorInput.length>0))throw Error("Can not render mathField, editorInput is undefined.");var d=MathQuill.getInterface(2).MathField(this.editorInput[0]);this.mathEditor=d,this.editorInput.on("mousedown",".mq-text-mode",function(a){a.preventDefault(),a.stopPropagation()}),this.editorInput.on("keypress",function(a){var d=a.charCode||a.which,e=String.fromCharCode(d);e&&e.match(/^[(0-9.=+*\-)]$/)&&("*"===e&&(a.preventDefault(),a.stopPropagation(),e=c.keyStrokeManager.getDefinition(b.KeyboardConstants.KeyIdEnum.KeyMultiple).value,c.mathEditor.write(e),e="\\"+e),c.keyAnimation(e))}),this.editorInput.on("keydown",function(b){var d=b.keyCode||b.which,e=null;switch(d){case a.KeyCode.ArrowLeft:e="Left";break;case a.KeyCode.ArrowRight:e="Right";break;case a.KeyCode.BackSpace:e="Backspace"}c.keyAnimation(e),d===a.KeyCode.Enter?(b.preventDefault(),b.stopPropagation(),c.onInputCompleted.trigger(b)):d===a.KeyCode.PlaceHolder?b.key&&b.key.match(/^[a-zA-Z]$|^Unidentified$/)&&(b.preventDefault(),b.stopPropagation()):b.shiftKey&&d===a.KeyCode.Tab?c.onInputCompleted.trigger(b):d===a.KeyCode.Esc&&c.onExitEditingMath.trigger(b)})},c.prototype.activateKeys=function(){var c=this,d=this.keysContainer.find("."+[b.KeyboardConstants.keyClass,b.KeyboardConstants.keyTypeSymbol].join("-")),e=b.KeysLayoutManager.getAlgebraLayout();this.keyMap=b.KeysLayoutManager.getKeyMap(e),this.keyLayoutColumnCount=b.KeysLayoutManager.getLayoutColumnCount(e);for(var f=0;f<d.length;f++)MathQuill.getInterface(2).StaticMath(d[f]);this.keysContainer.on("mousedown",function(a){a.preventDefault(),a.stopPropagation(),c.mathEditor.focus()}),this.keysContainer.find("."+b.KeyboardConstants.keyClass).on("mousedown",function(a){if(!c.mathEditor)throw Error("mathEditor undefined.");a.preventDefault(),a.stopPropagation();var b=$(a.currentTarget);c.keyUsageManager.setClickUsage(c.getKeyId(b)),c.sendMathCommand(b),c.mathEditor.focus()}),this.keysContainer.find(".mq-root-block").on("mousedown",function(a){a.preventDefault(),a.stopPropagation();var d=$(a.currentTarget).closest("."+b.KeyboardConstants.keyClass);c.sendMathCommand(d)}),this.keysContainer.find("."+b.KeyboardConstants.keyClass).on("keydown",function(b){var d=b.which||b.keyCode,e=b.shiftKey;if(!e){var f=$(b.currentTarget);switch(d){case a.KeyCode.ArrowDown:case a.KeyCode.ArrowUp:case a.KeyCode.ArrowLeft:case a.KeyCode.ArrowRight:b.preventDefault(),b.stopPropagation();var g=c.getNextKeyId(f,d);if(g>=0){var h=c.getElementId(g.toString());$("#"+h).focus()}break;case a.KeyCode.Enter:case a.KeyCode.Space:b.preventDefault(),b.stopPropagation(),c.keyUsageManager.setKeyDownUsage(c.getKeyId(f)),c.sendMathCommand(f),f.focus();break;case a.KeyCode.BackSpace:b.preventDefault(),b.stopPropagation(),c.mathEditor.keystroke("Backspace");break;case a.KeyCode.Esc:c.onExitEditingMath.trigger(b)}}}),this.keysContainer.find("."+b.KeyboardConstants.keyClass).on("keypress",function(a){a.charCode>0&&c.mathEditor.typedText(String.fromCharCode(a.charCode))})},c.prototype.sendMathCommand=function(a){var c=a.attr(b.KeyboardConstants.keyCommandAttribute),d=a.attr(b.KeyboardConstants.keyValueAttribute);switch(c){case b.KeyboardConstants.keyCommandCmd:this.mathEditor.cmd(d);break;case b.KeyboardConstants.keyCommandWrite:this.mathEditor.write(d);break;case b.KeyboardConstants.keyCommandStroke:this.mathEditor.keystroke(d);break;case b.KeyboardConstants.keyCommandSubmit:this.onInputCompleted.trigger()}var e=this.parseKeyId(a.attr("id"));this.adjustCursor(e)},c.prototype.getNextKeyId=function(c,d){var e=this.parseKeyId(c.attr("id")),f=this.keyMap.indexOf(e);if(f>=0){var g=[-1,-1*this.keyLayoutColumnCount,1,this.keyLayoutColumnCount],h=f+g[d-a.KeyCode.ArrowLeft];if(h>=this.keyMap.length||-1>=h)return e;for(;this.keyMap[h]===b.KeyboardConstants.KeyIdEnum.KeyEmpty;)h+=d===a.KeyCode.ArrowRight?1:-1;return this.keyMap[h]}},c.prototype.keyAnimation=function(a){if(a){var c=this.keysContainer.find("["+b.KeyboardConstants.keyValueAttribute+"='"+a+"']");c&&(c.css("background-color","#D2D2D2"),setTimeout(function(){c.css("background-color","")},200))}},c.prototype.getKeyId=function(a){var b=a.attr("id");if(b)return this.parseKeyId(b)},c.prototype.adjustCursor=function(a){-1!==b.KeyboardConstants.cursorResetKeyIds.indexOf(a)&&this.mathEditor.keystroke("Left")},c}();b.VirtualKeyboard=c}(c=b.VirtualKeyboard||(b.VirtualKeyboard={}))}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){a.onMathEditorInsertion="onMathInsertion",a.onInputCompleted="onInputCompleted",a.onExitEditingMath="onExitEditingMath"}(b=a.KeyboardEventName||(a.KeyboardEventName={}))}(b=a.VirtualKeyboard||(a.VirtualKeyboard={}))}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(){function b(){}return b.getAlgebraLayout=function(){return b.algebraLayoutArray},b.getLayoutRowCount=function(a){return a?0:a.length},b.getLayoutColumnCount=function(a){return a&&a.length>0?a[0].length:0},b.getKeyMap=function(a){var c=[];if(!a)return c;for(var d=a.length,e=b.getLayoutColumnCount(a),f=0,g=0;d>g;g++)for(var h=0;e>h;h++)c[f]=a[g][h],f++;return c},b.algebraLayoutArray=[[a.KeyboardConstants.KeyIdEnum.KeyX,a.KeyboardConstants.KeyIdEnum.KeyY,a.KeyboardConstants.KeyIdEnum.KeySubscript,a.KeyboardConstants.KeyIdEnum.KeyDenominator,a.KeyboardConstants.KeyIdEnum.KeyBracket,a.KeyboardConstants.KeyIdEnum.KeyParenthesis,a.KeyboardConstants.KeyIdEnum.KeySeven,a.KeyboardConstants.KeyIdEnum.KeyEight,a.KeyboardConstants.KeyIdEnum.KeyNine,a.KeyboardConstants.KeyIdEnum.KeyDivision],[a.KeyboardConstants.KeyIdEnum.KeyGreater,a.KeyboardConstants.KeyIdEnum.KeyLess,a.KeyboardConstants.KeyIdEnum.KeyGreaterOrEqual,a.KeyboardConstants.KeyIdEnum.KeyLessOrEqual,a.KeyboardConstants.KeyIdEnum.KeyNotEqual,a.KeyboardConstants.KeyIdEnum.KeyAbs,a.KeyboardConstants.KeyIdEnum.KeyFour,a.KeyboardConstants.KeyIdEnum.KeyFive,a.KeyboardConstants.KeyIdEnum.KeySix,a.KeyboardConstants.KeyIdEnum.KeyMultiple],[a.KeyboardConstants.KeyIdEnum.KeySquareRoot,a.KeyboardConstants.KeyIdEnum.KeyNthRoot,a.KeyboardConstants.KeyIdEnum.KeySquare,a.KeyboardConstants.KeyIdEnum.KeyCaret,a.KeyboardConstants.KeyIdEnum.KeyLog,a.KeyboardConstants.KeyIdEnum.KeyLn,a.KeyboardConstants.KeyIdEnum.KeyOne,a.KeyboardConstants.KeyIdEnum.KeyTwo,a.KeyboardConstants.KeyIdEnum.KeyThree,a.KeyboardConstants.KeyIdEnum.KeyMinus],[a.KeyboardConstants.KeyIdEnum.KeyPi,a.KeyboardConstants.KeyIdEnum.KeyFactorial,a.KeyboardConstants.KeyIdEnum.KeySum,a.KeyboardConstants.KeyIdEnum.KeyProd,a.KeyboardConstants.KeyIdEnum.KeyFloor,a.KeyboardConstants.KeyIdEnum.KeyCeil,a.KeyboardConstants.KeyIdEnum.KeyZero,a.KeyboardConstants.KeyIdEnum.KeyDot,a.KeyboardConstants.KeyIdEnum.KeyEqual,a.KeyboardConstants.KeyIdEnum.KeyAdd],[a.KeyboardConstants.KeyIdEnum.KeyInfinity,a.KeyboardConstants.KeyIdEnum.KeyDegree,a.KeyboardConstants.KeyIdEnum.KeyEmpty,a.KeyboardConstants.KeyIdEnum.KeyBackSpace,a.KeyboardConstants.KeyIdEnum.KeyLeftArrow,a.KeyboardConstants.KeyIdEnum.KeyRightArrow,a.KeyboardConstants.KeyIdEnum.KeyEnter]],b}();a.KeysLayoutManager=b}(b=a.VirtualKeyboard||(a.VirtualKeyboard={}))}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(c){function d(){var b=null!==c&&c.apply(this,arguments)||this;return b.state={MathQuillLoaded:!1},b.onBlur=function(c){var d=a.Utilities.Html.getTargetElementOfFocusEvent(c),e=ReactDOM.findDOMNode(b);e.contains(d)||(b.props.onExit&&b.props.onExit(),b.props.onBoxBlur&&b.props.onBoxBlur(c))},b}return __extends(d,c),d.prototype.render=function(){return React.createElement("div",{onBlur:this.onBlur,ref:"VirtualKeyboard"})},d.prototype.componentWillMount=function(){var b=this;a.JavaScriptLoader.loadJavaScript("MathQuill").done(function(){b.setState({MathQuillLoaded:!0})})},d.prototype.componentDidMount=function(){this.renderVirtualKeyboard()},d.prototype.componentDidUpdate=function(){this.renderVirtualKeyboard()},d.prototype.componentWillUnmount=function(){this.keyborad&&(this.props.onValueChange(this.keyborad.getValue()),this.keyborad.close(),this.keyborad.detachEvent(b.VirtualKeyboard.KeyboardEventName.onInputCompleted,this.onValueChange),this.keyborad.detachEvent(b.VirtualKeyboard.KeyboardEventName.onExitEditingMath,this.onExitEdit))},d.prototype.renderVirtualKeyboard=function(){var a=this;if(this.state.MathQuillLoaded&&!this.keyborad){var c=$(ReactDOM.findDOMNode(this.refs.VirtualKeyboard));this.keyborad=new b.VirtualKeyboard.VirtualKeyboard(c,this.props.QuestionId),this.keyborad.show(),this.keyborad.setValue(this.props.Value),this.onExitEdit=function(b){a.props.onExit&&a.props.onExit(!0),a.props.onBoxBlur&&a.props.onBoxBlur()},this.onValueChange=function(b,c){a.props.onValueChange(a.keyborad.getValue()),a.onExitEdit(b)},this.keyborad.attachEvent(b.VirtualKeyboard.KeyboardEventName.onInputCompleted,this.onValueChange),this.keyborad.attachEvent(b.VirtualKeyboard.KeyboardEventName.onExitEditingMath,this.onExitEdit)}},d}(a.ReactComponent);b.VirtualKeyboardControl=c}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){a.Exports.DataProvider=b}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(a){a[a.OFFICE_FORMS_PLAN_2=0]="OFFICE_FORMS_PLAN_2",a[a.OFFICE_FORMS_PLAN_3=1]="OFFICE_FORMS_PLAN_3"}(c=b.EduLicenseName||(b.EduLicenseName={}));var d;!function(a){a[a.FORMS_PLAN_E1=0]="FORMS_PLAN_E1",a[a.FORMS_PLAN_E3=1]="FORMS_PLAN_E3",a[a.FORMS_PLAN_E5=2]="FORMS_PLAN_E5",a[a.FORMS_PLAN_K=3]="FORMS_PLAN_K"}(d=b.BusinessLicenseName||(b.BusinessLicenseName={}));var e;!function(a){a[a.FORMS_PRO=0]="FORMS_PRO"}(e||(e={}));var f=function(){function f(){}return f.isEduUser=function(){return f.getUserInfo().then(function(){return f.userHasEduLicense})},f.isBusinessUser=function(){return f.getUserInfo().then(function(){return f.userHasBusinessLicense})},f.isMsaFreeUser=function(){return f.getUserInfo().then(function(){return f.isMsaUser()&&!f.userHasMsaPaidLicense})},f.isMsaPaidUser=function(){return f.getUserInfo().then(function(){return f.isMsaUser()&&f.userHasMsaPaidLicense})},f.isMsaUser=function(){var b=OfficeFormServerInfo.userInfo.TenantId;return!(!b||b.toLowerCase()!==a.EnvironmentConfig.getMsaTenantId())},f.isMsftUser=function(){var b=OfficeFormServerInfo.userInfo.TenantId;return!(!b||b.toLowerCase()!==a.EnvironmentConfig.getMsftTenantId())},f.isFastFoodTenant=function(){var b=OfficeFormServerInfo.userInfo.TenantId;return b&&-1!==a.EnvironmentConfig.getFastFoodTenantsId().indexOf(b.toLowerCase())},f.isFastFoodUser=function(){return a.Utilities.anyTrue(f.checkFastFoodUser("226a6eec-ea8c-4fad-a271-a956d378dc05"),f.checkFastFoodUser("0152e40c-08b6-4c80-8237-1ed743bc1f61"),f.checkFastFoodUser("bec3c99a-0246-4948-afa5-0e625c24e8b0"),f.checkFastFoodUser("7dec8ae0-a475-4883-a38a-537e74b6c036"))},f.isFormsProUser=function(){return f.getUserInfo().then(function(){return f.userHasFormsProLicense})},f.getUserType=function(){return f.getUserInfo().then(function(){var a=b.Models.UserType.Unknown;return f.userHasEduLicense&&(a=b.Models.UserType.Edu),f.userHasBusinessLicense&&(a|=b.Models.UserType.Biz),f.isMsftUser()&&(a|=b.Models.UserType.MSIT),f.isMsaUser()&&(a|=f.userHasMsaPaidLicense?b.Models.UserType.MsaPaid:b.Models.UserType.MsaFree),a},function(){return b.Models.UserType.Unknown})},f.setUserEduLicenseState=function(a){for(var b in c)if(a.hasOwnProperty(c[b])){var d=a[c[b]];if(d&&d.length>0)return void(f.userHasEduLicense=!0)}f.userHasEduLicense=!1},f.setUserBusinessLicenseState=function(a){for(var b in d)if(a.hasOwnProperty(d[b])){var c=a[d[b]];if(c&&c.length>0)return void(f.userHasBusinessLicense=!0)}f.userHasBusinessLicense=!1},f.setUserMsaLicenseState=function(a){return f.isMsaUser()&&a?void(f.userHasMsaPaidLicense=!0):void(f.userHasMsaPaidLicense=!1)},f.setUserFormsProLicenseState=function(a){for(var b in e)if(a.hasOwnProperty(e[b])){var c=a[e[b]];if(c&&c.length>0)return void(f.userHasFormsProLicense=!0)}f.userHasFormsProLicense=!1},f.getUserInfo=function(){return f.licenseReady||(f.licenseReady=$.Deferred(),$(document).ready(function(){if(OfficeFormServerInfo.userInfo.UserId){var b=a.DataProvider.ProviderManager.getInstance().createDataProvider();try{b.getUserInfo().then(function(a){var b=_.object(a.licenses.map(function(a){var b=a.licenseName,c=a.skus;return[b,JSON.parse(c)]}));f.setUserEduLicenseState(b),f.setUserBusinessLicenseState(b),f.setUserMsaLicenseState(a.isPaidUser),f.setUserFormsProLicenseState(b),f.licenseReady.resolve(b)},function(a){return f.licenseReady.reject(a)})}catch(c){f.licenseReady.reject(c)}}else f.licenseReady.resolve({});f.licenseReady.fail(function(b){a.Event.ErrorEventDeprecated.logData({errorName:"UserInfoGetFailure",errorInfo:b})})})),f.licenseReady.promise()},f.checkFastFoodUser=function(b){if(!f.checkFastFoodPromises[b]){var c=a.DataProvider.ProviderManager.getInstance().createDataProvider();f.checkFastFoodPromises[b]=c.isMemberOf(b)}return f.checkFastFoodPromises[b]},f.checkFastFoodPromises={},f}();b.FeaturePlanProvider=f}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c,d=b.ErrorCode.InnerCode;!function(c){function e(){return m||(m="USGovGccProd"===a.EnvironmentConfig.getEnvironmentType()?$.Deferred().resolve("gcc").promise():b.FeaturePlanProvider.isMsaUser()||Forms.Common.isOwnerMsaUser()?$.Deferred().resolve("msa").promise():b.FeaturePlanProvider.isMsftUser()?a.Flighting.Flight.isEnabled(a.Flighting.Flights.EnableFFUserGating)?b.FeaturePlanProvider.isFastFoodUser().then(function(a){return a?"fastfood":"msft"}):$.Deferred().resolve("msft").promise():Forms.Common.isOwnerMsftUser()?$.Deferred().resolve("msft").promise():b.FeaturePlanProvider.isFastFoodTenant()||Forms.Common.isOwnerOnFastFoodTenant()?$.Deferred().resolve("fastfood").promise():$.Deferred().resolve("business").promise()),m}function f(){var b="ms-formweb";if(a.EnvironmentSettings.IsIntegration){var c=a.EnvironmentSettings.GetHostString();c&&a.HostApps[c]&&(b="ms-"+c.toLowerCase()),OfficeFormServerInfo.isOembedSPO&&(b="forms-webpart")}return b}function g(b,c){c=c||{};var d,g=$.Deferred();c.disableLog||(d=new a.Event.QosEventDeprecated(b.qosEventName),_.extend(d.Data,{extraData:_.clone(b.qosExtraData)}),d.start(),b.headers["X-CorrelationId"]=d.CorrelationId),c.disableXMsHeader||(b.headers["x-ms-form-request-source"]=f(),e().done(function(a){b.headers["x-ms-form-request-ring"]=a}));var j=-1,k=function(){j++,i(b,function(a){g.resolve(a)},function(a){if(j>=5)return void g.reject(a);var c,e=h(b,a),f=parseInt(e.statusCode),i=e.innerCode;if(0===f||502===f||503===f)c="Forms_Http_"+f.toString();else if(500===f&&6503===i)c="CDB_Http_"+i.toString();else{if(624!==i)return void g.reject(a);c="CDB_Http_"+i.toString()}d&&d.log({resultCode:c,extraData:{RetryCount:j,ServiceError:a}}),k()},c.skipExpiredTokenCheck)};return k(),d?g.promise().done(function(c){var e={};if(e.resultCode=c&&c.response?c.response.statusCode:"",e.resultType="Success",b.qosEventName===a.Event.QosEventNames.ServiceEndpoints.Form.CreateForm){var f=l.parseResponseDataValue(c);e.extraData={FormId:f.id,XLWorkbookId:f.xlWorkbookId||void 0,Origin:a.Telemetry.getOrigin()||void 0,RetryCount:j||void 0}}d.end(e)}).fail(function(a){var c=h(b,a),e=parseInt(c.statusCode);d.end({resultCode:a&&a.response?a.response.statusCode:"",resultType:""===c.statusCode||e>=500?"Failure":"ExpectedFailure",extraData:{ServiceError:c,RetryCount:j||void 0}})}):g.promise()}function h(a,b){var c=l.convertToResponseError(b);return{statusCode:b&&b.response?b.response.statusCode:"",sourceUrl:a.requestUri.toString(),correlationId:b&&b.response?b.response.headers["X-CorrelationId"]:"",statusText:b&&b.response?b.response.statusText:"",innerCode:c?c.innerCode:-1,innerMessage:c?c.innerMessage:"",failureReason:b&&b.response?b.response.headers["X-FailureReason"]:""}}function i(c,d,e,f){function g(f){b.AuthTokenHelper.getInstance().isAuthTokenExpiredFailure(f)?b.AuthTokenHelper.getInstance().refreshAuthToken(function(){a.Flighting.Flight.isEnabled(a.Flighting.Flights.RefreshServerInfoInFrame)?c.blobResponseType?j(c,d,e):odatajs.oData.request(c,d,e):a.PageMethods.refreshAntiForgeryToken(function(){c.headers.__RequestVerificationToken=OfficeFormServerInfo.antiForgeryToken,h().always(function(){return odatajs.oData.request(c,d,e)})},function(){return Forms.Common.reloadPage()})},function(){a.Authenticator.signInThenRefresh()}):e(f)}function h(){var b=$.Deferred();return OfficeFormServerInfo.userInfo.UserId?b.resolve().promise():(a.PageMethods.refreshUserInfo(function(){return b.resolve()},function(){return b.resolve()}),b.promise())}void 0===f&&(f=!1),c.blobResponseType?j(c,d,f?e:g):odatajs.oData.request(c,d,f?e:g)}function j(a,b,c){var d=new XMLHttpRequest,e=a.requestUri;if(d.onreadystatechange=function(){if(null!=d&&4===d.readyState){var f=d.status,g=d.statusText;1223===f&&(f=204,g="No Content");var h=d.response;if(f>=200&&299>=f)d=null,b(h);else{var i=k(d);d=null,c({message:"HTTP request failed",request:a,response:{requestUri:e,statusCode:f,statusText:g,headers:i,body:h}})}}},d.open(a.method||"GET",e,!0),d.responseType="blob",a.headers)for(var f in a.headers)d.setRequestHeader(f,a.headers[f]);d.send(a.body)}function k(a){for(var b={},c=0,d=a.getAllResponseHeaders().split(/\r?\n/);c<d.length;c++){var e=d[c];if(e){var f=e.split(": ");b[f[0]]=f[1]}}return b}var l=function(){function c(){}return c.parseAndTryHandleError=function(e){var f=c.convertToResponseError(e);if(f.statusCode!==b.ErrorCode.HttpStatusCode.Unauthorized||a.EnvironmentSettings.Host===a.HostApps.PowerPoint)return f;if(c.logNonRecoverableError(f),a.Utilities.Html.getQueries().embed)return f.innerCode=d.EmbedFormNeedAuth,f;if(f.innerCode!==d.NoPermission&&f.innerCode!==d.RequireLogin)return f;var g=!(a.Utilities.isTbsBrowser()&&a.Utilities.isMicroMessenger()&&a.Utilities.isAndroid());return g?(a.Authenticator.signInThenRefresh(),$.Deferred().promise()):(f.innerCode=d.LoginNotSupportInCurrentBrowser,f)},c.logNonRecoverableError=function(b){if(b){var c=void 0;switch(b.innerCode){case d.UserNotAllowed:c=a.Event.EngagementEventNames.Auth.Auth.NotOnboardedTenant;break;case d.DisabledByTenantAdmin:c=a.Event.EngagementEventNames.Auth.Auth.DisabledByTenantAdmin;break;case d.UserNeedMultiFactorAuth:c=a.Event.EngagementEventNames.Auth.Auth.UserNeedMultiFactorAuth;break;default:c="Undefined auth error in ResponseHandler"}a.Event.EngagementEventDeprecated.logData({name:c,extraData:{tenantId:OfficeFormServerInfo.userInfo.TenantId}})}},c.parseResponseDataValue=function(a){return c.convertToAsyncResult(a).value},c.convertToAsyncResult=function(c){var d={status:b.AsyncResultStatus.Succeeded};if(null==c)d.value=c;else{var e=c["@odata.count"]&&parseInt(c["@odata.count"]);isNaN(e)||(d.count=e),d.value=a.Utilities.tryParseJson(void 0===c.value?c:c.value)}return d},c.convertToResponseError=function(b){var c={statusCode:b&&b.response&&b.response.statusCode,statusText:b&&b.response&&b.response.statusText,headers:b&&b.response&&b.response.headers,correlationId:b&&b.response&&b.response.headers["X-CorrelationId"]},e=b&&b.response&&a.Utilities.tryParseJson(b.response.body),f=e.error&&parseInt(e.error.code);return isNaN(f)?c.innerCode=0===c.statusCode?d.NetworkIssue:void 0:c.innerCode=f,c.innerMessage=e.error&&e.error.message,c},c}();c.ResponseHandler=l;var m;c.getRequestTargetRing=e,c.getExtendedSource=f,c.send=g}(c=b.OData||(b.OData={})),a.Exports.DataProvider.OData=c}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){a[a.Taskpane=1]="Taskpane",a[a.Content=2]="Content"}(b=a.AddinType||(a.AddinType={}));var c=function(){function a(){}return Object.defineProperty(a,"AddinType",{get:function(){return a._addinType},set:function(b){a._addinType=b},enumerable:!0,configurable:!0}),Object.defineProperty(a,"IsTaskpane",{get:function(){return a.AddinType===b.Taskpane},enumerable:!0,configurable:!0}),Object.defineProperty(a,"IsContentAgave",{get:function(){return a.AddinType===b.Content},enumerable:!0,configurable:!0}),Object.defineProperty(a,"HostPlatform",{get:function(){return Office.context.platform},enumerable:!0,configurable:!0}),a}();a.AddinSettings=c}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(){a._instance=this}return a.getInstance=function(){return a._instance?a._instance:new a},Object.defineProperty(a.prototype,"HostEnvironment",{get:function(){return this.hostEnvironment},set:function(a){this.hostEnvironment=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"HostPlatform",{get:function(){return this.hostPlatform},set:function(a){this.hostPlatform=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"HostLocale",{get:function(){return this.hostLocale},set:function(a){this.hostLocale=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"AccessToken",{get:function(){return this.accessToken},set:function(a){this.accessToken=a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"IsSSOAllowed",{get:function(){return this.isSSOAllowed},set:function(a){this.isSSOAllowed=a},enumerable:!0,configurable:!0}),a}();a.PowerPointContentAddinContext=b}(b=a.PowerPointContentAddin||(a.PowerPointContentAddin={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function b(){}return Object.defineProperty(b,"DeferredHandler",{get:function(){return b.deferredHandler||(b.deferredHandler=$.Deferred())},enumerable:!0,configurable:!0}),b.getPopupUrl=function(b,c,d){void 0===c&&(c=a.AuthProvider.Default),void 0===d&&(d=null);var e=a.Utilities.Html.getAbsoluteUrl("/Pages/PopupLoginPage.aspx?"+a.EnvironmentSettings.PopupNotifyTypeParam+"="+a.PopupNotifyType[b]);return null!=c&&c!==a.AuthProvider.Default&&(e+="&"+a.EnvironmentSettings.AuthProviderParam+"="+a.AuthProvider[c]),d&&(e+="&"+a.EnvironmentSettings.AuthUpnParam+"="+encodeURIComponent(d)),e},b.setDialogSignInSize=function(a,c){b.popupLoginPageWidth=a,b.popupLoginPageHeight=c},b.officeDialogSignIn=function(c){return Office.context.ui.displayDialogAsync(b.getPopupUrl(a.PopupNotifyType.OfficeAPI,a.AuthProvider.OrgId,c),{width:b.popupLoginPageWidth,height:b.popupLoginPageHeight,hideTitle:!0,promptBeforeOpen:!1},function(c){var d=c.value;null!=d&&d.addEventHandler(Office.EventType.DialogMessageReceived,function(c){if(d.close(),c&&c.message){var e=JSON.parse(c.message);OfficeFormServerInfo=e||OfficeFormServerInfo,a.Flighting.Flight.refreshFlights()}b.DeferredHandler.resolve()})}),b.DeferredHandler.promise()},b.getAddinAccessToken=function(){if(a.Utilities.applyAssignmentsSSO())return this.assignmentsSsoHandler();if(a.Utilities.applyTeamSSO())return this.teamSsoHandler();if(a.EnvironmentSettings.IsPPTIntegration){if(a.AddinSettings.IsTaskpane&&a.Flighting.Flight.isEnabled(a.Flighting.Flights.PPTTaskpaneAddinSSO))return this.pptFirstPartySsoHandler();if(a.AddinSettings.IsContentAgave){if(a.AddinSettings.HostPlatform===Office.PlatformType.PC&&a.Flighting.Flight.isEnabled(a.Flighting.Flights.PPTWin32ContentAddinSSO))return this.pptFirstPartySsoHandler();if(a.AddinSettings.HostPlatform===Office.PlatformType.OfficeOnline&&a.Flighting.Flight.isEnabled(a.Flighting.Flights.PPTContentAddinSSO))return this.pptThirdPartySsoHandler()}}else if(a.EnvironmentSettings.Host===a.HostApps.OneNoteUwp)return this.oneNoteUWPSsoHandler();return $.Deferred().reject("GetAddinAccessTokenFailed").promise()},b.teamSsoHandler=function(){var b=this,c=$.Deferred(),d={successCallback:function(d){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.TeamsTab.Auth.SsoSuccess}),b.refreshInfo(d).always(function(){return c.resolve(d)})},failureCallback:function(b){a.Event.ErrorEventDeprecated.logData({errorName:"TeamsTabSsoLoginFailure",errorInfo:b}),c.reject(b)},resources:["https://forms.office.com"]};return microsoftTeams.authentication.getAuthToken(d),c.promise()},b.assignmentsSsoHandler=function(){var a=this,b=$.Deferred(),c=function(d){if(d.data&&d.data.startsWith("GetAccessTokenFromAssignments:"))try{var e="GetAccessTokenFromAssignments:Bearer ",f=d.data.indexOf(e);if(-1!==f){var g=d.data.substring(f+e.length);a.refreshInfo(g).always(function(){return b.resolve(g)})}}finally{window.removeEventListener("message",c,!1)}};return window.addEventListener("message",c,!1),window.parent.postMessage("GetAccessTokenFromAssignments","*"),b.promise()},b.oneNoteUWPSsoHandler=function(){var b=this,c=$.Deferred();return OneNote.run(function(d){var e=d.application,f=e._GetServiceTokens("Form");return d.sync().then(function(){if(null!=f&&f.value.length>0){var d=f.value[0].headerValue;b.refreshInfo(d).always(function(){return c.resolve(d)})}else a.Event.ErrorEventDeprecated.logData({errorName:"OneNoteAddinGetTokenFromUWPHostFailure",errorInfo:"Fail to Get Access Token from UWP OneNote host"}),c.reject()})})["catch"](function(b){a.Event.ErrorEventDeprecated.logData({errorName:"OneNoteAddinGetTokenFromUWPHostFailure",errorInfo:b}),c.reject()}),c.promise()},b.pptFirstPartySsoHandler=function(){var b=this,c=$.Deferred();a.Event.EngagementEventDeprecated.logData({name:a.AddinSettings.IsTaskpane?a.Event.EngagementEventNames.PowerPointTaskpaneAddinPage.Initialize.GetToken:a.Event.EngagementEventNames.PowerPointContentAddinPage.Initialize.GetToken,extraData:{hostPlatform:a.AddinSettings.HostPlatform,isFirstParty:!0}});var d=function(d){a.Event.EngagementEventDeprecated.logData({name:a.AddinSettings.IsTaskpane?a.Event.EngagementEventNames.PowerPointTaskpaneAddinPage.Initialize.GetTokenCompleted:a.Event.EngagementEventNames.PowerPointContentAddinPage.Initialize.GetTokenCompleted,extraData:{hostPlatform:a.AddinSettings.HostPlatform,isFirstParty:!0,isGetAccessTokenSucceeded:!0}}),b.refreshInfo(d).always(function(){return c.resolve(d)})},e=function(b){a.Event.ErrorEventDeprecated.logData({errorName:a.AddinSettings.IsTaskpane?"PowerPointTaskpaneAddinGetTokenFailure":"PowerPointContentAddinGetTokenFailure",errorInfo:b}),c.reject(b)};if(a.Flighting.Flight.isEnabled(a.Flighting.Flights.PPTWin32FirstPartySSOLegacyAPI)){var f=new OfficeCore.RequestContext,g=f.firstParty.authentication.getAccessToken({resource:"https://forms.office.com"});f.sync().then(function(){var a=g.value.accessToken;d(a)})["catch"](function(a){e(a)})}else{var h=OfficeFirstPartyAuth.getAccessToken({resource:"https://forms.office.com"});h.then(function(a){var b=a.accessToken;d(b)})["catch"](function(a){e(a)})}return c.promise()},b.pptThirdPartySsoHandler=function(){var b=this,c=$.Deferred();if(a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PowerPointContentAddinPage.Initialize.GetToken,extraData:{isFirstParty:!1}}),Office.context.auth.getAccessTokenAsync)Office.context.auth.getAccessTokenAsync({forceConsent:!1,forceAddAccount:!1},function(d){if(d.status===Office.AsyncResultStatus.Succeeded){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PowerPointContentAddinPage.Initialize.GetTokenCompleted,extraData:{isFirstParty:!1}});var e=d.value;b.refreshInfo(e).always(function(){return c.resolve(e)})}else a.Event.ErrorEventDeprecated.logData({errorName:"PowerPointContentAddinGetTokenFailure",errorInfo:d.error}),c.reject(d.error)});else{var d=a.Form.PowerPointContentAddin.PowerPointContentAddinContext.getInstance();a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PowerPointContentAddinPage.Initialize.GetTokenThirdPartySSONotSupported,extraData:{hostEnvironment:d.HostEnvironment,hostPlatform:d.HostPlatform}}),c.reject("Third party SSO API is not supported.")}return c.promise()},b.teamsPopupSignIn=function(){return a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.TeamsTab.Auth.Navigate}),microsoftTeams.authentication.authenticate({url:b.getPopupUrl(a.PopupNotifyType.TeamsAPI,a.AuthProvider.OrgId),width:b.popupLoginPageWidth,height:b.popupLoginPageHeight,successCallback:function(c){if(c){var d=JSON.parse(c);OfficeFormServerInfo=d||OfficeFormServerInfo,a.Flighting.Flight.refreshFlights()}a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.TeamsTab.Auth.Success}),b.DeferredHandler.resolve()},failureCallback:function(c){a.Event.ErrorEventDeprecated.logData({errorName:"TeamsTabLoginFailure",errorInfo:c}),b.DeferredHandler.reject(c)}}),b.DeferredHandler.promise()},b.refreshInfo=function(b){try{return $.when(this.refreshUserInfo(b),this.refreshFlights(b))}catch(c){return a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.TeamsTab.Auth.RefreshInfoFailed}),$.Deferred().resolve().promise()}},b.refreshUserInfo=function(c){return b.userInfoPromise&&b.userInfoPromise.state()!==a.Utilities.Promise.State.Rejected||(b.userInfoPromise=a.PageMethods.refreshUserInfoWithToken(c).then(function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.AddinPage.PageMethod.GetAddinUserInfoSuccess})},function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.AddinPage.PageMethod.GetAddinUserInfoFailed,extraData:{error:b}})})),b.userInfoPromise},b.refreshFlights=function(c){return b.flightPromise&&b.flightPromise.state()!==a.Utilities.Promise.State.Rejected||(b.flightPromise=a.PageMethods.refreshFlightsWithToken(c).then(function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.AddinPage.PageMethod.GetFlightsSuccess}),a.Flighting.Flight.refreshFlights()},function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.AddinPage.PageMethod.GetFlightsFailed,extraData:{error:b}})})),b.flightPromise},b.popupLoginPageHeight=485,b.popupLoginPageWidth=770,b}();b.AddinAuth=c,a.Exports.AddinAuth=c}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function c(b,c){this.aadLauncherSesstionStorageKey="aadFormLauncher",this.msaLauncherSesstionStorageKey="msaFormLauncher",
this.isAccessTokenFromHostReceived=!1,this.authContext=Forms.getPageContext().AuthContext,this.serviceUrl=b,this.ownerServiceUrl=c,this.partialUpdateHttpMethod=a.Flighting.Flight.isEnabled(a.Flighting.Flights.PartialPut)?"PUT":"PATCH"}return Object.defineProperty(c,"AnalysisFormEntityCollectionName",{get:function(){return"analysisForms"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"FormEntityCollectionName",{get:function(){return"forms"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"RuntimeFormEntityCollectionName",{get:function(){return"runtimeForms"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"RuntimeFormEntityCollectionName2",{get:function(){return"runtimeForms2"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"QuestionEntityCollectionName",{get:function(){return"questions"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"DescriptiveElementEntityCollectionName",{get:function(){return"descriptiveQuestions"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"ChoiceEntityCollectionName",{get:function(){return"choices"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"ResponseEntityCollectionName",{get:function(){return"responses"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"RuntimeResponseEntityCollectionName",{get:function(){return"runtimeresponses"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"CommentEntityCollectionName",{get:function(){return"comments"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"GetSharedForm",{get:function(){return"GetSharedForm"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"PermissionEntityCollectionName",{get:function(){return"permissions"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"PermissionTokenEntityCollectionName",{get:function(){return"permissionTokens"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"SharedWithMeFormEntityCollectionName",{get:function(){return"sharedWithMeForms"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"GetAggregateQuizDataFunctionName",{get:function(){return"GetAggregateQuizData"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"GetAggregateSurveyDataFunctionName",{get:function(){return"GetAggregateSurveyData"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"GetOrCreatePermissionTokenFunctionName",{get:function(){return"Microsoft.FormServices.GetOrCreatePermissionToken"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"RemoveRecentFormFunctionName",{get:function(){return"RemoveFromRecent"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"CreateOneDriveSessionTempFolderFunctionName",{get:function(){return"Microsoft.FormServices.CreateOneDriveSessionTempFolder"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"MoveFormFunctionName",{get:function(){return"MoveForm"},enumerable:!0,configurable:!0}),Object.defineProperty(c,"LocaleResourceEntityCollectionName",{get:function(){return"localeResource"},enumerable:!0,configurable:!0}),c.addDefaultHeader=function(a,b){null===c.customizedHeaders&&(c.customizedHeaders={}),c.customizedHeaders[a]=b},c.prototype.getForms=function(b){var d=this.getSurveyWebOwnerServiceUrl()+"light/";return d+=c.FormEntityCollectionName+c.getQueryParameters("?",b),Forms.Common.logFlightStatus(a.Flighting.Flights.SocialSharing),this.sendRequest({requestUri:d,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetForms})},c.prototype.getFormsSharedWithCurrentUser=function(){var b=this.getSurveyWebOwnerServiceUrl()+c.SharedWithMeFormEntityCollectionName;return this.sendRequest({requestUri:b,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetSharedWithMeForms})},c.prototype.getFormId=function(b,c,d){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+"GetFormId(tenantid='{0}',userid='{1}',tableid='{2}')".format(b,c,d),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.GetFormId})},c.prototype.getDesignForm=function(b,d){var e=this.getSurveyWebOwnerServiceUrl()+"light/";return e+=c.FormEntityCollectionName+"('"+b+"')",e+=c.getQueryParameters("?",d),Forms.Common.logFlightStatus(a.Flighting.Flights.SocialSharing),this.sendRequest({requestUri:e,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetDesignForm})},c.prototype.getRuntimeForm=function(b,d){var e=this.getSurveyWebOwnerServiceUrl()+"light/"+c.RuntimeFormEntityCollectionName+"('"+b+"')";return e+=c.getQueryParameters("?",d),Forms.Common.logFlightStatus(a.Flighting.Flights.SocialSharing),this.sendRequest({requestUri:e,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetRuntimeForm})},c.prototype.getRuntimeFormV2=function(b,d){var e=this.getSurveyWebOwnerServiceUrl()+"light/"+c.RuntimeFormEntityCollectionName2+"('"+b+"')";return e+=c.getQueryParameters("?",d),Forms.Common.logFlightStatus(a.Flighting.Flights.SocialSharing),this.sendRequest({requestUri:e,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetRuntimeForm2})},c.prototype.getAnalysisTimeForm=function(b){var d="$expand="+c.QuestionEntityCollectionName+"($expand="+c.ChoiceEntityCollectionName+")",e=this.getSurveyWebOwnerServiceUrl()+"light/"+c.AnalysisFormEntityCollectionName+"('"+b+"')?"+d;return Forms.Common.logFlightStatus(a.Flighting.Flights.SocialSharing),this.sendRequest({requestUri:e,method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetAnalysisForm})},c.prototype.getSharedForm=function(b){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.GetSharedForm+"(formid='"+b+"',token='"+a.Utilities.Html.getQueries().sharetoken+"')",method:"GET",headers:{"Content-Type":"application/json;odata.metadata=minimal"},body:'{"value" : "'+a.Utilities.Html.getQueries().sharetoken+'"}',qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetSharedForm})},c.prototype.createOD4BSessionTempFolder=function(b){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.RuntimeFormEntityCollectionName+"('"+b+"')/"+c.CreateOneDriveSessionTempFolderFunctionName,method:"POST",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.CreateOD4BSessionTempFolder}).then(function(a){return a?a.itemId:$.Deferred().reject(new Error("Failed to create OneDriveForBusiness session temp folder.")).promise()})},c.prototype.changeSharingStatus=function(b,c){var d=c?"On":"Off";return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+"/forms('"+b+"')/Microsoft.FormServices.Turn"+d+"AllowCopySetting",method:"POST",qosEventName:c?a.Event.QosEventNames.ServiceEndpoints.Form.TurnOnFormSharing:a.Event.QosEventNames.ServiceEndpoints.Form.TurnOffFormSharing})},c.prototype.createPermissionLink=function(b,d){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.PermissionEntityCollectionName,method:"POST",data:d,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.CreateFormPermissionLink})},c.prototype.deletePermissionLink=function(b,d){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.PermissionEntityCollectionName+"('"+d+"')",method:"DELETE",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.DeleteFormPermissionLink})},c.prototype.getFormPermissions=function(b){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.PermissionEntityCollectionName,method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetFormPermissions})},c.prototype.createPermissionToken=function(b,d){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.PermissionTokenEntityCollectionName,method:"POST",data:d,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.CreateFormPermissionToken})},c.prototype.getOrCreateFormPermissionToken=function(b,d,e){var f={};return a.EnvironmentSettings.IsTeamsIntegration&&(f["x-ms-form-request-source"]="ms-teams"),this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.GetOrCreatePermissionTokenFunctionName,method:"POST",headers:f,data:{type:d,name:e},qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetOrCreatePermissionToken})},c.prototype.deletePermissionToken=function(b,d){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.PermissionTokenEntityCollectionName+"('"+d+"')",method:"DELETE",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.DeleteFormPermissionToken})},c.prototype.getFormPermissionsTokens=function(b){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.PermissionTokenEntityCollectionName,method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetFormPermissionsToken})},c.prototype.getIdentityProviderType=function(b){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"authinfo/idptype?username="+encodeURIComponent(b),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetIdentityProviderType}).then(function(a){return a.ProviderType})},c.prototype.createForm=function(b){var d={__TimezoneOffset:(new Date).getTimezoneOffset().toString()};return Forms.Common.logFlightStatus(a.Flighting.Flights.SocialSharing),this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName,method:"POST",data:b,headers:d,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.CreateForm,qosExtraData:{FormType:this.getFormType(b)}})},c.prototype.updateForm=function(b,d){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')",method:this.partialUpdateHttpMethod,data:d,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.UpdateForm,qosExtraData:{SoftDeleted:d.softDeleted}})},c.prototype.postFormShareAction=function(b){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+"light/"+c.FormEntityCollectionName+"('"+b+"')/shareaction",method:"POST",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.PostShareAction})},c.prototype.createFormImageFromUrl=function(b,d,e){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+d,method:"POST",data:e,qosEventName:"logo"===d?a.Event.QosEventNames.ServiceEndpoints.Form.CreateImageFromUrl:a.Event.QosEventNames.ServiceEndpoints.Form.CreateThemeImageFromUrl,qosExtraData:{FormProperty:d}})},c.prototype.deleteForm=function(b){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')",method:"DELETE",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.DeleteForm})},c.prototype.dupFormForExcel=function(b,d){var e={id:b,xlWorkbookId:d};return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName,method:"POST",data:e,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Excel.DuplicateFormForExcel})},c.prototype.moveForm=function(b,d,e){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+"light/"+c.FormEntityCollectionName+"('"+b+"')/"+c.MoveFormFunctionName,method:"POST",data:{newOwnerId:d,isNewOwnerGroup:e},qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.MoveForm})},c.prototype.getRecentForms=function(b,c,d){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"GetRecentForms(pinnedState='{0}',extension='{1}',knowledge='{2}',count=250)".format(b,c,d),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.GetRecentForms})},c.prototype.removeRecentForm=function(b){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.RemoveRecentFormFunctionName,method:"POST",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.RemoveRecentForm})},c.prototype.getFormsTenantSettings=function(){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"GetFormsTenantSettings",method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.GetFormsTenantSettings})},c.prototype.getFormCreatorPhotoDefinition=function(b){return this.sendRequestWithToken({requestUri:this.getSurveyWebServiceUrl()+("light/GetFormCreatorDefinition('"+b+"','')"),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.GetFormCreatorPhotoDefinition})},c.prototype.getFormCreatorPhotoValue=function(b){return this.sendRequestWithToken({blobResponseType:!0,requestUri:this.getSurveyWebServiceUrl()+("light/GetFormCreatorPhotoValue('"+b+"','')/$value"),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.GetFormCreatorPhotoValue})},c.prototype.getCurrentUserPhotoValue=function(){return this.sendRequestWithToken({blobResponseType:!0,requestUri:this.getSurveyWebServiceUrl()+"GetCurrentUserPhotoValue",method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.GetCurrentUserPhotoValue})},c.prototype.getPrivacySettings=function(b,c){var d={};return b&&(d.ownerTenantId=b),c&&(d.currentUserTenantId=c),this.sendRequest({method:"GET",requestUri:this.getSurveyWebServiceUrl()+"privacy?"+$.param(d),qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.GetPrivacySettings})},c.prototype.getFormQuestion=function(b,d,e){var f=this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.QuestionEntityCollectionName+"('"+d+"')";return e&&(f=f+"?$select="+e.toString()),this.sendRequest({requestUri:f,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Question.GetQuestion})},c.prototype.getFormQuestionCount=function(b){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.QuestionEntityCollectionName+"/$count",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Question.GetQuestionCount})},c.prototype.createFormQuestion=function(b,d){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.QuestionEntityCollectionName,method:"POST",data:d,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Question.CreateQuestion,qosExtraData:{IsQuiz:d.isQuiz,QuestionId:d.id,QuestionType:d.type}})},c.prototype.createQuestionImageFromUrl=function(b,d,e){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.QuestionEntityCollectionName+"('"+d+"')/image",method:"POST",data:e,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Question.CreateImageFromUrl,qosExtraData:{QuestionId:d}})},c.prototype.updateFormQuestion=function(b,d,e,f){var g=this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.QuestionEntityCollectionName+"('"+d+"')";return this.sendRequest({requestUri:g,method:this.partialUpdateHttpMethod,data:f,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Question.UpdateQuestion,qosExtraData:{QuestionType:e}},{disableLog:!0})},c.prototype.deleteFormQuestion=function(b,d,e){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.QuestionEntityCollectionName+"('"+d+"')",method:"DELETE",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Question.DeleteQuestion,qosExtraData:{QuestionType:e}})},c.prototype.getFormDescriptiveElement=function(b,d,e){var f=this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.DescriptiveElementEntityCollectionName+"('"+d+"')";return e&&(f=f+"?$select="+e.toString()),this.sendRequest({requestUri:f,qosEventName:a.Event.QosEventNames.ServiceEndpoints.DescriptiveElement.Get})},c.prototype.createFormDescriptiveElement=function(b,d){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.DescriptiveElementEntityCollectionName,method:"POST",data:d,qosEventName:a.Event.QosEventNames.ServiceEndpoints.DescriptiveElement.Create,qosExtraData:{QuestionId:d.id,QuestionType:d.type}})},c.prototype.updateFormDescriptiveElement=function(b,d,e,f){var g=this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.DescriptiveElementEntityCollectionName+"('"+d+"')";return this.sendRequest({requestUri:g,method:this.partialUpdateHttpMethod,data:f,qosEventName:a.Event.QosEventNames.ServiceEndpoints.DescriptiveElement.Update,qosExtraData:{QuestionType:e}},{disableLog:!0})},c.prototype.deleteFormDescriptiveElement=function(b,d,e){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.DescriptiveElementEntityCollectionName+"('"+d+"')",method:"DELETE",qosEventName:a.Event.QosEventNames.ServiceEndpoints.DescriptiveElement.Delete,qosExtraData:{QuestionType:e}})},c.prototype.createQuestionChoice=function(b,d,e){var f=this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.QuestionEntityCollectionName+"('"+d+"')/"+c.ChoiceEntityCollectionName;return this.sendRequest({requestUri:f,method:"POST",data:e,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Choice.CreateChoice})},c.prototype.getQuestionChoice=function(b,d,e){var f=this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.QuestionEntityCollectionName+"('"+d+"')/"+c.ChoiceEntityCollectionName+"("+e+")";return this.sendRequest({requestUri:f,method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Choice.GetChoice})},c.prototype.updateQuestionChoice=function(b,d,e,f){var g=this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.QuestionEntityCollectionName+"('"+d+"')/"+c.ChoiceEntityCollectionName+"("+e+")";return this.sendRequest({requestUri:g,method:this.partialUpdateHttpMethod,data:f,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Choice.UpdateChoice})},c.prototype.deleteQuestionChoice=function(b,d,e){var f=this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.QuestionEntityCollectionName+"('"+d+"')/"+c.ChoiceEntityCollectionName+"("+e+")";return this.sendRequest({requestUri:f,method:"DELETE",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Choice.DeleteChoice})},c.prototype.getFormResponses=function(b,d,e,f){var g=["$expand="+c.CommentEntityCollectionName];d&&g.push("$filter={0}+{1}+{2}".format(d.name,d.operator,d.value)),e>=0&&f>=0&&g.push("$top={0}&$skip={1}".format(e,f));var h=g.filter(function(a){return!!a}).join("&");h=h&&"?"+h;var i=this.getSurveyWebOwnerServiceUrl()+"light/";return this.sendRequest({requestUri:i+c.FormEntityCollectionName+"('"+b+"')/"+c.ResponseEntityCollectionName+h,qosEventName:_.any(g,function(a){return-1===a.indexOf("$filter")})?a.Event.QosEventNames.ServiceEndpoints.Response.GetResps:a.Event.QosEventNames.ServiceEndpoints.Response.GetRespFilter})},c.prototype.getRuntimeResponses=function(b,d){var e="?$expand="+c.CommentEntityCollectionName,f=d?"&$filter=responder+eq+'"+encodeURIComponent(d.replace(/\'/g,"''"))+"'":"",g=this.getSurveyWebOwnerServiceUrl();return this.sendRequest({requestUri:g+c.FormEntityCollectionName+"('"+b+"')/"+c.RuntimeResponseEntityCollectionName+e+f,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Response.GetRuntimeResps})},c.prototype.getRuntimeResponse=function(b,d){var e="?$expand="+c.CommentEntityCollectionName,f=a.Utilities.Html.getQueries(),g={};return f.GetResponseToken&&(g={GetResponseToken:f.GetResponseToken}),this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+"light/"+c.FormEntityCollectionName+"('"+b+"')/"+c.RuntimeResponseEntityCollectionName+"("+d+")"+e,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Response.GetRuntimeResponse,headers:g})},c.prototype.getAnalysisTimeResponses=function(b,d,e){var f="?$expand="+c.CommentEntityCollectionName,g=this.getSurveyWebOwnerServiceUrl()+c.AnalysisFormEntityCollectionName+"('"+b+"')/"+c.ResponseEntityCollectionName+f;return d>=0&&e>=0&&(g+="&$top={0}&$skip={1}".format(d,e)),this.sendRequest({requestUri:g,method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Response.GetAnalysisTimeResponses})},c.prototype.getFormsResponseCount=function(){return this.sendRequestWithToken({requestUri:this.getSurveyWebServiceUrl()+"light/GetRespCounts()",method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.GetFormCreatorPhotoDefinition})},c.prototype.getFormResponseCount=function(b){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.ResponseEntityCollectionName+"/$count",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Response.GetRespCount},{disableLog:!0})},c.prototype.submitFormResponse=function(b,d){var e=a.Utilities.FormId.decodeFormId(b),f="AAD";return null==e.OrgId?f="Unknown":e.OrgId.toLowerCase()===a.EnvironmentConfig.getMsaTenantId()&&(f="MSA"),Forms.Common.logFlightStatus(a.Flighting.Flights.SocialSharing),this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.ResponseEntityCollectionName,method:"POST",data:d,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Response.SubmitResp,qosExtraData:{OwnerSource:f}})},c.prototype.deleteFormResponses=function(b){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.ResponseEntityCollectionName,method:"DELETE",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Response.DeleteResps})},c.prototype.deleteFormResponse=function(b,d){return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.ResponseEntityCollectionName+"("+d+")/",method:"DELETE",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Response.DeleteResp})},c.prototype.addFormResponseComment=function(b,d,e){var f={feedback:e.feedback,score:e.score,questionId:e.questionId};return e.id&&(f.id=e.id),this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.ResponseEntityCollectionName+"("+d+")/"+c.CommentEntityCollectionName,method:"POST",data:f,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Response.AddComment})},c.prototype.setResponseReleaseDate=function(b,d,e){var f={releaseDate:e};return this.sendRequest({requestUri:this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.ResponseEntityCollectionName+"("+d+")",method:this.partialUpdateHttpMethod,data:f,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Response.SetReleaseDate})},c.prototype.createExportFile=function(a){var b=this;return this.getToken().then(function(d){var e,f="cdb-export-iframe",g=b.createHiddenIFrame(f);if(e=document.createElement("form"),e.style.display="none",e.method="POST",e.action=b.getSurveyWebServiceUrl()+c.FormEntityCollectionName+"('"+a+"')/Microsoft.FormServices.CreateExportFile",e.target=f,null!==d){var h=document.createElement("input");h.type="hidden",h.name="Authorization",h.value="Bearer "+d,e.appendChild(h)}if(null!==OfficeFormServerInfo.antiForgeryToken){var i=document.createElement("input");i.type="hidden",i.name="__RequestVerificationToken",i.value=OfficeFormServerInfo.antiForgeryToken,e.appendChild(i)}document.body.appendChild(g),$(g).ready(function(){g.contentDocument.body.appendChild(e)}),e.submit()})},c.prototype.downloadExcelFile=function(c,d,e){var f=this;return this.getToken().then(function(g){var h=new a.Event.QosEventDeprecated(a.Event.QosEventNames.ServiceEndpoints.Function.DownloadExcelFileApi);h.start();var i=$.Deferred(),j="download-excel-iframe",k=f.createHiddenIFrame(j);return document.body.appendChild(k),$(k).ready(function(){var j="downloadCookie"+(new Date).getTime(),l=f.getDownloadExcelRequestUrlParameters(c,d,e,j,h.CorrelationId,g),m=f.getDownloadExcelRequestUrl(l),n={sourceUrl:m,innerCode:b.ErrorCode.InnerCode.DownloadExcelFileFailed,innerMessage:void 0},o=24,p=o,q=5e3,r=function(){var c=a.Utilities.getCookie(j);if("success"===c)return h.end({resultType:"Success"}),window.clearInterval(s),a.Utilities.clearCookie(j),void i.resolve();if(p--<0){k.onload=null,window.clearInterval(s);var d=_.clone(n);if(!a.EnvironmentConfig.isOsi())return h.end({resultType:"Success"}),void i.resolve();d.innerMessage="TimeOut",d.innerCode=b.ErrorCode.InnerCode.DownloadExcelFileTimeout,h.end({resultType:"Failure",extraData:{ServiceError:d}}),i.reject({innerCode:b.ErrorCode.InnerCode.DownloadExcelFileTimeout,innerMessage:d.innerMessage})}},s=window.setInterval(r,q),t=3,u=function(){p=o,s=window.setInterval(r,q),k.contentWindow.location.href=m};$(k).on("load",function(){var c="";if(a.Flighting.Flight.isEnabled(a.Flighting.Flights.LogDownloadExcelErrorMessage))try{c=k.contentDocument.body.innerText}catch(d){c="Cross-origin so doesn't get the error message."}if(window.clearInterval(s),t>0)t--,f.downloadExcelCheckAndHandleAuthFailure(c,u);else{var e=_.clone(n);e.innerMessage="Error",h.end({resultType:"Failure",extraData:{ServiceError:e,errorMessage:c}}),i.reject({innerCode:b.ErrorCode.InnerCode.DownloadExcelFileFailed,innerMessage:e.innerMessage})}}),k.contentWindow.location.href=m}),i.promise()})},c.prototype.getShellServiceInfo=function(b){var c=this,d=null,e=a.SafeStorage.SessionStorage;if(d=e.getItem(this.aadLauncherSesstionStorageKey)){var f=$.Deferred();return f.resolve(JSON.parse(d)).promise()}return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"GetShellServiceInfo(culture='{0}')".format(b),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.GetShellServiceInfo}).then(function(a){return e.setItem(c.aadLauncherSesstionStorageKey,JSON.stringify(a)),a})},c.prototype.getConsumerShellServiceInfo=function(b){var c=this,d=null,e=a.SafeStorage.SessionStorage;if(d=e.getItem(this.msaLauncherSesstionStorageKey)){var f=$.Deferred();return f.resolve(JSON.parse(d)).promise()}return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"GetConsumerShellServiceInfo(culture='{0}')".format(b),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.GetConsumerShellServiceInfo}).then(function(a){return window.sessionStorage.setItem(c.msaLauncherSesstionStorageKey,JSON.stringify(a)),a})},c.prototype.getOrNewExcelInOneDrive=function(b,c){var d=this.getSurveyWebOwnerServiceUrl()+"GetOrNewExcelInOneDrive(formid='"+b+"',forcereexport='"+c+"')";return this.sendRequest({requestUri:d,method:"GET",headers:{__TimezoneOffset:(new Date).getTimezoneOffset().toString()},qosEventName:a.Event.QosEventNames.ServiceEndpoints.Action.OpenExcelInOneDrive})},c.prototype.getYoutubeVideoInfo=function(b){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"embed?youtubeurl="+encodeURIComponent(b),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.GetYouTubeVideoInfo})},c.prototype.getUserInfo=function(){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"userInfo",method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.GetUserInfo})},c.prototype.getXlWorkbookId=function(b){var c=this.getSurveyWebServiceUrl()+"GetXlWorkbookId(formid='"+b+"')";return this.sendRequest({requestUri:c,method:"GET",headers:{__TimezoneOffset:(new Date).getTimezoneOffset().toString()},qosEventName:a.Event.QosEventNames.ServiceEndpoints.Action.GetXlWorkbookId})},c.prototype.isMemberOf=function(b){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"light/IsMemberOf('"+b+"')",method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Function.IsMemberOf},{disableXMsHeader:!0})},c.prototype.mathCalculation=function(b){if(!b||!b.Mathml){var c={Aria:"",Responses:[]};return $.Deferred().resolve(c).promise()}var d={Context:b.Context,Formulas:[b.Mathml],InputFormat:"MathML",Locale:navigator.language,Mode:1,OutputFormat:"latex",RequiredIncorrectAnswerCount:b.IncorrectAnswerCount};return this.sendRequest({data:d,method:"POST",requestUri:this.getSurveyWebServiceUrl()+"math/calculation?formId="+b.FormId+"&questionId="+b.QuestionId,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Question.MathCalculation})},c.prototype.mathQuestionGeneration=function(b){if(!b.Context){var c={Features:0,Results:[]};return $.Deferred().resolve(c).promise()}var d={Features:b.Features,Input:b.Context,InputFormat:"MathML",Locale:navigator.language,OutputFormat:"latex",RequiredQuestionsCount:b.QuestionCount,RequiredIncorrectAnswerCount:b.IncorrectAnswerCount};return this.sendRequest({data:d,method:"POST",requestUri:this.getSurveyWebServiceUrl()+"mathapi/questions?formId="+b.FormId+"&questionId="+b.QuestionId,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Question.MathQuestionGeneration})},c.prototype.browseImage=function(b,c,d){var e={resourceId:b,itemCount:c,skipToken:d};return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"decomposition/browseimage",method:"POST",data:e,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Decomposition.BrowseImage})},c.prototype.getToken=function(){return this.authContext.getFormApiToken()},c.prototype.searchImage=function(b,c,d,e,f){var g={query:b,itemCount:d,lcid:OfficeFormServerInfo.cultureInfo.Name.toLowerCase(),parameters:{license:c},skipToken:e.toString(),url:f};return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"decomposition/searchimage",method:"POST",data:g,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Decomposition.SearchImage})},c.prototype.getCdbToken=function(){var b=$.Deferred();return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"decomposition/getTokenForResource?resourceType=CollabDB",method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Decomposition.GetCdbToken}).then(function(a){a?b.resolve(a):b.reject(new Error("Failed to get CDB token via GetTokenForResource"))},function(a){b.reject(a)}),b.promise()},c.prototype.getOD4BToken=function(){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"decomposition/getTokenForResource?resourceType=MSGraph",method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Decomposition.GetOD4BToken}).then(function(a){return a?"Bearer "+a:$.Deferred().reject(new Error("Failed to get OneDriveForBusiness token via GetTokenForResource")).promise()})},c.prototype.reportAbuse=function(b){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"contentvalidation/report",method:"POST",data:b,qosEventName:a.Event.QosEventNames.ServiceEndpoints.OnlineSafety.ReportAbuse,qosExtraData:{Category:b.Category}})},c.prototype.getGroups=function(){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"groups",method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Group.GetGroups})},c.prototype.getGroupId=function(b){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"groupinfo/getgroupid?onedriveweburl="+encodeURIComponent(b),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetGroupId})},c.prototype.getGroup=function(b){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+("groups('"+b+"')"),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Group.GetGroup})},c.prototype.getGroupOwners=function(b){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+("groups('"+b+"')/owners"),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Group.GetOwners})},c.prototype.getGroupMembers=function(b){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+("groups('"+b+"')/members"),qosEventName:a.Event.QosEventNames.ServiceEndpoints.Group.GetMembers})},c.prototype.getGroupPhotoDefinition=function(b){return this.sendRequestWithToken({requestUri:this.getSurveyWebServiceUrl()+("groups('"+b+"')/photo"),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Group.GetPhotoDefinition})},c.prototype.getGroupPhotoValue=function(b){return this.sendRequestWithToken({blobResponseType:!0,requestUri:this.getSurveyWebServiceUrl()+("groups('"+b+"')/photo/$value"),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Group.GetPhotoValue})},c.prototype.getGroupMemberPhotoDefinition=function(b,c){return this.sendRequestWithToken({requestUri:this.getSurveyWebServiceUrl()+("groups('"+b+"')/members('"+c+"')/photo"),
method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Group.GetMemberPhotoDefinition})},c.prototype.getGroupMemberPhotoValue=function(b,c){return this.sendRequestWithToken({blobResponseType:!0,requestUri:this.getSurveyWebServiceUrl()+("groups('"+b+"')/members('"+c+"')/photo/$value"),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Group.GetMemberPhotoValue})},c.prototype.getAnalysisSurveyData=function(b){var d=this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.GetAggregateSurveyDataFunctionName;return this.sendRequest({requestUri:d,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Analysis.AggregateSurveyData})},c.prototype.getAnalysisQuizData=function(b){var d=this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+b+"')/"+c.GetAggregateQuizDataFunctionName;return this.sendRequest({requestUri:d,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Analysis.AggregateQuizData})},c.prototype.getResultSharingAnalysisSurveyData=function(b){var d=this.getSurveyWebOwnerServiceUrl()+c.AnalysisFormEntityCollectionName+"('"+b+"')/"+c.GetAggregateSurveyDataFunctionName;return this.sendRequest({requestUri:d,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Analysis.ResultSharingAggregateSurveyData})},c.prototype.getResultSharingAnalysisQuizData=function(b){var d=this.getSurveyWebOwnerServiceUrl()+c.AnalysisFormEntityCollectionName+"('"+b+"')/"+c.GetAggregateQuizDataFunctionName;return this.sendRequest({requestUri:d,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Analysis.ResultSharingAggregateQuizData})},c.prototype.getInsights=function(b){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"insights/getinsights?formId="+encodeURIComponent(b),method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetInsights})},c.prototype.getFormsWithToken=function(b,d,e){void 0===b&&(b=!1);var f=this.getSurveyWebServiceUrl()+c.FormEntityCollectionName+c.getQueryParameters("?",d);return Forms.Common.logFlightStatus(a.Flighting.Flights.SocialSharing),this.sendRequestWithToken({requestUri:f,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.GetForms},{skipExpiredTokenCheck:!!e},e)},c.prototype.createFormWithToken=function(b,d){var e={__TimezoneOffset:(new Date).getTimezoneOffset().toString()};return this.sendRequestWithToken({requestUri:this.getSurveyWebServiceUrl()+c.FormEntityCollectionName,method:"POST",data:b,headers:e,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Form.CreateForm,qosExtraData:{FormType:this.getFormType(b)}},{},d)},c.prototype.checkAnonymousAccess=function(a){var d=this.getSurveyWebOwnerServiceUrl()+"light/"+c.RuntimeFormEntityCollectionName+"('"+a+"')";return b.OData.send({requestUri:d,headers:[]},{disableLog:!0,skipExpiredTokenCheck:!0}).then(function(){return!0},function(a){var c=b.OData.ResponseHandler.convertToResponseError(a);return c.statusCode===b.ErrorCode.HttpStatusCode.Unauthorized?$.Deferred().resolve(!1).promise():c})},c.prototype.experimentationGetVariations=function(){var a=this.getSurveyWebServiceUrl()+"experimentation/getvariations";return this.sendRequest({requestUri:a,method:"GET"})},c.prototype.experimentationActivate=function(a){var b=this.getSurveyWebServiceUrl()+"experimentation/activate?experimentKey="+a;return this.sendRequest({requestUri:b,method:"GET"})},c.prototype.experimentationTrack=function(a,b){var c=this.getSurveyWebServiceUrl()+"experimentation/track?experimentKey="+a+"&eventKey="+b;return this.sendRequest({requestUri:c,method:"GET"})},c.prototype.getDeletedUserByIdOrEmail=function(a){var b=this.getSurveyWebServiceUrl()+"deleteduserinfo/byidemail/"+encodeURIComponent(a);return this.sendRequest({requestUri:b,method:"GET"})},c.prototype.getUserSettings=function(){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"userSettings",method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.UserSettings.GetUserSettings})},c.prototype.updateUserSettings=function(b){return this.sendRequest({requestUri:this.getSurveyWebServiceUrl()+"userSettings",method:this.partialUpdateHttpMethod,data:b,qosEventName:a.Event.QosEventNames.ServiceEndpoints.UserSettings.UpdateUserSettings})},c.prototype.getAllLocaleResources=function(b){var c=this.getMultilingualBaseUrl(b);return this.sendRequest({requestUri:c,method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Multilingual.GetAllLocales})},c.prototype.getLocaleResource=function(b,c){var d=this.getMultilingualBaseUrl(b)+"/'"+c+"'";return this.sendRequest({requestUri:d,method:"GET",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Multilingual.GetLocale})},c.prototype.createLocaleItem=function(b,c){return this.sendRequest({requestUri:this.getMultilingualBaseUrl(b),method:"POST",data:c,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Multilingual.CreateLocaleItem})},c.prototype.updateLocaleItem=function(b,c){var d=this.getMultilingualBaseUrl(b)+"/'"+c.locale+"'/";return d+=c.questionId?"question/'"+c.questionId+"'/'":"form/'",d+=c.elementKey+"'",this.sendRequest({requestUri:d,method:this.partialUpdateHttpMethod,data:{ElementValue:c.elementValue},qosEventName:a.Event.QosEventNames.ServiceEndpoints.Multilingual.UpdateLocaleItem})},c.prototype.deleteLocale=function(b,c){return this.sendRequest({requestUri:this.getMultilingualBaseUrl(b)+"/'"+c+"'",method:"DELETE",qosEventName:a.Event.QosEventNames.ServiceEndpoints.Multilingual.DeleteLocale})},c.getQueryParameters=function(a,b){if(!b)return a+"$expand="+c.QuestionEntityCollectionName;b=_.union(["id"],b);var d="$select="+b.join(","),e={permissions:"permissions"};e[c.QuestionEntityCollectionName]=c.QuestionEntityCollectionName+"($expand="+c.ChoiceEntityCollectionName+")",e[c.PermissionTokenEntityCollectionName]="permissionTokens";var f=b.map(function(a){return e[a]}).filter(function(a){return a});return f.length&&(d+="&$expand="+f.join(",")),d&&a+d},c.prototype.sendRequestWithToken=function(a,c,d){var e=this;return $.when(d||this.getToken()).then(function(d){return a.headers=$.extend(!0,a.headers,e.getCommonHeaders(d)),b.OData.send(a,c).then(b.OData.ResponseHandler.parseResponseDataValue,b.OData.ResponseHandler.parseAndTryHandleError)})},c.prototype.getDownloadExcelRequestUrlParameters=function(b,c,d,e,f,g){var h=(new Date).getTimezoneOffset().toString(),i={formid:b,timezoneOffset:h,downloadCookie:e,minResponseId:c,maxResponseId:d,"X-CorrelationId":f};return a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth)||(i.Authorization=g),i},c.prototype.getDownloadExcelRequestUrl=function(a){return this.getExcelServiceBaseUrl()+"formapi/DownloadExcelFile.ashx?"+$.param(a)},c.prototype.downloadExcelCheckAndHandleAuthFailure=function(c,d){var e=a.Utilities.tryParseJson(c),f=e&&(e.error&&parseInt(e.error.code)||parseInt(e.ErrorCode));f===b.ErrorCode.InnerCode.TokenExpired||f===b.ErrorCode.InnerCode.RequireLogin?b.AuthTokenHelper.getInstance().refreshAuthToken(function(){a.Flighting.Flight.isEnabled(a.Flighting.Flights.RefreshServerInfoInFrame)?d():a.PageMethods.refreshAntiForgeryToken(d,function(){return Forms.Common.reloadPage()})},function(){a.Authenticator.signInThenRefresh()}):d()},c.prototype.sendRequestInner=function(a,c,d){var e=this;return this.getToken().then(function(a){return c.headers=$.extend(!0,c.headers,e.getCommonHeaders(a)),b.OData.send(c,d).then(b.OData.ResponseHandler.convertToAsyncResult,b.OData.ResponseHandler.parseAndTryHandleError)}).then(a)},c.prototype.sendRequest=function(a,b){return this.sendRequestInner(function(a){return a&&a.value},a,b)},c.prototype.createHiddenIFrame=function(a){var b=document.getElementById(a);return b&&b.parentNode.removeChild(b),b=document.createElement("iframe"),b.id=a,b.name=a,b.hidden=!0,b},c.prototype.getCommonHeaders=function(b){var d={Accept:"application/json",Authorization:b?"Bearer "+b:"",__RequestVerificationToken:OfficeFormServerInfo.antiForgeryToken,ShareInvitationKey:a.Utilities.Html.getHashes().Token,AnalyzerToken:a.Utilities.Html.getQueries().AnalyzerToken,ValidationToken:a.Utilities.Html.getQueries().vt};return d=_.extend({},d,c.customizedHeaders)},c.prototype.getSurveyWebServiceUrl=function(){return this.serviceUrl},c.prototype.getSurveyWebOwnerServiceUrl=function(){return this.ownerServiceUrl},c.prototype.getExcelServiceBaseUrl=function(){return this.serviceUrl.slice(0,-12)},c.prototype.getMultilingualBaseUrl=function(a){return this.getSurveyWebOwnerServiceUrl()+c.FormEntityCollectionName+"('"+a+"')/"+c.LocaleResourceEntityCollectionName},c.prototype.getFormType=function(a){var b=null;if(a&&a.settings){var c=null;try{c=JSON.parse(a.settings)}catch(d){}a.category&&a.category.split(" ").indexOf("Poll")>=0?b="Poll":c&&void 0!==c.IsQuizMode&&(b=c.IsQuizMode?"Quiz":"Form")}return b||void 0},c.customizedHeaders={},c}();b.FormApi=c}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b,c=a.ErrorCode.InnerCode;!function(a){function b(a){var b=new FileReader;b.readAsDataURL(a);var c=$.Deferred();return b.onload=function(){c.resolve(b.result).promise()},c.promise()}function d(a){var b=$.Deferred();try{for(var d=a.split(","),e=(d[0].match(/:(.*?);/)[1],window.atob(d[1])),f=e.length,g=new Uint8Array(f);f--;)g[f]=e.charCodeAt(f);b.resolve(new Blob([g]))}catch(h){b.reject({correlationId:null,statusCode:0,innerCode:c.ImageTypeConvertFailed,innerMessage:"Image Type Convert Error",statusText:"Image Converting from Base64 to Blob Error"})}return b.promise()}a.convertImageBlobToBase64=b,a.convertImageDataURLToBlob=d}(b=a.ImageProcessing||(a.ImageProcessing={}))}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=b.ErrorCode.InnerCode,d=function(){function d(a){for(this.authContext=Forms.getPageContext().AuthContext,this.serviceUrl=a.trim();"/"===this.serviceUrl.charAt(this.serviceUrl.length-1);)this.serviceUrl=this.serviceUrl.substr(0,this.serviceUrl.length-1)}return d.prototype.deleteQuestionImage=function(a,b,c){var e=this,f=this.getToken();return f.then(function(f){return d.deleteImageInternal(f,e.getAbsoluteUrl(d.getQuestionImageUrl(a,b,c)))})},d.prototype.uploadQuestionImage=function(a,b,c,e){var f=this,g=this.getToken();return g.then(function(g){return d.uploadImageInternal(g,f.getAbsoluteUrl(d.getQuestionImageUrl(a,b,c)),c,e)})},d.prototype.deleteFormImage=function(a,b){var c=this,e=this.getToken();return e.then(function(e){return d.deleteImageInternal(e,c.getAbsoluteUrl(d.getFormImageUrl(a,b)))})},d.prototype.uploadFormImage=function(a,b,c){var e=this,f=this.getToken();return f.then(function(f){return d.uploadImageInternal(f,e.getAbsoluteUrl(d.getFormImageUrl(a,b)),b,c)})},d.getFormImageUrl=function(a,b){return d.formImageUrlPattern.format(a,b)},d.getQuestionImageUrl=function(a,b,c){return d.questionImageUrlPattern.format(a,b,c)},d.deleteImageInternal=function(b,c){var e=new a.Event.QosEventDeprecated(a.Event.QosEventNames.ServiceEndpoints.Image.DeleteImage);e.start();var f={type:"DELETE",url:c,headers:{Authorization:b?"Bearer "+b:"","X-CorrelationId":e.CorrelationId}},g=function(){return e.end({resultType:"Success"})},h=function(a){var b={correlationId:e.CorrelationId,innerCode:a.responseJSON&&a.responseJSON.error&&a.responseJSON.error.code,statusCode:a.status,innerMessage:a.responseJSON&&a.responseJSON.error&&a.responseJSON.error.message,statusText:a.statusText};return e.end({resultType:"Failure",extraData:{imageUrl:c,error:b}}),b};return d.sendRequest(f,g,h)},d.uploadImageInternal=function(b,e,f,g){var h=new a.Event.QosEventDeprecated(a.Event.QosEventNames.ServiceEndpoints.Image.UploadImage);h.start();var i={type:"PUT",url:e,headers:{Authorization:b?"Bearer "+b:"","Content-Type":g.ImageType,"Content-Disposition":"attachment; name={0}; filename={1}".format(a.Utilities.Guid.newGuid(),g.ImageName),"X-CorrelationId":h.CorrelationId},processData:!1,data:g.ImageBlob},j=function(a){if(!a||!a.resourceId){var b={correlationId:h.CorrelationId,innerCode:c.ImageUploadFailed,statusCode:0,innerMessage:"Upload image return bad response",statusText:"CollabDb bad response"};return h.end({resultType:"Failure",extraData:{imageUrl:e,error:b,imageType:f}}),$.Deferred().reject(b).promise()}h.end({resultType:"Success",extraData:{imageType:f}});var d={};return d.altText=a.altText,d.contentType=a.contentType,d.fileIdentifier=a.fileIdentifier,d.originalFileName=a.originalFileName,d.resourceId=a.resourceId,d.resourceUrl=a.resourceUrl,d.height=a.height,d.width=a.width,d},k=function(a){var b={correlationId:h.CorrelationId,innerCode:a.responseJSON&&a.responseJSON.error&&a.responseJSON.error.code,statusCode:a.status,innerMessage:a.responseJSON&&a.responseJSON.error&&a.responseJSON.error.message,statusText:a.statusText};return h.end({resultType:"Failure",extraData:{imageUrl:i.url,error:b}}),b};return d.sendRequest(i,j,k)},d.sendRequest=function(c,d,e){a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth)&&(c.headers.__RequestVerificationToken=OfficeFormServerInfo.antiForgeryToken);var f=$.ajax(c);return f.then(d,function(f){return b.AuthTokenHelper.getInstance().isAuthTokenExpiredFailure(f)?void b.AuthTokenHelper.getInstance().refreshAuthToken(function(){if(a.Flighting.Flight.isEnabled(a.Flighting.Flights.RefreshServerInfoInFrame)){c.headers.__RequestVerificationToken=OfficeFormServerInfo.antiForgeryToken;var b=$.ajax(c);return b.then(d,e)}a.PageMethods.refreshAntiForgeryToken(function(){c.headers.__RequestVerificationToken=OfficeFormServerInfo.antiForgeryToken;var a=$.ajax(c);return a.then(d,e)},function(){return Forms.Common.reloadPage()})},function(){a.Authenticator.signInThenRefresh()}):e(f)})},d.prototype.getToken=function(){return this.authContext.getFormApiToken()},d.prototype.getAbsoluteUrl=function(a){return this.serviceUrl+"/"+a},d.formImageUrlPattern="forms('{0}')/{1}",d.questionImageUrlPattern="forms('{0}')/questions('{1}')/{2}",d}();b.ImageProvider=d}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c;!function(a){a[a.None=0]="None",a[a.SpellChecker=1]="SpellChecker",a[a.AutoSuggest=2]="AutoSuggest",a[a.KeyPhrase=4]="KeyPhrase",a[a.ChoiceQuestionTypeSuggest=256]="ChoiceQuestionTypeSuggest",a[a.SuggestionForm=512]="SuggestionForm",a[a.SuggestionQuestion=2048]="SuggestionQuestion",a[a.OptionsSuggest=4096]="OptionsSuggest",a[a.LikertQuestionTypeSuggest=8192]="LikertQuestionTypeSuggest",a[a.AdoptKeyWord=16384]="AdoptKeyWord"}(c=b.TextAnalyzerFeatures||(b.TextAnalyzerFeatures={}));var d;!function(a){a[a.None=0]="None",a[a.SimilarMathQuestionSuggestions=1]="SimilarMathQuestionSuggestions"}(d=b.MathAnalyzerFeatures||(b.MathAnalyzerFeatures={}));var e;!function(a){a[a.Unknown=0]="Unknown",a[a.Edu=1]="Edu",a[a.Biz=2]="Biz",a[a.MsaFree=4]="MsaFree",a[a.MSIT=8]="MSIT",a[a.MsaPaid=16]="MsaPaid",a[a.FastFood=32]="FastFood"}(e=b.UserType||(b.UserType={})),a.Exports.DataProvider.TextAnalyzerFeatures=c,a.Exports.DataProvider.MathAnalyzerFeatures=d}(c=b.Models||(b.Models={}))}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function c(b,d){return c._instance?c._instance:(c._instance=this,this._serviceUrl=b,this._tokenRetriever=d,a.Utilities.assert(this._serviceUrl,"math service url is null"),void 0)}return c.getInstance=function(a,b){return new c(a,b)},c.prototype.mathFormulaCalculation=function(b){if(!b||!b.Mathml){var c={Aria:"",Responses:[]};return $.Deferred().resolve(c).promise()}var d={Context:b.Context,Formulas:[b.Mathml],InputFormat:"MathML",Locale:navigator.language,Mode:1,OutputFormat:"latex",RequiredIncorrectAnswerCount:b.IncorrectAnswerCount};return this.sendRequest({data:d,method:"POST",requestUri:this._serviceUrl+"mathapi/calculation?formId="+b.FormId+"&questionId="+b.QuestionId,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Question.MathCalculation})},c.prototype.mathQuestionGeneration=function(b){if(!b.Context){var c={Features:0,Results:[]};return $.Deferred().resolve(c).promise()}var d={Features:b.Features,Input:b.Context,InputFormat:"MathML",Locale:navigator.language,OutputFormat:"latex",RequiredQuestionsCount:b.QuestionCount,RequiredIncorrectAnswerCount:b.IncorrectAnswerCount};return this.sendRequest({data:d,method:"POST",requestUri:this._serviceUrl+"mathapi/questions?formId="+b.FormId+"&questionId="+b.QuestionId,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Question.MathQuestionGeneration})},c.prototype.textAnalyze=function(a){var c=b.Models.TextAnalyzerFeatures.ChoiceQuestionTypeSuggest;return this.textAnalyzeWithFeatures(c,a)},c.prototype.textAnalyzeWithFeatures=function(b,c){if(!c){var d={Features:0,Results:[]};return $.Deferred().resolve(d).promise()}var e={Features:b,Text:c};return this.sendRequest({requestUri:this._serviceUrl+"textanalysis2",method:"POST",data:e,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Question.TextAnalysis,qosExtraData:{Features:b}})},c.prototype.sendRequest=function(c){return this._tokenRetriever.getToken().then(function(d){return c.headers=$.extend(!0,c.headers,{Accept:"application/json",Authorization:d?"Bearer "+d:"",__RequestVerificationToken:OfficeFormServerInfo.antiForgeryToken}),b.OData.send(c).then(function(c){a.Utilities.assert(c,"math calculation result is null");var d=b.OData.ResponseHandler.parseResponseDataValue(c);return a.Utilities.assert(d,"math calculation result parse failure"),d},b.OData.ResponseHandler.parseAndTryHandleError)})},c}();b.MathProvider=c}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(){return f.getInstance().createDataProvider()}function d(a){return f.getInstance().createDataProvider(e.Group,OfficeFormServerInfo.userInfo.TenantId,a)}var e;!function(a){a[a.Default=0]="Default",a[a.Personal=1]="Personal",a[a.Group=2]="Group",a[a.Me=3]="Me"}(e=b.DataProviderType||(b.DataProviderType={}));var f=function(){function c(){return c.instance?c.instance:(c.instance=this,void(this.environment=a.EnvironmentConfig.getEnvironmentType()))}return c.getInstance=function(){return new c},c.prototype.getOwnerServiceUrl=function(a,b,c){return a===e.Default?this.FormApiServiceUrl:a===e.Me?this.FormApiServiceUrl+"me/":b&&c?this.FormApiServiceUrl+b+(a===e.Group?"/groups/":"/users/")+c+"/":null},c.prototype.createDataProvider=function(a,c,d){if(void 0===a&&(a=e.Default),void 0===c&&(c=null),void 0===d&&(d=null),a===e.Default)return this.defaultDataProvider||(this.defaultDataProvider=new b.FormApi(this.FormApiServiceUrl,this.FormApiServiceUrl)),this.defaultDataProvider;var f=this.getOwnerServiceUrl(a,c,d);return f&&new b.FormApi(this.FormApiServiceUrl,f)},c.prototype.createImageProvider=function(a,c,d){if(void 0===a&&(a=e.Default),void 0===c&&(c=null),void 0===d&&(d=null),a===e.Default)return this.currentImageProvider||(this.currentImageProvider=new b.ImageProvider(this.FormApiServiceUrl)),this.currentImageProvider;var f=this.getOwnerServiceUrl(a,c,d);return f&&new b.ImageProvider(f)},c.prototype.createIntelligenceProvider=function(a,b,c){return new Forms.DataProvider.IntelligenceProvider(this.BaseServiceUrl,this.createDataProvider(),b,c,a===e.Group?"groups":"users")},Object.defineProperty(c.prototype,"CurrentNotificationProvider",{get:function(){return this.currentNotificationProvider||(this.currentNotificationProvider=new b.PushNotificationProvider),this.currentNotificationProvider},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"CurrentMathProvider",{get:function(){return this.currentMathProvider||(this.currentMathProvider=b.MathProvider.getInstance(this.FormMathServiceUrl,this.createDataProvider())),this.currentMathProvider},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"CurrentQtiProvider",{get:function(){return this.currentQtiProvider||(this.currentQtiProvider=b.QtiProvider.getInstance(this.QtiApiServiceUrl,this.createDataProvider())),this.currentQtiProvider},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"FormApiServiceUrl",{get:function(){return this.getServiceUrl(c.formApiEndpointPostfix)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"QtiApiServiceUrl",{get:function(){return this.getServiceUrl(c.qtiApiEndpointPostfix)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"FormMathServiceUrl",{get:function(){return this.getServiceUrl(c.formMathApiEndpointPostfix)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"CollabDBServiceUrl",{get:function(){var b;return b=a.EnvironmentConfig.isOsi()?a.EnvironmentConfig.getEnvironmentType():a.EnvironmentConfig.getEnvironmentTypeForNonOSI(),a.EnvironmentConfig.getCollabDBResourceId(b)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"BaseServiceUrl",{get:function(){if(!a.EnvironmentConfig.isOsi()){var b=a.EnvironmentConfig.getEnvironmentTypeForNonOSI();return"EDog"===b?c.apiEndpointEDog:c.apiEndpointInt}var d;switch(this.environment){case"USDoDProd":d=c.apiEndpointUSDoDProd;break;case"USGovProd":d=c.apiEndpointUSGovProd;break;case"USGovGccProd":d=c.apiEndpointProd;break;case"WWProd":d=c.apiEndpointProd;break;case"EDog":d=c.apiEndpointEDog;break;default:d="Int"===this.environment&&"edog"===a.EnvironmentConfig.getDesiredProvider()?c.apiEndpointEDog:"https://"+window.location.host+"/"}return d},enumerable:!0,configurable:!0}),c.prototype.getServiceUrl=function(a){return this.BaseServiceUrl+a},c.apiEndpointUSDoDProd="https://forms.osi.apps.mil/",c.apiEndpointUSGovProd="https://forms.osi.office365.us/",c.apiEndpointProd="https://forms.office.com/",c.apiEndpointEDog="https://forms.officeppe.com/",c.apiEndpointInt="https://forms.office-int.com/",c.formApiEndpointPostfix="formapi/api/",c.formMathApiEndpointPostfix="formmath/api/",c.qtiApiEndpointPostfix="eduqti/api/",c}();b.ProviderManager=f,b.createDataProvider=c,b.createGroupDataProvider=d}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function a(){this.clients={}}return a.prototype.close=function(a){this.clients[a]&&(this.clients[a].close(),delete this.clients[a])},a.prototype.open=function(a,c,d){if(this.close(a),null==d)throw new Error("PushNotificationProvider.open method: cdbTable should not be null.");return this.clients[a]=new e(b.ProviderManager.getInstance().CollabDBServiceUrl,d.OwnerTenantId,d.OwnerId,d.TableId,d.IsGroupTable),this.clients[a].open(c)},a}();b.PushNotificationProvider=c;var d=function(){function b(b){this.clientId=a.Utilities.Guid.newGuid(),this.clientName=b}return Object.defineProperty(b.prototype,"ClientId",{get:function(){return this.clientId},enumerable:!0,configurable:!0}),b.prototype.log=function(b){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];if(a.Utilities.Flight.isDebugMode()||!a.EnvironmentConfig.isOsi()){var e=new Date;console.log("[%s] %s[%s]: %s",e.toTimeString(),this.clientName,this.clientId,b.format.apply(b,c))}},b}(),e=function(c){function d(a,b,d,e,g){var h=c.call(this,"CdbSignalR")||this;return h.disposed=!0,h.hubConnection=null,h.reconnectingCount=0,h.remainingRetryCount=f.MaxRetryCount,h.rtcUrl=(g?f.CDBUrlForGroupsFormat:f.CDBUrlForUsersFormat).format(a.trimEnd("/"),b,d,e),h}return __extends(d,c),d.prototype.close=function(){var a=this;this.log("Closing connection"),this.disposed=!0;var b=function(){4!==a.hubConnection.state&&a.invokeHubMethod(f.UserHubName,f.Leave).always(function(){a.hubConnection.stop(!0,!0),a.log("Connection closed")})};null!=this.hubConnection&&(0===this.hubConnection.state||2===this.hubConnection.state?this.hubConnection.stateChanged(b):b())},d.prototype.open=function(c){var d=this;this.log("Creating connection"),this.createHubConnection(this.rtcUrl),this.log("Initializing connection"),c=_.clone(c),c.onFormUpdated&&this.onHubEvent(f.TableDefinitionHubName,f.TableUpdated,function(a,b){c.onFormUpdated(g.toFormUpdatePayload(b),g.toUserPayload(b._modifiedBy))}),c.onFormElementAdded&&this.onHubEvent(f.TableDefinitionHubName,f.ColumnAdded,function(a,b){"Comments"!==a.propertyName&&"ReleaseDate"!==a.propertyName&&c.onFormElementAdded(g.toFormElementPayload(b),g.toUserPayload(b._modifiedBy))}),c.onFormElementDeleted&&this.onHubEvent(f.TableDefinitionHubName,f.ColumnDeleted,function(a,b){c.onFormElementDeleted(a.propertyName,g.toUserPayload(b._modifiedBy))}),c.onFormElementUpdated&&this.onHubEvent(f.TableDefinitionHubName,f.ColumnUpdated,function(a,b){c.onFormElementUpdated(a.propertyName,g.toFormElementUpdatePayload(b),g.toUserPayload(b._modifiedBy))}),c.onChoiceAdded&&this.onHubEvent(f.TableDefinitionHubName,f.ChoiceAdded,function(a,b){c.onChoiceAdded(a.propertyName,g.toChoicePayload(a,b),g.toUserPayload(b._modifiedBy))}),c.onChoiceDeleted&&this.onHubEvent(f.TableDefinitionHubName,f.ChoiceDeleted,function(a,b){c.onChoiceDeleted(a.propertyName,a.choiceId,g.toUserPayload(b._modifiedBy))}),c.onChoiceUpdated&&this.onHubEvent(f.TableDefinitionHubName,f.ChoiceUpdated,function(a,b){c.onChoiceUpdated(a.propertyName,a.choiceId,g.toChoicePayload(a,b),g.toUserPayload(b._modifiedBy))}),c.onResponseAdded&&this.onHubEvent(f.TableDataHubName,f.RowAdded,function(a,b){c.onResponseAdded(g.toResponsePayload(b))}),c.onResponseDeleted&&this.onHubEvent(f.TableDataHubName,f.RowDeleted,function(a,b){c.onResponseDeleted(Number(a._id),{modifiedBy:g.toUserPayload(b._modifiedBy),modifiedDateTime:new Date(b._modifiedBy.ModifiedDateTime)})}),c.onResponsesAllDeleted&&this.onHubEvent(f.TableDataHubName,f.RowsAllDeleted,function(a,b){c.onResponsesAllDeleted({modifiedBy:g.toUserPayload(b._modifiedBy),modifiedDateTime:new Date(b._modifiedBy.ModifiedDateTime)})}),c.onResponseUpdated&&this.onHubEvent(f.TableDataHubName,f.RowUpdated,function(a,b){c.onResponseUpdated(Number(a._id),g.toResponseUpdatePayload(b))}),c.onCommentAdded&&this.onHubEvent(f.TableDataHubName,f.RelatedRecordAdded,function(a,b,d){g.isCommentPayload(a)&&c.onCommentAdded(Number(a.rowId),g.toCommentPayload(d),{modifiedBy:g.toUserPayload(b.modifiedBy),modifiedDateTime:new Date(b.modifiedDateTime)})}),c.onCommentDeleted&&this.onHubEvent(f.TableDataHubName,f.RelatedRecordDeleted,function(a,b,d){g.isCommentPayload(a)&&c.onCommentDeleted(Number(a.rowId),Number(a.id),{modifiedBy:g.toUserPayload(b.modifiedBy),modifiedDateTime:new Date(b.modifiedDateTime)})}),c.onLocaleResourceAdded&&this.onHubEvent(f.TableDefinitionHubName,f.LocaleResourceAdded,function(a,b){c.onLocaleResourceAdded()}),c.onLocaleResourceUpdated&&this.onHubEvent(f.TableDefinitionHubName,f.LocaleResourceUpdated,function(a,b){c.onLocaleResourceUpdated()}),c.onLocaleResourceDeleted&&this.onHubEvent(f.TableDefinitionHubName,f.LocaleResourceDeleted,function(a,b){c.onLocaleResourceDeleted()}),c.onUserConnected&&this.onHubEvent(f.UserHubName,f.UserConnected,function(a,b){c.onUserConnected(g.toUserPayload(a))}),c.onUserDisconnected&&this.onHubEvent(f.UserHubName,f.UserDisconnected,function(a,b){c.onUserDisconnected(g.toUserPayload(a))});var e=void 0;return this.hubConnection.starting(function(){d.log("connection starting"),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DataProvider.RealtimeClient.ConnectionStarting,extraData:{clientId:d.ClientId,connectionId:d.hubConnection.id,connectionType:f.ConnectionType_CDB}})}),this.hubConnection.connectionSlow(function(){d.log("connection slow"),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DataProvider.RealtimeClient.ConnectionSlow,extraData:{clientId:d.ClientId,connectionId:d.hubConnection.id,connectionType:f.ConnectionType_CDB}}),c.onConnectionSlow&&c.onConnectionSlow()}),this.hubConnection.error(function(b){d.log("connection error: {0}",JSON.stringify(b)),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DataProvider.RealtimeClient.ConnectionError,extraData:{clientId:d.ClientId,connectionId:d.hubConnection.id,connectionType:f.ConnectionType_CDB,error:b}}),e={errorCause:f.ConnectionType_CDB,errorObject:b},c.onConnectionError&&c.onConnectionError(b)}),this.hubConnection.reconnecting(function(){d.log("connection reconnecting"),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DataProvider.RealtimeClient.ConnectionReconnecting,extraData:{clientId:d.ClientId,connectionId:d.hubConnection.id,connectionType:f.ConnectionType_CDB}}),c.onConnectionReconnecting&&c.onConnectionReconnecting()}),this.hubConnection.reconnected(function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DataProvider.RealtimeClient.ConnectionReconnected,extraData:{clientId:d.ClientId,connectionId:d.hubConnection.id,connectionType:f.ConnectionType_CDB}}),d.log("connection reconnected"),c.onConnectionReconnected&&c.onConnectionReconnected(void 0)}),this.hubConnection.disconnected(function(){if(d.log("connection disconnected"),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DataProvider.RealtimeClient.ConnectionDisconnected,extraData:{clientId:d.ClientId,connectionId:d.hubConnection.id,type:e&&e.errorCause,remainingRetryCount:d.remainingRetryCount,lastError:e&&e.errorObject}}),d.remainingRetryCount-->0){d.reconnectingCount++;var g={reconnectingCause:e&&e.errorCause,reconnectingCount:d.reconnectingCount,refreshToken:e&&e.errorObject&&e.errorObject.context&&e.errorObject.context.status===b.ErrorCode.HttpStatusCode.Unauthorized,retryCount:f.MaxRetryCount-d.remainingRetryCount,onSuccess:c.onConnectionReconnected,onError:c.onConnectionFailed};d.startConnection(g).done(function(){e=void 0}).fail(function(a){})}else a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DataProvider.RealtimeClient.ConnectionFailed,extraData:{clientId:d.ClientId,connectionId:d.hubConnection.id,errorCause:e&&e.errorCause,lastError:e&&e.errorObject}}),c.onConnectionDisconnected&&c.onConnectionDisconnected()}),(a.Utilities.Flight.isDebugMode()||!a.EnvironmentConfig.isOsi())&&(this.hubConnection.logging=!0,this.hubConnection.received(function(a){d.log("Received message: {0}",JSON.stringify(a))})),this.disposed=!1,this.startConnection({onSuccess:c.onConnectionStarted,onError:c.onConnectionFailed})},d.prototype.createHubConnection=function(a){this.hubConnection=$.hubConnection(a,{useDefaultPath:!1}),this.hubConnection.createHubProxy(f.TableDefinitionHubName),this.hubConnection.createHubProxy(f.TableDataHubName),this.hubConnection.createHubProxy(f.UserHubName)},d.prototype.getHubProxy=function(a){if(null==this.hubConnection)throw Error("Realtime connection has not been created yet.");var b=this.hubConnection.proxies[a.toLocaleLowerCase()];if(null==b)throw Error("Cannot find hub proxy {0}".format(a));return b},d.prototype.handleAuth=function(a){var c=this;return b.ProviderManager.getInstance().createDataProvider().getCdbToken().then(function(a){c.hubConnection.qs={Authorization:a}})},d.prototype.invokeHubMethod=function(b,c){for(var d=this,e=[],f=2;f<arguments.length;f++)e[f-2]=arguments[f];if(this.isHubConnected()){var g=new a.Event.QosEventDeprecated(a.Event.QosEventNames.ServiceEndpoints.Connection.InvokeMethod);return g.start(),(h=this.getHubProxy(b)).invoke.apply(h,[c].concat(e)).then(function(a){return g.end({resultType:"Success",extraData:{clientId:d.ClientId,connectionId:d.hubConnection.id,methodName:c}}),a},function(a){return g.end({resultType:d.isHubConnected()?"Failure":"ExpectedFailure",extraData:{clientId:d.ClientId,connectionId:d.hubConnection.id,methodName:c,error:JSON.stringify(a,["message","description","source","context","data"])}}),a})}return a.Utilities.Promise.getRejectedPromise(Error("Realtime connection has not been established yet."));var h},d.prototype.isHubConnected=function(){return null!=this.hubConnection&&1===this.hubConnection.state},d.prototype.onHubEvent=function(a,b,c){c&&this.getHubProxy(a).on(b,c)},d.prototype.startConnection=function(b){var c=this;if(this.disposed)return a.Utilities.Promise.getRejectedPromise("Connection disposed");
var d=$.Deferred();b.onSuccess&&d.done(function(a){return b.onSuccess(a)}),b.onError&&d.fail(function(a){return b.onError(a)});var e=new a.Event.QosEventDeprecated(a.Event.QosEventNames.ServiceEndpoints.Connection.ConnectToCDB),g=function(){e.end({resultType:"Success",extraData:{clientId:c.ClientId,connectionId:c.hubConnection.id,connectionType:f.ConnectionType_CDB,reconnectingCause:b.reconnectingCause,reconnectingCount:b.reconnectingCount,retryCount:b.retryCount}}),c.log("Realtime connection started"),c.remainingRetryCount=f.MaxRetryCount,c.invokeHubMethod(f.UserHubName,f.Join),c.invokeHubMethod(f.UserHubName,f.GetActiveUsers).then(function(a){d.resolve(a)},function(a){d.reject(a)})},h=function(a){e.end({resultType:"Failure",extraData:{clientId:c.ClientId,connectionId:c.hubConnection.id,connectionType:f.ConnectionType_CDB,reconnectingCause:b.reconnectingCause,reconnectingCount:b.reconnectingCount,retryCount:b.retryCount,connectionError:a.source?JSON.stringify(a,["message","description","source","context","transport"]):void 0,serviceError:a.source?void 0:JSON.stringify(a,["message","statusCode","statusText","innerCode"])}}),d.reject(a)};return e.start(),this.handleAuth(b.refreshToken).then(function(){return c.hubConnection.start().then(g,h)},function(b){h(b),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DataProvider.RealtimeClient.ConnectionFailed,extraData:{clientId:c.ClientId,connectionId:c.hubConnection.id,errorCause:f.ConnectionType_Client,lastError:b}})}),d.promise()},d}(d),f=function(){function a(){}return a.TableDefinitionHubName="TableDefinitionChangeHub",a.TableDataHubName="TableChangeHub",a.UserHubName="TableActivityHub",a.TableUpdated="tableDefinitionUpdated",a.ColumnAdded="columnDefinitionAdded",a.ColumnDeleted="columnDefinitionDeleted",a.ColumnUpdated="columnDefinitionUpdated",a.ChoiceAdded="choiceAdded",a.ChoiceUpdated="choiceUpdated",a.ChoiceDeleted="choiceDeleted",a.RowAdded="rowAdded",a.RowDeleted="rowDeleted",a.RowsAllDeleted="rowsAllDeleted",a.RowUpdated="rowUpdated",a.RelatedRecordAdded="relatedRecordAdded",a.RelatedRecordDeleted="relatedRecordDeleted",a.RelatedRecordUpdated="relatedRecordUpdated",a.LocaleResourceAdded="localeResourceAdded",a.LocaleResourceUpdated="localeResourceUpdated",a.LocaleResourceDeleted="localeResourceDeleted",a.UserConnected="userConnected",a.UserDisconnected="userDisconnected",a.GetActiveUsers="GetActiveUsers",a.Join="Join",a.Leave="Leave",a.MaxRetryCount=5,a.ConnectionType_Client="client",a.ConnectionType_Server="server",a.ConnectionType_CDB="CDB",a.FormsUrlFormat="{0}/forms/{1}/$notifications",a.CDBUrlForUsersFormat="{0}/realtime/beta/{1}/users/{2}/tables/{3}/$notifications",a.CDBUrlForGroupsFormat="{0}/realtime/beta/{1}/groups/{2}/tables/{3}/$notifications",a}(),g=function(){function b(){}return b.toFormUpdatePayload=function(a){return a&&b.normalize({id:void 0,tableId:a.id,title:a.displayName,createdBy:a.createBy,modifiedDate:a.dateTimeLastUpdated,description:a.description,settings:a.formSettings,otherInfo:a.otherInfo,questions:void 0,header:b.toImagePayload(a.header),logo:b.toImagePayload(a.logo),background:b.toImagePayload(a.background),thankYouMessage:a.thankYouMessage,version:a.version,xlWorkbookId:a.xlWorkbookId,xlExportingTag:a.xlExportingTag,xlFileUnSynced:a.xlFileUnSynced,permissionTokens:b.toPermissionTokenPayload(a.permissionTokens)})},b.toFormElementPayload=function(a){return a&&{id:a.propertyName,title:a.description||a.title||a.displayName,defaultValue:a.defaultValue,subtitle:a.subtitle,required:a.required,type:a.questionType,questionInfo:a.questionInfo,order:a.order,version:void 0,modifiedDate:a.questionModifiedDate,status:a.status,image:b.toImagePayload(a.image),isQuiz:a.isQuiz,choices:a.choices,groupId:a.columnGroupName,fileUploadFolderId:a.fileUploadFolderId,questionTagForIntelligence:a.questionTagForIntelligence,isFromSuggestion:a.isFromSuggestion}},b.toChoicePayload=function(a,c){return c&&b.normalize({id:a.choiceId,customProperties:c.customProperties,description:c.description,displayText:c.displayText,key:c.key,order:c.order})},b.toFormElementUpdatePayload=function(a){return b.normalize(b.toFormElementPayload(a))},b.toUserPayload=function(a){return{userId:a.Id||a.userId,displayName:a.DisplayName||a.displayName,firstName:a.FirstName||a.firstName,lastName:a.LastName||a.lastName,email:a.Email||a.email,imageUri:a.ImageUri||a.imageUri}},b.toImagePayload=function(b){return b?null!=b.ResourceId&&null==b.ResourceUrl?void a.Event.ErrorEventDeprecated.logData({errorName:"InvalidCdbImagePayload"}):{altText:b.AltText,contentType:b.ContentType,fileIdentifier:b.FileIdentifier,originalFileName:b.OriginalFileName,resourceId:b.ResourceId,resourceUrl:b.ResourceUrl}:b},b.toPermissionTokenPayload=function(a){if(a){var b=JSON.parse(a);return b.map(function(a){return{principalId:a.PrincipalId,name:a.Name,type:a.Type}})}return a},b.toResponsePayload=function(a){if(null==a)return a;var c=null==a._id?void 0:Number(a._id);return{id:c,startDate:a.StartDate,submitDate:a.SubmitDate,responder:a.Responder,responderName:a.ResponderName,answers:b.toAnswers(a),quizResult:void 0,releaseDate:a.ReleaseDate}},b.toAnswers=function(a){var b=["SubmitDate","ResponderName","Responder","StartDate","Comments_comments","Comments","ReleaseDate"],c=_.difference(Object.keys(a).filter(function(a){return"_"!==a[0]}),b);return JSON.stringify(c.map(function(b){return{questionId:b,answer1:a[b]}}))},b.toResponseUpdatePayload=function(a){var c=b.normalize(b.toResponsePayload(a));return delete c.answers,c},b.isCommentPayload=function(a){return a&&"Comments_comments"===a.propertyName},b.toCommentPayload=function(a){return a&&{id:a.id,feedback:a.text,score:a.number,questionId:a.columnReference,createdDateTime:a.createdDateTime,createdBy:b.toUserPayload(a.createdBy)}},b.normalize=function(a){var b=a;for(var c in b)void 0===b[c]&&delete b[c];return b},b}()}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function c(b,d){return c.instance?c.instance:(c.instance=this,this.qtiServiceUrl=b,this.tokenRetriever=d,a.Utilities.assert(this.qtiServiceUrl,"qti service url is null"),void 0)}return Object.defineProperty(c.prototype,"QtiServiceUrl",{get:function(){return this.qtiServiceUrl},enumerable:!0,configurable:!0}),c.getInstance=function(a,b){return new c(a,b)},c.prototype.generateFormFromQtiFile=function(b){return this.sendRequest({requestUri:this.QtiServiceUrl+"qti",method:"POST",data:b,qosEventName:a.Event.QosEventNames.ServiceEndpoints.Qti.CreateFormFromQti,qosExtraData:{LorCorrelationId:a.SafeStorage.SessionStorage.getItem("LorCorrelationId")}})},c.getCommonHeaders=function(b){return{Accept:"application/json",Authorization:b?"Bearer "+b:"",__RequestVerificationToken:OfficeFormServerInfo.antiForgeryToken,ShareInvitationKey:a.Utilities.Html.getHashes().Token}},c.prototype.sendRequest=function(a,d){return this.tokenRetriever.getToken().then(function(e){return a.headers=$.extend(!0,a.headers,c.getCommonHeaders(e)),b.OData.send(a,d).then(b.OData.ResponseHandler.parseResponseDataValue,b.OData.ResponseHandler.parseAndTryHandleError)})},c}();b.QtiProvider=c}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function b(){}return b.getUserInfoInItem=function(b){return b?a.SafeStorage.DefaultStorage.getItem(b):null},b.setUserInfo=function(b,c){b&&a.SafeStorage.DefaultStorage.setItem(b,c)},b}();b.UserProfileProvider=c}(b=a.DataProvider||(a.DataProvider={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){Object.defineProperty(a,"convertToArray",{configurable:!1,enumerable:!0,value:Nerve.convertToArray})}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function b(){}return Object.defineProperty(b,"FormNumber",{get:function(){return 200},enumerable:!0,configurable:!0}),Object.defineProperty(b,"FormTitleLength",{get:function(){return 90},enumerable:!0,configurable:!0}),Object.defineProperty(b,"FormSubtitleLength",{get:function(){return 4e3},enumerable:!0,configurable:!0}),Object.defineProperty(b,"QuestionNumber",{get:function(){return a.Flighting.Flight.isEnabled(a.Flighting.Flights.Question200Limit)?200:100},enumerable:!0,configurable:!0}),Object.defineProperty(b,"QuestionTitleLength",{get:function(){return 4e3},enumerable:!0,configurable:!0}),Object.defineProperty(b,"QuestionSubtitleLength",{get:function(){return 2e3},enumerable:!0,configurable:!0}),Object.defineProperty(b,"QuestionOptionLength",{get:function(){return 1e3},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ImageAltTextLength",{get:function(){return 128},enumerable:!0,configurable:!0}),Object.defineProperty(b,"OtherOptionLength",{get:function(){return 1e3},enumerable:!0,configurable:!0}),Object.defineProperty(b,"AnswerHintLength",{get:function(){return 1e3},enumerable:!0,configurable:!0}),Object.defineProperty(b,"AnswerTextfieldLength",{get:function(){return 4e3},enumerable:!0,configurable:!0}),Object.defineProperty(b,"OpenTypeLength",{get:function(){return 4e3},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ResponseNumber",{get:function(){return 5e3},enumerable:!0,configurable:!0}),Object.defineProperty(b,"DefaultTextLength",{get:function(){return 1e3},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ImagePickerQueryCount",{get:function(){return 50},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ImageMaxWidth",{get:function(){return 800},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ImageMaxHeight",{get:function(){return 600},enumerable:!0,configurable:!0}),Object.defineProperty(b,"QuestionCarMaxWidth",{get:function(){return 719},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ImagePlaceHolderWidth",{get:function(){return 320},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ImagePlaceHolderHeight",{get:function(){return 240},enumerable:!0,configurable:!0}),Object.defineProperty(b,"LogoImagePlaceHolder",{get:function(){return 120},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ImageMaxSize",{get:function(){return 5242880},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ImageCompressRate",{get:function(){return.6},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ClientSideErrorDefaultInnerCode",{get:function(){return-1},enumerable:!0,configurable:!0}),Object.defineProperty(b,"DefaultVideoHeight",{get:function(){return 422},enumerable:!0,configurable:!0}),Object.defineProperty(b,"ImageSupportMimeType",{get:function(){return["image/bmp","image/gif","image/jpeg","image/png"]},enumerable:!0,configurable:!0}),Object.defineProperty(b,"MaxRankingItemNumber",{get:function(){return 10},enumerable:!0,configurable:!0}),Object.defineProperty(b,"DefaultQuestionStartOrder",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(b,"DefaultMiddleScreenSize",{get:function(){return 375},enumerable:!0,configurable:!0}),Object.defineProperty(b,"DefaultSmallScreenSize",{get:function(){return 300},enumerable:!0,configurable:!0}),Object.defineProperty(b,"AnalysisTokenName",{get:function(){return"AnalyzerToken"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"LikertColumnMaxSize",{get:function(){return 7},enumerable:!0,configurable:!0}),Object.defineProperty(b,"LikertRowMaxSize",{get:function(){return 10},enumerable:!0,configurable:!0}),Object.defineProperty(b,"FileUploadSmallFileBytes",{get:function(){return 4194304},enumerable:!0,configurable:!0}),Object.defineProperty(b,"FileUploadMaxChunkBytes",{get:function(){return 5242880},enumerable:!0,configurable:!0}),Object.defineProperty(b,"DateQuestionAnswerFormat",{get:function(){return"yyyy-MM-dd"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"CustomizedThankYouMessageMaxLength",{get:function(){return 4e3},enumerable:!0,configurable:!0}),Object.defineProperty(b,"DefaultTextFieldHeight",{get:function(){return 40},enumerable:!0,configurable:!0}),Object.defineProperty(b,"MathInputLength",{get:function(){return 3e3},enumerable:!0,configurable:!0}),b}();b.FormLimitation=c,a.Exports.FormLimitation=c}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){function b(a){return Nerve.getObjectMasterFromModel(a)}var c,d=Nerve.Spec,e={TargetQuestionId:d.string(),ToTheEnd:d["boolean"](),IsQuestionBranchingValid:d["boolean"]({IsLocalField:!0})};!function(a){a[a.End=0]="End",a[a.Next=1]="Next",a[a.Pending=2]="Pending",a[a.Specified=3]="Specified"}(c=a.BranchingType||(a.BranchingType={})),a.getBranchInfoMaster=b;var f=function(b){function d(a){var c=b.call(this,a)||this;return c.observedQuestionChangeCallback=function(a){return c.onObservedQuestionChange()},a.MasterTreeReady.done(function(){c.Question;c.Deleted||(d.normalize(c,{}),c.observeTargetQuestion(),c.addRule({Name:"normalize",onChange:function(a){return d.normalize(c,a.OldValues)}}),c.observe(function(a){c.Deleted||c.observeTargetQuestion()}))}),c}return __extends(d,b),Object.defineProperty(d.prototype,"Question",{get:function(){var b=this.Parent;do if(b instanceof a.QuestionMaster)return b;while(b=b.Parent);return null},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"TargetQuestionMaster",{get:function(){if(this.Deleted)return null;var a=this.Question.Form.getQuestionById(this.Model.TargetQuestionId);return a&&a.Deleted?null:a},enumerable:!0,configurable:!0}),d.prototype.resetToDefault=function(){var a=this;this.bulkEdit(function(){a.Model.ToTheEnd=null,a.Model.TargetQuestionId=null})},d.prototype.isDefault=function(){return!this.Model.ToTheEnd&&!this.Model.TargetQuestionId},d.prototype.getBranchingResult=function(){var a=this.Model;return a.IsQuestionBranchingValid?a.ToTheEnd?{Type:c.End}:{Type:c.Specified,TargetQuestion:this.TargetQuestionMaster}:{Type:c.Next}},d.normalize=function(a,b){var c=a.Model;c.ToTheEnd?b.ToTheEnd&&c.TargetQuestionId||(c.TargetQuestionId=null):c.ToTheEnd=null,c.IsQuestionBranchingValid=!(!c.ToTheEnd&&!a.TargetQuestionMaster)},d.prototype.observeTargetQuestion=function(){var a=this.TargetQuestionMaster;a!==this.observedQuestion&&(this.observedQuestion&&this.observedQuestion.unobserve(this.observedQuestionChangeCallback),this.observedQuestion=a,a&&a.observe(this.observedQuestionChangeCallback))},d.prototype.onObservedQuestionChange=function(){this.observedQuestion.Deleted&&(this.Model.TargetQuestionId=null)},d}(Nerve.createObjectMasterClass("BranchInfoMaster",e));a.BranchInfoMaster=f}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){function c(a){return Nerve.getObjectMasterFromModel(a)}function d(b){if(b.BeingDeleted&&b.Master.Synchronizer.Model.UpdateScheduled)try{throw Error("DeletingComment")}catch(c){a.Event.ErrorEventDeprecated.logData({errorName:"ModelError",errorInfo:c.stack})}}var e=Nerve.Spec,f={QuestionId:e.string({IsKeyField:!0,SourceFieldName:"questionId"}),Id:e.number({SourceFieldName:"id"}),Feedback:e.string({SourceFieldName:"feedback"}),Score:e.number({SourceFieldName:"score"}),SavingState:e.reference({IsLocalField:!0})};b.getCommentMaster=c;var g=function(a,c){return new b.CommentDataSource(a,c)},h=function(a){function c(c){var e=a.call(this,c,{Scheduler:new b.Scheduler})||this;return b.keepSavingStateUpdated(e),e.observe(d),e}return __extends(c,a),Object.defineProperty(c.prototype,"Response",{get:function(){return this.Parent.Parent},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"FormId",{get:function(){return this.Response.FormId},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"ResponseId",{get:function(){return this.Response.ResponseId},enumerable:!0,configurable:!0}),c}(Nerve.createObjectMasterClass("Comment",f,g));b.CommentMaster=h}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=function(){function c(a,c){this.choice=a,this.receiver=c,this.dataProvider=b.FormDataSource.getDataProviderByFormMaster(this.choice.Form)}return Object.defineProperty(c.prototype,"FormId",{get:function(){return this.choice.FormId},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"QuestionId",{get:function(){return this.choice.QuestionId},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"ChoiceId",{get:function(){return this.choice.Model.Id},enumerable:!0,configurable:!0}),c.prototype.add=function(a){return this.choice.Form.SyncContext===b.FormSyncContext.DesignTimeForm?this.dataProvider.createQuestionChoice(this.FormId,this.QuestionId,a):void Nerve.Debugger.throwError("Trying to create a choice out of design time.")},c.prototype["delete"]=function(a){return this.choice.Form.SyncContext===b.FormSyncContext.DesignTimeForm?this.dataProvider.deleteQuestionChoice(this.FormId,this.QuestionId,this.ChoiceId):void Nerve.Debugger.throwError("Trying to delete a choice out of design time.")},c.prototype.query=function(a){return this.dataProvider.getQuestionChoice(this.FormId,this.QuestionId,this.ChoiceId)},c.prototype.update=function(c,d){if(this.choice.Form.SyncContext===b.FormSyncContext.DesignTimeForm){if(c)return this.dataProvider.updateQuestionChoice(this.FormId,this.QuestionId,this.ChoiceId,c);try{throw Error("patch choice body null error")}catch(e){a.Event.ErrorEventDeprecated.logData({errorName:"DataSourceUpdatingChoiceNull",errorInfo:{stack:e.stack}})}return $.Deferred().resolve().promise()}Nerve.Debugger.throwError("Trying to update a choice out of design time.")},c}();b.ChoiceDataSource=c}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=function(){function c(a,c){this.comment=a,this.receiver=c,this.dataProvider=b.FormDataSource.getDataProviderByFormMaster(this.comment.Response.Form)}return Object.defineProperty(c.prototype,"FormId",{get:function(){return this.comment.FormId},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"ResponseId",{get:function(){return this.comment.ResponseId},enumerable:!0,configurable:!0}),c.prototype.add=function(a,b,c){return this.addOrUpdate(!c),this.dataProvider.addFormResponseComment(this.FormId,this.ResponseId,b.Snapshot)},c.prototype["delete"]=function(a){return $.Deferred().promise()},c.prototype.query=function(a){return Nerve.Debugger.throwError("No scenario to call this method currently.")},c.prototype.update=function(a,c){this.addOrUpdate(!1);var d=this.comment.Response.Form.SyncContext;return d!==b.FormSyncContext.DesignTimeForm&&d!==b.FormSyncContext.AnalysisTimeForm?$.Deferred().promise():this.add(a,c,!0)},c.prototype.addOrUpdate=function(a){a&&this.logCommentCreateEventForQti()},c.prototype.isQtiForm=function(a){return null!=a&&a.startsWith("qti_")?!0:!1},c.prototype.logCommentCreateEventForQti=function(){var c=this.comment.Response.Form;if(c.isFieldReady(b.FormMaster.Schema.TrackingId)){var d=c.Model.TrackingId;this.isQtiForm(d)&&a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.GradeQtiResults,extraData:{FormId:c.Model.Id,LorId:c.Model.TrackingId}})}},c}();b.CommentDataSource=c}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=function(){function c(a,d){if(this.form=a,this.receiver=d,this.dataProvider=c.getDataProviderByFormMaster(a),this.dataProvider){var e=this.dataProvider.getDesignForm;switch(this.form.SyncContext){case b.FormSyncContext.SharedTimeForm:e=this.dataProvider.getSharedForm;break;case b.FormSyncContext.ResponseTimeForm:e=this.dataProvider.getRuntimeForm;break;case b.FormSyncContext.AnalysisTimeForm:e=this.dataProvider.getAnalysisTimeForm;break;case b.FormSyncContext.ResponseDetailTimeForm:e=this.dataProvider.getRuntimeFormV2}this.getForm=e.bind(this.dataProvider)}}return c.getAllForms=function(d,e){var f=c.getSourceFieldNames(d);f.push("status");var g=Nerve.getFieldSchemaInfo(b.FormMaster.Schema.Version).Attributes.SourceFieldName;f.indexOf(g)&&f.push(g);var h=a.DataProvider.DataProviderType.Me,i=null,j=null;e&&(i=e.OwnerTenantId,j=e.OwnerId,h=e.IsGroupForm?a.DataProvider.DataProviderType.Group:a.DataProvider.DataProviderType.Personal);var k=a.DataProvider.ProviderManager.getInstance().createDataProvider(h,i,j),l=k.getForms(f);return l.then(function(c){var d=[],e=0,f=[];return c.forEach(function(a){if("Deleted"===a.status)++e,k.deleteForm(a.id);else if(a.version){var c=Nerve.convertFromSourceData(a,b.FormMaster.Schema);f.push(c)}else d.push(a.id)}),(d.length||e)&&a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PortalPage.FilteredOutForms,extraData:{deletedFormCount:e,oldVersionForms:d}}),f})},c.getAllFormsResponseCount=function(){var b=a.DataProvider.ProviderManager.getInstance().createDataProvider();return b.getFormsResponseCount()},c.getAllLocaleResources=function(a){var b=c.getDataProviderByFormId(a);return b.getAllLocaleResources(a)},c.getAllSharedWithMeForms=function(){var c=a.DataProvider.ProviderManager.getInstance().createDataProvider(a.DataProvider.DataProviderType.Me),d=c.getFormsSharedWithCurrentUser();return d.then(function(a){return a.map(function(a){return Nerve.convertFromSourceData(a,b.FormMaster.Schema)})})},c.getDataProviderByFormMaster=function(c){if(!c.isFieldReady(b.FormMaster.Schema.OwnerTenantId)||!c.isFieldReady(b.FormMaster.Schema.OwnerId))return a.DataProvider.ProviderManager.getInstance().createDataProvider();var d=a.DataProvider.DataProviderType.Default;if(c.IsGroupForm)d=a.DataProvider.DataProviderType.Group;else{if(!c.Model.OwnerTenantId||!c.Model.OwnerId)return null;d=a.DataProvider.DataProviderType.Personal}return a.DataProvider.ProviderManager.getInstance().createDataProvider(d,c.Model.OwnerTenantId,c.Model.OwnerId)},c.getDataProviderByFormId=function(b){var c=a.Utilities.FormId.decodeFormId(b),d=a.DataProvider.DataProviderType.Default;return c.IsGroupOwner?d=a.DataProvider.DataProviderType.Group:c.OrgId&&c.OwnerId&&(d=a.DataProvider.DataProviderType.Personal),a.DataProvider.ProviderManager.getInstance().createDataProvider(d,c.OrgId,c.OwnerId)},c.createExportFile=function(a){var b=c.getDataProviderByFormMaster(a);return b.createExportFile(a.Model.Id)},c.downloadExcelFile=function(a,b,d){var e=c.getDataProviderByFormMaster(a);return e.downloadExcelFile(a.Model.Id,b,d)},c.getResponseCount=function(a){var b=c.getDataProviderByFormMaster(a);return b.getFormResponseCount(a.Model.Id)},c.duplicateExcelForm=function(c,d){var e=a.DataProvider.ProviderManager.getInstance().createDataProvider(),f=e.dupFormForExcel(c,d);return f.then(function(a){return Nerve.convertFromSourceData(a,b.FormMaster.Schema)})},c.getAggregateSurveyData=function(a){var b=c.getDataProviderByFormId(a);return b.getAnalysisSurveyData(a)},c.getAggregateQuizData=function(a){var b=c.getDataProviderByFormId(a);return b.getAnalysisQuizData(a)},c.getResultSharingAnalysisSurveyData=function(a){var b=c.getDataProviderByFormId(a);return b.getResultSharingAnalysisSurveyData(a)},c.getResultSharingAnalysisQuizData=function(a){var b=c.getDataProviderByFormId(a);return b.getResultSharingAnalysisQuizData(a)},c.getFormInsights=function(a){var b=c.getDataProviderByFormId(a);return b.getInsights(a)},c.getResoucesByLocale=function(a,d){var e=Nerve.Collection.getItemWithKeyFields(a.Model.LocalizedResources,{localeId:d});if(!e){var f=c.getDataProviderByFormId(a.Model.Id);return f.getLocaleResource(a.Model.Id,d).then(function(c){Forms.Models.appendLocalizedResources(c,b.exportConverter(a))})}return $.Deferred().resolve().promise()},c.prototype.add=function(a){return this.form.SyncContext===b.FormSyncContext.LocalForm?$.Deferred().promise():this.form.SyncContext===b.FormSyncContext.DesignTimeForm?this.dataProvider.createForm(a):void Nerve.Debugger.throwError("Trying to create a form without design type.")},c.prototype["delete"]=function(a){return this.form.SyncContext===b.FormSyncContext.DesignTimeForm?(this.removeFromMRU(),this.dataProvider.deleteForm(this.form.Model.Id)):void Nerve.Debugger.throwError("Trying to delete a form without design type.")},c.prototype.query=function(b){if(!this.getForm){var c={innerCode:a.DataProvider.ErrorCode.InnerCode.InvalidFormId};return $.Deferred().reject(c).promise()}var d=Nerve.getFieldSchemaInfo(this.form.Schema.LocalizedResources).Name.toLowerCase(),e=b.filter(function(a){return a.toLowerCase()!==d}),f=[];return f.push(this.getForm(this.form.Model.Id,e)),_.find(b,function(a){return a.toLowerCase()===d})&&f.push(this.form.getAllLocaleResources()),$.when.apply($,f).then(function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return _.extend.apply(_,[{}].concat(a))})},c.prototype.update=function(a){if(this.form.SyncContext===b.FormSyncContext.LocalForm)return $.Deferred().promise();if(this.form.SyncContext!==b.FormSyncContext.DesignTimeForm)return $.Deferred().resolve().promise();var c=Nerve.getFieldSchemaInfo(b.FormMaster.Schema.SoftDeleted).Attributes.SourceFieldName;return c in a&&a[c]===b.FormDeletedState.SoftDeleted&&this.removeFromMRU(),this.dataProvider.updateForm(this.form.Model.Id,a)},c.getSourceFieldNames=function(a){return b.FormMaster.getSourceFields(a||Nerve.getSubFieldSchemas(b.FormMaster.Schema)).map(function(a){var b=Nerve.getFieldSchemaInfo(a);return b.Attributes.IsLocalField?void 0:b.Attributes.SourceFieldName||b.Name}).filter(function(a){return a})},c.prototype.removeFromMRU=function(){var a=this;return this.dataProvider.removeRecentForm(this.form.Model.Id).then(function(){var b=Forms.Mru.MruDocumentManager.getInstance();b&&b.removeDocument(a.form.Model.Id)})},c}();b.FormDataSource=c}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=function(){function c(c,d){this.image=c,this.receiver=d;var e,f=this.image.Parent;if(f instanceof b.FormMaster)e=f;else{if(!(f instanceof b.QuestionMaster||f instanceof Forms.Models.DescriptiveElementMaster))throw"Wrong parent type of ImageInfoMaster.";e=f.Form}var g=e.IsGroupForm?a.DataProvider.DataProviderType.Group:a.DataProvider.DataProviderType.Personal;this.dataProvider=b.FormDataSource.getDataProviderByFormMaster(e),this.imageProvider=a.DataProvider.ProviderManager.getInstance().createImageProvider(g,e.Model.OwnerTenantId,e.Model.OwnerId);var h=Nerve.getFieldSchemaInfo(c.Membership.FieldSchema);this.propertyName=h.Attributes.SourceFieldName||h.Name}return c.prototype.add=function(a){return $.Deferred().resolve().promise()},c.prototype["delete"]=function(a){return Nerve.Debugger.throwError("not supported")},c.prototype.query=function(a){return Nerve.Debugger.throwError("not supported")},c.prototype.update=function(a){var b=a.uploadParameters;if(!b)return this.uploadAsComplexType();var c;return b.Delete?c=this.deleteImage():b.ImageFile?c=this.uploadFromImageFile(b.ImageFile):b.Url&&(c=this.createImageFromUrl(b.Url,b.Size)),c?c.then(function(a){var b=_.clone(a);return b.uploadParameters=null,b}):void 0},c.prototype.uploadAsComplexType=function(){var a=this,c=Nerve.convertToSourceData(this.image.getSnapshot(),b.ImageInfoMaster.Schema);delete c.uploadParameters;var d={};d[this.propertyName]=c;var e,f=this.image.Parent;if(f instanceof b.FormMaster)e=this.dataProvider.updateForm(f.Model.Id,d);else{if(!(f instanceof b.QuestionMaster||f instanceof Forms.Models.DescriptiveElementMaster))return Nerve.Debugger.throwError("not supported");var g=f;e=g.createUploadSyncJob(function(){return a.dataProvider.updateFormQuestion(g.Form.Model.Id,g.Model.Id,g.Model.Type,d)})}return e.then(function(b){return b&&b[a.propertyName]})},c.prototype.createImageFromUrl=function(c,d){var e=this,f={SourceUrl:c,Title:a.Utilities.Guid.newGuid(),Size:d},g=this.image.Parent;if(g instanceof b.FormMaster)return this.dataProvider.createFormImageFromUrl(g.Model.Id,this.propertyName,f);if(g instanceof b.QuestionMaster||g instanceof Forms.Models.DescriptiveElementMaster){var h=g;return h.createUploadSyncJob(function(){return e.dataProvider.createQuestionImageFromUrl(h.Form.Model.Id,h.Model.Id,f)})}return Nerve.Debugger.throwError("not supported")},c.prototype.uploadFromImageFile=function(c){var d=this,e={ImageBlob:c,ImageName:a.Utilities.Guid.newGuid(),ImageType:c.type},f=this.image.Parent;if(f instanceof b.FormMaster)return this.imageProvider.uploadFormImage(f.Model.Id,this.propertyName,e);if(f instanceof b.QuestionMaster||f instanceof Forms.Models.DescriptiveElementMaster){var g=f;return g.createUploadSyncJob(function(){return d.imageProvider.uploadQuestionImage(g.Form.Model.Id,g.Model.Id,d.propertyName,e)})}return Nerve.Debugger.throwError("not supported")},c.prototype.deleteImage=function(){var c,d=this,e=this.image.Parent;if(e instanceof b.FormMaster)c=this.imageProvider.deleteFormImage(e.Model.Id,this.propertyName);else{if(!(e instanceof b.QuestionMaster||e instanceof Forms.Models.DescriptiveElementMaster))return Nerve.Debugger.throwError("not supported");var f=e;c=f.createUploadSyncJob(function(){return d.imageProvider.deleteQuestionImage(f.Form.Model.Id,f.Model.Id,d.propertyName)})}return c.then(null,function(b){return b&&b.innerCode===a.DataProvider.ErrorCode.InnerCode.ImageNotFound?(a.Event.ErrorEventDeprecated.logData({errorName:"DeleteImageNotFoundError",errorInfo:{imageUrl:d.image.Model.ResourceUrl}}),$.Deferred().resolve().promise()):b}).then(function(){return{altText:null,contentType:null,fileIdentifier:null,height:null,imageFile:null,originalFileName:null,resourceId:null,resourceUrl:null,size:null,width:null}})},c}();b.ImageDataSource=c}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(){function b(b,c){this.permission=b,this.receiver=c,this.dataProvider=a.FormDataSource.getDataProviderByFormMaster(this.permission.Form)}return Object.defineProperty(b.prototype,"FormId",{get:function(){return this.permission.FormId},enumerable:!0,configurable:!0}),b.prototype.add=function(a){return this.dataProvider.createPermissionLink(this.FormId,a)},b.prototype["delete"]=function(a){return this.dataProvider.deletePermissionLink(this.FormId,a.principalId)},b.prototype.query=function(a){return Nerve.Debugger.throwError("No scenario to call this method currently.")},b.prototype.update=function(b,c){return c.Snapshot.type===a.PermissionType[a.PermissionType.OrgLink]||c.Snapshot.type===a.PermissionType[a.PermissionType.Link]?this.dataProvider.createPermissionLink(this.FormId,{permissionSet:c.Snapshot.permissionSet,type:c.Snapshot.type}):Nerve.Debugger.throwError("No scenario to call this method currently.")},b}();a.PermissionDataSource=b}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(){function b(b,c){this.permissionToken=b,this.receiver=c,this.dataProvider=a.FormDataSource.getDataProviderByFormMaster(this.permissionToken.Form)}return Object.defineProperty(b.prototype,"FormId",{get:function(){return this.permissionToken.FormId},enumerable:!0,configurable:!0}),b.prototype.add=function(a){return this.dataProvider.createPermissionToken(this.FormId,a)},b.prototype["delete"]=function(a){return this.dataProvider.deletePermissionToken(this.FormId,a.principalId)},b.prototype.query=function(a){return Nerve.Debugger.throwError("No scenario to call this method currently.")},b.prototype.update=function(a,b){return Nerve.Debugger.throwError("No scenario to call this method currently.")},b}();a.PermissionTokenDataSource=b}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=function(){
function c(a,c){this.question=a,this.receiver=c,this.dataProvider=b.FormDataSource.getDataProviderByFormMaster(this.question.Form)}return Object.defineProperty(c.prototype,"FormId",{get:function(){return this.question.Form.Model.Id},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"QuestionId",{get:function(){return this.question.Model.Id},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"QuestionType",{get:function(){return this.question.Model.Type},enumerable:!0,configurable:!0}),c.prototype.add=function(a){var c=this;if(this.question.Form.SyncContext===b.FormSyncContext.DesignTimeForm){var d=this.question.ParentQuestionMaster;return d?d.Synchronizer.existingInDataSource().then(function(){return c.addInternally(a)}):this.addInternally(a)}Nerve.Debugger.throwError("Trying to create a question without design type.")},c.prototype["delete"]=function(c){var d=this;this.question.Form.SyncContext!==b.FormSyncContext.DesignTimeForm&&Nerve.Debugger.throwError("Trying to delete a question without design type.");var e=this.question.ParentQuestionMaster;if(e&&e.Deleted)return $.Deferred().resolve().promise();var f=this.question.SubQuestionMasters.map(function(a){return a.Synchronizer.flush()});return $.when.apply($,f).then(function(){return d.question.createSyncJob(function(){return d.dataProvider.deleteFormQuestion(d.FormId,c.id,d.QuestionType)})}).then(null,function(b){return b&&b.innerCode===a.DataProvider.ErrorCode.InnerCode.CDBColumnNotFound?$.Deferred().resolve().promise():b})},c.prototype.query=function(a){var b=this;return Nerve.Debugger.throwError("No scenario to call this method currently."),this.question.createSyncJob(function(){return b.dataProvider.getFormQuestion(b.FormId,b.QuestionId,a)})},c.prototype.update=function(c,d){var e=this;if(this.question.Form.SyncContext!==b.FormSyncContext.DesignTimeForm)return $.Deferred().resolve().promise();if("id"in c){var f=c.id,g=d.ValuesBefore.id;a.Event.ErrorEventDeprecated.logData({errorName:"DataSourceUpdatingQuestionId",errorInfo:{newId:f,oldId:g}})}if(null===c.allowMultipleValues)try{throw Error("allowMultipleValues null error")}catch(h){a.Event.ErrorEventDeprecated.logData({errorName:"DataSourceUpdatingQuestionNullAllowMultipleValues",errorInfo:{stack:h.stack}})}return this.question.createUploadSyncJob(function(){return e.dataProvider.updateFormQuestion(e.FormId,e.QuestionId,e.QuestionType,c)})},c.prototype.addInternally=function(b){var c=this,d=this.question.createSyncJob(function(){return c.dataProvider.createFormQuestion(c.FormId,b)});return d.done(function(b){"id"in b&&b.id!==c.QuestionId&&a.Event.ErrorEventDeprecated.logData({errorName:"ChangedIdFromServerSide",errorInfo:{newId:b.id,oldId:c.QuestionId,formId:c.FormId}})}),d},c}();b.QuestionDataSource=c}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c="0001-01-01T00:00:00Z",d=function(){function d(a,c){this.response=a,this.receiver=c,this.dataProvider=b.FormDataSource.getDataProviderByFormMaster(this.response.Form)}return Object.defineProperty(d.prototype,"FormId",{get:function(){return this.response.FormId},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"ResponseId",{get:function(){return this.response.ResponseId},enumerable:!0,configurable:!0}),d.submitResponse=function(c,d){var e=_.map(d.Answers,function(a){return{questionId:a.QuestionId,answer1:a.Answer}}),f={answers:JSON.stringify(e),startDate:d.StartDate instanceof Date?d.StartDate.toISOString():"",submitDate:d.SubmitDate instanceof Date?d.SubmitDate.toISOString():""};return a.Flighting.Flight.isEnabled(a.Flighting.Flights.EmailReceipt)&&(f.emailReceiptConsent=d.EmailReceiptConsent),f.submitLanguage=d.SubmitLanguage,d.Responder&&(f.responder=d.Responder,f.responderName=d.ResponderName),this.logResponseSubmittedEventForQti(c),b.FormDataSource.getDataProviderByFormMaster(c).submitFormResponse(c.Model.Id,f)},d.getResponses=function(a,c,e){return b.FormDataSource.getDataProviderByFormMaster(a).getFormResponses(a.Model.Id,null,c,e).then(function(a){return a.map(d.toClientPayload)})},d.getRuntimeResponses=function(a){return b.FormDataSource.getDataProviderByFormMaster(a).getRuntimeResponses(a.Model.Id).then(function(a){return a.map(d.toClientPayload)})},d.deleteAllResponses=function(a){return b.FormDataSource.getDataProviderByFormMaster(a).deleteFormResponses(a.Model.Id)},d.getReleasedResponsesByResponder=function(a,e){return b.FormDataSource.getDataProviderByFormMaster(a).getRuntimeResponses(a.Model.Id,e).then(function(a){return a.filter(function(a){return a.releaseDate!==c}).map(d.toClientPayload)})},d.getRuntimeResponse=function(a,c){return b.FormDataSource.getDataProviderByFormMaster(a).getRuntimeResponse(a.Model.Id,c).then(d.toClientPayload)},d.deleteResponses=function(a,c){var d=b.FormDataSource.getDataProviderByFormId(a);return $.when.apply($,c.map(function(b){return d.deleteFormResponse(a,b)}))},d.toClientPayload=function(a){var d=Nerve.convertFromSourceData(a,b.ResponseMaster.Schema);void 0!==d.StartDateAsString&&(d.StartDate=new Date(d.StartDateAsString)),void 0!==d.SubmitDateAsString&&(d.SubmitDate=new Date(d.SubmitDateAsString)),void 0!==d.ReleaseDateAsString&&(null===d.ReleaseDateAsString?d.ReleaseDate=new Date(c):d.ReleaseDate=new Date(d.ReleaseDateAsString));var e=[];if(d.AnswersAsString&&(e=JSON.parse(d.AnswersAsString).map(function(a){return{QuestionId:a.questionId,Answer:a.answer1}}),d.Answers=e),d.Comments){var f={},g=[],h="___";_.forEach(d.Comments,function(a){var b=a.QuestionId||h;f[b]&&g.push(f[b]),f[b]=a}),d.Comments=_.difference(d.Comments,g)}if(d.Comments){var i={};e.forEach(function(a){return i[a.QuestionId]=a}),_.forEach(d.Comments,function(a){var b=a.QuestionId;if(b){var c=i[b];c||(c={QuestionId:b,Answer:null},e.push(c),i[b]=c),c.Feedback=a.Feedback,c.Score=a.Score}else d.Feedback=a.Feedback,d.TotalScore=a.Score})}return d},d.prototype.add=function(a){return Nerve.Debugger.throwError("No scenario to call this method currently.")},d.prototype["delete"]=function(a){return this.dataProvider.deleteFormResponse(this.FormId,a.id)},d.prototype.query=function(a){return Nerve.Debugger.throwError("No scenario to call this method currently.")},d.prototype.update=function(a,c){var d=a.releaseDate,e=this.response.Form.SyncContext;return e!==b.FormSyncContext.DesignTimeForm&&e!==b.FormSyncContext.AnalysisTimeForm?$.Deferred().promise():void 0!==d?(this.logPostScoreEventForQti(),this.dataProvider.setResponseReleaseDate(this.FormId,this.ResponseId,d)):$.Deferred().resolve().promise()},d.isQtiForm=function(a){return null!=a&&a.startsWith("qti_")?!0:!1},d.logResponseSubmittedEventForQti=function(c){if(c.isFieldReady(b.FormMaster.Schema.TrackingId)){var d=c.Model.TrackingId;this.isQtiForm(d)&&a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.ResponsePage.Form.SubmitQtiResponse,extraData:{FormId:c.Model.Id,LorId:c.Model.TrackingId}})}},d.prototype.logPostScoreEventForQti=function(){var c=this.response.Form;if(c.isFieldReady(b.FormMaster.Schema.TrackingId)){var e=c.Model.TrackingId;d.isQtiForm(e)&&a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.PostQtiGrade,extraData:{FormId:c.Model.Id,LorId:c.Model.TrackingId}})}},d}();b.ResponseDataSource=d}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=function(){function b(a,b){void 0===a&&(a=1e3),void 0===b&&(b=5e3);var c=this;this.maxRetryTimesForUpdate=Number.MAX_VALUE,null==a&&(a=1e3),null==b&&(b=5e3),this.fast=a,this.slow=b,this.updateTrigger=function(){return c.clearUpdateSchedule().resolve()}}return b.prototype.scheduleUpdate=function(){if(this.deferred)throw Error("Calling schedule() before the previous one is resolved.");return this.deferred=$.Deferred(),this.updateFastTimer=window.setTimeout(this.updateTrigger,this.fast),this.updateSlowTimer=window.setTimeout(this.updateTrigger,this.slow),this.deferred.promise()},b.prototype.postponeUpdate=function(){window.clearTimeout(this.updateFastTimer),this.updateFastTimer=window.setTimeout(this.updateTrigger,this.fast)},b.prototype.cancelUpdate=function(){this.clearUpdateSchedule().reject()},b.prototype.setMaxRetryTimesForUpdate=function(a){this.maxRetryTimesForUpdate=a},b.prototype.clearUpdateSchedule=function(){window.clearTimeout(this.updateFastTimer),this.updateFastTimer=void 0,window.clearTimeout(this.updateSlowTimer),this.updateSlowTimer=void 0;var a=this.deferred;return this.deferred=void 0,a},b.prototype.retryForCreation=function(b){return 3>b?a.Utilities.Promise.getResolvedPromise():a.Utilities.Promise.getRejectedPromise()},b.prototype.retryForUpdate=function(b){var c=this;if(b>=this.maxRetryTimesForUpdate)return a.Utilities.Promise.getRejectedPromise();var g=e;f>b&&(g=d*Math.pow(2,b)),this.updateRetryTimer=window.setTimeout(function(){c.updateRetryTimer=void 0,h.resolve()},g);var h=$.Deferred();return h.promise()},b.prototype.cancelRetryForUpdate=function(){window.clearTimeout(this.updateRetryTimer),this.updateRetryTimer=void 0},b}();b.Scheduler=c;var d=2500,e=6e5,f=Math.log(e/d)/Math.log(2)}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){function b(a,c){if(null==a)return null;if(Array.isArray(a)){if(a.length){var d=c[0];return a.map(function(a){return b(a,d)})}return[]}var e={},f=0;return Nerve.getSubFieldSchemas(c).forEach(function(c){var d=Nerve.getFieldSchemaInfo(c),g=d.Attributes.SourceFieldName||d.Name,h=a[g];d.IsLeaf||(h=b(h,c)),null!=h&&(++f,e[g]=h)}),f>0?e:null}var c=function(){function a(a,b,c){this.master=a,this.targetField=b,this.bindedFields=c.FieldSchemas,this.bind()}return a.prototype.serialize=function(){var a=this.master.getSnapshot(this.bindedFields),c=this.master.Schema,d={};this.bindedFields.forEach(function(b){var c=Nerve.getFieldSchemaInfo(b).Name;d[c]=Nerve.convertToSourceData(a[c],b)});var e=b(d,c),f=e?JSON.stringify(e):null,g=Nerve.getFieldSchemaInfo(this.targetField).Name;this.master.Model[g]=f},a.prototype.deserialize=function(){var a=Nerve.getFieldSchemaInfo(this.targetField).Name,b=this.master.Model[a],c=b?JSON.parse(b):{},d={};this.bindedFields.forEach(function(a){var b=Nerve.getFieldSchemaInfo(a).Name;d[b]=Nerve.convertFromSourceData(c[b],a)}),this.master.setData(d,this.bindedFields)},a.prototype.bind=function(){var a=this,b=Nerve.getFieldSchemaInfo(this.targetField).Name;this.master.addRule({Name:"Deserialize - "+b,InterestedFields:[this.targetField],onChange:function(b){b.BeingDeleted||a.deserialize()}}),this.master.addRule({Name:"Serialize - "+b,InterestedFields:this.bindedFields,onChange:function(b){b.BeingDeleted||a.serialize()}})},a}();a.FieldBinder=c}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=function(){function b(a){this.fieldSchemas=a.concat(),this.fieldNames=a.map(function(a){return Nerve.getFieldSchemaInfo(a).Name})}return Object.defineProperty(b.prototype,"FieldSchemas",{get:function(){return this.fieldSchemas.concat()},enumerable:!0,configurable:!0}),b.prototype.covers=function(b){return a.Utilities.Type.isString(b)?_.contains(this.fieldNames,b):_.contains(this.fieldSchemas,b)},b}();b.FieldSet=c}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return e(a,!0)}function e(b,d){if(d&&(b.SoftDeleted=b.SoftDeleted),b.Id)return c.exportConverter(m.getDesignFormMaster(b));var e=s.FieldsForCreatingForm.map(Nerve.getFieldSchemaInfo).map(function(a){return a.Name});if(b=_.pick(b,e),d?(b.OwnerId=b.OwnerId||a.EnvironmentSettings.GroupId,b.OwnerTenantId=b.OwnerTenantId||a.EnvironmentSettings.TenantId||OfficeFormServerInfo.userInfo.TenantId):(b.OwnerId=b.OwnerId||OfficeFormServerInfo.userInfo.UserId,b.OwnerTenantId=b.OwnerTenantId||OfficeFormServerInfo.userInfo.TenantId),!b.OwnerId||!b.OwnerTenantId)throw new Error("Form OwnerId or OwnerTenantId cannot be null!");return c.exportConverter(m.createNewFormMaster(b,d?"Group":"User"))}function f(b){var d=a.Utilities.FormId.decodeFormId(b);return new c.FormMaster(o.ResponseTimeForm,{InitialData:{Id:b,OwnerId:d.OwnerId,OwnerTenantId:d.OrgId,TableId:d.TableId},ExistingInDataSource:!0},d.IsGroupOwner)}function g(b){var d=a.Utilities.FormId.decodeFormId(b);return new c.FormMaster(o.ResponseDetailTimeForm,{InitialData:{Id:b,OwnerId:d.OwnerId,OwnerTenantId:d.OrgId,TableId:d.TableId},ExistingInDataSource:!0},d.IsGroupOwner)}function h(b){var d=a.Utilities.FormId.decodeFormId(b);return new c.FormMaster(o.SharedTimeForm,{InitialData:{Id:b,OwnerId:d.OwnerId,OwnerTenantId:d.OrgId,TableId:d.TableId},ExistingInDataSource:!0},d.IsGroupOwner)}function i(b){var d=a.Utilities.FormId.decodeFormId(b);return new c.FormMaster(o.AnalysisTimeForm,{InitialData:{Id:b,OwnerId:d.OwnerId,OwnerTenantId:d.OrgId,TableId:d.TableId},ExistingInDataSource:!0},d.IsGroupOwner)}function j(a){return new c.FormMaster(o.LocalForm,{InitialData:a},!1)}var k,l=Nerve.Spec,m=Forms.Models.FormManager,n={Id:l.string({IsSourceGenerated:!0,IsKeyField:!0,SourceFieldName:"id"}),Description:l.string({SourceFieldName:"description"}),Background:l.fromMasterClass(function(){return c.ImageInfoMaster},{SourceFieldName:"background"}),Category:l.string({SourceFieldName:"category"}),Logo:l.fromMasterClass(function(){return c.ImageInfoMaster},{SourceFieldName:"logo"}),ModifiedDate:l.string({SourceFieldName:"modifiedDate"}),OtherInfo:l.string({SourceFieldName:"otherInfo"}),OwnerId:l.string({SourceFieldName:"ownerId"}),OwnerTenantId:l.string({SourceFieldName:"ownerTenantId"}),RowCount:l.number({SourceFieldName:"rowCount"}),SharedBy:l.string({SourceFieldName:"sharedBy"}),SharedFormOwnerName:l.string({SourceFieldName:"ownerDisplayName"}),SharedDate:l.string({SourceFieldName:"dateTimeShared"}),TableId:l.string({IsSourceGenerated:!0,SourceFieldName:"tableId"}),Title:l.string({SourceFieldName:"title"}),Version:l.string({SourceFieldName:"version"}),XlWorkbookId:l.string({SourceFieldName:"xlWorkbookId"}),XlExportingTag:l.string({SourceFieldName:"xlExportingTag"}),XlFileUnsynced:l["boolean"]({SourceFieldName:"xlFileUnSynced"}),Permissions:l.collectionOf(function(){return c.PermissionMaster},{SourceFieldName:"permissions"}),PermissionTokens:l.collectionOf(function(){return c.PermissionTokenMaster},{SourceFieldName:"permissionTokens"}),Questions:l.collectionOf(function(){return c.QuestionMaster},{SourceFieldName:"questions"}),DescriptiveElements:l.collectionOf(function(){return Forms.Models.DescriptiveElementMaster},{SourceFieldName:"descriptiveQuestions"}),MovingToRecycleBin:l["boolean"]({IsLocalField:!0}),SoftDeleted:l.enumeration(function(){return q},{SourceFieldName:"softDeleted",IsNumberTypeInDataSource:!0}),TrackingId:l.string({SourceFieldName:"trackingId"}),ThankYouMessage:l.string({SourceFieldName:"thankYouMessage"}),EmailReceiptEnabled:l["boolean"]({SourceFieldName:"emailReceiptEnabled"}),Flags:l.number({SourceFieldName:"flags"}),Type:l.reference({SourceFieldName:"type"}),OnlineSafetyLevel:l.number({SourceFieldName:"onlineSafetyLevel"}),BufferResponses:l.collectionOf(l.reference({},function(a){return a.Id.toString()}),{IsLocalField:!0}),CoAuthMessage:l.string({IsLocalField:!0}),DeleteCollaborationPermission:l["boolean"]({IsLocalField:!0}),HasValidBranching:l["boolean"]({IsLocalField:!0}),HasQuestionMedia:l["boolean"]({IsLocalField:!0}),Modified:l.string({IsLocalField:!0}),PredefinedResponses:l.collectionOf({Id:l.number({IsKeyField:!0}),Answers:l.collectionOf({QuestionId:l.string(),Answer:l.reference()})},{IsLocalField:!0}),PrimaryCustomizedThemeColor:l.string({IsLocalField:!0}),QuizQuestionsCount:l.number({IsLocalField:!0}),SecondaryCustomizedThemeColor:l.string({IsLocalField:!0}),Responses:l.collectionOf(l.reference({},function(a){return a.Id.toString()}),{IsLocalField:!0}),ResponsesCount:l.number({IsLocalField:!0}),XlExportingLocalTag:l.string({IsLocalField:!0}),SerializedSettings:l.string({SourceFieldName:"settings"}),Settings:l.fromMasterClass(function(){return c.FormSettingsMaster},{IsLocalField:!0}),SerializedPredefinedResponses:l.string({SourceFieldName:"predefinedResponses"}),TertiaryCustomizedThemeColor:l.string({IsLocalField:!0}),Theme:l.fromMasterClass(function(){return Forms.Models.FormThemeMaster},{IsLocalField:!0}),ResponseModels:l.collectionOf(function(){return c.ResponseMaster},{IsLocalField:!0}),IntegratedSavingState:l.reference({IsLocalField:!0}),SavingState:l.reference({IsLocalField:!0}),LogoInfo:l.fromMasterClass(function(){return c.ImageSettingsMaster},{IsLocalField:!0}),CreatedFromOneDrive:l["boolean"]({IsLocalField:!0}),TransferInProgress:l["boolean"]({IsLocalField:!0}),DefaultLanguage:l.string({SourceFieldName:"defaultLanguage"}),LocaleList:l.collectionOf(function(){return Forms.Models.LocaleInfoMaster},{SourceFieldName:"localeList"}),LocalizedResources:l.collectionOf(function(){return Forms.Models.FormLocalizedItemMaster},{SourceFieldName:"localizedResources"})};!function(a){a[a.None=0]="None",a[a.MoveInProgress=1]="MoveInProgress",a[a.CvsScanAllowed=2]="CvsScanAllowed"}(k=c.FormFlags||(c.FormFlags={}));var o;!function(a){a[a.DesignTimeForm=0]="DesignTimeForm",a[a.ResponseTimeForm=1]="ResponseTimeForm",a[a.SharedTimeForm=2]="SharedTimeForm",a[a.LocalForm=3]="LocalForm",a[a.AnalysisTimeForm=4]="AnalysisTimeForm",a[a.ResponseDetailTimeForm=5]="ResponseDetailTimeForm"}(o=c.FormSyncContext||(c.FormSyncContext={}));var p;!function(a){a[a.ConnectionStateChanged=0]="ConnectionStateChanged",a[a.UserAction=1]="UserAction",a[a.UserConnect=2]="UserConnect",a[a.UserDisconnect=3]="UserDisconnect"}(p=c.FormChangeActionType||(c.FormChangeActionType={}));var q;!function(a){a[a.Normal=0]="Normal",a[a.SoftDeleted=1]="SoftDeleted"}(q=c.FormDeletedState||(c.FormDeletedState={})),c.createGroupDesignFormMaster=d,c.createDesignFormMaster=e,c.createResponseFormMaster=f,c.createResponseDetailFormMaster=g,c.createSharedFormMaster=h,c.createAnalysisFormMaster=i,c.createLocalFormMaster=j;var r=function(a,b){return a.SyncBlocker.then(function(){return new c.FormDataSource(a,b)})},s=function(d){function f(b,e,g,h){var i=this,j=$.Deferred();return e=f.normalizeInitialData(e),i=d.call(this,e,{Scheduler:new c.Scheduler,MasterReady:j.promise()})||this,i.syncBlocker=h||j,i.isGroupForm=g,i.currentQuestionListDownloadJob=$.Deferred().resolve().promise(),i.questionSyncJobs=[],i.syncContext=b,i.formElementManager=c.exportConverter(new Forms.Models.FormElementManager(c.exportConverter(i))),i.initializeElementOrderRule(),i.initializeOtherInfoBinder(e),i.initializeSavingStateIntegration(),i.initializeModifiedDate(e),i.initializeResponseCount(),c.bindImageSettings(i,f.Schema.Logo,f.Schema.LogoInfo),i.observe(function(){i.ensureFieldsReady([c.FormMaster.Schema.XlExportingTag]).done(function(){return i.Model.XlExportingLocalTag=i.Model.XlExportingTag.toLocaleLowerCase()})},[c.FormMaster.Schema.XlExportingTag]),f.Rules.forEach(function(a){return i.addRule(a)}),i.coAuthUserStateChangeCallbacks=new a.Utilities.Process.CallbackManager,j.resolve(),i}return __extends(f,d),Object.defineProperty(f,"ExportingProcessingStatusString",{get:function(){return"exporting"},enumerable:!0,configurable:!0}),Object.defineProperty(f,"ExportingFailedStatusString",{get:function(){return"failed"},enumerable:!0,configurable:!0}),Object.defineProperty(f,"ExportingTimeoutStatusString",{get:function(){return"timeout"},enumerable:!0,configurable:!0}),Object.defineProperty(f,"ReexportToExcelMaxTimeForTimeout",{get:function(){return 3e5},enumerable:!0,configurable:!0}),f.getSourceFields=function(a){var b=f.Schema,c=[];return a.forEach(function(a){switch(a){case"Settings":case b.Settings:c.push(b.SerializedSettings);break;case"Modified":case b.Modified:c.push(b.ModifiedDate);break;case"ResponsesCount":case b.ResponsesCount:c.push(b.RowCount);break;case"PredefinedResponses":case b.PredefinedResponses:c.push(b.SerializedPredefinedResponses);break;case"Theme":case b.Theme:c.push(b.Background,b.OtherInfo);break;default:if(f.OtherInfoFieldSet.covers(a)){c.push(b.OtherInfo);break}c.push(a)}}),_.uniq(c)},Object.defineProperty(f,"FieldsForCreatingForm",{get:function(){return f.FieldsToCopy.concat([f.Schema.OwnerId,f.Schema.OwnerTenantId])},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"SyncBlocker",{get:function(){return this.syncBlocker},enumerable:!0,configurable:!0}),f.prototype.createExportFile=function(){return c.FormDataSource.createExportFile(this)},f.prototype.downloadExcelFile=function(a,b){return c.FormDataSource.downloadExcelFile(this,a,b)},Object.defineProperty(f.prototype,"IsGroupForm",{get:function(){return this.isGroupForm},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"IsAssignmentForm",{get:function(){return this.isFieldReady(this.Schema.Category)?"assignments"===this.Model.Category:!1},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"SyncContext",{get:function(){return this.syncContext},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"FormElementManager",{get:function(){return this.formElementManager},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"SettingMaster",{get:function(){return Nerve.getObjectMasterFromModel(this.Model.Settings)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"ThemeMaster",{get:function(){return Nerve.getObjectMasterFromModel(this.Model.Theme)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"QRCodeImage",{get:function(){return this.qrCodeImage||void 0},set:function(a){this.qrCodeImage=a},enumerable:!0,configurable:!0}),f.prototype.getRelatedSourceFields=function(a){return f.getSourceFields(a)},f.prototype.existingOnServerSide=function(){return this.Synchronizer.existingInDataSource()},f.prototype.getImageMaster=function(a){return c.getImageInfoMaster(this.getModelByFieldSchema(a))},f.prototype.getImageSettingsMaster=function(a){return c.getImageSettingsMaster(this.getModelByFieldSchema(a))},f.prototype.getQuestionById=function(a){return this.formElementManager.getQuestionById(a)},f.prototype.getElementById=function(a){return this.formElementManager.getElementMasterById(a)},f.prototype.getDescriptiveElementMasterById=function(a){return this.formElementManager.getDescriptiveElementMasterById(a)},f.prototype.insertElementAfter=function(a,b,c){return this.formElementManager.insertElementAfter(a,b,c)},f.prototype.appendElement=function(a,b){return this.formElementManager.appendElement(a,b)},f.prototype.deleteFormQuestion=function(a){return this.formElementManager.deleteFormQuestion(c.exportConverter(a))},f.prototype.duplicateElement=function(a){return this.formElementManager.duplicateElement(a)},f.prototype.duplicateSection=function(a){return this.formElementManager.duplicateSectionAndSubElements(a)},f.prototype.deleteSectionAndSubElements=function(a){this.formElementManager.deleteSectionAndSubElements(a)},f.prototype.moveElementUp=function(a){this.formElementManager.moveElementUp(a)},f.prototype.moveElementDown=function(a){this.formElementManager.moveElementDown(a)},f.prototype.moveSectionTo=function(a,b){this.formElementManager.moveSectionTo(a,b)},f.prototype.findQuestionsInSection=function(a,b){return this.formElementManager.findQuestionsInSection(a,b)},f.prototype.getQuestionSyncBlocker=function(b){return this.questionSyncJobs.push(a.Utilities.Promise.always(b)),this.currentQuestionListDownloadJob},f.prototype.getReleasedResponsesByResponder=function(a){var b=this;return a&&!this.SettingMaster.Model.IsAnonymous?c.ResponseDataSource.getReleasedResponsesByResponder(this,a).then(function(a){return b.normalizeResponses(a)}):$.Deferred().resolve().promise()},f.prototype.getRuntimeResponse=function(a){var b=this;return a?c.ResponseDataSource.getRuntimeResponse(this,a).then(function(a){return b.normalizeResponse(a)}):$.Deferred().resolve().promise()},f.prototype.duplicateForm=function(a,b){var c=this;return this.ensureFieldsReady(f.FieldsToCopy).then(function(){var d=_.clone(c.getSnapshotToCopy());return d.OwnerId=a.OwnerId,d.OwnerTenantId=a.OwnerTenantId,d.Title=b,d.Settings=_.clone(d.Settings),d.Settings.AllowCopy=!1,d.Settings.ShareToken=null,e(d,a.IsGroupForm)})},f.prototype.ensureCreationDone=function(){var a=this,b=this.getImageMaster(f.Schema.Background),c=this.getImageMaster(f.Schema.Logo);return $.when.apply($,[b.Synchronizer.flush(),c.Synchronizer.flush().then(function(){return a.Synchronizer.flush()})].concat(this.formElementManager.AllElementMasters.map(function(a){return a.ensureCreationDone()})))},f.prototype.ensureReadyToDesign=function(){return this.ensureFieldsReady(f.FieldsToDesign)},f.prototype.ensureReadyToResponse=function(){return this.ensureFieldsReady(f.FieldsToResponse)},f.prototype.ensureReadyToShare=function(){var a=f.Schema,b=[a.Title,a.ModifiedDate,a.OwnerId,a.OwnerTenantId,a.Description,a.Questions,a.DescriptiveElements,a.Settings,a.Theme,a.Logo,a.LogoInfo,a.Background,a.XlWorkbookId,a.Category,a.Type];return this.ensureFieldsReady(b)},f.prototype.ensureReadyForMruCard=function(){var a=f.Schema;return this.ensureFieldsReady([a.Title,a.ModifiedDate,a.Settings,a.XlWorkbookId,a.OwnerId,a.OwnerTenantId,a.Category,a.OtherInfo,a.Theme,a.RowCount])},f.prototype.getDefaultResponse=function(){var b={};return a.Utilities.Flight.isDarkFunctionalitiesEnabled()&&_.forEach(this.Model.Questions,function(a){return b[a.Id]=a.DefaultValue}),b},f.prototype.hasSection=function(){return this.FormElementManager.SectionMasters.length>0},f.prototype.moveToRecycleBin=function(){var a=this;return this.bulkEdit(function(){a.Model.MovingToRecycleBin=!0,a.Model.SoftDeleted=c.FormDeletedState.SoftDeleted}),this.Synchronizer.flush().done(function(){a.Model.MovingToRecycleBin=!1})},f.prototype.isNotSoftDeleted=function(){return this.isFieldReady(this.Schema.SoftDeleted)?this.Model.SoftDeleted===c.FormDeletedState.Normal:!0},f.prototype.isSoftDeleted=function(){return this.isFieldReady(this.Schema.SoftDeleted)?this.Model.SoftDeleted===c.FormDeletedState.SoftDeleted:!1},f.prototype.reachedQuestionNumberLimitation=function(){return this.FormElementManager.QuestionMasters.length>=b.FormLimitation.QuestionNumber},f.prototype.syncFormResponses=function(){var b=this;return this.responsesQueryJob&&this.responsesQueryJob.state()===a.Utilities.Promise.State.Pending?this.responsesQueryJob:(this.responsesQueryJob=this.Synchronizer.existingInDataSource().then(function(){var a=[f.Schema.Questions];a.push(f.Schema.Settings);var d=b.ensureFieldsReady(a);return $.when(c.ResponseDataSource.getResponses(b),d).then(function(a){b.updatingResponsesFromServer=!0,b.bulkEdit(function(){b.Model.Responses=b.normalizeResponses(a),b.Synchronizer.onSourceDataReceived({rowCount:a.length})}),b.updatingResponsesFromServer=!1})}),this.responsesQueryJob)},f.prototype.syncFormResponsesByPaging=function(a,b){var c=this;return this.getFormResponsesByPaging(a,b).then(function(a){c.updatingResponsesFromServer=!0,c.Model.BufferResponses=a,c.updatingResponsesFromServer=!1})},f.prototype.getFormResponsesByPaging=function(a,b){var d=this,e=[f.Schema.Questions];e.push(f.Schema.Settings);var g=this.ensureFieldsReady(e),h=this.Synchronizer.existingInDataSource().then(function(){return c.ResponseDataSource.getResponses(d,a,b)});return $.when(h,g).then(function(a){return d.normalizeResponses(a)})},f.prototype.syncAnalysisTimeResponsesByPaging=function(a,b){var c=this;return this.getAnalysisTimeResponsesByPaging(a,b).then(function(a){c.updatingResponsesFromServer=!0,c.Model.BufferResponses=a,c.updatingResponsesFromServer=!1})},f.prototype.getAnalysisTimeResponsesByPaging=function(a,c){var d=this;return b.Model.FormDataSource.getDataProviderByFormMaster(this).getAnalysisTimeResponses(this.Model.Id,a,c).then(function(a){return d.normalizeResponses(a.map(b.Model.ResponseDataSource.toClientPayload))})},f.prototype.syncRuntimeResponses=function(){var a=this;return this.Synchronizer.existingInDataSource().then(function(){return c.ResponseDataSource.getRuntimeResponses(a)}).then(function(b){a.updatingResponsesFromServer=!0,a.bulkEdit(function(){return a.Model.Responses=a.normalizeResponses(b)}),a.updatingResponsesFromServer=!1})},f.prototype.getFormResponsesCountByAPICall=function(){var a=this;return this.Synchronizer.existingInDataSource().then(function(){return c.FormDataSource.getResponseCount(a)}).then(function(b){a.Model.ResponsesCount=b})},f.prototype.refreshFormResponsesCount=function(){return this.Synchronizer.query([f.Schema.ResponsesCount])},f.prototype.submitResponse=function(b){var d=this;if("pending"===this.syncBlocker.state())return $.Deferred().resolve();var e=0,f=0;return b=_.clone(b),b.Answers=_.map(b.Answers,function(a){var b=d.getQuestionById(a.QuestionId);return b&&b.Model&&(a=_.clone(a),a.Answer=b.serializeAnswer(a.Answer),b.Model.Type===c.QuestionType.TextField&&(e++,a.Answer&&(f+=a.Answer.length))),a}),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.ResponsePage.Form.TextQuestionInfoOfSubmit,extraData:{textQuestionCount:e,textQuestionAnswerTotalLength:f,isQuiz:this.SettingMaster.Model.IsQuizMode}}),this.Synchronizer.existingInDataSource().then(function(){return c.ResponseDataSource.submitResponse(d,b)})},f.prototype.deleteAllResponses=function(){var a=this;return this.Synchronizer.existingInDataSource().then(function(){return c.ResponseDataSource.deleteAllResponses(a)}).then(function(){var b={};b.Responses=[],b.ResponsesCount=0,a.updatingResponsesFromServer=!0,a.setData(b),a.updatingResponsesFromServer=!1})},f.prototype.deleteBufferResponse=function(a){var b=this;return this.Synchronizer.existingInDataSource().then(function(){return c.ResponseDataSource.deleteResponses(b.Model.Id,[a])}).then(function(){var c=Nerve.getCollectionMasterFromModel(b.Model.BufferResponses),d=c.getItemWithKeyFields({Id:a});d&&b.bulkEdit(function(){c.itemsDeletedInSource([d]),--b.Model.ResponsesCount})})},f.prototype.setResponseComment=function(a,b){var c=this.ensureResponseMasterById(a);c.Model.Feedback=b,this.postFormGradingChange()},f.prototype.setAnswerGrading=function(a,b,c,d){var e=this.ensureResponseMasterById(a);e.setAnswerGrading(b,c,d),this.postFormGradingChange()},f.prototype.setReleaseDate=function(a,b){var c=this.ensureResponseMasterById(a);c.Model.ReleaseDate=b,this.postFormGradingChange()},f.prototype.resetBranchInfo=function(){this.FormElementManager.QuestionMasters.forEach(function(a){return a.resetBranchInfo()})},f.prototype.startReceivingNotifications=function(a){var b=this,c=f.Schema,d=[c.Id,c.OwnerId,c.OwnerTenantId,c.TableId];return this.ensureFieldsReady(d).done(function(){a&&b.coAuthUserStateChangeCallbacks.register(a),b.receivingNotifications||(b.receivingNotifications=!0,b.startReceivingNotificationsInternal())})},f.prototype.stopReceivingNotifications=function(b){var c=this;this.existingOnServerSide().done(function(){var d=a.DataProvider.ProviderManager.getInstance().CurrentNotificationProvider;d.close(c.Model.Id),c.receivingNotifications=!1,c.coAuthUserStateChangeCallbacks.clear(),c.responsesQueryJob=null,b()})},f.prototype.formOwnedByMe=function(){return this.Model.OwnerId&&this.Model.OwnerId===OfficeFormServerInfo.userInfo.UserId},f.prototype.appendPermission=function(a){for(var b=this.Model.Permissions,d=function(d){if(b[d].Type===c.PermissionType.OrgLink||b[d].Type===c.PermissionType.Link){var e=b[d],f=c.getPermissionMaster(e),g=f.Model.Type;return f.Model.Type=a,{value:f.Synchronizer.flush().then(function(){return e.PrincipalId}).fail(function(){return f.Model.Type=g})}}},e=0;e<b.length;e++){var f=d(e);if("object"==typeof f)return f.value}var g=Nerve.Collection.addItems(b,[c.createDefaultPermission(a)]),h=c.getPermissionMaster(g[0]);return h.Synchronizer.existingInDataSource().then(function(){
return h.Model.PrincipalId})},f.prototype.removeLinkPermission=function(){var a=this.getLinkPermissions();Nerve.Collection.deleteItems(this.Model.Permissions,a);var b=a.map(c.getPermissionMaster).map(function(a){return a.Synchronizer.deletedFromDataSource()});return $.when.apply($,b)},f.prototype.getPermissionToken=function(){var a=this;return this.Synchronizer.existingInDataSource().then(function(){var b=a.getLinkPermissions().map(c.getPermissionMaster);return 0!==b.length?b[0].Synchronizer.existingInDataSource().then(function(){return b[0].Model.PrincipalId}):null})},f.prototype.getSnapshotToCopy=function(){var a=this.getSnapshot(f.FieldsToCopy);return a.XlWorkbookId&&(a=_.clone(a),a.XlWorkbookId="WaitingForExport"),a},f.prototype.SetToExporting=function(){var a=this;this.ensureFieldsReady([c.FormMaster.Schema.XlExportingLocalTag]).done(function(){a.Model.XlExportingLocalTag=f.ExportingProcessingStatusString})},f.prototype.IsExporting=function(){var a,b=this,d=0;if(this.isFieldReady(c.FormMaster.Schema.XlExportingLocalTag)&&this.Model.XlExportingLocalTag&&this.Model.XlExportingLocalTag.indexOf(f.ExportingProcessingStatusString)>=0)try{var e=JSON.parse(this.Model.XlExportingLocalTag),g=Date.parse(e.starttime.toUpperCase()),h=new Date;d=h.getTime()-g,a=d<f.ReexportToExcelMaxTimeForTimeout}catch(i){a=!0}else a=!1;return a?this.exportingTimeout=this.exportingTimeout||window.setTimeout(function(){b.Model.XlExportingLocalTag=f.ExportingTimeoutStatusString},f.ReexportToExcelMaxTimeForTimeout-d):window.clearTimeout(this.exportingTimeout),a},f.prototype.IsExportingFailed=function(){return this.Model.XlExportingLocalTag.toLocaleLowerCase().indexOf(f.ExportingFailedStatusString)>=0?!0:!1},f.prototype.triggerShareAction=function(){if(a.Flighting.Flight.isEnabled(a.Flighting.Flights.EnableMsaContentValidation)&&!this.cvsRequestSent&&OfficeFormServerInfo.userInfo.IsMsa&&0==(this.Model.Flags&k.CvsScanAllowed)){this.cvsRequestSent=!0;var b=a.DataProvider.ProviderManager.getInstance().createDataProvider();b.postFormShareAction(this.Model.Id)}},f.prototype.createLocale=function(b){if(!a.Flighting.Flight.isEnabled(a.Flighting.Flights.MultiLingualMVP1))return"";var d=a.Utilities.Guid.newGuid().replace(/-/g,"").slice(0,16),e={localeId:d,localeName:b};return Nerve.Collection.addItems(this.Model.LocaleList,[e]),Forms.Models.createEmptyLocalizedResource(e,c.exportConverter(this)),d},f.prototype.deleteLocale=function(b){if(a.Flighting.Flight.isEnabled(a.Flighting.Flights.MultiLingualMVP1)){var d=Nerve.Collection.getItemWithKeyFields(this.Model.LocaleList,{localeId:b});d&&(Nerve.Collection.deleteItems(this.Model.LocaleList,[d]),Forms.Models.removeLocalizedResource(b,c.exportConverter(this)))}},f.prototype.getAllLocaleResources=function(){if(!a.Flighting.Flight.isEnabled(a.Flighting.Flights.MultiLingualMVP1))return $.Deferred().resolve().promise();var b=c.FormDataSource.getDataProviderByFormId(this.Model.Id),d=b.getAllLocaleResources(this.Model.Id);return d.then(function(a){return Forms.Models.parseLocalizedResources(a)})},f.prototype.getLocaleResouceById=function(b){return a.Flighting.Flight.isEnabled(a.Flighting.Flights.MultiLingualMVP1)?c.FormDataSource.getResoucesByLocale(this,b):$.Deferred().resolve().promise()},Object.defineProperty(f,"FieldsToCopy",{get:function(){var a=f.Schema,b=[a.Background,a.Description,a.Logo,a.LogoInfo,a.Questions,a.DescriptiveElements,a.Settings,a.SoftDeleted,a.Title,a.PrimaryCustomizedThemeColor,a.SecondaryCustomizedThemeColor,a.TertiaryCustomizedThemeColor,a.Theme,a.TrackingId,a.XlWorkbookId,a.ThankYouMessage,a.EmailReceiptEnabled,a.Type,a.DefaultLanguage];return b},enumerable:!0,configurable:!0}),Object.defineProperty(f,"FieldsToDesign",{get:function(){var a=f.Schema,b=[a.Title,a.ModifiedDate,a.OwnerId,a.OwnerTenantId,a.Description,a.Questions,a.DescriptiveElements,a.Permissions,a.PermissionTokens,a.ResponsesCount,a.Settings,a.Theme,a.Logo,a.LogoInfo,a.Background,a.XlWorkbookId,a.XlExportingTag,a.XlFileUnsynced,a.Category,a.TrackingId,a.PredefinedResponses,a.ThankYouMessage,a.EmailReceiptEnabled,a.Flags,a.OnlineSafetyLevel,a.Type,a.DefaultLanguage,a.LocaleList,a.LocalizedResources];return b},enumerable:!0,configurable:!0}),Object.defineProperty(f,"FieldsToResponse",{get:function(){var a=f.Schema,b=[a.Title,a.ModifiedDate,a.Description,a.Settings,a.Theme,a.Questions,a.DescriptiveElements,a.Logo,a.LogoInfo,a.Background,a.Category,a.PredefinedResponses,a.ThankYouMessage,a.EmailReceiptEnabled,a.Type,a.DefaultLanguage,a.LocaleList];return b},enumerable:!0,configurable:!0}),Object.defineProperty(f,"OtherInfoFieldSet",{get:function(){return f.otherInfoFieldSet||(f.otherInfoFieldSet=new c.FieldSet([f.Schema.PrimaryCustomizedThemeColor,f.Schema.SecondaryCustomizedThemeColor,f.Schema.TertiaryCustomizedThemeColor,f.Schema.Theme,f.Schema.LogoInfo,f.Schema.CreatedFromOneDrive])),f.otherInfoFieldSet},enumerable:!0,configurable:!0}),Object.defineProperty(f,"Rules",{get:function(){if(!f.rules){var a=f.Schema,d=Nerve.getSubFieldSchemas(a).filter(function(a){return!Nerve.getFieldSchemaInfo(a).Attributes.IsLocalField});f.rules=[{Name:"IntegrateSavingState",InterestedFields:[a.Background.SavingState,a.Logo.SavingState,a.SavingState],onChange:function(a){return a.Master.updateIntegratedSavingState()}},{Name:"Modified",InterestedFields:_.without(d,a.SoftDeleted),onChange:function(b){if(!b.BeingDeleted&&!_.contains(b.FieldSchemas,a.Modified)){var c=b.Master;if(_.contains(b.FieldSchemas,a.ModifiedDate))return void(c.Model.Modified=c.Model.ModifiedDate);if(c.isFieldReady(a.Modified)){var e=_.intersection(b.FieldSchemas,d).map(Nerve.getFieldSchemaInfo).map(function(a){return a.Name}).some(function(a){return a in b.OldValues});e&&(c.Model.Modified=(new Date).toISOString())}}}},{Name:"RowCount",InterestedFields:[a.RowCount],onChange:function(a){if(!a.BeingDeleted){var b=a.Master.Model;b.ResponsesCount=b.RowCount}}},{Name:"CollaboratedQuestionProperties",InterestedFields:[a.Questions,a.DescriptiveElements],onChange:function(a){var c=b.convertToArray(a.Master.getSnapshot().Questions),d=b.convertToArray(a.Master.getSnapshot().DescriptiveElements),e=a.Master.Model;e.HasValidBranching=c.some(function(a){return a.HasValidBranching}),e.HasQuestionMedia=c.some(function(a){return!(!a.ImageInfo.ResourceUrl&&!a.VideoInfo.Url)})||d.some(function(a){return!(!a.ImageInfo.ResourceUrl&&!a.VideoInfo.Url)}),e.QuizQuestionsCount=c.filter(function(a){return a.IsQuiz}).length}},{Name:"DeserializeSettings",InterestedFields:[a.SerializedSettings],onChange:function(a){if(!a.BeingDeleted){var b=a.Master.Model.SerializedSettings||"{}",c=JSON.parse(b);a.Master.setData({Settings:c})}}},{Name:"SerializeSettings",InterestedFields:[f.Schema.Settings],onChange:function(a){if(!a.BeingDeleted){var b=a.Master.Model;b.SerializedSettings=c.FormSettingsMaster.serialize(b.Settings)}}},{Name:"DeserializePredefinedResponses",InterestedFields:[a.SerializedPredefinedResponses],onChange:function(a){if(!a.BeingDeleted){var b=a.Master.Model.SerializedPredefinedResponses||"[]",c=JSON.parse(b);a.Master.setData({PredefinedResponses:c})}}},{Name:"SerializePredefinedResponses",InterestedFields:[f.Schema.PredefinedResponses],onChange:function(a){if(!a.BeingDeleted){var b=a.Master.Model;b.SerializedPredefinedResponses=f.serializePredefinedReponses(b.PredefinedResponses)}}},{Name:"DeleteResponseModels",InterestedFields:[a.Responses],onChange:function(a){var b=a.Master,d=b.Model.Responses,e=[],f=[];a.SubChanges.filter(function(a){return a.Master.Model===d}).forEach(function(a){return a.RemovedModels.forEach(function(a){var c=b.getResponseModelById(a.Id);c?e.push(c):f.push(a.Id)})});var g=Nerve.getCollectionMasterFromModel(b.Model.ResponseModels);b.updatingResponsesFromServer?g.itemsDeletedInSource(e):(g.deleteItems(e),c.deleteResponses(b,f))}},{Name:"ResponsesCount",InterestedFields:[a.ResponsesCount],onChange:function(b){var c=b.Master;c.isFieldReady(a.ResponsesCount)&&-1===c.Model.ResponsesCount&&(c.Model.ResponsesCount=null)}},{Name:"ResponseModel Change",InterestedFields:[a.ResponseModels],onChange:function(a){var b=a.Master,c=Nerve.getCollectionMasterFromModel(b.Model.ResponseModels),d=Nerve.getCollectionMasterFromModel(b.Model.Responses);a.SubChanges.filter(function(a){return a.Master===c}).forEach(function(a){a.SubChanges.forEach(function(a){var b=_.indexOf(d.Model,a.Master.Model);b>=0&&d.markAsChanged(b)})})}}]}return f.rules},enumerable:!0,configurable:!0}),f.normalizeInitialData=function(a){var b;return a.InitialData&&((a.InitialData.SerializedSettings||a.InitialData.Settings)&&(b=b||{},a.InitialData.SerializedSettings?b.Settings=JSON.parse(a.InitialData.SerializedSettings):b.SerializedSettings=c.FormSettingsMaster.serialize(a.InitialData.Settings)),(a.InitialData.SerializedPredefinedResponses||a.InitialData.PredefinedResponses)&&(b=b||{},a.InitialData.SerializedPredefinedResponses?b.PredefinedResponses=JSON.parse(a.InitialData.SerializedPredefinedResponses):b.SerializedPredefinedResponses=f.serializePredefinedReponses(a.InitialData.PredefinedResponses))),b&&(a=_.clone(a),a.InitialData=_.extend({},a.InitialData,b)),a},f.serializePredefinedReponses=function(a){return a&&a.length>0?JSON.stringify(a):null},f.prototype.initializeElementOrderRule=function(){var a=this;this.formElementManager.adjustElementOrders();var b=[f.Schema.Questions,f.Schema.DescriptiveElements];this.addRule({Name:"ElementOrder",InterestedFields:b,onChange:function(){return a.formElementManager.adjustElementOrders()}})},f.prototype.initializeSavingStateIntegration=function(){var a=this;c.keepSavingStateUpdated(this),this.questionsSavingState=c.SavingStateValues.Idle,this.responsesSavingState=c.SavingStateValues.Idle,this.descriptiveElementSavingState=c.SavingStateValues.Idle,this.fieldsReady([f.Schema.Questions]).done(function(){var b=Nerve.getCollectionMasterFromModel(a.Model.Questions);c.observeIntegratedSavingState(b,b.Schema[0].IntegratedSavingState,function(b){a.questionsSavingState=b,a.updateIntegratedSavingState()})}),this.fieldsReady([f.Schema.DescriptiveElements]).done(function(){var b=Nerve.getCollectionMasterFromModel(a.Model.DescriptiveElements);c.observeIntegratedSavingState(b,b.Schema[0].IntegratedSavingState,function(b){a.descriptiveElementSavingState=b,a.updateIntegratedSavingState()})});var b=Nerve.getCollectionMasterFromModel(this.Model.ResponseModels);c.observeIntegratedSavingState(b,b.Schema[0].IntegratedSavingState,function(b){a.responsesSavingState=b,a.updateIntegratedSavingState()}),this.updateIntegratedSavingState()},f.prototype.initializeModifiedDate=function(a){a.ExistingInDataSource?this.isFieldReady(f.Schema.ModifiedDate)&&(this.Model.Modified=this.Model.ModifiedDate):this.Model.Modified=(new Date).toISOString()},f.prototype.initializeResponseCount=function(){this.isFieldReady(f.Schema.RowCount)&&(this.Model.ResponsesCount=this.Model.RowCount)},f.prototype.updateIntegratedSavingState=function(){var a=this;if("pending"===this.syncBlocker.state())return this.Model.IntegratedSavingState=c.SavingStateValues.NotStarted,void this.syncBlocker.done(function(){return a.updateIntegratedSavingState()});var b=[this.Model.SavingState,this.questionsSavingState,this.responsesSavingState],d=f.Schema;this.isFieldReady(d.DescriptiveElements)&&b.push(this.descriptiveElementSavingState),this.isFieldReady(d.Logo)&&b.push(this.Model.Logo.SavingState),this.isFieldReady(d.Background)&&b.push(this.Model.Background.SavingState),this.Model.IntegratedSavingState=c.integrateSavingState(b)},f.prototype.initializeOtherInfoBinder=function(a){this.otherInfoBinder=new c.FieldBinder(this,f.Schema.OtherInfo,f.OtherInfoFieldSet),a.InitialData&&this.isFieldReady(f.Schema.OtherInfo)&&(a.ExistingInDataSource||a.InitialData.OtherInfo?this.otherInfoBinder.deserialize():this.otherInfoBinder.serialize())},f.prototype.updateCoAuthors=function(b,c){if(a.UserRepository.isValidUser(c)){var d=this.getElementById(b);d&&d.updateCoAuthors(c)}},f.prototype.startReceivingNotificationsInternal=function(){var b,d=this,e=function(a,b){return d.coAuthUserStateChangeCallbacks.trigger(a,b)},g=a.DataProvider.ProviderManager.getInstance().CurrentNotificationProvider,h=this.Model,i=$.Deferred().resolve().promise(),j=0,k=function(a){i.done(function(){a===j&&(i=d.refreshFormResponsesCount())})},l=function(){d.Synchronizer.query(f.FieldsToDesign)};b=a.EnvironmentConfig.isProduction()?function(a){}:function(a){h.CoAuthMessage=a};var m={onConnectionStarted:function(a){k(++j),e(a||[],p.ConnectionStateChanged),b("Connection established")},onConnectionFailed:function(a){b("Connection failed to be established")},onConnectionSlow:function(){b("Connection is slow")},onConnectionError:function(a){b("Connection has error")},onConnectionReconnecting:function(){b("Connection reestablishing")},onConnectionReconnected:function(a){k(++j),e(a||[],p.ConnectionStateChanged),l(),b("Connection reestablished")},onConnectionDisconnected:function(){b("Connection disconnected")},onFormElementAdded:function(f,g){var h=d.getElementById(f.id);if(h instanceof c.QuestionMaster){var i=f;i.choices||(i.choices=[]),h.Synchronizer.onSourceDataReceived(f)}else h instanceof Forms.Models.DescriptiveElementMaster?h.Synchronizer.onSourceDataReceived(f):d.currentQuestionListDownloadJob=a.Utilities.Promise.always(d.currentQuestionListDownloadJob.then(function(){Forms.Models.FormElementManager.isDescriptiveElement(f.type)?Nerve.Collection.itemsAddedInSource(d.Model.DescriptiveElements,[Nerve.convertFromSourceData(f,Forms.Models.DescriptiveElementMaster.Schema)]):Nerve.Collection.itemsAddedInSource(d.Model.Questions,[Nerve.convertFromSourceData(f,c.QuestionMaster.Schema)])}));d.updateCoAuthors(f.id,g),e([g],p.UserAction),b("Question added")},onFormElementDeleted:function(f,g){d.currentQuestionListDownloadJob=a.Utilities.Promise.always(d.currentQuestionListDownloadJob.then(function(){var a=d.getElementById(f);if(a instanceof c.QuestionMaster){var b=a.SubQuestionMasters.concat(a);Nerve.Collection.itemsDeletedInSource(d.Model.Questions,b.map(function(a){return a.Model}))}else a instanceof Forms.Models.DescriptiveElementMaster&&Nerve.Collection.itemsDeletedInSource(d.Model.DescriptiveElements,[a.Model])})),e([g],p.UserAction),b("Question deleted")},onFormElementUpdated:function(a,f,g){var h=d.getElementById(a);h&&(h instanceof c.QuestionMaster?h.Synchronizer.onSourceDataReceived(f):h instanceof Forms.Models.DescriptiveElementMaster&&h.Synchronizer.onSourceDataReceived(f),d.updateCoAuthors(a,g),e([g],p.UserAction),b("Question updated"))},onChoiceAdded:function(a,f,g){var h=d.getQuestionById(a);if(h){var i=_.map(h.Model.ChoiceGroup,function(a){var b=Nerve.getObjectMasterFromModel(a);return b.Synchronizer.existingInDataSource()});$.when.apply($,i).then(function(){var i=h.getChoiceByKey(f.key);i||(Nerve.Collection.itemsAddedInSource(h.Model.ChoiceGroup,[Nerve.convertFromSourceData(f,c.ChoiceV2Master.Schema)]),d.updateCoAuthors(a,g),e([g],p.UserAction),b("Choice added"))})}},onChoiceDeleted:function(a,c,f){var g=d.getQuestionById(a);if(g){var h=g.getChoiceById(c);h&&(h.Synchronizer.onDeletedInDataSource(),e([f],p.UserAction),b("Question deleted"))}},onChoiceUpdated:function(a,c,f,g){var h=d.getQuestionById(a);if(h){var i=h.getChoiceById(c);i&&(i.Synchronizer.onSourceDataReceived(f),d.updateCoAuthors(a,g),e([g],p.UserAction),b("Choice updated"))}},onUserConnected:function(a){e([a],p.UserConnect),b("New user connected")},onUserDisconnected:function(a){e([a],p.UserDisconnect),b("Existing user disconnected")},onFormUpdated:function(a,c){var f=_.map(d.Model.PermissionTokens,function(a){var b=Nerve.getObjectMasterFromModel(a);return b.Synchronizer.existingInDataSource()});$.when.apply($,f).then(function(){d.Synchronizer.onSourceDataReceived(a),e([c],p.UserAction),b("Form updated")})},onResponseAdded:function(a){d.bulkEdit(function(){k(++j),b("Response added")})},onResponseDeleted:function(a){d.bulkEdit(function(){k(++j),b("Response deleted")})},onResponsesAllDeleted:function(){d.bulkEdit(function(){k(++j),b("All responses deleted")})},onLocaleResourceAdded:function(){},onLocaleResourceUpdated:function(){},onLocaleResourceDeleted:function(){}},n=a.Utilities.FormId.decodeFormId(h.Id),o={OwnerTenantId:h.OwnerTenantId,OwnerId:h.OwnerId,TableId:h.TableId,IsGroupTable:n.IsGroupOwner};g.open(h.Id,m,o).done(function(){return l()})},f.prototype.ensureResponseMasterById=function(a){var b=this,d=this.getResponseModelById(a);if(!d){var e=this.Model.Responses,f=_.findIndex(e,function(b){return b.Id===a});0>f&&Nerve.Debugger.throwError("no such response"),this.bulkEdit(function(){d=Nerve.Collection.itemsAddedInSource(b.Model.ResponseModels,[e[f]])[0],e[f]=d})}return c.getResponseMaster(d)},f.prototype.getLinkPermissions=function(){return _.filter(this.Model.Permissions,function(a){return a.Type===c.PermissionType.Link||a.Type===c.PermissionType.OrgLink})},f.prototype.getResponseModelById=function(a){return Nerve.Collection.getItemWithKeyFields(this.Model.ResponseModels,{Id:a})},f.prototype.normalizeResponses=function(a){var b=this;return this.bulkEdit(function(){a=a.map(function(a){return b.normalizeResponse(a)})}),a},f.prototype.normalizeResponse=function(a){var b=this.Model.Settings.IsQuizMode&&this.SyncContext!==o.ResponseTimeForm,d={};this.FormElementManager.QuestionMasters.forEach(function(a){return d[a.Model.Id]=a}),a=_.clone(a),a.Answers=_.map(a.Answers,function(a){var c=d[a.QuestionId];return c&&(a=_.clone(a),a.Answer=c.deserializeAnswer(a.Answer),a.IsMathAnswer=!c.Model.IsAnswerPlainText,null==a.Score&&b&&c.autoGradeAnswer(a)),a});var e=this.getResponseModelById(a.Id);return e&&(c.getResponseMaster(e).updateWithNormalizedResponse(a),a=e),a},f.prototype.postFormGradingChange=function(){a.EnvironmentSettings.IsAssignmentsIntegration&&this.IsAssignmentForm&&window.parent.postMessage("FormGradingChangePerformed","*")},f}(Nerve.createObjectMasterClass("FormMaster",n,r));c.FormMaster=s}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=Nerve.Spec,d={QuestionRuntimeMasters:c.collectionOf(c.reference()),RuntimeSectionId:c.string(),UploadingFileCount:c.number()},e=function(c){function d(d,e){var f=c.call(this)||this;return f.questionRuntimeMasters={},f.answerChangeNotifier=new a.Utilities.Process.CallbackManager,f.questionAnswerChangeCallback=function(){return f.answerChangeNotifier.trigger()},f.onQuestionListChangeCallback=function(a){return f.updateQuestionList(a)},f.updateQuestionListCallback=function(){return f.updateQuestionList()},f.branchingChangeCallback=function(){return f.calculation.callOnceLater()},f.calculation=new a.Utilities.Process.CallLater(function(){return f.calculateQuestionRuntimeList()}),f.formMaster=d,e=e||{},f.disableShuffle=e.disableShuffle,f.disableBranching=e.disableBranching,f.updateQuestionList(),f.calculation.callImmediately(),f.Model.UploadingFileCount=0,Nerve.getCollectionMasterFromModel(d.Model.Questions).observe(f.onQuestionListChangeCallback),d.observe(f.updateQuestionListCallback,[b.FormMaster.Schema.HasValidBranching,b.FormMaster.Schema.Settings.ShuffleQuestionOrder]),f}return __extends(d,c),Object.defineProperty(d.prototype,"Form",{get:function(){return this.formMaster},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"IsDisableBranching",{get:function(){return this.disableBranching||this.formMaster.hasSection()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"Answers",{get:function(){return Nerve.convertToArray(this.Model.QuestionRuntimeMasters).filter(function(a){return a.Question.hasAnswer()}).map(function(a){return a.getAnswerEntity()})},set:function(a){var b=this,c={};_.forEach(a,function(a){return c[a.QuestionId]=a.Answer}),this.bulkEdit(function(){b.formMaster.FormElementManager.QuestionMasters.map(function(a){return b.getOrCreateQuestionRuntime(a)}).forEach(function(a){a.Model.Answer=c[a.Question.Model.Id]})}),this.calculation.flush()},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"SectionTopQuestionRuntimeMasters",{get:function(){return this.getRuntimeQuestionsWithSectionId(this.Model.RuntimeSectionId)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"TopQuestionRuntimeMasters",{get:function(){return Nerve.convertToArray(this.Model.QuestionRuntimeMasters).filter(function(a){return!a.Question.Model.GroupId})},enumerable:!0,configurable:!0}),d.prototype.isDefaultAnswer=function(){var a=this.formMaster.getDefaultResponse();return Nerve.convertToArray(this.Model.QuestionRuntimeMasters).every(function(b){var c=b.Question.Model.Id;return a[c]===b.Model.Answer})},d.prototype.updateWithResponse=function(a){var b=this,c={};a&&a.Answers&&_.forEach(a.Answers,function(a){return c[a.QuestionId]=a}),this.bulkEdit(function(){b.formMaster.FormElementManager.QuestionMasters.map(function(a){return b.getOrCreateQuestionRuntime(a)}).forEach(function(a){var b=a.Question.Model.Id,d=c[b];a.bulkEdit(function(){a.Model.Answer=d&&d.Answer,a.Model.AnswerEntity=d})})}),this.updateQuestionList()},d.prototype.setQuizResults=function(a){var b=this;a.forEach(function(a){var c=b.questionRuntimeMasters[a.id];c&&(c.Model.QuizResult={IsAnswerCorrect:a.isAnswerCorrect,AnswerHints:a.answerHints,IsAnswerKeys:a.answerKeys,Choices:_.map(c.Question.Model.Choices,function(a){return a.Description}),GradingBasis:a.gradingBasis})})},d.prototype.clearQuizResult=function(){for(var a in this.questionRuntimeMasters)this.questionRuntimeMasters[a].Model.QuizResult=void 0},d.prototype.calculateQuizResultFromModel=function(){Nerve.convertToArray(this.Model.QuestionRuntimeMasters).forEach(function(a){return a.calculateQuizResultFromModel()})},d.prototype.getQuestionsWithWrongAnswer=function(a){if(a.length<=0)return[];var b=_.findIndex(this.TopQuestionRuntimeMasters,function(b){return b.Question.Model.Id===a[0].Question.Model.Id})+1;return a.map(function(a,c){return a.verifyAnswer()?-1:c+b}).filter(function(a){return a>0})},d.prototype.getOrCreateQuestionRuntimeById=function(a){var b=this.formMaster.getQuestionById(a);return b&&this.getOrCreateQuestionRuntime(b)},d.prototype.observeAnswerChange=function(a){this.answerChangeNotifier.register(a)},d.prototype.unobserveAnswerChange=function(a){this.answerChangeNotifier.unregister(a)},d.prototype.release=function(){for(var a in this.questionRuntimeMasters){var b=this.questionRuntimeMasters[a];b.unobserve(this.branchingChangeCallback),b.unobserve(this.questionAnswerChangeCallback),b.release()}Nerve.getCollectionMasterFromModel(this.formMaster.Model.Questions).unobserve(this.onQuestionListChangeCallback),this.formMaster.unobserve(this.updateQuestionListCallback),this.clearOD4BTempFolder()},d.prototype.createOD4BTempFolder=function(){return this.od4bTempFolder||(this.od4bTempFolder=a.DataProvider.createDataProvider().createOD4BSessionTempFolder(this.formMaster.Model.Id)),this.od4bTempFolder},d.prototype.clearOD4BTempFolder=function(){this.od4bTempFolder=null},d.prototype.getOrCreateQuestionRuntime=function(a){var b=a.Model.Id;this.questionRuntimeMasters[b];return this.questionRuntimeMasters[b]||(this.questionRuntimeMasters[b]=this.createQuestionRuntimeMaster(a)),this.questionRuntimeMasters[b]},d.prototype.createQuestionRuntimeMaster=function(a){var c=new b.QuestionRuntimeMaster(a,this);return c.observe(this.branchingChangeCallback,[b.QuestionRuntimeMaster.Schema.BranchedQuestion]),c.observe(this.questionAnswerChangeCallback,[b.QuestionRuntimeMaster.Schema.Answer]),c},d.prototype.updateQuestionList=function(b){var c=this,d=this.formMaster.Model.Settings;if(this.questionMasters=this.formMaster.FormElementManager.TopQuestionMasters,!this.Form.hasSection()&&!this.disableShuffle&&!this.formMaster.Model.HasValidBranching&&d.ShuffleQuestionOrder)if(d.ShuffleAllQuestions||null==d.ShuffleAllQuestions)this.questionMasters=_.shuffle(this.questionMasters);else if(a.Utilities.NumberValidation.isInteger(d.LockGivenQuestionsStartDisplayOrder)&&a.Utilities.NumberValidation.isInteger(d.LockGivenQuestionsEndDisplayOrder)){var e=d.LockGivenQuestionsStartDisplayOrder-1,f=d.LockGivenQuestionsEndDisplayOrder-1,g=this.questionMasters.splice(e,f-e+1);this.questionMasters=_.shuffle(this.questionMasters),(h=this.questionMasters).splice.apply(h,[e,0].concat(g))}this.questionMasters.forEach(function(a,b){var d=c.getOrCreateQuestionRuntime(a).Model;d.NextQuestionInOrder=c.questionMasters[b+1],a.SubQuestionMasters.forEach(function(a){return c.getOrCreateQuestionRuntime(a)})}),b&&(b.AddedModels.length||b.RemovedModels.length)&&this.calculation.callOnceLater();var h},d.prototype.calculateQuestionRuntimeList=function(){for(var a,b=this,c=[],d=this.questionMasters[0];d&&(a=this.getOrCreateQuestionRuntime(d),!_.include(c,a));)c.push(a),d.SubQuestionMasters.forEach(function(a){var d=b.getOrCreateQuestionRuntime(a);c.push(d)}),d=this.IsDisableBranching?a.Model.NextQuestionInOrder:a.Model.BranchedQuestion;this.Model.QuestionRuntimeMasters=c},d.prototype.getRuntimeQuestionsWithSectionId=function(a){var b,c=Nerve.convertToArray(this.Model.QuestionRuntimeMasters).filter(function(a){return!a.Question.Model.GroupId});if(a){var d=this.Form.getDescriptiveElementMasterById(a);b=c.filter(function(a){return a.Question.Model.Order>d.Model.Order});var e=_.find(this.Form.FormElementManager.SectionMasters,function(a){return a.Model.Order>d.Model.Order});e&&(b=_.filter(b,function(a){return e.Model.Order>a.Question.Model.Order}))}else{var f=this.Form.FormElementManager.SectionMasters,g=f.length&&f[0].Model.Order;b=c,g>0&&(b=_.filter(b,function(a){return a.Question.Model.Order<g}))}return b},d}(Nerve.createObjectMasterClass("FormRuntime",d));b.FormRuntimeMaster=e}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c,d=Nerve.Spec,e={LockGivenQuestionsEndDisplayOrder:d.number(),LockGivenQuestionsStartDisplayOrder:d.number(),FormClosed:d["boolean"](),FormClosedMessage:d.string(),FormClosedMessageChanged:d["boolean"](),TimerEnabled:d["boolean"](),TimerEnabledStart:d["boolean"](),TimerEnabledEnd:d["boolean"](),StartTime:d.string(),EndTime:d.string(),RequiresUniqueResponse:d["boolean"](),IsAnonymous:d["boolean"](),NotRecordIdentity:d["boolean"](),ShuffleAllQuestions:d["boolean"](),ShuffleQuestionOrder:d["boolean"](),ShowGradedResults:d["boolean"](),ShowGradedScores:d["boolean"](),RespondInAppOnly:d["boolean"](),AllowCopy:d["boolean"](),ShareToken:d.string(),ManualGradingEnabled:d["boolean"](),IsQuizMode:d["boolean"](),EmailNotification:d["boolean"](),AllowResponderGetAllResponses:d["boolean"]()};!function(a){a[a.NotStarted=0]="NotStarted",a[a.Opened=1]="Opened",a[a.Expired=2]="Expired",a[a.Closed=3]="Closed"}(c=b.FormStatusType||(b.FormStatusType={}));var f=function(d){function e(a){var b=d.call(this,a)||this;return b.addRule({Name:"updateClosedMessage",InterestedFields:[b.Schema.FormClosed],onChange:e.updateClosedMessage}),b.addRule({Name:"updateAllowCopy",InterestedFields:[b.Schema.ShareToken],onChange:e.updateAllowCopy}),b}return __extends(e,d),e.serialize=function(a){var b=Nerve.convertToSourceData(a,this.Schema),c=0;return Object.keys(b).forEach(function(a){null==b[a]?delete b[a]:++c}),c>0?JSON.stringify(b):null},e.prototype.isAcceptingResponse=function(){return null==this.getFormClosedMessage()},e.prototype.getFormStatus=function(){var a=this.Model;if(a.FormClosed)return c.Closed;if(a.TimerEnabled){var b=Date.now();if(null!=a.StartTime&&Date.parse(a.StartTime)>b)return c.NotStarted;if(null!=a.EndTime&&Date.parse(a.EndTime)<b)return c.Expired}return c.Opened},e.prototype.getFormClosedMessage=function(){var b=this.Model,d=this.getFormStatus();switch(d){case c.Closed:return b.FormClosedMessage;case c.NotStarted:return a.Resources.LocalizedStrings.FormSetting_NotStartForm_DefaultMessage.format(new Date(b.StartTime).toLocaleString());case c.Expired:return a.Resources.LocalizedStrings.FormSetting_ExpiredForm_DefaultMessage;default:return void 0}},e.prototype.setSharingStatus=function(a,c){var d=this,e=this.Parent,f=b.FormDataSource.getDataProviderByFormMaster(e);return e.existingOnServerSide().then(function(){return f.changeSharingStatus(e.Model.Id,c)}).then(function(a){d.Model.ShareToken=a})},e.updateClosedMessage=function(b){if(-1===b.FieldSchemas.indexOf(e.Schema.FormClosedMessage)){var c=b.Master.Model;c.FormClosed?null!=c.FormClosedMessage&&a.Resources.loadLocalizedStrings().done(function(a){return c.FormClosedMessage=a.FormSetting_ClosedForm_DefaultMessage}):c.FormClosedMessage=null}},e.updateAllowCopy=function(a){var b=a.Master.Model;b.AllowCopy=!!b.ShareToken},e.prototype.serialize=function(){return e.serialize(this.Model)},e.prototype.deserialize=function(a){this.setData(a?JSON.parse(a):{},Nerve.getSubFieldSchemas(this.Schema))},e}(Nerve.createObjectMasterClass("FormSettingsMaster",e));b.FormSettingsMaster=f}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){if(!a)return!1;if(a.ResourceUrl)return!0;var b=a.UploadParameters;return!!b&&!!b.ImageFile}function e(a){return Nerve.getObjectMasterFromModel(a)}var f,g=Nerve.Spec,h={AltText:g.string({SourceFieldName:"altText"}),ContentType:g.string({SourceFieldName:"contentType"}),FileIdentifier:g.string({SourceFieldName:"fileIdentifier"}),OriginalFileName:g.string({SourceFieldName:"originalFileName"}),ResourceId:g.string({SourceFieldName:"resourceId"}),ResourceUrl:g.string({SourceFieldName:"resourceUrl"}),Width:g.number({SourceFieldName:"width"}),Height:g.number({SourceFieldName:"height"}),UploadParameters:g.reference({SourceFieldName:"uploadParameters"}),ErrorType:g.enumeration(function(){return i},{IsLocalField:!0}),ResponseError:g.reference({IsLocalField:!0}),ImageProcessingStatus:g.enumeration(function(){return f},{IsLocalField:!0}),IsPredefined:g["boolean"]({IsLocalField:!0}),SavingState:g.reference({IsLocalField:!0})};!function(a){a[a.Idle=0]="Idle",a[a.Picking=1]="Picking",a[a.Uploading=2]="Uploading",a[a.Deleting=3]="Deleting"}(f=c.ImageProcessingStatus||(c.ImageProcessingStatus={}));var i;!function(a){a[a.NoError=0]="NoError",a[a.SizeTooLarge=1]="SizeTooLarge",a[a.InvalidType=2]="InvalidType",a[a.BrokenImage=3]="BrokenImage",a[a.ServerError=4]="ServerError",a[a.DeleteFailError=5]="DeleteFailError"}(i=c.ImageErrorType||(c.ImageErrorType={})),c.hasImage=d,c.getImageInfoMaster=e;var j=function(a,b){return new c.ImageDataSource(a,b)},k=function(d){function e(a){var b=this,g=$.Deferred(),h=!a.ExistingInDataSource&&a.InitialData&&!!a.InitialData.ResourceUrl,j=_.clone(a.InitialData);a=_.clone(a),h?a.InitialData.ImageProcessingStatus=f.Uploading:a.InitialData=_.extend({},j,e.getDefaultClientFieldValues());var k=new c.Scheduler;k.setMaxRetryTimesForUpdate(0),b=d.call(this,a,{Scheduler:k,MasterReady:g.promise()})||this,c.keepSavingStateUpdated(b);var l=b.Synchronizer;return l.observe(function(a){var c;_.contains(a.FieldSchemas,l.Schema.CreationError)?c=l.Model.CreationError:_.contains(a.FieldSchemas,l.Schema.UpdateError)&&(c=l.Model.UpdateError),c&&b.bulkEdit(function(){b.Model.ResponseError=c;var a=b.Model.UploadParameters;a&&a.Delete?b.Model.ErrorType=i.DeleteFailError:b.Model.ErrorType=i.ServerError})},[l.Schema.CreationError,l.Schema.UpdateError]),b.addRule({InterestedFields:[b.Schema.ResourceId],Name:"ResetErrorStatus",onChange:function(a){!a.BeingDeleted&&b.Model.ResourceId&&b.resetStatus(f.Idle)}}),g.resolve(),h&&b.Synchronizer.existingInDataSource().done(function(){return b.duplicateFrom(j)}),b}return __extends(e,d),Object.defineProperty(e.prototype,"SettingsMaster",{get:function(){return this.settingsMaster},set:function(a){this.settingsMaster=a},enumerable:!0,configurable:!0}),e.prototype.addImage=function(a){var c,d=this;if(a.File)c=function(){return d.addImageFromFile(a.File,b.FormLimitation.ImageMaxWidth,b.FormLimitation.ImageMaxHeight)};else{if(!a.FromUrl)throw Error("Invalid picked image result.");
c=function(){return d.addImageFromUrl(a.FromUrl.Url,a.FromUrl.Size,a.FromUrl.Width,a.FromUrl.Height)}}this.Model.ImageProcessingStatus=f.Picking;var e=this.Synchronizer.existingInDataSource().then(c).done(function(){d.Model.AltText=null});return e},e.prototype.getImageErrorMessage=function(){switch(this.Model.ErrorType){case i.NoError:return null;case i.SizeTooLarge:return b.Resources.LocalizedStrings.Error_Message_5208;case i.InvalidType:return b.Resources.LocalizedStrings.Error_Message_5209;case i.BrokenImage:return b.Resources.LocalizedStrings.ImagePicker_Broken_Image;case i.ServerError:return this.getReponseErrorMessage();case i.DeleteFailError:return b.Resources.LocalizedStrings.Image_Delete_Fail}},e.prototype.clear=function(){var a=this,b=this.Model;return b.ResourceUrl?b.IsPredefined?(this.setData({AltText:null,ContentType:null,FileIdentifier:null,OriginalFileName:null,ResourceId:null,ResourceUrl:null,IsPredefined:!1,UploadParameters:null,ErrorType:i.NoError,ResponseError:null,ImageProcessingStatus:f.Idle,Width:null,Height:null}),$.Deferred().resolve().promise()):(this.bulkEdit(function(){b.ImageProcessingStatus=f.Deleting,b.UploadParameters={Delete:!0}}),this.flushUpload(function(){return a.setData(e.getDefaultClientFieldValues())})):$.Deferred().resolve().promise()},e.prototype.updateSettings=function(a,b){this.SettingsMaster&&this.SettingsMaster.updateWith(this.Model,a,b)},e.prototype.duplicateFrom=function(a){var c=this;if(this.Model.ResourceUrl){var d=a.AltText,e=this.SettingsMaster,f={};e&&(f=_.clone(e.getSnapshot())),this.Synchronizer.existingInDataSource().then(function(){return c.addImageFromUrl(a.ResourceUrl,0,f?f.NaturalWidth:b.FormLimitation.ImageMaxWidth,f?f.NaturalHeight:b.FormLimitation.ImageMaxHeight)}).done(function(){c.Model.AltText=d,e&&(delete f.TargetResourceId,delete f.NaturalHeight,delete f.NaturalWidth,e.setData(f))})}},e.prototype.addImageFromUrl=function(b,c,d,g){var h=this;a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.ImageLayout.ImageSize,extraData:{width:d,height:g}});var j=this.Model;return this.bulkEdit(function(){var a=e.getLimitedSize(d,g,800,600);return j.ErrorType=h.validateImage(c),j.ErrorType!==i.NoError?$.Deferred().reject(j.ErrorType).promise():(h.resetStatus(f.Picking),j.UploadParameters={Url:b,Size:c},h.flushUpload(void 0,a.width,a.height))})},e.prototype.addImageFromFile=function(a,b,c){var d=this,e=this.Model;return this.bulkEdit(function(){var b=d.validateImage(a.size,a.type);return b===i.NoError?(d.resetStatus(f.Uploading),e.UploadParameters={ImageFile:a},d.flushUpload()):(e.ErrorType=b,e.ImageProcessingStatus=f.Idle,$.Deferred().reject(e.ErrorType))})},e.prototype.flushUpload=function(a,b,c){var d=this;return this.Synchronizer.flush().always(function(){return d.Model.ImageProcessingStatus=f.Idle}).then(a).then(function(){return d.updateSettings(b,c)}).fail(function(a){d.resetToDefault()})},e.getLimitedSize=function(a,b,c,d){if(a>c||b>d){var e=Math.min(d/b,c/a);a*=e,b*=e}return{width:a,height:b}},e.prototype.validateImage=function(a,c,d,e){var f=i.NoError;return a>b.FormLimitation.ImageMaxSize&&(f=i.SizeTooLarge),c&&$.inArray(c,b.FormLimitation.ImageSupportMimeType)<0&&(f=i.InvalidType),f},e.prototype.resetToDefault=function(){this.setData(e.getDefaultClientFieldValues(),Nerve.getSubFieldSchemas(e.Schema)),this.updateSettings()},e.getDefaultClientFieldValues=function(){return{UploadParameters:null,ErrorType:i.NoError,ResponseError:null,ImageProcessingStatus:f.Idle,Width:null,Height:null}},e.prototype.resetStatus=function(a){var b=this.Model;this.bulkEdit(function(){b.ErrorType=i.NoError,b.ResponseError=void 0,b.ImageProcessingStatus=a})},e.prototype.getReponseErrorMessage=function(){var a=this.Model,c=a.ResponseError&&a.ResponseError.innerCode;return b.Resources.LocalizedStrings["Error_Message_"+c]||b.Resources.LocalizedStrings.Image_Upload_Fail},e}(Nerve.createObjectMasterClass("ImageInfoMaster",h,j));c.ImageInfoMaster=k}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return Nerve.getObjectMasterFromModel(a)}function e(a,b,e){a.fieldsReady([b]).done(function(){var f=a.getModelByFieldSchema(b),g=c.getImageInfoMaster(f);a.ensureFieldsReady([e]).done(function(){var b=a.getModelByFieldSchema(e),c=d(b);g.SettingsMaster=c})})}var f,g=Nerve.Spec,h={TargetResourceId:g.string(),Layout:g.enumeration(function(){return f}),Size:g.enumeration(function(){return i}),NaturalWidth:g.number(),NaturalHeight:g.number(),ContainerWidth:g.number(),ContainerHeight:g.number(),ActualWidth:g.number(),ActualHeight:g.number(),Left:g.number(),Top:g.number()};!function(a){a[a.Horizontal=0]="Horizontal",a[a.Vertical=1]="Vertical",a[a.Square=2]="Square"}(f=c.ImageLayout||(c.ImageLayout={}));var i;!function(a){a[a.Small=0]="Small",a[a.Large=1]="Large"}(i=c.ImageSize||(c.ImageSize={})),c.getImageSettingsMaster=d,c.bindImageSettings=e;var j=function(d){function e(a){var b=d.call(this,a)||this;return a.MasterTreeReady&&a.MasterTreeReady.done(function(){var a=b.Parent;a instanceof c.FormMaster&&a.fieldsReady([c.FormMaster.Schema.LogoInfo]).done(function(){a.Model.LogoInfo===b.Model&&(b.isFormLogo=!0)})}),b}return __extends(e,d),Object.defineProperty(e.prototype,"IsFormLogo",{get:function(){return this.isFormLogo},enumerable:!0,configurable:!0}),e.prototype.initImageSetting=function(a,b,d){var e=this,f=this.Model;this.bulkEdit(function(){f.TargetResourceId=a.ResourceId,null==f.Layout&&(a.ResourceUrl||a.ImageProcessingStatus!==c.ImageProcessingStatus.Idle?(f.NaturalWidth=a.Width||b,f.NaturalHeight=a.Height||d,e.initLayout(),e.applyDefaultImageSettings()):e.clear())})},e.prototype.updateWith=function(a,b,c){var d=this;this.bulkEdit(function(){d.clear(),d.initImageSetting(a,b,c)})},e.prototype.onImageStyleChange=function(a){var b=this,c=this.Model;c.Size!==a&&this.bulkEdit(function(){c.Size=a,b.applyDefaultImageSettings()})},e.prototype.clear=function(){return this.setData({},Nerve.getSubFieldSchemas(this.Schema))},e.prototype.validateImageSettings=function(a){var c=_.clone(this.getSnapshot());if(744===c.ContainerWidth&&(c.ContainerHeight=c.ContainerHeight*b.FormLimitation.QuestionCarMaxWidth/c.ContainerWidth,c.ContainerWidth=b.FormLimitation.QuestionCarMaxWidth,!a)){var d=this.Model;d.ContainerWidth=c.ContainerWidth,d.ContainerHeight=c.ContainerHeight}if(null==c.ContainerHeight||null==c.ContainerWidth||null==c.ActualHeight||null==c.ActualWidth||null==c.Top||this.IsFormLogo&&(120!==c.ContainerHeight||120!==c.ContainerWidth)||c.Left>0||c.ContainerWidth>c.Left+c.ActualWidth||c.Top>0||c.ContainerHeight>c.Top+c.ActualHeight){var e=this.getDefaultImageSettings();for(var f in e)c[f]=Math.round(e[f]),a||(this.Model[f]=c[f])}return c},e.prototype.calcLogoLayout=function(a){var c,d,e,g=this.Model.NaturalWidth||b.FormLimitation.ImageMaxWidth,h=this.Model.NaturalHeight||b.FormLimitation.ImageMaxHeight,i=g/h;a=a||{};var j=a.isSmallSize,k=a.isMobile,l=a.isSlimSize;if(k)c=l?30:j?70:80,d=c*i,d>c?(c=l?40:c,d=c*i,e=f.Vertical):e=f.Horizontal;else{var m=void 0;j?(c=70,m=125):l?(c=40,m=95):(c=120,m=215),d=c*i,d>m?(c=l?30:j?40:70,d=c*i,e=f.Vertical):e=f.Horizontal}return d=Math.min(d,750),{ActualWidth:d,ActualHeight:c,Layout:e}},e.prototype.initLayout=function(){var a=this.Model;if(this.IsFormLogo)a.Size=i.Small;else{var b=a.NaturalHeight/a.NaturalWidth;b>1?a.Layout=f.Vertical:1>b?a.Layout=f.Horizontal:a.Layout=f.Square,a.Size=.5>b?i.Large:i.Small}},e.prototype.applyDefaultImageSettings=function(){var a=this.Model,b=this.getDefaultImageSettings();for(var c in b)a[c]=Math.round(b[c])},e.prototype.getDefaultImageSettings=function(){var c,d=this.Model;if(d.NaturalHeight&&d.NaturalWidth)c={NaturalHeight:d.NaturalHeight,NaturalWidth:d.NaturalWidth};else{var e=d.NaturalHeight||b.FormLimitation.ImageMaxHeight,f=d.NaturalWidth||b.FormLimitation.ImageMaxWidth;c={NaturalHeight:e,NaturalWidth:f}}if((!a.Flighting.Flight.isEnabled(a.Flighting.Flights.DisableBrandingForMSA)||!OfficeFormServerInfo.userInfo.IsMsa)&&this.IsFormLogo)return c;var g=this.getImageLayoutPatten();if(null==g.Height?(c.ContainerWidth=g.Width,c.ContainerHeight=g.Width*c.NaturalHeight/c.NaturalWidth):null==g.Width?(c.ContainerWidth=g.Height*c.NaturalWidth/c.NaturalHeight,c.ContainerHeight=g.Height):(c.ContainerWidth=g.Width,c.ContainerHeight=g.Height),null==g.Height||null==g.Width)c.Left=0,c.Top=0,c.ActualWidth=c.ContainerWidth,c.ActualHeight=c.ContainerHeight;else{var h=Math.max(c.ContainerWidth/c.NaturalWidth,c.ContainerHeight/c.NaturalHeight);c.ActualWidth=h*c.NaturalWidth,c.ActualHeight=h*c.NaturalHeight,c.Left=(c.ContainerWidth-c.ActualWidth)/2,c.Top=(c.ContainerHeight-c.ActualHeight)/2}return c},e.prototype.getImageLayoutPatten=function(){var a=this.Model;if(this.IsFormLogo)return{Height:120,Width:120};if(null==a.Size||a.Size===i.Small)switch(a.Layout){case f.Square:return{Width:314,Height:314};case f.Vertical:return{Height:314};case f.Horizontal:default:return{Width:314}}else switch(a.Layout){case f.Square:return{Width:414,Height:414};case f.Vertical:return{Height:414};case f.Horizontal:default:return{Width:b.FormLimitation.QuestionCarMaxWidth}}},e}(Nerve.createObjectMasterClass("ImageSettingsMaster",h));c.ImageSettingsMaster=j}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){function c(a){return a}a.Exports.Models=a.Form.Model,b.exportConverter=c}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){function b(a){return{PermissionSet:"Read, Write, Share",Type:a}}function c(a){return Nerve.getObjectMasterFromModel(a)}var d,e=Nerve.Spec,f={PrincipalId:e.string({SourceFieldName:"principalId"}),PermissionSet:e.string({SourceFieldName:"permissionSet"}),Type:e.enumeration(function(){return d},{SourceFieldName:"type"}),FormId:e.string({IsSourceGenerated:!0,SourceFieldName:"formId"}),IsOwner:e["boolean"]({IsSourceGenerated:!0,SourceFieldName:"isOwner"}),PrincipalEmailAddress:e.string({IsSourceGenerated:!0,SourceFieldName:"principalEmailAddress"}),PrincipalName:e.string({IsSourceGenerated:!0,SourceFieldName:"principalName"}),SavingState:e.reference({IsLocalField:!0})};!function(a){a[a.User=0]="User",a[a.Group=1]="Group",a[a.Tenant=2]="Tenant",a[a.Link=3]="Link",a[a.OrgLink=4]="OrgLink"}(d=a.PermissionType||(a.PermissionType={})),a.createDefaultPermission=b,a.getPermissionMaster=c;var g=function(b,c){return new a.PermissionDataSource(b,c)},h=function(b){function c(c){var d=b.call(this,c)||this;return a.keepSavingStateUpdated(d),d}return __extends(c,b),Object.defineProperty(c.prototype,"Form",{get:function(){return this.Parent.Parent},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"FormId",{get:function(){return this.Form.Model.Id},enumerable:!0,configurable:!0}),c}(Nerve.createObjectMasterClass("Permission",f,g));a.PermissionMaster=h}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){function c(a,b){return{Type:a,Name:b}}function d(a){return Nerve.getObjectMasterFromModel(a)}var e,f=Nerve.Spec,g={PrincipalId:f.string({IsSourceGenerated:!0,SourceFieldName:"principalId"}),Type:f.enumeration(function(){return e},{SourceFieldName:"type"}),Name:f.string({SourceFieldName:"name"})};!function(a){a[a.Default=0]="Default",a[a.AnalyzerToken=1]="AnalyzerToken",a[a.OrgAnalyzerToken=2]="OrgAnalyzerToken"}(e=b.PermissionTokenType||(b.PermissionTokenType={})),b.createDefaultPermissionToken=c,b.getPermissionTokenMaster=d;var h=function(a,c){return new b.PermissionTokenDataSource(a,c)},i=function(e){function f(a){return e.call(this,a)||this}return __extends(f,e),Object.defineProperty(f.prototype,"Form",{get:function(){return this.Parent.Parent},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"FormId",{get:function(){return this.Form.Model.Id},enumerable:!0,configurable:!0}),f.appendPermissionToken=function(a,b,e){var f=Nerve.Collection.addItems(a.Model.PermissionTokens,[c(b,e)]),g=d(f[0]);return g.Synchronizer.existingInDataSource().then(function(){return g.Model.PrincipalId})},f.removePermissionToken=function(a,b){return b?(Nerve.Collection.deleteItems(a.Model.PermissionTokens,[b]),d(b).Synchronizer.deletedFromDataSource().done()):void 0},f.getShareResultPermissionToken=function(a){return a.Synchronizer.existingInDataSource().then(function(){var b=f.getShareResultPermissions(a);if(!b)return null;var c=d(b);return c?c.Synchronizer.existingInDataSource().then(function(){return c.Model.PrincipalId}):void 0})},f.getShareResultPermissions=function(c){return _.filter(c.Model.PermissionTokens,function(c){return c.Type===b.PermissionTokenType.AnalyzerToken&&c.Name===a.FormLimitation.AnalysisTokenName})[0]},f}(Nerve.createObjectMasterClass("PermissionToken",g,h));b.PermissionTokenMaster=i}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){function b(a){return Nerve.getObjectMasterFromModel(a)}var c=Nerve.Spec,d={Id:c.number({IsSourceGenerated:!0,IsKeyField:!0,SourceFieldName:"id"}),AnswerHint:c.string({SourceFieldName:"description"}),CustomProperties:c.string({SourceFieldName:"customProperties"}),Description:c.string({SourceFieldName:"displayText"}),Order:c.number({SourceFieldName:"order"}),Key:c.string({SourceFieldName:"key"}),IsGenerated:c["boolean"]({IsLocalField:!0}),IsMathOption:c["boolean"]({IsLocalField:!0}),BranchInfo:c.fromMasterClass(function(){return a.BranchInfoMaster},{IsLocalField:!0}),SavingState:c.reference({IsLocalField:!0})};a.getChoiceV2Master=b;var e=function(b,c){return new a.ChoiceDataSource(b,c)},f=function(b){function c(c){var d=b.call(this,c,{Scheduler:new a.Scheduler})||this;return a.keepSavingStateUpdated(d),d.initializeCustomPropertiesBinder(c),d}return __extends(c,b),Object.defineProperty(c.prototype,"Question",{get:function(){return this.Parent.Parent},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"QuestionId",{get:function(){return this.Question.Model.Id},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"Form",{get:function(){return this.Question.Form},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"FormId",{get:function(){return this.Form.Model.Id},enumerable:!0,configurable:!0}),c.prototype.initializeCustomPropertiesBinder=function(b){this.customPropertiesBinder=new a.FieldBinder(this,c.Schema.CustomProperties,c.CustomPropertiesFieldSet),b.InitialData&&this.isFieldReady(c.Schema.CustomProperties)&&(b.ExistingInDataSource||b.InitialData.CustomProperties?this.customPropertiesBinder.deserialize():this.customPropertiesBinder.serialize())},Object.defineProperty(c,"CustomPropertiesFieldSet",{get:function(){return c.customPropertiesFieldSet||(c.customPropertiesFieldSet=new a.FieldSet([c.Schema.BranchInfo,c.Schema.IsGenerated,c.Schema.IsMathOption])),c.customPropertiesFieldSet},enumerable:!0,configurable:!0}),c}(Nerve.createObjectMasterClass("ChoiceV2Master",d,e));a.ChoiceV2Master=f}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return Nerve.getObjectMasterFromModel(a)}var e,f=Nerve.Spec,g={Id:f.string({IsKeyField:!0,SourceFieldName:"id"}),DefaultValue:f.reference({SourceFieldName:"defaultValue"}),ImageInfo:f.fromMasterClass(function(){return c.ImageInfoMaster},{SourceFieldName:"image"}),ImageSettings:f.fromMasterClass(function(){return c.ImageSettingsMaster},{IsLocalField:!0}),Order:f.number({SourceFieldName:"order"}),QuestionInfo:f.string({SourceFieldName:"questionInfo"}),Required:f["boolean"]({SourceFieldName:"required"}),Subtitle:f.string({SourceFieldName:"subtitle"}),CombinedTitle:f.string({SourceFieldName:"title"}),Type:f.reference({SourceFieldName:"type"}),GroupId:f.string({SourceFieldName:"groupId"}),ShowSubtitle:f["boolean"]({IsLocalField:!0}),Hidden:f["boolean"]({IsLocalField:!0}),Title:f.string({IsLocalField:!0}),HasValidBranching:f["boolean"]({IsLocalField:!0}),BranchInfo:f.fromMasterClass(function(){return c.BranchInfoMaster},{IsLocalField:!0}),IntegratedSavingState:f.reference({IsLocalField:!0}),SavingState:f.reference({IsLocalField:!0}),IsQuiz:f["boolean"]({SourceFieldName:"isQuiz"}),GradingBasis:f.string({IsLocalField:!0}),Point:f.number({IsLocalField:!0}),ChoiceType:f.reference({IsLocalField:!0}),Choices:f.collectionOf({Description:f.string(),BranchInfo:f.fromMasterClass(function(){return c.BranchInfoMaster}),IsAnswerKey:f["boolean"](),AnswerHint:f.string(),IsGenerated:f["boolean"](),IsMathOption:f["boolean"]()},{IsLocalField:!0}),Hint:f.string({IsLocalField:!0}),AllowMultipleValues:f["boolean"]({SourceFieldName:"allowMultipleValues"}),AllowOtherAnswer:f["boolean"]({IsLocalField:!0}),OptionDisplayStyle:f.enumeration(function(){return k},{IsLocalField:!0}),ShuffleOptions:f["boolean"]({IsLocalField:!0}),BranchInfoForOtherChoice:f.fromMasterClass(function(){return c.BranchInfoMaster},{IsLocalField:!0}),ChoiceGroup:f.collectionOf(function(){return c.ChoiceV2Master},{SourceFieldName:"choices"}),Length:f.number({IsLocalField:!0}),RatingShape:f.enumeration(function(){return h},{IsLocalField:!0}),LeftDescription:f.string({IsLocalField:!0}),RightDescription:f.string({IsLocalField:!0}),ShowRatingLabel:f["boolean"]({IsLocalField:!0}),MinRating:f.number({IsLocalField:!0}),Multiline:f["boolean"]({IsLocalField:!0}),IsNumber:f["boolean"]({IsLocalField:!0}),Placeholder:f.string({IsLocalField:!0}),NumberValidationRule:f.enumeration(function(){return i},{IsLocalField:!0}),NumberMinBoundary:f.string({IsLocalField:!0}),NumberMaxBoundary:f.string({IsLocalField:!0}),Date:f["boolean"]({IsLocalField:!0}),Time:f["boolean"]({IsLocalField:!0}),FileUploadFolderId:f.string({SourceFieldName:"fileUploadFolderId"}),FileTypes:f.create({Word:f["boolean"](),Excel:f["boolean"](),PowerPoint:f["boolean"](),PDF:f["boolean"](),Image:f["boolean"](),Text:f["boolean"](),Video:f["boolean"](),Audio:f["boolean"]()},{IsLocalField:!0}),HasSpecificFileType:f["boolean"]({IsLocalField:!0}),CoAuthors:f.collectionOf(f.reference(),{IsLocalField:!0}),IsMathQuiz:f["boolean"]({IsLocalField:!0}),IsPlainTextInMathField:f["boolean"]({IsLocalField:!0}),IsAnswerPlainText:f["boolean"]({IsLocalField:!0}),MathPatterns:f.collectionOf(f.string(),{IsLocalField:!0}),MathAriaLabels:f.collectionOf(f.string(),{IsLocalField:!0}),LastMathMLFormula:f.string({IsLocalField:!0}),VideoInfo:f.create({Url:f.string(),Title:f.string(),Author:f.string(),Thumbnail_url:f.string(),OriginalWidth:f.number(),OriginalHeight:f.number()},{IsLocalField:!0}),TrackingId:f.string({SourceFieldName:"trackingId"}),LorEdited:f.string({SourceFieldName:"lorEdited"}),QuestionTagForIntelligence:f.string({SourceFieldName:"questionTagForIntelligence"}),IsFromSuggestion:f["boolean"]({SourceFieldName:"isFromSuggestion"})};g.Choices[0],g.ChoiceGroup[0];!function(a){a[a.SingleChoice=1]="SingleChoice",a[a.MultiChoice=2]="MultiChoice"}(e=c.ChoiceType||(c.ChoiceType={}));var h;!function(a){a[a.Number=0]="Number",a[a.Star=1]="Star"}(h=c.RatingShape||(c.RatingShape={}));var i;!function(a){a[a.None=0]="None",a[a.Greater=1]="Greater",a[a.GreaterOrEqual=2]="GreaterOrEqual",a[a.Less=3]="Less",a[a.LessOrEqual=4]="LessOrEqual",a[a.Equal=5]="Equal",a[a.NotEqual=6]="NotEqual",a[a.Between=7]="Between",a[a.NotBetween=8]="NotBetween",a[a.Max=9]="Max"}(i=c.NumberValidationRule||(c.NumberValidationRule={}));var j;!function(a){a[a.Success=0]="Success",a[a.RequiredError=1]="RequiredError",a[a.NumberValidationError=2]="NumberValidationError",a[a.QuizWrongChoiceError=3]="QuizWrongChoiceError",a[a.MathLengthError=4]="MathLengthError"}(j=c.QuestionValidationResult||(c.QuestionValidationResult={}));var k;!function(a){a[a.Dropdown=0]="Dropdown",a[a.ListAll=1]="ListAll"}(k=c.OptionDisplayStyle||(c.OptionDisplayStyle={}));var l;!function(a){a.Choice="Question.Choice",a.ChoiceV2="Question.Choices",a.DateTime="Question.DateTime",a.Rating="Question.Rating",a.TextField="Question.TextField",a.Ranking="Question.Ranking",a.MatrixChoiceGroup="Question.MatrixChoiceGroup",a.MatrixChoice="Question.MatrixChoice",a.FileUpload="Question.FileUpload",a.NPS="Question.NPS",a.Section="Question.ColumnGroup"}(l=c.QuestionType||(c.QuestionType={})),c.getQuestionMaster=d;var m=function(a,b){return new c.QuestionDataSource(a,b)},n=function(d){function e(a){var b=this,f=$.Deferred();return a.InitialData?(e.resolveQuestionNullTypeIssue(a.InitialData),a=_.clone(a),a.InitialData=_.clone(a.InitialData),void 0!==a.InitialData.CombinedTitle?e.updateTitleWithCombinedTitle(a.InitialData):e.updateCombinedTitle(a.InitialData)):Nerve.Debugger.throwError("Question model should created with initial data."),b=d.call(this,a,{MasterReady:f.promise(),Scheduler:new c.Scheduler})||this,b.fieldsReady([e.Schema.ChoiceGroup]).done(function(){Nerve.Collection.setComparer(b.Model.ChoiceGroup,function(a,b){return a.Order-b.Order})}),c.keepSavingStateUpdated(b),b.updateIntegratedSavingState(),b.updateBranchInfoValidness(),b.initializeQuestionInfoBinder(a),c.bindImageSettings(b,e.Schema.ImageInfo,e.Schema.ImageSettings),e.Rules.forEach(function(a){return b.addRule(a)}),b.coAuthorTimers={},f.resolve(),b}return __extends(e,d),Object.defineProperty(e,"SubQuestionOrderDefaultStep",{get:function(){return 100},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Form",{get:function(){return this.Parent.Parent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ImageInfoMaster",{get:function(){return c.getImageInfoMaster(this.Model.ImageInfo)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ImageSettingsMaster",{get:function(){return c.getImageSettingsMaster(this.Model.ImageSettings)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ParentQuestionMaster",{get:function(){if(!this.isFieldReady(this.Schema.GroupId))return null;var a=this.Model.GroupId;return a&&this.Form.getQuestionById(a)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"SubQuestionMasters",{get:function(){var a=this;return this.Form.FormElementManager.QuestionMasters.filter(function(b){return b.Model.GroupId===a.Model.Id})},enumerable:!0,configurable:!0}),e.prototype.isFieldReady=function(a){return a=e.getSourceFields([a])[0],d.prototype.isFieldReady.call(this,a)},e.prototype.ensureFieldsReady=function(a){return d.prototype.ensureFieldsReady.call(this,e.getSourceFields(a))},e.prototype.fieldsReady=function(a){return d.prototype.fieldsReady.call(this,e.getSourceFields(a))},e.prototype.ensureCreationDone=function(){var a=this;return this.ImageInfoMaster.Synchronizer.flush().then(function(){return a.Synchronizer.flush()})},e.prototype.setVideoUrl=function(a){var b=this,c=this.Model.VideoInfo,d=Nerve.getObjectMasterFromModel(c);d.bulkEdit(function(){c.Url=b.generateEmbedURLLocally(a),c.Title="",c.Author="",c.Thumbnail_url="",c.OriginalWidth=459,c.OriginalHeight=256})},e.prototype.clearVideoInfo=function(){this.Model.VideoInfo={}},e.prototype.isSubQuestion=function(){return!!this.Model.GroupId},e.prototype.addSubQuestion=function(a){a.GroupId=this.Model.Id,a.Required=this.Model.Required,this.Form.insertElementAfter(a,this)},e.prototype.deleteSubQuestion=function(a){var b=this.Form.getQuestionById(a);b.Deleted=!0},e.prototype.createSyncJob=function(a){var b=this,c=$.Deferred(),d=c.promise().then(function(){return b.Form.getQuestionSyncBlocker(d)}).then(a);return c.resolve(),d},e.prototype.createUploadSyncJob=function(b){var c=this,d=$.Deferred(),e=$.when(d,this.uploadJob).then(function(){return c.createSyncJob(b)});return d.resolve(),this.uploadJob=a.Utilities.Promise.always(e),e},e.prototype.getMethodDelegator=function(){var a=this.Model.Type;this.delegators=this.delegators||(this.delegators={});var b=this.delegators[a];if(!b){var d=c.Question.getQuestionDelegatorClass(a);b=new d(this),this.delegators[a]=b}return b},e.prototype.getChoiceById=function(a){var b=Nerve.Collection.getItemWithKeyFields(this.Model.ChoiceGroup,{Id:a});return b&&Nerve.getObjectMasterFromModel(b)},e.prototype.getChoiceByKey=function(a){var b=_.find(this.Model.ChoiceGroup,function(b){return b.Key===a});return b&&c.getChoiceV2Master(b)},e.prototype.updateCoAuthors=function(a){var b=this,c=_.filter(this.Model.CoAuthors,function(b){return a.userId===b.userId})[0],d=function(){c&&e.deleteItems([c]),a.userId in b.coAuthorTimers&&(clearTimeout(b.coAuthorTimers[a.userId]),delete b.coAuthorTimers[a.userId])},e=Nerve.getCollectionMasterFromModel(this.Model.CoAuthors);e.bulkEdit(function(){d(),c=Nerve.Collection.addItems(b.Model.CoAuthors,[a])[0]}),this.coAuthorTimers[a.userId]=setTimeout(d,1e4)},e.prototype.initializeQuestionInfoBinder=function(a){this.questionInfoBinder=new c.FieldBinder(this,e.Schema.QuestionInfo,e.QuestionInfoFieldSet),a.InitialData&&this.isFieldReady(e.Schema.QuestionInfo)&&(a.ExistingInDataSource||a.InitialData.QuestionInfo?this.questionInfoBinder.deserialize():this.questionInfoBinder.serialize()),this.justifyQuestionInfo()},e.prototype.updateIntegratedSavingState=function(){[this.Model.SavingState];this.isFieldReady(e.Schema.ImageInfo)?this.Model.IntegratedSavingState=c.integrateSavingState([this.Model.ImageInfo.SavingState,this.Model.SavingState]):this.Model.IntegratedSavingState=this.Model.SavingState},e.prototype.updateBranchInfoValidness=function(){var a=this.Model,b=_.map(a.Choices,function(a){return a.BranchInfo}).concat([a.BranchInfo,a.BranchInfoForOtherChoice]);a.HasValidBranching=b.some(function(a){return a.IsQuestionBranchingValid})},e.prototype.generateEmbedURLLocally=function(b){var c=document.createElement("a");c.href=b;var d=c.pathname.split("/"),e=b.substring(b.indexOf("?")+1),f=a.Utilities.Html.getQueries(e),g=f.v||d[0]||d[1];return"https://www.youtube.com/embed/"+g+"?feature=oembed&modestbranding=1&rel=0"},Object.defineProperty(e,"QuestionInfoFieldSet",{get:function(){return e.questionInfoFieldSet||(e.questionInfoFieldSet=new c.FieldSet([e.Schema.VideoInfo,e.Schema.ShowSubtitle,e.Schema.Hidden,e.Schema.BranchInfo,e.Schema.ShowRatingLabel,e.Schema.Point,e.Schema.ImageSettings,e.Schema.GradingBasis,e.Schema.ChoiceType,e.Schema.Choices,e.Schema.Hint,e.Schema.AllowOtherAnswer,e.Schema.OptionDisplayStyle,e.Schema.ShuffleOptions,e.Schema.BranchInfoForOtherChoice,e.Schema.Length,e.Schema.RatingShape,e.Schema.LeftDescription,e.Schema.RightDescription,e.Schema.Multiline,e.Schema.IsNumber,e.Schema.Placeholder,e.Schema.NumberValidationRule,e.Schema.NumberMinBoundary,e.Schema.NumberMaxBoundary,e.Schema.Date,e.Schema.Time,e.Schema.IsMathQuiz,e.Schema.IsPlainTextInMathField,e.Schema.IsAnswerPlainText,e.Schema.MathPatterns,e.Schema.MathAriaLabels,e.Schema.HasSpecificFileType,e.Schema.FileTypes,e.Schema.MinRating])),e.questionInfoFieldSet},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Rules",{get:function(){if(!e.rules){var c=e.Schema;e.rules=[{Name:"block id changes",InterestedFields:[c.Id],onChange:function(b){var c=b.Master.Model,d=c.Id,e=b.OldValues.Id;c.Id=e;var f;try{throw Error("Changing question id")}catch(g){f=g}a.Event.ErrorEventDeprecated.logData({errorName:"UpdatingQuestionId",errorInfo:{newId:d,oldId:e,stack:f.stack}})}},{Name:"update LOR edited property when LOR question edited",InterestedFields:[c.Title,c.Subtitle,c.ImageInfo,c.GradingBasis].concat(_.without(Nerve.getSubFieldSchemas(c.Choices[0]),c.Choices[0].BranchInfo)),onChange:function(a){return a.Master.setLorQuestionEditedProperty(a.Master.Model)}},{Name:"null type resolver",InterestedFields:[c.Type],onChange:function(a){return e.resolveQuestionNullTypeIssue(a.Master.Model)}},{Name:"update CombinedTitle",InterestedFields:[c.Title,c.IsMathQuiz,c.Subtitle],onChange:function(a){return e.updateCombinedTitle(a.Master.Model)}},{Name:"update Title",InterestedFields:[c.CombinedTitle],onChange:function(a){return e.updateTitleWithCombinedTitle(a.Master.Model)}},{Name:"IntegrateSavingState",InterestedFields:[c.ImageInfo.SavingState,c.SavingState],onChange:function(a){return a.Master.updateIntegratedSavingState()}},{Name:"HasValidBranching",InterestedFields:[c.BranchInfo,c.BranchInfoForOtherChoice,c.Choices],onChange:function(a){return a.Master.updateBranchInfoValidness()}},{Name:"IsQuiz",InterestedFields:[c.IsQuiz],onChange:function(a){var c=a.Master.Model;c.IsQuiz||(c.IsMathQuiz=null,b.convertToArray(c.Choices).forEach(function(a){a.IsAnswerKey=null}))}},{Name:"IsMathQuiz",InterestedFields:[c.IsMathQuiz],onChange:function(a){var b=a.Master.Model;b.IsMathQuiz||(b.IsMathQuiz=null,b.MathPatterns=null,b.MathAriaLabels=null,b.IsPlainTextInMathField=null,b.LastMathMLFormula=null)}},{Name:"NumberValidationRule",InterestedFields:[c.IsNumber],onChange:function(a){var b=a.Master.Model;b.IsNumber?null==b.NumberValidationRule&&(b.NumberValidationRule=i.None):b.NumberValidationRule=null}},{Name:"JustifyNumberBoundaries",InterestedFields:[c.NumberValidationRule],onChange:function(a){return a.Master.justifyNumberBoundaries()}}]}return e.rules},enumerable:!0,configurable:!0}),e.resolveQuestionNullTypeIssue=function(b){if(!b.Type){var d={choiceType:b.ChoiceType,date:b.Date,time:b.Time,ratingShape:b.RatingShape,multiline:b.Multiline};null!=d.choiceType?b.Type=c.Question.Choice.getElementTypeName():null!=d.date||null!=d.time?b.Type=c.Question.DateTime.getElementTypeName():d.ratingShape?b.Type=c.Question.Rating.getElementTypeName():b.Type=c.Question.TextField.getElementTypeName(),a.Event.ErrorEventDeprecated.logData({errorName:"QuestionNullTypeError",errorInfo:{message:"question type resolved",conditions:d,resolvedType:b.Type}})}},e.updateCombinedTitle=function(b){if(b.IsMathQuiz&&b.Subtitle){var c=b.Title||"";b.CombinedTitle=c+a.Utilities.MathHelper.mathSeparator+b.Subtitle}else b.CombinedTitle=b.Title},e.prototype.setLorQuestionEditedProperty=function(a){if(this.isFieldReady(e.Schema.TrackingId)&&a.TrackingId){var b=a.TrackingId.startsWith("qti_");b&&this.isFieldReady(e.Schema.LorEdited)&&"false"===a.LorEdited&&(a.LorEdited="true")}},e.updateTitleWithCombinedTitle=function(b){var c=b.CombinedTitle;c&&(c=c.split(a.Utilities.MathHelper.mathSeparator)[0]),b.Title=c},e.getSourceFields=function(a){return _.uniq(a.map(function(a){return e.QuestionInfoFieldSet.covers(a)?e.Schema.QuestionInfo:a}))},e}(Nerve.createObjectMasterClass("QuestionMaster",g,m));c.QuestionMaster=n;var o={verify:null,isEmpty:null,getTypeDisplayName:null,getBranchedQuestion:null,isNumberType:null,resetBranchInfo:null,getNormalizedAnswer:null,hasAnswer:null,justifyNumberBoundaries:null,getNumberValidationErrorMessage:null,supportsQuestionLevelBranching:null,supportsChoiceLevelBranching:null,getSnapshotWithoutBranchInfo:null,insertChoice:null,setAnswerKey:null,createQuizResult:null,autoGradeAnswer:null,autoGradeWithQuizResult:null,serializeAnswer:null,deserializeAnswer:null,justifyQuestionInfo:null,showAsDropdown:null,hasCorrectAnswers:null,isCorrectAnswer:null};Object.keys(o).forEach(function(a){n.prototype[a]=function(){var b=this.getMethodDelegator();return b[a].apply(b,arguments)}}),a.Exports.Models.getQuestionMaster=d}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b;!function(b){function c(a){f[a.getElementTypeName()]=a}function d(a){return f[a]}var e=function(){function b(a){this.questionMaster=a}return Object.defineProperty(b.prototype,"Master",{get:function(){return this.questionMaster},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"Model",{get:function(){return this.questionMaster.Model},enumerable:!0,configurable:!0}),b.prototype.isEmpty=function(a){return!a},b.prototype.justifyNumberBoundaries=function(){throw Error("to be overridden")},b.prototype.supportsQuestionLevelBranching=function(){return!0},b.prototype.supportsChoiceLevelBranching=function(){
return!1},b.prototype.getBranchedQuestion=function(b,c){var d=this.getBranchingResult(b);switch(d.Type){case a.BranchingType.Next:return c;case a.BranchingType.Specified:return d.TargetQuestion;case a.BranchingType.Pending:case a.BranchingType.End:default:return null}},b.prototype.isNumberType=function(){return!1},b.prototype.getNumberValidationErrorMessage=function(){throw Error("to be overridden")},b.prototype.getSnapshotWithoutBranchInfo=function(){var a=_.clone(this.Master.getSnapshot());return delete a.BranchInfo,delete a.BranchInfoForOtherChoice,a},b.prototype.resetBranchInfo=function(){this.getBranchInfoMaster(this.Model.BranchInfo).resetToDefault()},b.prototype.insertChoice=function(a,b){},b.prototype.getNormalizedAnswer=function(a){return a},b.prototype.hasAnswer=function(){return!0},b.prototype.hasCorrectAnswers=function(){return!1},b.prototype.isCorrectAnswer=function(a){return!1},b.prototype.setAnswerKey=function(a,b){},b.prototype.createQuizResult=function(a){return null},b.prototype.autoGradeAnswer=function(a){var b=!this.Model.Point,c=null==a.Answer||""===a.Answer;(b||c)&&(a.Score=0,a.IsAutoGraded=!0)},b.prototype.autoGradeWithQuizResult=function(a,b){var c=this.Master.Parent,d=c&&c.Model||this.Model,e=d.Point,f=null==a||""===a;return e||f?0:null},b.prototype.serializeAnswer=function(a){return a},b.prototype.deserializeAnswer=function(a){return a},b.prototype.justifyQuestionInfo=function(){},b.prototype.showAsDropdown=function(){},b.prototype.getBranchInfoMaster=function(a){return Nerve.getObjectMasterFromModel(a)},b.prototype.getBranchingResult=function(a){return this.getBranchInfoMaster(this.Model.BranchInfo).getBranchingResult()},b}();b.MethodDelegatorBase=e;var f={};b.registerQuestionDelegatorClass=c,b.getQuestionDelegatorClass=d}(b=a.Question||(a.Question={}))}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(d){var e=function(e){function f(){return null!==e&&e.apply(this,arguments)||this}return __extends(f,e),Object.defineProperty(f,"MinimumOptionsForDropDown",{get:function(){return 7},enumerable:!0,configurable:!0}),f.getElementTypeName=function(){return c.QuestionType.Choice},f.createDefaultDefinition=function(){var a=[{Description:b.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(1),IsGenerated:!0},{Description:b.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(2),IsGenerated:!0}];return{Type:f.getElementTypeName(),Title:b.Resources.LocalizedStrings.Question_DefaultTitle,Choices:a,ChoiceType:c.ChoiceType.SingleChoice,OptionDisplayStyle:c.OptionDisplayStyle.ListAll,QuestionTagForIntelligence:"Unknown",IsFromSuggestion:!1}},f.prototype.verify=function(b){a.Utilities.tryParseJson(b);return!this.Model.Required||b&&"[]"!==b?c.QuestionValidationResult.Success:c.QuestionValidationResult.RequiredError},f.prototype.isEmpty=function(a){return this.Model.ChoiceType===c.ChoiceType.SingleChoice?!a:!a||"[]"===a},f.prototype.getTypeDisplayName=function(){switch(this.Model.ChoiceType){case c.ChoiceType.SingleChoice:return b.Resources.LocalizedStrings.QuestionType_SingleChoice;case c.ChoiceType.MultiChoice:return b.Resources.LocalizedStrings.QuestionType_MultiChoice;default:throw Error("Choice Question Type Not Supported")}},f.prototype.supportsQuestionLevelBranching=function(){return this.Model.ChoiceType!==c.ChoiceType.SingleChoice},f.prototype.supportsChoiceLevelBranching=function(){return this.Model.ChoiceType===c.ChoiceType.SingleChoice},f.prototype.getSnapshotWithoutBranchInfo=function(){var a=e.prototype.getSnapshotWithoutBranchInfo.call(this);return a.Choices=b.convertToArray(a.Choices).map(function(a){return a=_.clone(a),delete a.BranchInfo,a}),a},f.prototype.resetBranchInfo=function(){var a=this;e.prototype.resetBranchInfo.call(this),b.convertToArray(this.Model.Choices).filter(function(b){return a.getBranchInfoMaster(b.BranchInfo).resetToDefault()}),this.getBranchInfoMaster(this.Model.BranchInfoForOtherChoice).resetToDefault()},f.prototype.insertChoice=function(a,b){var c=this.Model.Choices,d=_.find(c,function(a){return a.IsGenerated});if(!d||b&&""!==d.Description){var e=Nerve.Collection.addItems(c,[{Description:a,IsMathOption:b}]);d=e[0]}else{var f=Nerve.getObjectMasterFromModel(d);f.bulkEdit(function(){d.Description=a,d.IsGenerated=null,d.IsMathOption=b})}return d},f.prototype.hasCorrectAnswers=function(){return _.some(this.Model.Choices,function(a){return a.IsAnswerKey})},f.prototype.isCorrectAnswer=function(a){var c=d.getChoiceAnswer(a,this.Model),e=b.convertToArray(this.Model.Choices).filter(function(a){return a.IsAnswerKey}).map(function(a){return a.Description}).sort();return _.isEqual(e,c.SelectedOptions.sort())},f.prototype.justifyQuestionInfo=function(){if(a.Flighting.Flight.isEnabled(a.Flighting.Flights.DropDown)){var b=this.Master.Model;if(null==b.OptionDisplayStyle){var d=b.ChoiceType===c.ChoiceType.SingleChoice&&!b.IsMathQuiz&&!b.AllowOtherAnswer&&b.Choices.length>=f.MinimumOptionsForDropDown;b.OptionDisplayStyle=d?c.OptionDisplayStyle.Dropdown:c.OptionDisplayStyle.ListAll}}},f.prototype.showAsDropdown=function(){var b=this.Master.Model;return a.Flighting.Flight.isEnabled(a.Flighting.Flights.DropDown)?b.OptionDisplayStyle===c.OptionDisplayStyle.Dropdown:b.ChoiceType===c.ChoiceType.SingleChoice&&!b.IsMathQuiz&&!b.AllowOtherAnswer&&b.Choices.length>=f.MinimumOptionsForDropDown},f.prototype.setAnswerKey=function(a,d){var e=this;this.Master.bulkEdit(function(){a.IsAnswerKey=d,e.Model.ChoiceType===c.ChoiceType.SingleChoice&&a.IsAnswerKey&&b.convertToArray(e.Model.Choices).forEach(function(b){b.IsAnswerKey&&b!==a&&(b.IsAnswerKey=!1)})})},f.prototype.createQuizResult=function(a){if(this.Model.IsQuiz){var c=b.convertToArray(this.Model.Choices),d=c.some(function(a){return a.IsAnswerKey});return d?{IsAnswerCorrect:this.isCorrectAnswer(a),AnswerHints:c.map(function(a){return a.AnswerHint}),IsAnswerKeys:c.map(function(a){return a.IsAnswerKey}),Choices:c.map(function(a){return a.Description}),GradingBasis:this.Model.GradingBasis}:void 0}},f.prototype.autoGradeAnswer=function(a){var b=_.some(this.Model.Choices,function(a){return a.IsAnswerKey});if(b){var c=this.Model.Point?this.Model.Point:0;a.Score=this.isCorrectAnswer(a.Answer)?c:0,a.IsAutoGraded=!0}else e.prototype.autoGradeAnswer.call(this,a)},f.prototype.autoGradeWithQuizResult=function(a,b){return b?b.IsAnswerCorrect?this.Model.Point:0:null},f.prototype.getBranchingResult=function(a){var d=this;if(!this.Model.HasValidBranching||this.Model.ChoiceType!==c.ChoiceType.SingleChoice)return e.prototype.getBranchingResult.call(this,a);var f=b.convertToArray(this.Model.Choices),g=f.filter(function(a){return a.BranchInfo&&a.BranchInfo.IsQuestionBranchingValid});if(0===g.length)return e.prototype.getBranchingResult.call(this,a);var h,i=f.filter(function(b){return d.selected(a,b)}),j=_.intersection(i,g);if(j.length>0||i.length>0){var k=j[0]||i[0];h=k.BranchInfo}else this.isEmpty(a)||(h=this.Model.BranchInfoForOtherChoice);return h?this.getBranchInfoMaster(h).getBranchingResult():{Type:c.BranchingType.Pending}},f.prototype.selected=function(a,b){return b.Description===a},f}(d.MethodDelegatorBase);d.Choice=e,d.registerQuestionDelegatorClass(e)}(d=c.Question||(c.Question={}))}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={})),function(a){var b;!function(a){var b;!function(b){var c;!function(c){function d(c,d){var e=d.ChoiceType===b.ChoiceType.SingleChoice;if(null!=c){var f=a.convertToArray(d.Choices).map(function(a){return a.Description});if(!e||!d.AllowOtherAnswer&&!_.contains(f,c))try{var g=JSON.parse(c);if(Array.isArray(g)){if(!g.some(function(a){return!_.isString(a)}))return{IsSingleChoiceAnswer:!1,IsLegacyChoiceAnswer:!1,SelectedOptions:g}}else if(_.isObject(g)){var h=_.values(g);if(!h.some(function(a){return!_.isString(a)}))return{IsSingleChoiceAnswer:e&&h.length<=1,IsLegacyChoiceAnswer:!0,SelectedOptions:h}}}catch(i){}}return{IsSingleChoiceAnswer:e,IsLegacyChoiceAnswer:!1,SelectedOptions:null==c?[]:[c]}}c.getChoiceAnswer=d}(c=b.Question||(b.Question={}))}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c;!function(c){var d=function(d){function e(){return null!==d&&d.apply(this,arguments)||this}return __extends(e,d),e.getElementTypeName=function(){return b.QuestionType.ChoiceV2},e.createDefaultDefinition=function(){var b=[{Description:a.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(1),IsGenerated:!0},{Description:a.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(2),IsGenerated:!0}];return{Type:c.Choice.getElementTypeName(),Title:a.Resources.LocalizedStrings.Question_DefaultTitle,ChoiceGroup:b,QuestionTagForIntelligence:"Unknown",IsFromSuggestion:!1}},e.prototype.verify=function(a){return this.Model.Required&&(!a||this.Model.AllowMultipleValues&&0!==[].concat(a).length||!this.Model.AllowMultipleValues&&a==={})?b.QuestionValidationResult.RequiredError:b.QuestionValidationResult.Success},e.prototype.isEmpty=function(a){return this.Model.AllowMultipleValues?!a||0!==[].concat(a).length:!a||a==={}},e.prototype.getTypeDisplayName=function(){return this.Model.AllowMultipleValues?a.Resources.LocalizedStrings.QuestionType_MultiChoice:a.Resources.LocalizedStrings.QuestionType_SingleChoice},e.prototype.supportsQuestionLevelBranching=function(){return this.Model.AllowMultipleValues},e.prototype.supportsChoiceLevelBranching=function(){return!this.Model.AllowMultipleValues},e.prototype.getSnapshotWithoutBranchInfo=function(){var b=d.prototype.getSnapshotWithoutBranchInfo.call(this);return b.ChoiceGroup=a.convertToArray(b.ChoiceGroup).map(function(a){return a=_.clone(a),delete a.BranchInfo,a}),b},e.prototype.resetBranchInfo=function(){var b=this;d.prototype.resetBranchInfo.call(this),a.convertToArray(this.Model.ChoiceGroup).filter(function(a){return b.getBranchInfoMaster(a.BranchInfo).resetToDefault()}),this.getBranchInfoMaster(this.Model.BranchInfoForOtherChoice).resetToDefault()},e.prototype.insertChoice=function(a,b){var c=this.Model.ChoiceGroup,d=_.find(c,function(a){return a.IsGenerated});if(d){var e=Nerve.getObjectMasterFromModel(d);e.bulkEdit(function(){d.Description=a,d.IsGenerated=null,d.IsMathOption=b})}else{var f=Nerve.Collection.addItems(c,[{Description:a,IsMathOption:b}]);d=f[0]}return d},e.prototype.hasCorrectAnswers=function(){var a=JSON.parse(this.Model.GradingBasis);return _.some(this.Model.ChoiceGroup,function(b){return-1!==a.indexOf(b.Id)})},e.prototype.isCorrectAnswer=function(a){var b=c.getChoiceV2Answer(a,this.Model),d=JSON.parse(this.Model.GradingBasis).sort();return _.isEqual(d,b.SelectedOptions.sort())},e.prototype.setAnswerKey=function(a,b){var c=JSON.parse(this.Model.GradingBasis),d=c.indexOf(a.Id);b?this.Model.AllowMultipleValues?(c.push(a.Id),this.Model.GradingBasis=JSON.stringify(c)):this.Model.GradingBasis=JSON.stringify([a.Id]):-1!==d&&(this.Model.AllowMultipleValues?(c.splice(d,1),this.Model.GradingBasis=JSON.stringify(c)):this.Model.GradingBasis=JSON.stringify([]))},e.prototype.createQuizResult=function(b){if(this.Model.IsQuiz){var c=a.convertToArray(this.Model.ChoiceGroup);return this.hasCorrectAnswers()?{IsAnswerCorrect:this.isCorrectAnswer(b),AnswerHints:c.map(function(a){return a.AnswerHint}),Choices:c.map(function(a){return a.Description}),GradingBasis:this.Model.GradingBasis}:void 0}},e.prototype.autoGradeAnswer=function(a){if(this.hasCorrectAnswers()){var b=this.Model.Point?this.Model.Point:0;a.Score=this.isCorrectAnswer(a.Answer)?b:0,a.IsAutoGraded=!0}else d.prototype.autoGradeAnswer.call(this,a)},e.prototype.autoGradeWithQuizResult=function(a,b){return b?b.IsAnswerCorrect?this.Model.Point:0:null},e.prototype.getBranchingResult=function(c){var e=this;if(!this.Model.HasValidBranching||this.Model.AllowMultipleValues)return d.prototype.getBranchingResult.call(this,c);var f=a.convertToArray(this.Model.ChoiceGroup),g=f.filter(function(a){return a.BranchInfo&&a.BranchInfo.IsQuestionBranchingValid});if(0===g.length)return d.prototype.getBranchingResult.call(this,c);var h,i=f.filter(function(a){return e.selected(c,a)}),j=_.intersection(i,g);if(j.length>0||i.length>0){var k=j[0]||i[0];h=k.BranchInfo}else this.isEmpty(c)||(h=this.Model.BranchInfo);return h?this.getBranchInfoMaster(h).getBranchingResult():{Type:b.BranchingType.Pending}},e.prototype.selected=function(a,b){return b.Description===a.description},e}(c.MethodDelegatorBase);c.ChoiceV2=d,c.registerQuestionDelegatorClass(d)}(c=b.Question||(b.Question={}))}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={})),function(a){var b;!function(a){var b;!function(a){var b;!function(a){function b(a,b){return{IsSingleChoiceAnswer:!b.AllowMultipleValues,IsLegacyChoiceAnswer:!1,SelectedOptions:null==a?[]:[].concat(a)}}a.getChoiceV2Answer=b}(b=a.Question||(a.Question={}))}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c;!function(c){var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.getElementTypeName=function(){return b.QuestionType.DateTime},d.createDefaultDefinition=function(){return{Type:d.getElementTypeName(),Title:a.Resources.LocalizedStrings.Question_DefaultTitle,Date:!0,Time:!1,QuestionTagForIntelligence:"Unknown",IsFromSuggestion:!1}},d.prototype.verify=function(a){return this.Model.Required&&!a?b.QuestionValidationResult.RequiredError:b.QuestionValidationResult.Success},d.prototype.getTypeDisplayName=function(){return a.Resources.LocalizedStrings.QuestionType_DateTime},d}(c.MethodDelegatorBase);c.DateTime=d,c.registerQuestionDelegatorClass(d)}(c=b.Question||(b.Question={}))}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c;!function(c){var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.getElementTypeName=function(){return b.QuestionType.FileUpload},d.createDefaultDefinition=function(){return{Type:d.getElementTypeName(),Title:a.Resources.LocalizedStrings.Question_DefaultTitle,HasSpecificFileType:!1,FileTypes:{Word:!0,Excel:!0,PowerPoint:!0,PDF:!0,Image:!0,Text:!0,Video:!0,Audio:!0},QuestionTagForIntelligence:"Unknown",IsFromSuggestion:!1}},d.prototype.verify=function(a){return this.Model.Required&&!a?b.QuestionValidationResult.RequiredError:b.QuestionValidationResult.Success},d.prototype.getTypeDisplayName=function(){return a.Resources.LocalizedStrings.QuestionType_UploadFile},d}(c.MethodDelegatorBase);c.FileUpload=d,c.registerQuestionDelegatorClass(d)}(c=b.Question||(b.Question={}))}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b;!function(b){var c=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.getElementTypeName=function(){return a.QuestionType.MatrixChoice},c.prototype.verify=function(b){return!this.Model.Required||b&&0!==b.length?a.QuestionValidationResult.Success:a.QuestionValidationResult.RequiredError},c.prototype.getTypeDisplayName=function(){return"MatrixChoice"},c.prototype.getNormalizedAnswer=function(a){return a},c}(b.MethodDelegatorBase);b.MatrixChoice=c,b.registerQuestionDelegatorClass(c)}(b=a.Question||(a.Question={}))}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c;!function(c){var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.getElementTypeName=function(){return b.QuestionType.MatrixChoiceGroup},d.createDefaultDefinition=function(){var b=[{Description:a.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(1),IsGenerated:!0,Id:1,Order:1},{Description:a.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(2),IsGenerated:!0,Id:2,Order:2},{Description:a.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(3),IsGenerated:!0,Id:3,Order:3},{Description:a.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(4),IsGenerated:!0,Id:4,Order:4},{Description:a.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(5),IsGenerated:!0,Id:5,Order:5}];return{Type:d.getElementTypeName(),Title:a.Resources.LocalizedStrings.Question_DefaultTitle,ChoiceGroup:b,QuestionTagForIntelligence:"Unknown",IsFromSuggestion:!1}},d.createSubQuestionsDefinition=function(){var b={Title:a.Resources.LocalizedStrings.Desinger_Likert_DefaultDescription.format(1),Type:"Question.MatrixChoice"},c={Title:a.Resources.LocalizedStrings.Desinger_Likert_DefaultDescription.format(2),Type:"Question.MatrixChoice"};return[b,c]},d.prototype.verify=function(a){return b.QuestionValidationResult.Success},d.prototype.getTypeDisplayName=function(){return a.Resources.LocalizedStrings.QuestionType_Likert},d.prototype.hasAnswer=function(){return!1},d}(c.MethodDelegatorBase);c.MatrixChoiceGroup=d,c.registerQuestionDelegatorClass(d)}(c=b.Question||(b.Question={}))}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c;!function(c){var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.getElementTypeName=function(){return b.QuestionType.NPS},d.createDefaultDefinition=function(){return{Type:d.getElementTypeName(),Title:a.Resources.LocalizedStrings.NPS_DefaultTitle,LeftDescription:a.Resources.LocalizedStrings.NPS_LeftDescription,RightDescription:a.Resources.LocalizedStrings.NPS_RightDescription,QuestionTagForIntelligence:"Unknown",IsFromSuggestion:!1}},d.prototype.verify=function(a){return this.Model.Required&&!a&&0!==a?b.QuestionValidationResult.RequiredError:b.QuestionValidationResult.Success},d.prototype.getTypeDisplayName=function(){return a.Resources.LocalizedStrings.QuestionType_NPS},d.prototype.isNumberType=function(){return!0},d}(c.MethodDelegatorBase);c.NPSDelegator=d,c.registerQuestionDelegatorClass(d)}(c=b.Question||(b.Question={}))}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(d){var e=function(d){function e(){return null!==d&&d.apply(this,arguments)||this}return __extends(e,d),e.getElementTypeName=function(){return c.QuestionType.Ranking},e.createDefaultDefinition=function(){var c=[{Description:b.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(1),Order:1,Key:a.Utilities.Guid.newGuid()},{Description:b.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(2),Order:2,Key:a.Utilities.Guid.newGuid()},{Description:b.Resources.LocalizedStrings.Designer_Choices_DefaultDescription.format(3),Order:3,Key:a.Utilities.Guid.newGuid()}];return{Type:e.getElementTypeName(),Title:b.Resources.LocalizedStrings.Question_DefaultTitle,AllowMultipleValues:!0,ChoiceGroup:c,QuestionTagForIntelligence:"Unknown",IsFromSuggestion:!1}},e.prototype.verify=function(a){return!this.Model.Required||a&&0!==a.length?c.QuestionValidationResult.Success:c.QuestionValidationResult.RequiredError},e.prototype.getTypeDisplayName=function(){return b.Resources.LocalizedStrings.QuestionType_Ranking},e.prototype.isCorrectAnswer=function(a){var b=this;if(!a)return!1;var c,d=JSON.parse(this.Model.GradingBasis);c=_.isString(a)?JSON.parse(a):_.map(_.sortBy(a,function(a){return a.answerOrder}),function(a){return a.id});var e=_.map(d,function(a){return _.findWhere(b.Model.ChoiceGroup,{Key:a}).Id});return c.length<e.length?!1:(c=_.filter(c,function(a){return _.contains(e,a)}),_.isEqual(e,c))},e.prototype.createQuizResult=function(a){return this.Model.IsQuiz?{IsAnswerCorrect:this.isCorrectAnswer(a),GradingBasis:this.Model.GradingBasis}:void 0},e.prototype.autoGradeAnswer=function(a){var b=this.Model.Point||0;a.Score=this.isCorrectAnswer(a.Answer)?b:0,a.IsAutoGraded=!0},e.prototype.autoGradeWithQuizResult=function(a,b){return b?b.IsAnswerCorrect?this.Model.Point:0:null},e.prototype.getNormalizedAnswer=function(a){return a||[]},e.prototype.hasCorrectAnswers=function(){return!0},e}(d.MethodDelegatorBase);d.Ranking=e,d.registerQuestionDelegatorClass(e)}(d=c.Question||(c.Question={}))}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c;!function(c){var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.getElementTypeName=function(){return b.QuestionType.Rating},d.createDefaultDefinition=function(){return{Type:d.getElementTypeName(),Title:a.Resources.LocalizedStrings.Question_DefaultTitle,Length:5,RatingShape:b.RatingShape.Star,LeftDescription:"",RightDescription:"",MinRating:1,QuestionTagForIntelligence:"Unknown",IsFromSuggestion:!1}},d.prototype.verify=function(a){return this.Model.Required&&!a?b.QuestionValidationResult.RequiredError:b.QuestionValidationResult.Success},d.prototype.getTypeDisplayName=function(){return a.Resources.LocalizedStrings.QuestionType_Rating},d.prototype.isNumberType=function(){return!0},d}(c.MethodDelegatorBase);c.Rating=d,c.registerQuestionDelegatorClass(d)}(c=b.Question||(b.Question={}))}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c;!function(b){var c=function(){function b(b,c,d){this.answer=b,this.id=c||a.Utilities.Guid.newGuid(),this.isMath=d}return b}();b.ShortTextAnswer=c,a.Exports.Models.ShortTextAnswer=c;var d=function(){function b(c){if(this.possibleCorrectAnswers=[],null!=c.GradingBasis)try{this.possibleCorrectAnswers=JSON.parse(c.GradingBasis)}catch(d){this.possibleCorrectAnswers=[],a.Event.ErrorEventDeprecated.logData({errorName:"ShortTextGradingBasisJsonParseFailure",errorInfo:{gradingBasisLength:c.GradingBasis.length,nonAsciiDetected:b.doesContainNonAsciiCharacters(c.GradingBasis)}})}else this.possibleCorrectAnswers=[]}return b.prototype.serialize=function(){return JSON.stringify(this.possibleCorrectAnswers)},b.prototype.getAnswers=function(){return _.clone(this.possibleCorrectAnswers)},b.prototype.areAnyAnswersDefined=function(){return 0!==this.possibleCorrectAnswers.length},b.prototype.addAnswer=function(a,b){return this.isInvalidAnswerCandidate(a)?!1:this.hasAnswerBeenPreviouslyAdded(a)?!1:(this.possibleCorrectAnswers.push(new c(a,void 0,b)),!0)},b.prototype.updateAnswer=function(a,b,d){if(this.isInvalidAnswerCandidate(b))return!1;if(this.hasAnswerBeenPreviouslyAdded(b,a))return!1;var e=this.getPossibleAnswerIndex(a);if(0>e)return!1;var f=this.possibleCorrectAnswers[e];return this.possibleCorrectAnswers[e]=new c(b,f.id,d),!0},b.prototype.deleteAnswer=function(a){var b=this.getPossibleAnswerIndex(a);b>=0&&this.possibleCorrectAnswers.splice(b,1)},b.prototype.isCorrect=function(a){return this.isInvalidAnswerCandidate(a)?!1:(a+="",a=a.trim().toUpperCase(),null!=_.find(this.possibleCorrectAnswers,function(b){return b.answer.trim().toUpperCase()===a}))},b.prototype.hasAnswerBeenPreviouslyAdded=function(a,b){a+="";var c=a.toUpperCase();return null!=_.find(this.possibleCorrectAnswers,function(a){return a.answer.toUpperCase()===c&&a.id!==b})},b.prototype.isInvalidAnswerCandidate=function(a){return null==a||""===a},b.prototype.getPossibleAnswerIndex=function(a){return _.findIndex(this.possibleCorrectAnswers,function(b){return b.id===a})},b.doesContainNonAsciiCharacters=function(a){for(var b=0;b<a.length;b++)if(a.charCodeAt(b)>127)return!0;return!1},b}();b.ShortTextAutograder=d,a.Exports.Models.ShortTextAutograder=d}(c=b.Question||(b.Question={}))}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(d){function e(a){var d=c.NumberValidationRule[a];return b.Resources.LocalizedStrings["NumberValidation"+d]}d.getLocalizedNumberValidationRuleName=e;var f=function(e){function f(){return null!==e&&e.apply(this,arguments)||this}return __extends(f,e),f.getElementTypeName=function(){return c.QuestionType.TextField},f.createDefaultDefinition=function(){return f.createDefaultSingleLineDefinition()},f.createDefaultSingleLineDefinition=function(){return{Type:f.getElementTypeName(),Title:b.Resources.LocalizedStrings.Question_DefaultTitle,Multiline:!1,QuestionTagForIntelligence:"Unknown",IsFromSuggestion:!1}},f.createDefaultMultiLineDefinition=function(){return{Type:f.getElementTypeName(),Title:b.Resources.LocalizedStrings.Question_DefaultTitle,Multiline:!0,QuestionTagForIntelligence:"Unknown",IsFromSuggestion:!1}},f.prototype.verify=function(b){var d=b;if(this.Model.IsMathQuiz&&d){var e=a.Utilities.tryParseJson(b);if(d=null==e.Answer?b:e.Answer,d.length>a.Form.FormLimitation.MathInputLength)return c.QuestionValidationResult.MathLengthError}return this.Model.Required&&!d?c.QuestionValidationResult.RequiredError:d&&this.Model.IsNumber&&!this.verifyNumber(d)?c.QuestionValidationResult.NumberValidationError:c.QuestionValidationResult.Success},f.prototype.getTypeDisplayName=function(){return this.Model.Multiline?b.Resources.LocalizedStrings.QuestionType_MultiLineText:this.Model.IsNumber?b.Resources.LocalizedStrings.QuestionType_Number:b.Resources.LocalizedStrings.QuestionType_SingleLineText},f.prototype.isNumberType=function(){return!!this.Model.IsNumber},f.prototype.justifyNumberBoundaries=function(){var b=this;this.Master.bulkEdit(function(){var d=b.Master.Model,e=a.Utilities.NumberValidation.formatAsFloat(d.NumberMinBoundary)||"1",f=a.Utilities.NumberValidation.formatAsFloat(d.NumberMaxBoundary)||"10";switch(d.NumberValidationRule){case c.NumberValidationRule.Greater:case c.NumberValidationRule.GreaterOrEqual:case c.NumberValidationRule.Equal:case c.NumberValidationRule.NotEqual:f=null;break;case c.NumberValidationRule.Less:case c.NumberValidationRule.LessOrEqual:e=null;break;case c.NumberValidationRule.Between:case c.NumberValidationRule.NotBetween:if(parseFloat(e)>parseFloat(f)){var g=e;e=f,f=g}}d.NumberMinBoundary=e,d.NumberMaxBoundary=f})},f.prototype.getNumberValidationErrorMessage=function(){var a=this.Model.NumberValidationRule;if(null!=a){var d=b.Resources.LocalizedStrings["NumberValidation_ErrorMessage_"+c.NumberValidationRule[a]];return d.format(this.Model.NumberMinBoundary,this.Model.NumberMaxBoundary)}},f.prototype.hasCorrectAnswers=function(){if(this.Model.IsQuiz&&!this.Model.Multiline){var a=new d.ShortTextAutograder(this.Model);return a.areAnyAnswersDefined()}return!1},f.prototype.isCorrectAnswer=function(a){if(this.Model.IsQuiz&&!this.Model.Multiline){var b=new d.ShortTextAutograder(this.Model);return b.isCorrect(a)}return e.prototype.isCorrectAnswer.call(this,a)},f.prototype.createQuizResult=function(a){var b=new d.ShortTextAutograder(this.Model);return b.areAnyAnswersDefined()&&this.Model.IsQuiz?{IsAnswerCorrect:this.isCorrectAnswer(a),GradingBasis:this.Model.GradingBasis}:void 0},f.prototype.autoGradeAnswer=function(a){if(this.Model.IsQuiz&&!this.Model.Multiline){var b=new d.ShortTextAutograder(this.Model);if(b.areAnyAnswersDefined()){var c=this.Model.Point?this.Model.Point:0;a.Score=b.isCorrect(a.Answer)?c:0,a.IsAutoGraded=!0}else e.prototype.autoGradeAnswer.call(this,a)}else e.prototype.autoGradeAnswer.call(this,a)},f.prototype.autoGradeWithQuizResult=function(a,b){return b?this.Model.IsQuiz&&!this.Model.Multiline?b.IsAnswerCorrect?this.Model.Point:0:e.prototype.autoGradeWithQuizResult.call(this,a,b):null},f.prototype.verifyNumber=function(b){if(void 0===b||""===b)return!0;if(!a.Utilities.NumberValidation.isFormatedAsFloat(b))return!1;var d=parseFloat(a.Utilities.NumberValidation.formatAsFloat(b)),e=parseFloat(this.Model.NumberMinBoundary),f=parseFloat(this.Model.NumberMaxBoundary);switch(this.Model.NumberValidationRule){case c.NumberValidationRule.None:return!0;case c.NumberValidationRule.Between:return d>=e&&f>=d;case c.NumberValidationRule.NotBetween:return!(d>=e&&f>=d);case c.NumberValidationRule.Greater:return d>e;case c.NumberValidationRule.GreaterOrEqual:return d>=e;case c.NumberValidationRule.Less:return f>d;case c.NumberValidationRule.LessOrEqual:return f>=d;case c.NumberValidationRule.Equal:return d===e;case c.NumberValidationRule.NotEqual:return d!==e;default:return!0}},f.prototype.deserializeAnswer=function(b){if(this.Model.IsMathQuiz&&b&&""!=b){var c=a.Utilities.tryParseJson(b);return this.Model.IsAnswerPlainText=!c.IsMath,null==c.Answer?b:c.Answer}return b},f}(d.MethodDelegatorBase);d.TextField=f,d.registerQuestionDelegatorClass(f)}(d=c.Question||(c.Question={}))}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=Nerve.Spec,d={Answer:c.reference(),AnswerEntity:c.reference(),BranchedQuestion:c.reference(),NextQuestionInOrder:c.reference(),QuizResult:c.reference()},e=function(c){function d(a,b){var d=c.call(this)||this;return d.calculateNextQuestionCallback=function(){return d.updateBranchedQuestion()},d.question=a,d.question.observe(d.calculateNextQuestionCallback),d.formRuntimeMaster=b,d.addRule({Name:"UpdateBranchedQuestion",onChange:function(a){return d.updateBranchedQuestion()}}),d}return __extends(d,c),Object.defineProperty(d.prototype,"Question",{get:function(){return this.question},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"SubQuestions",{get:function(){return this.Question.SubQuestionMasters},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"SubQuestionRuntimeMasters",{get:function(){var a=this;return this.SubQuestions.map(function(b){return a.getSubQuestionRuntimeById(b.Model.Id)})},enumerable:!0,configurable:!0}),d.prototype.getSubQuestionRuntimeById=function(a){return this.formRuntimeMaster?this.formRuntimeMaster.getOrCreateQuestionRuntimeById(a):null},d.prototype.verifyAnswer=function(){if(0===this.SubQuestionRuntimeMasters.length){if(this.Question.Model.IsMathQuiz){var c=a.Utilities.tryParseJson(this.Model.Answer||"{}"),d=null==c.Answer?this.Model.Answer:c.Answer;return this.Question.verify(d)===b.QuestionValidationResult.Success}return this.Question.verify(this.Model.Answer)===b.QuestionValidationResult.Success}return this.SubQuestionRuntimeMasters.every(function(a){return a.Question.verify(a.Model.Answer)===b.QuestionValidationResult.Success})},d.prototype.release=function(){this.question.unobserve(this.calculateNextQuestionCallback)},d.prototype.getAnswerEntity=function(){return{Answer:this.Question.getNormalizedAnswer(this.Model.Answer),QuestionId:this.Question.Model.Id}},d.prototype.calculateQuizResultFromModel=function(){0===this.SubQuestionRuntimeMasters.length?this.Model.QuizResult=this.Question.createQuizResult(this.Model.Answer):this.Model.QuizResult={IsAnswerCorrect:!1}},d.prototype.getScore=function(){var a=this.Model.AnswerEntity,b=a&&a.Score;return null!=b?b:this.Question.autoGradeWithQuizResult(this.Model.Answer,this.Model.QuizResult)},d.prototype.createOD4BTempFolder=function(){if(this.formRuntimeMaster)return this.formRuntimeMaster.createOD4BTempFolder();throw Error("No FormRuntimeMaster specified.")},d.prototype.updateBranchedQuestion=function(){var a=this.Model;a.BranchedQuestion=this.Question.getBranchedQuestion(a.Answer,a.NextQuestionInOrder)},d}(Nerve.createObjectMasterClass("QuestionRuntime",d));b.QuestionRuntimeMaster=e}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){function b(a){return Nerve.getObjectMasterFromModel(a)}function c(b,c){return a.ResponseDataSource.deleteResponses(b.Model.Id,c)}var d=Nerve.Spec,e={Id:d.number({IsKeyField:!0,SourceFieldName:"id"
}),Comments:d.collectionOf(function(){return a.CommentMaster},{SourceFieldName:"comments"}),AnswersAsString:d.string({SourceFieldName:"answers"}),StartDateAsString:d.string({SourceFieldName:"startDate"}),SubmitDateAsString:d.string({SourceFieldName:"submitDate"}),Responder:d.string({SourceFieldName:"responder"}),ResponderName:d.string({SourceFieldName:"responderName"}),QuizResult:d.string({SourceFieldName:"quizResult"}),ReleaseDateAsString:d.string({SourceFieldName:"releaseDate"}),Answers:d.collectionOf({QuestionId:d.string({IsKeyField:!0,SourceFieldName:"questionId"}),Answer:d.reference({SourceFieldName:"answer1"}),Feedback:d.string({IsLocalField:!0}),Score:d.number({IsLocalField:!0}),IsAutoGraded:d["boolean"]({IsLocalField:!0}),IsMathAnswer:d["boolean"]({IsLocalField:!0})},{IsLocalField:!0}),StartDate:d.reference({IsLocalField:!0}),SubmitDate:d.reference({IsLocalField:!0}),ReleaseDate:d.reference({IsLocalField:!0}),Feedback:d.string({IsLocalField:!0}),TotalScore:d.number({IsLocalField:!0}),IntegratedSavingState:d.reference({IsLocalField:!0}),SavingState:d.reference({IsLocalField:!0}),EmailReceiptConsent:d["boolean"]({SourceFieldName:"emailReceiptConsent"}),SubmitLanguage:d.string({SourceFieldName:"submitLanguage"})};e.Answers[0];a.getResponseMaster=b,a.deleteResponses=c;var f=function(b,c){return new a.ResponseDataSource(b,c)},g=function(b){function c(d){var e=this,f=$.Deferred();return e=b.call(this,d,{Scheduler:new a.Scheduler,MasterReady:f.promise()})||this,e.initializeSavingStateIntegration(),c.Rules.forEach(function(a){return e.addRule(a)}),f.resolve(),e}return __extends(c,b),Object.defineProperty(c.prototype,"Form",{get:function(){return this.Parent.Parent},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"FormId",{get:function(){return this.Form.Model.Id},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"ResponseId",{get:function(){return this.Model.Id},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"Comment",{get:function(){return this.getCommentByQuestionId(null)},enumerable:!0,configurable:!0}),c.prototype.updateWithNormalizedResponse=function(a){var b=this;this.bulkEdit(function(){b.Synchronizer.onSourceDataReceived(Nerve.convertToSourceData(a,c.Schema)),b.setData(a)})},c.prototype.getAnswerByQuestionId=function(a){var b=Nerve.Collection.getItemWithKeyFields(this.Model.Answers,{QuestionId:a});return b&&Nerve.getObjectMasterFromModel(b)},c.prototype.getCommentByQuestionId=function(b){var c=Nerve.Collection.getItemWithKeyFields(this.Model.Comments,{QuestionId:b});return c&&a.getCommentMaster(c)},c.prototype.setAnswerGrading=function(a,b,c){var d=this.Form.getQuestionById(a),e=d.SubQuestionMasters;e.length>0&&(a=e[e.length-1].Model.Id);var f=this.getCommentByQuestionId(a);if(f)f.bulkEdit(function(){f.Model.Score=b,f.Model.Feedback=c});else{var g={QuestionId:a,Feedback:c,Score:b};Nerve.Collection.addItems(this.Model.Comments,[g])}},c.prototype.initializeSavingStateIntegration=function(){var b=this;this.commentsSavingState=a.SavingStateValues.Idle;var c=Nerve.getCollectionMasterFromModel(this.Model.Comments);a.observeIntegratedSavingState(c,c.Schema[0].SavingState,function(a){b.commentsSavingState=a,b.updateIntegratedSavingState()}),a.keepSavingStateUpdated(this),this.updateIntegratedSavingState()},c.prototype.ensureAnswerByQuestionId=function(a){var b=this.getAnswerByQuestionId(a);if(b)return b;var c=Nerve.Collection.addItems(this.Model.Answers,[{QuestionId:a}])[0];return Nerve.getObjectMasterFromModel(c)},c.prototype.updateIntegratedSavingState=function(){this.Model.IntegratedSavingState=a.integrateSavingState([this.Model.SavingState,this.commentsSavingState])},Object.defineProperty(c,"Rules",{get:function(){if(!c.rules){var a=c.Schema;c.rules=[{Name:"ResponseComment",InterestedFields:[a.Feedback,a.TotalScore],onChange:function(a){var b=a.Master,c=b.getCommentByQuestionId(null);c?c.bulkEdit(function(){c.Model.Feedback=b.Model.Feedback,c.Model.Score=b.Model.TotalScore}):Nerve.Collection.addItems(b.Model.Comments,[{QuestionId:null,Feedback:b.Model.Feedback,Score:b.Model.TotalScore}])}},{Name:"AnswerComment",InterestedFields:[a.Answers[0].Feedback,a.Answers[0].Score,a.Answers[0].IsAutoGraded],onChange:function(a){var b=a.Master,c=b.Model.Answers,d=function(a){a.IsAutoGraded||b.setAnswerGrading(a.QuestionId,a.Score,a.Feedback)};a.SubChanges.filter(function(a){return a.Master.Model===c}).forEach(function(a){a.AddedModels.forEach(d),a.SubChanges.forEach(function(a){return d(a.Master.Model)})})}},{Name:"ApplyCommentChange",InterestedFields:[a.Comments],onChange:function(a){var b=a.Master,c=b.Model.Comments,d=function(a){var c=a.QuestionId;if(c){var d=b.ensureAnswerByQuestionId(c);d.bulkEdit(function(){d.Model.Feedback=a.Feedback,d.Model.Score=a.Score,d.Model.IsAutoGraded=!1})}else b.bulkEdit(function(){b.Model.Feedback=a.Feedback,b.Model.TotalScore=a.Score})};a.SubChanges.filter(function(a){return a.Master.Model===c}).forEach(function(a){a.AddedModels.forEach(d),a.SubChanges.forEach(function(a){return d(a.Master.Model)})})}}],c.rules=c.rules.concat(c.getRulesForSyncBetweenDateFields(a.StartDate,a.StartDateAsString),c.getRulesForSyncBetweenDateFields(a.SubmitDate,a.SubmitDateAsString),c.getRulesForSyncBetweenDateFields(a.ReleaseDate,a.ReleaseDateAsString))}return c.rules},enumerable:!0,configurable:!0}),c.getRulesForSyncBetweenDateFields=function(a,b){var c=Nerve.getFieldSchemaInfo(a).Name,d=Nerve.getFieldSchemaInfo(b).Name;return[{Name:"update "+c,InterestedFields:[b],onChange:function(a){var b=a.Master.Model;b[c]=new Date(b[d])}},{Name:"update "+d,InterestedFields:[a],onChange:function(a){var b=a.Master.Model;b[d]=b[c].toISOString()}}]},c}(Nerve.createObjectMasterClass("Response",e,f));a.ResponseMaster=g}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){function c(a){var b=a.Synchronizer;b.observe(function(){return f(a)},[b.Schema.CreationFailed,b.Schema.CreationInProcess,b.Schema.CreationScheduled,b.Schema.UpdateFailed,b.Schema.UpdateInProcess,b.Schema.UpdateScheduled]),f(a)}function d(b,c,d){function f(){var a=g.map(function(a){return a.getModelByFieldSchema(c)});d(e(a))}var g=a.convertToArray(b.Model).map(Nerve.getObjectMasterFromModel);f(),b.observe(function(a){a.AddedModels.length&&(g=g.concat(a.AddedModels.map(Nerve.getObjectMasterFromModel))),a.RemovedModels.length&&a.RemovedModels.map(Nerve.getObjectMasterFromModel).forEach(function(a){a.Synchronizer.deletedFromDataSource().done(function(){g=_.without(g,a),f()})}),f()},[c])}function e(a){return _.contains(a,g.Saving)?g.Saving:_.contains(a,g.Scheduled)?g.Scheduled:_.contains(a,g.Failed)?g.Failed:g.Idle}function f(a){var b=a.Synchronizer.Model;b.CreationInProcess||b.UpdateInProcess?a.Model.SavingState=g.Saving:b.CreationScheduled||b.UpdateScheduled?a.Model.SavingState=g.Scheduled:b.CreationFailed||b.UpdateFailed?a.Model.SavingState=g.Failed:a.Model.SavingState=g.Idle}var g;!function(a){a.NotStarted="NotStarted",a.Idle="Idle",a.Scheduled="Scheduled",a.Saving="Saving",a.Failed="Failed"}(g=b.SavingStateValues||(b.SavingStateValues={})),b.keepSavingStateUpdated=c,b.observeIntegratedSavingState=d,b.integrateSavingState=e}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){function c(){return g||(g=new h)}function d(a){var c=parseInt(a);return isNaN(c)||c<b.MAXRUNVERSION}var e=Nerve.Spec,f={ExportToExcelCalloutVersion:e.string(),NewFormTeachingCalloutVersion:e.string(),SendTeachingCalloutVersion:e.string(),WhatsNewVersion:e.string(),PortalFormIntroduction:e.string(),PreviewLabelForSurvey:e.string()};b.MAXRUNVERSION=2;var g;b.getUserProfileMaster=c,b.isVersionOk=d;var h=function(b){function c(){var a=b.call(this,{InitialData:c.getInitialData()})||this;return a.observe(function(b){return a.saveValues(b.FieldSchemas)}),a}return __extends(c,b),c.getInitialData=function(){var b=a.SafeStorage.DefaultStorage,d={};return Object.keys(c.Schema).forEach(function(a){return d[a]=b.getItem(a)}),d},c.prototype.saveValues=function(b){var c=a.SafeStorage.DefaultStorage,d=this.getSnapshot();b.map(Nerve.getFieldSchemaInfo).map(function(a){return a.Name}).forEach(function(a){return c.setItem(a,d[a])})},c}(Nerve.createObjectMasterClass("UserProfileMaster",f));b.UserProfileMaster=h}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){function c(a){return a&&a[e]}b.getMasterFromModel=c;var d=function(){function b(b){var c=this;this.instanceId=a.Utilities.Guid.newGuid(),this.values=[],this.allFields=[],this.changedFieldNames={},this.observers=[],this.bulkChangingModeStackedCount=0;var d=this.FieldOptions||{};this.arrayFields=[],this.fieldsEnumType=b,this.allFields=a.Utilities.getAllEnumValues(b),d.ArrayFields&&d.ArrayFields.forEach(function(a){return c.arrayFields[a.Field]=a}),this.enumFields=[],d.EnumFields&&d.EnumFields.forEach(function(a){var b=a.EnumField,d=a.StringField;c.enumFields[b]=c.enumFields[d]=_.clone(a),a.EnumType[a.DefaultValue]&&(c.values[b]=a.DefaultValue,c.values[d]=a.EnumType[a.DefaultValue])});var f=this.values.map(function(a,b){return b});this.snapshotBeforeChange=this.getSnapshot(f),this.changeNotifier=new a.Utilities.Process.CallLater(function(){return c.notifyChange()}),this.model={},Object.defineProperty(this.model,e,{get:function(){return c},enumerable:!1,configurable:!1});var g=this.toJSON.bind(this);Object.defineProperty(this.model,"toJSON",{get:function(){return g},enumerable:!1,configurable:!1}),this.allFields.forEach(function(a){var d=b[a];Object.defineProperty(c.model,d,{get:function(){return c.getFieldValue(a)},set:function(b){return c.setFieldValue(a,b)},enumerable:!0,configurable:!0})})}return b.prototype.getInstanceId=function(){return this.instanceId},Object.defineProperty(b.prototype,"Model",{get:function(){return this.model},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"FieldsEnumType",{get:function(){return this.fieldsEnumType},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"AllFields",{get:function(){return _.clone(this.allFields)},enumerable:!0,configurable:!0}),b.prototype.toJSON=function(){return this.getSnapshot()},b.prototype.getSnapshot=function(b){var c=this;b=b||a.Utilities.getAllEnumValues(this.fieldsEnumType);var d={};return b.forEach(function(a){d[c.fieldsEnumType[a]]=c.getFieldValue(a)}),d},b.prototype.setData=function(b,c){var d=this;if(b){var e;e=c?c.map(function(a){return d.FieldsEnumType[a]}):_.intersection(_.keys(b),a.Utilities.getAllEnumValueNames(this.FieldsEnumType)),this.startBulkEditMode(),e.forEach(function(a){d.Model[a]=b[a]}),this.endBulkEditMode()}},b.prototype.getFieldValue=function(a){var b=this.values[a];return this.isArrayField(a)&&(b=_.clone(b)||[]),b},b.prototype.setFieldValue=function(a,b){var c=a,d=this.values[c]===b,e=this.isArrayField(a);if(e){if(b=b||[],!_.isArray(b))throw Error('Type of field named "'+this.fieldsEnumType[c]+'" should be an array.');var f=this.values[c]||[];d=f.length===b.length,d=d&&!f.some(function(a,c){return a!==b[c]})}if(!d){var g=this.enumFields[a];if(g){var h=a===g.EnumField?b:g.EnumType[b];this.values[g.EnumField]=h,this.values[g.StringField]=g.EnumType[h],this.markFieldAsChanged([g.EnumField,g.StringField])}else e?this.onArrayFieldChange(c,b):this.values[c]=b,this.markFieldAsChanged([a])}},b.prototype.onArrayFieldChange=function(a,b){var c=this.arrayFields[a],d=this.values[a]||[];b=c.onAdd?b.map(function(a){return _.contains(d,a)?a:c.onAdd(a,b,d)}):_.clone(b),c.onDelete&&_.difference(d,b).forEach(function(a){c.onDelete(a,b,d)||b.push(a)}),c.comparer&&b.sort(c.comparer);var e=b.length===d.length&&!b.some(function(a,b){return a!==d[b]});e||(c.adjust&&(b=c.adjust(b)),this.values[a]=b)},b.prototype.observe=function(a,b){b&&b.length||(b=this.AllFields);var c=this.findObserver(a);c?c.Fields=_.union(c.Fields,b):(c={Callback:a,Fields:b},this.observers.push(c))},b.prototype.unobserve=function(a,b){var c=this.findObserver(a);if(c){if(b&&b.length&&(c.Fields=_.difference(c.Fields,b),c.Fields.length))return;this.observers=_.without(this.observers,c)}},b.prototype.triggerChangeNotificationImmediately=function(){this.changeNotifier.callImmediately()},b.prototype.startBulkEditMode=function(){++this.bulkChangingModeStackedCount},b.prototype.endBulkEditMode=function(){--this.bulkChangingModeStackedCount<=0&&(this.bulkChangingModeStackedCount=0,this.changeNotifier.flush())},Object.defineProperty(b.prototype,"FieldOptions",{get:function(){return{ArrayFields:[],EnumFields:[]}},enumerable:!0,configurable:!0}),b.prototype.isArrayField=function(a){return!!this.arrayFields[a]},b.prototype.markFieldAsChanged=function(a){var b=this;a.forEach(function(a){return b.changedFieldNames[b.fieldsEnumType[a]]=!0}),this.bulkChangingModeStackedCount>0?this.triggerChangeNotificationLater():this.triggerChangeNotificationImmediately()},b.prototype.triggerChangeNotificationLater=function(){this.changeNotifier.callOnceLater()},b.prototype.asInterface=function(){return this},b.prototype.notifyChange=function(){var a=this,b=this.snapshotBeforeChange,c=this.getSnapshot(),d=_.keys(this.changedFieldNames).map(function(b){return a.fieldsEnumType[b]});this.snapshotBeforeChange=c,this.changedFieldNames={},this.bulkChangingModeStackedCount=0,this.observers.forEach(function(e){var f=_.intersection(e.Fields,d);f.length&&e.Callback({Master:a.asInterface(),FieldSchemas:d,NewValues:c,OldValues:b})})},b.prototype.findObserver=function(a){return this.observers.filter(function(b){return b.Callback===a})[0]},b}();b.MasterBase=d;var e="__master__"}(c=b.Model_v2||(b.Model_v2={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(g,a)}var d,e=a.DataProvider.ErrorCode.InnerCode;!function(a){a[a.Desktop=0]="Desktop",a[a.Mobile=1]="Mobile",a[a.Auto=2]="Auto"}(d=b.ViewMode||(b.ViewMode={}));var f;!function(a){a[a.NotSubmitted=0]="NotSubmitted",a[a.Submitting=1]="Submitting",a[a.Failed=2]="Failed",a[a.Succeed=3]="Succeed",a[a.SucceedWithQuizResult=4]="SucceedWithQuizResult"}(f=b.SubmitState||(b.SubmitState={})),b.createFormRenderer=c;var g=function(c){function g(a){var b=c.call(this,a)||this;return b.state={IsSmallScreen:$(window).width()<768,SubmitState:f.NotSubmitted,ShowDuplicateSpinner:!1,ShowErrorPage:!1,IsStudentViewMode:null!=b.props.Response,IsReportingView:!1,HideQuestions:!1,EmailReceiptConsent:!1},b.updateFocus=b.updateFocus.bind(b),b.updateScreenSizeClass=b.updateScreenSizeClass.bind(b),b.update=b.update.bind(b),b.onAnswersChanged=b.onAnswersChanged.bind(b),b.onSectionIdChanged=b.onSectionIdChanged.bind(b),b.increaseUploadingFileCount=b.increaseUploadingFileCount.bind(b),b.decreaseUploadingFileCount=b.decreaseUploadingFileCount.bind(b),b.onThankYouViewResult=b.onThankYouViewResult.bind(b),b.onBackButtonClick=b.onBackButtonClick.bind(b),b.onPreviousButton=b.onPreviousButton.bind(b),b.onNextButton=b.onNextButton.bind(b),b}return __extends(g,c),g.prototype.componentWillMount=function(){this.formRuntimeMaster=new b.Model.FormRuntimeMaster(this.props.Master,{disableBranching:this.props.PrintView}),this.state.IsStudentViewMode?(this.resetAnswers(this.props.Response.Answers),this.formRuntimeMaster.updateWithResponse(this.props.Response),this.setServerQuizResult(this.props.Response.QuizResult),this.setState({ShowQuizResult:!0})):this.resetAnswers(this.props.PersistedAnswers),this.resetSectionId(this.props.PersistedSectionId),this.formRuntimeMaster.observeAnswerChange(this.onAnswersChanged),this.formRuntimeMaster.observe(this.onSectionIdChanged,[b.Model.FormRuntimeMaster.Schema.RuntimeSectionId]),this.formRuntimeMaster.observe(this.update,[b.Model.FormRuntimeMaster.Schema.QuestionRuntimeMasters,b.Model.FormRuntimeMaster.Schema.UploadingFileCount]),window.addEventListener("resize",this.updateScreenSizeClass)},g.prototype.componentDidMount=function(){a.Utilities.OEmbed.notifyResponsePageHeightToParentWindow()},g.prototype.componentDidUpdate=function(){a.Utilities.OEmbed.notifyResponsePageHeightToParentWindow(),$(".office-form-answerhint").linkify();var b=ReactDOM.findDOMNode(this.refs["office-form-quiz-result-container"]);b&&b.focus();var c=ReactDOM.findDOMNode(this.refs["auto-release-grade-quiz-result-container"]);c&&c.focus()},g.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.updateScreenSizeClass),this.formRuntimeMaster.observe(this.onSectionIdChanged),this.formRuntimeMaster.unobserveAnswerChange(this.onAnswersChanged),this.formRuntimeMaster.unobserve(this.update),this.formRuntimeMaster.release()},g.prototype.render=function(){var c=this,e=this.props.Master.SyncContext===b.Model.FormSyncContext.SharedTimeForm;if(this.state.ShowErrorPage)return React.createElement(Forms.UX.Renderer.ErrorPage,{Error:this.error,ErrorType:"Information",FormId:this.props.Master.Model.Id,ShowCreateFormLink:!1});var g,h={className:"office-form-content office-form-page-padding"};if(e&&(h.className=a.Utilities.Html.combineAttributes(h.className,"share-page")),(this.props.ViewMode===d.Mobile||this.state.IsSmallScreen)&&(h.className=a.Utilities.Html.combineAttributes(h.className,"small-screen")),this.isMobile()&&(h.className=a.Utilities.Html.combineAttributes(h.className,"mobile-view")),this.state.SubmitState===f.Succeed||this.state.SubmitState===f.SucceedWithQuizResult&&!this.state.ShowQuizResult){var i=void 0;this.props.Master.Model.Settings.RequiresUniqueResponse||(i=function(){return c.submitAnotherResponse()});var j=void 0;this.state.SubmitState===f.SucceedWithQuizResult&&(j=this.onThankYouViewResult),g=React.createElement(Forms.UX.Renderer.ThankYouPage,{FormMaster:b.Model.exportConverter(this.props.Master),ShowPromotionMessage:!a.Utilities.Flight.isPPTIntegration(),submitAnother:i,viewResultsHandler:j}),a.Flighting.Flight.isEnabled(a.Flighting.Flights.MSAIntroductionForResponder)&&Forms.Common.isOwnerMsaUser()&&!this.isMobile()&&(g=React.DOM.div(null,g,React.createElement(Forms.UX.Renderer.IntroductionForResponder)))}else if(this.state.IsReportingView)g=React.createElement(Forms.UX.Renderer.ReportPage,{callback:function(){return c.setState({IsReportingView:!1})}});else{var k="ShowStatementWithNotice";this.props.Master.SyncContext===b.Model.FormSyncContext.ResponseTimeForm&&this.props.Master.Model.Settings.IsAnonymous&&(k="ShowStatement"),g=React.DOM.div(null,React.DOM.div({"aria-label":this.props.Master.Model.Title,className:"office-form office-form-theme-shadow",role:"form"},this.createTitleContainer(),this.createResultContainer(),React.DOM.div({className:"office-form-body"},this.createNoticeContainer(),this.createRuntimeFormContent(),this.createEmailReceiptCheckbox(),React.DOM.div({className:"office-form-button-container"},this.createPreviousSection(),this.createSubmitButton(),this.createNextSection()),this.showDuplicateMessage(),this.createValidationErrorLabel(),this.createErrorMessage(),this.createPhishingNotice(),this.createBackToThankYouLink())),React.createElement(Forms.UX.Renderer.FooterControl,{FooterType:k}))}return React.DOM.div({className:"form-content-container"},this.createDuplicateNavBar(),React.DOM.div(h,this.props.HeaderMessage&&this.createHeader(),React.createElement(Forms.UX.Renderer.ThemeRender,{ThemeMaster:this.props.Master.ThemeMaster}),g))},g.prototype.createRuntimeFormContent=function(){return this.state.HideQuestions?null:this.props.Master.hasSection()?React.DOM.div(null,this.createSectionRenderers()):React.DOM.div(null,this.createElementRenderers(this.formRuntimeMaster.TopQuestionRuntimeMasters))},g.prototype.onThankYouViewResult=function(){this.setState({ShowQuizResult:!0})},g.prototype.createBackToThankYouLink=function(){return this.state.ShowQuizResult&&this.state.SubmitState===f.SucceedWithQuizResult?React.DOM.div({className:"office-form-quiz-back-to-result-link"},React.DOM.a({href:"javascript:void(0)",onClick:this.onBackButtonClick},b.Resources.LocalizedStrings.Response_Page_Quiz_Result_Back_To_Thank_You_Message)):void 0},g.prototype.onBackButtonClick=function(){this.setState({ShowQuizResult:!1})},g.prototype.createHeader=function(){return React.DOM.div({className:"form-header-text-message"},this.props.HeaderMessage)},g.prototype.createDuplicateSpinner=function(){return this.state.ShowDuplicateSpinner?React.DOM.div({className:"duplicate-form-spinner"},React.DOM.div({className:"spinner-tile-animation"})):void 0},g.prototype.createDuplicateNavBar=function(){var c=this,d=this.props.Master.SyncContext===b.Model.FormSyncContext.SharedTimeForm;if(d){var e=a.Control.createFontIconControl({HTMLAttributes:{className:"duplicate-form-nav-bar-icon"},IconName:"OfficeFormsLogo"}),f=React.DOM.span({className:"duplicate-form-nav-bar-title"},b.Resources.LocalizedStrings.DuplicateForm_Page_Nav_Bar_Title),g=a.Control.createTextButton({HTMLAttributes:{className:"office-form-copy-form-button",titel:b.Resources.LocalizedStrings.DuplicateForm_Page_Duplicate_Button_Text,onClick:function(){return c.duplicateForm()},disabled:this.state.ShowDuplicateSpinner},ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.DuplicateForm_Page_Duplicate_Button_Text});return React.DOM.div({className:"office-form-duplicate-form-container"},React.DOM.div({className:"office-form-duplicate-form-content"},e,f,React.DOM.div({className:"office-form-duplicate-form-button-container"},g,this.createDuplicateSpinner())))}},g.prototype.showDuplicateMessage=function(){var a=this;return this.props.Master.SyncContext===b.Model.FormSyncContext.SharedTimeForm?React.DOM.div({className:"office-form-duplicate-message-container"},React.DOM.span(null,b.Resources.LocalizedStrings.DuplicateForm_Page_Nav_Bar_Title),React.DOM.div({className:"office-form-duplicate-form-duplicate-link office-form-theme-primary-foreground",onClick:function(){return a.duplicateForm()},disabled:this.state.ShowDuplicateSpinner},b.Resources.LocalizedStrings.DuplicateForm_Page_Duplicate_Button_Text)):void 0},g.prototype.duplicateForm=function(){var c=this,d=a.Utilities.Guid.newGuid();window.sessionStorage.setItem("FormCopy.GUID",d),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.ShareFormPage.Copy.DuplicateButton,extraData:{CopyCorelationID:d,Time:(new Date).toUTCString()}});var e=this.props.Master;this.setState({ShowDuplicateSpinner:!0}),b.Model.FormDataSource.getDataProviderByFormId(e.Model.Id).getSharedForm(e.Model.Id).done(function(){var b=e.getSnapshotToCopy();window.sessionStorage.setItem("FormCopy.FormModelToJSON",JSON.stringify(b));var c="/Pages/DesignPage.aspx";if(a.DataProvider.AuthTokenHelper.getInstance().isUserLoggedIn()||!a.Flighting.Flight.isEnabled(a.Flighting.Flights.CookieAuth))return void Forms.Common.redirectTo(c);var d=window.sessionStorage.getItem("FormCopy.GUID");a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.ShareFormPage.Copy.LoginToAutoCopy,extraData:{CopyCorelationID:d,Time:(new Date).toUTCString()}}),window.sessionStorage.setItem("FormCopy.LoginToAutoCopy",JSON.stringify("LoginToAutoCopy")),a.DataProvider.AuthTokenHelper.getInstance().redirectToSignIn(c)}).fail(function(a){c.error=a,c.setState({ShowErrorPage:!0,ShowDuplicateSpinner:!1})})},g.prototype.createNoticeContainer=function(){return this.state.SubmitState===f.SucceedWithQuizResult||this.state.IsStudentViewMode?void 0:React.DOM.div({className:"office-form-notice-container"},this.createRecordIdentityNotice(),this.createRequiredNotice())},g.prototype.createRecordIdentityNotice=function(){var c=this.props.Master.Model.Settings,d=this.props.Master.SyncContext===b.Model.FormSyncContext.SharedTimeForm,e=this.props.Master.hasSection()&&!!this.formRuntimeMaster.Model.RuntimeSectionId;if(d||e)return void 0;var g=void 0;if(c.IsAnonymous||c.NotRecordIdentity)g="";else{var h=OfficeFormServerInfo.userInfo.GivenName||OfficeFormServerInfo.userInfo.DisplayName;h?g=b.Resources.LocalizedStrings.Response_NonAnonymous_Notice.format(h):(a.Event.ErrorEventDeprecated.logData({errorName:"MissingUserName",errorInfo:{givenName:!!OfficeFormServerInfo.userInfo.GivenName,displayName:!!OfficeFormServerInfo.userInfo.DisplayName,userId:!!OfficeFormServerInfo.userInfo.UserId}}),g=b.Resources.LocalizedStrings.Response_NonName_Notice)}return this.state.SubmitState!==f.SucceedWithQuizResult?React.DOM.div({},React.DOM.span({className:"office-form-notice-long-text"},g)):void 0},g.prototype.createRequiredNotice=function(){var a=this.props.Master,c=[];if(a.hasSection()&&!this.showOnSamePage()){var d=this.formRuntimeMaster.Model.RuntimeSectionId,e=a.FormElementManager.getDescriptiveElementMasterById(d);c=a.FormElementManager.findQuestionsInSection(e,!0).map(function(a){return a.Model})}else c=b.convertToArray(a.Model.Questions);return _.some(c,function(a){return a.Required})?React.DOM.div(null,React.DOM.span({className:"office-form-required-notice-star"}),React.DOM.span(null,b.Resources.LocalizedStrings.Answer_Required_Notice)):void 0},g.prototype.createResultContainer=function(){if(this.state.IsStudentViewMode||this.state.SubmitState===f.SucceedWithQuizResult){var a=this.createFormCommentContainer(),b=this.createTotalScoreBar();if(a||b)return React.DOM.div({className:"office-form-result-container"},a,b)}},g.prototype.createFormCommentContainer=function(){if(this.state.IsStudentViewMode){var c=this.props.Response.Feedback;if(c){var d=b.Resources.LocalizedStrings.RuntimeView_FormComment.format(c),e=a.Control.createRenderNewlines({content:d});return React.DOM.div({className:"office-form-formcomment-container"},React.DOM.div({className:"office-form-formcomment office-form-theme-primary-foreground"},e))}return void 0}},g.prototype.createTotalScoreBar=function(){var a=this,c=0,d=0,e=0,g=0;if((this.state.SubmitState===f.SucceedWithQuizResult||this.state.IsStudentViewMode)&&this.formRuntimeMaster.TopQuestionRuntimeMasters.forEach(function(b){var h=b.Question.Model,i=b.Question;if(h.IsQuiz)if(i.hasCorrectAnswers()&&++e,d+=h.Point||0,g+=b.Model.QuizResult&&b.Model.QuizResult.IsAnswerCorrect?1:0,a.state.SubmitState===f.SucceedWithQuizResult)c+=b.Model.QuizResult&&b.Model.QuizResult.IsAnswerCorrect?h.Point||0:0;else{var j=b.SubQuestionRuntimeMasters,k=j[j.length-1];b=k||b;var l=b.getScore();null!=l&&(c+=l)}}),e||d){var h={className:"office-form-totalscore-bar",tabIndex:-1,ref:"auto-release-grade-quiz-result-container"};if(0===d&&0===c){var i=Math.round(100*g/e)+"%";return h["aria-label"]=b.Resources.LocalizedStrings.Response_Preview_SubmitNotificationUnderAutoReleaseGrade.format(b.Resources.LocalizedStrings.Response_QuizResult_Title,i),React.DOM.div(h,React.DOM.div({className:"office-form-point-label"},b.Resources.LocalizedStrings.Quiz_Points_Text+":"),React.DOM.div({className:"office-form-score-label office-form-theme-primary-foreground"},i))}h["aria-label"]=b.Resources.LocalizedStrings.Response_Preview_SubmitNotificationUnderAutoReleaseGrade.format(b.Resources.LocalizedStrings.Response_QuizResult_Title,b.Resources.LocalizedStrings.Response_ScoreResult_Transcript.format(c,d));var j=d?d:"-";return React.DOM.div(h,React.DOM.div({className:"office-form-point-label"},b.Resources.LocalizedStrings.Quiz_Points_Text+":"),React.DOM.div({className:"office-form-score-label office-form-theme-primary-foreground"},b.Resources.LocalizedStrings.RuntimeView_TotalPoints_Content.format(c,j)))}return null},g.prototype.createValidationErrorLabel=function(){var c;c=this.formRuntimeMaster.Form.hasSection()?this.formRuntimeMaster.getQuestionsWithWrongAnswer(this.formRuntimeMaster.SectionTopQuestionRuntimeMasters):this.formRuntimeMaster.getQuestionsWithWrongAnswer(this.formRuntimeMaster.TopQuestionRuntimeMasters);var d,e=c.map(function(a){return b.Resources.LocalizedStrings.Form_QuestionWithOrdinal.format(a)}).join(b.Resources.LocalizedStrings.Common_ItemSeperator);d=this.formRuntimeMaster.Form.hasSection()&&null!=this.nextSection()?b.Resources.LocalizedStrings.Section_Question_Error_Message.format(c.length,e):b.Resources.LocalizedStrings.Form_Question_Error_Message.format(c.length,e);var f=a.Control.createFontIconControl({HTMLAttributes:{className:"office-form-alert-icon forms-icon-size24x24"},IconName:"IncidentTriangle"}),g=!!this.state.ShowValidationStyle&&!!c.length;return React.DOM.div({className:a.Utilities.Html.combineAttributes("office-form-submit-error",g?"":"NotVisible"),role:"alert"},f,React.DOM.span({className:"error-message"},g?d:""))},g.prototype.createTitleContainer=function(){var c=this.props.Master;return Forms.UX.Renderer.createTitleContainerMixer({Form:b.Model.exportConverter(c),IsMobile:this.props.ViewMode===d.Mobile||a.Utilities.isMobile(),IsSlimTitle:!this.showOnSamePage()&&!!this.formRuntimeMaster.Model.RuntimeSectionId})},g.prototype.createSectionRenderer=function(b){var c=this.formRuntimeMaster.Form.getDescriptiveElementMasterById(b),e=[];this.showOnSamePage()&&e.push(React.createElement(Forms.UX.Renderer.SectionBreaker,{HasTheme:!0,key:"form-section-breaker-"+b}));var f=this.createElementRenderers(this.formRuntimeMaster.getRuntimeQuestionsWithSectionId(b));return e.push(React.createElement(Forms.UX.Renderer.SectionRender,{children:f,Disabled:!0,DisableShuffle:!0,Expaned:!0,IsMobile:this.props.ViewMode===d.Mobile||a.Utilities.isMobile(),key:"form-section-container-"+b,SectionMaster:c})),e},g.prototype.createSectionRenderers=function(){var a=this;if(this.showOnSamePage()){var b=[];b=b.concat(this.createElementRenderers(this.formRuntimeMaster.getRuntimeQuestionsWithSectionId()));var c=this.formRuntimeMaster.Form.FormElementManager.SectionMasters;return c.forEach(function(c){b=b.concat(a.createSectionRenderer(c.Model.Id))}),b}var d=this.formRuntimeMaster.Model.RuntimeSectionId;return d?this.createSectionRenderer(d):this.createElementRenderers(this.formRuntimeMaster.getRuntimeQuestionsWithSectionId())},g.prototype.createElementRenderers=function(a){var c=this;if(a.length<=0)return null;var d,e=this.state.ShowValidationStyle,g=this.state.ShowQuizResult;return d=_.indexOf(this.formRuntimeMaster.TopQuestionRuntimeMasters,a[0])+1,a.map(function(a,h){var i=a.Question.Model.Id,j=(_.indexOf(c.formRuntimeMaster.TopQuestionRuntimeMasters,a),{Master:b.Model.exportConverter(a),Ordinal:d+h,Disabled:c.state.SubmitState===f.SucceedWithQuizResult||c.state.IsStudentViewMode,key:i,IsMobile:c.isMobile(),ShowValidationStyle:e,ShowQuizResult:g,HideMedia:!1,IsStudentViewMode:c.state.IsStudentViewMode,HideDeleteButton:c.state.SubmitState===f.Submitting||c.state.SubmitState===f.SucceedWithQuizResult||c.state.IsStudentViewMode,increaseUploadingFileCountCallBack:c.increaseUploadingFileCount,decreaseUploadingFileCountCallBack:c.decreaseUploadingFileCount});return Forms.UX.Renderer.createRendererElement(j)})},g.prototype.createNextSection=function(){return!this.props.Master.hasSection()||this.showOnSamePage()||null==this.nextSection()?null:React.DOM.div({className:"office-form-bottom-button-div"},a.Control.createTextButton({HTMLAttributes:{"aria-label":b.Resources.LocalizedStrings.Renderer_NextButtonText,className:"office-form-bottom-button office-form-theme-button",disabled:!1,onClick:this.onNextButton},ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.Renderer_NextButtonText}))},g.prototype.createPreviousSection=function(){return!this.props.Master.hasSection()||this.showOnSamePage()||null==this.formRuntimeMaster.Model.RuntimeSectionId?null:React.DOM.div({className:"office-form-bottom-button-div"},a.Control.createTextButton({HTMLAttributes:{"aria-label":b.Resources.LocalizedStrings.Renderer_PrevButtonText,className:"office-form-bottom-button office-form-dark-theme-button gray-background",disabled:!1,onClick:this.onPreviousButton},ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.Renderer_PrevButtonText}))},g.prototype.createErrorMessage=function(){
var b=a.Control.createFontIconControl({HTMLAttributes:{className:"office-form-alert-icon forms-icon-size24x24"},IconName:"IncidentTriangle"}),c=this.state.SubmitState===f.Failed;return React.DOM.div({className:a.Utilities.Html.combineAttributes("office-form-submit-error",c?"":"NotVisible"),role:"alert"},b,React.DOM.span({className:"error-message"},c?this.state.ErrorMessage:""))},g.prototype.calculateTranscript=function(){if(this.state.SubmitState===f.SucceedWithQuizResult){var a=this.formRuntimeMaster.TopQuestionRuntimeMasters,c=this.formRuntimeMaster.TopQuestionRuntimeMasters.filter(function(a){return a.Question.Model.IsQuiz}).length;if(c){var d=a.filter(function(a){return a.Model.QuizResult&&a.Model.QuizResult.IsAnswerCorrect}).length;return b.Resources.LocalizedStrings.Response_QuizResult_Transcript.format(d,c)}}},g.prototype.createSubmitButton=function(){var c=this;if(!(this.showOnSamePage()||this.state.SubmitState===f.SucceedWithQuizResult||this.state.IsStudentViewMode||this.formRuntimeMaster.Form.hasSection()&&null!=this.nextSection())){var d=this.state.SubmitState===f.Submitting,e=d||this.props.Master.SyncContext===b.Model.FormSyncContext.SharedTimeForm||this.props.DisableSubmitButton||a.Utilities.isOEmbedSPOPreview()||this.formRuntimeMaster.Model.UploadingFileCount;return React.DOM.div({className:"__submit-button-div__ office-form-bottom-button-div"},a.Control.createTextButton({HTMLAttributes:{className:a.Utilities.Html.combineAttributes("__submit-button__ office-form-bottom-button office-form-theme-button",d?"office-form-hide-text":""),disabled:e,title:a.Utilities.isOEmbedSPOPreview()?b.Resources.LocalizedStrings.Renderer_SubmitButtonSPODisabledTitle:void 0,onClick:function(){c.submitResponse();var d={},e=c.props.Master.Model;c.formRuntimeMaster.TopQuestionRuntimeMasters.forEach(function(a){var b=a.Question.Model;if(d[b.Type]=d[b.Type]||0,++d[b.Type],b.IsMathQuiz){var c=b.Type+".Math";d[c]=d[c]||0,++d[c]}});var f=c.formRuntimeMaster.TopQuestionRuntimeMasters.some(function(a){var b=a.Question.Model;return!!(b.Title&&b.Title.match(/passw(o|0)rd/i)||b.Subtitle&&b.Subtitle.match(/passw(o|0)rd/i))}),g=function(a,b){return a+(b&&b.Answer?JSON.stringify(b.Answer).length:0)},h=c.formRuntimeMaster.Answers?b.convertToArray(c.formRuntimeMaster.Answers):[],i={withBranching:e.HasValidBranching,allQuestionCount:e.Questions.length,branchedQuestionCounts:d,hasPhishingKeywords:f,allAnswersLength:_.reduce(h,g,0)};if(a.Flighting.Flight.isEnabled(a.Flighting.Flights.EmailReceipt)){var j=c.props.Master.Model;!j.EmailReceiptEnabled||j.Settings.IsAnonymous||j.Settings.NotRecordIdentity||(i.emailReceiptConsent=c.state.EmailReceiptConsent)}a.Flighting.Flight.isEnabled(a.Flighting.Flights.SectionMVP1)&&(i.withSection=c.props.Master.hasSection()),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.ResponsePage.Form.Submit,extraData:i})}},ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:d?b.Resources.LocalizedStrings.Response_Page_Submitting_Message:b.Resources.LocalizedStrings.Renderer_SubmitButtonText}),this.createSpinner())}},g.prototype.createSpinner=function(){return this.state.SubmitState===f.Submitting?React.DOM.div({className:"submit-spinner"},React.DOM.div({className:"spinner-tile-animation"},React.createElement(Forms.UX.Controls.LiveRegion,{HTMLAttributes:{className:"screenReaderVisible"},LazyRendering:!0,Role:"Log",children:b.Resources.LocalizedStrings.Response_Page_Submitting_Message}))):void 0},g.prototype.submitResponse=function(){var c=this;if(this.formRuntimeMaster.getQuestionsWithWrongAnswer(this.formRuntimeMaster.TopQuestionRuntimeMasters).length>0)return void this.setState({ShowValidationStyle:!0},g.scrollToShowSubmitError);this.setState({SubmitState:f.Submitting});var d={StartDate:this.startTime,SubmitDate:new Date,Answers:this.formRuntimeMaster.Answers};if(a.Flighting.Flight.isEnabled(a.Flighting.Flights.EmailReceipt)){var h=this.props.Master.Model;!h.EmailReceiptEnabled||h.Settings.IsAnonymous||h.Settings.NotRecordIdentity||(d.EmailReceiptConsent=this.state.EmailReceiptConsent)}var i=this.props.Master;i.submitResponse(d).done(function(b){var d=c.formRuntimeMaster.Model.QuestionRuntimeMasters;i.Model.Settings.ShowGradedResults!==!1&&Nerve.convertToArray(d).filter(function(a){return a.Question.Model.IsQuiz}).length?(c.setServerQuizResult(b&&b.quizResult),c.setState({ShowQuizResult:!1,SubmitState:f.SucceedWithQuizResult,ErrorMessage:void 0},g.scrollToTop)):c.setState({SubmitState:f.Succeed,ErrorMessage:void 0},g.scrollToTop);var e=c.props.persistSectionId;e&&e();var h=c.props.persistAnswer;h&&h(void 0),a.EnvironmentSettings.IsAssignmentsIntegration&&i.IsAssignmentForm&&window.parent.postMessage("FormResponseSubmitted","*"),c.formRuntimeMaster.clearOD4BTempFolder()}).fail(function(d){if(d.innerCode&&d.innerCode===e.AntiForgeryTokenValidationError)Forms.Common.reloadPage();else{var g=b.Resources.LocalizedStrings.Error_Inline_DefaultMessage;if(d.innerCode){if(g=b.Resources.LocalizedStrings["Error_Message_"+d.innerCode]||b.Resources.LocalizedStrings.Error_Inline_DefaultMessage,d.innerCode===e.FormClosed){var h="Inner Message:",i=d.innerMessage.indexOf("Inner Message:")+h.length,j=d.innerMessage.length;g=b.Resources.LocalizedStrings["Error_Message_"+d.innerCode+"_title"]+". "+d.innerMessage.substring(i,j).trim()}d.innerCode===e.EmbedFormNeedAuth&&(g=b.Resources.LocalizedStrings.Error_Inline_RefreshMessage),(d.innerCode===e.CDBTopLevelError||d.innerCode===e.CdbServiceUnavailable)&&(g=b.Resources.LocalizedStrings.Error_Inline_DelayTryMessage)}a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.Error.InlineError.ShowAtSubmitResponse,extraData:{Error:d,ErrorMessage:g||void 0}}),c.setState({SubmitState:f.Failed,ErrorMessage:g})}})},g.prototype.submitAnotherResponse=function(){var b=this;a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.ResponsePage.ThanksView.SubmitAnother}),this.resetAnswers(),this.resetSectionId(),this.formRuntimeMaster.updateWithResponse(null),this.setState({ErrorMessage:void 0,ShowValidationStyle:!1,ShowQuizResult:!1,SubmitState:f.NotSubmitted,IsStudentViewMode:!1,HideQuestions:!0,EmailReceiptConsent:!1},function(){b.setState({HideQuestions:!1},g.scrollToTop)})},g.prototype.resetAnswers=function(a){this.startTime=new Date,this.formRuntimeMaster.clearQuizResult(),this.formRuntimeMaster.Answers=a||[]},g.prototype.resetSectionId=function(a){this.formRuntimeMaster.Model.RuntimeSectionId=a||null},g.prototype.setServerQuizResult=function(b){if(b){var c=a.Utilities.tryParseJson(b);Array.isArray(c)&&this.formRuntimeMaster.setQuizResults(c)}else this.formRuntimeMaster.calculateQuizResultFromModel()},g.prototype.isMobile=function(){switch(this.props.ViewMode){case d.Desktop:return!1;case d.Mobile:return!0;case d.Auto:return a.Utilities.isMobile();default:throw Error("unknown view mode")}},g.prototype.onAnswersChanged=function(){var a=this.props.persistAnswer;a&&a(this.formRuntimeMaster.isDefaultAnswer()?void 0:b.convertToArray(this.formRuntimeMaster.Answers))},g.prototype.onSectionIdChanged=function(){var a=this.props.persistSectionId;a&&(null==this.formRuntimeMaster.Model.RuntimeSectionId?a():a(this.formRuntimeMaster.Model.RuntimeSectionId))},g.prototype.increaseUploadingFileCount=function(){this.formRuntimeMaster.Model.UploadingFileCount++},g.prototype.decreaseUploadingFileCount=function(){this.formRuntimeMaster.Model.UploadingFileCount>0&&this.formRuntimeMaster.Model.UploadingFileCount--},g.prototype.updateScreenSizeClass=function(){a.Utilities.isSmallScreen()!==this.state.IsSmallScreen?this.setState({IsSmallScreen:!this.state.IsSmallScreen}):a.Utilities.OEmbed.notifyResponsePageHeightToParentWindow()},g.prototype.createPhishingNotice=function(){var c=this,d=this.props.Master.Model.Settings,e=this.props.Master.SyncContext===b.Model.FormSyncContext.ResponseTimeForm;return d.IsAnonymous&&e&&!this.state.ShowQuizResult&&!a.EnvironmentConfig.isSovereignProd()?React.DOM.div({className:"office-form-notice-password"},b.Resources.LocalizedStrings.Response_Page_Footer_Notice,React.DOM.a({className:a.Utilities.isOEmbedSPO()?"office-form-notice-report office-form-theme-spo-link":"office-form-notice-report",href:"javascript:void(0)",onClick:function(){return c.setState({IsReportingView:!0})}},b.Resources.LocalizedStrings.Response_Page_Footer_Report)):void 0},g.scrollToTop=function(){a.Utilities.Html.scrollToShowSubelement($(".office-form-title-container"),$(".office-form-content"),void 0,void 0,!0)},g.scrollToShowTranscript=function(){a.Utilities.Html.scrollToShowSubelement($(".office-form-bottom-bar"),$(".office-form-content"),void 0,10,!0)},g.scrollToShowSubmitError=function(){a.Utilities.Html.scrollToShowSubelement($(".office-form-submit-error"),$(".office-form-content"),void 0,20,!0)},g.prototype.createEmailReceiptCheckbox=function(){var c=this,d=this.props.Master.Model,e=a.Flighting.Flight.isEnabled(a.Flighting.Flights.EmailReceipt)&&d.EmailReceiptEnabled&&!d.Settings.IsAnonymous&&!d.Settings.NotRecordIdentity&&!this.state.ShowQuizResult;return e&&a.Control.createCheckBox({HTMLAttributes:{className:"office-form-email-receipt-checkbox"},Value:this.state.EmailReceiptConsent,Description:b.Resources.LocalizedStrings.Response_Page_EmailReceipt_Checkbox_Description,SpanClassName:"office-form-email-receipt-checkbox-description",onValueChange:function(a){c.setState({EmailReceiptConsent:a})}})},g.prototype.finishedAllRequiredOnThisPage=function(){return this.formRuntimeMaster.getQuestionsWithWrongAnswer(this.formRuntimeMaster.SectionTopQuestionRuntimeMasters).length>0?(this.setState({ShowValidationStyle:!0},g.scrollToShowSubmitError),!1):!0},g.prototype.nextSection=function(){var a,b=this.formRuntimeMaster;if(null==b.Model.RuntimeSectionId)a=b.Form.hasSection()?_.min(b.Form.FormElementManager.SectionMasters,function(a){return a.Model.Order}):null;else{var c=b.Form.getDescriptiveElementMasterById(b.Model.RuntimeSectionId);a=_.find(b.Form.FormElementManager.SectionMasters,function(a){return a.Model.Order>c.Model.Order})}return a},g.prototype.previousSection=function(){var a=this.formRuntimeMaster,b=a.Form.getDescriptiveElementMasterById(a.Model.RuntimeSectionId),c=a.Form.FormElementManager.SectionMasters,d=_.findLastIndex(c,function(a){return a.Model.Order<b.Model.Order});return null==a.Model.RuntimeSectionId||0>d?null:c[d]},g.prototype.onPreviousButton=function(){var a=this.previousSection();null==a?this.formRuntimeMaster.Model.RuntimeSectionId=null:this.formRuntimeMaster.Model.RuntimeSectionId=a.Model.Id,this.updateFocus()},g.prototype.onNextButton=function(){this.finishedAllRequiredOnThisPage()&&(this.formRuntimeMaster.Model.RuntimeSectionId=this.nextSection().Model.Id,this.updateFocus())},g.prototype.showOnSamePage=function(){return this.state.ShowQuizResult||this.props.PrintView},g.prototype.updateFocus=function(){var a=this;this.setState({ShowValidationStyle:!1},g.scrollToTop),this.forceUpdate(function(){Forms.UX.Utilities.focusOnFirstFocusableElement(ReactDOM.findDOMNode(a))})},g.prototype.update=function(){this.forceUpdate()},g}(a.ReactComponent)}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(f,{Image:b.Model.exportConverter(a.Image),ImageSettings:b.Model.exportConverter(a.ImageSettings),ImageType:a.ImageType})}function d(a){return React.DOM.div({className:"image-spinner",id:a&&e(a)},React.DOM.div({className:"spinner-tile-animation"}))}function e(a){return"imageSpinner-"+a.ResourceId}b.createImageRenderer=c,b.createImageSpinner=d,a.Exports.createImageSpinner=d;var f=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;return a.mounted=!0,a.update=function(){return a.forceUpdate()},a.drawCanvasCallback=function(){return a.drawImageCanvas()},a}return __extends(d,c),d.prototype.componentDidMount=function(){var a=b.Model.ImageInfoMaster.Schema,c=b.Model.ImageSettingsMaster.Schema;this.props.ImageSettings.observe(this.update),this.props.Image.observe(this.update,[a.ResourceUrl,a.ContentType,a.OriginalFileName]),this.props.ImageSettings.observe(this.drawCanvasCallback,[c.ContainerHeight,c.ContainerWidth,c.Left,c.Top]),this.props.Image.observe(this.drawCanvasCallback,[a.AltText]),this.applyImageEdit()},d.prototype.componentDidUpdate=function(){this.applyImageEdit()},d.prototype.componentWillUnmount=function(){this.mounted=!1,this.props.ImageSettings.unobserve(this.update),this.props.Image.unobserve(this.update),this.props.ImageSettings.unobserve(this.drawCanvasCallback),this.props.Image.unobserve(this.drawCanvasCallback)},d.prototype.render=function(){var b=this,c=this.props.Image.Model,d=this.props.ImageSettings.validateImageSettings(!0),e=0;return React.DOM.img({src:c.ResourceUrl,title:c.AltText,alt:c.AltText,height:d.ContainerHeight+"px",width:d.ContainerWidth+"px",style:{visibility:"hidden"},onLoad:function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.Image.ImageOnLoad.Success,extraData:{imageType:b.props.ImageType,location:"1"}})},onError:function(d){if(3>e&&"Response"===a.EnvironmentConfig.getPageType()){var f=ReactDOM.findDOMNode(b);e++;var g=c.ResourceUrl+"?"+e;window.setTimeout(function(){$(f).attr("src",g)},1e3)}else a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.Image.ImageOnLoad.Failure,extraData:{imageSrc:c.ResourceUrl,imageType:b.props.ImageType,location:"1"}})}})},d.prototype.applyImageEdit=function(){var b=this,c=this.props.Image&&this.props.Image.Model;if(c&&c.ResourceUrl&&!this.underSyncing()){var d=ReactDOM.findDOMNode(this),f=0;d&&this.props.ImageSettings&&(d.onload=function(){return b.drawImageCanvas()},d.onerror=function(g){if(3>f&&"Response"===a.EnvironmentConfig.getPageType()){f++;var h=c.ResourceUrl+"?"+f;window.setTimeout(function(){$(d).attr("src",h)},1e3)}else{a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.Image.CanvasOnLoad.Failure,extraData:{imageSrc:d.src,imageType:b.props.ImageType,location:"1"}});var i=document.getElementById(e(c));i&&$(i).css("display","none"),$(d).css("visibility","visible")}})}},d.prototype.drawImageCanvas=function(){if(this.mounted){var b=this.props.Image&&this.props.Image.Model;if(b&&b.ResourceUrl&&!this.underSyncing()){var c=ReactDOM.findDOMNode(this);if($(c).siblings("canvas").remove(),c&&this.props.ImageSettings)try{var d=document.createElement("canvas"),f=this.props.ImageSettings.validateImageSettings(!0);null!=b.AltText&&(d.title=b.AltText),d.tabIndex=-1;var g=1*f.NaturalWidth/f.ActualWidth,h=Math.abs(f.Left*g);h=Math.floor(Math.min(h,f.NaturalWidth));var i=Math.abs(f.Top*g);i=Math.floor(Math.min(i,f.NaturalHeight));var j=f.ContainerWidth*g||f.NaturalWidth;j=Math.floor(Math.min(j,f.NaturalWidth));var k=f.ContainerHeight*g||f.NaturalHeight;k=Math.floor(Math.min(k,f.NaturalHeight));try{var l=isNaN(window.devicePixelRatio)?1:window.devicePixelRatio;l=Math.ceil(Math.max(l,g)),d.width=Math.floor(f.ContainerWidth*l),d.height=Math.floor(f.ContainerHeight*l);var m=d.getContext("2d");m.drawImage(c,h,i,j,k,0,0,d.width,d.height)}catch(n){$(c).css("visibility","visible");var o=n.message||void 0,p=n.stack||void 0;return void a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.Image.CanvasRender.Failure,extraData:{imageSrc:c.src,imageType:this.props.ImageType,location:"1",error:o+" "+p,Exception:"DrawImageCanvas"}})}var q=document.getElementById(e(b));q&&$(q).css("display","none"),$(c).css("display","none"),$(c).parent().append(d),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.Image.CanvasRender.Success,extraData:{imageType:this.props.ImageType,location:"1"}}),a.Utilities.OEmbed.notifyResponsePageHeightToParentWindow()}catch(n){var o=n.message||void 0,p=n.stack||void 0;throw a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.Image.CanvasRender.Failure,extraData:{imageSrc:c.src,imageType:this.props.ImageType,location:"1",error:o+" "+p,Exception:"CreateImageCanvas"}}),n}}}},d.prototype.underSyncing=function(){var a=this.props.Image.Model,c=this.props.ImageSettings.Model;return a.ResourceId!==c.TargetResourceId||a.ImageProcessingStatus!==b.Model.ImageProcessingStatus.Idle},d}(a.ReactComponent);a.Exports.ImageRenderer=f}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(e,a)}var d=a.DataProvider.ErrorCode.InnerCode;b.createPollRenderer=c;var e=function(c){function e(a){var d=c.call(this,a)||this;return d.updateScreenSizeClassCallback=function(){return d.updateScreenSizeClass()},d.state={IsSmallScreen:$(window).width()<768,SubmitState:b.PollUtil.isDetailResultView()?b.SubmitState.Succeed:b.SubmitState.NotSubmitted,ShowErrorPage:!1,ResponderEmail:OfficeFormServerInfo.userInfo.Email},d}return __extends(e,c),e.prototype.componentWillMount=function(){this.formRuntimeMaster=new b.Model.FormRuntimeMaster(this.props.Master),this.resetAnswers(),window.addEventListener("resize",this.updateScreenSizeClassCallback)},e.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.updateScreenSizeClassCallback)},e.prototype.render=function(){var c=this;if(this.state.ShowErrorPage)return React.createElement(Forms.UX.Renderer.ErrorPage,{Error:this.error,ErrorType:"Information",FormId:this.props.Master.Model.Id,ShowCreateFormLink:!1});var d,e={className:"office-poll office-form-content office-form-page-padding"};if((this.props.ViewMode===b.ViewMode.Mobile||this.state.IsSmallScreen)&&(e.className=a.Utilities.Html.combineAttributes(e.className,"small-screen")),this.isMobile()&&(e.className=a.Utilities.Html.combineAttributes(e.className,"mobile-view")),this.state.SubmitState===b.SubmitState.Succeed){var f=void 0;this.props.Master.Model.Settings.RequiresUniqueResponse||(f=function(){return c.submitAnotherResponse()}),d=b.createPollResultView({ShowPromotionMessage:!0,submitAnother:f,beforePromotion:function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.ResponsePage.PollResultView.NavigateToPortal})},Form:this.props.Master})}else d=React.DOM.div(null,React.DOM.div({"aria-label":this.props.Master.Model.Title,className:"office-form office-form-theme-shadow",role:"form"},this.createTitleContainer(),React.DOM.div({className:"office-form-body"},this.createNoticeContainer(),React.DOM.div(null,this.createElementRenderers()),this.showCollectEmailTextbox(),this.createSubmitButton(),this.showViewResultLink(),this.createValidationErrorLabel(),this.createErrorMessage())),React.createElement(Forms.UX.Renderer.FooterControl,{FooterType:"ShowStatementWithNotice"}));return React.DOM.div({className:"form-content-container"},React.DOM.div(e,React.createElement(Forms.UX.Renderer.ThemeRender,{ThemeMaster:this.props.Master.ThemeMaster}),d))},e.prototype.createNoticeContainer=function(){return React.DOM.div({className:"office-form-notice-container"},this.createRecordIdentityNotice(),this.createRequiredNotice())},e.prototype.createRecordIdentityNotice=function(){var a=this.props.Master.Model.Settings;if(a.IsAnonymous||a.NotRecordIdentity)return void 0;var c=OfficeFormServerInfo.userInfo.GivenName;return React.DOM.div({},React.DOM.span({className:"office-form-notice-long-text"},b.Resources.LocalizedStrings.Response_NonAnonymous_Notice.format(c)))},e.prototype.createRequiredNotice=function(){return _.some(this.props.Master.Model.Questions,function(a){return a.Required})?React.DOM.div(null,React.DOM.span({className:"office-form-required-notice-star"}),React.DOM.span(null,b.Resources.LocalizedStrings.Answer_Required_Notice)):void 0},e.prototype.createValidationErrorLabel=function(){var c=this.formRuntimeMaster.getQuestionsWithWrongAnswer(this.formRuntimeMaster.TopQuestionRuntimeMasters),d=c.map(function(a){return b.Resources.LocalizedStrings.Form_QuestionWithOrdinal.format(a)}).join(b.Resources.LocalizedStrings.Common_ItemSeperator),e=b.Resources.LocalizedStrings.Form_Question_Error_Message.format(c.length,d),f=a.Control.createFontIconControl({HTMLAttributes:{className:"office-form-alert-icon forms-icon-size24x24"},IconName:"IncidentTriangle"}),g=!!this.state.ShowValidationStyle&&!!c.length;return React.DOM.div({className:a.Utilities.Html.combineAttributes("office-form-submit-error",g?"":"NotVisible"),role:"alert"},f,React.DOM.span({className:"error-message"},g?e:""))},e.prototype.createTitleContainer=function(){return React.DOM.div({className:"office-poll-title-container office-form-theme-primary-background"})},e.prototype.createElementRenderers=function(){var a=this,c=this.state.ShowValidationStyle;return Nerve.convertToArray(this.formRuntimeMaster.Model.QuestionRuntimeMasters).map(function(d,e){var f=d.Question.Model.Id,g={Master:b.Model.exportConverter(d),Ordinal:e+1,Disabled:!1,ExpandAll:!0,key:f,IsMobile:a.isMobile(),ShowValidationStyle:c,ShowQuizResult:!1,HideMedia:!1,IsStudentViewMode:!1};return Forms.UX.Renderer.createRendererElement(g)})},e.prototype.createErrorMessage=function(){var c=a.Control.createFontIconControl({HTMLAttributes:{className:"office-form-alert-icon forms-icon-size24x24"},IconName:"IncidentTriangle"}),d=this.state.SubmitState===b.SubmitState.Failed;return React.DOM.div({className:a.Utilities.Html.combineAttributes("office-form-submit-error",d?"":"NotVisible"),role:"alert"},c,React.DOM.span({className:"error-message"},d?this.state.ErrorMessage:""))},e.prototype.createReloadLink=function(){var a=this;return this.props.Master.Model.Settings.RequiresUniqueResponse?void 0:React.DOM.a({href:"javascript:void(0)",onClick:function(){return a.submitAnotherResponse()}},b.Resources.LocalizedStrings.Response_Submit_Again_Link)},e.prototype.showCollectEmailTextbox=function(){var c=this;return React.DOM.div({className:"design-question-choice-label"},React.DOM.div({className:"poll-email-label"},b.Resources.LocalizedStrings.Response_Poll_Email_Label,React.createElement(a.Control.RequiredStar)),a.Control.createTextField({Value:this.state.ResponderEmail,AutoSelection:!0,Placeholder:b.Resources.LocalizedStrings.Response_Poll_Email_Placeholder,HTMLAttributes:{className:"inline-display poll-email-textbox"},onValueChange:function(a){var b=!a||!a.trim();c.setState({ResponderEmail:a,ShowValidationStyle:b})}}),this.state.ShowValidationStyle?React.DOM.div({className:"poll-email-validation-error"},a.Control.createLabel({HTMLAttributes:{className:"validation-error-message-label",role:"alert"},Label:b.Resources.LocalizedStrings.Response_Poll_Email_ValidationError,Alert:!0})):void 0)},e.prototype.showViewResultLink=function(){var a=this;return React.DOM.span({className:"poll-view-result-link"},React.DOM.a({className:"office-form-info-premotion office-form-info-children",href:"javascript:void(0)",onClick:function(){a.setState({SubmitState:b.SubmitState.Submitting});var c=a.props.Master;$.when(c.ensureFieldsReady([b.Model.FormMaster.Schema.Questions,b.Model.FormMaster.Schema.DescriptiveElements,b.Model.FormMaster.Schema.Responses]),c.syncRuntimeResponses()).then(function(){a.setState({SubmitState:b.SubmitState.Succeed})})}},b.Resources.LocalizedStrings.Response_Poll_ViewResult),this.createSpinner())},e.prototype.createSubmitButton=function(){var c=this,d=this.state.SubmitState===b.SubmitState.Submitting;return React.DOM.div({className:"office-form-bottom-button-div"},a.Control.createTextButton({HTMLAttributes:{className:"office-poll-submit-button office-form-theme-primary-background",disabled:d,onClick:function(){c.submitResponse();var d=c.props.Master.Model,e=function(a,b){return a+(b&&b.Answer?JSON.stringify(b.Answer).length:0)},f=c.formRuntimeMaster.Answers?b.convertToArray(c.formRuntimeMaster.Answers):[];a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.ResponsePage.Form.Submit,extraData:{isPoll:!0,allQuestionCount:d.Questions.length,allAnswersLength:_.reduce(f,e,0)}})}},ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.Response_Poll_VoteButtonText}))},e.prototype.createSpinner=function(){return this.state.SubmitState===b.SubmitState.Submitting?React.DOM.div({className:"poll-submit-spinner"},React.DOM.div({className:"spinner-tile-animation"})):void 0},e.prototype.validateEmail=function(a){var b=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)},e.prototype.submitResponse=function(){var c=this;if(this.formRuntimeMaster.getQuestionsWithWrongAnswer(this.formRuntimeMaster.TopQuestionRuntimeMasters).length>0)return void this.setState({ShowValidationStyle:!0},e.scrollToShowSubmitError);if(!this.state.ResponderEmail||!this.state.ResponderEmail.trim()||!this.validateEmail(this.state.ResponderEmail.trim()))return void this.setState({ShowValidationStyle:!0},e.scrollToShowSubmitError);this.setState({SubmitState:b.SubmitState.Submitting});var f={StartDate:this.startTime,SubmitDate:new Date,Answers:this.formRuntimeMaster.Answers,Responder:this.state.ResponderEmail,ResponderName:this.state.ResponderEmail},g=this.props.Master;g.submitResponse(f).done(function(a){$.when(g.ensureFieldsReady([b.Model.FormMaster.Schema.Questions,b.Model.FormMaster.Schema.DescriptiveElements,b.Model.FormMaster.Schema.Responses]),g.syncRuntimeResponses()).then(function(){c.formRuntimeMaster.Model.QuestionRuntimeMasters;c.setState({SubmitState:b.SubmitState.Succeed,ErrorMessage:void 0})})}).fail(function(e){var f="";if(e.innerCode){if(f=b.Resources.LocalizedStrings["Error_Message_"+e.innerCode]||b.Resources.LocalizedStrings.Error_Inline_DefaultMessage,e.innerCode===d.FormClosed){var g="Inner Message:",h=e.innerMessage.indexOf("Inner Message:")+g.length,i=e.innerMessage.length;f=b.Resources.LocalizedStrings["Error_Message_"+e.innerCode+"_title"]+". "+e.innerMessage.substring(h,i).trim()}e.innerCode===d.EmbedFormNeedAuth&&(f=b.Resources.LocalizedStrings.Error_Inline_RefreshMessage),(e.innerCode===d.CDBTopLevelError||e.innerCode===d.CdbServiceUnavailable)&&(f=b.Resources.LocalizedStrings.Error_Inline_DelayTryMessage)}a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.Error.InlineError.ShowAtSubmitResponse,extraData:{Error:e,ErrorMessage:f||void 0}}),c.setState({SubmitState:b.SubmitState.Failed,ErrorMessage:f})})},e.prototype.submitAnotherResponse=function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.ResponsePage.PollResultView.SubmitAnother}),this.resetAnswers(),this.formRuntimeMaster.updateWithResponse(null),this.setState({ErrorMessage:void 0,ShowValidationStyle:!1,SubmitState:b.SubmitState.NotSubmitted},e.scrollToTop)},e.prototype.resetAnswers=function(a){this.startTime=new Date,this.formRuntimeMaster.Answers=a||[]},e.prototype.isMobile=function(){switch(this.props.ViewMode){case b.ViewMode.Desktop:return!1;case b.ViewMode.Mobile:return!0;case b.ViewMode.Auto:return a.Utilities.isMobile();default:throw Error("unknown view mode")}},e.prototype.updateScreenSizeClass=function(){$(window).width()<=768!==this.state.IsSmallScreen&&this.setState({IsSmallScreen:!this.state.IsSmallScreen})},e.scrollToTop=function(){a.Utilities.Html.scrollToShowSubelement($(".office-form-form-title"),$(".office-form-content"),void 0,void 0,!0)},e.scrollToShowSubmitError=function(){a.Utilities.Html.scrollToShowSubelement($(".office-form-submit-error"),$(".office-form-content"),void 0,20,!0)},e}(a.ReactComponent)}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(e,a)}b.createPollResultView=c;var d,e=function(c){function d(a){var b=c.call(this,a)||this;return b.backgroundColor="#008272",b.watermarkColor="#f4f4f4",b.state={IsRefreshing:!1},b}return __extends(d,c),d.prototype.componentDidMount=function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.ResponsePage.PollResultView.Navigate})},d.prototype.componentDidUpdate=function(){var a=ReactDOM.findDOMNode(this.refs["vote-detail"]);a&&a.focus()},d.prototype.render=function(){var c=this,d=a.Control.createGlyphButton({HTMLAttributes:{onClick:function(){return c.props.submitAnother()}},Icon:"Back",IconClassName:"poll-top-view-back-icon forms-icon-size16x16",GlyphButtonStyle:a.Control.GlyphButtonStyle.Vertical,Text:b.Resources.LocalizedStrings.Response_Poll_Result_Back,TextClassName:"poll-top-view-back-text"});return React.DOM.div({className:"office-poll-result-container"},React.DOM.div({className:"office-poll office-form office-form-theme-shadow office-poll-info-container",role:"main"},React.DOM.div({className:"office-poll-title-container office-form-theme-primary-background"},d),React.DOM.div({className:"poll-result-container office-form-padding-align"},this.createQuestionTitle(),this.createViewResult(),React.DOM.div({className:"office-form-info-other"},this.createRefreshLink()))),React.createElement(Forms.UX.Renderer.FooterControl,{TopExtraContent:this.createPremotionLink()}))},d.prototype.createQuestionTitle=function(){var a=this.props.Form;return React.DOM.div({className:"office-form-question-title"},a.Model.Questions[0]&&a.Model.Questions[0].Title)},d.prototype.createViewResult=function(){var c=this,d=this.props.Form,e=d.Model.Questions[0].ChoiceType===b.Model.ChoiceType.MultiChoice,f=d.Model.Questions[0].AllowOtherAnswer,g=_.map(d.Model.Questions[0].Choices,function(a){return{option:a.Description,voteCount:0,names:[],voted:!1}});f&&g.push({option:"Other",voteCount:0,names:[],otherOptions:[],voted:!1}),_.each(d.Model.Responses,function(c){var d=c.Answers,h=[];e?_.each(a.Utilities.tryParseJson(d[0].Answer),function(a){return h.push(a)}):h.push(d[0].Answer);var i=c.ResponderName||c.Responder||b.Resources.LocalizedStrings.Response_Poll_Result_Anonymous;i&&_.each(h,function(a){var b=_.findIndex(g,function(b){return b.option===a});f&&-1===b&&(b=g.length-1),-1!==b&&(g[b].voteCount+=1,g[b].names.push(i),"otherOptions"in g[b]&&g[b].otherOptions.push(a),i===OfficeFormServerInfo.userInfo.Email&&(g[b].voted=!0))})}),g.sort(function(a,b){return b.voteCount-a.voteCount});var h=_.last(_.filter(g,function(a){return 0!==a.voteCount})),i=(h?h.voteCount:0,_.first(g).voteCount),j=g.map(function(a,d){var e=a.voteCount||0,f=0===i?0:80*e/i,g=String(f)+"%",h=String(100-f)+"%",j=React.DOM.span({className:"office-poll-vote-count-container"},React.DOM.span({className:"poll-result-vote-count"},b.Resources.LocalizedStrings.Response_Poll_Result_VoteCount.format(e))),k=React.DOM.div({className:"poll-result-progressbar-container"},React.DOM.div({className:"poll-result-progressbar-cell",style:{width:g}},React.DOM.a({className:"poll-result-progressbar",style:{backgroundColor:c.backgroundColor}})),React.DOM.div({className:"poll-result-progressbar-cell",style:{width:h}},React.DOM.a({className:"poll-result-progressbar"})));return React.DOM.div({className:"poll-result-option-container",title:a.names.join(b.Resources.LocalizedStrings.Response_Poll_Result_ResponderNameSep),key:a.option},React.DOM.div(null,a.option,a.voted?React.DOM.span({className:"poll-result-voted"},b.Resources.LocalizedStrings.Response_Poll_Voted):void 0,j),k)});return React.DOM.div({className:"poll-result-options-container"},j)},d.prototype.createRefreshLink=function(){var a=this;return React.DOM.div({className:"poll-result-refresh-link"},React.DOM.a({className:"office-form-info-reload office-form-info-children",href:"javascript:void(0)",onClick:function(){var c=a.props.Form;a.setState({IsRefreshing:!0}),$.when(c.ensureFieldsReady([b.Model.FormMaster.Schema.Questions,b.Model.FormMaster.Schema.DescriptiveElements,b.Model.FormMaster.Schema.Responses]),c.syncRuntimeResponses()).then(function(){a.setState({IsRefreshing:!1})})}},b.Resources.LocalizedStrings.Response_Poll_Result_Refresh),this.createSpinner())},d.prototype.createPremotionLink=function(){var c=this;if(!a.Utilities.Flight.isPPTIntegration()){var d={className:"office-form-info-premotion office-form-info-children",
href:"DesignPage.aspx",onClick:function(){return c.props.beforePromotion&&c.props.beforePromotion(),!0}};return(a.Utilities.isOEmbed()||a.Utilities.isOEmbedSPO()||a.EnvironmentSettings.IsExternalIntegration)&&(d.href="javascript:void(0)",d.onClick=function(){c.props.beforePromotion&&c.props.beforePromotion();var b=a.Utilities.getNonEmbedQuery(),d=a.EnvironmentSettings.IsExternalIntegration?"../Pages/DesignPage.aspx":"../Pages/DesignPage.aspx?"+jQuery.param(b);return a.Utilities.Html.safeOpen(a.Utilities.Html.getAbsoluteUrl(d)),!0}),React.DOM.div(null,React.DOM.a(d,b.Resources.LocalizedStrings.Renderer_PromotionMessage))}},d.prototype.createSpinner=function(){return this.state.IsRefreshing?React.DOM.div({className:"poll-submit-spinner"},React.DOM.div({className:"spinner-tile-animation"})):void 0},d}(a.ReactComponent);!function(b){function c(){return"DetailResult"===a.Utilities.Html.getQueries().view}b.isDetailResultView=c}(d=b.PollUtil||(b.PollUtil={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function c(){}return c.createQuizPointLabel=function(a){var c=a.Master.Question.Model,d=a.Master.SubQuestionRuntimeMasters,e=d[d.length-1];if(a.IsStudentViewMode){var f=(e||a.Master).getScore();if(!f&&!c.Point)return void 0;var g=c.Point?c.Point:"-",h=null!=f?f:"-",i=b.Resources.LocalizedStrings.RuntimeView_TotalPoints_Content.format(h,g);return React.DOM.span({className:"office-form-theme-quiz-point"},b.Resources.LocalizedStrings.Quiz_Points_BracketsText.format(i))}if(c.IsQuiz&&!a.HiddenPoint){if(!c.Point)return void 0;if(!a.ShowDesignInfo&&a.ShowQuizResult){var f=(e||a.Master).getScore(),h=null!=f?f:"-",i=b.Resources.LocalizedStrings.RuntimeView_TotalPoints_Content.format(h,c.Point);return React.DOM.span({className:"office-form-theme-quiz-point"},b.Resources.LocalizedStrings.Quiz_Points_BracketsText.format(i))}return React.DOM.span({className:"office-form-theme-quiz-point"},b.RendererHelper.getBracketPointText(c.Point))}},c.createWrongResultLabel=function(d){if(!d.IsMobile){var e=[];if(c.isWrongQuestion(d)){var f=a.Control.createFontIconControl({Accessible:!0,HTMLAttributes:{"aria-label":b.Resources.LocalizedStrings.Response_Preview_WrongReponseIcon.format(d.Ordinal),className:"validation-error-message-wrong-Icon office-form-answerkey"},IconName:"Cancel"});e=[React.DOM.div({className:"validation-error-circle-big"}),React.DOM.div({className:"validation-error-circle-small"}),f]}return(g=React.DOM).div.apply(g,[{"aria-live":"assertive",role:"alert"}].concat(e))}var g},c.isWrongQuestion=function(a){var c=a.Master.Model,d=a.Master.Question.Model,e=d.Type===b.Model.Question.Choice.getElementTypeName(),f=d.Type===b.Model.QuestionType.TextField&&!d.Multiline,g=d.Type===b.Model.QuestionType.Ranking,h=e||f||g,i=d.IsQuiz&&a.ShowQuizResult&&h;return i&&c.QuizResult?!c.QuizResult.IsAnswerCorrect:!1},c}();b.QuizRenderer=c,a.Exports.QuizRenderer=c}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b=function(){function b(){}return b.getBracketPointText=function(b){var c=a.Resources.LocalizedStrings.Quiz_Points_BracketsText_Singular,d=a.Resources.LocalizedStrings.Quiz_Points_BracketsText_Plural,e=1===b?c:d;return e.format(b)},b}();a.RendererHelper=b}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=window.onerror;window.onerror=function(b,d,e,f,g){a.Utilities.OEmbed.notifyFormErrorToParentWindow(g),a.Event.ErrorEventDeprecated.logData({errorName:"UnhandleException",errorInfo:{message:b,fileName:d,lineNo:e,columnNo:f,stack:g&&g.stack}}),c&&c.apply(this,arguments)}}(b=a.Telemetry||(a.Telemetry={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b=function(){function a(){}return a.ENGAGEMENT="engagement_event",a.ERROR="error_event",a.NAVPERF="nav_perf_event",a.QOS="qos_event",a}();a.EventTypes=b}(b=a.Event||(a.Event={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c=function(){function b(){}return b.setLogHandler=function(a){this.buffer.setFunctionToCall(a)},b.logData=function(b,c){void 0===c&&(c=!0),a.Flighting.Flight.isEnabled(a.Flighting.Flights.UseRefactoredTelemetry)?Forms.Telemetry.log({eventName:b.name,eventType:"nav_perf_event",extraData:b.extraData}):this.buffer.queue(b,c)},b.buffer=new a.Utilities.Process.BufferForCall,b}();b.NavPerfEventDeprecated=c}(b=a.Event||(a.Event={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b=function(){function a(){this.Duration=0,this.TimeStamp=0,this.EventCorrelationId="",this.Properties=""}return a}();a.TelemetryProperties=b}(b=a.Telemetry||(a.Telemetry={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(){i.initialize()}function d(){return i&&i.SessionId}function e(){var a=$.Deferred();return i?i.flush(function(){return a.resolve()}):a.resolve(),a.promise()}function f(){var b=a.EnvironmentSettings.GetHostString();if(b)return b;var c=a.Utilities.Html.getQueries().origin;if(c)return c;var d=a.Utilities.Html.getQueries().oembedsso;return d?"Forms WebPart":a.Utilities.Flight.isPPTIntegration()?"PowerPoint":void 0}b.deprecatedInitializeTelemetry=c,b.getCurrentSessionId=d,b.flushLogs=e,b.getOrigin=f;var g;!function(a){a[a.Designer=0]="Designer",a[a.Responder=1]="Responder",a[a.Unknown=2]="Unknown",a[a.AnalyzeViewer=3]="AnalyzeViewer",a[a.TeamsConfigUser=4]="TeamsConfigUser"}(g||(g={}));var h=function(){function c(){this.sessionId=a.Utilities.Guid.newGuid(),this.sessionDbId="",this.sessionDeviceId="",this.initialized=!1}return Object.defineProperty(c.prototype,"SessionId",{get:function(){return this.sessionId},enumerable:!0,configurable:!0}),c.prototype.flush=function(a){this.initialized?AWTLogManager.flush(a):a()},c.prototype.initialize=function(){var b=this;this.msaTenantIdInUpperCase=a.EnvironmentConfig.getMsaTenantId().toUpperCase(),this.userRole=this.getSessionRole(),this.userType=a.DataProvider.Models.UserType.Unknown,a.EnvironmentConfig.isOsi()&&a.DataProvider.FeaturePlanProvider.getUserType().done(function(a){return b.userType=a}).always(function(){var c={disableCookiesUsage:!0};switch(a.EnvironmentConfig.getEnvironmentType()){case"USGovProd":c.collectorUri="https://tb.pipe.aria.microsoft.com/Collector/3.0";break;case"USDoDProd":c.collectorUri="https://pf.pipe.aria.microsoft.com/Collector/3.0"}var d=b.getCollectorToken();AWTLogManager.initialize(d,c),b.initialized=!0,b.logger=AWTLogManager.getLogger(d),a.Event.EngagementEventDeprecated.setLogHandler(b.handleEngagementEvent.bind(b)),a.Event.ErrorEventDeprecated.setLogHandler(b.handleErrorEvent.bind(b)),a.Event.NavPerfEventDeprecated.setLogHandler(b.handleNavPerfEvent.bind(b)),a.Event.QosEventDeprecated.setLogHandler(b.handleQosEvent.bind(b))})},c.prototype.handleEngagementEvent=function(c){var d=new b.TelemetryProperties;d.EventType=a.Event.EventTypes.ENGAGEMENT,d.EventName=(c&&c.name||"no_EngagementName").replace(" ",""),d.EventCorrelationId=a.Utilities.Guid.newGuid(),d.TimeStamp=a.Utilities.DateTime.getTimeStamp(),c&&(d.Properties=JSON.stringify(c.extraData)),this.logEvent(d)},c.prototype.handleErrorEvent=function(c){var d=new b.TelemetryProperties;d.EventType=a.Event.EventTypes.ERROR,d.EventName="no_ErrorName",c&&(d.EventName=c.errorName,d.Properties=JSON.stringify(c.errorInfo||{})),d.EventCorrelationId=a.Utilities.Guid.newGuid(),d.TimeStamp=a.Utilities.DateTime.getTimeStamp(),this.logEvent(d)},c.prototype.handleQosEvent=function(c,d){var e=new b.TelemetryProperties;if(e.EventType=a.Event.EventTypes.QOS,e.TimeStamp=a.Utilities.DateTime.getTimeStamp(),e.EventName="no_QosName",c)if(null!=c.Name&&(e.EventName=c.Name,e.EventName=e.EventName.replace(" ","")),null!=c.CorrelationId&&(e.EventCorrelationId=c.CorrelationId),c.Data&&c.Data.extraData&&(e.Properties=JSON.stringify(c.Data.extraData)),d===a.Event.QosEventType.Start)e.EventName+="."+a.Event.QosEventType[a.Event.QosEventType.Start];else if(d===a.Event.QosEventType.Log)e.EventName+="."+a.Event.QosEventType[a.Event.QosEventType.Log],c.Data.resultCode&&(e.EventName+="."+c.Data.resultCode);else if(d===a.Event.QosEventType.End)switch(c.Data.resultType){case"Success":case"Failure":case"ExpectedFailure":e.EventName+="."+c.Data.resultType}else e.EventName="no_eventData";d===a.Event.QosEventType.End&&(e.Duration=c.Duration),this.logEvent(e)},c.prototype.handleNavPerfEvent=function(c,d){var e=new b.TelemetryProperties;e.EventType=a.Event.EventTypes.NAVPERF,e.EventName=c&&c.name||"no_NavPerfName",e.EventCorrelationId=a.Utilities.Guid.newGuid(),e.TimeStamp=a.Utilities.DateTime.getTimeStamp(),c&&(d&&this.setCommonNavPerfExtraData(c),e.Properties=JSON.stringify(c.extraData)),this.logEvent(e)},c.prototype.enrichSessionInfo=function(b){if(b.Properties){var c=JSON.parse(b.Properties);c&&(this.sessionDbId=c.DbId,this.sessionDeviceId=c.DeviceId)}var d={};d.DbId=this.sessionDbId,d.DeviceId=this.sessionDeviceId,d.BuildVersion=this.getBuildVersion(),d.SessionRing=this.getSessionRing(),d.SessionUrlPath=window.location.origin+window.location.pathname,d.UserAgent=navigator.userAgent,d.IsMobile=a.Utilities.isMobile(),d.Origin=a.Telemetry.getOrigin(),d.JQueryLoaded=!!window.$;var e=a.Event.EngagementEventDeprecated.EVENTNAME_SESSION_START;b.EventType=e,b.EventName=e,b.Duration=0,b.Properties=JSON.stringify(d),b.TimeStamp=a.Utilities.DateTime.getTimeStamp()},c.prototype.logEvent=function(b){b.EventName===a.Event.EngagementEventDeprecated.EVENTNAME_SESSION_START&&this.enrichSessionInfo(b),this.logEventWorker(b)},c.prototype.logEventWorker=function(b){var d=new AWTEventProperties;d.setName(b.EventType),d.setProperty(c.EVENT_NAME_KEY,b.EventName),d.setProperty(c.EVENT_CORRELATION_ID_KEY,b.EventCorrelationId),d.setProperty(c.EVENT_DURATION_KEY,this.getNumberAsString(b.Duration)),d.setProperty(c.EVENT_TIMESTAMP_KEY,this.getNumberAsString(b.TimeStamp)),d.setProperty(c.EVENT_DATA_KEY,b.Properties),b.EventName&&b.EventName.indexOf(a.Event.EngagementEventDeprecated.IntelligenceStatistic)>=0?this.sendSingleTelemetryEventWithoutUserInfo(d):this.sendSingleTelemetryEvent(d)},c.prototype.sendSingleTelemetryEventWithoutUserInfo=function(b){a.Telemetry.getOrigin()!==a.HostApps[a.HostApps.OneNoteUwp]&&(b.setProperty(c.SOURCE_APP_KEY,c.APPLICATION_NAME),b.setProperty(c.USER_ROLE_ID,this.userRole),b.setProperty(c.USER_TYPE_KEY,this.userType),this.logger.logEvent(b))},c.prototype.sendSingleTelemetryEvent=function(b){if(a.Telemetry.getOrigin()!==a.HostApps[a.HostApps.OneNoteUwp]){var d=OfficeFormServerInfo.userInfo.UserId,e=OfficeFormServerInfo.userInfo.TenantId,f=Forms.Common.getCurrentFormId();if(b.setProperty(c.SOURCE_APP_KEY,c.APPLICATION_NAME),b.setProperty(c.USER_ID_KEY,d),b.setProperty(c.USER_TENANT_ID_KEY,e),b.setProperty(c.USER_ROLE_ID,this.userRole),b.setProperty(c.USER_TYPE_KEY,this.userType),b.setProperty(c.FORM_ID_KEY,f),b.setProperty(c.SESSION_ID_KEY,this.sessionId),e)if(e.toUpperCase()===this.msaTenantIdInUpperCase){var g=OfficeFormServerInfo.userInfo.PUID;b.setProperty(c.USERINFO_ID_KEY,g),b.setProperty(c.USERINFO_IDTYPE_KEY,"MSAPUID")}else b.setProperty(c.USERINFO_ID_KEY,d),b.setProperty(c.USERINFO_IDTYPE_KEY,"UserObjectId"),b.setProperty(c.USERINFO_OMSTENANTID_KEY,e);else!d&&a.Flighting.Flight.isEnabled(a.Flighting.Flights.EnableMuidForAnonymousUsers)&&b.setProperty(c.MUID_KEY,a.Muid.Instance.Muid);this.logger.logEvent(b)}},c.prototype.getCollectorToken=function(){var b=a.EnvironmentConfig.getEnvironmentType();switch(b){case"Int":return c.ARIA_INT_TOKEN;case"EDog":return c.ARIA_EDOG_TOKEN;case"WWProd":return a.DataProvider.FeaturePlanProvider.isMsaUser()||Forms.Common.isOwnerMsaUser()?c.ARIA_PROD_RING2_TOKEN:c.ARIA_PROD_TOKEN;case"USGovGccProd":return c.ARIA_GCC_TOKEN;case"USGovProd":return c.ARIA_GCCHigh_TOKEN;case"USDoDProd":return c.ARIA_DoD_TOKEN;default:return c.ARIA_SANDBOX_TOKEN}},c.prototype.getBuildVersion=function(){return OfficeFormServerInfo.version},c.prototype.getSessionRing=function(){var b=a.EnvironmentConfig.getEnvironmentType();switch(b){case"Int":return"Int";case"EDog":return"PreProd";case"WWProd":case"USGovProd":return"Prod";default:return"DevEnv"}},c.prototype.getNumberAsString=function(a){return isNaN(a)||void 0===a||null===a?"0":a.toString()},c.prototype.getSessionRole=function(){var b=a.EnvironmentConfig.getPageType();switch(b){case"Design":return g.Designer;case"Response":return g.Responder;case"Analyze":return g.AnalyzeViewer;case"TeamsConfig":return g.TeamsConfigUser;default:return g.Unknown}},c.prototype.setCommonNavPerfExtraData=function(a){if(a.extraData=a.extraData||{},window.performance){var b=window.performance.timing,c={navigationType:window.performance.navigation.type};c.navigationStart=b.navigationStart,c.unloadEventStart=b.unloadEventStart-b.navigationStart,c.unloadEventEnd=b.unloadEventEnd-b.navigationStart,c.redirectStart=0===b.redirectStart?0:b.redirectStart-b.navigationStart,c.redirectEnd=0===b.redirectEnd?0:b.redirectEnd-b.navigationStart,c.fetchStart=b.fetchStart-b.navigationStart,c.domainLookupStart=b.domainLookupStart-b.navigationStart,c.domainLookupEnd=b.domainLookupEnd-b.navigationStart,c.connectStart=b.connectStart-b.navigationStart,c.connectEnd=b.connectEnd-b.navigationStart,c.requestStart=b.requestStart-b.navigationStart,c.responseStart=b.responseStart-b.navigationStart,c.responseEnd=b.responseEnd-b.navigationStart,c.domLoading=b.domLoading-b.navigationStart,c.domInteractive=b.domInteractive-b.navigationStart,c.domContentLoadedEventStart=b.domContentLoadedEventStart-b.navigationStart,c.domContentLoadedEventEnd=b.domContentLoadedEventEnd-b.navigationStart,c.domComplete=b.domComplete-b.navigationStart,c.loadEventStart=b.loadEventStart-b.navigationStart,c.loadEventEnd=b.loadEventEnd-b.navigationStart,a.extraData.rawTiming=c}},c.APPLICATION_NAME="Office Forms BrowserApp",c.SOURCE_APP_KEY="source_application",c.SESSION_ID_KEY="session_id",c.USER_ID_KEY="user_id",c.USER_TENANT_ID_KEY="user_tenant_id",c.USER_ROLE_ID="user_role",c.USER_TYPE_KEY="user_type",c.FORM_ID_KEY="form_id",c.EVENT_NAME_KEY="event_name",c.EVENT_CORRELATION_ID_KEY="event_correlation_id",c.EVENT_TIMESTAMP_KEY="timestamp",c.EVENT_DURATION_KEY="duration",c.EVENT_DATA_KEY="properties",c.USERINFO_ID_KEY="UserInfo.Id",c.USERINFO_IDTYPE_KEY="UserInfo.IdType",c.USERINFO_OMSTENANTID_KEY="UserInfo.OMSTenantId",c.MUID_KEY="MUID",c.ARIA_SANDBOX_TOKEN="e132e188c609439ab47cd7b06511fc0a-433f81b3-fab9-415a-882a-ba9e2f91abea-6917",c.ARIA_INT_TOKEN="79beea9c4fdb49a5adab4843729e1fa0-19b42cd4-5bd4-4bf8-8e49-05dc0f7f97f8-7484",c.ARIA_EDOG_TOKEN="725da52713e94a7f8c04e11418b8378d-67b7892c-33c8-439c-a03e-bd0305e0bc8e-6732",c.ARIA_PROD_TOKEN="2ddc7e5f54754fc68f3ae1c5b7f3eb20-1883aa8c-4c7b-42d1-b3d6-c9cdb5956783-7092",c.ARIA_PROD_RING2_TOKEN="5f4ebf0f9a11474199e89f94bc7e2f50-61b8420a-22b1-4220-b531-4a4b96e4edb9-7406",c.ARIA_GCC_TOKEN="aa96061debfd4ec7b9704f62060b4ca6-a498d428-fdba-43da-bc8b-4fe51865cb7f-7984",c.ARIA_GCCHigh_TOKEN="577e32a3275e48c5a639a92c9a8af033-4028cb75-b5f4-4ad0-835e-0e26d79ff209-6823",c.ARIA_DoD_TOKEN="291cebec6b9a4cbf9489bc8cf3a0cc50-06f4c682-bd49-4f88-a8c2-ac582180b7f9-7725",c}(),i=new h;a.Exports.Telemetry=b}(b=a.Telemetry||(a.Telemetry={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){a.Exports.Event=b}(b=a.Event||(a.Event={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(){}return a.DefaultPage="Endpoint.DefaultPage",a.DesignPagePortalView="Endpoint.DesignPagePortalView",a.ResponsePage="Endpoint.ResponsePage",a.SurveyAnalyzePage="Endpoint.SurveyAnalyzePage",a.ShareAnalysisPage="Endpoint.ShareAnalysisPage",a.OutlookCreatePollPage="Endpoint.OutlookCreatePollPage",a}();a.Endpoints=b}(b=a.Scenario||(a.Scenario={}))}(b=a.NavPerfEventNames||(a.NavPerfEventNames={}))}(b=a.Event||(a.Event={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return React.createElement(h,__assign({},a))}var e="formLauncher",f="appLauncherButton";c.createAppLauncher=d;var g;!function(a){a[a.Loading=0]="Loading",a[a.Error=1]="Error"}(g||(g={}));var h=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;return a.maxRetryCount=1,a.state={LoadingStatus:g.Loading,ShowMenu:!1},a.collapseAppLauncherCallback=function(b){return a.collapseAppLauncher(b)},a}return __extends(d,c),d.prototype.componentDidMount=function(){var b=this;OfficeFormServerInfo.userInfo.IsMsa?a.Flighting.Flight.isEnabled(a.Flighting.Flights.O365ConsumerWaffle)&&a.O365ShellService.getConsumerShellServiceInfo(function(){b.setState({LoadingStatus:g.Error})},this.maxRetryCount):a.O365ShellService.getShellServiceInfo(function(){b.setState({LoadingStatus:g.Error})},this.maxRetryCount)},d.prototype.render=function(){var c=this,d={HTMLAttributes:{className:"headbar-waffle","aria-haspopup":"true",onClick:function(){return c.onAppLauncherButtonClick()}},ButtonStyle:a.Control.ButtonStyle.DarkBackGround,GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly,Icon:"Waffle",IconClassName:"headbar-waffle-icon",Text:b.Resources.LocalizedStrings.HeaderBar_AppSwitcher,ref:f};return React.createElement("div",{className:"headbar-waffle-container"},a.Control.createGlyphButton(d),this.createMenuView())},d.prototype.collapseAppLauncher=function(b){if(this.state.ShowMenu){var c=b.target,d=b,g=ReactDOM.findDOMNode(this.refs[e]),h=ReactDOM.findDOMNode(this.refs[f]);(d&&d.keyCode===a.KeyCode.Esc||g&&!g.contains(c)&&h&&!h.contains(c))&&this.forceCollapseAppLauncher()}},d.prototype.forceCollapseAppLauncher=function(){var a=ReactDOM.findDOMNode(this.refs[e]);$(a).addClass("hide"),this.state.ShowMenu=!1,this.props.AppLauncherCollapseTrigger&&this.props.AppLauncherCollapseTrigger.unregister(this.collapseAppLauncherCallback),this.state.LoadingStatus===g.Error&&this.setState({ShowMenu:this.state.ShowMenu})},d.prototype.onAppLauncherButtonClick=function(){var b=ReactDOM.findDOMNode(this.refs[e]);this.state.ShowMenu?($(b).addClass("hide"),this.props.AppLauncherCollapseTrigger&&this.props.AppLauncherCollapseTrigger.unregister(this.collapseAppLauncherCallback)):($(b).removeClass("hide"),a.O365ShellService.setFocus(),this.props.AppLauncherCollapseTrigger&&this.props.AppLauncherCollapseTrigger.register(this.collapseAppLauncherCallback)),this.state.ShowMenu=!this.state.ShowMenu,this.state.LoadingStatus===g.Error&&this.setState({ShowMenu:this.state.ShowMenu})},d.prototype.createMenuView=function(){var a={className:"swBar SwitcherLoading UnifiedHeader O365Switcher hide",id:e,ref:e,tabIndex:-1};return this.state.LoadingStatus===g.Loading?React.createElement("div",__assign({},a),React.createElement("span",{className:"swLoadingText"},b.Resources.LocalizedStrings.PortalView_CreateNew_Loading),React.createElement("span",{className:"border-arrow arrow"}),React.createElement("span",{className:"arrow"})):(this.state.ShowMenu&&(a.className="swBar SwitcherError UnifiedHeader O365Switcher"),React.createElement("div",__assign({},a),React.createElement("span",{className:"swLoadingErrorText"},React.createElement("span",{className:"swErrorTitle"},b.Resources.LocalizedStrings.Error_Page_DefaultErrorTitle),React.createElement("br",null),React.createElement("span",{className:"swErrorBody"},b.Resources.LocalizedStrings.Error_Page_DefaultRefreshMessage)),React.createElement("span",{className:"border-arrow arrow"}),React.createElement("span",{className:"arrow"})))},d}(a.ReactComponent);c.AppLauncher=h}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(){return j||(j=new k)}function e(){var a=d().Model;"ImagePicker"===a.FlexPane&&(a.FlexPane="None")}function f(){var a=d().Model,b="None"===a.FlexPane&&"ImagePicker"===a.PreviousFlexPane;return b&&(a.FlexPane="None"),b}function g(a){var b=d();b.startBulkEditMode(),b.Model.SelectedPortalForm=a,b.Model.FlexPane="MoveFormPane",b.endBulkEditMode()}function h(a){if(a&&a.Synchronizer.Model.CreationFailed){var b=d().Model;!b.CriticalError&&b.ErrorBarMessage&&d().hideErrorMessageBar("SaveForm",a.getInstanceId())}}var i;!function(a){a[a.Action=0]="Action",a[a.Analysis=1]="Analysis",a[a.CriticalError=2]="CriticalError",a[a.ErrorBarMessage=3]="ErrorBarMessage",a[a.FlexPane=4]="FlexPane",a[a.FormId=5]="FormId",a[a.FormMaster=6]="FormMaster",a[a.FormList=7]="FormList",a[a.FormListLoadState=8]="FormListLoadState",a[a.FormCollectionType=9]="FormCollectionType",a[a.FormsTenantSettings=10]="FormsTenantSettings",a[a.Grading=11]="Grading",a[a.InfoBarMessageType=12]="InfoBarMessageType",a[a.Preview=13]="Preview",a[a.PlaceholderList=14]="PlaceholderList",a[a.PreviousFlexPane=15]="PreviousFlexPane",a[a.QtiFormCreationStatus=16]="QtiFormCreationStatus",a[a.RecycleBin=17]="RecycleBin",a[a.SharedWithMeFormList=18]="SharedWithMeFormList",a[a.SharedWithMeFormListLoadState=19]="SharedWithMeFormListLoadState",a[a.GroupMruFormListLoadState=20]="GroupMruFormListLoadState",a[a.Store=21]="Store",a[a.Title=22]="Title",a[a.TopView=23]="TopView",a[a.XlWorkbookId=24]="XlWorkbookId",a[a.GroupMaster=25]="GroupMaster",a[a.Host=26]="Host",a[a.SelectedPortalForm=27]="SelectedPortalForm",a[a.SearchContent=28]="SearchContent"}(i=c.UxStateFields||(c.UxStateFields={}));var j;c.getUxStateMaster=d,c.hideImagePicker=e,c.isImagePickerHiding=f;var k=function(c){function e(){var a=c.call(this,i)||this,b=a.Model;return a.startBulkEditMode(),b.Analysis=!1,b.Store=!1,b.Grading=void 0,b.FormListLoadState="NotStarted",b.SharedWithMeFormListLoadState="NotStarted",b.GroupMruFormListLoadState="NotStarted",b.FormCollectionType="OwnedForms",b.FormsTenantSettings={externalCollaboration:!0,externalShareCollaboration:!0,externalSendForm:!0,externalShareResult:!0,externalShareTemplate:!0,educationResourcesEnabled:!1,recordIdentityByDefault:!0},a.endBulkEditMode(),a}return __extends(e,c),e.prototype.setFieldValue=function(a,b){if(a===i.ErrorBarMessage)throw Error("Call showErrorMessageBar or hideErrorMessageBar instead.");if(a===i.FormMaster&&!b)return void this.clearFormRelatedRoutingFields();if(a===i.PreviousFlexPane)throw Error("Field PreviousFlexPane is readonly.");a===i.FlexPane&&c.prototype.setFieldValue.call(this,i.PreviousFlexPane,c.prototype.getFieldValue.call(this,a)),c.prototype.setFieldValue.call(this,a,b)},e.prototype.showErrorMessageBar=function(b,d,e){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.Error.ErrorMessageBar.Show,extraData:{Scenario:b,ErrorCode:d,Key:e}}),this.lastErrorMessageScenario=b,this.lastErrorMessageKey=e,c.prototype.setFieldValue.call(this,i.ErrorBarMessage,this.getErrorBarMessage(d))},e.prototype.hideErrorMessageBar=function(b,d){b===this.lastErrorMessageScenario&&d===this.lastErrorMessageKey&&(a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.Error.ErrorMessageBar.Hide,extraData:{Scenario:b,Key:d}}),this.lastErrorMessageScenario=void 0,this.lastErrorMessageKey=void 0,c.prototype.setFieldValue.call(this,i.ErrorBarMessage,void 0))},e.prototype.showInfoMessageBar=function(a){c.prototype.setFieldValue.call(this,i.InfoBarMessageType,a)},e.prototype.hideInfoMessageBar=function(){c.prototype.setFieldValue.call(this,i.InfoBarMessageType,void 0)},e.prototype.clearActionRelatedFields=function(){var a=this.Model;this.startBulkEditMode(),a.Action="NoAction",a.Title=void 0,a.XlWorkbookId=void 0,this.endBulkEditMode()},e.prototype.showTopView=function(a,b){this.Model.TopView=a,this.topViewCloseCallback=b},e.prototype.hideTopView=function(){this.Model.TopView="None"},e.prototype.resetTopViewCloseCallback=function(){var a=this.topViewCloseCallback;return this.topViewCloseCallback=null,a},e.prototype.collapseFlexPaneIfNeeded=function(a){var b=d().Model,c=b.FlexPane;if("None"!==c){var e="flex-pane-container-"+c,f=document.getElementById(e);f&&!f.contains(a)&&(b.FlexPane="None")}},Object.defineProperty(e.prototype,"FieldOptions",{get:function(){return{ArrayFields:[{Field:i.FormList},{Field:i.RecycleBin},{Field:i.SharedWithMeFormList},{Field:i.PlaceholderList}]}},enumerable:!0,configurable:!0}),e.prototype.clearFormRelatedRoutingFields=function(){var a=this.Model;this.startBulkEditMode(),c.prototype.setFieldValue.call(this,i.FormMaster,void 0),a.Analysis=!1,a.Store=!1,a.Grading=void 0,a.Preview=void 0,a.FlexPane="None",this.endBulkEditMode()},e.prototype.getErrorBarMessage=function(a){var c=b.Resources.LocalizedStrings,d=a&&c["Error_Message_"+a];return d||c["Error_Bar_Message_"+this.lastErrorMessageScenario]},e}(b.Model_v2.MasterBase);c.showMovePane=g,c.hideFormErrorMessageBar=h,a.Exports.hideFormErrorMessageBar=h}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c;!function(b){function c(a,b,c){for(var e=a,f=d(a);_.contains(c,e);)e=b.format(f.BaseName,++f.Count);return e}function d(a){var b=a+" ",c=1,d=a.lastIndexOf("(");return a&&")"===a.slice(-1)&&d>=0&&parseInt(a.slice(d+1,a.length-1))&&(c=parseInt(a.slice(d+1,a.length-1)),b=a.slice(0,d)),{BaseName:b,Count:c}}a.Exports.AutoRename=b,b.getUniqueNameFromList=c}(c=b.AutoRename||(b.AutoRename={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return React.createElement(f,a)}var e=b.Model.SavingStateValues;c.createAutoSaving=d;var f=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;return a.savingStateChangeCallback=function(){return a.forceUpdate()},a}return __extends(d,c),d.prototype.componentWillMount=function(){this.props.Form.observe(this.savingStateChangeCallback,[b.Model.FormMaster.Schema.IntegratedSavingState])},d.prototype.componentWillUnmount=function(){this.props.Form.unobserve(this.savingStateChangeCallback)},d.prototype.render=function(){var b=_.extend({},this.props.HTMLAttributes);return b.className=a.Utilities.Html.combineAttributes(b.className,"saving-state"),b["aria-live"]="polite",React.DOM.div(b,this.createRefreshSpinner(),this.getDisplayText())},d.prototype.createRefreshSpinner=function(){var b=this.props.Form.Model.IntegratedSavingState;return b===e.Saving||b===e.Scheduled?a.Control.createFontIconControl({HTMLAttributes:{className:"auto-saving-icon forms-icon-size14x14"},IconName:"Sync"}):void 0},d.prototype.getDisplayText=function(){switch(this.props.Form.Model.IntegratedSavingState){case e.Saving:case e.Scheduled:return b.Resources.LocalizedStrings.Designer_AutoSaver_Saving;case e.Failed:case e.NotStarted:return null;case e.Idle:return b.Resources.LocalizedStrings.Designer_AutoSaver_Saved;default:Nerve.Debugger.throwError("Not supported")}},d}(a.ReactComponent)}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){var d=c.getUxStateMaster();a.existingOnServerSide().fail(function(a){return d.Model.CriticalError=a});var g=a.Synchronizer;g.observe(function(b){_.contains(b.FieldSchemas,g.Schema.UpdateError)&&f(a.Deleted?"DeleteForm":"SaveForm",g.Model.UpdateError,a.getInstanceId())},[g.Schema.UpdateError]),a.fieldsReady([b.Model.FormMaster.Schema.Questions]).done(function(){a.FormElementManager.AllElementMasters.forEach(e);var c=Nerve.getCollectionMasterFromModel(a.Model.Questions);c.observe(function(a){a.AddedModels.map(b.Model.getQuestionMaster).forEach(e)})}),a.fieldsReady([b.Model.FormMaster.Schema.DescriptiveElements]).done(function(){a.FormElementManager.DescriptiveElementMasters.forEach(e);var b=Nerve.getCollectionMasterFromModel(a.Model.DescriptiveElements);b.observe(function(a){a.AddedModels.map(Forms.Models.getDescriptiveElementMaster).forEach(e)})})}function e(a){var b=a,c=(b.Model,b.Synchronizer);c.observe(function(){b.Deleted||(f("CreateQuestion",c.Model.CreationError,b.getInstanceId()),b.observe(function(){b.Deleted&&f("CreateQuestion",null,b.getInstanceId())}))},[c.Schema.CreationError]),c.observe(function(a){_.contains(a.FieldSchemas,c.Schema.UpdateError)&&f(b.Deleted?"DeleteQuestion":"SaveQuestion",c.Model.UpdateError,b.getInstanceId())},[c.Schema.UpdateError])}function f(a,b,d){var e=c.getUxStateMaster();b?e.showErrorMessageBar(a,b.innerCode,d):e.hideErrorMessageBar(a,d)}function g(b,c,d){if("string"!=typeof c&&(c=""),-1!==c.indexOf("mathquill")||c.toLowerCase().match(/officebrowserfeedback_floodgate\.js$/))return!1;if(b.match("jQuery.*is not a function.*"))return!1;var e=a.EnvironmentConfig.isProduction();return e?"Script error."!==b&&"Script error"!==b||!c.match(/\/jsll-4\.js$/)&&c?h(c,d&&d.stack)?(a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.Error.ErrorPage.ErrorOutOfOrigin,extraData:{message:b,fileName:c,origin:window.location.origin,stack:d&&d.stack}}),!1):"SyntaxError"===b&&a.Utilities.isEdge()&&e&&c&&-1===c.indexOf(".js")?!1:!0:!1:!0}function h(b,c){var d=window.location.origin,e=!!c&&-1===c.indexOf(d);if(!b||-1===b.indexOf(".js"))return e;var f=-1===b.indexOf(d);return c&&f!==e&&a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.Error.ErrorPage.OriginErrorJudgementNotMatch,extraData:{fileName:b,stack:c}}),e||f}c.observeFormErrors=d;var i=window.onerror;window.onerror=function(a,b,d,e,f){try{g(a,b,f)&&(f=f||new Error(a),window.setTimeout(function(){c.getUxStateMaster().Model.CriticalError||(c.getUxStateMaster().Model.CriticalError=f)}))}catch(h){}i&&i.apply(this,arguments)}}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){a.Model.Title=e(a.Model.Title),f.concatToFormList(b.Model.exportConverter(a))}function e(a){var d=c.getUxStateMaster(),e=d.Model.FormList.map(function(a){return a.Model.Title}),f=d.Model.PlaceholderList.map(function(a){return a.Title});return c.AutoRename.getUniqueNameFromList(a,b.Resources.LocalizedStrings.Designer_Title_autoRenameFormat,e.concat(f))}var f=function(){function d(){this.createForm=this.createForm.bind(this),this.deleteForm=this.deleteForm.bind(this),this.duplicateForm=this.duplicateForm.bind(this),this.restoreFromRecycleBin=this.restoreFromRecycleBin.bind(this),this.moveToRecycleBin=this.moveToRecycleBin.bind(this),this.changeFormOwner=this.changeFormOwner.bind(this)}return d.triggerReadProcess=function(e,f){var g=c.getUxStateMaster().Model;if(!g.FormId)return"NotStarted"===g.FormListLoadState&&d.getAllForms(!e,f),void(e||OfficeFormServerInfo.userInfo.IsMsa||(a.EnvironmentConfig.isUSGovGccProd()||d.getGroupMruForms(),"NotStarted"===g.SharedWithMeFormListLoadState&&d.getFormSharedWithMe()));if(!g.FormMaster||g.FormMaster.isFieldReady(b.Model.FormMaster.Schema.Id)&&g.FormMaster.Model.Id!==g.FormId){var h=d.updateOrCreateFormMaster({Id:g.FormId});h.ensureReadyToDesign(),g.FormMaster=h}},d.getDeletedUserByIdorEmail=function(b){var c=a.DataProvider.ProviderManager.getInstance().createDataProvider();return c.getDeletedUserByIdOrEmail(b)},d.addDefaultHeader=function(b,c){a.DataProvider.ProviderManager.getInstance().createDataProvider();return a.DataProvider.FormApi.addDefaultHeader(b,c)},Object.defineProperty(d.prototype,"GroupMruDocumentManager",{get:function(){return d.GroupMruDocumentManager},enumerable:!0,configurable:!0}),Object.defineProperty(d,"GroupMruDocumentManager",{get:function(){return Forms.Mru.MruDocumentManager.getInstance()},enumerable:!0,configurable:!0}),d.getAllForms=function(e,f){void 0===e&&(e=!0),void 0===f&&(f=null);var g=c.getUxStateMaster(),h=g.Model;h.FormListLoadState="Loading";var i=b.Model.FormMaster.Schema,j=[i.Id,i.Title,i.Modified,i.Settings,i.XlWorkbookId,i.OwnerId,i.OwnerTenantId,i.Category,i.Theme,i.SoftDeleted,i.Type],k=b.Model.FormDataSource.getAllForms(j,f),l=e?b.Model.FormDataSource.getAllFormsResponseCount():null;
return k.fail(function(a){return h.CriticalError=a}).then(function(b){g.startBulkEditMode(),h.FormListLoadState="Loaded";var c=b.map(function(a){return d.updateOrCreateFormMaster(a)});l&&c.forEach(function(a){var b=l.then(function(b){var c=_.find(b,function(b){return b.id===a.Model.Id});if(!c){var d=new Error("Response count not found in the list.");return $.Deferred().reject(d).promise()}return{rowCount:c.responseCount}});a.Synchronizer.setFieldsQueryJob([a.Schema.RowCount],b)}),h.FormList=_.uniq(h.FormList.concat(c.filter(function(a){return a.isNotSoftDeleted()}))),h.RecycleBin=_.uniq(h.RecycleBin.concat(c.filter(function(a){return a.isSoftDeleted()}))),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PortalPage.MyForms.FormCount,extraData:{count:h.FormList.length,softDeletedCount:h.RecycleBin.length}}),g.endBulkEditMode()})},d.getFormSharedWithMe=function(){var e=c.getUxStateMaster(),f=e.Model;return f.SharedWithMeFormListLoadState="Loading",b.Model.FormDataSource.getAllSharedWithMeForms().fail(function(a){return f.CriticalError=a}).then(function(b){e.startBulkEditMode(),f.SharedWithMeFormListLoadState="Loaded";var c=b.map(function(a){return d.updateOrCreateFormMaster(a)});f.SharedWithMeFormList=_.uniq(f.SharedWithMeFormList.concat(c)),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PortalPage.OtherForms.FormCount,extraData:{count:f.SharedWithMeFormList.length}}),e.endBulkEditMode()})},d.getGroupMruForms=function(){var a=c.getUxStateMaster(),b=a.Model;"NotStarted"===b.GroupMruFormListLoadState&&(b.GroupMruFormListLoadState="Loading",d.GroupMruDocumentManager.initializeFormList().then(function(){return b.GroupMruFormListLoadState="Loaded"}))},d.updateOrCreateFormMaster=function(c,e){void 0===e&&(e=!1);var f=c.Id&&d.allFormsWithId[c.Id];if(f){var g=Nerve.convertToSourceData(c,b.Model.FormMaster.Schema);return f.Synchronizer.onSourceDataReceived(g),f}c.Id||(c=_.clone(c),e?(c.XlWorkbookId=c.XlWorkbookId||a.Utilities.ExcelHelper.waitingForExport,c.OwnerId=c.OwnerId||a.EnvironmentSettings.GroupId,c.OwnerTenantId=c.OwnerTenantId||a.EnvironmentSettings.TenantId):(c.OwnerId=c.OwnerId||OfficeFormServerInfo.userInfo.UserId,c.OwnerTenantId=OfficeFormServerInfo.userInfo.TenantId));var h=b.Model.createDesignFormMaster(c,e);return h.existingOnServerSide().done(function(){return d.allFormsWithId[h.Model.Id]=h}),h},d.concatToFormList=function(a){var b=c.getUxStateMaster().Model;a.Model.OwnerId===OfficeFormServerInfo.userInfo.UserId&&(b.FormList=b.FormList.concat(a))},d.concatToPlaceholderList=function(a){var b=c.getUxStateMaster().Model;b.PlaceholderList=b.PlaceholderList.concat(a)},d.removeFromPlaceholderList=function(a){var b=c.getUxStateMaster().Model,d=b.PlaceholderList,e=d.indexOf(a);e>=0&&(d.splice(e,1),b.PlaceholderList=d)},d.prototype.createForm=function(a,b){var c=d.updateOrCreateFormMaster(a,b);return d.concatToFormList(c),c},d.prototype.duplicateForm=function(a,b){var f=c.getUxStateMaster(),g=e(a.Model.Title),h={Title:g,Modified:(new Date).toUTCString(),OwnerId:b.OwnerId,OwnerTenantId:b.OwnerTenantId};return d.concatToPlaceholderList(h),a.duplicateForm(b,g).then(function(a){return f.startBulkEditMode(),d.removeFromPlaceholderList(h),d.concatToFormList(a),f.endBulkEditMode(),a},function(){return d.removeFromPlaceholderList(h)})},d.prototype.designForm=function(b){var d=c.getUxStateMaster(),e=d.Model;a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Form.Navigate,extraData:{myForm:b.Model.OwnerId===OfficeFormServerInfo.userInfo.UserId,isGroupForm:b.IsGroupForm}}),d.startBulkEditMode(),e.Analysis=!1,e.Grading=void 0,e.FormId=void 0,e.FormMaster=b,b.existingOnServerSide().then(function(){e.FormMaster===b&&(e.FormId=b.Model.Id)}),d.endBulkEditMode()},d.duplicateExcelForm=function(a,e){var f=c.getUxStateMaster(),g=f.Model;return b.Model.FormDataSource.duplicateExcelForm(a,e).fail(function(a){return g.CriticalError=a}).then(function(a){return d.updateOrCreateFormMaster(a)})},d.prototype.moveToRecycleBin=function(a,b){var d=this,e=a.formOwnedByMe();return a.moveToRecycleBin().done(function(){var b=c.getUxStateMaster().Model;e&&(b.RecycleBin=b.RecycleBin.concat(a),b.FormList=_.without(b.FormList,a)),d.GroupMruDocumentManager.removeDocument(a.Model.Id)})},d.prototype.restoreFromRecycleBin=function(a){var d=this,e=a.formOwnedByMe();return a.Model.SoftDeleted=b.Model.FormDeletedState.Normal,a.Synchronizer.flush().then(function(){var b=c.getUxStateMaster().Model;e&&(b.RecycleBin=_.without(b.RecycleBin,a),b.FormList=b.FormList.concat(a)),d.GroupMruDocumentManager.removeDocument(a.Model.Id)})},d.prototype.deleteForm=function(a){var d=this,e=a.formOwnedByMe();if(!e&&!a.IsGroupForm){a.Model.DeleteCollaborationPermission=!0;var f=b.Model.FormDataSource.getDataProviderByFormMaster(a);return f.deletePermissionLink(a.Model.Id,OfficeFormServerInfo.userInfo.UserId).done(function(){a.Model.DeleteCollaborationPermission=!1;var b=c.getUxStateMaster().Model;b.SharedWithMeFormList=_.without(b.SharedWithMeFormList,a)})}return a.Deleted=!0,a.Synchronizer.flush().then(function(){var b=c.getUxStateMaster().Model;e&&(b.RecycleBin=_.without(b.RecycleBin,a)),a.IsGroupForm&&d.removeFromMRU(a)})},d.prototype.changeFormOwner=function(a,d){var e=b.Model.FormDataSource.getDataProviderByFormMaster(a);return a.Model.TransferInProgress=!0,e.moveForm(a.Model.Id,d.OwnerId,d.IsGroupForm).always(function(){return a.Model.TransferInProgress=!1}).done(function(b){a.Synchronizer.onDeletedInDataSource();var d=c.getUxStateMaster().Model;d.FormList=_.without(d.FormList,a)}).fail(function(a){return c.getUxStateMaster().Model.CriticalError=a}).then(function(a){var b=null;return a&&(b={instanceId:null,id:a.id,category:a.category,modifiedDate:a.modifiedDate,ownerId:a.ownerId,ownerTenantId:a.ownerTenantId,softDeleted:a.softDeleted,title:a.title}),b})},d.prototype.removeFromMRU=function(a){var c=this,d=b.Model.FormDataSource.getDataProviderByFormMaster(a);return d.removeRecentForm(a.Model.Id).then(function(){c.GroupMruDocumentManager.removeDocument(a.Model.Id)})},d.getFormsTenantSettings=function(){var b=a.DataProvider.ProviderManager.getInstance().createDataProvider();return b.getFormsTenantSettings().then(function(a){c.getUxStateMaster().Model.FormsTenantSettings=a},function(b){a.Event.ErrorEventDeprecated.logData({errorName:"TenentSettingsGetFailure",errorInfo:b})})},d.allFormsWithId={},d}();c.DataProviderAdapter=f,c.dataProviderAdapterConcatToFormList=d,c.getUniqueFormName=e}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return React.createElement(e,a)}c.createDesignContent=d;var e=function(d){function e(){var a=null!==d&&d.apply(this,arguments)||this;return a.mounted=!0,a.uxStateModelChangeCallback=function(){return a.forceUpdate()},a.formDesignerRef=React.createRef(),a.state={FormReadyToDesign:!1,DisableReadonlyTipBar:!1,DisablePhishingTipBar:!1},a}return __extends(e,d),e.prototype.componentWillMount=function(){this.onMouseDown=this.onMouseDown.bind(this),this.checkFormReadyToDesign(this.props.FormMaster);var d=c.getUxStateMaster();d.observe(this.uxStateModelChangeCallback,[c.UxStateFields.Analysis]),d.observe(this.uxStateModelChangeCallback,[c.UxStateFields.Grading]);var e=this.props.FormMaster;e.startReceivingNotifications(function(c,d){switch(d){case b.Model.FormChangeActionType.UserDisconnect:c.forEach(function(b){a.getUserRepository().removeUser(b)});break;case b.Model.FormChangeActionType.ConnectionStateChanged:case b.Model.FormChangeActionType.UserAction:case b.Model.FormChangeActionType.UserConnect:default:c.forEach(function(b){a.getUserRepository().addOrUpdateUser(b)})}}),e.ensureFieldsReady([b.Model.FormMaster.Schema.ResponsesCount]).then(function(){null==e.Model.ResponsesCount&&e.getFormResponsesCountByAPICall()})},e.prototype.componentWillReceiveProps=function(a){a.FormMaster!==this.props.FormMaster&&this.checkFormReadyToDesign(a.FormMaster)},e.prototype.componentWillUnmount=function(){this.mounted=!1;var b=c.getUxStateMaster();this.props.FormMaster.stopReceivingNotifications(function(){a.getUserRepository().removeAllUsers()}),b.unobserve(this.uxStateModelChangeCallback)},e.prototype.render=function(){if(!this.state.FormReadyToDesign)return c.createLoadingPlaceholder({Message:b.Resources.LocalizedStrings.DesignPage_LoadingForm});var d,e=this.props.FormMaster,f={className:"body-content office-form-theme-page-background"},g=c.getUxStateMaster();return g.Model.Analysis?d=b.Analysis.createAnalyzeViewContainer({Form:e,showErrorPage:function(a){c.getUxStateMaster().Model.CriticalError=a}}):(d=React.createElement(c.FormDesignView.FormDesigner,{Form:e,ref:this.formDesignerRef}),f.onMouseDown=this.onMouseDown),React.DOM.div(f,c.FlexPane.createFlexPane({Form:e,FlexPaneType:"Theme"}),c.FlexPane.createFlexPane({Form:e,FlexPaneType:"SendForm"}),c.FlexPane.createFlexPane({Form:e,FlexPaneType:"Settings"}),c.FlexPane.createFlexPane({Form:e,FlexPaneType:"ImagePicker"}),c.FlexPane.createFlexPane({Form:e,FlexPaneType:"VideoPicker"}),c.FlexPane.createFlexPane({Form:e,FlexPaneType:"MediaSelect"}),this.createReadonlyTipBar(),this.createPhishingFormTipBar(),c.createDesignPageNavBar({Form:this.props.FormMaster}),React.DOM.div({id:"body-scrollable-content",className:"office-form-page-padding"},React.DOM.div({className:a.Utilities.Html.combineAttributes("design-content","office-form-theme-shadow","new-analyze-view-look")},d,c.createAutoSaving({Form:e}))),React.createElement(Forms.UX.Designer.CoAuthMessageBar,{FormMaster:b.Model.exportConverter(e)}),this.createNPS())},e.prototype.createCoAuthMessageBar=function(){var b=this.props.FormMaster.Model.CoAuthMessage;a.EnvironmentConfig.getEnvironmentType();return b?React.DOM.div({className:"coauthmessagebar-container"},React.DOM.span({className:"coauthmessagebar-span"},b)):void 0},e.prototype.createNPS=function(){return a.Flighting.Flight.isEnabled(a.Flighting.Flights.NetPromoteScore)?React.createElement(Forms.UX.OfficeNPS):null},e.prototype.createReadonlyTipBar=function(){var a=this,d=this.props.FormMaster;return d.isFieldReady(b.Model.FormMaster.Schema.Category)&&b.CategoryExtensionPoints.supportsExtensionPoint(d,b.ExtensionPoints.DisableEditForm)&&!this.state.DisableReadonlyTipBar?c.createTipBar({Id:"design-view-readonly-TipBar",Info:b.Resources.LocalizedStrings.DesignPage_ReadonlyFormTip,TipBarLocation:c.TipBarLocation.Up,TipBarStyle:c.TipBarStyle.YellowBackground,ShouldClose:!0,onClose:function(){a.setState({DisableReadonlyTipBar:!0})}}):void 0},e.prototype.createPhishingFormTipBar=function(){var d=this;return a.Utilities.isPhishingForm(this.props.FormMaster.Model.OnlineSafetyLevel)&&!this.state.DisablePhishingTipBar?c.createTipBar({Id:"design-view-phishing-TipBar",Info:b.Resources.LocalizedStrings.Phishing_Form_Warning_Message,TipBarLocation:c.TipBarLocation.Up,TipBarStyle:c.TipBarStyle.YellowBackground,ShouldClose:!0,onClose:function(){d.setState({DisablePhishingTipBar:!0})}}):void 0},e.prototype.checkFormReadyToDesign=function(b){var d=this,e=b.ensureReadyToDesign().fail(function(b){var d=b;d&&d.innerCode===a.DataProvider.ErrorCode.InnerCode.CDBTableMoved?c.getUxStateMaster().Model.FormId=d.innerMessage:c.getUxStateMaster().Model.CriticalError=b}).then(function(){return Forms.FormsProRelated.ensureEnvironment("survey"===b.Model.Type)}),f="resolved"===e.state();f!==this.state.FormReadyToDesign&&this.setState({FormReadyToDesign:f}),f||e.done(function(){null==b.SettingMaster.Model.IsQuizMode&&(b.SettingMaster.Model.IsQuizMode=b.Model.QuizQuestionsCount>0),d.mounted&&d.props.FormMaster===b&&d.setState({FormReadyToDesign:!0})})},e.prototype.onMouseDown=function(a){var b=this.formDesignerRef.current;if(b){var c=$(a.target);ReactDOM.findDOMNode(b).contains(c[0])||c.hasClass("flex-pane-board")||c.parents(".flex-pane-board").length||b.endCurrentDesignMode()}},e}(a.ReactComponent)}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=function(){function c(a){var c=this;this.master=a,this.defaultParameters={Action:"NoAction",Analysis:!1,FormId:void 0,FlexPane:"None",Grading:void 0,Preview:void 0,Store:!1,Title:void 0,Token:void 0,TopView:"None",XlWorkbookId:void 0,Host:void 0},this.readHashValues(),this.writeHashValues(!0),$(window).on("hashchange",this.readHashValues.bind(this));var d=this.Keys.map(function(a){return b.UxStateFields[a]});this.master.observe(function(a){var d=_.intersection(a.FieldSchemas,[b.UxStateFields.Action,b.UxStateFields.Title,b.UxStateFields.XlWorkbookId]);c.writeHashValues(d.length>0)},d)}return Object.defineProperty(c.prototype,"Keys",{get:function(){return _.keys(this.defaultParameters)},enumerable:!0,configurable:!0}),c.prototype.readHashValues=function(){var a=this,b=this.getHashFromCurrentUrl();this.master.startBulkEditMode(),this.Keys.forEach(function(c){return a.master.Model[c]=b[c]}),this.master.endBulkEditMode()},c.prototype.writeHashValues=function(b){var c=this,d=this.Keys,e=_.pick(this.master.Model,d);if(!_.isEqual(e,this.getHashFromCurrentUrl())){var f=d.filter(function(a){return c.master.Model[a]!==c.defaultParameters[a]}).map(function(b){var d=c.master.Model[b];return a.Utilities.Type.isString(d)||(d=JSON.stringify(d)),b+"="+encodeURIComponent(d)}).join("&");b?Forms.Common.replaceUrl(window.location.href.split("#")[0]+"#"+f):window.location.hash=f}},c.prototype.getHashFromCurrentUrl=function(){var c=this.Keys,d=c.map(function(a){return a.toLowerCase()}),e=_.clone(this.defaultParameters),f=[b.UxStateFields.Analysis,b.UxStateFields.Grading,b.UxStateFields.Preview,b.UxStateFields.TopView],g=(window.location.hash||"").substring(1);return g.split("&").forEach(function(g){var h=g.split("="),i=d.indexOf(h[0].trim().toLowerCase()),j=c[i];if(j){var k=decodeURIComponent(h[1]||"undefined").trim();_.include(f,b.UxStateFields[j])&&(k=a.Utilities.tryParseJson(k)),e[j]=k}}),e},c}();new c(b.getUxStateMaster())}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(){a.Authenticator.handleAuthForContentPage(!0).done(g).fail(h)}function e(a){c.getUxStateMaster().Model.CriticalError=a}function f(){c.getUxStateMaster().Model.TopView="None"}function g(){a.Event.EngagementEventDeprecated.logSessionStartEvent(),a.Utilities.Html.getQueries().t&&a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Form.SharedFormByOwner}),a.Utilities.Html.getHashes()[a.EnvironmentSettings.ShareToCollabTokenParam]&&a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Form.SharedOwnershipByOwner});var d=c.getUxStateMaster().Model;switch(Forms.Models.FormManager.onFormMasterCreated(b.Model.exportConverter(c.observeFormErrors)),Forms.Common.setFormIdGetter(function(){return d.FormId}),Forms.Common.setFormGetter(function(){return b.Model.exportConverter(c.getUxStateMaster().Model.FormMaster)}),c.DataProviderAdapter.getFormsTenantSettings(),d.Action){case"Activate":case"Close":l("Close"===d.Action);break;case"Create":j();break;case"Delete":k();break;case"NoAction":default:c.DataProviderAdapter.triggerReadProcess(),n()}}function h(a){i(a)}function i(a){Forms.showPageError(a)}function j(){var d=c.getUxStateMaster(),e=d.Model;if(a.Flighting.Flight.isEnabled(a.Flighting.Flights.PreviewInfoBar)){var f=d.Model.Host,g=b.Model.getUserProfileMaster().Model;"OneDrive"!==f&&"Excel"!==f&&"Excel_Win32"!==f||!b.Model.isVersionOk(g.PreviewLabelForSurvey)||a.DataProvider.FeaturePlanProvider.isEduUser().done(function(a){a||d.showInfoMessageBar(c.InfoBarMessageTypes[c.InfoBarMessageTypes.PreviewLabelForSurvey])})}var h=function(b,f){var g=f?a.Utilities.ExcelHelper.waitingForExport:void 0,h=(new c.DataProviderAdapter).createForm({Title:e.Title||void 0,XlWorkbookId:e.XlWorkbookId||g,CreatedFromOneDrive:!!e.XlWorkbookId,OwnerId:b},f);e.FormMaster=h,h.existingOnServerSide().done(function(){d.startBulkEditMode(),h===e.FormMaster&&(e.FormId=h.Model.Id),d.Model.Host=void 0,d.clearActionRelatedFields(),d.endBulkEditMode()}).fail(i)};q(e.XlWorkbookId)?p(e.XlWorkbookId).done(function(a){h(a,!0),n()}).fail(i):a.EnvironmentSettings.IsTeamsIntegration?(h(a.EnvironmentSettings.GroupId,!0),n()):(h(OfficeFormServerInfo.userInfo.UserId,!1),n())}function k(){var d=c.getUxStateMaster().Model.FormId,e=b.Model.exportConverter(Forms.Models.FormManager.getDesignFormMaster({Id:d})),f=function(a){ReactDOM.render(React.createElement(Forms.UX.Renderer.ErrorPage,{Error:{innerCode:a},ErrorType:"Information"}),document.getElementById("content-root"))};$.when(e.ensureFieldsReady([b.Model.FormMaster.Schema.OwnerId,b.Model.FormMaster.Schema.OtherInfo]),b.Resources.loadLocalizedStrings()).then(function(){(new c.DataProviderAdapter).deleteForm(e),f(a.DataProvider.ErrorCode.InnerCode.DeleteFormSuccessed),window.close()}).fail(function(){f(a.DataProvider.ErrorCode.InnerCode.InvalidFormId),window.close()})}function l(a){var d=c.getUxStateMaster().Model.FormId,e=b.Model.exportConverter(Forms.Models.FormManager.getDesignFormMaster({Id:d}));$.when(e.ensureFieldsReady([b.Model.FormMaster.Schema.Settings]),b.Resources.loadLocalizedStrings()).then(function(){var b=e.Model.Settings;return!b.FormClosed!=!a?(b.FormClosed=!!a,e.Synchronizer.flush()):void 0}).always(function(){window.setTimeout(function(){c.getUxStateMaster().clearActionRelatedFields(),c.DataProviderAdapter.triggerReadProcess(),n()},3e3),window.close()})}function m(){if(!a.Utilities.getCookie("nps-value")){var b=a.EnvironmentConfig.isProduction()?a.EnvironmentConfig.isMsftProduction()?5:100:2,c=Math.floor(Math.random()*b);0===c&&a.Utilities.setCookie("nps-value","readytoshow",5184e6)}}function n(){c.getUxStateMaster().observe(function(){return c.DataProviderAdapter.triggerReadProcess()},[c.UxStateFields.FormId,c.UxStateFields.FormCollectionType]);var d,e=Forms.PerformanceAnalysis,f=e.requestWithPromise("getForms",o());d=OfficeFormServerInfo.combineScripts?["combined-design"]:["BootStrap","Clipboard","Cropper_Modified","Linkify","Linkify_JQuery","JQuery_RateIt","JQuery_Picker","JQuery_Picker_Date","JQuery_Picker_Time","JQuery_QRCode","SignalR"];var g=e.requestWithPromise("scripts",a.JavaScriptLoader.loadJavaScripts(d)),h=e.requestWithPromise("strings",b.Resources.loadLocalizedStrings()),i=Forms.Experimentation.getExperimentController().initialize();$.when(f,g,h,i).done(function(){return e.onPageReadyToRender()}),a.DataProvider.FeaturePlanProvider.isFormsProUser().then(function(a){return!c.getUxStateMaster().Model.FormMaster&&Forms.FormsProRelated.ensureEnvironment(a)}).done(function(){$.when(g,h).done(function(){var b={DataProvider:new c.DataProviderAdapter};ReactDOM.render(c.createDesignPageContent(b),document.getElementById("content-root")),m(),window.performance&&(a.Event.NavPerfEventDeprecated.timeToChrome=a.Utilities.DateTime.getTimeStamp()-window.performance.timing.navigationStart)})})}function o(){function a(){"Loaded"===b.Model.FormListLoadState&&(d.resolve(),b.unobserve(a))}var b=c.getUxStateMaster();b.observe(a,[c.UxStateFields.FormListLoadState]);var d=$.Deferred();return d.promise()}function p(c){var d=a.DataProvider.ProviderManager.getInstance().createDataProvider();return d.getGroupId(c).then(function(c){if(a.Utilities.Guid.isNullOrEmpty(c)){var d=new Error;return d.name=b.ClientErrorNames.TeamSiteNoGroupError,$.Deferred().reject(d).promise()}return c})}function q(a){return a&&(a.indexOf("/teams/")>=0||a.indexOf("/sites/")>=0)}a.Exports.DesignPage=c,c.initializePage=d,c.setUxStateError=e,c.hideTopView=f,c.onLoginSuccess=g,c.onAuthError=h}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return React.createElement(e,a)}c.createDesignPageContent=d;var e=function(d){function e(a){var b=d.call(this,a)||this;return b.uxStateChangeCallback=function(a){return b.onUxStateModelChange(a)},b.state=b.getDefaultState(),b.createCallback=b.createCallback.bind(b),b}return __extends(e,d),e.prototype.getDefaultState=function(){var a=c.getUxStateMaster().Model;return{ShowPortalPage:!(a.FormId||a.FormMaster)}},e.prototype.componentWillMount=function(){this.appLauncherCollapseTrigger=new a.Utilities.Process.CallbackManager,c.getUxStateMaster().observe(this.uxStateChangeCallback,e.UxStateModelRelatedKeys)},e.prototype.componentWillUnmount=function(){c.getUxStateMaster().unobserve(this.uxStateChangeCallback)},e.prototype.render=function(){var d=this,e=c.getUxStateMaster().Model;if(e.Store)return c.createQtiView();var f,g;if(e.CriticalError)f=React.createElement(Forms.UX.Renderer.ErrorPage,{Error:e.CriticalError,ErrorType:"Error",FormId:e.FormId});else if(this.state.ShowPortalPage)f=this.createPortalView(),"RecycleBin"===e.TopView?g=this.createRecycleBinView():"MSATemplateGallery"===e.TopView&&(g=this.createMSATemplateGalleryView());else if(this.state.DuplicatingForm)f=c.createLoadingPlaceholder({Message:b.Resources.LocalizedStrings.Page_LoadingMessage});else if(e.FormMaster){var h=e.FormMaster;f=c.createDesignContent({FormMaster:e.FormMaster,key:"content-"+h.getInstanceId()}),g="Preview"===e.TopView?c.createPreviewContainer({Form:e.FormMaster,ResponseIndex:e.Preview&&e.Preview.ResponseIndex,key:"preview-"+h.getInstanceId()}):"Branch"===e.TopView?c.createBranchingDesignView({Form:e.FormMaster,key:"branch-"+h.getInstanceId()}):"QRcodePlus"===e.TopView?c.createQRPlusView({Form:e.FormMaster,key:"qr-plus-"+h.getInstanceId()}):c.createGradingAndSurveyResult(e)}else e.FormId?f=c.createLoadingPlaceholder({Message:b.Resources.LocalizedStrings.DesignPage_LoadingForm}):e.QtiFormCreationStatus?f=c.createLoadingPlaceholder({Message:e.QtiFormCreationStatus}):"Loaded"===e.FormListLoadState&&(f=this.createPortalView());var i,j=e.FlexPane,k={className:"page-container",onClick:function(a){if(j===e.FlexPane){var b=null;if("None"!==e.FlexPane){var f="flex-pane-container-"+e.FlexPane;b=document.getElementById(f)}c.getUxStateMaster().collapseFlexPaneIfNeeded(a.target)}d.appLauncherCollapseTrigger.trigger(a)},onKeyDown:function(a){d.appLauncherCollapseTrigger.trigger(a)},onScroll:function(a){d.appLauncherCollapseTrigger.trigger(a)}},l=c.createHeadBar({AppLauncherCollapseTrigger:this.appLauncherCollapseTrigger,ShouldDisabled:"None"!=e.TopView&&"RecycleBin"!=e.TopView&&"MSATemplateGallery"!=e.TopView}),m=c.createErrorMessageBar();a.Flighting.Flight.isEnabled(a.Flighting.Flights.PreviewInfoBar)&&(i=c.createInfoMessageBar());var n=React.DOM.div({className:a.Utilities.Html.combineAttributes("design-body-container",a.Utilities.isEdge()?"edge":void 0,a.Utilities.isIE()?"ie":void 0,a.Utilities.isFireFox()?"firefox":void 0),style:g?{display:"none"}:void 0},c.FlexPane.createFlexPane({Form:e.FormMaster,FlexPaneType:"Feedback"}),c.FlexPane.createFlexPane({Form:e.SelectedPortalForm,FlexPaneType:"MoveFormPane",changeFormOwnerHandler:function(a,b){return d.moveForm(a,b)}}),f);return React.DOM.div(k,l,g,m,i,n)},e.prototype.moveForm=function(a,b){var d=c.getUxStateMaster();return d.startBulkEditMode(),c.getUxStateMaster().Model.FlexPane="None",c.getUxStateMaster().Model.SelectedPortalForm=null,d.endBulkEditMode(),this.props.DataProvider.changeFormOwner(a,b)},e.prototype.createPortalView=function(){var b=this;if(a.Flighting.Flight.isEnabled(a.Flighting.Flights.UpgradeUxStateModel)){var d=this.props,e=c.PortalPage.createPortalView({createAndDesignFormHandler:function(a,c){return b.createForm(a,c)},duplicateFormHandler:d.DataProvider.duplicateForm,duplicateAndDesignFormHandler:this.duplicateAndDesignForm.bind(this),designExistingFormHandler:d.DataProvider.designForm,deleteFormHandler:d.DataProvider.deleteForm,focusOut:function(){},removeFromMRUHandler:d.DataProvider.removeFromMRU,softDeleteFormHandler:d.DataProvider.moveToRecycleBin,GroupMruDocumentManager:d.DataProvider.GroupMruDocumentManager,changeFormOwnerHandler:function(a){var b=Forms.Models.getUxStateMaster();b.bulkEdit(function(){b.Model.SelectedPortalForm=a,b.Model.FlexPane="MoveFormPane"})}});return e}var d=this.props,e=c.PortalPage.createPortalView({createAndDesignFormHandler:function(a,c){return b.createForm(a,c)},duplicateFormHandler:d.DataProvider.duplicateForm,duplicateAndDesignFormHandler:this.duplicateAndDesignForm.bind(this),designExistingFormHandler:d.DataProvider.designForm,deleteFormHandler:d.DataProvider.deleteForm,focusOut:function(){},removeFromMRUHandler:d.DataProvider.removeFromMRU,softDeleteFormHandler:d.DataProvider.moveToRecycleBin,GroupMruDocumentManager:d.DataProvider.GroupMruDocumentManager,changeFormOwnerHandler:function(a){return c.showMovePane(a)}});return e},e.prototype.createRecycleBinView=function(){var a=c.createRecycleBinView({deleteFormHandler:this.props.DataProvider.deleteForm,restoreFormHandler:this.props.DataProvider.restoreFromRecycleBin});return a},e.prototype.createMSATemplateGalleryView=function(){return React.createElement(Forms.UX.TemplateGallery,{backToPortalViewPageHandler:this.closeTopView,createFormCallback:this.createCallback,viewTemplateHandler:b.Model.exportConverter(this.props.DataProvider.designForm)})},e.prototype.createCallback=function(a){this.createForm(c.PortalPage.createFormDefinition(a))},e.prototype.closeTopView=function(){c.getUxStateMaster().hideTopView()},e.prototype.createForm=function(b,d){var e=this.props.DataProvider,f="GroupForms"===c.getUxStateMaster().Model.FormCollectionType,g=e.createForm(b,f);e.designForm(g),d&&g.ensureCreationDone().done(function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PortalPage.MyForms.NewFormCopyAllDone,extraData:{CopyCorelationID:d,Time:(new Date).toUTCString()}})})},e.prototype.duplicateAndDesignForm=function(a,b){var c=this,d=this.props.DataProvider.duplicateForm(a,b).then(this.props.DataProvider.designForm);"pending"===d.state()&&(this.setState({DuplicatingForm:!0}),d.always(function(){return c.setState({DuplicatingForm:!1})}))},e.prototype.onUxStateModelChange=function(d){var e=d.Master.Model;if(_.contains(d.FieldSchemas,c.UxStateFields.FormId)&&!_.contains(d.FieldSchemas,c.UxStateFields.FormMaster)){var f=void 0;if((!e.FormMaster||e.FormId)&&(f=b.Model.exportConverter(Forms.Models.FormManager.getDesignFormMaster({Id:e.FormId}))),f!==e.FormMaster)return void(e.FormMaster=f)}var g={};g.ShowPortalPage=!(e.FormId||e.FormMaster||e.QtiFormCreationStatus),g.ShowPortalPage&&!this.state.ShowPortalPage&&(g=this.getDefaultState()),_.contains(d.FieldSchemas,c.UxStateFields.FormListLoadState)&&"Loaded"===e.FormListLoadState&&window.performance&&a.Event.NavPerfEventDeprecated.logData({name:a.Event.NavPerfEventNames.Scenario.Endpoints.DesignPagePortalView,extraData:{timeToSpin:window.performance.timing.domInteractive-window.performance.timing.navigationStart,timeToChrome:a.Event.NavPerfEventDeprecated.timeToChrome,timeToContentReady:a.Utilities.DateTime.getTimeStamp()-window.performance.timing.navigationStart}});var h=null;_.contains(d.FieldSchemas,c.UxStateFields.TopView)&&"None"===d.Master.Model.TopView&&(h=d.Master.resetTopViewCloseCallback()),this.setState(g,h)},e.UxStateModelRelatedKeys=[c.UxStateFields.CriticalError,c.UxStateFields.FlexPane,c.UxStateFields.FormId,c.UxStateFields.FormMaster,c.UxStateFields.FormList,c.UxStateFields.FormListLoadState,c.UxStateFields.QtiFormCreationStatus,c.UxStateFields.SharedWithMeFormListLoadState,c.UxStateFields.Store,c.UxStateFields.TopView,c.UxStateFields.SelectedPortalForm],e}(a.ReactComponent)}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return React.createElement(e,a)}c.createDesignPageNavBar=d;var e=function(d){function e(){var a=null!==d&&d.apply(this,arguments)||this;return a.responseCountChangeCallback=function(){return a.forceUpdate()},a}return __extends(e,d),e.prototype.componentWillMount=function(){this.props.Form.observe(this.responseCountChangeCallback,[b.Model.FormMaster.Schema.ResponsesCount])},e.prototype.componentWillUnmount=function(){this.props.Form.unobserve(this.responseCountChangeCallback,[b.Model.FormMaster.Schema.ResponsesCount])},e.prototype.render=function(){return React.DOM.div({className:"navbar-content office-form-page-padding",role:"navigation"},React.DOM.div({className:"navbar-items",role:"tablist"},this.createMenuIconListItem(!1,b.Resources.LocalizedStrings.DesignPage_NavBar_ContentLink),this.createMenuIconListItem(!0,b.Resources.LocalizedStrings.DesignPage_NavBar_AnalysisLink)))},e.prototype.createMenuIconListItem=function(d,e){var f=this,g=this.props.Form.Model.ResponsesCount,h=c.getUxStateMaster().Model,i=!h.Analysis==!d,j={className:"navbar-item"};i&&(j.className=a.Utilities.Html.combineAttributes(j.className,"office-form-theme-border-top office-form-theme-shadow office-form-theme-primary-foreground is-active"));var k={tabIndex:i?0:-1,role:"tab","aria-selected":i,"aria-label":e,"aria-posinset":d?2:1,"aria-setsize":2,title:d?b.Resources.LocalizedStrings.DesignPage_Responses_TextForCount.format(g):void 0,onClick:function(){return h.Analysis=d},className:"navbar-button",ref:d?"Responses":"Questions",onKeyDown:function(b){b.keyCode!==a.KeyCode.ArrowRight||d?b.keyCode===a.KeyCode.ArrowLeft&&d?f.changeTabItemFocus(b,"Responses","Questions"):(b.keyCode===a.KeyCode.Enter||b.keyCode===a.KeyCode.Space)&&(h.Analysis=d):f.changeTabItemFocus(b,"Questions","Responses")}};return React.DOM.div(j,React.DOM.div(k,e,d?this.createResponsesNotification():null))},e.prototype.changeTabItemFocus=function(a,b,c){a.stopPropagation(),a.preventDefault();var d=ReactDOM.findDOMNode(this.refs[b]),e=ReactDOM.findDOMNode(this.refs[c]);e&&(e.focus(),$(e).attr("tabindex",0),$(d).attr("tabindex",-1))},e.prototype.createResponsesNotification=function(){var a=this.props.Form;if(a.isFieldReady(b.Model.FormMaster.Schema.ResponsesCount)){var c=a.Model.ResponsesCount;return c?React.DOM.div({className:"navbar-responses-notification office-form-theme-primary-background"},c):null}},e}(a.ReactComponent)}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){function c(a){return React.createElement(d,a)}b.createErrorMessageBar=c;var d=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;return b.onErrorMessageChange=function(){return b.updateErrorMessage()},b}return __extends(c,a),c.prototype.componentDidMount=function(){this.updateErrorMessage(),b.getUxStateMaster().observe(this.onErrorMessageChange,[b.UxStateFields.ErrorBarMessage])},c.prototype.componentWillUnmount=function(){b.getUxStateMaster().unobserve(this.onErrorMessageChange)},c.prototype.render=function(){var a=this.state.Message;return a?React.DOM.div({className:"error-message-bar"},React.DOM.div({className:"error-message-bar-message"},a)):null},c.prototype.updateErrorMessage=function(){var a=this,c=b.getUxStateMaster().Model.ErrorBarMessage;c?(this.setState({Message:c}),$(".error-message-bar").stop().fadeIn("fast")):$(".error-message-bar").stop().fadeOut("slow",function(){a.setState({Message:void 0})})},c}(a.ReactComponent)}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(d){function e(a){return React.createElement(f,a)}d.createFlexPane=e;var f=function(e){function f(){var a=null!==e&&e.apply(this,arguments)||this;return a.state={AnimationDone:!0,Expanded:!1,PaneWidth:a.calculatePaneWidth()},a}return __extends(f,e),f.prototype.componentDidMount=function(){var a=this,b=c.getUxStateMaster();this.onFlexPaneChange=function(){a.state.Expanded!==a.shouldExpand()&&a.setState({AnimationDone:!1,Expanded:!a.state.Expanded})},b.Model.FlexPane===this.props.FlexPaneType?(b.startBulkEditMode(),
b.Model.FlexPane="None",b.observe(this.onFlexPaneChange,[c.UxStateFields.FlexPane]),b.Model.FlexPane=this.props.FlexPaneType,b.endBulkEditMode()):b.observe(this.onFlexPaneChange,[c.UxStateFields.FlexPane]),this.onWindowResize=function(){a.state.PaneWidth!==a.calculatePaneWidth()&&a.setState({PaneWidth:a.calculatePaneWidth()})},window.addEventListener("resize",this.onWindowResize)},f.prototype.componentDidUpdate=function(){var a=this,b=ReactDOM.findDOMNode(this),c=$(b);c.width(this.state.PaneWidth),this.state.AnimationDone||(this.state.Expanded?(c.removeClass("NotVisible"),c.removeClass("slideRightOut"),c.on("animationend",function(){c.off("animationend"),c.focus(),a.setState({AnimationDone:!0})}),c.addClass("slideLeftIn")):(c.removeClass("slideLeftIn"),c.on("animationend",function(){c.off("animationend"),c.addClass("NotVisible"),a.setState({AnimationDone:!0})}),c.addClass("slideRightOut")))},f.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.onWindowResize),c.getUxStateMaster().unobserve(this.onFlexPaneChange)},f.prototype.render=function(){var e=this,f=this.props,g={id:"flex-pane-container-"+f.FlexPaneType,className:"flex-pane-board NotVisible",role:"tabpanel","aria-label":f.FlexPaneType,tabIndex:-1,onKeyUp:a.Utilities.Html.onKeyboardEvent(function(b){b.keyCode===a.KeyCode.Esc&&(c.getUxStateMaster().Model.FlexPane="None",b.stopPropagation(),Forms.UX.Utilities.jumpFocusBack("Flexpane-"+f.FlexPaneType))})},h=void 0;if(this.state.Expanded||!this.state.AnimationDone||"ImagePicker"===f.FlexPaneType||"Theme"===f.FlexPaneType)switch(f.FlexPaneType){case"SendForm":f.Form.isFieldReady(b.Model.FormMaster.Schema.Id)&&(h=d.createShareView({Form:f.Form}));break;case"Settings":h=d.createSettingsPane({Form:f.Form});break;case"Theme":if(f.Form.isFieldReady(b.Model.FormMaster.Schema.Theme))if(!a.Flighting.Flight.isEnabled(a.Flighting.Flights.FormsBranding)||a.Flighting.Flight.isEnabled(a.Flighting.Flights.DisableBrandingForMSA)&&OfficeFormServerInfo.userInfo.IsMsa)h=d.createThemeView();else{var i=c.getUxStateMaster().Model;h=Forms.UX.FlexPane.createThemeView(b.Model.exportConverter(this.props.Form),function(){i.FlexPane="Theme"})}break;case"Feedback":h=d.createFeedbackView();break;case"MoveFormPane":var j=this.props.Form;null!=j&&(h=Forms.Mru.createMovePaneView(function(a){return e.moveForm(a)},b.Model.exportConverter(j),a.EnvironmentSettings.isDelegateMode()));break;case"ImagePicker":h=d.createImagePickerView({ContainerWidth:this.calculatePaneWidth()});break;case"VideoPicker":h=d.createVideoPickerView({ContainerWidth:this.calculatePaneWidth()});break;case"MediaSelect":h=d.createMediaSelectView();break;default:throw Error("All flexpane should be handled above")}return this.state.Expanded&&(g.tabIndex=0),React.DOM.div(g,h)},f.prototype.moveForm=function(a){return this.props.changeFormOwnerHandler(this.props.Form,a)},f.prototype.shouldExpand=function(){return this.props.FlexPaneType===c.getUxStateMaster().Model.FlexPane},f.prototype.calculatePaneWidth=function(){var a=this.props.FlexPaneType;return"ImagePicker"===a||"VideoPicker"===a?$(document).width()<600?$(document).width():600:$(document).width()<=768?300:400},f}(a.ReactComponent)}(d=c.FlexPane||(c.FlexPane={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(c){function d(a){return React.createElement(e,a)}c.createFeedbackView=d;var e=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.render=function(){var c={className:"flex-pane-feedback-post-community",onClick:function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Feedback.Suggestion}),a.Utilities.Html.safeOpen("https://microsoftforms.uservoice.com")}},d=React.DOM.div({className:"flex-pane-content flex-pane-feedback-box"},React.DOM.div({className:"flex-pane-feedback-title"},b.Resources.LocalizedStrings.FlexPane_FeedbackView_SuggestionTitle),React.DOM.div({className:"flex-pane-feedback-desription"},b.Resources.LocalizedStrings.FlexPane_FeedbackView_SuggestionDescription),React.DOM.button(c,b.Resources.LocalizedStrings.FlexPane_FeedbackView_SuggestionButton),React.DOM.div({className:"flex-pane-feedback-suggestionterm"},b.Resources.LocalizedStrings.FlexPane_FeedbackView_SuggestionTerms));return React.DOM.div({className:"flex-pane-feedback-container"},React.DOM.div({className:"flex-pane-feedback-content"},d))},d}(a.ReactComponent)}(d=c.FlexPane||(c.FlexPane={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(d){function e(a){return React.createElement(i,a)}function f(){return i.selectMedia().then(function(a){switch(a){case h.Image:return d.pickImage().then(function(a){return{Image:a}},function(a){return g(a)});case h.Video:return d.pickVideo().then(function(a){return{Video:a}},function(a){return g(a)});default:return $.Deferred().reject(!0).promise()}})}function g(a){return a?f():void 0}d.createMediaSelectView=e,d.pickMedia=f;var h;!function(a){a[a.None=0]="None",a[a.Image=1]="Image",a[a.Video=2]="Video"}(h||(h={}));var i=function(d){function e(){var a=null!==d&&d.apply(this,arguments)||this;return a.state={HoverOption:h.None},a}return __extends(e,d),e.selectMedia=function(){e.selectDeferred&&e.selectDeferred.reject(),e.selectDeferred=$.Deferred();var a=c.getUxStateMaster();return a.Model.FlexPane="MediaSelect",Forms.UX.Utilities.trackFocusJump("Flexpane-MediaSelect",function(){e.selectDeferred.resolve(h.None)}),e.selectDeferred.promise()},e.prototype.render=function(){return React.DOM.div({className:"media-select-container"},React.DOM.span({className:"media-select-label"},b.Resources.LocalizedStrings.ImagePicker_Insert_Mdeia_button),this.createMediaSelectButtons(h.Image),!a.EnvironmentConfig.isSovereignProd()&&this.createMediaSelectButtons(h.Video))},e.prototype.createMediaSelectButtons=function(c){var d=this,e=c===h.Image,f={role:"button",className:"flex-pane-content-title flex-pane-media-content",onClick:function(){d.mediaContentSelected(c)},onKeyUp:function(b){(b.keyCode===a.KeyCode.Enter||b.keyCode===a.KeyCode.Space)&&d.mediaContentSelected(c)},onMouseEnter:function(){e?d.setState({HoverOption:h.Image}):d.setState({HoverOption:h.Video})},onMouseLeave:function(){d.setState({HoverOption:h.None})},tabIndex:0};return React.DOM.div(f,React.DOM.span({className:"flex-pane-icon-container"},a.Control.createFontIconControl({HTMLAttributes:{className:"flex-pane-icon forms-icon-size20x20"},IconName:e?"Camera":"Video"})),e?b.Resources.LocalizedStrings.ImagePicker_Type_Image:b.Resources.LocalizedStrings.ImagePicker_Type_Video)},e.prototype.mediaContentSelected=function(b){var c=b===h.Image,d=c?a.Event.EngagementEventNames.DesignPage.MediaPicker.ChooseImage:a.Event.EngagementEventNames.DesignPage.MediaPicker.ChooseVideo;a.Event.EngagementEventDeprecated.logData({name:d}),e.selectDeferred&&e.selectDeferred.resolve(b)},e}(a.ReactComponent)}(d=c.FlexPane||(c.FlexPane={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(d){function e(a){return React.createElement(g,a)}d.createShareView=e;var f;!function(a){a[a.None=0]="None",a[a.Link=1]="Link",a[a.Email=2]="Email",a[a.QRCode=3]="QRCode",a[a.Embed=4]="Embed"}(f||(f={}));var g=function(e){function g(d){var g=e.call(this,d)||this;g.mounted=!0,g.clipboardList=[],g.update=function(){g.mounted&&g.forceUpdate()};var h=g.props.Form.SettingMaster.Model,i=b.Resources.LocalizedStrings.SharePane_CollectResponse_DropDownOption1_Title,j=c.getUxStateMaster().Model.FormsTenantSettings;return(!h.IsAnonymous||j&&!j.externalSendForm||a.Utilities.isPhishingForm(g.props.Form.Model.OnlineSafetyLevel))&&(i=g.props.Form.Model.OwnerTenantId===OfficeFormServerInfo.userInfo.TenantId?b.Resources.LocalizedStrings.SharePane_CollectResponse_DropDownOption2_Title:b.Resources.LocalizedStrings.SharePane_CollectResponse_DropDownOption3_Title),g.state={QRCodeScriptsLoaded:!1,ShareOption:f.Link,CollectResponseOptionValue:i,ShareButtonChangeed:!1,LinkButtonChecked:!1},g}return __extends(g,e),g.prototype.componentWillMount=function(){var b=this;a.JavaScriptLoader.loadJavaScript("FileSave").done(function(){b.setState({QRCodeScriptsLoaded:!0})})},g.prototype.componentWillUnmount=function(){this.mounted=!1,this.clipboardList.forEach(function(a){a&&a.destroy()}),this.clipboardList=[]},g.prototype.componentDidMount=function(){c.getUxStateMaster().Model.FormMaster.observe(this.update,[b.Model.FormMaster.Schema.Questions]),this.copyClipboard("#flex-pane-button-link","#flex-pane-status-link",b.Resources.LocalizedStrings.SharePane_Link_SuccessMessage,b.Resources.LocalizedStrings.SharePane_Link_FailedMessage),this.copyClipboard("#flex-pane-button-embedCode","#flex-pane-status-embedCode",b.Resources.LocalizedStrings.SharePane_Others_Embed_SuccessMessage,b.Resources.LocalizedStrings.SharePane_Others_Embed_FailedMessage),this.copyClipboard("#flex-pane-share-ShareAsTemplate-link","#flex-pane-share-ShareAsTemplate-status-link",b.Resources.LocalizedStrings.SharePane_Link_SuccessMessage,b.Resources.LocalizedStrings.SharePane_Link_FailedMessage),this.copyClipboard("#flex-pane-share-Collaboration-link","#flex-pane-share-Collaboration-status-link",b.Resources.LocalizedStrings.SharePane_Link_SuccessMessage,b.Resources.LocalizedStrings.SharePane_Link_FailedMessage),this.copyClipboard("#flex-pane-share-AnalysisResult-link","#flex-pane-share-AnalysisResult-status-link",b.Resources.LocalizedStrings.SharePane_Link_SuccessMessage,b.Resources.LocalizedStrings.SharePane_Link_FailedMessage)},g.prototype.componentDidUpdate=function(){this.state.ShareOption===f.Link&&this.state.LinkButtonChecked?$(ReactDOM.findDOMNode(this.refs.link_button)).focus():this.state.ShareOption===f.QRCode?$(ReactDOM.findDOMNode(this.refs.qr_button)).focus():$(ReactDOM.findDOMNode(this.refs.embed_button)).focus()},g.prototype.render=function(){var a;this.props.Form;return a=React.DOM.div({className:"flex-pane-share-options-container"},this.createCollectResponseBox(),d.createShareAsTemplate({Form:this.props.Form,ShareOption:d.FormSharingType.ShareAsTemplate}),OfficeFormServerInfo.userInfo.IsMsa?void 0:d.createCollaborate({Form:this.props.Form,ShareOption:d.FormSharingType.Collaboration})),React.DOM.div({id:"flex-pane-share-pane"},a)},g.prototype.createCollectResponseBox=function(){var a=React.DOM.div({className:"flex-pane-content-container-title"},React.DOM.div(null,b.Resources.LocalizedStrings.SharePane_CollectResponse_MoreChannels));return React.DOM.div({className:"flex-pane-collect-response-container"},React.DOM.div({className:"flex-pane-collect-response-more-channel-container"},a,this.createShareContentTitle(),this.createShareContentTitleDropDown(),React.DOM.div({className:"flex-pane-collect-response-more-channel-element"},this.createLinkChannelContent(),this.createQRChannelContent(),this.createWebEmbedChannelContent(),this.createChannelIconContainer())))},g.prototype.createShareContentTitle=function(){var c=!a.Flighting.Flight.isEnabled(a.Flighting.Flights.EnableNonAnonymousForMSA)&&OfficeFormServerInfo.userInfo.IsMsa;return c?React.createElement("div",{className:"flex-pane-share-content-title"},b.Resources.LocalizedStrings.SharePane_CollectResponse_DropDownOption1_Title):a.EnvironmentConfig.isSovereignProd()?React.createElement("div",{className:"flex-pane-share-content-title"},b.Resources.LocalizedStrings.SharePane_CollectResponse_DropDownOption2_Title):void 0},g.prototype.createChannelIconContainer=function(){return React.createElement("div",{className:"flex-pane-channel-title-container"},this.createMoreChannelButton(f.Link,"Link","sharepane-response-link-icon"),this.createMoreChannelButton(f.QRCode,"qrcodeIcon","qrcode-icon"),this.createMoreChannelButton(f.Embed,"Embed",""),this.createMoreChannelButton(f.Email,"Mail",""),a.Flighting.Flight.isEnabled(a.Flighting.Flights.SocialSharing)&&OfficeFormServerInfo.userInfo.IsMsa&&React.createElement(Forms.UX.FlexPane.SocialShareView,{FormMaster:b.Model.exportConverter(this.props.Form)}))},g.prototype.createLinkChannelContent=function(){var a=this.state;return a.ShareOption===f.Link?React.DOM.div({className:"flex-pane-channel-content"},React.DOM.div({className:"flex-pane-content-body-container"},this.createCollectResponseCopyLinkBox())):void 0},g.prototype.createQRChannelContent=function(){if(this.state.ShareOption!==f.QRCode)return null;var d;if(this.state.QRCodeScriptsLoaded){var e=this.props.Form,g=void 0;a.Flighting.Flight.isEnabled(a.Flighting.Flights.QRCodePlus)&&"Poll"===e.Model.Category&&(g=React.DOM.a({className:"flex-pane-link",href:"javascript:void(0)",onClick:function(){c.getUxStateMaster().Model.TopView="QRcodePlus",a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.QRCodePlus.Navigate})}},b.Resources.LocalizedStrings.SharePane_QRCodePlus_Link)),d=React.DOM.div({id:"flex-pane-qrcode-img",ref:"qrcodeCanvas",className:"flex-pane-content-body-container"},React.DOM.div({className:"flex-pane-qrcode-container"},React.DOM.span({id:"qrcode-hint"},b.Resources.LocalizedStrings.SharePane_QRCode_Hint),React.DOM.button({"aria-describedby":"qrcode-hint",className:"flex-pane-button",ref:"qr_button",title:b.Resources.LocalizedStrings.SharePane_QRCode_DownloadButton,onClick:this.downloadQRCodeImage.bind(this)},b.Resources.LocalizedStrings.SharePane_QRCode_DownloadButton),g),React.createElement(Forms.UX.Controls.QRCode,{URL:this.getShareContentUrl()+"&qrcode=true",Title:e.Model.Title,ref:"qrcode"}))}return React.DOM.div({className:"flex-pane-channel-content"},d)},g.prototype.createWebEmbedChannelContent=function(){if(this.state.ShareOption===f.Embed){var a=React.DOM.div({className:"flex-pane-subtitle"},b.Resources.LocalizedStrings.SharePane_Others_Embed_Label),c=React.DOM.input({"aria-label":b.Resources.LocalizedStrings.Embedded_Code_Text,readOnly:!0,value:this.getEmbedCode(),className:"flex-pane-textbox",id:"flex-pane-textbox-embedCode"}),d={className:"flex-pane-button",id:"flex-pane-button-embedCode",ref:"embed_button",title:b.Resources.LocalizedStrings.SharePane_Others_Embed_CopyButton};d["data-clipboard-target"]="#flex-pane-textbox-embedCode";var e=React.DOM.button(d,b.Resources.LocalizedStrings.SharePane_Others_Embed_CopyButton);return React.DOM.div({className:"flex-pane-channel-content"},React.DOM.div({className:"flex-pane-content-body-container"},a,c,e,React.DOM.div({className:"flex-pane-status",id:"flex-pane-status-embedCode",role:"alert"})))}},g.prototype.createMoreChannelButton=function(c,d,e){var g,h=this,i=this.state.ShareOption===c;i&&this.state.ShareOption!==f.Email&&(g=React.DOM.div({className:"flex-pane-more-channel-div"}));var j=i?"flex-pane-more-channel-icon active":"flex-pane-more-channel-icon";return j=a.Utilities.Html.combineAttributes(j,e,"forms-icon-size24x24"),React.DOM.div({className:"flex-pane-more-channel-box"},g,a.Control.createGlyphButton({HTMLAttributes:{className:i?"flex-pane-more-channel-option active":"flex-pane-more-channel-option",onClick:function(){return h.activeChannelContent(c)}},Icon:d,IconClassName:j,ButtonStyle:a.Control.ButtonStyle.LightBackground,GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly,Text:b.Resources.LocalizedStrings["Share_Options_"+f[c]],key:f[c]}))},g.prototype.activeChannelContent=function(c){var d=this;if(c===f.Email)this.setState({ShareOption:f.Email},function(){Forms.Common.logFlightStatus(a.Flighting.Flights.SocialSharing),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Send.Email});var c=d.props.Form.Model.Title,e=b.Resources.LocalizedStrings.SharePane_Email_Content.format(c,d.getShareContentUrl());c=encodeURIComponent(b.Resources.LocalizedStrings.SharePane_Email_Subject.format(c)),e=encodeURIComponent(e),location.href="mailto:?subject={0}&body={1}".format(c,e),d.props.Form.triggerShareAction()});else{this.state.ShareOption!==c&&(Forms.Common.logFlightStatus(a.Flighting.Flights.SocialSharing),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Send[f[c]]})),c===f.Link&&this.setState({LinkButtonChecked:!0});var e=this.state.ShareButtonChangeed;this.setState({ShareOption:c,ShareButtonChangeed:!e})}},g.prototype.createShareContentTitleDropDown=function(){var d=this,e=!a.Flighting.Flight.isEnabled(a.Flighting.Flights.EnableNonAnonymousForMSA)&&OfficeFormServerInfo.userInfo.IsMsa||a.EnvironmentConfig.isSovereignProd();if(e)return null;var f=this.props,g=f.Form,h=g.Model.OwnerTenantId===OfficeFormServerInfo.userInfo.TenantId,i=(this.state.CollectResponseOptionValue,function(c){d.setState({CollectResponseOptionValue:c});var e=g.SettingMaster.Model;e.IsAnonymous=c===b.Resources.LocalizedStrings.SharePane_CollectResponse_DropDownOption1_Title,e.IsAnonymous?(e.NotRecordIdentity=!0,e.RequiresUniqueResponse=!1):e.NotRecordIdentity=!1,a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Share.ChooseAllowAnonymous,extraData:{Value:e.IsAnonymous}})}),j=[{DisplayName:b.Resources.LocalizedStrings.SharePane_CollectResponse_DropDownOption1_Title,Value:b.Resources.LocalizedStrings.SharePane_CollectResponse_DropDownOption1_Title,Key:"AnonymousButton",DisplayContent:React.DOM.span({id:"AnonymousButton",title:b.Resources.LocalizedStrings.SharePane_CollectResponse_DropDownOption1_Tooltip},b.Resources.LocalizedStrings.SharePane_CollectResponse_DropDownOption1_Title),Disabled:!c.getUxStateMaster().Model.FormsTenantSettings.externalSendForm||a.Utilities.isPhishingForm(this.props.Form.Model.OnlineSafetyLevel)}],k=h?b.Resources.LocalizedStrings.SharePane_CollectResponse_DropDownOption2_Title:b.Resources.LocalizedStrings.SharePane_CollectResponse_DropDownOption3_Title,l=h?b.Resources.LocalizedStrings.SharePane_CollectResponse_DropDownOption2_Tooltip:b.Resources.LocalizedStrings.SharePane_CollectResponse_DropDownOption3_Tooltip,m=!1;return g.isFieldReady(b.Model.FormMaster.Schema.Category)&&b.CategoryExtensionPoints.supportsExtensionPoint(g,b.ExtensionPoints.DisableEditForm)&&(m=!0),j.push({DisplayName:k,Value:k,Key:"Non-AnonymousButton",DisplayContent:React.DOM.span({id:"Non-AnonymousButton",title:l},k)}),React.DOM.div({className:"flex-pane-option-dropdown-element"},a.Control.createSelect({SelectOptions:j,Value:this.state.CollectResponseOptionValue,onValueChange:i,HTMLAttributes:{disabled:m}}))},g.prototype.createCollectResponseCopyLinkBox=function(){var c={readOnly:!0,"aria-label":b.Resources.LocalizedStrings.Link_Collect_Responses,value:this.getShareContentUrl(),className:"flex-pane-textbox",id:"flex-pane-textbox-link",onClick:function(){var a=$("#flex-pane-textbox-link");a.focus(),a.select()}},d=React.DOM.input(c),e={type:"button",className:"flex-pane-button",id:"flex-pane-button-link",ref:"link_button",title:b.Resources.LocalizedStrings.SharePane_Link_CopyButton,onClick:function(){Forms.Common.logFlightStatus(a.Flighting.Flights.SocialSharing),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Send.CopyLink})}};e["data-clipboard-target"]="#flex-pane-textbox-link";var f=React.DOM.button(e,b.Resources.LocalizedStrings.SharePane_Link_CopyButton),g=React.DOM.div(null,d,f,React.DOM.div({className:"flex-pane-status",id:"flex-pane-status-link",role:"alert"}));return g},g.prototype.copyClipboard=function(b,c,d,e){var f=new Clipboard(b);this.clipboardList.push(f);var g=this.props.Form;f.on("success",function(e){g.triggerShareAction(),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Send.ActionSuccess,extraData:{action:b}});var f=$(c);f.removeClass("flex-pane-status-error"),f.addClass("flex-pane-status-success"),f.text(d),f.show(),setTimeout(function(){f.fadeOut("slow",function(){f.hide()})},3e3),e.clearSelection()}),f.on("error",function(d){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Send.ActionFailed,extraData:{action:b}});var f=$(c);f.removeClass("flex-pane-status-success"),f.text(e),f.addClass("flex-pane-status-error")})},g.prototype.downloadQRCodeImage=function(){var b=this.refs.qrcode;b&&(b.download(),this.props.Form.triggerShareAction(),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Send.DownloadQRCode}))},g.prototype.getEmbedCode=function(){var b={id:this.props.Form.Model.Id,embed:!0},c="../Pages/ResponsePage.aspx?"+jQuery.param(b);return'<iframe width="640px" height= "480px" src= "'+a.Utilities.Html.getAbsoluteUrl(c)+'" frameborder= "0" marginwidth= "0" marginheight= "0" style= "border: none; max-width:100%; max-height:100vh" allowfullscreen webkitallowfullscreen mozallowfullscreen msallowfullscreen> </iframe>'},g.prototype.getShareContentUrl=function(){var b={id:this.props.Form.Model.Id},c="../Pages/ResponsePage.aspx?"+jQuery.param(b);return a.Utilities.Html.getAbsoluteUrl(c)},g.prototype.showEmailErrorMessage=function(a){var b=$("#flex-pane-status-mail");b.removeClass("flex-pane-status-success"),b.removeClass("flex-pane-status-error"),b.addClass("flex-pane-status-error"),b.text(a),b.show()},g.prototype.showEmailInfoMessage=function(a){var b=$("#flex-pane-status-mail");b.removeClass("flex-pane-status-success"),b.removeClass("flex-pane-status-error"),b.text(a),b.show()},g.prototype.showEmailSuccessMessage=function(a){var b=$("#flex-pane-status-mail");b.removeClass("flex-pane-status-success"),b.removeClass("flex-pane-status-error"),b.addClass("flex-pane-status-success"),b.text(a),b.show(),setTimeout(function(){return b.fadeOut()},3e3)},g.prototype.buildMailBodyFromTemplate=function(a,b){var c=a;for(var d in b)c=c.replace("%%"+d+"%%",b[d]);return c},g.prototype.buildMailAttachments=function(){return[{fileName:"FormLogo.png",contentType:"image/png",content:"iVBORw0KGgoAAAANSUhEUgAAAJUAAAAfCAYAAADuiY/xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAABLhJREFUeNrsXL1uGkEQ5qKUiRzyArHgAewIerB01EmDa1dQxlIiHUWkGCXFnZTCLVSuTePURjL0tkQeAKS8gM9WHoDMkG+l0fr+OWwM+0mj43b3dm5nv52ZvQOs+XxeMDDIEy+zXvj6x5c3dNgnqZPs/v3688iY0yAxqYhAC+JA6iDTjtbMkMrgIamIPLsgjBI+3zNmMkhFKiLSCbxPbdnOqK9Rgn7uSc4oXB4b828mXuRFqBTgsPmJCPjRmH9zSfXYGOO4b8xvdn9p0CUZaWUcZnnHeBxQZ2BIlQhXyJ92RC7FofYsYOdosCWkGgeUpc29OG86xQ7yCF7K7Ca3lFRj2p3VA3Z3aR+/n4JY3NcuPv8i+bDthidbtujgkhRJ2mTv/laEPxr4PvKgrGCvdAEPdQXvN0lKKtI/pcOMDN6ImZweSYPaDenc4cmiz9aa254J5dF9einJyDYpacXDKButW051msPjhj0QKitsMqTNhAmpd+QJJslbZzbReErwUANRVqHDdcLFsNaebZWJ+kFA2R1CYBr4IM4wYHKamJxNwKaMY2Wk+gbJA+x1XF7dtDpnWl1L1Wvh0KG2ZVFmo00FRRxSy6otSR/1qryE86bQ1ae6tujT1bxklepvUOfg3lSY4vKODM8on9J5AQvG1vLWcsB4k3jBUN3SPnLMnDrwvaCsJRZzB2R3Rdmh6KuC1EPZdUB1h3EPP4/hcQ5CPM9jwEeYcDTj2RhMP8bITIxLDNhCeOmIJiWQ5y0IVUT7EiaW21cRhntiYpqivqFNqgsSKn08sZdYGLwIyoI4FvKhBsK3BclKqFDdYWOWqQYWhwWb92B3WXYu2p9rdl0sqkhSUcMJyUhJivF1NTIqeY+6tFisIM0wDgbkx1zrYKV6YlyDgBzFF96vSOdVNbHwQG3cQ1GFKlE/VF4qRF8b3qiV00LrsUcT4mTQ3Q6wnSfG4YWUFeGhFDl9LZ+N3f1xop71dcpVyLOvUdqOEDaGWF0eBmWLFR92/0V4s3aUJxRGU4YahNxDQXjHJp1fg9heWAIud2gqxOWAB4l6St36mGU7Nd4ZxnsTUKbyvzYIXgH5ZrGeCoSqCUmDcYBMlsytHBClBRcfFyKKIoRGhde0JOdJqWICmVxTsXqfA/w8OgGxyyI/7CUhVVbU4ZF0uUNdlgEMxU6wFZdLifDkawl3HGZBHgU5nL5yPZCLr2kJfUEeyZbX5o2n0s16EWIbKkVZFalqYgeoS21Zb4WHfTcprnGRXMuENip/4zbXKocDoXpw8T6fq/5EjuULfT2pgz6fJ9hUzJQu1ot+s9gni+6sz9tccZ8q3/VXRaoxEvIgGS/pbmdpHm4i3+mAWHNs2e2o0IZV58Olz7Eb5HArd40u6m7xKKKj6XOEPjZ4Iypco64PXdOM9smkewkwWW+hx4Ee33r1/fMoxHv8Kfx/RbOTcECW+OZnNyTMTRAC2WN16ZqTgsHGIWr39y6HEBiEkTH79pJqWeT1msbAkGqBPF/TGDwzvHhC3RNj/s0lFU/u70fUeY8k/cKYfzNhyf9SwJfy1I9I6zgmStifwZfiDJ6CVGFI8rN3QyqDVIl60DcUxB90KM9mYLDAPwEGACkDXOmeh+yUAAAAAElFTkSuQmCC"}]},g}(a.ReactComponent)}(d=c.FlexPane||(c.FlexPane={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(d){function e(a){return React.createElement(f,a)}d.createThemeView=e;var f=function(e){function f(a){var b=e.call(this,a)||this;b.needChangeFocus=!1,b.update=function(){return b.forceUpdate()},b.formMaster=c.getUxStateMaster().Model.FormMaster;var d=b.formMaster.ThemeMaster;b.state={Theme:d,CustomizedImage:b.formMaster.Model.Background,ShowSpinner:!1,ShowErrorMessage:!1,ColorScriptLoaded:!1};var f=b.formMaster.getImageMaster(b.formMaster.Schema.Background);return f.observe(b.update,[f.Schema.ImageProcessingStatus]),b}return __extends(f,e),f.prototype.componentWillMount=function(){var b=this;a.JavaScriptLoader.loadJavaScript("ColorThief").done(function(){b.setState({ColorScriptLoaded:!0})})},f.prototype.componentWillUnmount=function(){var a=this.formMaster.getImageMaster(this.formMaster.Schema.Background);a.unobserve(this.update)},f.prototype.componentDidUpdate=function(){var a=ReactDOM.findDOMNode(this.refs.AddImageButton);a&&this.needChangeFocus&&(a.focus(),this.needChangeFocus=!1)},f.prototype.render=function(){return React.DOM.div(null,React.DOM.div({className:"theme-designer-container",key:"theme-designer-container"},this.createPredefinedThemeList(),this.state.CustomizedImage.ResourceId?this.createCustomizedThemeButton():this.createUploadCustomizedThemeButton()),this.createErrorhandler())},f.prototype.createPredefinedThemeList=function(){var c=this,d=this.formMaster.ThemeMaster;return Forms.Models.predefinedThemes.map(function(e){var f,g=b.Resources.LocalizedStrings["Theme_Name_"+e.Name],h={className:"theme-icon-button",title:g,"aria-label":g,onClick:function(){return c.onClickThemeButton(e.Name,c.formMaster)}};return f=e.Thumbnail?{backgroundImage:"url("+e.Thumbnail+")"}:{backgroundColor:e.PrimaryColor},React.DOM.span({className:"theme-icon-container",key:e.Name},a.Control.createButton({HTMLAttributes:h,key:e.Name,ButtonStyle:a.Control.ButtonStyle.LightBackground,ToggleActive:d.Model.Name===e.Name,children:React.DOM.span({className:"theme-icon",style:f})}))})},f.prototype.createCustomizedThemeButton=function(){var d=this,e=this.formMaster.ThemeMaster,f=this.formMaster.Model.Background,g="Customized Theme",h={className:"theme-icon-button",title:b.Resources.LocalizedStrings.Customized_Theme_Name,onClick:function(){return d.applyCustomizedTheme()}},i=a.Control.createGlyphButton({HTMLAttributes:{className:"customized-theme-delete-button",onClick:function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Theme.DeleteImage}),d.setState({ShowSpinner:!0});var e=c.getUxStateMaster().Model.FormMaster,f=e.getImageMaster(b.Model.FormMaster.Schema.Background),h=d.state.Theme.Model.Name===g;f.clear().then(function(){d.setState({ShowSpinner:!1}),d.needChangeFocus=!0,h?d.onClickThemeButton(Forms.Models.defaultTheme.Name,e):d.forceUpdate()})}},Icon:"Delete",IconClassName:"paneThemeTrash forms-icon-size18x18",ButtonStyle:a.Control.ButtonStyle.LightBackground,GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly,Text:b.Resources.LocalizedStrings.Delete_Customized_Theme,key:"deleteButton"});return React.DOM.span({className:"theme-icon-container",key:"added"},a.Control.createButton({HTMLAttributes:h,ButtonStyle:a.Control.ButtonStyle.LightBackground,ToggleActive:e.Model.Name===g,children:React.DOM.img({className:"theme-icon",key:g,src:f.IsPredefined?f.ResourceUrl:f.ResourceUrl+"_mo",onLoad:function(){d.setState({ShowSpinner:!1})}})}),i,this.creatSpinner())},f.prototype.createUploadCustomizedThemeButton=function(){var c=this,d=this.formMaster.getImageMaster(b.Model.FormMaster.Schema.Background),e={className:"theme-icon-button",disabled:d.Model.ImageProcessingStatus!==b.Model.ImageProcessingStatus.Idle,onClick:function(){return c.onClickUploadCustomizedThemeButton()}};return React.DOM.span({className:"theme-icon-container",key:"add"},a.Control.createGlyphButton({HTMLAttributes:e,Icon:"Photo2",IconClassName:"customized-theme-pictureAdd-icon forms-icon-size28x28",ButtonStyle:a.Control.ButtonStyle.LightBackground,GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly,Text:b.Resources.LocalizedStrings.Add_Customized_Theme_Image,ref:"AddImageButton"}),this.creatSpinner())},f.prototype.onClickUploadCustomizedThemeButton=function(){var e=this;a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Theme.AddImage}),d.pickImage().done(function(d){var f=c.getUxStateMaster().Model,g=e.formMaster.Model;if(f.FlexPane="Theme",e.setState({ShowSpinner:!0}),e.formMaster.getImageMaster(b.Model.FormMaster.Schema.Background).addImage(d).always(function(){e.applyCustomizedTheme()}),e.state.ColorScriptLoaded)if(d.File&&d.File.size<=b.FormLimitation.ImageMaxSize){var h=new FileReader;h.onload=function(b){var c=new Image;c.src=h.result,c.onload=function(b){var d,f=new ColorThief;try{d=f.getColor(c)}catch(h){d=[0,130,114]}var i={R:d[0],G:d[1],B:d[2]},j=a.ColorHelper.rGBToHSV(i);a.ColorHelper.isValidColorContrast(i)||(j.V=.45,i=a.ColorHelper.hSVToRGB(j)),e.formMaster.bulkEdit(function(){g.PrimaryCustomizedThemeColor=a.ColorHelper.colorToHex(i);var b=a.ColorHelper.hSVToRGB({H:j.H,S:j.S,V:j.V-.1});g.SecondaryCustomizedThemeColor=a.ColorHelper.colorToHex(b);var c=a.ColorHelper.hSVToRGB({H:j.H,S:.1,V:1});g.TertiaryCustomizedThemeColor=a.ColorHelper.colorToHex(c)})}},h.readAsDataURL(d.File)}else d.FromUrl&&e.formMaster.bulkEdit(function(){g.PrimaryCustomizedThemeColor=Forms.Models.defaultCustomizedPrimaryColor,g.SecondaryCustomizedThemeColor=Forms.Models.defaultCustomizedSecondaryColor,g.TertiaryCustomizedThemeColor=Forms.Models.defaultCustomizedBackgroundColor})})},f.prototype.onClickThemeButton=function(b,c){var d=c.ThemeMaster;a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Theme.SwitchTheme,extraData:{theme:b}}),d.Model.Name=b,this.setState({Theme:d,ShowErrorMessage:!1})},f.prototype.applyCustomizedTheme=function(){var a=this.formMaster.Model,c=a.Background.ResourceUrl;a.PrimaryCustomizedThemeColor,a.SecondaryCustomizedThemeColor,a.TertiaryCustomizedThemeColor;c?this.onClickThemeButton(b.Resources.LocalizedStrings.Customized_Theme_Name,this.formMaster):(a.PrimaryCustomizedThemeColor=void 0,a.SecondaryCustomizedThemeColor=void 0,a.TertiaryCustomizedThemeColor=void 0,this.setState({ShowErrorMessage:!0}))},f.prototype.creatSpinner=function(){var a=this.formMaster.getImageMaster(b.Model.FormMaster.Schema.Background),c=!this.state.ShowSpinner&&a.Model.ImageProcessingStatus===b.Model.ImageProcessingStatus.Idle||a.Model.ErrorType!==b.Model.ImageErrorType.NoError?void 0:React.DOM.div({className:"customized-theme-spinner-container"},React.DOM.div({className:"customized-theme-spinner"},React.DOM.div({className:"spinner-tile-animation"})));return c},f.prototype.createErrorhandler=function(){var d=c.getUxStateMaster().Model.FormMaster;if(!d)return null;var e=d.getImageMaster(b.Model.FormMaster.Schema.Background),f=e.Model;if(!this.state.ShowErrorMessage||f.ErrorType===b.Model.ImageErrorType.NoError)return null;var g=a.Control.createLabel({HTMLAttributes:{className:"error-message"},Label:e.getImageErrorMessage(),key:"error-message"}),h=a.Control.createFontIconControl({HTMLAttributes:{className:"customized-theme-error-frowny-icon"},IconName:"Sad",key:"customized-theme-error-frowny-icon"});return React.DOM.div({className:"customized-theme-error",key:"customized-them-error"},h,g)},f}(a.ReactComponent)}(d=c.FlexPane||(c.FlexPane={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(d){var e=function(d){function e(){return null!==d&&d.apply(this,arguments)||this}return __extends(e,d),e.prototype.render=function(){var a;return this.state.Loading&&(a=React.DOM.div({className:"image-picker-loading-container"},React.DOM.div({className:"image-picker-loading spinner-tile-animation"}))),React.DOM.div({className:"image-picker-container"},this.createBackButton(),this.createSwitchButtons(),this.createPickerContent(),this.createErrorHandling(),a);
},e.prototype.createSwicherButton=function(b,c,d){return React.DOM.div({className:"image-picker-switch-button-wrapper"},a.Control.createTextButton({HTMLAttributes:{className:"image-picker-switch-button",onClick:d},ToggleActive:c,ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b}))},e.prototype.createBackButton=function(){var d=this;return"MediaSelect"===c.getUxStateMaster().Model.PreviousFlexPane?React.DOM.div(null,a.Control.createGlyphButton({HTMLAttributes:{className:"image-picker-back-button",onClick:function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.MediaPicker.Back}),d.setState({Loading:!1,ErrorState:void 0},function(){c.getUxStateMaster().Model.FlexPane="MediaSelect",d.rejectPickerDeferred()})}},ButtonStyle:a.Control.ButtonStyle.LightBackground,Icon:"Back",IconClassName:"image-picker-back-button-img forms-icon-size17x17",Text:b.Resources.LocalizedStrings.ImagePicker_Back_Button,TextClassName:"image-picker-back-button-text"})):void 0},e}(a.ReactComponent);d.MediaPickerView=e}(d=c.FlexPane||(c.FlexPane={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(d){function e(){return h.pickImage()}function f(a){return React.createElement(h,a)}a.Exports.FlexPane=d,d.pickImage=e,d.createImagePickerView=f;var g;!function(a){a[a.BingSearch=0]="BingSearch",a[a.OD4B=1]="OD4B",a[a.Local=2]="Local"}(g=d.ImagePickerType||(d.ImagePickerType={}));var h=function(e){function f(){var c=null!==e&&e.apply(this,arguments)||this;return c.mounted=!0,c.state={BingSearchKeyword:"",OneDrivePath:[{Title:OfficeFormServerInfo.userInfo.DisplayName+b.Resources.LocalizedStrings.ImagePicker_OneDrive_PathRootSuffix,ResourceId:f.OneDriveRoot}],BingSearchPrivacyLinkEnable:!0,ImagePickerTypeState:a.EnvironmentConfig.isSovereignProd()?g.OD4B:g.BingSearch,BingSearchLicensesValue:!0},c}return __extends(f,e),Object.defineProperty(f,"OneDriveRoot",{get:function(){return"root"},enumerable:!0,configurable:!0}),f.pickImage=function(){return f.imageDeferred&&f.imageDeferred.reject(),f.imageDeferred=$.Deferred(),c.getUxStateMaster().Model.FlexPane="ImagePicker",Forms.UX.Utilities.trackFocusJump("Flexpane-ImagePicker",function(){c.getUxStateMaster().Model.FlexPane="MediaSelect",f.rejectImagePicker(!0)}),f.imageDeferred.promise()},f.rejectImagePicker=function(a){f.imageDeferred&&(f.imageDeferred.reject(a),f.imageDeferred=null)},f.collapeFlexPaneHandler=function(){var a=c.getUxStateMaster().Model;"ImagePicker"===a.FlexPane&&(a.FlexPane="None")},f.prototype.componentWillUnmount=function(){this.mounted=!1,f.rejectImagePicker()},f.prototype.rejectPickerDeferred=function(){f.rejectImagePicker(!0)},f.prototype.createPickerContent=function(){var a=this,b=this.state;switch(b.ImagePickerTypeState){case g.OD4B:return d.ImagePicker.createOD4BImagePicker({ContainerWidth:this.props.ContainerWidth,showLoading:this.showLoading.bind(this),showError:this.ShowError.bind(this),addImageFromUrlHandler:this.addImageFromUrlHandler.bind(this),OneDrivePath:b.OneDrivePath,OnPathChange:function(b){a.setState({OneDrivePath:b})}});case g.BingSearch:default:return d.ImagePicker.createBingSearchImagePicker({ContainerWidth:this.props.ContainerWidth,showLoading:this.showLoading.bind(this),showError:this.ShowError.bind(this),addImageFromUrlHandler:this.addImageFromUrlHandler.bind(this),Value:b.BingSearchKeyword,onValueChange:function(b){a.setState({BingSearchKeyword:b})},IsPrivacyLinkEnable:b.BingSearchPrivacyLinkEnable,onPrivacyLinkEnableChange:function(b){a.setState({BingSearchPrivacyLinkEnable:b})},LicensesBarValue:b.BingSearchLicensesValue,onSearchLicenseSwitch:function(b){a.setState({BingSearchLicensesValue:b})}})}},f.prototype.createErrorHandling=function(){var c=this.state,d=c.ImagePickerTypeState,e=c.ErrorState&&c.ErrorState.InnerCode;if(!e||c.ErrorState.Source!==d)return void 0;var f,h="";switch(d){case g.BingSearch:h=b.Resources.LocalizedStrings.Error_Message_5403;break;case g.OD4B:h=b.Resources.LocalizedStrings.Error_Message_5401;break;default:throw Error("ImagePickerView.createErrorHandling:ImagePickerType.{0} shouldn't call this method".format(d))}switch(e){case 5400:f=b.Resources.LocalizedStrings.Error_Message_5400;break;case 5401:f=b.Resources.LocalizedStrings.Error_Message_5401;break;case 5402:f=b.Resources.LocalizedStrings.Error_Message_5402;break;case 5403:f=b.Resources.LocalizedStrings.Error_Message_5403;break;default:f=h}var i=a.Control.createFontIconControl({HTMLAttributes:{className:"image-picker-error-icon forms-icon-size32x32"},IconName:"Sad"});return React.DOM.div({className:"image-picker-error-hanlder-container"},i,React.DOM.div({className:"image-picker-error-message"},f))},f.prototype.createSwitchButtons=function(){var c=this,d=this.state.ImagePickerTypeState,e=a.EnvironmentConfig.isSovereignProd()?void 0:this.createSwicherButton(b.Resources.LocalizedStrings.ImagePicker_switcher_BingSearch,d===g.BingSearch,function(){c.switchTo(g.BingSearch,a.Event.EngagementEventNames.DesignPage.MediaPicker.BingSearch)}),h=this.createSwicherButton(b.Resources.LocalizedStrings.ImagePicker_switcher_OD4B,d===g.OD4B,function(){c.switchTo(g.OD4B,a.Event.EngagementEventNames.DesignPage.MediaPicker.OD4B)}),i=a.Control.createImagePicker({filePickedCallBack:function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.MediaPicker.Local}),f.imageDeferred&&f.imageDeferred.resolve({File:b}),f.collapeFlexPaneHandler()},UploadButtonHint:b.Resources.LocalizedStrings.ImagePicker_switcher_Upload,HTMLAttributes:{className:"image-picker-switch-button-wrapper"}});return React.DOM.div({className:"image-picker-switch-button-container"},e,h,i)},f.prototype.ShowError=function(a,b,c){this.setState({ErrorState:c?{InnerCode:b,Source:a}:null,Loading:!1})},f.prototype.switchTo=function(b,c){var d=this,e=this.state;if(a.Event.EngagementEventDeprecated.logData({name:c}),e.ErrorState&&e.ErrorState.Source===b)var f=e.ErrorState&&e.ErrorState.Source===b?e.ErrorState:null;this.setState({ErrorState:f,Loading:!1},function(){return d.setState({ImagePickerTypeState:b})})},f.prototype.showLoading=function(a){this.mounted&&!this.state.Loading!=!a&&this.setState({Loading:a,ErrorState:null})},f.prototype.addImageFromUrlHandler=function(a,b,c,d,e){f.imageDeferred&&f.imageDeferred.resolve({FromUrl:{Url:a,Size:c,Width:d,Height:e}}),f.collapeFlexPaneHandler()},f}(d.MediaPickerView)}(d=c.FlexPane||(c.FlexPane={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(c){var d;!function(d){function e(a){return React.createElement(f,a)}d.createBingSearchImagePicker=e;var f=function(e){function f(){var a=null!==e&&e.apply(this,arguments)||this;return a.mounted=!0,a.state=a.getDefaultState(),a}return __extends(f,e),f.prototype.getDefaultState=function(){return{UseShareLicense:!0,ShowSearchLicenseBar:!1,NodesData:[],OffSet:0,LastUrl:null,Total:null,SeletedImage:null}},f.prototype.componentDidMount=function(){this.state.ShowSearchLicenseBar||""===this.props.Value||this.setState({ShowSearchLicenseBar:!0}),this.searchData()},f.prototype.componentWillUnmount=function(){this.mounted=!1},f.prototype.render=function(){var b=this,c=0===this.state.NodesData.length?void 0:d.createImagePickerContentView({ContainerWidth:this.props.ContainerWidth,Nodes:this.state.NodesData,SelectedImage:this.state.SeletedImage,onPaging:this.searchData.bind(this),onSelectedImageChange:function(a){return b.setState({SeletedImage:a})},onSelectedImageDoubleClick:function(a){return b.setState({SeletedImage:a},b.addImage.bind(b))},onSelectedImageKeyUp:function(c,d){c===a.KeyCode.Enter&&b.addImage()}});return React.DOM.div({className:"basicContentPageWrapper"},React.DOM.div({className:"basicContentPageInnerWrapper"},this.createSearchBar(),this.props.IsPrivacyLinkEnable?this.createResponsibleLink():void 0,this.createSearchLicensesBar(),c))},f.filterImage=function(a){var c=a.filter(function(a){return a.Size<=b.FormLimitation.ImageMaxSize});return c},f.getBingSearchImages=function(c){var d=c.LicensesBarValue?"Share":"All",e=a.DataProvider.ProviderManager.getInstance().createDataProvider();return e.searchImage(c.Query,d,b.FormLimitation.ImagePickerQueryCount,c.OffSet,c.LastUrl).then(function(a){return f.getFilteredImages(c,a)})},f.getFilteredImages=function(c,d){var e=d.PartGroups.ImageParts,f=this.filterImage(e),g=f.map(function(b){var c=new a.ImageLayoutNode;return c.NaturalWidth=b.SourceUrl.Width,c.NaturalHeight=b.SourceUrl.Height,c.Src=b.SourceUrl.Url,c.ThumbnailSrc=b.ThumbnailUrl.Url,c.Title=b.Title,c.Size=b.Size,c});return c.LastUrl=e.length?e[e.length-1].SourceUrl.Url:void 0,c.OffSet=Number(d.Offset),c.Total=Number(d.TotalResults),c.NodesData=c.NodesData.concat(g),c.NodesData.length>=b.FormLimitation.ImagePickerQueryCount||c.OffSet>c.Total||0===c.Total||0===c.OffSet?$.Deferred().resolve(c).promise():this.getBingSearchImages(c)},f.prototype.searchData=function(){var a=this,b=this.state,d=this.props;if(!(b.OffSet>b.Total)&&d.Value){d.showLoading(!0);var e={UseShareLicense:d.LicensesBarValue,ShowSearchLicenseBar:b.ShowSearchLicenseBar,OffSet:b.OffSet,Total:b.Total,LastUrl:b.LastUrl,NodesData:[],Query:d.Value,LicensesBarValue:d.LicensesBarValue},g=f.getBingSearchImages(e);g.then(function(c){var e=b.NodesData.concat([c.NodesData]);d.showLoading(!1),a.mounted&&a.setState({NodesData:e,OffSet:c.OffSet,Total:c.Total,LastUrl:c.LastUrl})},function(b){a.props.showError(c.ImagePickerType.BingSearch,b.innerCode||b.statusCode,!0)})}},f.prototype.createSearchBar=function(){var c=this,d=a.Control.createTextField({Placeholder:b.Resources.LocalizedStrings.ImagePicker_BingSearch_HintMessage,HTMLAttributes:{className:"bingSearchTextField",onKeyDown:function(b){b.keyCode===a.KeyCode.Enter&&(a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.MediaPicker.Search}),c.searchButtonClicked())}},Value:this.props.Value,TextFieldType:a.Control.TextFieldType.SingleLine,MinimalHeight:40,onValueChange:function(a){return c.props.onValueChange(a)}}),e=a.Control.createGlyphButton({Icon:"Search",IconClassName:"forms-icon-size18x18",Text:b.Resources.LocalizedStrings.ImagePicker_BingSearch_TipMessage,HTMLAttributes:{className:"bingSearchButton",onClick:function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.MediaPicker.Search}),c.searchButtonClicked()}},ButtonStyle:a.Control.ButtonStyle.LightBackground,GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly}),f=a.Control.createTextButton({HTMLAttributes:{className:"image-picker-add-button",disabled:!this.state.SeletedImage,onClick:this.addImage.bind(this)},Text:b.Resources.LocalizedStrings.ImagePicker_Add_button,ButtonStyle:a.Control.ButtonStyle.LightBackground}),g=a.Control.createFontIconControl({HTMLAttributes:{className:"bingSearchIcon"},IconName:"BingLogo"});return React.DOM.div({className:"bingSearchContainer"},g,React.DOM.div({className:"bingSearchLabel"},b.Resources.LocalizedStrings.ImagePicker_BingSearch_LogoName),d,e,f)},f.prototype.addImage=function(){var b=this.state.SeletedImage;this.props.addImageFromUrlHandler&&(a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.MediaPicker.AddImage,extraData:{source:"BingSearch",size:this.state.SeletedImage.Size}}),this.props.addImageFromUrlHandler(b.Src,b.Title,b.Size,b.NaturalWidth,b.NaturalHeight)),this.setState({SeletedImage:null})},f.prototype.createResponsibleLink=function(){var c=this;return React.DOM.div({className:"bingSearchResponsibleLinkContainer"},React.DOM.div({className:"bingSearchResponsibleLinkContent"},React.DOM.span({className:"bingSearchResponsibleWarning"},b.Resources.LocalizedStrings.ImagePicker_Responsible_Warning),React.DOM.a({className:"bingSearchResponsibleLink",href:"http://go.microsoft.com/fwlink/?LinkId=824927",target:"_blank"},b.Resources.LocalizedStrings.ImagePicker_Responsible_Link)),a.Control.createGlyphButton({Icon:"Cancel",IconClassName:"forms-icon-size14x14",Text:b.Resources.LocalizedStrings.ImagePicker_Responsible_Close,HTMLAttributes:{className:"bingSearchResponsibleCloseButton",onClick:function(){c.props.onPrivacyLinkEnableChange(!1)}},ButtonStyle:a.Control.ButtonStyle.LightBackground,GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly}))},f.prototype.searchButtonClicked=function(){var a=this.getDefaultState();a.ShowSearchLicenseBar||""===this.props.Value?a.ShowSearchLicenseBar&&""===this.props.Value&&(a.ShowSearchLicenseBar=!1):a.ShowSearchLicenseBar=!0,this.setState(a,this.searchData.bind(this))},f.prototype.createSearchLicensesBar=function(){var c=this;return this.state.ShowSearchLicenseBar?React.DOM.div({className:"bingSearchResponsibleLinkContainer"},a.Control.createCheckBox({HTMLAttributes:{className:"bingSerachLicensesCheckBox",title:b.Resources.LocalizedStrings.ImagePicker_Creative_Commons_Licenses},Value:this.props.LicensesBarValue,Description:b.Resources.LocalizedStrings.ImagePicker_Creative_Commons_Licenses,onValueChange:function(a){return c.onSearchLicensesChange(a)},children:[React.DOM.a({className:"bingSearchResponsibleLink BingSearchlicenseLink",href:"http://go.microsoft.com/fwlink/?LinkId=825104",target:"_blank"},b.Resources.LocalizedStrings.ImagePicker_Responsible_Link)]})):void 0},f.prototype.onSearchLicensesChange=function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.MediaPicker.BingSearchLicense,extraData:{useShareLicense:b}}),this.props.onSearchLicenseSwitch(b);var c=this.getDefaultState();c.ShowSearchLicenseBar=this.state.ShowSearchLicenseBar,this.setState(c,this.searchData.bind(this))},f}(a.ReactComponent)}(d=c.ImagePicker||(c.ImagePicker={}))}(d=c.FlexPane||(c.FlexPane={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c;!function(b){var c;!function(b){function c(a){return React.createElement(d,a)}b.createImagePickerContentView=c;var d=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a.mounted=!0,a.PagingTimeoutId=null,a.PagingAreaHeight=10,a}return __extends(c,b),c.prototype.componentWillUnmount=function(){this.mounted=!1},c.prototype.render=function(){var a=this,b=_.extend({},this.props.HTMLAttributes);return b.id="imagePickerContentContainer",b.className="imagePickerContentContainer",b.onScroll=function(){a.paging()},React.DOM.div(b,this.createContentElement(this.LayoutContent()))},c.prototype.paging=function(){var a=this;this.PagingTimeoutId&&clearTimeout(this.PagingTimeoutId),this.PagingTimeoutId=setTimeout(function(){var b=document.getElementById("imagePickerContentContainer");b.scrollTop+b.clientHeight+a.PagingAreaHeight>=b.scrollHeight&&a.props.onPaging()},500)},c.prototype.LayoutContent=function(){var b=_.clone(this.props.Nodes),c=25,d=new a.LiquidLayout(this.props.ContainerWidth-2*c);return d.layoutContent(b)},c.prototype.createContentElement=function(b){var c=this,d=0,e=[];return b.forEach(function(b){switch(b.Type){case a.NodeType.Image:e.push(c.CreateImage(b,d++));break;case a.NodeType.Folder:e.push(c.CreateFolder(b,d++));break;default:throw Error("ImagePickerContentView.createImages: invaild node type {0}".format(b.Type))}}),e},c.prototype.CreateImage=function(b,c){var d=this.props;this.registerLazeLayout(b);var e=a.Control.createFontIconControl({HTMLAttributes:{className:"imageCheckIcon forms-icon-size14x14"},IconName:"CheckMark"});return a.Control.createButton({key:c,HTMLAttributes:{className:"imageContentPieceWrapper",style:{height:b.Height+"px",width:b.Width+"px",backgroundImage:"url('"+b.ThumbnailSrc+"')"},onClick:function(){return d.onSelectedImageChange(b)},onFocus:function(){return d.onSelectedImageChange(b)},onKeyUp:function(a){return d.onSelectedImageKeyUp(a.keyCode,b)},onDoubleClick:function(){return d.onSelectedImageDoubleClick(b)},title:b.Title},ButtonStyle:a.Control.ButtonStyle.LightBackground,ToggleActive:b===d.SelectedImage,children:[React.DOM.div({className:"imageCheckBox",key:"imageCheckBox"},e,React.DOM.div({className:"imageDescriptionLabel",key:"imageDescriptionLabel"},b.NaturalWidth+"x"+b.NaturalHeight))]})},c.prototype.CreateFolder=function(b,c){var d=this,e=a.Control.createFontIconControl({HTMLAttributes:{className:"folderImageIcon forms-icon-size26x26"},IconName:"FabricFolderFill"});return a.Control.createButton({key:c,HTMLAttributes:{className:"folderContentPieceWrapper",style:{width:b.Width+"px",height:b.Height+"px"},onClick:function(){d.props.onFolderClick(b)}},ButtonStyle:a.Control.ButtonStyle.LightBackground,children:React.DOM.div({className:"folderImage"},e,React.DOM.div({className:"folderFooter"},React.DOM.div({className:"folderBeak"}),React.DOM.div({className:"folderBeakHighlight"}),React.DOM.div({className:"folderTitle"},b.Title)))})},c.prototype.registerLazeLayout=function(a){var b=this;if(!_.contains(this.props.LazeLayoutCollection,a)&&(0===a.NaturalHeight||0===a.NaturalWidth)){var c=new Image;c.onload=function(){a.NaturalHeight=c.height,a.NaturalWidth=c.width,b.mounted&&b.setState({})},this.props.LazeLayoutCollection.push(a),c.src=a.ThumbnailSrc}},c}(a.ReactComponent)}(c=b.ImagePicker||(b.ImagePicker={}))}(c=b.FlexPane||(b.FlexPane={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(c){var d;!function(d){function e(a){return React.createElement(g,a)}d.createOD4BImagePicker=e;var f;!function(a){a[a.Idle=0]="Idle",a[a.Loading=1]="Loading",a[a.Loaded=2]="Loaded",a[a.Error=3]="Error"}(f||(f={}));var g=function(e){function g(){var a=null!==e&&e.apply(this,arguments)||this;return a.mounted=!0,a.state={NodesData:[],FolderNodes:[],ImageNodes:[],SkipToken:"",LoadingState:f.Idle,SeletedImage:null},a}return __extends(g,e),Object.defineProperty(g.prototype,"OneDriveRoot",{get:function(){return"root"},enumerable:!0,configurable:!0}),g.prototype.componentWillMount=function(){this.loadODBData()},g.prototype.componentWillUnmount=function(){this.mounted=!1},g.prototype.render=function(){var c=this,e=a.Control.createTextButton({HTMLAttributes:{className:"image-picker-add-button",disabled:!this.state.SeletedImage,onClick:this.addImage.bind(this)},Text:b.Resources.LocalizedStrings.ImagePicker_Add_button,ButtonStyle:a.Control.ButtonStyle.LightBackground}),f=a.Control.createFontIconControl({HTMLAttributes:{className:"oneDriveIcon"},IconName:"OneDrive"});return React.DOM.div({className:"basicContentPageWrapper"},React.DOM.div({className:"basicContentPageInnerWrapper"},React.DOM.div({className:"onDriveContainer"},f,React.DOM.div({className:"oneDriveLabel"},b.Resources.LocalizedStrings.ImagePicker_OneDrive_LogoName),e),this.createNavigationBar(),this.createEmptyElement(),d.createImagePickerContentView({ContainerWidth:this.props.ContainerWidth,Nodes:this.state.NodesData,SelectedImage:this.state.SeletedImage,onPaging:this.pagging.bind(this),onFolderClick:function(a){return c.setState({SeletedImage:null},function(){return c.navigateToSubFolder(a)})},onSelectedImageChange:function(a){return c.setState({SeletedImage:a})},onSelectedImageDoubleClick:function(a){return c.setState({SeletedImage:a},c.addImage.bind(c))},onSelectedImageKeyUp:function(b,d){b===a.KeyCode.Enter&&c.addImage()},LazeLayoutCollection:[]})))},g.prototype.addImage=function(){var b=this.state;a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.MediaPicker.AddImage,extraData:{source:"OneDrive",size:b.SeletedImage.Size}}),this.props.addImageFromUrlHandler(b.SeletedImage.Src,b.SeletedImage.Title,b.SeletedImage.Size,b.SeletedImage.NaturalWidth,b.SeletedImage.NaturalHeight)},g.prototype.createEmptyElement=function(){return 0===this.state.NodesData.length&&this.state.LoadingState===f.Loaded?React.DOM.div({className:"image-picker-oneDrive-emptyFolder-message"},b.Resources.LocalizedStrings.ImagePicker_OneDrive_EmptyFolderPromptMessage):void 0},g.prototype.navigateToSubFolder=function(a){var b=this,c=_.clone(this.props);this.state.LoadingState!==f.Loading&&this.setState({NodesData:[],FolderNodes:[],ImageNodes:[],SkipToken:""},function(){var d=_.contains(c.OneDrivePath,a)?c.OneDrivePath.splice(0,_.indexOf(c.OneDrivePath,a)+1):c.OneDrivePath.concat(a);b.props.OnPathChange(d),b.loadODBData()})},g.prototype.pagging=function(){this.state.SkipToken&&this.loadODBData()},g.prototype.loadODBData=function(){var d=this;this.state.LoadingState!==f.Loading&&this.setState({LoadingState:f.Loading},function(){d.props.showLoading(!0);var e=_.last(d.props.OneDrivePath),g=a.DataProvider.ProviderManager.getInstance().createDataProvider().browseImage(e.ResourceId,b.FormLimitation.ImagePickerQueryCount,d.state.SkipToken);g.then(function(b){var c=d.state,e=b.PartGroups.FolderParts,g=b.PartGroups.ImageParts,h=e.map(function(b){var c=new a.FolderLayoutNode;return c.Title=b.Title,c.ResourceId=b.ResourceId,c.AlbumCount=b.AlbumCount,c}),i=g.map(function(b){var c=new a.ImageLayoutNode;return c.Src=b.SourceUrl.Url,c.ThumbnailSrc=b.SourceUrl.Url,c.NaturalHeight=b.SourceUrl.Height,c.NaturalWidth=b.SourceUrl.Width,c.Title=b.Title,c.Size=b.Size,c}),j=h.length<=0?c.FolderNodes:c.FolderNodes.concat([h]),k=i.length<=0?c.ImageNodes:c.ImageNodes.concat([i]);d.props.showLoading(!1),d.mounted&&d.setState({FolderNodes:j,ImageNodes:k,NodesData:j.concat(k),SkipToken:b.Offset,LoadingState:f.Loaded})},function(a){d.setState({LoadingState:f.Error}),d.props.showError(c.ImagePickerType.OD4B,a.innerCode||a.statusCode,!0)})})},g.prototype.createNavigationBar=function(){var b=this,c=this.props.OneDrivePath.map(function(c,d){return a.Control.createButton({ButtonStyle:a.Control.ButtonStyle.LightBackground,HTMLAttributes:{className:"imagePickerContentPageBreadcrumbWrapper",onClick:function(){b.setState({SeletedImage:null},function(){return b.navigateToSubFolder(c)})}},children:React.DOM.span({},(c.ResourceId===b.OneDriveRoot?"":"> ")+c.Title),key:d})});return React.DOM.div({className:"imagePickerContentPageBreadcrumbContainer"},c)},g}(a.ReactComponent)}(d=c.ImagePicker||(c.ImagePicker={}))}(d=c.FlexPane||(c.FlexPane={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c;!function(b){function c(a){return React.createElement(d,__assign({},a))}b.createSettingsPaneToggleItem=c;var d=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.render=function(){var b={Label:this.props.Title,HTMLAttributes:{className:"setting-pane-toggle-item-title"},Options:{classNameForInnerDiv:"setting-pane-toggle-button"},Value:this.props.Value,onValueChange:this.props.onChange};return React.createElement("div",{className:"setting-pane-toggle-group"},a.Control.createToggleButton(b),this.getDescriptionLabel())},c.prototype.getDescriptionLabel=function(){return null!=this.props.Description?React.createElement("div",{className:"setting-pane-toggle-item-notification"},this.props.Description):void 0},c}(a.ReactComponent)}(c=b.FlexPane||(b.FlexPane={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(d){function e(a){return React.createElement(f,a)}d.createSettingsPane=e;var f=function(e){function f(a){var b=e.call(this,a)||this,c=b.props.Form.SettingMaster.Model;return b.state={EndRange:c.LockGivenQuestionsEndDisplayOrder&&c.LockGivenQuestionsEndDisplayOrder.toString(),ShowShuffleQuestionRangeError:!1,StartRange:c.LockGivenQuestionsStartDisplayOrder&&c.LockGivenQuestionsStartDisplayOrder.toString()},b}return __extends(f,e),f.prototype.componentDidMount=function(){var c=this,d=this.props.Form;this.update=function(){return c.forceUpdate()},d.SettingMaster.observe(this.update),d.observe(this.update,[b.Model.FormMaster.Schema.HasValidBranching,b.Model.FormMaster.Schema.QuizQuestionsCount,b.Model.FormMaster.Schema.ThankYouMessage]),a.Flighting.Flight.isEnabled(a.Flighting.Flights.EmailReceipt)&&d.observe(this.update,[b.Model.FormMaster.Schema.EmailReceiptEnabled])},f.prototype.componentWillUnmount=function(){var a=this.props.Form;a.unobserve(this.update),a.SettingMaster.unobserve(this.update)},f.prototype.componentDidUpdate=function(){var a=this.props.Form,c=a.SettingMaster.Model;if(c.ShuffleQuestionOrder&&!c.ShuffleAllQuestions&&(this.state.StartRange||(this.setState({StartRange:b.FormLimitation.DefaultQuestionStartOrder.toString()}),c.LockGivenQuestionsStartDisplayOrder=b.FormLimitation.DefaultQuestionStartOrder),!this.state.EndRange)){var d=a.FormElementManager.QuestionMasters.length;this.setState({EndRange:d.toString()}),c.LockGivenQuestionsEndDisplayOrder=d}},f.prototype.render=function(){var d=this.props;if("SendForm"===c.getUxStateMaster().Model.PreviousFlexPane)var e=React.DOM.div({id:"flex-pane-setting-headline",className:"flex-pane-content"},React.DOM.div(this.getClickableElementProp(void 0,void 0,function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Send.Navigate,extraData:{source:"FlexPane-Settings"}}),c.getUxStateMaster().Model.FlexPane="SendForm"}),a.Control.createFontIconControl({HTMLAttributes:{className:"settingPaneBack forms-icon-size16x16"},IconName:"Back"}),b.Resources.LocalizedStrings.DesignPage_SettingsPane_BackButton));var f=a.Flighting.Flight.isEnabled(a.Flighting.Flights.EnableNonAnonymousForMSA)||!OfficeFormServerInfo.userInfo.IsMsa,g=f?React.DOM.div({className:"flex-pane-content"},React.DOM.div({"aria-labelledby":"SettingsPane-Response",className:"setting-pane-group",role:"radiogroup"},React.DOM.div({className:"setting-group-title",id:"SettingsPane-Response"},b.Resources.LocalizedStrings.DesignPage_SettingsPane_Share_Title),this.createSetting_Anonymous(),this.createSetting_NonAnonymous())):void 0,h=this.shouldShowNotificationSection()&&React.DOM.div({"aria-labelledby":"SettingsPane-Notification",className:"setting-pane-group",role:"listbox"},React.DOM.div({className:"setting-group-title",id:"SettingsPane-Notification"},b.Resources.LocalizedStrings.DesignPage_SettingsPane_Notification),this.createSetting_EmailReceipt(),this.createSetting_EmailNotification()),i=React.DOM.div({className:"flex-pane-content"},React.DOM.div({"aria-labelledby":"SettingsPane-Options",className:"setting-pane-group",role:"listbox"},React.DOM.div({className:"setting-group-title",id:"SettingsPane-Options"},b.Resources.LocalizedStrings.DesignPage_SettingsPane_Response_Title),this.createSetting_CollectResponse(),this.createSetting_ApplyStartTime(),this.createSetting_ApplyDeadline(),this.createSetting_AllowResponderGetAllResponses(),this.createSetting_ShuffleQuestion(),!this.shouldShowNotificationSection()&&this.createSetting_EmailNotification(),this.createSetting_CustomizeThanYou(),d.Form.SettingMaster.Model.IsQuizMode?this.createSetting_ResponseInAppOnly():void 0),h),j=d.Form.SettingMaster.Model.IsQuizMode?React.DOM.div({className:"flex-pane-content"},React.DOM.div({className:"setting-pane-group"},React.DOM.div({className:"setting-group-title"},b.Resources.LocalizedStrings.DesignPage_SettingsPane_GradingSetting),this.createSetting_ManualGrading())):void 0;return React.DOM.div({id:"flex-pane-settings-pane"},e,React.DOM.div({className:"setting-page-title"},b.Resources.LocalizedStrings.DesignPage_SettingsPane_SettingLabel),j,g,i)},f.prototype.shouldShowNotificationSection=function(){return a.Flighting.Flight.isEnabled(a.Flighting.Flights.EmailReceipt)&&!a.EnvironmentConfig.isSovereignProd()&&!OfficeFormServerInfo.userInfo.IsMsa},f.prototype.createSetting_Anonymous=function(){if(a.EnvironmentConfig.isSovereignProd())return null;var d=this.props.Form.SettingMaster,e=d.Model;return this.createSettingCheckbox({Description:b.Resources.LocalizedStrings.SharePane_CollectResponse_DropDownOption1_Title,RadioCheckbox:!0,HTMLAttributes:{title:b.Resources.LocalizedStrings.DesignPage_SettingsPane_Share_Public_Help},Value:e.IsAnonymous&&!a.Utilities.isPhishingForm(this.props.Form.Model.OnlineSafetyLevel),onValueChange:function(){e.IsAnonymous||(a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Setting.AllowAnonymous,extraData:{Value:!0}}),d.bulkEdit(function(){e.IsAnonymous=!0,e.NotRecordIdentity=!0,e.RequiresUniqueResponse=!1}))},Id:"AnonymousButton",Disabled:!c.getUxStateMaster().Model.FormsTenantSettings.externalSendForm||a.Utilities.isPhishingForm(this.props.Form.Model.OnlineSafetyLevel)||this.props.Form.IsAssignmentForm})},f.prototype.createSetting_ManualGrading=function(){var c=this.props.Form;if(c.SettingMaster.Model.IsQuizMode){var e=b.Resources.LocalizedStrings.DesignPage_SettingsPane_AutoGradingControlTitle,f=c.SettingMaster.Model.ManualGradingEnabled?b.Resources.LocalizedStrings.DesignPage_SettingsPane_OpenManualGrading:b.Resources.LocalizedStrings.DesignPage_SettingsPane_OpenAutoGrading,g=function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Setting.AutoReleaseGrade}),c.SettingMaster.Model.ManualGradingEnabled=!b,c.SettingMaster.Model.ShowGradedResults=b};return d.createSettingsPaneToggleItem({Title:e,Description:f,Value:!c.SettingMaster.Model.ManualGradingEnabled,onChange:g.bind(this)})}return null},f.prototype.createSetting_RecordNamesOfResponders=function(){var c=this.props.Form.SettingMaster,d=c.Model;return null!=d.NotRecordIdentity||d.IsAnonymous||(d.NotRecordIdentity=!1),this.createSettingCheckbox({Disabled:this.props.Form.IsAssignmentForm||d.IsAnonymous||a.Utilities.isPhishingForm(this.props.Form.Model.OnlineSafetyLevel),Description:b.Resources.LocalizedStrings.DesignPage_SettingsPane_Share_RecordIdentityOfQuizVNext,Value:!d.NotRecordIdentity,onValueChange:function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Setting.RecordIdentity,extraData:{Value:!b}}),d.NotRecordIdentity=!b},Id:"RecordNamesOfResponders"})},f.prototype.createSetting_SingleReponsePerPerson=function(){var c=this.props.Form.SettingMaster.Model,d=this.props.Form.IsAssignmentForm||c.IsAnonymous||a.Utilities.isPhishingForm(this.props.Form.Model.OnlineSafetyLevel);return this.props.Form.IsAssignmentForm&&!c.IsAnonymous&&(c.RequiresUniqueResponse=!0),this.createSettingCheckbox({Disabled:d,Description:b.Resources.LocalizedStrings.DesignPage_SettingsPane_Share_OneResponse,Value:c.RequiresUniqueResponse,onValueChange:function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Setting.RequireUniqueResponse,extraData:{Value:b}}),c.RequiresUniqueResponse=b},Id:"SingleReponsePerPerson"})},f.prototype.createSetting_NonAnonymous=function(c){void 0===c&&(c=!1);var d=this.props.Form.SettingMaster,e=d.Model;return this.createSettingCheckbox({Disabled:this.props.Form.IsAssignmentForm,Description:b.Resources.LocalizedStrings.SharePane_CollectResponse_DropDownOption2_Title,RadioCheckbox:!0,Value:!e.IsAnonymous||a.Utilities.isPhishingForm(this.props.Form.Model.OnlineSafetyLevel),onValueChange:function(){e.IsAnonymous&&(a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Setting.AllowAnonymous,extraData:{Value:!1}}),d.bulkEdit(function(){e.IsAnonymous=!1,e.NotRecordIdentity=!1}))},Id:"Non-AnonymousButton",children:React.DOM.div({"aria-labelledby":"Non-AnonymousButton",role:"radiogroup"},this.createSetting_RecordNamesOfResponders(),c?void 0:this.createSetting_SingleReponsePerPerson())})},f.prototype.createSetting_CollectResponse=function(){var c=this.props.Form.SettingMaster,d=c.Model;return this.createSettingCheckbox({Description:b.Resources.LocalizedStrings.DesignPage_SettingsPane_AcceptResponse,Value:!d.FormClosed,onValueChange:function(b){a.Event.EngagementEventDeprecated.logData({
name:a.Event.EngagementEventNames.DesignPage.Setting.AcceptResponse,extraData:{Value:b}}),d.FormClosed=!b},children:[d.FormClosed?React.DOM.div({className:"flex-pane-inner-text"},a.Control.createFontIconControl({HTMLAttributes:{className:"flex-pane-alert-icon"},IconName:"AlertSolid"}),React.DOM.span({className:"flex-pane-alert-text"},b.Resources.LocalizedStrings.DesignPage_SettingsPane_FormClosed_Warning)):void 0,d.FormClosed?a.Control.createTextField({Label:b.Resources.LocalizedStrings.DesignPage_SettingsPane_FormClosed_Label,Options:{HTMLPropsForInnerElement:{className:"flex-pane-inner-text"}},TextFieldType:a.Control.TextFieldType.AutoHeightMultiline,MinimalHeight:100,HTMLAttributes:{className:"form-setting-inner-board",onBlur:function(){d.FormClosedMessageChanged&&(a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Setting.EditCloseMessage}),d.FormClosedMessageChanged=!1)}},Value:c.getFormClosedMessage(),onValueChange:function(a){d.FormClosedMessage=a,d.FormClosedMessageChanged=!0}}):void 0]})},f.prototype.createSetting_ApplyStartTime=function(){var c=this.props.Form.SettingMaster,d=c.Model;return this.createSettingCheckbox({Description:b.Resources.LocalizedStrings.DesignPage_SettingsPane_StartTime,Disabled:d.FormClosed||this.props.Form.IsAssignmentForm&&a.Flighting.Flight.isEnabled(a.Flighting.Flights.IsStartTimeEndTimeManaged),Value:d.TimerEnabledStart,onValueChange:function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Setting.ApplyStartTime,extraData:{Value:b}}),c.bulkEdit(function(){if(b){var a=new Date(Date.now());a.setHours(a.getHours()+1,0,0,0),d.StartTime=a.toJSON()}else d.StartTime=void 0;d.TimerEnabledStart=b,d.TimerEnabled=!(!d.TimerEnabledStart&&!d.TimerEnabledEnd)})},children:[!d.FormClosed&&d.TimerEnabledStart?React.DOM.div({},a.Control.createDateTimePicker({Disabled:d.FormClosed||this.props.Form.IsAssignmentForm&&a.Flighting.Flight.isEnabled(a.Flighting.Flights.IsStartTimeEndTimeManaged),Options:{classNameForInnerDiv:"form-setting-inner-board"},Value:d.StartTime,onValueChange:function(b){if(a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Setting.SetStartTime,extraData:{DateTime:b}}),d.TimerEnabledEnd&&b>=d.EndTime){var c=new Date(b);c.setHours(new Date(b).getHours()+1,0,0,0),d.EndTime=c.toJSON()}d.StartTime=b,$("#flex-pane-status-start-date").hide(),$("#flex-pane-status-start-time").hide()},onValueValidation:function(a,b){var c=b?"#flex-pane-status-start-date":"#flex-pane-status-start-time";a?$(c).hide():$(c).show()},children:[React.DOM.div({className:"flex-pane-status flex-pane-status-error",id:"flex-pane-status-start-date",style:{display:"none"}},b.Resources.LocalizedStrings.DateValidation_ErrorMessage.format(OfficeFormServerInfo.cultureInfo.DateTimeFormat.ShortDatePattern)),React.DOM.div({className:"flex-pane-status flex-pane-status-error",id:"flex-pane-status-start-time",style:{display:"none"}},b.Resources.LocalizedStrings.TimeValidation_ErrorMessage.format(OfficeFormServerInfo.cultureInfo.DateTimeFormat.ShortTimePattern))],DateTitle:b.Resources.LocalizedStrings.DesignPage_SettingsPane_DatePicker_StartDateTitle,TimeTitle:b.Resources.LocalizedStrings.DesignPage_SettingsPane_DatePicker_StartTimeTitle})):void 0]})},f.prototype.createSetting_ApplyDeadline=function(){var c=this.props.Form.SettingMaster,d=c.Model;return null==d.TimerEnabledStart&&null==d.TimerEnabledEnd&&(d.TimerEnabledEnd=d.TimerEnabled),this.createSettingCheckbox({Description:b.Resources.LocalizedStrings.DesignPage_SettingsPane_Deadline,Disabled:d.FormClosed||this.props.Form.IsAssignmentForm&&a.Flighting.Flight.isEnabled(a.Flighting.Flights.IsStartTimeEndTimeManaged),Value:d.TimerEnabledEnd,onValueChange:function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Setting.ApplyDeadline,extraData:{Value:b}}),c.bulkEdit(function(){if(b)if(d.TimerEnabledStart){var a=new Date(d.StartTime);a.setHours(new Date(d.StartTime).getHours()+1,0,0,0),d.EndTime=a.toJSON()}else{var c=new Date(Date.now());c.setHours(c.getHours(),0,0,0),d.StartTime=c.toJSON();var a=new Date(Date.now());a.setDate(a.getDate()),a.setHours(a.getHours()+1,0,0,0),d.EndTime=a.toJSON()}else d.EndTime=void 0;d.TimerEnabledEnd=b,d.TimerEnabled=d.TimerEnabledStart||d.TimerEnabledEnd})},children:[!d.FormClosed&&d.TimerEnabledEnd?React.DOM.div({},a.Control.createDateTimePicker({AllowedDateTime:{Start:d.StartTime?new Date(d.StartTime):new Date(Date.now())},Disabled:d.FormClosed||this.props.Form.IsAssignmentForm&&a.Flighting.Flight.isEnabled(a.Flighting.Flights.IsStartTimeEndTimeManaged),Options:{classNameForInnerDiv:"form-setting-inner-board"},Value:d.EndTime,onValueChange:function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Setting.SetDeadline,extraData:{DateTime:b}}),b>d.StartTime&&(d.EndTime=b),$("#flex-pane-status-end-date").hide(),$("#flex-pane-status-end-time").hide()},onValueInvalid:function(a){a?$("#flex-pane-status-end-date").show():$("#flex-pane-status-end-time").show()},children:[React.DOM.div({className:"flex-pane-status flex-pane-status-error",id:"flex-pane-status-end-date",style:{display:"none"}},b.Resources.LocalizedStrings.DateValidation_ErrorMessage.format(OfficeFormServerInfo.cultureInfo.DateTimeFormat.ShortDatePattern)),React.DOM.div({className:"flex-pane-status flex-pane-status-error",id:"flex-pane-status-end-time",style:{display:"none"}},b.Resources.LocalizedStrings.TimeValidation_ErrorMessage.format(OfficeFormServerInfo.cultureInfo.DateTimeFormat.ShortTimePattern))],DateTitle:b.Resources.LocalizedStrings.DesignPage_SettingsPane_DatePicker_EndDateTitle,TimeTitle:b.Resources.LocalizedStrings.DesignPage_SettingsPane_DatePicker_EndTimeTitle})):void 0]})},f.prototype.createSetting_QuizResult=function(c){var d=this.props.Form,e=d.SettingMaster.Model;return null==e.ShowGradedResults&&(e.ShowGradedResults=!e.ManualGradingEnabled),this.createSettingCheckbox({Disabled:c,Description:b.Resources.LocalizedStrings.DesignPage_SettingsPane_QuizResult,Value:e.ShowGradedResults,onValueChange:function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Setting.ShowGradedResults,extraData:{Value:b}}),e.ShowGradedResults=b}})},f.prototype.createSetting_QuizScore=function(c){var d=this.props.Form,e=d.SettingMaster.Model;return null==e.ShowGradedScores&&(e.ShowGradedScores=!0),this.createSettingCheckbox({Disabled:c,Description:b.Resources.LocalizedStrings.DesignPage_SettingsPane_QuizScore,Value:e.ShowGradedScores,onValueChange:function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Setting.ShowGradedScores,extraData:{Value:b}}),e.ShowGradedScores=b}})},f.prototype.createSetting_ShuffleQuestion=function(){var c=this.props.Form,d=c.SettingMaster.Model,e=b.Resources.LocalizedStrings.DesignPage_SettingsPane_ShuffleQuestion;return this.createSettingCheckbox({Description:e,Value:this.shouldShuffleEnabled(),Disabled:c.Model.HasValidBranching||c.hasSection(),onValueChange:function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Setting.ShuffleQuestion,extraData:{Value:b}}),c.SettingMaster.bulkEdit(function(){d.ShuffleQuestionOrder=b,b&&null==d.ShuffleAllQuestions&&(d.ShuffleAllQuestions=!0)})},children:React.DOM.div({"aria-label":e,role:"radiogroup"},this.createShuffleAllQuestions(),this.createBlockGivenQuestions(),this.createBlockGivenQuestionsRange())})},f.prototype.createSetting_AllowResponderGetAllResponses=function(){var a=this.props.Form;if(b.CategoryExtensionPoints.supportsExtensionPoint(a,b.ExtensionPoints.SettingsAllowResponderGetAllResponses)){var c=a.SettingMaster.Model;return this.createSettingCheckbox({Description:"Allow responder get all responses",Value:c.AllowResponderGetAllResponses,onValueChange:function(a){c.AllowResponderGetAllResponses=a}})}},f.prototype.createShuffleAllQuestions=function(){var c=this.props.Form,d=c.SettingMaster.Model;return this.shouldShuffleEnabled()?this.createSettingCheckbox({Description:b.Resources.LocalizedStrings.DesignPage_SettingsPane_ShuffleAllQuestions,RadioCheckbox:!0,Value:d.ShuffleAllQuestions,Disabled:c.Model.HasValidBranching,onValueChange:function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Setting.ShuffleAllQuestions,extraData:{Value:b}}),d.ShuffleAllQuestions=b}}):void 0},f.prototype.createSetting_EmailNotification=function(){if(a.EnvironmentConfig.isSovereignProd())return void 0;var c=this.props.Form,d=c.SettingMaster.Model,e=a.Flighting.Flight.isEnabled(a.Flighting.Flights.EmailReceipt)?b.Resources.LocalizedStrings.DesignPage_SettingsPane_Notification_EmailNotification:b.Resources.LocalizedStrings.DesignPage_SettingsPane_EmailNotification;return this.createSettingCheckbox({Description:e,Value:d.EmailNotification,onValueChange:function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Setting.EmailNotification,extraData:{Value:b}}),d.EmailNotification=b}})},f.prototype.createSetting_EmailReceipt=function(){if(!a.Flighting.Flight.isEnabled(a.Flighting.Flights.EmailReceipt)||a.EnvironmentConfig.isSovereignProd()||OfficeFormServerInfo.userInfo.IsMsa)return void 0;var c=this.props.Form.SettingMaster.Model,d=this.props.Form.Model,e=c.IsAnonymous||c.NotRecordIdentity;return this.createSettingCheckbox({HelpText:e?b.Resources.LocalizedStrings.DesignPage_SettingsPane_EmailReceipt_DisabledTooltip:b.Resources.LocalizedStrings.DesignPage_SettingsPane_EmailReceipt_EnabledTooltip,Disabled:e,Description:b.Resources.LocalizedStrings.DesignPage_SettingsPane_Notification_EmailReceipt,Value:!e&&d.EmailReceiptEnabled,onValueChange:function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Setting.EmailReceipt,extraData:{Value:b}}),d.EmailReceiptEnabled=b}})},f.prototype.createSetting_CustomizeThanYou=function(){var c=this.props.Form.Model;return this.createSettingCheckbox({Description:b.Resources.LocalizedStrings.DesignPage_SettingsPane_CustomizeThankYou,Options:{classNameForInnerDiv:"flex-pane-checkbox-info flex-pane-checkbox-thank-you-message",classNameForInnerLabel:"flex-pane-checkbox-label"},Value:null!=c.ThankYouMessage,onValueChange:function(a){a?c.ThankYouMessage=b.Resources.LocalizedStrings.Renderer_SubmissionSucceeded:c.ThankYouMessage=null},children:[null!=c.ThankYouMessage&&a.Control.createTextField({AutoSelection:!0,Options:{HTMLPropsForInnerElement:{className:"flex-pane-inner-text"}},Placeholder:b.Resources.LocalizedStrings.DesignPage_SettingsPane_ThankYouMessage_Placeholder,TextFieldType:a.Control.TextFieldType.AutoHeightMultiline,MinimalHeight:80,MaxLength:b.FormLimitation.CustomizedThankYouMessageMaxLength,HTMLAttributes:{className:"form-setting-inner-board","aria-label":b.Resources.LocalizedStrings.DesignPage_SettingsPane_CustomizeThankYou,onBlur:function(){null!=c.ThankYouMessage&&a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Setting.ThankYouMessage,extraData:{length:c.ThankYouMessage.length}})}},Value:c.ThankYouMessage,onValueChange:function(a){c.ThankYouMessage=a||""}})]})},f.prototype.createBlockGivenQuestions=function(){var c=this.props.Form,d=c.SettingMaster.Model;return this.shouldShuffleEnabled()?this.createSettingCheckbox({Description:b.Resources.LocalizedStrings.DesignPage_SettingsPane_LockGivenQuestions,RadioCheckbox:!0,Value:!d.ShuffleAllQuestions,Disabled:c.Model.HasValidBranching,onValueChange:function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Setting.LockGivenQuestions,extraData:{Value:b}}),d.ShuffleAllQuestions=!b}}):void 0},f.prototype.createBlockGivenQuestionsRange=function(){var c=this,d=this.state,e=this.props.Form,f=e.SettingMaster.Model;if(this.shouldShuffleEnabled()&&!f.ShuffleAllQuestions){var g=Number(d.StartRange),h=Number(d.EndRange),i=a.Control.createTextField({HTMLAttributes:{className:"flex-pane-setting-shuffle-input",onBlur:function(){a.Utilities.NumberValidation.isInteger(g)&&g>=1&&g<=e.FormElementManager.QuestionMasters.length&&h>=g?(f.LockGivenQuestionsStartDisplayOrder=g,c.setState({ShowShuffleQuestionRangeError:!1})):c.setState({ShowShuffleQuestionRangeError:!0})}},TextFieldType:a.Control.TextFieldType.SingleLine,AutoSelection:!0,Value:d.StartRange,onValueChange:function(a){c.setState({StartRange:a})}}),j=a.Control.createFontIconControl({HTMLAttributes:{className:"flex-pane-setting-shuffle-seperator"},IconName:"CalculatorSubtract"}),k=a.Control.createTextField({HTMLAttributes:{className:"flex-pane-setting-shuffle-input",onBlur:function(){a.Utilities.NumberValidation.isInteger(h)&&h>=1&&h<=e.FormElementManager.QuestionMasters.length&&h>=g?(f.LockGivenQuestionsEndDisplayOrder=h,c.setState({ShowShuffleQuestionRangeError:!1})):c.setState({ShowShuffleQuestionRangeError:!0})}},TextFieldType:a.Control.TextFieldType.SingleLine,AutoSelection:!0,Value:d.EndRange,onValueChange:function(a){c.setState({EndRange:a})}}),l=void 0;return d.ShowShuffleQuestionRangeError&&(l=React.DOM.span({className:"flex-pane-shuffle-status flex-pane-status-error"},b.Resources.LocalizedStrings.ShuffleQuestionValidation_ErrorMessage)),React.DOM.div({className:"flex-pane-setting-shuffle-div office-form-theme-focus-border"},i,j,k,l)}},f.prototype.createSetting_ResponseInAppOnly=function(){if(a.Flighting.Flight.isEnabled(a.Flighting.Flights.ResponseInApp)){var c=this.props.Form,d=c.SettingMaster.Model;return this.createSettingCheckbox({Description:b.Resources.LocalizedStrings.DesignPage_SettingsPane_ResponseInTakeATest,Value:d.RespondInAppOnly,onValueChange:function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Setting.RespondInAppOnly,extraData:{Value:b}}),d.RespondInAppOnly=b}})}},f.prototype.createSettingCheckbox=function(c){c.HTMLAttributes=c.HTMLAttributes||{},c.HTMLAttributes.className=c.HTMLAttributes.className||"setting-pane-checkbox",c.Options=c.Options||{classNameForInnerDiv:"flex-pane-checkbox-info",classNameForInnerLabel:"flex-pane-checkbox-label"};var d=this.props.Form;return b.CategoryExtensionPoints.supportsExtensionPoint(d,b.ExtensionPoints.DisableEditForm)&&(c.Disabled=!0),a.Control.createCheckBox(c)},f.prototype.getClickableElementProp=function(a,b,c){var d=this;return{id:a,role:"button",className:b,onClick:c,onKeyDown:function(a){return d.handleBtnKeyDown(a,c)},tabIndex:0}},f.prototype.handleBtnKeyDown=function(b,c){b=b||window.event,(b.keyCode===a.KeyCode.Space||b.keyCode===a.KeyCode.Enter)&&c(b)},f.prototype.shouldShuffleEnabled=function(){var a=this.props.Form,b=a.SettingMaster.Model;return b.ShuffleQuestionOrder&&!a.hasSection()},f}(a.ReactComponent)}(d=c.FlexPane||(c.FlexPane={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(c){var d;!function(a){a[a.ShareAsTemplate=0]="ShareAsTemplate",a[a.Collaboration=1]="Collaboration",a[a.AnalysisResult=2]="AnalysisResult"}(d=c.FormSharingType||(c.FormSharingType={}));var e=function(c){function e(){var a=null!==c&&c.apply(this,arguments)||this;return a.needUpdateFocus=!1,a.nextActiveElement="",a.isComponentMounted=!0,a.confrimDeleteNoticeMessageContainerlId=_.uniqueId("confirm-delete-message-container"),a}return __extends(e,c),e.prototype.componentDidUpdate=function(){if(this.needUpdateFocus){var a=ReactDOM.findDOMNode(this.refs[this.nextActiveElement]);a&&(a.focus(),this.nextActiveElement=="flex-pane-share-"+this.shareType+"-textbox-link"&&a.select(),this.nextActiveElement=void 0),this.needUpdateFocus=!1}},e.prototype.componentWillUnmount=function(){this.isComponentMounted=!1},e.prototype.render=function(){if(b.CategoryExtensionPoints.supportsExtensionPoint(this.props.Form,b.ExtensionPoints.DisableEditForm))return null;this.shareType=d[this.props.ShareOption];var a=this.state.AllowCopy&&this.state.Token;return React.createElement("div",{className:"flex-pane-option-container-share"},React.createElement("div",{className:"flex-pane-content-container-title",key:"containerTitle"},b.Resources.LocalizedStrings["SharePane_"+this.shareType+"_Link_Title"]),a&&this.createShareContainer(),!a&&this.createShareLink())},Object.defineProperty(e.prototype,"Mounted",{get:function(){return this.isComponentMounted},enumerable:!0,configurable:!0}),e.prototype.setStateSafely=function(a){this.Mounted&&this.setState(a)},e.prototype.createTitle=function(){return React.createElement("div",{className:"flex-pane-share-content-title"},b.Resources.LocalizedStrings["SharePane_"+d[this.props.ShareOption]+"_Title"])},e.prototype.disabledCollaboration=function(){return!1},e.prototype.switchingPermission=function(){return!1},e.prototype.showErrorStatus=function(a,b){var c=ReactDOM.findDOMNode(this.refs[b]);c.textContent=a},e.prototype.createShareContainer=function(){var a=this.state.ShowConfirmDelete;return React.createElement("div",{className:"flex-pane-dark-container",key:"shareContainer"},a&&this.createDeleteShareContent(),!a&&this.createShareContent(),this.createErrorBox())},e.prototype.createShareLink=function(){var c=this,d=this.state.ShowSpinner,e=b.Resources.LocalizedStrings["SharePane_"+this.shareType+"_Tooltip"],f=a.Control.createGlyphButton({HTMLAttributes:{className:"flex-pane-sharelink-button",id:"flex-pane-get-"+this.shareType+"-link-button",title:e,onClick:function(){c.setState({ShowSpinner:!0}),c.createLink(),c.nextActiveElement="flex-pane-share-"+c.shareType+"-textbox-link"}},Icon:"Add",IconClassName:"share-link-plus-icon forms-icon-size16x16",ButtonStyle:a.Control.ButtonStyle.LightBackground,GlyphButtonStyle:a.Control.GlyphButtonStyle.Horizontal,Text:b.Resources.LocalizedStrings["SharePane_"+this.shareType+"_GetLink"],TextClassName:"flex-pane-share-link-text",key:"create"+this.shareType+"Link",ref:"flex-pane-get-"+this.shareType+"-link-button"});return React.createElement("div",{className:"flex-pane-sharelink-container"},f,d&&this.createSpinner(!1),this.createErrorBox())},e.prototype.createShareContent=function(){var a={className:"flex-pane-share-content-copy"},c=React.createElement("div",{className:"flex-pane-share-form-spinner-container"},this.createSpinner(!0)),d=React.createElement("div",{className:"flex-pane-status flex-pane-status-error",key:"collabError"},b.Resources.LocalizedStrings.DesignPage_SharePane_CollabDisabled_AdminSettings);return React.createElement("div",{className:"flex-pane-share-form-content-container"},this.createTitle(),React.createElement("div",{className:"flex-pane-share-form-content-body"},React.createElement("div",__assign({},a),this.createShareLinkText(),this.createCopyButton(),this.disabledCollaboration()&&d,this.createCopyStatus()),this.createDeleteLinkButton()),this.state.ShowSpinner&&c)},e.prototype.createShareLinkText=function(){var a=this,c={disabled:this.switchingPermission(),readOnly:!0,value:this.getShareContentUrl(),className:"flex-pane-textbox",id:"flex-pane-share-"+this.shareType+"-textbox-link",ref:"flex-pane-share-"+this.shareType+"-textbox-link",onClick:function(){var b=$("#flex-pane-share-"+a.shareType+"-textbox-link");b.focus(),b.select()}};return this.shareType===d[d.Collaboration]?c["aria-label"]=b.Resources.LocalizedStrings.Link_Sharing_Collaborate:c["aria-label"]=b.Resources.LocalizedStrings.Link_Sharing_Template,React.createElement("input",__assign({},c))},e.prototype.createCopyButton=function(){var c=this,d={disabled:this.switchingPermission(),type:"button",className:"flex-pane-button",id:"flex-pane-share-"+this.shareType+"-link",title:b.Resources.LocalizedStrings.SharePane_ShareOption_CopyButton,onClick:function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Share["Copy"+c.shareType+"Link"]})}};return d["data-clipboard-target"]="#flex-pane-share-"+this.shareType+"-textbox-link",React.createElement("button",__assign({},d),b.Resources.LocalizedStrings.SharePane_Link_CopyButton)},e.prototype.createCopyStatus=function(){var a={className:"flex-pane-status",id:"flex-pane-share-"+this.shareType+"-status-link",role:"alert"};return React.createElement("div",__assign({},a))},e.prototype.createDeleteLinkButton=function(){var c=this;return a.Control.createGlyphButton({HTMLAttributes:{className:"flex-pane-share-content-delete-button",id:"flex-pane-"+this.shareType+"-delete-button",disabled:this.switchingPermission(),onClick:function(){c.setState({ShowConfirmDelete:!0}),c.nextActiveElement=c.shareType+"cancelButton",c.needUpdateFocus=!0}},Icon:"Delete",IconClassName:"flex-pane-delete-icon forms-icon-size18x18",ButtonStyle:a.Control.ButtonStyle.LightBackground,GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly,Text:b.Resources.LocalizedStrings.SharePane_ShareOption_DeleteButton,key:"deleteShareLink",ref:"flex-pane-"+this.shareType+"-delete-button"})},e.prototype.createDeleteShareContent=function(){var c=this,d=a.Control.createTextButton({HTMLAttributes:{className:"flex-pane-confirm-delete-option",id:this.shareType+"cancelButton",onClick:function(){c.setState({ShowConfirmDelete:!1}),c.nextActiveElement="flex-pane-"+c.shareType+"-delete-button",c.needUpdateFocus=!0}},ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.SharePane_ShareOption_DeleteDialog_Cancel,key:"cancelButton",ref:this.shareType+"cancelButton"}),e=a.Control.createTextButton({HTMLAttributes:{className:"flex-pane-confirm-delete-option",id:"deleteButton",onClick:function(){c.setState({ShowSpinner:!0,ShowConfirmDelete:!1}),c.deleteLink(),c.nextActiveElement="flex-pane-get-"+c.shareType+"-link-button"},"aria-describedby":this.confrimDeleteNoticeMessageContainerlId},ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.SharePane_ShareOption_DeleteDialog_Delete,key:"deleteButton"}),f={className:"flex-pane-confirm-delete-container",ref:"confirmDeleteContainer",onBlur:function(a){return c.onBlurDeleteContent(a)},tabIndex:-1};return React.createElement("div",__assign({},f),React.createElement("div",{className:"flex-pane-confirm-delete-title",id:this.confrimDeleteNoticeMessageContainerlId},b.Resources.LocalizedStrings.SharePane_ShareOption_DeleteDialog_Message),React.createElement("div",{className:"flex-pane-confirm-delete-button-container"},d,e))},e.prototype.onBlurDeleteContent=function(b){var c=a.Utilities.Html.getTargetElementOfFocusEvent(b),d=ReactDOM.findDOMNode(this.refs.confirmDeleteContainer);d.contains(c)||this.setState({ShowConfirmDelete:!1})},e.prototype.createSpinner=function(a){var b=a?"flex-pane-delete-share-link-spinner":"flex-pane-share-form-spinner";return React.createElement("div",{className:b},React.createElement("div",{className:"spinner-tile-animation"}))},e.prototype.createErrorBox=function(){var a="flex-pane-"+d[this.props.ShareOption]+"-status";return this.state.ShowError?React.createElement("div",{className:"flex-pane-share-error-box",ref:a}):void 0},e}(a.ReactComponent);c.ShareItemsBase=e}(d=c.FlexPane||(c.FlexPane={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(c){function d(a){return React.createElement(e,__assign({},a))}c.createAnalysisResult=d;var e=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.componentWillMount=function(){var a=this;this.setState({AllowCopy:this.props.Form.Model.PermissionTokens.length>0}),b.Model.PermissionTokenMaster.getShareResultPermissionToken(this.props.Form).done(function(b){a.setStateSafely({Token:b})})},d.prototype.createLink=function(){this.addShareResultPermission(b.Model.PermissionTokenType.AnalyzerToken,b.FormLimitation.AnalysisTokenName)},d.prototype.deleteLink=function(){this.deleteShareResultPermission()},d.prototype.getShareContentUrl=function(){var b=this.props.Form.Model.Id,c=this.state.Token,d={id:b,AnalyzerToken:c},e="../Pages/AnalysisPage.aspx?"+jQuery.param(d);return a.Utilities.Html.getAbsoluteUrl(e)},d.prototype.addShareResultPermission=function(c,d){var e=this;b.Model.PermissionTokenMaster.appendPermissionToken(this.props.Form,c,d).done(function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Share.CreateAnalysisResulttLink}),e.needUpdateFocus=!0,e.setStateSafely({ShowSpinner:!1,AllowCopy:!0,Token:b,ShowError:!1})}).fail(function(a){e.setStateSafely({ShowSpinner:!1,AllowCopy:!1,ShowError:!0,Token:null});var c=b.Resources.LocalizedStrings["Error_Message_"+a.innerCode]||b.Resources.LocalizedStrings.Error_Page_DefaultErrorTitle;e.showErrorStatus(c,"flex-pane-AnalysisResult-status")})},d.prototype.deleteShareResultPermission=function(){var c=this,d=this.props.Form,e=b.Model.PermissionTokenMaster.getShareResultPermissions(d);b.Model.PermissionTokenMaster.removePermissionToken(d,e).done(function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Share.DeleteAnalysisResultLink}),c.needUpdateFocus=!0,c.setStateSafely({ShowSpinner:!1,AllowCopy:!1,Token:null,ShowError:!1})}).fail(function(d){if(d.innerCode===a.DataProvider.ErrorCode.InnerCode.DeleteNotExistPermission)c.setStateSafely({ShowSpinner:!1,AllowCopy:!1,Token:null});else{c.setStateSafely({ShowSpinner:!1,AllowCopy:!0,ShowError:!0});var e=b.Resources.LocalizedStrings["Error_Message_"+d.innerCode];c.showErrorStatus(e,"flex-pane-AnalysisResult-status")}})},d}(c.ShareItemsBase)}(d=c.FlexPane||(c.FlexPane={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(d){function e(a){return React.createElement(f,__assign({},a))}d.createCollaborate=e;var f=function(d){function e(){var a=null!==d&&d.apply(this,arguments)||this;return a.selectControlRef=React.createRef(),a}return __extends(e,d),e.prototype.componentWillMount=function(){var a=this;this.setExternalCollaboration=this.setExternalCollaboration.bind(this),c.getUxStateMaster().observe(function(){return a.setExternalCollaboration},[c.UxStateFields.FormsTenantSettings]),this.setState({AllowCopy:this.props.Form.Model.Permissions.length>0,CollaborateOptionValue:this.getCollaborationOptionValue(),EnableExternalCollaboration:this.getExternalCollaboration(),ShowCollaborationDropDownSpinner:!1,IsChangingCollaborateOption:!1}),this.props.Form.getPermissionToken().done(function(b){a.setStateSafely({Token:b})})},e.prototype.componentWillUnmount=function(){c.getUxStateMaster().unobserve(this.setExternalCollaboration),d.prototype.componentWillUnmount.call(this)},e.prototype.createLink=function(){this.addCoOwnerPermission()},e.prototype.deleteLink=function(){this.deleteCoOwnerPermission()},e.prototype.createTitle=function(){return a.EnvironmentConfig.isSovereignProd()?this.createCollaboration():this.createCollaborationDropDown()},e.prototype.getShareContentUrl=function(){var b=this.props.Form.Model.Id,c=this.state.Token,d={fragment:"FormId="+b+"&Token="+c},e="../Pages/DesignPage.aspx?"+jQuery.param(d);return a.Utilities.Html.getAbsoluteUrl(e)},e.prototype.setStateSafely=function(a,b){this.Mounted&&this.setState(a,b)},e.prototype.disabledCollaboration=function(){var a=this.state;return!a.EnableExternalCollaboration&&this.getPermissionType()===b.Model.PermissionType.Link},e.prototype.switchingPermission=function(){return this.state.IsChangingCollaborateOption},e.prototype.setExternalCollaboration=function(){this.setState({CollaborateOptionValue:this.getCollaborationOptionValue(),EnableExternalCollaboration:this.getExternalCollaboration()})},e.prototype.getExternalCollaboration=function(){var a=c.getUxStateMaster().Model.FormsTenantSettings;return null==a||a.externalShareCollaboration},e.prototype.createCollaboration=function(){return a.EnvironmentConfig.isSovereignProd()&&React.createElement("div",{className:"flex-pane-share-content-title"},b.Resources.LocalizedStrings.SharePane_Collaboration_TitleSameTenant)},e.prototype.createCollaborationDropDown=function(){var d=this,e=(this.state.CollaborateOptionValue,function(a){d.getCollaborationOptionValue()!==a&&(a===b.Resources.LocalizedStrings.SharePane_Collaboration_TitleSameTenant?d.updateCoOwnerPermission(a):c.DataProviderAdapter.getFormsTenantSettings().done(function(){d.updateCoOwnerPermission(a)}))}),f=React.createElement("span",{className:"share-to-collaborate-content",title:b.Resources.LocalizedStrings.SharePane_Collaboration_TitleCrossTenant},b.Resources.LocalizedStrings.SharePane_Collaboration_TitleCrossTenant,React.createElement("span",{className:"flex-pane-dropdown-option-alert",title:""},React.createElement(a.Control.FontIconControl,{IconName:"AlertSolid"}),React.createElement("span",{className:"flex-pane-dropdown-option-alert-message"},b.Resources.LocalizedStrings.DesignPage_SharePane_CollabDisabled_AdminSettings_AlertMessage))),g=[{DisplayName:b.Resources.LocalizedStrings.SharePane_Collaboration_TitleCrossTenant,Value:b.Resources.LocalizedStrings.SharePane_Collaboration_TitleCrossTenant,Key:"CrossTenant",DisplayContent:f,Disabled:this.disableCrossTenantCollaboration()}],h=b.Resources.LocalizedStrings.SharePane_Collaboration_TitleSameTenant,i=b.Resources.LocalizedStrings.SharePane_Collaboration_TitleSameTenant,j=React.createElement("span",{className:"share-to-collaborate-content",title:i},h);g.push({DisplayName:h,Value:h,Key:"SameTenant",DisplayContent:j});var k=React.createElement(a.Control.Select,{SelectOptions:g,Value:this.state.CollaborateOptionValue,onValueChange:e,ref:this.selectControlRef}),l=React.createElement("div",{className:"flex-pane-collaborate-dropdown-spinner-container"},React.createElement("div",{className:"flex-pane-collaborate-dropdown-spinner-content"},React.createElement("div",{className:"spinner-tile-animation"})));return React.createElement("div",{className:"flex-pane-option-dropdown-element"},k,React.createElement("div",{className:"flex-pane-status",id:"flex-pane-change-collaborate-tenant-status",role:"alert"}),this.state.ShowCollaborationDropDownSpinner&&l)},e.prototype.getPermissionType=function(){for(var a,c=this.props.Form.Model.Permissions,d=0;d<c.length;d++)if("Read, Write, Share"===c[d].PermissionSet&&(c[d].Type===b.Model.PermissionType.Link||c[d].Type===b.Model.PermissionType.OrgLink)){a=c[d].Type;break}return a},e.prototype.getCollaborationOptionValue=function(){var a,c=this.getPermissionType();return this.disableCrossTenantCollaboration()?a=b.Resources.LocalizedStrings.SharePane_Collaboration_TitleSameTenant:c&&(a=c===b.Model.PermissionType.Link?b.Resources.LocalizedStrings.SharePane_Collaboration_TitleCrossTenant:b.Resources.LocalizedStrings.SharePane_Collaboration_TitleSameTenant),a},e.prototype.disableCrossTenantCollaboration=function(){return!this.getExternalCollaboration()||a.Utilities.isPhishingForm(this.props.Form.Model.OnlineSafetyLevel)},e.prototype.addCoOwnerPermission=function(){var d=this;c.DataProviderAdapter.getFormsTenantSettings().done(function(){var c=d.state.EnableExternalCollaboration?b.Model.PermissionType.Link:b.Model.PermissionType.OrgLink;a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Share.CreateCollaborationLink,extraData:{linkType:c}}),d.props.Form.appendPermission(c).done(function(a){d.needUpdateFocus=!1,d.setStateSafely({ShowSpinner:!1,AllowCopy:!0,Token:a,ShowError:!1,CollaborateOptionValue:c===b.Model.PermissionType.Link?b.Resources.LocalizedStrings.SharePane_Collaboration_TitleCrossTenant:b.Resources.LocalizedStrings.SharePane_Collaboration_TitleSameTenant},function(){var a=d.selectControlRef.current;a&&a.focus()})}).fail(function(a){d.setStateSafely({ShowSpinner:!1,AllowCopy:!1,ShowError:!0,Token:null});var c=b.Resources.LocalizedStrings["Error_Message_"+a.innerCode]||b.Resources.LocalizedStrings.Error_Page_DefaultErrorTitle;d.showErrorStatus(c,"flex-pane-Collaboration-status");
})})},e.prototype.deleteCoOwnerPermission=function(){var c=this;this.props.Form.removeLinkPermission().done(function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Share.DeleteCollaborationLink,extraData:{linkType:c.getPermissionType()}}),c.needUpdateFocus=!0,c.setStateSafely({ShowSpinner:!1,Token:null,CollaborateOptionValue:null})}).fail(function(d){if(d.innerCode===a.DataProvider.ErrorCode.InnerCode.DeleteNotExistPermission)c.setStateSafely({ShowSpinner:!1,Token:null,ShowError:!1});else{c.setStateSafely({ShowSpinner:!1,ShowError:!0});var e=b.Resources.LocalizedStrings["Error_Message_"+d.innerCode];c.showErrorStatus(e,"flex-pane-Collaboration-status")}})},e.prototype.updateCoOwnerPermission=function(c){var d=this;this.setState({ShowCollaborationDropDownSpinner:!0,IsChangingCollaborateOption:!0});var e=c===b.Resources.LocalizedStrings.SharePane_Collaboration_TitleSameTenant?b.Model.PermissionType.OrgLink:b.Model.PermissionType.Link;a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Share.SwitchCollaborationLink,extraData:{linkType:e}}),this.props.Form.appendPermission(e).done(function(a){d.setStateSafely({CollaborateOptionValue:c,ShowCollaborationDropDownSpinner:!1,IsChangingCollaborateOption:!1})}).fail(function(a){d.setStateSafely({ShowCollaborationDropDownSpinner:!1,IsChangingCollaborateOption:!1,ShowError:!0});var c=b.Resources.LocalizedStrings["Error_Message_"+a.innerCode];d.showErrorStatus(c,"flex-pane-change-collaborate-tenant-status")})},e}(d.ShareItemsBase)}(d=c.FlexPane||(c.FlexPane={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(d){function e(a){return React.createElement(f,__assign({},a))}d.createShareAsTemplate=e;var f=function(d){function e(){return null!==d&&d.apply(this,arguments)||this}return __extends(e,d),e.prototype.componentWillMount=function(){var a=this.props.Form.SettingMaster.Model;this.setState({AllowCopy:a.AllowCopy&&!!a.ShareToken,Token:a.ShareToken})},e.prototype.createLink=function(){this.updateShareCopyStatus(!0)},e.prototype.deleteLink=function(){this.updateShareCopyStatus(!1)},e.prototype.getShareContentUrl=function(){var b=this.props.Form.Model.Id,c=this.state.Token,d={id:b,sharetoken:c},e="../Pages/ShareFormPage.aspx?"+jQuery.param(d);return a.Utilities.Html.getAbsoluteUrl(e)},e.prototype.createTitle=function(){var d;return d=a.EnvironmentConfig.isSovereignProd()||!c.getUxStateMaster().Model.FormsTenantSettings.externalShareTemplate||a.Utilities.isPhishingForm(this.props.Form.Model.OnlineSafetyLevel)?b.Resources.LocalizedStrings.SharePane_ShareAsTemplateNotAllowed_Title:b.Resources.LocalizedStrings.SharePane_ShareAsTemplate_Title,React.createElement("div",{className:"flex-pane-share-content-title"},d)},e.prototype.updateShareCopyStatus=function(c){var d=this,e=this.props.Form;e.SettingMaster.setSharingStatus(e.Model.Id,c).done(function(){a.Event.EngagementEventDeprecated.logData({name:c?a.Event.EngagementEventNames.DesignPage.Share.CreateShareAsTemplateLink:a.Event.EngagementEventNames.DesignPage.Share.DeleteShareAsTemplateLink}),d.needUpdateFocus=!0,d.setStateSafely({ShowSpinner:!1,AllowCopy:c,Token:e.SettingMaster.Model.ShareToken,ShowError:!1})}).fail(function(a){d.setStateSafely({AllowCopy:e.SettingMaster.Model.AllowCopy,ShowSpinner:!1,ShowError:!0});var c=b.Resources.LocalizedStrings["Error_Message_"+a.innerCode];d.showErrorStatus(c,"flex-pane-ShareAsTemplate-status")})},e}(d.ShareItemsBase)}(d=c.FlexPane||(c.FlexPane={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(d){function e(){return g.pickVideo()}function f(a){return React.createElement(g,a)}d.pickVideo=e,d.createVideoPickerView=f;var g=function(d){function e(){return null!==d&&d.apply(this,arguments)||this}return __extends(e,d),e.pickVideo=function(){e.videoDeferred&&e.videoDeferred.reject(),e.videoDeferred=$.Deferred();var a=c.getUxStateMaster();return a.Model.FlexPane="VideoPicker",Forms.UX.Utilities.trackFocusJump("Flexpane-VideoPicker",function(){c.getUxStateMaster().Model.FlexPane="MediaSelect",e.rejectVideoPicker(!0)}),e.videoDeferred.promise()},e.rejectVideoPicker=function(a){e.videoDeferred&&(e.videoDeferred.reject(!0),e.videoDeferred=null)},e.collapeFlexPaneHandler=function(){var a=c.getUxStateMaster().Model;"VideoPicker"===a.FlexPane&&(a.FlexPane="None")},e.prototype.componentWillUnmount=function(){e.rejectVideoPicker()},e.prototype.rejectPickerDeferred=function(){e.rejectVideoPicker(!0)},e.prototype.createPickerContent=function(){return this.createVideoUrlPicker()},e.prototype.createErrorHandling=function(){var c=this.state.ErrorState&&this.state.ErrorState.InnerCode;if(!c)return void 0;var d;switch(c){case 5400:d=b.Resources.LocalizedStrings.Error_Message_5400;break;case 5401:d=b.Resources.LocalizedStrings.Error_Message_5401;break;case 5402:d=b.Resources.LocalizedStrings.Error_Message_5402;break;case 5403:d=b.Resources.LocalizedStrings.Error_Message_5403;break;default:d=b.Resources.LocalizedStrings.Error_Message_Client_VideoUrlInvalidError}var e=a.Control.createFontIconControl({HTMLAttributes:{className:"forms-icon-size32x32"},IconName:"Sad"});return React.DOM.div({className:"image-picker-error-hanlder-container"},React.DOM.div({className:"image-picker-error-icon"},e),React.DOM.div({className:"image-picker-error-message"},d))},e.prototype.createSwitchButtons=function(){return React.DOM.div({className:"image-picker-switch-button-container"},this.createSwicherButton(b.Resources.LocalizedStrings.ImagePicker_switcher_VideoUrl,!0,function(){}))},e.prototype.addVideoFromUrlHandler=function(a){e.videoDeferred&&e.videoDeferred.resolve(a),e.collapeFlexPaneHandler()},e.prototype.createVideoByUrl=function(){var c=this.state.VideoURL;a.Utilities.UrlValidation.isYouTubeUrl(c)?(a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.MediaPicker.AddVideo}),this.addVideoFromUrlHandler(c),this.setState({VideoURL:void 0,ErrorState:void 0})):(a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.MediaPicker.AddVideoFailure}),this.setState({ErrorState:{InnerCode:b.FormLimitation.ClientSideErrorDefaultInnerCode}}))},e.prototype.createVideoUrlPicker=function(){var c=this,d=a.Control.createTextField({Placeholder:b.Resources.LocalizedStrings.ImagePicker_FromUrl_HintMessage,HTMLAttributes:{className:"fromUrlTextField",onKeyUp:function(b){b.keyCode===a.KeyCode.Enter&&c.createVideoByUrl()}},Value:this.state.VideoURL,TextFieldType:a.Control.TextFieldType.SingleLine,MinimalHeight:40,onValueChange:function(a){return c.setState({VideoURL:a})}}),e=a.Control.createTextButton({HTMLAttributes:{className:"image-picker-add-button from-url",disabled:!1,onClick:function(){return c.createVideoByUrl()}},Text:b.Resources.LocalizedStrings.ImagePicker_Add_button,ButtonStyle:a.Control.ButtonStyle.LightBackground}),f=a.Control.createFontIconControl({HTMLAttributes:{className:"fromUrlIcon"},IconName:"Link"});return React.DOM.div({className:"fromUrlContainer"},f,React.DOM.div({className:"fromUrlLabel"},b.Resources.LocalizedStrings.ImagePicker_switcher_Url),d,e)},e}(d.MediaPickerView)}(d=c.FlexPane||(c.FlexPane={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(c){var d=function(d){function e(a){var b=d.call(this,a)||this;return b.mounted=!0,b.designQuestionTopOffset=0,b.addQuestionPaneRef="addQuestionPane",b.titleDesignerRef=React.createRef(),b.questionRuntimeModels={},b.shouldBlockEndDesignMode=!1,b.expandOrCollapseButtonPropsOnClick=b.expandOrCollapseButtonPropsOnClick.bind(b),b.expandOrCollapseButtonPropsonKeyDown=b.expandOrCollapseButtonPropsonKeyDown.bind(b),b.insertCardCallback=b.insertCardCallback.bind(b),b.onInsertSuggestion=b.onInsertSuggestion.bind(b),b.setSortableListActiveItem=b.setSortableListActiveItem.bind(b),b.setElementInDesignMode=b.setElementInDesignMode.bind(b),b.onElementListChange=b.onElementListChange.bind(b),b.state={FocusedOnInsertPanelItem:!1,ShowMoveControl:null},b}return __extends(e,d),e.prototype.componentDidMount=function(){Forms.Templates.FormTemplates.loadFormTemplates(),this.loadTemplatesCallback()},e.prototype.componentWillUnmount=function(){var a=this;this.mounted=!1;var b=this.props.Form;$("#body-scrollable-content").unbind("scroll");var c=Nerve.getCollectionMasterFromModel(b.Model.Questions);c.unobserve(this.onElementListChange);var d=Nerve.getCollectionMasterFromModel(b.Model.DescriptiveElements);d.unobserve(this.onElementListChange),_.keys(this.questionRuntimeModels).forEach(function(b){return a.questionRuntimeModels[b].release()})},e.prototype.render=function(){var a=this,b=_.extend({},this.props.HTMLAttributes);return b.id="form-designer-container",b.onMouseDown=function(b){var c=b.target;!c||"form-designer-container"!==c.id&&"form-designer"!==c.id||a.endCurrentDesignMode()},React.createElement("div",__assign({},this.props.HTMLAttributes,{id:"design-view"}),React.createElement("div",__assign({},b,{tabIndex:-1,"aria-label":this.props.Form.Model.Title,role:"main"}),React.createElement("div",{id:"form-designer"},this.createMoveControl(),this.createQuestionDesigners())))},e.prototype.endCurrentDesignMode=function(){this.shouldBlockEndDesignMode||this.setState({ElementInDesignMode:void 0,IsTitleInDesignMode:!1})},e.prototype.createMoveControl=function(){var a=this;if(!this.state.ShowMoveControl)return null;var b=this.props.Form.FormElementManager.SectionMasters,c=_.find(this.props.Form.FormElementManager.SectionMasters,function(b){return b.Model.Id==a.state.ShowMoveControl});if(b.length<=1||!c)return null;var d={AllElements:b,IsMobile:!1,TargetElementMaster:c,onClose:function(){a.setState({ShowMoveControl:null})}};return React.createElement(Forms.UX.Renderer.SectionMovePanel,__assign({},d))},e.prototype.createHeaderTopQuestionDesigners=function(a){var b=this,c=this.props.Form,d=[this.createTitleDesigner(),React.createElement(Forms.UX.Renderer.ThemeRender,{key:"themeRender",ThemeMaster:this.props.Form.ThemeMaster})];if(this.state.IsTitleInDesignMode){var e=this.createSuggestionCard(null);d.push(this.createInsertPanel(e))}var f=c.FormElementManager.HeaderTopQuestionMasters;if(f.length>0&&f.forEach(function(c,e){return d=d.concat(b.createQuestionDesigner(c,e,a))}),!this.state.IsTitleInDesignMode&&!this.state.ElementInDesignMode&&!c.hasSection()){var e=this.createSuggestionCard(null);d.push(this.createInsertPanel(e))}return React.createElement("div",{key:"headerTopQuestions",className:"form-designer-section"},d)},e.prototype.createTitleDesigner=function(){var a=this,d=this.state.IsTitleInDesignMode;return React.createElement(Forms.UX.FormDesignView.DesignTimeEnhancer,{enterDesignMode:function(){var c=a.props.Form;b.CategoryExtensionPoints.supportsExtensionPoint(c,b.ExtensionPoints.DisableEditForm)||a.setState({ElementInDesignMode:void 0,IsTitleInDesignMode:!0})},InDesignMode:d,leaveDesignMode:function(){a.state.IsTitleInDesignMode&&a.setState({ElementInDesignMode:void 0,IsTitleInDesignMode:!1})},key:d?"title-designer":"title-renderer",ref:this.titleDesignerRef},c.createTitleDesigner({Form:this.props.Form,InDesignMode:d,onHeightChange:function(){return a.applyDesignedElementPosition()}}))},e.prototype.createQuestionDesigners=function(){var a=this,b=this.props.Form,c=(b.getDefaultResponse(),b.FormElementManager.AllElementMasters),d=b.FormElementManager.TopQuestionMasters,e=b.FormElementManager.SectionMasters,f=[this.createHeaderTopQuestionDesigners(c)];return e&&e.length&&(f=f.concat(e.map(function(b,f){return a.createSectionDesigner(b,f,e,d,c)}))),f},e.prototype.createQuestionDesigner=function(a,c,d){var e=this,f=a===this.state.ElementInDesignMode;c++;var g,h=a.Model.Id,i=[];if(f){var j=_.indexOf(d,a);g=Forms.UX.Designer.createDesignerElement({Master:b.Model.exportConverter(a),Ordinal:c,IsFirstElement:0===j,IsLastElement:j===d.length-1,onDelete:function(){var a=d[j+1];a?e.setState({ElementInDesignMode:a}):$(ReactDOM.findDOMNode(e.refs["add-question"])).focus()},setQuestionInDesignMode:function(a){e.setState({ElementInDesignMode:b.Model.exportConverter(a)})},blockEndDesignMode:function(a){return e.shouldBlockEndDesignMode=a}})}else g=Forms.UX.Renderer.createRendererElement({Master:b.Model.exportConverter(this.getOrCreateRuntimeModel(a)),Ordinal:c,DisableShuffle:!0,Disabled:!0,onHeightChange:function(){return e.applyDesignedElementPosition()},ShowDesignInfo:!0});if(i.push(React.createElement(Forms.UX.FormDesignView.DesignTimeEnhancer,{leaveDesignMode:function(){e.setState({ElementInDesignMode:void 0},function(){var a=$(ReactDOM.findDOMNode(e.refs[h]));a.find(".design-time-mixer").focus()})},enterDesignMode:function(){return e.designQuestion(a)},HTMLAttributes:{"aria-label":b.Resources.LocalizedStrings.Designer_Question_Label.format(c,a.Model.Title)},InDesignMode:f,key:h+(f?"-designer":""),ref:h},g)),f){var k=this.createSuggestionCard(a);i.push(this.createInsertPanel(k))}return i},e.prototype.createSectionDesigner=function(a,c,d,e,f){var g=this,h=a===this.state.ElementInDesignMode,i=c+1,j=a.Model.Id,k=d.length-1,l=[],m=React.createElement(Forms.UX.FormDesignView.DesignTimeEnhancer,{HTMLAttributes:{"aria-label":b.Resources.LocalizedStrings.Designer_Section_Label.format(i,a.Model.Title)},InDesignMode:h,enterDesignMode:function(){return g.designQuestion(a)},leaveDesignMode:function(){g.setState({ElementInDesignMode:void 0},function(){var a=$(ReactDOM.findDOMNode(g.refs[j]));a.focus()})},key:j+h?"-designer":"",ref:j},React.createElement(Forms.UX.FormDesignView.SectionTitleMixer,{InDesignMode:h,Master:a,onHeightChange:function(){return g.applyDesignedElementPosition()}}));if(l.push(m),h){var n=this.createSuggestionCard(null);l.push(this.createInsertPanel(n))}var o=this.props.Form.findQuestionsInSection(a);if(o&&o.length){var p=_.indexOf(e,o[0]);o.forEach(function(a,b){l=l.concat(g.createQuestionDesigner(a,b+p,f))})}if(k===c&&!this.state.IsTitleInDesignMode&&!this.state.ElementInDesignMode){var n=this.createSuggestionCard(null);l.push(this.createInsertPanel(n))}return React.createElement(Forms.UX.Designer.SectionDesigner,{key:j+"-section-designer",Master:a,openMovePane:this.setSortableListActiveItem,Ordinal:i,setElementInDesignMode:this.setElementInDesignMode},l)},e.prototype.setElementInDesignMode=function(a){this.setState({ElementInDesignMode:a})},e.prototype.setSortableListActiveItem=function(a){this.setState({ShowMoveControl:a})},e.prototype.getOrCreateRuntimeModel=function(a){var c=this.questionRuntimeModels[a.Model.Id];return c||(c=new b.Model.QuestionRuntimeMaster(a,null),this.questionRuntimeModels[a.Model.Id]=c),c},e.prototype.designQuestion=function(a){var c=this,d=this.props.Form;b.CategoryExtensionPoints.supportsExtensionPoint(d,b.ExtensionPoints.DisableEditForm)||this.setState({ElementInDesignMode:a,IsTitleInDesignMode:!1},function(){a&&c.scrollToDesigner(a.Model.Id)})},e.prototype.createInsertPanel=function(c){var d=this,e=this.props.Form;if(b.CategoryExtensionPoints.supportsExtensionPoint(e,b.ExtensionPoints.DisableEditForm))return null;var f=a.Control.createGlyphButton({HTMLAttributes:this.getExpandOrCollapseButtonProps(),Icon:"Add",IconClassName:"design-view-insert-panel-img",Text:b.Resources.LocalizedStrings.DesignPage_InsertPanel_CreateQuestion,TextClassName:"button-text",GlyphButtonStyle:this.state.InsertPanelExpanded?a.Control.GlyphButtonStyle.GlyphOnly:a.Control.GlyphButtonStyle.Horizontal,ButtonStyle:a.Control.ButtonStyle.LightBackground,ref:"add-button"}),g={className:"__insert-pane__ design-view-insert-panel-container",key:this.addQuestionPaneRef,ref:this.addQuestionPaneRef,onBlur:function(a){var b=ReactDOM.findDOMNode(d.refs[d.addQuestionPaneRef]);setTimeout(function(){d.mounted&&!b.contains(document.activeElement)&&d.state.InsertPanelExpanded&&d.setState({InsertPanelExpanded:!1})},0)}};if(this.state.InsertPanelExpanded){var h=(this.state,Forms.UX.Designer.createInsertCardPane({FocusOnInsertCardItem:this.state.FocusedOnInsertPanelItem,insertCallback:this.insertCardCallback}));return React.createElement("div",__assign({},g),React.createElement("div",{className:"design-view-insert-button-group office-form-theme-primary-background"},f,h),c)}return React.createElement("div",__assign({},g),React.createElement("div",{className:"design-view-insert-button-group office-form-theme-primary-background"},f),c)},e.prototype.getExpandOrCollapseButtonProps=function(){var a={ref:"add-question","aria-expanded":this.state.InsertPanelExpanded};return this.props.Form.reachedQuestionNumberLimitation()?(a.className="design-view-insert-panel-expand-or-collapse add-question-button-disabled",a.title=b.Resources.LocalizedStrings.DesignPage_LimitMessage_QuestionNumber):(a.className="design-view-insert-panel-expand-or-collapse office-form-theme-button",a.onClick=this.expandOrCollapseButtonPropsOnClick,a.onKeyDown=this.expandOrCollapseButtonPropsonKeyDown),a},e.prototype.insertCardCallback=function(a,b){Forms.Models.FormElementManager.isDescriptiveElement(a.Type)?this.insertCardCallbackForDescriptiveElement(a):this.insertCardCallbackForQuestion(a,b)},e.prototype.insertCardCallbackForDescriptiveElement=function(a){var b,c=this,d=this.props.Form;if(this.state.IsTitleInDesignMode)b=d.insertElementAfter(a,null,null);else if(this.state.ElementInDesignMode){var e=this.state.ElementInDesignMode;b=d.insertElementAfter(a,e,null)}else b=d.appendElement(a,null);this.setState({ElementInDesignMode:b,IsTitleInDesignMode:!1,InsertPanelExpanded:!1},function(){return c.scrollToDesigner(b.Model.Id)})},e.prototype.insertCardCallbackForQuestion=function(a,c){var d=this,e=this.props.Form;a.IsQuiz=e.SettingMaster.Model.IsQuizMode;var f;if(this.state.IsTitleInDesignMode)f=e.insertElementAfter(a,null,c);else if(this.state.ElementInDesignMode){var g=this.state.ElementInDesignMode;g instanceof b.Model.QuestionMaster&&this.inheritAttributions(a,c,a,g.Model),f=e.insertElementAfter(a,g,c)}else{var h=e.FormElementManager.TopQuestionMasters.map(function(a){return a.Model}),i=h[h.length-1];i&&this.inheritAttributions(a,c,a,i),f=e.appendElement(a,c)}this.setState({ElementInDesignMode:f,IsTitleInDesignMode:!1},function(){return d.scrollToDesigner(f.Model.Id)})},e.prototype.inheritMath=function(a,c){!c.IsMathQuiz||a.Type!==b.Model.Question.Choice.getElementTypeName()&&a.Type!==b.Model.Question.TextField.getElementTypeName()||(a.IsMathQuiz=c.IsMathQuiz,a.IsAnswerPlainText=c.IsAnswerPlainText,a.ShowSubtitle=c.ShowSubtitle,a.Choices&&_.forEach(a.Choices,function(a){a.IsGenerated&&!a.IsMathOption&&(a.Description=""),a.IsMathOption=!0}))},e.prototype.inheritAttributions=function(a,c,d,e){d.Required=e.Required,d.ShowSubtitle=e.ShowSubtitle,d.Type===b.Model.Question.MatrixChoiceGroup.getElementTypeName()&&c.forEach(function(a){a.Required=e.Required}),d.Type===b.Model.Question.Choice.getElementTypeName()?d.ShuffleOptions=e.ShuffleOptions:d.Type===b.Model.Question.Rating.getElementTypeName()&&(d.ShowRatingLabel=e.ShowRatingLabel),d.IsQuiz&&e.IsQuiz&&(d.Point=e.Point,this.inheritMath(a,e))},e.prototype.createSuggestionCard=function(a){var c=this.props,d=this.state,e=c.Form;return Forms.UX.Intelligence.createSuggestionCard(b.Model.exportConverter(e),b.Model.exportConverter(a),d.InsertPanelExpanded,d.IsTitleInDesignMode,b.Model.exportConverter(d.ElementInDesignMode),this.onInsertSuggestion)},e.prototype.onInsertSuggestion=function(c,d,e){var f=this,g=this.props.Form;a.Flighting.Flight.isEnabled(a.Flighting.Flights.IntelligenceTitleLogMetric)&&0==g.FormElementManager.TopQuestionMasters.length&&a.DataProvider.ProviderManager.getInstance().CurrentMathProvider.textAnalyzeWithFeatures(a.DataProvider.Models.TextAnalyzerFeatures.AdoptKeyWord,JSON.stringify({AnalyzeText:g.Model.Title,Metric:e})),(this.state.IsTitleInDesignMode||this.state.ElementInDesignMode)&&d.reverse(),d.forEach(function(a){if(a=_.clone(a),a.Type!==b.Model.QuestionType.MatrixChoiceGroup)delete a.Id,f.insertCardCallback(a);else{var d=c.filter(function(b){return b.GroupId===a.Id});d=d.map(function(a){var b=_.clone(a);return delete b.Id,b}),delete a.Id,f.insertCardCallback(a,d)}}),this.setState({ElementInDesignMode:void 0,IsTitleInDesignMode:!1},function(){f.state.InsertPanelExpanded&&f.setState({InsertPanelExpanded:!1}),f.scrollToDesigner(f.addQuestionPaneRef)})},e.prototype.expandOrCollapseButtonPropsOnClick=function(){this.setState({FocusedOnInsertPanelItem:!1,InsertPanelExpanded:!this.state.InsertPanelExpanded})},e.prototype.expandOrCollapseButtonPropsonKeyDown=function(b){switch(b.keyCode){case a.KeyCode.Tab:this.state.InsertPanelExpanded&&(b.stopPropagation(),b.preventDefault(),this.setState({FocusedOnInsertPanelItem:!0}));break;case a.KeyCode.Enter:b.stopPropagation(),b.preventDefault(),this.setState({FocusedOnInsertPanelItem:!0,InsertPanelExpanded:!this.state.InsertPanelExpanded})}},e.prototype.onElementListChange=function(a){var b=this,c=!1,d={};if(a.RemovedModels.length){var e=this.state.ElementInDesignMode;if(e&&_.contains(a.RemovedModels,e.Model)){c=!0;var f=e.Model.Order,g=this.props.Form.FormElementManager.TopElementMasters,h=_.find(g,function(a){return a.Model.Order>f});!h&&g.length&&(h=g[g.length-1]),d.ElementInDesignMode=h}}a.AddedModels.length&&(c=!0),_.contains(a.FieldSchemas,a.Master.Schema[0].Order)&&(c=!0),c&&this.setState(d,function(){var a=b.state.ElementInDesignMode;if(a)b.applyDesignedElementPosition();else{var c=ReactDOM.findDOMNode(b.refs["add-button"]);c.focus()}})},e.prototype.recordDesignedQuestionPosition=function(){var a=this.state.ElementInDesignMode;if(a){var b=ReactDOM.findDOMNode(this.refs[a.Model.Id]);b&&(this.designQuestionTopOffset=$(b).offset().top)}},e.prototype.scrollToDesigner=function(b){var c=ReactDOM.findDOMNode(this.refs[b]);if(c){var d=$("#body-scrollable-content"),e=.03*d.outerHeight(),f=Math.max(.15*d.outerHeight(),50);a.Utilities.Html.scrollToShowSubelement($(c),d,e,f),this.designQuestionTopOffset=$(c).offset().top}},e.prototype.applyDesignedElementPosition=function(){var a=this.state.ElementInDesignMode;if(a){var b=a.Model.Id,c=ReactDOM.findDOMNode(this.refs[b]);if(c){var d=$("#body-scrollable-content"),e=d.scrollTop()+($(c).offset().top-this.designQuestionTopOffset);d.scrollTop(e),this.designQuestionTopOffset=$(c).offset().top}}},e.prototype.loadTemplatesCallback=function(){var a=this,b=this.props.Form;$("#body-scrollable-content").bind("scroll",function(){a.recordDesignedQuestionPosition()});var c=Nerve.getCollectionMasterFromModel(b.Model.Questions);c.observe(this.onElementListChange);var d=Nerve.getCollectionMasterFromModel(b.Model.DescriptiveElements);d.observe(this.onElementListChange),$("#form-designer-container").focus()},e}(a.ReactComponent);c.FormDesigner=d}(d=c.FormDesignView||(c.FormDesignView={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(d){function e(c){return a.Flighting.Flight.isEnabled(a.Flighting.Flights.DisableBrandingForMSA)&&OfficeFormServerInfo.userInfo.IsMsa?React.createElement(f,c):Forms.UX.FormDesignView.createTitleDesignerMixer({Form:b.Model.exportConverter(c.Form),InDesignMode:c.InDesignMode,onHeightChange:c.onHeightChange,ref:c.ref})}d.createTitleDesigner=e;var f=function(d){function e(){return null!==d&&d.apply(this,arguments)||this}return __extends(e,d),e.prototype.componentWillMount=function(){var a=this;this.update=function(){return a.forceUpdate(function(){a.props.onHeightChange()})};var c=b.Model.FormMaster.Schema;this.props.Form.observe(this.update,[c.Title,c.Description,c.Logo,c.LogoInfo])},e.prototype.componentWillUnmount=function(){this.props.Form.unobserve(this.update)},e.prototype.componentDidMount=function(){$(".form-designer-subtitle-editor textarea").linkify(),window.setTimeout(this.update,0)},e.prototype.componentDidUpdate=function(){$(".office-form-subtitle").linkify();var a=c.getUxStateMaster().Model.FlexPane,b=c.getUxStateMaster().Model.PreviousFlexPane;if("None"===a&&"ImagePicker"===b){c.getUxStateMaster().Model.FlexPane="None";var d=ReactDOM.findDOMNode(this.refs.imagePicker);d&&d.focus()}},e.prototype.render=function(){return this.props.InDesignMode?this.createDesignerComponent():this.createRendererComponent()},e.prototype.createDesignerComponent=function(){var d=this.props.Form,e=d.getImageMaster(b.Model.FormMaster.Schema.Logo),f=e.Model,g=d.getImageSettingsMaster(b.Model.FormMaster.Schema.LogoInfo),h=g.Model,i=Forms.UX.Designer.createImageDesignerContainer({HTMLAttributes:{className:"horizontal"},ImageMaster:b.Model.exportConverter(e),ImageSettingsMaster:b.Model.exportConverter(g),IsFormLogo:!0});if(i){var j=h.ContainerHeight,k=h.ContainerWidth;(f.ImageProcessingStatus===b.Model.ImageProcessingStatus.Picking||f.ImageProcessingStatus===b.Model.ImageProcessingStatus.Uploading||f.ErrorType!==b.Model.ImageErrorType.NoError)&&(j=b.FormLimitation.ImagePlaceHolderHeight,k=b.FormLimitation.ImagePlaceHolderWidth)}else var l=a.Control.createGlyphButton({HTMLAttributes:{className:"form-designer-title-editor-image-picker office-form-theme-button",onClick:function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Form.AddImage_Logo,extraData:{FormId:d.isFieldReady(b.Model.FormMaster.Schema.Id)?d.Model.Id:""}}),c.FlexPane.pickImage().done(function(a){return e.addImage(a)})}},Icon:"Photo2",IconClassName:"forms-icon-size20x20",ButtonStyle:a.Control.ButtonStyle.LightBackground,GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly,Text:b.Resources.LocalizedStrings.ImagePicker_Insert_Image_button,ref:"imagePicker"});var m="form-designer-title-editor";l&&(m=a.Utilities.Html.combineAttributes(m,"image"));var n=a.Control.createTextField({AutoFocus:!0,Placeholder:b.Resources.LocalizedStrings.Designer_PlaceholderForFormTitle,Options:{HTMLPropsForInnerElement:{className:"mixer-focus-target"}},Value:d.Model.Title,TextFieldType:i?a.Control.TextFieldType.FixHeightMultiline:a.Control.TextFieldType.AutoHeightMultiline,MinimalHeight:i?j:40,AutoSelection:!0,HTMLAttributes:{className:m,style:i?{width:"calc(100% - {0}px)".format(k+10)}:void 0},MaxLength:b.FormLimitation.FormTitleLength,onValueChange:function(a){return d.Model.Title=a}}),o=a.Control.createTextField({Placeholder:b.Resources.LocalizedStrings.Designer_PlaceholderForFormSubtitle,Options:{HTMLPropsForInnerElement:{className:"mixer-focus-target"}},Value:d.Model.Description,TextFieldType:a.Control.TextFieldType.AutoHeightMultiline,MinimalHeight:40,HTMLAttributes:{className:"form-designer-subtitle-editor"},MaxLength:b.FormLimitation.FormSubtitleLength,onValueChange:function(a){return d.Model.Description=a}}),p=a.Utilities.Html.mergeReactProps(this.props.HTMLAttributes,{className:"__title-designer__ form-designer-form-title office-form-theme-focus-border"});return React.DOM.div(p,i,n,l,o)},e.prototype.createRendererComponent=function(){var c,d=this.props.Form,e=d.Model,f=a.Utilities.Html.mergeReactProps(this.props.HTMLAttributes,{"aria-expanded":!1,"aria-label":e.Title+" "+b.Resources.LocalizedStrings.Designer_FormTitle_Label,className:"__title-designer__ form-designer-title-view"}),g="logo-image-container old";return e.Logo&&e.Logo.ResourceUrl?c=React.DOM.div({className:g},b.createImageRenderer({Image:d.getImageMaster(b.Model.FormMaster.Schema.Logo),ImageSettings:d.getImageSettingsMaster(b.Model.FormMaster.Schema.LogoInfo),ImageType:"Logo"}),b.createImageSpinner(d.getImageMaster(b.Model.FormMaster.Schema.Logo).Model)):(e.Logo.ImageProcessingStatus===b.Model.ImageProcessingStatus.Uploading||e.Logo.ImageProcessingStatus===b.Model.ImageProcessingStatus.Picking||e.Logo.ErrorType!==b.Model.ImageErrorType.NoError)&&(c=React.DOM.div({className:g,style:{height:b.FormLimitation.LogoImagePlaceHolder+"px",width:b.FormLimitation.LogoImagePlaceHolder+"px"}},b.createImageSpinner())),React.DOM.div(f,c,React.DOM.div({className:"office-form-title heading-1"},React.DOM.div(null,React.DOM.span(null,e.Title),b.Analysis.QuizView.createTotalPointsDesigner(this.props.Form.Model),this.createBranchIcon())),React.DOM.div({className:"office-form-subtitle heading-1"},e.Description))},e.prototype.createBranchIcon=function(){return this.props.Form.Model.HasValidBranching?React.DOM.div({className:"office-form-branching-icon office-form-theme-primary-foreground"},a.Control.createFontIconControl({HTMLAttributes:{className:"forms-icon-size24x24"},key:"branch-icon",IconName:"BranchMerge"})):void 0},e}(a.ReactComponent);d.TitleDesigner=f}(d=c.FormDesignView||(c.FormDesignView={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return React.createElement(f,__assign({},a))}var e=a.DataProvider.Models;c.createHeadBar=d;var f=function(d){function f(b){var c=d.call(this,b)||this;return c.previewButtonRef=React.createRef(),c.themeButtonRef=React.createRef(),c.shareButtonRef=React.createRef(),c.update=function(){return c.forceUpdate()},c.state={userType:e.UserType.Unknown},a.getUserRepository().registerUsersStateChange(c.update),c}return __extends(f,d),f.getComponentClassName=function(){return"DesignPage.HeadBar"},f.prototype.componentWillMount=function(){var b=this;a.DataProvider.FeaturePlanProvider.getUserType().done(function(a){b.setState({userType:a})})},f.prototype.componentWillUnmount=function(){a.getUserRepository().unregisterUsersStateChange(this.update)},f.prototype.render=function(){return React.createElement("div",null,this.createHeadBar())},f.prototype.createHeadBar=function(){var d,f=this,g=b.Resources.LocalizedStrings.HeaderBar_AppTitle,h={className:"headbar-app-title",title:g,onClick:function(){return f.onClickFormPortal()}};if(a.EnvironmentSettings.IsExternalIntegration){var i={className:"headbar-app-title headerbar-app-tile-label segoeUISemilight"};d=a.Control.createLabel({HTMLAttributes:i,Label:g})}else d=a.Flighting.Flight.isEnabled(a.Flighting.Flights.MsaPreviewLabel)&&this.state.userType&(e.UserType.MsaFree|e.UserType.MsaPaid)?a.Control.createButton({HTMLAttributes:h,ButtonStyle:a.Control.ButtonStyle.DarkBackGround,children:[React.DOM.span(null,g),React.DOM.span({className:"headbar-app-preview"},b.Resources.LocalizedStrings.HeaderBar_AppTitle_Preview)]}):a.Control.createTextButton({HTMLAttributes:h,Text:g,ButtonStyle:a.Control.ButtonStyle.DarkBackGround});var j;return a.EnvironmentSettings.IsExternalIntegration||(j=c.createAppLauncher({AppLauncherCollapseTrigger:this.props.AppLauncherCollapseTrigger})),React.DOM.div({className:"headbar-container",role:"banner",style:{display:this.props.ShouldDisabled?"none":void 0}},React.DOM.div({className:"headbar-left-content"},j,d),this.createHeadbarButtonGroup())},f.prototype.onClickFormPortal=function(){var a=c.getUxStateMaster(),b=a.Model;a.startBulkEditMode(),a.hideTopView(),b.FormId=void 0,b.FormMaster=void 0,b.CriticalError=void 0,b.Token=void 0,b.FormCollectionType="OwnedForms",b.SearchContent="",b.GroupMaster=void 0,a.hideInfoMessageBar(),a.endBulkEditMode(),this.forceUpdate()},f.prototype.createHeadbarButtonGroup=function(){var d,e,f,g,h=this,i=c.getUxStateMaster(),j=i.Model,k=!1,l=j.FormMaster;if(l&&(j.FormId?l.isFieldReady(b.Model.FormMaster.Schema.Id)&&l.Model.Id===j.FormId&&(k=!0):k=!0),k&&!a.EnvironmentSettings.IsAssignmentsIntegration){var m=a.getUserRepository().getUserCount(),n=a.getUserRepository().getUser(OfficeFormServerInfo.userInfo.UserId);if(1===m&&n&&n.userId===OfficeFormServerInfo.userInfo.UserId)d=void 0;else{var o=[];a.getUserRepository().getAllUsers().forEach(function(a){a.userId!==OfficeFormServerInfo.userInfo.UserId&&o.push(a)}),d=this.createCoAuthorListContainer(o)}e=this.createHeadbarButton(!1,!1,"View",a.EnvironmentSettings.IsExternalIntegration?"forms-icon-size16x16":null,b.Resources.LocalizedStrings.DesignPage_NavBar_PreviewLink,!0,function(){
i.startBulkEditMode(),j.Preview={PreviousTopView:"None"},i.showTopView("Preview",function(){h.setFocusOnHeaderButton(h.previewButtonRef)}),i.endBulkEditMode(),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Preview.Navigate,extraData:{previewMode:"Desktop"}})},this.previewButtonRef);var p=j.FlexPane,q=j.FormMaster;q.isFieldReady(b.Model.FormMaster.Schema.Category)&&b.CategoryExtensionPoints.supportsExtensionPoint(q,b.ExtensionPoints.DisableEditForm)||(f=this.createHeadbarButton(!1,"Theme"===p,"Color",a.EnvironmentSettings.IsExternalIntegration?"forms-icon-size14x14":"forms-icon-size16x16",b.Resources.LocalizedStrings.DesignPage_NavBar_Theme,!0,function(){Forms.UX.Utilities.trackFocusJump("Flexpane-Theme",function(){h.setFocusOnHeaderButton(h.themeButtonRef)}),h.changeToFlexPaneView("Theme")},this.themeButtonRef)),g=this.createHeadbarButton(!a.EnvironmentSettings.IsExternalIntegration,"SendForm"===p,a.EnvironmentSettings.IsExternalIntegration?"Share":"",a.EnvironmentSettings.IsExternalIntegration?"forms-icon-size16x16":void 0,b.Resources.LocalizedStrings.DesignPage_NavBar_Shareform,!0,function(){Forms.DesignPage.syncSampleFormMaster(b.Model.exportConverter(q)),Forms.UX.Utilities.trackFocusJump("Flexpane-SendForm",function(){h.setFocusOnHeaderButton(h.shareButtonRef)}),h.changeToFlexPaneView("SendForm")},this.shareButtonRef)}return React.DOM.div({className:"headbar-right-content"},React.createElement("div",{className:"headbar-coauthor-list-div","aria-live":"polite"},d),e,f,g,this.createMoreOptionsMenu())},f.prototype.createCoAuthorItem=function(a){return React.DOM.div({className:"headbar-coauthor-container",key:a.userId},Forms.UX.createFacePile({email:a.email,name:a.displayName,tooltip:a.displayName?b.Resources.LocalizedStrings.DesignPage_NavBar_CoAuthor.format(a.displayName):a.userId,displayText:Forms.UX.getDisplayText(a.firstName,a.lastName),isCoAuthUser:!0}))},f.prototype.createCoAuthorListContainer=function(a){var c,d=this;if(a.length<=3)c=a.map(function(a){return d.createCoAuthorItem(a)});else{var e=a.slice(2).map(function(a){return a.displayName||a.userId}).join(b.Resources.LocalizedStrings.Common_ItemSeperator);c=[this.createCoAuthorItem(a[0]),this.createCoAuthorItem(a[1]),React.DOM.div({className:"headbar-coauthor-container",key:"moreAuthor"},Forms.UX.createFacePile({tooltip:b.Resources.LocalizedStrings.DesignPage_NavBar_CoAuthors.format(e),displayText:(a.length-2).toString()+"+",isCoAuthUser:!0}))]}return c},f.prototype.createHeadbarButton=function(d,e,f,g,h,i,j,k){var l,m={onClick:function(){j(),b.Model.getUserProfileMaster().Model.SendTeachingCalloutVersion=c.TeachingCalloutUtilities.MAXRUNVERSION.toString()},className:"headbar-button"};d&&(m.className=a.Utilities.Html.combineAttributes(m.className,"highlighted"),l=c.Teaching.createSendTeachingCallout({form:c.getUxStateMaster().Model.FormMaster}));var n;return n=f?a.Control.createGlyphButton({HTMLAttributes:m,ToggleActive:e,Icon:f,IconClassName:g?g:"forms-icon-size18x18",Text:h,TextClassName:"headbar-button-text",GlyphButtonStyle:i?a.Control.GlyphButtonStyle.Horizontal:a.Control.GlyphButtonStyle.GlyphOnly,ButtonStyle:a.Control.ButtonStyle.DarkBackGround,ref:k}):a.Control.createTextButton({HTMLAttributes:m,ToggleActive:e,Text:h,ref:k}),React.DOM.div({className:"headbar-button-container"},n,l)},f.prototype.createMoreOptionsMenu=function(){var d,f,g,h,i,j=this,k={ar:"ar-sa",bg:"bg-bg",ca:"es-es",cs:"cs-cz",da:"da-dk",de:"de-de",el:"el-gr","en-us":"en-us",es:"es-es",et:"et-ee",eu:"es-es",fi:"fi-fi",fr:"fr-fr",gl:"es-es",he:"he-il",hi:"hi-in",hr:"hr-hr",hu:"hu-hu",id:"id-id",it:"it-it",ja:"ja-jp",kk:"kk-kz",ko:"ko-kr",lt:"lt-lt",lv:"lv-lv",ms:"ms-my","nb-no":"nb-no",nl:"nl-nl",pl:"pl-pl","pt-br":"pt-br","pt-pt":"pt-pt",ro:"ro-ro",ru:"ru-ru",sk:"sk-sk",sl:"sl-si","sr-cyrl-rs":"sy-latn-rs","sr-latn-rs":"sr-latn-rs",sv:"sv-se",th:"th-th",tr:"tr-tr",uk:"uk-ua",vi:"vi-vn","zh-cn":"zh-cn","zh-tw":"zh-tw"},l=c.getUxStateMaster().Model;if(l.FormMaster){f=function(){j.changeToFlexPaneView("Settings"),j.shouldBackFocusOnMenuButton=!0},d=React.DOM.button({className:"designer-more-options-menu-button"},b.Resources.LocalizedStrings.MoreOptionsMenu_Setting);var m=l.FormMaster;m.isFieldReady(b.Model.FormMaster.Schema.Category)&&b.CategoryExtensionPoints.supportsExtensionPoint(m,b.ExtensionPoints.DisableEditForm)||(h=function(){l.TopView="Branch",j.shouldBackFocusOnMenuButton=!0},g=React.createElement(Forms.UX.HeadBarBranchMenuItem,{Form:b.Model.exportConverter(m)})),i=React.DOM.div({className:"designer-more-options-menu-separator"})}var n,o,p=function(){j.changeToFlexPaneView("Feedback"),j.shouldBackFocusOnMenuButton=!0},q=!a.EnvironmentConfig.isSovereignProd()&&React.DOM.button({className:"designer-more-options-menu-button"},React.DOM.span({},b.Resources.LocalizedStrings.DesignPage_NavBar_Feedback)),r=function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Help.Navigate});var b=OfficeFormServerInfo.cultureInfo.Name.toLowerCase(),c="en-us";for(var d in k)if(b===k[d]||b===d){c=k[d];break}var e=a.Utilities.Html.safeOpen("http://o15.officeredir.microsoft.com/r/rlidOfficeWebHelp?p1=microsoftforms&clid="+c+"&ver=16&mode=Touch","MicrosoftOfficeLyncWebAppHelp","width=400,height=500,menubar=no,status=no,scrollbars=no,titlebar=no,toolbar=no,resizable=yes");e&&e.focus()},s=React.DOM.button({className:"designer-more-options-menu-button"},React.DOM.span({},b.Resources.LocalizedStrings.DesignPage_NavBar_Help)),t=OfficeFormServerInfo.userInfo.DisplayName,u=OfficeFormServerInfo.userInfo.Email;(t||u)&&(o=function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Menu.UserInfo});var b=a.EnvironmentConfig.getUserInfoUrl();j.state.userType&(e.UserType.MsaFree|e.UserType.MsaPaid)&&(b=a.EnvironmentConfig.getConsumerInfoUrl()),a.EnvironmentSettings.IsExternalIntegration?a.Utilities.Html.safeOpen(b):Forms.Common.redirectTo(b)},n=React.DOM.button({className:"designer-more-options-menu-button"},t?React.DOM.p(null,t):void 0,u?React.DOM.p(null,u):void 0));var v=function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Menu.SignOut}),a.Authenticator.signOut()},w=null;a.Utilities.applyTeamSSO()||(w=React.DOM.button({className:"designer-more-options-menu-button"},React.DOM.span({},b.Resources.LocalizedStrings.MoreOptionsMenu_Sign_out)));var x;x=a.EnvironmentSettings.IsExternalIntegration?[React.DOM.span({className:"headbar-button-text"},b.Resources.LocalizedStrings.Designer_More_Button_Text),x=a.Control.createFontIconControl({IconName:"ChevronDown",HTMLAttributes:{className:"forms-icon-size12x12"}})]:a.Control.createFontIconControl({IconName:"More",HTMLAttributes:{className:"forms-icon-size20x20"}});var y=null,z=null;a.Flighting.Flight.isEnabled(a.Flighting.Flights.PrintForm)&&(y=React.DOM.button({className:"designer-more-options-menu-button"},React.DOM.span({},b.Resources.LocalizedStrings.DesignPage_NavBar_PrintForm)),z=function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Menu.PrintForm});var b=a.DataProvider.ProviderManager.getInstance().FormApiServiceUrl+"light/SnapshotForm?exportType=Pdf&formId="+l.FormId,c=a.Utilities.Html.safeOpen(b);c&&c.focus()});var A={ClassName:"headbar-button",Description:b.Resources.LocalizedStrings.DesignPage_NavBar_MoreOptions,ButtonStyle:a.Control.ButtonStyle.DarkBackGround,Tooltip:b.Resources.LocalizedStrings.Header_Bar_Menu_Tooltip,ChildrenContent:x},B=[{MenuItem:g,Active:!0,OnExecute:h},{MenuItem:y,Active:!0,OnExecute:z},{MenuItem:d,Active:!0,OnExecute:f},{MenuItem:i,Active:!1},{MenuItem:q,Active:!0,OnExecute:p},{MenuItem:s,Active:!0,OnExecute:r},{MenuItem:n,Active:!0,OnExecute:o},{MenuItem:w,Active:!0,OnExecute:v}],C=function(){"None"===l.FlexPane&&(j.shouldBackFocusOnMenuButton=!1)},D={AutoFocused:this.shouldBackFocusOnMenuButton,ClassName:"designer-more-options-menu",ClassNameForContainer:"headbar-button-container",CustomizedMenuItems:B,MenuTriggerButton:A,Reset:"None"===l.FlexPane&&this.shouldBackFocusOnMenuButton,onButtonFocus:C};return a.Control.createMenuControl(D)},f.prototype.changeToFlexPaneView=function(b){var d=c.getUxStateMaster().Model,e=d.FlexPane===b?"None":b,g=void 0;switch(e){case"Feedback":g=a.Event.EngagementEventNames.DesignPage.Feedback.Navigate;break;case"SendForm":g=a.Event.EngagementEventNames.DesignPage.Send.Navigate;break;case"Settings":g=a.Event.EngagementEventNames.DesignPage.Setting.Navigate;break;case"Theme":g=a.Event.EngagementEventNames.DesignPage.Theme.Navigate;break;case"ImagePicker":g=a.Event.EngagementEventNames.DesignPage.MediaPicker.Navigate}g&&a.Event.EngagementEventDeprecated.logData({name:g,extraData:{source:f.getComponentClassName()}}),d.FlexPane=e},f.prototype.setFocusOnHeaderButton=function(a){a&&a.current&&a.current.focus()},f}(a.ReactComponent);c.HeadBar=f}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return React.createElement(f,__assign({},a))}c.createInfoMessageBar=d;var e;!function(a){a[a.PreviewLabelForSurvey=0]="PreviewLabelForSurvey"}(e=c.InfoBarMessageTypes||(c.InfoBarMessageTypes={}));var f=function(d){function f(){var a=null!==d&&d.apply(this,arguments)||this;return a.onInfoMessageChange=function(){return a.updateInfoMessage()},a}return __extends(f,d),f.prototype.componentWillMount=function(){this.setState({MessageType:c.getUxStateMaster().Model.InfoBarMessageType})},f.prototype.componentDidMount=function(){this.updateInfoMessage(),c.getUxStateMaster().observe(this.onInfoMessageChange,[c.UxStateFields.InfoBarMessageType])},f.prototype.componentWillUnmount=function(){c.getUxStateMaster().unobserve(this.onInfoMessageChange)},f.prototype.render=function(){var d=this,e=this.getInfoBarMessageByType(this.state.MessageType);if(!e)return null;var f=a.Control.createTextButton({HTMLAttributes:{className:"info-message-bar-close-button",onClick:function(){b.Model.getUserProfileMaster().Model[d.state.MessageType]=b.Model.MAXRUNVERSION.toString(),c.getUxStateMaster().hideInfoMessageBar()}},Text:b.Resources.LocalizedStrings.TeachingUi_GotIt,ButtonStyle:a.Control.ButtonStyle.LightBackground});return React.createElement("div",{id:"info-message-bar",className:"info-message-bar"},React.createElement("div",{className:"info-message-bar-message"},React.createElement(a.Control.FontIconControl,{IconName:"Info"}),e,f))},f.prototype.updateInfoMessage=function(){var a=this,b=c.getUxStateMaster().Model.InfoBarMessageType,d=this.getInfoBarMessageByType(b);d?(this.state={MessageType:b},this.forceUpdate(),$("#info-message-bar").stop().fadeIn("fast")):$("#info-message-bar").stop().fadeOut("slow",function(){a.state={MessageType:void 0},a.forceUpdate()})},f.prototype.getInfoBarMessageByType=function(a){b.Model.getUserProfileMaster().Model;switch(a){case e[e.PreviewLabelForSurvey]:return b.Resources.LocalizedStrings.InfoBarMessage_Preview_Label_For_Survey;default:return void 0}},f}(a.ReactComponent)}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return React.createElement(e,__assign({},a))}c.createLoadingPlaceholder=d;var e=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;return b.timeoutHandler=void 0,b}return __extends(c,a),c.prototype.componentDidMount=function(){var a=this;this.setState({Alerting:!0});var b=this.props;b.Timeout>0&&(this.timeoutHandler=window.setTimeout(function(){a.setState({Timeout:!0})},b.Timeout))},c.prototype.componentWillUnmount=function(){window.clearTimeout(this.timeoutHandler)},c.prototype.render=function(){var a=void 0,c=void 0;return this.state.Timeout&&(a=React.createElement("div",{className:"page-loading-message-timeout"},b.Resources.LocalizedStrings.LoadingPlaceholder_Timeout_Message)),this.state.Alerting&&(c=this.props.Message),React.createElement("div",{"aria-live":"polite","aria-label":b.Resources.LocalizedStrings.Page_LoadingMessage,className:"page-loading-messagebox",tabIndex:0},React.createElement("div",{className:"page-loading-animation"},React.createElement("div",{className:"spinner-tile-animation"})),React.createElement("div",{className:"page-loading-message"},c),a)},c}(a.ReactComponent)}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(d){function e(a){return React.createElement(f,__assign({},a))}d.createFormIntroductionDialog=e;var f=function(d){function e(){var a=null!==d&&d.apply(this,arguments)||this;return a.needChangeFocus=!1,a.state={ClosePopUp:!1},a}return __extends(e,d),e.prototype.componentWillMount=function(){this.shouldShowDialog()&&a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PortalPage.FormIntroductionDialog.Navigate})},e.prototype.componentDidMount=function(){Forms.UX.Utilities.trapFocusInsideElement(ReactDOM.findDOMNode(this))},e.prototype.render=function(){return this.shouldShowDialog()?(this.startTime=(new Date).getTime()/1e3,this.createGetStartContaienr()):null},e.prototype.shouldShowDialog=function(){return!c.TeachingCalloutUtilities.isVersionOk(b.Model.getUserProfileMaster().Model.PortalFormIntroduction)||this.state.ClosePopUp?!1:!0},e.prototype.createCloseButton=function(){var c=this;return a.Control.createGlyphButton({HTMLAttributes:{className:"form-introduction-dialog-close-button",onClick:function(){c.closePopUpDialog(a.Event.EngagementEventNames.PortalPage.FormIntroductionDialog.Close),c.setState({ClosePopUp:!0})},title:b.Resources.LocalizedStrings.Form_Introduction_Dialog_Close_Button},ButtonStyle:a.Control.ButtonStyle.LightBackground,GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly,Icon:"Cancel",IconClassName:"form-introduction-dialog-close-icon forms-icon-size14x14"})},e.prototype.createImage=function(a,b){return React.createElement("div",{className:"form-introduction-dialog-image"},React.createElement("img",{role:"presentation","aria-hidden":"true",src:a,alt:b}),React.createElement("div",{className:"form-introduction-dialog-image-text"},b))},e.prototype.createFirstFormButton=function(){var c=this;return a.Control.createTextButton({HTMLAttributes:{autoFocus:!0,className:"form-introduction-dialog-button",onClick:function(){c.closePopUpDialog(a.Event.EngagementEventNames.PortalPage.FormIntroductionDialog.CreatNewForm),c.props.createFormHandler()}},ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.Form_Introduction_Dialog_Create_Form_Button,ref:"createFormButton"})},e.prototype.createInstroductionContainer=function(){var a=React.createElement("div",{className:"form-introduction-dialog-image-container"},this.createImage("../Images/PortalMyForms/Forms_info_1.png",b.Resources.LocalizedStrings.Form_Introduction_Dialog_Introduction_1),this.createImage("../Images/PortalMyForms/Forms_info_2.png",b.Resources.LocalizedStrings.Form_Introduction_Dialog_Introduction_2),this.createImage("../Images/PortalMyForms/Forms_info_3.png",b.Resources.LocalizedStrings.Form_Introduction_Dialog_Introduction_3));return React.createElement("div",{className:"form-introduction-dialog-container"},a,this.createFirstFormButton())},e.prototype.createGetStartContaienr=function(){var a=React.createElement("div",{className:"form-introduction-dialog-title-container"},React.createElement("div",{className:"form-introduction-dialog-title"},b.Resources.LocalizedStrings.Form_Introduction_Dialog_Title1.format(this.getUserFirstName())),React.createElement("div",{className:"form-introduction-dialog-title"},b.Resources.LocalizedStrings.Form_Introduction_Dialog_Title2),React.createElement("div",{className:"form-introduction-dialog-subtitle"},b.Resources.LocalizedStrings.LandingPage_Form_Introduction));return React.createElement("div",{className:"form-introduction-dialog-div"},React.createElement("div",{className:"form-introduction-dialog-get-start-container"},a,this.createInstroductionContainer(),this.createCloseButton()))},e.prototype.getUserFirstName=function(){var b=OfficeFormServerInfo.userInfo.GivenName||OfficeFormServerInfo.userInfo.DisplayName;return b||a.Event.ErrorEventDeprecated.logData({errorName:"MissingUserName",errorInfo:{givenName:!!OfficeFormServerInfo.userInfo.GivenName,displayName:!!OfficeFormServerInfo.userInfo.DisplayName,userId:!!OfficeFormServerInfo.userInfo.UserId}}),b},e.prototype.closePopUpDialog=function(d){var e=(new Date).getTime()/1e3-this.startTime;a.Event.EngagementEventDeprecated.logData({name:d,extraData:{duration:e}}),b.Model.getUserProfileMaster().Model.PortalFormIntroduction=c.TeachingCalloutUtilities.MAXRUNVERSION.toString()},e}(a.ReactComponent)}(d=c.PortalPage||(c.PortalPage={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return React.createElement(f,a)}c.createPortalViewGroupTab=d;var e="PortalPage.GroupForms.FormCount",f=function(d){function f(a){var b=d.call(this,a)||this;return b.recyclebinRef=React.createRef(),b.state={SelectedGroup:c.getUxStateMaster().Model.GroupMaster,ShouldShowGroupCards:!1},b.shouldShowGroupCardsCallback=function(a){b.setState({ShouldShowGroupCards:a})},b.enterRecycleBin=b.enterRecycleBin.bind(b),b.ShowGroupCards=b.ShowGroupCards.bind(b),b.onModelChange=function(){return b.forceUpdate()},b.onGroupMasterSwitched=b.onGroupMasterSwitched.bind(b),b.onRecycleBinButtonClickCallback=b.onRecycleBinButtonClickCallback.bind(b),b.state.SelectedGroup&&b.state.SelectedGroup.observeGroupFormsChange(b.onModelChange),c.getUxStateMaster().observe(b.onGroupMasterSwitched,[c.UxStateFields.GroupMaster]),b}return __extends(f,d),f.getComponentClassName=function(){return"PortalViewGroupTab"},f.prototype.componentWillUnmount=function(){this.state.SelectedGroup&&this.state.SelectedGroup.unobserveGroupFormsChange(this.onModelChange),c.getUxStateMaster().unobserve(this.onGroupMasterSwitched)},f.prototype.render=function(){return React.createElement("div",__assign({},this.props.HTMLAttributes),this.createGroupList(),this.createFormsCard())},f.prototype.createGroupList=function(){var a=Forms.Mru.createGroupManager();return Forms.Mru.createDropdownGroupList(a,this.state.SelectedGroup,this.state.ShouldShowGroupCards,this.onGroupCardClick.bind(this),this.shouldShowGroupCardsCallback)},f.prototype.createFormsCard=function(){return this.state.SelectedGroup?this.createGroupFormsCards(this.state.SelectedGroup):a.EnvironmentConfig.isUSGovGccProd()?this.createViewMyGroupsCards():this.createGroupMruFormCards()},f.prototype.createGroupFormsCards=function(c){var d=Forms.Mru.createGroupFormsView(this.props.focusOut,c,b.Model.exportConverter(this.props.designExistingFormHandler));return a.Event.EngagementEventDeprecated.logData({extraData:{groupsFormCount:c.FormMasters.length,groupSoftdeletedFormCount:c.getFormMasterSoftDeteledForms().length},name:e}),React.DOM.div({className:"portal-group-forms"},d,this.createRecycleBinEntranceButton())},f.prototype.createViewMyGroupsCards=function(){var c={className:"discover-group-button",title:b.Resources.LocalizedStrings.PortalView_ViewMyGroups_Title_Text,onClick:this.ShowGroupCards},d=React.createElement(a.Control.createTextButton,{HTMLAttributes:c,Text:b.Resources.LocalizedStrings.PortalView_ViewMyGroups_Title_Text});return React.createElement("div",{className:"portal-other-form-warning-container"},this.createPotalWarningImage("../Images/fish-bowl.png"),React.createElement("div",{className:"portal-other-form-warning-title"},b.Resources.LocalizedStrings.PortalView_ViewMyGroups_Warning_Title),d)},f.prototype.createGroupMruFormCards=function(){if("Loaded"!==c.getUxStateMaster().Model.GroupMruFormListLoadState)return null;var d=this.createMruCards();if(d.length)return d;var e=(Forms.Mru.createGroupManager(),{className:"discover-group-button",title:b.Resources.LocalizedStrings.PortalView_RecentGroupForms_Warning_Button_Text,onClick:this.ShowGroupCards}),f=a.Control.createTextButton({HTMLAttributes:e,Text:b.Resources.LocalizedStrings.PortalView_RecentGroupForms_Warning_Button_Text});return React.DOM.div({className:"portal-other-form-warning-container"},this.createPotalWarningImage("../Images/fish-bowl.png"),React.DOM.div({className:"portal-other-form-warning-title"},b.Resources.LocalizedStrings.PortalView_RecentGroupForms_Warning_Title),f)},f.prototype.createMruCards=function(a){var c=this;return Forms.Mru.createMruPortalCards(this.props.GroupMruDocumentManager,{deleteForm:function(a){return c.props.deleteFormHandler(b.Model.exportConverter(a))},duplicateForm:function(a){throw Error("Not supported.")},openForm:function(a){return c.designExistingForm(b.Model.exportConverter(a))},removeFromMRU:function(a){return c.props.removeFromMRUHandler(b.Model.exportConverter(a))}},this.props.focusOut,a)},f.prototype.createRecycleBinEntranceButton=function(){if("Loaded"!==c.getUxStateMaster().Model.FormListLoadState)return null;var a=this.state.SelectedGroup.getFormMasterSoftDeteledForms().length;return React.createElement(Forms.UX.RecycleBin.RecycleBinEntranceButton,{GroupMaster:this.state.SelectedGroup,onClick:this.enterRecycleBin,RecycleBinFormCount:a,ref:this.recyclebinRef})},f.prototype.onGroupCardClick=function(a){c.getUxStateMaster().Model.GroupMaster=a},f.prototype.createPotalWarningImage=function(a){return React.DOM.div({className:"portal-other-form-warning-img-container"},React.DOM.img({className:"portal-other-form-warning-img",src:a}))},f.prototype.designExistingForm=function(b){if(b){var d=c.getUxStateMaster().Model;if(d.SearchContent)a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PortalPage.SearchForms.Click,extraData:{FormId:b.Model.Id}});else switch(d.FormCollectionType){case"OwnedForms":a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PortalPage.MyForms.Click,extraData:{FormId:b.Model.Id}});break;case"GroupForms":a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PortalPage.MyForms.Click,extraData:{FormId:b.Model.Id,IsGroupForms:!0}});break;case"SharedWithMe":a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PortalPage.OtherForms.Click,extraData:{FormId:b.Model.Id}})}}this.props.designExistingFormHandler(b)},f.prototype.enterRecycleBin=function(){var b=this.state.SelectedGroup.getFormMasterSoftDeteledForms().length;a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.RecycleBin.Navigate,extraData:{recycleBinformCount:b}}),c.getUxStateMaster().showTopView("RecycleBin",this.onRecycleBinButtonClickCallback)},f.prototype.ShowGroupCards=function(){this.setState({ShouldShowGroupCards:!0})},f.prototype.onGroupMasterSwitched=function(){var a=c.getUxStateMaster().Model.GroupMaster;this.state.SelectedGroup!==a&&(this.state.SelectedGroup&&this.state.SelectedGroup.unobserveGroupFormsChange(this.onModelChange),a&&a.observeGroupFormsChange(this.onModelChange),this.setState({SelectedGroup:a}))},f.prototype.onRecycleBinButtonClickCallback=function(){this.recyclebinRef.current&&this.state.SelectedGroup.getFormMasterSoftDeteledForms().length?this.recyclebinRef.current.focus():Forms.UX.Utilities.focusOnLastFfocusableElement(ReactDOM.findDOMNode(this))},f}(a.ReactComponent);c.PortalViewGroupTab=f}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(d){function e(a){return React.createElement(g,a)}function f(d){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PortalPage.MyForms.New,extraData:{Locale:OfficeFormServerInfo.cultureInfo.Name}});var e="Quiz"===d;e?a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PortalPage.MyForms.NewQuiz,extraData:{Locale:OfficeFormServerInfo.cultureInfo.Name}}):a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PortalPage.MyForms.NewForm,extraData:{Locale:OfficeFormServerInfo.cultureInfo.Name}});var f=c.getUxStateMaster().Model,g=c.AutoRename.getUniqueNameFromList(e?b.Resources.LocalizedStrings.Designer_DefaultQuizTitle:b.Resources.LocalizedStrings.Designer_DefaultFormTitle,b.Resources.LocalizedStrings.Designer_Title_autoRenameFormat,f.FormList.map(function(a){return a.Model.Title})),h=!!f.FormsTenantSettings&&!f.FormsTenantSettings.recordIdentityByDefault;return{Title:g,Settings:{IsQuizMode:e,RequiresUniqueResponse:e&&!OfficeFormServerInfo.userInfo.IsMsa,ShowGradedScores:e,IsAnonymous:OfficeFormServerInfo.userInfo.IsMsa,NotRecordIdentity:a.Flighting.Flight.isEnabled(a.Flighting.Flights.RecordIdentityAdminSetting)&&h}}}d.createPortalView=e;var g=function(e){function g(a){var b=e.call(this,a)||this;return b.footerRef=React.createRef(),b.mounted=!0,b.searchMessage="",b.recyclebinRef=React.createRef(),b.templateGalleryRef=React.createRef(),b.controlId=_.uniqueId("portal"),b.controlIdMyForms=b.controlId+"-myForms",b.controlIdSharedWithMe=b.controlId+"-sharedWithMe",b.controlIdGroupForms=b.controlId+"-groupForms",b.state={MenuExpanded:!1,ShouldShowQti:!1,SampleFormStatesLoaded:!1,TemplateGalleryStateLoaded:!1},b.createFormCallback=function(){return b.internalCreateAndDesignForm("Form")},b.createQuizCallback=function(){return b.internalCreateAndDesignForm("Quiz")},b.designExistingForm=b.designExistingForm.bind(b),b.duplicatedForm=b.duplicatedForm.bind(b),b.focusOutFormCard=b.focusOutFormCard.bind(b),b.hideSampleFormCard=b.hideSampleFormCard.bind(b),b.hideTemplateGallery=b.hideTemplateGallery.bind(b),b.internalCreateAndDesignForm=b.internalCreateAndDesignForm.bind(b),b.internalCreateRecycleBinView=b.internalCreateRecycleBinView.bind(b),b.internalCreateTemplateGalleryView=b.internalCreateTemplateGalleryView.bind(b),b.onRecycleBinButtonClickCallback=b.onRecycleBinButtonClickCallback.bind(b),b.onShowMoreTemplateClickCallback=b.onShowMoreTemplateClickCallback.bind(b),b.searchContentChangeCallBack=function(a){return b.onSearchContentChange(a)},b.showTemplateGallery=b.showTemplateGallery.bind(b),b}return __extends(g,e),g.prototype.componentWillMount=function(){var b=this;if(a.DataProvider.FeaturePlanProvider.isFormsProUser().then(Forms.FormsProRelated.ensureEnvironment).done(function(){return b.setState({FormsProLicenseChecked:!0})}),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PortalPage.MyForms.Navigate,extraData:"GroupForms"===c.getUxStateMaster().Model.FormCollectionType?{IsGroupForms:!0}:null}),this.formListChangeCallback=function(){b.mounted&&b.forceUpdate()},c.getUxStateMaster().observe(this.formListChangeCallback,[c.UxStateFields.FormList,c.UxStateFields.FormCollectionType,c.UxStateFields.SharedWithMeFormList,c.UxStateFields.GroupMruFormListLoadState,c.UxStateFields.SearchContent]),this.props.GroupMruDocumentManager.observeListChange(this.formListChangeCallback),this.enableQtiIfInSupportedSkuAndLocale(),(OfficeFormServerInfo.userInfo.IsMsa||!a.EnvironmentConfig.isOsi())&&a.Flighting.Flight.isEnabled(a.Flighting.Flights.UserSettings)){var d=Forms.Models.UserSettingsMaster.getInstance();d.ensureFieldsReady([d.Schema.SampleFormStates]).done(function(){b.mounted&&b.setState({SampleFormStatesLoaded:!0})}),this.setState({TemplateGalleryStateLoaded:!0})}},g.prototype.componentWillUnmount=function(){this.mounted=!1,c.getUxStateMaster().unobserve(this.formListChangeCallback),this.props.GroupMruDocumentManager.unobserveListChange(this.formListChangeCallback),this.shouldShowQtiCallback&&c.getUxStateMaster().unobserve(this.shouldShowQtiCallback)},g.prototype.componentDidMount=function(){this.duplicateFormFromOtherPage()},g.prototype.render=function(){return this.state.FormsProLicenseChecked?React.DOM.div({className:"portal-page"},d.createFormIntroductionDialog({createFormHandler:this.createFormCallback}),React.DOM.div({className:"portal-content-container",id:"portalContentContainer"},this.createTemplateGalleryContainer(),React.DOM.div({className:"portal-tiles"},React.DOM.div({className:"portal-titlebar-container",role:"navigation"},this.createFormCardsContainerHeaders(),React.createElement(Forms.UX.SearchBar,{onValueChange:this.searchContentChangeCallBack,Value:c.getUxStateMaster().Model.SearchContent})),this.createFormCardsContainer()),this.createLoadingPlaceholder(),this.createNPS(),React.createElement(Forms.UX.PortalFooter,{ref:this.footerRef}))):null},g.prototype.createTemplateGalleryContainer=function(){return React.DOM.div({className:"template-gallery-container"},React.createElement(Forms.UX.PortalViewMSATemplate,{createFormCallback:this.internalCreateAndDesignForm,hideTemplateGallery:this.hideTemplateGallery,internalCreateTemplateGalleryView:this.internalCreateTemplateGalleryView,showTemplateGallery:this.showTemplateGallery,templateGalleryStateLoaded:this.state.TemplateGalleryStateLoaded,viewTemplateHandler:b.Model.exportConverter(this.props.designExistingFormHandler)}))},g.prototype.showTemplateGallery=function(){this.setState({TemplateGalleryStateLoaded:!0})},g.prototype.hideTemplateGallery=function(){this.setState({TemplateGalleryStateLoaded:!1})},g.prototype.internalCreateTemplateGalleryView=function(){c.getUxStateMaster().showTopView("MSATemplateGallery",this.onShowMoreTemplateClickCallback)},g.prototype.createNPS=function(){return a.Flighting.Flight.isEnabled(a.Flighting.Flights.NetPromoteScore)?React.createElement(Forms.UX.OfficeNPS):null},g.prototype.onSearchContentChange=function(a){c.getUxStateMaster().Model.SearchContent=a},g.prototype.focusOutFormCard=function(a){if(this.footerRef.current){var b=ReactDOM.findDOMNode(this.footerRef.current);Forms.UX.Utilities.focusOut(a,b)}},g.prototype.duplicatedForm=function(a){var b=a.Model.OwnerId;"SharedWithMe"===c.getUxStateMaster().Model.FormCollectionType&&(c.getUxStateMaster().Model.FormCollectionType="OwnedForms",b=OfficeFormServerInfo.userInfo.UserId),this.props.duplicateFormHandler(a,{OwnerId:b,OwnerTenantId:a.Model.OwnerTenantId,IsGroupForm:a.IsGroupForm})},g.prototype.enableQtiIfInSupportedSkuAndLocale=function(){var b=this;a.Flighting.Flight.isEnabled(a.Flighting.Flights.IsQtiFeatureEnabled)&&null!=OfficeFormServerInfo&&null!=OfficeFormServerInfo.cultureInfo&&null!=OfficeFormServerInfo.cultureInfo.Name&&(a.Flighting.Flight.isEnabled(a.Flighting.Flights.EnableLorForAllLocales)||0===OfficeFormServerInfo.cultureInfo.Name.toLowerCase().indexOf("en"))&&a.DataProvider.FeaturePlanProvider.isEduUser().done(function(a){var d=!1;a&&(d=b.isEducationResourcesEnabledByO365TenantAdmin(),b.shouldShowQtiCallback=function(){var a=c.getUxStateMaster().Model.FormsTenantSettings,d=!!a&&!!a.educationResourcesEnabled;d!==b.state.ShouldShowQti&&(b.setState({ShouldShowQti:d}),b.forceUpdate())},c.getUxStateMaster().observe(b.shouldShowQtiCallback,[c.UxStateFields.FormsTenantSettings])),b.setState({ShouldShowQti:d})})},g.prototype.isEducationResourcesEnabledByO365TenantAdmin=function(){var a=c.getUxStateMaster().Model.FormsTenantSettings;return!!a&&!!a.educationResourcesEnabled},g.prototype.createTemporaryLORLauncherMenuTriggerButton=function(){return this.state.ShouldShowQti?React.DOM.div({className:"new-quiz-ellipsis-button-container"},a.Control.createMenuControl({MenuTriggerButton:{ClassName:"new-quiz-ellipsis-button",Description:b.Resources.LocalizedStrings.AnalyzeView_Menu_Button,ButtonStyle:a.Control.ButtonStyle.LightBackground,ChildrenContent:a.Control.createFontIconControl({IconName:"More",HTMLAttributes:{className:"forms-icon-size20x20"}})},UnorderListMenuItems:[{Checked:!1,Description:b.Resources.LocalizedStrings.PortalView_OpenLorTab_Button,Key:"Education Resource",onExecute:function(){var b=a.Utilities.Guid.newGuid();a.SafeStorage.SessionStorage.setItem("LorCorrelationId",b),a.Utilities.Html.safeOpen("../Pages/DesignPage.aspx#Store=true"),a.Event.EngagementEventDeprecated.logData({
name:a.Event.EngagementEventNames.PortalPage.MyForms.OpenStoreButton,extraData:{LorCorrelationId:b}})}}]})):void 0},g.prototype.createFormCardsContainer=function(){var a,b=c.getUxStateMaster().Model;if(b.SearchContent)return d.createSearchResultContainer({deleteForm:this.props.deleteFormHandler,focusOut:this.focusOutFormCard,softDeleteForm:this.props.softDeleteFormHandler,designExistingForm:this.designExistingForm.bind(this),duplicateForm:this.props.duplicateFormHandler,removeFromMRU:this.props.removeFromMRUHandler,changeFormOwner:this.props.changeFormOwnerHandler,GroupMruDocumentManager:this.props.GroupMruDocumentManager,SearchGroupForm:!0,SearchSharedForm:!0});switch(this.searchMessage="",b.FormCollectionType){case"OwnedForms":a=this.createOwnedFormCard();break;case"SharedWithMe":a=this.createSharedWithMeFormCard();break;case"GroupForms":a=this.createGroupTab();break;default:throw Error("The type is not valid.")}return React.DOM.div({className:"sub-tiles",role:"main"},React.DOM.div({className:"portal-search-live-region","aria-live":"polite"},this.searchMessage),a)},g.prototype.createFormCardsContainerHeaders=function(){var d=this,e=c.getUxStateMaster().Model;if(e.SearchContent)return React.DOM.div({className:"portal-title-button-container"},React.DOM.div({className:"portal-title selected"},b.Resources.LocalizedStrings.Portal_FormSearch_Title));var f="OwnedForms"===e.FormCollectionType,g=a.Control.createTextButton({HTMLAttributes:{id:this.controlIdMyForms,"aria-controls":f?this.controlIdMyForms+"-tab":void 0,className:f?"portal-title selected":"portal-title",role:"tab",tabIndex:f?0:-1,"aria-selected":f,onClick:function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PortalPage.MyForms.MyFormsButton}),e.FormCollectionType="OwnedForms",e.SearchContent=""},onKeyDown:function(b){b.keyCode===a.KeyCode.ArrowRight&&d.changeTabItemFocus(b,"MyForms","SharedForms")}},ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.PortalView_Title_Text,ref:"MyForms"}),h="SharedWithMe"===e.FormCollectionType,i=a.Control.createTextButton({HTMLAttributes:{id:this.controlIdSharedWithMe,"aria-controls":h?this.controlIdSharedWithMe+"-tab":void 0,className:h?"portal-title selected":"portal-title",role:"tab",tabIndex:h?0:-1,"aria-selected":h,onClick:function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PortalPage.OtherForms.OtherFormsButton}),e.FormCollectionType="SharedWithMe",e.SearchContent=""},onKeyDown:function(b){b.keyCode===a.KeyCode.ArrowRight?d.changeTabItemFocus(b,"SharedForms","GroupForms"):b.keyCode===a.KeyCode.ArrowLeft&&d.changeTabItemFocus(b,"SharedForms","MyForms")}},ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.PortalView_SharedWithMe_Title_Text,ref:"SharedForms"}),j="GroupForms"===e.FormCollectionType,k=a.Control.createTextButton({HTMLAttributes:{id:this.controlIdGroupForms,"aria-controls":j?this.controlIdGroupForms+"-tab":void 0,className:j?"portal-title selected":"portal-title",role:"tab",tabIndex:j?0:-1,"aria-selected":j,onClick:function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PortalPage.GroupFormsPortal.GroupFormsButton}),e.FormCollectionType="GroupForms",e.SearchContent=""},onKeyDown:function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PortalPage.GroupFormsPortal.GroupFormsButton}),b.keyCode===a.KeyCode.ArrowLeft&&d.changeTabItemFocus(b,"GroupForms","SharedForms")}},ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.PortalView_GroupForms_Title_Text,ref:"GroupForms"});return React.DOM.div({className:"portal-title-button-container",role:"tablist"},g,OfficeFormServerInfo.userInfo.IsMsa?void 0:i,!OfficeFormServerInfo.userInfo.IsMsa&&k)},g.prototype.changeTabItemFocus=function(a,b,c){a.stopPropagation(),a.preventDefault();var d=ReactDOM.findDOMNode(this.refs[b]),e=ReactDOM.findDOMNode(this.refs[c]);e&&(e.focus(),$(e).attr("tabindex",0),$(d).attr("tabindex",-1))},g.prototype.createOwnedFormCard=function(){var b;if(!a.Flighting.Flight.isEnabled(a.Flighting.Flights.MSATemplate)||!OfficeFormServerInfo.userInfo.IsMsa&&a.EnvironmentConfig.isOsi()){var c=React.createElement(Forms.UX.PortalViewCreateNewCard,{CreateNew:!0,focusOut:this.focusOutFormCard,IsGroupForm:!1,IsQuizMode:!1,onClick:this.createFormCallback});b=React.DOM.div({className:"portal-creating-card"},c,React.DOM.div({className:"creating-card-middle-line"}),React.createElement(Forms.UX.PortalViewCreateNewCard,{CreateNew:!0,focusOut:this.focusOutFormCard,IsGroupForm:!1,IsQuizMode:!0,Menu:this.createTemporaryLORLauncherMenuTriggerButton(),onClick:this.createQuizCallback}))}return React.DOM.div({id:this.controlIdMyForms+"-tab","aria-labelledby":this.controlIdMyForms},b,this.createSampleFormCards(),this.createFormPlaceholders(),this.createHistoryFormCards(),this.createRecycleBinEntranceButton())},g.prototype.createLoadingPlaceholder=function(){var d=c.getUxStateMaster().Model;return"Loaded"===d.FormListLoadState&&"OwnedForms"===d.FormCollectionType||"Loaded"===d.SharedWithMeFormListLoadState&&"SharedWithMe"===d.FormCollectionType||"GroupForms"===d.FormCollectionType&&("Loaded"===d.GroupMruFormListLoadState||a.EnvironmentConfig.isUSGovGccProd())?void 0:c.createLoadingPlaceholder({Message:b.Resources.LocalizedStrings.Page_LoadingMessage})},g.prototype.createFormPlaceholders=function(){var a=this;return c.getUxStateMaster().Model.PlaceholderList.sort(function(a,b){return Date.parse(b.Modified)-Date.parse(a.Modified)}).map(function(b,c){return React.createElement(Forms.UX.PortalViewPlaceHolderCard,{CreateNew:!1,focusOut:a.focusOutFormCard,Form:b,key:c})})},g.prototype.createSampleFormCards=function(){return a.Flighting.Flight.isEnabled(a.Flighting.Flights.MSASampleForm)&&(OfficeFormServerInfo.userInfo.IsMsa||!a.EnvironmentConfig.isOsi())&&this.state.SampleFormStatesLoaded?React.createElement(Forms.UX.PortalViewMySampleFormCard,{hideSampleForm:this.hideSampleFormCard,viewSampleForm:b.Model.exportConverter(this.props.designExistingFormHandler),sampleFormId:"PartyInvite"}):null},g.prototype.hideSampleFormCard=function(b){var c=_.extend({},Forms.Models.UserSettingsMaster.getInstance().Model.SampleFormStates);c=a.Utilities.tryParseJson(c),c[b]="Closed",Forms.Models.UserSettingsMaster.getInstance().Model.SampleFormStates=c,this.setState({SampleFormStatesLoaded:!1})},g.prototype.createHistoryFormCards=function(){var a=this,d="GroupForms"===c.getUxStateMaster().Model.FormCollectionType;if(d)return null;var e=c.getUxStateMaster().Model.FormListLoadState;if("Loaded"!==e)return null;var f=c.getUxStateMaster().Model.FormList,g=f.sort(function(a,b){return Date.parse(b.Model.Modified)-Date.parse(a.Model.Modified)}).map(function(c){return React.createElement(Forms.UX.PortalViewMyFormCard,{CreateNew:!1,focusOut:a.focusOutFormCard,FormMaster:b.Model.exportConverter(c),onClick:b.Model.exportConverter(a.designExistingForm),onDeleteClick:b.Model.exportConverter(a.props.deleteFormHandler),onSoftDeleteClick:b.Model.exportConverter(a.props.softDeleteFormHandler),onDuplicateClick:b.Model.exportConverter(a.duplicatedForm),onMoveClicked:b.Model.exportConverter(a.props.changeFormOwnerHandler),key:c.getInstanceId()})});return g.length?g:void 0},g.prototype.createSharedWithMeFormCard=function(){var a=this;if("Loaded"===c.getUxStateMaster().Model.SharedWithMeFormListLoadState){var d=c.getUxStateMaster().Model.SharedWithMeFormList.length;if(0===d)return React.DOM.div({id:this.controlIdSharedWithMe+"-tab","aria-labelledby":this.controlIdSharedWithMe,className:"portal-other-form-warning-container"},this.createPotalWarningImage("../Images/fish-bowl.png"),React.DOM.div({className:"portal-other-form-warning-title"},b.Resources.LocalizedStrings.PortalView_SharedWithMe_Warning_Title));var e=c.getUxStateMaster().Model.SharedWithMeFormList.sort(function(a,b){return Date.parse(b.Model.SharedDate)-Date.parse(a.Model.SharedDate)}).map(function(c){var d=c.getInstanceId();return React.createElement(Forms.UX.PortalViewMyFormCard,{CreateNew:!1,focusOut:a.focusOutFormCard,FormMaster:b.Model.exportConverter(c),onClick:b.Model.exportConverter(a.designExistingForm),onDeleteClick:b.Model.exportConverter(a.props.deleteFormHandler),onSoftDeleteClick:b.Model.exportConverter(a.props.softDeleteFormHandler),onDuplicateClick:b.Model.exportConverter(a.duplicatedForm),onMoveClicked:b.Model.exportConverter(a.props.changeFormOwnerHandler),key:d})});return React.DOM.div({id:this.controlIdSharedWithMe+"-tab","aria-labelledby":this.controlIdSharedWithMe},e)}},g.prototype.createGroupTab=function(){return c.createPortalViewGroupTab({HTMLAttributes:{id:this.controlIdGroupForms+"-tab","aria-labelledby":this.controlIdGroupForms,className:"portal-group-tab"},designExistingFormHandler:this.props.designExistingFormHandler,deleteFormHandler:this.props.deleteFormHandler,focusOut:this.focusOutFormCard,GroupMruDocumentManager:this.props.GroupMruDocumentManager,removeFromMRUHandler:this.props.removeFromMRUHandler})},g.prototype.createMruCards=function(a){var c=this;return Forms.Mru.createMruPortalCards(this.props.GroupMruDocumentManager,{deleteForm:function(a){return c.props.deleteFormHandler(b.Model.exportConverter(a))},duplicateForm:function(a){throw Error("Not supported.")},openForm:function(a){return c.designExistingForm(b.Model.exportConverter(a))},removeFromMRU:function(a){return c.props.removeFromMRUHandler(b.Model.exportConverter(a))}},this.focusOutFormCard,a)},g.prototype.createPotalWarningImage=function(a){return React.DOM.div({className:"portal-other-form-warning-img-container"},React.DOM.img({className:"portal-other-form-warning-img",src:a}))},g.prototype.createRecycleBinEntranceButton=function(){return"Loaded"!==c.getUxStateMaster().Model.FormListLoadState?null:React.DOM.div(null,React.createElement(Forms.UX.RecycleBin.RecycleBinEntranceButton,{GroupMaster:null,onClick:this.internalCreateRecycleBinView,ref:this.recyclebinRef,RecycleBinFormCount:c.getUxStateMaster().Model.RecycleBin.length}))},g.prototype.designExistingForm=function(b){if(b){var d=c.getUxStateMaster().Model;if(d.SearchContent)a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PortalPage.SearchForms.Click,extraData:{FormId:b.Model.Id}});else switch(d.FormCollectionType){case"OwnedForms":a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PortalPage.MyForms.Click,extraData:{FormId:b.Model.Id}});break;case"GroupForms":a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PortalPage.MyForms.Click,extraData:{FormId:b.Model.Id,IsGroupForms:!0}});break;case"SharedWithMe":a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PortalPage.OtherForms.Click,extraData:{FormId:b.Model.Id}})}}this.props.designExistingFormHandler(b)},g.prototype.internalCreateAndDesignForm=function(a){this.props.createAndDesignFormHandler(f(a))},g.prototype.internalCreateRecycleBinView=function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.RecycleBin.Navigate,extraData:{recycleBinformCount:c.getUxStateMaster().Model.RecycleBin.length}}),c.getUxStateMaster().showTopView("RecycleBin",this.onRecycleBinButtonClickCallback)},g.prototype.onFormListLoadStateChange=function(){var b=c.getUxStateMaster()&&c.getUxStateMaster().Model;if("Loaded"===b.FormListLoadState){var d=a.SafeStorage.SessionStorage.getItem("FormCopy.FormModelToJSON");d&&this.duplicateFormFromOtherPage()}},g.prototype.duplicateFormFromOtherPage=function(c){void 0===c&&(c=!1);var d=a.SafeStorage.SessionStorage,e=d.getItem("FormCopy.GUID");d.removeItem("FormCopy.GUID");var f=d.getItem("FormCopy.LoginToAutoCopy");f&&(d.removeItem("FormCopy.LoginToAutoCopy"),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PortalPage.MyForms.AutoLoginSuccess,extraData:{CopyCorelationID:e,Time:(new Date).toUTCString()}}));var g=d.getItem("FormCopy.FormModelToJSON");if(g&&(d.removeItem("FormCopy.FormModelToJSON"),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PortalPage.MyForms.ReadyToCopyForm,extraData:{CopyCorelationID:e,Time:(new Date).toUTCString()}}),!c))try{var h=JSON.parse(g);delete h.Id,h.Settings&&(delete h.Settings.AllowCopy,delete h.Settings.ShareToken,delete h.Settings.FormClosed,delete h.Settings.StartTime,delete h.Settings.EndTime,delete h.Settings.TimerEnabledStart,delete h.Settings.TimerEnabledEnd,delete h.Settings.TimerEnabled),a.DataProvider.FeaturePlanProvider.isMsaUser()&&!a.Flighting.Flight.isEnabled(a.Flighting.Flights.EnableOnlineExcelForMSA)&&delete h.XlWorkbookId,h.Title+=b.Resources.LocalizedStrings.Tile_For_Duplicate_Form,this.props.createAndDesignFormHandler(h,e)}catch(i){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PortalPage.MyForms.NewFromCopyFailure})}},g.prototype.onRecycleBinButtonClickCallback=function(){if(this.recyclebinRef.current&&c.getUxStateMaster().Model.RecycleBin.length)this.recyclebinRef.current.focus();else if(this.footerRef.current){var a=ReactDOM.findDOMNode(this.footerRef.current);Forms.UX.Utilities.focusOnLastFfocusableElement(ReactDOM.findDOMNode(this),a)}},g.prototype.onShowMoreTemplateClickCallback=function(){this.templateGalleryRef.current&&this.templateGalleryRef.current.focus()},g}(a.ReactComponent);d.createFormDefinition=f}(d=c.PortalPage||(c.PortalPage={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return React.createElement(e,a)}c.createRecycleBinView=d;var e=function(d){function e(){var a=null!==d&&d.apply(this,arguments)||this;return a.uxStateModel=c.getUxStateMaster().Model,a.update=function(){return a.forceUpdate()},a}return __extends(e,d),e.prototype.componentWillMount=function(){c.getUxStateMaster().observe(this.update,[c.UxStateFields.RecycleBin])},e.prototype.componentWillUnmount=function(){c.getUxStateMaster().unobserve(this.update)},e.prototype.render=function(){var a=this.getRecyceBinViewTitle(),c=b.Resources.LocalizedStrings.RecycleBin_TopView_Title.format(a);return React.createElement("div",{className:"recycleBinView-container","aria-label":c},React.createElement("div",{className:"portal-tiles recycleBin"},React.createElement("div",{className:"recycleBin-view-content"},this.createNavigationButton(),React.createElement("div",null,this.createPersonalFormsView(),this.createGroupFormsView()))))},e.prototype.getRecyceBinViewTitle=function(){return"GroupForms"===this.uxStateModel.FormCollectionType?b.Resources.LocalizedStrings.PortalView_GroupForms_Title_Text:b.Resources.LocalizedStrings.PortalView_Title_Text},e.prototype.createNavigationButton=function(){var d=this.getRecyceBinViewTitle(),e=b.Resources.LocalizedStrings.RecycleBin_TopView_Back.format(d),f=a.Control.createGlyphButton({ButtonStyle:"LightBackground",HTMLAttributes:{"aria-label":e,autoFocus:!0,className:"recycle-top-view-back-button office-form-theme-button-color",onClick:function(){c.getUxStateMaster().hideTopView()},title:e},Icon:"Back",IconClassName:"top-view-back-icon forms-icon-size24x24",ref:"back-button"}),g=b.Resources.LocalizedStrings.RecycleBin_TopView_Title.format(d);return React.createElement("div",{className:"recycle-top-view-header",role:"navigation"},f,React.createElement("span",{className:"top-view-title-text",title:g},g))},e.prototype.createPersonalFormsView=function(){return"GroupForms"===this.uxStateModel.FormCollectionType&&this.uxStateModel.GroupMaster?null:Forms.UX.RecycleBin.createRecycleBinPersonalFormsView(this.uxStateModel.RecycleBin.map(function(a){return b.Model.exportConverter(a)}),b.Model.exportConverter(this.props.deleteFormHandler),Forms.UX.Utilities.focusOut,b.Model.exportConverter(this.props.restoreFormHandler))},e.prototype.createGroupFormsView=function(){return"GroupForms"===this.uxStateModel.FormCollectionType&&this.uxStateModel.GroupMaster?Forms.UX.RecycleBin.createRecycleBinGroupFormsView(Forms.UX.Utilities.focusOut,this.uxStateModel.GroupMaster):null},e}(a.ReactComponent)}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(d){function e(a){return React.createElement(f,a)}d.createSearchResultContainer=e;var f=function(a){function d(b){var c=a.call(this,b)||this;return c.searchStrings=[],c.duplicatedForm=c.duplicatedForm.bind(c),c}return __extends(d,a),d.getComponentClassName=function(){return"SearchResultContainer"},d.prototype.componentWillMount=function(){var a=this,b=c.getUxStateMaster().Model;this.onGroupFormListChange=function(){return a.forceUpdate()};var d=b.GroupMaster;d&&d.observeGroupFormsChange(this.onGroupFormListChange)},d.prototype.componentWillUnmount=function(){var a=c.getUxStateMaster().Model.GroupMaster;a&&a.unobserveGroupFormsChange(this.onGroupFormListChange)},d.prototype.render=function(){var a=c.getUxStateMaster().Model;this.searchStrings=a.SearchContent.toLowerCase().split(" ").filter(function(a){return!!a});var b=this.searchedFormCards();return React.createElement("div",{className:"sub-tiles",role:"main"},this.searchContainerAriaLabel(b.length),b,this.noResultWarning(b.length))},d.prototype.duplicatedForm=function(a){return this.props.duplicateForm(a,{OwnerId:a.Model.OwnerId,OwnerTenantId:a.Model.OwnerTenantId,IsGroupForm:a.IsGroupForm})},d.prototype.searchContainerAriaLabel=function(a){var d=c.getUxStateMaster().Model;return React.createElement("div",{className:"portal-search-live-region","aria-live":"polite"},b.Resources.LocalizedStrings.Portal_FormSearch_Result_Screen_Reader_Message.format(a,d.SearchContent.toLowerCase()))},d.prototype.searchedFormCards=function(){if(this.searchStrings.length<1)return null;var a=c.getUxStateMaster().Model,b=[],d=this.myFormCards(),e=this.props.SearchGroupForm?this.groupFormCards():[],f=this.props.SearchSharedForm?this.sharedWithMeFormCards():[];switch(a.FormCollectionType){case"OwnedForms":b=b.concat(d,e,f);break;case"GroupForms":b=b.concat(e,d,f);break;case"SharedWithMe":b=b.concat(f,d,e);break;default:throw Error("The form type is invalid.")}return b},d.prototype.myFormCards=function(){var a=this,d=(this.props,c.getUxStateMaster().Model),e=[],f=d.FormList;return this.searchStrings.forEach(function(a){f=f.filter(function(b){return b.Model.Title.toLowerCase().indexOf(a)>=0})}),f.forEach(function(a){-1===e.indexOf(a)&&e.push(a)}),e.sort(function(a,b){return Date.parse(b.Model.Modified)-Date.parse(a.Model.Modified)}).map(function(c){return React.createElement(Forms.UX.PortalViewMyFormCard,{CreateNew:!1,focusOut:a.props.focusOut,FormMaster:b.Model.exportConverter(c),onClick:b.Model.exportConverter(a.props.designExistingForm),onDeleteClick:b.Model.exportConverter(a.props.deleteForm),onSoftDeleteClick:b.Model.exportConverter(a.props.softDeleteForm),onDuplicateClick:b.Model.exportConverter(a.duplicatedForm),onMoveClicked:b.Model.exportConverter(a.props.changeFormOwner),key:c.getInstanceId()})})},d.prototype.sharedWithMeFormCards=function(){var a=this,d=(this.props,c.getUxStateMaster().Model),e=[],f=_.clone(d.SharedWithMeFormList);return this.searchStrings.forEach(function(a){f=f.filter(function(b){return b.Model.Title.toLowerCase().indexOf(a)>=0||b.Model.SharedFormOwnerName&&b.Model.SharedFormOwnerName.toLowerCase().indexOf(a)>=0})}),f.forEach(function(a){-1===e.indexOf(a)&&e.push(a)}),e.sort(function(a,b){return Date.parse(b.Model.SharedDate)-Date.parse(a.Model.SharedDate)}),e.map(function(c){return React.createElement(Forms.UX.PortalViewMyFormCard,{CreateNew:!1,focusOut:a.props.focusOut,FormMaster:b.Model.exportConverter(c),onClick:b.Model.exportConverter(a.props.designExistingForm),onDeleteClick:b.Model.exportConverter(a.props.deleteForm),onSoftDeleteClick:b.Model.exportConverter(a.props.softDeleteForm),onDuplicateClick:b.Model.exportConverter(a.duplicatedForm),onMoveClicked:b.Model.exportConverter(a.props.changeFormOwner),key:c.getInstanceId()})})},d.prototype.groupFormCards=function(){var a=this.props,d=c.getUxStateMaster().Model,e=d.GroupMaster;return e?Forms.Mru.createSearchedGroupFormCards(e,b.Model.exportConverter(this.props.designExistingForm),this.props.focusOut,this.searchStrings):Forms.Mru.createMruPortalCards(a.GroupMruDocumentManager,{deleteForm:function(c){return a.deleteForm(b.Model.exportConverter(c))},duplicateForm:function(c){var e=b.Model.exportConverter(c);d.FormCollectionType="OwnedForms",a.duplicateForm(e,{OwnerId:c.Model.OwnerId,OwnerTenantId:c.Model.OwnerTenantId,IsGroupForm:b.Model.exportConverter(c).IsGroupForm})},openForm:function(c){return a.designExistingForm(b.Model.exportConverter(c))},removeFromMRU:function(c){return a.removeFromMRU(b.Model.exportConverter(c))}},this.props.focusOut,this.searchStrings)},d.prototype.noResultWarning=function(a){return a>0?null:React.createElement("div",{className:"portal-search-warning-container"},React.createElement("div",{className:"portal-search-warning-title"},b.Resources.LocalizedStrings.Portal_FormSearch_Warning_Message_1),React.createElement("div",{className:"portal-search-warning-message"},b.Resources.LocalizedStrings.Portal_FormSearch_Warning_Message_2))},d}(a.ReactComponent)}(d=c.PortalPage||(c.PortalPage={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(c){var d=function(){function c(){}return Object.defineProperty(c,"templateforms",{get:function(){b.Resources.LocalizedStrings;return[{Title:"Geography before class",Description:"",HasValidBranching:!1,HasQuestionMedia:!0,Questions:[{Id:"r812ee30afcb44d39b4dab8d1a46076bd",Type:b.Model.QuestionType.Choice,Title:"When does the rain season usually come for tropical grassland?",ImageInfo:{ContentType:"image/jpeg",FileIdentifier:"fdfccd4c-d520-4333-863b-062171c11801",OriginalFileName:"be539ccf-d023-4334-94a8-04a0a8a1f4d3",ResourceId:"f8cc4c3e-fe74-4efc-95ec-096f82d3ed85",ResourceUrl:a.Utilities.Html.getAbsoluteUrl("../Images/PortalTemplate/Template0/Question1.jpg")},Order:600,Deleted:!1,Subtitle:null,Required:!1,DefaultValue:null,IsQuiz:!0,HasValidBranching:!1,ImageSettings:{Layout:b.Model.ImageLayout.Horizontal,Size:b.Model.ImageSize.Large,NaturalWidth:800,NaturalHeight:438,ContainerWidth:719,ContainerHeight:394,ActualWidth:1159,ActualHeight:635,Left:-357,Top:-225},ChoiceType:1,Choices:[{Description:"Jun - Sep"},{Description:"May - Oct",IsAnswerKey:!0},{Description:"Jan - Mar"},{Description:"Apr - Jun"}],AllowOtherAnswer:!1},{Id:"r0f9903ec07d34ec8a4754028a87df681",Type:b.Model.QuestionType.TextField,Title:"Write down the name of this place",ImageInfo:{ContentType:"image/jpeg",FileIdentifier:"e8cb1683-262f-4de2-92cd-ae34389a72c0",OriginalFileName:"a1f414fd-7c11-443d-bbe2-28cd0aeeb27f",ResourceId:"2e784870-44e3-42d4-a985-c17383af83b7",ResourceUrl:a.Utilities.Html.getAbsoluteUrl("../Images/PortalTemplate/Template0/Question2.jpg")},Order:700,Deleted:!1,Subtitle:null,Required:!1,DefaultValue:null,IsQuiz:!1,HasValidBranching:!1,ImageSettings:{Layout:b.Model.ImageLayout.Horizontal,Size:b.Model.ImageSize.Small,NaturalWidth:800,NaturalHeight:450,ContainerWidth:314,ContainerHeight:177,ActualWidth:314.66666666666663,ActualHeight:177,Left:-.3333333333333144,Top:0}},{Id:"r9acfef5b2c6e4ba78551012212beaa64",Type:b.Model.QuestionType.Choice,Title:"What kind of animals are likely to live in this environment?",ImageInfo:{ContentType:"image/jpeg",FileIdentifier:"e960fe49-56e3-4b51-91d5-b6857380ebee",OriginalFileName:"6b176190-538a-4430-b730-b125495f1ee6",ResourceId:"c029ca69-a620-41eb-ab4e-5dc77692edc5",ResourceUrl:a.Utilities.Html.getAbsoluteUrl("../Images/PortalTemplate/Template0/Question3.jpg")},Order:900,Deleted:!1,Subtitle:null,Required:!1,DefaultValue:null,IsQuiz:!0,HasValidBranching:!1,ImageSettings:{Layout:b.Model.ImageLayout.Horizontal,Size:b.Model.ImageSize.Small,NaturalWidth:800,NaturalHeight:600,ContainerWidth:314,ContainerHeight:236,ActualWidth:315,ActualHeight:236,Left:0,Top:0},ChoiceType:2,Choices:[{Description:"Bear",IsAnswerKey:!0},{Description:"Wolf",IsAnswerKey:!0},{Description:"Camal"},{Description:"Penguin"}],AllowOtherAnswer:!1},{Id:"rbe5648b90ffa4799872ff76b7ee5384e",Type:b.Model.QuestionType.TextField,Title:"How is the arch formed?",ImageInfo:{ContentType:"image/jpeg",FileIdentifier:"74ba1cc9-a579-4b29-a139-3974a28d2526",OriginalFileName:"65953cb7-7ed0-4ff6-8210-4bf0955113e7",ResourceId:"1a234a48-8dfd-4ecf-8126-e9c67c1df03b",ResourceUrl:a.Utilities.Html.getAbsoluteUrl("../Images/PortalTemplate/Template0/Question4.jpg")},Order:1200,Deleted:!1,Subtitle:null,Required:!1,DefaultValue:null,IsQuiz:!1,HasValidBranching:!1,ImageSettings:{Layout:b.Model.ImageLayout.Horizontal,Size:b.Model.ImageSize.Small,NaturalWidth:800,NaturalHeight:532,ContainerWidth:314,ContainerHeight:209,ActualWidth:314.2857142857143,ActualHeight:209,Left:-.1428571428571388,Top:0}}],QuizQuestionsCount:2,Settings:{RequiresUniqueResponse:!1,IsAnonymous:!0,NotRecordIdentity:!0,ShowGradedResults:!0,ShowGradedScores:!1},Theme:{Name:"Bright_Green",PrimaryColor:"#82BA00",SecondaryColor:"#448715",BackgroundColor:"#F2F8E7"},Logo:{ContentType:"image/png",FileIdentifier:"8246eabe-46fb-4d80-829a-f69eedfaf755",OriginalFileName:"0b139297-bff5-4f19-9a18-500734e57903",ResourceId:"5ab76ac4-f404-4691-a0a4-d1745141963d",ResourceUrl:a.Utilities.Html.getAbsoluteUrl("../Images/PortalTemplate/Template0/Logo.png")},LogoInfo:{Layout:b.Model.ImageLayout.Square,Size:b.Model.ImageSize.Small,NaturalWidth:265,NaturalHeight:254,ContainerWidth:120,ContainerHeight:120,ActualWidth:125,ActualHeight:120,Left:-3,Top:0}},{Title:"Class Discussion Survey ",Description:"Is it difficult for you to participate in class discussion? For a quiet student, yes it may be, but it is still important to hear what you think. Take this quick survey to help us help you. :)",HasValidBranching:!1,HasQuestionMedia:!1,Questions:[{Id:"rb1dd64de2e854c228b66fa37ddace956",Type:b.Model.QuestionType.Choice,Title:"Which class did you take?",ImageInfo:{},Order:600,Deleted:!1,Subtitle:null,Required:!0,DefaultValue:"null",IsQuiz:!1,HasValidBranching:!1,ChoiceType:2,Choices:[{Description:"Creative Writing"},{Description:"Greek Mythology"},{Description:"Hemingway Short Stories"},{Description:"Zhuangzi Stories"}]},{Id:"r2316c930a87f47ea8eff2cd7b0ce78f7",Type:b.Model.QuestionType.Choice,Title:"Do you understand the class discussion rules?",ImageInfo:{},Order:700,Deleted:!1,Subtitle:null,Required:!1,DefaultValue:null,IsQuiz:!1,HasValidBranching:!1,ChoiceType:1,Choices:[{Description:"Yes",IsAnswerKey:!0},{Description:"No"}]},{Id:"rb18139d2d7754df79047bcb679b215ff",Type:b.Model.QuestionType.Choice,Title:"What stops you from participating in discussion?",ImageInfo:{},Order:1e3,Deleted:!1,Subtitle:null,Required:!0,DefaultValue:"null",IsQuiz:!1,HasValidBranching:!1,ChoiceType:2,Choices:[{Description:"Shy",IsAnswerKey:!0},{Description:"Afraid to look stupid"},{Description:"Not well prepared"},{Description:"Bad experience before"},{Description:"Too cool to talk "},{Description:"No prize"},{Description:"No idea"},{Description:"Cannot understand other's opinion"},{Description:"Topic is not interesting"}],AllowOtherAnswer:!0},{Id:"r4fe0c5031da244b888cf602a379b33b3",Type:b.Model.QuestionType.Choice,Title:"How much time do you participate in discussion each lesson?",ImageInfo:{},Order:1100,Deleted:!1,Subtitle:null,Required:!0,DefaultValue:"null",IsQuiz:!1,HasValidBranching:!1,ChoiceType:1,Choices:[{Description:"0-3 minutes",IsAnswerKey:!0},{Description:"3-5 minutes"},{Description:"5-10 minutes"},{Description:"10 or more minutes"}]},{Id:"r68124570a32348d783e425866e9d5f2e",Type:b.Model.QuestionType.Rating,Title:"Please self-evaluate how clearly you express your opinion in class discussion?",ImageInfo:{},Order:1400,Deleted:!1,Subtitle:null,Required:!0,DefaultValue:null,IsQuiz:!1,HasValidBranching:!1,ShowRatingLabel:!0,Length:10,RatingShape:b.Model.RatingShape.Number,LeftDescription:"lowest",RightDescription:"highest"},{Id:"r3a8d5a6ca4ae4334a3d37c1ea76974c3",Type:b.Model.QuestionType.Rating,Title:"Please self-evaluate your respect for others in class discussion?",ImageInfo:{},Order:1500,Deleted:!1,Subtitle:null,Required:!0,DefaultValue:null,IsQuiz:!1,HasValidBranching:!1,ShowRatingLabel:!0,Length:10,RatingShape:b.Model.RatingShape.Number,LeftDescription:"lowest",RightDescription:"highest"},{Id:"r9e5baab25c6c429eacdd9ed414aac23c",Type:b.Model.QuestionType.Choice,Title:"What do you get out of class discussion? ",ImageInfo:{},Order:1700,Deleted:!1,Subtitle:null,Required:!0,DefaultValue:"null",IsQuiz:!1,HasValidBranching:!1,ChoiceType:2,Choices:[{Description:"Learn to think from other points of view",IsAnswerKey:!0},{Description:"Listen to others "},{Description:"Confidence "},{Description:"Practice articulating myself clearly"},{Description:"Creative thinking"},{Description:"Get credit"}],AllowOtherAnswer:!0}],QuizQuestionsCount:0,Settings:{RequiresUniqueResponse:!1,IsAnonymous:!0,NotRecordIdentity:!0,ShowGradedResults:!1,ShowGradedScores:!1},Theme:{Name:"City01",PrimaryColor:"#3A501D",SecondaryColor:"#2A3B13",BackgroundColor:"#EAF4DC",BackgroundImage:"url(../Images/Theme/city01.png)"},Logo:{ContentType:"image/png",FileIdentifier:"e682f121-7823-43e8-bec6-11f6ed7ba337",OriginalFileName:"43050fe1-a81a-48b7-ae63-f91017dfbb31",ResourceId:"3035d81a-f188-4cd0-aa3c-46c0164d5607",ResourceUrl:a.Utilities.Html.getAbsoluteUrl("../Images/PortalTemplate/Template1/Logo.png")},LogoInfo:{Layout:b.Model.ImageLayout.Square,Size:b.Model.ImageSize.Small,NaturalWidth:120,NaturalHeight:120,ContainerWidth:120,ContainerHeight:120,ActualWidth:120,ActualHeight:120,Left:0,Top:0}},{Title:"Learning Session Survey Sample",Description:"Please fill this survey out to better help us meet your Professional Learning needs.  ",HasValidBranching:!1,HasQuestionMedia:!1,Questions:[{Id:"r7d8c678740784b6090b511f23ed0a5a8",Type:b.Model.QuestionType.Choice,Title:"Name of Session",ImageInfo:{},Order:675,Deleted:!1,ShowSubtitle:!1,Subtitle:"",Required:!1,DefaultValue:"null",IsQuiz:!1,HasValidBranching:!1,ChoiceType:1,Choices:[{Description:"Augmented and Virtual Reality in the Classroom"},{Description:"Technology Time Saves for the Elementary Classroom"},{Description:"Working with ADD/ADHD Students in the Classroom"},{Description:"One Driving Your Students to Success"}]},{Id:"r6e88625866d64237b5831b4d62fb9e98",Type:b.Model.QuestionType.Rating,Title:"This session was highly valuable.",ImageInfo:{},Order:700,Deleted:!1,ShowSubtitle:!0,Subtitle:"1 star = Strongly Disagree, 2 stars = Disagree, 3 stars = Neutral, 4 stars = Agree, 5 stars = Strongly Agree",Required:!0,DefaultValue:null,IsQuiz:!1,HasValidBranching:!1,Length:5,RatingShape:b.Model.RatingShape.Star,LeftDescription:"",RightDescription:""},{Id:"raa8916f894b94e20b260eb8a364fdad7",Type:b.Model.QuestionType.Rating,Title:"I can apply this content into my classroom next school year.",ImageInfo:{},Order:800,Deleted:!1,ShowSubtitle:!0,Subtitle:"1 star = Strongly Disagree, 2 stars = Disagree, 3 stars = Neutral, 4 stars = Agree, 5 stars = Strongly Agree",Required:!0,DefaultValue:null,IsQuiz:!1,HasValidBranching:!1,Length:5,RatingShape:b.Model.RatingShape.Star,LeftDescription:"",RightDescription:""},{Id:"rb834143b582741549f9c030e9bf750e0",Type:b.Model.QuestionType.Choice,Title:"Grade level(s) you work with?",ImageInfo:{},Order:900,Deleted:!1,ShowSubtitle:!0,Subtitle:"Select all that apply.",Required:!1,DefaultValue:null,IsQuiz:!1,HasValidBranching:!1,ChoiceType:2,Choices:[{Description:"PreK - K"},{Description:"1st - 2nd Grade"},{Description:"3rd - 4th Grade"},{Description:"5th Grade"},{Description:"6th - 8th Grade"},{Description:"9th - 12th Grade"}]},{Id:"r580be13e1fe94e739564ee9db11bc85e",Type:b.Model.QuestionType.TextField,Title:"Please list specific examples of ways you can use the content from this session to directly impact student learning.",
ImageInfo:{},Order:1e3,Deleted:!1,Subtitle:null,Required:!1,DefaultValue:null,IsQuiz:!1,HasValidBranching:!1,Multiline:!0},{Id:"r782208fea3bd478a9e86297fc2c48de6",Type:b.Model.QuestionType.TextField,Title:"Would you like to learn more about this topic if additional training was made available this summer and next school year?  Provide any specific needs you might have regarding additional training.",ImageInfo:{},Order:1100,Deleted:!1,Subtitle:null,Required:!1,DefaultValue:null,IsQuiz:!1,HasValidBranching:!1,Multiline:!0},{Id:"r8ba426b3685242b3af6762bb91e65bd3",Type:b.Model.QuestionType.TextField,Title:"Any additional comments, remarks, or follow up questions.",ImageInfo:{},Order:1200,Deleted:!1,Subtitle:null,Required:!1,DefaultValue:null,IsQuiz:!1,HasValidBranching:!1,Multiline:!0}],QuizQuestionsCount:0,Settings:{ShowGradedResults:!1,ShowGradedScores:!1},Logo:{}}]},enumerable:!0,configurable:!0}),c}();c.TemplateForm=d}(d=c.PortalPage||(c.PortalPage={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(){return React.createElement(e,null)}c.createQtiView=d;var e=function(d){function e(){return null!==d&&d.apply(this,arguments)||this}return __extends(e,d),e.prototype.isQtiFeatureEnabled=function(){return a.Flighting.Flight.isEnabled(a.Flighting.Flights.IsQtiFeatureEnabled)},e.prototype.render=function(){if(!this.isQtiFeatureEnabled())return null;var c=a.EnvironmentConfig.getLorPickerUrl(a.SafeStorage.SessionStorage.getItem("LorCorrelationId"));return React.createElement("div",{className:"lor-picker-modal",id:"lor-picker-modal"},React.createElement("iframe",{className:"lor-picker-frame",id:"lor-picker-frame",src:c,"aria-label":b.Resources.LocalizedStrings.QtiView_LorPicker_Aria_Label}))},e.prototype.componentDidMount=function(){$(window).on("message",e.receiveMessageFromLorCallback)},e.prototype.componentWillUnmount=function(){$(window).off("message",e.receiveMessageFromLorCallback)},e.validateEvent=function(a){return a&&a.originalEvent&&a.originalEvent.data&&null!=a.originalEvent.data.productId&&null!=a.originalEvent.data.url&&""!==a.originalEvent.data.url},e.receiveMessageFromLorCallback=function(b){var c=b.origin||b.originalEvent.origin;if(c===a.EnvironmentConfig.getLorPickerOrigin()&&e.validateEvent(b)){e.showFormCreationSpinner(),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.PortalPage.MyForms.NewQuizFromLor,extraData:{qtiData:b.originalEvent.data,LorCorrelationId:a.SafeStorage.SessionStorage.getItem("LorCorrelationId")}});var d={ProductId:b.originalEvent.data.productId,SkuId:b.originalEvent.data.skuId,Url:b.originalEvent.data.url},f=a.Flighting.Flight.isEnabled(a.Flighting.Flights.QtiFormCreationTimeout)?6e4:void 0;e.createFormFromQtiFile(d,f).done(function(a){e.redirectUserToForm(a)}).fail(function(a){e.redirectUserToErrorPage(a)})}},e.createFormFromQtiFile=function(b,c){var d=a.DataProvider.ProviderManager.getInstance(),e=d.CurrentQtiProvider.generateFormFromQtiFile(b);if(null==c)return e;var f=$.Deferred();return e.done(f.resolve).fail(f.reject).progress(f.notify),window.setTimeout(function(){return f.reject({innerCode:a.DataProvider.ErrorCode.InnerCode.FormCreationFromQTITimeout})},c),f.promise()},e.showFormCreationSpinner=function(){var a=c.getUxStateMaster(),d=a.Model,e=3e3,f=[b.Resources.LocalizedStrings.Qti_Spinner_StartImport,b.Resources.LocalizedStrings.Qti_Spinner_ImportQuestions,b.Resources.LocalizedStrings.Qti_Spinner_CreateForm,b.Resources.LocalizedStrings.Qti_Spinner_AlmostDone,b.Resources.LocalizedStrings.Qti_Spinner_DoubleCheck,b.Resources.LocalizedStrings.Qti_Spinner_AlmostDone],g=function(b){var c=b>0&&null==d.QtiFormCreationStatus;if(!c){a.startBulkEditMode(),d.QtiFormCreationStatus=f[b],a.endBulkEditMode();var h=b+1;h<f.length&&window.setTimeout(function(){return g(h)},e)}};a.startBulkEditMode(),d.Analysis=!1,d.Grading=void 0,d.Store=!1,g(0),a.endBulkEditMode()},e.redirectUserToForm=function(a){var b=c.getUxStateMaster(),d=b.Model;b.startBulkEditMode(),d.Analysis=!1,d.Grading=void 0,d.FormId=a.FormId,d.QtiFormCreationStatus=null,d.Store=!1,b.endBulkEditMode()},e.redirectUserToErrorPage=function(b){var d=c.getUxStateMaster(),e=d.Model,f=b||{};void 0===f.innerCode&&(f.innerCode=a.DataProvider.ErrorCode.InnerCode.FormCreationFromQTIFailed),d.startBulkEditMode(),e.CriticalError=f,e.Analysis=!1,e.Grading=void 0,e.QtiFormCreationStatus=null,e.Store=!1,d.endBulkEditMode()},e}(a.ReactComponent)}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(){function c(){}return c.getComponentClassName=function(){return"TeachingCallout"},c.createCallout=function(b,c,d,e,f){return React.createElement("div",{className:"firstrun-callout-container"},React.createElement("div",{id:e,className:"firstrun-callout"},React.createElement("div",{className:a.Utilities.Html.combineAttributes("firstrun-callout-beak",f)}),React.createElement("div",{className:"teaching-callout-text-wrap"},b),React.createElement("div",{className:"teaching-callout-img-wrap"},c),d))},c.createText=function(a){return React.createElement("div",{className:"teaching-callout-text"},a)},c.createImage=function(a){return React.createElement("img",{className:"teaching-callout-img",src:a,alt:b.Resources.LocalizedStrings.AltText_Gif})},c.createClostButton=function(c){return a.Control.createTextButton({HTMLAttributes:{className:"teaching-callout-button",onClick:c},Text:b.Resources.LocalizedStrings.TeachingUi_GotIt,ButtonStyle:a.Control.ButtonStyle.LightBackground})},c.isVersionOk=function(a){var d=parseInt(a);b.Model.getUserProfileMaster();return isNaN(d)||d<c.MAXRUNVERSION},c.MAXRUNVERSION=2,c}();c.TeachingCalloutUtilities=d}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(d){function e(a){return React.createElement(f,__assign({},a))}d.createExportToExcelTeachingCallout=e;var f=function(a){function d(){var b=null!==a&&a.apply(this,arguments)||this;return b.observeFieldsChangeCallback=function(){return b.forceUpdate()},b}return __extends(d,a),d.prototype.componentDidMount=function(){var a=b.Model.getUserProfileMaster();a.observe(this.observeFieldsChangeCallback,[b.Model.UserProfileMaster.Schema.ExportToExcelCalloutVersion])},d.prototype.componentWillUnmount=function(){var a=b.Model.getUserProfileMaster();a.unobserve(this.observeFieldsChangeCallback)},d.prototype.render=function(){var a=b.Model.getUserProfileMaster().Model;if(c.TeachingCalloutUtilities.isVersionOk(a.ExportToExcelCalloutVersion)){var d=c.TeachingCalloutUtilities.createText(b.Resources.LocalizedStrings.TeachingUI_Export_To_Excel),e=c.TeachingCalloutUtilities.createImage("../Images/export-to-excel.gif"),f=c.TeachingCalloutUtilities.createClostButton(function(){return a.ExportToExcelCalloutVersion=c.TeachingCalloutUtilities.MAXRUNVERSION.toString()});return c.TeachingCalloutUtilities.createCallout(d,e,f,"teachingCallout-exportToExcel","teachingCallout-exportToExcel-direction")}return null},d}(a.ReactComponent)}(d=c.Teaching||(c.Teaching={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(d){function e(a){return React.createElement(f,__assign({},a))}d.createNewFormTeachingCallout=e;var f=function(a){function d(){var b=null!==a&&a.apply(this,arguments)||this;return b.observeUserProfileFieldsChangeCallback=function(){return b.forceUpdate()},b}return __extends(d,a),d.prototype.componentDidMount=function(){b.Model.getUserProfileMaster().observe(this.observeUserProfileFieldsChangeCallback,[b.Model.UserProfileMaster.Schema.NewFormTeachingCalloutVersion])},d.prototype.componentWillUnmount=function(){b.Model.getUserProfileMaster().unobserve(this.observeUserProfileFieldsChangeCallback)},d.prototype.render=function(){if(!c.TeachingCalloutUtilities.isVersionOk(b.Model.getUserProfileMaster().Model.NewFormTeachingCalloutVersion))return null;var a=c.TeachingCalloutUtilities.createText(b.Resources.LocalizedStrings.FirstRun_Callout_NewFormButton_Text),d=c.TeachingCalloutUtilities.createImage("../Images/newForm.gif"),e=c.TeachingCalloutUtilities.createClostButton(function(){var a=b.Model.getUserProfileMaster().Model;a.NewFormTeachingCalloutVersion=c.TeachingCalloutUtilities.MAXRUNVERSION.toString()});return c.TeachingCalloutUtilities.createCallout(a,d,e,"teachingCallout-newForm","teachingCallout-newForm-direction")},d}(a.ReactComponent)}(d=c.Teaching||(c.Teaching={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(d){function e(a){return React.createElement(f,__assign({},a))}d.createSendTeachingCallout=e;var f=function(a){function d(){var c=null!==a&&a.apply(this,arguments)||this;return c.observeUserProfileFieldsChangeCallback=function(){c.forceUpdate(),c.props.form.unobserve(c.observeQuestionFieldChangeCallback)},c.observeQuestionFieldChangeCallback=function(a){if(c.props.form.isFieldReady(b.Model.FormMaster.Schema.Questions)){var d=!!(a.OldValues.Questions||[]).length,e=!!a.Master.Model.Questions.length;d!==e&&c.forceUpdate()}},c}return __extends(d,a),d.prototype.componentDidMount=function(){var a=b.Model.getUserProfileMaster();a.observe(this.observeUserProfileFieldsChangeCallback,[b.Model.UserProfileMaster.Schema.SendTeachingCalloutVersion]),this.props.form.observe(this.observeQuestionFieldChangeCallback,[b.Model.FormMaster.Schema.Questions])},d.prototype.componentWillUnmount=function(){var a=b.Model.getUserProfileMaster();a.unobserve(this.observeUserProfileFieldsChangeCallback),this.props.form.unobserve(this.observeQuestionFieldChangeCallback)},d.prototype.render=function(){if(!c.TeachingCalloutUtilities.isVersionOk(b.Model.getUserProfileMaster().Model.SendTeachingCalloutVersion))return null;var a=null;return this.props.form.isFieldReady(b.Model.FormMaster.Schema.Questions)&&this.props.form.Model.Questions.length&&(a=this.createCallout("teachingCallout-send","teachingCallout-send-direction")),a},d.prototype.createCallout=function(a,d){var e=b.Resources.LocalizedStrings.FirstRun_Callout_ShareButton_Text,f=c.TeachingCalloutUtilities.createText(e),g=c.TeachingCalloutUtilities.createClostButton(function(){var a=b.Model.getUserProfileMaster().Model;a.SendTeachingCalloutVersion=c.TeachingCalloutUtilities.MAXRUNVERSION.toString()}),h=c.TeachingCalloutUtilities.createImage("../Images/send-form.gif");return c.TeachingCalloutUtilities.createCallout(f,h,g,a,d)},d}(a.ReactComponent)}(d=c.Teaching||(c.Teaching={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(c){function d(){return React.createElement(e)}c.createWhatsNewPannel=d;var e=function(c){function d(a){var e=c.call(this,a)||this,f=b.Model.getUserProfileMaster().Model,g=!1,h=parseInt(f.WhatsNewVersion);return(isNaN(h)||h<d.MAXRUNVERSION)&&(g=!0),e.state={ShowFirstRun:g,currentIndex:0},e}return __extends(d,c),d.prototype.render=function(){if(!this.state.ShowFirstRun)return null;var a=this.createNewsItem();return React.DOM.div({className:"first-run"},a)},d.prototype.createNewsItem=function(){var c=this,e=[this.createNewsPage({title:b.Resources.LocalizedStrings.FirstRun_WhatsNew_ImageIntro,image:"..//Images//WhatsNew//intro_image.png"})],f=React.DOM.div({key:"content"},e[this.state.currentIndex]),g=b.Model.getUserProfileMaster().Model,h=a.Control.createGlyphButton({HTMLAttributes:{className:"close-button",title:b.Resources.LocalizedStrings.FirstRun_WhatsNew_Close,onClick:function(){g.WhatsNewVersion=d.MAXRUNVERSION.toString(),c.setState({ShowFirstRun:!1})}},GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly,ButtonStyle:a.Control.ButtonStyle.LightBackground,Icon:"Cancel",key:"close-button"});return React.DOM.div({className:"float-center",onKeyDown:function(a){27===a.keyCode&&(g.WhatsNewVersion=d.MAXRUNVERSION.toString(),c.setState({ShowFirstRun:!1}))}},f,h)},d.prototype.createNewsPage=function(a){return React.DOM.div(null,React.DOM.p({className:"whats-new-title",title:a.title},a.title),React.DOM.img({className:"news-img",src:a.image}))},d.MAXRUNVERSION=2,d}(a.ReactComponent)}(d=c.Teaching||(c.Teaching={}))}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){function c(a){return React.createElement(f,__assign({},a))}var d;!function(a){a[a.Up=0]="Up",a[a.Down=1]="Down"}(d=b.TipBarLocation||(b.TipBarLocation={}));var e;!function(a){a[a.WhiteBackground=0]="WhiteBackground",a[a.YellowBackground=1]="YellowBackground"}(e=b.TipBarStyle||(b.TipBarStyle={})),b.createTipBar=c;var f=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.render=function(){return React.createElement("div",null,this.createTipBar())},c.prototype.createTipBar=function(){var b=this.props,c="tipbar-container";b.TipBarLocation===d.Up&&(c=a.Utilities.Html.combineAttributes(c,"tipbar-location-up")),b.TipBarLocation===d.Down&&(c=a.Utilities.Html.combineAttributes(c,"tipbar-location-down")),c=b.TipBarStyle===e.YellowBackground?a.Utilities.Html.combineAttributes(c,"tipbar-style-yellow"):a.Utilities.Html.combineAttributes(c,"tipbar-style-white");var f=null;if(b.TipBarIconClassName){var g=a.Utilities.Html.combineAttributes("tipbar-info-icon",b.TipBarIconClassName);f=React.DOM.span({className:g})}var h,i=React.DOM.span({className:"tipbar-limit-content"},b.Info);b.HrefInfo&&(h=React.DOM.a({className:"tipbar-limit-content tipbar-limit-href",onClick:function(){return b.onClickHerf()}},b.HrefInfo));var j=null;return b.ShouldClose&&(j=a.Control.createGlyphButton({HTMLAttributes:{className:"tipbar-close",onClick:b.onClose},Icon:"Cancel",IconClassName:"forms-icon-size14x14",ButtonStyle:a.Control.ButtonStyle.LightBackground,GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly})),React.DOM.div({className:c,id:b.Id},j,React.DOM.div({className:"tipbar-content"},React.DOM.div({className:"tipbar-txt-content"},f,i,h)))},c}(a.ReactComponent);b.TipBar=f}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;return a.adjustBranchSelectorsCallback=function(){return a.adjustBranchSelectors()},a.setAsActiveCallback=function(){a.props.Active||a.props.setAsActive()},a.update=function(){return a.forceUpdate()},a}return __extends(d,c),d.prototype.componentWillMount=function(){var a=this.props.Question;this.questionRuntimeModel=new b.Model.QuestionRuntimeMaster(a,null)},d.prototype.componentDidMount=function(){this.adjustBranchSelectors(),$(window).resize(this.adjustBranchSelectorsCallback),this.props.Question.observe(this.update)},d.prototype.componentWillUnmount=function(){$(window).unbind("resize",this.adjustBranchSelectorsCallback),this.props.Question.unobserve(this.update)},d.prototype.componentDidUpdate=function(){this.adjustBranchSelectors()},d.prototype.render=function(){var b=this.props.Question,c={className:"branch-design-question-card",onClick:this.setAsActiveCallback,onFocus:this.setAsActiveCallback,key:b.Model.Id};this.props.Active&&(c.className=a.Utilities.Html.combineAttributes(c.className,"active","office-form-theme-border-top"));var d="branch-design-card",e={Master:this.questionRuntimeModel,Ordinal:this.props.Ordinal,DisableShuffle:!0,Disabled:!0,DisableFormulaLinebreak:!0,ExpandAll:!0,HiddenPoint:!0,ShowDesignInfo:!0,HideMedia:!0,onHeightChange:this.adjustBranchSelectorsCallback,ref:"question-renderer"};return React.DOM.div(c,Forms.UX.Renderer.createRendererElement(e),React.DOM.div({className:d,ref:"branch-design-card"},this.createBranchSelectorGroup(b)))},d.prototype.createBranchSelectorGroup=function(a){var b=this,c=[],d=a.Model;return a.supportsQuestionLevelBranching()&&c.push(this.createBranchSelector(d.BranchInfo)),a.supportsChoiceLevelBranching()&&(c=c.concat(_.map(a.Model.Choices,function(a){return b.createBranchSelector(a.BranchInfo)})),d.AllowOtherAnswer&&c.push(this.createBranchSelector(a.Model.BranchInfoForOtherChoice))),c},d.prototype.createBranchSelector=function(a){var c=this,d=b.Model.getBranchInfoMaster(a),e=d.getInstanceId();return this.props.Active||!d.isDefault()?React.createElement(Forms.UX.Designer.BranchSelector,{Master:b.Model.exportConverter(d),key:e,ref:e}):React.createElement("div",{className:"placeholder",key:e,tabIndex:0,onFocus:function(){c.props.setAsActive(function(){var a=ReactDOM.findDOMNode(c.refs[e]);a&&$(a).find(".select-control").focus()})}})},d.prototype.adjustBranchSelectors=function(){var a=this,b=$(ReactDOM.findDOMNode(this.refs["question-renderer"])),c=$(ReactDOM.findDOMNode(this.refs["branch-design-card"]));if(b.length&&c.length){var d=b.offset().top,e=this.props.Question;if(e.supportsQuestionLevelBranching()){var f=b.find(".office-form-question-title");this.adjustBranchSelector(e.Model.BranchInfo,f,d)}if(e.supportsChoiceLevelBranching()){var g=b.find(".office-form-question-choice"),h=e.Model.Choices;if(g.each(function(b,c){a.adjustBranchSelector(h[b].BranchInfo,$(c),d)}),e.Model.AllowOtherAnswer){var i=b.find(".office-form-other-answer");this.adjustBranchSelector(e.Model.BranchInfoForOtherChoice,i,d)}}}},d.prototype.adjustBranchSelector=function(a,c,d){var e=c.offset().top-d+c.outerHeight()/2,f=b.Model.getBranchInfoMaster(a),g=$(ReactDOM.findDOMNode(this.refs[f.getInstanceId()]));g.length&&g.css("top",e-g.outerHeight()/2)},d}(a.ReactComponent);c.BranchingDesignQuestionCard=d}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(d){function e(){return null!==d&&d.apply(this,arguments)||this}return __extends(e,d),e.prototype.getContainerProps=function(){var b=this.props,c=_.extend({},b.HTMLAttributes);return c.className=a.Utilities.Html.combineAttributes(c.className,"top-view-container"),c},e.prototype.onBackButtonClick=function(){},e.prototype.createHeader=function(){for(var d=this,e=[],f=0;f<arguments.length;f++)e[f]=arguments[f];var g=void 0;a.EnvironmentSettings.IsAssignmentsIntegration||(g=a.Control.createGlyphButton({HTMLAttributes:{className:"top-view-back-button office-form-theme-button-color",onClick:function(){c.getUxStateMaster().Model.TopView="None",d.onBackButtonClick()},autoFocus:!0},ButtonStyle:a.Control.ButtonStyle.LightBackground,Icon:"Back",IconClassName:"top-view-back-icon "+(a.EnvironmentSettings.IsExternalIntegration?"forms-icon-size16x16":"forms-icon-size18x18"),Text:b.Resources.LocalizedStrings.DesignPage_TopView_Back,TextClassName:"top-view-back-text",ref:"back-button"}));var h=[{className:"top-view-header",role:"navigation"},g];return React.DOM.div.apply(React.DOM,h.concat(e))},e}(a.ReactComponent);c.TopViewBase=d}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return React.createElement(e,__assign({},a))}c.createBranchingDesignView=d;var e=function(d){function e(){var a=null!==d&&d.apply(this,arguments)||this;return a.mounted=!0,a.update=function(){return a.forceUpdate()},a}return __extends(e,d),e.prototype.componentDidMount=function(){var c=this,d=this.props.Form;d.ensureReadyToDesign().done(function(){c.mounted&&(d.observe(c.update,[b.Model.FormMaster.Schema.Questions]),c.setState({FormReadyForDesign:!0,ElementInDesignMode:d.FormElementManager.QuestionMasters[0]}))}),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Branch.BranchDesignViewNavigate})},e.prototype.componentWillUnmount=function(){this.mounted=!1,this.props.Form.unobserve(this.update)},e.prototype.render=function(){var a,d=this.state;return a=d.FormReadyForDesign?React.DOM.div({className:"office-form-page-padding branch-design-view-container"},React.DOM.div({className:"branch-design-view office-form-theme-border-top"},this.createTitleBar(),this.createDesignContent(),React.createElement(Forms.UX.Renderer.ThemeRender,{ThemeMaster:this.props.Form.ThemeMaster}))):c.createLoadingPlaceholder({Message:b.Resources.LocalizedStrings.DesignPage_LoadingForm}),React.DOM.div(this.getContainerProps(),this.createHeader(),React.DOM.div({className:"top-view-content"},a))},e.prototype.createTitleBar=function(){return React.DOM.div({className:"branch-design-view-title-bar"},React.DOM.div({className:"branch-design-view-title office-form-theme-primary-foreground"},b.Resources.LocalizedStrings.DesignPage_BranchingDesignViewTitle),this.createMoreOptions())},e.prototype.createMoreOptions=function(){var c,d=this,e=function(b){var c=ReactDOM.findDOMNode(d.refs["options-menu"]),e=ReactDOM.findDOMNode(d.refs["options-button"]),f=a.Utilities.Html.getTargetElementOfFocusEvent(b);e!==f&&c&&!c.contains(f)&&d.setState({MoreOptionsExpanded:!1})},f=function(b){b.keyCode===a.KeyCode.Esc&&b.keyCode===a.KeyCode.Esc&&d.state.MoreOptionsExpanded&&d.setState({MoreOptionsExpanded:!1},function(){var a=ReactDOM.findDOMNode(d.refs["options-button"]);a.focus()})};if(this.state.MoreOptionsExpanded){var g=a.Control.createTextButton({ButtonStyle:a.Control.ButtonStyle.LightBackground,HTMLAttributes:{className:"branch-design-view-options-menu-item",onClick:function(){d.setState({MoreOptionsExpanded:!1}),d.props.Form.resetBranchInfo();var a=ReactDOM.findDOMNode(d.refs["options-button"]);a.focus()}},Text:b.Resources.LocalizedStrings.Branch_ResetToDefault});c=React.DOM.div({className:"branch-design-view-options-menu-container"},React.DOM.div({className:"branch-design-view-options-menu",onBlur:e,onKeyDown:f,ref:"options-menu"},g))}return React.DOM.div({className:"branch-design-view-options"},a.Control.createGlyphButton({Icon:"More",IconClassName:"forms-icon-size18x18",ButtonStyle:a.Control.ButtonStyle.LightBackground,GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly,Text:b.Resources.LocalizedStrings.DesignPage_BranchingDesignView_MoreOptions,HTMLAttributes:{className:"branch-design-view-options-button",onClick:function(){return d.setState({MoreOptionsExpanded:!d.state.MoreOptionsExpanded})},onBlur:e,onKeyDown:f},ref:"options-button"}),c)},e.prototype.createDesignContent=function(){var a=this,b=this.props.Form;b.getDefaultResponse();return b.FormElementManager.TopQuestionMasters.map(function(b,d){return React.createElement(c.BranchingDesignQuestionCard,{Question:b,Active:b===a.state.ElementInDesignMode,Ordinal:d+1,key:b.Model.Id,setAsActive:function(){return a.setState({ElementInDesignMode:b})}})})},e}(c.TopViewBase)}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){function b(a){return"Grading_ReviewAnswers"===a.TopView?OfficeFormGrading.Public.createFormGradingView(a.FormMaster,a.Grading):"Grading_PostGrades"===a.TopView?OfficeFormGrading.Public.createFormGradingReleaseResultView(a.FormMaster):"SurveyResults"===a.TopView?OfficeFormGrading.Public.createFormSurveyResultsTopView(a.FormMaster):void 0}a.createGradingAndSurveyResult=b}(b=a.DesignPage||(a.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return React.createElement(e,__assign({},a))}c.createPreviewContainer=d;var e=function(d){function e(e){var f=d.call(this,e)||this,g=c.getUxStateMaster().Model.Preview,h=g&&g.ViewModeIndex,i=a.Utilities.isMobile()?b.ViewMode.Mobile:b.ViewMode.Desktop;return f.state={ViewMode:void 0!=h?h:i,FormLoaded:!1},f}return __extends(e,d),e.prototype.componentDidMount=function(){var a=this,b=this.props.Form;b&&b.ensureReadyToResponse().then(function(){return void 0!=a.props.ResponseIndex?a.props.Form.syncFormResponses():void 0}).done(function(){a.setState({FormLoaded:!0})})},e.prototype.render=function(){var b,d=this,e=a.Utilities.isMobile();return e||(b=c.createPreviewSettingPane({Value:this.state.ViewMode,onValueChange:function(a){d.setState({ViewMode:a});var b=c.getUxStateMaster(),e=b.Model.Preview;b.startBulkEditMode(),b.Model.Preview={ResponseIndex:e&&e.ResponseIndex,ViewModeIndex:a,PreviousTopView:e&&e.PreviousTopView||"None"},b.endBulkEditMode()}})),React.DOM.div(this.getContainerProps(),this.createHeader(b),this.createContent(e))},e.prototype.createContent=function(d){if(!this.state.FormLoaded)return c.createLoadingPlaceholder({Message:b.Resources.LocalizedStrings.DesignPage_LoadingForm});var e,f=this.props.Form.Model.Responses[this.props.ResponseIndex],g=void 0!=this.props.ResponseIndex,h={Master:this.props.Form,DisableSubmitButton:!1,HTMLAttributes:{className:"preview-form"},ViewMode:this.state.ViewMode,Response:g?f:void 0,HeaderMessage:g&&b.Resources.LocalizedStrings.PreviewStudentFeedbackView_StudentName_Label.format(f.ResponderName),HideSubmitAnotherResponseLink:g};e=b.CategoryExtensionPoints.supportsExtensionPoint(this.props.Form,b.ExtensionPoints.ResponsePagePollView)?b.createPollRenderer(h):b.createFormRenderer(h);var i={className:"top-view-content"},j={className:"form-content"};return this.state.ViewMode!==b.ViewMode.Mobile||d?i.className=a.Utilities.Html.combineAttributes(i.className,"office-form-theme-page-background"):j.className=a.Utilities.Html.combineAttributes(j.className,"preview-mobile-container","office-form-theme-page-background"),React.createElement("div",__assign({},i),React.createElement("div",__assign({},j),e))},e.prototype.onBackButtonClick=function(){var a=c.getUxStateMaster(),b=a.Model.Preview;a.startBulkEditMode(),a.Model.TopView=b&&b.PreviousTopView||"None",a.Model.Preview=void 0,a.endBulkEditMode()},e}(c.TopViewBase)}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return React.createElement(e,a)}c.createPreviewSettingPane=d;var e=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.render=function(){var b=_.extend({},this.props.HTMLAttributes,{id:"preview-setting-pane"});return b.className=a.Utilities.Html.combineAttributes("preview-setting-pane",b.className),React.DOM.div(b,this.createViewModeButtons())},d.prototype.createViewModeButtons=function(){return[this.createDeviceSwitchButton(b.ViewMode.Desktop,"TVMonitor",b.Resources.LocalizedStrings.Response_Preview_DeviceType_Desktop),this.createDeviceSwitchButton(b.ViewMode.Mobile,"CellPhone",b.Resources.LocalizedStrings.Response_Preview_DeviceType_Mobile)]},d.prototype.createDeviceSwitchButton=function(c,d,e){var f=this;return a.Control.createGlyphButton({HTMLAttributes:{className:"preview-mode-button office-form-theme-button-color office-form-theme-select-color",onClick:function(){f.props.onValueChange(c),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Preview.Navigate,extraData:{previewMode:b.ViewMode[c]}})}},ButtonStyle:a.Control.ButtonStyle.LightBackground,ToggleActive:c===this.props.Value,Icon:d,IconClassName:a.EnvironmentSettings.IsExternalIntegration?"forms-icon-size16x16":"forms-icon-size20x20",Text:e,TextClassName:"preview-mode-button-text",key:b.ViewMode[c]})},d}(a.ReactComponent)}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return React.createElement(e,__assign({},a))}c.createQRPlusView=d;var e=function(d){function e(a){var b=d.call(this,a)||this;return b.clipboardList=[],b.state.QRCodeScriptsLoaded=!1,b.state.FormReadyForDesign=!1,b.isClipboardBinded=!1,b}return __extends(e,d),e.prototype.componentWillMount=function(){var b=this;a.JavaScriptLoader.loadJavaScript("FileSave").done(function(){b.setState({QRCodeScriptsLoaded:!0})}),this.props.Form.ensureReadyToDesign().done(function(){b.generatepredefinedResponses(),b.setState({FormReadyForDesign:!0})})},e.prototype.componentDidMount=function(){this.updateQRCode(),this.bindClipboard()},e.prototype.componentDidUpdate=function(){this.updateQRCode(),this.bindClipboard()},e.prototype.componentWillUnmount=function(){this.clipboardList.forEach(function(a){a&&a.destroy()}),this.clipboardList=[]},e.prototype.render=function(){var a;return a=this.state.FormReadyForDesign&&this.state.QRCodeScriptsLoaded?React.createElement("div",{className:"office-form-page-padding"},React.createElement("div",{className:"office-form-theme-border-top qrcode-view-body"},React.createElement("div",{className:"qrcode-view-title"},b.Resources.LocalizedStrings.QRCodeView_title),React.createElement("div",{className:"qrcode-view-question"},this.props.Form.Model.Title),this.renderQRCode())):c.createLoadingPlaceholder({Message:b.Resources.LocalizedStrings.DesignPage_LoadingForm}),React.createElement("div",__assign({},this.getContainerProps()),this.createHeader(),React.createElement("div",{className:"top-view-content"},a))},e.prototype.renderQRCode=function(){var c=this;return _.map(this.props.Form.Model.PredefinedResponses,function(d){if(d){var e=c.getPredefinedResponseUrl(d.Id),f={readOnly:!0,value:e,className:"qrcode-view-url-container",id:"predefinedResponeQRCode"+d.Id,onClick:function(){var a=$("predefinedResponeQRCode"+d.Id);a.focus(),a.select()}},g={HTMLAttributes:{id:"predefinedResponseUrlCopyButtn"+d.Id,className:"qrcode-view-copy-button"},Text:b.Resources.LocalizedStrings.QRCodeView_Copy};g.HTMLAttributes["data-clipboard-target"]="#predefinedResponeQRCode"+d.Id;var h={className:"qrcode-view-download-button",href:"javascript:void(0)",onClick:function(){for(var b=ReactDOM.findDOMNode(c.refs["topViewQRcodeImg"+d.Id]),e=b.src.split("base64,")[1],f=window.atob(e),g=new Uint8Array(f.length),h=0;h<f.length;h++)g[h]=f.charCodeAt(h);var i,j=new Blob([g]);i=d.Answers&&d.Answers[0]&&d.Answers[0].Answer&&d.Answers[0].Answer.trim()?d.Answers[0].Answer.trim().substr(.1):e.substr(.1),saveAs(j,i+".png"),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.QRCodePlus.Download})}};return React.createElement("div",{key:d.Id,className:"qrcode-view-predefined-response-container"},React.createElement("span",{className:"qrcode-view-qrcode-container"},React.createElement("span",{ref:"topViewQRcodeCanvas"+d.Id,className:"qrcode-view-canvas-container"}),React.createElement("img",{ref:"topViewQRcodeImg"+d.Id,className:"qrcode-view-qrcode-img"})),React.createElement("span",{className:"qrcode-view-choice-description"},d.Answers[0].Answer),React.createElement("span",{className:"qrcode-view-button-container"},React.createElement("a",__assign({},h),b.Resources.LocalizedStrings.QRCodeView_Download),React.createElement("span",{className:"qrcode-copy-url-container"},React.createElement("input",__assign({},f)),a.Control.createTextButton(g))),React.createElement("div",{id:"urlCopyStatus"+d.Id,className:"qrcode-view-copy-status"}))}})},e.prototype.updateQRCode=function(){var a=this;this.state.FormReadyForDesign&&this.state.QRCodeScriptsLoaded&&_.forEach(this.props.Form.Model.PredefinedResponses,function(b){var c=ReactDOM.findDOMNode(a.refs["topViewQRcodeCanvas"+b.Id]),d=ReactDOM.findDOMNode(a.refs["topViewQRcodeImg"+b.Id]);c&&d&&($(c).qrcode({height:800,width:800,correctLevel:1,text:a.getPredefinedResponseUrl(b.Id)}),d.setAttribute("src",$(c)[0].children[0].toDataURL()))})},e.prototype.bindClipboard=function(){var c=this;this.state.FormReadyForDesign&&this.state.QRCodeScriptsLoaded&&!this.isClipboardBinded&&(_.forEach(this.props.Form.Model.PredefinedResponses,function(d){var e=new Clipboard("#predefinedResponseUrlCopyButtn"+d.Id);
c.clipboardList.push(e),e.on("success",function(c){var e=$("#urlCopyStatus"+d.Id);e.removeClass("flex-pane-status-error"),e.addClass("flex-pane-status-success"),e.text(b.Resources.LocalizedStrings.SharePane_Link_SuccessMessage),e.show(),setTimeout(function(){e.fadeOut("slow",function(){e.hide()})},3e3),c.clearSelection(),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.QRCodePlus.CopyUrlSuccess})}),e.on("error",function(c){var e=$("#urlCopyStatus"+d.Id);e.removeClass("flex-pane-status-success"),e.text(b.Resources.LocalizedStrings.SharePane_Link_FailedMessage),e.addClass("flex-pane-status-error"),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.QRCodePlus.CopyUrlFail})})}),this.isClipboardBinded=!0)},e.prototype.generatepredefinedResponses=function(){var a=this.props.Form,b=a.Model.Questions;if(0===a.Model.PredefinedResponses.length&&0!==b.length){var c=b[0];if(c){var d=c.Id,e=c.Choices,f=_.map(e,function(a,b){var c=[],e={QuestionId:d,Answer:a.Description};c.push(e);var f={Id:b,Answers:c};return f});a.Model.PredefinedResponses=f}}},e.prototype.getPredefinedResponseUrl=function(b){var c={id:this.props.Form.Model.Id,responseId:b},d="../Pages/QuickSubmitPage.aspx?"+$.param(c);return a.Utilities.Html.getAbsoluteUrl(d)},e}(c.TopViewBase)}(c=b.DesignPage||(b.DesignPage={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(){function c(){}return Object.defineProperty(c,"fieldPrefix",{get:function(){return"field_"},enumerable:!0,configurable:!0}),c.createAnalyzeViewData=function(a){var b=$.Deferred();return _.defer(function(){var d=a.FormElementManager.TopQuestionMasters.map(function(a,b){return{Index:b,Field:c.createIQuestionInfoField(a.Model),Model:a.Model,Master:a}}),e=_.map(a.Model.Responses,function(b,d){var e=c.getResponseWithIndexableQuestion(b,a);return e.field_created_time=b.StartDate.toString(),e.field_modified_time=b.SubmitDate.toString(),e.field_responder=b.Responder,e.field_responder_name=b.ResponderName?b.ResponderName:b.Responder,e});b.resolve({Questions:d,Answers:e,Analyses:c.analyzeReponse(d,e),Changed:!0})}),b.promise()},c.createIQuestionInfoField=function(a){return c.fieldPrefix+a.Id.replace(/-/g,"")},c.getNonNumberTextQuestions=function(a){return a.map(function(a){return a.Type!==b.Model.QuestionType.TextField||a.IsNumber?void 0:c.createIQuestionInfoField(a)}).filter(function(a){return!!a})},c.getDateTimeQuestions=function(a){return a.map(function(a){return a.Type===b.Model.QuestionType.DateTime?c.createIQuestionInfoField(a):void 0}).filter(function(a){return!!a})},c.getResponseWithIndexableQuestion=function(c,d){var e={};return _.forEach(c.Answers,function(c){var f=d.getQuestionById(c.QuestionId);if(f){var g="field_"+c.QuestionId.replace(/-/g,"");e[g]=c.Answer;var h=f.Model.Type;if(h===b.Model.Question.DateTime.getElementTypeName()&&c.Answer){var i=Date.parseDate(c.Answer,b.FormLimitation.DateQuestionAnswerFormat,OfficeFormServerInfo.cultureInfo);e[g]=i.toDateShortString(OfficeFormServerInfo.cultureInfo)}else if(f.isNumberType())e[g]=a.Utilities.tryParseJson(c.Answer);else if(h===b.Model.Question.TextField.getElementTypeName()&&f.Model.IsMathQuiz){var j=g+"_math";e[j]=c.IsMathAnswer}}}),e.field_id=c.Id,e},c.analyzeReponse=function(d,e){var f=this,g={};return d.forEach(function(d){switch(d.Model.Type){case b.Model.QuestionType.Choice:var h=new Object,i=new Object,j={correct:0,wrong:0};_.forEach(d.Model.Choices,function(a){h[a.Description]=0,i[a.Description]=a.IsMathOption});var k=_.filter(d.Model.Choices,function(a){return a.IsAnswerKey}).map(function(a){return a.Description}).sort();e.map(function(a){return a[d.Field]}).map(function(c){var e=b.Model.Question.getChoiceAnswer(c,d.Model);e.IsLegacyChoiceAnswer&&a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.MeetLegacyChoiceAnswer}),e.SelectedOptions.forEach(function(a){h[a]=h[a]||0,++h[a]}),_.isEqual(k,e.SelectedOptions.sort())?++j.correct:++j.wrong});var l=[];for(var m in h)m&&l.push({Title:m,Data:h[m],IsMath:i[m]});g[d.Field]={options:f.calculateOthers(l),gradeResults:j};break;case b.Model.QuestionType.Rating:var n=0,o=0,p=0;e.forEach(function(a){a[d.Field]&&(n++,o+=a[d.Field])}),p=0===n?0:Math.round(o/n*100)/100,g[d.Field]={count:n,averageRating:p};break;case b.Model.QuestionType.TextField:if(d.Master.hasCorrectAnswers()){var q=new b.Model.Question.ShortTextAutograder(d.Model),r=new Object,s={correct:0,wrong:0};_.forEach(q.getAnswers(),function(a){r[a.answer]=0});var t=[];e.forEach(function(a){if(c.hasValidAnswer(a,d)){var b=String(a[d.Field]);t.push(b)}}),t.map(function(a){r[a]=r[a]||0,r[a]++,q.isCorrect(a)?++s.correct:++s.wrong});var u=[];for(var v in r)r.hasOwnProperty(v)&&v&&u.push({Title:v,Data:r[v],IsMath:!1});g[d.Field]={options:f.calculateOthers(u),gradeResults:s};break}var n=0,w=[],x=[],y=0,z=0,A=0;e.forEach(function(a){c.hasValidAnswer(a,d)&&(d.Model.IsNumber&&_.isNumber(a[d.Field])&&(z++,y+=a[d.Field]),w.push(a[d.Field]))}),n=w.length,A=0===z?0:y/z,x=3>=n?w:w.slice(n-3),g[d.Field]={count:n,recentAnswers:x,averageResult:Math.round(100*A)/100};break;case b.Model.QuestionType.DateTime:var n=0,w=[],x=[];e.forEach(function(a){a[d.Field]&&w.push(a[d.Field])}),n=w.length,x=3>=n?w:w.slice(n-3),g[d.Field]={count:n,recentAnswers:x};break;case b.Model.QuestionType.Ranking:var B,C=d.Master.Model.ChoiceGroup,D={},E=C.length,F=[],G={correct:0,wrong:0},H=d.Model.GradingBasis;d.Model.IsQuiz?(B=JSON.parse(H),_.forEach(C,function(a,b){var c=a.Id;F.push(c),D[c]={description:a.Description,total:e.length,data:_.map(Array.apply(null,Array(E)),Number.prototype.valueOf,0),score:0},B[B.indexOf(a.Key)]=c})):_.forEach(C,function(a){var b=a.Id;F.push(b),D[b]={description:a.Description,total:e.length,data:_.map(Array.apply(null,Array(E)),Number.prototype.valueOf,0),score:0}}),e.map(function(a){var b=a[d.Field];if(b&&b.length>0){a[d.Field]=b.filter(function(a){return-1!==F.indexOf(a.id)}).sort(function(a,b){return a.answerOrder-b.answerOrder});var c=a[d.Field].map(function(a){return a.id});_.isEqual(B,c)?++G.correct:++G.wrong,c.forEach(function(a,b){var c=D[a];c.data[b]++,c.score+=E-b})}else++G.wrong});var I=[];if(d.Model.IsQuiz)for(var J=0;J<B.length;J++)I.push({Title:D[B[J]].description,Data:D[B[J]].data,Score:D[B[J]].score,Total:D[B[J]].total});else for(var K in D)I.push({Title:D[K].description,Data:D[K].data,Score:D[K].score,Total:D[K].total});g[d.Field]={rankResults:I,gradeResults:G};break;default:g[d.Field]=void 0}}),g},c.calculateOthers=function(a){var c=10,d=0;if(a=a.sort(function(a,b){return b.Data-a.Data}),a.length>c){var e=a.length-c+1;a.splice(c-1).forEach(function(a){return d+=a.Data}),a.push({Title:b.Resources.LocalizedStrings.AnalyzeView_Chart_Others.format(e),Data:d,IsMath:!1})}return a},c.hasValidAnswer=function(a,b){var c=function(b){return null!=a[b]&&""!=a[b]&&a[b].toString().length},d=b.Master.SubQuestionMasters;if(d.length>0){var e=_.map(d,function(a){return"field_"+a.Model.Id});return _.filter(e,function(a){return c(a)}).length>0}return c(b.Field)},c.getQuestionId=function(a){return a.Field.substring(c.fieldPrefix.length)},c.getBranchedQuestions=function(a,b){var c=a.FormElementManager.QuestionMasters;if(c&&b&&c[0])return b.map(function(b){for(var c,d=[],e=a.FormElementManager.QuestionMasters[0],f=!1;e&&!f;)d.push(e),c=a.FormElementManager.QuestionMasters.indexOf(e)+1,e=e.getBranchedQuestion(b["field_"+e.Model.Id],a.FormElementManager.QuestionMasters[c]),f=-1!==d.indexOf(e);return{field_id:b.field_id,branched_questions:d.map(function(a){return a.Model})}})},c}();c.AnalyzeDataHelper=d}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(){function c(){}return c.averageFillTime=function(a){var b=0;a.Answers.forEach(function(a){var c=Date.parse(a.field_created_time),d=Date.parse(a.field_modified_time);b+=d-c}),b=0===a.Answers.length?0:b/1e3/a.Answers.length;var c=Math.floor(b/60),d=Math.round(b%60);return{minutes:c,seconds:d}},c.isToday=function(a){var b=new Date(a.field_modified_time),c=new Date(Date.now());return b.getDate()===c.getDate()&&b.getMonth()===c.getMonth()&&b.getFullYear()===c.getFullYear()},c.buildExcelLink=function(a){var b=/\{([-a-zA-Z0-9]*)\}/,c=b.exec(a.eTag),d=c.length>=1?c[1].replace(/-/g,""):"";return a.webUrl+"?d=w"+d},c.createWorksheet=function(a){for(var b={},d={s:{c:0,r:0},e:{c:a[0].length,r:a.length}},e=[],f=0;f!==a.length;++f)for(var g=0;g!==a[f].length;++g)if(null!==a[f][g]&&void 0!==a[f][g]){if(a[f][g]instanceof Object){var h="";for(var i in a[f][g])h+=a[f][g][i]+"; ";a[f][g]=h}e[g]=Math.max(a[f][g].toString().length,e[g]||0);var j={v:a[f][g],t:"s"},k=XLSX.utils.encode_cell({c:g,r:f});b[k]=j}return b["!ref"]=XLSX.utils.encode_range(d),b["!cols"]=e.map(function(a){return{wch:Math.min(a||c.ExcelCellDefaultWidth,c.ExcelCellMaxWidth)}}),b},c.createBlob=function(a){for(var b=new ArrayBuffer(a.length),c=new Uint8Array(b),d=0;d!==a.length;++d)c[d]=a.charCodeAt(d);var e=new Blob([b],{type:"application/octet-stream"});return e},c.createExcelFile=function(a,b){var d="Form Responses",e={SheetNames:[],Sheets:{}},f=c.createWorksheet(a);e.SheetNames.push(d),e.Sheets[d]=f;var g=XLSX.write(e,{bookType:"xlsx",bookSST:!1,type:"binary"}),h=c.createBlob(g);saveAs(h,b)},c.isQuizQuestion=function(a){var c=_.some(a.Choices,function(a){return a.IsAnswerKey}),d=a.Type===b.Model.QuestionType.TextField&&!a.Multiline&&new b.Model.Question.ShortTextAutograder(a).areAnyAnswersDefined(),e=a.Type===b.Model.QuestionType.Ranking&&0!=JSON.parse(a.GradingBasis).length;return a.IsQuiz&&(c||d||e)},c.hasQuizQuestion=function(a){return a.some(function(a){return c.isQuizQuestion(a.Model)})},c.isCorrectAnswer=function(a,b){return a.Master.isCorrectAnswer(b[a.Field])},c.calculateIndividualFillTime=function(a){var b=Date.parse(a.field_created_time),c=Date.parse(a.field_modified_time),d=(c-b)/1e3,e=Math.floor(d/60),f=Math.round(d%60);return{minutes:e,seconds:f}},c.getNextAnswerId=function(a,b){var c=a.indexOf(_.findWhere(a,{field_id:b}));return c<a.length-1?a[c+1].field_id:c>0?a[c-1].field_id:void 0},c.onDeleteAllResponses=function(c){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.DeleteAllResponses}),c.deleteAllResponses().done(function(){b.DesignPage.getUxStateMaster().hideErrorMessageBar("DeleteAllResponses",c.Model.Id),c.refreshFormResponsesCount()}).fail(function(a){b.DesignPage.getUxStateMaster().showErrorMessageBar("DeleteAllResponses",a.innerCode,c.Model.Id)})},c.onDeleteCurrentResponse=function(b,c){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.DeleteSingleResponse}),b.bulkEdit(function(){b.Model.Responses=_.without(b.Model.Responses,_.findWhere(b.Model.Responses,{Id:c}))})},c.renderQuestionWithAnswer=function(c,d){var e;c.Question.Model.Type===b.Model.QuestionType.TextField&&(e=!0);var f={Master:b.Model.exportConverter(c),Ordinal:d,Disabled:!0,DisableShuffle:!0,key:c.Question.Model.Id,IsMobile:a.Utilities.isMobile(),ShowValidationStyle:!0,ShowQuizResult:!0,HideMedia:!1,PrintView:e};return Forms.UX.Renderer.createRendererElement(f)},c.calculateLegacyIndividualScore=function(a,b,d,e){void 0===e&&(e=!1);var f=0,g=0,h=0,i=0;if(a.forEach(function(a){c.isQuizQuestion(a.Model)&&_.findWhere(d.branched_questions,{Id:a.Field.substring(6)})&&(f++,h+=a.Model.Point||0,c.isCorrectAnswer(a,b)&&(g++,i+=a.Model.Point||0))}),e)return{correctPoints:i,totalPoints:h};var j=0!==f?g/f:0,k=0!==h?i.toString()+"/"+h.toString():(100*j).toFixed(0)+"%";return{correct:g.toString(),wrong:(f-g).toString(),score:k}},c.ExcelCellDefaultWidth=20,c.ExcelCellMaxWidth=50,c}();c.AnalyzeHelper=d}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return React.createElement(e,a)}c.createAnalyzeView=d;var e=function(d){function e(){var a=null!==d&&d.apply(this,arguments)||this;return a.mounted=!0,a.responseCountChangeCallback=function(){return a.onResponseCountChange()},a.responseListChangeCallback=function(b){return a.onResponseListChange(b)},a.questionListChangeCallback=function(b){return a.onQuestionListChange(b)},a.gradingButtonRef=React.createRef(),a.releaseResultsButtonRef=React.createRef(),a.viewResultsButtonRef=React.createRef(),a.updateGradingPattern=function(){return a.setState({ManualGrading:a.props.Form.SettingMaster.Model.ManualGradingEnabled})},a.uxStateModelChangeCallback=a.onUxStateModelChange.bind(a),a.state={QuestionIdForDetailsModal:null},a}return __extends(e,d),e.prototype.componentWillMount=function(){var a=this,d=this.props.Form;this.registerVariableObservers(),d.syncFormResponses().then(function(){return c.AnalyzeDataHelper.createAnalyzeViewData(d)}).then(function(b){if(a.mounted){a.populateInitialCurrentChartsTypeId(b);var e=b.Answers[0]?b.Answers[0].field_id:void 0,f=c.AnalyzeDataHelper.getBranchedQuestions(d,b.Answers);a.analyzeViewDataChanged=!0,a.setState({AnalyzeViewData:b,CurrentResponseId:e,BranchedQuestions:f})}}).fail(function(a){return b.DesignPage.getUxStateMaster().Model.CriticalError=a}),this.loadJavaScriptLibraries()},e.prototype.componentDidMount=function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.Navigate})},e.prototype.componentDidUpdate=function(){if(!this.shouldShowLoadingPage()&&(this.analyzeViewDataChanged||this.analyzeViewViewChanged)){var b=this.state.AnalyzeViewData.Analyses;$(".rateit").rateit();for(var c in this.refs){var d=ReactDOM.findDOMNode(this.refs[c]);b[c]&&b[c].averageRating&&$(d).rateit("value",b[c].averageRating)}this.fadeoutOnScroll("exportMenu","analyzeContainer",500),this.analyzeViewDataChanged=!1,this.analyzeViewViewChanged=!1}a.Utilities.Flight.isIvyChartEnabled()&&this.singleIvyChartChanged&&(this.updateAnalyzeViewSingleChart(this.singleChangedIvyChartQuestion,this.singleIvyChartChangedType),this.singleIvyChartChanged=!1),(this.state.ShowConfirmDeleteAllDialog||this.state.ShowConfirmDeleteDialog)&&$(".analyze-view-cancel-button").focus()},e.prototype.componentWillUnmount=function(){this.mounted=!1,this.unregisterVariableObservers();var a=b.DesignPage.getUxStateMaster();a.hideErrorMessageBar("RefreshResponses"),a.hideErrorMessageBar("ExportResponsesToExcel")},e.prototype.render=function(){var a=_.extend({},this.props.HTMLAttributes);return a.className="analyze-view-container",a.ref="analyzeContainer",a.id="analyzeViewPrintParent",React.createElement("div",__assign({},a),this.createAnalyzeViewContent(),this.createDetailsModal())},e.prototype.registerVariableObservers=function(){var c=this.props.Form;c.observe(this.responseCountChangeCallback,[b.Model.FormMaster.Schema.ResponsesCount]),c.observe(this.responseListChangeCallback,[b.Model.FormMaster.Schema.Responses]),a.Flighting.Flight.isEnabled(a.Flighting.Flights.CoGrading)&&c.observe(this.questionListChangeCallback,[b.Model.FormMaster.Schema.Questions]),c.SettingMaster.observe(this.updateGradingPattern,[b.Model.FormSettingsMaster.Schema.ManualGradingEnabled]),b.DesignPage.getUxStateMaster().observe(this.uxStateModelChangeCallback,[b.DesignPage.UxStateFields.Analysis])},e.prototype.populateInitialCurrentChartsTypeId=function(d){if(a.Utilities.Flight.isIvyChartEnabled()){var e=d.Questions,f=d.Analyses,g=d.Answers.length,h={};g>0&&e.forEach(function(a){switch(a.Model.Type){case b.Model.Question.TextField.getElementTypeName():case b.Model.Question.Choice.getElementTypeName():f[a.Field].options.length>5?h[a.Field]=c.IvyChartType.BarChart:h[a.Field]=c.IvyChartType.PieChart}}),this.setState({CurrentChartsTypeId:h}),this.singleIvyChartChanged=!1}},e.prototype.loadJavaScriptLibraries=function(){var b=this;a.JavaScriptLoader.loadJavaScript("DataTables").done(function(){return b.setState({DataTablesLibraryLoaded:!0})}),a.Utilities.Flight.isIvyChartEnabled()?a.JavaScriptLoader.loadJavaScript("Ivy").done(function(){return b.setState({ChartLibraryLoaded:!0})}):a.JavaScriptLoader.loadJavaScript("Chart").done(function(){return b.setState({ChartLibraryLoaded:!0})})},e.prototype.unregisterVariableObservers=function(){var a=this.props.Form;a.SettingMaster.unobserve(this.updateGradingPattern),a.unobserve(this.responseCountChangeCallback),a.unobserve(this.responseListChangeCallback),a.unobserve(this.questionListChangeCallback);var c=b.DesignPage.getUxStateMaster();c.unobserve(this.uxStateModelChangeCallback,[b.DesignPage.UxStateFields.Analysis])},e.prototype.onUxStateModelChange=function(){this.analyzeViewViewChanged=!0;var a=b.DesignPage.getUxStateMaster();a.hideErrorMessageBar("RefreshResponses"),a.hideErrorMessageBar("ExportResponsesToExcel")},e.prototype.fadeoutOnScroll=function(a,b,c){var d,e=ReactDOM.findDOMNode(this.refs[a]),f=ReactDOM.findDOMNode(this.refs[b]),g=$(e).css("opacity"),h=function(){null!=d&&(clearInterval(d),d=null),d=setTimeout(function(){$(e).animate({opacity:1},"slow"),d=null},c)};$(f).scroll(function(){$(e).is(":animated")||"1"!==g?h.call(this):$(e).animate({opacity:0},"slow",h)})},e.prototype.createAnalyzeViewContent=function(){return this.shouldShowLoadingPage()?React.DOM.div({className:"analyze-view-placerholder"},b.DesignPage.createLoadingPlaceholder({Message:b.Resources.LocalizedStrings.AnalyzeView_Loading})):React.createElement("div",{className:"analyze-view-content",id:"analyzeViewPrintChild"},React.createElement("div",{className:"analyze-view-formname"},this.props.Form.Model.Title),this.createAnalyzeSummaryContent(),this.createPageSpecificNavBar(),this.createAnalyzeViewDetailContent())},e.prototype.shouldShowLoadingPage=function(){return!this.state.AnalyzeViewData||!this.state.ChartLibraryLoaded||!this.state.DataTablesLibraryLoaded},e.prototype.createAnalyzeSummaryContent=function(){var d=this,e=this.state,f=this.props.Form,g=f.SettingMaster,h=e.AnalyzeViewData,i=b.Resources.LocalizedStrings.AnalyzeView_Status_Unknown;i=g.isAcceptingResponse()?b.Resources.LocalizedStrings.AnalyzeView_Status_Active:b.Resources.LocalizedStrings.AnalyzeView_Status_Closed;var j,k=a.Flighting.Flight.isEnabled(a.Flighting.Flights.ReExportToExcelButton)&&!!f.Model.XlWorkbookId;this.props.Form.SyncContext!==b.Model.FormSyncContext.AnalysisTimeForm&&(j=c.createAnalyzeViewMenu({HasAnswers:e.AnalyzeViewData&&e.AnalyzeViewData.Answers.length>0,DeleteAllResponses:!0,onDelete:function(){c.AnalyzeHelper.onDeleteAllResponses(d.props.Form),d.setState({AnalyzeViewData:void 0})},onPrint:this.printAnalyzeView,onReExportToExcel:k?function(){return d.reExportToExcel(f.Model.Id)}:void 0}));var l=this.createDataCircle(h.Answers.length,b.Resources.LocalizedStrings.AnalyzeView_Total_Response,"analyze-view-circle-cell",b.Resources.LocalizedStrings.AnalyzeView_NumberOfResponses_AccessibilityLabel.format(h.Answers.length)),m=this.createDataStack(i,b.Resources.LocalizedStrings.AnalyzeView_Status_Label,"analyze-view-summary-cell",!0,b.Resources.LocalizedStrings.AnalyzeView_FormStatus_AccessibilityLabel.format(i)),n=c.QuizView.showAverageScore(f.Model),o=n?this.averageScores(h).toString():null,p=n?this.createDataStack(o,b.Resources.LocalizedStrings.AnalyzeView_Average_Score,"analyze-view-summary-cell",!1,b.Resources.LocalizedStrings.AnalyzeView_Average_Score_Explicit.format(o)):void 0,q=n?null:c.AnalyzeHelper.averageFillTime(h),r=n?void 0:this.createDataStack(b.Resources.LocalizedStrings.AnalyzeView_Average_Fill_Time_Minutes_Seconds_Short.format(q.minutes<10?"0"+q.minutes:q.minutes,q.seconds<10?"0"+q.seconds:q.seconds),b.Resources.LocalizedStrings.AnalyzeView_Average_Fill_Time,"analyze-view-summary-cell",!1,b.Resources.LocalizedStrings.AnalyzeView_Average_Fill_Time_Minutes_Seconds_Explicit.format(q.minutes,q.seconds));return React.createElement("div",{className:"analyze-view-summary-content"},React.createElement("div",{className:"analyze-view-summary-table"},React.createElement("div",{className:"analyze-view-summary-container"},React.createElement("div",{className:"analyze-view-summary-circle-cell"},l),p,r,m),j))},e.prototype.averageScores=function(a){var b,d=this.state,e=d.AnalyzeViewData.Answers,f=d.AnalyzeViewData.Questions,g=this.props.Form.Model,h=0,i=[],j=!1;return e.forEach(function(a){var e=_.findWhere(d.BranchedQuestions,{field_id:a.field_id}),g=0;f.forEach(function(a){_.findWhere(e.branched_questions,{Id:c.AnalyzeDataHelper.getQuestionId(a)})&&a.Model.Point&&(g+=a.Model.Point)}),i.push(g),null!=b&&g!==b&&(j=!0),b=g}),_.forEach(g.Responses,function(a,b){var c=0;_.forEach(a.Answers,function(a){c+=a.Score||0}),h+=c/i[b]}),j?0===e.length?"0%":(h/e.length*100).toFixed(0)+"%":0===e.length?"0":(h/e.length*i[0]).toFixed(0)},e.prototype.createPageSpecificNavBar=function(){return this.props.Form.SyncContext!==b.Model.FormSyncContext.AnalysisTimeForm?React.createElement("div",{className:"analyze-view-nav-bar"},React.createElement("div",{className:"analyze-view-nav-bar-left-button-container"},this.createNavBarLeftButtons()),React.createElement("div",{className:"analyze-view-export-to-excel-button"},React.createElement(c.ExportExcelButton,{Form:this.props.Form}))):void 0},e.prototype.createNavBarLeftButtons=function(){return this.isCurrentFormAQuiz()?this.createNavBarLeftButtonsForQuiz():this.createNavBarLeftButtonsForSurvey()},e.prototype.isCurrentFormAQuiz=function(){return this.props.Form.Model.QuizQuestionsCount>0},e.prototype.createNavBarLeftButtonsForQuiz=function(){var c=this,d=this.props.Form.Model.ResponsesCount>0,e=a.Control.createTextButton({HTMLAttributes:{className:"analyze-view-nav-button office-form-theme-button",onClick:function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.GradeResults});var d=b.DesignPage.getUxStateMaster();d.startBulkEditMode(),d.Model.Analysis=!1,d.Model.Grading=OfficeFormGrading.GradingMode.ByStudent,b.DesignPage.getUxStateMaster().showTopView("Grading_ReviewAnswers",function(){c.releaseResultsButtonRef.current&&c.releaseResultsButtonRef.current.focus()}),d.endBulkEditMode()},disabled:!d},ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.AnalyzeView_GradingButton_Label,ref:this.gradingButtonRef}),f=a.Control.createTextButton({HTMLAttributes:{className:"analyze-view-nav-button office-form-theme-button",onClick:function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.ReleaseResults});var d=b.DesignPage.getUxStateMaster();d.startBulkEditMode(),d.Model.Analysis=!1,b.DesignPage.getUxStateMaster().showTopView("Grading_PostGrades",function(){c.releaseResultsButtonRef.current.focus()}),d.endBulkEditMode()},disabled:!d},ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.AnalyzeView_ReleaseResultsButton_Label,ref:this.releaseResultsButtonRef});return React.createElement("div",null,e,f)},e.prototype.createNavBarLeftButtonsForSurvey=function(){var c=this,d=this.props.Form.Model.ResponsesCount>0,e=a.Control.createTextButton({HTMLAttributes:{className:"analyze-view-nav-button office-form-theme-button",onClick:function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.ViewResults});var d=b.DesignPage.getUxStateMaster();d.startBulkEditMode(),d.Model.Analysis=!1,b.DesignPage.getUxStateMaster().showTopView("SurveyResults",function(){c.viewResultsButtonRef.current.focus()}),d.endBulkEditMode()},disabled:!d},ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.AnalyzeView_ViewResultsButton_Label,ref:this.viewResultsButtonRef});return React.createElement("div",null,e)},e.prototype.createAnalyzeViewDetailContent=function(){var a=this.state.AnalyzeViewData.Answers.length;return a>0?React.DOM.div({className:"analyze-view-detail-content"},this.createAnalyzeViewDetailTable()):React.DOM.div({className:"analyze-view-detail-content"},this.createNoResponseDetails())},e.prototype.printAnalyzeView=function(){var a=$("#analyzeViewPrintChild").appendTo($("body")),b=$("#content-root");b.hide(),window.print(),a.appendTo($("#analyzeViewPrintParent")),b.show()},e.prototype.reExportToExcel=function(b){var c="RedirectToExcelPage.aspx?id="+encodeURIComponent(b)+"&forceReExport=true";a.Utilities.Html.hiddenOpen(c)},e.prototype.exportToExcelUsingClient=function(){var a=this.state.AnalyzeViewData.Answers.map(function(a){return[a.field_created_time,a.field_modified_time,a.field_responder]});a.unshift([b.Resources.LocalizedStrings.AnalyzeView_ExcelHeader_StartTime,b.Resources.LocalizedStrings.AnalyzeView_ExcelHeader_SubmitTime,b.Resources.LocalizedStrings.AnalyzeView_ExcelHeader_Responder]),c.AnalyzeHelper.createExcelFile(a,this.props.Form.Model.Title+".xlsx")},e.prototype.createNoResponseDetails=function(){return React.createElement("div",{className:"analyze-view-detail-noresponses-container"},React.createElement(a.Control.FontIconControl,{HTMLAttributes:{className:"analyze-view-warning-icon"},IconName:"Sad"}),React.createElement("div",{className:"analyze-view-detail-noresponse-message"},b.Resources.LocalizedStrings.Analysis_Page_No_Responses_Message),React.createElement("div",{className:"analyze-view-detail-noresponse-detail"},b.Resources.LocalizedStrings.Analysis_Page_No_Responses_Details))},e.prototype.openResponseDetailsTable=function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.ShowResponsesDetail}),this.setState({QuestionIdForDetailsModal:b})},e.prototype.createAnalyzeViewDetailTable=function(){var c=this,d=this.state.AnalyzeViewData.Questions,e=this.state.AnalyzeViewData.Analyses;return d.map(function(d,f){var g={className:"analyze-view-link-button analyze-view-detail-show-responses-data-button",title:b.Resources.LocalizedStrings.AnalyzeView_ShowDetailResponses_Button.format(f+1),onClick:function(){return c.openResponseDetailsTable(d.Field)}},h=React.DOM.div({className:"analyze-view-detail-show-responses-data"},React.DOM.button(g,React.DOM.span({className:"analyze-view-detail-show-responses-data-text"},b.Resources.LocalizedStrings.AnalyzeView_Detail_Title)));switch(d.Model.Type){case b.Model.QuestionType.Choice:return a.Utilities.Flight.isIvyChartEnabled()?React.DOM.div({className:"analyze-view-detail",key:f},c.createAnalyzeViewDetailLabel(f,d,e),React.DOM.div({className:"analyze-view-detail-container"},h,React.DOM.div({className:"analyze-view-detail-chart"},React.DOM.div({className:"analyze-view-detail-chart-canvas",id:d.Field}))),React.DOM.div({className:"analyze-view-detail-linebreak"})):c.createAnalyzeViewDetailRow(d,f,h);case b.Model.QuestionType.Rating:var i=void 0;if(d.Model.RatingShape===b.Model.RatingShape.Number)i=React.DOM.div({className:"analyze-view-rating-container"},c.createDataCircle(e[d.Field].averageRating,b.Resources.LocalizedStrings.AnalyzeView_Average_Rating.format(e[d.Field].averageRating),"analyze-view-detail-datacircle"));else{var j=e[d.Field].averageRating,k=a.Control.createRating({Disabled:!0,HTMLAttributes:{className:"analyze-view-details-rating office-form-theme-primary-foreground",key:"rateit",ref:d.Field,title:null==j?void 0:b.Resources.LocalizedStrings.AnalyzeView_Average_Rating.format(j.toFixed(2))},Length:d.Model.Length,onValueChange:void 0,ShowRatingLabel:!1,Value:j});i=React.DOM.div({className:"analyze-view-rating-container"},React.DOM.div(k),React.DOM.div({className:"analyze-view-summary-status-label"},b.Resources.LocalizedStrings.AnalyzeView_Average_Rating.format(j)))}return React.DOM.div({className:"analyze-view-detail",key:f},c.createAnalyzeViewDetailLabel(f,d,e),React.DOM.div({className:"analyze-view-detail-container"},h,c.createDataCircle(e[d.Field].count,b.Resources.LocalizedStrings.AnalyzeView_Total_Response,"analyze-view-detail-datacircle"),i),React.DOM.div({className:"analyze-view-detail-linebreak"}));case b.Model.QuestionType.TextField:if(d.Master.hasCorrectAnswers())return c.createAnalyzeViewDetailRow(d,f,h);if(d.Model.IsNumber)return React.DOM.div({className:"analyze-view-detail",key:f},c.createAnalyzeViewDetailLabel(f,d,e),React.DOM.div({className:"analyze-view-detail-container"},h,c.createDataCircle(e[d.Field].count,b.Resources.LocalizedStrings.AnalyzeView_Total_Response,"analyze-view-detail-datacircle"),c.createDataStack(e[d.Field].averageResult,b.Resources.LocalizedStrings.AnalyzeView_Average_Result,"analyze-view-detail-datastack",!0)),React.DOM.div({className:"analyze-view-detail-linebreak"}));var l=e[d.Field].recentAnswers;return l&&(l=l.map(function(a,b){return React.DOM.div({className:"analyze-view-detail-text-lines",key:b},'"'+a+'"')})),React.DOM.div({className:"analyze-view-detail",key:f},c.createAnalyzeViewDetailLabel(f,d,e),React.DOM.div({className:"analyze-view-detail-container"},h,c.createDataCircle(e[d.Field].count,b.Resources.LocalizedStrings.AnalyzeView_Total_Response,"analyze-view-detail-datacircle"),React.DOM.div({className:"analyze-view-detail-text-recent"},React.DOM.div({className:"analyze-view-summary-status-label"},b.Resources.LocalizedStrings.Analyze_View_Text_Recent_Responses),l)),React.DOM.div({className:"analyze-view-detail-linebreak"}));case b.Model.QuestionType.DateTime:var m=e[d.Field].recentAnswers;return m&&(m=m.map(function(a,b){return React.DOM.div({className:"analyze-view-detail-text-lines",key:b},'"'+a+'"')})),React.DOM.div({className:"analyze-view-detail",key:f},c.createAnalyzeViewDetailLabel(f,d,e),React.DOM.div({className:"analyze-view-detail-container"},h,c.createDataCircle(e[d.Field].count,b.Resources.LocalizedStrings.AnalyzeView_Total_Response,"analyze-view-detail-datacircle"),React.DOM.div({className:"analyze-view-detail-text-recent"},React.DOM.div({className:"analyze-view-summary-status-label"},b.Resources.LocalizedStrings.Analyze_View_Text_Recent_Responses),m)),React.DOM.div({className:"analyze-view-detail-linebreak"}));case b.Model.QuestionType.Ranking:var n=e[d.Field],o=n.rankResults,p=o.length,q=[],r=void 0,s=[];if(d.Model.IsQuiz)r=a.Control.StackedBarType.QuizRanking,q[0]={backgroundColor:"#06B65F",label:"Correct",data:[]},q[1]={backgroundColor:"#FF1225",label:"Incorrect",data:[]},o.forEach(function(a,b){var c=a.Data[b];q[0].data[b]=c,q[1].data[b]=a.Total-c});else{r=a.Control.StackedBarType.SurveyRanking,o=o.sort(function(a,b){return b.Score-a.Score});var t=[b.Resources.LocalizedStrings.AnalyzeView_Sort_First,b.Resources.LocalizedStrings.AnalyzeView_Sort_Second,b.Resources.LocalizedStrings.AnalyzeView_Sort_Third,b.Resources.LocalizedStrings.AnalyzeView_Sort_Fourth,b.Resources.LocalizedStrings.AnalyzeView_Sort_Fifth,b.Resources.LocalizedStrings.AnalyzeView_Sort_Sixth,b.Resources.LocalizedStrings.AnalyzeView_Sort_Seventh,b.Resources.LocalizedStrings.AnalyzeView_Sort_Eighth,b.Resources.LocalizedStrings.AnalyzeView_Sort_Ninth,b.Resources.LocalizedStrings.AnalyzeView_Sort_Tenth],u=b.Resources.LocalizedStrings.AnalyzeView_Chart_Pick,v=o[0].Score,w=1;o.forEach(function(a,b){v!==a.Score&&w++,s.push(w),v=a.Score;for(var c=0;p>c;c++)q[c]=q[c]||{label:u.format(t[c]),data:[]},q[c].data[b]=a.Data[c]})}var x=o.map(function(a){return a.Title}),y=a.Control.createRankingChartControl({Type:r,Labels:x,Data:q,HasLegend:!0,yLabels:s});return React.createElement("div",{className:"analyze-view-detail",key:f},c.createAnalyzeViewDetailLabel(f,d,e),React.createElement("div",{className:"analyze-view-detail-container"},h,y,React.createElement("div",{className:"analyze-view-detail-linebreak"})))}})},e.prototype.createAnalyzeViewDetailRow=function(c,d,e){var f=this.state.AnalyzeViewData.Analyses,g=f[c.Field],h=g.options.map(function(b){if(b.IsMath){var c=a.Control.createFormulaRenderer({Formula:b.Title,DisableLinebreaks:!0});return{labelName:b.Title,displayElement:c}}var d=a.Control.createUserTextRenderer({Text:b.Title,RenderMode:a.Control.UserTextRenderMode.RichText});return{labelName:b.Title,displayElement:d}}),i={data:g.options.map(function(a){
return a.Data})},j={};if(c.Model.IsQuiz)if(c.Model.Type===b.Model.QuestionType.Choice)_.filter(c.Model.Choices,function(a){return a.IsAnswerKey}).forEach(function(a){return j[a.Description]=!0});else if(c.Model.Type===b.Model.QuestionType.TextField){var k=new b.Model.Question.ShortTextAutograder(c.Model);k.getAnswers().forEach(function(a){return j[a.answer]=!0})}var l=a.Control.createChartControl({Animation:!0,Type:g.options.length<=5?a.Control.ChartType.Pie:a.Control.ChartType.Bar,Labels:h,Data:i,HasLegend:!0,TagLabels:j});return React.DOM.div({className:"analyze-view-detail",key:d},this.createAnalyzeViewDetailLabel(d,c,f),React.DOM.div({className:"analyze-view-detail-container"},e,l),React.DOM.div({className:"analyze-view-detail-linebreak"}))},e.prototype.createAnalyzeViewDetailLabel=function(d,e,f){var g,h=_.find(this.props.Form.FormElementManager.QuestionMasters,function(a){return"field_"+a.Model.Id.replace(/-/g,"")===e.Field});if(h&&h.Model.IsMathQuiz&&h.Model.ShowSubtitle){var i=h.Model.Subtitle||"";if(i){var j=a.Control.createFormulaRenderer({Formula:i});g=React.DOM.div({className:"analyze-view-question-title-formula"},j)}}var k=e.Model.Point||0,l=2>k?b.Resources.LocalizedStrings.Quiz_Points_LowerText:b.Resources.LocalizedStrings.Quiz_Points_LowerTextPlural,m=c.QuizView.showQuestionPoint(e),n=React.DOM.div({className:"analzye-view-detail-title"},a.Control.createUserTextRenderer({Text:e.Model.Title,RenderMode:a.Control.UserTextRenderMode.RichText}),m?React.DOM.span({className:"analyze-view-quiz-point"},"("+k+" "+l+")"):void 0),o=e.Model.IsQuiz?React.DOM.div({className:"analyze-view-detail-quiz-result"},this.createQuizResults(e,f[e.Field].gradeResults)):null;return React.createElement("div",{className:"analzye-view-detail-question"},React.createElement("div",{className:"analzye-view-detail-ordinal"},d+1+"."),React.createElement("div",null,n,g,o))},e.prototype.createQuizResults=function(a,c){if(c&&a.Model.IsQuiz&&a.Master.hasCorrectAnswers()){var d=c.correct,e=c.wrong;if(d||e)return React.DOM.div({className:"analyze-details-quiz-results"},b.Resources.LocalizedStrings.AnalyzeView_QuizResults.format((d/(d+e)*100).toFixed(0),d,d+e))}},e.prototype.createDataCircle=function(a,b,c,d){var e=!!d,f=e?React.createElement("a",{className:"screenReaderVisible"},d):void 0,g=e?{"aria-hidden":!0,role:"presentation"}:void 0;return React.createElement("div",{className:c},f,React.createElement("div",__assign({className:"analyze-view-summary-circle"},g),React.createElement("div",{className:"analyze-view-summary-circle-text office-form-theme-primary-foreground"},a)),React.createElement("div",__assign({className:"analyze-view-text"},g),b))},e.prototype.createDataStack=function(a,b,c,d,e){var f=!!e,g=d?c:c+" optional-cell",h=f?React.createElement("a",{className:"screenReaderVisible"},e):void 0,i=f?{"aria-hidden":!0,role:"presentation"}:void 0;return React.createElement("div",{className:g},h,React.createElement("div",__assign({className:"analyze-view-summary-status office-form-theme-primary-foreground"},i),a),React.createElement("div",__assign({className:"analyze-view-summary-status-label"},i),b))},e.prototype.updateAnalyzeViewSingleChart=function(d,e){var f=this.state.AnalyzeViewData.Analyses,g=this.state.AnalyzeViewData.Answers.length;if(g>0)switch(d.Type){case b.Model.Question.Choice.getElementTypeName():a.Utilities.Flight.isIvyChartEnabled()&&c.IvyChartHelper.createIvyChartByType(d,f[d.Field],e)}},e.prototype.createDetailsModal=function(){var a=this,b=this.state.QuestionIdForDetailsModal;return null==b?void 0:c.createResponsesDetailDialog({QuestionId:b,AnalyzeViewData:this.state.AnalyzeViewData,goToNextModalCallback:function(){var c=a.state.AnalyzeViewData.Questions.filter(function(a){return a.Field===b})[0],d=a.state.AnalyzeViewData.Questions.filter(function(a){return a.Index===c.Index+1})[0].Field;a.setState({QuestionIdForDetailsModal:d})},goToPreviousModalCallback:function(){var c=a.state.AnalyzeViewData.Questions.filter(function(a){return a.Field===b})[0],d=a.state.AnalyzeViewData.Questions.filter(function(a){return a.Index===c.Index-1})[0].Field;a.setState({QuestionIdForDetailsModal:d})},closeSelf:function(){a.setState({QuestionIdForDetailsModal:null})}})},e.prototype.onResponseCountChange=function(){var a=this.props.Form;a.Model.ResponsesCount!==a.Model.Responses.length&&a.syncFormResponses().done(function(){return b.DesignPage.getUxStateMaster().hideErrorMessageBar("RefreshResponses")}).fail(function(a){b.DesignPage.getUxStateMaster().showErrorMessageBar("RefreshResponses",a.innerCode)})},e.prototype.refreshAnalyzeViewAfterFormUpdate=function(a){var b=this;c.AnalyzeDataHelper.createAnalyzeViewData(a).done(function(d){var e=b.state.CurrentResponseId;!e&&d.Answers[0]&&(e=d.Answers[0].field_id);var f=c.AnalyzeDataHelper.getBranchedQuestions(a,d.Answers);b.analyzeViewDataChanged=!0,b.mounted&&b.setState({AnalyzeViewData:d,CurrentResponseId:e,BranchedQuestions:f})})},e.prototype.onResponseListChange=function(a){var b=a.Master,c=b.Model.Responses.length!==a.OldValues.Responses.length;c&&this.refreshAnalyzeViewAfterFormUpdate(b)},e.prototype.onQuestionListChange=function(a){var b=a.Master,c=!_.isEqual(a.NewValues.Questions,a.OldValues.Questions);c&&this.refreshAnalyzeViewAfterFormUpdate(b)},e}(a.ReactComponent)}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){function c(a){return React.createElement(d,__assign({},a))}b.createAnalyzeViewContainer=c;var d=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),c.prototype.render=function(){var a=this.props.Form,c=(this.props.Form.Model.ResponsesCount,this.props.showErrorPage);return a.SettingMaster.Model.IsQuizMode?b.createQuizAnalyzeView({FormMaster:a,showErrorPage:c}):b.createSurveyAnalyzeView({FormMaster:a,showErrorPage:c})},c}(a.ReactComponent)}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return React.createElement(g,__assign({},a))}var e=a.Control.SimpleDialog,f=a.Control.MenuControl;c.createAnalyzeViewMenu=d;var g=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;return a.needSelect=!1,a.clipboardList=[],a.setExternalSettingCallback=function(){var c=b.DesignPage.getUxStateMaster().Model.FormsTenantSettings;a.setState({IsExternalSharingAllowed:null==c||c.externalShareResult})},a.exportingStatusChangedCallback=function(){return a.forceUpdate()},a.state={ConfirmDialogPrompt:void 0,ResetMenu:!1,ShowShareSummaryResultContainer:!1,ShowDeleteShareResultLinkContainer:!1,ShowSpinner:!0,ShowErrorBox:!1,PermissionToken:"",IsExternalSharingAllowed:null==b.DesignPage.getUxStateMaster().Model.FormsTenantSettings||b.DesignPage.getUxStateMaster().Model.FormsTenantSettings.externalShareResult},a}return __extends(d,c),d.prototype.componentDidUpdate=function(){var a=document.getElementById("share-result-container-textbox-link")||document.getElementById("share-result-cancel-button");a&&(a.focus(),this.needSelect&&(document.getElementById("share-result-container-copy-button").click(),a.select(),this.needSelect=!1))},d.prototype.componentDidMount=function(){this.copyClipboard("#share-result-container-copy-button","#share-result-container-copy-button-status",b.Resources.LocalizedStrings.SharePane_Link_SuccessMessage,b.Resources.LocalizedStrings.SharePane_Link_FailedMessage),b.DesignPage.getUxStateMaster().observe(this.setExternalSettingCallback,[b.DesignPage.UxStateFields.FormsTenantSettings]),this.props.onReExportToExcel&&this.props.Form.observe(this.exportingStatusChangedCallback,[b.Model.FormMaster.Schema.XlExportingLocalTag])},d.prototype.componentWillUnmount=function(){this.clipboardList.forEach(function(a){a&&a.destroy()}),this.clipboardList=[],b.DesignPage.getUxStateMaster().unobserve(this.setExternalSettingCallback),this.props.onReExportToExcel&&this.props.Form.unobserve(this.exportingStatusChangedCallback)},d.prototype.render=function(){return this.shouldShowAnalyzeViewMenu()?React.createElement("div",null,this.getMenuControl(),this.getConfirmDialog(),this.getShareSummaryResultConfirmDialog()):null},d.prototype.shouldShowAnalyzeViewMenu=function(){var b=!!this.props.onDelete||!!this.props.onPostScore,c=a.Utilities.isMobile()?b:b||!!this.props.onPrint;return c},d.prototype.getDeleteResponseItem=function(){var c=this;if(this.props.onDelete){var d={Action:function(){return c.props.onDelete()},ActionButtonText:b.Resources.LocalizedStrings.AnalyzeView_ResetResponses_Reset_ButtonText,CancelButtonText:b.Resources.LocalizedStrings.AnalyzeView_ResetResponses_Cancel_ButtonText,DialogDescription:this.props.DeleteAllResponses?b.Resources.LocalizedStrings.AnalyzeView_ResetResponses_DescriptionText:b.Resources.LocalizedStrings.AnalyzeView_ResetResponse_DescriptionText},e=function(){c.props.onBeforeDeletedDialogShown&&c.props.onBeforeDeletedDialogShown(),c.setState({ConfirmDialogPrompt:d})},f=this.props.DeleteAllResponses?b.Resources.LocalizedStrings.AnalyzeView_ResetResponses_ButtonText:b.Resources.LocalizedStrings.AnalyzeView_DeleteSingleResponse_ButtonText,g={Checked:!1,Description:f,Key:"deleteResponseItem",MenuItemType:a.Control.MenuItemType.Normal,onExecute:e,IsDisabled:!this.props.HasAnswers};return g}return null},d.prototype.getPrintItem=function(){var c=this;if(!a.Utilities.isMobile()&&this.props.onPrint){var d=function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.PrintAnalyzeView}),c.props.onPrint()},e=this.props.DeleteAllResponses?b.Resources.LocalizedStrings.AnalyzeView_PrintResponses_ItemText:b.Resources.LocalizedStrings.AnalyzeView_PrintSingleResponse_ItemText,f={Checked:!1,Description:e,Key:"printItem",MenuItemType:a.Control.MenuItemType.Normal,onExecute:d,IsDisabled:!this.props.HasAnswers};return f}return null},d.prototype.getPostScoreItem=function(){var c=this;if(this.props.onPostScore&&!OfficeFormServerInfo.userInfo.IsMsa){var d={Action:this.props.onPostScore,ActionButtonText:b.Resources.LocalizedStrings.GradingView_ReleaseResponse_Confirm_Release,CancelButtonText:b.Resources.LocalizedStrings.GradingView_ReleaseResponse_Confirm_Cancel,DialogDescription:b.Resources.LocalizedStrings.GradingView_ReleaseResponse_Confirm_Description},e=this.props.IsScoreReleased?b.Resources.LocalizedStrings.GradingView_AlreadyReleased:b.Resources.LocalizedStrings.GradingView_Release,f=function(){return c.setState({ConfirmDialogPrompt:d})},g={Checked:!1,Description:e,IsDisabled:this.props.IsScoreReleased,Key:"postScoreItem",MenuItemType:a.Control.MenuItemType.Normal,onExecute:f};return g}return null},d.prototype.getReExportToExcelItem=function(){var c=this;if(!a.Utilities.isMobile()&&this.props.onReExportToExcel){var d=function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.PopupReExportToExcelDialog}),c.setState({ConfirmDialogPrompt:f})},e=function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.ReExportToExcel}),c.props.onReExportToExcel()},f={Action:function(){c.props.Form.ensureFieldsReady([b.Model.FormMaster.Schema.XlExportingLocalTag]).done(function(){c.props.Form.SetToExporting(),e()}),b.DesignPage.getUxStateMaster().hideErrorMessageBar("ReexportToExcelFile")},ActionButtonText:b.Resources.LocalizedStrings.VirtualKeyboard_Button_Enter,CancelButtonText:b.Resources.LocalizedStrings.AnalyzeView_ResetResponses_Cancel_ButtonText,DialogDescription:b.Resources.LocalizedStrings.ReExportToExcel_Confirm_Message},g=b.Resources.LocalizedStrings.ReExportToExcel,h={Checked:!1,IsDisabled:this.props.Form.IsExporting(),Description:g,Key:"ReExportToExcelItem",MenuItemType:a.Control.MenuItemType.Normal,onExecute:d};return h}return null},d.prototype.getMenuControl=function(){var c=this,d=[this.getDeleteResponseItem(),this.getPrintItem(),this.shareResultItem(),this.getPostScoreItem(),this.getReExportToExcelItem()].filter(function(a){return!!a}),e={ClassName:"analyze-view-ellipsis-button",Description:b.Resources.LocalizedStrings.AnalyzeView_Menu_Button,ButtonStyle:a.Control.ButtonStyle.LightBackground,ChildrenContent:a.Control.createFontIconControl({HTMLAttributes:{className:"forms-icon-size20x20"},IconName:"More"})},g={ClassNameForContainer:"analyze-view-menu-control-container",Disabled:this.props.Disabled,MenuTriggerButton:e,Reset:this.state.ResetMenu,UnorderListMenuItems:d,onMenuReset:function(){return c.setState({ResetMenu:!1})}};return React.createElement(f,__assign({},g))},d.prototype.getConfirmDialog=function(){var b=this,c=this.state.ConfirmDialogPrompt;if(c){var d={ButtonStyle:a.Control.ButtonStyle.DarkBackGround,ClassName:"delete-confirm-control-reset-button",GlyphButtonStyle:a.Control.GlyphButtonStyle.Horizontal,Key:"deleteConfirmItem",Text:c.ActionButtonText,onClick:function(){b.setState({ConfirmDialogPrompt:void 0,ResetMenu:!0}),c.Action&&c.Action(),b.props.onDeleteDialogDismissed&&b.props.onDeleteDialogDismissed()}},f={ButtonStyle:a.Control.ButtonStyle.DarkBackGround,ClassName:"delete-confirm-control-cancel-button",GlyphButtonStyle:a.Control.GlyphButtonStyle.Horizontal,Key:"cancelConfirmItem",Text:c.CancelButtonText,onClick:function(){b.setState({ConfirmDialogPrompt:void 0,ResetMenu:!0}),b.props.onDeleteDialogDismissed&&b.props.onDeleteDialogDismissed()}},g=[d,f].filter(function(a){return!!a}),h={ButtonsProps:g,ClassName:"delete-confirm-control-container",Description:c.DialogDescription,ShowDialog:!!c,TextClassName:this.props.ConfirmDialogTextClassName,TrapFocus:!0,onBlur:function(){return b.setState({ConfirmDialogPrompt:void 0})},onDismiss:function(){return b.setState({ConfirmDialogPrompt:void 0,ResetMenu:!0})}};return React.createElement(e,__assign({},h))}},d.prototype.shareResultItem=function(){var c=this;if(this.props.onShareResult){var d=function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.GetSummaryResult}),c.setState({ShowShareSummaryResultContainer:!0,ShowDeleteShareResultLinkContainer:!1}),c.props.PermissionToken?c.setState({PermissionToken:c.props.PermissionToken,ShowSpinner:!1}):c.props.onCreatePermissionToken().done(function(a){c.setState({PermissionToken:a,ShowSpinner:!1})}).fail(function(a){c.setState({ShowSpinner:!1,ShowErrorBox:!0});var d=b.Resources.LocalizedStrings.Error_Message_Failed_Create_Permission_Token;c.showErrorStatus(d,"#share-result-error-status")}),c.needSelect=!0},e=this.props.PermissionToken?b.Resources.LocalizedStrings.AnalyzeView_Get_Share_Result_Link:b.Resources.LocalizedStrings.AnalyzeView_Create_Share_Result_Link,f={Checked:!1,Description:e,Key:"shareResultItem",MenuItemType:a.Control.MenuItemType.Normal,onExecute:d,Title:b.Resources.LocalizedStrings.AnalyzeView_Share_Result_Link_Tooltip};return f}return null},d.prototype.getShareSummaryResultConfirmDialog=function(){var b=this;return this.state.ShowShareSummaryResultContainer?React.createElement("div",{className:"delete-confirm-control-container share-result",key:"shareResultDialog",ref:"shareResultDialog",tabIndex:-1,onBlur:function(c){var d=a.Utilities.Html.getTargetElementOfFocusEvent(c),e=ReactDOM.findDOMNode(b.refs.shareResultDialog);e.contains(d)||b.setState({ShowShareSummaryResultContainer:!1})}},this.createShareResultLinkContainer(),this.confirmDeleteShareResultLinkContainer()):void 0},d.prototype.createShareResultLinkContainer=function(){var c=this;if(!this.state.ShowDeleteShareResultLinkContainer){var d={id:a.Utilities.Html.getHashes().FormId,AnalyzerToken:this.state.PermissionToken},e="../Pages/AnalysisPage.aspx?"+jQuery.param(d),f=a.Utilities.Html.getAbsoluteUrl(e),g=!this.state.IsExternalSharingAllowed||a.EnvironmentConfig.isSovereignProd()||a.Utilities.isPhishingForm(this.props.Form.Model.OnlineSafetyLevel)?b.Resources.LocalizedStrings.AnalyzeView_Share_Result_Link_Internal_Title:b.Resources.LocalizedStrings.AnalyzeView_Share_Result_Link_External_Title,h=!this.state.IsExternalSharingAllowed&&!a.EnvironmentConfig.isSovereignProd()&&React.createElement(a.Control.FontIconControl,{IconName:"Error",HTMLAttributes:{title:b.Resources.LocalizedStrings.AnalyzeView_Share_Result_Link_Warning_Message,className:"flex-pane-dropdown-option-alert"}}),i=React.createElement("div",{className:"share-result-container-title"},g,h),j=React.DOM.input({disabled:!1,readOnly:!0,value:f,className:"share-result-container-textbox",id:"share-result-container-textbox-link",onClick:function(){var a=$("#share-result-container-textbox-link");a.focus(),a.select()},"aria-label":b.Resources.LocalizedStrings.AnalyzeView_Share_Result_Link_External_Title}),k={className:"share-result-contaienr-copy-button office-form-theme-button",id:"share-result-container-copy-button",disabled:this.state.ShowSpinner,onClick:function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Share.CopyAnalysisResultLink})}};k["data-clipboard-target"]="#share-result-container-textbox-link";var l=a.Control.createTextButton({HTMLAttributes:k,ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.SharePane_Link_CopyButton,ref:"copyButton",key:"copyButton"}),m=a.Control.createGlyphButton({HTMLAttributes:{className:"share-result-contaienr-delete-button",onClick:function(){return c.setState({ShowDeleteShareResultLinkContainer:!0})},disabled:this.state.ShowSpinner},ButtonStyle:a.Control.ButtonStyle.LightBackground,GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly,Icon:"Delete",IconClassName:"share-result-contaienr-delete-button-icon forms-icon-size18x18",Text:b.Resources.LocalizedStrings.AnalyzeView_Delete_Share_Result_Link_Button}),n=React.createElement("div",{className:"share-result-status",id:"share-result-container-copy-button-status",role:"alert"}),o=void 0;return this.state.ShowErrorBox&&(o=React.createElement("div",{className:"share-result-error-status",id:"share-result-error-status"})),React.createElement("div",{className:"share-result-content"},this.closeButton(),i,j,l,m,n,o,this.showSpinner())}},d.prototype.confirmDeleteShareResultLinkContainer=function(){var c=this;if(this.state.ShowDeleteShareResultLinkContainer){var d=React.createElement("div",{className:"share-result-confirm-delete-text"},b.Resources.LocalizedStrings.AnalyzeView_Delete_Share_Result_Link_Title),e=a.Control.createTextButton({HTMLAttributes:{className:"share-result-confirm-cancel-button",id:"share-result-cancel-button",onClick:function(){c.setState({ShowDeleteShareResultLinkContainer:!1,ResetMenu:!0}),c.needSelect=!0}},Text:b.Resources.LocalizedStrings.AnalyzeView_Cancel_Share_Result_Link_Button,ButtonStyle:a.Control.ButtonStyle.LightBackground}),f=a.Control.createTextButton({HTMLAttributes:{className:"share-result-confirm-delete-button",onClick:function(){c.setState({ShowShareSummaryResultContainer:!1,ResetMenu:!0}),c.props.onDeletePermissionToken&&(c.props.onDeletePermissionToken(),c.setState({ShowSpinner:!0}))}},Text:b.Resources.LocalizedStrings.AnalyzeView_Delete_Share_Result_Link_Button,ButtonStyle:a.Control.ButtonStyle.LightBackground});return React.createElement("div",{className:"share-result-delete-content"},this.closeButton(),d,React.createElement("div",{className:"share-result-confirm-delete-buttons"},e,f))}},d.prototype.closeButton=function(){var c=this;return a.Control.createGlyphButton({HTMLAttributes:{className:"share-result-close-button",onClick:function(){return c.setState({ShowShareSummaryResultContainer:!1})}},Icon:"Cancel",IconClassName:"share-result-close-button-icon forms-icon-size14x14",ButtonStyle:a.Control.ButtonStyle.LightBackground,GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly,Text:b.Resources.LocalizedStrings.AnalyzeView_Close_Button})},d.prototype.showSpinner=function(){return this.state.ShowSpinner?React.createElement("div",{className:"share-result-spinner-container"},React.createElement("div",{className:"share-resilt-spinner"},React.createElement("div",{className:"spinner-tile-animation"}))):void 0},d.prototype.copyClipboard=function(b,c,d,e){var f=new Clipboard(b);this.clipboardList.push(f);var g=this.props.Form;f.on("success",function(b){g.triggerShareAction(),a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.CopySummaryLink});var e=$(c);e.removeClass("flex-pane-status-error"),e.addClass("flex-pane-status-success"),e.text(d),e.show(),setTimeout(function(){e.fadeOut("slow",function(){e.hide()})},3e3),b.clearSelection()}),f.on("error",function(d){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Send.ActionFailed,extraData:{action:b}});var f=$(c);f.removeClass("flex-pane-status-success"),f.text(e),f.addClass("flex-pane-status-error")})},d.prototype.showErrorStatus=function(a,b){var c=$(b);c.addClass("flex-pane-status-error"),c.removeClass("flex-pane-status-success"),c.text(a),c.show(),setTimeout(function(){c.fadeOut("slow")},3e3)},d}(a.ReactComponent);c.AnalyzeViewMenu=g}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return new e(a)}c.getExportExcelProcessor=d;var e=function(){function c(b){if(this.CustomizeResponsePagingSizeQueryString="DownloadFileSize",this.ResponsePagingSizeForLargeForm=1500,this.responsePagingSize=5e3,this.form=b,this.processorQueue=[],this.isProcessing=!1,this.isCustomizedResponsePagingSizeValid()){var c=parseInt(a.Utilities.Html.getQueries()[this.CustomizeResponsePagingSizeQueryString]);this.responsePagingSize=c}}return Object.defineProperty(c.prototype,"TotalFileCount",{get:function(){return this.totalFileCount},enumerable:!0,configurable:!0}),c.prototype.start=function(){return this.isIosDevice()?void this.showErrorMessage({innerCode:a.DataProvider.ErrorCode.InnerCode.DownloadExcelFileFailedOnIos}):void(this.isProcessing||(a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.DownloadExcelFileStart,extraData:{totalResponseCountRange:Math.ceil(this.form.Model.ResponsesCount/this.responsePagingSize),isQuiz:this.form.SettingMaster.Model.IsQuizMode,isIos:this.isIosDevice()}}),this.isProcessing=!0,this.startTime=(new Date).getTime(),this.process()))},c.prototype.stop=function(b){void 0===b&&(b=!1),a.Event.EngagementEventDeprecated.logData({name:b?a.Event.EngagementEventNames.DesignPage.Analysis.DownloadExcelFileFailed:a.Event.EngagementEventNames.DesignPage.Analysis.DownloadExcelFileSuccess,extraData:{fileCount:Math.ceil(this.form.Model.ResponsesCount/this.responsePagingSize),timeCost:(new Date).getTime()-this.startTime,isQuiz:this.form.SettingMaster.Model.IsQuizMode}}),this.isProcessing=!1,this.processorQueue=[],this.stopCallback&&this.stopCallback()},c.prototype.addAction=function(a){this.processorQueue.push(a)},c.prototype.addAndProcessAction=function(a){this.addAction(a),this.start()},c.prototype.downloadAllResponses=function(){this.prepareDownloadQueue(),this.start()},c.prototype.observeEveryDownloadComplete=function(a){this.downloadCompleteCallback=a},c.prototype.observeStop=function(a){this.stopCallback=a},c.prototype.shouldForceToDownloadExcel=function(){return this.isCustomizedResponsePagingSizeValid()},c.prototype.prepareDownloadQueue=function(){var a=this.form.Model.ResponsesCount;this.totalFileCount=Math.ceil(a/this.responsePagingSize),this.finishedDownloadFileCount=0,this.processorQueue=[];for(var b=1;a>=b;b+=this.responsePagingSize)this.processorQueue.push({minResponseId:b,maxResponseId:Math.min(b+this.responsePagingSize-1,a)})},c.prototype.isCustomizedResponsePagingSizeValid=function(){var b=parseInt(a.Utilities.Html.getQueries()[this.CustomizeResponsePagingSizeQueryString]);return!isNaN(b)&&b>0},c.prototype.process=function(){var a=this;if(this.isProcessing)if(this.totalFileCount>this.processorQueue.length&&this.downloadCompleteCallback&&(this.finishedDownloadFileCount=this.totalFileCount-this.processorQueue.length,this.downloadCompleteCallback()),this.processorQueue.length>0){var b=this.processorQueue.shift();window.setTimeout(function(){return a.downloadExcelFileUsingRequest(b.minResponseId,b.maxResponseId)})}else this.stop()},c.prototype.downloadExcelFileUsingRequest=function(d,e){var f=this;a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.DownloadOnePagingExcelFile}),b.DesignPage.getUxStateMaster().hideErrorMessageBar("DownloadExcelFile"),window.clearTimeout(c.hideErrorBarMessageTimeout),c.hideErrorBarMessageTimeout=null,this.form.downloadExcelFile(d,e).done(function(){b.DesignPage.getUxStateMaster().hideErrorMessageBar("DownloadExcelFile"),f.process()}).fail(function(b){b.innerCode===a.DataProvider.ErrorCode.InnerCode.DownloadExcelFileFailed?(f.stop(!0),f.showErrorMessage(b)):b.innerCode===a.DataProvider.ErrorCode.InnerCode.DownloadExcelFileTimeout&&(f.stop(!0),f.responsePagingSize=f.ResponsePagingSizeForLargeForm,f.showErrorMessage(b))})},c.prototype.showErrorMessage=function(a){b.DesignPage.getUxStateMaster().showErrorMessageBar("DownloadExcelFile",a.innerCode),c.hideErrorBarMessageTimeout=window.setTimeout(function(){b.DesignPage.getUxStateMaster().hideErrorMessageBar("DownloadExcelFile"),c.hideErrorBarMessageTimeout=null},1e4)},c.prototype.isIosDevice=function(){var a=window.navigator.platform.toLocaleLowerCase(),b=window.navigator.userAgent.toLocaleLowerCase();return a.match(/iphone|ipod|ipad/)||b.match(/iphone|ipod|ipad/)},c}();c.DownloadExcelProcessor=e}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(d){function e(){var a=null!==d&&d.apply(this,arguments)||this;return a.MaxResponseCountForDownload=5e3,a}return __extends(e,d),Object.defineProperty(e.prototype,"DownloadExcelProcessor",{get:function(){return this.m_downloadExcelProcessor=this.m_downloadExcelProcessor||c.getExportExcelProcessor(this.props.Form)},enumerable:!0,configurable:!0}),e.prototype.shouldExportExcelToOneDrive=function(){if(a.DataProvider.FeaturePlanProvider.isMsaUser()&&!a.Flighting.Flight.isEnabled(a.Flighting.Flights.EnableOnlineExcelForMSA))return!1;if(this.DownloadExcelProcessor.shouldForceToDownloadExcel())return!1;var b=(this.props.Form.Model.ResponsesCount,a.Utilities.Flight.isDebugOpenExcelInOneDrive()||!!this.props.Form.Model.XlWorkbookId);return b},e.prototype.onExportExcel=function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.OpenInExcel,extraData:{xlworkbookid:this.props.Form.Model.XlWorkbookId}}),this.shouldExportExcelToOneDrive()?(this.openExcelInOneDrive(),b.Model.getUserProfileMaster().Model.ExportToExcelCalloutVersion=b.DesignPage.TeachingCalloutUtilities.MAXRUNVERSION.toString()):(a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.DownloadMultipleExcelFiles}),this.DownloadExcelProcessor.downloadAllResponses())},e.prototype.openExcelInOneDrive=function(){var c=this;a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.OpenExcelInOneDrive}),this.props.Form.ensureFieldsReady([b.Model.FormMaster.Schema.Id]).done(function(){var b=c.props.Form.Model.Id,d="RedirectToExcelPage.aspx?id="+encodeURIComponent(b)+"&forceReExport=false";a.Utilities.Html.safeOpen(d)})},e.prototype.exportToExcelUsingCollabDB=function(){this.props.Form.createExportFile().done(function(){b.DesignPage.getUxStateMaster().hideErrorMessageBar("ExportResponsesToExcel")}).fail(function(a){b.DesignPage.getUxStateMaster().showErrorMessageBar("ExportResponsesToExcel",a.innerCode)})},e.prototype.downloadExcelFileUsingRequest=function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.DownloadExcelFile}),b.DesignPage.getUxStateMaster().hideErrorMessageBar("DownloadExcelFile"),window.clearTimeout(e.hideErrorBarMessageTimeout),e.hideErrorBarMessageTimeout=null,this.props.Form.downloadExcelFile(0,0).done(function(){b.DesignPage.getUxStateMaster().hideErrorMessageBar("DownloadExcelFile")}).fail(function(c){("Error"==c.innerMessage||a.EnvironmentConfig.isOsi())&&(b.DesignPage.getUxStateMaster().showErrorMessageBar("DownloadExcelFile",c.innerCode),e.hideErrorBarMessageTimeout=window.setTimeout(function(){b.DesignPage.getUxStateMaster().hideErrorMessageBar("DownloadExcelFile"),e.hideErrorBarMessageTimeout=null},1e4))})},e}(a.ReactComponent);c.ExportExcelBase=d}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(c){function d(){var d=null!==c&&c.apply(this,arguments)||this;return d.observeFileDownloadCompleteCallback=function(){d.state.IsPreparingFile&&d.forceUpdate()},d.observeXlExportingTagChangedCallback=function(){d.props.Form.ensureFieldsReady([b.Model.FormMaster.Schema.XlExportingLocalTag]).done(function(){var c=!1;d.props.Form.IsExporting()?c=!0:d.props.Form.IsExportingFailed()&&d.state.IsPreparingFile&&b.DesignPage.getUxStateMaster().showErrorMessageBar("ReexportToExcelFile",a.DataProvider.ErrorCode.InnerCode.ReexportToExcelFailed),d.setState({IsPreparingFile:c})})},d.observeDownloadingStopCallback=function(){return d.setState({IsPreparingFile:!1})},d.onXlFileUnsyncedStateChange=function(){return d.forceUpdate()},d.showCalloutCallback=function(){return d.showCallout()},d.exportToExcelCallback=function(){return d.exportToExcel()},d.onReexportLinkClickedCallback=function(){return d.onReexportLinkClicked()},d.onAlertCalloutBlurCallback=function(a){return d.onAlertCalloutBlur(a)},d}return __extends(d,c),d.prototype.componentDidMount=function(){var a=this;this.props.Form.ensureFieldsReady([b.Model.FormMaster.Schema.Id]).then(function(){a.DownloadExcelProcessor.observeEveryDownloadComplete(a.observeFileDownloadCompleteCallback),a.DownloadExcelProcessor.observeStop(a.observeDownloadingStopCallback)});var c=b.Model.FormMaster.Schema;this.props.Form.observe(this.observeXlExportingTagChangedCallback,[c.XlExportingLocalTag]),this.props.Form.observe(this.onXlFileUnsyncedStateChange,[c.XlFileUnsynced])},d.prototype.componentWillUnmount=function(){this.props.Form.unobserve(this.observeXlExportingTagChangedCallback),b.DesignPage.getUxStateMaster().hideErrorMessageBar("ReexportToExcelFile")},d.prototype.render=function(){return React.createElement("div",null,this.createExportToExcelButton(),this.createAlertCallout(),this.createTeachingCallout(),this.createLoadingMessage())},d.prototype.createExportToExcelButton=function(){if(this.state.IsPreparingFile)return null;var d,e,f;this.props.Form.Model.XlFileUnsynced?(d=React.createElement("span",{key:"alert",className:"export-to-excel-button-alert"}),e=this.showCalloutCallback,f=b.Resources.LocalizedStrings.AnalyzeView_Export_Excel_File_Unsynced_Alert):(e=this.exportToExcelCallback,f=b.Resources.LocalizedStrings.AnalyzeView_Export_Excel);var g=c.prototype.shouldExportExcelToOneDrive.call(this),h={title:f,className:"analyze-view-export-button-container",onClick:e,disabled:!this.props.Form.isFieldReady(b.Model.FormMaster.Schema.Id)||this.props.Form.Model.ResponsesCount<=0&&!this.shouldExportExcelToOneDrive()};return a.Control.createGlyphButton({HTMLAttributes:h,Icon:g?"exportOnedriveIcon":"ExcelLogo",IconClassName:"forms-icon-size24x24",Text:b.Resources.LocalizedStrings.AnalyzeView_Export_Excel,TextClassName:"analyze-view-export-button-label",ButtonStyle:a.Control.ButtonStyle.LightBackground,GlyphButtonStyle:a.Control.GlyphButtonStyle.Horizontal,children:d})},d.prototype.createTeachingCallout=function(){return!this.state.IsPreparingFile&&this.shouldExportExcelToOneDrive()?b.DesignPage.Teaching.createExportToExcelTeachingCallout({}):null},d.prototype.createLoadingMessage=function(){if(!this.state.IsPreparingFile)return null;var a;return a=c.prototype.shouldExportExcelToOneDrive.call(this)?b.Resources.LocalizedStrings.ReExportToExcel_Loading_Message:this.DownloadExcelProcessor.TotalFileCount>1?b.Resources.LocalizedStrings.DownloadExcel_Preparing_For_Multiple_File.format(this.DownloadExcelProcessor.finishedDownloadFileCount,this.DownloadExcelProcessor.TotalFileCount):b.Resources.LocalizedStrings.DownloadExcel_Preparing_For_Single_File,
React.createElement("div",{role:"alert"},this.createLoadingSpinner(),React.createElement("span",{className:"download-excel-progress-description"},a))},d.prototype.createLoadingSpinner=function(){var b={ClassName:"download-excel-loading-container"};return React.createElement(a.Control.LoadingControl,__assign({},b))},d.prototype.createAlertCallout=function(){if(this.state.ShowAlertCallout){var a=b.Resources.LocalizedStrings;return React.createElement("div",{className:"export-button-alert-callout",onBlur:this.onAlertCalloutBlurCallback,ref:"alert-callout",tabIndex:-1},React.createElement("div",{className:"unsynced-message"},a.AnalyzeView_Export_Excel_File_Unsynced_Alert),React.createElement("button",{className:"analyze-view-link-button reexport-link",onClick:this.onReexportLinkClickedCallback,ref:"alert-link"},React.createElement("span",null,a.AnalyzeView_Export_Excel_File_Reexport)))}},d.prototype.showCallout=function(){var a=this;this.setState({ShowAlertCallout:!0},function(){var b=ReactDOM.findDOMNode(a.refs["alert-link"]);b&&b.focus()})},d.prototype.exportToExcel=function(){this.shouldExportExcelToOneDrive()||this.setState({IsPreparingFile:!0}),c.prototype.onExportExcel.call(this)},d.prototype.onAlertCalloutBlur=function(b){var c=a.Utilities.Html.getTargetElementOfFocusEvent(b),d=ReactDOM.findDOMNode(this.refs["alert-callout"]);d&&!d.contains(c)&&this.setState({ShowAlertCallout:!1})},d.prototype.onReexportLinkClicked=function(){var b=this.props.Form.Model.Id,c="RedirectToExcelPage.aspx?id="+encodeURIComponent(b)+"&forceReExport=true";a.Utilities.Html.hiddenOpen(c),this.setState({ShowAlertCallout:!1,IsPreparingFile:!0})},d}(c.ExportExcelBase);c.ExportExcelButton=d}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b;!function(a){a[a.PieChart=0]="PieChart",a[a.BarChart=1]="BarChart",a[a.Treemap=2]="Treemap",a[a.WordCloud=3]="WordCloud"}(b=a.IvyChartType||(a.IvyChartType={}));var c=function(){function a(){}return a.createIvyChartByType=function(c,d,e){e===b.PieChart?a.createIvyPieChart(c,d):e===b.BarChart?a.createIvyBarChart(c,d):e===b.Treemap?a.createIvyTreemapChart(c,d):e===b.WordCloud&&a.createIvyWordCloudChart(c,d)},a.createIvyBarChart=function(b,c){var d=document.getElementById(b.Field),e=[{id:"id_"+b.Field,data:{1:c.options.map(function(a){return a.Title}),2:c.options.map(function(a){return a.Data})},layout:ivy.Extensions.ColumnClusteredSeriesLayout.Id}];a.createIvyChart(e,d,!1,!0)},a.createIvyPieChart=function(b,c){var d=document.getElementById(b.Field),e=c.options.map(function(a,c){return{id:"id_"+b.Field+c,title:a.Title,data:{1:[a.Data],2:[a.Data]},layout:ivy.Extensions.PieSubsliceSeriesLayout.Id}});a.createIvyChart(e,d,!0,!0)},a.createIvyTreemapChart=function(b,c){var d=document.getElementById(b.Field),e=[{id:"id_"+b.Field,data:{1:c.options.map(function(a){return a.Title}),5:c.options.map(function(a){return a.Data}),16:c.options.map(function(a){return 4294967295})},layout:ivy.Extensions.TreemapSeriesLayout.Id}];a.createIvyChart(e,d,!1,!0)},a.createIvyWordCloudChart=function(b,c){var d=document.getElementById(b.Field),e=[{id:"id_"+b.Field,data:{1:c.options.map(function(a){return a.Title}),2:c.options.map(function(a){return a.Data})},layout:ivy.Extensions.WordCloudSeriesLayout.Id}];a.createIvyChart(e,d,!1,!0)},a.createIvyChart=function(a,b,c,d){var e={animating:!0,hasDataLabels:d,hasChartTitle:!1,hasLegendTitle:!1,hasLegend:c,legendEdge:0,legendPosition:1,seriesData:a,width:b.clientWidth+250,height:b.clientHeight},f=new ivy.Host({base:"https://edera.cloudapp.net",secret:"IvyBearerToken"}),g=new ivy.IvyChart(f,b);g.setRenderer(1),g.setConfiguration(e)},a}();a.IvyChartHelper=c}(b=a.Analysis||(a.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(){function a(){}return a.showQuestionPoint=function(a){return a.Model.IsQuiz&&!!a.Model.Point},a.showAverageScore=function(a){var b=0;return _.forEach(a.Questions,function(a){a.IsQuiz&&a.Point&&(b+=a.Point)}),a.QuizQuestionsCount>0&&b},a.createTotalPointsDesigner=function(a){var c=0,d=!1;return _.forEach(a.Questions,function(a){a.IsQuiz&&(c+=a.Point||0,d=!0)}),d&&c?React.DOM.span({className:"office-form-theme-quiz-totalPoints-bar",key:"points"},b.RendererHelper.getBracketPointText(c)):void 0},a}();c.QuizView=d,a.Exports.Analysis=c}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return React.createElement(e,a)}c.createResponsesDetailDialog=d;var e=function(d){function e(){var a=null!==d&&d.apply(this,arguments)||this;return a.closeRef=React.createRef(),a}return __extends(e,d),e.prototype.componentDidMount=function(){this.mounted=!0,this.closeRef.current&&this.closeRef.current.focus(),Forms.UX.Utilities.trapFocusInsideElement(ReactDOM.findDOMNode(this)),this.createDataTable()},e.prototype.componentDidUpdate=function(){var a=this,b=this.props.AnalyzeViewData.Questions.filter(function(b){return b.Field===a.props.QuestionId})[0],c=this.calculateFilteredResponseData(b);c.length>0&&this.createDataTable()},e.prototype.componentWillUnmount=function(){this.mounted=!1},e.prototype.render=function(){var b=this;return React.DOM.div({className:"response-dialog-container",onKeyDown:function(c){(c.keyCode===a.KeyCode.BackSpace||c.keyCode===a.KeyCode.ArrowLeft&&c.altKey)&&(c.stopPropagation(),c.preventDefault()),c.keyCode===a.KeyCode.Esc&&b.props.closeSelf()}},this.createPreviousQuestionButton(),this.createResponsesDetailDialog(),this.createNextQuestionButton())},e.prototype.createResponsesDetailDialog=function(){var c=this,d=this.props.AnalyzeViewData,e=d.Questions.filter(function(a){return a.Field===c.props.QuestionId})[0],f=React.DOM.div({className:"response-dialog-title"},a.Control.createUserTextRenderer({Text:b.Resources.LocalizedStrings.AnalyzeView_QuestionTitle.format(e.Index+1,e.Model.Title),RenderMode:a.Control.UserTextRenderMode.RichText})),g=this.calculateFilteredResponseData(e),h=React.DOM.div({className:"response-dialog-summary"},React.DOM.div({className:"response-dialog-response-count office-form-theme-primary-foreground"},g.length),b.Resources.LocalizedStrings.AnalyzeView_Total_Response),i=React.DOM.button({ref:this.closeRef,className:"response-dialog-close-button",title:b.Resources.LocalizedStrings.AnalyzeView_DetailResponses_Close_Button,onClick:function(){return c.props.closeSelf()}},a.Control.createFontIconControl({HTMLAttributes:{className:"forms-icon-size16x16"},IconName:"Cancel"})),j={"aria-label":b.Resources.LocalizedStrings.AnalyzeView_Detail_DialogTitle.format(e.Index+1),className:"response-dialog",role:"dialog"};if(0===g.length){var k=React.DOM.div({className:"response-dialog-no-responses-message"},b.Resources.LocalizedStrings.AnalyzeView_DetailResponses_NoResponses_Message);return React.DOM.div(j,i,f,h,k)}var l=React.DOM.div({className:"response-dialog-content"},React.DOM.div({className:"response-dialog-table-container"},React.DOM.table({className:"response-dialog-table hover stripe cell-border"}))),m=_.findWhere(d.Questions,{Field:this.props.QuestionId});return m.Model.Type===b.Model.QuestionType.FileUpload&&(h=this.createFileUploadDetailSummary(g)),React.DOM.div(j,i,f,h,l)},e.prototype.createFileUploadDetailSummary=function(c){var d=this,e=c[0][this.props.QuestionId];if(e){var f=a.Control.createTextButton({HTMLAttributes:{className:"response-dialog-folder-button office-form-theme-button",onClick:function(){var b=d.props,c=_.findWhere(b.AnalyzeViewData.Questions,{Field:b.QuestionId}),e=c.Model.FileUploadFolderId;if(e){var f=e.split(";").filter(function(a){return""!==a}),g=f[f.length-1];g&&new Forms.DataProvider.FileUploadProcessProvider(c.Master.Form.Model.Id).getFileFolder(g).done(function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.OpenFileFolder}),a.Utilities.Html.safeOpen(b)}).fail(function(b){b&&b.response&&b.response.statusCode===a.DataProvider.ErrorCode.HttpStatusCode.NotFound&&(d.setState({ShowErrorMessage:!0}),setTimeout(function(){d.mounted&&d.state.ShowErrorMessage&&d.setState({ShowErrorMessage:!1})},5e3))})}}},ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.UploadFile_OpenFolder_Button}),g=this.state.ShowErrorMessage?React.DOM.div({className:"response-dialog-folder-button-error-message"},b.Resources.LocalizedStrings.UploadFile_FolderNotExist_ErrorMessage):void 0;return React.DOM.div(null,React.DOM.div({className:"response-dialog-summary"},React.DOM.div({className:"response-detail-dialog-container"},React.DOM.span({className:"response-dialog-response-count office-form-theme-primary-foreground"},c.length),b.Resources.LocalizedStrings.UploadFile_Files_OneDreive),f),g)}},e.prototype.createNextQuestionButton=function(){var c=this,d=this.props.AnalyzeViewData.Questions.filter(function(a){return a.Field===c.props.QuestionId})[0];if(null!=this.props.goToNextModalCallback&&d.Index!==this.props.AnalyzeViewData.Questions.length-1){var e={className:"response-dialog-next-button",title:b.Resources.LocalizedStrings.AnalyzeView_DetailResponses_Next_Button,onClick:this.props.goToNextModalCallback},f=a.Control.createGlyphButton({HTMLAttributes:e,Icon:"ChevronRight",GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly,ButtonStyle:a.Control.ButtonStyle.LightBackground});return f}},e.prototype.createPreviousQuestionButton=function(){var c=this,d=this.props.AnalyzeViewData.Questions.filter(function(a){return a.Field===c.props.QuestionId})[0];if(null!=this.props.goToPreviousModalCallback&&0!==d.Index){var e={className:"response-dialog-previous-button",title:b.Resources.LocalizedStrings.AnalyzeView_DetailResponses_Previous_Button,onClick:this.props.goToPreviousModalCallback},f=a.Control.createGlyphButton({HTMLAttributes:e,Icon:"ChevronLeft",GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly,ButtonStyle:a.Control.ButtonStyle.LightBackground});return f}},e.prototype.createTableHeaders=function(a,c,d){var e=(this.props.AnalyzeViewData,[b.Resources.LocalizedStrings.AnalyzeView_Sort_First,b.Resources.LocalizedStrings.AnalyzeView_Sort_Second,b.Resources.LocalizedStrings.AnalyzeView_Sort_Third,b.Resources.LocalizedStrings.AnalyzeView_Sort_Fourth,b.Resources.LocalizedStrings.AnalyzeView_Sort_Fifth,b.Resources.LocalizedStrings.AnalyzeView_Sort_Sixth,b.Resources.LocalizedStrings.AnalyzeView_Sort_Seventh,b.Resources.LocalizedStrings.AnalyzeView_Sort_Eighth,b.Resources.LocalizedStrings.AnalyzeView_Sort_Ninth,b.Resources.LocalizedStrings.AnalyzeView_Sort_Tenth]),f=[b.Resources.LocalizedStrings.AnalyzeView_Total_Response],g=[{title:b.Resources.LocalizedStrings.AnalyzeView_Response_ID},{title:b.Resources.LocalizedStrings.AnalyzeView_ExcelHeader_ResponderName}],h=this.getAnswerColumnCount(c),i=[],j=60/h+"%";switch(a){case b.Model.QuestionType.Ranking:$(".response-dialog-table").addClass("response-dialog-table-ranking"),i=_.first(e,h);break;case b.Model.QuestionType.MatrixChoiceGroup:i=f;for(var k=1;h>k;k++)i.push("");break;case b.Model.QuestionType.NPS:i=[b.Resources.LocalizedStrings.AnalyzeView_NPS_Score,b.Resources.LocalizedStrings.AnalyzeView_NPS_Category];break;default:$(".response-dialog-table").removeClass("response-dialog-table-ranking"),i=f}return i=i.map(function(a){return{title:a,width:j}}),d&&i.push({title:b.Resources.LocalizedStrings.AnalyzeView_Quiz_Validation}),g.concat(i)},e.prototype.createDataTable=function(){var d=this,f=this.props,g=f.AnalyzeViewData,h=_.findWhere(g.Questions,{Field:f.QuestionId}),i=c.AnalyzeHelper.isQuizQuestion(h.Model);this.datatable&&($(".dataTables_wrapper").remove(),$(".response-dialog-table").remove(),$(".response-dialog-table-container").append("<table class='response-dialog-table hover stripe cell-border'></table>"),this.datatable.destroy(),this.datatable=void 0);var j,k=this.calculateFilteredResponseData(h);if(h.Model.Type===b.Model.QuestionType.Ranking){var l=this.getAnswerColumnCount(f.QuestionId),m=h.Model.ChoiceGroup;j=k.map(function(a,b){var c=[];c=[b+1,a.field_responder_name];var e=a[h.Field].map(function(a,b){if(i){var c=m[b].Id===a.id?"#107C10":"#A80000";return"<span style='color:"+c+"'>"+d.getResponseString(a.displayText)+"</span>"}return d.getResponseString(a.displayText)});c=c.concat(e);for(var f=0;f<l-e.length;f++)c.push("");return i&&c.push(h.Master.isCorrectAnswer(a[h.Field])),c})}else h.Model.Type===b.Model.QuestionType.MatrixChoiceGroup?(j=k.map(function(a,b){var c=[b+1,a.field_responder_name],e=_.map(h.Master.SubQuestionMasters,function(b){var c="field_"+b.Model.Id;return a[c]?d.getResponseString(a[c].displayText):""});return c.concat(e)}),j.splice(0,0,["",""].concat(_.map(h.Master.SubQuestionMasters,function(a){return d.getResponseString(a.Model.Title)})))):j=h.Model.Type===b.Model.QuestionType.FileUpload?k.map(function(a,b){var e="";if(a[f.QuestionId]){var g=JSON.parse(a[f.QuestionId]);if(g.length>0){var j=g[0],k=Forms.UX.FileUpload.getFileIconInDetailTable(j.name),l=d.encodeResponseData(j.name),m=j.link.split('"')[0];e=k+('<a href="'+m+"\" target='_blank' class='response-dialog-fileName'>"+l+"</a>")}}var n=[b+1,a.field_responder_name,e];return i&&n.push(c.AnalyzeHelper.isCorrectAnswer(h,a)),n}):h.Model.Type===b.Model.QuestionType.NPS?k.map(function(a,b){var c=a[f.QuestionId];return[b+1,a.field_responder_name,c,Forms.UX.Controls.getNpsCategoryDescription(c)]}):k.map(function(a,b){var e=[b+1,a.field_responder_name,d.getResponseString(a[f.QuestionId])];return h.Model.IsMathQuiz&&e.push(a[f.QuestionId+"_math"]),i&&e.push(c.AnalyzeHelper.isCorrectAnswer(h,a)),e});var n=i?1:0;n+=h.Model.IsMathQuiz?1:0,this.datatable=$(".response-dialog-table").DataTable({data:i?j.map(function(a){var b=a.slice(0,a.length-n);return b.push(""),b}):j,columns:this.createTableHeaders(h.Model.Type,f.QuestionId,i),searching:!1,paging:!1,info:!1,autoWidth:!0,rowCallback:function(c,d,f){if(i){var g=j[d[0]-1][j[0].length-1],k=e.createCorrectnessIcon(g),l=$(c).find("td:eq("+(j[0].length-n)+")").get(0);ReactDOM.render(k,l)}if(h.Model.Type===b.Model.QuestionType.TextField&&h.Model.IsMathQuiz){var m=j[d[0]-1][j[0].length-n];if(m){var o=$(c).find("td:eq("+(j[0].length-n-1)+")").get(0),p=a.Control.createFormulaRenderer({Formula:d[2]});ReactDOM.render(p,o)}}}})},e.prototype.encodeResponseData=function(b){return b&&a.Utilities.Html.encodeHTML(""+b)},e.prototype.getResponseString=function(b){return a.Control.RichTextUtil.keepOnlyRichTextHtml(b)},e.prototype.calculateFilteredResponseData=function(a){var b=this.props,d=b.AnalyzeViewData.Answers;b.ShouldIncludeInvalidAnswers||(d=d.filter(function(b){return c.AnalyzeDataHelper.hasValidAnswer(b,a)}));var e=b.filterResponses;return null!=e&&(d=d.filter(function(a){return e(a)})),d},e.createCorrectnessIcon=function(c){return c?React.DOM.div({title:b.Resources.LocalizedStrings.GradingView_CorrectAnswer_AccessibilityLabel},React.DOM.a({className:"screenReaderVisible"},b.Resources.LocalizedStrings.GradingView_CorrectAnswer_AccessibilityLabel),a.Control.createFontIconControl({HTMLAttributes:{className:"forms-icon-size16x16 office-form-right-answerkey"},IconName:"CheckMark"})):React.DOM.div({title:b.Resources.LocalizedStrings.GradingView_IncorrectAnswer_AccessibilityLabel},React.DOM.a({className:"screenReaderVisible"},b.Resources.LocalizedStrings.GradingView_IncorrectAnswer_AccessibilityLabel),a.Control.createFontIconControl({HTMLAttributes:{className:"forms-icon-size16x16 office-form-wrong-answerkey"},IconName:"Cancel"}))},e.prototype.getAnswerColumnCount=function(a){var c=_.findWhere(this.props.AnalyzeViewData.Questions,{Field:this.props.QuestionId});switch(c.Model.Type){case b.Model.QuestionType.Ranking:return c.Model.ChoiceGroup.length||1;case b.Model.QuestionType.MatrixChoiceGroup:return c.Master.SubQuestionMasters.length||1;case b.Model.QuestionType.NPS:return 2;default:return 1}},e}(a.ReactComponent)}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(d){function e(){var a=null!==d&&d.apply(this,arguments)||this;return a.changeCallback=function(){a.isComponentMounted&&a.forceUpdate()},a.updatePermissionCallback=function(){var c=null,d=a.props.FormMaster.Model.PermissionTokens;if(d.length>0){var e=_.filter(d,function(a){return a.Type===b.Model.PermissionTokenType.AnalyzerToken&&a.Name===b.FormLimitation.AnalysisTokenName})[0];if(e){var f=Nerve.getObjectMasterFromModel(e);f.Synchronizer.existingInDataSource().then(function(){c=d[0].PrincipalId,a.setState({ShareResultToken:c})})}}else a.setState({ShareResultToken:c})},a.state={LibraryLoaded:!1,DetailDialogQuestionIndex:-1,ShareResultToken:null,InsightDialogOpened:!1,InsightType:null},a}return __extends(e,d),e.prototype.componentWillMount=function(){this.initialize(),this.registerObservers(),this.loadJavaScriptLibraries()},e.prototype.render=function(){return React.createElement("div",{className:"analyze-view-container",id:"analyzeViewPrintParent"},this.createAnalyzeViewContent(),this.createQuestionDetailDialog(),this.createInsightViewContainer(),React.createElement(Forms.UX.Renderer.ThemeRender,{ThemeMaster:this.props.FormMaster.ThemeMaster}))},e.prototype.componentDidMount=function(){var c=this;if(this.isComponentMounted=!0,this.updateVisibleStatus(),a.Event.NavPerfEventDeprecated.analyzePageTimeToChrome=a.Utilities.DateTime.getTimeStamp()-a.Event.NavPerfEventDeprecated.analyzePageStartTime,this.props.FormMaster.SyncContext===b.Model.FormSyncContext.DesignTimeForm)a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.Navigate}),b.Model.PermissionTokenMaster.getShareResultPermissionToken(this.props.FormMaster).done(function(a){c.setState({ShareResultToken:a})}).fail(function(){c.setState({ShareResultToken:null})});else if(this.props.FormMaster.SyncContext!==b.Model.FormSyncContext.AnalysisTimeForm){var d="Fatal Error: AnalyzeViewBase.componentDidMount SyncContext: ["+this.props.FormMaster.SyncContext+"] shouldn't come to analyize view";throw a.Event.ErrorEventDeprecated.logData({errorName:"InvalidServerAggregatePayload",errorInfo:d}),Error(d)}a.Utilities.OEmbed.notifyFormInfoToParentWindow(this.props.FormMaster)},e.prototype.componentDidUpdate=function(){this.updateVisibleStatus(),window.setTimeout(a.Utilities.OEmbed.notifyAnalysisPageHeightToParentWindow,0)},e.prototype.componentWillUnmount=function(){this.unregisterObservers(),this.formAggregationMaster&&(this.formAggregationMaster.terminateSync(),this.formAggregationMaster.release())},e.prototype.initialize=function(){this.formAggregationMaster=new b.Model.FormAggregationMaster(this.props.FormMaster)},e.prototype.registerObservers=function(){if(this.formAggregationMaster.observe(this.changeCallback,[b.Model.FormAggregationMaster.Schema.SummaryAggregation]),this.props.FormMaster.SyncContext!==b.Model.FormSyncContext.AnalysisTimeForm){var a=Nerve.getCollectionMasterFromModel(this.props.FormMaster.Model.PermissionTokens);a.observe(this.updatePermissionCallback,[a.Schema[0].PrincipalId])}},e.prototype.unregisterObservers=function(){this.formAggregationMaster&&this.formAggregationMaster.unobserve(this.changeCallback),this.props.FormMaster.SyncContext!==b.Model.FormSyncContext.AnalysisTimeForm&&Nerve.getCollectionMasterFromModel(this.props.FormMaster.Model.PermissionTokens).unobserve(this.updatePermissionCallback)},e.prototype.loadJavaScriptLibraries=function(){var b=this;$.when(a.JavaScriptLoader.loadJavaScript("DataTables"),a.JavaScriptLoader.loadJavaScript("Chart")).then(function(){b.setState({LibraryLoaded:!0})})},Object.defineProperty(e.prototype,"SummaryPanelProps",{get:function(){var a,c=this;return this.isExportExcelEnabled()&&(a=function(){return c.onExportExcel()}),{AggregationMaster:b.Model.getFormSummaryAggregationMaster(this.formAggregationMaster.Model.SummaryAggregation),Form:this.props.FormMaster,onDeleteResponses:function(){return c.onDeleteResponses()},onExportExcel:a,onPrint:function(){return c.onPrint()},onCreatePermissionToken:function(){return c.onCreatePermissionToken()},onDeletePermissionToken:function(){return c.onDeletePermissionToken()},PermissionToken:this.state.ShareResultToken}},enumerable:!0,configurable:!0}),e.prototype.createInsightViewContainer=function(){return null},Object.defineProperty(e.prototype,"FocusRef",{set:function(a){this.focusRef=a},enumerable:!0,configurable:!0}),e.prototype.createAnalyzeViewContent=function(){return React.createElement("div",{className:"analyze-view-content",id:"analyzeViewPrintChild"},React.createElement("div",{className:"analyze-view-formname"},this.props.FormMaster.Model.Title),this.createSummaryPanel(),this.createNavigationBar(),this.createQuestionsView())},e.prototype.createNavigationBar=function(){return this.formAggregationMaster.FormMaster.SyncContext!==b.Model.FormSyncContext.AnalysisTimeForm?React.createElement("div",{className:"analyze-view-nav-bar"},this.createExtensionReviewContent(),this.createExportExcelButton()):void 0},e.prototype.createExportExcelButton=function(){return React.createElement("div",{className:"analyze-view-export-to-excel-button"},React.createElement(c.ExportExcelButton,{Form:this.formAggregationMaster.FormMaster}))},e.prototype.createQuestionsView=function(){return this.state.LibraryLoaded?React.createElement("div",{className:"analyze-view-detail-content"},this.createQuestionsContent()):void 0},e.prototype.createQuestionsContent=function(){return this.props.FormMaster.Model.ResponsesCount>0?this.createQuestionsViewContent():this.createEmptyQuestionsViewContent()},e.prototype.createQuestionsViewContent=function(){var c=this,d=b.convertToArray(this.formAggregationMaster.Model.QuestionAggregations),e=0;return d.map(function(d,f){var g=b.Model.getQuestionAggregationMaster(d),h=void 0;if(g&&g.QuestionMaster&&g.QuestionMaster.Model.GroupId)return void 0;if(c.formAggregationMaster.FormMaster.SyncContext!==b.Model.FormSyncContext.AnalysisTimeForm){var i=e;h=function(){c.onDetailViewLinkClick(i)}}var j={AggregationMaster:g,Index:e++,onShowQuestionDetail:h};return a.Form.Analysis.createQuestionViewElement(j,c.QuestionClassType)})},e.prototype.createEmptyQuestionsViewContent=function(){return[React.createElement("div",{className:"analyze-view-detail-noresponses-container",key:"empty-questions-view"},React.createElement("div",{className:"analyze-view-warning-icon"},React.createElement(a.Control.FontIconControl,{IconName:"Sad"})),React.createElement("div",{className:"analyze-view-detail-noresponse-message"},b.Resources.LocalizedStrings.Analysis_Page_No_Responses_Message),React.createElement("div",{className:"analyze-view-detail-noresponse-detail"},b.Resources.LocalizedStrings.Analysis_Page_No_Responses_Details))]},e.prototype.onDeleteResponses=function(){var c=this;a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.DeleteAllResponses}),this.props.FormMaster.deleteAllResponses().done(function(){b.DesignPage.getUxStateMaster().hideErrorMessageBar("DeleteAllResponses",c.props.FormMaster.Model.Id),c.props.FormMaster.refreshFormResponsesCount()}).fail(function(a){b.DesignPage.getUxStateMaster().showErrorMessageBar("DeleteAllResponses",a.innerCode,c.props.FormMaster.Model.Id)})},e.prototype.isExportExcelEnabled=function(){return a.Flighting.Flight.isEnabled(a.Flighting.Flights.ReExportToExcelButton)&&this.props.FormMaster.SyncContext!==b.Model.FormSyncContext.AnalysisTimeForm&&!!this.props.FormMaster.Model.XlWorkbookId},e.prototype.onExportExcel=function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.OpenInExcel});var b="RedirectToExcelPage.aspx?id="+encodeURIComponent(this.props.FormMaster.Model.Id)+"&forceReExport=true";a.Utilities.Html.hiddenOpen(b)},e.prototype.onPrint=function(){var a=$("#analyzeViewPrintChild").appendTo($("body")),b=$("#content-root");b.hide(),window.print(),a.appendTo($("#analyzeViewPrintParent")),b.show()},e.prototype.onCreatePermissionToken=function(){var c=this;return b.Model.PermissionTokenMaster.appendPermissionToken(this.props.FormMaster,b.Model.PermissionTokenType.AnalyzerToken,b.FormLimitation.AnalysisTokenName).done(function(b){return a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Share.CreateAnalysisResulttLink}),c.setState({ShareResultToken:b}),b})},e.prototype.onDeletePermissionToken=function(){var c=this,d=this.props.FormMaster,e=b.Model.PermissionTokenMaster.getShareResultPermissions(d);e&&b.Model.PermissionTokenMaster.removePermissionToken(d,e).done(function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Share.DeleteAnalysisResultLink}),c.setState({ShareResultToken:null})})},e.prototype.onDetailViewLinkClick=function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.ShowResponsesDetail}),this.setState({DetailDialogQuestionIndex:b})},e.prototype.updateVisibleStatus=function(){var a=ReactDOM.findDOMNode(this);if($(a).is(":visible")&&!this.wasVisible){var b=ReactDOM.findDOMNode(this.refs[this.focusRef]);this.focusRef=void 0,b&&b.focus()}this.wasVisible=$(a).is(":visible")},e}(a.ReactComponent);c.AnalyzeViewBase=d}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(a){function d(){return null!==a&&a.apply(this,arguments)||this}return __extends(d,a),Object.defineProperty(d.prototype,"IsAggregationReady",{get:function(){return this.props.AggregationMaster.Model.IsAggregationReady},enumerable:!0,configurable:!0}),d.prototype.render=function(){return this.props.AggregationMaster?React.createElement("div",{className:"analyze-view-summary-content"},React.createElement("div",{className:"analyze-view-summary-table"},React.createElement("div",{className:"analyze-view-summary-container"},this.createResponsesCountView(),this.statisticsContent(),this.createStatusView()),this.createSummaryViewMenu()),this.insightContent(),React.createElement("div",{className:"analysis-page-row-line"})):void 0},d.prototype.createResponsesCountView=function(){var a=this.props.AggregationMaster.Model,d={AccessibilityText:b.Resources.LocalizedStrings.AnalyzeView_NumberOfResponses_AccessibilityLabel.format(a.TotalResponseCount),Data:a.TotalResponseCount,Description:b.Resources.LocalizedStrings.AnalyzeView_Total_Response,Ignorable:!1,IsReady:null!==a.TotalResponseCount};return React.createElement(c.SimpleDataControl,__assign({},d))},d.prototype.getAverageTimeProps=function(){var a=this.averageFillTime(),c={AccessibilityText:b.Resources.LocalizedStrings.AnalyzeView_Average_Fill_Time_Minutes_Seconds_Explicit.format(a.minutes,a.seconds),Data:b.Resources.LocalizedStrings.AnalyzeView_Average_Fill_Time_Minutes_Seconds_Short.format(a.minutes<10?"0"+a.minutes:a.minutes,a.seconds<10?"0"+a.seconds:a.seconds),Description:b.Resources.LocalizedStrings.AnalyzeView_Average_Fill_Time,Ignorable:!0,IsReady:0===this.props.AggregationMaster.Model.TotalResponseCount||this.IsAggregationReady};return c},d.prototype.statisticsContent=function(){return React.createElement(c.SimpleDataControl,__assign({},this.getAverageTimeProps()))},d.prototype.averageFillTime=function(){if(this.props.AggregationMaster.Model.TotalResponseCount>0){var a=this.props.AggregationMaster.Model.AverageSubmitTime/1e3,b=Math.floor(a/60),c=Math.floor(a%60);return{minutes:b,seconds:c}}return{minutes:0,seconds:0}},d.prototype.createStatusView=function(){var a=this.getFormStatus(),d={AccessibilityText:b.Resources.LocalizedStrings.AnalyzeView_FormStatus_AccessibilityLabel.format(a),Data:a,Description:b.Resources.LocalizedStrings.AnalyzeView_Status_Label,Ignorable:!1,IsReady:null!=this.props.AggregationMaster.Model.FormStatus};return React.createElement(c.SimpleDataControl,__assign({},d))},d.prototype.insightContent=function(){return null},d.prototype.getFormStatus=function(){switch(this.props.AggregationMaster.Model.FormStatus){case b.Model.FormStatusType.Opened:return b.Resources.LocalizedStrings.AnalyzeView_Status_Active;case b.Model.FormStatusType.Closed:case b.Model.FormStatusType.Expired:case b.Model.FormStatusType.NotStarted:return b.Resources.LocalizedStrings.AnalyzeView_Status_Closed;default:return b.Resources.LocalizedStrings.AnalyzeView_Status_Unknown}},d.prototype.createSummaryViewMenu=function(){if(this.props.AggregationMaster.FormMaster.SyncContext!==b.Model.FormSyncContext.AnalysisTimeForm&&this.IsAggregationReady){var a={AggregationMaster:this.props.AggregationMaster,HasAnswers:this.props.AggregationMaster.Model.TotalResponseCount>0,DeleteAllResponses:!0,Form:this.props.Form,onDelete:this.props.onDeleteResponses,onPrint:this.props.onPrint,onShareResult:!0,onDeletePermissionToken:this.props.onDeletePermissionToken,onCreatePermissionToken:this.props.onCreatePermissionToken,PermissionToken:this.props.PermissionToken,onReExportToExcel:this.props.onExportExcel};return React.createElement(c.AnalyzeViewMenu,__assign({},a))}},d}(a.ReactComponent);c.AnalyzeViewSummaryPanelBase=d}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){function b(a){return Nerve.getObjectMasterFromModel(a)}var c;!function(a){a.Survey="Survey",a.Quiz="Quiz"}(c=a.QuestionClassType||(a.QuestionClassType={}));var d=Nerve.Spec,e={QuestionId:d.create(d.string(),{IsKeyField:!0}),IsAggregationReady:d["boolean"](),IsMathQuestion:d["boolean"](),ChoiceQuestionAggregation:d.create({ChoiceSummary:d.collectionOf({Choice:d.string(),Count:d.number(),IsFormula:d["boolean"]()})}),TextQuestionAggregation:d.create({TopAnswers:d.collectionOf({Id:d.number(),Answer:d.string(),IsMath:d["boolean"]()}),ResponseCount:d.number(),TextSummary:d.collectionOf({Text:d.string(),Count:d.number(),IsMath:d["boolean"]()})}),RatingQuestionAggregation:d.create({AverageRating:d.number(),ResponseCount:d.number()}),DateQuestionAggregation:d.create({TopDate:d.collectionOf({Id:d.number(),Answer:d.reference()}),ResponseCount:d.number()}),RankingQuestionAggregation:d.collectionOf({Id:d.number(),Name:d.string(),Statistics:d.collectionOf(d.number()),Weight:d.number()}),LikertQuestionAggregation:d.create({Options:d.collectionOf(d.string()),LikertResults:d.collectionOf({SubQuestionId:d.string(),SubQuestionName:d.string(),Statistics:d.collectionOf(d.number())})}),FileUploadQuestionAggregation:d.create({RecentFile:d.collectionOf({Answer:d.string()}),ResponseCount:d.number()}),NPSQuestionAggregation:d.create({Promoters:d.number(),Passives:d.number(),Detractors:d.number(),ResponseCount:d.number()}),GradeStatistics:d.create({CorrectCount:d.number(),WrongCount:d.number()})};a.getQuestionAggregationMaster=b;var f=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}return __extends(d,b),d.prototype.aggregate=function(b){var d=this;this.bulkEdit(function(){var e=d.FormMaster.Model.Settings.IsQuizMode?c.Quiz:c.Survey;a.QuestionAggregateDelegatorBase.getAggregateDelegator(d.QuestionType,e).aggregate(b,d.Model)})},Object.defineProperty(d.prototype,"FormMaster",{get:function(){return this.Parent.Parent.FormMaster},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"QuestionMaster",{get:function(){return this.FormMaster.getQuestionById(this.Model.QuestionId)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"QuestionType",{get:function(){return this.QuestionMaster.Model.Type},enumerable:!0,configurable:!0}),d.prototype.getTotalResponsesCount=function(){return this.FormMaster.Model.ResponsesCount},d}(Nerve.createObjectMasterClass("QuestionAggregation",e));a.QuestionAggregationMaster=f}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;
!function(b){var c;!function(c){var d=function(d){function e(){var a=null!==d&&d.apply(this,arguments)||this;return a.aggregationChangeCallback=function(){return a.forceUpdate()},a.questionDetailsButton=React.createRef(),a}return __extends(e,d),e.prototype.componentWillMount=function(){this.onClickQuestionDetailButton=this.onClickQuestionDetailButton.bind(this),this.props.AggregationMaster.observe(this.aggregationChangeCallback,[b.Model.QuestionAggregationMaster.Schema.IsAggregationReady])},e.prototype.render=function(){return this.props.AggregationMaster?React.createElement("div",{className:"analyze-view-detail"},this.createQuestionViewTitle(this.props.Index),this.createQuestionViewContext(),React.createElement("div",{className:"analyze-view-detail-linebreak"})):void 0},e.prototype.componentWillUnmount=function(){this.props.AggregationMaster.unobserve(this.aggregationChangeCallback,[b.Model.QuestionAggregationMaster.Schema.IsAggregationReady])},e.prototype.createQuestionViewTitle=function(a){return React.createElement("div",{className:"analzye-view-detail-question"},React.createElement("div",{className:"analzye-view-detail-ordinal"},a+1+"."),this.createQuestionTitleContent())},e.prototype.createQuestionViewContext=function(){return React.createElement("div",{className:"survey-analyze-view-detail-container"},this.createDetailButton(this.props.Index),this.createQuestionViewContentContainer(),this.createLoadingContent())},e.prototype.createDetailButton=function(a){if(this.props.onShowQuestionDetail){var c={className:"analyze-view-link-button analyze-view-detail-show-responses-data-button",title:b.Resources.LocalizedStrings.AnalyzeView_ShowDetailResponses_Button.format(a+1),onClick:this.onClickQuestionDetailButton,ref:this.questionDetailsButton};return React.createElement("div",{className:"question-view-detail-label"},React.createElement("button",__assign({},c),React.createElement("span",{className:"analyze-view-detail-show-responses-data-text"},b.Resources.LocalizedStrings.QuestionView_Detail_Label)))}},e.prototype.createQuestionViewContentContainer=function(){return this.props.AggregationMaster.Model.IsAggregationReady?React.createElement("div",{className:"question-view-content-container"},this.createQuestionViewContent()):void 0},e.prototype.createLoadingContent=function(){return this.props.AggregationMaster.Model.IsAggregationReady?void 0:React.createElement("div",{className:"question-view-loading-content-container"},this.createPreviewBackground(),this.createLoadingSpinner())},e.prototype.createPreviewBackground=function(){var a="../Images/question_backgrounds/"+this.getPreviewImageName();return React.createElement("div",{className:"question-view-background-image"},React.createElement("img",{src:a}))},e.prototype.createLoadingSpinner=function(){var b={ClassName:"question-view-loading-spinner-container",Ignorable:!1};return React.createElement(a.Control.LoadingControl,__assign({},b))},e.prototype.onClickQuestionDetailButton=function(){var a=this;Forms.UX.Utilities.trackFocusJump(c.SurveyResponsesDetailDialog.name,function(){a.questionDetailsButton.current&&a.questionDetailsButton.current.focus()}),this.props.onShowQuestionDetail&&this.props.onShowQuestionDetail()},e}(a.ReactComponent);c.QuestionViewBase=d}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){function b(a,b){var c=b+a.getTypeName();d[c]=a}function c(a,b){var c=b+a.AggregationMaster.QuestionType,e=d[c];if(e)return a.key=a.key||a.AggregationMaster.Model.QuestionId,React.createElement(e,a);throw Error('Type "'+c+'" has not been registered.')}var d={};a.registerQuestionViewClass=b,a.createQuestionViewElement=c}(b=a.Analysis||(a.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.getTypeName=function(){return b.Model.QuestionType.Choice},d.prototype.getPreviewImageName=function(){return this.props.AggregationMaster.QuestionMaster.Model.Choices.length<=5?"pie.png":"bar.png"},d.prototype.createQuestionViewContent=function(){return[this.createChartControlContainer()]},d.prototype.createChartControlContainer=function(){var c=this,d=b.convertToArray(this.props.AggregationMaster.Model.ChoiceQuestionAggregation.ChoiceSummary),e=_.map(d,function(a){return{labelName:"answer_other"===a.Choice?b.Resources.LocalizedStrings.Designer_OtherAnswer:a.Choice,displayElement:c.createDisplayElement(a)}}),f={Animation:this.props.AggregationMaster.Model.IsAggregationReady,Data:{data:d.map(function(a){return a.Count})},Labels:e,HasLegend:!0,TagLabels:this.CorrectOptions,Type:d.length<=5?a.Control.ChartType.Pie:a.Control.ChartType.Bar};return React.createElement(a.Control.ChartControl,__assign({},f,{key:"chartControl"}))},d}(c.QuestionViewBase);c.ChoiceQuestionViewBase=d}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.render=function(){return React.createElement("div",{className:this.props.ClassName},this.createAccessibilityText(),React.createElement("div",__assign({className:"analyze-view-summary-circle"},this.getAttributesToHideFromScreenReader()),React.createElement("div",{className:"analyze-view-summary-circle-text office-form-theme-primary-foreground"},this.props.Count)),React.createElement("div",__assign({className:"analyze-view-text"},this.getAttributesToHideFromScreenReader()),this.props.Description))},b.prototype.createAccessibilityText=function(){return this.props.AccessibilityText?React.createElement("a",{className:"screenReaderVisible"},this.props.AccessibilityText):void 0},b.prototype.getAttributesToHideFromScreenReader=function(){return this.props.AccessibilityText?{"aria-hidden":!0,role:"presentation"}:void 0},b}(a.ReactComponent);b.DataCircleControl=c}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.getTypeName=function(){return a.Model.QuestionType.DateTime},d.prototype.getPreviewImageName=function(){return"text.png"},d.prototype.createQuestionViewContent=function(){return[this.createResponsesCountLabel(),this.createDateStatistics()]},d.prototype.createResponsesCountLabel=function(){var c={Data:this.props.AggregationMaster.Model.DateQuestionAggregation.ResponseCount,Description:a.Resources.LocalizedStrings.AnalyzeView_Total_Response,Ignorable:!1,IsReady:!0};return React.createElement(b.SimpleDataControl,__assign({},c,{key:"responseCount"}))},d.prototype.createDateStatistics=function(){return React.createElement("div",{className:"survey-analyze-view-detail-text-recent",key:"latestResponses"},React.createElement("div",{className:"analyze-view-summary-status-label"},a.Resources.LocalizedStrings.Analyze_View_Text_Recent_Responses),this.createLatestDates())},d.prototype.createLatestDates=function(){var b=_.pluck(a.convertToArray(this.props.AggregationMaster.Model.DateQuestionAggregation.TopDate),"Answer");return _.map(b,function(a,b){var c=a&&a.toDateShortString(OfficeFormServerInfo.cultureInfo);return React.createElement("div",{className:"analyze-view-detail-text-lines",key:b},'"'+c+'"')})},d}(b.QuestionViewBase);b.DateQuestionViewBase=c}(b=a.Analysis||(a.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.getTypeName=function(){return a.Model.QuestionType.FileUpload},d.prototype.getPreviewImageName=function(){return"text.png"},d.prototype.createQuestionViewContent=function(){return[this.createResponsesCountLabel(),this.createLatestFilesView()]},d.prototype.createResponsesCountLabel=function(){var c={Data:this.props.AggregationMaster.Model.FileUploadQuestionAggregation.ResponseCount,Description:a.Resources.LocalizedStrings.AnalyzeView_Total_Response,Ignorable:!1,IsReady:!0};return React.createElement(b.SimpleDataControl,__assign({},c,{key:"responseCount"}))},d.prototype.createLatestFilesView=function(){return React.createElement("div",{className:"survey-analyze-view-detail-text-recent",key:"latestResponses"},React.createElement("div",{className:"analyze-view-summary-status-label"},a.Resources.LocalizedStrings.Analyze_View_Text_Recent_Responses),this.getLatestTexts())},d.prototype.getLatestTexts=function(){var b=_.pluck(a.convertToArray(this.props.AggregationMaster.Model.FileUploadQuestionAggregation.RecentFile),"Answer");return _.map(b,function(a,b){if(a){var c=a.split(",")[0].split(":")[1].split('"')[1],d=Forms.UX.FileUpload.getFileIcon(c);return React.createElement("div",{className:"analyze-view-detail-text-lines",key:b},d,React.createElement("span",{className:"analyze-view-detail-fileName"},c))}})},d}(b.QuestionViewBase);b.FileUploadQuestionViewBase=c}(b=a.Analysis||(a.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return React.createElement(f,__assign({},a))}a.Exports.Insight=c;var e;!function(a){a[a.SummaryInsight=0]="SummaryInsight",a[a.CorrelationInsight=1]="CorrelationInsight",a[a.ExplainDiffInsight=2]="ExplainDiffInsight",a[a.Outstanding=3]="Outstanding",a[a.OutstandingCollection=4]="OutstandingCollection",a[a.AssociationRuleInsight=5]="AssociationRuleInsight",a[a.FunctionalDependency=6]="FunctionalDependency",a[a.IntraclassInsight=7]="IntraclassInsight",a[a.RatingKeywordsInsight=8]="RatingKeywordsInsight",a[a.LikertAssociationRuleInsight=9]="LikertAssociationRuleInsight",a[a.PartialOrderInsight=10]="PartialOrderInsight",a[a.NPSKeywordsInsight=11]="NPSKeywordsInsight",a[a.ResponseSentimentInsight=12]="ResponseSentimentInsight",a[a.KeywordSentimentInsight=13]="KeywordSentimentInsight",a[a.KeyPhrasesInsight=14]="KeyPhrasesInsight",a[a.SummaryDistribution=15]="SummaryDistribution",a[a.SummaryDistributionCollection=16]="SummaryDistributionCollection",a[a.CorrelationInsightCollection=17]="CorrelationInsightCollection",a[a.ResponseSentimentInsightCollection=18]="ResponseSentimentInsightCollection",a[a.TimeDistributionInsight=19]="TimeDistributionInsight"}(e=c.InsightType||(c.InsightType={})),c.createInsightView=d,c.insightColorPallet=[["#0078d8","#01439e"],["#ee2872","#a7183f"],["#8cc83f","#458114"],["#13a89f","#066a62"],["#922790","#5e115d"],["#e92224","#a3140b"],["#4655a0","#182d72"],["#672e91","#3a0f62"],["#117d10","#044604"]];var f=function(c){function d(a){var b=c.call(this,a)||this;return b.insightViewInitialTimeStamp=Date.now(),b.props.setCurrentViewInsight(b.props.Insight),b.tooltipMouseOverHandler=b.tooltipMouseOverHandler.bind(b),b}return __extends(d,c),d.prototype.componentWillUpdate=function(a,b){this.contentUpdated=!_.isEqual(this.props,a)||!_.isEqual(this.state,b)},d.prototype.componentDidUpdate=function(){this.contentUpdated&&(this.registerTooltipMouseOverEventHandler(),this.logAndResetInsightViewDuration(),this.props.focusOnInsightDialog(),this.updateContent())},d.prototype.componentDidMount=function(){this.props.focusOnInsightDialog(),this.registerTooltipMouseOverEventHandler()},d.prototype.componentWillUnmount=function(){this.logAndResetInsightViewDuration(),this.unregisterTooltipMouseOverEventHandler()},d.prototype.render=function(){return React.createElement("div",{className:"insight-view-content",ref:"insight-content"},this.createInsightSummary(),this.createInsightSource())},d.prototype.createInsightSummary=function(){return React.createElement("div",{className:"insight-view-description-summary"},React.createElement("div",{className:"insight-view-description-summary-detail"},this.insightViewDescriptionDetail()))},d.prototype.createInsightSource=function(){var b=this;if(!this.shouldShowSourceQuestions())return null;var c,d=null,e="insight-view-description-source-icon forms-icon-size14x14 select-placeholder-arrow";this.state.ShowSourceDetail?(d=this.insightViewSourceQuestions(),c="ChevronUp"):c="ChevronDown";var f={"aria-label":this.getSourceButtonTitle(),className:"insight-view-descrption-source-title",onClick:function(){return b.setState({ShowSourceDetail:!b.state.ShowSourceDetail})},tabIndex:0,onKeyDown:function(c){(c.keyCode===a.KeyCode.Enter||c.keyCode===a.KeyCode.Space)&&b.setState({ShowSourceDetail:!b.state.ShowSourceDetail})}};return React.createElement("div",{className:"insight-view-source-questions"},React.createElement("div",{className:"insight-view-description-source-container"},React.createElement("div",__assign({},f),React.createElement("span",{className:"insight-view-description-source-text"},this.getSourceButtonTitle()),React.createElement(a.Control.FontIconControl,{HTMLAttributes:{className:e},IconName:c}))),d)},d.prototype.shouldShowSourceQuestions=function(){return!0},d.prototype.getSourceButtonTitle=function(){return b.Resources.LocalizedStrings.AnalyzeView_Insight_Source_Title},d.prototype.createSourceQuestionTitle=function(a){return b.Resources.LocalizedStrings.AnalyzeView_Insight_Source_Question_Template.format(a.QuestionOrder,a.Title)},d.prototype.createSourceQuestionTooltip=function(c){var d=b.Resources.LocalizedStrings.AnalyzeView_Insight_Tooltip_Template.format(c.QuestionOrder),e=b.Resources.LocalizedStrings.Analyze_Insight_summary_Question_Title.format(c.QuestionOrder,a.Utilities.Html.sanitize(c.Title));return'<span class="insight-tooltip">'+d+'<span class="insight-tooltip-text">'+e+"</span></span>"},d.prototype.registerTooltipMouseOverEventHandler=function(){var a=this,b=document.getElementsByClassName("insight-tooltip");_.forEach(b,function(b){b.addEventListener("mouseover",a.tooltipMouseOverHandler)})},d.prototype.unregisterTooltipMouseOverEventHandler=function(){var a=this,b=document.getElementsByClassName("insight-tooltip");_.forEach(b,function(b){b.removeEventListener("mouseover",a.tooltipMouseOverHandler)})},d.prototype.getRatingRange=function(a){var b=0;switch(a){default:case 2:case 3:b=0;break;case 4:case 5:case 6:case 7:b=1;break;case 8:case 9:b=2;break;case 10:b=3}return[[1,1+b],[a-b,a]]},d.prototype.tooltipMouseOverHandler=function(a){var b=125,c=a.currentTarget,d=ReactDOM.findDOMNode(this.refs["insight-content"]),e=c.firstElementChild,f=c.getBoundingClientRect(),g=d.getBoundingClientRect();f.right+b>g.right?e.style.left="-"+e.clientWidth+"px":f.left-b<g.left&&(e.style.left="0px"),f.top+b>g.bottom&&(e.style.top="-"+(e.clientHeight+15)+"px")},d.prototype.logAndResetInsightViewDuration=function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.ReleaseInsightView,extraData:{Duration:Date.now()-this.insightViewInitialTimeStamp,InsightType:this.props.Insight.Type}}),this.insightViewInitialTimeStamp=Date.now()},d}(a.ReactComponent);c.InsightViewBase=f}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){function b(a,b){d[b]=a}function c(a){var b=a.Insight.Type,c=d[b];if(c)return React.createElement(c,a);throw Error('Type "'+b+'" has not been registered.')}var d={};a.registerInsightViewClass=b,a.createInsightViewElement=c}(b=a.Analysis||(a.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(a){a[a.SupportChart=0]="SupportChart",a[a.TargetChart=1]="TargetChart"}(d||(d={}));var e;!function(a){a[a.Support=0]="Support",a[a.Target=1]="Target"}(e||(e={}));var f;!function(a){a[a.Description=0]="Description",a[a.AriaLabel=1]="AriaLabel"}(f||(f={}));var g=function(e){function f(){return null!==e&&e.apply(this,arguments)||this}return __extends(f,e),f.prototype.componentWillUnmount=function(){this.destroyD3Chart(),this.unregisterTooltipMouseOverEventHandler(),e.prototype.componentWillUnmount.call(this)},f.prototype.componentDidMount=function(){this.destroyD3Chart(),this.createCharts(),this.registerTooltipMouseOverEventHandler(),e.prototype.componentDidMount.call(this)},f.prototype.insightViewDescriptionDetail=function(){return React.createElement("div",{className:"association-rule-insight-container"},React.createElement("div",{className:"association-rule-insight-description"},this.insightViewDescription(),this.insightViewCharts()))},f.prototype.shouldShowSourceQuestions=function(){return!1},f.prototype.insightViewSourceQuestions=function(){return null},f.prototype.updateContent=function(){this.destroyD3Chart(),this.createCharts(),this.registerTooltipMouseOverEventHandler(),this.triggerChartAnimation("chartDescription")},f.prototype.getAnswerValue=function(c){var d=c.Value[0].RawValue;if("Rating"===c.Question.Type||"NPS"===c.Question.Type){var e=this.getRatingRange(c.Question.Choices.length);switch(c.Value[0].RawValue){case"Detractors":d=b.Resources.LocalizedStrings.AnalyzeView_Insight_Association_Rule_Detractor_Answer;break;case"High":d=b.Resources.LocalizedStrings.AnalyzeView_Insight_Association_Rule_High_Rating_Template.format(e[1][0],e[1][1]);break;case"Low":d=b.Resources.LocalizedStrings.AnalyzeView_Insight_Association_Rule_Low_Rating_Template.format(e[0][0],e[0][1]);break;case"Passives":d=b.Resources.LocalizedStrings.AnalyzeView_Insight_Association_Rule_Passive_Answer;break;case"Promoters":d=b.Resources.LocalizedStrings.AnalyzeView_Insight_Association_Rule_Promoter_Answer}}return a.Utilities.Html.sanitize(d)},f.prototype.isCategorizedType=function(a){var b=a.Type.toUpperCase();return"RATING"===b||"NPS"===b},f.prototype.insightViewDescription=function(){var c,d=this.props.Insight,e=this.isCategorizedType(d.ConditionAnswers[0].Question),f=this.isCategorizedType(d.TargetAnswer.Question);c=100===Math.ceil(100*d.ConfidenceValue)?e&&f?b.Resources.LocalizedStrings.AnalyzeView_Insight_Association_Rule_Description_Categorized_Categorized_All:e?b.Resources.LocalizedStrings.AnalyzeView_Insight_Association_Rule_Description_Categorized_Common_All:f?b.Resources.LocalizedStrings.AnalyzeView_Insight_Association_Rule_Description_Common_Categorized_All:b.Resources.LocalizedStrings.AnalyzeView_Insight_Association_Rule_Description_Common_Common_All:e&&f?b.Resources.LocalizedStrings.AnalyzeView_Insight_Association_Rule_Description_Categorized_Categorized:e?b.Resources.LocalizedStrings.AnalyzeView_Insight_Association_Rule_Description_Categorized_Common:f?b.Resources.LocalizedStrings.AnalyzeView_Insight_Association_Rule_Description_Common_Categorized:b.Resources.LocalizedStrings.AnalyzeView_Insight_Association_Rule_Description_Common_Common;var g=c.format(this.getAnswerValue(d.ConditionAnswers[0]),this.createSourceQuestionTooltip(d.ConditionAnswers[0].Question),this.getAnswerValue(d.TargetAnswer),this.createSourceQuestionTooltip(d.TargetAnswer.Question)),h=c.format(this.getAnswerValue(d.ConditionAnswers[0]),a.Utilities.Html.sanitize(d.ConditionAnswers[0].Question.Title),this.getAnswerValue(d.TargetAnswer),a.Utilities.Html.sanitize(d.TargetAnswer.Question.Title));return React.createElement("div",{"aria-label":h,className:"association-rule-insight-description-text-container",dangerouslySetInnerHTML:{__html:g},tabIndex:0})},f.prototype.insightViewCharts=function(){var d,e=this.props.Insight;d=this.isCategorizedType(e.ConditionAnswers[0].Question)?b.Resources.LocalizedStrings.AnalyzeView_Insight_Association_Rule_Legend_Support_Categorized:b.Resources.LocalizedStrings.AnalyzeView_Insight_Association_Rule_Legend_Support_Common;var f;f=this.isCategorizedType(e.TargetAnswer.Question)?b.Resources.LocalizedStrings.AnalyzeView_Insight_Association_Rule_Legend_Target_Categorized:b.Resources.LocalizedStrings.AnalyzeView_Insight_Association_Rule_Legend_Target_Common;var g=d.format(Math.ceil(100*e.SupportValue),this.getAnswerValue(e.ConditionAnswers[0]),this.createSourceQuestionTooltip(e.ConditionAnswers[0].Question)),h=f.format(Math.ceil(100*e.ConfidenceValue),this.getAnswerValue(e.TargetAnswer),this.createSourceQuestionTooltip(e.TargetAnswer.Question)),i=d.format(Math.ceil(100*e.SupportValue),this.getAnswerValue(e.ConditionAnswers[0]),a.Utilities.Html.sanitize(e.ConditionAnswers[0].Question.Title)),j=f.format(Math.ceil(100*e.ConfidenceValue),this.getAnswerValue(e.TargetAnswer),a.Utilities.Html.sanitize(e.TargetAnswer.Question.Title)),k=c.insightColorPallet[this.props.Index%c.insightColorPallet.length][0],l=c.insightColorPallet[this.props.Index%c.insightColorPallet.length][1];return React.createElement("div",{"aria-label":i+" "+j,className:"association-rule-insight-view-charts-container",tabIndex:0},React.createElement("div",{className:"association-rule-insight-view-chart"},React.createElement("div",{className:"association-rule-insight-view-chart-row"},React.createElement("div",{className:"association-rule-insight-view-support-chart"}),React.createElement("div",{className:"association-rule-insight-view-target-chart"})),React.createElement("div",{className:"association-rule-insight-view-description-row animation",ref:"chartDescription"},React.createElement("div",{className:"association-rule-insight-view-legend-container support"},React.createElement("div",{className:"association-rule-insight-view-legend-dot",style:{background:k}}),React.createElement("div",{className:"association-rule-insight-view-legend-description",dangerouslySetInnerHTML:{__html:g}})),React.createElement("div",{className:"association-rule-insight-view-legend-container target"},React.createElement("div",{className:"association-rule-insight-view-legend-dot",style:{background:l}}),React.createElement("div",{className:"association-rule-insight-view-legend-description",dangerouslySetInnerHTML:{__html:h}})))))},f.prototype.createCharts=function(){var a=this,b=this.props.Insight,c=Math.ceil(100*b.SupportValue),e=b.ConditionAnswers.map(function(b){return a.getAnswerValue(b)});this.drawD3Chart(c,e,d.SupportChart);var f=Math.ceil(100*b.ConfidenceValue),g=[this.getAnswerValue(b.TargetAnswer)];this.drawD3Chart(f,g,d.TargetChart)},f.prototype.destroyD3Chart=function(){d3.select(".association-rule-insight-view-charts-container").selectAll("svg").remove()},f.prototype.drawD3Chart=function(a,b,e){var f=25,g=e===d.SupportChart;b=b.map(function(a){return a.length>=f?a.slice(0,f-3)+"...":a});var h=[{name:"main",percent:a},{name:"other",percent:100-a}],i=g?150:300,j=150,k=g?74:45,l=g?62:38,m=g?75:250,n=75,o=g?0:1,p=c.insightColorPallet[this.props.Index%c.insightColorPallet.length][o],q=d3.scale.ordinal().range([p,"#E0E0E0"]),r=d3.layout.pie().value(function(a){return a.percent}).sort(null).padAngle(.03),s=d3.svg.arc().outerRadius(k).innerRadius(l),t=g?".association-rule-insight-view-support-chart":".association-rule-insight-view-target-chart",u=d3.select(t).append("svg").attr({width:i,height:j}).append("g").attr({transform:"translate("+m+","+n+")"}),v=u.selectAll("path").data(r(h)).enter().append("path").attr({d:s,fill:function(a,b){return q(a.data.name)}});v.transition().duration(1e3).attrTween("d",function(a){var b=d3.interpolate({startAngle:0,endAngle:0},a);return function(a){return s(b(a))}});var w=function(){3*_.max(b,function(a){return a.length}).length;if(!g){u.append("path").attr({"class":"association-rule-chart-pointer",d:"M -25 -40 A 43 45 0 0 0 -25 40 L -250 0"})}u.selectAll("text").data(r(h)).enter().append("text").transition().duration(200).attr("dy",".4em").attr("text-anchor","middle").attr("class","association-rule-chart-percentage-text").text(function(a,b){return 0==b?a.data.percent+"%":void 0})};setTimeout(w,1e3)},f.prototype.triggerChartAnimation=function(a){var b=$(ReactDOM.findDOMNode(this.refs[a]));b&&b.length>0&&(b.removeClass("animation"),window.setTimeout(function(){return b.addClass("animation")},0))},f}(c.InsightViewBase);c.registerInsightViewClass(g,c.InsightType.AssociationRuleInsight)}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d;!function(a){a[a.None=0]="None",a[a.Like=1]="Like",a[a.DisLike=2]="DisLike"}(d||(d={}));var e=function(c){function e(a){var b=c.call(this,a)||this;return b.state={Feedback:d.None,FeedbackOptions:[]},b.onClickFeedbackButton=b.onClickFeedbackButton.bind(b),b.onKeyDownFeedbackButton=b.onKeyDownFeedbackButton.bind(b),b}return __extends(e,c),e.prototype.shouldComponentUpdate=function(a){return this.props.InsightIndex!==a.InsightIndex&&this.state.Feedback!==d.None&&(this.sendFeedbackLog(),this.setState({Feedback:d.None,FeedbackOptions:[]})),!0},e.prototype.componentWillUnmount=function(){this.state.Feedback!==d.None&&this.sendFeedbackLog()},e.prototype.render=function(){var a=this.state.Feedback===d.DisLike?"insight-view-feedback-container expended":"insight-view-feedback-container";return React.createElement("div",{className:a},this.createFeedbackButtons(),this.createFeedbackOptions())},e.prototype.createFeedbackOptions=function(){var c=this;if(this.state.Feedback!==d.DisLike)return null;var e=[{key:"Visual_Not_Intuitive",value:b.Resources.LocalizedStrings.AnalyzeView_Insight_Feedback_Visual_Not_Intuitive},{key:"Description_Not_Clear",value:b.Resources.LocalizedStrings.AnalyzeView_Insight_Feedback_Description_Not_Clear},{key:"Not_Relevant",value:b.Resources.LocalizedStrings.AnalyzeView_Insight_Feedback_Not_Relevant},{key:"Incorrect",value:b.Resources.LocalizedStrings.AnalyzeView_Insight_Feedback_Incorrect},{key:"Not_Meaningful",value:b.Resources.LocalizedStrings.AnalyzeView_Insight_Feedback_Not_Meaningful},{key:"Too_Similar",value:b.Resources.LocalizedStrings.AnalyzeView_Insight_Feedback_Too_Similar}],f=e.map(function(b){var d="insight-view-feedback-option";c.state.FeedbackOptions.indexOf(b.key)>=0&&(d=a.Utilities.Html.combineAttributes(d,"selected"));var e={className:d,tabIndex:0,id:b.key,title:b.value,onClick:c.onClickFeedbackOptionButton.bind(c),onKeyDown:function(b){(b.keyCode===a.KeyCode.Enter||b.keyCode===a.KeyCode.Space)&&c.onClickFeedbackOptionButton(b)}};return React.createElement("span",__assign({},e),b.value)});return React.createElement("div",{className:"insight-view-feedback-option-container"},f)},e.prototype.createFeedbackButtons=function(){var c=a.Utilities.Html.combineAttributes("insight-view-feedback-button-like",this.state.Feedback===d.Like?"selected":"unselected"),e=a.Utilities.Html.combineAttributes("insight-view-feedback-button-dislike",this.state.Feedback===d.DisLike?"selected":"unselected");return React.createElement("div",{className:"insight-view-feedback-button-container"},React.createElement("div",{"aria-label":b.Resources.LocalizedStrings.AnalyzeView_Insight_Feedback_Description,className:"insight-view-feedback-description",tabIndex:0},b.Resources.LocalizedStrings.AnalyzeView_Insight_Feedback_Description),this.createFeedbackButton(c,b.Resources.LocalizedStrings.AnalyzeView_Insight_Feedback_Like),this.createFeedbackButton(e,b.Resources.LocalizedStrings.AnalyzeView_Insight_Feedback_Dislike))},e.prototype.createFeedbackButton=function(b,c){return a.Control.createTextButton({ButtonStyle:a.Control.ButtonStyle.None,HTMLAttributes:{className:b,onClick:this.onClickFeedbackButton,onKeyDown:this.onKeyDownFeedbackButton,tabIndex:0},Text:c})},e.prototype.onClickFeedbackButton=function(a){var b=a.currentTarget.className.indexOf("insight-view-feedback-button-like")>=0?d.Like:d.DisLike;this.insightWithFeedback=this.props.getCurrentViewInsight(),this.setState({Feedback:this.state.Feedback===b?d.None:b,FeedbackOptions:[]})},e.prototype.onKeyDownFeedbackButton=function(b){if(b.keyCode===a.KeyCode.Enter||b.keyCode===a.KeyCode.Space){b.preventDefault(),b.stopPropagation();var c=b.currentTarget.className.indexOf("like")>=0?d.Like:d.DisLike;this.insightWithFeedback=this.props.getCurrentViewInsight(),this.setState({Feedback:this.state.Feedback===c?d.None:c,FeedbackOptions:[]})}},e.prototype.onClickFeedbackOptionButton=function(a){var b=this.state.FeedbackOptions,c=a.currentTarget.id;if(b.indexOf(c)>=0){var d=b.indexOf(c);b.splice(d,1)}else b.push(c);this.setState({FeedbackOptions:b})},e.prototype.sendFeedbackLog=function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Feedback.Insights,extraData:{InsightType:this.insightWithFeedback.Type,InsightScore:this.insightWithFeedback.Score,Feedback:this.state.Feedback,FeedbackOptions:this.state.FeedbackOptions}})},e}(a.ReactComponent);c.FormInsightFeedbackView=e}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(b){return a.Flighting.Flight.isEnabled(a.Flighting.Flights.FormInsight)?React.createElement(f,__assign({},b)):null}var e=1;c.createFormInsightView=d;var f=function(d){function f(e){var f=d.call(this,e)||this;return f.insightChangeCallback=function(){var b=f.formInsightMaster.Insights.length;f.shouldCreateInsightFeedbackDialog()&&b++,a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.ShowInsights,extraData:{InsightCount:f.formInsightMaster.Insights.length,InsightTypes:f.formInsightMaster.Insights.map(function(a){return c.InsightType[a.Type]})}}),f.setState({DialogCount:b,InsightReady:f.formInsightMaster.Model.IsReady})},f.setInsightDialogFocusCallback=function(){var a=ReactDOM.findDOMNode(f.refs.insightDialog);a&&a.focus()},f.state={DialogCount:0,InsightIndex:0,InsightReady:!1,LibraryLoaded:!1,showAlert:!1},f.closeInsightFeedbackDialog=f.closeInsightFeedbackDialog.bind(f),f.disableInsightFeedbackDialog=f.disableInsightFeedbackDialog.bind(f),f.setCurrentViewInsight=f.setCurrentViewInsight.bind(f),f.getCurrentViewInsight=f.getCurrentViewInsight.bind(f),f.formInsightMaster=new b.Model.FormInsightMaster(f.props.FormMaster),f.formInsightMaster.observe(f.insightChangeCallback,[b.Model.FormInsightMaster.Schema.IsReady]),f.formInsightMaster.loadInsight(f.props.ShowInsight),f}return __extends(f,d),f.prototype.componentDidMount=function(){this.loadJavaScriptLibraries(),this.setState({showAlert:!0})},f.prototype.compnentWillUnmount=function(){this.formInsightMaster.unobserve(this.insightChangeCallback)},f.prototype.render=function(){return React.createElement("div",{className:"form-insight-container"},React.createElement("div",{className:"form-insight-frost",role:"presentation"}),this.createPreviousButton(),this.createInsightDialog(),this.createNextButton())},f.prototype.loadJavaScriptLibraries=function(){var b=this;a.JavaScriptLoader.loadJavaScripts(["D3","Heatmap","HighCharts","HighCharts_More","Pattern_Fill","WordCloud"]).done(function(){b.setState({LibraryLoaded:!0})})},f.prototype.createInsightDialog=function(){var a={"aria-label":b.Resources.LocalizedStrings.AnalyzeView_Insight_Dialog,className:"form-insight-dialog",ref:"insightDialog",tabIndex:0};if(this.state.InsightReady&&this.state.LibraryLoaded){if(0===this.formInsightMaster.Insights.length)return React.createElement("div",__assign({},a),this.createPreviewLabel(),this.createCloseButton(),this.createEmptyMessage());var d=null;if(this.state.InsightIndex<this.formInsightMaster.Insights.length){var e={InsightIndex:this.state.InsightIndex,getCurrentViewInsight:this.getCurrentViewInsight};d=React.createElement(c.FormInsightFeedbackView,__assign({},e))}return React.createElement("div",__assign({},a),this.createPreviewLabel(),this.createCloseButton(),this.createInsightContent(),d,this.createGallery())}return React.createElement("div",__assign({},a),this.createPreviewLabel(),this.createCloseButton(),this.createLoadingMessag())},f.prototype.createGallery=function(){var b=this;if(1===this.state.DialogCount)return null;for(var c=[],d=function(d){var f="form-insight-dialog-gallery-dot";f=a.Utilities.Html.combineAttributes(f,d===e.state.InsightIndex?"active":"inactive");
var g={className:f,tabIndex:0,onClick:function(){b.setState({InsightIndex:d})},onKeyDown:function(c){(c.keyCode===a.KeyCode.Enter||c.keyCode===a.KeyCode.Space)&&b.setState({InsightIndex:d})}};c.push(React.createElement("div",__assign({},g)))},e=this,f=0;f<this.state.DialogCount;f++)d(f);return React.createElement("div",{className:"form-insight-dialog-gallery"},React.createElement("div",{className:"form-insight-dialog-gallery-dots-container"},c))},f.prototype.createLoadingMessag=function(){var a="";return this.state.showAlert&&(a=b.Resources.LocalizedStrings.AnalyzeView_Insight_Loading_Message),React.createElement("div",{"aria-live":"polite",className:"form-insight-loading-container"},React.createElement("div",{className:"form-insight-loading-animation"},React.createElement("div",{className:"spinner-tile-animation"})),React.createElement("div",{className:"form-insight-loading-message"},a))},f.prototype.createEmptyMessage=function(){var c=a.Utilities.Html.sanitize(b.Resources.LocalizedStrings.AnalyzeView_Insight_Default_View_Description),d=b.Resources.LocalizedStrings.AnalyzeView_Insight_Default_View_Title;return React.createElement("div",{className:"form-insight-default-view-container"},React.createElement("div",{className:"form-insight-default-img-container"},React.createElement("div",{className:"form-insight-default-img"},React.createElement("img",{className:"form-insight-default-image",src:"../../Images/insight/insight_default_pic.png"}))),React.createElement("div",{className:"form-insight-default-message-container"},React.createElement("div",{className:"form-insight-default-title",tabIndex:0},d),React.createElement("div",{className:"form-insight-default-description",dangerouslySetInnerHTML:{__html:c},tabIndex:0})))},f.prototype.createPreviousButton=function(){var c=this;if(this.state.InsightIndex>0&&this.state.InsightIndex<this.state.DialogCount){var d={HTMLAttributes:{className:"form-insight-dialog-previous-button",onClick:function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.ClickInsightPreviousButton,extraData:{InsightCount:c.formInsightMaster.Insights.length,InsightIndex:c.state.InsightIndex}}),c.setState({InsightIndex:c.state.InsightIndex-1})}},Icon:"ChevronLeft",GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly,ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.AnalyzeView_Insight_Previous_Insight};return a.Control.createGlyphButton(d)}},f.prototype.createNextButton=function(){var c=this;if(this.state.InsightIndex>=0&&this.state.InsightIndex<this.state.DialogCount-1){var d={HTMLAttributes:{className:"form-insight-dialog-next-button",onClick:function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.ClickInsightNextButton,extraData:{InsightCount:c.formInsightMaster.Insights.length,InsightIndex:c.state.InsightIndex}}),c.setState({InsightIndex:c.state.InsightIndex+1})}},Icon:"ChevronRight",GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly,ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.AnalyzeView_Insight_Next_Insight};return React.createElement("div",{className:"form-insight-head-button"},a.Control.createGlyphButton(d))}},f.prototype.createInsightContent=function(){var a=this.state.InsightIndex,b=this.formInsightMaster.Insights;return a>=0&&a<b.length?React.createElement(c.createInsightViewElement,{Insight:b[a],Index:a,focusOnInsightDialog:this.setInsightDialogFocusCallback,setCurrentViewInsight:this.setCurrentViewInsight,key:a}):a>=b.length&&this.shouldCreateInsightFeedbackDialog()?this.createFeedbackDialog():void 0},f.prototype.createCloseButton=function(){var c={HTMLAttributes:{onClick:this.props.onClose,className:"form-insight-dialog-close-button"},Icon:"Cancel",IconClassName:"forms-icon-size16x16",ButtonStyle:a.Control.ButtonStyle.LightBackground,GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly,Text:b.Resources.LocalizedStrings.AnalyzeView_Insight_Close_Insight};return a.Control.createGlyphButton(c)},f.prototype.createPreviewLabel=function(){return React.createElement("div",{className:"form-insight-preview-label-container"},React.createElement("div",{className:"form-insight-preview-label"},React.createElement("div",{className:"form-insight-preview-label-text"},b.Resources.LocalizedStrings.AnalyzeView_Insight_Preview)))},f.prototype.shouldCreateInsightFeedbackDialog=function(){if(!a.Flighting.Flight.isEnabled(a.Flighting.Flights.FormInsightFeedbackV2))return!1;var b=a.SafeStorage.DefaultStorage,c=b.getItem(this.props.FormMaster.Model.Id);return!c||parseInt(c)<e},f.prototype.disableInsightFeedbackDialog=function(){var b=a.SafeStorage.DefaultStorage;b.setItem(this.props.FormMaster.Model.Id,e.toString())},f.prototype.createFeedbackDialog=function(){var a={closeInsightFeedbackDialog:this.closeInsightFeedbackDialog,FormId:this.props.FormMaster.Model.Id,Insights:this.formInsightMaster.Insights.map(function(a){return a.Type})};return Forms.UX.createInsightFeedbackDialog(a)},f.prototype.closeInsightFeedbackDialog=function(){this.setState({InsightIndex:0,DialogCount:this.formInsightMaster.Insights.length},this.disableInsightFeedbackDialog)},f.prototype.setCurrentViewInsight=function(a){this.currentViewInsight=a},f.prototype.getCurrentViewInsight=function(){return this.currentViewInsight},f}(a.ReactComponent);c.FormInsightViewContainer=f}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(d){function e(){return null!==d&&d.apply(this,arguments)||this}return __extends(e,d),e.prototype.insightViewDescriptionDetail=function(){return React.createElement("div",{className:"likert-insight-container"},this.insightViewDescription(),React.createElement("div",{className:"likert-insight-chart"},React.createElement("div",{className:"likert-insight-chart-container"},this.createLikertSupportChart(),this.createLikertTargetChart())))},e.prototype.insightViewSourceQuestions=function(){return null},e.prototype.shouldShowSourceQuestions=function(){return!1},e.prototype.updateContent=function(){this.triggerChartAnimation("supportChart"),this.triggerChartAnimation("targetChart")},e.prototype.insightViewDescription=function(){var c=this.props.Insight,d=c.ConditionAnswers,e=c.TargetAnswer,f=b.Resources.LocalizedStrings.AnalyzeView_Insight_Likert_Description.format(c.LikertMasterQuestion.QuestionOrder,a.Utilities.Html.sanitize(c.LikertMasterQuestion.Title)),g=b.Resources.LocalizedStrings.AnalyzeView_Insight_Association_Rule_Description_Support_SingleCommon.format(Math.ceil(100*c.SupportValue),a.Utilities.Html.sanitize(d[0].Value[0].RawValue),a.Utilities.Html.sanitize(d[0].Question.Title)),h=b.Resources.LocalizedStrings.AnalyzeView_Insight_Association_Rule_Description_Target_SingleCommon.format(Math.ceil(100*c.ConfidenceValue),a.Utilities.Html.sanitize(e.Value[0].RawValue),a.Utilities.Html.sanitize(e.Question.Title));return React.createElement("div",{className:"insight-description-text-container"},React.createElement("div",{"aria-label":f,className:"insight-description-text",tabIndex:0},f),React.createElement("div",{className:"insight-description-text",dangerouslySetInnerHTML:{__html:g}}),React.createElement("div",{className:"insight-description-text",dangerouslySetInnerHTML:{__html:h}}))},e.prototype.createLikertSupportChart=function(){var d=c.insightColorPallet[this.props.Index%c.insightColorPallet.length][0],e="#EAEAEA",f=this.props.Insight,g=Math.ceil(100*f.SupportValue),h="468px",i=g+"%",j=100-g+"%",k=a.Utilities.Html.sanitize(f.ConditionAnswers[0].Value[0].RawValue),l=a.Utilities.Html.sanitize(f.ConditionAnswers[0].Question.Title),m=b.Resources.LocalizedStrings.AnalyzeView_Insight_Likert_Chart_Legend.format(k,l),n=React.createElement("div",{className:"likert-insight-chart-legend-container"},React.createElement("div",{className:"likert-insight-chart-legend",dangerouslySetInnerHTML:{__html:m}}),React.createElement("div",{className:"likert-insight-chart-percent"},i)),o=React.createElement("div",{className:"likert-insight-chart-support-bars animation",ref:"supportChart",style:{width:h}},React.createElement("span",{className:"likert-insight-chart-bar",style:{width:i,background:d}}),React.createElement("span",{className:"likert-insight-chart-bar",style:{width:j,background:e}}));return React.createElement("div",{className:"likert-insight-chart-row"},React.createElement("div",{className:"likert-insight-chart-cell legend"},n),React.createElement("div",{className:"likert-insight-chart-cell bar"},o))},e.prototype.createLikertTargetChart=function(){var d=c.insightColorPallet[this.props.Index%c.insightColorPallet.length][1],e="#EAEAEA",f=this.props.Insight,g=Math.ceil(100*f.SupportValue),h=Math.ceil(100*f.ConfidenceValue),i=468,j=i*g/100+"px",k=i*g/100/2+"px",l=h+"%",m=100-h+"%",n=a.Utilities.Html.sanitize(f.TargetAnswer.Value[0].RawValue),o=a.Utilities.Html.sanitize(f.TargetAnswer.Question.Title),p=b.Resources.LocalizedStrings.AnalyzeView_Insight_Likert_Chart_Legend.format(n,o),q=React.createElement("div",{className:"likert-insight-chart-legend-container"},React.createElement("div",{className:"likert-insight-chart-legend",dangerouslySetInnerHTML:{__html:p}}),React.createElement("div",{className:"likert-insight-chart-percent"},l)),r=React.createElement("div",{className:"likert-insight-chart-pointer-container",style:{width:j}},React.createElement("div",{className:"likert-insight-chart-pointer",style:{borderLeftWidth:k,borderRightWidth:k}})),s=React.createElement("div",{className:"likert-insight-chart-target-container animation",ref:"targetChart"},r,React.createElement("div",{className:"likert-insight-chart-target-bars",style:{width:j}},React.createElement("span",{className:"likert-insight-chart-bar",style:{width:l,background:d}}),React.createElement("span",{className:"likert-insight-chart-bar",style:{width:m,background:e}})));return React.createElement("div",{className:"likert-insight-chart-row"},React.createElement("div",{className:"likert-insight-chart-cell legend"},q),React.createElement("div",{className:"likert-insight-chart-cell bar"},s))},e.prototype.triggerChartAnimation=function(a){var b=$(ReactDOM.findDOMNode(this.refs[a]));b&&b.length>0&&(b.removeClass("animation"),window.setTimeout(function(){return b.addClass("animation")},0))},e}(c.InsightViewBase);c.registerInsightViewClass(d,c.InsightType.LikertAssociationRuleInsight)}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OutstandingInsightSubType=Forms.DataProvider.OutstandingInsightSubType,OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.insightViewSourceQuestions=function(){var a=this,b=this.props.Insight.OutstandingInsights.map(function(b){var c="insight-view-description-source-question";return React.createElement("div",{className:c},a.createSourceQuestionTitle(b.Question))});return React.createElement("div",{className:"insight-view-description-source-questions"},b)},d.prototype.insightViewDescriptionDetail=function(){return React.createElement("div",{className:"outstanding-collection-insight-container"},this.insightViewDescriptionConclusionText(),this.insightViewCharts())},d.prototype.updateContent=function(){},d.prototype.insightViewDescriptionConclusionText=function(){return React.createElement("div",{className:"outstanding-collection-insight-conclustion-text"},b.Resources.LocalizedStrings.AnalyzeView_Insight_Outstanding_Collection_Insight_Description.format(this.props.Insight.TotalQuestions,this.props.Insight.OutstandingInsights.length))},d.prototype.createDescriptionAndChart=function(c){var d,e={Data:c.SortedAnswers.map(function(a){return a.m_Item2})},f=c.SortedAnswers.map(function(a){return a.m_Item1.Value[0].RawValue}),g={DataSets:[e],Labels:f,Type:a.Control.InsightChartType.Pie},h="InsightChartControl"+c.Question.QuestionOrder,i=React.createElement(a.Control.InsightChartControl,__assign({},g,{key:h}));switch(c.SubType){case OutstandingInsightSubType.All:d=b.Resources.LocalizedStrings.AnalyzeView_Insight_Outstanding_Insight_Description_All;break;case OutstandingInsightSubType.Dominant:d=b.Resources.LocalizedStrings.AnalyzeView_Insight_Outstanding_Insight_Description_Dominant;break;case OutstandingInsightSubType.Outstanding:d=b.Resources.LocalizedStrings.AnalyzeView_Insight_Outstanding_Insight_Description_Outstanding;break;default:d=null}var j=d?React.createElement("div",{className:"insight-view-outstanding-description"},d.format(c.Question.QuestionOrder,c.Question.Title,c.SortedAnswers[0].m_Item1.Value[0].RawValue)):null;return React.createElement("div",{className:"insight-view-outstanding-chart-container"},j,i)},d.prototype.insightViewCharts=function(){var a=this,b=this.props.Insight.OutstandingInsights.map(function(b){return a.createDescriptionAndChart(b)});return React.createElement("div",{className:"insight-view-chart-container"},b)},d}(c.InsightViewBase);c.registerInsightViewClass(d,c.InsightType.OutstandingCollection)}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.componentWillUnmount=function(){this.destroyCharts(),c.prototype.componentWillUnmount.call(this)},d.prototype.componentDidMount=function(){this.createCharts(),c.prototype.componentDidMount.call(this)},d.prototype.insightViewDescriptionDetail=function(){return React.createElement("div",{className:"rating-rule-insight-container"},React.createElement("div",{className:"rating-rule-insight-description"},this.insightViewDescription(),this.insightViewCharts()))},d.prototype.shouldShowSourceQuestions=function(){return!1},d.prototype.insightViewSourceQuestions=function(){return null},d.prototype.updateContent=function(){this.destroyCharts(),this.createCharts()},d.prototype.insightViewDescription=function(){var c=b.Resources.LocalizedStrings.AnalyzeView_Insight_Rating_Insight_Description,d=c.format(this.createSourceQuestionTooltip(this.props.Insight.RatingQuestion)),e=c.format(a.Utilities.Html.sanitize(this.props.Insight.RatingQuestion.Title));return React.createElement("div",{className:"insight-description-text-container rating-keyword"},React.createElement("div",{"aria-label":e,className:"insight-description-text",dangerouslySetInnerHTML:{__html:d},tabIndex:0}))},d.prototype.insightViewCharts=function(){var a=this.props.Insight,b=this.getRatingRange(a.RatingQuestion.Choices.length),c=this.createWordCloudChart(a.HighRatingKeywords,"high-rating","highChartContainer",b[1][0],b[1][1]),d=this.createWordCloudChart(a.LowRatingKeywords,"low-rating","lowChartContainer",b[0][0],b[0][1]);return React.createElement("div",{className:"rating-rule-insight-chart-container"},d,c)},d.prototype.createWordCloudChart=function(c,d,e,f,g){var h=b.Resources.LocalizedStrings.AnalyzeView_Insight_Rating_Insight_Chart_Title_Range,i=b.Resources.LocalizedStrings.AnalyzeView_Insight_Rating_Insight_Chart_Title_Single,j=b.Resources.LocalizedStrings.AnalyzeView_Insight_Rating_Insight_Chart_AriaLabel,k=a.Utilities.Html.combineAttributes("rating-rule-insight-chart-legend-dot",d),l="rating-rule-insight-chart",m=null;0===c.length&&(l=a.Utilities.Html.combineAttributes(l,"empty"),m=this.createEmptyChartMessage());var n=j.format(c.map(function(a){return a.Option.RawValue}).join(",")),o=React.createElement("div",{"aria-label":n,className:l,id:e,tabIndex:0}),p=f===g?i.format(f):h.format(f,g),q=React.createElement("div",{className:"rating-rule-insight-chart-wrapper"},React.createElement("div",{className:"rating-rule-insight-chart-title-container"},React.createElement("div",{className:k}),React.createElement("span",{className:"rating-rule-insight-chart-title",tabIndex:0},p)),m,o);return q},d.prototype.createEmptyChartMessage=function(){return React.createElement("div",{className:"rating-rule-insight-chart-empty-message-container"},React.createElement("div",{className:"rating-rule-insight-chart-empty-img"},React.createElement("img",{className:"rating-rule-insight-chart-empty-image",src:"../../Images/insight/empty_wordcloud_icon.png"})),React.createElement("div",{className:"rating-rule-insight-chart-empty-message"},b.Resources.LocalizedStrings.AnalyzeView_Insight_WordCloud_Empty_Message))},d.prototype.destroyCharts=function(){this.highChartInstance&&(this.highChartInstance.destroy(),this.highChartInstance=null),this.lowChartInstance&&(this.lowChartInstance.destroy(),this.lowChartInstance=null)},d.prototype.createCharts=function(){var a=this.props.Insight;this.highChartInstance=null,this.lowChartInstance=null,this.highChartInstance=this.drawWordCloud("highChartContainer",a.HighRatingKeywords,"#117D10"),this.lowChartInstance=this.drawWordCloud("lowChartContainer",a.LowRatingKeywords,"#00439D")},d.prototype.drawWordCloud=function(b,c,d){var e=this,f=10,g="#F4F4F4",h=c.map(function(a){return{name:e.truncateKeyword(a.Option.RawValue),weight:Math.ceil(a.Score)}}).slice(0,f-1);Highcharts.setOptions({colors:[d]});var i=1===h.length?75:15;return a.Flighting.Flight.isEnabled(a.Flighting.Flights.WordCloudMultipleRatio)&&(Highcharts.seriesTypes.wordcloud.prototype.placementStrategy.center=function(a,b){if(b.field.height<90&&b.field.width<170){var c=4;b.field.height=b.field.height*c,b.field.width=b.field.width*c}return{x:0,y:0,rotation:0}}),Highcharts.chart(b,{chart:{backgroundColor:g,margin:i,type:"wordcloud"},series:[{allowExtendPlayingField:!0,data:h,maxFontSize:25,minFontSize:10,rotation:{from:0,orientations:0,to:0},spiral:"square",style:{fontFamily:"Segoe UI",fontWeight:"600"},type:"wordcloud"}],title:{text:""},tooltip:{enabled:!1},credits:{enabled:!1}})},d.prototype.truncateKeyword=function(a){return a&&a.length>28?a.slice(0,24)+"...":a},d}(c.InsightViewBase);c.registerInsightViewClass(d,c.InsightType.RatingKeywordsInsight)}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.insightViewDescriptionDetail=function(){return React.createElement("div",{className:"insight-container"},React.createElement("div",{className:"insight-description"},this.insightViewDescription(),this.insightViewCharts()))},d.prototype.insightViewSourceQuestions=function(){return null},d.prototype.shouldShowSourceQuestions=function(){return!1},d.prototype.updateContent=function(){},d.prototype.insightViewDescription=function(){var c=this.props.Insight,d=b.Resources.LocalizedStrings.AnalyzeView_Insight_Time_Distribution_Insight_Description,e=b.Resources.LocalizedStrings.AnalyzeView_Insight_Time_Distribution_Insight_Legend_Description,f=e.format(c.TotalResponders);return d=a.Utilities.Html.sanitize(d),React.createElement("div",{className:"insight-description-text",tabIndex:0},React.createElement("div",{className:"time-distribution-insight-view-description-container"},React.createElement("div",{className:"time-distribution-insight-view-description-icon"}),React.createElement("div",{className:"time-distribution-insight-view-description-message"},d)),React.createElement("div",{className:"time-distribution-insight-view-legend-container"},React.createElement("div",{className:"time-distribution-insight-view-legend-message"},f)))},d.prototype.insightViewCharts=function(){var a=this,c=this.props.Insight,d=c.TimeDistributions.map(function(d){var e=a.getTimeRange(d.MinDurationSeconds,d.MaxDurationSeconds),f=b.Resources.LocalizedStrings.AnalyzeView_Insight_Time_Distribution_Insight_Percentage.format(Math.round(d.Count/c.TotalResponders*100));return React.createElement("div",{"aria-label":f+" "+e,className:"time-distribution-insight-chart-row-container",tabIndex:0},React.createElement("div",{className:"time-distribution-insight-chart-cell-container description"},React.createElement("div",{className:"time-distribution-insight-chart-timerange"},e),React.createElement("div",{className:"time-distribution-insight-chart-percentage"},f)),React.createElement("div",{className:"time-distribution-insight-chart-cell-container figures"},a.createFigures(Math.round(d.Count/c.TotalResponders*100))))});return React.createElement("div",{className:"time-distribution-insight-chart"},React.createElement("div",{className:"time-distribution-insight-chart-container"},d))},d.prototype.getTimeRange=function(a,c){return a===c?this.convertTimeLabel(a):60>a&&60>c?b.Resources.LocalizedStrings.AnalyzeView_Insight_Time_Distribution_Insight_Time_Range.format(a,c):b.Resources.LocalizedStrings.AnalyzeView_Insight_Time_Distribution_Insight_Time_Range_Format.format(this.convertTimeLabel(a),this.convertTimeLabel(c))},d.prototype.convertTimeLabel=function(a){var c=Math.floor(a/3600),d=Math.floor((a-3600*c)/60),e=a-3600*c-60*d,f=[];return 0!==c&&f.push(b.Resources.LocalizedStrings.AnalyzeView_Insight_Time_Distribution_Insight_Time_Label_Hour.format(c)),0!==d&&f.push(b.Resources.LocalizedStrings.AnalyzeView_Insight_Time_Distribution_Insight_Time_Label_Minute.format(d)),0!==e&&f.push(b.Resources.LocalizedStrings.AnalyzeView_Insight_Time_Distribution_Insight_Time_Label_Second.format(e)),3===f.length?b.Resources.LocalizedStrings.AnalyzeView_Insight_Time_Distribution_Insight_Time_Label_Format_1.format(f[0],f[1],f[2]):2===f.length?b.Resources.LocalizedStrings.AnalyzeView_Insight_Time_Distribution_Insight_Time_Label_Format_2.format(f[0],f[1]):f[0]},d.prototype.createFigures=function(a){for(var b=[],c=1;10>=c;c++)a>=10?b.push(React.createElement("div",{className:"time-distribution-insight-figure-icon full"})):5===a?b.push(React.createElement("div",{className:"time-distribution-insight-figure-icon half"})):5>a&&a>0?b.push(React.createElement("div",{className:"time-distribution-insight-figure-icon one-third"})):a>5&&10>a?b.push(React.createElement("div",{className:"time-distribution-insight-figure-icon two-third"})):b.push(React.createElement("div",{className:"time-distribution-insight-figure-icon empty"})),a-=10;return React.createElement("div",{className:"time-distribution-insight-figure-container"},b)},d}(c.InsightViewBase);c.registerInsightViewClass(d,c.InsightType.TimeDistributionInsight)}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.render=function(){return this.props.IsResponseValid?this.createIndividualAnalyzeViewDetailTable():this.props.IsLoading?React.createElement("div",{className:"analyze-view-placerholder"},b.DesignPage.createLoadingPlaceholder({Message:b.Resources.LocalizedStrings.AnalyzeView_Loading})):React.createElement("div",{className:"analyze-view-detail-content"},React.createElement("div",{className:"analyze-view-detail-noresponses-container"},React.createElement(a.Control.FontIconControl,{HTMLAttributes:{className:"analyze-view-warning-icon"},IconName:"Sad"}),React.createElement("div",{className:"analyze-view-detail-noresponse-message"},b.Resources.LocalizedStrings.Analysis_Page_No_Responses_Message),React.createElement("div",{className:"analyze-view-detail-noresponse-detail"},b.Resources.LocalizedStrings.Analysis_Page_No_Responses_Details)))},d.prototype.createIndividualAnalyzeViewDetailTable=function(){var a=this.props,c=b.Model.exportConverter(a.FormRuntimeMaster);return c.Form.hasSection()?React.createElement("div",null,this.createIndividualAnalyzeViewQuestions(c.getRuntimeQuestionsWithSectionId()),this.createIndividualAnalyzeViewSections()):React.createElement("div",null,this.createIndividualAnalyzeViewQuestions(c.TopQuestionRuntimeMasters))},d.prototype.createIndividualAnalyzeViewSections=function(){var c=this,d=this.props,e=b.Model.exportConverter(d.FormRuntimeMaster),f=e.Form.FormElementManager.SectionMasters,g=a.Utilities.isMobile(),h=[];return f.forEach(function(a,b){h.push(React.createElement(Forms.UX.Renderer.SectionBreaker,{HasTheme:!1,key:"form-section-breaker-"+a.Model.Id}));var d=c.createIndividualAnalyzeViewQuestions(e.getRuntimeQuestionsWithSectionId(a.Model.Id));h.push(React.createElement(Forms.UX.Renderer.SectionRender,{children:d,Disabled:!0,DisableShuffle:!0,Expaned:!0,IsMobile:g,key:"form-section-container-"+a.Model.Id,Ordinal:b+1,SectionMaster:a}))}),h},d.prototype.createIndividualAnalyzeViewQuestions=function(c){if(c.length<=0)return null;var d,e=this.props,f=b.Model.exportConverter(e.FormRuntimeMaster),g=a.Utilities.isMobile();return d=_.indexOf(f.TopQuestionRuntimeMasters,c[0])+1,React.createElement("div",null,c.map(function(a,c){return Forms.UX.Renderer.createRendererElement({Disabled:!0,DisableShuffle:!0,HideMedia:!1,IsMobile:g,key:a.Question.Model.Id,Master:b.Model.exportConverter(a),Ordinal:c+d,PrintView:a.Question.Model.Type===b.Model.QuestionType.TextField,ShowQuizResult:!0,ShowValidationStyle:!0,ShowFileInfo:!0})}))},d}(a.ReactComponent);c.IndividualViewDetail=d,a.Exports.QuestionAnswer=a.Form.Analysis}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(d){function e(){var a=null!==d&&d.apply(this,arguments)||this;return a.state={SelectedResponseIndex:0},a}return __extends(e,d),e.prototype.render=function(){return!this.props.IsDataReady||this.props.SelectedControlData&&0!==this.props.SelectedControlData.length?React.createElement("div",{className:"analyze-view-summary-content"},React.createElement("div",{className:"analyze-view-summary-table"},this.createSummaryContent(),this.createMenuControl())):React.createElement("div",{className:"analyze-view-summary-content"})},e.prototype.createSummaryContent=function(){return React.createElement("div",{className:"survey-individual-view-summary-container"},[this.createPreviousButton(),this.createResponderSelectControl(),this.createTimeToCompleteComponent(),this.createNextButton()])},e.prototype.createMenuControl=function(){var d=this,e=this.props.SelectedControlData[this.state.SelectedResponseIndex]?this.props.SelectedControlData[this.state.SelectedResponseIndex].Id:null,f={DeleteAllResponses:!1,Disabled:!this.props.IsDataReady,HasAnswers:!!this.props.SelectedControlData&&this.props.SelectedControlData.length>0,onDelete:function(){b.Model.logEvent(a.Event.EngagementEventNames.DesignPage.Analysis.DeleteSingleResponse,{entry:"DeleteSingleResponse"}),e&&d.setState({SelectedResponseIndex:0},function(){d.props.onResoponeDelete(e)})},onPrint:this.printAnalyzeView};return React.createElement(c.AnalyzeViewMenu,__assign({},f))},e.prototype.createTimeToCompleteComponent=function(){var a=this.getCompleteTime(),d={AccessibilityText:b.Resources.LocalizedStrings.SurveyView_Fill_Time_Minutes_Seconds_Explicit.format(a.minutes,a.seconds),Data:this.getShortTime(),Description:b.Resources.LocalizedStrings.AnalyzeView_Fill_Time,Ignorable:!0,IsReady:this.props.IsDataReady};return React.createElement(c.SimpleDataControl,__assign({},d,{key:"timeToCompleteComponent"}))},e.prototype.createPreviousButton=function(){var c=this,d=this.state.SelectedResponseIndex,e={onClick:function(){if(d>=1){b.Model.logEvent(a.Event.EngagementEventNames.DesignPage.Analysis.SwitchResponder,{entry:"LeftArrow"});var e=c.props.SelectedControlData[d-1].Id;c.props.onSelectedResponseChange(e),c.setState({SelectedResponseIndex:d-1})}},disabled:!this.props.IsDataReady||0>=d,"aria-label":b.Resources.LocalizedStrings.AnalyzeView_ViewResultButton_Previous},f=a.Control.createFontIconControl({HTMLAttributes:{className:"analyze-view-leftButton"},IconName:"ChevronLeftSmall"});return React.createElement("div",{className:"analyze-view-new-navigate-button analyze-view-previous-button",key:"previousResponseButton"},a.Control.createButton({HTMLAttributes:e,ButtonStyle:a.Control.ButtonStyle.None,children:f}))},e.prototype.createNextButton=function(){var c=this,d=this.state.SelectedResponseIndex,e={onClick:function(){if(d>=0&&d<c.props.SelectedControlData.length-1){b.Model.logEvent(a.Event.EngagementEventNames.DesignPage.Analysis.SwitchResponder,{entry:"RightArrow"});var e=c.props.SelectedControlData[d+1].Id;c.props.onSelectedResponseChange(e),c.setState({SelectedResponseIndex:d+1})}},disabled:!this.props.IsDataReady||0>d||d>=this.props.SelectedControlData.length-1,"aria-label":b.Resources.LocalizedStrings.AnalyzeView_ViewResultButton_Next},f=a.Control.createFontIconControl({HTMLAttributes:{className:"analyze-view-rightButton"},IconName:"ChevronRightSmall"});return React.createElement("div",{className:"analyze-view-new-navigate-button",key:"nextResposnseButton"},a.Control.createButton({HTMLAttributes:e,ButtonStyle:a.Control.ButtonStyle.None,children:f}))},e.prototype.createResponderSelectControl=function(){var c=this,d={},e=b.convertToArray(this.props.SelectedControlData).map(function(c,e){var f,g=c.ResponderName;return d[g]?d[g]++:d[g]=1,f=""===g?a.Form.Resources.LocalizedStrings.DisplayFormat_AnonymousUserName.format(b.Resources.LocalizedStrings.ResponderNameForAnonymousUser,d[g]):1===d[g]?g:a.Form.Resources.LocalizedStrings.DisplayFormat_DuplicateUserName.format(g,d[g]),{Disabled:!1,DisplayName:f,Key:e,Value:e}}),f=b.Resources.LocalizedStrings.AnalyzeView_Responder_Dropdown_Label,g={HTMLAttributes:{className:"survey-analyze-view-individual-summary-select",disabled:!this.props.IsDataReady},AllowWrap:!0,Label:f,SelectOptions:e,Value:this.state.SelectedResponseIndex,onValueChange:function(d){b.Model.logEvent(a.Event.EngagementEventNames.DesignPage.Analysis.SwitchResponder,{entry:"Dropdown"}),c.props.onSelectedResponseChange(c.props.SelectedControlData[d].Id),c.setState({SelectedResponseIndex:d})}};return React.createElement("div",{className:"survey-individual-view-responder-container",key:"responderLabel"},React.createElement("div",{className:"survey-individual-view-responder-info-container"},React.createElement("span",null,b.Resources.LocalizedStrings.SurveyAnalyzeView_Responder)),React.createElement(a.Control.Select,__assign({},g)))},e.prototype.getTimeString=function(a){return 10>a?"0"+a.toString():a.toString()},e.prototype.getCompleteTime=function(){if(this.props.IsDataReady){var a=b.convertToArray(this.props.SelectedControlData)[this.state.SelectedResponseIndex],c=(Date.parse(a.SubmitDate.toString())-Date.parse(a.StartDate.toString()))/1e3;return{minutes:Math.floor(c/60),seconds:Math.floor(c%60)}}return{minutes:0,seconds:0}},e.prototype.getShortTime=function(){if(this.props.IsDataReady){var a=this.getCompleteTime();return b.Resources.LocalizedStrings.SurveyView_Fill_Time_Minutes_Seconds_Short.format(this.getTimeString(a.minutes),this.getTimeString(a.seconds))}},e.prototype.printAnalyzeView=function(){b.Model.logEvent(a.Event.EngagementEventNames.DesignPage.Analysis.IndividualPrint,{entry:"PrintIndividual"});var c=$("#analyzeViewPrintChild").appendTo($("body")),d=$("#content-root");d.hide(),window.print(),c.appendTo($("#analyzeViewPrintParent")),d.show()},e}(a.ReactComponent);c.IndividualViewSummary=d}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.getTypeName=function(){return b.Model.QuestionType.MatrixChoiceGroup},d.prototype.getPreviewImageName=function(){return"bar.png"},d.prototype.createStackedBarControlContainer=function(){var c=this.props.AggregationMaster.Model.LikertQuestionAggregation;if(c.LikertResults.length&&c.Options.length){for(var d=b.convertToArray(c.Options),e=[],f=function(a){e[a]={label:d[a],data:_.map(c.LikertResults,function(b){return b.Statistics[a]})}},g=0;g<c.Options.length;g++)f(g);
var h={Data:e,Type:a.Control.StackedBarType.Likert,Labels:_.map(c.LikertResults,function(a){return a.SubQuestionName}),HasLegend:!0};return React.createElement(a.Control.LikertChartControl,__assign({},h,{key:"likertChartControl"}))}},d.prototype.createQuestionViewContent=function(){return[this.createStackedBarControlContainer()]},d}(c.QuestionViewBase);c.LikertQuestionViewBase=d}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.getTypeName=function(){return a.Model.QuestionType.NPS},c.prototype.getPreviewImageName=function(){return"nps.png"},c.prototype.createQuestionViewContent=function(){var b=this.props.AggregationMaster.Model.NPSQuestionAggregation,c=b.ResponseCount,d=[b.Promoters,b.Passives,b.Detractors],e=d.map(function(a){return a&&Math.round(100*a/c)}),f=[a.Resources.LocalizedStrings.NPS_Promoters,a.Resources.LocalizedStrings.NPS_Passives,a.Resources.LocalizedStrings.NPS_Detractors];return[React.createElement(Forms.UX.Analysis.NPSChartControl,{key:"chartControl",Data:d,HasLegend:!0,Labels:f,Percentage:e,Score:e[0]-e[2]})]},c}(b.QuestionViewBase);b.NPSQuestionViewBase=c}(b=a.Analysis||(a.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return React.createElement(e,__assign({},a))}c.createQuizAnalyzeView=d;var e=function(d){function e(){var a=null!==d&&d.apply(this,arguments)||this;return a.analyzeViewDataShouldUpdate=!0,a.formChangeCallback=function(b){return a.onFormChange(b)},a}return __extends(e,d),Object.defineProperty(e.prototype,"QuestionClassType",{get:function(){return b.Model.QuestionClassType.Quiz},enumerable:!0,configurable:!0}),e.prototype.createSummaryPanel=function(){return React.createElement(c.QuizAnalyzeViewSummaryPanel,__assign({},this.SummaryPanelProps))},e.prototype.registerObservers=function(){d.prototype.registerObservers.call(this),this.props.FormMaster.observe(this.formChangeCallback,[b.Model.FormMaster.Schema.ResponsesCount,b.Model.FormMaster.Schema.Questions])},e.prototype.unregisterObservers=function(){d.prototype.unregisterObservers.call(this),this.props.FormMaster.unobserve(this.formChangeCallback)},e.prototype.createExtensionReviewContent=function(){var c=this,d=this.props.FormMaster.Model.ResponsesCount>0,e=this.props.FormMaster.Model.QuizQuestionsCount>0,f=d&&e,g=b.DesignPage.getUxStateMaster(),h=a.Control.createTextButton({HTMLAttributes:{className:"analyze-view-nav-button office-form-theme-button",onClick:function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.GradeResults}),g.startBulkEditMode(),g.Model.Grading=OfficeFormGrading.GradingMode.ByStudent,g.Model.TopView="Grading_ReviewAnswers",c.FocusRef="review-answers-button",g.endBulkEditMode()},disabled:!f},ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.AnalyzeView_GradingButton_Label,ref:"review-answers-button"}),i=!OfficeFormServerInfo.userInfo.IsMsa&&a.Control.createTextButton({HTMLAttributes:{className:"analyze-view-nav-button office-form-theme-button",onClick:function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.ReleaseResults}),g.startBulkEditMode(),g.Model.TopView="Grading_PostGrades",c.FocusRef="post-grades-button",g.endBulkEditMode()},disabled:!f},ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.AnalyzeView_ReleaseResultsButton_Label,ref:"post-grades-button"});return React.createElement("div",{className:"analyze-view-nav-bar-left-button-container"},h,i)},e.prototype.createQuestionDetailDialog=function(){var d=this;if(this.IsAggregationReady()){var e=this.state.DetailDialogQuestionIndex,f=b.convertToArray(_.filter(this.props.FormMaster.Model.Questions,function(a){return!a.GroupId}));if(e>=0&&e<f.length){if(this.analyzeViewDataShouldUpdate)return void this.ensureAnalyzeViewDataSync().then(function(){return d.forceUpdate()});var g="field_"+f[e].Id;return c.createResponsesDetailDialog({QuestionId:g,AnalyzeViewData:this.analyzeViewData,goToNextModalCallback:function(){e>=0&&e<f.length-1&&(b.Model.logEvent(a.Event.EngagementEventNames.DesignPage.Analysis.DetailDialogQuestionNavigate,{entry:"NextQuestion"}),d.setState({DetailDialogQuestionIndex:e+1}))},goToPreviousModalCallback:function(){e>0&&e<f.length&&(b.Model.logEvent(a.Event.EngagementEventNames.DesignPage.Analysis.DetailDialogQuestionNavigate,{entry:"PreviouseQuestion"}),d.setState({DetailDialogQuestionIndex:e-1}))},closeSelf:function(){d.setState({DetailDialogQuestionIndex:-1})}})}(0>e||e>=f.length)&&a.Event.ErrorEventDeprecated.logData({errorName:"UnexpectedDetailQuestionIndex",errorInfo:{index:String(e)}})}},e.prototype.ensureAnalyzeViewDataSync=function(){var a=this;if(this.analyzeViewDataShouldUpdate)return this.props.FormMaster.syncFormResponses().then(function(){return c.AnalyzeDataHelper.createAnalyzeViewData(a.props.FormMaster)}).then(function(b){a.analyzeViewData=b,a.analyzeViewDataShouldUpdate=!1});var b=$.Deferred();return b.resolve(),b.promise()},e.prototype.onFormChange=function(a){var b=(this.props.FormMaster,a.NewValues.ResponsesCount!=a.OldValues.ResponsesCount),c=!_.isEqual(a.NewValues.Questions,a.OldValues.Questions);this.analyzeViewDataShouldUpdate=b||c||this.analyzeViewDataShouldUpdate},e.prototype.IsAggregationReady=function(){if(this.formAggregationMaster){var a=this.formAggregationMaster.Model.SummaryAggregation.IsAggregationReady,c=b.convertToArray(this.formAggregationMaster.Model.QuestionAggregations).reduce(function(a,b){return a&&b.IsAggregationReady},!0);return a&&c}return!1},e}(c.AnalyzeViewBase);c.QuizAnalyzeView=e}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(d){function e(){return null!==d&&d.apply(this,arguments)||this}return __extends(e,d),e.prototype.statisticsContent=function(){if(this.props.AggregationMaster.isAverageResultEnabled){var e=this.getAverageResult();null==e&&a.Event.ErrorEventDeprecated.logData({errorName:"UninitializeAverageResult"});var f={AccessibilityText:b.Resources.LocalizedStrings.AnalyzeView_Average_Score_Explicit.format(String(e)),Data:String(e),Description:b.Resources.LocalizedStrings.AnalyzeView_Average_Score,Ignorable:!0,IsReady:0===this.props.AggregationMaster.Model.TotalResponseCount||this.IsAggregationReady};return React.createElement(c.SimpleDataControl,__assign({},f))}return d.prototype.statisticsContent.call(this)},e.prototype.getAverageResult=function(){var a=this.props.AggregationMaster;return 0===a.Model.TotalResponseCount?"0":this.IsAggregationReady?(a.Model.AverageScore||0).toFixed(0):"-1"},e}(c.AnalyzeViewSummaryPanelBase);c.QuizAnalyzeViewSummaryPanel=d}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(d){function e(){return null!==d&&d.apply(this,arguments)||this}return __extends(e,d),e.prototype.createQuestionTitleContent=function(){return React.createElement(c.QuizQuestionTitleContextView,{AggregationMaster:this.props.AggregationMaster})},Object.defineProperty(e.prototype,"CorrectOptions",{get:function(){var a={},b=_.filter(this.props.AggregationMaster.QuestionMaster.Model.Choices,function(a){return a.IsAnswerKey});return _.forEach(b,function(b){return a[b.Description]=!0}),a},enumerable:!0,configurable:!0}),e.prototype.createDisplayElement=function(c){return c.IsFormula?a.Control.createFormulaRenderer({Formula:c.Choice,DisableLinebreaks:!0}):a.Control.createUserTextRenderer({Text:"answer_other"===c.Choice?b.Resources.LocalizedStrings.Designer_OtherAnswer:c.Choice,RenderMode:a.Control.UserTextRenderMode.RichText})},e}(c.ChoiceQuestionViewBase);c.registerQuestionViewClass(d,b.Model.QuestionClassType.Quiz)}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),c.prototype.createQuestionTitleContent=function(){return React.createElement(b.QuizQuestionTitleContextView,{AggregationMaster:this.props.AggregationMaster})},c}(b.DateQuestionViewBase);b.registerQuestionViewClass(c,a.Model.QuestionClassType.Quiz)}(b=a.Analysis||(a.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),c.prototype.createQuestionTitleContent=function(){return React.createElement(b.QuizQuestionTitleContextView,{AggregationMaster:this.props.AggregationMaster})},c}(b.FileUploadQuestionViewBase);b.registerQuestionViewClass(c,a.Model.QuestionClassType.Quiz)}(b=a.Analysis||(a.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),c.prototype.createQuestionTitleContent=function(){return React.createElement(b.QuizQuestionTitleContextView,{AggregationMaster:this.props.AggregationMaster})},c}(b.LikertQuestionViewBase);b.registerQuestionViewClass(c,a.Model.QuestionClassType.Quiz)}(b=a.Analysis||(a.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),c.prototype.createQuestionTitleContent=function(){return React.createElement(b.QuizQuestionTitleContextView,{AggregationMaster:this.props.AggregationMaster})},c}(b.NPSQuestionViewBase);b.registerQuestionViewClass(c,a.Model.QuestionClassType.Quiz)}(b=a.Analysis||(a.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.render=function(){return React.createElement("div",null,this.createTitle(),this.createSubtitle(),this.createStatistics())},d.prototype.createTitle=function(){return React.createElement("div",{className:"analzye-view-detail-title"},React.createElement(a.Control.UserTextRenderer,{Text:this.QuestionMaster.Model.Title,RenderMode:a.Control.UserTextRenderMode.RichText}),this.createPointsLabel())},d.prototype.createPointsLabel=function(){if(this.IsShowPointsEnabled){var a=this.QuestionMaster.Model.Point,c=1>=a?b.Resources.LocalizedStrings.Quiz_Points_LowerText:b.Resources.LocalizedStrings.Quiz_Points_LowerTextPlural;return React.createElement("span",{className:"analyze-view-quiz-point"},"("+a+" "+c+")")}},d.prototype.createSubtitle=function(){return this.IsShowSubtitleEnabled?React.createElement("div",{className:"analyze-view-question-title-formula"},a.Control.createFormulaRenderer({Formula:this.SubtitleContext})):void 0},d.prototype.createStatistics=function(){if(this.IsStatisticsEnabled){var a=this.props.AggregationMaster.Model.GradeStatistics,c=a.CorrectCount,d=a.WrongCount;return React.createElement("div",{className:"analyze-details-quiz-results"},b.Resources.LocalizedStrings.AnalyzeView_QuizResults.format((c/(c+d)*100).toFixed(0),c,c+d))}},d.prototype.isValueInitialized=function(a){return"undefined"!=typeof a&&null!==a},Object.defineProperty(d.prototype,"QuestionMaster",{get:function(){return this.props.AggregationMaster.QuestionMaster},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"IsShowPointsEnabled",{get:function(){return this.QuestionMaster.Model.IsQuiz&&this.QuestionMaster.Model.Point},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"IsShowSubtitleEnabled",{get:function(){return this.QuestionMaster&&this.QuestionMaster.Model.IsMathQuiz&&!this.QuestionMaster.Model.IsPlainTextInMathField&&this.QuestionMaster.Model.ShowSubtitle&&this.SubtitleContext},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"SubtitleContext",{get:function(){return this.QuestionMaster.Model.Subtitle},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"IsStatisticsEnabled",{get:function(){var a=this.props.AggregationMaster.Model.GradeStatistics;return this.QuestionMaster.Model.IsQuiz&&this.QuestionMaster.hasCorrectAnswers()&&this.isValueInitialized(a.CorrectCount)&&this.isValueInitialized(a.WrongCount)&&(a.CorrectCount||a.WrongCount)},enumerable:!0,configurable:!0}),d}(a.ReactComponent);c.QuizQuestionTitleContextView=d}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.getTypeName=function(){return a.Model.QuestionType.Ranking},c.prototype.getPreviewImageName=function(){return"bar.png"},c.prototype.createQuestionViewContent=function(){return[this.createStackedBarControlContainer()]},c}(b.QuestionViewBase);b.RankingQuestionView=c}(b=a.Analysis||(a.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(d){function e(){return null!==d&&d.apply(this,arguments)||this}return __extends(e,d),e.prototype.createQuestionTitleContent=function(){return React.createElement(c.QuizQuestionTitleContextView,{AggregationMaster:this.props.AggregationMaster})},e.prototype.createStackedBarControlContainer=function(){var c=b.convertToArray(this.props.AggregationMaster.Model.RankingQuestionAggregation);if(c&&c.length>0){var d=[],e=[];c.forEach(function(a,b){d.push(a.Statistics[0]),e.push(a.Statistics[1])});var f=[{backgroundColor:"#06B65F",label:b.Resources.LocalizedStrings.AnalyzeView_Correct,data:d},{backgroundColor:"#FF1225",label:b.Resources.LocalizedStrings.AnalyzeView_InCorrect,data:e}];return React.createElement(a.Control.RankingChartControl,{Type:a.Control.StackedBarType.QuizRanking,Labels:c.map(function(a){return a.Name}),Data:f,HasLegend:!0,key:"rankingChartControl"})}},e}(c.RankingQuestionView);c.registerQuestionViewClass(d,b.Model.QuestionClassType.Quiz)}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(d){function e(){return null!==d&&d.apply(this,arguments)||this}return __extends(e,d),e.getTypeName=function(){return b.Model.QuestionType.Rating},e.prototype.getPreviewImageName=function(){return"rating.png"},e.prototype.createQuestionViewContent=function(){return[this.createResponsesCountLabel(),this.createAverageRating()]},e.prototype.componentDidMount=function(){this.updateRatingValue()},e.prototype.componentDidUpdate=function(){this.updateRatingValue()},e.prototype.updateRatingValue=function(){$(".rateit").rateit();var a=ReactDOM.findDOMNode(this.refs.star);a&&$(a).rateit("value",this.getAverageRating())},e.prototype.createResponsesCountLabel=function(){var a={Data:this.props.AggregationMaster.Model.RatingQuestionAggregation.ResponseCount,Description:b.Resources.LocalizedStrings.AnalyzeView_Total_Response,Ignorable:!1,IsReady:!0};return React.createElement(c.SimpleDataControl,__assign({},a,{key:"responseCount"}))},e.prototype.createAverageRating=function(){switch(this.props.AggregationMaster.QuestionMaster.Model.RatingShape){case b.Model.RatingShape.Number:return this.createNumberAverageRating();case b.Model.RatingShape.Star:default:return this.createStarAverageRating()}},e.prototype.createNumberAverageRating=function(){var a={ClassName:"analyze-view-detail-datacircle",Count:this.getAverageRating(),Description:b.Resources.LocalizedStrings.AnalyzeView_Average_Rating.format(this.getAverageRating().toFixed(2))};return React.createElement("div",{className:"survey-analyze-view-rating-container",key:"numberAverage"},React.createElement(c.DataCircleControl,__assign({},a)))},e.prototype.createStarAverageRating=function(){var c=a.Control.createRating({Disabled:!0,HTMLAttributes:{className:"analyze-view-details-rating office-form-theme-primary-foreground",key:"rateit",title:this.getAverageRating().toFixed(2).toString()},Length:this.props.AggregationMaster.QuestionMaster.Model.Length,onValueChange:void 0,ShowRatingLabel:!1,Value:this.getAverageRating()});return React.createElement("div",{className:"survey-analyze-view-rating-container",key:"starAverage"},c,React.createElement("div",{className:"analyze-view-summary-status-label"},b.Resources.LocalizedStrings.AnalyzeView_Average_Rating.format(this.getAverageRating().toFixed(2))))},e.prototype.getAverageRating=function(){var a=this.props.AggregationMaster.Model.RatingQuestionAggregation.AverageRating;return a?Math.round(100*a)/100:0},e}(c.QuestionViewBase);c.RatingQuestionViewBase=d}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),c.prototype.createQuestionTitleContent=function(){return React.createElement(b.QuizQuestionTitleContextView,{AggregationMaster:this.props.AggregationMaster})},c}(b.RatingQuestionViewBase);b.registerQuestionViewClass(c,a.Model.QuestionClassType.Quiz)}(b=a.Analysis||(a.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var latestMathMaxLength=120,OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(d){function e(){return null!==d&&d.apply(this,arguments)||this}return __extends(e,d),e.getTypeName=function(){return b.Model.QuestionType.TextField},e.prototype.getPreviewImageName=function(){return"text.png"},e.prototype.createQuestionViewContent=function(){return[this.createResponsesCountLabel(),this.createLatestTextsView()]},e.prototype.createResponsesCountLabel=function(){var a={Data:this.props.AggregationMaster.Model.TextQuestionAggregation.ResponseCount,Description:b.Resources.LocalizedStrings.AnalyzeView_Total_Response,Ignorable:!1,IsReady:!0};return React.createElement(c.SimpleDataControl,__assign({},a,{key:"responseCount"}))},e.prototype.createLatestTextsView=function(){return React.createElement("div",{className:"survey-analyze-view-detail-text-recent",key:"latestResponses"},React.createElement("div",{className:"analyze-view-summary-status-label"},b.Resources.LocalizedStrings.Analyze_View_Text_Recent_Responses),this.getLatestTexts())},e.prototype.getLatestTexts=function(){var c=this,d=b.convertToArray(this.props.AggregationMaster.Model.TextQuestionAggregation.TopAnswers);return _.map(d,function(b,d){if(!(c.props.AggregationMaster.Model.IsMathQuestion&&b.Answer.length>latestMathMaxLength)){if(b.IsMath){var e=a.Control.createFormulaRenderer({Formula:'"'+b.Answer+'"'});return React.createElement("div",{className:"analyze-view-detail-text-lines",key:d},e)}return React.createElement("div",{className:"analyze-view-detail-text-lines",key:d},'"'+b.Answer+'"')}})},e}(c.QuestionViewBase);c.TextQuestionViewBase=d}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(d){function e(){return null!==d&&d.apply(this,arguments)||this}return __extends(e,d),e.prototype.createQuestionTitleContent=function(){return React.createElement(c.QuizQuestionTitleContextView,{AggregationMaster:this.props.AggregationMaster})},e.prototype.createQuestionViewContent=function(){return this.props.AggregationMaster.QuestionMaster.hasCorrectAnswers()?[this.createChartControlContainer()]:[d.prototype.createResponsesCountLabel.call(this),d.prototype.createLatestTextsView.call(this)]},e.prototype.createChartControlContainer=function(){var b=this.getTextStatistics(),c=_.map(b,function(b){var c;return c=b.IsMath?a.Control.createFormulaRenderer({Formula:b.Text}):a.Control.createUserTextRenderer({Text:b.Text,RenderMode:a.Control.UserTextRenderMode.RichText}),{labelName:b.Text,displayElement:c}}),d={Animation:this.props.AggregationMaster.Model.IsAggregationReady,Data:{data:b.map(function(a){return a.Count})},Labels:c,HasLegend:!0,TagLabels:this.getCorrectTexts(),Type:b.length<=5?a.Control.ChartType.Pie:a.Control.ChartType.Bar};return React.createElement(a.Control.ChartControl,__assign({},d,{key:"chartControl"}))},e.prototype.getTextStatistics=function(){var a=b.convertToArray(this.props.AggregationMaster.Model.TextQuestionAggregation.TextSummary),c=_.last(a);return c&&"answer_other"==c.Text&&(a[a.length-1].Text=b.Resources.LocalizedStrings.AnalyzeView_Chart_Others.format(c.Count)),a},e.prototype.getCorrectTexts=function(){var a={},c=new b.Model.Question.ShortTextAutograder(this.props.AggregationMaster.QuestionMaster.Model);return _.forEach(c.getAnswers(),function(b){return a[b.answer]=!0}),a},e}(c.TextQuestionViewBase);c.registerQuestionViewClass(d,b.Model.QuestionClassType.Quiz)}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){function c(a){return React.createElement(d,__assign({},a))}b.createSimpleDataControl=c;var d=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.render=function(){var b=a.Utilities.Html.combineAttributes(this.props.ClassName,"simple-data-control-container");this.props.Ignorable&&(b=a.Utilities.Html.combineAttributes(b,"optional-cell"));var c=_.extend({},this.props.HTMLAttributes);return c.className=a.Utilities.Html.combineAttributes(c.className,b),React.createElement("div",__assign({},c),this.createAccessibilityText(),this.createDataContent(),React.createElement("div",__assign({className:"simple-data-control-description"},this.getAttributesToHideFromScreenReader()),this.props.Description))},c.prototype.createDataContent=function(){return this.props.IsReady?React.createElement("div",__assign({className:"simple-data-control-content office-form-theme-primary-foreground"},this.getAttributesToHideFromScreenReader()),this.props.Data):React.createElement("div",{className:"simple-data-control-loading-spinner-animation"})},c.prototype.createAccessibilityText=function(){return this.props.AccessibilityText?React.createElement("a",{className:"screenReaderVisible",role:"presentation"},this.props.AccessibilityText):void 0},c.prototype.getAttributesToHideFromScreenReader=function(){return this.props.AccessibilityText?{"aria-hidden":!0,role:"presentation"}:void 0},c}(a.ReactComponent);b.SimpleDataControl=d}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return React.createElement(e,__assign({},a))}c.createSurveyAnalyzeView=d;var e=function(d){function e(a){var b=d.call(this,a)||this;return b.receiveMessageCallback=b.onReceiveFormsMessage.bind(b),b.onClickInsightEntryPoint=b.onClickInsightEntryPoint.bind(b),b}return __extends(e,d),e.prototype.initialize=function(){d.prototype.initialize.call(this),this.questionDetailMaster=new b.Model.SurveyResponsesDetailMaster(this.props.FormMaster)},e.prototype.registerObservers=function(){d.prototype.registerObservers.call(this),window.addEventListener("message",this.receiveMessageCallback,!1)},e.prototype.unregisterObservers=function(){d.prototype.unregisterObservers.call(this),window.removeEventListener("message",this.receiveMessageCallback)},Object.defineProperty(e.prototype,"QuestionClassType",{get:function(){return b.Model.QuestionClassType.Survey},enumerable:!0,configurable:!0}),e.prototype.createSummaryPanel=function(){var a=this.SummaryPanelProps;return c.createSurveyAnalyzeViewSummaryPanel({onClickInsightEntryPoint:this.onClickInsightEntryPoint,AggregationMaster:a.AggregationMaster,Form:this.props.FormMaster,onDeleteResponses:a.onDeleteResponses,onExportExcel:a.onExportExcel,onPrint:a.onPrint,onCreatePermissionToken:a.onCreatePermissionToken,onDeletePermissionToken:a.onDeletePermissionToken,PermissionToken:a.PermissionToken})},e.prototype.createQuestionDetailDialog=function(){var a=this;if(this.state.DetailDialogQuestionIndex>=0){var b={Index:this.state.DetailDialogQuestionIndex,QuestionDetailMaster:this.questionDetailMaster,onClose:function(){a.setState({DetailDialogQuestionIndex:-1},function(){Forms.UX.Utilities.jumpFocusBack(c.SurveyResponsesDetailDialog.name)})}};return React.createElement(c.SurveyResponsesDetailDialog,__assign({},b))}},e.prototype.createExtensionReviewContent=function(){var c=this,d=a.Control.createTextButton({HTMLAttributes:{className:"analyze-view-nav-button office-form-theme-button",onClick:function(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.ViewResults});var d=b.DesignPage.getUxStateMaster();d.startBulkEditMode(),d.Model.TopView="SurveyResults",c.FocusRef="view-survey-results-button",d.endBulkEditMode()},disabled:0===this.props.FormMaster.Model.ResponsesCount},ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.AnalyzeView_ViewResultsButton_Label,ref:"view-survey-results-button"});return React.createElement("div",{className:"analyze-view-nav-bar-left-button-container"},d)},e.prototype.onDetailViewLinkClick=function(a){d.prototype.onDetailViewLinkClick.call(this,a),this.questionDetailMaster=new b.Model.SurveyResponsesDetailMaster(this.props.FormMaster)},e.prototype.createInsightViewContainer=function(){var a=this;if(this.state.InsightDialogOpened){var b={FormMaster:this.props.FormMaster,ShowInsight:this.state.InsightType,onClose:function(){return a.onCloseInsightView()}};return c.createFormInsightView(b)}},e.prototype.openInsightDialog=function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.ClickInsightEntryPoint,extraData:{InsightType:b}}),this.setState({InsightDialogOpened:!0,InsightType:b})},e.prototype.onClickInsightEntryPoint=function(a){this.openInsightDialog(a)},e.prototype.onCloseInsightView=function(){this.setState({InsightDialogOpened:!1})},e.prototype.onReceiveFormsMessage=function(b){var c="string"==typeof b.data?b.data.toLowerCase():"";if(c.startsWith("formreexporterror:")&&c.indexOf(a.DataProvider.ErrorCode.InnerCode.NoODPermissionForOpenInExcel.toString())>=0){var d={innerCode:a.DataProvider.ErrorCode.InnerCode.NoODPermissionForOpenInExcel};this.props.showErrorPage&&this.props.showErrorPage(d)}},e}(c.AnalyzeViewBase);c.SurveyAnalyzeView=e}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var QuestionType=OfficeForm.Exports.Models.QuestionType,OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return React.createElement(e,__assign({},a))}c.createSurveyAnalyzeViewSummaryPanel=d;var e=function(c){function d(a){var b=c.call(this,a)||this;return b.onKeyDownAverageTimeData=b.onKeyDownAverageTimeData.bind(b),b.onKeyDownInsightData=b.onKeyDownInsightData.bind(b),b.onClickAverageTimeData=b.onClickAverageTimeData.bind(b),b.onClickInsightData=b.onClickInsightData.bind(b),b}return __extends(d,c),d.prototype.componentDidMount=function(){this.isValidForInsight()&&a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.ShowInsightEntryPoint})},d.prototype.insightContent=function(){if(!a.Flighting.Flight.isEnabled(a.Flighting.Flights.FormInsight))return null;if(this.props.AggregationMaster.FormMaster.SyncContext===b.Model.FormSyncContext.AnalysisTimeForm)return null;if(!this.isValidForInsight())return null;var c="Lightbulb",d=b.Resources.LocalizedStrings.AnalyzeView_Insight_Button;a.Flighting.Flight.isEnabled(a.Flighting.Flights.UseIdeas)&&(c="LightningBolt",d=b.Resources.LocalizedStrings.AnalyzeView_Ideas_Button);var e={HTMLAttributes:{className:"insight-view-summery-button",onClick:this.onClickInsightData,onKeyDown:this.onKeyDownInsightData},ButtonStyle:a.Control.ButtonStyle.None,GlyphButtonStyle:a.Control.GlyphButtonStyle.Vertical,Icon:c,IconClassName:"insight-view-summary-button-icon office-form-theme-primary-foreground",Text:d,TextClassName:"insight-view-summary-button-text"};return React.createElement("div",{className:"analyze-view-summary-table analyze-view-insight-container"},React.createElement("div",{className:"analyze-view-summary-container"},a.Control.createGlyphButton(e)))},d.prototype.getAverageTimeProps=function(){var d=c.prototype.getAverageTimeProps.call(this);return a.Flighting.Flight.isEnabled(a.Flighting.Flights.SubmitTimeDistributionInsight)?this.props.AggregationMaster.FormMaster.SyncContext===b.Model.FormSyncContext.AnalysisTimeForm?d:(d.ClassName="insight-view-time-distribution-button",d.HTMLAttributes={onClick:this.onClickAverageTimeData,onKeyDown:this.onKeyDownAverageTimeData,tabIndex:0},d):d},d.prototype.onKeyDownAverageTimeData=function(b){(b.keyCode===a.KeyCode.Space||b.keyCode===a.KeyCode.Enter)&&this.props.onClickInsightEntryPoint("TimeDistribution")},d.prototype.onClickAverageTimeData=function(a){this.props.onClickInsightEntryPoint("TimeDistribution")},d.prototype.onKeyDownInsightData=function(b){(b.keyCode===a.KeyCode.Space||b.keyCode===a.KeyCode.Enter)&&this.props.onClickInsightEntryPoint("Insights")},d.prototype.onClickInsightData=function(a){this.props.onClickInsightEntryPoint("Insights")},d.prototype.isValidForInsight=function(){var b=this.props,c=b.Form.Model.Questions,d=b.AggregationMaster.Model.TotalResponseCount>=10&&b.AggregationMaster.Model.TotalResponseCount<=5e3;if(!d)return!1;var e=_.filter(c,function(a){return a.Type===QuestionType.TextField&&a.Multiline}).length,f=_.filter(c,function(a){return a.Type===QuestionType.Rating}).length,g=_.filter(c,function(a){return a.Type===QuestionType.Choice||a.Type===QuestionType.ChoiceV2}).length,h=_.filter(c,function(a){return a.Type===QuestionType.MatrixChoiceGroup}).length,i=_.filter(c,function(a){return a.Type===QuestionType.Rating||a.IsNumber}).length,j=f+g>=4,k=1===f&&g>=2,l=a.Flighting.Flight.isEnabled(a.Flighting.Flights.EnablePartialOrderInsight)&&h>=1,m=a.Flighting.Flight.isEnabled(a.Flighting.Flights.EnableNPSKeywordsInsight)&&i>=1&&g>=2,n=a.Flighting.Flight.isEnabled(a.Flighting.Flights.EnableResponseSentimentInsight)&&e>=1;return j||k||l||m||n},d}(c.AnalyzeViewSummaryPanelBase);c.SurveyAnalyzeViewSummaryPanel=e}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),c.prototype.createQuestionTitleContent=function(){return React.createElement(b.SurveyQuestionTitleContextView,{AggregationMaster:this.props.AggregationMaster})},Object.defineProperty(c.prototype,"CorrectOptions",{get:function(){return{}},enumerable:!0,configurable:!0}),c.prototype.createDisplayElement=function(a){return null},c}(b.ChoiceQuestionViewBase);b.registerQuestionViewClass(c,a.Model.QuestionClassType.Survey)}(b=a.Analysis||(a.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),c.prototype.createQuestionTitleContent=function(){return React.createElement(b.SurveyQuestionTitleContextView,{AggregationMaster:this.props.AggregationMaster})},c}(b.DateQuestionViewBase);b.registerQuestionViewClass(c,a.Model.QuestionClassType.Survey)}(b=a.Analysis||(a.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c=function(a){function c(){
return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),c.prototype.createQuestionTitleContent=function(){return React.createElement(b.SurveyQuestionTitleContextView,{AggregationMaster:this.props.AggregationMaster})},c}(b.FileUploadQuestionViewBase);b.registerQuestionViewClass(c,a.Model.QuestionClassType.Survey)}(b=a.Analysis||(a.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),c.prototype.createQuestionTitleContent=function(){return React.createElement(b.SurveyQuestionTitleContextView,{AggregationMaster:this.props.AggregationMaster})},c}(b.LikertQuestionViewBase);b.registerQuestionViewClass(c,a.Model.QuestionClassType.Survey)}(b=a.Analysis||(a.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),c.prototype.createQuestionTitleContent=function(){return React.createElement(b.SurveyQuestionTitleContextView,{AggregationMaster:this.props.AggregationMaster})},c}(b.NPSQuestionViewBase);b.registerQuestionViewClass(c,a.Model.QuestionClassType.Survey)}(b=a.Analysis||(a.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.render=function(){return React.createElement("div",{className:"analzye-view-detail-title"},React.createElement(a.Control.UserTextRenderer,{Text:this.QuestionMaster.Model.Title,RenderMode:a.Control.UserTextRenderMode.RichText}))},Object.defineProperty(c.prototype,"QuestionMaster",{get:function(){return this.props.AggregationMaster.QuestionMaster},enumerable:!0,configurable:!0}),c}(a.ReactComponent);b.SurveyQuestionTitleContextView=c}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(d){function e(){return null!==d&&d.apply(this,arguments)||this}return __extends(e,d),e.prototype.createQuestionTitleContent=function(){return React.createElement(c.SurveyQuestionTitleContextView,{AggregationMaster:this.props.AggregationMaster})},e.prototype.createStackedBarControlContainer=function(){var c=b.convertToArray(this.props.AggregationMaster.Model.RankingQuestionAggregation);this.props.AggregationMaster.getTotalResponsesCount();if(c&&c.length>0){for(var d=c.length,e=[b.Resources.LocalizedStrings.AnalyzeView_Sort_First,b.Resources.LocalizedStrings.AnalyzeView_Sort_Second,b.Resources.LocalizedStrings.AnalyzeView_Sort_Third,b.Resources.LocalizedStrings.AnalyzeView_Sort_Fourth,b.Resources.LocalizedStrings.AnalyzeView_Sort_Fifth,b.Resources.LocalizedStrings.AnalyzeView_Sort_Sixth,b.Resources.LocalizedStrings.AnalyzeView_Sort_Seventh,b.Resources.LocalizedStrings.AnalyzeView_Sort_Eighth,b.Resources.LocalizedStrings.AnalyzeView_Sort_Ninth,b.Resources.LocalizedStrings.AnalyzeView_Sort_Tenth],f=b.Resources.LocalizedStrings.AnalyzeView_Chart_Pick,g=[],h=0;d>h;h++)g[h]={label:f.format(e[h]),data:[]};var i=[],j=c[0].Weight,k=1;_.forEach(c,function(a,b){j!==a.Weight&&k++,i.push(k),j=a.Weight,_.forEach(a.Statistics,function(c,d){g[d].data[b]=a.Statistics[d]})});var l={Type:a.Control.StackedBarType.SurveyRanking,Labels:c.map(function(a){return a.Name}),Data:g,HasLegend:!0,yLabels:i};return React.createElement(a.Control.RankingChartControl,__assign({},l,{key:"rankingChartControl"}))}},e}(c.RankingQuestionView);c.registerQuestionViewClass(d,b.Model.QuestionClassType.Survey)}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),c.prototype.createQuestionTitleContent=function(){return React.createElement(b.SurveyQuestionTitleContextView,{AggregationMaster:this.props.AggregationMaster})},c}(b.RatingQuestionViewBase);b.registerQuestionViewClass(c,a.Model.QuestionClassType.Survey)}(b=a.Analysis||(a.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;return a.closeRef=React.createRef(),a.changeCallback=function(){a.mounted&&a.forceUpdate()},a.state={PagingIndex:0,QuestionIndex:-1,ShowErrorMessage:!1},a}return __extends(d,c),d.prototype.componentWillMount=function(){this.props.QuestionDetailMaster&&(this.props.QuestionDetailMaster.observe(this.changeCallback,[b.Model.SurveyResponsesDetailMaster.Schema.Answers,b.Model.SurveyResponsesDetailMaster.Schema.IsPagingReady]),this.props.QuestionDetailMaster.syncData(0)),this.setState({QuestionIndex:this.props.Index})},d.prototype.componentDidMount=function(){this.mounted=!0,this.closeRef.current&&this.closeRef.current.focus(),Forms.UX.Utilities.trapFocusInsideElement(ReactDOM.findDOMNode(this)),this.createDataTable()},d.prototype.componentDidUpdate=function(){this.createDataTable()},d.prototype.componentWillUnmount=function(){this.props.QuestionDetailMaster&&this.props.QuestionDetailMaster.unobserve(this.changeCallback),this.mounted=!1},d.prototype.render=function(){var b=this;return this.props.QuestionDetailMaster&&this.state.QuestionIndex>=0?React.createElement("div",{className:"response-dialog-container",onKeyDown:function(c){(c.keyCode===a.KeyCode.BackSpace||c.keyCode===a.KeyCode.ArrowLeft&&c.altKey)&&(c.stopPropagation(),c.preventDefault()),c.keyCode===a.KeyCode.Esc&&b.props.onClose&&b.props.onClose()}},this.createPreviousQuestionButton(),this.createDetailDialog(),this.createNextQuestionButton()):void 0},d.prototype.createPreviousQuestionButton=function(){var c=this,d=this.props.QuestionDetailMaster.Model.TopLevelQuestions.length;if(this.state.QuestionIndex>0&&this.state.QuestionIndex<d){var e={HTMLAttributes:{className:"response-dialog-previous-button",title:b.Resources.LocalizedStrings.AnalyzeView_DetailResponses_Previous_Button,onClick:function(){b.Model.logEvent(a.Event.EngagementEventNames.DesignPage.Analysis.DetailDialogQuestionNavigate,{entry:"PreviouseQuestion"}),c.setState({QuestionIndex:c.state.QuestionIndex-1})}},Icon:"ChevronLeft",GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly,ButtonStyle:a.Control.ButtonStyle.LightBackground};return a.Control.createGlyphButton(e)}},d.prototype.createNextQuestionButton=function(){var c=this,d=this.props.QuestionDetailMaster.Model.TopLevelQuestions.length;if(this.state.QuestionIndex>=0&&this.state.QuestionIndex<d-1){var e={HTMLAttributes:{className:"response-dialog-next-button",title:b.Resources.LocalizedStrings.AnalyzeView_DetailResponses_Next_Button,onClick:function(){b.Model.logEvent(a.Event.EngagementEventNames.DesignPage.Analysis.DetailDialogQuestionNavigate,{entry:"NextQuestion"}),c.setState({QuestionIndex:c.state.QuestionIndex+1})}},Icon:"ChevronRight",GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly,ButtonStyle:a.Control.ButtonStyle.LightBackground};return a.Control.createGlyphButton(e)}},d.prototype.createDetailDialog=function(){var a=b.Resources.LocalizedStrings.AnalyzeView_Detail_DialogTitle.format(this.state.QuestionIndex+1);return React.createElement("div",{"aria-label":a,className:"response-dialog",role:"dialog"},this.createCloseButton(),this.createDetailTitle(),this.createDetailSummary(),this.createLoadingSpinner(),this.createDetailContent())},d.prototype.createCloseButton=function(){var c={HTMLAttributes:{title:b.Resources.LocalizedStrings.AnalyzeView_DetailResponses_Close_Button,onClick:this.props.onClose,ref:this.closeRef,className:"response-dialog-close-button"},Icon:"Cancel",IconClassName:"forms-icon-size16x16",ButtonStyle:a.Control.ButtonStyle.LightBackground,GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly};return a.Control.createGlyphButton(c)},d.prototype.createDetailTitle=function(){var c=this.props.QuestionDetailMaster.Model.TopLevelQuestions[this.state.QuestionIndex].Title;return React.createElement("div",{className:"response-dialog-title"},React.createElement(a.Control.UserTextRenderer,{Text:b.Resources.LocalizedStrings.AnalyzeView_QuestionTitle.format(this.state.QuestionIndex+1,c),RenderMode:a.Control.UserTextRenderMode.RichText}))},d.prototype.createDetailSummary=function(){var c,d,e=this,f=this.props.QuestionDetailMaster.Model.TopLevelQuestions[this.state.QuestionIndex].Id,g=this.props.QuestionDetailMaster.getQuestionType(f)===b.Model.QuestionType.FileUpload,h=this.getQuestionAnswers(),i=b.Resources.LocalizedStrings.AnalyzeView_Total_Response;if(g&&h.length>0&&(i=b.Resources.LocalizedStrings.UploadFile_Files_OneDreive,c=a.Control.createTextButton({HTMLAttributes:{className:"survey-response-dialog-folder-button office-form-theme-button",onClick:function(){e.props.QuestionDetailMaster.getFileUploadFolder(f).done(function(b){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.Analysis.OpenFileFolder}),a.Utilities.Html.safeOpen(b)}).fail(function(b){b&&b.response&&b.response.statusCode===a.DataProvider.ErrorCode.HttpStatusCode.NotFound&&(e.setState({ShowErrorMessage:!0}),setTimeout(function(){e.mounted&&e.state.ShowErrorMessage&&e.setState({ShowErrorMessage:!1})},5e3))})}},ButtonStyle:a.Control.ButtonStyle.LightBackground,Text:b.Resources.LocalizedStrings.UploadFile_OpenFolder_Button}),d=this.state.ShowErrorMessage&&React.createElement("div",{className:"response-dialog-folder-button-error-message"},b.Resources.LocalizedStrings.UploadFile_FolderNotExist_ErrorMessage)),this.props.QuestionDetailMaster.getAnswersCount()<this.props.QuestionDetailMaster.Model.PagingSize)return h.length>0?React.createElement("div",null,React.createElement("div",{className:"survey-response-dialog-summary"},React.createElement("div",{className:"survey-response-dialog-container"},React.createElement("span",{className:"survey-response-dialog-response-count office-form-theme-primary-foreground"},h.length),i),c),d):void 0;var j=this.props.QuestionDetailMaster.getPagingRegion(this.state.PagingIndex),k=j.Start.toString(),l=j.End.toString(),m=this.props.QuestionDetailMaster.getAnswersCount().toString();return React.createElement("div",{className:"survey-response-dialog-paging-summary"},React.createElement("div",{className:"survey-response-dialog-paging-info-container"},React.createElement("span",{className:"survey-response-dialog-region-info"},b.Resources.LocalizedStrings.AnalyzeView_DetailResponses_PagingRegion_Message.format(k,l)),React.createElement("span",{className:"survey-response-dialog-region-separator"},"|"),m),this.createPreviousPageButton(),this.createNextPageButton())},d.prototype.createDetailContent=function(){return this.props.QuestionDetailMaster.getAnswersCount()>0?React.createElement("div",{className:"response-dialog-content"},React.createElement("div",{className:"response-dialog-table-container"},React.createElement("table",{className:"response-dialog-table hover stripe cell-border"}))):React.createElement("div",{className:"response-dialog-no-responses-message"},b.Resources.LocalizedStrings.AnalyzeView_DetailResponses_NoResponses_Message)},d.prototype.createPreviousPageButton=function(){var c=this,d={className:"question-detail-page-previous-button",disabled:0===this.state.PagingIndex,onClick:function(){c.state.PagingIndex>0&&(b.Model.logEvent(a.Event.EngagementEventNames.DesignPage.Analysis.DetialDialogPaging,{entry:"PreviousPage"}),c.props.QuestionDetailMaster.SyncPreviousPageData(),c.setState({PagingIndex:c.state.PagingIndex-1}))}};return a.Control.createGlyphButton({ButtonStyle:a.Control.ButtonStyle.DarkBackGround,GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly,HTMLAttributes:d,Icon:"PageLeft",Text:b.Resources.LocalizedStrings.AnalyzeView_DetailResponses_PreviousPage})},d.prototype.createNextPageButton=function(){var c=this,d=this.props.QuestionDetailMaster.Model.PagingSize,e=this.props.QuestionDetailMaster.getAnswersCount(),f=(this.state.PagingIndex+1)*d>=e,g={className:"question-detail-page-next-button",disabled:f,onClick:function(){c.state.PagingIndex>=0&&!f&&(b.Model.logEvent(a.Event.EngagementEventNames.DesignPage.Analysis.DetialDialogPaging,{entry:"NextPage"}),c.props.QuestionDetailMaster.SyncNextPageData(),c.setState({PagingIndex:c.state.PagingIndex+1}))}};return a.Control.createGlyphButton({ButtonStyle:a.Control.ButtonStyle.DarkBackGround,GlyphButtonStyle:a.Control.GlyphButtonStyle.GlyphOnly,HTMLAttributes:g,Icon:"PageRight",Text:b.Resources.LocalizedStrings.AnalyzeView_DetailResponses_NextPage})},d.prototype.createLoadingSpinner=function(){if(this.props.QuestionDetailMaster.getAnswersCount()>0&&!this.props.QuestionDetailMaster.Model.IsPagingReady){this.resetDataTable();var c={ClassName:"survey-reponse-detail-loading-container",LoadingDescription:b.Resources.LocalizedStrings.AnalyzeView_Loading};return React.createElement(a.Control.LoadingControl,__assign({},c))}},d.prototype.createDataTable=function(){if(this.props.QuestionDetailMaster.getAnswersCount()>0&&this.props.QuestionDetailMaster.Model.IsPagingReady){this.resetDataTable();var a=this.props.QuestionDetailMaster.Model.TopLevelQuestions[this.state.QuestionIndex].Id;this.dataTable=$(".response-dialog-table").DataTable({data:this.createTableData(a),columns:this.createTableHeaders(a),searching:!1,paging:!1,info:!1,autoWidth:!0})}},d.prototype.createTableHeaders=function(a){var c=[b.Resources.LocalizedStrings.AnalyzeView_Sort_First,b.Resources.LocalizedStrings.AnalyzeView_Sort_Second,b.Resources.LocalizedStrings.AnalyzeView_Sort_Third,b.Resources.LocalizedStrings.AnalyzeView_Sort_Fourth,b.Resources.LocalizedStrings.AnalyzeView_Sort_Fifth,b.Resources.LocalizedStrings.AnalyzeView_Sort_Sixth,b.Resources.LocalizedStrings.AnalyzeView_Sort_Seventh,b.Resources.LocalizedStrings.AnalyzeView_Sort_Eighth,b.Resources.LocalizedStrings.AnalyzeView_Sort_Ninth,b.Resources.LocalizedStrings.AnalyzeView_Sort_Tenth],d=[b.Resources.LocalizedStrings.AnalyzeView_Total_Response],e=[{title:b.Resources.LocalizedStrings.AnalyzeView_Response_ID},{title:b.Resources.LocalizedStrings.AnalyzeView_ExcelHeader_ResponderName}],f=[],g=this.props.QuestionDetailMaster.getAnswerColumnCount(a),h=60/g+"%";switch(this.props.QuestionDetailMaster.getQuestionType(a)){case b.Model.QuestionType.Ranking:$(".response-dialog-table").addClass("response-dialog-table-ranking"),f=_.first(c,g);break;case b.Model.QuestionType.MatrixChoiceGroup:$(".response-dialog-table").removeClass("response-dialog-table-ranking");for(var i=1;g>i;i++)d.push("");f=d;break;case b.Model.QuestionType.NPS:$(".response-dialog-table").removeClass("response-dialog-table-ranking"),f=[b.Resources.LocalizedStrings.AnalyzeView_NPS_Score,b.Resources.LocalizedStrings.AnalyzeView_NPS_Category];break;default:f=d}return f=_.map(f,function(a){return{title:a,width:h}}),e.concat(f)},d.prototype.createTableData=function(a){var c,d=this,e=this.props.QuestionDetailMaster.getPagingRegion(this.state.PagingIndex).Start,f=this.getQuestionAnswers(),g=this.props.QuestionDetailMaster.getQuestionType(a);switch(g){case b.Model.QuestionType.Ranking:c=_.map(f,function(a,b){var c=[e+b,d.encodeString(a.ResponderName)];return c.concat(JSON.parse(a.Answer).map(function(a){return d.formatAnswerString(a)}))});break;case b.Model.QuestionType.MatrixChoiceGroup:c=_.map(f,function(a,b){var c=[e+b,d.encodeString(a.ResponderName)];return c.concat(a.Answer.map(function(a){return d.formatAnswerString(a)}))});var h=_.filter(this.props.QuestionDetailMaster.Model.Questions,function(b){return b.GroupId===a}),i=_.map(h,function(a){return d.formatAnswerString(a.Title)});c.length&&c.splice(0,0,["",""].concat(i));break;case b.Model.QuestionType.NPS:b.Resources.LocalizedStrings.NPS_Promoters,b.Resources.LocalizedStrings.NPS_Passives,b.Resources.LocalizedStrings.NPS_Detractors;c=_.map(f,function(a,b){var c=a.Answer;return[e+b,d.encodeString(a.ResponderName),c,Forms.UX.Controls.getNpsCategoryDescription(c)]});break;case b.Model.QuestionType.FileUpload:c=_.map(f,function(a,b){if(a.Answer){var c=JSON.parse(a.Answer);if(c.length>0){var f=c[0],g=Forms.UX.FileUpload.getFileIconInDetailTable(f.name),h=d.encodeString(f.name),i=f.link.split('"')[0],j=g+('<a href="'+i+"\" target='_blank' class='response-dialog-fileName'>"+h+"</a>"),k=[e+b,d.encodeString(a.ResponderName),j];return k}}});break;default:c=_.map(f,function(a,b){var c=[e+b,d.encodeString(a.ResponderName)];return c.concat([d.formatAnswerString(a.Answer)])})}return c},d.prototype.encodeString=function(b){return b&&a.Utilities.Html.encodeHTML(""+b)},d.prototype.resetDataTable=function(){this.dataTable&&($(".dataTables_wrapper").remove(),$(".response-dialog-table").remove(),$(".response-dialog-table-container").append("<table class='response-dialog-table hover stripe cell-border'></table>"),this.dataTable.destroy(),this.dataTable=void 0)},d.prototype.formatAnswerString=function(b){return a.Control.RichTextUtil.keepOnlyRichTextHtml(b)},d.prototype.getQuestionAnswers=function(){var a=this.props.QuestionDetailMaster.Model.TopLevelQuestions,c=a[this.state.QuestionIndex],d=c?c.Id:void 0;if(c.Type===b.Model.QuestionType.MatrixChoiceGroup){var e=_.pluck(_.filter(this.props.QuestionDetailMaster.Model.Questions,function(a){return a.GroupId===d}),"Id");return this.props.QuestionDetailMaster.getQuestionsAnswers(e)}return this.props.QuestionDetailMaster.getQuestionAnswers(d)},d}(a.ReactComponent);c.SurveyResponsesDetailDialog=d}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}return __extends(c,a),c.prototype.createQuestionTitleContent=function(){return React.createElement(b.SurveyQuestionTitleContextView,{AggregationMaster:this.props.AggregationMaster})},c}(b.TextQuestionViewBase);b.registerQuestionViewClass(c,a.Model.QuestionClassType.Survey)}(b=a.Analysis||(a.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=function(d){function e(){var a=null!==d&&d.apply(this,arguments)||this;return a.onChangeCallback=function(){if(a.isComponentMounted){var b=a.individualMaster.Model.Response;b&&(a.formRuntimeMaster.Answers=b.Answers),a.forceUpdate()}},a}return __extends(e,d),e.prototype.componentWillMount=function(){var a=this;this.individualMaster=new b.Model.IndividualMaster(this.props.FormMaster),this.individualMaster.observe(this.onChangeCallback,[this.individualMaster.Schema.Response,this.individualMaster.Schema.Summary,this.individualMaster.Schema.IsIndividualModelReady]),this.individualMaster.syncData(0).fail(function(b){return a.changeUxState(function(a){return a.Model.CriticalError=b})}),this.formRuntimeMaster=new b.Model.FormRuntimeMaster(this.props.FormMaster,{disableShuffle:!0})},e.prototype.componentDidMount=function(){this.isComponentMounted=!0,this.scrollToTop(),a.Event.EngagementEventDeprecated.logData({name:OfficeFormGrading.Events.SurveyView.Load})},e.prototype.componentWillUnmount=function(){this.individualMaster.unobserve(this.onChangeCallback)},e.prototype.render=function(){var a=this,b={IsDataReady:this.individualMaster.Model.IsIndividualModelReady,SelectedControlData:this.individualMaster.Model.Summary,onResoponeDelete:function(b){return a.individualMaster.deleteResponse(b)},onSelectedResponseChange:function(b){return a.individualMaster.changeDetailByResponseId(b)}},d={FormRuntimeMaster:this.formRuntimeMaster,IsLoading:!this.individualMaster.Model.IsIndividualModelReady,IsResponseValid:!!this.individualMaster.Model.Response};return React.createElement("div",null,this.createIndividualSummaryNotification(),React.createElement(c.IndividualViewSummary,__assign({},b)),React.createElement(c.IndividualViewDetail,__assign({},d)))},e.prototype.createIndividualSummaryNotification=function(){return this.props.FormMaster.Model.ResponsesCount>b.Model.pagingSize?React.createElement("div",{className:"individual-summary-hint-container"},React.createElement("span",{className:"individual-summary-hint-warning"},b.Resources.LocalizedStrings.IndividualView_ExportExcel_Warning.format(b.Model.pagingSize))):void 0},e.prototype.scrollToTop=function(){var a=document.getElementById("scrollAnchor");a&&a.scrollIntoView()},e.prototype.changeUxState=function(b){var c=a.Form.DesignPage.getUxStateMaster();c.startBulkEditMode(),b(c),c.endBulkEditMode()},e}(a.ReactComponent);c.SurveyIndividualViewContainer=d}(c=b.Analysis||(b.Analysis={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){function b(a,b,c){return d(c)[b]=a}function c(a,b){var c=d(b)[a];return new c}function d(a){switch(a){case"Survey":return g;case"Quiz":return f;default:throw Error("Not supported.")}}var e=function(){function a(){}return a.getAggregateDelegator=function(a,b){return c(a,b)},a.prototype.getQuestionAnswer=function(a,b){return _.compact(_.map(a,function(a){var c=_.find(a.Answers,function(a){return a.QuestionId===b&&a.Answer});return c?{Answer:c.Answer,Id:a.Id}:void 0}))},a}();a.QuestionAggregateDelegatorBase=e,a.registerQuestionDelegatorClass=b,a.createQuestionAggregationDelegator=c;var f={},g={}}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;return a.otherOptionTag="answer_other",a}return __extends(d,c),d.getDelegatorName=function(){return"ChoiceAggregationDelegator"},d.prototype.aggregate=function(a,b){a?this.aggregateInternal(a,b):this.setDefaultAggregateToModel(b)},d.prototype.aggregateInternal=function(c,d){var e=b.getQuestionAggregationMaster(d).QuestionMaster,f=d.ChoiceQuestionAggregation;f.ChoiceSummary=a.convertToArray(e.Model.Choices).map(function(a){var b=_.find(c.formChoiceData,function(b){return b.id===a.Description});return{Choice:a.Description,Count:null==b?0:b.count,IsFormula:a.IsMathOption}});var g=_.find(c.formChoiceData,function(a){return"_Other"==a.id});(g||b.getQuestionAggregationMaster(d).QuestionMaster.Model.AllowOtherAnswer)&&Nerve.Collection.addItems(f.ChoiceSummary,[{Choice:this.otherOptionTag,Count:g?g.count:0,IsFormula:!1}])},d.prototype.setDefaultAggregateToModel=function(c){var d=b.getQuestionAggregationMaster(c).QuestionMaster,e=c.ChoiceQuestionAggregation;e.ChoiceSummary=a.convertToArray(d.Model.Choices).map(function(a){return{Choice:a.Description,Count:0,IsFormula:a.IsMathOption}}),b.getQuestionAggregationMaster(c).QuestionMaster.Model.AllowOtherAnswer&&Nerve.Collection.addItems(e.ChoiceSummary,[{Choice:this.otherOptionTag,Count:0,IsFormula:!1}])},d}(b.QuestionAggregateDelegatorBase);b.ChoiceAggregationDelegatorBase=c}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(b){var c="MM/dd/yyyy hh:mm:ss tt",d=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}return __extends(d,b),d.getDelegatorName=function(){return"DateAggregationDelegator"},d.prototype.aggregate=function(a,b){var c=this;if(a){var d=b.DateQuestionAggregation;d.ResponseCount=a.dateData.count,d.TopDate=a.dateData.recentValues.filter(function(a){return null!=a}).map(function(a){return{Id:void 0,Answer:c.parseDate(a)}})}else this.setDefaultAggregateToModel(b)},d.prototype.setDefaultAggregateToModel=function(a){var b=a.DateQuestionAggregation;b.ResponseCount=0,b.TopDate=null},d.prototype.parseDate=function(b){var d=a.FormLimitation.DateQuestionAnswerFormat;return b.length>d.length?Date.parseDate(b,c,OfficeFormServerInfo.cultureInfo):Date.parseDate(b,d,OfficeFormServerInfo.cultureInfo)},d}(b.QuestionAggregateDelegatorBase);b.DateAggregationDelegatorBase=d}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.getDelegatorName=function(){return"FileUploadAggregationDelegator"},b.prototype.aggregate=function(a,b){a?this.aggregateInternal(a,b):this.setDefaultAggregateToModel(b)},b.prototype.setDefaultAggregateToModel=function(a){var b=a.FileUploadQuestionAggregation;b.ResponseCount=0,b.RecentFile=null},b}(a.QuestionAggregateDelegatorBase);a.FileUploadAggregationDelegatorBase=b}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(a){return Nerve.getObjectMasterFromModel(a)}function e(a){return{SummaryAggregation:{AverageSubmitTime:0,FormStatus:a.SettingMaster.getFormStatus(),IsAggregationReady:!1,TotalResponseCount:a.Model.ResponsesCount},QuestionAggregations:_.map(a.Model.Questions,function(a){return{IsAggregationReady:!1,QuestionId:a.Id,IsMathQuestion:a.IsMathQuiz}})}}c.Models=a.DataProvider.Models;var f=Nerve.Spec,g=a.Form.Model.Question.ShortTextAutograder,h={SummaryAggregation:f.fromMasterClass(function(){return c.FormSummaryAggregationMaster}),QuestionAggregations:f.collectionOf(function(){return c.QuestionAggregationMaster})};c.getFormServerAggregationMaster=d,c.getDefaultFormAggregation=e;var i=function(d){function f(a){var c=d.call(this,{InitialData:e(a)})||this;return c.freezingTime=2e3,c.lazygetAggregateDataJobPool=[],c.responseChangeCallback=function(){return c.onFormMatrixChangeWithDataSync()},c.questionCountChangeCallback=function(a){c.bulkEdit(function(){var d=[],f=[];b.convertToArray(a.RemovedModels).forEach(function(a){var b=Nerve.Collection.getItemWithKeyFields(c.Model.QuestionAggregations,{QuestionId:a.Id});d.push(b)}),Nerve.Collection.deleteItems(c.Model.QuestionAggregations,d);var g=b.convertToArray(a.AddedModels).map(function(a){return a.Id});f=b.convertToArray(e(c.FormMaster).QuestionAggregations).filter(function(a){return g.some(function(b){return b===a.QuestionId})}),Nerve.Collection.addItems(c.Model.QuestionAggregations,f)}),c.FormMaster.Model.Settings.IsQuizMode&&a.RemovedModels.length?c.onFormMatrixChangeWithDataSync():(a.RemovedModels.length||a.AddedModels.length)&&c.onFormMatrixChangeWithoutDataSync()},c.questionContentChangeNoDataSyncCallback=function(){return c.onFormMatrixChangeWithoutDataSync()},c.questionContentChangeWithDataSyncCallback=function(){return c.onFormMatrixChangeWithDataSync()},c.form=a,c.getAggregateData().then(function(a){c.aggregate(a)}),c.lazygetAggregateDataJobPool.length>0&&(c.lazygetAggregateDataJobPool=[]),c.registerObservers(),c}return __extends(f,d),Object.defineProperty(f.prototype,"FormMaster",{get:function(){return this.form},enumerable:!0,configurable:!0}),f.prototype.terminateSync=function(){this.lazygetAggregateDataJobPool=[]},f.prototype.release=function(){var a=this;if(this.FormMaster){this.FormMaster.unobserve(this.responseChangeCallback);var b=Nerve.getCollectionMasterFromModel(this.FormMaster.Model.Questions);b.unobserve(this.questionCountChangeCallback),_.forEach(this.FormMaster.Model.Questions,function(b){var c=a.FormMaster.getQuestionById(b.Id);c.unobserve(a.questionContentChangeWithDataSyncCallback),c.unobserve(a.questionContentChangeNoDataSyncCallback)})}},f.prototype.getAggregateData=function(){var b=this;return a.Event.EngagementEventDeprecated.logData({name:this.FormMaster.SyncContext===c.FormSyncContext.AnalysisTimeForm?a.Event.EngagementEventNames.AnalysisPage.Analysis.StartGetResponses:a.Event.EngagementEventNames.DesignPage.Analysis.StartGetResponses,extraData:{RegionNumber:this.FormMaster.Model.ResponsesCount/1e3+1}}),a.Event.NavPerfEventDeprecated.analyzePageStartTime=a.Utilities.DateTime.getTimeStamp(),this.FormMaster.existingOnServerSide().then(function(){return b.serverAggregateAPI(b.FormMaster.Model.Id)}).then(function(a){return b.responsesCache=a,a}).fail(function(b){a.Event.NavPerfEventDeprecated.analyzePageStartTime=null,a.Event.ErrorEventDeprecated.logData({errorName:"ResposnesAggregateFailure",errorInfo:{Message:"FormAggregationMaster.getAggregateData: get aggregate data failed: {0}".format(b)}})})},Object.defineProperty(f.prototype,"serverAggregateAPI",{get:function(){return this.FormMaster.SyncContext==c.FormSyncContext.AnalysisTimeForm?this.FormMaster.Model.Settings.IsQuizMode?c.FormDataSource.getResultSharingAnalysisQuizData:c.FormDataSource.getResultSharingAnalysisSurveyData:this.FormMaster.Model.Settings.IsQuizMode?c.FormDataSource.getAggregateQuizData:c.FormDataSource.getAggregateSurveyData},enumerable:!0,configurable:!0}),f.prototype.aggregate=function(b){var d=this,e=_.find(b,function(a){return"quizSummaryData"===a.aggregationDataType||"summaryData"===a.aggregationDataType});c.getFormSummaryAggregationMaster(this.Model.SummaryAggregation).aggregate(e),_.each(this.Model.QuestionAggregations,function(f){var g=d.FormMaster.getQuestionById(f.QuestionId);if(!g.Model.GroupId){var h=void 0;if(h=g.Model.Type===c.QuestionType.MatrixChoiceGroup?d.reduceMultipleSubQuestionData(g,b):_.find(b,function(a){return a.columnPropertyName===f.QuestionId}),g.Model.Type==c.QuestionType.TextField&&g.Model.IsMathQuiz&&a.Flighting.Flight.isEnabled(a.Flighting.Flights.TextFieldMathAnswers)){h=d.adjustCorrectMathGrading(g,h);var i=e,j=h;j&&(j.quizSummaryData.averageScore/=i.quizSummaryData.count,i.quizSummaryData.averageScore+=j.quizSummaryData.averageScore,d.Model.SummaryAggregation.AverageScore=i.quizSummaryData.averageScore)}c.getQuestionAggregationMaster(f).aggregate(h)}f.IsAggregationReady=!0}),a.Event.NavPerfEventDeprecated.analyzePageStartTime&&(a.Event.NavPerfEventDeprecated.logData({name:this.FormMaster.SyncContext===c.FormSyncContext.AnalysisTimeForm?a.Event.NavPerfEventNames.Scenario.Endpoints.ShareAnalysisPage:a.Event.NavPerfEventNames.Scenario.Endpoints.SurveyAnalyzePage,extraData:{timeToSpin:window.performance.timing.domInteractive-window.performance.timing.navigationStart,timeToChrome:a.Event.NavPerfEventDeprecated.analyzePageTimeToChrome,timeToContentReady:a.Utilities.DateTime.getTimeStamp()-a.Event.NavPerfEventDeprecated.analyzePageStartTime,RegionNumber:this.FormMaster.Model.ResponsesCount/1e3+1}}),a.Event.NavPerfEventDeprecated.analyzePageStartTime=null)},f.prototype.reduceMultipleSubQuestionData=function(a,b){var c=a.SubQuestionMasters.map(function(a){return a.Model.Id}),d=b.filter(function(a){return-1!==c.indexOf(a.columnPropertyName)});return d.length?(d[0].likertChoiceData=[],d.reduce(function(a,b){var c={subQuesionId:b.columnPropertyName,subQuestionData:b.choiceData};return a.likertChoiceData.push(c),a},d[0])):void 0},f.prototype.adjustCorrectMathGrading=function(b,c){var d=new g(b.Model),e=d.getAnswers(),f=c;if(f&&f.quizTextData&&e.length>0&&!b.Model.Multiline){var h=[];f.quizTextData.forEach(function(b){if(b.quizData&&b.quizData.id){var c=a.Utilities.tryParseJson(b.quizData.id),d=null==c.Answer?b.quizData.id:c.Answer;if(h.length>0){var e=_.find(h,function(b){if(b.quizData&&b.quizData.id){var c=a.Utilities.tryParseJson(b.quizData.id),e=null==c.Answer?b.quizData.id:c.Answer;if(d.trim().toUpperCase()===e.trim().toUpperCase())return b}});null!=e?e.quizData.count+=b.quizData.count:h.push(b)}else h.push(b)}}),f.correctCount=0,f.quizSummaryData.averageScore=0;var i=h.filter(function(c){if(c.quizData&&c.quizData.id){var d=a.Utilities.tryParseJson(c.quizData.id),g=null==d.Answer?c.quizData.id:d.Answer;return""===g?(f.totalCount-=c.quizData.count,!1):(null!=_.find(e,function(a){return a.answer.trim().toUpperCase()===g.trim().toUpperCase()})&&(f.correctCount+=c.quizData.count,f.quizSummaryData.averageScore+=c.quizData.count*b.Model.Point),!0)}});f.quizTextData=i}return f},f.prototype.onFormMatrixChangeWithoutDataSync=function(){
var a=this;null!=this.responsesCache&&(this.bulkEdit(function(){a.Model=e(a.form)}),this.aggregate(this.responsesCache))},f.prototype.onFormMatrixChangeWithDataSync=function(){var a=this;this.FormMaster.SyncContext!=c.FormSyncContext.AnalysisTimeForm&&(this.lazygetAggregateDataJobPool.length>0||this.lazygetAggregateDataJobPool.push(this.delayGetAggregateDataJob().then(function(){return a.lazygetAggregateDataJobPool.pop()})))},f.prototype.delayGetAggregateDataJob=function(){var a=this,b=$.Deferred();return window.setTimeout(function(){a.bulkEdit(function(){a.Model=e(a.form)}),a.getAggregateData().then(function(b){return a.aggregate(b)}),b.resolve()},this.freezingTime),b.promise()},f.prototype.registerObservers=function(){var a=this;this.FormMaster.observe(this.responseChangeCallback,[this.FormMaster.Schema.ResponsesCount]);var b=Nerve.getCollectionMasterFromModel(this.FormMaster.Model.Questions);b.observe(this.questionCountChangeCallback),_.forEach(this.FormMaster.Model.Questions,function(b){var d=a.FormMaster.getQuestionById(b.Id);switch(d.observe(a.questionContentChangeNoDataSyncCallback,[c.QuestionMaster.Schema.Title]),d.Model.Type){case c.QuestionType.Choice:d.observe(a.FormMaster.Model.Settings.IsQuizMode?a.questionContentChangeWithDataSyncCallback:a.questionContentChangeNoDataSyncCallback,[c.QuestionMaster.Schema.Choices,c.QuestionMaster.Schema.AllowOtherAnswer,c.QuestionMaster.Schema.ChoiceType]);break;case c.QuestionType.Ranking:d.observe(a.questionContentChangeWithDataSyncCallback,[c.QuestionMaster.Schema.ChoiceGroup])}})},f}(Nerve.createObjectMasterClass("FormAggregation",h));c.FormAggregationMaster=i}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){function d(){return{InsightCount:0,IsReady:!1}}function e(a){return Nerve.getObjectMasterFromModel(a)}var f=Nerve.Spec,g={InsightCount:f.number(),IsReady:f["boolean"]()};c.getDefaultFormInsight=d,c.getFormInsightMaster=e;var h=function(c){function e(a){var b=c.call(this,{InitialData:d()})||this;return b.formMaster=a,b.insights=[],b}return __extends(e,c),Object.defineProperty(e.prototype,"Insights",{get:function(){return this.insights},enumerable:!0,configurable:!0}),e.prototype.loadInsight=function(a){"TimeDistribution"===a?this.getDefaultInsights():this.getInsights()},e.prototype.getInsights=function(){var a=this;this.isInsightCalculationCompleted=!1,this.formMaster.ensureReadyToDesign().done(function(){var c=a.formMaster.Model;a.IntelligenceProvider.getInsights(c.Id,c.ResponsesCount,c.Questions.length).done(function(c){var d=c.filter(function(a){switch(a.Type){case b.Analysis.InsightType.AssociationRuleInsight:case b.Analysis.InsightType.CorrelationInsightCollection:case b.Analysis.InsightType.LikertAssociationRuleInsight:case b.Analysis.InsightType.NPSKeywordsInsight:case b.Analysis.InsightType.PartialOrderInsight:case b.Analysis.InsightType.RatingKeywordsInsight:case b.Analysis.InsightType.ResponseSentimentInsight:case b.Analysis.InsightType.ResponseSentimentInsightCollection:case b.Analysis.InsightType.SummaryDistributionCollection:return!0;default:return!1}});a.bulkEdit(function(){a.insights=a.insights.concat(d),a.Model.InsightCount+=d.length,a.Model.IsReady=!0})}).fail(function(){a.Model.IsReady=!0})})},e.prototype.getDefaultInsights=function(){var c=this;this.isDefaultInsightCalculationCompleted=!1,a.Flighting.Flight.isEnabled(a.Flighting.Flights.SubmitTimeDistributionInsight)&&this.IntelligenceProvider.getDefaultInsights(this.formMaster.Model.Id).done(function(a){var d=[];if(a.responseTimeData){var e=a.responseTimeData,f={Description:null,Type:b.Analysis.InsightType.TimeDistributionInsight,Score:0,TimeDistributions:e.interval.map(function(a){return{MaxDurationSeconds:a.maxDurationSeconds,MinDurationSeconds:a.minDurationSeconds,Count:a.count}}),TotalResponders:e.totalCount};d.push(f)}c.bulkEdit(function(){c.insights=c.insights.concat(d),c.Model.InsightCount+=d.length,c.Model.IsReady=!0})}).fail(function(){c.Model.IsReady=!0})},Object.defineProperty(e.prototype,"IntelligenceProvider",{get:function(){if(!this.intelligenceProvider){var b=a.Utilities.FormId.decodeFormId(this.formMaster.Model.Id),c=b.IsGroupOwner?a.DataProvider.DataProviderType.Group:a.DataProvider.DataProviderType.Personal;this.intelligenceProvider=a.DataProvider.ProviderManager.getInstance().createIntelligenceProvider(c,b.OrgId,b.OwnerId)}return this.intelligenceProvider},enumerable:!0,configurable:!0}),e}(Nerve.createObjectMasterClass("FormInsight",g));c.FormInsightMaster=h}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){function b(a){return Nerve.getObjectMasterFromModel(a)}var c=Nerve.Spec,d={AverageSubmitTime:c.number(),FormStatus:c.enumeration(function(){return a.FormStatusType}),IsAggregationReady:c["boolean"](),TotalResponseCount:c.number(),BranchPoint:c.number(),AverageScore:c.number()};a.getFormSummaryAggregationMaster=b;var e=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.aggregate=function(b){var c=this;this.bulkEdit(function(){a.SummaryAggregateDelegatorBase.getAggregateDelegator(c.FormMaster).aggregate(b,c.Model),c.Model.TotalResponseCount=c.FormMaster.Model.ResponsesCount,c.Model.FormStatus=c.FormMaster.SettingMaster.getFormStatus(),c.Model.IsAggregationReady=!0})},c.prototype.getAggregatePercentage=function(){throw Error("deprecated code. Branching related code should be remove")},Object.defineProperty(c.prototype,"isAverageResultEnabled",{get:function(){var a=0;return _.forEach(this.FormMaster.Model.Questions,function(b){b.IsQuiz&&b.Point&&(a+=b.Point)}),this.FormMaster.Model.QuizQuestionsCount>0&&a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"FormMaster",{get:function(){return this.Parent.FormMaster},enumerable:!0,configurable:!0}),c}(Nerve.createObjectMasterClass("FormSummaryAggregation",d));a.FormSummaryAggregationMaster=e}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){function c(b,c){a.Event.EngagementEventDeprecated.logData({name:b,extraData:c})}var d=Nerve.Spec;b.pagingSize=300,b.logEvent=c;var e={Summary:d.collectionOf(d.reference({},function(a){return a.Id.toString()})),Response:d.reference(),IsIndividualModelReady:d["boolean"]()},f=function(a){function c(b,c){var d=a.call(this,c)||this;return d.formMaster=b,d.Model.IsIndividualModelReady=!1,d}return __extends(c,a),c.prototype.syncData=function(a){var c=this;this.bulkEdit(function(){c.Model.IsIndividualModelReady=!1,c.Model.Response=null});var d=this.formMaster.Model.ResponsesCount,e=a*b.pagingSize;return this.formMaster.syncFormResponsesByPaging(Math.min(d-e,b.pagingSize),e).then(function(){c.bulkEdit(function(){c.Model.Summary=c.formMaster.Model.BufferResponses,c.Model.Response=_.first(c.formMaster.Model.BufferResponses),c.Model.IsIndividualModelReady=!0})})},c.prototype.changeDetailByResponseId=function(a){this.Model.Response=Nerve.Collection.getItemWithKeyFields(this.formMaster.Model.BufferResponses,{Id:a})},c.prototype.deleteResponse=function(a){var b=this;this.Model.IsIndividualModelReady=!1,this.formMaster.deleteBufferResponse(a).then(function(){b.bulkEdit(function(){b.Model.Summary=b.formMaster.Model.BufferResponses,b.Model.Response=b.Model.Summary.length>0?_.first(b.Model.Summary):null,b.Model.IsIndividualModelReady=!0})})},c}(Nerve.createObjectMasterClass("IndividualMaster",e));b.IndividualMaster=f}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a.choiceIdsIndex={},a.likertStatistics={},a}return __extends(c,b),c.getDelegatorName=function(){return"LikertAggregationDelegator"},c.prototype.aggregate=function(a,b){a?(this.initializeDelegator(b),this.aggregateInternal(a,b)):this.setDefaultAggregateToModel(b)},c.prototype.initializeDelegator=function(b){var c=this;this.questionMaster=a.getQuestionAggregationMaster(b).QuestionMaster,this.subQuestions=_.pluck(this.questionMaster.SubQuestionMasters,"Model"),this.choiceGroup=this.questionMaster.Model.ChoiceGroup;var d=[];_.forEach(this.choiceGroup,function(a,b){c.choiceIdsIndex[a.Id]=b,d.push(0)}),_.forEach(this.subQuestions,function(a){c.likertStatistics[a.Id]={Name:a.Title,Statistics:d.slice()}})},c.prototype.aggregateInternal=function(a,b){var c=this,d=a.likertChoiceData;d.forEach(function(a){a.subQuestionData.forEach(function(b){c.likertStatistics[a.subQuesionId].Statistics[c.choiceIdsIndex[b.id]]=b.count})}),b.LikertQuestionAggregation={Options:_.pluck(this.choiceGroup,"Description"),LikertResults:this.getLikertStatistics()}},c.prototype.setDefaultAggregateToModel=function(a){},c.prototype.getLikertStatistics=function(){var a=this;return _.map(this.subQuestions,function(b){return{SubQuestionId:b.Id,SubQuestionName:a.likertStatistics[b.Id].Name,Statistics:a.likertStatistics[b.Id].Statistics}})},c}(a.QuestionAggregateDelegatorBase);a.LikertAggregationDelegatorBase=b}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.aggregate=function(a,b){if(a){var c=this.calculateNPS(a);b.NPSQuestionAggregation={Promoters:c.promoters,Passives:c.passives,Detractors:c.detractors,ResponseCount:a.npsData.count}}else this.setDefaultAggregateToModel(b)},b.prototype.setDefaultAggregateToModel=function(a){a.NPSQuestionAggregation={Promoters:0,Passives:0,Detractors:0,ResponseCount:0}},b.prototype.calculateNPS=function(a){var b=a.npsData.distributed,c={promoters:0+b[9]+b[10],passives:0+b[7]+b[8],detractors:a.npsData.distributed.slice(0,7).reduce(function(a,b){return a+b},0)};return c},b}(a.QuestionAggregateDelegatorBase);a.NPSAggregationDelegator=b,a.registerQuestionDelegatorClass(b,"Question.NPS",a.QuestionClassType.Survey),a.registerQuestionDelegatorClass(b,"Question.NPS",a.QuestionClassType.Quiz)}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.CorrectOptions=[],b.correctCount=0,b.wrongCount=0,b}return __extends(b,a),b.prototype.aggregateInternal=function(b,c){a.prototype.aggregateInternal.call(this,b,c);var d=b.correctCount,e=b.totalCount;c.GradeStatistics={CorrectCount:d,WrongCount:e-d}},b}(a.ChoiceAggregationDelegatorBase);a.QuizChoiceAggregationDelegator=b,a.registerQuestionDelegatorClass(b,"Question.Choice",a.QuestionClassType.Quiz)}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(a.DateAggregationDelegatorBase);a.QuizDateAggregationDelegator=b,a.registerQuestionDelegatorClass(b,"Question.DateTime",a.QuestionClassType.Quiz)}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.aggregateInternal=function(a,b){var c=b.FileUploadQuestionAggregation,d=_.first(a.quizTextData).surveyData;c.ResponseCount=d.count,c.RecentFile=d.recentValues.filter(function(a){return null!=a}).map(function(a){return{Answer:a}})},b}(a.FileUploadAggregationDelegatorBase);a.QuizFileUploadAggregationDelegator=b,a.registerQuestionDelegatorClass(b,"Question.FileUpload",a.QuestionClassType.Quiz)}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(a.LikertAggregationDelegatorBase);a.QuizLikertAggregationDelegator=b,a.registerQuestionDelegatorClass(b,"Question.MatrixChoiceGroup",a.QuestionClassType.Quiz)}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;return a.rankIds=[],a.rankStatistics={},a}return __extends(c,b),c.getDelegatorName=function(){return"RankingAggregationDelegator"},c.prototype.aggregate=function(b,c){b?(this.questionMaster=a.getQuestionAggregationMaster(c).QuestionMaster,this.choiceGroup=this.questionMaster.Model.ChoiceGroup,this.aggregateInternal(b,c)):this.setDefaultAggregateToModel(c)},c.prototype.aggregateInternal=function(a,b){var c=this;b.RankingQuestionAggregation=_.map(this.choiceGroup,function(b){var d=_.find(a.rankingData,function(a){return a.id===b.Id});return d=d||{id:b.Id,rankingCount:[]},{Id:b.Id,Name:b.Description,Statistics:c.getRankerStatistics(d),Weight:c.getRankerWeight(d)}}).sort(function(a,b){return b.Weight-a.Weight})},c.prototype.setDefaultAggregateToModel=function(a){},c}(a.QuestionAggregateDelegatorBase);a.RankingAggregationDelegatorBase=b}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.correctSequences=[],b}return __extends(b,a),b.prototype.aggregateInternal=function(b,c){this.initialDelegator(),a.prototype.aggregateInternal.call(this,b,c);var d=b.correctCount,e=b.totalCount;c.GradeStatistics={CorrectCount:d,WrongCount:e-d}},b.prototype.initialDelegator=function(){var a=this,b=JSON.parse(this.questionMaster.Model.GradingBasis);this.correctSequences=_.map(Array.apply(null,Array(b.length)),Number.prototype.valueOf,0),_.forEach(this.choiceGroup,function(c){return a.correctSequences[b.indexOf(c.Key)]=c.Id})},b.prototype.getRankerStatistics=function(a){var b=this.correctSequences.indexOf(a.id)+1,c=_.find(a.rankingCount,function(a){return a.rank===b}),d=c?c.count:0,e=a.rankingCount.map(function(a){return a.count}).reduce(function(a,b){return a+b},0);return[d,e-d]},b.prototype.getRankerWeight=function(a){return this.correctSequences.indexOf(a.id)},b}(a.RankingAggregationDelegatorBase);a.QuizRankingAggregationDelegator=b,a.registerQuestionDelegatorClass(b,"Question.Ranking",a.QuestionClassType.Quiz)}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.getDelegatorName=function(){return"RatingAggregationDelegator"},b.prototype.aggregate=function(a,b){if(a){var c=b.RatingQuestionAggregation;c.ResponseCount=a.numberData.count,c.AverageRating=a.numberData.average}else this.setDefaultAggregateToModel(b)},b.prototype.setDefaultAggregateToModel=function(a){var b=a.RatingQuestionAggregation;b.ResponseCount=0,b.AverageRating=0},b}(a.QuestionAggregateDelegatorBase);a.RatingAggregationDelegatorBase=b}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(a.RatingAggregationDelegatorBase);a.QuizRatingAggregationDelegator=b,a.registerQuestionDelegatorClass(b,"Question.Rating",a.QuestionClassType.Quiz)}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(){function b(){}return b.getAggregateDelegator=function(c){return c?(b.formMaster=c,c.SettingMaster.Model.IsQuizMode?new a.QuizSummaryAggregateDelegator:new a.SurveySummaryAggregateDelegator):void 0},b}();a.SummaryAggregateDelegatorBase=b}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.aggregate=function(b,c){var d=a.getFormSummaryAggregationMaster(c),e=b.quizSummaryData;d&&d.isAverageResultEnabled?c.AverageScore=e.averageScore:c.AverageSubmitTime=1e3*e.averageSubmitTimeSeconds,c.IsAggregationReady=!0},c}(a.SummaryAggregateDelegatorBase);a.QuizSummaryAggregateDelegator=b}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.getDelegatorName=function(){return"TextAggregationDelegator"},b.prototype.aggregate=function(a,b){a?this.aggregateInternal(a,b):this.setDefaultAggregateToModel(b)},b.prototype.setDefaultAggregateToModel=function(a){},b}(a.QuestionAggregateDelegatorBase);a.TextAggregationDelegatorBase=b}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;return a.otherOptionTag="answer_other",a.autoGradeStatistics={},a.correctCount=0,a.wrongCount=0,a}return __extends(d,c),d.prototype.aggregateInternal=function(a,c){var d=b.getQuestionAggregationMaster(c).QuestionMaster;d.Model.Multiline||!d.hasCorrectAnswers()?this.aggregateSurvey(a,c):this.aggregateQuiz(a,c);var e=a.correctCount,f=a.totalCount;c.GradeStatistics={CorrectCount:e,WrongCount:f-e}},d.prototype.aggregateSurvey=function(b,c){var d=c.TextQuestionAggregation,e=_.first(b.quizTextData).surveyData;d.ResponseCount=e.count,d.TopAnswers=e.recentValues.filter(function(a){return null!=a}).map(function(b){var d;if(c.IsMathQuestion&&"_Other"!=b){var e=a.Utilities.tryParseJson(b);b=null==e.Answer?b:e.Answer,d=e.IsMath}return{Id:void 0,Answer:b,IsMath:d}})},d.prototype.aggregateQuiz=function(b,c){var d=this,e=c.TextQuestionAggregation;e.TextSummary=b.quizTextData.map(function(b){var e,f=b.quizData.id;if(c.IsMathQuestion&&"_Other"!=f){var g=a.Utilities.tryParseJson(f);f=null==g.Answer?f:g.Answer,e=g.IsMath}return{Text:"_Other"==f?d.otherOptionTag:f,Count:b.quizData.count,IsMath:e}}).sort(function(a,b){return b.Text==d.otherOptionTag?-1:b.Count-a.Count})},d}(b.TextAggregationDelegatorBase);b.QuizTextAggregationDelegator=c,b.registerQuestionDelegatorClass(c,"Question.TextField",b.QuestionClassType.Quiz)}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(a.ChoiceAggregationDelegatorBase);a.SurveyChoiceAggregationDelegator=b,a.registerQuestionDelegatorClass(b,"Question.Choice",a.QuestionClassType.Survey)}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(a.DateAggregationDelegatorBase);a.SurveyDateAggregationDelegator=b,a.registerQuestionDelegatorClass(b,"Question.DateTime",a.QuestionClassType.Survey)}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.aggregateInternal=function(a,b){var c=b.FileUploadQuestionAggregation;c.ResponseCount=a.textData.count,c.RecentFile=a.textData.recentValues.filter(function(a){return null!=a}).map(function(a){return{Answer:a}})},b}(a.FileUploadAggregationDelegatorBase);a.SurveyFileUploadAggregationDelegator=b,a.registerQuestionDelegatorClass(b,"Question.FileUpload",a.QuestionClassType.Survey)}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(a.LikertAggregationDelegatorBase);a.SurveyLikertAggregationDelegator=b,a.registerQuestionDelegatorClass(b,"Question.MatrixChoiceGroup",a.QuestionClassType.Survey)}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(b){var c=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.calculateRankerRenct=function(b,c){var d=_.times(c,_.constant(0));return b.forEach(function(b){b.rank>c?a.Event.ErrorEventDeprecated.logData({errorName:"InvalidServerAggregatePayload",errorInfo:"Fatal Error: RankingAggregationDelegatorBase.calculateRankerRenct ranker key shouldn't large than rankers count"}):d[b.rank-1]=b.count}),d},c.prototype.getRankerStatistics=function(a){return this.calculateRankerRenct(a.rankingCount,this.choiceGroup.length)},c.prototype.getRankerWeight=function(a){var b=this.choiceGroup.length;return a.rankingCount.map(function(a){return a.count*(b-a.rank)}).reduce(function(a,b){return a+b},0)},c}(b.RankingAggregationDelegatorBase);b.SurveyRankingAggregationDelegator=c,b.registerQuestionDelegatorClass(c,"Question.Ranking",b.QuestionClassType.Survey)}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(a.RatingAggregationDelegatorBase);a.SurveyRatingAggregationDelegator=b,a.registerQuestionDelegatorClass(b,"Question.Rating",a.QuestionClassType.Survey)}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(c){var d=Nerve.Spec,e=({Answer:d.reference(),QuestionId:d.string(),ResponderName:d.string(),ResponseId:d.number()},{Id:d.string(),GroupId:d.string(),Title:d.string(),Type:d.string()},{Answers:d.collectionOf(d.reference()),Questions:d.collectionOf(d.reference()),TopLevelQuestions:d.collectionOf(d.reference()),PagingSize:d.number(),IsPagingReady:d["boolean"]()}),f=function(d){function e(a,b){var e=d.call(this,b)||this;e.formMaster=a,e.Model.PagingSize=c.pagingSize;var f=[];return _.forEach(a.Model.Questions,function(a){f.push({Id:a.Id,GroupId:a.GroupId,Type:a.Type,Title:a.Title})}),e.Model.Questions=f,e.Model.TopLevelQuestions=_.filter(f,function(a){return!a.GroupId}),e}return __extends(e,d),e.prototype.getQuestionAnswers=function(a){var b=this;return a?_.filter(this.Model.Answers,function(c){return b.hasValidAnswer(a,c)}):[]},e.prototype.getQuestionsAnswers=function(a){var b=[];return _.forEach(this.formMaster.Model.BufferResponses,function(c){var d=!1,e=a.map(function(a){var b=_.find(c.Answers,function(b){return b.QuestionId===a});return b&&b.Answer?(d=!0,b.Answer.displayText):""});d&&b.push({Answer:e,ResponderName:c.ResponderName?c.ResponderName:c.Responder})}),b},e.prototype.hasValidAnswer=function(a,b){return this.getQuestionType(a)!==c.QuestionType.Ranking?null!=a&&b.QuestionId===a&&null!=b.Answer&&""!==b.Answer:b.QuestionId===a&&b.Answer&&!/^\[(("",)*""|)\]$/.test(b.Answer)},e.prototype.getAnswersCount=function(){return this.formMaster.Model.ResponsesCount},e.prototype.getPagingRegion=function(a){return{Start:isNaN(a)?0:a*c.pagingSize+1,End:isNaN(a)?0:Math.min((a+1)*c.pagingSize,this.formMaster.Model.ResponsesCount)}},e.prototype.SyncPreviousPageData=function(){isNaN(this.pagingIndex)||this.syncData(this.pagingIndex-1)},e.prototype.SyncNextPageData=function(){isNaN(this.pagingIndex)||this.syncData(this.pagingIndex+1)},e.prototype.syncData=function(a){var b=this,d=this.formMaster.Model.ResponsesCount,e=a*c.pagingSize;a>=0&&d>e&&(this.pagingIndex=a,this.Model.IsPagingReady=!1,this.formMaster.syncFormResponsesByPaging(Math.min(d-e,c.pagingSize),e).then(function(){if(a==b.pagingIndex){var c=[];_.forEach(b.formMaster.Model.BufferResponses,function(a){_.forEach(a.Answers,function(d){c.push({Answer:b.formatQuestionAnswer(d.QuestionId,d.Answer),QuestionId:d.QuestionId.replace(/-/g,""),ResponderName:a.ResponderName?a.ResponderName:a.Responder,ResponseId:a.Id})})}),b.Model.Answers=c,b.Model.IsPagingReady=!0}}))},e.prototype.getQuestionType=function(a){return this.formMaster.getQuestionById(a).Model.Type},e.prototype.getAnswerColumnCount=function(a){var b=this.formMaster.getQuestionById(a);switch(b.Model.Type){case c.QuestionType.Ranking:return Math.max(1,b.Model.ChoiceGroup.length);case c.QuestionType.MatrixChoiceGroup:return _.filter(this.Model.Questions,function(b){return b.GroupId===a}).length;case c.QuestionType.NPS:return 2;default:return 1}},e.prototype.getFileUploadFolder=function(a){var b=this.formMaster.getQuestionById(a).Model.FileUploadFolderId;if(!b)return $.Deferred().reject(new Error("Folder id is null"));var c=b.split(";").filter(function(a){return""!==a}),d=c[c.length-1];return d?new Forms.DataProvider.FileUploadProcessProvider(this.formMaster.Model.Id).getFileFolder(d):void 0},e.prototype.formatQuestionAnswer=function(d,e){var f=this.formMaster.getQuestionById(d);if(f){if(e&&f.Model.Type===c.QuestionType.DateTime){var g=OfficeFormServerInfo.cultureInfo;return Date.parseDate(e,b.FormLimitation.DateQuestionAnswerFormat,g).toDateShortString(g)}if(e&&f.isNumberType())return a.Utilities.tryParseJson(e);if(f.Model.Type===c.QuestionType.Ranking){var h={};_.forEach(f.Model.ChoiceGroup,function(a){h[a.Id]=a.Description});var i=e?_.sortBy(_.filter(e,function(a){return"undefined"!=typeof h[a.id]}),function(a){return a.answerOrder}):[],j=_.size(h)?_.size(h)-i.length:1,k=_.map(Array.apply(null,Array(j)),String.prototype.valueOf,"");return JSON.stringify(_.map(i,function(a){return h[a.id]}).concat(k))}}return e},e}(Nerve.createObjectMasterClass("ResponsesDetailMaster",e));c.SurveyResponsesDetailMaster=f}(c=b.Model||(b.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.aggregate=function(b,c){var d=(a.getFormSummaryAggregationMaster(c),b.summaryData);c.AverageSubmitTime=1e3*d.averageSubmitTimeSeconds,c.IsAggregationReady=!0},c}(a.SummaryAggregateDelegatorBase);a.SurveySummaryAggregateDelegator=b}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(a){var b;!function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.aggregateInternal=function(a,b){var c=b.TextQuestionAggregation;c.ResponseCount=a.textData.count,c.TopAnswers=a.textData.recentValues.filter(function(a){return null!=a}).map(function(a){return{Id:void 0,Answer:a,IsMath:void 0}})},b}(a.TextAggregationDelegatorBase);a.SurveyTextAggregationDelegator=b,a.registerQuestionDelegatorClass(b,"Question.TextField",a.QuestionClassType.Survey)}(b=a.Model||(a.Model={}))}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(a){return React.createElement(d,a)}b.createImagePicker=c;var d=function(c){function d(){return null!==c&&c.apply(this,arguments)||this}return __extends(d,c),d.prototype.render=function(){return this.createImageButton()},d.prototype.createImageButton=function(){var c=this,d={className:"image-picker-switch-button",onClick:function(){var a=ReactDOM.findDOMNode(c.refs.fileInput);$(a).val(""),$(a).click()},ref:"ImageUploadButton"},e=b.createTextButton({HTMLAttributes:d,ButtonStyle:b.ButtonStyle.LightBackground,Text:this.props.UploadButtonHint}),f=React.DOM.input({type:"file",accept:"image/*",ref:"fileInput",onChange:function(a){return c.onImagePicked(a)},className:"design-question-image-reader"}),g=_.extend({},this.props.HTMLAttributes);return g.className=a.Utilities.Html.combineAttributes(g.className,"design-question-image-picker"),React.DOM.div(g,e,f)},d.prototype.onImagePicked=function(b){var c=b.target.files[0];c&&(a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.MediaPicker.AddImage,extraData:{source:"Local",size:c.size}}),this.props.filePickedCallBack(c))},d}(a.ReactComponent)}(b=a.Control||(a.Control={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){function c(){a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.AppLauncher.RenderShellData}),$("#"+h).removeClass(k),d()}function d(){var a=$("."+i)[0]||$("."+j);a&&a.focus()}function e(b){var d=1e3;"undefined"==typeof O365Shell?setTimeout(function(){e(b)},d,b):(a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.AppLauncher.LoadShellData,extraData:{O365Shell:"O365 JS now available so start rendering shell"}}),O365Shell.SetData($.parseJSON(b)),O365Shell.RenderAsync({launcher:h,switcher:h},c,function(){}))}function f(b,c){var d=0;a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.AppLauncher.GetShellServiceInfo,extraData:{O365Shell:"Getting Shell info needed to get O365 Shell JS and CSS"}});var f=a.DataProvider.ProviderManager.getInstance().createDataProvider(),g=OfficeFormServerInfo.cultureInfo.Name,h=function(b){try{if(b.cssUrl&&b.jsUrl&&b.navBarDataJson){var c=$("<link href='"+b.cssUrl+"' rel='stylesheet' type='text/css' charset='UTF-8' />");$(document.head).append(c);var d=$("<script src='"+b.jsUrl+"' type='text/javascript'></script>");d.ready(function(){return e(b.navBarDataJson)}),$(document.head).append(d)}else a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.AppLauncher.LoadError,extraData:{css:b.cssUrl,js:b.jsUrl,data:b.navBarDataJson}})}catch(f){a.Event.ErrorEventDeprecated.logData({errorName:"ShellServiceGetDataFailure"})}},i=function(e){d++<c?f.getShellServiceInfo(g).done(h).fail(i):(b(),a.Event.ErrorEventDeprecated.logData({errorName:"ShellServiceGetDataFailure",errorInfo:e}))};f.getShellServiceInfo(g).done(h).fail(i)}function g(b,c){var d=0;a.Event.EngagementEventDeprecated.logData({name:a.Event.EngagementEventNames.DesignPage.AppLauncher.GetConsumerShellServiceInfo,extraData:{O365Shell:"Getting Shell info needed to get O365 Consumer Shell JS and CSS"}});var f=a.DataProvider.ProviderManager.getInstance().createDataProvider(),g=OfficeFormServerInfo.cultureInfo.Name,h=function(b){try{for(var c=new Object,d=0;d<b.resourceKeys.length;d++)c[b.resourceKeys[d]]=b.resourceUrls[d];var f=$("<link href='"+c.shellg2coremincss+"' rel='stylesheet' type='text/css' charset='UTF-8' />");$(document.head).append(f),$.getScript(c.msajax,function(){$.getScript(c.shellg2strings,function(){$.getScript(c.shellcoreming2m,function(){$.getScript(c.shellconsumerdata,function(){try{var d={UPN:b.upn,UID:OfficeFormServerInfo.userInfo.PUID,Culture:g,WorkloadId:"OfficeForms",Resources:c},f=ConsumerShellDataGenerator.GetConsumerData(d);e(JSON.stringify(f))}catch(h){a.Event.ErrorEventDeprecated.logData({errorName:"ShellServiceGetDataFailure"})}})})})})}catch(h){a.Event.ErrorEventDeprecated.logData({errorName:"ShellServiceGetDataFailure"})}},i=function(e){d++<c?f.getConsumerShellServiceInfo(g).done(h).fail(i):(b(),a.Event.ErrorEventDeprecated.logData({errorName:"ShellServiceGetDataFailure",errorInfo:e}))};f.getConsumerShellServiceInfo(g).done(h).fail(i)}var h="formLauncher",i="o365cs-nav-appTile",j="swBar",k="SwitcherLoading";b.setFocus=d,b.getShellServiceInfo=f,b.getConsumerShellServiceInfo=g;
}(b=a.O365ShellService||(a.O365ShellService={}))}(OfficeForm||(OfficeForm={}));var OfficeForm;!function(a){var b;!function(b){var c;!function(a){a.SettingsAllowResponderGetAllResponses="Settings.AllowResponderGetAllResponses",a.DisableEditForm="DisableEditForm",a.ResponsePagePollView="ResponsePage.PollView"}(c=b.ExtensionPoints||(b.ExtensionPoints={})),a.Exports.ExtensionPoints=c;var d,e={Poll:[c.SettingsAllowResponderGetAllResponses,c.DisableEditForm,c.ResponsePagePollView],"Teams Poll":[c.DisableEditForm]};!function(c){function d(c,d){var f;if(a.Utilities.Type.isString(c))f=c;else if(c){var g=c;if(g.isFieldReady(b.Model.FormMaster.Schema.OwnerId)&&!g.IsGroupForm&&g.Model.OwnerId!==OfficeFormServerInfo.userInfo.UserId)return!1;f=g.Model.Category}return f?_.contains(e[f],d):!1}c.supportsExtensionPoint=d}(d=b.CategoryExtensionPoints||(b.CategoryExtensionPoints={})),a.Exports.CategoryExtensionPoints=d}(b=a.Form||(a.Form={}))}(OfficeForm||(OfficeForm={}));var OfficeFormGrading;!function(a){var b;!function(b){var c=function(){function c(a){this.wrapped=a}return c.prototype.calculateBranchedResponses=function(){this.branchedQuestionsForAllResponses=c.getBranchedQuestionsForAllResponses(this.wrapped),this.branchedResponses=c.getBranchedResponses(this.wrapped,this.branchedQuestionsForAllResponses)},c.getBranchedResponses=function(a,b){var d=a.Model.Responses,e=_.map(d,function(a){return c.getBranchedResponse(b,a)});return e},c.getBranchedQuestionsForAllResponses=function(a){var c=_.map(a.Model.Responses,function(c){return b.AnalyzeDataHelper.getResponseWithIndexableQuestion(c,a)});return b.AnalyzeDataHelper.getBranchedQuestions(a,c)},c.getBranchedResponse=function(a,b){var d=_.extend(b);return d.Answers=c.getAnswersInBranch(a,d),d},c.getAnswersInBranch=function(a,b){var c=_.findWhere(a,{field_id:b.Id});return _.filter(b.Answers,function(a){return null!=_.findWhere(c.branched_questions,{Id:a.QuestionId})})},c.prototype.addGeneralFeedback=function(b,c,d,e){if(c!==a.Model.Form.NO_CHANGE){var f=a.FormHelper.getResponse(this,b);if(f){var g=f.Feedback!==c;g&&(this.wrapped.setResponseComment(b,c),d(),e())}}},c.prototype.addAnswerFeedbacks=function(b,c,d,e,f,g){var h=this;if(d!==a.Model.Form.NO_CHANGE||e!==a.Model.Form.NO_CHANGE){var i=!1;b.forEach(function(b){var f=a.FormHelper.getAnswer(h,b,c);if(f){var g,j=!1;d===a.Model.Form.NO_CHANGE?g=f.Score:(g=d,g!==f.Score&&(j=!0));var k;e===a.Model.Form.NO_CHANGE?k=f.Feedback:(k=e,k!==f.Feedback&&(j=!0)),j&&(h.wrapped.setAnswerGrading(b,c,g,k),i=!0)}}),i&&(f(),g())}},c.prototype.markAsReleased=function(a){this.wrapped.setReleaseDate(a,new Date)},c.prototype.ensureReadyToGrade=function(){var c=this,d=b.FormMaster.Schema;return this.wrapped.ensureFieldsReady([d.Responses,d.Title,d.Questions,d.Theme]).then(function(){return 0!==c.wrapped.Model.Responses.length&&0!==c.questions.length?$.when().then(a.FunctionHelper.noOp):c.wrapped.syncFormResponses()})},Object.defineProperty(c.prototype,"responses",{get:function(){return this.branchedResponses},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"questions",{get:function(){return b.convertToArray(this.wrapped.Model.Questions)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"title",{get:function(){return this.wrapped.Model.Title},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"id",{get:function(){return this.wrapped.Model.Id},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"wrappedForm",{get:function(){return this.wrapped},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"branchedQuestions",{get:function(){return this.branchedQuestionsForAllResponses},enumerable:!0,configurable:!0}),c}();b.FormAdapter=c}(b=a.Dependencies||(a.Dependencies={}))}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){var b;!function(a){function b(a){return Forms.UX.getInitials(a)}function c(a){var b=OfficeForm.Form.DesignPage.getUxStateMaster();b.startBulkEditMode(),a(b),b.endBulkEditMode()}function d(){return React.DOM.div({className:"analyze-view-placerholder"},OfficeForm.Form.DesignPage.createLoadingPlaceholder({Message:a.Resources.LocalizedStrings.AnalyzeView_Loading}))}function e(a){return OfficeForm.Form.Analysis.createAnalyzeViewMenu(a)}function f(a){return OfficeForm.Control.createFormulaRenderer(a)}function g(a){return OfficeForm.Form.createImageRenderer(a)}function h(a){return OfficeForm.Form.Analysis.createResponsesDetailDialog(a)}function i(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return(c=OfficeForm.Utilities.Html).combineAttributes.apply(c,a);var c}function j(){return OfficeForm.Utilities.Guid.newGuid()}function k(a,b){OfficeForm.Event.EngagementEventDeprecated.logData({name:a,extraData:b})}function l(){return OfficeForm.Utilities.isEdge()}function m(){return OfficeForm.Utilities.isFireFox()}function n(){return OfficeForm.Utilities.isIE()}function o(){return OfficeForm.Utilities.Flight.isIvyChartEnabled()}function p(a){return OfficeForm.Utilities.hashCode(a)}function q(a){return React.createElement(Forms.UX.Renderer.ThemeRender,{ThemeMaster:a})}function r(a,b){return OfficeForm.Form.Model.Question.getChoiceAnswer(a,b)}function s(a){return React.createElement(OfficeForm.Form.Analysis.SurveyIndividualViewContainer,{FormMaster:a})}a.ChoiceType=OfficeForm.Form.Model.ChoiceType,a.FormMaster=OfficeForm.Form.Model.FormMaster,a.QuestionMaster=OfficeForm.Form.Model.QuestionMaster,a.IvyChartType=OfficeForm.Form.Analysis.IvyChartType,a.FontIconControl=OfficeForm.Control.FontIconControl,a.ColorHelper=OfficeForm.ColorHelper,a.ButtonStyle=OfficeForm.Control.ButtonStyle,a.Button=OfficeForm.Control.Button,a.RatingShape=OfficeForm.Form.Model.RatingShape,a.TextFieldType=OfficeForm.Control.TextFieldType,a.GlyphLocation=OfficeForm.Control.GlyphLocation,a.GlyphButtonStyle=OfficeForm.Control.GlyphButtonStyle,a.Flights=OfficeForm.Flighting.Flights,a.ViewMode=OfficeForm.Form.ViewMode,a.TopViewBase=OfficeForm.Form.DesignPage.TopViewBase,a.RatingUtilities=OfficeForm.Control.RatingUtilities,a.ShortTextAutograder=OfficeForm.Form.Model.Question.ShortTextAutograder,a.UserTextRenderMode=OfficeForm.Control.UserTextRenderMode,a.ReactComponent=OfficeForm.ReactComponent,a.Resources=OfficeForm.Form.Resources,a.Flight=OfficeForm.Flighting.Flight,a.FormLimitation=OfficeForm.Form.FormLimitation,a.NonGradingEngagementEventNames=OfficeForm.Event.EngagementEventNames,a.IvyChartHelper=OfficeForm.Form.Analysis.IvyChartHelper,a.AnalyzeHelper=OfficeForm.Form.Analysis.AnalyzeHelper,a.AnalyzeDataHelper=OfficeForm.Form.Analysis.AnalyzeDataHelper,a.QuizView=OfficeForm.Form.Analysis.QuizView,a.QuestionType=OfficeForm.Form.Model.QuestionType,a.JavaScriptLoader=OfficeForm.JavaScriptLoader,a.KeyCode=OfficeForm.KeyCode,a.hasImage=OfficeForm.Form.Model.hasImage,a.convertToArray=OfficeForm.Form.convertToArray;var t=function(){function a(){}return a.createFacePile=function(a){return Forms.UX.createFacePile(a)},a.createNumberRating=function(a){return OfficeForm.Control.createNumberRating(a)},a.createCheckBox=function(a){return OfficeForm.Control.createCheckBox(a)},a.createSelect=function(a){return OfficeForm.Control.createSelect(a)},a.createTextField=function(a){return OfficeForm.Control.createTextField(a)},a.createTextButton=function(a,b){return void 0===b&&(b=function(a){}),a.HTMLAttributes=_.extend({onMouseDown:function(a){a.target.classList.add("mouseDown-active"),b(!0)},onBlur:function(a){a.target.classList.remove("mouseDown-active"),b(!1)}},a.HTMLAttributes),OfficeForm.Control.createTextButton(a)},a.createToggleButton=function(a){return OfficeForm.Control.createToggleButton(a)},a.createButton=function(a){return OfficeForm.Control.createButton(a)},a.createGlyphButton=function(a){return OfficeForm.Control.createGlyphButton(a)},a.createUserTextRenderer=function(a){return OfficeForm.Control.createUserTextRenderer(a)},a.createFontIconControl=function(a){return OfficeForm.Control.createFontIconControl(a)},a.stripSupportedTagsButLeaveDangerousOnes=function(a){return OfficeForm.Control.RichTextUtil.stripSupportedTagsButLeaveDangerousOnes(a)},a}();a.Control=t,a.getInitials=b,a.changeUxState=c,a.createLoadingPlaceholder=d,a.createAnalyzeViewMenu=e,a.createFormulaRenderer=f,a.createImageRenderer=g,a.createResponsesDetailDialog=h,a.combineAttributes=i,a.newGuid=j,a.logEvent=k,a.isEdge=l,a.isFireFox=m,a.isIE=n,a.isIvyChartEnabled=o,a.hashCode=p,a.createThemeRender=q,a.getChoiceAnswer=r,a.createSurveyIndividualViewContainer=s}(b=a.Dependencies||(a.Dependencies={}))}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){var b;!function(a){var b=function(){function a(){}return a.Load="Grading.OnLoad.Success",a.NextUngraded="Grading.NextUngraded.Click",a.DeepLinkToQuestion="Grading.AnalyzeView.DeepLinkToQuestion",a.GradeByPeopleTabClick="Grading.PeopleTab.Click",a.GradeByQuestionTabClick="Grading.QuestionTab.Click",a}();a.General=b;var c=function(){function a(){}return a.Load="Grading.SurveyView.Initial",a}();a.SurveyView=c;var d=function(){function a(){}return a.Exit="Grading.ResultsView.Exit",a.Load="Grading.ResultsView.Initial",a.ReleaseResults="Grading.ResultsView.ReleaseResults",a.ReleaseIndividualResult="Grading.ResultsView.ReleaseIndividualResult",a.PostScoresInfoBar="Grading.ReleaseView.PostScoresInfoBar",a.DeepLinkToStudent="Grading.ResultsView.DeepLinkToStudent",a.LinkToStudentPreview="Grading.ResultsView.LinkToStudentPreview",a}();a.ResultsView=d;var e=function(){function a(){}return a.Load="Grading.PowertoolView.Initial",a.GradeChanged="Grading.PowertoolView.GradeChanged",a.FeedbackChanged="Grading.PowertoolView.FeedbackChanged",a.FeedbackButtonClick="Grading.PowertoolView.FeedbackButtonClick",a.RowDetailsModalOpen="Grading.PowertoolView.RowDetailsModalOpen",a}();a.PowerToolView=e;var f=function(){function a(){}return a.Load="Grading.StudentView.Initial",a.NextPage="Grading.StudentView.NextPage",a.PreviousPage="Grading.StudentView.PreviousPage",a.GotoPage="Grading.StudentView.GotoPage",a.GradeChanged="Grading.StudentView.GradeChanged",a.FeedbackChanged="Grading.StudentView.FeedbackChanged",a.GeneralFeedbackChanged="Grading.StudentView.GeneralFeedbackChanged",a.GeneralFeedbackButtonClick="Grading.StudentView.GeneralFeedbackButtonClick",a.FeedbackButtonClick="Grading.StudentView.FeedbackButtonClick",a.ReleaseResult="Grading.StudentView.ReleaseResult",a.DeleteResponse="Grading.StudentView.DeleteResponse",a.PrintResponse="Grading.StudentView.PrintResponse",a}();a.StudentsView=f;var g=function(){function a(){}return a.Load="Grading.QuestionView.Initial",a.NextPage="Grading.QuestionView.NextPage",a.PreviousPage="Grading.QuestionView.PreviousPage",a.GotoPage="Grading.QuestionView.GotoPage",a.GradeChanged="Grading.QuestionView.GradeChanged",a.FeedbackChanged="Grading.QuestionView.FeedbackChanged",a.FeedbackButtonClick="Grading.QuestionView.FeedbackButtonClick",a.RenderedInPowertool="Grading.QuestionView.RenderedInPowertool",a.RenderedInNonPowertool="Grading.QuestionView.RenderedInNonPowertool",a.PrintResponse="Grading.StudentView.PrintResponse",a}();a.QuestionsView=g}(b=a.Events||(a.Events={}))}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){var b=function(){function a(){}return a.GoBackToReleaseResults="GoBackToReleaseResults",a.GoBackToAnalysis="GoBackToAnalysis",a.ByStudent={View:"Student",Index:0,GoBackToView:a.GoBackToAnalysis},a.ByQuestion={View:"Question",Index:0,GoBackToView:a.GoBackToAnalysis},a}();a.GradingMode=b}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){var b;!function(a){var b=function(){function a(){}return Object.defineProperty(a,"CLEAR_FIELD",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(a,"NO_CHANGE",{get:function(){return void 0},enumerable:!0,configurable:!0}),a}();a.Form=b}(b=a.Model||(a.Model={}))}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){var b;!function(a){function b(a){return null==a.Score}a.isUngraded=b}(b=a.AnswerHelper||(a.AnswerHelper={}))}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){var b=function(){function a(){}return a}();a.AnswerRenderOrderIterator=b}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){var b;!function(a){function b(a){return[].concat.apply([],a)}a.flatten=b}(b=a.ArrayHelper||(a.ArrayHelper={}))}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){var b;!function(b){function c(b){var c=b.responses.map(function(b){return a.Dependencies.convertToArray(b.Answers)}),d=a.ArrayHelper.flatten(c);return d}function d(b,c){var d=b.responses.filter(function(a){return a.Id===c}),e=d.map(function(b){return a.Dependencies.convertToArray(b.Answers)}),f=a.ArrayHelper.flatten(e);return f}function e(a,b){var d=c(a),e=a.wrappedForm.getQuestionById(b).SubQuestionMasters.map(function(a){return a.Model.Id}),f=d.filter(function(a){return a.QuestionId===b||_.contains(e,a.QuestionId)});return f}function f(a,b){var c=e(a,b);return c.filter(function(a){return c[0]&&a.QuestionId===c[0].QuestionId})}function g(a,b){var c=a.questions.filter(function(a){return a.Id===b})[0];return c}function h(a){var b=function(a,b){return a+(b&&b.Score?b.Score:0)};return _.reduce(a,b,0)}function i(a,b){var c=a.responses.filter(function(a){return a.Id===b})[0];return c}function j(b,c,d){var e=i(b,c);if(!e)return void 0;var f=b.wrappedForm.getQuestionById(d),g=f.SubQuestionMasters;if(g.length>0){var h=_.map(g,function(a){return a.Model.Id}),j=_.filter(e.Answers,function(a){return-1!==h.indexOf(a.QuestionId)});return j[j.length-1]}return a.ResponseHelper.getAnswer(e,d)}function k(a){var b=function(a,b){return a+(b&&b.Point?b.Point:0)};return _.reduce(a,b,0)}function l(a,b){var c=d(a,b).map(function(a){return a.QuestionId}),e=a.wrappedForm.FormElementManager.QuestionMasters,f=e.filter(function(a){var b=_.contains(c,a.Model.Id),d=(a.SubQuestionMasters.map(function(a){return a.Model.Id}),a.SubQuestionMasters.length>0&&_.filter(a.SubQuestionMasters,function(a){return _.contains(c,a.Model.Id)}).length>0);return b||d}),g=_.map(f,function(a){return a.Model});return k(g)}function m(a,b){var c=d(a,b),e=h(c);return e}function n(a,b){var c=g(a,b),d=c&&c.Point?c.Point:0,e=f(a,b).length;return d*e}function o(a,b){var c=e(a,b),d=h(c);return d}function p(a){var b=c(a),d=a.questions.filter(function(a){return a.IsQuiz}),e=[];b.forEach(function(a){null!=_.find(d,function(b){return a.QuestionId===b.Id})&&e.push(a)});var f=e.map(function(a){return a.Score});return _.every(f,_.isNumber)}function q(a){return!c(a).every(v)}function r(){return new Date("0001-01-01T00:00:00Z")}function s(a){var b=new Date,c=a.responses.map(function(a){return a.ReleaseDate}).filter(function(a){return!!a});return _.every(c,function(a){return b>=a&&a>r()})}function t(a){var b=a.ReleaseDate;return b&&b<=new Date&&b>r()}function u(a){return a.responses.filter(b.isResponseReleased)}function v(a){return a.IsAutoGraded}b.getAnswersForResponder=d,b.getAnswersForQuestion=e,b.getGradedAnswersForQuestion=f,b.sumAnswerScores=h,b.getResponse=i,b.getAnswer=j,b.sumQuestionScores=k,b.getMaximumScoreForResponder=l,b.getScoreForResponder=m,b.getTotalPossibleScoreForQuestionAcrossGradedAnswers=n,b.getScoreForQuestion=o,b.isFullyGraded=p,b.hasAnyManualGrading=q,b.isFullyReleased=s,b.isResponseReleased=t,b.getReleasedResponses=u,b.isAutoGraded=v}(b=a.FormHelper||(a.FormHelper={}))}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){var b;!function(a){function b(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b]}a.noOp=b}(b=a.FunctionHelper||(a.FunctionHelper={}))}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){var b=function(){function b(){}return b.generatePowertoolRowAggregations=function(c,d){var e=d.Model,f={},g=[],h=0,i=0;c.forEach(function(c){var j=d.SubQuestionMasters,k=j.length?void 0:a.ResponseHelper.getAnswer(c,e.Id),l={Response:c,Answer:k};if(k){h++;var m=b.createAnswerToStudentsMapKey(l);f[m]||(f[m]=[]),f[m].push(l),d.isCorrectAnswer(k.Answer)&&(i++,g.push(m))}});var j=_.object(_.sortBy(_.pairs(f),function(a){var c=a[0],d=a[1],e=_.contains(g,c),f=b.createAnswerToStudentsMapSortValue(d[0],e);return f}));return{answerToStudentsMap:j,totalAnswers:h,totalCorrectAnswers:i}},b.createAnswerToStudentsMapKey=function(a){var c=null!=a.Answer;if(!c)return"";var d=null!=b.normalizeAnswerFormat(a.Answer.Answer)?b.normalizeAnswerFormat(a.Answer.Answer).trim():void 0,e=null!=a.Answer.Score?a.Answer.Score:void 0,f=null!=a.Answer.Feedback?a.Answer.Feedback:void 0;return d+"-"+e+"-"+f},b.createAnswerToStudentsMapSortValue=function(a,c){var d=null!=a.Answer;if(!d)return"";var e,f=b.normalizeAnswerFormat(a.Answer.Answer),g=null!=f?f.trim():void 0;return e=null==g||""===g?"c":c?"a":"b",e+g},b.doesQuestionSupportPowertool=function(b){return b.Type===a.Dependencies.QuestionType.Choice||b.Type===a.Dependencies.QuestionType.DateTime||b.Type===a.Dependencies.QuestionType.Rating||b.Type===a.Dependencies.QuestionType.TextField&&!b.Multiline||b.Type===a.Dependencies.QuestionType.Ranking||b.Type===a.Dependencies.QuestionType.MatrixChoiceGroup||b.Type===a.Dependencies.QuestionType.FileUpload},b.normalizeAnswerFormat=function(a){return _.isString(a)?a:JSON.stringify(_.map(_.sortBy(a,function(a){return a.answerOrder}),function(a){return a.id}))},b}();a.PowertoolViewHelper=b}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){var b=function(){function b(){}return b.generatePowertoolRowAggregations=function(c,d){var e=d.Model,f={},g={};c.forEach(function(c){var h=d.SubQuestionMasters,i=h.length?void 0:a.ResponseHelper.getAnswer(c,e.Id),j={Response:c,Answer:i};if(i){var k=b.createRowAggregationKey(j);f[k]||(f[k]=[]),f[k].push(j),d.isCorrectAnswer(i.Answer)&&(g[k]=!0)}});var h=_.object(_.sortBy(_.pairs(f),function(a){var c=a[0],d=a[1],e=g[c],f=b.createRowSortValue(d[0],e);return f}));return h},b.createRowAggregationKey=function(b){var c=null!=b.Answer;if(!c)return"";var d=a.PowertoolViewHelper.normalizeAnswerFormat(b.Answer.Answer),e=null!=d?d.trim():void 0,f=null!=b.Answer.Score?b.Answer.Score:void 0,g=null!=b.Answer.Feedback?b.Answer.Feedback:void 0;return e+"-"+f+"-"+g},b.createRowSortValue=function(b,c){var d=null!=b.Answer;if(!d)return"";var e,f=a.PowertoolViewHelper.normalizeAnswerFormat(b.Answer.Answer),g=null!=f?f.trim():void 0;return e=c?"1":null!=g&&""!==g?"5":"9",e+g},b.doesQuestionSupportPowertool=function(b){return b.Type===a.Dependencies.QuestionType.Choice||b.Type===a.Dependencies.QuestionType.DateTime||b.Type===a.Dependencies.QuestionType.Rating||b.Type===a.Dependencies.QuestionType.TextField&&!b.Multiline||b.Type===a.Dependencies.QuestionType.Ranking||b.Type===a.Dependencies.QuestionType.MatrixChoiceGroup||b.Type===a.Dependencies.QuestionType.FileUpload},b}();a.PowertoolViewHelperRefresh=b}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){var b;!function(b){function c(b){var c=b.IsMathQuiz&&!!b.ShowSubtitle&&!!b.Subtitle;return c?a.Dependencies.createFormulaRenderer({Formula:b.Subtitle}):null}function d(b){return a.Dependencies.hasImage(b.ImageInfo)}function e(b){var c=b.IsMathOption&&!!b.Description;return c?a.Dependencies.createFormulaRenderer({Formula:b.Description,DisableLinebreaks:!0}):a.Dependencies.Control.createUserTextRenderer({Text:b.Description,RenderMode:a.Dependencies.UserTextRenderMode.RichText})}function f(a,b){return _.find(a.wrappedForm.FormElementManager.QuestionMasters,function(a){return a.Model.Id===b})}function g(b){var c=b.Model,d=_.filter(c.Choices,function(a){return a.IsAnswerKey});if(c.ChoiceType===a.Dependencies.ChoiceType.MultiChoice)return d.length>0?[JSON.stringify(d.map(function(a){return a.Description}))]:null;if(c.ChoiceType===a.Dependencies.ChoiceType.SingleChoice)return d.length>0?[d[0].Description]:null;if(c.Type===a.Dependencies.QuestionType.TextField&&c.IsQuiz&&!c.Multiline){var e=new a.Dependencies.ShortTextAutograder(c),f=_.map(e.getAnswers(),function(b){return a.PowertoolViewHelper.normalizeAnswerFormat(b.answer)});return null!=f?f:null}return null}b.renderFormula=c,b.hasImage=d,b.displayOption=e,b.getQuestionMaster=f,b.getAllPossibleCorrectAnswers=g}(b=a.QuestionHelper||(a.QuestionHelper={}))}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){var b;!function(b){function c(a,b){var c=_.filter(a.Answers,function(a){return a.QuestionId===b})[0];return c?c:void 0}function d(a){return-1===a.Responder.indexOf("@")}function e(a){var b=d(a),c=b?void 0:a.ResponderName,e=b?void 0:a.Responder;return{name:c,email:e}}function f(c){var d=c.map(b.getProfile).map(function(a){return a.email?a.name+" <"+a.email+">":a.name}),e=_.countBy(d,function(a){return a}),f=[];for(var g in e)if(e.hasOwnProperty(g)){var h=e[g],i=h>1?g+" ("+h+")":g;f.push(i)}return f.join(a.Dependencies.Resources.LocalizedStrings.GradingView_MultipleStudents_Separator)}function g(a,c){var d={},e={};return a.filter(function(a){return a.Type===QuestionType.Choice||a.Type===QuestionType.TextField}).forEach(function(a){var f=a.Type;a.IsMathQuiz&&(f+=".Math"),d[f]=d[f]||0,++d[f],_.each(c,function(c){var d=b.getAnswer(c,a.Id);d&&d.IsAutoGraded&&(e[f]=e[f]||0,++e[f])})}),{responderCount:c.length,autogradableQuestionCount:d,autogradedResponsesCount:e}}b.getAnswer=c,b.getProfile=e,b.formatProfiles=f,b.createGradingViewLoadEventData=g}(b=a.ResponseHelper||(a.ResponseHelper={}))}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){var b;!function(a){function b(){var a=document.getElementById("scrollAnchor");a&&a.scrollIntoView()}a.scrollToTop=b}(b=a.ScrollHelper||(a.ScrollHelper={}))}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){var b;!function(a){function b(){if(OfficeForm.Utilities.isMobile()){var a=$(window).width();return 0===a&&(a=document.body.scrollWidth),a/(16/9)}return OfficeForm.Form.FormLimitation.DefaultVideoHeight}a.calcVideoDisplayHeight=b}(b=a.VideoHelper||(a.VideoHelper={}))}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){var b;!function(b){function c(b,c,e,f){var g=b.Model;e=e||[];var h=g.Type,i=_.contains(e,h);if(h===a.Dependencies.QuestionType.Rating&&!i)return g.RatingShape===a.Dependencies.RatingShape.Number?a.createNumberRatingAnswer({answer:c.Answer,maxRating:g.Length,showRatingLabel:g.ShowRatingLabel,leftDescription:g.LeftDescription,rightDescription:g.RightDescription}):a.createStarRatingAnswer({answer:c.Answer,maxRating:g.Length,showRatingLabel:g.ShowRatingLabel,leftDescription:g.LeftDescription,rightDescription:g.RightDescription});if(h===a.Dependencies.QuestionType.Choice&&!i)return a.createChoiceAnswer({question:g,answer:c.Answer});if(h===a.Dependencies.QuestionType.Ranking&&!i)return a.createRankingAnswer({question:g,answer:c.Answer});if(h===a.Dependencies.QuestionType.MatrixChoiceGroup&&!i)return a.createLikertAnswer({question:b,answer:c.Answer});if(h===a.Dependencies.QuestionType.FileUpload){var j=c.Answer.Answer;if(null===j||""===j)return React.createElement("div",{className:"gradingQuestionNoAnswerGiven"},a.Dependencies.Resources.LocalizedStrings.GradingView_NoAnswerGiven_Label);var k=JSON.parse(j),l=Forms.UX.FileUpload.getFileIcon(k[0].name);return React.createElement("div",{className:"gradingQuestionFileName"},l,React.createElement("a",{className:"gradingQuestionFileLink",href:k.link,target:"_blank"},k[0].name))}if(h===a.Dependencies.QuestionType.NPS)return Forms.Grading.createNPSAnswer({Answer:c.Answer,LeftDescription:g.LeftDescription,RightDescription:g.RightDescription});var m=c.CorrectAnswer;if(h===a.Dependencies.QuestionType.TextField&&!g.Multiline){var n=new a.Dependencies.ShortTextAutograder(g),o=n.getAnswers();m=1===o.length?o[0].answer:void 0}var p;if(h===a.Dependencies.QuestionType.TextField&&f&&!g.Multiline&&g.IsQuiz){var n=new a.Dependencies.ShortTextAutograder(g);n.areAnyAnswersDefined()&&(p=b.isCorrectAnswer(a.PowertoolViewHelper.normalizeAnswerFormat(c.Answer.Answer))?"correct":"incorrect")}return g.IsMathQuiz&&c.Answer.IsMathAnswer?React.createElement(Forms.Grading.FormulaAnswer,{formula:c.Answer.Answer,specialCorrectnessStyle:p}):a.createPlainTextAnswer({text:d(a.PowertoolViewHelper.normalizeAnswerFormat(c.Answer.Answer),g),correctText:d(m,g),isChoiceQuestion:h===a.Dependencies.QuestionType.Choice,specialCorrectnessStyle:p})}function d(b,c){if(null==b)return b;var d=a.Dependencies.getChoiceAnswer(String(b),c).SelectedOptions;if(c.Type!==a.Dependencies.QuestionType.Ranking)return d.join(", ");var e=c.ChoiceGroup;if(b&&""!==b){var f=JSON.parse(b),g=f.map(function(a,b){var c=Nerve.Collection.getItemWithKeyFields(e,{Id:a});return c?c.Description:void 0}).filter(function(a){return!!a});return g.join(", ")}}function e(b,c){if(!b)return React.createElement("div",{className:"gradingQuestionNoAnswerGiven"},a.Dependencies.Resources.LocalizedStrings.GradingView_NoAnswerGiven_Label);for(var d=a.Dependencies.getChoiceAnswer(b,c).SelectedOptions,e=d.map(function(a){return _.find(c.Choices,function(b){return b.Description===a+""})}).filter(function(a){return null!=a}),f=[],g=0;g<e.length;g++)f.push(a.QuestionHelper.displayOption(e[g])),g!==e.length-1&&f.push(a.Dependencies.Resources.LocalizedStrings.GradingView_ItemSeparator);return f.every(_.isString)?f.join(""):React.createElement("span",null,f)}b.createAnswer=c,b.convertAnswerToString=d,b.convertAnswerToJsx=e}(b=a.AnswerHelper||(a.AnswerHelper={}))}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){function b(a){return React.createElement(c,__assign({},a))}a.createChoiceAnswer=b;var c=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.render=function(){var b=this.props.answer,c=this.props.question,d=c.Choices&&c.Choices.length>0||null!=b;return d?React.createElement("div",null,a.ChoiceAnswerDisplayHelper.createIndividualAnalyzeViewChoices(c,b.Answer,"gradingChoiceAnswerOption",void 0,"gradingOptionCorrectnessIcon","gradingOptionIsCorrect","gradingOptionIsNotCorrect")):React.createElement("div",null,React.createElement("span",{className:"noChoices"},a.Dependencies.Resources.LocalizedStrings.GradingView_NoChoices_Message))},c}(a.Dependencies.ReactComponent)}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){var b=function(){function b(){}return b.createIndividualAnalyzeViewChoices=function(b,c,d,e,f,g,h){var i=a.Dependencies.newGuid(),j=this.isQuizQuestion(b),k=a.Dependencies.getChoiceAnswer(c,b);k.IsLegacyChoiceAnswer&&e&&a.Dependencies.logEvent(e);var l=k.IsLegacyChoiceAnswer||k.IsSingleChoiceAnswer?"radio":"checkbox",m=_.map(b.Choices,function(b,c){var e,f,m=k.SelectedOptions.some(function(a){return a===b.Description}),n=React.DOM.input({disabled:!0,type:l,name:k.IsSingleChoiceAnswer?i:void 0,checked:m}),o="",p="";if(j){var q=void 0,r=void 0;p=a.Dependencies.Resources.LocalizedStrings.GradingView_IncorrectAnswer_AccessibilityLabel,b.IsAnswerKey?(q="office-form-right-answerkey office-form-answerkey gradingOptionCorrectnessIcon forms-icon-size16x16",r="CheckMark",o=m?g:"",p=a.Dependencies.Resources.LocalizedStrings.GradingView_CorrectAnswer_AccessibilityLabel):m&&(q="office-form-wrong-answerkey office-form-answerkey gradingOptionCorrectnessIcon forms-icon-size16x16",r="Cancel",o=h),f={HTMLAttributes:{className:q,"aria-hidden":!0,role:"presentation"},IconName:r},e=a.Dependencies.Control.createFontIconControl(f)}var s={className:a.Dependencies.combineAttributes(l,d,o),key:c},t=a.QuestionHelper.displayOption(b),u=t+" . "+p;return React.createElement("div",__assign({},s),React.createElement("label",null,n,React.createElement("span",{role:"presentation","aria-hidden":"true"},t)),React.createElement("a",{className:"screenReaderVisible"},u),e)});return m.push.apply(m,this.createIndividualAnalyzeViewMoreChoices(b,k,d,f,h)),m},b.createIndividualAnalyzeViewMoreChoices=function(b,c,d,e,f){var g=this.isQuizQuestion(b),h=a.Dependencies.combineAttributes(c.IsSingleChoiceAnswer?"radio":"checkbox",d,g?f:""),i=React.DOM.input({disabled:!0,type:c.IsSingleChoiceAnswer?"radio":"checkbox",checked:!0}),j=a.Dependencies.Control.createFontIconControl({HTMLAttributes:{className:"office-form-wrong-answerkey office-form-answerkey forms-icon-size14x14"+e},IconName:"Cancel"}),k=g?j:void 0,l=_.map(b.Choices,function(a){return a.Description});return _.difference(c.SelectedOptions,l).map(function(b,c){var d=a.Dependencies.Control.createUserTextRenderer({Text:b,RenderMode:a.Dependencies.UserTextRenderMode.RichText});return React.DOM.div({className:h,key:c+l.length},React.DOM.label({},i,d,k))})},b.isQuizQuestion=function(a){return a.IsQuiz&&_.some(a.Choices,function(a){return a.IsAnswerKey})},b}();a.ChoiceAnswerDisplayHelper=b}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){function b(a){return React.createElement(e,__assign({},a))}function c(b){return a.Dependencies.hashCode(b).toString()}function d(a){return React.createElement(f,__assign({},a))}a.createFeedbackInput=b;var e=function(b){function d(a){var c=b.call(this,a)||this;return c.state={FeedbackValue:a.StoredFeedback,IsExpanded:!!a.StoredFeedback,IsInternetExplorerPageLoaded:!1},c}return __extends(d,b),d.prototype.componentWillReceiveProps=function(a){this.setState(function(b){return{FeedbackValue:a.StoredFeedback,IsExpanded:!!a.StoredFeedback||b.IsExpanded}})},d.prototype.calculateElementIdentifiers=function(){var a,b=this.state.IsExpanded,d="collapse";return b&&(d+=" in"),null!=this.props.Id?a=c(this.props.Id):null!=this.props.ClassName&&(d+=" "+c(this.props.ClassName)),{id:a,className:d}},d.prototype.render=function(){var b=this,c=this.state.FeedbackValue,d=this.calculateElementIdentifiers(),e=d.id,f=d.className,g=a.Dependencies.Resources.LocalizedStrings.GradingView_FeedbackInputPlaceholder_LabelFormat.format(a.Dependencies.FormLimitation.DefaultTextLength),h=_.clone(this.props.HTMLAttributes)||{};h.className=h.className||"feedbackInput";var i=h.onBlur;return h.onBlur=function(c){null!=i&&i(c);var d=b.state.FeedbackValue;null!=d&&d.length>0&&a.Dependencies.logEvent(b.props.FeedbackChangeEvent)},React.createElement("div",{className:f,id:e},a.Dependencies.Control.createTextField({HTMLAttributes:h,TextFieldType:a.Dependencies.TextFieldType.AutoHeightMultiline,Placeholder:g,Value:c,Options:{HTMLPropsForInnerElement:{"aria-label":g}},onValueChange:function(c){if(!b.state.IsInternetExplorerPageLoaded&&a.Dependencies.isIE())return void b.setState({IsInternetExplorerPageLoaded:!0});var d=b.state.IsExpanded;c&&c!==b.state.FeedbackValue&&(d=!0),b.setState({FeedbackValue:c,IsExpanded:d}),b.props.FeedbackUpdate(""===c?a.Model.Form.CLEAR_FIELD:c)}}),React.createElement("div",{className:"textbox-printview none-display"},c))},d}(a.Dependencies.ReactComponent);a.createFeedbackButton=d;var f=function(b){function d(a){var c=b.call(this,a)||this;return c.state={IsExpanded:a.IsExpanded},c}return __extends(d,b),d.prototype.componentDidMount=function(){var a=this,b=this.getFeedbackInputSelector(),c=".gradingViewContainer";$(c).on("shown.bs.collapse",b,function(){$(b+" textarea").focus(),a.changeAriaExpandedState()}),$(c).on("hidden.bs.collapse",b,function(){a.changeAriaExpandedState()})},d.prototype.getFeedbackInputSelector=function(){return null!=this.props.AssociatedFeedbackId?"#"+c(this.props.AssociatedFeedbackId):"."+c(this.props.AssociatedFeedbackClassName)},Object.defineProperty(d.prototype,"isClickable",{get:function(){return!this.state.IsExpanded},enumerable:!0,configurable:!0}),d.prototype.render=function(){var b=this.getFeedbackInputSelector(),d=null!=this.props.AssociatedFeedbackId?c(this.props.AssociatedFeedbackId):null,e=this.props.Label||a.Dependencies.Resources.LocalizedStrings.GradingView_GiveFeedbackButton_Label,f=a.Dependencies.combineAttributes("feedbackToggle",this.isClickable?void 0:"disabled"),g=a.Dependencies.Control.createFontIconControl({
HTMLAttributes:{className:"feedback-icon forms-icon-size16x16","aria-hidden":!0},IconName:"Chat"});return React.createElement("div",__assign({},this.props.HTMLAttributes),React.createElement("a",{href:this.isClickable?b:"javascript:;","data-toggle":this.isClickable?"collapse":void 0,"aria-expanded":this.state.IsExpanded,"aria-controls":d,"aria-disabled":this.isClickable?void 0:!0,disabled:this.isClickable?void 0:!0,title:this.props.Title,onClick:this.onClick.bind(this),className:f},g,this.props.NoLabel===!0?null:e))},d.prototype.guideUserToFeedbackInput=function(){var a=this.getFeedbackInputSelector()+" .form-control",b=$(a);b.addClass("focus"),setTimeout(function(){return b.removeClass("focus")},1e3)},d.prototype.onClick=function(b){this.isClickable||this.guideUserToFeedbackInput(),a.Dependencies.logEvent(this.props.OnClickEventName,{isClickable:this.isClickable})},d.prototype.changeAriaExpandedState=function(){this.setState(function(a,b){return{IsExpanded:!a.IsExpanded}})},d}(a.Dependencies.ReactComponent)}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){function b(a){return React.createElement(c,__assign({},a))}a.createGradeInput=b;var c=function(b){function c(a){var c=b.call(this,a)||this,d=null!=a.CurrentScore;return c.state={Score:d?a.CurrentScore:void 0,ScoreUpdated:!1},c}return __extends(c,b),c.prototype.componentWillReceiveProps=function(a){var b=null!=a.CurrentScore;this.setState({Score:b?a.CurrentScore:void 0})},Object.defineProperty(c.prototype,"TotalPoints",{get:function(){return this.props.TotalPoints||0},enumerable:!0,configurable:!0}),c.prototype.callout=function(){var b=this.state.Score,c=this.TotalPoints;return null==b?React.createElement("div",{className:"gradingNeedsReviewNotification"},a.Dependencies.Resources.LocalizedStrings.GradingView_GradeInputNeedsReview_Label):b>c?React.createElement("div",{className:"gradingExtraCreditNotification"},a.Dependencies.Resources.LocalizedStrings.GradingView_GradeInputExtraCredit_Label):this.props.autoGraded&&!this.state.ScoreUpdated?React.createElement("div",{className:"gradingAutogradedNotification"},a.Dependencies.Resources.LocalizedStrings.GradingView_AutoGraded):void 0},c.prototype.validateInput=function(b){if(""===b)return a.Model.Form.CLEAR_FIELD;var c=Number(b);return!isNaN(c)&&c>=0&&1e9>=c?c:a.Model.Form.NO_CHANGE},c.prototype.render=function(){var b,c=this,d=a.Dependencies.Resources.LocalizedStrings.GradingView_GradeInputPlaceholder_Label,e="undefined"!=typeof this.state.Score&&null!==this.state.Score,f=e?String(this.state.Score):"";b=1===this.TotalPoints?a.Dependencies.Resources.LocalizedStrings.GradingView_GradeInputPoint_Label:a.Dependencies.Resources.LocalizedStrings.GradingView_GradeInputPoints_LabelFormat.format(this.TotalPoints);var g=_.extend({},this.props.HTMLAttributes);return g.className=a.Dependencies.combineAttributes("gradeInputContainer",g.className),React.createElement("div",__assign({},g),React.createElement("div",{className:"gradingGradeInputWrapper"},a.Dependencies.Control.createTextField({HTMLAttributes:{className:"gradingGradeInput","aria-label":this.props.title},Placeholder:d,Value:f,Options:{HTMLPropsForInnerElement:{"aria-label":d}},onValueChange:function(b){var d=c.validateInput(b);d!==a.Model.Form.NO_CHANGE&&(c.setState({Score:d,ScoreUpdated:!0}),c.updateParentScore(d))}}),React.createElement("div",{className:"gradingGradeTotalScore"},"/ ",b)),React.createElement("div",null,this.callout()))},c.prototype.updateParentScore=function(a){var b=this.props.UpdateParentScore;b&&b(a)},c}(a.Dependencies.ReactComponent)}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.render=function(){var b=a.Dependencies.combineAttributes(a.Dependencies.isEdge()?"edge":void 0,a.Dependencies.isIE()?"ie":void 0,a.Dependencies.isFireFox()?"firefox":void 0);return this.createAdditionalTopViewHeaderElements(),React.createElement("div",{className:b},React.createElement("div",__assign({},this.getContainerProps()),this.createHeader.apply(this,this.additionalTopViewHeaderElements),React.createElement("div",{className:"top-view-content"},React.createElement("div",{className:"form-content-container"},React.createElement("div",{className:"office-form-content office-form-page-padding"},React.createElement("div",{className:"office-form office-form-theme-shadow office-form-theme-border-top grading-design-view",id:"scrollAnchor",role:"main"},this.renderView()))))))},c.prototype.createAdditionalTopViewHeaderElements=function(){},c.prototype.includeTheme=function(){return a.Dependencies.createThemeRender(this.props.FormMaster.ThemeMaster)},c.prototype.onBackButtonClick=function(){a.Dependencies.changeUxState(function(b){b.Model.Grading?b.Model.Grading.GoBackToView===a.GradingMode.GoBackToAnalysis?(b.Model.Grading=void 0,b.Model.Analysis=!0):b.Model.Grading.GoBackToView===a.GradingMode.GoBackToReleaseResults&&(b.Model.Grading=void 0,b.Model.TopView="Grading_PostGrades"):b.Model.Analysis=!0})},c}(a.Dependencies.TopViewBase);a.GradingTopViewBase=b}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){function b(a){return React.createElement(c,__assign({},a))}a.createGradingViewNavBar=b;var c=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.createForwardArrow=function(){var b=this,c={onClick:function(a){b.props.nextItemCallback(),$(a.target).focus()},disabled:this.props.indexOfCurrentItem>=this.props.numberOfItems-1,className:"gradingNavBarArrow nextQuestion","aria-label":this.getNextButtonLabel()},d=a.Dependencies.Control.createButton({HTMLAttributes:c,ButtonStyle:a.Dependencies.ButtonStyle.None,children:a.Dependencies.Control.createFontIconControl({HTMLAttributes:{className:"forms-icon-size16x16"},IconName:"ChevronRightMed"})});return React.createElement("div",{className:"gradingNavBarArrowContainer"},d)},c.prototype.createBackArrow=function(){var b=this,c={onClick:function(a){b.props.previousItemCallback(),$(a.target).focus()},disabled:this.props.indexOfCurrentItem<1,className:"gradingNavBarArrow previousQuestion","aria-label":this.getPrevButtonLabel()},d=a.Dependencies.Control.createButton({HTMLAttributes:c,ButtonStyle:a.Dependencies.ButtonStyle.None,children:a.Dependencies.Control.createFontIconControl({HTMLAttributes:{className:"forms-icon-size16x16"},IconName:"ChevronLeftMed"})});return React.createElement("div",{className:"gradingNavBarArrowContainer"},d)},c.prototype.getNextButtonLabel=function(){switch(this.props.gradingMode){case a.GradingMode.ByQuestion:return a.Dependencies.Resources.LocalizedStrings.GradingView_NextQuestion_ButtonLabel;case a.GradingMode.ByStudent:return a.Dependencies.Resources.LocalizedStrings.GradingView_NextStudent_ButtonLabel;default:throw new Error("Unknown grading mode: "+this.props.gradingMode)}},c.prototype.getPrevButtonLabel=function(){switch(this.props.gradingMode){case a.GradingMode.ByQuestion:return a.Dependencies.Resources.LocalizedStrings.GradingView_PreviousQuestion_ButtonLabel;case a.GradingMode.ByStudent:return a.Dependencies.Resources.LocalizedStrings.GradingView_PreviousStudent_ButtonLabel;default:throw new Error("Unknown grading mode: "+this.props.gradingMode)}},c.prototype.createDropdown=function(){var b=this.props.dropdownOptions.map(function(b,c){return b=a.Dependencies.Control.stripSupportedTagsButLeaveDangerousOnes(b),{DisplayName:b,Value:c,Key:c,DisplayContent:React.createElement("span",{title:b},b)}});return a.Dependencies.Control.createSelect({HTMLAttributes:{className:"analyze-view-dropdown-div gradingNavBarDropDown"},SelectOptions:b,Value:this.props.indexOfCurrentItem,onValueChange:this.props.dropdownCallback,AllowWrap:!0})},c.prototype.createProgressIndicator=function(){return this.props.showProgressIndicator!==!0?void 0:React.createElement("span",{className:"progressIndicator"},"(",this.props.progressIndicatorTemplate.format(this.props.indexOfCurrentItem+1,this.props.numberOfItems),")")},c.prototype.createFillTimeBox=function(){if(null==this.props.fillTime)return void 0;var b=a.Dependencies.Resources.LocalizedStrings.Forms_TimeInMinutesAndSeconds_Format.format(this.props.fillTime.minutes<10?"0"+this.props.fillTime.minutes:this.props.fillTime.minutes,this.props.fillTime.seconds<10?"0"+this.props.fillTime.seconds:this.props.fillTime.seconds),c=a.Dependencies.Resources.LocalizedStrings.GradingView_ResponseFillTimeInMinutesAndSeconds_AccessibilityLabel.format(this.props.fillTime.minutes,this.props.fillTime.seconds);return React.createElement("div",{className:"gradingNavBarItem gradingNavBarStudentFillTime"},React.createElement("a",{className:"screenReaderVisible"},c),React.createElement("div",{className:"gradingNavBarItemLabel",role:"presentation","aria-hidden":"true"},a.Dependencies.Resources.LocalizedStrings.GradingView_ResponseFillTime_Format.format(b)))},c.prototype.createStudentScoreBox=function(){function b(b,c,d){return void 0===d&&(d=!1),d?a.Dependencies.Resources.LocalizedStrings.GradingView_NavBar_StudentScore_AccessibilityLabel.format(b,c):a.Dependencies.Resources.LocalizedStrings.GradingView_NavBar_Score_Format.format(b,c)}if(null==this.props.studentScore)return void 0;if(null==this.props.studentScore.pointsEarned&&null==this.props.studentScore.scoreOverride)return void 0;var c,d;return null==this.props.studentScore.scoreOverride?(c=b(this.props.studentScore.pointsEarned,this.props.studentScore.pointsPossible),c=a.Dependencies.Resources.LocalizedStrings.GradingView_NavBar_StudentScore_Format.format(c),d=b(this.props.studentScore.pointsEarned,this.props.studentScore.pointsPossible,!0)):(c=a.Dependencies.Resources.LocalizedStrings.GradingView_NavBar_ScorePercent_Label.format(this.props.studentScore.scoreOverride),d=c),React.createElement("div",{className:"gradingNavBarItem"},React.createElement("a",{className:"screenReaderVisible"},d),React.createElement("div",{className:"gradingNavBarItemLabel",role:"presentation","aria-hidden":"true"},c))},c.prototype.createFeedbackButton=function(){if(!this.props.generalFeedbackProps)return void 0;var b=!!this.props.generalFeedbackProps,c=b?this.props.generalFeedbackProps.ClassName:void 0;return React.createElement("div",{key:c+"-button",className:"gradingNavBarItem"},a.createFeedbackButton(this.props.generalFeedbackButtonProps))},c.prototype.createFeedbackBox=function(){if(!this.props.generalFeedbackProps)return void 0;var b=!!this.props.generalFeedbackProps,c=b?this.props.generalFeedbackProps.ClassName:void 0;return React.createElement("div",{key:c+"-input",className:"gradingNavBarFeedbackInput"},a.createFeedbackInput(this.props.generalFeedbackProps))},c.prototype.createGradingViewMenu=function(){var b=this;if(!this.props.MenuProps)return void 0;var c=_.extend({},this.props.MenuProps);return c.onBeforeDeletedDialogShown=function(){b.disableNavBar(),b.props.MenuProps.onBeforeDeletedDialogShown&&b.props.MenuProps.onBeforeDeletedDialogShown()},c.onDeleteDialogDismissed=function(){b.enableNavBar(),b.props.MenuProps.onDeleteDialogDismissed&&b.props.MenuProps.onDeleteDialogDismissed()},a.Dependencies.createAnalyzeViewMenu(c)},c.prototype.disableNavBar=function(){this.setState({disabled:!0})},c.prototype.enableNavBar=function(){this.setState({disabled:void 0})},c.prototype.createQuestionScoreBox=function(){function b(b,c,d,e){function f(a){var b=Math.round(a);return a===b?b:a.toFixed(1)}void 0===e&&(e=!1);var g=0!==d?f(b/d):0,h=0!==d?f(c/d):0;return e?a.Dependencies.Resources.LocalizedStrings.GradingView_NavBar_QuestionScore_AccessibilityLabel.format(g,h):a.Dependencies.Resources.LocalizedStrings.GradingView_NavBar_Score_Format.format(g,h)}if(null==this.props.questionScore)return void 0;var c=b(this.props.questionScore.pointsEarned,this.props.questionScore.pointsPossible,this.props.questionScore.numQuestions);c=a.Dependencies.Resources.LocalizedStrings.GradingView_NavBar_QuestionScore_Format.format(c);var d=b(this.props.questionScore.pointsEarned,this.props.questionScore.pointsPossible,this.props.questionScore.numQuestions,!0);return React.createElement("div",{className:"gradingNavBarItem"},React.createElement("a",{className:"screenReaderVisible"},d),React.createElement("div",{className:"gradingNavBarItemLabel",role:"presentation","aria-hidden":"true"},c))},c.prototype.render=function(){return React.createElement("div",null,React.createElement("div",{className:"gradingNavBar"},React.createElement("div",{className:"gradingNavBarItemsContainer","aria-disabled":this.state.disabled},React.createElement("div",{className:"gradingNavBarItem gradingNavBarNavigationContainer"},React.createElement("div",{className:"gradingNavBarNavigationComponent"},this.createBackArrow()),React.createElement("div",{className:"gradingNavBarNavigationComponent gradingNavBarDropdownContainer"},this.createProgressIndicator(),this.createDropdown()),React.createElement("div",{className:"gradingNavBarNavigationComponent"},this.createForwardArrow())),this.createFillTimeBox(),this.createStudentScoreBox(),this.createQuestionScoreBox(),this.createFeedbackButton()),this.createGradingViewMenu()),this.createFeedbackBox())},c}(a.Dependencies.ReactComponent)}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){function b(a){return React.createElement(c,__assign({},a))}a.createLikertAnswer=b;var c=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.labelIdPrefix=_.uniqueId("likert_"),b}return __extends(b,a),b.prototype.render=function(){var a=this.createHeaderLine(),b=this.createSubQuestionLine();return React.createElement("table",{className:"office-form-matrix-table",key:"Likert"},a,b)},b.prototype.createHeaderLine=function(){var a=this,b=this.props.question.Model.ChoiceGroup,c=React.createElement("td",{className:"office-form-matrix-ptd",key:"emptyTd"}),d=[];d.push(c);var e={width:80/b.length+"%",className:"office-form-matrix-ptd"},f=_.map(b,function(b,c){e.id=a.getLabelId(c);var d=React.createElement("span",null,b.Description);return React.createElement("td",__assign({},e,{key:c}),d)});d=d.concat(f);var g=React.createElement("tr",{className:"office-form-matrix-ptr"},d);return React.createElement("thead",{className:"office-form-matrix-pthead"},g)},b.prototype.createSubQuestionLine=function(){var a=this,b=this.props.question,c=b.Model.ChoiceGroup,d=b.SubQuestionMasters,e=_.map(d,function(b,d){var e=[],f=React.createElement("span",{className:"office-form-matrix-subquestion"},b.Model.Title),g=React.createElement("td",{className:"office-form-matrix-std",key:"subQuestionTitle"},f);e.push(g);var h=_.map(c,function(b,c){return a.createMatrixRadio(d,c,b.Description)});e=e.concat(h);var i={className:"office-form-matrix-str",key:d};return React.createElement("tr",__assign({},i),e)});return React.createElement("tbody",{className:"office-form-matrix-stbody"},e)},b.prototype.createMatrixRadio=function(a,b,c){var d,e=this.props.question,f=e.Model.ChoiceGroup,g=e.SubQuestionMasters,h=g[a],i=h.Model.Id,j=this.props.answer.Answer,k=_.filter(j,function(a){return a.QuestionId===i}),l=!1;return d=f[b].Id,l=k.length>0&&_.isEqual(k[0].Answer.id,d),React.createElement("td",{className:"office-form-matrix-radio",key:b},React.createElement("label",{className:"office-form-matrix-label"},React.createElement("input",{"aria-labelledby":this.getLabelId(b),"aria-posinset":b+1,"aria-setsize":f.length,type:"radio","aria-checked":l,checked:l})))},b.prototype.getLabelId=function(a){return this.labelIdPrefix+"-col-"+a},b}(a.Dependencies.ReactComponent)}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){function b(a){return React.createElement(c,__assign({},a))}a.createNumberRatingAnswer=b;var c=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.render=function(){var b=this.props,c=!!b.answer.Answer;if(!c)return React.createElement("div",{className:"gradingQuestionNoAnswerGiven"},a.Dependencies.Resources.LocalizedStrings.GradingView_NoAnswerGiven_Label);var d=Number(""+b.answer.Answer),e=_.uniqueId("numberAnswerDesciption."),f=a.Dependencies.Control.createNumberRating({HTMLAttributes:{className:"gradingNumberRatingAnswer rating-"+b.maxRating},Disabled:!0,Value:d,onValueChange:a.FunctionHelper.noOp,Length:b.maxRating,ShowRatingLabel:b.showRatingLabel,LeftDescription:b.leftDescription,RightDescription:b.rightDescription});return React.createElement("div",{"aria-labelledby":e},React.createElement("div",{id:e,className:"screenReaderVisible"},a.Dependencies.Resources.LocalizedStrings.GradingView_RatingAnswer_LabelFormat.format(d,b.maxRating)),React.createElement("div",{"aria-hidden":"true",role:"presentation"},f))},c}(a.Dependencies.ReactComponent)}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){function b(a){return React.createElement(c,__assign({},a))}a.createPlainTextAnswer=b;var c=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.render=function(){var b=this.props.text;if(null==b||""===b)return React.createElement("div",{className:"gradingQuestionNoAnswerGiven"},a.Dependencies.Resources.LocalizedStrings.GradingView_NoAnswerGiven_Label);var c=a.Dependencies.Control.createUserTextRenderer({Text:b,RenderMode:a.Dependencies.UserTextRenderMode.RichText});if(null!=this.props.specialCorrectnessStyle){var d=void 0,e=void 0,f="";"correct"===this.props.specialCorrectnessStyle?(d="gradingOptionIsCorrect",e={HTMLAttributes:{className:"office-form-right-answerkey office-form-answerkey gradingOptionCorrectnessIcon forms-icon-size16x16","aria-hidden":!0,role:"presentation"},IconName:"CheckMark"},f=a.Dependencies.Resources.LocalizedStrings.GradingView_CorrectAnswer_AccessibilityLabel):(d="gradingOptionIsNotCorrect",e={HTMLAttributes:{className:"office-form-wrong-answerkey office-form-answerkey gradingOptionCorrectnessIcon forms-icon-size16x16","aria-hidden":!0,role:"presentation"},IconName:"Cancel"},f=a.Dependencies.Resources.LocalizedStrings.GradingView_IncorrectAnswer_AccessibilityLabel);var g=a.Dependencies.Control.createFontIconControl(e);return React.createElement("div",{className:"gradingPlainTextAnswer gradingShortTextAnswerCorrectnessBox "+d},c,React.createElement("a",{className:"screenReaderVisible"},f),g)}return React.createElement("span",{className:"gradingPlainTextAnswer"},c)},c}(a.Dependencies.ReactComponent)}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){function b(a){return React.createElement(c,__assign({},a))}a.createQuestionAndAnswer=b;var c=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.render=function(){var b,d=!!a.PowertoolViewHelper.normalizeAnswerFormat(this.props.answer.Answer),e=this.props.questionMaster,f=e.Model;b=d?a.AnswerHelper.createAnswer(e,{Answer:this.props.answer},null,!0):React.createElement("div",{className:"gradingQuestionNoAnswerGiven"},a.Dependencies.Resources.LocalizedStrings.GradingView_NoAnswerGiven_Label);var g=a.QuestionHelper.renderFormula(f),h=a.Dependencies.Control.createUserTextRenderer({Text:f.Title,RenderMode:a.Dependencies.UserTextRenderMode.RichText}),i=a.Dependencies.Control.createUserTextRenderer({Text:f.Subtitle,RenderMode:a.Dependencies.UserTextRenderMode.RichText}),j=f.ShowSubtitle&&f.Subtitle&&null==g?React.createElement("div",null,i):null,k=a.QuestionHelper.hasImage(f)?a.Dependencies.createImageRenderer({Image:e.ImageInfoMaster,ImageSettings:e.ImageSettingsMaster,ImageType:"Question"}):null,l=f.VideoInfo&&f.VideoInfo.Url?React.DOM.iframe({src:f.VideoInfo.Url,height:a.VideoHelper.calcVideoDisplayHeight(),width:"100%",frameBorder:"0",allowFullScreen:!0,sandbox:"allow-scripts allow-same-origin allow-popups"}):null;return React.createElement("div",{key:f.Id},React.createElement("div",{className:"gradingQuestionText"},h),j,React.createElement("div",{className:"gradingQuestionImage"},k),l,React.createElement("div",{className:"gradingQuestionFormula"},g),React.createElement("div",{className:"gradingByStudentAnswerContainer gradingAnswerContainer"},b),React.createElement("div",null,c.getShortTextQuestionCorrectAnswerList(this.props)),React.createElement("div",{className:"gradingByStudentIndividualQuestionFeedbackContainer gradingGiveFeedbackLink"},this.props.feedbackButton,this.props.feedbackInput))},c.getShortTextQuestionCorrectAnswerList=function(b){var c=b.questionMaster.Model;if(c.Type!==a.Dependencies.QuestionType.TextField||c.Multiline||!c.IsQuiz||b.questionMaster.isCorrectAnswer(a.PowertoolViewHelper.normalizeAnswerFormat(b.answer.Answer)))return void 0;var d=new a.Dependencies.ShortTextAutograder(b.questionMaster.Model);if(!d.areAnyAnswersDefined())return void 0;var e,f=d.getAnswers();if(f.some(function(a){return a.isMath})){for(var g=[],h=0,i=f;h<i.length;h++){var j=i[h];if(j.isMath){var k=OfficeForm.Control.createFormulaRenderer({Formula:j.answer});g.push(React.createElement("div",{className:"correct-answer-list-formula-element"},k))}else g.push(j.answer);g.push(a.Dependencies.Resources.LocalizedStrings.VariousLocations_ItemList_Separator)}g.pop(),e=React.createElement("div",{className:"correct-answer-list-formula-container"},g)}else e=_.map(f,function(b){return a.PowertoolViewHelper.normalizeAnswerFormat(b.answer)}).join(a.Dependencies.Resources.LocalizedStrings.VariousLocations_ItemList_Separator);return React.createElement("div",{className:"gradingByStudentShortTextCorrectAnswerList various-short-text-correct-answer-list"},React.createElement("b",null,a.Dependencies.Resources.LocalizedStrings.VariousLocations_CorrectAnswerList_Label," "),e)},c}(a.Dependencies.ReactComponent)}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){function b(a){return React.createElement(c,__assign({},a))}a.createRankingAnswer=b;var c=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.render=function(){var b=this,c=_.sortBy(_.filter(this.props.answer.Answer,function(a){return-1!==b.props.question.GradingBasis.indexOf(a.key)}),function(a){return a.answerOrder}),d=this.props.question.ChoiceGroup,e=_.map(c,function(a,c){if(!(d.length<=c)){var e=d[c].Id===a.id,f=Nerve.Collection.getItemWithKeyFields(d,{Id:a.id});return f?b.createResultItem(f.Description,e):void 0}}),f=_.map(d,function(a){return a.Description}),g=!1,h=JSON.parse(this.props.question.GradingBasis),i=c.sort(function(a,b){return a.answerOrder-b.answerOrder}).map(function(a){return a.id}),j=h.map(function(a){return _.findWhere(d,{Key:a}).Id});_.isEqual(i,j)&&(g=!0);var k=f.join(a.Dependencies.Resources.LocalizedStrings.VariousLocations_ItemList_Separator),l=g?void 0:React.createElement("div",{className:"gradingByStudentShortTextCorrectAnswerList various-short-text-correct-answer-list"},React.createElement("b",null,a.Dependencies.Resources.LocalizedStrings.GradingView_CorrectAnswer_AccessibilityLabel,": "),React.createElement("span",null,k));return React.createElement("div",null,React.createElement("div",{className:"gradingByStudentAnswerContainer gradingAnswerContainer"},e),l)},c.prototype.createResultItem=function(b,c){var d="office-form-answerkey gradingOptionCorrectnessIcon forms-icon-size16x16";d=OfficeForm.Utilities.Html.combineAttributes(d,c?"office-form-right-answerkey":"office-form-wrong-answerkey");var e={HTMLAttributes:{className:d},IconName:c?"CheckMark":"Cancel"},f=a.Dependencies.Control.createFontIconControl(e),g="checkbox gradingChoiceAnswerOption",h=c?"gradingOptionIsCorrect":"gradingOptionIsNotCorrect";g=OfficeForm.Utilities.Html.combineAttributes(g,h);var i=React.createElement("span",{className:"inline-display"},b);return React.createElement("div",{className:g},i,f)},c}(a.Dependencies.ReactComponent)}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){function b(a){return React.createElement(c,__assign({},a))}a.createStarRatingAnswer=b;var c=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.getSanitizedNumberOfStars=function(a){var b=a.Answer,c=20;return b>c?c:0>b?0:b},c.prototype.render=function(){var b=this.props,c=!!b.answer.Answer;if(!c)return React.createElement("div",{className:"gradingQuestionNoAnswerGiven"},a.Dependencies.Resources.LocalizedStrings.GradingView_NoAnswerGiven_Label);var d=(a.Dependencies.Resources.LocalizedStrings.Renderer_RatingControlText,this.getSanitizedNumberOfStars(b.answer)),e=_.uniqueId("starAnswerDesciption."),f=OfficeForm.Control.createRating({Disabled:!0,HTMLAttributes:{className:"stars-container",key:"rateit"},Length:b.maxRating,onValueChange:void 0,Value:d,LeftDescription:b.leftDescription,RightDescription:b.rightDescription,LeftDescriptionTitle:"1",RightDescriptionTitle:b.maxRating+"",ShowRatingLabel:b.showRatingLabel,NoTabFocus:!0});return React.createElement("div",{"aria-labelledby":e},React.createElement("div",{id:e,className:"screenReaderVisible"},a.Dependencies.Resources.LocalizedStrings.GradingView_StarAnswerFormat.format(d,b.maxRating)),f)},c}(a.Dependencies.ReactComponent)}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){function b(b){var c=a.ResponseHelper.getProfile(b.response);return a.Dependencies.Control.createFacePile({email:c.email,name:c.name,tooltip:c.email&&-1!==c.email.indexOf("@")?c.name+" <"+c.email+">":c.name,displayText:a.Dependencies.getInitials(c.name)})}function c(b){return a.Dependencies.Control.createFacePile({tooltip:a.ResponseHelper.formatProfiles(b.responses),displayText:"+"+b.responses.length,backgroundColor:{R:233,G:233,B:233},textColor:{R:0,G:0,B:0}})}a.createStudentAvatar=b,a.createStudentAvatarDots=c}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){var b;!function(b){function c(b,c){var d={FormMaster:b,UxState:c,key:"grading-"+b.getInstanceId()};return React.createElement(a.FormGradingViewContainer,__assign({},d))}function d(b){var c={FormMaster:b,key:"grading-release-result-"+b.getInstanceId()};return React.createElement(a.ReleaseResultsView,__assign({},c))}function e(b){var c={Form:new a.Dependencies.FormAdapter(b),FormMaster:b,key:"suvey-result-"+b.getInstanceId()};return React.createElement(a.SurveyResultsTopView,__assign({},c))}b.createFormGradingView=c,b.createFormGradingReleaseResultView=d,b.createFormSurveyResultsTopView=e}(b=a.Public||(a.Public={}))}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){function b(a,b){return[new d(a,b),new e(a,b)]}a.createPowertoolViewAnswerRenderOrderIterators=b;var c=function(b){function c(a,c){var d=b.call(this)||this;return d.nextRowIndex=0,d.answerToStudentsMapEntries=_.pairs(a.answerToStudentsMap),d.shouldRender=c||function(a){return!0},d}return __extends(c,b),c.prototype.hasNext=function(){for(var b=null,c=!1;this.nextRowIndex<this.answerToStudentsMapEntries.length;){b=this.answerToStudentsMapEntries[this.nextRowIndex];var d=b[1],e=d[0].Answer,f=e?a.PowertoolViewHelper.normalizeAnswerFormat(e.Answer):void 0;if(this.shouldRender(f)){c=!0;break}this.nextRowIndex++}return c},c.prototype.next=function(){var a=this.answerToStudentsMapEntries[this.nextRowIndex],b=a[1],c=b[0].Answer,d=this.nextRowIndex;return this.nextRowIndex++,{studentAndAnswers:b,answer:c,answerRenderOrderIndex:d}},c}(a.AnswerRenderOrderIterator);a.PowertoolViewAnswerRenderOrderIterator=c;var d=function(a){function b(b,c){var d=this,e=function(a){return c.isCorrectAnswer(a)};return d=a.call(this,b,e)||this}return __extends(b,a),b}(c);a.PowertoolViewCorrectAnswerRenderOrderIterator=d;var e=function(a){function b(b,c){var d=this,e=function(a){return!c.isCorrectAnswer(a)};return d=a.call(this,b,e)||this}return __extends(b,a),b}(c);a.PowertoolViewIncorrectAnswerRenderOrderIterator=e}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){function b(a,b){return[new d(a,b),new e(a,b)]}a.createPowertoolViewAnswerRenderOrderIteratorsRefresh=b;var c=function(b){function c(a,c){var d=b.call(this)||this;return d.nextRowIndex=0,d.powertoolRowAggregationsEntries=_.pairs(a),d.shouldRender=c||function(a){return!0},d}return __extends(c,b),c.prototype.hasNext=function(){for(var b=null,c=!1;this.nextRowIndex<this.powertoolRowAggregationsEntries.length;){b=this.powertoolRowAggregationsEntries[this.nextRowIndex];var d=b[1],e=d[0].Answer,f=e?a.PowertoolViewHelper.normalizeAnswerFormat(e.Answer):void 0;if(this.shouldRender(f)){c=!0;break}this.nextRowIndex++}return c},c.prototype.next=function(){var a=this.powertoolRowAggregationsEntries[this.nextRowIndex],b=a[1],c=b[0].Answer,d=this.nextRowIndex;return this.nextRowIndex++,{answerAndResponses:b,answer:c,answerRenderOrderIndex:d}},c}(a.AnswerRenderOrderIterator);a.PowertoolViewAnswerRenderOrderIteratorRefresh=c;var d=function(a){function b(b,c){var d=this,e=function(a){return c.isCorrectAnswer(a)};return d=a.call(this,b,e)||this}return __extends(b,a),b}(c);a.PowertoolViewCorrectAnswerRenderOrderIteratorRefresh=d;var e=function(a){function b(b,c){var d=this,e=function(a){return!c.isCorrectAnswer(a)};return d=a.call(this,b,e)||this}return __extends(b,a),b}(c);a.PowertoolViewIncorrectAnswerRenderOrderIteratorRefresh=e}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){var b=function(b){function c(a,c){var d=b.call(this)||this;return d.nextResponseIndex=0,d.form=a,d.questionId=c,d}return __extends(c,b),c.prototype.hasNext=function(){for(var b=null;this.nextResponseIndex<this.form.responses.length;){var c=this.form.responses[this.nextResponseIndex],d=this.form.wrappedForm.getQuestionById(this.questionId).Model;if(b=a.ResponseHelper.getAnswer(c,this.questionId),d.Type===OfficeForm.Form.Model.QuestionType.MatrixChoiceGroup&&(b=""),null!=b)break;this.nextResponseIndex++}return null!=b},c.prototype.next=function(){var b=this.form.responses[this.nextResponseIndex],c=a.ResponseHelper.getAnswer(b,this.questionId),d=this.nextResponseIndex;return this.nextResponseIndex++,{response:b,answer:c,answerRenderOrderIndex:d}},c}(a.AnswerRenderOrderIterator);a.QuestionViewRenderOrderIterator=b}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){var b=function(b){function c(a,c){var d=b.call(this)||this;return d.nextBranchedQuestionIndex=0,d.form=a,d.response=c,d.branchedQuestionsForResponse=_.findWhere(a.branchedQuestions,{field_id:c.Id}).branched_questions.filter(function(a){return!a.GroupId}),d}return __extends(c,b),c.prototype.hasNext=function(){return this.nextBranchedQuestionIndex<this.branchedQuestionsForResponse.length},c.prototype.next=function(){var b,c=this,d=this.branchedQuestionsForResponse[this.nextBranchedQuestionIndex],e=this.nextBranchedQuestionIndex;if(d.Type===OfficeForm.Form.Model.QuestionType.MatrixChoiceGroup){var f=this.form.wrappedForm.getQuestionById(d.Id),g=_.map(f.SubQuestionMasters,function(a){return a.Model.Id}),h=_.filter(_.map(g,function(a){return _.find(c.response.Answers,function(b){return b.QuestionId===a})}),function(a){return!!a});h.length&&(b=_.clone(h[h.length-1]),b.QuestionId=d.Id,b.Answer=h)}else b=a.ResponseHelper.getAnswer(this.response,d.Id);if(this.nextBranchedQuestionIndex++,null!=b){var i=_.filter(this.form.questions,function(a){return!a.GroupId}),j=_.findIndex(i,function(a){return a.Id===d.Id});return{question:d,answerRenderOrderIndex:e,unbranchedQuestionIndex:j,answer:b}}return null},c}(a.AnswerRenderOrderIterator);a.StudentViewRenderOrderIterator=b}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){function b(){var a=$("body");a.addClass("gradingViewContainer");var b=$("#gradingViewPrintChild").appendTo(a),c=$("#content-root");c.hide(),$(".feedbackInput").hide(),$(".textbox-printview.none-display").show(),window.print(),a.removeClass("gradingViewContainer"),b.appendTo($(".gradingViewContainer")),c.show(),$(".textbox-printview.none-display").hide(),$(".feedbackInput").show();
}a.printGradingView=b;var c=function(b){function c(c){var d=b.call(this,c)||this;return d.bookKeepingIndexOfGradeBoxToFocusOnLoad=null,d.bookKeepingShouldScrollToTopOfView=!1,d.bookKeepingStudentTabAccessedByClick=!1,d.bookKeepingQuestionTabAccessedByClick=!1,d.byStudentTabRef=React.createRef(),d.byQuestionTabRef=React.createRef(),d.responseCountChangeCallback=function(){return d.onResponseCountChange()},d.responseListChangeCallback=function(a){return d.onResponseListChange(a)},d.questionListChangeCallback=function(a){return d.onQuestionListChange(a)},d.state={GradingMode:(c.UxState||a.GradingMode.ByStudent).View,isReadyToRender:!1,CurrentIndexForQuestionView:(c.UxState||a.GradingMode.ByStudent).Index,CurrentIndexForStudentView:(c.UxState||a.GradingMode.ByStudent).Index,IndexOfGradeBoxToFocusOnLoad:null,hasUngradedQuestions:!0,lastResponseDeleted:!1,Form:new a.Dependencies.FormAdapter(c.FormMaster),isMounted:!0},d.resetGradeBoxIndexAfterWhichToSearchNextUngraded(),d}return __extends(c,b),c.prototype.resetGradeBoxIndexAfterWhichToSearchNextUngraded=function(){this.bookKeepingGradeBoxIndexAfterWhichToSearchNextUngraded=-1},c.prototype.componentWillMount=function(){var b=this,c=this.state.Form;a.Dependencies.Flight.isEnabled(a.Dependencies.Flights.CoGrading)&&this.registerVariableObservers(),c.ensureReadyToGrade().then(function(){c.calculateBranchedResponses(),b.setState({isReadyToRender:!0,hasUngradedQuestions:null!==b.getNextUngradedQuestion(c)}),a.Dependencies.logEvent(a.Events.General.Load)}).fail(function(b){return a.Dependencies.changeUxState(function(a){return a.Model.CriticalError=b})})},c.prototype.componentDidMount=function(){this.state.isMounted=!0},c.prototype.componentDidUpdate=function(){this.scrollToTopOfViewIfNecessary(),this.focusOnGradeInputForNextUngradedAction(this.bookKeepingIndexOfGradeBoxToFocusOnLoad)},c.prototype.componentWillUnmount=function(){this.state.isMounted=!1,a.Dependencies.Flight.isEnabled(a.Dependencies.Flights.CoGrading)&&this.unregisterVariableObservers()},c.prototype.focusOnGradeInputForNextUngradedAction=function(a){null!==a&&(this.focusOnGradeInput(a),this.bookKeepingIndexOfGradeBoxToFocusOnLoad=null)},c.prototype.scrollToTopOfViewIfNecessary=function(){this.bookKeepingShouldScrollToTopOfView&&($("#body-scrollable-content").scrollTop(0),this.bookKeepingShouldScrollToTopOfView=!1)},c.prototype.focusOnGradeInput=function(a){var b=$(".gradingGradeInput input")[a];b&&b.focus()},c.prototype.renderView=function(){var b=this;if(!this.state.isReadyToRender)return React.createElement("div",{className:"gradingViewContainer"},a.Dependencies.createLoadingPlaceholder());var c=this.state.Form;c.calculateBranchedResponses();var d=c.questions.length,e=c.responses.length;if(!d||!e||this.state.lastResponseDeleted){var f=d?a.Dependencies.Resources.LocalizedStrings.GradingView_NothingToBeGraded_GetAnswers_Message:a.Dependencies.Resources.LocalizedStrings.GradingView_NothingToBeGraded_AddQuestions_Message,g=a.Dependencies.Control.createFontIconControl({HTMLAttributes:{className:"analyze-view-warning-icon forms-icon-size40x40",role:"presentation"},IconName:"Sad"});return React.createElement("div",{className:"analyze-view-detail-noresponses-container gradingViewContainer"},this.includeTheme(),g,React.createElement("div",{className:"analyze-view-detail-noresponse-message"},a.Dependencies.Resources.LocalizedStrings.GradingView_NothingToBeGraded_Message),React.createElement("div",{className:"analyze-view-detail-noresponse-detail"},f))}var h;switch(this.state.GradingMode){case a.GradingMode.ByQuestion.View:var i={Form:this.state.Form,CurrentQuestionIndex:this.state.CurrentIndexForQuestionView,UpdateParentCurrentQuestionIndex:this.updateCurrentQuestionIndex(),UpdateGradeBoxIndexAfterWhichToSearchNextUngraded:function(a){b.bookKeepingGradeBoxIndexAfterWhichToSearchNextUngraded=a},UpdateNextUngradedButtonState:function(){return b.setState({hasUngradedQuestions:null!==b.getNextUngradedQuestion()})}};h=React.createElement(a.QuestionView,__assign({},i));break;case a.GradingMode.ByStudent.View:var j={Form:this.state.Form,CurrentResponderIndex:this.state.CurrentIndexForStudentView,UpdateParentCurrentStudentIndex:this.updateCurrentStudentIndex(),UpdateGradeBoxIndexAfterWhichToSearchNextUngraded:function(a){b.bookKeepingGradeBoxIndexAfterWhichToSearchNextUngraded=a},UpdateNextUngradedButtonState:function(){return b.setState({hasUngradedQuestions:null!==b.getNextUngradedQuestion()})},onDeleteLastResponse:function(){return b.setState({lastResponseDeleted:!0})}};h=React.createElement(a.StudentView,__assign({},j))}var k=this.createGradingModeSwitcher();return React.createElement("div",{className:"gradingViewContainer"},this.includeTheme(),k,React.createElement("div",{id:"gradingViewPrintChild"},h))},c.prototype.createAdditionalTopViewHeaderElements=function(){this.additionalTopViewHeaderElements=[this.createNextUngradedButton()]},c.prototype.registerVariableObservers=function(){var b=this.props.FormMaster;b.observe(this.responseCountChangeCallback,[a.Dependencies.FormMaster.Schema.ResponsesCount]),b.observe(this.responseListChangeCallback,[a.Dependencies.FormMaster.Schema.Responses]),b.observe(this.questionListChangeCallback,[a.Dependencies.FormMaster.Schema.Questions])},c.prototype.unregisterVariableObservers=function(){var a=this.props.FormMaster;a.unobserve(this.responseCountChangeCallback),a.unobserve(this.responseListChangeCallback),a.unobserve(this.questionListChangeCallback)},c.prototype.createGradingModeSwitcher=function(){var b=this,c="gradingGradingModeSwitcherNavBarButton office-form-theme-page-foreground-active",d=this.state.GradingMode===a.GradingMode.ByStudent.View,e=a.Dependencies.combineAttributes(c,this.bookKeepingStudentTabAccessedByClick&&"mouseDown-active",d&&"active"),f={className:e,role:"tab","aria-selected":d,"aria-controls":d?"grading-by-people-panel":null,id:"grading-by-people-tab",tabIndex:d?0:-1,onClick:function(c){a.Dependencies.changeUxState(function(b){var c=b.Model.Grading;b.Model.Grading={View:a.GradingMode.ByStudent.View,Index:0,GoBackToView:c.GoBackToView}}),b.setState({GradingMode:a.GradingMode.ByStudent.View,CurrentIndexForQuestionView:0,CurrentIndexForStudentView:0}),a.Dependencies.logEvent(a.Events.General.GradeByPeopleTabClick)},onKeyDown:function(c){c.keyCode===a.Dependencies.KeyCode.ArrowRight&&b.changeTabItemFocus(c,b.byStudentTabRef,b.byQuestionTabRef)}},g=this.state.GradingMode===a.GradingMode.ByQuestion.View,h=a.Dependencies.combineAttributes(c,this.bookKeepingQuestionTabAccessedByClick&&"mouseDown-active",g&&"active"),i={className:h,role:"tab","aria-selected":g,"aria-controls":g?"grading-by-question-panel":null,id:"grading-by-question-tab",tabIndex:g?0:-1,onClick:function(c){a.Dependencies.changeUxState(function(b){var c=b.Model.Grading;b.Model.Grading={View:a.GradingMode.ByQuestion.View,Index:0,GoBackToView:c.GoBackToView}}),b.setState({GradingMode:a.GradingMode.ByQuestion.View,CurrentIndexForQuestionView:0,CurrentIndexForStudentView:0}),a.Dependencies.logEvent(a.Events.General.GradeByQuestionTabClick)},onKeyDown:function(c){c.keyCode===a.Dependencies.KeyCode.ArrowLeft&&b.changeTabItemFocus(c,b.byQuestionTabRef,b.byStudentTabRef)}},j=a.Dependencies.Control.createTextButton({HTMLAttributes:f,Text:a.Dependencies.Resources.LocalizedStrings.GradingView_StudentMode_ButtonLabel,ref:this.byStudentTabRef},function(a){b.bookKeepingStudentTabAccessedByClick=a}),k=a.Dependencies.Control.createTextButton({HTMLAttributes:i,Text:a.Dependencies.Resources.LocalizedStrings.GradingView_QuestionMode_ButtonLabel,ref:this.byQuestionTabRef},function(a){b.bookKeepingQuestionTabAccessedByClick=a});return React.createElement("div",null,React.createElement("div",{className:"gradingTitle office-form-theme-primary-foreground"},a.Dependencies.Resources.LocalizedStrings.GradingView_Title.format(this.state.Form.title)),React.createElement("div",{className:"gradingGradingModeSwitcherNavBar"},React.createElement("div",{className:"gradingGradingModeSwitcherNavBarModeContainer",role:"tablist"},j,k)))},c.prototype.changeTabItemFocus=function(a,b,c){a.stopPropagation(),a.preventDefault();var d=b.current,e=c.current;e&&(e.focus(),e.setTabIndex(0),d.setTabIndex(-1))},c.prototype.getNextUngradedQuestion=function(b){return b=_.isUndefined(b)?this.state.Form:b,b?this.state.GradingMode===a.GradingMode.ByStudent.View?c.findNextUngradedAnswerForStudentView(b,this.state.CurrentIndexForStudentView,this.bookKeepingGradeBoxIndexAfterWhichToSearchNextUngraded):c.findNextUngradedAnswerForQuestionView(b,this.state.CurrentIndexForQuestionView,this.bookKeepingGradeBoxIndexAfterWhichToSearchNextUngraded):null},c.prototype.navigateToNextUngradedQuestion=function(b){this.state.GradingMode===a.GradingMode.ByStudent.View?this.navigateToNextUngradedAnswerForStudentView(b):this.navigateToNextUngradedAnswerForQuestionView(b)},c.prototype.createNextUngradedButton=function(){var b=this;return this.state.hasUngradedQuestions?a.Dependencies.Control.createTextButton({HTMLAttributes:{className:"gradingTextButton gradingNextUngradedButton office-form-theme-button",onClick:function(){var c=b.getNextUngradedQuestion();b.navigateToNextUngradedQuestion(c),a.Dependencies.logEvent(a.Events.General.NextUngraded)}},ButtonStyle:a.Dependencies.ButtonStyle.LightBackground,Text:a.Dependencies.Resources.LocalizedStrings.GradingView_NextUngraded_ButtonLabel}):a.Dependencies.Control.createTextButton({HTMLAttributes:{className:"gradingTextButton gradingNextUngradedButton office-form-theme-button",disabled:!0},ButtonStyle:a.Dependencies.ButtonStyle.DarkBackGround,Text:a.Dependencies.Resources.LocalizedStrings.GradingView_NextUngraded_ButtonLabel})},c.prototype.navigateToNextUngradedAnswerForStudentView=function(a){null!=a&&(a.ViewElementIndex!==this.state.CurrentIndexForStudentView?(this.bookKeepingIndexOfGradeBoxToFocusOnLoad=a.GradeBoxIndex,this.updateCurrentStudentIndex(!1)(a.ViewElementIndex)):this.focusOnGradeInput(a.GradeBoxIndex))},c.findNextUngradedAnswerForStudentView=function(a,b,d){var e=a.responses.length-1,f=d+1,g=c.findNextUngradedAnswerForStudentViewInInterval(a,b,e,f);return null!==g?g:c.findNextUngradedAnswerForStudentViewInInterval(a,0,b,0)},c.findNextUngradedAnswerForStudentViewInInterval=function(b,d,e,f){for(var g=b.responses,h=d;e>=h;h++){var i=g[h];if(i){var j=h===d?f:0,k=new a.StudentViewRenderOrderIterator(b,i),l=c.findNextUngradedAnswerForStudent(k,j);if(null!==l)return{ViewElementIndex:h,GradeBoxIndex:l}}}return null},c.findNextUngradedAnswerForStudent=function(b,c){for(;b.hasNext();){var d=b.next();if(d){var e=d.answerRenderOrderIndex>=c;if(e&&d.question.IsQuiz&&a.AnswerHelper.isUngraded(d.answer))return d.answerRenderOrderIndex}}return null},c.prototype.navigateToNextUngradedAnswerForQuestionView=function(a){null!=a&&(a.ViewElementIndex!==this.state.CurrentIndexForQuestionView?(this.bookKeepingIndexOfGradeBoxToFocusOnLoad=a.GradeBoxIndex,this.updateCurrentQuestionIndex(!1)(a.ViewElementIndex)):this.focusOnGradeInput(a.GradeBoxIndex))},c.findNextUngradedAnswerForQuestionView=function(a,b,d){var e=a.questions.filter(function(a){return!a.GroupId}),f=e.length-1,g=d+1,h=c.findNextUngradedAnswerForQuestionViewInInterval(a,b,f,g);return null!==h?h:c.findNextUngradedAnswerForQuestionViewInInterval(a,0,b,0)},c.findNextUngradedAnswerForQuestionViewInInterval=function(b,d,e,f){for(var g=_.filter(b.questions,function(a){return!a.GroupId}),h=d;e>=h;h++){var i=g[h],j=a.QuestionHelper.getQuestionMaster(b,i.Id);if(i&&i.IsQuiz){var k=h===d?f:0,l=void 0;if(a.PowertoolViewHelperRefresh.doesQuestionSupportPowertool(i)){var m=a.PowertoolViewHelperRefresh.generatePowertoolRowAggregations(b.responses,j);l=new a.PowertoolViewAnswerRenderOrderIteratorRefresh(m)}else l=new a.QuestionViewRenderOrderIterator(b,i.Id);var n=c.findNextUngradedAnswerForQuestion(l,k);if(null!==n)return{GradeBoxIndex:n,ViewElementIndex:h}}}return null},c.findNextUngradedAnswerForQuestion=function(b,c){for(;b.hasNext();){var d=b.next(),e=d.answerRenderOrderIndex>=c;if(e&&a.AnswerHelper.isUngraded(d.answer))return d.answerRenderOrderIndex}return null},c.prototype.updateCurrentStudentIndex=function(b){var c=this;return void 0===b&&(b=!0),function(d){b&&(c.resetGradeBoxIndexAfterWhichToSearchNextUngraded(),c.bookKeepingShouldScrollToTopOfView=!0),c.setState({CurrentIndexForStudentView:d}),a.Dependencies.changeUxState(function(a){var b=a.Model.Grading;a.Model.Grading={View:c.state.GradingMode,Index:d,GoBackToView:b.GoBackToView}})}},c.prototype.updateCurrentQuestionIndex=function(b){var c=this;return void 0===b&&(b=!0),function(d){b&&(c.resetGradeBoxIndexAfterWhichToSearchNextUngraded(),c.bookKeepingShouldScrollToTopOfView=!0),c.setState({CurrentIndexForQuestionView:d}),a.Dependencies.changeUxState(function(a){var b=a.Model.Grading;a.Model.Grading={View:c.state.GradingMode,Index:d,GoBackToView:b.GoBackToView}})}},c.prototype.onResponseCountChange=function(){var a=this.props.FormMaster;a.Model.ResponsesCount!==a.Model.Responses.length&&a.syncFormResponses()},c.prototype.onResponseListChange=function(b){var c=this,d=this.state.GradingMode===a.GradingMode.ByQuestion.View&&!a.Dependencies.Flight.isEnabled(a.Dependencies.Flights.CoGradingPowertool);if(this.state.isMounted&&!d){var e=new a.Dependencies.FormAdapter(this.props.FormMaster);e.ensureReadyToGrade().then(function(){e.calculateBranchedResponses(),c.setState({isReadyToRender:!0,hasUngradedQuestions:null!==c.getNextUngradedQuestion(e),Form:e}),a.Dependencies.logEvent(a.Events.General.Load)}).fail(function(b){return a.Dependencies.changeUxState(function(a){return a.Model.CriticalError=b})})}},c.prototype.onQuestionListChange=function(b){var c=!_.isEqual(b.NewValues.Questions,b.OldValues.Questions);c&&this.state.isMounted&&this.setState({Form:new a.Dependencies.FormAdapter(this.props.FormMaster)})},c}(a.GradingTopViewBase);a.FormGradingViewContainer=c}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){function b(a){return React.createElement(c,__assign({},a))}a.createPowertoolView=b;var c=function(b){function c(a){var c=b.call(this,a)||this;return c.state={dummyToForceUpdate:{}},c}return __extends(c,b),Object.defineProperty(c.prototype,"maximumNumberOfAvatarsToRenderInRow",{get:function(){return 5},enumerable:!0,configurable:!0}),c.prototype.componentWillMount=function(){a.Dependencies.logEvent(a.Events.PowerToolView.Load)},c.prototype.render=function(){var b=this.props.Form,c=_.filter(b.questions,function(a){return!a.GroupId}),d=c[this.props.CurrentQuestionIndex],e=a.QuestionHelper.getQuestionMaster(b,d.Id),f=a.QuestionHelper.getAllPossibleCorrectAnswers(e),g=a.PowertoolViewHelper.generatePowertoolRowAggregations(b.responses,e),h=a.createPowertoolViewAnswerRenderOrderIterators(g,e),i=h[0],j=h[1];return null!=f&&f.length>0?this.renderQuestionWithCorrectAnswer(i,j,g,f):this.renderQuestionWithoutCorrectAnswer(j)},c.prototype.renderQuestionWithoutCorrectAnswer=function(b){return React.createElement("div",{className:"powerToolQuestion questionWithoutCorrectAnswer"},React.createElement("div",{className:"answersHeader"},a.Dependencies.Resources.LocalizedStrings.GradingView_Responses_Label),this.renderAnswers(b))},c.prototype.renderQuestionWithCorrectAnswer=function(a,b,c,d){return React.createElement("div",{className:"powerToolQuestion"},this.renderCorrectAnswers(a,c,d),this.renderIncorrectAnswers(b,c,d))},c.prototype.renderCorrectAnswers=function(b,c,d){var e=this.renderAnswers(b,d),f=c.totalCorrectAnswers,g=a.Dependencies.Resources.LocalizedStrings.GradingView_PowerToolCorrectAnswer_Label,h=a.Dependencies.Resources.LocalizedStrings.GradingView_PowerToolOutOf_LabelFormat.format(f,c.totalAnswers);return React.createElement("div",{className:"correctAnswerContainer"},React.createElement("div",{className:"correctAnswerHeader gradingOptionIsCorrect"},g," (",h,")",this.createCorrectnessIcon(!0)),f>0?React.createElement("div",{className:"correctAnswersList"},e):React.createElement("div",{className:"gradingQuestionNoAnswerGiven"},a.Dependencies.Resources.LocalizedStrings.GradingView_NoCorrectAnswers))},c.prototype.renderIncorrectAnswers=function(b,c,d){var e=this.renderAnswers(b,d),f=c.totalAnswers-c.totalCorrectAnswers;if(0!==f){var g=a.Dependencies.Resources.LocalizedStrings.GradingView_PowerToolIncorrectAnswers_Label,h=a.Dependencies.Resources.LocalizedStrings.GradingView_PowerToolOutOf_LabelFormat.format(f,c.totalAnswers);return React.createElement("div",{className:"incorrectAnswersContainer"},React.createElement("div",{className:"incorrectAnswersHeader gradingOptionIsNotCorrect"},g," (",h,")",this.createCorrectnessIcon(!1)),React.createElement("div",{className:"incorrectAnswersList"},e))}},c.prototype.createCorrectnessIcon=function(b){var c={HTMLAttributes:{className:"office-form-right-answerkey gradingOptionCorrectnessIcon","aria-hidden":!0,role:"presentation"},IconName:b?"CheckMark":"Cancel"};return a.Dependencies.Control.createFontIconControl(c)},c.prototype.renderStudents=function(b){b=_.sortBy(b,"Name");var c;if(b.length<=this.maximumNumberOfAvatarsToRenderInRow)c=b.map(this.renderStudent);else{var d=b.slice(0,this.maximumNumberOfAvatarsToRenderInRow-1),e=b.slice(this.maximumNumberOfAvatarsToRenderInRow-1);c=d.map(this.renderStudent),c.push(React.createElement("span",{key:"extraStudents"},a.createStudentAvatarDots({responses:e.map(function(a){return a.Response})})))}return React.createElement("span",{"aria-label":a.ResponseHelper.formatProfiles(b.map(function(a){return a.Response}))},c)},c.prototype.renderStudent=function(b,c){return React.createElement("span",{key:c,role:"presentation","aria-hidden":"true"},a.createStudentAvatar({response:b.Response}))},c.prototype.renderAnswers=function(b,c){for(var d=this,e=this.props.CurrentQuestionIndex,f=this.props.Form.questions[e],g=a.QuestionHelper.getQuestionMaster(this.props.Form,f.Id),h=[],i=function(){var i=b.next(),k=i.studentAndAnswers,l=a.ResponseHelper.formatProfiles(k.map(function(a){return a.Response})),m=k[0]?k[0].Answer:void 0,n=m?a.PowertoolViewHelper.normalizeAnswerFormat(m.Answer):void 0,o=f.IsMathQuiz&&f.Type!==a.Dependencies.QuestionType.TextField?a.AnswerHelper.convertAnswerToJsx(n,f):a.AnswerHelper.createAnswer(g,{Answer:m,CorrectAnswer:c},[a.Dependencies.QuestionType.Choice,a.Dependencies.QuestionType.Ranking,a.Dependencies.QuestionType.MatrixChoiceGroup]),p=_.uniqueId(),q="answerFeedback-"+p,r=a.Dependencies.Resources.LocalizedStrings.GradingView_Feedback_ButtonTextFormat.format(l,e+1),s=a.Dependencies.Resources.LocalizedStrings.GradingView_Grade_ButtonTextFormat.format(l,e+1);h.push(React.createElement("div",{className:"answerAndFeedbackBoxContainer",key:p},React.createElement("div",{className:"answer"},React.createElement("div",{className:"powerToolStudentsGivingSameAnswer"},j.renderStudents(k)),React.createElement("div",{className:"powerToolSameAnswer gradingAnswerContainer"},o),React.createElement("div",{className:"powerToolAnswerSecondRow"},React.createElement("div",{className:"powerToolSameGrade",key:f.Id+p},a.createGradeInput({TotalPoints:f.Point,CurrentScore:m.Score,UpdateParentScore:j.onGradeChange(k,f),HTMLAttributes:{hidden:!f.IsQuiz,onBlur:j.onGradeInputBlurOut.bind(j),onFocus:function(){return d.props.UpdateGradeBoxIndexAfterWhichToSearchNextUngraded(i.answerRenderOrderIndex)}},title:s,autoGraded:a.FormHelper.isAutoGraded(m)})),React.createElement("div",{className:"powerToolSameFeedbackButton"},a.createFeedbackButton({IsExpanded:!!m.Feedback,AssociatedFeedbackId:q,Title:r,NoLabel:!0,OnClickEventName:a.Events.PowerToolView.FeedbackButtonClick})))),React.createElement("div",null,a.createFeedbackInput({HTMLAttributes:{onBlur:j.onFeedbackInputBlurOut.bind(j)},Id:q,FeedbackUpdate:j.onFeedbackUpdate(k,f),StoredFeedback:m.Feedback,FeedbackChangeEvent:a.Events.PowerToolView.FeedbackChanged}))))},j=this;b.hasNext();)i();return h},c.prototype.onFeedbackUpdate=function(b,c){var d=this;return function(e){var f=d.props.Form,g=void 0,h=b.map(function(a){return a.Response.Id}),i=a.FunctionHelper.noOp,j=a.FunctionHelper.noOp;f.addAnswerFeedbacks(h,c.Id,g,e,j,i)}},c.prototype.onGradeChange=function(b,c){var d=this;return function(e){var f=void 0,g=d.props.Form,h=b.map(function(a){return a.Response.Id}),i=a.FunctionHelper.noOp,j=function(){return a.Dependencies.logEvent(a.Events.PowerToolView.GradeChanged,{isFormFullyGraded:a.FormHelper.isFullyGraded(g)})};g.addAnswerFeedbacks(h,c.Id,e,f,j,i)}},c.prototype.onGradeInputBlurOut=function(){this.mergeRows(),this.props.OnGradeChange()},c.prototype.onFeedbackInputBlurOut=function(){this.mergeRows()},c.prototype.mergeRows=function(){this.props.Form.calculateBranchedResponses(),this.setState({dummyToForceUpdate:{}})},c}(a.Dependencies.ReactComponent);a.PowertoolView=c}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){function b(a){return React.createElement(c,__assign({},a))}a.createPowertoolViewRefresh=b;var c=function(b){function c(a){var c=b.call(this,a)||this;return c.state={dummyToForceUpdate:{},ResponseIdsForDetailsModal:[],AnalyzeViewData:null,DataTablesLibraryLoaded:!1},c}return __extends(c,b),c.prototype.componentWillMount=function(){var b=this,c=this.props.Form.questions,d=this.props.Form.responses,e=a.ResponseHelper.createGradingViewLoadEventData(c,d);a.Dependencies.logEvent(a.Events.PowerToolView.Load,e),a.Dependencies.JavaScriptLoader.loadJavaScript("DataTables").done(function(){return b.setState({DataTablesLibraryLoaded:!0})})},c.prototype.render=function(){var b=this.props.Form,c=_.filter(b.questions,function(a){return!a.GroupId}),d=c[this.props.CurrentQuestionIndex],e=a.QuestionHelper.getQuestionMaster(b,d.Id),f=a.PowertoolViewHelperRefresh.generatePowertoolRowAggregations(b.responses,e),g=a.createPowertoolViewAnswerRenderOrderIteratorsRefresh(f,e),h=g[0],i=g[1],j=a.Dependencies.AnalyzeHelper.isQuizQuestion(d);return React.createElement("div",{className:"gradingPowertoolContainer"},this.renderAnswers(h,j,!0),this.renderAnswers(i,j,!1),this.createDetailsModal(d.Id))},c.prototype.renderAnswers=function(b,d,e){for(var f=this,g=this.props.CurrentQuestionIndex,h=this.props.Form.questions[g],i=a.QuestionHelper.getQuestionMaster(this.props.Form,h.Id),j=this.props.CurrentQuestionIndex+1,k=[],l=function(){var l=b.next(),n=l.answerAndResponses,o=a.ResponseHelper.formatProfiles(n.map(function(a){return a.Response})),p=n[0].Answer,q=null!=p?a.PowertoolViewHelper.normalizeAnswerFormat(p.Answer):void 0,r=h.IsMathQuiz&&h.Type!==a.Dependencies.QuestionType.TextField?a.AnswerHelper.convertAnswerToJsx(q,h):a.AnswerHelper.createAnswer(i,{Answer:p},[a.Dependencies.QuestionType.Choice,a.Dependencies.QuestionType.Ranking,a.Dependencies.QuestionType.MatrixChoiceGroup]),s=g+"_"+l.answerRenderOrderIndex,t="answerFeedback-"+s,u=a.Dependencies.Resources.LocalizedStrings.GradingView_Feedback_ButtonTextFormat.format(o,j),v=a.Dependencies.Resources.LocalizedStrings.GradingView_Grade_ButtonTextFormat.format(o,j),w=c.getResponsesCountText(n.length),x=n.map(function(a){return a.Response.Id}),y=c.getCorrectnessIcon(d,e),z=e?"gradingPowertoolCorrectAnswer":"gradingPowertoolIncorrectAnswer";k.push(React.createElement("div",{className:"gradingPowertoolAnswerAndFeedbackBoxContainer",key:s},React.createElement("div",{className:"gradingPowertoolAnswerContainer"},y,React.createElement("div",{className:"gradingPowertoolAnswer gradingAnswerContainer "+z},r),React.createElement("div",{className:"gradingPowertoolAnswerSecondRow"},React.createElement("div",{className:"gradingPowertoolResponseCountContainer"},React.createElement("a",{href:"javascript:;",onClick:function(){return f.onResponsesCountLinkClick(x)},className:"office-form-theme-primary-foreground"},w)),React.createElement("div",{className:"gradingPowertoolGradeInputContainer",key:h.Id+s},a.createGradeInput({TotalPoints:h.Point,CurrentScore:p.Score,UpdateParentScore:m.onGradeChange(n,h),HTMLAttributes:{hidden:!h.IsQuiz,onBlur:m.onGradeInputBlurOut.bind(m),onFocus:function(){return f.props.UpdateGradeBoxIndexAfterWhichToSearchNextUngraded(l.answerRenderOrderIndex)}},title:v,autoGraded:a.FormHelper.isAutoGraded(p)})),React.createElement("div",{className:"gradingPowertoolFeedbackButtonContainer"},a.createFeedbackButton({IsExpanded:!!p.Feedback,AssociatedFeedbackId:t,Title:u,NoLabel:!0,OnClickEventName:a.Events.PowerToolView.FeedbackButtonClick})))),React.createElement("div",{className:"gradingPowertoolFeedbackInputContainer"},a.createFeedbackInput({HTMLAttributes:{onBlur:m.onFeedbackInputBlurOut.bind(m)},Id:t,FeedbackUpdate:m.onFeedbackUpdate(n,h),StoredFeedback:p.Feedback,FeedbackChangeEvent:a.Events.PowerToolView.FeedbackChanged}))))},m=this;b.hasNext();)l();return k},c.getCorrectnessIcon=function(b,c){if(!b)return void 0;var d,e;return c?(d="forms-icon-size16x16 office-form-right-answerkey",e=a.Dependencies.Resources.LocalizedStrings.GradingView_CorrectAnswer_AccessibilityLabel):(d="forms-icon-size16x16 office-form-wrong-answerkey",e=a.Dependencies.Resources.LocalizedStrings.GradingView_IncorrectAnswer_AccessibilityLabel),React.createElement("span",{className:"gradingPowertoolCorrectnessIcon"},React.createElement(OfficeForm.Control.FontIconControl,{HTMLAttributes:{className:d},IconName:c?"CheckMark":"Cancel"}),React.createElement("a",{className:"screenReaderVisible"},e),React.createElement("span",{"aria-hidden":"true",role:"presentation"}))},c.getResponsesCountText=function(b){return 1===b?a.Dependencies.Resources.LocalizedStrings.GradingView_PowertoolAnswerResponseCount_Label_Singular:a.Dependencies.Resources.LocalizedStrings.GradingView_PowertoolAnswerResponseCount_Label.format(b)},c.prototype.onResponsesCountLinkClick=function(b){var c=this;a.Dependencies.logEvent(a.Events.PowerToolView.RowDetailsModalOpen),this.setState({ResponseIdsForDetailsModal:b}),a.Dependencies.AnalyzeDataHelper.createAnalyzeViewData(this.props.Form.wrappedForm).then(function(a){c.setState({AnalyzeViewData:a})}).fail(function(b){return a.Dependencies.changeUxState(function(a){return a.Model.CriticalError=b})})},c.prototype.createDetailsModal=function(b){var c=this,d=this.state;return null!=d.ResponseIdsForDetailsModal&&null!=d.AnalyzeViewData&&d.DataTablesLibraryLoaded?a.Dependencies.createResponsesDetailDialog({QuestionId:"field_"+b,AnalyzeViewData:d.AnalyzeViewData,closeSelf:function(){c.setState({ResponseIdsForDetailsModal:null})},goToNextModalCallback:null,goToPreviousModalCallback:null,ShouldIncludeInvalidAnswers:!0,filterResponses:function(a){return _.contains(d.ResponseIdsForDetailsModal,a.field_id)}}):void 0},c.prototype.onFeedbackUpdate=function(b,c){var d=this;return function(e){var f=d.props.Form,g=void 0,h=b.map(function(a){return a.Response.Id}),i=a.FunctionHelper.noOp,j=a.FunctionHelper.noOp;f.addAnswerFeedbacks(h,c.Id,g,e,j,i)}},c.prototype.onGradeChange=function(b,c){var d=this;return function(e){var f=void 0,g=d.props.Form,h=b.map(function(a){return a.Response.Id}),i=a.FunctionHelper.noOp,j=function(){return a.Dependencies.logEvent(a.Events.PowerToolView.GradeChanged,{isFormFullyGraded:a.FormHelper.isFullyGraded(g),isGradedAnswer:b[0].Answer.IsAutoGraded,isMathQuestion:c.IsMathQuiz,responsesChanged:b.length,questionType:c.Type,questionId:c.Id})};g.addAnswerFeedbacks(h,c.Id,e,f,j,i)}},c.prototype.onGradeInputBlurOut=function(){this.mergeRows(),this.props.OnGradeChange()},c.prototype.onFeedbackInputBlurOut=function(){this.mergeRows()},c.prototype.mergeRows=function(){this.props.Form.calculateBranchedResponses(),this.setState({dummyToForceUpdate:{}})},c}(a.Dependencies.ReactComponent);a.PowertoolViewRefresh=c}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){var b=function(b){function c(a){var d=b.call(this,a)||this,e=a.Form.questions[a.CurrentQuestionIndex].Id;return d.state={score:c.createNavBarAverageScore(a.Form,e)},d}return __extends(c,b),c.prototype.componentWillMount=function(){a.Dependencies.logEvent(a.Events.QuestionsView.Load)},c.prototype.componentDidMount=function(){a.ScrollHelper.scrollToTop()},c.prototype.render=function(){var b=this.props.Form.questions.filter(function(a){return!a.GroupId}),c=this.props.CurrentQuestionIndex,d=b[c],e=a.QuestionHelper.getQuestionMaster(this.props.Form,d.Id),f={className:"gradingByQuestion",id:"grading-by-question-panel",role:"tabpanel","aria-labelledby":"grading-by-question-tab","aria-expanded":!0};return React.createElement("div",__assign({},f),this.createGradingByQuestionNavBar(),this.renderQuestion(e),this.renderResponses(e))},c.prototype.renderResponses=function(b){var d=this,e=b.Model,f=this.getAllResponsesForGivenQuestionId(e.Id);if(!f.length)return React.createElement("div",{className:"gradingQuestionNoAnswerGiven"},a.Dependencies.Resources.LocalizedStrings.GradingView_NoOneAnswered_Label);if(e.Type===a.Dependencies.QuestionType.MatrixChoiceGroup)return React.createElement("div",{className:"gradingByQuestionContainer"},React.createElement("span",null,OfficeForm.Form.Resources.LocalizedStrings.QuestionView_Tip_Likert));if(a.PowertoolViewHelperRefresh.doesQuestionSupportPowertool(e))return a.Dependencies.logEvent(a.Events.QuestionsView.RenderedInPowertool),a.createPowertoolViewRefresh({Form:this.props.Form,CurrentQuestionIndex:this.props.CurrentQuestionIndex,OnGradeChange:function(){d.setState({score:c.createNavBarAverageScore(d.props.Form,e.Id)}),d.props.UpdateNextUngradedButtonState()},UpdateGradeBoxIndexAfterWhichToSearchNextUngraded:this.props.UpdateGradeBoxIndexAfterWhichToSearchNextUngraded});a.Dependencies.logEvent(a.Events.QuestionsView.RenderedInNonPowertool);var g=f.map(function(a,c){return d.createResponseContainer(a,b,c)});return React.createElement("div",{className:"gradingByQuestionContainer"},React.createElement("div",{className:"gradingByQuestionAnswerContainer gradingAnswerContainer"},g))},c.prototype.getAllResponsesForGivenQuestionId=function(b){for(var c=(this.props.Form.responses,[]),d=new a.QuestionViewRenderOrderIterator(this.props.Form,b),e=function(){var a=d.next(),b=function(b){return b.Response.Responder===a.response.Responder},e=_.filter(c,b).length;c.push({Response:a.response,Answer:a.answer,Attempt:e})};d.hasNext();)e();return c},c.prototype.formatDropdownTitleForQuestion=function(a){var b=_.filter(this.props.Form.questions,function(a){return!a.GroupId});return a+1+". "+b[a].Title},c.prototype.createGradingByQuestionNavBar=function(){var b=this,d=_.filter(this.props.Form.questions,function(a){return!a.GroupId}),e=_.range(d.length).map(function(a,c){return b.formatDropdownTitleForQuestion(c)}),f=function(){a.printGradingView(),a.Dependencies.logEvent(a.Events.QuestionsView.PrintResponse)},g={HasAnswers:null!=this.props.Form.responses&&this.props.Form.responses.length>0,DeleteAllResponses:!1,onDelete:void 0,onPrint:f},h=d[this.props.CurrentQuestionIndex].Id,i=this.props.Form.questions.filter(function(a){return!a.GroupId}).length;return a.createGradingViewNavBar({dropdownCallback:this.dropdownCallback(),dropdownOptions:e,previousItemCallback:this.previousArrowCallbackQuestion(),nextItemCallback:this.nextArrowCallbackQuestion(),indexOfCurrentItem:this.props.CurrentQuestionIndex,numberOfItems:i,generalFeedbackProps:null,generalFeedbackButtonProps:null,gradingMode:a.GradingMode.ByQuestion,progressIndicatorTemplate:a.Dependencies.Resources.LocalizedStrings.GradingView_Of_Format,MenuProps:g,questionScore:c.createNavBarAverageScore(this.props.Form,h)})},c.prototype.dropdownCallback=function(){var b=this;return function(d){var e=b.props.Form.questions[d].Id;b.props.UpdateParentCurrentQuestionIndex(d),a.Dependencies.logEvent(a.Events.QuestionsView.GotoPage),b.setState({score:c.createNavBarAverageScore(b.props.Form,e)}),a.ScrollHelper.scrollToTop()}},c.prototype.previousArrowCallbackQuestion=function(){var b=this,d=this.props.CurrentQuestionIndex;return function(){if(d>=1){var e=d-1,f=b.props.Form.questions[e].Id;b.props.UpdateParentCurrentQuestionIndex(e),a.Dependencies.logEvent(a.Events.QuestionsView.PreviousPage),b.setState({score:c.createNavBarAverageScore(b.props.Form,f)
}),a.ScrollHelper.scrollToTop()}}},c.prototype.nextArrowCallbackQuestion=function(){var b=this,d=this.props.CurrentQuestionIndex;return function(){if(d<b.props.Form.questions.length-1){var e=d+1,f=b.props.Form.questions[e].Id;b.props.UpdateParentCurrentQuestionIndex(e),a.Dependencies.logEvent(a.Events.QuestionsView.NextPage),b.setState({score:c.createNavBarAverageScore(b.props.Form,f)}),a.ScrollHelper.scrollToTop()}}},c.createNavBarAverageScore=function(b,c){var d=a.FormHelper.getScoreForQuestion(b,c),e=a.FormHelper.getTotalPossibleScoreForQuestionAcrossGradedAnswers(b,c),f=a.FormHelper.getGradedAnswersForQuestion(b,c).length;return{pointsPossible:e,pointsEarned:d,numQuestions:f}},c.prototype.renderQuestion=function(b){var c=b.Model,d=a.QuestionHelper.renderFormula(c),e=a.Dependencies.Control.createUserTextRenderer({Text:c.Title,RenderMode:a.Dependencies.UserTextRenderMode.RichText}),f=a.Dependencies.Control.createUserTextRenderer({Text:c.Subtitle,RenderMode:a.Dependencies.UserTextRenderMode.RichText}),g=c.ShowSubtitle&&c.Subtitle&&null==d?React.createElement("div",{className:"gradingByQuestionQuestionSubtitle"},f):null,h=a.QuestionHelper.hasImage(c)?a.Dependencies.createImageRenderer({Image:b.ImageInfoMaster,ImageSettings:b.ImageSettingsMaster,ImageType:"Question"}):null,i=c.VideoInfo&&c.VideoInfo.Url?React.DOM.iframe({src:c.VideoInfo.Url,height:a.VideoHelper.calcVideoDisplayHeight(),width:"100%",frameBorder:"0",allowFullScreen:!0,sandbox:"allow-scripts allow-same-origin allow-popups"}):null;return React.createElement("div",{className:"gradingByQuestionQuestionContainer"},React.createElement("div",{className:"gradingByQuestionQuestionNumberAndTitleContainer"},React.createElement("div",{className:"gradingByQuestionQuestionNumberContainer"},this.props.CurrentQuestionIndex+1,"."),React.createElement("div",{className:"gradingQuestionText gradingByQuestionQuestionTextContainer",key:c.Id},e,g)),React.createElement("div",{className:"gradingQuestionFormulaAndImageContainer"},React.createElement("div",{className:"gradingQuestionImage",key:c.Id+"Image"},h),i,React.createElement("div",{className:"gradingQuestionFormula",key:c.Id+"Formula"},d)))},c.prototype.createResponseContainer=function(b,c,d){var e=this,f=c.Model,g=(this.props.Form.responses,this.props.CurrentQuestionIndex),h=a.ResponseHelper.getProfile(b.Response).name,i=""+f.Id+h+b.Attempt+g,j=b.Answer?b.Answer.Score:void 0,k=a.Dependencies.Resources.LocalizedStrings.GradingView_Grade_ButtonTextFormat.format(h,g+1),l=this.createGradingFeedback(b,f);return React.createElement("div",{className:"gradingByQuestionOneResponseContainer",key:i},React.createElement("div",{className:"gradingByQuestionResponseHeader"},React.createElement("div",{className:"gradingByQuestionStudentAvatar gradingByQuestionAvatarContainer"},a.createStudentAvatar({response:b.Response})),React.createElement("div",{className:"gradingByQuestionStudentNameContainer"},h,b.Attempt>0?" ("+b.Attempt+")":void 0),React.createElement("div",{className:"gradingByQuestionGradeAndFeedbackContainer"},React.createElement("div",{className:"gradingByQuestionGradeContainer"},a.createGradeInput({TotalPoints:f.Point,CurrentScore:j,UpdateParentScore:this.onGradeUpdate(b.Response.Id,f),HTMLAttributes:{hidden:!f.IsQuiz,onBlur:this.onGradeBlur(f.Id),onFocus:function(){return e.props.UpdateGradeBoxIndexAfterWhichToSearchNextUngraded(d)}},title:k,autoGraded:a.FormHelper.isAutoGraded(b.Answer)})),React.createElement("div",{className:"gradingByQuestionFeedbackContainer"},l.button))),React.createElement("div",null,React.createElement("div",{className:"gradingByQuestionResponseTitle"},a.Dependencies.Resources.LocalizedStrings.GradingView_Response_Label),React.createElement("div",{className:"gradingByQuestionResponseBody"},this.createAnswerFromResponse(b,c)),React.createElement("div",{className:"grading-feedback"},l.input)))},c.prototype.createGradingFeedback=function(b,c){var d=a.Dependencies.hashCode(b.Response.Responder||b.Response.ResponderName),e="feedback-"+d+"-"+b.Attempt,f=this.props.CurrentQuestionIndex,g=a.ResponseHelper.getProfile(b.Response).name,h=a.Dependencies.Resources.LocalizedStrings.GradingView_Feedback_ButtonTextFormat.format(g,f+1),i=a.createFeedbackButton({IsExpanded:!!b.Answer.Feedback,AssociatedFeedbackId:e,Title:h,NoLabel:!0,OnClickEventName:a.Events.QuestionsView.FeedbackButtonClick}),j=React.createElement("div",{className:"gradingByQuestionFeedback"},a.createFeedbackInput({Id:e,StoredFeedback:b.Answer.Feedback,FeedbackUpdate:this.onFeedbackUpdate(b.Response.Id,c),FeedbackChangeEvent:a.Events.QuestionsView.FeedbackChanged}));return{button:i,input:j}},c.prototype.createAnswerFromResponse=function(b,c){var d=!!a.PowertoolViewHelper.normalizeAnswerFormat(b.Answer.Answer);return d?a.AnswerHelper.createAnswer(c,{Answer:b.Answer}):React.createElement("div",{className:"gradingQuestionNoAnswerGiven"},a.Dependencies.Resources.LocalizedStrings.GradingView_NoAnswerGiven_Label)},c.prototype.onGradeBlur=function(a){var b=this;return function(){b.setState({score:c.createNavBarAverageScore(b.props.Form,a)}),b.props.UpdateNextUngradedButtonState()}},c.prototype.onGradeUpdate=function(b,c){var d=this;return function(e){var f=d.props.Form,g=void 0,h=a.FunctionHelper.noOp,i=function(){return a.Dependencies.logEvent(a.Events.QuestionsView.GradeChanged,{isFormFullyGraded:a.FormHelper.isFullyGraded(f)})};f.addAnswerFeedbacks([b],c.Id,e,g,i,h)}},c.prototype.onFeedbackUpdate=function(b,c){var d=this;return function(e){var f=d.props.Form,g=void 0,h=a.FunctionHelper.noOp,i=a.FunctionHelper.noOp;f.addAnswerFeedbacks([b],c.Id,g,e,i,h)}},c}(a.Dependencies.ReactComponent);a.QuestionView=b}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){var b;!function(a){a[a.NotStarted=0]="NotStarted",a[a.Started=1]="Started",a[a.Graded=2]="Graded",a[a.Released=3]="Released"}(b=a.ResponseStatus||(a.ResponseStatus={}));var c=function(c){function d(b){var d=c.call(this,b)||this;return d.responseCountChangeCallback=function(){return d.onResponseCountChange()},d.responseListChangeCallback=function(a){return d.onResponseListChange(a)},d.nameEntryRef=React.createRef(),d.statusEntryRef=React.createRef(),d.previewEntryRef=React.createRef(),d.state={isReadyToRender:!1,releasedResponseSortBy:"Status",releasedResponseIsSortAscending:!1,unreleasedResponseSortBy:"Status",unreleasedResponseIsSortAscending:!1,checkedReponseIds:{},checkedAll:!1,releasedResponseIds:[],shouldShowInfoBar:!1,Form:new a.Dependencies.FormAdapter(b.FormMaster),isMounted:!0},d}return __extends(d,c),d.prototype.componentWillMount=function(){var b=this,c=this.state.Form;this.state.isMounted=!0,a.Dependencies.Flight.isEnabled(a.Dependencies.Flights.CoGrading)&&this.registerVariableObservers(),c.ensureReadyToGrade().then(function(){c.calculateBranchedResponses(),b.setState({isReadyToRender:!0,releasedResponseIds:a.FormHelper.getReleasedResponses(c).map(function(a){return a.Id})}),a.Dependencies.logEvent(a.Events.ResultsView.Load)}).fail(function(b){return a.Dependencies.changeUxState(function(a){return a.Model.CriticalError=b})})},d.prototype.componentDidMount=function(){a.ScrollHelper.scrollToTop(),this.state.isMounted=!0},d.prototype.componentWillUnmount=function(){this.state.isMounted=!1,a.Dependencies.Flight.isEnabled(a.Dependencies.Flights.CoGrading)&&this.unregisterVariableObservers()},d.prototype.renderView=function(){if(!this.state.isReadyToRender)return React.createElement("div",{className:"gradingReleaseResultsView gradingViewContainer"},a.Dependencies.createLoadingPlaceholder());this.state.Form.calculateBranchedResponses();var b=this.createTitleBar(),c=this.createInfoBar(),d=this.createUnreleasedResponsesTable(),e=this.createReleasedResponsesTable();return React.createElement("div",{className:"gradingReleaseResultsView gradingViewContainer"},this.includeTheme(),b,c,d,e)},d.prototype.registerVariableObservers=function(){var b=this.props.FormMaster;b.observe(this.responseCountChangeCallback,[a.Dependencies.FormMaster.Schema.ResponsesCount]),b.observe(this.responseListChangeCallback,[a.Dependencies.FormMaster.Schema.Responses])},d.prototype.unregisterVariableObservers=function(){var a=this.props.FormMaster;a.unobserve(this.responseCountChangeCallback),a.unobserve(this.responseListChangeCallback)},d.prototype.onClickReleaseButton=function(){var b=this.state.Form,c=this.state.releasedResponseIds.slice(),d=this.state.checkedReponseIds;for(var e in d)if(d.hasOwnProperty(e)&&d[e]){var f=Number(e);_.isNumber(f)&&(c.push(f),b.markAsReleased(f),a.Dependencies.logEvent(a.Events.ResultsView.ReleaseIndividualResult,{responseId:e}))}this.setState({checkedAll:!1,checkedReponseIds:{},releasedResponseIds:c}),a.Dependencies.logEvent(a.Events.ResultsView.ReleaseResults,{anyManuallyGradedResults:a.FormHelper.hasAnyManualGrading(b),isFormFullyReleased:a.FormHelper.isFullyReleased(b)})},d.prototype.createReleaseButton=function(){var b=this,c=!1,d=this.state.checkedReponseIds;if(!_.isEmpty(d))for(var e in this.state.checkedReponseIds)d.hasOwnProperty(e)&&d[e]&&(c=!0);var f=function(){return b.onClickReleaseButton()},g=!1;return c||(f=a.FunctionHelper.noOp,g=!0),a.Dependencies.Control.createTextButton({HTMLAttributes:{className:"office-form-theme-button gradingTextButton",onClick:f,disabled:g},ButtonStyle:a.Dependencies.ButtonStyle.LightBackground,Text:a.Dependencies.Resources.LocalizedStrings.GradingView_ReleaseResultButton_Label})},d.prototype.createTitleBar=function(){var b=this.state.Form,c=a.Dependencies.Resources.LocalizedStrings.GradingView_ReleaseResultViewTitle_LabelFormat.format(b.title);return React.createElement("div",{className:"gradingReleaseResultTitleBarContainer"},React.createElement("div",{className:"gradingReleaseResultTitle gradingTitle office-form-theme-primary-foreground"},c),React.createElement("div",{className:"gradingReleaseResultButtonGroup"},this.createInfoButton(),this.createReleaseButton()))},d.prototype.createInfoButton=function(){var b=this;return a.Dependencies.Control.createGlyphButton({HTMLAttributes:{className:"gradingReleaseResultInfoButton office-form-theme-primary-foreground",onClick:function(){var c=b.state.shouldShowInfoBar;b.setState({shouldShowInfoBar:!c}),a.Dependencies.logEvent(a.Events.ResultsView.PostScoresInfoBar,{showInfoBar:!c})}},GlyphButtonStyle:a.Dependencies.GlyphButtonStyle.GlyphOnly,Icon:"Help",IconClass:"forms-icon-size16x16",Text:a.Dependencies.Resources.LocalizedStrings.GradingView_ReleaseResultInfoButton_Label,ref:function(a){return b.infoButtonElement=ReactDOM.findDOMNode(a)}})},d.prototype.createInfoBar=function(){var b=this;if(!this.state.shouldShowInfoBar)return void 0;var c=a.Dependencies.Resources.LocalizedStrings.GradingView_ReleaseResultFunctionalityDescription_Text,d=a.Dependencies.Control.createGlyphButton({HTMLAttributes:{className:"gradingReleaseResultInfoBarCloseButton",onClick:function(){b.setState({shouldShowInfoBar:!1}),a.Dependencies.logEvent(a.Events.ResultsView.PostScoresInfoBar,{showInfoBar:!1}),b.infoButtonElement.focus()}},GlyphButtonStyle:a.Dependencies.GlyphButtonStyle.GlyphOnly,Icon:"Cancel",IconClassName:"forms-icon-size14x14",Text:a.Dependencies.Resources.LocalizedStrings.GradingView_ReleaseResultInfoBarCloseButton_Label}),e=React.createElement("div",{className:"gradingReleaseResultInfoBarTriangle"});return React.createElement("div",{className:"gradingReleaseResultInfoBar",tabIndex:0,ref:function(a){a&&a.focus()}},c,d,e)},d.prototype.createReleasedResponsesTable=function(){var a=this.state.Form.responses.map(function(a,b){return{response:a,index:b}}),b=this.state.releasedResponseIds,c=this.sortResponse(!0,a.filter(function(a){return-1!==b.indexOf(a.response.Id)}));if(!c||0===c.length)return React.createElement("div",null);var d=this.createResponseTableTitle(!0),e=this.createResponseTableHeader(!0),f=this.createRowsForResponses(c);return React.createElement("div",null,d,React.createElement("div",{className:"gradingReleaseResultTableContainer"},e,f))},d.prototype.createUnreleasedResponsesTable=function(){var a=this.state.Form.responses.map(function(a,b){return{response:a,index:b}}),b=this.state.releasedResponseIds,c=this.sortResponse(!1,a.filter(function(a){return-1===b.indexOf(a.response.Id)}));if(!c||0===c.length)return React.createElement("div",null);var d=this.createResponseTableTitle(!1),e=this.createResponseTableHeader(!1),f=this.createRowsForResponses(c);return React.createElement("div",null,d,React.createElement("div",{className:"gradingReleaseResultTableContainer"},e,f))},d.prototype.createResponseTableTitle=function(b){var c=b?a.Dependencies.Resources.LocalizedStrings.GradingView_ReleasedResponseTableTitle_Label:a.Dependencies.Resources.LocalizedStrings.GradingView_UnreleasedResponseTableTitle_Label;return React.createElement("div",{className:"gradingReleaseResultTableTitle"},c)},d.prototype.ariaInfoForSortButton=function(b){var c,d;return"SortDown"===b&&(c=a.Dependencies.Resources.LocalizedStrings.Accessibility_SortColumnAscending,d="descending"),"Sort"===b&&(c=a.Dependencies.Resources.LocalizedStrings.Accessibility_SortColumnToggleButton_Label+" "+a.Dependencies.Resources.LocalizedStrings.Accessibility_SortColumnAscending,d=void 0),"SortUp"===b&&(c=a.Dependencies.Resources.LocalizedStrings.Accessibility_SortColumnDescending,d="ascending"),{label:a.Dependencies.Resources.LocalizedStrings.GradingView_PointsColumn_Label+": "+c,sort:d}},d.prototype.sortButtonIconForState=function(a){if(a){if("Points"===this.state.releasedResponseSortBy)return this.state.releasedResponseIsSortAscending?"SortDown":"SortUp"}else if("Points"===this.state.unreleasedResponseSortBy)return this.state.unreleasedResponseIsSortAscending?"SortDown":"SortUp";return"Sort"},d.prototype.createResponseTableHeader=function(b){var c=this,d=React.createElement("div",{title:a.Dependencies.Resources.LocalizedStrings.GradingView_PostGrades_NameColumnDescription},a.Dependencies.Resources.LocalizedStrings.GradingView_NameColumn_Label,React.createElement("span",{"aria-label":a.Dependencies.Resources.LocalizedStrings.GradingView_PostGrades_NameColumnDescription})),e=React.createElement("a",{className:"screenReaderVisible"},a.Dependencies.Resources.LocalizedStrings.GradingView_PostGrades_PreviewColumnDescription),f=React.createElement("div",{title:a.Dependencies.Resources.LocalizedStrings.GradingView_PostGrades_StatusColumnDescription},a.Dependencies.Resources.LocalizedStrings.GradingView_ReleaseResultsStatus_Label,React.createElement("span",{"aria-label":a.Dependencies.Resources.LocalizedStrings.GradingView_PostGrades_StatusColumnDescription})),g=this.sortButtonIconForState(b),h=this.ariaInfoForSortButton(g),i=a.Dependencies.Control.createFontIconControl({HTMLAttributes:{className:"forms-icon-size16x16",role:"presentation"},IconName:g}),j=a.Dependencies.Control.createButton({HTMLAttributes:{"aria-label":h.label,"aria-sort":h.sort,className:"gradingReleaseResultHeaderButton",onClick:function(){c.changeSorting(b,"Points")}},ButtonStyle:a.Dependencies.ButtonStyle.None,children:React.createElement("div",null,React.createElement("span",null,a.Dependencies.Resources.LocalizedStrings.GradingView_PointsColumn_Label),i)}),k=React.createElement("div",{className:"gradingReleaseResultTableCell gradingReleaseResultTableHeaderCell"},e);if(b)return React.createElement("div",{className:"gradingReleaseResultTableRow"},React.createElement("div",{className:"gradingReleaseResultTableCell gradingReleaseResultTableHeaderCell"}),React.createElement("div",{className:"gradingReleaseResultTableCell gradingReleaseResultTableHeaderCell","aria-label":"This column contains the name of students"},d),k,React.createElement("div",{className:"gradingReleaseResultTableCell gradingReleaseResultTableHeaderCell gradingResultViewStatusColumn"},f),React.createElement("div",{className:"gradingReleaseResultTableCell gradingReleaseResultTableHeaderCell gradingResultViewPointsColumn"},j));var l=this.state.checkedAll,m=a.Dependencies.Control.createCheckBox({Description:void 0,HelpText:a.Dependencies.Resources.LocalizedStrings.GradingView_PostGrades_SelectAllCheckbox_Description,Options:{HTMLPropsForInnerElement:{"aria-label":a.Dependencies.Resources.LocalizedStrings.GradingView_PostGrades_SelectAllCheckbox_Description}},Value:l,onValueChange:function(){var a=JSON.parse(JSON.stringify(c.state.checkedReponseIds)),b=c.state.Form.responses,d=b.filter(function(a){return-1===c.state.releasedResponseIds.indexOf(a.Id)});d.forEach(function(b){return a[b.Id]=!l}),c.setState({checkedReponseIds:a,checkedAll:!l})}});return React.createElement("div",{className:"gradingReleaseResultTableRow"},React.createElement("div",{className:"gradingReleaseResultTableCell gradingReleaseResultTableHeaderCell gradingResultViewCheckBoxColumn"},m),React.createElement("div",{className:"gradingReleaseResultTableCell gradingReleaseResultTableHeaderCell"},d),k,React.createElement("div",{className:"gradingReleaseResultTableCell gradingReleaseResultTableHeaderCell gradingResultViewStatusColumn"},f),React.createElement("div",{className:"gradingReleaseResultTableCell gradingReleaseResultTableHeaderCell gradingResultViewPointsColumn"},j))},d.prototype.changeSorting=function(a,b){a?this.state.releasedResponseSortBy===b?this.setState({releasedResponseIsSortAscending:!this.state.releasedResponseIsSortAscending}):this.setState({releasedResponseSortBy:b,releasedResponseIsSortAscending:!1}):this.state.unreleasedResponseSortBy===b?this.setState({unreleasedResponseIsSortAscending:!this.state.unreleasedResponseIsSortAscending}):this.setState({unreleasedResponseSortBy:b,unreleasedResponseIsSortAscending:!1})},d.prototype.createRowsForResponses=function(c){var d=this,e=this.state.Form;return c.map(function(c){var f=a.FormHelper.getMaximumScoreForResponder(e,c.response.Id),g=a.FormHelper.getScoreForResponder(e,c.response.Id);if(-1!==d.state.releasedResponseIds.indexOf(c.response.Id))return d.createResponseRow(b.Released,c,g,f);var h,i=e.questions.filter(function(a){return a.IsQuiz}),j=0,k=0;return _.forEach(c.response.Answers,function(a){null!=_.find(i,function(b){return a.QuestionId===b.Id})&&(j++,null!=a.Score&&k++)}),h=j===k?b.Graded:0===k?b.NotStarted:b.Started,d.createResponseRow(h,c,g,f)})},d.prototype.sortResponse=function(a,b){return a&&"Points"===this.state.releasedResponseSortBy?this.sortResponseByScore(b,this.state.releasedResponseIsSortAscending):a||"Points"!==this.state.unreleasedResponseSortBy?b:this.sortResponseByScore(b,this.state.unreleasedResponseIsSortAscending)},d.prototype.percentScore=function(b){var c=a.FormHelper.getScoreForResponder(this.state.Form,b.Id),d=a.FormHelper.getMaximumScoreForResponder(this.state.Form,b.Id);return 0!==d?c/d:0},d.prototype.sortResponseByScore=function(a,b){var c=this,d=a.slice();return b?d.sort(function(a,b){return c.percentScore(b.response)-c.percentScore(a.response)}):d.sort(function(a,b){return c.percentScore(a.response)-c.percentScore(b.response)}),d},d.prototype.createResponseRow=function(c,d,e,f){var g,h=this,i=this.state.checkedReponseIds[d.response.Id];if(c===b.Released)g=null;else{var j=a.Dependencies.Resources.LocalizedStrings.GradingView_PostGrades_SelectStudentCheckbox_AccessibilityTextFormat.format(d.response.ResponderName),k={Value:i===!0,Description:void 0,HelpText:j,Options:{HTMLPropsForInnerElement:{"aria-label":j}},onValueChange:function(){var a=JSON.parse(JSON.stringify(h.state.checkedReponseIds));a[d.response.Id]=!i,h.setState({checkedReponseIds:a,checkedAll:!1})}};g=a.Dependencies.Control.createCheckBox(k)}var l;switch(c){case b.NotStarted:case b.Started:l="redText";break;case b.Released:case b.Graded:l="greenText";break;default:l="blackText"}var m;switch(c){case b.Released:m=a.Dependencies.Resources.LocalizedStrings.GradingView_ReleaseResultStatusReleased_Label;break;case b.NotStarted:case b.Started:m=a.Dependencies.Resources.LocalizedStrings.GradingView_ReleaseResultStatusNeedsReview_Label;break;case b.Graded:m=a.Dependencies.Resources.LocalizedStrings.GradingView_ReleaseResultStatusGraded_Label;break;default:m="unknown"}var n;if(c===b.NotStarted)n=React.createElement("span",{"aria-label":a.Dependencies.Resources.LocalizedStrings.GradingView_NoScore},void 0,[" "]);else{var o=e&&f?Math.round(e/f*100):0;n="{0} ({1}%)".format(e,o)}var p=function(b){return function(){a.Dependencies.changeUxState(function(c){c.Model.Grading={View:a.GradingMode.ByStudent.View,Index:d.index,GoBackToView:a.GradingMode.GoBackToReleaseResults},c.showTopView("Grading_ReviewAnswers",function(){b.current&&b.current.focus()})}),a.Dependencies.logEvent(a.Events.ResultsView.DeepLinkToStudent)}},q=function(){a.Dependencies.changeUxState(function(a){a.Model.Preview={PreviousTopView:"Grading_PostGrades",ResponseIndex:d.index},a.showTopView("Preview",function(){h.previewEntryRef.current&&h.previewEntryRef.current.focus()})}),a.Dependencies.logEvent(a.Events.ResultsView.LinkToStudentPreview)},r=a.ResponseHelper.getProfile(d.response).name,s=React.createElement("a",{href:"javascript:;",title:a.Dependencies.Resources.LocalizedStrings.GradingView_GoToStudentLink_LabelFormat.format(r),ref:this.nameEntryRef,"aria-label":a.Dependencies.Resources.LocalizedStrings.GradingView_GoToStudentLink_LabelFormat.format(r),onClick:p(this.nameEntryRef),className:"goToStudentLink"},React.createElement("span",null,r)),t=React.createElement("a",{href:"javascript:;",title:a.Dependencies.Resources.LocalizedStrings.GradingView_GoToStudentLink_LabelFormat.format(r),ref:this.statusEntryRef,"aria-label":a.Dependencies.Resources.LocalizedStrings.GradingView_PostGrades_ResponseStatus_AccessibilityLabelFormat.format(r,m),onClick:p(this.statusEntryRef),className:"goToStudentLink"},React.createElement("span",{className:l},m)),u=React.createElement("a",{href:"javascript:;",ref:this.previewEntryRef,title:a.Dependencies.Resources.LocalizedStrings.GradingView_ReleaseResultPreviewLink_Text,"aria-label":a.Dependencies.Resources.LocalizedStrings.GradingView_PostGrades_PreviewLink_AccessibilityLabelFormat.format(r),onClick:q,className:"goToStudentLink"},a.Dependencies.Resources.LocalizedStrings.GradingView_ReleaseResultPreviewLink_Text),v=React.createElement("div",{className:"gradingReleaseResultTableCell gradingResultViewPreviewColumn"},u);return React.createElement("div",{className:"gradingReleaseResultTableRow",key:d.response.Id},React.createElement("div",{className:"gradingReleaseResultTableCell gradingResultViewCheckBoxColumn"},g),React.createElement("div",{className:"gradingReleaseResultTableCell gradingResultViewResponderColumn"},a.createStudentAvatar({response:d.response}),React.createElement("span",{className:"gradingReleaseResultResponderName"},s)),v,React.createElement("div",{className:"gradingReleaseResultTableCell gradingResultViewStatusColumn"},t),React.createElement("div",{className:"gradingReleaseResultTableCell gradingResultViewPointsColumn"},React.createElement("span",null,n)))},d.prototype.onResponseCountChange=function(){var a=this.props.FormMaster;a.Model.ResponsesCount!==a.Model.Responses.length&&a.syncFormResponses()},d.prototype.onResponseListChange=function(b){var c=this;if(this.state.isMounted){var d=new a.Dependencies.FormAdapter(this.props.FormMaster);d.ensureReadyToGrade().then(function(){d.calculateBranchedResponses(),c.setState({Form:d,isReadyToRender:!0,releasedResponseIds:a.FormHelper.getReleasedResponses(d).map(function(a){return a.Id})}),a.Dependencies.logEvent(a.Events.ResultsView.Load)}).fail(function(b){return a.Dependencies.changeUxState(function(a){return a.Model.CriticalError=b})})}},d}(a.GradingTopViewBase);a.ReleaseResultsView=c}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){var b=function(b){function c(d){var e=b.call(this,d)||this;e.getJsonForResponder=function(){return e.props.Form.responses[e.props.CurrentResponderIndex]},e.onGeneralFeedbackUpdate=function(b){var c=e.props.Form,d=e.getJsonForResponder().Id,f=a.FunctionHelper.noOp,g=a.FunctionHelper.noOp;c.addGeneralFeedback(d,b,g,f),e.setState({currentGeneralFeedback:b})},e.changeResponderInState=function(a){e.setState({currentResponderIndex:a})};var f=d.Form.responses[d.CurrentResponderIndex],g=f.Id;return e.state={score:c.createNavBarStudentScore(d.Form,g),currentGeneralFeedback:f&&f.Feedback?f.Feedback:void 0,responseIsReleased:a.FormHelper.isResponseReleased(f)},e}return __extends(c,b),c.prototype.componentWillMount=function(){var b=this.props.Form.questions,c=this.props.Form.responses,d=a.ResponseHelper.createGradingViewLoadEventData(b,c);a.Dependencies.logEvent(a.Events.StudentsView.Load,d)},c.prototype.componentDidMount=function(){a.ScrollHelper.scrollToTop()},c.prototype.render=function(){var a,b=this,c=(this.props.Form.questions,this.getQuestionsAndAnswersForResponder());a=0===this.props.Form.wrappedForm.FormElementManager.SectionMasters.length?c.map(function(a,c){return b.constructHtmlNodesForQuestionAndAnswer(a,c)}):this.constructHtmlNodesForSections(c);var d={id:"grading-by-people-panel",role:"tabpanel","aria-labelledby":"grading-by-people-tab","aria-expanded":!0};return React.createElement("div",__assign({},d),this.createNavBar(),React.createElement("div",null,a))},c.prototype.getGeneralFeedbackId=function(){return"feedback-general-"+this.props.CurrentResponderIndex},c.prototype.createNavBar=function(){var b=this,d=this.props.Form.responses,e=this.props.CurrentResponderIndex,f=d.length,g=d.map(function(b){return a.ResponseHelper.getProfile(b).name}),h=this.props.Form.responses[this.props.CurrentResponderIndex],i=a.ResponseHelper.getProfile(h).name,j={Id:this.getGeneralFeedbackId(),FeedbackUpdate:this.onGeneralFeedbackUpdate.bind(this),StoredFeedback:this.state.currentGeneralFeedback?this.state.currentGeneralFeedback:void 0,FeedbackChangeEvent:a.Events.StudentsView.GeneralFeedbackChanged},k={HTMLAttributes:{className:"gradingNavBarFeedbackButtonContainer"},IsExpanded:!!j.StoredFeedback,AssociatedFeedbackId:j.Id,Title:a.Dependencies.Resources.LocalizedStrings.GradingView_GeneralFeedback_Label.format(i),OnClickEventName:a.Events.StudentsView.GeneralFeedbackButtonClick,NoLabel:!0},l=function(){b.props.Form.markAsReleased(h.Id),a.Dependencies.logEvent(a.Events.StudentsView.ReleaseResult),b.setState({responseIsReleased:!0})},m=function(){b.doDeleteCurrentResponse(e,f),a.Dependencies.logEvent(a.Events.StudentsView.DeleteResponse)},n=function(){a.printGradingView(),a.Dependencies.logEvent(a.Events.StudentsView.PrintResponse)},o={HasAnswers:null!=d&&d.length>0,DeleteAllResponses:!1,IsScoreReleased:this.state.responseIsReleased,onDelete:e>=0?m:a.FunctionHelper.noOp,onPrint:n,onPostScore:l,ConfirmDialogTextClassName:"menu-action-confirmation-smaller-font"};return React.createElement("span",null,React.createElement("span",{id:"general-feedback-toggle-wrapper",style:{display:"none"}},a.createFeedbackButton(k)),a.createGradingViewNavBar({dropdownCallback:this.dropdownCallback(d),dropdownOptions:c.handleDuplicatedResponderNames(g),previousItemCallback:this.previousArrowCallbackStudent(e),nextItemCallback:this.nextArrowCallbackStudent(e,f),indexOfCurrentItem:e,numberOfItems:f,generalFeedbackProps:j,generalFeedbackButtonProps:k,gradingMode:a.GradingMode.ByStudent,progressIndicatorTemplate:a.Dependencies.Resources.LocalizedStrings.GradingView_Of_Format,MenuProps:o,fillTime:c.calculateIndividualFillTime(h),studentScore:c.createNavBarStudentScore(this.props.Form,h.Id)}))},c.prototype.previousArrowCallbackStudent=function(b){var d=this;return function(){if(b>=1){var e=b-1,f=d.props.Form.responses[e],g=f.Id;d.props.UpdateParentCurrentStudentIndex(e),a.Dependencies.logEvent(a.Events.StudentsView.PreviousPage),d.setState({score:c.createNavBarStudentScore(d.props.Form,g),currentGeneralFeedback:f&&f.Feedback?f.Feedback:void 0,responseIsReleased:a.FormHelper.isResponseReleased(f)}),a.ScrollHelper.scrollToTop()}}},c.prototype.nextArrowCallbackStudent=function(b,d){var e=this;return function(){if(d>=b){var f=b+1,g=e.props.Form.responses[f],h=g.Id;e.props.UpdateParentCurrentStudentIndex(f),a.Dependencies.logEvent(a.Events.StudentsView.NextPage),e.setState({score:c.createNavBarStudentScore(e.props.Form,h),currentGeneralFeedback:g&&g.Feedback?g.Feedback:void 0,responseIsReleased:a.FormHelper.isResponseReleased(g)}),a.ScrollHelper.scrollToTop()}}},c.prototype.dropdownCallback=function(b){var d=this;return function(b){var e=d.props.Form.responses[b],f=e.Id;d.props.UpdateParentCurrentStudentIndex(b),a.Dependencies.logEvent(a.Events.StudentsView.GotoPage),d.setState({score:c.createNavBarStudentScore(d.props.Form,f),currentGeneralFeedback:e&&e.Feedback?e.Feedback:void 0,responseIsReleased:a.FormHelper.isResponseReleased(e)}),a.ScrollHelper.scrollToTop()}},c.prototype.getQuestionsAndAnswersForResponder=function(){for(var b=(this.props.Form.questions,this.props.Form.wrappedForm.FormElementManager.TopQuestionMasters),c=this.getJsonForResponder(),d=[],e=new a.StudentViewRenderOrderIterator(this.props.Form,c);e.hasNext();){var f=e.next(),g=this.createFeedback(f.question,f.answer,f.answerRenderOrderIndex);d.push({questionMaster:b[f.unbranchedQuestionIndex],answer:f.answer,feedbackButton:g.button,feedbackInput:g.input})}return d},c.prototype.constructHtmlNodesForQuestionAndAnswer=function(b,c){var d=this,e=_.filter(this.props.Form.questions,function(a){return!a.GroupId}),f=e[c].IsQuiz,g=f?"":"InvisibleBlock",h=a.ResponseHelper.getProfile(this.getJsonForResponder()).name,i=b.feedbackButton;b.feedbackButton=void 0;var j=c+1+".",k=React.createElement("div",{className:"gradingByStudentQuestionNumber"},j),l=React.createElement("div",{className:"gradingByStudentResponseContainer"},a.createQuestionAndAnswer(b)),m=b.questionMaster,n=m.Model,o=(m.SubQuestionMasters,b.answer),p=a.Dependencies.Resources.LocalizedStrings.GradingView_Grade_ButtonTextFormat.format(h,c+1),q=n.Id+this.props.CurrentResponderIndex,r=React.createElement("div",{className:"gradingByStudentGradeAndFeedbackContainer"},React.createElement("div",{className:"gradingByStudentGradeContainer",key:q+"-gradeAndFeedback"},a.createGradeInput({TotalPoints:n.Point,CurrentScore:o.Score,UpdateParentScore:this.onGradeUpdate(n,o),HTMLAttributes:{className:g,onBlur:function(){return d.onGradeBlur()},onFocus:function(){return d.props.UpdateGradeBoxIndexAfterWhichToSearchNextUngraded(c)}},title:p,autoGraded:a.FormHelper.isAutoGraded(o)})),React.createElement("div",{className:"gradingByStudentFeedbackContainer"},i));return React.createElement("div",{key:q+"-container",className:"gradingByStudentFullQuestionContainer"},r,k,l)},c.prototype.constructHtmlNodesForSections=function(a){var b=this;return React.createElement("div",null,this.constructHtmlNodesForSection(a),this.props.Form.wrappedForm.FormElementManager.SectionMasters.map(function(c,d){return b.constructHtmlNodesForSection(a,c)}))},c.prototype.constructHtmlNodesForSection=function(a,b){var c=this,d=Number.MIN_VALUE,e=Number.MAX_VALUE;if(null!=b){d=b.Model.Order;var f=_.find(b.Form.FormElementManager.SectionMasters,function(a){return a.Model.Order>b.Model.Order});null!=f&&(e=f.Model.Order)}else e=this.props.Form.wrappedForm.FormElementManager.SectionMasters[0].Model.Order;var g=0,h=a.filter(function(a){return a.questionMaster.Model.Order<e&&a.questionMaster.Model.Order>d});h.length>0&&(g=_.findIndex(a,h[0]));var i=h.map(function(a,b){return c.constructHtmlNodesForQuestionAndAnswer(a,b+g)});return b?[React.createElement(Forms.UX.Renderer.SectionBreaker,{HasTheme:!1,key:"form-section-breaker-"+b.Model.Id}),React.createElement(Forms.UX.Renderer.SectionRender,{children:i,Disabled:!0,DisableShuffle:!0,Expaned:!0,IsMobile:OfficeForm.Utilities.isMobile(),key:"form-section-container-"+b.Model.Id,SectionMaster:b})]:i},c.prototype.createFeedback=function(b,c,d){var e=this.props.Form.responses[this.props.CurrentResponderIndex],f=a.ResponseHelper.getProfile(e).name,g="feedback-"+b.Id+"-"+e.Id,h=a.Dependencies.Resources.LocalizedStrings.GradingView_Feedback_ButtonTextFormat.format(f,d+1),i=React.createElement("div",{
key:"button-"+g},a.createFeedbackButton({IsExpanded:!!c.Feedback,AssociatedFeedbackId:g,Title:h,NoLabel:!0,OnClickEventName:a.Events.StudentsView.FeedbackButtonClick})),j=React.createElement("div",{key:"input-"+g},a.createFeedbackInput({Id:g,FeedbackUpdate:this.onFeedbackUpdate(b),StoredFeedback:c.Feedback,FeedbackChangeEvent:a.Events.StudentsView.FeedbackChanged}));return{button:i,input:j}},c.handleDuplicatedResponderNames=function(a){var b={};return a.map(function(a){return b[a]?b[a]++:b[a]=1,void 0===a?OfficeForm.Form.Resources.LocalizedStrings.DisplayFormat_AnonymousUserName.format(OfficeForm.Form.Resources.LocalizedStrings.ResponderNameForAnonymousUser,b[a]):1===b[a]?a:OfficeForm.Form.Resources.LocalizedStrings.DisplayFormat_DuplicateUserName.format(a,b[a])})},c.prototype.onGradeBlur=function(){this.setState({score:c.createNavBarStudentScore(this.props.Form,this.getJsonForResponder().Id)}),this.props.UpdateNextUngradedButtonState()},c.prototype.onGradeUpdate=function(b,c){var d=this;return function(e){var f=d.props.Form,g=d.getJsonForResponder().Id,h=void 0,i=a.FunctionHelper.noOp,j=function(){return a.Dependencies.logEvent(a.Events.StudentsView.GradeChanged,{isFormFullyGraded:a.FormHelper.isFullyGraded(f),isGradedAnswer:c.IsAutoGraded,isMathQuestion:b.IsMathQuiz,questionType:b.Type,questionId:b.Id})};f.addAnswerFeedbacks([g],b.Id,e,h,j,i)}},c.prototype.onFeedbackUpdate=function(b){var c=this;return function(d){var e=c.getJsonForResponder().Id,f=c.props.Form,g=void 0,h=a.FunctionHelper.noOp,i=a.FunctionHelper.noOp;f.addAnswerFeedbacks([e],b.Id,g,d,i,h)}},c.prototype.doDeleteCurrentResponse=function(b,d){var e=this.props.Form;a.Dependencies.AnalyzeHelper.onDeleteCurrentResponse(e.wrappedForm,e.responses[b].Id),e.calculateBranchedResponses();var f=b;if(b===d-1&&(f=d-2),0>f)return void this.props.onDeleteLastResponse();var g=this.props.Form.responses[f];this.props.UpdateParentCurrentStudentIndex(f),this.setState({score:c.createNavBarStudentScore(this.props.Form,g.Id),currentGeneralFeedback:g&&g.Feedback?g.Feedback:void 0})},c.calculateIndividualFillTime=function(a){var b=a.StartDate.getTime(),c=a.SubmitDate.getTime(),d=(c-b)/1e3,e=Math.floor(d/60),f=Math.round(d%60);return{minutes:e,seconds:f}},c.createNavBarStudentScore=function(b,c){var d=a.FormHelper.getMaximumScoreForResponder(b,c),e=a.FormHelper.getScoreForResponder(b,c);return d>0?{pointsPossible:d,pointsEarned:e}:this.getScoreBasedOnNumberOfCorrectAnswers(b,c)},c.getScoreBasedOnNumberOfCorrectAnswers=function(b,c){var d=a.FormHelper.getAnswersForResponder(b,c),e=d.map(function(a){return a.QuestionId}),f=b.questions.filter(function(a){return _.contains(e,a.Id)}),g=0,h=0,i={};d.forEach(function(a){i[a.QuestionId]=a}),f.forEach(function(c){var d=a.QuestionHelper.getQuestionMaster(b,c.Id);i[c.Id]&&d.isCorrectAnswer(i[c.Id].Answer)&&g++,_.some(c.Choices,function(a){return a.IsAnswerKey})&&h++});var j=Math.round(100*g/h);return{pointsPossible:void 0,pointsEarned:void 0,scoreOverride:isNaN(j)?void 0:j+""}},c}(a.Dependencies.ReactComponent);a.StudentView=b}(OfficeFormGrading||(OfficeFormGrading={}));var OfficeFormGrading;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.componentWillMount=function(){var b=this;this.props.FormMaster.ensureFieldsReady([a.Dependencies.FormMaster.Schema.Settings]).done(function(){b.setState({IsFormSettingsReady:!0})})},c.prototype.renderView=function(){return this.state.IsFormSettingsReady?React.createElement("div",{className:"surveyResultsView"},React.createElement("div",{className:"surveyResultsTitle office-form-theme-primary-foreground"},a.Dependencies.Resources.LocalizedStrings.AnalyzeView_ViewResultsButton_Label),React.createElement("div",{id:"analyzeViewPrintParent",ref:"analyzeContainer"},React.createElement("div",{id:"analyzeViewPrintChild",className:"analyze-view-container results-view-container"},a.Dependencies.createSurveyIndividualViewContainer(this.props.FormMaster)))):React.createElement("div",null)},c}(a.GradingTopViewBase);a.SurveyResultsTopView=b}(OfficeFormGrading||(OfficeFormGrading={})),function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a["default"]}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="",b(b.s=227)}([function(a,b){a.exports=React},function(a,b,c){"use strict";function d(a){var b=a;j.forEach(function(c){var d=b[c];d&&(b[c]=function(){for(var b=[],f=0;f<arguments.length;f++)b[f]=arguments[f];try{return d.apply(a,b)}catch(g){return e(a,c,g),null}})})}function e(a,b,c){try{if(c&&c.stack&&console.log(c.stack),window.onerror){var d=h.findDOMNode(a),e=d&&d.getAttribute("data-reactId")||"",f="Exception in "+a.constructor.name+"["+e+"]:"+b;c&&c.message&&(f+=" Message: "+c.message),window.onerror(f,"",0,0,c)}}catch(c){}}var f=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var g=c(0),h=c(6);c(28),c(29);var i=function(a){function b(b){var c=a.call(this,b)||this;return c.state={},d(c),c}return f(b,a),b}(g.Component);b.ReactComponent=i;var j=["componentWillMount","componentDidMount","componentWillReceiveProps","shouldComponentUpdate","componentWillUpdate","componentDidUpdate","componentWillUnmount","render"]},function(a,b,c){"use strict";function d(a){if(l.Flight.isEnabled(l.Flights.UseRefactoredTelemetry)){var b=n[a.eventType];if(b)j.Telemetry.logData(b(a));else{var c={eventName:"no_ErrorName",eventType:"error_event",extraData:{initData:a,message:"Unsupported event"}};j.Telemetry.logData(e(c))}}else switch(a.eventType){case"engagement_event":k.EngagementEventDeprecated.logData({extraData:a.extraData,name:a.eventName});break;case"error_event":k.ErrorEventDeprecated.logData({errorInfo:a.extraData,type:a.eventName});break;case"session_start":k.EngagementEventDeprecated.logSessionStartEvent();break;case"nav_perf_event":k.NavPerfEventDeprecated.logData({extraData:a.extraData,name:a.eventName})}}function e(a){var b={duration:0,eventCorrelationId:m.Guid.newGuid(),eventName:(a.eventName||o[a.eventType]).replace(" ",""),eventType:a.eventType,properties:"",timeStamp:m.DateTime.getTimeStamp()};return a.extraData&&(b.properties=JSON.stringify(a.extraData)),b}function f(a){return a.extraData={DbId:"",DeviceId:""},e(a)}function g(a){var b={duration:a.duration,eventCorrelationId:a.correlationId,eventName:(a.eventName||o[a.eventType]).replace(" ",""),eventType:a.eventType,properties:"",timeStamp:m.DateTime.getTimeStamp()};return a.extraData&&(b.properties=JSON.stringify(a.extraData)),b}function h(a){var b=e(a);return a.extraData&&(a.ignoreRawTiming&&i(a),b.properties=JSON.stringify(a.extraData)),b}function i(a){if(window.performance){var b=window.performance.timing,c={navigationType:window.performance.navigation.type};c.navigationStart=b.navigationStart,c.unloadEventStart=b.unloadEventStart-b.navigationStart,c.unloadEventEnd=b.unloadEventEnd-b.navigationStart,c.redirectStart=0===b.redirectStart?0:b.redirectStart-b.navigationStart,c.redirectEnd=0===b.redirectEnd?0:b.redirectEnd-b.navigationStart,c.fetchStart=b.fetchStart-b.navigationStart,c.domainLookupStart=b.domainLookupStart-b.navigationStart,c.domainLookupEnd=b.domainLookupEnd-b.navigationStart,c.connectStart=b.connectStart-b.navigationStart,c.connectEnd=b.connectEnd-b.navigationStart,c.requestStart=b.requestStart-b.navigationStart,c.responseStart=b.responseStart-b.navigationStart,c.responseEnd=b.responseEnd-b.navigationStart,c.domLoading=b.domLoading-b.navigationStart,c.domInteractive=b.domInteractive-b.navigationStart,c.domContentLoadedEventStart=b.domContentLoadedEventStart-b.navigationStart,c.domContentLoadedEventEnd=b.domContentLoadedEventEnd-b.navigationStart,c.domComplete=b.domComplete-b.navigationStart,c.loadEventStart=b.loadEventStart-b.navigationStart,c.loadEventEnd=b.loadEventEnd-b.navigationStart,a.extraData=a.extraData||{};var d="rawTiming";a.extraData[d]=c}}Object.defineProperty(b,"__esModule",{value:!0});var j=c(11),k=OfficeForm.Exports.Event,l=OfficeForm.Exports.Flighting,m=OfficeForm.Exports.Utilities,n={engagement_event:e,error_event:e,nav_perf_event:h,qos_event:g,session_start:f},o={engagement_event:"no_EngagementName",error_event:"no_ErrorName",nav_perf_event:"no_NavPerfName",qos_event:"no_QosName",session_start:"session_start"};b.log=d,Forms.Telemetry.log=d},function(a,b){a.exports=_},function(a,b,c){"use strict";a.exports=Nerve},function(a,b,c){"use strict";function d(a){return i().then(function(){window.location.assign(a)})}function e(a){return i().then(function(){window.location.reload(a)})}function f(a){return i().then(function(){window.location.replace(a)})}function g(a){return i().then(function(){window.location.pathname=a})}function h(a){j.push(a)}function i(){var a=j;j=[];var b=OfficeForm.Exports.Utilities.Promise.always,c=$.when.apply($,a.map(function(a){return b(a())}));return j.push(function(){return c}),c}Object.defineProperty(b,"__esModule",{value:!0}),b.redirectTo=d,b.reloadPage=e,b.replaceUrl=f,b.replacePathName=g,b.beforeLeavingPage=h;var j=[];Forms.Common.redirectTo=d,Forms.Common.reloadPage=e,Forms.Common.replaceUrl=f,Forms.Common.replacePathName=g,Forms.Common.beforeLeavingPage=h},function(a,b){a.exports=ReactDOM},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d;!function(a){a[a.BackSpace=8]="BackSpace",a[a.Tab=9]="Tab",a[a.Enter=13]="Enter",a[a.Shift=16]="Shift",a[a.Esc=27]="Esc",a[a.Space=32]="Space",a[a.End=35]="End",a[a.Home=36]="Home",a[a.ArrowLeft=37]="ArrowLeft",a[a.ArrowUp=38]="ArrowUp",a[a.ArrowRight=39]="ArrowRight",a[a.ArrowDown=40]="ArrowDown",a[a.Delete=46]="Delete",a[a.Eight=56]="Eight",a[a.PlaceHolder=229]="PlaceHolder"}(d=b.KeyCode||(b.KeyCode={}))},function(a,b,c){"use strict";function d(a,b){g[a]=b}function e(a){var b=a.Master.Question.Model.Type,c=g[b];if(c)return f.createElement(c,a);throw Error('Type "'+b+'" has not been registered.')}Object.defineProperty(b,"__esModule",{value:!0});var f=c(0);b.registerRendererComponentClass=d,b.createRendererElement=e;var g={};Forms.UX.Renderer.createRendererElement=e},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(3),h=c(51),i=c(45),j=c(1),k=OfficeForm.Exports.Control,l=OfficeForm.Exports.CategoryExtensionPoints,m=OfficeForm.Exports.ExtensionPoints,n=OfficeForm.Exports.FormLimitation,o=OfficeForm.Exports.Models,p=OfficeForm.Exports.QuizRenderer,q=OfficeForm.Exports.Resources,r=OfficeForm.Exports.Utilities,s=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.questionElementRef=f.createRef(),b.videoRatioHeight=9,b.videoRatioWidth=16,b.idPrefix=g.uniqueId("question"),b}return d(b,a),b.prototype.componentWillMount=function(){var a=this;this.update=function(){return a.forceUpdate(function(){var b=a.props.onHeightChange;b&&b()})};var b=this.props.Master;b.Question.Form.observe(this.update,[o.FormMaster.Schema.HasQuestionMedia]),b.observe(this.update),b.Question.observe(this.update);var c=o.ImageInfoMaster.Schema;b.Question.ImageInfoMaster.observe(this.update,[c.ResourceUrl,c.ContentType,c.OriginalFileName]),b.Question.ImageSettingsMaster.observe(this.update)},b.prototype.componentWillUnmount=function(){var a=this.props.Master;a.Question.ImageSettingsMaster.unobserve(this.update),a.Question.ImageInfoMaster.unobserve(this.update),a.Question.unobserve(this.update),a.unobserve(this.update),a.Question.Form.unobserve(this.update)},b.prototype.componentDidMount=function(){var a=$(this.questionElementRef.current),b=a.find(".office-form-question-formula span"),c=a.find(".office-form-question-choice-formula span");a.find("span").not(b).not(c).linkify()},b.prototype.render=function(){var a={className:"__question__ office-form-question",ref:this.questionElementRef};if(this.getValidationStyle()===k.ValidationStyles.Error||p.isWrongQuestion(this.props)){var b=this.props.IsMobile?"office-form-error-question-mobile":"office-form-error-question";a.className=r.Html.combineAttributes(a.className,b)}var c=null;this.isRequiredQuestionError()&&(c=k.createLabel({HTMLAttributes:{className:"validation-error-message-label",role:"alert"},Label:q.LocalizedStrings.Required_Question_Error_Message}));var d={className:"office-form-question-content office-form-theme-focus-border"},g=this.props.HTMLAttributes;g&&(d=r.Html.mergeReactProps(g,d));var h=r.Html.combineAttributes("office-form-question-element",this.isImageLayout()?"with-image":""),i=f.createElement("div",e({},d),this.createWrongResultLabel(),this.createTitleContainer(),f.createElement("div",{className:h},this.createReactNodes()),c),j=this.createFeedbackBox(),l=null;return void 0!==j&&(a.className=r.Html.combineAttributes(a.className,"office-form-studentview-question"),l=f.createElement("div",{className:"office-form-feedback-marginbottom-box"})),f.createElement("div",e({},a),this.createCoAuthorFacePile(),i,j,l)},b.prototype.createWrongResultLabel=function(){return p.createWrongResultLabel(this.props)},b.prototype.createReactNodes=function(){throw Error("to be overridden.")},b.prototype.isRequiredQuestionError=function(){if(!this.props.ShowValidationStyle)return!1;var a=this.props.Master,b=a.Question.verify(a.Model.Answer);return a.SubQuestionRuntimeMasters.forEach(function(a){a.Question.verify(a.Model.Answer)===o.QuestionValidationResult.RequiredError&&(b=o.QuestionValidationResult.RequiredError)}),b===o.QuestionValidationResult.RequiredError},b.prototype.getValidationStyle=function(){if(!this.props.ShowValidationStyle)return k.ValidationStyles.None;var a=this.props.Master,b=a.Question.verify(a.Model.Answer);return a.SubQuestionRuntimeMasters.forEach(function(a){a.Question.verify(a.Model.Answer)===o.QuestionValidationResult.RequiredError&&(b=o.QuestionValidationResult.RequiredError)}),b===o.QuestionValidationResult.Success?k.ValidationStyles.Success:k.ValidationStyles.Error},b.prototype.getQuestionId=function(){return this.idPrefix},b.prototype.getRequiredId=function(){return this.props.Master.Question.Model.Required?this.idPrefix+"-required":void 0},b.prototype.getQuestionTypeId=function(){return this.idPrefix+"-questiontype"},b.prototype.getElementProps=function(a){var b={"aria-describedby":this.getSubtitleId(),"aria-labelledby":r.Html.combineAttributes(this.getOrdinalId(),this.getTitleId(),this.getRequiredId(),this.getQuestionTypeId())};return a?r.Html.mergeReactProps(a,b):b},b.prototype.createFeedbackBox=function(){var a=this.props.Master.SubQuestionRuntimeMasters,b=a[a.length-1],c=b&&b.Model,d=(c||this.props.Master.Model).AnswerEntity,e=d&&d.Feedback;if(!this.props.IsStudentViewMode||!e)return void 0;var g={HTMLAttributes:{className:r.Html.combineAttributes("feedback-icon forms-icon-size16x16",r.isEdge()?"edge":void 0,r.isIE()?"ie":void 0),role:"presentation"},IconName:"Chat"};return f.createElement("div",{className:"office-form-feedback-box"},k.createFontIconControl(g),f.createElement("div",{className:"office-form-feedback-content"},k.createRenderNewlines({content:e})))},b.prototype.createTitleLabel=function(){var a=this.props.Master.Question.Model,b=this.props.Master.Question.Form.Model.HasQuestionMedia,c=a.Title,d=!this.props.HideMedia&&(a.ImageInfo&&a.ImageInfo.ResourceUrl||b)?"office-form-question-title with-image":"office-form-question-title",e=this.props.Master.Question.Form,g=l.supportsExtensionPoint(e,m.ResponsePagePollView),h=!(this.isImageLayout()||g),i={"aria-level":2,className:d,id:this.getTitleId(),role:"heading"},j=a.Required?q.LocalizedStrings.Accessibility_RequiredAnswer:void 0,n=null;j&&(n=f.createElement("div",null,f.createElement("span",{className:"accessibility-reader-no-display",id:this.getRequiredId()},j)));var o=this.createQuestionTypeHint(),r=null;o&&(r=f.createElement("div",null,f.createElement("span",{className:"accessibility-reader-no-display",id:this.getQuestionTypeId()},o)));var s={children:[n,r,p.createQuizPointLabel(this.props)],HTMLAttributes:i,Label:c,Ordinal:this.props.Ordinal,ShowOrdinal:h,ShowRequiredStar:a.Required,Theme:this.props.Theme};return k.createLabel(s)},b.prototype.createQuestionTypeHint=function(){var a=this.props.Master.Question.Model,b=a.Type,c="";switch(b){case o.QuestionType.Choice:c=a.ChoiceType===o.ChoiceType.MultiChoice?q.LocalizedStrings.QuestionType_MultiChoice:q.LocalizedStrings.QuestionType_SingleChoice;break;case o.QuestionType.DateTime:c=q.LocalizedStrings.QuestionType_DateTime;break;case o.QuestionType.Rating:c=q.LocalizedStrings.QuestionType_Rating;break;case o.QuestionType.TextField:c=a.Multiline?q.LocalizedStrings.QuestionType_MultiLineText:q.LocalizedStrings.QuestionType_SingleLineText;break;case o.QuestionType.Ranking:c=q.LocalizedStrings.QuestionType_Ranking;break;case o.QuestionType.MatrixChoiceGroup:c=q.LocalizedStrings.QuestionType_MatrixChoiceGroup}return c},b.prototype.createTitleOrdinal=function(){return f.createElement("div",{className:"office-form-question-ordinal office-form-theme-primary-background"},f.createElement("span",{id:this.getOrdinalId()},this.props.Ordinal))},b.prototype.createTitleContainer=function(){var a,b,c,d=this.props.Master.Question,g=d.Model,h=d.Form.Model.HasQuestionMedia,i={},j="office-form-question-subtitle",l=this.props.IsMobile||r.isSmallScreen()||g.ImageSettings.Layout===o.ImageLayout.Horizontal&&g.ImageSettings.Size===o.ImageSize.Large,m=l||g.VideoInfo&&g.VideoInfo.Url;if(this.props.HideMedia||g.VideoInfo&&g.VideoInfo.Url||!(g.ImageInfo&&g.ImageInfo.ResourceUrl||h||g.ImageInfo.ImageProcessingStatus===o.ImageProcessingStatus.Uploading||g.ImageInfo.ImageProcessingStatus===o.ImageProcessingStatus.Picking)){if(!this.props.HideMedia&&g.VideoInfo&&g.VideoInfo.Url){i.className=r.Html.combineAttributes(i.className,"question-title-container office-form-theme-video-question-background");var p={allowFullScreen:!0,frameBorder:"0",height:this.calcVideoDisplayHeight(),sandbox:"allow-scripts allow-same-origin allow-popups",src:g.VideoInfo.Url,width:"100%"};a=f.createElement("div",{className:"office-form-question-video-container"},f.createElement("iframe",e({},p))),j="office-form-question-subtitle with-video"}}else{i.className="question-title-container office-form-theme-image-question-background",j="office-form-question-subtitle with-image";var q=l?"office-form-question-horizontal-large-image-container office-form-theme-image-container-border":"office-form-question-image-container office-form-theme-image-container-border";if(g.ImageInfo&&g.ImageInfo.ResourceUrl){var s=d.ImageSettingsMaster.validateImageSettings(),t={className:q,style:l?void 0:{width:"{0}px".format(s.ContainerWidth)}},u=OfficeForm.Exports.createImageSpinner(g.ImageInfo);a=f.createElement("div",e({},t),f.createElement(OfficeForm.Exports.ImageRenderer,{Image:d.ImageInfoMaster,ImageSettings:d.ImageSettingsMaster,ImageType:"Question"}),u)}else if(g.ImageInfo.ImageProcessingStatus===o.ImageProcessingStatus.Uploading||g.ImageInfo.ImageProcessingStatus===o.ImageProcessingStatus.Picking){var t={className:q,style:{height:"{0}px".format(n.ImagePlaceHolderHeight),width:"{0}px".format(n.ImagePlaceHolderWidth)}};a=f.createElement("div",e({},t),OfficeForm.Exports.createImageSpinner())}}if(this.isSubtitleLayout())if(g.IsMathQuiz&&!g.IsPlainTextInMathField){var v=k.createFormulaRenderer({DisableLinebreaks:this.props.DisableFormulaLinebreak,Formula:g.Subtitle,onRenderComplete:this.props.onHeightChange});b=f.createElement("div",{className:"office-form-question-formula"},v)}else c=k.createLabel({HTMLAttributes:{className:j,id:this.getSubtitleId()},Label:g.Subtitle});return f.createElement("div",{className:"question-title-box"},f.createElement("div",e({},i),m?void 0:a,this.isImageLayout()?this.createTitleOrdinal():void 0,this.createTitleLabel(),c,m?a:void 0,b))},b.prototype.createCoAuthorFacePile=function(){var a,b=this,c=this.props.Master.Question.Model,d=c.CoAuthors&&c.CoAuthors.length>0;return d?c.CoAuthors[c.CoAuthors.length-1].userId!==OfficeFormServerInfo.userInfo.UserId&&(a=g.map(c.CoAuthors,function(a){if(a.userId!==OfficeFormServerInfo.userInfo.UserId){var c={ariaLabel:q.LocalizedStrings.DesignPage_NavBar_CoAuthor_Screen_Reader.format(a.displayName||a.userId,b.props.Ordinal),displayText:i.getDisplayText(a.firstName||"",a.lastName||""),email:a.email,isCoAuthUser:!0,key:a.userId,name:a.displayName,tooltip:a.displayName||a.userId};return f.createElement(h.AuthorFacePile,e({},c))}})):a=void 0,f.createElement("div",{className:"question-coAuthor-notification-container-render-mode","aria-live":"polite"},a)},b.prototype.calcVideoDisplayHeight=function(){if(r.isMobile()){var a=$(window).width();return 0===a&&(a=document.body.scrollWidth),a/(this.videoRatioWidth/this.videoRatioHeight)}return n.DefaultVideoHeight},b.prototype.getOrdinalId=function(){return this.isImageLayout()?this.idPrefix+"-ordinal":void 0},b.prototype.getTitleId=function(){return this.idPrefix+"-title"},b.prototype.getSubtitleId=function(){return this.isSubtitleLayout()?this.idPrefix+"-subtitle":void 0},b.prototype.isImageLayout=function(){var a=this.props.Master.Question.Form.Model.HasQuestionMedia;return a&&!this.props.HideMedia},b.prototype.isSubtitleLayout=function(){var a=this.props.Master.Question.Model;return a.ShowSubtitle&&!!a.Subtitle},b}(j.ReactComponent);b.QuestionRendererBase=s},function(a,b,c){"use strict";function d(){return Forms.Common.getCurrentFormId()}function e(){var a=Forms.Common.getCurrentFormId();return a&&g.decodeFormId(a)}Object.defineProperty(b,"__esModule",{value:!0});var f=OfficeForm.Exports.EnvironmentConfig,g=OfficeForm.Exports.Utilities.FormId,h=null,i=null;Forms.Common.setFormIdGetter=function(a){return h=a},Forms.Common.getCurrentFormId=function(){return h&&h()},Forms.Common.setFormGetter=function(a){return i=a},Forms.Common.getCurrentForm=function(){return i&&i()},Forms.Common.isOwnerMsftUser=function(){var a=g.decodeFormId(Forms.Common.getCurrentFormId()||"");return!!a.OrgId&&a.OrgId.toLowerCase()===f.getMsftTenantId()},Forms.Common.isOwnerMsaUser=function(){var a=g.decodeFormId(Forms.Common.getCurrentFormId()||"");return!!a.OrgId&&a.OrgId.toLowerCase()===f.getMsaTenantId()},Forms.Common.isOwnerOnFastFoodTenant=function(){var a=g.decodeFormId(Forms.Common.getCurrentFormId()||"");return!!a.OrgId&&-1!==f.getFastFoodTenantsId().indexOf(a.OrgId.toLowerCase())},b.getCurrentFormId=d,b.getCurrentFormIdObj=e},function(a,b,c){"use strict";function d(){r.Flight.isEnabled(r.Flights.UseRefactoredTelemetry)?(W.initialize(),n.beforeLeavingPage(f)):(OfficeForm.Exports.Telemetry.deprecatedInitializeTelemetry(),n.beforeLeavingPage(OfficeForm.Exports.Telemetry.flushLogs))}function e(){return W&&W.SessionId}function f(){var a=$.Deferred();return W?W.flush(function(){return a.resolve()}):a.resolve(),a.promise()}function g(){var a=o.GetHostString();if(a)return a;var b="origin",c=q.Html.getQueries()[b];if(c)return c;b="oembedsso";var d=q.Html.getQueries()[b];return d?"Forms WebPart":q.Flight.isPPTIntegration()?"PowerPoint":null}function h(){var a=p.getEnvironmentType();switch(a){case"Int":return"Int";case"EDog":return"PreProd";case"WWProd":case"USGovProd":return"Prod";default:return"DevEnv"}}function i(a){return isNaN(a)?"0":a.toString()}function j(){var a=p.getPageType();switch(a){case"Design":return U.Designer;case"Response":return U.Responder;case"Analyze":return U.AnalyzeViewer;case"TeamsConfig":return U.TeamsConfigUser;default:return U.Unknown}}function k(){var a=p.getEnvironmentType();switch(a){case"Int":return L;case"EDog":return M;case"WWProd":return t.FeaturePlanProvider.isMsaUser()||Forms.Common.isOwnerMsaUser()?O:N;case"USGovGccProd":return P;case"USGovProd":return Q;case"USDoDProd":return R;default:return K}}Object.defineProperty(b,"__esModule",{value:!0});var l,m=c(15),n=c(5),o=OfficeForm.Exports.EnvironmentSettings,p=OfficeForm.Exports.EnvironmentConfig,q=OfficeForm.Exports.Utilities,r=OfficeForm.Exports.Flighting,s=OfficeForm.Exports.Muid,t=OfficeForm.Exports.DataProvider,u="Office Forms BrowserApp",v="source_application",w="session_id",x="user_id",y="user_tenant_id",z="user_role",A="user_type",B="form_id",C="event_name",D="event_correlation_id",E="timestamp",F="duration",G="properties",H="UserInfo.Id",I="UserInfo.IdType",J="UserInfo.OMSTenantId",K="e132e188c609439ab47cd7b06511fc0a-433f81b3-fab9-415a-882a-ba9e2f91abea-6917",L="79beea9c4fdb49a5adab4843729e1fa0-19b42cd4-5bd4-4bf8-8e49-05dc0f7f97f8-7484",M="725da52713e94a7f8c04e11418b8378d-67b7892c-33c8-439c-a03e-bd0305e0bc8e-6732",N="2ddc7e5f54754fc68f3ae1c5b7f3eb20-1883aa8c-4c7b-42d1-b3d6-c9cdb5956783-7092",O="5f4ebf0f9a11474199e89f94bc7e2f50-61b8420a-22b1-4220-b531-4a4b96e4edb9-7406",P="aa96061debfd4ec7b9704f62060b4ca6-a498d428-fdba-43da-bc8b-4fe51865cb7f-7984",Q="577e32a3275e48c5a639a92c9a8af033-4028cb75-b5f4-4ad0-835e-0e26d79ff209-6823",R="291cebec6b9a4cbf9489bc8cf3a0cc50-06f4c682-bd49-4f88-a8c2-ac582180b7f9-7725",S="MUID",T="IntelligenceStatistic";!function(a){a[a.Unknown=0]="Unknown",a[a.Edu=1]="Edu",a[a.Biz=2]="Biz",a[a.MsaFree=4]="MsaFree",a[a.MSIT=8]="MSIT",a[a.MsaPaid=16]="MsaPaid",a[a.FastFood=32]="FastFood"}(l||(l={}));var U;!function(a){a[a.Designer=0]="Designer",a[a.Responder=1]="Responder",a[a.Unknown=2]="Unknown",a[a.AnalyzeViewer=3]="AnalyzeViewer",a[a.TeamsConfigUser=4]="TeamsConfigUser"}(U||(U={})),b.initializeTelemetry=d,b.getCurrentSessionId=e,b.flushLogs=f,b.getOrigin=g;var V=function(){function a(){this.sessionId=q.Guid.newGuid(),this.sessionDbId="",this.sessionDeviceId="",this.initialized=!1}return a.logData=function(b){a.BUFFER.queue(b)},Object.defineProperty(a.prototype,"SessionId",{get:function(){return this.sessionId},enumerable:!0,configurable:!0}),a.prototype.flush=function(a){this.initialized?AWTLogManager.flush(a):a()},a.prototype.initialize=function(){var b=this;r.Flight.isEnabled(r.Flights.UseRefactoredTelemetry)&&(r.Flight.isEnabled(r.Flights.EnableMuidForAnonymousUsers)&&s.Instance.ensureMuid(),this.msaTenantIdInUpperCase=p.getMsaTenantId().toUpperCase(),this.userRole=j(),this.userType=l.Unknown,p.isOsi()&&"OneNoteUwp"!==g()&&t.FeaturePlanProvider.getUserType().done(function(a){return b.userType=a}).always(function(){var c={disableCookiesUsage:!0};switch(p.getEnvironmentType()){case"USGovProd":c.collectorUri="https://tb.pipe.aria.microsoft.com/Collector/3.0";break;case"USDoDProd":c.collectorUri="https://pf.pipe.aria.microsoft.com/Collector/3.0"}var d=k();AWTLogManager.initialize(d,c),b.initialized=!0,b.logger=AWTLogManager.getLogger(d),a.BUFFER.setFunctionToCall(b.logEvent.bind(b))}))},a.prototype.logEvent=function(a){"session_start"===a.eventType&&this.enrichSessionInfo(a),this.logEventWorker(a)},a.prototype.enrichSessionInfo=function(a){if(a.properties){var b=JSON.parse(a.properties);b&&(this.sessionDbId=b.DbId,this.sessionDeviceId=b.DeviceId)}var c={BuildVersion:OfficeFormServerInfo.version,DbId:this.sessionDbId,DeviceId:this.sessionDeviceId,IsMobile:q.isMobile(),JQueryLoaded:!!window.$,SessionRing:h(),SessionUrlPath:window.location.origin+window.location.pathname,UserAgent:navigator.userAgent},d=g();d&&(c.Origin=d),a.eventName=a.eventType,a.duration=0,a.properties=JSON.stringify(c),a.timeStamp=q.DateTime.getTimeStamp()},a.prototype.logEventWorker=function(a){var b=new AWTEventProperties;b.setName(a.eventType),b.setProperty(C,a.eventName),b.setProperty(D,a.eventCorrelationId),b.setProperty(F,i(a.duration)),b.setProperty(E,i(a.timeStamp)),b.setProperty(G,a.properties),a.eventName&&a.eventName.indexOf(T)>=0?this.sendSingleTelemetryEventWithoutUserInfo(b):this.sendSingleTelemetryEvent(b)},a.prototype.sendSingleTelemetryEventWithoutUserInfo=function(a){a.setProperty(v,u),a.setProperty(z,this.userRole),a.setProperty(A,this.userType),this.logger.logEvent(a)},a.prototype.sendSingleTelemetryEvent=function(a){var b=OfficeFormServerInfo.userInfo.UserId,c=OfficeFormServerInfo.userInfo.TenantId,d=Forms.Common.getCurrentFormId();if(d&&a.setProperty(B,d),a.setProperty(v,u),a.setProperty(x,b),a.setProperty(y,c),a.setProperty(z,this.userRole),a.setProperty(A,this.userType),a.setProperty(w,this.sessionId),c)if(c.toUpperCase()===this.msaTenantIdInUpperCase){var e=OfficeFormServerInfo.userInfo.PUID;a.setProperty(H,e),a.setProperty(I,"MSAPUID")}else a.setProperty(H,b),a.setProperty(I,"UserObjectId"),a.setProperty(J,c);else!b&&r.Flight.isEnabled(r.Flights.EnableMuidForAnonymousUsers)&&a.setProperty(S,s.Instance.Muid);this.logger.logEvent(a)},a.BUFFER=new m.BufferForCall,a}();b.Telemetry=V;var W=new V},function(a,b,c){"use strict";function d(a){if(f)throw Error("PageContext has already been initialized.");f=new i(a)}function e(){return void 0===f&&d({authenticators:[]}),f}Object.defineProperty(b,"__esModule",{value:!0});var f,g=c(17),h=c(10);b.initializePageContext=d,b.getPageContext=e;var i=function(){function a(a){this.authProvider=new g.AuthProvider(a.authenticators)}return Object.defineProperty(a.prototype,"AuthContext",{get:function(){return this.authProvider},enumerable:!0,configurable:!0}),a.prototype.getPrivacyUrl=function(){var a=h.getCurrentFormIdObj();return OfficeForm.Exports.DataProvider.createDataProvider().getPrivacySettings(a&&a.OrgId,OfficeFormServerInfo.userInfo.TenantId).then(function(a){return a&&a.privacyUrl})},a}();Forms.getPageContext=e},function(a,b,c){"use strict";function d(a){return a.map(f)}function e(a,b,c){var d=o.FieldsForCreatingForm.map(n.getFieldSchemaInfo).map(function(a){return a.Name});a=m.pick(a,d);var e=new o(p.DesignTimeForm,{ExistingInDataSource:!1,InitialData:a},"Group"===b,c);return r[e.getInstanceId()]=e,e.fieldsReady([o.Schema.Id]).done(function(){q[e.Model.Id]=e}),s.trigger(e),e}function f(a){var b=q[a.Id];if(b){var c=n.convertToSourceData(a,o.Schema);return b.Synchronizer.onSourceDataReceived(c),b}var d=OfficeForm.Exports.Utilities.FormId.decodeFormId(a.Id);return a=m.clone(a),a.OwnerId=d.OwnerId,a.OwnerTenantId=d.OrgId,a.TableId=d.TableId,b=new o(p.DesignTimeForm,{ExistingInDataSource:!0,InitialData:a},d.IsGroupOwner),r[b.getInstanceId()]=b,q[a.Id]=b,s.trigger(b),b}function g(a){return r[a]}function h(a){var b=OfficeForm.Exports.Utilities.FormId.decodeFormId(a);return new o(p.ResponseTimeForm,{ExistingInDataSource:!0,InitialData:{Id:a,OwnerId:b.OwnerId,OwnerTenantId:b.OrgId,TableId:b.TableId}},b.IsGroupOwner)}function i(a){var b=OfficeForm.Exports.Utilities.FormId.decodeFormId(a);return new o(p.SharedTimeForm,{ExistingInDataSource:!0,InitialData:{Id:a,OwnerId:b.OwnerId,OwnerTenantId:b.OrgId,TableId:b.TableId}},b.IsGroupOwner)}function j(a){var b=OfficeForm.Exports.Utilities.FormId.decodeFormId(a);return new o(p.AnalysisTimeForm,{ExistingInDataSource:!0,InitialData:{Id:a,OwnerId:b.OwnerId,OwnerTenantId:b.OrgId,TableId:b.TableId}},b.IsGroupOwner)}function k(a){return new o(p.LocalForm,{InitialData:a},!1)}function l(a){s.register(a)}Object.defineProperty(b,"__esModule",{value:!0});var m=c(3),n=c(4);c(39);var o=OfficeForm.Exports.Models.FormMaster,p=OfficeForm.Exports.Models.FormSyncContext,q={},r={},s=new OfficeForm.Exports.Utilities.Process.CallbackManager;
b.getDesignFormMasters=d,b.createNewFormMaster=e,b.getDesignFormMaster=f,b.getFormMasterByInstanceId=g,b.createResponseFormMaster=h,b.createSharedFormMaster=i,b.createAnalysisFormMaster=j,b.createLocalFormMaster=k;var t=Forms.Models.FormManager;t.createNewFormMaster=e,t.getDesignFormMaster=f,t.onFormMasterCreated=l},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(3),e=c(2),f=OfficeForm.Exports.Utilities,g=OfficeForm.Exports.Flighting,h=OfficeForm.Exports.Event,i=function(){function a(a){g.Flight.isEnabled(g.Flights.UseRefactoredTelemetry)?(this.eventData={correlationId:f.Guid.newGuid(),duration:0,eventName:a,eventType:"qos_event",extraData:void 0},this.startTime=null):this.qos=new h.QosEventDeprecated(a)}return Object.defineProperty(a.prototype,"CorrelationId",{get:function(){return this.qos?this.qos.CorrelationId:this.eventData.correlationId},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ExtraData",{get:function(){return this.eventData.extraData},enumerable:!0,configurable:!0}),a.prototype.start=function(){if(this.qos)this.qos.start();else{this.startTime=f.DateTime.getTimeStamp();var a=this.prepareEvent(this.eventData,"Start");e.log(a)}},a.prototype.end=function(a){if(this.qos)this.qos.end({extraData:a.extraData,resultCode:a.resultCode,resultType:a.resultType});else{var b=this.prepareEvent(a,"End");e.log(b)}},a.prototype.log=function(a){var b=this.prepareEvent(a,"Log");e.log(b)},a.prototype.prepareEvent=function(a,b){var c=d.clone(this.eventData);switch(null!==this.startTime&&"Start"!==b&&(c.duration=f.DateTime.getTimeStamp()-this.startTime),a.logLevel&&(c.logLevel=a.logLevel),a.extraData&&(c.extraData=a.extraData),b){case"Start":c.eventName+="."+b;break;case"Log":c.eventName+="."+b,a.resultCode&&(c.eventName+="."+a.resultCode);break;case"End":a.resultType&&(c.eventName+="."+a.resultType)}return c},a}();b.QosEvent=i,Forms.Telemetry.QosEvent=i},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){this.buffer=[]}return a.prototype.setFunctionToCall=function(a){var b=this;if(this.functionToCall!==a)if(this.functionToCall=a,a){var c=this.buffer;delete this.buffer,c&&c.length&&c.forEach(function(a){return b.functionToCall.apply(void 0,a)})}else this.buffer=this.buffer||[]},Object.defineProperty(a.prototype,"queue",{get:function(){return this.functionToCall?this.functionToCall:this.defaultQueue},enumerable:!0,configurable:!0}),a.prototype.defaultQueue=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this.buffer.push(a)},a}();b.BufferForCall=d},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),c(2),c(14)},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(3),e=c(18),f=function(){function a(a){this.validAuthenticator=null,this.userInfo=null,OfficeFormServerInfo.isAuthV2Enabled?this.authenticators=a.concat():this.authenticators=[new e.DeprecatedAuthenticator]}return a.prototype.ensureSignIn=function(){var a=this;return this.signInPromise||(this.signInPromise=$.when(this.signOutPromise).then(function(){var b=function(c){var e=a.authenticators[c];return e?e.signIn().then(function(b){return a.userInfo=d.clone(b||null),a.validAuthenticator=e,b},function(){return b(c+1)}):$.Deferred().reject(new Error("Sign in failed.")).promise()};return b(0)})),this.signInPromise},a.prototype.getCurrentUser=function(){return this.userInfo},a.prototype.getFormApiToken=function(){var a=this;return this.ensureSignIn().then(function(){return a.validAuthenticator&&a.validAuthenticator.getFormApiToken()})},a.prototype.getSignInState=function(){return this.signInPromise?this.signInPromise.state():"not started"},a.prototype.signOut=function(){if(this.signOutPromise)return this.signOutPromise;if(!this.signInPromise)return $.Deferred().resolve().promise();var a=this.signInPromise,b=this.validAuthenticator;return this.signInPromise=void 0,this.validAuthenticator=null,this.userInfo=null,this.signOutPromise=a.then(function(){return b.signOut()}),this.signOutPromise},a}();b.AuthProvider=f},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(19),e=function(){function a(){this.tokenGetter=new d.TokenGetter}return a.prototype.getFormApiToken=function(){var a=OfficeForm.Exports.Authenticator.AuthContext;return this.tokenGetter.getToken(a)},a.prototype.signIn=function(){return $.Deferred().resolve().promise()},a.prototype.signOut=function(){throw new Error("Method not implemented.")},a}();b.DeprecatedAuthenticator=e},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(2),e=c(5),f=c(20),g=OfficeForm.Exports.Utilities,h=OfficeForm.Exports.Flighting,i=OfficeForm.Exports.AddinAuth,j=OfficeForm.Exports.EnvironmentConfig,k=function(){function a(){this.waitHostAccessTokenRetryCount=0}return a.prototype.getToken=function(b){var c=this;return g.Flight.isOembedTrialSSOEnabled()||g.Flight.isPPTContentAddinSSOEnabled()||g.Flight.isStreamSSOEnabled()?(a.getAccessTokenFromHostHandler||(a.getAccessTokenFromHostHandler=$.Deferred()),!a.shouldMemoryCachedTokenCheckBeSkipped()&&a.AccessTokenFromHost&&a.AccessTokenFromHost.isAccessTokenFromHostValid()?(a.getAccessTokenFromHostHandler.resolve(a.AccessTokenFromHost.AccessToken),a.getAccessTokenFromHostHandler.promise()):(("resolved"===a.getAccessTokenFromHostHandler.state()||"rejected"===a.getAccessTokenFromHostHandler.state())&&(a.getAccessTokenFromHostHandler=$.Deferred()),a.getAccessTokenFromHost(),this.waitHostAccessTokenRetryCount=0,this.waitForAccessToken(),a.getAccessTokenFromHostHandler.promise())):g.enterSSO()?i.getAddinAccessToken().then(null,function(a){return c.getTokenInternal(b)}):this.getTokenInternal(b)},a.shouldMemoryCachedTokenCheckBeSkipped=function(){return g.Flight.isPPTContentAddinSSOEnabled()||g.Flight.isStreamSSOEnabled()},a.getAccessTokenFromHost=function(){a.AccessTokenFromHost=null,window.addEventListener("message",a.receiveAccessToken,!1),window.parent.postMessage("GetAccessTokenFromHost","*")},a.receiveAccessToken=function(b){if(b.data.startsWith("FormsAccessTokenFromHost:"))try{var c="FormsAccessTokenFromHost:Bearer ",d=b.data.indexOf(c);if(-1!=d){var e=b.data.substring(d+c.length);a.AccessTokenFromHost=new l(e)}}finally{window.removeEventListener("message",a.receiveAccessToken,!1)}},a.prototype.getTokenInternal=function(b){var c=this,i=$.Deferred();if(h.Flight.isEnabled(h.Flights.CookieAuth))return i.resolve(null),i.promise();var k=b.getCachedUser();return k?(b.acquireToken(j.getFormsResourceId(),function(h,k){if(!h&&k)return c.lastAcquireTokenSuccessTime=new Date,void i.resolve(k);var l=b.getCachedToken(j.getAadClientId());if(!l){if(c.lastAcquireTokenSuccessTime){var m=(new Date).getTime()-c.lastAcquireTokenSuccessTime.getTime();d.log({eventName:"Auth.AcquireTokenIdleTime",eventType:"engagement_event",extraData:{error:h,idleTimeInMinutes:m/6e4}})}return b.clearCache(),void e.reloadPage()}if(b.clearCache(),h.match("^AADSTS50079:")){d.log({eventName:"AADAcquireTokenMfaCheckFailure",eventType:"error_event",extraData:h});var n=new Error;return n.name=OfficeForm.Exports.ClientErrorNames.AADAcquireTokenMfaCheckError,n.message=h,void i.reject(n)}if(!h.match("^AADSTS50058:")){d.log({eventName:"AADAcquireTokenFailure",eventType:"error_event",extraData:h});var n=new Error;return n.name=OfficeForm.Exports.ClientErrorNames.AADAcquireTokenError,n.message=h,void i.reject(n)}if(g.isIE()||g.isEdge()){var o=f.AuthRelatedLocalStorage.UseLegacyLoginDomain;if(d.log({eventName:"LoginIECrossZone",eventType:"error_event",extraData:{useLegacyLoginDomain:!!o}}),f.AuthRelatedLocalStorage.UseLegacyLoginDomain)f.AuthRelatedLocalStorage.UseLegacyLoginDomain=!1;else if(f.AuthRelatedLocalStorage.isSupported())return f.AuthRelatedLocalStorage.UseLegacyLoginDomain=!0,void e.reloadPage()}else d.log({eventName:"AADAcquireTokenFailure",eventType:"error_event",extraData:h});a.getThirdPartyCookieError(h).done(function(a){return i.reject(a)})}),i.promise()):(i.resolve(null),i.promise())},a.getThirdPartyCookieError=function(b){var c=$.Deferred();return a.detectThirdPartyCookieSupport(function(a){d.log({eventName:"Auth.ThirdPartyCookieSupport",eventType:"engagement_event",extraData:{allow:a}});var e=new Error(b);a?e.name=OfficeForm.Exports.ClientErrorNames.LoginIECrossZoneError:e.name=OfficeForm.Exports.ClientErrorNames.ThirdPartyCookieBlockedError,c.resolve(e)}),c.promise()},a.detectThirdPartyCookieSupport=function(a){var b=function(c){"TPC:NotSupported"===c.data?(a(!1),window.removeEventListener("message",b)):"TPC:Supported"===c.data&&(a(!0),window.removeEventListener("message",b))};window.addEventListener("message",b,!1);var c="https://controls.officeppe.com/thirdpartycookie/check.html";$("body").append('<iframe id="detectThirdPartyCookieFrame" style="display:none;" src='+c+"><iframe>")},a.prototype.waitForAccessToken=function(){var b=this;if(null!=a.AccessTokenFromHost){var c=a.AccessTokenFromHost.AccessToken;i.refreshInfo(c).always(function(){return a.getAccessTokenFromHostHandler.resolve(c)})}else this.waitHostAccessTokenRetryCount<10?(this.waitHostAccessTokenRetryCount++,setTimeout(function(){return b.waitForAccessToken()},1e3)):(this.waitHostAccessTokenRetryCount=0,a.getAccessTokenFromHostHandler.resolve(null))},a.AccessTokenFromHost=null,a}();b.TokenGetter=k;var l=function(){function a(a){this.accessToken=a;var b=33e5;this.tokenExpireTime=(new Date).getTime()+b}return Object.defineProperty(a.prototype,"AccessToken",{get:function(){return this.accessToken},enumerable:!0,configurable:!0}),a.prototype.isAccessTokenFromHostValid=function(){return!!this.accessToken&&(new Date).getTime()<this.tokenExpireTime},a}()},function(a,b,c){"use strict";function d(a){return h.LocalStorage.getItem(a)}function e(a,b){b?h.LocalStorage.setItem(a,b):h.LocalStorage.removeItem(i)}function f(a){var b=h.LocalStorage,c=a+n,d=b.getItem(c),e=d&&JSON.parse(d);if(!e||Date.now()>e)return b.removeItem(c),b.removeItem(a),null;var f=b.getItem(a);return f&&JSON.parse(f)}function g(a,b,c){var d=a+n,e=h.LocalStorage;b?(e.setItem(d,JSON.stringify(Date.now()+c)),e.setItem(a,JSON.stringify(b))):(e.removeItem(d),e.removeItem(a))}Object.defineProperty(b,"__esModule",{value:!0});var h=OfficeForm.Exports.SafeStorage,i="officeforms.uselegacylogindomain",j="officeforms.userAccountNameKey",k="officeforms.auth.detectAADInProgress",l="officeforms.auth.detectAADResult",m=function(){function a(){}return a.isSupported=function(){return h.supportsLocalStorage()},Object.defineProperty(a,"DetectAADInProgress",{get:function(){return f(k)},set:function(a){var b=5e3;g(k,a,b)},enumerable:!0,configurable:!0}),Object.defineProperty(a,"DetectAADResult",{get:function(){return"true"===d(l)},set:function(a){e(l,a?"true":null)},enumerable:!0,configurable:!0}),Object.defineProperty(a,"UseLegacyLoginDomain",{get:function(){return!!d(i)},set:function(a){e(i,a?"1":null)},enumerable:!0,configurable:!0}),Object.defineProperty(a,"UserAccountName",{get:function(){var a=d(j);return a&&JSON.parse(a)},set:function(a){e(j,a?JSON.stringify(a):null)},enumerable:!0,configurable:!0}),a}();b.AuthRelatedLocalStorage=m;var n=".timestamp";Forms.AuthRelatedLocalStorage=m},function(a,b,c){"use strict";function d(a){h[a]||(h[a]=!0,e.log({eventName:"Flight."+g[a]+"."+(f.Flight.isEnabled(a)?"Enabled":"Disabled"),eventType:"engagement_event"}))}Object.defineProperty(b,"__esModule",{value:!0});var e=c(2),f=OfficeForm.Exports.Flighting,g=f.Flights,h={};b.logFlightStatus=d,Forms.Common.logFlightStatus=d},function(a,b,c){"use strict";function d(a){for(var b=0,c=l;b<c.length;b++){var d=c[b],e=d(a);if(e)return e}throw Error("Not supported")}function e(a){l.push(a)}function f(a){var b=$.Deferred(),c=new FileReader;return c.readAsDataURL(a),c.onloadend=function(a){return b.resolve(c.result)},c.onerror=function(a){return b.reject(a.error)},b.promise()}var g=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var h=c(4),i=h.Spec,j={height:i.number(),id:i.string({IsKeyField:!0}),value:i.reference(),width:i.number()},k=function(a){function b(){return a.call(this,{ExistingInDataSource:!0})||this}return g(b,a),b.prototype.getUrl=function(){var a=this;return this.urlJob||(this.urlJob=this.ensureFieldsReady([this.Schema.value]).then(function(){return f(a.Model.value)})),this.urlJob},b}(h.createObjectMasterClass("PhotoMaster",j,d));b.PhotoMaster=k,b.registerDataSourceFactory=e;var l=[]},function(a,b,c){"use strict";function d(a,b){g[a]=b}function e(a){var b=a.Master.Model.Type,c=g[b];if(c)return f.createElement(c,a);throw Error('Type "'+b+'" has not been registered.')}Object.defineProperty(b,"__esModule",{value:!0});var f=c(0);b.registerDesignerComponentClass=d,b.createDesignerElement=e;var g={};Forms.UX.Designer.createDesignerElement=e},function(a,b,c){"use strict";function d(a){var b=a.Model;if(b.IsQuiz){var c=s.createTextField({HTMLAttributes:{className:"design-quiz-point-box"},onValueChange:function(a){if(""===a)b.Point=null;else{var c=Math.floor(Number(a));!isNaN(c)&&c>=0&&100>=c&&(b.Point=c)}k.log({eventName:t.DesignPage.Quiz.Point,eventType:"engagement_event",extraData:{Point:b.Point,QuestionId:b.Id,Value:b.Type}})},Options:{HTMLPropsForInnerElement:{"aria-label":w.LocalizedStrings.Quiz_Points_Text,className:"design-quiz-point-box-input"}},Value:null==b.Point?"":b.Point.toString()});return g.createElement("div",{className:"design-quiz-point-bar"},g.createElement("div",{className:"design-quiz-point-label"},w.LocalizedStrings.Quiz_Points_Text+":"),c)}}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),f=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var g=c(0),h=c(6),i=c(3),j=c(61),k=c(2),l=c(51),m=c(45),n=c(1),o=c(150),p=OfficeForm.Exports.Models,q=p.ChoiceType,r=p.ImageErrorType,s=OfficeForm.Exports.Control,t=OfficeForm.Exports.EngagementEventNames,u=OfficeForm.Exports.DesignPage,v=OfficeForm.Exports.Utilities,w=OfficeForm.Exports.Resources,x=OfficeForm.Exports.FormLimitation,y=OfficeForm.Exports.FlexPane,z=OfficeForm.Exports.Flighting;b.titleElementIndex=-1,b.otherElementIndex=-2,b.otherChoiceElementIndex=-3,b.subtitleElementIndex=-4,b.moveUpElementIndex=-5,b.moveDownElementIndex=-6;var A=1.7777777777777777,B=function(a){function c(c){var d=a.call(this,c)||this;d.updateCallbacks=[],d.refMapping={},d.update=function(){return d.forceUpdateWrapper()},d.onExecuteForSubtitleItem=d.onExecuteForSubtitleItem.bind(d),d.onTitleValueChangeIntenal=d.onTitleValueChangeIntenal.bind(d),d.handleMoveUp=d.handleMoveUp.bind(d),d.handleMoveDown=d.handleMoveDown.bind(d);var e={SelectedElementIndex:b.titleElementIndex};return d.state=e,d}return e(c,a),c.prototype.componentWillMount=function(){var a=i.without(Nerve.getSubFieldSchemas(p.QuestionMaster.Schema),p.QuestionMaster.Schema.Order);this.props.Master.observe(this.update,a)},c.prototype.componentDidMount=function(){this.updateMovingButtonStatus()},c.prototype.componentDidUpdate=function(){this.updateMovingButtonStatus()},c.prototype.componentWillUnmount=function(){if(this.props.Master.Model.Title=this.props.Master.Model.Title.replace(/\s*$/,""),z.Flight.isEnabled(z.Flights.UpgradeUxStateModel)){var a=j.getUxStateMaster().Model;"ImagePicker"===a.FlexPane&&(a.FlexPane="None")}else u.hideImagePicker();this.props.Master.unobserve(this.update)},c.prototype.render=function(){var a=i.extend({},this.props.HTMLAttributes);return a.className=v.Html.combineAttributes(a.className,"__question-designer__","office-form-question-designer office-form-theme-focus-border office-form-theme-border-top"),a.onTouchStart=a.onTouchStart||function(){},g.createElement("div",f({},a),this.createCoAuthorContainer(),this.createTitleBar(),this.createSubtitle(),this.createSuggestionBar(),this.createReactNodes(),g.createElement("hr",{"aria-hidden":!0,className:"design-question-hr"}),this.createBottomBar(),this.createActionBar())},c.prototype.createReactNodes=function(){throw Error("to be overridden.")},c.prototype.createSuggestionBar=function(){return null},c.prototype.createMathBar=function(){return null},c.prototype.getElementFocusingProps=function(a){var c=this;return{onBlur:function(d){var e=c.getElementRef(a).current,f=v.Html.getTargetElementOfFocusEvent(d);c.state.SelectedElementIndex!==a||e&&f&&e.contains(f)||c.setState({SelectedElementIndex:b.otherElementIndex})},onFocus:function(){c.setState({SelectedElementIndex:a})}}},c.prototype.getElementRef=function(a){var c;switch(a){case b.titleElementIndex:c="title";break;case b.otherElementIndex:c="other";break;case b.subtitleElementIndex:c="subtitle";break;case b.moveUpElementIndex:c="move-up";break;case b.moveDownElementIndex:c="move-down";break;default:c="element"+a}return this.refMapping[c]||(this.refMapping[c]=g.createRef()),this.refMapping[c]},c.prototype.onTitleValueChange=function(){},c.prototype.createValidationItem=function(){return null},c.prototype.createMoreMenuItems=function(){var a=this.props.Master.Model,b={Checked:a.ShowSubtitle,Description:w.LocalizedStrings.Designer_MenuItemForSubtitle,Key:"subtitleItem",MenuItemType:s.MenuItemType.CheckBox,onExecute:this.onExecuteForSubtitleItem},c=[b];return c},c.prototype.onUpdateDone=function(a){this.updateCallbacks.push(a)},c.prototype.setFocusToTitleElement=function(){this.setState({SelectedElementIndex:b.titleElementIndex});var a=h.findDOMNode(this.getElementRef(b.titleElementIndex).current);a&&$(a).find("textarea").focus()},c.prototype.onTitleValueChangeIntenal=function(a){this.props.Master.bulkEdit(function(b){b.Title=a,z.Flight.isEnabled(z.Flights.QuestionTagForIntelligence)&&(b.QuestionTagForIntelligence="Unknown",b.IsFromSuggestion=!1)}),this.onTitleValueChange()},c.prototype.onExecuteForSubtitleItem=function(){var a=this,c=this.props.Master.Model;k.log({eventName:t.DesignPage.QuestionMenu.Subtitle,eventType:"engagement_event",extraData:{questionId:c.Id,questionType:c.Type,value:!c.ShowSubtitle}}),c.ShowSubtitle||this.onUpdateDone(function(){var c=h.findDOMNode(a.getElementRef(b.subtitleElementIndex).current);$(c).find(":focusable").focus()}),c.ShowSubtitle=!c.ShowSubtitle},c.prototype.createCoAuthorContainer=function(){var a,b=this,c=this.props.Master.Model,d=c.CoAuthors&&c.CoAuthors.length>0;return d?a=c.CoAuthors[c.CoAuthors.length-1].userId===OfficeFormServerInfo.userInfo.UserId?void 0:g.createElement("div",{className:"question-coAuthor-notification-container-design-mode"},i.map(c.CoAuthors,function(a){return b.createAuthorFacePile(a)})):void 0},c.prototype.createAuthorFacePile=function(a){if(a.userId!==OfficeFormServerInfo.userInfo.UserId){var b=w.LocalizedStrings.DesignPage_NavBar_CoAuthor_Screen_Reader.format(a.displayName||a.userId,this.props.Ordinal);return g.createElement(l.AuthorFacePile,{ariaLabel:b,displayText:m.getDisplayText(a.firstName,a.lastName),email:a.email,key:a.userId,name:a.displayName,tooltip:a.displayName||a.userId})}},c.prototype.createActionBar=function(){var a,d=this,e=this.props.Master,f=e.Model;a=e.Form.reachedQuestionNumberLimitation()?c.createActionBarButton(w.LocalizedStrings.DesignPage_LimitMessage_QuestionNumber,"Copy","forms-icon-size16x16",function(){}):c.createActionBarButton(w.LocalizedStrings.Designer_ActionBar_Duplicate,"Copy","forms-icon-size16x16",function(){var a=e.Form.duplicateElement(e);d.props.setQuestionInDesignMode(a),k.log({eventName:t.DesignPage.Questions.Duplicate,eventType:"engagement_event",extraData:{questionType:f.Type}})});var h=c.createActionBarButton(w.LocalizedStrings.Designer_ActionBar_Delete,"Delete","forms-icon-size16x16",function(){e.Form.deleteFormQuestion(e),d.props.onDelete(),f.Type===p.QuestionType.Choice||f.Type===p.QuestionType.TextField?k.log({eventName:t.DesignPage.Questions.Delete,eventType:"engagement_event",extraData:{isMathQuiz:!!f.IsMathQuiz,questionType:f.Type}}):k.log({eventName:t.DesignPage.Questions.Delete,eventType:"engagement_event",extraData:{questionType:f.Type}})}),i=c.createActionBarButton(w.LocalizedStrings.Designer_ActionBar_MoveUp,"Up","forms-icon-size15x15",this.handleMoveUp,this.getElementRef(b.moveUpElementIndex)),j=c.createActionBarButton(w.LocalizedStrings.Designer_ActionBar_MoveDown,"Down","forms-icon-size15x15",this.handleMoveDown,this.getElementRef(b.moveDownElementIndex));return g.createElement("div",{className:"question-designer-action-bar",key:"ActionBar"},a,h,i,j)},c.prototype.handleMoveUp=function(){var a=this.props.Master,b=a.Model;this.props.IsFirstElement||(k.log({eventName:t.DesignPage.Questions.MoveUp,eventType:"engagement_event",extraData:{questionType:b.Type}}),a.Form.moveElementUp(a))},c.prototype.handleMoveDown=function(){var a=this.props.Master,b=a.Model;this.props.IsLastElement||(k.log({eventName:t.DesignPage.Questions.MoveDown,eventType:"engagement_event",extraData:{questionType:b.Type}}),a.Form.moveElementDown(a))},c.prototype.createTitleBar=function(){var a=this.props.Master.Model,c=g.createElement("div",{className:"design-question-ordinal",key:"Ordinal"},w.LocalizedStrings.Designer_QuestionOrdinal.format(this.props.Ordinal)),d=s.createTextField({AutoFocus:!0,AutoSelection:!0,HTMLAttributes:{className:this.state.SelectedElementIndex===b.titleElementIndex?"design-question-title-with-image active":"design-question-title-with-image"},key:"Title",MaxLength:x.QuestionTitleLength,MinimalHeight:x.DefaultTextFieldHeight,onValueChange:this.onTitleValueChangeIntenal,Options:this.getTitleOptions(),Placeholder:w.LocalizedStrings.Designer_QuestionTitle_Placeholder,TextFieldType:s.TextFieldType.AutoHeightMultiline,Value:a.Title});return g.createElement("div",{className:"design-question-title-bar",key:"TitleBar"},c,this.createTitleContainer(d))},c.prototype.getTitleOptions=function(){return{HTMLPropsForInnerElement:v.Html.mergeReactProps(this.getElementFocusingProps(b.titleElementIndex),{"aria-label":w.LocalizedStrings.Designer_QuestionTitle,className:"design-question-textbox mixer-focus-target"})}},c.prototype.createTitleContainer=function(a){var c=this,d=this.props.Master,e=d.Model,f=e.ImageInfo,i=e.VideoInfo,j="design-question-title-image-picker office-form-theme-button";this.state.SelectedElementIndex===b.titleElementIndex&&(j=v.Html.combineAttributes(j,"active"));var l,m=s.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:v.Html.mergeReactProps(this.getElementFocusingProps(b.titleElementIndex),{className:j,onClick:function(){k.log({eventName:t.DesignPage.Questions.AddImage,eventType:"engagement_event",extraData:{questionId:e.Id,questionType:e.Type}}),y.pickMedia().done(function(a){a.Image?d.ImageInfoMaster.addImage(a.Image):a.Video&&d.setVideoUrl(a.Video)}).fail(function(a){a&&c.state.SelectedElementIndex===b.otherElementIndex&&c.setState({SelectedElementIndex:b.titleElementIndex},function(){var a=h.findDOMNode(c.getElementRef(b.titleElementIndex).current);a&&$(a).find(".design-question-title-image-picker").focus()})})}}),Icon:"Photo2",IconClassName:"forms-icon-size20x20",key:"ImagePicker",Text:w.LocalizedStrings.ImagePicker_Insert_Mdeia_button||void 0});l=f&&(f.ImageProcessingStatus===p.ImageProcessingStatus.Picking||f.ErrorType||p.hasImage(f))?this.createImageTitleSubElements():i&&i.Url?this.createVideoTitleSubElements():[a,m];var n=this.getElementRef(b.titleElementIndex);return g.createElement("div",{className:"design-question-image-title-container",key:"TitleContainer",ref:n},l)},c.prototype.createImageTitleSubElements=function(){var a=o.createImageDesignerContainer({ImageMaster:this.props.Master.ImageInfoMaster,ImageSettingsMaster:this.props.Master.ImageSettingsMaster,IsFormLogo:!1,key:"ImageAndEditPane"});return[this.createMediaTitle(),a]},c.prototype.createVideoTitleSubElements=function(){var a=this.createVideoDesignerContainer();return[this.createMediaTitle(),a]},c.prototype.createMediaTitle=function(){var a,b=this,c=this.props.Master.Model,d=c.ImageInfo,e=c.VideoInfo,f="design-question-image-title",g=s.TextFieldType.AutoHeightMultiline,h=x.DefaultTextFieldHeight;return d.ErrorType===r.NoError&&d.ResourceUrl&&c.ImageSettings.ContainerWidth?c.ImageSettings.ContainerWidth<x.QuestionCarMaxWidth?(a="calc(100% - "+c.ImageSettings.ContainerWidth+"px)",g=s.TextFieldType.FixHeightMultiline,h=c.ImageSettings.ContainerHeight):f="design-question-image-title-big-horizontal":e&&e.Url?f="design-question-image-title-big-horizontal":(a="calc(100% - "+x.ImagePlaceHolderWidth+"px)",h=x.ImagePlaceHolderHeight,g=s.TextFieldType.FixHeightMultiline),s.createTextField({AutoSelection:!0,HTMLAttributes:{className:f,style:{width:a}},key:"ImageTitle",MaxLength:x.QuestionTitleLength,MinimalHeight:h,onValueChange:function(a){return b.onTitleValueChangeIntenal(a)},Options:this.getTitleOptions(),TextFieldType:g,Value:c.Title})},c.prototype.createSubtitle=function(){var a=this.props.Master.Model;if(a.ShowSubtitle){if(a.IsMathQuiz)return this.createMathBar();var c=s.createTextField({HTMLAttributes:{className:"design-question-subtitle"},MaxLength:x.QuestionSubtitleLength,MinimalHeight:x.DefaultTextFieldHeight,onValueChange:function(b){return a.Subtitle=b},Options:{HTMLPropsForInnerElement:{"aria-label":w.LocalizedStrings.Designer_QuestionSubtitle,className:"design-question-textbox mixer-focus-target"}},Placeholder:w.LocalizedStrings.Designer_PlaceholderForQuestionSubtitle,ref:this.getElementRef(b.subtitleElementIndex),TextFieldType:s.TextFieldType.AutoHeightMultiline,Value:a.Subtitle});return g.createElement("div",{className:"design-question-element",key:"Subtitle"},c)}},c.prototype.createBottomBar=function(){return g.createElement("div",{className:"design-question-bottombar-container clearfix",key:"BottomBar"},d(this.props.Master),g.createElement("div",{className:"design-question-bottombar"},this.createSingleMultipleToggleButton(),this.createRequiredToggleButton(),this.createMoreMenu()))},c.prototype.createSingleMultipleToggleButton=function(){var a=this.props.Master.Model;switch(a.Type){case p.QuestionType.Choice:case p.QuestionType.ChoiceV2:case p.QuestionType.TextField:case p.QuestionType.MatrixChoice:var b=z.Flight.isEnabled(z.Flights.DropDown)&&a.OptionDisplayStyle===p.OptionDisplayStyle.Dropdown;return s.createToggleButton({Disabled:b,HTMLAttributes:{className:"design-question-bottombar-element",title:b?w.LocalizedStrings.QuestionBar_DesignTime_MultipleChoice_Tooltip:""},Label:a.Type===p.QuestionType.TextField?w.LocalizedStrings.Designer_AllowMultipleLines:w.LocalizedStrings.Designer_AllowMultipleChoices,onValueChange:function(b){if(a.Type===p.QuestionType.TextField)k.log({eventName:t.DesignPage.Questions.LongAnswer,eventType:"engagement_event",extraData:{questionId:a.Id,questionType:a.Type,value:b}}),a.Multiline=b;else{k.log({eventName:t.DesignPage.Questions.MultipleAnswers,eventType:"engagement_event",extraData:{isQuiz:a.IsQuiz,questionType:a.Type}});var c=a;c.ChoiceType=b?q.MultiChoice:q.SingleChoice,c.IsQuiz&&c.ChoiceType===q.SingleChoice&&i.rest(i.filter(c.Choices,function(a,b){return a.IsAnswerKey})).map(function(a,b){return a.IsAnswerKey=!1});var d=c.DefaultValue&&JSON.parse(c.DefaultValue);if(d){var e=Object.getOwnPropertyNames(d);if(c.ChoiceType!==q.MultiChoice&&e.length>1){for(var f=1;f<e.length;f++)delete d[e[f]];c.DefaultValue=JSON.stringify(d)}}}},Options:{classNameForInnerLabel:"design-question-toggle-label"},Value:a.Type===p.QuestionType.TextField?a.Multiline:a.ChoiceType===q.MultiChoice});default:return null}},c.prototype.createRequiredToggleButton=function(){var a=this.props.Master,b=a.Model;return s.createToggleButton({HTMLAttributes:{className:"design-question-bottombar-element"},Label:w.LocalizedStrings.Designer_IsRequired,onValueChange:function(c){k.log({eventName:t.DesignPage.Questions.AnswerRequired,eventType:"engagement_event",extraData:{isQuiz:b.IsQuiz,questionId:b.Id,questionType:b.Type,value:c}}),b.Required=c,a.SubQuestionMasters.forEach(function(a){a.Model.Required=b.Required})},Options:{classNameForInnerLabel:"design-question-toggle-label toggle-label-margin-right"},Value:b.Required})},c.prototype.createMoreMenu=function(){var a=this,b={ButtonStyle:"LightBackground",ChildrenContent:s.createFontIconControl({HTMLAttributes:{className:"forms-icon-size18x18"},IconName:"More"}),ClassName:"design-question-more-options",Description:w.LocalizedStrings.DesignPage_NavBar_MoreOptions,Tooltip:w.LocalizedStrings.QuestionCard_DesignTime_Menu_Tooltip};return s.createMenuControl({ClassNameForContainer:"design-question-bottombar-element",MenuTriggerButton:b,onMenuExpand:function(){k.log({eventName:t.DesignPage.QuestionMenu.Navigate,eventType:"engagement_event",extraData:{questionType:a.props.Master.Model.Type}})},UnorderListMenuItems:this.createMoreMenuItems().filter(function(a){return!!a})})},c.createActionBarButton=function(a,b,c,d,e){return s.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{className:"question-edit-button",onClick:d},Icon:b,IconClassName:c,ref:e,Text:a})},c.prototype.updateMovingButtonStatus=function(){var a=document.activeElement,c=h.findDOMNode(this.getElementRef(b.moveUpElementIndex).current),d=h.findDOMNode(this.getElementRef(b.moveDownElementIndex).current);this.props.IsFirstElement&&a===c?(d.disabled=!1,d.focus()):this.props.IsLastElement&&a===d&&(c.disabled=!1,c.focus()),c.disabled=this.props.IsFirstElement,d.disabled=this.props.IsLastElement},c.prototype.createVideoDesignerContainer=function(){var a=this,b="design-question-title-video office-form-theme-border",d="design-question-title-video-frame",e=s.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{className:"video-delete-button office-form-theme-button-foreground",onClick:function(){k.log({eventName:t.DesignPage.VideoEditPane.Delete,eventType:"engagement_event"}),a.props.Master.clearVideoInfo()}},Icon:"Delete",IconClassName:"forms-icon-size18x18",Text:w.LocalizedStrings.VideoEditPane_Delete_Button});return g.createElement("div",{"aria-label":w.LocalizedStrings.VideoPane_Video_Container,className:b,key:"VideoContainer",tabIndex:0},g.createElement("iframe",{allowFullScreen:!0,className:d,frameBorder:"0",height:c.calcVideoDisplayHeight(),sandbox:"allow-scripts allow-same-origin allow-popups",src:this.props.Master.Model.VideoInfo.Url,width:"100%"}),e)},c.calcVideoDisplayHeight=function(){if(v.isMobile()){var a=$(window).width();return 0===a&&(a=document.body.scrollWidth),a/A}return x.DefaultVideoHeight},c.prototype.forceUpdateWrapper=function(){var a=this.updateCallbacks;this.updateCallbacks=[],this.forceUpdate(function(){a.forEach(function(a){return a()})})},c}(n.ReactComponent);b.QuestionDesignerBase=B},function(a,b,c){"use strict";function d(a){var b=[],c=Object.keys(a);return c.forEach(function(c){a[c]&&(b=b.concat(t[c]))}),b}function e(a){var b=g(a),c={className:"forms-icon-size20x20 office-form-theme-quiz-point analyze-view-file-icon",style:{color:b.Color}};return h.createElement(i.FontIconControl,{HTMLAttributes:c,IconName:b.Name})}function f(a){switch(a){case"Audio":return j.LocalizedStrings.UploadFile_Type_Audio;case"Excel":return j.LocalizedStrings.UploadFile_Type_Excel;case"Image":return j.LocalizedStrings.UploadFile_Type_Image;case"PDF":return j.LocalizedStrings.UploadFile_Type_PDF;case"PowerPoint":return j.LocalizedStrings.UploadFile_Type_PowerPoint;
case"Text":return j.LocalizedStrings.UploadFile_Type_Text;case"Video":return j.LocalizedStrings.UploadFile_Type_Video;case"Word":return j.LocalizedStrings.UploadFile_Type_Word;default:return""}}function g(a){var b=a.split("."),c=b[b.length-1].toLowerCase(),d=u[s[c]];return d||{Color:"#666666",Name:"TextDocument"}}Object.defineProperty(b,"__esModule",{value:!0});var h=c(0),i=OfficeForm.Exports.Control,j=OfficeForm.Exports.Resources,k=["mp3","aif","iff","m3u","m4a","mid","mpa","ra","wav","wma"],l=["xls","xlt","xlm","xlsx","xlsm","xltx","xltm"],m=["jpg","jpeg","png","gif","bmp","tiff","psd","thm","yuv","ai","drw","eps","ps","svg","3dm","max"],n=["pdf"],o=["ppt","pot","pps","pptx","pptm","potx","potm","ppam","ppsx","ppsm","sldx","sldm"],p=["txt","rtf","wpd","wps","log","msg","pages"],q=["avi","mp4","mov","wmv","asf","3g2","3gp","asx","flv","mpg","rm","swf","vob"],r=["doc","dot","wbk","docx","docm","dotx","dotm","docb"],s={};k.forEach(function(a){return s[a]="Audio"}),l.forEach(function(a){return s[a]="Excel"}),m.forEach(function(a){return s[a]="Image"}),n.forEach(function(a){return s[a]="PDF"}),o.forEach(function(a){return s[a]="PowerPoint"}),p.forEach(function(a){return s[a]="Text"}),q.forEach(function(a){return s[a]="Video"}),r.forEach(function(a){return s[a]="Word"});var t={Audio:k,Excel:l,Image:m,PDF:n,PowerPoint:o,Text:p,Video:q,Word:r},u={Audio:{Color:"#666666",Name:"Microphone"},Excel:{Color:"#217346",Name:"ExcelDocument"},Image:{Color:"#666666",Name:"Photo2"},PDF:{Color:"#666666",Name:"PDF"},PowerPoint:{Color:"#B7472A",Name:"PowerPointDocument"},Text:{Color:"#666666",Name:"TextField"},Video:{Color:"#666666",Name:"Video"},Word:{Color:"#2B579A",Name:"WordDocument"}};b.getAcceptedFileTypes=d,b.getFileIcon=e,b.convertFileTypeToString=f,Forms.UX.FileUpload.getFileIcon=e,Forms.UX.FileUpload.getFileIconInDetailTable=function(a){var b=g(a);return'<i class="ms-Icon ms-Icon--'+b.Name+' forms-icon-size20x20 response-dialog-fileIcon office-form-theme-quiz-point" style="color: '+b.Color+';"></i>'}},function(a,b,c){"use strict";function d(a){return a?e[a]||null:b.defaultPredefinedTheme}Object.defineProperty(b,"__esModule",{value:!0});var e={};b.getPredefinedThemeByName=d,b.predefinedThemes=[{BackgroundColor:"#E8F2F4",BackgroundImage:null,Name:"Teal",PrimaryColor:"#008272",SecondaryColor:"#004B50",Thumbnail:"../../Images/Theme/teal-thumbnail.png"},{BackgroundColor:"#F7F1F7",BackgroundImage:null,Name:"Raspberry",PrimaryColor:"#8D398F",SecondaryColor:"#712E72",Thumbnail:"../../Images/Theme/raspberry-thumbnail.png"},{BackgroundColor:"#FCF2F0",BackgroundImage:null,Name:"Dark_Orange",PrimaryColor:"#CE4B28",SecondaryColor:"#BC2E1B",Thumbnail:"../../Images/Theme/darkorange-thumbnail.png"},{BackgroundColor:"#F6EFF2",BackgroundImage:null,Name:"Pomegranate",PrimaryColor:"#911844",SecondaryColor:"#4E0D25",Thumbnail:"../../Images/Theme/pomegranate-thumbnail.png"},{BackgroundColor:"#FAEDF7",BackgroundImage:null,Name:"Pink",PrimaryColor:"#BF3088",SecondaryColor:"#BC2075",Thumbnail:"../../Images/Theme/pink-thumbnail.png"},{BackgroundColor:"#F2F8E7",BackgroundImage:null,Name:"Bright_Green",PrimaryColor:"#0E8906",SecondaryColor:"#448715",Thumbnail:"../../Images/Theme/brightgreen-thumbnail.png"},{BackgroundColor:"#ECF8FE",BackgroundImage:null,Name:"Bright_Blue",PrimaryColor:"#0078D7",SecondaryColor:"#0D5BC3",Thumbnail:"../../Images/Theme/brightblue-thumbnail.png"},{BackgroundColor:"#E7EDF3",BackgroundImage:null,Name:"Medium_Dark_Blue",PrimaryColor:"#004B8B",SecondaryColor:"#032D63",Thumbnail:"../../Images/Theme/darkblue-thumbnail.png"},{BackgroundColor:"#F4EBDC",BackgroundImage:"../../Images/Theme/office.png",Name:"Office",PrimaryColor:"#B84F22",SecondaryColor:"#cb6a07",Thumbnail:"../../Images/Theme/office-thumbnail.png"},{BackgroundColor:"#DCE9F4",BackgroundImage:"../../Images/Theme/ocean.png",Name:"Ocean",PrimaryColor:"#1D5482",SecondaryColor:"#143350",Thumbnail:"../../Images/Theme/ocean-thumbnail.png"},{BackgroundColor:"#DCE9F4",BackgroundImage:"../../Images/Theme/sky.png",Name:"Sky",PrimaryColor:"#006DB2",SecondaryColor:"#075F9C",Thumbnail:"../../Images/Theme/sky-thumbnail.png"},{BackgroundColor:"#DCE9F4",BackgroundImage:"../../Images/Theme/ski.png",Name:"Ski",PrimaryColor:"#006DB2",SecondaryColor:"#075F9C",Thumbnail:"../../Images/Theme/ski-thumbnail.png"},{BackgroundColor:"#EAF4DC",BackgroundImage:"../../Images/Theme/city01.png",Name:"City01",PrimaryColor:"#3A501D",SecondaryColor:"#2A3B13",Thumbnail:"../../Images/Theme/city01-thumbnail.png"},{BackgroundColor:"#DCE9F4",BackgroundImage:"../../Images/Theme/city02.png",Name:"City02",PrimaryColor:"#024582",SecondaryColor:"#00315D",Thumbnail:"../../Images/Theme/city02-thumbnail.png"},{BackgroundColor:"#EAF4DC",BackgroundImage:"../../Images/Theme/chemistry.png",Name:"Chemistry",PrimaryColor:"#025700",SecondaryColor:"#013D00",Thumbnail:"../../Images/Theme/chemistry-thumbnail.png"},{BackgroundColor:"#DCE9F4",BackgroundImage:"../../Images/Theme/astronomy.png",Name:"Astronomy",PrimaryColor:"#0A1431",SecondaryColor:"#030716",Thumbnail:"../../Images/Theme/astronomy-thumbnail.png"},{BackgroundColor:"#F5F2FF",BackgroundImage:"../../Images/Theme/office2.png",Name:"Office02",PrimaryColor:"#562685",SecondaryColor:"#32145A",Thumbnail:"../../Images/Theme/office2-thumbnail.png"},{BackgroundColor:"#E6EDF3",BackgroundImage:"../../Images/Theme/meeting.png",Name:"Meeting",PrimaryColor:"#053870",SecondaryColor:"#032D63",Thumbnail:"../../Images/Theme/meeting-thumbnail.png"}],b.predefinedThemes.forEach(function(a,c){a=Object.freeze(a),b.predefinedThemes[c]=a,e[a.Name]=a}),b.defaultPredefinedTheme=b.predefinedThemes[0],b.customizedThemeName="Customized Theme",b.defaultCustomizedBackgroundColor="#E8F2F4",b.defaultCustomizedPrimaryColor="#008272",b.defaultCustomizedSecondaryColor="#004B50",Forms.Models.predefinedThemes=b.predefinedThemes,Forms.Models.defaultTheme=b.defaultPredefinedTheme,Forms.Models.defaultCustomizedBackgroundColor=b.defaultCustomizedBackgroundColor,Forms.Models.defaultCustomizedPrimaryColor=b.defaultCustomizedPrimaryColor,Forms.Models.defaultCustomizedSecondaryColor=b.defaultCustomizedSecondaryColor},function(a,b,c){"use strict";function d(a){return Nerve.getObjectMasterFromModel(a)}function e(){return{Title:k.LocalizedStrings.DesciptiveElementType_Section_DefaultTitle,Type:j.QuestionType.Section}}var f=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var g=c(3),h=c(2),i=c(37),j=OfficeForm.Exports.Models,k=OfficeForm.Exports.Resources,l=Nerve.Spec,m=OfficeForm.Exports.Utilities,n={CoAuthors:l.collectionOf(l.reference(),{IsLocalField:!0}),Id:l.string({IsKeyField:!0,SourceFieldName:"id"}),ImageInfo:l.fromMasterClass(function(){return j.ImageInfoMaster},{SourceFieldName:"image"}),ImageSettings:l.fromMasterClass(function(){return j.ImageSettingsMaster},{IsLocalField:!0}),IntegratedSavingState:l.reference({IsLocalField:!0}),Order:l.number({SourceFieldName:"order"}),QuestionInfo:l.string({SourceFieldName:"questionInfo"}),SavingState:l.reference({IsLocalField:!0}),ShowSubtitle:l["boolean"]({IsLocalField:!0}),Subtitle:l.string({SourceFieldName:"subtitle"}),Title:l.string({SourceFieldName:"title"}),Type:l.reference({SourceFieldName:"type"}),VideoInfo:l.create({Author:l.string(),OriginalHeight:l.number(),OriginalWidth:l.number(),Thumbnail_url:l.string(),Title:l.string(),Url:l.string()},{IsLocalField:!0})};b.getDescriptiveElementMaster=d,b.createDefaultSectionDefinition=e;var o=function(a,b){return new i.DescriptiveElementDataSource(a,b)},p=function(a){function b(c){var d=this,e=$.Deferred();if(!c.InitialData)throw Error("Element model should created with initial data.");return c=g.clone(c),c.InitialData=g.clone(c.InitialData),d=a.call(this,c,{MasterReady:e.promise(),Scheduler:new j.Scheduler})||this,j.keepSavingStateUpdated(d),d.updateIntegratedSavingState(),d.initializeQuestionInfoBinder(c),j.bindImageSettings(d,b.Schema.ImageInfo,b.Schema.ImageSettings),b.Rules.forEach(function(a){return d.addRule(a)}),d.coAuthorTimers={},e.resolve(),d}return f(b,a),Object.defineProperty(b.prototype,"Form",{get:function(){return this.Parent.Parent},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"ImageInfoMaster",{get:function(){return j.getImageInfoMaster(this.Model.ImageInfo)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"ImageSettingsMaster",{get:function(){return j.getImageSettingsMaster(this.Model.ImageSettings)},enumerable:!0,configurable:!0}),b.prototype.isFieldReady=function(c){return c=b.getSourceFields([c])[0],a.prototype.isFieldReady.call(this,c)},b.prototype.ensureFieldsReady=function(c){return a.prototype.ensureFieldsReady.call(this,b.getSourceFields(c))},b.prototype.fieldsReady=function(c){return a.prototype.fieldsReady.call(this,b.getSourceFields(c))},b.prototype.ensureCreationDone=function(){var a=this;return this.ImageInfoMaster.Synchronizer.flush().then(function(){return a.Synchronizer.flush()})},b.prototype.setVideoUrl=function(a){var c=this.Model.VideoInfo,d=Nerve.getObjectMasterFromModel(c);d.bulkEdit(function(){c.Url=b.generateEmbedURLLocally(a),c.Title="",c.Author="",c.Thumbnail_url="",c.OriginalWidth=b.defaultWidth,c.OriginalHeight=b.defaultHeight})},b.prototype.clearVideoInfo=function(){this.Model.VideoInfo={Author:"",OriginalHeight:b.defaultHeight,OriginalWidth:b.defaultWidth,Thumbnail_url:"",Title:"",Url:""}},b.prototype.createSyncJob=function(a){var b=this,c=$.Deferred(),d=c.promise().then(function(){return b.Form.getQuestionSyncBlocker(d)}).then(a);return c.resolve(),d},b.prototype.createUploadSyncJob=function(a){var b=this,c=$.Deferred(),d=$.when(c,this.uploadJob).then(function(){return b.createSyncJob(a)});return c.resolve(),this.uploadJob=m.Promise.always(d),d},b.prototype.updateCoAuthors=function(a){var b=this,c=g.filter(this.Model.CoAuthors,function(b){return a.userId===b.userId})[0],d=function(){c&&e.deleteItems([c]),a.userId in b.coAuthorTimers&&(clearTimeout(b.coAuthorTimers[a.userId]),delete b.coAuthorTimers[a.userId])},e=Nerve.getCollectionMasterFromModel(this.Model.CoAuthors);e.bulkEdit(function(){d(),c=Nerve.Collection.addItems(b.Model.CoAuthors,[a])[0]});var f=1e4;this.coAuthorTimers[a.userId]=window.setTimeout(d,f)},b.prototype.initializeQuestionInfoBinder=function(a){this.questionInfoBinder=new j.FieldBinder(this,b.Schema.QuestionInfo,b.QuestionInfoFieldSet),a.InitialData&&this.isFieldReady(b.Schema.QuestionInfo)&&(a.ExistingInDataSource||a.InitialData.QuestionInfo?this.questionInfoBinder.deserialize():this.questionInfoBinder.serialize())},b.prototype.updateIntegratedSavingState=function(){this.isFieldReady(b.Schema.ImageInfo)?this.Model.IntegratedSavingState=j.integrateSavingState([this.Model.ImageInfo.SavingState,this.Model.SavingState]):this.Model.IntegratedSavingState=this.Model.SavingState},b.generateEmbedURLLocally=function(a){var b=document.createElement("a");b.href=a;var c=b.pathname.split("/"),d=a.substring(a.indexOf("?")+1),e=m.Html.getQueries(d),f=e.v||c[0]||c[1];return"https://www.youtube.com/embed/"+f+"?feature=oembed&modestbranding=1&rel=0"},Object.defineProperty(b,"QuestionInfoFieldSet",{get:function(){return b.questionInfoFieldSet||(b.questionInfoFieldSet=new j.FieldSet([b.Schema.ImageSettings,b.Schema.ShowSubtitle,b.Schema.VideoInfo])),b.questionInfoFieldSet},enumerable:!0,configurable:!0}),Object.defineProperty(b,"Rules",{get:function(){if(!b.rules){var a=b.Schema;b.rules=[{InterestedFields:[a.Id],Name:"block id changes",onChange:function(a){var b=a.Master.Model,c=b.Id,d=a.OldValues.Id;b.Id=d;var e;try{throw Error("Changing element id")}catch(f){e=f}h.log({eventName:"UpdatingElementId",eventType:"error_event",extraData:{newId:c,oldId:d,stack:e.stack}})}},{InterestedFields:[a.ImageInfo.SavingState,a.SavingState],Name:"IntegrateSavingState",onChange:function(a){return a.Master.updateIntegratedSavingState()}}]}return b.rules},enumerable:!0,configurable:!0}),b.getSourceFields=function(a){return g.uniq(a.map(function(a){return b.QuestionInfoFieldSet.covers(a)?b.Schema.QuestionInfo:a}))},b.defaultWidth=459,b.defaultHeight=256,b}(Nerve.createObjectMasterClass("DescriptiveElementMaster",n,o));b.DescriptiveElementMaster=p,Forms.Models.DescriptiveElementMaster=p,Forms.Models.getDescriptiveElementMaster=d},function(a,b,c){"use strict";function d(){function a(a){b.current=a}var b=a;return b}Object.defineProperty(b,"__esModule",{value:!0});var e=c(0);e.createRef||(e.createRef=d)},function(a,b){"name"in Function.prototype||Object.defineProperty(Function.prototype,"name",{get:function(){var a=/function\s([^(]{1,})\(/,b=a.exec(this.toString());return b&&b.length>1?b[1].trim():""}})},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f,g=c(0),h=c(3),i=c(1),j=OfficeForm.Exports.Utilities;!function(a){a[a.Loading=0]="Loading",a[a.Success=1]="Success",a[a.Error=2]="Error"}(f||(f={}));var k=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.subTitleRef=g.createRef(),b}return d(b,a),b.prototype.componentDidMount=function(){$(this.subTitleRef.current).linkify()},b.prototype.componentDidUpdate=function(){$(this.subTitleRef.current).linkify()},b.prototype.render=function(){var a=h.extend({},this.props.HTMLAttributes);return a.className=j.Html.combineAttributes(a.className,"office-form-title-container"),g.createElement("div",e({},a),this.createTitleContainer(),this.createSubTitle(),"Bottom"===this.props.MediaLayout?this.props.children:void 0)},b.prototype.createTitleContainer=function(a){var b,c="office-form-title-box";return"Bottom"!==this.props.MediaLayout&&(c=c+" "+this.props.MediaLayout.toLowerCase(),b=this.props.children),g.createElement("div",{className:c},b,this.createTitle())},b.prototype.createTitle=function(){var a=h.extend({},this.props.HTMLPropsForInnerElement);return a.className=j.Html.combineAttributes("office-form-title",a.className,"heading-"+(this.props.Heading||1),2===this.props.Heading&&"office-form-theme-secondary-color"),g.createElement("div",e({},a),g.createElement("span",null,this.props.Title),a.children)},b.prototype.createSubTitle=function(){return this.props.SubTitle?g.createElement("div",{className:"office-form-subtitle heading-"+(this.props.Heading||1),ref:this.subTitleRef},this.props.SubTitle):void 0},b}(i.ReactComponent);b.TitleMediaRenderer=k},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e,f=c(0),g=c(2),h=c(1),i=OfficeForm.Exports.FormLimitation,j=OfficeForm.Exports.Models,k=OfficeForm.Exports.EngagementEventNames.Image;!function(a){a[a.Loading=0]="Loading",a[a.Success=1]="Success",a[a.Error=2]="Error"}(e||(e={}));var l=function(a){function b(b){var c=a.call(this,b)||this;return c.state={ImageLoadStatus:e.Loading,RetryCount:0},c.onLoad=c.onLoad.bind(c),c.onError=c.onError.bind(c),c.updateImage=c.updateImage.bind(c),c}return d(b,a),b.prototype.componentDidMount=function(){var a=j.ImageInfoMaster.Schema;this.props.ImageInfoMaster.observe(this.updateImage,[a.AltText,a.ResourceId,a.ResourceUrl])},b.prototype.componentWillUnmount=function(){this.retryTimeId&&window.clearTimeout(this.retryTimeId),this.props.ImageInfoMaster.unobserve(this.updateImage)},b.prototype.render=function(){var a,c;this.props.FullFilled?(a="100%",c="auto"):(a=this.props.ImageWidth||i.ImagePlaceHolderWidth,c=this.props.ImageHeight||i.ImagePlaceHolderHeight);var d=this.state.RetryCount,g=this.props.ImageInfoMaster.Model,h=g.ResourceUrl;this.state.ImageLoadStatus===e.Error&&d>0&&(h+="?"+d);var j,k;return this.showSpinner()?k=b.createSpinner():this.state.ImageLoadStatus===e.Success&&(j="visiable"),f.createElement("div",{className:"office-form-title-image-box"},f.createElement("img",{alt:g.AltText,className:j,height:c,onError:this.onError,onLoad:this.onLoad,src:h,title:g.AltText,width:a}),k)},b.prototype.showSpinner=function(){var a=this.props.ImageInfoMaster.Model,b=this.props.ImageSettingMaster.Model,c=this.state.ImageLoadStatus;return c!==e.Success||a.ResourceId!==b.TargetResourceId||a.ImageProcessingStatus!==j.ImageProcessingStatus.Idle},b.createSpinner=function(){return f.createElement("div",{className:"image-spinner"},f.createElement("div",{className:"spinner-tile-animation"}))},b.prototype.onLoad=function(){g.log({eventName:k.ImageOnLoad.Success,eventType:"engagement_event",extraData:{imageType:this.props.ImageType,location:"1"}}),this.setState({ImageLoadStatus:e.Success})},b.prototype.onError=function(){var a=this,b=this.state.RetryCount;3>b?this.retryTimeId=window.setTimeout(function(){return a.setState({RetryCount:++b})},1e3):(g.log({eventName:k.ImageOnLoad.Failure,eventType:"engagement_event",extraData:{imageSrc:this.props.ImageInfoMaster.Model.ResourceUrl,imageType:this.props.ImageType,location:"1"}}),this.setState({ImageLoadStatus:e.Error}))},b.prototype.updateImage=function(){this.forceUpdate()},b}(h.ReactComponent);b.ImageRenderer=l},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(7),h=c(2),i=c(1),j=OfficeForm.Exports.Control,k=j.VirtualKeyboardControl,l=OfficeForm.Exports.Utilities,m=OfficeForm.Exports.EngagementEventNames,n=function(a){function b(b){var c=a.call(this,b)||this;return c.formulaRef=f.createRef(),c.onKeyDown=c.onKeyDown.bind(c),c.onMouseDown=c.onMouseDown.bind(c),c.onExit=c.onExit.bind(c),c.onValueChange=c.onValueChange.bind(c),c.props.ForceDesignMode&&(c.state.InDesignMode=c.props.ForceDesignMode),c}return d(b,a),b.prototype.render=function(){var a;return a=this.state.InDesignMode?this.createDesignerComponent():this.createRendererComponent(),f.createElement("div",{className:"formula-designer-container",ref:this.props.containerRef},a,this.props.children)},b.prototype.componentDidMount=function(){!this.state.InDesignMode&&this.props.HasFocus&&this.setFocusOnFormulaMixer()},b.prototype.componentDidUpdate=function(){this.state.InDesignMode&&this.props.onRenderComplete&&this.props.onRenderComplete(null,null)},b.prototype.shouldComponentUpdate=function(a,b){return this.props.Value!==a.Value||this.state.InDesignMode!==b.InDesignMode},b.prototype.createRendererComponent=function(){var a=this,b=l.Html.mergeReactProps(this.props.HTMLAttributes,{"aria-label":this.props.Value,className:this.props.Value?"design-formula-mixer":"design-formula-mixer placeholder",disabled:this.props.Disabled,key:"r",onKeyDown:this.onKeyDown,onMouseDown:this.onMouseDown,ref:this.formulaRef,role:"button",tabIndex:0}),c={DisableLinebreaks:!0,Formula:this.props.Value,onRenderComplete:function(b,c){a.props.onRenderComplete&&a.props.onRenderComplete(b,c)}};return this.props.Value?f.createElement("div",e({},b),j.createFormulaRenderer(c)):f.createElement("div",e({},b),this.props.Placeholder)},b.prototype.onKeyDown=function(a){var b=this;if(!this.props.Disabled)switch(a.keyCode){case g.KeyCode.Enter:case g.KeyCode.Space:this.setState({InDesignMode:!0},function(){b.props.blockEndDesignMode&&b.props.blockEndDesignMode(!0)})}},b.prototype.onMouseDown=function(a){var b=this;this.props.Disabled||setTimeout(function(){return b.setState({InDesignMode:!0},function(){b.props.blockEndDesignMode&&b.props.blockEndDesignMode(!0)})},0)},b.prototype.createDesignerComponent=function(){var a={onBoxBlur:this.props.onBoxBlur,onExit:this.onExit,onValueChange:this.onValueChange,QuestionId:this.props.QuestionId,Value:this.props.Value};return f.createElement("div",{className:"design-keyboard-container",key:"d"},f.createElement(k,e({},a)))},b.prototype.onExit=function(a){var b=this;this.setState({InDesignMode:!1},function(){b.props.blockEndDesignMode&&b.props.blockEndDesignMode(!1),a&&b.setFocusOnFormulaMixer()})},b.prototype.onValueChange=function(a){this.props.Value!==a&&h.log({eventName:m.DesignPage.Quiz.EditMathFormula,eventType:"engagement_event",extraData:{formulaLength:a?a.length:0,Location:this.props.Location,questionId:this.props.QuestionId}}),this.props.onValueChange(a)},b.prototype.setFocusOnFormulaMixer=function(){var a=this.formulaRef.current;a&&a.focus()},b}(i.ReactComponent);b.FormulaDesigner=n},function(a,b,c){"use strict";function d(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];if(a&&document.activeElement&&a.contains(document.activeElement)){var d=$(":focusable");b&&b.forEach(function(a){d=d.not(function(b,c){return a.contains(c)})});var e=d.index(document.activeElement);if(!(0>e)){for(var f=e+1;f<d.length;++f){var g=d[f];if(!a.contains(g)&&!l(g))return void d[f].focus()}for(var f=e-1;f>=0;--f){var g=d[f];if(!a.contains(g)&&!l(g))return void d[f].focus()}}}}function e(a){$(a).on("keydown",k)}function f(a){$(a).off("keydown",k)}function g(a,b){o||(o={}),o[a]||delete o[a],o[a]=b}function h(a){o&&o[a]&&(o[a](),delete o[a])}function i(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];var d=$(a).find(":focusable");b&&b.forEach(function(a){d=d.not(function(b,c){return a.contains(c)})}),d[d.length-1].focus()}function j(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];var d=$(a).find(":focusable");b&&b.forEach(function(a){d=d.not(function(b,c){return a.contains(c)})}),d.length>0&&d[0].focus()}function k(a){if(a.keyCode===n.KeyCode.Tab){a.stopPropagation(),a.preventDefault();var b=$(this),c=m.union(b.filter(":focusable").toArray(),b.find(":focusable").toArray()),d=c.indexOf(document.activeElement);if(!(0>d)){var e=m.union(c.slice(d+1),c.slice(0,d));a.shiftKey&&e.reverse(),e.push(c[d]);var f=m.find(e,function(a){return!l(a)});f&&f.focus()}}}function l(a){var b=Number(a.getAttribute("tabindex"));return!isNaN(b)&&0>b}Object.defineProperty(b,"__esModule",{value:!0});var m=c(3);c(66);var n=c(7);b.focusOut=d,b.trapFocusInsideElement=e,b.stopTrapFocusInsideElement=f,b.trackFocusJump=g,b.jumpFocusBack=h,b.focusOnLastFfocusableElement=i,b.focusOnFirstFocusableElement=j;var o;Forms.UX.Utilities.focusOut=d,Forms.UX.Utilities.trapFocusInsideElement=e,Forms.UX.Utilities.stopTrapFocusInsideElement=f,Forms.UX.Utilities.trackFocusJump=g,Forms.UX.Utilities.jumpFocusBack=h,Forms.UX.Utilities.focusOnLastFfocusableElement=i,Forms.UX.Utilities.focusOnFirstFocusableElement=j},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f,g=c(0),h=c(1),i=c(51),j=c(45);!function(a){a[a.User=0]="User",a[a.Group=1]="Group",a[a.MRU=2]="MRU"}(f=b.PhotoType||(b.PhotoType={})),b.SPECIAL_CHARACTER_REGEX_TOKEN=/[-_[\]{}()<>!@%~&*+=?.,:;"'`\\^$|#]/g;var k=function(a){function c(){var b=null!==a&&a.apply(this,arguments)||this;return b.state={ShowPhoto:!1},b.mounted=!0,b}return d(c,a),c.prototype.componentWillMount=function(){var a=this;this.props.Photo.then(function(a){return a.getUrl()}).done(function(b){a.mounted&&a.setState({PhotoUrl:b,ShowPhoto:!0})})},c.prototype.componentWillUnmount=function(){this.mounted=!1},c.prototype.render=function(){return g.createElement("div",{className:"fl-owner-container"},g.createElement("div",{className:"fl-facepile"},this.createMRUPhoto(),this.createGroupPhoto(),this.createUserPhoto()),g.createElement("div",{className:"fl-displayname"},g.createElement("span",{className:"searchable"},this.props.HideName?"":this.props.DisplayText||this.props.DisplayName)))},c.prototype.createMRUPhoto=function(){return this.props.PhotoType!==f.MRU?null:g.createElement("div",{className:"author-notification-content"},g.createElement(OfficeForm.Exports.Control.FontIconControl,{IconName:"Recent"}))},c.prototype.createGroupPhoto=function(){return this.props.PhotoType!==f.Group?null:this.state.ShowPhoto?this.createPhotoContainer(this.state.PhotoUrl):g.createElement("div",{className:"default-group-icon-container"},g.createElement(OfficeForm.Exports.Control.FontIconControl,{IconName:"Group"}))},c.prototype.createUserPhoto=function(){return this.props.PhotoType!==f.User?null:this.state.ShowPhoto?this.createPhotoContainer(this.state.PhotoUrl):this.createFacePile()},c.prototype.createPhotoContainer=function(a){return a&&"data:"!==a?g.createElement("img",{"aria-hidden":!this.props.HideName,className:"author-notification-content",src:a,title:this.props.DisplayName}):this.createFacePile()},c.prototype.createFacePile=function(){var a=this.props.DisplayName||"",c=a.replace(b.SPECIAL_CHARACTER_REGEX_TOKEN,""),d={displayText:j.getDisplayText(c.split(/\s+/)[0],c.split(/\s+/)[1]),name:a,tooltip:this.props.HideName?a:""};return g.createElement(i.AuthorFacePile,e({},d))},c}(h.ReactComponent);b.NameCard=k},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(5),g=c(41),h=c(2),i=c(1),j=OfficeForm.Exports.ClientErrorNames,k=OfficeForm.Exports.Control,l=OfficeForm.Exports.DataProvider,m=OfficeForm.Exports.EnvironmentConfig,n=OfficeForm.Exports.EngagementEventNames,o=OfficeForm.Exports.EngagementEventNames.Error,p=OfficeForm.Exports.Utilities,q=OfficeForm.Exports.Resources,r=OfficeForm.Exports.Telemetry,s=function(a){function b(b){var c=a.call(this,b)||this;return c.state={ShowErrorDetail:!1},c.onClickMoreDetailButton=c.onClickMoreDetailButton.bind(c),c}return d(b,a),b.getErrorMessage=function(a){var b=q.LocalizedStrings,c="";if(a)if(a.correlationId){var d=a;d.innerCode&&(c=b["Error_Message_"+d.innerCode]||q.LocalizedStrings.Error_Message_Default.format(d.innerCode))}else{var e=a;switch(e.name){case j.LoginIECrossZoneError:c=q.LocalizedStrings.Error_Message_Client_LoginIECrossZoneError.format(window.location.origin,m.getAadInstance());break;case j.ThirdPartyCookieBlockedError:c=q.LocalizedStrings.Error_Message_Client_ThirdPartyCookieError.format(m.getAadInstance());break;case j.AuthNoStorageError:c=q.LocalizedStrings.Error_Message_Client_AuthNoStorageError;break;case j.AADAcquireTokenMfaCheckError:c=q.LocalizedStrings.Error_Message_705;break;case j.TeamSiteNoGroupError:c=q.LocalizedStrings.Error_Message_Client_TeamSiteNoGroupError}}return c},b.createActionButton=function(a,b){var c=k.createTextButton({ButtonStyle:"LightBackground",HTMLAttributes:{"aria-describedby":"errorPageSubtitle",className:"office-form-info-error-action-button",onClick:b},Text:a});return e.createElement("div",{className:"office-form-info-error-action-button-container"},c)},b.prototype.componentDidMount=function(){var a=this.props.Error,b=q.LocalizedStrings;h.log({eventName:"Error"===this.props.ErrorType?o.ErrorPage.Error:o.ErrorPage.Information,eventType:"engagement_event",extraData:{Error:a,ErrorMessage:this.props.ErrorMessage,ErrorTitle:this.props.ErrorTitle,isEmptyMessage:!b["Error_Message_"+this.props.Error.innerCode],stack:a&&a.stack}});var c=450;p.OEmbed.notifyResponsePageFixedHeightToParentWindow(c)},b.prototype.render=function(){var a,c=q.LocalizedStrings,d=this.props.Error||{},f=c["Error_Message_"+d.innerCode+"_title"]||q.LocalizedStrings.Error_Page_DefaultErrorTitle,h=c["Error_Message_"+d.innerCode]||q.LocalizedStrings.Error_Page_DefaultMessage,i=b.getErrorMessage(this.props.Error),k=this.props.ErrorType;switch(k){case"Error":f=f||q.LocalizedStrings.Error_Page_DefaultErrorTitle,h=h||i;break;case"Information":f?h=h||i:f=i}switch(d.innerCode){case g.InnerCode.NoPermission:this.props.IsResponsePage?(f=c["Error_Message_"+d.innerCode+"_title_2"],h=void 0):this.props.IsAnalysisPage?(f=c["Error_Message_"+d.innerCode+"_title_3"],h=void 0):f=c["Error_Message_"+d.innerCode+"_title_1"];break;case g.InnerCode.FormClosed:var l="This form is closed."===d.innerMessage;if(l)f=q.LocalizedStrings.Error_Message_FormClosed;else{var m="Inner Message:",n=d.innerMessage.indexOf("Inner Message:")+m.length,o=d.innerMessage.length;f=d.innerMessage.substring(n,o).trim()}h="";break;case g.InnerCode.ExceedMaximumFormLimition:h=c["Error_Message_"+d.innerCode+"_recyclebin"];break;case g.InnerCode.FailedToCheckUserLicense||g.InnerCode.NotAllowedBySetting||g.InnerCode.NotSupportComposeFormId:h=c.Error_Page_DelayTryMessage;break;case g.InnerCode.NotAllowedByResponseOwnership:case g.InnerCode.ResponseNotFound:h=void 0}switch(d.message===q.LocalizedStrings.Error_Message_FormClosed&&(f=d.message),d.innerCode){case g.InnerCode.FormEnded:case g.InnerCode.FormNotStarted:f=c["Error_Message_"+d.innerCode+"_title"],h=""}switch(d.message){case q.LocalizedStrings.TakeATest_Win10:case q.LocalizedStrings.TakeATest_NotWin10:f=d.message,h=q.LocalizedStrings.TakeATest_Subtitle,a=b.createLinkMessage(q.LocalizedStrings.TakeATest_LearnMore,b.onClickHelpLinkButton)}var r=this.createErrorDetail();d.innerCode===g.InnerCode.LoginNotSupportInCurrentBrowser&&(f="",h=e.createElement("div",{dangerouslySetInnerHTML:{__html:h}}),r=void 0);var s;this.props.ShowCreateFormLink&&this.props.IsResponsePage&&d.name!==j.LoginIECrossZoneError&&d.name!==j.ThirdPartyCookieBlockedError&&d.name!==j.AuthNoStorageError&&d.name!==j.AADAcquireTokenMfaCheckError&&d.name!==j.TeamSiteNoGroupError&&d.innerCode!==g.InnerCode.DisabledByTenantAdmin&&d.innerCode!==g.InnerCode.LoginNotSupportInCurrentBrowser&&(s=this.createPropotionMessage());var t=p.isOEmbedSPO()?"office-form-page-padding office-form-error-page-container office-form-spo-embed":"office-form-page-padding office-form-error-page-container";return f=f&&e.createElement("div",{className:"office-form-info-title"},f),h=h&&e.createElement("div",{className:"office-form-info-subtitle",id:"errorPageSubtitle"},h),a=a&&e.createElement("div",{className:"office-form-info-subtitle"},a),e.createElement("div",{className:t},e.createElement("div",{className:"office-form office-form-info-container"},f,h,a,r,e.createElement("div",{className:"office-form-info-other"},s),!p.isOEmbedSPO()&&e.createElement(Forms.UX.Renderer.FooterControl)))},b.prototype.onClickMoreDetailButton=function(){this.setState({ShowErrorDetail:!this.state.ShowErrorDetail});
},b.prototype.getTechnicalMessage=function(){var a=this.props.Error;return a?a.correlationId?q.LocalizedStrings.Error_TechnicalMessage2.format(r.getCurrentSessionId(),a.correlationId):q.LocalizedStrings.Error_TechnicalMessage.format(r.getCurrentSessionId()):void 0},b.prototype.createErrorDetail=function(){var a=q.LocalizedStrings;if("Information"===this.props.ErrorType)return void 0;var c,d=this.getTechnicalMessage(),h=k.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{"aria-hidden":!0,"aria-label":q.LocalizedStrings.Error_More_Detail,className:"office-form-info-error-detail-button office-form-info-error-children",onClick:this.onClickMoreDetailButton},Icon:this.state.ShowErrorDetail?"ChevronUp":"ChevronDown",IconClassName:"forms-icon-size12x12"});this.state.ShowErrorDetail&&(c=e.createElement("div",{className:"office-form-info-error-detail"},d));var i=null;switch(this.props.Error.innerCode){case g.InnerCode.NotRolloutMsaUser:l.AuthTokenHelper.signOutInIframe(),i=b.createActionButton(a.Error_Message_BackToLoginButton,l.AuthTokenHelper.signInWithOtherAccount);break;case g.InnerCode.AntiForgeryTokenValidationError:i=b.createActionButton(a.Error_Message_RefreshPageButton,function(){return f.reloadPage()});break;case g.InnerCode.CoAuthNotAllowedForMsa:i=b.createActionButton(a.Error_Message_SignInButton,l.AuthTokenHelper.forceAadSignIn)}return e.createElement("div",{className:"office-form-info-error-detail-container"},h,e.createElement("span",{className:"office-form-info-error-children office-form-info-children"},a.Error_More_Detail),c,i)},b.prototype.createPropotionMessage=function(){return!this.props.IsResponsePage||p.Flight.isPPTIntegration()||OfficeForm.Exports.EnvironmentSettings.IsAssignmentsIntegration?void 0:b.createLinkMessage(q.LocalizedStrings.Renderer_PromotionMessage,b.onClickPropotionLinkButton)},b.createLinkMessage=function(a,b){var c="office-form-info-premotion office-form-info-children";return p.isOEmbedSPO()&&(c=p.Html.combineAttributes(c,"office-form-theme-spo-link")),e.createElement("div",null,e.createElement("a",{className:c,onClick:b},a))},b.onClickPropotionLinkButton=function(){var a="DesignPage.aspx",b=p.isOEmbed()||p.isOEmbedSPO();if(b){var c=p.getNonEmbedQuery(),d="../Pages/DesignPage.aspx?"+jQuery.param(c);a=p.Html.getAbsoluteUrl(d)}h.log({eventName:n.ResponsePage.ThanksView.NavigateToPortal,eventType:"engagement_event"});var e=b?"_blank":"_self";p.Html.safeOpen(a,e)},b.onClickHelpLinkButton=function(){h.log({eventName:n.ResponsePage.ThanksView.LearnMoreForTakeATest,eventType:"engagement_event"}),p.Html.safeOpen(q.LocalizedStrings.TakeATest_LearnMoreLink,"_blank")},b}(i.ReactComponent);b.ErrorPage=s,Forms.UX.Renderer.ErrorPage=s},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),c(10),c(27),c(38),c(13),c(35)},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=OfficeForm.Exports.DataProvider.ErrorCode,e=OfficeForm.Exports.Models,f=function(){function a(a,b){this.element=a,this.dataProvider=e.FormDataSource.getDataProviderByFormMaster(this.element.Form)}return Object.defineProperty(a.prototype,"FormId",{get:function(){return this.element.Form.Model.Id},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ElementId",{get:function(){return this.element.Model.Id},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ElementType",{get:function(){return this.element.Model.Type},enumerable:!0,configurable:!0}),a.prototype.add=function(a){var b=this;if(this.element.Form.SyncContext!==e.FormSyncContext.DesignTimeForm)throw Error("Trying to create an element without design type.");return this.element.createSyncJob(function(){return b.dataProvider.createFormDescriptiveElement(b.FormId,a)})},a.prototype["delete"]=function(a){var b=this;if(!a||!a.id)throw Error("Trying to delete an empty element.");if(this.element.Form.SyncContext!==e.FormSyncContext.DesignTimeForm)throw Error("Trying to delete an element without design type.");var c=function(){return b.dataProvider.deleteFormDescriptiveElement(b.FormId,a.id||"",b.ElementType)};return $.when(this.element.createSyncJob(c)).then(null,function(a){return a&&a.innerCode===d.InnerCode.CDBColumnNotFound?$.Deferred().resolve().promise():a})},a.prototype.query=function(a){throw Error("No scenario to call this method currently.")},a.prototype.update=function(a,b){var c=this;return this.element.Form.SyncContext!==e.FormSyncContext.DesignTimeForm?$.Deferred().resolve().promise():this.element.createUploadSyncJob(function(){return c.dataProvider.updateFormDescriptiveElement(c.FormId,c.ElementId,c.ElementType,a)})},a}();b.DescriptiveElementDataSource=f},function(a,b){var c=(Forms.Models.DescriptiveElementMaster,OfficeForm.Exports.Models.FormMaster),d=OfficeForm.Exports.Models.QuestionMaster,e=OfficeForm.Exports.Resources,f=OfficeForm.Exports.Utilities,g=500,h=100,i=function(){function a(a){this.formMaster=a}return Object.defineProperty(a,"QuestionOrderFloor",{get:function(){return g},enumerable:!0,configurable:!0}),Object.defineProperty(a,"QuestionOrderDefaultStep",{get:function(){return h},enumerable:!0,configurable:!0}),a.isDescriptiveElement=function(a){return a===OfficeForm.Exports.Models.QuestionType.Section},a.isSection=function(a){return a===OfficeForm.Exports.Models.QuestionType.Section},Object.defineProperty(a.prototype,"TopQuestionMasters",{get:function(){return _.filter(this.formMaster.Model.Questions,function(a){return!a.GroupId}).map(Nerve.getObjectMasterFromModel)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"HeaderTopQuestionMasters",{get:function(){var a=this.SectionMasters,b=a.length&&a[0].Model.Order;return b>0?this.findQuestionsInBetween(null,b):this.TopQuestionMasters},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"HeaderQuestionMasters",{get:function(){var a=this.SectionMasters,b=a.length&&a[0].Model.Order;return b>0?this.findQuestionsInBetween(null,b,!0):this.QuestionMasters},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"QuestionMasters",{get:function(){return Nerve.convertToArray(this.formMaster.Model.Questions).map(Nerve.getObjectMasterFromModel)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"DescriptiveElementMasters",{get:function(){return Nerve.convertToArray(this.formMaster.Model.DescriptiveElements).map(Nerve.getObjectMasterFromModel)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"SectionMasters",{get:function(){return _.filter(this.DescriptiveElementMasters,function(b){return a.isDescriptiveElement(b.Model.Type)})},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"AllElementMasters",{get:function(){return this.getAllElements().map(Nerve.getObjectMasterFromModel)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"TopElementMasters",{get:function(){return this.getFormElements(!0).map(Nerve.getObjectMasterFromModel)},enumerable:!0,configurable:!0}),a.prototype.getQuestionById=function(a){var b=Nerve.Collection.getItemWithKeyFields(this.formMaster.Model.Questions,{Id:a});return b&&OfficeForm.Exports.Models.getQuestionMaster(b)},a.prototype.getElementMasterById=function(a){return this.getQuestionById(a)||this.getDescriptiveElementMasterById(a)},a.prototype.getDescriptiveElementMasterById=function(a){var b=Nerve.Collection.getItemWithKeyFields(this.formMaster.Model.DescriptiveElements,{Id:a});return b&&Forms.Models.getDescriptiveElementMaster(b)},a.prototype.appendElement=function(b,c){var d=[];b.Id||(b=_.clone(b),b.Id=a.createNewQuestionId());var e=this.getAllElements(),f=e.length>0?e[e.length-1].Order:a.QuestionOrderFloor;if(b.Order=f+a.QuestionOrderDefaultStep,c&&(d=c.map(function(c,d){return c=_.clone(c),c.Id=a.createNewQuestionId(),c.GroupId=b.Id,c.Order=b.Order+(d+1)*a.QuestionOrderDefaultStep,c})),a.isDescriptiveElement(b.Type)){var g=Nerve.Collection.addItems(this.formMaster.Model.DescriptiveElements,[b]);return Forms.Models.getDescriptiveElementMaster(g[0])}var h=[b];h=h.concat(d);var g=Nerve.Collection.addItems(this.formMaster.Model.Questions,h);return OfficeForm.Exports.Models.getQuestionMaster(g[0])},a.prototype.duplicateElement=function(a){var b=a.getSnapshotWithoutBranchInfo();delete b.Id;var c=a.SubQuestionMasters.map(function(a){var b=a.getSnapshotWithoutBranchInfo();return delete b.Id,delete b.GroupId,delete b.QuestionInfo,b});return this.insertElementAfter(b,a,c)},a.prototype.duplicateSectionAndSubElements=function(b){var c=this,d=this.findQuestionsInSection(b,!0),f=_.find(this.SectionMasters,function(a){return a.Model.Order>b.Model.Order}),g=b.Model.Order,h=b.Model.Order+a.QuestionOrderDefaultStep*(d.length+1);d.length>0&&(g=_.last(d).Model.Order),f&&(h=f.Model.Order);var i=(h-g)/(d.length+2),j=_.clone(b.getSnapshot());j.Id=a.createNewQuestionId(),j.Order=g+i,j.Title=e.LocalizedStrings.Title_For_Duplicate_Section.format(j.Title);var k,l=[];return d&&d.forEach(function(b,c){var d=_.clone(b.getSnapshot());switch(d.Id=a.createNewQuestionId(),d.Order=j.Order+i*(c+1),l.push(d),d.Type){case OfficeForm.Exports.Models.QuestionType.MatrixChoiceGroup:k=d.Id;break;case OfficeForm.Exports.Models.QuestionType.MatrixChoice:d.GroupId=k}}),this.formMaster.bulkEdit(function(){Nerve.Collection.addItems(c.formMaster.Model.DescriptiveElements,[j]),Nerve.Collection.addItems(c.formMaster.Model.Questions,l)}),this.getDescriptiveElementMasterById(j.Id)},a.prototype.deleteFormQuestion=function(a){Nerve.Collection.itemsDeletedInSource(a.Form.Model.Questions,a.SubQuestionMasters.map(function(a){return a.Model})),a.Deleted=!0},a.prototype.deleteSectionAndSubElements=function(a){var b=this,c=this.findQuestionsInSection(a);this.formMaster.bulkEdit(function(){c.forEach(function(a){return b.deleteFormQuestion(a)}),a.Deleted=!0})},a.prototype.findQuestionsInSection=function(b,c){if(b){var d=this.SectionMasters,e=a.isSection(b.Model.Type)?_.indexOf(d,b):_.findLastIndex(d,function(a){return a.Model.Order<b.Model.Order});return e>=0?this.findQuestionsInBetween(d[e].Model.Order,e+1<d.length?d[e+1].Model.Order:null,c):[]}return c?this.HeaderQuestionMasters:this.HeaderTopQuestionMasters},a.prototype.moveElementDown=function(b){var c=this.TopElementMasters,e=_.indexOf(c,b);if(e!==c.length-1){var f=c[e+1],g=f instanceof d&&f.SubQuestionMasters.length>0?f.SubQuestionMasters[f.SubQuestionMasters.length-1].Model.Order:f.Model.Order,h=g+a.QuestionOrderDefaultStep;e+1<c.length-1&&(h=c[e+2].Model.Order);var i=b.SubQuestionMasters.map(function(a){return a.Model});this.formMaster.bulkEdit(function(){return a.updateQuestionOrder(b.Model,i,g,h)})}},a.prototype.moveElementUp=function(b){var c=this.TopElementMasters,d=_.indexOf(c,b);if(!(0>=d)){var e=a.QuestionOrderFloor,f=c[d-1],g=_.indexOf(this.AllElementMasters,f);g>0&&(e=this.AllElementMasters[g-1].Model.Order);var h=c[d-1].Model.Order,i=b.SubQuestionMasters.map(function(a){return a.Model});this.formMaster.bulkEdit(function(){return a.updateQuestionOrder(b.Model,i,e,h)})}},a.prototype.moveSectionTo=function(b,c){var d,e=a.QuestionOrderFloor,f=this.SectionMasters,g=_.indexOf(f,b),h=_.indexOf(f,c),i=_.last(this.HeaderTopQuestionMasters);i&&(e=i.Model.Order);var j=this.findQuestionsInSection(b,!0).map(function(a){return a.Model});if(g>h){if(d=c.Model.Order,h>0){e=f[h-1].Model.Order;var k=this.findQuestionsInSection(f[h-1]);k.length>0&&(e=_.max(k,function(a){return a.Model.Order}).Model.Order)}}else{if(!(h>g))return;var k=this.findQuestionsInSection(c);e=f[h].Model.Order,k.length>0&&(e=_.max(k,function(a){return a.Model.Order}).Model.Order),d=e+a.QuestionOrderDefaultStep*(j.length+1),h+1<f.length&&(d=f[h+1].Model.Order)}this.formMaster.bulkEdit(function(){return a.updateDescriptiveElementOrder(b.Model,j,e,d)})},a.prototype.insertElementAfter=function(b,c,e){b=_.clone(b);var f=[];e&&(f=e.map(_.clone));var g=this.getAllElements(),h=a.QuestionOrderFloor,i=h+a.QuestionOrderDefaultStep;if(c){c instanceof d&&c.SubQuestionMasters.length>0&&(c=c.SubQuestionMasters[c.SubQuestionMasters.length-1]);var j=_.indexOf(g,c.Model);j!==g.length-1?(h=c.Model.Order,i=g[j+1].Order):(h=c.Model.Order,i=c.Model.Order+a.QuestionOrderDefaultStep)}else g.length>0&&(i=g[0].Order);if(a.updateQuestionOrder(b,f,h,i),b.Id||(b.Id=a.createNewQuestionId(),f.forEach(function(c){c.Id=a.createNewQuestionId(),c.GroupId=b.Id})),a.isDescriptiveElement(b.Type)){var k=Nerve.Collection.addItems(this.formMaster.Model.DescriptiveElements,[b]);return Forms.Models.getDescriptiveElementMaster(k[0])}var l=[b];l=l.concat(f);var k=Nerve.Collection.addItems(this.formMaster.Model.Questions,l);return OfficeForm.Exports.Models.getQuestionMaster(k[0])},a.prototype.adjustElementOrders=function(){var b=this;if(this.formMaster.isFieldReady(c.Schema.Questions)){var d=this.formMaster.isFieldReady(c.Schema.DescriptiveElements),e=this.getAllElements();e.length&&this.formMaster.bulkEdit(function(){e.sort(a.questionComparer),e[0].Order||(e[0].Order=a.QuestionOrderFloor+a.QuestionOrderDefaultStep);for(var c=0,f=e[0].Order,g=1;g<=e.length;++g){var h=e[g]&&e[g].Order;if(!h)break;if(f!==h){var i=(h-f)/(g-c);for(f+=i;++c<g;)e[c].Order=f,f+=i}}for(;++c<e.length;)f+=a.QuestionOrderDefaultStep,e[c].Order=f;b.formMaster.Model.Questions=e.filter(function(b){return!a.isDescriptiveElement(b.Type)}).map(function(a){return a}),d&&(b.formMaster.Model.DescriptiveElements=e.filter(function(b){return a.isDescriptiveElement(b.Type)}))})}},a.prototype.getFormElements=function(b){var d=Nerve.convertToArray(this.formMaster.Model.Questions);b&&(d=_.filter(d,function(a){return!a.GroupId}));var e=d;return this.formMaster.isFieldReady(c.Schema.DescriptiveElements)&&(e=e.concat(Nerve.convertToArray(this.formMaster.Model.DescriptiveElements)).sort(a.questionComparer)),e},a.prototype.getAllElements=function(){return this.getFormElements(!1)},a.createNewQuestionId=function(){var a=f.Guid.newGuid();return"r"+a.replace(/-/g,"")},a.questionComparer=function(a,b){var c=a.Order-b.Order;return a.Order&&b.Order||(c=-c),c||a.Id.localeCompare(b.Id)},a.updateQuestionOrder=function(a,b,c,d){var e=(d-c)/(b.length+2);a.Order=c+e,b.forEach(function(b,c){b.Order=a.Order+e*(c+1)})},a.updateDescriptiveElementOrder=function(a,b,c,d){var e=(d-c)/(b.length+2);a.Order=c+e,b.forEach(function(b,c){b.Order=a.Order+e*(c+1)})},a.prototype.findQuestionsInBetween=function(a,b,c){var d;return d=c?this.QuestionMasters:this.TopQuestionMasters,null!==b&&(d=d.filter(function(a){return b>a.Model.Order})),null!==a&&(d=d.filter(function(b){return b.Model.Order>a})),d},a}();Forms.Models.FormElementManager=i},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),c(40)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(4),f=c(26),g=OfficeForm.Exports.Models.FormMaster,h=e.Spec,i={BackgroundColor:h.string({IsLocalField:!0}),BackgroundImage:h.string({IsLocalField:!0}),Name:h.string(),PrimaryColor:h.string({IsLocalField:!0}),SecondaryColor:h.string({IsLocalField:!0}),Thumbnail:h.string({IsLocalField:!0})},j=function(a){function b(b){var c=a.call(this,b)||this;if(b.MasterTreeReady){var d=g.Schema;b.MasterTreeReady.then(function(){return c.Form.fieldsReady([d.Theme])}).then(function(){return c.Form.ensureFieldsReady([d.PrimaryCustomizedThemeColor,d.SecondaryCustomizedThemeColor,d.TertiaryCustomizedThemeColor,d.Background])}).done(function(){return c.initialize()})}return c}return d(b,a),Object.defineProperty(b.prototype,"Form",{get:function(){return this.Parent},enumerable:!0,configurable:!0}),b.prototype.isCustomized=function(){var a=this.Model.Name;return!!a&&!f.getPredefinedThemeByName(a)},b.prototype.getCustomizedTheme=function(){var a=this.Form.Model;return{BackgroundColor:a.TertiaryCustomizedThemeColor||f.defaultCustomizedBackgroundColor,BackgroundImage:a.Background.ResourceUrl,Name:f.customizedThemeName,PrimaryColor:a.PrimaryCustomizedThemeColor||f.defaultCustomizedPrimaryColor,SecondaryColor:a.SecondaryCustomizedThemeColor||f.defaultCustomizedSecondaryColor,Thumbnail:null}},b.prototype.initialize=function(){var a=this;this.addRule({Name:"calculate theme basing on name",onChange:function(b){b.BeingDeleted||a.calculateThemeProperties()}});var b=g.Schema;this.Form.observe(function(){return a.calculateThemeProperties()},[b.PrimaryCustomizedThemeColor,b.SecondaryCustomizedThemeColor,b.TertiaryCustomizedThemeColor,b.Background.ResourceUrl]),this.calculateThemeProperties()},b.prototype.calculateThemeProperties=function(){var a=f.getPredefinedThemeByName(this.Model.Name)||this.getCustomizedTheme();this.setData(a)},b}(e.createObjectMasterClass("FormTheme",i));b.FormThemeMaster=j,Forms.Models.FormThemeMaster=j},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d;!function(a){a[a.UpdateFormFailed=609]="UpdateFormFailed",a[a.GetFormFailed=612]="GetFormFailed",a[a.CDBColumnNotFound=621]="CDBColumnNotFound",a[a.CDBTopLevelError=631]="CDBTopLevelError",a[a.ExceedMaximumFormLimition=650]="ExceedMaximumFormLimition",a[a.CDBTableNotFound=674]="CDBTableNotFound",a[a.TableReadOnly=636]="TableReadOnly",a[a.CDBTableMoved=639]="CDBTableMoved",a[a.NoPermission=700]="NoPermission",a[a.RequireLogin=701]="RequireLogin",a[a.UserNotAllowed=702]="UserNotAllowed",a[a.DisabledByTenantAdmin=703]="DisabledByTenantAdmin",a[a.AntiForgeryTokenValidationError=704]="AntiForgeryTokenValidationError",a[a.UserNeedMultiFactorAuth=705]="UserNeedMultiFactorAuth",a[a.NotAllowedBySetting=708]="NotAllowedBySetting",a[a.TokenExpired=711]="TokenExpired",a[a.NotRolloutMsaUser=712]="NotRolloutMsaUser",a[a.CoAuthNotAllowedForMsa=715]="CoAuthNotAllowedForMsa",a[a.NotAllowedByResponseOwnership=716]="NotAllowedByResponseOwnership",a[a.FailedToCheckUserLicense=750]="FailedToCheckUserLicense",a[a.ImageNotFound=805]="ImageNotFound",a[a.InvalidFormId=1001]="InvalidFormId",a[a.NotSupportComposeFormId=1002]="NotSupportComposeFormId",a[a.ResponseNotFound=1007]="ResponseNotFound",a[a.FormClosed=5e3]="FormClosed",a[a.MultiResponseNotAllowed=5001]="MultiResponseNotAllowed",a[a.FormNotStarted=5002]="FormNotStarted",a[a.FormEnded=5003]="FormEnded",a[a.FormSettingJSONParseError=5004]="FormSettingJSONParseError",a[a.NoODPermissionForOpenInExcel=5117]="NoODPermissionForOpenInExcel",a[a.FailedToCreatePermission=5501]="FailedToCreatePermission",a[a.FailedToDeletePermission=5503]="FailedToDeletePermission",a[a.CreateInfoNotCompletePermission=5504]="CreateInfoNotCompletePermission",a[a.DeleteNotExistPermission=5506]="DeleteNotExistPermission",a[a.CopyNotAllowed=5550]="CopyNotAllowed",a[a.FailedToTurnOnAllowCopy=5551]="FailedToTurnOnAllowCopy",a[a.FailedToTurnOffAllowCopy=5552]="FailedToTurnOffAllowCopy",a[a.IncorrectShareToken=5553]="IncorrectShareToken",a[a.ImageUploadFailed=5200]="ImageUploadFailed",a[a.ImageTypeConvertFailed=5201]="ImageTypeConvertFailed",a[a.ImageProviderGetCDBTokenFailed=5202]="ImageProviderGetCDBTokenFailed",a[a.CdbServiceUnavailable=6503]="CdbServiceUnavailable",a[a.OriginalOwnerIsEmpty=6700]="OriginalOwnerIsEmpty",a[a.OriginalOwnerNotFound=6701]="OriginalOwnerNotFound",a[a.CurrentSignedUserIsNotDelegator=6702]="CurrentSignedUserIsNotDelegator",a[a.EmbedFormNeedAuth=10001]="EmbedFormNeedAuth",a[a.WorkBookLostFocus=10100]="WorkBookLostFocus",a[a.GetTableDataFailed=10101]="GetTableDataFailed",a[a.InvalidWorkBookSchema=10102]="InvalidWorkBookSchema",a[a.DeleteFormFailed=10201]="DeleteFormFailed",a[a.DeleteFormSuccessed=10202]="DeleteFormSuccessed",a[a.DownloadExcelFileFailed=10203]="DownloadExcelFileFailed",a[a.DownloadExcelFileFailedOnIos=10204]="DownloadExcelFileFailedOnIos",a[a.ReexportToExcelFailed=10205]="ReexportToExcelFailed",a[a.DownloadExcelFileTimeout=10206]="DownloadExcelFileTimeout",a[a.FormCreationFromQTIFailed=10300]="FormCreationFromQTIFailed",a[a.FormCreationFromQTITimeout=10301]="FormCreationFromQTITimeout",a[a.NetworkIssue=15001]="NetworkIssue",a[a.GetGraphAPITokenFailed=15002]="GetGraphAPITokenFailed",a[a.LoginNotSupportInCurrentBrowser=15003]="LoginNotSupportInCurrentBrowser"}(d=b.InnerCode||(b.InnerCode={}))},function(a,b,c){"use strict";function d(){return g&&"rejected"!==g.state()||(g=i.createDataProvider().getOD4BToken()),g}function e(){return g&&"pending"===g.state()||(g=i.createDataProvider().getOD4BToken()),g}function f(a){return d().then(a).then(function(a){return a},function(b){return b&&b.response&&b.response.statusCode===h.Unauthorized?e().then(a):b})}Object.defineProperty(b,"__esModule",{value:!0});var g,h,i=OfficeForm.Exports.DataProvider;!function(a){a[a.Unauthorized=401]="Unauthorized"}(h||(h={})),b.sendRequestWithToken=f},function(a,b,c){"use strict";function d(a){var b=JSON.stringify({item:{"@microsoft.graph.conflictBehavior":"rename"}});return f.sendRequestWithToken(function(c){return g.OData.send({body:b,headers:{Authorization:c,"Content-Type":"application/json"},method:"POST",qosEventName:j,requestUri:a}).then(function(a){if(null==a)return $.Deferred().reject(new Error("no data return")).promise();var b={bytesToSend:0,deferred:$.Deferred(),exporationDateTime:a.expirationDateTime,uploadUrl:a.uploadUrl};return b})})}function e(a){var b=OfficeForm.Exports.Utilities.FormId.decodeFormId(a),c=b.OwnerId,d=b.OrgId,e=b.IsGroupOwner?"groups":"users";return d+"/"+e+"/"+c}Object.defineProperty(b,"__esModule",{value:!0});var f=c(42),g=OfficeForm.Exports.DataProvider,h=OfficeForm.Exports.EnvironmentConfig,i="FileUpload.CancelUploadFile",j="FileUpload.CreateUploadSession",k="FileUpload.DeleteFile",l="FileUpload.GetOD4BFolderPath",m="FileUpload.UploadLargeFile",n="FileUpload.UploadFile",o=h.isProduction()?"https://graph.microsoft.com/v1.0/":"https://graph.microsoft-ppe.com/v1.0/",p=function(){function a(a){this.formId=a}return a.prototype.createFileUploadSession=function(a){var b=""+o+e(this.formId)+"/drive/special/approot:/Temp/"+(a+":/createUploadSession");return d(b)},a.prototype.createFileUploadSessionWithTempFolder=function(a,b){var c=""+o+e(this.formId)+"/drive/items/"+a+(":/"+b+":/createUploadSession");return d(c)},a.prototype.cancelUploadFile=function(a){return f.sendRequestWithToken(function(b){return g.OData.send({headers:{Authorization:b},method:"DELETE",qosEventName:i,requestUri:a})})},a.prototype.deleteUploadFile=function(a){var b=this;return f.sendRequestWithToken(function(c){return g.OData.send({headers:{Authorization:c},method:"DELETE",qosEventName:k,requestUri:""+o+e(b.formId)+"/drive/items/"+a})})},a.prototype.uploadBytesToSession=function(a,b,c,d,e,h){return f.sendRequestWithToken(function(c){return g.OData.send({body:b,headers:{"Content-Range":"bytes "+d+"-"+e+"/"+h,"Content-Type":"*/*"},method:"PUT",qosEventName:m,requestUri:a.uploadUrl}).then(function(a){return e===h-1?{fileType:a.file.mimeType,id:a.id,link:a.webUrl,name:a.name,referenceId:a.parentReference.id,size:a.size,status:1}:void 0})})},a.prototype.uploadSmallFile=function(a,b){var c=this,d=$.Deferred(),h=new FileReader;return h.readAsArrayBuffer(a),h.onloadend=function(){f.sendRequestWithToken(function(a){return g.OData.send({body:h.result,headers:{Authorization:a,"Content-Type":"text/plain"},method:"PUT",qosEventName:n,requestUri:""+o+e(c.formId)+"/drive/special/approot:/Temp/"+(b+":/content")}).then(function(a){d.resolve({fileType:a.file.mimeType,id:a.id,link:a.webUrl,name:a.name,referenceId:a.parentReference.id,size:a.size,status:1})},function(a){d.reject(a)})})},d.promise()},a.prototype.getFileFolder=function(a){var b=this;return f.sendRequestWithToken(function(c){return g.OData.send({headers:{Authorization:c,"Content-Type":"*/*"},method:"GET",qosEventName:l,requestUri:""+o+e(b.formId)+"/drive/items/"+a}).then(function(a){return a.webUrl})})},a}();b.FileUploadProcessProvider=p,Forms.DataProvider.FileUploadProcessProvider=p},function(a,b,c){"use strict";function d(a,b){var c=b.bytesToSend?b.bytesToSend:0,d=i.FileUploadMaxChunkBytes,e=a.size-b.bytesToSend;e>d&&(e=d);var f=c+e-1;return{chunkSize:e,finalByteIndex:f,initialByteIndex:c}}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var f=c(4),g=c(43),h=f.Spec,i=OfficeForm.Exports.FormLimitation,j={fileId:h.string(),hasFile:h["boolean"](),uploadSession:h.reference()},k=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.formId="",b}return e(b,a),b.prototype.uploadLargeFile=function(a,b,c){var d=this;return new g.FileUploadProcessProvider(c).createFileUploadSession(b).then(function(b){return d.uploadLargeFileInternal(a,b)})},b.prototype.uploadLargeFileWithTempFolder=function(a,b,c,d){var e=this;return new g.FileUploadProcessProvider(d).createFileUploadSessionWithTempFolder(b,c).then(function(b){return e.uploadLargeFileInternal(a,b)})},b.prototype.uploadSmallFile=function(a,b,c){return new g.FileUploadProcessProvider(c).uploadSmallFile(a,b)},b.prototype.deleteUploadFile=function(a,b){return new g.FileUploadProcessProvider(b).deleteUploadFile(a)},b.prototype.cancelUploadFile=function(a){return new g.FileUploadProcessProvider(this.formId).cancelUploadFile(a.uploadUrl).done(function(){return a.deferred.reject()})},b.prototype.uploadBytesToSession=function(a,b,c){var e=this;void 0===c&&(c=0);var f=2;if(b&&"rejected"!==b.deferred.state()){if(c>=f)return void this.cancelUploadFile(b);var g=d(a,b),h=new FileReader;h.onerror=function(a){e.cancelUploadFile(b)},h.onload=function(d){e.uploadReadBytesToSession(h.result,a,b,c,g)};var i=a.slice(g.initialByteIndex,g.finalByteIndex+1);h.readAsArrayBuffer(i)}},b.prototype.uploadReadBytesToSession=function(a,b,c,d,e){var f=this;return new g.FileUploadProcessProvider(this.formId).uploadBytesToSession(c,a,e.chunkSize,e.initialByteIndex,e.finalByteIndex,b.size).done(function(a){e.finalByteIndex<b.size-1?(c.bytesToSend=e.finalByteIndex+1,f.uploadBytesToSession(b,c)):c.deferred.resolve(a)}).fail(function(a){f.uploadBytesToSession(b,c,d+1)})},b.prototype.uploadLargeFileInternal=function(a,b){return this.Model.uploadSession=b,this.uploadBytesToSession(a,b),b.deferred.promise()},b}(f.createObjectMasterClass("UploadFileProcessMaster",j));b.FileUploadProcessMaster=k},function(a,b,c){"use strict";function d(a,b){var c=a.replace(/\s/,"");return b?c[c.length-1]:c[0]}function e(a,b){var c=a.replace(/\s/,"");return c.length<=2?b?c[0]:c[c.length-1]:b?c.substr(0,2):c.substr(c.length-2,c.length)}function f(a,b){var c="",d=a.split(" ");return 2===d.length?(c+=d[0].charAt(0).toUpperCase(),c+=d[1].charAt(0).toUpperCase()):3===d.length?(c+=d[0].charAt(0).toUpperCase(),c+=d[2].charAt(0).toUpperCase()):0!==d.length&&(c+=d[0].charAt(0).toUpperCase()),b&&c.length>1?c.charAt(1)+c.charAt(0):c}function g(a){return a=a.replace(k,""),a=a.replace(l,""),a=a.replace(m," "),a=a.trim()}function h(a,b){return null==a?"":(arguments.length<2&&(b=j.isRtl()),a=g(a),n.test(a)?d(a,!!b):o.test(a)||p.test(a)?e(a,!!b):f(a,!!b))}function i(a,b){return h(((a||"")+" "+(b||"")).trim())}Object.defineProperty(b,"__esModule",{value:!0});var j=OfficeForm.Exports.Utilities,k=new RegExp("\\(([^)]*)\\)","gi"),l=new RegExp("(?:[\x00-/:-@[-^`{--]|[-][-]|[-](?![-])|(?:[^-]|^)[-]) ","gi"),m=new RegExp("\\s+","gi"),n=new RegExp("[--]"),o=new RegExp("[-|-|-|-|-]"),p=new RegExp("[---]|[-][-]|[--]|[-][-]|[--]|[-]");b.getInitials=h,b.getDisplayText=i,Forms.UX.getDisplayText=i,Forms.UX.getInitials=h},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0);c(68);var g=c(44),h=c(2),i=c(25),j=c(1),k=OfficeForm.Exports.Control,l=OfficeForm.Exports.Flighting,m=OfficeForm.Exports.Resources,n="ResponsePage.FileUpload.UploadFile",o="ResponsePage.FileUpload.CancelUpload",p="ResponsePage.FileUpload.DeleteFile",q=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.showFileNameTimeOut=2e3,b.waitingToShowErrorAlert=1e3,b.errorMessageTimeOut=1e4,b.mounted=!1,b.fileUploadElementRef=f.createRef(),b.fileInputRef=f.createRef(),b.state={ErrorMessage:"",IsFocusedOnButton:!0,IsFocusedOnFileContainer:!1,IsUploadingFile:!1,ShowFileName:!1},b.cancelUploadFileCallBack=function(){return b.cancelFileUpload()},b.deleteFileCallBack=function(){return b.deleteFile()},b.uploadFileInPutCallBack=function(){return b.uploadFileInPut()},b}return d(b,a),b.prototype.componentWillMount=function(){this.fileUploadProcessMaster||(this.fileUploadProcessMaster=new g.FileUploadProcessMaster),this.setState({ShowFileName:this.props.IsStudentViewMode}),this.mounted=!0},b.prototype.componentWillUnmount=function(){this.mounted=!1},b.prototype.componentDidUpdate=function(){this.fileUploadElementRef.current&&!this.state.IsFocusedOnButton&&this.fileUploadElementRef.current.focus()},b.prototype.render=function(){return f.createElement("div",e({},this.props.FileUploadProps),this.createShowFileInfoButton(),this.createFileUploadedButton(),this.createUploadingFileButton(),this.createFileUploadDefaultButton(),this.fileInputContainer(),this.errorMessageContainer())},b.prototype.errorMessageContainer=function(){return f.createElement("div",{className:"office-form-upload-file-error-message-container",role:"alert"},this.state.ErrorMessage)},b.prototype.createShowFileInfoButton=function(){if(this.props.Answer&&this.props.ShowFileInfo){var a=JSON.parse(this.props.Answer);if(a.length>0){var b=a[0],c=i.getFileIcon(b.name);return f.createElement("div",{className:"office-form-upload-file-container"},c,f.createElement("a",{href:b.link,target:"_blank"},b.name))}}},b.prototype.createFileUploadedButton=function(){var a=this,b=this.props;if(b.Answer&&(this.fileUploadProcessMaster.Model.hasFile||b.IsStudentViewMode)){var c=JSON.parse(b.Answer);if(c.length>0){var d=c[0],g=this.state,h=g.ShowFileName?i.getFileIcon(d.name):k.createFontIconControl({HTMLAttributes:{className:"forms-icon-size20x20"},IconName:"CheckMark"}),j={className:"office-form-uploadFile",onBlur:function(b){b.stopPropagation(),a.setState({IsFocusedOnButton:!0})},ref:this.fileUploadElementRef,tabIndex:0,title:g.ShowFileName?d.name:void 0},l={className:"office-form-uploadFile-container",onBlur:function(){a.setState({IsFocusedOnFileContainer:!1})},onFocus:function(){a.setState({IsFocusedOnFileContainer:!0})}},n=g.ShowFileName?void 0:m.LocalizedStrings.UploadFile_Done;return f.createElement("div",e({},l),f.createElement("div",e({},j,{"aria-label":n}),h,this.createFileNameContainer(),this.createUploadedDoneMessage()),this.createDeleteButton())}}},b.prototype.createFileNameContainer=function(){if(this.state.ShowFileName){var a=JSON.parse(this.props.Answer||"[]");if(a.length>0){var b=a[0],c="office-form-uploadFile-text office-form-uploadFile-name";return this.props.Disabled?f.createElement("span",{className:c},b.name):f.createElement("a",{className:c,href:b.link,target:"_blank"},b.name)}}},b.prototype.createUploadedDoneMessage=function(){return this.state.ShowFileName?void 0:f.createElement("span",{className:"office-form-uploadFile-text"
},m.LocalizedStrings.UploadFile_Done)},b.prototype.createDeleteButton=function(){return this.state.ShowFileName&&!this.props.HideDeleteButton?k.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{className:this.state.IsFocusedOnFileContainer?"office-form-delete-button inline-display":"office-form-delete-button none-display",onClick:this.deleteFileCallBack,title:m.LocalizedStrings.Delete_Button_Narrator},Icon:"Delete",IconClassName:"delete-file-button forms-icon-size16x16",key:"deleteFileButton"}):void 0},b.prototype.createUploadingFileButton=function(){if(!this.props.Answer&&!this.props.IsStudentViewMode&&this.state.IsUploadingFile){var a=k.createTextButton({ButtonStyle:"LightBackground",HTMLAttributes:{className:"office-form-cancel-fileUpload office-form-theme-primary-foreground office-form-theme-button-color",onClick:this.cancelUploadFileCallBack},Text:m.LocalizedStrings.UploadFile_Cancel_Button}),b={className:"office-form-uploadFile",ref:this.fileUploadElementRef,tabIndex:0},c=m.LocalizedStrings.UploadFile_Doing,d="uploading office-form-theme-primary-color forms-icon-size14x14";return f.createElement("div",{className:"office-form-uploadFile-container"},f.createElement("div",e({},b,{"aria-label":c}),f.createElement(k.FontIconControl,{HTMLAttributes:{className:d},IconName:"Sync"}),f.createElement("span",{className:"office-form-uploadFile-text"},c)),a)}},b.prototype.createFileUploadDefaultButton=function(){var a=this;if(!(this.props.Answer||this.props.IsStudentViewMode||this.state.IsUploadingFile)){var b=this.props,c={className:"office-form-upload-container office-form-theme-primary-foreground",disabled:b.Disabled,onBlur:function(){a.setState({IsFocusedOnButton:!0})},onClick:this.uploadFileInPutCallBack,ref:this.fileUploadElementRef},d=m.LocalizedStrings.UploadFile_Button+"\n                            "+m.LocalizedStrings.UploadFile_AllowFileType_Text.format(this.allowedFileText);c["aria-label"]=d;var e=k.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"Horizontal",HTMLAttributes:c,Icon:"Upload",IconClassName:"forms-icon-size18x18",Text:m.LocalizedStrings.UploadFile_Button,TextClassName:"office-form-upload-text"});return f.createElement("div",null,e,this.allowedFileTypesMessage())}},b.prototype.uploadFileInPut=function(){$(this.fileInputRef.current).val("").click()},b.prototype.allowedFileTypesMessage=function(){var a=this,b=[],c=Object.keys(this.props.FileTypes);return c.forEach(function(c){a.props.FileTypes[c]&&b.push(i.convertFileTypeToString(c))}),this.allowedFileText=b.join(m.LocalizedStrings.UploadFile_Comma),f.createElement("span",{className:"office-form-upload-allowTypes"},m.LocalizedStrings.UploadFile_AllowFileType_Text.format(this.allowedFileText))},b.prototype.fileInputContainer=function(){var a=this,b=i.getAcceptedFileTypes(this.props.FileTypes),c="";b.forEach(function(a){c+="."+a+","});var d={accept:c,className:"file-upload-question-file-reader",onChange:function(c){var d=c&&c.target,e=d&&d.files,f=e&&e[0];if(f){var g=f.name.split("."),h=g[g.length-1].toLowerCase();if(-1!==b.indexOf(h)){a.setState({ErrorMessage:""});var i=a.fileInputRef.current.value,j=i.replace(/^.*[\\\/]/,"");j=j.replace(/[%#]/g,"-"),a.uploadFile(f,j)}else a.setErrorMessageWithTimeOut(m.LocalizedStrings.UploadFile_WrongFileType_ErrorMessage)}},ref:this.fileInputRef,type:"file"};return f.createElement("input",e({},d))},b.prototype.uploadFile=function(a,b){var c=this;OfficeFormServerInfo.userInfo.UserId||OfficeForm.Exports.Authenticator.redirectToLogin(),this.props.increaseUploadingFileCountCallBack&&this.props.increaseUploadingFileCountCallBack(),this.setState({IsFocusedOnButton:!1,IsUploadingFile:!0,ShowFileName:!1});var d=this.fileUploadProcessMaster;l.Flight.isEnabled(l.Flights.FileUploadOnlyLargeFileAPI)||a.size>OfficeForm.Exports.FormLimitation.FileUploadSmallFileBytes?l.Flight.isEnabled(l.Flights.FileUploadTempFolder)?this.props.createOD4BTempFolderCallBack&&this.props.createOD4BTempFolderCallBack().done(function(d){if(d)c.fileUploadProcessMaster.uploadLargeFileWithTempFolder(a,d,b,c.props.FormId).done(function(a){c.setAnswer(a),setTimeout(function(){c.mounted&&!c.state.ShowFileName&&c.setState({ShowFileName:!0})},c.showFileNameTimeOut)}).fail(function(a){c.uploadFileErrorHandling(a)});else{var e=new Error(m.LocalizedStrings.UploadFile_Default_ErrorMessage);c.uploadFileErrorHandling(e)}}).fail(function(a){c.uploadFileErrorHandling(a)}):d.uploadLargeFile(a,b,this.props.FormId).done(function(a){c.setAnswer(a),setTimeout(function(){c.mounted&&!c.state.ShowFileName&&c.setState({ShowFileName:!0})},c.showFileNameTimeOut)}).fail(function(a){c.uploadFileErrorHandling(a)}):d.uploadSmallFile(a,b,this.props.FormId).done(function(a){c.setAnswer(a)}).fail(function(a){c.uploadFileErrorHandling(a)})},b.prototype.uploadFileErrorHandling=function(a){a&&(this.setState({IsUploadingFile:!1}),this.setErrorMessageWithTimeOut(m.LocalizedStrings.UploadFile_Default_ErrorMessage),this.props.decreaseUploadingFileCountCallBack&&this.props.decreaseUploadingFileCountCallBack())},b.prototype.setAnswer=function(a){h.log({eventName:n,eventType:"engagement_event"});var b=this.fileUploadProcessMaster.Model;b.fileId=a.id,b.hasFile=!0,this.props.setAnswerCallback(JSON.stringify([a])),this.setState({IsUploadingFile:!1}),this.props.decreaseUploadingFileCountCallBack&&this.props.decreaseUploadingFileCountCallBack()},b.prototype.deleteFile=function(){var a=this,b=this.fileUploadProcessMaster;b.deleteUploadFile(b.Model.fileId,this.props.FormId).done(function(){h.log({eventName:p,eventType:"engagement_event"}),b.Model.hasFile=!1,a.setState({IsFocusedOnButton:!1}),a.props.setAnswerCallback(null)}).fail(function(){a.setErrorMessageWithTimeOut(m.LocalizedStrings.UploadFile_FailedToDelete_ErrorMessage)})},b.prototype.cancelFileUpload=function(){var a=this,b=this.fileUploadProcessMaster;b.Model.uploadSession&&(h.log({eventName:o,eventType:"engagement_event"}),b.cancelUploadFile(b.Model.uploadSession).done(function(){a.props.decreaseUploadingFileCountCallBack&&a.props.decreaseUploadingFileCountCallBack(),a.setState({IsUploadingFile:!1})}).fail(function(){a.setErrorMessageWithTimeOut(m.LocalizedStrings.UploadFile_FailedToCancel_ErrorMessage)}))},b.prototype.setErrorMessageWithTimeOut=function(a){var b=this;setTimeout(function(){b.setState({ErrorMessage:a})},this.waitingToShowErrorAlert),setTimeout(function(){b.mounted&&b.state.ErrorMessage&&b.setState({ErrorMessage:""})},this.errorMessageTimeOut)},b}(j.ReactComponent);b.FileUploadQuestionRenderer=q},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(3),g=c(58),h=c(1),i=c(30),j=c(31),k=OfficeForm.Exports.Models,l=OfficeForm.Exports.Utilities,m=k.ImageSize,n=k.ImageLayout,o=k.ImageProcessingStatus,p=OfficeForm.Exports.FormLimitation,q=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.componentDidMount=function(){var a=this;this.update=function(){return a.forceUpdate()};var b=this.props.Master,c=Forms.Models.DescriptiveElementMaster.Schema;b.observe(this.update,[c.Title,c.Subtitle,c.VideoInfo]);var d=k.ImageSettingsMaster.Schema;b.ImageSettingsMaster.observe(this.update,[d.NaturalWidth,d.NaturalHeight,d.ContainerWidth,d.ContainerHeight,d.Size,d.Layout]);var e=k.ImageInfoMaster.Schema;b.ImageInfoMaster.observe(this.update,[e.ImageProcessingStatus,e.UploadParameters])},b.prototype.componentWillUnmount=function(){var a=this.props.Master;a.unobserve(this.update),a.ImageInfoMaster.unobserve(this.update),a.ImageSettingsMaster.unobserve(this.update)},b.prototype.render=function(){var a,b=this.props.Master,c=b.Model,d="Right",h=c.VideoInfo,m=b.ImageInfoMaster,n=b.ImageSettingsMaster,p=m.Model;if(p.ErrorType||p.ImageProcessingStatus===o.Idle&&!k.hasImage(p))h&&h.Url&&(d="Bottom",a=e.createElement(g.VideoControl,{ClassNameForIFrame:"design-question-title-video-frame",HTMLAttributes:{className:"design-question-image-title-big-horizontal"},Url:h.Url}));else{var q=this.calcImageLayout(n.Model);d=q.ImageLayout,a=e.createElement(j.ImageRenderer,{FullFilled:"Bottom"===d,ImageWidth:q.Width,ImageHeight:q.Height,ImageInfoMaster:m,ImageSettingMaster:n,ImageType:"Section"})}var r=f.extend({},this.props.HTMLAttributes);r.className=l.Html.combineAttributes(r.className,"__section-title__ office-form-section-title",a?"office-form-theme-image-question-background":"",this.props.Master.Form.Model.HasQuestionMedia&&"with-image");var s={className:"office-form-theme-primary-color"};return e.createElement(i.TitleMediaRenderer,{Heading:2,HTMLAttributes:r,HTMLPropsForInnerElement:s,MediaLayout:d,SubTitle:c.Subtitle,Title:c.Title},a)},b.prototype.calcImageLayout=function(a){return this.props.IsMobile||l.isSmallScreen()||a.Layout===n.Horizontal&&a.Size===m.Large?{ImageLayout:"Bottom"}:{Height:a.ContainerHeight||p.ImagePlaceHolderHeight,ImageLayout:"Right",Width:a.ContainerWidth||p.ImagePlaceHolderWidth}},b}(h.ReactComponent);b.SectionTitleRenderer=q},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(3),h=c(1),i=OfficeForm.Exports.Control.FontIconControl,j=OfficeForm.Exports.Models,k=OfficeForm.Exports.Utilities,l=function(a){function b(b){var c=a.call(this,b)||this;return c.rootRef=f.createRef(),c.onQuestionChangeCallback=function(){return c.forceUpdate()},c.state={FocusedIndex:-1},c.expandWhenFocus=c.expandWhenFocus.bind(c),c.onValueChange=c.onValueChange.bind(c),c.lostFocus=c.lostFocus.bind(c),c}return d(b,a),b.prototype.componentWillMount=function(){this.props.Disabled||this.props.QuestionRuntimeMaster.observe(this.onQuestionChangeCallback,[j.QuestionRuntimeMaster.Schema.Answer]),this.props.QuestionMaster.observe(this.onQuestionChangeCallback,[j.QuestionMaster.Schema.Title])},b.prototype.componentWillUnmount=function(){this.props.Disabled||this.props.QuestionRuntimeMaster.unobserve(this.onQuestionChangeCallback),this.props.QuestionMaster.unobserve(this.onQuestionChangeCallback)},b.prototype.render=function(){return this.props.PadView?f.createElement("div",{className:"office-form-mobile-matrix-points",onBlur:this.lostFocus,onFocus:this.expandWhenFocus,ref:this.rootRef},this.createMobileQuestionRow()):f.createElement("tr",{className:"office-form-matrix-str",role:"radiogroup"},this.createQuestionRow())},b.prototype.expandWhenFocus=function(a){this.props.IsExpanded||this.props.onChange(this.props.QuestionIndex,!0);var b=a.target;this.setState({FocusedIndex:parseInt(b.value,10)})},b.prototype.lostFocus=function(a){var b=a.relatedTarget,c=this.rootRef.current;c&&!c.contains(b)&&this.setState({FocusedIndex:-1})},b.prototype.createQuestionRow=function(){var a=this,b=[],c=f.createElement("span",{className:"office-form-matrix-subquestion",id:this.getSubLabelId(this.props.QuestionIndex)},this.props.QuestionMaster.Model.Title),d=f.createElement("td",{className:"office-form-matrix-std",key:"subQuestionTitle"},c);b.push(d);var e=g.map(this.props.Choices,function(b,c){var d=!1;if(!a.props.ShowDesignInfo){var e=a.props.QuestionRuntimeMaster&&a.props.QuestionRuntimeMaster.Model.Answer;d=e&&g.isEqual(e.id,b.Id)}return a.createMatrixRadio(a.props.QuestionMaster.Model.Id,c,!!d)});return b=b.concat(e)},b.prototype.createMatrixRadio=function(a,c,d){var e=this.props,g=e.Disabled,h=e.Choices,i=e.PadView,j="subquestion-radio-"+a,l=this.getLabelId(c),m=f.createElement("input",{"aria-checked":d,"aria-labelledby":l+" "+this.getSubLabelId(this.props.QuestionIndex),"aria-posinset":c+1,"aria-setsize":h.length,checked:d,disabled:g,name:j,onChange:g?void 0:this.onValueChange,type:"radio",value:c});if(i){var n=k.Html.combineAttributes("office-form-question-matrix-choice","office-form-theme-page-background-active",d?"active":""),o=k.Html.combineAttributes("radio-icon "+(this.state.FocusedIndex===c?"focused":""),"ms-Icon ms-Icon--"+(d?"RadioBtnOn":"RadioBtnOff"),""+(g?"disabled":""));return f.createElement("li",{key:c,className:n},f.createElement("label",{className:"office-form-question-matrix-choice-row"},m,f.createElement("i",{className:o,"aria-hidden":"true"}),f.createElement("span",{className:"office-form-question-matrix-choice-text",id:l},h[c].Description)))}return f.createElement("td",{className:"office-form-matrix-radio",key:c,onClick:b.enlargeClickArea},f.createElement("label",{className:"office-form-matrix-label"},m))},b.enlargeClickArea=function(a){var b=a.target;b===a.currentTarget&&b.firstChild.click()},b.prototype.getLabelId=function(a){return this.props.QuestionOrdinal+"-col-"+(a+1)},b.prototype.createMobileQuestionRow=function(){var a=this,b=this.props,c=b.QuestionMaster,d=b.Choices,e=b.QuestionRuntimeMaster,h=b.QuestionIndex,i=-1,j=g.map(d,function(b,d){var f=!1;if(!a.props.ShowDesignInfo){var h=e&&e.Model.Answer;f=h&&g.isEqual(h.id,b.Id)}return f&&(i=d),a.createMatrixRadio(c.Model.Id,d,f)}),k=f.createElement("ul",{className:"office-form-mobile-matrix-choices",key:"choicelist",role:"radiogroup"},j),l=-1!==i?d[i].Description:"",m=this.createQuestionTitle(c.Model.Title,l,h);return[m,k]},b.prototype.getSubLabelId=function(a){return this.props.QuestionOrdinal+"-row-"+(a+1)},b.prototype.createQuestionTitle=function(a,b,c){var d=this,g={className:"office-form-mobile-matrix-title",id:this.getSubLabelId(c),key:"subquestion-title",onClick:this.props.PadView?function(){return d.props.onChange(c,!d.props.IsExpanded)}:void 0,ref:function(a){if(a){var b=a.parentElement,c=a.offsetHeight;d.props.IsExpanded&&(c+=a.nextElementSibling.offsetHeight),b&&(b.style.height=c+"px")}}};return f.createElement("div",e({},g),f.createElement("div",{className:"office-form-mobile-matrix-title-header"},f.createElement("span",null,a),f.createElement(i,{HTMLAttributes:{className:"select-dropdown-arrow forms-icon-size20x20"},IconName:this.props.IsExpanded?"ChevronUp":"ChevronDown"})),f.createElement("div",{className:"office-form-mobile-matrix-answered-indicator"},f.createElement("span",null,b)))},b.prototype.onValueChange=function(a){var b=this.props.QuestionRuntimeMaster,c=a.currentTarget,d=c.checked?{id:this.props.Choices[parseInt(c.value,10)].Id}:void 0;b&&(this.props.PadView&&this.props.onChange(this.props.QuestionIndex+1,!0),b.Model.Answer=d)},b}(h.ReactComponent);b.LikertSubQuestionRenderer=l},function(a,b,c){"use strict";function d(a){return i.Flight.isEnabled(i.Flights.DisableBrandingForMSA)&&OfficeFormServerInfo.userInfo.IsMsa?f.createElement(h.TitleContainerV1,e({},a)):f.createElement(g.TitleContainer,e({},a))}var e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(82),h=c(83),i=OfficeForm.Exports.Flighting;b.createTitleContainerMixer=d,Forms.UX.Renderer.createTitleContainerMixer=d},function(a,b,c){"use strict";function d(a){var b=$.Deferred();if(e.Flight.isEnabled(e.Flights.EnableFormsProRoute)){var c=window.location.pathname,d=c.toLowerCase().startsWith(g.toLowerCase());if(!a!=!d)return c=a?g+c:c.substring(g.length),f.replacePathName(c),b.promise()}return b.resolve().promise()}Object.defineProperty(b,"__esModule",{value:!0});var e=OfficeForm.Exports.Flighting,f=c(5),g="/FormsPro";b.ensureEnvironment=d,Forms.FormsProRelated.ensureEnvironment=d},function(a,b,c){"use strict";function d(a){return g.createElement(k,a)}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),f=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var g=c(0),h=c(1),i=OfficeForm.Exports.ColorHelper,j=OfficeForm.Exports.Control.createFontIconControl,k=function(a){function b(b){return a.call(this,b)||this}return e(b,a),b.prototype.render=function(){var a=this.createColorInfo(),b=this.props.displayText?this.props.displayText.toLocaleUpperCase():j({HTMLAttributes:{className:"author-notification-icon"},IconName:"Contact"}),c={backgroundColor:a.backgroundColor,color:a.textColor},d={"aria-label":this.props.ariaLabel||this.props.tooltip,className:"author-notification-content",style:c,title:this.props.tooltip};return g.createElement("div",f({},d),g.createElement("span",{"aria-hidden":!0},b))},b.createColor=function(a){for(var c=8,d=0,e=a.length-1;e>=0;e--){var f=a.charCodeAt(e),g=e%c;d^=(f<<g)+(f>>c-g)}var h=d%b.COLOR_SWATCHES_LOOKUP.length;return b.COLOR_SWATCHES_LOOKUP[h]},b.prototype.createColorInfo=function(){var a=this.props,c="",d="";a.backgroundColor&&(c=i.colorToHex(a.backgroundColor)),a.textColor&&(d=i.colorToHex(a.textColor));var e=a.email||a.name;return""!==d&&""!==c||!e||(c=c||b.createColor(e),d=d||i.colorToHex(i.contrastingColor(i.hexToRGB(c)))),c=c||b.defaultBackgroundColor,d=d||b.defaultTextColor,{backgroundColor:c,textColor:d}},b.COLOR_SWATCHES_LOOKUP=["#3765E4","#D83B01","#B91C49","#910A19","#E40089","#971497","#8150FD","#562685","#2C5797","#007B8A","#11723F","#6F292A","#A16412"],b.defaultBackgroundColor=b.COLOR_SWATCHES_LOOKUP[0],b.defaultTextColor="#FFFFFF",b}(h.ReactComponent);b.AuthorFacePile=k,b.createFacePile=d,Forms.UX.createFacePile=d},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(3),f=OfficeForm.Exports.Insight.InsightViewBase,g=OfficeForm.Exports.Utilities,h=function(a){function b(b){var c=a.call(this,b)||this;c.chartContainerIds=new Array;for(var d=c.getChartContainersCount(),e=0;d>e;e++)c.chartContainerIds.push(g.Guid.newGuid());return c}return d(b,a),b.prototype.componentDidMount=function(){this.drawCharts(),a.prototype.componentDidMount.call(this)},b.prototype.componentWillUnmount=function(){a.prototype.componentWillUnmount.call(this)},b.prototype.updateContent=function(){this.drawCharts()},b.prototype.getChartContainersCount=function(){return 1},b.prototype.getChartContainerId=function(a){return this.chartContainerIds[a||0]},b.prototype.drawChart=function(a){var b=this.getChartContainerId(a);Highcharts.chart(b,this.getChartOptions(a))},b.prototype.drawCharts=function(){var a=this;e.forEach(this.chartContainerIds,function(b,c){Highcharts.chart(b,a.getChartOptions(c))})},b}(f);b.InsightViewWithHighCharts=h},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(3),h=c(1),i=OfficeForm.Exports.Control,j=OfficeForm.Exports.Utilities,k=OfficeForm.Exports.Resources,l=function(a){function b(b){var c=a.call(this,b)||this;return c.cardButtonRef=f.createRef(),c.elementId=g.uniqueId("FormCard."),c.descriptionId=c.elementId+".description",c.onClick=c.onClick.bind(c),c.onKeyDown=c.onKeyDown.bind(c),c}return d(b,a),b.prototype.render=function(){if(this.props.CreateNew)return f.createElement("div",null,this.createFormCreatingCardByMode());var a=this.getCardDescription(),b={"aria-describedby":a?this.descriptionId:void 0,"aria-disabled":this.state.ContentCovered,"aria-label":this.getCardTitle(),className:"fl-content",onClick:this.onClick,onKeyDown:this.onKeyDown},c=i.createButton({ButtonStyle:"LightBackground",children:[this.createThemeContent(),this.createTitleContent(),this.createCardOwnerContent(),this.createCardTypeContent(),f.createElement("div",{className:"new-form-card-middle-line",key:"mid-line"}),this.createFooterContent()],HTMLAttributes:b,key:"card-content",ref:this.cardButtonRef}),d=a?f.createElement("span",{className:"screenReaderReference",id:this.descriptionId,key:"description"},a):void 0;return f.createElement("div",{className:"fl-history-tile fl-tile"},this.createSpinner(),c,d,this.createOtherContent())},b.prototype.getCardDescription=function(){return this.state.ShowCardResponseCount&&this.state.IsResponseCountReady?k.LocalizedStrings.PortalView_FormCard_Responses.format(this.getCardResponseCount()):null},b.prototype.createFormCreatingCardByMode=function(){return null},b.prototype.onClick=function(){},b.prototype.onKeyDown=function(a){},b.prototype.shouldShowSpinner=function(){return!1},b.prototype.getStatusMessage=function(){return null},b.prototype.createThemeContent=function(){if(!this.state.ShowCardTheme)return null;if(!this.state.IsThemeReady)return f.createElement("div",{className:"portal-tiles-theme-spinner-overlay",key:"theme-spiner"},f.createElement("div",{className:"spinner-tile-animation portal-tiles-theme-spinner-history"}));var a=this.getCardThemeBackgroupUrl(),c=this.getCardThemeName(),d=this.getCardThemePrimaryColor();if(a){var e=a.match(/url\((.*)\)$/);a=e?e[1]:"url("+a+")"}else a=b.getBackgroundImageURL(this.getCardTitle());var g=c===k.LocalizedStrings.Customized_Theme_Name?"new-form-card-image-customized":"new-form-card-image",h={backgroundColor:d||"#008272",backgroundImage:a};return f.createElement("div",{className:g,key:"theme",style:h})},b.prototype.createTitleContent=function(){if(!this.state.ShowCardTitle)return null;if(!this.state.IsTitleReady)return f.createElement("div",{className:"spinner-tile-animation",key:"title-spinner",style:{fontSize:"6px"}});var a=this.getCardTitle(),b={className:"fl-title searchable",key:"title"};if(a){var c=19,d=43,g=a.length;c>=g?b.className=j.Html.combineAttributes(b.className,"large-size"):g>c&&d>=g?b.className=j.Html.combineAttributes(b.className,"middle-size"):b.className=j.Html.combineAttributes(b.className,"small-size")}return f.createElement("div",e({},b),f.createElement("span",null,a))},b.prototype.createFooterContent=function(){if(!this.state.ShowCardResponseCount)return null;if(!this.state.IsResponseCountReady)return f.createElement("div",{className:"fl-response-count-container",key:"rcount-spinner"},f.createElement("div",{className:"fl-response-count-spinner spinner-tile-animation"},f.createElement("span",{className:"fl-response-text"},k.LocalizedStrings.PortalView_Response_Text)));var a=this.getCardResponseCount();return f.createElement("div",{className:"fl-response-count-container",key:"response-count"},a+" "+k.LocalizedStrings.PortalView_Response_Text)},b.prototype.createOtherContent=function(){return null},b.prototype.createSpinner=function(){var a=this.getStatusMessage(),b={className:"screenReaderVisible"},c=a&&f.createElement(Forms.UX.Controls.LiveRegion,{HTMLAttributes:b,LazyRendering:!0,Role:"Log"},a);return this.shouldShowSpinner()?f.createElement("div",{className:"portal-tiles-spinner-overlay"},f.createElement("div",{className:"spinner-tile-animation portal-tiles-spinner-history"}),c):null},b.getBackgroundImageURL=function(a){var b=a||"",c=9,d=Math.abs(j.hashCode(b))%c+1;return"url(../../Images/Theme/default-"+d+".png)"},b}(h.ReactComponent);b.PortalViewCardBase=l},function(a,b,c){"use strict";function d(a){switch(a){case"ShowStatement":return i.createElement("div",{className:"office-form-footer-block"},l.LocalizedStrings.Response_Page_Footer_Statement_2);case"ShowStatementWithNotice":return i.createElement("div",{className:"office-form-footer-block"},l.LocalizedStrings.Response_Page_Footer_Statement);default:return null}}function e(){var a={className:m.isOEmbedSPO()?"office-form-theme-spo-link":void 0,href:window.location.origin,target:"_blank"};return i.createElement("div",{className:"office-form-footer-inline"},i.createElement("a",h({},a),l.LocalizedStrings.Form_Footer_Powered))}function f(){return i.createElement("div",{className:"office-form-footer-inline"},l.LocalizedStrings.Form_Footer_Powered)}var g=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),h=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var i=c(0),j=c(1),k=c(55),l=OfficeForm.Exports.Resources,m=OfficeForm.Exports.Utilities,n=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return g(b,a),b.prototype.componentDidMount=function(){},b.prototype.componentWillUnmount=function(){},b.prototype.render=function(){var a=this.props.TopExtraContent&&i.createElement("div",{className:"office-form-footer-block"},this.props.TopExtraContent),b=m.isOEmbedSPO()?e():f(),c=m.Html.combineAttributes("office-form-footer-container office-form-padding-align",this.props.HTMLAttributes&&this.props.HTMLAttributes.className);return i.createElement("div",{className:"office-form-footer office-form-theme-footer",role:"contentinfo"},i.createElement("div",{className:c},a,d(this.props.FooterType),i.createElement("div",{className:"office-form-footer-block"},b,i.createElement(k.FooterLinks,null))))},b}(j.ReactComponent);Forms.UX.Renderer.FooterControl=n,Forms.UX.Renderer.FooterLinks=k.FooterLinks},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(12),h=c(1),i=OfficeForm.Exports.Resources,j=OfficeForm.Exports.Utilities,k=function(a){function b(b){var c=a.call(this,b)||this;return c.state={PrivacyUrl:"https://go.microsoft.com/fwlink/?LinkId=521839"},c.refreshPrivacy=c.refreshPrivacy.bind(c),c}return d(b,a),b.prototype.componentDidMount=function(){this.refreshPrivacy()},b.prototype.render=function(){var a={className:j.isOEmbedSPO()?"office-form-theme-spo-link":void 0,href:this.state.PrivacyUrl,target:"_blank"};return f.createElement("div",{className:this.props.Multiline?"office-form-footer-block":"office-form-footer-inline"},f.createElement("a",e({},a),i.LocalizedStrings.Form_Footer_PrivacyStatement))},b.prototype.refreshPrivacy=function(){var a=this;g.getPageContext().getPrivacyUrl().done(function(b){return a.setState({PrivacyUrl:b||""})})},b}(h.ReactComponent);b.FooterLinks=k},function(a,b,c){"use strict";function d(a){return 7>a?l.LocalizedStrings.NPS_Detractors:a>8?l.LocalizedStrings.NPS_Promoters:l.LocalizedStrings.NPS_Passives}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),f=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var g=c(0),h=c(3),i=c(1),j=OfficeForm.Exports.Utilities.Html.combineAttributes,k=OfficeForm.Exports.Utilities.Guid,l=OfficeForm.Exports.Resources,m=function(a){function b(c){var d=a.call(this,c)||this;return d.popUpRef=g.createRef(),d.uuid=k.newGuid(),d.options=b.createNPSOptions(),d.valueChangeCallback=function(a){var b=d.props.onValueChange;b&&b(parseInt(a.currentTarget.value,10))},d.inputOnFocusCallback=function(a){d.setState({FocusValue:parseInt(a.currentTarget.value,10)})},d.inputOnBlurCallback=function(){d.setState({FocusValue:void 0})},d.touchStartCallback=function(a){return d.touchStart(a)},d.touchMoveCallback=function(){return d.canceled=!0},d.touchCancelCallback=function(a){d.canceled=!1,d.setState({Touch:-1})},d.touchEndCallback=function(a){return d.touchEnd(a)},d}return e(b,a),b.prototype.render=function(){var a="nps-control clearfix unselectable-text",b="nps-control-table reset";this.props.Disabled||(b=j(b,"enabled"));var c=this.props.HTMLAttributes,d={};return c&&(a=j(a,c.className),h.extend(d,c)),d.className=b,g.createElement("div",{className:a,role:"radiogroup"},this.createPopUp(),g.createElement("table",f({},d),this.createThead(),this.createTbody()),this.props.LeftLabel||this.props.RightLabel?this.createLabels():void 0)},b.prototype.createPopUp=function(){var a=this.state.Touch,b=j(void 0!==a&&-1!==a?"nps-pop-up show":"nps-pop-up",this.props.ClassNameForInnerLabel,a===this.props.Value?"active":"");return g.createElement("div",{className:b,ref:this.popUpRef},g.createElement("span",{className:"nps-pop-up-text"},this.state.Touch))},b.prototype.createLabels=function(){return g.createElement("div",{className:"nps-control-label-container clearfix"},g.createElement("div",{className:"left-label"},g.createElement("span",null,this.props.LeftLabel)),g.createElement("div",{className:"right-label"},g.createElement("span",null,this.props.RightLabel)))},b.createNPSOptions=function(){for(var a=11,b=[],c=0;a>c;c++)b.push({DisplayName:d(c),Key:c,Value:c});return b},b.prototype.createThead=function(){return g.createElement("thead",null,g.createElement("tr",{className:"nps-head-row"},this.options.map(function(a){return g.createElement("th",{className:"nps-head-column",key:a.Key},a.Value)})))},b.prototype.createTbody=function(){var a=this,b=this.options.map(function(b,c){return a.createTd(b,c)});return g.createElement("tbody",null,g.createElement("tr",null,b))},b.prototype.createTd=function(a,b){var c=this.props.Value,d=this.props.Disabled;h.isString(c)&&(c=parseInt(c,10));var e=c===a.Value,i="nps-"+this.uuid+"-"+a.Value,k={"aria-label":a.Value.toString(),"aria-posinset":b+1,"aria-setsize":this.options.length,checked:e,disabled:this.props.Disabled,id:i,name:"nps-"+this.uuid,type:"radio",value:a.Value},l={htmlFor:i};return d||(h.extend(k,{onBlur:-1===this.state.Touch?void 0:this.inputOnBlurCallback,onChange:this.valueChangeCallback,onFocus:-1===this.state.Touch?void 0:this.inputOnFocusCallback}),h.extend(l,{htmlFor:i,onTouchCancel:this.touchCancelCallback,
onTouchEnd:this.touchEndCallback,onTouchMove:this.touchMoveCallback,onTouchStart:this.touchStartCallback})),l.className=j("answer-label",void 0!==this.state.Touch?"touch":"",this.props.ClassNameForInnerLabel,e?"active":"",this.state.FocusValue===a.Value?"focus":""),g.createElement("td",{key:a.Key,className:"radio-button-item"},g.createElement("div",{className:"radio-button"},g.createElement("input",f({},k)),g.createElement("label",f({},l),g.createElement("span",{"data-text":a.Value,className:"radio-button-display"}))))},b.prototype.touchStart=function(a){var b=a.currentTarget,c=this.popUpRef.current,d=c.parentElement.getBoundingClientRect(),e=b.getBoundingClientRect(),f=e.width/2,g=e.height/2;c.style.left=e.left-d.left-f/2+"px",c.style.top=e.top-d.top-g/2+"px",c.style.width=e.width+f+"px",c.style.height=e.height+g+"px";var h=b.firstElementChild,i="text";this.setState({Touch:parseInt(h.dataset[i],10)})},b.prototype.touchEnd=function(a){var b=this;if(this.canceled)this.canceled=!1,this.setState({Touch:-1});else{var c=this.state.Touch;this.setState({Touch:-1},function(){var a=b.props.onValueChange;a&&a(c)})}a.preventDefault()},b}(i.ReactComponent);b.NPSControl=m,Forms.UX.Controls.NPSControl=m,Forms.UX.Controls.getNpsCategoryDescription=d},function(a,b,c){"use strict";function d(a,b){var c=f(a);Nerve.Collection.itemsAddedInSource(b.Model.LocalizedResources,c)}function e(a){var b=f(a);return{localizedResources:b}}function f(a){var b=g(a),c=h(a);return b.forEach(function(a){if(a.localeId){var b=c[a.localeId];b&&(a.questionResources=b)}}),b}function g(a){var b=a.filter(function(a){return!a.questionId}),c=u.groupBy(b,function(a){return a.locale}),d=u.map(c,function(a){var b={formCloseMessage:null,localeId:null,localeName:null,questionResources:[],subtitle:null,thankYouMessage:null,title:null};return a.forEach(function(a){r(a,b)}),b});return d}function h(a){var b=a.filter(function(a){return a.questionId}),c=u.groupBy(b,function(a){return a.locale}),d={},e=u.map(c,function(a,b){var c=u.groupBy(a,function(a){return a.questionId}),d=u.map(c,function(a,c){var d={choices:[],choicesV1:[],leftDescription:null,localeId:b,localeName:null,option:null,questionId:c,rightDescription:null,subtitle:null,title:null},e=a.filter(function(a){return a.elementKey&&a.elementKey.startsWith("choiceid_")});if(e&&e.length>0){var f=u.map(e,function(a){var b={choiceId:null,description:null};return t(a,b),b});d.choices=f}var g=a.filter(function(a){return a.elementKey&&!a.elementKey.startsWith("choiceid_")});return g&&g.forEach(function(a){s(a,d)}),d});return d});return e.forEach(function(a){var b=a.length>0&&a[0].localeId;b&&(d[b]=a)}),d}function i(a){var b=q(a);return null!=a.formCloseMessage?(b.elementKey="formclosemessage",b.elementValue=a.formCloseMessage):null!=a.thankYouMessage&&(b.elementKey="thankyoumessage",b.elementValue=a.thankYouMessage),b}function j(a){var b=q(a);return null!=a.leftDescription?(b.elementKey="leftdescription",b.elementValue=a.leftDescription):null!=a.rightDescription?(b.elementKey="rightdescription",b.elementValue=a.rightDescription):null!=a.option&&(b.elementKey="option",b.elementValue=a.option),b}function k(a,b){var c=b.Model,d=Nerve.Collection.getItemWithKeyFields(c.LocalizedResources,{localeId:a.localeId});if(!d){var e={formCloseMessage:null,localeId:a.localeId,localeName:a.localeName,questionResources:[],subtitle:null,thankYouMessage:null,title:null};Nerve.Collection.itemsAddedInSource(c.LocalizedResources,[e])}}function l(a,b){var c=b.Model,d=Nerve.Collection.getItemWithKeyFields(c.LocalizedResources,{localeId:a});d&&Nerve.Collection.itemsDeletedInSource(c.LocalizedResources,[d])}function m(a,b,c,d){var e={choices:[],choicesV1:[],leftDescription:null,localeId:a.localeId,localeName:a.localeName,option:null,questionId:b,rightDescription:null,subtitle:null,title:null},f=Nerve.Collection.getItemWithKeyFields(d.Model.Questions,{Id:b});if(f.ChoiceGroup&&f.ChoiceGroup.length>0){var g=u.map(f.ChoiceGroup,function(a){var b={choiceId:a.Id.toString(),description:null};return b});e.choices=g}var h=Nerve.Collection.itemsAddedInSource(c.questionResources,[e]);return Nerve.getObjectMasterFromModel(h[0])}function n(a,b){var c={choiceId:a,description:null},d=Nerve.Collection.itemsAddedInSource(b.choices,[c]);return Nerve.getObjectMasterFromModel(d[0])}function o(a){var b={choiceId:null,description:""},c=Nerve.Collection.itemsAddedInSource(a.choicesV1,[b]);return Nerve.getObjectMasterFromModel(c[0])}function p(a,b){switch(b.localeId=a.locale,a.elementKey){case"title":b.title=a.elementValue;break;case"subtitle":b.subtitle=a.elementValue;break;case"localename":b.localeName=a.elementValue;break;default:throw Error("element key is not valid.")}}function q(a){var b={elementKey:null,elementValue:null,locale:null,questionId:null};return null!=a.title?(b.elementKey="title",b.elementValue=a.title):null!=a.subtitle?(b.elementKey="subtitle",b.elementValue=a.subtitle):null!=a.localeName&&(b.elementKey="localename",b.elementValue=a.localeName),b}function r(a,b){switch(a.elementKey){case"thankyoumessage":b.thankYouMessage=a.elementValue;break;case"formclosemessage":b.formCloseMessage=a.elementValue;break;default:p(a,b)}}function s(a,b){switch(b.questionId=a.questionId,a.elementKey){case"leftdescription":b.leftDescription=a.elementValue;break;case"rightdescription":b.rightDescription=a.elementValue;break;case"option":b.option=a.elementValue;break;default:p(a,b)}}function t(a,b){var c=a.elementKey;c&&c.startsWith("choiceid_")&&(b.choiceId=c.split("_")[1]),b.description=a.elementValue}Object.defineProperty(b,"__esModule",{value:!0});var u=c(3);b.appendLocalizedResources=d,b.parseLocalizedResources=e,b.parseFormLocalizedItem=i,b.parseQuestionLocalizedItem=j,b.createEmptyLocalizedResource=k,b.removeLocalizedResource=l,b.createEmptyQuestionLocalizedResource=m,b.createEmptyChoiceLocalizedResource=n,b.createEmptyChoiceV1LocalizedResource=o,Forms.Models.appendLocalizedResources=d,Forms.Models.parseLocalizedResources=e,Forms.Models.createEmptyLocalizedResource=k,Forms.Models.removeLocalizedResource=l},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(1),h=OfficeForm.Exports.FormLimitation,i=OfficeForm.Exports.Utilities,j=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.render=function(){return f.createElement("div",e({},this.props.HTMLAttributes),f.createElement("iframe",{allowFullScreen:!0,className:this.props.ClassNameForIFrame,frameBorder:"0",height:b.calcVideoDisplayHeight(),sandbox:"allow-scripts allow-same-origin allow-popups",src:this.props.Url,width:"100%"}),this.props.children)},b.calcVideoDisplayHeight=function(){if(i.isMobile()){var a=$(window).width();return 0===a&&(a=document.body.scrollWidth),9*a/16}return h.DefaultVideoHeight},b}(g.ReactComponent);b.VideoControl=j,Forms.UX.Controls.VideoControl=j},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(1),g=OfficeForm.Exports.ColorHelper,h=OfficeForm.Exports.Utilities,i=OfficeForm.Exports.Resources,j=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.mounted=!0,b.imgToLoadBackground=new Image,b}return d(b,a),b.prototype.componentWillMount=function(){var a=this,b=this.props.ThemeMaster;b&&(this.observerCallback=function(b){b.NewValues.Name===i.LocalizedStrings.Customized_Theme_Name&&b.NewValues.BackgroundImage!==a.state.ImageUrl?a.setState({ImageUrl:b.NewValues.BackgroundImage,IsBackgroundImgCached:!1}):a.forceUpdate()},b.observe(this.observerCallback))},b.prototype.componentWillUnmount=function(){var a=this.props.ThemeMaster;this.mounted=!1,a&&a.unobserve(this.observerCallback)},b.prototype.render=function(){var a,c=this,d=this.props.ThemeMaster;if(a=h.isOEmbedSPO()&&OfficeFormServerInfo.themeInfo?b.getSPOTheme(OfficeFormServerInfo.themeInfo):d&&d.Model,!a)return null;var f=a.Name,g=a.PrimaryColor,j=a.SecondaryColor,k=a.BackgroundColor,l=a.BackgroundImage,m=4;l&&l.match("url((.*))")&&(l=l.substring(m,l.length-1)),f===i.LocalizedStrings.Customized_Theme_Name&&l&&(this.state.IsBackgroundImgCached||(this.imgToLoadBackground.src=l,this.imgToLoadBackground.onload=function(a){c.mounted&&c.setState({ImageUrl:l,IsBackgroundImgCached:!0})},l+="_mo"));var n="";return n+=".office-form-theme-primary-color { color:"+g+"; }",n+=".office-form-theme-secondary-color { color:"+j+"; }",n+=".office-form-theme-primary-background { background:"+g+"; color:#FFFFFF; }",n+=".office-form-theme-secondary-background { background:"+j+"; }",n+=".office-form-theme-primary-foreground, ",n+=".office-form-theme-primary-foreground a, ",n+=".office-form-theme-primary-foreground.rateit .rateit-selected, ",n+=".office-form-theme-primary-foreground.rateit .rateit-hover",n+="{ color:"+g+"; } ",n+=".office-form-theme-border-top { border-top-color:"+g+"; }",n+=".office-form-theme-border { border-color:"+g+";}",n+=".office-form-theme-interactive-background.active { background-color:"+g+"; }",n+=".office-form-theme-interactive-background:hover { background-color:"+j+"; }",n+=".office-form-theme-interactive-background:focus { background-color:"+j+"; }",n+=".office-form-theme-interactive-background:active { background-color:"+j+"; }",n+=".office-form-theme-interactive-color { color:"+g+"; }",n+=".office-form-theme-interactive-color:hover { color:"+j+"; }",n+=".office-form-theme-interactive-color:focus { color:"+j+"; }",n+=".office-form-theme-interactive-color:active { color:"+j+"; }",n+=".office-form-theme-button { color: white; background:"+g+"; }",n+=".office-form-theme-button:hover { background:"+j+"; }",n+=".office-form-theme-button:focus { background:"+j+"; }",n+=".office-form-dark-theme-button {color:"+j+"}",n+=".office-form-dark-theme-button:hover { color:"+j+"; }",n+=".office-form-dark-theme-button:focus { color:"+j+"; }",n+=".office-form-theme-page-background-active.active { background :"+(g+"; color: #FFFFFF; }"),n+=".office-form-theme-page-foreground-active.active, ",n+=".office-form-theme-select-color.active *{ color: "+g+"; }",n+=".office-form-theme-toggle.active { background: "+(g+"; border-color:"+g+"; }"),n+=".office-form-theme-border { border-color:"+g+"; }",n+=".office-form-theme-outline { outline-color:"+g+"; }",n+=".office-form-theme-button-foreground.active,.office-form-theme-button-foreground.touch.active:hover { color: white; background: "+(g+"; outline-color:"+g+"; }"),n+=".office-form-theme-button-foreground.active:hover { background: "+(j+"; outline-color:"+j+"; }"),n+=".office-form-theme-quiz-point { color:"+j+"; }",n+=".office-form-theme-quiz-totalPoints-bar {color:"+g+"; }",n+=".office-form-theme-image-question-background, .office-form-theme-video-question-background { background-color: "+(k+"; outline: 1px solid transparent; }"),n+=".office-form-theme-image-container-border { border: 3px solid "+(k+"; }"),n+=".office-form-sortable-fallback .office-form-sort-item { background:"+(g+";color:white; }"),n+=".office-form-theme-focus-border .office-form-textfield-input:focus,.office-form-theme-focus-border .title-designer-image:focus,.office-form-theme-focus-border .form-control:focus,.office-form-theme-focus-border .select-control:focus,.office-form-theme-focus-border .picker--focused .picker__holder:focus{ border-color: "+(g+"; outline-color:"+g+"; }"),n+=".office-form-theme-bgcolor-hover:hover { background:"+k+"; }",n+=".office-form-theme-button-color:hover *{ color:"+j+"; }",n+=".form-intelligence-question-row.office-form-intelligence-theme-li { outline: 1px solid "+(j+"; background-color:"+k+";}"),n+=".office-form-insight-theme-control .simple-data-control-content { color : "+(g+"; }"),n+=".office-form-insight-theme-control .simple-data-control-description { color : "+(g+"; }"),n+=".office-form-insight-theme-control .simple-data-control-description:hover { color : "+(j+"; }"),n+=".office-form-insight-theme-control .simple-data-control-description:focus { color : "+(j+"; }"),n+=".office-form-insight-theme-control .simple-data-control-description:active { color : "+(j+"; }"),n+=".office-form-info-container .office-form-info-children.office-form-theme-spo-link { color: "+(g+"; }"),n+=".office-form-info-container .office-form-info-children.office-form-theme-spo-link:hover"+("{color:"+j+"; }"),n+=".office-form-spo-embed .office-form-footer-block .office-form-theme-spo-link { color: "+(g+"; }"),n+=".office-form-spo-embed .office-form-footer-block .office-form-theme-spo-link:hover { color: "+(j+"; }"),n+=".office-form-theme-spo-link { color:"+g+"; }",n+=".office-form-theme-spo-link:hover { color:"+j+"; }",h.isOEmbedSPO()||(l?(n+=".thank-you-page-content { opacity:.97; }",n+=".introduction-for-responser-container { opacity:.97; }",h.isMobile()?(n+=".office-form-theme-page-background { background-color:"+k+"; }",n+=".office-form-theme-footer { background: rgba(255,255,255,.4); }"):(n+=".office-form-theme-page-background { background-image: url("+(l+"); }"),n+=".office-form-theme-footer { background: rgba(244,244,244,.8); }"),n+=".preview-mobile-container.office-form-theme-page-background { background:"+(k+"; }"),n+=".preview-mobile-container .office-form-theme-footer { background: rgba(255,255,255,.4); }"):(n+=".office-form-theme-footer { background : rgba(255,255,255,.4); }",n+=".office-form-theme-page-background { background-color:"+k+"; }")),n+=l&&f!==i.LocalizedStrings.Customized_Theme_Name?".office-form-theme-shadow { box-shadow : none; }":".office-form-theme-shadow { box-shadow: 0 0 11px rgba(0,0,0,.12); }",f===i.LocalizedStrings.Customized_Theme_Name&&(n+=".office-form-body { opacity: 0.97; }"),e.createElement("style",null,n)},b.getSPOTheme=function(a){var b=g.normalizePrimaryColor(a),c={BackgroundColor:g.primaryHexToBackgroundHex(b),BackgroundImage:null,Name:"Customized Theme",PrimaryColor:b,SecondaryColor:g.primaryHexToSecondaryHex(b),Thumbnail:null};return c},b}(f.ReactComponent);b.ThemeRender=j,Forms.UX.Renderer.ThemeRender=j},function(a,b,c){"use strict";function d(a,b){var c=Date.now(),d={sa:c-i};return j[a]=d,b.done(function(){d.d=Date.now()-c}).fail(function(){d.d=Date.now()-c,d.f=1})}function e(a){k[a]=Date.now()-i}function f(){var a="Forms.PerformanceAnalysis";h.log({eventName:a,eventType:"engagement_event",extraData:{checkPoints:k,requests:j,requestsAll:Date.now()-i,scriptCached:l,scriptDownload:window.FormsPageStartTime&&i-window.FormsPageStartTime,version:1}})}function g(){try{var a="FormsVersion"+window.location.pathname,b=window.localStorage.getItem(a),c=OfficeFormServerInfo.version;return b!==c?(window.localStorage.setItem(a,c),!1):!0}catch(d){return!1}}Object.defineProperty(b,"__esModule",{value:!0});var h=c(2),i=Date.now(),j={},k={},l=g();b.requestWithPromise=d,b.addCheckPoint=e,b.onPageReadyToRender=f,Forms.PerformanceAnalysis={addCheckPoint:e,onPageReadyToRender:f,requestWithPromise:d}},function(a,b,c){"use strict";function d(){return h.getInstance()}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var f=c(4),g=f.Spec;b.uxStateSpec={Action:g.reference(),Analysis:g["boolean"](),CriticalError:g.reference(),ErrorBarMessage:g.string(),FlexPane:g.reference(),FormCollectionType:g.reference(),FormId:g.string(),FormList:g.collectionOf(g.reference()),FormListLoadState:g.reference(),FormMaster:g.reference(),FormsTenantSettings:g.reference(),Grading:g.reference(),GroupMaster:g.reference(),GroupMruFormListLoadState:g.reference(),Host:g.string(),InfoBarMessageType:g.string(),LeftDate:g.string(),LeftPersonName:g.string(),PlaceholderList:g.collectionOf(g.reference()),Preview:g.reference(),PreviousFlexPane:g.reference(),QtiFormCreationStatus:g.string(),RecycleBin:g.collectionOf(g.reference()),SearchContent:g.string(),SelectedPortalForm:g.reference(),SharedWithMeFormList:g.collectionOf(g.reference()),SharedWithMeFormListLoadState:g.reference(),Store:g["boolean"](),Title:g.string(),Token:g.string(),TopView:g.reference(),XlWorkbookId:g.string()},b.getUxStateMaster=d,Forms.Models.getUxStateMaster=d;var h=function(a){function b(){var b=a.call(this)||this;return b.bulkEdit(function(){var a=b.Model;a.Analysis=!1,a.Store=!1,a.Grading=void 0,a.FormListLoadState="NotStarted",a.SharedWithMeFormListLoadState="NotStarted",a.GroupMruFormListLoadState="NotStarted",a.FormCollectionType="OwnedForms",a.FormsTenantSettings={educationResourcesEnabled:!1,externalCollaboration:!0,externalSendForm:!0,externalShareCollaboration:!0,externalShareResult:!0,externalShareTemplate:!0,recordIdentityByDefault:!0}}),b.addRule({InterestedFields:[b.Schema.FormMaster],Name:"ClearRouting",onChange:function(a){b.Model.FormMaster||b.clearFormRelatedRoutingFields()}}),b.addRule({InterestedFields:[b.Schema.FlexPane],Name:"RecordFlexPaneType",onChange:function(a){b.Model.PreviousFlexPane=a.OldValues.FlexPane}}),b}return e(b,a),b.getInstance=function(){return this.instance||(this.instance=new b),this.instance},b.prototype.clearActionRelatedFields=function(){this.bulkEdit(function(a){a.Action="NoAction",a.Title=void 0,a.XlWorkbookId=void 0})},b.prototype.showTopView=function(a,b){this.Model.TopView=a,this.topViewCloseCallback=b},b.prototype.hideTopView=function(){this.Model.TopView="None"},b.prototype.resetTopViewCloseCallback=function(){var a=this.topViewCloseCallback;return this.topViewCloseCallback=void 0,a},b.prototype.collapseFlexPaneIfNeeded=function(a){var b=d().Model,c=b.FlexPane;if("None"!==c){var e="flex-pane-container-"+c,f=document.getElementById(e);f&&!f.contains(a)&&(b.FlexPane="None")}},b.prototype.clearFormRelatedRoutingFields=function(){var a=this;this.bulkEdit(function(){var b=a.Model;b.FormMaster=void 0,b.Analysis=!1,b.Store=!1,b.Grading=void 0,b.Preview=void 0,b.FlexPane="None"})},b}(f.createObjectMasterClass("DesignPageUxState",b.uxStateSpec));b.DesignPageUxStateMaster=h,Forms.Models.DesignPageUxStateMaster=h},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(3),f=c(4),g=c(13),h=c(84),i=c(97),j=c(137),k=OfficeForm.Exports.Models,l=f.Spec,m={classification:l.string(),displayName:l.string(),emailAddress:l.string(),formReferences:l.collectionOf(i.FormReferenceMaster),id:l.string({IsKeyField:!0}),isFavorite:l["boolean"](),members:l.collectionOf({displayName:l.string(),id:l.string()}),owners:l.collectionOf({displayName:l.string(),id:l.string()}),visibility:l.string()},n=function(a){return new j.GroupDataSource(a)},o=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),Object.defineProperty(b.prototype,"Photo",{get:function(){var a=$.Deferred();return a.resolve(h.createGroupPhoto(this.Model.id)).promise()},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"FormMasters",{get:function(){return this.isFieldReady(this.Schema.formReferences)?f.convertToArray(this.Model.formReferences).map(function(a){return g.getFormMasterByInstanceId(a.instanceId)}):[]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"FormMasterExpectSoftDeleted",{get:function(){return this.FormMasters.filter(function(a){return a.isFieldReady(a.Schema.SoftDeleted)&&(a.Model.MovingToRecycleBin||a.Model.SoftDeleted!==k.FormDeletedState.SoftDeleted)})},enumerable:!0,configurable:!0}),b.prototype.getFormMasterSoftDeteledForms=function(){return this.FormMasters.filter(function(a){return a.isFieldReady(a.Schema.SoftDeleted)&&a.Model.SoftDeleted===k.FormDeletedState.SoftDeleted&&!a.Model.MovingToRecycleBin})},b.prototype.observeGroupFormsChange=function(a){var c=this;this.fieldsReady([b.Schema.formReferences]).done(function(){f.getCollectionMasterFromModel(c.Model.formReferences).observe(a)})},b.prototype.unobserveGroupFormsChange=function(a){var b=this.Model.formReferences;b&&f.getCollectionMasterFromModel(b).unobserve(a)},b.prototype.addFormReference=function(a){this.isFieldReady(b.Schema.formReferences)&&f.Collection.itemsAddedInSource(this.Model.formReferences,[a])},b.prototype.removeFormReference=function(a){this.isFieldReady(b.Schema.formReferences)&&f.Collection.itemsDeletedInSource(this.Model.formReferences,e.filter(this.Model.formReferences,function(b){return b.instanceId===a}))},b.prototype.getMemberPhoto=function(a){var b=$.Deferred();return b.resolve(h.createGroupMemberPhoto(this.Model.id,a)).promise()},b.prototype.matchSearchString=function(a){var b=this.Model.displayName.toLowerCase();return e.all(a,function(a){return b.indexOf(a)>=0})},b}(f.createObjectMasterClass("Group",m,n));b.GroupMaster=o,Forms.Mru.GroupMaster=o},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(3),e=c(4),f=OfficeForm.Exports.DataProvider,g=function(){function a(a){this.master=a,this.dataProvider=f.createDataProvider()}return Object.defineProperty(a.prototype,"Master",{get:function(){return this.master},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"DataProvider",{get:function(){return this.dataProvider},enumerable:!0,configurable:!0}),a.prototype.add=function(a){throw Error("PhotoDataSource.add - No scenario to call this method currently.")},a.prototype["delete"]=function(a){throw Error("PhotoDataSource.delete - No scenario to call this method currently.")},a.prototype.query=function(a){var b=[],c=e.getFieldSchemaInfo(this.master.Schema.value).Name;return d.contains(a,c)&&(b.push(this.queryValue()),a=d.without(a,c)),a.length&&b.push(this.queryDefinition()),$.when.apply($,b).then(function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return d.extend.apply(d,[{}].concat(a))})},a.prototype.update=function(a){throw Error("PhotoDataSource.update - No scenario to call this method currently.")},a}();b.PhotoDataSource=g},function(a,b,c){"use strict";function d(a,b){var c=h(a,b);return c.OwnerId=b.Model.id,i(c,b)}function e(a,b){a.ensureFieldsReady(l.FieldsForCreatingForm).done(function(){var c=j.clone(a.getSnapshotToCopy()),d=b.FormMasters,e=k.getUniqueNameFromList(c.Title,n.LocalizedStrings.Designer_Title_autoRenameFormat,d.filter(function(a){return!a.Deleted}).map(function(a){return a.Model.Title}));c.Title=e,j.assign(c,{OwnerId:a.Model.OwnerId,OwnerTenantId:a.Model.OwnerTenantId}),i(c,b)})}function f(a,b){a.Deleted=!0,a.Synchronizer.flush().done(function(){var c=b.FormMasters,d=c.indexOf(a);d>-1&&b.removeFormReference(a.getInstanceId())})}function g(a,b){a.Model.SoftDeleted=m.FormDeletedState.Normal}function h(a,b){var c=b.FormMasters,d=k.getUniqueNameFromList(a?n.LocalizedStrings.Designer_DefaultQuizTitle:n.LocalizedStrings.Designer_DefaultFormTitle,n.LocalizedStrings.Designer_Title_autoRenameFormat,c.filter(function(a){return!a.Deleted}).map(function(a){return a.Model.Title}));return{Settings:{IsAnonymous:OfficeFormServerInfo.userInfo.IsMsa,IsQuizMode:a,RequiresUniqueResponse:a&&!OfficeFormServerInfo.userInfo.IsMsa,ShowGradedScores:a},Title:d,XlWorkbookId:a?void 0:"WaitingForExport"}}function i(a,b){var c=m.createGroupDesignFormMaster(a);return b.addFormReference({instanceId:c.getInstanceId(),modifiedDate:c.Model.Modified,ownerId:c.Model.OwnerId,ownerTenantId:c.Model.OwnerTenantId,title:c.Model.Title}),c}Object.defineProperty(b,"__esModule",{value:!0});var j=c(3),k=OfficeForm.Exports.AutoRename,l=OfficeForm.Exports.Models.FormMaster,m=OfficeForm.Exports.Models,n=OfficeForm.Exports.Resources;b.createForm=d,b.duplicateForm=e,b.deleteForm=f,b.restoreFromRecycleBin=g},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(3),h=c(1),i=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.renderingElement=f.createRef(),b}return d(b,a),b.prototype.componentDidMount=function(){var a=this;this.props.LazyRendering&&(this.renderingElement.current&&console.log(this.renderingElement.current),window.setTimeout(function(){return a.setState({Mounted:!0})}))},b.prototype.render=function(){var a=g.clone(this.props.HTMLAttributes||{});switch(this.props.Role){case"Alert":a.role="alert";break;case"Log":a.role="log",a["aria-live"]=a["aria-live"]||"polite",a["aria-relevant"]=a["aria-relevant"]||"additions text";break;case"Marquee":a.role="marquee";break;case"Status":a.role="status"}return this.props.LazyRendering&&!this.state.Mounted?(a["aria-label"]=void 0,a.children=null,a.ref=this.renderingElement,f.createElement("div",e({},a))):f.createElement("div",e({},a),this.props.children)},b}(h.ReactComponent);b.LiveRegion=i,Forms.UX.Controls.LiveRegion=i},function(a,b){function c(a,b){var c,e,f,g=a.nodeName.toLowerCase();return"area"===g?(c=a.parentNode,e=c.name,a.href&&e&&"map"===c.nodeName.toLowerCase()?(f=$("img[usemap=#"+e+"]")[0],!!f&&d(f)):!1):(/input|select|textarea|button|object/.test(g)?!a.disabled:"a"===g?a.href||b:b)&&d(a)}function d(a){return $.expr.filters.visible(a)&&!$(a).parents().addBack().filter(function(){return"hidden"===$.css(this,"visibility")}).length}$.extend($.expr[":"],{focusable:function(a){return c(a,!isNaN($.attr(a,"tabindex")))}})},function(a,b,c){"use strict";function d(a){return g.createElement(l,f({},a))}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),f=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var g=c(0),h=c(25),i=c(1),j=OfficeForm.Exports.Control,k=OfficeForm.Exports.Resources,l=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.allowedTypesCount=0,b}return e(b,a),b.prototype.render=function(){var a=j.createFontIconControl({HTMLAttributes:{className:"forms-icon-size18x18"},IconName:"Upload"}),b=g.createElement("span",{className:"design-question-upload-text"},k.LocalizedStrings.UploadFile_Button),c=g.createElement("div",{className:"design-question-upload-container",key:"addButton"},g.createElement("div",{className:"design-question-upload-button"},a,b));return g.createElement("div",null,c,this.createFileUploadValidation())},b.prototype.createFileUploadValidation=function(){var a=this.props.FileTypes;return this.props.HasSpecificFileType?(0===this.allowedTypesCount&&(this.allowedTypesCount=Object.keys(a).length),g.createElement("div",{className:"design-question-restrictions-container",key:"restrictionsContainer"},g.createElement("span",{className:"design-question-restrictions-title"},k.LocalizedStrings.UploadFile_Restrictions),g.createElement("div",{className:"design-question-fileUpload-fileType-container"},g.createElement("div",{className:"design-question-fileUpload-fileType"},this.createFileTypeButton("Word"),this.createFileTypeButton("Excel"),this.createFileTypeButton("PowerPoint"),this.createFileTypeButton("PDF")),g.createElement("div",{className:"design-question-fileUpload-fileType"},this.createFileTypeButton("Image"),this.createFileTypeButton("Text"),this.createFileTypeButton("Video"),this.createFileTypeButton("Audio"))))):null},b.prototype.createFileTypeButton=function(a){var b=this;return j.createCheckBox({Description:h.convertFileTypeToString(a),HTMLAttributes:{className:"inline-display design-question-upload-checkbox"},onValueChange:function(c){b.props.FileTypes[a]=c,c?b.allowedTypesCount++:b.allowedTypesCount--,0===b.allowedTypesCount&&b.props.setSpecificFileTypeCallback(!1)},Options:{classNameForInnerDiv:"inline-display"},SpanClassName:"design-question-file-type",Value:this.props.FileTypes[a]})},b}(i.ReactComponent);b.FileUploadQuestionDesigner=l,b.createFileUploadDesigner=d,Forms.UX.FileUpload.createFileUploadDesigner=d},function(a,b){},function(a,b,c){"use strict";function d(a){return f.Flight.isEnabled(f.Flights.EnableFormsProRoute)&&a.isFieldReady(g.Schema.Type)&&"survey"===a.Model.Type?e.createElement("div",{className:"fl-type-label fl-type-survey",key:"type-label",title:h.LocalizedStrings.Survey_FormCard_TypeLabel}):null}Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=OfficeForm.Exports.Flighting,g=OfficeForm.Exports.Models.FormMaster,h=OfficeForm.Exports.Resources;b.createFormCardType=d},function(a,b,c){"use strict";function d(){return i.log({eventName:n,eventType:"engagement_event"}),h.redirectTo("/Pages/DesignPage.aspx"),!0}function e(){return i.log({eventName:m,eventType:"engagement_event"}),h.redirectTo("/Pages/DesignPage.aspx"),!0}var f=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var g=c(0),h=c(5),i=c(2),j=c(1),k=OfficeForm.Exports.Control,l=OfficeForm.Exports.Resources,m="ResponsePage.IntroductionForResponser.Create",n="ResponsePage.IntroductionForResponser.TryForms",o=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.buttonRef=g.createRef(),b}return f(b,a),b.prototype.render=function(){var a=g.createElement("div",{className:"introduction-title-container"},g.createElement("div",{className:"introduction-title"},l.LocalizedStrings.Form_Introduction_Title_MSA),g.createElement("a",{className:"office-form-try-link",href:"javascript:void(0)",onClick:d},l.LocalizedStrings.Form_Introduction_TryText_MSA)),b=k.createTextButton({ButtonStyle:"LightBackground",HTMLAttributes:{"aria-label":l.LocalizedStrings.Form_Introduction_CreateButtonText_MSA,className:"introduction-create-form",onClick:e,title:l.LocalizedStrings.Form_Introduction_CreateButtonText_MSA},ref:this.buttonRef,Text:l.LocalizedStrings.Form_Introduction_CreateButtonText_MSA});return g.createElement("div",{className:"office-form introduction-for-responser-container"},a,g.createElement("div",{className:"introduction-container"},g.createElement("div",{className:"introduction"},g.createElement("img",{
alt:l.LocalizedStrings.Form_Introduction_MSA_1,className:"introduction-image",key:"introductionImage1",src:"../Images/MSAIntroduction1.png"}),g.createElement("div",{className:"introduction-text"},l.LocalizedStrings.Form_Introduction_MSA_1)),g.createElement("div",{className:"introduction"},g.createElement("img",{alt:l.LocalizedStrings.Form_Introduction_MSA_2,className:"introduction-image",key:"introductionImage2",src:"../Images/MSAIntroduction2.png"}),g.createElement("div",{className:"introduction-text"},l.LocalizedStrings.Form_Introduction_MSA_2)),g.createElement("div",{className:"introduction"},g.createElement("img",{alt:l.LocalizedStrings.Form_Introduction_MSA_3,className:"introduction-image",key:"introductionImage3",src:"../Images/MSAIntroduction3.png"}),g.createElement("div",{className:"introduction-text"},l.LocalizedStrings.Form_Introduction_MSA_3))),g.createElement("div",{className:"introduction-button"},b))},b}(j.ReactComponent);Forms.UX.Renderer.IntroductionForResponder=o},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(6),h=c(3),i=c(8),j=c(9),k=OfficeForm.Exports.CategoryExtensionPoints,l=OfficeForm.Exports.Control,m=OfficeForm.Exports.ExtensionPoints,n=OfficeForm.Exports.Flighting,o=OfficeForm.Exports.FormLimitation,p=OfficeForm.Exports.Models,q=OfficeForm.Exports.Resources,r=OfficeForm.Exports.Utilities,s="6c660282-db72-436c-87bb-8272cba504d3",t=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.otherAnswerTextRef=f.createRef(),b.shouldUpdateStateBasingOnAnswer=!0,b}return d(b,a),b.prototype.componentWillMount=function(){var b=this;a.prototype.componentWillMount.call(this),this.onQuestionChangeCallback=function(){return b.initializeState()},this.props.Master.Question.observe(this.onQuestionChangeCallback),this.onAnswerChangeCallback=function(){return b.onAnswerChange()},this.props.Master.observe(this.onAnswerChangeCallback,[p.QuestionRuntimeMaster.Schema.Answer]),this.initializeState()},b.prototype.componentWillUnmount=function(){a.prototype.componentWillUnmount.call(this),this.props.Master.Question.unobserve(this.onQuestionChangeCallback),this.props.Master.unobserve(this.onAnswerChangeCallback,[p.QuestionRuntimeMaster.Schema.Answer])},b.prototype.createReactNodes=function(){var a=this.props.Master.Question,b=a.Model,c=b.ChoiceType===p.ChoiceType.SingleChoice;if(n.Flight.isEnabled(n.Flights.DropDown)){if(!this.props.ExpandAll&&a.showAsDropdown()&&!this.props.IsMobile&&(!b.IsQuiz||!this.props.ShowQuizResult))return[this.createDropDown()]}else if(!this.props.ExpandAll&&a.showAsDropdown()&&!this.props.IsMobile&&!b.IsQuiz)return[this.createDropDown()];return[this.createChoices(c)]},b.prototype.onAnswerChange=function(){this.shouldUpdateStateBasingOnAnswer?this.updateStateBasingOnAnswer(this.state.ChoiceOptions):this.shouldUpdateStateBasingOnAnswer=!0},b.prototype.updateAnswer=function(){var a,b=[],c=this.props.Master.Question.Model.ChoiceType===p.ChoiceType.SingleChoice,d=this.state.SelectedOptions;d&&d.forEach(function(a){return b.push(a)});var e=this.state.OtherOptionText;if(this.state.IsOtherOptionSelected&&e&&b.indexOf(e)<0&&b.push(e),c)a=b[0];else if(b.length){var f=this.sortAnswers(b);a=JSON.stringify(f)}this.shouldUpdateStateBasingOnAnswer=!1,this.props.Master.Model.Answer=a},b.prototype.createChoices=function(a){var c=this,d=this.props.Master,g=d.Question.Model,h=r.Guid.newGuid(),i=this.state.ChoiceOptions,j=i.length+(g.AllowOtherAnswer?1:0),n=this.props.Master.Question.Form,o=k.supportsExtensionPoint(n,m.ResponsePagePollView),p=i.map(function(d,g){var i={className:r.Html.combineAttributes(c.props.IsMobile&&!o?"office-form-question-choice-mobile office-form-theme-page-background-active":"office-form-question-choice")},k=!1,m=c.state.SelectedOptions;void 0!==m&&m.indexOf(d.Description)>=0&&(k=!0,c.props.IsMobile&&(i.className=r.Html.combineAttributes(i.className,"active")));var n={"aria-checked":k,checked:k,disabled:c.props.Disabled,name:a?h:void 0,onChange:function(){return c.onChange(d.Description,k,a)},type:"checkbox"};a&&(n.type="radio",n["aria-posinset"]=g+1,n["aria-setsize"]=j);var p,q=c.props.Master.Question.Model.IsQuiz,s="office-form-question-choice-row";if(q&&(s=r.Html.combineAttributes(s,"office-form-question-choice-quiz-row")),c.props.Master.Question.Model.IsMathQuiz&&d.IsMathOption){var t=l.createFormulaRenderer({DisableLinebreaks:c.props.DisableFormulaLinebreak,Formula:d.Description,onRenderComplete:c.props.onHeightChange});p=f.createElement("div",{className:"office-form-question-choice-formula"},t);var u={"aria-label":d.Description};n=r.Html.mergeReactProps(n,u)}else{var v={RenderMode:l.UserTextRenderMode.RichText,Text:d.Description},w=l.createUserTextRenderer(v);p=f.createElement("span",{className:"office-form-question-choice-text-span"},w),s=r.Html.combineAttributes(s,"office-form-question-choice-text-row")}var x=f.createElement("input",e({},n)),y=b.getAnswerKeyMark(c.props,d,k),z=b.getAnswerHintLabel(c.props,d,k);return f.createElement("div",e({},i,{key:g}),f.createElement("div",{className:a?"radio":"checkbox"},f.createElement("label",{className:s},x,p,y)),z)}),q=this.getElementProps({key:"choicequestion-choices",role:a?"radiogroup":"group"});return f.createElement("div",e({},q),p,this.createOtherAnswer(h,a))},b.prototype.createOtherAnswer=function(a,b){var c=this.props.Master.Question.Form,d=k.supportsExtensionPoint(c,m.ResponsePagePollView);if(this.props.Master.Question.Model.AllowOtherAnswer){var g={className:this.props.IsMobile&&!d?"office-form-other-answer-mobile":"office-form-other-answer",key:"other-answer"};return f.createElement("div",e({},g),this.createOtherAnswerInput(a,b),this.createOtherAnswerTextbox(b))}},b.prototype.createOtherAnswerInput=function(a,b){var c=this,d="otherAnswerInput",h=this.state.ChoiceOptions,i={"aria-label":q.LocalizedStrings.Response_Page_OtherAnswerTitle,checked:this.state.IsOtherOptionSelected,disabled:this.props.Disabled,name:b?a:void 0,onChange:function(){if(b)c.onSingleChoiceOtherAnswerChange();else if(c.otherAnswerTextRef.current){var a=g.findDOMNode(c.otherAnswerTextRef.current),d=a.checked;c.onMultiChoiceOtherAnswerChange(d)}},ref:d,role:"checkbox",type:"checkbox"};return b&&(i.role="radio",i.type="radio",i["aria-posinset"]=h.length+1,i["aria-setsize"]=h.length+1),f.createElement("input",e({},i))},b.prototype.createOtherAnswerTextbox=function(a){var b=this,c={"aria-label":q.LocalizedStrings.Designer_OtherAnswer,className:"office-form-other-answer-textbox"},d={Disabled:this.props.Disabled,HTMLAttributes:{className:"inline-display office-form-other-answer-margin-left-mobile"},MaxLength:o.OtherOptionLength,onValueChange:function(c){var d=b.state.SelectedOptions;a&&(d=[]),b.setState({IsOtherOptionSelected:!!c,OtherOptionText:c,SelectedOptions:d},function(){return b.updateAnswer()})},Options:{HTMLPropsForInnerElement:c},Placeholder:q.LocalizedStrings.Designer_OtherAnswer,ref:this.otherAnswerTextRef,Value:this.state.OtherOptionText};return l.createTextField(d)},b.prototype.initializeState=function(){var a,b=this.props.Master,c=b.Question.Model;a=!c.ShuffleOptions||this.props.DisableShuffle?Nerve.convertToArray(c.Choices):h.shuffle(c.Choices),this.setState({ChoiceOptions:a}),this.updateStateBasingOnAnswer(a)},b.prototype.updateStateBasingOnAnswer=function(a){var b=this.props.Master,c=b.Question.Model,d=[],e=!1,f="";if(b.Model.Answer){var g=c.ChoiceType===p.ChoiceType.SingleChoice,h=g?[b.Model.Answer]:this.parseArrayAnswer(b.Model.Answer),i=a.map(function(a){return a.Description});h.forEach(function(a){i.indexOf(a)>=0?d.push(a):(e=!0,f=a)})}this.setState({IsOtherOptionSelected:e,OtherOptionText:f,SelectedOptions:d})},b.prototype.onChange=function(a,b,c){var d=this,e=this.state.SelectedOptions,f=this.state.IsOtherOptionSelected;if(c)e=[],f=!1,e.push(a);else{e||(e=[]);var g=e.indexOf(a);b?g>=0&&e.splice(g,1):0>g&&e.push(a)}this.setState({IsOtherOptionSelected:f,SelectedOptions:e},function(){return d.updateAnswer()})},b.prototype.onSingleChoiceOtherAnswerChange=function(){var a=this;if(this.otherAnswerTextRef.current){var b=g.findDOMNode(this.otherAnswerTextRef.current),c=b.lastChild&&b.lastChild.childNodes[0],d=[],e=!!c.value;this.setState({IsOtherOptionSelected:e,SelectedOptions:d},function(){return a.updateAnswer()})}},b.prototype.onMultiChoiceOtherAnswerChange=function(a){var b=this;if(this.otherAnswerTextRef.current){var c=g.findDOMNode(this.otherAnswerTextRef.current),d=c.lastChild&&c.lastChild.childNodes[0],e=!1;a&&(e=!0,d&&d.focus()),this.setState({IsOtherOptionSelected:e},function(){return b.updateAnswer()})}},b.prototype.parseArrayAnswer=function(a){var b=this.props.Master.Question,c=b.Model;return p.Question.getChoiceAnswer(a,c).SelectedOptions},b.prototype.createDropDown=function(){var a,c,d=this,e=this.props.Master,g=e.Question.Model,h=this.state.ChoiceOptions,i=h.map(function(a){var b={DisplayName:a.Description,Key:Nerve.getObjectMasterFromModel(a).getInstanceId(),Value:a.Description};return b}),j=e.Model.Answer;n.Flight.isEnabled(n.Flights.DropDown)?(g.AllowOtherAnswer&&i.push(b.createDropDownOtherOption()),this.state.IsOtherOptionSelected&&(j=s),this.props.ShowDesignInfo||(a=this.createDropDownOtherAnswer()),c=function(a){return d.onDropDownValueChange(a)}):c=function(a){return e.Model.Answer=a};var k=l.createSelect({AllowWrap:!0,HTMLAttributes:this.getElementProps({className:"office-form-question-dropdown",disabled:this.props.Disabled,title:g.Hint||q.LocalizedStrings.Dropdown_DefaultHint}),key:"choicequestion-dropdown",onValueChange:c,Placeholder:g.Hint||q.LocalizedStrings.Dropdown_DefaultHint,SelectOptions:i,Value:j});return f.createElement("div",{className:this.getValidationStyle()},k,a)},b.prototype.onDropDownValueChange=function(a){var b=this,c=a===s,d=c?[]:[a];if(c&&this.otherAnswerTextRef.current){var e=g.findDOMNode(this.otherAnswerTextRef.current);e.classList.remove("none-display");var f=e.lastChild&&e.lastChild.childNodes[0];f.focus()}this.setState({IsOtherOptionSelected:c,SelectedOptions:d},function(){return b.updateAnswer()})},b.createDropDownOtherOption=function(){var a={DisplayName:q.LocalizedStrings.Designer_OtherAnswer,Key:s,Value:s};return a},b.prototype.createDropDownOtherAnswer=function(){var a=this,b="office-form-other-answer office-form-dropdown-other-answer";this.state.IsOtherOptionSelected||(b=r.Html.combineAttributes(b,"none-display"));var c={"aria-label":q.LocalizedStrings.TextField_DefaultPlaceholder,className:"office-form-other-answer-textbox"},d={Disabled:this.props.Disabled,HTMLAttributes:{className:b},onValueChange:function(b){a.setState({OtherOptionText:b,SelectedOptions:[]},function(){return a.updateAnswer()})},Options:{HTMLPropsForInnerElement:c},Placeholder:q.LocalizedStrings.TextField_DefaultPlaceholder,ref:this.otherAnswerTextRef,Value:this.state.OtherOptionText};return l.createTextField(d)},b.prototype.sortAnswers=function(a){var b=this.props.Master.Question.Model.Choices,c=h.map(b,function(a){return a.Description});return a.sort(function(a,b){return c.indexOf(a)-c.indexOf(b)})},b.isQuizResultAnswerKey=function(a,b){if(!a||!a.IsAnswerKeys)return!1;var c=a.Choices;return c?a.IsAnswerKeys[c.indexOf(b.Description)]:!1},b.getAnswerKeyMark=function(a,c,d){var e,f,g,h=a.Master,i=h.Model.QuizResult,j=h.Question,k=b.isQuizResultAnswerKey(i,c);if(c.IsAnswerKey&&a.ShowDesignInfo&&j.Model.IsQuiz||k)g="CheckMark",e=a.IsMobile&&d?"image-button-checked-answerkey-mobile office-form-answerkey":"image-button-answerkey office-form-answerkey",f=q.LocalizedStrings.Quiz_CorrectAnswer;else{if(!(d&&i&&i.IsAnswerKeys&&i.IsAnswerKeys.some(function(a){return a}))||k)return void 0;e=a.IsMobile?"image-button-checked-wrong-answer-mobile office-form-answerkey":"",g=a.IsMobile?"Cancel":"",f=q.LocalizedStrings.Quiz_WrongAnswer}return e=r.Html.combineAttributes(e,"forms-icon-size20x20"),l.createFontIconControl({HTMLAttributes:{className:e,role:"tooltip",title:f},IconName:g})},b.getAnswerHintLabel=function(a,c,d){var e,g=a.Master.Model.QuizResult;if(!a.ShowDesignInfo&&d&&g){var h=g.Choices,i=h?h.indexOf(c.Description):-1,j=g.AnswerHints&&g.AnswerHints[i];if(j){var k=void 0;k=b.isQuizResultAnswerKey(g,c)?a.IsMobile?"validation-success-mobile":"validation-success":a.IsMobile?"validation-error-mobile":"validation-error",k=r.Html.combineAttributes("office-form-answerhint",k),e=f.createElement("div",{className:k},j)}}return e},b}(j.QuestionRendererBase);i.registerRendererComponentClass(p.QuestionType.Choice,t)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(8),f=c(9),g=OfficeForm.Exports.Control,h=OfficeForm.Exports.Models,i=OfficeForm.Exports.Resources,j=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.createReactNodes=function(){var a,b=this,c=this.props.Master.Model;return this.isValueInvalid&&(a=g.createLabel({Alert:!0,HTMLAttributes:{className:"validation-error-message-label",role:"alert"},key:"error",Label:i.LocalizedStrings.DateValidation_ErrorMessage.format(OfficeFormServerInfo.cultureInfo.DateTimeFormat.ShortDatePattern)})),[g.createDateTimePicker({DateTitle:i.LocalizedStrings.QuestionType_DatePicker_DateTitle,Disabled:this.props.Disabled,IsLocaleInvariant:!0,key:"dateTime",onValueChange:function(a){c.Answer=a},onValueValidation:function(a){b.isValueInvalid=!a,b.forceUpdate()},Options:{classNameForInnerDiv:"office-form-textfield",HTMLPropsForInnerElement:this.getElementProps({className:"office-form-question-textbox"})},Placeholder:i.LocalizedStrings.QuestionType_DateTime_PlaceHolder.format(OfficeFormServerInfo.cultureInfo.DateTimeFormat.ShortDatePattern),ShowClearButton:!0,Theme:this.props.Theme,Type:g.PickerType.DatePicker,ValidationStyle:this.getValidationStyle(),Value:c.Answer}),a]},b}(f.QuestionRendererBase);e.registerRendererComponentClass(h.QuestionType.DateTime,j)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(46),g=c(8),h=c(9),i=OfficeForm.Exports.Models,j=function(a){function b(b){var c=a.call(this,b)||this;return c.createOD4BTempFolder=c.createOD4BTempFolder.bind(c),c.setAnswer=c.setAnswer.bind(c),c}return d(b,a),b.prototype.createReactNodes=function(){var a=this.props;return[e.createElement(f.FileUploadQuestionRenderer,{Answer:a.Master.Model.Answer,createOD4BTempFolderCallBack:this.createOD4BTempFolder,decreaseUploadingFileCountCallBack:a.decreaseUploadingFileCountCallBack,Disabled:a.Disabled,FileTypes:a.Master.Question.Model.FileTypes,FileUploadProps:this.getElementProps(),FormId:a.Master.Question.Form.Model.Id,HideDeleteButton:!!a.HideDeleteButton,increaseUploadingFileCountCallBack:a.increaseUploadingFileCountCallBack,IsStudentViewMode:!!a.IsStudentViewMode,setAnswerCallback:this.setAnswer,ShowFileInfo:!!a.ShowFileInfo})]},b.prototype.createOD4BTempFolder=function(){return this.props.Master.createOD4BTempFolder()},b.prototype.setAnswer=function(a){this.props.Master.Model.Answer=a||""},b}(h.QuestionRendererBase);g.registerRendererComponentClass(i.QuestionType.FileUpload,j)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(3),h=c(8),i=c(48),j=c(9),k=OfficeForm.Exports.Models,l=OfficeForm.Exports.Utilities.isSmallScreen,m=function(a){function b(b){var c=a.call(this,b)||this;return c.state={IsSubQuestionsExpanded:[!b.Disabled]},c}return d(b,a),b.prototype.componentWillMount=function(){var b=this;a.prototype.componentWillMount.call(this);var c=this.props.Master;this.onSubQuestionListChangeCallback=function(a){return b.onSubQuestionListChange(a)};var d=Nerve.getCollectionMasterFromModel(c.Question.Form.Model.Questions);d.observe(this.onSubQuestionListChangeCallback)},b.prototype.componentWillUnmount=function(){var b=Nerve.getCollectionMasterFromModel(this.props.Master.Question.Form.Model.Questions);b.unobserve(this.onSubQuestionListChangeCallback),a.prototype.componentWillUnmount.call(this)},b.prototype.createReactNodes=function(){var a,b=this.createSubQuestionsLayout(),c=this.showPadView();if(c){var d=this.getElementProps({className:"office-form-mobile-matrix-container",key:"Likert",role:"List"});a=f.createElement("div",e({},d),b)}else{var g=this.createHeaderLine();a=f.createElement("div",{className:"office-form-matrix-table",key:"Likert"},f.createElement("table",e({},this.getElementProps()),g,f.createElement("tbody",{className:"office-form-matrix-stbody"},b)))}return[a]},b.prototype.onSubQuestionListChange=function(a){var b=this.props.Master,c=a.AddedModels.concat(Nerve.convertToArray(a.RemovedModels)).map(Nerve.getObjectMasterFromModel).some(function(a){return a.Model.GroupId===b.Question.Model.Id});c&&this.forceUpdate()},b.prototype.createHeaderLine=function(){var a=this,b=this.props.Master.Question.Model,c=b.ChoiceGroup,d=f.createElement("td",{className:"office-form-matrix-ptd",key:"emptyTd"}),h={className:"office-form-matrix-ptd",width:"width:calc((100% - 180px)/"+c.length+")"},i=g.map(c,function(b,c){return f.createElement("td",e({},h,{key:c,id:a.getLabelId(c)}),f.createElement("span",null,b.Description))});return f.createElement("thead",{className:"office-form-matrix-pthead"},f.createElement("tr",{className:"office-form-matrix-ptr"},d,i))},b.prototype.createSubQuestionsLayout=function(){var a=this,b=this.props.Master,c=b.Question.Model.ChoiceGroup,d=b.SubQuestions,h=this.showPadView(),j=g.map(d,function(d,g){var j={Choices:c,Disabled:a.props.Disabled,IsExpanded:a.state.IsSubQuestionsExpanded[g],onChange:function(b,c){return a.questionExpandedChange(b,c)},PadView:!!h,QuestionIndex:g,QuestionMaster:d,QuestionOrdinal:a.getQuestionId(),QuestionRuntimeMaster:b.getSubQuestionRuntimeById(d.Model.Id),ShowDesignInfo:!!a.props.ShowDesignInfo};return f.createElement(i.LikertSubQuestionRenderer,e({},j,{key:d.getInstanceId()}))});return j},b.prototype.showPadView=function(){return this.props.IsMobile||!this.props.ShowDesignInfo&&l()},b.prototype.questionExpandedChange=function(a,b){var c=this.props.Master.SubQuestions.length,d=[];c>a&&(d[a]=b),this.setState({IsSubQuestionsExpanded:d})},b.prototype.getLabelId=function(a){return this.getQuestionId()+"-col-"+(a+1)},b}(j.QuestionRendererBase);h.registerRendererComponentClass(k.QuestionType.MatrixChoiceGroup,m)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(56),g=c(8),h=c(9),i=OfficeForm.Exports.Models,j=function(a){function b(b){var c=a.call(this,b)||this;return c.onValueChangeCallback=function(a){return c.props.Master.Model.Answer=a},c}return d(b,a),b.prototype.createReactNodes=function(){var a=this.props.Master.Question.Model,b=this.props.Master.Model;return[e.createElement("div",{key:"nps",className:"office-form-question-nps-container"},e.createElement(f.NPSControl,{ClassNameForInnerLabel:"office-form-theme-button-foreground",Disabled:this.props.Disabled,HTMLAttributes:this.getElementProps(),LeftLabel:a.LeftDescription,RightLabel:a.RightDescription,onValueChange:this.onValueChangeCallback,Value:b.Answer}))]},b}(h.QuestionRendererBase);g.registerRendererComponentClass(i.QuestionType.NPS,j)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f,g=c(0),h=c(3),i=c(7),j=c(2),k=c(8),l=c(9),m=OfficeForm.Exports.Control,n=OfficeForm.Exports.JavaScriptLoader,o=OfficeForm.Exports.Models,p=OfficeForm.Exports.Resources,q=OfficeForm.Exports.Utilities;!function(a){a[a.Up=0]="Up",a[a.Down=1]="Down"}(f=b.Direction||(b.Direction={}));var r=function(a){function b(b){var c=a.call(this,b)||this;return c.choices=null,c.focusStatus=-1,c.rankingRef=g.createRef(),c.isDragging=!1,c.sortableInitialized=!1,c.updateChoicesInternally(),c.state={SelectedElementIndex:-1},c.rankUp=c.rankUp.bind(c),c.rankDown=c.rankDown.bind(c),c.focusOnSortItem=c.focusOnSortItem.bind(c),c.blurOnSortItem=c.blurOnSortItem.bind(c),c.onKeyDown=c.onKeyDown.bind(c),c.decorateSortableGroup=c.decorateSortableGroup.bind(c),c}return d(b,a),b.prototype.componentWillMount=function(){var b=this;a.prototype.componentWillMount.call(this),n.loadJavaScript("Sortable").done(function(){b.setState({SortableLoaded:!0})}),this.choicesUpdate=function(){b.updateChoicesInternally(),b.forceUpdate()},this.props.Master.Question.observe(this.choicesUpdate,[o.QuestionMaster.Schema.ChoiceGroup])},b.prototype.componentWillUnmount=function(){this.sortable&&(this.sortable.destroy(),this.sortable=void 0),a.prototype.componentWillUnmount.call(this),this.props.Master.Question.unobserve(this.choicesUpdate)},b.prototype.componentWillReceiveProps=function(a){(a.ShowDesignInfo||a.Disabled)&&this.sortable&&(this.sortable.destroy(),this.sortable=void 0)},b.prototype.componentDidMount=function(){a.prototype.componentDidMount.call(this);var b=this.rankingRef.current;!this.props.ShowDesignInfo&&!this.props.Disabled&&this.state.SortableLoaded&&b&&this.decorateSortableGroup(b),this.props.ShowQuizResult&&(this.choices=null)},b.prototype.componentDidUpdate=function(a,b){if(this.choices&&this.choices.length>0&&-1!==this.focusStatus&&this.updateFocusStatus(),!this.props.ShowDesignInfo&&!this.props.Disabled&&this.state.SortableLoaded&&!this.sortable){var c=this.rankingRef.current;c&&this.decorateSortableGroup(c)}this.props.ShowQuizResult&&(this.choices=null)},b.prototype.createReactNodes=function(){var a=this.createSortableList(),b=this.createCorrectAnswerList(),c=this.props.IsMobile?"office-form-mobile-sort-list":"office-form-sort-list",d=this.getElementProps({className:c,ref:this.rankingRef,role:"listbox"});return[g.createElement("div",e({},d,{key:"Ranking"}),a),b]},b.prototype.decorateSortableGroup=function(a){var c=this,d=150,e={animation:d,chosenClass:"office-form-sortable-chosen",delay:this.props.IsMobile?d:0,fallbackClass:"office-form-sortable-fallback",filter:".office-form-ranking-arrow",forceFallback:!0,ghostClass:"office-form-sortable-ghost",handle:".office-form-sort-item",onEnd:function(d){var e=d.oldIndex,f=d.newIndex,g=c.props.Master.Model.Answer;if(c.isDragging=!1,g&&e===f)d.item.firstChild.focus();else{var h=c.choices,i=h.splice(e,1);h.splice(f,0,i[0]),f>e?$(a).find(".office-form-sort-item-container:eq("+e+")").before($(d.item)):e>f&&$(a).find(".office-form-sort-item-container:eq("+e+")").after($(d.item)),c.focusStatus=0,c.setState({SelectedElementIndex:f},function(){c.props.Master.Model.Answer=b.stringifyAnswer(h)})}},onStart:function(){c.isDragging=!0},preventOnFilter:!1};try{this.sortable=Sortable.create(a,e),this.sortableInitialized||j.log({eventName:"DesignPage.Questions.SortableInitialization",eventType:"engagement_event",extraData:{Successful:!0}}),this.sortableInitialized=!0}catch(f){j.log({eventName:"DesignPage.Questions.SortableInitialization",eventType:"engagement_event",extraData:{Successful:!1}}),this.sortableInitialized=!1}},b.prototype.createSortableList=function(){var a=this,b=this.props.Master.Model.Answer;this.choices||this.updateChoicesInternally();var c=this.shouldShowJudgeIcon(),d=b&&b.length>0;return h.map(this.choices,function(b,e){return a.createRankItem(b,e,c,d)})},b.prototype.createRankItem=function(a,c,d,f){var h,i=this.state.SelectedElementIndex===c;if(f&&d){var j=this.props.Master.Model.QuizResult,k=JSON.parse(j.GradingBasis),l=a.Key===k[c];h=g.createElement("span",{className:"office-form-sort-item-icon"},b.getAnswerKeyMark(l))}!this.props.Disabled&&this.props.IsMobile&&(h=g.createElement("span",{className:"office-form-sort-item-icon"},b.createDragHandleIcon()));var n,o=q.Html.combineAttributes("office-form-sort-item-indicator",i?"selected":""),r=g.createElement("div",{className:o},h,g.createElement("span",{className:"office-form-sort-item-ordinal office-form-theme-secondary-color"},f?c+1:void 0)),s=q.Html.combineAttributes("office-form-sort-item",!this.props.Disabled&&i?"office-form-theme-primary-background office-form-selected-item":"office-form-nonselected-item"),t=this.getQuestionId()+"-"+c,u={"aria-posinset":c+1,"aria-setsize":this.choices.length,className:s,disabled:this.props.Disabled,id:t,role:"option",tabIndex:0};if(!this.props.Disabled){var v={disabled:!0,tabIndex:-1},w=0===c,x={"aria-describedby":t,"aria-label":p.LocalizedStrings.QuestionType_Ranking_ArrowUp_Narrator,className:q.Html.combineAttributes("office-form-ranking-arrow",w?"office-sort-disabled-arrow":"office-form-active-arrow"),onClick:w?void 0:this.rankUp,title:p.LocalizedStrings.QuestionType_Ranking_ArrowUp_Narrator};x=w?q.Html.mergeReactProps(x,v):x;var y=m.createButton({ButtonStyle:"LightBackground",children:m.createFontIconControl({HTMLAttributes:{className:"forms-icon-size18x18"},IconName:"Up"}),HTMLAttributes:x,key:"form-up-arrow"+c}),z=c===this.choices.length-1,A={"aria-describedby":t,"aria-label":p.LocalizedStrings.QuestionType_Ranking_ArrowDown_Narrator,className:q.Html.combineAttributes("office-form-ranking-arrow",z?"office-sort-disabled-arrow":"office-form-active-arrow"),onClick:z?void 0:this.rankDown,title:p.LocalizedStrings.QuestionType_Ranking_ArrowDown_Narrator};A=z?q.Html.mergeReactProps(A,v):A;var B=m.createButton({ButtonStyle:"LightBackground",children:m.createFontIconControl({HTMLAttributes:{className:"forms-icon-size18x18"},IconName:"Down"}),HTMLAttributes:A,key:"form-down-arrow"+c});u=q.Html.mergeReactProps(u,{onFocus:this.focusOnSortItem,onKeyDown:this.onKeyDown}),i&&(u=q.Html.mergeReactProps(u,{onBlur:this.blurOnSortItem}));var C=q.Html.combineAttributes("office-form-sort-list-arrows",i?"":"NotVisible");n=g.createElement("div",{className:C},y,B)}var D=g.createElement("div",e({},u,{"data-index":c}),r,g.createElement("p",{className:"office-form-sort-item-content"},a.Description),n);return g.createElement("div",{className:"office-form-sort-item-container office-form-unselectable",key:a.Key},D)},b.prototype.focusOnSortItem=function(a){var b=a.currentTarget,c="index",d=parseInt(b.dataset[c],10);this.isDragging||this.state.SelectedElementIndex===d||this.setState({SelectedElementIndex:d})},b.prototype.blurOnSortItem=function(a){var b=a.currentTarget,c=q.Html.getTargetElementOfFocusEvent(a);this.isDragging||b&&c&&b.contains(c)||this.setState({SelectedElementIndex:-1})},b.prototype.rankUp=function(){this.resortItems(f.Up)},b.prototype.rankDown=function(){this.resortItems(f.Down)},b.prototype.resortItems=function(a){var c=this.choices,d=this.state.SelectedElementIndex,e=c.splice(d,1);a===f.Up?(this.focusStatus=1,--d):(this.focusStatus=2,++d),c.splice(d,0,e[0]);var g=b.stringifyAnswer(c);this.props.Master.Model.Answer=g,this.setState({SelectedElementIndex:d})},b.getAnswerKeyMark=function(a){return m.createFontIconControl({HTMLAttributes:{className:q.Html.combineAttributes("office-form-judge-icon forms-icon-size16x16",a?"office-form-right-answerkey":"office-form-wrong-answerkey")},IconName:a?"CheckMark":"Cancel"})},b.stringifyAnswer=function(a){return h.map(a,function(a,b){return{answerOrder:b,id:a.Id}})},b.createDragHandleIcon=function(){return g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},g.createElement("circle",{cx:"9.5",cy:"6.5",r:"1.5",fill:"currentColor"}),g.createElement("circle",{cx:"14.5",cy:"6.5",r:"1.5",fill:"currentColor"}),g.createElement("circle",{cx:"9.5",cy:"12.5",r:"1.5",fill:"currentColor"}),g.createElement("circle",{cx:"14.5",cy:"12.5",r:"1.5",fill:"currentColor"}),g.createElement("circle",{cx:"9.5",cy:"18.5",r:"1.5",fill:"currentColor"}),g.createElement("circle",{cx:"14.5",cy:"18.5",r:"1.5",fill:"currentColor"}))},b.prototype.shouldShowJudgeIcon=function(){var a=this.props.Master.Question.Model,b=this.props.Master.Model.QuizResult;return this.props.ShowQuizResult&&a.IsQuiz?!!b:!1},b.prototype.createCorrectAnswerList=function(){var a=this.props.Master.Model.QuizResult;if(this.shouldHideCorrectAnswerList())return void 0;var b=this.props.Master.Question.Model.ChoiceGroup,c=JSON.parse(a.GradingBasis),d=c.map(function(a){return h.findWhere(b,{Key:a})}).filter(function(a){return!!a}).map(function(a){return a&&a.Description}),e=d.join(p.LocalizedStrings.VariousLocations_ItemList_Separator),f=q.Html.combineAttributes("office-form-right-answerkey","various-short-text-correct-answer-list-correctness-icon","forms-icon-size14x14"),i=m.createFontIconControl({HTMLAttributes:{"aria-hidden":!0,className:f,role:"presentation"},IconName:"CheckMark"});return g.createElement("div",{className:"various-short-text-correct-answer-list"},i,g.createElement("b",null,p.LocalizedStrings.VariousLocations_CorrectAnswerList_Label," "),e)},b.prototype.shouldHideCorrectAnswerList=function(){var a=this.props.Master.Question.Model,b=this.props.Master.Model.QuizResult;return this.props.ShowDesignInfo||!a.IsQuiz?!0:!b||b.IsAnswerCorrect?!0:!1},b.prototype.onKeyDown=function(a){if(a.keyCode!==i.KeyCode.Tab&&a.keyCode!==i.KeyCode.Enter){var b="index",c=parseInt(a.currentTarget.dataset[b],10),d=this.choices.length;switch(c=d+c,a.keyCode){case i.KeyCode.ArrowUp:this.focusStatus=0,this.setState({SelectedElementIndex:--c%d});break;case i.KeyCode.ArrowDown:this.focusStatus=0,this.setState({SelectedElementIndex:++c%d})}}},b.prototype.updateFocusStatus=function(){var a=this.state.SelectedElementIndex,b=this.rankingRef.current;if(b){var c=b.children[a];if(c){var d=void 0;if(0===this.focusStatus)d=c.firstElementChild;else{var e=c.querySelector(".office-form-sort-list-arrows"),f=void 0;f=1===this.focusStatus?0===a?1:0:a===this.choices.length-1?0:1,d=e.children[f]}d.focus()}}this.focusStatus=-1},b.prototype.updateChoicesInternally=function(){var a=this.props.Master,b=a.Question,c=b.Model,d=a.Model.Answer;
d&&d.length>0?this.choices=h.clone(d).sort(function(a,b){return a.answerOrder-b.answerOrder}).map(function(a){return h.find(c.ChoiceGroup,function(b){return b.Id===a.id})}).filter(function(a){return!!a}):this.props.ShowDesignInfo||!c.IsQuiz||this.props.ShowQuizResult?this.choices=Nerve.convertToArray(c.ChoiceGroup):this.choices=h.shuffle(c.ChoiceGroup)},b}(l.QuestionRendererBase);k.registerRendererComponentClass(o.QuestionType.Ranking,r)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(8),f=c(9),g=OfficeForm.Exports.Control,h=OfficeForm.Exports.Models,i=OfficeForm.Exports.Resources,j=OfficeForm.Exports.Utilities,k=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.createReactNodes=function(){var a=this.props.Master,b=a.Question.Model,c=b.Length>3&&(this.props.IsMobile||j.isMobile());return b.RatingShape===h.RatingShape.Number?[g.createNumberRating({Disabled:this.props.Disabled,HTMLAttributes:this.getElementProps(),key:"numberRating",Layout:c?"Center":"Left",LeftDescription:b.LeftDescription,Length:b.Length,MinRating:b.MinRating,onValueChange:function(b){return a.Model.Answer=b},RightDescription:b.RightDescription,ShowRatingLabel:b.ShowRatingLabel,Value:a.Model.Answer})]:($.rateit.aria.ratingLabel=i.LocalizedStrings.RateItControl_AriaLabel,j.isIOS()&&($.rateit.aria.ratingDescription=i.LocalizedStrings.RateItControl_AriaDescription),[g.createRating({Disabled:this.props.Disabled,IsMobile:!!this.props.IsMobile,key:"rating",Label:"",LeftDescription:b.LeftDescription,LeftDescriptionTitle:i.LocalizedStrings.RatingDescriptionTitle.format(1),Length:b.Length,NoTabFocus:this.props.Disabled,onValueChange:function(b){return a.Model.Answer=b},Options:{HTMLPropsForInnerElement:this.getElementProps()},RightDescription:b.RightDescription,RightDescriptionTitle:i.LocalizedStrings.RatingDescriptionTitlePlural.format(b.Length),ShowRatingLabel:b.ShowRatingLabel,Theme:this.props.Theme,ValidationStyle:this.getValidationStyle(),Value:a.Model.Answer})])},b}(f.QuestionRendererBase);e.registerRendererComponentClass(h.QuestionType.Rating,k)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(3),h=c(2),i=c(32),j=c(8),k=c(9),l=OfficeForm.Exports.Control,m=OfficeForm.Exports.FormLimitation,n=OfficeForm.Exports.Models,o=n.QuestionValidationResult,p=OfficeForm.Exports.Resources,q=OfficeForm.Exports.Utilities,r=OfficeForm.Exports.EngagementEventNames,s=OfficeForm.Exports.Flighting,t=function(a){function b(b){var c=a.call(this,b)||this;return c.domRole="presentation",c.onMathValueChange=c.onMathValueChange.bind(c),c.toggleMathResponse=c.toggleMathResponse.bind(c),c.validateOnBlur=c.validateOnBlur.bind(c),c.setInputFieldDefault(),c}return d(b,a),b.prototype.createReactNodes=function(){var a,b,c=this.props.Master.Model,d=this.props.Master.Question,e=d.Model,g=this.getErrorMessageLabel();if(this.props.PrintView)a=f.createElement("div",{className:"textbox-printview",key:"printView"},c.Answer);else{var h=void 0,j=void 0;if(e.IsMathQuiz&&!e.Multiline&&s.Flight.isEnabled(s.Flights.TextFieldMathAnswers)){var k=this.getCorrectnessIcon(!0),n=this.shouldDisableMathSwitcher,o=this.props.Disabled||n?void 0:this.createMathTextSwitcher(),r=void 0,t=void 0;if(c.AnswerEntity)r=c.AnswerEntity.IsMathAnswer,t=c.AnswerEntity.Answer;else{r=!e.IsAnswerPlainText;var u=q.tryParseJson(c.Answer||"{}");t=u.Answer||""}if(r){var v=n?p.LocalizedStrings.TextField_EnterMathAnswer:p.LocalizedStrings.TextField_DefaultPlaceholder,w={onBlur:this.validateOnBlur},x=f.createElement(i.FormulaDesigner,{Disabled:this.props.Disabled,HTMLAttributes:w,key:"textmathquestion-mathfield",Location:"TextField.Response",onValueChange:this.onMathValueChange,Placeholder:v,QuestionId:e.Id,Value:t},o);j=f.createElement("div",{className:"office-form-response-question-math-container"},x,k)}else{var y=l.createTextField({AutoSelection:!0,Disabled:this.props.Disabled,HTMLAttributes:{className:"design-question-math-plaintext-text",onBlur:this.validateOnBlur},key:"textmathquestion-textfield",Label:void 0,MaxLength:m.AnswerTextfieldLength,MinimalHeight:40,onValueChange:this.onMathValueChange,Options:{HTMLPropsForInnerElement:this.getElementProps({className:"design-question-math-plaintext-text"})},Placeholder:p.LocalizedStrings.TextField_DefaultPlaceholder,Theme:this.props.Theme,ValidationStyle:this.getValidationStyle(),Value:t});j=f.createElement("div",{className:"office-form-response-question-math-textfield"},y,o,k)}b=f.createElement("div",{className:"student-feedback-view-short-text-field-with-correctness",key:"normalView"},j)}else{h=l.createTextField({Disabled:this.props.Disabled,HTMLAttributes:{onBlur:this.validateOnBlur},key:"textquestion-textfield",Label:void 0,MaxLength:m.AnswerTextfieldLength,onValueChange:function(a){return c.Answer=a},Options:{HTMLPropsForInnerElement:this.getElementProps({className:"office-form-question-textbox"})},Placeholder:e.IsNumber?d.getNumberValidationErrorMessage():e.Placeholder||p.LocalizedStrings.TextField_DefaultPlaceholder,TextFieldType:e.Multiline?l.TextFieldType.AutoHeightMultiline:l.TextFieldType.SingleLine,Theme:this.props.Theme,ValidationStyle:this.getValidationStyle(),Value:c.Answer});var k=this.getCorrectnessIcon();b=f.createElement("div",{className:"student-feedback-view-short-text-field-with-correctness",key:"normalView"},h,k)}}return[a,b,this.createCorrectAnswerList(),g]},b.prototype.createMathTextSwitcher=function(){var a=this.props.Master.Question.Model,b="design-question-choice-to-math-button";this.props.IsMobile&&(b=q.Html.combineAttributes(b,"isMobile"));var c,d;return a.IsAnswerPlainText?(c={"aria-label":p.LocalizedStrings.Designer_Question_Equation_Button,className:b,onClick:this.toggleMathResponse(),title:p.LocalizedStrings.Designer_Question_Equation_Button_Tooltip},d="NumberField"):(c={"aria-label":p.LocalizedStrings.Designer_Question_EquationToText_Button,className:b,onClick:this.toggleMathResponse(),title:p.LocalizedStrings.Designer_Question_EquationToText_Button_Tooltip},d="TextField"),l.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:c,Icon:d,IconClassName:"design-question-choice-to-math-button-icon"})},b.prototype.toggleMathResponse=function(){var a=this;return function(b){var c=a.props.Master.Question.Model,d=a.props.Master.Model,e=q.tryParseJson(d.Answer||"{}");c.IsAnswerPlainText=!c.IsAnswerPlainText;var f={Answer:e.Answer,IsMath:!c.IsAnswerPlainText};d.Answer=JSON.stringify(f),h.log({eventName:c.IsAnswerPlainText?r.DesignPage.Quiz.SwitchMathToTextInput:r.DesignPage.Quiz.SwitchTextToMathInput,eventType:"engagement_event",extraData:{location:"TextField.Response"}}),a.forceUpdate()}},b.prototype.setInputFieldDefault=function(){var a=this.props.Master.Question.Model,b=this.props.Master;if(!a.IsMathQuiz||!s.Flight.isEnabled(s.Flights.TextFieldMathAnswers))return a.IsAnswerPlainText=!0,void(this.shouldDisableMathSwitcher=!0);if(b.Model.Answer){var c=q.tryParseJson(b.Model.Answer||"{}");if(void 0!==c.IsMath)return void(a.IsAnswerPlainText=!c.IsMath)}var d=new n.ShortTextAutograder(a).getAnswers();return d&&d.length>0?(this.shouldDisableMathSwitcher=!d.some(function(a){return a.isMath!==d[0].isMath}),void(a.IsAnswerPlainText=!g.any(d,function(a){return a.isMath}))):(a.IsAnswerPlainText=!1,void(this.shouldDisableMathSwitcher=!1))},b.prototype.onMathValueChange=function(a){var b=this.props.Master.Model,c={Answer:a,IsMath:!this.props.Master.Question.Model.IsAnswerPlainText};b.Answer=JSON.stringify(c)},b.prototype.validateOnBlur=function(){var a=this.props.Master.Model,b=this.props.Master.Question;if(b.Model.IsNumber){var c=a.Answer;b.verify(c)!==o.Success||b.Model.IsMathQuiz||(a.Answer=q.NumberValidation.formatAsFloat(c))}},b.prototype.getErrorMessageLabel=function(){var a=this.props.Master.Model,b=this.props.Master.Question,c=b.verify(a.Answer);if(a.Answer&&c!==o.Success){var d=void 0;switch(c){case o.NumberValidationError:d=b.getNumberValidationErrorMessage();break;case o.MathLengthError:d=p.LocalizedStrings.Math_Answer_LengthLimit_Message;break;default:return void 0}return l.createLabel({Alert:!0,HTMLAttributes:{className:"validation-error-message-label",role:"alert"},key:"textquestion-errorlabel",Label:d})}},b.prototype.getCorrectnessIcon=function(a){var c=this.props.Master,d=this.props.Master.Question,g=d.Model;if(!this.props.ShowQuizResult||g.Multiline||!g.IsQuiz)return void 0;var h=b.isAnswerCorrect(c);if(null===h)return void 0;if(!h&&!this.props.IsMobile)return void 0;var i=a?"student-feedback-view-short-text-math-correctness-icon-container":"student-feedback-view-short-text-correctness-icon-container";this.props.IsMobile&&(i=q.Html.combineAttributes(i,"isMobile"));var j,k=h?p.LocalizedStrings.Quiz_CorrectAnswer:p.LocalizedStrings.Quiz_WrongAnswer,m={HTMLAttributes:{className:q.Html.combineAttributes("student-feedback-view-short-text-correctness-icon forms-icon-size14x14",h?"image-button-answerkey":"image-button-checked-wrong-answer"),title:k},IconName:h?"CheckMark":"Cancel"},n=c.Model.Answer;if(j=n,!n||q.Guid.isNullOrEmpty(n))j=g.Placeholder||p.LocalizedStrings.TextField_DefaultPlaceholder;else if(d.Model.IsMathQuiz){var o=q.tryParseJson(n||"{}");j=o.IsMath?l.createFormulaRenderer({Formula:null==o.Answer?n:o.Answer}):null==o.Answer?n:o.Answer}var r={"aria-hidden":!0,className:"student-feedback-view-short-text-hidden-text-to-position-correctness-icon",role:this.domRole};return f.createElement("div",{className:i},f.createElement("span",e({},r),j),l.createFontIconControl(m))},b.isAnswerCorrect=function(a){var b=a.Model;if(null!=b.QuizResult)return b.QuizResult.IsAnswerCorrect;var c=new n.ShortTextAutograder(a.Question.Model);return c.areAnyAnswersDefined()?a.Question.isCorrectAnswer(b.Answer):null},b.prototype.createCorrectAnswerList=function(){var a=this.props.Master.Question.Model,b=this.props.Master.Model.QuizResult;if(!this.shouldShowCorrectAnswerList())return void 0;var c=null!=b?b:a,d=new n.ShortTextAutograder(c);if(!d.areAnyAnswersDefined())return void 0;var e,h=d.getAnswers();if(h.some(function(a){return a.isMath})){for(var i=[],j=0,k=h;j<k.length;j++){var m=k[j];if(m.isMath){var o=l.createFormulaRenderer({Formula:m.answer});i.push(f.createElement("div",{className:"correct-answer-list-formula-element"},o))}else i.push(m.answer);i.push(p.LocalizedStrings.VariousLocations_ItemList_Separator)}i.pop(),e=f.createElement("div",{className:"correct-answer-list-formula-container"},i)}else e=g.map(h,function(a){return a.answer}).join(p.LocalizedStrings.VariousLocations_ItemList_Separator);var q={"aria-hidden":!0,className:"office-form-right-answerkey various-short-text-correct-answer-list-correctness-icon",role:this.domRole},r={HTMLAttributes:q,IconName:""};return f.createElement("div",{className:"various-short-text-correct-answer-list",key:"answerList"},l.createFontIconControl(r),f.createElement("b",null,p.LocalizedStrings.VariousLocations_CorrectAnswerList_Label," "),e)},b.prototype.shouldShowCorrectAnswerList=function(){var a=this.props.Master.Model,b=this.props.Master.Question.Model,c=this.props.Master.Model.QuizResult,d=b.Multiline||!b.IsQuiz;if(d)return!1;var e=!this.props.ShowDesignInfo&&null==c;if(e)return!1;var f=null!=c&&c.IsAnswerCorrect;if(f)return!1;var g=null==c&&this.props.Master.Question.isCorrectAnswer(a.Answer);return g?!1:!0},b}(k.QuestionRendererBase);j.registerRendererComponentClass(n.QuestionType.TextField,t)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(1),g=OfficeForm.Exports.Utilities,h=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.render=function(){var a="form-renderer-section-breaker";return this.props.HasTheme&&(a=g.Html.combineAttributes(a,"office-form-theme-page-background")),e.createElement("div",{className:a})},b}(f.ReactComponent);Forms.UX.Renderer.SectionBreaker=h},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(1),g=c(47),h=OfficeForm.Exports.Utilities,i=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.render=function(){return e.createElement("div",{className:"form-renderer-section-container",role:"region","aria-label":this.props.SectionMaster.Model.Title},this.createSectionTitle(),e.createElement("div",{className:"form-renderer-section-content"},this.props.children))},b.prototype.createSectionTitle=function(){var a=this.props.SectionMaster.Model;if(!(a.Title||a.Subtitle||a.ImageInfo.ResourceUrl||a.VideoInfo.Url))return null;var b=h.Html.combineAttributes("form-renderer-section-title",this.props.SectionMaster.Form.Model.HasQuestionMedia&&"office-form-theme-image-question-background");return e.createElement("div",{className:b},e.createElement(g.SectionTitleRenderer,{IsMobile:this.props.IsMobile,Master:this.props.SectionMaster}))},b}(f.ReactComponent);b.SectionRender=i,Forms.UX.Renderer.SectionRender=i},function(a,b,c){"use strict";function d(){e();var a="/Pages/DesignPage.aspx";return p.IsExternalIntegration||(a+="?"+jQuery.param(s.getNonEmbedQuery())),k.redirectTo(a),!0}function e(){return l.log({eventName:t.NavigateToPortal,eventType:"engagement_event"}),!0}function f(){return e(),k.redirectTo("/Pages/DesignPage.aspx"),!0}var g=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),h=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var i=c(0),j=c(6),k=c(5),l=c(2),m=c(1),n=c(49),o=OfficeForm.Exports.Control,p=OfficeForm.Exports.EnvironmentSettings,q=OfficeForm.Exports.Control.FontIconControl,r=OfficeForm.Exports.Resources,s=OfficeForm.Exports.Utilities,t=OfficeForm.Exports.EngagementEventNames.ResponsePage.ThanksView,u=200,v=function(a){function b(b){var c=a.call(this,b)||this;return c.messageElementRef=i.createRef(),c.contentRef=i.createRef(),c.titleRef=i.createRef(),c.notifyHeightToParentWindow=c.notifyHeightToParentWindow.bind(c),c}return g(b,a),b.prototype.componentDidMount=function(){l.log({eventName:t.Navigate,eventType:"engagement_event"}),$(this.messageElementRef.current).linkify(),s.isOEmbedSPO()&&(this.notifyHeightToParentWindow(),window.addEventListener("resize",this.notifyHeightToParentWindow))},b.prototype.componentWillUnmount=function(){s.isOEmbedSPO()&&window.removeEventListener("resize",this.notifyHeightToParentWindow)},b.prototype.render=function(){var a="office-form thank-you-page-content";this.props.viewResultsHandler&&(a=s.Html.combineAttributes(a,"quiz")),this.props.submitAnother||(a=s.Html.combineAttributes(a,"one-response"));var b=!s.isOEmbedSPO()&&i.createElement("div",{className:"thank-you-page-footer-container"},this.createPromotionLink(),i.createElement(Forms.UX.Renderer.FooterControl,null)),c=n.createTitleContainerMixer({Form:this.props.FormMaster,IsSmallSize:!0,ref:this.titleRef});return i.createElement("div",{className:"thank-you-page-root-container"},c,i.createElement("div",{ref:this.contentRef,className:a},this.createMessageContent(),i.createElement("div",{className:"thank-you-page-other"},this.createQuizeButton(),this.createReloadLink())),b)},b.prototype.notifyHeightToParentWindow=function(){if(this.contentRef.current&&this.titleRef.current){var a=$(this.contentRef.current).height()+$(j.findDOMNode(this.titleRef.current)).height()+u;s.OEmbed.notifyResponsePageFixedHeightToParentWindow(a)}},b.prototype.createMessageContent=function(){var a=null===this.props.FormMaster.Model.ThankYouMessage?r.LocalizedStrings.Renderer_SubmissionSucceeded:this.props.FormMaster.Model.ThankYouMessage;return i.createElement(Forms.UX.Controls.LiveRegion,{Role:"Log",LazyRendering:!0},i.createElement("div",{className:"thank-you-page-confirm"},i.createElement(q,{HTMLAttributes:{className:"office-form-theme-primary-color thank-you-page-font-icon"},IconName:"Completed"}),i.createElement("span",{className:"thank-you-page-comfirm-text"},r.LocalizedStrings.Response_Page_Thanks)),i.createElement("div",{className:"thank-you-page-container thank-you-page-message",ref:this.messageElementRef,tabIndex:-1},a))},b.prototype.createQuizeButton=function(){return this.props.viewResultsHandler&&o.createTextButton({ButtonStyle:"LightBackground",HTMLAttributes:{className:"office-form-view-result-button office-form-theme-button",onClick:this.props.viewResultsHandler},Text:r.LocalizedStrings.Response_Thank_You_Page_Button_Quiz_ViewResults})},b.prototype.createReloadLink=function(){var a="office-form-info-children",b="thank-you-page-reload-link";return this.props.viewResultsHandler&&(b=s.Html.combineAttributes(b,"quiz")),s.isOEmbedSPO()&&(a=s.Html.combineAttributes(a,"office-form-theme-spo-link")),this.props.submitAnother?i.createElement("div",{className:b},i.createElement("a",{className:a,href:"javascript:void(0)",onClick:this.props.submitAnother},r.LocalizedStrings.Response_Submit_Again_Link)):void 0},b.prototype.createPromotionLink=function(){var a="office-form-info-children";if(this.props.ShowPromotionMessage&&!p.IsAssignmentsIntegration){var b={className:a,href:"javascript:void(0)",onClick:f};(s.isOEmbed()||p.IsExternalIntegration)&&(b.onClick=d);var c="office-form-theme-footer thank-you-page-promotion office-form-padding-align";return i.createElement("div",{className:c},i.createElement("a",h({},b),r.LocalizedStrings.Renderer_PromotionMessage))}},b}(m.ReactComponent);Forms.UX.Renderer.ThankYouPage=v},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(1),g=c(30),h=c(31),i=OfficeForm.Exports.Models,j=OfficeForm.Exports.Utilities,k=i.ImageProcessingStatus,l=i.ImageLayout,m=OfficeForm.Exports.FormLimitation,n=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.componentWillMount=function(){var a=this;this.update=function(){return a.forceUpdate()};var b=i.FormMaster.Schema;this.props.Form.observe(this.update,[b.Title,b.Description]);var c=this.props.Form.getImageSettingsMaster(i.FormMaster.Schema.LogoInfo),d=i.ImageSettingsMaster.Schema;c.observe(this.update,[d.NaturalWidth,d.NaturalHeight]);var e=this.props.Form.getImageMaster(i.FormMaster.Schema.Logo),f=i.ImageInfoMaster.Schema;e.observe(this.update,[f.ImageProcessingStatus,f.UploadParameters])},b.prototype.componentWillUnmount=function(){this.props.Form.unobserve(this.update);var a=this.props.Form.getImageSettingsMaster(i.FormMaster.Schema.LogoInfo);a.unobserve(this.update);var b=this.props.Form.getImageMaster(i.FormMaster.Schema.Logo);b.unobserve(this.update)},b.prototype.render=function(){var a,b=this.props.Form,c=b.Model,d={className:j.Html.combineAttributes("__title__ office-form-form-title office-form-theme-primary-background",this.props.IsSmallSize&&"small-size",this.props.IsSlimTitle&&"slim-size")},f={"aria-level":1,role:"heading"},l="Left",m=b.getImageMaster(i.FormMaster.Schema.Logo),n=b.getImageSettingsMaster(i.FormMaster.Schema.LogoInfo),o=m.Model;if(!o.ErrorType&&(o.ImageProcessingStatus!==k.Idle||i.hasImage(o))){var p=this.calcImageLayout(n);l=p.ImageLayout,a=e.createElement(h.ImageRenderer,{ImageWidth:p.Width,ImageHeight:p.Height,ImageInfoMaster:m,ImageSettingMaster:n,ImageType:"Logo"})}return e.createElement(g.TitleMediaRenderer,{HTMLAttributes:d,HTMLPropsForInnerElement:f,MediaLayout:l,SubTitle:this.props.IsSlimTitle||this.props.IsSmallSize?"":c.Description,Title:c.Title},a)},b.prototype.calcImageLayout=function(a){var b=a.Model;if(b.NaturalWidth){var c=a.calcLogoLayout({isMobile:this.props.IsMobile,isSlimSize:this.props.IsSlimTitle,isSmallSize:this.props.IsSmallSize});return{Height:c.ActualHeight,ImageLayout:c.Layout===l.Vertical?"Top":"Left",Width:c.ActualWidth}}return{Height:m.ImagePlaceHolderWidth,ImageLayout:"Left",Width:m.ImagePlaceHolderHeight}},b}(f.ReactComponent);b.TitleContainer=n,Forms.UX.Renderer.TitleContainer=n},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(1),g=OfficeForm.Exports.Models,h=OfficeForm.Exports.Utilities,i=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.subTitleRef=e.createRef(),b}return d(b,a),b.prototype.componentWillMount=function(){var a=this;this.update=function(){return a.forceUpdate()};var b=g.FormMaster.Schema;this.props.Form.observe(this.update,[b.Title,b.Description,b.LogoInfo])},b.prototype.componentDidMount=function(){$(this.subTitleRef.current).linkify()},b.prototype.componentWillUnmount=function(){this.props.Form.unobserve(this.update)},b.prototype.render=function(){var a,b=this.props.Form,c=b.Model,d=c.LogoInfo;if(c.Logo&&c.Logo.ResourceUrl&&d.TargetResourceId){var f=b.getImageMaster(g.FormMaster.Schema.Logo);a=e.createElement("div",{className:"logo-image-container old"},e.createElement(OfficeForm.Exports.ImageRenderer,{Image:f,ImageSettings:b.getImageSettingsMaster(g.FormMaster.Schema.LogoInfo),ImageType:"Logo"}),OfficeForm.Exports.createImageSpinner(f.Model))}var i;c.Description&&!this.props.IsSmallSize&&(i=e.createElement("div",{className:"office-form-subtitle heading-1",ref:this.subTitleRef},c.Description));var j=h.Html.combineAttributes("__title__ office-form-title-container office-form-form-title office-form-theme-primary-background",this.props.IsSmallSize?"small-size":void 0);return e.createElement("div",{className:j},e.createElement("div",{className:"office-form-logo-title"},a,e.createElement("div",{className:"office-form-title heading-1"},e.createElement("span",{role:"heading","aria-level":1},c.Title))),i)},b}(f.ReactComponent);b.TitleContainerV1=i,Forms.UX.Renderer.TitleContainerV1=i},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(93);b.createCurrentUserPhoto=d.createCurrentUserPhoto,c(132);var e=c(94);b.createUserPhotoByForm=e.createUserPhotoByForm,c(133);var f=c(95);b.createGroupMemberPhoto=f.createGroupMemberPhoto,c(134);var g=c(96);b.createGroupPhoto=g.createGroupPhoto,c(135);var h=c(22);b.PhotoMaster=h.PhotoMaster},function(a,b,c){"use strict";function d(){return l.getInstance()}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var f=c(4),g=c(62),h=c(138),i=f.Spec,j={groups:i.collectionOf(function(){return g.GroupMaster})},k=function(a){return new h.MyGroupsDataSource(a)},l=function(a){function b(){return a.call(this,{ExistingInDataSource:!0})||this}return e(b,a),b.getInstance=function(){return this.instance||(this.instance=new b),this.instance},Object.defineProperty(b.prototype,"Groups",{get:function(){return this.isFieldReady(this.Schema.groups)?f.convertToArray(this.Model.groups).map(function(a){return f.getObjectMasterFromModel(a)}):[]},enumerable:!0,configurable:!0}),b}(f.createObjectMasterClass("MyGroups",j,k));b.MyGroupsMaster=l,b.createGroupManager=d,Forms.Mru.MyGroupsMaster=l,Forms.Mru.createGroupManager=d},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e,f=c(3),g=c(4),h=c(13),i=c(191),j=c(192),k=g.Spec,l=OfficeForm.Exports.Models.FormMaster,m={Extension:k.enumeration(function(){return n},{IsLocalField:!0}),Knowledge:k.string({IsSourceGenerated:!0,SourceFieldName:"knowledge"}),MruDocuments:k.collectionOf(function(){return j.MruDocumentMaster},{SourceFieldName:"documents"}),PinnedState:k.enumeration(function(){return e},{IsLocalField:!0}),ResponseCode:k.string({IsSourceGenerated:!0,SourceFieldName:"responseCode"})};!function(a){a[a.Pinned=0]="Pinned",a[a.Unpinned=1]="Unpinned",a[a.Unspecified=2]="Unspecified"}(e=b.PinnedState||(b.PinnedState={}));var n;!function(a){a[a.Form=0]="Form",a[a.GroupForm=1]="GroupForm",a[a.Unspecified=2]="Unspecified"}(n=b.MruExtension||(b.MruExtension={}));var o=function(a){return new i.MruDataSource(a)},p=function(a){function b(){var b=a.call(this,{ExistingInDataSource:!0,InitialData:{Extension:n.GroupForm,Knowledge:"",PinnedState:e.Unspecified}})||this;return b.listChangeCallbacks=[],b}return d(b,a),b.getInstance=function(){return this.instance||(this.instance=new b),this.instance},Object.defineProperty(b.prototype,"Documents",{get:function(){return this.isFieldReady(this.Schema.MruDocuments)?g.convertToArray(this.Model.MruDocuments).sort(function(a,b){return Date.parse(b.Timestamp)-Date.parse(a.Timestamp)}).map(function(a){return g.getObjectMasterFromModel(a)}):[]},enumerable:!0,configurable:!0}),b.prototype.removeDocument=function(a){this.isFieldReady(this.Schema.MruDocuments)&&g.Collection.deleteItems(this.Model.MruDocuments,f.filter(this.Model.MruDocuments,function(b){return b.ServerDocId===a}))},b.prototype.initializeFormList=function(){var a=this,c=b.Schema;return this.ensureFieldsReady([c.Knowledge,c.MruDocuments]).then(function(){f.forEach(a.Model.MruDocuments,function(a){var b=h.getDesignFormMaster({Id:a.ServerDocId});b.fieldsReady([l.Schema.Title]).done(function(){b.observe(function(c){c.BeingDeleted||(a.Title=b.Model.Title)},[l.Schema.Title]),a.Title=b.Model.Title})})},function(a){return $.Deferred().resolve().promise()})},b.prototype.observeListChange=function(a){var b=this.findListChangeCallbackIndex(a);if(0>b){var c=function(b){(b.AddedModels.length||b.RemovedModels.length)&&a()};this.listChangeCallbacks.push({originCallback:a,registeredCallback:c}),this.getDocumentCollectionMaster().done(function(a){return a.observe(c)})}},b.prototype.unobserveListChange=function(a){var b=this.findListChangeCallbackIndex(a);if(b>=0){var c=this.listChangeCallbacks[b];this.listChangeCallbacks.splice(b,1),this.getDocumentCollectionMaster().done(function(a){return a.unobserve(c.registeredCallback)})}},b.prototype.getDocumentCollectionMaster=function(){var a=this;return this.fieldsReady([this.Schema.MruDocuments]).then(function(){return g.getCollectionMasterFromModel(a.Model.MruDocuments)})},b.prototype.findListChangeCallbackIndex=function(a){return f.findIndex(this.listChangeCallbacks,function(b){return b.originCallback===a})},b}(g.createObjectMasterClass("MruDocumentCollection",m,o));b.MruDocumentCollectionMaster=p,Forms.Mru.MruDocumentManager=p},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(2),h=c(53),i=OfficeForm.Exports.Control,j=OfficeForm.Exports.Resources,k="PortalPage.GroupFormsPortal.GroupFormCreate",l=function(a){function b(b){var c=a.call(this,b)||this;return c.mouseOverCallback=function(){c.setState({CreatingCardMouseOver:!0})},c.mouseOutCallback=function(){c.setState({CreatingCardMouseOver:!1})},c.state={CreatingCardMouseOver:!1},c}return d(b,a),b.prototype.createFormCreatingCardByMode=function(){var a,b=this.props.IsQuizMode,c=b?"../Images/icon-new-quiz-normal.png":"../Images/icon-new-form-normal.png",d=b?"../Images/icon-new-quiz-hover.png":"../Images/icon-new-form-hover.png",g=this.state.CreatingCardMouseOver?d:c,h=this.state.CreatingCardMouseOver?"fl-text-hover":"fl-text";a=this.props.IsGroupForm?b?j.LocalizedStrings.PortalView_NewGroupQuizTitle:j.LocalizedStrings.PortalView_NewGroupFormTitle:b?j.LocalizedStrings.PortalView_NewQuizTitle:j.LocalizedStrings.PortalView_NewFormTitle;var k={className:"fl-new-tile fl-form-tile fl-tile",onMouseOut:this.mouseOutCallback,onMouseOver:this.mouseOverCallback},l={className:"fl-content glyph-button-control-vertical",id:b?"fl-content-new-quiz":"fl-content-new-form",onClick:this.onClick.bind(this),title:a},m=i.createButton({ButtonStyle:"LightBackground",children:[f.createElement("img",{src:g,key:"newCardImg","aria-hidden":"true"}),f.createElement("div",{className:h,key:"newCardText"},a)],HTMLAttributes:l});return f.createElement("div",e({},k),m,this.props.Menu)},b.prototype.onClick=function(){var a=this.props.IsQuizMode;this.props.IsGroupForm&&g.log({eventName:k,eventType:"engagement_event",extraData:{isQuizMode:a}}),this.props.onClick()},b.prototype.getCardDescription=function(){return null},b.prototype.getCardThemeName=function(){return null},b.prototype.getCardThemeBackgroupUrl=function(){return null},b.prototype.getCardThemePrimaryColor=function(){return null},b.prototype.getCardTitle=function(){return""},b.prototype.createCardOwnerContent=function(){return null},b.prototype.createCardTypeContent=function(){return null},b.prototype.getCardResponseCount=function(){return 0},b}(h.PortalViewCardBase);b.PortalViewCreateNewCard=l,Forms.UX.PortalViewCreateNewCard=l},function(a,b,c){"use strict";function d(a){function b(){a.createCallback("Form")}function c(){a.createCallback("Quiz");
}function d(){}return e.createElement("div",{className:"portal-creating-card"},e.createElement(f.PortalViewCreateNewCard,{CreateNew:!0,focusOut:d,IsGroupForm:!1,IsQuizMode:!1,onClick:b}),e.createElement("div",{className:"creating-card-middle-line"}),e.createElement(f.PortalViewCreateNewCard,{CreateNew:!0,focusOut:d,IsGroupForm:!1,IsQuizMode:!0,onClick:c}))}Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(87);b.createNewButton=d,Forms.UX.createNewButton=d},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(113),g=c(1),h=function(a){function b(b){var c=a.call(this,b)||this;return Forms.DesignPage.getTemplates().done(function(a){c.state={Templates:a}}),c}return d(b,a),b.prototype.render=function(){return this.state.Templates?e.createElement("div",{style:{display:"inline"}},this.createTemplateCard()):null},b.prototype.createTemplateCard=function(){var a=this;return this.state.Templates.map(function(b){return e.createElement(f.MyTemplateCard,{key:b.Title,Template:b,viewTemplate:a.props.viewTemplateHandler})})},b}(g.ReactComponent);b.TemplateList=h,Forms.UX.TemplateList=h},function(a,b,c){"use strict";function d(a,b,c){l.log({eventName:n.Error.ErrorMessageBar.Show,eventType:"engagement_event",extraData:{ErrorCode:b,Key:c,Scenario:a}}),j=a,k=c,m.getUxStateMaster().Model.ErrorBarMessage=i(b)}function e(a,b){a===j&&b===k&&(l.log({eventName:n.Error.ErrorMessageBar.Hide,eventType:"engagement_event",extraData:{Key:b,Scenario:a}}),j=void 0,k=void 0,m.getUxStateMaster().Model.ErrorBarMessage=null)}function f(a){a&&a.Synchronizer.Model.CreationFailed&&!m.getUxStateMaster().Model.CriticalError&&m.getUxStateMaster().Model.ErrorBarMessage&&e("SaveForm",a.getInstanceId())}function g(a){m.getUxStateMaster().Model.InfoBarMessageType=a}function h(){m.getUxStateMaster().Model.InfoBarMessageType=void 0}function i(a){var b=o.LocalizedStrings,c=a&&b["Error_Message_"+a];return c?c:j?b["Error_Bar_Message_"+j]:null}Object.defineProperty(b,"__esModule",{value:!0});var j,k,l=c(2),m=c(61),n=OfficeForm.Exports.EngagementEventNames,o=OfficeForm.Exports.Resources;b.showErrorMessageBar=d,b.hideErrorMessageBar=e,b.hideFormErrorMessageBar=f,b.showInfoMessageBar=g,b.hideInfoMessageBar=h},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(4),f=c(126),g=e.Spec,h={choiceId:g.string({IsKeyField:!0}),description:g.string()},i=function(a){return new f.ChoiceLocalizedItemDataSource(a)},j=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),Object.defineProperty(b.prototype,"QuestionLocalizedMaster",{get:function(){return this.Parent.Parent},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"Form",{get:function(){return this.QuestionLocalizedMaster.Form},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"FormId",{get:function(){return this.Form.Model.Id},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"QuestionId",{get:function(){return this.QuestionLocalizedMaster.Model.questionId},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"LocaleId",{get:function(){return this.QuestionLocalizedMaster.Model.localeId},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"ChoiceId",{get:function(){return this.Model.choiceId},enumerable:!0,configurable:!0}),b}(e.createObjectMasterClass("ChoiceLocalizedItemMaster",h,i));b.ChoiceLocalizedItemMaster=j,Forms.Models.ChoiceLocalizedItemMaster=j},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(3),f=c(4),g=c(57),h=c(91),i=c(129),j=OfficeForm.Exports.Models,k=f.Spec,l={choices:k.collectionOf(function(){return h.ChoiceLocalizedItemMaster}),choicesV1:k.collectionOf({choiceId:k.string({IsLocalField:!0}),description:k.string({SourceFieldName:"Description"})},{IsLocalField:!0}),leftDescription:k.string(),localeId:k.string({IsKeyField:!0}),localeName:k.string(),option:k.string(),questionId:k.string({IsKeyField:!0}),rightDescription:k.string(),subtitle:k.string(),title:k.string()},m=function(a){return new i.QuestionLocalizedItemDataSource(a)},n=function(a){function b(b){var c=this,d=$.Deferred();return c=a.call(this,b,{MasterReady:d.promise(),Scheduler:new j.Scheduler})||this,c.initializeOptionBinder(b),d.resolve(),c}return d(b,a),b.handleChoicesV1Deleted=function(a,b,c){0>a||e.forEach(c.Model.LocalizedResources,function(c){var d=e.filter(c.questionResources,function(a){return a.questionId===b});d.forEach(function(b){b.choicesV1.length>a&&f.Collection.itemsDeletedInSource(b.choicesV1,[b.choicesV1[a]])})})},Object.defineProperty(b.prototype,"Form",{get:function(){return this.FormLocalizedMaster.Form},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"FormId",{get:function(){return this.Form.Model.Id},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"FormLocalizedMaster",{get:function(){return this.Parent.Parent},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"QuestionId",{get:function(){return this.Model.questionId},enumerable:!0,configurable:!0}),b.prototype.getChoiceLocalizedMaster=function(a){var b=this,c=e.find(this.Form.Model.Questions,function(a){return a.Id===b.QuestionId});if(c&&e.find(c.ChoiceGroup,function(b){return b.Id.toString()===a})){var d=f.Collection.getItemWithKeyFields(this.Model.choices,{choiceId:a});return d?f.getObjectMasterFromModel(d):g.createEmptyChoiceLocalizedResource(a,this.Model)}throw Error("Question or Chocie don't exist for localization.")},b.prototype.getChoiceV1LocalizedMaster=function(a){var b=this,c=e.find(this.Form.Model.Questions,function(a){return a.Id===b.QuestionId});if(c&&c.Choices.length>a){for(;this.Model.choicesV1.length<c.Choices.length;)g.createEmptyChoiceV1LocalizedResource(this.Model);return f.getObjectMasterFromModel(this.Model.choicesV1[a])}throw Error("Question or Choice V1 don't exist for localization.")},b.prototype.initializeOptionBinder=function(a){b.Schema.option&&(this.optionBinder=new j.FieldBinder(this,b.Schema.option,b.ChoicesV1FieldSet),a.InitialData&&this.isFieldReady(b.Schema.option)&&(a.ExistingInDataSource||a.InitialData.option?this.optionBinder.deserialize():this.optionBinder.serialize()))},Object.defineProperty(b,"ChoicesV1FieldSet",{get:function(){return b.choicesV1FieldSet||(b.choicesV1FieldSet=new j.FieldSet([b.Schema.choicesV1])),b.choicesV1FieldSet},enumerable:!0,configurable:!0}),b}(f.createObjectMasterClass("QuestionLocalizedItemMaster",l,m));b.QuestionLocalizedItemMaster=n,Forms.Models.QuestionLocalizedItemMaster=n},function(a,b,c){"use strict";function d(){return $.Deferred().resolve(g.getInstance()).promise()}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var f=c(22),g=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return e(b,a),b.getInstance=function(){return b.instance||(b.instance=new b),b.instance},b}(f.PhotoMaster);b.CurrentUserPhotoMaster=g,b.createCurrentUserPhoto=d},function(a,b,c){"use strict";function d(a){return a.ensureFieldsReady([g.Schema.Id,g.Schema.OwnerId]).then(function(){var b=a.Model.OwnerId,c=i[b];return c||(c=i[b]=new h(a.Model.Id)),c})}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var f=c(22),g=OfficeForm.Exports.Models.FormMaster;b.createUserPhotoByForm=d;var h=function(a){function b(b){var c=a.call(this)||this;return c.typicalFormId=b,c}return e(b,a),Object.defineProperty(b.prototype,"TypicalFormId",{get:function(){return this.typicalFormId},enumerable:!0,configurable:!0}),b}(f.PhotoMaster);b.FormOwnerPhotoMaster=h;var i={}},function(a,b,c){"use strict";function d(a,b){var c=a+"_"+b,d=h[c];return d||(d=h[c]=new g(a,b)),d}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var f=c(22);b.createGroupMemberPhoto=d;var g=function(a){function b(b,c){var d=a.call(this)||this;return d.groupId=b,d.userId=c,d}return e(b,a),Object.defineProperty(b.prototype,"GroupId",{get:function(){return this.groupId},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"MemberId",{get:function(){return this.userId},enumerable:!0,configurable:!0}),b}(f.PhotoMaster);b.GroupMemberPhotoMaster=g;var h={}},function(a,b,c){"use strict";function d(a){var b=h[a];return b||(b=h[a]=new g(a)),b}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var f=c(22);b.createGroupPhoto=d;var g=function(a){function b(b){var c=a.call(this)||this;return c.groupId=b,c}return e(b,a),Object.defineProperty(b.prototype,"GroupId",{get:function(){return this.groupId},enumerable:!0,configurable:!0}),b}(f.PhotoMaster);b.GroupPhotoMaster=g;var h={}},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(3),f=c(4),g=c(13),h=c(136),i=OfficeForm.Exports.Models.FormDeletedState,j=f.Spec,k={category:j.string(),id:j.string({IsKeyField:!0,IsSourceGenerated:!0}),instanceId:j.string({IsLocalField:!0}),modifiedDate:j.string(),movingToRecycleBin:j["boolean"]({IsLocalField:!0}),ownerId:j.string(),ownerTenantId:j.string(),softDeleted:j.enumeration(function(){return i},{IsNumberTypeInDataSource:!0}),title:j.string()},l=OfficeForm.Exports.Models.FormMaster,m=function(a){function b(c){var d=a.call(this,b.normalizeContext(c))||this;return d.formMaster=g.getFormMasterByInstanceId(d.Model.instanceId),d.formMaster.fieldsReady([l.Schema.Id]).done(function(){d.Synchronizer.onSourceDataReceived({id:d.formMaster.Model.Id})}),d.formMaster.observe(function(a){if(!a.BeingDeleted){var b=a.NewValues;d.bulkEdit(function(){d.Synchronizer.onSourceDataReceived({modifiedDate:b.ModifiedDate,softDeleted:b.SoftDeleted,title:b.Title}),d.Model.movingToRecycleBin=b.MovingToRecycleBin})}},[l.Schema.MovingToRecycleBin,l.Schema.ModifiedDate,l.Schema.SoftDeleted,l.Schema.Title]),d}return d(b,a),Object.defineProperty(b.prototype,"FormMaster",{get:function(){return this.formMaster},enumerable:!0,configurable:!0}),b.normalizeContext=function(a){if(a.InitialData&&!a.InitialData.instanceId&&(a=e.clone(a),a.InitialData=e.clone(a.InitialData),a.InitialData)){var b=OfficeForm.Exports.Models.createGroupDesignFormMaster({Id:a.InitialData.id});b.Synchronizer.onSourceDataReceived(a.InitialData),a.InitialData.instanceId=b.getInstanceId()}return a},b}(f.createObjectMasterClass("FormReferenceMaster",k,function(){return new h.FormReferenceDataSource}));b.FormReferenceMaster=m},function(a,b,c){"use strict";function d(){if(!h){var a=k.getSampleForm();g=$.Deferred(),h=i.createNewFormMaster(a,"User",g),h.Synchronizer.onSourceDataReceived({rowCount:0}),h.Model.OtherInfo='{"PrimaryCustomizedThemeColor":"#A83A94","SecondaryCustomizedThemeColor":"#8F327E","TertiaryCustomizedThemeColor":"#F2E6F0","Theme":{"Name":"Customized Theme"}}',h.observe(f)}return h}function e(a){l.Flight.isEnabled(l.Flights.MSASampleForm)&&a===h&&"pending"===g.state()&&(g.resolve(),h.unobserve(f),OfficeForm.Exports.DesignPage.dataProviderAdapterConcatToFormList(h),h.fieldsReady([m.Schema.Id]).done(function(){j.log({eventName:"PortalView.SampleForm.Edit",eventType:"engagement_event",extraData:{FormId:h?h.Model.Id:""}}),h=void 0}))}function f(a){e(a.Master)}Object.defineProperty(b,"__esModule",{value:!0});var g,h,i=c(13),j=c(2),k=c(143),l=OfficeForm.Exports.Flighting,m=OfficeForm.Exports.Models.FormMaster;b.getSampleFormMaster=d,b.syncSampleFormMaster=e,Forms.DesignPage.syncSampleFormMaster=e,Forms.DesignPage.getSampleFormMaster=d},function(a,b,c){"use strict";function d(){return f||(f=Forms.Templates.FormTemplates.loadMSATemplates()),f}function e(a){var b=g.clone(a);b.OwnerId=OfficeFormServerInfo.userInfo.UserId,b.OwnerTenantId=OfficeFormServerInfo.userInfo.TenantId,b.Background.ResourceUrl=k.Html.getAbsoluteUrl(b.Background.ResourceUrl);var c=b.OtherInfo,d=h.createNewFormMaster(b,"User");return d.Model.Background.IsPredefined=!0,d.Model.OtherInfo=c,d.fieldsReady([j.Schema.Id]).done(function(){i.log({eventName:"PortalView.Templates.Edit",eventType:"engagement_event",extraData:{FormId:d?d.Model.Id:""}})}),d}Object.defineProperty(b,"__esModule",{value:!0});var f,g=c(3),h=c(13),i=c(2),j=OfficeForm.Exports.Models.FormMaster,k=OfficeForm.Exports.Utilities;b.getTemplates=d,b.getTemplateMaster=e,Forms.DesignPage.getTemplates=d,Forms.DesignPage.getTemplateMaster=e},function(a,b,c){"use strict";function d(a){var c=++x;return p(v.TextAnalyzerFeatures.SuggestionForm,a).then(function(a){var d={MatchQuery:c===x,Templates:[]};if(a&&a.Results&&a.Results.length&&a.Results[0].Result){var e=a.Results[0].Result;if(r.isArray(e))d.Templates=e.map(k).filter(function(a){return!!a});else{var f=k(e);f&&d.Templates.push(f)}d.Templates=b.FormIntelligenceLauncher.getFilteredTemplates(d.Templates)}return d})}function e(a){var b,c=a.QuestionType;switch(c){case t.QuestionType.Choice:b=t.Question.Choice.createDefaultDefinition(),b.Choices=a.ChoiceCandidates.map(function(a){return{Description:a,IsGenerated:!0}});break;case t.QuestionType.DateTime:b=t.Question.DateTime.createDefaultDefinition();break;case t.QuestionType.TextField:b=t.Question.TextField.createDefaultDefinition(),b.Multiline=a.QuestionSettings?a.QuestionSettings.Multiline:!1;break;case t.QuestionType.Rating:b=t.Question.Rating.createDefaultDefinition();break;default:return null}return b.Title=a.QuestionTitle,u.Flight.isEnabled(u.Flights.QuestionTagForIntelligence)&&(b.QuestionTagForIntelligence=a.QuestionTagForIntelligence,b.IsFromSuggestion=a.IsFromSuggestion),b}function f(a){var c=++y;return p(v.TextAnalyzerFeatures.SuggestionQuestion,JSON.stringify(a)).then(function(a){var d,f=a;if(f&&f.Results&&f.Results.length&&f.Results[0].Result&&f.Results[0].Result.Questions){var g=f.Results[0].Result,h=[];g.Questions.map(function(a){var b=e(a);b&&h.push(b)}),d=u.Flight.isEnabled(u.Flights.QuestionTagForIntelligence)&&g.QuestionTagForIntelligence&&g.QuestionTagForIntelligence.length>0?{IsFromSuggestion:g.IsFromSuggestion,MatchQuery:c===y,QuestionTagForIntelligence:g.QuestionTagForIntelligence,Templates:[]}:{MatchQuery:c===y,Templates:[]},d.Templates.push({Questions:h,TemplateId:g.Id}),d.Templates=b.FormIntelligenceLauncher.getFilteredTemplates(d.Templates)}return d}).fail(function(a){return a})}function g(a){var c=++y;return p(v.TextAnalyzerFeatures.SuggestionQuestion,JSON.stringify(a)).then(function(a){var d={MatchQuery:c===y,Templates:[]},f=a;if(f&&f.Results&&f.Results.length&&f.Results[0].Result&&f.Results[0].Result.Questions){var g=[];f.Results[0].Result.Questions.map(function(a){var b=e(a);b&&g.push(b)}),d.Templates.push({Questions:g,TemplateId:f.Results[0].Result.Id}),d.Templates=b.FormIntelligenceLauncher.getFilteredTemplates(d.Templates)}return d}).fail(function(a){return a})}function h(a){var c=y;return v.ProviderManager.getInstance().CurrentMathProvider.mathQuestionGeneration({Context:JSON.stringify(a),Features:v.MathAnalyzerFeatures.SimilarMathQuestionSuggestions,FormId:a.FormId,IncorrectAnswerCount:3,QuestionCount:3,QuestionId:a.QuestionId}).then(function(a){var d={MatchQuery:c===y,Templates:[]},e=a;if(e&&e.Results&&e.Results.length&&e.Results[0].Result&&e.Results[0].Result.Questions){var f=[];e.Results[0].Result.Questions.map(function(a){var b=j(a);null!==b&&f.push(b)}),d.Templates.push({Questions:f,TemplateId:e.Results[0].Result.Id}),d.Templates=b.FormIntelligenceLauncher.getFilteredTemplates(d.Templates)}return d}).fail(function(a){return a})}function i(a){var b=++w;return v.ProviderManager.getInstance().createIntelligenceProvider().getOptionToOptionSuggestion(a).then(function(a){var c={MatchQuery:b===w,Result:{ChoiceCandidates:[],MatchingPart:null,QuestionType:null}};return c.MatchQuery&&a&&a.ChoiceCandidates&&a.ChoiceCandidates.length>0?c.Result=a:c.MatchQuery&&a&&(c.Result.MatchingPart=a.MatchingPart),c})}function j(a){var b,c=a.QuestionType;switch(c){case t.QuestionType.Choice:b=t.Question.Choice.createDefaultDefinition();var d=void 0;d=a.IncorrectAnswers.map(function(a){return{Description:a,IsGenerated:!0,IsMathOption:!0}}),d=d.concat({Description:a.CorrectAnswer,IsAnswerKey:!0,IsGenerated:!0,IsMathOption:!0}),b.Choices=r.shuffle(d);break;case t.QuestionType.DateTime:b=t.Question.DateTime.createDefaultDefinition();break;case t.QuestionType.TextField:b=t.Question.TextField.createDefaultDefinition();break;case t.QuestionType.Rating:b=t.Question.Rating.createDefaultDefinition();break;default:return null}return b.Title=a.QuestionTitle,b.Subtitle=a.Formula,b.IsMathQuiz=!0,b}function k(a){var b={Questions:[]},c=s.getAutoSuggestTemplateForm()[a.TemplateId];if(Forms.Templates.FormTemplates.loadFormTemplates().done(function(b){return c=b[a.TemplateId]}).fail(function(a){c=null}),!c)return null;var d=t.createLocalFormMaster(c);return b.TemplateId=a.TemplateId,b.Questions=d.FormElementManager.QuestionMasters.map(function(a){var b=r.clone(a.getSnapshot());return delete b.Order,b}),b}function l(a){return a.filter(function(a){return!!a}).filter(function(a){return a.Questions&&a.Questions.filter(function(a){return a.Type!==t.QuestionType.MatrixChoice}).length>0})}function m(a){return u.Flight.isEnabled(u.Flights.MoveIntelligence)?v.ProviderManager.getInstance().createIntelligenceProvider().textAnalyze(a):v.ProviderManager.getInstance().CurrentMathProvider.textAnalyze(a)}function n(a,b){var c=a;return c&&c.Results&&c.Results.length&&c.Results[0].Result&&c.Results[0].Result.ChoiceCandidates?{MatchQuery:b===w,Suggestion:c.Results[0].Result}:null}function o(a){var b=++w;return m(a).then(function(a){return n(a,b)})}function p(a,b){return u.Flight.isEnabled(u.Flights.MoveIntelligence)?v.ProviderManager.getInstance().createIntelligenceProvider().textAnalyzeWithFeatures(a,b):v.ProviderManager.getInstance().CurrentMathProvider.textAnalyzeWithFeatures(a,b)}function q(a){var b=++w;return p(v.TextAnalyzerFeatures.LikertQuestionTypeSuggest,a).then(function(a){return n(a,b)})}Object.defineProperty(b,"__esModule",{value:!0});var r=c(3),s=c(101),t=OfficeForm.Exports.Models,u=OfficeForm.Exports.Flighting,v=OfficeForm.Exports.DataProvider,w=0,x=0,y=0;b.FormIntelligenceLauncher={createMathQuestionByType:j,createQuestionByType:e,getChoiceOptionSuggestion:o,getFilteredTemplates:l,getFormTemplateSuggestion:d,getLikertQuestionSuggest:q,getMathQuestionsSuggestion:h,getOptionToOptionSuggestion:i,getQuestionsIntelligenceResult:f,getQuestionsSuggestion:g,getTemplate:k},Forms.UX.FormDesignView.FormIntelligenceLauncher=b.FormIntelligenceLauncher},function(a,b,c){"use strict";function d(){return{EventSurvey:{Description:"",HasQuestionMedia:!0,HasValidBranching:!1,Questions:[{AllowOtherAnswer:!1,Choices:[],ChoiceType:1,DefaultValue:null,Deleted:!1,HasValidBranching:!1,Id:"R_Template_SurveyEvent_Q1",ImageInfo:null,ImageSettings:null,IsQuiz:!1,Length:10,Order:700,RatingShape:1,Required:!1,Subtitle:null,Title:f.LocalizedStrings.Template_SurveyEvent_Q1,TrackingId:"6B6D096A-BD43-4E99-8021-8CD58E61AE14",Type:e.QuestionType.Rating},{AllowOtherAnswer:!1,Choices:[{Description:"All of the information"},{Description:"Most of the information"},{Description:"Some of the information"},{Description:"A little of the information"},{Description:"None of the information"}],ChoiceType:1,DefaultValue:null,Deleted:!1,HasValidBranching:!1,Id:"R_Template_SurveyEvent_Q2",ImageInfo:null,ImageSettings:null,IsQuiz:!1,Order:950,Required:!1,Subtitle:null,Title:f.LocalizedStrings.Template_SurveyEvent_Q2,TrackingId:"2A0F07CF-1B23-4EDA-865F-245ABD28258A",Type:e.QuestionType.Choice},{AllowOtherAnswer:!1,Choices:[{Description:"Extremely organized"},{Description:"Very organized"},{Description:"Somewhat organized"},{Description:"Not so organized"},{Description:"Not at all organized"}],ChoiceType:1,DefaultValue:null,Deleted:!1,HasValidBranching:!1,Id:"R_Template_SurveyEvent_Q3",ImageInfo:null,ImageSettings:null,IsQuiz:!1,Order:1e3,Required:!1,Subtitle:null,Title:f.LocalizedStrings.Template_SurveyEvent_Q3,TrackingId:"8CE4581B-3714-480E-8CF6-162A31D8BC68",Type:e.QuestionType.Choice},{AllowOtherAnswer:!1,Choices:[{Description:"Extremely helpful"},{Description:"Very helpful"},{Description:"Somewhat helpful"},{Description:"Not so helpful"},{Description:"Not at all helpful"}],ChoiceType:1,DefaultValue:null,Deleted:!1,HasValidBranching:!1,Id:"r2925216ae4634749b2c37c56c6c65dfd",ImageInfo:null,ImageSettings:null,IsQuiz:!1,Order:1200,Required:!1,Subtitle:null,Title:f.LocalizedStrings.Template_SurveyEvent_Q4,TrackingId:"8E314FC2-AAF2-46D3-A6CF-872DB1BABC8D",Type:e.QuestionType.Choice},{AllowOtherAnswer:!1,Choices:[{Description:"Much too long"},{Description:"Somewhat too long"},{Description:"About right"},{Description:"Somewhat too short"},{Description:"Much too short"}],ChoiceType:1,DefaultValue:null,Deleted:!1,HasValidBranching:!1,Id:"r3b42fabcefc740eeb06b903048edace2",ImageInfo:null,ImageSettings:null,IsQuiz:!1,Order:1275,Required:!1,Subtitle:null,Title:f.LocalizedStrings.Template_SurveyEvent_Q5,TrackingId:"AA0E597F-03AE-4277-99DB-6277299B4D85",Type:e.QuestionType.Choice},{AllowOtherAnswer:!1,Choices:[],ChoiceType:1,DefaultValue:null,Deleted:!1,HasValidBranching:!1,Id:"rcb2ff66886714cd0be9f7a895ad87871",ImageInfo:null,ImageSettings:null,IsQuiz:!1,Order:1350,Required:!1,Subtitle:null,Title:f.LocalizedStrings.Template_SurveyEvent_Q6,TrackingId:"EABD6914-A579-4C67-A0F2-5B3DA1C2D51D",Type:e.QuestionType.TextField}],Title:"Template_SurveyEvent_Title",TrackingId:"18BF6D5B-4656-42EE-BFA3-C2DE7FA53CE0"}}}Object.defineProperty(b,"__esModule",{value:!0});var e=OfficeForm.Exports.Models,f=OfficeForm.Exports.Resources;b.getAutoSuggestTemplateForm=d,Forms.Templates.getAutoSuggestTemplateForm=d},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(3),g=c(2),h=c(32),i=c(24),j=OfficeForm.Exports.Control,k=OfficeForm.Exports.Utilities,l=OfficeForm.Exports.Resources,m=OfficeForm.Exports.FormLimitation,n=OfficeForm.Exports.EnvironmentConfig,o=OfficeForm.Exports.EngagementEventNames,p=OfficeForm.Exports.Models,q=p.ShortTextAutograder,r=function(a){function b(b,c){var d=a.call(this,b)||this;return d.location=c,d.mathCalculation=d.mathCalculation.bind(d),d.onSubTitleChange=d.onSubTitleChange.bind(d),d.onExecuteForMathItem=d.onExecuteForMathItem.bind(d),d.toggleMathSubtitle=d.toggleMathSubtitle.bind(d),d}return d(b,a),b.prototype.createMathBar=function(){var a=this.props.Master,b=a.Model;if(b.IsPlainTextInMathField){var c={AutoFocus:i.subtitleElementIndex===this.state.SelectedElementIndex,AutoSelection:!0,HTMLAttributes:k.Html.mergeReactProps(this.getElementFocusingProps(i.subtitleElementIndex),{className:"design-question-math-plaintext-text"}),MaxLength:m.QuestionSubtitleLength,MinimalHeight:m.DefaultTextFieldHeight,onValueChange:this.onSubTitleChange,Options:{HTMLPropsForInnerElement:{className:"design-question-math-plaintext-text"}},Placeholder:l.LocalizedStrings.Designer_PlaceholderForQuestionSubtitle,Value:b.Subtitle||""};return e.createElement("div",{className:"design-question-math-plaintext",ref:this.getElementRef(i.subtitleElementIndex)},j.createTextField(c),this.createMathTextSwitcher())}var d=k.Html.mergeReactProps(this.getElementFocusingProps(i.subtitleElementIndex),{className:this.state.SelectedElementIndex===i.subtitleElementIndex?"active":""});return e.createElement("div",{className:"design-question-math-container",ref:this.getElementRef(i.subtitleElementIndex)},e.createElement(h.FormulaDesigner,{blockEndDesignMode:this.props.blockEndDesignMode,Disabled:!1,HasFocus:i.subtitleElementIndex===this.state.SelectedElementIndex,HTMLAttributes:d,Location:this.location,onRenderComplete:this.mathCalculation,onValueChange:this.onSubTitleChange,Placeholder:l.LocalizedStrings.Designer_PlaceholderForQuestionFormula,QuestionId:b.Id,Value:b.Subtitle||""},this.createMathTextSwitcher()))},b.prototype.createMathItem=function(){var a,b=this.props.Master.Model;return b.IsQuiz&&!n.isSovereignProd()&&(a={Checked:b.IsMathQuiz,Description:l.LocalizedStrings.Designer_MenuItemForMathLabel,Key:"mathItem",MenuItemType:j.MenuItemType.CheckBox,onExecute:this.onExecuteForMathItem}),a},b.prototype.mathCalculation=function(a,b){},b.prototype.onSubTitleChange=function(a){this.props.Master.Model.Subtitle=a},b.prototype.createMathTextSwitcher=function(){var a=this.props.Master.Model,b="design-question-choice-to-math-button";this.props.IsMobile&&(b=k.Html.combineAttributes(b,"isMobile")),i.subtitleElementIndex===this.state.SelectedElementIndex&&(b=k.Html.combineAttributes(b,"active-choice"));var c,d;return a.IsPlainTextInMathField?(c={"aria-label":l.LocalizedStrings.Designer_Question_Equation_Button,className:b,onClick:this.toggleMathSubtitle,title:l.LocalizedStrings.Designer_Question_Equation_Button_Tooltip},d="NumberField"):(c={"aria-label":l.LocalizedStrings.Designer_Question_EquationToText_Button,className:b,onClick:this.toggleMathSubtitle,title:l.LocalizedStrings.Designer_Question_EquationToText_Button_Tooltip},d="TextField"),j.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:k.Html.mergeReactProps(this.getElementFocusingProps(i.subtitleElementIndex),c),Icon:d,IconClassName:"design-question-choice-to-math-button-icon"})},b.prototype.toggleMathSubtitle=function(a){var b=this.props.Master.Model;b.IsPlainTextInMathField=!b.IsPlainTextInMathField,g.log({eventName:b.IsPlainTextInMathField?o.DesignPage.Quiz.SwitchMathToTextInput:o.DesignPage.Quiz.SwitchTextToMathInput,eventType:"engagement_event",extraData:{location:this.location}}),this.forceUpdate()},b.prototype.onExecuteForMathItem=function(){var a=this.props.Master,b=a.Model;g.log({eventName:o.DesignPage.QuestionMenu.MathOption,eventType:"engagement_event",extraData:{questionType:b.Type,value:!!b.IsMathQuiz}}),a.bulkEdit(function(){b.IsMathQuiz=!b.IsMathQuiz;var a=new q(b),c=a.getAnswers();b.IsMathQuiz?(b.ShowSubtitle=!0,b.OptionDisplayStyle=p.OptionDisplayStyle.ListAll,f.forEach(b.Choices,function(a){a.IsGenerated&&(a.Description=""),a.IsMathOption=!0}),b.IsAnswerPlainText=!1):(f.forEach(b.Choices,function(a){a.IsMathOption=!1}),b.IsAnswerPlainText=!0,b.Type===p.QuestionType.TextField&&(f.each(c,function(a){a.isMath=!1}),b.GradingBasis=JSON.stringify(c)))})},b}(i.QuestionDesignerBase);b.FormulaSupportedQuestionDesigner=r},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(2),g=c(1),h=c(104),i=OfficeForm.Exports.Models,j=OfficeForm.Exports.Resources,k="DesignPage.Questions.DeleteLikertOption",l=function(a){function b(b){var c=a.call(this,b)||this;return c.deleteOption=c.deleteOption.bind(c),c.onValueChange=c.onValueChange.bind(c),c}return d(b,a),b.prototype.componentDidMount=function(){var a=this;this.choiceUpdate=function(){return a.forceUpdate()},this.props.Master.observe(this.choiceUpdate,[i.ChoiceV2Master.Schema.Description])},b.prototype.componentWillUnmount=function(){this.props.Master.unobserve(this.choiceUpdate)},b.prototype.render=function(){var a=this.props.Master.Model,b=this.props.saveRef(this.props.Master.getInstanceId());return e.createElement("td",{className:"design-question-matrix-column-td",style:{width:"calc((100% - 220px)/"+this.props.Count+")"}},e.createElement(h.LikertEditor,{onKeyDown:this.props.IsLast?this.props.addOption:void 0,Deletable:this.props.Count>1,"delete":this.deleteOption,HTMLAttributes:{"aria-label":j.LocalizedStrings.Designer_Choices_Placeholder},FocusOut:!this.props.IsLast,onValueChange:this.onValueChange,ref:b,Value:a.Description}))},b.prototype.deleteOption=function(){var a=this.props.Master;a.Deleted=!0,f.log({eventName:k,eventType:"engagement_event",extraData:{questionId:a.Question.Model.Id}})},b.prototype.onValueChange=function(a){this.props.Master.Model.Description=a},b}(g.ReactComponent);b.LikertChoiceDesigner=l,Forms.UX.Designer.LikertChoiceDesigner=l},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(7),g=c(1),h=c(33),i=OfficeForm.Exports.Control,j=OfficeForm.Exports.Resources,k=OfficeForm.Exports.Utilities,l=OfficeForm.Exports.FormLimitation,m=function(a){function b(b){var c=a.call(this,b)||this;return c.rootRef=e.createRef(),c.state={IsFocused:!1},c.onFocus=c.onFocus.bind(c),c.onBlur=c.onBlur.bind(c),c.onDelete=c.onDelete.bind(c),c.onKeyDown=c.onKeyDown.bind(c),c}return d(b,a),b.prototype.render=function(){var a=i.createTextField({AutoSelection:!0,HTMLAttributes:{className:this.state.IsFocused?"design-question-matrix-editor office-form-theme-border":"design-question-matrix-editor",onFocus:this.onFocus,onKeyDown:this.onKeyDown},MinimalHeight:l.DefaultTextFieldHeight,onValueChange:this.props.onValueChange,
Options:{HTMLPropsForInnerElement:this.props.HTMLAttributes},TextFieldType:i.TextFieldType.AutoHeightMultiline,Value:this.props.Value});return e.createElement("div",{className:"design-question-matrix-cell-box",onBlur:this.onBlur,ref:this.rootRef},a,this.props.Deletable?this.createRemoveIcon():void 0)},b.prototype.focus=function(){var a=this.rootRef.current;if(a&&!a.contains(document.activeElement)){var b=a.querySelector(".office-form-textfield-input");b.focus()}},b.prototype.onFocus=function(){this.setState({IsFocused:!0})},b.prototype.onBlur=function(a){var b=k.Html.getTargetElementOfFocusEvent(a),c=a.currentTarget;c.contains(b)||this.setState({IsFocused:!1})},b.prototype.onDelete=function(){var a=this.rootRef.current;a&&h.focusOut(a),this.props["delete"]()},b.prototype.onKeyDown=function(a){if(a.keyCode===f.KeyCode.Enter)if(a.preventDefault(),this.props.FocusOut){var b=this.rootRef.current;b&&h.focusOut(b)}else this.props.onKeyDown&&this.props.onKeyDown()},b.prototype.createRemoveIcon=function(){var a=i.createGlyphButton({GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{className:"design-question-matrix-remove-icon",onClick:this.onDelete},Icon:"Delete",IconClassName:"option-remove-button-img forms-icon-size16x16",Text:j.LocalizedStrings.Delete_Button_Narrator}),b=k.Html.combineAttributes("design-question-matrix-remove-container",this.state.IsFocused?"office-form-theme-primary-background active-choice":"");return e.createElement("div",{className:b,tabIndex:-1},a)},b}(g.ReactComponent);b.LikertEditor=m},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(2),g=c(1),h=c(104),i=OfficeForm.Exports.Models,j=OfficeForm.Exports.Resources,k="DesignPage.Questions.DeleteLikertSubquestion",l=function(a){function b(b){var c=a.call(this,b)||this;return c.deleteQuestion=c.deleteQuestion.bind(c),c.onValueChange=c.onValueChange.bind(c),c}return d(b,a),b.prototype.componentDidMount=function(){var a=this;this.questionUpdate=function(){return a.forceUpdate()},this.props.Master.observe(this.questionUpdate,[i.QuestionMaster.Schema.Title])},b.prototype.componentWillUnmount=function(){this.props.Master.unobserve(this.questionUpdate)},b.prototype.render=function(){var a=this.props.Master.Model;return e.createElement("tr",{className:"design-question-matrix-str"},e.createElement("td",{className:"design-question-matrix-row-td",key:"subQuestion"},e.createElement(h.LikertEditor,{onKeyDown:this.props.IsLast?this.props.addQuestion:void 0,Deletable:this.props.Count>1,"delete":this.deleteQuestion,HTMLAttributes:{"aria-label":j.LocalizedStrings.Designer_LabelForLikertRowTitle},FocusOut:!this.props.IsLast,onValueChange:this.onValueChange,ref:this.props.saveRef(a.Id),Value:a.Title})),this.props.children,e.createElement("td",{key:"emptyTd"}))},b.prototype.deleteQuestion=function(){var a=this.props.Master,b=a.Model.Id,c=a.ParentQuestionMaster;c.deleteSubQuestion(b),f.log({eventName:k,eventType:"engagement_event",extraData:{questionId:c.Model.Id}})},b.prototype.onValueChange=function(a){this.props.Master.Model.Title=a},b}(g.ReactComponent);b.LikertQuestionRowDesigner=l,Forms.UX.Designer.LikertQuestionRowDesigner=l},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(2),g=c(1),h=OfficeForm.Exports.Control,i=OfficeForm.Exports.EngagementEventNames,j=OfficeForm.Exports.Resources,k=function(a){function b(b){var c=a.call(this,b)||this;return c.applyTheme=c.applyTheme.bind(c),c.onEditButtonClick=c.onEditButtonClick.bind(c),c.onDeleteButtonClick=c.onDeleteButtonClick.bind(c),c.imageOnLoad=c.imageOnLoad.bind(c),c.state={ShowSpinner:!1},c}return d(b,a),b.prototype.render=function(){return e.createElement("span",{className:"theme-icon-container"},this.createThemeButton(),this.createColorSnapshot(),this.createEditButton(),this.createDeleteButton(),this.createSpinner())},b.prototype.createThemeButton=function(){var a=j.LocalizedStrings,b=this.props.Theme,c=a["Theme_Name_"+b.Name]||j.LocalizedStrings.Customized_Theme_Name;return h.createButton({ButtonStyle:"LightBackground",children:this.createThemeThumbnail(),HTMLAttributes:{"aria-label":c,className:"theme-icon-button",onClick:this.applyTheme,title:c},ToggleActive:this.props.IsActive})},b.prototype.createThemeThumbnail=function(){if(this.props.Theme){var a=void 0,b=this.props.Theme;if(b.Thumbnail)a={backgroundImage:"url("+b.Thumbnail+")"};else{if(b.BackgroundImage)return e.createElement("img",{alt:j.LocalizedStrings.Customized_Theme_Name,className:"theme-icon",key:"background-image",src:b.BackgroundImage+"_mo",onLoad:this.imageOnLoad});if(!b.PrimaryColor)return null;a={backgroundColor:b.PrimaryColor}}return e.createElement("span",{className:"theme-icon",style:a})}return null},b.prototype.createColorSnapshot=function(){if(this.props.ShowColorSnapshot){var a=this.props.Theme,b={};return a.PrimaryColor&&(b.backgroundColor=a.PrimaryColor),e.createElement("div",{className:"customized-theme-color-snapshot",onClick:this.applyTheme},e.createElement("div",{className:"snapshot-title",style:b},e.createElement("div",{className:"snapshot-title-content"})),e.createElement("div",{className:"snapshot-content"},e.createElement("div",{className:"snapshot-submit-button",style:b})))}return null},b.prototype.createEditButton=function(){return this.props.editTheme?h.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{className:"customized-theme-edit-button",onClick:this.onEditButtonClick},Icon:"Edit",IconClassName:"paneThemeEdit forms-icon-size18x18",key:"editButton",Text:j.LocalizedStrings.Edit_Customized_Theme}):null},b.prototype.createDeleteButton=function(){return this.props.deleteTheme?h.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{className:"customized-theme-delete-button",onClick:this.onDeleteButtonClick},Icon:"Delete",IconClassName:"paneThemeTrash forms-icon-size18x18",key:"deleteButton",Text:j.LocalizedStrings.Delete_Customized_Theme}):null},b.prototype.onDeleteButtonClick=function(){f.log({eventName:i.DesignPage.Theme.DeleteImage,eventType:"engagement_event"}),this.props.deleteTheme&&this.props.deleteTheme(),this.setState({ShowSpinner:!0})},b.prototype.applyTheme=function(){f.log({eventName:i.DesignPage.Theme.SwitchTheme,eventType:"engagement_event",extraData:{theme:this.props.Theme.Name}}),this.props.applyTheme(this.props.Theme.Name)},b.prototype.onEditButtonClick=function(){f.log({eventName:i.DesignPage.Theme.EditCustomizedTheme,eventType:"engagement_event"}),this.props.editTheme&&this.props.editTheme()},b.prototype.imageOnLoad=function(){this.setState({ShowSpinner:!1})},b.prototype.createSpinner=function(){return this.state.ShowSpinner?e.createElement("div",{className:"customized-theme-spinner-container"},e.createElement("div",{className:"customized-theme-spinner"},e.createElement("div",{className:"spinner-tile-animation"}))):null},b}(g.ReactComponent);b.ThemeButton=k},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e,f=c(0),g=c(2),h=c(1),i=OfficeForm.Exports.Models,j=OfficeForm.Exports.Control,k=OfficeForm.Exports.EngagementEventNames,l=i.ImageErrorType,m=OfficeForm.Exports.Resources,n=OfficeForm.Exports.FormLimitation,o=OfficeForm.Exports.Utilities,p=i.ImageSize,q=OfficeForm.Exports.EngagementEventNames.DesignPage;!function(a){a[a.Loading=0]="Loading",a[a.Success=1]="Success",a[a.Error=2]="Error"}(e||(e={}));var r=28,s=120,t=150,u=function(a){function b(b){var c=a.call(this,b)||this;return c.state={ImageLoadStatus:e.Loading,ShowAltTextButton:!0},c.onError=c.onError.bind(c),c.onLoad=c.onLoad.bind(c),c.refreshCallback=c.refreshCallback.bind(c),c.onAltBlurCallback=c.onAltBlurCallback.bind(c),c.imageZoomIn=c.imageZoomIn.bind(c),c.imageZoomOut=c.imageZoomOut.bind(c),c.enterAltTextEditingMode=c.enterAltTextEditingMode.bind(c),c.onAltValueChange=c.onAltValueChange.bind(c),c.deleteImage=c.deleteImage.bind(c),c.updateChangeCallback=c.updateChangeCallback.bind(c),c}return d(b,a),b.prototype.componentDidMount=function(){var a=i.ImageInfoMaster.Schema;this.props.ImageInfoMaster.observe(this.updateChangeCallback,[a.ErrorType,a.AltText,a.ResourceUrl])},b.prototype.componentWillUnmount=function(){this.clearBlurTimeId(),this.props.ImageInfoMaster.unobserve(this.updateChangeCallback);var a=this.props.ImageInfoMaster.Model;a&&a.ErrorType!==i.ImageErrorType.NoError&&(a.ErrorType=i.ImageErrorType.NoError)},b.prototype.render=function(){return f.createElement("div",{className:"title-designer-image-editor"},this.createImage(),this.createImageError())},b.prototype.createImage=function(){var a=this.props.ImageInfoMaster.Model;if(a.ErrorType!==i.ImageErrorType.NoError||this.state.ImageLoadStatus===e.Error)return null;var c,d="title-designer-image design-question-title-image-hidden",g=o.Html.combineAttributes("title-designer-image-content design-question-title-image-button office-form-theme-focus-border",this.props.ImageWidth?"inline-block-display":"");this.underSyncing()?(g=o.Html.combineAttributes(g,"office-form-theme-outline"),d=o.Html.combineAttributes(d,this.state.ImageLoadStatus===e.Success?"design-question-title-image-gray visiable":""),c=b.createSpinner()):(d=o.Html.combineAttributes(d,a.ResourceUrl?"visiable":""),c=this.createEditPanel());var h,j;return this.props.ImageWidth?(h=this.props.ImageWidth,j=this.props.ImageHeight):(h="100%",j="auto"),f.createElement("div",{"aria-label":m.LocalizedStrings.DesignPage_Image_ImageDesigner,className:g},f.createElement("img",{alt:a.AltText,className:d,height:j,onError:a.ResourceUrl?this.onError:void 0,onLoad:this.onLoad,src:a.ResourceUrl?a.ResourceUrl:void 0,tabIndex:0,title:a.AltText,width:h}),c)},b.prototype.createEditPanel=function(){var a;return this.props.Resizable&&(a=this.createImageSizeButtons()),f.createElement("div",{className:"image-edit-pane-container office-form-theme-border"},a,this.createImageAltTextTextbox(),this.createImageDeleteButton())},b.prototype.createImageSizeButtons=function(){var a,b="image-edit-pane-inner-button office-form-theme-button-foreground",c=this.props.ImageSettingMaster.Model.Size;c===p.Small&&(b=o.Html.combineAttributes(b,"active"),a=!0);var d,e=j.createButton({ButtonStyle:"LightBackground",children:j.createFontIconControl({HTMLAttributes:{className:"image-edit-pane-inner-button-icon forms-icon-size14x14"},IconName:"moderateIcon"}),HTMLAttributes:{"aria-label":m.LocalizedStrings.ImageEditPane_SmallSize_Button,className:b,disabled:a,onClick:this.imageZoomIn,title:m.LocalizedStrings.ImageEditPane_SmallSize_Button}}),g="image-edit-pane-inner-button office-form-theme-button-foreground";c===p.Large&&(g=o.Html.combineAttributes(g,"active"),d=!0);var h=j.createButton({ButtonStyle:"LightBackground",children:j.createFontIconControl({HTMLAttributes:{className:"image-edit-pane-inner-button-icon forms-icon-size14x14"},IconName:"intenseIcon"}),HTMLAttributes:{"aria-label":m.LocalizedStrings.ImageEditPane_LargeSize_Button,className:g,disabled:d,onClick:this.imageZoomOut,title:m.LocalizedStrings.ImageEditPane_LargeSize_Button}});return f.createElement("div",{className:"image-edit-pane-element-container office-form-theme-border",key:"size-button"},e,h)},b.prototype.onImageSizeButtonClick=function(a){var b=this.props.ImageInfoMaster.Model,c=this.props.ImageSettingMaster;g.log({eventName:q.ImageEditPane.Style,eventType:"engagement_event",extraData:{imageId:b.ResourceId,style:a}}),c.onImageStyleChange(a)},b.prototype.imageZoomIn=function(){this.onImageSizeButtonClick(p.Small)},b.prototype.imageZoomOut=function(){this.onImageSizeButtonClick(p.Large)},b.prototype.createImageDeleteButton=function(){var a=j.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{className:"image-edit-pane-inner-button office-form-theme-button-foreground",onClick:this.deleteImage},Icon:"Delete",IconClassName:"forms-icon-size14x14",Text:m.LocalizedStrings.ImageEditPane_Delete_Button});return f.createElement("div",{className:"image-edit-pane-delete",key:"delete-button"},a)},b.prototype.createImageAltTextTextbox=function(){if(this.state.ShowAltTextButton){var a=j.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{className:"image-edit-pane-inner-button office-form-theme-button-foreground",onClick:this.enterAltTextEditingMode},Icon:"TextField",IconClassName:"edit-pane-fieldText",Text:m.LocalizedStrings.ImageEditPane_AltText_Button});return f.createElement("div",{className:"image-edit-pane-alttext-button office-form-theme-border",key:"alttext-button"},a)}var b=j.createTextField({AutoFocus:!0,AutoSelection:!0,MaxLength:n.ImageAltTextLength,MinimalHeight:r,onValueChange:this.onAltValueChange,Options:{HTMLPropsForInnerElement:{onBlur:this.onAltBlurCallback}},Placeholder:m.LocalizedStrings.ImageEditPane_AltText_PlaceHolder,ref:"edit-pane-alttext",TextFieldType:j.TextFieldType.SingleLine,Value:this.props.ImageInfoMaster.Model.AltText});return f.createElement("div",{className:"image-edit-pane-alttext office-form-theme-border",key:"alttext"},b)},b.prototype.onAltValueChange=function(a){this.props.ImageInfoMaster.Model.AltText=a},b.prototype.enterAltTextEditingMode=function(){g.log({eventName:k.DesignPage.ImageEditPane.AltText,eventType:"engagement_event",extraData:{Id:this.props.ImageInfoMaster.Model.ResourceId}}),this.setState({ShowAltTextButton:!1})},b.prototype.onAltBlurCallback=function(){var a=this;this.delayBlurTimeId=window.setTimeout(function(){a.delayBlurTimeId=null,a.setState({ShowAltTextButton:!0})},t)},b.prototype.clearBlurTimeId=function(){this.delayBlurTimeId&&(window.clearTimeout(this.delayBlurTimeId),this.delayBlurTimeId=null)},b.prototype.onError=function(){g.log({eventName:k.Image.ImageOnLoad.Failure,eventType:"engagement_event",extraData:{imageSrc:this.props.ImageInfoMaster.Model.ResourceUrl,imageType:this.props.ImageSettingMaster.IsFormLogo?"Logo":"Section",location:"0"}}),this.setState({ImageLoadStatus:e.Error})},b.prototype.onLoad=function(){g.log({eventName:k.Image.ImageOnLoad.Success,eventType:"engagement_event",extraData:{imageType:this.props.ImageSettingMaster.IsFormLogo?"Logo":"Section",location:"0"}}),this.setState({ImageLoadStatus:e.Success})},b.prototype.createImageError=function(){var a=this.props.ImageInfoMaster,c=a.Model;if(c.ErrorType===i.ImageErrorType.NoError&&this.state.ImageLoadStatus!==e.Error)return null;var d,g;c.ErrorType===l.DeleteFailError||this.state.ImageLoadStatus===e.Error?(d=b.createOperationButton(m.LocalizedStrings.ImageEditPane_Delete_Button,"office-form-theme-primary-foreground","Horizontal","Delete","forms-icon-size12x12",this.deleteImage),g=b.createOperationButton(m.LocalizedStrings.ImageEditPane_Refresh_Button,"office-form-theme-primary-foreground","Horizontal","Refresh","forms-icon-size12x12",this.refreshCallback)):d=b.createOperationButton(m.LocalizedStrings.DesignPage_Image_UploadAgain,"office-form-theme-primary-foreground","Horizontal","Photo2","forms-icon-size12x12",this.props.addImage);var h=j.createFontIconControl({HTMLAttributes:{className:"image-error-frowny-icon"},IconName:"Sad"}),k=j.createLabel({HTMLAttributes:{className:"error-message"},Label:a.getImageErrorMessage()||m.LocalizedStrings.Error_Message_5205}),o={height:this.props.ImageHeight||s+"px",width:this.props.ImageWidth||n.ImagePlaceHolderWidth+"px"};return f.createElement("div",{className:"design-image-error office-form-theme-border",style:o},f.createElement("div",{className:"error-message-box"},h,k),f.createElement("div",null,g,d))},b.prototype.deleteImage=function(){var a=this.props.ImageInfoMaster,b=this.props.ImageSettingMaster;g.log({eventName:q.ImageEditPane.Delete,eventType:"engagement_event",extraData:{imageKind:b.IsFormLogo?"Logo":"Section"}}),a.clear().done(function(){return b.clear()})},b.prototype.refreshCallback=function(){this.setState({ImageLoadStatus:e.Loading})},b.createOperationButton=function(a,b,c,d,e,f){return j.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:c,HTMLAttributes:{className:b,onClick:f},Icon:d,IconClassName:e,Text:a})},b.prototype.underSyncing=function(){var a=this.props.ImageInfoMaster.Model;return a.ImageProcessingStatus!==i.ImageProcessingStatus.Idle||this.state.ImageLoadStatus===e.Loading},b.prototype.updateChangeCallback=function(){this.forceUpdate()},b.createSpinner=function(){return f.createElement("div",{className:"image-spinner"},f.createElement("div",{className:"spinner-tile-animation"}))},b}(h.ReactComponent);b.ImageDesigner=u},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(3),h=c(1),i=OfficeForm.Exports.FormLimitation,j=OfficeForm.Exports.Control,k=OfficeForm.Exports.Resources,l=OfficeForm.Exports.Utilities,m=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.titleRef=f.createRef(),b}return d(b,a),b.prototype.focus=function(){var a=this.titleRef.current;a&&a.focus()},b.prototype.render=function(){var a=g.extend({},this.props.HTMLAttributes);return a.className=l.Html.combineAttributes(a.className,"title-designer-container"),f.createElement("div",e({},a),this.createTitle(),this.createSubTitle())},b.prototype.createTitle=function(){var a=i.DefaultTextFieldHeight,b=j.TextFieldType.AutoHeightMultiline;this.props.TitleHeight&&"Top"!==this.props.MediaLayout&&"Bottom"!==this.props.MediaLayout&&(b=j.TextFieldType.FixHeightMultiline,a=this.props.TitleHeight);var c=l.Html.combineAttributes("title-designer-title-box",this.props.MediaLayout.toLowerCase()),d=j.createTextField({AutoFocus:!0,AutoSelection:!0,HTMLAttributes:{className:"title-designer-title-editor"},MaxLength:i.FormTitleLength,MinimalHeight:a,onValueChange:this.props.onValueChange,Options:{HTMLPropsForInnerElement:{className:"mixer-focus-target"}},Placeholder:k.LocalizedStrings.Designer_PlaceholderForFormTitle,ref:this.titleRef,TextFieldType:b,Value:this.props.Value});return f.createElement("div",{className:c},d,this.props.children)},b.prototype.createSubTitle=function(){return j.createTextField({HTMLAttributes:{className:"title-designer-subtitle-editor"},MaxLength:i.FormSubtitleLength,MinimalHeight:i.DefaultTextFieldHeight,onValueChange:this.props.onSubTitleChange,Placeholder:k.LocalizedStrings.Designer_PlaceholderForFormSubtitle,TextFieldType:j.TextFieldType.AutoHeightMultiline,Value:this.props.SubTitle})},b}(h.ReactComponent);b.TitleMediaDesigner=m},function(a,b,c){"use strict";function d(a){return a&&a.Templates||[]}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var f,g=c(0),h=c(3),i=c(2),j=c(1),k=c(184),l=c(185),m=OfficeForm.Exports.Control,n=OfficeForm.Exports.Models,o=OfficeForm.Exports.Resources,p="IntelligenceStatistic.QuestionSuggestion.Add",q="IntelligenceStatistic.QuestionSuggestion.AddAll",r="IntelligenceStatistic.QuestionSuggestion.Dismiss",s="IntelligenceStatistic.QuestionSuggestion.Show",t="Intelligence.QuestionSuggestion.Add",u="Intelligence.QuestionSuggestion.AddAll",v="Intelligence.QuestionSuggestion.Dismiss",w="Intelligence.QuestionSuggestion.Show",x="10";!function(a){a[a.QuestionSuggestion=0]="QuestionSuggestion",a[a.TemplateSuggestion=1]="TemplateSuggestion"}(f=b.SuggestionType||(b.SuggestionType={})),b.getSafeTemplateSuggestion=d;var y=function(a){function b(b){var c=a.call(this,b)||this;return c.state={SelectedIndex:[],TemplateIndex:0,Templates:[]},c.closeSuggestionCard=c.closeSuggestionCard.bind(c),c.changeGalleryDot=c.changeGalleryDot.bind(c),c.changeQuestionSuggestion=c.changeQuestionSuggestion.bind(c),c}return e(b,a),b.prototype.componentWillUpdate=function(a,b){var c=this.state,d=this.props;!d.ShowSuggestionCard&&a.ShowSuggestionCard?(this.logSuggestionShown(c.Templates),this.askSuggestion()):this.props.ShowSuggestionCard&&!h.isEqual(c.Templates,b.Templates)&&this.logSuggestionShown(b.Templates)},b.prototype.render=function(){return this.props.ShowSuggestionCard&&this.state.Templates&&0!==this.state.Templates.length?g.createElement("div",{className:"form-intelligence-container office-form-theme-focus-border office-form-theme-border-top",key:"formIntelligenceCardContainer",tabIndex:-1},this.createHeader(),this.createQuestionGroup(),this.createGallery()):null},b.prototype.updateSuggestion=function(a){h.isEqual(this.state.Templates,a)||this.setState({SelectedIndex:a.map(function(a){return[]}),TemplateIndex:0,Templates:a})},b.prototype.getFilteredQuestions=function(){return this.getAllQuestions().filter(function(a){return a.Type!==n.QuestionType.MatrixChoice})},b.prototype.getAllQuestions=function(){return this.state.Templates[this.state.TemplateIndex].Questions},b.prototype.createHeader=function(){var a,b=this.getFilteredQuestions();a=1===b.length?o.LocalizedStrings.IntelligenceSuggestion_Title_Singular:o.LocalizedStrings.IntelligenceSuggestion_Title;var c,d=g.createElement("div",{className:"form-intelligence-header-count-container"},a),e=this.state.SelectedIndex.reduce(function(a,b){return a.concat(b)}).length;if(this.state.Templates.length>1&&e>0){var f=o.LocalizedStrings.IntelligenceSuggestion_Add_With_Count;c=f.format(e)}else c=e>0?o.LocalizedStrings.IntelligenceSuggestion_Add:1===b.length?o.LocalizedStrings.IntelligenceSuggestion_AddQuestion:o.LocalizedStrings.IntelligenceSuggestion_AddAll;var h=m.createTextButton({ButtonStyle:"LightBackground",HTMLAttributes:{className:"form-intelligence-header-add-button office-form-theme-interactive-color",onClick:this.onClickAddButton.bind(this)},Text:c}),i=m.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{className:"form-intelligence-header-close-button",onClick:this.closeSuggestionCard},Icon:"Cancel",IconClassName:"forms-icon-size14x14"});return g.createElement("div",{className:"form-intelligence-header-container"},d,g.createElement("div",{className:"form-intelligence-header-button-container"},g.createElement("div",{className:"form-intelligence-header-buttons"},h,i)))},b.prototype.createGallery=function(){var a=this;if(this.state.Templates.length<=1)return null;var b=this.state.Templates.map(function(b,c){return g.createElement(l.SuggestionCardGalleryDot,{changeGalleryDot:a.changeGalleryDot,Index:c,key:c,Selected:c===a.state.TemplateIndex})});return g.createElement("div",{className:"question-suggestion-card-gallery"},g.createElement("div",{className:"question-suggestion-card-gallery-dots-container"},b))},b.prototype.createQuestionGroup=function(){var a=this,b=this.getFilteredQuestions(),c=b.map(function(b,c){return g.createElement(k.QuestionSuggestion,{changeQuestionSuggestion:a.changeQuestionSuggestion,Index:c,key:c,Question:b,Selected:a.state.SelectedIndex[a.state.TemplateIndex].indexOf(c)>=0})});return g.createElement("div",{className:"from-intelligence-question-group",key:"formIntelligenceGroup",role:"group"},c)},b.prototype.onClickAddButton=function(){var a=this;this.state.SelectedIndex.forEach(function(a){return a.sort()});var b=this.state.Templates.map(function(b,c){return a.state.Templates[c].Questions}).reduce(function(a,b){return a.concat(b)}),c=this.state.SelectedIndex.map(function(b,c){var d=a.state.Templates[c].Questions.filter(function(a){return a.Type!==n.QuestionType.MatrixChoice});return b.map(function(a){return d[a]})}).reduce(function(a,b){return a.concat(b)}),d=0===c.length;d&&(c=this.getFilteredQuestions());var e=this.state.Templates[this.state.TemplateIndex].TemplateId;i.log({eventName:d?q:p,eventType:"engagement_event",extraData:{AddedQuestionsCount:c.length,IsMathSuggestion:b.some(function(a){return a.IsMathQuiz}),SuggestedQuestionsCount:c.length,SuggestTemplate:this.getSuggestionType()===f.TemplateSuggestion,TemplateId:e,TemplateIds:this.state.Templates.map(function(a){return a.TemplateId})}}),i.log({eventName:d?u:t,eventType:"engagement_event",extraData:{IsMathSuggestion:b.some(function(a){return a.IsMathQuiz}),IsNPSSuggestion:e===x,SuggestTemplate:this.getSuggestionType()===f.TemplateSuggestion}}),this.setState({SelectedIndex:[],Templates:[]}),this.props.insertQuestionsCallback(b,c,e||"")},b.prototype.changeQuestionSuggestion=function(a,b){var c=this.state.SelectedIndex,d=c[this.state.TemplateIndex].indexOf(a);d>=0&&b?c[this.state.TemplateIndex].splice(d,1):c[this.state.TemplateIndex].push(a),this.setState({SelectedIndex:c})},b.prototype.closeSuggestionCard=function(a){var b=this.getFilteredQuestions(),c=this.state.Templates[this.state.TemplateIndex].TemplateId;i.log({eventName:r,eventType:"engagement_event",extraData:{IsMathSuggestion:b.some(function(a){return a.IsMathQuiz}),SuggestedQuestionsCount:b.length,SuggestTemplate:this.getSuggestionType()===f.TemplateSuggestion,TemplateId:c}}),i.log({eventName:v,eventType:"engagement_event",extraData:{IsMathSuggestion:b.some(function(a){return a.IsMathQuiz}),IsNPSSuggestion:c===x,SuggestTemplate:this.getSuggestionType()===f.TemplateSuggestion}}),this.setState({SelectedIndex:[],TemplateIndex:0,Templates:[]})},b.prototype.changeGalleryDot=function(a){this.setState({TemplateIndex:a})},b.prototype.logSuggestionShown=function(a){0!==a.length&&(i.log({eventName:s,eventType:"engagement_event",extraData:{IsMathSuggestion:a.filter(function(a){return a.Questions.some(function(a){return a.IsMathQuiz})}).length>0,TemplateId:a.map(function(a){return a.TemplateId})}}),i.log({eventName:w,eventType:"engagement_event",extraData:{IsMathSuggestion:a.filter(function(a){return a.Questions.some(function(a){return a.IsMathQuiz})}).length>0,IsNPSSuggestion:a.some(function(a){return a.TemplateId===x}),SuggestionTemplate:this.getSuggestionType()===f.TemplateSuggestion}}))},b}(j.ReactComponent);b.BaseSuggestionCard=y},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(3),g=c(4),h=c(34),i=c(1),j=OfficeForm.Exports.EnvironmentConfig,k=OfficeForm.Exports.Resources,l=3,m=100,n=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.state={AreMembersReady:!1,IsGroupInfoReady:!1},b.mounted=!0,b.controlId=f.uniqueId("PortalViewGroupBar"),b}return d(b,a),b.prototype.componentWillMount=function(){var a=this,b=this.props.GroupMaster;b&&(b.ensureFieldsReady([b.Schema.members]).then(function(){a.mounted&&a.setState({AreMembersReady:!0})}),b.ensureFieldsReady([b.Schema.classification,b.Schema.emailAddress,b.Schema.isFavorite,b.Schema.visibility]).then(function(){a.mounted&&a.setState({IsGroupInfoReady:!0})}))},b.prototype.componentWillUnmount=function(){this.mounted=!1},b.prototype.render=function(){return this.props.GroupMaster?e.createElement("div",{className:"portal-view group-bar"},this.showSpinner(),this.createGroupInfo(),this.createCuttingLine(),this.createGroupMemberContent(),this.createGroupMembersCountInfo()):null},b.prototype.createGroupInfo=function(){if(!this.state.IsGroupInfoReady||!this.state.AreMembersReady)return null;var a=this.props.GroupMaster.Model,b=a.classification,c=a.visibility;"public"===c.toLocaleLowerCase()?c=k.LocalizedStrings.PortalView_GroupForms_PublicGroup:"private"===c.toLocaleLowerCase()&&(c=k.LocalizedStrings.PortalView_GroupForms_PrivateGroup);var d=c||"";return b&&(d+=" ( "+b+" )"),e.createElement("div",{className:"group-info"},e.createElement("span",null,d))},b.prototype.createCuttingLine=function(){return this.state.AreMembersReady&&this.state.IsGroupInfoReady?e.createElement("div",{className:"group-info-cutting-line"}):null},b.prototype.createGroupMemberContent=function(){if(!this.state.AreMembersReady||!this.state.IsGroupInfoReady)return null;var a=this.props.GroupMaster,b=this.getShowMembers(),c=b.map(function(b){var c=b.displayName,d=e.createElement(h.NameCard,{DisplayName:b.displayName,Photo:a.getMemberPhoto(b.id),PhotoType:h.PhotoType.User,HideName:!0,key:b.id});return e.createElement("div",{className:"group-member-photo",key:c},d)});return e.createElement("div",{className:"group-members"},c)},b.prototype.createGroupMembersCountInfo=function(){if(!this.state.AreMembersReady||!this.state.IsGroupInfoReady)return null;var a,b=this.props.GroupMaster.Model.members.length;if(1>b)throw Error("Group members count can not be smaller than 1.");a=1===b?"1 "+k.LocalizedStrings.GroupView_GroupInfoBar_Member_Text:b>=m?"99+ "+k.LocalizedStrings.GroupView_GroupInfoBar_Members_Text:b.toString()+" "+k.LocalizedStrings.GroupView_GroupInfoBar_Members_Text;var c=j.isProduction()?"https://outlook.office.com/owa/?path=/group/"+this.props.GroupMaster.Model.emailAddress+"/people":"javascript:void(0)",d=this.controlId+"-link-description",f=this.getShowMembers().map(function(a){return a.displayName}).join(k.LocalizedStrings.Common_ItemSeperator),g=k.LocalizedStrings.PortalView_GroupForms_MemberLinkDescription.format(a,f),h=e.createElement("a",{href:c,target:"_blank","aria-describedby":d},a);return e.createElement("div",{className:"group-members-count"},h,e.createElement("span",{id:d,style:{display:"none"}},g))},b.prototype.getShowMembers=function(){var a=this.props.GroupMaster,b=a.Model.members.length,c=g.convertToArray(a.Model.members);return b>l&&(c=c.slice(0,l)),c},b.prototype.showSpinner=function(){return this.state.AreMembersReady&&this.state.IsGroupInfoReady?null:e.createElement("div",{className:"spinner-tile-animation",key:"groupInfo"})},b}(i.ReactComponent);b.PortalViewGroupBar=n},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(3),g=c(2),h=c(34),i=c(1),j=OfficeForm.Exports.Control,k=OfficeForm.Exports.Models,l=OfficeForm.Exports.Resources,m="PortalPage.GroupFormsPortal.GroupCard.Click",n="PortalPage.GroupFormsPortal.Group.FormsCount",o=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;
return b.state={IsFormsCountReady:!1,IsGroupPhotoReady:!1,ShowFormsCount:!0,ShowGroupPhoto:!0},b.mounted=!0,b}return d(b,a),b.prototype.componentWillMount=function(){var a=this,b=this.props.GroupMaster;b.ensureFieldsReady([b.Schema.formReferences]).then(function(){a.mounted&&(g.log({eventName:n,eventType:"engagement_event",extraData:{formsCount:b.Model.formReferences.length,groupId:b.Model.id}}),a.setState({IsFormsCountReady:!0}))}),b.Photo.then(function(){a.mounted&&a.setState({IsGroupPhotoReady:!0})})},b.prototype.componentWillUnmount=function(){this.mounted=!1},b.prototype.render=function(){var a={className:"fl-group-content",onClick:this.onClick.bind(this)},b=j.createButton({ButtonStyle:"LightBackground",children:[this.createCardOwnerContent(),this.createFormsCountContainer()],HTMLAttributes:a,key:"card-content"});return e.createElement("div",{className:"fl-history-tile fl-tile fl-group-tile"},b)},b.prototype.onClick=function(){this.state.IsFormsCountReady&&(g.log({eventName:m,eventType:"engagement_event"}),this.props.createFormsCard(this.props.GroupMaster))},b.prototype.createCardOwnerContent=function(){var a=this.props.GroupMaster;return e.createElement(h.NameCard,{DisplayName:a.Model.displayName,Photo:a.Photo,PhotoType:h.PhotoType.Group,key:a.Model.id})},b.prototype.createFormsCountContainer=function(){if(!this.state.IsFormsCountReady)return e.createElement("div",{className:"group-spinner",key:"group-forms-count-spinner"},e.createElement("div",{className:"spinner-tile-animation"}));var a,b=this.props.GroupMaster,c=f.filter(b.Model.formReferences,function(a){return f.isEqual(a.softDeleted,k.FormDeletedState.Normal)}),d=c.length;switch(d){case 0:a=l.LocalizedStrings.PortalView_GroupForms_FormsCount_0_Text.format(d.toString());break;case 1:a=l.LocalizedStrings.PortalView_GroupForms_FormsCount_1_Text.format(d.toString());break;default:a=l.LocalizedStrings.PortalView_GroupForms_FormsCount_Multiple_Text.format(d.toString())}return e.createElement("span",{className:"fl-formscount",key:"group-forms-count"},a)},b}(i.ReactComponent);b.PortalViewGroupCard=o},function(a,b,c){"use strict";function d(a,b,c,d){var e=a.FormMasterExpectSoftDeleted;return d.forEach(function(a){e=e.filter(function(b){return b.Model.Title.toLowerCase().indexOf(a)>=0})}),e.sort(function(a,b){return Date.parse(b.Model.Modified)-Date.parse(a.Model.Modified)}).map(function(d){return f.createElement(s,{focusOut:c,FormMaster:d,GroupMaster:a,key:d.getInstanceId(),onClick:b})})}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(6),h=c(64),i=c(2),j=c(69),k=c(53),l=OfficeForm.Exports.Control,m=OfficeForm.Exports.Models.FormMaster,n=OfficeForm.Exports.Models,o=OfficeForm.Exports.Resources,p=OfficeForm.Exports.Utilities,q="PortalPage.GroupFormsPortal.GroupForm.Duplicate",r="PortalPage.GroupFormsPortal.GroupForm.MoveToRecycleBin",s=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.state={DeleteConfirmDialogPrompted:!1,DuplicateRemoveDialogPrompted:!1,IsResponseCountReady:!1,IsThemeReady:!1,IsTitleReady:!0,ShowCardResponseCount:!0,ShowCardTheme:!0,ShowCardTitle:!0},b.mounted=!0,b.triggerButtonRef=f.createRef(),b}return e(b,a),b.prototype.componentWillMount=function(){var a=this,b=this.props.FormMaster;if(b){this.onModelChange=function(){return a.forceUpdate()};var c=m.Schema;b.observe(this.onModelChange,[c.ResponsesCount,c.SavingState,c.Title,c.Theme]);var d=b.Synchronizer.Schema;b.Synchronizer.observe(this.onModelChange,[d.CreationFailed,d.CreationInProcess,d.CreationScheduled]),b.ensureFieldsReady([m.Schema.ResponsesCount,m.Schema.Theme]).done(function(){a.mounted&&a.setState({IsResponseCountReady:!0,IsThemeReady:!0})})}},b.prototype.componentWillUnmount=function(){var a=this.props.FormMaster;a&&(a.unobserve(this.onModelChange),a.Synchronizer.unobserve(this.onModelChange)),this.mounted=!1},b.prototype.onClick=function(){this.props.onClick(this.props.FormMaster)},b.prototype.getCardDescription=function(){return this.state.ShowCardResponseCount&&this.state.IsResponseCountReady?o.LocalizedStrings.PortalView_FormCard_Responses.format(this.getCardResponseCount()):null},b.prototype.getCardThemeName=function(){var a=this.props.FormMaster;return a.isFieldReady(a.Schema.Theme)?a.ThemeMaster.Model.Name:null},b.prototype.getCardThemeBackgroupUrl=function(){var a=this.props.FormMaster;return a.isFieldReady(a.Schema.Theme)?a.ThemeMaster.Model.BackgroundImage:null},b.prototype.getCardThemePrimaryColor=function(){var a=this.props.FormMaster;return a.isFieldReady(a.Schema.Theme)?a.ThemeMaster.Model.PrimaryColor:null},b.prototype.getCardTitle=function(){return this.props.FormMaster.Model.Title},b.prototype.getCardResponseCount=function(){var a=this.props.FormMaster;return a.isFieldReady(m.Schema.ResponsesCount)&&a.Model.ResponsesCount?a.Model.ResponsesCount:0},b.prototype.createCardOwnerContent=function(){var a=this.props.FormMaster;if(a.isFieldReady(a.Schema.Category))switch(a.Model.Category){case"Poll":return f.createElement("div",{className:"fl-category-label fl-category-poll",key:"category-label",title:o.LocalizedStrings.OutlookAddin_FormCard_CategoryLabel});case"Teams Poll":return f.createElement("div",{className:"fl-category-label fl-category-poll",key:"category-label",title:o.LocalizedStrings.Teams_FormCard_CategoryLabel});case"assignments":return f.createElement("div",{className:"fl-category-label fl-category-assignments",key:"category-label",title:o.LocalizedStrings.Teams_Assignments_FormCard_CategoryLabel});default:return null}return null},b.prototype.createCardTypeContent=function(){return j.createFormCardType(this.props.FormMaster)},b.prototype.createOtherContent=function(){var a=this.props.FormMaster;return!this.state.IsThemeReady||!this.state.IsResponseCountReady||a.Deleted&&a.Model.SavingState===n.SavingStateValues.Idle||a.Synchronizer.Model.CreationFailed?null:[this.createDialogTriggerButton(),this.createDuplicationRemoveDialog(),this.createDeleteConfirmDialog()]},b.prototype.shouldShowSpinner=function(){var a=this.props.FormMaster;if(!a)return!1;if(a.Model.DeleteCollaborationPermission)return!0;var b=!1;return a.isFieldReady(a.Schema.MovingToRecycleBin)&&(b=a.Model.MovingToRecycleBin),a.Deleted||b||a.Synchronizer.Model.CreationInProcess||a.Synchronizer.Model.CreationScheduled||!a.isFieldReady(m.Schema.Id)},b.prototype.onDeleteClick=function(){i.log({eventName:r,eventType:"engagement_event"}),this.props.FormMaster.moveToRecycleBin()},b.prototype.onDuplicateClick=function(){i.log({eventName:q,eventType:"engagement_event"}),h.duplicateForm(this.props.FormMaster,this.props.GroupMaster)},b.prototype.createDialogTriggerButton=function(){var a=this,b={"aria-disabled":this.state.ContentCovered,className:"fl-menu-button",onClick:function(){a.setState({DuplicateRemoveDialogPrompted:!0,ContentCovered:!0})}};return(this.state.DuplicateRemoveDialogPrompted||this.state.DeleteConfirmDialogPrompted)&&(b.className=p.Html.combineAttributes(b.className,"dn")),l.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:b,Icon:"More",IconClassName:"forms-icon-size20x20",key:"triggerButton",ref:this.triggerButtonRef,Text:o.LocalizedStrings.PortalView_Menu_Text})},b.prototype.createDuplicationRemoveDialog=function(){var a=this;if(this.state.DuplicateRemoveDialogPrompted&&!this.shouldShowSpinner()){var b={ButtonStyle:"DarkBackGround",GlyphButtonStyle:"Vertical",IconClass:"Copy",Key:"duplicateItem",onClick:function(){a.setFocusOnDialogTriggerButton(),a.onDuplicateClick(),a.setState({DuplicateRemoveDialogPrompted:!1,ContentCovered:!1})},Text:o.LocalizedStrings.PortalView_Duplicate_Button,TextClassName:"fl-menu-text",Title:o.LocalizedStrings.PortalView_Duplicate_Text},c={ButtonStyle:"DarkBackGround",GlyphButtonStyle:"Vertical",IconClass:"Delete",Key:"removeItem",onClick:function(){a.setState({DeleteConfirmDialogPrompted:!0,DuplicateRemoveDialogPrompted:!1})},Text:o.LocalizedStrings.PortalView_Delete_Button,TextClassName:"fl-menu-text",Title:o.LocalizedStrings.PortalView_Delete_Text},d=[b,c],e={ButtonsProps:d,ClassName:"portal-view-form-card-copy-remove-container",key:"duplicateRemoveDialog",onBlur:function(){return a.setState({DuplicateRemoveDialogPrompted:!1,ContentCovered:!1})},onDismiss:function(){return a.setFocusOnDialogTriggerButton()},ShowDialog:this.state.DuplicateRemoveDialogPrompted,TrapFocus:!0};return l.createSimpleDialog(e)}},b.prototype.createDeleteConfirmDialog=function(){var a=this;if(this.state.DeleteConfirmDialogPrompted){var b={ButtonStyle:"DarkBackGround",ClassName:"fl-menu-confirm-delete",GlyphButtonStyle:"Horizontal",Key:"deleteItem",onClick:function(){a.props.focusOut(g.findDOMNode(a)),a.onDeleteClick(),a.setState({ContentCovered:!1,DeleteConfirmDialogPrompted:!1})},Text:o.LocalizedStrings.PortalView_Continue_Button,Title:o.LocalizedStrings.PortalView_Continue_Text},c={ButtonStyle:"DarkBackGround",ClassName:"fl-menu-confirm-delete",GlyphButtonStyle:"Horizontal",Key:"cancelItem",onClick:function(){a.setFocusOnDialogTriggerButton(),a.setState({ContentCovered:!1,DeleteConfirmDialogPrompted:!1})},Text:o.LocalizedStrings.PortalView_Cancel_Button,Title:o.LocalizedStrings.PortalView_Cancel_Text},d=o.LocalizedStrings.PortalView_MoveGroupFormToRecycle_Warning_Text,e=[b,c],f={ButtonsProps:e,ClassName:"portal-view-form-card-delete-cancel-container",Description:d,key:"deleteConfirmDialog",onBlur:function(){return a.setState({DeleteConfirmDialogPrompted:!1,ContentCovered:!1})},onDismiss:function(){return a.setFocusOnDialogTriggerButton()},ShowDialog:this.state.DeleteConfirmDialogPrompted,TrapFocus:!0};return l.createSimpleDialog(f)}},b.prototype.setFocusOnDialogTriggerButton=function(){if(this.triggerButtonRef.current){var a=g.findDOMNode(this.triggerButtonRef.current);a&&(a.classList.remove("dn"),a.focus())}},b}(k.PortalViewCardBase);b.PortalViewGroupFormCard=s,Forms.Mru.createSearchedGroupFormCards=d},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(99),h=c(2),i=c(1),j=c(7),k=function(a){function b(b){var c=a.call(this,b)||this;return c.onCardClick=c.onCardClick.bind(c),c.onKeyDown=c.onKeyDown.bind(c),c}return d(b,a),b.prototype.render=function(){var a={className:"template-form-card",onClick:this.onCardClick,onKeyDown:this.onKeyDown,role:"button",tabIndex:0};return f.createElement("div",{className:"fl-history-tile fl-tile"},f.createElement("div",e({},a),f.createElement("div",{className:"title-container"},this.props.Template.Title)))},b.prototype.onKeyDown=function(a){switch(a.keyCode){case j.KeyCode.Enter:case j.KeyCode.Space:this.onCardClick()}},b.prototype.onCardClick=function(){this.props.Template&&h.log({eventName:"MyTemplate.Click",eventType:"engagement_event"});var a=g.getTemplateMaster(this.props.Template);OfficeForm.Exports.DesignPage.dataProviderAdapterConcatToFormList(a),this.props.viewTemplate(a)},b}(i.ReactComponent);b.MyTemplateCard=k,Forms.UX.MyTemplateCard=k},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e,f=c(0),g=c(6),h=c(7),i=c(69),j=c(53),k=OfficeForm.Exports.Utilities.Html.combineAttributes,l=OfficeForm.Exports.Control,m=OfficeForm.Exports.Models.FormMaster,n=OfficeForm.Exports.Resources;!function(a){a[a.None=0]="None",a[a.HoverControl=1]="HoverControl",a[a.KeyBoardControl=2]="KeyBoardControl",a[a.ConfirmDeleteDialogShow=3]="ConfirmDeleteDialogShow"}(e||(e={}));var o=function(a){function b(b){var c=a.call(this,b)||this;return c.deleteButtonRef=f.createRef(),c.setFocusOnCard=c.setFocusOnCard.bind(c),c.setFocusOnDeleteButton=c.setFocusOnDeleteButton.bind(c),c.setShowDialogControlStatusToDefault=c.setShowDialogControlStatusToDefault.bind(c),c.onKeyDown=c.onKeyDown.bind(c),c.state={IsResponseCountReady:!0,IsThemeReady:!0,IsTitleReady:!0,ShowCardResponseCount:!1,ShowCardTheme:!0,ShowCardTitle:!0,ShowDialogControl:e.HoverControl},c}return d(b,a),b.prototype.onKeyDown=function(a){switch(a.keyCode){case h.KeyCode.Enter:case h.KeyCode.Space:this.setState({ShowDialogControl:e.KeyBoardControl},this.setFocusOnDeleteButton),a.stopPropagation(),a.preventDefault();break;case h.KeyCode.Esc:this.setState({ShowDialogControl:e.HoverControl})}},b.prototype.onClick=function(){this.setState({ShowDialogControl:e.KeyBoardControl})},b.prototype.createOtherContent=function(){return this.state.IsThemeReady?[this.createDeleteAndRestoreDialog(),this.createDeleteConfirmDialog()]:null},b.prototype.createDeleteAndRestoreDialog=function(){var a=this,b={ButtonStyle:"DarkBackGround",GlyphButtonStyle:"Vertical",IconClass:"Delete",Key:"removeItem",onClick:function(){a.setState({ShowDialogControl:e.ConfirmDeleteDialogShow})},ref:this.deleteButtonRef,Text:n.LocalizedStrings.RecycleBin_Delete_Button,TextClassName:"fl-menu-text",Title:n.LocalizedStrings.RecycleBin_Delete_Text},c={ButtonStyle:"DarkBackGround",GlyphButtonStyle:"Vertical",IconClass:"RevToggleKey",Key:"restoreItem",onClick:function(){a.props.focusOut(g.findDOMNode(a)),a.onRestoreClick(),a.setState({ShowDialogControl:e.None})},Text:n.LocalizedStrings.RecycleBin_Restore_Button,TextClassName:"fl-menu-text",Title:n.LocalizedStrings.RecycleBin_Restore_Text},d=[b,c],f={ButtonsProps:d,ClassName:this.state.ShowDialogControl===e.KeyBoardControl?k("portal-view-form-card-copy-remove-container","enter"):"portal-view-form-card-copy-remove-container",HTMLAttributes:{onKeyDown:this.onKeyDown},key:"restoreRemoveDialog",onDismiss:this.setFocusOnCard,ShowDialog:this.state.ShowDialogControl===e.HoverControl||this.state.ShowDialogControl===e.KeyBoardControl,TrapFocus:!0};return l.createSimpleDialog(f)},b.prototype.getCardDescription=function(){return null},b.prototype.getCardThemeName=function(){var a=this.props.FormMaster;return a.isFieldReady(a.Schema.Theme)?a.ThemeMaster.Model.Name:null},b.prototype.getCardThemeBackgroupUrl=function(){var a=this.props.FormMaster;return a.isFieldReady(a.Schema.Theme)?a.ThemeMaster.Model.BackgroundImage:null},b.prototype.getCardThemePrimaryColor=function(){var a=this.props.FormMaster;return a.isFieldReady(a.Schema.Theme)?a.ThemeMaster.Model.PrimaryColor:null},b.prototype.getCardTitle=function(){return this.props.FormMaster.Model.Title},b.prototype.getCardResponseCount=function(){var a=this.props.FormMaster;return a.isFieldReady(m.Schema.ResponsesCount)&&a.Model.ResponsesCount?a.Model.ResponsesCount:0},b.prototype.createCardOwnerContent=function(){var a=this.props.FormMaster;if(a.isFieldReady(a.Schema.Category))switch(a.Model.Category){case"Poll":return f.createElement("div",{className:"fl-category-label fl-category-poll",key:"category-label",title:n.LocalizedStrings.OutlookAddin_FormCard_CategoryLabel});case"Teams Poll":return f.createElement("div",{className:"fl-category-label fl-category-poll",key:"category-label",title:n.LocalizedStrings.Teams_FormCard_CategoryLabel});case"assignments":return f.createElement("div",{className:"fl-category-label fl-category-assignments",key:"category-label",title:n.LocalizedStrings.Teams_Assignments_FormCard_CategoryLabel});default:return null}return null},b.prototype.createCardTypeContent=function(){return i.createFormCardType(this.props.FormMaster)},b.prototype.shouldShowSpinner=function(){var a=this.props.FormMaster;if(!a)return!1;if(a.Model.DeleteCollaborationPermission)return!0;var b=1;return a.isFieldReady(a.Schema.SoftDeleted)&&(b=a.Model.SoftDeleted),a.Deleted||0===b||!a.isFieldReady(m.Schema.Id)},b.prototype.createDeleteConfirmDialog=function(){var a=this;if(this.state.ShowDialogControl===e.ConfirmDeleteDialogShow){var b={ButtonStyle:"DarkBackGround",ClassName:"fl-menu-confirm-delete",GlyphButtonStyle:"Horizontal",Key:"deleteItem",onClick:function(){a.props.focusOut(g.findDOMNode(a)),a.onDeleteClick(),a.setState({ShowDialogControl:e.None})},Text:n.LocalizedStrings.PortalView_Continue_Button,Title:n.LocalizedStrings.RecycleBin_ContinueDelete_Text},c={ButtonStyle:"DarkBackGround",ClassName:"fl-menu-confirm-delete",GlyphButtonStyle:"Horizontal",Key:"cancelItem",onClick:function(){a.setState({ShowDialogControl:e.HoverControl})},Text:n.LocalizedStrings.PortalView_Cancel_Button,Title:n.LocalizedStrings.PortalView_Cancel_Text},d=[b,c],f={ButtonsProps:d,ClassName:"portal-view-form-card-delete-cancel-container",Description:n.LocalizedStrings.RecycleBin_MoveFormFromRecycle_Warning_Text,HTMLAttributes:{onKeyDown:this.onKeyDown},key:"deleteConfirmDialog",onBlur:this.setShowDialogControlStatusToDefault,onDismiss:this.setFocusOnCard,ShowDialog:this.state.ShowDialogControl===e.ConfirmDeleteDialogShow,TrapFocus:!0};return l.createSimpleDialog(f)}},b.prototype.setFocusOnCard=function(){if(this.cardButtonRef.current){var a=g.findDOMNode(this.cardButtonRef.current);a&&(a.classList.remove("enter"),a.focus())}this.setState({ShowDialogControl:e.HoverControl})},b.prototype.setFocusOnDeleteButton=function(){this.deleteButtonRef.current&&this.deleteButtonRef.current.focus()},b.prototype.setShowDialogControlStatusToDefault=function(){this.setState({ShowDialogControl:e.HoverControl})},b}(j.PortalViewCardBase);b.RecycleBinCardBase=o},function(a,b,c){"use strict";function d(a){if(a>0)return e.createElement("div",{className:"recyclebin-empty-placeholder",role:"status"});var b=f.LocalizedStrings.RecycleBin_Empty_Text;return e.createElement("div",{className:"recyclebin-empty-placeholder",role:"status"},e.createElement("div",null,e.createElement("img",{src:"../../Images/empty-recyclebin.png",className:"recyclebin-empty-placeholder-img"})),e.createElement("div",{"aria-label":b,className:"recyclebin-empty-placeholder-text",title:b},b))}Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=OfficeForm.Exports.Resources;b.createEmptyRecyclebinView=d},,,function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),c(21),c(50),c(119),c(59)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(3),h=c(1),i=c(120),j=OfficeForm.Exports.Resources,k=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.canvasRef=f.createRef(),b}return d(b,a),b.prototype.render=function(){if(this.isValidChart()){var a={className:"chart-control-container",tabIndex:-1};return a["aria-label"]=j.LocalizedStrings.ChartControl_GroupContainer,f.createElement("div",e({},a),this.createChartLegend(),this.createChartCanvas())}return null},b.prototype.componentDidMount=function(){this.updateChartDataView()},b.prototype.shouldComponentUpdate=function(a){return!g.isEqual(this.props,a)||!this.wasChartVisible},b.prototype.componentDidUpdate=function(){this.updateChartDataView()},b.prototype.componentWillUnmount=function(){this.destroyChart()},b.prototype.isValidChart=function(){return this.props.Labels&&this.props.Data&&this.props.Labels.length===this.props.Data.length&&this.props.Labels.length>0},b.prototype.destroyChart=function(){this.chartInstance&&(this.chartInstance.destroy(),this.chartInstance=null)},b.prototype.updateChartDataView=function(){if(this.isValidChart()){var a=this.canvasRef.current;if(this.wasChartVisible=$(a).is(":visible"),this.wasChartVisible){var b=a.getContext("2d");this.destroyChart(),this.chartInstance=new i.NPSChart(b,this.props.Score,{BorderColors:["#FF9224","#008272"],ScoreColors:["#B15509","#333333","#008272"]})}}},b.prototype.createChartLegend=function(){if(this.props.HasLegend){var a={className:"chart-control-legend",tabIndex:-1};return a["aria-label"]=j.LocalizedStrings.ChartControl_LegendGroup,f.createElement("div",e({},a),f.createElement("table",{className:"chart-control-legend-table"},f.createElement("tbody",null,this.createLegendBody())))}},b.prototype.createLegendBody=function(){var a=this;return this.props.Labels.map(function(b,c){return f.createElement("tr",{className:"nps-chart-control-legend-table-row",key:c},f.createElement("td",{role:"presentation",className:"chart-control-legend-label"},a.props.Labels[c]),f.createElement("td",{role:"presentation",className:"chart-control-legend-value"},a.props.Data[c]))})},b.prototype.createChartCanvas=function(){var a={className:"chart-control",tabIndex:-1};a["aria-label"]=j.LocalizedStrings.ChartControl_ChartValueForNPS.format(this.props.Score);var b={height:150,ref:this.canvasRef,role:"presentation",width:300};return f.createElement("div",e({},a),f.createElement("canvas",e({},b)))},b}(h.ReactComponent);Forms.UX.Analysis.NPSChartControl=k},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(3),e={ArrowAngle:60,ArrowHeight:12,BackgroundColor:"#F2F2F2",BorderColors:["#FF9224","#008272"],BorderWidth:12,Bottom:0,CircleMargin:3,Color:"#333333",FontFamily:"'wf_segoe-ui_normal','Segoe UI','Segoe WP',Tahoma,Arial,sans-serif",FontSize:12,LabelSize:15,ScoreColors:["#B15509","#333333","#008272"],ScoreFontFamily:"'wf_segoe-ui_semibold','Segoe UI Semibold','Segoe WP Semibold','Segoe UI','Segoe WP',Tahoma, Arial, sans-serif",ScoreFontSizes:[38,45],Top:16},f=.25,g=180,h=90,i=45,j=10,k=Math.PI*j/g,l=Math.PI*i/g,m=function(){function a(a,b,c){this.ctx=a,this.initialize(b,c),this.render(a)}return a.prototype.destroy=function(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)},a.prototype.initialize=function(a,b){this.configuration=d.extend({},e,b);var c=this.configuration,f=c.Color,g=c.FontSize,h=c.Top,i=c.Bottom,j=c.CircleMargin,k=c.BorderWidth,l=c.FontFamily;this.ctx.font=g+"px "+l,this.ctx.fillStyle=f,this.ctx.textAlign="center",this.ctx.textBaseline="middle";var m=this.ctx.canvas.width,n=this.ctx.canvas.height;this.innerRadius=Math.min((m-2*(k+j))/2,(n-h-k-2*j-i)/2);var o=this.innerRadius+h+j+k;this.ctx.translate(this.ctx.canvas.width/2,o),this.outerRadius=this.innerRadius+j+k,this.value=a},a.prototype.render=function(a){this.drawDoughts(a),this.drawScale(a),this.drawCenter(a)},a.prototype.drawScale=function(b){b.save();var c=Math.sin(k)*this.outerRadius,d=this.outerRadius+2;a.drawText(b,d,c,"+100","start","middle"),a.drawText(b,0,-d,"0","center","bottom"),a.drawText(b,-d,c,"-100","end","middle"),b.restore()},a.prototype.drawCenter=function(b){var c,d,e=this.configuration,f=e.ScoreColors,i=e.ScoreFontSizes;this.value>=0?(d=0!==this.value?f[2]:f[1],c=this.value-h):(d=f[0],c=this.value-h);var j;j=100===Math.abs(this.value)?i[0]:i[1];var k=a.fitScoreText(this.ctx,"100",this.innerRadius/Math.cos(l));j=Math.min(j,k);var m=Math.tan(this.configuration.ArrowAngle/2*Math.PI/g)*this.configuration.ArrowHeight;this.drawContent(b,this.value.toString(),c,this.innerRadius,this.configuration.ArrowHeight,m,j,d)},a.prototype.drawContent=function(b,c,d,e,g,h,i,j){a.drawDial(b,d,e,g,h,this.configuration.BackgroundColor),b.save(),a.drawText(b,0,this.innerRadius/2,"NPS",void 0,void 0,this.configuration.LabelSize+"px "+this.configuration.FontFamily),b.fillStyle=j,a.drawText(b,0,-f*i,c,void 0,void 0,"bold "+i+"px "+this.configuration.ScoreFontFamily),b.restore()},a.drawDial=function(a,b,c,d,e,f){var h=c+d;a.save(),a.fillStyle=f,a.rotate(b*Math.PI/g),a.beginPath(),a.moveTo(h,0);var i=e/c,j=Math.asin(i);a.arc(0,0,c,-j,j,!0),a.fill(),a.restore()},a.prototype.drawDoughts=function(b){var c=this.configuration,d=c.BorderWidth,e=c.BorderColors;a.drawDoughnut(b,0,0,k,Math.PI*-h/g,this.outerRadius,d,e[1],!0),a.drawDoughnut(b,0,0,Math.PI*-h/g,Math.PI*-(j+g)/g,this.outerRadius,d,e[0],!0),b.clearRect(-1,-this.outerRadius,2,d)},a.fitScoreText=function(a,b,c){a.save();var d=14;for(a.font="bold "+d+"px Arial";a.measureText(b).width<c;)d++,a.font="bold "+d+"px Arial";return a.restore(),d},a.drawDoughnut=function(a,b,c,d,e,f,g,h,i){a.save(),a.beginPath(),a.fillStyle=h,a.arc(b,c,f,d,e,i),a.save(),a.rotate(e),a.lineTo(f-g,0),a.restore(),a.arc(b,c,f-g,e,d,!i),a.fill(),a.restore()},a.drawText=function(a,b,c,d,e,f,g){e&&(a.textAlign=e),f&&(a.textBaseline=f),g&&(a.font=g),a.fillText(d,b,c)},a}();b.NPSChart=m},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),c(21),c(42),c(60),c(50),c(43),c(122),c(123),c(124),c(125),c(61),c(44),c(90),c(91),c(127),c(130),c(57),c(92),c(62),c(64),c(85),c(139),c(141),c(142),c(98),c(99),c(65),c(144),c(145),c(146),c(148),c(149),c(152),c(153),c(103),c(154),c(105),c(155),c(156),c(157),c(158),c(25),c(67),c(46),c(159),c(160),c(101),c(164),c(165),c(166),c(167),c(168),c(170),c(173),c(174),c(175),c(176),c(177),c(178),c(179),c(180),c(181),c(182),c(187),c(188),c(190),c(110),c(111),c(112),c(193),c(194),c(195),c(113),c(196),c(197),c(198),c(199),c(88),c(87),c(200),c(201),c(202),c(204),c(206),c(89),c(207),c(54),c(70),c(71),c(72),c(73),c(74),c(48),c(75),c(76),c(77),c(78),c(79),c(208),c(80),c(209),c(81),c(49),c(33),c(118),c(36)},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=OfficeForm.Exports.DataProvider,e="Intelligence.GetInsights",f="Intelligence.GetDefaultInsights",g="Ingelligence.GetOptionToOptionSuggestion",h=function(){function a(a,b,c,d,e){c&&d&&e?this.ownerServiceUrl=a+"intelligence/api/"+c+"/"+e+"/"+d+"/":this.ownerServiceUrl=a+"intelligence/api/",this.tokenRetriever=b}return a.prototype.getInsights=function(a,b,c){return this.sendRequestWithToken({method:"GET",qosEventName:e,requestUri:this.ownerServiceUrl+("forms('"+a+"')/getinsights("+b+","+c+")")})},a.prototype.getDefaultInsights=function(a){return this.sendRequestWithToken({method:"GET",qosEventName:f,requestUri:this.ownerServiceUrl+("forms('"+a+"')/defaultinsights")})},a.prototype.getOptionToOptionSuggestion=function(a){return this.sendRequestWithToken({body:JSON.stringify({existingOptions:a}),method:"POST",qosEventName:g,requestUri:this.ownerServiceUrl+"getOptionToOptionSuggestion"})},a.prototype.textAnalyze=function(a){var b=256;return this.textAnalyzeWithFeatures(b,a)},a.prototype.textAnalyzeWithFeatures=function(a,b){if(!b){var c={Features:0,Results:[]};return $.Deferred().resolve(c).promise()}return this.sendRequestWithToken({body:JSON.stringify({Features:a,Text:b}),method:"POST",qosEventName:"Question.TextAnalysis",qosExtraData:{Features:a},requestUri:this.ownerServiceUrl+"textanalysis3"})},a.prototype.sendRequestWithToken=function(b,c){return this.tokenRetriever.getToken().then(function(e){return b.headers=$.extend(!0,b.headers,a.getCommonHeaders(e||"")),d.OData.send(b,c).then(function(a){return a?d.OData.ResponseHandler.parseResponseDataValue(a):$.Deferred().reject().promise()},d.OData.ResponseHandler.parseAndTryHandleError)})},a.getCommonHeaders=function(a){return{__RequestVerificationToken:OfficeFormServerInfo.antiForgeryToken,Accept:"application/json",Authorization:a?"Bearer "+a:"","Content-Type":"application/json"}},a}();b.IntelligenceProvider=h,Forms.DataProvider.IntelligenceProvider=h},function(a,b,c){"use strict";function d(){return i}function e(){return OfficeForm.Exports.Flighting.Flight.isEnabled(OfficeForm.Exports.Flighting.Flights.EnableExperimentationClient)}Object.defineProperty(b,"__esModule",{value:!0});var f=c(2),g=OfficeForm.Exports.DataProvider,h=function(){function a(){}return a.prototype.initialize=function(){var a=this;return e()?(this.provider=g.createDataProvider(),this.provider.experimentationGetVariations().then(function(b){a.variations=b,f.log({eventName:"Experiment.Initialize",eventType:"engagement_event",extraData:{Variations:b}})})):null},a.prototype.activate=function(a){var b=this;if(e()&&(this.provider.experimentationActivate(a).then(function(c){c!==(b.variations&&b.variations[a])&&f.log({eventName:OfficeForm.Exports.ClientErrorNames.VariationMismatachError,eventType:"error_event",extraData:{ExperimentKey:a}}),f.log({eventName:"Experiment.Activate",eventType:"engagement_event",extraData:{ExperimentKey:a}})}),this.variations)){var c=this.variations[a];return c}return null},a.prototype.track=function(a,b){e()&&this.provider.experimentationTrack(a,b).then(function(){f.log({eventName:"Experiment.Track",eventType:"engagement_event",extraData:{ExperimentKey:a}})})},a}();b.ExperimentController=h;var i=new h;Forms.Experimentation.getExperimentController=d},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(1),g=OfficeForm.Exports.Resources,h=OfficeForm.Exports.Control,i=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.render=function(){var a=this.props.formula;if(""===a)return e.createElement("div",{className:"gradingQuestionNoAnswerGiven"},g.LocalizedStrings.GradingView_NoAnswerGiven_Label);if(void 0!==this.props.specialCorrectnessStyle){var b=void 0,c=void 0,d="",f=" gradingOptionCorrectnessIcon forms-icon-size16x16";"correct"===this.props.specialCorrectnessStyle?(b="gradingOptionIsCorrect",c={HTMLAttributes:{"aria-hidden":!0,className:"office-form-right-answerkey office-form-answerkey"+f,role:"presentation"},IconName:"CheckMark"},d=g.LocalizedStrings.GradingView_CorrectAnswer_AccessibilityLabel):(b="gradingOptionIsNotCorrect",c={HTMLAttributes:{"aria-hidden":!0,className:"office-form-wrong-answerkey office-form-answerkey"+f,role:"presentation"},IconName:"Cancel"},d=g.LocalizedStrings.GradingView_IncorrectAnswer_AccessibilityLabel);var i=h.createFontIconControl(c);return e.createElement("div",{className:"gradingPlainTextAnswer gradingShortTextAnswerCorrectnessBox "+b},h.createFormulaRenderer({Formula:a}),e.createElement("a",{className:"screenReaderVisible"},d),i)}return e.createElement("span",{className:"gradingPlainTextAnswer"},h.createFormulaRenderer({Formula:a}))},b}(f.ReactComponent);b.FormulaAnswer=i,Forms.Grading.FormulaAnswer=i},function(a,b,c){"use strict";function d(a){return g.createElement(k,f({},a))}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),f=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});
var g=c(0),h=c(56),i=c(1),j=OfficeForm.Exports.Resources;b.createNPSAnswer=d;var k=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return e(b,a),b.prototype.render=function(){var a=this.props.Answer.Answer;if(!a&&0!==a)return g.createElement("div",{className:"gradingQuestionNoAnswerGiven"},j.LocalizedStrings.GradingView_NoAnswerGiven_Label);var b=Number(""+a);return g.createElement("div",null,g.createElement(h.NPSControl,{ClassNameForInnerLabel:"office-form-theme-button-foreground",Disabled:!0,LeftLabel:this.props.LeftDescription,RightLabel:this.props.RightDescription,Value:b}),g.createElement("a",{className:"screenReaderVisible"},j.LocalizedStrings.GradingView_NPSAnswerFormat.format(1)))},b}(i.ReactComponent);b.NPSAnswer=k,Forms.Grading.createNPSAnswer=d},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=OfficeForm.Exports.Models,e=function(){function a(a){this.master=a,this.dataProvider=d.FormDataSource.getDataProviderByFormMaster(this.master.Form)}return a.prototype.add=function(a){throw Error("No scenario to call this method currently.")},a.prototype["delete"]=function(a){throw Error("No scenario to call this method currently.")},a.prototype.query=function(a){throw Error("No scenario to call this method currently.")},a.prototype.update=function(a,b){if(!b.ValuesBefore||this.master.Form.SyncContext!==d.FormSyncContext.DesignTimeForm)return $.Deferred().resolve().promise();if(a.choiceId||void 0===a.description)throw Error("No valid payload to update.");var c={elementKey:"choiceid_"+this.master.ChoiceId,elementValue:a.description,locale:this.master.LocaleId,questionId:this.master.QuestionId},e=null!==b.ValuesBefore.description;return e?this.dataProvider.updateLocaleItem(this.master.FormId,c):this.dataProvider.createLocaleItem(this.master.FormId,c)},a}();b.ChoiceLocalizedItemDataSource=e},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(3),f=c(4),g=c(57),h=c(128),i=c(92),j=f.Spec,k={formCloseMessage:j.string(),localeId:j.string({IsKeyField:!0}),localeName:j.string(),questionResources:j.collectionOf(function(){return i.QuestionLocalizedItemMaster}),subtitle:j.string(),thankYouMessage:j.string(),title:j.string()},l=function(a){return new h.FormLocalizedItemDataSource(a)},m=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),Object.defineProperty(b.prototype,"Form",{get:function(){return this.Parent.Parent},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"FormId",{get:function(){return this.Form.Model.Id},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"LocaleId",{get:function(){return this.Model.localeId},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"LocaleName",{get:function(){return this.Model.localeName},enumerable:!0,configurable:!0}),b.getFormResourceMaster=function(a,b){var c=e.find(b.Model.LocalizedResources,function(b){return b.localeId===a});if(c)return f.getObjectMasterFromModel(c);throw Error("This locale does not exist in form.")},b.getQuestionResourceMaster=function(a,b,c){var d=c.Model.LocalizedResources,e=f.Collection.getItemWithKeyFields(d,{localeId:a});if(e){if(e.questionResources||(e.questionResources=[]),e.questionResources.length>0){var h=f.Collection.getItemWithKeyFields(e.questionResources,{localeId:a,questionId:b});if(h)return f.getObjectMasterFromModel(h)}return g.createEmptyQuestionLocalizedResource({localeId:a,localeName:e.localeName},b,e,c)}throw Error("This locale does not exist in form.")},b}(f.createObjectMasterClass("FormLocalizedItemMaster",k,l));b.FormLocalizedItemMaster=m,Forms.Models.FormLocalizedItemMaster=m},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(3),e=c(57),f=OfficeForm.Exports.Models,g=function(){function a(a){this.master=a,this.dataProvider=f.FormDataSource.getDataProviderByFormMaster(this.master.Form)}return a.prototype.add=function(a){throw Error("No scenario to call this method currently.")},a.prototype["delete"]=function(a){throw Error("No scenario to call this method currently.")},a.prototype.query=function(a){throw Error("No scenario to call this method currently.")},a.prototype.update=function(a,b){if(!b.ValuesBefore||this.master.Form.SyncContext!==f.FormSyncContext.DesignTimeForm)return $.Deferred().resolve().promise();var c,g=[];for(c in a)if(a.hasOwnProperty(c)){var h=null!==b.ValuesBefore[c],i=e.parseFormLocalizedItem(d.pick(a,[c]));i.locale=this.master.Model.localeId,i.questionId="",g.push(h?this.dataProvider.updateLocaleItem(this.master.FormId,i):this.dataProvider.createLocaleItem(this.master.FormId,i))}return $.when.apply($,g).then(function(a){})},a}();b.FormLocalizedItemDataSource=g},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(3),e=c(57),f=OfficeForm.Exports.Models,g=function(){function a(a){this.master=a,this.dataProvider=f.FormDataSource.getDataProviderByFormMaster(this.master.Form)}return a.prototype.add=function(a){throw Error("No scenario to call this method currently.")},a.prototype["delete"]=function(a){throw Error("No scenario to call this method currently.")},a.prototype.query=function(a){throw Error("No scenario to call this method currently.")},a.prototype.update=function(a,b){if(!b.ValuesBefore||this.master.Form.SyncContext!==f.FormSyncContext.DesignTimeForm)return $.Deferred().resolve().promise();var c,g=[];for(c in a)if(a.hasOwnProperty(c)){var h=null!==b.ValuesBefore[c],i=e.parseQuestionLocalizedItem(d.pick(a,[c]));i.locale=this.master.Model.localeId,i.questionId=this.master.QuestionId,g.push(h?this.dataProvider.updateLocaleItem(this.master.FormId,i):this.dataProvider.createLocaleItem(this.master.FormId,i))}return $.when.apply($,g).then(function(a){})},a}();b.QuestionLocalizedItemDataSource=g},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(4),f=c(131),g=e.Spec,h={localeId:g.string({IsKeyField:!0}),localeName:g.string()},i=function(a){return new f.LocaleInfoDataSource(a)},j=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),Object.defineProperty(b.prototype,"Form",{get:function(){return this.Parent.Parent},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"FormId",{get:function(){return this.Form.Model.Id},enumerable:!0,configurable:!0}),b}(e.createObjectMasterClass("LocaleInfoMaster",h,i));b.LocaleInfoMaster=j,Forms.Models.LocaleInfoMaster=j},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=OfficeForm.Exports.Models,e=function(){function a(a){this.master=a,this.dataProvider=d.FormDataSource.getDataProviderByFormMaster(this.master.Form)}return a.prototype.add=function(a){if(!a.localeId||!a.localeName||this.master.Form.SyncContext!==d.FormSyncContext.DesignTimeForm)return $.Deferred().resolve().promise();var b={elementKey:"localename",elementValue:a.localeName,locale:a.localeId,questionId:""};return this.dataProvider.createLocaleItem(this.master.FormId,b)},a.prototype["delete"]=function(a){return a.localeId&&this.master.Form.SyncContext===d.FormSyncContext.DesignTimeForm?this.dataProvider.deleteLocale(this.master.FormId,a.localeId):$.Deferred().resolve().promise()},a.prototype.query=function(a){throw Error("No scenario to call this method currently.")},a.prototype.update=function(a,b){if(!b.ValuesBefore||!a.localeName||this.master.Form.SyncContext!==d.FormSyncContext.DesignTimeForm)return $.Deferred().resolve().promise();var c=null!==b.ValuesBefore.localeName,e={elementKey:"localename",elementValue:a.localeName,locale:this.master.Model.localeId,questionId:null};return c?this.dataProvider.updateLocaleItem(this.master.FormId,e):this.dataProvider.createLocaleItem(this.master.FormId,e)},a}();b.LocaleInfoDataSource=e},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(93),f=c(22),g=c(63),h=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.queryValue=function(){return this.DataProvider.getCurrentUserPhotoValue().then(function(a){return{value:a}})},b.prototype.queryDefinition=function(){throw new Error("NotSupportQueryOfCurrentUserPhotoDefinition")},b}(g.PhotoDataSource);b.CurrentUserPhotoDataSource=h,f.registerDataSourceFactory(function(a){return a instanceof e.CurrentUserPhotoMaster?new h(a):null})},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(94),f=c(22),g=c(63),h=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.queryValue=function(){return this.DataProvider.getFormCreatorPhotoValue(this.Master.TypicalFormId).then(function(a){return{value:a}})},b.prototype.queryDefinition=function(){return this.DataProvider.getFormCreatorPhotoDefinition(this.Master.TypicalFormId)},b}(g.PhotoDataSource);b.FormOwnerPhotoDataSource=h,f.registerDataSourceFactory(function(a){return a instanceof e.FormOwnerPhotoMaster?new h(a):null})},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(95),f=c(22),g=c(63),h=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.queryValue=function(){return this.DataProvider.getGroupMemberPhotoValue(this.Master.GroupId,this.Master.MemberId).then(function(a){return{value:a}})},b.prototype.queryDefinition=function(){return this.DataProvider.getGroupMemberPhotoDefinition(this.Master.GroupId,this.Master.MemberId)},b}(g.PhotoDataSource);b.GroupMemberPhotoDataSource=h,f.registerDataSourceFactory(function(a){return a instanceof e.GroupMemberPhotoMaster?new h(a):null})},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(96),f=c(22),g=c(63),h=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.queryValue=function(){return this.DataProvider.getGroupPhotoValue(this.Master.GroupId).then(function(a){return{value:a}})},b.prototype.queryDefinition=function(){return this.DataProvider.getGroupPhotoDefinition(this.Master.GroupId)},b}(g.PhotoDataSource);b.GroupPhotoDataSource=h,f.registerDataSourceFactory(function(a){return a instanceof e.GroupPhotoMaster?new h(a):null})},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(3),e=c(4),f=c(97),g=function(){function a(){}return a.prototype.add=function(){throw Error("No scenario to call this method currently.")},a.prototype["delete"]=function(a){throw Error("No scenario to call this method currently.")},a.prototype.update=function(){throw Error("No scenario to call this method currently.")},a.prototype.query=function(a,b){var c=e.getFieldSchemaInfo(f.FormReferenceMaster.Schema.id).Name;if(!d.isEqual(a,[c]))throw Error("No scenario to call this method currently.");var g=b.Master.FormMaster;return g.ensureFieldsReady([g.Schema.Id]).then(function(){return{id:g.Model.Id}})},a}();b.FormReferenceDataSource=g},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(3),e=c(62),f=OfficeForm.Exports.DataProvider,g=function(){function a(a){this.group=a,this.dataProvider=f.createGroupDataProvider(this.group.Model.id)}return a.prototype.add=function(a){throw Error("No scenario to call this method currently.")},a.prototype["delete"]=function(a){throw Error("No scenario to call this method currently.")},a.prototype.update=function(a,b){return $.Deferred().promise()},a.prototype.query=function(a){var b=[],c=e.GroupMaster.Schema,f=Nerve.getFieldSchemaInfo(c.formReferences).Name,g=Nerve.getFieldSchemaInfo(c.members).Name,h=Nerve.getFieldSchemaInfo(c.owners).Name,i=Nerve.getFieldSchemaInfo(c.classification).Name,j=Nerve.getFieldSchemaInfo(c.visibility).Name,k=Nerve.getFieldSchemaInfo(c.emailAddress).Name,l=Nerve.getFieldSchemaInfo(c.isFavorite).Name;if(a.indexOf(f)<0&&a.indexOf(g)<0&&a.indexOf(h)<0&&a.indexOf(i)<0&&a.indexOf(j)<0&&a.indexOf(k)<0&&a.indexOf(l)<0)throw Error("No scenario to call this method currently.");if(a.indexOf(f)>-1){var m=this.dataProvider.getForms(["id","title","modifiedDate","ownerId","ownerTenantId","softDeleted","category"]).then(function(a){return{formReferences:a}});b.push(m)}if(a.indexOf(g)>-1){var m=this.dataProvider.getGroupMembers(this.group.Model.id).then(function(a){return{members:a}});b.push(m)}if(a.indexOf(h)>-1){var m=this.dataProvider.getGroupOwners(this.group.Model.id).then(function(a){return{owners:a}});b.push(m)}if(a.indexOf(i)>-1||a.indexOf(k)>-1||a.indexOf(l)>-1||a.indexOf(j)>-1){var m=this.dataProvider.getGroup(this.group.Model.id).then(function(a){return{classification:a&&a.classification,emailAddress:a&&a.emailAddress,isFavorite:a&&a.isFavorite,visibility:a&&a.visibility}});b.push(m)}return $.when.apply($,b).then(function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return d.extend.apply(d,[{}].concat(a))})},a}();b.GroupDataSource=g},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(3),e=c(62),f=c(85),g=OfficeForm.Exports.DataProvider,h=function(){function a(a){this.dataProvider=g.createDataProvider()}return a.prototype.add=function(a){throw Error("No scenario to call this method currently.")},a.prototype["delete"]=function(a){throw Error("No scenario to call this method currently.")},a.prototype.update=function(a){throw Error("No scenario to call this method currently.")},a.prototype.query=function(a){var b=Nerve.getFieldSchemaInfo(f.MyGroupsMaster.Schema.groups).Name;if(1!==a.length||a[0]!==b)throw Error("The fields didn't exist.");return this.dataProvider.getGroups().then(function(a){var b=e.GroupMaster.Schema,c=[b.displayName,b.id].map(function(a){return Nerve.getFieldSchemaInfo(a).Name});return a=a.map(function(a){return d.pick(a,c)}),{groups:a}})},a}();b.MyGroupsDataSource=h},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(4),f=c(140),g=e.Spec,h={SampleFormStates:{PartyInvite:g.string()}},i=function(a){return new f.UserSettingsDataSource(a)},j=function(a){function b(){return a.call(this,{ExistingInDataSource:!0})||this}return d(b,a),b.getInstance=function(){return this.instance||(this.instance=new b),this.instance},b}(e.createObjectMasterClass("UserSettings",h,i));b.UserSettingsMaster=j,Forms.Models.UserSettingsMaster=j},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=OfficeForm.Exports.DataProvider,e=function(){function a(a){this.dataProvider=d.createDataProvider()}return a.prototype.add=function(a){throw Error("No scenario to call this method currently.")},a.prototype["delete"]=function(a){throw Error("No scenario to call this method currently.")},a.prototype.update=function(a,b){return this.dataProvider.updateUserSettings(JSON.stringify(b.Snapshot))},a.prototype.query=function(a){return this.dataProvider.getUserSettings().then(OfficeForm.Exports.Utilities.tryParseJson)},a}();b.UserSettingsDataSource=e},function(a,b,c){"use strict";function d(a){a.Model.Title=e(a.Model.Title),r.concatToFormList(a)}function e(a){var b=h.getUxStateMaster(),c=g.convertToArray(b.Model.FormList).map(function(a){return a.Model.Title}),d=g.convertToArray(b.Model.PlaceholderList).map(function(a){return a.Title});return j.getUniqueNameFromList(a,p.LocalizedStrings.Designer_Title_autoRenameFormat,c.concat(d))}Object.defineProperty(b,"__esModule",{value:!0});var f=c(3),g=c(4),h=c(61),i=c(2),j=OfficeForm.Exports.AutoRename,k=OfficeForm.Exports.DataProvider,l=OfficeForm.Exports.EngagementEventNames,m=OfficeForm.Exports.EnvironmentConfig,n=OfficeForm.Exports.EnvironmentSettings,o=OfficeForm.Exports.Models,p=OfficeForm.Exports.Resources,q=OfficeForm.Exports.Utilities,r=function(){function a(){this.createForm=this.createForm.bind(this),this.deleteForm=this.deleteForm.bind(this),this.duplicateForm=this.duplicateForm.bind(this),this.restoreFromRecycleBin=this.restoreFromRecycleBin.bind(this),this.moveToRecycleBin=this.moveToRecycleBin.bind(this),this.changeFormOwner=this.changeFormOwner.bind(this)}return a.triggerReadProcess=function(b,c){var d=h.getUxStateMaster().Model;if(!d.FormId)return"NotStarted"===d.FormListLoadState&&a.getAllForms(!b,c),void(b||OfficeFormServerInfo.userInfo.IsMsa||(m.isUSGovGccProd()||a.getGroupMruForms(),"NotStarted"===d.SharedWithMeFormListLoadState&&a.getFormSharedWithMe()));if(!d.FormMaster||d.FormMaster.isFieldReady(o.FormMaster.Schema.Id)&&d.FormMaster.Model.Id!==d.FormId){var e={Id:d.FormId},f=a.updateOrCreateFormMaster(e);f.ensureReadyToDesign(),d.FormMaster=f}},a.getDeletedUserByIdorEmail=function(a){var b=k.ProviderManager.getInstance().createDataProvider();return b.getDeletedUserByIdOrEmail(a)},a.addDefaultHeader=function(a,b){k.FormApi.addDefaultHeader(a,b)},a.concatToFormList=function(a){var b=h.getUxStateMaster().Model;a.Model.OwnerId===OfficeFormServerInfo.userInfo.UserId&&(b.FormList=g.Collection.addItems(b.FormList,[a]))},a.getFormsTenantSettings=function(){var a=k.ProviderManager.getInstance().createDataProvider();return a.getFormsTenantSettings().then(function(a){h.getUxStateMaster().Model.FormsTenantSettings=a},function(a){i.log({eventName:"TenentSettingsGetFailure",eventType:"error_event",extraData:a})})},a.duplicateExcelForm=function(b,c){var d=h.getUxStateMaster().Model;return o.FormDataSource.duplicateExcelForm(b,c).fail(function(a){return d.CriticalError=a}).then(function(b){return b&&a.updateOrCreateFormMaster(b)})},Object.defineProperty(a.prototype,"GroupMruDocumentManager",{get:function(){return a.GroupMruDocumentManager},enumerable:!0,configurable:!0}),a.prototype.createForm=function(b,c){var d=a.updateOrCreateFormMaster(b,c);return a.concatToFormList(d),d},a.prototype.duplicateForm=function(b,c){var d=h.getUxStateMaster(),f=e(b.Model.Title),g={Modified:(new Date).toUTCString(),OwnerId:c.OwnerId,OwnerTenantId:c.OwnerTenantId,Title:f};return a.concatToPlaceholderList(g),b.duplicateForm(c,f).then(function(b){return d.bulkEdit(function(){a.removeFromPlaceholderList(g),b&&a.concatToFormList(b)}),b},function(){return a.removeFromPlaceholderList(g)})},a.prototype.designForm=function(a){var b=h.getUxStateMaster(),c=b.Model;i.log({eventName:l.DesignPage.Form.Navigate,eventType:"engagement_event",extraData:{isGroupForm:a.IsGroupForm,myForm:a.Model.OwnerId===OfficeFormServerInfo.userInfo.UserId}}),b.bulkEdit(function(){c.Analysis=!1,c.Grading=void 0,c.FormId=void 0,c.FormMaster=a,a.existingOnServerSide().then(function(){c.FormMaster===a&&(c.FormId=a.Model.Id)})})},a.prototype.moveToRecycleBin=function(a,b){var c=this,d=a.formOwnedByMe();return a.moveToRecycleBin().done(function(){var b=h.getUxStateMaster().Model;d&&(b.RecycleBin=g.Collection.addItems(b.RecycleBin,[a]),b.FormList=f.without(b.FormList,a)),c.GroupMruDocumentManager.removeDocument(a.Model.Id)})},a.prototype.restoreFromRecycleBin=function(a){var b=this,c=a.formOwnedByMe();return a.Model.SoftDeleted=o.FormDeletedState.Normal,a.Synchronizer.flush().then(function(){var d=h.getUxStateMaster().Model;c&&(d.RecycleBin=f.without(d.RecycleBin,a),d.FormList=g.Collection.addItems(d.FormList,[a])),b.GroupMruDocumentManager.removeDocument(a.Model.Id)})},a.prototype.deleteForm=function(a){var b=this,c=a.formOwnedByMe();if(!c&&!a.IsGroupForm){a.Model.DeleteCollaborationPermission=!0;var d=o.FormDataSource.getDataProviderByFormMaster(a);return d.deletePermissionLink(a.Model.Id,OfficeFormServerInfo.userInfo.UserId).done(function(){a.Model.DeleteCollaborationPermission=!1;var b=h.getUxStateMaster().Model;b.SharedWithMeFormList=f.without(b.SharedWithMeFormList,a)})}return a.Deleted=!0,a.Synchronizer.flush().then(function(){var d=h.getUxStateMaster().Model;c&&(d.RecycleBin=f.without(d.RecycleBin,a)),a.IsGroupForm&&b.removeFromMRU(a)})},a.prototype.changeFormOwner=function(a,b){var c=o.FormDataSource.getDataProviderByFormMaster(a);return a.Model.TransferInProgress=!0,c.moveForm(a.Model.Id,b.OwnerId,b.IsGroupForm).always(function(){return a.Model.TransferInProgress=!1}).done(function(b){a.Synchronizer.onDeletedInDataSource();var c=h.getUxStateMaster().Model;c.FormList=f.without(c.FormList,a)}).fail(function(a){return h.getUxStateMaster().Model.CriticalError=a}).then(function(a){var b=null;return a&&(b={category:a.category,id:a.id,instanceId:void 0,modifiedDate:a.modifiedDate,ownerId:a.ownerId,ownerTenantId:a.ownerTenantId,softDeleted:a.softDeleted,title:a.title}),b})},a.prototype.removeFromMRU=function(a){var b=this,c=o.FormDataSource.getDataProviderByFormMaster(a);return c.removeRecentForm(a.Model.Id).then(function(){b.GroupMruDocumentManager.removeDocument(a.Model.Id)})},a.concatToPlaceholderList=function(a){var b=h.getUxStateMaster().Model;b.PlaceholderList=g.Collection.addItems(b.PlaceholderList,[a])},a.removeFromPlaceholderList=function(a){var b=h.getUxStateMaster().Model,c=g.convertToArray(b.PlaceholderList),d=c.indexOf(a);d>=0&&(c.splice(d,1),b.PlaceholderList=c)},Object.defineProperty(a,"GroupMruDocumentManager",{get:function(){return Forms.Mru.MruDocumentManager.getInstance()},enumerable:!0,configurable:!0}),a.getAllForms=function(b,c){var d=h.getUxStateMaster(),e=d.Model;e.FormListLoadState="Loading";var j=o.FormMaster.Schema,k=[j.Id,j.Title,j.Modified,j.Settings,j.XlWorkbookId,j.OwnerId,j.OwnerTenantId,j.Category,j.Theme,j.SoftDeleted],m=o.FormDataSource.getAllForms(k,c),n=b?o.FormDataSource.getAllFormsResponseCount():null;return m.fail(function(a){return e.CriticalError=a}).then(function(b){d.bulkEdit(function(){e.FormListLoadState="Loaded";var c=[];if(b&&(c=b.map(function(b){return a.updateOrCreateFormMaster(b)})),n){var d=n;c.forEach(function(a){var b=d.then(function(b){var c=[];if(b&&(c=b.filter(function(b){return b.id===a.Model.Id})),0===c.length){var d=new Error("Response count not found in the list.");return $.Deferred().reject(d).promise()}return{rowCount:c[0].responseCount}});a.Synchronizer.setFieldsQueryJob([a.Schema.RowCount],b)})}e.FormList=f.uniq(g.Collection.addItems(e.FormList,c.filter(function(a){return a.isNotSoftDeleted()}))),e.RecycleBin=f.uniq(g.Collection.addItems(e.RecycleBin,c.filter(function(a){return a.isSoftDeleted()}))),i.log({eventName:l.PortalPage.MyForms.FormCount,eventType:"engagement_event",extraData:{count:e.FormList.length,softDeletedCount:e.RecycleBin.length}})})})},a.getFormSharedWithMe=function(){var b=h.getUxStateMaster(),c=b.Model;return c.SharedWithMeFormListLoadState="Loading",o.FormDataSource.getAllSharedWithMeForms().fail(function(a){return c.CriticalError=a}).then(function(d){b.bulkEdit(function(){c.SharedWithMeFormListLoadState="Loaded";var b=[];d&&(b=d.map(function(b){return a.updateOrCreateFormMaster(b)})),c.SharedWithMeFormList=f.uniq(g.Collection.addItems(c.SharedWithMeFormList,b)),i.log({eventName:l.PortalPage.OtherForms.FormCount,eventType:"engagement_event",extraData:{count:c.SharedWithMeFormList.length}})})})},a.getGroupMruForms=function(){var b=h.getUxStateMaster(),c=b.Model;"NotStarted"===c.GroupMruFormListLoadState&&(c.GroupMruFormListLoadState="Loading",a.GroupMruDocumentManager.initializeFormList().then(function(){return c.GroupMruFormListLoadState="Loaded"}))},a.updateOrCreateFormMaster=function(b,c){void 0===c&&(c=!1);var d=b.Id&&a.allFormsWithId[b.Id];if(d){var e=g.convertToSourceData(b,o.FormMaster.Schema);return d.Synchronizer.onSourceDataReceived(e),d}b.Id||(b=f.clone(b),c?(b.XlWorkbookId=b.XlWorkbookId||q.ExcelHelper.waitingForExport,b.OwnerId=b.OwnerId||n.GroupId,b.OwnerTenantId=b.OwnerTenantId||n.TenantId):(b.OwnerId=b.OwnerId||OfficeFormServerInfo.userInfo.UserId,b.OwnerTenantId=OfficeFormServerInfo.userInfo.TenantId));var h=o.createDesignFormMaster(b,c);return h.existingOnServerSide().done(function(){return a.allFormsWithId[h.Model.Id]=h}),h},a.allFormsWithId={},a}();b.dataProviderAdapterConcatToFormList=d,b.getUniqueFormName=e},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(3),e=OfficeForm.Exports.Utilities;(function(){function a(a){var b=this;this.master=a,this.defaultParameters={Action:"NoAction",Analysis:!1,FlexPane:"None",FormId:void 0,Grading:void 0,Host:void 0,Preview:void 0,Store:!1,Title:void 0,Token:void 0,TopView:"None",XlWorkbookId:void 0},this.readHashValues(),this.writeHashValues(!0),$(window).on("hashchange",this.readHashValues.bind(this)),this.master.observe(function(c){var e=d.intersection(c.FieldSchemas,[a.Schema.Action,a.Schema.Title,a.Schema.XlWorkbookId]);b.writeHashValues(e.length>0)},this.Keys)}return Object.defineProperty(a.prototype,"Keys",{get:function(){var a=this.master.Schema;return[a.Action,a.Analysis,a.FormId,a.FlexPane,a.Grading,a.Host,a.Preview,a.Store,a.Title,a.Token,a.TopView,a.XlWorkbookId]},enumerable:!0,configurable:!0}),a.prototype.readHashValues=function(){var a=this.getHashFromCurrentUrl();this.master.setData(a,this.Keys)},a.prototype.writeHashValues=function(a){var b=this,c=this.Keys,f=d.pick(this.master.Model,c);if(!d.isEqual(f,this.getHashFromCurrentUrl())){var g=c.filter(function(a){return!d.isEqual(b.master.getModelByFieldSchema(a),b.defaultParameters[a])}).map(function(a){var c=b.master.getModelByFieldSchema(a);return e.Type.isString(c)||(c=JSON.stringify(c)),a+"="+encodeURIComponent(c)}).join("&");a?Forms.Common.replaceUrl(window.location.href.split("#")[0]+"#"+g):window.location.hash=g}},a.prototype.getHashFromCurrentUrl=function(){var a=this.Keys,b=a.map(function(a){return Nerve.getFieldSchemaInfo(a).Name.toLowerCase()}),c=d.clone(this.defaultParameters),f=["Analysis","Grading","Preview","TopViewEnum"],g=(window.location.hash||"").substring(1);return g.split("&").forEach(function(g){var h=g.split("="),i=b.indexOf(h[0].trim().toLowerCase()),j=a[i];if(j){var k=decodeURIComponent(h[1]||"undefined").trim();d.include(f,j)&&(k=e.tryParseJson(k)),c[j]=k}}),c},a})()},function(a,b,c){"use strict";function d(){return{Background:{AltText:"",ContentType:"image/jpeg",FileIdentifier:"f32cdb95-7c60-42aa-a54b-8754709cb035",Height:null,IsPredefined:!0,OriginalFileName:"142f32eb-53ee-41ad-a5dc-b8b5505cff07",ResourceId:"3e003a08-5950-4636-9994-2e3b867a4ad0",ResourceUrl:f.Html.getAbsoluteUrl("../../Images/Theme/partyInvite.png"),Width:null},ModifiedDate:(new Date).toUTCString(),OtherInfo:'{"PrimaryCustomizedThemeColor":"#A83A94","SecondaryCustomizedThemeColor":"#8F327E","TertiaryCustomizedThemeColor":"#F2E6F0","Theme":{"Name":"Customized Theme"}}',OwnerId:OfficeFormServerInfo.userInfo.UserId,OwnerTenantId:OfficeFormServerInfo.userInfo.TenantId,Questions:[{Id:"r74ca5ff0d4234d1da74d5f1e65824e0c",IsAnswerPlainText:!0,IsFromSuggestion:!1,IsMathQuiz:!1,IsQuiz:!1,Order:600,Required:!1,Title:e.LocalizedStrings.SampleForm_PartyInvite_Question1_Title,TrackingId:"e9eabc1ab0a84d17b446620c1a325855",Type:"Question.TextField"},{Id:"r2b11015d4d5145728c970459c747c1f6",IsAnswerPlainText:!0,IsFromSuggestion:!1,IsMathQuiz:!1,IsQuiz:!1,Order:700,QuestionInfo:'{"ChoiceType":1,"Choices":[{"Description":"'+e.LocalizedStrings.SampleForm_PartyInvite_Question2_Choice1_Text+'"},{"Description":"'+e.LocalizedStrings.SampleForm_PartyInvite_Question2_Choice2_Text+'"},{"Description":"'+e.LocalizedStrings.SampleForm_PartyInvite_Question2_Choice3_Text+'"},{"Description":"'+e.LocalizedStrings.SampleForm_PartyInvite_Question2_Choice4_Text+'"},{"Description":"'+e.LocalizedStrings.SampleForm_PartyInvite_Question2_Choice5_Text+'"},{"Description":"'+e.LocalizedStrings.SampleForm_PartyInvite_Question2_Choice6_Text+'"}],"AllowOtherAnswer":true,"OptionDisplayStyle":"Dropdown"}',Required:!1,Title:e.LocalizedStrings.SampleForm_PartyInvite_Question2_Title,TrackingId:"3a920ec73ea84c42a8ac054055e8e19c",Type:"Question.Choice"},{Id:"r114d512e41ce476c83cc1ed9dfa38ec2",IsAnswerPlainText:!0,IsFromSuggestion:!1,IsMathQuiz:!1,IsQuiz:!1,Order:800,Required:!1,Title:e.LocalizedStrings.SampleForm_PartyInvite_Question3_Title,TrackingId:"284608970c8a4fffbb394cccb497fb08",Type:"Question.TextField"},{Id:"r7368b1d7c2124499a8fc17f98a2b9354",IsAnswerPlainText:!0,IsFromSuggestion:!1,IsMathQuiz:!1,IsQuiz:!1,Order:900,QuestionInfo:'{"ChoiceType":2,"Choices":[{"Description":"'+e.LocalizedStrings.SampleForm_PartyInvite_Question4_Choice1_Text+'"},{"Description":"'+e.LocalizedStrings.SampleForm_PartyInvite_Question4_Choice2_Text+'"},{"Description":"'+e.LocalizedStrings.SampleForm_PartyInvite_Question4_Choice3_Text+'"},{"Description":"'+e.LocalizedStrings.SampleForm_PartyInvite_Question4_Choice4_Text+'"},{"Description":"'+e.LocalizedStrings.SampleForm_PartyInvite_Question4_Choice5_Text+'"}],"AllowOtherAnswer":true,"OptionDisplayStyle":"ListAll"}',Required:!1,Title:e.LocalizedStrings.SampleForm_PartyInvite_Question4_Title,TrackingId:"217c67282e1a4c39bc1246c92859488f",Type:"Question.Choice"},{Id:"r23855eae074c4f37938050b2cc8e755c",IsAnswerPlainText:!0,IsFromSuggestion:!1,IsMathQuiz:!1,IsQuiz:!1,Order:1e3,QuestionInfo:'{"ShowSubtitle":true,"ChoiceType":1,"Choices":[{"Description":"'+e.LocalizedStrings.SampleForm_PartyInvite_Question5_Choice1_Text+'","IsMathOption":false},{"Description":"'+e.LocalizedStrings.SampleForm_PartyInvite_Question5_Choice2_Text+'","IsMathOption":false}],"OptionDisplayStyle":"ListAll"}',Required:!1,Subtitle:e.LocalizedStrings.SampleForm_PartyInvite_Question5_Subtitle,Title:e.LocalizedStrings.SampleForm_PartyInvite_Question5_Title,TrackingId:"3b5b8ed45c164671a3a9d7bfc107a568",Type:"Question.Choice"},{Id:"r3203da87f53b472b91c6a8dd4e1c5071",IsAnswerPlainText:!0,IsFromSuggestion:!1,IsMathQuiz:!1,IsQuiz:!1,Order:1100,Required:!1,ShowSubtitle:!0,Subtitle:e.LocalizedStrings.SampleForm_PartyInvite_Question6_Subtitle,Title:e.LocalizedStrings.SampleForm_PartyInvite_Question6_Title,TrackingId:"1c7340329ba54b61b5662833d3538d1d",Type:"Question.TextField"}],ResponsesCount:0,Settings:{FormClosedMessage:void 0,IsAnonymous:!0,IsQuizMode:!1,ManualGradingEnabled:!0,NotRecordIdentity:!0,
RequiresUniqueResponse:!1,ShowGradedResults:!1,ShowGradedScores:!1,ShuffleQuestionOrder:!1},Theme:{BackgroundColor:"#F2E6F0",BackgroundImage:f.Html.getAbsoluteUrl("../../Images/Theme/partyInvite.png"),Name:"Customized Theme",PrimaryColor:"#A83A94",SecondaryColor:"#8F327E",Thumbnail:f.Html.getAbsoluteUrl("../../Images/Theme/partyInvite.png")},Title:e.LocalizedStrings.SampleForm_PartyInvite_Title}}Object.defineProperty(b,"__esModule",{value:!0});var e=OfficeForm.Exports.Resources,f=OfficeForm.Exports.Utilities;b.getSampleForm=d},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(1),g=OfficeForm.Exports.JavaScriptLoader,h="iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z8BQDwAEhQGAhKmMIQAAAABJRU5ErkJggg==",i=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.mounted=!0,b}return d(b,a),b.prototype.componentDidMount=function(){var a=this;this.convertToDataURL().done(function(b){a.mounted&&a.setState({Base64URL:b})}).fail(function(a){})},b.prototype.componentWillUnmount=function(){this.mounted=!1},b.prototype.render=function(){return e.createElement("img",{alt:this.props.Title,title:this.props.Title,src:this.state.Base64URL||h})},b.prototype.download=function(){var a=this,b=g.loadJavaScript("FileSave");$.when(this.convertToBlob(),b).done(function(b){return saveAs(b,a.props.Title+".png")})},b.prototype.convertToBlob=function(){return this.convertToDataURL().then(function(a){var b=a&&a.split("base64,")[1];if(!b)throw Error("Invalid URL: "+a);for(var c=window.atob(b),d=new Uint8Array(c.length),e=0;e<c.length;e++)d[e]=c.charCodeAt(e);return new Blob([d])})},b.prototype.convertToDataURL=function(){var a=this;return this.base64Promise||(this.base64Promise=g.loadJavaScript("JQuery_QRCode").then(function(){try{var b=$("<div/>").qrcode({correctLevel:1,height:800,text:a.props.URL,width:800}),c=b.children("canvas")[0];if(c)return c.toDataURL();throw Error("QRCode doesn't work with URL: "+a.props.URL)}catch(d){return $.Deferred().reject(d).promise()}})),this.base64Promise},b}(f.ReactComponent);b.QRCode=i,Forms.UX.Controls.QRCode=i},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(1),g=function(a){function b(b){var c=a.call(this,b)||this;c.update=function(){return c.forceUpdate()};var d=c.props.FormMaster;return d.observe(c.update,[d.Schema.CoAuthMessage]),c}return d(b,a),b.prototype.componentWillUnmount=function(){var a=this.props.FormMaster;a.unobserve(this.update)},b.prototype.render=function(){var a=this.props.FormMaster.Model.CoAuthMessage;return a?e.createElement("div",{className:"coauthmessagebar-container"},e.createElement("span",{className:"coauthmessagebar-span"},a)):null},b}(f.ReactComponent);Forms.UX.Designer.CoAuthMessageBar=g},function(a,b,c){"use strict";function d(a){return l.createElement(B,k({},a))}function e(a){return q.createInsertCard({DisplayText:y.LocalizedStrings.QuestionCategory_Choice,IconClass:"RadioBtnOn",IconClassName:"design-insert-card-icon forms-icon-size16x16",key:"choice",onClick:function(){var b=w.Question.Choice.createDefaultDefinition();a(b),o.log({eventName:x.Create,eventType:"engagement_event",extraData:{isMathQuiz:!!b.IsMathQuiz,questionType:"choice"}})}})}function f(a){function b(){var b=w.Question.TextField.createDefaultSingleLineDefinition();a(b),o.log({eventName:x.Create,eventType:"engagement_event",extraData:{isMathQuiz:!!b.IsMathQuiz,questionType:"text"}})}return q.createInsertCard({DisplayText:y.LocalizedStrings.QuestionCategory_Text,IconClass:"TextField",IconClassName:"design-insert-card-icon forms-icon-size20x20",key:"text",onClick:b})}function g(a){function b(){var b=w.Question.DateTime.createDefaultDefinition();a(b),o.log({eventName:x.Create,eventType:"engagement_event",extraData:{questionType:"dateTime"}})}return q.createInsertCard({DisplayText:y.LocalizedStrings.QuestionCategory_DateTime,IconClass:"Calendar",IconClassName:"forms-icon-size18x18",key:"dateTime",onClick:b})}function h(a){function b(){var b=w.Question.Rating.createDefaultDefinition();a(b),o.log({eventName:x.Create,eventType:"engagement_event",extraData:{questionType:"rating"}})}return q.createInsertCard({DisplayText:y.LocalizedStrings.QuestionCategory_Rating,IconClass:"Like",IconClassName:"thumbUpEmptyIcon forms-icon-size18x18",key:"rating",onClick:b})}function i(){var a,b=$(window).width();return a=b<=v.DefaultSmallScreenSize?A.Small:b<=v.DefaultMiddleScreenSize?A.Middle:A.Large}var j=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),k=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var l=c(0),m=c(7),n=c(27),o=c(2),p=c(1),q=c(147),r=OfficeForm.Exports.Control,s=OfficeForm.Exports.DataProvider,t=OfficeForm.Exports.EnvironmentConfig,u=OfficeForm.Exports.Flighting,v=OfficeForm.Exports.FormLimitation,w=OfficeForm.Exports.Models,x=OfficeForm.Exports.EngagementEventNames.DesignPage.Questions,y=OfficeForm.Exports.Resources,z=OfficeForm.Exports.Utilities;b.createInsertCardPane=d;var A;!function(a){a[a.Large=0]="Large",a[a.Middle=1]="Middle",a[a.Small=2]="Small"}(A||(A={}));var B=function(a){function b(b){var c=a.call(this,b)||this;return c.onExecuteForDateQuestion=c.onExecuteForDateQuestion.bind(c),c.onExecuteForLikertQuestion=c.onExecuteForLikertQuestion.bind(c),c.onExecuteForRankingQuestion=c.onExecuteForRankingQuestion.bind(c),c.onExecuteForRatingQuestion=c.onExecuteForRatingQuestion.bind(c),c.onExecuteForSection=c.onExecuteForSection.bind(c),c.onKeyDown=c.onKeyDown.bind(c),c.updateScreenSize=c.updateScreenSize.bind(c),c.state={InsertPanelActiveElementIndex:0,MoreQuestionsMenuExpanded:!1,ScreenSize:i()},c}return j(b,a),b.prototype.componentWillMount=function(){window.addEventListener("resize",this.updateScreenSize)},b.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.updateScreenSize)},b.prototype.componentDidUpdate=function(){this.props.FocusOnInsertCardItem&&!this.state.MoreQuestionsMenuExpanded&&this.setFocusOnInsertItems(this.state.InsertPanelActiveElementIndex)},b.prototype.componentDidMount=function(){this.insertPanelElements=$(".insertPanel").find("button")},b.prototype.render=function(){var a=this.state.ScreenSize===A.Middle,b=this.state.ScreenSize===A.Small,c=e(this.props.insertCallback),d=f(this.props.insertCallback),i=!b&&h(this.props.insertCallback),j=!a&&!b&&g(this.props.insertCallback);return l.createElement("div",{"aria-orientation":"horizontal",className:"insertPanel",onKeyDown:this.onKeyDown},c,d,i,j,this.createMoreQuestionsButton())},b.prototype.createMoreQuestionsItems=function(){var a=this.state.ScreenSize===A.Middle,b=this.state.ScreenSize===A.Small,c=r.createGlyphButton({ButtonStyle:"DarkBackGround",HTMLAttributes:{className:"design-insert-card-dropdown-option date-time"},Icon:"Calendar",IconClassName:"design-insert-card-dropdown-img office-form-theme-primary-foreground forms-icon-size16x16",key:"dateTime",Text:y.LocalizedStrings.QuestionCategory_DateTime,TextClassName:"design-insert-card-dropdown-text"}),d=[];b?(d.push({Active:!0,MenuItem:r.createGlyphButton({ButtonStyle:"DarkBackGround",HTMLAttributes:{className:"design-insert-card-dropdown-option rating"},Icon:"Like",IconClassName:"design-insert-card-dropdown-img office-form-theme-primary-foreground forms-icon-size16x16",key:"rating",Text:y.LocalizedStrings.QuestionCategory_Rating,TextClassName:"design-insert-card-dropdown-text"}),OnExecute:this.onExecuteForRatingQuestion}),d.push({Active:!0,MenuItem:c,OnExecute:this.onExecuteForDateQuestion})):a&&d.push({Active:!0,MenuItem:c,OnExecute:this.onExecuteForDateQuestion}),d.push({Active:!0,MenuItem:r.createGlyphButton({ButtonStyle:"DarkBackGround",HTMLAttributes:{className:"design-insert-card-dropdown-option"},Icon:"Sort",IconClassName:"design-insert-card-dropdown-img office-form-theme-primary-foreground forms-icon-size18x18",key:"ranking",Text:y.LocalizedStrings.QuestionCategory_Ranking,TextClassName:"design-insert-card-dropdown-text"}),OnExecute:this.onExecuteForRankingQuestion}),d.push({Active:!0,MenuItem:r.createGlyphButton({ButtonStyle:"DarkBackGround",HTMLAttributes:{className:"design-insert-card-dropdown-option"},Icon:"ViewList",IconClassName:"design-insert-card-dropdown-img office-form-theme-primary-foreground forms-icon-size18x18",key:"likert",Text:y.LocalizedStrings.QuestionCategory_Likert,TextClassName:"design-insert-card-dropdown-text"}),OnExecute:this.onExecuteForLikertQuestion}),u.Flight.isEnabled(u.Flights.FileUpload)&&!s.FeaturePlanProvider.isMsaUser()&&d.push(this.createFileUploadMenuItem());var e=!t.isSovereignProd();return e&&d.push(this.createNpsMenuItem()),u.Flight.isEnabled(u.Flights.SectionMVP1)&&(d.push(r.createMenuBreakerProps()),d.push({Active:!0,MenuItem:r.createGlyphButton({ButtonStyle:"DarkBackGround",HTMLAttributes:{className:"design-insert-card-dropdown-option"},Icon:"Tab",IconClassName:"design-insert-card-dropdown-img office-form-theme-primary-foreground forms-icon-size18x18",key:"section",Text:y.LocalizedStrings.DesciptiveElementCategory_Section,TextClassName:"design-insert-card-dropdown-text"}),OnExecute:this.onExecuteForSection})),d},b.prototype.createFileUploadMenuItem=function(){var a=this,b=r.createGlyphButton({ButtonStyle:"DarkBackGround",HTMLAttributes:{className:"design-insert-card-uploadFile-icon design-insert-card-dropdown-option"},Icon:"Upload",IconClassName:"design-insert-card-dropdown-img office-form-theme-primary-foreground forms-icon-size20x20",key:"fileUpload",Text:y.LocalizedStrings.QuestionCategory_UploadFile,TextClassName:"design-insert-card-dropdown-text"}),c=function(){var b=w.Question.FileUpload.createDefaultDefinition();a.props.insertCallback(b),o.log({eventName:x.Create,eventType:"engagement_event",extraData:{questionType:"fileUpload"}})};return{Active:!0,MenuItem:b,OnExecute:c}},b.prototype.createNpsMenuItem=function(){var a=this,b=r.createGlyphButton({ButtonStyle:"DarkBackGround",HTMLAttributes:{className:"design-insert-card-dropdown-option"},Icon:"AutoRacing",IconClassName:"design-insert-card-dropdown-img office-form-theme-primary-foreground forms-icon-size18x18",key:"nps",Text:y.LocalizedStrings.QuestionCategory_NPS,TextClassName:"design-insert-card-dropdown-text"}),c=function(){var b=w.Question.NPSDelegator.createDefaultDefinition();a.props.insertCallback(b),o.log({eventName:x.Create,eventType:"engagement_event",extraData:{questionType:"NPS"}})};return{Active:!0,MenuItem:b,OnExecute:c}},b.prototype.onExecuteForDateQuestion=function(){var a=w.Question.DateTime.createDefaultDefinition();this.props.insertCallback(a),o.log({eventName:x.Create,eventType:"engagement_event",extraData:{questionType:"dateTime"}})},b.prototype.onExecuteForRankingQuestion=function(){var a=w.Question.Ranking.createDefaultDefinition();this.props.insertCallback(a),o.log({eventName:x.Create,eventType:"engagement_event",extraData:{questionType:"ranking"}})},b.prototype.onExecuteForRatingQuestion=function(){var a=w.Question.Rating.createDefaultDefinition();this.props.insertCallback(a),o.log({eventName:x.Create,eventType:"engagement_event",extraData:{questionType:"rating"}})},b.prototype.onExecuteForLikertQuestion=function(){var a=w.Question.MatrixChoiceGroup.createDefaultDefinition(),b=w.Question.MatrixChoiceGroup.createSubQuestionsDefinition();this.props.insertCallback(a,b),o.log({eventName:x.Create,eventType:"engagement_event",extraData:{questionType:"likert"}})},b.prototype.onExecuteForSection=function(){var a=n.createDefaultSectionDefinition();this.props.insertCallback(a),o.log({eventName:"DesignPage.Section.Create",eventType:"engagement_event",extraData:{elementType:"section"}})},b.prototype.createMoreQuestionsButton=function(){var a=this,b=this.createMoreQuestionsItems(),c={ButtonStyle:"DarkBackGround",ChildrenContent:r.createFontIconControl({HTMLAttributes:{className:"forms-icon-size20x20",title:y.LocalizedStrings.QuestionCategory_More},IconName:"More"}),ClassName:"design-insert-card-more-button",Description:y.LocalizedStrings.QuestionCategory_More,Tooltip:y.LocalizedStrings.QuestionCard_Menu_Tooltip},d={ClassName:"design-insert-card-more-menu",ClassNameForContainer:"design-insert-card-more-container office-form-theme-button",CustomizedMenuItems:b,MenuTriggerButton:c,onMenuCollapse:function(){a.setState({MoreQuestionsMenuExpanded:!1})},onMenuExpand:function(){a.setState({MoreQuestionsMenuExpanded:!0})},ShowBox:!0};return this.state.MoreQuestionsMenuExpanded&&(d.ClassNameForContainer=z.Html.combineAttributes(d.ClassNameForContainer,"active")),r.createMenuControl(d)},b.prototype.onKeyDown=function(a){var b=this.state.InsertPanelActiveElementIndex;switch(a.keyCode){case m.KeyCode.Tab:b++,b<this.insertPanelElements.length&&(a.stopPropagation(),a.preventDefault(),this.setState({InsertPanelActiveElementIndex:b}));break;case m.KeyCode.ArrowRight:b=(b+1+this.insertPanelElements.length)%this.insertPanelElements.length,this.setState({InsertPanelActiveElementIndex:b});break;case m.KeyCode.ArrowLeft:b=(b-1+this.insertPanelElements.length)%this.insertPanelElements.length,this.setState({InsertPanelActiveElementIndex:b});break;case m.KeyCode.Enter:this.state.InsertPanelActiveElementIndex<this.insertPanelElements.length-1&&$(":focus").click()}},b.prototype.setFocusOnInsertItems=function(a){this.insertPanelElements.eq(a).focus()},b.prototype.updateScreenSize=function(){this.setState({ScreenSize:i()})},b}(p.ReactComponent);Forms.UX.Designer.createInsertCardPane=d},function(a,b,c){"use strict";function d(a){return f.createElement(k,a)}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(3),h=c(1),i=OfficeForm.Exports.Control,j=OfficeForm.Exports.Utilities;b.createInsertCard=d;var k=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return e(b,a),b.prototype.render=function(){var a=this.props,b=g.clone(a.HTMLAttributes)||{};return b.className=j.Html.combineAttributes("design-insert-card new-margin",b.className),b.onClick=a.onClick,b.title=a.DisplayText,i.createGlyphButton({ButtonStyle:"DarkBackGround",HTMLAttributes:b,Icon:a.IconClass,IconClassName:a.IconClassName+" design-insert-card-img office-form-theme-primary-foreground",Text:a.DisplayText,TextClassName:"design-insert-card-text"})},b}(h.ReactComponent)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(3),h=c(2),i=c(1),j=OfficeForm.Exports.Models,k=OfficeForm.Exports.Control,l=OfficeForm.Exports.Resources,m=OfficeForm.Exports.Utilities,n=OfficeForm.Exports.EngagementEventNames,o=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.targetChangeCallback=function(){return b.onTargetChange()},b.refresh=function(){return b.forceUpdate()},b}return d(b,a),b.prototype.componentWillMount=function(){this.props.Master.observe(this.targetChangeCallback,[j.BranchInfoMaster.Schema.TargetQuestionId,j.BranchInfoMaster.Schema.ToTheEnd]),this.onTargetChange()},b.prototype.componentWillUnmount=function(){this.props.Master.unobserve(this.targetChangeCallback),this.lastTargetQuestion&&this.lastTargetQuestion.unobserve(this.refresh)},b.prototype.render=function(){var a=this,c=this.props,d=c.Master,h=d.Model,i=h.ToTheEnd?b.SpecialIdForGoingToTheEnd:h.TargetQuestionId;i=i||b.SpecialIdForGoingToTheNext;var j={AllowWrap:!0,Label:l.LocalizedStrings.Branch_Menu_Description_Prefix,onValueChange:function(b){return a.onValueChange(b.toString())},SelectOptions:this.getSelectOptions(),Value:i},n=g.extend({},c.HTMLAttributes);return n.className=m.Html.combineAttributes("branch-selector",n.className),f.createElement("div",e({},n),b.createGuide(),k.createSelect(j))},b.createGuide=function(){return f.createElement("div",{className:"branch-selector-guide office-form-theme-primary-foreground"},l.LocalizedStrings.Branch_Menu_Description_Prefix)},b.prototype.getSelectOptions=function(){var a=this.props.Master.Question;return[b.getSelectOptionToTheNext(),b.getDropdownOptionToTheEnd()].concat(a.Form.FormElementManager.TopQuestionMasters.map(function(c,d){return c!==a?b.getSelectOptionToTarget(c,d+1):void 0}).filter(function(a){return!!a}))},b.getSelectOptionToTheNext=function(){return{DisplayName:l.LocalizedStrings.Branch_Menu_Next_Question,Key:b.SpecialIdForGoingToTheNext,Value:b.SpecialIdForGoingToTheNext}},b.getSelectOptionToTarget=function(a,b){var c=a.Model,d=k.RichTextUtil.stripSupportedTagsButLeaveDangerousOnes(c.Title),e=l.LocalizedStrings.Branch_QuestionTitle.format(b,d);return{DisplayContent:[f.createElement("span",{className:"branch-selector-option-ordinal",key:"ordinal"},l.LocalizedStrings.Designer_QuestionOrdinal.format(b)),f.createElement("span",{className:"branch-selector-option-title",key:"title"},f.createElement("span",{title:d},d))],DisplayName:e,Key:c.Id,Value:c.Id}},b.getDropdownOptionToTheEnd=function(){return{DisplayName:l.LocalizedStrings.Branch_Menu_End,Key:b.SpecialIdForGoingToTheEnd,Value:b.SpecialIdForGoingToTheEnd}},b.prototype.onValueChange=function(a){var c=this.props.Master,d=c.Model;a===b.SpecialIdForGoingToTheEnd?d.ToTheEnd=!0:(a===b.SpecialIdForGoingToTheNext&&(a=null),c.bulkEdit(function(){d.ToTheEnd=!1,d.TargetQuestionId=a}));var e=c.Question.Model;h.log({eventName:n.DesignPage.Branch.BranchChanged,eventType:"engagement_event",extraData:{isQuestionBranching:e.BranchInfo===d,questionType:e.Type,targetQuestionType:c.TargetQuestionMaster&&c.TargetQuestionMaster.Model.Type,toTheEnd:d.ToTheEnd,value:a}})},b.prototype.onTargetChange=function(){this.forceUpdate(),this.lastTargetQuestion&&this.lastTargetQuestion.unobserve(this.refresh),this.lastTargetQuestion=this.props.Master.TargetQuestionMaster,this.lastTargetQuestion&&this.lastTargetQuestion.observe(this.refresh,[j.QuestionMaster.Schema.Title])},Object.defineProperty(b,"SpecialIdForGoingToTheNext",{get:function(){return"% To The Next %"},enumerable:!0,configurable:!0}),Object.defineProperty(b,"SpecialIdForGoingToTheEnd",{get:function(){return"% To The End %"},enumerable:!0,configurable:!0}),b}(i.ReactComponent);Forms.UX.Designer.BranchSelector=o},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e,f=c(0),g=c(6),h=c(3),i=c(7),j=c(2),k=c(100),l=c(23),m=c(32),n=c(102),o=c(24),p=OfficeForm.Exports.Models,q=OfficeForm.Exports.Control,r=OfficeForm.Exports.Utilities,s=OfficeForm.Exports.Flighting,t=OfficeForm.Exports.EngagementEventNames,u=OfficeForm.Exports.Resources,v=OfficeForm.Exports.DataProvider,w=OfficeForm.Exports.FormLimitation,x=OfficeForm.Exports.EnvironmentConfig,y=p.ChoiceType;!function(a){a[a.None=0]="None",a[a.OptionSuggestionFromTitle=1]="OptionSuggestionFromTitle",a[a.OptionSuggestionFromOption=2]="OptionSuggestionFromOption",a[a.Math=3]="Math"}(e||(e={}));var z=function(a){function b(b){var c=a.call(this,b,"Choice.Subtitle")||this;return c.addOptionRef=f.createRef(),c.removeOtherOptionRef=f.createRef(),c.mounted=!0,c.optionSuggestionId="",c.lastFormula={Mathml:"",OriginalText:""},c.isCandidatesShown=!1,c.isCandidateChosen=!1,c.shownChoiceCandidates=null,c.showMathKeyboardOptionIndex=-1,c.choiceDescriptionChangeCallback=function(){return c.triggerOptionSuggestionForOption()},c.toggleMathOption=c.toggleMathOption.bind(c),c.addOtherAnswer=c.addOtherAnswer.bind(c),c.onPaste=c.onPaste.bind(c),c}return d(b,a),b.prototype.componentDidMount=function(){if(a.prototype.componentDidMount.call(this),this.triggerOptionSuggestionFromTitle(),s.Flight.isEnabled(s.Flights.EnableOptionSuggestsOption)){var b=this.props.Master;b.observe(this.choiceDescriptionChangeCallback,[b.Schema.Choices[0].Description])}},b.prototype.componentWillUnmount=function(){if(this.mounted=!1,a.prototype.componentWillUnmount.call(this),s.Flight.isEnabled(s.Flights.EnableOptionSuggestsOption)){var b=this.props.Master;b.unobserve(this.choiceDescriptionChangeCallback)}},b.prototype.createReactNodes=function(){return[this.createChoices()]},b.prototype.onTitleValueChange=function(){this.triggerOptionSuggestionFromTitle(),this.triggerMathCalculation()},b.prototype.createMoreMenuItems=function(){var b,c=this.props.Master,d=c.Model;if(d.Type===p.QuestionType.Choice){var e=function(){j.log({eventName:t.DesignPage.QuestionMenu.ShuffleOptions,eventType:"engagement_event",extraData:{questionType:d.Type,value:d.ShuffleOptions}}),d.ShuffleOptions=!d.ShuffleOptions};b={Checked:d.ShuffleOptions,Description:u.LocalizedStrings.Designer_QuestinMenu_ShuffleOptions,Key:"shuffleItem",MenuItemType:q.MenuItemType.CheckBox,onExecute:e}}var f;if(s.Flight.isEnabled(s.Flights.DropDown)&&d.Type===p.QuestionType.Choice&&!d.IsMathQuiz&&d.ChoiceType!==y.MultiChoice){var g=d.OptionDisplayStyle===p.OptionDisplayStyle.Dropdown;f={Checked:g,Description:u.LocalizedStrings.Designer_AllowDropDown,Key:"dropdownItem",MenuItemType:q.MenuItemType.CheckBox,onExecute:function(){j.log({eventName:t.DesignPage.QuestionMenu.DropDown,eventType:"engagement_event",extraData:{questionType:d.Type}}),d.OptionDisplayStyle=d.OptionDisplayStyle===p.OptionDisplayStyle.Dropdown?p.OptionDisplayStyle.ListAll:p.OptionDisplayStyle.Dropdown}}}var h=[b,this.createValidationItem(),f,this.createMathItem()].filter(function(a){return!!a});return h=h.concat(a.prototype.createMoreMenuItems.call(this))},b.prototype.createSuggestionBar=function(){var a=this,b=this.state;if(this.state.ChoiceCandidates&&(this.props.Master.Model.IsMathQuiz||b.IntelligenceProvider!==e.Math)){var c=b.ChoiceCandidates.filter(function(c){return!a.hasChoice(c.text,b.IntelligenceProvider===e.Math)});if(c.length){b.IntelligenceProvider===e.Math?this.logQuizOptionSuggestionsShown():this.isCandidatesShown||(this.logSuggestionCandidatesShown(),this.isCandidatesShown=!0);var d=[],g=void 0,h=void 0,i=r.Html.combineAttributes("design-question-choice-candidate office-form-theme-primary-foreground","office-form-theme-bgcolor-hover"),j="design-question-choice-candidate office-form-theme-button";switch(b.IntelligenceProvider){case e.OptionSuggestionFromTitle:d=[u.LocalizedStrings.Designer_Intelligence_Options],g=q.createTextButton({ButtonStyle:"LightBackground",HTMLAttributes:{className:j,onClick:function(){c.forEach(function(b){return a.chooseCandidate(b.text)}),a.setFocusToTitleElement()}},key:"option_addAll",Text:u.LocalizedStrings.Designer_Intelligence_AddAll}),h=c.map(function(b,d){return q.createTextButton({ButtonStyle:"LightBackground",HTMLAttributes:{className:i,onClick:function(e){a.chooseCandidate(b.text),(1===c.length||d===c.length-1)&&a.setFocusToTitleElement()}},key:"option_"+d,Text:b.text})});break;case e.Math:d=[u.LocalizedStrings.Designer_Intelligence_Results],c.length>1&&(g=q.createTextButton({ButtonStyle:"LightBackground",HTMLAttributes:{className:j,onClick:function(){c.forEach(function(b){return a.chooseCandidate(b.text,b.isAnswer)}),a.setFocusToTitleElement()}},key:"option_addAll",Text:u.LocalizedStrings.Designer_Intelligence_AddAll}));var k=u.LocalizedStrings;h=c.map(function(b,c){var d,e;return b.isAnswer&&(d="CheckMark",e="design-question-choice-candidate-icon-correct forms-icon-size16x16"),q.createGlyphButton({ButtonStyle:"LightBackground",children:q.createFormulaRenderer({Formula:b.text}),GlyphButtonStyle:"Horizontal",HTMLAttributes:{className:r.Html.combineAttributes("design-question-choice-candidate-math office-form-theme-primary-foreground","office-form-theme-bgcolor-hover"),onClick:function(){a.chooseCandidate(b.text,b.isAnswer),a.setState({SelectedElementIndex:o.subtitleElementIndex});var c=a.getElementRef(o.subtitleElementIndex).current;c&&$(c).find(".design-formula-mixer").focus()},title:k["Designer_Intelligence_Math_"+b.title]||b.title},Icon:d,IconClassName:e,key:"option_"+c})})}return f.createElement("div",{className:"design-question-candidate-bar"},d.concat(g,h))}}},b.prototype.mathCalculation=function(a,b){var c=this;if(this.lastFormula={Mathml:b,OriginalText:a},!a||!b)return void this.setState({ChoiceCandidates:[],IntelligenceProvider:e.None});this.props.Master.Model.LastMathMLFormula=b;var d=this.props.Master.Model.Title+r.MathHelper.mathSeparator+a,f=this.props.Master.Form.Model.Id,g=this.props.Master.Model.Id;v.ProviderManager.getInstance().CurrentMathProvider.mathFormulaCalculation({Context:d,FormId:f,IncorrectAnswerCount:3,Mathml:b,QuestionId:g}).done(function(a){c.mounted&&(r.assert(a&&a.Responses,"math calculation result is null in question designer"),c.setState({ChoiceCandidates:a.Responses.map(function(a){return{isAnswer:a.Answer.IsCorrect,text:a.Answer.Formula,title:a.Intent}}),IntelligenceProvider:e.Math}))})},b.prototype.triggerOptionSuggestionFromTitle=function(){var a=this,b=this.props.Master.Model;if(!b.IsMathQuiz){var c=500;window.clearTimeout(this.textAnalysisTimeOut),this.textAnalysisTimeOut=window.setTimeout(function(){Forms.UX.FormDesignView.FormIntelligenceLauncher.getChoiceOptionSuggestion(b.Title).done(function(b){a.mounted&&(b&&b.MatchQuery&&b.Suggestion?a.setState({ChoiceCandidates:b.Suggestion.ChoiceCandidates.map(function(a){return{text:a}}),IntelligenceProvider:e.OptionSuggestionFromTitle,MatchingPart:b.Suggestion.MatchingPart}):a.setState({ChoiceCandidates:[],IntelligenceProvider:e.None}))}).fail(function(b){a.mounted&&a.setState({ChoiceCandidates:[],IntelligenceProvider:e.None})})},c)}},b.prototype.triggerOptionSuggestionForOption=function(){var a=this,b=this.props.Master.Model;if(!(b.IsMathQuiz||this.state.ChoiceCandidates&&this.state.ChoiceCandidates.length>0&&this.state.IntelligenceProvider!==e.OptionSuggestionFromOption)){var c=h.filter(b.Choices,function(a){return!a.IsGenerated});if(0!==c.length){var d=function(){k.FormIntelligenceLauncher.getOptionToOptionSuggestion(c.map(function(a){return a.Description})).done(function(b){a.mounted&&b.MatchQuery&&(b.Result.ChoiceCandidates&&b.Result.ChoiceCandidates.length>0?a.setState({ChoiceCandidates:b.Result.ChoiceCandidates.map(function(a){return{text:a}}),IntelligenceProvider:e.OptionSuggestionFromOption,MatchingPart:b.Result.MatchingPart},function(){a.optionSuggestionId=r.Guid.newGuid(),a.logSuggestionCandidatesShown()}):(j.log({eventName:t.IntelligenceStatistic.ChoiceOptionSuggestion.NoShow,eventType:"engagement_event",extraData:{candidateType:e[e.OptionSuggestionFromOption],matchingPart:b.Result.MatchingPart,msftUser:OfficeFormServerInfo.userInfo.TenantId===x.getMsftTenantId(),questionId:a.props.Master.Model.Id}}),a.setState({ChoiceCandidates:[],IntelligenceProvider:e.None})))}).fail(function(b){a.mounted&&a.setState({ChoiceCandidates:[],IntelligenceProvider:e.None})})};window.clearTimeout(this.textAnalysisTimeOut);var f=500;this.textAnalysisTimeOut=window.setTimeout(d,f)}}},b.prototype.triggerMathCalculation=function(){var a=this,b=this.props.Master.Model;if(b.IsMathQuiz&&!b.IsPlainTextInMathField){var c=1e3;window.clearTimeout(this.mathKeywordAnalysisTimeOut),this.mathKeywordAnalysisTimeOut=window.setTimeout(function(){a.mathCalculation(a.lastFormula.OriginalText,a.lastFormula.Mathml)},c)}},b.prototype.hasChoice=function(a,b){var c=this.props.Master.Model,d=c.Choices;return h.some(d,function(c){return c.Description?b?c.Description.replace(/\s/g,"")===a.replace(/\s/g,""):c.Description===a:!1})},b.prototype.chooseCandidate=function(a,b){this.state.IntelligenceProvider===e.Math?this.logQuizOptionSuggestionChosen(a,b):this.logSuggestionCandidatesChosen(a);var c=this.props.Master,d=c.insertChoice(a,this.state.IntelligenceProvider===e.Math);b&&c.setAnswerKey(d,!0)},b.prototype.createChoices=function(){var a,b=this,c=this.props.Master.Model,d=c.Choices,e=d.length,g=f.createElement("div",{className:"design-question-choice-options-div"},h.map(d,function(a,c){return b.createChoiceOption(a,c)})),i={className:"design-question-button office-form-theme-button-color",onClick:function(){j.log({eventName:t.DesignPage.Questions.AddOption,eventType:"engagement_event",extraData:{index:e,questionId:c.Id,questionType:c.Type}}),b.onAdd(e)}},k=q.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"Horizontal",HTMLAttributes:i,Icon:"Add",IconClassName:"forms-icon-size18x18 office-form-theme-primary-foreground",ref:this.addOptionRef,Text:u.LocalizedStrings.Designer_AddOneMore,TextClassName:"design-question-addonemore"});if(!c.AllowOtherAnswer&&!c.IsQuiz){var l={className:"design-question-button office-form-theme-button-color",onClick:this.addOtherAnswer};a=q.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"Horizontal",HTMLAttributes:l,Text:u.LocalizedStrings.Designer_AllowOtherAnswer,TextClassName:"design-question-addothermore"})}var m="design-question-all-choices";return f.createElement("div",{className:m},g,this.createOtherChoiceOption(),f.createElement("div",{className:"design-question-add-option-container"},f.createElement("div",{className:"design-question-add-option-element"},k),f.createElement("div",{className:"design-question-add-option-element"},a)))},b.prototype.addOtherAnswer=function(){var a=this;j.log({eventName:t.DesignPage.Questions.AddOtherOption,eventType:"engagement_event",extraData:{questionType:this.props.Master.Model.Type}}),this.onUpdateDone(function(){var b=a.addOptionRef.current;if(b){var c=g.findDOMNode(b);c.focus()}}),this.props.Master.Model.AllowOtherAnswer=!0},b.prototype.createChoiceOption=function(a,b){var c=this.props.Master,d=c.Model,e=!1,g=c.showAsDropdown(),h=d.DefaultValue&&JSON.parse(d.DefaultValue);h&&h.hasOwnProperty(b)&&(e=!0);var i,j;if(g)j="design-question-choice-label design-question-dropdown-label";else{var k=d.ChoiceType===y.MultiChoice?"checkbox":"radio",l=d.IsMathQuiz?"design-question-math-choice-icon":"design-question-choice-icon";i=f.createElement("input",{"aria-label":u.LocalizedStrings.DesignPage_ChoiceOptionRadioBox_AriaLabel.format(b+1),disabled:!0,className:l,type:k}),j="design-question-choice-label"}var n;d.IsMathQuiz&&(a.IsMathOption?(b===this.showMathKeyboardOptionIndex&&(this.showMathKeyboardOptionIndex=-1),
n=f.createElement(m.FormulaDesigner,{blockEndDesignMode:this.props.blockEndDesignMode,HasFocus:this.state.SelectedElementIndex===b,HTMLAttributes:this.getElementFocusingProps(b),Location:"Choice.Option",onValueChange:this.onValueChangeForMath.bind(this,b),Placeholder:u.LocalizedStrings.Designer_Choices_Euqation_Placeholder,QuestionId:"",Value:a.Description},this.createOptionMathTextSwithcer(b))):n=f.createElement("div",{className:"design-choice-option-text-input-container"},this.createTextbox(a.Description,b,e),this.createOptionMathTextSwithcer(b)));var o=this.createRemoveButton(a.Description,b),p=this.createToggleAnswerHintButton(b),q=this.createMarkAnswerKeyButton(a.Description,b),r=b===d.Choices.length-1?this.createSuggestionBarForOption():null;return f.createElement("div",{className:"design-question-choice",key:Nerve.getObjectMasterFromModel(a).getInstanceId()},f.createElement("div",{className:j,ref:this.getElementRef(b)},i,n?n:this.createTextbox(a.Description,b,e),o,p,q,r),this.createAnswerHintEditor(a,b))},b.prototype.createOptionMathTextSwithcer=function(a){var b=this.props.Master.Model,c=b.Choices[a],d="design-question-choice-to-math-button";this.props.IsMobile&&(d=r.Html.combineAttributes(d,"isMobile")),a===this.state.SelectedElementIndex&&(d=r.Html.combineAttributes(d,"active-choice"));var e,f;return c.IsMathOption?(e={"aria-label":u.LocalizedStrings.Designer_Question_EquationToText_Button,className:d,onClick:this.toggleMathOption(a),title:u.LocalizedStrings.Designer_Question_EquationToText_Button_Tooltip},f="TextField"):(e={"aria-label":u.LocalizedStrings.Designer_Question_Equation_Button,className:d,onClick:this.toggleMathOption(a),title:u.LocalizedStrings.Designer_Question_Equation_Button_Tooltip},f="NumberField"),q.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:e,Icon:f,IconClassName:"design-question-choice-to-math-button-icon"})},b.prototype.toggleMathOption=function(a){var b=this;return function(c){var d=b.props.Master.Model.Choices[a];d&&(b.showMathKeyboardOptionIndex=a,d.IsMathOption=!d.IsMathOption,b.forceUpdate(),j.log({eventName:d.IsMathOption?t.DesignPage.Quiz.SwitchTextToMathInput:t.DesignPage.Quiz.SwitchMathToTextInput,eventType:"engagement_event",extraData:{location:"Choice.Option"}}))}},b.prototype.createTextbox=function(a,b,c){var d=this.props.Master.Model,e=d.IsMathQuiz?"design-question-textbox-with-switcher":"inline-display design-question-choice-option-textbox";return q.createTextField({AutoFocus:this.state.SelectedElementIndex===b,AutoSelection:!0,HTMLAttributes:r.Html.mergeReactProps(this.getElementFocusingProps(b),{className:e,onFocus:function(){var a=d.Choices[b];d.IsMathQuiz&&a.IsGenerated&&(a.Description="")},onKeyDown:this.onKeyDown(b),onPaste:s.Flight.isEnabled(s.Flights.CopyPasteForChoice)?this.onPaste:void 0}),MaxLength:w.QuestionOptionLength,onValueChange:function(a){d.Choices[b].IsGenerated&&d.Choices[b].Description!==a&&(d.Choices[b].IsGenerated=null),d.Choices[b].Description=a;var e=d.DefaultValue&&JSON.parse(d.DefaultValue);c&&e&&(e[b]=a),d.DefaultValue=JSON.stringify(e)},Options:{HTMLPropsForInnerElement:{"aria-label":u.LocalizedStrings.DesignPage_ChoiceOptionInputBox_AriaLabel}},Placeholder:u.LocalizedStrings.Designer_Choices_Placeholder,Value:a})},b.prototype.onValueChangeForMath=function(a,b){var c=this.props.Master;c.bulkEdit(function(){var d=c.Model.Choices[a];d.Description=b,b&&(d.IsGenerated=null)})},b.prototype.createAnswerHintEditor=function(a,b){var c=this.props.Master.Model.IsQuiz;return c&&null!==a.AnswerHint?q.createTextField({AutoFocus:!0,AutoSelection:!0,HTMLAttributes:r.Html.mergeReactProps(this.getElementFocusingProps(b),{className:"design-question-choice-answer-hint"}),MaxLength:w.AnswerHintLength,MinimalHeight:w.DefaultTextFieldHeight,onValueChange:function(b){return a.AnswerHint=b},Placeholder:u.LocalizedStrings.Designer_Choices_AnswerHint_Placeholder,TextFieldType:q.TextFieldType.AutoHeightMultiline,Value:a.AnswerHint}):void 0},b.prototype.createRemoveButton=function(a,b){var c=this,d=b===this.state.SelectedElementIndex?"option-edit-button active-choice":"option-edit-button";return q.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:r.Html.mergeReactProps(this.getElementFocusingProps(b),{className:d,onClick:function(){c.onUpdateDone(function(){var a=c.props.Master.Model;if(b===a.Choices.length){var d=a.AllowOtherAnswer?c.removeOtherOptionRef.current:c.addOptionRef.current;if(d){var e=g.findDOMNode(d);e.focus()}}else{var f=c.getElementRef(b).current;f&&$(f).find(".office-form-textfield-input").focus()}}),c.onDelete(a,b)}}),Icon:"Delete",IconClassName:"option-edit-button-img forms-icon-size16x16",Text:u.LocalizedStrings.Delete_Button_Narrator})},b.prototype.createToggleAnswerHintButton=function(a){if(this.props.Master.Model.IsQuiz){var b=this.props.Master.Model.Choices,c=a===this.state.SelectedElementIndex?"option-edit-button active-choice":"option-edit-button";return q.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:r.Html.mergeReactProps(this.getElementFocusingProps(a),{className:c,onClick:this.onToggleAnswerHint(a)}),Icon:"Chat",IconClassName:"option-edit-button-img forms-icon-size16x16",Text:u.LocalizedStrings.Quiz_AnswerHint,ToggleActive:null!==b[a].AnswerHint})}},b.prototype.createMarkAnswerKeyButton=function(a,b){var c=this;if(this.props.Master.Model.IsQuiz){var d=this.props.Master.Model.Choices,e=b===this.state.SelectedElementIndex||d[b].IsAnswerKey?"option-edit-button active-choice":"option-edit-button";return q.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:d[b].IsAnswerKey?"Horizontal":"GlyphOnly",HTMLAttributes:r.Html.mergeReactProps(this.getElementFocusingProps(b),{className:e,onClick:function(){j.log({eventName:t.DesignPage.Questions.ToggleCorrectChoice,eventType:"engagement_event",extraData:{index:b,questionId:c.props.Master.Model.Id,questionType:c.props.Master.Model.Type,value:!d[b].IsAnswerKey}}),c.props.Master.setAnswerKey(d[b],!d[b].IsAnswerKey)}}),Icon:"CheckMark",IconClassName:"option-edit-button-img forms-icon-size18x18",Text:u.LocalizedStrings.Quiz_CorrectAnswer,TextClassName:"designer-quiz-option-correct",ToggleActive:!!d[b].IsAnswerKey})}},b.prototype.createDefaultCheckbox=function(a,b,c){var d=this;return q.createCheckBox({Description:u.LocalizedStrings.Designer_Choices_DescriptionForDefaultValue,HTMLAttributes:{className:"inline-display office-form-question-defaultcheck"},onValueChange:function(c){return d.onCheck(a,b,c)},Options:{classNameForInnerDiv:"inline-display"},Value:c})},b.prototype.createOtherChoiceOption=function(){var a,b,c=this,d=this.props.Master,e=d.Model;if(d.showAsDropdown()?a="design-question-choice-label design-question-dropdown-label":(a="design-question-choice-label",b=f.createElement("input",{"aria-label":u.LocalizedStrings.DesignPage_OtherChoiceOptionRadioBox_AriaLabel,className:"design-question-choice-icon",disabled:!0,type:e.ChoiceType===y.MultiChoice?"checkbox":"radio"})),e.AllowOtherAnswer){var h=q.createTextField({HTMLAttributes:{className:"inline-display design-question-choice-option-textbox other-option",onFocus:function(){c.setState({SelectedElementIndex:o.otherChoiceElementIndex})}},MaxLength:w.QuestionOptionLength,onValueChange:function(){},Options:{HTMLPropsForInnerElement:{"aria-label":u.LocalizedStrings.DesignPage_OtherChoiceOptionInputBox_AriaLabel,className:"office-form-unselectable",disabled:!0,readOnly:!0}},Placeholder:u.LocalizedStrings.Designer_OtherAnswer,Value:""}),i=q.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{className:this.state.SelectedElementIndex===o.otherChoiceElementIndex?"option-edit-button active-choice":"option-edit-button",onBlur:function(){c.setState({SelectedElementIndex:o.otherChoiceElementIndex})},onClick:function(){c.onUpdateDone(function(){var a=c.addOptionRef.current;if(a){var b=g.findDOMNode(a);b.focus()}}),e.AllowOtherAnswer=!1}},Icon:"Delete",IconClassName:"option-edit-button-img forms-icon-size16x16",ref:this.removeOtherOptionRef,Text:u.LocalizedStrings.Delete_Button_Narrator});return f.createElement("div",{className:"design-question-choice"},f.createElement("div",{className:a},b,h,i))}},b.prototype.onAdd=function(a){var b,c=this.props.Master.Model,d=c.Choices,e=null;c.IsMathQuiz?(b="",e=!0):b=u.LocalizedStrings.Designer_Choices_DefaultDescription.format(a+1),c.Choices=Nerve.convertToArray(d).concat({Description:b,IsGenerated:!0,IsMathOption:e}),this.setState({SelectedElementIndex:a})},b.prototype.onDelete=function(a,b){var c=this.props.Master,d=c.Model,e=d.Choices,f=d.DefaultValue&&JSON.parse(d.DefaultValue);if(f&&Object.keys(f).length>0){f.hasOwnProperty(b)&&delete f[b];for(var g=b+1;g<e.length;g++)if(f.hasOwnProperty(g)){var h=f[g];f[g-1]=h,delete f[g]}}c.bulkEdit(function(){var a=Nerve.getObjectMasterFromModel(e[b]);a.Deleted=!0,d.DefaultValue=JSON.stringify(f),s.Flight.isEnabled(s.Flights.MultiLingualMVP1)&&Forms.Models.QuestionLocalizedItemMaster.handleChoicesV1Deleted(b,d.Id,c.Form)})},b.prototype.onToggleAnswerHint=function(a){var b=this;return function(){var c=b.props.Master.Model.Choices;a>=0&&a<c.length&&(j.log({eventName:t.DesignPage.Quiz.AnswerHint,eventType:"engagement_event",extraData:{toggleOn:null===c[a].AnswerHint}}),c[a].AnswerHint=null===c[a].AnswerHint?u.LocalizedStrings.Designer_Choices_AnswerHint_Placeholder:null)}},b.prototype.onCheck=function(a,b,c){var d=this.props.Master.Model,e=d.DefaultValue&&JSON.parse(d.DefaultValue),f=d.ChoiceType;c?(f!==y.MultiChoice&&e&&Object.keys(e).length>0&&(e=[]),e[b]=a):delete e[b],d.DefaultValue=JSON.stringify(e)},b.prototype.onKeyDown=function(a){var b=this;return function(c){var d=b.props.Master.Model,e=d.Choices,f=e.length;if(c.keyCode===i.KeyCode.Enter)if(a===f-1)b.onAdd(f);else{var h=g.findDOMNode(b),j=$(h).find(".design-question-choice")[a+1];if(e[a+1].IsMathOption){var k=$(j).find(".design-formula-mixer")[0];k&&k.focus()}else{var l=$(j).find(".design-question-choice-option-textbox input")[0];l&&l.focus()}}}},b.prototype.onPaste=function(a){var b=this,c=a.clipboardData,d=c.getData("text");if(d){var e=d.split("\n").filter(function(a){return!!a.trim()});if(e.length>1){var f=this.props.Master,g=f.Model,h=g.Choices,i=e.map(function(a){return{Description:a,IsGenerated:!1,IsMathOption:!1}}),k=h.length;f.bulkEdit(function(){for(var c=Nerve.convertToArray(h),d=a.target,e=b.state.SelectedElementIndex,f=h.length-1;f>e;--f){var j=Nerve.getObjectMasterFromModel(h[f]);j.Deleted=!0}h[e].Description=d.value.substring(0,d.selectionStart)+i.splice(0,1)[0].Description,i[i.length-1].Description+=d.value.substr(d.selectionEnd),c.splice.apply(c,[e+1,0].concat(i)),g.Choices=c}),j.log({eventName:t.DesignPage.Questions.PasteChoiceOptions,eventType:"engagement_event",extraData:{LinesAfter:h.length,LinesBefore:k}}),a.preventDefault()}}a.stopPropagation()},b.prototype.createSuggestionBarForOption=function(){var a=this;if(!s.Flight.isEnabled(s.Flights.EnableOptionSuggestsOption))return null;var b=(this.state.ChoiceCandidates||[]).filter(function(b){return!a.hasChoice(b.text)}),c=null;if(!this.props.Master.Model.IsMathQuiz&&this.state.IntelligenceProvider===e.OptionSuggestionFromOption&&b&&b.length>0){var d=u.LocalizedStrings.DesignPage_OptionSuggestionItem_AriaLabel,g=u.LocalizedStrings.DesignPage_OptionSuggestionBar_AriaLabel,h=b.map(function(b,c){return q.createTextButton({ButtonStyle:"LightBackground",HTMLAttributes:{"aria-label":d.format(c+1,b.text),className:r.Html.combineAttributes("design-question-choice-candidate office-form-theme-primary-foreground","office-form-theme-bgcolor-hover"),onClick:function(c){a.chooseCandidate(b.text),a.setFocusToLastChoiceElement()}},key:c,Text:b.text})});c=f.createElement("div",{"aria-label":g.format(b.length),className:"design-question-candidate-bar"},h)}return f.createElement("div",{"aria-live":"polite",className:"design-question-candidate-bar-container"},c)},b.prototype.logQuizOptionSuggestionsShown=function(){var a=this.state.ChoiceCandidates;this.shownChoiceCandidates&&this.shownChoiceCandidates===a||(this.shownChoiceCandidates=a,this.logSuggestionCandidatesShown())},b.prototype.logQuizOptionSuggestionChosen=function(a,b){var c={candidateLength:a?a.length:0,candidatePosition:h.findIndex(this.state.ChoiceCandidates,function(b){return b.text===a}),candidateType:e[this.state.IntelligenceProvider],currentOptionCount:this.props.Master.Model.Choices.length,isCorrectAnswer:b,msftUser:OfficeFormServerInfo.userInfo.TenantId===x.getMsftTenantId(),questionId:this.props.Master.Model.Id};j.log({eventName:t.IntelligenceStatistic.ChoiceOptionSuggestion.Choose,eventType:"engagement_event",extraData:c}),j.log({eventName:t.Intelligence.ChoiceOptionSuggestion.Choose,eventType:"engagement_event",extraData:{candidateType:e[this.state.IntelligenceProvider]}})},b.prototype.logSuggestionCandidatesChosen=function(a){if(!this.isCandidateChosen||this.state.IntelligenceProvider===e.OptionSuggestionFromOption){var b={candidateLength:a?a.length:0,candidateType:e[this.state.IntelligenceProvider],isQuiz:this.props.Master.Model.IsQuiz,msftUser:OfficeFormServerInfo.userInfo.TenantId===x.getMsftTenantId(),optionSuggestionId:this.optionSuggestionId,questionId:this.props.Master.Model.Id};null!=this.state.MatchingPart&&(b.matchingPart=this.state.MatchingPart,b.firstChosen=a,b.firstChosenPosition=h.findIndex(this.state.ChoiceCandidates,function(b){return b.text===a})),j.log({eventName:t.IntelligenceStatistic.ChoiceOptionSuggestion.Choose,eventType:"engagement_event",extraData:b}),j.log({eventName:t.Intelligence.ChoiceOptionSuggestion.Choose,eventType:"engagement_event",extraData:{candidateType:e[this.state.IntelligenceProvider]}}),this.isCandidateChosen=!0}},b.prototype.logSuggestionCandidatesShown=function(){var a={candidatesCount:this.state.ChoiceCandidates?this.state.ChoiceCandidates.length:0,candidateType:e[this.state.IntelligenceProvider],isQuiz:this.props.Master.Model.IsQuiz,msftUser:OfficeFormServerInfo.userInfo.TenantId===x.getMsftTenantId(),optionSuggestionId:this.optionSuggestionId,questionId:this.props.Master.Model.Id};null!=this.state.MatchingPart&&(a.matchingPart=this.state.MatchingPart),j.log({eventName:t.IntelligenceStatistic.ChoiceOptionSuggestion.Show,eventType:"engagement_event",extraData:a}),j.log({eventName:t.Intelligence.ChoiceOptionSuggestion.Show,eventType:"engagement_event",extraData:{candidateType:e[this.state.IntelligenceProvider]}})},b.prototype.setFocusToLastChoiceElement=function(){var a=this.props.Master.Model.Choices;if(a&&a.length>0){var b=a.length-1;this.setState({SelectedElementIndex:b});var c=this.getElementRef(b).current;c&&$(c).find("input").focus()}},b}(n.FormulaSupportedQuestionDesigner);l.registerDesignerComponentClass(p.QuestionType.Choice,z)},function(a,b,c){"use strict";function d(a){var b=a.ImageMaster.Model;return b.ImageProcessingStatus===v.Picking||b.ErrorType!==o.ImageErrorType.NoError||o.hasImage(b)?g.createElement(y,f({},a)):void 0}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),f=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var g=c(0),h=c(6),i=c(3),j=c(7),k=c(2),l=c(1),m=c(151),n=OfficeForm.Exports.Control,o=OfficeForm.Exports.Models,p=OfficeForm.Exports.Resources,q=OfficeForm.Exports.FlexPane,r=OfficeForm.Exports.EngagementEventNames,s=OfficeForm.Exports.FormLimitation,t=OfficeForm.Exports.Utilities,u=o.ImageErrorType,v=o.ImageProcessingStatus,w=10,x=.1,y=function(a){function b(b){var c=a.call(this,b)||this;return c.mounted=!0,c.shouldRefreshCropper=!1,c.designImageRef=g.createRef(),c.imageContainerRef=g.createRef(),c.imageEditPaneRef=g.createRef(),c.downloadSpinnerRef=g.createRef(),c.buildingCropper=t.Promise.getResolvedPromise(),c.clickClassCallback=function(a){return c.onClickBackground(a)},c.zoomClassCallback=function(){return c.setZoomButtonState()},c.imageStyleChangeCallback=function(){return c.forceUpdate()},c.deleteImageCallback=function(){return c.deleteImage()},c.state={EditPaneEditButtonDisabled:!0,EditPaneExpanded:!1,ShowImageEditPane:!1,ZoomButtonState:m.ZoomButtonState.ZoomOutDisabled},c.onKeyDown=c.onKeyDown.bind(c),c.onLoad=c.onLoad.bind(c),c.onError=c.onError.bind(c),c.altTextChange=c.altTextChange.bind(c),c.onImageEditClick=c.onImageEditClick.bind(c),c.onImageStyleChange=c.onImageStyleChange.bind(c),c.onImageZoomClicked=c.onImageZoomClicked.bind(c),c.needCreateCanvas=c.needCreateCanvas.bind(c),c}return e(b,a),b.prototype.componentWillMount=function(){this.props.ImageSettingsMaster.validateImageSettings(),this.props.ImageSettingsMaster.observe(this.imageStyleChangeCallback,[o.ImageSettingsMaster.Schema.Layout,o.ImageSettingsMaster.Schema.Left,o.ImageSettingsMaster.Schema.Top]),this.props.ImageSettingsMaster.observe(this.needCreateCanvas,[o.ImageSettingsMaster.Schema.ContainerHeight,o.ImageSettingsMaster.Schema.ContainerWidth]),this.props.ImageMaster.observe(this.imageStyleChangeCallback,[o.ImageInfoMaster.Schema.ResourceUrl]),document.addEventListener("click",this.clickClassCallback),document.addEventListener("wheel",this.zoomClassCallback)},b.prototype.componentDidMount=function(){this.createImageCanvas()},b.prototype.componentDidUpdate=function(){this.shouldRefreshCropper?(this.shouldRefreshCropper=!1,this.createImageCanvas()):this.updateImageCanvas()},b.prototype.componentWillUnmount=function(){this.mounted=!1,this.props.ImageSettingsMaster.unobserve(this.imageStyleChangeCallback),this.props.ImageSettingsMaster.unobserve(this.needCreateCanvas),this.props.ImageMaster.unobserve(this.imageStyleChangeCallback),document.removeEventListener("click",this.clickClassCallback),document.removeEventListener("wheel",this.zoomClassCallback);var a=this.props.ImageMaster.Model;a&&a.ErrorType!==u.NoError&&(a.ErrorType=u.NoError);var b=this.designImageRef.current;if(b){if(!this.underSyncing()){var c=this.props.ImageSettingsMaster.Model,d=$(b).cropper("getCanvasData");d.naturalHeight===c.NaturalHeight&&d.naturalWidth===c.NaturalWidth&&(c.Left=Math.round(d.left),c.Top=Math.round(d.top),c.ActualWidth=Math.round(d.width),c.ActualHeight=Math.round(d.height))}$(b).cropper("destroy")}},b.prototype.render=function(){var a=i.extend({},this.props.HTMLAttributes);return a.className=t.Html.combineAttributes(a.className,"design-page-image-container"),g.createElement("div",f({},a),this.createImage(),this.createImageEditPane(),this.createImageError(),this.createSpinner())},b.prototype.updateImageCanvas=function(){var a=this.props.ImageMaster.Model,b=this.props.ImageSettingsMaster.Model;if(!this.underSyncing()&&a.ResourceUrl&&(null===a.ErrorType||a.ErrorType===u.NoError)){var c=this.designImageRef.current;if(c)try{$(c).cropper("setCanvasData",{height:b.ActualHeight||b.ContainerHeight,left:b.Left||0,naturalHeight:b.NaturalHeight,naturalWidth:b.NaturalWidth,top:b.Top||0,width:b.ActualWidth||b.ContainerWidth}),this.state.EditPaneExpanded?$(c).cropper("enable"):$(c).cropper("disable")}catch(d){var e=d.message||void 0,f=d.stack||void 0;k.log({eventName:r.Image.CanvasRender.Failure,eventType:"engagement_event",extraData:{error:e+" "+f,imageSrc:c.src,imageType:this.props.IsFormLogo?"Logo":"Question",location:"0"}})}}},b.prototype.createImageCanvas=function(){var a=this,b=this.props.ImageMaster.Model,c=this.props.ImageSettingsMaster.Model,d=$.Deferred();if(!this.underSyncing()&&b.ResourceUrl&&(null===b.ErrorType||b.ErrorType===u.NoError)){var e=this.designImageRef.current;e&&(this.buildingCropper.always(function(){try{$(e).cropper("destroy"),$(e).cropper({autoCropArea:1,background:!1,built:function(){var b=document.getElementsByClassName("cropper-invisible");$(b).css("opacity",0),k.log({eventName:r.Image.CanvasRender.Success,eventType:"engagement_event",extraData:{imageType:a.props.IsFormLogo?"Logo":"Question",location:"0"}}),a.updateImageCanvas(),d.resolve()},center:!1,checkCrossOrigin:!1,cropBoxMovable:!1,cropBoxResizable:!1,dragMode:"move",guides:!1,highlight:!1,minCanvasHeight:c.ContainerHeight,minCanvasWidth:c.ContainerWidth,minContainerHeight:0,minContainerWidth:0,modal:!1,responsive:!0,restore:!1,toggleDragModeOnDblclick:!1,viewMode:3})}catch(b){var f=b.message||void 0,g=b.stack||void 0;k.log({eventName:r.Image.CanvasRender.Failure,eventType:"engagement_event",extraData:{error:f+" "+g,imageSrc:e.src,imageType:a.props.IsFormLogo?"Logo":"Question",location:"0"}}),d.reject()}}),this.buildingCropper=d.promise())}},b.prototype.createSpinner=function(){return this.underSyncing()?b.createSpinnerInternal():void 0},b.createSpinnerInternal=function(a){return g.createElement("div",{className:"image-spinner",ref:a},g.createElement("div",{className:"spinner-tile-animation"}))},b.prototype.createImage=function(){var a=this.props.ImageMaster&&this.props.ImageMaster.Model;if(null!==a.ErrorType&&a.ErrorType!==u.NoError)return null;if(!a.ResourceUrl&&!this.underSyncing())return null;var c,d,e,f,h,i,j,k=b.createSpinnerInternal(this.downloadSpinnerRef);if(a.ResourceUrl){d="design-question-title-image-button",a.ImageProcessingStatus===v.Deleting?d=t.Html.combineAttributes(d,"office-form-theme-border","design-question-title-image-gray"):j=this.imageContainerRef;var l=this.props.ImageSettingsMaster&&this.props.ImageSettingsMaster.Model;l?l.ContainerWidth&&l.ContainerHeight&&(h=l.ContainerHeight+"px",i=l.ContainerWidth+"px",!this.props.IsFormLogo&&l.ContainerWidth>s.QuestionCarMaxWidth&&(i=s.QuestionCarMaxWidth+"px",h=l.ContainerHeight/l.ContainerWidth*s.QuestionCarMaxWidth+"px"),c=a.ResourceUrl):c=a.ResourceUrl}return c||(d="design-question-title-image-button-placeholder office-form-theme-border",f=s.ImagePlaceHolderHeight+"px",e=s.ImagePlaceHolderWidth+"px"),g.createElement("div",{ref:j},g.createElement("div",{"aria-label":p.LocalizedStrings.DesignPage_Image_ImageDesigner,className:d,onKeyDown:this.onKeyDown,style:{height:f,width:e},tabIndex:0},g.createElement("img",{alt:a.AltText,className:"design-question-title-image-hidden",height:h,onError:this.onError,onLoad:this.onLoad,ref:this.designImageRef,src:c,title:a.AltText,width:i})),k)},b.prototype.onKeyDown=function(a){var b=this.designImageRef.current;switch(a.keyCode){case j.KeyCode.Delete:this.deleteImage();break;case j.KeyCode.ArrowLeft:$(b).cropper("move",-w,0);break;case j.KeyCode.ArrowUp:$(b).cropper("move",0,-w);break;case j.KeyCode.ArrowRight:$(b).cropper("move",w,0);break;case j.KeyCode.ArrowDown:$(b).cropper("move",0,w)}},b.prototype.onLoad=function(){k.log({eventName:r.Image.ImageOnLoad.Success,eventType:"engagement_event",extraData:{imageType:this.props.IsFormLogo?"Logo":"Question",location:"0"}});var a=this.downloadSpinnerRef.current;a&&$(a).css("display","none"),this.shouldRefreshCropper=!0,this.setState({EditPaneEditButtonDisabled:!1,ShowImageEditPane:!0})},b.prototype.onError=function(a){var b=this.designImageRef.current;if(b){$(b).css("visibility","visible"),k.log({eventName:r.Image.ImageOnLoad.Failure,eventType:"engagement_event",extraData:{imageSrc:b.src,imageType:this.props.IsFormLogo?"Logo":"Question",location:"0"}});var c=this.downloadSpinnerRef.current;c&&$(c).css("display","none"),this.setState({EditPaneEditButtonDisabled:!0,ShowImageEditPane:!0})}},b.prototype.createImageError=function(){var a=this,b=this.props.ImageSettingsMaster.Model,c=this.props.ImageMaster,d=c.Model;if(this.underSyncing()||d.ErrorType===u.NoError)return null;var e,f=n.createLabel({HTMLAttributes:{className:"error-message"},Label:c.getImageErrorMessage()});e=d.ErrorType===u.DeleteFailError?n.createTextButton({ButtonStyle:"LightBackground",HTMLAttributes:{className:"office-form-theme-primary-foreground",onClick:function(){return c.clear()}},Text:p.LocalizedStrings.DesignPage_Image_UploadAgain}):n.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"Horizontal",HTMLAttributes:{className:"office-form-theme-primary-foreground",onClick:function(){k.log({eventName:a.props.IsFormLogo?r.DesignPage.Form.AddImage_Logo:r.DesignPage.Questions.AddImage,eventType:"engagement_event"}),q.pickImage().done(function(a){return c.addImage(a)})}},Icon:"Photo2",IconClassName:"errorPictureIcon forms-icon-size12x12",Text:p.LocalizedStrings.DesignPage_Image_UploadAgain});var h=n.createFontIconControl({HTMLAttributes:{className:"image-error-frowny-icon"},IconName:"Sad"});return g.createElement("div",{className:"design-image-error office-form-theme-border",style:{height:b.ContainerHeight,width:b.ContainerWidth}},h,f,g.createElement("div",null,e))},b.prototype.createImageEditPane=function(){var a=this.props.ImageMaster.Model,b=this.props.ImageSettingsMaster&&this.props.ImageSettingsMaster.Model;return a.ResourceUrl&&!this.underSyncing()&&a.ErrorType===u.NoError&&this.state.ShowImageEditPane?g.createElement(m.ImageEditPane,{EditButtonDisabled:this.state.EditPaneEditButtonDisabled,Expanded:this.state.EditPaneExpanded,imageId:a.ResourceId,onImageEditClick:this.onImageEditClick,onImageStyleChange:this.props.IsFormLogo?void 0:this.onImageStyleChange,onImageZoomClick:this.onImageZoomClicked,onImageDeleteClick:this.deleteImageCallback,onValueChange:this.altTextChange,ref:this.imageEditPaneRef,SelectedImageSize:b&&b.Size,SizeButtontDisabled:this.props.IsFormLogo,Value:a.AltText,ZoomButtonDisabled:!1,ZoomButtonState:this.state.ZoomButtonState}):a.ResourceUrl&&null===b.TargetResourceId&&this.underSyncing()?g.createElement(m.ImageEditPane,{EditButtonDisabled:!0,imageId:a.ResourceId,onImageDeleteClick:this.deleteImageCallback,onValueChange:this.altTextChange,ref:"edit-pane-container",Value:a.AltText}):void 0},b.prototype.altTextChange=function(a){this.props.ImageMaster.Model.AltText=a},b.prototype.onImageStyleChange=function(a){var b=this.props.ImageMaster.Model,c=this.props.ImageSettingsMaster,d=c.Model;k.log({eventName:r.DesignPage.ImageEditPane.Style,eventType:"engagement_event",extraData:{imageId:b.ResourceId,style:a}}),d.Size!==a&&this.setState({ZoomButtonState:m.ZoomButtonState.ZoomOutDisabled}),c.onImageStyleChange(a)},b.prototype.onImageEditClick=function(){k.log({eventName:r.DesignPage.ImageEditPane.Edit,eventType:"engagement_event"}),this.setState({EditPaneExpanded:!0});var a=this.designImageRef.current;$(a).cropper("enable"),this.setZoomButtonState()},b.prototype.onImageZoomClicked=function(a,b){var c=this.designImageRef.current;if(a)switch(this.state.ZoomButtonState){case m.ZoomButtonState.AllEnabled:case m.ZoomButtonState.ZoomOutDisabled:$(c).cropper("zoom",x),k.log({eventName:r.DesignPage.ImageEditPane.ZoomIn,eventType:"engagement_event"})}else switch(this.state.ZoomButtonState){case m.ZoomButtonState.AllEnabled:case m.ZoomButtonState.ZoomInDisabled:$(c).cropper("zoom",-x),k.log({eventName:r.DesignPage.ImageEditPane.ZoomOut,eventType:"engagement_event"})}this.setZoomButtonState(b)},b.prototype.setZoomButtonState=function(a){if(!this.underSyncing()){var b=this.designImageRef.current,c=$(b).cropper("getCanvasData"),d=this.props.ImageSettingsMaster.Model,e=void 0;c.width&&c.height&&(this.props.ImageSettingsMaster.bulkEdit(function(a){a.Left=Math.round(c.left),a.Top=Math.round(c.top),a.ActualWidth=Math.round(c.width),a.ActualHeight=Math.round(c.height)}),e=c.width>2*d.ContainerWidth&&c.height>2*d.ContainerHeight?m.ZoomButtonState.ZoomInDisabled:c.width-d.ContainerWidth<1||c.height-d.ContainerHeight<1?m.ZoomButtonState.ZoomOutDisabled:m.ZoomButtonState.AllEnabled,this.state.ZoomButtonState!==e&&this.setState({ZoomButtonState:e},a))}},b.prototype.deleteImage=function(){var a=this,b=this.props.ImageMaster,c=this.props.ImageSettingsMaster;k.log({eventName:r.DesignPage.ImageEditPane.Delete,eventType:"engagement_event",extraData:{imageKind:this.props.IsFormLogo?"Logo":"Question"}}),b.clear().then(function(){var b=a.designImageRef.current;$(b).cropper("destroy"),c.clear(),a.mounted&&a.setState({EditPaneExpanded:!1})})},b.prototype.onClickBackground=function(a){if(this.state.EditPaneExpanded&&-1===a.target.id.indexOf("image-edit-pane-edit-button")&&a.target.parentElement&&-1===a.target.parentElement.id.indexOf("image-edit-pane-edit-button")&&-1===a.target.parentElement.className.indexOf("forms-icon-container")){var b=this.imageContainerRef.current,c=this.imageEditPaneRef.current;if(b&&c){var d=h.findDOMNode(b),e=h.findDOMNode(c);if(!d.contains(a.target)&&!e.contains(a.target)&&-1===a.target.className.indexOf("ms-Icon")&&a.target.title!==p.LocalizedStrings.ImageEditPane_AltText_Button){var f=this.designImageRef.current;$(f).cropper("disable"),this.setState({EditPaneExpanded:!1})}}}},b.prototype.underSyncing=function(){var a=this.props.ImageMaster.Model,b=this.props.ImageSettingsMaster.Model;return a.ResourceId!==b.TargetResourceId||a.ImageProcessingStatus!==v.Idle},b.prototype.needCreateCanvas=function(){this.shouldRefreshCropper=!0},b}(l.ReactComponent);b.ImageContainer=y,b.createImageDesignerContainer=d,Forms.UX.Designer.createImageDesignerContainer=d},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e,f=c(0),g=c(6),h=c(2),i=c(1),j=OfficeForm.Exports.Control,k=OfficeForm.Exports.Models,l=OfficeForm.Exports.Resources,m=OfficeForm.Exports.Utilities,n=OfficeForm.Exports.FormLimitation,o=OfficeForm.Exports.EngagementEventNames,p=k.ImageSize;!function(a){a[a.ZoomInDisabled=0]="ZoomInDisabled",a[a.ZoomOutDisabled=1]="ZoomOutDisabled",a[a.AllDisabled=2]="AllDisabled",a[a.AllEnabled=3]="AllEnabled"}(e=b.ZoomButtonState||(b.ZoomButtonState={}));var q=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.smallSizeButtonRef=f.createRef(),b.altTextButtonRef=f.createRef(),b.altTextFieldRef=f.createRef(),b.zoomInButtonRef=f.createRef(),b.zoomOutButtonRef=f.createRef(),b.needChangeFocus=!1,b.needChangeFocusToAltText=!1,b.state={ShowAltTextButton:!0},b.clickClassCallback=function(a){return b.onClickBackground(a)},b}return d(b,a),b.prototype.componentWillMount=function(){document.addEventListener("click",this.clickClassCallback)},b.prototype.componentDidUpdate=function(){var a=this.smallSizeButtonRef.current;if(this.needChangeFocus&&a){var b=g.findDOMNode(a);b.focus(),this.needChangeFocus=!1}var c=this.altTextFieldRef.current;if(this.needChangeFocusToAltText&&c){var d=g.findDOMNode(c);d.getElementsByTagName("input")[0].focus(),this.needChangeFocusToAltText=!1}},b.prototype.componentWillUnmount=function(){document.removeEventListener("click",this.clickClassCallback)},b.prototype.render=function(){var a=[];return this.props.Expanded?(this.props.SizeButtontDisabled||a.push(this.createImageSizeButtons()),this.props.ZoomButtonDisabled||a.push(this.createImageZoomInOutButtons()),a.push(this.createImageAltTextTextbox())):a.push(this.createImageEditButton()),a.push(this.createImageDeleteButton()),f.createElement("div",{className:"image-edit-pane-container office-form-theme-border"},a)},b.prototype.isZoomInDisabled=function(){return this.props.ZoomButtonState===e.AllDisabled||this.props.ZoomButtonState===e.ZoomInDisabled},b.prototype.isZoomOutDisabled=function(){return this.props.ZoomButtonState===e.AllDisabled||this.props.ZoomButtonState===e.ZoomOutDisabled},b.prototype.onImageSizeButtonClick=function(a){this.props.SelectedImageSize!==a&&this.props.onImageStyleChange&&this.props.onImageStyleChange(a)},b.prototype.createImageEditButton=function(){
var a=this,b=j.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{className:"image-edit-pane-inner-button office-form-theme-button-foreground",disabled:this.props.EditButtonDisabled,id:"image-edit-pane-edit-button",onClick:function(){a.props.onImageEditClick&&a.props.onImageEditClick()}},Icon:"Edit",IconClassName:"forms-icon-size14x14",Text:l.LocalizedStrings.ImageEditPane_Edit_Button||void 0});return this.needChangeFocus=!0,f.createElement("div",{className:"image-edit-pane-edit",key:"edit-button"},b)},b.prototype.createImageSizeButtons=function(){var a=this,b="image-edit-pane-inner-button office-form-theme-button-foreground";this.props.SelectedImageSize===p.Small&&(b=m.Html.combineAttributes(b,"active"));var c=j.createButton({ButtonStyle:"LightBackground",children:j.createFontIconControl({HTMLAttributes:{className:"image-edit-pane-inner-button-icon forms-icon-size14x14"},IconName:"moderateIcon"}),HTMLAttributes:{"aria-label":l.LocalizedStrings.ImageEditPane_SmallSize_Button||void 0,className:b,onClick:function(){return a.onImageSizeButtonClick(p.Small)},title:l.LocalizedStrings.ImageEditPane_SmallSize_Button||void 0},ref:this.smallSizeButtonRef}),d="image-edit-pane-inner-button office-form-theme-button-foreground";this.props.SelectedImageSize===p.Large&&(d=m.Html.combineAttributes(d,"active"));var e=j.createButton({ButtonStyle:"LightBackground",children:j.createFontIconControl({HTMLAttributes:{className:"image-edit-pane-inner-button-icon forms-icon-size14x14"},IconName:"intenseIcon"}),HTMLAttributes:{"aria-label":l.LocalizedStrings.ImageEditPane_LargeSize_Button||void 0,className:d,onClick:function(){return a.onImageSizeButtonClick(p.Large)},title:l.LocalizedStrings.ImageEditPane_LargeSize_Button||void 0}});return f.createElement("div",{className:"image-edit-pane-element-container office-form-theme-border",key:"size-button"},c,e)},b.prototype.createImageZoomInOutButtons=function(){var a=this,b="image-edit-pane-inner-button";this.isZoomInDisabled()||(b=m.Html.combineAttributes(b,"office-form-theme-button-foreground"));var c=j.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{className:b,disabled:this.isZoomInDisabled(),onClick:function(){a.props.onImageZoomClick&&a.props.onImageZoomClick(!0,function(){a.isZoomInDisabled()&&a.zoomOutButtonRef.current&&a.zoomOutButtonRef.current.focus()})}},Icon:"ZoomIn",IconClassName:"forms-icon-size15x15",ref:this.zoomInButtonRef,Text:l.LocalizedStrings.ImageEditPane_ZoomIn_Button||void 0}),d="image-edit-pane-inner-button";this.isZoomOutDisabled()||(d=m.Html.combineAttributes(b,"office-form-theme-button-foreground"));var e=j.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{className:d,disabled:this.isZoomOutDisabled(),onClick:function(){a.props.onImageZoomClick&&a.props.onImageZoomClick(!1,function(){a.isZoomOutDisabled()&&a.zoomInButtonRef.current&&a.zoomInButtonRef.current.focus()})}},Icon:"ZoomOut",IconClassName:"forms-icon-size15x15",ref:this.zoomOutButtonRef,Text:l.LocalizedStrings.ImageEditPane_ZoomOut_Button||void 0});return f.createElement("div",{className:"image-edit-pane-element-container office-form-theme-border",key:"zoom-button"},c,e)},b.prototype.createImageAltTextTextbox=function(){var a=this,b=j.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{className:"image-edit-pane-inner-button office-form-theme-button-foreground",onClick:function(){h.log({eventName:o.DesignPage.ImageEditPane.AltText,eventType:"engagement_event",extraData:{Id:a.props.imageId}}),a.setState({ShowAltTextButton:!1})}},Icon:"TextField",IconClassName:"edit-pane-fieldText",ref:this.altTextButtonRef,Text:l.LocalizedStrings.ImageEditPane_AltText_Button||void 0}),c=j.createTextField({AutoSelection:!0,MaxLength:n.ImageAltTextLength,MinimalHeight:28,onValueChange:this.props.onValueChange.bind(this.props),Placeholder:l.LocalizedStrings.ImageEditPane_AltText_PlaceHolder,ref:this.altTextFieldRef,TextFieldType:j.TextFieldType.SingleLine,Value:this.props.Value});return this.state.ShowAltTextButton?f.createElement("div",{className:"image-edit-pane-alttext-button office-form-theme-border",key:"alttext-button"},b):(this.needChangeFocusToAltText=!0,f.createElement("div",{className:"image-edit-pane-alttext office-form-theme-border",key:"alttext"},c))},b.prototype.createImageDeleteButton=function(){var a=this,b=j.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{className:"image-edit-pane-inner-button office-form-theme-button-foreground",onClick:function(){a.props.onImageDeleteClick&&a.props.onImageDeleteClick()}},Icon:"Delete",IconClassName:"forms-icon-size14x14",Text:l.LocalizedStrings.ImageEditPane_Delete_Button||void 0});return f.createElement("div",{className:"image-edit-pane-delete",key:"delete-button"},b)},b.prototype.onClickBackground=function(a){var b=this.altTextFieldRef.current;if(b){var c=g.findDOMNode(b);c.contains(a.target)||-1!==a.target.className.indexOf("edit-pane-fieldText")||a.target.title===l.LocalizedStrings.ImageEditPane_AltText_Button||this.setState({ShowAltTextButton:!0})}},b}(i.ReactComponent);b.ImageEditPane=q},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(23),g=c(24),h=OfficeForm.Exports.Control,i=OfficeForm.Exports.Models,j=OfficeForm.Exports.Resources,k=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.createReactNodes=function(){var a=h.createFontIconControl({HTMLAttributes:{className:"date-snapshot-event-icon forms-icon-size22x22"},IconName:"Calendar"}),b=j.LocalizedStrings.QuestionType_DateTime_PlaceHolder.format(OfficeFormServerInfo.cultureInfo.DateTimeFormat.ShortDatePattern);return e.createElement("div",{className:"design-question-element"},e.createElement("div",{className:"design-question-date-snapshot"},a,e.createElement("input",{className:"form-control office-form-unselectable",disabled:!0,placeholder:b})))},b}(g.QuestionDesignerBase);f.registerDesignerComponentClass(i.QuestionType.DateTime,k)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(2),f=c(23),g=c(24),h=OfficeForm.Exports.Models,i=OfficeForm.Exports.Control,j=OfficeForm.Exports.Resources,k=OfficeForm.Exports.EngagementEventNames,l=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.createReactNodes=function(){var a=this;return[Forms.UX.FileUpload.createFileUploadDesigner({FileTypes:this.props.Master.Model.FileTypes,HasSpecificFileType:this.props.Master.Model.HasSpecificFileType,setSpecificFileTypeCallback:function(b){return a.props.Master.Model.HasSpecificFileType=b}})]},b.prototype.createValidationItem=function(){var a=this.props.Master,b=a.Model,c=function(){e.log({eventName:k.DesignPage.QuestionMenu.Validation,eventType:"engagement_event",extraData:{questionType:b.Type,value:b.HasSpecificFileType}}),a.bulkEdit(function(){b.HasSpecificFileType=!b.HasSpecificFileType,b.FileTypes.Image=!0,b.FileTypes.Word=!0,b.FileTypes.PDF=!0,b.FileTypes.PowerPoint=!0,b.FileTypes.Excel=!0,b.FileTypes.Video=!0,b.FileTypes.Audio=!0,b.FileTypes.Text=!0})};return{Checked:b.HasSpecificFileType,Description:j.LocalizedStrings.NumberValidation_Rule_Description_Label,Key:"validationItem",MenuItemType:i.MenuItemType.CheckBox,onExecute:c}},b}(g.QuestionDesignerBase);f.registerDesignerComponentClass(h.QuestionType.FileUpload,l)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(3),g=c(2),h=c(100),i=c(23),j=c(103),k=c(105),l=c(24),m=OfficeForm.Exports.Models,n=OfficeForm.Exports.FormLimitation,o=OfficeForm.Exports.Resources,p=OfficeForm.Exports.Control,q=OfficeForm.Exports.EngagementEventNames,r=OfficeForm.Exports.EnvironmentConfig,s=function(a){function b(b){var c=a.call(this,b)||this;return c.mounted=!0,c.isCandidatesShown=!1,c.isCandidateChosen=!1,c.editorMapping={},c.updateSubQuestionsCallbacks=[],c.saveRef=c.saveRef.bind(c),c.addOption=c.addOption.bind(c),c.addSubQuestion=c.addSubQuestion.bind(c),c.onSubQuestionsChange=c.onSubQuestionsChange.bind(c),c}return d(b,a),b.getDesignedModelName=function(){return m.Question.MatrixChoiceGroup.getElementTypeName()},b.prototype.componentWillUnmount=function(){this.mounted=!1;var b=Nerve.getCollectionMasterFromModel(this.props.Master.Form.Model.Questions);b.unobserve(this.onSubQuestionsChange),a.prototype.componentWillUnmount.call(this)},b.prototype.componentDidMount=function(){a.prototype.componentDidMount.call(this);var b=Nerve.getCollectionMasterFromModel(this.props.Master.Form.Model.Questions);b.observe(this.onSubQuestionsChange),this.fetchIntelligenceSuggestions()},b.prototype.onTitleValueChange=function(){this.fetchIntelligenceSuggestions()},b.prototype.createReactNodes=function(){var a=this.props.Master,b=this.createHeaderLine(),c=this.createContentsLine(),d=e.createElement("div",{className:"design-question-matrix-table",key:"matrixs"},e.createElement("table",null,b,c)),f=a.SubQuestionMasters.length,g=n.LikertRowMaxSize>f?this.createOptionButton():void 0;return[d,g]},b.prototype.createSuggestionBar=function(){var a=this,b=(this.state.LikertOptionsCandidate||[]).filter(function(b){return!a.hasOption(b)});if(!b||b.length<=0)return null;var c=[o.LocalizedStrings.Designer_Intelligence_Options],d=p.createTextButton({ButtonStyle:"LightBackground",HTMLAttributes:{className:"design-question-choice-candidate office-form-theme-button",onClick:function(){b.forEach(function(b){return a.applyIntelligenceSuggestions(b)}),a.setFocusToTitleElement()}},Text:o.LocalizedStrings.Designer_Intelligence_AddAll}),f="design-question-choice-candidate office-form-theme-primary-foreground office-form-theme-bgcolor-hover",h=b.map(function(c,d){return p.createTextButton({ButtonStyle:"LightBackground",HTMLAttributes:{className:f,onClick:function(){a.applyIntelligenceSuggestions(c),(1===b.length||d===b.length-1)&&a.setFocusToTitleElement()}},key:d,Text:c})});return this.isCandidatesShown||(g.log({eventName:q.IntelligenceStatistic.LikertOptionSuggestion.Show,eventType:"engagement_event",extraData:{DetectedLang:this.state.DetectedLang,IsQuiz:this.props.Master.Model.IsQuiz,MatchingPart:this.state.MatchingPart,MsftUser:OfficeFormServerInfo.userInfo.TenantId===r.getMsftTenantId(),QuestionId:this.props.Master.Model.Id}}),g.log({eventName:q.Intelligence.LikertOptionSuggestion.Show,eventType:"engagement_event"}),this.isCandidatesShown=!0),e.createElement("div",{className:"design-question-candidate-bar"},c,d,h)},b.prototype.onSubQuestionsChange=function(a){var b=this.props.Master.Model.Id,c=a.AddedModels.concat(Nerve.convertToArray(a.RemovedModels)).map(Nerve.getObjectMasterFromModel).some(function(a){return a.Model.GroupId===b});if(c){var d=this.updateSubQuestionsCallbacks;this.updateSubQuestionsCallbacks=[],this.forceUpdate(function(){return d.forEach(function(a){return a()})})}},b.prototype.createHeaderLine=function(){var a=this,b=this.props.Master.Model,c=b.ChoiceGroup,d=c.length,g=[e.createElement("td",{key:"matrixTd"})],h=f.map(c,function(b,c){var f=Nerve.getObjectMasterFromModel(b);return e.createElement(j.LikertChoiceDesigner,{addOption:a.addOption,Count:d,IsLast:c===d-1,key:f.getInstanceId(),Master:f,saveRef:a.saveRef})});g=g.concat(h);var i,k=p.createGlyphButton({GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{"aria-label":o.LocalizedStrings.Designer_AddOneMore,onClick:this.addOption},Icon:"Add",IconClassName:"forms-icon-size16x16"});c.length<n.LikertColumnMaxSize&&(i=e.createElement("td",{className:"design-question-add-option"},k));var l=e.createElement("tr",{className:"design-question-matrix-pr"},g,i);return e.createElement("thead",{className:"design-question-matrix-pthead"},l)},b.prototype.addOption=function(){var a=this,c=this.props.Master.Model,d=c.ChoiceGroup,e=d.length;if(e<n.LikertColumnMaxSize){g.log({eventName:q.DesignPage.Questions.AddLikertOption,eventType:"engagement_event",extraData:{index:e,questionId:c.Id}}),this.onUpdateDone(function(){var b=Nerve.getObjectMasterFromModel(c.ChoiceGroup[e]).getInstanceId(),d=a.editorMapping[b].current;d&&d.focus()});var f={Description:o.LocalizedStrings.Designer_Choices_DefaultDescription.format(e+1),Order:b.generateNonDuplicateID()};c.ChoiceGroup=Nerve.convertToArray(d).concat(f)}},b.generateNonDuplicateID=function(){return Date.now()},b.prototype.createContentsLine=function(){var a=this,c=this.props.Master,d=c.Model,g=f.map(d.ChoiceGroup,function(a,c){return b.createMatrixRadio(c,a.Description)}),h=c.SubQuestionMasters,i=h.length,j=f.map(h,function(b,c){return e.createElement(k.LikertQuestionRowDesigner,{addQuestion:a.addSubQuestion,Count:i,IsLast:c===i-1,key:b.Model.Id,Master:b,saveRef:a.saveRef},g)});return e.createElement("tbody",{className:"design-question-matrix-stbody"},j)},b.prototype.createOptionButton=function(){var a=p.createGlyphButton({ButtonStyle:"LightBackground",HTMLAttributes:{className:"design-question-button office-form-theme-button-color",onClick:this.addSubQuestion},Icon:"Add",IconClassName:"forms-icon-size18x18 office-form-theme-primary-foreground",Text:o.LocalizedStrings.Designer_AddOneMoreRow,TextClassName:"design-question-addonemore"});return e.createElement("div",{className:"design-question-addbutton-container",key:"addButton"},a)},b.prototype.addSubQuestion=function(){var a=this,b=this.props.Master.SubQuestionMasters.length;if(b<n.LikertRowMaxSize){g.log({eventName:q.DesignPage.Questions.AddLikertSubquestion,eventType:"engagement_event",extraData:{index:b,questionId:this.props.Master.Model.Id}}),this.updateSubQuestionsCallbacks.push(function(){var c=a.editorMapping[a.props.Master.SubQuestionMasters[b].Model.Id].current;c&&c.focus()});var c={Title:o.LocalizedStrings.Desinger_Likert_DefaultDescription.format(b+1),Type:"Question.MatrixChoice"};this.props.Master.addSubQuestion(c)}},b.createMatrixRadio=function(a,b){return e.createElement("td",{className:"design-question-matrix-radio",key:a},e.createElement("input",{"aria-disabled":!0,"aria-label":b,className:"design-question-matrix-radio",disabled:!0,name:"subquestion-radio",type:"radio"}))},b.prototype.saveRef=function(a){return this.editorMapping[a]||(this.editorMapping[a]=e.createRef()),this.editorMapping[a]},b.prototype.fetchIntelligenceSuggestions=function(){var a=this,b=this.props.Master.Model;if(!b.IsMathQuiz){var c=500;window.clearTimeout(this.textAnalysisTimeOut),this.textAnalysisTimeOut=window.setTimeout(function(){h.FormIntelligenceLauncher.getLikertQuestionSuggest(b.Title).done(function(b){a.mounted&&(b&&b.MatchQuery&&b.Suggestion?a.setState({DetectedLang:b.Suggestion.DetectedLanguage,LikertOptionsCandidate:b.Suggestion.ChoiceCandidates,MatchingPart:b.Suggestion.MatchingPart}):a.setState({DetectedLang:void 0,LikertOptionsCandidate:[],MatchingPart:void 0}))}).fail(function(b){a.mounted&&a.setState({DetectedLang:void 0,LikertOptionsCandidate:[],MatchingPart:void 0})})},c)}},b.prototype.applyIntelligenceSuggestions=function(a){this.isCandidateChosen||(g.log({eventName:q.IntelligenceStatistic.LikertOptionSuggestion.Choose,eventType:"engagement_event",extraData:{DetectedLang:this.state.DetectedLang,IsQuiz:this.props.Master.Model.IsQuiz,MatchingPart:this.state.MatchingPart,MsftUser:OfficeFormServerInfo.userInfo.TenantId===r.getMsftTenantId(),QuestionId:this.props.Master.Model.Id}}),g.log({eventName:q.Intelligence.LikertOptionSuggestion.Choose,eventType:"engagement_event"}),this.isCandidateChosen=!0);var b=this.props.Master.Model,c=b.ChoiceGroup,d=f.find(c,function(a){return a.IsGenerated}),e=f.max(c,function(a){return a.Order});if(d){var h=Nerve.getObjectMasterFromModel(d);h.bulkEdit(function(){d.Description=a,d.IsGenerated=null,d.IsMathOption=!1})}else Nerve.Collection.addItems(c,[{Description:a,IsMathOption:!1,Order:e?e.Order+1:1}])},b.prototype.hasOption=function(a){var b=this.props.Master.Model,c=b.ChoiceGroup;return f.some(c,function(b){return b.Description?b.Description.replace(/\s/g,"")===a.replace(/\s/g,""):!1})},b}(l.QuestionDesignerBase);i.registerDesignerComponentClass(m.QuestionType.MatrixChoiceGroup,s)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(23),g=c(24),h=OfficeForm.Exports.Models,i=OfficeForm.Exports.Control,j=OfficeForm.Exports.Resources,k=25,l=function(a){function b(b){var c=a.call(this,b)||this;return c.onLeftLabelChange=function(a){return c.props.Master.Model.LeftDescription=a},c.onRightLabelChange=function(a){return c.props.Master.Model.RightDescription=a},c}return d(b,a),b.prototype.createReactNodes=function(){return[e.createElement("div",{className:"design-question-element design-question-nps-container"},e.createElement(Forms.UX.Controls.NPSControl,{Disabled:!0,Value:void 0}),this.createLabels())]},b.prototype.createLabels=function(){var a=this.props.Master.Model,b=i.createTextField({HTMLAttributes:{className:"rating-option-description-designer"},MinimalHeight:k,onValueChange:this.onLeftLabelChange,Options:{HTMLPropsForInnerElement:{"aria-label":j.LocalizedStrings.Designer_NPSDescription_Label.format(0)}},Placeholder:j.LocalizedStrings.Designer_PlaceholderForRatingDescription,TextFieldType:i.TextFieldType.SingleLine,Value:a.LeftDescription}),c=i.createTextField({HTMLAttributes:{className:"rating-option-description-designer"},MinimalHeight:k,onValueChange:this.onRightLabelChange,Options:{HTMLPropsForInnerElement:{"aria-label":j.LocalizedStrings.Designer_NPSDescription_Label.format(10)}},Placeholder:j.LocalizedStrings.Designer_PlaceholderForRatingDescription,TextFieldType:i.TextFieldType.SingleLine,Value:a.RightDescription});return e.createElement("div",{className:"nps-label-container clearfix"},b,c)},b}(g.QuestionDesignerBase);f.registerDesignerComponentClass(h.QuestionType.NPS,l)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(3),h=c(7),i=c(2),j=c(23),k=c(24),l=OfficeForm.Exports.Utilities,m=OfficeForm.Exports.Models,n=OfficeForm.Exports.Control,o=OfficeForm.Exports.Resources,p=OfficeForm.Exports.FormLimitation,q=OfficeForm.Exports.EngagementEventNames,r=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.componentWillMount=function(){a.prototype.componentWillMount.call(this);var b=this.getQuestionMaster().Model,c=b.ChoiceGroup;b.GradingBasis||(b.GradingBasis=JSON.stringify(g.map(c,function(a){return a.Key}))),this.onKeyDown=this.onKeyDown.bind(this)},b.prototype.createReactNodes=function(){var a=this.createCorrectAnswerTip(),b=this.createListItems(),c=this.createAddOptionButton();return[a,b,c]},b.prototype.createListItems=function(){var a=this.createSortableList();return f.createElement("div",{className:"design-sort-list"},a)},b.prototype.createSortableList=function(){var a=this,b=this.getQuestionMaster().Model,c=b.ChoiceGroup;return g.map(c,function(d,e){var g=n.createTextField({AutoFocus:a.state.SelectedElementIndex===e,AutoSelection:!0,HTMLAttributes:{className:"design-sort-list-item",onFocus:function(){a.setState({SelectedElementIndex:e})},onKeyDown:a.onKeyDown(e)},MaxLength:p.QuestionOptionLength,onValueChange:a.onChoiceChange(e),Placeholder:o.LocalizedStrings.Designer_Choices_Placeholder,ref:a.getElementRef(e),Value:d.Description}),h=f.createElement("div",{className:"design-sort-item-parents"},g),j=a.state.SelectedElementIndex===e?"design-sort-item-button inline-block-display":"design-sort-item-button none-display",k=n.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{className:j,onClick:function(){i.log({eventName:q.DesignPage.Questions.DeleteRankingOption,eventType:"engagement_event",extraData:{questionId:b.Id,questionType:b.Type}});var d=Nerve.convertToArray(c),f=d[e],g=Nerve.getObjectMasterFromModel(f);if(g.isFieldReady(m.ChoiceV2Master.Schema.Id)){d.splice(e,1);var h=JSON.parse(b.GradingBasis),j=h.indexOf(f.Key);-1!==j&&h.splice(j,1),a.getQuestionMaster().bulkEdit(function(){b.GradingBasis=JSON.stringify(h),b.ChoiceGroup=d,a.setState({SelectedElementIndex:e})})}}},Icon:"Delete",IconClassName:"forms-icon-size16x16",Text:o.LocalizedStrings.Delete_Button_Narrator});return f.createElement("div",{className:"design-sort-item",key:e},h,k)})},b.prototype.getQuestionMaster=function(){return this.props.Master},b.prototype.createCorrectAnswerTip=function(){var a=this.props.Master.Model.IsQuiz,b=o.LocalizedStrings.Designer_Ranking_Tip,c={HTMLAttributes:{className:"design-sort-list-tip forms-icon-size14x14"},IconName:"CheckMark"};return a?f.createElement("div",{className:"design-sort-tip-container"},f.createElement(n.FontIconControl,e({},c)),f.createElement("span",null,b)):void 0},b.prototype.createAddOptionButton=function(){var a=this,b=this.getQuestionMaster().Model,c=b.ChoiceGroup;if(c.length>=p.MaxRankingItemNumber)return void 0;var d={"aria-label":o.LocalizedStrings.Designer_Question_Equation_Button,className:"design-question-button office-form-theme-button-color",onClick:function(){i.log({eventName:q.DesignPage.Questions.AddRankingOption,eventType:"engagement_event",extraData:{index:c.length,questionId:b.Id,questionType:b.Type}}),a.onAdd()}},e=n.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"Horizontal",HTMLAttributes:d,Icon:"Add",IconClassName:"forms-icon-size18x18 office-form-theme-primary-foreground",Text:o.LocalizedStrings.Designer_AddOneMore,TextClassName:"design-question-addonemore"});return f.createElement("div",{className:"design-question-addbutton-container"},e)},b.prototype.onAdd=function(){var a=this,c=this.getQuestionMaster(),d=c.Model,e=d.ChoiceGroup,f=Nerve.convertToArray(e),g=e.length,h=o.LocalizedStrings.Designer_Choices_DefaultDescription.format(g+1),i=l.Guid.newGuid(),j=b.generateNonDuplicateOrder(),k={Description:h,Key:i,Order:j};f.push(k);var m=JSON.parse(d.GradingBasis);m.push(i),c.bulkEdit(function(){d.GradingBasis=JSON.stringify(m),d.ChoiceGroup=f,a.setState({SelectedElementIndex:d.ChoiceGroup.length-1})})},b.prototype.onChoiceChange=function(a){var b=this;return function(c){var d=b.getQuestionMaster().Model.ChoiceGroup[a];d&&(d.Description=c)}},b.prototype.onKeyDown=function(a){var b=this;return function(c){var d=b.getQuestionMaster().Model,e=d.ChoiceGroup,f=e.length;if(c.keyCode===h.KeyCode.Enter)if(a===f-1&&a<p.MaxRankingItemNumber-1)b.onAdd();else{var g=b.getElementRef(a+1).current;g&&g.focus()}}},b.generateNonDuplicateOrder=function(){return Date.now()},b}(k.QuestionDesignerBase);j.registerDesignerComponentClass(m.QuestionType.Ranking,r)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(3),g=c(2),h=c(23),i=c(24),j=OfficeForm.Exports.Models,k=OfficeForm.Exports.Control,l=OfficeForm.Exports.Resources,m=OfficeForm.Exports.EngagementEventNames,n=j.RatingShape,o=11,p=function(a){function b(b){var c=a.call(this,b)||this;return c.firstDescriptionRef=e.createRef(),c.onExecuteForLableItem=c.onExecuteForLableItem.bind(c),c.focusOnDescritionInput=c.focusOnDescritionInput.bind(c),c}return d(b,a),b.prototype.componentDidMount=function(){a.prototype.componentDidMount.call(this)},b.prototype.componentDidUpdate=function(){a.prototype.componentDidUpdate.call(this)},b.prototype.createMoreMenuItems=function(){var b=this.props.Master.Model,c={Checked:b.ShowRatingLabel,Description:l.LocalizedStrings.Designer_MenuItemForRatingLabel,Key:"labelItem",MenuItemType:k.MenuItemType.CheckBox,onExecute:this.onExecuteForLableItem},d=a.prototype.createMoreMenuItems.call(this).concat(this.createValidationItem(),c);return d},b.prototype.createReactNodes=function(){var a,b=this.props.Master.Model,c=f.range(2,o),d=k.createLabel({HTMLAttributes:{className:"question-setting-label"},Label:l.LocalizedStrings.Designer_DescriptionForRatingRange}),h=c.map(function(a){return{DisplayName:a.toString(),Key:a,Value:a}}),i=k.createSelect({Label:l.LocalizedStrings.Designer_DescriptionForRatingRangeAriaLabel.format(b.Length.toString()),onValueChange:function(a){b.Length=a,g.log({eventName:m.DesignPage.Questions.RatingLevelModified,eventType:"engagement_event",extraData:{operation:"ModifyRatingLevel",questionType:b.Type}})},SelectOptions:h,Value:b.Length});a=e.createElement("div",{className:"question-setting-dropdown",style:{width:"110px"}},i);var j,p=e.createElement("div",{className:"rating-question-dropdown-container",key:"range"},d,a),q=k.createLabel({HTMLAttributes:{className:"question-setting-label"},Label:l.LocalizedStrings.Designer_DescriptionForRatingShape}),r=[{DisplayName:l.LocalizedStrings.Designer_DescriptionForRatingShapeNumber,Key:n.Number,Value:n.Number},{DisplayName:l.LocalizedStrings.Designer_DescriptionForRatingShapeStar,Key:n.Star,Value:n.Star}],s=k.createSelect({Label:l.LocalizedStrings.Designer_DescriptionForRatingShape_Label.format(n[b.RatingShape]),onValueChange:function(a){return b.RatingShape=a},SelectOptions:r,Value:b.RatingShape});j=e.createElement("div",{className:"question-setting-dropdown",style:{width:"110px"}},s);var t=e.createElement("div",{className:"rating-question-dropdown-container",key:"shape"},q,j),u=e.createElement("div",{className:"question-setting-container"},p,t),v=b.MinRating;v||(v=1);var w;if(b.ShowRatingLabel&&(w=e.createElement("div",{className:"rating-description-container",key:"description"},this.createDescriptionTextField(!0,this.firstDescriptionRef),this.createDescriptionTextField(!1))),b.RatingShape===n.Number){var x=f.range(v,b.Length+1),y=x.map(function(a,b){return e.createElement("td",{className:"office-form-question-rating-title-td",key:b},a)}),z=e.createElement("tr",{className:"office-form-question-rating-tr"},y),A=f.uniqueId("rating."),B=x.map(function(a,b){return e.createElement("td",{className:"office-form-question-rating-td",key:b},e.createElement("input",{"aria-label":a.toString(),disabled:!0,name:A,type:"radio"}))}),C=e.createElement("tr",{className:"office-form-question-rating-tr"},B),D=e.createElement("table",{className:"design-question-element"},z,C);return[D,u,w]}return[k.createRating({Disabled:!0,HTMLAttributes:{className:"design-question-element",key:"rateit"},Length:this.props.Master.Model.Length,NoTabFocus:!0,onValueChange:function(){},ShowRatingLabel:!1,Value:0}),u,w]},b.prototype.createDescriptionTextField=function(a,b){var c,d,f=this.props.Master.Model,g=f.MinRating;g||(g=1),f.RatingShape===n.Number?(c="office-form-rating-description-label-number",d=a?g.toString():f.Length.toString()):(c="office-form-rating-description-label-star",d=a?l.LocalizedStrings.RatingDescriptionTitle.format(g):l.LocalizedStrings.RatingDescriptionTitlePlural.format(f.Length));var h=k.createTextField({HTMLAttributes:{className:"rating-option-description-designer"},MinimalHeight:25,onValueChange:function(b){a?f.LeftDescription=b:f.RightDescription=b},Options:{HTMLPropsForInnerElement:{"aria-label":l.LocalizedStrings.Designer_RatingDescription_Label.format(d)}},Placeholder:l.LocalizedStrings.Designer_PlaceholderForRatingDescription,ref:b,TextFieldType:k.TextFieldType.SingleLine,Value:a?f.LeftDescription:f.RightDescription});return e.createElement("div",{className:"rating-description-div"},e.createElement("div",{className:c},d),h)},b.prototype.focusOnDescritionInput=function(){this.firstDescriptionRef.current&&this.firstDescriptionRef.current.focus()},b.prototype.onExecuteForLableItem=function(){var a=this.props.Master.Model;g.log({eventName:m.DesignPage.QuestionMenu.RatingLabel,eventType:"engagement_event",extraData:{questionType:a.Type,value:a.ShowRatingLabel}}),a.ShowRatingLabel=!a.ShowRatingLabel,a.ShowRatingLabel&&window.setTimeout(this.focusOnDescritionInput,0)},b}(i.QuestionDesignerBase);h.registerDesignerComponentClass(j.QuestionType.Rating,p)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(7),h=c(2),i=c(23),j=c(32),k=c(102),l=c(24),m=OfficeForm.Exports.Utilities,n=OfficeForm.Exports.EngagementEventNames,o=OfficeForm.Exports.Models,p=OfficeForm.Exports.Control,q=OfficeForm.Exports.Resources,r=o.ShortTextAutograder,s=OfficeForm.Exports.Flighting,t=function(a){function b(b){var c=a.call(this,b,"TextField.Subtitle")||this;return c.formulaDesigner=f.createRef(),c.setInputFieldDefault(),c.toggleMathAnswer=c.toggleMathAnswer.bind(c),c.activatePossibleAnswer=c.activatePossibleAnswer.bind(c),c.deactivatePossibleAnswer=c.deactivatePossibleAnswer.bind(c),c.onNewPossibleAnswerInputBoxBlur=c.onNewPossibleAnswerInputBoxBlur.bind(c),c.onNewPossibleAnswerInputBoxEnter=c.onNewPossibleAnswerInputBoxEnter.bind(c),c.state={IsLastPossibleAnswerEditable:!1,SelectedElementIndex:l.titleElementIndex,ShouldShowNewPossibleAnswerInputField:!1,TemporaryNewPossibleAnswerNotSavedInBackEnd:""},c}return d(b,a),b.getDesignedModelName=function(){return o.Question.TextField.getElementTypeName()},b.prototype.createReactNodes=function(){var a=this.props.Master,b=a.Model,c=b.Multiline?q.LocalizedStrings.Designer_Question_Text_Answer_Long:q.LocalizedStrings.Designer_Question_Text_Answer_Short,d=q.LocalizedStrings.TextField_DefaultPlaceholder;if(b.IsNumber)d=a.getNumberValidationErrorMessage();else if(b.IsMathQuiz){var g=new r(b),h=g.getAnswers();h&&h.length>0&&h[0].isMath&&!h.some(function(a){return a.isMath!==h[0].isMath})&&(d=q.LocalizedStrings.TextField_EnterMathAnswer)}var i,j={"aria-label":c,className:"form-control office-form-unselectable",
disabled:!0,placeholder:d,readOnly:!0,type:"text"};i=b.Multiline?f.createElement("textarea",e({},j)):f.createElement("input",e({},j));var k,l=f.createElement("div",{className:"design-question-element",key:"icon"},f.createElement("div",{className:"design-question-text-snapshot"},i)),m=b.IsQuiz&&!b.Multiline?this.createCorrectAnswerControl():void 0;return b.IsNumber&&(k=this.createNumberValidation()),[l,m,k]},b.prototype.createValidationItem=function(){var a=this.props.Master.Model,b=function(){h.log({eventName:n.DesignPage.QuestionMenu.Validation,eventType:"engagement_event",extraData:{questionType:a.Type,value:a.IsNumber}}),a.IsNumber=!a.IsNumber,a.NumberValidationRule=a.NumberValidationRule||o.NumberValidationRule.None};return{Checked:a.IsNumber,Description:q.LocalizedStrings.NumberValidation_Rule_Description_Label,Key:"validationItem",MenuItemType:p.MenuItemType.CheckBox,onExecute:b}},b.prototype.createMoreMenuItems=function(){var b=a.prototype.createMoreMenuItems.call(this).concat(this.createValidationItem(),this.createMathItem());return b},b.prototype.createCorrectAnswerControl=function(){var a=this.props.Master.Model,b=new o.ShortTextAutograder(a),c=b.getAnswers(),d=this.createCorrectAnswerDisplayBoxes(c),e=this.createNewAnswerInputField(c,a),g=this.createAddAnswerButton();return f.createElement("div",{className:"design-question-element"},f.createElement("div",null,q.LocalizedStrings.Designer_ShortText_PossibleAnswers_Label),d,e,g)},b.prototype.createCorrectAnswerDisplayBoxes=function(a){var b=[];if(a&&a.length>0)for(var c=this.state.IsLastPossibleAnswerEditable?a.length-2:a.length-1,d=0;c>=d;d++){var e=this.createCorrectAnswerDisplayBox(a[d]);b.push(e)}return b},b.prototype.createNewAnswerInputField=function(a,b){var c,d=this,e=!1,g=function(a){},h=new o.ShortTextAutograder(b);if(this.state.IsLastPossibleAnswerEditable){var i=a[a.length-1];c=i.answer,g=function(a){if(""===a)h.deleteAnswer(i.id),b.GradingBasis=h.serialize(),d.logShortTextAnswerDeleted(),d.setState({IsLastPossibleAnswerEditable:!1,ShouldShowNewPossibleAnswerInputField:!0});else{var c=!h.updateAnswer(i.id,a,!b.IsAnswerPlainText);c&&(h.deleteAnswer(i.id),d.logShortTextAnswerDeleted(),d.setState({IsLastPossibleAnswerEditable:!1,ShouldShowNewPossibleAnswerInputField:!0,TemporaryNewPossibleAnswerNotSavedInBackEnd:a})),b.GradingBasis=h.serialize()}var e=h.areAnyAnswersDefined();e||d.logLastRemainingShortTextAnswerDeleted()}}else this.state.ShouldShowNewPossibleAnswerInputField&&(c=this.state.TemporaryNewPossibleAnswerNotSavedInBackEnd,e=!0,g=function(a){if(""!==a){var c=h.areAnyAnswersDefined(),e=!h.addAnswer(a,!b.IsAnswerPlainText);if(e)return void d.setState({TemporaryNewPossibleAnswerNotSavedInBackEnd:a});c||d.logFirstShortTextAnswerAdded(),d.logShortTextAnswerAdded(),b.GradingBasis=h.serialize(),d.setState({IsLastPossibleAnswerEditable:!0,ShouldShowNewPossibleAnswerInputField:!1,TemporaryNewPossibleAnswerNotSavedInBackEnd:""})}else d.setState({TemporaryNewPossibleAnswerNotSavedInBackEnd:""})});if(this.state.IsLastPossibleAnswerEditable||this.state.ShouldShowNewPossibleAnswerInputField){var k=h.areAnyAnswersDefined()?q.LocalizedStrings.Designer_ShortText_NextNewPossibleAnswer_Placeholder:q.LocalizedStrings.Designer_ShortText_FirstNewPossibleAnswer_Placeholder;if(b.IsMathQuiz&&s.Flight.isEnabled(s.Flights.TextFieldMathAnswers)){if(b.IsAnswerPlainText){var l=p.createTextField({AutoFocus:!0,HTMLAttributes:{className:"office-form-textfield-input",id:"newCorrectMathAnswerInputBox"},onValueChange:g,Options:{HTMLPropsForInnerElement:{className:"design-question-short-correct-answer-input",onBlur:this.onNewPossibleAnswerInputBoxBlur,onKeyDown:this.onNewPossibleAnswerInputBoxEnter}},Placeholder:k,Value:c});return f.createElement("div",{className:"design-question-short-correct-math-answer-container",ref:this.formulaDesigner},l,this.createMathTextSwithcer())}var m={className:"office-form-textfield-input",id:"newCorrectMathAnswerFormulaDesigner",onKeyDown:this.onNewPossibleAnswerInputBoxEnter};return f.createElement("div",{className:"design-question-short-correct-math-answer-container"},f.createElement(j.FormulaDesigner,{blockEndDesignMode:this.props.blockEndDesignMode,Disabled:!1,ForceDesignMode:!0,HasFocus:!0,HTMLAttributes:m,key:"textmathquestion",Location:"TextField.Answer",onBoxBlur:this.onNewPossibleAnswerInputBoxBlur,onRenderComplete:this.mathCalculation,onValueChange:g,Placeholder:k,QuestionId:b.Id,containerRef:this.formulaDesigner,Value:c},this.createMathTextSwithcer()))}return p.createTextField({AutoFocus:e,HTMLAttributes:{className:"office-form-textfield-input design-question-short-correct-answer-container",id:"newCorrectAnswerInputBox",onBlur:this.onNewPossibleAnswerInputBoxBlur,onKeyDown:this.onNewPossibleAnswerInputBoxEnter},onValueChange:g,Options:{HTMLPropsForInnerElement:{className:"design-question-short-correct-answer-input"}},Placeholder:k,Value:c})}},b.prototype.createAddAnswerButton=function(){var a=this;if(this.state.IsLastPossibleAnswerEditable||this.state.ShouldShowNewPossibleAnswerInputField)return void 0;var b={className:"design-question-button design-question-short-add-answer-button office-form-theme-button-color",onClick:function(){a.addNewAnswer()},ref:"addAnswerButton"};return p.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"Horizontal",HTMLAttributes:b,Icon:"Add",IconClassName:"forms-icon-size18x18 office-form-theme-primary-foreground",Text:q.LocalizedStrings.Designer_ShortText_AddNewPossibleAnswerButton_Label,TextClassName:"design-question-addonemore"})},b.prototype.createCorrectAnswerDisplayBox=function(a){var b=this,c=this.props.Master.Model,d="correctAnswer"+a.id,e=p.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{className:"design-question-short-correct-answer-delete-button",onClick:function(){return b.deleteAnswer(c,a.id)}},Icon:"Delete",IconClassName:"forms-icon-size16x16",Text:q.LocalizedStrings.Designer_ShortText_DeleteCorrectAnswerButton_AccessibilityFormat.format(a.answer)}),g=p.createFontIconControl({HTMLAttributes:{className:"office-form-right-answerkey forms-icon-size16x16",role:"presentation"},IconName:"CheckMark"}),h=this.state.ActivatedPossibleAnswerId===a.id?e:g,i=this.state.IsLastPossibleAnswerEditable||this.state.ShouldShowNewPossibleAnswerInputField,j=i?"":" design-question-short-correct-answer-box-margin",k=q.LocalizedStrings.Designer_ShortText_CorrectAnswer_AccessibilityFormat.format(a.answer),l=a.isMath?p.createFormulaRenderer({Formula:a.answer}):a.answer;return f.createElement("div",{"aria-labelledby":d,className:"design-question-short-correct-answer-box"+j,key:d,onFocus:this.activatePossibleAnswer(a.id),onMouseEnter:this.activatePossibleAnswer(a.id),onMouseLeave:this.deactivatePossibleAnswer,tabIndex:0},f.createElement("a",{className:"screenReaderVisible",id:d},k),f.createElement("span",{"aria-hidden":"true",role:"presentation"},l),h)},b.prototype.createMathTextSwithcer=function(){var a=this.props.Master.Model,b="design-question-choice-to-math-button",c="textFieldAnswerMathSwitcher";this.props.IsMobile&&(b=m.Html.combineAttributes(b,"isMobile")),l.subtitleElementIndex===this.state.SelectedElementIndex&&(b=m.Html.combineAttributes(b,"active-choice"));var d,e;return a.IsAnswerPlainText?(d={"aria-label":q.LocalizedStrings.Designer_Question_Equation_Button,className:b,id:c,onClick:this.toggleMathAnswer,title:q.LocalizedStrings.Designer_Question_Equation_Button_Tooltip},e="NumberField"):(d={"aria-label":q.LocalizedStrings.Designer_Question_EquationToText_Button,className:b,id:c,onClick:this.toggleMathAnswer,title:q.LocalizedStrings.Designer_Question_EquationToText_Button_Tooltip},e="TextField"),p.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:m.Html.mergeReactProps(this.getElementFocusingProps(l.subtitleElementIndex),d),Icon:e,IconClassName:"design-question-choice-to-math-button-icon"})},b.prototype.toggleMathAnswer=function(){var a=this.props.Master.Model;a.IsAnswerPlainText=!a.IsAnswerPlainText,h.log({eventName:a.IsAnswerPlainText?n.DesignPage.Quiz.SwitchMathToTextInput:n.DesignPage.Quiz.SwitchTextToMathInput,eventType:"engagement_event",extraData:{location:"TextField.Answer"}}),this.forceUpdate()},b.prototype.setInputFieldDefault=function(){var a=this.props.Master.Model;if(!a.IsMathQuiz||!s.Flight.isEnabled(s.Flights.TextFieldMathAnswers))return void(a.IsAnswerPlainText=!0);var b=new r(a).getAnswers();b&&b.length>0?b[b.length-1].isMath?a.IsAnswerPlainText=!1:a.IsAnswerPlainText=!0:a.IsAnswerPlainText=!1},b.prototype.activatePossibleAnswer=function(a){var b=this;return function(){b.setState({ActivatedPossibleAnswerId:a})}},b.prototype.deactivatePossibleAnswer=function(){this.setState({ActivatedPossibleAnswerId:void 0})},b.prototype.onNewPossibleAnswerInputBoxBlur=function(a){if(a){var b=m.Html.getTargetElementOfFocusEvent(a),c=this.formulaDesigner.current;if(b&&c&&c===b.parentElement)return}if(this.state.IsLastPossibleAnswerEditable){var d=this.props.Master.Model,e=new o.ShortTextAutograder(d),f=e.getAnswers();if(f&&f.length>0){var g=f[f.length-1],h=g.answer.trim();if(h!==g.answer||!d.IsAnswerPlainText!==g.isMath){var i=!e.updateAnswer(g.id,h,!d.IsAnswerPlainText);i&&e.deleteAnswer(g.id),d.GradingBasis=e.serialize()}}}this.setState({IsLastPossibleAnswerEditable:!1,ShouldShowNewPossibleAnswerInputField:!1,TemporaryNewPossibleAnswerNotSavedInBackEnd:""})},b.prototype.onNewPossibleAnswerInputBoxEnter=function(a){a.keyCode===g.KeyCode.Enter&&(this.onNewPossibleAnswerInputBoxBlur(),this.addNewAnswer())},b.prototype.addNewAnswer=function(){this.setState({ShouldShowNewPossibleAnswerInputField:!0})},b.prototype.deleteAnswer=function(a,b){var c=new o.ShortTextAutograder(a);c.deleteAnswer(b),a.GradingBasis=c.serialize();var d=c.areAnyAnswersDefined();d||this.logLastRemainingShortTextAnswerDeleted(),this.logShortTextAnswerDeleted()},b.prototype.logShortTextAnswerAdded=function(){h.log({eventName:n.DesignPage.Questions.ShortTextAnswerAdded,eventType:"engagement_event",extraData:{isMathAnswer:!this.props.Master.Model.IsAnswerPlainText,isMathQuestion:this.props.Master.Model.IsMathQuiz,questionId:this.props.Master.Model.Id}})},b.prototype.logShortTextAnswerDeleted=function(){h.log({eventName:n.DesignPage.Questions.ShortTextAnswerDeleted,eventType:"engagement_event",extraData:{isMathAnswer:!this.props.Master.Model.IsAnswerPlainText,isMathQuestion:this.props.Master.Model.IsMathQuiz,questionId:this.props.Master.Model.Id}})},b.prototype.logFirstShortTextAnswerAdded=function(){h.log({eventName:n.DesignPage.Questions.FirstShortTextAnswerAdded,eventType:"engagement_event",extraData:{isMathAnswer:!this.props.Master.Model.IsAnswerPlainText,isMathQuestion:this.props.Master.Model.IsMathQuiz,questionId:this.props.Master.Model.Id}})},b.prototype.logLastRemainingShortTextAnswerDeleted=function(){h.log({eventName:n.DesignPage.Questions.LastRemainingShortTextAnswerDeleted,eventType:"engagement_event",extraData:{isMathAnswer:!this.props.Master.Model.IsAnswerPlainText,isMathQuestion:this.props.Master.Model.IsMathQuiz,questionId:this.props.Master.Model.Id}})},b.prototype.createNumberValidation=function(){var a,c,d,e,g,h,i=this.props.Master,j=i.Model;if(j.IsNumber){a=p.createLabel({HTMLAttributes:{className:"question-setting-label"},Label:q.LocalizedStrings.NumberValidation_Rule_Description_Label});var k=p.createSelect({onValueChange:function(a){return j.NumberValidationRule=a},SelectOptions:b.getNumberValidationRuleDisplayNames(),Value:j.NumberValidationRule});c=f.createElement("div",{className:"question-setting-dropdown",style:{width:"240px"}},k);var l=!0,m=!0,n=j.NumberValidationRule;if(n!==o.NumberValidationRule.Between&&n!==o.NumberValidationRule.NotBetween)switch(n){case o.NumberValidationRule.None:l=!1,m=!1;break;case o.NumberValidationRule.Less:case o.NumberValidationRule.LessOrEqual:l=!1;break;default:m=!1}else g=p.createLabel({HTMLAttributes:{className:"number-validation-between-label"},Label:q.LocalizedStrings.NumberValidation_Between_Label});l&&(d=p.createTextField({AutoSelection:!0,HTMLAttributes:{className:"number-validation-boundary-div",onBlur:function(){return i.justifyNumberBoundaries()}},onValueChange:function(a){j.NumberMinBoundary=a},Options:{HTMLPropsForInnerElement:{className:"number-validation-content"}},Value:j.NumberMinBoundary})),m&&(e=p.createTextField({AutoSelection:!0,HTMLAttributes:{className:"number-validation-boundary-div",onBlur:function(){return i.justifyNumberBoundaries()}},onValueChange:function(a){j.NumberMaxBoundary=a},Options:{HTMLPropsForInnerElement:{className:"number-validation-content"}},Value:j.NumberMaxBoundary})),h=this.getNumberValidationErrMessage()}return f.createElement("div",{className:"question-setting-container",key:"numberValidation"},a,c,d,g,e,h)},b.prototype.getNumberValidationErrMessage=function(){var a,b=this.props.Master.Model,c=b.NumberMinBoundary||"",d=b.NumberMaxBoundary||"",e=b.NumberValidationRule,f="";switch(b.NumberMinBoundary&&(m.NumberValidation.isFormatedAsFloat(c)||(f=q.LocalizedStrings.Invalid_Number_Errmessage_In_DesignTime_Label)),b.NumberMaxBoundary&&(m.NumberValidation.isFormatedAsFloat(d)||(f=q.LocalizedStrings.Invalid_Number_Errmessage_In_DesignTime_Label)),e){case o.NumberValidationRule.Between:case o.NumberValidationRule.NotBetween:if(b.NumberMinBoundary&&b.NumberMaxBoundary){var g=parseFloat(m.NumberValidation.formatAsFloat(c)),h=parseFloat(m.NumberValidation.formatAsFloat(d));!isNaN(g)&&!isNaN(h)&&g>h&&(f=q.LocalizedStrings.Invalid_Boundary_ErrMessage_In_DesignTime_Label)}}return f&&(a=p.createLabel({HTMLAttributes:{className:"validation-design-error-message-label"},Label:f})),a},b.getNumberValidationRuleDisplayNames=function(){for(var a=[],b=o.NumberValidationRule.None;b<o.NumberValidationRule.Max;++b)a.push({DisplayName:o.Question.getLocalizedNumberValidationRuleName(b),Key:b,Value:b});return a},b}(k.FormulaSupportedQuestionDesigner);i.registerDesignerComponentClass(o.QuestionType.TextField,t)},function(a,b,c){"use strict";function d(){p||(window.fbAsyncInit=function(){FB.init({appId:OfficeForm.Exports.EnvironmentConfig.isProduction()?"324475574804737":"521753901675351",autoLogAppEvents:!0,version:"v3.1",xfbml:!0})},e(),p=!0)}function e(){var a=document.getElementsByTagName("script")[0],b=document.getElementsByTagName("script")[0];document.getElementById("facebook-jssdk")||(a=document.createElement("script"),a.id="facebook-jssdk",a.src="https://connect.facebook.net/en_US/sdk.js",b.parentNode&&b.parentNode.insertBefore(a,b))}function f(a,b,c){return k.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{className:"flex-pane-more-channel-option-social",onClick:a},Icon:b,Text:c})}var g=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var h=c(0),i=c(2),j=c(1),k=OfficeForm.Exports.Control,l=OfficeForm.Exports.Utilities,m=OfficeForm.Exports.Resources,n="DesignPage.Send.Facebook",o="DesignPage.Send.Twitter",p=!1,q=function(a){function b(b){var c=a.call(this,b)||this;return c.activeFacebookChannelContent=c.activeFacebookChannelContent.bind(c),c.activeTwitterChannelContent=c.activeTwitterChannelContent.bind(c),c}return g(b,a),b.prototype.componentWillMount=function(){d()},b.prototype.render=function(){var a=m.LocalizedStrings.Share_Options_Facebook,b=m.LocalizedStrings.Share_Options_Twitter;return h.createElement("div",{className:"flex-pane-social-channel-title-container"},f(this.activeFacebookChannelContent,"facebookIcon",a),f(this.activeTwitterChannelContent,"twitterIcon",b))},b.prototype.activeFacebookChannelContent=function(){i.log({eventName:n,eventType:"engagement_event"}),FB.ui({href:this.getFullShareUrl("Facebook"),method:"share"})},b.prototype.activeTwitterChannelContent=function(){i.log({eventName:o,eventType:"engagement_event"});var a="https://twitter.com/intent/tweet",b=encodeURIComponent(m.LocalizedStrings.SharePane_Twitter_FillFormMessage+" #MicrosoftForms"),c=encodeURIComponent(this.getFullShareUrl("Twitter")),d=600,e=400,f=screen.width/2-d/2,g=screen.height/2-e/2;window.open(a+"?text="+b+"&url="+c,"_blank","width="+d+",height="+e+",left="+f+",top="+g)},b.prototype.getFullShareUrl=function(a){var b={id:this.props.FormMaster.Model.Id},c="../Pages/ResponsePage.aspx?"+jQuery.param(b),d={origin:a,time:Date.now()};return l.Html.getAbsoluteUrl(c)+"&"+jQuery.param(d)},b}(j.ReactComponent);b.SocialShareView=q,Forms.UX.FlexPane.SocialShareView=q},function(a,b,c){"use strict";function d(a,b){return f.createElement(j,{FormMaster:a,onFlexPaneIndexChange:b})}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(1),h=c(161),i=c(163),j=function(a){function b(b){var c=a.call(this,b)||this;return c.applyThemeOnForm=c.applyThemeOnForm.bind(c),c.onViewNavigation=c.onViewNavigation.bind(c),c.state={ShowCustomizeThemeView:!1},c}return e(b,a),b.prototype.render=function(){return f.createElement("div",{className:"theme-container"},this.createThemePickerView(),this.createCustomizeThemeView())},b.prototype.createThemePickerView=function(){return this.state.ShowCustomizeThemeView?null:f.createElement(i.ThemePickerView,{FormMaster:this.props.FormMaster,applyTheme:this.applyThemeOnForm,onViewNavigation:this.onViewNavigation})},b.prototype.createCustomizeThemeView=function(){return this.state.ShowCustomizeThemeView?f.createElement(h.CustomizeThemeView,{applyTheme:this.applyThemeOnForm,FormMaster:this.props.FormMaster,onFlexPaneIndexChange:this.props.onFlexPaneIndexChange,onViewNavigation:this.onViewNavigation}):null},b.prototype.applyThemeOnForm=function(a){this.props.FormMaster.ThemeMaster.Model.Name=a,this.forceUpdate()},b.prototype.onViewNavigation=function(){this.setState({ShowCustomizeThemeView:!this.state.ShowCustomizeThemeView})},b}(g.ReactComponent);b.ThemeView=j,Forms.UX.FlexPane.createThemeView=d},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(6),g=c(3);c(162);var h,i=c(26),j=c(2),k=c(106),l=c(1),m=OfficeForm.Exports.ColorHelper,n=OfficeForm.Exports.Control,o=OfficeForm.Exports.EngagementEventNames,p=OfficeForm.Exports.FlexPane,q=OfficeForm.Exports.FormLimitation,r=OfficeForm.Exports.JavaScriptLoader,s=OfficeForm.Exports.Models,t=OfficeForm.Exports.Resources,u=OfficeForm.Exports.Utilities;!function(a){a[a.ValidColor=0]="ValidColor",a[a.InvalidCode=1]="InvalidCode",a[a.TooLight=2]="TooLight"}(h||(h={}));var v=function(a){function b(b){var c=a.call(this,b)||this;c.mounted=!0,c.focusOnUploadImageButton=!1,c.focusOnCustomizeColorButton=!1,c.addColorButtonRef=e.createRef(),c.addImageButtonRef=e.createRef(),c.suggestionContainerRef=e.createRef(),c.errorContainerRef=e.createRef(),c.controlId=g.uniqueId("CustomizeTheme"),c.navigationButtonId=c.controlId+"-nagivation-button",c.viewTitleId=c.controlId+"-title",c.onCustomizeImageButtonClick=c.onCustomizeImageButtonClick.bind(c),c.onColorPickerValueChange=c.onColorPickerValueChange.bind(c),c.onAddColorButtonClick=c.onAddColorButtonClick.bind(c),c.onRemoveColorButtonClick=c.onRemoveColorButtonClick.bind(c),c.onMessageAlert=c.onMessageAlert.bind(c),c.update=function(){return c.forceUpdate()};var d=c.props.FormMaster;c.imageMaster=d.getImageMaster(s.FormMaster.Schema.Background);var f=d.Model.PrimaryCustomizedThemeColor||i.defaultCustomizedPrimaryColor;return c.state={ColorScriptLoaded:!1,CustomizedColor:f,FocusOnColorInput:!1,HexCodeStatus:m.isValidColorContrast(m.hexToRGB(f))?h.ValidColor:h.TooLight,IsUploadingImage:!1,ShowColorPicker:!!d.Model.PrimaryCustomizedThemeColor},c.imageMaster.observe(c.update,[s.ImageInfoMaster.Schema.ResourceUrl,s.ImageInfoMaster.Schema.ImageProcessingStatus,s.ImageInfoMaster.Schema.ErrorType]),r.loadJavaScript("ColorThief").done(function(){c.mounted&&c.setState({ColorScriptLoaded:!0})}),c}return d(b,a),b.prototype.componentDidUpdate=function(){if(this.focusOnCustomizeColorButton){if(this.addColorButtonRef.current){var a=f.findDOMNode(this.addColorButtonRef.current);a&&a.focus()}this.focusOnCustomizeColorButton=!1}if(this.focusOnUploadImageButton){if(this.addImageButtonRef.current){var b=f.findDOMNode(this.addImageButtonRef.current);b&&b.focus()}this.focusOnUploadImageButton=!1}},b.prototype.componentWillUnmount=function(){this.imageMaster.unobserve(this.update),this.mounted=!1},b.prototype.render=function(){var a=n.createGlyphButton({ButtonStyle:"LightBackground",HTMLAttributes:{"aria-labelledby":u.Html.combineAttributes(this.viewTitleId,this.navigationButtonId),autoFocus:!0,className:"customize-theme-view-navigation",id:this.navigationButtonId,onClick:this.props.onViewNavigation},Icon:"Back",IconClassName:"paneThemeBack forms-icon-size16x16",Text:t.LocalizedStrings.Customized_Theme_Navigation_Button,TextClassName:"customize-theme-view-navigation-text"});return e.createElement("div",{className:"customize-theme-view-container"},e.createElement("div",{className:"customize-theme-view-navigation-container"},a),e.createElement("div",{className:"customize-theme-view-title",id:this.viewTitleId},e.createElement("span",null,t.LocalizedStrings.Flex_Pane_ThemeView_Customize_Title)),e.createElement("div",{className:"customize-theme-view-content"},e.createElement("div",{className:"add-image"},this.addImageButton(),this.customizedImageButton()),e.createElement("div",{className:"add-color"},this.addColorButton(),this.useColor(),this.removeColorButton(),this.colorInput(),this.errorMessage(),this.suggestionMessage()),this.customizedSnapShot()),this.errorHandler())},b.prototype.addImageButton=function(){var a=this.props.FormMaster.Model.Background;if(a.ResourceId)return null;var b={disabled:this.imageMaster.Model.ImageProcessingStatus!==s.ImageProcessingStatus.Idle,onClick:this.onCustomizeImageButtonClick},c=n.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:b,Icon:"Photo2",IconClassName:"customized-theme-pictureAdd-icon forms-icon-size28x28",ref:this.addImageButtonRef,Text:t.LocalizedStrings.Add_Customized_Theme_Image});return e.createElement("span",{className:"theme-icon-container",key:"addImage"},c,this.createSpinner())},b.prototype.customizedImageButton=function(){var a=this,b=this.props.FormMaster.Model,c=b.Background;if(c.ResourceUrl){var d=function(){a.imageMaster.clear().then(function(){a.props.FormMaster.ThemeMaster.isCustomized()&&!b.PrimaryCustomizedThemeColor&&a.props.applyTheme(i.defaultPredefinedTheme.Name),a.focusOnUploadImageButton=!0,a.forceUpdate()})};return e.createElement(k.ThemeButton,{applyTheme:this.onCustomizeImageButtonClick,deleteTheme:d,IsActive:b.Theme.Name===i.customizedThemeName,ShowColorSnapshot:!1,Theme:this.props.FormMaster.ThemeMaster.getCustomizedTheme()})}return null},b.prototype.addColorButton=function(){if(this.state.ShowColorPicker&&(this.state.HexCodeStatus===h.InvalidCode||this.props.FormMaster.Model.PrimaryCustomizedThemeColor))return null;var a={onClick:this.onAddColorButtonClick},b=n.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:a,Icon:"BucketColor",IconClassName:"customized-theme-pictureAdd-icon forms-icon-size28x28",ref:this.addColorButtonRef,Text:t.LocalizedStrings.Add_Customized_Theme_Color});return e.createElement("span",{key:"addColor"},b)},b.prototype.useColor=function(){var a=this.props.FormMaster.Model.PrimaryCustomizedThemeColor;if(this.state.ShowColorPicker&&this.state.HexCodeStatus!==h.InvalidCode&&a){var b={};return b.backgroundColor=a,e.createElement("div",{className:"color-picker-use-color",style:b})}return null},b.prototype.removeColorButton=function(){return this.state.ShowColorPicker&&this.state.HexCodeStatus===h.InvalidCode?n.createGlyphButton({ButtonStyle:"LightBackground",HTMLAttributes:{className:"office-form-theme-button",onClick:this.onRemoveColorButtonClick},Icon:"Cancel",IconClassName:"color-picker-remove-color forms-icon-size24x24"}):null},b.prototype.colorInput=function(){if(!this.state.ShowColorPicker)return null;var a=n.createTextField({AutoFocus:this.state.FocusOnColorInput,AutoSelection:!0,HTMLAttributes:{className:"color-picker-input"},MaxLength:120,MinimalHeight:60,onValueChange:this.onColorPickerValueChange,Options:{HTMLPropsForInnerElement:{"aria-label":t.LocalizedStrings.Customized_Theme_Color_Input}},TextFieldType:n.TextFieldType.SingleLine,Value:this.state.CustomizedColor});return e.createElement("span",{className:"color-picker-container"},a)},b.prototype.errorMessage=function(){var a="";return this.state.ShowColorPicker&&this.state.HexCodeStatus===h.InvalidCode&&(a=t.LocalizedStrings.Customized_Theme_Color_Error_InvalidCode),e.createElement("div",{className:"customize-theme-view-message error",role:"alert",ref:this.errorContainerRef},a)},b.prototype.suggestionMessage=function(){var a="";return this.state.ShowColorPicker&&this.state.HexCodeStatus===h.TooLight&&(a=t.LocalizedStrings.Customized_Theme_Color_Suggestion_TooLight),e.createElement("div",{className:"customize-theme-view-message suggestion","aria-live":"polite",role:"alert",ref:this.suggestionContainerRef},a)},b.prototype.validateColor=function(a){var b=this,c=/^#[0-9A-F]{6}$/i;return c.test(a)?(this.props.FormMaster.bulkEdit(function(c){c.PrimaryCustomizedThemeColor=a,c.SecondaryCustomizedThemeColor=m.primaryHexToSecondaryHex(a),c.TertiaryCustomizedThemeColor=m.primaryHexToBackgroundHex(a),b.props.applyTheme(i.customizedThemeName)}),m.isValidColorContrast(m.hexToRGB(a))?void this.setState({HexCodeStatus:h.ValidColor}):void this.setState({HexCodeStatus:h.TooLight},function(){j.log({eventName:o.DesignPage.Theme.ColorTooLight,eventType:"engagement_event"})})):void this.setState({HexCodeStatus:h.InvalidCode})},b.prototype.customizedSnapShot=function(){var a=this.props.FormMaster.Model;if(this.state.ShowColorPicker&&a.PrimaryCustomizedThemeColor){var b={};b.backgroundColor=a.PrimaryCustomizedThemeColor;var c=e.createElement("div",null,e.createElement("div",{className:"snapshot-title",style:b},e.createElement("div",{className:"snapshot-title-content"})),e.createElement("div",{className:"snapshot-content"},e.createElement("div",{className:"snapshot-submit-button",style:b}))),d={};return a.Background.ResourceUrl?d.backgroundImage="url("+a.Background.ResourceUrl+"_mo)":a.TertiaryCustomizedThemeColor&&(d.backgroundColor=a.TertiaryCustomizedThemeColor),e.createElement("div",{className:"color-snapshot-container",style:d},c)}return null},b.prototype.onAddColorButtonClick=function(){j.log({eventName:o.DesignPage.Theme.AddColor,eventType:"engagement_event"}),this.setState({CustomizedColor:"Hex #",FocusOnColorInput:!0,ShowColorPicker:!0})},b.prototype.onRemoveColorButtonClick=function(){var a=this;j.log({eventName:o.DesignPage.Theme.DeleteColor,eventType:"engagement_event"}),this.props.FormMaster.bulkEdit(function(b){b.PrimaryCustomizedThemeColor&&(b.PrimaryCustomizedThemeColor=null,b.SecondaryCustomizedThemeColor=null,b.TertiaryCustomizedThemeColor=null,a.props.applyTheme(i.customizedThemeName))}),this.focusOnCustomizeColorButton=!0,this.setState({HexCodeStatus:h.ValidColor,ShowColorPicker:!1})},b.prototype.onCustomizeImageButtonClick=function(){var a=this,b=!1;j.log({eventName:o.DesignPage.Theme.AddImage,eventType:"engagement_event"}),p.pickImage().done(function(c){var d=a.props.FormMaster.Model;if(a.props.onFlexPaneIndexChange(),a.imageMaster.addImage(c).always(function(){a.props.applyTheme(i.customizedThemeName),b&&a.setState({CustomizedColor:d.Theme.PrimaryColor,ShowColorPicker:!0})}),a.state.ColorScriptLoaded&&c.File&&c.File.size<=q.ImageMaxSize){var e=new FileReader;e.onload=function(){var a=new Image;a.src=e.result,a.onload=function(){var c,e=new ColorThief;try{c=e.getColor(a)}catch(f){c=[0,130,114]}var g=m.adjustPrimaryThemeColor({B:c[2],G:c[1],R:c[0]});d.PrimaryCustomizedThemeColor=d.PrimaryCustomizedThemeColor||m.colorToHex(g),d.SecondaryCustomizedThemeColor=d.SecondaryCustomizedThemeColor||m.primaryHexToSecondaryHex(d.PrimaryCustomizedThemeColor),d.TertiaryCustomizedThemeColor=d.TertiaryCustomizedThemeColor||m.primaryHexToBackgroundHex(d.PrimaryCustomizedThemeColor),b=!0}},e.readAsDataURL(c.File)}})},b.prototype.errorHandler=function(){var a=this.props.FormMaster,b=this.imageMaster,c=b.Model;if(!a)return null;if(c.ImageProcessingStatus!==s.ImageProcessingStatus.Idle||c.ErrorType===s.ImageErrorType.NoError)return null;var d=n.createLabel({HTMLAttributes:{className:"error-message"},key:"error-message",Label:b.getImageErrorMessage()}),f=n.createFontIconControl({HTMLAttributes:{className:"customized-theme-error-frowny-icon"},IconName:"Sad",key:"customized-theme-error-frowny-icon"});return e.createElement("div",{className:"customized-theme-error",key:"customized-them-error"},f,d)},b.prototype.onMessageAlert=function(){if(this.errorContainerRef.current){var a=this.errorContainerRef.current;a.innerText=a.innerText}if(this.suggestionContainerRef.current){var b=this.suggestionContainerRef.current;b.innerText=b.innerText}},b.prototype.onColorPickerValueChange=function(a){this.setState({CustomizedColor:a},this.onMessageAlert),a=a.replace(/\s/g,"").toLowerCase(),a.startsWith("hex")&&(a=a.substr(3)),"#"!==a[0]&&(a="#"+a),this.validateColor(a)},b.prototype.createSpinner=function(){var a=this.imageMaster.Model;return a.ImageProcessingStatus!==s.ImageProcessingStatus.Idle?e.createElement("div",{className:"customized-theme-spinner-container"},e.createElement("div",{className:"customized-theme-spinner"},e.createElement("div",{className:"spinner-tile-animation"}))):null},b}(l.ReactComponent);b.CustomizeThemeView=v},function(a,b){},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(26),g=c(2),h=c(106),i=c(1),j=OfficeForm.Exports.Control,k=OfficeForm.Exports.EngagementEventNames,l=OfficeForm.Exports.Models,m=OfficeForm.Exports.Resources,n=function(a){function b(b){var c=a.call(this,b)||this;return c.state={ShowSpinner:!1},c.onAddThemeButtonClick=c.onAddThemeButtonClick.bind(c),c.onEditThemeButtonClick=c.onEditThemeButtonClick.bind(c),c.localizedStrings=m.LocalizedStrings,c}return d(b,a),b.prototype.render=function(){return e.createElement("div",{className:"theme-designer-container",key:"theme-designer-container"},this.createPredefinedThemeList(),this.createCustomizedThemeButton(),this.createAddCustomizeThemeButton())},b.prototype.createPredefinedThemeList=function(){var a=this;return f.predefinedThemes.map(function(b){return e.createElement(h.ThemeButton,{applyTheme:a.props.applyTheme,IsActive:a.props.FormMaster.ThemeMaster.Model.Name===b.Name,ShowColorSnapshot:!1,Theme:b,key:b.Name})})},b.prototype.createAddCustomizeThemeButton=function(){var a=this.props.FormMaster.Model;if(a.Background.ResourceUrl||a.PrimaryCustomizedThemeColor)return null;var b={className:"theme-icon-button",
onClick:this.onAddThemeButtonClick},c=j.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:b,Icon:"Add",IconClassName:"customized-theme-pictureAdd-icon forms-icon-size28x28",Text:this.localizedStrings.Add_Customized_Theme});return e.createElement("span",{className:"theme-icon-container",key:"add"},c,this.createSpinner())},b.prototype.createCustomizedThemeButton=function(){var a=this.props.FormMaster.Model;return a.Background.ResourceUrl||a.PrimaryCustomizedThemeColor?e.createElement(h.ThemeButton,{applyTheme:this.props.applyTheme,editTheme:this.onEditThemeButtonClick,IsActive:a.Theme.Name===m.LocalizedStrings.Customized_Theme_Name,ShowColorSnapshot:!!a.PrimaryCustomizedThemeColor&&!!a.Background.ResourceUrl,Theme:this.props.FormMaster.ThemeMaster.getCustomizedTheme()}):null},b.prototype.onEditThemeButtonClick=function(){g.log({eventName:k.DesignPage.Theme.EditCustomizedTheme,eventType:"engagement_event"}),this.props.applyTheme(f.customizedThemeName),this.props.onViewNavigation()},b.prototype.onAddThemeButtonClick=function(){g.log({eventName:k.DesignPage.Theme.AddCustomizedTheme,eventType:"engagement_event"}),this.props.onViewNavigation()},b.prototype.createSpinner=function(){var a=this.props.FormMaster.getImageMaster(l.FormMaster.Schema.Background);return!this.state.ShowSpinner&&a.Model.ImageProcessingStatus===l.ImageProcessingStatus.Idle||a.Model.ErrorType!==l.ImageErrorType.NoError?null:e.createElement("div",{className:"customized-theme-spinner-container"},e.createElement("div",{className:"customized-theme-spinner"},e.createElement("div",{className:"spinner-tile-animation"})))},b}(i.ReactComponent);b.ThemePickerView=n},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(7),h=c(1),i=OfficeForm.Exports.Utilities,j=function(a){function b(b){var c=a.call(this,b)||this;return c.enterDesignMode=c.enterDesignMode.bind(c),c.enterDesignModeByClick=c.enterDesignModeByClick.bind(c),c.escapeDesignMode=c.escapeDesignMode.bind(c),c}return d(b,a),b.prototype.render=function(){return this.props.InDesignMode?this.createDesignerConponent():this.createRendererComponent()},b.prototype.createDesignerConponent=function(){return f.createElement("div",{"aria-expanded":!0,onKeyUp:this.escapeDesignMode,tabIndex:-1},this.props.children)},b.prototype.escapeDesignMode=function(a){a.keyCode===g.KeyCode.Esc&&(this.props.leaveDesignMode(),a.stopPropagation())},b.prototype.createRendererComponent=function(){var a=i.Html.mergeReactProps(this.props.HTMLAttributes||{},{"aria-expanded":!1,className:"design-time-mixer",onClick:this.enterDesignModeByClick,onKeyUp:this.enterDesignMode,role:"button",tabIndex:0});return f.createElement("div",e({},a),this.props.children)},b.prototype.enterDesignModeByClick=function(a){this.props.enterDesignMode(),a.stopPropagation()},b.prototype.enterDesignMode=function(a){switch(a.keyCode){case g.KeyCode.Enter:case g.KeyCode.Space:this.props.enterDesignMode(),a.stopPropagation()}},b}(h.ReactComponent);b.DesignTimeEnhancer=j,Forms.UX.FormDesignView.DesignTimeEnhancer=j},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(6),f=c(3),g=c(7),h=c(23),i=c(1),j=c(8),k=OfficeForm.Exports.Utilities,l=OfficeForm.Exports.Resources,m=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.componentDidMount=function(){this.checkFocus()},b.prototype.componentDidUpdate=function(){this.checkFocus()},b.prototype.render=function(){return this.props.InDesignMode?this.createDesignerConponent():this.createRendererComponent()},b.prototype.createDesignerConponent=function(){return h.createDesignerElement(this.props.DesignerProps)},b.prototype.createRendererComponent=function(){var a=this,b=f.clone(this.props.RendererProps);return b.ShowDesignInfo=!0,b.HTMLAttributes=k.Html.mergeReactProps(b.HTMLAttributes||{},{"aria-expanded":!1,"aria-label":l.LocalizedStrings.Designer_Question_Label.format(b.Ordinal,b.Master.Question.Model.Title),className:"design-time-mixer",onClick:function(b){a.props.enterDesignMode()},onKeyUp:function(b){switch(b.keyCode){case g.KeyCode.Enter:case g.KeyCode.Space:a.props.enterDesignMode()}},role:"button",tabIndex:0}),j.createRendererElement(b)},b.prototype.checkFocus=function(){if(!this.inDesignMode!=!this.props.InDesignMode&&(this.inDesignMode=this.props.InDesignMode,this.inDesignMode)){var a=e.findDOMNode(this),b=$(a).find(".mixer-focus-target")[0];b&&b.focus()}},b}(i.ReactComponent);b.DesignTimeMixer=m,Forms.UX.FormDesignView.DesignTimeMixer=m},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=OfficeForm.Exports.PageMethods,e=function(){function a(){}return a.loadFormTemplates=function(){return a.intelligenceTemplates||(a.intelligenceTemplates=$.Deferred(),d.getFormTemplates().done(function(b){var c=JSON.parse(b);c?a.intelligenceTemplates.resolve(c):a.intelligenceTemplates.resolve({})}).fail(function(b){return a.intelligenceTemplates.reject(b)})),a.intelligenceTemplates.promise()},a.loadMSATemplates=function(){return a.msaTemplates||(a.msaTemplates=d.getMSATemplates().then(JSON.parse)),a.msaTemplates},a}();b.FormTemplates=e,Forms.Templates.FormTemplates=e},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(2),g=c(1),h=OfficeForm.Exports.Control,i=OfficeForm.Exports.Resources,j=function(a){function b(b){var c=a.call(this,b)||this;return c.onDuplicateSection=c.onDuplicateSection.bind(c),c.onDeleteSection=c.onDeleteSection.bind(c),c.onDeleteAll=c.onDeleteAll.bind(c),c.onExcuteSectionMove=c.onExcuteSectionMove.bind(c),c.logMenuExpand=c.logMenuExpand.bind(c),c}return d(b,a),b.prototype.render=function(){return e.createElement("div",{className:"__section__ form-designer-section"},e.createElement("div",{className:"form-designer-section-header"},e.createElement("h5",{className:"designer-section-title"},i.LocalizedStrings.Designer_Sections_DefaultDescription.format(this.props.Ordinal)),e.createElement("div",{className:"designer-section-action-bar",key:"ActionBar"},this.createMoreMenu())),e.createElement("div",{className:"form-designer-section-content"},this.props.children))},b.prototype.createMoreMenu=function(){var a={ButtonStyle:"LightBackground",ChildrenContent:h.createFontIconControl({HTMLAttributes:{className:"forms-icon-size18x18"},IconName:"More"}),ClassName:"design-question-more-options",Description:i.LocalizedStrings.DesignPage_NavBar_MoreOptions,Tooltip:i.LocalizedStrings.QuestionCard_DesignTime_Menu_Tooltip};return h.createMenuControl({ClassName:"design-section-actionbar-menu",ClassNameForContainer:"designer-section-menu-button",CustomizedMenuItems:this.createMoreMenuItems(),MenuTriggerButton:a,onMenuExpand:this.logMenuExpand})},b.prototype.createRemoveMenuItems=function(){var a=h.createTextButton({ButtonStyle:"DarkBackGround",HTMLAttributes:{className:"designer-more-options-section-button"},Text:i.LocalizedStrings.Designer_SectionActionBar_RemoveSection}),b=h.createTextButton({ButtonStyle:"DarkBackGround",HTMLAttributes:{className:"designer-more-options-section-button"},Text:i.LocalizedStrings.Designer_SectionActionBar_RemoveAll});return e.createElement("div",{className:"menu-control-options-box designer-section-remove-box"},e.createElement("div",{className:"menu-control-item",onClick:this.onDeleteSection,role:"menuitem",tabIndex:-1},a),e.createElement("div",{className:"menu-control-item",onClick:this.onDeleteAll,role:"menuitem",tabIndex:-1},b))},b.prototype.createMoreMenuItems=function(){var a={Active:!0,MenuItem:h.createTextButton({ButtonStyle:"DarkBackGround",HTMLAttributes:{className:"designer-more-options-section-button"},Text:i.LocalizedStrings.Designer_SectionActionBar_Duplicate}),OnExecute:this.onDuplicateSection},b={Active:!0,MenuItem:this.createRemoveMenu(),OnExecute:void 0},c={Active:this.props.Master.Form.FormElementManager.SectionMasters.length>1,MenuItem:h.createTextButton({ButtonStyle:"DarkBackGround",HTMLAttributes:{className:"designer-more-options-section-button"},Text:i.LocalizedStrings.Designer_SectionActionBar_Move}),OnExecute:this.onExcuteSectionMove};return[a,b,c]},b.prototype.onExcuteSectionMove=function(){this.props.openMovePane(this.props.Master.Model.Id)},b.prototype.createRemoveMenu=function(){var a=h.createGlyphButton({ButtonStyle:"DarkBackGround",GlyphButtonStyle:"Horizontal",HTMLAttributes:{className:"designer-more-options-section-button with-icon"},Icon:"ChevronLeft",IconClassName:"forms-icon-size16x16",Text:i.LocalizedStrings.Designer_SectionActionBar_Remove,TextClassName:"section-button-text"});return e.createElement("div",{className:"designer-section-remove-menu"},a,this.createRemoveMenuItems())},b.prototype.onDuplicateSection=function(){var a=this.props.Master,b=a.Form.FormElementManager.duplicateSectionAndSubElements(a);this.props.setElementInDesignMode(b),f.log({eventName:"DesignPage.Section.Duplicate",eventType:"engagement_event",extraData:{questionType:a.Model.Type}})},b.prototype.onDeleteSection=function(){var a=this.props.Master;a.Deleted=!0,f.log({eventName:"DesignPage.Section.Delete",eventType:"engagement_event",extraData:{questionType:a.Model.Type}})},b.prototype.onDeleteAll=function(){var a=this.props.Master;a.Form.FormElementManager.deleteSectionAndSubElements(a),f.log({eventName:"DesignPage.Section.DeleteWithQuestions",eventType:"engagement_event",extraData:{questionType:a.Model.Type}})},b.prototype.logMenuExpand=function(){f.log({eventName:"DesignPage.Section.Navigate",eventType:"engagement_event",extraData:{questionType:this.props.Master.Model.Type}})},b}(g.ReactComponent);b.SectionDesigner=j,Forms.UX.Designer.SectionDesigner=j},function(a,b,c){"use strict";function d(a){return a.InDesignMode?e.createElement(g.SectionTitleDesigner,{Master:a.Master,onHeightChange:a.onHeightChange}):e.createElement(f.SectionTitleRenderer,{Master:a.Master,onHeightChange:a.onHeightChange})}Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(47),g=c(169);b["default"]=d,Forms.UX.FormDesignView.SectionTitleMixer=d},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(3),g=c(2),h=c(58),i=c(107),j=c(108),k=c(1),l=OfficeForm.Exports.Utilities.Html.combineAttributes,m=OfficeForm.Exports.Models,n=OfficeForm.Exports.FormLimitation,o=OfficeForm.Exports.Control,p=OfficeForm.Exports.EngagementEventNames,q=OfficeForm.Exports.FlexPane,r=OfficeForm.Exports.Resources,s=function(a){function b(b){var c=a.call(this,b)||this;return c.imagePickerRef=e.createRef(),c.onTitleChange=c.onTitleChange.bind(c),c.onSubTitleChange=c.onSubTitleChange.bind(c),c.update=c.update.bind(c),c.addMedia=c.addMedia.bind(c),c.clearVideoInfo=c.clearVideoInfo.bind(c),c}return d(b,a),b.prototype.componentDidMount=function(){var a=this.props.Master,b=Forms.Models.DescriptiveElementMaster.Schema;a.observe(this.update,[b.Title,b.Subtitle,b.ImageInfo,b.VideoInfo]);var c=a.ImageInfoMaster,d=m.ImageInfoMaster.Schema;c.observe(this.update,[d.ImageProcessingStatus,d.ErrorType,d.UploadParameters]);var e=a.ImageSettingsMaster,f=m.ImageSettingsMaster.Schema;e.observe(this.update,[f.NaturalWidth,f.NaturalHeight,f.Size])},b.prototype.componentWillUnmount=function(){var a=this.props.Master;a.unobserve(this.update),a.ImageSettingsMaster.unobserve(this.update),a.ImageInfoMaster.unobserve(this.update)},b.prototype.render=function(){var a=this.props.Master,c=a.Model,d=f.extend({},this.props.HTMLAttributes);d.className=l(d.className,"__section-title-designer__ form-designer-section-title office-form-theme-focus-border");var g,k,n="Right",p=a.ImageInfoMaster,q=a.ImageSettingsMaster,s=p.Model,t=c.VideoInfo;if(s.ImageProcessingStatus===m.ImageProcessingStatus.Picking||s.ErrorType||m.hasImage(s)){var u=b.calcImageInfo(q.Model);g=u.Height,n=u.ImageLayout,k=e.createElement(i.ImageDesigner,{addImage:this.addMedia,ImageHeight:u.Height,ImageInfoMaster:p,ImageSettingMaster:q,ImageWidth:u.Width,Resizable:!0})}else if(t&&t.Url){n="Bottom";var v=o.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{className:"video-delete-button office-form-theme-button-foreground",onClick:this.clearVideoInfo},Icon:"Delete",IconClassName:"forms-icon-size18x18",Text:r.LocalizedStrings.VideoEditPane_Delete_Button});k=e.createElement(h.VideoControl,{HTMLAttributes:{className:"design-question-image-title-big-horizontal"},ClassNameForIFrame:"design-question-title-video-frame",Url:t.Url},v)}else k=o.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{className:"form-designer-title-editor-image-picker office-form-theme-button",onClick:this.addMedia},Icon:"Photo2",IconClassName:"forms-icon-size20x20",key:"ImagePicker",ref:this.imagePickerRef,Text:r.LocalizedStrings.ImagePicker_Insert_Mdeia_button});return e.createElement(j.TitleMediaDesigner,{HTMLAttributes:d,MediaLayout:n,onHeightChange:this.props.onHeightChange,onSubTitleChange:this.onSubTitleChange,onValueChange:this.onTitleChange,SubTitle:c.Subtitle,TitleHeight:g,Value:c.Title},k)},b.prototype.addMedia=function(){var a=this,b=this.props.Master,c=b.Model;g.log({eventName:p.DesignPage.Questions.AddImage,eventType:"engagement_event",extraData:{questionId:c.Id,questionType:c.Type}}),q.pickMedia().done(function(a){a.Image?b.ImageInfoMaster.addImage(a.Image):a.Video&&b.setVideoUrl(a.Video)}).fail(function(b){var c=a.imagePickerRef.current;b&&c&&c.focus()})},b.prototype.clearVideoInfo=function(){g.log({eventName:p.DesignPage.VideoEditPane.Delete,eventType:"engagement_event"}),this.props.Master.clearVideoInfo()},b.calcImageInfo=function(a){return a.NaturalWidth?a.Layout===m.ImageLayout.Horizontal&&a.Size===m.ImageSize.Large?{ImageLayout:"Bottom"}:{Height:a.ContainerHeight,ImageLayout:"Right",Width:a.ContainerWidth}:{Height:n.ImagePlaceHolderHeight,ImageLayout:"Right",Width:n.ImagePlaceHolderWidth}},b.prototype.onTitleChange=function(a){this.props.Master.Model.Title=a},b.prototype.onSubTitleChange=function(a){this.props.Master.Model.Subtitle=a},b.prototype.update=function(){var a=this;this.forceUpdate(function(){var b=a.props.onHeightChange;b&&b()})},b}(k.ReactComponent);b.SectionTitleDesigner=s},function(a,b,c){"use strict";function d(a){return a.InDesignMode?e.createElement(f.TitleDesigner,{Form:a.Form,HTMLAttributes:a.HTMLAttributes,onHeightChange:a.onHeightChange,ref:a.ref}):e.createElement(g.TitleRenderer,{Form:a.Form,HTMLAttributes:a.HTMLAttributes,onHeightChange:a.onHeightChange,ref:a.ref})}Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(171),g=c(172);b.createTitleDesignerMixer=d,Forms.UX.FormDesignView.createTitleDesignerMixer=d},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(2),g=c(107),h=c(108),i=c(1),j=OfficeForm.Exports.Models,k=OfficeForm.Exports.Utilities,l=OfficeForm.Exports.Control,m=OfficeForm.Exports.Resources,n=OfficeForm.Exports.FlexPane,o=OfficeForm.Exports.EngagementEventNames.DesignPage,p=OfficeForm.Exports.DesignPage,q=OfficeForm.Exports.FormLimitation,r=function(a){function b(b){var c=a.call(this,b)||this;return c.titleMediaRef=e.createRef(),c.imagePickerRef=e.createRef(),c.onTitleValueChange=c.onTitleValueChange.bind(c),c.onSubTitleValueChange=c.onSubTitleValueChange.bind(c),c.updateChangeCallback=c.updateChangeCallback.bind(c),c.addImage=c.addImage.bind(c),c.imageChangeCallback=c.imageChangeCallback.bind(c),c}return d(b,a),b.prototype.componentDidMount=function(){var a=this.props.Form,b=j.FormMaster.Schema;a.observe(this.updateChangeCallback,[b.Title,b.Description]);var c=a.getImageMaster(j.FormMaster.Schema.Logo),d=a.getImageSettingsMaster(j.FormMaster.Schema.LogoInfo);d.observe(this.updateChangeCallback,[j.ImageSettingsMaster.Schema.NaturalWidth,j.ImageSettingsMaster.Schema.NaturalHeight,j.ImageSettingsMaster.Schema.Size]);var e=j.ImageInfoMaster.Schema;c.observe(this.imageChangeCallback,[e.ImageProcessingStatus,e.ErrorType,e.UploadParameters])},b.prototype.componentDidUpdate=function(){p.isImagePickerHiding()&&this.focusImagePicker()},b.prototype.focusImagePicker=function(){var a=this.imagePickerRef.current;a&&a.focus()},b.prototype.componentWillUnmount=function(){var a=this.props.Form;a.unobserve(this.updateChangeCallback);var b=a.getImageMaster(j.FormMaster.Schema.Logo),c=a.getImageSettingsMaster(j.FormMaster.Schema.LogoInfo);b.unobserve(this.imageChangeCallback),c.unobserve(this.updateChangeCallback)},b.prototype.render=function(){var a,c,d=this.props.Form,f=d.getImageMaster(j.FormMaster.Schema.Logo),i=d.getImageSettingsMaster(j.FormMaster.Schema.LogoInfo),n=k.Html.mergeReactProps(this.props.HTMLAttributes,{className:"__title-designer__ form-designer-form-title office-form-theme-focus-border"}),o="Right",p=f.Model;if(p.ImageProcessingStatus!==j.ImageProcessingStatus.Idle||p.ErrorType||j.hasImage(p)){var q=b.calcImageInfo(i);o=q.ImageLayout,a=q.Height,c=e.createElement(g.ImageDesigner,{addImage:this.addImage,ImageHeight:a,ImageInfoMaster:f,ImageSettingMaster:i,ImageWidth:q.Width,key:"imageDesigner"})}else c=l.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{className:"form-designer-title-editor-image-picker office-form-theme-button",onClick:this.addImage},Icon:"Photo2",IconClassName:"forms-icon-size20x20",key:"imagePicker",ref:this.imagePickerRef,Text:m.LocalizedStrings.ImagePicker_Insert_Image_button});return e.createElement(h.TitleMediaDesigner,{HTMLAttributes:n,MediaLayout:o,onHeightChange:this.props.onHeightChange,onSubTitleChange:this.onSubTitleValueChange,onValueChange:this.onTitleValueChange,SubTitle:d.Model.Description,TitleHeight:a,Value:d.Model.Title},c)},b.calcImageInfo=function(a){if(a.Model.NaturalWidth){var b=a.calcLogoLayout(),c=b.Layout===j.ImageLayout.Vertical?"Top":"Left";return{Height:b.ActualHeight,ImageLayout:c,Width:b.ActualWidth}}return{Height:q.ImagePlaceHolderHeight,ImageLayout:"Left",Width:q.ImagePlaceHolderWidth}},b.prototype.onTitleValueChange=function(a){this.props.Form.Model.Title=a},b.prototype.onSubTitleValueChange=function(a){this.props.Form.Model.Description=a},b.prototype.addImage=function(){var a=this.props.Form,b=a.getImageMaster(j.FormMaster.Schema.Logo);f.log({eventName:o.Form.AddImage_Logo,eventType:"engagement_event",extraData:{FormId:a.isFieldReady(j.FormMaster.Schema.Id)?a.Model.Id:""}}),n.pickImage().done(function(a){return b.addImage(a)})},b.prototype.updateChangeCallback=function(){var a=this;this.forceUpdate(function(){var b=a.props.onHeightChange;b&&b()})},b.prototype.imageChangeCallback=function(a){var b=a.OldValues,c=a.NewValues;if(b.ImageProcessingStatus===j.ImageProcessingStatus.Deleting&&c.ImageProcessingStatus===j.ImageProcessingStatus.Idle&&c.ErrorType!==j.ImageErrorType.DeleteFailError){var d=this.titleMediaRef.current;d&&d.focus()}this.updateChangeCallback()},b}(i.ReactComponent);b.TitleDesigner=r,Forms.UX.FormDesignView.TitleDesigner=r},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(1),g=c(31),h=c(30),i=OfficeForm.Exports.Models,j=OfficeForm.Exports.Utilities,k=OfficeForm.Exports.Control,l=OfficeForm.Exports.Resources,m=OfficeForm.Exports.Analysis.QuizView,n=i.ImageLayout,o=OfficeForm.Exports.FormLimitation,p=i.ImageProcessingStatus,q=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.componentWillMount=function(){var a=this;this.update=function(){return a.forceUpdate()};var b=i.FormMaster.Schema;this.props.Form.observe(this.update,[b.Title,b.Description]);var c=this.props.Form.getImageSettingsMaster(i.FormMaster.Schema.LogoInfo),d=i.ImageSettingsMaster.Schema;c.observe(this.update,[d.NaturalWidth,d.NaturalHeight]);var e=this.props.Form.getImageMaster(i.FormMaster.Schema.Logo),f=i.ImageInfoMaster.Schema;e.observe(this.update,[f.ImageProcessingStatus,f.UploadParameters])},b.prototype.componentWillUnmount=function(){this.props.Form.unobserve(this.update);var a=this.props.Form.getImageSettingsMaster(i.FormMaster.Schema.LogoInfo);a.unobserve(this.update);var b=this.props.Form.getImageMaster(i.FormMaster.Schema.Logo);b.unobserve(this.update)},b.prototype.render=function(){var a,c=this.props.Form,d=c.Model,f=j.Html.mergeReactProps(this.props.HTMLAttributes,{"aria-label":d.Title+" "+l.LocalizedStrings.Designer_FormTitle_Label,className:"__title-designer__ form-designer-title-view"}),k="Left",n=c.getImageMaster(i.FormMaster.Schema.Logo),o=c.getImageSettingsMaster(i.FormMaster.Schema.LogoInfo),q=n.Model;if(!q.ErrorType&&(q.ImageProcessingStatus!==p.Idle||i.hasImage(q))){var r=b.calcImageLayout(o);k=r.ImageLayout,a=e.createElement(g.ImageRenderer,{ImageWidth:r.Width,ImageHeight:r.Height,ImageInfoMaster:n,ImageSettingMaster:o,ImageType:"Logo"})}var s=[m.createTotalPointsDesigner(this.props.Form.Model),this.createBranchIcon()];return e.createElement(h.TitleMediaRenderer,{HTMLAttributes:f,HTMLPropsForInnerElement:{children:s},MediaLayout:k,SubTitle:d.Description,Title:d.Title},a)},b.prototype.createBranchIcon=function(){if(this.props.Form.Model.HasValidBranching){var a={HTMLAttributes:{className:"forms-icon-size24x24"},IconName:"BranchMerge",key:"branch-icon"};return e.createElement("div",{className:"office-form-branching-icon office-form-theme-primary-foreground"},k.createFontIconControl(a))}},b.calcImageLayout=function(a){var b=a.Model;if(b.NaturalWidth){var c=a.calcLogoLayout();return{Height:c.ActualHeight,ImageLayout:c.Layout===n.Vertical?"Top":"Left",Width:c.ActualWidth}}return{Height:o.ImagePlaceHolderWidth,ImageLayout:"Left",Width:o.ImagePlaceHolderHeight}},b}(f.ReactComponent);b.TitleRenderer=q,Forms.UX.FormDesignView.TitleRenderer=q},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(3),g=c(2),h=OfficeForm.Exports.Control,i=OfficeForm.Exports.Insight.InsightType,j=OfficeForm.Exports.Insight.registerInsightViewClass,k=OfficeForm.Exports.Resources,l=c(52),m="DesignPage.Responses.CorrelationInsight.ExpandDetail",n=function(a){function b(b){var c=a.call(this,b)||this,d=c.props.Insight.CorrelationInsights.map(function(a,b){return 0===b});return c.state={CorrelationExpanded:d},c}return d(b,a),b.prototype.getChartContainersCount=function(){return this.props.Insight.CorrelationInsights.length},b.prototype.getChartOptions=function(a){var b=Number(this.props.Insight.CorrelationInsights[a].Coefficient.toFixed(2)),c=-25,d=25,e=b>0?c:d,f={gridLineColor:"#E0E0E0",gridLineWidth:10,labels:{enabled:!1},tickWidth:0},g={endOnTick:!1,gridLineWidth:0,labels:{enabled:!1},max:1,min:-1,offset:-32,stackLabels:{enabled:!0,style:{color:"#666666",fontSize:"12px",fontWeight:"normal",textOutline:"0px contrast"},x:e,y:-15},startOnTick:!1,tickColor:"#4FBAB2",tickLength:16,tickPositions:[0],tickWidth:2,title:{text:""}};return{chart:{backgroundColor:"#F4F4F4",spacingBottom:0,spacingLeft:0,spacingRight:0,spacingTop:0,style:{fontFamily:"Segoe UI"},type:"bar"},credits:{enabled:!1},legend:{enabled:!1},plotOptions:{bar:{borderWidth:0,pointWidth:10,stacking:"normal",states:{hover:{enabled:!1}}}},series:[{color:"#4FBAB2",data:[b]}],title:{text:""},tooltip:{enabled:!1},xAxis:f,yAxis:g}},b.prototype.drawCharts=function(){var a=this;f.forEach(this.state.CorrelationExpanded,function(b,c){b&&a.drawChart(c)})},b.prototype.insightViewDescriptionDetail=function(){return e.createElement("div",{className:"correlation-insight-container"},e.createElement("div",{className:"correlation-insight-description"},this.insightViewDescription(),this.insightViewCharts()))},b.prototype.shouldShowSourceQuestions=function(){return!1},b.prototype.insightViewDescription=function(){var a=k.LocalizedStrings.AnalyzeView_Insight_Correlation_Description;return e.createElement("div",{className:"insight-description-text-container"},e.createElement("div",{"aria-label":a,className:"insight-description-text",tabIndex:0},a))},b.prototype.getChartDescription=function(a,b){void 0===b&&(b=!0);var c,d=a.FirstQuestion,e=a.SecondQuestion,f="Rating"===d.Type||"NPS"===d.Type,g="Rating"===e.Type||"NPS"===e.Type;return c=a.Coefficient>0?f&&g?k.LocalizedStrings.AnalyzeView_Insight_Correlation_Chart_Description_Positive_BothRating:f?k.LocalizedStrings.AnalyzeView_Insight_Correlation_Chart_Description_Positive_FirstRating:g?k.LocalizedStrings.AnalyzeView_Insight_Correlation_Chart_Description_Positive_SecondRating:k.LocalizedStrings.AnalyzeView_Insight_Correlation_Chart_Description_Positive_General:f&&g?k.LocalizedStrings.AnalyzeView_Insight_Correlation_Chart_Description_Negative_BothRating:f?k.LocalizedStrings.AnalyzeView_Insight_Correlation_Chart_Description_Negative_FirstRating:g?k.LocalizedStrings.AnalyzeView_Insight_Correlation_Chart_Description_Negative_SecondRating:k.LocalizedStrings.AnalyzeView_Insight_Correlation_Chart_Description_Negative_General,b?c.format(this.createSourceQuestionTooltip(a.FirstQuestion),this.createSourceQuestionTooltip(a.SecondQuestion)):c.format(a.FirstQuestion.Title,a.SecondQuestion.Title)},b.prototype.insightViewCharts=function(){var a=this,b=this.props.Insight.CorrelationInsights,c=b.map(function(b,c){var d=a.getChartDescription(b),f=a.getChartDescription(b,!1),i=h.createGlyphButton({GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{"aria-label":a.state.CorrelationExpanded[c]?k.LocalizedStrings.Correlation_Insight_Collapse_Toggle_Button:k.LocalizedStrings.Correlation_Insight_Expand_Toggle_Button,className:"correlation-insight-element-toggle-button",onClick:function(){var b=a.state.CorrelationExpanded.map(function(a,b){return c===b?!a:a});g.log({eventName:m,eventType:"engagement_event",extraData:{ExpandedCount:b.filter(function(a){return a}).length}}),a.setState({CorrelationExpanded:b})}},Icon:a.state.CorrelationExpanded[c]?"ChevronUp":"ChevronDown"}),j=null;if(a.state.CorrelationExpanded[c]){var l=k.LocalizedStrings.AnalyzeView_Insight_Correlation_Chart_Left_Label,n=k.LocalizedStrings.AnalyzeView_Insight_Correlation_Chart_Right_Label;j=e.createElement("div",{className:"correlation-insight-chart-container"},e.createElement("div",{className:"correlation-insight-chart-label"},l),e.createElement("div",{className:"correlation-insight-chart",id:a.getChartContainerId(c),tabIndex:0}),e.createElement("div",{className:"correlation-insight-chart-label"},n))}return e.createElement("div",{className:"correlation-insight-element-container",key:c},e.createElement("div",{className:"correlation-insight-element-description-container"},e.createElement("div",{"aria-label":f,className:"correlation-insight-element-description",dangerouslySetInnerHTML:{__html:d},tabIndex:0}),i),j)});return e.createElement("div",{className:"correlation-insight-elements-container"},c)},b}(l.InsightViewWithHighCharts);j(n,i.CorrelationInsightCollection)},function(a,b,c){"use strict";function d(a){return g.createElement(q,f({},a))}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),f=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var g=c(0),h=c(2),i=c(1),j=OfficeForm.Exports.Control.createRating,k=OfficeForm.Exports.Control.createTextButton,l=OfficeForm.Exports.Control.createTextField,m=OfficeForm.Exports.Resources,n=OfficeForm.Exports.Utilities,o="Insights.Feedback.Detail",p="Insights.Feedback.Rating",q=function(a){function b(b){var c=a.call(this,b)||this;return c.onRatingValueChange=c.onRatingValueChange.bind(c),c.onClickSubmitButton=c.onClickSubmitButton.bind(c),c.feedbackGuid=n.Guid.newGuid(),c.ratingFeedback=0,c.state={ShowDetailFeedback:!1},c}return e(b,a),b.prototype.render=function(){var a=this.state.ShowDetailFeedback?this.createDetailTextView():this.createRatingView();return g.createElement("div",{className:"insight-feedback-container"},a)},b.prototype.createRatingView=function(){var a=j({HTMLAttributes:{className:"insight-feedback-rating-control"},IsMobile:!1,Label:"",Length:10,onValueChange:this.onRatingValueChange,ShowRatingLabel:!1,Value:this.ratingFeedback});return g.createElement("div",{className:"insight-feedback-rating-container"},g.createElement("div",{className:"insight-feedback-rating-title"},m.LocalizedStrings.AnalyzeView_Insight_Feedback_Rating_Title),g.createElement("div",{className:"insight-feedback-rating-decription"},m.LocalizedStrings.AnalyzeView_Insight_Feedback_Rating_Description),a,g.createElement("div",{className:"insight-feedback-rating-annotations"},g.createElement("div",{className:"insight-feedback-rating-annotation left"},m.LocalizedStrings.AnalyzeView_Insight_Feedback_Rating_Annotation_Left),g.createElement("div",{className:"insight-feedback-rating-annotation right"},m.LocalizedStrings.AnalyzeView_Insight_Feedback_Rating_Annotation_Right)))},b.prototype.createDetailTextView=function(){var a=this,b=l({HTMLAttributes:{className:"insight-feedback-detail-text-field-control"},Label:m.LocalizedStrings.AnalyzeView_Insight_Feedback_Detail_Description,onValueChange:function(b){return a.detailFeedback=b},Value:this.detailFeedback}),c=k({ButtonStyle:"DarkBackGround",HTMLAttributes:{className:"insight-feedback-detail-button office-form-theme-button",onClick:this.onClickSubmitButton},Text:m.LocalizedStrings.AnalyzeView_Insight_Feedback_Detail_Submit
});return g.createElement("div",{className:"insight-feedback-detail-container"},g.createElement("div",{className:"insight-feedback-detail-title"},m.LocalizedStrings.AnalyzeView_Insight_Feedback_Detail_Title),b,g.createElement("div",{className:"insight-feedback-detail-button-container"},c))},b.prototype.onRatingValueChange=function(a){this.ratingFeedback=a,this.submitRatingFeedback(),this.setState({ShowDetailFeedback:!0})},b.prototype.onClickSubmitButton=function(a){this.submitDetailFeedback(),this.props.closeInsightFeedbackDialog()},b.prototype.submitDetailFeedback=function(){var a={feedbackDetail:this.detailFeedback,feedbackId:this.feedbackGuid,feedbackRating:this.ratingFeedback,formId:this.props.FormId,insights:this.props.Insights};h.log({eventName:o,eventType:"engagement_event",extraData:a})},b.prototype.submitRatingFeedback=function(){var a={feedbackId:this.feedbackGuid,feedbackRating:this.ratingFeedback,formId:this.props.FormId,insights:this.props.Insights};h.log({eventName:p,eventType:"engagement_event",extraData:a})},b}(i.ReactComponent);b.InsightFeedbackDialog=q,Forms.UX.createInsightFeedbackDialog=d},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=OfficeForm.Exports.Insight.InsightType,g=OfficeForm.Exports.Insight.registerInsightViewClass,h=OfficeForm.Exports.Resources,i=OfficeForm.Exports.Utilities,j=c(52),k=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.getChartOptions=function(){var a=this.props.Insight,b=a.Keywords.map(function(a){return a.Option.RawValue}),c=[{color:"#32ACA4",data:a.Keywords.map(function(a){return a.PositiveResponses}),name:h.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Positive},{color:"#F8727E",data:a.Keywords.map(function(a){return a.NegativeResponses}),name:h.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Negative},{color:"#EAEAEA",data:a.Keywords.map(function(a){return a.NeutralResponses}),name:h.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Neutral}];return{chart:{style:{fontFamily:"Segoe UI"},type:"bar"},legend:{align:"left",verticalAlign:"top"},plotOptions:{series:{stacking:"normal"}},series:c,title:{text:""},xAxis:{categories:b},yAxis:{min:0}}},b.prototype.shouldShowSourceQuestions=function(){return!1},b.prototype.insightViewDescriptionDetail=function(){return e.createElement("div",{className:"keyword-sentiment-insight-container"},e.createElement("div",{className:"keyword-sentiment-insight-description"},this.insightViewDescription(),this.insightViewCharts()))},b.prototype.insightViewDescription=function(){var a=this.props.Insight,b=h.LocalizedStrings.AnalyzeView_Insight_Keyword_Sentiment_Description,c=b.format(a.TextQuestion.QuestionOrder,a.TextQuestion.Title);return c=i.Html.sanitize(c),e.createElement("div",{className:"insight-description-text-container"},e.createElement("div",{"aria-label":c,className:"insight-description-text",dangerouslySetInnerHTML:{__html:c},tabIndex:0}))},b.prototype.insightViewCharts=function(){var a=this.props.Insight,b=h.LocalizedStrings.AnalyzeView_Insight_Keyword_Sentiment_AriaLabel.format(a.TextQuestion.QuestionOrder,a.TextQuestion.Title);return e.createElement("div",{className:"keyword-sentiment-insight-chart-container"},e.createElement("div",{"aria-label":b,className:"keyword-sentiment-insight-chart",id:this.getChartContainerId(),tabIndex:0}))},b}(j.InsightViewWithHighCharts);g(k,f.KeywordSentimentInsight)},function(a,b,c){"use strict";function d(a){var b=40,c=36;return a&&a.length>b?a.slice(0,c)+"...":a}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var f,g=c(0),h=c(7),i=OfficeForm.Exports.Control,j=OfficeForm.Exports.Flighting,k=OfficeForm.Exports.Insight.InsightType,l=OfficeForm.Exports.Insight.registerInsightViewClass,m=OfficeForm.Exports.Resources,n=OfficeForm.Exports.Utilities,o=c(52);!function(a){a[a.PromoterKeywords=0]="PromoterKeywords",a[a.PassiveKeywords=1]="PassiveKeywords",a[a.DetractorKeywords=2]="DetractorKeywords"}(f||(f={}));var p=["#333333"],q=function(a){function b(b){var c=a.call(this,b)||this;return c.state={CurrentWordCloudType:f.DetractorKeywords,ShouldUpdateWordCloud:!0},j.Flight.isEnabled(j.Flights.WordCloudMultipleRatio)&&(Highcharts.seriesTypes.wordcloud.prototype.placementStrategy.center=function(a,b){if(b.field.height<230&&b.field.width<580){var c=4;b.field.height=b.field.height*c,b.field.width=b.field.width*c}return{rotation:0,x:0,y:0}}),Highcharts.setOptions({colors:p}),c}return e(b,a),b.prototype.insightViewDescriptionDetail=function(){return g.createElement("div",{className:"nps-keywords-container"},g.createElement("div",{className:"nps-keywords-description"},this.insightViewDescription(),this.insightViewCharts()))},b.prototype.shouldShowSourceQuestions=function(){return!1},b.prototype.getChartOptions=function(){var a=10,b="#F4F4F4",c=this.getKeywords().slice(0,a-1).map(function(a){return{name:d(a.Option.RawValue),weight:Math.ceil(a.Score)}}),e=[{allowExtendPlayingField:!0,data:c,maxFontSize:25,minFontSize:5,rotation:{from:0,orientations:0,to:0},spiral:"square",style:{fontFamily:"Segoe UI",fontWeight:"600"},type:"wordcloud"}],f=1===c.length?100:20;return{chart:{backgroundColor:b,margin:f,type:"wordcloud"},credits:{enabled:!1},series:e,title:{text:""},tooltip:{enabled:!1}}},b.prototype.drawCharts=function(){this.state.ShouldUpdateWordCloud&&(a.prototype.drawCharts.call(this),this.setState({ShouldUpdateWordCloud:!1}))},b.prototype.insightViewDescription=function(){var a=m.LocalizedStrings.AnalyzeView_Insight_NPS_Keywords_Description,b=a.format(this.createSourceQuestionTooltip(this.props.Insight.NPSQuestion)),c=a.format(this.props.Insight.NPSQuestion.Title);return g.createElement("div",{className:"insight-description-text-container"},g.createElement("div",{"aria-label":c,className:"insight-description-text",dangerouslySetInnerHTML:{__html:b},tabIndex:0}))},b.prototype.createWordCloudButton=function(a){var b=this,c="AnalyzeView_Insight_NPS_Keywords_Chart_"+f[a]+"_Button_Text",d=m.LocalizedStrings,e="nps-keywords-wordcloud-button",j="nps-rule-insight-chart-button-header";a===this.state.CurrentWordCloudType&&(e=n.Html.combineAttributes(e,"selected"),j=n.Html.combineAttributes(j,"selected"));var k={ButtonStyle:"None",HTMLAttributes:{className:e,onClick:function(){b.setState({CurrentWordCloudType:a,ShouldUpdateWordCloud:!0})},onKeyDown:function(c){switch(c.keyCode){case h.KeyCode.Enter:case h.KeyCode.Space:b.setState({CurrentWordCloudType:a,ShouldUpdateWordCloud:!0})}}},Text:d[c]};return g.createElement("div",{className:"nps-rule-insight-chart-button-container",key:a},g.createElement("div",{className:j}),i.createTextButton(k))},b.prototype.insightViewCharts=function(){var a=null,b="nps-keywords-wordcloud-chart";0===this.getKeywords().length&&(b=n.Html.combineAttributes(b,"empty"),a=g.createElement("div",{className:"nps-keywords-wordcloud-empty-message-container"},g.createElement("div",{className:"nps-keywords-wordcloud-empty-img"},g.createElement("img",{className:"nps-keywords-wordcloud-empty-image",src:"../../Images/insight/empty_wordcloud_icon.png"})),g.createElement("div",{className:"nps-keywords-wordcloud-empty-message"},m.LocalizedStrings.AnalyzeView_Insight_WordCloud_Empty_Message)));var c=m.LocalizedStrings.AnalyzeView_Insight_NPS_Keywords_Chart_AriaLabel.format(this.getKeywords().map(function(a){return a.Option.RawValue}).join(",")),d=g.createElement("div",{"aria-label":c,className:b,id:this.getChartContainerId(),tabIndex:0}),e=g.createElement("div",{className:"nps-keywords-wordcloud-chart-container"},g.createElement("div",{className:"nps-rule-insight-detail-buttons-container"},g.createElement("div",{className:"nps-rule-insight-chart-buttons"},this.createWordCloudButton(f.DetractorKeywords),this.createWordCloudButton(f.PassiveKeywords),this.createWordCloudButton(f.PromoterKeywords))),g.createElement("div",{className:"nps-rule-insight-detail-grid-container"},a,d));return g.createElement("div",{className:"nps-keywords-wordcloud-charts-container"},e)},b.prototype.getKeywords=function(){var a=this.props.Insight;switch(this.state.CurrentWordCloudType){case f.PromoterKeywords:return a.PromoterKeywords;case f.PassiveKeywords:return a.PassiveKeywords;case f.DetractorKeywords:return a.DetractorKeywords;default:return new Array}},b}(o.InsightViewWithHighCharts);l(q,k.NPSKeywordsInsight)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(3),g=OfficeForm.Exports.Insight.InsightType,h=OfficeForm.Exports.Insight.registerInsightViewClass,i=OfficeForm.Exports.Resources,j=OfficeForm.Exports.Utilities,k=c(52),l=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.getChartOptions=function(){var a=this.props.Insight,b=a.LikertQuestion.Choices.map(function(a){return a.RawValue}),c=[a.Item2.Title,a.Item1.Title],d=f.groupBy(a.AnswersOfFirstItem,function(a){return a.RawValue}),e=f.map(d,function(d){return{x:f.findIndex(b,function(a){return a===d[0].RawValue}),y:f.findIndex(c,function(b){return b===a.Item1.Title}),z:d.length}}),g=f.groupBy(a.AnswersOfSecondItem,function(a){return a.RawValue}),h=f.map(g,function(d){return{x:f.findIndex(b,function(a){return a===d[0].RawValue}),y:f.findIndex(c,function(b){return b===a.Item2.Title}),z:d.length}}),j=[{color:"#8CC83F",data:h,name:a.Item2.Title},{color:"#1379D8",data:e,name:a.Item1.Title}],k=i.LocalizedStrings.AnalyzeView_Insight_PartialOrder_Tooltip.format("{point.z}");return{chart:{backgroundColor:"#F4F4F4",style:{fontFamily:"Segoe UI"},type:"bubble"},credits:{enabled:!1},legend:{enabled:!1},plotOptions:{bubble:{marker:{fillOpacity:1,lineWidth:0},maxSize:50,minSize:10,zMax:f.max(f.flatten(j.map(function(a){return a.data})),function(a){return a.z}).z,zMin:f.min(f.flatten(j.map(function(a){return a.data})),function(a){return a.z}).z}},series:j,title:{text:""},tooltip:{pointFormat:k},xAxis:{gridLineWidth:0,labels:{formatter:function(){return b[this.value]},style:{color:"#333333",fontSize:"12px"}},lineWidth:0,offset:30,opposite:!0,tickInterval:1,tickWidth:0,title:{text:""}},yAxis:{endOnTick:!1,gridLineColor:"#C8C8C8",gridLineWidth:1,labels:{formatter:function(){return c[this.value]},style:{color:"#333333",fontSize:"12px"}},offset:20,startOnTick:!1,tickInterval:1,title:{text:""}}}},b.prototype.shouldShowSourceQuestions=function(){return!1},b.prototype.insightViewDescriptionDetail=function(){return e.createElement("div",{className:"partialorder-insight-container"},e.createElement("div",{className:"partialorder-insight-description"},this.insightViewDescription(),this.insightViewCharts()))},b.prototype.insightViewDescription=function(){var a=this.props.Insight,b=i.LocalizedStrings.AnalyzeView_Insight_PartialOrder_Description,c=b.format(j.Html.sanitize(a.Item1.Title),j.Html.sanitize(a.Item2.Title),this.createSourceQuestionTooltip(a.LikertQuestion)),d=b.format(j.Html.sanitize(a.Item1.Title),j.Html.sanitize(a.Item2.Title),a.LikertQuestion.Title);return e.createElement("div",{className:"insight-description-text-container"},e.createElement("div",{"aria-label":d,className:"insight-description-text",dangerouslySetInnerHTML:{__html:c},tabIndex:0}))},b.prototype.insightViewCharts=function(){var a=this.props.Insight,b=i.LocalizedStrings.AnalyzeView_Insight_PartialOrder_AriaLabel.format(a.GreaterValuePercentage,a.Item1.Title,a.Item2.Title);return e.createElement("div",{className:"partialorder-insight-chart-container"},e.createElement("div",{"aria-label":b,className:"partialorder-insight-chart",id:this.getChartContainerId(),tabIndex:0}))},b}(k.InsightViewWithHighCharts);h(l,g.PartialOrderInsight)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e,f=c(0),g=c(3),h=OfficeForm.Exports.Control.createFontIconControl,i=OfficeForm.Exports.Control.createTextButton,j=OfficeForm.Exports.Insight.InsightType,k=OfficeForm.Exports.Insight.InsightViewBase,l=OfficeForm.Exports.Insight.registerInsightViewClass,m=OfficeForm.Exports.Resources,n=OfficeForm.Exports.Utilities;!function(a){a[a.Positive=0]="Positive",a[a.Neutral=1]="Neutral",a[a.Negative=2]="Negative"}(e||(e={}));var o=function(a){function b(b){var c,d=a.call(this,b)||this,f=d.getOutstandingSentiments();return c=1===f.length?f[0]:e.Negative,d.state={ActiveDetail:c,OutstandingSentiments:f},d}return d(b,a),b.prototype.updateContent=function(){this.state.ShowSourceDetail&&this.createDataTable()},b.prototype.getSourceButtonTitle=function(){return this.state.ShowSourceDetail?m.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Hide_Detail:m.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Show_Detail},b.prototype.insightViewSourceQuestions=function(){return f.createElement("div",{className:"response-sentiment-insight-detail-container"},f.createElement("div",{className:"response-sentiment-insight-detail-buttons-container"},this.createDetailButton(e.Negative),this.createDetailButton(e.Neutral),this.createDetailButton(e.Positive)),f.createElement("div",{className:"response-sentiment-insight-detail-grid-container"},f.createElement("div",{className:"response-sentiment-insight-detail-grid-wraper"})))},b.prototype.insightViewDescriptionDetail=function(){return f.createElement("div",{className:"response-sentiment-insight-container"},this.insightViewDescription(),this.insightViewCharts())},b.prototype.insightViewDescription=function(){var a,b=this.props.Insight;if(1===this.state.OutstandingSentiments.length)switch(this.state.OutstandingSentiments[0]){case e.Positive:a=m.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Description_Positive;break;case e.Negative:a=m.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Description_Negative;break;case e.Neutral:a=m.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Description_Neutral;break;default:a=m.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Description}else a=m.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Description;var c=a.format(this.createSourceQuestionTooltip(b.TextQuestion)),d=a.format(b.TextQuestion.Title);return f.createElement("div",{className:"insight-description-text-container"},f.createElement("div",{"aria-label":d,className:"insight-description-text",dangerouslySetInnerHTML:{__html:c},tabIndex:0}))},b.prototype.insightViewCharts=function(){if(this.state.ShowSourceDetail)return null;var a=this.props.Insight,b=m.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Description.format(a.TextQuestion.QuestionOrder,a.TextQuestion.Title);return f.createElement("div",{className:"response-sentiment-insight-chart-container"},f.createElement("div",{"aria-label":b,className:"response-sentiment-insight-chart",tabIndex:0},f.createElement("div",{className:"response-sentiment-insight-emojis-container"},this.getChartIconElement(e.Negative),this.getChartIconElement(e.Neutral),this.getChartIconElement(e.Positive))))},b.prototype.getChartIconElement=function(a){var b,c,d,g=this.props.Insight;switch(a){case e.Positive:c="Emoji2",b=m.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Positive,d=g.PositiveResponses.length;break;case e.Negative:c="Sad",b=m.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Negative,d=g.NegativeResponses.length;break;case e.Neutral:c="EmojiNeutral",b=m.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Neutral,d=g.NeutralResponses.length;break;default:return null}var i=h({HTMLAttributes:{className:"response-sentiment-insight-emoji-icon"},IconName:c}),j="response-sentiment-insight-element-emoji",k="response-sentiment-insight-element-title",l="response-sentiment-insight-element-number";this.state.OutstandingSentiments.indexOf(a)>=0&&(j=n.Html.combineAttributes(j,e[a].toLowerCase()),k=n.Html.combineAttributes(k,e[a].toLowerCase()),l=n.Html.combineAttributes(l,e[a].toLowerCase()));var o;return o=1===d?m.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Single_Response_Count.format(d):m.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Multi_Response_Count.format(d),f.createElement("div",{className:"response-sentiment-insight-emoji-container"},f.createElement("div",{className:j},i),f.createElement("div",{className:k},b),f.createElement("div",{className:l},o))},b.prototype.createDataTable=function(){var a;switch(this.state.ActiveDetail){case e.Positive:a=this.props.Insight.PositiveResponses;break;case e.Negative:a=this.props.Insight.NegativeResponses;break;case e.Neutral:a=this.props.Insight.NeutralResponses;break;default:a=new Array}var b=a.map(function(a){return[a.m_Item1,n.Html.sanitize(a.m_Item2.RawValue)]});$(".response-sentiment-insight-detail-grid").remove(),$(".response-sentiment-insight-detail-grid-wraper").append("<table class='response-sentiment-insight-detail-grid hover stripe cell-border'>"),$(".response-sentiment-insight-detail-grid").DataTable({autoWidth:!0,columns:[{title:m.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Id},{title:m.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Responses}],data:b,info:!1,paging:!1,searching:!1})},b.prototype.createDetailButton=function(a){var b,c=this;switch(a){case e.Positive:b=m.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Positive;break;case e.Negative:b=m.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Negative;break;case e.Neutral:b=m.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Neutral;break;default:return null}var d="response-sentiment-insight-detail-button",g="response-sentiment-insight-detail-button-header";a===this.state.ActiveDetail&&(d=n.Html.combineAttributes(d,"selected"),g=n.Html.combineAttributes(g,"selected"));var h=i({ButtonStyle:"None",HTMLAttributes:{className:d,onClick:function(){c.setState({ActiveDetail:a})}},Text:b});return f.createElement("div",{className:"response-sentiment-insight-detail-button-container"},f.createElement("div",{className:g}),h)},b.prototype.getOutstandingSentiments=function(){var a=this.props.Insight,b=[{SentimentCount:a.NegativeResponses.length,SentimentType:e.Negative},{SentimentCount:a.NeutralResponses.length,SentimentType:e.Neutral},{SentimentCount:a.PositiveResponses.length,SentimentType:e.Positive}],c=g.max(b,function(a){return a.SentimentCount});return b.filter(function(a){return a.SentimentCount===c.SentimentCount}).map(function(a){return a.SentimentType})},b}(k);l(o,j.ResponseSentimentInsight)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e,f=c(0),g=c(3),h=c(2),i=OfficeForm.Exports.Control.createFontIconControl,j=OfficeForm.Exports.Control.createSelect,k=OfficeForm.Exports.Control.createTextButton,l=OfficeForm.Exports.Insight.InsightType,m=OfficeForm.Exports.Insight.InsightViewBase,n=OfficeForm.Exports.Insight.registerInsightViewClass,o=OfficeForm.Exports.Resources,p=OfficeForm.Exports.Utilities;!function(a){a[a.Positive=0]="Positive",a[a.Neutral=1]="Neutral",a[a.Negative=2]="Negative"}(e||(e={}));var q="DesignPage.Responses.ResponseSentimentInsight.SwitchQuestion",r="DesignPage.Responses.ResponseSentimentInsight.SwitchSentiment",s=function(a){function b(b){var c=a.call(this,b)||this;c.onActiveInsightChange=c.onActiveInsightChange.bind(c);var d=g.max(c.props.Insight.ResponseSentimentInsights,function(a){return a.Score});return c.props.setCurrentViewInsight(d),c.state={ActiveDetail:e.Negative,ActiveInsight:d},c}return d(b,a),b.prototype.updateContent=function(){this.state.ShowSourceDetail&&this.createDataTable()},b.prototype.getSourceButtonTitle=function(){return this.state.ShowSourceDetail?o.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Hide_Detail:o.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Show_Detail},b.prototype.insightViewSourceQuestions=function(){return f.createElement("div",{className:"response-sentiment-insight-detail-container"},f.createElement("div",{className:"response-sentiment-insight-detail-buttons-container"},this.createDetailButton(e.Negative),this.createDetailButton(e.Neutral),this.createDetailButton(e.Positive)),f.createElement("div",{className:"response-sentiment-insight-detail-grid-container"},f.createElement("div",{className:"response-sentiment-insight-detail-grid-wraper"})))},b.prototype.insightViewDescriptionDetail=function(){return f.createElement("div",{className:"response-sentiment-insight-container"},this.insightViewDescription(),this.insightViewQuestionSelect(),this.insightViewCharts())},b.prototype.insightViewDescription=function(){var a=o.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Collection_Description;return f.createElement("div",{className:"insight-description-text-container"},f.createElement("div",{"aria-label":a,className:"insight-description-text",tabIndex:0},a))},b.prototype.insightViewQuestionSelect=function(){var a=this.state.ActiveInsight,b=o.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Dropdown_Option,c=b.format(a.TextQuestion.QuestionOrder,a.TextQuestion.Title),d=this.props.Insight.ResponseSentimentInsights.map(function(c){var d=c.TextQuestion;return{Disabled:c.TextQuestion.Id===a.TextQuestion.Id,DisplayName:b.format(d.QuestionOrder,d.Title),Key:d.QuestionOrder,Value:b.format(d.QuestionOrder,d.Title)}}),e=j({DisplayValue:!0,HTMLAttributes:{"aria-label":c,className:"response-sentiment-insight-collection-dropdown"},onValueChange:this.onActiveInsightChange,Placeholder:c,SelectOptions:d,Value:c}),g=o.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Dropdown_Title;return f.createElement("div",{className:"response-sentiment-insight-dropdown-container"},f.createElement("div",{className:"response-sentiment-insight-dropdown-title"},g),f.createElement("div",{className:"insight-view-dropdown-element"},e))},b.prototype.insightViewCharts=function(){if(this.state.ShowSourceDetail)return null;var a=this.state.ActiveInsight,b=o.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Description.format(a.TextQuestion.QuestionOrder,a.TextQuestion.Title);return f.createElement("div",{className:"response-sentiment-insight-chart-container"},f.createElement("div",{"aria-label":b,className:"response-sentiment-insight-chart",tabIndex:0},f.createElement("div",{className:"response-sentiment-insight-emojis-container"},this.getChartIconElement(e.Negative),this.getChartIconElement(e.Neutral),this.getChartIconElement(e.Positive))))},b.prototype.getChartIconElement=function(a){var b,c,d,g=this.state.ActiveInsight,h=this.getOutstandingSentiments();switch(a){case e.Positive:c="Emoji2",b=o.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Positive,d=g.PositiveResponses.length;break;case e.Negative:c="Sad",b=o.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Negative,d=g.NegativeResponses.length;break;case e.Neutral:c="EmojiNeutral",b=o.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Neutral,d=g.NeutralResponses.length;break;default:return null}var j=i({HTMLAttributes:{className:"response-sentiment-insight-emoji-icon"},IconName:c}),k="response-sentiment-insight-element-emoji",l="response-sentiment-insight-element-title",m="response-sentiment-insight-element-number";h.indexOf(a)>=0&&(k=p.Html.combineAttributes(k,e[a].toLowerCase()),l=p.Html.combineAttributes(l,e[a].toLowerCase()),m=p.Html.combineAttributes(m,e[a].toLowerCase()));var n;return n=1===d?o.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Single_Response_Count.format(d):o.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Multi_Response_Count.format(d),f.createElement("div",{className:"response-sentiment-insight-emoji-container"},f.createElement("div",{className:k},j),f.createElement("div",{className:l},b),f.createElement("div",{className:m},n))},b.prototype.createDataTable=function(){var a,b=this.state.ActiveInsight;switch(this.state.ActiveDetail){case e.Positive:a=b.PositiveResponses;break;case e.Negative:a=b.NegativeResponses;break;case e.Neutral:a=b.NeutralResponses;break;default:a=new Array}var c=a.map(function(a){return[a.m_Item1,p.Html.sanitize(a.m_Item2.RawValue)]});$(".response-sentiment-insight-detail-grid").remove(),$(".response-sentiment-insight-detail-grid-wraper").append("<table class='response-sentiment-insight-detail-grid hover stripe cell-border'>"),$(".response-sentiment-insight-detail-grid").DataTable({autoWidth:!0,columns:[{title:o.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Id},{title:o.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Responses}],data:c,info:!1,paging:!1,searching:!1})},b.prototype.createDetailButton=function(a){var b,c=this;switch(a){case e.Positive:b=o.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Positive;break;case e.Negative:b=o.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Negative;break;case e.Neutral:b=o.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Neutral;break;default:return null}var d="response-sentiment-insight-detail-button",g="response-sentiment-insight-detail-button-header";a===this.state.ActiveDetail&&(d=p.Html.combineAttributes(d,"selected"),g=p.Html.combineAttributes(g,"selected"));var i=k({ButtonStyle:"None",HTMLAttributes:{className:d,onClick:function(){h.log({eventName:r,eventType:"engagement_event",extraData:{SentimentType:a}}),c.setState({ActiveDetail:a})}},Text:b});return f.createElement("div",{className:"response-sentiment-insight-detail-button-container"},f.createElement("div",{className:g}),i)},b.prototype.getOutstandingSentiments=function(){var a=this.state.ActiveInsight,b=[{SentimentCount:a.NegativeResponses.length,SentimentType:e.Negative},{SentimentCount:a.NeutralResponses.length,SentimentType:e.Neutral},{SentimentCount:a.PositiveResponses.length,SentimentType:e.Positive}],c=g.max(b,function(a){return a.SentimentCount});return b.filter(function(a){return a.SentimentCount===c.SentimentCount}).map(function(a){return a.SentimentType})},b.prototype.onActiveInsightChange=function(a){var b=this,c=o.LocalizedStrings.AnalyzeView_Insight_Response_Sentiment_Dropdown_Option;this.props.Insight.ResponseSentimentInsights.forEach(function(d){var e=d.TextQuestion;return c.format(e.QuestionOrder,e.Title)===a?(h.log({eventName:q,eventType:"engagement_event",extraData:{InsightScore:d.Score,QuestionId:d.TextQuestion.Id,QuestionIndex:d.TextQuestion.QuestionOrder,QuestionSentimentConfidence:d.TextQuestion.SentimentConfidence,QuestionTag:d.TextQuestion.Tag}}),b.props.setCurrentViewInsight(d),void b.setState({ActiveInsight:d})):void 0})},b}(m);n(s,l.ResponseSentimentInsightCollection)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(3),g=c(2),h=OfficeForm.Exports.Insight.insightColorPallet,i=OfficeForm.Exports.Insight.InsightType,j=OfficeForm.Exports.Insight.registerInsightViewClass,k=OfficeForm.Exports.Resources,l=OfficeForm.Exports.Control,m=OfficeForm.Exports.Utilities,n=c(52),o="DesignPage.Responses.SummaryDistributionInsight.SwitchPrimaryQuestion",p="DesignPage.Responses.SummaryDistributionInsight.SwitchSecondQuestion",q=function(a){function b(b){var c=a.call(this,b)||this;return c.questionList=[],c.summaryDistributionInsightList=b.Insight.SummaryDistributions,c.getDistinctQuestionList=c.getDistinctQuestionList.bind(c),c.onPrimaryValueChange=c.onPrimaryValueChange.bind(c),c.onSecondValueChange=c.onSecondValueChange.bind(c),c.checkDisabled=c.checkDisabled.bind(c),c.getDistinctQuestionList(),c.insight=f.max(c.summaryDistributionInsightList,function(a){return a.Score}),c.props.setCurrentViewInsight(c.insight),c.setState({primaryQuestionId:c.insight.PrimaryQuestion.Id,secondQuestionId:c.insight.SecondQuestion.Id}),c}return d(b,a),b.prototype.insightViewDescriptionDetail=function(){var a=k.LocalizedStrings.AnalyzeView_Insight_Summary_Distribution_Description;return e.createElement("div",{className:"summary-insight-container"},e.createElement("div",{"aria-label":a,className:"insight-description-text-container",tabIndex:0,dangerouslySetInnerHTML:{__html:a}}),this.insightViewCharts())},b.prototype.shouldShowSourceQuestions=function(){return!1},b.prototype.getChartOptions=function(){var a=this.insight,b=45,c=this.insight.DistinctPrimaryAnswers.map(function(a){return a.RawValue}),d=this.insight.Frequencies,e=a.DistinctSecondAnswers.map(function(a,b){var c=Math.floor(b/h.length)%2;return{color:h[b%h.length][c],data:d.map(function(a){return a[b]}),name:a.RawValue}}),f="<span style='color:{0}'> </span><span>{1}</span>: {2} ({3}%)<br/>".format("{point.color}","{series.name}","{point.y}","{point.percentage:.0f}"),g=m.isEdge()?!1:!0,i=m.isEdge()?!1:!0;return{chart:{backgroundColor:"#F4F4F4",height:c.length*b,marginBottom:0,marginLeft:248,marginTop:0,spacingLeft:30,style:{fontFamily:"Segoe UI",fontSize:"13px"},type:"bar",width:690},credits:{enabled:!1},legend:{enabled:!1},plotOptions:{bar:{pointWidth:30,stacking:"percent",states:{hover:{brightness:.2,enabled:g}}}},series:e,title:{text:""},tooltip:{animation:i,borderRadius:0,borderWidth:0,headerFormat:"",pointFormat:f,shared:!0},xAxis:{categories:c,labels:{align:"right",reserveSpace:!0,style:{color:"#333333",fontSize:"13px",fontWeight:"normal",textOverflow:"ellipsis"}},lineWidth:0,offset:13,tickWidth:0},yAxis:{visible:!1}}},b.prototype.creatDropDownForQuestion=function(a){var b=this,c=k.LocalizedStrings.AnalyzeView_Insight_Tooltip_Template,d=k.LocalizedStrings.Analyze_Insight_summary_Question_Title,f=c.format(a.QuestionOrder),g=this.questionList.map(function(e){return{Disabled:b.checkDisabled(e,a),DisplayName:d.format(e.QuestionOrder,e.Title),Key:a===b.insight.PrimaryQuestion?"summary-distribution-primary-option_"+e.Id:"summary-distribution-second-option_"+e.Id,Value:c.format(e.QuestionOrder)}}),h=l.createSelect({HTMLAttributes:{"aria-label":f,className:f},key:a===this.insight.PrimaryQuestion?"summary-distribution-primary-dropdown":"summary-distribution-second-dropdown",onValueChange:a===this.insight.PrimaryQuestion?this.onPrimaryValueChange:this.onSecondValueChange,Placeholder:f,SelectOptions:g,Value:f});return e.createElement("div",{className:"insight-view-dropdown-element"},h)},b.prototype.insightViewCharts=function(){var a=this.insight.DistinctSecondAnswers.map(function(a,b){var c=a.RawValue,d=Math.floor(b/h.length)%2,f=h[b%h.length][d];
return e.createElement("div",{className:"insight-view-summary-chart-legend",key:b},e.createElement("div",{className:"insight-view-summary-chart-legend-dot",style:{background:f}}),e.createElement("div",{className:"insight-view-summary-chart-legend-text",title:c},c))});return e.createElement("div",{className:"insight-view-summary-chart-container"},e.createElement("div",{className:"insight-view-summary-chart-dropdown-container"},e.createElement("div",{className:"insight-view-primary-dropdown-container"},this.creatDropDownForQuestion(this.insight.PrimaryQuestion)),e.createElement("div",{className:"insight-view-second-dropdown-container"},this.creatDropDownForQuestion(this.insight.SecondQuestion))),e.createElement("div",{className:"insight-view-summary-chartandlabel-container"},e.createElement("div",{className:"insight-view-summary-chart-label-container"},e.createElement("div",{className:"insight-view-summary-chart-primary-question-container"}),e.createElement("div",{className:"insight-view-summary-chart-legend-container"},e.createElement("div",{className:"insight-view-summary-chart-second-question-leged"},a))),e.createElement("div",{className:"insight-view-summary-chart",id:this.getChartContainerId(),tabIndex:0,role:"presentation"})))},b.prototype.onPrimaryValueChange=function(a){var b=this,c=k.LocalizedStrings.AnalyzeView_Insight_Tooltip_Template;this.summaryDistributionInsightList.forEach(function(d){c.format(d.PrimaryQuestion.QuestionOrder)===a&&d.SecondQuestion.Id===b.insight.SecondQuestion.Id&&(b.insight=d)}),g.log({eventName:o,eventType:"engagement_event",extraData:{InsightScore:this.insight.Score,QuestionId:this.insight.PrimaryQuestion.Id,QuestionIndex:this.insight.PrimaryQuestion.QuestionOrder,QuestionTag:this.insight.PrimaryQuestion.Tag}}),this.props.setCurrentViewInsight(this.insight),this.changeAnswerOrder(),this.setState({primaryQuestionId:this.insight.PrimaryQuestion.Id,secondQuestionId:this.insight.SecondQuestion.Id})},b.prototype.onSecondValueChange=function(a){var b=this,c=k.LocalizedStrings.AnalyzeView_Insight_Tooltip_Template;this.summaryDistributionInsightList.forEach(function(d){d.PrimaryQuestion.Id===b.insight.PrimaryQuestion.Id&&c.format(d.SecondQuestion.QuestionOrder)===a&&(b.insight=d)}),g.log({eventName:p,eventType:"engagement_event",extraData:{InsightScore:this.insight.Score,QuestionId:this.insight.SecondQuestion.Id,QuestionIndex:this.insight.SecondQuestion.QuestionOrder,QuestionTag:this.insight.SecondQuestion.Tag}}),this.props.setCurrentViewInsight(this.insight),this.changeAnswerOrder(),this.setState({primaryQuestionId:this.insight.PrimaryQuestion.Id,secondQuestionId:this.insight.SecondQuestion.Id})},b.prototype.getDistinctQuestionList=function(){var a=this,b=[];this.summaryDistributionInsightList.forEach(function(c){-1===b.indexOf(c.PrimaryQuestion.Id)&&(a.questionList.push(c.PrimaryQuestion),b.push(c.PrimaryQuestion.Id))}),this.questionList=this.questionList.sort(function(a,b){return a.QuestionOrder-b.QuestionOrder})},b.prototype.changeAnswerOrder=function(){var a=this,b=this.insight.PrimaryQuestion.Choices.map(function(b){return f.findIndex(a.insight.DistinctPrimaryAnswers,function(a){return a.RawValue===b.RawValue})}).filter(function(a){return a>=0}),c=this.insight.SecondQuestion.Choices.map(function(b){return f.findIndex(a.insight.DistinctSecondAnswers,function(a){return a.RawValue===b.RawValue})}).filter(function(a){return a>=0}),d=this.insight.Frequencies.map(function(d,e){return d.map(function(d,f){return a.insight.Frequencies[b[e]][c[f]]})}),e=this.insight.DistinctPrimaryAnswers.map(function(c,d){return a.insight.DistinctPrimaryAnswers[b[d]]}),g=this.insight.DistinctSecondAnswers.map(function(b,d){return a.insight.DistinctSecondAnswers[c[d]]});this.insight.DistinctPrimaryAnswers=e,this.insight.DistinctSecondAnswers=g,this.insight.Frequencies=d},b.prototype.checkDisabled=function(a,b){var c=!1,d=b.Id===this.insight.PrimaryQuestion.Id?this.insight.SecondQuestion:this.insight.PrimaryQuestion;return a.Id===d.Id?!0:(this.summaryDistributionInsightList.forEach(function(b){b.PrimaryQuestion.Id===a.Id&&b.SecondQuestion.Id===d.Id?c=!0:b.PrimaryQuestion.Id===d.Id&&b.SecondQuestion.Id===a.Id&&(c=!0)}),!c)},b}(n.InsightViewWithHighCharts);j(q,i.SummaryDistributionCollection)},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(3),g=OfficeForm.Exports.Insight.insightColorPallet,h=OfficeForm.Exports.Insight.InsightType,i=OfficeForm.Exports.Insight.registerInsightViewClass,j=OfficeForm.Exports.Resources,k=c(52),l=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.insightViewDescriptionDetail=function(){return e.createElement("div",{className:"summary-insight-container"},this.insightViewDescriptionConclusionText(),this.insightViewCharts())},b.prototype.shouldShowSourceQuestions=function(){return!1},b.prototype.getChartOptions=function(){var a=this.props.Insight,b=f.flatten([a.Groups,a.Exceptionals]),c=b.map(function(b){return a.DistinctPrimaryAnswers[b].Value[0].RawValue}),d=b.map(function(b){return a.Frequencies[b]}),e=a.DistinctSecondAnswers.map(function(a,b){return{color:g[b%g.length][0],data:d.map(function(a){return a[b]}),name:a.Value[0].RawValue}}),h="<span style='color:{0}'> </span><span>{1}</span>: {2} ({3}%)<br/>".format("{point.color}","{series.name}","{point.y}","{point.percentage:.0f}");return{chart:{height:50*c.length,marginLeft:250,spacingLeft:250,style:{fontFamily:"Segoe UI"},type:"bar"},credits:{enabled:!1},legend:{enabled:!1},plotOptions:{series:{pointWidth:"30",stacking:"percent"}},series:e,title:{text:""},tooltip:{borderRadius:0,borderWidth:0,headerFormat:"",pointFormat:h,shared:!0},xAxis:{categories:c,labels:{align:"right",reserveSpace:!0,style:{color:"#333333",fontSize:"12px",fontWeight:"normal",textOverflow:"ellipsis",width:"300"}},lineWidth:0,offset:50,tickWidth:0},yAxis:{visible:!1}}},b.prototype.insightViewDescriptionConclusionText=function(){var a=this.props.Insight,b=j.LocalizedStrings.AnalyzeView_Insight_Summary_Insight_Description,c=b.format(this.createSourceQuestionTooltip(a.PrimaryQuestion),this.createSourceQuestionTooltip(a.SecondQuestion)),d=b.format(a.PrimaryQuestion.Title,a.SecondQuestion.Title);return e.createElement("div",{"aria-label":d,className:"insight-description-text-container",tabIndex:0,dangerouslySetInnerHTML:{__html:c}})},b.prototype.insightViewCharts=function(){var a=this.props.Insight,b=a.DistinctSecondAnswers.map(function(a,b){var c=a.Value[0].RawValue,d=g[b%g.length][0];return e.createElement("div",{className:"insight-view-summary-chart-legend",key:b},e.createElement("div",{className:"insight-view-summary-chart-legend-dot",style:{background:d}}),e.createElement("div",{className:"insight-view-summary-chart-legend-text"},c))});return e.createElement("div",{className:"insight-view-summary-chart-container"},e.createElement("div",{className:"insight-view-summary-chart-title-container"},e.createElement("div",{className:"insight-view-summary-chart-primary-question-container"},a.PrimaryQuestion.Title),e.createElement("div",{className:"insight-view-summary-chart-second-question-container"},e.createElement("div",{className:"insight-view-summary-chart-second-question-title"},a.SecondQuestion.Title),e.createElement("div",{className:"insight-view-summary-chart-second-question-leged"},b))),e.createElement("div",{className:"insight-view-summary-chart",id:this.getChartContainerId(),tabIndex:0,role:"presentation"}))},b}(k.InsightViewWithHighCharts);i(l,h.SummaryInsight)},function(a,b,c){"use strict";function d(a,b,c,d,i,j){if(b)return e.createElement(g.QuestionSuggestionCard,{Form:a,insertQuestionsCallback:j,key:b.Model.Id,Question:b,ShowSuggestionCard:c});if(d&&a.FormElementManager.TopQuestionMasters&&0===a.FormElementManager.TopQuestionMasters.length)return e.createElement(h.TemplateSuggestionCard,{Form:a,insertQuestionsCallback:j,ShowSuggestionCard:c});if(!d&&!i){var k=f.last(a.FormElementManager.TopQuestionMasters);return k?e.createElement(g.QuestionSuggestionCard,{Form:a,insertQuestionsCallback:j,Question:k,ShowSuggestionCard:c}):e.createElement(h.TemplateSuggestionCard,{Form:a,insertQuestionsCallback:j,ShowSuggestionCard:c})}return null}Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(3),g=c(183),h=c(186);Forms.UX.Intelligence.createSuggestionCard=d},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(3),f=c(109),g=OfficeForm.Exports.Flighting,h=function(a){function b(b){var c=a.call(this,b)||this;c.getQuestionSuggestionTimeout=500,c.onQuestionTitleChange=c.onQuestionTitleChange.bind(c),c.askSuggestion=c.askSuggestion.bind(c),c.scheduleAskSuggestion=c.scheduleAskSuggestion.bind(c);var d=c.props.Question;return d.observe(c.onQuestionTitleChange,[d.Schema.Title]),c}return d(b,a),b.prototype.componentWillUnmount=function(){var a=this.props.Question;a.unobserve(this.onQuestionTitleChange)},b.prototype.askSuggestion=function(){var a=this.props.Form,b=this.props.Question;g.Flight.isEnabled(g.Flights.MathQuestionGeneration)&&a.SettingMaster.Model.IsQuizMode&&b&&b.Model.IsMathQuiz?this.askMathSuggestion():!a.SettingMaster.Model.IsQuizMode&&b.Model.Title&&this.askSurveySuggestion()},b.prototype.getSuggestionType=function(){return f.SuggestionType.QuestionSuggestion},b.prototype.askSurveySuggestion=function(){var a=this,b=this.props.Question,c={ExistingQuestions:e.map(b.Form.Model.Questions,function(a){return a.Title}),Locale:OfficeFormServerInfo.cultureInfo.Name,QuestionType:b.Model.Type,TargetQuestion:b.Model.Title};Forms.UX.FormDesignView.FormIntelligenceLauncher.getQuestionsIntelligenceResult(c).done(function(d){if(d&&d.MatchQuery){if(g.Flight.isEnabled(g.Flights.QuestionTagForIntelligence)){var e=d;"pending"!==a.props.Form.SyncBlocker.state()&&c.TargetQuestion===b.Model.Title&&e.QuestionTagForIntelligence.length>0&&(b.Model.QuestionTagForIntelligence=e.QuestionTagForIntelligence,b.Model.IsFromSuggestion=e.IsFromSuggestion)}var h=f.getSafeTemplateSuggestion(d);a.updateSuggestion(h)}}).fail(function(b){a.setState({SelectedIndex:[],TemplateIndex:0,Templates:[]})})},b.prototype.askMathSuggestion=function(){var a=this,b=this.props.Form,c=this.props.Question,d=c.Model.Title,g=c.Model.LastMathMLFormula,h=e.filter(b.Model.Questions,function(a){return a.IsMathQuiz});g&&Forms.UX.FormDesignView.FormIntelligenceLauncher.getMathQuestionsSuggestion({ExistingMathQuestions:e.map(h,function(a){return a.Subtitle}),ExistingMathQuestionTitles:e.map(h,function(a){return a.Title}),FormId:b.Model.Id,Formula:g,QuestionId:c.Model.Id,Title:d}).done(function(b){if(b&&b.MatchQuery){var c=f.getSafeTemplateSuggestion(b);a.updateSuggestion(c)}}).fail(function(b){a.setState({SelectedIndex:[],TemplateIndex:0,Templates:[]})})},b.prototype.onQuestionTitleChange=function(){this.setState({SelectedIndex:[],TemplateIndex:0,Templates:[]},this.scheduleAskSuggestion)},b.prototype.scheduleAskSuggestion=function(){this.getQuestionSuggestionTimer&&window.clearTimeout(this.getQuestionSuggestionTimer),this.getQuestionSuggestionTimer=window.setTimeout(this.askSuggestion,this.getQuestionSuggestionTimeout)},b}(f.BaseSuggestionCard);b.QuestionSuggestionCard=h},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(7),h=c(1),i=OfficeForm.Exports.Control,j=OfficeForm.Exports.Models,k=OfficeForm.Exports.Utilities,l=function(a){function b(b){var c=a.call(this,b)||this;return c.onSelectChange=c.onSelectChange.bind(c),c.onKeydown=c.onKeydown.bind(c),c}return d(b,a),b.prototype.render=function(){var a,b=this.props.Question,c=this.props.Selected,d=this.props.Index,g="form-intelligence-question-row",h="forms-icon-size18x18";if(c)g=k.Html.combineAttributes(g,"office-form-intelligence-theme-li"),h="office-form-theme-secondary-color",a="CheckMark";else{switch(b.Type){case j.QuestionType.Choice:a="RadioBtnOn",h="forms-icon-size16x16";break;case j.QuestionType.TextField:a="TextField",h="forms-icon-size20x20";break;case j.QuestionType.Rating:a="Like";break;case j.QuestionType.DateTime:a="Calendar";break;case j.QuestionType.Ranking:a="Sort";break;case j.QuestionType.MatrixChoiceGroup:a="ViewList";break;case j.QuestionType.NPS:a="AutoRacing",h="forms-icon-size20x20";break;default:a="Add"}h=k.Html.combineAttributes(h,"form-intelligence-icon-black")}h=k.Html.combineAttributes(h,"form-intelligence-question-row-icon");var l,m={className:g,key:"formIntelligenceRow"+d,onClick:this.onSelectChange,onKeyDown:this.onKeydown,ref:"formIntelligenceRow"+d,tabIndex:0};if(b.IsMathQuiz){var n=i.createFormulaRenderer({DisableLinebreaks:!0,Formula:b.Subtitle}),o="form-intelligence-question-row-math-formula";l=f.createElement("div",{className:"form-intelligence-question-row-math-container"},f.createElement("p",{className:"form-intelligence-question-row-math-text"},b.Title),f.createElement("div",{className:o},n))}else l=f.createElement("p",{className:"form-intelligence-question-row-text"},b.Title);var p="form-intelligence-question-row-container",q=i.createFontIconControl({HTMLAttributes:{className:h},IconName:a});return f.createElement("div",{className:p,key:"formIntelligenceRowContainer"+d},f.createElement("div",e({},m),l,q))},b.prototype.onSelectChange=function(){this.props.changeQuestionSuggestion(this.props.Index,this.props.Selected)},b.prototype.onKeydown=function(a){switch(a.stopPropagation(),a.keyCode){case g.KeyCode.Space:case g.KeyCode.Enter:this.props.changeQuestionSuggestion(this.props.Index,this.props.Selected),a.preventDefault()}},b}(h.ReactComponent);b.QuestionSuggestion=l},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(7),h=c(2),i=c(1),j=OfficeForm.Exports.Utilities,k="Intelligence.QuestionSuggestion.Index",l=function(a){function b(b){var c=a.call(this,b)||this;return c.onClickGalleryDot=c.onClickGalleryDot.bind(c),c.onKeydownGalleryDot=c.onKeydownGalleryDot.bind(c),c.logGalleryIndex=c.logGalleryIndex.bind(c),c}return d(b,a),b.prototype.render=function(){var a="question-suggestion-card-gallery-dot";a=j.Html.combineAttributes(a,"office-form-theme-border","office-form-theme-interactive-background",this.props.Selected?"active":"inactive");var b={className:a,key:"gallery-dot"+this.props.Index,onClick:this.onClickGalleryDot,onKeyDown:this.onKeydownGalleryDot,tabIndex:0};return f.createElement("div",e({},b))},b.prototype.onClickGalleryDot=function(){this.logGalleryIndex(),this.props.changeGalleryDot(this.props.Index)},b.prototype.onKeydownGalleryDot=function(a){switch(a.keyCode){case g.KeyCode.Enter:case g.KeyCode.Space:this.logGalleryIndex(),this.props.changeGalleryDot(this.props.Index)}},b.prototype.logGalleryIndex=function(){h.log({eventName:k,eventType:"engagement_event",extraData:{Index:this.props.Index}})},b}(i.ReactComponent);b.SuggestionCardGalleryDot=l},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(109),f=OfficeForm.Exports.Resources,g=function(a){function b(b){var c=a.call(this,b)||this;c.getTemplateSuggestionTimeout=500,c.onFormTitleChange=c.onFormTitleChange.bind(c),c.askSuggestion=c.askSuggestion.bind(c),c.scheduleAskSuggestion=c.scheduleAskSuggestion.bind(c);var d=c.props.Form;return d.observe(c.onFormTitleChange,[d.Schema.Title]),c}return d(b,a),b.prototype.componentWillUnmount=function(){var a=this.props.Form;a.unobserve(this.onFormTitleChange)},b.prototype.askSuggestion=function(){var a=this,b=this.props.Form,c=b.Model.Title;b.Model.Settings.IsQuizMode||!c||c.indexOf(f.LocalizedStrings.Designer_DefaultFormTitle)>=0||Forms.UX.FormDesignView.FormIntelligenceLauncher.getFormTemplateSuggestion(b.Model.Title).done(function(b){if(b&&b.MatchQuery){var c=e.getSafeTemplateSuggestion(b);a.updateSuggestion(c)}}).fail(function(b){a.setState({SelectedIndex:[],TemplateIndex:0,Templates:[]})})},b.prototype.getSuggestionType=function(){return e.SuggestionType.TemplateSuggestion},b.prototype.onFormTitleChange=function(){this.setState({SelectedIndex:[],TemplateIndex:0,Templates:[]},this.scheduleAskSuggestion)},b.prototype.scheduleAskSuggestion=function(){this.getTemplateSuggestionTimer&&window.clearTimeout(this.getTemplateSuggestionTimer),this.getTemplateSuggestionTimer=window.setTimeout(this.askSuggestion,this.getTemplateSuggestionTimeout)},b}(e.BaseSuggestionCard);b.TemplateSuggestionCard=g},function(a,b,c){"use strict";function d(){var a=new f.QosEvent("OfficeNPS.load");a.start();var b;return OfficeFormServerInfo.userInfo.IsMsa||(b=OfficeFormServerInfo.userInfo.TenantId),OfficeForm.Exports.JavaScriptLoader.loadJavaScript("OfficeBrowserFeedback").then(function(){OfficeBrowserFeedback.initOptions={appId:2229,cid:a.CorrelationId,environment:OfficeForm.Exports.EnvironmentConfig.isProduction()?0:1,intlUrl:"../scripts/vendors/officebrowserfeedback/intl/",locale:OfficeFormServerInfo.cultureInfo.Name||"en-us",primaryColour:"#008272",secondaryColour:"#004B50",sessionId:OfficeForm.Exports.Telemetry.getCurrentSessionId(),stylesUrl:"../css/vendors/officebrowserfeedback/officebrowserfeedback.css",telemetryGroup:{audienceGroup:OfficeForm.Exports.EnvironmentConfig.isProduction()?"Production":void 0,tenantId:b},userEmail:OfficeFormServerInfo.userInfo.Email};var c;return c=h.Flight.isEnabled(h.Flights.NpsForMSA)&&OfficeFormServerInfo.userInfo.IsMsa?l:k,OfficeBrowserFeedback.floodgate.initOptions={campaignDefinitions:c},i.Promise.fromJavaScriptPromise(window.OfficeBrowserFeedback.floodgate.initialize())}).done(function(){OfficeBrowserFeedback.floodgate.start();var b=$(window);b.focus(function(){OfficeBrowserFeedback.floodgate&&OfficeBrowserFeedback.floodgate.start()}),b.blur(function(){OfficeBrowserFeedback.floodgate&&OfficeBrowserFeedback.floodgate.stop()}),b.unload(function(){OfficeBrowserFeedback.floodgate&&(OfficeBrowserFeedback.floodgate.getEngine().getActivityListener().logActivityStopTime("AppUsageTime"),OfficeBrowserFeedback.floodgate.stop())}),a.end({resultType:"Success"})}).fail(function(b){a.end({extraData:{ServiceError:b},resultType:"Failure"})})}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var f=c(14),g=c(1),h=OfficeForm.Exports.Flighting,i=OfficeForm.Exports.Utilities,j=function(a){function b(b){var c=a.call(this,b)||this;return d().done(function(){var a=OfficeBrowserFeedback.floodgate.getEngine();a.getActivityListener().logActivity("AppResume"),a.getActivityListener().logActivityStartTime("AppUsageTime")}),c}return e(b,a),b.prototype.render=function(){return null},b}(g.ReactComponent);b.OfficeNPS=j;var k=[{CampaignId:"cafa0a7d-6a20-422a-a48b-ccd4cef6f8fe",EndTimeUtc:"2025-01-01T00:00:00Z",GovernedChannelType:0,NominationScheme:{CooldownPeriod:{IntervalSeconds:7776e3,Type:0},NominationPeriod:{IntervalSeconds:2592e3,Type:0},PercentageDenominator:100,PercentageNumerator:10,Type:0},Scope:{Type:0},StartTimeUtc:"2017-01-01T00:00:00Z",SurveyTemplate:{ActivationEvent:{Sequence:[{Activity:"AppUsageTime",Count:300,IsAggregate:!0,Type:0},{Activity:"AppResume",Count:1,IsAggregate:!1,Type:0}],Type:1},Type:0}}],l=[{AdditionalDataRequested:["EmailAddress"],CampaignId:"cafa0a7d-6a20-422a-a48b-ccd4cef6f8fe",EndTimeUtc:"2025-01-01T00:00:00Z",GovernedChannelType:0,NominationScheme:{CooldownPeriod:{IntervalSeconds:7776e3,Type:0},NominationPeriod:{IntervalSeconds:2592e3,Type:0},PercentageDenominator:100,PercentageNumerator:50,Type:0},Scope:{Type:0},StartTimeUtc:"2017-01-01T00:00:00Z",SurveyTemplate:{ActivationEvent:{Sequence:[{Activity:"AppUsageTime",Count:300,IsAggregate:!0,Type:0},{Activity:"AppResume",Count:1,IsAggregate:!1,Type:0}],Type:1},Type:0}}];Forms.UX.OfficeNPS=j},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(6),g=c(84),h=c(85),i=c(2),j=c(34),k=c(1),l=c(33),m=c(189),n=OfficeForm.Exports.Control,o=OfficeForm.Exports.Resources,p="PortalPage.MoveFormPane.GroupsCount",q="PortalPage.MoveFormPane.Start",r=function(a){function b(b){var c=a.call(this,b)||this;return c.focusAfterExpandIndex=-1,c.nextFocusButtonRef=e.createRef(),c.mounted=!0,c.onMoveClick=c.onMoveClick.bind(c),c.showAllGroups=c.showAllGroups.bind(c),c.onGroupSelected=c.onGroupSelected.bind(c),c.onMeSelected=c.onMeSelected.bind(c),i.log({eventName:q,eventType:"engagement_event",extraData:{FormId:b.SelectedForm.Model.Id,IsDelegateMode:b.IsDelegateMode}}),c}return d(b,a),b.prototype.componentDidMount=function(){var a=this;if(l.trapFocusInsideElement(f.findDOMNode(this)),!OfficeFormServerInfo.userInfo.IsMsa){var b=h.createGroupManager();b.ensureFieldsReady([b.Schema.groups]).done(function(){a.mounted&&(i.log({eventName:p,eventType:"engagement_event",extraData:{groupsCount:b.Groups.length}}),a.setState({AreGroupsReady:!0}))})}},b.prototype.componentWillUnmount=function(){l.stopTrapFocusInsideElement(f.findDOMNode(this)),this.mounted=!1},b.prototype.render=function(){var a=this,b=null,c=null,d=null,f=o.LocalizedStrings.MovePaneView_Label_MyGroups,i=null;if(this.state.AreGroupsReady){var k=h.createGroupManager(),l=k.Groups.length,p=this.getRenderGroupCount(l);if(l>p){var q=o.LocalizedStrings.MovePaneView_Link_MoreGroupCards;d=n.createButton({ButtonStyle:"LightBackground",children:[e.createElement("span",null,q)],HTMLAttributes:{"aria-expanded":!1,"aria-label":q,className:"flex-pane-moveform-moreaction",label:q,onClick:this.showAllGroups,title:o.LocalizedStrings.MovePaneView_Link_MoreGroupCards_Tooltip}})}p>0&&(b=k.Groups.slice(0,p).map(function(b,c){var d=a.focusAfterExpandIndex===c?a.nextFocusButtonRef:void 0;return e.createElement(m.PortalViewMovePaneGroupItem,{onGroupSelected:a.onGroupSelected,GroupMaster:b,IsSelected:a.state.SelectedGroup===b,key:b.Model.id,ref:d})})),this.focusAfterExpandIndex>-1&&(f+=", "+o.LocalizedStrings.MovePaneView_Link_MoreGroupCards_Alert,this.focusAfterExpandIndex=-1)}if(this.props.IsDelegateMode){var r=OfficeFormServerInfo.userInfo.DisplayName,s=o.LocalizedStrings.MovePaneView_Label_MyFormsWithName.format(r),t=o.LocalizedStrings.MovePaneView_Label_MyGroupsWithName.format(r),u=n.createButton({ButtonStyle:"LightBackground",children:[e.createElement(j.NameCard,{DisplayName:OfficeFormServerInfo.userInfo.DisplayName,DisplayText:s,Photo:g.createCurrentUserPhoto(),PhotoType:j.PhotoType.User})],HTMLAttributes:{className:"flex-pane-moveform-destbutton",onClick:this.onMeSelected,title:OfficeFormServerInfo.userInfo.DisplayName},ToggleActive:this.state.IsTransferToMe});c=e.createElement("div",{className:"flex-pane-moveform-me-container"},u),i=e.createElement("div",{className:"flex-pane-moveform-group-title"},t)}var v=n.createButton({ButtonStyle:"LightBackground",children:[e.createElement("span",null,o.LocalizedStrings.MovePaneView_Button_MoveAction)],HTMLAttributes:{className:"flex-pane-moveform-button",disabled:!this.isItemSelected(),onClick:this.onMoveClick}});return e.createElement("div",{className:"flex-pane-moveform-content"},e.createElement("div",{className:"flex-pane-content-container-title"},o.LocalizedStrings.MovePaneView_Label_MoveSingleForm),e.createElement("div",{className:"flex-pane-moveform-formtitle"},this.props.SelectedForm.Model.Title),e.createElement("div",{className:"flex-pane-moveform-destArea"},e.createElement("div",{className:"flex-pane-moveform-label-prompt"},o.LocalizedStrings.MovePaneView_Label_ChooseContainer),c,e.createElement("div",{className:"flex-pane-moveform-group-container"},i,e.createElement("ul",{"aria-label":f,className:"flex-pane-moveform-grouplist",role:"listbox"},b),e.createElement("div",null,d))),v)},b.prototype.getRenderGroupCount=function(a){if(this.state.ShowAllGroups)return a;if(0>=a)return 0;var b=330,c=40,d=window.innerHeight-b;if(this.props.IsDelegateMode){var e=90;d-=e}var f=Math.floor(d/c);return 1>f?1:f>a?a:f},b.prototype.isItemSelected=function(){return this.state.IsTransferToMe||!!this.state.SelectedGroup},b.prototype.showAllGroups=function(){var a=this,b=h.createGroupManager(),c=b.Groups.length;this.focusAfterExpandIndex=this.getRenderGroupCount(c),this.setState({ShowAllGroups:!0},function(){a.nextFocusButtonRef.current&&a.nextFocusButtonRef.current.focus()})},b.prototype.onGroupSelected=function(a){this.setState({SelectedGroup:a,IsTransferToMe:!1})},b.prototype.onMeSelected=function(){this.setState({SelectedGroup:null,IsTransferToMe:!0})},b.prototype.onMoveClick=function(){if(this.state.IsTransferToMe)this.props.changeFormOwnerHandler({IsGroupForm:!1,OwnerId:OfficeFormServerInfo.userInfo.UserId,OwnerTenantId:OfficeFormServerInfo.userInfo.TenantId});else if(this.state.SelectedGroup){var a=this.state.SelectedGroup;this.props.changeFormOwnerHandler({IsGroupForm:!0,OwnerId:a.Model.id,OwnerTenantId:OfficeFormServerInfo.userInfo.TenantId}).done(function(b){b&&a.isFieldReady(a.Schema.formReferences)&&a.addFormReference(b)})}},b}(k.ReactComponent);b.MovePaneView=r,Forms.Mru.createMovePaneView=function(a,b,c){return e.createElement(r,{changeFormOwnerHandler:a,SelectedForm:b,IsDelegateMode:c})}},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(34),g=c(1),h=OfficeForm.Exports.Control,i=function(a){function b(b){var c=a.call(this,b)||this;return c.buttonRef=e.createRef(),c.onClick=c.onClick.bind(c),c}return d(b,a),b.prototype.render=function(){var a=h.createButton({ButtonStyle:"LightBackground",children:[e.createElement(f.NameCard,{DisplayName:this.props.GroupMaster.Model.displayName,Photo:this.props.GroupMaster.Photo,PhotoType:f.PhotoType.Group,key:this.props.GroupMaster.Model.id})],HTMLAttributes:{className:"flex-pane-moveform-destbutton",onClick:this.onClick.bind(this),title:this.props.GroupMaster.Model.displayName},ref:this.buttonRef,ToggleActive:this.props.IsSelected});return e.createElement("li",{key:this.props.GroupMaster.Model.id,"aria-selected":this.props.IsSelected,role:"option"},a)},b.prototype.focus=function(){this.buttonRef.current&&this.buttonRef.current.focus()},b.prototype.onClick=function(){this.props.onGroupSelected(this.props.GroupMaster)},b}(g.ReactComponent);b.PortalViewMovePaneGroupItem=i},function(a,b,c){"use strict";function d(a,b,c,d,e){return g.createElement(x,{GroupManager:a,SelectedGroup:b,ShouldShowGroups:c,onGroupCardClick:d,showGroupsCallback:e,key:"group-list"})}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),f=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var g=c(0),h=c(6),i=c(3),j=c(7),k=c(86),l=c(2),m=c(34),n=c(1),o=c(33),p=c(110),q=c(111),r=OfficeForm.Exports.Control,s=OfficeForm.Exports.EnvironmentConfig,t=OfficeForm.Exports.Utilities,u=OfficeForm.Exports.Resources,v="PortalPage.GroupFormsPortal.GroupBar.Click",w="PortalPage.GroupFormsPortal.GroupsCount",x=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.state={AreGroupsReady:!1},b.groupPlaceholderRef=g.createRef(),b.mounted=!0,b.isGccEnvironment=s.isUSGovGccProd(),b.controlId=i.uniqueId("PortalViewDropdownGroupList"),b.groupDescriptionId=b.controlId+"-group-description",b}return e(b,a),b.prototype.componentWillMount=function(){var a=this,b=this.props.GroupManager;b.ensureFieldsReady([b.Schema.groups]).done(function(){a.mounted&&(l.log({eventName:w,eventType:"engagement_event",extraData:{groupsCount:b.Groups.length}}),a.setState({AreGroupsReady:!0}))})},b.prototype.render=function(){var a="portal-view group-view";return this.props.ShouldShowGroups&&(a=t.Html.combineAttributes(a,"expand")),g.createElement("div",{className:a},this.createGroupPlaceholder(),this.createGroupOptions(),this.createFormsMask())},b.prototype.componentDidUpdate=function(){this.props.ShouldShowGroups?o.trapFocusInsideElement(h.findDOMNode(this)):o.stopTrapFocusInsideElement(h.findDOMNode(this))},b.prototype.componentWillUnmount=function(){this.mounted=!1},b.prototype.createGroupPlaceholder=function(){var a,b,c=this;this.props.SelectedGroup?(b=this.props.SelectedGroup.Model.displayName,a=g.createElement(m.NameCard,{DisplayName:b,Photo:this.props.SelectedGroup.Photo,PhotoType:m.PhotoType.Group,key:this.props.SelectedGroup.Model.id})):(b=this.isGccEnvironment?u.LocalizedStrings.PortalView_ViewMyGroups_Title_Text:u.LocalizedStrings.PortalView_GroupForms_MruCard_Title_Text,a=g.createElement(m.NameCard,{DisplayName:b,Photo:$.Deferred(),PhotoType:m.PhotoType.MRU,key:"recent-group-forms"}));var d={"aria-expanded":this.props.ShouldShowGroups,"aria-haspopup":!0,"aria-label":b,className:"group-select-group",onClick:function(){l.log({eventName:v,eventType:"engagement_event"}),c.props.showGroupsCallback(!c.props.ShouldShowGroups)},onKeyDown:function(a){switch(l.log({eventName:v,eventType:"engagement_event"}),a.keyCode){case j.KeyCode.Enter:c.props.showGroupsCallback(!c.props.ShouldShowGroups);
break;case j.KeyCode.Esc:c.props.showGroupsCallback(!1)}},ref:this.groupPlaceholderRef,role:"button",tabIndex:0};return this.props.SelectedGroup&&(d["aria-describedby"]=this.groupDescriptionId),g.createElement("div",{className:"group-select-placeholder"},g.createElement("div",f({},d),a,this.createArrow()),this.createGroupInfoContent())},b.prototype.createGroupOptions=function(){if(!this.props.ShouldShowGroups)return null;var a=this.createGroupCards(),b=!this.isGccEnvironment&&this.createMruCard();return g.createElement("div",{className:"group-list-scroll-content"},g.createElement("div",{className:"group-list-view"},b,a))},b.prototype.createFormsMask=function(){var a=$(".portal-content-container");return this.props.ShouldShowGroups?(a.addClass("expand"),g.createElement("div",{className:"group-view-mask",onClick:this.props.showGroupsCallback.bind(this,!1)})):(a.removeClass("expand"),null)},b.prototype.createGroupCards=function(){var a=this;return this.state.AreGroupsReady?this.props.GroupManager.Groups.map(function(b){var c={createFormsCard:function(){a.onGroupCardClick(b),a.props.showGroupsCallback(!1)},GroupMaster:b};return g.createElement(q.PortalViewGroupCard,f({key:"group-card-"+b.Model.id},c))}):null},b.prototype.createMruCard=function(){var a=this,b={className:"fl-group-content",onClick:function(b){a.onGroupCardClick(),a.props.showGroupsCallback(!a.props.ShouldShowGroups)}},c=k.MruDocumentCollectionMaster.getInstance();if(!c.isFieldReady(c.Schema.MruDocuments))return null;var d,e=c.Model.MruDocuments.length;switch(e){case 0:d=u.LocalizedStrings.PortalView_GroupForms_FormsCount_0_Text.format(e.toString());break;case 1:d=u.LocalizedStrings.PortalView_GroupForms_FormsCount_1_Text.format(e.toString());break;default:d=u.LocalizedStrings.PortalView_GroupForms_FormsCount_Multiple_Text.format(e.toString())}var f=g.createElement(m.NameCard,{DisplayName:u.LocalizedStrings.PortalView_GroupForms_MruCard_Title_Text,Photo:$.Deferred(),PhotoType:m.PhotoType.MRU,key:"recent-group-forms"}),h=g.createElement("span",{className:"fl-formscount",key:"recent-group-forms-count"},d),i=r.createButton({ButtonStyle:"LightBackground",children:[f,h],HTMLAttributes:b});return g.createElement("div",{className:"fl-history-tile fl-tile fl-group-tile",key:"mru-card"},i)},b.prototype.createArrow=function(){return r.createFontIconControl({HTMLAttributes:{className:"select-placeholder-arrow forms-icon-size16x16"},IconName:this.props.ShouldShowGroups?"ChevronUp":"ChevronDown"})},b.prototype.createGroupInfoContent=function(){return this.props.ShouldShowGroups?null:g.createElement(p.PortalViewGroupBar,{GroupDescriptionId:this.groupDescriptionId,GroupMaster:this.props.SelectedGroup})},b.prototype.onGroupCardClick=function(a){this.groupPlaceholderRef.current&&this.groupPlaceholderRef.current.focus(),this.props.onGroupCardClick(a)},b}(n.ReactComponent);b.PortalViewDropdownGroupList=x,Forms.Mru.createDropdownGroupList=d},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(86),e=OfficeForm.Exports.DataProvider,f=function(){function a(a){this.mruDocumentCollection=a}return a.prototype.add=function(a){throw Error("No scenario to call this method currently.")},a.prototype["delete"]=function(a){throw Error("No scenario to call this method currently.")},a.prototype.query=function(a){var b,c=d.PinnedState[this.mruDocumentCollection.Model.PinnedState],f=d.MruExtension[this.mruDocumentCollection.Model.Extension],g=e.createDataProvider();return this.mruDocumentCollection.isFieldReady(this.mruDocumentCollection.Schema.Knowledge)&&(b=this.mruDocumentCollection.Model.Knowledge),g.getRecentForms(c,f,b)},a.prototype.update=function(a,b){return $.Deferred().promise()},a}();b.MruDataSource=f},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(3),f=c(4),g=c(84),h=f.Spec,i={App:h.string({SourceFieldName:"app"}),Category:h.string({SourceFieldName:"category"}),Extension:h.string({SourceFieldName:"extension"}),FormCategory:h.string({SourceFieldName:"formCategory"}),FormType:h.string({SourceFieldName:"formType"}),IsPinned:h["boolean"]({SourceFieldName:"isPinned"}),MruId:h.string({SourceFieldName:"mruId"}),NotExist:h["boolean"]({IsLocalField:!0}),OwnerId:h.string({SourceFieldName:"ownerId"}),OwnerName:h.string({SourceFieldName:"ownerName"}),OwnerTenantId:h.string({SourceFieldName:"ownerTenantId"}),OwnerType:h.reference({SourceFieldName:"ownerType"}),ServerDocId:h.string({SourceFieldName:"serverDocId"}),Timestamp:h.string({SourceFieldName:"timestamp"}),Title:h.string({SourceFieldName:"title"}),Type:h.string({SourceFieldName:"type"}),Url:h.string({SourceFieldName:"url"})},j=function(a){function b(b){var c=a.call(this,b)||this;return c.Model.NotExist=!1,c}return d(b,a),Object.defineProperty(b.prototype,"FormMaster",{get:function(){return this.formMaster||(this.formMaster=OfficeForm.Exports.Models.createGroupDesignFormMaster({Id:this.Model.ServerDocId})),this.formMaster},enumerable:!0,configurable:!0}),b.prototype.getPhoto=function(){if(!this.photoPromise)if("Group"===this.Model.OwnerType){var a=$.Deferred();a.resolve(g.createGroupPhoto(this.Model.OwnerId)),this.photoPromise=a.promise()}else this.photoPromise=g.createUserPhotoByForm(this.FormMaster);return this.photoPromise},b.prototype.matchSearchStrings=function(a){var b=(this.Model.Title+" "+(this.Model.OwnerName||"")).toLowerCase();return e.all(a,function(a){return b.indexOf(a)>=0})},b}(f.createObjectMasterClass("MruDocument",i));b.MruDocumentMaster=j},function(a,b,c){"use strict";function d(a,b,c){return f.createElement(k,{focusOut:a,GroupMaster:b,designExistingForm:c,key:b.Model.id})}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(64),h=c(1),i=c(87),j=c(112),k=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return e(b,a),b.prototype.componentWillMount=function(){var a=this,b=this.props.GroupMaster;this.onModelChange=function(){return a.forceUpdate()},b&&b.observeGroupFormsChange(this.onModelChange)},b.prototype.componentWillUnmount=function(){var a=this.props.GroupMaster;a.unobserveGroupFormsChange(this.onModelChange)},b.prototype.render=function(){return f.createElement("div",{className:"group-forms-view"},this.createNewCard(),this.createFormsCard())},b.prototype.createNewCard=function(){var a=f.createElement(i.PortalViewCreateNewCard,{CreateNew:!0,focusOut:this.props.focusOut,IsGroupForm:!0,IsQuizMode:!1,onClick:this.onCreateNewClick.bind(this,!1)}),b=f.createElement(i.PortalViewCreateNewCard,{CreateNew:!0,focusOut:this.props.focusOut,IsGroupForm:!0,IsQuizMode:!0,onClick:this.onCreateNewClick.bind(this,!0)}),c=f.createElement("div",{className:"creating-card-middle-line"});return f.createElement("div",{className:"portal-creating-card"},a,c,b)},b.prototype.createFormsCard=function(){var a=this,b=this.props.GroupMaster,c=this.props.GroupMaster.FormMasterExpectSoftDeleted;return c.sort(function(a,b){return Date.parse(b.Model.Modified)-Date.parse(a.Model.Modified)}).map(function(c){return f.createElement(j.PortalViewGroupFormCard,{focusOut:a.props.focusOut,FormMaster:c,GroupMaster:b,onClick:a.props.designExistingForm,key:c.getInstanceId()})})},b.prototype.onCreateNewClick=function(a){var b=g.createForm(a,this.props.GroupMaster);this.props.designExistingForm(b)},b}(h.ReactComponent);b.PortalViewGroupFormsView=k,Forms.Mru.createGroupFormsView=d},function(a,b,c){"use strict";function d(a,b,c,d){var e=a.Documents;return d&&(e=e.filter(function(a){return a.matchSearchStrings(d)})),e.map(function(a){return f.createElement(s,{Actions:b,focusOut:c,MruDocumentMaster:a,key:a.Model.ServerDocId})})}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(6),h=c(86),i=c(2),j=c(34),k=c(69),l=c(53),m=OfficeForm.Exports.Control,n=OfficeForm.Exports.Models.FormMaster,o=OfficeForm.Exports.Resources,p=OfficeForm.Exports.Utilities,q="PortalPage.GroupFormsPortal.MruGroupFormLoad",r="PortalPage.GroupFormsPortal.MruGroupFormRemove",s=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.state={DuplicateRemoveDialogPrompted:!1,FocusOnTriggerButton:!1,IsOwnerNameReady:!0,IsResponseCountReady:!1,IsThemeReady:!1,IsTitleReady:!0,ShowCardOwnerName:!0,ShowCardResponseCount:!0,ShowCardSpinner:!1,ShowCardTheme:!0,ShowCardTitle:!0},b.triggerButtonRef=f.createRef(),b}return e(b,a),b.prototype.componentWillMount=function(){var a=this,b=this.props,c=b.MruDocumentMaster,d=c.FormMaster;if(d){this.callback=function(){return a.forceUpdate()};var e=n.Schema;d.observe(this.callback,[e.Title,e.ResponsesCount,e.Theme]),c.Model.NotExist?this.setState({IsResponseCountReady:!0,IsThemeReady:!0}):d.ensureReadyForMruCard().then(function(){a.setState({IsResponseCountReady:!0,IsThemeReady:!0})},function(b){var d={IsResponseCountReady:!0,IsThemeReady:!0},e=674;b&&b.innerCode===e&&(c.Model.NotExist=!0),a.setState(d)})}},b.prototype.componentWillUnmount=function(){var a=this.props.MruDocumentMaster.FormMaster;a&&(a.unobserve(this.callback),a.Synchronizer.unobserve(this.callback))},b.prototype.onClick=function(){var a=this.props.MruDocumentMaster.FormMaster;if(a&&this.logEngagementEvent(q),this.props.Actions.openForm){var b=this.props.MruDocumentMaster.Model;b.NotExist||(b.Timestamp=(new Date).toISOString()),this.props.Actions.openForm(a)}},b.prototype.getCardDescription=function(){if(this.state.ShowCardOwnerName&&this.state.IsOwnerNameReady){var b=this.props.MruDocumentMaster.Model.OwnerName;return o.LocalizedStrings.PortalView_FormCard_Mru.format(b,this.getCardResponseCount())}return a.prototype.getCardDescription.call(this)},b.prototype.getCardThemeName=function(){var a=this.props.MruDocumentMaster.FormMaster;return a.isFieldReady(a.Schema.Theme)?a.ThemeMaster.Model.Name:null},b.prototype.getCardThemeBackgroupUrl=function(){var a=this.props.MruDocumentMaster.FormMaster;return a.isFieldReady(a.Schema.Theme)?a.ThemeMaster.Model.BackgroundImage:null},b.prototype.getCardThemePrimaryColor=function(){var a=this.props.MruDocumentMaster.FormMaster;return a.isFieldReady(a.Schema.Theme)?a.ThemeMaster.Model.PrimaryColor:null},b.prototype.getCardTitle=function(){var a=this.props;return a.MruDocumentMaster.Model.Title},b.prototype.getCardResponseCount=function(){var a=this.props.MruDocumentMaster.FormMaster;return a.isFieldReady(a.Schema.ResponsesCount)?a.Model.ResponsesCount:0},b.prototype.createCardOwnerContent=function(){if(!this.state.ShowCardOwnerName)return null;if(!this.state.IsOwnerNameReady)return null;var a=this.props.MruDocumentMaster;return f.createElement(j.NameCard,{DisplayName:a.Model.OwnerName,Photo:a.getPhoto(),PhotoType:j.PhotoType.Group,key:"face-pile"})},b.prototype.createCardTypeContent=function(){return k.createFormCardType(this.props.MruDocumentMaster.FormMaster)},b.prototype.shouldShowSpinner=function(){return this.state.ShowCardSpinner},b.prototype.createOtherContent=function(){return!this.state.ShowCardSpinner&&this.state.IsThemeReady&&this.state.IsResponseCountReady?[this.createDialogTriggerButton(),this.createDuplicateRemoveDialog()]:null},b.prototype.createDialogTriggerButton=function(){var a=this,b=this.state,c={"aria-disabled":this.state.ContentCovered,className:"fl-menu-button",onClick:function(){return a.setState({DuplicateRemoveDialogPrompted:!0,ContentCovered:!0})}};return(b.DuplicateRemoveDialogPrompted||b.DeleteConfirmDialogPrompted)&&(c.className=p.Html.combineAttributes(c.className,"dn")),m.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:c,Icon:"More",IconClassName:"forms-icon-size20x20",key:"triggerButton",ref:this.triggerButtonRef,Text:o.LocalizedStrings.PortalView_Menu_Text})},b.prototype.createDuplicateRemoveDialog=function(){var a=this,b=this.props,c=this.state;return c.DuplicateRemoveDialogPrompted?m.createSimpleDialog({ButtonsProps:[{ButtonStyle:"DarkBackGround",GlyphButtonStyle:"Vertical",IconClass:"Blocked12",Key:"removeItem",onClick:function(c){a.logEngagementEvent(r),b.Actions.removeFromMRU&&(a.props.focusOut(g.findDOMNode(a)),b.Actions.removeFromMRU(b.MruDocumentMaster.FormMaster),a.setState({ShowCardSpinner:!0}))},Text:o.LocalizedStrings.PortalView_Remove_Button,TextClassName:"fl-menu-text",Title:o.LocalizedStrings.PortalView_Remove_Text}],ClassName:"portal-view-form-card-copy-remove-container",key:"duplicateRemoveDialog",onBlur:function(){return a.setState({DuplicateRemoveDialogPrompted:!1,ContentCovered:!1})},onDismiss:function(){return a.setFocusOnDialogTriggerButton()},ShowDialog:c.DuplicateRemoveDialogPrompted,TrapFocus:!0}):void 0},b.prototype.setFocusOnDialogTriggerButton=function(){if(this.triggerButtonRef.current){var a=g.findDOMNode(this.triggerButtonRef.current);a&&(a.classList.remove("dn"),a.focus())}},b.prototype.logEngagementEvent=function(a){var b,c=this.props.MruDocumentMaster.FormMaster;c.isFieldReady(n.Schema.Id)&&(b=c.Model.Id),i.log({eventName:a,eventType:"engagement_event",extraData:{FormId:b,FormOwnerType:"MruForm",IsGroupForms:this.props.MruDocumentMaster.Model.Extension===h.MruExtension[h.MruExtension.GroupForm]}})},b}(l.PortalViewCardBase);b.PortalViewMruCard=s,Forms.Mru.createMruPortalCards=d},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(1),g=OfficeForm.Exports.Models.FormMaster,h=OfficeForm.Exports.Resources,i=OfficeForm.Exports.Utilities,j=function(a){function b(b){var c=a.call(this,b)||this;return c.update=c.update.bind(c),c.props.Form.observe(c.update,[g.Schema.DescriptiveElements]),c}return d(b,a),b.prototype.componentWillUnmount=function(){this.props.Form.unobserve(this.update)},b.prototype.render=function(){var a=this.props.Form,b=a.isFieldReady(g.Schema.DescriptiveElements)&&a.FormElementManager.DescriptiveElementMasters.length>0,c=i.Html.combineAttributes("designer-more-options-menu-button",b?"disabled":"");return e.createElement("button",{className:c,disabled:b},h.LocalizedStrings.Branch_ShowBranchDesignView)},b.prototype.update=function(){this.forceUpdate()},b}(f.ReactComponent);b.HeadBarBranchMenuItem=j,Forms.UX.HeadBarBranchMenuItem=j},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(6),g=c(90),h=c(2),i=c(69),j=c(53),k=OfficeForm.Exports.CategoryExtensionPoints,l=OfficeForm.Exports.Control,m=OfficeForm.Exports.ExtensionPoints,n=OfficeForm.Exports.Flighting,o=OfficeForm.Exports.Models,p=OfficeForm.Exports.EngagementEventNames,q=OfficeForm.Exports.EnvironmentSettings,r=OfficeForm.Exports.Resources,s=OfficeForm.Exports.Utilities,t=function(a){function b(b){var c=a.call(this,b)||this;return c.triggerButtonRef=e.createRef(),c.isDelegateMode=!1,c.state={DeleteConfirmDialogPrompted:!1,DuplicateRemoveDialogPrompted:!1,IsResponseCountReady:!1,IsThemeReady:!1,IsTitleReady:!0,ShowCardResponseCount:!0,ShowCardTheme:!0,ShowCardTitle:!0},c.mounted=!0,c.isDelegateMode=q.isDelegateMode(),c}return d(b,a),b.prototype.componentWillMount=function(){var a=this,b=this.props.FormMaster;if(b){this.onModelChange=function(){return a.forceUpdate()};var c=o.FormMaster.Schema;b.observe(this.onModelChange,[c.ResponsesCount,c.SavingState,c.Title,c.Theme]);var d=b.Synchronizer.Schema;b.Synchronizer.observe(this.onModelChange,[d.CreationFailed,d.CreationInProcess,d.CreationScheduled]),b.ensureFieldsReady([c.ResponsesCount,c.Theme]).done(function(){a.mounted&&a.setState({IsResponseCountReady:!0,IsThemeReady:!0})})}},b.prototype.componentWillUnmount=function(){this.props.FormMaster&&(this.props.FormMaster.unobserve(this.onModelChange),this.props.FormMaster.Synchronizer.unobserve(this.onModelChange)),this.mounted=!1},b.prototype.componentDidUpdate=function(){n.Flight.isEnabled(n.Flights.UpgradeUxStateModel)?g.hideFormErrorMessageBar(this.props.FormMaster):OfficeForm.Exports.hideFormErrorMessageBar(this.props.FormMaster)},b.prototype.createFooterContent=function(){if(!this.state.ShowCardResponseCount)return null;var b=this.props.FormMaster.Model;if(this.isFormOwnedByMe())return a.prototype.createFooterContent.call(this);var c=b.SharedFormOwnerName,d=Forms.UX.createFacePile({displayText:c?Forms.UX.getDisplayText(c.split(" ")[0],c.split(" ")[1]):"",name:c,tooltip:c?c:b.OwnerId});return e.createElement("div",{className:"fl-owner-container",key:"owner"},e.createElement("div",{className:"fl-facepile"},d))},b.prototype.isFormOwnedByMe=function(){return this.props.FormMaster.Model.OwnerId===OfficeFormServerInfo.userInfo.UserId||this.isDelegateMode},b.prototype.onClick=function(){this.props.FormMaster&&h.log({eventName:p.PortalPage.MyForms.Load,eventType:"engagement_event"}),this.props.onClick(this.props.FormMaster)},b.prototype.getCardDescription=function(){if(this.isFormOwnedByMe())return a.prototype.getCardDescription.call(this);var b=this.props.FormMaster.Model;return r.LocalizedStrings.PortalView_FormCard_Shared.format(b.SharedFormOwnerName)},b.prototype.getCardThemeName=function(){var a=this.props.FormMaster;return a.isFieldReady(a.Schema.Theme)?a.ThemeMaster.Model.Name:null},b.prototype.getCardThemeBackgroupUrl=function(){var a=this.props.FormMaster;return a.isFieldReady(a.Schema.Theme)?a.ThemeMaster.Model.BackgroundImage:null},b.prototype.getCardThemePrimaryColor=function(){var a=this.props.FormMaster;return a.isFieldReady(a.Schema.Theme)?a.ThemeMaster.Model.PrimaryColor:null},b.prototype.getCardTitle=function(){return this.props.FormMaster.Model.Title},b.prototype.getCardResponseCount=function(){var a=this.props.FormMaster;return a.isFieldReady(o.FormMaster.Schema.ResponsesCount)&&a.Model.ResponsesCount?a.Model.ResponsesCount:0},b.prototype.createCardOwnerContent=function(){if(this.isFormOwnedByMe())switch(this.props.FormMaster.Model.Category){case"Poll":return e.createElement("div",{className:"fl-category-label fl-category-poll",key:"category-label",title:r.LocalizedStrings.OutlookAddin_FormCard_CategoryLabel});case"Teams Poll":return e.createElement("div",{className:"fl-category-label fl-category-poll",key:"category-label",title:r.LocalizedStrings.Teams_FormCard_CategoryLabel});case"assignments":return e.createElement("div",{className:"fl-category-label fl-category-assignments",key:"category-label",title:r.LocalizedStrings.Teams_Assignments_FormCard_CategoryLabel});default:return null}return null},b.prototype.createCardTypeContent=function(){return i.createFormCardType(this.props.FormMaster)},b.prototype.createOtherContent=function(){var a=this.props.FormMaster;return this.state.IsThemeReady&&this.state.IsResponseCountReady&&(!a.Deleted||a.Model.SavingState!==o.SavingStateValues.Idle)&&!a.Synchronizer.Model.CreationFailed||this.isDelegateMode?[this.createDialogTriggerButton(),this.createDuplicationRemoveDialog(),this.createDeleteConfirmDialog()]:null},b.prototype.shouldShowSpinner=function(){var a=this.props.FormMaster;if(!a)return!1;if(a.Model.TransferInProgress||a.Model.DeleteCollaborationPermission)return!0;var b=!1;return a.isFieldReady(a.Schema.SoftDeleted)&&(b=!!a.Model.SoftDeleted),a.Deleted||b||a.Synchronizer.Model.CreationInProcess||a.Synchronizer.Model.CreationScheduled},b.prototype.getStatusMessage=function(){var a=this.props.FormMaster;return a&&a.Model.TransferInProgress?r.LocalizedStrings.PortalView_FormCard_MoveInProgress:null},b.prototype.createDialogTriggerButton=function(){var a=this;if(!this.shouldShowSpinner()){var b={"aria-disabled":this.state.ContentCovered,className:"fl-menu-button",onClick:function(){return a.setState({DuplicateRemoveDialogPrompted:!0,ContentCovered:!0})},title:r.LocalizedStrings.PortalView_Menu_Tooltip};return(this.state.DuplicateRemoveDialogPrompted||this.state.DeleteConfirmDialogPrompted)&&(b.className=s.Html.combineAttributes(b.className,"dn")),l.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:b,Icon:"More",IconClassName:"forms-icon-size20x20",key:"triggerButton",ref:this.triggerButtonRef,Text:r.LocalizedStrings.PortalView_Menu_Text})}},b.prototype.createDuplicationRemoveDialog=function(){var a=this,b=this.props.FormMaster,c=!this.isFormOwnedByMe();if(this.state.DuplicateRemoveDialogPrompted&&!this.shouldShowSpinner()){var d=[],e={ButtonStyle:"DarkBackGround",GlyphButtonStyle:"Vertical",IconClass:c?"Unpin":"Delete",IconClassName:c?"unpinIconClass":"",Key:"removeItem",onClick:function(){c?(h.log({eventName:p.PortalPage.OtherForms.Unpin,eventType:"engagement_event"}),a.props.onDeleteClick(b),a.setState({DuplicateRemoveDialogPrompted:!1,ContentCovered:!1})):(h.log({eventName:p.PortalPage.MyForms.MoveToRecycleBin,eventType:"engagement_event"}),a.setState({DeleteConfirmDialogPrompted:!0,DuplicateRemoveDialogPrompted:!1}))},Text:c?r.LocalizedStrings.PortalView_Unpin_Button:r.LocalizedStrings.PortalView_Delete_Button,TextClassName:"fl-menu-text",Title:c?r.LocalizedStrings.PortalView_Unpin_Text:r.LocalizedStrings.PortalView_Delete_Text};k.supportsExtensionPoint(b,m.DisableEditForm)?d.push(e):(this.isDelegateMode||(d.push({ButtonStyle:"DarkBackGround",GlyphButtonStyle:"Vertical",IconClass:"Copy",Key:"duplicateItem",onClick:function(){a.setFocusOnDialogTriggerButton(),a.props.onDuplicateClick(b,{IsGroupForm:!1,OwnerId:b.Model.OwnerId,OwnerTenantId:b.Model.OwnerTenantId}),a.setState({DuplicateRemoveDialogPrompted:!1,ContentCovered:!1}),c?h.log({eventName:p.PortalPage.OtherForms.Duplicate,eventType:"engagement_event"}):h.log({eventName:p.PortalPage.MyForms.Duplicate,eventType:"engagement_event"})},Text:r.LocalizedStrings.PortalView_Duplicate_Button,TextClassName:"fl-menu-text",Title:r.LocalizedStrings.PortalView_Duplicate_Text}),d.push(e)),!n.Flight.isEnabled(n.Flights.EnableTransferForm)||this.props.FormMaster.IsAssignmentForm||OfficeFormServerInfo.userInfo.IsMsa||c||d.push({ButtonStyle:"DarkBackGround",GlyphButtonStyle:"Vertical",IconClass:"FabricMovetoFolder",Key:"transferItem",onClick:function(b){a.props.onMoveClicked&&(a.setFocusOnDialogTriggerButton(),a.props.onMoveClicked(a.props.FormMaster))},Text:r.LocalizedStrings.PortalView_Move_Button,TextClassName:"fl-menu-text",Title:r.LocalizedStrings.PortalView_Move_Text}));var f={ButtonsProps:d,ClassName:"portal-view-form-card-copy-remove-container",key:"duplicateRemoveDialog",onBlur:function(){return a.setState({DuplicateRemoveDialogPrompted:!1,ContentCovered:!1})},onDismiss:function(){return a.setFocusOnDialogTriggerButton()},ShowDialog:this.state.DuplicateRemoveDialogPrompted,TrapFocus:!0};return l.createSimpleDialog(f)}},b.prototype.createDeleteConfirmDialog=function(){var a=this,b=!this.isFormOwnedByMe();if(this.state.DeleteConfirmDialogPrompted){var c=b?r.LocalizedStrings.PortalView_ConfirmUnpin_Button:r.LocalizedStrings.PortalView_Continue_Text,d=b?r.LocalizedStrings.PortalView_ConfirmUnpin_Button:r.LocalizedStrings.PortalView_Continue_Button,e={ButtonStyle:"DarkBackGround",ClassName:"fl-menu-confirm-delete",GlyphButtonStyle:"Horizontal",Key:"deleteItem",onClick:function(){a.props.focusOut(f.findDOMNode(a)),h.log({eventName:p.PortalPage.MyForms.ConfirmMoveToRecycleBin,eventType:"engagement_event"}),b?a.props.onDeleteClick(a.props.FormMaster):a.props.onSoftDeleteClick(a.props.FormMaster),a.setState({DeleteConfirmDialogPrompted:!1,ContentCovered:!1})},Text:d,Title:c},g={ButtonStyle:"DarkBackGround",ClassName:"fl-menu-confirm-delete",GlyphButtonStyle:"Horizontal",Key:"cancelItem",onClick:function(){h.log({eventName:p.PortalPage.MyForms.CancelMoveToRecycleBin,eventType:"engagement_event"}),a.setFocusOnDialogTriggerButton(),a.setState({ContentCovered:!1})},Text:r.LocalizedStrings.PortalView_Cancel_Button,Title:r.LocalizedStrings.PortalView_Cancel_Text},i=[e,g],j={ButtonsProps:i,ClassName:"portal-view-form-card-delete-cancel-container",Description:r.LocalizedStrings.PortalView_MoveGroupFormToRecycle_Warning_Text,key:"deleteConfirmDialog",onBlur:function(){return a.setState({DeleteConfirmDialogPrompted:!1,ContentCovered:!1})},onDismiss:function(){return a.setFocusOnDialogTriggerButton()},ShowDialog:this.state.DeleteConfirmDialogPrompted,TrapFocus:!0};return l.createSimpleDialog(j)}},b.prototype.setFocusOnDialogTriggerButton=function(){if(this.triggerButtonRef.current){var a=f.findDOMNode(this.triggerButtonRef.current);a&&(a.classList.remove("dn"),a.focus())}},b}(j.PortalViewCardBase);Forms.UX.PortalViewMyFormCard=t},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(3),h=c(98),i=c(2),j=c(1),k=OfficeForm.Exports.Control,l=OfficeForm.Exports.Resources,m=c(7),n=function(a){function b(b){var c=a.call(this,b)||this;return c.elementId=g.uniqueId("SampleCard."),c.descriptionId=c.elementId+".description",c.sampleFormMaster=h.getSampleFormMaster(),c.onCardClick=c.onCardClick.bind(c),c.onCloseButtonClick=c.onCloseButtonClick.bind(c),c}return d(b,a),b.prototype.render=function(){var a=this,c=Forms.Models.UserSettingsMaster.getInstance().Model.SampleFormStates;if(c&&"Closed"===c[this.props.sampleFormId])return null;var d=k.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{className:"sample-form-card-close-button",onClick:this.onCloseButtonClick},Icon:"Cancel",IconClassName:"forms-icon-size14x14",Text:l.LocalizedStrings.SampleFormCard_Button_Close}),g={"aria-describedby":this.descriptionId,"aria-label":this.sampleFormMaster.Model.Title,className:"sample-form-card",onClick:this.onCardClick,onKeyDown:function(b){switch(b.keyCode){case m.KeyCode.Enter:case m.KeyCode.Space:a.onCardClick()}},role:"button",tabIndex:0};return f.createElement("div",{className:"fl-history-tile fl-tile"},b.cardTag(),f.createElement("div",e({},g),this.titleContainer()),d,this.cardDescription())},b.prototype.onCardClick=function(){this.sampleFormMaster&&i.log({eventName:"PortalView.SampleForm.Click",eventType:"engagement_event"}),this.props.viewSampleForm(this.sampleFormMaster)},b.prototype.onCloseButtonClick=function(a){i.log({eventName:"PortalView.SampleForm.Close",eventType:"engagement_event"}),a.stopPropagation(),this.props.hideSampleForm(this.props.sampleFormId)},b.prototype.titleContainer=function(){return f.createElement("div",{className:"title-container"},this.sampleFormMaster.Model.Title)},b.prototype.cardDescription=function(){return f.createElement("span",{className:"screenReaderReference",id:this.descriptionId},l.LocalizedStrings.SampleFormCard_Description)},b.cardTag=function(){var a=l.LocalizedStrings.SampleFormCard_Tag_Text;return f.createElement("div",{className:"sample-form-card-tag-container"},f.createElement("div",{className:"tag-text"},a),f.createElement("div",{className:"small-triangle-left"}),f.createElement("div",{className:"triangle-left"}),f.createElement("div",{className:"rectangle"}),f.createElement("div",{className:"triangle-right"}),f.createElement("div",{className:"small-triangle-right"}))},b}(j.ReactComponent);b.PortalViewMySampleFormCard=n,Forms.UX.PortalViewMySampleFormCard=n},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(53),f=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.getCardThemeName=function(){return null},b.prototype.getCardThemeBackgroupUrl=function(){return null},b.prototype.getCardThemePrimaryColor=function(){return null},b.prototype.getCardTitle=function(){return""},b.prototype.createCardOwnerContent=function(){return null},b.prototype.createCardTypeContent=function(){return null},b.prototype.getCardResponseCount=function(){return 0},b}(e.PortalViewCardBase);b.PortalViewPlaceHolderCard=f,Forms.UX.PortalViewPlaceHolderCard=f},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(12),h=c(1),i=OfficeForm.Exports.Resources,j=OfficeForm.Exports.Utilities,k=function(a){function b(b){var c=a.call(this,b)||this;return c.state={PrivacyUrl:"https://go.microsoft.com/fwlink/?LinkId=521839"},c}return d(b,a),b.prototype.componentDidMount=function(){var a=this;g.getPageContext().getPrivacyUrl().done(function(b){return a.setState({PrivacyUrl:b||""})})},b.prototype.render=function(){var a=this.state.PrivacyUrl,b={className:"portal-footer-link",onClick:function(){return j.Html.safeOpen(a)}},c=OfficeFormServerInfo.userInfo.IsMsa?"https://go.microsoft.com/fwlink/?linkid=866263":"https://portal.office.com/account/#subscriptions",d={className:"portal-footer-link",onClick:function(){return j.Html.safeOpen(c)}},g={className:"portal-footer-link",onClick:function(){return j.Html.safeOpen("/Third_Party_Notices.txt")}},h={className:"portal-footer-link"};return f.createElement("div",{className:"portal-footer",role:"contentinfo"},f.createElement("div",null,f.createElement("button",e({},g),i.LocalizedStrings.Legal_Third_Party),f.createElement("button",e({},d),i.LocalizedStrings.Legal_TermsOfService),f.createElement("button",e({},b),i.LocalizedStrings.Form_Footer_PrivacyStatement),f.createElement("div",e({},h),i.LocalizedStrings.Legal_Copyright.format(OfficeFormServerInfo.copyRightYear))))},b}(h.ReactComponent);b.PortalFooter=k,Forms.UX.PortalFooter=k},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){
a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(88),g=c(89),h=c(1),i=OfficeForm.Exports.Control,j=OfficeForm.Exports.EnvironmentConfig,k=OfficeForm.Exports.Flighting,l=OfficeForm.Exports.Resources,m=OfficeForm.Exports.Utilities,n=function(a){function b(b){var c=a.call(this,b)||this;return c.createNewDropdownButton=c.createNewDropdownButton.bind(c),c.createForm=c.createForm.bind(c),c.createQuiz=c.createQuiz.bind(c),c.state={MoreCreateOptionsExpanded:!1},c}return d(b,a),b.prototype.render=function(){if(!k.Flight.isEnabled(k.Flights.MSATemplate)||!OfficeFormServerInfo.userInfo.IsMsa&&j.isOsi())return null;var a={createCallback:this.props.createFormCallback};return this.props.templateGalleryStateLoaded?e.createElement("div",{className:"templateGallery-container"},e.createElement("p",null,l.LocalizedStrings.MSATemplate_New_Text),e.createElement("button",{className:"View-more-template fl-content glyph-button-control-vertical",onClick:this.props.hideTemplateGallery,title:l.LocalizedStrings.MSATemplate_HideTemplate_Button},l.LocalizedStrings.MSATemplate_HideTemplate_Button),f.createNewButton(a),e.createElement(g.TemplateList,{viewTemplateHandler:this.props.viewTemplateHandler}),e.createElement("button",{className:"View-more-template fl-content glyph-button-control-vertical",onClick:this.props.internalCreateTemplateGalleryView,title:l.LocalizedStrings.MSATemplate_MoreTemplate_Button},l.LocalizedStrings.MSATemplate_MoreTemplate_Button)):e.createElement("div",{className:"templateGallery-container"},e.createElement("button",{className:"new-form-button",onClick:this.createForm,title:l.LocalizedStrings.PortalView_NewFormTitle},l.LocalizedStrings.PortalView_NewFormTitle),this.createNewDropdownButton(),e.createElement("button",{className:"View-more-template",onClick:this.props.showTemplateGallery,title:l.LocalizedStrings.MSATemplate_ShowTemplate_Button},l.LocalizedStrings.MSATemplate_ShowTemplate_Button))},b.prototype.createForm=function(){this.props.createFormCallback("Form")},b.prototype.createQuiz=function(){this.props.createFormCallback("Quiz")},b.prototype.createNewDropdownButton=function(){var a=this,b=[];b.push({Active:!0,MenuItem:i.createGlyphButton({ButtonStyle:"DarkBackGround",HTMLAttributes:{className:"new-dropdown-option"},key:"newQuiz",Text:l.LocalizedStrings.PortalView_NewQuizTitle,TextClassName:"new-dropdown-text"}),OnExecute:this.createQuiz}),b.push({Active:!0,MenuItem:i.createGlyphButton({ButtonStyle:"DarkBackGround",HTMLAttributes:{className:"new-dropdown-option"},key:"newFromTemplate",Text:l.LocalizedStrings.MSATemplate_MoreTemplate_Button,TextClassName:"new-dropdown-text"}),OnExecute:this.props.internalCreateTemplateGalleryView});var c={ButtonStyle:"DarkBackGround",ChildrenContent:i.createFontIconControl({HTMLAttributes:{className:"forms-icon-size20x20",title:l.LocalizedStrings.QuestionCategory_More},IconName:"More"}),ClassName:"new-more-button",Description:l.LocalizedStrings.QuestionCategory_More,Tooltip:l.LocalizedStrings.QuestionCard_Menu_Tooltip},d={ClassName:"new-more-menu",ClassNameForContainer:"new-more-container office-form-theme-button",CustomizedMenuItems:b,MenuTriggerButton:c,onMenuCollapse:function(){a.setState({MoreCreateOptionsExpanded:!1})},onMenuExpand:function(){a.setState({MoreCreateOptionsExpanded:!0})},ShowBox:!0};return this.state.MoreCreateOptionsExpanded&&(d.ClassNameForContainer=m.Html.combineAttributes(d.ClassNameForContainer,"active")),i.createMenuControl(d)},b}(h.ReactComponent);b.PortalViewMSATemplate=n,Forms.UX.PortalViewMSATemplate=n},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(1),g=OfficeForm.Exports.Control,h=OfficeForm.Exports.Resources,i=function(a){function b(b){var c=a.call(this,b)||this;return c.mounted=!0,c.buttonRef=e.createRef(),c.state={AnimationLoaded:!1,RightPosition:0,ShowAnimation:!1,ShowEmptyImage:!1},c.getAnimationImageTime=(new Date).getTime(),c.onAnimationLoaded=c.onAnimationLoaded.bind(c),c.onImageClick=c.onImageClick.bind(c),c.updatePosition=c.updatePosition.bind(c),c}return d(b,a),b.prototype.componentDidMount=function(){this.updatePosition()},b.prototype.componentDidUpdate=function(a){var b=this;if(this.props.RecycleBinFormCount!==a.RecycleBinFormCount&&this.props.GroupMaster===a.GroupMaster){this.setState({AnimationLoaded:!1,ShowAnimation:!0,ShowEmptyImage:0===a.RecycleBinFormCount});var c=1e3;setTimeout(function(){b.mounted&&b.setState({AnimationLoaded:!1,ShowAnimation:!1})},c),this.getAnimationImageTime=(new Date).getTime()}this.updatePosition(),window.addEventListener("resize",this.updatePosition)},b.prototype.componentWillUnmount=function(){this.mounted=!1,window.removeEventListener("resize",this.updatePosition)},b.prototype.render=function(){if(0===this.props.RecycleBinFormCount)return null;var a=g.createButton({ButtonStyle:"LightBackground",HTMLAttributes:{"aria-label":h.LocalizedStrings.RecycleBin_EnterButtonText,className:"fl-content glyph-button-control-vertical",id:"fl-content-recycleBin",onClick:this.props.onClick,title:h.LocalizedStrings.RecycleBin_EnterButtonText},ref:this.buttonRef}),b=this.state.ShowEmptyImage?"../Images/emptyRecycleBinAnimation.gif?time="+this.getAnimationImageTime:"../Images/recycleBinAnimation.gif?time="+this.getAnimationImageTime;return e.createElement("div",{className:"recycle-bin-button",style:{right:this.state.RightPosition+"px"}},a,e.createElement("img",{alt:h.LocalizedStrings.RecycleBin_EnterButtonText,className:"recycle-bin-button-animation-img",key:"recycleBinAnimation",onClick:this.onImageClick,onLoad:this.onAnimationLoaded,src:b,hidden:!this.state.ShowAnimation}),e.createElement("img",{alt:h.LocalizedStrings.RecycleBin_EnterButtonText,className:"recycle-bin-button-img",key:"recycleBinImage",onClick:this.onImageClick,src:"../Images/fullRecycleBin_icon.png",hidden:this.state.ShowAnimation&&this.state.AnimationLoaded}))},b.prototype.focus=function(){this.buttonRef.current&&this.buttonRef.current.focus()},b.prototype.onImageClick=function(a){a.stopPropagation(),this.props.onClick()},b.prototype.onAnimationLoaded=function(){this.setState({AnimationLoaded:!0})},b.prototype.updatePosition=function(){var a=document.getElementById("portalContentContainer");if(a){var b=a.offsetWidth-a.clientWidth;this.state.RightPosition!==b&&this.setState({RightPosition:b})}},b}(f.ReactComponent);Forms.UX.RecycleBin.RecycleBinEntranceButton=i},function(a,b,c){"use strict";function d(a,b){return f.createElement(k,{focusOut:a,GroupMaster:b,key:b.Model.id})}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(34),h=c(1),i=c(203),j=c(115),k=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return e(b,a),b.prototype.componentWillMount=function(){var a=this,b=this.props.GroupMaster;this.onModelChange=function(){return a.forceUpdate()},b.observeGroupFormsChange(this.onModelChange)},b.prototype.render=function(){return f.createElement("div",null,this.createGroupNameCard(),this.createGroupFormsCard(),this.createPlaceholderForEmptyRecyclebin())},b.prototype.componentWillUnmount=function(){var a=this.props.GroupMaster;a.unobserveGroupFormsChange(this.onModelChange)},b.prototype.createGroupNameCard=function(){var a=this.props.GroupMaster;return f.createElement("div",{className:"recyclebin-select-group-placeholder"},f.createElement(g.NameCard,{DisplayName:a.Model.displayName,Photo:a.Photo,PhotoType:g.PhotoType.Group,key:a.Model.id}))},b.prototype.createGroupFormsCard=function(){var a=this,b=this.props.GroupMaster,c=b.getFormMasterSoftDeteledForms();return 0===c.length?null:c.sort(function(a,b){return Date.parse(b.Model.Modified)-Date.parse(a.Model.Modified)}).map(function(c){return f.createElement(i.RecycleBinGroupFormCard,{focusOut:a.props.focusOut,GroupMaster:b,FormMaster:c,key:c.getInstanceId()})})},b.prototype.createPlaceholderForEmptyRecyclebin=function(){var a=this.props.GroupMaster,b=a.getFormMasterSoftDeteledForms();return j.createEmptyRecyclebinView(b.length)},b}(h.ReactComponent);b.RecycleBinGroupFormsView=k,Forms.UX.RecycleBin.createRecycleBinGroupFormsView=d},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(64),f=c(2),g=c(114),h=OfficeForm.Exports.Models.FormMaster,i=OfficeForm.Exports.EngagementEventNames.RecycleBin,j=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.componentWillMount=function(){var a=this,b=this.props.FormMaster;if(this.onModelChange=function(){return a.forceUpdate()},b){this.onModelChange=function(){return a.forceUpdate()};var c=h.Schema;b.observe(this.onModelChange,[c.Title,c.Theme])}},b.prototype.componentWillUnmount=function(){var a=this.props.FormMaster;a&&(a.unobserve(this.onModelChange),a.Synchronizer.unobserve(this.onModelChange))},b.prototype.onDeleteClick=function(){f.log({eventName:i.groupFormDelete,eventType:"engagement_event"}),e.deleteForm(this.props.FormMaster,this.props.GroupMaster)},b.prototype.onRestoreClick=function(){f.log({eventName:i.groupFormRestore,eventType:"engagement_event"}),e.restoreFromRecycleBin(this.props.FormMaster,this.props.GroupMaster)},b}(g.RecycleBinCardBase);b.RecycleBinGroupFormCard=j},function(a,b,c){"use strict";function d(a,b,c,d){return f.createElement(j,{focusOut:c,RecycleBinForms:a,deleteFormHandler:b,restoreFormHandler:d})}var e=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(1),h=c(205),i=c(115),j=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return e(b,a),b.prototype.render=function(){return f.createElement("div",null,this.createFormsCard(),i.createEmptyRecyclebinView(this.props.RecycleBinForms.length))},b.prototype.createFormsCard=function(){var a=this,b=this.props.RecycleBinForms;return b&&0!==b.length?(b=b.sort(function(a,b){return Date.parse(b.Model.Modified)-Date.parse(a.Model.Modified)}),b.map(function(b){return f.createElement(h.RecycleBinFormCard,{focusOut:a.props.focusOut,FormMaster:b,onDeleteClick:a.props.deleteFormHandler,onRestoreClick:a.props.restoreFormHandler,key:b.getInstanceId()})})):null},b}(g.ReactComponent);b.RecycleBinPersonalFormsView=j,Forms.UX.RecycleBin.createRecycleBinPersonalFormsView=d},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(2),f=c(114),g=OfficeForm.Exports.Models.FormMaster,h=OfficeForm.Exports.EngagementEventNames.RecycleBin,i=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.componentWillMount=function(){var a=this,b=this.props.FormMaster;if(b){this.onModelChange=function(){return a.forceUpdate()};var c=g.Schema;b.observe(this.onModelChange,[c.Title,c.Theme])}},b.prototype.componentWillUnmount=function(){var a=this.props.FormMaster;a&&(a.unobserve(this.onModelChange),a.Synchronizer.unobserve(this.onModelChange))},b.prototype.onDeleteClick=function(){var a=this.props;e.log({eventName:h.formDelete,eventType:"engagement_event"}),a.onDeleteClick(a.FormMaster)},b.prototype.onRestoreClick=function(){var a=this.props;e.log({eventName:h.formRestore,eventType:"engagement_event"}),a.onRestoreClick(a.FormMaster)},b}(f.RecycleBinCardBase);b.RecycleBinFormCard=i},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(2),g=c(1),h=OfficeForm.Exports.Control,i=OfficeForm.Exports.EnvironmentSettings,j=OfficeForm.Exports.JavaScriptLoader,k=OfficeForm.Exports.FormLimitation,l=OfficeForm.Exports.Resources,m="PortalPage.SearchForms.UseFormSearch",n=function(a){function b(b){var c=a.call(this,b)||this;return c.isDelegateMode=!1,c.mounted=!0,c.state={FormSearchIsActive:!1},c.ensureLoadMarkJs=c.ensureLoadMarkJs.bind(c),c.ensureLoadMarkJs(),c.onValueChangeCallBack=function(a){return c.valueChange(a)},c.clearContentCallBack=function(){return c.clearContent()},c.isDelegateMode=i.isDelegateMode(),c}return d(b,a),b.prototype.componentDidUpdate=function(){this.props.Value&&b.markSearchContent(this.props.Value)},b.prototype.componentWillUnmount=function(){this.mounted=!1},b.prototype.render=function(){var a,b=this,c=h.createFontIconControl({HTMLAttributes:{className:"search-icon forms-icon-size20x20"},IconName:"Search"});a=this.isDelegateMode?l.LocalizedStrings.Portal_FormSearch_Search_Icon_Text_For_DelegatePage:OfficeFormServerInfo.userInfo.IsMsa?l.LocalizedStrings.Portal_FormSearch_Search_Icon_Text_For_MSA:l.LocalizedStrings.Portal_FormSearch_Search_Icon_Text;var d={HTMLAttributes:{className:this.state.FormSearchIsActive?"portal-search-element is-active":"portal-search-element",onBlur:function(){return b.setState({FormSearchIsActive:!1})},onFocus:function(){return b.setState({FormSearchIsActive:!0})}},Label:"",MinimalHeight:k.DefaultTextFieldHeight,onValueChange:this.onValueChangeCallBack,Options:{HTMLPropsForInnerElement:{"aria-label":l.LocalizedStrings.Portal_FormSearch_AriaLabel}},Placeholder:a,TextFiledType:h.TextFieldType.SingleLine,Value:this.props.Value},f=h.createTextField(d),g=h.createGlyphButton({ButtonStyle:"LightBackground",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{className:"portal-search-clear-button",onClick:this.clearContentCallBack},Icon:"Cancel",IconClassName:"forms-icon-size16x16",Text:l.LocalizedStrings.Portal_FormSearch_Close_Icon_Text});return e.createElement("div",{className:"portal-search-container",role:"search"},!this.state.FormSearchIsActive&&c,f,this.props.Value&&g)},b.markSearchContent=function(a){if(b.markJSLoaded){var c=b.ensureMarkInstance();a&&c.mark(a,{className:"highlight-marked-strings",element:"span"})}},b.ensureMarkInstance=function(){var a=document.querySelectorAll(".searchable"),b=new Mark(a);return b.unmark(b),b},b.prototype.ensureLoadMarkJs=function(){var a=this;j.loadJavaScript("Mark").done(function(){b.markJSLoaded=!0,a.mounted&&a.props.Value&&b.markSearchContent(a.props.Value)})},b.prototype.valueChange=function(a){this.props.onValueChange(a),a&&!b.useFormSearch&&(b.useFormSearch=!0,f.log({eventName:m,eventType:"engagement_event"}))},b.prototype.clearContent=function(){this.props.Value&&(b.ensureMarkInstance(),this.props.onValueChange(""),this.forceUpdate())},b.useFormSearch=!1,b}(g.ReactComponent);b.SearchBar=n,Forms.UX.SearchBar=n},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(1),g=c(88),h=c(89),i=OfficeForm.Exports.Control,j=OfficeForm.Exports.EnvironmentConfig,k=OfficeForm.Exports.Flighting,l=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return d(b,a),b.prototype.render=function(){if(!k.Flight.isEnabled(k.Flights.MSATemplate)||!OfficeFormServerInfo.userInfo.IsMsa&&j.isOsi())return null;var a={createCallback:this.props.createFormCallback};return e.createElement("div",{className:"template-gallery"},this.createBackButton(),g.createNewButton(a),e.createElement(h.TemplateList,{key:"TemplateGallery",viewTemplateHandler:this.props.viewTemplateHandler}))},b.prototype.createBackButton=function(){var a=i.createGlyphButton({ButtonStyle:"LightBackground",HTMLAttributes:{autoFocus:!0,className:"recycle-top-view-back-button office-form-theme-button-color",onClick:this.props.backToPortalViewPageHandler,title:"Back"},Icon:"Back",IconClassName:"top-view-back-icon forms-icon-size24x24",ref:"back-button"});return e.createElement("div",{className:"template-top-view-header",role:"navigation"},a)},b}(f.ReactComponent);Forms.UX.TemplateGallery=l},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();Object.defineProperty(b,"__esModule",{value:!0});var e=c(0),f=c(6),g=c(2),h=c(1),i=OfficeForm.Exports.Control,j=OfficeForm.Exports.Resources,k=function(a){function b(b){var c=a.call(this,b)||this;return c.destIndex=-1,c.clickDoneButton=c.clickDoneButton.bind(c),c.setDestIndex=c.setDestIndex.bind(c),c}return d(b,a),b.prototype.componentDidMount=function(){var a=f.findDOMNode(this);a&&Forms.UX.Utilities.trapFocusInsideElement(a)},b.prototype.render=function(){return e.createElement("div",{className:"section-move-control-container"},e.createElement("div",{className:"section-move-control-frost",role:"presentation"}),e.createElement("div",{className:"section-move-control-dialog"},e.createElement("div",{className:"section-move-control-title"},e.createElement("div",{className:"section-move-control-label-text"},j.LocalizedStrings.MoveSection_Title),this.createCloseButton()),e.createElement("div",{className:"section-move-control-items"},e.createElement(Forms.UX.Renderer.SortableList,{AllElements:this.props.AllElements,Disabled:this.props.Disabled,IsMobile:this.props.IsMobile,Master:this.props.TargetElementMaster,setDestIndex:this.setDestIndex})),e.createElement("div",{className:"section-move-control-bottom-button"},this.createDoneButton(),this.createCancelButton())))},b.prototype.createCloseButton=function(){var a={ButtonStyle:"None",GlyphButtonStyle:"GlyphOnly",HTMLAttributes:{className:"section-move-control-close-button",onClick:this.props.onClose},Icon:"Cancel",IconClassName:"forms-icon-size16x16",Text:j.LocalizedStrings.DesignPage_SectionMove_Close};return i.createGlyphButton(a)},b.prototype.createCancelButton=function(){return i.createTextButton({ButtonStyle:"LightBackground",HTMLAttributes:{className:"section-move-control-cancel-button office-form-theme-interactive-color",onClick:this.props.onClose},ref:"cancel-button",Text:j.LocalizedStrings.DesignPage_SectionMove_Cancel})},b.prototype.createDoneButton=function(){return i.createTextButton({ButtonStyle:"LightBackground",HTMLAttributes:{className:"section-move-control-done-button office-form-theme-button",onClick:this.clickDoneButton},ref:"done-button",Text:j.LocalizedStrings.DesignPage_SectionMove_Done})},b.prototype.clickDoneButton=function(){this.applySectionEditor(),this.props.onClose()},b.prototype.setDestIndex=function(a){this.destIndex=a},b.prototype.applySectionEditor=function(){var a=this.props.TargetElementMaster,b=this.destIndex;if(a&&b>=0){var c=a.Form.FormElementManager.SectionMasters;if(b<c.length){var d=c[b];a.Model.Id!==d.Model.Id&&(a.Form.moveSectionTo(a,d),g.log({eventName:"DesignPage.Section.Move",eventType:"engagement_event"}))}}},b}(h.ReactComponent);b.SectionMovePanel=k,Forms.UX.Renderer.SectionMovePanel=k},function(a,b,c){"use strict";var d=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),e=this&&this.__assign||Object.assign||function(a){for(var b,c=1,d=arguments.length;d>c;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};Object.defineProperty(b,"__esModule",{value:!0});var f,g=c(0),h=c(3),i=c(2),j=c(1),k=OfficeForm.Exports.Control,l=OfficeForm.Exports.JavaScriptLoader,m=OfficeForm.Exports.Resources,n=OfficeForm.Exports.Utilities;!function(a){a[a.Up=0]="Up",a[a.Down=1]="Down"}(f=b.Direction||(b.Direction={}));var o=function(a){function b(b){var c=a.call(this,b)||this;return c.focusStatus=-1,c.rankingRef=g.createRef(),c.sortableInitialized=!1,c.rankUp=c.rankUp.bind(c),c.rankDown=c.rankDown.bind(c),c.decorateSortableGroup=c.decorateSortableGroup.bind(c),c}return d(b,a),b.prototype.componentWillMount=function(){var a=this;l.loadJavaScript("Sortable").done(function(){a.setState({SortableLoaded:!0})})},b.prototype.componentWillUnmount=function(){this.sortable&&(this.sortable.destroy(),this.sortable=void 0)},b.prototype.componentWillReceiveProps=function(a){this.sortable&&(this.sortable.destroy(),this.sortable=void 0)},b.prototype.componentDidMount=function(){var a=this.rankingRef.current;this.state.SortableLoaded&&a&&this.decorateSortableGroup(a),this.updateFocusStatus()},b.prototype.componentDidUpdate=function(a,b){if(this.props.AllElements.length>0&&-1!==this.focusStatus&&this.updateFocusStatus(),this.state.SortableLoaded&&!this.sortable){var c=this.rankingRef.current;c&&this.decorateSortableGroup(c)}},b.prototype.render=function(){var a=this,b=this.props.IsMobile?"office-form-mobile-sort-list":"office-form-sort-list",c={className:b,ref:this.rankingRef,role:"listbox"};return g.createElement("div",e({},c,{key:"Ranking"}),h.map(this.props.AllElements,function(b,c){return a.createRankItem(b,c)}))},b.prototype.decorateSortableGroup=function(a){var b=this,c=150,d={animation:c,chosenClass:"office-form-sortable-chosen",delay:this.props.IsMobile?c:0,fallbackClass:"office-form-sortable-fallback",filter:".office-form-ranking-arrow",forceFallback:!0,ghostClass:"office-form-sortable-ghost",handle:".office-form-move-control-item",onEnd:function(c){var d=c.newIndex,e=c.oldIndex;b.focusStatus=0,b.moveElement(e,d),d>e?$(a).find(".office-form-sortable-list-item-container:eq("+e+")").before($(c.item)):e>d&&$(a).find(".office-form-sortable-list-item-container:eq("+e+")").after($(c.item))},preventOnFilter:!1};try{this.sortable=Sortable.create(a,d),this.sortableInitialized||i.log({eventName:"DesignPage.Sections.SortableInitialization",eventType:"engagement_event",extraData:{Successful:!0}}),this.sortableInitialized=!0}catch(e){i.log({eventName:"DesignPage.Sections.SortableInitialization",eventType:"engagement_event",extraData:{Successful:!1}}),this.sortableInitialized=!1}},b.prototype.createRankItem=function(a,c,d,f){var i,j=this.isTargetElement(a.Model.Id);this.props.IsMobile&&(i=g.createElement("span",{className:"office-form-sort-item-icon"},b.createDragHandleIcon()));var l,o=n.Html.combineAttributes("office-form-sort-item-indicator",j?"selected":""),p=h.findIndex(this.props.AllElements,function(b){return b.Model.Id===a.Model.Id});l=this.isTargetElement(a.Model.Id)?n.Html.combineAttributes("office-form-move-control-item office-form-sort-item",!this.props.Disabled&&j?"office-form-theme-primary-background office-form-selected-item":"office-form-nonselected-item"):"office-form-move-control-disabled-item office-form-sort-item office-form-nonselected-item";var q,r=a.Model.Id+"-"+c,s={"aria-posinset":c+1,"aria-setsize":this.props.AllElements.length,className:l,disabled:this.props.Disabled,id:r,role:"option",tabIndex:0};if(!this.props.Disabled){var t={disabled:!0,tabIndex:-1},u=0===c,v={"aria-describedby":r,"aria-label":m.LocalizedStrings.QuestionType_Ranking_ArrowUp_Narrator,className:n.Html.combineAttributes("office-form-ranking-arrow",u?"office-sort-disabled-arrow":"office-form-active-arrow"),onClick:u?void 0:this.rankUp,title:m.LocalizedStrings.QuestionType_Ranking_ArrowUp_Narrator};v=u?n.Html.mergeReactProps(v,t):v;var w=k.createButton({ButtonStyle:"LightBackground",children:k.createFontIconControl({HTMLAttributes:{className:"forms-icon-size18x18"},IconName:"Up"}),HTMLAttributes:v,key:"form-up-arrow"+c}),x=c===this.props.AllElements.length-1,y={"aria-describedby":r,"aria-label":m.LocalizedStrings.QuestionType_Ranking_ArrowDown_Narrator,className:n.Html.combineAttributes("office-form-ranking-arrow",x?"office-sort-disabled-arrow":"office-form-active-arrow"),onClick:x?void 0:this.rankDown,title:m.LocalizedStrings.QuestionType_Ranking_ArrowDown_Narrator};y=x?n.Html.mergeReactProps(y,t):y;var z=k.createButton({ButtonStyle:"LightBackground",children:k.createFontIconControl({HTMLAttributes:{className:"forms-icon-size18x18"},IconName:"Down"}),HTMLAttributes:y,key:"form-down-arrow"+c}),A=n.Html.combineAttributes("office-form-sort-list-arrows",j?"":"NotVisible");q=g.createElement("div",{className:A},w,z)}var B=m.LocalizedStrings.Designer_Sections_DefaultDescriptionWithTitle.format(p+1,a.Model.Title),C=g.createElement("div",e({},s,{"data-index":c}),g.createElement("div",{className:o},i),g.createElement("p",{className:"office-form-move-control-item-content"},B),this.isTargetElement(a.Model.Id)?q:null);return g.createElement("div",{className:"office-form-sortable-list-item-container office-form-unselectable",key:a.Model.Id},C)},b.prototype.rankUp=function(){this.resortItems(f.Up)},b.prototype.rankDown=function(){this.resortItems(f.Down)},b.prototype.getSelectedIndex=function(){var a=this;return h.findIndex(this.props.AllElements,function(b){return a.isTargetElement(b.Model.Id)})},b.prototype.resortItems=function(a){var b=this.getSelectedIndex(),c=b;a===f.Up?(this.focusStatus=1,--c):(this.focusStatus=2,++c),this.moveElement(b,c)},b.createDragHandleIcon=function(){return g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},g.createElement("circle",{cx:"9.5",cy:"6.5",r:"1.5",fill:"currentColor"}),g.createElement("circle",{cx:"14.5",cy:"6.5",r:"1.5",fill:"currentColor"}),g.createElement("circle",{cx:"9.5",cy:"12.5",r:"1.5",fill:"currentColor"}),g.createElement("circle",{cx:"14.5",cy:"12.5",r:"1.5",fill:"currentColor"}),g.createElement("circle",{cx:"9.5",cy:"18.5",r:"1.5",fill:"currentColor"}),g.createElement("circle",{cx:"14.5",cy:"18.5",r:"1.5",fill:"currentColor"}))},b.prototype.updateFocusStatus=function(){var a=this.getSelectedIndex(),b=this.rankingRef.current;if(b){var c=b.children[a];if(c){var d=void 0;if(0===this.focusStatus)d=c.firstElementChild;else{var e=c.querySelector(".office-form-sort-list-arrows"),f=void 0;f=1===this.focusStatus?0===a?1:0:a===this.props.AllElements.length-1?0:1,d=e.children[f]}d.focus()}}this.focusStatus=-1},b.prototype.isTargetElement=function(a){return a===this.props.Master.Model.Id},b.prototype.moveElement=function(a,b){var c=this.props.AllElements.splice(a,1)[0];this.props.AllElements.splice(b,0,c),this.props.setDestIndex(b),this.forceUpdate()},b}(j.ReactComponent);b.SortableList=o,Forms.UX.Renderer.SortableList=o},,,,,,,,,,,,,,,,,,function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),c(228)},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var d=c(11);c(16);var e=c(12);c(121),e.initializePageContext({authenticators:[]}),d.initializeTelemetry(),OfficeForm.Exports.DesignPage.initializePage()}]);