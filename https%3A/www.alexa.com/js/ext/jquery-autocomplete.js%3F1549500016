!function(w){w.fn.extend({autocomplete:function(e,t){var a="string"==typeof e;return(t=w.extend({},w.Autocompleter.defaults,{url:a?e:null,data:a?null:e,delay:a?w.Autocompleter.defaults.delay:10,max:t&&!t.scroll?10:150},t)).highlight=t.highlight||function(e){return e},t.formatMatch=t.formatMatch||t.formatItem,this.each(function(){new w.Autocompleter(this,t)})},result:function(e){return this.bind("result",e)},search:function(e){return this.trigger("search",[e])},flushCache:function(){return this.trigger("flushCache")},setOptions:function(e){return this.trigger("setOptions",[e])},unautocomplete:function(){return this.trigger("unautocomplete")}}),w.Autocompleter=function(i,l){var t,s,a,u={UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8},c=w(i).attr("autocomplete","off").addClass(l.inputClass),f="",o=w.Autocompleter.Cache(l),h=0,e={mouseDownOnSelect:!1},d=w.Autocompleter.Select(l,i,n,e);function n(){var e=d.selected();if(!e)return!1;var t=e.result;if(f=t,l.multiple){var a=p(c.val());1<a.length&&(t=a.slice(0,a.length-1).join(l.multipleSeparator)+l.multipleSeparator+t),t+=l.multipleSeparator}return c.val(t),v(),c.trigger("result",[e.data,e.value]),!0}function r(e,t){if(s!=u.DEL){var a=c.val();(t||a!=f)&&((a=m(f=a)).length>=l.minChars?(c.addClass(l.loadingClass),l.matchCase||(a=a.toLowerCase()),C(a,g,v)):(b(),d.hide()))}else d.hide()}function p(e){if(!e)return[""];var t=e.split(l.multipleSeparator),a=[];return w.each(t,function(e,t){w.trim(t)&&(a[e]=w.trim(t))}),a}function m(e){if(!l.multiple)return e;var t=p(e);return t[t.length-1]}function v(){d.visible();d.hide(),clearTimeout(t),b(),l.mustMatch&&c.search(function(e){if(!e)if(l.multiple){var t=p(c.val()).slice(0,-1);c.val(t.join(l.multipleSeparator)+(t.length?l.multipleSeparator:""))}else c.val("")})}function g(e,t){if(t&&t.length&&h)b(),d.display(t,e),r=e,o=t[0].value,l.autoFill&&m(c.val()).toLowerCase()==r.toLowerCase()&&s!=u.BACKSPACE&&(c.val(c.val()+o.substring(m(f).length)),w.Autocompleter.Selection(i,f.length,f.length+o.length)),d.show();else{var a=c.parent(),n="<div class='autocomplete "+(c.hasClass("keyword")?"keyword":"industry")+"'><p>No results found</p></div>";c.hasClass("forced")&&(a.find(".autocomplete").length&&a.find(".autocomplete").remove(),a.append(n)),v()}var r,o}function C(a,n,e){l.matchCase||(a=a.toLowerCase());var t=o.load(a);if(t&&t.length)n(a,t);else if("string"==typeof l.url&&0<l.url.length){var r={timestamp:+new Date};w.each(l.extraParams,function(e,t){r[e]="function"==typeof t?t():t}),w.ajax({mode:"abort",port:"autocomplete"+i.name,dataType:l.dataType,url:l.url,data:w.extend({q:m(a),limit:l.max},r),success:function(e){if(e){var t=l.parse&&l.parse(e)||function(e){for(var t=[],a=e.split("\n"),n=0;n<a.length;n++){var r=w.trim(a[n]);r&&(r=r.split("|"),t[t.length]={data:r,value:r[0],result:l.formatResult&&l.formatResult(r,r[0])||r[0]})}return t}(e);o.add(a,t),n(a,t)}}})}else d.emptyList(),e(a)}function b(){c.removeClass(l.loadingClass)}w.browser.opera&&w(i.form).bind("submit.autocomplete",function(){if(a)return a=!1}),c.bind((w.browser.opera?"keypress":"keydown")+".autocomplete",function(e){switch(s=e.keyCode,e.keyCode){case u.UP:e.preventDefault(),d.visible()?d.prev():r(0,!0);break;case u.DOWN:e.preventDefault(),d.visible()?d.next():r(0,!0);break;case u.PAGEUP:e.preventDefault(),d.visible()?d.pageUp():r(0,!0);break;case u.PAGEDOWN:e.preventDefault(),d.visible()?d.pageDown():r(0,!0);break;case l.multiple&&","==w.trim(l.multipleSeparator)&&u.COMMA:case u.TAB:case u.RETURN:if(n())return e.preventDefault(),!(a=!0);break;case u.ESC:d.hide();break;default:clearTimeout(t),t=setTimeout(r,l.delay)}}).focus(function(){h++}).blur(function(){h=0,e.mouseDownOnSelect||(clearTimeout(t),t=setTimeout(v,200))}).click(function(){1<h++&&!d.visible()&&r(0,!0)}).bind("search",function(){var r=1<arguments.length?arguments[1]:null;function a(e,t){var a;if(t&&t.length)for(var n=0;n<t.length;n++)if(t[n].result.toLowerCase()==e.toLowerCase()){a=t[n];break}"function"==typeof r?r(a):c.trigger("result",a&&[a.data,a.value])}w.each(p(c.val()),function(e,t){C(t,a,a)})}).bind("flushCache",function(){o.flush()}).bind("setOptions",function(){w.extend(l,arguments[1]),"data"in arguments[1]&&o.populate()}).bind("unautocomplete",function(){d.unbind(),c.unbind(),w(i.form).unbind(".autocomplete")})},w.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",optionalresultsClass:"",loadingClass:"ac_loading",minChars:1,delay:400,matchCase:!1,matchSubset:!0,matchContains:!1,cacheLength:10,max:100,mustMatch:!1,extraParams:{},selectFirst:!0,formatItem:function(e){return e[0]},formatMatch:null,autoFill:!1,width:0,multiple:!1,multipleSeparator:", ",highlight:function(e,t){return e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+t.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},scroll:!0,scrollHeight:180,appendResultsTo:document.body},w.Autocompleter.Cache=function(s){var o={},i=0;function l(e,t){s.matchCase||(e=e.toLowerCase());var a=e.indexOf(t);return"word"==s.matchContains&&(a=e.toLowerCase().search("\\b"+t.toLowerCase())),-1!=a&&(0==a||s.matchContains)}function u(e,t){i>s.cacheLength&&a(),o[e]||i++,o[e]=t}function e(){if(!s.data)return!1;var e={},t=0;s.url||(s.cacheLength=1),e[""]=[];for(var a=0,n=s.data.length;a<n;a++){var r=s.data[a];r="string"==typeof r?[r]:r;var o=s.formatMatch(r,a+1,s.data.length);if(!1!==o){var i=o.charAt(0).toLowerCase();e[i]||(e[i]=[]);var l={value:o,data:r,result:s.formatResult&&s.formatResult(r)||o};e[i].push(l),t++<s.max&&e[""].push(l)}}w.each(e,function(e,t){s.cacheLength++,u(e,t)})}function a(){o={},i=0}return setTimeout(e,25),{flush:a,add:u,populate:e,load:function(a){if(!s.cacheLength||!i)return null;if(!s.url&&s.matchContains){var n=[];for(var e in o)if(0<e.length){var t=o[e];w.each(t,function(e,t){l(t.value,a)&&n.push(t)})}return n}if(o[a])return o[a];if(s.matchSubset)for(var r=a.length-1;r>=s.minChars;r--){if(t=o[a.substr(0,r)]){n=[];return w.each(t,function(e,t){l(t.value,a)&&(n[n.length]=t)}),n}}return null}}},w.Autocompleter.Select=function(o,n,a,r){var i,l,s,u,c="ac_over",f=-1,h="",d=!0;function p(e){for(var t=e.target;t&&"LI"!=t.tagName;)t=t.parentNode;return t||[]}function e(e){i.slice(f,f+1).removeClass(c),(f+=e)<0?f=i.size()-1:f>=i.size()&&(f=0);var t=i.slice(f,f+1).addClass(c);if(o.scroll){var a=0;i.slice(0,f).each(function(){a+=this.offsetHeight}),a+t[0].offsetHeight-u.scrollTop()>u[0].clientHeight?u.scrollTop(a+t[0].offsetHeight-u.innerHeight()):a<u.scrollTop()&&u.scrollTop(a)}}function m(){u.empty();for(var e,t=(e=l.length,o.max&&o.max<e?o.max:e),a=0;a<t;a++)if(l[a]){var n=o.formatItem(l[a].data,a+1,t,l[a].value,h);if(!1!==n){var r=w("<li/>").html(o.highlight(n,h)).addClass(a%2==0?"ac_even":"ac_odd").appendTo(u)[0];w.data(r,"ac_data",l[a])}}i=u.find("li"),o.selectFirst&&(i.slice(0,1).addClass(c),f=0),w.fn.bgiframe&&u.bgiframe()}return{display:function(e,t){d&&(s=w("<div/>").hide().addClass(o.resultsClass).css("position","absolute").appendTo(o.appendResultsTo),u=w("<ul/>").appendTo(s).mouseover(function(e){p(e).nodeName&&"LI"==p(e).nodeName.toUpperCase()&&(f=w("li",u).removeClass(c).index(p(e)),w(p(e)).addClass(c))}).click(function(e){return w(p(e)).addClass(c),a(),n.focus(),!1}).mousedown(function(){r.mouseDownOnSelect=!0}).mouseup(function(){r.mouseDownOnSelect=!1}),o.optionalresultsClass&&s.addClass(o.optionalresultsClass),0<o.width&&s.css("width",o.width),d=!1),l=e,h=t,m()},next:function(){e(1)},prev:function(){e(-1)},pageUp:function(){e(0!=f&&f-8<0?-f:-8)},pageDown:function(){f!=i.size()-1&&f+8>i.size()?e(i.size()-1-f):e(8)},hide:function(){s&&s.hide(),i&&i.removeClass(c),f=-1},visible:function(){return s&&s.is(":visible")},current:function(){return this.visible()&&(i.filter("."+c)[0]||o.selectFirst&&i[0])},show:function(){var e=w(n).offset();if(s.css({width:"string"==typeof o.width||0<o.width?o.width:w(n).innerWidth(),top:e.top+n.offsetHeight,left:e.left}).show(),o.scroll&&(u.scrollTop(0),u.css({maxHeight:o.scrollHeight,overflow:"auto"}),w.browser.msie&&void 0===document.body.style.maxHeight)){var t=0;i.each(function(){t+=this.offsetHeight});var a=t>o.scrollHeight;u.css("height",a?o.scrollHeight:t),a||i.width(u.width()-parseInt(i.css("padding-left"))-parseInt(i.css("padding-right")))}},selected:function(){var e=i&&i.filter("."+c).removeClass(c);return e&&e.length&&w.data(e[0],"ac_data")},emptyList:function(){u&&u.empty()},unbind:function(){s&&s.remove()}}},w.Autocompleter.Selection=function(e,t,a){if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveStart("character",t),n.moveEnd("character",a),n.select()}else e.setSelectionRange?e.setSelectionRange(t,a):e.selectionStart&&(e.selectionStart=t,e.selectionEnd=a);e.focus()}}(jQuery);