function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={"i":r,"l":!1,"exports":{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{"enumerable":!0,"get":r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{"value":"Module"}),Object.defineProperty(e,"__esModule",{"value":!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==(void 0===e?"undefined":_typeof(e))&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{"enumerable":!0,"value":e}),2&n&&"string"!=typeof e)for(var o in e)t.d(r,o,function(t){return e[t]}.bind(null,o));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,n){!function(){function t(e){return new Promise(function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function n(e,n,r){var o=void 0,i=new Promise(function(i,c){t(o=e[n].apply(e,_toConsumableArray(r))).then(i,c)});return i.request=o,i}function r(e,t,n){n.forEach(function(n){Object.defineProperty(e.prototype,n,{"get":function(){return this[t][n]},"set":function(e){this[t][n]=e}})})}function o(e,t,r,o){o.forEach(function(o){o in r.prototype&&(e.prototype[o]=function(){return n(this[t],o,arguments)})})}function i(e,t,n,r){r.forEach(function(r){r in n.prototype&&(e.prototype[r]=function(){return this[t][r].apply(this[t],arguments)})})}function c(e,t,r,o){o.forEach(function(o){o in r.prototype&&(e.prototype[o]=function(){return function(e,t,r){var o=n(e,t,r);return o.then(function(e){if(e)return new s(e,o.request)})}(this[t],o,arguments)})})}function a(e){this._index=e}function s(e,t){this._cursor=e,this._request=t}function u(e){this._store=e}function f(e){this._tx=e,this.complete=new Promise(function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}})}function l(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new f(n)}function h(e){this._db=e}r(a,"_index",["name","keyPath","multiEntry","unique"]),o(a,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),c(a,"_index",IDBIndex,["openCursor","openKeyCursor"]),r(s,"_cursor",["direction","key","primaryKey","value"]),o(s,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(e){e in IDBCursor.prototype&&(s.prototype[e]=function(){var n=this,r=arguments;return Promise.resolve().then(function(){return n._cursor[e].apply(n._cursor,r),t(n._request).then(function(e){if(e)return new s(e,n._request)})})})}),u.prototype.createIndex=function(){return new a(this._store.createIndex.apply(this._store,arguments))},u.prototype.index=function(){return new a(this._store.index.apply(this._store,arguments))},r(u,"_store",["name","keyPath","indexNames","autoIncrement"]),o(u,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),c(u,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),i(u,"_store",IDBObjectStore,["deleteIndex"]),f.prototype.objectStore=function(){return new u(this._tx.objectStore.apply(this._tx,arguments))},r(f,"_tx",["objectStoreNames","mode"]),i(f,"_tx",IDBTransaction,["abort"]),l.prototype.createObjectStore=function(){return new u(this._db.createObjectStore.apply(this._db,arguments))},r(l,"_db",["name","version","objectStoreNames"]),i(l,"_db",IDBDatabase,["deleteObjectStore","close"]),h.prototype.transaction=function(){return new f(this._db.transaction.apply(this._db,arguments))},r(h,"_db",["name","version","objectStoreNames"]),i(h,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[u,a].forEach(function(t){e in t.prototype&&(t.prototype[e.replace("open","iterate")]=function(){var t,n=function(e){return Array.prototype.slice.call(e)}(arguments),r=n[n.length-1],o=(t=this._store||this._index)[e].apply(t,_toConsumableArray(n.slice(0,-1)));o.onsuccess=function(){r(o.result)}})})}),[a,u].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,r=[];return new Promise(function(o){n.iterateCursor(e,function(e){e?(r.push(e.value),void 0===t||r.length!=t?e["continue"]():o(r)):o(r)})})})});var p={"open":function(e,t,r){var o=n(indexedDB,"open",[e,t]),i=o.request;return i&&(i.onupgradeneeded=function(e){r&&r(new l(i.result,e.oldVersion,i.transaction))}),o.then(function(e){return new h(e)})},"delete":function(e){return n(indexedDB,"deleteDatabase",[e])}};e.exports=p,e.exports["default"]=e.exports}()},,function(e,t){CacheStorage.prototype.match||(CacheStorage.prototype.match=function(e){var t=function t(n){return function(t){return caches.open(t).then(function(t){return t.match(e)})}(n.shift()).then(function(e){return e||(n.length?t(n):void 0)})};return e instanceof Request||(e=new Request(e)),caches.keys().then(function(e){return t(e)})}),Cache.prototype.addAll||(Cache.prototype.addAll=function(e){var t=this;return Promise.all(e.map(function(e){return e instanceof Request||(e=new Request(e)),fetch(e.clone()).then(function(n){if(n&&200===n.status)return t.put(e,n)})}))},Cache.prototype.add=function(e){return this.addAll([e])}),Array.from||(Array.from=function(){var e=Object.prototype.toString,t=function(t){return"function"==typeof t||"[object Function]"===e.call(t)},n=Math.pow(2,53)-1,r=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),n)};return function(e){var n=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var o=arguments.length>1?arguments[1]:void 0,i=void 0;if(void 0!==o){if(!t(o))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(i=arguments[2])}for(var c=r(n.length),a=t(this)?Object(new this(c)):new Array(c),s=void 0,u=0;u<c;)s=n[u],a[u]=o?void 0===i?o(s,u):o.call(i,s,u):s,u+=1;return a.length=c,a}}())},function(e,t,n){function r(){for(var e,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).log.apply(e,["SW: "].concat(n))}function o(e){console.error(e),l.error(e)}function i(){for(var e,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=console).warn.apply(e,["SW: "].concat(n))}function c(e,t){/^\/\//.test(e)&&(e="https:"+e);var n=(e=new URL(e)).search;0===n.indexOf("?")&&(n=n.slice(1));var r=n.split("&").filter(function(e){return!t(e)});return""+e.origin+e.pathname+(r.length>0?"?"+r.join("&"):"")}function a(e,t){return fetch(e.url).then(function(n){return function(e,t,n){if("GET"===e.method||"get"===e.method)if(t&&200===t.status){var r=t.clone();caches.open(n).then(function(t){t.put(e,r)})["catch"](function(e){o(e)})}else o(new Error("Fetch "+e.url+": "+t.status+"|"+t.statusText))}(e,n,t),n})["catch"](function(e){o(e)})}function s(e,t,n){var r=caches.open(t).then(function(t){return t.match(e)}).then(function(n){return n||a(e,t)});n.respondWith(r)}n.r(t),n(2);var u=function(){function e(){_classCallCheck(this,e),this.target="https://arms-retcode-sg.aliyuncs.com/r.png?",this.ver="sw-0.0.1",this.seq=0,this.session=function(){for(var e=20,t=new Array(e),n=Date.now().toString(36).split(""),r=void 0,o=void 0;e>0;)e-=1,r=36*Math.random()|0,o=r.toString(36),t[e]=r%3?o:o.toUpperCase();for(var i=0;i<8;i++)t.splice(3*i+2,0,n[i]);return t.join("")}(),this.$requestQueue$=[],this.$sampleCache$={},this._conf={"pid":"hyey0hz67v@bd0d99365721758","page":"Service Worker","sample":1,"tag":""},this.sendPV()}return _createClass(e,[{"key":"setConfig","value":function(e){e.pid&&(this._conf.pid=e.pid),e.page&&(this._conf.page=e.page),e.imgUrl&&(this.target=e.imgUrl)}},{"key":"sum","value":function(t,n,r){try{return this._lg("sum",e.parseStatData(t,{"val":n||1}),r)}catch(t){i("[retcode] can not get parseStatData: "+t)}}},{"key":"error","value":function(e,t){if(!e||"object"!=(void 0===e?"undefined":_typeof(e))||"string"!=typeof e.message)return i("[retcode] invalid param e: "+e),this;var n=e.name||"CustomError",r=e.message,o=e.stack||"";t=t||{},o=o&&o.substring(0,1e3);var c={"cate":n,"msg":r.substring(0,1e3),"stack":o,"file":t.filename||"","line":t.lineno||"","col":t.colno||""};return this._lg("error",c,1)}},{"key":"api","value":function(e,t,n,r,o){var c=this;if(!e)return i("[retcode] api is null"),c;var a={"api":e,"success":t,"time":n,"code":r,"msg":o};return a.code=a.code||"",a.msg=a.msg||"",a.success=a.success?1:0,a.time=+a.time,!a.api||isNaN(a.time)?(i("[retcode] invalid time or api"),this):this._lg("api",a,1)}},{"key":"sendPV","value":function(){this._lg("pv",{})}},{"key":"_lg","value":function(e,t,n){var r=this._conf;return t&&!r.disabled&&r.pid?n&&!this.sampling(n)?this:(t=Object.assign({"t":e,"times":1,"tag":r.tag||""},t,{"page":r.page,"pid":r.pid,"_v":this.ver,"sid":this.session,"uid":1,"sampling":n||1,"z":this.seq}),this.seq+=1,this.pushToQueue(t)):this}},{"key":"fetch","value":function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(t){"object"==(void 0===t?"undefined":_typeof(t))&&(t=e.serialize(t));var n=this.target+t;fetch(n,{"method":"HEAD","mode":"no-cors"})["catch"](function(){})})},{"key":"pushToQueue","value":function(e){var t=this,n=this.$requestQueue$[0];"error"===e.t&&n&&"error"===n.t&&e.msg===n.msg?n.times+=1:(this.$requestQueue$.unshift(e),this.$requestTimer$=function(e,t){return-1===t?(e(),null):setTimeout(e,t||0)}(function(){t.clear()},"error"===e.t?3e3:-1))}},{"key":"sampling","value":function(e){return 1===e||("boolean"==typeof this.$sampleCache$[e]?this.$sampleCache$[e]:(this.$sampleCache$[e]=1===e||1===Math.ceil(Math.random()*e),this.$sampleCache$[e]))}},{"key":"clear","value":function(){clearTimeout(this.$requestTimer$),this.$requestTimer$=null;for(var e=this.$requestQueue$.pop();e;)this.fetch(e),e=this.$requestQueue$.pop();return this}}],[{"key":"parseStatData","value":function(e,t){var n=e.split("::");return n.length>1?Object.assign({"group":n[0],"key":n[1]},t):Object.assign({"group":"default_group","key":n[0]},t)}},{"key":"serialize","value":function(t){t=t||{};var n=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&void 0!==t[r]&&n.push(r+"="+e.encode(t[r],"msg"===r));return n.join("&")}},{"key":"encode","value":function(e,t){try{e=t?encodeURIComponent(e).replace(/\(/g,"%28").replace(/\)/g,"%29"):encodeURIComponent(e)}catch(e){}return e}}]),e}(),f=new u;self.addEventListener("error",function(e){f.error(e)}),self.addEventListener("unhandledrejection",function(e){var t={"name":"unhandledrejection","message":e.reason?e.reason.message:"","stack":e.reason?e.reason.stack:""};f.error(t)});var l=f,h=/^(scm|spm|acm)=/i,p=n(0),d=n.n(p),g="SERVICE_WORKER",m={"create":function(){return d.a.open(g,1,function(e){console.log(e),e.objectStoreNames.contains("CONFIG")||e.createObjectStore("CONFIG",{"keyPath":"version"})})},"read":function(){return d.a.open(g,1).then(function(e){return e.transaction(["CONFIG"],"readonly").objectStore("CONFIG").get(1)})},"write":function(e){return d.a.open(g,1).then(function(t){var n=t.transaction("CONFIG","readwrite"),r=n.objectStore("CONFIG");return e.version=1,r.put(e),n.complete})}},y=self;(new(function(){function e(t){_classCallCheck(this,e),this.config={"cacheName":"","cacheVersion":"","cacheDocREG":"","cacheAssetREG":"","cacheImageREG":"","preCache":[]},t&&this.assignConfig(t)}return _createClass(e,[{"key":"assignConfig","value":function(t){r("AssignConfig");var n=Promise.resolve("AssignConfig done");if("object"!=(void 0===t?"undefined":_typeof(t)))return Promise.reject("Config not illegal");if(t.cacheName&&t.cacheVersion&&t.preCache&&Array.isArray(t.preCache)){var i=[];i=t.cacheName!==this.config.cacheName||t.cacheVersion!==this.config.cacheVersion?t.preCache:function(e,t){return e.length<=0?[]:t.length<=0?e:e.filter(function(e){return!t.find(function(t){return t===e})})}(t.preCache,this.config.preCache),this.config.preCache=t.preCache,r("Begin to pre-cache:",i),n=function(e,t){return e.length<1?Promise.resolve("Url length == 0"):(e=e.map(function(e){return e=c(e,function(e){return h.test(e)})}),caches.open(t).then(function(t){return t.addAll(e)}).then(function(){r("Pre-cache successfully")})["catch"](function(e){o(e)}))}(i,e.cacheName(t.cacheName,t.cacheVersion))}return this.config.cacheName=t.cacheName,this.config.cacheVersion=t.cacheVersion,this.config.cacheDocREG=t.cacheAssetREG?new RegExp(t.cacheDocREG):"",this.config.cacheAssetREG=t.cacheAssetREG?new RegExp(t.cacheAssetREG):"",this.config.cacheImageREG=t.cacheImageREG?new RegExp(t.cacheImageREG):"","object"==_typeof(t.retcode)&&l.setConfig(t.retcode),n}},{"key":"onMessage","value":function(e){var t=e.data;r("On message:",t),"config"===t.cmd&&(this.assignConfig(t.message),m.write(t.message)["catch"](function(e){o(e)}))}},{"key":"onFetch","value":function(t){if("only-if-cached"!==t.request.cache||"same-origin"===t.request.mode){var n=this.config,r=n.cacheName,i=n.cacheVersion;if(r&&i){var u=e.cacheName(r,i),f=t.request,h=f.url;if("navigate"===f.mode&&this.config.cacheDocREG&&this.config.cacheDocREG.test(h))!function(e,t,n){var r=new Promise(function(n){var r=(new Date).getTime();caches.open(t).then(function(t){return t.match(e)}).then(function(o){var i=(new Date).getTime();o?(n(o),a(e,t).then(function(){l.api("update: "+e.url,1,(new Date).getTime()-i,1,"online")}),l.api("cache: "+e.url,1,i-r,2,"cache")):(n(a(e,t)),l.api("cache: "+e.url,0,i-r,0,"not match"))})["catch"](function(e){o(e)})});n.respondWith(r)}(function(e,t){var n=c(e.url,t);return new Request(n,{"mode":"no-cors","destination":""})}(t.request,function(e){return/^(scm|spm|acm)=/i.test(e)}),u,t);else if(this.config.cacheAssetREG&&this.config.cacheAssetREG.test(h))s(f,u,t);else if(this.config.cacheImageREG&&this.config.cacheImageREG.test(h))return void s(f,u,t)}}}},{"key":"onActive","value":function(){var e=this;r("Active!"),m.create().then(function(){return m.read()}).then(function(t){if(r("Read config from indexDB in active",t),"object"==(void 0===t?"undefined":_typeof(t)))return e.assignConfig(t)})["catch"](function(e){o(e)})}},{"key":"onInstall","value":function(){r("Install!")}},{"key":"bindEvent","value":function(){y.addEventListener("install",this.onInstall.bind(this)),y.addEventListener("fetch",this.onFetch.bind(this)),y.addEventListener("activate",this.onActive.bind(this)),y.addEventListener("message",this.onMessage.bind(this))}},{"key":"run","value":function(){r("Run"),this.bindEvent()}}],[{"key":"cacheName","value":function(e,t){return e+"_"+t}},{"key":"sendMessageToPage","value":function(e,t){y.clients.matchAll().then(function(e){return e.find(function(e){return e.focused})}).then(function(n){r("Send message to :",n),n&&n.postMessage({"cmd":e,"message":t})})}}]),e}())).run()}]);