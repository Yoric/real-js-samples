!function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}({0:function(t,e,n){t.exports=n(28)},17:function(t,e){},28:function(t,e,n){n(17),n(37)},37:function(t,e){!function(){var t,e=/\W/g,n=document,i=document.getElementsByTagName("head")[0]||document.documentElement;seajs.importStyle||(seajs.importStyle=function(r,o){if(!o||(o=o.replace(e,"-"),!n.getElementById(o))){var a;if(!t||o?(a=n.createElement("style"),o&&(a.id=o),i.appendChild(a)):a=t,void 0!==a.styleSheet){if(n.getElementsByTagName("style").length>31)throw new Error("Exceed the maximal count of style tags in IE");a.styleSheet.cssText+=r}else a.appendChild(n.createTextNode(r));o||(t=a)}})}(),seajs.use(["jquery/jquery/1.7.2/jquery","arale/autocomplete/1.3.1/autocomplete","arale/tip/1.2.2/tip","arale/widget/1.1.1/widget","gallery/es5-safe/0.9.2/es5-safe"],function(t,e,n,i){t(function(){function r(){return++window.uniqueId}if(window._csp||(window._csp={}),window._csp._dyntable_js)return{};window._csp._dyntable_js=1;var o=i.extend({attrs:{displayRows:10,autocompleteLines:4,dataSource:{}},setup:function(){o.superclass.setup.call(this),this.filter=[],this.tipBoxInstance=[],this.autocompleteBoxInstance=[],this._initTableDom(),this.trigger="#dynTableWrapper"+this.get("id")+" .J_cspSnippetDynTable",this.id=this.get("id"),this.$tableDom=t(this.trigger),t(this.trigger).find("tbody .J_expandRows").closest("tr").remove(),this._getData(),this._cutTable(),this._initSearchBox(),this.changeRowColor(),this.bindEvent()},bindEvent:function(){this.$tableDom.on("click",".J_expandRows",function(e){var e=t(e.target),n=e.data("id"),i=e.data("trigger");t(i).find("tr").show(),t(i).find("tr:first").hide();var r=window.tableObj[n];r.changeRowColor(),e.closest("tr").remove()}),this.$tableDom.on("click",".J_resetDynTable",function(e){t(e.target).closest("tr").hide();var n=t(e.target).data("id"),i=window.tableObj[n],a=i.destroy(),s=t(".csp-dyntable-data").filter(function(){return t(this).data("id")===a.id?!0:void 0}),c=r(),i=new o({id:c,data:a.data,dom:t(s)});window.tableObj[c]=i})},destroy:function(){var e=this.get("id");this._initBoxs();var n='<script type="application/json" data-id="'+e+'" class="csp-dyntable-data"></script>',r=t("#dynTableWrapper"+e);Date.now();r.replaceWith(n);var o={id:e,data:this.get("data")};return i.superclass.destroy.call(this),o},_handleRawDynTableData:function(t){for(var e=t.cols,n=t.rows,i={},r=0;r<e.length;r++){var o=e[r].field,a=e[r]._cell;i[o]=a.values}for(var s in n){var c=n[s];for(var l in c)c[l].values=i[l]}return t},_cutTable:function(){var e=t(this.trigger).find("tr"),n=this.get("displayRows");if(e.length>n+2){for(var i=1;i<e.length;i++)n+2>i?t(e[i]).show():t(e[i]).hide();t(this.trigger).find("tbody .J_expandRows").length?t(this.trigger).find("tbody .J_expandRows").closest("tr").show():t(this.trigger).find("tbody").append('<tr><td colspan="100"> <a href="javascript:void(0)" class="J_expandRows" data-id="'+this.id+'" data-trigger="'+this.trigger+'">\u5c55\u5f00\u66f4\u591a</a></td></tr>')}},changeRowColor:function(){t(".J_cspSnippetDynTable").each(function(e){t(this).find("tbody tr").removeClass("odd"),t(this).find("tbody tr").filter(function(){return"table-row"===t(this).css("display")}).filter(":odd").addClass("odd")})},_initTableDom:function(){function e(t){for(var e="",n=0;n<t.length;n++)"NORMAL"===t[n].tableType?e+='<th class="clickable J_cspSnippetDynTableTrigger'+t[n].index+'" data-value="'+t[n].displayName+'">'+t[n].displayName+"<span >\u25bc</span></th>":"TABLE_OUTPUT"===t[n].tableType&&(e+='<th data-value="'+t[n].displayName+'">'+t[n].displayName);return e}function n(e){for(var n="",i=0;i<e.length;i++){n+="<tr>";for(var r=0;r<e[i].length;r++)n+=t.isArray(e[i][r])?"<td>"+e[i][r].join(",")+"</td>":"<td>"+e[i][r]+"</td>";n+="</tr>"}return n}function i(t,e,n){return'<table class="csp-snippet-dyn-table J_cspSnippetDynTable" border="0" cellpadding="0" cellspacing="0"><thead><tr style="display:none;"><th colspan="100"><a href="javascript:void(0)" class="J_resetDynTable" data-id="'+t+'">\u91cd\u7f6e\u8868\u683c</a></th></tr>'+e+"</thead><tbody>"+n+"</tbody></table>"}var r=this._handleRawDynTableData(this.get("data")),o={head:[],body:[]},a=r.cols,s=r.rows;console.log("table",r);for(var c=0;c<a.length;c++)o.head.push({index:a[c].index,id:a[c]._attributeNameId,cellTemplate:a[c].cellTemplate,displayName:a[c].displayName,tableType:a[c].tableType});for(var c=0;c<s.length;c++){var l=[];for(var u in s[c]){var f,p=s[c][u].selVal;if(t.isArray(p)){var h=[];for(var d in s[c][u].values)for(var g=s[c][u].values[d],v=0;v<p.length;v++)g.id===p[v]&&h.push(g.value);f=h.concat()}else if(p){var m=!1;for(var d in s[c][u].values){var g=s[c][u].values[d];g.id===p&&(f=g.value,m=!0)}m||(f="\u7a7a")}else f="\u7a7a";l.push(f)}o.body.push(l)}window.resultData=this.resultData=o;var y=i(this.get("id"),e(o.head),n(o.body)),b=this.get("dom");b.replaceWith('<div id="dynTableWrapper'+this.get("id")+'">'+y+"</div>")},_getData:function(){for(var e=this.$tableDom.find("th"),n=[],i=1;i<e.length;i++)n.push(t(e[i]).data("value"));for(var r=this.resultData.body,o=r.length,a=r[0].length,s=this.buildArr(a,o),i=0;o>i;i++)for(j=0;j<a;j++)s[j][i]=r[i][j];for(var c={},i=0;i<s.length;i++){var l=this.getSameItemIndexByArr(s[i]);l.index=i,c[n[i]]=l}this.queryList=c},_filterDataByTrigger:function(t,e){var n={index:t,value:e};if(0===this.filter.length)this.filter.push(n);else for(var i=0;i<this.filter.length;i++)this.filter[i].index===t?this.filter[i]=n:this.filter.push(n);this._initSearchBox(),this._showLinesByFilter()},_showLinesByFilter:function(){var e=[];for(var n in this.filter)e.push(this.getFilterArr(n));var i=this.retainArrs(e),r=this.$tableDom.find("tbody > tr");t(r).hide();for(var o=0;o<r.length;o++)for(var a=0;a<i.length;a++)o===i[a]&&t(r[o]).show()},_filterQueryList:function(){for(var t=0;t<this.filter.length;t++){var e=[],n=this.filter[t];for(var i in this.queryList)n.index===this.queryList[i].index&&(e=this.queryList[i][n.value]);for(var i in this.queryList){for(var r=this.queryList[i],o=[],a=r.items.concat(),s=0;s<r.items.length;s++){var c=r.items[s],l=r[c],u=this.retainArrs([l,e]);0===u.length&&o.push(s)}for(var s=0;s<o.length;s++)this.removeStringFromArr(r.items,a[o[s]])}}},_initBoxs:function(){for(var t=this,e=0;e<this.tipBoxInstance.length;e++)!function(t,e){t.tipBoxInstance[e].destroy()}(t,e);for(var e=0;e<t.autocompleteBoxInstance.length;e++)!function(t,e){t.autocompleteBoxInstance[e].destroy()}(t,e);this.tipBoxInstance=[],this.autocompleteBoxInstance=[]},_initSearchBox:function(){this._filterQueryList(),this._initBoxs();for(var t in this.queryList)this._initTipBox(this.queryList[t].index,this.queryList[t].items)},_initTipBox:function(t,e){var i=this,r=new n({trigger:this.trigger+" .J_cspSnippetDynTableTrigger"+t,triggerType:"click",theme:"white",arrowPosition:11,height:24,width:130}).before("show",function(){var n='<input type="text" class="autocompleteInput J_cspSnippetDynTableAutoComplete'+i.get("id")+"-"+t+'"/>',r='<div class="ui-poptip-shadow"><div class="ui-poptip-container"><div class="ui-poptip-arrow ui-poptip-arrow-11"><em></em><span></span></div><div class="ui-poptip-content" style="width: 130px; height: 20px;">'+n+"</div></div></div>";this.element.html(r);for(var o=0;o<i.autocompleteBoxInstance.length;o++)!function(t,e){t.autocompleteBoxInstance[e].destroy()}(i,o);i.autocompleteBoxInstance=[],window.setTimeout(function(){i._initAutoCompleteBox(t,e)},10)});this.tipBoxInstance.push(r)},_initAutoCompleteBox:function(n,i){var r=this,o=new e({trigger:".J_cspSnippetDynTableAutoComplete"+r.get("id")+"-"+n,dataSource:i,width:130,filter:function(e,n){n=n||"";var i=[],o=n.length;return o?(t.each(e,function(t,e){for(var o,a=[e.value].concat(e.alias);o=a.shift();)if(o.indexOf(n)>-1){e.label===o&&(e.highlightIndex=r._matchString(o,n)),i.push(e);break}}),i):e}}).render();o.setInputValue("."),o.setInputValue(""),this._hotFixAutoComplete();40*this.get("autocompleteLines")+"px";o.on("itemSelected",function(e){t(r.trigger).find(".J_resetDynTable").closest("tr").show(),r._filterDataByTrigger(n,e.value),r.changeRowColor(),r._disableSelect(n,e.value)}),this.autocompleteBoxInstance.push(o)},_disableSelect:function(e,n){var i=t(this.trigger+" .J_cspSnippetDynTableTrigger"+e),r="J_cspSnippetDynTableTrigger"+e;i.removeClass("clickable "+r).find("span").remove()},_hotFixAutoComplete:function(){t(".ui-select-item").find("a").prop("href","javascript:void(0)")},_matchString:function(t,e){for(var n=[],i=t.split(""),r=0,o=e.split(""),a=0,s=i.length;s>a;a++){var c=i[a];if(c===o[r]){if(r===o.length-1){n.push([a-o.length+1,a+1]),r=0;continue}r++}else r=0}return n},buildArr:function(t,e){for(var n=new Array(t),i=0;t>i;i++)n[i]=new Array(e);return n},getSameItemIndexByArr:function(t){for(var e={},n={},i=0;i<t.length;i++)if(/,/.test(t[i]))for(var r=t[i].split(","),o=0;o<r.length;o++)n[r[o]]=!0;else n[t[i]]=!0;for(var a in n)e[a]=[];var s=[];for(var c in e)"\u7a7a"!==c&&s.push(c);e.items=s;for(var i=0;i<t.length;i++)for(var o=0;o<s.length;o++)if(t[i]===s[o]&&e[s[o]].push(i),/,/.test(t[i]))for(var l=t[i].split(","),u=0;u<l.length;u++)s[o]===l[u]&&e[s[o]].push(i);return e},removeStringFromArr:function(t,e){for(var n=t.indexOf(e);-1!==n;)t.splice(n,1),n=t.indexOf(e)},retainArrs:function(t){for(var e=[],n=0;n<t.length;n++)t[n]&&e.push(t[n]);for(var i=e.concat(),r=i.pop();i.length>0;){var o=i.pop();r=this.merageArr(r,o.concat())}return r},merageArr:function(t,e){var n=t.concat(),i=e.concat(),r=[];if(n.length<i.length){var o=n;n=i,i=o}for(;n.length>0;){arr1_item=n.pop();for(var a=0;a<i.length;a++)arr1_item===i[a]&&r.push(arr1_item)}return r},getFilterArr:function(t){var e=this.queryList;for(var n in e)if(this.filter[t].index===e[n].index)return this.queryList[n][this.filter[t].value]}});window.uniqueId=window.uniqueId||0,t(function(){window.tableObj={},window.initDynatables=function(){t(".csp-dyntable-data").each(function(){var e=t(this).html();if(e){var n=r(),i=new o({id:n,data:t.parseJSON(e),dom:t(this)});window.tableObj[n]=i}})},window.initDynatables()})})})}});