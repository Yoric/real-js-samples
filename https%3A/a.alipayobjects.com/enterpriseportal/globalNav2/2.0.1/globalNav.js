define("enterpriseportal/globalNav2/2.0.1/globalNav",["enterpriseportal/cellula/0.4.2/cellula","enterpriseportal/apps-sdk/0.0.2/sdk","enterpriseportal/enterprise2/2.0.1/enterprise","enterpriseportal/menu/0.0.5/menu","enterpriseportal/itemList/0.0.4/itemList","arale/dialog/1.2.3/dialog"],function(a,b,c){function d(a,b,c){var d,e,f;3==c.length&&(d=c.shift()),e=c.shift(),f=c.shift();var h=b.entSecondLevelMenu,i=k,j=[],m=[];return d&&g.each(h,function(a){a.appId&&a.appId==d&&j.push(a)}),d?g.each(j,function(a){f&&f==a.functionCode&&(a.current=!0),!f&&e&&e==a.productCode&&(a.current=!0),f||e||(a.current=!0),a.type==l&&(i=a.name),m.push(a)}):e&&f&&(g.each(h,function(a){return e==a.productCode&&f==a.functionCode?(d=a.appId,a.current=!0,g.breaker):void 0},null,g.breaker),g.each(h,function(a){d==a.appId&&(l==a.type&&(i=a.name),m.push(a))},null)),{top:[],sub:m.length?m:[{}],title:i}}var e=jQuery,f=a("enterpriseportal/cellula/0.4.2/cellula"),g=f._util,h=(a("enterpriseportal/apps-sdk/0.0.2/sdk"),a("enterpriseportal/enterprise2/2.0.1/enterprise")),i=a("enterpriseportal/menu/0.0.5/menu").Menu;a("enterpriseportal/itemList/0.0.4/itemList");var j=a("arale/dialog/1.2.3/dialog"),k=null,l="STATIC_TITLE_LEFT",m=new f.Class("GlobalNav",{source:"",baseURI:"https://enterpriseportal.alipay.com",session:"",subMenu:null,info:null,msgTip:null,appDropList:null,role:"",status:{subMenu:!1,accountInfo:!1,message:!1,goToTopBar:!1,navigation:!1},accountsNode:e("#J_accounts"),titleNode:e("#J_globalTitle"),subMenuMax:7,navType:"default",useGoBackToTop:"","float":"",init:function(a){this.browserUpgrade(),this._setup(a),this._bindAll("load"),this.ajustHeight(),this.source=this.baseURI+"/portal/navload.json","true"==this.session?this.login():(this.logout(),SDK.request.send({url:this.source,method:"POST",params:{action:"load"},callback:this.renderWithoutLogin,context:this})),this.registerEvents();var b=e("#J_loginLink > a");b.length>0&&-1===b.attr("href").indexOf("goto")&&b.attr("href",b.attr("href")+"?goto="+encodeURIComponent(window.location.href)),window.Smartracker&&Smartracker.sow&&Smartracker.sow()},receiver:function(a){var b=a.target;b==this.info&&this.changeStatus("accountInfo",!0,!0),b==this.msgTip&&this.changeStatus("message",!0,!0)},notify:function(a){window.__enterpriseNavgationBarNotify__&&window.__enterpriseNavgationBarNotify__(a)},changeStatus:function(a,b,c){if(g.isString(a)&&(this.status[a]=b,this.status[a]&&c&&this.notify(a+" finished!")),g.isArray(a)){var d,e=a.length;for(d=0;e>d;d++)this.status[a[d]]=b,this.status[a[d]]&&c&&this.notify(a[d]+" finished!")}this.status.navigation=this.status.subMenu&&this.status.accountInfo&&this.status.message&&this.status.goToTopBar,this.status.navigation&&this.notify("navigation finished!")},load:function(){SDK.request.send({url:this.source,method:"POST",params:{action:"load"},callback:this.render,context:this})},render:function(a){if("error"in a)return f._util.warn("cors request error!");if(a.navResult&&a.navResult.result){var b,c,g=e("#J_globalMenuPath").val();g=g.split("/"),c=d(this.role,a.navResult,g),c.sub&&(b=c.sub.slice(0,this.subMenuMax),c.title&&this.titleNode.html(c.title),this.renderSubMenu(b)),this.replaceCheckAccountLink(a.navResult.entFirstLevelMenu)}else this.logout();this.titleNode.removeClass("fn-hide")},replaceCheckAccountLink:function(a){a=a||[];var b,c,d,f;for(b=0,c=a.length;c>b;b++)if(d=a[b],d.url&&d.functionCode&&"ENT_RECONCILE_CENTER"===d.productCode){f=d.url.replace(/&amp;/g,"&");break}f&&e("#J_checkAccountLink").attr("href",f).parent().removeClass("fnn-hide")},renderWithoutLogin:function(a){if("error"in a)return f._util.warn("cors request error!");if(a.navResult&&a.navResult.result){var b,c,g=e("#J_globalMenuPath").val();g=g.split("/"),c=d(this.role,a.navResult,g),c.sub&&(b=c.sub.slice(0,this.subMenuMax),c.title&&this.titleNode.html(c.title),this.renderSubMenu(b))}else this.logout();this.titleNode.removeClass("fn-hide")},login:function(){switch(this.navType){case"simple":this.changeStatus(["subMenu","message"],!0,!1),jQuery("#J_logoTitle .title").css("cursor","auto").find("i").css("display","none");break;case"default":if(this.load(),this.msgTip=new h.MsgTip.MsgTip({key:"J_msgTip",source:this.source,baseURI:this.baseURI,role:this.role}),this.follow(this.msgTip),this.msgTip.load(),this.accountsNode.removeClass("fn-hide"),("operator"==this.role||"admin"==this.role)&&e("[data-role=J_helpLink]").css({display:"none"}),e("#J_backToOldUrl").length&&!e("#J_backToOldUrl").is("hidden"))var a=new j({trigger:"#J_backToOldUrl",width:"520px",effect:"fade",closeTpl:"关闭",classPrefix:"mi-dialog",content:e("#J_backToOldUrlBox").html()}).after("show",function(){e("#J_cancelBackToOldBtn").click(function(){a.hide()}),e("#J_backToOldBtn").click(function(){var b=window.open(e("#J_backToOldUrl").attr("href"));b.focus(),a.hide()})}).after("hide",function(){e("#J_cancelBackToOldBtn").unbind("click"),e("#J_backToOldBtn").unbind("click")});break;case"blocked":if(e("#J_backToOldUrl").length&&!e("#J_backToOldUrl").is("hidden"))var a=new j({trigger:"#J_backToOldUrl",width:"520px",effect:"fade",closeTpl:"关闭",classPrefix:"mi-dialog",content:e("#J_backToOldUrlBox").html()}).after("show",function(){e("#J_cancelBackToOldBtn").click(function(){a.hide()}),e("#J_backToOldBtn").click(function(){var b=window.open(e("#J_backToOldUrl").attr("href"));b.focus(),a.hide()})}).after("hide",function(){e("#J_cancelBackToOldBtn").unbind("click"),e("#J_backToOldBtn").unbind("click")});jQuery("#J_logoTitle .title").css("cursor","auto").find("i").css("display","none"),this.load(),this.changeStatus(["subMenu","message"],!0,!1)}this.info=new h.AccountInfo({key:"J_info",source:this.source,navType:this.navType,role:this.role}),this.follow(this.info),this.info.start()},logout:function(){this.accountsNode.removeClass("fn-hide"),jQuery("#J_logoTitle .title").css("cursor","auto").find("i").hide(),this.changeStatus(["accountInfo","message"],!0,!1),jQuery("#J_login, #J_register").removeClass("fnn-hide")},renderSubMenu:function(a){if(!g.isEmpty(a)&&a[0]&&g.isObject(a[0])){this.subMenu=new i({key:"J_subMenuUl",itemModel:h.SubMenuItem,render:function(a){var b=e(this.rootNode);if(!g.isEmpty(this.makeItems(a))){b.html("");var c,d,f=a.length;for(d=0;f>d;d++)c=a[d].id,c&&a[d].type!=l&&b.append(this.items[c].node)}var h=b.children();h.eq(0).outerHeight(),b.removeClass("fn-hide"),h.hover(function(){e(this).addClass("mi-nav-item-hover")},function(){e(this).removeClass("mi-nav-item-hover")}),this.emit("LOADED")}}),this.follow(this.subMenu),this.subMenu.render(a);var b=this;"true"==this.float&&window.setTimeout(function(){b.scroll()},700),g.each(a,function(a){return a.type==l?(this.titleNode.html(a.name),a.url&&(this.titleNode.attr("data-url",a.url).css("cursor","pointer"),this.titleNode.on("click",function(){window.location=e(this).attr("data-url")})),g.breaker):void 0},this,g.breaker)}else this.changeStatus("subMenu",!0,!1)},renderBackToTop:function(){var a=e('<div id="returnToTop" class="fn-hide"><a href="#J_header" class="return-to-top"><i class="top-outter"><i class="top-inner"></i></i><span>回顶部</span></a></div>'),b=!1;e("#J_shadowLeft").parent().prepend(a),e(window).scroll(function(){var c=e(this).scrollTop();c>150?b||(a.removeClass("fn-hide"),b=!0):(a.addClass("fn-hide"),b=!1)}),this.changeStatus("goToTopBar",!0,!0)},browserUpgrade:function(){e.browser.msie&&parseInt(e.browser.version)<8&&(e("#J_browserUpgrade").removeClass("fn-hide"),e("#J_closeUpgrade").click(function(){e("#J_browserUpgrade").addClass("fn-hide")}))},scroll:function(){var a,b=e("#J_nav"),c=e("#J_header"),d=e("#J_subMenu"),f=e("#J_subMenuUl"),g=c.outerHeight(),h=f.outerHeight(),i="movable";window.scrollTo(0,e(window).scrollTop()+1),e(window).scroll(function(){var c,j,k=e(this).scrollTop();j=f.outerHeight(),h=j>h?j:h,c=g+h,k>c?a||(d.css({top:-39}),f.css({height:"inherit"}),b.addClass(i),d.stop().animate({top:0},200),a=!0):(b.removeClass(i),a=!1)})},ajustHeight:function(){var a=e("#J_container"),b=this;a.length&&e(document).ready(function(){a.height(),"YES"==b.useGoBackToTop?b.renderBackToTop():b.changeStatus("goToTopBar",!0,!1)})},registerEvents:function(){var a=e("#J_service"),b=e("#J_ruleLink"),c=e("#J_openPlatform"),d=e("#J_logout"),f=e("#J_login"),h=e("#J_register");g.each([a,b,d,f,h,c],function(a){a.hover(function(){a.addClass("hover")},function(){a.removeClass("hover")})}),e("[data-role=J_helpLink]").each(function(){var a=e(this);a.hover(function(){a.addClass("hover")},function(){a.removeClass("hover")})})}}).inherits(f.Cell);c.exports=m});
