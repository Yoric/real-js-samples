KISSY.add("mui/datalazyload/index",function(t,e,n,i,o){var a=t.Env.host,r=a.document,f="data-ks-lazyload",l="ks-datalazyload",c="-custom",s="default",u="none",d="scroll",g="touchmove",m="resize",h=100,v=0,_;function y(t){var n=e.scrollLeft(),i=e.scrollTop();if(t.getBoundingClientRect){var o=t.getBoundingClientRect(),a=document,r=a.body,f=a&&a.documentElement,l=window.getComputedStyle&&window.getComputedStyle(t).zoom||1;n+=o.left*l-(f.clientLeft||r.clientLeft||0);i+=o.top*l-(f.clientTop||r.clientTop||0)}return{left:n,top:i}}function p(t){var e,n,i=[],o;return function(a,r){if(r!==0&&!r){r=1}if(r&1&&!n){n=true;t(function(t){e=t;while(o=i.shift()){try{o&&o.apply(null,[e])}catch(n){setTimeout(function(){throw n},0)}}})}if(e){a&&a.apply(null,[e]);return e}if(!(r&2)){a&&i.push(a)}return e}}function b(e,n,i){var o,a=0,r=0,n=n||150;function f(){if(o){o.cancel();o=0}a=t.now();e.apply(i||this,arguments);r=t.now()}return t.mix(function(){if(!a||r>=a&&t.now()-r>n||r<a&&t.now()-a>n*8){f()}else{if(o){o.cancel()}o=t.later(f,n,0,null,arguments)}},{stop:function(){if(o){o.cancel();o=0}}})}function w(t,e,n){var i=t.length;function o(){i?t[--i].call(null,e,o):n(e)}o()}function A(t,n,i){if(!t.offsetWidth){return false}var o=y(t),a=window.getComputedStyle&&window.getComputedStyle(t).zoom||1,r=true,f,l=o.left,c=o.top,s={left:l,top:c,right:l+(t._ks_lazy_width||(t._ks_lazy_width=e.outerWidth(t)*a)),bottom:c+(t._ks_lazy_height||(t._ks_lazy_height=e.outerHeight(t)*a))};f=R(n,s);if(f&&i){r=R(i,s)}return r&&f}function k(t){if(/^(loaded|complete)$/.test(document.readyState)){return t()}if(window.addEventListener){return window.addEventListener("load",t,false)}if(window.attachEvent){return window.attachEvent("onload",t)}}function S(t){var e=["webkit",""],n=r.createElement("div"),i=e.length;for(var i=0,a=e.length;i<a;i++){if(!e[i]){t=t.toLowerCase()}if(n.style[e[i]+t]!==o){return true}}return false}function I(e,n){var i=this;if(!(i instanceof I)){return new I(e,n)}var o=e;if(!t.isPlainObject(o)){o=n||{};if(e){o.container=e}}I.superclass.constructor.call(i,o);i._diffRatio=0;i._callbacks={};i._startLis=[];i._containerIsNotDocument=i.get("container").nodeType!=9;i._fade=S("Animation")&&!(/Android (\d+\.\d+)/i.test(a.navigator.userAgent)&&parseFloat(RegExp["$1"])<4.3);if(t.isArray(o.container)){i._backCompact=1}i["_initLoadEvent"]();o.container&&i.addElements(o.container);i._loadFn();t.ready(function(){i._loadFn()});k(function(){i._diffRatio=Math.max(t.UA.ios?2:1,i._diffRatio);i._loadFn()});i.resume();i.on("afterDiffChange",function(t){if(t.newVal===t.prevVal)return;i._windowRegion=i["_getBoundingRect"]();if(!i._backCompact&&i._containerIsNotDocument){i._containerRegion=i["_getBoundingRect"](i.get("container"))}})}I.ATTRS={diff:{value:s},placeholder:{value:window.ActiveXObject&&!document.documentMode?"//g.alicdn.com/s.gif":"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="},execScript:{value:true},fade:{value:true},container:{setter:function(n){n=n||r;if(t.isWindow(n)){n=n.document}else{n=e.get(n);if(e.nodeName(n)=="body"){n=n.ownerDocument}}return n},valueFn:function(){return r}},autoDestroy:{value:true},onStart:{value:null}};function R(t,e){var n={};n.top=Math.max(t.top,e.top);n.bottom=Math.min(t.bottom,e.bottom);n.left=Math.max(t.left,e.left);n.right=Math.min(t.right,e.right);return n.bottom>=n.top&&n.right>=n.left}t.extend(I,i,{addStartListener:function(e){var n=this._startLis;if(!e||t.indexOf(e,n)>=0){return}n.push(e)},_initLoadEvent:function(){var i=this,o=i.get("autoDestroy");i.addStartListener(function(t,e){var n=i.get("onStart");if(n){var o=n.apply(this,arguments);if(o===true||o===false){t.returnValue=o}}e()});i.addStartListener(function(e,n){if(e.type!="img"){n();return}var o=i.get("webpReplacer");if(t.isFunction(o)){t.use("mui/datalazyload/webp",function(t,i){i.isSupport(function(t){if(t){e.src=o(e.src)}n()})})}else{n()}});i.imgHandle=function(){var t=this,o=i.get("imgFlag")||f,a=t.getAttribute(o);w(i._startLis,{type:"img",elem:t,src:a},function(a){if(a.returnValue===false){return}if(a.src&&t.src!=a.src){if(i.isFade){var r="img-ks-lazyload",f="img-ks-beforeload";e.addClass(t,f);n.on(t,"load",function(){n.detach(t,"load",arguments.callee);e.removeClass(t,f);e.addClass(t,r);i.refresh()})}t.src=a.src}t.removeAttribute(o)})};i.bgimgHandle=function(){var t=this,e=(i.get("imgFlag")||f)+"-bg",n=t.getAttribute(e);w(i._startLis,{type:"bgimg",elem:t,bgimgSrc:n},function(n){if(n.returnValue===false){return}if(n.bgimgSrc){var i=t&&t.filters,o,a;try{o=i&&i.item("DXImageTransform.Microsoft.AlphaImageLoader");a=i&&i.item("DXImageTransform.Microsoft.Matrix")}catch(r){}if(o){o.src=n.bgimgSrc;o.enabled=true;function f(t,e){var n=new Image;n.style.position="absolute";n.style.visibility="visible";n.onload=n.onerror=function(){e(n);document.body.removeChild(n);n=null};document.body.appendChild(n);n.src=t}if(!a||!t.offsetWidth||!t.offsetHeight){return}f(n.bgimgSrc,function(e){if(!e.offsetWidth||!e.offsetHeight){return}var n=t.currentStyle["background-size"]=="cover"?"cover":"contain";if(e.offsetHeight/e.offsetWidth>t.offsetHeight/t.offsetWidth===(n=="contain")){a.M11=t.offsetHeight*e.offsetWidth/(t.offsetWidth*e.offsetHeight);a.M22=1;a.Dx=t.offsetWidth*(1-a.M11)/2;a.Dy=0}else{a.M11=1;a.M22=t.offsetWidth*e.offsetHeight/(t.offsetHeight*e.offsetWidth);a.Dx=0;a.Dy=t.offsetHeight*(1-a.M22)/2}a.enabled=true})}else{t.style.backgroundImage="url("+n.bgimgSrc+")"}}t.removeAttribute(e)})};i.textareaHandle=function(){var t=this;t.style.display=u;t.className="";var n=e.create("<div>");t.parentNode.insertBefore(n,t);w(i._startLis,{type:"textarea",elem:t,value:t.value},function(t){if(t.returnValue===false){return}e.html(n,t.value,i.get("execScript"));i.addElements(n);i.refresh()})};i._loadFn=b(function(){if(o&&t.isEmptyObject(i._callbacks)){i.destroy()}i["_loadItems"]()},h,i);i._onScroll=function(e){i._onScroll=i._loadFn;i._diffRatio=Math.max(t.UA.ios?4:2,i._diffRatio);i._loadFn()}},refresh:function(){this._loadFn()},_loadItems:function(){var e=this,n=e.get("container");if(e._containerIsNotDocument&&!n.offsetWidth){return}e._windowRegion=e["_getBoundingRect"]();if(!e._backCompact&&e._containerIsNotDocument){e._containerRegion=e["_getBoundingRect"](e.get("container"))}t.each(e._callbacks,function(t,n){t&&e._loadItem(n,t)})},_loadItem:function(t,e){var n=this,e=e||n._callbacks[t];if(!e){return true}var i=e.el,o=false,a=e.fn;if(n.get("force")||A(i,n._windowRegion,n._containerRegion)){try{o=a.call(i)}catch(r){setTimeout(function(){throw r},0)}}if(o!==false){delete n._callbacks[t]}return o},addCallback:function(n,i){n=e.get(n);var o=this,a=o._callbacks,r={el:n||document,fn:i||t.noop},f=++v;a[f]=r;if(o._windowRegion){o._loadItem(f,r)}else{o.refresh()}return f},removeCallback:function(n,i){n=e.get(n);var o=this._callbacks;t.each(o,function(t,e){if(t.el==n&&(i?t.fn==i:1)){delete o[e]}})},getElements:function(){var e=this,n=[],i=[],o=e._callbacks;t.each(o,function(t){if(t.fn==e.imgHandle){n.push(t.el)}if(t.fn==e.textareaHandle){i.push(t.el)}});return{images:this._images,textareas:this._textareas}},addElements:function(n,i){if(typeof n=="string"){n=e.query(n)}else if(!t.isArray(n)){n=[n]}var o=this;o._addStyle();t.each(n,function(n){if(!n){return}if(!i||i==="img"){t.each(t.filter([n].concat(e.query("img",n)),function(t){return t.getAttribute&&t.getAttribute(o.get("imgFlag")||f)},o),function(t){var e=o.addCallback(t,o.imgHandle);if(!t.offsetWidth){t.onload=t.onerror=function(){setTimeout(function(){o._loadItem(e)},0)};if(!t.src){o.onPlaceHolder=o.onPlaceHolder||p(function(t){var e=o._phImg=new Image,n=o.get("placeholder");e.onload=e.onerror=function(){t(n)};e.src=n});o.onPlaceHolder(function(e){if(!t.src){t.src=e}})}}})}if(!i||i==="bgimg"){var a=(o.get("imgFlag")||f)+"-bg";t.each(t.filter([n].concat(e.query("["+a+" ]",n)),function(t){return t.getAttribute&&t.getAttribute(a)},o),function(t){o.addCallback(t,o.bgimgHandle)})}if(!i||i==="textarea"){t.each(e.query("textarea."+(o.get("areaFlag")||l),n),function(t){o.addCallback(t,o.textareaHandle)})}})},removeElements:function(n){if(typeof n=="string"){n=e.query(n)}else if(!t.isArray(n)){n=[n]}var i=this,o=i._callbacks;t.each(o,function(e,i){if(t.inArray(e.el,n)){delete o[i]}})},_getBoundingRect:function(n){var i,a,r,f;if(n!==o){i=e.outerHeight(n);a=e.outerWidth(n);var l=y(n);r=l.left;f=l.top}else{i=e.viewportHeight();a=e.viewportWidth();r=e.scrollLeft();f=e.scrollTop()}var c=this.get("diff"),u=this._diffRatio;if(c===s){c={left:0,top:0,right:a*u,bottom:i*u}}else if(!t.isObject(c)){c={left:c,top:c,right:c,bottom:c}}return{left:r-(c.left||0),top:f-(c.top||0),right:r+a+(c.right||0),bottom:f+i+(c.bottom||0)}},pause:function(){var t=this,e=t._onScroll,i=t._loadFn;if(t._destroyed){return}n.remove(a,d,e);n.remove(a,g,e);n.remove(a,m,i);i.stop();if(t._containerIsNotDocument){var o=t.get("container");n.remove(o,d,e);n.remove(o,g,e)}},resume:function(){var t=this,e=t._onScroll,i=t._loadFn;if(t._destroyed){return}n.on(a,d,e);n.on(a,g,e);n.on(a,m,i);if(t._containerIsNotDocument){var o=t.get("container");n.on(o,d,e);n.on(o,g,e)}},destroy:function(){var e=this;e.pause();e._callbacks={};t.log("datalazyload is destroyed!");e.fire("destroy");e._destroyed=1},_addStyle:function(){var t=this;if(t._fade){t.isFade=t.get("fade");if(t.isFade&&!_){_=true;e.addStyleSheet("@-webkit-keyframes ks-fadeIn{0%{opacity:0}100%{opacity:1}}"+"@keyframes ks-fadeIn{0%{opacity:0}100%{opacity:1}}"+".img-ks-lazyload{-webkit-animation:ks-fadeIn 350ms linear 0ms 1 normal both;animation:ks-fadeIn 350ms linear 0ms 1 normal both;opacity:1}"+".img-ks-beforeload{opacity:0}")}}}});function C(n,i,o,a){if(i==="img-src"){i="img"}if(!t.isArray(n)){n=[e.get(n)]}var s=new I(r,{});s.set("imgFlag",o||f+c);s.set("areaFlag",o||l+c);s.set("onStart",a);s.set("force",true);s.addElements(n,i)}I.loadCustomLazyData=C;var H;I.instance=function(){return H||(H=new I(null,{autoDestroy:false}))};t.DataLazyload=I;return I},{requires:["dom","event","base"]});