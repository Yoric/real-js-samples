KISSY.add("mui/bucket/tool",function(t){function e(t,e){e=e||0;return Math.random()*t+e}function n(t){var e=new Date;e.setDate(1);e.setMonth((t||e.getMonth())+1);var n=new Date(e.getTime()-1e3*60*60*24);return n.getDate()}var a;function i(){if(!a){this.lastReadDay_RandomHash=0;this.randomHash=2146271213;a=this}return a}i.prototype.analyzeBucketHash=function(t,e){var n=this.time33Hash(t);return this.bucket(n,e)};i.prototype.bucket=function(t,e){return(t&65535)%e};i.prototype.time33Hash=function(t){var e=2146271213;for(var n=0,a=t.length;n<a;n++){e=(e<<5)+e+t.charCodeAt(n)}return e};i.prototype.getRandomByDay=function(){var t=n();if(t!=this.lastReadDay_RandomHash){this.randomHash=e();this.lastReadDay_RandomHash=t}return this.randomHash};i.prototype.getHashCode=function(t,e,n){for(var a=0,i=e.length;a<i;a++){t=(t<<5)+t+e.charCodeAt(a)}return(t&65535)%n+1};return i});
KISSY.add("mui/bucket/index",function(t,e,n,i,r){function a(t){a.superclass.constructor.call(this,t||{})}t.extend(a,e,{pluginInitializer:function(t){this.set("caller",t);this.init()},init:function(){var e=this,i=this.getCurBt(),r=this.get("cfgUrl"),a=this.get("callback"),c=this.get("cfgs"),l=function(n){var c=e.getCurBt();if(c!==i){t.log("mui/bucket::current bucket id is changed! It is "+i);r&&o(r,i=c);return}if(!n||!a)return;var l=[],f=[];for(var g=0,h=n.length,d;g<h;g++){d=n[g];d["bts"]=s(u(t.trim(d["bts"])),-1,e.get("size")-1);var p=d["bts"].split(",");if(t.inArray(""+i,p)||p.length==0||t.inArray("-1",p)){var b=d["st"].split(/[-/.]/),k=+new Date(b[0],parseInt(b[1],10)-1+"",b[2],0,0,0),v=new Date((b=d["nd"].split(/[-/.]/))[0],parseInt(b[1],10)-1+"",b[2],0,0,0),m=+new Date;v.setDate(v.getDate()+1);v=v.getTime();if(m>=k&&m<v){l.push(d["id"]);f.push(d)}}}a(l,f,i)},o=function(t,r){n.jsonp(t||e.get("cfgUrl"),{bucket_id:r||i},l)};t.log("mui/bucket::current bucket id: "+i);if(r){o(r,i)}else if(c){l(c)}},getCurBt:function(){var e=t.unparam(location.search.substr(1))["bucket_id"],n=this.get("size");if(typeof e=="undefined"){e=(new r).analyzeBucketHash(i.get("t")||"",n)}else{e=parseInt(e,10);if(isNaN(e)||e<-1||e>=n){t.log("mui/bucket::the parameter `bucket_id` in the url is illegal and the reasonable interval is -1"+" to "+n+". So program calculates the bucket id with internal bucket tool.","warn");e=(new r).analyzeBucketHash(i.get("t")||"",n)}}return e}},{ATTRS:{callback:{value:undefined,setter:function(t){return t&&typeof t==="function"?t:undefined}},size:{value:20,setter:function(t){return Math.abs(parseInt(t,10))||20}},cfgUrl:{value:""},cfgs:{value:undefined,setter:function(e){return t.isArray(e)&&e.length!==0?e:undefined}}}});function u(t){return(t||"").replace(/[^0-9-,]/gi,"")}function s(t,e,n){return(t||"").replace(/(\d+)-(\d+)/gi,function(t,i,r){var a=parseInt(i,10),u=parseInt(r,10),s,c=[];if(a>u){s=a;a=u;u=s}a=Math.max(a,e);u=Math.min(u,n);do{c.push(a++)}while(a<=u);return c.join(",")})}return a},{requires:["base","ajax","cookie","mui/bucket/tool"]});KISSY.add("mui/bucket/tool",function(t){function e(t,e){e=e||0;return Math.random()*t+e}function n(t){var e=new Date;e.setDate(1);e.setMonth((t||e.getMonth())+1);var n=new Date(e.getTime()-1e3*60*60*24);return n.getDate()}var a;function i(){if(!a){this.lastReadDay_RandomHash=0;this.randomHash=2146271213;a=this}return a}i.prototype.analyzeBucketHash=function(t,e){var n=this.time33Hash(t);return this.bucket(n,e)};i.prototype.bucket=function(t,e){return(t&65535)%e};i.prototype.time33Hash=function(t){var e=2146271213;for(var n=0,a=t.length;n<a;n++){e=(e<<5)+e+t.charCodeAt(n)}return e};i.prototype.getRandomByDay=function(){var t=n();if(t!=this.lastReadDay_RandomHash){this.randomHash=e();this.lastReadDay_RandomHash=t}return this.randomHash};i.prototype.getHashCode=function(t,e,n){for(var a=0,i=e.length;a<i;a++){t=(t<<5)+t+e.charCodeAt(a)}return(t&65535)%n+1};return i});