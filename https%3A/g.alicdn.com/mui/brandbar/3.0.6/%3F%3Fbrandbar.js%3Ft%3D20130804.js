KISSY.add("mui/brandbar/brandbar",function(e,t,a){var n={show:function(n){var r=this,o=r.domEl;n=n||{};r.cancelFly=n.cancelFly;if(!o){t.addStyleSheet("#J_BrandBar{font-size:12px;cursor:pointer;background-color:#EEEEEE;width:120px;margin:2px 5px 0 5px;height:28px;border:solid 1px #d0d0d0;-moz-border-radius: 3px 3px 0px 0px;-khtml-border-radius: 3px 3px 0px 0px;-webkit-border-radius: 3px 3px 0px 0px;border-radius: 3px 3px 0px 0px;}"+"#J_BrandBar:hover,#J_BrandBar.hoverBrandBar{background-color:#d9d1d1;border-color:#bcb0b0}"+'.BrandFlyer{width:20px;height:20px;float:left;margin:4px 0px 4px 12px;background:url(//img.alicdn.com/tps/i2/T1KMGHXC4dXXcu5FDa-20-20.png);background-repeat:no-repeat;*background:none;*filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=noscale, src="//img.alicdn.com/tps/i2/T1KMGHXC4dXXcu5FDa-20-20.png");zoom:1;}'+'.BrandPopup{cursor:pointer;background:url(//img.alicdn.com/tps/i1/T1wW9HXAdfXXcH0rHA-152-131.png);background-repeat:no-repeat;*background:none;*filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=noscale, src="//img.alicdn.com/tps/i1/T1wW9HXAdfXXcH0rHA-152-131.png");background-size:100% 100%;}'+"#J_BrandBar a,#J_BrandBar a:hover{line-height:20px;display:block;margin:4px 4px 4px 0;float:left;color:#181818;text-decoration:none;}");o=r.domEl=t.create('<div id="J_BrandBar" order="20">');var i=n.urlMyBrand||"//mybrand.tmall.com/";t.html(o,'<div class="BrandFlyer"></div><a href="'+i+'" target="'+(n.newWindow?' target="_blank"':"")+'">\u6211\u5173\u6ce8\u7684\u54c1\u724c</a>');a.on(o,"click",function(e){if(e.target.nodeName!="A"){var a=t.get("a",o);if(a.click){a.click()}else if(document.createEvent){var n=document.createEvent("MouseEvents");n.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);a.dispatchEvent(n)}}else{(new Image).src="//log.mmstat.com/tmallbrand.1001.1.2.3"}});if(e.UA.ie==6){a.on(o,"mouseenter",function(){t.addClass(o,"hoverBrandBar")});a.on(o,"mouseleave",function(){t.removeClass(o,"hoverBrandBar")})}}e.use("mui/bottombar",function(e,a){a=a||e["mui/bottombar"];t.append(t.create("<div>",{css:{width:"23px",height:"13px",left:"87px",top:"-6px",position:"absolute",background:"url(//img.alicdn.com/tps/i3/T1Zs7TXiNcXXbmSHkB-191-207.png) no-repeat",backgroundPosition:"-158px -75px"}}),o);a.add(o)})},setClass:function(e,a){if(!t.hasClass(e,"ui-brand-btn")){return}a=a===undefined?e._hover:a;var n=t.hasClass(e,"ui-brand-collected")?a?"\u53d6\u6d88":"\u5df2\u5173\u6ce8":t.hasClass(e,"ui-brand-btn-ex-s")&&t.hasClass(e,"ui-brand-btn-ex-bubble")?"\u5173\u6ce8\u54c1\u724c":"\u5173\u6ce8";t.text(t.get("span",e),n)},bindEl:function(n,r){r=r||{};var o=this,i=r.attrName||"data-brandid";var c=a.delegate||function(n,r,o,i,c){a.on(n,r,function(a){var r=false;e.each(t.query(o,n),function(e){if(!r&&(e==a.target||t.contains(e,a.target))){r=true}});if(!r){return}i&&i.apply(this,arguments)},c)};c(document,"click",n,function(e){e.preventDefault();if(e.brandCooked){return}e.brandCooked=true;var a=e.target;while(a&&!(brandId=t.attr(a,i))){a=t.parent(a)}if(!a){return}o.flyAdd(a,brandId,r)});var l=[];e.each(t.query(n),function(e){var n=t.attr(e,i);if(n&&t.hasClass(e,"ui-brand-btn")){l.push(n);a.on(e,"mouseenter",function(){o.setClass(e,e._hover=true)});a.on(e,"mouseleave",function(){o.setClass(e,e._hover=false)})}});if(l[0]){e.use("mui/wishlist",function(e,a){a.queryBrand({ids:l},function(a){e.each(t.query(".j_CollectBrandNum"),function(n){var r=t.attr(n,i);e.each(a.result,function(e){if(e.brandId==r){t.text(n,e.popularity)}})});e.each(t.query(n),function(n){var r=t.attr(n,i);e.each(a.result,function(e){if(e.brandId==r&&e.isMyBrand&&t.hasClass(n,"ui-brand-btn")){t.addClass(n,"ui-brand-collected");o.setClass(n,false)}})})})})}},flyAdd:function(t,a,n){var r=this;e.use("mui/brandbar/fly",function(e,o){o.cancelFly=r.cancelFly;e.mix(r,o);r.flyAdd(t,a,n)})}};e.mix(n,e.EventTarget);return n},{requires:["dom","event"]});