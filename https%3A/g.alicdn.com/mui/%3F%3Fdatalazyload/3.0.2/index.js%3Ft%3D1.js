KISSY.add("mui/datalazyload/index",function(t,e,n,o,i){var a=t.Env.host,r=a.document,c="data-ks-lazyload",l="ks-datalazyload",u="-custom",f="default",s="none",d="scroll",m="touchmove",g="resize",h=100,v=0;function _(t){var n=e.scrollLeft(),o=e.scrollTop();if(t.getBoundingClientRect){var i=t.getBoundingClientRect(),a=document,r=a.body,c=a&&a.documentElement,l=window.getComputedStyle&&window.getComputedStyle(t).zoom||1;n+=i.left*l-(c.clientLeft||r.clientLeft||0);o+=i.top*l-(c.clientTop||r.clientTop||0)}return{left:n,top:o}}function p(t){var e,n,o=[],i;return function(a,r){if(r!==0&&!r){r=1}if(r&1&&!n){n=true;t(function(t){e=t;while(i=o.shift()){try{i&&i.apply(null,[e])}catch(n){setTimeout(function(){throw n},0)}}})}if(e){a&&a.apply(null,[e]);return e}if(!(r&2)){a&&o.push(a)}return e}}function y(e,n,o){var i,a=0,r=0,n=n||150;function c(){if(i){i.cancel();i=0}a=t.now();e.apply(o||this,arguments);r=t.now()}return t.mix(function(){if(!a||r>=a&&t.now()-r>n||r<a&&t.now()-a>n*8){c()}else{if(i){i.cancel()}i=t.later(c,n,0,null,arguments)}},{stop:function(){if(i){i.cancel();i=0}}})}var A=function(e,n,o,i){n=n||c;var a=e.getAttribute(n),r={type:"img",elem:e,src:a},l=!t.isFunction(o)||o(r)!==false;if(l&&r.src){function u(t){if(e.src!=t){e.src=t}e.removeAttribute(n)}if(t.isFunction(i)){t.use("mui/datalazyload/webp",function(t,e){e.isSupport(function(t){u(t?i(r.src):r.src)})})}else{u(r.src)}}};function b(n,o,i){n.style.display=s;n.className="";var a=e.create("<div>");n.parentNode.insertBefore(a,n);var r=n.value;if(t.isFunction(i)){var c=i({type:"textarea",elem:n,value:r});if(c){r=c}}e.html(a,r,o);return a}function w(t,n,o){if(!t.offsetWidth){return false}var i=_(t),a=window.getComputedStyle&&window.getComputedStyle(t).zoom||1,r=true,c,l=i.left,u=i.top,f={left:l,top:u,right:l+(t._ks_lazy_width||(t._ks_lazy_width=e.outerWidth(t)*a)),bottom:u+(t._ks_lazy_height||(t._ks_lazy_height=e.outerHeight(t)*a))};c=I(n,f);if(c&&o){r=I(o,f)}return r&&c}function k(e,n){var o=this;if(!(o instanceof k)){return new k(e,n)}var i=e;if(!t.isPlainObject(i)){i=n||{};if(e){i.container=e}}k.superclass.constructor.call(o,i);o._callbacks={};o._containerIsNotDocument=o.get("container").nodeType!=9;if(t.isArray(i.container)){o._backCompact=1}o["_initLoadEvent"]();i.container&&o.addElements(i.container);o._loadFn();t.ready(function(){o._loadFn()});o.resume()}k.ATTRS={diff:{value:f},placeholder:{value:window.ActiveXObject&&!document.documentMode?"//g.alicdn.com/s.gif":"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="},execScript:{value:true},container:{setter:function(n){n=n||r;if(t.isWindow(n)){n=n.document}else{n=e.get(n);if(e.nodeName(n)=="body"){n=n.ownerDocument}}return n},valueFn:function(){return r}},autoDestroy:{value:true},onStart:{value:null}};function I(t,e){var n={};n.top=Math.max(t.top,e.top);n.bottom=Math.min(t.bottom,e.bottom);n.left=Math.max(t.left,e.left);n.right=Math.min(t.right,e.right);return n.bottom>=n.top&&n.right>=n.left}t.extend(k,o,{_initLoadEvent:function(){var e=this,n=e.get("autoDestroy");e.imgHandle=function(){A(this,e.get("imgFlag"),e.get("onStart"),e.get("webpReplacer"))};e.textareaHandle=function(){e.addElements(b(this,e.get("execScript"),e.get("onStart")))};e._loadFn=y(function(){if(n&&t.isEmptyObject(e._callbacks)){e.destroy()}e["_loadItems"]()},h,e)},refresh:function(){this._loadFn()},_loadItems:function(){var e=this,n=e.get("container");if(e._containerIsNotDocument&&!n.offsetWidth){return}e._windowRegion=e["_getBoundingRect"]();if(!e._backCompact&&e._containerIsNotDocument){e._containerRegion=e["_getBoundingRect"](e.get("container"))}t.each(e._callbacks,function(t,n){t&&e._loadItem(n,t)})},_loadItem:function(t,e){var n=this,e=e||n._callbacks[t];if(!e){return true}var o=e.el,i=false,a=e.fn;if(n.get("force")||w(o,n._windowRegion,n._containerRegion)){try{i=a.call(o)}catch(r){setTimeout(function(){throw r},0)}}if(i!==false){delete n._callbacks[t]}return i},addCallback:function(n,o){n=e.get(n);var i=this,a=i._callbacks,r={el:n||document,fn:o||t.noop},c=++v;a[c]=r;if(i._windowRegion){i._loadItem(c,r)}else{i.refresh()}return c},removeCallback:function(n,o){n=e.get(n);var i=this._callbacks;t.each(i,function(t,e){if(t.el==n&&(o?t.fn==o:1)){delete i[e]}})},getElements:function(){var e=this,n=[],o=[],i=e._callbacks;t.each(i,function(t){if(t.fn==e.imgHandle){n.push(t.el)}if(t.fn==e.textareaHandle){o.push(t.el)}});return{images:this._images,textareas:this._textareas}},addElements:function(n,o){if(typeof n=="string"){n=e.query(n)}else if(!t.isArray(n)){n=[n]}var i=this;t.each(n,function(n){if(!n){return}if(!o||o==="img"){t.each(t.filter([n].concat(e.query("img",n)),function(t){return t.getAttribute&&t.getAttribute(i.get("imgFlag")||c)},i),function(t){var e=i.addCallback(t,i.imgHandle);if(!t.offsetWidth){t.onload=t.onerror=function(){setTimeout(function(){i._loadItem(e)},0)};if(!t.src){i.onPlaceHolder=i.onPlaceHolder||p(function(t){var e=i._phImg=new Image,n=i.get("placeholder");e.onload=e.onerror=function(){t(n)};e.src=n});i.onPlaceHolder(function(e){if(!t.src){t.src=e}})}}})}if(!o||o==="textarea"){t.each(e.query("textarea."+(i.get("areaFlag")||l),n),function(t){i.addCallback(t,i.textareaHandle)})}})},removeElements:function(n){if(typeof n=="string"){n=e.query(n)}else if(!t.isArray(n)){n=[n]}var o=this,i=o._callbacks;t.each(i,function(e,o){if(t.inArray(e.el,n)){delete i[o]}})},_getBoundingRect:function(n){var o,a,r,c;if(n!==i){o=e.outerHeight(n);a=e.outerWidth(n);var l=_(n);r=l.left;c=l.top}else{o=e.viewportHeight();a=e.viewportWidth();r=e.scrollLeft();c=e.scrollTop()}var u=this.get("diff"),s=u===f?a:u,d=0,m=s,g=u===f?o:u,h=0,v=g,p=r+a,y=c+o;if(t.isObject(u)){d=u.left||0;m=u.right||0;h=u.top||0;v=u.bottom||0}r-=d;p+=m;c-=h;y+=v;return{left:r,top:c,right:p,bottom:y}},pause:function(){var t=this,e=t._loadFn;if(t._destroyed){return}n.remove(a,d,e);n.remove(a,m,e);n.remove(a,g,e);e.stop();if(t._containerIsNotDocument){var o=t.get("container");n.remove(o,d,e);n.remove(o,m,e)}},resume:function(){var t=this,e=t._loadFn;if(t._destroyed){return}n.on(a,d,e);n.on(a,m,e);n.on(a,g,e);if(t._containerIsNotDocument){var o=t.get("container");n.on(o,d,e);n.on(o,m,e)}},destroy:function(){var e=this;e.pause();e._callbacks={};t.log("datalazyload is destroyed!");e.fire("destroy");e._destroyed=1}});function x(n,o,i,a){if(o==="img-src"){o="img"}if(!t.isArray(n)){n=[e.get(n)]}var f=new k(r,{});f.set("imgFlag",i||c+u);f.set("areaFlag",i||l+u);f.set("onStart",a);f.set("force",true);f.addElements(n,o)}k.loadCustomLazyData=x;t.DataLazyload=k;return k},{requires:["dom","event","base"]});