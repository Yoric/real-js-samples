KISSY.add("malldetail/tabbar/tabbar",function(e,t,a,i){function n(a){var n=[{"id":"description","tit":"\u5546\u54c1\u8be6\u60c5"}],o=[],r=t.query("div.J_DetailSection","#J_Detail");e.each(r,function(e){var o,r=t.get("h4.hd",e);if(e.id&&r&&(o=r.innerHTML)){if("J_TabRecommends"===e.id||"J_DealRecord"===e.id&&i.bucketStat(a.bucketId,c.monthlySalesBucketTestIdArray))return!0;n.push({"id":e.id,"tit":o})}}),e.each(n,function(e,t){o.push('<li tabindex="0" role="tab"'+(e.id==a.defSeletedId?' class="'+s+'" aria-selected="true"  ':'aria-selected="false"')+'><a tabindex="-1" href="#'+e.id+'" rel="nofollow" hidefocus="true" data-index="'+t+'">'+e.tit+"</a></li>")}),a.footer&&o.push(a.footer),a.node.appendChild(t.create(o.join("")))}var o,r,l,c=window.g_config,s="tm-selected",d=undefined;return{"init":function(i){codeTrack("mod.tabbar.init","view.mainBody.init");var d=i.product;if(o=i.ulNode,r=t.parent(o),l=i.contEl,o&&l){var u=t.parent(o,2),m=this;t.css("#J_TabBarBox",{"width":t.width(u)-2+"px"}),d.onLoad(["config","itemDO","bucketId","deviceType","internationalComponent"],function(p,f,h,v,g){function b(){t.offset(r).top-t.scrollTop()>100||(a.remove(window,"scroll",b),e.use("malldetail/control/floatbar",function(e,a){var i=null,n=t.get("#bd");n&&"1190"===c.pw&&e.use("malldetail/body/floatcartlink",function(e,t){d.onLoad(["config"],function(e){i=t,i.init({"relEl":n,"parentEl":document.body,"detail":e.detail})})});var o;m.floatBar=m.floatBar||new a({"el":r,"onChange":function(e){e?(o?o.style.display="block":(o=t.create('<div class="tabbar-bg"></div>'),t.insertAfter(o,r)),setTimeout(function(){m.floatBar.isFloating()&&i&&i.show()},128)):(o.style.display="none",i&&i.hide())}}),codeTrack("mod.tabbar.float","mod.tabbar.show")}))}var y;if("pad"!==v&&t.css("#J_TabBarBox",{"width":t.width(u)-2+"px"}),512&c.bizTag&&window.screen.width<1260&&(y='<li class="r"><a href="//list.tmall.com/spu_detail.htm?spuid='+f.spuId+"&auction_tag=13058&brandSiteId="+f.brandSiteId+'" target="_blank">\u53bb\u770b\u552e\u5356\u8fd9\u6b3e\u5546\u54c1\u7684\u5176\u4ed6\u5546\u5bb6&gt;&gt;</a></li>'),n({"node":o,"footer":y,"defSeletedId":"description","bucketId":h}),p.detail.shopSameCategoryUrl){var k='<li class="tm-shop-list" data-spm="1997732925"><a href="'+p.detail.shopSameCategoryUrl+'" target="_blank">\u672c\u5e97\u540c\u7c7b\u5546\u54c1</a></li>';t.append(t.create(k),o)}if(g&&g.faq){var k='<li role="tab"><a href="'+g.faq+'" target="_blank">FAQ</a></li>';t.append(t.create(k),o)}128&c.bizTag||!c.showDetailQrcode||(codeTrack("mod.qrcode.init","mod.tabbar.init"),d.onLoad(["itemPrice","config","memberMultiPoint","itemDO"],function(e,i,n,r){if(!i.isTripUser){var l,c="";n?(l='<span class="ptip">\u624b\u673a\u5929\u732b\u8d2d\u4e70<br />\u9001<strong>'+n+"</strong>\u79ef\u5206\u8d77</span>",c="has2line"):l=e&&e.hasMobileProm?"\u626b\u626b\u4eab\u624b\u673a\u4e13\u4eab\u4ef7":"\u624b\u673a\u8d2d\u4e70";var s,d,u=t.create('<li class="tm-qrcode-icon '+c+'"><a class="tm-qr-togger">'+l+"</a></li>");t.append(u,o),setTimeout(function(){a.fire(u,"mouseover"),setTimeout(function(){a.fire(u,"mouseout")},1e4)},5)}codeTrack("mod.qrcode.show","mod.qrcode.init"),a.on(u,"mouseover mouseout",function(e){s&&clearTimeout(s),s=setTimeout(function(){"mouseover"==e.type?(d||(d=t.create('<img class="tm-qrcode-pic"/>'),t.append(d,u),d.src=TShop.getQrURL({"itemId":r.itemId,"mmstat":"detail_pctab"}),codeTrack("mod.qrcode.hover","mod.qrcode.show")),TShop.sendAtpanel("tmalldetail.32.2"),t.show(d)):t.hide(d)},300)})})),d.onChange("reviewCount",function(a){null!=a.rateTotal&&e.each(t.query("#J_TabBar em.J_ReviewsCount"),function(e){e.innerHTML=a.rateTotal,t.show(e)})});var _=t.get(".J_TDealCount","#J_TabBar");_&&d.onChange("sellCount",function(e){e&&"number"==typeof e.sellCount&&(_.innerHTML=e.sellCount,t.show(t.parent(_,".J_MonSales")))}),m.handles=[],a.on(o,"click",function(e){var a=e.target;if("LI"===a.nodeName&&(a=t.get("a",a)),"UL"!==a.nodeName){for(;"A"!==a.nodeName;)a=a.parentNode;void 0!==t.attr(a,"data-index")&&(e.preventDefault(),m.switchTo(a.href.split("#")[1]),m.floatBar&&m.floatBar.isFloating()&&m.scrollIntoView())}},m),e.each(o.getElementsByTagName("a"),function(e){var a=e.href.split("#")[1],i=t.parent(e,"li");m.onSwitch(function(e){a==e?(t.addClass(i,s),t.attr(i,"aria-selected",!0)):(t.removeClass(i,s),t.attr(i,"aria-selected",!1))})});var T;m.onSwitch(function(a,n){T||(T={},e.each(o.getElementsByTagName("a"),function(e){var a=e.href.split("#")[1];T[a]=t.get("#"+a,l)})),e.each(T,function(e,i){i==n?t.removeClass(e,"tm-curTab"):i==a&&t.addClass(e,"tm-curTab"),t.addClass("#J_TabRecommends","tm-curTab")}),"description"!=a&&d.onLoad(["config"],function(a){if(a&&a.itemDO&&a.itemDO.showCompanyPurchase&&a.itemDO.isEnterprisePath)return!1;if("1190"==c.pw&&!(512&c.bizTag)){var n=t.get("#col-extra");n||(n=t.create('<div id="col-extra" class="col-extra tm-bd-side"></div>')),t.append(n,e.get(".grid-s5m0","#bd")),e.use("malldetail/recommend/tabRight,malldetail/recommend/tabRight.css",function(e,t){t.render({"parentEl":n,"config":i})})}})}),m.onSwitch(function(e){var a=t.get(".bundel-tab-attr","#mainwrap");"description"==e?t.show(a):t.hide(a)}),m.onSwitch(function(e){"description"==e?t.removeClass("#bd","tm-tabOther"):t.addClass("#bd","tm-tabOther")}),m.onSwitch(function(e){var a={"description":"tmalldetail.4.11","J_Reviews":"tmalldetail.4.12","J_DealRecord":"tmalldetail.4.13","J_TabRecommends":"tmalldetail.4.14","J_Attrs":"tmalldetail.4.8"},i=a[e];i&&TShop.sendAtpanel(i),4&c.bizTag&&"J_TabRecommends"==e&&TShop.sendAcAtpanel("tmalldetail.10.13"),"J_Reviews"==e?(t.hide("#J_TmallApkBuyerList"),t.show("#J_TmallApkRateTab")):"J_DealRecord"==e?(t.show("#J_TmallApkBuyerList"),t.hide("#J_TmallApkRateTab")):"description"==e?(t.hide("#J_TmallApkBuyerList"),t.show("#J_TmallApkRateTab")):(t.hide("#J_TmallApkBuyerList"),t.hide("#J_TmallApkRateTab"))}),t.query("."+s,l).each(function(e){t.parent(e)==l&&(m.switchTo(e.id||"description"),"description"!=e.id&&o.scrollIntoView(!0))}),i.success&&i.success(),codeTrack("mod.tabbar.show","mod.tabbar.init"),128&c.bizTag||6===e.UA.ie||(a.on(window,"scroll",b),b())})}},"switchTo":function(t){var a;t={"desc":"descriptio","reviews":"J_Reviews","records":"J_DealRecord","recommends":"J_TabRecommends","aftersales":"J_AfterSales","sellerinfo":"J_SellerInfo"}[t]||t,d!=t&&(a=d,d=t,e.each(this.handles,function(e){e(d,a)}))},"curIndex":function(){return d||"description"},"onSwitch":function(t){this.handles&&e.isFunction(t)&&this.handles.push(t)},"scrollIntoView":function(){var e=this.floatBar,a=e&&e.isFloating()&&e.getPlaceHolder()||r,i=t.offset(a).top-(t.height(a)?0:t.outerHeight(r,!0));128&c.bizTag&&(i-=t.height("#mallNav")),t.scrollTop(i)}}},{"requires":["dom","event","malldetail/common/util"]});KISSY.add("malldetail/other/itemDesc",function(e,t){function a(a,n,i){i=i||{};var o,r=i.el,l=e.UA,c=/(<img[^>]*)(src *= *("[^"]*"|'[^']*'|[^ >]*))/g,s=0,d="_q75.jpg";t.viewportHeight();r&&(a=a.replace(c,function(e,t,a,i){if(s++,n.detail.cdn75&&/img0[1-8]\.taobaocdn\.com/.test(i)){var o=i.length,r=i.substr(o-1);/\d+x\d+\./.test(i)?i=i.replace(/(\d+x\d+)/,"$1q75"):"'"==r||'"'==r?i=i.substr(0,o-1)+d+r:i+=d}return[t,"src=//img-tmdetail.alicdn.com/tps/i3/T1BYd_XwFcXXb9RTPq-90-90.png data-ks-lazyload=",i].join("")}),l.IE?t.html(r,a):(o=r.cloneNode(!1),o.innerHTML=a,r.parentNode.replaceChild(o,r),r=o),t.css(r,{"height":"auto"}),TShop.onDatalazyload(function(e){e.addElements(r)}),n&&n.detail&&n.detail.minisiteUrl&&t.append(t.create("<a id='p-mlh-intro' target='_blank' class='mlh-intro-more' href='"+n.detail.minisiteUrl+"'>\u67e5\u770b\u66f4\u591a</a>"),"#mlh-info-story"),i.success&&i.success(r),a.indexOf(".swf")>0&&e.use("malldetail/other/videox",function(e,t){t.replaceFlash()}))}return{"init":function(e){codeTrack("info.desc.init","view.mainBody.init"),setTimeout(function(){codeTrack("info.desc.none","info.desc.init",{"reject":"info.desc.show"})},4096),e.product.onLoad(["desc","config"],function(t,n){t=t.replace(/_\.webp\b/gi,""),a(t,n,e),codeTrack("info.desc.show","info.desc.init")})}}},{"requires":["dom"]});