YAHOO=(typeof YAHOO==="undefined")?{}:YAHOO;YAHOO.JP=(typeof YAHOO.JP==="undefined")?{}:YAHOO.JP;YAHOO.JP.msthd=(typeof YAHOO.JP.msthd==="undefined")?{}:YAHOO.JP.msthd;(function(){var d=document,i=0,HTTP_EQUIV="http-equiv",isBeaconRequired=true,meta=d.getElementsByTagName("meta"),PREFIX="msthd";if(isBeaconRequired){initBeacon()}if(navigator.userAgent.match(/MSIE 6/)||navigator.userAgent.match(/MSIE 7/)){HTTP_EQUIV="httpEquiv"}else{if(navigator.userAgent.match(/MSIE 8/)||navigator.userAgent.match(/MSIE 9/)){}}for(i=0;i<meta.length;i++){if(meta[i].getAttribute(HTTP_EQUIV)&&meta[i].getAttribute("content").match(/utf-8/i)){setSearchBox();break}else{if(meta[i].getAttribute("charset")&&meta[i].getAttribute("charset").match(/utf-8/i)){setSearchBox();break}else{if(meta[i].getAttribute(HTTP_EQUIV)&&meta[i].getAttribute("content").match(/euc-jp/i)){setSearchBox();setEuc();break}else{if(meta[i].getAttribute("charset")&&meta[i].getAttribute("charset").match(/euc-jp/i)){setSearchBox();setEuc();break}}}}}function hashCode(str){var hash=0,i,chr,len;if(str.length==0){return hash}for(i=0,len=str.length;i<len;i++){chr=str.charCodeAt(i);hash=((hash<<5)-hash)+chr;hash|=0}return hash}function getCookie(){var i,c,clist=[],ca=document.cookie.split(";");for(i=0;i<ca.length;i++){c=ca[i];while(c.charAt(0)==" "){c=c.substring(1,c.length);clist.push(c)}}return clist}function getBcookie(){var i,bc,cookie_list=getCookie();for(i=0;i<cookie_list.length;i++){bc=cookie_list[i];bca=bc.split("&");for(j=0;j<bca.length;j++){bc=bca[j];if(bc.indexOf("B=")===0){return bc.substring("B=".length,bc.length)}}}return""}function isSupportedTLS(){var i,cookie,cookie_list=getCookie();for(i=0;i<cookie_list.length;i++){cookie=cookie_list[i];if(cookie.indexOf("TLS=")===0&&cookie.match(/r=0/)){return false}}return true}function initBeacon(){var sampling=hashCode(getBcookie())%100,img=new Image(),isHttps=location.protocol.match(/https:/)?true:false,isLogin=d.getElementById("msthdLoginName")===null?0:1,rdsig,dynamicUrls=[{id:"msthdLogo",path:"/mh/click/logo"},{id:"msthdHelp",path:"/mh/click/help"},{id:"msthdLogin",path:"/mh/click/logn"},{id:"msthdReg",path:"/mh/click/reg"},{id:"msthdLoginName",path:"/mh/click/edit"},{id:"msthdPoint",path:"/mh/click/point"},{id:"msthdPointPromo",path:"/mh/click/pointpromo"},{id:"msthdYtop",path:"/mh/click/ytop"}],i,elm;if(isHttps&&sampling===0){if(isLogin){img.src="https://rdsig.yahoo.co.jp/mh/view/json/sts_logn/RV=1/RU=aHR0cHM6Ly9zLnlpbWcuanAvaW1hZ2VzL2NsZWFyLmdpZg--"}else{img.src="https://rdsig.yahoo.co.jp/mh/view/json/sts_lout/RV=1/RU=aHR0cHM6Ly9zLnlpbWcuanAvaW1hZ2VzL2NsZWFyLmdpZg--"}}rdsig=YAHOO.JP.pcore.rdsig;for(i=0;i<dynamicUrls.length;i++){elm=document.getElementById(dynamicUrls[i].id);if(!elm){continue}elm.href=rdsig.gen_redirect_v1(elm.href,dynamicUrls[i].path)}}function setSearchBox(){if(d.getElementById("msthdsrch")){if((/msie ([67])\./).test(navigator.userAgent.toLowerCase())){d.getElementById("msthdsrch").style.display="inline"}else{d.getElementById("msthdsrch").style.display="inline-block"}}}function setEuc(){if(d.getElementById("msthdei")){d.getElementById("msthdei").value="EUC-JP"}}function requestJsonP(api,param){var key,p=[],f=d.getElementsByTagName("script")[0],s=d.createElement("script");for(key in param){p.push(key+"="+param[key])}s.src=api+"?"+p.join("&");f.parentNode.insertBefore(s,f)}function XMLHttpRequestCreate(){if(window.XMLHttpRequest){return new XMLHttpRequest()}else{try{return new ActiveXObject("MSXML2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("MSXML2.XMLHTTP")}catch(e){}}return null}function addListener(oElm,sType,func,cap){if(!oElm){return false}var types=sType.split(" ");for(var i=0;i<types.length;i++){if(oElm.addEventListener){oElm.addEventListener(types[i],func,cap)}else{if(oElm.attachEvent){oElm.attachEvent("on"+types[i],func)}else{return false}}}return false}function fireEvt(el,t,cs){if(!el||!t||typeof el!="object"||typeof t!="string"||el.nodeType==3||el.nodeType==8){return}var _d=document,evt;if(_d.createEvent){evt=_d.createEvent("HTMLEvents");evt.initEvent(t,true,true)}else{evt=_d.createEventObject();evt.eventType=t}evt.eventName=t;if(cs){evt.u_data=cs}if(_d.createEvent){el.dispatchEvent(evt)}else{try{el.fireEvent("onclick",evt)}catch(e){return false}}}function sendYbx(lbl,s){var bcon=new Image(),hashc=hashCode(getBcookie()),ybxsv="https://ybx.yahoo.co.jp/clear.gif?bkey=mh&t="+(new Date()).getTime(),label="";if(s&&hashc%s!==0){return}for(var l in lbl){label+="&"+l+"="+lbl[l]}bcon.src=ybxsv+label}function isIE(){var ua=navigator.userAgent.toLowerCase(),ver=navigator.appVersion.toLowerCase();if((ua.indexOf("msie")>-1&&ua.indexOf("opera")===-1)&&(ver.indexOf("msie 6.")>-1||ver.indexOf("msie 7.")>-1||ver.indexOf("msie 8.")>-1||ver.indexOf("msie 9.")>-1)){return true}else{return false}}function compareDate(d1,d2){return(d1-d2)/86400000}YAHOO.JP.msthd.Promo=(function(){var ATTR_API_URL="https://api.accounts.yahoo.co.jp/api/getUserAttr",CRM_API_URL="https://crmapis.shopping.yahoo.co.jp/crm/v1/contents",ACTION_API_URL="https://crmapis.shopping.yahoo.co.jp/crm/v1/action_counts",TIMEOUT="1000",self,useratr,pointlps,crmInfoTxt,crmInfoUhd,crmCpId,crmTmr,crmLinkUrl,crmUserId,lnkInfo,crumb=d.getElementById(PREFIX+"Script").getAttribute("data-c"),shpcrumb,isYtExpired=0,isSetPr=0,inittmr=null,isLogin=d.getElementById(PREFIX+"LoginName")===null?0:1,isCrmRequest=d.getElementById(PREFIX+"NoCrm")===null?1:0,isGoogleBot=/googlebot/.test(navigator.userAgent.toLowerCase());return{init:function(){self=this,useratr={uhd:"default",txt:"default"};sendYbx({label:"alluser"});if(typeof YAHOO.JP.matildaPCMHD!=="undefined"){YAHOO.JP.matildaPCMHD.init("mhd_premium_pc,mhd_uhd_pc,mhd_text_pc");inittmr=window.setTimeout(function(){if(!YAHOO.JP.matildaPCMHD.complete&&!crumb){return}},3000);addListener(document.body,"yjmempfInitialized",function(){if(YAHOO.JP.matildaPCMHD.complete){window.clearTimeout(inittmr);var isChieDomain=/chiebukuro\.yahoo\.co\.jp/.test(document.domain);if(isChieDomain){if(d.getElementById(PREFIX+"UhdPrLink")){d.getElementById(PREFIX+"UhdPrLink").setAttribute("class","")}}}},false)}addListener(d.body,"successuseratr",function(){if(isSetPr){return false}d.getElementById("msthdLoginUser").setAttribute("class","msthdNameView");self.showDefault();isSetPr=1},false);addListener(d.body,"faileduseratr",function(){self.showDefault()},false);addListener(d.body,"successcrm",function(){if(isSetPr){return false}d.getElementById("msthdLoginUser").setAttribute("class","msthdNameView");if(crmInfoTxt){self.changeTxtPr(crmInfoTxt,"default");addListener(d.getElementById(PREFIX+"PrLink"),"click",self.setCrmActionEvent)}else{if(crmInfoUhd){self.changeUhdPr(crmInfoUhd,"default");addListener(d.getElementById(PREFIX+"UhdPrLink"),"click",self.setCrmActionEvent)}}isSetPr=1;self.showDefault()},false);if(isLogin&&!isIE()&&!isGoogleBot){self.getUserAttribute()}else{self.showDefault()}},showDefault:function(){d.getElementById("mhd_text_pc").style.display="inline-block";d.getElementById("mhd_uhd_pc").style.display="inline-block";if(isLogin){d.getElementById("msthdLoginUser").setAttribute("class","msthdNameView");d.getElementById("msthdUserIconImg").style.display="inline";d.getElementById("msthdPoint").style.display="inline-block"}},getUserAttribute:function(){var xhr=XMLHttpRequestCreate(),res,evt,date=new Date(),timestamp=date.getTime();xhr.onreadystatechange=function(){if(xhr.readyState===4){if(xhr.status===200){if(typeof JSON!=="undefined"){res=xhr.responseText.replace(/<!--.*-->/,"");res=JSON.parse(res)}if(res.Code==="0000"||res.Code==="0001"){if(res.Code==="0000"){useratr=self.setUserAttrbute(res);evt="successuseratr"}else{isYtExpired=1;evt="faileduseratr"}self.insertDisplayName(res);self.insertPoint(res);if(typeof YAHOO.JP.matildaPCMHD!=="undefined"&&YAHOO.JP.matildaPCMHD.complete){if(isCrmRequest&&isSupportedTLS()){shpcrumb=res.cb;self.requestCrm(res)}else{fireEvt(d.body,evt)}}else{if(isCrmRequest){shpcrumb=res.cb;self.requestCrm(res)}else{fireEvt(d.body,evt)}}}else{if(res.Code==="0100"){fireEvt(d.body,"faileduseratr")}else{return -1}}}else{fireEvt(d.body,"faileduseratr")}}};xhr.open("GET",ATTR_API_URL+'?key={"data_code":["pr","ca","sh","pd","sx","ym","sb","bpr","dnm","dnmicn","tp"],"crumb_data":["'+crumb+'"]}&date='+timestamp);xhr.withCredentials=true;xhr.setRequestHeader("Content-Type","text/plain");if(xhr.timeout!==undefined){xhr.ontimeout=function(){xhr.abort()};xhr.timeout=5000}xhr.send(null)},setUserAttrbute:function(res){var uhd,txt,userAttrList={uhd:["bpr2_sh0","bpr2_sh1","pr1_sh0","pr1_sh1","pr0_sh0","pr0_sh1","dafault"],txt:["bpr2_sh0","bpr2_sh1","pr1_sh0","pr1_sh1","pr0_sh0","pr0_sh1","ca0_sh0","ca0_sh1","ca1_sh0","ca1_sh1","dafault"]};if(res.ca==="2"){res.ca="1"}uhd=this.makeAttrValue(userAttrList.uhd,res);txt=this.makeAttrValue(userAttrList.txt,res);return{uhd:uhd,txt:txt}},makeAttrValue:function(arr,res){var result;arr.forEach(function(elm){if(elm!=="default"&&!result){var atr=elm.split("_");if(self.matchUserAttribute(atr[0],res)&&self.matchUserAttribute(atr[1],res)){result=elm}}});if(!result){result="default"}return result},matchUserAttribute:function(atr,res){var atr_key=atr.substr(0,atr.length-1),atr_val=atr.substr(atr.length-1),result=(String(eval("res."+atr_key))===atr_val)?true:false;return result},parseStringToDate:function(str){if(!str||str.length<8){return null}var year=str.slice(0,4),month=Number(str.slice(4,6))-1,day=str.slice(6,8);return new Date(year,month,day)},insertPoint:function(res){var pd=self.parseStringToDate(res.pd),sysdate=self.parseStringToDate(res.sysdate);pointlps=(pd&&sysdate)?compareDate(pd,sysdate):null;if(d.getElementById("msthdPointArea")){if("tp" in res){var pointCount=(res.tp)?parseInt(res.tp,10):0;d.getElementById(PREFIX+"PointNum").innerHTML=pointCount+decodeURI("%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88")}if((/msie ([67])\./).test(navigator.userAgent.toLowerCase())){d.getElementById("msthdPoint").style.display="inline"}else{d.getElementById("msthdPoint").style.display="inline-block"}}if((pointlps!==null)&&(pointlps<=7)&&(pointlps>=0)){self.insertPointLapse(pointlps)}},insertPointLapse:function(num){var pointtxt=d.getElementById(PREFIX+"PointTxt"),content=(num===0)?decodeURI("%E6%9C%AC%E6%97%A5%E4%B8%AD%E3%81%AB%E5%A4%B1%E5%8A%B9%E3%81%99%E3%82%8B%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%81%82%E3%82%8A"):decodeURI("%E3%81%82%E3%81%A8")+num+decodeURI("%E6%97%A5%E3%81%A7%E5%A4%B1%E5%8A%B9%E3%81%99%E3%82%8B%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88%E3%81%82%E3%82%8A");pointtxt.innerHTML=content;sendYbx({label:"imp_pointlps"})},changeUhdPr:function(info,atr){var uhdpr=d.getElementById("mhd_uhd_pc"),content='<div id="msthdFifth" class="compo"><a href="" id="msthdUhdPrLink"><span class="'+info.uhd[atr].clsName+'">'+decodeURI("Yahoo%21%e3%82%b7%e3%83%a7%e3%83%83%e3%83%94%e3%83%b3%e3%82%b0%e3%81%a7%e3%81%8a%e8%b2%b7%e3%81%84%e7%89%a9")+"</span></a></div>";uhdpr.innerHTML=content;d.getElementById("msthdUhdPrLink").href=info.uhd[atr].url;sendYbx({label:"imp_uhdpr_"+useratr.uhd,mcrmid:crmCpId,crmdevid:"pc",crmpgid:"yjpmhd",crmsecid:"crm_br",uid:crmUserId})},changeTxtPr:function(info,atr){if(!info||!info.txt||!info.txt[atr]){return}var prbox=d.getElementById("mhd_text_pc"),infoTxt=info.txt[atr],content='<a href="'+infoTxt.url+'" id="msthdPrLink" class="'+infoTxt.clsName+'">'+infoTxt.word+"</a>";prbox.innerHTML=content;sendYbx({label:"imp_txtpr_"+useratr.txt,mcrmid:crmCpId,crmdevid:"pc",crmpgid:"yjpmhd",crmsecid:"crm_tx",uid:crmUserId})},insertDisplayName:function(res){if(res.dnm){d.getElementById("msthdLoginName").innerHTML=res.dnm}if(res.dnmicn&&!(typeof res.dnmicn.url64==="undefined")){if(res.dnmicn.url64!==""){d.getElementById("msthdUserIconImg").src=res.dnmicn.url64}d.getElementById("msthdUserIconImg").style.display="inline"}},requestCrm:function(attr){var pageId="YJPMHD",deviceType="PC";requestJsonP(CRM_API_URL+"/pages/"+pageId+"/device/"+deviceType,{crumb:shpcrumb,callback:"YAHOO.JP.msthd.Promo.setCrmContents"});crmTmr=window.setTimeout(function(){YAHOO.JP.msthd.Promo.setCrmContents()},TIMEOUT)},setCrmContents:function(res){var evt="faileduseratr";window.clearTimeout(crmTmr);if(res){if(res.ResultSet&&res.ResultSet.Total>0){var result=res.ResultSet.Result[0];crmCpId=result.CampaignId,crmUserId=getBcookie()+(new Date()).getTime();evt="successcrm";if(d.getElementById("msthdFifth")!==null){this.makeCrmUhd(result)}else{this.makeCrmTxt(result)}}else{if(!isYtExpired){evt="successuseratr"}}}else{if(!isYtExpired){evt="successuseratr"}}fireEvt(d.body,evt)},makeCrmUhd:function(result){if(result.YJPMHD.ImageUrl&&result.LinkUrl&&/^(https:)/.test(result.YJPMHD.ImageUrl)){var cssEle=d.createElement("style"),uhdClsName="msthdCrm";useratr.uhd=useratr.uhd+"_list";cssEle.innerHTML="."+uhdClsName+"{background-image: url("+result.YJPMHD.ImageUrl+");}";d.getElementById("msthd").appendChild(cssEle);crmInfoUhd={uhd:{"default":{clsName:uhdClsName,url:result.LinkUrl}}}}},makeCrmTxt:function(result){if(result.YJPMHD.Title&&result.LinkUrl){var cssEle=d.createElement("style"),txtClsName="msthdPrCrmIcon";useratr.txt=useratr.txt+"_list";if(result.YJPMHD.IconImageUrl&&/^(https:)/.test(result.YJPMHD.IconImageUrl)){cssEle.innerHTML="#msthd ."+txtClsName+"{background-image: url("+result.YJPMHD.IconImageUrl+") !important;}";d.getElementById("msthd").appendChild(cssEle)}crmInfoTxt={txt:{"default":{clsName:txtClsName+" msthdPrShpIcon",word:result.YJPMHD.Title,url:result.LinkUrl}}}}},setCrmActionEvent:function(e){e.preventDefault();var acctType="1",pageId="YJPMHD";sendYbx({sec:(crmInfoTxt)?"crm_tx":"crm_br",slk:"click",pos:"0",uid:crmUserId});if((!e.target.getAttribute("href"))){crmLinkUrl=e.target.parentNode.getAttribute("href")}else{crmLinkUrl=e.target.getAttribute("href")}requestJsonP(ACTION_API_URL+"/campaigns/"+crmCpId+"/action/"+acctType+"/pages/"+pageId,{crumb:shpcrumb,callback:"YAHOO.JP.msthd.Promo.getCrmActionResult"});crmTmr=window.setTimeout(function(){window.location.href=crmLinkUrl},1000)},getCrmActionResult:function(){window.clearTimeout(crmTmr);setTimeout(function(){window.location.href=crmLinkUrl},0)}}}());window.msthdPromo()})();