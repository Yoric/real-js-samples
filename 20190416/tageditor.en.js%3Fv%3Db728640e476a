"use strict";function bindTagFilterAutoComplete(e,t,n){var i={"showCounts":!0},n=$.extend({},i,n),r=(t||"")+"/filter/tags";$(e).autocomplete(r,{"max":6,"dataType":t?"jsonp":"json","matchSubset":!1,"highlightItem":!0,"multiple":!0,"multipleSeparator":" ","matchContains":!0,"scroll":!0,"scrollHeight":300,"formatItem":function(e){var t=e[0],i=e[1];return n.showCounts?t+" ("+i+")":t},"formatResult":function(e){var t=e[0];return t}})}function initTagPreview(e,t,n){var i,r=null,o=window.tagRenderer,a=!0;if(o){var s=function(){if(0==e.closest("body").length)return clearInterval(i),void 0;var s=e.val();if(s!=r){r=s;var l=StackExchange.helpers.sanitizeAndSplitTags(s);if(0==l.length)return t.slideUp(function(){t.empty()}),void 0;t.empty();for(var c=0;c<l.length;c++){var u=l[c];o(u).appendTo(t),t.append("<span> </span>")}l.length>n?t.append("<span class='form-error'>"+function(e){return 1==e.maxTagCount?"a question cannot have more than "+e.maxTagCount+" tag":"a question cannot have more than "+e.maxTagCount+" tags"}({"maxTagCount":n})+"</span>"):!a&&StackExchange.MarkdownEditor&&styleCode.updateLangdivDelayed.trigger(l),a=!1,t.slideDown()}};i=setInterval(s,500),e.keydown(function(e){i&&clearInterval(i),(32==e.which||13==e.which)&&s(),i=setInterval(s,500)})}}StackExchange.tagAutocomplete=!0,StackExchange.autocomplete=!0,function(e){e.fn.extend({"autocomplete":function(t,n){var i="string"==typeof t;return n=e.extend({},e.Autocompleter.defaults,{"url":i?t:null,"data":i?null:t,"delay":i?e.Autocompleter.defaults.delay:10,"max":n&&!n.scroll?10:150},n),n.highlight=n.highlight||function(e){return e},n.formatMatch=n.formatMatch||n.formatItem,this.each(function(){new e.Autocompleter(this,n)})},"result":function(e){return this.bind("result",e)},"search":function(e){return this.trigger("search",[e])},"flushCache":function(){return this.trigger("flushCache")},"setOptions":function(e){return this.trigger("setOptions",[e])},"unautocomplete":function(){return this.trigger("unautocomplete")}}),e.Autocompleter=function(t,n){function i(){var i=S.selected();if(!i)return!1;var r=i.result;if(b=r,n.multiple){var a=o(y.val());if(a.length>1){var s,l=n.multipleSeparator.length,u=e(t).selection().start,d=0;e.each(a,function(e,t){return d+=t.length,d>=u?(s=e,!1):(d+=l,void 0)}),a[s]=r,r=a.join(n.multipleSeparator)}r+=n.multipleSeparator}y.val(r);var f=y[0];if(f.createTextRange){var p=f.createTextRange();p.move("textedit"),p.select()}return c(),y.trigger("result",[i.data,i.value]),!0}function r(e,t){if(m==v.DEL)return S.hide(),void 0;var i=y.val();(t||i!=b)&&(b=i,i=a(i),i.length>=n.minChars?(y.addClass(n.loadingClass),n.matchCase||(i=i.toLowerCase()),d(i,u,c)):(p(),S.hide()))}function o(t){if(!t)return[""];var i=t.split(n.multipleSeparator),r=[];return e.each(i,function(t,n){e.trim(n)&&r.push(e.trim(n))}),r.length?r:[""]}function a(i){if(!n.multiple)return i;var r=o(i);if(1==r.length)return r[0];var a=e(t).selection().start;return r=a==i.length?o(i):o(i.replace(i.substring(a),"")),r[r.length-1]}function s(i,r){n.autoFill&&a(y.val()).toLowerCase()==i.toLowerCase()&&m!=v.BACKSPACE&&(y.val(y.val()+r.substring(a(b).length)),e(t).selection(b.length,b.length+r.length))}function l(){clearTimeout(h),h=setTimeout(c,200)}function c(){S.visible();S.hide(),clearTimeout(h),p(),n.mustMatch&&y.search(function(e){if(!e)if(n.multiple){var t=o(y.val()).slice(0,-1);y.val(t.join(n.multipleSeparator)+(t.length?n.multipleSeparator:""))}else y.val("")})}function u(e,t){t&&t.length&&x?(p(),S.display(t,e),s(e,t[0].value),S.show()):c()}function d(i,r,o){n.matchCase||(i=i.toLowerCase());var s=w.load(i);if(s&&s.length)r(i,s);else if("string"==typeof n.url&&n.url.length>0){var l={"timestamp":+new Date};e.each(n.extraParams,function(e,t){l[e]="function"==typeof t?t():t});var c=!1;e.ajax({"mode":"abort","port":"autocomplete"+t.name,"dataType":n.dataType,"url":n.url,"data":e.extend({"q":a(i),"limit":n.max},l),"success":function(e){var t=n.parse&&n.parse(e)||f(e);w.add(i,t),r(i,t),c=!0},"complete":function(){c||r(),c=!0}})}else S.emptyList(),o(i)}function f(t){for(var i=[],r=t.split("\n"),o=0;o<r.length;o++){var a=e.trim(r[o]);a&&(a=a.split("|"),i[i.length]={"data":a,"value":a[0],"result":n.formatResult&&n.formatResult(a,a[0])||a[0]})}return i}function p(){y.removeClass(n.loadingClass)}var h,m,g,v={"UP":38,"DOWN":40,"DEL":46,"TAB":9,"RETURN":13,"ESC":27,"COMMA":188,"PAGEUP":33,"PAGEDOWN":34,"BACKSPACE":8,"SPACE":32},y=e(t).attr("autocomplete","off").addClass(n.inputClass),b="",w=e.Autocompleter.Cache(n),x=0,k={"mouseDownOnSelect":!1},S=e.Autocompleter.Select(n,t,i,k);y.bind("keydown.autocomplete",function(t){switch(x=1,m=t.keyCode,t.keyCode){case v.UP:t.preventDefault(),S.visible()?S.prev():r(0,!0);break;case v.DOWN:t.preventDefault(),S.visible()?S.next():r(0,!0);break;case v.PAGEUP:t.preventDefault(),S.visible()?S.pageUp():r(0,!0);break;case v.PAGEDOWN:t.preventDefault(),S.visible()?S.pageDown():r(0,!0);break;case n.multiple&&","==e.trim(n.multipleSeparator)&&v.COMMA:case v.TAB:case v.RETURN:if(i())return t.preventDefault(),g=!0,!1;break;case v.ESC:S.hide();break;case n.multiple&&" "===n.multipleSeparator&&v.SPACE:c();break;default:clearTimeout(h),h=setTimeout(r,n.delay)}}).focus(function(){x++}).blur(function(){x=0,k.mouseDownOnSelect||l()}).click(function(){x++>1&&!S.visible()&&r(0,!0)}).bind("search",function(){function t(e,t){var i;if(t&&t.length)for(var r=0;r<t.length;r++)if(t[r].result.toLowerCase()==e.toLowerCase()){i=t[r];break}"function"==typeof n?n(i):y.trigger("result",i&&[i.data,i.value])}var n=arguments.length>1?arguments[1]:null;e.each(o(y.val()),function(e,n){d(n,t,t)})}).bind("flushCache",function(){w.flush()}).bind("setOptions",function(){e.extend(n,arguments[1]),"data"in arguments[1]&&w.populate()}).bind("unautocomplete",function(){S.unbind(),y.unbind(),e(t.form).unbind(".autocomplete")})},e.Autocompleter.defaults={"inputClass":"ac_input","resultsClass":"ac_results","loadingClass":"ac_loading","minChars":1,"delay":400,"matchCase":!1,"matchSubset":!0,"matchContains":!1,"cacheLength":10,"max":100,"mustMatch":!1,"extraParams":{},"selectFirst":!0,"formatItem":function(e){return e[0]},"formatMatch":null,"autoFill":!1,"width":0,"multiple":!1,"multipleSeparator":", ","highlight":function(e,t){return e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+t.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},"scroll":!0,"scrollHeight":180},e.Autocompleter.Cache=function(t){function n(e,n){t.matchCase||(e=e.toLowerCase());var i=e.indexOf(n);return"word"==t.matchContains&&(i=e.toLowerCase().search("\\b"+n.toLowerCase())),-1==i?!1:0==i||t.matchContains}function i(e,n){s>t.cacheLength&&o(),a[e]||s++,a[e]=n}function r(){if(!t.data)return!1;var n={},r=0;t.url||(t.cacheLength=1),n[""]=[];for(var o=0,a=t.data.length;a>o;o++){var s=t.data[o];s="string"==typeof s?[s]:s;var l=t.formatMatch(s,o+1,t.data.length);if(l!==!1){var c=l.charAt(0).toLowerCase();n[c]||(n[c]=[]);var u={"value":l,"data":s,"result":t.formatResult&&t.formatResult(s)||l};n[c].push(u),r++<t.max&&n[""].push(u)}}e.each(n,function(e,n){t.cacheLength++,i(e,n)})}function o(){a={},s=0}var a={},s=0;return setTimeout(r,25),{"flush":o,"add":i,"populate":r,"load":function(i){if(!t.cacheLength||!s)return null;if(!t.url&&t.matchContains){var r=[];for(var o in a)if(o.length>0){var l=a[o];e.each(l,function(e,t){n(t.value,i)&&r.push(t)})}return r}if(a[i])return a[i];if(t.matchSubset)for(var c=i.length-1;c>=t.minChars;c--){var l=a[i.substr(0,c)];if(l){var r=[];return e.each(l,function(e,t){n(t.value,i)&&(r[r.length]=t)}),r}}return null}}},e.Autocompleter.Select=function(t,n,i,r){function o(){y&&(p=e("<div/>").hide().addClass(t.resultsClass).css("position","absolute").appendTo(document.body),h=e("<ul/>").appendTo(p).mouseover(function(t){a(t).nodeName&&"LI"==a(t).nodeName.toUpperCase()&&(g=e("li",h).removeClass(m.ACTIVE).index(a(t)),e(a(t)).addClass(m.ACTIVE))}).click(function(t){return e(a(t)).addClass(m.ACTIVE),i(),n.focus(),!1}).mousedown(function(){r.mouseDownOnSelect=!0}).mouseup(function(){r.mouseDownOnSelect=!1}),t.width>0&&p.css("width",t.width),y=!1)}function a(e){for(var t=e.target;t&&"LI"!=t.tagName;)t=t.parentNode;return t?t:[]}function s(e){d.slice(g,g+1).removeClass(m.ACTIVE),l(e);var n=d.slice(g,g+1).addClass(m.ACTIVE);if(t.scroll){var i=0;d.slice(0,g).each(function(){i+=this.offsetHeight}),i+n[0].offsetHeight-h.scrollTop()>h[0].clientHeight?h.scrollTop(i+n[0].offsetHeight-h.innerHeight()):i<h.scrollTop()&&h.scrollTop(i)}}function l(e){g+=e,0>g?g=d.size()-1:g>=d.size()&&(g=0)}function c(e){return t.max&&t.max<e?t.max:e}function u(){h.empty();for(var n=c(f.length),i=0;n>i;i++)if(f[i]){var r=t.formatItem(f[i].data,i+1,n,f[i].value,v);if(r!==!1){var o=e("<li/>").html(t.highlight(r,v)).addClass(i%2==0?"ac_even":"ac_odd").appendTo(h)[0];e.data(o,"ac_data",f[i])}}d=h.find("li"),t.selectFirst&&(d.slice(0,1).addClass(m.ACTIVE),g=0)}var d,f,p,h,m={"ACTIVE":"ac_over"},g=-1,v="",y=!0;return{"display":function(e,t){o(),f=e,v=t,u()},"next":function(){s(1)},"prev":function(){s(-1)},"pageUp":function(){0!=g&&0>g-8?s(-g):s(-8)},"pageDown":function(){g!=d.size()-1&&g+8>d.size()?s(d.size()-1-g):s(8)},"hide":function(){p&&p.hide(),d&&d.removeClass(m.ACTIVE),g=-1},"visible":function(){return p&&p.is(":visible")},"current":function(){return this.visible()&&(d.filter("."+m.ACTIVE)[0]||t.selectFirst&&d[0])},"show":function(){var i=e(n).offset();if(p.css({"width":"string"==typeof t.width||t.width>0?t.width:e(n).width(),"top":i.top+n.offsetHeight,"left":i.left}).show(),t.scroll&&(h.scrollTop(0),h.css({"maxHeight":t.scrollHeight,"overflow":"auto"}),e.browser.msie&&"undefined"==typeof document.body.style.maxHeight)){var r=0;d.each(function(){r+=this.offsetHeight});var o=r>t.scrollHeight;h.css("height",o?t.scrollHeight:r),o||d.width(h.width()-parseInt(d.css("padding-left"))-parseInt(d.css("padding-right")))}},"selected":function(){var t=d&&d.filter("."+m.ACTIVE).removeClass(m.ACTIVE);return t&&t.length&&e.data(t[0],"ac_data")},"emptyList":function(){h&&h.empty()},"unbind":function(){p&&p.remove()}}},e.fn.selection=function(e,t){if(void 0!==e)return this.each(function(){if(this.createTextRange){var n=this.createTextRange();void 0===t||e==t?(n.move("character",e),n.select()):(n.collapse(!0),n.moveStart("character",e),n.moveEnd("character",t),n.select())}else this.setSelectionRange?this.setSelectionRange(e,t):this.selectionStart&&(this.selectionStart=e,this.selectionEnd=t)});var n=this[0];if(n.createTextRange){var i=document.selection.createRange(),r=n.value,o="<->",a=i.text.length;if(0===a)return{"start":n.value.length,"end":n.value.length};i.text=o;var s=n.value.indexOf(o);return n.value=r,this.selection(s,s+a),{"start":s,"end":s+a}}return void 0!==n.selectionStart?{"start":n.selectionStart,"end":n.selectionEnd}:void 0}}(jQuery);