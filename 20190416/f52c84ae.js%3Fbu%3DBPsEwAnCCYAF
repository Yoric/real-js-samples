(function(){var w,et;try{(function(){var n={L_Directions_Arrive_By:"Arrive by",L_Directions_Arrive_Time:"Arrive by {0}",L_Directions_Last_Train:"Last train",L_Directions_Depart_At:"Leave at",L_Directions_Depart_Time:"Leave at {0}",L_Directions_Highways:"Avoid highways",L_Directions_Save_History:"Save destination history",L_Directions_Delete_History:"delete destination history",L_Directions_History_Deleted:"Previous history deleted.",L_Directions_Options:"Options",L_Directions_Option_Miles:"Miles",L_Directions_Option_Km:"Kilometers",L_Option_Sort_By:"Sort by:",L_Option_Sort_By_Time:"Time",L_Option_Sort_By_Cost:"Price",L_Option_Sort_By_Transfers:"Number of transfers",L_Option_Transit_Mode:"Transit Mode:",L_Option_Avoid_Flights:"Avoid flights",L_Option_Avoid_Express_Trains:"Avoid express trains",L_Option_Use_Bullet_Trains:"Use bullet trains",L_Option_Avoid_Bullet_Trains:"Avoid bullet trains",L_Transit_Mode_Bus:"Bus",L_Transit_Mode_Subway:"Subway",L_Transit_Mode_Train:"Train",L_Transit_Mode_CityRail:"Tram/Light rail",L_Transit_Mode_Ferry:"Ferry",L_Directions_Round_Trip:"Roundtrip",L_Directions_Title_Drive:"Driving",L_Directions_Title_Transit:"Transit",L_Directions_Title_Walk:"Walking",L_Directions_Tolls:"Avoid tolls",L_Directions_AvoidFerry:"Avoid ferries",L_DirectionsTaskTitle_Text:"Directions",L_Directions_Today:"Today",L_Directions_MyLocation:"My location",L_Directions_Home:"Home",L_Directions_Work:"Work",L_Directions_Error_Waypoints:"To find a route, please tell us where you're starting from and where you're going.",L_Directions_Error_No_Results:"We can't find directions between one or more waypoints.",DirectionsServerError:"We are having trouble providing directions for this journey.  Please try again later",L_Directions_Error_Equal_Waypoints:"Your starting and ending locations are the same.",DirectionsErrorCannotFindRoad:"We can't find directions for this journey because one or more waypoints are too far from any known roads.",DirectionsErrorSourceNotFound:"We can't find directions for this journey because one or more waypoints are in a region of the world where we do not have routing data.",DirectionsErrorNoTransitTrip:"We can't find transit directions for the specified date or times.",DirectionsErrorNoNearbyStops:"There are no stops near one or more of your waypoints.",DirectionsErrorNoSolution:"We can't find directions for this journey. Check your waypoint locations and try again.",DirectionsErrorOutOfBoundsForTransit:"We can't find transit directions for this journey because one or more waypoints is in a region of the world where we do not offer transit routing.",DirectionsErrorTimeout:"This routing request is taking too long",DirectionsErrorTooFar:"The distance between one or more waypoints is too long to calculate directions. Try getting directions for shorter distances.",DirectionsErrorStopsTooClose:"The transit stops you've chosen are too close together. Try different stops, or consider walking directions.",DirectionsErrorWalkBestAlternative:"Walking directions may be a better option for this route.",L_Directions_Error_User_Location_Not_Found:"Your location is not available. This may occur if your browser or computer settings prevent websites or applications from using your location. You can still get directions by proving a start and end location.",L_Directions_Time_Control_Tip:"Select when to leave or arrive.",L_Directions_Leave_Now:"Leave now",L_Directions_Title_Add:"Add destination",L_Directions_Title_Delete:"Remove",L_Directions_Duration:"{0} hr {1} min",L_Directions_Results_Title:"Via {0}",L_Directions_Results_Description_Time:"{0} without traffic",L_Directions_Results_Delay_Time:"{0} delay",L_Directions_Results_Title_Time_With_Traffic:"{0} with traffic",L_Directions_Title_Reverse:"Reverse",L_Directions_Title_Start:"From",L_Directions_Title_Destination:"To",L_Directions_Leg_To:"to ",L_Directions_Loading:"Directions loading... ",L_Data_Special_Attribution:"Buy Tickets From:",L_Data_Attribution:"Data From:",L_Report_Problem_Link:"Report a problem",L_TransitDisclaimer_Text:"These directions are subject to the Microsoft® Service Agreement and are for informational purposes only. No guarantee is made regarding their completeness or accuracy. Contains public sector information licensed under the Open Government License v.1.0.",L_DirectionsDisclaimer_Text:"These directions are subject to the {0} and are for informational purposes only. No guarantee is made regarding their completeness or accuracy. Construction projects, traffic, or other events may cause actual conditions to differ from these results. Map and traffic data © {year} HERE™.",L_TransitDisclaimer_Text_Japan:"免責事項: Bing では、各パートナーより情報の提供を受けてサービスを提供しています。Bing 及び各パートナーは正確な情報の提供に努めていますが、本情報を利用してご利用者に生じた問題や損害に関しては責任を負いかねます。(ご注意) JR 線の時刻は Bing が自らの責任により加工していますが、変更となる場合があります。各路線の最新情報に関しては、ご利用者ご自身で再確認いただくことをおすすめします。弘承 平成２５年１２４号 JR データの内容は、株式会社交通新聞社発行の「ＪＲ時刻表」に基づいています。この時刻データを無断転載・複写や電磁媒体等に加工することを禁じます。路線検索 © 株式会社ヴァル研究所",L_DirectionsDisclaimer_Text_Japan:"提示される経路は Microsoft® サービス規約 に準拠しており、情報提供のみを目的としています。経路の完全性または正確性は一切保証されていません。工事、交通状況、その他の要因により、実際の状況は検索結果と異なる場合があります。地図データ © 2015 ZENRIN™。",L_TermsOfUse_Text:"Microsoft® Service Agreement",L_Directions_Duration_Min:"{0} min",L_Directions_Duration_Less_One_Min:"1 min",L_Directions_Go:"Go",L_Directions_Cost:"¥{0}‎",L_Directions_NoTolls:"Your route will avoid tolls.",L_Directions_NoFerry:"Your route will avoid ferries.",L_Directions_NoHighways:"Your route will avoid highways.",L_Directions_NoTollsOrHighways:"Your route will avoid tolls and highways.",L_Directions_NoTollsOrFerry:"Your route will avoid tolls and ferries.",L_Directions_NoHighwaysOrFerry:"Your route will avoid highways and ferries.",L_Directions_NoTollsHighwaysOrFerry:"Your route will avoid tolls, highways and ferries.",L_Directions_Process_Title_Text_Line:"{0} to {1}",L_Directions_Title_Reorder:"Drag to reorder",L_Directions_Waypoint_Text_From_Name_Address:"{0}, {1}",L_Directions_WalkDistance:"{0}, about {1}",L_Directions_Print:"Print",L_Directions_PrintNotesWatermark:"Type your route notes here",L_Directions_Error_Search_Fail:"We can't find directions for this journey because one or more waypoints were not found.",L_Directions_Via_Text:"via {0}",L_Directions_Via_Remove_Link:"Remove",L_Directions_Drag_Pin_Tip:"Drag to modify your route",L_Directions_Turn_Preview_Tip:"Click to preview your turn",L_Directions_Airline:"Airline",L_Directions_Bus:"Bus",L_Directions_Ferry:"Ferry",L_Directions_Train:"Train",L_Directions_Transit_Via1:"Via {0}: {1}",L_Directions_Transit_Via2:", {0}: {1}",L_Directions_Tube:"Tube",L_Directions_Categories_Bar_Entity_Coffee:"Coffee",L_Directions_Categories_Bar_Entity_GasStations:"Gas stations",L_Directions_Categories_Bar_Entity_GroceryStores:"Grocery stores",L_Directions_Categories_Bar_Entity_Hotels:"Hotels",L_Directions_Categories_Bar_Entity_Restaurants:"Restaurants",L_Directions_Categories_Bar_Entity_FastFood:"Fast food",L_Directions_Categories_Bar_Entity_Attractions:"Attractions",L_Directions_Hour_Min_Separator:":",L_Directions_Hour:"hr",L_Directions_Minute:"min",L_Directions_Light_Traffic:"Light traffic",L_Directions_Moderate_Traffic:"Moderate traffic",L_Directions_Heavy_Traffic:"Heavy traffic",L_Directions_Leg_Title:"from {from} to {to}",L_Directions_Leg_TimeDist_Text:"{time} ({distance})",L_Directions_Leg_TimeOnly_Text:"{time}",L_Nearby_Parking:"See nearby parking",L_Print_InstructionIndexSeparator:".",L_Directions_See_All_Routes:"see all routes",L_Directions_Back_Button:"return to route",L_Directions_Edit_Directions:"edit directions",L_Directions_See_All_Routes_Comment:"Choose the route you would like to reach your destination.",L_Directions_See_All_Routes_Title:"Routes - ",L_Menu_ReportProblem_Link_Text:"Report a Problem",L_Directions_TimeDistance_Separator:", ",L_Directions_Add_From:"From {0}",L_Directions_Add_To:"To {0}",L_InexactMatch:"An exact match was not found. Use {0} or change the search term.",L_Close:"Close",L_DirectionsTaskDistanceTitle_Text:"Distance",L_Directions_Interpunct:"·",L_Directions_RouteInfo_Ferry:"Takes ferry",L_Directions_RouteInfo_TollRoad:"Toll on route",L_Directions_RouteInfo_LocalRoads:"Local roads",L_Directions_RouteInfo_CrossBorder:"Crosses border",L_Directions_RouteInfo_Unpaved:"Unpaved roads",DirectionRouteInfoActiveAriaLabel:"Selected route summary",DirectionRouteInfoInActiveAriaLabel:"Unselected route summary",L_Transit_Frequency_Text:"every {0} min",L_Transit_Late:"{0} min late",L_Transit_Early:"{0} min early",Directions_Camera_Tip:"View camera at:"};window.$MicrosoftMaps8.ResourceManager?window.$MicrosoftMaps8.ResourceManager.init("DirectionsTask",n):window.$MicrosoftMaps8.ResourcesObject=n})();var r=window.$MicrosoftMaps8,e=r.Internal,gr=r.Calendar=r.Calendar||{},df=r.Tasks=r.Tasks||{},k=r.Directions=r.Directions||{},ht=e.TaskData=e.TaskData||{},nu=r.Transit=r.Transit||{},gt=r.Traffic=r.Traffic||{},gf=e.AdsScenario,bt=r.Anchor,gi=e.BaseTask,kt=e._BaseMapTemplateSelector,ut=e.BaseTaskViewModel,ne=r.BasicTemplate,tu=r.BitmapImageTemplate,iu=r.VectorImageTemplate,te=e._BoundsAccumulator,ru=e._CanvasLabelRenderer,uu=r.CategoriesBar,nt=r.CategoriesBarItemData,fu=r.ChildVectorImageTemplate,ie=ht.CollectionActions,hi=e.ControlTemplate,c=r.DataHandlerKeys,eu=e._Debug,re=e.DefaultPrimitiveCriteria,i=r.GlobalConfig.features.directions,ni=e._EntryPoints,ue=r.GlobalConfig.features.feedback,s=e._Gimme,fe=e.GeolocationProvider,g=r.GlobalConfig,l=r.GlobalDataEventHandler,ee=r.ImageFromCssHelper,u=e._Helper,o=e._JSEvent,oe=e._LatLonCrs,nr=r.LocationRect,ou=e._LruCache,b=r.Location,se=r.MapLayer,ci=e.MapInteractionBehavior,tt=e.MapHelper,he=r.MapView,tr=r.MapMath,su=r.MapTypeId,ir=e._Network,rr=e._ObservableObject,li=e._ObservableCollection,ce=e._ObservableObjectChangedArgs,ur=e._Overlay,le=e._OverlayEntity,ae=g.features.parking,y=r.Point,st=r.GlobalConfig.features.print,hu=e.PrintContent,h=e.PushpinIconType,fr=e._PerfV2Logger,ve=e.ReverseGeocoder,n=r.ResourceManager.DirectionsTask,er=e.RoutePolyline,ti=e.RoutePushpin,ye=e.SpatialMath,pe=e.StaticPromise,cu=e._StreetsidePerfConstants,we=gr.SingleCalendar,lu=r.SimplePointPrimitive,au=r.Size,be=r.CommonControls.SyndicatedAds,a=r.TaskTypes,ke=e.Template,or=r.VectorMapLayer,it=ht.Waypoint,ct=ht.DistanceUnit,rt=ht.Optimize,d=ht.TimeTypes,t=ht.DirectionsMode,sr=r.ZoomLevel,de=e.TipComponents,vu=r.CommonControls.AutosuggestV2,yu=r.CommonControls.MobileAutosuggestV2,ft=r.CommonControls.DirectionsAutosuggestDataModel,pu=r.CommonControls.AutosuggestViewModel,ii=r.CommonControls.SearchHistoryLocalStorageHelper,hr=r.GlobalConfig.features.autosuggest,lt=g.features.streetside,wu=r.TaskPrimitivesZOrderManager,bu=nu.TransitRequester,ri=r.PrimitiveOverlayHelper,cr=e._MapAuthentication,at=e._VectorMath,ui=gt.TrafficPinV2,ge=gt.CameraOverlayEntity,ku=r.BucketPrimitiveTemplateSelector,du=gt.IncidentViewModel,lr=gt.TrafficLocalStorageHelper,no=g.features.traffic,gu='<div class="infoboxOverlay trafficMiniInfobox">    <p>        <TextBlock Text="{Binding primitive.resources.L_Traffic_Camera_Tip}" />    <\/p>    <p>        <TextBlock Text="{Binding primitive.entity.trafficDescription}" />    <\/p><\/div>',nf='<div class="{Binding panelClass}" data-tag="directionsPanel">    <div class="longDistancePanel" style:display="{Binding longDistanceText Converter=nullToDisplayNone}">        <h4>            <a href="#" data-process="{Binding taskOptionFrom}"><TextBlock Text="{Binding longDistanceFrom}" /><\/a>            <TextBlock Text="{Binding longDistanceSeparator}" />            <a href="#" data-process="{Binding taskOptionTo}"><TextBlock Text="{Binding longDistanceTo}" /><\/a>        <\/h4>        <p>            <TextBlock Text="{Binding longDistanceText}" />        <\/p>    <\/div>    <div class="directionsInput" data-tag="directionsInput" style:display="{Binding showWaypoints Converter=boolToDisplay}">\t\t<div class="{Binding optionsClass}">\t\t\t<div class="dirTopRow">\t\t\t\t<div>\t\t\t\t\t<div class="dirModes" data-tag="dirModes">\t\t\t\t\t\t<ItemsControl ItemsSource="{Binding modes}">\t\t\t\t\t\t\t<ItemsControl.ItemTemplate>\t\t\t\t\t\t\t\t<DataTemplate>\t\t\t\t\t\t\t\t\t<a title="{Binding tooltip}" role="button" class="{Binding btnClass}" event:click="onModeClick" href="#" mode="{Binding mode}" aria-pressed="{Binding ariaPressed}"><\/a>\t\t\t\t\t\t\t\t<\/DataTemplate>\t\t\t\t\t\t\t<\/ItemsControl.ItemTemplate>\t\t\t\t\t\t<\/ItemsControl>\t\t\t\t\t<\/div>\t\t\t\t\t<div>\t\t\t\t\t\t<a class="dirBtnOptions dropdownBtn" id="dirBtnOptions" href="#" event:click="onOptionsClick" data-tag="dirBtnOptions" role="button" aria-expanded="false" aria-controls="dirOptsPopup">\t\t\t\t\t\t\t<TextBlock Text="{Binding resources.L_Directions_Options}" />\t\t\t\t\t\t<\/a>\t\t\t\t\t\t<div class="dirOptsSummary" data-tag="dirOptsSummary" style:display="{Binding optionsText Converter=nullToDisplayNone}">\t\t\t\t\t\t\t<a event:click="onOptionsClick" id="dirOptsSummaryBtn" role="button" aria-expanded="false" aria-controls="dirOptsPopup"><TextBlock Text="{Binding optionsText}"/><\/a>\t\t\t\t\t\t<\/div>\t\t\t\t\t<\/div>\t\t\t\t<\/div>\t\t\t<\/div>\t\t\t<div class="dirOptsPopup dropdownPopup" id="dirOptsPopup" data-tag="dirOptsPopup">\t\t\t\t<div class="dirOptsUnits" data-tag="dirOptsUnits" role="radiogroup">                    <p>                        <label>                            <input type="radio" class="radio" checked="{Binding unitsMiles Mode=TwoWay}" data-tag="dirOptsUnitsMiles" role="radio" aria-checked="{Binding unitsMiles}" />                            <TextBlock Text="{Binding resources.L_Directions_Option_Miles}" />                        <\/label>                        <label>                            <input type="radio" class="radio" checked="{Binding unitsKm Mode=TwoWay}" data-tag="dirOptsUnitsKm" role="radio" aria-checked="{Binding unitsKm}" />                            <TextBlock Text="{Binding resources.L_Directions_Option_Km}" />                        <\/label>                    <\/p>\t\t\t\t<\/div>                <div class="dirOptsSortBy" style:display="{Binding mode Converter=displaySortByOptions}" data-tag="dirOptsSortBy" role="radiogroup" aria-labelledby="dirSortById">                    <p id="dirSortById">                        <TextBlock Text="{Binding resources.L_Option_Sort_By}" />                    <\/p>                    <p>                        <label style:display="{Binding showOptimizeTime Converter=boolToDisplay}">                            <input type="radio" class="radio" checked="{Binding optimizeTime Mode=TwoWay}" name="dirOptsSortBy" data-tag="dirOptsSortByTime" role="radio" aria-checked="{Binding optimizeTime}" />                            <TextBlock Text="{Binding resources.L_Option_Sort_By_Time}" />                        <\/label>                        <label style:display="{Binding showOptimizeCost Converter=boolToDisplay}">                            <input type="radio" class="radio" checked="{Binding optimizeCost Mode=TwoWay}" name="dirOptsSortBy" data-tag="dirOptsSortByCost" role="radio" aria-checked="{Binding optimizeCost}" />                            <TextBlock Text="{Binding resources.L_Option_Sort_By_Cost}" />                        <\/label>                        <label style:display="{Binding showOptimizeTransfers Converter=boolToDisplay}">                            <input type="radio" class="radio" checked="{Binding optimizeTransfers Mode=TwoWay}" name="dirOptsSortBy" data-tag="dirOptsSortByTransfers" role="radio" aria-checked="{Binding optimizeTransfers}" />                            <TextBlock Text="{Binding resources.L_Option_Sort_By_Transfers}" />                        <\/label>                    <\/p>                <\/div>                <div class="dirOptsDriving" style:display="{Binding mode Converter=displayIfDriving}" data-tag="dirOptsDriving">                    <table>                        <tbody>                            <tr class="panelRowSpace">                                <td>                                    <CheckBox Content="{Binding resources.L_Directions_Highways}" Checked="{Binding avoidHighways Mode=TwoWay}" Value="" data-tag="dirOptsDrivingHighways" role="checkbox" aria-checked="{Binding avoidHighways}" />                                                                    <\/td>                                <td>                                    <CheckBox Content="{Binding resources.L_Directions_AvoidFerry}" Checked="{Binding avoidFerry Mode=TwoWay}" Value="" data-tag="dirOptsDrivingFerry" role="checkbox" aria-checked="{Binding avoidFerry}" />                                <\/td>                            <\/tr>                            <tr>                                <td>                                    <CheckBox Content="{Binding resources.L_Directions_Tolls}" Checked="{Binding avoidTolls Mode=TwoWay}" Value="" data-tag="dirOptsDrivingTolls" role="checkbox" aria-checked="{Binding avoidTolls}" />                                <\/td>                            <\/tr>                        <\/tbody>                    <\/table>                <\/div>                <div class="dirOptsTransit" style:display="{Binding mode Converter=displaySpecialTransitModeFilter}" data-tag="dirOptsTransit">                    <p style:display="{Binding mode Converter=boolToDisplay}">                        <TextBlock Text="{Binding resources.L_Option_Transit_Mode}" />                    <\/p>                    <p>                        <CheckBox Content="{Binding resources.L_Option_Avoid_Flights}" Checked="{Binding avoidFlights Mode=TwoWay}" Value="" data-tag="dirOptsAvoidFlights" role="checkbox" aria-checked="{Binding avoidFlights}" />                    <\/p>                    <p>                        <CheckBox Content="{Binding resources.L_Option_Avoid_Express_Trains}" Checked="{Binding avoidExpressTrains Mode=TwoWay}" Value="" data-tag="dirOptsAvoidExpressTrains" role="checkbox" aria-checked="{Binding avoidExpressTrains}" />                    <\/p>                    <p class="dirOptsBulletTrains">                        <label>                            <input type="radio" class="radio" checked="{Binding useBulletTrains Mode=TwoWay}" name="dirOptsBulletTrains" data-tag="dirOptsUseBulletTrains" role="checkbox" aria-checked="{Binding useBulletTrains}" />                            <TextBlock Text="{Binding resources.L_Option_Use_Bullet_Trains}" />                        <\/label>                    <\/p>                    <p class="dirOptsBulletTrains">                        <label>                            <input type="radio" class="radio" checked="{Binding avoidBulletTrains Mode=TwoWay}" name="dirOptsBulletTrains" data-tag="dirOptsAvoidBulletTrains" role="checkbox" aria-checked="{Binding avoidBulletTrains}"/>                            <TextBlock Text="{Binding resources.L_Option_Avoid_Bullet_Trains}" />                        <\/label>                    <\/p>                <\/div>                <div class="dirOptsTransit" style:display="{Binding mode Converter=displayTransitModeFilterROW}" data-tag="dirOptsTransit">                    <p style:display="{Binding mode Converter=boolToDisplay}">                        <TextBlock Text="{Binding resources.L_Option_Transit_Mode}" />                    <\/p>                    <table>                        <tbody>                            <tr>                                <td>                                    <CheckBox Content="{Binding resources.L_Transit_Mode_Bus}" Checked="{Binding allowBuses Mode=TwoWay}" Value="" data-tag="dirOptsAllowBuses" role="checkbox" aria-checked="{Binding allowsBuses}" />                                <\/td>                                <td>                                    <CheckBox Content="{Binding resources.L_Transit_Mode_CityRail}" Checked="{Binding allowCityRails Mode=TwoWay}" Value="" data-tag="dirOptsAllowCityRails" role="checkbox" aria-checked="{Binding allowsCityRails}" />                                <\/td>                            <\/tr>                            <tr>                                <td>                                    <CheckBox Content="{Binding resources.L_Transit_Mode_Subway}" Checked="{Binding allowSubways Mode=TwoWay}" Value="" data-tag="dirOptsAllowSubways" role="checkbox" aria-checked="{Binding allowsSubways}" />                                <\/td>                                <td>                                    <CheckBox Content="{Binding resources.L_Transit_Mode_Ferry}" Checked="{Binding allowFerries Mode=TwoWay}" Value="" data-tag="dirOptsAllowFerries" role="checkbox" aria-checked="{Binding allowsFerries}" />                                <\/td>                            <\/tr>                            <tr>                                <td>                                    <CheckBox Content="{Binding resources.L_Transit_Mode_Train}" Checked="{Binding allowTrains Mode=TwoWay}" Value="" data-tag="dirOptsAllowTrains" role="checkbox" aria-checked="{Binding allowsTrains}" />                                <\/td>                            <\/tr>                        <\/tbody>                    <\/table>                <\/div>                <div class="dirOptsSaveHistory" style:display="{Binding enableHistory Converter=boolToDisplay}" data-tag="dirOptsSaveHistory">                    <p>                        <CheckBox Content="{Binding resources.L_Directions_Save_History}" Checked="{Binding saveHistory Mode=TwoWay}" Value="" data-tag="dirOptsSaveHistory" />                    <\/p>                    <p class="dirHistory">                        <a href="#" event:click="onDeleteHistory" class="dirDeleteHistory" style:display="{Binding historyDeleted Converter=boolToNotDisplay}" role="button">                            <TextBlock Text="{Binding resources.L_Directions_Delete_History}" />                        <\/a>                    <\/p>                    <p class="dirHistory dirHistoryDeleted" style:display="{Binding historyDeleted Converter=boolToDisplay}">                        <TextBlock Text="{Binding resources.L_Directions_History_Deleted}" />                    <\/p>                <\/div>\t\t\t<\/div>\t\t<\/div>\t\t<div class="dirWaypoints">            <a href="#" class="backArrowButton" data-tag="dirReturnBtn" role="button"/>\t\t\t<DraggableList ItemsSource="{Binding waypoints}" gripClass="defaultGrip dirWpGrip" tooltip="{Binding resources.L_Directions_Title_Reorder}" scrollContainer="{Binding scrollContainer}" event:onDragComplete="onDragComplete" event:onDragBegin="onDragBegin">\t\t\t\t<DraggableList.ItemTemplate>\t\t\t\t\t<DataTemplate>\t\t\t\t\t\t<div>\t\t\t\t\t\t\t<div class="dirWp" data-tag="dirWp">\t\t\t\t\t\t\t\t<div class="{Binding index Converter=indexToIconClass}" aria-label="{Binding index Converter=indexToWaypointTitle}"><TextBlock Text="{Binding index Converter=indexToIconText}" /><\/div>\t\t\t\t\t\t\t\t<WatermarkedTextInput Watermark="{Binding index Converter=indexToWaypointTitle}" Value="{Binding inputText Mode=TwoWay}" MaxLength="1000" Aria-Label="{Binding inputText}" data-tag="input" />\t\t\t\t\t\t\t\t<a href="#" style:display="{Binding showDelete Converter=boolToDisplay}" role="button" event:click="onDelete" class="dirBtnDelete commonButton deleteButton" title="{Binding resources.L_Directions_Title_Delete}" data-tag="dirBtnDelete"><\/a>\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t\t<div class="dirResolve" style:display="{Binding upHierarchy Converter=nullToDisplayNone}">\t\t\t\t\t\t\t\t<a href="#" event:click="onCloseResolve" class="commonButton deleteButton" title="{Binding resources.L_Close}" data-tag="dirCloseResolve" role="button"><\/a>\t\t\t\t\t\t\t\t<TextBlock Text="{Binding resolveText1}" /><a href="#" event:click="onResolve" role="button"><TextBlock Text="{Binding upHierarchy}" /><\/a><TextBlock Text="{Binding resolveText2}" />\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t<\/div>\t\t\t\t\t<\/DataTemplate>\t\t\t\t<\/DraggableList.ItemTemplate>\t\t\t<\/DraggableList>\t\t<\/div>                 <a class="dirBtnRev" href="#" style:display="{Binding showReverse Converter=boolToDisplay}" event:click="onReverseClick" title="{Binding resources.L_Directions_Title_Reverse}" data-tag="dirBtnRev" role="button"><\/a>        <div class="dirAddBtn" style:display="{Binding allowAddWp Converter=boolToDisplay}">            <a title="{Binding resources.L_Directions_Title_Add}" class="commonButton dirBtnAdd" href="#" event:click="onAddClick" data-tag="dirBtnAdd" role="button">                <span>                    <TextBlock Text="{Binding resources.L_Directions_Title_Add}" />                <\/span>            <\/a>        <\/div>\t\t<div class="{Binding showTimeControls Converter=showTimeControlsToClass}">\t\t\t<div class="drTimeGo">\t\t\t\t<div>\t\t\t\t\t<div class="dirBtnTime" style:display="{Binding mode Converter=displayTimeControls}">\t\t\t\t\t\t<a href="#" event:click="onTimeClick" data-tag="dirBtnTime" role="button" aria-expanded="false" title="{Binding resources.L_Directions_Time_Control_Tip}">\t\t\t\t\t\t\t<div data-tag="dateTimeSummary1"><TextBlock Text="{Binding dateTimeSummary1}"/><\/div>                            <div class="dropdownIcon" data-tag="dateTimeSummary2"><TextBlock Text="{Binding dateTimeSummary2}" /><\/div>\t\t\t\t\t\t<\/a>\t\t\t\t\t<\/div>\t\t\t\t\t<div>\t\t\t\t\t\t<a class="dirBtnGo commonButton" href="#" event:click="onGetDirectionsClick" data-tag="dirBtnGo">                            <TextBlock Text="{Binding resources.L_Directions_Go}" />                        <\/a>\t\t\t\t\t<\/div>\t\t\t\t<\/div>\t\t\t<\/div>\t\t\t<div class="dirProgress MicrosoftMap_progress" style:visibility="{Binding showProgress Converter=boolToVisibility}" aria-label="{Binding resources.L_Directions_Loading}" data-tag="dirProgress"><\/div>            <div class="dirTimePopup dropdownPopup" data-tag="dirTimePopup">                <RadioGroup ItemsSource="{Binding timeTypes}" SelectedItem="{Binding transitTimeType Mode=TwoWay}" />                <!--show TimeControlTemplate and calendar on Desktop-->                <TimeControl Time="{Binding time Mode=TwoWay}" Editing="{Binding EditingTime Mode=TwoWay}" Disabled="{Binding timeCtrlDisabled}" />                <div class="calContainer" data-tag="datePicker"><\/div>                <!--show MobileTimeControlTemplate on Mobile-->                <div class="mobileTimeContainer" style:display="{Binding showMobileTimeControl Converter=boolToDisplay}">                    <MobileTimeControl Time="{Binding time Mode=TwoWay}" Date="{Binding Date Mode=TwoWay}" />                <\/div>            <\/div>        <\/div>\t<\/div>    <div class="editDirectionsButton backEdit separator" style:display="{Binding showEditDirections Converter=boolToDisplay}" event:click="onEditDirectionsClick">        <div class="editDir"><TextBlock Text="{Binding resources.L_Directions_Edit_Directions}" /><\/div>    <\/div>    <div class="seeAllRoutesButton backEdit" style:display="{Binding showEditDirections Converter=boolToDisplay}" event:click="onSeeAllRoutesClick">        <div class="editDir"><TextBlock Text="{Binding resources.L_Directions_See_All_Routes}" /><\/div>    <\/div>\t<div class="dirMessage" style:display="{Binding messageText Converter=nullToDisplayNone}" data-tag="dirMessage" tabindex="0">\t\t<TextBlock Text="{Binding messageText}" />\t<\/div>    <div class="searchboxWithAS" style:display="{Binding showSuggestionsPanel Converter=boolToDisplay}">    <\/div>    <div class="routecategoriesbar" style:display="{Binding showRouteCategoriesPanel Converter=boolToDisplay}"><\/div><\/div>',tf='<div class="{Binding printMode}" data-tag="directionsPanel">  <table>      <tr>          <td class="waypointSummary" data-tag="waypointSummary">              <ItemsControl ItemsSource="{Binding waypoints}" panelTagName="ul">                <ItemsControl.ItemTemplate>                  <DataTemplate>                      <div>                          <table>                              <tr>                                  <td class="waypointTypeLabel">                                      <span class="dirWaypointIcon" data-tag="dirWaypointIcon">                                              <span class="{Binding waypointType Converter=waypointTypeToClass}">                                                  <TextBlock Text="{Binding index Converter=indexToWaypointTypeLabel}" />                                              <\/span>                                      <\/span>                                                                        <\/td>                                  <td class="waypointAddress">                                      <TextBlock Text="{Binding inputText}" />                                  <\/td>                              <\/tr>                          <\/table>                      <\/div>                  <\/DataTemplate>                <\/ItemsControl.ItemTemplate>              <\/ItemsControl>          <\/td>          <td class="routeDetails">              <Tab TabContent="{Binding printTitleViewModel}" TabTemplate="{Binding titlePrintTemplate}" IsDisplayed="true">  <\/Tab>          <\/td>      <\/tr>  <\/table>    <div class="printNotes">        <table>            <tbody>                <tr>                    <td class="waypointAddress">                        <div class="screenNotes">                            <textarea class="waypointNotes" placeholder="{Binding resources.L_Directions_PrintNotesWatermark}" data-tag="printNotes" maxlength="{Binding notesMaxCharSize}"><\/textarea>                        <\/div>                        <div class="printedNotes">                        <\/div>                    <\/td>                <\/tr>            <\/tbody>        <\/table>    <\/div>      <div class="dirInstructions" data-tag="dirInstructions">        <div class="isText showText" data-tag="dirPrintInstructionText">            <Tab TabContent="{Binding printInstructionsViewModel}" TabTemplate="{Binding instructionsPrintTemplate}" IsDisplayed="true">  <\/Tab>        <\/div>        <div class="taskMapPrint isMap showMap directionsMapPrintPageBreak taskMapPrintPageBreak" data-tag="directionsMapPrint">            <div class="printArea" data-tag="printArea">                <div class="printMap" data-tag="printMap">                <\/div>            <\/div>        <\/div>        <div class="dirSourceDestMiniMaps isMap showMap" data-tag="dirSourceDestMiniMaps">            <ItemsControl ItemsSource="{Binding waypoints}">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <div class="{Binding index Converter=indexToOddEvenClass}" data-tag="waypointPrintMaps">                            <p class="waypointHeading" data-tag="waypointHeading">                                <span class="miniMapIndexLetter">                                    <span class="dirWaypointIcon" data-tag="dirWaypointIcon">                                        <span>                                                                                        <span class="{Binding waypointType Converter=waypointTypeToClass}">                                                <TextBlock Text="{Binding index Converter=indexToIconTextStart}" />                                            <\/span>                                        <\/span>                                    <\/span>                                <\/span>                                <span class="miniMapText">                                    <TextBlock Text="{Binding inputText}" />                                <\/span>                            <\/p>                            <img src="{Binding printImagePath}" />                        <\/div>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/div>  <\/div>  <div class="dirAttribution" data-tag="dirAttribution" style:display="{Binding showAttribution Converter=boolToDisplay}">    <span class="dirDataFrom">      <TextBlock Text="{Binding resources.L_Data_Attribution}" />    <\/span>    <span class="dirTransitAttribution" data-tag="dirTransitAttribution">      <TextBlock Text="{Binding attributionText}" />    <\/span>  <\/div>  <div class="dirDisclaimer" data-tag="dirDisclaimer">    <TextBlock Text="{Binding disclaimerText}" />  <\/div><\/div>',ar='<div class="directionsPanel" data-tag="directionsPanel" class="{Binding showSeeAllRoutes Converter=boolToSeeAllRoutesClassName}">    <div class="seeAllRoutesPanel" data-tag="seeAllRoutesPanel" style:display="{Binding showSeeAllRoutes Converter=boolToDisplay}">      <div class="backArrowDiv directionsBack">        <a class="commonButton backArrowButton directionsBackButton" event:click="onSeeAllRoutesReturnClick" href="#" role="button" data-tag="backToDirectionsCardButton">          <div class="directionsBackButtonText">            <TextBlock text="{Binding resources.L_Directions_Back_Button}" />          <\/div>        <\/a>      <\/div>      <div class="editDir dirSeeAllComment"><TextBlock text="{Binding resources.L_Directions_See_All_Routes_Comment}" /><\/div>    <\/div>  <ItemsControl ItemsSource="{Binding directionsResultsTitleSet}" panelTagName="ul">    <ItemsControl.ItemTemplate>      <DataTemplate>        <li class="{Binding isSelected Converter=boolToSelectedTitleClassName}" data-tag="{Binding isSelected Converter=boolToSelectedTitleClassName}">          <a href="#" event:click="onResultsTitleClick" data-tag="directionsRouteLink" role="button" aria-label="{Binding isSelected Converter=routeLinkAriaLabel}">              <table>                  <tr class="drTitleRow">                      <td class="{Binding isSelected Converter=boolToSelectedDurationClassName}">                          <div class="drDurationRoot">                              <table class="{Binding trafficConditionTimeClassName}">                                  <tr>                                      <td style:display="{Binding hours Converter=nullToDisplayNone}">                                          <div class="drHours" data-tag="drHours">                                               <TextBlock Text="{Binding hours}" />                                          <\/div>                                          <div class="drHoursLabel" data-tag="drHoursLabel">                                              <TextBlock Text="{Binding resources.L_Directions_Hour}" />                                          <\/div>                                      <\/td>                                      <td class="hoursMinsSeparator" style:display="{Binding hours Converter=nullToDisplayNone}">                                         <TextBlock Text="{Binding resources.L_Directions_Hour_Min_Separator}" />                                      <\/td>                                      <td>                                          <div class="drMins" data-tag="drMins">                                               <TextBlock Text="{Binding minutes}" />                                          <\/div>                                          <div class="drMinsLabel" data-tag="drMinsLabel">                                              <TextBlock Text="{Binding resources.L_Directions_Minute}" />                                          <\/div>                                      <\/td>                                  <\/tr>                              <\/table>                          <\/div>                      <\/td>                      <td>                          <div class="drTitleRoot">                            <table class="drTitleTable">                              <tr>                                  <td>                                      <div class="lineOne">                                          <div class="{Binding trafficConditionClassName}" style:display="{Binding trafficCondition Converter=nullToDisplayNone}" data-tag="descriptionTrafficCondition">                                              <TextBlock Text="{Binding trafficCondition}" />                                          <\/div>                                          <div class="drTitleDelay" style:display="{Binding descriptionTimeNoTraffic Converter=nullToDisplayNone}" data-tag="descriptionTimeNoTraffic">                                              <span class="interpunct">                                                  <TextBlock Text="{Binding resources.L_Directions_Interpunct}" />                                              <\/span>                                              <TextBlock Text="{Binding descriptionTimeNoTraffic}" />                                          <\/div>                                          <div class="drTitleLeft titleFont" style:display="{Binding mainTitle Converter=nullToDisplayNone}">                                              <TextBlock Text="{Binding mainTitle}" />                                          <\/div>                                      <\/div>                                      <div class="lineTwo">                                          <div class="drTitleText" style:display="{Binding descriptionVia Converter=nullToDisplayNone}">                                              <span data-tag="descriptionVia">                                                  <TextBlock Text="{Binding descriptionVia}" />                                              <\/span>                                              <span class="drCost" style:display="{Binding cost Converter=nullToDisplayNone}" data-tag="descriptionCost">                                                  <TextBlock Text="{Binding cost}" />                                              <\/span>                                                                                        <\/div>                                          <div class="drTitleText">                                              <span style:display="{Binding embellishment Converter=nullToDisplayNone}" data-tag="descriptionEmbellishment">                                                  <span class="interpunct" style:display="{Binding descriptionVia Converter=nullToDisplayNone}">                                                      <TextBlock Text="{Binding resources.L_Directions_Interpunct}" />                                                  <\/span>                                                  <span class="{Binding embellishment Converter=stringToEmbellishmentClassName}">                                                      <span class="{Binding isLate Converter=boolToEmbellishmentClassName}">                                                          <span class="{Binding isTransitEmbellishment Converter=boolToTransitEmbellishmentClassName}">                                                              <TextBlock Text="{Binding embellishment}" />                                                          <\/span>                                                      <\/span>                                                  <\/span>                                              <\/span>                                              <span class="drFreqency" style:display="{Binding frequency Converter=nullToDisplayNone}" data-tag="descriptionFreq">                                                  <span class="interpunct">                                                      <TextBlock Text="{Binding resources.L_Directions_Interpunct}" />                                                  <\/span>                                                  <TextBlock Text="{Binding frequency}" />                                              <\/span>                                          <\/div>                                      <\/div>                                  <\/td>                                <td class="drTitleRight" data-tag="descriptionDistance">                                  <TextBlock Text="{Binding subtitle}" />                                <\/td>                              <\/tr>                            <\/table>                            <table class="drTimeline" style:display="{Binding timelineSegments Converter=nullToDisplayNone}" style:width="{Binding timelineWidth Converter=fractionToPercent}" data-tag="drTimeline">                              <ItemsControl ItemsSource="{Binding timelineSegments}" panelTagName="tr">                                <ItemsControl.ItemTemplate>                                  <DataTemplate>                                    <td style:width="{Binding width Converter=fractionToPercent}" class="{Binding className}" data-tag="drTimelineCell">                                      <div style:background-color="{Binding lineColor}"><\/div>                                      <span class="dirSvg svg"><\/span>                                    <\/td>                                    <\/DataTemplate>                                <\/ItemsControl.ItemTemplate>                              <\/ItemsControl>                            <\/table>                        <\/div>                     <\/td>                 <\/tr>              <\/table>          <\/a>        <\/li>      <\/DataTemplate>    <\/ItemsControl.ItemTemplate>  <\/ItemsControl>\t<div data-tag="dirInstructions" style:display="{Binding showSeeAllRoutes Converter=boolToNotDisplay}">        <div class="dirPrintText" data-tag="dirPrintText" style:display="{Binding isSDK Converter=boolToNotDisplay}">            <a style:display="{Binding showPrint Converter=boolToDisplay}" href="#" role="button" event:click="onPrintDirectionsClick" aria-label="{Binding resources.L_Directions_Print}">                <TextBlock Text="{Binding resources.L_Directions_Print}" />            <\/a>        <\/div>\t\t<ItemsControl ItemsSource="{Binding directionsResultsListSet}">\t\t\t<ItemsControl.ItemTemplate>\t\t\t\t<DataTemplate>\t\t\t\t\t<div style:display="{Binding showResults Converter=boolToDisplay}" data-tag="dirInstructionsList" event:mouseleave="onInstructionsMouseLeave" event:blur="onInstructionsMouseLeave">                        <ItemsControl ItemsSource="{Binding routeLegs}" panelTagName="div">\t\t\t\t\t\t\t<ItemsControl.ItemTemplate>\t\t\t\t\t\t\t\t<DataTemplate>\t\t\t\t\t\t           <div class="{Binding legClassName}" data-tag="dirLegContainer">                                         <div data-index="{Binding index}" class="dirRouteLegTable" event:click="onLegTitleClick" style:display="{Binding showLegTitle Converter=boolToDisplay}" data-tag="routeLegTable">                                                 <div style:display="table-row">                                                     <div class="legSpace" style:display="table-cell"><\/div>                                                     <div class="dirLegIcons" style:display="{Binding showInstructions Converter=boolToNotDisplay}" data-tag="dirLegIconContainer">                                                         <div>                                                             <div class="{Binding index Converter=indexToStartClass}" data-tag="dirLegIcon">                                                                 <TextBlock Text="{Binding index Converter=indexToIconTextStart}" />                                                             <\/div>                                                             <div class="dirLegIconsGap" data-tag="dirLegIconsGap"><\/div>                                                             <div class="{Binding index Converter=indexToEndClass}" data-tag="dirLegIcon">                                                                 <TextBlock Text="{Binding index Converter=indexToIconTextEnd}" />                                                             <\/div>                                                         <\/div>                                                     <\/div>                                                     <div style:display="table-cell">                                                         <div data-tag="dirLegRouteInfoContainer">                                                             <div class="dirLegTimeDistText" data-tag="dirLegTimeDistText">                                                                 <TextBlock Text="{Binding timeDistanceText}" />                                                             <\/div>                                                             <div class="dirLegTitle" data-tag="dirLegTitle">                                                                 <TextBlock text="{Binding legTitle}" />                                                             <\/div>                                                         <\/div>                                                     <\/div>                                                     <div style:display="table-cell">                                                         <div data-tag="arrow" class="{Binding showInstructions Converter=showGroupToClass}"><\/div>                                                     <\/div>                                                 <\/div>                                         <\/div>                                       <div class="{Binding legInstructionsClassName}"  style:display="{Binding showInstructions Converter=boolToDisplay}" data-tag="dirInstructionContainer">                                         <ItemsControl ItemsSource="{Binding instructionSteps}" panelTagName="div">\t\t\t\t\t\t\t                <ItemsControl.ItemTemplate>\t\t\t\t\t\t\t\t                <DataTemplate>                                                    <div style:display="{Binding show Converter=boolToDisplay}" class="{Binding cssClass}" role="{Binding role}" tabindex="0" event:click="onInstructionClick" event:mouseenter="onMouseEnter" event:keydown="onInstructionKeyDown" event:focus="onMouseEnter" data-tag="dirInstruction">                                                        <div class="bm_dirInstructionRow">                                                            <div style:display="table-cell"><\/div>                                                            <div style:display="table-cell"><\/div>                                                            <div style:display="table-cell"><\/div>                                                            <div style:display="table-cell"><\/div>                                                        <\/div>                                                        <div class="bm_dirInstructionRow">                                                            <div style:border-color="{Binding transitLineColor}" class="bm_dirLeftSpace">                                                                <TextBlock Text="{Binding timeText}" />                                                            <\/div>                                                            <div style:display="table-cell" aria-hidden="true" style:visibility="{Binding showIcon Converter=boolToVisibility}">                                                                <div class="{Binding transitLineColor Converter=lineColorToIconClass}" style:background-color="{Binding transitLineColor}">                                                                    <TextBlock Text="{Binding iconText}" />                                                                    <div class="dirSvg svg"><\/div>                                                                    <img src="{Binding roadShieldUrl}" style:display="{Binding roadShieldUrl Converter=nullToDisplayNone}" />                                                                <\/div>                                                            <\/div>                                                            <div class="dirInstruction">                                                                <p style:display="{Binding isClickable Converter=boolToNotDisplay}">                                                                    <TextBlock Text="{Binding stepText}" />                                                                <\/p>                                                                <a data-q="{Binding stepText}" data-eid="{Binding entityId}" data-sf="{Binding searchFilter}" style:display="{Binding isClickable Converter=boolToDisplay}" href="#" event:click="onStepTextClick" aria-label="{Binding waypointTitle}">                                                                    <TextBlock Text="{Binding stepText}" />                                                                <\/a>                                                                <p style:display="{Binding startTimeHint Converter=nullToDisplayNone}">                                                                    <TextBlock Text="{Binding startTimeHint}" />                                                                <\/p>                                                                <p style:display="{Binding endTimeHint Converter=nullToDisplayNone}">                                                                    <TextBlock Text="{Binding endTimeHint}" />                                                                <\/p>                                                                <p style:display="{Binding stepAddress Converter=nullToDisplayNone}">                                                                    <TextBlock Text="{Binding stepAddress}" />                                                                <\/p>                                                                <ItemsControl ItemsSource="{Binding viaPoints}">                                                                    <ItemsControl.ItemTemplate>                                                                        <DataTemplate>                                                                            <p class="dirVia">                                                                                <span>                                                                                    <TextBlock Text="{Binding text}" />                                                                                <\/span>                                                                                <a href="#" event:click="onRemoveViaClick" role="button" data-wpi="{Binding waypointIndex}" data-vwpi="{Binding viaPointIndex}" aria-label="{Binding removeLinkText}">                                                                                    <TextBlock Text="{Binding removeLinkText}" />                                                                                <\/a>                                                                            <\/p>                                                                        <\/DataTemplate>                                                                    <\/ItemsControl.ItemTemplate>                                                                <\/ItemsControl>                                                                <ItemsControl ItemsSource="{Binding childSteps}">                                                                    <ItemsControl.ItemTemplate>                                                                        <DataTemplate>                                                                            <p>                                                                                <TextBlock Text="{Binding stepText}" />                                                                            <\/p>                                                                        <\/DataTemplate>                                                                    <\/ItemsControl.ItemTemplate>                                                                <\/ItemsControl>                                                                <div style:display="{Binding showHints Converter=boolToDisplay}">                                                                    <ItemsControl ItemsSource="{Binding hints}">                                                                        <ItemsControl.ItemTemplate>                                                                            <DataTemplate>                                                                                <p class="dirHint" data-tag="dirHint">                                                                                    <TextBlock Text="{Binding text}" />                                                                                <\/p>                                                                            <\/DataTemplate>                                                                        <\/ItemsControl.ItemTemplate>                                                                    <\/ItemsControl>                                                                <\/div>                                                                <div style:display="{Binding showWarnings Converter=boolToDisplay}">                                                                    <ItemsControl ItemsSource="{Binding warnings}">                                                                        <ItemsControl.ItemTemplate>                                                                            <DataTemplate>                                                                                <p class="{Binding severity Converter=getWarningIconClass}" data-tag="{Binding severity Converter=getWarningIconClass}">                                                                                    <TextBlock Text="{Binding text}" />                                                                                <\/p>                                                                            <\/DataTemplate>                                                                        <\/ItemsControl.ItemTemplate>                                                                    <\/ItemsControl>                                                                <\/div>                                                                <p class="dirSpecialAttribution" data-tag="dirSpecialAttribution" style:display="{Binding specialAttributionUri Converter=nullToDisplayNone}">                                                                    <TextBlock Text="{Binding resources.L_Data_Special_Attribution}" />                                                                    <a href="{Binding specialAttributionUri}" target="_blank">                                                                        <TextBlock Text="{Binding specialAttributionLink}" />                                                                    <\/a>                                                                <\/p>                                                                <a href="#" role="button" style:display="{Binding showNearbyParking Converter=boolToDisplay}" event:click="onNearbyParkingClick">                                                                    <TextBlock Text="{Binding resources.L_Nearby_Parking}" />                                                                <\/a>                                                            <\/div>                                                            <div class="bm_dirInstructionArrow">                                                                <div data-tag="arrow" class="{Binding showGroup Converter=showGroupToClass}" style:display="{Binding groupItems Converter=arrayToDisplay}">                                                                <\/div>                                                            <\/div>                                                        <\/div>                                                        <div class="bm_dirInstructionRow">                                                            <div class="bm_dirLeftSpace" style:display="{Binding travelDistanceText Converter=nullToDisplayNone}" data-tag="dirInstructionTravelDistance">                                                                <div class="dirInstructionTravelDistance">                                                                    <TextBlock Text="{Binding travelDistanceText}" />                                                                <\/div>                                                            <\/div>                                                            <div style:display="table-cell"><\/div>                                                            <div style:display="table-cell"><\/div>                                                            <div style:display="table-cell"><\/div>                                                        <\/div>                                                        <div class="bm_dirInstructionRow">                                                            <div style:display="table-cell"><\/div>                                                            <div style:display="table-cell"><\/div>                                                            <div style:display="table-cell"><\/div>                                                            <div style:display="table-cell"><\/div>                                                        <\/div>                                                                                                            <\/div>                                                <\/DataTemplate>\t\t\t\t\t\t\t                <\/ItemsControl.ItemTemplate>\t\t\t\t\t\t                 <\/ItemsControl>                                       <\/div>                                   <\/div>                                 <\/DataTemplate>\t\t\t                <\/ItemsControl.ItemTemplate>\t\t               <\/ItemsControl>\t\t\t\t\t<\/div>\t\t\t\t<\/DataTemplate>\t\t\t<\/ItemsControl.ItemTemplate>\t\t<\/ItemsControl>    <\/div>    <div class="reportProblemLink" data-tag="reportProblemLink" style:display="{Binding isSDK Converter=boolToNotDisplay}">       <a href="#" event:click="reportProblem" role="button" aria-label="{Binding resources.L_Report_Problem_Link}">           <TextBlock Text="{Binding resources.L_Report_Problem_Link}" />       <\/a>    <\/div>    <div class="dirAttribution" data-tag="dirAttribution" style:display="{Binding showAttribution Converter=boolToDisplay}">        <TextBlock Text="{Binding resources.L_Data_Attribution}" />        <ItemsControl ItemsSource="{Binding transitAttributions}">            <ItemsControl.ItemTemplate>                <DataTemplate>                    <p>                        <a href="{Binding uri}" target="_blank" class="{Binding uri Converter=emptyUriToClass}" data-tag="dirTransitAttribution">                            <TextBlock Text="{Binding agencyName}" />                        <\/a>                    <\/p>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>    <\/div>    <div class="dirDisclaimer" data-tag="dirDisclaimer" style:display="{Binding showDisclaimer Converter=boolToDisplay}">    <TextBlock Text="{Binding disclaimerText}" />    <\/div>    <div class="dirTransitLogo" data-tag="dirTransitLogo" style:display="{Binding showTransitLogo Converter=boolToDisplay}">    <\/div><\/div>',rf='<div class="dragOverlay" data-events-for="ms-composite">    <div class="dragPin" style:visibility="{Binding ShowPin Converter=boolToVisibility}"><\/div>    <div class="clear"><\/div>    <div class="dragPinMessage" style:visibility="{Binding ShowTip Converter=boolToVisibility}">        <p style:display="{Binding ShowDragTip Converter=boolToDisplay}">            <TextBlock Text="{Binding resources.L_Directions_Drag_Pin_Tip}"/>        <\/p>        <p style:display="{Binding ShowPreviewTip Converter=boolToDisplay}">            <TextBlock Text="{Binding resources.L_Directions_Turn_Preview_Tip}"/>        <\/p>    <\/div><\/div>',uf='<div>  <div style:display="{Binding showResults Converter=boolToDisplay}" data-tag="dirInstructionsList" event:mouseleave="onInstructionsMouseLeave">    <ItemsControl ItemsSource="{Binding routeLegs}" panelTagName="div">      <ItemsControl.ItemTemplate>        <DataTemplate>          <div class="{Binding legClassName}" data-tag="dirLegContainer">            <div data-index="{Binding index}" style:display="{Binding showLegTitle Converter=boolToDisplay}" data-tag="routeLegTable">                <div class="dirLegIcons" data-tag="dirLegIconContainer">                    <div>                        <span class="dirStartLegIcon" data-tag="dirStartLegIcon">                            <span>                                                                <span class="{Binding startIconType Converter=waypointTypeToClass}">                                    <TextBlock  Text="{Binding index Converter=indexToIconTextStart}" />                                <\/span>                            <\/span>                        <\/span>                        <span class="legFromTo">                            <TextBlock Text="{Binding resources.L_Directions_Leg_To}" />                        <\/span>                        <span class="dirEndLegIcon" data-tag="dirEndLegIcon">                            <span>                                <span class="{Binding endIconType Converter=waypointTypeToClass}">                                    <TextBlock  Text="{Binding index Converter=indexToIconTextEnd}" />                                <\/span class="dirLegIconText">                            <\/span>                        <\/span>                                                    <\/div>                <\/div>                <div>                    <div class="dirLegRouteInfoContainer" data-tag="dirLegRouteInfoContainer">                        <p class="dirLegTimeDistText" data-tag="dirLegTimeDistText">                            <TextBlock Text="{Binding timeDistanceText}" />                        <\/p>                    <\/div>                <\/div>            <\/div>            <div class="startWaypointTitle" data-tag="startWaypointTitle" >                <span class="dirStartLegIcon" data-tag="dirStartLegIcon">                    <span>                                                <span class="{Binding startIconType Converter=waypointTypeToClass}">                            <TextBlock Text="{Binding index Converter=indexToIconTextStart}" />                        <\/span>                    <\/span>                <\/span>                <span class="waypointAddressTitle">                    <TextBlock Text="{Binding startWaypointAddress}" />                <\/span>            <\/div>              <div class="dirInstructionContainer">                  <div class="{Binding legInstructionsClassName}" style:display="{Binding showInstructions Converter=boolToDisplay}" data-tag="dirInstructionContainer">                      <ItemsControl ItemsSource="{Binding instructionSteps}" panelTagName="ul">                          <ItemsControl.ItemTemplate>                              <DataTemplate>                                  <li class="instructionContainer" style:display="{Binding show Converter=boolToDisplay}">                                      <div class="directionsStepOuterBox">                                          <div class="wrapper">                                              <div class="{Binding parentStepIndex Converter=indexToOddEvenBackgroundClass}">                                              <\/div>                                          <\/div>                                          <div class="instructionStep">                                              <table>                                                  <tbody style:display="{Binding show Converter=boolToDisplay}" class="{Binding cssClass}" event:click="onInstructionClick" event:mouseenter="onMouseEnter" data-tag="dirInstruction">                                                      <tr><th colspan="5"><\/th><\/tr>                                                      <tr>                                                          <td class="printDirIcon">                                                              <table>                                                                  <tr>                                                                      <td class="transitTimeText">                                                                          <div>                                                                              <TextBlock Text="{Binding timeText}" />                                                                          <\/div>                                                                      <\/td>                                                                      <td>                                                                          <div class="dirIcon">                                                                              <div class="dirSvg svg"><\/div>                                                                              <img src="{Binding roadShieldUrl}" style:display="{Binding roadShieldUrl Converter=nullToDisplayNone}" />                                                                          <\/div>                                                                      <\/td>                                                                  <\/tr>                                                              <\/table>                                                          <\/td>                                                          <td class="instructionStepIndex">                                                              <div style:display="{Binding stepIndex Converter=nullToDisplayNone}">                                                                  <TextBlock Text="{Binding stepIndex}" />                                                                  <TextBlock Text="{Binding resources.L_Print_InstructionIndexSeparator}" />                                                              <\/div>                                                          <\/td>                                                          <td class="dirInstruction">                                                              <p>                                                                  <FormattedTextBlock Formattedtext="{Binding formattedText}" />                                                              <\/p>                                                              <p style:display="{Binding stepAddress Converter=nullToDisplayNone}">                                                                  <TextBlock Text="{Binding stepAddress}" />                                                              <\/p>                                                              <ItemsControl ItemsSource="{Binding viaPoints}">                                                                  <ItemsControl.ItemTemplate>                                                                      <DataTemplate>                                                                          <p class="dirVia">                                                                              <span>                                                                                  <TextBlock Text="{Binding text}" />                                                                              <\/span>                                                                              <a href="#" event:click="onRemoveViaClick" data-wpi="{Binding waypointIndex}" data-vwpi="{Binding viaPointIndex}">                                                                                  <TextBlock Text="{Binding removeLinkText}" />                                                                              <\/a>                                                                          <\/p>                                                                      <\/DataTemplate>                                                                  <\/ItemsControl.ItemTemplate>                                                              <\/ItemsControl>                                                              <ItemsControl ItemsSource="{Binding childSteps}">                                                                  <ItemsControl.ItemTemplate>                                                                      <DataTemplate>                                                                          <p>                                                                              <FormattedTextBlock Formattedtext="{Binding formattedText}" />                                                                          <\/p>                                                                      <\/DataTemplate>                                                                  <\/ItemsControl.ItemTemplate>                                                              <\/ItemsControl>                                                              <ItemsControl ItemsSource="{Binding hints}">                                                                  <ItemsControl.ItemTemplate>                                                                      <DataTemplate>                                                                          <p class="dirHint" data-tag="dirHint">                                                                              <TextBlock Text="{Binding text}" />                                                                          <\/p>                                                                      <\/DataTemplate>                                                                  <\/ItemsControl.ItemTemplate>                                                              <\/ItemsControl>                                                              <ItemsControl ItemsSource="{Binding warnings}">                                                                  <ItemsControl.ItemTemplate>                                                                      <DataTemplate>                                                                          <p class="{Binding severity Converter=getWarningIconClass}" data-tag="{Binding severity Converter=getWarningIconClass}">                                                                              <TextBlock Text="{Binding text}" />                                                                          <\/p>                                                                      <\/DataTemplate>                                                                  <\/ItemsControl.ItemTemplate>                                                              <\/ItemsControl>                                                              <p class="dirSpecialAttribution" data-tag="dirSpecialAttribution" style:display="{Binding specialAttributionUri Converter=nullToDisplayNone}">                                                                  <TextBlock Text="{Binding resources.L_Data_Special_Attribution}" />                                                                  <a href="{Binding specialAttributionUri}" target="_blank">                                                                      <TextBlock Text="{Binding specialAttributionLink}" />                                                                  <\/a>                                                              <\/p>                                                              <a href="#" style:display="{Binding showNearbyParking Converter=boolToDisplay}" event:click="onNearbyParkingClick">                                                                  <TextBlock Text="{Binding resources.L_Nearby_Parking}" />                                                              <\/a>                                                          <\/td>                                                          <td class="dirTravelDistance" style:display="{Binding travelDistanceText Converter=nullToDisplayNone}" data-tag="dirInstructionTravelDistance">                                                              <span>                                                                  <TextBlock Text="{Binding travelDistanceText}" />                                                              <\/span>                                                              <span class="dirTravelTime" style:display="{Binding travelDurationText Converter=nullToDisplayNone}" data-tag="dirInstructionTravelTime">                                                                  <span>                                                                      <TextBlock Text="{Binding resources.L_Directions_TimeDistance_Separator}" />                                                                      <TextBlock Text="{Binding travelDurationText}" />                                                                  <\/span>                                                              <\/span>                                                          <\/td>                                                      <\/tr>                                                      <tr><th colspan="5"><\/th><\/tr>                                                  <\/tbody>                                              <\/table>                                          <\/div>                                      <\/div>                                  <\/li>                              <\/DataTemplate>                          <\/ItemsControl.ItemTemplate>                      <\/ItemsControl>                  <\/div>              <\/div>            <div class="endWaypointTitle" data-tag="endWaypointTitle">                <span class="dirEndLegIcon" data-tag="dirEndLegIcon">                    <span>                                                <span class="{Binding endIconType Converter=waypointTypeToClass}">                            <TextBlock Text="{Binding index Converter=indexToIconTextEnd}" />                        <\/span>                    <\/span>                <\/span>                <span class="waypointAddressTitle">                    <TextBlock Text="{Binding endWaypointAddress}" />                <\/span>            <\/div>          <\/div>        <\/DataTemplate>      <\/ItemsControl.ItemTemplate>    <\/ItemsControl>  <\/div><\/div>',ff='<div class="{Binding LabelRootClass}"  style:z-index="{Binding ZIndex}" data-tag="{Binding LabelRootClass}">    <p data-tag="routeLabelTime">            <TextBlock Text="{Binding TimeText}"/>    <\/p>    <p data-tag="routeLabelDistance">            <TextBlock Text="{Binding DistanceText}"/>    <\/p><\/div>',ef='<div>    <li style:display="{Binding isSelected Converter=boolToDisplay}" data-tag="{Binding isSelected Converter=boolToSelectedTitleClassName}">        <a href="#" data-tag="directionsRouteLink">            <table class="routeSummary">                <tr>                    <td class="routeSummaryTitle">                        <div class="{Binding isSelected Converter=boolToSelectedDurationClassName}">                            <div class="drDurationRoot">                                <div class="drDurationTable">                                    <div class="drHrDisplay" style:display="{Binding hours Converter=nullToDisplayNone}">                                        <span class="drHours" data-tag="drHours">                                            <TextBlock Text="{Binding hours}" />                                        <\/span>                                        <span class="drHoursLabel" data-tag="drHoursLabel">                                            <TextBlock Text="{Binding resources.L_Directions_Hour}" />                                        <\/span>                                    <\/div>                                    <div class="hoursMinsSeparator" style:display="{Binding hours Converter=nullToDisplayNone}">                                        <TextBlock Text="{Binding resources.L_Directions_Hour_Min_Separator}" />                                    <\/div>                                    <div class="drMinDisplay">                                        <span class="drMins" data-tag="drMins">                                            <TextBlock Text="{Binding minutes}" />                                        <\/span>                                        <span class="drMinsLabel" data-tag="drMinsLabel">                                            <TextBlock Text="{Binding resources.L_Directions_Minute}" />                                        <\/span>                                    <\/div>                                <\/div>                            <\/div>                        <\/div>                        <div class="drTitleRight" data-tag="descriptionDistance">                            <div class="timeDistanceSeparator" style:display="{Binding routeMode Converter=modeToDisplay}">                                <TextBlock Text="{Binding resources.L_Directions_TimeDistance_Separator}" />                            <\/div>                            <TextBlock Text="{Binding subtitle}" />                        <\/div>                    <\/td>                <\/tr>                <tr>                    <td class="routeDetails">                        <div class="drTitleRoot">                            <table class="drTitleTable">                                <tr>                                <td>                                    <span class="{Binding trafficConditionClassName}" style:display="{Binding trafficCondition Converter=nullToDisplayNone}" data-tag="descriptionTrafficCondition">                                        <TextBlock Text="{Binding trafficCondition}" />                                    <\/span>                                    <span class="drTitleLeft titleFont" style:display="{Binding mainTitle Converter=nullToDisplayNone}">                                        <TextBlock Text="{Binding mainTitle}" />                                    <\/span>                                              <span class="drTitleText" style:display="{Binding descriptionTimeNoTraffic Converter=nullToDisplayNone}" data-tag="descriptionTimeNoTraffic">                                        <TextBlock Text=" (" />                                        <TextBlock Text="{Binding descriptionTimeNoTraffic}" />                                        <TextBlock Text=")" />                                    <\/span>                                            <div class="drTitleText" style:display="{Binding descriptionVia Converter=nullToDisplayNone}" data-tag="descriptionVia">                                        <span>                                            <TextBlock Text="{Binding descriptionVia}" />                                        <\/span>                                        <span class="drFreqency" style:display="{Binding frequency Converter=nullToDisplayNone}" data-tag="descriptionFreq">                                            <span class="interpunct">                                                <TextBlock Text="{Binding resources.L_Directions_Interpunct}" />                                            <\/span>                                            <TextBlock Text="{Binding frequency}" />                                        <\/span>                                    <\/div>                                    <span style:display="{Binding embellishment Converter=nullToDisplayNone}" data-tag="descriptionEmbellishment">                                        <span class="interpunct">                                            <TextBlock Text="{Binding resources.L_Directions_Interpunct}" />                                        <\/span>                                        <span class="{Binding embellishment Converter=stringToEmbellishmentClassName}">                                            <span class="{Binding isLate Converter=boolToEmbellishmentClassName}">                                                <TextBlock Text="{Binding embellishment}" />                                            <\/span>                                        <\/span>                                                                        <\/span>                                <\/td>                                <\/tr>                            <\/table>                            <table class="drTimeline" style:display="{Binding timelineSegments Converter=nullToDisplayNone}" style:width="{Binding timelineWidth Converter=fractionToPercent}" data-tag="drTimeline">                                <ItemsControl ItemsSource="{Binding timelineSegments}" panelTagName="tr">                                <ItemsControl.ItemTemplate>                                    <DataTemplate>                                    <td style:width="{Binding width Converter=fractionToPercent}" class="{Binding className}" data-tag="drTimelineCell">                                        <div><\/div>                                        <span class="svg"><\/span>                                    <\/td>                                    <\/DataTemplate>                                <\/ItemsControl.ItemTemplate>                                <\/ItemsControl>                            <\/table>                        <\/div>                    <\/td>                <\/tr>            <\/table>        <\/a>    <\/li><\/div>',p=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),fi=[new nt("attractionsIcon",n.L_Directions_Categories_Bar_Entity_Attractions,0,"Attractions","90012"),new nt("hotelsIcon",n.L_Directions_Categories_Bar_Entity_Hotels,1,"TravelAccomodations","91572"),new nt("restaurantsIcon",n.L_Directions_Categories_Bar_Entity_Restaurants,2,"Restaurants","90287"),new nt("coffeeIcon",n.L_Directions_Categories_Bar_Entity_Coffee,3,"Coffee","91649"),new nt("gasStationsIcon",n.L_Directions_Categories_Bar_Entity_GasStations,4,"GasStations","90089"),new nt("groceryStoresIcon",n.L_Directions_Categories_Bar_Entity_GroceryStores,5,"Supermarkets","91493")],of=[new nt("attractionsIcon",n.L_Directions_Categories_Bar_Entity_Attractions,0,"Attractions","90012"),new nt("hotelsIcon",n.L_Directions_Categories_Bar_Entity_Hotels,1,"TravelAccomodations","91572"),new nt("restaurantsIcon",n.L_Directions_Categories_Bar_Entity_Restaurants,2,"Restaurants","90287"),new nt("fastFoodIcon",n.L_Directions_Categories_Bar_Entity_FastFood,6,"FastFood","90287"),new nt("gasStationsIcon",n.L_Directions_Categories_Bar_Entity_GasStations,4,"GasStations","90089"),new nt("groceryStoresIcon",n.L_Directions_Categories_Bar_Entity_GroceryStores,5,"Supermarkets","91493")],f;(function(n){n[n.Success=0]="Success";n[n.UnknownError=1]="UnknownError";n[n.CantFindNearbyRoad=2]="CantFindNearbyRoad";n[n.TooFar=3]="TooFar";n[n.NoSolution=4]="NoSolution";n[n.DataSourceNotFound=5]="DataSourceNotFound";n[n.CacheMiss=6]="CacheMiss";n[n.NoAvailableTransitTrip=7]="NoAvailableTransitTrip";n[n.TransitStopsTooClose=8]="TransitStopsTooClose";n[n.WalkingBestAlternative=9]="WalkingBestAlternative";n[n.OutOfTransitBounds=10]="OutOfTransitBounds";n[n.TimeoutOccurred=11]="TimeoutOccurred";n[n.SkpError=12]="SkpError";n[n.NoNearbyStops=13]="NoNearbyStops";n[n.RateLimiterRejected=14]="RateLimiterRejected";n[n.ParameterValidationError=15]="ParameterValidationError";n[n.atleastTwoWaypointRequired=16]="atleastTwoWaypointRequired";n[n.generalError=17]="generalError";n[n.noResults=18]="noResults";n[n.searchServiceFailed=19]="searchServiceFailed";n[n.otherError=20]="otherError"})(f||(f={}));var sf=function(t){function i(i){var u=this,r={};return u=t.call(this,r,i,rf)||this,r.defineProperty("showTip",null,null,{defaultValue:!1}),r.defineProperty("showPin",null,null,{defaultValue:!1}),r.defineProperty("showDragTip",null,null,{defaultValue:!1}),r.defineProperty("showPreviewTip",null,null,{defaultValue:!1}),u.resources=n,u}return p(i,t),i}(ut),hf=function(n){function t(t){var i=this,r=new b(0,0),u=new y(0,0);return i=n.call(this,null,r,u)||this,i._overlayViewModel=new sf(t),i.setOverlayElement(i._overlayViewModel.getControl()),i}return p(t,n),t.prototype.setShowTip=function(n,t){var i=n||t;i&&(this._overlayViewModel.setShowDragTip(n),this._overlayViewModel.setShowPreviewTip(t));this._overlayViewModel.setShowTip(i)},t.prototype.setShowPin=function(n){this._overlayViewModel.setShowPin(n)},t}(ur),ai=function(){function n(n,t,i){this._map=t;this._controlTemplateFactory=i;this._routePins=[];this.routeLinePoints=[];this._primitivesPins=[];this._index=n;this._polylines=[];this._trafficPins=[];this._taskState=1}return n.prototype.select=function(){this._isCurrentlySelected=!0;this._updatePrimitives();this._labelOverlay&&this._labelOverlay.setIsSelected(!0);this._trafficPins&&this._trafficPins.length&&w.logInstrumentationEvent(v.CAM,{CTC:this._trafficPins.length})},n.prototype.unSelect=function(){this._isCurrentlySelected=!1;this._updatePrimitives();this._labelOverlay&&this._labelOverlay.setIsSelected(!1)},n.prototype.show=function(){this._updatePrimitives()},n.prototype.setTaskPrimitiveState=function(n){this._taskState=n;this._taskState===1?this.showLabel():this.hideLabel();this._updatePrimitives()},n.prototype.createTrafficPins=function(n){for(var i=0;i<n.length;i++){var t=n[i],r={type:"Point",coordinates:t.location.coordinates},u={imageUrl:t.url},f={point:r,copyright:t.copyrightNotice,description:t.name,incidentId:t.id,type:12,images:[u]},e=new ui(f,null,!0);this._trafficPins.push(e)}},n.prototype.createPolyLineAndStopPins=function(n,t,u,f,e,o,s,c,l){var tt=n.routePath.line.coordinates,it,y,g,nt,rt,w,k,a,v;if(i.isSDK&&typeof r.Directions.DirectionsSDKPolyline!="undefined"&&(it=r.Directions.DirectionsSDKPolyline),y=[],g=!0,!this.routeLinePoints.length){for(a=0;a<tt.length;a++)nt=tt[a],rt=new b(nt[0],nt[1]),this.routeLinePoints.push(rt);g=!1}if(f){for(w=[],k=0,a=1;a<f.length;a++)f[a].routeLegStopPoint.isVia?k++:(w.push(k),k=0);var p=0,d=0,ut=[],ft=[],et={annotationIndex:0,lastEnd:0};for(a=0;a<f.length;a++){if(v=f[a],a!==0&&(v.routeLegStopPoint.isVia?d++:(p++,d=0)),o){if(a!==0){var ot=f[a-1].routeLegStopPoint.routePathIndex,st=v.routeLegStopPoint.routePathIndex,ht=this.routeLinePoints.slice(ot,st+1);y.push(this._convertPointsToPolyline(it,ht,s,null,t,p,d,u,w[p],l))}}else v.itineraryItems&&v.itineraryItems.length>0&&this.createOptimizedPolylineCollection(n.routeLegs[p],v,et,t,u,p,w,y,s,c,l);g||(a===0?this.addStopPointPin(v.routeLegStopPoint,h.start,e[0],u,s,0,-1):this.addViaOrStopPoint(u,v.routeLegStopPoint,e,p,d,a===f.length-1,ut,ft,s))}this._commitStopPointPin(ft);this._commitStopPointPin(ut)}y&&y.length&&this._polylines.push(y)},n.prototype.dispose=function(){u._disposeEvents(this);this._map=null;this._controlTemplateFactory=null;u._clearDisposables([this._primitivesPins,this._labelOverlay,this._routePins,this._trafficPins]);for(var n=0;n<this._polylines.length;n++)u._clearDisposables(this._polylines[n]);this._polylines=[]},n._constructWaypointQueueItem=function(n,t,i,r,u,f,e){return{stopPoint:n,pushpinType:t,instructionViewModel:i,routeMode:r,renderOptions:u,stopPointIndex:f,viaPointIndex:e}},n._isManeuverEqual=function(n,t){return n.mode===t.mode&&n.isFerry===t.isFerry},n.getViaIndexes=function(n){var u=[],r=n.routeSubLegs,t,i;if(r.length>1)for(t=0;t<r.length;t++)i=r[t],i.endWaypoint&&i.endWaypoint.isVia&&u.push(i.endWaypoint.routePathIndex);return u},n.getViasInSegment=function(n,t,i){for(var u=[],r=0;r<n.length;r++)n[r]>=t&&n[r]<i&&u.push(n[r]);return u},n.getAnnotationState=function(t,i,r,u){for(var o,s,h,f={endIndex:i,manuever:u},e=0;e<r.length;e++)if(e+1<r.length){if(o=r[e],s=r[e+1],o.index<=t&&t<s.index)return n.setTrafficTypeFromAnnotaions(o,f),f.endIndex=s.index,f}else return h=r[r.length-1],n.setTrafficTypeFromAnnotaions(h,f),f;return f},n.setTrafficTypeFromAnnotaions=function(n,t){if(n&&n.traffic){var i=n.traffic;(i==="Moderate"||i==="Heavy"||i==="High")&&(t.manuever.mode=i)}},n.prototype._convertPointsToPolyline=function(n,r,u,f,e,o,s,h,c,l){if(i.isSDK&&n){var a=null;if(u)switch(h){case t.transit:a=f&&f.mode==="Walk"?u.walkingPolylineOptions:u.transitPolylineOptions;break;case t.walking:a=u.walkingPolylineOptions;break;default:a=u.drivingPolylineOptions}return new n(r,a,this._index,e,o,s,h,c,f&&f.mode,l)}return new oi(r,this._index,e,o,s,h,c,f)},n.prototype.createOptimizedPolylineCollection=function(u,f,e,o,s,h,c,l,a,v,y){for(var w,ft,et,st,tt,k,ht,p=[],ct=f.routeLegStopPoint.routePathIndex,at=n.getViaIndexes(u),g=0,ut=i.isSDK&&typeof r.Directions.DirectionsSDKPolyline!="undefined"?r.Directions.DirectionsSDKPolyline:null,d={mode:f.itineraryItems[0].iconType,isFerry:f.itineraryItems.length>0&&f.itineraryItems[0].details&&f.itineraryItems[0].details.length>0&&f.itineraryItems[0].details[0].roadType==="Ferry"},ot=0;ot<f.itineraryItems.length;ot++)if(f.itineraryItems[0].details&&f.itineraryItems[0].details.length>0&&f.itineraryItems[0].details[0].startPathIndices&&f.itineraryItems[0].details[0].startPathIndices.length>0&&f.itineraryItems[0].details[0].startPathIndices[0]!==0&&(ct=0),w=f.itineraryItems[ot],w&&w.details)for(ft=!1;!ft;){var it=e.lastEnd,rt,b=null,vt=w.details&&w.details.length>0&&w.details[0].roadType==="Ferry",lt={mode:w.iconType,isFerry:vt},nt=0;if(w.details&&w.details.length>0&&w.details[w.details.length-1].endPathIndices&&w.details[w.details.length-1].endPathIndices.length>0&&(nt=ct+w.details[w.details.length-1].endPathIndices[0]),s==t.driving&&v?(et=n.getAnnotationState(it,nt,v,lt),e.lastEnd=nt<et.endIndex?nt:et.endIndex,rt=et.manuever,ft=e.lastEnd===nt):(e.lastEnd=nt,rt=lt,ft=!0),st=n._isManeuverEqual(rt,d),tt=n.getViasInSegment(at,it,e.lastEnd),b=this.routeLinePoints.slice(it,e.lastEnd+1),tt.length==0)p.length&&!st?(l.push(this._convertPointsToPolyline(ut,p,a,d,o,h,g,s,c[h],y)),p=b):p=p.concat(b);else for(k=0;k<=tt.length;){if(ht=k<tt.length?tt[k]:e.lastEnd,b=this.routeLinePoints.slice(it,ht+1),it=ht,b.length==0){p=p.concat(b);g++;k++;continue}k==0&&st?p=p.concat(b):p.length&&k>0?(l.push(this._convertPointsToPolyline(ut,p,a,d,o,h,g-1,s,c[h],y)),p=b):p.length&&rt!==d?(l.push(this._convertPointsToPolyline(ut,p,a,d,o,h,g,s,c[h],y)),p=b):p=p.concat(b);k<tt.length&&g++;k++}d=rt}p.length&&l.push(this._convertPointsToPolyline(ut,p,a,d,o,h,g,s,c[h],y))},n.prototype.addViaOrStopPoint=function(t,i,r,u,f,e,o,s,c){var a=h.middle,v=null,l;i.isVia?(l=n._constructWaypointQueueItem(i,h.via,null,t,c,u,f-1),o.push(l)):(v=r[u],e?(a=h.end,this.addStopPointPin(i,a,v,t,c,u,f)):(l=n._constructWaypointQueueItem(i,a,v,t,c,u,f),s.push(l)))},n.prototype._commitStopPointPin=function(n){for(var t,i=0;i<n.length;i++)t=n[i],this.addStopPointPin(t.stopPoint,t.pushpinType,t.instructionViewModel,t.routeMode,t.renderOptions,t.stopPointIndex,t.viaPointIndex)},n.prototype.addStopPointPin=function(n,t,i,r,u,f,e){var s,o;i?s=i.stepText:n&&(s=n.description);o=pt.createStopPointPin(new b(n.coordinates[0],n.coordinates[1]),t,r,!0,i,f,e,this,s,u);o&&this._primitivesPins.push(o);o&&i&&(i.pushpin=o)},n.prototype.addItineraryPin=function(n,t,i,r,u,f){var o=h[n.toLowerCase()],e=new wt(t.location,o,t,u,!0,this,t.stepIconClass,i,r,null,null,f,!0);this._primitivesPins.push(e);t.pushpin=e},n.prototype.getPrimitives=function(){var n=[];return this._polylines.forEach(function(t){t.forEach(function(t){n.push.apply(n,t.GetPrimitives())})}),n.push.apply(n,this._primitivesPins),n.push.apply(n,this._trafficPins),n},n.prototype.getRoutepointNeighbors=function(n){var i;if(!this.routeLinePoints)return null;var e=n.latitude.toFixed(3),o=n.longitude.toFixed(3),r=[],u=null,f=null,t=-1;for(i=0;i<this.routeLinePoints.length;i++)if(this.routeLinePoints[i].latitude.toFixed(3)===e&&this.routeLinePoints[i].longitude.toFixed(3)===o){t=i;break}return t!==-1&&(t<this.routeLinePoints.length-1&&(f=this.routeLinePoints[t+1]),t>0&&(u=this.routeLinePoints[t-1])),r.push(u),r.push(f),r},n.prototype._updatePrimitives=function(){var t=this,n,i;for(this._polylines.forEach(function(n){n.forEach(function(n){n.changeCardTaskState(t._taskState);n.changeRouteSelectionState(t._isCurrentlySelected);n.update()})}),n=0;n<this._primitivesPins.length;n++)this._primitivesPins[n].changeCardTaskState(this._taskState),this._primitivesPins[n].changeRouteSelectionState(this._isCurrentlySelected),this._primitivesPins[n].update();for(n=0;n<this._trafficPins.length;n++)this._isCurrentlySelected&&this._taskState===1?(i=this._trafficPins[n].viewState===2,this._trafficPins[n].viewState=i?2:0):this._trafficPins[n].viewState=3},n.prototype.setLabel=function(n,t){this._labelOverlay||(this._labelOverlay=new vf(this._controlTemplateFactory));this._labelOverlay.setMessage(n,t)},n.prototype.setLabelLocation=function(n,t){this.labelLocation=n;this._isLabelLocationMiddle=t},n.prototype.showLabel=function(){this.labelLocation&&this._labelOverlay&&(this._taskState===1&&!this._labelOverlayShowing&&(!this._isLabelLocationMiddle||this._isLabelLocationMiddle&&this._isCurrentlySelected)&&(this._map.getOverlays().insert(this._labelOverlay),this._labelOverlayShowing=!0),this._labelOverlay.setAlignment(this.labelLocation))},n.prototype.hideLabel=function(){this._labelOverlay&&this._map.getOverlays().remove(this._labelOverlay);this._labelOverlayShowing=!1},n}(),v;(function(n){n[n.A=1]="A";n[n.GD=2]="GD";n[n.ARC=3]="ARC";n[n.SE=4]="SE";n[n.AC=5]="AC";n[n.RWTLC=6]="RWTLC";n[n.RPPC=7]="RPPC";n[n.WR=8]="WR";n[n.DR=9]="DR";n[n.PD=10]="PD";n[n.EXP=11]="EXP";n[n.COL=12]="COL";n[n.ARCM=13]="ARCM";n[n.CAM=14]="CAM";n[n.CAMCLK=15]="CAMCLK";n[n.ARCB=16]="ARCB";n[n.DBG=17]="DBG"})(v||(v={}));w=function(){function n(){}return n.logInstrumentationEvent=function(t,r){if(!i.isSDK){var u={logData:{feature:n.featureName,action:v[t],data:r},impressionGuid:g.dynamicProperties.mapsIG};l.invokeHandler(c.instrumentationDataHandlerKey,u)}},n.callMapSnRInstrumentation=function(n){if(!i.isSDK){var t={logData:{feature:"d",data:n}};l.invokeHandler(c.callServerInstrumentationDataHandlerKey,t)}},n.featureName="DD",n}(),function(n){n[n.RW=1]="RW";n[n.RR=2]="RR";n[n.PD=3]="PD";n[n.MR=4]="MR";n[n.PL=5]="PL";n[n.TD=6]="TD"}(et||(et={}));var vt=function(){function n(){}return n.setClientPerf=function(t){n.perfLog=t},n.logPerfEvent=function(i,r){if(!n.perfLog)return null;var u=n.featureName;if(u+="_",r)switch(r){case t.driving:u+="D_";break;case t.transit:u+="T_";break;case t.walking:u+="W_";break;case t.multimode:u+="M_"}return u+=et[i],n.perfLog.start(u)},n.featureName="DD",n.keyForDragRequest="DR",n}(),vr=function(t){function r(i,r){var u=this,f={},e;return u=t.call(this,f)||this,u.resources=n,u.isBeingResolved=!1,u._waypointModel=i,u._panelViewModel=r,u.waypointDeleteEvent=new o,u._suggestionItemSelected=new o,u._suggestionItemSelected.add(function(n){u._onSuggestionItemSelected(n)}),u._suggestionItemClicked=new o,u._suggestionItemClicked.add(function(n){u._onSuggestionItemClicked(n)}),u._onFocus=new o,u._onFocus.add(function(n){u.onFocus(n)}),u._onAutosuggest=new o,u._onAutosuggest.add(function(n){r.onDropdown(n)}),u._onAutosuggestKeydown=new o,u._onAutosuggestKeydown.add(function(n){u.onAutosuggestKeydownFunction(n)}),f.defineProperty("index"),u.setIndex(-1),f.defineProperty("showDelete"),f.defineProperty("upHierarchy"),f.defineProperty("inputText",u._onInputTextChanged),f.defineProperty("printImagePath"),u.setPrintImagePath(""),u._updateInputText(),u.waypointType=1,e=n.L_InexactMatch.split("{0}"),u.resolveText1=e[0],u.resolveText2=e[1],u}return p(r,t),r.prototype.onDelete=function(n){if(n.preventDefault(),this._panelViewModel&&this.getIndex()===this._panelViewModel.waypoints.length-1){var t=this._panelViewModel.getControl().select(".dirWp")[this.getIndex()-1];s(t).select(".icon").swap_class("middle","end")}this.waypointDeleteEvent.invoke(this.getIndex())},r.prototype.setUpHierarchyResult=function(n){this._savedEntity=n;this.setUpHierarchy(n.getDescription())},r.prototype.onResolve=function(n){n.preventDefault();var t=this._savedEntity,i=t.getRoutableLocation();this.update(t.getDescription(),i?i:t.getLocation(),t.getTitle(),t);this._panelViewModel.addToHistory(t);this._clearSavedEntity()},r.prototype.onCloseResolve=function(n){n.preventDefault();this._clearSavedEntity()},r.prototype.getWayPointModel=function(){return this._waypointModel},r.prototype.update=function(t,i,r,u,f){var o,e,s,h;if(this.isBeingResolved=!1,this._waypointModel.address=t,this._waypointModel.point=i,this._waypointModel.name=r,this._waypointModel.isApproximate=!t,u&&!this._waypointModel.eid&&(this._waypointModel.eid=u.id),this._entity=u,this._updateInputText(),o=this.getIndex(),f&&(this._waypointModel.filterUrlParam=f.entityId,this._waypointModel.asName=f.formatedLine1,this._waypointModel.asFormattedAddress=f.formatedLine2,f.type!=="Favorite"||i||(i=f.location,this._waypointModel.point=i),this._waypointModel.asType=1,f.type==="Favorite"?(this._waypointModel.asType=6,f.subType==="Home"&&(this._waypointModel.asType=4),f.subType==="Work"&&(this._waypointModel.asType=5)):f.type==="History"&&(this._waypointModel.asType=7)),r===n.L_Directions_MyLocation&&(this._waypointModel.asType=2),i){if(o<this._panelViewModel.waypoints.length-1)for(e=o+1;e<this._panelViewModel.waypoints.length;e++)if(s=this._panelViewModel.waypoints[e],h=s.getWayPointModel(),h.point)break;else s._autoSuggestModel.update(this._waypointModel,this._panelViewModel.getMode(),this._panelViewModel.getWaypointDataModels(),this._panelViewModel.contextId);this._panelViewModel.waypointResolvedEvent&&this._panelViewModel.waypointResolvedEvent.invoke(this)}},r.prototype.trim=function(){this._setInputTextFromCode(this.getInputText().trim())},r.prototype.isEmpty=function(){return!this.getInputText()},r.prototype.cancelAutosuggest=function(){this._autosuggest&&this._autosuggest.stopAutosuggest(!1)},r.prototype.initAutosuggest=function(n,t,i,r){var u=s(".dirWaypoints",n[0]),f=s("input",u[0]),l=s("a.backArrowButton",u[0]),e=s(".searchboxWithAS",n[0]),o,h,c;e&&f&&t&&(o=s(f[this.getIndex()]),h=s(e[0]),this._autoSuggestModel=new ft,this._autosuggest&&this._autosuggest.removeEventHandlers(),this._autosuggestViewModel=new pu(this._autoSuggestModel,i),c="as_container_directions",this._autosuggest=this._createAutoSuggest(h,o,c,this._autosuggestViewModel,t,l),this._autosuggest.setItemSelectionEventHandler(this._suggestionItemSelected),this._autosuggest.setItemClickEventHandler(this._suggestionItemClicked),this._autosuggest.setFocusEventHandler(this._onFocus),this._autosuggest.setAutosuggestKeydownHandler(this._onAutosuggestKeydown),this._autosuggest.setOnAutosuggestHandler(this._onAutosuggest),this._autosuggest.setAutosuggestBlurHandler(this._onAutosuggestBlur),this._autosuggest.setSuggestionRequestHandler(r))},r.prototype.onFocus=function(n){var u,i,t,r;if(n){if(i=this.getIndex(),i>0)for(t=i-1;t>=0;t--)if(r=this._panelViewModel.waypoints[t].getWayPointModel(),r.point){u=r;break}this._autoSuggestModel.update(u,this._panelViewModel.getMode(),this._panelViewModel.getWaypointDataModels(),this._panelViewModel.contextId);this._panelViewModel.getMessageText()===null&&this._panelViewModel.isResultsPanelShowing||(this._panelViewModel.showAutosuggestPanel(),this._autosuggest.refreshAutosuggest());this._panelViewModel.onWaypointFocusChanged(this)}else this._panelViewModel.setShowSuggestionsPanel(!1)},r.prototype.refreshAutosuggest=function(){this._autosuggest&&this._autosuggest.refreshAutosuggest()},r.prototype.onAutosuggestKeydownFunction=function(t){var r=t,u=r.keyCode||r.which,f,i;this._panelViewModel.hideMessage();u==13?(f=this._autosuggestViewModel.getSelectedSuggestion(),this._suggestionSelected(f)):u==8&&this.getInputText()===n.L_Directions_MyLocation&&(i=t.currentTarget,i&&(i.selectionStart=i.selectionEnd=0),this.update("",null))},r.prototype.getEntity=function(){return this._entity},r.prototype.setWaypointSuggestionRequestedHandler=function(n){this._autosuggest&&this._autosuggest.setSuggestionRequestHandler(n)},r.prototype.getWaypointTitle=function(){if(this._waypointModel.name)return this._waypointModel.name;if(this._waypointModel.address)return this._waypointModel.address;var n=this._waypointModel.point;return n?u._formatLatLonString(n.latitude,n.longitude):""},r.prototype.dispose=function(){this._autosuggestViewModel.dispose();this._autosuggest&&this._autosuggest.removeEventHandlers();t.prototype.dispose.call(this);u._disposeEvents(this);u._nullifyClass(this)},r.prototype._suggestionSelected=function(t){var i=1,r;t&&t.searchText===n.L_Directions_MyLocation?(this._getCurrentPosition(),i=2):(t&&(t.type==="Favorite"?(i=6,t.subType==="Home"&&(i=4),t.subType==="Work"&&(i=5)):t.type==="History"?i=7:t.defaultSuggestion&&(i=3),this.update(t.formatedAddress,null,t.title,null,t),this._waypointModel.isApproximate=t.type==="Place"&&t.subType==="PopulatedPlace"),this._updateDirectionsOnSelection());t&&(r={},r.AST=i,w.logInstrumentationEvent(v.AC,r))},r.prototype._updateDirectionsOnSelection=function(){var n,t;if(i.enableUpdateDirectionsOnSelection){for(n=this.getIndex(),t=this._panelViewModel.waypoints.length;n<t;n++)if(this._panelViewModel.waypoints[n].getInputText().trim()===""){this._panelViewModel.setFocusToWaypoint(n);return}for(n=0,t=this.getIndex();n<t;n++)if(this._panelViewModel.waypoints[n].getInputText().trim()===""){this._panelViewModel.setFocusToWaypoint(n);return}this._panelViewModel.getDirections()}},r.prototype._onSuggestionItemSelected=function(t){this._waypointModel.eid=t.entityId;t.title!==n.L_Directions_MyLocation&&this.update(t.formatedAddress,null,t.title,null,t)},r.prototype.onGeolocationCallback=function(t){t.error?this._panelViewModel.clearResultsAndShowMessage({errorDetails:[n.L_Directions_Error_User_Location_Not_Found],errorCode:f.searchServiceFailed,searchType:2}):(this.update(n.L_Directions_MyLocation,t.location,n.L_Directions_MyLocation),this._updateDirectionsOnSelection())},r.prototype._onSuggestionItemClicked=function(n){this._waypointModel.eid=n.entityId;this._suggestionSelected(n)},r.prototype._getCurrentPosition=function(){var n=this,t={callback:function(t){return n.onGeolocationCallback(t)},performReverseGeocoding:!1};this._panelViewModel.geolocationProvider.GetCurrentPosition(t)},r.prototype._updateInputText=function(){var t="";t=this._waypointModel.name&&this._waypointModel.address?this._waypointModel.name!==this._waypointModel.address?n.L_Directions_Waypoint_Text_From_Name_Address.replace("{0}",this._waypointModel.name).replace("{1}",this._waypointModel.address):this._waypointModel.name:this.getWaypointTitle();this._setInputTextFromCode(t)},r.prototype._setInputTextFromCode=function(n){this._textModifiedFromCode=!0;this.setInputText(n);this._textModifiedFromCode=!1},r.prototype._onInputTextChanged=function(n,t){this._textModifiedFromCode||(this._panelViewModel&&this._panelViewModel.showAutosuggestPanel(),this._savedEntity&&this._clearSavedEntity(),this._waypointModel.clear(),this.isBeingResolved=!1,t===""&&this._panelViewModel.waypointResolvedEvent.invoke(this),this._panelViewModel&&this._panelViewModel.clearDirectionsResults.invoke())},r.prototype._clearSavedEntity=function(){this.setUpHierarchy(null);this._savedEntity=null},r.prototype._createAutoSuggest=function(n,t,i,r,u,f){return g.isMobile?new yu(n,t,i,r,u,f):new vu(n,t,i,r,u)},r}(rr),yt=function(){function n(){this.setToInitialState()}return n.prototype.setToInitialState=function(){var r,n;for(this.waypoints=[],n=0;n<2;n++)this.waypoints.push(new it);for(this.mode=t[t[i.defaultMode]],r=[],n=0;n<=8;n++)r.push(!0);this.options={unit:i.unit,avoidMotorWays:!1,avoidTollRoads:!1,roundTrip:!1,saveHistory:!0,timeType:d.firstAvailable,transitTypes:r}},n.prototype.tryAddWaypoint=function(n,t){var r=this.waypoints.length,i;if(t<0||t>r)return!1;for(i=r;i>t;i--)this.waypoints[i]=this.waypoints[i-1];return this.waypoints[i]=n,!0},n.prototype.tryRemoveWaypoint=function(n){var t=this.waypoints.length;return n<0||n>=t?!1:(this.waypoints.splice(n,1),!0)},n.prototype.tryUpdateWaypoint=function(n,t){var i=this.waypoints.length;return t<0||t>=i?!1:(this.waypoints[t]=n.getWayPointModel(),!0)},n.prototype.reorderWaypoint=function(n,t){var i=this.waypoints[n];this.tryRemoveWaypoint(n);this.tryAddWaypoint(i,t)},n.inputDataFromDirectionState=function(r,u,f,e){var l,o,s,c;if(f===void 0&&(f=!0),e===void 0&&(e=!1),u=u||new n,r&&r.waypoints||e){if(l=r.waypoints.length,l!==1||e){for(u.waypoints=[],o=0;o<l;o++)u.waypoints.push(it.createObjectFrom(r.waypoints[o]));for(;o<2;o++)u.waypoints.push(new it)}else{var v=r.waypoints[0],a=v.waypointType,h=it.createObjectFrom(v);if(a===1)u.waypoints[0]=h;else if(a===2)u.waypoints[u.waypoints.length-1]=h;else if(a===4){for(o=0;o<u.waypoints.length&&u.waypoints[o].name;)o++;o!==u.waypoints.length&&(u.waypoints[o]=h)}else f&&(u.waypoints[u.waypoints.length-1]=h)}if(s=r.options,s)for(c in s)s[c]&&(u.options[c]=s[c]);r.mode&&(u.mode=i.enableDrivingMode&&r.mode===t.driving||i.enableTransitMode&&r.mode===t.transit||i.enableWalkingMode&&r.mode===t.walking||i.bestModeEnabled&&r.mode===t.multimode||i.isSDK&&r.mode===t.truck?r.mode:i.defaultMode)}return u},n.inputDataToDirectionsState=function(n,t){var r,i;if(t===void 0&&(t=!0),t&&n.waypoints)for(r=0;r<n.waypoints.length;r++)i=n.waypoints[r],i.point&&(i.point.latitude=Math.round(i.point.latitude*1e6)/1e6,i.point.longitude=Math.round(i.point.longitude*1e6)/1e6);return{waypoints:n.waypoints,mode:n.mode,options:n.options}},n}(),yr=function(){function n(){}return n.downloadRoutes=function(r,u){var f=r.requestOptions;if(!f)throw"options parameter must be defined!";if(!f.waypoints||f.waypoints.length===0)throw"options parameter is missing required properties!";f.mode===t.truck?n._downloadRoutesViaPost(r.mapCredentials,i.calculateTruckRouteServiceUrl,r,u):cr.instance.authenticateClientAndRetrieveSessionId(function(){var t=i.applicationKey||cr.instance.getSessionId();n._downloadRoutesViaGet(t,i.calculateRouteServiceUrl,r,u)})},n._downloadRoutesViaGet=function(r,u,e,o){for(var a,k,d,ut,ft,lt,at,vt,et,p,g,b,st,c=e.requestOptions,nt=e.isDragRequest,tt=e.viaPoint,ht=e.subLegIndex,yt=e.legIndex,pt=e.viaPointRemoved,y={},h=u.replace("{app_key}",r).replace("{culture}",n._getUrlCultureParam()).replace("{travelMode}",i.bestModeEnabled&&c.mode===t.multimode?"alternate":t[c.mode]),s=[],ct="",it="",rt=!1,l=0;l<c.waypoints.length;l++)if(a=c.waypoints[l],s.push(a),ct+=a.waypointSource.toString(),a.point&&(it+=a.point.latitude+","+a.point.longitude),it+=l===c.waypoints.length-1?"":";",rt=rt||a.waypointSource===4||a.waypointSource===2,k=a.viaWaypoints,l===yt)if(ht>=k.length)s=s.concat(k),s.push(tt);else for(d=0;d<k.length;d++)d===ht&&s.push(tt),s.push(k[d]);else k&&(s=s.concat(k));for(l=0;l<s.length;l++)h+=n._createWaypointQueryParam(s[l],l),l!==s.length-1&&(h+="&");if(ut=s[0],ft=s[s.length-1],nt?(h+="&ra=routepath",c.mode!==t.transit&&(h+=",excludeitinerary"),ut.point&&ft.point&&(lt=nr.fromLocations(ut.point,ft.point),at=lt.center,vt=sr.toScale(at,ot.currentZoomLevel,!1),h+="&res=",h+=vt)):(e&&e.isSummaryOnly?h+="&ra=routeSummariesOnly":c.mode===t.transit?h+="&ig=true&ra=routepath,transitStops":c.mode===t.driving||c.mode===t.multimode?(h+="&ra=routepath,routepathannotations,routeproperties",i.showTrafficCameras&&!i.isSDK&&(h+=",includeCameras")):h+="&ra=routeproperties,routepath",e&&!e.isSummaryOnly&&(h+=",routeInfoCard,TransitFrequency")),et=n._createOptionsQueryParam(c.options,c.mode,y,nt),h+=et,ir.downloadJsonp(h,"routes",function(n,t){var u=t.requestOptions,i,r;n&&(i={errorCode:f.Success},n.statusCode!==200&&n.errors&&n.errors.length>0?i=n.errors[0]:n.resourceSets&&n.resourceSets.length||(i.errorCode=f.noResults),o&&o(t,n,i),i.errorCode!==f.Success||t.isDragRequest||(r={},r.NR=n.resourceSets[0].resources.length,w.logInstrumentationEvent(v.DR,r)))},function(n){o&&o(n,null,{errorCode:f.generalError})},null,!1,e,0),y.M=c.mode,y.NM=c.waypoints.length,y.O=et,nt)y.D=tt?2:pt?3:1;else{for(p="",g=0;g<s.length;g++)b=s[g],b.name?p+=b.name:b.address?p+=b.address:b.point&&(st=b.point,p=p+st.latitude+","+st.longitude,i.enableApproximateLocation&&b.isApproximate&&(p+="a")),g!==s.length-1&&(p+="|");y.WS=ct;rt&&(y.WC=it);w.callMapSnRInstrumentation(p)}w.logInstrumentationEvent(v.GD,y)},n._downloadRoutesViaPost=function(t,i,r,u){var e=i.replace("{app_key}",t),o=n._constructPostBody(r),s=function(n){var t,i;if(u){t=null;try{t=JSON.parse(n)}catch(e){u(r,null,{errorCode:f.UnknownError})}t===null?u(r,null,{errorCode:f.noResults}):(t.errors&&t.errors.length>0?(i=t.errors[0],i.errorCode===""&&(i.errorCode=f.NoSolution)):i=t.resourceSets&&t.resourceSets.length?{errorCode:f.Success}:{errorCode:f.noResults},u(r,t,i))}},h=function(){u&&u(r,null,{errorCode:f.generalError})};ir.doPost(e,o,{onSuccess:s,onError:h})},n._constructPostBody=function(t){var r={waypoints:[],routeAttributes:"routePath"},o=t.requestOptions,u,c,s,h,f,e;for(o.options&&(u=o.options,r.distanceBeforeFirstTurn=u.distanceBeforeFirstTurn,r.heading=u.heading,r.vehicleSpec=u.vehicleSpec,c=n._createAvoidList(u),c.length>0&&(r.avoid=c),s=u.optimize||i.optimize,s&&(r.optimize=rt[s],s===rt.timeWithTraffic&&u.dateTime&&(r.dateTime=n._createDateTimeString(new Date(u.dateTime)))),r.distanceUnit=n._createDistanceUnit(u)),h=0;h<o.waypoints.length;h++)f=o.waypoints[h],e={},e.address=f.address,e.isViaPoint=f.isViaWaypoint,f.point&&(e.latitude=f.point.latitude,e.longitude=f.point.longitude),r.waypoints.push(e);return JSON.stringify(r)},n._getUrlCultureParam=function(){if(!n._urlCultureParam){var t=g.dynamicProperties.uiLanguage;t.toLowerCase()==="yy-zz"&&(t="ja-ploc-jp");n._urlCultureParam=t}return n._urlCultureParam},n._createWaypointQueryParam=function(n,t){var r="",u,f;return n.isViaWaypoint&&(r+="v"),r+="wp.",r+=t,r+="=",n.locationIdentifier?r+=n.locationIdentifier:n.point?(u=n.point,r+=u.latitude,r+=",",r+=u.longitude,i.enableApproximateLocation&&n.isApproximate&&(r+="a"),i.snapHintEnabled&&n.address&&(r+="["+n.address+"]")):n.address&&(f=n.address,r+=f),r},n._createAvoidList=function(n){var t=[],i="";return n&&(n.avoidHighways&&t.push("highways"),n.avoidTollRoads&&t.push("tolls"),n.avoidFerry&&t.push("ferry"),n.minimizeHighways&&t.push("minimizeHighways"),n.minimizeTolls&&t.push("minimizeTolls"),n.avoidExpressTrains&&t.push("expresstrain"),n.avoidAirlines&&t.push("airline"),n.avoidBulletTrains&&t.push("bullettrain"),t.length>0&&(i=t.join())),i},n._createDistanceUnit=function(n){var t=i.unit;return n.unit&&(t=n.unit),t===ct.miles?"mi":"km"},n._createDateTimeString=function(n){var t=n.getUTCMinutes();return t<10&&(t="0"+t),n.getUTCMonth()+1+"/"+n.getUTCDate()+"/"+n.getUTCFullYear()+" "+n.getUTCHours()+":"+t+":00"},n._createOptionsQueryParam=function(r,u,f,e){var o="",v,y,h,a,l,c,s,p;if(r){if(v=n._createAvoidList(r),v.length>0&&(o+="&avoid="+v),(u===t.driving||u===t.multimode||u===t.transit&&(i.enableOptimizeCost||i.enableOptimizeTime||i.enableOptimizeTransfers))&&(y=r.optimize||(u===t.driving||u===t.multimode)&&i.optimize,y&&(o+="&optmz="+rt[y])),(u===t.transit||u===t.multimode)&&r.transitTypes){for(h="&trt=",a=!0,l=1;l<r.transitTypes.length;l++)r.transitTypes[l]?h+=l+",":a&&(a=!1);a||(h=h.substring(0,h.length-1),o+=h)}o+="&du="+n._createDistanceUnit(r);(u===t.transit||u===t.multimode||u===t.driving&&i.enablePredictiveRouting)&&(c=r.timeType,f&&(f.TT=c),c===d.firstAvailable?(c=d.departure,s=new Date,s=new Date(s.getTime()-s.getTimezoneOffset()*6e4)):r.dateTime&&(s=new Date(r.dateTime)),c&&s&&(o+=["&dt=",n._createDateTimeString(s),"&tt=",d[c]].join("")));p=e?1:r.maxRoutes?r.maxRoutes:p=i.maxRoutes;o+="&maxSolns=";o+=p}return o+"&rpo=Points"},n}(),vi=function(e){function h(t,u,f,s,h,c,l,a,v,y){var p=this,w={};return p=e.call(this,w,u,nf)||this,p._perfLog=l,p.resources=n,p._map=c,p.geolocationProvider=s,p._featureName=i.featureType,p.enableHistory=!i.isSDK&&!(hr&&hr.autosuggestHistory),p.directionsManagerCallback=a,p.resolveWaypointsInRoutingService=y,p._setEnabledOptions(),p.isLongDistanceIntent=!1,p._spatialMath=r.SpatialMath,p._taskId=h,p._inputData=t,p.disposables.push(p.getDirectionsRequested=new o,p.directionsResultsRequested=new o,p.directionsModeChanged=new o,p.clearDirectionsResults=new o,p.waypointResolvedEvent=new o,p.taskTitleRequestedEvent=new o,p.seeAllRoutesClick=new o,p.resolveWaypointSDKEvent=new o),p._populateModes(v),p.disposables.push(p.waypoints=new li),p.disposables.push(p.waypoints.changed.add(function(n){p._onWaypointsChanged(n)})),w.defineProperty("optionsClass",null,null,{defaultValue:""}),w.defineProperty("showTimeControls",p._onShowTimeControlsChanged,null,{defaultValue:!1}),w.defineProperty("scrollContainer",null,null,{defaultValue:null}),w.defineProperty("panelClass",null,null,{defaultValue:"directionsPanel"}),p._panelDim=0,w.defineProperty("showReverse"),w.defineProperty("showWaypoints",null,null,{defaultValue:!0}),w.defineProperty("showEditDirections",null,null,{defaultValue:!1}),w.defineProperty("messageText"),w.defineProperty("showProgress"),w.defineProperty("showMobileTimeControl"),w.defineProperty("avoidHighways",p._onAvoidHighwaysChanged),w.defineProperty("avoidTolls",p._onAvoidTollsChanged),w.defineProperty("avoidFerry",p._onAvoidFerryChanged),w.defineProperty("roundTrip",p._onRoundTripChanged),w.defineProperty("unitsKm",p._onUnitsKmChanged),w.defineProperty("unitsMiles",p._onUnitsMilesChanged),w.defineProperty("optimizeTime",p._onOptimizeTimeChanged,null,{defaultValue:!0}),w.defineProperty("optimizeCost",p._onOptimizeCostChanged),w.defineProperty("optimizeTransfers",p._onOptimizeTransfersChanged),p._setTransitModeOptions(w),w.defineProperty("saveHistory",function(n,t){ii.resetIsHistoryEnabled(t)},null,{defaultValue:ii.isHistoryEnabled()}),w.defineProperty("showSuggestionsPanel",null,null,{defaultValue:!0}),w.defineProperty("historyDeleted",null,null,{defaultValue:!1}),w.defineProperty("showRouteCategoriesPanel",null,null,{defaultValue:!1}),w.defineProperty("optionsText"),w.defineProperty("dateTimeSummary1"),w.defineProperty("dateTimeSummary2"),w.defineProperty("allowAddWp"),w.defineProperty("mode",p._onModeChanged),w.defineProperty("longDistanceSeparator"),w.defineProperty("longDistanceFrom"),w.defineProperty("longDistanceTo"),w.defineProperty("taskOptionFrom"),w.defineProperty("taskOptionTo"),w.defineProperty("longDistanceText"),p.disposables.push(p.timeTypes=new li),p.timeTypes.insert({text:n.L_Directions_Leave_Now,value:d.firstAvailable}),p.timeTypes.insert({text:n.L_Directions_Depart_At,value:d.departure}),i.enableDrivingArriveBy&&p.timeTypes.insert({text:n.L_Directions_Arrive_By,value:d.arrival}),w.defineProperty("transitTimeType",p._onTimeTypeChanged),w.defineProperty("date",p._onDateTimeChanged,null,{defaultValue:Date.now()}),w.defineProperty("time",p._onDateTimeChanged),w.defineProperty("editingTime"),w.defineProperty("timeCtrlDisabled"),p}return p(h,e),h.prototype.initializeControls=function(n){this.setShowProgress(!1);this.updateInputControlsFromModel();this._updateDateTimeSummary(!1);this.setShowMobileTimeControl(r.GlobalConfig.isMobile);this.initializeCalendar(n)},h.prototype.initializeCalendar=function(n){var t=this,i=s(".calContainer",this.getControl()[0]);i&&n&&n.instanceAsync("SingleCalendar",function(n){n.init(i,t.getDate());n.onDateChangeEvent.add(function(n){n.setHours(0,0,0,0);t.setDate(n.getTime());var i=s(".dirBtnGo",t.getControl()[0])[0];i.focus()});t._calendar=n})},h.prototype.onTaskStateChanged=function(n){var t,f,r,u,e,i;if(n.animationState===1){for(t=document.activeElement,f=this.getControl()[0];t&&t!==f;)t=t.parentNode;if(!t){for(r=0,u=-1;r<this.waypoints.length;r++)if(this.waypoints[r].isEmpty()){u=r;this.setFocusToWaypoint(u);break}u<0&&(e=s(".dirBtnGo",f)[0],e.focus())}i=s(".dirBtnTime")[0];i&&s.Browser.is_ie&&(i.style.backgroundRepeat="no-repeat",i.style.backgroundSize="78px",i.style.backgroundPositionX="-15px",i.style.backgroundPositionY="10px")}n.activationState===2&&(this.hideMessage(),this.setOptionsClass(""),this.setShowTimeControls(!1))},h.prototype.setResultsShowingFlag=function(n){this.isResultsPanelShowing=n},h.prototype.serializeTaskOptions=function(n){return s.Internals.stringify(n)},h.prototype.onGetDirectionsClick=function(n){n&&n.preventDefault();this.setEditingTime(!1);this.setShowTimeControls(!1);this.getDirections()},h.prototype.onDropdown=function(n){i.enableDimPanelOnDropdown&&(n?++this._panelDim:this._panelDim>0&&--this._panelDim,this.setPanelClass("directionsPanel"+(this._panelDim?" drPanelDimmed":"")))},h.prototype.initAutosuggest=function(){this.showAutosuggestPanel();this.contextId=u._generateRandomKey();for(var n=0;n<this.waypoints.length;n++)this.waypoints[n].initAutosuggest(this.getControl(),this._map,this.controlTemplateFactory,this._suggestionRequestedHandler)},h.prototype.setWaypointSuggestionRequestedHandler=function(n){this._suggestionRequestedHandler=n;for(var t=0;t<this.waypoints.length;t++)this.waypoints[t].setWaypointSuggestionRequestedHandler(this._suggestionRequestedHandler)},h.prototype.showAutosuggestPanel=function(){this.setShowSuggestionsPanel(!0);this.hideMessage();this.setShowTimeControls(!1)},h.prototype._updateWaypointsFromData=function(){if(this._inputData.waypoints&&this._inputData.waypoints.length){this.waypoints.clear();for(var n=0;n<this._inputData.waypoints.length;n++)this._addWaypointViewModel(this._inputData.waypoints[n])}},h.prototype.getRouteTitle=function(){var r=this.waypoints.length,t,i;return r>=2&&(t=this.waypoints[0].getWaypointTitle(),i=this.waypoints[r-1].getWaypointTitle(),t&&i)?n.L_Directions_Process_Title_Text_Line.replace("{0}",t).replace("{1}",i):null},h.prototype._filterAutosuggestDetailCards=function(n){var t,i;if(this._currentFocusedWaypoint&&this._inputData&&this._inputData.waypoints&&this._inputData.waypoints.length&&n){var r=this._currentFocusedWaypoint.getIndex(),u=this._inputData.waypoints[r-1],f=this._inputData.waypoints[r+1],e=[];for(t=0;t<n.length;t++)(i=n[t],u&&b.areEqual(u.point,i.getLocation())||f&&b.areEqual(f.point,i.getLocation()))||e.push(i);return e}return n},h.prototype.updateCurrentLocalDetailCards=function(n){h._localDetailCards=h._localDetailCards.concat(n);ft.appendLocalDetailCards(n);this._currentFocusedWaypoint&&this._currentFocusedWaypoint.refreshAutosuggest()},h.prototype.resetLocalDetailsCards=function(){h._localDetailCards=[];ft.resetCurrentLocalDetailsCards()},h.prototype.updateCurrentTransitStopCards=function(n){h._transitStopCards=n;ft.updateCurrentTransitStopCards(n);this._currentFocusedWaypoint&&this._currentFocusedWaypoint.refreshAutosuggest()},h.prototype.onWaypointFocusChanged=function(n){!this._currentFocusedWaypoint||this._currentFocusedWaypoint===n||this._currentFocusedWaypoint.getWayPointModel().point||this._currentFocusedWaypoint.isBeingResolved||(this._currentFocusedWaypoint.isBeingResolved=!0,this._resolveWayPoint(this._currentFocusedWaypoint.getIndex(),!0));this._currentFocusedWaypoint=n;ft.updateCurrentLocalDetailCards(this._filterAutosuggestDetailCards(h._localDetailCards));ft.updateCurrentTransitStopCards(this._filterAutosuggestDetailCards(h._transitStopCards))},h.prototype.waypointResolved=function(t){var s,u,l,r;t.inData.requestorState.perfState&&(s=t.inData.requestorState.perfState,s.end());var o=t.inData,a=o.requestState,h=o.requestorState.isBeingPrefetched,c=o.requestorState.waypointIndex,e=this.waypoints[c];e.isBeingResolved=!1;t.outData&&t.outData.length===1&&t.outData[0].data&&(i.isSDK?(u=t.outData[0].data,e.update(o.requestState.query,u)):t.outData[0].data.entities&&t.outData[0].data.entities.length>0&&(l=t.outData[0].data.entities,r=l[0],i.enableDisambig&&r.isUpHierarchy?e.setUpHierarchyResult(r):(u=r.getRoutableLocation()||r.getLocation(),e.update(r.getDescription(),u,r.getTitle(),r),this.addToHistory(r))));u&&!h&&this._invokeResolveWaypoint(c);u||h||this.clearResultsAndShowMessage({errorDetails:[n.L_Directions_Error_Search_Fail],errorCode:f.searchServiceFailed,searchType:e.getWayPointModel().asType})},h.prototype.addToHistory=function(n){this.getSaveHistory()&&(ii.saveWaypoint(n),this.setHistoryDeleted(!1))},h.prototype.getDirections=function(t,i,r){var o,e,s,h;for(this.contextId=u._generateRandomKey(),this.getDirectionsRequested.invoke(),this._dismissAllAutosuggests(),o=0,e=this.waypoints.length-1,s=0;e>=0;e--)h=this.waypoints[e],h.trim(),h.isEmpty()?this.waypoints.length>2&&this._deleteWaypoint(e):(s++,o=e);s<2?(t||this.clearResultsAndShowMessage({errorDetails:[n.L_Directions_Error_Waypoints],errorCode:f.atleastTwoWaypointRequired}),s!==1||this._inputData.waypoints[o].point||this._resolveWayPoint(o,!0)):(this.setShowProgress(!0),this._invokeResolveWaypoint(0,i,r))},h.prototype.onGeolocationCallback=function(t){t.error?t.error&&this.clearResultsAndShowMessage({errorDetails:[n.L_Directions_Error_User_Location_Not_Found],errorCode:f.searchServiceFailed,searchType:2}):(this.waypoints[0].update(n.L_Directions_MyLocation,t.location,n.L_Directions_MyLocation),this.getDirections())},h.prototype.onReverseClick=function(n){n.preventDefault();this._reorderWaypoint(0,1);this._updateExistingDirections()},h.prototype.onEditDirectionsClick=function(){},h.prototype.onOptionsClick=function(n){var t,i;n.preventDefault();t=this.getOptionsClass()==="";this.setOptionsClass(t?"dropdownOpen":"");i=n.currentTarget;i.setAttribute("aria-expanded",t?"true":"false")},h.prototype.onTimeClick=function(n){var t,i;n.preventDefault();t=!this.getShowTimeControls();this.setShowTimeControls(t);i=n.currentTarget;i.setAttribute("aria-expanded",t?"true":"false")},h.prototype.onAddClick=function(n){this._invalidateResults();n.preventDefault();var t=s(".icon.end",this.getControl()[0]);t.swap_class("end","middle");this.addWaypoint(new it);this.hideMessage();i.enableFocusToWaypointOnAddClick&&this.setFocusToWaypoint(this.waypoints.length-1)},h.prototype.showEditAndCollapseCard=function(){},h.prototype.setFocusToWaypoint=function(n){var i=s(".dirWaypoints",this.getControl()[0])[0],t,r;i&&(t=s("input",i),r=t.length,n>=0&&n<r&&Microsoft.Maps.setTimeout(function(){t[n].focus()},50))},h.prototype.addWaypoint=function(n){this.getAllowAddWp()&&this._inputData.tryAddWaypoint(n,this._inputData.waypoints.length)&&this._addWaypointViewModel(n)},h.prototype.setWaypoint=function(n,t){t>=0&&t<this.waypoints.length&&(this._inputData.waypoints[t]=n)},h.prototype.removeViaPoint=function(n,t){if(n>=0&&n<this.waypoints.length){var i=this.waypoints[n].getWayPointModel().viaWaypoints;t>=0&&t<i.length&&(i.splice(t,1),this.directionsResultsRequested.invoke({DirectionsInputData:this._inputData,viaPointRemoved:!0}))}},h.prototype.onModeClick=function(n){n.preventDefault();var i=n.target,t=this._getModeData(Number(i.getAttribute("mode")));t&&t.enabled&&this.setMode(t.mode)},h.prototype.isSelectedMode=function(n){return Boolean(n===this.getMode()).toString()},h.prototype.selectedModeToDisplay=function(n){return this.boolToDisplay(n===this.getMode())},h.prototype.displayIfDriving=function(n){return this.boolToDisplay(n===t.driving)},h.prototype.displaySortByOptions=function(n){return this.boolToDisplay(n===t.transit&&(i.enableOptimizeCost||i.enableOptimizeTime||i.enableOptimizeTransfers))},h.prototype.displaySpecialTransitModeFilter=function(n){return this.boolToDisplay(n===t.transit&&i.specialTransitModeFilter)},h.prototype.displayTransitModeFilterROW=function(n){return this.boolToDisplay(n===t.transit&&!i.specialTransitModeFilter&&i.transitModeFilter)},h.prototype.displayIfTransit=function(n){return this.boolToDisplay(n===t.transit)},h.prototype.displayIfNotTransit=function(n){return this.boolToDisplay(n===t.driving||n===t.walking)},h.prototype.displayTimeControls=function(n){return this.boolToDisplay(n===t.transit||n===t.driving&&i.enablePredictiveRouting)},h.prototype.showTimeControlsToClass=function(n){return n?"dropdownOpen":""},h.prototype.indexToWaypointTitle=function(t){return t?n.L_Directions_Title_Destination:n.L_Directions_Title_Start},h.prototype.indexToIconText=function(n){return String.fromCharCode(n+65)},h.prototype.indexToIconClass=function(n){var t="icon ";switch(n){case 0:t+="start";break;case this._inputData.waypoints.length-1:t+="end";break;default:t+="middle"}return t},h.prototype.clearResultsAndShowMessage=function(t,i){this.setShowProgress(!1);this.clearDirectionsResults.invoke();this.showMessage(t,i);this.taskTitleRequestedEvent.invoke(this.isLongDistanceIntent?n.L_DirectionsTaskDistanceTitle_Text:n.L_DirectionsTaskTitle_Text);this.directionsManagerCallback&&this.directionsManagerCallback.invoke(t)},h.prototype.showMessage=function(n,t){var e,r,u,i;this.isLongDistanceIntent||(n.errorCode===undefined&&(n.errorCode=f.otherError),e=n.errorDetails&&n.errorDetails.length>0&&n.errorDetails[0]?n.errorDetails[0]:"",r=this._getErrorText(n.errorCode,e),this.setMessageText(r),u=s(".dirMessage",this.getControl()[0]),u[0]&&u[0].focus(),n.errorCode!==f.Success&&(i={},i.ET=n.errorCode,i.TI=t,i.ED=r,n.errorCode===f.searchServiceFailed&&(i.AST=n.searchType||8),w.logInstrumentationEvent(v.SE,i)));this.setShowSuggestionsPanel(!1)},h.prototype.hideMessage=function(){this.setMessageText(null)},h.prototype.getWaypointDataModels=function(){return this._inputData.waypoints},h.prototype.onDragComplete=function(n){var t,i;if(n){for(t=0;t<this.waypoints.length;t++)this._inputData.tryUpdateWaypoint(this.waypoints[t],t);this._updateExistingDirections();i={};i.RT=2;w.logInstrumentationEvent(v.WR,i);n.initAutosuggest(this.getControl(),this._map,this.controlTemplateFactory,this._suggestionRequestedHandler)}},h.prototype.updateInputControlsFromModel=function(){this._isUpdating=!0;this.setMode(this._inputData.mode===t.multimode?t.driving:this._inputData.mode);var n=this._inputData.options;this.setAvoidHighways(!!n.avoidHighways);this.setAvoidTolls(!!n.avoidTollRoads);this.setAvoidFerry(!!n.avoidFerry);this.setRoundTrip(!!n.roundTrip);this.setUnitsKm(n.unit===ct.km);this.setUnitsMiles(n.unit===ct.miles);this.setOptimizeTime(n.optimize===rt.time);this.setOptimizeCost(n.optimize===rt.money);this.setOptimizeTransfers(n.optimize===rt.transfers);this.setAvoidBulletTrains(!!n.avoidBulletTrains);this.setAvoidExpressTrains(!!n.avoidExpressTrains);this.setAvoidFlights(!!n.avoidAirlines);this._updateTransitModeOptionsFromData();this._updateWaypointsFromData();this._initializeTimeAndDateControls();this._isUpdating=!1},h.prototype.updateInputControlsFromState=function(n){this._inputData=yt.inputDataFromDirectionState(n,this._inputData,!0,!0);this.updateInputControlsFromModel()},h.prototype.updateModeBtnState=function(){for(var n,h,e,l,r,v,o,f,u,a,c,s=0;s<this.modes.length;s++){if(n=this.modes[s],n.enabled=this.waypoints.length<=n.maxWaypoints,n.enabled&&!n.supportViaPoint)for(h=0;h<this.waypoints.length;h++)if(this.waypoints[h].getWayPointModel().viaWaypoints.length>0){n.enabled=!1;break}if(n.enabled&&n.mode===t.walking&&(e=this._spatialMath,e&&(l=e.DistanceUnits,r=0,this.waypoints&&this.waypoints.length>1&&(v=this.waypoints[0].getWayPointModel().point,v))))for(o=this.waypoints[0].getWayPointModel().point,f=1;f<this.waypoints.length;f++){if(this.waypoints[f-1].getWayPointModel().viaWaypoints)for(a=this.waypoints[f-1].getWayPointModel().viaWaypoints,c=0;c<a.length;c++){if(u=a[c].point,r+=e.getDistanceTo(o,u,l.Miles),r&&r>i.maxWalkingDistance){n.enabled=!1;break}o=u}if(r<=i.maxWalkingDistance&&(u=this.waypoints[f].getWayPointModel().point,u)){if(r+=e.getDistanceTo(o,u,l.Miles),r&&r>i.maxWalkingDistance){n.enabled=!1;break}o=u}}n.setBtnClass("dirBtn"+n.modeName+" dirBtn"+(this.getMode()===n.mode?"Selected":n.enabled?"Normal":"Disabled"));n.setAriaPressed(this.getMode()===n.mode)}},h.prototype.onDeleteHistory=function(n){n.preventDefault();ii.removeAll();this.setHistoryDeleted(!0);var t=s(".dirBtnOptions.dropdownBtn",this.getControl()[0])[0];t.focus()},h.prototype.dispose=function(){this._calendar&&(this._calendar.dispose(),this._calendar=null);e.prototype.dispose.call(this)},h.prototype._initializeTimeAndDateControls=function(){var t=this.timeTypes[0],u=this._inputData.options.timeType,n,r,i;if(u)for(n=0;n<this.timeTypes.length;n++)if(u===this.timeTypes[n].value){t=this.timeTypes[n];break}this.setTransitTimeType(t);r=new Date;(t.value===d.departure||t.value===d.arrival)&&(i=this._inputData.options.dateTime,i&&(r=new Date(i+new Date(i).getTimezoneOffset()*6e4)));this._setDateAndTime(r.getTime())},h.prototype._populateModes=function(){this.modes=[];i.enableDrivingMode&&this.modes.push(new si(t.driving,"Drive"));i.enableTransitMode&&this.modes.push(new si(t.transit,"Transit"));i.enableWalkingMode&&this.modes.push(new si(t.walking,"Walk"));i.isSDK&&this.modes.push(new si(t.truck,"Truck"))},h.prototype._updateExistingDirections=function(){if(!this._isUpdating){for(var n=0,t=this._inputData.waypoints.length;n<t;n++)if(!this._inputData.waypoints[n].point){this._invalidateResults();return}this.getDirections()}},h.prototype._onWaypointsChanged=function(n){var i,u,f,r,t,e;for(this._isUpdating||(n.added?(i=n.added[0],u=n.addedIndex,u>0&&(this.waypoints[u-1].getWayPointModel().viaWaypoints=[])):n.removed&&(i=n.removed[0],f=n.removedIndex,f>0&&(this.waypoints[f-1].getWayPointModel().viaWaypoints=[]))),i&&(i.getWayPointModel().viaWaypoints=[]),r=this.waypoints.length-1,t=0;t<=r;t++)e=this.waypoints[t],e.setIndex(t),e.setShowDelete(r>1);this.setShowReverse(r<=1);this._updateAllowAddWp();this.updateModeBtnState();this.waypointResolvedEvent.invoke(null)},h.prototype._addWaypointViewModel=function(n){var i=this,t;n.isViaWaypoint||(t=new vr(n,this),t.waypointDeleteEvent.add(function(n){i._deleteWaypoint(n);i._updateExistingDirections()}),t.changed.add(function(n){n.name==="inputText"&&i.hideMessage()}),this.waypoints.insert(t),t.initAutosuggest(this.getControl(),this._map,this.controlTemplateFactory,this._suggestionRequestedHandler),ft.updateCurrentLocalDetailCards(this._filterAutosuggestDetailCards(h._localDetailCards)),ft.updateCurrentTransitStopCards(this._filterAutosuggestDetailCards(h._transitStopCards)),this.showAutosuggestPanel(),this.waypointResolvedEvent&&this.waypointResolvedEvent.invoke(t))},h.prototype._deleteWaypoint=function(n){this._inputData.tryRemoveWaypoint(n)&&(this._currentFocusedWaypoint===this.waypoints[n]&&(this._currentFocusedWaypoint=null),this.waypoints.removeAt(n))},h.prototype._onAvoidHighwaysChanged=function(n,t){this._inputData.options.avoidHighways=t;this._updateOptionsText();this._updateExistingDirections()},h.prototype._onAvoidTollsChanged=function(n,t){this._inputData.options.avoidTollRoads=t;this._updateOptionsText();this._updateExistingDirections()},h.prototype._onAvoidFerryChanged=function(n,t){this._inputData.options.avoidFerry=t;this._updateOptionsText();this._updateExistingDirections()},h.prototype._onRoundTripChanged=function(n,t){this._inputData.options.roundTrip=t;this._updateExistingDirections()},h.prototype._onUnitsKmChanged=function(n,t){this.setUnitsMiles(!t);t&&(this._inputData.options.unit=ct.km);t&&this._updateExistingDirections()},h.prototype._onUnitsMilesChanged=function(n,t){this.setUnitsKm(!t);t&&(this._inputData.options.unit=ct.miles);t&&this._updateExistingDirections()},h.prototype._onOptimizeTimeChanged=function(n,t){t&&i.enableOptimizeTime&&(this.setOptimizeCost(!1),this.setOptimizeTransfers(!1),this._inputData.options.optimize=rt.time,this._updateExistingDirections())},h.prototype._onOptimizeCostChanged=function(n,t){t&&i.enableOptimizeCost&&(this.setOptimizeTime(!1),this.setOptimizeTransfers(!1),this._inputData.options.optimize=rt.money,this._updateExistingDirections())},h.prototype._onOptimizeTransfersChanged=function(n,t){t&&i.enableOptimizeTransfers&&(this.setOptimizeCost(!1),this.setOptimizeTime(!1),this._inputData.options.optimize=rt.transfers,this._updateExistingDirections())},h.prototype._onAvoidFlightsChanged=function(n,t){this._inputData.options.avoidAirlines=t;this._updateExistingDirections()},h.prototype._onAvoidExpressTrainsChanged=function(n,t){this._inputData.options.avoidExpressTrains=t;var i=s("[name='dirOptsBulletTrains']",this.getControl()[0]);i.for_each(function(n){t?n.setAttribute("disabled","true"):n.removeAttribute("disabled")});this._updateExistingDirections()},h.prototype._onAvoidBulletTrainsChanged=function(n,t){this.getAvoidExpressTrains()||(this.setUseBulletTrains(!t),this._inputData.options.avoidBulletTrains=t,this._updateExistingDirections())},h.prototype._onUseBulletTrainsChanged=function(n,t){this.setAvoidBulletTrains(!t)},h.prototype._updateOptionsText=function(){var i="";if(this.getMode()===t.driving){var r=this.getAvoidHighways(),u=this.getAvoidTolls(),f=this.getAvoidFerry();u&&r&&f?i=n.L_Directions_NoTollsHighwaysOrFerry:u&&f?i=n.L_Directions_NoTollsOrFerry:f&&r?i=n.L_Directions_NoHighwaysOrFerry:u&&r?i=n.L_Directions_NoTollsOrHighways:r?i=n.L_Directions_NoHighways:u?i=n.L_Directions_NoTolls:f&&(i=n.L_Directions_NoFerry)}this.setOptionsText(i)},h.prototype._onModeChanged=function(r,u){var e,f;if(this.updateModeBtnState(),this._updateAllowAddWp(),this._updateOptionsText(),this.hideMessage(),this._inputData.mode=i.bestModeEnabled&&u===t.driving?t.multimode:u,u!==t.walking&&(u!==t.driving||i.enablePredictiveRouting)||this.setShowTimeControls(!1),e=!0,u===t.transit&&i.enableOptimizeTime&&this.setOptimizeTime(!0),f=i.enableDrivingArriveBy?3:2,u===t.transit&&this.timeTypes.length===f)i.enableDrivingArriveBy||this.timeTypes.insert({text:n.L_Directions_Arrive_By,value:d.arrival}),i.enableLastAvailableOption&&this.timeTypes.insert({text:n.L_Directions_Last_Train,value:d.lastAvailable});else if(u===t.driving&&this.timeTypes.length>f)for(this.timeTypes.indexOf(this.getTransitTimeType())>=f&&(this.setTransitTimeType(this.timeTypes[0]),e=!1);this.timeTypes.length>f;)this.timeTypes.removeAt(f);e&&this._updateExistingDirections();this.directionsModeChanged.invoke(u)},h.prototype._onTimeTypeChanged=function(n,t){if(!this._isUpdating){if(this._inputData.options.timeType=t.value,this.setTimeCtrlDisabled(t.value===d.lastAvailable),t.value===d.firstAvailable||t.value===d.lastAvailable){this._isUpdating=!0;var i=new Date;this._setDateAndTime(i.getTime());this._calendar&&this._calendar.SetDate(this.getDate());this._writeDateTimeToModel();this._isUpdating=!1;this._updateExistingDirections()}else this._writeDateTimeToModel(),this._invalidateResults();this.getShowTimeControls()||this._updateDateTimeSummary(!1)}},h.prototype._setDateAndTime=function(n){var t=new Date(n);this.setTime((t.getHours()*60+t.getMinutes())*60);t.setHours(0,0,0,0);this.setDate(t.getTime())},h.prototype._onDateTimeChanged=function(){this._isUpdating||(this.getTransitTimeType().value===d.firstAvailable?this.setTransitTimeType(this.timeTypes[1]):(this._writeDateTimeToModel(),this._updateExistingDirections()),this.getShowTimeControls()||this._updateDateTimeSummary(!1))},h.prototype._writeDateTimeToModel=function(){this._inputData.options.dateTime=this.getDate()+this.getTime()*1e3-new Date(this.getDate()).getTimezoneOffset()*6e4},h.prototype._updateDateTimeSummary=function(t){var f="",r="",i;t||(i=this.getTransitTimeType().value,i===d.firstAvailable||i===d.lastAvailable?r=this.getTransitTimeType().text:(f=u._formatString(i===d.departure?n.L_Directions_Depart_Time:n.L_Directions_Arrive_Time,u._formatUTCTimeString(new Date(this.getTime()*1e3))),r=u._formatLongDateString(new Date(this.getDate()))));this.setDateTimeSummary1(f);this.setDateTimeSummary2(r)},h.prototype._onShowTimeControlsChanged=function(n,t){var r;if(this._updateDateTimeSummary(t),t){var u=s(".dirTimePopup",this.getControl()[0]),i=u.select("a:not([tabindex='-1']), [tabindex='0']"),f=i[0];f.focus();r=s(i[i.length-1]);r.add_event("keydown",this._onTimeControlKeyDown);this._timeControlLastElement=r}else this._timeControlLastElement&&this._timeControlLastElement.remove_event("keydown",this._onTimeControlKeyDown)},h.prototype._onTimeControlKeyDown=function(n){var u=n.keyCode,t,i,r;if(u===9&&!n.shiftKey){for(n.stopPropagation(),n.preventDefault(),t=n.currentTarget,i=t.getAttribute("class");!i||i.indexOf("dropdownOpen")<0;)t=t.parentElement,i=t.getAttribute("class");r=s(".dirBtnGo",t)[0];r.focus()}},h.prototype._getModeData=function(n){for(var i,t=0,r=this.modes.length;t<r;t++)if(i=this.modes[t],i.mode===n)return i;return null},h.prototype._dismissAllAutosuggests=function(){this.setShowSuggestionsPanel(!1);for(var n=0;n<this.waypoints.length;n++)this.waypoints[n].cancelAutosuggest()},h.prototype._updateAllowAddWp=function(){this.setAllowAddWp(this.waypoints.length<this._getModeData(this.getMode()).maxWaypoints)},h.prototype._reorderWaypoint=function(n,t){var r=this.waypoints[n],i;this.waypoints.removeAt(n);this.waypoints.insert(r,t);this._inputData.reorderWaypoint(n,t);r.initAutosuggest(this.getControl(),this._map,this.controlTemplateFactory,this._suggestionRequestedHandler);i={};i.RT=1;w.logInstrumentationEvent(v.WR,i)},h.prototype._resolveWayPoint=function(n,t){var r,u;if(!this.resolveWaypointsInRoutingService){r=null;u=this.waypoints[n];n>0&&(r=this._getMapBoundsForWaypoint(this.waypoints[n-1]));var f=u.getWayPointModel(),o={query:u.getInputText(),mapBounds:r,point:r?null:this._getValuesForPreviousLocation(n),disableTaskActivate:!0,filterUrlParam:f.filterUrlParam,asName:f.asName,asFormattedAddress:f.asFormattedAddress,entryPoint:ni.DirectionsWaypointSearch},s=vt.logPerfEvent(et.RW),e={requestorId:this._taskId,requestorState:{waypointIndex:n,callbackState:this._generateCallbackState(),perfState:s,isBeingPrefetched:t},type:a.localSearchTask,requestState:o};i.isSDK?this.resolveWaypointSDKEvent.invoke(e):l.invokeHandler(c.taskProcessDataHandlerKey,e)}},h.prototype._generateCallbackState=function(){for(var t="",n=0,i=this.waypoints.length;n<i;n++)t+=this.waypoints[n].getInputText();return t},h.prototype._invokeResolveWaypoint=function(t,i,r){for(var u,s,e,h,o;t<=this._inputData.waypoints.length-1&&this._inputData.waypoints[t].point;)t++;if(t<=this._inputData.waypoints.length-1&&!this.resolveWaypointsInRoutingService)this._resolveWayPoint(t);else{if(u=!0,s=this.waypoints[0].getWayPointModel().point,s){for(e=1;e<this.waypoints.length;e++)if(h=this.waypoints[e].getWayPointModel().point,!h||!b.areEqual(h,s)){u=!1;break}}else u=!1;u?this.clearResultsAndShowMessage({errorDetails:[n.L_Directions_Error_Equal_Waypoints],errorCode:f.atleastTwoWaypointRequired}):(o={DirectionsInputData:this._inputData},i&&(o.routeIndex=i),r&&(o.routeId=r),this.directionsResultsRequested.invoke(o))}},h.prototype._getMapBoundsForWaypoint=function(n){var r=n.getEntity(),i=r&&r.getBoundingBox(),t;return i&&i.length===2?(t=nr.fromLocations(i[0],i[1]),[t.getNorth(),t.getWest(),t.getSouth(),t.getEast()]):null},h.prototype._getValuesForPreviousLocation=function(n){if(n>0&&n<this.waypoints.length){var i=this.waypoints[n-1],t=i.getWayPointModel().point;if(t)return[t.latitude,t.longitude]}return null},h.prototype._invalidateResults=function(){this.clearDirectionsResults.invoke()},h.prototype.onSeeAllRoutesClick=function(){},h.prototype.seeAllRoutesReturnClick=function(){},h.prototype._setEnabledOptions=function(){this.showOptimizeTime=i.enableOptimizeTime;this.showOptimizeCost=i.enableOptimizeCost;this.showOptimizeTransfers=i.enableOptimizeTransfers},h.prototype._setTransitModeOptions=function(n){n.defineProperty("avoidFlights",this._onAvoidFlightsChanged);n.defineProperty("avoidExpressTrains",this._onAvoidExpressTrainsChanged);n.defineProperty("avoidBulletTrains",this._onAvoidBulletTrainsChanged);n.defineProperty("useBulletTrains",this._onUseBulletTrainsChanged);var t=this._inputData.options.transitTypes;n.defineProperty("allowBuses",this._updateTransitModeOptionsFromSelection,null,{defaultValue:t[1]});n.defineProperty("allowCityRails",this._updateTransitModeOptionsFromSelection,null,{defaultValue:t[2]});n.defineProperty("allowSubways",this._updateTransitModeOptionsFromSelection,null,{defaultValue:t[7]});n.defineProperty("allowFerries",this._updateTransitModeOptionsFromSelection,null,{defaultValue:t[5]});n.defineProperty("allowTrains",this._updateTransitModeOptionsFromSelection,null,{defaultValue:t[4]})},h.prototype._updateTransitModeOptionsFromData=function(){var n=this._inputData.options.transitTypes;this.setAllowBuses(n[1]);this.setAllowCityRails(n[2]);this.setAllowSubways(n[7]);this.setAllowFerries(n[5]);this.setAllowTrains(n[4])},h.prototype._updateTransitModeOptionsFromSelection=function(){var n=this._inputData.options.transitTypes;n[1]=this.getAllowBuses();n[2]=this.getAllowCityRails();n[7]=this.getAllowSubways();n[5]=this.getAllowFerries();n[4]=this.getAllowTrains();this._updateExistingDirections()},h.prototype._getErrorText=function(t,i){var r=t.valueOf();typeof r!="number"&&(r=f[r]);switch(r){case f.atleastTwoWaypointRequired:case f.searchServiceFailed:return i?i:n.L_Directions_Error_No_Results;case f.CantFindNearbyRoad:return n.DirectionsErrorCannotFindRoad;case f.DataSourceNotFound:return n.DirectionsErrorSourceNotFound;case f.NoAvailableTransitTrip:return n.DirectionsErrorNoTransitTrip;case f.NoNearbyStops:return n.DirectionsErrorNoNearbyStops;case f.NoSolution:return n.DirectionsErrorNoSolution;case f.OutOfTransitBounds:return n.DirectionsErrorOutOfBoundsForTransit;case f.TimeoutOccurred:return n.DirectionsErrorTimeout;case f.TooFar:return n.DirectionsErrorTooFar;case f.TransitStopsTooClose:return n.DirectionsErrorStopsTooClose;case f.WalkingBestAlternative:return n.DirectionsErrorWalkBestAlternative;case f.ParameterValidationError:case f.SkpError:case f.CacheMiss:case f.RateLimiterRejected:return n.DirectionsServerError;case f.generalError:case f.noResults:case f.otherError:case f.UnknownError:default:return n.L_Directions_Error_No_Results}},h}(ut),pr=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return p(t,n),t.prototype.initializeCalendar=function(){},t.prototype.setShowInputBoxes=function(n){this.setShowWaypoints(n);this.setShowEditDirections(!n)},t.prototype.onEditDirectionsClick=function(n){n.preventDefault();this.setShowInputBoxes(!0)},t.prototype.showEditAndCollapseCard=function(){this.setShowInputBoxes(!1);l.invokeHandler(c.layoutDataHandlerKey,{action:"updateLayout",state:{layoutType:"collapseCard"}})},t.prototype.onSeeAllRoutesClick=function(n){n.preventDefault();this.setShowEditDirections(!1);this.setShowRouteCategoriesPanel(!1);this.seeAllRoutesClick.invoke()},t.prototype.seeAllRoutesReturnClick=function(){this.setShowEditDirections(!0);this.setShowRouteCategoriesPanel(!0)},t}(vi),wr=function(){function t(){}return t.prototype.getTitle=function(){return""},t.prototype.getSubtitle=function(){return""},t.prototype.getDescriptionTime=function(){return null},t.prototype.getDescriptionTimeNoTraffic=function(){return null},t.prototype.getRouteEmbellishments=function(){return null},t.prototype.getStartTime=function(){return null},t.prototype.getEndTime=function(){return null},t.prototype.getDescriptionVia=function(){return""},t.prototype.getHtmlFormattedInstruction=function(){return""},t.prototype.getInstruction=function(){return[]},t.prototype.getStartInstruction=function(t,i,r,u,f,e){var s=this._createWaypointInstruction(t,u?"dirRouteStart":"dirRouteStop bm_dirRouteLegStart",r[0].routeLegStopPoint,f),c,o,h,l;for(s.viaPoints=[],c=t.getWayPointModel(),o=1;o<r.length;o++)h=r[o].routeLegStopPoint,h.isVia&&c.viaWaypoints.length>=o&&(l={text:n.L_Directions_Via_Text.replace("{0}",h.description),removeLinkText:n.L_Directions_Via_Remove_Link,waypointIndex:t.getIndex(),viaPointIndex:o-1},s.viaPoints.push(l),c.viaWaypoints[o-1].address=h.description);return u&&e&&(s.startTimeHint=this.getStartTime(e)),s},t.prototype.getEndInstruction=function(n,t,i,r,u,f){var e=this._createWaypointInstruction(n,u||u===undefined?"dirRouteEnd":"dirRouteStop bm_dirRouteLegEnd",i[i.length-1].routeLegStopPoint,r);return u&&f&&(e.endTimeHint=this.getEndTime(f)),e},t.prototype.getFormattedDistanceText=function(n,t,i){var r=t.distanceUnit.toLowerCase()!=="mile";return n?u._formatDistanceString(n,r,i):""},t.prototype.getDurationString=function(t){var r=Math.round(t/60),i=r%60,f=Math.floor(r/60);return f==0?u._formatString(n.L_Directions_Duration_Min,i==0?1:i):u._formatString(n.L_Directions_Duration,f,i)},t.prototype.setRenderOptions=function(n){this.renderOptions=n},t.prototype.getCost=function(){return null},t.prototype._createWaypointInstruction=function(n,t,i,r){if(n)return new dt(r,i,null,t,n,this.renderOptions)},t}(),ei=function(t){function r(){var n=t.call(this)||this;return n.roadShieldsReadyEvent=new o,n.unloadedRoadShields=0,n}return p(r,t),r.prototype.setMap=function(n){this._map=n},r.prototype.getDescriptionVia=function(t){var i=t&&t.routeLegs&&t.routeLegs.length&&t.routeLegs[0].description;return i?u._formatString(n.L_Directions_Results_Title,i):null},r.prototype.getDescriptionTime=function(n){return n?this.getDurationString(n.travelDurationTraffic):null},r.prototype.getRouteEmbellishments=function(t){var i=[],r=null,e,s,o,u,f;if(t&&t.routeLegs){for(e=0;e<t.routeLegs.length;e++)for(s=t.routeLegs[e],o=0;o<s.routeSubLegs.length;o++)if(u=s.routeSubLegs[o],u.routeProperties&&u.routeProperties.length>0)for(f=0;f<u.routeProperties.length;f++)u.routeProperties[f]&&i.push(u.routeProperties[f]);i.length>0&&(i.indexOf("Toll")!=-1?r=n.L_Directions_RouteInfo_TollRoad:i.indexOf("Ferry")!=-1?r=n.L_Directions_RouteInfo_Ferry:i.indexOf("CrossBorder")!=-1?r=n.L_Directions_RouteInfo_CrossBorder:i.indexOf("NoHighway")!=-1?r=n.L_Directions_RouteInfo_LocalRoads:i.indexOf("Unpaved")!=-1&&(r=n.L_Directions_RouteInfo_Unpaved))}return r},r.prototype.getDescriptionTimeNoTraffic=function(t){var i=this.getStartTime(t),r;return i?i:t.travelDuration&&t.travelDurationTraffic&&(r=t.travelDurationTraffic-t.travelDuration,r>=180&&r/t.travelDurationTraffic>.05)?(i=this.getDurationString(r),i?u._formatString(n.L_Directions_Results_Delay_Time,i):null):null},r.prototype.getStartTime=function(t){var r,i;return t&&(i=t&&t.routeLegs&&t.routeLegs.length&&t.routeLegs[0],i&&i.startTime&&(r=u._getTimeString(i.startTime))),r?u._formatString(n.L_Directions_Depart_Time,r):null},r.prototype.getEndTime=function(t){var r,i;return t&&(i=t&&t.routeLegs&&t.routeLegs.length&&t.routeLegs[t.routeLegs.length-1],i&&i.endTime&&(r=u._getTimeString(i.endTime))),r?u._formatString(n.L_Directions_Arrive_Time,r):null},r.prototype.getTitle=function(){return null},r.prototype.getSubtitle=function(n){return n?this.getFormattedDistanceText(n.travelDistance,n,!0):""},r.prototype.getInstruction=function(n,t,i){var f=[],u,e;return n&&(u=new dt(i,n.maneuverPoint,n,null,null,this.renderOptions),u.travelDistanceText=this.getFormattedDistanceText(n.travelDistance,t),u.stepText=n.instruction.text,u.formattedText=this.getHtmlFormattedInstruction(n.instruction.formattedText),u.hints=n.hints,u.warnings=this._sortWarnings(n.warnings),n.travelDistance>=r.TravelDistanceThreshhold&&(u.travelDurationText=this.getDurationString(n.travelDuration)),e=n.instruction.maneuverType,this._constructRoadShieldUrl(u,n.details,e),f.push(u)),f},r.prototype.getHtmlFormattedInstruction=function(n){return n&&(n=n.replace(new RegExp("(<\/ExitNumber>|<\/TurnDir>|<\/RoadName>|<\/Sign>|<\/WaypointName>)","gi"),"<\/b>"),n=n.replace(new RegExp("(<ExitNumber>|<TurnDir>|<RoadName>|<Sign>|<WaypointName>)","gi"),"<b>"),n=n.replace(new RegExp("<\/([^bs>]*)>","gi"),""),n=n.replace(new RegExp("<([^bs>]*)>","gi"),"")),n},r.prototype._constructRoadShieldUrl=function(n,t,u){var c=this,e,o,h,l,s,f,a,v;if(!t||!t.length){n.setStepIconClass(u);return}for(e=[],o=-1,h=0;h<t.length;h++)l=t[h],s=l.roadShieldRequestParameters,s&&(o===-1&&(o=s.bucket||r._defaultRoadShieldBucketId),s.shields&&Array.prototype.push.apply(e,s.shields));if(e.length)e.length>1&&e.sort(function(n,t){var i=n.roadShieldType,r=t.roadShieldType;return i!=r?i-r:t.labels[0].localeCompare(n.labels[0])});else{n.setStepIconClass(u);return}if(f=e[0],!this._shouldDisplayShield(o,f,u)){n.setStepIconClass(u);return}i.enableRoadShieldIconXsr?(this.unloadedRoadShields++,a=[f.roadShieldType-1],this._map&&this._map.getTemplateSelector().then(function(t){t.getShieldsAsync(r._roadShieldZoom,o,a,function(t){try{var i=c._getLabel(f.labels),r=t[0].renderIcon({id:null,name:i}),e=r[0].toDataURL();n.setRoadShieldUrl(e)}catch(o){n.setStepIconClass(u)}finally{--c.unloadedRoadShields==0&&c.roadShieldsReadyEvent.invoke()}})})):(v=i.roadShieldServiceUrlFormat.replace("{bucket}",o).replace("{shield}",f.roadShieldType).replace("{label}",f.labels&&f.labels.length?f.labels[0]:""),n.setRoadShieldUrl(v))},r.prototype._getLabel=function(n){if(!n||!n.length)return"";if(n[0].indexOf("UP:")===0)try{var t=JSON.parse(n[0].substring(3));return t.label}catch(i){return n[0]}return n[0]},r.prototype._shouldDisplayShield=function(n,t,i){if(n===50360||n===50395){if(t.roadShieldType===1||t.roadShieldType===2)return!0}else if(t.roadShieldType===1)return!0;return i==="TakeRampLeft"||i==="TakeRampRight"||i==="TakeRampStraight"||i==="Merge"||i==="RampThenHighwayLeft"||i==="RampThenHighwayRight"||i==="RampToHighwayStraight"||i==="BearThenMerge"||i==="TurnThenMerge"||i==="RoadNameChange"},r.prototype._sortWarnings=function(n){if(n)return n.sort(function(n,t){var i=["Serious","Moderate","Minor","LowImpact","None"];return i.indexOf(n.severity)-i.indexOf(t.severity)})},r.TravelDistanceThreshhold=10,r._roadShieldZoom=14,r._defaultRoadShieldBucketId=787073,r}(wr),yi=function(n){function t(){return n.call(this)||this}return p(t,n),t.prototype.getDescriptionTimeNoTraffic=function(){return null},t}(ei),br=function(t){function r(){return t.call(this)||this}return p(r,t),r.prototype.getDescriptionVia=function(t){var i=t&&t.routeLegs&&t.routeLegs.length&&t.routeLegs[0].itineraryItems,e="",f,o;if(i&&i.length)for(f=0,o=0;f<i.length;f++)i[f].transitLine&&(e+=u._formatString(o++>0?n.L_Directions_Transit_Via2:n.L_Directions_Transit_Via1,r.typeNames[i[f].iconType],i[f].transitLine.abbreviatedName));return e?e:null},r.prototype.getTitle=function(n){var i="",t,f,e;return n&&(t=n&&n.routeLegs&&n.routeLegs.length&&n.routeLegs[0],t&&t.startTime&&t.endTime&&(f=u._getTimeString(t.startTime),e=u._getTimeString(t.endTime),i=u._formatString(r._transitTimeFormat,f,e))),i},r.prototype.getDescriptionTimeNoTraffic=function(){return null},r.prototype.getSubtitle=function(n){return n?this.getDurationString(n.travelDuration):""},r.prototype.getInstruction=function(t,r,f){var p=[],e,l,h,w,o,a,it,c,y,s,v,d,g,k,nt,tt;if(t){if(e=new dt(f,t.maneuverPoint,t,null,null,this.renderOptions),t.groupText?(l=t.childItineraryItems[0],e.setStepIconClass(l.iconType),e.stepText=t.groupText,e.formattedText=e.stepText,e.itineraryItem.maneuverPoint=l.maneuverPoint,e.location=new b(l.maneuverPoint.coordinates[0],l.maneuverPoint.coordinates[1]),e.itineraryItem.instruction=l.instruction,e.setShow(!0)):(e.setStepIconClass(t.iconType),e.stepText=t.instruction.text,e.formattedText=this.getHtmlFormattedInstruction(t.instruction.formattedText),e.timeText=t.time?u._getTimeString(t.time):""),e.hints=t.hints||[],e.warnings=t.warnings||[],t.transitLine&&(t.transitLine.uri&&t.transitLine.uri.indexOf(i.specialAttributionLink)>-1&&(e.specialAttributionUri=t.transitLine.uri,e.specialAttributionLink=i.specialAttributionLink),t.transitLine.lineColor&&(e.transitLineColor=u._formatHexColorString(t.transitLine.lineColor,""))),p.push(e),e.groupItems=[],e.groupItemsLocations=[],w=t.childItineraryItems,w&&w.length)for(e.childSteps=[],c=0;c<w.length;c++)o=w[c],t.groupText?(a=this.getInstruction(o,r,f)[0],it=o.instruction.maneuverType,a.setShow(!1),a.setStepIconClass(it),a.parentStepIndex=t.parentInstructionIndex,p.push(a),e.groupItems.push(a),v=o.maneuverPoint.coordinates,e.groupItemsLocations.push(new b(v[0],v[1]))):o.instruction.maneuverType==="TransitArrive"?(h=new dt(f,o.maneuverPoint,o,o.instruction.maneuverType,null,this.renderOptions),h.parentStepIndex=t.parentInstructionIndex,h.stepText=o.instruction.text,h.formattedText=this.getHtmlFormattedInstruction(o.instruction.formattedText),h.timeText=u._getTimeString(o.time),h.transitArriveTime=u._getTime(o.time),h.needPushpin=!1,h.transitLineColor=e.transitLineColor):o.instruction.maneuverType==="TransitDepart"&&(e.transitDepartTime=u._getTime(o.time),e.timeText=u._getTimeString(o.time),e.childSteps=[{stepText:o.instruction.text,formattedText:this.getHtmlFormattedInstruction(o.instruction.formattedText)}]);if(t.transitStops&&t.transitStops.length)for(c=0;c<t.transitStops.length;c++)y=t.transitStops[c],s=new dt(f,y.position,null,null,null,this.renderOptions),s.setShow(!1),s.setStepIconClass("TransitStop"),s.stepText=y.stopName,s.parentStepIndex=t.parentInstructionIndex,s.formattedText=s.stepText,s.needPushpin=!0,s.transitStopID=y.stopId,s.transitStopName=y.stopName,s.transitLineColor=e.transitLineColor,p.push(s),e.groupItems.push(s),v=y.position.coordinates,e.groupItemsLocations.push(new b(v[0],v[1]));if(h){if(h.transitDepartTime=e.transitDepartTime,e.hints){for(d=[],g=[],k=0;k<e.hints.length;k++)nt=e.hints[k],tt=nt.hintType,(tt==="PreviousTransitStop"||tt==="NextTransitStop"?d:g).push(nt);e.hints=g;h.hints=d}p.push(h)}t.iconType==="Walk"&&t.travelDistance&&(e.hints=e.hints||[],e.hints.unshift({text:u._formatString(n.L_Directions_WalkDistance,this.getFormattedDistanceText(t.travelDistance,r),this.getDurationString(t.travelDuration))}))}return p},r.prototype.getStartInstruction=function(n,i,r,f,e){var o=t.prototype.getStartInstruction.call(this,n,i,r,f,e);return o.timeText=u._getTimeString(i.startTime),o},r.prototype.getEndInstruction=function(n,i,r,f){var e=t.prototype.getEndInstruction.call(this,n,i,r,f);return e.timeText=u._getTimeString(i.endTime),e},r.prototype.getHtmlFormattedInstruction=function(n){return n&&(n=n.replace(new RegExp("(<\/TransportType>|<\/TransitLineName>|<\/TransitLineTerminus>|<\/TransitStop>|<\/StartLocation>|<\/EndLocation>|<\/ServiceProvider>|<\/Phone>|<\/Action>)","gi"),"<\/b>"),n=n.replace(new RegExp("(<TransportType>|<TransitLineName>|<TransitLineTerminus>|<TransitStop>|<StartLocation>|<EndLocation>|<ServiceProvider>|<Phone>|<Action>)","gi"),"<b>"),n=n.replace(new RegExp("<\/([^bs>]*)>","gi"),""),n=n.replace(new RegExp("<([^bs>]*)>","gi"),"")),n},r.prototype.getCost=function(t){var r=0,i,u;if(t&&t.routeLegs&&t.routeLegs.length)for(i=0,u=t.routeLegs.length;i<u;i++)r+=t.routeLegs[i].cost;return n.L_Directions_Cost.replace("{0}",r)},r._transitTimeFormat="{0} - {1}",r.typeNames={Bus:n.L_Directions_Bus,Ferry:n.L_Directions_Ferry,Train:n.L_Directions_Train,Tube:n.L_Directions_Tube,Airline:n.L_Directions_Airline},r}(wr),pi=function(r){function e(u,f,s,h,c,l,a,v,y,p){var w=this,b={};return w=r.call(this,b,f,ar)||this,b.defineProperty("disclaimerText"),b.defineProperty("showSeeAllRoutes",function(){y&&y.displayDisclaimer!==undefined||w.setShowDisclaimer(!w.getShowSeeAllRoutes())}),b.defineProperty("showDisclaimer"),b.defineProperty("showTransitLogo",null,null,{defaultValue:!0}),w._map=u,w._perfLog=l,w._totalDirectionsRequestPerfState=a,w._controlTemplateFactory=f,w.directionsResultsTitleSet=[],w.directionsResultsListSet=[],w.routelines=[],w.stopPoints=[],w.allStopPoints=[],w.routeStopPointPathIndices=[],w._requestOptions=s,w._panelViewModel=h,w._taskId=v,w.disposables.push(w._routeMapEntitiesCollection=c),w.resultsOnlyDisplayed=new o,w._directionsFormattedTextProvider=e._directionsFormattedTextProviders[t[s.mode]](),w._directionsFormattedTextProvider.roadShieldsReadyEvent&&w.disposables.push(w._directionsFormattedTextProvider.roadShieldsReadyEvent.add(function(){w._onRoadShieldReadyEvent()})),w._directionsFormattedTextProvider.setRenderOptions(y),w._routeSelected=-1,w.reportProblemClicked=new o,w.resources=n,w.routeSelectedEvent=new o,w.showPrint=st.isEnabled,w.discarded=!1,w.seeAllRoutesReturnClick=new o,w.isSDK=i.isSDK,w.setShowDisclaimer(!w.getShowSeeAllRoutes()),y&&w._setRenderOptions(y),w._routeDraggable=typeof p=="boolean"?p:!0,(s.mode===t.driving||s.mode===t.truck||s.mode===t.walking)&&w._directionsFormattedTextProvider.setMap(w._map),w._startClass=" startWaypointLetter",w._stopClass=" stopWaypointLetter",w._endClass=" endWaypointLetter",w}return p(e,r),e.prototype.hideDirectionsResultsListSet=function(){for(var n=0;n<this.directionsResultsListSet.length;n++)this.directionsResultsListSet[n].setShowResults(!1),this.directionsResultsTitleSet[n].setIsSelected(!1)},e.prototype.boolToSelectedTitleClassName=function(n){return n?"drTitle selected":"drTitle"},e.prototype.stringToEmbellishmentClassName=function(n){return n===this.resources.L_Directions_RouteInfo_TollRoad?"drEmbellishRed":"drEmbellish"},e.prototype.boolToEmbellishmentClassName=function(n){return n?"drEmbellishLateRed":""},e.prototype.boolToTransitEmbellishmentClassName=function(n){return n?"drTransitEmbellish":""},e.prototype.boolToSelectedDurationClassName=function(n){return this._requestOptions.mode===t.transit?"hide":n?"drDuration selected":"drDuration"},e.prototype.routeLinkAriaLabel=function(n){return n?this.resources.DirectionRouteInfoActiveAriaLabel:this.resources.DirectionRouteInfoInActiveAriaLabel},e.prototype.indexToOddEvenClass=function(n){return n===null||n===undefined||n===-1?"":"waypointPrintMaps "+(n%2==0?"even":"odd")},e.prototype.indexToOddEvenBackgroundClass=function(n){return n===null||n===undefined||n===-1?"":n%2==0?"bg":"noBg"},e.prototype.indexToWaypointTypeLabel=function(n){return n===null||n===undefined||n===-1?"":this.indexToIconTextStart(n)},e.prototype.getRouteMode=function(n){var t=this._requestOptions.mode;return i.bestModeEnabled&&this._routeSets&&this._routeSets.length>0&&n<this._routeSets.length&&(t=this._getCurrentRouteMode(this._routeSets[n])),t},e.prototype.getDirections=function(n,t,i,r,u,f,e){var s=this,h=vt.logPerfEvent(et.RR,this._requestOptions.mode),o=this._map&&this._map.getMapOptions(),c={requestOptions:this._requestOptions,needBestMapView:t,perfState:h,isDragRequest:i,viaPoint:r,legIndex:u,subLegIndex:f,viaPointRemoved:e,mapCredentials:o&&o.credentials};this._rawResponse=null;yr.downloadRoutes(c,function(t,i,r){s._onDownloadRouteCallback(t,i,r,n)})},e.prototype.taskStateChanged=function(n){this._routeMapEntitiesCollection.setTaskPrimitiveState(n)},e.prototype.onInstructionsMouseLeave=function(){this._routeMapEntitiesCollection.highlightAndInvalidate(null)},e.prototype.onStepTextClick=function(n){var r,u,h;n&&n.stopImmediatePropagation();n&&n.preventDefault&&n.preventDefault();var f=n.currentTarget,o=f.getAttribute("data-eid"),s=f.getAttribute("data-sf"),v=f.getAttribute("data-q"),t={};s?t.filterUrlParam=s:o&&(t.id=o);for(var i=0,e=ot.localDetailCardsData.length,y=ot.polygonEntityDetailCardsData.length;i<e+y;i++)if(r=i<e?ot.localDetailCardsData[i]:ot.polygonEntityDetailCardsData[i-e],u=r.data,u&&u.length===1&&(h=u[0],r.processorId&&h.id===t.id)){l.invokeHandler(c.taskDataHandlerKey,{action:"focus",id:r.processorId});return}t.query=v;t.entryPoint=ni.DirectionsRouteList;l.invokeHandler(c.taskProcessDataHandlerKey,{requestState:t,type:a.localSearchTask})},e.prototype.onRemoveViaClick=function(n){n&&n.stopImmediatePropagation();n&&n.preventDefault&&n.preventDefault();var t=e.getAttributeFromHtmlElement(n.currentTarget,"data-wpi"),i=e.getAttributeFromHtmlElement(n.currentTarget,"data-vwpi");this._panelViewModel.removeViaPoint(t,i)},e.prototype.getRouteSelected=function(){return this._routeSelected},e.prototype.onPrintDirectionsClick=function(n){n&&n.preventDefault&&n.preventDefault();st.isEnabled&&l.invokeHandler(c.printDataHandlerKey,{source:2,taskType:a.directionsTask,taskId:this._taskId,data:{RI:this.getRouteSelected(),LOC:"P"}})},e.prototype.dispose=function(){this._map=null;u._clearDisposables(this.directionsResultsListSet);u._clearDisposables(this.directionsResultsTitleSet);u._clearDisposables(this.waypoints);this._routeMapEntitiesCollection.dispose();this.clearRoutes();r.prototype.dispose.call(this)},e.prototype._buildAttributionsForPrint=function(){var i="",n;if(this._requestOptions.mode==t.transit&&this.showAttribution)for(n=0;this.transitAttributions&&n<this.transitAttributions.length;n++)this.transitAttributions[n].agencyName&&(i=i?i+this.resources.L_Directions_TimeDistance_Separator+this.transitAttributions[n].agencyName:this.transitAttributions[n].agencyName);return i},e.prototype.getDirectionsHtmlContentForPrint=function(){var n=this,r=this.getRouteSelected(),i,u,f;return this.printTitleViewModel=this.directionsResultsTitleSet[r],this.printInstructionsViewModel=this.prepareInstructionListViewModelForPrint(this.directionsResultsListSet[r]),this.printMode="directionsPanel "+(this._requestOptions.mode===t.transit?"transit":this._requestOptions.mode===t.walking?"walking":"driving"),this.printTitleViewModel.routeMode=this.getRouteMode(r),this.attributionText=this._buildAttributionsForPrint(),this.notesMaxCharSize=st.notesMaxChars,i={boolToSelectedDurationClassName:function(t){return n.boolToSelectedDurationClassName(t)},boolToSelectedTitleClassName:function(t){return n.boolToSelectedTitleClassName(t)},boolToEmbellishmentClassName:function(t){return n.boolToEmbellishmentClassName(t)},boolToTransitEmbellishmentClassName:function(t){return n.boolToTransitEmbellishmentClassName(t)},stringToEmbellishmentClassName:function(t){return n.stringToEmbellishmentClassName(t)},boolToDisplay:function(t){return n.boolToDisplay(t)},nullToDisplayNone:function(t){return n.nullToDisplayNone(t)},fractionToPercent:function(t){return n.fractionToPercent(t)},boolToNotDisplay:function(t){return n.boolToNotDisplay(t)},indexToStartClass:function(t){return n.indexToStartClass(t)},indexToEndClass:function(t){return n.indexToEndClass(t)},showGroupToClass:function(t){return n.showGroupToClass(t)},getWarningIconClass:function(t){return n.getWarningIconClass(t)},arrayToDisplay:function(t){return n.arrayToDisplay(t)},lineColorToIconClass:function(t){return n.lineColorToIconClass(t)},onPrintDirectionsClick:function(t){return n.onPrintDirectionsClick(t)},indexToOddEvenClass:function(t){return n.indexToOddEvenClass(t)},indexToWaypointTypeLabel:function(t){return n.indexToWaypointTypeLabel(t)},indexToOddEvenBackgroundClass:function(t){return n.indexToOddEvenBackgroundClass(t)},modeToDisplay:function(n){return n===t.transit?"none":"inline"},indexToIconTextStart:function(t){return n.indexToIconTextStart(t)},indexToIconTextEnd:function(t){return n.indexToIconTextEnd(t)},emptyUriToClass:function(t){return n.emptyUriToClass(t)},waypointTypeToClass:function(t){return"dirLegIconText"+(t==1?n._startClass:t==2?n._endClass:n._stopClass)}},this.titlePrintTemplate=new hi(ef,i),this.instructionsPrintTemplate=new hi(uf,i),u=this._controlTemplateFactory({templateText:tf,staticResources:i}),f=u.applyDataTemplate(this),f[0].outerHTML},e.prototype.getWarningIconClass=function(n){var t="dirWarning";return n?t+" warning"+n:t},e.prototype.emptyUriToClass=function(n){return n?"":"noClickAttribution"},e.prototype.select=function(n,t,i){var r,u,f;if(n!==this._routeSelected&&n>=0&&n<this.directionsResultsTitleSet.length){for(r=0;r<this.directionsResultsTitleSet.length;r++)u=n===r,this.directionsResultsTitleSet[r].setIsSelected(u),this.directionsResultsListSet[r].setShowResults(u);this._routeSelected=n;this.routeSelectedEvent&&this.routeSelectedEvent.invoke();this._routeMapEntitiesCollection.select(n,t,i,this._requestOptions.mode);f=s(".drTitle.selected",this.getControl()[0]).select("a");f[0]&&f[0].focus()}},e.prototype.getRoutesLength=function(){return this.directionsResultsTitleSet.length},e.prototype.clearRoutesLabels=function(){this._routeMapEntitiesCollection&&this._routeMapEntitiesCollection.clearRoutesLabels()},e.prototype.showRoutesLabels=function(){this._routeMapEntitiesCollection&&this._routeMapEntitiesCollection.showRouteLabels()},e.prototype.clearRoutes=function(){this.directionsResultsTitleSet=[];this.directionsResultsListSet=[];this._routeMapEntitiesCollection.clearRoutesLabels();this.routeStopPointPathIndices=[];this.routelines=[];this.stopPoints=[];this._rawResponse=null},e.prototype.instructionRowClass=function(n){var t=" circleIcon";switch(n){case"TurnLeft":case"TurnLeftThenBearLeft":case"TurnLeftThenBearRight":case"TurnLeftThenTurnLeft":case"TurnLeftThenTurnRight":return"turnLeft"+t;case"TurnRight":case"TurnRightThenBearLeft":case"TurnRightThenBearRight":case"TurnRightThenTurnLeft":case"TurnRightThenTurnRight":return"turnRight"+t;case"UTurn":case"TurnBack":return"uTurnLeft"+t;case"KeepStraight":case"Continue":case"KeepOnRampStraight":case"KeepToStayStraight":case"RoadNameChange":case"TakeRampStraight":case"Transfer":return"keepStraight"+t;case"BearLeft":case"BearLeftThenBearLeft":case"BearLeftThenBearRight":case"BearLeftThenTurnLeft":case"BearLeftThenTurnRight":case"KeepOnRampLeft":return"slightLeft"+t;case"BearRight":case"BearRightThenBearLeft":case"BearRightThenBearRight":case"BearRightThenTurnLeft":case"BearRightThenTurnRight":case"KeepOnRampRight":return"slightRight"+t;case"KeepLeft":case"KeepToStayLeft":return"keepLeft"+t;case"KeepRight":case"KeepToStayRight":return"keepRight"+t;case"EnterRoundabout":case"EnterThenExitRoundabout":return"enterRoundaboutRight"+t;case"TakeRampRight":case"TakeRampLeft":case"ExitRoundabout":case"EnterRoundaboutLeft":case"Merge":case"TurnToStayLeft":case"TurnToStayRight":case"UTurnRight":case"RampThenHighwayRight":case"RampThenHighwayLeft":case"DepartStart":return n+t;case"Bus":case"Walk":case"Ferry":case"Tube":case"Train":return n+t;default:return n}},e.prototype.prepareInstructionListViewModelForPrint=function(n){for(var i,r,t=0;t<n.routeLegs.length;t++)i=n.routeLegs[t],r=i.instructionSteps,i.startWaypointAddress=r[0].stepText,i.endWaypointAddress=r[r.length-1].stepText,i.startIconType=t==0?1:3,i.endIconType=t==n.routeLegs.length-1?2:3,i.resources=this.resources;for(t=0;t<this.waypoints.length;t++)this.waypoints[t].waypointType=t==0?1:t==this.waypoints.length-1?2:3;return n.resources=this.resources,n},e.prototype._onDownloadRouteCallback=function(t,i,r,u){var c,l;if(!this.discarded){var o=t.requestOptions,e=t.isDragRequest,h=t.needBestMapView,s;(e&&(s="DR"),t&&t.perfState&&t.perfState.end(s),this._requestOptions===o)&&(this.clearRoutes(),c=i?i.traceId:null,r&&r.errorCode===f.Success&&i&&i.resourceSets&&i.resourceSets.length>0?(this._rawResponse=i,this._setDirectionsResults(o,i,h,e)):!r||r.errorCode===f.Success||r.errorDetails&&r.errorDetails.length||(l=n.L_Directions_Error_No_Results,r.errorDetails=[l]),u(c,r,o,h,e),!e&&this._totalDirectionsRequestPerfState&&(this._totalDirectionsRequestPerfState.end(s),this._totalDirectionsRequestPerfState=undefined))}},e.getAttributeFromHtmlElement=function(n,t){return s.Internals.parseJSON(n.getAttribute(t))},e.prototype.setReportProblemLink=function(n){this._feedBackState=n;this._feedBackState.entryPoint=3},e.prototype.reportProblem=function(n){n.preventDefault();this.reportProblemClicked.invoke();l.invokeHandler(c.taskDataHandlerKey,{type:a.feedbackTask,activateOptions:{parentId:this._taskId},state:this._feedBackState})},e.prototype._validateItineraryItemDetails=function(n){return n&&n.details&&n.details.length>0&&n.details[0].startPathIndices&&n.details[0].startPathIndices.length>0&&n.details[n.details.length-1].endPathIndices&&n.details[n.details.length-1].endPathIndices.length>0},e.prototype._checkAndLogTimeAndDistance=function(n,t){var i,u,r;if(n){for(i={},n.travelDistance&&n.travelDistance!==undefined||(i.route="RD0"),n.travelDuration&&n.travelDuration!==undefined||(i.route="RT0"),u="legs",r=0;r<(n.routeLegs&&n.routeLegs.length);r++)n.routeLegs[r].travelDistance&&n.routeLegs[r].travelDistance!==undefined||(i[u]+=(i[u]?",":"")+"RLD"+r),n.routeLegs[r].travelDuration&&n.routeLegs[r].travelDuration!==undefined||(i[u]+=(i[u]?",":"")+"RLT"+r);Object.keys(i).length>0&&(i.traceId=t.traceId,w.logInstrumentationEvent(v.DBG,i))}},e.prototype._getCurrentRouteMode=function(n){var r=this._requestOptions.mode,f,u;if(i.bestModeEnabled&&n&&n.routeLegs&&n.routeLegs.length>0&&(f=n.routeLegs[0],f.itineraryItems&&f.itineraryItems.length>0&&(u=f.itineraryItems[0],u&&u.details&&u.details.length>0)))switch(u.details[0].mode){default:case"Driving":r=t.driving;break;case"Walking":r=t.walking;break;case"Transit":r=t.transit;break;case"Truck":r=t.truck}return r},e.prototype._setDirectionsResults=function(r,u,f,o){var yt,rt,ot,ut,b,k,c,y,h,d,ui,tt,p,wt,lt,si,l,bt,kt,dt,it,at;if(r===this._requestOptions){if(o||(yt=vt.logPerfEvent(et.PD,r.mode)),rt=u&&u.resourceSets[0],this.transitAttributions=[],rt&&rt.resources&&rt.resources.length){for(ot=0,ut=rt.resources,this._routeSets=ut,b=0;b<ut.length;b++){var s=ut[b],a=this._getCurrentRouteMode(s),g=e._directionsFormattedTextProviders[t[a]]();g.setRenderOptions(this._renderOptions);var ni=[],st=[],pt=[],ft=new ai(b,this._map,this.controlTemplateFactory),ti=[],ht=s.travelDuration,ii=[],ct=[],ri=s.entitiesAlongRoute;if((a===t.driving||a===t.truck)&&(ht=s.travelDurationTraffic),this._checkAndLogTimeAndDistance(s,u),ot=Math.max(ht,ot),s.routeLegs&&s.routeLegs.length){for(k=[],c=0;c<s.routeLegs.length;c++){y=[];h=s.routeLegs[c];h.routeSubLegs&&(k.length>0&&(k.pop(),ct.pop()),d=this._getRouteLegPoint(h),ui=this._getRouteLegIndices(d),k=k.concat(d),this.allStopPoints=this.allStopPoints.concat(d),ct=ct.concat(ui));var fi=0,nt=[],ei=ai.getViaIndexes(h),oi=0;if(h.itineraryItems&&h.itineraryItems.length){for(nt=this._createItineraryList(h),tt=0;tt<nt.length;tt++)nt[tt].instructionIndex=nt[tt].parentInstructionIndex=tt+1;for(p=this._directionsFormattedTextProvider.getStartInstruction(this._panelViewModel.waypoints[c],h,d,c===0,this._routeMapEntitiesCollection,s),y.push(p),this.disposables.push(p),pt.push(p),wt=0,lt=0,si=nt.length;lt<si;lt++)l=nt[lt],o||(bt=[],this._validateItineraryItemDetails(l)&&(bt=ai.getViasInSegment(ei,l.details[0].startPathIndices[0],l.details[l.details.length-1].endPathIndices[0])),(ei.indexOf(oi)!==-1||bt.length>0)&&fi++,this._validateItineraryItemDetails(l)&&(oi=l.details[l.details.length-1].endPathIndices[0])),kt=this._createInstructions(s,l,ft,d,c,fi,g),Array.prototype.push.apply(y,kt),kt.forEach(function(n){ii.push(n.stepText)}),wt=this._buildTransitTimeline(l,y,wt,ht,ti,a),this._buildTransitAttributions(l);dt=c===s.routeLegs.length-1;p=g.getEndInstruction(this._panelViewModel.waypoints[c+1],h,d,this._routeMapEntitiesCollection,dt,s);y.push(p);this.disposables.push(p);dt&&pt.push(p);Array.prototype.push.apply(st,y);var ci=y[0].stepText,li=this._panelViewModel.waypoints[c+1].getWaypointTitle(),vi=n.L_Directions_Leg_Title.replace("{from}",ci).replace("{to}",li),hi=g.getDurationString(h.travelDuration),gt=h.travelDistance?g.getFormattedDistanceText(h.travelDistance,s):"",yi=h.travelDistance?n.L_Directions_Leg_TimeDist_Text.replace("{time}",hi).replace("{distance}",gt):n.L_Directions_Leg_TimeOnly_Text.replace("{time}",hi),pi=new pf(this._renderOptions,y,vi,yi,c,s.routeLegs.length);ni.push(pi);gt&&gt!==undefined||w.logInstrumentationEvent(v.DBG,{distance:"undefined",traceId:u.traceId})}}st.length>0&&(this._fillMissingPushpins(st,a),it=new wf,it.routeLegs=ni,it.numberOfInstructions=st.length,it.routeId=s.id,it.stepStrings=ii,this.directionsResultsListSet.push(it),at=this._buildTitleViewModel(s,ti,ht,a,g),at.index=b,this.directionsResultsTitleSet.push(at),o||this._buildRouteLabel(s,at,ft,a));this._createRoutePolyline(s,ft,k,pt,o,a)}i.showTrafficCameras&&ri&&!o&&!this.isSDK&&ft.createTrafficPins(ri);this.routeStopPointPathIndices.push(ct.slice(0));this._routeMapEntitiesCollection.addRoute(ft,s,this._directionsFormattedTextProvider,a,b,ut.length>1)}o&&this._routeMapEntitiesCollection.show(f,!0,r.mode,!o)}o||(this.directionsResultsTitleSet.length>0&&(this._panelViewModel.updateModeBtnState(),this._updateWaypoints(k),this._setTransitLineWidth(ot),this._buildDisclaimer()),yt&&yt.end())}},e.prototype.onLegTitleClick=function(n){var r,u;n&&n.stopImmediatePropagation();n&&n.preventDefault&&n.preventDefault();var f=this.directionsResultsListSet[this._routeSelected],i=e.getAttributeFromHtmlElement(n.currentTarget,"data-index"),t=f.routeLegs[i],s=t.instructionSteps,o=!t.getShowInstructions();t.setShowInstructions(o);r=v.COL;o&&(this._map.setView(this._map.getMode().getMapViewForLocationsInView(t.legItemsLocations)),r=v.EXP);u={};u.CI=i===0?3:i===f.routeLegs.length-1?5:4;w.logInstrumentationEvent(r,u)},e.prototype.indexToIconTextStart=function(n){return String.fromCharCode(n+65)},e.prototype.indexToIconTextEnd=function(n){return String.fromCharCode(n+66)},e.prototype.indexToStartClass=function(n){var t=Math.max(0,this._routeSelected),i=this.directionsResultsListSet[t],r=i.routeLegs.length;return n===0?"dirLegStart verticalTop":n<r-1?"dirLegStop verticalTop":"dirLegStop verticalTop"},e.prototype.indexToEndClass=function(n){var t=Math.max(0,this._routeSelected),i=this.directionsResultsListSet[t],r=i.routeLegs.length;return n===0?"dirLegStop verticalBottom":n<r-1?"dirLegStop verticalBottom":"dirLegEnd verticalBottom"},e.prototype.showGroupToClass=function(n){return n?"upArrow":"downArrow"},e.prototype.arrayToDisplay=function(n){return this.boolToDisplay(n&&n.length>0)},e.prototype.lineColorToIconClass=function(n){var i="dirIcon",t=parseInt(n&&n.substr(1),16),r;return t&&t<=16777215&&(r=u._calcLuminance(t),i+=r>.65?" darkSymbol":" lightSymbol"),i},e.prototype._createInstructions=function(n,t,i,r,u,f,e){var s=this,h=e?e:this._directionsFormattedTextProvider,o;return h.setRenderOptions(this._renderOptions),o=h.getInstruction(t,n,this._routeMapEntitiesCollection),o.forEach(function(t){if(s.disposables.push(t),t.needPushpin){var e=t.itineraryItem&&t.itineraryItem.iconType||t.stepIconClass;i.addItineraryPin(e,t,u,f,s._getCurrentRouteMode(n),!t.getShow());r&&r.length>0&&r[0].itineraryItems&&r[0].itineraryItems.push(t.itineraryItem)}}),o},e.prototype._getRouteLegPoint=function(n){for(var r,t=[],i=0;i<n.routeSubLegs.length;i++)r=n.routeSubLegs[i],t.length==0&&t.push({routeLegStopPoint:r.startWaypoint,itineraryItems:[]}),t.push({routeLegStopPoint:r.endWaypoint,itineraryItems:[]});return t},e.prototype._getRouteLegIndices=function(n){for(var i,r=[],t=0;t<n.length;t++)i=n[t].routeLegStopPoint,i.isVia===!1&&r.push(i.routePathIndex);return r},e.prototype._buildTitleViewModel=function(n,r,f,e,o){var s=new bf(this),a=e?e:this._getCurrentRouteMode(n),h=o?o:this._directionsFormattedTextProvider,v,c,l;return h.setRenderOptions(this._renderOptions),(a!==t.transit||i.bestModeEnabled)&&(v=n.travelDuration,n.travelDurationTraffic&&(v=n.travelDurationTraffic),c=Math.round(v/60),l=Math.floor(c/60),s.minutes=l===0&&c===0?"1":u._format2Digit(l?"mm":"m","m",c%60),s.hours=l),a===t.driving&&i.displayTraffic&&s.setTrafficCondition(n.trafficCongestion),s.mainTitle=h.getTitle(n),s.subtitle=h.getSubtitle(n),s.descriptionVia=h.getDescriptionVia(n),s.descriptionTimeNoTraffic=h.getDescriptionTimeNoTraffic(n),s.startTime=h.getStartTime(n),s.embellishment=h.getRouteEmbellishments(n),this._updateTransitTimeInfo(n,a,s),i.displayCost&&(s.cost=h.getCost(n)),r.length>0&&(s.timelineSegments=r,s.timelineWidth=f),s},e.prototype._setTransitLineWidth=function(n){if((this._requestOptions.mode===t.transit||this._requestOptions.mode===t.multimode)&&n>0)for(var i=0;i<this.directionsResultsTitleSet.length;i++)this.directionsResultsTitleSet[i].timelineWidth/=n},e.prototype._getRealTimeTransitItem=function(n){var t,i,r,u;if(n&&n.routeLegs&&n.routeLegs.length>0&&(t=n.routeLegs[0],t.itineraryItems))for(i=0;i<t.itineraryItems.length;i++)if(t.itineraryItems[i].childItineraryItems)for(r=0;r<t.itineraryItems[i].childItineraryItems.length;r++)if(u=t.itineraryItems[i].childItineraryItems[r],u.isRealTimeTransit)return u;return null},e.prototype._updateTransitTimeInfo=function(i,r,f){var s,h,e,o;r===t.transit&&(s={},h=ot.getIconsInRouteLeg(i,r,s),f.frequency=s.transitFrequency,e=this._getRealTimeTransitItem(i),h&&h.length===1&&e&&e.isRealTimeTransit&&e.realTimeTransitDelay&&(o=Math.round(e.realTimeTransitDelay/60),o&&(f.isLate=o>0,f.embellishment=u._formatString(o<0?n.L_Transit_Early:n.L_Transit_Late,Math.abs(o)),f.isTransitEmbellishment=!0)))},e.prototype._updateWaypoints=function(n){for(var t,r,f,u=0,i=0;i<n.length;i++)(t=n[i].routeLegStopPoint,t.isVia)||(r=this._panelViewModel.waypoints[u],r.getInputText()===""&&(f=new b(t.coordinates[0],t.coordinates[1]),r.update(t.description,f)),this.stopPoints.push(t),u++)},e.prototype._fillMissingPushpins=function(n,i){var u,f,e,r;if(i===t.transit)for(u=null,f=0,e=n.length-1;f<e;f++)r=n[f],r.pushpin||r.stepIconClass!=="TransitArrive"?u&&r.pushpin&&(u.pushpin=r.pushpin,u=null):(u=r,r.pushpin=n[f+1].pushpin)},e.prototype._buildRouteLabel=function(n,r,u,f){if(i.enableRouteLabel){var e,o;f===t.transit?e=r.subtitle:(e=this._directionsFormattedTextProvider.getDescriptionTime(n),o=r.subtitle);u.setLabel(e,o)}},e.prototype._buildDisclaimer=function(){var r,u=g.dynamicProperties.market.toLowerCase()==="ja-jp",f,i;if(this._requestOptions.mode===t.transit){if(this.transitAttributions.sort(function(n,t){return n.agencyName<t.agencyName?-1:n.agencyName>t.agencyName?1:n.uri<t.uri?-1:n.uri>t.uri?1:0}),this.transitAttributions.length>0){for(f=this.transitAttributions[0],i=1;i<this.transitAttributions.length;i++)f.agencyName===this.transitAttributions[i].agencyName?(this.transitAttributions.splice(i,1),i--):f=this.transitAttributions[i];this.showAttribution=!0}r=u?n.L_TransitDisclaimer_Text_Japan:n.L_TransitDisclaimer_Text;this.setShowTransitLogo(u)}else r=u?n.L_DirectionsDisclaimer_Text_Japan:n.L_DirectionsDisclaimer_Text.replace("{0}",n.L_TermsOfUse_Text).replace(/{year}/,(new Date).getFullYear()),this.setShowTransitLogo(!1);this.setDisclaimerText(r)},e.prototype._buildTransitAttributions=function(n){var t=n.transitLine;t&&t.uri&&t.uri.indexOf(i.specialAttributionLink)>-1&&t.uri.indexOf("&")>-1&&(t.uri=t.uri.slice(0,t.uri.indexOf("&")));t&&this.transitAttributions.push(t)},e.prototype._buildTransitTimeline=function(n,i,r,u,f,e){var o,s;return e===t.transit&&u>0&&(o=i[i.length-1],r&&o.transitDepartTime&&(s=(o.transitDepartTime-r)/1e3,s>0&&f.push({width:s/u,className:"ttWait",lineColor:""})),f.push({width:n.travelDuration/u,className:"tt"+n.iconType,lineColor:o.transitLineColor}),o.transitArriveTime?r=o.transitArriveTime:r&&(r+=n.travelDuration*1e3)),r},e.prototype._createRoutePolyline=function(n,t,i,r,u,f){n.routePath&&n.routePath.line&&(this.routelines.push(n.routePath.line),t.createPolyLineAndStopPins(n,this._routeMapEntitiesCollection.getMapType(),f,i,r,u,this._renderOptions,n.routePath?n.routePath.annotations:null,this._routeDraggable))},e.prototype._createItineraryList=function(n){var u=[],i,f,t,r,e;if(n.itineraryGroups&&n.itineraryGroups.length){for(i=0,f=n.itineraryGroups.length;i<f;i++)if(t=n.itineraryGroups[i],t.itineraryIndices&&t.itineraryIndices.length>1)for(t.iconType=n.itineraryItems[t.itineraryIndices[0]].iconType,t.childItineraryItems=[],r=0;r<t.itineraryIndices.length;r++)e=t.itineraryIndices[r],t.childItineraryItems.push(n.itineraryItems[e]);else n.itineraryGroups[i]=n.itineraryItems[t.itineraryIndices[0]];u=n.itineraryGroups}else u=n.itineraryItems;return u},e._initProviders=function(){var n={};return n[t[t.driving]]=function(){return new ei},n[t[t.truck]]=function(){return new yi},n[t[t.transit]]=function(){return new br},n[t[t.walking]]=function(){return new yi},n[t[t.multimode]]=function(){return new ei},n},e.prototype.seeAllRoutesClick=function(){},e.prototype.onSeeAllRoutesReturnClick=function(){},e.prototype.boolToSeeAllRoutesClassName=function(){return"directionsPanel"},e.prototype.getRawResponse=function(){return this._rawResponse},e.prototype._setRenderOptions=function(n){this._renderOptions=n;n&&n.displayDisclaimer!==undefined&&this.setShowDisclaimer(n.displayDisclaimer)},e.prototype.waitingOnRoadShieldEvent=function(){return this._directionsFormattedTextProvider.unloadedRoadShields>0},e.prototype._onRoadShieldReadyEvent=function(){s(".svg",this.getControl()[0]).inlineDataSvgs().remove_class("svg")},e._directionsFormattedTextProviders=e._initProviders(),e}(ut),kr=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return p(t,n),t.prototype.seeAllRoutesClick=function(){this.setShowSeeAllRoutes(!0)},t.prototype.onSeeAllRoutesReturnClick=function(n){n.preventDefault();this.setShowSeeAllRoutes(!1);this.seeAllRoutesReturnClick.invoke()},t.prototype.boolToSeeAllRoutesClassName=function(){return this.getShowSeeAllRoutes()?"seeAllRoutes":""},t}(pi),wi=function(){function n(n){var t=this;this._map=n;this._bucketPrimitiveTemplateSelector=new ku(n);this._disposables=[];this._disposables.push(n.mapTypeChanged.add(function(n){n.newMapTypeId!==n.oldMapTypeId&&(t._reset=!0)}))}return n.prototype.selectorReady=function(){var n=this;return!this._baseMapTemplateSelector||this._reset?this._map.getTemplateSelector().then(function(t){return n._directionsImagesPromise||(n._directionsImagesPromise=t.prefetchImages(n._getDirectionsBucketIds(),null,!0)),n._directionsImagesPromise.then(function(){return n._baseMapTemplateSelector=t,n._reset=!1,n._baseMapTemplateSelector.selectorReady()})}):this._baseMapTemplateSelector.selectorReady()&&this._bucketPrimitiveTemplateSelector.selectorReady()},n.prototype.getTemplates=function(n,t){var i,r,u,f;return n instanceof lu?(r=n,i=[new tu(r.image,1,r.anchor)]):n instanceof ki?(u=n,i=u.getTemplates()):n instanceof ti?i=this._getRoutePinTemplates(n):n instanceof ui?(f=tt.getMercatorZoomLevel(this._map),i=n.viewState===3?null:this._bucketPrimitiveTemplateSelector.getTemplates(n,t,9)):n.getTemplates?i=n.getTemplates():n.getTemplate&&(i=[n.getTemplate()]),i},n.prototype.dispose=function(){this._map=null;this._baseMapTemplateSelector=null;this._directionsImagesPromise=null;u._clearDisposables(this._disposables)},n.prototype._getDirectionsBucketIds=function(){var t=[],n=kt.directionIconTypeBuckets;for(var i in n)n.hasOwnProperty(i)&&t.push(n[i]);return t},n.prototype._getRoutePinTemplates=function(t){var i=t.pushpinIconType,f=t.isRouteSelected,r=t.isPinHighlighted,u;return t.isRouteSelected?t.taskState!==1&&!n.majorPinTypes[h[i]]?null:(u=t.taskState===3?r?3:5:r?3:2,n.majorPinTypes[h[i]]||(i=h.turn),this._baseMapTemplateSelector&&this._baseMapTemplateSelector.getRoutePoiVectorImageTemplate(h[i],u,t.currentZoomLevel)):null},n.majorPinTypes={start:!0,end:!0,middle:!0,infopin:!0,via:!0},n}(),cf=function(){function n(n,t){this._primitives=t;this._map=n}return n.prototype.getPrimitives=function(n,t){var r=[],u,i,f,e;if(this._primitives&&this._primitives.length)for(u=0;u<this._primitives.length;u++)i=this._primitives[u],i instanceof er||i instanceof oi?(f=i,f.isRouteSelected()&&r.push(i)):i instanceof ti||i instanceof wt?(e=i,e.isRouteSelected&&r.push(i)):r.push(i);t&&t({primitives:r})},n}(),bi=bi||e.TransitLandmarkOverlayTemplate,lf=lf||e.CameraMiniOverlayTemplate,of,ot=function(e){function y(n,t,r,u,f,s){var h=e.call(this,s)||this;return h._minZoomToShowStreetside=16,h._currentPrimitiveMovedArg=null,h._zoomLevelBestMapView=0,vt.setClientPerf(s),h._listeners=[],h._map=t,h._activationState=null,h._categoriesBar=null,h._reverseGeocoder=u,f&&!i.isSDK&&f.instanceAsync("TrafficLayerV2",function(n){h._trafficLayer=n}),h.displayState={colorIndex:0,groupName:"Directions"},h.invalidated=new o,h.type=a.directionsTask,h._controlTemplateFactory=n,h.inputData=new yt,h.showCloseButton=!0,h._geolocationProvider=r,h._primitives=[],h._dragonflyContainer=f,h._keyRoutePoints=[],h._isDistanceIntentMapViewSet=!1,i.enableHightlightInstruction&&(h.scrollLane=new o),h.directionsManagerCallback=new o,h.panelRoot[0].id="directionsPanelRoot",eu.addDataTag(h.panelRoot,"directionsPanelRoot"),h}return p(y,e),y.prototype.activate=function(t,r){var f=this,y,a,u,h,p,s,o,b;for(e.prototype.activate.call(this,t,r),this._map=t,y=!1,a=!1,this.setTitle(n.L_DirectionsTaskTitle_Text),u=r,this._taskState=u,h=u&&u.waypoints&&u.waypoints.length===1&&u.waypoints[0],p=h&&(h.waypointType===3||h.waypointType===null)&&this._hasRoute(),this.inputData=yt.inputDataFromDirectionState(u,this.inputData,!p),u&&u.waypoints&&(p&&this._optimizedAddWaypoint(h),a=this._taskState&&this._taskState.longDistanceDisplay&&this._taskState.waypoints&&this._taskState.waypoints.length>1&&this._taskState.waypoints[0].point&&this._taskState.waypoints[1].point?!0:!1,y=a?!1:!0),this.clearExistingRoutes(),this.disposables.push(this._directionsPanelViewModel=this._createDirectionsPanelViewModel()),this.disposables.push(this._directionsPanelViewModel.getDirectionsRequested.add(function(){u&&u.taskStartTime?(f._directionsRequestStartTime=u.taskStartTime.getTime(),u.taskStartTime=null):f._directionsRequestStartTime=Date.now()})),this.disposables.push(this._directionsPanelViewModel.waypointResolvedEvent.add(function(n){f._waypointResolved(n)})),this._directionsPanelViewModel.initializeControls(this._dragonflyContainer),this.disposables.push(this._directionsPanelViewModel.directionsResultsRequested.add(function(n){var t=!0;f._renderOptions&&typeof f._renderOptions.autoUpdateMapView=="boolean"?t=f._renderOptions.autoUpdateMapView:u&&u.renderOptions&&typeof u.renderOptions.autoUpdateMapView=="boolean"&&(t=u.renderOptions.autoUpdateMapView);f._onDirectionsResultsRequested(n.DirectionsInputData,t,!1,null,null,null,n.viaPointRemoved,n.routeIndex,n.routeId||u&&u.routeId)})),this.disposables.push(this._directionsPanelViewModel.directionsModeChanged.add(function(){if(f.changed.invoke({name:"iconClass"}),f._flipTaskId){var n={action:"remove",id:f._flipTaskId};l.invokeHandler(c.taskDataHandlerKey,n)}})),this.addControl(this._directionsPanelViewModel.getControl()),a||this._initAutosuggest(),y&&this._directionsPanelViewModel.getDirections(!0,u.routeIndex,u.routeId),s=0;s<this._directionsPanelViewModel.waypoints.length;s++)o=this._directionsPanelViewModel.waypoints[s].getWayPointModel(),!o.address&&!o.name&&o.point&&this._reverseGeocoder&&(b="{0}, {1}".replace("{0}",(Math.round(o.point.latitude*1e6)/1e6).toString()).replace("{1}",(Math.round(o.point.longitude*1e6)/1e6).toString()),this._directionsPanelViewModel.waypoints[s].update(b,o.point),this._submitGeoCodeRequest(o.point,s));this.disposables.push(this._directionsPanelViewModel.clearDirectionsResults.add(function(){f.clearExistingRoutes();f._updateKeyRoutePoints()}));this.disposables.push(this._directionsPanelViewModel.taskTitleRequestedEvent.add(function(n){f.setTitle(n)}));this.disposables.push(this._map.viewChanged.add(function(n){return f._onViewChanged(n)}));this.disposables.push(this._map.mapTypeChanged.add(function(n){return f._onMapTypeChanged(n)}));u&&u.entryPoint&&(this._activatedFromPermaLink=u.entryPoint===4||u.entryPoint===5,w.logInstrumentationEvent(v.A,{EP:u.entryPoint}));this._activatedFromHistoryManager=u&&u.preventHistoryPoint;i.enableDistanceQuery&&this._showIfLongDistanceIntent()},y.prototype.calculateDirections=function(n){this._map&&(this._taskState=n,this.inputData=yt.inputDataFromDirectionState(n,this.inputData),i.isSDK&&n&&n.renderOptions&&(this._renderOptions=n.renderOptions),this.clearExistingRoutes(),this._directionsPanelViewModel&&(this._directionsPanelViewModel.updateInputControlsFromState(this._taskState),this._directionsPanelViewModel.resolveWaypointsInRoutingService=this._taskState.resolveWaypointsInRoutingService),this._taskState&&this._taskState.waypoints&&this._taskState.waypoints.length>1&&this._directionsPanelViewModel.getDirections())},y.prototype.deactivate=function(){this._notifyListenersBeforeDeactivation();e.prototype.deactivate.call(this);this.clearExistingRoutes();this._layer&&(this._map.getLayers().remove(this._layer),this._layer.dispose(),this._layer=null);this._resultsViewModel&&(this._resultsViewModel.clearRoutesLabels(),this._resultsViewModel.discarded=!0,this._resultsViewModel.dispose());this._removeCategoriesBar();u._clearDisposables([this.templateSelector]);this.templateSelector=null;this._directionsPanelViewModel&&this._directionsPanelViewModel.dispose();u._clearDisposables(this._primitives);u._disposeEvents(this)},y.prototype.dispose=function(){this.deactivate();e.prototype.dispose.call(this)},y.prototype.serialize=function(n){var t=yt.inputDataToDirectionsState(this.inputData,n),i;return t.taskTitle=this.getTitle(),n||(t.preventHistoryPoint=!0),this._resultsViewModel&&(i=this._resultsViewModel.getRouteSelected(),i>=0&&(t.routeIndex=i)),this._taskState&&this._taskState.longDistanceDisplay&&(t.longDistanceDisplay=this._taskState.longDistanceDisplay),t},y.prototype.process=function(t,i){var r=t.requestState,c,l,w,a,b,v,k;if(this._canProcess(r)){var d=this._directionsPanelViewModel.getMode(),g=this.displayState.activationState,f=null;if(r.action===0){var e=this._directionsPanelViewModel.getRouteTitle(),u=this._directionsPanelViewModel.waypoints,s=u.length>=2&&!u[0].isEmpty()&&!u[u.length-1].isEmpty();if(s){for(var nt=e,o=0,h="",y=0,p=0;o<u.length;)c=u[o].getWaypointTitle(),c!==""&&(y++,h===""&&(h=c,p=o)),o++;y!==u.length&&(e=(p===0?n.L_Directions_Add_From:n.L_Directions_Add_To).replace("{0}",h));e===nt&&(s=!1)}f={mode:d,activationState:g,routeTitle:e,isIncomplete:s,pendingRemoval:this.displayState.pendingRemoval};this._directionsPanelViewModel&&this._directionsPanelViewModel.isLongDistanceIntent&&(f.longDistanceIntent=!0)}else r.action===1?f={TraceId:this._getTraceId()}:r.action===2?r.listenerId&&(this._listeners.push(r.listenerId),this._hasRoute()&&(this._listeners.length==1?(this._setMapViewIfPrimitivesOutOfBound(this._primitives,!0),this._updateKeyRoutePoints()):this._sendNotificationMessage(this._keyRoutePoints,[r.listenerId]))):r.action===3?r.listenerId&&(l=this._listeners.indexOf(r.listenerId),l!=-1&&this._listeners.splice(l,1)):r.action===4?(w={prominence:2},this.setDisplayState(w)):r.action===5&&this._selectedTrafficPin?(this._flipTaskId=t.requestorId,this._resultsViewModel&&this._resultsViewModel.taskStateChanged(1),this._selectedTrafficPin.updatePinIcon(!0),a=tt.getMapBounds(this._map,!0),b=this._selectedTrafficPin.getLocation(),a.contains(b)||(v=this._mapBoundsBeforeFlipTask.center,k=this._mapBoundsBeforeFlipTask.bounds[3]-a.bounds[3],v.longitude+=k/2,tt.setMapCenter(this._map,v)),this._invalidateMap(),this._activationState=1):r.action===6&&(this._selectedTrafficPin&&this._selectedTrafficPin.updatePinIcon(!1),this._selectedTrafficPin=null,this._flipTaskId=null,this._invalidateMap());i&&i({processorId:this.id,data:f})}else i&&i({processorId:this.id,data:null})},y.prototype.processCallback=function(n){var u,r,t,f,i,e,o;if(n)if(n.processorType===a.localDetailsTask||n.processorType===a.polygonEntityDetailsTask){if(n.outData){for(t=n.outData,n.processorType===a.localDetailsTask?y.localDetailCardsData=t:y.polygonEntityDetailCardsData=t,u=[],i=0;i<t.length;i++)r=t[i].data,r&&r.length&&u.push(r[0]);this._directionsPanelViewModel.updateCurrentLocalDetailCards(u)}}else if(n.processorType===a.transitStopTask){if(n.outData){for(t=n.outData,y.transitStopCardsData=t,f=[],i=0;i<t.length;i++)e=t[i].data,e&&f.push(e);this._directionsPanelViewModel.updateCurrentTransitStopCards(f)}}else n.inData&&n.inData.requestState&&n.inData.requestorState&&n.inData.requestorState.callbackState&&this._directionsPanelViewModel&&(o=n.inData.requestState,o.entryPoint===ni.DirectionsWaypointSearch&&this._directionsPanelViewModel.waypointResolved(n))},y.prototype.setDisplayState=function(n){var i=this,r,u,t,f,s,h;if(this._isRouteBeingCalculated&&!(this._directionsPanelViewModel&&this._directionsPanelViewModel.isLongDistanceIntent)){r={activationState:n.activationState,prominence:n.prominence,animationState:n.animationState};this._delaySetDisplay||(this._delaySetDisplay=new o);this.disposables.push(this._delaySetDisplay.addOne(function(){i.setDisplayState(r);i._delaySetDisplay=null}));return}u=this._activationState;e.prototype.setDisplayState.call(this,n);n.activationState&&(this._activationState=n.activationState);n.activationState===1&&n.prominence===1?(this._primitives&&this._primitives.length>0&&(this._setMapViewIfPrimitivesOutOfBound(this._primitives),this._resultsViewModel&&this._resultsViewModel.taskStateChanged(1),this._invalidateMap()),this._directionsPanelViewModel.resetLocalDetailsCards(),t={searchEntitiesRequested:!0},f={requestorType:"DirectionsTask",requestorId:this.id,type:a.localDetailsTask,requestState:t,useActiveTasks:!0},l.invokeHandler(c.taskProcessDataHandlerKey,f),s={requestorType:"DirectionsTask",requestorId:this.id,type:a.polygonEntityDetailsTask,requestState:t,useActiveTasks:!0},l.invokeHandler(c.taskProcessDataHandlerKey,s),h={requestorType:"DirectionsTask",requestorId:this.id,type:a.transitStopTask,requestState:{searchEntitiesRequested:!0},useActiveTasks:!0},l.invokeHandler(c.taskProcessDataHandlerKey,h)):n.prominence&&this._primitives&&this._primitives.length>0?(n.prominence===1?this._resultsViewModel&&this._resultsViewModel.taskStateChanged(2):this._resultsViewModel&&this._resultsViewModel.taskStateChanged(3),this._invalidateMap()):n.activationState===2&&n.activationState!==u&&(this._resultsViewModel&&this._resultsViewModel.taskStateChanged(2),this._invalidateMap());this._directionsPanelViewModel.onTaskStateChanged(n)},y.prototype.getPrimitives=function(n,t){var i=[];this._primitives&&this._primitives.length&&i.push.apply(i,this._primitives);t&&t({primitives:i})},y.prototype.getAllStopPoints=function(){return this._resultsViewModel.allStopPoints},y.prototype.getMapLayer=function(){return this._layer},y.prototype.setMapLayer=function(n){this._layer=n},y.prototype.getCardIconInfo=function(){var i=this._directionsPanelViewModel.getMode(),n;switch(i){case t.driving:n="dirTsk";break;case t.transit:n="trnsTsk";break;case t.walking:n="wlkTsk";break;case t.multimode:n="dirTsk";break;default:n="dirTsk"}return{iconClass:n}},y.prototype.getPrintInstrumentationData=function(){return{RI:this._resultsViewModel?this._resultsViewModel.getRouteSelected():-1,LOC:"H"}},y.prototype.hasPrintContent=function(){return st.isEnabled&&this._hasRoute()&&!(this._directionsPanelViewModel&&this._directionsPanelViewModel.isLongDistanceIntent)},y.prototype.getPrintContent=function(){var n,t,i,r;return st.isEnabled?(n=null,this._resultsViewModel&&(this._updatePrintImages(),n=this._resultsViewModel.getDirectionsHtmlContentForPrint()),t=new li,this._layer&&(i=new or(this._layer.getId(),new cf(this._map,this._primitives),this._layer.getTemplateSelector(),this._layer.getZIndex()),i.setRenderTarget(this._layer.getRenderTarget()),t.insert(i)),r=new hu(n,null,t),r.setCssScope(this.type),n!==null?r:null):null},y.prototype._getGeodesicPath=function(n,t){var h,c,i,r,u,s;for((!t||t<=0)&&(t=15),h=n.length,c=[],h>0&&(i=at.degreesToRadians(n[0].latitude),r=at.degreesToRadians(n[0].longitude)),u=1;u<h;u++){var f=at.degreesToRadians(n[u].latitude),e=at.degreesToRadians(n[u].longitude),d=Math.sin(i),g=Math.sin(f),nt=Math.sin(r),tt=Math.sin(e),l=Math.cos(i),a=Math.cos(f),it=Math.cos(r),rt=Math.cos(e),o=2*Math.asin(Math.sqrt(Math.pow(Math.sin((i-f)/2),2)+l*a*Math.pow(Math.sin((r-e)/2),2)));for(s=0;s<=t;s++){var p=s/t,v=Math.sin((1-p)*o)/Math.sin(o),y=Math.sin(p*o)/Math.sin(o),w=v*l*it+y*a*rt,k=v*l*nt+y*a*tt,ut=v*d+y*g,ft=Math.atan2(ut,Math.sqrt(Math.pow(w,2)+Math.pow(k,2))),et=Math.atan2(k,w);c.push(new b(at.radiansToDegrees(ft),at.radiansToDegrees(et)))}i=f;r=e}return c},y.prototype._showIfLongDistanceIntent=function(){var r,i,t;this._layer&&this._taskState&&this._taskState.longDistanceDisplay&&this._taskState.waypoints&&this._taskState.waypoints.length>1&&this._taskState.waypoints[0].point&&this._taskState.waypoints[1].point&&this._directionsPanelViewModel&&(r=this._getGeodesicPath([this._taskState.waypoints[0].point,this._taskState.waypoints[1].point],32),r&&(i=new Microsoft.Maps.Polyline(r,{strokeColor:"rgb(0, 0, 0)"}),this._primitives&&i&&(i._options&&(i._options.cursor=""),this.setTitle(n.L_DirectionsTaskDistanceTitle_Text),this._primitives.push(i),this._directionsPanelViewModel.isLongDistanceIntent=!0,this._directionsPanelViewModel.setLongDistanceText(this._taskState.longDistanceDisplay),this._directionsPanelViewModel.setShowWaypoints(!1),this._directionsPanelViewModel.setShowSuggestionsPanel(!1),this._directionsPanelViewModel.hideMessage(),this._taskState.waypoints[0].address&&this._taskState.waypoints[0].eid&&this._taskState.waypoints[1].address&&this._taskState.waypoints[1].eid&&(t={},t.query=this._taskState.waypoints[0].address,t.id=this._taskState.waypoints[0].eid,this._directionsPanelViewModel.setTaskOptionFrom(JSON.stringify({type:a.localSearchTask,requestState:t})),t.query=this._taskState.waypoints[1].address,t.id=this._taskState.waypoints[1].eid,this._directionsPanelViewModel.setTaskOptionTo(JSON.stringify({type:a.localSearchTask,requestState:t})),this._directionsPanelViewModel.setLongDistanceFrom(this._taskState.waypoints[0].address),this._directionsPanelViewModel.setLongDistanceSeparator(" → "),this._directionsPanelViewModel.setLongDistanceTo(this._taskState.waypoints[1].address)),this._taskState.options?this._taskState.options.routeDraggable=!1:this._taskState.options={routeDraggable:!1})))},y.prototype._optimizedAddWaypoint=function(n){for(var i,p,s,t,l,h,c,r,d=n.waypointType,a=it.createObjectFrom(n),v=Number.MAX_VALUE,y=this.inputData.waypoints.length,w=tt.getMapBounds(this.map,!0),u,e,k,f,o=0;o<this._resultsViewModel.routelines.length;o++){for(u=this._resultsViewModel.routeStopPointPathIndices[o],e=this._resultsViewModel.routelines[o].coordinates,k=this._resultsViewModel.directionsResultsListSet[o],f=[],t=0;t<e.length;t++)i=e[t],w.containsLatLong(i[0],i[1])&&f.push({location:new b(i[0],i[1]),index:t});if(!f.length)for(t=0;t<e.length;t++)i=e[t],p=new b(i[0],i[1]),f.push({location:p,index:t});for(s=-1,t=0;t<f.length;t++)(l=f[t],h=u.indexOf(l.index),h>0&&h<u.length-1)||(c=tr.greatCircleDistance(a.point,l.location),(h===0||h===u.length-1)&&(c=c*.9),c<v&&(v=c,s=l.index));if(s>=0)for(r=0;r<this._resultsViewModel.stopPoints.length;r++)if(u[r]>=s){y=r===this._resultsViewModel.stopPoints.length-1&&u[r]===s?r+1:r;break}}this.inputData.tryAddWaypoint(a,y)},y.prototype._processCategorySelection=function(n,t){var i={};i.taskTitle=n.displayName;i.query=n.displayName;i.category=n.category;i.directionsTaskId=t;i.entryPoint=ni.CategoriesBar;i.selectedCategoryId=n.categoryId;i.disableComputingMapViewForLoadingOnly=!0;this._updateKeyRoutePoints(!0);i.keyRoutePoints=this._keyRoutePoints;l.invokeHandler(c.taskDataHandlerKey,{state:i,type:a.localListingTask})},y.prototype._updateCategoriesBarVisibility=function(){var i=this,n=y._getSupportedCategoriesBarCreator(),t;n!=null&&(n.shouldCategoriesBarBeVisible(this)&&!this._categoriesBar&&(this._categoriesBar=n.createCategoriesBar(this),this._categoriesBar.setIsVisible(!1),this._categoriesBar.categorySelected.add(function(n){i._processCategorySelection(n,i.id)})),this._categoriesBar&&(t=n.shouldCategoriesBarBeVisible(this),this._categoriesBar.setIsVisible(t),this._categoriesBar.getControl().getParent()&&this._categoriesBar.getControl().getParent().has_class(y.RouteCategoriesBarPanelCssClass)?(this._categoriesBarContainer=this._categoriesBar.getControl().getParent(),this._directionsPanelViewModel.setShowRouteCategoriesPanel(this._categoriesBar.getIsVisible())):t&&this._categoriesBarContainer&&this._categoriesBarContainer.length>0&&!this._categoriesBarContainer[0].hasChildNodes()&&(this._categoriesBarContainer.append(this._categoriesBar.getControl()),this._directionsPanelViewModel.setShowRouteCategoriesPanel(this._categoriesBar.getIsVisible())),this.id&&this._fireCardRefreshEvent()))},y.convertIntervalToTransitFrequency=function(t){var i=null,r;return t&&(r=t<60?1:t/60,i=n.L_Transit_Frequency_Text.replace("{0}",Math.round(r))),i},y.getIconsInRouteLeg=function(n,i,r){var u=[],o,f,s,e;if(i===t.multimode,i===t.transit){if(n.routeLegs&&n.routeLegs.length>0)for(o=0;o<n.routeLegs.length;o++)if(f=n.routeLegs[o],f.itineraryItems&&f.itineraryItems.length>0)for(s=0;s<f.itineraryItems.length;s++)e=f.itineraryItems[s],(e.iconType==="Bus"||e.iconType==="Train"||e.iconType==="Ferry")&&u.push(e.iconType.toLowerCase());u.length===1&&n.routeLegs.length>0&&n.routeLegs[0].transitFrequencies&&n.routeLegs[0].transitFrequencies.length>0&&(r.transitFrequency=y.convertIntervalToTransitFrequency(f.transitFrequencies[0].intervalBetweenDepartures));u.length===0&&u.push("walk")}else i===t.driving?u.push("car"):i===t.walking&&u.push("walk");return u},y._getSupportedCategoriesBarCreator=function(){for(var f={isSupported:function(){return i.enableRouteCategoriesBar&&!i.isSDK},createCategoriesBar:function(n){var r=fi,t,u;return i.enableFastFoodIcon&&(r=of),t=new uu(n._map,r,n._controlTemplateFactory,!1),u=n._directionsPanelViewModel.getControl().select("div."+y.RouteCategoriesBarPanelCssClass),u.append(t.getControl()),t},shouldCategoriesBarBeVisible:function(n){return n._hasRoute()&&n._directionsPanelViewModel.getMode()!==t.transit}},u=[f],r,n=0;n<u.length;n++)if(r=u[n],r.isSupported())return r;return null},y.prototype._removeCategoriesBar=function(){this._categoriesBar&&(this._directionsPanelViewModel.setShowRouteCategoriesPanel(!1),this._categoriesBar.getControl().removeFromParent(),this._categoriesBar.deactivate(),this._categoriesBar=null,this._fireCardRefreshEvent())},y.prototype._fireCardRefreshEvent=function(){sj_evt&&sj_evt.fire("OnCardRefresh",s(document).select("[data-subtaskid='"+this.id+"']"),this.stackId)},y.prototype._canProcess=function(n){return this._directionsPanelViewModel?!n||n.action==null?!1:n.taskId!=null&&n.taskId!=this.id?!1:!0:!1},y.prototype.hasDefaultFocusElement=function(){return!0},y.prototype._calculateKeyRoutePoints=function(){var i=[],r,t,f,e;if(!this._hasRoute())return i;var o=tt.getMapBounds(this.map,!0),u=this._resultsViewModel.routelines[this._resultsViewModel.getRouteSelected()].coordinates,n=[];for(r=0;r<u.length;r++)t=u[r],o.containsLatLong(t[0],t[1])&&n.push(new b(t[0],t[1]));return n.length>y.KeyPointsCount?(f=this._calculateRouteLength(n),e=f/y.KeySegmentCount,i=this._filterRoutePoints(n,e)):i=n,i},y.prototype._calculateRouteLength=function(n){for(var i=0,t=0;t<n.length-1;t++)i+=tr.greatCircleDistance(n[t],n[t+1]);return i},y.prototype._filterRoutePoints=function(n,t){var u,e,f,i;if(n.length<2)return[];for(u=[],u.push(n[0]),e=n[0],f=0,i=1;i<n.length-1;i++)f+=r.MapMath.greatCircleDistance(n[i-1],n[i]),f>t&&(u.push(n[i]),e=n[i],f=0);return u.push(n[n.length-1]),u},y.prototype._initAutosuggest=function(){this._directionsPanelViewModel.initAutosuggest()},y.prototype._onPrimitiveMoveStarted=function(n){if(this._currentPrimitiveMovedArg=null,this._isDragging=!0,this._processDragRequest(n),this._updateDragPin(!1,null,!1,!1,!1),this.displayState.activationState!==1&&!i.isSDK){var t={action:"focus",id:this.id};l.invokeHandler(c.taskDataHandlerKey,t)}},y.prototype._updateDragPin=function(n,t,i,r,u){var f=this._primitives.length;f>0&&(n?pt.showDragTipPin(this._map,this._controlTemplateFactory,t,i,r,u):pt.hideDragTipPin(this._map))},y.prototype._onPrimitiveMoveContinued=function(n){if(this._isDragging){var t=n.location;this._updateDragPin(!0,t,!1,!1,!0);this._currentPrimitiveMovedArg=n}},y.prototype._processDragRequest=function(n){var i=n.location,t,u,f,e,r;y.isIDirectionsPushpin(n.primitive)?(t=n.primitive,t.pushpinIconType===h.start||t.pushpinIconType===h.end||t.pushpinIconType===h.middle?(t=n.primitive,this.inputData.waypoints[t.stopPointIndex].point=i,this.inputData.waypoints[t.stopPointIndex].locationIdentifier=null,this._onDirectionsResultsRequested(this.inputData,!1,!0)):t.pushpinIconType===h.via?(u=t.stopPointIndex,f=t.viaPointIndex,this.inputData.waypoints[u].viaWaypoints[f].point=i,this.inputData.waypoints[u].viaWaypoints[f].locationIdentifier=null,this._onDirectionsResultsRequested(this.inputData,!1,!0)):(r=new it(null,i,null,!0),this._onDirectionsResultsRequested(this.inputData,!1,!0,r,t.stopPointIndex,t.viaPointIndex))):(e=n.primitive,r=new it(null,i,null,!0),this._onDirectionsResultsRequested(this.inputData,!1,!0,r,e.legIndex,e.subLegIndex))},y.prototype._onPrimitiveMoveStopped=function(n){var a=this,i,t,o,s,c,l,f,r;if(this.primitiveInteracted.invoke(),this._currentPrimitiveMovedArg=null,this._isDragging=!1,this._updateDragPin(!1,null,!1,!1,!1),i=n.location,y.isIDirectionsPolyline(n.primitive)){var e=n.primitive,f=new it(null,i,null,!0),r=this.inputData.waypoints[e.legIndex].viaWaypoints;e.subLegIndex>=r.length?r.push(f):r.splice(e.subLegIndex,0,f)}else t=n.primitive,t.pushpinIconType===h.start||t.pushpinIconType===h.end||t.pushpinIconType===h.middle?(o=this.inputData.waypoints[t.stopPointIndex],s=u._formatLatLonString(i.latitude,i.longitude),this._directionsPanelViewModel.waypoints[t.stopPointIndex].setInputText(s),this._reverseGeocoder&&this._reverseGeocoder.reverseGeocode(i,function(n){return a._processGeocodeResponse(n,t.stopPointIndex)}),o.point=i):t.pushpinIconType===h.via?(c=t.stopPointIndex,l=t.viaPointIndex,this.inputData.waypoints[c].viaWaypoints[l].point=i):(f=new it(null,i,null,!0),r=this.inputData.waypoints[t.stopPointIndex].viaWaypoints,t.viaPointIndex>=r.length?r.push(f):r.splice(t.viaPointIndex,0,f));this._onDirectionsResultsRequested(this.inputData,!1)},y.prototype._onPrimitiveHover=function(r,u){var s=this,f,e,h,o;if(y.isIDirectionsPushpin(r.primitive))f=r.primitive,f.instructionViewModel&&f.instructionViewModel.transitStopID&&f.instructionViewModel.transitStopID>0?f.instructionViewModel.transitStaticResources?(u&&this.showOverlay(bi,f.instructionViewModel.transitStaticResources,f),u||ri.hideOverlay(this._map,f)):(f.instructionViewModel.transitStopInfoReadyPromise||(f.instructionViewModel.transitStopInfoReadyPromise=new Promise(function(n){f.instructionViewModel.processTransitStopInfo(f.instructionViewModel.transitStopID,n)})),f.instructionViewModel.transitStopInfoReadyPromise.then(function(){return new Promise(function(){u&&s.showOverlay(bi,f.instructionViewModel.transitStaticResources,f);u||ri.hideOverlay(s._map,f)})})):(e=u&&f.isMoveEnabled()&&this._isDraggable(),this._isMajorPoint(f)||(h=f.stopPointIndex,o=this.inputData.waypoints[h].viaWaypoints.length,e=e&&o<y.showDragMax),this._updateDragPin(u,r.location,e,lt&&lt.isEnabled&&lt.streetsideInDirectionsFeatureEnabled&&!i.isSDK,!1)),f.instructionViewModel&&f.instructionViewModel.setHover(u),pt.highlight(u?f:null);else if(y.isIDirectionsPolyline(r.primitive)){var c=r.primitive.legIndex,o=this.inputData.waypoints[c].viaWaypoints.length,l=u&&this.inputData.mode!=t.transit&&this._isDraggable()&&o<y.showDragMax;this._updateDragPin(l,r.location,u,!1,!0);this._isHovering=u}else r.primitive instanceof ui&&(u&&this.showOverlay(gu,{tooltip:n.Directions_Camera_Tip},r.primitive),u||ri.hideOverlay(this._map,r.primitive))},y.prototype._onPointerMoved=function(n){if(this._isHovering&&n.primitive&&y.isIDirectionsPolyline(n.primitive)){var i=n.primitive.legIndex,r=this.inputData.waypoints[i].viaWaypoints.length,u=this.inputData.mode!=t.transit&&this._isDraggable()&&r<y.showDragMax;this._updateDragPin(u,n.location,!0,!1,!0)}},y.prototype.showOverlay=function(n,t,i){var r={overlayTemplate:new hi(n,t),overlayAnchor:new bt(-10,-10)};ri.showOverlay(this._map,r,i)},y.prototype._onPrimitiveTapped=function(n){var t,s,h,r,u,p,f,b;if(this.primitiveInteracted.invoke(),t=y.isIDirectionsPushpin(n.primitive)&&n.primitive,!t||!i.isSDK){if(s=t&&t.instructionViewModel&&t.instructionViewModel.transitStopID&&t.instructionViewModel.transitStopID>0,s){t.instructionViewModel.showTransitStop();w.logInstrumentationEvent(v.RPPC,{});return}if(n.primitive instanceof ui&&this._selectedTrafficPin!==n.primitive){this._selectedTrafficPin&&this._selectedTrafficPin.updatePinIcon(!1);this._selectedTrafficPin=n.primitive;this._mapBoundsBeforeFlipTask=tt.getMapBounds(this._map,!0);this._flipTaskId?(h={requestorType:"DirectionsTask",requestorId:this.id,type:a.directionsFlipTask,requestState:{incident:n.primitive.incident},taskId:this._flipTaskId,useActiveTasks:!!this._flipTaskId},l.invokeHandler(c.taskProcessDataHandlerKey,h)):(r={},r.activateOptions={parentId:this.id},r.type=a.directionsFlipTask,u={},u.incident=n.primitive.incident,u.parentId=this.id,r.state=u,l.invokeHandler(c.taskDataHandlerKey,r));w.logInstrumentationEvent(v.CAMCLK,{});return}if(this.displayState.activationState===1||i.isSDK||(p={action:"focus",id:this.id},l.invokeHandler(c.taskDataHandlerKey,p)),this._hasRoute())if(t&&lt&&lt.isEnabled&&lt.streetsideInDirectionsFeatureEnabled)this._showStreetsideBubble(t),w.logInstrumentationEvent(v.RPPC,{});else if(y.isIDirectionsPolyline(n.primitive)){var k=n.primitive,e=k.getIndex(),o=this._resultsViewModel;o&&o.getRouteSelected()!==e&&(o.select(e,!1),w.logInstrumentationEvent(v.ARCM,{I:e}))}else n.primitive instanceof ki&&(f=n.primitive,f.routeIndex>-1&&(this._resultsViewModel.select(f.routeIndex,!1),b={I:f.routeIndex},w.logInstrumentationEvent(v.ARCB,b)))}},y.prototype._submitGeoCodeRequest=function(n,t){var i=this;this._reverseGeocoder.reverseGeocode(n,function(n){i._processGeocodeResponse(n,t)})},y.prototype._processGeocodeResponse=function(n,t){n&&n.success&&n.addressList&&n.addressList.length>0&&n.addressList[0].formattedAddress&&this._directionsPanelViewModel.waypoints[t].update(n.addressList[0].formattedAddress,n.location)},y.prototype._showStreetsideBubble=function(n){var t=n.getLocation(),i=n.routeMapEntities&&n.routeMapEntities.getRoutepointNeighbors(t),u,r,f,e;i&&i.length===2&&(u=t,r=i[0],r||(u=i[1],r=t),f=this.perfLog.start(cu.DirectionsIntegrationTime),e={action:"showDirectionsBubbleOverlay",location:t,directionsStartupOptions:{locationToLookAt:u,locationToLookFrom:r,maneuverType:this._resultsViewModel.instructionRowClass(n.getManeuverType()),perfState:f}},l.invokeHandler(c.streetsideDataHandlerKey,e))},y.prototype._onMapTypeChanged=function(n){var t,i;if(n.newMapTypeId!==n.oldMapTypeId)for(t=0;t<this._primitives.length;t++)i=this._primitives[t],y.isIDirectionsPolyline(i)&&(i.changeMapType(n.newMapTypeId),i.update())},y.prototype._updatePrimitivesZoom=function(n){for(var t,i=0;i<this._primitives.length;i++)t=this._primitives[i],y.isIDirectionsPushpin(t)?(t.changeZoom(n),t.update()):y.isIDirectionsPolyline(t)&&(t.changeZoom(n),t.update())},y.prototype._onViewChanged=function(n){var i=this._map.getMode(),t;i&&i.mapModeType!==2&&(t=tt.getMercatorZoomLevel(this._map),y.currentZoomLevel!==t&&(y.currentZoomLevel=t,this._zoomLevelBestMapView<0&&(this._zoomLevelBestMapView=Math.floor(y.currentZoomLevel)),y.currentZoomLevel<=this._zoomLevelBestMapView-1?this._resultsViewModel&&this._resultsViewModel.clearRoutesLabels():this._resultsViewModel&&this._resultsViewModel.showRoutesLabels(),this._updatePrimitivesZoom(t),this._invalidateMap()));this._updateKeyRoutePoints(!1,n&&n.cause)},y.prototype._onDirectionsResultsRequested=function(t,r,u,f,e,o,s,h,c){var l=this,y,v,a;this._isRouteBeingCalculated=!0;this._directionsPanelViewModel.setShowSuggestionsPanel(!1);this._directionsPanelViewModel.hideMessage();y=vt.logPerfEvent(et.TD,t.mode);v=new pt(this._map);this._resultsViewModel&&(this._resultsViewModel.clearRoutesLabels(),this._resultsViewModel.discarded=!0);this.disposables.push(this._resultsViewModel=this._createDirectionsResultsSetViewModel(t,v,y));a=this._resultsViewModel.reportProblemClicked.add(function(){l.isReportable()&&l._resultsViewModel.setReportProblemLink(l._getFeedbackTaskState())});this.disposables.push(a);a=this._resultsViewModel.routeSelectedEvent.add(function(){l._updateKeyRoutePoints();l._resultsViewModel.setShowSeeAllRoutes(!1);l._resultsViewModel.seeAllRoutesReturnClick.invoke()});this.disposables.push(a);a=this._resultsViewModel.seeAllRoutesReturnClick.add(function(){l._directionsPanelViewModel.seeAllRoutesReturnClick();l.setTitle(l.getTitle().replace(n.L_Directions_See_All_Routes_Title,""))});this.disposables.push(a);a=v.invalidateMap.add(function(){l._invalidateMap()});this.disposables.push(a);a=v.addMapLayerPrimitives.add(function(n){l._addMapLayerPrimitives(n.primitives,n.needBestMapView)});this.disposables.push(a);a=v.setMapViewIfPrimitivesOutOfBound.add(function(n){var t=l._taskState&&!!l._taskState.category;l._setMapViewIfPrimitivesOutOfBound(n,t,t)});this.disposables.push(a);a=v.instructionClicked.add(function(n){i.enableHightlightInstruction&&l.scrollLane&&l.scrollLane.invoke(n)});this.disposables.push(a);this._resultsViewModel.getDirections(function(n,t,i,r,u){l._onDirectionsCallback(n,t,i,r,u,h,c)},r,u,f,e,o,s);a=this._directionsPanelViewModel.seeAllRoutesClick.add(function(){l._resultsViewModel.seeAllRoutesClick();l.setTitle(n.L_Directions_See_All_Routes_Title+l.getTitle())});this.disposables.push(a)},y.prototype._clearResultsControl=function(){this._currentResultsControl&&this._currentResultsControl.removeFromParent();this._currentResultsControl=null},y.prototype._onDirectionsCallback=function(r,u,e,o,h,c,l){var k=this,v,d,y,p,w,g,nt,tt,b,a;if(this._isRouteBeingCalculated=!1,h){this._currentPrimitiveMovedArg&&this._processDragRequest(this._currentPrimitiveMovedArg);return}if(this._traceId=r,this._directionsPanelViewModel.setShowProgress(!1),u.errorCode===f.Success||!u.errorDetails){if(this._clearResultsControl(),this._resultsViewModel.waypoints=this._directionsPanelViewModel.waypoints,this._directionsPanelViewModel&&this._directionsPanelViewModel.setResultsShowingFlag(!0),this._currentResultsControl=this._resultsViewModel.getControl(),i.isSDK||(this.appendControl(this._currentResultsControl),this._resultsViewModel.waitingOnRoadShieldEvent()||s(".svg",this._currentResultsControl[0]).inlineDataSvgs().remove_class("svg")),c=c||0,(c>=this._resultsViewModel.directionsResultsTitleSet.length||c<0)&&(c=0),l&&(v=l.split(","),v&&v.length>=2))for(d=v[1],a=0;a<this._resultsViewModel.directionsResultsListSet.length;a++)if(y=this._resultsViewModel.directionsResultsListSet[a].routeId,p=y&&y.split(","),p&&p[1]===d){c=a;break}if(w=!1,this._taskState.category&&this._activatedFromPermaLink&&this._taskState.mode!==t.transit&&(o=!0,w=!0),this._resultsViewModel.select(c,o,!0),this._taskState.mode!==t.transit&&(this.displayState.prominence===undefined||this.displayState.prominence===1)&&this._updateCategoriesBarVisibility(),g=this._directionsPanelViewModel.waypoints[0].getWaypointTitle(),nt=this._directionsPanelViewModel.waypoints[this._directionsPanelViewModel.waypoints.length-1].getWaypointTitle(),this.setTitle(n.L_Directions_Process_Title_Text_Line.replace("{0}",g).replace("{1}",nt)),this._activatedFromPermaLink||this._activatedFromHistoryManager||this.serializableObjectChanged.invoke({magnitude:2}),this._updateKeyRoutePoints(),this._delaySetDisplay&&this._delaySetDisplay.invoke(),this._directionsPanelViewModel.showEditAndCollapseCard(),w){for(tt=this._taskState.category.toLowerCase(),a=0;a<fi.length;a++)if(fi[a].category.toLowerCase()===tt){b=fi[a];break}b&&this._dragonflyContainer.instanceAsync("BrowserHistoryManager",function(n){n.nextHistoryPointReplace();k._processCategorySelection(b,k.id)})}this._activatedFromPermaLink=!1}else this._directionsPanelViewModel.clearResultsAndShowMessage(u,r),this._clearResultsControl()},y.prototype._updateLocationIdentifiers=function(){for(var r=0,t=-1,u=0,i,n;r<this.inputData.waypoints.length;)i=this.inputData.waypoints[r],t<0?(n=this._resultsViewModel.stopPoints[r],i.locationIdentifier=n&&n.locationIdentifier):(n=this._resultsViewModel.allStopPoints[u].routeLegStopPoint,i.viaWaypoints[t].locationIdentifier=n&&n.locationIdentifier),t++,u++,i&&t>=i.viaWaypoints.length&&(r++,t=-1)},y.prototype._getWaypointLabel=function(n){return this._directionsPanelViewModel!=null?this._directionsPanelViewModel.indexToIconText(n):"%20"},y.prototype._updatePrintImages=function(){var o,n,u,i;if(this._hasRoute()){var t=st.printImgMiniMapUrlFormat,e="",f=this._resultsViewModel,r=f.waypoints;for(n=0;n<r.length;n++)u=r[n],i=u.getWayPointModel().point,e+="wp."+n+"="+i.latitude+","+i.longitude+";"+(n==0?y.startPrintIcon:n===r.length-1?y.endPrintIcon:y.stopPrintIcon)+";"+this._getWaypointLabel(n)+"&";for(t=t.replace("{wp}",e),t=t.replace("{credentials}",st.credentials),t=t.replace("{culture}",g.dynamicProperties.market),o=f.getRouteSelected(),t=t.replace("{rid}",f.directionsResultsListSet[o].routeId),n=0;n<r.length;n++)u=r[n],i=u.getWayPointModel().point,u.setPrintImagePath(t.replace("{lat}",""+i.latitude).replace("{lon}",""+i.longitude))}},y.prototype._updateKeyRoutePoints=function(n,t){if(this._listeners.length!=0||n){var i=this._keyRoutePoints;this._keyRoutePoints=this._calculateKeyRoutePoints();this._arePointsDifferent(i,this._keyRoutePoints)&&this._notifyListeners(t)}},y.prototype._arePointsDifferent=function(n,t){if(n.length!=t.length)return!0;for(var i=0;i<n.length;i++)if(!b.areEqual(n[i],t[i]))return!0;return!1},y.prototype._notifyListeners=function(n){this._listeners.length!=0&&this._sendNotificationMessage(this._keyRoutePoints,this._listeners,n)},y.prototype._sendNotificationMessage=function(n,t,i){for(var u,f,r=0;r<this._listeners.length;r++)u={action:0,cause:i,keyRoutePoints:n,directionsTaskId:this.id},f={requestorType:"DirectionsTask",requestorId:this.id,type:a.localListingTask,requestState:u,taskId:t[r]},l.invokeHandler(c.taskProcessDataHandlerKey,f)},y.prototype._notifyListenersBeforeDeactivation=function(){for(var t,i,n=0;n<this._listeners.length;n++)t={action:1},i={requestorType:"DirectionsTask",requestorId:this.id,type:a.localListingTask,requestState:t,taskId:this._listeners[n]},l.invokeHandler(c.taskProcessDataHandlerKey,i)},y.prototype._addMapLayerPrimitives=function(n,t){var i=this,r,u,f;this._clearPrimitives();n&&n.length>0&&(r=this._map.getFrameManager(),r&&r.frameRendered.addOne(function(){i._directionsRequestStartTime>0&&(fr.log(fr.directionsTimeToGlass,i._directionsRequestStartTime),i._directionsRequestStartTime=-1)}),this._primitives=this._primitives.concat(n),this._associatePrimitivesWithLayer(n),u=tt.getMercatorZoomLevel(this._map),this._updatePrimitivesZoom(u),t&&(f=ci.getLocationsForPrimitivesInView(this._primitives),this._setMapViewWithPadding(f),this._zoomLevelBestMapView=-1),this._currentPrimitiveMovedArg||this.directionsManagerCallback.invoke(),this._invalidateMap())},y.prototype._invalidateMap=function(){var n=this;this._layerInitiated||(this.templateSelector||(this.templateSelector=new wi(this._map)),this._layer||(this._layer=new or("DirectionsTask_"+ci.getUniqueId(),this,this.templateSelector,wu.foregroundZOrder),this._map.getLayers().insert(this._layer)),this._layer.setRenderTarget(g.tileRefactoringEnabled?2:1),this._associatePrimitivesWithLayer(this._primitives),this.disposables.push(this._layer.primitiveTapped.add(function(t){n._onPrimitiveTapped(t)})),this._isDraggable()&&(this.disposables.push(this._layer.primitiveMoveStarted.add(function(t){n._onPrimitiveMoveStarted(t)})),this.disposables.push(this._layer.primitiveMoveContinued.addThrottled(function(t){n._onPrimitiveMoveContinued(t)},200)),this.disposables.push(this._layer.primitiveMoveStopped.add(function(t){n._onPrimitiveMoveStopped(t)}))),this.disposables.push(this._layer.primitiveHoverStarted.add(function(t){n._onPrimitiveHover(t,!0)})),this.disposables.push(this._layer.primitiveHoverStopped.add(function(t){n._onPrimitiveHover(t,!1)})),this.disposables.push(this._map.pointerMoved.add(function(t){return n._onPointerMoved(t)})),this._layerInitiated=!0);this.invalidated.invoke();r.Layer!==undefined&&this._layer instanceof r.Layer&&this._layer.raiseInvalidatedEvent()},y.prototype._clearMap=function(){this._updateDragPin(!1,null,!1,!1,!1);this._primitives&&this._primitives.length&&(this._clearPrimitives(),this._invalidateMap())},y.prototype.clearExistingRoutes=function(){this._currentResultsControl&&(this._clearResultsControl(),this._resultsViewModel&&this._resultsViewModel.clearRoutes(),this._resultsViewModel=null,this._clearMap(),this.routeClearedEvent&&this.routeClearedEvent.invoke());this._removeCategoriesBar();this._directionsPanelViewModel&&this._directionsPanelViewModel.setResultsShowingFlag(!1)},y.prototype._waypointResolved=function(){var u,n,i,r,f,t;if(!this._hasRoute()){for(this._clearPrimitives(),u=this._directionsPanelViewModel.waypoints.length,n=0;n<u;n++)i=this._directionsPanelViewModel.waypoints[n].getWayPointModel(),i.point&&(r=h.middle,n===0?r=h.start:n===u-1&&(r=h.end),f=i.name||i.address,t=pt.createStopPointPin(i.point,r,this._directionsPanelViewModel.getMode(),!1,null,n,0,null,f,this._renderOptions),t.changeCardTaskState(1),t.changeRouteSelectionState(!0),t.changeZoom(tt.getMercatorZoomLevel(this._map)),t.update(),this._primitives.push(t),this._associatePrimitivesWithLayer([t]));this._invalidateMap()}},y.prototype._associatePrimitivesWithLayer=function(n){var t=this._layer,i,u;if(t)if(r.Layer!==undefined&&t instanceof r.Layer)t.add(n);else for(i=0,u=n.length;i<u;i++)n[i].layer=t},y.prototype._setMapViewIfPrimitivesOutOfBound=function(n,t,i){var r;t===void 0&&(t=!1);i===void 0&&(i=!1);var e=tt.getMapBounds(this._map,!0),u=ci.getLocationsForPrimitivesInView(n),f=!1;for(r=0;r<u.length;r++)if(e.contains(u[r])){f=!0;break}(!f||i||this._directionsPanelViewModel&&this._directionsPanelViewModel.isLongDistanceIntent&&!this._isDistanceIntentMapViewSet)&&this._setMapViewWithPadding(u,t)},y.prototype._setMapViewWithPadding=function(n,t){var i,r;t===void 0&&(t=!1);i=this._map.getMapType();i.id!==su.birdseyeV2&&(t||!this.displayState.activationState||this.displayState.activationState===1)&&(r=this._getAdditionalPadding(),this._map.setView(this._map.getMode().getMapViewForLocationsInView(n,r)),this._directionsPanelViewModel&&this._directionsPanelViewModel.isLongDistanceIntent&&(this._isDistanceIntentMapViewSet=!0))},y.prototype._getAdditionalPadding=function(){var t=this._map.getViewport(),i=Math.min(.07*t.pixelWidth,.07*t.pixelHeight),n=Math.max(10+23/2,i);return{left:n,top:n,right:n,bottom:n}},y.prototype.isSharable=function(){return this._primitives&&this._primitives.length>0},y.prototype.getMenuList=function(){var t=e.prototype.getMenuList.call(this);return this.isReportable()&&t.push({name:n.L_Menu_ReportProblem_Link_Text,options:{type:a.feedbackTask,activateOptions:{parentId:this.id},state:this._getFeedbackTaskState()},instData:this.getInstData("Report Problem")}),t},y.prototype.isReportable=function(){return this._resultsViewModel?!0:!1},y.prototype._getFeedbackTaskState=function(){return{entryPoint:2,feedbackTaskType:5,activeTaskId:this.id,title:this.getTitle(),options:this.getReportOptions()}},y.prototype.getReportOptions=function(){var n=this._resultsViewModel.directionsResultsListSet[this._resultsViewModel.getRouteSelected()],t=[];return n&&n.stepStrings&&(t=n.stepStrings),{reportType:this.getReportType(),taskState:this.serialize(),directionStepsList:t,directionRouteIndex:this._resultsViewModel.getRouteSelected()}},y.prototype.getReportType=function(){return 7},y.prototype._setMapLayerZIndex=function(n){this._layer&&this._layer.setZIndex(n)},y.prototype._getTraceId=function(){return this._traceId},y.prototype._hasRoute=function(){return this._resultsViewModel&&this._resultsViewModel.getRoutesLength()>0},y.prototype._createDirectionsPanelViewModel=function(){return g.isMobile?new pr(this.inputData,this._controlTemplateFactory,this._dragonflyContainer,this._geolocationProvider,this.id,this._map,this.perfLog,this.directionsManagerCallback,this._renderOptions,this._taskState&&this._taskState.resolveWaypointsInRoutingService):new vi(this.inputData,this._controlTemplateFactory,this._dragonflyContainer,this._geolocationProvider,this.id,this._map,this.perfLog,this.directionsManagerCallback,this._renderOptions,this._taskState&&this._taskState.resolveWaypointsInRoutingService)},y.prototype._createDirectionsResultsSetViewModel=function(n,t,i){return g.isMobile?new kr(this._map,this._controlTemplateFactory,n,this._directionsPanelViewModel,t,this.perfLog,i,this.id,this._renderOptions):new pi(this._map,this._controlTemplateFactory,n,this._directionsPanelViewModel,t,this.perfLog,i,this.id,this._renderOptions,this._taskState.options&&this._taskState.options.routeDraggable)},y.prototype.getResultsPanel=function(){return this._resultsViewModel&&this._resultsViewModel.getControl()},y.prototype.clearDisplay=function(){this._layer&&this._map.getLayers().remove(this._layer)},y.prototype.getDirectionsResponse=function(){return this._resultsViewModel&&this._resultsViewModel.getRawResponse()},y.prototype.getPanelViewModel=function(){return this._directionsPanelViewModel},y.isIDirectionsPushpin=function(n){return n instanceof wt?!0:typeof r.Directions.DirectionsSDKPushpin!="undefined"?n instanceof r.Directions.DirectionsSDKPushpin:!1},y.isIDirectionsPolyline=function(n){return n instanceof oi?!0:typeof r.Directions.DirectionsSDKPolyline!="undefined"?n instanceof r.Directions.DirectionsSDKPolyline:!1},y.prototype._clearPrimitives=function(){this._primitives=[];r.Layer!==undefined&&this._layer instanceof r.Layer&&this._layer.clear()},y.prototype._isDraggable=function(){return this._taskState&&this._taskState.options&&typeof this._taskState.options.routeDraggable=="boolean"?this._taskState.options.routeDraggable:i.routeDraggable},y.prototype._isMajorPoint=function(n){var t=n.getManeuverType();return t==="start"||t==="middle"||t==="end"||t==="via"},y.KeySegmentCount=10,y.KeyPointsCount=y.KeySegmentCount+1,y.localDetailCardsData=[],y.polygonEntityDetailCardsData=[],y.transitStopCardsData=[],y.RouteCategoriesBarPanelCssClass="routecategoriesbar",y.startPrintIcon=155,y.stopPrintIcon=156,y.endPrintIcon=157,y.showDragMax=10,y}(gi),to=function(){function n(){this.changed=new o}return n.prototype.getIgnoreOverlayOnTapped=function(){return!0},n}(),pt=function(){function n(n){this.routeMapEntitiesCollection=[];this._primitives=[];this._globalPushpinPrimitives=[];this.addMapLayerPrimitives=new o;this.instructionClicked=new o;this.instructionClickedDone=new o;this.setMapViewIfPrimitivesOutOfBound=new o;this.invalidateMap=new o;this._map=n}return n.prototype.select=function(n,t,i,r){var e,u,f,o;if(this.routeMapEntitiesCollection&&this.routeMapEntitiesCollection.length!==0){for(this._selectedIndex=n,this._primitives=[],u=0;u<this.routeMapEntitiesCollection.length;u++)f=this.routeMapEntitiesCollection[u],u==n?(f.select(),e=f.getPrimitives()):(f.unSelect(),this._primitives=this._primitives.concat(f.getPrimitives()));if(e&&(this._primitives=this._primitives.concat(e)),this._globalPushpinPrimitives.length>0){for(o=0;o<this._globalPushpinPrimitives.length;o++)this._globalPushpinPrimitives[o].updateSelectedRoute(n);this._primitives=this._primitives.concat(this._globalPushpinPrimitives)}t&&this.setMapViewIfPrimitivesOutOfBound.invoke(e);this.show(t,i,r,!0)}},n.prototype.getMapType=function(){return this._map.getMapType().id},n.prototype.getMap=function(){return this._map},n.showDragTipPin=function(t,i,r,u,f,e){n._tipOverlay||(n._tipOverlay=new hf(i));n._tipOverlayShowing||(t.getOverlays().insert(n._tipOverlay),n._tipOverlayShowing=!0);n._tipOverlay.setAlignment(r);n._tipOverlay.setShowPin(e);n._tipOverlay.setShowTip(u,f)},n.hideDragTipPin=function(t){n._tipOverlay&&(n._tipOverlayShowing=!1,t.getOverlays()&&t.getOverlays().remove(n._tipOverlay))},n.prototype.clearRoutes=function(){this.clearRoutesLabels()},n.prototype.clearRoutesLabels=function(){if(i.enableRouteLabel)for(var n=0;n<this.routeMapEntitiesCollection.length;n++)this.routeMapEntitiesCollection[n].hideLabel()},n.prototype.centerMap=function(n){tt.setMapCenter(this._map,n,16)},n.prototype.highlightAndInvalidate=function(t){n.highlight(t)},n.prototype.dispose=function(){u._clearDisposables(this.routeMapEntitiesCollection);u._clearDisposables(this._primitives);u._disposeEvents(this);this._globalPushpinPrimitives=null;this._map=null},n.highlight=function(t){if(t instanceof wt){var i=n._highlightedPin;i!==t&&(i&&i.entity&&(i.isPinHighlighted=!1,i.update(),i.entity.changed.invoke()),t&&t.entity&&(t.isPinHighlighted=!0,t.update(),t.entity.changed.invoke()),n._highlightedPin=t)}},n.createStopPointPin=function(n,t,u,f,e,o,s,c,l,a){if(n){var v="",y=null,p;return t===h.start?(v="start",y=a&&(a.firstWaypointPushpinOptions||a.waypointPushpinOptions)):t===h.end?(v="end",y=a&&(a.lastWaypointPushpinOptions||a.waypointPushpinOptions)):t===h.middle?(v="middle",y=a&&a.waypointPushpinOptions):v=t===h.infopin?"infopin":"via",p=i.isSDK&&typeof r.Directions.DirectionsSDKPushpin!="undefined"?new r.Directions.DirectionsSDKPushpin(n,y,t,e,u,f,c,v,o,s,l,String.fromCharCode(o+65)):new wt(n,t,e,u,f,c,v,o,s,l,String.fromCharCode(o+65)),p.entity.poiType=7,p}return null},n.prototype.addRoute=function(n,t,r,u,f,e){if(this._primitives.push.apply(this._primitives,n.getPrimitives()),this.routeMapEntitiesCollection.push(n),!i.isSDK&&t){var o=this._createInfoboxPin(t,n,u,f,e);o&&(o.timeSummary=r.getDurationString(t.travelDurationTraffic?t.travelDurationTraffic:t.travelDuration),o.distanceSummary=r.getFormattedDistanceText(t.travelDistance,t,!0),this._globalPushpinPrimitives.push(o),o.distanceSummary&&o.distanceSummary!==undefined||w.logInstrumentationEvent(v.DBG,{infodist:"undefined"}))}},n.prototype._createInfoboxPin=function(n,t,i,r,u){var f=n&&n.routeInfoHint;return f&&f.hintPoint?new ki(new b(f.hintPoint.coordinates[0],f.hintPoint.coordinates[1]),f.orientation,this._map,i,t,n,r,u):null},n.prototype.show=function(n,t,i,r){var h=this,e,o,u,f,s;for(t&&(e=vt.logPerfEvent(et.MR,i),o=this._map.getFrameManager(),e&&o&&o.frameRendered.addOne(function(){e.end()})),u=0;u<this.routeMapEntitiesCollection.length;u++)this.routeMapEntitiesCollection[u].show();for(f=0;f<this._globalPushpinPrimitives.length;f++)s=this._globalPushpinPrimitives[f],s.changeCardTaskState(1),s.update();this.addMapLayerPrimitives.invoke({primitives:this._primitives,needBestMapView:n});r&&Microsoft.Maps.setTimeout(function(){h.showRouteLabels()},0)},n.prototype.showRouteLabels=function(){var r,t,e,l,h,o,c,s;if(i.enableRouteLabel)for(r=0;r<this.routeMapEntitiesCollection.length;r++){var u=[],f=[],n=this.routeMapEntitiesCollection[r];if(n.labelLocation){n.showLabel();continue}for(t=n.routeLinePoints,e=0;e<this.routeMapEntitiesCollection.length;e++)if(u=[],l=this.routeMapEntitiesCollection[e],h=l.routeLinePoints,e!==r)for(o=0;o<t.length;o++){for(c=!1,s=0;s<h.length;s++)if(b.areEqual(t[o],h[s])){c=!0;break}c?(u.length>f.length&&(f=u),u=[]):u.push(t[o])}f.length?n.setLabelLocation(f[Math.floor(f.length/2)]):n.setLabelLocation(t[Math.floor(t.length/2)],!0);n.showLabel()}},n.prototype.setTaskPrimitiveState=function(n){for(var t=0;t<this.routeMapEntitiesCollection.length;t++)this.routeMapEntitiesCollection[t].setTaskPrimitiveState(n);for(t=0;t<this._globalPushpinPrimitives.length;t++)this._globalPushpinPrimitives[t].setTaskPrimitiveState(n)},n.prototype.getRoutepointNeighbors=function(n){return this.routeMapEntitiesCollection[this._selectedIndex].getRoutepointNeighbors(n)},n}(),dt=function(t){function r(u,f,e,o,s,h){var c=this,l={},p,w;if(c=t.call(this,l)||this,c.itineraryItem=e,c.itineraryItem&&(c.stepIndex=c.itineraryItem.instructionIndex,c.parentStepIndex=c.itineraryItem.parentInstructionIndex),c.itineraryItem&&c.itineraryItem.maneuverPoint?c.location=c._getLocation(c.itineraryItem.maneuverPoint):f&&(c.location=c._getLocation(f)),s){var v=s.getWayPointModel(),a=s.getWaypointTitle(),y=v.address;y&&a!==y&&(c.stepAddress=y);c.stepText=a;c.formattedText=a;c.isClickable=!(a===n.L_Directions_MyLocation||a===n.L_Directions_Home||a===n.L_Directions_Work)&&!i.isSDK;c.entityId=v.eid;c.searchFilter=v.filterUrlParam;c._setIconTextFromIndex(s.getIndex());c._setWaypointTitleFromIndex(s)}return c.needPushpin=!0,c._routeMapEntitiesCollection=u,c._cssClassNormal=r._defaultCssClass,c.resources=n,l.defineProperty("cssClass",null,null,{defaultValue:r._defaultCssClass}),l.defineProperty("show",null,null,{defaultValue:!0}),l.defineProperty("showGroup",null,null,{defaultValue:!1}),l.defineProperty("roadShieldUrl"),p=!g.isMapsAnswer&&!g.isMapsVertical,w=p||o!=="dirRouteStart"&&o!="dirRouteEnd",w&&l.defineProperty("role",null,null,{defaultValue:"button"}),o&&c.setStepIconClass(o),c.showHints=c.showIcon=c.showWarnings=!0,c.setRenderOptions(h),c}return p(r,t),r.prototype._setIconTextFromIndex=function(n){this.iconText=String.fromCharCode(n+65)},r.prototype.setStepIconClass=function(n){this.stepIconClass=n;this._cssClassNormal=this._stepIconClassToCssClass(n);this._updateCssClass()},r.prototype._setWaypointTitleFromIndex=function(t){var i=t.getIndex()?n.L_Directions_Add_To:n.L_Directions_Add_From;i=i.replace("{0}",t.getWaypointTitle());this.waypointTitle=i},r.prototype.setHover=function(n){this._isHover!==n&&(this._isHover=n,this._updateCssClass())},r.prototype.showGroupToClass=function(n){return n?"upArrow":"downArrow"},r.prototype.arrayToDisplay=function(n){return this.boolToDisplay(n&&n.length>0)},r.prototype.lineColorToIconClass=function(n){var i="dirIcon",t=parseInt(n),r;return t&&t<=16777215&&(r=u._calcLuminance(t),i+=r>.65?" darkSymbol":" lightSymbol"),i},r.prototype.onMouseEnter=function(){this._routeMapEntitiesCollection.highlightAndInvalidate(this.pushpin)},r.prototype.onInstructionClick=function(n){var t,r,u,i;this._routeMapEntitiesCollection.instructionClicked.invoke(s(n.currentTarget));this.groupItems&&this.groupItems.length?(t=!this.getShowGroup(),this.groupItems.forEach(function(n){n.setShow(t);n.pushpin.setVisibility(t)}),r=v.COL,t&&(u=this._routeMapEntitiesCollection.getMap(),u.setView(u.getMode().getMapViewForLocationsInView(this.groupItemsLocations)),r=v.EXP),this.setShowGroup(t),i={},i.CI=2,this.itineraryItem&&this.itineraryItem.transitStops&&this.itineraryItem.transitStops.length?i.CI=6:this.groupItems[0].itineraryItem&&this.groupItems[0].itineraryItem.details[0].startPathIndices[0]===0&&(i.CI=1),w.logInstrumentationEvent(r,i)):this.location&&(this.location.latitude||this.location.longitude)&&(this._routeMapEntitiesCollection.centerMap(this.location),this.transitStopID&&this.showTransitStop());this._routeMapEntitiesCollection.instructionClickedDone.invoke()},r.prototype.onInstructionKeyDown=function(n){var t=n,i=t.keyCode||t.which;if(i==13){n&&n.stopImmediatePropagation();n&&n.preventDefault&&n.preventDefault();this.onInstructionClick(n)}},r.prototype._updateCssClass=function(){var n=this._cssClassNormal;this._isHover&&(n+=" hover");this.setCssClass(n)},r.prototype._getLocation=function(n){var t=n.coordinates,i=new b(t[0],t[1]);return sr.toLocation(i,17,!0)},r.prototype._stepIconClassToCssClass=function(n){var i=" circleIcon",t=" "+r._defaultCssClass;switch(n){case"TurnLeft":case"TurnLeftThenBearLeft":case"TurnLeftThenBearRight":case"TurnLeftThenTurnLeft":case"TurnLeftThenTurnRight":return"turnLeft"+i+t;case"TurnRight":case"TurnRightThenBearLeft":case"TurnRightThenBearRight":case"TurnRightThenTurnLeft":case"TurnRightThenTurnRight":return"turnRight"+i+t;case"UTurn":case"TurnBack":return"uTurnLeft"+i+t;case"KeepStraight":case"Continue":case"KeepOnRampStraight":case"KeepToStayStraight":case"RoadNameChange":case"TakeRampStraight":case"Transfer":return"keepStraight"+i+t;case"BearLeft":case"BearLeftThenBearLeft":case"BearLeftThenBearRight":case"BearLeftThenTurnLeft":case"BearLeftThenTurnRight":case"KeepOnRampLeft":return"slightLeft"+i+t;case"BearRight":case"BearRightThenBearLeft":case"BearRightThenBearRight":case"BearRightThenTurnLeft":case"BearRightThenTurnRight":case"KeepOnRampRight":return"slightRight"+i+t;case"KeepLeft":case"KeepToStayLeft":return"keepLeft"+i+t;case"KeepRight":case"KeepToStayRight":return"keepRight"+i+t;case"EnterRoundabout":case"EnterThenExitRoundabout":return"enterRoundaboutRight"+i+t;case"TakeRampRight":case"TakeRampLeft":case"ExitRoundabout":case"EnterRoundaboutLeft":case"Merge":case"TurnToStayLeft":case"TurnToStayRight":case"UTurnRight":case"RampThenHighwayRight":case"RampThenHighwayLeft":case"DepartStart":return n+i+t;case"Bus":case"Walk":case"Ferry":case"Tube":case"Train":return n+i+t;default:return n?n+t:t}},r.prototype.onNearbyParkingClick=function(n){if(n&&n.stopImmediatePropagation(),n&&n.preventDefault&&n.preventDefault(),this.location){var t={location:this.location,title:this.stepText,entryPoint:1};l.invokeHandler(c.taskDataHandlerKey,{type:a.nearbyParkingTask,state:t})}},r.prototype.showTransitStop=function(){if(this.transitStopID&&this.transitStopID>0){var n={id:this.transitStopID,title:this.transitStopName,location:this.location,activationEntryPoint:6};l.invokeHandler(c.taskDataHandlerKey,{action:"activate",type:a.transitStopTask,state:n})}},r.prototype.processTransitStopInfo=function(n,t){var i=this;bu.downloadTransitStop({stopId:n.toString(),dateTime:new Date},function(n,r){var f={},e,o,u,s;if(r&&r.resourceSets&&r.resourceSets.length&&r.resourceSets[0].resources&&r.resourceSets[0].resources.length){for(f=r.resourceSets[0].resources[0],e={},o=[],u=0;u<f.realTimeDataAtStop.length;u++)s=f.realTimeDataAtStop[u].line,o.push(s.abbreviatedName);e.stops=[{id:i.transitStopID,name:i.transitStopName,routes:[{count:u,names:o}]}];i.transitStaticResources=i._buildTransitStaticResources(e);t()}})},r.prototype._buildTransitStaticResources=function(n){var o="",s="",u=[],h=0,f=!1,i,t,r,e;if(n&&n.stops&&n.stops.length&&(s=n.stops[0].name,n.stops[0].routes&&n.stops[0].routes.length)){for(i=n.stops[0].routes,t=0;t<i.length;t++)for(r=0;r<i[t].names.length;r++)e=i[t].names[r],e.length>5&&h++,u.push(e);f=h>=u.length/2;o=u.join(f?"\n":", ")}return{transitLandmark:n,routeList:o,showLongList:f,stopName:s,addNewLines:this._addNewLines}},r.prototype._addNewLines=function(n){return n?"enableNewLines":""},r.prototype.setRenderOptions=function(n){n&&((n.displayPostItineraryItemHints===!1||n.displayPreItineraryItemHints===!1)&&(this.showHints=!1),n.displayManeuverIcons!==undefined&&(this.showIcon=n.displayManeuverIcons),n.displayStepWarnings!==undefined&&(this.showWarnings=n.displayStepWarnings),n.displayWalkingWarning!==undefined&&this.stepIconClass=="Walk"&&(this.showWarnings=n.displayWalkingWarning))},r._defaultCssClass="bm_dirInstructionRowGroup",r}(ut),oi=function(n){function r(t,i,r,u,f,e,o,s){return n.call(this,t,i,r,u,f,e,o,s)||this}return p(r,n),r.prototype._isAddingViaAllowed=function(){return this._routeMode!==t.transit&&this._numberOfViaPoints<i.maxViaPoints},r}(er),wt=function(n){function t(t,i,r,u,f,e,o,s,h,c,l,a,v){var y=n.call(this,t,i,u,f,o,s,h,c,l,a)||this;return y.routeMapEntities=e,y.instructionViewModel=r,y._isItineraryPin=v,y.setLabel(c,l),y}return p(t,n),t.prototype.setLabel=function(n,i){n&&(!this.routeMapEntities||this.isRouteSelected)&&(this.entity.name=n,this.entity.iconText=i);this._isItineraryPin?(this.entity.collisionBehavior=0,this.zIndex=t.ItineraryPinZIndex,this.bucket=null):this.bucket=kt.bucketIdForDirectionsPins;this.pushpinIconType&&!wi.majorPinTypes[h[this.pushpinIconType]]&&(this.entity.collisionBehavior=0)},t.prototype.dispose=function(){u._nullifyClass(this)},t.ItineraryPinZIndex=1e3,t}(ti),ki=function(n){function i(t,r,u,f,e,o,s,c){var l=n.call(this,t,h.infopin,f,!0)||this;return l._route=o,l._congestion=o&&o.trafficCongestion,l.orientation=r,l.currentZoomLevel=u.getMercatorZoomLevel(),l.routeMapEntities=e,l.entity.collisionBehavior=0,l.isRouteSelected=s===0,l.routeIndex=s,l._isClickable=c,l.bucket=kt.bucketIdForDirectionsPins,l.zIndex=l.isRouteSelected?i.SelectedZIndex:i.AlternateZIndex,l}return p(i,n),i.prototype.dispose=function(){u._nullifyClass(this)},i.prototype.setLabel=function(){this.bucket=kt.bucketIdForDirectionsPins},i.prototype.getTemplates=function(){var r=[],s,f,c,t,e,o,n;if(this.taskState===3||this.taskState===2&&!this.isRouteSelected)return r;var l=["ib",this.routeMode.toString(),this.orientation,this.timeSummary,this.distanceSummary,this.isRouteSelected?"S":"U"],h=l.join(":"),u=i._primitiveTemplateCache.getItem(h);if(u&&u.length>1)for(n=0;n<u.length;n++)r.push(u[n]);else{for(s={},f=ot.getIconsInRouteLeg(this._route,this.routeMode,s),this._transitFrequency=s.transitFrequency,c=this._getInfopinVectorPathForOrientation(f),t=new iu(this._createInfoPinImage(c,f.length),1,this._boxAnchorLocation),t.setHitTestShape(2),t.shadowStyle=this._getShadowStyle(),r.push(t),e=[],e.push(t),o=this._getVectorImagesForModes(t,f),n=0;n<o.length;n++)r.push(o[n]),e.push(o[n]);i._primitiveTemplateCache.addItem(h,e)}return r},i.prototype.updateSelectedRoute=function(n){this.isRouteSelected=n===this.routeIndex;this.zIndex=this.isRouteSelected?i.SelectedZIndex:i.AlternateZIndex},i.prototype.setTaskPrimitiveState=function(n){this.taskState=n;this.bucket=n===1||n===2&&this.isRouteSelected?kt.bucketIdForDirectionsPins:null},i.prototype.isMoveEnabled=function(){return!1},i.prototype.isTapEnabled=function(){return this.isClickResponseEnabled()},i.prototype.isHoverEnabled=function(){return this.isClickResponseEnabled()},i.prototype.isClickResponseEnabled=function(){return this._isClickable&&!this.isRouteSelected},i.prototype._createChildTemplate=function(n,t,i){return new fu(n,this._createIconImage(t),1,0,i)},i.prototype._getVectorImagesForModes=function(n,t){var r=[],i=new y(this.orientation.toLowerCase()==="right"?12:6,this._modeAnchorPoint.y),u=t&&t.length;return u<1?r:(r.push(this._createChildTemplate(n,t[0],i.clone())),i.x+=18,u>1&&(r.push(this._createChildTemplate(n,"spacer",i.clone())),i.x+=12,u>3?(r.push(this._createChildTemplate(n,"more",new y(i.x,i.y+6))),i.x+=16,r.push(this._createChildTemplate(n,"spacer",i.clone())),i.x+=14):u>2&&(r.push(this._createChildTemplate(n,t[1],i.clone())),i.x+=18,r.push(this._createChildTemplate(n,"spacer",i.clone())),i.x+=14),r.push(this._createChildTemplate(n,t[t.length-1],i.clone())),i.x+=24),r)},i.prototype._createInfoPinImage=function(n,t){var r={records:[],hotspotX:0,hotspotY:0,hitTest:1},i=r.records;return i.push(n),i.push(this._getTextRecord(this.timeSummary,!0)),t===1&&i.push(this._getTextRecord(this._transitFrequency?this._transitFrequency:this.distanceSummary,!1)),r},i.prototype._createIconImage=function(n){var t={records:[],hotspotX:0,hotspotY:0,hitTest:1};return t.records.push(this._getRouteModeRecord(n)),t},i.prototype._getShadowStyle=function(){return{shadowColor:i.shadowColor,shadowBlur:i.shadowBlur,shadowOffset:i.shadowOffset}},i.prototype._getHighlightColor=function(){var n=this.routeMode===t.driving?i.lowTrafficHighlightColor:i.defaultTextColor;if(this._congestion)switch(this._congestion.toLowerCase()){case"medium":n=i.mediumTrafficHighlightColor;break;case"heavy":n=i.heavyTrafficHighlightColor}return n},i.prototype._getTextRecord=function(n,t){return{vectorType:3,text:n?n:"",anchor:t?this._timeTextAnchor:this._distanceTextAnchor,horizontalAutoScaling:t?1:0,style:{fillStyle:t?this._getHighlightColor():i.defaultHighlightColor,font:i.textFont,fontSize:t?i.timeTextSize:i.distanceTextSize,fontStyle:t?1:32,horizontalAutoScaling:1,horizontalAlignment:1}}},i.prototype._calculateTextBoxWidth=function(){var n={styleStatic:{verticalAlignment:0,horizontalAlignment:1},styleDynamic:{font:i.textFont,fontSize:11,fontColor:i.lowTrafficHighlightColor,outlineColor:i.lowTrafficHighlightColor}};return ru.getTextSize(this.timeSummary,null,n,i.timeTextSize,i.distanceTextSize)},i.prototype._buildPinPath=function(n,t,r,u){var f=i.beakWidth/2,e=(u-i.beakWidth)/2,o=(r-i.beakWidth)/2;this._pinPath=n.replace("{start}",t.x+","+t.y).replace(new RegExp("{halfBeakWd}","g"),f.toString()).replace(new RegExp("{beakHt}","g"),i.beakHeight.toString()).replace(new RegExp("{beakSideHalfWidth}","g"),e.toString()).replace(new RegExp("{beakSideHalfHeight}","g"),o.toString()).replace(new RegExp("{height}","g"),r.toString()).replace(new RegExp("{width}","g"),u.toString())},i.prototype._getRouteModeRecord=function(n){var t;switch(n){default:case"car":t=i.drivingModePath;break;case"train":t=i.trainModePath;break;case"ferry":t=i.ferryModePath;break;case"bus":t=i.transitModePath;break;case"walk":t=i.walkingModePath;break;case"spacer":t=i.spacerPath;break;case"more":t=i.moreModePath}return{pathData:t,vectorType:4,scalePaletteKey:"0",shapePaletteKey:"0",style:{strokeStyle:i.modeStrokeStyle,fillStyle:i.modeFillStyle}}},i.prototype._calculateIconWidth=function(n){return n>=3?(i.iconWidth+i.spacerWidth)*2+i.iconWidth:n===2?i.spacerWidth+i.iconWidth*2:i.iconWidth},i.prototype._calculateBoxSize=function(n,t){return new au(n.width+this._calculateIconWidth(t)+i.boxBuffer,t>1?i.singleLineHeight:i.doubleLineHeight)},i.prototype._getInfopinVectorPathForOrientation=function(n){if(!this._offsetsComputed){var s=this._calculateTextBoxWidth(),e=this._calculateBoxSize(s,n&&n.length),u=e.width,r=e.height,o=(u-i.beakWidth)/2,t=new y(6,0),f=void 0;switch(this.orientation.toLowerCase()){default:case"unknown":case"up":this._boxAnchorLocation=new bt(.5,1,0);this._modeAnchorPoint=new y(6,6);t=t.add(new y(6,17));f=new y(6,32);this._buildPinPath(i.upInfoboxPath,new y(i.infoboxCurveAdjustment/2+o+i.beakWidth,i.infoboxCurveAdjustment+r),r,u);break;case"down":this._boxAnchorLocation=new bt(.5,0,0);this._modeAnchorPoint=new y(6,12);t=t.add(new y(6,22));f=new y(6,37);this._buildPinPath(i.downInfoboxPath,new y(i.infoboxCurveAdjustment/2+o,i.beakHeight),r,u);break;case"left":this._boxAnchorLocation=new bt(1,.5,0);this._modeAnchorPoint=new y(6,n&&n.length>1?8:6);t=t.add(new y(6,16));f=new y(6,30);this._buildPinPath(i.leftInfoboxPath,new y(i.infoboxCurveAdjustment+u,(r+i.infoboxCurveAdjustment-i.beakWidth)/2),r,u);break;case"right":this._boxAnchorLocation=new bt(0,.5,0);this._modeAnchorPoint=new y(12,n&&n.length>1?8:6);t=t.add(new y(12,16));f=new y(12,30);this._buildPinPath(i.rightInfoboxPath,new y(i.beakHeight,(i.beakWidth+r+i.infoboxCurveAdjustment)/2),r,u)}this._timeTextAnchor=t.add(new y(this._calculateIconWidth(n.length),0));this._distanceTextAnchor=f;this._offsetsComputed=!0}return this._pinPath?{pathData:this._pinPath,vectorType:4,scalePaletteKey:"0",shapePaletteKey:"0",style:{fillStyle:this.isRouteSelected?i.selectedFillStyle:i.fillStyle,lineWidth:i.lineWidth,strokeStyle:i.boxBorderStroke,strokeWidth:i.lineWidth}}:null},i._primitiveTemplateCache=new ou(30),i.SelectedZIndex=11100,i.AlternateZIndex=11e3,i.fillStyle="#ECECEC",i.selectedFillStyle="#FFFFFF",i.lineWidth=1,i.boxBorderStroke="rgba(118, 118, 118, 0.3)",i.modeStrokeStyle="#767676",i.modeFillStyle="#767676",i.lowTrafficHighlightColor="#006D21",i.mediumTrafficHighlightColor="#BB5D00",i.heavyTrafficHighlightColor="#C80000",i.defaultHighlightColor="#767676",i.defaultTextColor="#111111",i.textFont="Arial",i.shadowColor="#BBB",i.shadowBlur=4,i.shadowOffset=new y(0,2),i.beakHeight=6,i.beakWidth=12,i.infoboxCurveAdjustment=9,i.timeTextSize=9,i.distanceTextSize=8,i.spacerWidth=12,i.iconWidth=18,i.singleLineHeight=22,i.doubleLineHeight=33,i.boxBuffer=15,i.upInfoboxPath="M{start} l-{halfBeakWd},{beakHt} l-{halfBeakWd},-{beakHt} h-{beakSideHalfWidth} c-2.2,0-4-1.8-4-4 v-{height} c0-2.2,1.8-4,4-4 h{width} c2.2,0,4,1.8,4,4 v{height} c0,2.2-1.8,4-4,4 h-{beakSideHalfWidth} z",i.downInfoboxPath="M{start} l{halfBeakWd},-{beakHt} l{halfBeakWd},{beakHt} h{beakSideHalfWidth} c2.2,0,4,1.8,4,4 v{height} c0,2.2-1.8,4-4,4 h-{width} c-2.2,0-4-1.8-4-4 v-{height} c0-2.2,1.8-4,4-4 H{beakSideHalfWidth} z",i.rightInfoboxPath="M{start} l-{halfBeakWd},-{beakHt} l{halfBeakWd}-{beakHt} v-{beakSideHalfHeight} c0-2.2,1.8-4,4-4 h{width} c2.2,0,4,1.8,4,4 v{height} c0,2.2-1.8,4-4,4 h-{width} c-2.2,0-4-1.8-4-4 v-{beakSideHalfHeight} z",i.leftInfoboxPath="M{start} l{halfBeakWd},{beakHt} l-{halfBeakWd},{beakHt} v{beakSideHalfHeight} c0,2.2-1.8,4-4,4 h-{width} c-2.2,0-4-1.8-4-4 v-{height} c0-2.2,1.8-4,4-4 h{width} c2.2,0,4,1.8,4,4 v{beakSideHalfHeight} z",i.drivingModePath="M14.6,6l-0.7,0.7l-0.7-2.9c-0.1-0.4-0.5-0.8-1-0.8H3.8c-0.5,0-0.9,0.3-1,0.8L2.1,6.7L1.4,6H0v1h1l0.5,0.6 L1,9c0,0.1,0,4,0,4c0,0.6,0.4,1,1,1h1c0.6,0,1-0.4,1-1h8c0,0.6,0.4,1,1,1h1c0.6,0,1-0.4,1-1V9c0-0.1-0.5-1.3-0.5-1.4L15,7h1V6H14.6z  M4,10c-0.6,0-1-0.4-1-1c0-0.6,0.4-1,1-1c0.6,0,1,0.4,1,1c0,0.3-0.1,0.5-0.3,0.7C4.5,9.9,4.3,10,4,10z M5,12l1-2h4l1,2H5z M12,10 c-0.6,0-1-0.4-1-1c0-0.6,0.4-1,1-1c0.6,0,1,0.4,1,1c0,0.3-0.1,0.5-0.3,0.7C12.5,9.9,12.3,10,12,10z M3,7l0.7-2.6 C3.7,4.2,3.9,4,4.1,4h7.7c0.2,0,0.4,0.2,0.5,0.4L13,7H3z",i.transitModePath="M15,4v2h-1v8c0,0.1,0,0.3-0.1,0.4c-0.1,0.2-0.3,0.4-0.5,0.5C13.3,15,13.1,15,13,15h-1c-0.1,0-0.3,0-0.4-0.1 c-0.2-0.1-0.4-0.3-0.5-0.5C11,14.3,11,14.1,11,14H4c0,0.1,0,0.3-0.1,0.4c-0.1,0.2-0.3,0.4-0.5,0.5C3.3,15,3.1,15,3,15H2 c-0.1,0-0.3,0-0.4-0.1c-0.2-0.1-0.4-0.3-0.5-0.5C1,14.3,1,14.1,1,14V6H0V4h1V1.5c0-0.2,0-0.4,0.1-0.6C1.3,0.4,1.9,0,2.5,0h10 c0.2,0,0.4,0,0.6,0.1C13.6,0.3,14,0.9,14,1.5V4H15z M2,8h5V4H2V8z M13,12H2v1h11V12z M4,10.5C4,10.2,3.8,10,3.5,10 c-0.1,0-0.3,0.1-0.3,0.1C3.1,10.2,3,10.4,3,10.5V11h1V10.5z M13,4H8v4h5V4z M12,11v-0.5c0-0.3-0.2-0.5-0.5-0.5S11,10.2,11,10.5V11 H12z",i.walkingModePath="M13.5,6c-0.1-0.3-0.3-0.5-0.6-0.6c-0.1-0.1-0.3-0.1-0.4-0.1h-1.6l-0.8-0.8C9.7,4.2,9.3,3.9,8.7,3.8L6.1,3.2  H5.6c-0.3,0-0.7,0.1-1,0.2L3,4.2C2.8,4.3,2.7,4.5,2.6,4.6C2.5,4.8,2.4,5,2.4,5.2V8c0,0.1,0,0.3,0.1,0.4C2.7,9,3.3,9.2,3.9,9  c0,0,0,0,0,0C4,8.9,4.1,8.9,4.2,8.8c0.1-0.1,0.2-0.2,0.2-0.3C4.5,8.3,4.5,8.1,4.5,8V5.9l1-0.5c-0.2,1-0.5,2.1-0.7,3.1  s-0.5,2.1-0.7,3.1c-0.1,0.5-0.2,1-0.3,1.5c-0.1,0.5-0.2,1-0.3,1.5c0,0.1,0,0.1,0,0.2c0,0.1,0,0.3,0.1,0.4c0.1,0.1,0.1,0.2,0.2,0.3  c0.1,0.1,0.2,0.2,0.3,0.2C4.3,16,4.4,16,4.5,16c0.2,0,0.5-0.1,0.7-0.2c0.2-0.2,0.3-0.4,0.4-0.6c0.1-0.3,0.1-0.5,0.2-0.8  s0.1-0.5,0.2-0.8l0.7-3l2.2,2.2v2.1c0,0.1,0,0.3,0.1,0.4c0.2,0.5,0.9,0.8,1.4,0.6c0,0,0,0,0,0c0.1-0.1,0.2-0.1,0.3-0.2  c0.1-0.1,0.2-0.2,0.2-0.3c0.1-0.1,0.1-0.3,0.1-0.4v-2.8c0-0.1,0-0.3-0.1-0.4c-0.1-0.1-0.1-0.2-0.2-0.3L8.2,9l0.6-2.6l0.4,0.4  l0.4,0.4c0.1,0.1,0.2,0.2,0.3,0.2c0.1,0.1,0.3,0.1,0.4,0.1h2.2c0.1,0,0.3,0,0.4-0.1c0.1-0.1,0.2-0.1,0.3-0.2  C13.6,6.9,13.7,6.4,13.5,6L13.5,6z M7.1,2.7C7.3,2.9,7.5,3,7.6,3.1c0.4,0.2,0.8,0.2,1.2,0c0.4-0.2,0.7-0.5,0.9-0.9  c0.2-0.4,0.2-0.8,0-1.2C9.6,0.6,9.3,0.3,8.9,0.1C8.5,0,8,0,7.6,0.1C7.3,0.3,6.9,0.6,6.8,1c-0.2,0.4-0.2,0.8,0,1.2  C6.9,2.4,7,2.6,7.1,2.7z",i.trainModePath="M14.7,16h-1.4l-2-2H4.7l-2,2H1.3l2-2c-0.2,0-0.4-0.1-0.5-0.2c-0.2-0.1-0.3-0.2-0.4-0.3 c-0.1-0.1-0.2-0.3-0.3-0.5C2,12.8,2,12.7,2,12.5v-11c0-0.2,0-0.4,0.1-0.6c0.1-0.4,0.4-0.6,0.8-0.8C3.1,0,3.3,0,3.5,0h9 c0.2,0,0.4,0,0.6,0.1c0.2,0.1,0.3,0.2,0.5,0.3c0.1,0.1,0.2,0.3,0.3,0.5C14,1.1,14,1.3,14,1.5v11c0,0.2,0,0.4-0.1,0.5 c-0.1,0.2-0.2,0.3-0.3,0.5c-0.1,0.1-0.3,0.2-0.4,0.3c-0.2,0.1-0.3,0.2-0.5,0.2L14.7,16z M13,9V5H3v4H13z M4.5,12 C4.8,12,5,11.8,5,11.5S4.8,11,4.5,11S4,11.2,4,11.5C4,11.8,4.2,12,4.5,12z M6,3h4V2H6V3z M11.5,12c0.3,0,0.5-0.2,0.5-0.5 S11.8,11,11.5,11S11,11.2,11,11.5C11,11.8,11.2,12,11.5,12z",i.ferryModePath="M13.8,13H15v1h-1.7c-0.1,0.1-0.1,0.3-0.2,0.4c-0.1,0.1-0.2,0.2-0.3,0.3c-0.1,0.1-0.2,0.2-0.4,0.2 C12.3,15,12.1,15,12,15c-0.2,0-0.4,0-0.6-0.1c-0.1,0-0.3-0.1-0.4-0.2c-0.1-0.1-0.2-0.2-0.3-0.2c-0.1-0.1-0.2-0.2-0.3-0.2 c-0.1-0.1-0.2-0.1-0.3-0.2c-0.2-0.1-0.5-0.1-0.7,0c-0.1,0-0.2,0.1-0.3,0.2c-0.1,0.1-0.2,0.1-0.3,0.2c-0.1,0.1-0.2,0.2-0.3,0.2 c-0.1,0.1-0.3,0.1-0.4,0.2C7.9,15,7.7,15,7.5,15c-0.2,0-0.4,0-0.6-0.1c-0.1,0-0.3-0.1-0.4-0.2c-0.1-0.1-0.2-0.1-0.3-0.2 c-0.1-0.1-0.2-0.2-0.3-0.2c-0.1-0.1-0.2-0.1-0.3-0.2c-0.2-0.1-0.5-0.1-0.7,0c-0.1,0.1-0.2,0.1-0.3,0.2c-0.1,0.1-0.2,0.2-0.3,0.2 c-0.1,0.1-0.2,0.2-0.3,0.2c-0.1,0.1-0.3,0.1-0.4,0.2C3.4,15,3.2,15,3,15c-0.2,0-0.3,0-0.4-0.1c-0.1-0.1-0.2-0.1-0.4-0.2 c-0.1-0.1-0.2-0.2-0.3-0.3c-0.1-0.1-0.2-0.2-0.2-0.4l0,0L0,14v-1h1.2L0,10.6V9.4l2-0.7V5h1.2l1-2H6V1h3v2h1.8l1,2H13v3.7l2,0.7v1.2 L13.8,13z M12,8.4V6H3v2.4l4.5-1.5L12,8.4z M7,3h1V2H7V3z",i.moreModePath="M10.7,1.3C10.5,1.1,10.3,1,10,1S9.5,1.1,9.3,1.3S9,1.7,9,2\ts0.1,0.5,0.3,0.7S9.7,3,10,3s0.5-0.1,0.7-0.3S11,2.3,11,2S10.9,1.5,10.7,1.3z M2,1C1.7,1,1.5,1.1,1.3,1.3S1,1.7,1,2s0.1,0.5,0.3,0.7\tS1.7,3,2,3s0.5-0.1,0.7-0.3S3,2.3,3,2S2.9,1.5,2.7,1.3S2.3,1,2,1z M6,1C5.7,1,5.5,1.1,5.3,1.3S5,1.7,5,2s0.1,0.5,0.3,0.7S5.7,3,6,3\ts0.5-0.1,0.7-0.3S7,2.3,7,2S6.9,1.5,6.7,1.3S6.3,1,6,1z",i.spacerPath="m2 1 l6 6 l-6 6 h-2 l6-6 l-6-6 z",i}(ti),af=function(t){function i(i){var r=this,u={};return r=t.call(this,u,i,ff)||this,r._zIndexLabelSelected=999,r._zIndexLabelNotSelected=998,u.defineProperty("isSelected",function(n,t){return r._onSelectionChanged(n,t)},null,{defaultValue:!1}),u.defineProperty("labelRootClass",null,null,{defaultValue:"labelOverlay"}),u.defineProperty("distanceText",null,null,{defaultValue:""}),u.defineProperty("timeText",null,null,{defaultValue:""}),u.defineProperty("zIndex",null,null,{defaultValue:998}),r.resources=n,r}return p(i,t),i.prototype._onSelectionChanged=function(n,t){if(n!==t){var i=t?this._zIndexLabelSelected:this._zIndexLabelNotSelected;this.setZIndex(i)}},i}(ut),vf=function(n){function t(t){var i=this,r=new b(0,0),u=new y(23,15);return i=n.call(this,null,r,u)||this,i._overlayViewModel=new af(t),i.setOverlayElement(i._overlayViewModel.getControl()),i}return p(t,n),t.prototype.setIsSelected=function(n){this._overlayViewModel.setIsSelected(n);var t=n?"labelOverlay selected":"labelOverlay";this._overlayViewModel.setLabelRootClass(t)},t.prototype.setMessage=function(n,t){this._overlayViewModel.setTimeText(n);this._overlayViewModel.setDistanceText(t)},t}(ur),di;(function(n){n[n.none=0]="none";n[n.minimizeHighways=1]="minimizeHighways";n[n.minimizeToll=2]="minimizeToll";n[n.avoidHighways=4]="avoidHighways";n[n.avoidToll=8]="avoidToll";n[n.avoidExpressTrain=16]="avoidExpressTrain";n[n.avoidAirline=32]="avoidAirline";n[n.avoidBulletTrain=64]="avoidBulletTrain";n[n.avoidFerry=128]="avoidFerry"})(di||(di={}));var yf=function(n){function t(t){var i=n.call(this)||this;return i.type=a.directionsFlipTask,i._controlTemplateFactory=t,i.displayState={colorIndex:0,groupName:"Directions"},i}return p(t,n),t.prototype.activate=function(t,i){n.prototype.activate.call(this,t,i);i&&i.incident&&(this._taskState=i,this.setIncident(i.incident));this.parentTaskId=i&&i.parentId},t.prototype.getIconColorAndClassName=function(n){n("#227AB0","directionsFlipTask")},t.prototype.deactivate=function(){var t={requestorType:"DirectionsFlipTask",requestorId:this.id,type:a.directionsTask,requestState:{action:6},taskId:this.parentTaskId};l.invokeHandler(c.taskProcessDataHandlerKey,t);n.prototype.deactivate.call(this)},t.prototype.processCallback=function(){},t.prototype.process=function(n){var t=n.requestState,i;t.incident&&(this._taskState=t,this.setIncident(t.incident),i={activationState:1,prominence:1},this.setDisplayState(i))},t.prototype.setIncident=function(){this.setTitle(this._taskState.incident.description);this._viewModel&&this._viewModel.dispose();var n=this._viewModel=new kf(this._controlTemplateFactory,this._taskState.incident,this.map,this.id);this.addControl(n.getControl());lr&&lr.saveIncident(this._taskState.incident)},t.prototype.serialize=function(){return this._taskState},t.prototype.setDisplayState=function(t){if(n.prototype.setDisplayState.call(this,t),this.displayState.activationState===1&&this.displayState.prominence===1){var i={requestorType:"DirectionsFlipTask",requestorId:this.id,type:a.directionsTask,requestState:{action:5},taskId:this.parentTaskId};l.invokeHandler(c.taskProcessDataHandlerKey,i)}},t.prototype.getMenuList=function(){return[]},t.prototype.getCardIconInfo=function(){return{iconClass:"trfkTsk"}},t.prototype.isSharable=function(){return!1},t.prototype.hasDefaultFocusElement=function(){return!0},t}(gi),pf=function(n){function t(t,i,r,u,f,e){var o=this,h={},s;return o=n.call(this,h)||this,h.defineProperty("showInstructions",null,null,{defaultValue:!0}),o.instructionSteps=i,o.legTitle=r,o.index=f,o.timeDistanceText=u,o.showLegTitle=!1,s="dirLeg",o.legClassName=t&&t.displayManeuverIcons===!1?s+" hideManeuver":s,o.legInstructionsClassName="dirInstructions",o.legItemsLocations=[],e>1&&(o.showLegTitle=!0,o.legClassName+=" nLegs",o.legClassName+=f==0?" firstLeg":f==e-1?" lastLeg":"",o.legInstructionsClassName+=" nLegs",o.instructionSteps.forEach(function(n){o.legItemsLocations.push(n.location)})),o}return p(t,n),t}(ut),wf=function(n){function t(){var t=this,i={};return t=n.call(this,i)||this,i.defineProperty("showResults"),t.setShowResults(!1),t}return p(t,n),t}(ut),bf=function(t){function i(i){var r=this,u={};return r=t.call(this,u)||this,u.defineProperty("isSelected",function(n,t){return r._onSelectionChanged(n,t)}),u.defineProperty("trafficConditionClassName"),u.defineProperty("trafficConditionTimeClassName"),r._parentViewModelSet=i,r.resources=n,r}return p(i,t),i.prototype.onResultsTitleClick=function(n){n.preventDefault();this.index!==this._parentViewModelSet.getRouteSelected()&&(this._parentViewModelSet.select(this.index,!1),w.logInstrumentationEvent(v.ARC,{I:this.index}));this.routeMode=this._parentViewModelSet.getRouteMode(this.index)},i.prototype.setTrafficCondition=function(t){t==="Heavy"?(this.trafficCondition=n.L_Directions_Heavy_Traffic,this._trafficConditionClassName="traffic heavy",this._trafficConditionTimeClassName="drDurationTable heavy"):t==="Medium"?(this.trafficCondition=n.L_Directions_Moderate_Traffic,this._trafficConditionClassName="traffic moderate",this._trafficConditionTimeClassName="drDurationTable moderate"):(this.trafficCondition=n.L_Directions_Light_Traffic,this._trafficConditionClassName="traffic light",this._trafficConditionTimeClassName="drDurationTable light");this.setTrafficConditionClassName(this._trafficConditionClassName);this.setTrafficConditionTimeClassName(this._trafficConditionTimeClassName)},i.prototype._onSelectionChanged=function(n,t){n!==t&&(t?this.setTrafficConditionClassName(this._trafficConditionClassName+" selected"):this.setTrafficConditionClassName(this._trafficConditionClassName))},i}(ut),kf=function(n){function t(t,i,r,u){var f=n.call(this,t,i,r)||this;return f._taskId=u,f}return p(t,n),t.prototype.onBackClick=function(n){n.preventDefault();var t={action:"remove",id:this._taskId};l.invokeHandler(c.taskDataHandlerKey,t)},t.prototype.updateUrlInstrumentation=function(n){return n+t._intrumentParam},t._intrumentParam="&routeCamera=1",t}(du),si=function(r){function u(u,f){var e=this,o={};return e=r.call(this,o)||this,o.defineProperty("btnClass"),o.defineProperty("ariaPressed"),e.supportViaPoint=!0,u===t.driving?(e.maxWaypoints=i.maxDriveWaypoints,e.tooltip=n.L_Directions_Title_Drive):u===t.transit?(e.maxWaypoints=i.maxTransitWaypoints,e.tooltip=n.L_Directions_Title_Transit,e.supportViaPoint=!1):u===t.walking?(e.maxWaypoints=i.maxWalkWaypoints,e.tooltip=n.L_Directions_Title_Walk):u===t.truck&&(e.maxWaypoints=i.maxDriveWaypoints),e.mode=u,e.modeName=f,e.enabled=!1,e}return p(u,r),u}(rr);k.DefaultDirectionsFormattedTextProvider=ei;k.DirectionsInputData=yt;k.DirectionsPanelViewModel=g.isMobile?pr:vi;k.DirectionsPolyline=oi;k.DirectionsPushpin=wt;k.DirectionsResultsSetViewModel=g.isMobile?kr:pi;k.DirectionsTask=ot;k.DirectionsFlipTask=yf;k.DirectionsTemplateSelector=wi;k.Optimize=rt;k.RouteResultsDataModel=yr;k.TransitDirectionsFormattedTextProvider=br;k.WaypointViewModel=vr;k.WalkingDirectionsFormattedTextProvider=yi;k.DirectionsResultsPanelTemplate=ar;k.RouteAvoidance=di;k.DistanceUnit=ct;k.RouteErrorType=f}catch(dr){if(r.logger)r.logger.logCriticalError(dr);else throw dr;}}).call(window)