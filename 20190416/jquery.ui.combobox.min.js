(function(b){b.widget("ui.combobox",b.ui.autocomplete,{options:{minLength:1,ajaxGetAll:{get:"all"},selected:function(a,b,c){c.trigger("change")},defaultBarText:"Search...",defaultBtnHoverText:"Show All Items"},_create:function(){if(this.element.is("SELECT"))this._selectInit();else{b.ui.autocomplete.prototype._create.call(this);var a=this.element,d=this.options.defaultBarText;a.val(d);a.addClass("ui-widget ui-widget-content ui-corner-left nav-combobox searchText");a.blur(function(){v=b(this).val();
(""==v||" "==v)&&b(this).val(d);b(this).addClass("searchText")});a.focus(function(){b(this).val("");b(this).removeClass("searchText")});this.button=b("<button type='button'>&nbsp;</button>").attr("tabIndex",-1).attr("title",this.options.defaultBtnHoverText).insertAfter(a).button({icons:{primary:"ui-icon-triangle-1-s"},text:!1}).removeClass("ui-corner-all").addClass("ui-corner-right ui-button-icon nav-combobox-button").click(function(){if(a.combobox("widget").is(":visible"))a.combobox("close");else{var c=
a.data("combobox");clearTimeout(c.closing);a.isFullMenu||(c._swapMenu(),a.isFullMenu=!0);a.combobox("widget").css("display","block").position(b.extend({of:a},c.options.position));a.focus();c._trigger("open")}});b(document).queue(function(){var c=a.data("combobox");b.isArray(c.options.source)?b.ui.combobox.prototype._renderFullMenu.call(c,c.options.source):"string"===typeof c.options.source?b.getJSON(c.options.source,c.options.ajaxGetAll,function(a){b.ui.combobox.prototype._renderFullMenu.call(c,a)}):
b.ui.combobox.prototype._renderFullMenu.call(c,c.source())})}},_renderFullMenu:function(a){var b=this,c=this.element,e=c.data("combobox").menu.element,g=[];e.addClass("ui-ac-combobox");a=this._normalize(a);c.data("combobox").menuAll=c.data("combobox").menu.element.clone(!0).appendTo("body");for(var f=0;f<a.length;f++)g[f]='<li class="ui-menu-item" role="menuitem"><a class="ui-corner-all" tabindex="-1">'+a[f].label+"</a></li>";e.append(g.join(""));this._resizeMenu();setTimeout(function(){b._setupMenuItem.call(b,
e.children("li"),a)},0);c.isFullMenu=!0},_setupMenuItem:function(a,d){for(var c=this,e=a.splice(0,500),g=d.splice(0,500),f=0;f<e.length;f++)b(e[f]).data("item.autocomplete",g[f]).mouseenter(function(a){c.menu.activate(a,b(this))}).mouseleave(function(){c.menu.deactivate()});0<a.length?setTimeout(function(){c._setupMenuItem.call(c,a,d)},0):b(document).dequeue()},_renderItem:function(a,d){var c=d.label.replace(RegExp("(?![^&;]+;)(?!<[^<>]*)("+b.ui.autocomplete.escapeRegex(this.term)+")(?![^<>]*>)(?![^&;]+;)",
"gi"),"<strong>$1</strong>");return b("<li></li>").data("item.autocomplete",d).append("<a>"+c+"</a>").appendTo(a)},destroy:function(){this.element.is("SELECT")?(this.input.remove(),this.element.removeData().show()):(b.ui.autocomplete.prototype.destroy.call(this),this.element.removeClass("ui-widget ui-widget-content ui-corner-left"),this.button.remove())},search:function(a,d){var c=this.element;c.isFullMenu&&(this._swapMenu(),c.isFullMenu=!1);b.ui.autocomplete.prototype.search.call(this,a,d)},_change:function(a){if(!this.selectedItem){var d=
RegExp("^"+b.ui.autocomplete.escapeRegex(this.element.val())+"$","i"),c=b.grep(this.options.source,function(a){return d.test(a.label)});c.length?c[0].option.selected=!0:(this.element.val(this.options.defaultBarText),this.options.selectElement&&this.options.selectElement.val(""))}b.ui.autocomplete.prototype._change.call(this,a)},_swapMenu:function(){var a=this.element.data("combobox"),b=a.menuAll;a.menuAll=a.menu.element.hide();a.menu.element=b},_selectInit:function(){var a=this.element.hide(),d=a.children(":selected"),
d=d.val()?d.text():this.options.defaultBarText;this.options.source=a.children("option[value!='']").map(function(){return{label:b.trim(this.text),option:this}}).toArray();var c=this.options.select,e=this.options.selected;this.options.select=function(b,d){d.item.option.selected=!0;c&&c(b,d,a);e&&e(b,d,a)};this.options.selectElement=a;this.input=b("<input>").insertAfter(a).val(d).combobox(this.options)}})})(jQuery);