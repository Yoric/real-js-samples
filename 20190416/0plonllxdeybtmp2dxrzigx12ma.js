raptor.defineClass("raptor.merch.MerchManager",function(){return{init:function(a){var b=this;b.m=a;b.url=a.url;b.pubsub=raptor.require("pubsub");b.pubsub.subscribe("MERCH_RE_TRIGGER",function(a){b.trigger(a)},this);b.profiler=raptor.require("ebay.profiler.Profiler");b.sbfFlagValue=raptor.require("ebay.cookies").getBitFlag(raptor.require("ebay.cookies").readCookie("ebay","sbf"),20);b.customCallbackHandler?b.pubsub.subscribe("MERCH_INIT",function(){b.sendUrl()},this):b.m.enableOnScroll?(b.scrollHandler=
function(){b.callMerchOnScroll()},$(window).bind("scroll",b.scrollHandler)):$(document).ready(function(){window.setTimeout(function(){b.sendUrl()},0)})},trigger:function(a){this.m=a;this.url=a.url;this.sendUrl()},callMerchOnScroll:function(){var a=this.m.pids,b=this.m.th,c=$(window).scrollTop(),a=$("#merch_html_"+a[0]);if(!("undefined"==typeof a||null==a))if(a=a.offset(),!("undefined"==typeof a||null==a)){var a=a.top,d=$(window).height();a<=c+d+b&&this.sendUrl()}},sendUrl:function(){var a=this.url,
b=encodeURIComponent(window.location.href);this.startTime=(new Date).getTime();b=b.replace(/'/g,"%27");if(a+="&srcUrl="+b)this.getJson(a),this.m.enableOnScroll&&$(window).unbind("scroll",this.scrollHandler)},getJson:function(a){var b=this;window.merchCallBack=function(a){b.render(a)};b.m.loadJsAsync?b.loadJSAsync(a+"&callback=parent.window.merchCallBack"):$.getJSON(a+"&callback=?",function(a){b.render(a)},b)},render:function(a){var b=this.m.merchRaptorEnabled?a:a.data.map;if(this.customCallbackHandler)this.pubsub.publish("MERCH_RESPONSE",
{data:a});else for(var c in b)if(a=b[c]){var d=document.getElementById("merch_html_"+c);d&&("undefined"!=typeof a.html&&""!=a.html)&&(this.loadCss(a.cssUrl),d.style.display="none",d.innerHTML=a.html,d.style.display="block",this.loadJs(a.jsUrl),this.executeScripts(a.html))}this.setSBFFlag();a=(new Date).getTime()-this.startTime;"undefined"!=typeof oGaugeInfo&&this.profiler.addParam("i_5i",a)},executeScripts:function(a){for(var b,c=/<script\b[\s\S]*?>([\s\S]*?)<\/script>/ig;b=c.exec(a);)if(b=b[1]){var d=
this.getHead(),e=this.createScript();e.type="text/javascript";e.text=b;d.appendChild(e)}},setSBFFlag:function(){if(this.sbfFlagValue){var a=raptor.require("ebay.cookies").setBitFlag(raptor.require("ebay.cookies").readCookie("ebay","sbf"),20,this.sbfFlagValue);raptor.require("ebay.cookies").writeCookielet("ebay","sbf",a)}},getHead:function(){return document.getElementsByTagName("head")[0]},createScript:function(){return document.createElement("script")},loadJSAsync:function(a){var b=document.createElement("iframe");
(b.frameElement||b).style.cssText="width: 0; height: 0; border: 0";(b.frameElement||b).src="javascript:false";var c=document.getElementsByTagName("script"),c=c[c.length-1];c.parentNode.insertBefore(b,c);b=b.contentWindow.document;b.open().write("<body onload=\"var js = document.createElement('script');js.src = '"+a+"';document.body.appendChild(js);\">");b.close()},loadCss:function(a){if(!("undefined"===typeof a||!a||0===a.length))for(var b=0;b<a.length;b++)$("head").append($("<link/>").attr({type:"text/css",
rel:"stylesheet",href:a[b]}))},loadJs:function(a){if(!("undefined"===typeof a||!a||0===a.length))for(var b=0;b<a.length;b++)$.ajax({type:"GET",url:a[b],success:function(){},dataType:"script",cache:!0})}}});raptor.defineClass("ebay.viewItem.Scandal",function(){var b=0;return{init:function(a){this.cfg=a;this.adsMap=a.adsMap;this.cfg&&this.cfg.collapseEmptyAdsAfterFetchCall&&(this.cfg.emptyAvipLeaderBoard&&$("#scandal100938").hide(),this.cfg.emptyCvipLeaderBoard&&$("#scandal100939").hide());this.adsMap&&this.callAds(this.adsMap)},callAds:function(a){try{for(var c={},b=this.cfg&&this.cfg.adsPbPids?this.cfg.adsPbPids:[100562,100563,100564,100565,100566,100567,100568,100610,100916,100917,100918,100919,100920,
100921,100922,100923,100938,100939,100726,100727],d=0;d<b.length;d++){var e=b[d];this.isAdAvailable(e)&&(c[e]=a[e].ad)}window.scandalAds=window.scandalAds||[];window.scandalAds.push(c)}catch(f){}},trackingParams:function(a){a&&a.scandal_dur&&(b+=parseInt(a.scandal_dur));if("undefined"!==typeof $trk&&$trk.image&&$trk.onRover){var c=$trk.image;$trk.image=jQuery("<img/>").css("display","none");$trk.onRover(null,a);$trk.image=c}raptor.require("ebay.profiler.Profiler").addParam("i_13i",b)},getPubTypeForAd:function(a){return 0<=
a&&this.cfg&&this.cfg.adsPbType&&a<this.cfg.adsPbType.length&&this.cfg.adsPbType[a]?this.cfg.adsPbType[a]:2},isAdAvailable:function(a){return this.adsMap&&this.adsMap[a]&&this.adsMap[a].ad&&null!==this.adsMap[a].ad.ad?!0:!1}}});