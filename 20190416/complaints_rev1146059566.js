define(["jquery","client-server","util/find-event-target"],function(a,b,c){var d="complaint",e={user:36,micropost:7,connect:12,photo:13,app_event:24,friendship:36,multipost:29,dialogues:10},f=!1;return{onBrowserEvent:function(a){var b,e=c(a,'[type="complaint"]');return f===!1&&(f=!0,setTimeout(function(){f=!1}.bind(this),1e3),e&&e.attr("type")===d&&(e.addClass("progress"),e.attr("type",""),b=this.add(this.parseElement(e)),b.done(function(){e.removeClass("progress").addClass("done"),e=null}).fail(function(){e.attr("type",d),e.removeClass("progress"),e=null}))),b},checkType:function(b){return a.isNumeric(b)||(b=e[b]),b},parseElement:function(a){var b={journalUser:a.attr("data-complaint-juser"),disturber:a.attr("data-complaint-disturber"),type:window.parseInt(a.attr("data-complaint-type")),objectid:a.attr("data-complaint-objectid"),mustdie:a.attr("data-complaint-delete")};return"undefined"!==a.attr("data-complaint-parentid")&&(b.parentid=a.attr("data-complaint-parentid")),"undefined"!==a.attr("data-complaint-hid")&&(b.hid=a.attr("data-complaint-hid")),b},add:function(c){var d=a.Deferred(),e="/cgi-bin/my/ajax";return c.type=this.checkType(c.type),c.journalUser&&(e+="?user="+c.journalUser),b.func("mras.complaint",c,{url:e,type:"POST",context:this,success:function(a){a=JSON.parse(a),a&&"ok"===a[2]?d.resolve(a):d.reject(a)},error:function(){d.reject()}}),d.promise()}}});