(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{"1a03":function(e,t,i){var s=i("1029"),a=i("d869"),n=i("5f9e"),r=function(e,t){r.superclass.constructor.call(this,e,t)};e.exports=Ext.extend(r,s.Component,{name:"FirstBill",getSecureFrameRoute:"FirstBillOverlay/GetIframeUrl",isIframeLoadedRoute:"FirstBillOverlay/IsIframeLoaded",getPaymentStatusRoute:"FirstBillOverlay/GetPurchaseStatus",getDeclinedBlockRoute:"FirstBillOverlay/GetDeclinedBlock",secureIframeCheckAjaxTimeout:5e3,maxIframeLoadCheckNumber:3,iframeLoadCheckRetryTimeout:1e3,checkPaymentTimeouts:{},startAutoCheck:!1,storedToken:void 0,getSecureFrameRouteQueryParams:{},_selectedCreditValue:void 0,_iframeToken:void 0,_temporaryToken:void 0,_iframeLoadCheckRetryCounter:0,_delayedIframeLoadCheckTask:void 0,_checkPaymentTimeouts:{standard:1e3,prolonged:3e4},_checkPaymentStatusDelayedTask:void 0,_setProlongedTimeoutToCheckPaymentStatusTask:void 0,_checkPaymentTimeout:void 0,init:function(e,t){r.superclass.init.call(this,e,t),this.addEvents(a.FirstBill.EVENT_SUBMIT_SUCCESS,a.FirstBill.EVENT_SUBMIT_ERROR,a.FirstBill.EVENT_SUBMIT_FAILURE,a.FirstBill.EVENT_PAYMENT_PENDING,a.FirstBill.EVENT_PAYMENT_APPROVED,a.FirstBill.EVENT_PAYMENT_DECLINE,a.FirstBill.EVENT_PAYMENT_STATUS_UNKNOWN,a.FirstBill.EVENT_GET_SECURE_FRAME_SRC_SUCCESS,a.FirstBill.EVENT_IFRAME_READY,a.FirstBill.EVENT_GET_DECLINE_BLOCK,a.FirstBill.EVENT_GET_DECLINE_BLOCK_SUCCESS,a.FirstBill.EVENT_GET_DECLINE_BLOCK_ERROR,a.FirstBill.GLOBALEVENT_FIRSTBILL_DECLINED),Ext.apply(this._checkPaymentTimeouts,this.checkPaymentTimeouts),this._checkPaymentTimeout=this._checkPaymentTimeouts.standard,this.startAutoCheck&&this.storedToken&&(this.setIframeToken(this.storedToken),this.startCheckPaymentStatus())},setSelectedPackage:function(e){if(e&&e instanceof Ext.Element)return this._setSelectedCreditValue(this._getCreditValueFromSelectedPackage(e))},getSelectedCreditValue:function(){return this._selectedCreditValue},_getCreditValueFromSelectedPackage:function(e){return e.getAttribute("data-package-name")},_setSelectedCreditValue:function(e){return this._selectedCreditValue=e},getSecureFrameSrc:function(){n.request({method:"POST",type:"json",scope:this,url:this.getSecureFrameUrl(),params:{selectedPackageId:this.getSelectedCreditValue()},success:this._getSecureFrameSrcSuccess,error:this._getSecureFrameSrcError,failure:this._getSecureFrameSrcFailure})},getSecureFrameUrl:function(){return s.getUrl(this.getSecureFrameRoute,{},this.getSecureFrameRouteQueryParams)},_getSecureFrameSrcSuccess:function(e){this._resetIframeLoadCheckRertyCounter(),this._temporaryToken=e.json.data.token,this.fireEvent(a.FirstBill.EVENT_GET_SECURE_FRAME_SRC_SUCCESS,{scope:this,response:e})},setIframeToken:function(e){this._iframeToken=e},getIframeToken:function(){return this._iframeToken},_getSecureFrameSrcError:function(e){this._redirectToSecurePage()},_getSecureFrameSrcFailure:function(e){this._redirectToSecurePage()},getCheckIframeAjaxUrl:function(){return s.getUrl(this.isIframeLoadedRoute,{},{token:this._temporaryToken})},checkIsIframeLoaded:function(){this._delayedIframeLoadCheckTask instanceof Ext.util.DelayedTask?this._delayedIframeLoadCheckTask.delay(this.iframeLoadCheckRetryTimeout):this._delayedIframeLoadCheckTask=new Ext.util.DelayedTask(function(){this.checkIsIframeLoaded()},this),n.request({method:"POST",type:"json",scope:this,timeout:this.secureIframeCheckAjaxTimeout,url:this.getCheckIframeAjaxUrl(),isUnsecuredUrl:!0,params:{token:this._temporaryToken},success:this._isIframeLoadedSuccess,error:this._isIframeLoadedError,failure:this._isIframeLoadedFailure})},_isIframeLoadedSuccess:function(e){this._isIframeLoaded(e)},_isIframeLoadedError:function(){this._delayedIframeLoadCheckTask.cancel(),this._retryIframeLoadCheck()},_isIframeLoadedFailure:function(){this._delayedIframeLoadCheckTask.cancel(),this._redirectToSecurePage()},_isIframeLoaded:function(e){e.json.data.isLoaded?(this._delayedIframeLoadCheckTask.cancel(),this.fireEvent(a.FirstBill.EVENT_IFRAME_READY,{scope:this})):this._retryIframeLoadCheck()},_retryIframeLoadCheck:function(){this._increaseIframeLoadCheckRetryCounter(),this.getIframeLoadCheckRertyCounter()<this.maxIframeLoadCheckNumber?this._delayedIframeLoadCheckTask&&this._delayedIframeLoadCheckTask.delay(this.iframeLoadCheckRetryTimeout):this._redirectToSecurePage()},getIframeLoadCheckRertyCounter:function(){return this._iframeLoadCheckRetryCounter},_increaseIframeLoadCheckRetryCounter:function(){return this._iframeLoadCheckRetryCounter++},_resetIframeLoadCheckRertyCounter:function(){return this._iframeLoadCheckRetryCounter=0},_redirectToSecurePage:function(){location.href=s.getUrl("Credit/Index",{},{redirect:1})},restartPaymentWithAnotherPackage:function(){return new Promise(s.bind(function(e,t){n.request({method:"POST",type:"json",scope:this,url:s.getUrl("Payment/BuySmallerPackage",{},{}),params:{selectedPackageId:this.getSelectedCreditValue()},success:function(i){i.json.data?e(i.json.data):t(new Error("Empty response"))},error:t,failure:t})},this))},startCheckPaymentStatus:function(){s.isUndefined(this._paymentStatusCheckStartTime)&&(this._paymentStatusCheckStartTime=(new Date).getTime()),this._checkPaymentStatusDelayedTask instanceof Ext.util.DelayedTask||(this._checkPaymentStatusDelayedTask=new Ext.util.DelayedTask(this.checkPaymentStatus,this)),this._checkPaymentStatusDelayedTask.delay(this._checkPaymentTimeout),this._setProlongedTimeoutToCheckPaymentStatusTask instanceof Ext.util.DelayedTask||(this._setProlongedTimeoutToCheckPaymentStatusTask=new Ext.util.DelayedTask(function(){this._checkPaymentTimeout=this._checkPaymentTimeouts.prolonged},this),this._setProlongedTimeoutToCheckPaymentStatusTask.delay(this._checkPaymentTimeouts.prolonged))},stopCheckPaymentStatus:function(){this._checkPaymentStatusDelayedTask.cancel(),delete this._checkPaymentStatusDelayedTask,this._setProlongedTimeoutToCheckPaymentStatusTask.cancel(),delete this._setProlongedTimeoutToCheckPaymentStatusTask,delete this._paymentStatusCheckStartTime},_getCurrentCheckPaymentTimeout:function(){return this._checkPaymentTimeout},checkPaymentStatus:function(){n.request({method:"GET",type:"json",scope:this,url:this.getCheckPaymentStatusUrl(),success:this._checkPaymentStatusSuccess,error:this._checkPaymentStatusError,failure:this._checkPaymentStatusFailure})},getCheckPaymentStatusUrl:function(){return s.getUrl(this.getPaymentStatusRoute,{},{token:this.getIframeToken()})},getDeclinedBlock:function(e){n.request({method:"POST",type:"json",scope:this,url:this.getDeclinedBlockUrl(),params:e||{},success:this._getDeclinedBlockSuccess,error:this._getDeclinedBlockError,failure:this._getDeclinedBlockError}),this.fireEvent(a.FirstBill.EVENT_GET_DECLINE_BLOCK,{scope:this})},getDeclinedBlockUrl:function(){return s.getUrl(this.getDeclinedBlockRoute)},_getDeclinedBlockSuccess:function(e){this.fireEvent(a.FirstBill.EVENT_GET_DECLINE_BLOCK_SUCCESS,{scope:this,response:e})},_getDeclinedBlockError:function(e){this.fireEvent(a.FirstBill.EVENT_GET_DECLINE_BLOCK_ERROR,{scope:this,response:e})},_checkPaymentStatusSuccess:function(e){this._checkCurrentPaymentStatus(e)},_checkPaymentStatusError:function(e){},_checkPaymentStatusFailure:function(e){},_checkCurrentPaymentStatus:function(e){switch(e.json.data.status){case a.FirstBill.PAYMENT_STATUS_APPROVED:this._manageStatusApproved(e);break;case a.FirstBill.PAYMENT_STATUS_DECLINED:this._manageStatusDeclined(e);break;case a.FirstBill.PAYMENT_STATUS_UNKNOWN:this._manageStatusUnknown(e);break;case a.FirstBill.PAYMENT_STATUS_PENDING:default:this.fireEvent(a.FirstBill.EVENT_PAYMENT_PENDING,{scope:this}),this._manageStatusPending(e)}},_getTransactionTime:function(){return(new Date).getTime()-this._paymentStatusCheckStartTime},_manageStatusApproved:function(e){this.fireEvent(a.FirstBill.EVENT_PAYMENT_APPROVED,{scope:this,response:e}),this.stopCheckPaymentStatus()},_manageStatusDeclined:function(e){this.fireEvent(a.FirstBill.EVENT_PAYMENT_DECLINE,{scope:this,response:e}),s.fireEvent(a.FirstBill.GLOBALEVENT_FIRSTBILL_DECLINED,{scope:this}),this.stopCheckPaymentStatus()},_manageStatusPending:function(e){this.startCheckPaymentStatus()},_manageStatusUnknown:function(e){this.fireEvent(a.FirstBill.EVENT_PAYMENT_STATUS_UNKNOWN,{scope:this,response:e}),this.stopCheckPaymentStatus()},unbind:function(){r.superclass.unbind.call(this),this._delayedIframeLoadCheckTask&&(this._delayedIframeLoadCheckTask.cancel(),delete this._delayedIframeLoadCheckTask)}})},a5c5:function(e,t,i){var s=i("1029"),a=i("d869"),n=i("5f9e"),r=i("e9a3"),o=i("1cab").default,l=i("a9a1").store,c=i("839a").openChat,h=i("839a").closeChat,m=i("af42"),u=function(e,t){u.superclass.constructor.call(this,e,t)};e.exports=Ext.extend(u,s.Component,{name:"FirstBillComponent",overlayBlockId:"firstbill",animateDuration:.3,selectedPackageCls:"selected",inactivePackageCls:"inactive",packagesContainerId:"packages_container",creditPackageSel:".package",paymentFormContainerId:"payment_form_holder",commercialPageTemplateClass:".commercial_page_template",secureIFrameIdPrefix:"secure_payment_frame",secureIFrameCls:"secure_payment_frame",firstBillContainerId:"firstbill",isReOpen:!1,isContentNeedLoad:!0,loaderSel:".loader",getInProgressPageRoute:"FirstBillOverlay/GetPendingBlock",getSecureFrameRoute:"FirstBillOverlay/GetIframeUrl",getSecureFrameRouteQueryParams:{},storedToken:"",supportButtonSel:".support_button",disableCloseCls:"disable_close",forcedScrollTopValue:510,getPaymentStatusRoute:"FirstBillOverlay/GetPurchaseStatus",controllerName:r,containerMaskCls:"container_mask",showCls:"show",isShowCommercialPopupEnabled:!0,selectedPackage:"",_firstBillController:null,_secureFrameEl:null,_loaderEl:null,_iFrameLoadingMask:null,init:function(e,t){this.addEvents(a.FirstBillComponent.EVENT_SELECTLIST_ITEM_CLICK,a.FirstBillComponent.EVENT_IFRAME_REMOVE_FROM_DOM,a.FirstBillComponent.EVENT_IFRAME_EMBED,a.FirstBillComponent.EVENT_CHANGE_PAGE,a.FirstBillComponent.GLOBALEVENT_CHANGE_CONTENT,a.FirstBillComponent.EVENT_WINDOW_CLOSE),u.superclass.init.call(this,e,t),this.getElementsToBind(),this._setController(),this._renderSupportChat(),o.trackPaymentPage("/first-bill/packages"),this.isShowCommercialPopupEnabled&&!this.isReOpen&&this.element.addClass(this.disableCloseCls)},_renderSupportChat:function(){l.dispatch(c())},_destroySupportChat:function(){l.dispatch(h())},embedSecureIFrame:function(e){var t=this;return e||console.error("@JS ERROR in ",this.name,": secure iframe src is undefined"),this.removeSecureIFrameFromDOM(),!(this._secureFrameEl instanceof Ext.Element||!Ext.fly(this.overlayBlockId))&&(this._secureFrameEl=Ext.DomHelper.append(this.paymentFormContainerId,{tag:"iframe",id:this.setCurrentIFrameId(),cls:this.secureIFrameCls,src:e,style:this._calculateSecureFormSize(),allowtransparency:!0,scrolling:"no"},!0),this._secureFrameEl.on("load",function(){this.setStyle("visibility","visible"),t.onSecureIFrameLoaded()}),this.fireEvent(a.FirstBillComponent.EVENT_IFRAME_EMBED,{scope:this}),!0)},onSecureIFrameLoaded:function(){o.trackPaymentPage("/first-bill/card-details")},_calculateSecureFormSize:function(){return"width: "+Ext.fly(this.overlayBlockId).getWidth(!1)+"px; height: "+Ext.fly(this.paymentFormContainerId).getStyle("maxHeight")},embedSecureIFrameFailed:function(){console.error("@JS ERROR in ",this.name,": embedSecureIFrameFailed")},displayIFrame:function(){TweenLite.to(Ext.fly(this.paymentFormContainerId).dom,this.animateDuration,{height:Ext.fly(this.paymentFormContainerId).getStyle("maxHeight"),display:"block",visibility:"visible",onComplete:this.scrollToPaymentForm,onCompleteScope:this})},scrollToPaymentForm:function(){this.element&&$(this.element.dom).stop().animate({scrollTop:this.forcedScrollTopValue||this._paymentFormContainerEl.getTop(!1)},this.scrollDuration,"swing")},setPackageSelected:function(e){var t=this;this.refreshCreditPackages(),e&&(this._creditPackages.each(function(){this.addClass(t.inactivePackageCls).removeClass(t.selectedPackageCls)}),e.addClass(this.selectedPackageCls).removeClass(this.inactivePackageCls))},isPackageSelected:function(e){return e instanceof Ext.Element&&e.hasClass(this.selectedPackageCls)},_setAllPackagesUnSelected:function(){var e=this;this._creditPackages.each(function(){this.removeClass(e.inactivePackageCls).removeClass(e.selectedPackageCls)})},_setController:function(){this.controller instanceof this.controllerName?(this.controller.unbind(),this.controller.removeComponent(this.name),delete this.controller,this._setController()):this.controller=new this.controllerName({performerName:this.performerName,selectedPackage:this.selectedPackage,getSecureFrameRoute:this.getSecureFrameRoute,getSecureFrameRouteQueryParams:this.getSecureFrameRouteQueryParams,getPaymentStatusRoute:this.getPaymentStatusRoute,hasContent:this.isContentNeedLoad,reOpen:this.isReOpen,storedToken:this.storedToken,el:this.element,items:{FirstBillComponent:{component:this,listeners:{"iframe-embed":"onIframeEmbed","iframe-remove-from-dom":"onIframeRemoveFromDOM","change-page":"onPageChange","window-close":"onWindowClose"}}}})},getElementsToBind:function(){this._packagesContainerEl=Ext.get(this.packagesContainerId),this._creditPackages=this.element.select(this.creditPackageSel),this._paymentFormContainerEl=Ext.get(this.paymentFormContainerId),this._firstBillContainerEl=Ext.get(this.firstBillContainerId)},hide:function(e,t){this.element.scrollTo("top",0),!this.isShowCommercialPopupEnabled||t?(s.isUndefined(e)&&(e=!0),this.fireEvent(a.FirstBillComponent.EVENT_WINDOW_CLOSE,{scope:this,reopen:e}),this.getElementsToBind()):this.hideElement()},hideElement:function(){TweenLite.to(this.element.dom,this.animateDuration,{alpha:0,onComplete:this._hideElementComplete,onCompleteScope:this})},_hideElementComplete:function(){this.isShowCommercialPopupEnabled&&this._swapContentToCommercialPage()},_swapContentToCommercialPage:function(){this._setAllPackagesUnSelected();var e=this.element.select(this.commercialPageTemplateClass).item(0).dom.innerHTML,t=new Ext.Template(e).apply();t&&this.changePage(t),this.enableShowCommercialPopup(!1)},enableShowCommercialPopup:function(e){this.isShowCommercialPopupEnabled=e},removeSecureIFrameFromDOM:function(){var e=this.getSecureIFrameEl();return!!e&&(e.remove(),delete this._secureFrameEl,this.fireEvent(a.FirstBillComponent.EVENT_IFRAME_REMOVE_FROM_DOM,{scope:this}),!0)},getSecureIFrameEl:function(){if(this.element)return this.element.select("."+this.secureIFrameCls)},getCurrentIFrameId:function(){return this._currentIframeId},setCurrentIFrameId:function(){return this._currentIframeId=s.generateId(this.secureIFrameIdPrefix),this._currentIframeId},showInProgressPage:function(){this._getInProgressHTML(),this.enableShowCommercialPopup(!1)},_getInProgressHTML:function(){this._inProgressHTML?this._inProgressHTML&&this.changePage(this._inProgressHTML):n.request({method:"GET",type:"json",scope:this,url:this.getInProgressPageUrl(),success:this.getInProgressPageSuccess,error:this.getInProgressPageError,failure:this.getInProgressPageError})},getInProgressPageUrl:function(){return s.getUrl(this.getInProgressPageRoute)},getInProgressPageSuccess:function(e){this._inProgressHTML=e.json.data.content,this._inProgressHTML&&this.changePage(this._inProgressHTML)},getInProgressPageError:function(){},changePage:function(e){this.removeSecureIFrameFromDOM(),this._creditPackages=this.element.select(this.creditPackageSel),this._paymentFormContainerEl=Ext.get(this.paymentFormContainerId),this._loaderEl=this.element.select(this.loaderSel).item(0),s.fireEvent(a.FirstBillComponent.GLOBALEVENT_CHANGE_CONTENT,{scope:this,content:e}),this.fireEvent(a.FirstBillComponent.EVENT_CHANGE_PAGE,{scope:this})},displayLoader:function(e){this.element&&this.getLoaderEl().display(e?"block":"none")},getLoaderEl:function(){if(this.element)return this._loaderEl=this.element.select(this.loaderSel).item(0),this._loaderEl},showWindow:function(e){this._unsetElements(),this.renderContent(e),this.getElementsToBind(),this.enableShowCommercialPopup(!0),this.disableScroll(!0),this._setController(),this.show()},_unsetElements:function(){delete this._loaderEl,delete this._secureFrameEl,delete this._packagesContainerEl,delete this._creditPackages,delete this._paymentFormContainerEl,delete this._firstBillContainerEl},showLoadingMask:function(){if(this.element){var e=this.element.select("."+this.containerMaskCls);e&&e.item(0)&&e.item(0).addClass(this.showCls)}},hideLoadingMask:function(){if(this.element){var e=this.element.select("."+this.containerMaskCls);e&&e.item(0)&&e.item(0).removeClass(this.showCls)}},changeSupportButtonLink:function(){var e=this.element.select(this.supportButtonSel);e.getCount()&&(e.item(0).dom.href=a.FirstBillComponent.STATIC_LINK_LIVE_SUPPORT)},onFirstBillDeclined:function(){this.storedToken=""},refreshCreditPackages:function(){this._creditPackages=this.element.select(this.creditPackageSel)},bind:function(){u.superclass.bind.call(this),s.on([{element:s.Broadcaster,event:a.FirstBill.GLOBALEVENT_FIRSTBILL_DECLINED,handler:this.onFirstBillDeclined}],this)},destroy:function(){this._destroySupportChat(),l.dispatch(m.closeFirstBill())},unbind:function(){u.superclass.unbind.call(this),this.controller&&(this.controller.unbind(),this.controller.removeComponent(this.name,!0),delete this.controller)}})},e9a3:function(e,t,i){var s=i("1029"),a=i("d869"),n=i("7ab0"),r=i("1a03"),o=i("0592").default,l=i("99be"),c=i("1cab").default,h=(i("f94d").default,i("a9a1").store),m=i("193d"),u=function(e,t){u.superclass.constructor.call(this,e,t)};e.exports=Ext.extend(u,s.Controller,{name:"FirstBillController",creditPackageSel:".package.firstbill",creditPackageArrowSel:".credit_package_indicator",reOpen:!1,paymentRestartButtonClass:"restart_button",tryAnotherCardLink:".try_another_card",storedToken:void 0,getSecureFrameRoute:"FirstBillOverlay/GetIframeUrl",getSecureFrameRouteQueryParams:{},getPaymentStatusRoute:"FirstBillOverlay/GetPurchaseStatus",_cache:{},selectedPackage:"",smartBuyWasEnabled:null,init:function(e,t){if(u.superclass.init.call(this,e,t),this.setModel(),s.addEvents(a.FirstBillController.GLOBALEVENT_APPROVED_WINDOW_CLOSE,a.FirstBillController.GLOBALEVENT_FIRSTBILL_WINDOW_CLOSE,a.FirstBillController.GLOBALEVENT_FIRSTBILL_COMPLETE,a.FirstBillController.GLOBALEVENT_FIRSTBILL_PAYMENT_APPROVED,a.FirstBillController.GLOBALEVENT_FIRSTBILL_PAYMENT_DECLINED),n.setGlobalMethods("FirstBillController",["firstBillCallback"],this),this.selectedPackage){var i=Ext.select("[data-package-name=package_"+this.selectedPackage+"]").item(0);i&&this.selectPackage(i)}},setModel:function(){this.addComponent({component:new r(this.element,{getSecureFrameRoute:this.getSecureFrameRoute,getSecureFrameRouteQueryParams:this.getSecureFrameRouteQueryParams,getPaymentStatusRoute:this.getPaymentStatusRoute,startAutoCheck:this.reOpen,storedToken:this.storedToken}),listeners:s.object([["payment-pending","onPaymentPending"],["payment-approved","onPaymentApproved"],["payment-decline","onPaymentDecline"],["payment-unknown","onPaymentUnknown"],["get-secure-frame-src-success","onGetSecureFrameSrcSuccess"],["iframe-ready","onIframeReady"],["get-decline-block-success","onGetDeclinedBlockSuccess"]])},"FirstBillModel")},firstBillCallback:function(e,t){Ext.isChrome&&o.setNavigationLevel(-2),this._getCallbackMethod(e,t)},_getCallbackMethod:function(e,t){switch(e){case a.FirstBillController.CALLBACK_METHOD_REDIRECT:location.href=t.redirectUrl;break;case a.FirstBillController.CALLBACK_METHOD_DECLINE:this.FirstBillModel.getDeclinedBlock(t);break;case a.FirstBillController.CALLBACK_METHOD_PROCESSING:t.restart||this.FirstBillComponent.showInProgressPage(),this.FirstBillModel.setIframeToken(t.token),this.FirstBillModel.startCheckPaymentStatus()}},onRestartPaymentWithAnotherPackage:function(e){this._getCallbackMethod(a.FirstBillController.CALLBACK_METHOD_PROCESSING,e)},onRestartPaymentWithAnotherPackageError:function(){this.reOpenFirstBill()},onGetSecureFrameSrcSuccess:function(e){var t=e.response.json.data.url;t&&"string"==typeof t&&""!=t?(t+="?",this.FirstBillComponent.embedSecureIFrame(t)):this.FirstBillComponent.embedSecureIFrameFailed()},onIframeEmbed:function(){this.FirstBillModel.checkIsIframeLoaded()},onIframeRemoveFromDOM:function(e){},onIframeReady:function(e){this.FirstBillComponent.hideLoadingMask(),this.FirstBillComponent.displayLoader(!1)},onPaymentPending:function(){this._isStatusStoredToStorage||(this._isStatusStoredToStorage=l.store(a.FirstBillController.STORAGE_ACTION_NAME,{token:this.FirstBillModel.getIframeToken()}),!0!==this._isStatusStoredToStorage&&console.error("@JS ERROR in ",this.name,": Saving firstbill action failed."))},onPaymentApproved:function(e){var t=s.getPath(e,"response.json.data"),i=parseFloat(t.credit),n="/first-bill/cc_validated";this.smartBuyWasEnabled=t.is_smart_buy_enabled,s.isNumber(i)&&(i>=10&&(n="/first-bill/success"),c.trackPaymentPage(n)),this._checkSendNotificationIsEnabled()?this._manageApprovedCase():this._cacheStatus(this._manageApprovedCase),s.fireEvent(a.FirstBillController.GLOBALEVENT_FIRSTBILL_PAYMENT_APPROVED,{scope:this})},_manageApprovedCase:function(){h.dispatch(m.notifyFirstBillComplete()),this._deleteStorageAction(),s.fireEvent(a.FirstBillController.GLOBALEVENT_FIRSTBILL_COMPLETE,{scope:this});var e="payment/firstBillCompleted";this.smartBuyWasEnabled&&(e="/",this.setSuccessfulTransactionTooltip()),o.navigate(e,{trigger:!0,preventNavigateBack:this.reOpen,replace:!0})},onPaymentDecline:function(e){this._checkSendNotificationIsEnabled()?this._manageDeclinedCase():this._cacheStatus(this._manageDeclinedCase),c.trackPaymentPage("/first-bill/failed"),s.fireEvent(a.FirstBillController.GLOBALEVENT_FIRSTBILL_PAYMENT_DECLINED,{scope:this})},_manageDeclinedCase:function(){h.dispatch(m.notifyFirstBillDecline()),this._deleteStorageAction(),this.FirstBillModel.getDeclinedBlock()},onPaymentUnknown:function(){h.dispatch(m.notifyFirstBillDecline()),this._deleteStorageAction()},onGetDeclinedBlockSuccess:function(e){var t=e.response.json.data.content;if(!this.FirstBillComponent.element&&t)return s.Config.set("payment-issue-content",t),void o.navigate("payment-issue",{trigger:!0,preventNavigateBack:!0});this.FirstBillComponent.changePage(t),this.FirstBillComponent.element.on("click",this.onPaymentSelectButtonClick,this,{delegate:"."+this.paymentRestartButtonClass}),this.FirstBillComponent.enableShowCommercialPopup(!1)},onPackageBoxClick:function(e,t){e.preventDefault();var i=Ext.get(t);"smaller_package"==i.data("type")?this._handleSmallerPackageBoxClick(i):(this.selectPackage(i),this.FirstBillComponent.changeSupportButtonLink())},onPackageBoxArrowClick:function(e,t){var i=Ext.fly(t).next(this.creditPackageSel);this.selectPackage(i)},reOpenFirstBill:function(){setTimeout(function(){o.navigate("payment/retry",{trigger:!0,preventNavigateBack:!0,replace:!0})},0),o.navigateBack()},setSuccessfulTransactionTooltip:function(){s.fireEvent(a.TooltipView.EVENT_SHOW_TOOLTIP,{element:Ext.get("get_credits_link").dom,attributes:{target:!0,autoHide:4e3,title:".transaction_success_tooltip",trigger:"sticky",position:"bottom",size:"small",width:600}})},selectPackage:function(e){this.FirstBillComponent.isPackageSelected(e)||(this.FirstBillComponent.showLoadingMask(),this.FirstBillComponent.setPackageSelected(e),this.FirstBillComponent.displayIFrame(),this.FirstBillComponent.displayLoader(!0),this.FirstBillModel.setSelectedPackage(e),this.FirstBillComponent.removeSecureIFrameFromDOM(),this.FirstBillModel.getSecureFrameSrc())},_handleSmallerPackageBoxClick:function(e){this.FirstBillComponent.isPackageSelected(e)||(this.FirstBillComponent.setPackageSelected(e),this.FirstBillModel.setSelectedPackage(e),this.FirstBillModel.restartPaymentWithAnotherPackage().then(s.bind(this.onRestartPaymentWithAnotherPackage,this)).catch(s.bind(this.onRestartPaymentWithAnotherPackageError,this)),this.FirstBillComponent.showInProgressPage())},onPaymentSelectButtonClick:function(e,t){t.className.match(this.paymentRestartButtonClass)&&(e.preventDefault(),this.FirstBillComponent.hide(!1),this.FirstBillComponent.element.un("click",this.onPaymentSelectButtonClick,this,{delegate:"."+this.paymentRestartButtonClass}),o.reload())},onPageChange:function(){},onOpenedWindowHide:function(){setTimeout(s.bind(function(){o.getActiveModal()||(s.Broadcaster.un(a.ModalComponent.GLOBALEVENT_MODAL_CLOSED,this.onOpenedWindowHide,this),this._cache.fn.call(this),this._cache={})},this),200)},_cacheStatus:function(e){var t=this._getAnyOpenedOverlayWindow();this._cache={fn:e,win:t},s.Broadcaster.on(a.ModalComponent.GLOBALEVENT_MODAL_CLOSED,this.onOpenedWindowHide,this)},_deleteStorageAction:function(){l.deleteAction(a.FirstBillController.STORAGE_ACTION_NAME)},_checkSendNotificationIsEnabled:function(){return!1===this._getAnyOpenedOverlayWindow()},_getAnyOpenedOverlayWindow:function(){var e=o.getActiveModal();return!(!e||e.name===a.PaymentModalComponent.NAME)&&e},onWindowClose:function(e){s.fireEvent(a.FirstBillController.GLOBALEVENT_FIRSTBILL_WINDOW_CLOSE,{scope:this,reopen:e.reopen})},bind:function(){u.superclass.bind.call(this),this.hasContent&&(this.element.on("click",this.onPackageBoxClick,this,{delegate:this.creditPackageSel}),this.element.on("click",this.onPackageBoxArrowClick,this,{delegate:this.creditPackageArrowSel}),this.element.on("click",this.reOpenFirstBill,this,{delegate:this.tryAnotherCardLink}))},unbind:function(){u.superclass.unbind.call(this),this.hasContent&&(this.element.un("click",this.onPackageBoxClick,this,{delegate:this.creditPackageSel}),this.element.un("click",this.onPackageBoxArrowClick,this,{delegate:this.creditPackageArrowSel}),this.FirstBillComponent.element.un("click",this.onPaymentSelectButtonClick,this,{delegate:"."+this.paymentRestartButtonClass}),this.element.un("click",this.reOpenFirstBill,this,{delegate:this.tryAnotherCardLink}))}})}}]);