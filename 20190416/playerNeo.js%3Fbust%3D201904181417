function asyncGeneratorStep(e,t,r,n,a,i,o){try{var s=e[i](o),c=s.value}catch(d){return void r(d)}s.done?t(c):Promise.resolve(c).then(n,a)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){function i(e){asyncGeneratorStep(s,n,a,i,o,"next",e)}function o(e){asyncGeneratorStep(s,n,a,i,o,"throw",e)}var s=e.apply(t,r);i(void 0)})}}define(["common/user-agent-analyzer","common/config","common/dmp-api","common/cmp","vendors/smarttag","vendors/TF1Player"],function(e,t,r,n){"use strict";function a(e){this.frame=e.frame}var i=e.analyze(),o=[0,25,50,75,90,100],s=["c_xtsite","c_xtn2","c_s_device","c_article_sous_categorie","c_programme_nom","c_programme_nom_live","c_programme_chaine","c_article_topic","c_article_id","c_format","c_videoDuration","c_video_reached_duration","c_video_pub","c_video_pub_preroll","c_video_pub_midroll","c_datediffusion","c_domaine_video","c_emnumber","c_iddalet","c_idmove","c_idvideo","c_idcontent","c_aip","c_idwat","c_moment_jourdate","c_moment_journomme","c_moment_heure"];return a.prototype.getPlayerInstance=function(){var e=this;return new Promise(function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function r(t,a){var i,o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.waitATInternet();case 2:return r.next=4,n.getIABConsentString();case 4:i=r.sent,o=e.getPlayerConfig(i),console.log("playerNeo::Global object ATInternet ",window.ATInternet),e.player=new TF1Player(o),e.isTrack=!1,e.isPub=!0,e.type=e.frame.dataset.type,e.stopTracking=!1,e.lastEvent="",e.setProgressStates(),e.setPlayerListeners(o.isLive),t(e.player);case 16:case"end":return r.stop()}},r,this)}));return function(e,r){return t.apply(this,arguments)}}())},a.prototype.waitATInternet=function(){return new Promise(function(e){if(window.ATInternet)return void e();var t=setInterval(function(){window.ATInternet&&(console.log("Global object ATInternet created"),clearInterval(t),e())},350)})},Object.defineProperty(a,"player",{get:function(){return this.player}}),Object.defineProperty(a,"isPub",{get:function(){return this.isPub}}),a.prototype.getPlayerConfig=function(e){var r=this.frame.dataset.videoid,n=encodeURIComponent(JSON.stringify({name:window.xtpage,level2:window.xtn2})),a=i.os,o=i.browser?"browsing":"appli",s="desktop";return"mobile"===i.device?s="mobile":"tablet"===i.device&&(s="tablet"),{container:this.frame,mediaID:r,isLive:parseInt(r)!=r,context:"ONEINFO_SC2",device:s,environment:o,os:a,mute:this.isPlayersMuted?"1":"0",autoStart:"iOS"===a||this.frame.dataset.autostart,width:"100%",height:"100%",cssPath:this.frame.dataset.csspath,svgPath:this.frame.dataset.svgpath,xitiSiteID:t.xiti.site,urlPage:document.location.origin+this.frame.dataset.urlpage,paramsTags:n,programme:"",metricsConsent:window.__cmp_tools.isStatAccepted(),userGDPR:encodeURI("adobe_uuid="+window.__cmp_tools.getCookie("aam_uuid")+"&_fw_gdpr=1&_fw_gdpr_consent="+e)}},a.prototype.setProgressStates=function(){this.dmpReachedStates=o.reduce(function(e,t){return e[t]={isrequestSend:!1},e},{})},a.prototype.setPlayerListeners=function(e){var t=this;e&&setInterval(function(){var e=this.player.getProgramme();this.programme!==e&&(this.sendDmpRequest({c_programme_nom_live:e}),this.programme=e)}.bind(this),5e3),this.player.addEventListener("onSlotStart",function(){t.lastEvent="onSlotStart",t.mediaDuration=t.player.getDuration(),t.isPub=!0,t.trackStart()}),this.player.addEventListener("onAdStop",function(){t.lastEvent="onAdStop",t.trackStop()}),this.player.addEventListener("onMediaPlay",function(){t.lastEvent="onMediaPlay",t.mediaDuration=t.player.getDuration(),!t.isPub,t.isPub=!1,t.trackProgress()}),this.player.addEventListener("onMediaPause",function(){t.lastEvent="onMediaPause",t.stopProgressTracking()}),this.player.addEventListener("onMediaStop",function(){t.lastEvent="onMediaStop",t.stopProgressTracking()}),this.player.addEventListener("onSeeked",function(){t.lastEvent="onSeeked",t.trackProgress()})},a.prototype.trackStart=function(){this.isTrack||(this.sendDmpRequest(),this.isTrack=!0)},a.prototype.trackStop=function(){this.isTrack&&(this.sendDmpRequest(),this.isTrack=!1)},a.prototype.getProgressPercentage=function(){var e=this.player.getProgress();return e===-1&&"onMediaStop"===this.lastEvent?100:Math.floor(100*e/this.mediaDuration)},a.prototype.trackProgress=function(){var e=this;this.trackingTask&&clearInterval(this.trackingTask),this.stopTracking=!1,this.trackingTask=setInterval(function(){var t=e.getProgressPercentage(),r=Object.keys(e.dmpReachedStates).filter(function(e){return t>=e});r.forEach(function(t){e.dmpReachedStates[t].isrequestSend||(e.dmpReachedStates[t].isrequestSend=!0,e.sendDmpRequest({c_video_reached_duration:t}))}),e.stopTracking&&clearInterval(e.trackingTask)},500)},a.prototype.stopProgressTracking=function(){this.stopTracking=!0},a.prototype.sendDmpRequest=function(e){var t=this,n=function(){var n=t.buildDmpDataQueryParameters(s),a=t.buildVideoQueryParameters(),i=Object.assign({},n,a,e);r.sendDmpRequest(i)};if(window._datapythagore)n();else var a=setInterval(function(){window._datapythagore&&(clearInterval(a),n())},1e3)},a.prototype.buildDmpDataQueryParameters=function(e){return e.reduce(function(e,t){return window._datapythagore.hasOwnProperty(t)?e[t]=window._datapythagore[t]:e[t]="",e},{})},a.prototype.buildVideoQueryParameters=function(){var e={c_videoDuration:"".concat(this.mediaDuration),c_format:"".concat(this.type),c_datediffusion:"".concat(this.frame.dataset.dateDiffusion?this.frame.dataset.dateDiffusion.substr(0,10):"")},t=this.player.getAd(),r={0:["0","0","0"],1:["1","1","0"],2:["1","1","1"],3:["1","0","1"]},n={c_video_pub:"",c_video_pub_preroll:"",c_video_pub_midroll:""},a=Object.keys(n),i="undefined"!==t?r[t].reduce(function(e,t,r){return e[a[r]]=t,e},n):n;return Object.assign({},e,i)},a});