define(["common/user-agent-analyzer","common/utils","common/config","common/cookie-manipulation"],function(t,e,i,o){"use strict";window.xt_adblock=2,window.xtnv=document,window.xtdi="",window.xt_multc="",window.xt_ac="",window.xt_at=!1,window.xt_tag="",window.xtInitialized=!1,window.xtcustom={},404===i.statusCode&&(window.x5=7,window.xtn2=17,window.xtpage="page-erreur-404"),i.page.xiti&&(window.xtpage=i.page.xiti.label,window.pageIndicator=i.page.xiti.pageIndicator,window.xtn2=i.page.xiti.lvl2||null,i.page.xiti.category&&(window.xcategory=i.page.xiti.category),i.page.xiti.subCategory&&(window.xsubCategory=i.page.xiti.subCategory),i.page.xiti.contentId&&(window.xcontentId=i.page.xiti.contentId),i.page.xiti.x5&&(window.x5=i.page.xiti.x5),i.page.xiti.x6&&(window.x6=i.page.xiti.x6),i.page.xiti.x7&&(window.x7=i.page.xiti.x7),i.page.xiti.x8&&(window.x8=i.page.xiti.x8),i.page.xiti.x9&&(window.x9=i.page.xiti.x9),i.page.xiti.x12&&(window.x12=i.page.xiti.x12),i.page.xiti.x13&&(window.x13=i.page.xiti.x13),i.page.xiti.x14&&(window.x14=i.page.xiti.x14),i.page.xiti.x15&&(window.x15=i.page.xiti.x15),i.page.xiti.x16&&(window.x16=i.page.xiti.x16),i.page.xiti.x17&&(window.x17=i.page.xiti.x17),i.page.xiti.x18&&(window.x18=i.page.xiti.x18),i.page.xiti.x19&&(window.x19=i.page.xiti.x19));var n=t.analyze(),a=function(){};a.prototype.init=function(t,e){o.executeScriptByFamily(o.COOKIE_CATEGORY.STATISTIQUES,this.hasAdBlocker.bind(this),"Xiti")},a.prototype.loadScript=function(t,e){var i=document.createElement("script");i.async=!0,i.src=t,(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]||document.getElementsByTagName("script")[0].parentNode).insertBefore(i,null),i.onload=function(t){e&&e()}},a.prototype.getDeviceType=function(e){switch(n.device){case t.ref.devices.mobile:return 2;case t.ref.devices.tablet:return 3;default:return 1}},a.prototype.getNavigator=function(t){return n.browser},a.prototype.hasAdBlocker=function(t){var e=document.createElement("div");e.innerHTML="&nbsp;",e.className="adsbox",document.body.appendChild(e),window.setTimeout(function(){0===e.offsetHeight&&(window.xt_adblock=1),e.parentNode.removeChild(e),this.makeXcustom(),this.applyTag(),this.bindClickTag()}.bind(this),100)},a.prototype.applyTag=function(){var t={},e={};if(window.location.search){var i=window.location.search.substr(1),o={};i.split("&").forEach(function(t){var e=t.split("=");e[0]&&e[1]&&(o[e[0]]=e[1])}),o.xtsite&&(t={site:o.xtsite}),o.idclient&&(t.ClientSideUserId={clientSideMode:"always"},e={userIdentifier:o.idclient})}var n;n=window.innerWidth<768?"smartphone":window.innerWidth<1025?"tablet":"desktop","https:"==document.location.protocol&&(t.secure=!0);var a=window.Tag=new ATInternet.Tracker.Tag(t,e),c={name:xtpage,level2:xtn2,customObject:{device:n}};a.page.set(c),xtcustom&&a.customVars.set({site:xtcustom}),xt_at&&a.identifiedVisitor.set({id:xt_at}),a.dispatch()},a.prototype.bindClickTag=function(){for(var t={N:"navigation",S:"exit",A:"action",T:"download"},e=document.querySelectorAll(".trackXiti"),i=0,o=e.length;i<o;i++){var n=e[i];n.addEventListener("click",function(e){var i=this.getAttribute("data-xiti-type")||!1,o=this.getAttribute("data-xiti-libelle")||!1,n=this.getAttribute("data-xiti")||!1;n&&(n=n.split("::"));var a={elem:this,name:o,type:t[i],level2:xtn2};null!=n[0]&&""!=n[0]&&(a.chapter1=n[0]),null!=n[1]&&""!=n[1]&&(a.chapter2=n[1]),Tag.click.set(a),xtcustom&&Tag.customVars.set({site:xtcustom}),Tag.dispatch()})}var a=function(t){for(var e=document.querySelectorAll("[data-blocxiti]"),i=0,o=e.length;i<o;i++)for(var n=e[i].querySelectorAll("a"),a=0,c=n.length;a<c;a++){var d=n[a],x=d.href,s=x.match(/-([0-9]{1,10})\.html/),r=x.replace(/-([0-9]{1,10})\.html/,"").replace(/\/+$/,"").split("/");r=r[r.length-1],d.xiticode=e[i].getAttribute("data-blocxiti"),d.libelle=null!=s?s[1]+"_"+r:r,d.addEventListener("click",function(e){var i={elem:this,name:"article"===t?window.x5:this.libelle,type:"navigation",level2:xtn2};null!=t&&""!=t&&(i.chapter1=t),null!=this.xiticode&&""!=this.xiticode&&(i.chapter2=this.xiticode),"le-direct-lci"===t&&(i.name="clic-article",i.type="navigation",delete i.chapter2),Tag.click.set(i),xtcustom&&Tag.customVars.set({site:xtcustom}),Tag.dispatch()})}};"/"===document.location.pathname||""===document.location.pathname?a("a-la-une"):"/direct/"===document.location.pathname?a("le-direct-lci"):(document.body.classList.contains("article-page")||document.body.classList.contains("video-page")||document.body.classList.contains("slideshow-page"))&&a("article")},a.prototype.makeXcustom=function(t){xtcustom[1]=this.getDeviceType(),xtcustom[2]="["+this.getNavigator().toLowerCase().replace(/ /g,"-")+"]",xtcustom[4]=window.xt_adblock;try{if(localStorage.noFirstVisit||(xtcustom[10]=/\/amp\//.test(window.document.referrer)?"2":"1",localStorage.noFirstVisit=!0),window.x5){xtcustom[5]=window.x5;var i=document.body.classList;if(i.contains("video-page")||i.contains("article-page")||i.contains("slideshow-page")||document.location.href.includes("/examens/resultats"))switch(parseInt(localStorage.x5,10)){case 1:xtcustom[11]=1;break;case 2:xtcustom[11]=1;break;case 3:xtcustom[11]=1;break;case 4:xtcustom[11]=11;break;case 5:xtcustom[11]=2;break;case 6:xtcustom[11]=3;break;case 7:xtcustom[11]=12;break;case 8:xtcustom[11]=7;break;case 9:xtcustom[11]=8;break;case 10:xtcustom[11]=4;break;case 15:xtcustom[11]=12}localStorage.x5=window.x5}}catch(o){console.error(o)}"undefined"!=typeof window.x6&&null!==window.x6&&(xtcustom[6]=window.x6),"undefined"!=typeof window.x7&&null!==window.x7&&(xtcustom[7]=window.x7),"undefined"!=typeof window.x8&&null!==window.x8&&(xtcustom[8]=window.x8),"undefined"!=typeof window.x9&&null!==window.x9&&(xtcustom[9]=window.x9),"undefined"!=typeof sessionStorage.getItem("lci")&&null!==sessionStorage.getItem("lci")||(xtcustom[10]=1),"undefined"!=typeof window.x12&&null!==window.x12&&(xtcustom[12]=window.x12),"undefined"!=typeof window.x13&&null!==window.x13&&(xtcustom[13]=window.x13),"undefined"!=typeof window.x14&&null!==window.x14&&(xtcustom[14]=window.x14),"undefined"!=typeof window.x15&&null!==window.x15&&(xtcustom[15]=window.x15),"undefined"!=typeof window.x16&&null!==window.x16&&(xtcustom[16]=window.x16),"undefined"!=typeof window.x17&&null!==window.x17&&(xtcustom[17]=window.x17),"undefined"!=typeof window.x18&&null!==window.x18&&(xtcustom[18]=window.x18),"undefined"!=typeof window.x19&&null!==window.x19&&(xtcustom[19]=window.x19),sessionStorage.setItem("lci",1);var n={},a=!1;document.querySelector("#zonePlayer")&&(xtcustom.mp_mode=0),e.hasClass(document.body,"mini-player")&&(xtcustom.mp_mode=1),1===xtcustom.mp_mode&&(xtcustom.programme=!1),xtcustom.v_format&&(n.v_format=xtcustom.v_format,a=!0),0!==xtcustom.mp_mode&&1!==xtcustom.mp_mode||(n.mp_mode=xtcustom.mp_mode,delete xtcustom.mp_mode),xtcustom.v_duree&&(n.v_duree=xtcustom.v_duree,1!==xtcustom.mp_mode&&(forceContexte?n.v_contexte=xtcustom.v_contexte||!1:(n.v_contexte="simple",document.getElementById("zonePlayer")&&"1"==document.getElementById("zonePlayer").getAttribute("data-playlist")&&(n.v_contexte="playlist")),a=!0,delete xtcustom.v_duree,delete xtcustom.v_contexte,delete xtcustom.v_format)),a&&(xtcustom.v_player=n)};var c=new a;return window.ATInternet={onTrackerLoad:function(){c.init()}},require(["vendors/smarttag"],function(){if(window.ATInternet.Tracker)return console.log("xiti::Global object ATInternet.Tracker ",window.ATInternet.Tracker),void require(["vendors/at-smarttag-youtube"]);var t=setInterval(function(){window.ATInternet.Tracker&&(require(["vendors/at-smarttag-youtube"]),clearInterval(t),console.log("xiti::Global object ATInternet.Tracker ",window.ATInternet.Tracker))},350)}),c});