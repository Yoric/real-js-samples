(function(q){var h=window.AmazonUIPageJS||window.P,E=h._namespace||h.attributeErrors,g=E?E("GoldboxMobileAssets",""):h;g.guardFatal?g.guardFatal(q)(g,window):g.execute(function(){q(g,window)})})(function(q,h,E){"object"!==typeof JSON&&(JSON={});(function(){function g(a){return 10>a?"0"+a:a}function n(a){b.lastIndex=0;return b.test(a)?'"'+a.replace(b,function(a){var c=e[a];return"string"===typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function f(e,b){var d,r,g=a,
h,t=b[e];t&&"object"===typeof t&&"function"===typeof t.toJSON&&(t=t.toJSON(e));"function"===typeof l&&(t=l.call(b,e,t));switch(typeof t){case "string":return n(t);case "number":return isFinite(t)?String(t):"null";case "boolean":case "null":return String(t);case "object":if(!t)return"null";a+=c;h=[];if("[object Array]"===Object.prototype.toString.apply(t)){r=t.length;for(e=0;e<r;e+=1)h[e]=f(e,t)||"null";b=0===h.length?"[]":a?"[\n"+a+h.join(",\n"+a)+"\n"+g+"]":"["+h.join(",")+"]";a=g;return b}if(l&&
"object"===typeof l)for(r=l.length,e=0;e<r;e+=1)"string"===typeof l[e]&&(d=l[e],(b=f(d,t))&&h.push(n(d)+(a?": ":":")+b));else for(d in t)Object.prototype.hasOwnProperty.call(t,d)&&(b=f(d,t))&&h.push(n(d)+(a?": ":":")+b);b=0===h.length?"{}":a?"{\n"+a+h.join(",\n"+a)+"\n"+g+"}":"{"+h.join(",")+"}";a=g;return b}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+g(this.getUTCMonth()+1)+"-"+g(this.getUTCDate())+"T"+g(this.getUTCHours())+
":"+g(this.getUTCMinutes())+":"+g(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var d,b,a,c,e,l;"function"!==typeof JSON.stringify&&(b=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(e,b,d){var r;c=a="";if("number"===typeof d)for(r=
0;r<d;r+=1)c+=" ";else"string"===typeof d&&(c=d);if((l=b)&&"function"!==typeof b&&("object"!==typeof b||"number"!==typeof b.length))throw Error("JSON.stringify");return f("",{"":e})});"function"!==typeof JSON.parse&&(d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(a,c){function e(a,b){var d,l,k=a[b];if(k&&"object"===typeof k)for(d in k)Object.prototype.hasOwnProperty.call(k,d)&&(l=e(k,d),void 0!==l?k[d]=l:delete k[d]);
return c.call(a,b,k)}a=String(a);d.lastIndex=0;d.test(a)&&(a=a.replace(d,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return a=eval("("+a+")"),"function"===typeof c?e({"":a},""):a;throw new SyntaxError("JSON.parse");})})();(function(){var g=this,n=g._,f={},d=Array.prototype,b=Object.prototype,
a=d.push,c=d.slice,e=d.concat,l=b.toString,k=b.hasOwnProperty,p=d.forEach,u=d.map,r=d.reduce,h=d.reduceRight,C=d.filter,t=d.every,q=d.some,y=d.indexOf,z=d.lastIndexOf,b=Array.isArray,B=Object.keys,A=Function.prototype.bind,m=function(a){if(a instanceof m)return a;if(!(this instanceof m))return new m(a);this._wrapped=a};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=m),exports._=m):g._=m;m.VERSION="1.5.2";var x=m.each=m.forEach=function(a,c,e){if(null!=
a)if(p&&a.forEach===p)a.forEach(c,e);else if(a.length===+a.length)for(var b=0,d=a.length;b<d&&c.call(e,a[b],b,a)!==f;b++);else for(var l=m.keys(a),b=0,d=l.length;b<d&&c.call(e,a[l[b]],l[b],a)!==f;b++);};m.map=m.collect=function(a,c,e){var b=[];if(null==a)return b;if(u&&a.map===u)return a.map(c,e);x(a,function(a,d,l){b.push(c.call(e,a,d,l))});return b};m.reduce=m.foldl=m.inject=function(a,c,e,b){var d=2<arguments.length;null==a&&(a=[]);if(r&&a.reduce===r)return b&&(c=m.bind(c,b)),d?a.reduce(c,e):a.reduce(c);
x(a,function(a,l,k){d?e=c.call(b,e,a,l,k):(e=a,d=!0)});if(!d)throw new TypeError("Reduce of empty array with no initial value");return e};m.reduceRight=m.foldr=function(a,c,e,b){var d=2<arguments.length;null==a&&(a=[]);if(h&&a.reduceRight===h)return b&&(c=m.bind(c,b)),d?a.reduceRight(c,e):a.reduceRight(c);var l=a.length;if(l!==+l)var k=m.keys(a),l=k.length;x(a,function(p,u,f){u=k?k[--l]:--l;d?e=c.call(b,e,a[u],u,f):(e=a[u],d=!0)});if(!d)throw new TypeError("Reduce of empty array with no initial value");
return e};m.find=m.detect=function(a,c,e){var b;N(a,function(a,d,l){if(c.call(e,a,d,l))return b=a,!0});return b};m.filter=m.select=function(a,c,e){var b=[];if(null==a)return b;if(C&&a.filter===C)return a.filter(c,e);x(a,function(a,d,l){c.call(e,a,d,l)&&b.push(a)});return b};m.reject=function(a,c,e){return m.filter(a,function(a,b,d){return!c.call(e,a,b,d)},e)};m.every=m.all=function(a,c,e){c||(c=m.identity);var b=!0;if(null==a)return b;if(t&&a.every===t)return a.every(c,e);x(a,function(a,d,l){if(!(b=
b&&c.call(e,a,d,l)))return f});return!!b};var N=m.some=m.any=function(a,c,e){c||(c=m.identity);var b=!1;if(null==a)return b;if(q&&a.some===q)return a.some(c,e);x(a,function(a,d,l){if(b||(b=c.call(e,a,d,l)))return f});return!!b};m.contains=m.include=function(a,c){return null==a?!1:y&&a.indexOf===y?-1!=a.indexOf(c):N(a,function(a){return a===c})};m.invoke=function(a,e){var b=c.call(arguments,2),d=m.isFunction(e);return m.map(a,function(a){return(d?e:a[e]).apply(a,b)})};m.pluck=function(a,c){return m.map(a,
function(a){return a[c]})};m.where=function(a,c,e){return m.isEmpty(c)?e?void 0:[]:m[e?"find":"filter"](a,function(a){for(var e in c)if(c[e]!==a[e])return!1;return!0})};m.findWhere=function(a,c){return m.where(a,c,!0)};m.max=function(a,c,e){if(!c&&m.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.max.apply(Math,a);if(!c&&m.isEmpty(a))return-Infinity;var b={computed:-Infinity,value:-Infinity};x(a,function(a,d,l){d=c?c.call(e,a,d,l):a;d>b.computed&&(b={value:a,computed:d})});return b.value};m.min=
function(a,c,e){if(!c&&m.isArray(a)&&a[0]===+a[0]&&65535>a.length)return Math.min.apply(Math,a);if(!c&&m.isEmpty(a))return Infinity;var b={computed:Infinity,value:Infinity};x(a,function(a,d,l){d=c?c.call(e,a,d,l):a;d<b.computed&&(b={value:a,computed:d})});return b.value};m.shuffle=function(a){var c,e=0,b=[];x(a,function(a){c=m.random(e++);b[e-1]=b[c];b[c]=a});return b};m.sample=function(a,c,e){return 2>arguments.length||e?a[m.random(a.length-1)]:m.shuffle(a).slice(0,Math.max(0,c))};var G=function(a){return m.isFunction(a)?
a:function(c){return c[a]}};m.sortBy=function(a,c,e){var b=G(c);return m.pluck(m.map(a,function(a,c,d){return{value:a,index:c,criteria:b.call(e,a,c,d)}}).sort(function(a,c){var e=a.criteria,b=c.criteria;if(e!==b){if(e>b||void 0===e)return 1;if(e<b||void 0===b)return-1}return a.index-c.index}),"value")};var H=function(a){return function(c,e,b){var d={},l=null==e?m.identity:G(e);x(c,function(e,k){k=l.call(b,e,k,c);a(d,k,e)});return d}};m.groupBy=H(function(a,c,e){(m.has(a,c)?a[c]:a[c]=[]).push(e)});
m.indexBy=H(function(a,c,e){a[c]=e});m.countBy=H(function(a,c){m.has(a,c)?a[c]++:a[c]=1});m.sortedIndex=function(a,c,e,b){e=null==e?m.identity:G(e);c=e.call(b,c);for(var d=0,l=a.length;d<l;){var k=d+l>>>1;e.call(b,a[k])<c?d=k+1:l=k}return d};m.toArray=function(a){return a?m.isArray(a)?c.call(a):a.length===+a.length?m.map(a,m.identity):m.values(a):[]};m.size=function(a){return null==a?0:a.length===+a.length?a.length:m.keys(a).length};m.first=m.head=m.take=function(a,e,b){return null==a?void 0:null==
e||b?a[0]:c.call(a,0,e)};m.initial=function(a,e,b){return c.call(a,0,a.length-(null==e||b?1:e))};m.last=function(a,e,b){return null==a?void 0:null==e||b?a[a.length-1]:c.call(a,Math.max(a.length-e,0))};m.rest=m.tail=m.drop=function(a,e,b){return c.call(a,null==e||b?1:e)};m.compact=function(a){return m.filter(a,m.identity)};var J=function(c,b,d){if(b&&m.every(c,m.isArray))return e.apply(d,c);x(c,function(c){m.isArray(c)||m.isArguments(c)?b?a.apply(d,c):J(c,b,d):d.push(c)});return d};m.flatten=function(a,
c){return J(a,c,[])};m.without=function(a){return m.difference(a,c.call(arguments,1))};m.uniq=m.unique=function(a,c,e,b){m.isFunction(c)&&(b=e,e=c,c=!1);e=e?m.map(a,e,b):a;var d=[],l=[];x(e,function(e,b){(c?b&&l[l.length-1]===e:m.contains(l,e))||(l.push(e),d.push(a[b]))});return d};m.union=function(){return m.uniq(m.flatten(arguments,!0))};m.intersection=function(a){var e=c.call(arguments,1);return m.filter(m.uniq(a),function(a){return m.every(e,function(c){return 0<=m.indexOf(c,a)})})};m.difference=
function(a){var b=e.apply(d,c.call(arguments,1));return m.filter(a,function(a){return!m.contains(b,a)})};m.zip=function(){for(var a=m.max(m.pluck(arguments,"length").concat(0)),c=Array(a),e=0;e<a;e++)c[e]=m.pluck(arguments,""+e);return c};m.object=function(a,c){if(null==a)return{};for(var e={},b=0,d=a.length;b<d;b++)c?e[a[b]]=c[b]:e[a[b][0]]=a[b][1];return e};m.indexOf=function(a,c,e){if(null==a)return-1;var b=0,d=a.length;if(e)if("number"==typeof e)b=0>e?Math.max(0,d+e):e;else return b=m.sortedIndex(a,
c),a[b]===c?b:-1;if(y&&a.indexOf===y)return a.indexOf(c,e);for(;b<d;b++)if(a[b]===c)return b;return-1};m.lastIndexOf=function(a,c,e){if(null==a)return-1;var b=null!=e;if(z&&a.lastIndexOf===z)return b?a.lastIndexOf(c,e):a.lastIndexOf(c);for(e=b?e:a.length;e--;)if(a[e]===c)return e;return-1};m.range=function(a,c,e){1>=arguments.length&&(c=a||0,a=0);e=arguments[2]||1;for(var b=Math.max(Math.ceil((c-a)/e),0),d=0,l=Array(b);d<b;)l[d++]=a,a+=e;return l};var K=function(){};m.bind=function(a,e){var b,d;if(A&&
a.bind===A)return A.apply(a,c.call(arguments,1));if(!m.isFunction(a))throw new TypeError;b=c.call(arguments,2);return d=function(){if(!(this instanceof d))return a.apply(e,b.concat(c.call(arguments)));var l=new K;K.prototype=null;var k=a.apply(l,b.concat(c.call(arguments)));return Object(k)===k?k:l}};m.partial=function(a){var e=c.call(arguments,1);return function(){return a.apply(this,e.concat(c.call(arguments)))}};m.bindAll=function(a){var e=c.call(arguments,1);if(0===e.length)throw Error("bindAll must be passed function names");
x(e,function(c){a[c]=m.bind(a[c],a)});return a};m.memoize=function(a,c){var e={};c||(c=m.identity);return function(){var b=c.apply(this,arguments);return m.has(e,b)?e[b]:e[b]=a.apply(this,arguments)}};m.delay=function(a,e){var b=c.call(arguments,2);return setTimeout(function(){return a.apply(null,b)},e)};m.defer=function(a){return m.delay.apply(m,[a,1].concat(c.call(arguments,1)))};m.throttle=function(a,c,e){var b,d,l,k=null,p=0;e||(e={});var u=function(){p=!1===e.leading?0:new Date;k=null;l=a.apply(b,
d)};return function(){var f=new Date;p||!1!==e.leading||(p=f);var r=c-(f-p);b=this;d=arguments;0>=r?(clearTimeout(k),k=null,p=f,l=a.apply(b,d)):k||!1===e.trailing||(k=setTimeout(u,r));return l}};m.debounce=function(a,c,e){var b,d,l,k,p;return function(){l=this;d=arguments;k=new Date;var u=function(){var f=new Date-k;f<c?b=setTimeout(u,c-f):(b=null,e||(p=a.apply(l,d)))},f=e&&!b;b||(b=setTimeout(u,c));f&&(p=a.apply(l,d));return p}};m.once=function(a){var c=!1,e;return function(){if(c)return e;c=!0;
e=a.apply(this,arguments);a=null;return e}};m.wrap=function(c,e){return function(){var b=[c];a.apply(b,arguments);return e.apply(this,b)}};m.compose=function(){var a=arguments;return function(){for(var c=arguments,e=a.length-1;0<=e;e--)c=[a[e].apply(this,c)];return c[0]}};m.after=function(a,c){return function(){if(1>--a)return c.apply(this,arguments)}};m.keys=B||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var c=[],e;for(e in a)m.has(a,e)&&c.push(e);return c};m.values=function(a){for(var c=
m.keys(a),e=c.length,b=Array(e),d=0;d<e;d++)b[d]=a[c[d]];return b};m.pairs=function(a){for(var c=m.keys(a),e=c.length,b=Array(e),d=0;d<e;d++)b[d]=[c[d],a[c[d]]];return b};m.invert=function(a){for(var c={},e=m.keys(a),b=0,d=e.length;b<d;b++)c[a[e[b]]]=e[b];return c};m.functions=m.methods=function(a){var c=[],e;for(e in a)m.isFunction(a[e])&&c.push(e);return c.sort()};m.extend=function(a){x(c.call(arguments,1),function(c){if(c)for(var e in c)a[e]=c[e]});return a};m.pick=function(a){var b={},l=e.apply(d,
c.call(arguments,1));x(l,function(c){c in a&&(b[c]=a[c])});return b};m.omit=function(a){var b={},l=e.apply(d,c.call(arguments,1)),k;for(k in a)m.contains(l,k)||(b[k]=a[k]);return b};m.defaults=function(a){x(c.call(arguments,1),function(c){if(c)for(var e in c)void 0===a[e]&&(a[e]=c[e])});return a};m.clone=function(a){return m.isObject(a)?m.isArray(a)?a.slice():m.extend({},a):a};m.tap=function(a,c){c(a);return a};var I=function(a,c,e,b){if(a===c)return 0!==a||1/a==1/c;if(null==a||null==c)return a===
c;a instanceof m&&(a=a._wrapped);c instanceof m&&(c=c._wrapped);var d=l.call(a);if(d!=l.call(c))return!1;switch(d){case "[object String]":return a==String(c);case "[object Number]":return a!=+a?c!=+c:0==a?1/a==1/c:a==+c;case "[object Date]":case "[object Boolean]":return+a==+c;case "[object RegExp]":return a.source==c.source&&a.global==c.global&&a.multiline==c.multiline&&a.ignoreCase==c.ignoreCase}if("object"!=typeof a||"object"!=typeof c)return!1;for(var k=e.length;k--;)if(e[k]==a)return b[k]==c;
var k=a.constructor,p=c.constructor;if(k!==p&&!(m.isFunction(k)&&k instanceof k&&m.isFunction(p)&&p instanceof p))return!1;e.push(a);b.push(c);k=0;p=!0;if("[object Array]"==d){if(k=a.length,p=k==c.length)for(;k--&&(p=I(a[k],c[k],e,b)););}else{for(var u in a)if(m.has(a,u)&&(k++,!(p=m.has(c,u)&&I(a[u],c[u],e,b))))break;if(p){for(u in c)if(m.has(c,u)&&!k--)break;p=!k}}e.pop();b.pop();return p};m.isEqual=function(a,c){return I(a,c,[],[])};m.isEmpty=function(a){if(null==a)return!0;if(m.isArray(a)||m.isString(a))return 0===
a.length;for(var c in a)if(m.has(a,c))return!1;return!0};m.isElement=function(a){return!(!a||1!==a.nodeType)};m.isArray=b||function(a){return"[object Array]"==l.call(a)};m.isObject=function(a){return a===Object(a)};x("Arguments Function String Number Date RegExp".split(" "),function(a){m["is"+a]=function(c){return l.call(c)=="[object "+a+"]"}});m.isArguments(arguments)||(m.isArguments=function(a){return!(!a||!m.has(a,"callee"))});"function"!==typeof/./&&(m.isFunction=function(a){return"function"===
typeof a});m.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))};m.isNaN=function(a){return m.isNumber(a)&&a!=+a};m.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==l.call(a)};m.isNull=function(a){return null===a};m.isUndefined=function(a){return void 0===a};m.has=function(a,c){return k.call(a,c)};m.noConflict=function(){g._=n;return this};m.identity=function(a){return a};m.times=function(a,c,e){for(var b=Array(Math.max(0,a)),d=0;d<a;d++)b[d]=c.call(e,d);return b};m.random=
function(a,c){null==c&&(c=a,a=0);return a+Math.floor(Math.random()*(c-a+1))};var F={escape:{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}};F.unescape=m.invert(F.escape);var E={escape:new RegExp("["+m.keys(F.escape).join("")+"]","g"),unescape:new RegExp("("+m.keys(F.unescape).join("|")+")","g")};m.each(["escape","unescape"],function(a){m[a]=function(c){return null==c?"":(""+c).replace(E[a],function(c){return F[a][c]})}});m.result=function(a,c){if(null!=a)return c=
a[c],m.isFunction(c)?c.call(a):c};m.mixin=function(c){x(m.functions(c),function(e){var b=m[e]=c[e];m.prototype[e]=function(){var c=[this._wrapped];a.apply(c,arguments);return L.call(this,b.apply(m,c))}})};var M=0;m.uniqueId=function(a){var c=++M+"";return a?a+c:c};m.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var v=/(.)^/,Q={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t"},R=/\\|'|\r|\n|\t/g,O=["u2028","u2029"];m.template=function(a,c,e){var b;
e=m.defaults({},e,m.templateSettings);var d=new RegExp([(e.escape||v).source,(e.interpolate||v).source,(e.evaluate||v).source].join("|")+"|$","g"),l=0,k="__p+\x3d'";a.replace(d,function(c,e,b,d,p){k+=a.slice(l,p).replace(R,function(a){return"\\"+Q[a]}).replace(/\u2028/g,"\\"+O[0]).replace(/\u2029/g,"\\"+O[1]);e&&(k+="'+\n((__t\x3d("+e+"))\x3d\x3dnull?'':_.escape(__t))+\n'");b&&(k+="'+\n((__t\x3d("+b+"))\x3d\x3dnull?'':__t)+\n'");d&&(k+="';\n"+d+"\n__p+\x3d'");l=p+c.length;return c});k+="';\n";e.variable||
(k="with(obj||{}){\n"+k+"}\n");k="var __t,__p\x3d'',__j\x3dArray.prototype.join,print\x3dfunction(){__p+\x3d__j.call(arguments,'');};\n"+k+"return __p;\n";try{b=new Function(e.variable||"obj","_",k)}catch(p){throw p.source=k,p;}if(c)return b(c,m);c=function(a){return b.call(this,a,m)};c.source="function("+(e.variable||"obj")+"){\n"+k+"}";return c};m.chain=function(a){return m(a).chain()};var L=function(a){return this._chain?m(a).chain():a};m.mixin(m);x("pop push reverse shift sort splice unshift".split(" "),
function(a){var c=d[a];m.prototype[a]=function(){var e=this._wrapped;c.apply(e,arguments);"shift"!=a&&"splice"!=a||0!==e.length||delete e[0];return L.call(this,e)}});x(["concat","join","slice"],function(a){var c=d[a];m.prototype[a]=function(){return L.call(this,c.apply(this._wrapped,arguments))}});m.extend(m.prototype,{chain:function(){this._chain=!0;return this},value:function(){return this._wrapped}})}).call(this);q.when("gb-enums").register("gb-csm",function(g){function n(a,e){if(a&&h.ue&&ue.count)return ue.count(a,
e)}function f(a){var e;e=a&&h.ue&&ue.count?ue.count(a)||0:void 0;n(a,e+1)}function d(a,e){n(a+":time",e)}function b(a,e,b){var d=h.ueLogError;d&&d(e,{logLevel:a,attribution:"GoldboxMobileAssets",message:b||""})}var a={};return{incrementCounter:f,recordLatency:d,recordImageMetricMarker:function(a,e,b){var k="ImgLoad";b&&(k+=":"+b);switch(a){case "load":f(k+":success");if(a=parseInt(e.getAttribute("data-render-start"),10))a=(new Date).getTime()-a,d(k,a);break;case "error":f(k+":error")}},recordMaxPageDepthReached:function(c,
e){var b="widgetPageDepth";gb.widgets&&c&&gb.widgets[c]&&gb.widgets[c].viewPortManager&&!isNaN(gb.widgets[c].viewPortManager.subnavPage)&&(b+=":SN:"+gb.widgets[c].viewPortManager.subnavPage);a[b]&&a[b]>=e||(a[b]=e,n(b,e))},logError:function(a,e){b(g.CSM_LOG_LEVEL.ERROR,a,e)},logWarning:function(a,e){b(g.CSM_LOG_LEVEL.WARN,a,e)},logFatal:function(a,e){b(g.CSM_LOG_LEVEL.FATAL,a,e)}}});h.gb=h.gb||{};q.when("jQuery").execute(function(g){gb.$=g;q.declare("GoldboxMobile3PAssets",{_:_.noConflict()})});q.when("A").register("gb-event-emitter",
function(g){return g.createClass({init:function(){this._events=this._events||{};this._tasks=this._tasks||{completed:{},waiting:{}}},on:function(g,f){this._events[g]=this._events[g]||[];this._events[g].push(f)},off:function(g,f){!1!==g in this._events&&this._events[g].splice(this._events[g].indexOf(f),1)},trigger:function(g){if(!1!==g in this._events)for(var f=0;f<this._events[g].length;f++)this._events[g][f].apply(this,Array.prototype.slice.call(arguments,1))},when:function(g){var f=this;return{execute:function(d){f._tasks.completed[g]?
d():(f._tasks.waiting[g]||(f._tasks.waiting[g]=[]),25>f._tasks.waiting[g].length&&f._tasks.waiting[g].push(d))}}},register:function(g){if(!this._tasks.completed[g])for(this._tasks.completed[g]=!0,g=this._tasks.waiting[g];g&&g.length;){var f=g.pop();"function"===typeof f&&f()}}})});q.when("GoldboxMobile3PAssets").register("gb-enums",function(g){var h=g._;g={StatusFilters:{AVAILABLE:"available",UPCOMING:"upcoming",MISSED:"missed",ACTIVE:"active"},CSM_LOG_LEVEL:{ERROR:"ERROR",FATAL:"FATAL",WARN:"WARN"},
Realms:{CA:"CA",CN:"CN",DE:"DE",ES:"ES",FR:"FR",IT:"IT",IN:"IN",JP:"JP",US:"US",UK:"UK",MX:"MX",BR:"BR",AU:"AU",TR:"TR",AE:"AE"},CategoryFilters:{ALL:"all"},DealTypes:{DOTD:"DEAL_OF_THE_DAY",LD:"LIGHTNING_DEAL",BD:"BEST_DEAL",LOCAL:"LOCAL_DEAL",COUPON:"COUPON_DEAL",EVENT:"EVENT_DEAL"},DealStates:{LOADING:"LOADING",COMINGSOON:"COMINGSOON",AVAILABLE:"AVAILABLE",EXPIRED:"EXPIRED",SOLDOUT:"SOLDOUT",UPCOMING:"UPCOMING",WAITLIST:"WAITLIST",WAITLISTFULL:"WAITLISTFULL"},FilterStates:{ACTIVE:"ACTIVE",MISSED:"MISSED",
UPCOMING:"UPCOMING"},FilterConstants:{CUSTOM_FILTER:"customFilter"},DealStateToTemplateMap:{LOADING:"LOADING",AVAILABLE:"AVAILABLE",WAITLIST:"AVAILABLE",WAITLISTFULL:"AVAILABLE",EXPIRED:"EXPIRED",SOLDOUT:"SOLDOUT",UPCOMING:"UPCOMING",COMINGSOON:"COMINGSOON"},WatchedDealStateMap:{AVAILABLE:"AVAILABLE",WAITLIST:"AVAILABLE",WAITLISTFULL:"AVAILABLE",EXPIRED:"EXPIRED",SOLDOUT:"EXPIRED",UPCOMING:"UPCOMING",COMINGSOON:"UPCOMING",LOADING:"AVAILABLE"},WatchDealActions:{ADD:"ADD",REMOVE:"REMOVE"},WatchDealPopoverActions:{SHOW_WATCH_POPUP:"SHOW",
HIDE_WATCH_POPUP:"HIDE",UPDATE_WATCH_POPUP:"UPDATE"},SembuActions:{GET_COOKIE:"getValue",SET_COOKIE:"setValue"},WatchDealViewKeys:{GOLDBOX_DOMAIN:"goldbox",DISMISS_WATCHPOPUP_KEY:"dismissed_watch_popup"},AnimationDurations:{WATCH_DEAL:200,SCROLL_WIDGET_TO_TOP:500},Timeouts:{WIDGET_LOAD_WAIT_TIME:800},StateTemplates:{LOADING:"loading",AVAILABLE:"available",WAITLIST:"available",WAITLISTFULL:"available",COMINGSOON:"comingSoon",UPCOMING:"upcoming",SOLDOUT:"soldout",EXPIRED:"expired"},PurchaseStates:{ADD_TO_CART:"AddToCart",
LEARN_MORE:"LearnMore",SEE_DEAL:"SeeDeal",JOIN_WAITLIST:"JoinWaitlist",WAITLIST_FULL:"WaitlistFull",CHOOSE_OPTIONS:"ChooseOptions",PENDINGATC:"PendingAddToCart",CLAIMED:"Claimed",INWAITLIST:"InWaitlist",INCART:"InCart"},DataTypes:{STRING:"string",BOOL:"bool"},CustomerStates:{NONE:"NONE",INCART:"INCART",CLAIMED:"CLAIMED",INWAITLIST:"INWAITLIST",PENDINGATC:"PENDINGATC",EXPIRED:"EXPIRED"},AppStoreLink:{iOS:"itms-apps://itunes.apple.com/us/app/pages/id297606951?mt\x3d8\x26uo\x3d4",android:"market://details?id\x3dcom.amazon.mShop.android.shopping"},
ButtonActions:{ATC:"gbdeal-addtocart",JW:"gbdeal-joinwaitlist",SO:"gbdeal-seeoptions",WTD:"gbdeal-watchdeal"},priceKind:{LIST_PRICE:"LP",OUR_PRICE:"OP",PRINT_LIST_PRICE:"PLP",DIGITAL_LIST_PRICE:"DLP",UVP_LIST_PRICE:"ULP"},merchantName:{US:"Amazon.com",IT:"Amazon.it",ES:"Amazon.es",DE:"Amazon.de"},WidgetViewIDs:{A_POPOVER:"#a-popover-",CANCEL:"widgetRefineCancel",CART_ERROR:"cartError",CATEGORY_REFINE_CONTENT:"categoryRefineContent",CONTENT:"widgetContent",CONTENTROW:"widgetContentRow--LowEndDevice",
FILTER_BUTTON:"filterButton",FILTER_CONTENT:"filterContent",FILTERS:"widgetFilters",HERO_HEADER:"heroHeader",LAUNCH_CELL:"launchCell",LOADING:"widgetLoading",SCROLL_CONTENT_LOADER:"scrollContentLoader",MINI_DP_MODAL:"mini_dp_modal_",NEXT_SHOVL_BUTTON:"nextShovlButton",PAGINATION_ROW:"paginationRow",PRIME:"prime_",PREV_SHOVL_BUTTON:"previousShovlButton",REFINE:"widgetRefine",REFINE_POPOVER_NAME:"refine",SCROLL:"widgetScroll",SHOVL_PAGINATION:"shovlPagination",SHOVL_STATE_HEADER:"shovlStateHeader",
SHOVL_FILTER:"shovlFilter",SORT_BUTTON:"sortButton"},WidgetViewSelectors:{NAV:"#a-page \x3e nav",HEADER:"#heroHeader",DIVIDER:".dealDivider",REFINESTATE:".dealDivider + div",PAGINATION_ROW:".paginationRow",FILTER_BOX:".filterBox",TRIANGLE:".triangle",PADCENTER:".padCenter"},dealViewIDs:{TITLE:"dealTitle",DESC_ABBR:"dealDescShort",DESC_REST:"dealDescRest",DUMMY_ELEMENT:"dummyElement",DEALCLOCK:"_dealClock",INCARTCLOCK:"_incartClock",PENDINGATCCLOCK:"_pendingATCClock",OPT_HEADER:"dealOptionsHeader",
IMAGE:"dealImage",OPT_CONTENT:"dealOptionsContent",OPT_FOOTER:"dealOptionsFooter",SHARE:"dealShare",SHIP_SOLD:"shipSoldInfo"},dealViewClasses:{DESC_EXPANDER:"dealDescExpander",FOOTER:"footerElm--LowEndDevice"},ShovlConstants:{DISABLED:"disabled",SHOVL_NEXT:"shovelNext",SHOVL_PREVIOUS:"shovelPrevious",SHOVL_STATE_TAB:"widgetCurrentTab"},WatchDealViewIDs:{WATCH_POPOVER:"watchDealPopover",WATCHING_IMAGE:"watchingImageDiv_",WATCH_BUTTON:"watchButton_",WATCH_BUTTON_TEXT:"watchButtonText_",MINI_DP_WATCH_BUTTON_MAPPING:{"GB-SUPPLE":"miniDPSuppleWatchButton"}},
MobileClients:{AW:"aw",APP:"app",PC:"pc"},RedirectionLinks:{app:{ALL_DEALS:"/gp/mobile/deals/all-deals",BEST_DEAL:"/gp/mobile/deals/best-deals",DEAL_OF_THE_DAY:"/gp/mobile/deals/dotds",GATEWAY_PAGE:"/gp/mobile/deals",LIGHTNING_DEAL:"/gp/mobile/deals/lightning-deals"},aw:{ALL_DEALS:"/gp/aw/gb/alldeals",BEST_DEAL:"/gp/aw/gb/bd",DEAL_OF_THE_DAY:"/gp/aw/gb/dotds",GATEWAY_PAGE:"/gp/aw/gb",LIGHTNING_DEAL:"/gp/aw/gb/ld"},pc:{ALL_DEALS:"/gp/goldbox/all-deals"}},ReviewsPageURL:{app:"/gp/mobile/udp/reviews/",
aw:"/gp/mobile/udp/reviews/",pc:"/gp/product-reviews/"},SponsoredDealURL:{picassoRedirect:"/gp/slredirect/picassoRedirect.html"},Cookies:{apnPrivacy:"apn-privacy"},AJAXLinks:{CDS:"/gp/mobile/deals/ajax/impressionTrackerV2.html",ADD_TO_CART:"/gp/deal/ajax/addToCart.html",WATCH_DEAL:"/gp/deal/ajax/v2/watchDeal.html/ref\x3d",GET_WATCHED:"/gp/deal/ajax/getWatchedDeals.html/ref\x3d",GDM:"/xa/dealcontent/v2/GetDealMetadata",GD:"/xa/dealcontent/v2/GetDeals",GDS:"/xa/dealcontent/v2/GetDealStatus",CD:"/gp/deal/ajax/v2/claimDeal.html/ref\x3d",
UPDATE_EMBU:"/gp/mobile/deals/ajax/modifyEmbuData.html",SUBSCRIBE_MNSS:"/gp/deal/ajax/registerForNotifications.html/ref\x3d",PICASSO_CLICKS:"/gp/slredirect/picassoRedirect.html",FWC:"/gp/deal/ajax/fetchWidgetConfig.html"},MiscLinks:{CART_URL:"/gp/cart/view.html",CART_URL_AW:"/gp/aw/c",LOCAL_URL:"/local",PURCHASE_URL:"/gp/goldbox/purchase"},WidgetNames:{M_HERO:"GB-M-HERO",M_SUPPLE:"GB-M-SUPPLE",MG_HERO:"GB-M-GRID-HERO",ML_HERO:"GB-M-LIST-HERO",PC_FACEOUT:"GB-PC-FACEOUT",PC_SUPPLE:"GB-SUPPLE",PC_SHOVELER:"GB-SHOVELER",
TAB_HERO:"GB-TAB-HERO",TAB_GRID_HERO:"GB-TAB-GRID-HERO",TAB_SUPPLE:"GB-TAB-SUPPLE"},WidgetConstants:{CURRENT_TAB:"widgetCurrentTab"},ChangeoverID:{AddedToCart:"gb_in_cart_co",Waitlisted:"gb_waitlisted_co",Subnav:"gb_subnav_change_hover"},ClientOrientation:{LANDSCAPE:"landscape",PORTRAIT:"portrait"},MashNavButtons:{LEFT:"navButtonLeft",RIGHT:"navButtonRight"},BottomSheetActions:{StopWatching:{label:"gb_m_stop_watching_deal",actionName:"gbdeal-watchdeal"},ShareDeal:{label:"gb_share_deal",actionName:"gbdeal-mashshare"}},
Direction:{UP:"up",DOWN:"down"},Constants:{MAX_TIMEOUT:2147483647,REMOTE_WIDGET_EVENT_PREFIX:"remoteWidget-",REMOTE_WIDGET:"remoteWidget",AD_SLOT_INFIX:"_adSlot_",SECURE_IMAGES_URL_DEFAULT:"images-na.ssl-images-amazon.com",SECURE_IMAGES_URL_CN:"images-cn.ssl-images-amazon.com",MIN_DEAL_VIEW_WIDTH:200,MIN_TABLET_VIEW_WIDTH:200,MIN_PC_VIEW_WIDTH:250,SUPPLE_FILTER_COLUMN_WIDTH:235,MIN_NAV_WIDTH:1E3,MIN_TAB_WIDTH:735,PHONE_LANDSCAPE_COLUMN_COUNT:3,PHONE_PORTRAIT_COLUMN_COUNT:2,LOWER_END_IOS_MIN_HEIGHT:500,
EGRESS_URL_UNSUPPORTED_REGEX:/\/dp\/|\/gp\/product\//,EXTRACT_ASIN_URL_REGEX:/(\/dp\/|\/gp\/product\/)([^\/]+)/,MAX_SUPPLE_DEALS_TO_DISPLAY:2,GET_DEALS_MAX_JITTER:2,HI_RES_SCALING_FACTOR:2,AJAX_ENDPOINT:"/xa/dealcontent/v2/",PAGINATED_METADATA_VERSION:"V2.2",NON_RETRYABLE_QUANTITY_RESTRICTION_VIOLATION_ERROR:"4002",MAX_DISPLAYABLE_VALUES_IN_UNEXPANDED_FILTER:12,ALL:"ALL",X_DIRECTION:"xDirection",Y_DIRECTION:"yDirection",SECOND_IN_MILLIS:1E3,MINUTE_IN_MILLIS:6E4,HOUR_IN_MILLIS:36E5,DAY_IN_MILLIS:864E5},
DeviceNames:{IPHONE:"iPhone",IPAD:"iPad",WIN_PHONE:"winPhone",ANDROID_PHONE:"androidPhone",ANDROID_TAB:"androidTab"},Weblabs:{TREATMENTS:{C:0,T1:1,T2:2,T3:3,T4:4}},ItemTypes:{NONE:"NONE",SINGLE:"SINGLE_ITEM",MULTI:"MULTI_ITEM",VARIATION:"VARIATION_ITEM"},DealAccessTypes:{PRIME_EARLY_ACCESS:"PRIME_EARLY_ACCESS",PRIME_ONLY_BD:"PRIME_ONLY_BD",PRIME_ONLY_DOTD:"PRIME_ONLY_DOTD",PRIME_ONLY_LD:"PRIME_ONLY_LD",APP_EARLY_ACCESS:"APP_EARLY_ACCESS",APP_ONLY_LD:"APP_ONLY_LD",GIVEAWAY_DEAL:"GIVEAWAY_DEAL"},PrimeSignUpURL:{PRIME_EARLY_ACCESS:"prime_signup_redirect",
PRIME_ONLY_BD:"exclusive_bd_prime_signup_redirect",PRIME_ONLY_DOTD:"exclusive_dotd_prime_signup_redirect",PRIME_ONLY_LD:"exclusive_access_prime_signup_redirect"},appDownloadURL:"http://www.amazon.in/b/ref\x3daeaodeals?node\x3d6967393031",Platforms:{TAB:"tablet",PC:"pc",PHONE:"phone"},ClientIDPrefix:"goldbox_mobile",SortOrders:{BY_SCORE:"BY_SCORE",BY_RELEVANCE:"BY_RELEVANCE",BY_BEST_SELLING:"BY_BEST_SELLING",BY_PRICE_ASCENDING:"BY_PRICE_ASCENDING",BY_PRICE_DESCENDING:"BY_PRICE_DESCENDING",BY_DISCOUNT_ASCENDING:"BY_DISCOUNT_ASCENDING",
BY_DISCOUNT_DESCENDING:"BY_DISCOUNT_DESCENDING",BY_START_TIME:"BY_START_TIME"},SortOrdersToStringsMap:{BY_SCORE:"gb_sort_score",BY_RELEVANCE:"gb_sort_relevant",BY_BEST_SELLING:"gb_sort_bestselling",BY_PRICE_ASCENDING:"gb_sort_price_up",BY_PRICE_DESCENDING:"gb_sort_price_down",BY_DISCOUNT_ASCENDING:"gb_sort_discount_up",BY_DISCOUNT_DESCENDING:"gb_sort_discount_down",BY_START_TIME:"gb_sort_start_time"},RankingStrategies:{PERSONALIZED:"PERSONALIZED",CLAIMED_RATE:"CLAIMED_RATE",TRENDING:"TRENDING",NEW_TO_GL_EXCLUSIVE:"NEW_TO_GL_EXCLUSIVE",
NEW_TO_GL_INCLUSIVE:"NEW_TO_GL_INCLUSIVE",BY_CUSTOM_CRITERION:"BY_CUSTOM_CRITERION"},PaginationDummyURLs:{PREV:"PREV",NEXT:"NEXT"},primeIconPositions:{RIGHT:"right",LEFT:"left"},ViewPortPresence:{ABSENT:"absent",FULL:"full",FULL_HORIZONTAL_CONTENT:"horizontal",FULL_VERTICAL_CONTENT:"vertical",PARTIAL_TOP:"top",PARTIAL_BOTTOM:"bottom",PARTIAL_LEFT:"left",PARTIAL_RIGHT:"right",PARTIAL_TOP_LEFT:"top_left",PARTIAL_TOP_RIGHT:"top_right",PARTIAL_BOTTOM_LEFT:"bottom_left",PARTIAL_BOTTOM_RIGHT:"bottom_right"},
WidgetHeaderIDs:{WidgetHeader:"widgetHeaderContent_"},GiveawayUrlParams:{returnToUrlPc:"/gp/goldbox/ref\x3dgagb",returnToUrlMob:"/gp/mobile/deals/ref\x3dgagb",client:"gbga",nav:"amz"},FilterAttrToStrings:{ACTIVE:"gb_active",APP_EARLY_ACCESS:"gb_app_early_access",APP_ONLY_LD:"gb_app_only_access",BEST_DEAL:"gb_best_deal",COUPON_DEAL:"gb_coupon_deal",DEAL_OF_THE_DAY:"gb_deal_of_the_day",DISCOUNT:"gb_discount_range",DISCOUNT_START:"gb_discount_range_start",DISCOUNT_END:"gb_discount_range_end",FREE_SHIPPING_ELIGIBLE_ONLY:"gb_free_shipping_eligible",
GIFT_WRAPPABLE:"gb_gift_wrappable",GLOBAL_ELIGIBLE_ONLY:"gb_global_eligible",LIGHTNING_DEAL:"gb_lightning_deal",MISSED:"gb_missed",NEW_RELEASES:"gb_new_release",PRICE:"gb_price_range",PRICE_START:"gb_price_range_start",PRICE_END:"gb_price_range_end",PRIME:"gb_prime_eligible",PRIME_EARLY_ACCESS:"gb_prime_early_access",PRIME_ONLY_LD:"gb_prime_only_ld",PRIME_ONLY_DOTD:"gb_prime_only_dotd",PRIME_SUMMARY:"gb_prime_summary",REVIEW_RATING:"gb_x_stars_and_up",UPCOMING:"gb_upcoming",CASH_ON_DELIVERY:"gb-is-cod-allowed",
FULLFILLED_BY_AMAZON:"gb-fullfilled-by-amazon"},DealStatesToFilterStates:{AVAILABLE:"ACTIVE",EXPIRED:"MISSED",UPCOMING:"UPCOMING",SOLDOUT:"MISSED",WAITLIST:"ACTIVE",WAITLISTFULL:"ACTIVE"},DCSQueryParams:{ACCESS_TYPE:"enforcedAccessTypes",BRANDS:"brands",CATEGORIES:"enforcedCategories",DEAL_STATE:"dealStates",DEAL_TYPE:"dealTypes",DISCOUNT_RANGE:"discountRanges",EXCLUDED_ACCESS_TYPE:"excludedAccessTypes",FREE_SHIPPING_ELIGIBLE_ONLY:"freeShippingEligibleOnly",GLOBAL_ELIGIBLE_ONLY:"globalEligibleOnly",
INCLUDED_ACCESS_TYPE:"includedAccessTypes",MAX_PERCENT_OFF:"maxPercentOff",MAX_PRICE:"maxPrice",MIN_PERCENT_OFF:"minPercentOff",MIN_PRICE:"minPrice",MIN_RATING:"minRating",PAGE:"page",PRICE_RANGE:"priceRanges",PRIME_ELIGIBLE_ONLY:"primeEligibleOnly",PRIME_ACCESS_TYPE:"primeAccessType",SORT_ORDER:"sortOrder",INTERESTS:"interests",ENFORCED_CATEGORIES:"enforcedCategories"},BinNames:{BRANDS:"brands",CATEGORIES:"whitelist_categories",DISCOUNT:"discount_range",FREE_SHIPPING_ELIGIBLE_ONLY:"is_eligible_for_free_shipping",
INCLUDED_DEAL_TARGETS:"included_deal_targets",GLOBAL_ELIGIBLE_ONLY:"is_global_eligible",PRIME_ELIGIBLE_ONLY:"is_prime",PRICE:"price_range",INTERESTS:"interests"},IncludedDealTargetsSupported:{MARKETING_ID:"MARKETING_ID",MARKETING_ID_ONLY_SUMMARY:"marketing_id"},BinCounts:{BRANDS:100,CATEGORIES:100,DISCOUNT:20,FREE_SHIPPING_ELIGIBLE_ONLY:2,INCLUDED_DEAL_TARGETS:1E3,GLOBAL_ELIGIBLE_ONLY:2,PRIME_ELIGIBLE_ONLY:2,PRICE:20,INTERESTS:50},CustomerAppliedFilters:{PAGE:"p",CATEGORY:"c",STATUS:"s"},BrowserHistory:{STATE_KEY:"gb_hero_f_",
ATTRIBUTION:"GoldBox"},DefaultPollingIntervals:{LD:12E3},RoundedReviewStarsThresholds:{LOW:.3,HIGH:.7},CellSizeClasses:{SINGLE:"singleCell",DOUBLE:"doubleCell"},WidgetActions:{Faceout:{SHOVEL:"gbshovel-pagination-faceout",TILE_SELECTED:"gbselect-tile-faceout"},Filter:{CLEAR_ALL:"gbfilter-clear-all"},Shoveler:{SHOVEL:"gbshovel-pagination-shoveler"}},AGSMerchantsID:{MX_DEVO:"A2WNUS5VO5EKRE",MX_PROD:"A3BWELMBWVCY9T",IN_DEVO:"A04207613O5XXZD1VFTMS",IN_PROD:"AYAZOP86CGXY9",UK_DEVO:"A1SC7XIBTEUTGP",UK_PROD:"A2KVF7QXNCLV8H"},
WidgetsAllowedAsScrollSource:["GB-PC-FACEOUT"]};var f=g.DCSQueryParams;g.BinningParams={BRANDS:{key:"brands",dcsKey:f.BRANDS},CATEGORIES:{key:"whitelist_categories",dcsKey:f.CATEGORIES},DEAL_STATE:{key:"deal_state",dcsKey:f.DEAL_STATE},DEAL_TYPE:{key:"deal_type",dcsKey:f.DEAL_TYPE},DISCOUNT:{key:"discount_range",dcsKey:[f.MIN_PERCENT_OFF,f.MAX_PERCENT_OFF]},FREE_SHIPPING_ELIGIBLE_ONLY:{key:"is_eligible_for_free_shipping",dcsKey:f.FREE_SHIPPING_ELIGIBLE_ONLY},PRICE:{key:"price_range",dcsKey:[f.MIN_PRICE,
f.MAX_PRICE]},REVIEW_RATING:{key:"reviews",dcsKey:f.MIN_RATING},GLOBAL_ELIGIBLE_ONLY:{key:"is_global_eligible",dcsKey:f.GLOBAL_ELIGIBLE_ONLY},PAGE:{key:"page",dcsKey:f.PAGE},PRIME_ELIGIBLE_ONLY:{key:"is_prime",dcsKey:f.PRIME_ELIGIBLE_ONLY},PRIME_ACCESS_TYPE:{key:"prime_access_type",dcsKey:f.PRIME_ACCESS_TYPE},SORT_ORDER:{key:"sortOrder",dcsKey:f.SORT_ORDER},CASH_ON_DELIVERY:{key:"isCODAllowed",dcsKey:null},FULLFILLED_BY_AMAZON:{key:"isFulfilledByAmazon",dcsKey:null},NEW_RELEASES:{key:"newReleases",
dcsKey:null},GIFT_WRAPPABLE:{key:"giftWrappable",dcsKey:null},ACCESS_TYPE:{key:"access_type",dcsKey:f.ACCESS_TYPE},EXCLUDED_ACCESS_TYPE:{key:"excluded_access_type",dcsKey:f.EXCLUDED_ACCESS_TYPE},INCLUDED_ACCESS_TYPE:{key:"included_access_type",dcsKey:f.INCLUDED_ACCESS_TYPE},INTERESTS:{key:"interests",dcsKey:f.INTERESTS},ENFORCED_CATEGORIES:{key:"enforcedCategories",dcsKey:f.ENFORCED_CATEGORIES}};f=g.BinningParams;g.excludeBinningParamsForEvents=[f.PRICE.key,f.DISCOUNT.key];f=g.SortOrders;g.SortOrderLists=
{Events:[f.BY_RELEVANCE,f.BY_BEST_SELLING,f.BY_PRICE_ASCENDING,f.BY_PRICE_DESCENDING],Deals:[f.BY_SCORE,f.BY_BEST_SELLING,f.BY_PRICE_ASCENDING,f.BY_PRICE_DESCENDING,f.BY_DISCOUNT_ASCENDING,f.BY_DISCOUNT_DESCENDING]};(function(d){d.BinningKeyToDCSQueryParamMap={};h.each(d.BinningParams,function(b){d.BinningKeyToDCSQueryParamMap[b.key]=b.dcsKey});d.FilterAttrToBinName={};h.each(h.keys(d.BinningParams),function(b){var a=d.BinningParams[b].key;d.FilterAttrToBinName[a]=a===d.BinningParams.NEW_RELEASES.key||
a===d.BinningParams.GIFT_WRAPPABLE.key?d.BinNames.INCLUDED_DEAL_TARGETS:d.BinNames[b]||null});d.BinNamesToCount=h.object(h.values(d.BinNames),h.values(d.BinCounts));d.FilterStatesToDealStates={};h.each(h.keys(d.DealStatesToFilterStates),function(b){var a=d.DealStatesToFilterStates[b];d.FilterStatesToDealStates[a]=d.FilterStatesToDealStates[a]?d.FilterStatesToDealStates[a].concat([b]):[b]})})(g);return g});q.when("A","gb-enums").register("gb-base-utils",function(g,n){return{locale:null,checkAndSetSSLImageUrl:function(f){if("https:"===
h.location.protocol&&f&&-1!==f.indexOf("http://")){var d=n.Constants.SECURE_IMAGES_URL_DEFAULT;gb.resources&&gb.resources.customerData&&"CN"===gb.resources.customerData.realm&&(d=n.Constants.SECURE_IMAGES_URL_CN);var b=document.createElement("a");b.href=f;b.protocol="https:";b.hostname=d;f=b.href}return f}}});q.when("A","GoldboxMobile3PAssets","gb-base-utils","gb-event-emitter","gb-config-manager","gb-template-manager","gb-utilities").register("gb-resources",function(g,n,f,d,b,a,c){h.gb.baseUtils=
h.gb.baseUtils||f;var e=n._;return new (d.extend({strings:{},images:{},features:{},customerData:{},categories:[],marketingIDs:[],deviceInfo:{},urls:{},whitelistedCategoryList:[],whitelistedCategoryNames:{},whitelistedCategoryNamesParsed:{},whitelistedMarketingIDList:[],whitelistedMarketingIDNames:{},whitelistedMarketingIDNamesParsed:{},apiConfigs:{},interests:{},hasResourceFetchInitiated:{},isAcceleratedExperience:!1,isMobileNotificationSubscriptionDisabled:!1,registerResources:function(d,k){var p=
this;e.extend(d,{widgetName:k});this.registerStrings(d.strings);this.registerFeatures(d.weblabs);this.registerCustomerData(d.customerData);e.isEmpty(d.categories)||this.registerCategories(d.categories);e.isEmpty(d.marketingIDs)||this.registerMarketingIDs(d.marketingIDs);this.registerDeviceInfo(d.deviceInfo);e.isEmpty(this.urls)&&this.registerUrls(d.urls);this.registerImages(d.images);this.registerAPIConfigs(d.apiConfigs);this.registerInterests(d.interests);this.isAcceleratedExperience=d.isAcceleratedExperience;
this.isMobileNotificationSubscriptionDisabled=d.isMobileNotificationSubscriptionDisabled;b.registerConfigs(d);a.registerTemplates(k,d.templates);this.hasResourceFetchInitiated[k]=!0;c.updateRedirectUrls(function(){p.register("gbResources");p.register(d.widget)})},registerStrings:function(a){this.updateResourceStore(this.strings,a)},getString:function(a,c){a=this.strings[a]||"";if(c)for(var e in c)c.hasOwnProperty(e)&&(a=a.replace(new RegExp("\\${"+e+"}","g"),c[e]));return a},getCategoryName:function(a,
c){return c?this.whitelistedCategoryNamesParsed[a]:this.whitelistedCategoryNames[a]||null},registerImages:function(a){e.each(a,function(c,e){a[e]=gb.baseUtils.checkAndSetSSLImageUrl(c)});this.updateResourceStore(this.images,a)},getImage:function(a){return this.images[a]},registerFeatures:function(a){this.updateResourceStore(this.features,a)},registerInterests:function(a){this.updateResourceStore(this.interests,a)},getFeature:function(a){return this.features[a]},registerCustomerData:function(a){this.updateResourceStore(this.customerData,
a)},getCustomerData:function(a){return this.customerData[a]},registerCategories:e.once(function(a){var c=this;this.updateResourceStore(this.categories,a);e.each(this.categories,function(a){c.whitelistedCategoryList.push(a.nodeId);c.whitelistedCategoryNames[a.nodeId]=a.category;c.whitelistedCategoryNamesParsed[a.nodeId]=e.unescape(a.category)})}),registerMarketingIDs:e.once(function(a){var c=this;this.updateResourceStore(this.marketingIDs,a);e.each(this.marketingIDs,function(a){c.whitelistedMarketingIDList.push(a.marketingID);
c.whitelistedMarketingIDNames[a.marketingID]=a.string;c.whitelistedMarketingIDNamesParsed[a.marketingID]=e.unescape(a.string)})}),getCategories:function(){return this.categories},registerDeviceInfo:function(a){this.updateResourceStore(this.deviceInfo,a);gb.clientName="pc";this.deviceInfo.isApp?gb.clientName="app":this.deviceInfo.isPhone&&!this.deviceInfo.isAWDesktopViewEnforced&&(gb.clientName="aw")},getDeviceInfo:function(){return this.deviceInfo},registerUrls:function(a){this.updateResourceStore(this.urls,
a)},getUrl:function(a){return this.urls[a]},updateResourceStore:function(a,c){if(c&&a)for(var e in c)c.hasOwnProperty(e)&&(a[e]=c[e])},registerAPIConfigs:function(a){this.updateResourceStore(this.apiConfigs,a)},getAPIConfigs:function(){return this.apiConfigs},getInterests:function(){return e.values(this.interests)}}))});q.when("A","GoldboxMobile3PAssets","gb-csm","p-detect").register("gb-utilities",function(g,n,f,d){var b=n._;return{digitalCategories:{US:"16261631 2350149011 154606011 163856011 979455011 1233514011 2402172011".split(" ")},
digitalGlProductGroup:"gl_digital_book_service gl_digital_ebook_purchase gl_digital_music_purchase gl_digital_video_download gl_downloadable_software gl_ebooks gl_digital_video_games gl_mobile_apps gl_digital_software".split(" "),ebookGlProductGroup:["gl_digital_ebook_purchase","gl_ebooks"],defaultImageScaling:"AA",detailPageUrlPrefix:{pc:"/dp/",aw:"/gp/aw/d/",app:"/gp/aw/d/",tablet:"/gp/mobile/udp/"},requestObjSortBy:{includedBins:"name",dealGroups:"keys",excludedExtendedFilters:"keys",extendedFilters:"keys",
exclusiveTargetValues:"name",inclusiveTargetValues:"name",dealTargets:"dealID"},stateToDealViewTemplates:{PRIME_EARLY_ACCESS:{LOADING:[],AVAILABLE:"image inwaitlist waitlistfull waitlistavailable claimed pendingatc title description reviewStars priceBlock ifdMessage button time percentClaimed percentClaimedBar dealType primeEarlyAccess couponCount checkingDealStatus incart merchant dpLink primeBadge shipSold percentOff primeTime selector badge dealAction cartMessage widgetErrorAlert secondaryBadge".split(" "),
COMINGSOON:"image title description reviewStars merchant primeBadge shipSold dealType".split(" "),UPCOMING:"image title time description reviewStars primeEarlyAccess primeBadge shipSold dealType primeTime badge dealAction watchButton".split(" "),SOLDOUT:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" "),EXPIRED:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" ")},
APP_EARLY_ACCESS:{LOADING:[],AVAILABLE:"appEarlyAccess image inwaitlist waitlistfull waitlistavailable claimed pendingatc title description reviewStars priceBlock ifdMessage button time percentClaimed percentClaimedBar dealType couponCount checkingDealStatus incart merchant dpLink primeBadge shipSold percentOff selector badge dealAction cartMessage widgetErrorAlert secondaryBadge".split(" "),COMINGSOON:"image title description reviewStars merchant primeBadge shipSold dealType".split(" "),UPCOMING:"appEarlyAccess image title time description reviewStars primeBadge shipSold dealType badge dealAction watchButton".split(" "),
SOLDOUT:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" "),EXPIRED:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" ")},PRIME_ONLY_LD:{LOADING:[],AVAILABLE:"image inwaitlist waitlistfull waitlistavailable claimed pendingatc title description reviewStars priceBlock ifdMessage button time percentClaimed percentClaimedBar dealType couponCount checkingDealStatus incart merchant dpLink primeBadge shipSold primeOnlyAccess percentOff primeTime selector badge dealAction cartMessage widgetErrorAlert secondaryBadge".split(" "),
COMINGSOON:"image title description reviewStars merchant primeBadge shipSold dealType".split(" "),UPCOMING:"image title time description reviewStars primeBadge shipSold dealType primeOnlyAccess primeTime badge dealAction watchButton".split(" "),SOLDOUT:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" "),EXPIRED:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" ")},
PRIME_ONLY_DOTD:{LOADING:[],AVAILABLE:"image inwaitlist waitlistfull waitlistavailable claimed pendingatc title description reviewStars priceBlock ifdMessage button time percentClaimed percentClaimedBar dealType couponCount checkingDealStatus incart merchant dpLink primeBadge shipSold primeOnlyAccess percentOff primeTime selector badge dealAction cartMessage widgetErrorAlert secondaryBadge".split(" "),COMINGSOON:"image title description reviewStars merchant primeBadge shipSold dealType".split(" "),
UPCOMING:"image title time description reviewStars primeBadge shipSold dealType primeOnlyAccess primeTime badge dealAction watchButton".split(" "),SOLDOUT:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" "),EXPIRED:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" ")},
PRIME_ONLY_BD:{LOADING:[],AVAILABLE:"image inwaitlist waitlistfull waitlistavailable claimed pendingatc title description reviewStars priceBlock ifdMessage button time percentClaimed percentClaimedBar dealType couponCount checkingDealStatus incart merchant dpLink primeBadge shipSold primeOnlyAccess percentOff primeTime selector badge dealAction cartMessage widgetErrorAlert secondaryBadge".split(" "),COMINGSOON:"image title description reviewStars merchant primeBadge shipSold dealType".split(" "),
UPCOMING:"image title time description reviewStars primeBadge shipSold dealType primeOnlyAccess primeTime badge dealAction watchButton".split(" "),SOLDOUT:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" "),EXPIRED:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" ")},
APP_ONLY_LD:{LOADING:[],AVAILABLE:"appOnlyAccess image inwaitlist waitlistfull waitlistavailable claimed pendingatc title description reviewStars priceBlock ifdMessage button time percentClaimed percentClaimedBar dealType couponCount checkingDealStatus incart merchant dpLink primeBadge shipSold percentOff selector badge dealAction cartMessage widgetErrorAlert secondaryBadge".split(" "),COMINGSOON:"image title description reviewStars merchant primeBadge shipSold dealType".split(" "),UPCOMING:"appOnlyAccess image title time description reviewStars primeBadge shipSold dealType badge dealAction watchButton".split(" "),
SOLDOUT:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" "),EXPIRED:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" ")},GIVEAWAY_DEAL:{LOADING:[],AVAILABLE:"image title description priceBlock ifdMessage button giveaway dealType merchant selector dealAction widgetErrorAlert secondaryBadge".split(" "),
COMINGSOON:[],UPCOMING:[],SOLDOUT:[],EXPIRED:"image title description priceBlock button giveaway dealType merchant selector dealAction widgetErrorAlert".split(" ")},NONE:{LOADING:[],AVAILABLE:"image inwaitlist waitlistfull waitlistavailable claimed pendingatc title description reviewStars priceBlock ifdMessage button time percentClaimed percentClaimedBar dealType couponCount checkingDealStatus incart merchant dpLink primeBadge shipSold percentOff selector badge dealAction cartMessage widgetErrorAlert secondaryBadge".split(" "),
COMINGSOON:"image title description reviewStars merchant primeBadge shipSold dealType".split(" "),UPCOMING:"image title time description reviewStars primeBadge shipSold dealType badge dealAction watchButton".split(" "),SOLDOUT:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" "),EXPIRED:"image title priceBlock ifdMessage percentClaimed percentClaimedBar description reviewStars merchant shipSold dealType time percentOff badge dealAction couponCount primeBadge".split(" ")}},
picassoClickAttributes:["qualifier","id","adId","widgetName"],price:{CA:{currency:"CAD",decimal:2,thousandSeparator:"",decimalSeparator:".",format:function(a){return"C$"+a}},US:{currency:"USD",decimal:2,thousandSeparator:",",decimalSeparator:".",format:function(a){return"$"+a}},UK:{currency:"GBP",decimal:2,thousandSeparator:",",decimalSeparator:".",format:function(a){return"\x26pound;"+a}},DE:{currency:"EUR",decimal:2,thousandSeparator:".",decimalSeparator:",",format:function(a){return a+" \x26euro;"}},
FR:{currency:"EUR",decimal:2,thousandSeparator:".",decimalSeparator:",",format:function(a){return a+" \x26euro;"}},JP:{currency:"JPY",decimal:0,thousandSeparator:",",decimalSeparator:".",format:function(a){return"\x26yen; "+a}},CN:{currency:"CNY",decimal:2,thousandSeparator:",",decimalSeparator:".",format:function(a){return"\x26yen;"+a}},IN:{currency:"INR",decimals:2,thousandSeparator:",",decimalSeparator:".",format:function(a){return"\x26#8377;"+a}},IT:{currency:"EUR",decimal:2,thousandSeparator:".",
decimalSeparator:",",format:function(a){return a+" \x26euro;"}},ES:{currency:"EUR",decimal:2,thousandSeparator:".",decimalSeparator:",",format:function(a){return a+" \x26euro;"}},MX:{currency:"MXN",decimal:2,thousandSeparator:",",decimalSeparator:".",format:function(a){return"$"+a}},BR:{currency:"BRL",thousandSeparator:".",decimalSeparator:",",decimal:2,format:function(a){return"R$ "+a}},AU:{currency:"AUD",decimal:2,thousandSeparator:",",decimalSeparator:".",format:function(a){return"$"+a}},TR:{currency:"TRY",
decimal:2,thousandSeparator:".",decimalSeparator:",",format:function(a){return a+" TL"}},AE:{currency:"AED",decimal:2,thousandSeparator:",",decimalSeparator:".",format:function(a){return"ar_AE"===gb.resources.customerData.locale?a+" درهم":"AED "+a}}},ppuRealms:["UK","DE","FR","ES","IT"],getAppStoreURL:function(){var a="";gb.resources.deviceInfo.isApp&&(gb.resources.deviceInfo.isIOS?a=gb.enums.AppStoreLink.iOS:gb.resources.deviceInfo.isAndroid&&(a=gb.enums.AppStoreLink.android));return a},_formatPrice:function(a,
c){a=parseFloat(a);a=void 0!==c.decimal||null!==c.decimal?a.toFixed(c.decimal):a.toString();a=a.split(".");for(var e=a[0],b=e.length-3;0<b;b-=3)e=e.substr(0,b)+c.thousandSeparator+e.substr(b,e.length-b);return c.format(2===a.length?e+c.decimalSeparator+a[1]:e)},getFormattedPrice:function(a){var c=gb.resources.getCustomerData("realm"),c=this.price[c],e=document.createElement("span");g.$(e).html(this._formatPrice(a,c));return e.innerHTML},isEbook:function(a){return b.contains(gb.utils.ebookGlProductGroup,
a)},getPriceRange:function(a){var c=null;a.max.value>a.min.value&&(c=a.min.formattedValue+" - "+a.max.formattedValue);return c},getSubnavPageElementFromDomID:function(a){return g.$("#"+g.$("#"+a).parent().parent().prop("id"))},getSubnavSlotID:function(a,c){return gb.subnavController.SubnavIDs.SubnavPage+a+"slot"+c},parseBool:function(a){return!0===a||1===a||"1"===a},getDealViewID:function(a,c){return a+"_dealView_"+c},getAdRowID:function(a,c){return gb.metrics.widgetMetricsParams[a].slotName+gb.enums.Constants.AD_SLOT_INFIX+
c},generateListenerForEmbeddedWidget:function(a){return gb.enums.Constants.REMOTE_WIDGET_EVENT_PREFIX+a},getPageID:function(a,c){return a+"_page_"+c},getFilterItemViewID:function(a,c){return"FilterItemView_"+a.join("-")+"_"+c},resizeImage:function(a,c,e){a=a||gb.resources.getImage("goldbox_upcoming");a.substring(a.lastIndexOf(".")+1).toLowerCase()in{jpg:!0,jpeg:!0,png:!0,gif:!0,tif:!0}||(a=gb.resources.getImage("goldbox_upcoming"));if(void 0===c||null===c)return a;if(void 0===e||null===e)e=this.defaultImageScaling;
return a.replace(/\.((_.*_)\.)?(\w+)$/,".$2_"+e+c+"_.$3")},getViewTemplatesForState:function(a){var c=gb.enums.DealStateToTemplateMap[a.dealState];return a.dealType===gb.enums.DealTypes.EVENT?c===gb.enums.DealStates.LOADING?this.stateToDealViewTemplates.NONE.LOADING:this.stateToDealViewTemplates.NONE.AVAILABLE:a.detail.isPrimeOnly&&!gb.utils.isPODealForNonPrimeUser(a)||!a.detail.accessType?this.stateToDealViewTemplates.NONE[c]||[]:this.stateToDealViewTemplates[a.detail.accessType][c]||[]},getStateTemplateName:function(a,
c){return c===gb.enums.DealTypes.EVENT?a===gb.enums.DealStates.LOADING?gb.enums.StateTemplates.LOADING:gb.enums.StateTemplates.AVAILABLE:gb.enums.StateTemplates[a]},calculatePercentOff:function(a,c){if(null===a||void 0===a||null===c||void 0===c||"number"!==typeof a||"number"!==typeof c||0===a)return null;var e=a-c;if(0>=e)return null;c=0;"CN"===gb.resources.getCustomerData("realm")?(c=1,a=10*(1-e/a)):a=e/a*100;return Math.round(a*Math.pow(10,c))/Math.pow(10,c)},getDisplayablePercentOff:function(a){return a&&
"number"===typeof a?"CN"===gb.resources.getCustomerData("realm")?(100-a)/10:a:null},heroTimer:function(a,c,e,b){a={dealDate:a,viewElement:c,spanID:e,update:function(){var a=this,d=a.dealDate.getTime()-(new Date).getTime();0>d&&(d=0);var u=Math.floor(d/gb.enums.Constants.HOUR_IN_MILLIS),f=Math.floor(d/gb.enums.Constants.MINUTE_IN_MILLIS%60),d=Math.floor(d/gb.enums.Constants.SECOND_IN_MILLIS%60);if(b)10>d&&(d="0"+d),10>f&&(f="0"+f),a.timeString=0!==u?u+":"+f+":"+d:f+":"+d;else{10>u&&(u="0"+u);10>f&&
!a.noHours&&(f="0"+f);10>d&&(d="0"+d);var D=gb.resources.getString("gbd_hour_separator")+" ",n=gb.resources.getString("gbd_minute_separator")+" ",t=gb.resources.getString("gbd_seconds_separator")+" ";a.timeString=u+D+f+n+d+t;gb.accessibility.trigger("AccessibilityAction","updateHeroTimer",{viewElement:c,spanID:e,timerInfo:{hours:u,minutes:f,seconds:d}})}g.$(c).find("#"+e).html(a.timeString);a.timeout&&h.clearTimeout(a.timeout);a.timeout=h.setTimeout(function(){a.update()},500)}};a.update();return a},
formatDate:function(a){var c=gb.resources.getString("gb_month_"+a.getMonth());a=a.getDate();10>a&&(a="0"+a);return gb.resources.getString("gb_date_format",{month:c,day:a,date_suffix:gb.resources.getString("gb_date")})},formatTime:function(a,c){var e="";if(24<a)return e;var e=gb.resources.getCustomerData("realm"),d=12<=a?gb.resources.getString("gb_pm"):gb.resources.getString("gb_am"),k=b.contains([gb.enums.Realms.US,gb.enums.Realms.UK,gb.enums.Realms.IN,gb.enums.Realms.MX],e)?!1:!0;10>c&&(c="0"+c);
k?(10>a&&(e===gb.enums.Realms.DE||e===gb.enums.Realms.FR)&&(a="0"+a),d=""):a=a%12||12;return e=gb.resources.getString("gb_time",{hours:a,minutes:c,period:d})},ellipsify:function(a){var c=a.el,e=a.jQuery,b=a.wordsIntact;a=a.removeDots;var d=c.clone().empty().css({display:"none",height:"auto"}).width(c.width());c.width(c.width());e(c).after(d);var p=e.trim(c.html());d.html(p);if(!(d.height()<=c.height())){d.empty();for(var u=0,f=0,g=p.length;u<p.length&&f<g;)u=Math.floor((f+g)/2),a?d.html(p.substr(0,
u)):d.html(p.substr(0,u)+"..."),d.height()<=c.height()?f=u+1:g=u-1;p=p.substr(0,f-1);b&&(b=p.lastIndexOf(" "),p=p.substr(0,b));a||(p+="...");c.html(p)}e(d).remove()},setUrlParam:function(a,c,e){var b=a.indexOf("#"),d=-1===b?"":a.substr(b);a=-1===b?a:a.substr(0,b);c=encodeURIComponent(c);var b=new RegExp("([?\x26])"+c+"\x3d.*?(\x26|$)","i"),p=-1!==a.indexOf("?")?"\x26":"?";a=a.match(b)?a.replace(b,"$1"+c+"\x3d"+e+"$2"):a+p+c+"\x3d"+e;return a+d},clearUrlParam:function(a,c){var e=a.indexOf("#"),b=-1===
e?"":a.substr(e);a=-1===e?a:a.substr(0,e);c=encodeURIComponent(c);c=new RegExp("([?\x26])"+c+"\x3d.*?(\x26|$)","gi");a.match(c)&&(a=a.replace(c,"$1"),a=a.replace(/[?&]$/,""));return a+b},enforceUTFEncodingInUrl:function(a){a=this.clearUrlParam(a,"ie");return this.setUrlParam(a,"ie","UTF8")},setUrlHash:function(a,c){var e=a.indexOf("#");a=-1===e?a:a.substr(0,e);return c?a+"#"+c:a},setSafeTimeout:function(a,c){if(0<c&&c<gb.enums.Constants.MAX_TIMEOUT)return h.setTimeout(a,c)},getDetailPageURL:function(a,
c){c=this.detailPageUrlPrefix[c]+a;gb.resources.deviceInfo.isApp&&!gb.resources.deviceInfo.isIPhone&&(c=gb.utils.setUrlParam(c,"app-action","detail"),c=gb.utils.setUrlParam(c,"asin",a));return c},hasConflictingDpParams:function(a){var c=!1;a=a.split("?")[1]?"\x26"+a.split("?")[1]:null;var e=["smid","m","me"];if(a)for(var b=0;b<e.length;b++)if(0<=a.indexOf("\x26"+e[b]+"\x3d")){c=!0;break}return c},getSponsoredDealUrl:function(a,c){for(var e=gb.enums.SponsoredDealURL.picassoRedirect,b=this.picassoClickAttributes,
d=0;d<b.length;d++)a[b[d]]&&(e=this.setUrlParam(e,b[d],a[b[d]]));a=encodeURIComponent(c);return e=this.setUrlParam(e,"url",a)},isSponsoredDeal:function(a,c){return b.isEmpty(c)?!1:(c=c.dealsWithBids)&&c[a]?!0:!1},getCookie:function(a){return(a=document.cookie.match(new RegExp("(^| )"+a+"\x3d([^;]+)")))?a[2]:""},getReviewsPageURL:function(a,c){return gb.enums.ReviewsPageURL[gb.clientName]+a},getShovelerWidth:function(a){var c=gb.configManager.getDealViewConfig(a.widgetID),e=gb.configManager.getWidgetViewConfig(a.widgetID),
b=parseInt(c.dealsLimit,10),d=parseInt(c.imageSize,10),p=parseInt(c.dealsMargin,10),c=parseInt(e.redirectDivWidth,10),u=parseInt(e.redirectDivLeftMargin,10),f=parseInt(e.redirectDivRightMargin,10),e=0;a.totalDealsToShowCount>b?(a=b-6,d=(d+p)*a+u+c+f,e=1):(a=a.totalDealsToShowCount,d=(d+p)*a);return{redirectDivWidth:c,showRedirectDiv:e,shovelerDealsToShow:a,shovelerWidth:d}},pushAddressInBrowserHistory:function(a,c,e){return h.history&&"function"===typeof history.pushState&&"function"===typeof history.replaceState?
(e=e||{},e.attribution=gb.enums.BrowserHistory.ATTRIBUTION,c?(b.isEmpty(h.history.state)&&h.history.replaceState({state:"initialLoad",attribution:gb.enums.BrowserHistory.ATTRIBUTION},"",h.location.href),h.history.pushState(e,"",a)):h.history.state&&h.history.state.bottom_sheet_open?h.setTimeout(function(){h.history.replaceState(e,"",a)},1E3):h.history.replaceState(e,"",a),gb.metrics.recordRefViaAjax(this.extractRefFromUrl(a)),!0):!1},updateAddressBarUrl:function(a,c,e){this.pushAddressInBrowserHistory(a,
c,e)?this.updateRedirectUrls():h.location.href=a},getCurrentRelativeURL:function(){return h.location.pathname+h.location.search},updateRedirectUrls:function(a){var c=this;q.when("gb-config-manager").execute("gb-utilities-updateRedirectUrls",function(e){try{var d=e.redirectURLConfigs,k={},p=c.getCurrentRelativeURL(),u=h.escape(h.btoa(p));b.each(d.base64encodedUrls,function(a){var c=gb.resources.getUrl(a);c&&(k[a]=c.replace(c.match(/redirectURL=([^&?]*)/)[1],u))});b.each(d.encodedURIComponents,function(a){var c=
gb.resources.getUrl(a);if(c){var e=c.match(/query=([^&?]*)/)[1];if(e){var b=decodeURIComponent(e);b&&(p=encodeURIComponent(p),b=b.replace(b.match(/dest=([^&?]*)/)[1],p),k[a]=c.replace(e,encodeURIComponent(b)))}}});gb.resources.registerUrls(k);a&&a()}catch(f){a&&a(),q.log("GBUtilities - Redirection url updates failed","ERROR","GoldboxMobileAssets")}})},getParamValueFromUrl:function(a,c){c=c.replace(/[\[]/,"[").replace(/[\]]/,"]");return(a=(new RegExp("[\\?\x26]"+c+"\x3d([^\x26#]*)")).exec(a))?h.decodeURIComponent(a[1].replace(/\+/g,
" ")):""},getHashOfAppliedFilters:function(a){var c={};a=a.split(",");for(var e=0;e<a.length;e++){var b=a[e].split(":");c[b[0]]=b[1]}return c},_getFiltersAppliedUrl:function(a,c,e,b){return this.setUrlParam(h.location.href,gb.enums.BrowserHistory.STATE_KEY+a,gb.enums.CustomerAppliedFilters.PAGE+":"+c+","+gb.enums.CustomerAppliedFilters.CATEGORY+":"+e+","+gb.enums.CustomerAppliedFilters.STATUS+":"+b)},updateFiltersInAddressBar:function(a,c,e,b){a=this._getFiltersAppliedUrl(a,c,e,b);this.updateAddressBarUrl(a)},
getWidgetLandingPageUrl:function(a){return this.getParamValueFromUrl(h.location.href,gb.enums.BrowserHistory.STATE_KEY+a)?this._getFiltersAppliedUrl(a,1,gb.enums.CategoryFilters.ALL,gb.enums.StatusFilters.AVAILABLE):h.location.href},updateTemplateInfoForAcceleratedExperience:function(a){gb.resources.isAcceleratedExperience&&(a.buttonText=gb.resources.getString("gb_view_deal"),a.showPercentClaimed=!1,a.showWaitlistFeatures=!1,a.purchaseState=gb.enums.PurchaseStates.SEE_DEAL)},getCustomerActionTemplateInfo:function(a,
c){var e=a.dealState,b=a.detail.itemType,d=a.status.percentClaimed,p=a.customerState,u=a.dealType,f={},g=!0,h=!0,n=!0,q=!1,y=gb.resources.deviceInfo,z=gb.configManager.getDealViewConfig(c);f.showWatchDealButton=!1;gb.controller.schedulingParams[c]&&gb.controller.schedulingParams[c].fetchWatchedDeals&&u===gb.enums.DealTypes.LD&&(f.showWatchDealButton=!0);if(b===gb.enums.ItemTypes.SINGLE)if(u===gb.enums.DealTypes.LD)switch(q=this._shouldShowWaitlistFeatures(y),e===gb.enums.DealStates.AVAILABLE?(f.purchaseState=
gb.enums.PurchaseStates.ADD_TO_CART,f.buttonText=gb.resources.getString("gb_add_to_cart")):(f.purchaseState=gb.enums.PurchaseStates.SEE_DEAL,f.buttonText=gb.resources.getString("gb_view_deal")),q&&(e===gb.enums.DealStates.WAITLIST?(f.purchaseState=gb.enums.PurchaseStates.JOIN_WAITLIST,f.buttonText=gb.resources.getString("gbd_join_waitlist")):e===gb.enums.DealStates.WAITLISTFULL&&(f.purchaseState=gb.enums.PurchaseStates.WAITLIST_FULL,g=null),p===gb.enums.CustomerStates.INWAITLIST&&(f.purchaseState=
gb.enums.PurchaseStates.INWAITLIST,f.buttonText=gb.resources.getString("gb_add_to_cart"),g=null,n=!this.isTablet(gb.clientName))),p){case gb.enums.CustomerStates.INCART:f.purchaseState=gb.enums.PurchaseStates.INCART;g=null;n=!this.isTablet(gb.clientName);h=null;break;case gb.enums.CustomerStates.CLAIMED:f.purchaseState=gb.enums.PurchaseStates.CLAIMED;g=null;n=!this.isTablet(gb.clientName);h=null;break;case gb.enums.CustomerStates.PENDINGATC:f.purchaseState=gb.enums.PurchaseStates.PENDINGATC,f.buttonText=
gb.resources.getString("gb_add_to_cart"),n=!this.isTablet(gb.clientName),h=null}else n=!this.isTablet(gb.clientName),f.purchaseState=gb.enums.PurchaseStates.ADD_TO_CART,f.buttonText=gb.resources.getString("gb_add_to_cart");else if(b===gb.enums.ItemTypes.VARIATION){if(n=!0,c=gb.resources.deviceInfo.isPhone,e=gb.utils.isTablet(gb.clientName),f.purchaseState=gb.enums.PurchaseStates.SEE_DEAL,f.buttonText=gb.resources.getString("gb_see_options"),c||e&&gb.resources.deviceInfo.isApp)f.buttonText=gb.resources.getString("gb_view_deal")}else b===
gb.enums.ItemTypes.MULTI?(n=!this.isTablet(gb.clientName),f.buttonText=gb.resources.getString("gb_view_deal")):(f.buttonText=u===gb.enums.DealTypes.COUPON?gb.resources.getString("gb_clip_coupon"):gb.resources.getString("gb_view_deal"),n=!this.isTablet(gb.clientName)),f.purchaseState=gb.enums.PurchaseStates.SEE_DEAL;f.showButton=g;f.showTime=h;f.showPercentClaimed=n;f.showWaitlistFeatures=q;b===gb.enums.ItemTypes.SINGLE&&a.isDigital&&(f.purchaseState=gb.enums.PurchaseStates.SEE_DEAL,f.buttonText=gb.resources.getString("gb_view_deal"),
b=gb.resources.getString("gb_view_ebook_edition"),a.isEBook&&b&&(f.buttonText=b));if(this._isPurchaseStateOverrideRequiredForAppDeals(a,p)||this._isPurchaseStateOverrideRequiredForPrimeDeals(a))f.purchaseState=gb.enums.PurchaseStates.LEARN_MORE,f.buttonText=gb.resources.getString("gb_learn_more"),f.showButton=!0,f.showTime=!0,f.showPercentClaimed=a.detail.accessType!==gb.enums.DealAccessTypes.PRIME_ONLY_DOTD&&a.detail.accessType!==gb.enums.DealAccessTypes.PRIME_ONLY_BD?!0:!1;f.primeSignUpUrl=this.getPrimeSignUpUrlForAccessType(a);
f.appDownloadUrl=gb.enums.appDownloadURL;f.showPercentClaimed=f.showPercentClaimed&&this._shouldShowPercentClaimed(d,z);this._setTemplateDataForMetroApp(f);f.shouldDisplayIFDMessage=this.shouldDisplayIFDMessage(a);this.updateTemplateInfoForAcceleratedExperience(f);return f},_shouldShowWaitlistFeatures:function(a){var c=a.isIOS,e=a.isAndroid||a.isAndroidUserAgent,b=a.isFirePhone,d=a.isPhone,p=this.isTablet(gb.clientName);a=a.isAppVersionHigher;var f=gb.resources.getFeature("waitlist_feature_mobile_IOS"),
r=gb.resources.getFeature("waitlist_feature_tablet_IOS"),g=gb.resources.getFeature("waitlist_feature_mobile_Android"),h=gb.resources.getFeature("waitlist_feature_tablet_Android");return gb.clientName===gb.enums.MobileClients.PC?!0:b&&a&&h||p&&a&&(c&&r||e&&h)||d&&(c&&f||e&&g)},_isPurchaseStateOverrideRequiredForAppDeals:function(a,c){return(a.detail.accessType===gb.enums.DealAccessTypes.APP_EARLY_ACCESS&&this.isDealInEarlyAccessWindow(a)||a.detail.accessType===gb.enums.DealAccessTypes.APP_ONLY_LD)&&
c!==gb.enums.CustomerStates.INCART&&c!==gb.enums.CustomerStates.CLAIMED?!0:!1},_isPurchaseStateOverrideRequiredForPrimeDeals:function(a){return(this.isDealInEarlyAccessWindow(a)&&a.detail.accessType===gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS||a.detail.isPrimeOnly)&&!gb.resources.customerData.hasEarlyAccessBenefit?!0:!1},getVariationCustomerActionTemplateInfo:function(a,c){var e=a.deal,b=e.detail.itemType,d=e.dealState,d=c?c.status.itemState:d,p=c?c.status.percentClaimed:e.status.percentClaimed;
c=c?c.status.customerState:e.customerState;var f={},r=!0,g=!0,h=!0,n=!1;a=a.widgetView.widgetID;var q=gb.configManager.getDealViewConfig(a);if(e.dealType===gb.enums.DealTypes.LD&&b===gb.enums.ItemTypes.VARIATION){if(gb.clientName===gb.enums.MobileClients.PC||gb.widgets[a].widgetName===gb.enums.WidgetNames.ML_HERO)n=!0;f.showWatchDealButton=!1;gb.controller.schedulingParams[a]&&gb.controller.schedulingParams[a].fetchWatchedDeals&&(f.showWatchDealButton=!0);if(d===gb.enums.DealStates.AVAILABLE||d===
gb.enums.DealStates.SOLDOUT)f.purchaseState=gb.enums.PurchaseStates.ADD_TO_CART,f.buttonText=gb.resources.getString("gb_add_to_cart");n&&(d===gb.enums.DealStates.WAITLIST?(f.purchaseState=gb.enums.PurchaseStates.JOIN_WAITLIST,f.buttonText=gb.resources.getString("gbd_join_waitlist")):d===gb.enums.DealStates.WAITLISTFULL&&(f.purchaseState=gb.enums.PurchaseStates.WAITLIST_FULL,r=null),c===gb.enums.CustomerStates.INWAITLIST&&(f.purchaseState=gb.enums.PurchaseStates.INWAITLIST,f.buttonText=gb.resources.getString("gb_add_to_cart"),
r=null,h=!this.isTablet(gb.clientName)));c===gb.enums.CustomerStates.INCART?(f.purchaseState=gb.enums.PurchaseStates.INCART,r=null,h=!this.isTablet(gb.clientName),g=null):c===gb.enums.CustomerStates.CLAIMED?(f.purchaseState=gb.enums.PurchaseStates.CLAIMED,r=null,h=!this.isTablet(gb.clientName),g=null):c===gb.enums.CustomerStates.PENDINGATC&&(f.purchaseState=gb.enums.PurchaseStates.PENDINGATC,f.buttonText=gb.resources.getString("gb_add_to_cart"),h=!this.isTablet(gb.clientName),g=null)}f.showButton=
r;f.showTime=g;f.showPercentClaimed=h;f.showWaitlistFeatures=n;if(e.detail.accessType===gb.enums.DealAccessTypes.APP_EARLY_ACCESS&&this.isDealInEarlyAccessWindow(e)||e.detail.accessType===gb.enums.DealAccessTypes.APP_ONLY_LD||(this.isDealInEarlyAccessWindow(e)||e.detail.isPrimeOnly)&&!gb.resources.customerData.hasEarlyAccessBenefit)if(f.purchaseState=gb.enums.PurchaseStates.LEARN_MORE,f.buttonText=gb.resources.getString("gb_learn_more"),f.showButton=!0,f.showTime=!0,f.showPercentClaimed=!0,e.detail.accessType===
gb.enums.DealAccessTypes.PRIME_ONLY_DOTD||e.detail.accessType===gb.enums.DealAccessTypes.PRIME_ONLY_BD)f.showPercentClaimed=!1;f.primeSignUpUrl=this.getPrimeSignUpUrlForAccessType(e);f.appDownloadUrl=gb.enums.appDownloadURL;f.showPercentClaimed=f.showPercentClaimed&&this._shouldShowPercentClaimed(p,q);this._setTemplateDataForMetroApp(f);f.shouldDisplayIFDMessage=this.shouldDisplayIFDMessage(e);this.updateTemplateInfoForAcceleratedExperience(f);return f},getPrimeSignUpUrlForAccessType:function(a){return(a=
gb.enums.PrimeSignUpURL[a.detail.accessType])?gb.resources.getUrl(a):null},isShowPercentageOffEnabled:function(){return gb.resources.getCustomerData("realm")===gb.enums.Realms.CN?!1:!0},getRandomNumber:function(a,c){return Math.floor(Math.random()*(c-a+1))+a},isDealInEarlyAccessWindow:function(a){var c=!1;a.status.dates.end.getTime();(new Date).getTime();var e=a.status.dates.start.getTime()-(new Date).getTime();(a.detail.accessType===gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS||a.detail.accessType===
gb.enums.DealAccessTypes.APP_EARLY_ACCESS)&&0>=e&&-e<a.detail.accessDurationInMs&&(c=!0);return c},isPrimeSignupRedirectSupported:function(){var a=!0;gb.resources.deviceInfo.isIOS&&gb.resources.deviceInfo.isApp&&"CN"!==gb.resources.getCustomerData("realm")&&(a=!1);return a},isPEADealForNonPrimeUser:function(a){return a.detail.isPrimeEarlyAccessDeal&&gb.utils.isDealInEarlyAccessWindow(a)&&!gb.resources.getCustomerData("isPrimeMember")?!0:!1},isPODealForNonPrimeUser:function(a){return a.detail.isPrimeOnly&&
!gb.resources.getCustomerData("isPrimeMember")?!0:!1},isTablet:function(a){return gb.resources.deviceInfo.isApp&&!gb.resources.deviceInfo.isPhone||a===gb.enums.Platforms.TAB?!0:!1},isDOTDDeal:function(a){return a.dealType===gb.enums.DealTypes.DOTD||a.detail.accessType===gb.enums.DealAccessTypes.PRIME_ONLY_DOTD},getDealsPerRow:function(a,c,e,b,d){a=this.getWindowWidth(a,{hasMargin:e});a=Math.floor(a/c);b?a-=a%2:d||(5===a?a=4:6<=a&&(a=6));return a},getWindowWidth:function(a,c){if(c)for(var e in c)c.hasOwnProperty(e)&&
"hasMargin"===e&&c[e]&&(a*=.9);return a},getWindowLocationOrigin:function(){h.location.origin||(h.location.origin=h.location.protocol+"//"+h.location.hostname+(h.location.port?":"+h.location.port:""));var a=h.location.origin;a||(a=h.location.protocol+"//"+h.location.hostname,h.location.port&&(a=h.location.origin+":"+h.location.port));return a},isUnsupportedEgressURL:function(a){var c=!1,e=gb.enums.Constants.EGRESS_URL_UNSUPPORTED_REGEX;(a.itemType===gb.enums.ItemTypes.MULTI||a.type===gb.enums.DealTypes.BD&&
a.itemType===gb.enums.ItemTypes.NONE)&&e.test(a.egressUrl)&&(c=!0);return c},getAsinFromURL:function(a){var c=document.createElement("a");c.href=a;return(a=c.pathname.match(gb.enums.Constants.EXTRACT_ASIN_URL_REGEX))&&2<a.length?a[2]:""},getReviewStars:function(a){if(null===a||void 0===a||0>a||5<a)a=0;var c=Math.floor(a);a=parseFloat(a-c).toFixed(1);var e=!1;a>gb.enums.RoundedReviewStarsThresholds.HIGH?c+=1:a>=gb.enums.RoundedReviewStarsThresholds.LOW&&(e=!0);return{fullStars:c,hasHalfStar:e}},sendLogData:function(a,
c){h.navigator&&navigator.sendBeacon?navigator.sendBeacon(a,c):g.$.ajax({url:a,data:c,async:!1})},getFilterViewIDs:function(a){var c=this,e={};b.each(a,function(a){var d=b.map(a.attr.split(","),g.$.trim);e[d.join("_")]=c.getFilterItemViewID(d,a.type)});return e},getExtendedArray:function(a,c,e,b){a=void 0!==b?this.getExtendedArray(a,b):Array(a);void 0===e&&(e=0);Array.prototype.splice.apply(a,[e,c.length].concat(c));return a},getFilterAttributesList:function(a){return b.flatten(b.map(a,function(a){return b.map(a.attr.split(","),
function(a){return a.trim()})}))},getIncludedBins:function(a){a=this.getFilterAttributesList(a);a=b.filter(b.map(a,function(a){return gb.enums.FilterAttrToBinName[a]}),function(a){if(a)return a});a=b.uniq(a);return b.map(a,function(a){return{name:a,count:gb.enums.BinNamesToCount[a]}})},getBoundingRect:function(a){if(!a)return!1;a=document.getElementById(a);if(!a||"none"===g.$(a).css("display"))return!1;a=a.getBoundingClientRect();return!a||0===a.top&&0===a.bottom&&0===a.left&&0===a.right?!1:a},filterDealsByViewport:function(a){var c=
{},e=this;b.each(gb.watcher.dealsInView,function(a,d){b.each(a,function(a,b){a=e.getDealViewID(b,a);c[a]=d})});var d=gb.utils.getDealViewsInViewport(c,1);return b.intersection(a,d)},getDealViewsInViewport:function(a,c){var e=this,d=g.$(h).height(),k=g.$(h).width(),p=[];b.each(a,function(a,b){(b=e.getBoundingRect(b))&&b.top>=-1*c*d&&b.top<=(1+c)*d&&b.bottom>=-1*c*d&&b.bottom<=(1+c)*d&&b.left>=-1*c*k&&b.left<=(1+c)*k&&b.right>=-1*c*k&&b.right<=(1+c)*k&&p.push(a)});return p},hasPricingDetails:function(a){var c=
!1;a=a.pricingData.prices.dealPrice;void 0!==a&&null!==a&&(c=!0);return c},isElementInViewPort:function(a){a=this.getBoundingRect(a);if(!1===a)return gb.enums.ViewPortPresence.ABSENT;var c=a.top,e=a.bottom,b=a.left,d=a.right,p=g.$(h).height(),f=g.$(h).width();a=0<=c&&c<=p;var c=0>c,r=0<=e&&e<=p,e=e>p,p=0<=b&&b<=f,b=0>b,n=0<=d&&d<=f,d=d>f;if(a&&r&&p&&n)return gb.enums.ViewPortPresence.FULL;if(p&&n){if(c&&e)return gb.enums.ViewPortPresence.FULL_VERTICAL_CONTENT;if(a&&e)return gb.enums.ViewPortPresence.PARTIAL_TOP;
if(c&&r)return gb.enums.ViewPortPresence.PARTIAL_BOTTOM}if(a&&r){if(b&&d)return gb.enums.ViewPortPresence.FULL_HORIZONTAL_CONTENT;if(p&&d)return gb.enums.ViewPortPresence.PARTIAL_LEFT;if(b&&n)return gb.enums.ViewPortPresence.PARTIAL_RIGHT}return a&&e&&p&&d?gb.enums.ViewPortPresence.PARTIAL_TOP_LEFT:a&&e&&b&&n?gb.enums.ViewPortPresence.PARTIAL_TOP_RIGHT:c&&r&&p&&d?gb.enums.ViewPortPresence.PARTIAL_BOTTOM_LEFT:c&&r&&b&&n?gb.enums.ViewPortPresence.PARTIAL_BOTTOM_RIGHT:gb.enums.ViewPortPresence.ABSENT},
removeImage:function(a){var c=a.find(".dealViewImage");c.length||(c=a.find("img"));if(c.size())return a={imageContent:c.parent().html(),imageContainer:c.parent()},c.remove(),a},isWidgetWithStatusFilter:function(a){var c=!0;b.contains([gb.enums.WidgetNames.M_HERO,gb.enums.WidgetNames.M_SUPPLE,gb.enums.WidgetNames.TAB_SUPPLE],a)&&(c=!1);return c},shouldShowMiniDetailPageModal:function(a){var c=!1,e=a.deal;a=gb.controller.schedulingParams[a.widgetView.widgetID];var b=a.disableMiniDP;!a.showShortCellView||
b||e.dealState!==gb.enums.DealStates.UPCOMING&&e.detail.itemType!==gb.enums.ItemTypes.SINGLE&&e.detail.itemType!==gb.enums.ItemTypes.VARIATION||(c=!0);return c},isTouchDevice:function(){return"ontouchstart"in h||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints},invokeWatchDealStateTransitions:function(a){var c=gb.controller.dealDAOs[a];c.isDealWatched&&(b.each(gb.metadata.watchedDeals,function(e,d){if(d!==gb.enums.Constants.ALL){e=b.indexOf(e,a);var k=gb.enums.WatchedDealStateMap[c.dealState];
-1<e&&k!==d?gb.metadata.watchedDeals[d].splice(e,1):-1===e&&k===d&&gb.metadata.watchedDeals[d].unshift(a)}}),gb.metadata.trigger("RefreshWatchedDealWidgets",b.keys(gb.widgets),c.dealID))},getWatchedDealStates:function(a){return a?b.map(a,function(a){return gb.enums.WatchedDealStateMap[a]}):b.uniq(b.values(gb.enums.WatchedDealStateMap))},getWatchedDealWidgetData:function(a){var c=this.getWatchedDealStates(a),e={},d=[],k=gb.enums.DealStates.AVAILABLE;b.each(gb.metadata.watchedDeals,function(a,f){-1!==
b.indexOf(c,f)&&(e[k]=a,d=b.union(d,a))});return{selectedDealsCount:d.length,sortedDealIDs:d,dealsByState:e}},isDealActionable:function(a){if(!a)return!1;a=gb.controller.getDealDAO(a);return!a||a.dealState!==gb.enums.DealStates.AVAILABLE&&a.dealState!==gb.enums.DealStates.WAITLIST?!1:a.detail.isPrimeOnly?gb.resources.customerData.isPrimeMember:a.detail.isPrimeEarlyAccessDeal&&this.isDealInEarlyAccessWindow(a)?gb.resources.customerData.hasEarlyAccessBenefit:!0},callAsyncAjax:function(a,c){h.navigator&&
navigator.sendBeacon?navigator.sendBeacon(a,c):g.$.ajax({url:a,data:c,async:!1})},logRedirectPurchaseAttributes:function(a,c,e){if(a&&c&&(e||a.impressionAsin)){e||(e=a.impressionAsin);c="/gp/deal/ajax/logPurchaseAttributes.html?asin\x3d"+e+"\x26et\x3d"+c+"\x26ht\x3dredirect";a.parentAsin&&(c+="\x26ca\x3d"+a.parentAsin);a.merchantID&&(c+="\x26mt\x3d"+a.merchantID);var b=gb.resources.getCustomerData("realm"),b=this.price[b].currency,d=null;a.itemType===gb.enums.ItemTypes.VARIATION&&(d=a.getAsinDAO(e).dealPrice);
a.dealAsinsHash[e]&&a.dealAsinsHash[e].dealPrice&&(d=a.dealAsinsHash[e].dealPrice.price,b=a.dealAsinsHash[e].dealPrice.currency);null!==d&&null!==b&&(c+="\x26pr\x3d"+this.getCrypticPrice(d),c+="\x26cu\x3d"+b);g.$.ajax({url:c,async:!1})}},getCrypticPrice:function(a){return b.isNumber(a)?a.toString().split("").map(function(a){return String.fromCharCode(a.charCodeAt(0)+17).replace("?","X")}).join(""):null},areNestedKeysPresent:function(a,c){if(!b.isObject(a)||!b.isString(c))return!1;c=c.split(".");for(var e=
0;e<c.length;e++){if(!a||!a.hasOwnProperty(c[e]))return!1;a=a[c[e]]}return!0},showPPU:function(a){var c=gb.resources.getCustomerData("realm");return b.contains(this.ppuRealms,c)&&a?(a=gb.controller.getDealDAO(a))?a.pricingData.unitPrice&&a.pricingData.baseUnit?!0:!1:!1:!1},hasDigitalCategory:function(a){return b.intersection(a,gb.utils.digitalCategories[gb.resources.customerData.realm]).length?!0:!1},_setTemplateDataForMetroApp:function(a){var c=gb.resources.deviceInfo;c.isApp&&c.isMetro&&c.isWin&&
(a.showButton=!1)},removeNulls:function(a){if(b.isObject(a)){var c,e,d;a instanceof Array?(c=[],e=!0,d=0):(c={},e=!1);for(var k in a)if(a.hasOwnProperty(k)){var p=this.removeNulls(a[k]);p&&(c[e?d++:k]=p)}return b.isEmpty(c)?null:c}return a?a:null},sortRequestObj:function(a,c){if(b.isObject(c)&&!b.isEmpty(c))if(c instanceof Array)if(b.isObject(c[0])){var e=this.requestObjSortBy[a];e&&c.sort(function(a,c){return(a[e]>c[e])-(a[e]<c[e])})}else c.sort();else if(c instanceof Object){for(var d in c)c.hasOwnProperty(d)&&
(c[d]=this.sortRequestObj(d,c[d]));if(this.requestObjSortBy[a]){a={};var k=Object.keys(c);k.sort();for(d=0;d<k.length;d++)a[k[d]]=c[k[d]];c=a}}return c},isOfferingRestrictionViolated:function(a){for(var c in a)if("quantityRestriction"===a[c].category)return!0;return!1},isDefinedAndNonNull:function(a){return null!==a&&void 0!==a?!0:!1},extractRefFromUrl:function(a){var c=a.indexOf("/ref\x3d");if(-1===c)return"";a=a.substr(c+5);c=a.indexOf("?");-1!==c&&(a=a.substr(0,c));return a},getDeviceOrientation:function(a){a=
gb.configManager.getWidgetViewConfig(a);a=parseInt(a.minLandscapeWidth,10);return g.$(h).width()>a&&g.$(h).width()>g.$(h).height()?gb.enums.ClientOrientation.LANDSCAPE:gb.enums.ClientOrientation.PORTRAIT},setDealViewHeightToOriginal:function(a,c){c="#"+gb.utils.getDealViewID(a,c);a=gb.widgets[a].skinDomElement.find(c);a.height("auto");c=a.find("."+gb.enums.dealViewClasses.FOOTER);0<c.length&&a.height(a.height()+c.height())},setDealViewHeightToDealRowHeight:function(a,c){c="#"+gb.utils.getDealViewID(a,
c);a=gb.widgets[a].skinDomElement.find(c);c=a.closest("."+gb.enums.WidgetViewIDs.CONTENTROW);a.height(c.height())},getCSStransitionTime:function(a){var c=a+"ms ease-in-out";0===a&&(c="");return{"-webkit-transition":c,"-moz-transition":c,"-o-transition":c,transition:c}},getCSStransformDistance:function(a,c){this.isRtl()&&(a=0<a?"-"+a:Math.abs(a));if(c===gb.enums.Constants.X_DIRECTION)a="translate3d("+a+"px,0px,0px)";else if(c===gb.enums.Constants.Y_DIRECTION)a="translate3d(0px,"+a+"px,0px)";else return{};
return{"-webkit-transform":a,"-moz-transform":a,"-o-transform":a,transform:a}},convertToRequesterDomainUrl:function(a){return void 0===a||null===a?null:a.replace(/^https?:\/\/([a-z0-9\.\-]*\.)?amazon\.[a-z]{2,3}(\.[a-z]{2})?\//i,this._getProtocol()+"//"+this._getHost()+"/")},_getProtocol:function(){return h.location.protocol},_getHost:function(){return h.location.host},getDealsInternalUrl:function(a){var c;gb.resources.urls.deals_internal_website&&(c=gb.resources.urls.deals_internal_website+a);return c},
getmarketingIDsToKeep:function(a){return b.filter(a[gb.enums.IncludedDealTargetsSupported.MARKETING_ID],function(a){return!b.contains(gb.resources.whitelistedMarketingIDList,a)})},getPriceTextForBasisKind:function(a){var c=gb.resources.getString("gb-price");if(a){var e=!1,b=gb.resources.getCustomerData("realm");0<=[gb.enums.Realms.BR].indexOf(b)&&(e=!0);a===gb.enums.priceKind.LIST_PRICE?c=gb.resources.getString("gb-list"):a===gb.enums.priceKind.UVP_LIST_PRICE?c=gb.resources.getString("gb-list"):a===
gb.enums.priceKind.PRINT_LIST_PRICE&&e?c=gb.resources.getString("fiona_list_price_35050"):a===gb.enums.priceKind.DIGITAL_LIST_PRICE&&e&&(c=gb.resources.getString("fiona_digital_price_42515"))}return c},reloadPage:function(a,c){c.isInstanceOfWidgetView(a)?gb.subnavController&&!gb.subnavController.isWidgetExistinCurrentPageRefreshList(a)||a.refreshWidget(!0):a.reload()},isLaunchCellPage:function(a){var c=!1,e=gb.controller.schedulingParams[a],b=gb.controller.widgetCurrentPage[a];a=gb.metadata.selectedDealsCount[a];
var d=e.widgetTabConfig[e.widgetCurrentTab],d=d?d.launchCellIndex:0,e=e.pageSize;0<d&&0<e&&(c=a<b*e?!0:d>=(b-1)*e&&d<b*e?!0:!1);return c},isWatchedDealsTab:function(a){var c=!1,e=gb.controller.schedulingParams[a];a=e.widgetCurrentTab;e=e.watchedDealsTab;null!==e&&a===e&&(c=!0);return c},getComputedDealWidthForFlexWidget:function(a,c){a=c?a-a%2:a;return(100-5*(a-1))/a},validateFetchParam:function(a,c){var e=gb.controller.schedulingParams[a],d=function(a){if(a){for(var c={};Math.floor(e.maxLimitDeals/
a)*a!==e.maxLimitDeals;)++a;c.page=Math.ceil(e.maxLimitDeals/a);c.dealsPerPage=a;return c}};c=b.extend(c,function(b){var d={};d.page=b.page?b.page:e.page;d.dealsPerPage=e.pageSize;if(b.dealsPerPage){var l=Math.ceil(((d.page-1)*e.pageSize+1)/b.dealsPerPage);if(!c.isLazyLoadPageCall)for(;gb.metadata.isCurrentWindowFull(a,l,c.dealsPerPage);)l++;d.page=l;d.dealsPerPage=b.dealsPerPage}return d}(c));if(e.maxLimitDeals){var k=b.compact(gb.metadata.sortedDealIDs[a]),k=k.indexOf(b.last(k))+1,p=(c.page-1)*
c.dealsPerPage,k=k>p?k:p;c.dealsPerPage*c.page<e.maxLimitDeals?gb.widgets[a].isMaxDealLimitReached=!1:(k>=e.maxLimitDeals||gb.widgets[a].isMaxDealLimitReached?c.dealsPerPage=0:k+c.dealsPerPage>e.maxLimitDeals&&(d=d(e.maxLimitDeals-k))&&(c=b.extend(c,d)),gb.widgets[a].isMaxDealLimitReached=!0)}return c},deduceAccessTypeInfoFromGetDealResponse:function(a,c,e){var b,d;d=a.accessBehavior.accesslogic[0][0];a=gb.enums.DealAccessTypes[d.type];a===gb.enums.DealAccessTypes.GIVEAWAY_DEAL?e?b=0:a=null:b=d.duration;
c.dealState!==gb.enums.DealStates.AVAILABLE||a!==gb.enums.DealAccessTypes.APP_EARLY_ACCESS&&a!==gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS||0>=parseInt(c.msToStart,10)+parseInt(b,10)*gb.enums.Constants.MINUTE_IN_MILLIS&&(a=null);return{accessType:a,accessTypeDuration:b}},mergeGiveawayWithGdmResponse:function(a,c,e,b,d){var p=e.giveawaySlots,f=c.length<p.length?c.length:p.length,g=d&&d.dealsPerPage?d.dealsPerPage:e.pageSize;d=((d&&d.page?d.page:e.page)-1)*g;if(!this._checkFiltersApplied(b,e))for(b=
d+g,g=0;g<f;g++)e=d<a.sortedDealIDs.length,!1===e?e=p[g]>=d&&p[g]<b:d=0,e&&p[g]-d<a.sortedDealIDs.length&&(a.sortedDealIDs.splice(p[g]-d,0,c[g]),a.selectedDealsCount++)},_checkFiltersApplied:function(a,c){a=gb.widgets[a];a=gb.filterControllerFactory.getFilterController(a.widgetName).models[a.widgetGroupID];var e=c.campaignSchedulingParams,d=!1;b.each(a._selectedFilterValues,function(a,p){if(p===gb.enums.DCSQueryParams.PAGE){if(1!==a&&!0===c.fetchSinglePage)return d=!0,!1}else if(p===gb.enums.DCSQueryParams.DEAL_STATE)b.each(e[p],
function(c){if(!b.contains(a,gb.enums.DealStatesToFilterStates[c]))return d=!0,!1});else if(!b.isEqual(e[p],a))return d=!0,!1});return d},_shouldShowPercentClaimed:function(a,c){var e=gb.resources.getFeature("scarcity_messaging"),b=gb.enums.Weblabs.TREATMENTS,d=!0;c.enableHidingClaimedBar&&(b.T1===e&&30>a||b.T2===e&&80>a||b.T3===e)&&(d=!1);return d},_isAGSMerchant:function(a){return Object.keys(gb.enums.AGSMerchantsID).some(function(c){return gb.enums.AGSMerchantsID[c]===a})},shouldDisplayIFDMessage:function(a){var c=
gb.resources.getFeature("gb_ifd_message"),e=gb.resources.getFeature("gb_ifd_message_ags_in"),b=!1;a&&a.merchantID&&this._isAGSMerchant(a.merchantID)&&(b=c===gb.enums.Weblabs.TREATMENTS.T1||e===gb.enums.Weblabs.TREATMENTS.T1);return b},getDealViewStyleInformation:function(a,c,e){var b={},d=gb.resources.getFeature("scarcity_messaging"),p=a.dealType===gb.enums.DealTypes.LD,d=null!==d&&d!==gb.enums.Weblabs.TREATMENTS.C;a=a.dealState===gb.enums.DealStates.SOLDOUT||a.dealState===gb.enums.DealStates.EXPIRED;
c=c.timerPrefix===gb.resources.getString("gb_ends_in");var f=this.isTablet(gb.clientName),g=gb.clientName===gb.enums.MobileClients.AW&&gb.resources.deviceInfo.isPhone;b.shouldStyleTimerMessaging=!1;b.shouldStyleScarcityMessaging=!1;e.enableTimerStyling&&(b.shouldStyleTimerMessaging=p&&!f&&!g&&d&&!a&&c);e.enableClaimedStyling&&(b.shouldStyleScarcityMessaging=p&&!f&&!g&&d&&!a);return b},encodeSpaces:function(a){return a.replace(/ /g,encodeURIComponent(" "))},generateInterestRedirectLink:function(a,
c,e){a=gb.filterUtils.setUrlFilterParam(a,gb.enums.DCSQueryParams.INTERESTS,c.value,"gb_f_"+e);e="gb_ttl_"+e;c=gb.resources.getString("gb_interest_title",{title:c.title});return a=this.setUrlParam(a,e,encodeURIComponent(encodeURIComponent(c)))},fetchFaceoutConfigFromWhitelistedInterests:function(a,c,e){var d=[],k=gb.resources.getInterests(),p=gb.configManager.getDealViewConfig(a),f=this;c.showAllDealsFaceout&&(a={title:gb.resources.getString("gb_all_interest_title"),imageURL:f.resizeImage(gb.resources.getImage("all_interest"),
p.imageSize)},c.redirectLink&&(a.redirectLink=c.redirectLink),d.push(a));b.isEmpty(k)||b.each(k,function(a){if(e.binning[gb.enums.BinNames.INTERESTS]&&e.binning[gb.enums.BinNames.INTERESTS][a.value]){if(c.redirectLink){var k=f.generateInterestRedirectLink(c.redirectLink,a,c.widgetGroupID);b.extend(a,{redirectLink:k})}a.imageURL=f.resizeImage(a.imageURL,p.imageSize);d.push(a)}});return d},isRtl:function(){return d.capabilities.rtl}}});q.when("A").register("gb-prime-utils",function(g){return{prime:{iconStyleByRealm:{FR:"premium",
ES:"premium",JP:"prime-jp",DEFAULT:"prime"},realmsWithLogoOnRight:["IT"]},getPrimeIconType:function(){var g=gb.resources.customerData.realm;return this.prime.iconStyleByRealm[g]?this.prime.iconStyleByRealm[g]:this.prime.iconStyleByRealm.DEFAULT},getPrimeLogoPosition:function(){return-1!==this.prime.realmsWithLogoOnRight.indexOf(gb.resources.customerData.realm)?gb.enums.primeIconPositions.RIGHT:gb.enums.primeIconPositions.LEFT}}});q.when("A","gb-resources").register("gb-badge-utils",function(g,h){return{generateBadgeProperties:function(f){var d,
b=f.deal.dealType;f=f.deal.detail.accessType;var a,c,e;f?(c=gb.resources.getFeature("prime_day_badging_2016"),null===c&&(c=0),gb.resources.deviceInfo.isPhone?a=gb.enums.Platforms.PHONE:gb.utils.isTablet(gb.clientName)?a=gb.enums.Platforms.TAB:gb.clientName===gb.enums.Platforms.PC&&(a=gb.enums.Platforms.PC),e=gb.configManager.getBadgeConfig(),(b=e.accessTypeBadge[f])&&b[a]&&((d=b[a][c])&&f===gb.enums.DealAccessTypes.PRIME_ONLY_DOTD&&void 0!==e.accessTypeBadge.Overrides[f][gb.resources.customerData.realm]&&
(d=e.accessTypeBadge.Overrides[f][gb.resources.customerData.realm][a][c]),d&&(d.primeBadgingWeblab=c))):(e=gb.configManager.getBadgeConfig(),(d=e.dealTypeBadge[b])&&void 0!==e.dealTypeBadge.Overrides[b][gb.resources.customerData.realm]&&(d=e.dealTypeBadge.Overrides[b][gb.resources.customerData.realm]));return d}}});q.when("A","GoldboxMobile3PAssets").register("gb-metrics",function(g,h){var f=h._;return g.createClass({widgetMetricsParams:{},widgetRefTags:{"GB-M-FACEOUT":"gbmp","GB-M-GRID-HERO":"gbmg",
"GB-M-HERO":"gbmh","GB-M-HERO-CN":"cnm_ldw_card_atc","GB-M-LIST-HERO":"gbml","GB-M-SUPPLE":"gbms","GB-M-SUBNAV":"gbmu","GB-TAB-FACEOUT":"gbtp","GB-TAB-HERO":"gbth","GB-TAB-GRID-HERO":"gbtg","GB-TAB-SUPPLE":"gbts","GB-FILTER-HERO":"gbpf","GB-GRID-HERO":"gbpg","GB-PC-FACEOUT":"gbpp","GB-SUPPLE":"gbps","GB-SHOVELER":"gbph"},refTags:{addToCart:"atc",adSlot:"ads",app:"app",clearFilter:"fcr",dpLink:"dpl",filter:"ftr",getWatchedDeals:"gwd",giveawayDesktop:"gva",giveawayMobile:"gvm",helpLink:"hlp",image:"img",
interest:"itr",joinWaitlist:"jwl",miniDpPopOver:"mdp",mobile:"mob",recLearnMore:"rlm",restrictionsApply:"rsa",reviews:"rvw",seeAllDeals:"sad",seeAllLocalDeals:"sal",subnavTabRefresh:"str",swipe:"swp",tab:"tab",title:"tit",unrecLearnMore:"ulm",unWatchDeal:"uwd",watchDeal:"wtd"},adRowRefTags:{rowNumber:"r"},init:function(){this.reverseMapAmabotParams=f.invert(this.amabotParams)},amabotParams:{pf_rd_p:"placementID",pf_rd_s:"slotName",pf_rd_t:"pageType",pf_rd_i:"pageIndent",pf_rd_m:"merchantID",pf_rd_r:"requestID"},
registerWidgetMetricParams:function(d,b){b=g.$("#"+b+"-amabot").html().split("?");if(1<b.length){b=b[1].split("\x26amp;");for(var a,c={},e=0;e<b.length;e++)a=b[e].split("\x3d"),1>=a.length||!this.amabotParams[a[0]]||(c[this.amabotParams[a[0]]]=g.$.trim(a[1]));this.widgetMetricsParams[d]=c}},_addAmabotClickParameters:function(d,b){d&&b&&f.each(this.amabotParams,function(a){b[a]&&(d=gb.utils.setUrlParam(d,this.reverseMapAmabotParams[a],b[a]))},this);return d},addMetricsParams:function(d,b,a,c){if(!d)return"";
if(!f.isEmpty(gb.widgets[b])){if(gb.resources.urls.deals_internal_website)return d;var e=this.widgetMetricsParams[b]||{};b=this.creatRefTag(b,a,c,e);gb.resources.deviceInfo.isWindowsPhone||(d=this._addRefTag(d,b),d=this._addAmabotClickParameters(d,e));return d}},creatRefTag:function(d,b,a,c){d=this.widgetRefTags[gb.widgets[d].widgetName]||"--";b=b||"---";var e=this._getSlotRefTag(c);c=this._getPlacementID(c);a=f.map(a,function(a){return((a||"")+"").replace(/[_ ]/g,"")});a=f.filter(a,function(a){return!!a});
a=f.map(a,function(a){return a.substring(0,8)}).join("_");return[d,b,e,c,a].join("_")},partiallyAppliedReffedURLFunction:function(d){var b=this;return function(a,c){return b.addMetricsParams(a,d.widgetID,c,d.data)}},_getSlotRefTag:function(d){if(!d||!d.slotName)return"";d=d.slotName;return 4>d.length?d:d.substring(0,1)+d.substring(d.length-2,d.length)},_getPlacementID:function(d){return d&&d.placementID?f.last(d.placementID,4).join(""):""},_addRefTag:function(d,b){var a,c;a=d.indexOf("#");-1===a?
c="":(c=d.substring(a),d=d.substring(0,a));var e=d.indexOf("?");-1===e?a="":(a=d.substring(e),d=d.substring(0,e));"/"===d[d.length-1]&&(d=d.substring(0,d.length-1));d=d.split("/");0===f.last(d).indexOf("ref\x3d")&&(d=f.initial(d));b=b.replace(/%/g,"");a=gb.utils.clearUrlParam(a,"ref_");d.push("ref\x3d"+b);return d.join("/")+a+c},generateRef:function(d,b,a){return this.creatRefTag(d,b,a,this.widgetMetricsParams[d]||{})},recordRefViaAjax:function(d){d&&g.$.ajax({type:"POST",url:"/gp/deal/ajax/record-ref.html/ref\x3d"+
d,aysnc:!0})},getReftagFromUrl:function(d){var b="";d=(d||"").split("/");d=(f.last(d)||"").split("?")[0];0===d.indexOf("ref")&&(b=d.split("\x3d")[1]||"");return b}})});q.when("A","GoldboxMobile3PAssets").register("gb-link-generator",function(g,h){var f=h._;return g.createClass({redirectionLink:null,init:function(d){this.redirectionLink=this._populateRedirectionBaseUrl(d)},_populateRedirectionBaseUrl:function(d){var b;"pc"===d&&(b=gb.resources.getString("gb_app_all_deals_url"),b=b.trim());return b=
b||gb.enums.RedirectionLinks[d].ALL_DEALS},generateRedirectLink:function(d,b){var a=this;if(!f.isEmpty(d.dealDisplay)){var c=[];f.map(d.dealDisplay,function(a){c.push(f.keys(a))});d.dealTypes=c}var e,l={brands:"gb_bnd",dealGroups:"gb_dgp",dealStates:"gb_dst",dealTypes:"gb_dtp",enforcedCategories:"gb_cat",enforcedDealIDs:"gb_edi",enforcedMerchantIDs:"gb_emi",excludedCategories:"gb_exc",excludedDealIDs:"gb_exd",excludedExtendedFilters:"gb_exf",exclusiveTargetKeys:"gb_exk",exclusiveTargetValues:"gb_exv",
expiringWithin:"gb_exp",extendedFilters:"gb_ext",fromTime:"gb_frt",freeShippingEligibleOnly:"gb_fso",globalEligibleOnly:"gb_geo",inclusiveTargetKeys:"gb_tgk",inclusiveTargetValues:"gb_tgv",minRating:"gb_mnr",primeEligibleOnly:"gb_peo",prioritizedDealIDs:"gb_pdi",redirectPageTitle:"gb_ttl",sortOrder:"gb_srt",toTime:"gb_tot"};f.each(l,function(c,p){if(b!==gb.enums.Constants.PAGINATED_METADATA_VERSION||c!==l.dealGroups)if(e=d[p],!f.isEmpty(e)){switch(c){case l.exclusiveTargetValues:case l.inclusiveTargetValues:var u=
"";f.each(e,function(a){u+="["+a.join()+"],"});e=u.slice(0,-1);break;case l.extendedFilters:case l.excludedExtendedFilters:e=JSON.stringify(e);break;default:"string"!==typeof e&&(e=e.join())}a.redirectionLink=gb.utils.setUrlParam(a.redirectionLink,c,encodeURIComponent(e))}},b);return a.redirectionLink}})});q.when("A","GoldboxMobile3PAssets").register("gb-metrics-manager",function(g,n){var f=n._;return g.createClass({asinImpressionsHash:{},ClientActions:{ADD_TO_CART:"A",JOIN_WAITLIST:"J",WATCH_DEAL:"W",
SEE_MORE:"M",TITLE:"T",REVIEWS:"R",SHARE_DEAL:"S",IMAGE:"I",DEAL_CLICK:"D",LEARN_MORE:"L",TRY_PRIME:"P",GC_RENDER:"G"},cdsCallIntervalRef:null,cdsPollInterval:3E5,init:function(){var d=this;g.$(h).unload(function(){h.clearInterval(d.cdsCallIntervalRef);d.cdsCallIntervalRef=null;d.reportImpression()});d.cdsCallIntervalRef=h.setInterval(function(){d.reportImpression()},d.cdsPollInterval)},recordRender:function(d,b,a){if(!d||!b)return null;a=this.getMetricsLogPosition(d,b,a);if(!a)return null;this.asinImpressionsHash[d]||
(this.asinImpressionsHash[d]={});this.asinImpressionsHash[d][b]||(this.asinImpressionsHash[d][b]={});this.asinImpressionsHash[d][b][a]||(this.asinImpressionsHash[d][b][a]={});return a},recordAction:function(d,b,a,c){d&&b&&a&&f.contains(f.keys(this.ClientActions),a)&&(c=this.recordRender(d,b,c))&&(this.asinImpressionsHash[d][b][c][this.ClientActions[a]]||(this.asinImpressionsHash[d][b][c][this.ClientActions[a]]=0),this.asinImpressionsHash[d][b][c][this.ClientActions[a]]++)},reportImpression:function(){var d=
this,b={};f.each(this.asinImpressionsHash,function(a,c){if(c=d.getImpressionRef(c)){var e=[];f.each(a,function(a,c){var b=gb.controller.getDealDAO(c);if(b){var d=b.detail.impressionAsin;if(d){var g=[d,c];gb.utils.isDealActionable(c)&&g.push("Y");c=b.status.percentClaimed;f.isNumber(c)&&0<c&&g.push(c);f.each(a,function(a,c){g.push(c);var e=[];f.each(a,function(a,c){e.push(c,a)});e.length&&g.push(e.join(""))});e.push(g.join("-"))}}});e.length&&(b[c]=e.join())}});this.splitCallClickStream(b);this.asinImpressionsHash=
{}},splitCallClickStream:function(d){if(!f.isEmpty(d)){var b=gb.utils.setUrlParam(gb.enums.AJAXLinks.CDS,"sID",gb.resources.getCustomerData("sessionId")),b=gb.utils.setUrlParam(b,"oID",gb.controller.contentMetadata.originRID),a=JSON.stringify(d),b=gb.utils.setUrlParam(b,"imp",a),b=h.encodeURI(b);if(2E3>=b.length)gb.utils.callAsyncAjax(b);else if(b=f.keys(d),b.length){var c={},e={};if(1===b.length){var l=d[b[0]].split(",");if(1>=l.length)return;a=l.slice(0,Math.ceil(l.length/2));l=l.slice(Math.ceil(l.length/
2),l.length);c[b[0]]=a.join();e[b[0]]=l.join()}else a=b.slice(0,Math.ceil(b.length/2)),b=b.slice(Math.ceil(b.length/2),b.length),f.each(a,function(a){c[a]=d[a]}),f.each(b,function(a){e[a]=d[a]});this.splitCallClickStream(c);this.splitCallClickStream(e)}}},getImpressionRef:function(d){if(d){var b=gb.configManager.getWidgetViewConfig(d).clickStreamRefMarker,a=gb.metrics.widgetMetricsParams[d],b=[b,a.slotName,a.placementID];gb.controller.schedulingParams[d].enforceLimitedDeals&&b.push("Y");return b.join(".")}},
getMetricsLogPosition:function(d,b,a){if(!(d&&b&&gb.widgets[d]&&gb.widgets[d].dealViews[b]))return null;var c=gb.widgets[d];b=c.dealViews[b][a];a=gb.controller.widgetCurrentPage[d]-1;var e=b.position,c=c.dealsPerRow,l=0,k=e;void 0!==b.row&&void 0!==b.column?(l=b.row,k=b.column):gb.controller.schedulingParams[d].enforceLimitedDeals||(l=Math.floor(e/c),k=e%c);if(gb.controller.schedulingParams[d].enforceLimitedDeals||!gb.controller.schedulingParams[d].enablePagination)a=0;d=[l,k,a];!0===b.isDoubleCell&&
d.push("Y");return d.join(".")}})});q.when("A","GoldboxMobile3PAssets").register("gb-widget-clientside-helper",function(g,h){var f=h._;return g.createClass({callBins:{},callDataArray:{},callID:{},previousDeficit:{},allDealsFetched:{},shouldReduceDeals:{},registerWidgetData:function(d,b){this.callBins[d]=[];this.callID[d]=0;this.allDealsFetched[d]=!1;this.previousDeficit[d]=0;this.shouldReduceDeals[d]=!0;var a=gb.widgets[d],c=gb.controller.schedulingParams[d],e=gb.configManager.getWidgetViewConfig(d),
l=c.dealDisplay;if(f.isEmpty(l))if(l=e.defaultNumberOfRows,c.dealTypes){var k=c.dealTypes.join(","),p={};p[k]={rows:l};l=[p]}else l=[{"":{rows:l}}];else k=l[l.length-1],p=f.keys(k),k=k[p[0]],k.deals?this.shouldReduceDeals[d]=!1:k.rows&&(this.shouldReduceDeals[d]=!0);c.dealDisplay=l;a=a.dealsPerRow;e=this.callDataArray[d]=(0,this[e.callDataBuilder])(l,a);!f.isEmpty(c.dealGroups)&&c.enforceLimitedDeals?this.previousDeficit[d]=this.calculatePreviousDeficit(b.sortedDealIDs,a,c.showDoubleCellDOTD):c.isCritical||
(l=e[0].dealsPerPage,this.callID[d]++,c.enforceLimitedDeals?(e=e[0].scheduledDealData,!f.isEmpty(b)&&e.rows&&e.rows&&(b.sortedDealIDs=this.filterDisplayableDealsArray(b.sortedDealIDs,e.rows*a,c.showDoubleCellDOTD)),this.previousDeficit[d]=this.calculatePreviousDeficit(b.sortedDealIDs,a,c.showDoubleCellDOTD)):c.fetchSinglePage||(c.pageSize=l))},getGBSuppleCallDataArray:function(d,b){var a=[],c=!0;f.each(d,function(e){f.each(e,function(e,d){var f={};f.dealTypes=d&&"ALL"!==d?d.split(","):[];e.deals?
f.dealsPerPage=e.deals:e.rows&&(f.dealsPerPage=e.rows*b,c||(f.dealsPerPage+=b));f.dealStates=[];e.dealStates&&(f.dealStates=e.dealStates.split(","));f.scheduledDealData=e;f.dealsPerPage&&(a.push(f),c=!1)})});return a},fetchCallDataArrayDeals:function(d){var b=this.callID[d],a=this.callDataArray[d];if(a.length>b){var c=gb.controller.schedulingParams[d],e=a[b];c.page=1;c.pageSize=e.dealsPerPage;c.dealTypes=e.dealTypes;c.dealStatesDD=e.dealStates;c={metaParams:{}};c.metaParams.callDataArray=a;c.metaParams.callID=
b;gb.service.fetchDealWithData(d,c,gb.controller.updatePage)}else this.allDealsFetched[d]=!0,"function"===typeof gb.widgets[d].renderLaunchCell&&gb.widgets[d].renderLaunchCell()},buildSortedDealsArray:function(d,b){var a=gb.widgetHelper.callID[d],c=this.callBins[d][a],e=gb.metadata.sortedDealIDs[d],l=this.callDataArray[d][a].scheduledDealData,a=gb.controller.schedulingParams[d];if(l.rows){var k=c.length;a.showDoubleCellDOTD&&(k=k+f.intersection(gb.metadata.dealsByType[gb.enums.DealTypes.DOTD],c).length+
f.intersection(gb.metadata.dealsByAccessType[gb.enums.DealAccessTypes.PRIME_ONLY_DOTD],c).length);l=l.rows*b;l+=this.previousDeficit[d];c=this.filterDisplayableDealsArray(c,k>=l?l:k,a.showDoubleCellDOTD)}e=f.union(e,c);this.previousDeficit[d]=this.calculatePreviousDeficit(e,b,a.showDoubleCellDOTD);return e},filterDisplayableDealsArray:function(d,b,a){var c=[];f.each(d,function(e){if(0<b){var d=a?f.contains(gb.metadata.dealsByType[gb.enums.DealTypes.DOTD],e)||f.contains(gb.metadata.dealsByAccessType[gb.enums.DealAccessTypes.PRIME_ONLY_DOTD],
e):!1;1===b&&d||(c.push(e),d?b-=2:b--)}else return!1});return c},calculatePreviousDeficit:function(d,b,a){var c=0;a=a?gb.metadata.getDOTDCount(d):0;d=d.length+a;0!==d%b&&(c=b-d%b);return c}})});q.when("A","GoldboxMobile3PAssets","gb-metrics","gb-enums").register("gb-filter-metrics",function(g,h,f,d){var b=h._;return f.extend({_filterRefTags:{CATEGORIES:"wht",DEAL_STATE:"dls",DEAL_TYPE:"dlt",DISCOUNT:"dct",PRICE:"prc",REVIEW_RATING:"acr",PAGE:"page",PRIME_ELIGIBLE_ONLY:"prm",PRIME_ACCESS_TYPE:"dlt",
SORT_ORDER:"sort",INTERESTS:"int",ENFORCED_CATEGORIES:"enf"},_filterAttrToHandlers:{CATEGORIES:"_getCategoriesMetric",DEAL_STATE:"_getDealStateMetric",DEAL_TYPE:"_getDealTypeMetric",DISCOUNT:"_getDiscountMetric",PRICE:"_getPriceMetric",REVIEW_RATING:"_getReviewRatingMetric",PAGE:"_getPageMetric",PRIME_ELIGIBLE_ONLY:"_getPrimeEligibleMetric",PRIME_ACCESS_TYPE:"_getDealTypeMetric",SORT_ORDER:"_getSortOrderMetric",INTERESTS:"_getInterestsMetric",ENFORCED_CATEGORIES:"_getEnforcedCategories"},_dealStateRefTags:{ACTIVE:"ACTV",
MISSED:"MISD",UPCOMING:"UPCM"},_dealTypeRefTags:{BEST_DEAL:"BD",COUPON_DEAL:"CPN",DEAL_OF_THE_DAY:"DOTD",LIGHTNING_DEAL:"LD",PRIME_EARLY_ACCESS:"PEA"},_sortOrderRefTags:{BY_BEST_SELLING:"BSEL",BY_DISCOUNT_ASCENDING:"DCTA",BY_DISCOUNT_DESCENDING:"DCTD",BY_PRICE_ASCENDING:"PRCA",BY_PRICE_DESCENDING:"PRCD",BY_RELEVANCE:"FEAT",BY_SCORE:"RELV",BY_START_TIME:"STRT"},_primeEligibleRefTag:{ISPM:"ISPM"},init:function(){this._super();var a=this;this._binningParamsWithHandlersToAttr={};b.each(b.keys(this._filterAttrToHandlers),
function(c){a._binningParamsWithHandlersToAttr[d.BinningParams[c].key]=c});this._getCategoriesMetric=b.wrap(void 0,this._metricsChangeWrapper);this._getDealStateMetric=b.wrap(this._transformDealStateValue,this._metricsChangeWrapper);this._getDealTypeMetric=b.wrap(this._transformDealTypeValue,this._metricsChangeWrapper);this._getDiscountMetric=b.wrap(this._transformDiscountValue,this._metricsChangeWrapper);this._getPriceMetric=b.wrap(void 0,this._metricsChangeWrapper);this._getReviewRatingMetric=b.wrap(void 0,
this._metricsChangeWrapper);this._getPageMetric=b.wrap(void 0,this._metricsChangeWrapper);this._getPrimeEligibleMetric=b.wrap(this._transformPrimeEligibleValue,this._metricsChangeWrapper);this._getSortOrderMetric=b.wrap(this._transformSortOrderValue,this._metricsChangeWrapper);this._getInterestsMetric=b.wrap(void 0,this._metricsChangeWrapper);this._getEnforcedCategories=b.wrap(void 0,this._metricsChangeWrapper)},appendFilterMetricParams:function(a,c,e,b){return b instanceof Array&&3===b.length?(b=
this._getFilterMetricData(b),this.addMetricsParams(a,c,e,b)):a},_getFilterMetricData:function(a){var c=this._binningParamsWithHandlersToAttr[a[1]];if(c)return this[this._filterAttrToHandlers[c]](a,c);c=a[1];a[0]&&c&&a.shift();return a},_metricsChangeWrapper:function(a){var c=b.tail(arguments),e=c[0],d=e[1],e=e[2],c=c[1];a&&(e=a.call(this,e));if(d&&e)return[this._filterRefTags[c],e]},_transformDealStateValue:function(a){if(a===parseInt(a,10)&&gb.widgets[a]&&gb.widgets[a].widgetName===d.WidgetNames.PC_SHOVELER){var c=
gb.controller.schedulingParams[a],c=c.widgetTabConfig[c.widgetCurrentTab].dealStates,c=b.flatten(c);b.contains(c,d.FilterStates.ACTIVE)?a=d.FilterStates.ACTIVE:b.contains(c,d.FilterStates.UPCOMING)?a=d.FilterStates.UPCOMING:b.contains(c,d.FilterStates.MISSED)&&(a=d.FilterStates.MISSED)}return this._dealStateRefTags[a]},_transformDealTypeValue:function(a){return this._dealTypeRefTags[a]},_transformDiscountValue:function(a){return a.substring(0,a.indexOf("-")+1)},_transformPrimeEligibleValue:function(a){return a?
this._primeEligibleRefTag.ISPM:""},_transformSortOrderValue:function(a){return this._sortOrderRefTags[a]}})});q.when("A").register("gb-config-manager",function(g){return{init:function(){this.dealViewConfigs={};this.widgetViewConfigs={};this.redirectURLConfigs={base64encodedUrls:["prime_signup_redirect","exclusive_access_prime_signup_redirect","exclusive_dotd_prime_signup_redirect","exclusive_bd_prime_signup_redirect"],encodedURIComponents:["watching_login_redirect"]};this.badgeConfig={};this.badgeConfig.accessTypeBadge=
{PRIME_EARLY_ACCESS:{phone:{0:{tagList:["gb_m_prime_early_access_deal"],badgeStyleRule:"primeDeal Badge274",skewElmStyleRule:"primeSlide",isPrimeBadge:!0},1:{tagList:["gb_m_prime_early_access_deal"],badgeStyleRule:"primeDeal solidTransparentBadge",skewElmStyleRule:"primeSlide",isPrimeBadge:!0},2:{tagList:["gb_m_prime_early_access_deal"],badgeStyleRule:"primeDeal solidTransparentBadge",skewElmStyleRule:"primeSlide",isPrimeBadge:!0}},pc:{0:{tagList:["gb_prime_early_access_deal_caps"],badgeStyleRule:"primeBadge peaBadge"},
1:{tagList:["gb_prime_early_access_deal_caps"],badgeStyleRule:"primeBadge peaBadge"},2:{tagList:["gb_prime_early_access_deal_caps"],badgeStyleRule:"primeBadge peaBadge"}},tablet:{0:{tagList:["gb_prime_early_access_deal_caps"],badgeStyleRule:"primeBadge peaBadge"},1:{tagList:["gb_prime_early_access_deal_caps"],badgeStyleRule:"primeBadge peaBadge"},2:{tagList:["gb_prime_early_access_deal_caps"],badgeStyleRule:"primeBadge peaBadge"}}},PRIME_ONLY_DOTD:{phone:{0:{tagList:["gb_m_prime_exclusive","gb_m_deal_of_the_day"],
badgeStyleRule:"DOTD Badge162",skewElmStyleRule:"primeDOTDSlide",isPrimeBadge:!1},1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"solidMPrimeBadge OneLineBadge",skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!1},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"solidMPrimeBadge OneLineBadge",skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!1}},pc:{0:{tagList:["gb_prime_only_dotdl_caps"],badgeStyleRule:"primeBadge podotdBadge"},1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"},
2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"}},tablet:{0:{tagList:["gb_prime_only_dotdl_caps"],badgeStyleRule:"primeBadge podotdBadge"},1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"}}},PRIME_ONLY_LD:{phone:{0:{tagList:["gb_m_prime_exclusive_deal"],badgeStyleRule:"primeDeal Badge234",skewElmStyleRule:"primeSlide",isPrimeBadge:!0},
1:{tagList:["gb_prime_exclusive_lightning_deal"],badgeStyleRule:"solidMPrimeBadge OneLineBadge largeTextPrimeBadge",skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!0},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"solidMPrimeBadge OneLineBadge largeTextPrimeBadge",skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!0}},pc:{0:{tagList:["gb_m_prime_exclusive_deal"],badgeStyleRule:"primeBadge poBadge"},1:{tagList:["gb_prime_exclusive_lightning_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeExclusiveLightningDealBadge"},
2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeExclusiveLightningDealBadge"}},tablet:{0:{tagList:["gb_m_prime_exclusive_deal"],badgeStyleRule:"primeBadge poBadge"},1:{tagList:["gb_prime_exclusive_lightning_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeExclusiveLightningDealBadge"},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeExclusiveLightningDealBadge"}}},PRIME_ONLY_BD:{phone:{0:null,1:null,2:{tagList:["gb_prime_day_deal"],
badgeStyleRule:"solidMPrimeBadge OneLineBadge",skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!0}},pc:{0:null,1:null,2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"}},tablet:{0:null,1:null,2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"}}},APP_EARLY_ACCESS:{phone:{0:{tagList:["gb_app_early_access_caps"],badgeStyleRule:"appDeal Badge274",skewElmStyleRule:"appSlide",isPrimeBadge:!0},1:{tagList:["gb_app_early_access_caps"],
badgeStyleRule:"appDeal Badge274",skewElmStyleRule:"appSlide",isPrimeBadge:!0},2:{tagList:["gb_app_early_access_caps"],badgeStyleRule:"appDeal Badge274",skewElmStyleRule:"appSlide",isPrimeBadge:!0}},pc:{0:{tagList:["gb_app_early_access_caps"],badgeStyleRule:"appBadge appeaBadge"},1:{tagList:["gb_app_early_access_caps"],badgeStyleRule:"appBadge appeaBadge"},2:{tagList:["gb_app_early_access_caps"],badgeStyleRule:"appBadge appeaBadge"}},tablet:{0:{tagList:["gb_app_early_access_caps"],badgeStyleRule:"appBadge appeaBadge"},
1:{tagList:["gb_app_early_access_caps"],badgeStyleRule:"appBadge appeaBadge"},2:{tagList:["gb_app_early_access_caps"],badgeStyleRule:"appBadge appeaBadge"}}},APP_ONLY_LD:{phone:{0:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appDeal Badge234",skewElmStyleRule:"appSlide",isPrimeBadge:!0},1:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appDeal Badge234",skewElmStyleRule:"appSlide",isPrimeBadge:!0},2:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appDeal Badge234",skewElmStyleRule:"appSlide",
isPrimeBadge:!0}},pc:{0:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appBadge appoBadge"},1:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appBadge appoBadge"},2:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appBadge appoBadge"}},tablet:{0:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appBadge appoBadge"},1:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appBadge appoBadge"},2:{tagList:["gb_app_only_access_caps"],badgeStyleRule:"appBadge appoBadge"}}}};this.badgeConfig.dealTypeBadge=
{DEAL_OF_THE_DAY:{tagList:["gb_m_deal_of_the_day"],badgeStyleRule:"DOTD Badge160",skewElmStyleRule:"DOTDSlide"}};this.badgeConfig.accessTypeBadge.Overrides={PRIME_ONLY_DOTD:{IT:{phone:{0:{tagList:["gb_m_prime_exclusive","gb_m_deal_of_the_day"],badgeStyleRule:"DOTD Badge234",skewElmStyleRule:"primeDOTDSlide",isPrimeBadge:!1},1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"solidMPrimeBadge OneLineBadge",skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!1},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"solidMPrimeBadge OneLineBadge",
skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!1}},pc:{0:{tagList:["gb_prime_only_dotdl_caps"],badgeStyleRule:"primeBadge podotdBadge"},1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"}},tablet:{0:{tagList:["gb_prime_only_dotdl_caps"],badgeStyleRule:"primeBadge podotdBadge"},1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"},
2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"}}},BR:{phone:{0:{tagList:["gb_m_prime_exclusive","gb_m_deal_of_the_day"],badgeStyleRule:"DOTD Badge234",skewElmStyleRule:"primeDOTDSlide",isPrimeBadge:!1},1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"solidMPrimeBadge OneLineBadge",skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!1},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"solidMPrimeBadge OneLineBadge",skewElmStyleRule:"solidPrimeSlide",isPrimeBadge:!1}},
pc:{0:{tagList:["gb_prime_only_dotdl_caps"],badgeStyleRule:"primeBadge podotdBadge"},1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"}},tablet:{0:{tagList:["gb_prime_only_dotdl_caps"],badgeStyleRule:"primeBadge podotdBadge"},1:{tagList:["gb_prime_deal_of_the_day"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"},2:{tagList:["gb_prime_day_deal"],badgeStyleRule:"primeExclusiveSolidBadge primeDayDeal"}}}}};
this.badgeConfig.dealTypeBadge.Overrides={DEAL_OF_THE_DAY:{IT:{tagList:["gb_m_deal_of_the_day"],badgeStyleRule:"DOTD Badge234",skewElmStyleRule:"DOTDSlide"},BR:{tagList:["gb_m_deal_of_the_day"],badgeStyleRule:"DOTD Badge234",skewElmStyleRule:"DOTDSlide"}}};return this},registerConfigs:function(g){this.registerDealViewConfigs(g.widgetName,g.dealViewConfig);this.registerWidgetViewConfigs(g.widgetName,g.widgetViewConfig)},registerDealViewConfigs:function(g,f){this.dealViewConfigs[g]=this.dealViewConfigs[g]||
f},registerWidgetViewConfigs:function(g,f){this.widgetViewConfigs[g]=this.widgetViewConfigs[g]||f},getDealViewConfig:function(g){return(g=gb.controller.widgetName[g])?this.dealViewConfigs[g]||null:null},getWidgetViewConfig:function(g){return(g=gb.controller.widgetName[g])?this.widgetViewConfigs[g]||null:null},getBadgeConfig:function(){return this.badgeConfig}}.init()});q.when("A","GoldboxMobile3PAssets").register("gb-template-manager",function(g,h){var f=h._;return{templates:{},TemplateGroups:{DEAL_SHARE:"dealShare",
DEAL_STATE:"dealState",DEAL_VIEW:"dealView",FILTER_VIEW:"filterView",MINI_DP_DEAL_STATE:"miniDPDealState",MINI_DP_DEAL_VIEW:"miniDPDealView",WIDGET_VIEW:"widgetView"},templateSettings:{evaluate:/<~([\s\S]+?)~>/g,interpolate:/\{\{([\s\S]+?)\}\}/g,escape:/~\{\{([\s\S]+?)\}\}/g},registerTemplates:function(d,b){if(!this.templates[d]){this.templates[d]={};var a=this,c={};b&&f.each(f.values(this.TemplateGroups),function(e){b[e]&&(c[e]=a._fetchTemplates(b[e]))});f.isEmpty(c)||(this.templates[d]=c)}},_fetchTemplates:function(d){var b=
{},a=this;f.each(d,function(c){b[c.name]=f.template(c.template,!1,a.templateSettings)});return f.isEmpty(b)?null:b},hasTemplate:function(d){var b=d.widgetID,a=d.templateGroup;d=d.templateName;if(!b||!a||null===d||""===d)return!1;b=gb.controller.widgetName[b];if(!b||!f.contains(f.values(this.TemplateGroups),a))return!1;a=[b,a];void 0!==d&&a.push(d);return gb.utils.areNestedKeysPresent(this.templates,a.join("."))?!0:!1},getWidgetHTML:function(d){var b=d.widgetID,a=d.templateGroup,c=d.templateName,e=
d.templateNames,l=d.data;if(!this.hasTemplate({widgetID:b,templateGroup:a,templateName:c}))return"";d=gb.controller.widgetName[b];if(c)return this.generateTemplate(this.templates[d][a][c],l);f.isArray(e)||(e=f.keys(this.templates[d][a]));var k={},p=this;f.each(e,function(c){k[c]=p.getWidgetHTML({widgetID:b,templateGroup:a,templateName:c,data:l})});return k},generateTemplate:function(d,b){return d?f.isFunction(d)?d({data:b||{}}):f.isString(d)?f.template(d,{data:b||{}},this.templateSettings):"":""}}});
q.when("A","gb-event-emitter").register("gb-deal-dao",function(g,h){return h.extend({init:function(f){this._super();this.dealID=f;this.dealType=this.offerID=this.legacyDealID=null;this.dealState=gb.enums.DealStates.LOADING;this.checkingDealStatus=!1;this.merchantID=null;this.processWatchAction=this.isDealWatched=this.isEBook=this.isDigital=!1;this.customerState=null;this.detail={title:null,imageAsin:null,URL:null,itemType:null,buyAsin:null,impressionAsin:null,marketingMessage:null,isPrimeOnly:null,
isPrimeEarlyAccessDeal:null,isGiveawayDeal:null,isFulfilledByAmazon:null,accessType:null,accessDurationInMs:null,isAppDeal:!1,giveawayValue:null};this.reviews={URL:null,total:null,rating:null};this.teaser={teaserLine:null,teaserImage:null,teaserURL:null};this.auxiliaryData={breaksMAP:null,isPrimeEligible:null};this.pricingData={prices:{dealPrice:null,basisPrice:null},percentOff:null,bKind:null,unitPrice:null,baseUnit:null};this.status={percentClaimed:null,isValidDeal:1,dates:{end:null,start:null,
incartEnds:null,cacheExpires:null,startForNonPrimeCustomer:null,pendingATCEnds:null},timeouts:{end:null,start:null,incartEnds:null,cacheExpires:null,earlyAccessExpires:null,pendingATCEnds:null},cache:{lastMsCacheTtl:null}};this.couponCounts={total:null};this.extendedAttributes={hideAddToCart:!1};this.registerConnections();this.items={};this.selectorData={}},registerConnections:function(){this.on("RefreshView",this.changeView);this.on("RefreshMiniDetailPageView",this.changeMiniDetailPageView)},calculatePercentOff:function(){var f=
this.pricingData.prices.dealPrice,d=this.pricingData.prices.basisPrice;f&&d&&f.max.value===f.min.value&&d.max.value===d.min.value&&(this.pricingData.percentOff=gb.utils.calculatePercentOff(d.max.value,f.max.value))},changeView:function(){gb.controller.refreshDealView(this.dealID)},changeMiniDetailPageView:function(){gb.controller.refreshMiniDetailPageView(this.dealID)},getAsinDAO:function(f){return this.items[f]},getVariationAsin:function(f){var d=null;g.each(this.items,function(b){g.equals(b.variationDimensions,
f)&&(d=b)});return d}})});q.when("A").register("gb-deal-asin-dao",function(g){return g.createClass({init:function(g){if(!g.itemID)throw Error("Cannot create a GBDealAsinDAO object with undefined asin");this.asinID=g.itemID;this.dealID=g.dealID;this.parentDealDAO=null;g.parentItemID&&(this.parentDealDAO=gb.controller.getDealDAO(g.parentItemID));this.marketplaceID=gb.resources.customerData.marketplaceId;this.dealPriceFormatted=gb.utils.getFormattedPrice(g.dealPrice);this.bKind=g.bKind;this.percentOff=
g.percentOff;this.basisPriceFormatted=gb.utils.getFormattedPrice(g.bAmount);this.imageURL=gb.baseUtils.checkAndSetSSLImageUrl(g.primaryImage);this.status={itemState:null,customerState:null,percentClaimed:null,dates:{incartEnds:null,pendingATCEnds:null},timeouts:{incartEnds:null,pendingATCEnds:null}};this.variationDimensions=g.variationDimensions;this.auxiliaryData={isPrimeEligible:g.isPrimeEligible,breaksMAP:null,merchantDetails:{merchantID:g.merchantID,merchantName:g.merchantName}}}})});q.when("A",
"GoldboxMobile3PAssets").register("gb-filter-model",function(g,n){var f=n._;return g.createClass({init:function(d){this.widgetGroupID=d.widgetGroupID;this.widgetID=d.widgetID;this.widgetName=gb.widgets[this.widgetID].widgetName;this._selectedFilterValues={};this.availableFilterOptions={};this.hasPageChanged=!1;this.filterPlurals={};this.redirectURL=this.widgetGroupAnchor=null;this.doPageRefresh=!1;this.filterConfigValuesHash={};this.attributesList=[];this.attributesWithDisabledValues=[];this.selectedFiltersCount=
0;this.customFilter=null;this.targetedWidget={ID:0,title:null,savedTitle:null,clearTitle:!1};this.setFilterValue=f.wrap(this._setFilterValue,this._filterChangeWrapper);this.addFilterValue=f.wrap(this._addFilterValue,this._filterChangeWrapper);this.removeFilterValue=f.wrap(this._removeFilterValue,this._filterChangeWrapper);this.removeAllFilterValues=f.wrap(this._removeAllFilterValues,this._filterChangeWrapper)},setupWidgetFilterConnections:function(){var d=gb.controller.schedulingParams[this.widgetID].refreshWidgets;
if(d)for(var b in gb.widgets)if(gb.widgets[b].widgetName===d){this.targetedWidget.ID=b;break}},saveTargetedWidgetInfo:function(){gb.controller.schedulingParams[this.targetedWidget.ID]&&(-1===h.location.href.indexOf("gb_ttl_"+this.widgetGroupID)?this.targetedWidget.savedTitle=gb.controller.schedulingParams[this.targetedWidget.ID].title:this.targetedWidget.title=gb.controller.schedulingParams[this.targetedWidget.ID].title)},mergeFilters:function(d){var b=this;b.widgetGroupAnchor=d.schedulingParams.widgetAnchorName||
b.widgetGroupAnchor;d.schedulingParams.widgetCurrentTab&&(b._selectedFilterValues[gb.enums.WidgetConstants.CURRENT_TAB]=d.schedulingParams.widgetCurrentTab);f.each(gb.enums.DCSQueryParams,function(a){var e=d.schedulingParams[a];if(f.isArray(e)?!f.isEmpty(e):e)f.isArray(e)&&(e=f.clone(e)),a===gb.enums.DCSQueryParams.DEAL_STATE&&(e=f.map(e,function(a){return gb.enums.DealStatesToFilterStates[a]}),e=f.unique(e)),a===gb.enums.DCSQueryParams.PRICE_RANGE&&(a=gb.enums.BinningParams.PRICE.key),a===gb.enums.DCSQueryParams.DISCOUNT_RANGE&&
(a=gb.enums.BinningParams.DISCOUNT.key,e=e.join(",")),b._selectedFilterValues[a]=e});f.each(d.schedulingParams.extendedFilters,function(a,e){e===gb.enums.BinningParams.NEW_RELEASES.key&&(a=[1]);e===gb.enums.BinningParams.DISCOUNT.key&&(a=a.join(","));f.isArray(a)&&(a=f.clone(a));b._selectedFilterValues[e]=a});var a=d.schedulingParams.filterConfig;f.each(a,function(a){var e=f.map(a.attr.split(","),g.$.trim);f.each(e,function(d,k){if(a.plural){var p=f.map(a.plural.split(","),g.$.trim);b.filterPlurals[d]=
p[k]}if(a.values){k=1<e.length?a.values[k]:f.flatten(a.values,!0);p=b.getDCSQueryParamForBinningKey(d);b._selectedFilterValues[p]&&f.isEqual(b._selectedFilterValues[p],k)&&delete b._selectedFilterValues[p];if(d===gb.enums.BinningParams.DEAL_STATE.key){var u=[];f.each(k,function(a){u.push(gb.enums.FilterStatesToDealStates[a])});k=f.flatten(u,!0)}b.filterConfigValuesHash[d]=k}a.disableValues&&(b.attributesWithDisabledValues=f.union(b.attributesWithDisabledValues,d))})});b.customFilter=d.schedulingParams.customFilter;
b.attributesList=f.union(b.attributesList,gb.utils.getFilterAttributesList(a));b.populateAvailableFilters(d.dcsServerResponse.binning);gb.filterControllerFactory.getFilterController(this.widgetName).trigger("gbfilter:mergeFilters",this)},getDCSQueryParamForBinningKey:function(d){var b=gb.enums.BinningKeyToDCSQueryParamMap[d];if(!b||f.isArray(b))b=d;return b},getSelectedBinningValues:function(d){d=this.getDCSQueryParamForBinningKey(d);var b=this._selectedFilterValues[d];d===gb.enums.DCSQueryParams.ACCESS_TYPE&&
(b=this._transformAccessTypesToAnArray(b));return b},_transformAccessTypesToAnArray:function(d){var b=[];f.isArray(d)?f.each(d,function(a){a=f.isArray(a)?a.sort().join("__"):a;b.push(a)}):b.push(d);return b},getSelectedFilters:function(d,b){var a=this,c=f.map(a._selectedFilterValues,function(c,l){if(b&&!f.contains(b,l))return{};if(l!==gb.enums.DCSQueryParams.SORT_ORDER&&l!==gb.enums.DCSQueryParams.PAGE&&l!==gb.enums.DCSQueryParams.MIN_RATING)if(l===gb.enums.DCSQueryParams.PRIME_ELIGIBLE_ONLY||l===
gb.enums.DCSQueryParams.GLOBAL_ELIGIBLE_ONLY||l===gb.enums.DCSQueryParams.FREE_SHIPPING_ELIGIBLE_ONLY)c=!0;else if(l===gb.enums.DCSQueryParams.PRIME_ACCESS_TYPE)c=c.toString();else if(l===gb.enums.DCSQueryParams.ACCESS_TYPE)c=a._populateAccessTypesAsAnArray(c);else if(l===gb.enums.BinningParams.DISCOUNT.key)d||(l=gb.enums.DCSQueryParams.DISCOUNT_RANGE),c=c.split(",");else if(l===gb.enums.BinningParams.GIFT_WRAPPABLE.key||l===gb.enums.BinningParams.CASH_ON_DELIVERY.key||l===gb.enums.BinningParams.FULLFILLED_BY_AMAZON.key)c=
c?["true"]:["false"];else{f.isArray(c)||(c=[c]);if(l===gb.enums.DCSQueryParams.DEAL_STATE){var k=[];f.each(c,function(a){k.push(gb.enums.FilterStatesToDealStates[a])});c=f.flatten(k,!0)}d||l!==gb.enums.BinningParams.PRICE.key||(l=gb.enums.DCSQueryParams.PRICE_RANGE)}return[l,c]});return f.object(c)},_populateAccessTypesAsAnArray:function(d){var b=[];f.isArray(d)?f.each(d,function(a){var c=a;f.isArray(a)||(c=[a]);b.push(c)}):b.push([d]);return b},populateAvailableFilters:function(d){var b=this;f.each(d,
function(a,c){f.isEmpty(a)?delete b.availableFilterOptions[c]:b.availableFilterOptions[c]=a});b.updateSelectedFiltersCount()},_setFilterValue:function(d,b){d===gb.enums.IncludedDealTargetsSupported.MARKETING_ID||d===gb.enums.IncludedDealTargetsSupported.MARKETING_ID_ONLY_SUMMARY?(b=b.toString(),this._removeFilterValue(d,void 0),this._addFilterValue(d,b)):this._selectedFilterValues[d]=b},_addFilterValue:function(d,b){this._selectedFilterValues[d]=this._selectedFilterValues[d]||[];if(d===gb.enums.IncludedDealTargetsSupported.MARKETING_ID||
d===gb.enums.IncludedDealTargetsSupported.MARKETING_ID_ONLY_SUMMARY)b=b.toString();this._selectedFilterValues[d].push(b)},_removeFilterValue:function(d,b){var a=f.flatten([this._selectedFilterValues[d]],!0);this._selectedFilterValues[d]=f.without(a,b);if("undefined"===typeof b||!this._selectedFilterValues[d].length){b=d===gb.enums.IncludedDealTargetsSupported.MARKETING_ID||d===gb.enums.IncludedDealTargetsSupported.MARKETING_ID_ONLY_SUMMARY;var c;b&&(c=gb.utils.getmarketingIDsToKeep(this._selectedFilterValues));
b&&c.length?this._selectedFilterValues[d]=c:(this._selectedFilterValues[d]=null,delete this._selectedFilterValues[d])}},_filterChangeWrapper:function(d){var b=f.tail(arguments),a=this.getDCSQueryParamForBinningKey(b[0]),c=b[1],e=b[2],l=b[3],b=b[4];d.call(this,a,c);a===gb.enums.DCSQueryParams.PAGE&&(this.hasPageChanged=!0);f.isUndefined(e)||(f.isUndefined(c)?e.context=gb.metrics.refTags.clearFilter:e.data.push(c),gb.controller.schedulingParams[e.widgetID].refreshWidgets&&(this.targetedWidget.ID?e.widgetID=
this.targetedWidget.ID:l=!0));l||this.triggerChangeEvent(e,b)},_removeAllFilterValues:function(){var d=gb.enums.DCSQueryParams.SORT_ORDER,b=gb.utils.getmarketingIDsToKeep(this._selectedFilterValues);if(this.customFilter){var a=this.getDCSQueryParamForBinningKey(this.customFilter);this._selectedFilterValues=f.pick(this._selectedFilterValues,a,d)}else this._selectedFilterValues=f.pick(this._selectedFilterValues,d);0<b.length&&(this._selectedFilterValues[gb.enums.IncludedDealTargetsSupported.MARKETING_ID]=
b)},triggerChangeEvent:function(d,b){this.hasPageChanged||(this._selectedFilterValues[gb.enums.DCSQueryParams.PAGE]=1,gb.controller.widgetCurrentPage[d.widgetID]=1);d.eventID&&!gb.resources.deviceInfo.isPhone&&gb.resources.deviceInfo.isApp&&q.when("a-popover").execute(function(a){(a=a.get(gb.enums.WidgetViewIDs.REFINE_POPOVER_NAME))&&a.hide()});this.hasPageChanged=!1;gb.filterControllerFactory.getFilterController(this.widgetName).trigger("gbfilter:change",this,d,b)},updateSelectedFiltersCount:function(){var d=
this;d.selectedFiltersCount=0;f.each(d.attributesList,function(b){d.getSelectedBinningValues(b)&&d.selectedFiltersCount++})},getSelectedFilterCount:function(){return this.selectedFiltersCount}})});q.when("A","GoldboxMobile3PAssets","gb-filter-model").register("gb-shoveler-filter-model",function(g,h,f){var d=h._;return f.extend({init:function(b){this._super(b);this._initalizeFilterChangeHandlers();this._updateDealStates=d.wrap(this._updateDealStatesHandler,this._filterChangeWrapper)},_initalizeFilterChangeHandlers:d.once(function(){g.declarative("gbshovl-state",
"click",d.wrap(function(b,a){var c=gb.controller.schedulingParams[a.widgetID],e=gb.widgets[a.widgetID],d=c.widgetCurrentTab;b=parseInt(b.data.tabIndex,10);d!==b&&(e.isMaxDealLimitReached=!1,e.renderShovlButtonsContent(!0),e.skinDomElement.find("#"+gb.enums.WidgetViewIDs.SHOVL_PAGINATION).html(""),c.widgetCurrentTab=b,e.renderWireFrame(),gb.filterControllerFactory.getFilterController(e.widgetName).models[a.metrics.eventID]._updateDealStates(a.attribute,a.widgetID,a.metrics))},this._shovlFilterChangeWrapper));
g.declarative(gb.enums.WidgetActions.Shoveler.SHOVEL,"click",d.wrap(function(b,a){if(b.data.buttonStatus!==gb.enums.ShovlConstants.DISABLED){var c=gb.widgets[a.widgetID];c.renderShovlButtonsContent(!0);c.isLaunchCellPage=gb.utils.isLaunchCellPage(a.widgetID);var c=gb.controller.widgetCurrentPage[a.widgetID],e=b.data.actionType;e===gb.enums.ShovlConstants.SHOVL_NEXT?c++:e===gb.enums.ShovlConstants.SHOVL_PREVIOUS&&c--;b=parseInt(b.data.totalPages,10);1<=c&&c<=b&&(b=gb.filterControllerFactory.getFilterController(a.widgetName).models[a.metrics.eventID],
gb.controller.widgetCurrentPage[a.widgetID]=c,b.setFilterValue(a.attribute,c,a.metrics))}},this._shovlFilterChangeWrapper))}),_shovlFilterChangeWrapper:function(b){var a=d.tail(arguments)[0],c=parseInt(a.data.widgetID,10),e=a.data.attribute,l=gb.widgets[c].widgetGroupID;c&&l&&b.call(this,a,{attribute:e,metrics:{context:gb.metrics.refTags.filter,data:[l,e],eventID:l,widgetID:c},widgetID:c})},_updateDealStatesHandler:function(b,a){a=gb.controller.schedulingParams[a];var c=d.flatten(a.widgetTabConfig[a.widgetCurrentTab].dealStates);
this._selectedFilterValues[b]=d.clone(c);this._selectedFilterValues[gb.enums.ShovlConstants.SHOVL_STATE_TAB]=a.widgetCurrentTab}})});q.when("A","GoldboxMobile3PAssets","gb-filter-model","gb-shoveler-filter-model").register("gb-filter-model-factory",function(g,h,f,d){return g.createClass({getFilterModel:function(b,a){var c=null;if(b&&a){var e=gb.widgets[b].widgetName;b={widgetGroupID:a,widgetID:b};try{c=e===gb.enums.WidgetNames.PC_SHOVELER?new d(b):new f(b)}catch(l){q.log("FilterModel invoked for the widget is not supported on the platform!",
"ERROR","GoldboxMobileAssets")}}return c}})});q.when("A","GoldboxMobile3PAssets").register("gb-filter-utils",function(g,h){var f=h._;return{_paginationDummyUrls:{PREV:"prev",NEXT:"next"},_sortAlphabetically:function(d){d=f.pairs(d);return f.sortBy(d,function(b){return b[0]})},_sortRanges:function(d){d=f.pairs(d);return f.sortBy(d,function(b){b=b[0].split("-")[0]||0;return parseInt(b,10)})},_getFilterOptionsForDealStates:function(d,b){var a={};f.each(d,function(c){var e=gb.enums.DealStatesToFilterStates[c[0]],
b=parseInt(a[e],10);a[e]=b?(b+parseInt(c[1],10)).toString():c[1]});return f.map(a,function(a,e){return{value:e,selected:f.contains(b,e),count:a,attribute:gb.enums.BinningParams.DEAL_STATE.key}})},getFilterOptions:function(d,b,a){var c=gb.filterControllerFactory.getFilterController(a.widgetName).models[a.widgetGroupID],e=c.getSelectedBinningValues(d);if(d===gb.enums.BinningParams.PRICE.key)f.isArray(e)||(e=[e]),a=this._sortRanges(b),a=f.map(a,function(a){var c=a[0].split("-");return{rangeStart:c[0],
rangeEnd:c[1],value:a[0],count:a[1],attribute:d,selected:f.contains(e,a[0])}});else if(d===gb.enums.BinningParams.DISCOUNT.key){var l="",k=0;f.isArray(e)&&(e=e.join(","));a=this._sortRanges(b).reverse();a=f.map(a,function(a){var c=a[0].split("-");l=l?a[0]+","+l:a[0];k+=a[1];return{rangeStart:c[0]?c[0]:"0",value:l,count:k,attribute:d,selected:e===l}});a=a.reverse()}else if(d===gb.enums.BinningParams.PAGE.key)a=[{currentPage:gb.controller.widgetCurrentPage[a.widgetID],totalPages:a.totalPages,dummyUrls:this._paginationDummyUrls,
count:1,attribute:d,minimalPagination:gb.configManager.getWidgetViewConfig(a.widgetID).minimalPagination}];else if(d===gb.enums.BinningParams.SORT_ORDER.key||d===gb.enums.BinningParams.REVIEW_RATING.key)a=[{count:1,attribute:d,selected:e}];else if(d===gb.enums.BinningParams.PRIME_ELIGIBLE_ONLY.key||d===gb.enums.BinningParams.GLOBAL_ELIGIBLE_ONLY.key||d===gb.enums.BinningParams.NEW_RELEASES.key||d===gb.enums.BinningParams.GIFT_WRAPPABLE.key||d===gb.enums.BinningParams.FREE_SHIPPING_ELIGIBLE_ONLY.key||
d===gb.enums.BinningParams.CASH_ON_DELIVERY.key||d===gb.enums.BinningParams.FULLFILLED_BY_AMAZON.key||d===gb.enums.BinningParams.ACCESS_TYPE)a=[{value:1,selected:e,count:1,attribute:d}];else{d===gb.enums.BinningParams.CATEGORIES.key?(a=f.filter(gb.resources.whitelistedCategoryList,function(a){return a in b}),a=f.map(a,function(a){return[a,b[a]]})):d===gb.enums.IncludedDealTargetsSupported.MARKETING_ID?(a=f.filter(gb.resources.whitelistedMarketingIDList,function(a){return a in b}),a=f.map(a,function(a){return[a,
b[a]]})):a=this._sortAlphabetically(b);var p=c.filterConfigValuesHash[d];p&&(a=f.filter(a,function(a){return f.contains(p,a[0])?!0:!1}),a=f.sortBy(a,function(a){return f.indexOf(p,a[0])}));f.isArray(e)||(e=[e]);a=d===gb.enums.BinningParams.DEAL_STATE.key?this._getFilterOptionsForDealStates(a,e):f.map(a,function(a){return{value:a[0],selected:f.contains(e,a[0]),count:a[1],attribute:d}})}return a},getFilterLabel:function(d,b){if(d){switch(d.attribute){case gb.enums.BinningParams.CATEGORIES.key:d=gb.resources.whitelistedCategoryNamesParsed[d.value];
break;case gb.enums.BinningParams.DEAL_STATE.key:case gb.enums.BinningParams.DEAL_TYPE.key:case gb.enums.BinningParams.PRIME_ACCESS_TYPE.key:b=gb.enums.FilterAttrToStrings[d.value];d=gb.resources.getString(b);break;case gb.enums.BinningParams.ACCESS_TYPE.key:b=gb.enums.FilterAttrToStrings[d.value];d=gb.resources.getString(b);break;case gb.enums.BinningParams.DISCOUNT.key:b=gb.enums.FilterAttrToStrings.DISCOUNT;d.rangeStart?d.rangeEnd||(b=gb.enums.FilterAttrToStrings.DISCOUNT_END):b=gb.enums.FilterAttrToStrings.DISCOUNT_START;
d=gb.resources.getString(b,{start:d.rangeStart,end:d.rangeEnd});break;case gb.enums.BinningParams.FREE_SHIPPING_ELIGIBLE_ONLY.key:b=gb.enums.FilterAttrToStrings.FREE_SHIPPING_ELIGIBLE_ONLY;d=gb.resources.getString(b);break;case gb.enums.BinningParams.GIFT_WRAPPABLE.key:b=gb.enums.FilterAttrToStrings.GIFT_WRAPPABLE;d=gb.resources.getString(b);break;case gb.enums.BinningParams.GLOBAL_ELIGIBLE_ONLY.key:b=gb.enums.FilterAttrToStrings.GLOBAL_ELIGIBLE_ONLY;d=gb.resources.getString(b);break;case gb.enums.BinningParams.NEW_RELEASES.key:b=
gb.enums.FilterAttrToStrings.NEW_RELEASES;d=gb.resources.getString(b);break;case gb.enums.BinningParams.PRICE.key:b=gb.enums.FilterAttrToStrings.PRICE;d.rangeStart?d.rangeEnd||(b=gb.enums.FilterAttrToStrings.PRICE_END):b=gb.enums.FilterAttrToStrings.PRICE_START;d=gb.resources.getString(b,{start:d.rangeStart,end:d.rangeEnd});break;case gb.enums.BinningParams.PRIME_ELIGIBLE_ONLY.key:b=b?gb.enums.FilterAttrToStrings.PRIME_SUMMARY:gb.enums.FilterAttrToStrings.PRIME;d=gb.resources.getString(b);break;case gb.enums.BinningParams.REVIEW_RATING.key:b=
gb.enums.FilterAttrToStrings.REVIEW_RATING;d=gb.resources.getString(b,{stars:d.selected});break;case gb.enums.BinningParams.SORT_ORDER.key:b=gb.enums.SortOrdersToStringsMap[d.selected];d=gb.resources.getString(b);break;case gb.enums.BinningParams.CASH_ON_DELIVERY.key:b=gb.enums.FilterAttrToStrings.CASH_ON_DELIVERY;d=gb.resources.getString(b);break;case gb.enums.BinningParams.FULLFILLED_BY_AMAZON.key:b=gb.enums.FilterAttrToStrings.FULLFILLED_BY_AMAZON;d=gb.resources.getString(b);break;case gb.enums.IncludedDealTargetsSupported.MARKETING_ID:d=
gb.resources.whitelistedMarketingIDNamesParsed[d.value];break;default:d=d.value}return d}},getLabelForSelectedAttribute:function(d,b){var a,c,e=gb.filterControllerFactory.getFilterController(b.widgetName).models[b.widgetGroupID];b.widgetGroupID&&(c=e.getSelectedBinningValues(d));if(c){var l={};gb.enums.BinningParams.DEAL_STATE.key===d?l=f.object(gb.enums.FilterStatesToDealStates[c],f.range(gb.enums.FilterStatesToDealStates[c].length).map(function(){return 1})):f.isArray(c)?f.each(c,function(a){l[a]=
1}):l[c]=1;(d=this.getFilterOptions(d,l,b)[0])&&(a=this.getFilterLabel(d))}return a},setUrlFilterParam:function(d,b,a,c){var e=d.indexOf("#"),l=-1===e?"":d.substr(e);d=-1===e?d:d.substr(0,e);b=encodeURIComponent(b);e=new RegExp("([,])"+b+":.*?(\x26|$)","i");d.match(e)?d=d.replace(e,"$1"+b+":"+a+"$2"):(e=gb.utils.getParamValueFromUrl(d,c),e=f.isEmpty(e)?b+":"+a:e+","+b+":"+a,d=gb.utils.setUrlParam(d,c,e));return d+l}}});q.when("A","GoldboxMobile3PAssets","gb-event-emitter","gb-deal-asin-dao","gb-csm").register("gb-dcs-translator",
function(g,n,f,d,b){var a=n._;return f.extend({init:function(){this._super();this.registerConnections()},registerConnections:function(){this.on("PopulateMetadata",this.populateSelectDealsMetadata);this.on("PopulateDealDAO",this.populateDealDetails);this.on("PopulateStatus",this.populateDealStatus)},populateSelectDealsMetadata:function(c,e){var d=this;if(e&&e.dealDetails&&e.dealStatus){c=e.dealDetails;var k=e.dealStatus,f=(new Date).getTime();e=gb.resources.customerData;gb.resources.isAcceleratedExperience&&
e&&e.gbZoneInfo&&e.gbZoneInfo.currentTimeStampInMillis&&(e=new Date(e.gbZoneInfo.currentTimeStampInMillis),e instanceof Date&&!isNaN(e)&&(f=e.getTime()));a.each(c,function(a,c){var e=gb.controller.getDealDAO(c);k&&k[c]?(c=k[c],c.responseTimestamp=f,d.trigger("PopulateDealDAO",e,a,c)):b.logFatal(Error("Some deal ids in detail fed to widget bootstrap missing in the status feed parsed. DCS DealStatus missing for deal id - "+c))})}},populateDealDetails:function(c,e,b){if(e){gb.service.dealsWithDetails[c.dealID]=
!0;c.dealType=e.type;c.legacyDealID=e.legacyDealID;c.offerID=e.offerID;c.merchantID=e.merchantID;c.merchantName=e.merchantName;var d=gb.resources.getFeature("gb_giveaway_deals");c.detail.title=e.title;e.primaryImage&&(c.detail.imageAsin=gb.baseUtils.checkAndSetSSLImageUrl(e.primaryImage));c.detail.description=e.description;c.detail.URL=this._setDealDetailURL(e,!1);c.detail.itemType=e.itemType;c.detail.buyAsin=e.reviewAsin;c.detail.impressionAsin=e.impressionAsin;e.reviewAsin&&(c.reviews.URL=gb.utils.getReviewsPageURL(e.reviewAsin,
e.type));e.marketingMessage&&(c.detail.marketingMessage=e.marketingMessage);e.isFulfilledByAmazon&&(c.detail.isFulfilledByAmazon=e.isFulfilledByAmazon);null!==e.totalReviews&&void 0!==e.totalReviews&&(c.reviews.total=parseInt(e.totalReviews,10));null!==e.reviewRating&&void 0!==e.reviewRating&&(c.reviews.rating=parseFloat(e.reviewRating));c.auxiliaryData.isPrimeEligible=gb.resources.getCustomerData("isPrimeMarketplace")&&gb.utils.parseBool(e.isPrimeEligible);e.teaser&&(c.teaser.teaserLine=e.teaser);
e.teaserImage&&(c.teaser.teaserImage=gb.baseUtils.checkAndSetSSLImageUrl(e.teaserImage));e.teaserAsin&&(c.teaser.teaserURL=this._setDealDetailURL(e,!0));this._setAccessType(c,e,b,d);c.detail.isPrimeEarlyAccessDeal=!1;c.detail.isPrimeOnly=!1;switch(c.detail.accessType){case gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS:c.detail.isPrimeEarlyAccessDeal=!0;break;case gb.enums.DealAccessTypes.PRIME_ONLY_DOTD:case gb.enums.DealAccessTypes.PRIME_ONLY_LD:case gb.enums.DealAccessTypes.PRIME_ONLY_BD:c.detail.isPrimeOnly=
!0;break;case gb.enums.DealAccessTypes.APP_ONLY_LD:case gb.enums.DealAccessTypes.APP_EARLY_ACCESS:c.detail.isAppDeal=!0;break;case gb.enums.DealAccessTypes.GIVEAWAY_DEAL:c.detail.isGiveawayDeal=!0}c.detail.isGiveawayDeal&&b.dealState===gb.enums.DealStates.AVAILABLE&&(c.detail.URL=this._setGiveawayDealDetailURL(c.detail.URL));c.auxiliaryData.breaksMAP=gb.utils.parseBool(e.isMAP);null!==e.maxDealPrice&&void 0!==e.maxDealPrice&&null!==e.minDealPrice&&void 0!==e.minDealPrice?c.pricingData.prices.dealPrice=
{max:{value:parseFloat(e.maxDealPrice)},min:{value:parseFloat(e.minDealPrice)}}:c.detail.isGiveawayDeal&&!a.isEmpty(e.marketingMessage)&&(c.detail.giveawayValue=e.marketingMessage);null!==e.maxBAmount&&void 0!==e.maxBAmount&&null!==e.minBAmount&&void 0!==e.minBAmount&&(c.pricingData.prices.basisPrice={max:{value:parseFloat(e.maxBAmount)},min:{value:parseFloat(e.minBAmount)}});null!==e.pricePerUnit&&void 0!==e.pricePerUnit&&(c.pricingData.unitPrice={value:parseFloat(e.pricePerUnit)},c.pricingData.unitPrice.formattedValue=
gb.utils.getFormattedPrice(c.pricingData.unitPrice.value));null!==e.baseUnitValue&&void 0!==e.baseUnitValue&&null!==e.baseUnitName&&void 0!==e.baseUnitName&&(c.pricingData.baseUnit={value:e.baseUnitValue,name:e.baseUnitName});a.each(c.pricingData.prices,function(b,e){null===b&&void 0===b||a.each(b,function(a,b){c.pricingData.prices[e][b].formattedValue=gb.utils.getFormattedPrice(c.pricingData.prices[e][b].value)})});if(e.maxPercentOff&&e.minPercentOff){var d=parseInt(e.maxPercentOff,10),f=parseInt(e.minPercentOff,
10);d===f&&(c.pricingData.percentOff=gb.utils.getDisplayablePercentOff(d))}null!==c.pricingData.percentOff&&void 0!==c.pricingData.percentOff||c.calculatePercentOff();c.detail.itemType===gb.enums.ItemTypes.VARIATION&&this.populateAsinDetails(e.items,c);e.bKind&&(c.pricingData.bKind=e.bKind);e.glProductGroup&&-1!==a.indexOf(gb.utils.digitalGlProductGroup,e.glProductGroup)&&(c.isDigital=!0);e.glProductGroup&&gb.utils.isEbook(e.glProductGroup)&&(c.isEBook=!0);this._setExtendedAttributes(c,e);this._groupDealsByType(c);
this._groupDealsByAccessType(c);this._executePostTranslationRules(c);b&&this.populateDealStatus(c,b)}},_setAccessType:function(a,b,d,k){b.accessBehavior&&null!==b.accessBehavior.accesslogic?(b=gb.utils.deduceAccessTypeInfoFromGetDealResponse(b,d,k),a.detail.accessType=b.accessType,a.detail.accessDurationInMs=parseInt(b.accessTypeDuration,10)*gb.enums.Constants.MINUTE_IN_MILLIS):b.primeAccessType&&(gb.enums.DealAccessTypes[b.primeAccessType]&&(a.detail.accessType=b.primeAccessType),a.detail.accessDurationInMs=
parseInt(b.primeAccessDuration,10)*gb.enums.Constants.MINUTE_IN_MILLIS)},_setGiveawayDealDetailURL:function(a){var b=h.location.protocol+"//"+h.location.host,b=gb.resources.deviceInfo.isApp?b+gb.enums.GiveawayUrlParams.returnToUrlMob:b+gb.enums.GiveawayUrlParams.returnToUrlPc;a=gb.utils.setUrlParam(a,"fsrc",gb.enums.GiveawayUrlParams.client);a=gb.utils.setUrlParam(a,"return_to",encodeURIComponent(b));return a=gb.utils.setUrlParam(a,"nav",gb.enums.GiveawayUrlParams.nav)},_groupDealsByType:function(a){var b=
gb.metadata.dealsByType[a.dealType]||[];b.push(a.dealID);gb.metadata.dealsByType[a.dealType]=b},_groupDealsByAccessType:function(a){var b=a.detail.accessType;if(b){var d=gb.metadata.dealsByAccessType[b]||[];d.push(a.dealID);gb.metadata.dealsByAccessType[b]=d}},_setExtendedAttributes:function(c,b){(b=b.extendedAttributes)&&a.isArray(b.hideAddToCart)&&"1"===b.hideAddToCart[0]&&(c.extendedAttributes.hideAddToCart=!0)},_setDealDetailURL:function(a,b){var d=a.merchantID,k=gb.clientName,f=a.egressUrl,g=
f,r=a.itemType,h=a.reviewAsin;b&&(h=a.teaserAsin);f=f?-1===f.indexOf("/dp/")||-1!==f.indexOf("forceLinkOverride"):!1;if(k===gb.enums.MobileClients.PC){if(a.type===gb.enums.DealTypes.EVENT&&!f||b)g=h?gb.utils.getDetailPageURL(h,k):"";g&&d&&!gb.utils.hasConflictingDpParams(g)&&(g=gb.utils.setUrlParam(g,"smid",d))}else{if(a.type!==gb.enums.DealTypes.EVENT||!f){gb.utils.isTablet(k)&&(k=gb.enums.Platforms.TAB);var n=gb.utils.isUnsupportedEgressURL(a),q=gb.resources.deviceInfo,f=!1;if(a.type===gb.enums.DealTypes.DOTD||
a.type===gb.enums.DealTypes.BD||a.primeAccessType===gb.enums.DealAccessTypes.PRIME_ONLY_DOTD)if(r===gb.enums.ItemTypes.SINGLE||n||q.isWindowsPhone||q.isMetro)f=!0;r=a.type===gb.enums.DealTypes.LD&&a.primeAccessType!==gb.enums.DealAccessTypes.PRIME_ONLY_DOTD||a.type===gb.enums.DealTypes.LOCAL||a.type===gb.enums.DealTypes.EVENT;if(b||f||r)a.type===gb.enums.DealTypes.BD&&a.itemType===gb.enums.ItemTypes.NONE&&(h=gb.utils.getAsinFromURL(a.egressUrl)),g=h?gb.utils.getDetailPageURL(h,k):""}g&&d&&!gb.utils.hasConflictingDpParams(g)&&
(g=gb.utils.setUrlParam(g,"smid",d));g&&(g=gb.utils.setUrlParam(g,"dealid",a.dealID))}return g=gb.utils.convertToRequesterDomainUrl(g)},populateDealStatus:function(c,b,d){if(b){var k=b.responseTimestamp||(new Date).getTime(),f=c.status.dates.cacheExpires;c.dealType===gb.enums.DealTypes.LD&&!gb.utils.parseBool(b.isRedemptionStatus)&&f&&f.getTime()>k||(c.customerState=null,c.checkingDealStatus=!1,void 0!==b.percentClaimed&&null!==b.percentClaimed&&(c.status.percentClaimed=parseInt(b.percentClaimed,
10)),void 0!==b.isValid&&null!==b.isValid&&(c.status.isValidDeal=b.isValid),void 0!==b.msCacheTtl&&null!==b.msCacheTtl&&(f=parseInt(b.msCacheTtl,10),c.status.cache.lastMsCacheTtl=f,c.status.dates.cacheExpires=new Date(k+f)),void 0!==b.msToEnd&&null!==b.msToEnd&&(c.status.dates.end=new Date(k+parseInt(b.msToEnd,10))),void 0!==b.msToStart&&null!==b.msToStart&&(c.status.dates.start=new Date(k+parseInt(b.msToStart,10))),gb.resources.customerData.hasEarlyAccessBenefit||(k=c.status.dates.start.getTime()+
c.detail.accessDurationInMs,c.status.dates.startForNonPrimeCustomer=new Date(k)),void 0!==b.totalCouponCount&&null!==b.totalCouponCount&&(c.couponCounts.total=parseInt(b.totalCouponCount,10)),gb.metadata.dealsByState[b.dealState]=gb.metadata.dealsByState[b.dealState]||[],gb.metadata.dealsByState[b.dealState].push(c.dealID),b.dealState&&(b.dealState===gb.enums.DealStates.UPCOMING&&0>=parseInt(b.msToStart,10)?c.dealState=gb.enums.DealStates.COMINGSOON:c.dealState=b.dealState),c.detail.itemType===gb.enums.ItemTypes.VARIATION&&
a.each(b.dealItemStatus,function(a,b){(b=c.getAsinDAO(b))&&a&&gb.translator.populateAsinStatus(b,a)}),!a.isEmpty(gb.metadata.watchedDeals)&&-1<a.indexOf(gb.metadata.watchedDeals.ALL,c.dealID)&&(c.isDealWatched=!0),this._setDealTimeouts(c,b),c.trigger("RefreshView"),d&&d(c))}},populateAsinStatus:function(a,b){a.status.itemState=b.itemState;a.status.customerState=b.customerState;void 0!==b.percentClaimed&&null!==b.percentClaimed&&(a.status.percentClaimed=b.percentClaimed);var d=gb.controller.getDealDAO(a.dealID);
d.dealType!==gb.enums.DealTypes.LD||gb.resources.isAcceleratedExperience||this._setAsinTimeouts(d,a,b)},translateClaimDealStatus:function(a,b,d){if(d)return a={isRedemptionStatus:!0,msCacheTtl:gb.enums.DefaultPollingIntervals.LD,dealItemStatus:{}},void 0!==d.msCacheTtl&&null!==d.msCacheTtl&&(a.msCacheTtl=parseInt(d.msCacheTtl,10)),d.dealItemStatus&&(a.dealItemStatus[b]={itemState:d.dealItemStatus.itemState,customerState:d.dealItemStatus.customerState,msToCustomerStateExpiry:d.dealItemStatus.msToCustomerStateExpiry}),
a},_setAsinTimeouts:function(a,b,d){var k=b.status.timeouts,f=b.status.dates,g=(new Date).getTime();h.clearTimeout(k.incartEnds);h.clearTimeout(k.pendingATCEnds);k.incartEnds=f.incartEnds=k.pendingATCEnds=f.pendingATCEnds=null;b.status.customerState===gb.enums.CustomerStates.INCART&&d.msToCustomerStateExpiry&&(f.incartEnds=new Date(g+parseInt(d.msToCustomerStateExpiry,10)),h.clearTimeout(k.incartEnds),k.incartEnds=gb.utils.setSafeTimeout(function(){b.status.customerState=null;a.checkingDealStatus=
!0;a.trigger("RefreshView")},f.incartEnds.getTime()-g));b.status.customerState===gb.enums.CustomerStates.PENDINGATC&&d.msToCustomerStateExpiry&&(f.pendingATCEnds=new Date(g+parseInt(d.msToCustomerStateExpiry,10)),h.clearTimeout(k.pendingATCEnds),k.pendingATCEnds=gb.utils.setSafeTimeout(function(){b.status.customerState=null;a.checkingDealStatus=!0;a.trigger("RefreshView")},f.pendingATCEnds.getTime()-g))},_setDealTimeouts:function(c,b){var d=c.status.timeouts,k=c.status.dates,f=(new Date).getTime();
h.clearTimeout(d.end);h.clearTimeout(d.start);h.clearTimeout(d.incartEnds);h.clearTimeout(d.earlyAccessExpires);h.clearTimeout(d.pendingATCEnds);d.end=d.start=d.incartEnds=d.earlyAccessExpires=k.incartEnds=k.pendingATCEnds=d.pendingATCEnds=c.customerState=null;c.dealState!==gb.enums.DealStates.SOLDOUT&&c.dealState!==gb.enums.DealStates.EXPIRED&&(d.end=gb.utils.setSafeTimeout(function(){c.dealState=gb.enums.DealStates.EXPIRED;c.trigger("RefreshView");gb.utils.invokeWatchDealStateTransitions(c.dealID)},
k.end.getTime()-f));if(gb.utils.isDealInEarlyAccessWindow(c)){var g=c.detail.accessDurationInMs+parseInt(b.msToStart,10);if(gb.resources.isAcceleratedExperience||g<=parseInt(b.msCacheTtl,10))h.clearTimeout(d.earlyAccessExpires),d.earlyAccessExpires=h.setTimeout(function(){c.trigger("RefreshView");gb.utils.invokeWatchDealStateTransitions(c.dealID)},g)}c.dealState===gb.enums.DealStates.UPCOMING&&(c.dealType===gb.enums.DealTypes.LD&&gb.utils.hasPricingDetails(c)?d.start=gb.utils.setSafeTimeout(function(){c.dealState=
gb.enums.DealStates.AVAILABLE;a.each(c.items,function(a,c,b){a.status.itemState=gb.enums.DealStates.AVAILABLE});gb.service.dealsWithDetails[c.dealID]=!0;gb.utils.invokeWatchDealStateTransitions(c.dealID);c.trigger("RefreshView")},k.start.getTime()-f):d.start=gb.utils.setSafeTimeout(function(){c.dealState=gb.enums.DealStates.LOADING;gb.service.dealsWithDetails[c.dealID]=!1;c.trigger("RefreshView");gb.service.getDealDetails(c.dealID);gb.utils.invokeWatchDealStateTransitions(c.dealID)},k.start.getTime()-
f));gb.watcher.dealsInView[c.dealID]&&(h.clearTimeout(d.cacheExpires),d.cacheExpires=h.setTimeout(function(){c.dealType!==gb.enums.DealTypes.LD||c.dealState!==gb.enums.DealStates.UPCOMING||gb.utils.hasPricingDetails(c)?gb.resources.isAcceleratedExperience||gb.service.pollDealStatus(c.dealID):(gb.service.dealsWithDetails[c.dealID]=!1,gb.service.getDealDetails(c.dealID))},k.cacheExpires.getTime()-f));gb.resources.isAcceleratedExperience||(b=b.dealItemStatus&&b.dealItemStatus[c.detail.buyAsin],g=c.detail.itemType===
gb.enums.ItemTypes.VARIATION&&c.dealType===gb.enums.DealTypes.LD,b&&a.contains(a.values(gb.enums.CustomerStates),b.customerState)&&!g&&(c.customerState=b.customerState),c.dealType===gb.enums.DealTypes.LD&&b&&b.customerState===gb.enums.CustomerStates.INCART&&!g&&b.msToCustomerStateExpiry&&(k.incartEnds=new Date(f+parseInt(b.msToCustomerStateExpiry,10)),h.clearTimeout(d.incartEnds),d.incartEnds=gb.utils.setSafeTimeout(function(){c.customerState=null;c.checkingDealStatus=!0;c.trigger("RefreshView")},
k.incartEnds.getTime()-f)),c.dealType===gb.enums.DealTypes.LD&&b&&b.customerState===gb.enums.CustomerStates.PENDINGATC&&!g&&b.msToCustomerStateExpiry&&(k.pendingATCEnds=new Date(f+parseInt(b.msToCustomerStateExpiry,10)),h.clearTimeout(d.pendingATCEnds),d.pendingATCEnds=gb.utils.setSafeTimeout(function(){c.customerState=null;c.checkingDealStatus=!0;c.trigger("RefreshView")},k.pendingATCEnds.getTime()-f)))},populateAsinDetails:function(c,b){a.each(c,function(a){var c=new d(a);b.items[a.itemID]=c})},
_executePostTranslationRules:function(a){if("LOCAL_DEAL"===a.dealType&&a.detail){var b=a.detail.URL;if(b){var d=b.match(/:\/\/(.[^\/]+)/)[1];if(d&&d.match(/^local\./)){var k=b.split(d),d=d.replace(/^local\./,"www."),b=k[0],k=k[1];b&&k&&(a.detail.URL=b+d+"/local"+k)}}}}})});q.when("A","GoldboxMobile3PAssets").register("gb-view-component-builder",function(g,n){var f=n._;return g.createClass({_addMetricsData:function(d,b){b=[d.deal&&d.deal.dealID];d.deal&&d.deal.detail&&d.deal.detail.isAppDeal&&b.push(gb.metrics.refTags.app);
if(d.deal&&d.deal.detail&&d.deal.detail.isGiveawayDeal){var a=gb.metadata.getDealIDPosition(d.deal.dealID,d.widgetID);b.push(a)}d.getReffedURL=gb.metrics.partiallyAppliedReffedURLFunction({widgetID:d.widgetID,data:b});return d},_addMobileReffedDetailURL:function(d){var b;b=d.deal.dealState===gb.enums.DealStates.UPCOMING||d.deal.dealState===gb.enums.DealStates.COMINGSOON?d.deal.teaser.teaserURL:d.deal.detail.URL;b=d.deal&&d.deal.detail&&d.deal.detail.isGiveawayDeal?d.getReffedURL(b,gb.metrics.refTags.giveawayMobile):
d.getReffedURL(b,gb.metrics.refTags.mobile);gb.utils.isSponsoredDeal(d.deal.dealID,gb.metadata.customResponseAttributes[d.widgetID])&&(b=gb.utils.getSponsoredDealUrl(d.sponsoredDealAttr,b));d.mobileReffedDetailURL=b;return d},_getWidgetViewFlexModelData:function(d,b){var a=gb.configManager.getWidgetViewConfig(d.widgetID),c=document.documentElement.style;if(a.allowFlexRendering&&("flexWrap"in c||"WebkitFlexWrap"in c||"msFlexWrap"in c)){var e=gb.configManager.getDealViewConfig(d.widgetID),c=e.dealsPerRowP,
e=e.dealsPerRowL,l,k;k=d.skinDomElement.find(".dealView");l=gb.utils.getDealsPerRow(g.$(h).height(),d.minDealViewWidth,a.hasMargin,a.supportEvenColumnsOnly);d.viewOrientation===gb.enums.ClientOrientation.LANDSCAPE?(e=b.columnCount<=e?b.columnCount:e,c=l<=c?l:c,b.columnCount=e):(c=b.columnCount<=c?b.columnCount:c,e=l<=e?l:e,b.columnCount=c);0<k.size()?(a=k.eq(0),k=parseFloat(a.data("pwidth")),a=parseFloat(a.data("lwidth"))):(l=gb.utils.getComputedDealWidthForFlexWidget(d.dealsPerRow,a.supportEvenColumnsOnly),
k=c===d.dealsPerRow?l:gb.utils.getComputedDealWidthForFlexWidget(c,a.supportEvenColumnsOnly),a=e===d.dealsPerRow?l:gb.utils.getComputedDealWidthForFlexWidget(e,a.supportEvenColumnsOnly));l=d.viewOrientation===gb.enums.ClientOrientation.PORTRAIT?k:a;b.doFlexRendering=!0;b.dealWidth=l+"%";b.dealWidthP=k+"%";b.dealWidthL=a+"%";b.dealPerRow={};b.dealPerRow[gb.enums.ClientOrientation.PORTRAIT]=c;b.dealPerRow[gb.enums.ClientOrientation.LANDSCAPE]=e;c=b.elements||{};c.flexContainer=gb.templateManager.getWidgetHTML({widgetID:d.widgetID,
templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"flexContainer",data:b});b.elements=c}},getWidgetViewTemplateData:function(d,b){var a=d.widgetID,c=gb.controller.schedulingParams[a],e=gb.enums.WidgetViewIDs,l=gb.enums.WidgetHeaderIDs,k=gb.configManager.getDealViewConfig(a),f=d.dealsPerRow,g=gb.watcher.lowestDealIDWatchedIndex[a]+1-d.nextPositionToRender,h=Math.ceil(g/c.pageSize),n=Math.ceil((d.nextPositionToRender+1)/c.pageSize);if(c.enforceLimitedDeals||c.enablePagination)var h=
1,q=c.pageSize,g=Math.min(gb.metadata.selectedDealsCount[a]-(gb.controller.widgetCurrentPage[a]-1)*q,q);n=b?1:n;q=gb.enums.Constants.MAX_SUPPLE_DEALS_TO_DISPLAY;c.pageSize&&(q=c.pageSize);b=this._getCurrentCategory(a);var t=this._getCurrentStates(a),w=gb.utils.getFilterViewIDs(c.filterConfig),y=c.redirectText||gb.resources.getString("gb_see_all_deals"),z=0,B,A=gb.filterControllerFactory.getFilterController(d.widgetName).models[d.widgetGroupID];A&&(z=A.getSelectedFilterCount(),A.customFilter&&(B=gb.filterUtils.getLabelForSelectedAttribute(A.customFilter,
{widgetID:d.widgetID,widgetGroupID:d.widgetGroupID,totalPages:d.totalPages}))&&--z);e={widgetView:d,schedulingParams:c,widgetID:a,widgetGroupID:d.widgetGroupID,viewIDs:e,filterViewIDs:w,totalDeals:gb.metadata.getAllDisplayableDealIDs(a).length,totalDealsToShowCount:gb.controller.totalDealsToShow[a],totalDisplayableDealsCount:gb.controller.totalDisplayableDealsCount[a],orientation:d.viewOrientation,dealViewCount:d.nextPositionToRender,dealViewConfig:k,firstPage:n,columnCount:f,cellCount:g,pagesToDraw:h,
pageSize:q,seeAllText:y,WidgetHeaderIDs:l,selectedFilterCount:z,sortOptionSelected:gb.resources.getString(gb.enums.SortOrdersToStringsMap[c.sortOrder]),customFilterSelected:B,nextAdSlotToRenderIndex:d.nextAdSlotToRenderIndex,currentCategory:b,currentStates:t,title:c.title};this._getWidgetViewFlexModelData(d,e);l=gb.controller.widgetCurrentStatus[a];b&&(gb.controller.isPaginatedMetadataCall(a)&&(e.dealCount=gb.metadata.getAllDisplayableDealIDs(a).length),gb.metadata.sortedDealIDs[a][l]&&gb.metadata.sortedDealIDs[a][l][b]&&
(e.dealCount=gb.metadata.sortedDealIDs[a][l][b].length));c.enablePagination&&(e.widgetLandingPageUrl=gb.utils.getWidgetLandingPageUrl(a));d.deprecateNoDealMsg||(l=this._getNoDealsMessage(d),e.noDealsMessage=l.message,e.isFiltersSelected=l.isFiltersSelected,e.isGDMFailing=d.isGDMFailing,e.isRetryInProgress=d.isRetryInProgress);!c.enablePagination&&gb.watcher.lowestDealIDWatchedIndex[a]<e.totalDeals-1&&!c.watchedDealsWidget?e.showLoadingSpinner=!0:(d.hideScrollContentLoader(),e.showLoadingSpinner=!1);
return this._addMetricsData(e)},getRefineTemplateData:function(d,b){var a=this.getWidgetViewTemplateData(d);a.useLinksForFilterItem=!0;var c=[];if(gb.controller.isPaginatedMetadataCall(d.widgetID)){a.useLinksForFilterItem=!1;var e=gb.metadata.binningInfo[d.widgetID].whitelist_categories,l=[];gb.resources.whitelistedCategoryList.forEach(function(a){e&&e[a]&&l.push(a)});if(l){for(var k=0;k<l.length;k++)var p=e[l[k]],c=this._getRefineRowData(p,l[k],c,b);b=gb.widgets[d.widgetID].widgetGroupID;d=gb.filterControllerFactory.getFilterController(d.widgetName).models[b].attributesList;
f.contains(d,gb.enums.BinningParams.PRIME_ACCESS_TYPE.key)&&(a.showPEALink=!0,a.PEAText=gb.resources.getString("csld-cat-prime_early_access_deals"),a.POLDText=gb.resources.getString(gb.enums.FilterAttrToStrings.PRIME_ONLY_LD),a.PODOTDText=gb.resources.getString(gb.enums.FilterAttrToStrings.PRIME_ONLY_DOTD))}}else for(var k=gb.metadata.getMetadataCategories(d.widgetID),g=gb.controller.widgetCurrentStatus[d.widgetID],h=0;h<k.length;h++)p=gb.metadata.sortedDealIDs[d.widgetID][g][k[h]].length,c=this._getRefineRowData(p,
k[h],c,b);a.categoryData=c;return a},_getRefineRowData:function(d,b,a,c){c=gb.resources.getCategoryName(b,c);b!==gb.enums.CategoryFilters.ALL&&(c=c+" ("+d+")");0<d&&a.push({nodeId:b,text:c});return a},getDealViewTemplateData:function(d,b){var a=d.deal;if(a.dealState===gb.enums.DealStates.LOADING)return{};var c=d.widgetView,e=gb.configManager.getWidgetViewConfig(c.widgetID),l=gb.configManager.getDealViewConfig(c.widgetID),k=null,f=!1,u=!1,h="",n=gb.resources.getCustomerData("realm"),q=this._populateSponsoredDealAttributes(c.widgetID,
a.dealID);"function"===typeof c._isDoubleCell&&(f=c._isDoubleCell(a.dealID));if(a.dealType===gb.enums.DealTypes.COUPON||a.dealType===gb.enums.DealTypes.LOCAL)k=a.detail.marketingMessage;gb.utils.showPPU(a.dealID)&&a.pricingData.unitPrice&&a.pricingData.baseUnit&&(u=!0,h=gb.resources.getString("gb_ppu_price",{price:a.pricingData.unitPrice.formattedValue,unitValue:a.pricingData.baseUnit.value,unitName:a.pricingData.baseUnit.name}));var t=gb.controller.watchDealView?gb.controller.watchDealView._isPopupTriggerRequired(c):
!1,e={widgetID:c.widgetID,widgetGroupID:c.widgetGroupID,deal:a,dealViewConfig:l,widgetViewConfig:e,position:d.position,viewIDs:gb.enums.dealViewIDs,totalDeals:gb.metadata.selectedDealsCount[c.widgetID],orientation:c.viewOrientation,marketingMessage:k,isDoubleCell:f,isPrimeEarly:a.detail.isPrimeEarlyAccessDeal,isPrimeOnly:a.detail.isPrimeOnly,showPPU:u,ppuPrice:h,isPopupTriggerRequired:t,realm:n,sponsoredDealAttr:q};e.showPercentOff=gb.utils.isShowPercentageOffEnabled();e.priceText=gb.utils.getPriceTextForBasisKind(a.pricingData.bKind);
k=gb.templateManager.hasTemplate({widgetID:c.widgetID,templateGroup:gb.templateManager.TemplateGroups.DEAL_VIEW,templateName:"badge"});f=gb.templateManager.hasTemplate({widgetID:c.widgetID,templateGroup:gb.templateManager.TemplateGroups.DEAL_VIEW,templateName:"primeBadge"});if(k||f)e.badgeProperty=gb.badgeUtils.generateBadgeProperties(d);a.detail.itemType===gb.enums.ItemTypes.VARIATION&&gb.widgets[c.widgetID].widgetName===gb.enums.WidgetNames.ML_HERO?(e.asin=b,e.dimensionData=this._findDimensionData(a),
e.selectedDimension=d.variationView.selectedDimension,e.unavailableAsinSelected=d.variationView.unavailableAsinSelected,e.templateDecisionInfo=gb.utils.getVariationCustomerActionTemplateInfo(d,b),e.priceText=b?gb.utils.getPriceTextForBasisKind(b.bKind):gb.utils.getPriceTextForBasisKind(a.pricingData.bKind),this._setDealViewTimerData(d,e,b)):(e.templateDecisionInfo=gb.utils.getCustomerActionTemplateInfo(a,c.widgetID),this._setDealViewTimerData(d,e));e.cellCount=gb.metadata.getSortedDealIDs(c.widgetID).length;
e.customerRefTag=gb.service.customerID?gb.metrics.refTags.recLearnMore:gb.metrics.refTags.unrecLearnMore;e.imageSize=g.capabilities.hires?l.imageSizeLarge||l.imageSize:l.imageSize;d=!1;b="medium";gb.utils.isTablet()&&(d=!0,b="mini");e.isTabletButton=d;e.buttonContainerSpacing=b;return this._addMobileReffedDetailURL(this._addMetricsData(e))},getDealOptionsTemplateData:function(d){var b={},a=d.widgetView.widgetID,c=gb.configManager.getWidgetViewConfig(a),e=gb.utils.isShowPercentageOffEnabled();a&&c.supportWatch&&
d.deal.isDealWatched&&(b.StopWatching=gb.enums.BottomSheetActions.StopWatching);return{widgetID:a,position:d.position,deal:d.deal,dealAction:b,showPercentOff:e}},getMiniDPViewTemplateData:function(d,b,a){var c=d.deal;if(c.dealState===gb.enums.DealStates.LOADING)return{};var e=d.widgetView,l=gb.configManager.getWidgetViewConfig(e.widgetID),k=gb.configManager.getDealViewConfig(e.widgetID),f=null;if(c.dealType===gb.enums.DealTypes.COUPON||c.dealType===gb.enums.DealTypes.LOCAL)f=c.detail.marketingMessage,
c.dealType===gb.enums.DealTypes.COUPON&&(f=f+" "+gb.resources.getString("gb_coupon"));var g=gb.controller.watchDealView?gb.controller.watchDealView._isPopupTriggerRequiredForMiniDP(e):!1,l={widgetID:e.widgetID,widgetGroupID:e.widgetGroupID,deal:c,dealViewConfig:k,widgetViewConfig:l,position:d.position,viewIDs:gb.enums.dealViewIDs,totalDeals:gb.metadata.selectedDealsCount[e.widgetID],orientation:e.viewOrientation,marketingMessage:f,isPrimeEarly:c.detail.isPrimeEarlyAccessDeal,isPrimeOnly:c.detail.isPrimeOnly,
isMiniDP:!0,isPopupTriggerRequired:g};l.showPercentOff=gb.utils.isShowPercentageOffEnabled();l.priceText=gb.utils.getPriceTextForBasisKind(c.pricingData.bKind);l.templateDecisionInfo=gb.utils.getCustomerActionTemplateInfo(c,e.widgetID);c.detail.itemType===gb.enums.ItemTypes.VARIATION?(l.asin=a,l.dimensionData=this._findDimensionData(c),l.selectedDimension=d.variationView.selectedDimension,l.unavailableAsinSelected=d.variationView.unavailableAsinSelected,l.templateDecisionInfo=gb.utils.getVariationCustomerActionTemplateInfo(d,
a),this._setMiniDPAsinViewTimerData(d,a,l,b.id),l.priceText=a?gb.utils.getPriceTextForBasisKind(a.bKind):gb.utils.getPriceTextForBasisKind(c.pricingData.bKind)):(l.templateDecisionInfo=gb.utils.getCustomerActionTemplateInfo(c,e.widgetID),this._setMiniDetailPageViewTimerData(d,l,b.id));return this._addMobileReffedDetailURL(this._addMetricsData(l))},getDealStateTemplateData:function(d,b,a){var c=d.deal,e=d.widgetView,l=gb.configManager.getWidgetViewConfig(e.widgetID),k=gb.configManager.getDealViewConfig(e.widgetID),
f=gb.enums.dealViewIDs,g=!1,h=!1,n=gb.resources.getCustomerData("realm"),q=!1,t=this._populateSponsoredDealAttributes(e.widgetID,c.dealID);if(n===gb.enums.Realms.JP||n===gb.enums.Realms.CN)h=!0;c.dealType===gb.enums.DealTypes.LD&&gb.controller.schedulingParams[e.widgetID].fetchWatchedDeals&&(q=!0,c.detail.accessType===gb.enums.DealAccessTypes.PRIME_ONLY_DOTD||c.detail.accessType===gb.enums.DealAccessTypes.APP_EARLY_ACCESS||c.detail.accessType===gb.enums.DealAccessTypes.APP_ONLY_LD)&&(q=!1);"function"===
typeof e._isDoubleCell&&(g=e._isDoubleCell(c.dealID));if(c.dealState===gb.enums.DealStates.LOADING)return{};b={widgetID:e.widgetID,widgetGroupID:e.widgetGroupID,deal:c,dealViewConfig:k,widgetViewConfig:l,position:d.position,viewIDs:f,elements:b,totalDeals:gb.metadata.selectedDealsCount[e.widgetID],orientation:e.viewOrientation,isDoubleCell:g,isPrimeEarly:c.detail.isPrimeEarlyAccessDeal,isPrimeOnly:c.detail.isPrimeOnly,showCouponCount:h,isWatchDeal:q,sponsoredDealAttr:t};b.showPercentOff=gb.utils.isShowPercentageOffEnabled();
b.priceText=gb.utils.getPriceTextForBasisKind(c.pricingData.bKind);c.detail.itemType===gb.enums.ItemTypes.VARIATION?(l=gb.controller.getDealDAO(d.dealID),b.asin=a,b.dimensionData=this._findDimensionData(l),b.modalFirstLoad=d.variationView?d.variationView.modalFirstLoad:!1,b.selectedDimension=d.variationView?d.variationView.selectedDimension:{},b.templateDecisionInfo=gb.utils.getVariationCustomerActionTemplateInfo(d,a),b.unavailableAsinSelected=d.variationView?d.variationView.unavailableAsinSelected:
!1,b.priceText=a?gb.utils.getPriceTextForBasisKind(a.bKind):gb.utils.getPriceTextForBasisKind(c.pricingData.bKind)):b.templateDecisionInfo=gb.utils.getCustomerActionTemplateInfo(c,e.widgetID);b.cellCount=gb.metadata.getSortedDealIDs(e.widgetID).length;b.customerRefTag=gb.service.customerID?gb.metrics.refTags.recLearnMore:gb.metrics.refTags.unrecLearnMore;return this._addMobileReffedDetailURL(this._addMetricsData(b))},getFilterViewTemplateData:function(d){var b=d.widgetView,a=gb.filterControllerFactory.getFilterController(b.widgetName).models[b.widgetGroupID];
return{actionNameTileSelected:gb.enums.WidgetActions.Faceout.TILE_SELECTED,attributes:d.attributes,attrPriority:a.filterAttrituesByPriority,eventID:b.widgetGroupID,filterType:d.type,filterOptions:d.filterOptions,filterConfig:d.filterConfig,maxTilesPerPage:gb.configManager.getWidgetViewConfig(b.widgetID).maxTilesPerPage,selectedValues:a.getSelectedBinningValues(d.filterConfig.attr)||[],tileWidth:b.tileWidthAsPercentage,title:d.title,totalPages:b.totalPages,view:d,viewIDs:gb.enums.WidgetViewIDs,widgetID:b.widgetID,
widgetName:b.widgetName}},getAdRowViewData:function(d){var b=gb.controller.schedulingParams[d.widgetID].adSlots;f.each(b,function(a){var c=a.remoteSlot;a.slotType===gb.enums.Constants.REMOTE_WIDGET&&c&&(c=gb.utils.generateListenerForEmbeddedWidget(c),q.when(c).execute(function(c){a.extractedWidgetSource=c.innerHTML}))});return{nextAdSlotToRenderIndex:d.nextAdSlotToRenderIndex,adSlots:b,widgetID:d.widgetID}},getMashRefineData:function(d){for(var b=this.getRefineTemplateData(d,!0).categoryData,a=[],
c=0;c<b.length;c++)a.push(b[c].text);return{title:gb.controller.schedulingParams[d.widgetID].title,buttonTitles:a,cancelButtonTitle:gb.resources.getString("csld-cancel"),successCallback:function(a){a<b.length&&gb.controller.trigger("WidgetCategoryChange",d.widgetID,b[a].nodeId)}}},getPaginationTemplateData:function(d){var b=gb.controller.widgetCurrentPage[d.widgetID]||1,a=gb.metadata.getAllDisplayableDealIDs(d.widgetID).length;return{widgetID:d.widgetID,widgetName:d.widgetName,filterOptions:[{attribute:gb.enums.BinningParams.PAGE.key,
currentPage:b,totalPages:Math.ceil(a/gb.controller.schedulingParams[d.widgetID].pageSize),dummyUrls:gb.enums.PaginationDummyURLs,minimalPagination:gb.configManager.getWidgetViewConfig(d.widgetID).minimalPagination}]}},_populateSponsoredDealAttributes:function(d,b){var a=gb.controller.schedulingParams[d].customRequestAttributes,c=gb.metadata.customResponseAttributes[d];d={};var e=gb.resources.getFeature("gb_sponsored_badge"),l=e===gb.enums.Weblabs.TREATMENTS.T2,k=e===gb.enums.Weblabs.TREATMENTS.T3;
d.showSponsoredBadge=e===gb.enums.Weblabs.TREATMENTS.T1||e===gb.enums.Weblabs.TREATMENTS.T2||e===gb.enums.Weblabs.TREATMENTS.T3;d.showSponsoredBadgeWithIncreasedDealViewHeight=l;d.showSponsoredBadgeWithoutBadgingSpace=k;if(f.isEmpty(a)||f.isEmpty(c))return d;a=a.SponsoredDealAttributes.widgetName;(c=c.dealsWithBids)&&c[b]&&(b=c[b],d.isSponsored=!0,d.id=b.logId,d.qualifier=b.qualifier,d.adId=b.adId,d.widgetName=a);return d},_setDealViewTimerData:function(d,b,a){var c=d.deal,e=d.widgetView,l=a?a.status.dates.incartEnds:
c.status.dates.incartEnds,k=gb.utils.getDealViewID(e.widgetID,d.position),f=k+gb.enums.dealViewIDs.DEALCLOCK,g=l?!0:!1,r=a?a.status.dates.pendingATCEnds:c.status.dates.pendingATCEnds;a=gb.resources.customerData.hasEarlyAccessBenefit;var n=gb.configManager.getWidgetViewConfig(e.widgetID).forceApplyIncartTimer,q=gb.configManager.getWidgetViewConfig(e.widgetID).avoidContextBasedTimer;if(g||r)g?(d.incartClock&&(h.clearTimeout(d.incartClock.timeout),d.incartClock=null),f=k+gb.enums.dealViewIDs.INCARTCLOCK,
d.incartClock=gb.utils.heroTimer(l,d.viewElement,f,!0),b.incartTimeString=d.incartClock.timeString):r&&(d.pendingAtcClock&&(h.clearTimeout(d.pendingAtcClock.timeout),d.pendingAtcClock=null),f=k+gb.enums.dealViewIDs.PENDINGATCCLOCK,d.pendingAtcClock=gb.utils.heroTimer(r,d.viewElement,f,!0),b.pendingatcTimeString=d.pendingAtcClock.timeString),e.widgetName!==gb.enums.WidgetNames.PC_SUPPLE||gb.controller.schedulingParams[e.widgetID].showShortCellView||this._genericEndDateTimerGenerator(d,b);else{k=(new Date).getTime();
b.timerTextColor="base";if(c.dealState===gb.enums.DealStates.AVAILABLE||c.dealState===gb.enums.DealStates.WAITLIST||c.dealState===gb.enums.DealStates.WAITLISTFULL)gb.utils.isDealInEarlyAccessWindow(c)?c.detail.accessType!==gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS||a?c.detail.accessType===gb.enums.DealAccessTypes.APP_EARLY_ACCESS?(d.clock=gb.utils.heroTimer(c.status.dates.startForNonPrimeCustomer,d.viewElement,f,n),b.timeString=d.clock.timeString,b.timerPrefix=gb.resources.getString("gb_starts_in"),
b.isEarlyAccessTimer=!q,b.timerTextColor="success"):this._genericEndDateTimerGenerator(d,b):(d.clock=gb.utils.heroTimer(c.status.dates.startForNonPrimeCustomer,d.viewElement,f,n),b.timeString=d.clock.timeString,b.timerPrefix=q?gb.resources.getString("gb_starts_in"):gb.resources.getString("gb_starts_for_you_in"),b.isEarlyAccessTimer=!q,b.timerTextColor="success"):this._genericEndDateTimerGenerator(d,b);else if(c.dealState===gb.enums.DealStates.UPCOMING)if(l=e=c.status.dates.start,c.detail.accessType===
gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS?(b.isEarlyAccessTimer=!q,a||(e=new Date(e.getTime()+c.detail.accessDurationInMs))):c.detail.accessType===gb.enums.DealAccessTypes.APP_EARLY_ACCESS&&(b.isEarlyAccessTimer=!q,e=new Date(e.getTime()+c.detail.accessDurationInMs)),k=e.getTime()-k,864E5<k)b.showDateOrTime=gb.utils.formatDate(e),b.timerPrefix=gb.resources.getString("gb_starts");else if(36E5<k){if(b.showDateOrTime=gb.utils.formatTime(e.getHours(),e.getMinutes()),b.timerPrefix=gb.resources.getString("gb_starts_at"),
b.isEarlyAccessTimer&&!q&&(b.timerPrefix=a?gb.resources.getString("gb_starts_for_prime_at"):gb.resources.getString("gb_starts_for_you_at")),c.detail.accessType!==gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS||a||(b.primeTimeString=gb.utils.formatTime(l.getHours(),l.getMinutes()),b.primeTimerPrefix=gb.resources.getString("gb_starts_for_prime_at")),c.detail.isPrimeOnly&&!q&&(b.timerPrefix=gb.resources.getString("gb_starts_for_prime_at")),c.detail.accessType===gb.enums.DealAccessTypes.APP_EARLY_ACCESS||
c.detail.accessType===gb.enums.DealAccessTypes.APP_ONLY_LD)b.timerPrefix=gb.resources.getString("gb_starts_at")}else if(d.clock=gb.utils.heroTimer(e,d.viewElement,f,n),b.timeString=d.clock.timeString,b.timerTextColor="success",b.timerPrefix=gb.resources.getString("gb_starts_in"),b.isEarlyAccessTimer&&!q&&(b.timerPrefix=a?gb.resources.getString("gb_starts_for_prime_in"):gb.resources.getString("gb_starts_for_you_in")),c.detail.isPrimeOnly&&!q&&(b.timerPrefix=gb.resources.getString("gb_starts_for_prime_in")),
c.detail.accessType!==gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS||a||(b.primeTimeString=gb.utils.formatTime(l.getHours(),l.getMinutes()),b.primeTimerPrefix=gb.resources.getString("gb_starts_for_prime_at")),c.detail.accessType===gb.enums.DealAccessTypes.APP_ONLY_LD||c.detail.accessType===gb.enums.DealAccessTypes.APP_EARLY_ACCESS)b.timerPrefix=gb.resources.getString("gb_starts_in");d=gb.resources.getCustomerData("realm")!==gb.enums.Realms.IN&&(b.isEarlyAccessTimer&&a||c.detail.isPrimeOnly&&c.dealState===
gb.enums.DealStates.UPCOMING);b.addLineBreak=d}},_setMiniDetailPageViewTimerData:function(d,b,a){d.modalClock&&(h.clearTimeout(d.modalClock.timeout),d.modalClock=null);var c=d.deal,e=d.widgetView,l=c.status.dates.incartEnds,k=gb.utils.getDealViewID(e.widgetID,d.position),f=k+gb.enums.dealViewIDs.DEALCLOCK,g=gb.enums.WidgetViewIDs.MINI_DP_MODAL+f,r=c.status.dates.pendingATCEnds,n=gb.resources.customerData.hasEarlyAccessBenefit,q=c.dealType===gb.enums.DealTypes.LD&&c.detail.itemType!==gb.enums.ItemTypes.SINGLE,
e=gb.configManager.getWidgetViewConfig(e.widgetID).forceApplyIncartTimer,t=gb.enums.WidgetViewIDs.A_POPOVER+a;!l&&!r||q?(l=(new Date).getTime(),c.dealState===gb.enums.DealStates.AVAILABLE||c.dealState===gb.enums.DealStates.WAITLIST||c.dealState===gb.enums.DealStates.WAITLISTFULL?(gb.utils.isDealInEarlyAccessWindow(c)&&!n&&this._setMiniDPPrimeTimerData(d,b,t),this._genericEndDateTimerGenerator(d,b,a)):c.dealState===gb.enums.DealStates.UPCOMING&&(f=c.status.dates.start,c.detail.accessType?this._setMiniDPPrimeTimerData(d,
b,t):(c=f.getTime()-l,864E5<c?(b.showDateOrTime=gb.utils.formatDate(f),b.timerPrefix=gb.resources.getString("gb_deal_starts")):36E5<c?(b.showDateOrTime=gb.utils.formatTime(f.getHours(),f.getMinutes()),b.timerPrefix=gb.resources.getString("gb_deal_starts_at")):(d.modalClock=gb.utils.heroTimer(f,t,g,e),b.timeString=d.modalClock.timeString,b.timerPrefix=gb.resources.getString("gb_deal_starts_in"))))):(l?(d.modalIncartClock&&(h.clearTimeout(d.modalIncartClock.timeout),d.modalIncartClock=null),g=gb.enums.WidgetViewIDs.MINI_DP_MODAL+
k+gb.enums.dealViewIDs.INCARTCLOCK,d.modalIncartClock=gb.utils.heroTimer(l,t,g,!0),b.modalIncartTimeString=d.modalIncartClock.timeString):r&&(d.modalPendingAtcClock&&(h.clearTimeout(d.modalPendingAtcClock.timeout),d.modalPendingAtcClock=null),g=gb.enums.WidgetViewIDs.MINI_DP_MODAL+k+gb.enums.dealViewIDs.PENDINGATCCLOCK,d.modalPendingAtcClock=gb.utils.heroTimer(r,t,g,!0),b.modalPendingatcTimeString=d.modalPendingAtcClock.timeString),a=c.status.dates.end,l=(new Date).getTime(),n=a.getTime()-l,g=gb.enums.WidgetViewIDs.MINI_DP_MODAL+
f,864E5<n?(b.showDateOrTime=gb.utils.formatDate(a),b.timerPrefix=gb.resources.getString("gb_ends")):c.dealType===gb.enums.DealTypes.BD&&36E5<n?(b.showDateOrTime=gb.utils.formatTime(a.getHours(),a.getMinutes()),b.timerPrefix=gb.resources.getString("gb_ends_at")):(d.modalClock=gb.utils.heroTimer(a,t,g,e),b.timeString=d.modalClock.timeString,b.timerPrefix=gb.resources.getString("gb_ends_in")))},_setMiniDPPrimeTimerData:function(d,b,a){d.modalPrimeClock&&(h.clearTimeout(d.modalPrimeClock.timeout),d.modalPrimeClock=
null);var c=d.deal,e=d.widgetView,l=gb.resources.customerData.hasEarlyAccessBenefit,k=gb.enums.WidgetViewIDs.MINI_DP_MODAL+gb.enums.WidgetViewIDs.PRIME+gb.utils.getDealViewID(e.widgetID,d.position)+gb.enums.dealViewIDs.DEALCLOCK;gb.utils.getDealViewID(e.widgetID,d.position);e=(new Date).getTime();if(c.dealState===gb.enums.DealStates.UPCOMING){var f=c.status.dates.start;l||(f=new Date(f.getTime()+c.detail.accessDurationInMs));36E5<f.getTime()-e?(b.modalPrimeTimerPrefix=l?gb.resources.getString("gb_deal_starts_for_prime_at"):
gb.resources.getString("gb_deal_starts_for_you_at"),c.detail.isPrimeOnly&&(b.modalPrimeTimerPrefix=gb.resources.getString("gb_deal_starts_at")),b.modalPrimeShowDateOrTime=gb.utils.formatTime(f.getHours(),f.getMinutes())):(d.modalPrimeClock=gb.utils.heroTimer(f,a,k,!0),b.modalPrimeTimeString=d.modalPrimeClock.timeString,b.modalPrimeTimerPrefix=l?gb.resources.getString("gb_deal_starts_for_prime_in"):gb.resources.getString("gb_deal_starts_for_you_in"),c.detail.isPrimeOnly&&(b.modalPrimeTimerPrefix=gb.resources.getString("gb_deal_starts_in")))}else d.modalPrimeClock=
gb.utils.heroTimer(c.status.dates.startForNonPrimeCustomer,a,k,!0),b.modalPrimeTimeString=d.modalPrimeClock.timeString,b.modalPrimeTimerPrefix=gb.resources.getString("gb_deal_starts_for_you_in")},_setMiniDPAsinViewTimerData:function(d,b,a,c){d.modalClock&&(h.clearTimeout(d.modalClock.timeout),d.modalClock=null);var e=d.deal;if(b){var l=b.status,k=d.widgetView,f=b.status.dates.incartEnds,g=gb.utils.getDealViewID(k.widgetID,d.position);b=b.status.dates.pendingATCEnds;var r=gb.resources.customerData.hasEarlyAccessBenefit;
gb.configManager.getWidgetViewConfig(k.widgetID);k=gb.enums.WidgetViewIDs.A_POPOVER+c;if(f||b)f?(d.modalIncartClock&&(h.clearTimeout(d.modalIncartClock.timeout),d.modalIncartClock=null),e=gb.enums.WidgetViewIDs.MINI_DP_MODAL+g+gb.enums.dealViewIDs.INCARTCLOCK,d.modalIncartClock=gb.utils.heroTimer(f,k,e,!0),a.modalIncartTimeString=d.modalIncartClock.timeString):b&&(d.modalPendingAtcClock&&(h.clearTimeout(d.modalPendingAtcClock.timeout),d.modalPendingAtcClock=null),e=gb.enums.WidgetViewIDs.MINI_DP_MODAL+
g+gb.enums.dealViewIDs.PENDINGATCCLOCK,d.modalPendingAtcClock=gb.utils.heroTimer(b,k,e,!0),a.modalPendingatcTimeString=d.modalPendingAtcClock.timeString),this._genericEndDateTimerGenerator(d,a,c);else if((new Date).getTime(),l.itemState===gb.enums.DealStates.AVAILABLE||l.itemState===gb.enums.DealStates.WAITLIST||l.itemState===gb.enums.DealStates.WAITLISTFULL)gb.utils.isDealInEarlyAccessWindow(e)&&!r&&this._setMiniDPPrimeTimerData(d,a,k),this._genericEndDateTimerGenerator(d,a,c)}else this._setMiniDetailPageViewTimerData(d,
a,c)},_genericEndDateTimerGenerator:function(d,b,a){var c=(new Date).getTime(),e=d.widgetView,l=d.deal.status.dates.end,c=l.getTime()-c,f=gb.utils.getDealViewID(e.widgetID,d.position)+gb.enums.dealViewIDs.DEALCLOCK,e=gb.configManager.getWidgetViewConfig(e.widgetID).forceApplyIncartTimer;b.timerTextColor="base";c>=2*gb.enums.Constants.DAY_IN_MILLIS||c>1*gb.enums.Constants.DAY_IN_MILLIS&&d.deal.dealType===gb.enums.DealTypes.BD?(b.showDateOrTime=gb.utils.formatDate(l),b.timerPrefix=gb.resources.getString("gb_ends")):
d.deal.dealType===gb.enums.DealTypes.BD&&36E5<c?(b.showDateOrTime=gb.utils.formatTime(l.getHours(),l.getMinutes()),b.timerPrefix=gb.resources.getString("gb_ends_at")):(a?(e=gb.enums.WidgetViewIDs.MINI_DP_MODAL+f,a=gb.enums.WidgetViewIDs.A_POPOVER+a,d.modalClock&&(h.clearTimeout(d.modalClock.timeout),d.modalClock=null),d.modalClock=gb.utils.heroTimer(l,a,e,!0),b.timeString=d.modalClock.timeString):(d.clock&&(h.clearTimeout(d.clock.timeout),d.clock=null),d.clock=gb.utils.heroTimer(l,d.viewElement,f,
e),b.timeString=d.clock.timeString),b.timerPrefix=gb.resources.getString("gb_ends_in"),36E5>=c&&(b.timerTextColor="success"))},_addRedirectDetails:function(d,b,a){d=d||gb.resources.getString("gb_see_all_deals");var c=b===gb.enums.MiscLinks.LOCAL_URL?gb.metrics.refTags.seeAllLocalDeals:gb.metrics.refTags.seeAllDeals;a&&(b=a.getReffedURL(b,c),a.seeAllText=d,a.redirectLink=b);return a},getLaunchCellTemplateData:function(d){var b=gb.controller.schedulingParams[d.widgetID];d={widgetView:d,widgetID:d.widgetID,
schedulingParams:b};d=this._addMetricsData(d);return d=this._addRedirectDetails(b.redirectText,b.redirectLink,d)},getShovelerLaunchCellTemplateData:function(d){var b=gb.controller.schedulingParams[d.widgetID],a=b.widgetTabConfig[b.widgetCurrentTab];d={widgetView:d,widgetID:d.widgetID,schedulingParams:b,cssClasses:"gridColumn"+d.dealsPerRow};d=this._addMetricsData(d);return d=this._addRedirectDetails(a.redirectText,a.redirectLink,d)},getSuppleWidgetViewTemplateData:function(d,b){var a=gb.controller.schedulingParams[d.widgetID],
c=gb.enums.WidgetViewIDs,e=gb.configManager.getDealViewConfig(d.widgetID),l=d.dealsPerRow,f=gb.watcher.lowestDealIDWatchedIndex[d.widgetID]+1,p=f;if(a.enforceLimitedDeals&&a.showDoubleCellDOTD)var g=gb.metadata.getAllDisplayableDealIDs(d.widgetID),g=gb.metadata.getDOTDCount(g),p=p+g;a.enforceLimitedDeals&&a.showLaunchCell&&gb.widgetHelper&&gb.widgetHelper.shouldReduceDeals[d.widgetID]&&0===p%d.dealsPerRow&&f--;p=Math.ceil(f/a.pageSize);if(a.enforceLimitedDeals||a.enablePagination)p=1;b=b?1:gb.controller.widgetCurrentPage[d.widgetID];
g=gb.enums.Constants.MAX_SUPPLE_DEALS_TO_DISPLAY;a.pageSize&&(g=a.pageSize);var h=gb.utils.getFilterViewIDs(a.filterConfig),n=d.isLeftFilterRequired,q="",t="";a.disableRestrictionsApply||(q=gb.resources.getString("gb-restrictions-apply"),t=a.customRestrictionsApply||gb.resources.getString("csld-restrictions_link"));var w=a.redirectText||gb.resources.getString("gb_see_all_deals"),e={widgetView:d,schedulingParams:a,widgetID:d.widgetID,widgetGroupID:d.widgetGroupID,viewIDs:c,filterViewIDs:h,totalDeals:gb.metadata.selectedDealsCount[d.widgetID],
totalDealsToShowCount:gb.controller.totalDealsToShow[d.widgetID],orientation:d.viewOrientation,dealViewCount:d.nextPositionToRender,dealViewConfig:e,firstPage:b,columnCount:l,dealCount:f,pagesToDraw:p,pageSize:g,seeAllText:w,restrictionsApplyText:q,restrictionsApplyLink:t,title:a.title,isLeftFilterRequired:n},c=this._getNoDealsMessage(d);e.noDealsMessage=c.message;e.isFiltersSelected=c.isFiltersSelected;e.isGDMFailing=d.isGDMFailing;e.isRetryInProgress=d.isRetryInProgress;e=this._addMetricsData(e);
a.titleRedirectLink&&(e=this._addRedirectDetails(a.titleRedirectText,a.titleRedirectLink,e));return e},getShovelerWidgetViewTemplateData:function(d){var b=gb.controller.schedulingParams[d.widgetID],a=gb.enums.WidgetViewIDs,c,e,l=gb.metadata.selectedDealsCount[d.widgetID],f=d.dealsPerRow||b.pageSize;b.pageSize=f;!b.enableFilter||b.widgetTabConfig[b.widgetCurrentTab].watchedDealsTab?c=!0:(e=gb.utils.getFilterViewIDs(b.filterConfig)[gb.enums.BinNames.CATEGORIES],c=!1);var p,g=b.widgetTabConfig[b.widgetCurrentTab];
p=g&&g.launchCellIndex?Math.ceil((l+1)/f):Math.ceil(l/f);var h=gb.controller.widgetCurrentPage[d.widgetID];p&&h>p&&(h=p);gb.controller.widgetCurrentPage[d.widgetID]=h;var n=0;l&&(n=Math.min(f,l-(h-1)*f));var q=f="";b.disableRestrictionsApply||(f=gb.resources.getString("gb-restrictions-apply"),q=b.customRestrictionsApply||gb.resources.getString("csld-restrictions_link"));a={actionName:gb.enums.WidgetActions.Shoveler.SHOVEL,currentPage:h,disableFilter:c,filterDomID:e,lastDealIDPosition:n,restrictionsApplyText:f,
restrictionsApplyLink:q,schedulingParams:b,title:b.title,totalDeals:l,totalPages:p,viewIDs:a,widgetID:d.widgetID,widgetGroupID:d.widgetGroupID};b=this._getNoDealsMessage(d);a.noDealsMessage=b.message;a.isGDMFailing=d.isGDMFailing;a.isRetryInProgress=d.isRetryInProgress;a.gridColumnCSS="gridColumn"+d.dealsPerRow;a=this._addMetricsData(a);g&&g.titleRedirectText&&(a=this._addRedirectDetails(g.titleRedirectText,g.titleRedirectLink,a));return a},_findDimensionData:function(d){var b={};f.each(d.items,function(a){f.each(a.variationDimensions,
function(a,d){b[d]||(b[d]=[]);b[d].push(a);b[d]=f.unique(b[d])})});return b},getCartErrorDisplayData:function(){var d=gb.resources.getString("gb-cart-error-header"),b=gb.resources.getString("gb-cart-error");return{errorAlertHeaderText:d,errorText:b}},getBottomSheetFilterContentExpanderData:function(d,b){return{view:d,filterOptions:d.filterJSONData,isSortFilter:b.isSortFilter,schedulingParams:gb.controller.schedulingParams[d.widgetID]}},getBottomSheetFilterContentData:function(d){return{view:d,filterOptionList:d.filterOptions,
currentSelection:d.widgetView.filterJSONData[d.filterConfig.attr].currentSelection,attribute:d.filterConfig.attr}},getBottomSheetFilterHeaderData:function(d,b){return{title:b.title,widgetView:d.widgetView?d.widgetView:d,selectedOption:d.filterConfig?d.widgetView.filterJSONData[d.filterConfig.attr].currentSelection:"",showClearOption:b.showClearOption,enableBack:b.enableBack}},getBottomSheetFilterFooterData:function(){return{text:gb.resources.getString("csld-cancel")}},_getNoDealsMessage:function(d){var b,
a,c=gb.controller.schedulingParams[d.widgetID],e=gb.filterControllerFactory.getFilterController(d.widgetName).models[d.widgetGroupID];if(c.watchedDealsWidget||gb.utils.isWatchedDealsTab(d.widgetID))gb.metadata.watchedDeals.ALL&&0!==gb.metadata.watchedDeals.ALL.length||(gb.clientName===gb.enums.MobileClients.PC?b=gb.resources.getString("gb_no_watched_deals_punting_message",{watchDeal:"\x3cb\x3e"+gb.resources.getString("gb_watch_deal")+"\x3c/b\x3e"}):gb.configManager.getWidgetViewConfig(d.widgetID).showNoWatchedDealsMessg&&
(b=gb.resources.getString("gb_no_watched_deals_to_show",{watchDeal:"\x3cb\x3e"+gb.resources.getString("gb_watch_deal")+".\x3c/b\x3e"})));else if(f.isEmpty(gb.metadata.getAllDisplayableDealIDs(d.widgetID))){var l=0;if(d.widgetGroupID){var k=e.attributesList,l=e.getSelectedFilterCount();-1!==k.indexOf(gb.enums.BinningParams.SORT_ORDER.key)&&l--; -1!==k.indexOf(gb.enums.BinningParams.PAGE.key)&&l--}l?(b=c.noDealsFilterMessage||gb.resources.getString("gb_no_active_deals_on_filters"),a=!0):gb.widgetHelper&&
"undefined"!==typeof gb.widgetHelper.callID[d.widgetID]&&gb.widgetHelper.callID[d.widgetID]!==gb.widgetHelper.callDataArray[d.widgetID].length||(b=c.noDealsMessage||gb.resources.getString("gb_no_results_to_show"))}return{message:b,isFiltersSelected:a}},_getCurrentCategory:function(d){var b=gb.enums.CategoryFilters.ALL;if(gb.controller.isPaginatedMetadataCall(d)){var a=gb.widgets[d].widgetGroupID;if(!a)return;d=gb.filterControllerFactory.getFilterController(gb.widgets[d].widgetName).models[a].getSelectedFilters(!1,
[gb.enums.DCSQueryParams.CATEGORIES,gb.enums.DCSQueryParams.PRIME_ACCESS_TYPE]);d.enforcedCategories?b=d.enforcedCategories[0]:d.primeAccessType&&(b=gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS)}else b=gb.controller.widgetCurrentCategory[d];return b},_getCurrentStates:function(d){var b=gb.enums.DealStates.AVAILABLE;if(gb.controller.isPaginatedMetadataCall(d)){var a=gb.widgets[d].widgetGroupID;if(!a)return;d=gb.filterControllerFactory.getFilterController(gb.widgets[d].widgetName).models[a].getSelectedFilters(!1,
[gb.enums.DCSQueryParams.DEAL_STATE]);d.dealStates&&(b=d.dealStates);"object"===typeof b&&(b=gb.enums.DealStatesToFilterStates[b[0]])}else b=gb.controller.widgetCurrentStatus[d];b&&(b=b.toLowerCase());return b}})});q.declare("gb-share-manager");q.when("A","GoldboxMobile3PAssets","gb-variation-view").register("gb-deal-view",function(g,n,f){return g.createClass({init:function(d){this.widgetView=d.widgetView;this.position=d.position;this.viewElementID="#"+gb.utils.getDealViewID(this.widgetView.widgetID,
this.position);this.viewElement=this.widgetView.skinDomElement.find(this.viewElementID);this.viewOrientation=this.widgetView.viewOrientation;this.dealID=d.dealID;this.isDoubleCell=d.isDoubleCell;this.row=d.row;this.column=d.column;this.deal=gb.controller.getDealDAO(this.dealID);this.modalClock=this.clock=this.truncatedShipSoldInfo=this.truncatedTitle=this.viewSkin=null},render:function(){if(!gb.controller.buyingDeals[this.dealID]){var d=this.widgetView.widgetID,b=gb.configManager.getWidgetViewConfig(d),
a=b.useCssEllipsification;if(this.viewOrientation!==this.widgetView.viewOrientation){this.truncatedTitle=null;var c=this.deal.detail;c.truncatedDescription=null;c.restDescription=null}this.viewOrientation=this.widgetView.viewOrientation;this.clock&&h.clearTimeout(this.clock.timeout);this.modalClock&&h.clearTimeout(this.modalClock.timeout);this.deal.detail.itemType===gb.enums.ItemTypes.VARIATION&&gb.widgets[d].widgetName===gb.enums.WidgetNames.ML_HERO?(this.variationView=this.variationView||new f({dealID:this.deal.dealID,
widgetView:this.widgetView,isMiniDP:!1,position:this.position,dealView:this}),this.variationView.render()):(this.viewSkin=this._generateStateHTMLFromViewSubTemplates(),this.viewElement.html(this.viewSkin));this.renderTitle(a);this.renderDescription();this._renderShipSold();this._handleDealActions(b);this.updateOptionsHTML();!gb.resources.deviceInfo.isCSS3Supported&&gb.configManager.getWidgetViewConfig(d).applyDealRowHeight&&(b=0===this.position%2?this.position+1:this.position-1,gb.utils.setDealViewHeightToOriginal(d,
this.position),gb.utils.setDealViewHeightToOriginal(d,b),a=this.viewElement.closest("."+gb.enums.WidgetViewIDs.CONTENTROW),a.height(""),a.height(a.height()),gb.utils.setDealViewHeightToDealRowHeight(d,this.position),gb.utils.setDealViewHeightToDealRowHeight(d,b));this.renderEldaradoUtil();gb.metricsManager.recordRender(d,this.dealID,this.position)}},_generateStateHTMLFromViewSubTemplates:function(d){var b=this.widgetView.widgetID,a=gb.utils.getStateTemplateName(this.deal.dealState,this.deal.dealType),
c=gb.utils.getViewTemplatesForState(this.deal),e=gb.configManager.getWidgetViewConfig(b);d=d||{};var l=d.stateTemplateGroup||gb.templateManager.TemplateGroups.DEAL_STATE,f=d.viewTemplateGroup||gb.templateManager.TemplateGroups.DEAL_VIEW,p=d.viewTemplateData||gb.viewComponentBuilder.getDealViewTemplateData(this);p.viewStyleInfo=gb.utils.getDealViewStyleInformation(this.deal,p,e);var g=this;d=d.stateTemplateDataBuilderFn||function(a){return gb.viewComponentBuilder.getDealStateTemplateData(g,a)};c=gb.templateManager.getWidgetHTML({widgetID:b,
templateGroup:f,templateNames:c,data:p});c=d(c);c.viewStyleInfo=gb.utils.getDealViewStyleInformation(this.deal,p,e);b=gb.templateManager.getWidgetHTML({widgetID:b,templateGroup:l,templateName:a,data:c});return b=gb.accessibility.generateDealViewAccessibilityFlow(this,b)},enableOptions:function(d){d=g.$(d);var b={header:d.find("#"+gb.enums.dealViewIDs.OPT_HEADER),contents:d.find("#"+gb.enums.dealViewIDs.OPT_CONTENT),footer:d.find("#"+gb.enums.dealViewIDs.OPT_FOOTER)};this.viewElement.find(".dealAction").click(function(a){gb.controller.getBottomSheet().render(b);
a.stopPropagation();a.preventDefault()})},_handleDealActions:n._.once(function(d){g.declarative("gbdeal-addtocart","click",function(b){b=b.data;var a=b.asin;gb.metricsManager.recordAction(b.widgetID,b.dealID,"ADD_TO_CART",b.position);gb.controller.dealDAOs[b.dealID].checkingDealStatus=!0;gb.controller.refreshDealView(b.dealID,a);gb.controller.processActionableClick({widgetID:b.widgetID,dealID:b.dealID,dealType:b.dealType,dealState:b.dealState,asin:a,offerID:b.offerID,legacyDealID:b.legacyDealID,quantity:1});
b.isSponsored&&gb.service.logPicassoClick(b)});g.declarative("gbdeal-watchdeal",d.enableClickOnlyWatch?"click":"click touchstart",function(b){var a=b.data.dealID,c=b.data.widgetID,d=gb.controller.dealDAOs[a],l=gb.controller.watchDealView;!l||d.isDealWatched||gb.resources.customerData.isWatchDealPopupMarked||(l.changeWatchPopupState(gb.enums.WatchDealPopoverActions.HIDE_WATCH_POPUP),gb.watchDealService.modifyPopupStatus({action:gb.enums.SembuActions.SET_COOKIE,type:gb.enums.DataTypes.BOOL,value:1,
key:l.key,domain:l.domain}),gb.resources.customerData.isWatchDealPopupMarked=!0);gb.metricsManager.recordAction(c,a,"WATCH_DEAL",b.data.position);gb.controller.watchDeal(c,a)});gb.clientName===gb.enums.MobileClients.PC&&g.declarative("gbdeal-watchdeal","mouseenter mouseleave",function(b){var a=b.data.dealID,c=b.data.widgetID,d=gb.controller.dealDAOs[a];if(gb.controller.watchDealView&&d.isDealWatched&&!d.processWatchAction){var l=b.$target.closest("#"+gb.enums.WatchDealViewIDs.WATCH_BUTTON+a);gb.controller.watchDealView.triggerMouseEventsOnWatchingDeal(a,
l,b.type);q.when("A","a-modal").execute(function(d,e){(d=e.get(gb.enums.WidgetViewIDs.MINI_DP_MODAL+a))&&d.isActive()&&(d.$popover.find("."+gb.enums.WatchDealViewIDs.MINI_DP_WATCH_BUTTON_MAPPING[gb.widgets[c].widgetName]),gb.controller.watchDealView.triggerMouseEventsOnWatchingDeal(a,l,b.type))})}});g.declarative("gbdeal-joinwaitlist","click",function(b){b=b.data;var a=b.asin;gb.metricsManager.recordAction(b.widgetID,b.dealID,"JOIN_WAITLIST",b.position);gb.controller.dealDAOs[b.dealID].checkingDealStatus=
!0;gb.controller.refreshDealView(b.dealID,a);gb.controller.processActionableClick({widgetID:b.widgetID,dealID:b.dealID,dealType:b.dealType,dealState:b.dealState,asin:a,offerID:b.offerID,legacyDealID:b.legacyDealID,action:gb.metrics.refTags.joinWaitlist})});g.declarative("gbdeal-checkout","click",function(b){h.location.href="/gp/cart/view.html"});g.declarative("gbdeal-add-to-wishlist","click",function(b){b=b.data;gb.controller.dealDAOs[b.dealID].addingToWishList=!0;gb.controller.refreshDealView(b.dealID);
gb.controller.addItemToWishList({dealID:b.dealID,asin:b.asin})});g.declarative("gbdeal-view-wishlist","click",function(b){h.location.href="/gp/registry/wishlist/"+b.data.defaultRegistryID});g.declarative("gbdeal-seeoptions","click",function(b){var a=gb.widgets[b.data.widgetID].dealViews[b.data.dealID][b.data.position];gb.metricsManager.recordAction(b.data.widgetID,b.data.dealID,"SEE_MORE",b.data.position);a.renderMiniDetailPage(b.data.asin);b=gb.metrics.generateRef(b.data.widgetID,gb.metrics.refTags.miniDpPopOver,
[b.data.dealID]);gb.metrics.recordRefViaAjax(b)});g.declarative("gb-image","click tap",function(b){var a=gb.widgets[b.data.widgetID].dealViews[b.data.dealID][b.data.position],c=gb.utils.shouldShowMiniDetailPageModal(a);gb.metricsManager.recordAction(b.data.widgetID,b.data.dealID,"IMAGE",b.data.position);c?(a.renderMiniDetailPage(),b=gb.metrics.generateRef(b.data.widgetID,gb.metrics.refTags.miniDpPopOver,[b.data.dealID]),gb.metrics.recordRefViaAjax(b)):h.location.href=b.data.redirectionUrl});g.declarative("gbdeal-actionrecord",
"click",function(b){var a=b.data.customURL;gb.metricsManager.recordAction(b.data.widgetID,b.data.dealID,b.data.actionType,b.data.position);a&&(h.location.href=a)});g.declarative("gbdeal-mashshare","click",function(b){var a=b.data.widgetID,c=b.data.dealID;a&&c&&gb.controller.getDealDAO(c)&&(gb.metricsManager.recordAction(a,c,"SHARE_DEAL",b.data.position),gb.controller.closeBottomSheet(),gb.controller.getShareManager().shareDeal(a,c))})}),renderTitle:function(d){var b=this.widgetView.widgetID;if(!d&&
!gb.configManager.getWidgetViewConfig(b).disableJsEllipsification&&(d=this.viewElement.find("#"+gb.enums.dealViewIDs.TITLE),d.length))for(var a=0;a<d.length;a++){var c=g.$(d[a]);this._truncateText(c,"truncatedTitle");gb.configManager.getWidgetViewConfig(b).enableAutoTitleAdjustment&&c.addClass("autoHeight")}},renderDescription:function(){var d=this.viewElement.find("#"+gb.enums.dealViewIDs.DESC_ABBR);if(d.length){var d=g.$(d[0]),b=this.deal.detail;if(!b.truncatedDescription){var a=d.html().trim();
if(a){var c=!0;if(gb.resources.customerData.realm===gb.enums.Realms.CN||gb.resources.customerData.realm===gb.enums.Realms.JP)c=!1;gb.utils.ellipsify({jQuery:g.$,el:d,removeDots:!0,wordsIntact:c});b.truncatedDescription=d.html().trim();b.restDescription=a.substr(b.truncatedDescription.length);b.restDescription&&(d=this.viewElement.find("#"+gb.enums.dealViewIDs.DESC_REST),g.$(d[0]).html(b.restDescription))}}b.restDescription&&(b=this.viewElement.find("."+gb.enums.dealViewClasses.DESC_EXPANDER),0<b.length&&
b.removeClass("aok-hidden"))}},_renderShipSold:function(){var d=this.viewElement.find("#"+gb.enums.dealViewIDs.SHIP_SOLD);0<d.length&&this._truncateText(d,"truncatedShipSoldInfo");gb.configManager.getWidgetViewConfig(this.widgetView.widgetID).enableAutoTitleAdjustment&&d.addClass("autoHeight")},_truncateText:function(d,b){this[b]?d.html(this[b]):(gb.utils.ellipsify({jQuery:g.$,el:d}),this[b]=d.html())},signalMarker:function(d,b){if(gb.csm&&d&&gb.csm.recordedMarkers&&!gb.csm.recordedMarkers[d]){b=
b&&b.recordMarkerFeature?!0:!1;var a=function(){gb.csm.signalMarker(d)},c=this.viewElement.find("img");c.length&&c[0]&&c[0].complete?a():c.load(a).error(a);b&&(gb.csm.recordedMarkers[d]=!0,q.register(d))}},renderMiniDetailPage:function(d){var b=this,a=b.deal,c=a.dealID,e=gb.enums.WidgetViewIDs.MINI_DP_MODAL+c,l=gb.resources.getImage("spinner");q.when("A","a-modal","ready").execute(function(k,g){k={name:e,header:gb.resources.getString("gb_deal_details"),width:"655",inlineContent:"\x3cimg src\x3d"+
l+"\x3e"};var h=b.viewElement.find("#"+gb.enums.dealViewIDs.IMAGE),n=g.get(gb.enums.WidgetViewIDs.MINI_DP_MODAL+c);n||(n=g.create(h,k),n.show());a.detail.itemType===gb.enums.ItemTypes.VARIATION?(b.variationView=b.variationView||new f({dealID:c,widgetView:b.widgetView,asinID:d,isMiniDP:!0,modalInstance:n,position:b.position,dealView:b}),b.variationView.render()):(b.viewSkin=b._generateStateHTMLFromViewSubTemplates({viewTemplateGroup:gb.templateManager.TemplateGroups.MINI_DP_DEAL_VIEW,stateTemplateGroup:gb.templateManager.TemplateGroups.MINI_DP_DEAL_STATE,
viewTemplateData:gb.viewComponentBuilder.getMiniDPViewTemplateData(b,n,d)}),n.updateContent(b.viewSkin).lock().show(),gb.controller.popOverVisible=!0)});var k="a:popover:beforeHide:"+e;q.when("A").execute(function(a){a.on(k,function(){q.when("GBEventManager").execute(function(a){a.trigger("popoverClosed");gb.controller.popOverVisible=!1})})})},renderEldaradoUtil:function(){var d=gb.utils.getDealsInternalUrl(this.dealID);if(d){var b=document.createElement("a");b.href=d;b.setAttribute("value","View Deals Internal Website");
b.style.backgroundImage="url('http://g-ec2.images-amazon.com/images/G/01/goldbox/gb_icon_tiny._V192570393_.gif')";b.style.width="30px";b.style.height="26px";b.style.border="none";b.style.display="block";b.style.position="absolute";b.style.top=0;b.style.zIndex=100;this.viewElement.css("position","relative");this.viewElement.append(b)}},updateOptionsHTML:function(){var d=this.widgetView.widgetID,b=gb.configManager.getWidgetViewConfig(d);gb.resources.deviceInfo.isPhone&&b.supportWatch&&(d=gb.templateManager.getWidgetHTML({widgetID:d,
templateGroup:gb.templateManager.TemplateGroups.DEAL_VIEW,templateName:"dealOptions",data:gb.viewComponentBuilder.getDealOptionsTemplateData(this)}),this.enableOptions(d))},updateStatusMessage:function(d){var b=this,a=this.viewElement.find(".dealButtonContainer .dealStatusMessageHolder");a&&"function"===typeof a.text&&a.text(d);b.variationView&&q.when("A","a-modal").execute(function(a,e){(a=e.get(gb.enums.WidgetViewIDs.MINI_DP_MODAL+b.dealID))&&a.isActive()&&a.$popover&&(a=a.$popover.find(".dealButtonContainer .dealStatusMessageHolder"),
0<a.length&&a.text(d))})},updateWatchDealStatusMessage:function(d){this.viewElement.find("#"+gb.enums.WatchDealViewIDs.WATCH_BUTTON_TEXT+this.dealID).html(d)}})});q.when("A","GoldboxMobile3PAssets").register("gb-variation-view",function(g,h){var f=h._;return g.createClass({init:function(d){this.dealID=d.dealID;this.viewSkin=null;this.isMiniDP=d.isMiniDP;this.asinID=d.asinID;this.unavailableAsinSelected=!1;this.selectedDimension={};this.modalInstance=d.modalInstance;this.dealView=d.dealView},render:function(){var d;
d=this.asinID;var b=this.dealView.deal;d=this.selectedDimension?b.getVariationAsin(this.selectedDimension):d?b.getAsinDAO(d):null;this.modalFirstLoad=!0;this.update(d);this.handleDropDownActions();this.modalFirstLoad=!1},update:function(d){var b=this,a=b.modalInstance,c=b.isMiniDP;d&&d.status.itemState!==gb.enums.DealStates.SOLDOUT?(f.each(d.variationDimensions,function(a,c){b.selectedDimension[c]=a}),b.unavailableAsinSelected=!1):b.unavailableAsinSelected=!0;var e=gb.templateManager.TemplateGroups.DEAL_VIEW,
l=gb.templateManager.TemplateGroups.DEAL_STATE,k=gb.viewComponentBuilder.getDealViewTemplateData(b.dealView,d);c&&(e=gb.templateManager.TemplateGroups.MINI_DP_DEAL_VIEW,l=gb.templateManager.TemplateGroups.MINI_DP_DEAL_STATE,k=gb.viewComponentBuilder.getMiniDPViewTemplateData(b.dealView,a,d));b.viewSkin=b.dealView._generateStateHTMLFromViewSubTemplates({viewTemplateGroup:e,stateTemplateGroup:l,viewTemplateData:k,stateTemplateDataBuilderFn:function(a){return gb.viewComponentBuilder.getDealStateTemplateData(b.dealView,
a,d)}});c&&a?a.updateContent(b.viewSkin).lock().show():(b.dealView.viewElement.html(b.viewSkin),b.dealView.updateOptionsHTML())},handleDropDownActions:function(){var d=this,b=d.dealID,a=d.dealView.deal;f.keys(a.items);q.when("A","a-dropdown").execute(function(c,e){c.on("a:dropdown:select",function(c){if(c.id.slice(c.id.length-b.length,c.id.length)===b){d.selectedDimension={};var k;d.selectedDimension[c.name]=decodeURIComponent(c.value);var g=a.items[f.keys(a.items)[0]];f.each(g.variationDimensions,
function(b,f){f!==c.name&&(b=f.replace(/\s/g,"")+a.dealID,b=encodeURIComponent(b),b=b.replace(/%/g,"\\%"),b=decodeURIComponent(e.getSelect(b).val()),d.selectedDimension[f]=b)});k=d.getSelectorData();f.isEmpty(k)&&f.find(d.selectedDimension,function(a,b){if(b!==c.name)return d.selectedDimension[b]=gb.resources.getString("csld-select"),k=d.getSelectorData(),!f.isEmpty(k)});d._setDropdownValueBasedOnSelection(k,e,c);g=a.getVariationAsin(d.selectedDimension);d.update(g)}})});q.when("A").execute(function(c,
e){c.on("a:popover:dismiss:"+gb.enums.WidgetViewIDs.MINI_DP_MODAL+b,function(){a.detail.itemType===gb.enums.ItemTypes.VARIATION&&(d.selectedDimension={})})})},getSelectorData:function(){var d=this,b={},a=this.dealView.deal;f.each(d.selectedDimension,function(c,e){f.each(a.items,function(a){d.isMatchingCombination(a)&&f.each(a.variationDimensions,function(a,c){c!==e&&(b[c]||(b[c]=[]),b[c].push(a))})})});return b},isMatchingCombination:function(d){var b=!0;f.each(this.selectedDimension,function(a,c){a!==
d.variationDimensions[c]&&a!==gb.resources.getString("csld-select")&&(b=!1)});return b},_setDropdownValueBasedOnSelection:function(d,b,a){var c=this;f.each(d,function(e,l){if(l!==a.name){var f=l.replace(/\s/g,"")+c.dealID,f=encodeURIComponent(f),f=f.replace(/%/g,"\\%");1===e.length?(b.getSelect(f).setValue(e[0]),c.selectedDimension[l]=e[0]):-1===d[l].indexOf(c.selectedDimension[l])&&(b.getSelect(f).setValue(gb.resources.getString("csld-select")),c.selectedDimension[l]=gb.resources.getString("csld-select"))}})}})});
q.when("A","GoldboxMobile3PAssets").register("gb-viewport-manager",function(g,n){var f=n._;return g.createClass({init:function(d){this.lastDealPosition=this.firstDealPosition=this.lastScrollTop=-1;this.widgetContentPage=1;this.isScrollBound=!1;this.scrollCallback=null;this.widgetID=d.widgetID;this.pageSize=d.pageSize;this.totalDeals=d.totalDeals;this.domElementID=d.domElementID;this.pageScroll();this.attachScroll();this.shouldGarbageCollect=!0;this.pagesToAvoidInGC=1},detachScroll:function(){this.isScrollBound&&
null!==this.scrollCallback&&(g.$(h).unbind("scroll",this.scrollCallback),this.isScrollBound=!1,this.scrollCallback=null)},attachScroll:function(){this.isScrollBound||null!==this.scrollCallback||(this.scrollCallback=f.bind(this.pageScroll,this),gb.subnavController&&f.isNumber(gb.controller.schedulingParams[this.widgetID].subnavPage)&&(this.subnavPage=gb.controller.schedulingParams[this.widgetID].subnavPage,gb.controller.schedulingParams[this.widgetID].enableHidingWidgetHeader&&this.setHidingHeaderVariables()),
!gb.subnavController||f.isNumber(this.subnavPage)&&this.subnavPage!==gb.subnavController.currentPageNumber||g.$(h).scrollTop(0),g.$(h).bind("scroll",this.scrollCallback),this.isScrollBound=!0)},clearHeaderInSubnav:function(){gb.subnavController&&gb.controller.schedulingParams[this.widgetID].enableHidingWidgetHeader&&gb.subnavController.positioning===gb.subnavController.Constants.TOP&&(this.widgetHeaderInSubnav&&this.disableHidingWidgetHeaderOnScroll(),this.subnavPage===gb.subnavController.currentPageNumber&&
gb.subnavController.subnavSlideCompletelyDown())},setHidingHeaderVariables:function(){gb.subnavController&&gb.subnavController.positioning===gb.subnavController.Constants.TOP&&(this.subnavContainer=document.querySelector(gb.subnavController.SubnavIDs.SubnavContainer),this.widgetHeaderHolder=g.$(gb.subnavController.SubnavIDs.SubnavWidgetHolder+this.subnavPage),this.widgetHeaderInSubnav=!1,this.subnavContainerHeightDiv=g.$(gb.subnavController.SubnavIDs.SubnavHeightDiv+this.subnavPage),this.enableHidingWidgetHeaderOnScroll())},
pageScroll:function(){var d;if(!f.isNumber(this.subnavPage)||!gb.subnavController||gb.subnavController.currentPageNumber===this.subnavPage||-1===this.lastScrollTop){d=g.$(h).scrollTop();var b=this.lastScrollTop;this.lastScrollTop=d;d<b?this.setWidgetCurrentPage(gb.enums.Direction.UP):d>b&&this.setWidgetCurrentPage(gb.enums.Direction.DOWN);this.handlePageChange()}},handlePageChange:function(){var d=gb.controller.widgetCurrentPage[this.widgetID],b=this.getCurrentPage();d!==b&&(gb.controller.widgetCurrentPage[this.widgetID]=
b,d=gb.widgets[this.widgetID].totalPages,b>=d-1&&gb.widgets[this.widgetID].hideScrollContentLoader(),b!==d&&(gb.controller.trigger("WidgetPageScroll",this.widgetID,b+1),!0===this.shouldGarbageCollect&&this.garbageCollectAndReRender()))},getCurrentPage:function(){return this.widgetContentPage},setWidgetCurrentPage:function(d){for(var b=this.widgetContentPage;gb.utils.isElementInViewPort(gb.utils.getPageID(this.widgetID,b))===gb.enums.ViewPortPresence.ABSENT;)if(d===gb.enums.Direction.UP&&0<b)--b;else if(d===
gb.enums.Direction.DOWN&&b<=this.totalDeals/this.pageSize)++b;else{b=1;break}this.widgetContentPage=b},garbageCollectAndReRender:function(){this.firstDealPosition=this.widgetContentPage>this.pagesToAvoidInGC+1?(this.widgetContentPage-(this.pagesToAvoidInGC+1))*this.pageSize:0;this.lastDealPosition=(this.widgetContentPage+this.pagesToAvoidInGC)*this.pageSize-1;this.lastDealPosition>=this.totalDeals&&(this.lastDealPosition=this.totalDeals-1);this.renderedDealViews=this.renderedDealViews||[];var d=gb.metadata.getAllDisplayableDealIDs(this.widgetID).slice(this.firstDealPosition,
this.lastDealPosition),b=f.difference(this.renderedDealViews,d);this.renderedDealViews=d;gb.widgets[this.widgetID].reRenderDealViews(this.firstDealPosition,this.lastDealPosition);gb.garbageCollector.deepCleanDealViews(this.widgetID,b)},enableHidingWidgetHeaderOnScroll:function(){gb.subnavController&&gb.subnavController.positioning===gb.subnavController.Constants.TOP&&(this.widgetHeader=g.$("#"+gb.enums.WidgetHeaderIDs.WidgetHeader+this.widgetID),this.widgetHeaderHolder.html(this.widgetHeader.html()),
this.widgetHeader.html(""),this.subnavContainerHeightDiv.height(this.subnavContainer.getBoundingClientRect().height),this.widgetHeaderInSubnav=!0)},disableHidingWidgetHeaderOnScroll:function(){this.widgetHeader.html(this.widgetHeaderHolder.html());this.widgetHeaderHolder.html("");this.widgetHeaderInSubnav=!1;this.subnavContainerHeightDiv.height(this.subnavContainer.getBoundingClientRect().height)}})});q.declare("gb-page-refresher");q.when("A","GoldboxMobile3PAssets","gb-filter-item-view","gb-deal-view",
"gb-viewport-manager","gb-csm","gb-page-refresher").register("gb-widget-view",function(g,n,f,d,b,a,c){var e=n._;return g.createClass({init:function(a){this.widgetID=a.widgetID;this.widgetGroupID=a.widgetGroupID;this.widgetName=a.widgetName;this.domElementID=a.domElementID;this.dealViews={};this.fullyRenderedPages=[];this.pageHandlers=[];this.filterViews=[];this.skinDomElement=null;this.isRefineRender=!1;this.totalPages=this.viewOrientation=null;this.isRetryInProgress=this.isGDMFailing=this.isCFRecorded=
!1;this.minDealViewWidth=this.getMinDealWidth();this.viewPortManager=this.dealsPerRow=null;this.nextPositionToRender=0;this.filterJSONData={};this.nextAdSlotToRenderIndex=-1;this.isMaxDealLimitReached=!1;this.shouldRenderMaxDealLimitMessaging=!0;this.filterController=gb.filterControllerFactory.getFilterController(a.widgetName);this.initializeView()},initializeView:function(){this.skinDomElement=g.$("#"+this.domElementID);this.dealsPerRow=this.getDealsPerRow();var a=gb.controller.schedulingParams[this.widgetID];
e.isEmpty(a.adSlots)||(this.nextAdSlotToRenderIndex=0);var b=null;if(gb.subnavController&&e.isNumber(a.subnavPage)&&(gb.subnavController.widgetsOnSubnavPage[a.subnavPage]||(b=parseInt(gb.subnavController.idleTimeRefresh,10)),a.allowWidgetRefresh)){var d=a.subnavPage;gb.subnavController.widgetsOnSubnavPage[d]=gb.subnavController.widgetsOnSubnavPage[d]||{};gb.subnavController.widgetsOnSubnavPage[d][a.subnavPageSlot]=this}if(gb.subnavController&&(a=parseInt(gb.subnavController.pageRefreshInterval,10),
d=parseInt(gb.subnavController.tabRefreshElapseTime,10),b||a||d))try{this.pageRefresher=new c(b,this.widgetID),this.pageRefresher.initializeVisibilityHandler(a)}catch(f){q.log("PageRefresher works only on mobile platfrom!","ERROR","GoldboxMobileAssets")}gb.configManager.getWidgetViewConfig(this.widgetID).disableOrientationChange||this.enableOrientationChange();gb.resources&&gb.resources.isAcceleratedExperience&&(this.shouldRenderMaxDealLimitMessaging=!1);this._handleRefreshClick()},enableRefine:function(){var a=
this;a.skinDomElement.find("#"+gb.enums.WidgetViewIDs.REFINE).click(function(){a.renderRefine()});a.filterAndSortEventsCache=a.filterAndSortEventsCache||{};a.filterAndSortEventsCache[a.widgetID]||(a.filterAndSortEventsCache[a.widgetID]=e.once(function(){g.declarative("gbfilter-click-"+a.widgetID,"click",function(c){c.data.filterType===gb.enums.FilterConstants.CUSTOM_FILTER?a.renderFilter({isSortFilter:!1,isCustomFilter:!0}):a.renderFilter({isSortFilter:!1})});g.declarative("gbsort-click-"+a.widgetID,
"click",function(c){a.renderFilter({isSortFilter:!0})})}));a.filterAndSortEventsCache[a.widgetID].call()},enableOrientationChange:function(){gb.clientName!==gb.enums.MobileClients.PC&&(this.viewOrientation=gb.utils.getDeviceOrientation(this.widgetID));g.$(h).resize(e.bind(this.resizeWindow,this))},enableInfiniteScroll:function(){var a=gb.controller.schedulingParams[this.widgetID],c=!0;e.each(a.filterConfig,function(a){if(a.attr===gb.enums.BinningParams.PAGE.key)return c=!1});if(c&&!this.viewPortManager){var d=
gb.metadata.getAllDisplayableDealIDs(this.widgetID);this.viewPortManager=new b({widgetID:this.widgetID,pageSize:a.pageSize,totalDeals:d.length,domElementID:this.domElementID})}},getMinDealWidth:function(){return gb.enums.Constants.MIN_TABLET_VIEW_WIDTH},getDealsPerRow:function(){var a=gb.configManager.getDealViewConfig(this.widgetID),c=gb.configManager.getWidgetViewConfig(this.widgetID);return gb.resources.deviceInfo.isPhone?this.viewOrientation===gb.enums.ClientOrientation.LANDSCAPE?a.dealsPerRowL||
gb.enums.Constants.PHONE_LANDSCAPE_COLUMN_COUNT:a.dealsPerRowP||gb.enums.Constants.PHONE_PORTRAIT_COLUMN_COUNT:gb.utils.getDealsPerRow(g.$(h).width(),this.minDealViewWidth,c.hasMargin,c.supportEvenColumnsOnly)},resizeWindow:function(){var a=gb.configManager.getWidgetViewConfig(this.widgetID).allowFlexRendering;if(!this.isRefineRender){gb.controller.watchDealView&&(gb.controller.watchDealView.isWatchDealPopupRendered=!1);var c=this.dealsPerRow;this.dealsPerRow=this.getDealsPerRow();if(gb.clientName===
gb.enums.MobileClients.PC){if(c===this.dealsPerRow)return}else{c=gb.utils.getDeviceOrientation(this.widgetID);if(c===this.viewOrientation)return;var b=gb.configManager.getDealViewConfig(this.widgetID);this.viewOrientation=c;this.viewPortManager&&(this.viewPortManager.lastScrollTop=c===gb.enums.ClientOrientation.LANDSCAPE?Math.ceil(this.viewPortManager.lastScrollTop*b.dealsPerRowP/b.dealsPerRowL):Math.ceil(this.viewPortManager.lastScrollTop*b.dealsPerRowL/b.dealsPerRowP))}a?(a=this.skinDomElement.find(".dealView"),
0<a.size()&&(this.viewOrientation===gb.enums.ClientOrientation.PORTRAIT?a.width(a.eq(0).data("pwidth")):a.width(a.eq(0).data("lwidth"))),this.viewPortManager&&g.$(h).scrollTop(this.viewPortManager.lastScrollTop),this._navigateToWidget()):(this.renderContent(!0),gb.controller.watchDealView&&gb.controller.watchDealView.changeWatchPopupState(gb.enums.WatchDealPopoverActions.UPDATE_WATCH_POPUP))}},renderWireFrame:function(){this.isRefineRender=!1;gb.garbageCollector.clearDealViews(this.widgetID);e.isNumber(gb.controller.schedulingParams[this.widgetID].subnavPage)&&
gb.controller.schedulingParams[this.widgetID].enableHidingWidgetHeader&&gb.widgets[this.widgetID]&&gb.widgets[this.widgetID].viewPortManager&&gb.widgets[this.widgetID].viewPortManager.clearHeaderInSubnav();this.totalCellsRendered=0;var a=gb.viewComponentBuilder.getWidgetViewTemplateData(this);this.filterViews=[];var c=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"wireFrame",data:a});this.skinDomElement.html(c);e.isNumber(gb.controller.schedulingParams[this.widgetID].subnavPage)&&
gb.controller.schedulingParams[this.widgetID].enableHidingWidgetHeader&&gb.widgets[this.widgetID]&&gb.widgets[this.widgetID].viewPortManager&&gb.widgets[this.widgetID].viewPortManager.enableHidingWidgetHeaderOnScroll();this._handleFilterChange();this._handleClearFilters();gb.controller.schedulingParams[this.widgetID].enablePagination&&this.renderPagination(a)},showLoading:function(){if(gb.subnavController&&(g.$(gb.subnavController.subnavPages[gb.subnavController.currentPageNumber]).find("."+gb.enums.WidgetViewIDs.LOADING).length||
gb.subnavController.showRefresher))this.skinDomElement.html("");else{var a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"widgetLoading"});this.skinDomElement.html(a)}},hideScrollContentLoader:function(){this.skinDomElement.find("."+gb.enums.WidgetViewIDs.SCROLL_CONTENT_LOADER).css("display","none")},renderContent:function(a){var c=null;a&&(c=this.viewPortManager?this.viewPortManager.lastScrollTop:null,this.skinDomElement.find("#"+
gb.enums.WidgetViewIDs.CONTENT).empty(),this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.FILTERS).empty(),this.filterViews=[],gb.garbageCollector.clearViewPort(this.widgetID),gb.garbageCollector.clearDealViews(this.widgetID));var b=gb.viewComponentBuilder.getWidgetViewTemplateData(this,a),f=gb.metadata.getAllDisplayableDealIDs(this.widgetID),r=gb.controller.schedulingParams[this.widgetID],n=gb.enums.WidgetViewIDs.CONTENT,b=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,
templateName:"widgetContent",data:b});this.totalPages=Math.ceil(f.length/r.pageSize);r.enablePagination?this.skinDomElement.find("#"+n).html(b):this.skinDomElement.find("#"+n).append(b);for(var b=gb.controller.widgetCurrentPage[this.widgetID],n=r.pageSize,b=gb.controller.schedulingParams[this.widgetID].eventID||r.enablePagination?n*(b-1):0,q=f.length<this.dealsPerRow?f.length:this.dealsPerRow;this.nextPositionToRender<=gb.watcher.lowestDealIDWatchedIndex[this.widgetID]&&b+this.nextPositionToRender<
f.length;){var t=f[b+this.nextPositionToRender],w=new d({dealID:t,widgetView:this,position:this.nextPositionToRender});this.dealViews[t]=this.dealViews[t]||{};this.dealViews[t][this.nextPositionToRender]=w;w.render();this._publishLatencyMetrics(this.nextPositionToRender,gb.watcher.lowestDealIDWatchedIndex[this.widgetID],q,w);this._recordWidgetCF(r.featureScope);this.nextPositionToRender++}r.maxLimitDeals&&this.nextPositionToRender>=r.maxLimitDeals&&this.renderMaxLimitDealTemplate();f=r.adSlots;if(!e.isEmpty(f))for(;this.nextAdSlotToRenderIndex<
f.length;)if(b=gb.utils.getAdRowID(this.widgetID,this.nextAdSlotToRenderIndex),q=this.skinDomElement.find("#"+b),q.length)b=gb.viewComponentBuilder.getAdRowViewData(this),b=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"adSlot",data:b}),q.html(b),this.nextAdSlotToRenderIndex++;else break;!r.enforceLimitedDeals&&!r.enablePagination&&0<n&&this.enableInfiniteScroll();r.enableCategoryRefine&&this.enableRefine();this.widgetName!==
gb.enums.WidgetNames.TAB_GRID_HERO||r.enforceLimitedDeals||(n=this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.FILTER_CONTENT),n.html(this._getRefineHTML()),gb.accessibility.trigger("AccessibilityAction","updateRefineView",{filterEl:n}));this._renderFilterViews();a&&this.viewPortManager&&(c&&(this.viewPortManager.lastScrollTop=c),void 0!==r.subnavPage&&null!==r.subnavPage?g.$(gb.utils.getSubnavPageElementFromDomID(this.domElementID)).scrollTop(this.viewPortManager.lastScrollTop):g.$(h).scrollTop(this.viewPortManager.lastScrollTop));
this._publishWidgetLatencyMetrics(r.featureScope);this._navigateToWidget();this._renderEllipsifiedTitle();this.applyWidgetSpecificStyle()},_publishLatencyMetrics:function(a,c,b,d){100===parseInt(this.widgetID,10)&&(a<b&&(a===b-1?d.signalMarker("af",{recordMarkerFeature:!0}):d.signalMarker("af")),a===c-1?d.signalMarker("cf",{recordMarkerFeature:!0}):d.signalMarker("cf"))},showExcessiveTrafficMessage:function(){gb.metadata.sortedDealIDs[this.widgetID]=[];gb.watcher.unwireStatusRefresh(gb.watcher.viewPort[this.widgetID]);
this.renderWireFrame();this.renderContent(!0)},applyWidgetSpecificStyle:function(){g.$("#filterContent").css("background","white");g.$("#categoryRefineContent").parent().css("background","white");this.widgetName===gb.enums.WidgetNames.MG_HERO&&(this.skinDomElement.find(".widgetContentRow.noBorder").removeClass("noBorder"),this.skinDomElement.find(".widgetContentRow:not(:has(*\x3e*))").addClass("noBorder"))},reRenderDealViews:function(a,c){if(!(c<=a))for(var b=gb.metadata.getAllDisplayableDealIDs(this.widgetID);a<
c;a++){var e=b[a],f=null;this.dealViews[e]&&this.dealViews[e][a]&&(f=this.dealViews[e][a]);var g=gb.garbageCollector.reRenderGCElement(this.widgetID,e,a);g?(this.dealViews[e]=this.dealViews[e]||{},this.dealViews[e][a]=g,gb.metricsManager.recordAction(this.widgetID,e,"GC_RENDER",a)):f&&0!==f.viewElement.children("a").length||(f||(f=new d({dealID:e,widgetView:this,position:a}),this.dealViews[e]=this.dealViews[e]||{},this.dealViews[e][a]=f),f.render())}},_navigateToWidget:function(){var a=gb.controller.schedulingParams[this.widgetID].widgetAnchorName;
a&&h.location.hash==="#"+a&&e.defer(function(){g.$("html, body").scrollTop(g.$("#"+a).offset().top)})},_renderFilterViews:function(){var a=this;a.isFilterEnabled()&&(a.widgetName!==gb.enums.WidgetNames.MG_HERO||e.isEmpty(a.filterViews))&&e.each(gb.controller.schedulingParams[a.widgetID].filterConfig,function(c){c=new f({},{filterConfig:c,widgetView:a});a.filterViews.push(c);gb.configManager.getWidgetViewConfig(a.widgetID).showBottomSheetFilter||c.render()})},_getRefineHTML:function(){var a=this.isEventsWidget()?
"filter":"refine",c=gb.viewComponentBuilder.getRefineTemplateData(this);return gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:a,data:c})},renderRefine:function(a){var c=this;c.isRefineRender=!0;var b=c._getRefineHTML();if(c.isEventsWidget()){var b=g.$("\x3cdiv\x3e").html(b),d=g.$("#"+gb.enums.WidgetViewIDs.FILTERS,c.skinDomElement).html();g.$("#"+gb.enums.WidgetViewIDs.FILTERS,b).html(d);b=b.html()}c.skinDomElement.hide();
a?g.$("#"+a).html(b):c.skinDomElement.html(b);c.skinDomElement.slideDown();c.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CANCEL).click(function(a){a.preventDefault();c.skinDomElement.slideUp(function(){c.skinDomElement.show();c.renderWireFrame();c.renderContent(!0)})})},renderPagination:function(){var a=gb.viewComponentBuilder.getPaginationTemplateData(this),a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,templateName:"pagination",
data:a});this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.PAGINATION_ROW).html(a);this._handlePageChange()},_handleFilterChange:e.once(function(){g.declarative("refine","click",function(a){a.$event.preventDefault();var c=a.data.widgetID,b=a.$target.closest("[data-status]").data("status");a=a.$target.closest("[data-category]").data("category");b?(gb.controller.trigger("WidgetStatusChange",c,b),gb.widgets[c].renderRefine(gb.enums.WidgetViewIDs.FILTER_CONTENT),gb.widgets[c].enableInfiniteScroll()):
a&&gb.controller.trigger("WidgetCategoryChange",c,a);(b||a)&&q.when("a-popover").execute(function(a){gb.widgets[c].isRefineRender=!1;(a=a.get(gb.enums.WidgetViewIDs.REFINE_POPOVER_NAME))&&a.hide()})})}),_handleRefreshClick:e.once(function(){g.declarative("refresh-widget","click",function(a){a.$event.preventDefault();gb.widgets[a.data.widgetID].refreshWidget()})}),_handlePageChange:e.once(function(){g.declarative("gbfilter-pagination","click",function(a){a.$event.preventDefault();var c=a.data.widgetID,
b=parseInt(a.data.currentPage,10),d=parseInt(a.data.totalPages,10),e=a.$target.closest("[data-page]").data("page");e||(a=a.$target[0].href&&a.$target[0].href.split("#")[1],a===gb.enums.PaginationDummyURLs.PREV&&1<b?e=b-1:a===gb.enums.PaginationDummyURLs.NEXT&&b<d&&(e=b+1));e&&(gb.controller.widgetCurrentPage[c]=e,c&&!gb.widgets[c].isEventsWidget()&&(gb.controller.trigger("WidgetPageUpdate",c,!0),gb.controller.updateAppliedFilters(c)))})}),_handleClearFilters:e.once(function(){g.declarative("clear-refine",
"click",function(a){a.$event.preventDefault();a=a.data.widgetID;gb.controller.widgetCurrentStatus[a]=gb.enums.StatusFilters.AVAILABLE;gb.controller.widgetCurrentCategory[a]=gb.enums.CategoryFilters.ALL;gb.controller.widgetCurrentPage[a]=1;gb.controller.trigger("WidgetPageUpdate",a,!0);gb.controller.updateAppliedFilters(a)})}),scrollToWidgetTop:function(a){a||(a=0);g.$("html,body").animate({scrollTop:this.skinDomElement.offset().top},a)},isEventsWidget:function(){return!!gb.controller.schedulingParams[this.widgetID].eventID},
isFilterEnabled:function(){return!!this.widgetGroupID},_renderEllipsifiedTitle:function(){var a=this;gb.configManager.getWidgetViewConfig(this.widgetID).useCssEllipsification&&e.defer(function(){e.each(a.dealViews,function(a,c){e.each(a,function(a,c){a.renderTitle(!1)})})})},_publishWidgetLatencyMetrics:function(a){a&&gb.csm&&gb.csm.publishedMetrics&&!gb.csm.publishedMetrics[a]&&(gb.csm.signalMarker("be",a),gb.csm.publishMetrics(a))},_recordWidgetCF:function(a){a&&!this.isCFRecorded&&gb.csm&&gb.csm.publishedMetrics&&
!gb.csm.publishedMetrics[a]&&(gb.csm.signalMarker("cf",a),this.isCFRecorded=!0)},renderFilter:function(a){this.filterViews[0]._handleFilterChange();this.getInitialFilterList(a);this._handleBottomSheetFilterEvents()},getInitialFilterList:function(a){var c=a.isSortFilter;a=a.isCustomFilter;var b=this,d=e.keys(this.filterController.models[this.widgetGroupID].availableFilterOptions),g=e.keys(b.filterViews[0]._staticFilterAttrToValues),d=e.union(d,g,[gb.enums.BinningParams.REVIEW_RATING.key,gb.enums.BinningParams.SORT_ORDER.key]);
this.filterJSONData={};e.each(gb.controller.schedulingParams[b.widgetID].filterConfig,function(a){var c=!1,f="";e.each(a.attr.split(","),function(a){!c&&e.contains(d,a)&&(c=!0);f||(f=gb.filterUtils.getLabelForSelectedAttribute(a,{widgetID:b.widgetID,widgetGroupID:b.widgetGroupID,totalPages:b.totalPages}))});c&&(b.filterJSONData[a.attr]={currentSelection:f,filterConfig:a})});var g=e.without(Object.keys(b.filterJSONData),gb.enums.BinningParams.SORT_ORDER.key),h=this.filterController.models[this.widgetGroupID].customFilter;
c||1!==g.length?a?b.filterJSONData[h]&&(c=new f({},{filterConfig:b.filterJSONData[h].filterConfig,widgetView:b,disableBackButton:!0}),c.render()):(h&&delete b.filterJSONData[h],g=gb.viewComponentBuilder.getBottomSheetFilterContentExpanderData(b,{isSortFilter:c}),a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,templateName:"expander",data:g}),g=gb.viewComponentBuilder.getBottomSheetFilterHeaderData(b,{title:c?gb.resources.getString("gb_sort_by").toUpperCase():
gb.resources.getString("csld-refine").toUpperCase(),showClearOption:!c,enableBack:0}),c=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,templateName:"header",data:g}),g=gb.viewComponentBuilder.getBottomSheetFilterFooterData(),g=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,templateName:"footer",data:g}),c={header:c,contents:a,footer:g},gb.controller.getBottomSheet().render(c)):
(c=new f({},{filterConfig:b.filterJSONData[g[0]].filterConfig,widgetView:b}),c.render())},_handleBottomSheetFilterEvents:function(){var a=this;a.bottomSheetFilterEventsCache=a.bottomSheetFilterEventsCache||{};a.bottomSheetFilterEventsCache[a.widgetID]||(a.bottomSheetFilterEventsCache[a.widgetID]=e.once(function(){g.declarative("gbfilter-back-navigation-"+a.widgetID,"click",function(c){a.getInitialFilterList({isSortFilter:!1})});g.declarative("gbfilter-expander-"+a.widgetID,"click",function(c){(new f({},
{filterConfig:a.filterJSONData[c.data.attribute].filterConfig,widgetView:a})).render()})}));a.bottomSheetFilterEventsCache[a.widgetID].call()},refreshWidget:function(a){var c=this,b=gb.controller.schedulingParams[c.widgetID],d=null;c.isGDMFailing=!1;c.isRetryInProgress=!1;a&&this.viewPortManager&&(d=this.viewPortManager.lastScrollTop);b.fetchWatchedDeals&&(c.showLoading(),gb.metadata.refreshWatchedDeals(c.widgetID));b.watchedDealsWidget||gb.utils.isWatchedDealsTab(c.widgetID)||(delete gb.metadata.sortedDealIDs[c.widgetID],
a={},a=2,gb.configManager.getWidgetViewConfig(c.widgetID).fetchSinglePageDeals&&(a=1),a={dealsPerPage:gb.configManager.getWidgetViewConfig(c.widgetID).preFetchGDMDeals,getDealsSize:a*b.pageSize},c.showLoading(),d&&g.$(h).scrollTop("0px"),gb.service.fetchDealWithData(c.widgetID,a,function(){c.filterController._updateWidgetGroup(c.widgetGroupID);d&&g.$(h).scrollTop(d)}))},renderMaxLimitDealTemplate:function(){if(0===this.skinDomElement.find(".widgetMaxLimitDeal").size()&&this.shouldRenderMaxDealLimitMessaging){var a=
gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.DEAL_VIEW,templateName:"maxLimitDeal"});this.skinDomElement.append(a);this.hideScrollContentLoader()}}})});q.when("A","GoldboxMobile3PAssets","gb-widget-view","gb-deal-view").register("gb-supple-widget-view",function(g,h,f,d){var b=h._;return f.extend({totalCellsRendered:0,isLeftFilterRequired:!1,init:function(a){var c=["all",gb.enums.BinningParams.PAGE.key,gb.enums.BinningParams.SORT_ORDER.key];
this.isLeftFilterRequired=!b.isEmpty(b.reject(a.schedulingParams.filterConfig,function(a){return b.contains(c,a.attr)}));this._super(a)},renderWireFrame:function(){this.filterViews=[];gb.garbageCollector.clearDealViews(this.widgetID);this.totalCellsRendered=0;var a=gb.viewComponentBuilder.getSuppleWidgetViewTemplateData(this),a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"wireFrame",data:a});this.skinDomElement.html(a);
var a=this.skinDomElement.find(gb.enums.WidgetViewSelectors.PADCENTER),c=gb.utils.isTablet(gb.clientName)?gb.enums.Constants.MIN_TAB_WIDTH:gb.enums.Constants.MIN_NAV_WIDTH;gb.controller.schedulingParams[this.widgetID].enforceLimitedDeals||(c-=gb.enums.Constants.SUPPLE_FILTER_COLUMN_WIDTH);var b=this.skinDomElement.width();!gb.controller.schedulingParams[this.widgetID].enforceLimitedDeals&&this.isLeftFilterRequired&&(b-=gb.enums.Constants.SUPPLE_FILTER_COLUMN_WIDTH);b<c&&(c=b);a.css("min-width",c)},
renderContent:function(a){var c=this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.FILTERS),b=gb.controller.schedulingParams[this.widgetID],f=gb.metadata.customResponseAttributes[this.widgetID];a&&(this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CONTENT).empty(),c.empty(),c.height("auto"),this.filterViews=[],gb.garbageCollector.clearDealViews(this.widgetID));var k=gb.viewComponentBuilder.getSuppleWidgetViewTemplateData(this,a);a=gb.metadata.getAllDisplayableDealIDs(this.widgetID).length;var c=
gb.metadata.getSortedDealIDs(this.widgetID),g=gb.enums.WidgetViewIDs.CONTENT,h=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"widgetContent",data:k}),k=gb.controller.widgetCurrentPage[this.widgetID],n=b.pageSize;this.skinDomElement.find("#"+g).html(h);this.totalPages=Math.ceil(a/n);g=this.getATFDealsCount(a,b.enforceLimitedDeals,gb.widgetHelper.allDealsFetched[this.widgetID]);h=0;b.enforceLimitedDeals?h=c.length:a&&
(h=Math.min(n,a-(k-1)*n));this.totalCellsRendered=0;this._renderFilterViews();for(var q=0,C=0,t=0;q<h;q++){var w=c[q];if(w){var y=this._isDoubleCell(w),z=y?2:1;t+z<=this.dealsPerRow||(C++,t=0);var B=new d({dealID:w,widgetView:this,position:q,isDoubleCell:y,row:C,column:t});t+z>=this.dealsPerRow?(t=0,C++):t+=z;this.dealViews[w]=this.dealViews[w]||{};this.dealViews[w][q]=B;B.render();this._publishLatencyMetrics(q,h,g,B);this._recordWidgetCF(b.featureScope);y=this._isDoubleCell(w);w=gb.utils.isSponsoredDeal(w,
f);this.totalCellsRendered+=y?2:1;var z=this.totalCellsRendered<=this.dealsPerRow,A=!1;0===this.totalCellsRendered%this.dealsPerRow?A=!0:q+1===c.length&&(A=!b.showLaunchCell||!b.enforceLimitedDeals);(y=this.getDealViewCSS(y,z,A,w))&&B.viewElement.addClass(y);gb.utils.isTouchDevice()&&b.showShortCellView&&B.viewElement.removeClass("shortCellView").addClass("shortCellViewTablet")}}b.maxLimitDeals&&k*n>=b.maxLimitDeals&&this.renderMaxLimitDealTemplate();b.enforceLimitedDeals&&0<a&&this.renderLaunchCell();
this._publishWidgetLatencyMetrics(b.featureScope);this._navigateToWidget();this._renderEllipsifiedTitle()},getATFDealsCount:function(a,c,b){var d=this.dealsPerRow;c?b&&d>a&&(d=a):d>a&&(d=a);return d},getDealsPerRow:function(){var a=g.$("#"+this.domElementID).width();!gb.controller.schedulingParams[this.widgetID].enforceLimitedDeals&&this.isLeftFilterRequired&&(a-=gb.enums.Constants.SUPPLE_FILTER_COLUMN_WIDTH);var c=gb.configManager.getWidgetViewConfig(this.widgetID),a=gb.utils.getDealsPerRow(a,this.minDealViewWidth,
c.hasMargin,!1,!0),a=Math.min(a,c.maxNumberofDealsInRow);return a=Math.max(2,a)},renderMaxLimitDealTemplate:function(){if(this.shouldRenderMaxDealLimitMessaging){var a=this.skinDomElement.find("#maxLimitCell"),c=!1;this.totalCellsRendered<=this.dealsPerRow&&(c=!0);a&&a.remove();a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.DEAL_VIEW,templateName:"maxLimitDeal"});c=this.getDealViewCSS(!1,c,!0);this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CONTENT).append(a);
a=this.skinDomElement.find("#maxLimitCell");a.addClass(c)}},renderLaunchCell:function(){if(gb.controller.schedulingParams[this.widgetID].enforceLimitedDeals&&gb.controller.schedulingParams[this.widgetID].showLaunchCell&&gb.widgetHelper.allDealsFetched[this.widgetID]&&0!==b.keys(this.dealViews).length){var a=this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.LAUNCH_CELL);a&&a.remove();var c=!1;this.totalCellsRendered<=this.dealsPerRow&&(c=!0);a=gb.viewComponentBuilder.getLaunchCellTemplateData(this);
a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"launchCell",data:a});c=this.getDealViewCSS(!1,c,!0);this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CONTENT).append(a);a=this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.LAUNCH_CELL);a.addClass(c)}},getDealViewCSS:function(a,c,b,d){var f="tallCellView";gb.controller.schedulingParams[this.widgetID].showShortCellView&&(f="shortCellView");f=f+" "+("gridColumn"+this.dealsPerRow);
c&&gb.controller.schedulingParams[this.widgetID].enforceLimitedDeals&&(f+=" firstRowDiv");b&&(f+=" rightMostDiv");f=a?f+" doubleCell":f+" singleCell";d&&(f+=" adHolder");return f},_isDoubleCell:function(a){return gb.controller.schedulingParams[this.widgetID].enforceLimitedDeals&&gb.controller.schedulingParams[this.widgetID].showDoubleCellDOTD&&(b.contains(gb.metadata.dealsByType[gb.enums.DealTypes.DOTD],a)||b.contains(gb.metadata.dealsByAccessType[gb.enums.DealAccessTypes.PRIME_ONLY_DOTD],a))},renderErrorMessage:function(){if(!gb.controller.popOverVisible){this.removeErrorMessage();
var a=gb.viewComponentBuilder.getCartErrorDisplayData(),a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"widgetErrorAlert",data:a});this.skinDomElement.prepend(a);g.$("html,body").animate({scrollTop:g.$("#"+this.domElementID).offset().top},"slow")}},removeErrorMessage:function(){var a=this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CART_ERROR);0<a.length&&a.remove()},getMinDealWidth:function(){return gb.enums.Constants.MIN_PC_VIEW_WIDTH}})});
q.when("A","GoldboxMobile3PAssets","gb-widget-view","gb-deal-view","gb-filter-item-view").register("gb-shoveler-widget-view",function(g,n,f,d,b){var a=n._;return f.extend({isLaunchCellPage:!1,Constants:{MIN_SHOVELER_VIEW_WIDTH:223,CONTAINER_PADDING:21},init:function(a){this._super(a);this.displayableFilter=[gb.enums.BinNames.CATEGORIES]},renderWireFrame:function(){var a=this;gb.garbageCollector.clearDealViews(this.widgetID);q.when("a-popover").execute(function(b){(b=b.get(gb.enums.WidgetViewIDs.SHOVL_FILTER+
"_"+a.widgetID))&&b.hide()&&b.update({content:""})});var b=gb.viewComponentBuilder.getShovelerWidgetViewTemplateData(this),d=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"wireFrame",data:b});this.skinDomElement.html(d);this.renderStateHeader(b)},renderContent:function(){var a=gb.controller.schedulingParams[this.widgetID],b=gb.viewComponentBuilder.getShovelerWidgetViewTemplateData(this);this.isLaunchCellPage=gb.utils.isLaunchCellPage(this.widgetID);
var f=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"widgetContent",data:b});this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CONTENT).html(f);this._renderShovlPagination(b);this._renderFilterViews();for(var f=b.totalDeals<this.dealsPerRow?b.totalDeals:this.dealsPerRow,k=0,g=0,h=gb.metadata.getSortedDealIDs(this.widgetID);k<b.lastDealIDPosition;){var n=h[k];if(n){var q=new d({dealID:n,widgetView:this,position:k,
row:1,column:g});this._recordWidgetCF(a.featureScope);this.dealViews[n]=this.dealViews[n]||{};this.dealViews[n][k]=q;q.render();this._publishLatencyMetrics(k,b.lastDealIDPosition,f,q);k++;g++}else k++}a.maxLimitDeals&&gb.controller.widgetCurrentPage[this.widgetID]*a.pageSize>=a.maxLimitDeals&&this.renderMaxLimitDealTemplate();0<b.totalDeals&&this.isLaunchCellPage?(this.renderLaunchCell(),this.renderShovlButtonsContent({prev:!1,next:!0},b)):this.renderShovlButtonsContent(!1,b);this._publishWidgetLatencyMetrics(a.featureScope);
this._renderEllipsifiedTitle()},getDealsPerRow:function(){var a=this.skinDomElement.width()-2*this.Constants.CONTAINER_PADDING,b=gb.configManager.getWidgetViewConfig(this.widgetID),a=gb.utils.getDealsPerRow(a,this.minDealViewWidth,b.hasMargin,!1,!0),a=Math.min(a,b.maxNumberofDealsInRow);return a=Math.max(2,a)},resizeWindow:function(){if(!this.isRefineRender){gb.controller.watchDealView&&(gb.controller.watchDealView.isWatchDealPopupRendered=!1);var a=this.dealsPerRow;this.dealsPerRow=this.getDealsPerRow();
if(a!==this.dealsPerRow){gb.widgetHelper&&gb.widgetHelper.callDataArray[this.widgetID]&&(gb.widgetHelper.callDataArray[this.widgetID][0].dealsPerPage=this.dealsPerRow);var b=gb.controller.schedulingParams[this.widgetID],a=gb.metadata.selectedDealsCount[this.widgetID],d=this.dealsPerRow||b.pageSize;b.pageSize=d;a=(b=b.widgetTabConfig[b.widgetCurrentTab])&&b.launchCellIndex?Math.ceil((a+1)/d):Math.ceil(a/d);d=gb.controller.widgetCurrentPage[this.widgetID];d>a&&(d=a);gb.controller.widgetCurrentPage[this.widgetID]=
d;gb.controller.trigger("WidgetResize",this.widgetID);gb.controller.watchDealView&&gb.controller.watchDealView.changeWatchPopupState(gb.enums.WatchDealPopoverActions.UPDATE_WATCH_POPUP)}}},renderErrorMessage:function(){if(!gb.controller.popOverVisible){this.removeErrorMessage();var a=gb.viewComponentBuilder.getCartErrorDisplayData(),a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"widgetErrorAlert",data:a});this.skinDomElement.prepend(a);
a=this.skinDomElement.position().top;h.scrollY>a&&g.$("html,body").animate({scrollTop:a},"slow")}},removeErrorMessage:function(){var a=this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CART_ERROR);0<a.length&&a.remove()},getMinDealWidth:function(){return this.Constants.MIN_SHOVELER_VIEW_WIDTH},renderShovlButtonsContent:function(c,b){b||(b=gb.viewComponentBuilder.getShovelerWidgetViewTemplateData(this));a.isObject(c)?b.disableButton=c.prev:b.disableButton=c;var d=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,
templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"previousButton",data:b});this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.PREV_SHOVL_BUTTON).html(d);a.isObject(c)&&(b.disableButton=c.next);c=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"nextButton",data:b});this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.NEXT_SHOVL_BUTTON).html(c)},_renderShovlPagination:function(a){a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,
templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"pagination",data:a});this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.SHOVL_PAGINATION).html(a)},_renderFilterViews:function(){var c=this;a.each(gb.controller.schedulingParams[this.widgetID].filterConfig,function(d){a.contains(c.displayableFilter,d.attr)&&(d=new b({},{filterConfig:d,widgetView:c}),d.render(),c.filterViews.push(d))})},renderStateHeader:function(a){var b=a;b||(b=gb.viewComponentBuilder.getShovelerWidgetViewTemplateData(this));
var d=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"stateHeader",data:b});a=gb.enums.WidgetViewIDs.SHOVL_STATE_HEADER;this.skinDomElement.find("#"+a).html(d);b.disableFilter||(b=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"filterHeader",data:b}),this.skinDomElement.find("#"+a).append(b))},showLoading:function(){var a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,
templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"widgetLoading"});this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CONTENT).html(a)},renderMaxLimitDealTemplate:function(){if(this.shouldRenderMaxDealLimitMessaging){var a=this.skinDomElement.find("#maxLimitCell"),b="dealView",d=gb.viewComponentBuilder.getShovelerWidgetViewTemplateData(this);a&&a.remove();a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.DEAL_VIEW,templateName:"maxLimitDeal"});
this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CONTENT).append(a);b+=" "+d.gridColumnCSS;this.skinDomElement.find("#maxLimitCell").addClass(b)}},renderLaunchCell:function(){if(gb.widgetHelper.allDealsFetched[this.widgetID]&&this.isLaunchCellPage){var a=this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.LAUNCH_CELL);a&&a.remove();a=gb.viewComponentBuilder.getShovelerLaunchCellTemplateData(this);a=gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,
templateName:"launchCell",data:a});this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.CONTENT).append(a)}}})});q.when("A","GoldboxMobile3PAssets","gb-widget-view","gb-filter-item-view").register("gb-faceout-widget-view",function(g,h,f,d){var b=h._;return f.extend({init:function(a){this._super(a);this.marginOnEitherSide=22;this.tileWidthAsPercentage=0;this.minimumTileWidth=85},renderContent:function(a){a&&this._clearFilterViews();this._generateFilterViews();a=this._fetchWidgetConfigs();a.animateShoveling=
!1;this._calculateTileWidth(a.tilesPerPage);this._calculateTotalPages(a);this._renderFilterViews();this.renderShovlButtonsContent(a)},_generateFilterViews:function(){var a=this;b.isEmpty(a.filterViews)&&b.each(gb.controller.schedulingParams[a.widgetID].filterConfig,function(c){c=new d({},{filterConfig:c,widgetView:a});a.filterViews.push(c)})},_renderFilterViews:function(){b.each(this.filterViews,function(a){a.render()})},resizeWindow:function(){this.renderContent(!0)},renderShovlButtonsContent:function(a){var c=
this._fetchWidgetViewTemplateData();c.currentPage=a.currentPage;c.totalPages=this.totalPages;1>=this.totalPages&&(c.hideButton=!0);c.disableButton=1>=c.currentPage;var b=this._fetchWidgetViewHtml("previousButton",c);this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.PREV_SHOVL_BUTTON).html(b);c.disableButton=c.currentPage>=c.totalPages;c=this._fetchWidgetViewHtml("nextButton",c);this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.NEXT_SHOVL_BUTTON).html(c);this._shovelTo(a)},_fetchWidgetViewTemplateData:function(){var a=
{};a.widgetID=this.widgetID;a.widgetName=this.widgetName;a.widgetGroupID=this.widgetGroupID;a.actionName=gb.enums.WidgetActions.Faceout.SHOVEL;a.hideButton=!1;return a},_fetchWidgetViewHtml:function(a,c){return gb.templateManager.getWidgetHTML({widgetID:this.widgetID,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:a,data:c})},_fetchWidgetConfigs:function(){var a=gb.configManager.getWidgetViewConfig(this.widgetID),c=gb.controller.widgetCurrentPage[this.widgetID],b=this.filterViews[0].filterConfig.faceoutConfig.length,
d=this.skinDomElement.width()-2*this.marginOnEitherSide;return{totalTiles:b,tilesPerPage:Math.min(a.maxTilesPerPage,b,Math.floor(d/this.minimumTileWidth)),currentPage:c,scrollAnimationSpeed:a.scrollAnimationSpeed}},_shovelTo:function(a){var c=(this.skinDomElement.width()-2*this.marginOnEitherSide)/a.tilesPerPage*(a.currentPage-1)*a.tilesPerPage,b=a.scrollAnimationSpeed;a.animateShoveling?g.$(".tiles").animate({scrollLeft:c},b):g.$(".tiles").scrollLeft(c)},_calculateTileWidth:function(a){this.tileWidthAsPercentage=
100/a},_clearFilterViews:function(){this.skinDomElement.find("#"+gb.enums.WidgetViewIDs.FILTERS).empty()},_calculateTotalPages:function(a){this.totalPages=Math.ceil(a.totalTiles/a.tilesPerPage)}})});q.when("A","gb-widget-view","gb-shoveler-widget-view","gb-supple-widget-view","gb-faceout-widget-view").register("gb-widget-factory",function(g,h,f,d,b){return g.createClass({getWidgetView:function(a){var c=a.widgetName;try{switch(c){case gb.enums.WidgetNames.PC_SUPPLE:return new d(a);case gb.enums.WidgetNames.PC_SHOVELER:return new f(a);
case gb.enums.WidgetNames.PC_FACEOUT:return new b(a);default:return new h(a)}}catch(e){q.log("WidgetView invoked for the widget is not supported on the platform!","ERROR","GoldboxMobileAssets")}},isInstanceOfWidgetView:function(a){return a&&a instanceof h?!0:!1}})});q.when("A","GoldboxMobile3PAssets").register("gb-filter-item-view",function(g,h){var f=h._;return g.createClass({_staticFilterAttrToValues:{},init:function(d,b){this.widgetView=b.widgetView;this.filterConfig=b.filterConfig;this.disableBackButton=
b.disableBackButton;this.type=this.filterConfig.type;this.title=this.filterConfig.title;d=this.filterConfig.attr.split(",");this.attributes=f.map(d,function(a){return g.$.trim(a)});d="#"+gb.utils.getFilterItemViewID(this.attributes,this.type);this.viewElement=this.widgetView.skinDomElement.find(d);this.viewElement.length?this.viewElement.empty():this.viewElement=this.widgetView.skinDomElement.find("#"+gb.enums.WidgetViewIDs.FILTERS);this._populateStaticFilterValues()},render:function(){this.filterOptions=
this._getFilterOptionList(this.attributes,this.widgetView);var d=gb.filterControllerFactory.getFilterController(this.widgetView.widgetName).models[this.widgetView.widgetGroupID];if(gb.configManager.getWidgetViewConfig(this.widgetView.widgetID).showBottomSheetFilter){var b=gb.viewComponentBuilder.getBottomSheetFilterContentData(this),a=gb.templateManager.getWidgetHTML({widgetID:this.widgetView.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,templateName:"links",data:b}),b=gb.viewComponentBuilder.getBottomSheetFilterHeaderData(this,
{title:gb.resources.getString(this.filterConfig.title).toUpperCase(),showClearOption:0,enableBack:this.disableBackButton||1===f.without(d.attributesList,gb.enums.BinningParams.SORT_ORDER.key).length?0:1}),d=gb.templateManager.getWidgetHTML({widgetID:this.widgetView.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,templateName:"header",data:b}),b=gb.viewComponentBuilder.getBottomSheetFilterFooterData(),b=gb.templateManager.getWidgetHTML({widgetID:this.widgetView.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,
templateName:"footer",data:b}),a={header:d,contents:a,footer:b};gb.controller.getBottomSheet().render(a)}else b=gb.viewComponentBuilder.getFilterViewTemplateData(this),b.elements=this.generateFilterViewComponent(b),this.viewSkin=gb.templateManager.getWidgetHTML({widgetID:this.widgetView.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,templateName:"filterItem",data:b}),this.viewElement.append(this.viewSkin);this._handleFilterChange()},generateFilterViewComponent:function(d){var b=
{};b[this.type]=gb.templateManager.getWidgetHTML({widgetID:this.widgetView.widgetID,templateGroup:gb.templateManager.TemplateGroups.FILTER_VIEW,templateName:this.type,data:d});return b},_paginationDummyUrls:{PREV:"prev",NEXT:"next"},_getTypeCorrectedData:function(d){var b=parseInt(d,10);return!isNaN(b)&&b+""===d&&0<=b?b:f.isNumber(d)&&0>d?d.toString():d},_handleTitleChange:function(d){d.targetedWidget.title&&(d.targetedWidget.title=null,d.targetedWidget.clearTitle=!0)},_handleFilterChange:f.once(function(){var d=
this,b=function(a){var c=f.tail(arguments)[0],b=c.$target.closest("[data-widgetid]").data("widgetid");if(b){var l=gb.widgets[b].widgetGroupID,k=c.data.attribute,g=c.data.attributes,h=c.data.linkType,n=c.data.redirectURL,q=c.data.titleOnTargetedWidget,C=c.data.isSelected,t=gb.filterControllerFactory.getFilterController(gb.widgets[b].widgetName).models[l];a.call(d,c,{widgetID:b,widgetGroupID:l,attribute:k,attributes:g,linkType:h,redirectURL:n,titleOnTargetedWidget:q,metrics:{widgetID:b,eventID:l,data:[l,
k||g],context:gb.metrics.refTags.filter},isSelected:C},t);return!1}};g.declarative("gbfilter-checkbox","change",f.wrap(function(a,c,b){var d=a.data.value;a.$target.is(":checked")?b.addFilterValue(c.attribute,d,c.metrics):(c.metrics.context=gb.metrics.refTags.clearFilter,b.removeFilterValue(c.attribute,d,c.metrics))},b));g.declarative("gbfilter-dropdown","change",f.wrap(function(a,c,b){a=a.$target.val();b.setFilterValue(c.attribute,a,c.metrics)},b));g.declarative("gbfilter-link","click",f.wrap(function(a,
c,b){if("clear"===c.linkType)if(this._handleTitleChange(b),"true"===c.isSelected)gb.controller.getBottomSheet().close();else{var l=f.map(c.attributes.split(","),g.$.trim);f.each(l,function(a){b.removeFilterValue(a,void 0,c.metrics,!0)});b.triggerChangeEvent(c.metrics)}else{a.data.attribute===gb.enums.BinningParams.DEAL_TYPE.key?(b.removeFilterValue(gb.enums.BinningParams.PRIME_ACCESS_TYPE.key,void 0,void 0,!0),b.removeFilterValue(gb.enums.BinningParams.ACCESS_TYPE.key,void 0,void 0,!0)):a.data.attribute===
gb.enums.BinningParams.PRIME_ACCESS_TYPE.key?(b.removeFilterValue(gb.enums.BinningParams.DEAL_TYPE.key,void 0,void 0,!0),b.removeFilterValue(gb.enums.BinningParams.ACCESS_TYPE.key,void 0,void 0,!0)):a.data.attribute===gb.enums.BinningParams.ACCESS_TYPE.key&&(b.removeFilterValue(gb.enums.BinningParams.DEAL_TYPE.key,void 0,void 0,!0),b.removeFilterValue(gb.enums.BinningParams.PRIME_ACCESS_TYPE.key,void 0,void 0,!0));var l=a.$target,k=l.closest("[data-value]").data("value")||l.find("[data-value]").data("value");
l.closest("[data-isselected]").data("isselected")||l.find("[data-isselected]").data("isselected")?gb.controller.getBottomSheet().close():k&&(k=a.data.attribute===gb.enums.BinningParams.CATEGORIES.key?k.toString():d._getTypeCorrectedData(k),b.setFilterValue(c.attribute,k,c.metrics))}a.$event.preventDefault()},b));g.declarative(gb.enums.WidgetActions.Faceout.TILE_SELECTED,"click",f.wrap(function(a,c,b){a=a.$target.closest("[data-value]").data("value");c.redirectURL&&(b.redirectURL=c.redirectURL,gb.resources.deviceInfo.isApp||
gb.clientName===gb.enums.MobileClients.AW)&&(b.doPageRefresh=!0);b.targetedWidget.title=c.titleOnTargetedWidget;b.targetedWidget.clearTitle=c.titleOnTargetedWidget?!1:!0;var d={disableNavigationToTop:!0,updateTitleOnTargetedWidget:!0};a?(a=a.toString(),b.removeFilterValue(c.attribute,void 0,c.metrics,!0),c.metrics.context=gb.metrics.refTags.filter,b.addFilterValue(c.attribute,a,c.metrics,!1,d)):b.removeFilterValue(c.attribute,void 0,c.metrics,!1,d)},b));g.declarative(gb.enums.WidgetActions.Faceout.SHOVEL,
"click",f.wrap(function(a,c){if(a.data.buttonStatus!==gb.enums.ShovlConstants.DISABLED){var b=parseInt(a.data.currentPage,10),b=a.data.actionType===gb.enums.ShovlConstants.SHOVL_NEXT?b+1:b-1;a=parseInt(a.data.totalPages,10);1<=b&&b<=a&&(gb.controller.widgetCurrentPage[c.widgetID]=b,c=gb.widgets[c.widgetID],a=c._fetchWidgetConfigs(),a.animateShoveling=!0,c.renderShovlButtonsContent(a))}},b));g.declarative(gb.enums.WidgetActions.Filter.CLEAR_ALL,"click",f.wrap(function(a,c,b){c.metrics.context=gb.metrics.refTags.clearFilter;
this._handleTitleChange(b);b.removeAllFilterValues(null,null,c.metrics)},b));g.declarative("gbfilter-pagination","click",f.wrap(function(a,c,b){var f=parseInt(a.data.currentPage,10),k=parseInt(a.data.totalPages,10),g=a.$target.closest("[data-page]").data("page");parseInt(g,10)||(g=void 0);a.$event.preventDefault();g||(a=a.$target[0].href&&a.$target[0].href.split("#")[1],a===d._paginationDummyUrls.PREV&&1<f?g=f-1:a===d._paginationDummyUrls.NEXT&&f<k&&(g=f+1));g&&(gb.controller.widgetCurrentPage[c.widgetID]=
g,b.setFilterValue(c.attribute,g,c.metrics))},b))}),_getFilterOptionList:function(d,b){var a=this,c=[],e=gb.filterControllerFactory.getFilterController(b.widgetName).models[b.widgetGroupID];if("all"===d[0]){d=f.keys(e.availableFilterOptions);d.push(gb.enums.BinningParams.PAGE.key);var l=e.attributesList,k=f.keys(a._staticFilterAttrToValues),k=f.union(k,[gb.enums.BinningParams.REVIEW_RATING.key,gb.enums.BinningParams.FREE_SHIPPING_ELIGIBLE_ONLY.key]);d=f.union(d,f.intersection(l,k))}f.each(d,function(d){var f;
f=a._staticFilterAttrToValues[d]?a._getStaticBinningResponse(d):e.availableFilterOptions[d]||{};d=gb.filterUtils.getFilterOptions(d,f,{widgetID:b.widgetID,widgetGroupID:b.widgetGroupID,widgetName:b.widgetName,totalPages:b.totalPages});Array.prototype.push.apply(c,d)});return c},_populateStaticFilterValues:function(){this._staticFilterAttrToValues[gb.enums.BinningParams.DEAL_STATE.key]=gb.enums.DealStates;this._staticFilterAttrToValues[gb.enums.BinningParams.DEAL_TYPE.key]=gb.enums.DealTypes;this._staticFilterAttrToValues[gb.enums.BinningParams.ACCESS_TYPE.key]=
gb.enums.DealAccessTypes;this._staticFilterAttrToValues[gb.enums.BinningParams.PRIME_ACCESS_TYPE.key]={PRIME_EARLY_ACCESS:"PRIME_EARLY_ACCESS",PRIME_ONLY_BD:"PRIME_ONLY_BD",PRIME_ONLY_DOTD:"PRIME_ONLY_DOTD",PRIME_ONLY_LD:"PRIME_ONLY_LD"}},_getStaticBinningResponse:function(d){d=f.values(this._staticFilterAttrToValues[d]);return f.object(f.map(f.values(d),function(b){return[b,1]}))}})});q.declare("gb-bottomsheet-view");q.when("A","GoldboxMobile3PAssets").register("gb-watch-deal-view",function(g,h){return g.createClass({defaults:{isWatchDealPopupRendered:null,
domain:null,key:null,watchDealPopupHandler:null},init:function(){this.domain=gb.enums.WatchDealViewKeys.GOLDBOX_DOMAIN;this.key=gb.enums.WatchDealViewKeys.DISMISS_WATCHPOPUP_KEY;this.isWatchDealPopupRendered=!1;this._handleWatchUnwatchActions();g.on.afterLoad(function(){gb.controller.watchDealView&&!gb.controller.watchDealView.isWatchDealPopupRendered&&gb.controller.watchDealView.changeWatchPopupState(gb.enums.WatchDealPopoverActions.SHOW_WATCH_POPUP)&&(gb.controller.watchDealView.isWatchDealPopupRendered=
!0)})},_handleWatchUnwatchActions:h._.once(function(){g.on("a:popover:dismiss:watch_preload",function(f){f=gb.controller.watchDealView;f.changeWatchPopupState(gb.enums.WatchDealPopoverActions.HIDE_WATCH_POPUP);gb.watchDealService.modifyPopupStatus({action:gb.enums.SembuActions.SET_COOKIE,type:gb.enums.DataTypes.BOOL,value:1,key:f.key,domain:f.domain});gb.resources.customerData.isWatchDealPopupMarked=!0});q.when("A","a-popover","ready").execute(function(f,d){gb.controller.watchDealView.watchDealPopupHandler=
d})}),changeWatchPopupState:function(f){if(gb.controller.watchDealView.watchDealPopupHandler){var d=gb.controller.watchDealView.watchDealPopupHandler.get(g.$("#"+gb.enums.WatchDealViewIDs.WATCH_POPOVER));if(d){switch(f){case gb.enums.WatchDealPopoverActions.SHOW_WATCH_POPUP:d.lock().show();break;case gb.enums.WatchDealPopoverActions.HIDE_WATCH_POPUP:d.unlock().hide();break;case gb.enums.WatchDealPopoverActions.UPDATE_WATCH_POPUP:d.lock().show().updatePosition()}return!0}}return!1},resetWatchDealVariables:function(){gb.controller.watchDealView.changeWatchPopupState(gb.enums.WatchDealPopoverActions.HIDE_WATCH_POPUP)&&
(gb.controller.watchDealView.isWatchDealPopupRendered=!1)},triggerMouseEventsOnWatchingDeal:function(f,d,b){"mouseenter"===b?(d.find("#"+gb.enums.WatchDealViewIDs.WATCH_BUTTON_TEXT+f).html(gb.resources.getString("gb_stop_watching_deal")),d.find("#"+gb.enums.WatchDealViewIDs.WATCHING_IMAGE+f).removeClass("watchingImage").addClass("stopWatchingImage"),d.find(".watchingText").removeClass("watchingText").addClass("stopWatchingText")):"mouseleave"===b&&(d.find("#"+gb.enums.WatchDealViewIDs.WATCH_BUTTON_TEXT+
f).html(gb.resources.getString("gb_watching_deal")),d.find("#"+gb.enums.WatchDealViewIDs.WATCHING_IMAGE+f).removeClass("stopWatchingImage").addClass("watchingImage"),d.find(".stopWatchingText").removeClass("stopWatchingText").addClass("watchingText"))},_isPopupTriggerRequired:function(f){return!(gb.resources.customerData.isWatchDealPopupMarked||gb.controller.watchDealView.isWatchDealPopupRendered)&&gb.controller.schedulingParams[f.widgetID].fetchWatchedDeals},_isPopupTriggerRequiredForMiniDP:function(f){return!gb.resources.customerData.isWatchDealPopupMarked&&
gb.controller.schedulingParams[f.widgetID].fetchWatchedDeals}})});q.when("A","GoldboxMobile3PAssets","gb-event-emitter").register("gb-metadata",function(g,n,f){var d=n._;return f.extend({sortedDealIDs:{},sortedGiveawayDealIDs:{},dealIDLocations:{},selectedDealsCount:{},binningInfo:{},dealsByType:{},dealsByState:{},dealsByAccessType:{},metadataResponse:{},watchedDeals:{},customResponseAttributes:{},dealCategoryHash:{},init:function(){this._super();this.registerConnections()},registerConnections:function(){this.on("ConsumeMetadataChange",
this.updateMetadata);this.on("RefreshWatchedDealWidgets",this.updateWatchDealWidgets)},parseSortedDealIDs:function(b,a){var c=gb.controller.schedulingParams[b],e=c.prioritizedDealIDs;gb.controller.isPaginatedMetadataCall(b)?e.length&&(b=this.dealsByState[gb.enums.DealStates.AVAILABLE],a.sortedDealIDs=d.intersection(a.sortedDealIDs,b)):(e.length&&(b=a.dealsByState[gb.enums.DealStates.AVAILABLE],e=d.intersection(e,b),e.length&&(a.sortedDealIDs=d.union(e,a.sortedDealIDs))),c.enforceLimitedDeals&&(a.sortedDealIDs=
a.sortedDealIDs.slice(0,c.pageSize)))},registerMetadata:function(b,a,c){"undefined"===typeof c&&(c=!0);this.metadataResponse[b]=a;var e=gb.controller.schedulingParams[b];e.enableDeDuping&&(a.sortedDealIDs=this.deDupeDeals(a.sortedDealIDs,b));if(gb.controller.isPaginatedMetadataCall(b)){this.sortedDealIDs[b]=a.sortedDealIDs||[];this.sortedGiveawayDealIDs[b]=this.sortedGiveawayDealIDs[b]||a.sortedGiveawayDealIDs||[];d.isEmpty(this.sortedGiveawayDealIDs[b])||gb.utils.mergeGiveawayWithGdmResponse(a,this.sortedGiveawayDealIDs[b],
e,b);if(!e.enforceLimitedDeals){var f=a.selectedDealsCount?parseInt(a.selectedDealsCount,10):0,k=e.pageSize,g=0;1<e.page&&e.fetchSinglePage&&(g=(e.page-1)*k);this.sortedDealIDs[b]=gb.utils.getExtendedArray(f,this.sortedDealIDs[b],g)}this._registerCustomResponseAttributes(b,a.customResponseAttributes);a.binning&&(this.binningInfo[b]=a.binning);gb.controller.totalDealsToShow[b]=this.getAllDisplayableDealIDs(b).length}else this.registerSortedDealIDs(b,a),this.registerDealCategoryHashMap(a),this.populateIsDigitalDeals();
this.registerDealIDLocations(b);this.selectedDealsCount[b]=parseInt(a.selectedDealsCount,10)||0;gb.controller.trigger("WidgetPageUpdate",b,c)},registerSortedDealIDs:function(b,a){var c=this,e=gb.controller.widgetCurrentStatus[b],f=gb.controller.widgetCurrentCategory[b],k=a.dealsByState[e.toUpperCase()]||[];c.sortedDealIDs[b]={};c.sortedDealIDs[b][e]={};e===gb.enums.StatusFilters.AVAILABLE?(k=k.concat(a.dealsByState.UPCOMING||[]),c._isWidgetScheduledWithDOTD(b)&&!gb.utils.isWidgetWithStatusFilter(gb.widgets[b].widgetName)&&
(k=k.concat(a.dealsByState.SOLDOUT))):e===gb.enums.StatusFilters.MISSED&&(k=a.dealsByState[e.toUpperCase()]||[],k=k.concat(a.dealsByState.SOLDOUT));var g=gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS;f!==gb.enums.CategoryFilters.ALL&&f!==g?k=d.intersection(k,a.dealsByCategory[f]):f===g&&(k=d.intersection(k,c.metadataResponse.dealsByAccessType[g]));c.sortedDealIDs[b][e][f]=d.intersection(a.sortedDealIDs,k);d.each(c.sortedDealIDs[b][e][f],function(a,d){c.registerDealIDLocation(a,b,e,f,d)})},registerDealIDLocations:function(b){var a=
this;gb.controller.isPaginatedMetadataCall(b)?d.each(a.sortedDealIDs[b],function(c,d){a.dealIDLocations[c]=a.dealIDLocations[c]||{};a.dealIDLocations[c][b]=d}):d.each(a.sortedDealIDs[b],function(c,e){d.each(c,function(c,f){d.each(c,function(c,d){a.registerDealIDLocation(c,b,e,f,d)})})})},registerDealCategoryHashMap:function(b){var a=this;d.each(b.dealsByCategory,function(c,b){d.each(c,function(c){a.dealCategoryHash[c]||(a.dealCategoryHash[c]=[]);-1===d.indexOf(a.dealCategoryHash[c],b)&&a.dealCategoryHash[c].push(b)})})},
populateIsDigitalDeals:function(){d.each(this.dealCategoryHash,function(b,a){gb.controller.getDealDAO(a).isDigital=gb.utils.hasDigitalCategory(b)})},registerWatchedDeals:function(b){var a=d.flatten(b);b[gb.enums.Constants.ALL]=a;this.watchedDeals=b;d.each(a,function(a){gb.controller.getDealDAO(a).isDealWatched=!0})},_registerCustomResponseAttributes:function(b,a){var c={};a&&!d.isEmpty(a.dealsWithBids)&&(c.dealsWithBids=this._updateDealsWithBids(a.dealsWithBids));this.customResponseAttributes[b]=
c},_updateDealsWithBids:function(b,a){var c=a||{};d.each(b,function(a,b){c[b]={adId:a.adId,logId:a.logId,qualifier:a.qualifier}});return c},updateWatchedDeals:function(b){var a,c,e=this.watchedDeals;c=gb.controller.dealDAOs[b];a=d.keys(gb.widgets);c.isDealWatched?(c=gb.enums.WatchedDealStateMap.UPCOMING,e.ALL=d.union(e.ALL,[b]),e[c]=e[c]||[],e[c]=d.union(e[c],[b])):(c=gb.enums.WatchedDealStateMap[c.dealState],e.ALL=d.without(e.ALL,b),e[c]=d.without(e[c],b));this.trigger("RefreshWatchedDealWidgets",
a,b)},refreshWatchedDeals:function(b){var a=this,c=gb.metrics.generateRef(b,gb.metrics.refTags.getWatchedDeals,["ALL"]);gb.service.getWatchedDeals(function(c,b,f){gb.metadata.registerWatchedDeals(c);c=d.keys(gb.widgets);d.each(c,function(c){var b=gb.controller.schedulingParams[c];if(b.watchedDealsWidget||gb.utils.isWatchedDealsTab(c))b=gb.utils.getWatchedDealWidgetData(b.dealStates),a.registerMetadata(c,b)})},function(){var a=gb.utils.getWatchedDealWidgetData(gb.controller.schedulingParams[b].dealStates);
gb.metadata.registerMetadata(b,a,!0)},c)},updateWatchDealWidgets:function(b,a){var c=this,e=gb.controller.dealDAOs[a],f=gb.enums.WatchedDealStateMap[e.dealState],k=!1,g=gb.metadata.watchedDeals.ALL.length;if(0===g||1===g&&e.isDealWatched)k=!0;d.each(b,function(b){var g=gb.controller.schedulingParams[b];if(g.watchedDealsWidget||gb.utils.isWatchedDealsTab(b)){var p=gb.utils.getWatchedDealStates(g.dealStates),g=c.getAllDisplayableDealIDs(b),n=d.indexOf(g,a);if((p=d.contains(p,f))||-1!==n){var q=!0;p&&
e.isDealWatched&&-1===n?g.unshift(a):e.isDealWatched&&p||-1===n?q=!1:g.splice(n,1);if(q){var w={sortedDealIDs:g,selectedDealsCount:g.length,dealsByState:{}};w.dealsByState[gb.enums.DealStates.AVAILABLE]=g;gb.widgets[b].dealViews[a]&&gb.metadata.watchedDeals.ALL&&gb.metadata.watchedDeals.ALL.length?(d.each(gb.widgets[b].dealViews[a],function(a){a.viewElement.slideUp(200)}),h.setTimeout(function(){c.registerMetadata(b,w)},200)):c.registerMetadata(b,w)}}else k&&gb.controller.trigger("WidgetPageUpdate",
b,!0)}})},getSortedDealIDs:function(b,a){a||(a=gb.controller.widgetCurrentPage[b]||0);var c=gb.controller.schedulingParams[b],d=2;gb.configManager.getWidgetViewConfig(b).fetchSinglePageDeals&&(d=1);var f=c.pageSize||0;a=f*(a-1);d=a+f*d;return(b=this.getAllDisplayableDealIDs(b))?c.enforceLimitedDeals?b:b.slice(a,d):[]},getAllDisplayableDealIDs:function(b){var a=[];if(gb.controller.isPaginatedMetadataCall(b)){var a=this.sortedDealIDs[b],c=this.dealsByType[gb.enums.DealTypes.DOTD]||[],e=this.dealsByAccessType[gb.enums.DealAccessTypes.PRIME_ONLY_DOTD]||
[],f=gb.controller.schedulingParams[b];f.enforceLimitedDeals&&f.showDoubleCellDOTD&&(a=this._rearrangeDealIds(b,a,d.union(c,e)));return a||[]}c=gb.controller.widgetCurrentStatus[b];e=gb.controller.widgetCurrentCategory[b];c&&e&&this.sortedDealIDs[b][c]&&this.sortedDealIDs[b][c][e]&&(a=this.sortedDealIDs[b][c][e]);return this._insertBlankDealIDs(b,a||[])},getMetadataCategories:function(b){var a=[];if(!gb.controller.isPaginatedMetadataCall(b)){var c=gb.controller.widgetCurrentStatus[b];this.metadataResponse[b]&&
(this.registerFullMetadata(this.metadataResponse[b],b),this.metadataResponse[b]=null);for(var d=0;d<gb.resources.categories.length;d++){var f=gb.resources.categories[d].nodeId;this.sortedDealIDs[b][c]&&this.sortedDealIDs[b][c][f]&&a.push(f)}}return a},getDealIDPosition:function(b,a){if(b){b=this.dealIDLocations[b];if(gb.controller.isPaginatedMetadataCall(a))return b[a];var c=gb.controller.widgetCurrentStatus[a],d=gb.controller.widgetCurrentCategory[a];if(b&&b[a]&&b[a][c]&&null!==b[a][c][d]&&void 0!==
b[a][c][d])return b[a][c][d]}return-1},_insertBlankDealIDs:function(b,a){var c,d=gb.controller.widgetCurrentPage[b],f=gb.controller.schedulingParams[b].pageSize;gb.widgets[b]&&gb.widgets[b].widgetGroupID&&this.selectedDealsCount[b]>a.length&&(c=gb.utils.getExtendedArray(this.selectedDealsCount[b],a,f*(d-1)));return c||a},updateMetadata:function(b,a,c,e){var f=gb.widgets[b],g=gb.controller.schedulingParams[b],p=e.metaParams,h=gb.filterControllerFactory.getFilterController(f.widgetName);d.isEmpty(this.sortedGiveawayDealIDs[b])||
gb.utils.mergeGiveawayWithGdmResponse(a,this.sortedGiveawayDealIDs[b],g,b,e);if(p&&p.callDataArray)gb.widgetHelper.callBins[b][p.callID]=a.sortedDealIDs||[],g.enableDeDuping&&(gb.widgetHelper.callBins[b][p.callID]=this.deDupeDeals(gb.widgetHelper.callBins[b][p.callID],b)),this.sortedDealIDs[b]=gb.widgetHelper.buildSortedDealsArray(b,f.dealsPerRow),gb.widgetHelper.callID[b]++,gb.widgetHelper.fetchCallDataArrayDeals(b);else if(g.enableDeDuping&&(a.sortedDealIDs=this.deDupeDeals(a.sortedDealIDs,b)),
p&&p.isPageChange){var n=this.sortedDealIDs[b];e=e.dealsPerPage?e.dealsPerPage:g.pageSize;g=(a.page-1)*e;a=this.restrictDeals(b,a,e);this.sortedDealIDs[b]=gb.utils.getExtendedArray(a.selectedDealsCount,a.sortedDealIDs,g,n);this._updateCustomResponseAttributes(b,a,p.isPageChange);a.binning=this.getBinningInfo(b)}else a=this.restrictDeals(b,a),this._updateCustomResponseAttributes(b,a),this.sortedDealIDs[b]=gb.utils.getExtendedArray(a.selectedDealsCount,a.sortedDealIDs);this.selectedDealsCount[b]=this.sortedDealIDs[b].length;
this.binningInfo[b]=a.binning;this.registerDealIDLocations(b);(f=f.widgetGroupID)&&h.models[f].populateAvailableFilters(a.binning);"function"===typeof c&&c(b)},_updateCustomResponseAttributes:function(b,a,c){var e=this.customResponseAttributes[b]||{};if(!c||d.isEmpty(e))this._registerCustomResponseAttributes(b,a.customResponseAttributes);else{b=e.dealsWithBids;var f;a.customResponseAttributes&&(f=a.customResponseAttributes.dealsWithBids);this._updateDealsWithBids(f,b)}},getDOTDCount:function(b){return d.intersection(d.union(this.dealsByType[gb.enums.DealTypes.DOTD]||
[],this.dealsByAccessType[gb.enums.DealAccessTypes.PRIME_ONLY_DOTD]||[]),b).length},getBinningInfo:function(b){return this.binningInfo[b]},isCurrentWindowFull:function(b,a,c){if(!(this.sortedDealIDs[b]&&this.sortedDealIDs[b]instanceof Array))return!1;a=(a-1)*c;b=this.sortedDealIDs[b].slice(a,a+c);for(c=0;c<b.length;)if(!b[c++])return!1;return!0},_rearrangeDealIds:function(b,a,c){c=d.intersection(a,c);var e=gb.widgets[b].dealsPerRow,f=0;0<c.length&&d.each(c,function(b){f+=1;b=d.indexOf(a,b);if(0===
(b+f)%e&&b<a.length){var g=1;if(!(b+g>=a.length)){for(;d.contains(c,a[b+g])&&!(g++,b+g>=a.length););b+g<a.length&&(g=a.splice(b+g,1),a.splice(b,0,g))}}});return a},registerFullMetadata:function(b,a){var c=gb.enums.StatusFilters;this.sortedDealIDs[a][c.AVAILABLE]={};this.sortedDealIDs[a][c.UPCOMING]={};this.sortedDealIDs[a][c.MISSED]={};var e=b.dealsByState.AVAILABLE||[],f=b.dealsByState.UPCOMING||[],g=b.dealsByState.EXPIRED||[],e=e.concat(f);this._isWidgetScheduledWithDOTD(a)&&!gb.utils.isWidgetWithStatusFilter(gb.widgets[a].widgetName)?
e=e.concat(b.dealsByState.SOLDOUT):g=g.concat(b.dealsByState.SOLDOUT);this.sortedDealIDs[a][c.MISSED][gb.enums.CategoryFilters.ALL]=d.intersection(b.sortedDealIDs,g);this.sortedDealIDs[a][c.UPCOMING][gb.enums.CategoryFilters.ALL]=d.intersection(b.sortedDealIDs,f);this.sortedDealIDs[a][c.AVAILABLE][gb.enums.CategoryFilters.ALL]=d.intersection(b.sortedDealIDs,e);this.registerCategories(b,a);this.registerDealIDLocations(a)},registerCategories:function(b,a){for(var c=gb.enums.StatusFilters,e=gb.enums.CategoryFilters,
f=this.sortedDealIDs[a][c.AVAILABLE][e.ALL],g=this.sortedDealIDs[a][c.UPCOMING][e.ALL],e=this.sortedDealIDs[a][c.MISSED][e.ALL],h=1;h<gb.resources.categories.length;h++){var n=gb.resources.categories[h].nodeId;b.dealsByCategory[n]&&(this.sortedDealIDs[a][c.AVAILABLE][n]=d.intersection(f,b.dealsByCategory[n]),this.sortedDealIDs[a][c.UPCOMING][n]=d.intersection(g,b.dealsByCategory[n]),this.sortedDealIDs[a][c.MISSED][n]=d.intersection(e,b.dealsByCategory[n]))}h=gb.enums.DealAccessTypes.PRIME_EARLY_ACCESS;
if(b=b.dealsByAccessType[h])this.sortedDealIDs[a][c.AVAILABLE][h]=d.intersection(f,b),this.sortedDealIDs[a][c.UPCOMING][h]=d.intersection(g,b),this.sortedDealIDs[a][c.MISSED][h]=d.intersection(e,b)},registerDealIDLocation:function(b,a,c,d,f){this.dealIDLocations[b]||(this.dealIDLocations[b]={});this.dealIDLocations[b][a]||(this.dealIDLocations[b][a]={});this.dealIDLocations[b][a][c]||(this.dealIDLocations[b][a][c]={});this.dealIDLocations[b][a][c][d]=f},_isWidgetScheduledWithDOTD:function(b){var a=
!1;d.contains(gb.controller.schedulingParams[b].dealTypes,gb.enums.DealTypes.DOTD)&&(a=!0);return a},deDupeDeals:function(b,a){var c=this;d.each(gb.widgets,function(e){if(e.widgetID!==a||gb.controller.schedulingParams[a].enforceLimitedDeals)b=d.difference(b,c.sortedDealIDs[e.widgetID])});return b},restrictDeals:function(b,a,c){var d=gb.controller.schedulingParams[b];b=a.page;var d=(d=d.widgetTabConfig[d.widgetCurrentTab])?d.launchCellIndex:0,f;c&&b&&(f=c*(b-1));d&&a.selectedDealsCount>d&&(a.selectedDealsCount=
d,f&&d>f&&(d-=f),a.sortedDealIDs.splice(d));return a}})});q.when("A","gb-resources","GoldboxMobile3PAssets","gb-csm").register("gb-service",function(g,n,f,d){var b=f._;return g.createClass({clientID:"",customerID:"",statusPollTimeoutValue:2E3,statusPollCache:[],getDealsTimeoutValue:500,getDealsCache:[],dealsWithDetails:{},maxDealIDsLength:12,getDealsMaxJitter:null,apis:{GDM:{name:"GetDealMetadata",maxRetries:3,baseRetryInterval:4E3,ajaxTimeout:6E4},GDS:{name:"GetDealStatus",maxRetries:0,baseRetryInterval:12E3,
ajaxTimeout:6E4},GD:{name:"GetDeals",maxRetries:3,baseRetryInterval:4E3,ajaxTimeout:6E4},CD:{name:"ClaimDeal",maxRetries:2,baseRetryInterval:1E4,ajaxTimeout:6E4},WD:{name:"WatchDeal",maxRetries:2,baseRetryInterval:1E4,ajaxTimeout:6E4},GWD:{name:"GetWatchedDeals",maxRetries:0,baseRetryInterval:0},RFN:{name:"RegisterForNotifications",maxRetries:2,baseRetryInterval:1E4},PICASSO_CLICKS:{name:"picasso",maxRetries:0,baseRetryInterval:0},FWC:{name:"FetchWidgetConfig",maxRetries:0,baseRetryInterval:0}},TYPE_NAME_MAP:{SponsoredDealAttributes:"SponsoredDealsRequestAttributes:http://internal.amazon.com/coral/com.amazon.dcs.model.v2/"},
init:function(){var a=this;n.when("gbResources").execute(function(){a.registerConfigs()})},registerConfigs:function(){this.marketplaceID=gb.resources.getCustomerData("marketplaceId");this.sessionID=gb.resources.getCustomerData("sessionId");this.customerID=gb.resources.getCustomerData("customerId");this.getDealsMaxJitter=gb.enums.Constants.GET_DEALS_MAX_JITTER;this.clientID=gb.enums.ClientIDPrefix+"_"+gb.clientName;this.overrideAPIConfigsFromG2S2()},_ajaxWithRetries:function(a,c,e){var f=this,k=new Date,
p=0,n=f.apis[a],q=c.retry,D=c.error;e.retry&&p++;delete c.error;delete c.retry;n.ajaxTimeout&&(c.timeout=n.ajaxTimeout);(function t(){c.url=gb.utils.setUrlParam(c.url,"nocache",(new Date).getTime());var a=c.success;c.success=function(g,n,q){"function"===typeof q.getResponseHeader&&q.getResponseHeader("X-CSRFToken")&&(gb.resources.customerData.csrfToken=q.getResponseHeader("X-CSRFToken"));if(g&&g.forceRefresh)h.location.reload();else if(g&&gb.utils.parseBool(g.retry))c.error();else if(b.isNull(g))d.logWarning(Error("Ajax Request returned null response. Headers:"+
q.getAllResponseHeaders())),c.error();else{var u=0<p;e.latency=(new Date).getTime()-k.getTime();f._recordAPIMetrics(u,!0,e);a(g,n,q)}};c.error=function(a,b){var d=0<p;e.latency=(new Date).getTime()-k.getTime();f._recordAPIMetrics(d,!1,e);c.url=gb.utils.setUrlParam(c.url,"retrying",1);"timeout"===b&&f._recordAPITimeoutMetrics(p);++p>n.maxRetries?(b="Request failing for "+e.apiName+".",d&&(b=b+" Retry number: "+p),D(Error(b+JSON.stringify(a)))):(a=f.getRetryInterval(p,n),"function"===typeof q&&q(),
h.setTimeout(t,a))};g.$.ajax(c)})()},_buildAjaxRequestParams:function(a,c,b,d,f){a={success:b.success,error:b.error,retry:b.retry,url:a,type:"POST",dataType:"json"};f&&(a.dataType=f);b.beforeSend&&(a.beforeSend=b.beforeSend);a.data=d?JSON.stringify(c):c;return a},getRetryInterval:function(a,c){return Math.pow(2,a-1)*(c.baseRetryInterval+gb.utils.getRandomNumber(-1E3,1E3))},callAPI:function(a,c,b,d){for(var f=[],g=0;g<c.length;g++)f.length===this.maxDealIDsLength&&(this[a](f,b,d),f=[]),f.push(c[g]);
if(f.length)this[a](f,b,d)},getGetDealStatusRequestParam:function(a){a=a.sort();a=b.map(a,function(a){return{dealID:a}});a={requestMetadata:{marketplaceID:this.marketplaceID,clientID:this.clientID},dealTargets:a,responseSize:"STATUS_ONLY",itemResponseSize:"DEFAULT_WITH_PREEMPTIVE_LEAKING"};this.customerID&&(a.requestMetadata.customerID=this.customerID);this.sessionID&&(a.requestMetadata.sessionID=this.sessionID);return a},GetDealStatusCall:function(a){if(a.length&&!gb.resources.isAcceleratedExperience){var c=
this,e=gb.enums.Constants.AJAX_ENDPOINT+this.apis.GDS.name,f=this.getGetDealStatusRequestParam(a),g={apiName:this.apis.GDS.name},e=this._buildAjaxRequestParams(e,f,{success:function(c){var e=(new Date).getTime();b.each(a,function(a){var b=gb.controller.getDealDAO(a);c&&c.dealStatus&&c.dealStatus[a]?(a=c.dealStatus[a],a.responseTimestamp=e,gb.translator.trigger("PopulateStatus",b,a)):d.logFatal(Error("Requested deal ids missing in the Deal Content Service GetDealStatus response. DCS DealStatus missing for deal id - "+
a))})},error:function(d){b.each(a,function(a){var b=gb.controller.dealDAOs[a],d=b.status.timeouts,e=b.status.cache.lastMsCacheTtl||c.apis.GDS.baseRetryInterval;e&&gb.watcher.dealsInView&&gb.watcher.dealsInView[b.dealID]&&(h.clearTimeout(d.cacheExpires),d.cacheExpires=h.setTimeout(function(){c.pollDealStatus(a)},e))})}},!0);this._ajaxWithRetries("GDS",e,g)}},getGetDealsRequestParam:function(a,c){var d=!1,f=null,g=null;c&&(d=c.excludeCustomerID?c.excludeCustomerID:!1,c.widgetID&&(g=c.widgetID,f=gb.controller.schedulingParams[c.widgetID].eventID));
a=a.sort();a=b.map(a,function(a){return{dealID:a}});a={requestMetadata:{marketplaceID:this.marketplaceID,clientID:this.clientID},dealTargets:a,responseSize:"ALL",itemResponseSize:"DEFAULT_WITH_PREEMPTIVE_LEAKING"};!d&&this.customerID&&(a.requestMetadata.customerID=this.customerID);this.sessionID&&(a.requestMetadata.sessionID=this.sessionID);f&&(a.extendedAttributes=["hideAddToCart"]);g&&(a.widgetContext=this._getRequestParamsWidgetContext(g));return a},GetDealsCall:function(a,c,e){if(a.length){var f=
gb.enums.Constants.AJAX_ENDPOINT+this.apis.GD.name,g=this.getGetDealsRequestParam(a,c);c={apiName:this.apis.GD.name};f=this._buildAjaxRequestParams(f,g,{success:function(c){var f=(new Date).getTime();b.each(a,function(a){var b=gb.controller.getDealDAO(a);c&&c.dealStatus&&c.dealStatus[a]?(c.dealStatus[a].responseTimestamp=f,gb.translator.trigger("PopulateDealDAO",b,c.dealDetails[a],c.dealStatus[a])):d.logFatal(Error("Requested deal ids missing in the Deal Content Service GetDealStatus response. DCS DealStatus missing for deal id - "+
a))});"function"===typeof e&&e(a)},error:function(a){throw a;}},!0);this._ajaxWithRetries("GD",f,c)}},getDealDetails:function(a){var c=this;b.contains(c.getDealsCache,a)||(c.getDealsCache.push(a),1===c.getDealsCache.length&&(a=Math.floor(Math.random()*c.getDealsMaxJitter*1E3),a+=c.getDealsTimeoutValue,h.setTimeout(function(){var a=[];b.each(c.getDealsCache,function(b){c.dealsWithDetails[b]||a.push(b)});c.getDealsCache=[];c.callAPI("GetDealsCall",a,{})},a)))},pollDealStatus:function(a){var c=this,
d=gb.controller.getDealDAO(a);d.dealType===gb.enums.DealTypes.EVENT||b.contains(c.statusPollCache,a)||gb.enums.DealStatesToFilterStates[d.dealState]===gb.enums.FilterStates.MISSED||(c.statusPollCache.push(a),1===c.statusPollCache.length&&h.setTimeout(function(){var a=new Date,f=[];b.each(c.statusPollCache,function(c){var b=d.status.dates.cacheExpires;0<=a.getTime()-b.getTime()&&f.push(c)});c.statusPollCache=[];c.callAPI("GetDealStatusCall",f)},c.statusPollTimeoutValue))},fetchDeals:function(a,c,d){var f=
this,g=new Date,h=[],n=[];b.each(a,function(a){a&&(f.dealsWithDetails[a]?gb.controller.getDealDAO(a).status.dates.cacheExpires.getTime()<=g.getTime()&&n.push(a):h.push(a))});"function"===typeof d&&d(b.difference(a,h));f.callAPI("GetDealsCall",h,{widgetID:c},d);f.callAPI("GetDealStatusCall",n)},claimDeal:function(a,c,b,d,f){var g={apiName:this.apis.CD.name};a=this._buildAjaxRequestParams(gb.enums.AJAXLinks.CD+f,{dealId:a.dealID,itemId:a.asin,clientId:this.clientID},{success:c,error:b,retry:d,beforeSend:function(a){a.setRequestHeader("X-CSRFToken",
gb.resources.customerData.csrfToken)}});this._ajaxWithRetries("CD",a,g)},logPicassoClick:function(a){var c={apiName:this.apis.PICASSO_CLICKS.name},b=function(a){};a=this._buildAjaxRequestParams(gb.enums.AJAXLinks.PICASSO_CLICKS,{action:"clickNoRedirect",qualifier:a.qualifier,id:a.id,adId:a.adId,widgetName:a.widgetName},{success:b,error:b},!1,"text");this._ajaxWithRetries("PICASSO_CLICKS",a,c)},watchDeal:function(a,c,b,d,f,g){var h=gb.enums.AJAXLinks.WATCH_DEAL+g;g={apiName:this.apis.WD.name};a={watchAction:c,
dealId:a,clientId:this.clientID};gb.clientName!==gb.enums.MobileClients.PC&&gb.resources.customerData.isWatchedDealFirstRun&&(a.isWatchedDealFirstRun=!0);b=this._buildAjaxRequestParams(h,a,{success:b,error:d,retry:f,beforeSend:function(a){a.setRequestHeader("X-CSRFToken",gb.resources.customerData.csrfToken)}},!1);this._ajaxWithRetries("WD",b,g)},registerForNotifications:function(a,c,b){var d={apiName:this.apis.RFN.name};a=this._buildAjaxRequestParams(gb.enums.AJAXLinks.SUBSCRIBE_MNSS+"gb_mshop?customer\x3d"+
this.customerID+"\x26sessionId\x3d"+this.sessionID+"\x26token\x3d"+a.pushToken+"\x26application\x3d"+a.appID+"\x26protocol\x3d"+a.protocol,{},{success:c,error:b},!0);this._ajaxWithRetries("RFN",a,d)},getWatchedDeals:function(a,c,b){if(gb.service.customerID){var d={apiName:this.apis.GWD.name};a=this._buildAjaxRequestParams(gb.enums.AJAXLinks.GET_WATCHED+b,{},{success:a,error:function(){"function"===typeof c&&c();throw Error("Ajax call to fetch watched deals failed");}},!1);this._ajaxWithRetries("GWD",
a,d)}else"function"===typeof c&&c()},fetchWidgetConfig:function(a,c){var b={apiName:this.apis.FWC.name};c=this._buildAjaxRequestParams(gb.enums.AJAXLinks.FWC,{config_name:a},{success:c,error:function(){q.log("Attempts to lazy load the widget: "+a+" have failed!","ERROR","GoldboxMobileAssets")}},!1);this._ajaxWithRetries("FWC",c,b)},fetchDealWithData:function(a,c,d){var f=this;c=gb.utils.validateFetchParam(a,c);c.dealsPerPage&&0<c.dealsPerPage?f.GetDealMetadataCall(a,c,function(g){c.priorityDeal&&
f.pushBuyBoxDealIDinGDMResponse(c.priorityDeal,g);var h=[],n=b.clone(g.sortedDealIDs);c.getDealsSize&&(n=n.slice(0,c.getDealsSize));f.fetchDeals(n,a,function(f){h=b.union(h,f);h.length===n.length&&gb.metadata.trigger("ConsumeMetadataChange",a,g,d,c)})}):d(a)},GetDealMetadataCall:function(a,c,b){var d=gb.enums.Constants.AJAX_ENDPOINT+this.apis.GDM.name,f=this.getGetDealMetadataRequestParam(a,c),g={apiName:this.apis.GDM.name};f.version===gb.enums.Constants.PAGINATED_METADATA_VERSION&&(g.version=f.version);
c.isServersideGDMRetried&&(g.retry=!0);c=this._buildAjaxRequestParams(d,f,{success:function(c){var d=gb.controller.schedulingParams[a];gb.widgets[a].isGDMFailing=!1;gb.widgets[a].isRetryInProgress=!1;d&&d.maxLimitDeals&&c&&c.selectedDealsCount>d.maxLimitDeals&&(c.selectedDealsCount=d.maxLimitDeals);b(c)},error:function(c){gb.widgets[a].isGDMFailing=!0;gb.widgets[a].isRetryInProgress=!1;gb.widgets[a].showExcessiveTrafficMessage();throw c;},retry:function(){gb.widgets[a].isGDMFailing=!0;gb.widgets[a].isRetryInProgress=
!0;gb.widgets[a].showExcessiveTrafficMessage()}},!0);this._ajaxWithRetries("GDM",c,g)},getGetDealMetadataRequestParam:function(a,c){var d={requestMetadata:{clientID:this.clientID,marketplaceID:this.marketplaceID,sessionID:this.sessionID},queryProfile:{},sortOrder:gb.enums.SortOrders.BY_SCORE,version:gb.enums.Constants.PAGINATED_METADATA_VERSION,page:1,dealsPerPage:0};this.customerID&&(d.requestMetadata.customerID=this.customerID);var f=gb.controller.schedulingParams[a];f.isInterestWidget&&this.updateGDMRequestParamForInterestWidget(a,
d,f);var g={enforcedCategories:"includedCategories",enforcedDealIDs:"includedDealIDs",enforcedMerchantIDs:"merchantIDs",expiredDealsDisplayDuration:"expiredDealLookBackHours",exclusiveTargetArray:"exclusiveTargetValues",inclusiveTargetArray:"inclusiveTargetValues"};b.each("brands dealGroups dealStates dealTypes enforcedCategories excludedCategories enforcedDealIDs enforcedMerchantIDs excludedDealIDs excludedExtendedFilters excludedItemIDs exclusiveTargetArray expiredDealsDisplayDuration extendedFilters enforcedAccessTypes excludedAccessTypes includedAccessTypes includedCategories includedDealIDs inclusiveTargetTypes inclusiveTargetArray interests itemIDs merchantIDs includedBins eventID featuredOnly freeShippingEligibleOnly globalEligibleOnly maxPercentOff maxPrice minDuration minPercentOff minPrice minRating primeAccessType primeEligibleOnly fromTime toTime discountRanges priceRanges featuredDealsElevationSize".split(" "),
function(a){if("includedBins"!==a||!(f.eventID&&!f.isInterestWidget||c.metaParams&&c.metaParams.isPageChange)){var h=f[a];g[a]&&(a=g[a]);b.isObject(h)?b.isEmpty(h)||(h=gb.utils.removeNulls(h))&&(d.queryProfile[a]=h):h&&(d.queryProfile[a]=h)}});f.dealDisplay&&f.dealStatesDD&&(d.queryProfile.dealStates=f.dealStatesDD);f.expiringWithin&&0<f.expiringWithin&&(d.queryProfile.expiringWithin=f.expiringWithin);d.sortOrder=this._getRequestSortOrder(f.sortOrder,f.rankingStrategy);d.page=c.page;d.dealsPerPage=
c.dealsPerPage;d.widgetContext=this._getRequestParamsWidgetContext(a);d.customRequestAttributes=this._getCustomRequestAttributes(d.sortOrder,f.customRequestAttributes);d=gb.utils.sortRequestObj("",d);this._excludePrimeDOTDFromLDList(d);return d},_getRequestParamsWidgetContext:function(a){var c={},d=gb.controller.contentMetadata;b.isEmpty(d)||(d.pageType&&(c.pageType=d.pageType),d.subPageType&&(c.subPageType=d.subPageType),d.deviceType&&(c.deviceType=d.deviceType),d.originRef&&(c.refTag=d.originRef),
d.originRID&&(c.refRID=d.originRID),d.browseNode&&(c.pageTypeID=d.browseNode));a=gb.metrics.widgetMetricsParams[a];b.isEmpty(a)||(a.placementID&&(c.widgetID=a.placementID),a.slotName&&(c.slotName=a.slotName));return c},_getCustomRequestAttributes:function(a,c){var b=null;c=c.SponsoredDealAttributes;a===gb.enums.RankingStrategies.BY_CUSTOM_CRITERION&&c&&(b={__type:this.TYPE_NAME_MAP.SponsoredDealAttributes,populateSponsoredDealAttributes:!0},b.interestBasedAdsOptOut="true"===gb.utils.getCookie(gb.enums.Cookies.apnPrivacy)||
!1,b.widgetName=c.widgetName,b.ipAddress=gb.resources.deviceInfo.ipAddress||null,b.experimentName=c.experimentName||null,b.experiments=c.experiments);return b},_excludePrimeDOTDFromLDList:function(a){a=a.queryProfile;if(a.dealTypes){var b=!1,d=a.dealTypes,f,g=0,h=d.length;a:for(;g<h;g++)if(f=d[g],f===gb.enums.DealTypes.LD)b=!0;else if(f===gb.enums.DealTypes.DOTD){b=!1;break a}b&&(a.excludedExtendedFilters||(a.excludedExtendedFilters={}),a.excludedExtendedFilters.MARKETING_ID?a.excludedExtendedFilters.MARKETING_ID.push("PRIME_ONLY_DOTD"):
a.excludedExtendedFilters={MARKETING_ID:["PRIME_ONLY_DOTD"]})}},_getRequestSortOrder:function(a,c){return b.contains(b.values(gb.enums.RankingStrategies),c)&&a===gb.enums.SortOrders.BY_SCORE?c:a},_generateAPIMetricName:function(a,b,d){var f="goldbox:";d.apiName&&(f+=d.apiName,d.version&&(f=f+":"+d.version),f=f+":"+(b?"success":"error")+":"+(a?"retry":"noretry"));f=f+":"+this.clientID;return f.toLowerCase()},_recordAPIMetrics:function(a,b,e){if(a=this._generateAPIMetricName(a,b,e))d.incrementCounter(a),
e.latency&&d.recordLatency(a,e.latency)},pushBuyBoxDealIDinGDMResponse:function(a,c){var d=c.sortedDealIDs;if(d&&d.length){var f=b.indexOf(d,a);0<=f&&(d.splice(f,1),c.selectedDealsCount--);d.unshift(a);c.selectedDealsCount++}else c.sortedDealIDs=[a],c.selectedDealsCount=1},overrideAPIConfigsFromG2S2:function(){var a=this,c=gb.resources.getAPIConfigs();b.isEmpty(c)||b.each(c,function(c){b.each(c,function(c,d){b.extend(a.apis[d],c)})})},_recordAPITimeoutMetrics:function(a){d.incrementCounter("goldbox:ajaxTimeout:retry_"+
a.toString()+":"+this.clientID)},updateGDMRequestParamForInterestWidget:function(a,b,d){a=gb.configManager.getWidgetViewConfig(a);b.requestMetadata={clientID:this.clientID,marketplaceID:this.marketplaceID};d.interests=null;d.eventID=null;d.sortOrder=a.sortOrder},fetchFaceoutFitlerConfig:function(a,b,d,f,g){var h=gb.configManager.getWidgetViewConfig(a),h={dealsPerPage:h.preFetchGDMDeals,getDealsSize:h.pageSize,page:h.page};"undefined"!==b.schedulingParams.filterConfig&&"undefined"!==b.schedulingParams.filterConfig[0]&&
(b.schedulingParams.includedBins=gb.utils.getIncludedBins(b.schedulingParams.filterConfig),this.GetDealMetadataCall(a,h,function(h){h=gb.utils.fetchFaceoutConfigFromWhitelistedInterests(a,b.schedulingParams,h);b.schedulingParams.filterConfig[0].faceoutConfig=h;d[a]=b.schedulingParams.filterConfig;f._updateWidgetGroup(g)}))}})});q.when("A").register("gb-watch-deal-service",function(g){return g.createClass({modifyPopupStatus:function(h,f){g.post(gb.enums.AJAXLinks.UPDATE_EMBU,{success:f,error:function(){throw Error("get/set status of watchdeal popup failed");
},params:{action:h.action,key:h.key},dataType:"json"})},addWatchedDealOnLoginRedirect:function(g){if(gb.resources.deviceInfo.isApp)gb.resources.deviceInfo.isPhone?(g=encodeURIComponent(h.location.href.replace(/^http:/,"https:")),h.location.href=gb.utils.setUrlParam(gb.resources.urls.app_login_url,"openid.return_to",g)):(g=gb.utils.getWindowLocationOrigin(),h.location.href=gb.utils.setUrlParam(g,"app-action","login"));else{var f=gb.resources.getUrl("watching_login_redirect"),f=f.replace(/%257BmarketplaceID%257D/,
gb.resources.customerData.marketplaceId);h.location.href=f.replace(/%257BdealID%257D/,g)}}})});q.when("A","gb-csm").register("gb-notifications",function(g,n){return g.createClass({pushNotificationInfo:{},init:function(){this.getPushNotificationInfo()},subscribeNotifications:function(){this.getAppNotificationStatus()&&gb.service.registerForNotifications(this.pushNotificationInfo,function(){},function(){})},getPushNotificationInfo:function(f){var d=this;q.when("mash").execute(function(b){h.amazon.mash.privateAPI&&
h.amazon.mash.privateAPI.getPushNotificationInfo({successCallback:function(a){d.pushNotificationInfo=a;"function"===typeof f&&f()},failCallback:function(a){n.incrementCounter("goldboxDetailDeviceTokenUnavailable")}})})},invokePushNotificationInterstitial:function(f){var d=this;q.when("mash").execute(function(b){cordova.require("cordova/exec")(function(){gb.controller.getPushNotificationInfo(function(){d.subscribeNotifications();f()})},function(){f()},"PushNotificationsIOS","invokePushNotificationInterstitial",
[gb.resources.getString("gb-interstitial-title"),gb.resources.getString("gb-interstitial-subtitle"),"http://g-ec2.images-amazon.com/images/G/01/golbox/mshop/INTERSTITIAL_1X._V293550351_.png",["DEALS:waitlist"]])})},getAppNotificationStatus:function(){return"object"===typeof this.pushNotificationInfo&&!g.objectIsEmpty(this.pushNotificationInfo)}})});q.when("A","GoldboxMobile3PAssets").register("gb-watcher",function(g,n){var f=n._;return g.createClass({viewPort:{},dealsInView:{},lowestDealIDWatchedIndex:{},
changePage:function(d,b){var a=this;a.viewPort[d]=a.viewPort[d]||[];a.lowestDealIDWatchedIndex[d]=a.lowestDealIDWatchedIndex[d]||0;var c=f.compact(gb.metadata.getSortedDealIDs(d)),e=f.difference(a.viewPort[d],c),g=f.difference(c,a.viewPort[d]);a.viewPort[d]=c;c=f.last(c);c=gb.metadata.getDealIDPosition(c,d);c>a.lowestDealIDWatchedIndex[d]&&(a.lowestDealIDWatchedIndex[d]=c);f.each(e,function(b){a.dealsInView[b]&&(a.dealsInView[b][d]=null,delete a.dealsInView[b][d],f.isEmpty(a.dealsInView[b])&&(a.dealsInView[b]=
null,delete a.dealsInView[b]))});f.each(g,function(b){a.dealsInView[b]=a.dealsInView[b]||{};var c=gb.metadata.getDealIDPosition(b,d);-1!==c&&(a.dealsInView[b][d]=c)});a.unwireStatusRefresh(e);a.wireStatusRefresh(g);b()},wireStatusRefresh:function(d){var b=new Date;f.each(d,function(a){var c=gb.controller.getDealDAO(a);(a=c.status.dates.cacheExpires)&&c.dealType!==gb.enums.DealTypes.EVENT&&(a=a.getTime()-b.getTime(),c.status.timeouts.cacheExpires=gb.utils.setSafeTimeout(function(){gb.service.pollDealStatus(c.dealID)},
0>a?1:a))})},unwireStatusRefresh:function(d){f.each(d,function(b){b=gb.controller.getDealDAO(b);b.status.timeouts.cacheExpires&&(h.clearTimeout(b.status.timeouts.cacheExpires),b.status.timeouts.cacheExpires=null)})}})});q.when("A","GoldboxMobile3PAssets").register("gb-garbage-collector",function(g,n){var f=n._;return g.createClass({init:function(){this.garbageCollectedDealView={}},clearDealViews:function(d,b){!d||f.isEmpty(gb.widgets)||f.isEmpty(gb.widgets[d])||f.isEmpty(gb.widgets[d].dealViews)||
(void 0===b&&(b=f.keys(gb.widgets[d].dealViews),gb.widgets[d].nextPositionToRender=0),f.each(b,function(a){gb.widgets[d].dealViews[a]&&(f.each(gb.widgets[d].dealViews[a],function(b,e){b.clock&&(h.clearTimeout(b.clock.timeout),b.clock=null);gb.widgets[d].dealViews[a][e]=null;delete gb.widgets[d].dealViews[a][e]}),delete gb.widgets[d].dealViews[a])}))},deepCleanDealViews:function(d,b){if(d&&!f.isEmpty(gb.widgets)&&!f.isEmpty(gb.widgets[d])&&!f.isEmpty(gb.widgets[d].dealViews)&&b&&!f.isEmpty(b)){var a=
[],c=gb.widgets[d],e;this.garbageCollectedDealView[d]||(this.garbageCollectedDealView[d]={});var g=this,k;f.each(b,function(b){c.dealViews[b]&&(a.push(b),g.garbageCollectedDealView[d][b]||(g.garbageCollectedDealView[d][b]={}),f.each(c.dealViews[b],function(a,c){var f=g.garbageCollectedDealView[d][b][c];(k=gb.utils.removeImage(a.viewElement))&&!f&&(e={imageContent:k.imageContent,imageContainer:k.imageContainer,dealObject:a},a.clock&&(f=gb.configManager.getWidgetViewConfig(d),a=a.clock,e.clock={dealDate:a.dealDate,
viewElement:a.viewElement,spanID:a.spanID,forceApplyIncartTimer:f.forceApplyIncartTimer}),g.garbageCollectedDealView[d][b][c]=e)}))});this.clearDealViews(d,a)}},clearViewPort:function(d){!d||f.isEmpty(gb.widgets)||f.isEmpty(gb.widgets[d])||null===gb.widgets[d].viewPortManager||(gb.subnavController&&gb.widgets[d].viewPortManager.clearHeaderInSubnav(),gb.widgets[d].viewPortManager.detachScroll(),gb.widgets[d].viewPortManager=null)},reRenderGCElement:function(d,b,a){if(d&&b&&!f.isNaN(parseInt(a,10))){var c=
this.garbageCollectedDealView[d];if(c&&c[b]&&c[b][a]){var e=c[b][a],g=e.dealObject;e.imageContainer.html(e.imageContent);e.clock&&(e=e.clock,g.clock=gb.utils.heroTimer(e.dealDate,e.viewElement,e.spanID,e.forceApplyIncartTimer));delete c[b][a];f.isEmpty(c[b])&&delete c[b];f.isEmpty(c)&&delete this.garbageCollectedDealView[d];return g}}}})});q.when("A","GoldboxMobile3PAssets","gb-event-emitter","gb-deal-dao","gb-csm","gb-enums","gb-config-manager","gb-resources","gb-watcher","gb-filter-controller-factory",
"gb-garbage-collector","gb-metadata","gb-widget-factory","gb-service","gb-watch-deal-service","gb-notifications","gb-base-utils","gb-link-generator","gb-metrics","gb-share-manager","gb-metrics-manager","gb-utilities","gb-widget-clientside-helper","gb-template-manager","gb-dcs-translator","gb-view-component-builder","gb-watch-deal-view","gb-prime-utils","gb-accessibility","gb-badge-utils","gb-filter-utils","gb-bottomsheet-view").register("gb-controller",function(g,n,f,d,b,a,c,e,l,k,p,u,r,D,C,t,w,y,
z,B,A,m,x,E,G,H,J,K,I,F,P,M){var v=n._;return f.extend({nextWidgetID:100,schedulingParams:{},dealDAOs:{},totalDealsToShow:{},totalDisplayableDealsCount:{},widgetCurrentPage:{},widgetCurrentCategory:{},widgetCurrentStatus:{},widgetFilters:{},widgetName:{},pageOrientation:null,clientName:null,useHtmlRefineButton:!1,buyingDeals:{},bottomSheet:null,originRID:null,popOverVisible:!1,watchDealView:null,pageScrollHandled:!1,contentMetadata:{pageType:null,subPageType:null,originRef:null,originRID:null,deviceType:null},
init:function(a){this._super(a);gb.widgets={};this.contentMetadata.pageType=a.contentMetadata.pageType;this.contentMetadata.subPageType=a.contentMetadata.subPageType;this.contentMetadata.originRef=a.contentMetadata.refTag;this.contentMetadata.originRID=a.contentMetadata.originRID;this.contentMetadata.deviceType=a.contentMetadata.deviceType;this.instantiateFramework();this._handleActions();this.registerConnections();q.when("A","jQuery").execute(function(a,b){b(h).unload(function(){var a=!1,a=v.any(gb.widgets,
function(a){return a.isEventsWidget()});a||(a=gb.utils.setUrlParam(h.location.href,"nocache",(new Date).getTime()),gb.utils.pushAddressInBrowserHistory(a));gb.metricsManager.reportImpression()})});g.$(h).bind("popstate",function(a){var b,c=gb.controller.bottomSheet;c&&(b=g.$("."+c.elClasses.container).length);b?gb.globalFlags.ignoreBottomSheet||c.close():v.isEmpty(a.originalEvent.state)||a.originalEvent.state.attribution!==gb.enums.BrowserHistory.ATTRIBUTION||location.reload();gb.globalFlags.ignoreBottomSheet=
!1})},instantiateFramework:function(){gb.globalFlags={};gb.enums=a;gb.resources=e;gb.baseUtils=w;gb.utils=m;gb.primeUtils=K;gb.badgeUtils=F;gb.metrics=gb.metrics||new z;gb.configManager=c;gb.templateManager=E;gb.metadata=new u;gb.service=new D;gb.translator=new G;gb.viewComponentBuilder=new H;gb.watcher=new l;gb.garbageCollector=new p;gb.metricsManager=new A;gb.widgetViewFactory=new r;gb.notifications=new t;gb.filterControllerFactory=k;gb.accessibility=new I;gb.filterUtils=P;gb.widgetMetadata=gb.widgetMetadata||
{};gb.csm=gb.csm?v.extend(gb.csm,b):b;q.register("GBEventManager",function(){return new f})},registerConnections:function(){this.on("WidgetPageUpdate",this.updatePage);this.on("WidgetPageScroll",this.updateDealsInWidgetPage);this.on("WidgetResize",this.updateDealsInWidgetPage);this.on("WidgetCategoryChange",this.changeCategory);this.on("WidgetStatusChange",this.changeStatus);this.on("WidgetLoaded",this._postWidgetLoaded)},registerWidget:function(a){var b=this,c=a.widgetName;a.resources&&gb.resources.registerResources(a.resources,
c);a.inlinedImage&&gb.resources.registerImages(a.inlinedImage);gb.resources.when(a.config_name).execute(function(){b.bootstrapWidget(a)});a.schedulingParams.isATFWidget||gb.resources.hasResourceFetchInitiated[c]||(gb.resources.hasResourceFetchInitiated[c]=!0,gb.service.fetchWidgetConfig(a.config_name,function(a){gb.resources.registerResources(a,c)}))},bootstrapWidget:function(a){var b=gb.filterControllerFactory.getFilterController(a.widgetName);v.isEmpty(gb.metadata.watchedDeals)&&a.watchedDeals&&
gb.metadata.registerWatchedDeals(a.watchedDeals);var c=null;isNaN(parseInt(a.schedulingParams.watchedDealsTab,10))||(c=parseInt(a.schedulingParams.watchedDealsTab,10));if(a.schedulingParams.watchedDealsWidget||null!==c&&c===a.schedulingParams.widgetCurrentTab)a.dcsServerResponse=gb.utils.getWatchedDealWidgetData(a.schedulingParams.dealStates);var d=a.dcsServerResponse||{};d.sortedDealIDs=d.sortedDealIDs||[];d.customResponseAttributes=d.customResponseAttributes||{};d.dealsByCategory=d.dealsByCategory||
{};d.dealsByAccessType=d.dealsByAccessType||{};d.dealsByState=d.dealsByState||{};d.binning=d.binning||{};a.dcsServerResponse=d;c=(this.nextWidgetID++).toString();gb.widgetMetadata[c]=a.widgetMetadata;gb.widgetMetadata[c].widgetID=c;if(a.schedulingParams.maxJitter){var e=parseInt(a.schedulingParams.maxJitter,10);e&&e>gb.enums.Constants.GET_DEALS_MAX_JITTER&&e>gb.service.getDealsMaxJitter&&(gb.service.getDealsMaxJitter=e)}d.selectedDealsCount=isNaN(parseInt(d.selectedDealsCount,10))?0:parseInt(d.selectedDealsCount,
10);this.totalDealsToShow[c]=d.selectedDealsCount;this.totalDisplayableDealsCount[c]=d.selectedDealsCount;this.widgetName[c]=a.widgetName;this.registerSchedulingParams(c,a.schedulingParams,gb.configManager.getWidgetViewConfig(c).dcsMetadataVersion);e=this.schedulingParams[c];a.schedulingParams=e;a.widgetID=c;e.fetchWatchedDeals&&(gb.controller.getWatchDealService(),gb.clientName===gb.enums.MobileClients.PC&&gb.controller.getWatchDealView());this.widgetFilters[c]=e.filterConfig||[];var f=e.widgetGroupID;
gb.widgets[c]=gb.widgetViewFactory.getWidgetView({widgetID:c,widgetGroupID:f,widgetName:a.widgetName,domElementID:a.domElementID,schedulingParams:e});gb.widgets[c].deprecateNoDealMsg=a.gdmServiceLazyLoad;f&&gb.controller.isPaginatedMetadataCall(c)&&v.isEmpty(e.includedBins)&&(e.includedBins=gb.utils.getIncludedBins(e.filterConfig));b.registerFilters(a,c,f);gb.metrics.registerWidgetMetricParams(c,a.domElementID);gb.translator.trigger("PopulateMetadata",c,d);gb.metadata.parseSortedDealIDs(c,d);gb.configManager.getWidgetViewConfig(c).callDataBuilder&&
(gb.widgetHelper=gb.widgetHelper||new x,gb.widgetHelper.registerWidgetData(c,d));this.setInitialFilters(c);e.isInterestWidget&&gb.service.fetchFaceoutFitlerConfig(c,a,this.widgetFilters,b,f);gb.metadata.registerMetadata(c,d);gb.widgetHelper&&gb.widgetHelper.callDataArray[c]&&gb.widgetHelper.fetchCallDataArrayDeals(c);a.gdmServiceLazyLoad&&(delete gb.widgets[c].deprecateNoDealMsg,e.watchedDealsWidget?gb.controller.trigger("WidgetPageUpdate",c,!0):(a.isGDMFailing?(gb.widgets[c].isGDMFailing=!0,gb.widgets[c].isRetryInProgress=
!0,gb.widgets[c].showExcessiveTrafficMessage()):gb.widgets[c].showLoading(),a={page:1,dealsPerPage:gb.configManager.getWidgetViewConfig(c).preFetchGDMDeals,getDealsSize:gb.controller.schedulingParams[c].pageSize,priorityDeal:a.prioritizedBuyboxDealID,isLazyLoadPageCall:!0,isServersideGDMRetried:a.isGDMFailing},this.fetchPage(a,c,!0,function(a,b){gb.controller.trigger("WidgetPageUpdate",a,b)})));this.pageScrollHandled||this._handlePageScroll();this.trigger("WidgetLoaded")},registerSchedulingParams:function(a,
b,c){var d={adSlots:[],allowWidgetRefresh:!1,brands:[],customFilter:null,customRequestAttributes:{},customRestrictionsApply:null,campaignSchedulingParams:{},dealDisplay:{},dealGroups:{},dealStates:[],dealTypes:[],disableMiniDP:!1,disableRestrictionsApply:!1,disableSortFilter:!1,disableStatusFilter:!1,disableWidgetHeader:!1,discountRanges:[],displayFeaturedDeals:!1,enablePagination:!1,enableCategoryRefine:!0,enableDeDuping:!1,enableFilter:!1,enableHidingWidgetHeader:!1,enforcedAccessTypes:[],excludedAccessTypes:[],
enforcedCategories:[],enforcedDealIDs:[],enforcedMerchantIDs:[],enforceLimitedDeals:!1,eventID:null,excludedCategories:[],excludedDealIDs:[],excludedExtendedFilters:{},exclusiveTargetKeys:[],exclusiveTargetValues:[],exclusiveTargetArray:[],expiringWithin:0,expiredDealsDisplayDuration:0,extendedFilters:{},filterConfig:[],featureScope:null,featuredDealsElevationSize:null,fetchSinglePage:!1,fetchWatchedDeals:!1,fromTime:null,freeShippingEligibleOnly:!1,globalEligibleOnly:!1,giveawaySlots:[],includedAccessTypes:[],
includedBins:[],inclusiveTargetKeys:[],inclusiveTargetValues:[],inclusiveTargetArray:[],interests:[],isCritical:!1,isInterestWidget:!1,maxJitter:2,maxLimitDeals:null,minRating:null,noDealsFilterMessage:null,noDealsMessage:null,page:1,pageSize:4,priceRanges:[],primeAccessType:null,primeEligibleOnly:!1,prioritizedDealIDs:[],rankingStrategy:null,redirectLink:null,redirectPageTitle:null,redirectText:null,rowsOfDeals:1,refreshWidgets:null,seeAllText:null,shovelerEndText:null,widgetTabConfig:{},widgetCurrentTab:0,
showAllDealsFaceout:!1,showDoubleCellDOTD:!1,showLaunchCell:!0,showHelpLink:!1,showShortCellView:!1,sortOrder:gb.enums.SortOrders.BY_SCORE,sortOptionsOverride:[],subnavPage:null,subnavPageSlot:null,subTitle:null,title:null,titleRedirectLink:null,titleRedirectText:null,titleWithS:null,toTime:null,watchedDealsWidget:!1,watchedDealsTab:null,widgetAnchorName:null,widgetGroupID:null};v.each(d,function(a,c){null!==b[c]&&void 0!==b[c]&&(d[c]=b[c])});isNaN(parseInt(d.pageSize,10))||(d.pageSize=parseInt(d.pageSize,
10));isNaN(parseInt(d.featuredDealsElevationSize,10))||(d.featuredDealsElevationSize=parseInt(d.featuredDealsElevationSize,10));isNaN(parseInt(d.expiredDealsDisplayDuration,10))||(d.expiredDealsDisplayDuration=parseInt(d.expiredDealsDisplayDuration,10));isNaN(parseInt(d.subnavPage,10))||(d.subnavPage=parseInt(d.subnavPage,10));isNaN(parseInt(d.subnavPageSlot,10))||(d.subnavPageSlot=parseInt(d.subnavPageSlot,10));d.widgetTabConfig&&v.each(d.widgetTabConfig,function(a,b){isNaN(parseInt(a.launchCellIndex,
10))&&(a.launchCellIndex=0)});isNaN(parseInt(d.watchedDealsTab,10))||(d.watchedDealsTab=parseInt(d.watchedDealsTab,10));isNaN(parseInt(d.widgetCurrentTab,10))||(d.widgetCurrentTab=parseInt(d.widgetCurrentTab,10));v.isEmpty(d.adSlots)||d.adSlots.sort(function(a,b){return a.rowNumber<b.rowNumber?-1:a.rowNumber>b.rowNumber?1:0});var e=h.amazon&&h.amazon.mash?!0:!1;d.sortOptionsOverride.length&&!v.contains(d.sortOptionsOverride,d.sortOrder)&&(d.sortOrder=d.sortOptionsOverride[0]);isNaN(parseInt(d.maxLimitDeals,
10))||(d.maxLimitDeals=parseInt(d.maxLimitDeals,10));d.enforceLimitedDeals?(null===d.redirectLink&&(d.redirectLink=(new y(gb.clientName)).generateRedirectLink(d,c)),this.widgetName[a]===gb.enums.WidgetNames.TAB_HERO&&null===d.redirectText&&(d.redirectText=1===d.dealTypes.length&&d.dealTypes[0]===gb.enums.DealTypes.LD?gb.resources.getString("gb_tabhero_ld_redirect_text"):gb.resources.getString("gb_tabhero_bd_redirect_text")),d.redirectLink&&null===d.redirectPageTitle&&(d.redirectPageTitle=d.title),
gb.resources.deviceInfo.isApp&&d.redirectLink&&d.redirectPageTitle&&e&&(d.redirectLink=gb.utils.setUrlParam(d.redirectLink,"app-title",encodeURIComponent(d.redirectPageTitle))),d.redirectLink=gb.utils.enforceUTFEncodingInUrl(d.redirectLink)):gb.controller.widgetName[a]===gb.enums.WidgetNames.HERO&&(d.redirectLink=null,d.redirectText=null,d.redirectPageTitle=null);this.schedulingParams[a]=d},getDealDAO:function(a){this.dealDAOs[a]=this.dealDAOs[a]||new d(a);return this.dealDAOs[a]},updatePage:function(a,
b){gb.watcher.lowestDealIDWatchedIndex[a]&&delete gb.watcher.lowestDealIDWatchedIndex[a];var c=gb.widgets[a];b&&(gb.garbageCollector.clearViewPort(a),c.renderWireFrame());v.isEmpty(gb.controller.schedulingParams[a].adSlots)||(c.nextAdSlotToRenderIndex=0);gb.controller.updateDealsInWidgetPage(a)},updateDealsInWidgetPage:function(a,b){function c(){var b=gb.widgets[a];gb.watcher.changePage(a,function(){b.nextPositionToRender<gb.watcher.lowestDealIDWatchedIndex[a]+1&&b.renderContent();gb.service.fetchDeals(gb.watcher.viewPort[a],
a)})}b=b||this.widgetCurrentPage[a];if(this.isPaginatedMetadataCall(a)&&!gb.metadata.isCurrentWindowFull(a,b,this.schedulingParams[a].pageSize)){var d={page:b,dealsPerPage:gb.configManager.getWidgetViewConfig(a).preFetchGDMDeals,getDealsSize:gb.controller.schedulingParams[a].pageSize};this.fetchPage(d,a,!0,c)}else c();gb.csm&&gb.csm.recordMaxPageDepthReached(a,b)},changeCategory:function(a,b){this.widgetCurrentPage[a]=1;this.widgetCurrentCategory[a]=b;gb.controller.trigger("WidgetPageUpdate",a,!0);
this.updateAppliedFilters(a)},changeStatus:function(a,b){this.widgetCurrentPage[a]=1;this.widgetCurrentStatus[a]=b;this.widgetCurrentCategory[a]=gb.enums.CategoryFilters.ALL;gb.controller.trigger("WidgetPageUpdate",a,!0);this.updateAppliedFilters(a)},refreshDealView:function(a,b){gb.controller.buyingDeals[a]||v.each(gb.widgets,function(c,d){(c=gb.widgets[d].dealViews[a])&&v.each(c,function(a){a.render()});gb.controller.refreshMiniDetailPageView(a,b)})},refreshDealStatusText:function(a,b){v.each(gb.watcher.dealsInView[a],
function(c,d){(c=gb.widgets[d].dealViews[a])&&v.each(c,function(a){a.updateStatusMessage(b)})})},refreshWatchDealStatus:function(a,b){v.each(gb.watcher.dealsInView[a],function(c,d){(c=gb.widgets[d].dealViews[a])&&v.each(c,function(a){a.updateWatchDealStatusMessage(b)})})},refreshMiniDetailPageView:function(a,b){gb.controller.buyingDeals[a]||v.each(gb.watcher.dealsInView[a],function(c,d){var e=gb.widgets[d].dealViews[a];q.when("A","a-modal").execute(function(c,d){v.each(e,function(c){var e=d.get(gb.enums.WidgetViewIDs.MINI_DP_MODAL+
a);c&&e&&e.isActive()&&c.renderMiniDetailPage(b)})})})},fetchPage:function(a,b,c,d){var e={page:a.page,dealsPerPage:a.dealsPerPage,getDealsSize:a.getDealsSize,priorityDeal:a.priorityDeal,isLazyLoadPageCall:a.isLazyLoadPageCall,isServersideGDMRetried:a.isServersideGDMRetried,metaParams:{isPageChange:!a.isLazyLoadPageCall}},f=gb.widgets[b],g=!1;f&&(!c||f.viewPortManager&&!a.isLazyLoadPageCall||(g=!0),gb.service.fetchDealWithData(b,e,function(){d&&d(b,g)}))},getLoginURL:function(a,b){if(gb.resources.deviceInfo.isApp){if(gb.resources.deviceInfo.isPhone)return a=
encodeURIComponent(h.location.href.replace(/^http:/,"https:")),gb.utils.setUrlParam(gb.resources.urls.app_login_url,"openid.return_to",a);a=gb.utils.getWindowLocationOrigin();return gb.utils.setUrlParam(a,"app-action","login")}if(gb.clientName!==gb.enums.MobileClients.AW){var c=gb.resources.urls.login_url,c=c.replace(/%257BdealID%257D/,a),c=c.replace(/%257Basin%257D/,b);return c=c.replace(/%257BmarketplaceID%257D/,gb.resources.customerData.marketplaceId)}},_updateNavCartQty:function(a){h.navbar&&
"function"===typeof h.navbar.setCartCount&&h.navbar.setCartCount(a);q.when("mash").execute(function(b){b.cart.didUpdate({newCartQuantity:parseInt(a,10)})})},_showErrorOnAjaxFail:function(a){var b=this.dealDAOs[a];delete this.buyingDeals[a];b.checkingDealStatus=!1;this.refreshDealView(a);q.when("mash").execute(function(a){a.showAlert({message:gb.resources.getString("gb_problem_adding_item_to_cart"),buttonTitles:[gb.resources.getString("gb_ok")],successCallback:g.$.noop})})},processActionableClick:function(a){var b=
this,c=a.dealID,d=b.dealDAOs[c],e=a.dealType,f=gb.utils.getWindowLocationOrigin(),k=a.asin,l=gb.metrics.generateRef(a.widgetID,a.action||gb.metrics.refTags.addToCart,[c]),m=gb.widgets[a.widgetID].widgetGroupID,p=gb.widgets[a.widgetID];"function"===typeof p.removeErrorMessage&&p.removeErrorMessage();if(!b.buyingDeals[c])if(e!==gb.enums.DealTypes.LD||gb.service.customerID)if(b.buyingDeals[c]=!0,e===gb.enums.DealTypes.EVENT)e=gb.metrics.addMetricsParams(gb.enums.AJAXLinks.ADD_TO_CART,a.widgetID,gb.metrics.refTags.addToCart,
[c,m]),g.post(e,{params:{offerID:a.offerID,quantity:a.quantity,asin:a.asin,dealId:c},success:function(a){delete b.buyingDeals[c];d.checkingDealStatus=!1;a.success&&(d.isAddedToCart=!0,d.addActionMessage=d.postActionMessage=gb.resources.getString("gb_item_added_to_cart"),b._updateNavCartQty(a.itemsInCart));b.refreshDealView(c)},error:function(){delete b.buyingDeals[c];d.checkingDealStatus=!1;d.postActionMessage=gb.resources.getString("gb-cart-error");b.refreshDealView(c)}});else if(d.detail.accessType!==
gb.enums.DealAccessTypes.PRIME_ONLY_DOTD&&e===gb.enums.DealTypes.LD)gb.service.claimDeal(a,function(e){delete b.buyingDeals[c];if(e){var f=gb.translator.translateClaimDealStatus(d,a.asin,e);f.responseTimestamp=(new Date).getTime();d.inCartAsin=a.asin;gb.translator.trigger("PopulateStatus",d,f,b._registerDealWithNotifier);b.redemptionResponseHandler(d,a.asin,e.currentCartQuantity)}else d.checkingDealStatus=!1,b.refreshDealView(c)},function(a){delete b.buyingDeals[c];d.checkingDealStatus=!1;(a=gb.resources.getString("csld-all_retries_failed"))?
(b.refreshDealStatusText(c,a),h.setTimeout(function(){b.refreshDealView(c)},3E3)):b.refreshDealView(c)},function(){var a=gb.resources.getString("csld-retrying_deal_status");a&&b.refreshDealStatusText(c,a)},l);else if(d.detail.accessType===gb.enums.DealAccessTypes.PRIME_ONLY_DOTD)gb.service.claimDeal(a,function(a){delete b.buyingDeals[c];d.checkingDealStatus=!1;a&&(a.errorCode===gb.enums.Constants.NON_RETRYABLE_QUANTITY_RESTRICTION_VIOLATION_ERROR?(d.postActionMessage=gb.resources.getString("gb-podotd-quantity-restriction-violated-msg"),
d.isOfferingRestrictionViolated=!0):d.postActionMessage=gb.resources.getString("gb-added-to-cart"),b._updateNavCartQty(a.currentCartQuantity));b.refreshDealView(c)},function(a){delete b.buyingDeals[c];d.checkingDealStatus=!1;(a=gb.resources.getString("csld-all_retries_failed"))?(b.refreshDealStatusText(c,a),h.setTimeout(function(){b.refreshDealView(c)},3E3)):b.refreshDealView(c)},function(){var a=gb.resources.getString("csld-retrying_deal_status");a&&b.refreshDealStatusText(c,a)},l);else if(gb.resources.deviceInfo.doesAppHaveURLInterception){var e=
gb.enums.AJAXLinks.ADD_TO_CART,n=gb.enums.MiscLinks.CART_URL;g.post(e,{params:{offerID:a.offerID,quantity:a.quantity,asin:a.asin,dealId:c},success:function(a){delete b.buyingDeals[c];d.checkingDealStatus=!1;a.success?(d.isAddedToCart=!0,d.addActionMessage=gb.resources.getString("gb_item_added_to_cart"),amazon.mash.cart.didUpdate({newCartQuantity:parseInt(a.itemsInCart,10)}),gb.resources.deviceInfo.isIPad&&(h.location.href=decodeURIComponent(n)),b.refreshDealView(c),gb.resources.deviceInfo.isAndroid&&
amazon.mash.showAlert({message:gb.resources.getString("gb_item_added_to_cart"),buttonTitles:[gb.resources.getString("gb_continue_shopping"),gb.resources.getString("gb_go_to_cart")],successCallback:function(a){1===a&&(h.location.href=decodeURIComponent(n))}})):b._showErrorOnAjaxFail(c)},error:function(){b._showErrorOnAjaxFail(c)}})}else gb.resources.deviceInfo.isApp?(f=gb.utils.setUrlParam(f,"app-action","add-to-cart"),f=gb.utils.setUrlParam(f,"ref",l),f=gb.utils.setUrlParam(f,"asin",a.asin),f=gb.utils.setUrlParam(f,
"offer-id",a.offerID),f=gb.utils.setUrlParam(f,"clickstream-tag","Deal"),h.location.href=decodeURIComponent(f),delete b.buyingDeals[c],d.checkingDealStatus=!1,b.refreshDealView(c)):(e=gb.metrics.addMetricsParams(gb.enums.AJAXLinks.ADD_TO_CART,a.widgetID,gb.metrics.refTags.addToCart,[c,m]),g.post(e,{params:{offerID:a.offerID,quantity:a.quantity,asin:a.asin,dealId:c},success:function(e){if(e){delete b.buyingDeals[c];d.checkingDealStatus=!1;if(e.success)d.postActionMessage=gb.resources.getString("gb-added-to-cart"),
b._updateNavCartQty(e.itemsInCart);else{d.cartError=!0;var f=gb.widgets[a.widgetID],g;e.cartItem&&e.cartItem.statusList&&(g=e.cartItem.statusList);!v.isEmpty(g)&&gb.utils.isOfferingRestrictionViolated(g)?(d.postActionMessage=gb.resources.getString("gb-quantity-restriction-violated",{quantityLimit:e.cartItem.quantityRestriction}),d.isOfferingRestrictionViolated=!0):"function"===typeof f.renderErrorMessage&&f.renderErrorMessage()}b.refreshDealView(c)}},error:function(){delete b.buyingDeals[c];d.checkingDealStatus=
!1;d.cartError=!0;var e=gb.widgets[a.widgetID];"function"===typeof e.renderErrorMessage&&e.renderErrorMessage();b.refreshDealView(c)}}));else f=b.getLoginURL(c,k),h.location.href=f,d.checkingDealStatus=!1,b.refreshDealView(c)},redemptionResponseHandler:function(a,b,c){var d=a.customerState;a.detail.itemType===gb.enums.ItemTypes.VARIATION&&(b=a.getAsinDAO(b))&&(d=b.status.customerState);d===gb.enums.CustomerStates.INCART?(this._updateNavCartQty(c),q.when("jQuery").execute(function(b){b("#"+gb.enums.ChangeoverID.AddedToCart+
a.dealID).show()})):d===gb.enums.CustomerStates.INWAITLIST&&(q.when("jQuery").execute(function(b){b("#"+gb.enums.ChangeoverID.Waitlisted+a.dealID).show()}),"object"!==typeof gb.controller.pushNotificationInfo||v.isEmpty(gb.controller.pushNotificationInfo)||gb.notifications.subscribeNotifications())},_registerDealWithNotifier:function(a){h.dealNotifier&&(a.legacyDeal=new GBDealNotifier.Model.Deal(a.dealID),a.legacyDeal._loadStatusFromDealDAO(a),dealNotifier.registerDeal(a.inCartAsin,a.legacyDeal))},
watchDeal:function(a,b){var c=this;gb.utils.getWindowLocationOrigin();var d=c.dealDAOs[b],e=g.$("#"+gb.enums.ChangeoverID.Subnav),f;if(!0!==d.processWatchAction)if(gb.service.customerID){d.processWatchAction=!0;c.refreshDealView(b);var k=gb.enums.WatchDealActions.ADD,l=gb.metrics.refTags.watchDeal;c.dealDAOs[b].isDealWatched&&(k=gb.enums.WatchDealActions.REMOVE,l=gb.metrics.refTags.unWatchDeal);l=gb.metrics.generateRef(a,l,[b]);gb.service.watchDeal(b,k,function(g,l,h){d.processWatchAction=!1;c.closeBottomSheet();
k===gb.enums.WatchDealActions.ADD?(d.isDealWatched=!0,f=gb.resources.getString("gb_watching_deal")):(d.isDealWatched=!1,f=gb.resources.getString("gb_stopped_watching"));c.refreshDealView(b);gb.metadata.updateWatchedDeals(b);0<e.length&&(e.find("strong").text(f),e.show());if(gb.resources.deviceInfo.isApp&&!gb.resources.isMobileNotificationSubscriptionDisabled)if(gb.resources.deviceInfo.isAppVersionHigher)d.isDealWatched&&(gb.notifications.subscribeNotifications(),gb.resources.customerData.isWatchedDealFirstRun&&
c.renderWatchDealFirstrun(a));else if(k===gb.enums.WatchDealActions.ADD){var m=gb.utils.getAppStoreURL();m&&q.when("mash").execute(function(a){a.showAlert({message:gb.resources.getString("gb-reminders-msg-old-app"),buttonTitles:[gb.resources.getString("gb-go-to-app-store"),gb.resources.getString("gb_continue_shopping")],successCallback:function(b){0===b&&a.canLaunchIntentURL({url:m,successCallback:function(b){b&&a.launchIntentURL({url:m})}})}})})}},function(a){(a=gb.resources.getString("csld-all_retries_failed"))?
(c.refreshWatchDealStatus(b,a),d.processWatchAction=!1,h.setTimeout(function(){c.refreshDealView(b)},3E3)):c.refreshDealView(b)},function(){var a=gb.resources.getString("gb_watch_this_deal_failed_retrying");a&&c.refreshWatchDealStatus(b,a)},l)}else gb.watchDealService.addWatchedDealOnLoginRedirect(b),d.processWatchAction=!1,c.refreshDealView(b)},addItemToWishList:function(a){var b=this,c=a.dealID,d=a.asin;gb.resources.customerData.customerId?g.post("/gp/mobile/deals/ajax/addToWishList.html?asin\x3d"+
d,{success:function(a){if(a.isAddedToWishList)b.dealDAOs[c].addActionMessage=gb.resources.getString("gb_added_to_wishlist"),b.dealDAOs[c].isAddedToWishList=!0;else if(a.isDuplicateAdd)b.dealDAOs[c].addActionMessage=gb.resources.getString("gb_already_in_wishlist"),b.dealDAOs[c].isAddedToWishList=!0;else if(a.isAuthError){b.addToWishListOnLoginRedirect(d);return}b.dealDAOs[c].addingToWishList=!1;b.dealDAOs[c].defaultRegistryID=a.defaultRegistryID;b.refreshDealView(c)},error:function(){h.location.href=
"/gp/registry/wishlist"}}):b.addToWishListOnLoginRedirect(d)},addToWishListOnLoginRedirect:function(a){var b=gb.resources.getUrl("wishlist_login_redirect");h.location.href=b.replace(/%257BdealID%257D/,a)},updateAppliedFilters:function(a){this.schedulingParams[a].enablePagination&&(gb.utils.updateFiltersInAddressBar(a,this.widgetCurrentPage[a],this.widgetCurrentCategory[a],this.widgetCurrentStatus[a]),gb.widgets[a].scrollToWidgetTop())},setPreviouslyAppliedFilters:function(a,b){b=gb.utils.getHashOfAppliedFilters(b);
this.widgetCurrentPage[a]=parseInt(b[gb.enums.CustomerAppliedFilters.PAGE],10);this.widgetCurrentCategory[a]=b[gb.enums.CustomerAppliedFilters.CATEGORY];this.widgetCurrentStatus[a]=b[gb.enums.CustomerAppliedFilters.STATUS]},isPaginatedMetadataCall:function(a){if(gb.configManager.getWidgetViewConfig(a).dcsMetadataVersion===gb.enums.Constants.PAGINATED_METADATA_VERSION||gb.controller.schedulingParams[a].eventID)return!0},setInitialFilters:function(a){this.widgetCurrentPage[a]=this.schedulingParams[a].page;
this.widgetCurrentCategory[a]=gb.enums.CategoryFilters.ALL;this.widgetCurrentStatus[a]=gb.enums.StatusFilters.AVAILABLE;if(this.schedulingParams[a].enablePagination){var b=gb.utils.getParamValueFromUrl(h.location.href,gb.enums.BrowserHistory.STATE_KEY+a);b&&this.setPreviouslyAppliedFilters(a,b)}},getShareManager:function(){gb.shareManager||(gb.shareManager=new B);return gb.shareManager},getBottomSheet:function(){if(null===this.bottomSheet)try{this.bottomSheet=new M}catch(a){q.log("BottomSheet works only on mobile platfrom!",
"ERROR","GoldboxMobileAssets")}this.removeWatchDealFirstrun();return this.bottomSheet},closeBottomSheet:function(){this.bottomSheet&&this.bottomSheet.close()},getWatchDealView:function(){this.watchDealView||(this.watchDealView=new J);return this.watchDealView},getWatchDealService:function(){gb.watchDealService||(gb.watchDealService=new C);return gb.watchDealService},renderWatchDealFirstrun:function(a){var b=g.$;if(gb.resources.customerData.isWatchedDealFirstRun&&(gb.resources.customerData.isWatchedDealFirstRun=
!1,gb.resources.deviceInfo.isPhone&&gb.subnavController&&gb.subnavController.subnavContainer.length)){var c=function(){var c=gb.templateManager.getWidgetHTML({widgetID:a,templateGroup:gb.templateManager.TemplateGroups.WIDGET_VIEW,templateName:"bottomPopover",data:{message:gb.resources.getString("gb_m_watch_deal_firstrun")}}),d=b(c);gb.subnavController.subnavContainer.after(d);d.slideDown(gb.enums.AnimationDurations.WATCH_DEAL);c=function(a){d.slideUp(gb.enums.AnimationDurations.WATCH_DEAL,function(){g.$(this).remove()})};
g.declarative("gbdeal-close-infobox","click",c);d.bind("gbdeal-close-infobox",c)};gb.resources.deviceInfo.isApp&&gb.resources.deviceInfo.isIPhone&&gb.resources.deviceInfo.isIOSInterstitialSupported?gb.notifications.invokePushNotificationInterstitial(c):c()}},removeWatchDealFirstrun:function(a){a=g.$(".bottomPopover-infobox");0<a.length&&a.trigger("gbdeal-close-infobox")},_handleActions:v.once(function(){var a=this;g.declarative("gb-bottomSheet-close","click",function(b){a.closeBottomSheet()})}),_handlePageScroll:function(){var a=
gb.metrics.getReftagFromUrl(h.location.href),b;v.isEmpty(a)||(b=v.find(v.invert(gb.metrics.widgetRefTags),function(b){return-1!==a.indexOf(gb.metrics.widgetRefTags[b])}));if(v.contains(gb.enums.WidgetsAllowedAsScrollSource,b)&&(b=v.filter(gb.widgetMetadata,function(a){return a.isWidgetFilteredViaUrl}),b=v.filter(b,function(a){return gb.configManager.getWidgetViewConfig(a.widgetID).scrollToWidgetEnabled}),!v.isEmpty(b))){var c=v.first(b).widgetID;h.setTimeout(function(){gb.widgets[c].scrollToWidgetTop(gb.enums.AnimationDurations.SCROLL_WIDGET_TO_TOP)},
gb.enums.Timeouts.WIDGET_LOAD_WAIT_TIME);this.pageScrollHandled=!0}},_postWidgetLoaded:function(){v.each(gb.filterControllerFactory.getAllControllers(),function(a){a.trigger("widgetLoaded")})}})});q.when("A","GoldboxMobile3PAssets","gb-event-emitter","gb-filter-model-factory","gb-filter-metrics").register("gb-filter-controller",function(g,n,f,d,b){var a=n._;return f.extend({filterMetrics:null,filterModelFactory:null,models:{},widgetGroups:{},init:function(){this._super();this.filterMetrics=new b;
this.filterModelFactory=new d;this.on("gbfilter:change",this.onFilterChange);this.on("gbfilter:mergeFilters",this.onFilterMerge);this.on("widgetLoaded",this._postWidgetLoaded)},registerFilters:function(a,b,d){d&&(this.models[d]||(this.models[d]=this.filterModelFactory.getFilterModel(b,d)),this.models[d].mergeFilters({schedulingParams:a.schedulingParams,dcsServerResponse:a.dcsServerResponse}),this.widgetGroups[d]=this.widgetGroups[d]||[],this.widgetGroups[d].push(gb.widgets[b]))},onFilterChange:function(a,
b,d){var f=b.widgetID,g=b.data[1]===gb.enums.BinningParams.PAGE.key;d=d||{};var h=this._fetchSelectedFilterParams(f,a,g);b=this._fetchUpdatedUrl(f,a,h,d,b);this._doPostFilterChangeAction(f,a,d,g,b)},_doPostFilterChangeAction:function(a,b,d,f,g){var n=gb.widgets[a],q=b.widgetGroupID;if(b.doPageRefresh)n.widgetName===gb.enums.WidgetNames.HERO&&(n.renderWireFrame(),n.renderContent(!0)),this.models[q].doPageRefresh=!1,g=gb.utils.setUrlHash(g,b.widgetGroupAnchor),h.location.href=g;else{var D=n.isEventsWidget();
b=b.getSelectedFilters(D);this._scrollToTopOfWidget(a,d);gb.configManager.getWidgetViewConfig(a).showBottomSheetFilter&&gb.controller.closeBottomSheet();gb.utils.updateAddressBarUrl(g,gb.configManager.getWidgetViewConfig(a).pushFilteredURL,b);n.showLoading();this._handleWidgetRefresh(a,q,b,D,f)}},_handleWidgetRefresh:function(a,b,d,f,g){var h=this,n=gb.controller.schedulingParams[a];g?this._handlePageChange(a,b):gb.utils.isWatchedDealsTab(a)?(this._overrideSchedulingParamsFromFilters(d,a,f),gb.metadata.refreshWatchedDeals(a)):
(n.fetchSinglePage=!1,gb.widgetHelper&&gb.widgetHelper.callDataArray[a]&&(n.pageSize=gb.widgetHelper.callDataArray[a][0].dealsPerPage),this._overrideSchedulingParamsFromFilters(d,a,f),delete gb.metadata.sortedDealIDs[a],b={dealsPerPage:gb.configManager.getWidgetViewConfig(a).preFetchGDMDeals,getDealsSize:gb.controller.schedulingParams[a].pageSize},gb.service.fetchDealWithData(a,b,function(a){h._updateWidgetGroup(gb.widgets[a].widgetGroupID)}))},_scrollToTopOfWidget:function(a,b){var d=gb.widgets[a];
gb.configManager.getWidgetViewConfig(a).disableNavigationToTop||b.disableNavigationToTop||(a=d.skinDomElement.position().top,h.scrollTo(0,a))},_fetchSelectedFilterParams:function(b,d,f){var g=gb.widgets[b].isEventsWidget();b=gb.controller.schedulingParams[b];d=d.getSelectedFilters(g);g=a.clone(d);f&&1<d[gb.enums.BinningParams.PAGE.key]&&(g.dealsPerPage=b.pageSize);return g},_fetchUpdatedUrl:function(a,b,d,f,g){var n=b.redirectURL||h.location.href,n=gb.utils.setUrlParam(n,"gb_f_"+b.widgetGroupID,this._toURL(d));
f.updateTitleOnTargetedWidget&&(n=this._fetchUrlUpdatedWithTitleChanges(n,a,b));n=this.filterMetrics.appendFilterMetricParams(n,a,g.context,g.data);return n=gb.utils.enforceUTFEncodingInUrl(n)},_fetchUrlUpdatedWithTitleChanges:function(a,b,d){},_handlePageChange:function(a,b){var d=gb.controller.widgetCurrentPage[a],f=gb.controller.schedulingParams[a],g=gb.widgets[a];if(gb.metadata.isCurrentWindowFull(a,d,f.pageSize))this._updateWidgetGroup(b);else if(f.fetchSinglePage)gb.controller.fetchPage({page:d},
a,!0,function(a,b){gb.controller.trigger("WidgetPageUpdate",a,b)});else{b={page:d,dealsPerPage:gb.configManager.getWidgetViewConfig(a).preFetchGDMDeals,getDealsSize:f.pageSize};if(g.isLaunchCellPage&&f.pageSize){var h=f.widgetTabConfig[f.widgetCurrentTab],h=(h?h.launchCellIndex:0)%f.pageSize;b.getDealsSize>h&&(b.getDealsSize=h+1)}gb.controller.fetchPage(b,a,!0,function(a,b){gb.controller.trigger("WidgetPageUpdate",a,b)})}g=d<g.totalPages&&!gb.metadata.isCurrentWindowFull(a,d+1,f.pageSize);b=1<d&&
!gb.metadata.isCurrentWindowFull(a,d-1,f.pageSize);f.fetchSinglePage?(g&&gb.controller.fetchPage({page:d+1},a),b&&gb.controller.fetchPage({page:d-1},a)):b||(d=(d-2)*f.pageSize,f=gb.metadata.sortedDealIDs[a].slice(d,d+f.pageSize),f.length&&gb.service.fetchDeals(f,a))},onFilterMerge:function(b){a.each(this.widgetGroups[b.widgetGroupID],function(a){a.renderContent(!0)})},_updateWidgetGroup:function(b){a.each(this.widgetGroups[b],function(a){gb.controller.trigger("WidgetPageUpdate",a.widgetID,!0)})},
_overrideSchedulingParamsFromFilters:function(b,d,f){var g=this.models[gb.widgets[d].widgetGroupID],h=gb.controller.schedulingParams[d];a.each(g.attributesList,function(d){var e=null,n=gb.enums.BinningKeyToDCSQueryParamMap[d];if(f)n&&!a.contains(gb.enums.excludeBinningParamsForEvents,d)?h[n]=b[n]:h.extendedFilters[d]=b[d];else{g.filterConfigValuesHash[d]&&!a.contains(g.attributesWithDisabledValues,d)&&(e=g.filterConfigValuesHash[d]);if(d===gb.enums.BinningParams.DISCOUNT.key)n=gb.enums.DCSQueryParams.DISCOUNT_RANGE;
else if(d===gb.enums.BinningParams.PRICE.key)n=gb.enums.DCSQueryParams.PRICE_RANGE;else if(d===gb.enums.IncludedDealTargetsSupported.MARKETING_ID||d===gb.enums.IncludedDealTargetsSupported.MARKETING_ID_ONLY_SUMMARY)h.extendedFilters[gb.enums.IncludedDealTargetsSupported.MARKETING_ID]=b[gb.enums.IncludedDealTargetsSupported.MARKETING_ID];n&&(h[n]=b[n]||e)}})},_isDefaultValue:function(a,b){return a===gb.enums.DCSQueryParams.PAGE&&1===b||a===gb.enums.DCSQueryParams.SORT_ORDER&&b===gb.enums.SortOrders.BY_RELEVANCE||
!b&&(a===gb.enums.DCSQueryParams.GLOBAL_ELIGIBLE_ONLY||a===gb.enums.DCSQueryParams.PRIME_ELIGIBLE_ONLY)},_toURL:function(b){var d=this;b=a.map(b,function(b,c){b&&c===gb.enums.BinningParams.NEW_RELEASES.key&&(b="Y");if(d._isDefaultValue(c,b))return null;if(a.isArray(b)){if(a.isEmpty(b))return null;b=a.map(b,encodeURIComponent).join(",")}return c+":"+encodeURIComponent(encodeURIComponent(b))});return a.compact(b).join(",")},_postWidgetLoaded:function(){var b=this;a.each(a.keys(this.models),function(a){a=
b.models[a];a.setupWidgetFilterConnections();a.saveTargetedWidgetInfo()})}})});q.when("A","GoldboxMobile3PAssets","gb-filter-controller").register("gb-faceout-filter-controller",function(g,h,f){return f.extend({init:function(){this._super()},_fetchUrlUpdatedWithTitleChanges:function(d,b,a){var c=a.widgetGroupID;a.targetedWidget.title?(a=a.targetedWidget.title,gb.controller.schedulingParams[b].title=a,a=encodeURIComponent(encodeURIComponent(a)),d=gb.utils.setUrlParam(d,"gb_ttl_"+c,a)):a.targetedWidget.clearTitle&&
(d=gb.utils.clearUrlParam(d,"gb_ttl_"+c),gb.controller.schedulingParams[b].title=a.targetedWidget.savedTitle);return d}})});q.when("A","GoldboxMobile3PAssets","gb-filter-controller","gb-faceout-filter-controller").register("gb-filter-controller-factory",function(g,h,f,d){var b=h._;g={controllers:{},getFilterController:function(a){var b;try{gb.enums.WidgetNames.PC_FACEOUT===a?(this.controllers.faceout=this.controllers.faceout||new d,b=this.controllers.faceout):(this.controllers.generic=this.controllers.generic||
new f,b=this.controllers.generic)}catch(e){q.log("GBFaceout widget is not supported on non Desktop platforms!","ERROR","GoldboxMobileAssets")}return b},getAllControllers:function(){var a=this;return b.map(Object.keys(this.controllers),function(b){return a.controllers[b]})}};g.controllers.generic=new f;"undefined"!==typeof d&&(g.controllers.faceout=new d);return g});q.when("A","gb-event-emitter").register("gb-accessibility",function(g,h){var f={"GB-TAB-SUPPLE":{AVAILABLE:{imageHolder:{selector:".dealImage img",
idSufix:"_imgHolder"},dealTitle:{selector:".titleContainer",idSufix:"_title"},dealReview:{selector:".reviewStars",idSufix:"_review"},dealDesc:{selector:".dealDesc",idSufix:"_Description"},dealPrice:{selector:".priceBlock",idSufix:"_Price"},dealStatus:{selector:".dealViewStatus",idSufix:"_Status"},dealTimer:{selector:".dealViewTimer",idSufix:"_Timer"},dealPrimeInfo:{selector:".dealPrimeInfo",idSufix:"_Prime"}},UPCOMING:{imageHolder:{selector:".dealImage img",idSufix:"_imgHolder"},dealTitle:{selector:".titleContainer",
idSufix:"_title"},dealReview:{selector:".reviewStars",idSufix:"_review"},dealDesc:{selector:".dealDesc",idSufix:"_Description"},dealPrice:{selector:".priceBlock",idSufix:"_Price"},dealStatus:{selector:".dealButtonContainer button",idSufix:"_Status"},dealTimer:{selector:".dealViewTimer",idSufix:"_Timer"},dealPrimeInfo:{selector:".dealPrimeInfo",idSufix:"_Prime"}},EXPIRED:{imageHolder:{selector:".dealImage img",idSufix:"_imgHolder"},dealTitle:{selector:".titleContainer",idSufix:"_title"},dealReview:{selector:".reviewStars",
idSufix:"_review"},dealDesc:{selector:".dealDesc",idSufix:"_Description"},dealPrice:{selector:".priceBlock",idSufix:"_Price"},dealStatus:{selector:".dealButtonContainer button",idSufix:"_Status"},dealTimer:{selector:".dealEndText",idSufix:"_Timer"}},SOLDOUT:{imageHolder:{selector:".dealImage img",idSufix:"_imgHolder"},dealTitle:{selector:".titleContainer",idSufix:"_title"},dealReview:{selector:".reviewStars",idSufix:"_review"},dealDesc:{selector:".dealDesc",idSufix:"_Description"},dealPrice:{selector:".priceBlock",
idSufix:"_Price"},dealStatus:{selector:".dealButtonContainer button",idSufix:"_Status"},dealTimer:{selector:".dealSoldText",idSufix:"_Timer"}},COMINGSOON:{imageHolder:{selector:".dealImage img",idSufix:"_imgHolder"},dealTitle:{selector:".titleContainer",idSufix:"_title"},dealReview:{selector:".reviewStars",idSufix:"_review"},dealDesc:{selector:".dealDesc",idSufix:"_Description"},dealTimer:{selector:".dealComingText",idSufix:"_Timer"}}},"GB-TAB-HERO":{AVAILABLE:{imageHolder:{selector:".dealImage img",
idSufix:"_imgHolder"},dealPrice:{selector:".priceBlock",idSufix:"_Price"},dealTitle:{selector:".titleContainer",idSufix:"_title"},dealStatus:{selector:".dealViewStatus",idSufix:"_Status"},dealPrimeInfo:{selector:".dealPrimeInfo",idSufix:"_Prime"},dealTimer:{selector:".dealViewTimer",idSufix:"_Timer"}},UPCOMING:{imageHolder:{selector:".dealImage img",idSufix:"_imgHolder"},dealStatus:{selector:".dealViewStatus",idSufix:"_Status"},dealTitle:{selector:".titleContainer",idSufix:"_title"},dealTimer:{selector:".dealViewTimer",
idSufix:"_Timer"},dealPrimeInfo:{selector:".dealPrimeInfo",idSufix:"_Prime"},watchDeal:{selector:".watchBtnContainer",idSufix:"_WatchDeal"}},EXPIRED:{imageHolder:{selector:".dealImage img",idSufix:"_imgHolder"},dealPrice:{selector:".priceBlock",idSufix:"_Price"},dealTitle:{selector:".titleContainer",idSufix:"_title"},dealTimer:{selector:".dealClaimInfo",idSufix:"_Timer"},dealStatus:{selector:".dealViewStatus",idSufix:"_Status"}},SOLDOUT:{imageHolder:{selector:".dealImage img",idSufix:"_imgHolder"},
dealPrice:{selector:".priceBlock",idSufix:"_Price"},dealTitle:{selector:".titleContainer",idSufix:"_title"},dealStatus:{selector:".dealViewStatus",idSufix:"_Status"}},COMINGSOON:{imageHolder:{selector:".dealImage img",idSufix:"_imgHolder"},dealStatus:{selector:".dealViewStatus",idSufix:"_Status"},dealTitle:{selector:".titleContainer",idSufix:"_title"}}}};return h.extend({init:function(){this._super();this.on("AccessibilityAction",this.actionHandler)},generateDealViewAccessibilityFlow:function(d,b){var a=
d.widgetView.widgetName,c=d.deal.dealState;d=gb.utils.getDealViewID(d.widgetView.widgetID,d.position);var e,h=[];f[a]&&(e=f[a][c]);if(e){var k=g.$(b),n;for(n in e)e[e]&&(c=e[n],a=k.find(c.selector),a.length&&(a.attr("id",d+c.idSufix),h.push(d+c.idSufix)));if(h.length)return k.attr("aria-flowto",h.join(" ")),g.$("\x3cdiv/\x3e").append(k).html()}return b},actionHandler:function(d,b){if(d)switch(d){case "subnavChange":this.subnavChange(b.subnavObject,b.newPageNumber);break;case "updateHeroTimer":this.updateHeroTimer(b.viewElement,
b.spanID,b.timerInfo);break;case "updateRefineView":this.updateTabHeroRefineView(b.filterEl);break;case "focusListItem":this.focusBottomSheetItem(b.bottomSheetObject)}},subnavChange:function(d,b){g.$(d.SubnavIDs.SubnavTab+d.currentPageNumber).attr("aria-selected","false");g.$(d.SubnavIDs.SubnavPage+d.currentPageNumber).attr("aria-hidden","true");g.$(d.SubnavIDs.SubnavTab+b).attr("aria-selected","true");g.$(d.SubnavIDs.SubnavPage+b).attr("aria-hidden","false")},updateHeroTimer:function(d,b,a){a=gb.resources.getString("gb_expand_time",
{hours:a.hours,minutes:a.minutes,seconds:a.seconds});g.$(d).find("#"+b).attr("aria-label",a);g.$(d).find("#"+b).attr("role","heading")},updateTabHeroRefineView:function(d){d.find("#statusFilter").bind("click",function(b){"block"!==g.$("#availabilityExpander").css("display")&&g.$("#availabilityContent").find("[role\x3d'listitem']").eq(0).focus()});d.find("#departmentFilter").bind("click",function(b){"block"!==g.$("#categoryRefineExpander").css("display")&&g.$("#categoryRefineContent").find("[role\x3d'listitem']").eq(0).focus()})},
focusBottomSheetItem:function(d){d.els.contents.find("[role\x3d'listitem']").eq(0).focus()}})});q.when("A","jQuery","load").execute(function(g,n){n(h).resize(function(){function f(d){if(n(d).length){var b=n(h).width(),a=n(".gbox-short-ad").width(),c=Math.floor(b/a),b=n(d+" .scheduled-ad").length,e=b*a;b>c&&(e=c*a);n(d).css("width",e);var f=!1;n(d+" .scheduled-ad").each(function(a){a>=c?n(this).hide():(n(this).show(),f=!0)});d=n(d).parent();f?1===d.children().length&&d.append("\x3chr style\x3d'border-top:1px solid #DDDDDD;margin-top:10px;width:95%'\x3e"):
1<d.children().length&&d.children().last().remove()}}f("#gbox-ad-row-1\\.0");f("#gbox-ad-row-2\\.0")});n(h).resize()})});