function asyncGeneratorStep(t,e,i,n,o,a,s){try{var r=t[a](s),c=r.value}catch(l){return void i(l)}r.done?e(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(t){return function(){var e=this,i=arguments;return new Promise(function(n,o){function a(t){asyncGeneratorStep(r,n,o,a,s,"next",t)}function s(t){asyncGeneratorStep(r,n,o,a,s,"throw",t)}var r=t.apply(e,i);a(void 0)})}}define(["modules/picture","modules/sharer","common/moment","common/utils","vendors/twitter-widget","modules/instagram","modules/videoManager"],function(t,e,i,n,o,a,s){function r(){this.init()}return r.prototype.init=function(){this.element=document.querySelector('[data-module="live-text"]'),this.getNewPost=encodeURIComponent(document.querySelector("[data-posts]").dataset.posts),this.nextPageButton=document.getElementsByClassName("js-live-text__next-page")[0],this.nextPageButton&&this.nextPageButton.addEventListener("click",function(){this.fetchPosts("/ajax/live-text?getNextPage="+encodeURIComponent(this.nextPageButton.dataset.url))}.bind(this)),this.intervalDelay=document.querySelector("[data-delay]")?parseInt(document.querySelector("[data-delay]").dataset.delay,10):2e4,this.interval=setInterval(this.fetchPosts.bind(this),this.intervalDelay,"/ajax/live-text?countNewPost="+this.getNewPost),this.player=s,this.container=document.getElementsByClassName("js-live-text__container")[0],this.initNotification(),this.generateDaySeparator()},r.prototype.initNotification=function(){var t=document.getElementsByTagName("body")[0];this.liveTextNotification=document.createElement("div"),this.liveTextNotification.classList.add.apply(this.liveTextNotification.classList,["toast","live-text__notification"]),this.liveTextNotification.dataset.url="/ajax/live-text?getNewPost="+this.getNewPost,t.appendChild(this.liveTextNotification),this.liveTextNotification.addEventListener("click",function(){this.fetchPosts(this.liveTextNotification.dataset.url)}.bind(this)),this.updateNotificationposition(),window.addEventListener("scroll",function(){window.requestAnimationFrame(this.updateNotificationposition.bind(this))}.bind(this))},r.prototype.updateNotificationposition=function(){var t=window.scrollY||window.pageYOffset;this.liveTextNotification.style.top=t>n.posY(this.container)-100?"100px":n.posY(this.container)-document.body.scrollTop+0+"px"},r.prototype.fetchPosts=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var i,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return i=e.sent,e.next=5,i.json();case 5:return n=e.sent,e.abrupt("return",this.getPosts(n));case 7:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}(),r.prototype.getPosts=function(i){var n=this;if(i.error)return void console.error(i.error);if("countNewPost"===i.type)"false"===i.liveState?clearInterval(this.interval):this.updateNotification(i.body);else{var o=document.createElement("template");if("getNewPost"===i.type){this.scrollToTop(),this.containerFirstChild=this.container.firstChild;var a=this.container.querySelectorAll(".live-text.pinned,.live-text.pinned-scoreboard");i.body.forEach(function(t){o.innerHTML=t.body,elem=o.content?o.content.firstChild:o.firstChild,a.length?this.container.insertBefore(elem,a[a.length-1].nextSibling):this.container.insertBefore(elem,this.containerFirstChild)}.bind(this)),this.updateNotification(0),this.refreshLinks(i.links,"newPosts")}if("getNextPage"===i.type){i.body.forEach(function(t){o.innerHTML=t.body;var e=o.content?o.content.firstChild:o.firstChild;this.container.appendChild(e)}.bind(this));var s=this.container.querySelectorAll("script[data-useragent]");s.forEach(function(t){var e=t.parentNode,i=new RegExp("[:\\?]\\s'(.*)'\\n","g"),o=i.exec(t.innerHTML);n.player.isIE||(o=i.exec(t.innerHTML)),e.innerHTML=o[1]}),this.updateNextPageButton(i.links),this.refreshLinks(i.links,"nextPage")}this.generateDaySeparator(),this.updatePinned(i,o),this.initFB(),this.initIG(),this.initTweets(),js_blocks.picture=new t,js_blocks.sharer=new e,this.initVideos()}},r.prototype.scrollToTop=function(){(window.scrollY||window.pageYOffset)&&window.scrollTo(0,Math.max(0,n.posY(this.element)-70))},r.prototype.refreshLinks=function(t,e){clearInterval(this.interval),t["new"]&&t["new"].url&&""!==t["new"].url&&"newPosts"===e&&(this.getNewPost=encodeURIComponent(t["new"].url)),t.next&&t.next.url&&""!==t.next.url&&"nextPage"===e&&this.nextPageButton.setAttribute("data-url",t.next.url),this.liveTextNotification.setAttribute("data-url","/ajax/live-text?getNewPost="+this.getNewPost),this.interval=setInterval(this.fetchPosts.bind(this),2e4,"/ajax/live-text?countNewPost="+this.getNewPost)},r.prototype.updateNotification=function(t){t>0?(this.liveTextNotification.className.indexOf("live-text__notification--show")===-1&&(this.liveTextNotification.className+=" live-text__notification--show"),this.liveTextNotification.innerHTML!=t+' actualité(s) <span class="icon-arrow icon-arrow--top"></span>'&&(this.liveTextNotification.innerHTML=t+' actualité(s) <span class="icon-arrow icon-arrow--top"></span>')):(this.liveTextNotification.className.indexOf("live-text__notification--show")>-1&&this.liveTextNotification.classList.remove("live-text__notification--show"),this.liveTextNotification.innerHTML="")},r.prototype.updateNextPageButton=function(t){!t.next&&this.nextPageButton&&("remove"in Element.prototype?this.nextPageButton.remove():this.nextPageButton.parentNode.removeChild(this.nextPageButton))},r.prototype.generateDaySeparator=function(){var t=this.container.childNodes;[].slice.call(t).forEach(function(e,n){var o=document.createElement("div"),a=document.createElement("h3"),s=document.createElement("span");o.className="live-text__separator",a.className="live-text__separator__title",s.className="live-text__separator__subtitle";var r=e.nextSibling,c=e.classList.contains("live-text__separator"),l=e.classList.contains("pinned");if(n<t.length&&!c&&!l&&!e.dateParsed){if(r&&e.dataset.day!==r.dataset.day){var d="il y a un jour"===i(r.dataset.date).fromNow()?"Hier":i(r.dataset.date).fromNow(),h=i(r.dataset.date).format("dddd, D MMMM YYYY").charAt(0).toUpperCase()+i(r.dataset.date).format("dddd, D MMMM YYYY").slice(1);a.innerHTML=d,s.innerHTML=h,o.appendChild(a),o.appendChild(s),e.parentNode.insertBefore(o,r)}e.dateParsed=!0}})},r.prototype.updatePinned=function(t,e){t.pinned.forEach(function(t){var i=this.container.querySelector('.pinned[id="'.concat(t.id,'"],.pinned-scoreboard[id="').concat(t.id,'"]'));i&&(e.innerHTML=t.body,elem=e.content?e.content.firstChild:e.firstChild,this.container.replaceChild(elem,i))}.bind(this))},r.prototype.initFB=function(){FB.XFBML.parse()},r.prototype.initIG=function(){instgrm.Embeds.process()},r.prototype.initTweets=function(){var t=this.container.getElementsByClassName("twitter-block");t&&t.length>0&&[].slice.call(t).forEach(function(t){if(!("init"in t.dataset)){Object.assign(t.dataset,{init:1});var e=t.getAttribute("tweet-id");twttr.widgets.createTweet(e,t,{linkColor:"#55acee"})}})},r.prototype.initVideos=function(){this.player.populateVideoCollection()},r});