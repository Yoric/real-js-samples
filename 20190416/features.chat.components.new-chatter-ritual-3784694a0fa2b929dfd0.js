(window.webpackJsonp=window.webpackJsonp||[]).push([[208],{"0Ex5":function(e,n){var t={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ritualToken"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"RitualToken"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"expiresAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]}]}}],loc:{start:0,end:64}};t.loc.source={body:"fragment ritualToken on RitualToken {\nid\nexpiresAt\nstatus\ntype\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};e.exports=t},IWck:function(e,n,t){"use strict";var i,a;t.d(n,"b",function(){return i}),t.d(n,"a",function(){return a}),function(e){e.DismissToken="token_dismissed",e.RedeemToken="token_redeemed",e.RequestEligibility="eligibility_requested",e.RequestToken="token_requested"}(i||(i={})),function(e){e.Click="clicked_manage_in_dashboards",e.Dismiss="dismissed"}(a||(a={}))},Oxg6:function(e,n,t){},QhAx:function(e,n,t){var i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"NewChatterRitual_Channel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"channel"},name:{kind:"Name",value:"user"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"self"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"ritualTokens"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ritualToken"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"stream"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:167}};i.loc.source={body:'#import "./ritual-token-fragment.gql"\nquery NewChatterRitual_Channel($id: ID!) {\nchannel: user(id: $id) {\nid\nself {\nritualTokens {\n...ritualToken\n}\n}\nstream {\nid\n}\n}\n}',name:"GraphQL request",locationOffset:{line:1,column:1}};var a={};i.definitions=i.definitions.concat(t("0Ex5").definitions.filter(function(e){if("FragmentDefinition"!==e.kind)return!0;var n=e.name.value;return!a[n]&&(a[n]=!0,!0)})),e.exports=i},TjZe:function(e,n,t){var i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"RedeemNewChatterToken"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"RedeemRitualTokenInput"}}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"redeemRitualToken"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"error"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"code"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"token"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ritualToken"},directives:[]}]}}]}}]}}],loc:{start:0,end:182}};i.loc.source={body:'#import "./ritual-token-fragment.gql"\nmutation RedeemNewChatterToken($input: RedeemRitualTokenInput!) {\nredeemRitualToken(input: $input) {\nerror {\ncode\n}\ntoken {\n...ritualToken\n}\n}\n}',name:"GraphQL request",locationOffset:{line:1,column:1}};var a={};i.definitions=i.definitions.concat(t("0Ex5").definitions.filter(function(e){if("FragmentDefinition"!==e.kind)return!0;var n=e.name.value;return!a[n]&&(a[n]=!0,!0)})),e.exports=i},VyuC:function(e,n,t){var i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DismissNewChatterToken"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DismissRitualTokenInput"}}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"dismissRitualToken"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"error"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"code"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"token"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ritualToken"},directives:[]}]}}]}}]}}],loc:{start:0,end:185}};i.loc.source={body:'#import "./ritual-token-fragment.gql"\nmutation DismissNewChatterToken($input: DismissRitualTokenInput!) {\ndismissRitualToken(input: $input) {\nerror {\ncode\n}\ntoken {\n...ritualToken\n}\n}\n}',name:"GraphQL request",locationOffset:{line:1,column:1}};var a={};i.definitions=i.definitions.concat(t("0Ex5").definitions.filter(function(e){if("FragmentDefinition"!==e.kind)return!0;var n=e.name.value;return!a[n]&&(a[n]=!0,!0)})),e.exports=i},WkKR:function(e,n,t){"use strict";t.d(n,"a",function(){return s}),t.d(n,"d",function(){return o}),t.d(n,"b",function(){return l}),t.d(n,"e",function(){return u}),t.d(n,"c",function(){return d});var i=t("/7QA"),a=t("2xye"),r=t("IWck"),s=function(e){var n={action:r.b.DismissToken,channel_id:e.channelID,user_banner:e.bannerMessage,user_message:null};i.p.track(a.SpadeEventType.NewChatterTokenStatus,n)},o=function(e){var n={action:r.b.RedeemToken,channel_id:e.channelID,user_banner:e.bannerMessage,user_message:e.userMessage};i.p.track(a.SpadeEventType.NewChatterTokenStatus,n)},l=function(e){var n={action:r.b.RequestEligibility,channel_id:e.channelID,user_banner:null,user_message:null};i.p.track(a.SpadeEventType.NewChatterTokenStatus,n)},u=function(e){var n={action:r.b.RequestToken,channel_id:e.channelID,user_banner:e.bannerMessage,user_message:null};i.p.track(a.SpadeEventType.NewChatterTokenStatus,n)},d=function(e){var n={action:e.action,channel_id:e.channelID};i.p.track(a.SpadeEventType.NewChatterOnboardingInteraction,n)}},Y9qK:function(e,n,t){"use strict";t.r(n);var i,a=t("mrSG"),r=t("q1tI"),s=t("oJmH"),o=t("/MKj"),l=t("/7QA"),u=t("yR8l"),d=t("x7UT"),c=t("eDVu"),m=t("0Log"),k=t("geRD"),p=t("/aPz"),h=t("DMoW"),f=t("kRBY"),v=t("hO8c"),T=t("jBwP"),b=t("9MrB"),g=t("TApp"),N=t("YXxK"),y=t("wo8Z"),S=t("lNGo"),D=t("WkKR"),R=t("a1OF"),E=t("sUnt"),_=t("Ws8v"),O=t("X2PJ"),C=t("7d/q"),w=t("b7S+"),I=t("hnjF"),x=t("i4Ys"),F=t("7uM4"),A=(t("Oxg6"),[{id:"30259",alt:"HeyGuys"},{id:"81274",alt:"VoHiYo"},{id:"64138",alt:"SeemsGood"}]),M=function(e){function n(n){var t=e.call(this,n)||this;return t.onEmoteClick=function(e){if(t.renderedTokenID){var n=e.currentTarget.dataset.emoteString;n?t.props.onRitualRedeemed(t.renderedTokenID,n):l.k.warn("[NewChatterRitual] Could not find clicked emote ID.")}else l.k.warn("[NewChatterRitual] Could not find clicked Ritual token.")},t.onCloseButtonClick=function(){t.renderedTokenID?t.props.onRitualDismissed(t.renderedTokenID):l.k.warn("[NewChatterRitual] Could not find clicked Ritual token.")},t.getAvailableToken=function(){return t.props.ritualTokens&&t.props.ritualTokens.find(function(e){return!(!e||e&&(e.type!==h.Ua.NEW_CHATTER||e.status!==h.Ta.AVAILABLE))&&(!e.expiresAt||Date.now()<new Date(e.expiresAt).valueOf())})||null},t.renderedTokenID=null,t}return a.__extends(n,e),n.prototype.render=function(){var e=this,n=this.getAvailableToken();if(this.renderedTokenID=n?n.id:null,!n)return null;var t=A.map(function(n){return r.createElement(E.a,{key:n.id,flexShrink:0,margin:{right:.5}},r.createElement(w.a,{label:n.alt},r.createElement(x.a,{type:x.b.Alpha,onClick:e.onEmoteClick,"data-emote-string":n.alt,"data-test-selector":"emote-button"},r.createElement(E.a,{padding:.5},r.createElement("img",{className:"new-chatter-ritual__emote",src:Object(R.d)(n.id,3)})))))});return r.createElement(_.a,{background:O.a.Base,border:!0,className:"new-chatter-ritual",margin:{x:2,bottom:.5},padding:{left:.5,y:.5}},r.createElement(E.a,{alignItems:I.b.Center,display:I.d.Flex,flexWrap:I.f.NoWrap},r.createElement(E.a,{flexShrink:1,margin:{right:.5}},this.props.bannerMessage),t,r.createElement(_.a,{borderLeft:!0,flexShrink:0},r.createElement(C.a,{ariaLabel:"close",icon:F.b.Close,onClick:this.onCloseButtonClick,size:C.b.Large,"data-test-selector":"dismiss-button"}))))},n}(r.Component),j=t("QhAx"),L=t("VyuC"),q=t("TjZe"),P=t("s/24"),B=3e5,U=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.state={closedByError:!1,isLive:!1},n.eligibilityTimeouts={},n.expirationTimeouts={},n.getBannerMessage=function(){return Object(l.d)("Click an emote to say hello!","NewChatterRitual")},n.getLiveStatus=function(e){var n=e.pubsub.messages.streamDown?e.pubsub.messages.streamDown.server_time:0,t=e.pubsub.messages.streamUp?e.pubsub.messages.streamUp.server_time:0;return n||t?t>n:e.data&&e.data.channel&&e.data.channel.stream&&!!e.data.channel.stream.id||!1},n.setEligibilityTimeouts=function(e){for(var t=new Set(e.map(function(e){return e.id})),i=0,a=Object.keys(n.eligibilityTimeouts);i<a.length;i++){var r=a[i];t.has(r)||(clearTimeout(n.eligibilityTimeouts[r]),delete n.eligibilityTimeouts[r])}t.forEach(function(e){n.eligibilityTimeouts[e]||(n.eligibilityTimeouts[e]=setTimeout(function(){delete n.eligibilityTimeouts[e],n.isEligible=!0,n.state.isLive&&n.requestRitualToken()},B))})},n.requestRitualToken=function(){return a.__awaiter(n,void 0,void 0,function(){var e,n;return a.__generator(this,function(t){switch(t.label){case 0:Object(D.e)({bannerMessage:this.getBannerMessage(),channelID:this.props.channelID}),e=a.__assign({},Object(k.a)({channelID:this.props.channelID,type:h.Ua.NEW_CHATTER})),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.props.requestToken(e)];case 2:return t.sent(),this.isEligible=!1,[3,4];case 3:return n=t.sent(),l.k.error(n,"Failed to request new chatter ritual token."),[3,4];case 4:return[2]}})})},n.setExpirationTimeouts=function(e){for(var t=new Set(e.map(function(e){return e.id})),i=0,a=Object.keys(n.expirationTimeouts);i<a.length;i++){var r=a[i];t.has(r)||(clearTimeout(n.expirationTimeouts[r]),delete n.expirationTimeouts[r])}e.forEach(function(e){if(!n.expirationTimeouts[e.id]&&e.expiresAt&&new Date(e.expiresAt).valueOf()>Date.now()){var t=new Date(e.expiresAt).valueOf()-Date.now();n.expirationTimeouts[e.id]=setTimeout(n.expireRitualToken.bind(e.id),t)}})},n.expireRitualToken=function(e){delete n.expirationTimeouts[e];Object(k.g)(j,{id:n.props.channelID},function(n){return n.channel&&n.channel.self&&n.channel.self.ritualTokens&&(n.channel.self.ritualTokens=n.channel.self.ritualTokens.filter(function(n){return n.id===e})),n})},n.redeemRitualToken=function(e,t){return a.__awaiter(n,void 0,void 0,function(){var n,i,r;return a.__generator(this,function(s){switch(s.label){case 0:Object(S.b)({emotePickerSessionID:null,channelID:this.props.channelID,channelLogin:this.props.channelLogin,isHostMode:this.props.isHostMode,fromNewChatterRitual:!0,subOnlyMode:this.props.isSubsOnlyModeEnabled,player:this.props.isEmbedded||this.props.isPopout?N.a.Embed:N.a.Web,viewerContext:this.props.viewerContext}),Object(D.d)({bannerMessage:this.getBannerMessage(),channelID:this.props.channelID,userMessage:t}),n=a.__assign({},Object(k.a)({channelID:this.props.channelID,type:h.Ua.NEW_CHATTER,messageText:t}),{optimisticResponse:{redeemRitualToken:{__typename:"RedeemRitualTokenPayload",error:null,token:{id:e,expiresAt:null,status:h.Ta.REDEEMED,type:h.Ua.NEW_CHATTER,__typename:"RitualToken"}}}}),i=null,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.props.redeemToken(n)];case 2:return i=s.sent(),[3,4];case 3:return r=s.sent(),l.k.error(r,"Failed to redeem new chatter ritual."),this.handleGenericError(),[2];case 4:if(i&&i.data&&i.data.redeemRitualToken&&i.data.redeemRitualToken.error)switch(i.data.redeemRitualToken.error.code){case h.Oa.USER_CHAT_BANNED:case h.Oa.FOLLOWER_ONLY_MODE_ENFORCEMENT_FAILED:case h.Oa.SUB_ONLY_MODE_ENFORCEMENT_FAILED:case h.Oa.USER_CHAT_TIMED_OUT:return this.props.onSendMessage(t),this.setState({closedByError:!0}),[2];default:return this.handleGenericError(),[2]}return i&&i.data&&i.data.redeemRitualToken&&i.data.redeemRitualToken.token?[2]:(this.handleGenericError(),[2])}})})},n.dismissRitualToken=function(e){return a.__awaiter(n,void 0,void 0,function(){var n,t,i;return a.__generator(this,function(r){switch(r.label){case 0:Object(D.a)({bannerMessage:this.getBannerMessage(),channelID:this.props.channelID}),n=a.__assign({},Object(k.a)({channelID:this.props.channelID,type:h.Ua.NEW_CHATTER}),{optimisticResponse:{dismissRitualToken:{__typename:"DismissRitualTokenPayload",error:null,token:{id:e,expiresAt:null,status:h.Ta.DISMISSED,type:h.Ua.NEW_CHATTER,__typename:"RitualToken"}}}}),t=null,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.props.dismissToken(n)];case 2:return t=r.sent(),[3,4];case 3:return i=r.sent(),l.k.error(i,"Failed to redeem new chatter ritual."),[3,4];case 4:return t&&t.data&&t.data.dismissRitualToken&&t.data.dismissRitualToken.token?[2]:(this.handleGenericError(),[2])}})})},n.handleGenericError=function(){n.props.onPushMessage(Object(g.a)(Object(l.d)("Something went wrong.","NewChatterRitual"))),n.setState({closedByError:!0})},n.clearAllTimers=function(){for(var e=0,t=Object.keys(n.eligibilityTimeouts);e<t.length;e++){var i=t[e];clearTimeout(n.eligibilityTimeouts[i])}n.eligibilityTimeouts={};for(var a=0,r=Object.keys(n.expirationTimeouts);a<r.length;a++){i=r[a];clearTimeout(n.expirationTimeouts[i])}n.expirationTimeouts={}},n}return a.__extends(n,e),n.prototype.componentWillReceiveProps=function(e){this.props.data&&this.props.data.loading||!e.data||!e.data.loading||Object(D.b)({channelID:this.props.channelID});var n=this.getLiveStatus(e);if(this.state.isLive!==n&&(this.setState({isLive:n}),n&&this.isEligible&&this.requestRitualToken()),e.data&&e.data.channel&&e.data.channel.self&&e.data.channel.self.ritualTokens){var t=e.data.channel.self.ritualTokens;this.setEligibilityTimeouts(t.filter(function(e){return e.status===h.Ta.ELIGIBLE})),this.setExpirationTimeouts(t.filter(function(e){return!!e.expiresAt}))}else this.clearAllTimers()},n.prototype.componentWillUnmount=function(){this.clearAllTimers()},n.prototype.render=function(){return this.props.data&&this.props.data.channel?this.state.closedByError||!this.state.isLive?null:this.props.hasPrivateCallouts||this.props.hasChatInputPrompt?null:r.createElement(M,{bannerMessage:this.getBannerMessage(),onRitualDismissed:this.dismissRitualToken,onRitualRedeemed:this.redeemRitualToken,ritualTokens:this.props.data.channel.self&&this.props.data.channel.self.ritualTokens?this.props.data.channel.self.ritualTokens:[]}):null},n}(r.Component);function W(e){return!e.firstPageLoaded||!Object(y.a)()||!e.isLoggedIn||e.isEmbedded||e.isPopout}var V=Object(s.compose)(Object(o.connect)(function(e){return{firstPageLoaded:e.session.firstPageLoaded,isLoggedIn:Object(f.f)(e)}},null),Object(u.a)(j,{options:function(e){return{variables:{id:e.channelID}}},skip:W}),Object(c.a)(function(e){return{query:j,variables:{id:e.channelID},topic:Object(p.D)(e.channelID),type:m.PubsubMessageType.UpdatedChannelChatProperty,mutator:function(n,t){return n.data.is_rituals_enabled?setTimeout(function(){e.data&&e.data.refetch&&e.data.refetch()}):t.channel&&t.channel.self&&(t.channel.self.ritualTokens=[]),t},skip:W(e)}}),Object(d.a)([{topic:function(e){return Object(p.L)(e.channelID)},mapMessageTypesToProps:(i={},i[m.PubsubMessageType.ChannelStreamUp]="streamUp",i[m.PubsubMessageType.ChannelStreamDown]="streamDown",i),skip:W}]),Object(u.a)(L,{name:"dismissToken"}),Object(u.a)(q,{name:"redeemToken"}),Object(u.a)(P,{name:"requestToken"}),Object(T.b)(function(e){return{isSubsOnlyModeEnabled:e.subsOnlyMode}}),Object(b.b)(function(e){return e}),Object(v.b)(function(e){return{hasPrivateCallouts:e.callouts.length>0,hasChatInputPrompt:!!e.inputPrompt}}))(U);t.d(n,"NewChatterRitualContainer",function(){return U}),t.d(n,"NewChatterRitual",function(){return V})},"s/24":function(e,n,t){var i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"RequestNewChatterToken"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"RequestRitualTokenInput"}}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"requestRitualToken"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"error"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"code"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"token"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ritualToken"},directives:[]}]}}]}}]}}],loc:{start:0,end:185}};i.loc.source={body:'#import "./ritual-token-fragment.gql"\nmutation RequestNewChatterToken($input: RequestRitualTokenInput!) {\nrequestRitualToken(input: $input) {\nerror {\ncode\n}\ntoken {\n...ritualToken\n}\n}\n}',name:"GraphQL request",locationOffset:{line:1,column:1}};var a={};i.definitions=i.definitions.concat(t("0Ex5").definitions.filter(function(e){if("FragmentDefinition"!==e.kind)return!0;var n=e.name.value;return!a[n]&&(a[n]=!0,!0)})),e.exports=i},wo8Z:function(e,n,t){"use strict";t.d(n,"a",function(){return a});var i=t("/7QA"),a=function(){return i.n.get("ritualsFeatureFlagOverride",i.b.get("viewer_milestones_enabled",!1))}}}]);