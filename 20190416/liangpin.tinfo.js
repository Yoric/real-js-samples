(function(){function s(e){var n=this;e=$.extend({},t,e),n.options=e,n.options.flagAutoInit&&n.init()}function o(){var e=this,t=e.options.selectorProvince;return $(t)}function u(){var e=this,t=e.options.selectorCity;return $(t)}function a(){var e=this,t=e.options.selectorArea;return $(t)}function f(e,t){e=e||[];var n=this,r=[];$.each(e,function(e,n){r.push('<option value="',n.province_id,'"'),t===n.province_id&&r.push(" selected"),r.push(">",n.province_name,"</option>")}),r=r.join("");var i=n.getProvinceSelect();n.addSelectInner(i,r)}function l(e,t){e=e||[];var n=this,r=[];$.each(e,function(e,n){r.push('<option value="',n.city_id,'"'),t===n.city_id&&r.push(" selected"),r.push(">",n.city_name,"</option>")}),r=r.join("");var i=n.getCitySelect();n.addSelectInner(i,r)}function c(e,t){e=e||[];var n=this,r=[];$.each(e,function(e,n){r.push('<option value="',n.area_id,'"'),t===n.area_id&&r.push(" selected"),r.push(">",n.area_name,"</option>")}),r=r.join("");var i=n.getAreaSelect();n.addSelectInner(i,r)}function h(e,t){if(!e||!e.length)return;e.html(t),t?e.show():e.hide()}function p(e){var t=n;if(t&&t.length)$.isFunction(e)&&e();else{var r="/aj/doGetProvinceList";$.get(r,function(t){t=$.parseJSON(t);if(!t.errno){var r=t.result;n=r,$.isFunction(e)&&e()}})}}function d(e,t){if(!e)return;var n=this,i=r[e];if(i&&i.length)$.isFunction(t)&&i[0].length&&n.getAreaList(i[0].city_id,function(e){t(i,e)});else{var s="/aj/doGetCityList?province_id="+e;$.get(s,function(s){s=$.parseJSON(s),s.errno||(r[e]=s.result,$.isFunction(t)&&(i=r[e],i&&i.length&&i[0].length&&n.getAreaList(i[0].city_id,function(e){t(i,e)})))})}}function v(e,t){if(!e)return;var n=this,r=i[e];if(r&&r.length)$.isFunction(t)&&t(r);else{var s="/aj/doGetAreaList?city_id="+e;$.get(s,function(n){n=$.parseJSON(n),n.errno||(i[e]=n.result,$.isFunction(t)&&t(i[e]))})}}function m(e,t){if(!e)return;var n=this,s=r[e];if(s&&s.length)$.isFunction(t)&&t();else{var o="/aj/doGetProvinceLinkage?province_id="+e;s=[],$.get(o,function(n){n=$.parseJSON(n);if(!n.errno){var o=n.result;$.each(o.city_list,function(e,t){s.push({city_id:t.city_id,city_name:t.city_name}),i[t.city_id]=t.area_list&&t.area_list.length?t.area_list:[]}),r[e]=s,$.isFunction(t)&&t()}else $.isFunction(t)&&t()})}}function g(e,t,n){var r=this;r.getProvinceList(function(){var i=b(),s=S(e,i);s=s||i[0].province_id,r.setProvinceHtml(i,s),r.getCityAreaList(s,function(){var e=w(s),i=x(t,e);i=i||e[0].city_id,r.setCityHtml(e,i);var o=E(i);if(o.length){var u=T(n,o);u=u||o[0].area_id,r.setAreaHtml(o,u)}})})}function y(){var e=this,t=e.options.province||window.city_name||"\u5317\u4eac",n=e.options.city||"",r=e.options.area||"";e.setSelect(t,n,r),$(e.options.selectorProvince).on("change",function(t){var n=$(this),r=n.val();e.getCityAreaList(r,function(){var t=w(r),n=t[0].city_id;e.setCityHtml(t,n);var i=E(n);if(i.length){var s=i[0].area_id;e.setAreaHtml(i,s)}else{var o=e.getAreaSelect();o.css("display","none"),o.children("option").remove()}})}),$(e.options.selectorCity).on("change",function(t){var n=$(this),r=n.val();e.getAreaList(r,function(t){var t=E(r);if(t.length){var n=t[0].area_id;e.setAreaHtml(t,n)}else{var i=e.getAreaSelect();i.css("display","none"),i.children("option").remove()}})})}function b(){return n}function w(e){return r[e]}function E(e){return i[e]}function S(e,t){if(!e||!$.isArray(t))return;var n;return $.each(t,function(t,r){if(e==r["province_name"])return n=r.province_id,!1}),n}function x(e,t){if(!e||!$.isArray(t))return;var n;return $.each(t,function(t,r){if(e==r["city_name"])return n=r.city_id,!1}),n}function T(e,t){if(!e||!$.isArray(t))return;var n;return $.each(t,function(t,r){if(e==r["area_name"])return n=r.area_id,!1}),n}var e=window.Bang=window.Bang||{},t={flagAutoInit:!0,selectorProvince:'[name="receiver_province_id"]',selectorCity:'[name="receiver_city_id"]',selectorArea:'[name="receiver_area_id"]',province:"",city:"",area:""},n=[],r={},i={};s.prototype={constructor:s,getProvinceSelect:o,getCitySelect:u,getAreaSelect:a,setProvinceHtml:f,setCityHtml:l,setAreaHtml:c,addSelectInner:h,getProvinceList:p,getCityList:d,getAreaList:v,getCityAreaList:m,setSelect:g,init:y},e.AddressSelect=function(e){return new s(e)}})(),function(){function e(){this.init.apply(this,arguments)}e.prototype=function(){return{init:function(e){var t=this;CustEvent.createEvents(this);var n="";this.element=W(e);if(t.element&&!("placeholder"in document.createElement("input"))&&(n=t.element.attr("placeholder"))){var r=W('<label for="'+this.element.attr("id")+'"></label>').addClass("ele4phtips")[0];t.element.parentNode().insertBefore(r,t.element[0]);var i=function(e,t){e.style.opacity?e.style.opacity=t/100:e.style.filter="Alpha(opacity="+t+")"},s=function(){t.element.val()?r.innerHTML="":(i(r,0),r.innerHTML=n)};t.element.on("keyup",function(){s()}).on("focus",function(){s()}).on("blur",function(){t.element.val()||(i(r,100),r.innerHTML=n)}),t.element.val()||(r.innerHTML=n)}}}}(),QW.provide({PlaceHolder:e})}(),function(){function e(e,t){var n=!0;tcb.bindEvent(e.get(0),{".need-promo-checkable":function(t){var n=$(this),r=n.find(".checkbox"),i=$(".block-promo-cont"),s=e.find('[name="youhui_code"]');i.slideToggle("slow",function(){n.hasClass("need-promo-checked")&&!s.val()?n.removeClass("need-promo-checked"):n.addClass("need-promo-checked")})},".code-input":{change:function(t){var n=$(this),r=n.siblings(".btn-use-code"),i=e.find(".code-tips");n.val().trim().length?r.removeClass("btn-disabled"):r.addClass("btn-disabled"),i.html("")},keyup:function(t){var n=$(this),r=n.siblings(".btn-use-code"),i=e.find(".code-tips");n.val().trim().length?r.removeClass("btn-disabled"):r.addClass("btn-disabled"),i.html("")},keydown:function(e){e.keyCode==13&&e.preventDefault()}},".btn-use-code":function(t){t.preventDefault();var n=$(this),r=n.siblings(".code-input"),i=e.find('[name="youhui_code"]'),s=e.find(".coupon-able .coupon-item");s.removeClass("coupon-item-checked"),n.hasClass("btn-disabled")||i.val(r.val()).trigger("change")},".coupon-able .coupon-item":function(t){var n=$(this),r=e.find(".code-tips"),i=e.find(".code-input"),s=e.find('[name="youhui_code"]');r.html(""),i.val(""),n.hasClass("coupon-item-checked")?(n.removeClass("coupon-item-checked"),s.val("")):(n.addClass("coupon-item-checked").siblings(".coupon-item-checked").removeClass("coupon-item-checked"),s.val(n.attr("data-code"))),s.trigger("change")}}),e.find('[name="youhui_code"]').on("change",function(){var e=$(this);r(e,t)})}function t(e){i({$tpl:$("#JsPromoTpl"),$target:e.find(".block-promo-cont"),$youhui_count_wrap:e.find(".youhui-count")})}function n(e){var t=$(".promo-wrap");i({$tpl:$("#JsPromoTpl"),$target:t.find(".block-promo-cont"),$youhui_count_wrap:t.find(".youhui-count"),callback:e})}function r(e,t){var n=e.val(),r=$(t.promo_wrap),i=r.find(".code-tips"),s={youhui_code:n,service_type:t.service_type,price:t.price,product_id:t.product_id};$.post(t.url||"/aj/doGetYouhuiAmount",s,function(s){try{s=$.parseJSON(s)}catch(o){s={errno:"error"}}if(s.errno){var u="\u62b1\u6b49\uff0c"+(s.errmsg?s.errmsg+"\uff0c":"")+"\u4f18\u60e0\u7801\u9a8c\u8bc1\u5931\u8d25\u3002";e.val(""),n&&i.html(u),typeof t["fail"]=="function"&&t.fail(r)}else{var a=s.result.promo_amount||0,f=s.result.promo_per||0;f&&(a={promo_per:f});var l=parseFloat(s.result.full_cut)||0;typeof t["succ"]=="function"&&t.succ(a,l,r),r.find(".block-promo-cont").slideUp()}})}function i(e){var t=tcb.queryUrl(window.location.search,"product_id"),n=$('[name="redpacket_code"]').val();t||(t=window.location.pathname.replace("/youpin/product/","").replace(".html","")),$.post("/youpin/doGetYouhuiCodeList",{product_id:t,redpacket_code:n},function(t){try{t=$.parseJSON(t);if(!t.errno){var n=t.result.youhui_list_valid,r=t.result.youhui_list_invalid,i=n.length,s=e.$tpl.html().trim().tmpl(),o=s({list_able:n,list_disable:r});e.$target.html(o),e.$youhui_count_wrap&&e.$youhui_count_wrap.length>0&&(i>0?e.$youhui_count_wrap.html(i+"\u5f20\u4f18\u60e0\u5238\u53ef\u7528"):e.$youhui_count_wrap.html("\u6682\u65e0\u4f18\u60e0\u5238\u53ef\u7528")),typeof e.callback=="function"&&e.callback(n)}}catch(u){}})}window.Promo=function(r){function o(){s.trigger("change")}function u(e){r.price=e}function a(e){r.product_id=e}r=tcb.mix({url:"/aj/doGetYouhuiAmount",service_type:"",price:0,product_id:"",promo_wrap:".promo-wrap",succ:function(){},fail:function(){}},r,!0);var i=$(r.promo_wrap||".promo-wrap"),s=i.find('[name="youhui_code"]');if(!i||!i.length)return;return e(i,r),t(i),{oWrap:i,setPrice:u,setProductId:a,refreshPromoCode:o,refreshCoupon:n}}}(),function(){function s(e){tcb.bindEvent(document.body,{".need-hongbao-checkable":function(e){var t=$(this),n=t.find(".checkbox");if(!$.trim(r.html()))return;var s=i.val();r.slideToggle("slow",function(){t.hasClass("need-hongbao-checked")&&!s?t.removeClass("need-hongbao-checked"):(t.addClass("need-hongbao-checked"),r.find(".hongbao-item-able").filter(function(){return $(this).attr("data-code")==s}).addClass("hongbao-item-checked").siblings(".hongbao-item").removeClass("hongbao-item-checked"))})},".hongbao-item-able":function(t){t.preventDefault();var n=$(this),r=n.attr("data-code");n.hasClass("hongbao-item-checked")?(n.removeClass("hongbao-item-checked"),i.val(""),f(),typeof e.fail=="function"&&e.fail()):o({$trigger:n,code:r,succ:e.succ,fail:e.fail})}})}function o(e){e=e||{};var t=e.$trigger,n=e.code;c({code:n,succ:function(r){t&&t.length&&t.addClass("hongbao-item-checked").siblings(".hongbao-item").removeClass("hongbao-item-checked"),i.val(n),$(".hongbao-vaild-txt").html("\u5df2\u4f7f\u7528\u7ea2\u5305\u62b5\u6263"+r+"\u5143"),$(".need-hongbao-checkable").addClass("need-hongbao-checked"),typeof e.succ=="function"&&e.succ(r)},fail:function(){typeof e.fail=="function"&&e.fail()}})}function u(t){$.post("/youpin/doGetRedPacketList",{product_id:e},function(e){try{e=$.parseJSON(e);if(!e.errno){var n=e.result||{};typeof t=="function"&&t(n)}}catch(r){}})}function a(e){var t=$.tmpl($.trim($("#JsYoupinHongbaoListTpl").html())),n=t({hongbaoList:e});r.html(n)}function f(){u(function(e){var t=e.youhui_list_valid&&e.youhui_list_valid.length;l(t)})}function l(e){var t=n.find(".hongbao-vaild-txt");e>0?t.html(e+"\u4e2a\u7ea2\u5305\u53ef\u7528"):t.html("\u6682\u65e0\u53ef\u7528\u7ea2\u5305")}function c(n){var i={code:n.code,price:t,product_id:e};$.post("/youpin/doGetRedPacketAmount",i,function(e){e=$.parseJSON(e);if(!e.errno){var t=e.result.promo_amount||0;typeof n.succ=="function"&&n.succ(t),r.slideUp()}else alert(e.errmsg),typeof n.fail=="function"&&n.fail()})}function h(e,t){var n=null;tcb.each(e,function(e,t){n?t.promo_amount>n.promo_amount&&(n=t):n=t}),n&&n.code?o({code:n&&n.code,succ:t.succ,fail:t.fail}):l()}var e=$('[name="product_id"]').val(),t=$(".orderinfo-totalcount-desc-num").attr("data-origprice"),n=$(".block-hongbao"),r=n.find(".block-hongbao-cont"),i=$('[name="redpacket_code"]');window.Hongbao=function(e){e=tcb.mix({succ:function(){},fail:function(){}},e,!0),s(e),u(function(t){a(t),h(t&&t.youhui_list_valid,e)})}}(),$(function(){window.Bang.LoginFormByMobile({form_action:"/youpin/aj_my_login",selector_form:W("#JsTInfoMobileLoginForm"),selector_get_secode:".user-mobile-check-order-panel-getsecode",selector_vcode_img:".vcode-img",class_get_secode_disabled:"user-mobile-check-order-panel-getsecode-disabled"},function(e){window.location.href=window.location.href});var e=W("#JsTInfoMobileLoginForm").ancestorNodes(".tinfo-login-panel").query(".btn-go-back-close");e&&e.length&&e.on("click",function(e){e.preventDefault(),window.history.back(),setTimeout(function(){var e=tcb.queryUrl(window.location.search),t=e.product_id;window.location.href=tcb.setUrl2("/youpin/product/"+t+".html",{})},1e3)})}),Dom.ready(function(){function s(e){if(!e||!e.length)return!1;var t=!0,n=e.query('[name="receiver_name"]');n&&n.length&&n.val().trim()||(t=!1,n&&n.length&&n.shine4Error().focus());var r=e.query('[name="receiver_province_id"]');r&&r.length&&r.isVisible()&&(!r.val().trim()||r.val().trim()=="\u7701\u4efd")&&(t=!1,r.shine4Error());var i=e.query('[name="receiver_city_id"]');i&&i.length&&i.isVisible()&&(!i.val().trim()||i.val().trim()=="\u57ce\u5e02")&&(t=!1,i.shine4Error());var s=e.query('[name="receiver_area_id"]');s&&s.length&&s.isVisible()&&(!s.val().trim()||s.val().trim()=="\u533a\u53bf")&&(t=!1,s.shine4Error());var o=e.query('[name="receiver_address"]');o&&o.length&&o.val().trim()||(o&&o.length&&(o.shine4Error(),t&&o.focus()),t=!1);var u=e.query('[name="receiver_mobile"]'),a=u.val().trim();return u&&u.length&&tcb.validMobile(a)||(u&&u.length&&(u.shine4Error(),t&&u.focus()),t=!1),t}function o(n){n.on("submit",function(n){n.preventDefault();var r=W(this);if(!s(r))return!1;var i=r.query('[name="addr_id"]'),o="";i&&i.length&&(o=i.val()),r.attr("action","/aj/doEditUserAddr"),QW.Ajax.post(r[0],function(n){n=JSON.parse(n);if(!n.errno){var i=r.ancestorNode("."+t);i.length&&i.addClass(e).removeClass(t);var s=r.ancestorNode(".addrinfo-block"),u=n.result,a=!1;o&&(a=!0),h(s,{shipping_address_id:u.addr_id,address:{shipping_name:u.address.name,shipping_province:u.address.province,shipping_city:u.address.city,shipping_area:u.address.area,shipping_address_detail:u.address.address_detail,shipping_mobile:u.address.mobile},post_key:u.postkey},a)}else alert(n.errmsg)})})}function u(e){e=e||[];var t={flagAutoInit:!0,selectorProvince:'[name="receiver_province_id"]',selectorCity:'[name="receiver_city_id"]',selectorArea:'[name="receiver_area_id"]',province:e[0],city:e[1],area:e[2]};Bang.AddressSelect(t)}function a(){var e="",t=W("#ProductPostkey");return t.length&&(e=t.val()),e}function f(e){e=e||"";var t=W("#ProductPostkey");return t.length&&t.val(e),e}function l(e){W("#ProductYJId").val(e)}function c(e,t){t=t||{shipping_address:{id:"",receiver_name:"",province:"\u7701\u4efd",city:"\u57ce\u5e02",area:"\u533a\u53bf",address_detail:"",receiver_mobile:""},postkey:a()};var n=W("#JsLiangpinTinfoAddAddrTpl").html().trim().tmpl(),r=n(t),i=W(r);W(e).insertAdjacentElement("afterend",i[0]);var s=i.query("form");if(s.length){var f=t.shipping_address.province,l=t.shipping_address.city,c=t.shipping_address.area;u([f,l,c]),o(s)}}function h(e,t,n){var r='<div class="addrinfo-item selected"><input class="addrinfo-item-radio" type="radio" name="addr_id" value="'+t.shipping_address_id+'" checked>'+'<span class="mr8 addrinfo-item-receiver">'+t.address.shipping_name+"</span>"+'<span class="addrinfo-item-provincename">'+t.address.shipping_province+"</span>"+'<span class="addrinfo-item-cityname">'+t.address.shipping_city+"</span>"+'<span class="mr8 addrinfo-item-areaname">'+t.address.shipping_area+"</span>"+'<span class="mr8 addrinfo-item-addr">'+t.address.shipping_address_detail+"</span>"+'<span class="addrinfo-item-mobile">'+t.address.shipping_mobile+"</span>"+'<a href="#" class="addrinfo-item-edit">\u7f16\u8f91</a>'+"</div>";!n&&e.siblings(".addrinfo-item").length<4&&(r+='<div class="addrinfo-item addrinfo-item-add"><input class="addrinfo-item-radio" type="radio" name="addr_id" value=""><span>\u6dfb\u52a0\u65b0\u5730\u5740</span></div>'),e.previousSibling(".addrinfo-item").removeNode(),e.insertAdjacentHTML("beforebegin",r),e.removeNode(),l(t.shipping_address_id),f(t.post_key)}var e="addrinfo-block-wrap",t="addrinfo-block-wrap-noborder",n="addrinfo-block",r="addrinfo-item";tcb.bindEvent(document.body,{".addrinfo-item":{click:function(e){var t=W(e.target);t[0].nodeName.toLowerCase()=="input"?e.stopPropagation():e.preventDefault();var n=W(this),r=n.query("input"),i=r.val();r.attr("checked","checked"),n.addClass("selected").siblings(".selected").removeClass("selected"),l(i);if(t.hasClass("addrinfo-item-edit"))return;n.siblings(".addrinfo-block").removeNode(),n.hasClass("addrinfo-item-add")&&(n.siblings(".addrinfo-item").length==3?alert("\u62b1\u6b49\uff0c\u60a8\u6700\u591a\u53ea\u80fd\u6dfb\u52a0\u4e09\u4e2a\u6536\u8d27\u5730\u5740"):c(n[0]))},mouseenter:function(e){var t=W(this);t.addClass("hover"),t.query(".addrinfo-item-edit").show()},mouseleave:function(e){var t=W(this);t.removeClass("hover"),t.query(".addrinfo-item-edit").hide()}},".addrinfo-item-edit":function(e){e.preventDefault();var t=W(this),n=t.ancestorNode(".addrinfo-item");n.siblings(".addrinfo-block").removeNode(),n.one(".addrinfo-item-radio").attr("checked","checked");var r={shipping_address:{id:n.one(".addrinfo-item-radio").val(),receiver_name:n.one(".addrinfo-item-receiver").html(),province:n.one(".addrinfo-item-provincename").html(),city:n.one(".addrinfo-item-cityname").html(),area:n.one(".addrinfo-item-areaname").html(),address_detail:n.one(".addrinfo-item-addr").html(),receiver_mobile:n.one(".addrinfo-item-mobile").html()},postkey:a()};c(n[0],r)}});var i=W("#AddAddrInfoForm");i.length&&(o(i),u())}),Dom.ready(function(){function e(e){if(!e||!e.length)return!1;var t=!0,n=W(".mobile-order-block");if(n.length){var r=W("#MobileOrderMobile"),i=r.val().trim();tcb.validMobile(i)||(t=!1,r.shine4Error().focus());var s=W("#MobileOrderSecode"),o=s.val().trim();o||(t?s.shine4Error().focus():s.shine4Error(),t=!1);if(!t)return t;W('[name="buyer_mobile"]').val(i),W('[name="secode"]').val(o)}var u=e.query("#ProductYJId");if(!(u&&u.length&&u.val().trim())){t=!1;var a=W("#AddAddrInfoForm");return a.length?(tcb.setScrollTop(a.getRect().top-50),a.query(".add-addr-submit").click()):(alert("\u8bf7\u9009\u62e9\u6536\u8d27\u4eba\u4fe1\u606f"),tcb.setScrollTop(W(".addrinfo-block-wrap").getRect().top)),t}return t}function n(e){var t=(new Date).getTime(),n=window.remain_time||window.locked_time||1800,r=t+n*1e3;Bang.startCountdown(r,t,e,{end:function(){window.location.reload()}})}function r(e,t){e=e||"";var n="/youpin/doGetPaystatus?order_id="+e;QW.Ajax.get(n,function(e){var n=!1;try{e=JSON.parse(e);if(!e.errno){var r=e.result;r["payStatus"]=="1"&&(n=!0),typeof t=="function"&&t(n)}else alert(e.errmsg)}catch(i){}})}function i(e){var t=e.order_id,i="/youpin/qrcode/?order_id="+t+"&weixin_pay=1",s='<div style="padding:10px 10px 0 10px;"><div class="pay-countdown js-pay-countdown clearfix" data-descbefore="\u60a8\u53ea\u5269" data-descbehind="\u652f\u4ed8\u65f6\u95f4" data-daytxt="" data-hourtxt="\u5c0f\u65f6" data-minutetxt="\u5206" data-secondtxt="\u79d2"></div><h2 style="font-weight:bold; text-align:center">\u8bf7\u7528\u624b\u673a\u626b\u63cf\u4e0b\u9762\u7684\u4e8c\u7ef4\u7801\u8fdb\u884c\u652f\u4ed8</h2><div style="text-align:center"><img style="background:url(https://p.ssl.qhimg.com/t017ee3be501e423c98.gif) no-repeat center" width="220" height="220" src="'+i+'">'+"</div>"+'<div id="WXPayNotSuccessTip" style="display:none;text-align:center;color: #f30;">\u8fd8\u672a\u6536\u5230\u60a8\u7684\u4ed8\u6b3e\uff0c\u8bf7\u7a0d\u5019\u518d\u8bd5</div>'+"</div>",o=tcb.queryUrl(location.href),u={order_id:t,from:o.from,iframe:o.iframe},a=tcb.alert("\u5fae\u4fe1\u652f\u4ed8",s,{btn_name:"\u5df2\u5b8c\u6210\u652f\u4ed8",width:300},function(){return r(t,function(e){e?(u.paysuccess=1,window.location.href=tcb.setUrl("/liangpin_my/order_detail",u)):W("#WXPayNotSuccessTip").show()}),!1});a.on("afterhide",function(){window.location.href=tcb.setUrl("/liangpin_my/order_detail",u)});var f=W(".js-pay-countdown");n(f)}function s(e){var t=e.order_id,n="/youpin/qrcode/?order_id="+t,r='<div style="padding:10px;"><h2 style="font-weight:bold; text-align:center">\u8bf7\u7528\u624b\u673a\u626b\u63cf\u4e0b\u9762\u7684\u4e8c\u7ef4\u7801\u8fdb\u884c\u652f\u4ed8</h2><div style="text-align:center"><img style="background:url(https://p.ssl.qhimg.com/t017ee3be501e423c98.gif) no-repeat center" width="220" height="220" src="'+n+'">'+"</div></div>",i=tcb.queryUrl(location.href),s={order_id:t,from:i.from,iframe:i.iframe},o=tcb.alert("\u624b\u673a\u652f\u4ed8\u5b9d",r,{width:300,height:350},function(){return!0});o.on("afterhide",function(){window.location.href=tcb.setUrl("/liangpin_my/order_detail",s)})}function o(e){var t=e.order_id,n=W("#JsLiangpinOrderSuccessHDFKPanelTpl").html().trim().tmpl(),r=n({order_id:t,order_price:e.real_amount,customer_name:e.yj_receiver,customer_mobile:e.yj_mobile,customer_address:e.yj_addr,url_redirect:tcb.setUrl("/youpin")}),i=tcb.queryUrl(location.href),s={order_id:t,from:i.from,iframe:i.iframe},o=tcb.panel("",r,{className:"liangpin-pay-confirm-panel-wrap"});o.on("afterhide",function(){window.location.href=tcb.setUrl("/liangpin_my/order_detail",s)})}function u(e){var t=e.order_id,r=tcb.queryUrl(location.href),i={order_id:t,from:r.from,iframe:r.iframe},s={order_id:e.order_id,order_price:e.real_amount,customer_name:e.yj_receiver,customer_mobile:e.yj_mobile,customer_address:e.yj_addr,url_mod_order:tcb.setUrl("/liangpin_my/order_detail",i),url_pay_order:tcb.setUrl("/youpin/subpay",i)},o=W("#LiangpinPayConfirmPanelTpl").html().trim().tmpl(),u=o(s),a=tcb.panel("",u,{className:"liangpin-pay-confirm-panel-wrap"});a.on("afterhide",function(){window.location.href=s.url_mod_order});var f=W(".js-pay-countdown");n(f)}var t=W("#LiangpinProductSubOrderForm");t.length&&t.on("submit",function(t){t.preventDefault();var n=W(this);if(tcb.isFormDisabled(n))return!1;tcb.setFormDisabled(n);if(!e(n))return tcb.releaseFormDisabled(n),!1;tcb.ajax({url:n[0],method:"post",onsucceed:function(e){try{e=JSON.parse(e);if(!e.errno){var t=e.result,r=t.order_id,i={order_id:r},s=tcb.queryUrl(window.location.search,"huabei_stage");s&&(i.huabei_stage=s),window.location.href=tcb.setUrl("/youpin/cashier",i)}else alert(e.errmsg),tcb.releaseFormDisabled(n)}catch(o){alert("\u7cfb\u7edf\u5f02\u5e38\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u91cd\u8bd5"),tcb.releaseFormDisabled(n)}},ontimeout:function(){alert("\u7cfb\u7edf\u8d85\u65f6\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u91cd\u8bd5"),tcb.releaseFormDisabled(n)},onerror:function(){alert("\u7cfb\u7edf\u5f02\u5e38\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u91cd\u8bd5"),tcb.releaseFormDisabled(n)}})})}),function(){function e(e){var t=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i;return t.test(e)?!0:!1}function t(e){var t=!0;return e.length!==15&&e.length!==18?(t=!1,alert("\u7eb3\u7a0e\u8bc6\u522b\u53f7\u6216\u7edf\u4e00\u4fe1\u7528\u4ee3\u7801\u53ea\u80fd\u4e3a15\u621618\u4f4d")):/^[\d\w]+$/.test(e)||(t=!1,alert("\u7eb3\u7a0e\u8bc6\u522b\u53f7\u6216\u7edf\u4e00\u4fe1\u7528\u4ee3\u7801\u53ea\u80fd\u5305\u542b\u6570\u5b57\u6216\u5b57\u6bcd")),t}Dom.ready(function(){function t(){var e=W('[name="invoice_flag"]').val()||10,t=W('[name="invoice_title_type"]').val()||1,n=W('[name="invoice_title"]').val()||"\u4e2a\u4eba",r=W('[name="invoice_credit_code"]').val()||"",i=W("#JsChangeFapiaoInfoPanelTpl").html().trim().tmpl()({invoice_flag:e,invoice_title_type:t,invoice_title:n,invoice_credit_code:r});window.changeFapiaoInfoPanel=tcb.panel("\u53d1\u7968\u4fe1\u606f",i,{className:"change-fapiao-info-panel"}),new PlaceHolder(".fapiao-input-email"),new PlaceHolder(".fapiao-input-company"),new PlaceHolder(".fapiao-input-credit-code")}var e=W(".need-fapiao-checkable");if(!e||!e.length)return;tcb.bindEvent(document.body,{".need-fapiao-checkable .checkbox":function(e){e.preventDefault();var t=W(".need-fapiao-checkable"),n=W(".fapiao-block .block-fapiao-tip");window.__FaPiao_Cache=window.__FaPiao_Cache||{},t.hasClass("need-fapiao-checked")?(t.removeClass("need-fapiao-checked"),n.slideUp()):(t.addClass("need-fapiao-checked"),n.slideDown())}})})}(),!function(){if(window.__PageSymbol!="tinfo")return;Dom.ready(function(){function n(){if(QW.Cookie.get("tinfo_vip_user_sf_free_not_show_again"))return;e.show(),t.show(),i()}function r(){tcb.bindEvent(document.body,{".btn-confirm-vip-user-sf-free":function(n){n.preventDefault(),W('[name="not_show_again"]').attr("checked")&&QW.Cookie.set("tinfo_vip_user_sf_free_not_show_again","1"),e.fadeOut(),t.fadeOut()}})}function i(){var n=t.getRect(),r=n.width,i=QW.DomU.getDocRect(),s=i.width,o=i.scrollWidth,u=i.scrollHeight,a=(s-r)/2;a>0&&t.css({left:a,margin:"0"}),e.css({width:o,height:u})}function s(){n(),r()}var e=W(".panel-cover-vip-user-sf-free"),t=W(".panel-vip-user-sf-free");t&&t.length&&s()})}(),function(){function e(){var e=$(".line-submit"),t=$(".line-submit-placeholder");e.length&&t.length&&$(window).on("scroll resize",function(){var n=t.offset().top+e.height(),r=$(window).height(),i=n-r,s=$(window).scrollTop();s<=i?e.css({position:"fixed",left:"50%","margin-left":"-600px",bottom:"0"}):e.css({position:"static","margin-left":"0px"})})}Dom.ready(function(){function i(){setTimeout(function(){W(".added-server-list-checklable").forEach(function(e,t){var n=W(e);n.hasClass("added-server-list-checklable-checked")||n.query("input").attr("checked",!1)})},10)}function u(e,t,r,i){var s=n.getProductOriginPrice();n.setProductPriceInfo(e,t);var o=n.calculateProductPrice();o=Math.max(0,tcb.formatMoney(o,2,-1));var u="\uffe5"+o;$(".orderinfo-totalcount-desc-num").html(u),a()}function a(){var e=n,t=e.getProductOriginPrice(),r=e.getProductPriceInfoByProp("price_hongbao")||0,i=e.getProductPriceInfoByProp("price_promo")||0,s=e.getProductPriceInfoByProp("origin_price_promo_per")||0;r=Math.abs(r||0),$(".hongbao-price").html("-\uffe5"+r.toFixed(2)),s&&(i=tcb.formatMoney(t*(100-s)/100,0,1)),i=Math.abs(i||0),$(".product-price").html("\uffe5"+t);var o=i>0?"#FE4B00":"#333";$(".discount-price").html("-\uffe5"+i.toFixed(2));var u=0;$(".added-server-list-checklable-checked").each(function(e,t){var n=$(t);u+=n.attr("data-plusprice")-0}),$(".extend-service-price").html("\uffe5"+u.toFixed(2))}function l(){var e=W(".tinfo-login-panel");if(e&&e.length){var t=e.getRect(),n=t.width,r=QW.DomU.getDocRect(),i=r.width,s=r.scrollWidth,o=r.scrollHeight,u=(i-n)/2;u>0&&e.css({left:u,margin:"0"});var a=W(".tinfo-login-cover");a.css({width:s,height:o})}}var e=window.Bang=window.Bang||{},t=W(".orderinfo-totalcount-desc-num"),n=e.PriceCalculate({origin_price:t.attr("data-origprice")}),r;tcb.bindEvent(document.body,{".payinfo-block .payinfo-bank-code":function(e){var t=W(this),n=W(".line-bank"),r=W('[name="bank_code"]');if(t.val()==="wangyin"){n.slideDown();var i=n.query(".selected");i.length?r.val(i.attr("data-code")):r.val("")}else n.slideUp(),r.val(t.val())},".payinfo-block .bank-list li":function(e){e.preventDefault();var t=W(this);t.addClass("selected").siblings("li").removeClass("selected"),W('[name="bank_code"]').val(t.attr("data-code"))},".payinfo-block2 .payinfo-bank-code":function(e){var t=W(this),n=W(".line-bank"),r=W('[name="bank_code"]');if(t.val()==="wangyin"){n.slideDown();var i=n.query('[name="banklist"]');i.length?r.val(i.val()):r.val("")}else n.slideUp(),r.val(t.val())},".payinfo-block3 .pay-label":function(e){var t=W(this),n=t.query("input"),r=W(".line-bank"),i=W('[name="bank_code"]');if(t.query("span").hasClass("pay-daofu-disabled"))return;n.attr("checked",!0);var s=n.val();if(s==="wangyin"){r.slideDown();var o=r.query('[name="banklist"]');o.length?i.val(o.val()):i.val("")}else r.slideUp(),i.val(s);var u='<span style="color: #ff0000;">\u5728\u7ebf\u652f\u4ed8\uff0c\u5168\u56fd\u5305\u90ae\uff01</span>\u5982\u9047\u95ee\u9898\uff0c\u8bf7\u52a0qq\u7fa4\uff1a488049033\uff0c\u54a8\u8be2\u201c\u4f18\u54c1\u7b54\u7591\u201d';s==="hdfk"&&(u='<span style="color: #ff0000;">\u8d27\u5230\u4ed8\u6b3e\uff1a\u4e0d\u5305\u90ae\uff0c\u90ae\u8d39\u5230\u4ed8\uff01</span>\uff08\u9999\u6e2f\uff0c\u6fb3\u95e8\uff0c\u53f0\u6e7e\u5730\u533a\u6682\u4e0d\u652f\u6301\u8d27\u5230\u4ed8\u6b3e\uff09'),W(".zhifu-tips").html(u),t.addClass("pay-label-checked").siblings(".pay-label-checked").removeClass("pay-label-checked")},'.payinfo-block2 .line-bank [name="banklist"], .payinfo-block3 .line-bank [name="banklist"]':{change:function(e){var t=W(this);W('[name="bank_code"]').val(t.val())}},".added-server-list-checklable":function(e){e.preventDefault();var t=W(this),n=t.query(".added-server-name").html().trim(),i=t.attr("data-img"),s=t.attr("data-extend-img"),o=t.attr("data-extend-img-id"),a=t.query('[name="value_added_server_list[]"]'),f=a.val(),l=t.ancestorNode(".added-server-list-checklable-wrap").siblings(".added-server-info");if(t.hasClass("added-server-list-checklable-checked"))t.removeClass("added-server-list-checklable-checked"),a.attr("checked",!1),l.hide(),u("price_added_server_"+f,0,0,Promo.oWrap);else{var c=W("#JsLiangPinAddedServerConfirmPanelTpl").html().tmpl()({added_id:f,added_title:n,added_img:i,added_extend_img:s,added_extend_img_id:o});r=tcb.panel("",c,{className:"extendservice-confirm-panel-wrap"})}},".extendservice-confirm-panel-wrap .btn-confirm":function(e){e.preventDefault();var t=W(this),n=t.attr("data-id"),i=W(".added-server-list-checklable").filter(function(e){return W(e).attr("data-id")==t.attr("data-id")}),s=i.query('[name="value_added_server_list[]"]'),o=i.ancestorNode(".added-server-list-checklable-wrap").siblings(".added-server-info");i.addClass("added-server-list-checklable-checked"),s.attr("checked",!0),u("price_added_server_"+n,i.attr("data-plusprice"),0,Promo.oWrap),r&&r.hide&&r.hide(),o.show()},".extendservice-confirm-panel-wrap .btn-cancel":function(e){e.preventDefault(),r&&r.hide&&r.hide()},".extendservice-confirm-panel-wrap .js-open-another-dialog":function(e){e.preventDefault();var t=W(this),n=t.attr("data-extend-id"),r="";n=="JsWuYouHuanJiAgreementPanelTpl"&&(r=W("#JsWuYouHuanJiAgreementPanelTpl").html().trim().tmpl()()),tcb.panel("",r,{className:"extendservice-agreement-panel panel-tom01"})}}),i();var s=Promo({service_type:3,price:$(".orderinfo-totalcount-desc-num").attr("data-origprice"),product_id:$('[name="product_id"]').val(),promo_wrap:".promo-wrap",succ:function(e,t,r){typeof e=="object"?(n.deleteProductPriceInfoByProp("price_promo"),u("origin_price_promo_per",e.promo_per,t,r)):(n.deleteProductPriceInfoByProp("origin_price_promo_per"),u("price_promo",-e,t,r))},fail:function(e){n.deleteProductPriceInfoByProp("origin_price_promo_per"),u("price_promo",0,0)}}),o=Hongbao({succ:function(e){var t=$('[name="youhui_code"]'),r=t.val();s.setPrice(n.getProductOriginPrice()-e),s.refreshCoupon(function(e){var n=!1;tcb.each(e,function(e,t){r==t.code&&(n=!0,$("[data-code="+r+"]").addClass("coupon-item-checked"))}),n||(t.val(""),$(".need-promo-checked").removeClass("need-promo-checked"),s.refreshPromoCode())}),u("price_hongbao",-e)},fail:function(){var e=$('[name="youhui_code"]'),t=e.val();s.setPrice(n.getProductOriginPrice()-0),s.refreshCoupon(function(e){tcb.each(e,function(e,n){t==n.code&&$("[data-code="+t+"]").addClass("coupon-item-checked")})}),u("price_hongbao",0)}});a();var f=W(".payinfo-block3 .pay-label");f&&f.length&&f.first().fire("click"),l()}),e()}();