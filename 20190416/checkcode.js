KISSY.use("node, event, dom",function(a){"file:"===window.location.protocol||window.location.href.indexOf("local=1")>=0,window.location.href.indexOf("daily.taobao.net")>0;a.config({combine:!0}),a.ready(function(a){!function(){var b=a.one(".J_AllowIframe")&&a.one(".J_AllowIframe").val()||"";b||window.self===window.top||(window.top.location.href=window.self.location.href)}()})});KISSY.add("register/atp",function(a){var b={fire:function(b,c){if(b=a.isString(b)?b:""){var d=new Image;c=a.isPlainObject(c)||a.isString(c)?a.isPlainObject(c)?a.param(c):c:"",d.src=b+(b.indexOf("?")>=0?"&":"?")+c}}};return b});!function(a){if("function"==typeof bootstrap)bootstrap("promise",a);else if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=a}else Q=a()}(function(){"use strict";function a(a){return function(){return V.apply(a,arguments)}}function b(a){return a===Object(a)}function c(a){return"[object StopIteration]"===ba(a)||a instanceof R}function d(a,b){if(O&&b.stack&&"object"==typeof a&&null!==a&&a.stack&&-1===a.stack.indexOf(ca)){for(var c=[],d=b;d;d=d.source)d.stack&&c.unshift(d.stack);c.unshift(a.stack);var f=c.join("\n"+ca+"\n");a.stack=e(f)}}function e(a){for(var b=a.split("\n"),c=[],d=0;d<b.length;++d){var e=b[d];h(e)||f(e)||!e||c.push(e)}return c.join("\n")}function f(a){return-1!==a.indexOf("(module.js:")||-1!==a.indexOf("(node.js:")}function g(a){var b=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(a);if(b)return[b[1],Number(b[2])];var c=/at ([^ ]+):(\d+):(?:\d+)$/.exec(a);if(c)return[c[1],Number(c[2])];var d=/.*@(.+):(\d+)$/.exec(a);return d?[d[1],Number(d[2])]:void 0}function h(a){var b=g(a);if(!b)return!1;var c=b[0],d=b[1];return c===Q&&d>=S&&ga>=d}function i(){if(O)try{throw new Error}catch(a){var b=a.stack.split("\n"),c=b[0].indexOf("@")>0?b[1]:b[2],d=g(c);if(!d)return;return Q=d[0],d[1]}}function j(a,b,c){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(b+" is deprecated, use "+c+" instead.",new Error("").stack),a.apply(a,arguments)}}function k(a){return r(a)?a:s(a)?B(a):A(a)}function l(){function a(a){b=a,f.source=a,X(c,function(b,c){U(function(){a.promiseDispatch.apply(a,c)})},void 0),c=void 0,d=void 0}var b,c=[],d=[],e=$(l.prototype),f=$(o.prototype);if(f.promiseDispatch=function(a,e,f){var g=W(arguments);c?(c.push(g),"when"===e&&f[1]&&d.push(f[1])):U(function(){b.promiseDispatch.apply(b,g)})},f.valueOf=function(){if(c)return f;var a=q(b);return r(a)&&(b=a),a},f.inspect=function(){return b?b.inspect():{state:"pending"}},k.longStackSupport&&O)try{throw new Error}catch(g){f.stack=g.stack.substring(g.stack.indexOf("\n")+1)}return e.promise=f,e.resolve=function(c){b||a(k(c))},e.fulfill=function(c){b||a(A(c))},e.reject=function(c){b||a(z(c))},e.notify=function(a){b||X(d,function(b,c){U(function(){c(a)})},void 0)},e}function m(a){if("function"!=typeof a)throw new TypeError("resolver must be a function.");var b=l();try{a(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}return b.promise}function n(a){return m(function(b,c){for(var d=0,e=a.length;e>d;d++)k(a[d]).then(b,c)})}function o(a,b,c){void 0===b&&(b=function(a){return z(new Error("Promise does not support operation: "+a))}),void 0===c&&(c=function(){return{state:"unknown"}});var d=$(o.prototype);if(d.promiseDispatch=function(c,e,f){var g;try{g=a[e]?a[e].apply(d,f):b.call(d,e,f)}catch(h){g=z(h)}c&&c(g)},d.inspect=c,c){var e=c();"rejected"===e.state&&(d.exception=e.reason),d.valueOf=function(){var a=c();return"pending"===a.state||"rejected"===a.state?d:a.value}}return d}function p(a,b,c,d){return k(a).then(b,c,d)}function q(a){if(r(a)){var b=a.inspect();if("fulfilled"===b.state)return b.value}return a}function r(a){return b(a)&&"function"==typeof a.promiseDispatch&&"function"==typeof a.inspect}function s(a){return b(a)&&"function"==typeof a.then}function t(a){return r(a)&&"pending"===a.inspect().state}function u(a){return!r(a)||"fulfilled"===a.inspect().state}function v(a){return r(a)&&"rejected"===a.inspect().state}function w(){da.length=0,ea.length=0,fa||(fa=!0)}function x(a,b){fa&&(ea.push(a),b&&"undefined"!=typeof b.stack?da.push(b.stack):da.push("(no stack) "+b))}function y(a){if(fa){var b=Y(ea,a);-1!==b&&(ea.splice(b,1),da.splice(b,1))}}function z(a){var b=o({when:function(b){return b&&y(this),b?b(a):this}},function(){return this},function(){return{state:"rejected",reason:a}});return x(b,a),b}function A(a){return o({when:function(){return a},get:function(b){return a[b]},set:function(b,c){a[b]=c},"delete":function(b){delete a[b]},post:function(b,c){return null===b||void 0===b?a.apply(void 0,c):a[b].apply(a,c)},apply:function(b,c){return a.apply(b,c)},keys:function(){return aa(a)}},void 0,function(){return{state:"fulfilled",value:a}})}function B(a){var b=l();return U(function(){try{a.then(b.resolve,b.reject,b.notify)}catch(c){b.reject(c)}}),b.promise}function C(a){return o({isDef:function(){}},function(b,c){return I(a,b,c)},function(){return k(a).inspect()})}function D(a,b,c){return k(a).spread(b,c)}function E(a){return function(){function b(a,b){var g;if("undefined"==typeof StopIteration){try{g=d[a](b)}catch(h){return z(h)}return g.done?k(g.value):p(g.value,e,f)}try{g=d[a](b)}catch(h){return c(h)?k(h.value):z(h)}return p(g,e,f)}var d=a.apply(this,arguments),e=b.bind(b,"next"),f=b.bind(b,"throw");return e()}}function F(a){k.done(k.async(a)())}function G(a){throw new R(a)}function H(a){return function(){return D([this,J(arguments)],function(b,c){return a.apply(b,c)})}}function I(a,b,c){return k(a).dispatch(b,c)}function J(a){return p(a,function(a){var b=0,c=l();return X(a,function(d,e,f){var g;r(e)&&"fulfilled"===(g=e.inspect()).state?a[f]=g.value:(++b,p(e,function(d){a[f]=d,0===--b&&c.resolve(a)},c.reject,function(a){c.notify({index:f,value:a})}))},void 0),0===b&&c.resolve(a),c.promise})}function K(a){return p(a,function(a){return a=Z(a,k),p(J(Z(a,function(a){return p(a,T,T)})),function(){return a})})}function L(a){return k(a).allSettled()}function M(a,b){return k(a).then(void 0,void 0,b)}function N(a,b){return k(a).nodeify(b)}var O=!1;try{throw new Error}catch(P){O=!!P.stack}var Q,R,S=i(),T=function(){},U=function(){function a(){for(;b.next;){b=b.next;var c=b.task;b.task=void 0;var e=b.domain;e&&(b.domain=void 0,e.enter());try{c()}catch(g){if(f)throw e&&e.exit(),setTimeout(a,0),e&&e.enter(),g;setTimeout(function(){throw g},0)}e&&e.exit()}d=!1}var b={task:void 0,next:null},c=b,d=!1,e=void 0,f=!1;if(U=function(a){c=c.next={task:a,domain:f&&process.domain,next:null},d||(d=!0,e())},"undefined"!=typeof process&&process.nextTick)f=!0,e=function(){process.nextTick(a)};else if("function"==typeof setImmediate)e="undefined"!=typeof window?setImmediate.bind(window,a):function(){setImmediate(a)};else if("undefined"!=typeof MessageChannel){var g=new MessageChannel;g.port1.onmessage=function(){e=h,g.port1.onmessage=a,a()};var h=function(){g.port2.postMessage(0)};e=function(){setTimeout(a,0),h()}}else e=function(){setTimeout(a,0)};return U}(),V=Function.call,W=a(Array.prototype.slice),X=a(Array.prototype.reduce||function(a,b){var c=0,d=this.length;if(1===arguments.length)for(;;){if(c in this){b=this[c++];break}if(++c>=d)throw new TypeError}for(;d>c;c++)c in this&&(b=a(b,this[c],c));return b}),Y=a(Array.prototype.indexOf||function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),Z=a(Array.prototype.map||function(a,b){var c=this,d=[];return X(c,function(e,f,g){d.push(a.call(b,f,g,c))},void 0),d}),$=Object.create||function(a){function b(){}return b.prototype=a,new b},_=a(Object.prototype.hasOwnProperty),aa=Object.keys||function(a){var b=[];for(var c in a)_(a,c)&&b.push(c);return b},ba=a(Object.prototype.toString);R="undefined"!=typeof ReturnValue?ReturnValue:function(a){this.value=a};var ca="From previous event:";k.resolve=k,k.nextTick=U,k.longStackSupport=!1,k.defer=l,l.prototype.makeNodeResolver=function(){var a=this;return function(b,c){b?a.reject(b):arguments.length>2?a.resolve(W(arguments,1)):a.resolve(c)}},k.Promise=m,k.promise=m,m.race=n,m.all=J,m.reject=z,m.resolve=k,k.passByCopy=function(a){return a},o.prototype.passByCopy=function(){return this},k.join=function(a,b){return k(a).join(b)},o.prototype.join=function(a){return k([this,a]).spread(function(a,b){if(a===b)return a;throw new Error("Can't join: not the same: "+a+" "+b)})},k.race=n,o.prototype.race=function(){return this.then(k.race)},k.makePromise=o,o.prototype.toString=function(){return"[object Promise]"},o.prototype.then=function(a,b,c){function e(b){try{return"function"==typeof a?a(b):b}catch(c){return z(c)}}function f(a){if("function"==typeof b){d(a,h);try{return b(a)}catch(c){return z(c)}}return z(a)}function g(a){return"function"==typeof c?c(a):a}var h=this,i=l(),j=!1;return U(function(){h.promiseDispatch(function(a){j||(j=!0,i.resolve(e(a)))},"when",[function(a){j||(j=!0,i.resolve(f(a)))}])}),h.promiseDispatch(void 0,"when",[void 0,function(a){var b,c=!1;try{b=g(a)}catch(d){if(c=!0,!k.onerror)throw d;k.onerror(d)}c||i.notify(b)}]),i.promise},k.when=p,o.prototype.thenResolve=function(a){return this.then(function(){return a})},k.thenResolve=function(a,b){return k(a).thenResolve(b)},o.prototype.thenReject=function(a){return this.then(function(){throw a})},k.thenReject=function(a,b){return k(a).thenReject(b)},k.nearer=q,k.isPromise=r,k.isPromiseAlike=s,k.isPending=t,o.prototype.isPending=function(){return"pending"===this.inspect().state},k.isFulfilled=u,o.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},k.isRejected=v,o.prototype.isRejected=function(){return"rejected"===this.inspect().state};var da=[],ea=[],fa=!0;k.resetUnhandledRejections=w,k.getUnhandledReasons=function(){return da.slice()},k.stopUnhandledRejectionTracking=function(){w(),fa=!1},w(),k.reject=z,k.fulfill=A,k.master=C,k.spread=D,o.prototype.spread=function(a,b){return this.all().then(function(b){return a.apply(void 0,b)},b)},k.async=E,k.spawn=F,k["return"]=G,k.promised=H,k.dispatch=I,o.prototype.dispatch=function(a,b){var c=this,d=l();return U(function(){c.promiseDispatch(d.resolve,a,b)}),d.promise},k.get=function(a,b){return k(a).dispatch("get",[b])},o.prototype.get=function(a){return this.dispatch("get",[a])},k.set=function(a,b,c){return k(a).dispatch("set",[b,c])},o.prototype.set=function(a,b){return this.dispatch("set",[a,b])},k.del=k["delete"]=function(a,b){return k(a).dispatch("delete",[b])},o.prototype.del=o.prototype["delete"]=function(a){return this.dispatch("delete",[a])},k.mapply=k.post=function(a,b,c){return k(a).dispatch("post",[b,c])},o.prototype.mapply=o.prototype.post=function(a,b){return this.dispatch("post",[a,b])},k.send=k.mcall=k.invoke=function(a,b){return k(a).dispatch("post",[b,W(arguments,2)])},o.prototype.send=o.prototype.mcall=o.prototype.invoke=function(a){return this.dispatch("post",[a,W(arguments,1)])},k.fapply=function(a,b){return k(a).dispatch("apply",[void 0,b])},o.prototype.fapply=function(a){return this.dispatch("apply",[void 0,a])},k["try"]=k.fcall=function(a){return k(a).dispatch("apply",[void 0,W(arguments,1)])},o.prototype.fcall=function(){return this.dispatch("apply",[void 0,W(arguments)])},k.fbind=function(a){var b=k(a),c=W(arguments,1);return function(){return b.dispatch("apply",[this,c.concat(W(arguments))])}},o.prototype.fbind=function(){var a=this,b=W(arguments);return function(){return a.dispatch("apply",[this,b.concat(W(arguments))])}},k.keys=function(a){return k(a).dispatch("keys",[])},o.prototype.keys=function(){return this.dispatch("keys",[])},k.all=J,o.prototype.all=function(){return J(this)},k.allResolved=j(K,"allResolved","allSettled"),o.prototype.allResolved=function(){return K(this)},k.allSettled=L,o.prototype.allSettled=function(){return this.then(function(a){return J(Z(a,function(a){function b(){return a.inspect()}return a=k(a),a.then(b,b)}))})},k.fail=k["catch"]=function(a,b){return k(a).then(void 0,b)},o.prototype.fail=o.prototype["catch"]=function(a){return this.then(void 0,a)},k.progress=M,o.prototype.progress=function(a){return this.then(void 0,void 0,a)},k.fin=k["finally"]=function(a,b){return k(a)["finally"](b)},o.prototype.fin=o.prototype["finally"]=function(a){return a=k(a),this.then(function(b){return a.fcall().then(function(){return b})},function(b){return a.fcall().then(function(){throw b})})},k.done=function(a,b,c,d){return k(a).done(b,c,d)},o.prototype.done=function(a,b,c){var e=function(a){U(function(){if(d(a,f),!k.onerror)throw a;k.onerror(a)})},f=a||b||c?this.then(a,b,c):this;"object"==typeof process&&process&&process.domain&&(e=process.domain.bind(e)),f.then(void 0,e)},k.timeout=function(a,b,c){return k(a).timeout(b,c)},o.prototype.timeout=function(a,b){var c=l(),d=setTimeout(function(){b&&"string"!=typeof b||(b=new Error(b||"Timed out after "+a+" ms"),b.code="ETIMEDOUT"),c.reject(b)},a);return this.then(function(a){clearTimeout(d),c.resolve(a)},function(a){clearTimeout(d),c.reject(a)},c.notify),c.promise},k.delay=function(a,b){return void 0===b&&(b=a,a=void 0),k(a).delay(b)},o.prototype.delay=function(a){return this.then(function(b){var c=l();return setTimeout(function(){c.resolve(b)},a),c.promise})},k.nfapply=function(a,b){return k(a).nfapply(b)},o.prototype.nfapply=function(a){var b=l(),c=W(a);return c.push(b.makeNodeResolver()),this.fapply(c).fail(b.reject),b.promise},k.nfcall=function(a){var b=W(arguments,1);return k(a).nfapply(b)},o.prototype.nfcall=function(){var a=W(arguments),b=l();return a.push(b.makeNodeResolver()),this.fapply(a).fail(b.reject),b.promise},k.nfbind=k.denodeify=function(a){var b=W(arguments,1);return function(){var c=b.concat(W(arguments)),d=l();return c.push(d.makeNodeResolver()),k(a).fapply(c).fail(d.reject),d.promise}},o.prototype.nfbind=o.prototype.denodeify=function(){var a=W(arguments);return a.unshift(this),k.denodeify.apply(void 0,a)},k.nbind=function(a,b){var c=W(arguments,2);return function(){function d(){return a.apply(b,arguments)}var e=c.concat(W(arguments)),f=l();return e.push(f.makeNodeResolver()),k(d).fapply(e).fail(f.reject),f.promise}},o.prototype.nbind=function(){var a=W(arguments,0);return a.unshift(this),k.nbind.apply(void 0,a)},k.nmapply=k.npost=function(a,b,c){return k(a).npost(b,c)},o.prototype.nmapply=o.prototype.npost=function(a,b){var c=W(b||[]),d=l();return c.push(d.makeNodeResolver()),this.dispatch("post",[a,c]).fail(d.reject),d.promise},k.nsend=k.nmcall=k.ninvoke=function(a,b){var c=W(arguments,2),d=l();return c.push(d.makeNodeResolver()),k(a).dispatch("post",[b,c]).fail(d.reject),d.promise},o.prototype.nsend=o.prototype.nmcall=o.prototype.ninvoke=function(a){var b=W(arguments,1),c=l();return b.push(c.makeNodeResolver()),this.dispatch("post",[a,b]).fail(c.reject),c.promise},k.nodeify=N,o.prototype.nodeify=function(a){return a?void this.then(function(b){U(function(){a(null,b)})},function(b){U(function(){a(b)})}):this};var ga=i();return k});KISSY.add("register/components/xerror",function(a){var b=function(a,c){return this instanceof b?(this.code=a,void(this.message=c)):new b(a,c)};return b});KISSY.add("register/components/timeoutbtn",function(a){var b=window.TRLang||{},c=function(d){return this instanceof c?(this.el=d.el&&a.one(d.el),this.timeout=d.timeout?Number(d.timeout)||0:0,this.callback=a.isFunction(d.callback)&&d.callback||null,this.text=d.text||(this.el?this.el.text():""),this.waitText=d.waitText||b.r_m2e_verificationCodeSentTip||"%t%秒后可重新操作",this.timeoutText=d.timeoutText||this.text,this.timeoutCls=d.timeoutCls||"",this.disabledCls=d.disabledCls||"",this.autoStart=!!d.autoStart,this._id=0,void(this.autoStart&&this.start())):new c(d)};return a.augment(c,a.EventTarget,{_counter:0,start:function(){if(this.el&&this.timeout){this.fire("start"),this._counter=0,this.el.prop("disabled",!0),this.el.addClass(this.disabledCls),this._refresh();var a=this;this._id&&window.clearInterval(this._id),this._id=setInterval(function(){a._clock()},1e3)}},_clock:function(){this._counter++,this._counter===this.timeout?(this.enable(),this.callback&&this.callback(),this.fire("timeEnd")):this._refresh()},enable:function(){window.clearInterval(this._id),this._id="",this._counter=0,this.el.prop("disabled",!1),this.el.text(this.timeoutText),this.el.removeClass(this.timeoutCls),this.el.removeClass(this.disabledCls)},_refresh:function(){this.el.text(this.waitText.replace("%t%",this.timeout-this._counter))}}),c},{requires:["node","event","dom","ajax"]});KISSY.add("register/components/mobile-select",function(a){var b,c=a.require("event"),d=a.require("node"),e=a.require("register/components/xerror"),f=a.require("menubutton"),g=window.TRLang||{},h={MOBILE_EMPTY:g.ERROR_GENERAL_MOBILEPHONE_EMPTY||"请输入手机号码",MOBILE_INVALID:g.ERROR_GENERAL_MOBILEPHONE_MALFORM||"手机号码格式不正确，请重新输入"},i=f.Select.extend({},{ATTRS:{value:{},defaultCaption:{value:""},collapseOnClick:{value:!0}},decorate:function(c,e){c=a.one(c),e=e||{},e.elBefore=c;var f,g,h=[],j=null,k=c.val(),l=c.all("option");if(l.each(function(a){var b={xclass:"option",content:'<span class="text" title="'+a.text()+'">'+a.text()+'</span><span class="code">+'+a.attr("data-code")+"</span>",elCls:a.attr("class"),desp:a.attr("data-desp")||"",code:a.attr("data-code")||"",pattern:a.attr("data-pattern"),text:a.text(),value:a.val()};k===a.val()&&(j={content:b.content,value:b.value}),h.push(b)}),e.menu=e.menu||e.menuCfg||{},e.menu.children=h,g=new i(a.mix(e,j)).render(),f=c.attr("name")){var m=new d('<input type="hidden" name="'+f+'" value="'+k+'">').insertBefore(c,void 0);g.on("afterValueChange",function(a){a.target.$contentEl.html(b),m.val(a.newVal||"")})}return c.remove(),g},xclass:"select"}),j=function(b){return this instanceof j?(b=b||{},this.elArea=b.elArea&&a.all(b.elArea),this.elMobile=b.elMobile&&a.all(b.elMobile),void this._init()):new j(b)};return a.augment(j,c.Target,{_init:function(){var c=this.elArea[0].options[this.elArea[0].selectedIndex];this.areaCode=a.all(c).attr("data-code")||"",this.pattern=new RegExp(a.all(c).attr("data-pattern")||".+"),this.text=a.all(c).attr("data-text")||"",b='<span class="text" title="'+this.text+'">'+this.text+'</span><span class="code">+'+this.areaCode+"</span>",this._render()},_render:function(){var a=this;a.select=i.decorate(this.elArea,{width:150,prefixCls:"tb-",menuCfg:{align:{offset:[0,-1]},height:200,elStyle:{overflow:"auto",overflowX:"hidden"}},listeners:{click:function(c){a.pattern=new RegExp(c.target.get("pattern")),a.areaCode=c.target.get("code"),b='<span class="text" title="'+c.target.get("text")+'">'+c.target.get("text")+'</span><span class="code">+'+a.areaCode+"</span>";var d={code:a.areaCode};a.fire("change",d)}}})},validate:function(){var a,b=Q.defer(),c=this.elMobile.val(),d=this.areaCode;return c?this.pattern.test(d+c)||(a="MOBILE_INVALID"):a="MOBILE_EMPTY",a?b.reject(new e(a,h[a])):b.resolve(),b.promise},getAreaCode:function(){return this.areaCode},getPattern:function(){return this.pattern}}),j},{requires:["node","event","menubutton","register/components/xerror"]});KISSY.add("register/components/checkcode",function(a){var b=a.require("event"),c=a.require("register/utils/checkcode"),d=a.require("register/components/xerror"),e=window.TRLang||{},f={CHECKCODE_EMPTY:e.ERROR_IMAGECHECKCODE_EMPTY||"请输入验证码",CHECKCODE_LENGTH_INVALID:e.ERROR_IMAGECHECKCODE_MALFORM||"验证码长度为4位",CHECKCODE_INVALID:e.ERROR_IMAGECHECKCODE_INVALID||"验证码不正确，请重新输入"},g=function(a){return this instanceof g?(a=a||{},this.checkcode=c(a),void this._init()):new g(a)};return a.augment(g,b.Target,{_init:function(){var a=this;this.checkcode.on("refresh",function(){a.fire("refresh")}),this.checkcode.on("switch",function(){a.fire("switch")})},validate:function(){var b,c=Q.defer(),e=a.trim(this.checkcode.input.val());return e||(b="CHECKCODE_EMPTY"),4!==e.length&&(b="CHECKCODE_LENGTH_INVALID"),this.checkcode.check(function(a){a&&a.success?c.resolve(a):b="CHECKCODE_INVALID",b&&c.reject(new d(b,f[b]))}),c.promise},show:function(){this.checkcode.SHOWED||this.checkcode.show()},refresh:function(){this.checkcode.show()},resetImgURL:function(a,b){this.checkcode.resetImgURL(a,b)}}),g},{requires:["event","register/components/xerror","register/utils/checkcode"]});KISSY.add("register/components/message",function(a){var b=window.TRLang||{},c={info:"&#xf0142;",help:"&#xf0143;",warn:"&#xf001b;",error:"&#xf0155;",ok:"&#xf0156;"},d=(a.require("event"),a.require("dom")),e=function(b){return this instanceof e?(b=b||{},this.el=b.el&&a.all(b.el),this.offsetEl=b.offsetEl&&a.one(b.offsetEl),this.offset=a.isObject(b.offset)?b.offset:{},this.offset.left=this.offset.left||0,this.offset.top=this.offset.top||0,this.zindex=b.zindex,this.width=b.width,this.contentHTML=this.el&&this.el.html(),void this._init()):new e(b)};return a.augment(e,{_init:function(){if(this.el){this.setType(this.el.attr("data-type")),this.initDisplay(),this._initDom(),this.shown()&&this.show();var b=this;a.all(window).on("resize",function(){b.fixed()})}},_initDom:function(){this.el.html(""),this.icon||(this.icon=a.one(d.create('<i class="iconfont">'+c[this.getType()]+"</i>")),this.el.append(this.icon)),this.title||(this.title=a.one(d.create('<div class="msg-tit"></div>')),this.el.append(this.title)),this.content||(this.content=a.one(d.create('<div class="msg-cnt" aria-live="assertive">'+this.contentHTML+"</div>")),this.el.append(this.content)),this.offsetEl&&a.all("body").append(this.el)},getType:function(){var a=this.el.attr("class").match(/\bmsg\-type\-(info|help|warn|error|ok)\b/);return a?a[1]:""},setType:function(a){if(a&&c[a]){var b=this.getType();return b?this.el.replaceClass("msg-type-"+b,"msg-type-"+a):this.el.addClass("msg-type-"+a),this.setIcon(a),this}},setIcon:function(a){return this.icon&&this.icon.html(c[a]||""),this},setTitle:function(a){return this.title&&this.title.html(a),this},setContent:function(a){return this.content&&this.content.html(a),this},getDisplay:function(){return this.el.attr("data-display")||"block"},initDisplay:function(){this.el.attr("data-display",this.getDisplay())},setDisplay:function(a){if(a){var b=this.getDisplay();return b&&b!==a&&this.el.removeClass("msg-display-"+b),this.el.addClass("msg-display-"+a),this.el.attr("data-display",a),this}},set:function(b){return b=a.isObject(b)?b:{content:b},this.setTitle(b.title||""),this.setContent(b.content||""),b.type&&this.setType(b.type),b.display&&this.setDisplay(b.display),this},shown:function(){return"1"===this.el.attr("data-show")},show:function(){var b=this.getDisplay()||"block";return this.el.removeClass("msg-hide"),this.setDisplay(b),this.el.attr("data-show",1),a.isNumber(this.zindex)&&this.el.css({"z-index":this.zindex}),a.isNumber(this.width)&&this.el.css({width:this.width}),this.fixed(),this},showPlaceHolder:function(c){var d=c.el&&a.one(c.el),e=d&&d.attr("data-outer_placeholder");e&&b[e]&&(c.content=b[e],this.set(c).show())},hide:function(){return this.el.addClass("msg-hide"),this.el.attr("data-show",0),this},hideIfNotOk:function(){"ok"!==this.getType()&&this.hide()},fixed:function(){if(this.offsetEl){var a=this.offsetEl?this.offsetEl.offset():{left:0,top:0};a.left=a.left+(this.offsetEl&&this.offsetEl.outerWidth()),this.el.css({position:"absolute",left:a.left+this.offset.left+3,top:a.top+this.offset.top})}}}),e},{requires:["dom","node","event"]});KISSY.use("event, node, dom, overlay, io, register/components/xerror, register/components/timeoutbtn, register/atp, register/components/mobile-select, register/components/message, register/utils/messages, register/utils/checkenable",function(a){function b(){a.IO({type:"post",url:f.getUpSmsUrl,form:i("#J_MobileForm"),dataType:"json",timeout:5,success:function(a){a.success&&(p.messages.upMobileMsg.set({type:"ok",content:g.r_p_upsmsSendTip||"请勿关闭窗口，验证成功后会自动跳转"}).show(),p.messages.upMobileMsg.hide(),i("#phoneNum").html(a.mobile),i("#codeNum").html(a.checkcode),i("#sendCodeNum").html(a.gateway),i("#J_MobileUpCheck").show(),s.hide(),t.show(),A(),z=0)}})}function c(){var a=new h.Dialog({srcNode:"#J_Account",mask:!0,align:{node:"#J_MobileForm",points:["tc","tc"]}});i("#J_Account").show(),i("#J_Account .hide").hide(),a.render().show()}var d,e,f=window.TRConfig,g=window.TRLang||{},h=(a.require("event"),a.require("node"),a.require("dom"),a.require("overlay")),i=a.all,j=(a.require("register/atp"),a.require("register/components/xerror")),k=a.require("register/components/timeoutbtn"),l=a.require("register/components/mobile-select"),m=a.require("register/components/message"),n=a.require("register/utils/messages"),o=a.require("register/utils/checkenable"),p=n({messages:{mobile:m({el:"#J_MsgMobile",offsetEl:"#J_Mobile",offset:{top:8}}),mobileForm:m({el:"#J_MsgMobileForm"}),resendCode:m({el:"#J_MsgResendCode"}),upMobileMsg:m({el:"#J_MobileUpMsg"})}}),q=l({elArea:"#J_Area",elMobile:"#J_Mobile"});q.on("change",function(a){var b=a.code,c=i(".steps"),d=i("ol li",c)[2];"86"!==b&&c.hasClass(".steps-4")?(i(d).hide(),c.removeClass(".steps-4")):"86"===b&&4===i("ol li",c).length&&(i(d).show(),c.addClass(".steps-4"))});var r=m({el:"#J_MsgCodeTitle"});i("#J_Mobile").on("focus",function(){p.messages.mobile.showPlaceHolder({type:"info",display:"inline",el:"#J_Mobile"})}).on("blur",function(){p.messages.mobileForm.hide(),q.validate().then(function(){p.messages.mobile.set({type:"ok",display:"inline"}).show(),i("#J_Mobile").removeClass("err-input")}).fail(function(b){a.log(b),p.messages.mobile.set({type:"error",content:b&&b.message,display:"inline"}).show(),i("#J_Mobile").addClass("err-input")})}),q.on("change",function(){i("#J_Mobile").val()&&q.validate().then(function(){p.messages.mobile.set({type:"ok",display:"inline"}).show(),i("#J_Mobile").removeClass("err-input")}).fail(function(b){a.log(b),p.messages.mobile.set({type:"error",content:b&&b.message,display:"inline"}).show(),i("#J_Mobile").addClass("err-input")})});var s=new h.Dialog({srcNode:"#J_MobileCheck",mask:!0,align:{node:"#J_MobileForm",points:["tc","tc"]}});s.render(),s.on("hide",function(){window.nc&&window.nc.reset(),p.messages.mobile.hide(),p.messages.resendCode.hide(),p.messages.mobileForm.hide(),d&&d.enable()});var t=new h.Dialog({srcNode:"#J_MobileUpCheck",mask:!0,align:{node:"#J_MobileForm",points:["tc","tc"]}});if(t.render(),i("#J_Close").on("click",function(){t.hide()}),t.on("hide",function(){window.nc&&window.nc.reset(),p.messages.mobile.hide(),clearInterval(y)}),a.get("#J_Agreement")&&o({elCheck:"#J_Agreement",elEnable:"#J_BtnMobileForm"}).on("enable",function(){i("#J_BtnMobileForm").removeClass("btn-disabled")}).on("disable",function(){i("#J_BtnMobileForm").addClass("btn-disabled")}),a.get("#J_AgreementDialog")){var u=new h.Dialog({srcNode:"#J_AgreementDialog",mask:!0,align:{node:"#J_MobileForm",points:["tc","tc"]}});i("#J_AgreementDialog").show(),u.render().show().center(),i("#J_AgreementBtn").on("click",function(){u.hide()})}i("#J_MobileForm").on("submit",function(b){b.halt(),Q.fcall(function(){return q.validate()}).then(function(b){return p.messages.mobile.set({type:"ok",display:"inline"}).show(),i("#J_Mobile").removeClass("err-input"),Q(a.IO({type:"post",url:f.smsUpOrDownUrl,form:i("#J_MobileForm"),dataType:"json",timeout:5})).fail(function(b){throw a.log(b),new j("NetError","error")})}).then(function(a){if(!(a&&a[0]&&a[0].success))throw window.nc&&window.nc.reset(),new j("MobileSumbitFail",a.message||a[0].reason||"");p.hideAllIfNotOk(),2===a[0].type?"voice"===a[0].next?w():v():x(a)}).fail(function(b){switch(a.log(b),p.hideAllIfNotOk(),b.code){case"MOBILE_EMPTY":case"MOBILE_INVALID":p.messages.mobile.set({type:"error",content:b.message||"手机号码错误，请重新输入",display:"inline"}).show(),i("#J_Mobile").addClass("err-input");break;default:p.messages.mobileForm.set({type:"error",content:g[b.message]||g[b.reason]||g.GENERIC_FAILURE||"系统错误，请稍后重试",display:"block"}).show()}})});var v=function(){i("#J_BtnMobileVoiceCode").hide(),i("#J_BtnMobileUpCode").hide(),i("#J_BtnMobileCode").show(),d=null,r.set({type:"info",content:g.TIP_REGISTER_MOBILECHECKCODE_MSG||"校验码已发送到你的手机，15分钟内输入有效，请勿泄漏",display:"block"}).show(),i("#J_MobileCheck").show(),s.show();var a=i("#J_Member").val()||"",b=a+".3?pagetime="+(new Date).getTime();try{(new Image).src="//gm.mmstat.com/"+b}catch(c){}var e,f=i(".code",i(".mobile-text")).text();e="+86"===f?i("#J_Mobile").val():f.substr(1)+"-"+i("#J_Mobile").val(),i("#J_MobileNumber").text(e),i("#J_MobileCode").val(""),p.messages.resendCode.set({type:"ok",content:g.TIP_REGISTER_CHECKCODE_SENT||"短信校验码已发送至你的手机，请查收"}).show(),d||(d=k({el:"#J_BtnMobileCode",timeout:60,disabledCls:"btn-disabled"})),d.start()},w=function(){i("#J_BtnMobileVoiceCode").show(),i("#J_BtnMobileCode").hide(),i("#J_BtnMobileUpCode").hide(),e=null,r.set({type:"info",content:g.TIP_REGISTER_VOICECHECKCODE_MSG||"如一直收不到短信校验码，请点击“获取语音校验码”我们将给你拨打语音电话",display:"block"}).show(),p.messages.resendCode.hide(),e||(e=k({el:"#J_BtnMobileVoiceCode",timeout:90,disabledCls:"btn-disabled"})),a.IO({type:"post",url:f.sendCellByVoiceUrl,dataType:"json",timeout:5,complete:function(a){return a&&a.success?(p.messages.resendCode.set({type:"ok",content:g.TIP_REGISTER_VOICECHECKCODE_SENT||"电话正在拨出，请注意接听",display:"block"}).show(),i("#J_MobileCode")[0].focus(),void e.start()):(window.nc&&window.nc.reset(),p.messages.resendCode.set({type:"error",content:g[a.reason]||"系统错误，请重试",display:"block"}).show(),void e.enable())}})},x=function(a){p.messages.upMobileMsg.set({type:"ok",content:g.r_p_upsmsSendTip||"请勿关闭窗口，验证成功后会自动跳转"}).show(),i("#phoneNum").html(a[0].mobile),i("#codeNum").html(a[0].checkcode),i("#sendCodeNum").html(a[0].gateway),i("#J_MobileUpCheck").show(),t.show(),A(),z=0},y=null,z=0,A=function(){y=setInterval(function(){z++,z>300&&(clearInterval(y),p.messages.upMobileMsg.set({type:"error",content:g.GENERIC_FAILURE||"系统错误，请稍后重试",display:"block"}).show()),a.IO({type:"post",url:f.checkUpSmsCodeUrl,dataType:"json",timeout:5,success:function(a){if(a.success)location.href=f[a.toUrl];else{if("ERROR_SMS_UPWARD_UNRECEIVED"===a.reason)return;p.messages.upMobileMsg.set({type:"error",content:g[a.reason],display:"block"}).show(),"ERROR_SMS_UPWARD_TIMEOUT"===a.reason&&i("#J_reSendUpMsg").on("click",function(a){a.preventDefault(),clearInterval(y),b()})}}})},5e3)};i("#J_BtnMobileCode").on("click",function(){a.IO({type:"post",url:f.resendUrl,dataType:"json",timeout:5,complete:function(a){return a&&a.success?(p.messages.resendCode.set({type:"ok",content:g.TIP_REGISTER_CHECKCODE_SENT||"短信校验码已发送至你的手机，请查收",display:"block"}).show(),i("#J_MobileCode")[0].focus(),d.start(),void d.on("timeEnd",function(){"voice"===a.next&&(i("#J_BtnMobileVoiceCode").show(),i("#J_BtnMobileCode").hide(),r.set({type:"info",content:g.TIP_REGISTER_VOICECHECKCODE_MSG||"如一直收不到短信校验码，请点击“获取语音校验码”我们将给你拨打语音电话",display:"block"}).show(),p.messages.resendCode.hide(),e||(e=k({el:"#J_BtnMobileVoiceCode",timeout:90,disabledCls:"btn-disabled"})))})):(p.messages.resendCode.set({type:"error",content:g[a.reason]||"系统错误，请重试",display:"block"}).show(),void d.enable())}})}),i("#J_BtnMobileVoiceCode").on("click",function(){a.IO({type:"post",url:f.resendCellByVoiceUrl,dataType:"json",timeout:5,complete:function(a){return a&&a.success?(p.messages.resendCode.set({type:"ok",content:g.TIP_REGISTER_VOICECHECKCODE_SENT||"电话正在拨出，请注意接听",display:"block"}).show(),i("#J_MobileCode")[0].focus(),e.start(),void e.on("timeEnd",function(){"upward"===a.next&&(i("#J_BtnMobileVoiceCode").hide(),i("#J_BtnMobileUpCode").show())})):(p.messages.resendCode.set({type:"error",content:g[a.reason]||"系统错误，请重试",display:"block"}).show(),void e.enable())}})}),i("#J_BtnMobileUpCode").on("click",function(){b()}),i("#J_MobileCodeForm").on("submit",function(b){b.halt(),a.IO({type:"post",url:f.checkUrl,dataType:"json",form:i("#J_MobileCodeForm"),timeout:5,complete:function(a){if(!a||!a.success)return void p.messages.resendCode.set({type:"error",content:g[a.reason]||g.GENERIC_FAILURE||"系统错误，请稍后重试",display:"block"}).show();if(a.loc){a.avatar&&(i("#J_Avatar").attr("src",a.avatar),i("#J_ConflictNick").html(a.conflictNick));var b=i("#J_Mobile").val();switch(a.loc){case"fillEmail":c(),i("#J_FillEmail").show(),i("#J_FillEmail .mobile").html(b);break;case"release":c(),i("#J_Release").show(),i("#J_Release .mobile").html(b),i("#J_Release .nick").html(a.conflictNick);break;case"leadtologin":c(),i("#J_Leadtologin").show(),i("#J_Leadtologin .mobile").html(b);break;default:var e=i("#J_Member").val()||"",h=e+".1";try{(new Image).src="//gm.mmstat.com/"+h}catch(j){}setTimeout(function(){window.location.href=f[a.loc]},100)}}else p.messages.resendCode.set({type:"error",content:"系统错误，请重试！",display:"block"}).show(),d.enable()}})})});KISSY.add("register/utils/checkenable",function(a){var b=a.require("event"),c=function(b){return this instanceof c?(b=b||{},this.elCheck=b.elCheck&&a.one(b.elCheck),this.elEnable=b.elEnable&&a.one(b.elEnable),void this._init()):new c(b)};return a.augment(c,b.Target,{_init:function(){if(this.elCheck&&this.elEnable){var a=this;this.elCheck.on("click",function(b){a.elCheck.prop("checked")?(a.elEnable.prop("disabled",!1),a.fire("enable")):(a.elEnable.prop("disabled",!0),a.fire("disable"))})}}}),c},{requires:["event"]});KISSY.add("register/utils/messages",function(a){var b=function(a){return this instanceof b?(a=a||{},this.messages=a.messages,void this._init()):new b(a)};return a.augment(b,{_init:function(){},hideAll:function(){a.each(this.messages,function(a){a.hide()})},hideAllIfNotOk:function(){a.each(this.messages,function(a){a.hideIfNotOk()})}}),b});KISSY.add("register/utils/checkcode",function(a){var b=window.TRLang||{},c=b.REGISTER_TIP_GET_VOICECHECKCODE_MSG||"获取语音验证码",d=b.REGISTER_TIP_PLAY_VOICE_MSG||"点击播放语音",e=b.REGISTER_TIP_LISTNE_VOICE_MSG||"请仔细收听",f=b.REGISTER_TIP_GET_NEW_VOICE_MSG||"重新获取验证码",g=b.REGISTER_TIP_GET_IMAGECHECKCODE_MSG||"获取图片验证码",h=b.REGISTER_TIP_GET_NEW_IMAGECHECKCODE_MSG||"重新获取图片验证码",i=a.DOM,j=(a.Event,1),k=/^\d{4}$/,l=/^\d{6}$/,m=/^[\da-zA-Z]{4}$/,n=-1!==navigator.userAgent.indexOf("Windows"),o=a.UA.ie,p=a.UA.firefox,q=".{{prefixCls}}checkcode-img,.{{prefixCls}}checkcode-audio{height:{{height}}px;line-height:{{height}}px;overflow:hidden;}.{{prefixCls}}checkcode-audio{display:none;}.{{prefixCls}}checkcode-img img,.{{prefixCls}}checkcode-audio audio{float:left;display:inline;width:{{width}}px;height:{{height}}px;cursor:pointer;}.{{prefixCls}}checkcode-refresh{display:none;width:{{width}}px;height:{{height}}px;vertical-align:middle;position:absolute;left:0;top:0;cursor:pointer;}.{{prefixCls}}audio-state{float:left;display:inline;width:{{bwidth}}px;height:{{bheight}}px;position:relative;border:1px solid #EAEAEA;}.{{prefixCls}}audio-state-text{display:block;width:70px;height:{{height}}px;padding-left:30px;font-size:12px;color:#999;text-decoration:none;background:url(//img.alicdn.com/tps/i1/T1HVriXnVeXXbjRy2i-21-169.png) no-repeat 10px -{{bgtop}}px;z-index:1;position:absolute;cursor:text;}.{{prefixCls}}audio-state-text:hover{text-decoration:none;}.{{prefixCls}}audio-state-progress{width:0;height:{{height}}px;background-color:#186BCA;position:absolute;left:0;top:0;z-index:0;}.{{prefixCls}}audio-over{width:{{width}}px;padding-left:0;color:#186BCA;text-align:center;background:none;cursor:pointer;}.{{prefixCls}}audio-over:hover{text-decoration:underline;}.{{prefixCls}}checkcode-refresher{float:left;display:inline;width:32px;height:32px;vertical-align:top;text-indent:-9999em;outline:none;background:url(//img.alicdn.com/tps/i1/T1HVriXnVeXXbjRy2i-21-169.png) no-repeat 7px -145px;}.{{prefixCls}}checkcode-switcher{float:left;display:inline;width:32px;height:32px;vertical-align:top;text-indent:-9999em;outline:none;border-left:1px solid #DDD;background:url(//img.alicdn.com/tps/i1/T1HVriXnVeXXbjRy2i-21-169.png) no-repeat 0 0;}.{{prefixCls}}checkcode-refresher,.{{prefixCls}}checkcode-switcher{filter:alpha(opacity=70);opacity:0.7;margin-top:{{margintop}}px}.{{prefixCls}}checkcode-refresher:hover,.{{prefixCls}}checkcode-switcher:hover{filter:alpha(opacity=100);opacity:1;border-color:#EAEAEA;}.{{prefixCls}}audio-switcher{background-position:6px -40px;}.{{prefixCls}}img-switcher{background-position:5px 10px;}",r={template:'<div class="{prefixCls}checkcode-img" id="J_ImgCode{uid}">  <img id="J_CheckCodeImg{uid}" width="{width}" height="{height}" onmousedown="return false;"/>  <a href="#nogo" onmousedown="return false;" role="button" title="" aria-label="'+h+'" id="J_ImgRefresher{uid}" class="{prefixCls}checkcode-refresher">'+h+'</a>  <!--EnabledAudio--><a href="#nogo" onmousedown="return false;" role="button" title="'+c+'" aria-label="'+c+'" id="J_AudioSwitcher{uid}" class="{prefixCls}checkcode-switcher {prefixCls}audio-switcher">'+c+'</a><!--EnabledAudio--></div><!--EnabledAudio--><div class="{prefixCls}checkcode-audio" id="J_AudioCode{uid}">  <span class="{prefixCls}audio-state" id="J_AudioState{uid}"><a href="#nogo" class="{prefixCls}audio-state-text" id="J_AudioStateText{uid}" onmousedown="return false;"></a><span class="{prefixCls}audio-state-progress" id="J_AudioStateProgress{uid}"></span></span>  <a href="#nogo" role="button" onmousedown="return false;" title="'+f+'" aria-label="'+f+'" id="J_AudioRefresher{uid}" class="{prefixCls}checkcode-refresher">'+f+'</a>  <a href="#nogo" role="button" onmousedown="return false;" title="" aria-label="'+g+'" id="J_ImgSwitcher{uid}" class="{prefixCls}checkcode-switcher {prefixCls}img-switcher">'+g+"</a></div><!--EnabledAudio-->"},s=a.now(),t=a.now(),u={},v=function(b){return this instanceof v?(b=a.isObject(b)?b:{},this.input=b.input&&a.one(b.input),this.container=b.container&&a.one(b.container),this.prefixCls=a.isString(b.prefixCls)?b.prefixCls:"",this.identity=b.identity||"",this.sessionid=b.sessionid||"",this.enabledAudio=!!b.enabledAudio,this.apiserver=a.isString(b.apiserver)&&b.apiserver?b.apiserver:"http://pin.aliyun.com",this.getImgURL=b.getImgURL,this.checkImgURL=b.checkImgURL,this.getAudioURL=b.getAudioURL,this.checkAudioURL=b.checkAudioURL,this.checkType=b.checkType,this.checkInputId=b.checkInputId,this.checkedCode="",this.type=b.type||"150_40",this.width="150_40"===this.type?150:100,this.height="150_40"===this.type?40:30,this.margintop=(this.height-30)/2,this.uid=j++,void this._init()):new v(b)};return a.augment(v,a.EventTarget,{_init:function(){return this.container&&this.input?this.INITED?this:(this.createStyle(),this.create(),this.bind(),this.INITED=!0,this):void 0},createStyle:function(){var a=q.replace(/{{prefixCls}}/g,this.prefixCls).replace(/{{width}}/g,this.width).replace(/{{height}}/g,this.height).replace(/{{bwidth}}/g,this.width-2).replace(/{{bheight}}/g,this.height-2).replace(/{{bgtop}}/g,93-(this.height-30)/2).replace(/{{ margintop}}/g,this.margintop),b=i.create("<style>",{type:"text/css"});b.styleSheet?b.styleSheet.cssText=a:b.appendChild(document.createTextNode(a)),i.append(b,"head")},create:function(){var b=this.uid,c=this.enabledAudio?r.template:r.template.replace(/<!--EnabledAudio-->[\s\S]+?<!--EnabledAudio-->/g,""),d=a.substitute(c,{prefixCls:this.prefixCls,uid:b});this.container.html(d),this.imgCode=a.one("#J_ImgCode"+b),this.audioCode=a.one("#J_AudioCode"+b),this.imgSwitcher=a.one("#J_ImgSwitcher"+b),this.audioSwitcher=a.one("#J_AudioSwitcher"+b),this.refresher=a.all("."+this.prefixCls+"checkcode-refresher"),this.img=a.one("#J_CheckCodeImg"+b),this.audioState=a.one("#J_AudioState"+b),this.audioStateText=a.one("#J_AudioStateText"+b),this.audioProgress=a.one("#J_AudioStateProgress"+b),this.CREATED=!0},bind:function(){var b=this;this.bindImg(),this.bindAudio(),this.refresher.on("click",function(a){a.halt(),b.refresh(),b.focus(),b.fire("refresh")}),this.input.on("valuechange",function(b){b.prevVal&&0!==b.prevVal.length&&4!==b.prevVal.length||1!==b.newVal.length||(t=a.now())}).on("paste",function(){0===this.value.length&&(t=a.now())})},bindImg:function(){if(!this.img)return this;var a=this;return this.img&&this.img.on("click",function(){a.refresh(),a.focus()}).on("load",function(){}).on("error",function(){}),this.imgSwitcher&&this.imgSwitcher.on("click",function(b){b.halt(),a.switchTo("img"),a.focus()}),this},bindAudio:function(){var a=this;return this.enabledAudio?(this.audioSwitcher.on("click",function(b){b.halt(),a.switchTo("audio"),a.refresh(),a.focus()}),this.audioSwitcher.on("keyup",function(b){b.halt(),(13==b.keyCode||32==b.keyCode)&&(a.switchTo("audio"),a.refresh(),a.focus())}),this.audioStateText.on("click",function(b){b.halt(),a.audioOver&&(a.refresh(),a.focus())}),this.audioStateText.on("keyup",function(b){b.halt(),a.audioOver&&(13==b.keyCode||32==b.keyCode)&&(a.refresh(),a.focus())}),this):this},bindAudioProgress:function(){var a=this;this.audioSupport&&this.audio.on("timeupdate",function(){!p||this.duration&&this.duration!==1/0?a.progress(parseInt(100*this.currentTime/this.duration)):a.progress(100)},this.audio[0]).on("play",function(){},this.audio[0]).on("ended",function(){a.progress(100)},this.audio[0])},switchTo:function(b){if(!b||!a.isString(b))return this;var b=b.toUpperCase();return"IMG"===b?(this.enabledAudio&&(this.audioCode.hide(),this.stopAudio()),this.imgCode.css({display:"block"}),this.codeType=b):"AUDIO"===b&&this.enabledAudio&&(this.imgCode.hide(),this.audioProgress.width(0),this.audioStateText.removeClass(this.prefixCls+"audio-replay"),this.audioCode.css({display:"block"}),this.codeType=b),this.checkedCode="",this.toggleRefresher(),this.SHOWED=!0,this.fire("switch"),this},toggleRefresher:function(){return"AUDIO"!==this.codeType?void this.refresher.show():void((!this.audioSupport||p)&&this.refresher.hide())},refreshImg:function(){if(!this.getImgURL)return this;var b=this.getImgURL+(this.getImgURL.indexOf("?")>=0?"&t=":"?t=")+a.now();return this.img.attr("src",b),this},refreshAudio:function(){if(!this.getAudioURL)return this;var b=this.getAudioURL+(this.getAudioURL.indexOf("?")>=0?"&t=":"?t=")+a.now();if(this.stopAudio(),this.audioOver=!1,this.audioSupport)this.audioDuration=0,this.audio=a.one(new Audio(b)),this.audio[0].play(),this.bindAudioProgress();else if(o){var c=i.create("<bgsound>",{autostart:!0,id:"J_BgSound"+this.uid,src:b});i.append(c,"head"),this.player=a.one("#J_BgSound"+this.uid),this.progress("NOPROGRESS")}else a.one("body").append('<embed src="'+b+'" id="J_EmbedSound'+this.uid+'"'+(n?'type="application/x-mplayer2"':'type="audio/x-wav"')+" autostart hidden />"),this.player=a.one("#J_EmbedSound"+this.uid),this.progress("NOPROGRESS");return this},refresh:function(b){var b=a.isString(b)&&b?b.toUpperCase():this.codeType;"AUDIO"===b?this.refreshAudio():this.refreshImg(),this.checkedCode="",s=t=a.now()},resetImgURL:function(a,b){this.getImgURL=a,this.refreshImg(),b&&(this.getAudioURL=b,this.refreshAudio())},focus:function(){this.input[0].focus(),this.input[0].select()},stopAudio:function(){this.audioSupport?this.audio&&this.audio[0]&&this.audio[0].pause():this.player&&(this.player[0].src="",this.player.remove(),this.player=null)},replayAudio:function(){this.audioSupport&&this.audio&&(this.audio[0].currentTime=0,this.audio[0].pause(),this.audio[0].play())},show:function(a){return a=a||"img",/^img$/i.test(a)?this._showImg():this._showAudio(),this},_showImg:function(){return this.switchTo("img"),this.refresh(),this},_showAudio:function(){return this.switchTo("audio"),this},audioSupport:function(){try{return"Audio"in window&&(new Audio).canPlayType("audio/x-wav")}catch(a){return!1}}(),progress:function(a){switch(a){case-1:this.audioStateText.text("正在加载");break;case 100:case"NOPROGRESS":this.audioOver=!0,this.audioProgress.css({width:"0"}),this.audioStateText.addClass(this.prefixCls+"audio-over").text(d);break;default:this.audioStateText.removeClass(this.prefixCls+"audio-over").text(e),this.audioProgress.css({width:a+"%"})}},check:function(b){var c=a.trim(this.input.val()),b=a.isFunction(b)?b:function(){},d="AUDIO"===this.codeType?k:"NUMBER"===this.type.toUpperCase()?l:m;if(!d.test(c))return void b({success:!1,code:"ERROR_FORMAT",codeType:this.codeType});if(this.checkedCode&&this.checkedCode===c)return void b({success:!0,codeType:this.codeType});if(u[c]=b,this.checkingCode){if(this.checkingCode===c)return;this.io&&this.io.abort&&this.io.abort()}this.checkingCode=c,a.later(function(){this._check()},500,!1,this)},_check:function(){function b(a){"IMG"===i.codeType?i.refresh():(i.progress(100),i.stopAudio()),i.checkedCode="",u[d]&&u[d]({success:!1,code:"ERROR_AJAX",codeType:i.codeType})}var c="IMG"==this.codeType?this.checkImgURL:this.checkAudioURL,d=a.trim(this.input.val()),e=this.checkType,f=a.one(this.checkInputId).val(),g=a.one("#UA_InputId")?a.one("#UA_InputId").val():"",h={code:d,ua:g};"email"===e?h.email=f:"mobile"===e?(h.mobile=f,h.area=a.all("input[name='mobile_area']").val()):h.nick=f;var i=this;i.io=a.io({url:c,data:h,type:"post",dataType:"json",success:function(a){i.checkingCode="",a.success?(i.enabledAudio&&(i.progress(100),i.stopAudio()),i.checkedCode=d,u[d]&&u[d]({success:!0,codeType:i.codeType})):b()},error:function(){i.checkingCode="",b()}})}}),a.checkcode=v,v},{requires:["dom","event","node","io"]});