!function(t){function e(o){if(i[o])return i[o].exports;var a=i[o]={exports:{},id:o,loaded:!1};return t[o].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){t.exports=i(4)},function(t,e){var i={uncurryThis:function(t){return function(){return t.call.apply(t,arguments)}},curryThis:function(t){return function(){var e=Array.prototype.slice.call(arguments);return e.unshift(this),t.apply(null,e)}},bindFn:function(t,e){var i=Array.prototype.slice.call(arguments,2);return function(){return t.apply(e,i.concat(Array.prototype.slice.call(arguments)))}},extend:function(t,e){function i(){}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t,t.__super__=e.prototype,t},mixin:function(t){for(var e=Array.prototype.slice.call(arguments,1),i=0;i<e.length;i++){var o=e[i];for(var a in o)t[a]||(t[a]=o[a])}},distinctArray:function(t){for(var e,i=[],o={},a=0;a<t.length;a++){e=t[a];var s=e+":"+typeof e;o[s]||(i.push(e),o[s]=!0)}return i},browser:{version:function(){var t=navigator.userAgent;return navigator.appVersion,{trident:/Trident/i.test(t),presto:/Presto/i.test(t),webKit:/AppleWebKit/i.test(t),gecko:/Gecko/i.test(t)&&!/KHTML/i.test(t),mobile:/AppleWebKit.*Mobile.*/i.test(t),ios:/\(i[^;]+;( U;)? CPU.+Mac OS X/i.test(t),android:/Android/i.test(t)||/Linux/i.test(t),windowsphone:/Windows Phone/i.test(t),iPhone:/iPhone/i.test(t),iPad:/iPad/i.test(t),MicroMessenger:/MicroMessenger/i.test(t),webApp:!/Safari/i.test(t),edge:/edge/i.test(t),weibo:/Weibo/i.test(t),uc:/UCBrowser/i.test(t),qq:/MQQBrowser/i.test(t),baidu:/Baidu/i.test(t)}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase(),lteIE:function(t){return $.browser.msie&&parseInt($.browser.version)<=t}},cookie:{get:function(t){var e=""+document.cookie,i=e.indexOf(t+"=");if(i==-1||""==t)return"";var o=e.indexOf(";",i);return o==-1&&(o=e.length),unescape(e.substring(i+t.length+1,o))},set:function(t,e,i){i=void 0!==i?i:365;var o=new Date;o.setTime(o.getTime()+24*i*60*60*1e3),document.cookie=t+"="+escape(e)+";expires="+o.toGMTString()+"; path=/; domain=.bilibili.com"},delete:function(t){this.set(t,"",-1)}},readFromLocal:function(t){return this.localStorage._support?localStorage.getItem(t):this.cookie.get(t)},saveToLocal:function(t,e,i){return this.localStorage._support?localStorage.setItem(t,e):this.cookie.set(t,e,i)},localStorage:{_support:!(!window.localStorage||"object"!=typeof window.localStorage),getItem:function(t){return this._support?window.localStorage.getItem(t):null},setItem:function(t,e){this._support&&window.localStorage.setItem(t,e)},removeItem:function(t){this.getItem(t)&&window.localStorage.removeItem(t)}},unhtml:function(t,e){return t?t.replace(e||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp|#\d+);)?/g,function(t,e){return e?t:{"<":"","&":"",'"':"",">":"","'":""}[t]}):""},html:function(t){return t?t.replace(/&((g|l|quo)t|amp|#39|nbsp);/g,function(t){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'","&nbsp;":" "}[t]}):""},hashManage:{prependHash:"!",_change:function(t,e){var i,o=location.hash,a={},s="",n=0;o&&(o=o.substring(1),this.prependHash&&(o=o.replace(new RegExp("^"+this.prependHash.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")),""))),i=o.split("&");for(var r=0;r<i.length;r++){var l=i[r].split("=")[0],c=i[r].split("=")[1];l&&(a[l]=decodeURIComponent(c))}if("object"==typeof t)for(var d in t){var p=t[d];p?a[d]=encodeURIComponent(p):p===!1&&delete a[d]}else if(e)a[t]=encodeURIComponent(e);else{if(e!==!1)return"undefined"==typeof t?a:a[t]||null;delete a[t]}for(var m in a)s+=0!=n?"&":this.prependHash,s+=m+"="+a[m],n++;return location.hash=s,a},get:function(t){return this._change(t,null)},set:function(t,e){return this._change(t,e)},clear:function(){location.hash=""}},getColor16:function(t){function e(t){var e=parseInt(t).toString(16);return 1==e.length?"0"+e:e}function i(t){for(var i="#",o=0;o<3;o++)i+=e(t[o]);return i}var o="",a=[];return null!=t.match(/\((.*)\)/)?(a=t.match(/\((.*)\)/)[1].split(","),o=i(a)):null!=t.match(/,+/g)?(a=t.split(","),o=i(a)):o=e(t),o},serializeParam:function(t){var e=[];for(var i in t)if("function"!=(typeof t[i]).toLowerCase()&&"object"!=(typeof t[i]).toLowerCase())e.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));else if($.isArray(t[i]))for(var o=0;o<t[i].length;o++)e.push(encodeURIComponent(i)+"[]="+encodeURIComponent(t[i][o]));return e.join("&")},query2json:function(t){if($.isPlainObject(t))return t;if(void 0===t)return{};for(var e=t.split("&"),i={},o=0;o<e.length;o++){var a=e[o].split("=");i[a[0]]=a[1]}return i},hash2json:function(){return window.location.href.split("#").length>1?this.query2json(window.location.href.split("#")[1].split("?")[0].replace(/#/,"")):{}},query:{get:function(t){var e=i.query2json(this._getQuery());return t?e[t]:e},set:function(t,e){var o=i.query2json(this._getQuery()),a=i.hash2json();if("object"==typeof t)for(var s in t)this._set(o,s,t[s]);else this._set(o,t,e);return i.makeUrl("",o,a)},_set:function(t,e,i){return null===i?delete t[e]:t[e]=i,t},_getQuery:function(){return void 0!==window.location.search?window.location.search.substring(1):window.location.href.split("?")[1]?window.location.href.split("?")[1].split("#")[0]:""}},makeUrl:function(t,e,i){var o,a=this.serializeParam(e),s=this.serializeParam(i);return o=a?(t||location.pathname)+"?"+a:t||location.pathname,s&&(o=o+"#"+s),o},formatNum:function(t,e){if(void 0===t||"string"==typeof t&&isNaN(parseInt(t)))return"--";var i={"万":1e4},o="万";e="string"==typeof e?e:o;var a=i[e]||i[o];if(!("string"==typeof t&&t.indexOf(e)>=0)){if("string"==typeof t&&t.indexOf(",")>=0){for(var s=t.split(","),n="",r=0;r<s.length;r++)n+=s[r];t=n}return t=parseInt(t),t>=a&&(t=(t/a).toFixed(1)+e),t}},parseCardProps:function(t,e){var i={"data-gk":t.play,"data-sc":t.favorites,"data-pl":t.review,"data-dm":t.video_review,"data-up":t.author,"data-subtitle":t.subtitle,"data-lm":t.typename||"","data-tg":t.created?new Date(1e3*t.created).format("yyyy-MM-dd hh:mm"):t.create||t.created_at,"data-txt":t.description,"data-yb":t.coins},o="";if("string"==e){for(var a in i)""!=o&&(o+=" "),o+=a+'="'+i[a]+'"';return o}return i},newParseCardProps:function(t,e){var i={"data-gk":t.stat.view,"data-sc":t.stat.favorite,"data-pl":t.stat.reply,"data-dm":t.stat.danmaku,"data-up":t.owner.name,"data-lm":t.tname||"","data-tg":new Date(1e3*t.pubdate).format("yyyy-MM-dd hh:mm"),"data-txt":t.desc,"data-yb":t.stat.coin};return i},protocolRelative:function(t){return/http:|https:/.test(t)?t.replace(/http:|https:/,window.location.protocol):$.browser.msie&&parseInt($.browser.version)<=8?window.location.protocol+t:t},formatDuration:function(t,e,i){if("number"!=typeof t)return t;i=i||-1;var o=this.toFixed(t%60,2),a=e?this.toFixed(Math.floor(t%3600/60),2):this.toFixed(Math.floor(t/60),i),s=e?this.toFixed(Math.floor(t/3600),i):null;return null===s?[a,o].join(":"):[s,a,o].join(":")},isObject:function(t){return"object"==typeof t&&null!==t},isNothing:function(t){return null==t},isUndefined:function(t){return"undefined"==typeof t},join:function(){return Array.prototype.join.call(arguments,"")},random:function(t,e){return this.isNothing(e)&&(e=t,t=0),Math.floor(Math.random()*(e-t+1))+t},debounce:function(t,e,o){function a(){clearTimeout(s),o&&i.isNothing(s)&&t(),s=setTimeout(t,e||100)}var s;return a.clearNext=function(){clearTimeout(s)},a},throttle:function(t,e,i){function o(){n=i.head?0:(new Date).getTime(),s=null,t()}function a(){var a,r=(new Date).getTime();!n&&i.head&&(n=r),a=e-(r-n),a<=0||a>e?(clearTimeout(s),s=null,n=r,t()):s||i.tail||(s=setTimeout(o,a))}var s,n=0;return e=e||200,i=i||{},a.clearNext=function(){clearTimeout(s),s=null,n=0},a},toFixed:function(t,e){if("number"!=typeof t&&"string"!=typeof t)return t;for(t=String(t),e=Number(e)||2;t.length<e;)t="0"+t;return t.length>e?t:t.slice(-e)},thumbnail:function(t,e,i){if("string"!=typeof t)return t;if("undefined"==typeof e)return t;var o,a,s,n,r=t.split("?");return i=i||e,o={midfix:"/"+e+"_"+i,suffix:"_"+e+"x"+i},a={cdn:/^http.+i[0-2]\.hdslb\.com\//,bfs:/^http.+i\d\.hdslb\.com\/bfs\//,group1:/^http.+i\d\.hdslb\.com\/group1\//,other:/(^http.+i\d\.hdslb\.com)(\/.+)/},s={bfs:/_\d+x\d+\./,other:/\/\d+_\d+\//},a.cdn.test(r[0])?s.bfs.test(r[0])||s.other.test(r[0])?t:(a.bfs.test(r[0])||a.group1.test(r[0])?(r[0]+=o.suffix+r[0].slice(r[0].lastIndexOf(".")),t=r.join("?")):(n=a.other.exec(r[0]),n&&(r[0]=n[1]+o.midfix+n[2],t=r.join("?"))),t):t},isWebp:function(){try{return 0==document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp")}catch(t){return!1}}(),webp:function(t,e){if(!t)return t;var i=t.match(/(.*\.(jpg|jpeg|gif|png|bmp))(\?.*)?/),o=t.indexOf("/bfs/")!=-1;if(!i||"gif"===i[2]||"bmp"===i[2]||!o)return t;var a=e.w,s=e.h,n=a&&s?"@"+a+"w_"+s+"h":"@",e=i[3]?i[3]:"";return this.isWebp?i[1]+n+".webp"+e:i[1]+n+"."+i[2]+e},isAlpha:function(t,e){var i;return localStorage.getItem("machineDna")?i=localStorage.getItem("machineDna"):(i=parseInt(10*Math.random()+1),localStorage.setItem("machineDna",i)),!!(this.isBeta(t)||e<i)},isBeta:function(t){var e=!1,o=i.cookie.get("DedeUserID").slice(-1);return o&&$.isArray(t)&&(e=$.inArray(+o,t)>-1),e},trimHttp:function(t){return t?t.replace(/^http:/,""):""},getByteLen:function(t){for(var e=0,i=0;i<t.length;i++){var o=t.charAt(i);e+=null!=o.match(/[^\x00-\xff]/gi)?1:.5}return e},videoReport:function(t){window.spmReportData&&(window.spmReportData[t]=t)},customReport:function(t,e){if(window[reportConfig.msgObjects]){var i=window[reportConfig.msgObjects],o=e?e:t;i[t]=o}}};t.exports=i},function(t,e){function i(){}i.prototype={addBlacklist:function(t,e,i){var o=e?e:null;$.ajax({url:"//api.bilibili.com/x/relation/modify?cross_domain=true",type:"POST",data:{fid:t,act:5,re_src:i||15},xhrFields:{withCredentials:!0}}).done(function(t){o(t)})},follow:function(t,e,i){var o=e?e:null;$.ajax({url:"//api.bilibili.com/x/relation/modify?cross_domain=true",type:"POST",data:{fid:t,act:1,re_src:i||15},xhrFields:{withCredentials:!0}}).done(function(t){o(t)})},whisperUser:function(t,e){var i=e?e:null;this.todoFriend({act:"add",attention:0,format:"json",uid:t},i)},unFollow:function(t,e,i,o){var a=e?e:null;$.ajax({url:"//api.bilibili.com/x/relation/modify?cross_domain=true",type:"POST",data:{fid:t,act:i?4:2,re_src:o||15},xhrFields:{withCredentials:!0}}).done(function(t){a(t)})},delFans:function(t,e){var i=e?e:null;this.todoFriend({act:"delFans",attention:0,format:"json",uid:t},i)}},t.exports=i},function(t,e,i){function o(t){if(this.params={evType:"over",center:!0,Overlap:!1,focusShowPos:"up",zIndex:null,animation:"fade",position:null,event:null,bound:!0,margin:5,backdrop:!1,bindInput:!1},"string"==typeof t&&(t={evType:t}),"object"==typeof t)for(var e in this.params)t.hasOwnProperty(e)&&(this.params[e]=t[e])}i(7);var a=2e4;o.prototype={timer:null,msgbox:null,bindobj:null,backobj:null,incomingTimer:null,position:{},reverseMap:{up:"down",down:"up",left:"right",right:"left"},show:function(t,e,i,o,s){if(t=$(t),0!=this.params.Overlap||"yes"!=t.attr("hasMessageBox")){t.attr("hasMessageBox","yes"),"undefined"==typeof i&&(i=1e3),"undefined"==typeof o&&(o="msg"),"button"==i&&(s=o,o=i,i=1e3);var n=i;0==i&&(n=50);var r=this;return r.leftTimer=function(){"button"!=o&&(clearTimeout(r.timer),r.timer=setTimeout(function(){clearTimeout(r.timer),r.close(r)},n))},r.incomingTimer=function(){clearTimeout(r.timer)},this.bindobj=t,this.msgbox=$('<div class="m-layer m_layer"><div class="bg"><div class="content"><div class="mini"><div class="msg-text"><i class="b-icon"></i>'+e+"</div>"+("button"==o?'<div class="btnbox"><a class="b-btn ok">确认</a><a class="b-btn-cancel cancel">取消</a></div>':"")+"</div></div></div></div>").prependTo("body"),this.msgbox.addClass("m-"+o),r.params.backdrop&&(r.backobj=$('<div class="m-backdrop"></div>').css({position:"fixed",top:0,left:0,right:0,bottom:0,opacity:.6,backgroundColor:"#000",zIndex:(r.params.zIndex||a)-1}).appendTo("body")),"over"==this.params.evType?(t.bind("mouseleave",r.leftTimer),t.bind("mouseenter",r.incomingTimer),this.msgbox.bind("mouseenter",function(){clearTimeout(r.timer)}),this.msgbox.bind("mouseleave",r.leftTimer)):t.bind("blur",r.leftTimer),this.setPos(),this.msgbox.css("z-index",r.params.zIndex||a++),this.params.bindInput&&"error"==o&&(t.is(":text")||t.is("textarea")?t.addClass("error").on("focus.m-error",this.closeErrHandler()):t.find(":text,textarea").length>0&&t.addClass("error").find(":text,textarea").on("focus.m-error",this.closeErrHandler())),"button"==o&&(this.msgbox.find(".ok").click(function(){"undefined"!=typeof s&&0==s(r)||r.close()}),this.msgbox.find(".cancel").click(function(){r.close()})),0!=i&&r.leftTimer(),"fade"!=this.params.animation?this.msgbox.addClass(this.params.animation):this.moveIn(this.params.focusShowPos),this.bindobj.data("b-msgbox",this),this.msgbox}},close:function(){var t=this,e=function(){t.msgbox.remove(),t.params.backdrop&&t.backobj.remove(),"over"==t.params.evType&&t.bindobj.off("mouseenter",t.incomingTimer),t.bindobj.off("over"==t.params.evType?"mouseleave":"blur",t.leftTimer)};this.bindobj.attr("hasMessageBox",""),"fade"!=this.params.animation?this.msgbox.removeClass(this.params.animation).fadeOut(200,e):this.msgbox.fadeOut(200,e)},closeErrHandler:function(){var t=this;return function(){var e=t.bindobj.removeClass("error");t.close(),e.is(":text")||e.is("textarea")?e.off("focus.m-error"):e.find(":text,textarea").length>0&&e.find(":text,textarea").off("focus.m-error")}},moveIn:function(t){var e={opacity:1},i=5,o=5;switch(t){case"up":e.top="-=5",o=0;break;case"down":e.top="+=5",i=-i,o=0;break;case"left":e.left="-=5",i=0;break;case"right":e.left="+=5",o=-o,i=0;break;default:e.top="-=5",o=0}this.msgbox.show().css({top:this.position.top+i,left:this.position.left+o,opacity:0}),this.msgbox.animate(e,200)},setPos:function(){this.params.position?(this.position=this.params.position,this.resetBound()):this._pos(this.params.focusShowPos),this.msgbox.css("left",this.position.left),this.msgbox.css("top",this.position.top)},_pos:function(t,e){var i=this.bindobj;switch(this.params.focusShowPos=t,t){case"up":this.position.top=i.offset().top-this.msgbox.outerHeight()-this.params.margin,this.position.left=i.offset().left,this.params.center&&(this.position.left=this.position.left-this.msgbox.outerWidth()/2+i.outerWidth()/2);break;case"down":this.position.top=i.offset().top+i.outerHeight()+this.params.margin,this.position.left=i.offset().left,this.params.center&&(this.position.left=this.position.left-this.msgbox.outerWidth()/2+i.outerWidth()/2);break;case"left":this.position.top=i.offset().top,this.position.left=i.offset().left-this.msgbox.outerWidth()-this.params.margin;break;case"right":this.position.top=i.offset().top,this.position.left=i.offset().left+i.outerWidth()+this.params.margin}if(!this.checkBound(t)){if(e!==!0)return this._pos(this.reverseMap[t],!0);this.setBound("down"),this.setBound("left"),this.position.top-=10,this.position.left+=10}return this.resetBound(),this.position},resetBound:function(t){if(this.params.bound||t===!0)for(var e=["up","down","left","right"],i=0;i<e.length;i++){var o=e[i];this.checkBound(o)||this.setBound(o)}},checkBound:function(t){switch(t){case"up":return this.position.top>=$(window).scrollTop();case"down":return this.position.top+this.msgbox.outerHeight()<=$(window).height()+$(window).scrollTop();case"left":return this.position.left>=$(window).scrollLeft();case"right":return this.position.left+this.msgbox.outerWidth()<=$(window).width()+$(window).scrollLeft();default:return!0}},setBound:function(t){switch(t){case"up":this.position.top=$(window).scrollTop();break;case"down":this.position.top=$(window).height()+$(window).scrollTop()-this.msgbox.outerHeight();break;case"left":this.position.left=$(window).scrollLeft();break;case"right":this.position.left=$(window).width()+$(window).scrollLeft()-this.msgbox.outerWidth()}}},t.exports=o},function(t,e,i){i(11);var o=i(1),a=i(3),s=i(10),n=i(12),r=i(2),l=new r;i(5),function(t){var e=t.ajax;t.ajax=function(i,a){return"object"==typeof i&&(a=i,i=void 0),"post"!=a.type&&"POST"!=a.type||!a.data||a.data.csrf||t.extend(a.data,{csrf:o.cookie&&o.cookie.get("bili_jct")}),e(i,a)}}(jQuery),function(t){function e(t,e,i,o,a,s){this.noface="//static.hdslb.com/images/member/noface.gif";var r={isLogin:!1,face:this.noface,vipStatus:0,vipType:0};this.upId="",this.oid=e,this.pageType=i,this.$root=$(t),this.sort=0,this.loaded=!1,this.loading=!1,this.firstLoad=!1,this.emojiLoaded=!1,this.userStatus=r,this.fbData=[],this.pageInfo={},this.jumpId=a,this.isViewHot=!1,this.blacklistCode=9,this.blacklist=0,this.assist=0,this._pos=-1,this.mounted=s&&s.mounted||null;var l=this;if(this.$root.length)return this._fixRootPosition(),this.userCard=new n(this.userStatus),this._registerEvent(),o?(this.userStatus=$.extend({},r,o),this.init()):$.ajax({url:"//api.bilibili.com/x/web-interface/nav",type:"GET",dataType:"jsonp",data:{jsonp:"jsonp"},xhrFields:{withCredentials:!0}}).done(function(t){t&&0==t.code&&(l.userStatus=$.extend({},r,t.data))}).always(function(){l.init()}),this}var i=10,r="//api.bilibili.com/x/v2/reply",c={reply:r,subReply:r+"/reply",report:r+"/report",blacklist:r+"/blacklist",add:r+"/add",emoji:r+"/v2/emojis",setTop:r+"/top",like:r+"/action",hate:r+"/hate",del:r+"/del",jump:r+"/jump"},d={header:['<div class="comment-header clearfix">','<div class="tabs-order">','<ul class="clearfix">','<li class="default-sort on" data-sort="0">全部评论</li>','<li data-sort="0" class="new-sort">按时间排序</li>','<li data-sort="2" class="hot-sort">按热度排序</li>',"</ul>","</div>",'<div class="header-page paging-box"></div>',"</div>"].join("")},p={},m=window.localStorage&&window.localStorage.getItem,u="commentNotice";e.prototype.quickLogin=function(){o.browser.version.mobile?location.href="//passport.bilibili.com/login":window.biliQuickLogin?window.biliQuickLogin(function(t){window.location.reload()}):$.getScript("https://static-s.bilibili.com/account/bili_quick_login.js",function(){window.biliQuickLogin(function(t){window.location.reload()})})},e.prototype.init=function(t){t&&(this.userStatus=$.extend({},defaultStatus,t));try{var e=['<div class="bb-comment '+(o.browser.version.mobile?"bb-comment-h5":"")+'">','<div class="reply-notice"></div>',d.header,'<div class="comment-list"></div>','<div class="bottom-page '+(o.browser.version.mobile?"paging-box":"paging-box-big")+'"></div>',"</div>"].join("");this.$root.html(e),this._getEmoji(),this.userCard.reset(this.userStatus)}catch(t){window.console&&window.console.log("[comment]",t)}},e.prototype._fixRootPosition=function(){"static"==this.$root.css("position")&&this.$root.css({position:"relative"})},e.prototype._fixEmojiPosition=function(){if(!o.browser.version.mobile){var t=this.$root.find(".reply-box .reply-item");t.each(function(t,e){var i=$(e).find(".reply-face"),o=$(e).find(".user"),a=$(e).find(".name");if(i&&o&&a){var s=a.offset().top-o.offset().top;s>10?i.css("top","32px"):i.css("top","0")}})}},e.prototype._getEmoji=function(){var t=this;t.emojiLoaded=!0,$.ajax({url:c.emoji,type:"GET",dataType:"jsonp",data:{jsonp:"jsonp"},cache:!0,jsonpCallback:"emoji"}).done(function(e){if(e&&e.data&&0===e.code){var i=e.data.vip,o=e.data.free||[],a=e.data.mapping||[];t._mkEmojiMap(i),t._mkEmojiMap(o);for(var s in a)p[s]=p[a[s]];t.edata={vip:i,free:o},t._showLoading("<span>loading...</span>"),t.jumpId?t.jumpToReply(t.jumpId):t._isInView(t.$root)&&t.loadPage(1)}}).fail(function(){t.emojiLoaded=!1,t.loaded||t._showLoading('<span>加载失败，<a class="reload-comment">点击重试</a></span>')})},e.prototype._mkEmojiMap=function(t){for(var e=0;e<t.length;e++)for(var i=0;i<t[e].emojis.length;i++){var a=t[e].emojis[i].name,s=o.trimHttp(t[e].emojis[i].url),n=t[e].emojis[i].size,r={l:50,s:50},l='<img src="'+o.trimHttp(o.webp(s,{w:r[n],h:r[n]}))+'"'+("s"===n?' class="small"':"")+' alt="'+(a.split("_")[1]||"").slice(0,-1)+'">';p[a]=l}},e.prototype._renderNotice=function(t){if(t){var e="",i=m?+window.localStorage.getItem(u):0;if(t.id>i){var o=t.link;o&&o.indexOf("__MID__")!==-1&&o.indexOf("__REQUESTID__")!==-1&&this.userStatus.mid?t.link=o.replace("__MID__",this.userStatus.mid||"__MID__").replace("__REQUESTID__",t.id||"__REQUESTID__"):t.link=o,e+='<div class="notice-item" data-id="'+t.id+'"><i class="icon-close-notice"></i><i class="icon-notice"></i><a href="'+t.link+'" target="_blank">'+t.content+"</a></div>"}this.$root.find(".reply-notice").html(e)}},e.prototype._resolveEmoji=function(t){var e=new RegExp(/\[[^\]]+\]/g);return t.replace(e,function(t){return p[t]||t})},e.prototype._resolveSeek=function(t){var e=this;if(1===this.pageType){var i=/(\d+\#)?(\d+\:){1,2}\d\d/g,o=t.match(i);o&&o.forEach(function(i){if(i.indexOf("#")>0)var o=parseInt(i.split("#")[0]),a=i.split("#")[1];else var o=-1,a=i;if(e._timeStrToNumber(a)){var s=e._timeStrToNumber(a);t=t.replace(i,'<a class="video-seek" data-p="'+o+'" data-time="'+s+'">'+i+"</a>")}})}return t},e.prototype._resolveVote=function(t,e){return e.vote?t.replace(/\{vote:.*}/,'<a class="vote-link" data-id="'+e.vote.id+'" data-name="'+o.unhtml(e.vote.title)+'"><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIyLjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IuWbvuWxgl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgMjggMjkiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDI4IDI5OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+Cjx0aXRsZT5Hcm91cCAyPC90aXRsZT4KPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CjxnIGlkPSJQYWdlLTEiIHN0eWxlPSJmaWxsOiMwMEExRDYiPgoJPGcgaWQ9IuWwgemdoiI+CgkJPGcgaWQ9Ikdyb3VwLTIiPgoJCQk8ZyBpZD0iUmVjdGFuZ2xlLTUiPgoJCQkJPHBhdGggZD0iTTMuMywyOC4zQzEuNSwyOC4zLDAsMjYuOSwwLDI1VjEwLjFjMC0xLjgsMS41LTMuMywzLjMtMy4zczMuMywxLjUsMy4zLDMuM1YyNUM2LjcsMjYuOSw1LjIsMjguMywzLjMsMjguM3ogTTMuMyw4CgkJCQkJYy0xLjIsMC0yLjEsMS0yLjEsMi4xVjI1YzAsMS4yLDEsMi4xLDIuMSwyLjFzMi4xLTEsMi4xLTIuMVYxMC4xQzUuNSw4LjksNC41LDgsMy4zLDh6Ii8+CgkJCTwvZz4KCQkJPGcgaWQ9IlJlY3RhbmdsZS01XzFfIj4KCQkJCTxwYXRoIGQ9Ik0xNCwyOC40Yy0xLjgsMC0zLjMtMS41LTMuMy0zLjNWMy4zQzEwLjcsMS41LDEyLjIsMCwxNCwwczMuMywxLjUsMy4zLDMuM1YyNUMxNy4zLDI2LjksMTUuOCwyOC40LDE0LDI4LjR6IE0xNCwxLjIKCQkJCQljLTEuMiwwLTIuMSwxLTIuMSwyLjFWMjVjMCwxLjIsMSwyLjEsMi4xLDIuMWMxLjIsMCwyLjEtMSwyLjEtMi4xVjMuM0MxNi4xLDIuMiwxNS4yLDEuMiwxNCwxLjJ6Ii8+CgkJCTwvZz4KCQkJPGcgaWQ9IlJlY3RhbmdsZS01XzJfIj4KCQkJCTxwYXRoIGQ9Ik0yNC43LDI4LjRjLTEuOCwwLTMuMy0xLjUtMy4zLTMuM3YtNi44YzAtMS44LDEuNS0zLjMsMy4zLTMuM3MzLjMsMS41LDMuMywzLjNWMjVDMjgsMjYuOSwyNi41LDI4LjQsMjQuNywyOC40egoJCQkJCSBNMjQuNywxNi4xYy0xLjIsMC0yLjEsMS0yLjEsMi4xVjI1YzAsMS4yLDEsMi4xLDIuMSwyLjFzMi4xLTEsMi4xLTIuMXYtNi44QzI2LjgsMTcsMjUuOCwxNi4xLDI0LjcsMTYuMXoiLz4KCQkJPC9nPgoJCTwvZz4KCTwvZz4KPC9nPgo8L3N2Zz4K" alt="" />'+o.unhtml(e.vote.title)+"</a>"):t},e.prototype._resolveAt=function(t,e){return t.replace(/@[^\s]+/g,function(t){return e[t.trim().substring(1)]||t}).replace(/\n/g,"<br />").replace(/av([0-9]+)/gi,'<a href="//www.bilibili.com/video/av$1/" target="_blank" data-view="$1">av$1</a>').replace(/cv([0-9]+)/gi,'<a href="//www.bilibili.com/read/cv$1/" target="_blank" data-view="$1">cv$1</a>')},e.prototype._timeStrToNumber=function(t){var e=t.split(":");if(3===e.length&&2===e[1].length&&2===e[2].length){var i=parseInt(e[0]),o=parseInt(e[1]),a=parseInt(e[2]);if(o>=0&&o<60&&a>=0&&a<60)return a+60*o+3600*i}if(2===e.length&&2===e[1].length){var o=parseInt(e[0]),a=parseInt(e[1]);if(a>=0&&a<60)return a+60*o}},e.prototype._formateMemberMap=function(t){for(var e,i={},a=0,s=t.length;a<s;++a)e=t[a],i[e.uname]='<a href="//space.bilibili.com/'+e.mid+'" target="_blank" data-usercard-mid="'+e.mid+'">@'+o.unhtml(e.uname)+" </a>";return i},e.prototype._createReplyBox=function(t){var e="",i="";return this.userStatus.isLogin?(this.userStatus.moral<60&&(e="no-login",o.browser.version.mobile?(e+=" moral",i='节操低于60，无法发送评论。<br>详情点击<a class="login-link b-btn" href="https://account.bilibili.com/site/record?type=moral" target="_blank">节操记录</a><a class="jc-help" href="//www.bilibili.com/blackboard/help.html#%E8%8A%82%E6%93%8D%E7%9B%B8%E5%85%B3" target="_blank"><i class="b-tip jc"></i>如何恢复？</a>'):i='你的节操已低于60，将无法发表评论，详情请点击<a class="login-link b-btn" href="https://account.bilibili.com/site/record?type=moral" target="_blank">我的节操记录</a><a class="jc-help" href="//www.bilibili.com/blackboard/help.html#%E8%8A%82%E6%93%8D%E7%9B%B8%E5%85%B3" target="_blank"><i class="b-tip jc"></i>如何恢复节操值？</a>'),this.userStatus.level_info&&this.userStatus.level_info.current_level<2&&this.userStatus.mid!=this.upId&&(e="no-login",i="您的等级不足，升级至Lv2可参与评论"),this.blacklist&&(e="no-login",i="由于UP主隐私设置，你无法评论！")):(i='请先<a class="b-btn btn-open-mini-Login">登录</a>后发表评论 (・ω・)',e="no-login"),t&&(i="当前稿件评论功能已关闭",e="no-login"),['<div class="comment-send '+e+'">','<div class="user-face">','<img class="user-head" src="'+o.trimHttp(o.webp(this.userStatus.face,{w:52,h:52}))+'" />',"</div>",'<div class="textarea-container">',i?'<div class="baffle-wrap"><div class="baffle">'+i+"</div></div>":"",'<i class="ipt-arrow"></i>','<textarea cols="80" name="msg" rows="5" placeholder="请自觉遵守互联网相关的政策法规，严禁发布色情、暴力、反动的言论。" class="ipt-txt"></textarea>','<button type="submit" class="comment-submit" '+(e?'disabled="disabled"':"")+">发表评论</button>","</div>",'<div class="comment-emoji">','<i class="face"></i>','<span class="text">表情</span>',"</div>","</div>"].join("")},e.prototype.loadPage=function(t,e){var i=this;i.loading=!0,e&&$(window).scrollTop(i.$root.offset().top),i.emoji||(i.emoji=new s(i.$root,i.userStatus.vipStatus,i.edata)),this._getReplyByPage(t).done(function(e){i._hideLoading(),i.loaded=!0,e&&0===e.code?e.data&&(i.mode=e.data.mode,i._renderTabs(e),i.blacklist=e.data.blacklist||0,i.assist=e.data.assist||0,i.pageInfo=e.data.page||{},i._renderNotice(e.data.notice),i._updateReplyListByData(e.data,t),i._renderTopPagination(i.pageInfo),i._renderBottomPagination(i.pageInfo),i._fixEmojiPosition(),$(".common .b-head .results").html(e.data.page.acount||0).show(),e.data&&e.data.config&&e.data.config.showentry?$(".common .b-head .del-log").show():$(".common .b-head .del-log").remove(),i.$root.find(".bb-comment > .comment-send").remove(),$(i._createReplyBox()).insertBefore(i.$root.find(".comment-list"))):12002==e.code&&(i.$root.find(".bb-comment > .comment-send").remove(),$(i._createReplyBox(!0)).insertBefore(i.$root.find(".comment-list")))}).fail(function(){i.loaded||i._showLoading('<span>加载失败，<a class="reload-comment">点击重试</a></span>')}).always(function(){i.loading=!1})},e.prototype._renderTabs=function(t){var e=this.$root.find(".comment-header .tabs-order .default-sort"),i=this.$root.find(".comment-header .tabs-order .new-sort"),o=this.$root.find(".comment-header .tabs-order .hot-sort");if(!this.firstLoad){if(this.firstLoad=!0,2===this.mode)return e.hide().removeClass("on"),i.show().addClass("on"),void o.show();if(3===this.mode){var a=e.parent();return a.append(i),e.hide().removeClass("on"),i.show(),o.show().addClass("on"),this.sort=2,void this.loadPage(1)}t.data.page&&t.data.page.count>=20||t.data.hots||2===this.sort?o.show():o.hide(),t.data.hots?this.isViewHot=!0:this.isViewHot=!1}},e.prototype._updateReplyListByData=function(t,e){var i=[],o=-1,a=this;a.upId=t.upper&&t.upper.mid,a.hasUpTop=t.upper&&t.upper.top,t.top&&1===a.pageInfo.num&&(t.top.isTop=!0,i.push(t.top)),t.upper&&t.upper.top&&1===a.pageInfo.num&&(t.upper.top.isUpTop=!0,i.push(t.upper.top)),t.upper&&t.upper.vote&&1===a.pageInfo.num&&(t.upper.vote.isUpTop=!0,i.push(t.upper.vote)),1===e&&0===a.sort&&2!==a.mode&&3!==a.mode&&(a.isViewHot&&(i=i.concat(t.hots||[])),o=t.hots&&t.hots.length>0?i.length:-1,a._pos=o);var s=i.length>0?a._uniq(i.concat(t.replies)):i.concat(t.replies);a._renderReplyList(s,o)},e.prototype._uniq=function(t){var e={};return t.filter(function(t){return!e.hasOwnProperty(t.rpid)&&(e[t.rpid]=!0)})},e.prototype._renderTopPagination=function(t){var e=this,i=Math.ceil(t.count/t.size);i>1?this.$root.find(".header-page").paging({pageCount:i,current:t.num,backFn:function(t){e.$root.trigger("replyPageChange",{p:t}),o.videoReport("playpage_comment_pageclick1")}}):this.$root.find(".header-page").html("")},e.prototype._renderBottomPagination=function(t){var e=this,i=Math.ceil(t.count/t.size);i>1?this.$root.find(".bottom-page").paging({pageCount:i,current:t.num,jump:!o.browser.version.mobile,backFn:function(t){e.$root.trigger("replyPageChange",{p:t,isBottom:!0}),o.videoReport("playpage_comment_pageclick2")}}):this.$root.find(".bottom-page").html("")},e.prototype._renderReplyList=function(t,e){var i="";if(t){this.fbData=t;try{if(0===t.length)i+='<div class="no-more-reply">没有更多信息</div>';else{this.$root.find(".no-more-reply").remove();for(var o=0,a=t.length;o<a;++o){var s=t[o];(o<e||s.isUpTop||s.isTop)&&(s.isHot=!0),i+=this._createReplyItem(s,o,e),e&&o===e-1&&this.isViewHot&&(i+='<div class="hot-line"><span>以上为热门评论，<a class="more-hot">查看更多</a></span></div>')}}this.$root.find(".comment-list").html(i),this.mounted&&this.mounted(t)}catch(t){window.console&&window.console.log("[comment] render ",t)}}},e.prototype._createReplyItem=function(t,e,i){return['<div class="list-item reply-wrap '+(t.isTop||t.isUpTop?"is-top":"")+'" data-id="'+t.rpid+'" data-index="'+e+'">',this._createUserFace(t),this._createListCon(t,e,i),"</div>"].join("")},e.prototype._createLegalizeIcon=function(t){var e="";return t&&0==t.type?e='<div class="legalize p-auth" title="个人认证"></div>':t&&1==t.type&&(e='<div class="legalize o-auth" title="企业/团体认证"></div>'),e},e.prototype._createUserFace=function(t){var e='<div class="user-face"><img src="'+this.noface+'"></div>',i=['<div class="user-face">','<a href="//space.bilibili.com/'+t.mid+'" target="_blank" data-usercard-mid="'+t.mid+'">','<img src="'+o.trimHttp(o.webp(t.member.avatar,o.browser.version.mobile?{w:45,h:45}:{w:52,h:52}))+'" alt="">',"</a>",t.member.pendant&&t.member.pendant.image?'<a href="//space.bilibili.com/'+t.mid+'" class="pendant" data-usercard-mid="'+t.mid+'" target="_blank"><img src="'+o.trimHttp(o.webp(t.member.pendant.image,o.browser.version.mobile?{w:71,h:71}:{w:86,h:86}))+'"></a>':"",this._createLegalizeIcon(t.member.official_verify),t.isHot?this._createFollowButton(t.member,t.rpid):"","</div>"].join("");return t.state===this.blacklistCode?e:i},e.prototype._createFollowButton=function(t,e){function i(t){$.ajax({url:"//api.bilibili.com/x/relation",data:{fid:t.mid,jsonp:"jsonp"},dataType:"jsonp"}).done(function(e){if(e&&0===e.code){var i=$('.follow-btn[data-mid="'+t.mid+'"]'),o=1===e.data.attribute||2===e.data.attribute||6===e.data.attribute,a=1===e.data.attribute;o&&i.addClass("followed").text("已关注"),a&&i.attr("quiet",!0)}})}var a=['<div class="hot-follow">','<button class="follow-btn" data-mid="'+t.mid+'" data-uname="'+o.unhtml(t.uname)+'" data-rpid="'+e+'">关注</button>',"</div>"].join("");return this.userStatus.isLogin&&i(t),a},e.prototype._createListCon=function(t,e,i){var a=this._parentBlacklistDom(t,e,i),s=['<div class="con '+(i==e?"no-border":"")+'">','<div class="user">'+this._identity(t.mid,t.assist,t.member.fans_detail),'<a data-usercard-mid="'+t.mid+'" href="//space.bilibili.com/'+t.mid+'" target="_blank" class="name '+this._createVipClass(t.member.vip.vipType,t.member.vip.vipStatus,t.member.vip.themeType)+'">'+o.unhtml(t.member.uname)+'</a><a href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l'+t.member.level_info.current_level+'"></i></a>'+this._createNameplate(t.member.nameplate)+"</div>",this._createMsgContent(t),'<div class="info">',t.floor?'<span class="floor">#'+t.floor+"</span>":"",this._createPlatformDom(t.content.plat),'<span class="time">'+this._formateTime(t.ctime)+"</span>",'<span class="like '+(1==t.action?"liked":"")+'"><i></i><span>'+(t.like?t.like:"")+"</span></span>",'<span class="hate '+(2==t.action?"hated":"")+'"><i></i></span>',this._createReplyBtn(t.rcount),'<div class="operation"><div class="spot"></div><div class="opera-list"><ul>'+(this._canSetTop(t)?'<li class="set-top">'+(t.isUpTop?"取消置顶":"设为置顶")+"</li>":"")+(this._canBlackList(t.mid)?'<li class="blacklist">加入黑名单</li>':"")+(this._canReport(t.mid)?'<li class="report">举报</li>':"")+(this._canDel(t.mid)&&!t.isTop?'<li class="del" data-mid="'+t.mid+'">删除</li>':"")+"</ul></div></div>",this._createVoteContent(t.content),"</div>",'<div class="reply-box">',this._createSubReplyList(t.replies,t.rcount,!1,t.rpid),"</div>",'<div class="paging-box">',"</div>","</div>"].join("");
return o.browser.version.mobile&&(s=['<div class="con '+(i==e?"no-border":"")+'">','<div class="user">'+this._identity(t.mid,t.assist,t.member.fans_detail),'<a data-usercard-mid="'+t.mid+'" href="//space.bilibili.com/'+t.mid+'" target="_blank" class="name '+this._createVipClass(t.member.vip.vipType,t.member.vip.vipStatus,t.member.vip.themeType)+'">'+o.unhtml(t.member.uname)+'</a><a href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l'+t.member.level_info.current_level+'"></i></a>'+this._createNameplate(t.member.nameplate)+'<div class="right">',t.floor?'<span class="floor">#'+t.floor+"</span>":"",'<span class="time">'+this._formateMobileTime(t.ctime)+"</span></div>","</div>",this._createMsgContent(t),this._createVoteContent(t.content),'<div class="info">',this._createPlatformDom(t.content.plat),'<span class="like '+(1==t.action?"liked":"")+'"><i></i><span>'+(t.like?t.like:"")+"</span></span>",'<span class="hate '+(2==t.action?"hated":"")+'"><i></i></span>',this._createReplyBtn(t.rcount),'<div class="operation"><div class="spot"></div><div class="opera-list"><ul>'+(this._canSetTop(t)?'<li class="set-top">'+(t.isUpTop?"取消置顶":"设为置顶")+"</li>":"")+(this._canBlackList(t.mid)?'<li class="blacklist">加入黑名单</li>':"")+(this._canReport(t.mid)?'<li class="report">举报</li>':"")+(this._canDel(t.mid)&&!t.isTop?'<li class="del" data-mid="'+t.mid+'">删除</li>':"")+"</ul></div></div>","</div>",'<div class="reply-box">',this._createSubReplyList(t.replies,t.rcount,!1,t.rpid),"</div>",'<div class="paging-box">',"</div>","</div>"].join("")),t.state===this.blacklistCode?a:s},e.prototype._createMsgContent=function(t){var e="";if(1===t.state){var i=this._resolveVote(this._resolveSeek(this._resolveEmoji(this._resolveAt(t.content.message,this._formateMemberMap(t.content.members||[])))),t.content);e='<a class="hidden-reply-toggle" href="javascript:;">[此楼层已被用户隐藏 点击查看]</a><div class="quote" style="display:none;">'+(t.isTop||t.isUpTop?'<span class="stick">置顶</span>':"")+i+"</div>"}else if([3,4].indexOf(t.state)!==-1)e='<p><a href="javascript:;">***</a></p>';else{var i=this._resolveVote(this._resolveSeek(this._resolveEmoji(this._resolveAt(t.content.message,this._formateMemberMap(t.content.members||[])))),t.content);e='<p class="text">'+(t.isTop||t.isUpTop?'<span class="stick">置顶</span>':"")+i+"</p>"}return e},e.prototype._createVoteContent=function(t){if(t.vote&&t.vote.id){t.vote.title=o.unhtml(t.vote.title);var e=['<div class="vote-container" data-id="'+t.vote.id+'" data-name="'+t.vote.title+'">','<div class="image-area">','<div class="share-img"></div>',"</div>",'<div class="text-area">','<div class="text-content">'+t.vote.title+"</div>",'<div class="text-desc">'+t.vote.cnt+"人参与</div>",'<div class="vote-btn-box">','<div class="vote-btn">投票</div>',"</div>","</div>","</div>"].join("");return e}return""},e.prototype._canSetTop=function(t){return!!this.userStatus.isLogin&&+this.upId===+this.userStatus.mid&&!t.isTop},e.prototype._canReport=function(t){return+t!==+this.userStatus.mid},e.prototype._canBlackList=function(t){return+t!==+this.userStatus.mid},e.prototype._identity=function(t,e,i){if(+this.upId===t)return'<span class="stick assist">UP</span>';if(e)return'<span class="stick assist">骑士</span>';if(i){var o=["#2EBDA7","#5896DE","#A068F1","#FF86B2","#F68D18"],a=o[Math.ceil(i.level/5)-1];return'<span class="stick true-love" style="border-color:'+a+";color:"+a+'">'+i.medal_name+'<span class="medal-level" style="border-color:'+a+'">'+i.level+"</span></span>"}return""},e.prototype._canDel=function(t){return!!this.userStatus.isLogin&&(+this.upId===+this.userStatus.mid||+this.userStatus.mid===+t||this.assist)},e.prototype._createReplyBtn=function(t){return t>0?'<span class="reply btn-hover btn-highlight">回复</span>':'<span class="reply btn-hover">回复</span>'},e.prototype._createNameplate=function(t){return t.image_small?'<div class="nameplate"><a class="nameplate-icon"'+(o.browser.version.mobile?"":'href="https://account.bilibili.com/site/nameplate.html" target="_blank"')+'><img src="'+o.trimHttp(o.webp(t.image_small,{w:32,h:32}))+'"></a><div class="nameplate-card"><i class="nameplate-arrow"></i><img class="nameplate-pic" src="'+o.trimHttp(o.webp(t.image,{w:62,h:62}))+'"><div class="nameplate-text"><p class="n-name">'+t.name+'</p><p class="n-title">'+t.condition+'</p><p class="n-type"><span>'+t.level+'</span><a href="https://account.bilibili.com/site/nameplate.html" target="_blank">查看全部>></a></p></div></div></div>':""},e.prototype._createPlatformDom=function(t){var e="";return 2===t?e="安卓客户端":3===t?e="iOS客户端":4===t&&(e="Windows Phone客户端"),e&&'<span class="plad">来自<a href="//app.bilibili.com/" target="_blank">'+e+"</a></span>"},e.prototype._checkId=function(t,e){for(var i=0,o=t.length;i<o;++i)if(+t[i].rpid===+e)return!0;return!1},e.prototype._createSubReplyList=function(t,e,i,o){var a="";if(!t||0===t.length)return a;for(var s=!!this.jumpId&&this._checkId(t,this.jumpId),n=i||s?t.length:Math.min(t.length,3),r=0;r<n;++r){var l=t[r],c=this._createSubReplyItem(l,r),d=this._subBlacklistDom(l);a+=l.state===this.blacklistCode?d:c}return!i&&!s&&e>3&&(a+='<div class="view-more">共<b>'+e+'</b>条回复, <a class="btn-more" data-pid="'+o+'">点击查看</a></div>'),a},e.prototype._createSubReplyItem=function(t,e){var i=['<div class="reply-item reply-wrap" data-id="'+t.rpid+'" data-index="'+e+'">','<a href="//space.bilibili.com/'+t.mid+'" data-usercard-mid="'+t.mid+'" target="_blank" class="reply-face">','<img src="'+o.trimHttp(o.webp(t.member.avatar,{w:52,h:52}))+'" alt="">',"</a>",'<div class="reply-con">','<div class="user">','<a href="//space.bilibili.com/'+t.mid+'" target="_blank" data-usercard-mid="'+t.mid+'" class="name '+this._createVipClass(t.member.vip.vipType,t.member.vip.vipStatus,t.member.vip.themeType)+'">'+o.unhtml(t.member.uname)+"</a>",'<a href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l'+t.member.level_info.current_level+'"></i></a>',this._createSubMsgContent(t),"</div>","</div>",'<div class="info">','<span class="time">'+this._formateTime(t.ctime)+"</span>",'<span class="like '+(1==t.action?"liked":"")+'"><i></i><span>'+(t.like?t.like:"")+"</span></span>",'<span class="reply btn-hover">回复</span>','<div class="operation btn-hover btn-hide-re"><div class="spot"></div><div class="opera-list"><ul>'+(this._canBlackList(t.mid)?'<li class="blacklist">加入黑名单</li>':"")+(this._canReport(t.mid)?'<li class="report">举报</li>':"")+(this._canDel(t.mid)?'<li class="del" data-mid="'+t.mid+'">删除</li>':"")+"</ul></div></div>","</div>","</div>"].join("");if(o.browser.version.mobile)var i=['<div class="reply-item reply-wrap" data-id="'+t.rpid+'" data-index="'+e+'">','<div class="reply-con">','<div class="user">','<a href="//space.bilibili.com/'+t.mid+'" target="_blank" data-usercard-mid="'+t.mid+'" class="name '+this._createVipClass(t.member.vip.vipType,t.member.vip.vipStatus,t.member.vip.themeType)+'">'+o.unhtml(t.member.uname)+"</a>",'<a href="//www.bilibili.com/blackboard/help.html#%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3" target="_blank"><i class="level l'+t.member.level_info.current_level+'"></i>','<div class="right"><span class="time">'+this._formateMobileTime(t.ctime)+"</span></div>","</a>",this._createSubMsgContent(t),"</div>",'<div class="info">','<span class="like '+(1==t.action?"liked":"")+'"><i></i><span>'+(t.like?t.like:"")+"</span></span>",'<span class="reply btn-hover">回复</span>','<div class="operation btn-hover btn-hide-re"><div class="spot"></div><div class="opera-list"><ul>'+(this._canBlackList(t.mid)?'<li class="blacklist">加入黑名单</li>':"")+(this._canReport(t.mid)?'<li class="report">举报</li>':"")+(this._canDel(t.mid)?'<li class="del" data-mid="'+t.mid+'">删除</li>':"")+"</ul></div></div>","</div>","</div>","</div>"].join("");return i},e.prototype._createSubMsgContent=function(t){var e="";return e=1===t.state?'<a class="hidden-reply-toggle" href="javascript:;">[此楼层已被用户隐藏 点击查看]</a><div class="quote" style="display:none;">'+this._resolveAt(t.content.message,this._formateMemberMap(t.content.members||[]))+"</div>":[3,4].indexOf(t.state)!==-1?'<a href="javascript:;">***</a>':'<span class="text-con">'+this._resolveEmoji(this._resolveAt(t.content.message,this._formateMemberMap(t.content.members||[])))+"</span>"},e.prototype._formateTime=function(t){if(!+t)return t;var e=Math.floor((new Date).getTime()/1e3),i=new Date;if(i.setHours(0),i.setMinutes(0),i.setSeconds(0),i=Math.floor(i.getTime()/1e3),t>i&&e-t>=0){if(e-t<=50){var o=10*Math.floor((e-t)%60/10);return(t>10?o:10)+"秒前"}return e-t<3600?Math.ceil((e-t)/60)+"分钟前":Math.ceil((e-t)/3600)+"小时前"}var a=new Date;a.setTime(1e3*t);var s=a.getMonth()+1,n=a.getDate(),r=a.getHours(),l=a.getMinutes();return s<10&&(s="0"+s),n<10&&(n="0"+n),r<10&&(r="0"+r),l<10&&(l="0"+l),a.getFullYear()+"-"+s+"-"+n+" "+r+":"+l},e.prototype._formateMobileTime=function(t){if(!+t)return t;var e=Math.floor((new Date).getTime()/1e3);if(e-t>=0){if(e-t<=50){var i=10*Math.floor((e-t)%60/10);return(t>10?i:10)+"秒前"}return e-t<3600?Math.ceil((e-t)/60)+"分钟前":e-t<86400?Math.ceil((e-t)/3600)+"小时前":e-t<2592e3?Math.ceil((e-t)/3600/24)+"天前":e-t<31536e3?Math.ceil((e-t)/3600/24/30)+"月前":Math.ceil((e-t)/3600/24/365)+"年前"}},e.prototype._getReplyByPage=function(t){var e=this;return $.ajax({url:c.reply,data:{jsonp:"jsonp",pn:t,type:e.pageType,oid:e.oid,sort:e.sort},dataType:"jsonp"})},e.prototype._getSubReplyByPage=function(t,e){var o=this;return $.ajax({url:c.subReply,data:{jsonp:"jsonp",pn:e,type:o.pageType,oid:o.oid,ps:i,root:t},dataType:"jsonp"})},e.prototype._createVipClass=function(t,e,i){return 1===i&&2===t?"vip-green-name":2===t&&1===e?"vip-red-name":""},e.prototype._sendMsg=function(t,e,i){var o=this,s=$(t).find(".comment-submit"),n=$(t).find("textarea"),r=this.isSubReply,l=new RegExp(/\[[^\]]+_[^\]]+\]/g),d=e.msg.replace(l,"");if(d=d.replace(/(^\s*)|(\s*$)/g,""),d.length>1e3||d.length<2)return(new a).show(s,"请发送2到1000字且非纯表情的评论",2e3,"error"),n.focus().parent().addClass("error"),!1;n.parent().removeClass("error"),s.text("发送中").addClass("disabled"),o.timer=setTimeout(function(){clearTimeout(o.timer),s.text("发表评论").removeClass("disabled"),(new a).show(t,"当前网速不太给力哦，请尝试重新提交~",2e3,"info")},5e3);var p=String(e.msg).replace(/\　{5,}/g,"　　　").replace(/\n{3,}/g,"\n\n\n")||e.msg,m={oid:this.oid,type:this.pageType,root:e.rid,parent:e.pid,message:(r?this.atMsg:"")+p,plat:e.plat,code:e.code,jsonp:"jsonp"};$.ajax({url:c.add,type:"POST",data:m,dataType:"json",xhrFields:{withCredentials:!0},success:function(e){if(e&&0===e.code){if(n.val(""),i&&i(e.data.rpid),e.data&&1==e.data.is_pending)return void(new a).show(s,"提交成功",2e3);(new a).show(s,"发送成功",2e3),o._removeCaptcha()}else 12041===e.code?o._blackroomExamFB():61001===e.code||61002===e.code?$.getScript("//static.hdslb.com/common/js/identityDialog.js",function(){IdentityDialog(e.code,e.message)}):e&&(new a).show(s,e.message||"操作失败",2e3,"error");e&&e.data&&e.data.need_captcha?o._renderCaptcha(t,e.data.url):o._removeCaptcha(),clearTimeout(o.timer),s.text("发表评论").removeClass("disabled")}})},e.prototype._renderCaptcha=function(t,e){var i='<div class="comment-captcha"><span>验证码：</span><input type="text" class="b-input" size="6" /><img src="'+o.trimHttp(e)+'"/></div>';t.find(".comment-captcha").remove(),t.append(i)},e.prototype._removeCaptcha=function(){$(".comment-captcha").remove()},e.prototype._reportFB=function(t,e,i,s){function n(t,o,n){$.ajax({url:c.report,type:"post",data:{oid:e,type:i,rpid:s,reason:t,content:o,jsonp:"jsonp"},xhrFields:{withCredentials:!0}}).done(function(t){0===t.code?((new a).show(n,"举报成功",1e3,"info"),$(".comment-report-bilibili-mask").remove()):12019==t.code?(new a).show(n,"举报过于频繁，请"+t.data.ttl+"秒后重试",1e3,"error"):(new a).show(n,t.message||"提交失败，请重试",1e3,"info")})}var r=['<div class="comment-bilibili-mask comment-report-bilibili-mask" style="height:'+$(document).height()+'px;">','<div class="comment-bilibili-con comment-report-bilibili">','<div class="t">请选择举报理由<i class="btn-close"></i></div>','<div class="con">','<div class="reason-box"></div>','<div class="other">','<p class="btn-other"><input type="radio" name="reason" id="other" value="0" /><label for="other">其他</label></p>','<div class="ta"><textarea placeholder="自定义理由" value=""></textarea></div></div>','<div class="btn"><a class="btn-cancel">取消</a><a class="btn-submit">确定</a><div>',"</div></div></div>"].join("");$(".comment-report-bilibili-mask").remove(),$("body").append(r);for(var l=[{type:"违反法律法规",list:[{name:"违法违规",reason:9},{name:"色情",reason:2},{name:"低俗",reason:10},{name:"赌博诈骗",reason:12}]},{type:"侵犯个人权益",list:[{name:"人身攻击",reason:7},{name:"侵犯隐私",reason:15}]},{type:"有害社区环境",list:[{name:"垃圾广告",reason:1},{name:"引战",reason:4},{name:"剧透",reason:5},{name:"刷屏",reason:3},{name:"抢楼",reason:16},{name:"视频不相关",reason:8},{name:"青少年不良信息",reason:17}]}],d=$(".comment-report-bilibili .reason-box"),p="",m=0,u=0;u<l.length;u++){p+='<dl class="clearfix"><dt>'+l[u].type+"</dt>";for(var h=0;h<l[u].list.length;h++)p+='<dd><input type="radio" name="reason" id="r'+m+'" value="'+l[u].list[h].reason+'" /><label for="r'+m+'">'+l[u].list[h].name+"</label></dd>",m++;p+="</dl>"}return d.append(p),$(".comment-report-bilibili").off("click.comment-report-close").on("click.comment-report-close",".btn-close,.btn-cancel",function(t){$(".comment-report-bilibili-mask").remove()}),$(".comment-report-bilibili").off("click.comment-report-label").on("click.comment-report-label","label",function(t){"other"===$(this).attr("for")?$(".comment-report-bilibili").find(".ta").show(200):$(".comment-report-bilibili").find(".ta").hide(200)}),$(".comment-report-bilibili").off("click.comment-report-submit").on("click.comment-report-submit",".btn-submit",function(t){var e=$(".comment-report-bilibili").find('input[type="radio"]:checked').val(),i=$(".comment-report-bilibili").find("textarea").val();e?"0"==e?i?o.getByteLen(i)>=2&&o.getByteLen(i)<=200?n(e,i,$(this)):(new a).show($(this),"自定义举报内容长度为2-200字符",1e3,"error"):(new a).show($(this),"请完善举报理由",1e3,"error"):n(e,i,$(this)):(new a).show($(this),"请选择举报理由",1e3,"error")}),!1},e.prototype._voteFB=function(t,e,i){var o=['<div class="comment-bilibili-mask comment-vote-bilibili-mask" style="height:'+$(document).height()+'px;">','<div class="comment-bilibili-con comment-vote-bilibili">','<div class="t">'+i+'<i class="btn-close"></i></div>','<div class="con">','<div class="vote-iframe"><iframe src="//t.bilibili.com/h5/dynamic/vote#/result?vote_id='+e+'&from=comment&isWeb=true" frameborder="0"></iframe></div>',"</div></div></div>"].join("");$(".comment-vote-bilibili-mask").remove(),$("body").append(o),$(".comment-vote-bilibili").off("click.comment-vote-close").on("click.comment-vote-close",".btn-close,.btn-cancel",function(t){$(".comment-vote-bilibili-mask").remove()})},e.prototype._blackListFB=function(t,e,i,o,s){var n=this,r=['<div class="comment-bilibili-mask comment-bilibili-blacklist" style="height:'+$(document).height()+'px;">','<div class="comment-bilibili-con">','<div class="t">确认拉黑该用户<i class="btn-close"></i></div>','<div class="con">','<div class="text">拉黑该用户之后，将自动取消对他的关注，<br>并禁止该用户与我进行互动。</div>','<div class="btn"><a class="btn-cancel">取消</a><a class="btn-submit">确定</a><div>',"</div></div></div>"].join("");$(".comment-bilibili-blacklist").remove(),$("body").append(r),$(".comment-bilibili-blacklist").off("click.comment-blacklist-close").on("click.comment-blacklist-close",".btn-close,.btn-cancel",function(t){$(".comment-bilibili-blacklist").remove()}),$(".comment-bilibili-blacklist").off("click.comment-blacklist-submit").on("click.comment-blacklist-submit",".btn-submit",function(e){var i=this;l.addBlacklist(o,function(e){if(0===e.code){var o="";if(s.hasClass("list-item")){var r=s.data("index"),l=n.fbData[r];o='<div class="user-face"><img src="'+n.noface+'"></div>'+n._parentBlacklistDom(l,r,n._pos),s.html(o)}if(s.hasClass("reply-item")){var r=s.parents(".list-item").data("index"),c=s.data("index"),l=n.fbData[r].replies[c];o=n._subBlacklistDom(l),$(o).insertAfter(s),s.remove()}(new a).show($(i),"加入黑名单成功",1e3,"info"),$(".comment-bilibili-blacklist").remove()}else(new a).show(t,"加入黑名单失败",1e3,"info"),$(".comment-bilibili-blacklist").remove()})})},e.prototype._blackroomExamFB=function(t,e,i,o,a){var s=['<div class="comment-bilibili-mask comment-bilibili-blackexam" style="height:'+$(document).height()+'px;">','<div class="comment-bilibili-con">','<div class="t no-title"><i class="btn-close"></i></div>','<div class="con">','<div class="text">该账号处于封禁中，点击申请答题</div>','<div class="btn"><a class="btn-cancel">取消</a><a class="btn-submit" target="_blank" href="//www.bilibili.com/blackroom/releaseexame.html">去答题</a><div>',"</div></div></div>"].join("");$("body").append(s),$(".comment-bilibili-blackexam").off("click.comment-blackexam-close").on("click.comment-blackexam-close",".btn-close,.btn-cancel,.btn-submit",function(t){$(".comment-bilibili-blackexam").remove()})},e.prototype._parentBlacklistDom=function(t,e,i){return['<div class="con '+(i==e?"no-border":"")+'">','<div class="user blacklist-font-color">黑名单用户</div>','<p class="text">由于黑名单设置，该评论已被隐藏。</p>','<div class="info">',t.floor?'<span class="floor">#'+t.floor+"</span>":"",this._createPlatformDom(t.content.plat),'<span class="time">'+this._formateTime(t.ctime)+"</span>",this._canDel(t.mid)?'<div class="operation btn-hover"><div class="spot"></div><div class="opera-list"><ul><li class="del" data-mid="'+t.mid+'">删除</li></ul></div></div>':"","</div>","</div>"].join("")},e.prototype._subBlacklistDom=function(t){return['<div class="reply-item reply-wrap" data-id="'+t.rpid+'">','<a class="reply-face"><img src="'+this.noface+'"></a>','<div class="reply-con">','<div class="user">','<span class="blacklist-font-color name">黑名单用户 </span> <span class="text-con">由于黑名单设置，该回复已被隐藏。</span>',"</div>","</div>",'<div class="info">','<span class="time">'+this._formateTime(t.ctime)+"</span>",this._canDel(t.mid)?'<div class="operation btn-hover btn-hide-re"><div class="spot"></div><div class="opera-list"><ul><li class="del" data-mid="'+t.mid+'">删除</li></ul></div></div>':"","</div>","</div>"].join("")},e.prototype._setTop=function(t,e){return $.ajax({type:"post",url:c.setTop,dataType:"json",data:{oid:this.oid,type:this.pageType,rpid:t,action:e,jsonp:"jsonp"},xhrFields:{withCredentials:!0}})},e.prototype._delReply=function(t){return $.ajax({type:"POST",url:c.del,dataType:"json",data:{oid:this.oid,type:this.pageType,rpid:t,jsonp:"jsonp"},xhrFields:{withCredentials:!0}})},e.prototype._likeReply=function(t,e){return $.ajax({type:"POST",url:c.like,dataType:"json",data:{oid:this.oid,type:this.pageType,rpid:t,action:e,jsonp:"jsonp"},xhrFields:{withCredentials:!0}})},e.prototype._hateReply=function(t,e){return $.ajax({type:"POST",url:c.hate,dataType:"json",data:{oid:this.oid,type:this.pageType,rpid:t,action:e,jsonp:"jsonp"},xhrFields:{withCredentials:!0}})},e.prototype._updateSubReplyByPage=function(t,e,i,o){var a=this;this._getSubReplyByPage(t,e).done(function(s){if(s&&0===s.code){i.find(".reply-box").html(a._createSubReplyList(s.data.replies,s.data.page.count,!0,t));var n=Math.ceil(s.data.page.count/s.data.page.size),r=i.find(".paging-box");i.find(".reply-box").attr("data-page",e).attr("data-total",s.data.page.count),n>1?r.paging({pageCount:n,current:e,backFn:function(e){a.$root.trigger("subReplyPageChange",{pid:t,page:e,parent:i})}}):i.find(".paging-box").html(""),a._fixEmojiPosition(),"function"==typeof o&&setTimeout(function(){o.call(null)},10)}}).fail(function(){})},e.prototype._registerEvent=function(){function t(){$(window).off("scroll.comment").on("scroll.comment",function(){var t=e.$root.find(".bb-comment > .comment-send"),i=e.$root.find(".bb-comment > .comment-header");!e._isInView(e.$root)||e.loaded||e.loading||(e._showLoading("<span>loading...</span>"),e.edata?e.loadPage(1):e._getEmoji()),$(".comment-list").height()>$(window).height()&&(e._isInView(i,!0)?t.insertAfter(i):e._isInView(e.$root.find(".bottom-page"),!0)&&e.$root.find(".bb-comment").append(t))})}var e=this;this.$root.off("click"),this.$root.off("click.showMore").on("click.showMore",".btn-more",function(){var t=$(this).data("pid");e._updateSubReplyByPage(t,1,$(this).parents(".list-item:eq(0)"))}),this.$root.off("subReplyPageChange").on("subReplyPageChange",function(t,i){e._updateSubReplyByPage(i.pid,i.page,i.parent)}),this.$root.off("replyPageChange").on("replyPageChange",function(t,i){e.loadPage(i.p,i.isBottom)}),this.$root.on("click.openMiniLogin",".btn-open-mini-Login",function(){e.quickLogin()}),this.$root.on("click.emoji",".comment-emoji",function(t){var i=$(this).siblings(".textarea-container").find("textarea"),o=$(this).offset().left-e.$root.offset().left,a=$(this).offset().top-e.$root.offset().top+$(this).outerHeight(),s=$(this).parents(".comment-list").length>0;i.focus(),e.emoji.show(i,o,a,s),t.stopPropagation()}),this.$root.off("focus.textarea").on("focus.textarea","textarea",function(){$(this).parent().addClass("focus"),0===$(this).parents(".list-item").length&&(e.isSubReply=!1),o.browser.version.mobile&&$(window).off("scroll.comment")}),$(window).off("resize.comment").on("resize.comment",function(){e._fixEmojiPosition()}),this.$root.off("blur.textarea").on("blur.textarea","textarea",function(){$(this).parent().removeClass("focus"),o.browser.version.mobile&&t()}),this.$root.off("input.textarea").on("input.textarea","textarea",function(){$(this).parent().removeClass("error")}),this.$root.on("click.sendMsg",".comment-submit",function(){var t=$(this).parent(),o=$(this).siblings("textarea").val()||"",a=void 0,s=t.find(".comment-captcha");if(!$(this).hasClass("disabled")){s.length>0&&(a=s.find("input").val());var n={rid:$(this).attr("data-rid"),pid:$(this).attr("data-pid"),msg:o,plat:1,code:a},r=$(this).parents(".list-item:eq(0)"),l=r.find(".reply-box"),c=+r.find(".reply-box").attr("data-page")||1,d=+r.find(".reply-box").attr("data-total")||0;e._sendMsg(t,n,function(t){n.rid?c!==Math.ceil(d/i)&&0!==d||e._appendSubReplyToTop(t,o,l):e._appendReplyToTop(t,o)})}}),this.$root.on("click.report",".report",function(){if(!e.userStatus.isLogin)return void e.quickLogin();var t=$(this).parents(".reply-wrap:eq(0)"),i=t.data("id");i&&e._reportFB($(this),e.oid,e.pageType,i)}),this.$root.on("click.blacklist",".blacklist",function(){if(!e.userStatus.isLogin)return void e.quickLogin();var t=$(this).parents(".reply-wrap:eq(0)"),i=t.find("[data-usercard-mid]:eq(0)").data("usercard-mid");i&&e._blackListFB($(this),e.oid,e.pageType,i,t)}),this.$root.on("click.reply",".reply",function(){var t=$(this).parents(".list-item:eq(0)"),i=$(this).parents(".reply-wrap:eq(0)"),o=i.hasClass("reply-item"),a=o?"回复 @"+i.find(".user .name").text()+" :":"请自觉遵守互联网相关的政策法规，严禁发布色情、暴力、反动的言论。";e.isSubReply=o,e.atMsg="回复 @"+i.find(".user .name").text()+" :";var s=t.attr("data-id"),n=i.attr("data-id"),r=!e.userStatus.isLogin||e.userStatus.level_info&&e.userStatus.level_info.current_level<2&&e.userStatus.mid!=e.upId&&1!=e.userStatus.vipStatus&&e.userStatus.official_verify&&e.userStatus.official_verify.type==-1;if(t.siblings(".list-item").removeClass("open-reply").find(".comment-send").remove(),t.hasClass("open-reply")){var l=t.find(".comment-send .comment-submit"),c=l.attr("data-rid")!==l.attr("data-pid");o||c?r?"":t.find(".comment-send textarea").focus().prop("placeholder",a).val(""):(t.find(".comment-send").remove(),t.removeClass("open-reply"))}else t.find(".con").append(e._createReplyBox()),t.addClass("open-reply"),r?"":t.find(".comment-send textarea").focus().prop("placeholder",a).val("");t.find(".comment-send button.comment-submit").attr("data-rid",s).attr("data-pid",n)}),this.$root.on("click",".follow-btn",function(){if(e.userStatus.isLogin){var t=$(this),i=$('.follow-btn[data-mid="'+t.data("mid")+'"]');t.hasClass("followed")?l.unFollow(t.data("mid"),function(s){0===s.code?(o.customReport("follow_click",{type:9,aid:e.oid,follow:!1}),i.removeClass("followed").text("关注"),(new a).show(t,"取消关注成功!",500,"ok")):(new a).show(t,s.message,500,"error")},t.attr("quiet"),122):l.follow(t.data("mid"),function(s){return 22006==s.code?void $.getScript("//static.hdslb.com/plugins/attentionLimitPopup/attentionLimitPopup.js",function(){new attentionLimitPopup}):void(0===s.code?(o.customReport("follow_click",{type:9,aid:e.oid,follow:!0}),i.addClass("followed").text("已关注"),o.browser.version.mobile||$.getScript("//static.hdslb.com/common/js/followGroupDialog.js",function(){followGroupDialog(t.data("mid"),t.data("uname"),{showErrMsgInDialog:!1,onAddTagError:function(t){(new a).show($(".follow-dialog-window .submit"),t||"添加分组失败")},onSubmitError:function(t){(new a).show($(".follow-dialog-window .submit-move"),t||"移动分组失败")},onSubmitSuccess:function(){(new a).show($(".follow-dialog-window"),"加入分组成功")},onEmptyTagSubmit:function(){(new a).show($(".follow-dialog-window"),"加入分组成功")}})})):(new a).show(t,s.message,500,"error"))},122)}else o.browser.version.mobile?location.href="//passport.bilibili.com/login":$.getScript("https://static-s.bilibili.com/account/bili_quick_login.js",function(){window.biliQuickLogin(function(t){window.location.reload()})})}),this.$root.on("click.delete",".del",function(){var t=$(this).parents(".reply-wrap:eq(0)"),i=+t.attr("data-id"),o=t.hasClass("list-item")?"删除评论后，评论下所有回复都会被删除":"删除评论后将不可恢复",s=$(this),n=s.attr("data-mid"),r=e.userStatus.mid==e.upId&&n!=e.upId;(new a).show(s,"<p>"+o+"</p><p>是否继续？</p>","button",function(){e._reportEvent(r?"upmaster_deletecomment":"user_deletecomment"),e._delReply(i).done(function(i){0===i.code?((new a).show(t,"删除成功"),t.hasClass("reply-item")?t.remove():e.loadPage(e.pageInfo.num||1)):(new a).show(t,i.message||"操作失败")})})}),this.$root.on("click.set-top",".set-top",function(){var t=$(this),i=t.parents(".list-item:eq(0)"),o=+i.attr("data-id"),s=i.hasClass("is-top"),n=s?0:1,r=s?"取消成功":"置顶成功";return e.hasUpTop&&!s?void(new a).show(i,"<p>您只能置顶一条评论哦</p><p>先取消原来的吧！</p>"):(e._setTop(o,n).done(function(t){t&&0===t.code?((new a).show(i,r),e.loadPage(1)):(new a).show(i,t.message||"操作失败")}),void e._reportEvent(s?"upmaster_cancelstick":"upmaster_stick"))}),this.$root.on("click.like",".like",function(){if(!e.userStatus.isLogin)return void e.quickLogin();var t,i=$(this),o=$(this).parents(".reply-wrap:eq(0)"),s=+o.attr("data-id"),n=i.siblings(".hate");t=i.hasClass("liked")?0:1,e._likeReply(s,t).then(function(e){if(e&&0===e.code){if(0===t){i.removeClass("liked");var o=+i.find("span").text()-1;i.find("span").text(o>0?o:"")}else if(1===t){i.addClass("liked");var o=+i.find("span").text()+1;i.find("span").text(o>0?o:""),n.removeClass("hated")}}else(new a).show(i,e.message||"操作失败")})}),this.$root.on("click.hate",".hate",function(){if(!e.userStatus.isLogin)return void e.quickLogin();var t,i=$(this),o=$(this).parents(".reply-wrap:eq(0)"),s=+o.attr("data-id"),n=i.siblings(".like");t=i.hasClass("hated")?0:1,e._hateReply(s,t).then(function(e){if(e&&0===e.code){if(0===t)i.removeClass("hated");else if(1===t&&(i.addClass("hated"),n.hasClass("liked"))){n.removeClass("liked");var o=+n.find("span").text()-1;n.find("span").text(o>0?o:"")}}else(new a).show(i,e.message||"操作失败")})}),this.$root.on("click.operation",".spot",function(t){$(".opera-list").hide(),$(this).siblings(".opera-list").show(),t.stopPropagation()}),$(document).off("click.hide-operation").on("click.hide-operation",function(){$(".opera-list").hide()}),this.$root.off("mouseleave.operation").on("mouseleave.operation",".opera-list",function(t){$(".opera-list").hide()}),this.$root.on("click.tab",".tabs-order li",function(){var t=$(this);t.hasClass("on")||(t.addClass("on").siblings().removeClass("on"),e.sort=+t.attr("data-sort"),e.loadPage(1)),"0"==t.attr("data-sort")&&o.videoReport("playpage_comment_allcomment"),"2"==t.attr("data-sort")&&o.videoReport("playpage_comment_hotcomment")}),this.$root.on("click.moreHot",".more-hot",function(){e.$root.find(".tabs-order li").removeClass("on"),e.$root.find('.tabs-order li[data-sort="2"]').addClass("on"),e.sort=2,e.loadPage(1,!0)}),this.$root.on("click.reload",".reload-comment",function(){e._showLoading("<span>loading...</span>"),e.loadPage(1)}),this.$root.on("click.notice",".reply-notice",function(){o.customReport("playpage_anoun")}),this.$root.on("click.deletNotice",".icon-close-notice",function(){var t=$(this).parent(),i=+t.attr("data-id");if(m){var a=+window.localStorage.getItem(u);i>a&&window.localStorage.setItem(u,i)}t.remove(),e._reportEvent("comment_notice_close"),o.customReport("playpage_anoun_delete")}),t(),this.$root.on("click.captcha",".comment-captcha > img",function(){var t=$(this).get(0),e=t.src.indexOf("&_ts=");t.src=t.src.substr(0,e===-1?t.src.length:e)+"&_ts="+Date.now()}),this.$root.on("click.hide",".hidden-reply-toggle",function(){$(this).siblings(".quote").slideToggle(200)}),this.$root.on("click.notice",".notice-item a",function(){e._reportEvent("comment_notice_click")}),this.$root.on("click.vote",".vote-container, .vote-link",function(){if(!e.userStatus.isLogin)return void e.quickLogin();var t=$(this).data("id"),i=$(this).data("name");o.browser.version.mobile&&(location.href="//t.bilibili.com/h5/dynamic/vote#/result?vote_id="+t+"&from=comment"),t&&e._voteFB($(this),t,i)}),this.$root.on("click.seek",".video-seek",function(){if(window.commentAgent&&"function"==typeof window.commentAgent.seek){var t=$(this).data("time"),e=$(this).data("p");e<0?(window.commentAgent.seek(t),o.customReport("reply_timelink_click",{time:t})):(window.commentAgent.seek(t,e),o.customReport("reply_timelink_click",{time:t,p:e})),window.scrollTo(0,0)}})},e.prototype._isInView=function(t,e){if(t.length){var i=$(window).height(),o=t.offset().top-$(window).scrollTop();return e?o<=i&&o>=0:o<=i}},e.prototype._showLoading=function(t){this.$root.find(".comment-loading").remove(),this.$root.find(".bb-comment").append('<div class="comment-loading">'+t+"</div>")},e.prototype._hideLoading=function(){this.$root.find(".comment-loading").remove()},e.prototype.jumpToReply=function(t){var e=this;e.emoji||(e.emoji=new s(e.$root,e.userStatus.vipStatus,e.edata)),this.jumpId=t,e.loading=!0,$.ajax({url:c.jump,dataType:"jsonp",data:{jsonp:"jsonp",rpid:t,oid:e.oid,type:e.pageType}}).done(function(i){e._hideLoading(),e.loaded=!0,0===i.code?(e.mode=i.data.mode,e._renderTabs(i),e.blacklist=i.data.blacklist||0,e.assist=i.data.assist||0,e.pageInfo=i.data.page||{},e._renderNotice(i.data.notice),e._updateReplyListByData(i.data,e.pageInfo.num),e._renderTopPagination(e.pageInfo),e._renderBottomPagination(e.pageInfo),$(".common .b-head .results").html(i.data.page.acount||0).show(),i.data&&i.data.config&&i.data.config.showentry?$(".common .b-head .del-log").show():$(".common .b-head .del-log").remove(),e.$root.find(".bb-comment > .comment-send").remove(),$(e._createReplyBox()).insertBefore(e.$root.find(".comment-list")),e.jumpId="",setTimeout(function(){var i=$('[data-id="'+t+'"]');if(!i.length)return $(window).scrollTop(e.$root.offset().top),e._showMessage("评论已被删除",2500),void(window.console&&window.console.log("[comment] dom not find when jump"));if($(window).scrollTop(i.offset().top),i.hasClass("reply-item")){var o=i.parents(".list-item:eq(0)");e._updateSubReplyByPage(+o.attr("data-id"),e.pageInfo.rt_num,o,function(){$('[data-id="'+t+'"]').find(".reply").click()})}else i.hasClass("list-item")&&i.find(".con .reply").click()},100)):12002==i.code&&(e.$root.find(".bb-comment > .comment-send").remove(),$(e._createReplyBox(!0)).insertBefore(e.$root.find(".comment-list")))}).fail(function(){e.loaded||e._showLoading('<span>加载失败，<a class="reload-comment">点击重试</a></span>')}).always(function(){e.loading=!1})},e.prototype._showMessage=function(t,e){$("body").append('<div class="comment-msg"><span>'+t+"</span></div>"),setTimeout(function(){$(".comment-msg").remove()},e||2e3)},e.prototype._reportEvent=function(t,e){"function"==typeof window.rec_rp&&window.rec_rp("event",t,e)},e.prototype._appendReplyToTop=function(t,e){var i={rpid:t,mid:this.userStatus.mid,type:1,count:0,rcount:0,
floor:"",state:0,attr:0,ctime:"刚刚",like:0,action:0,member:{mid:this.userStatus.mid,uname:o.unhtml(this.userStatus.uname),avatar:this.userStatus.face,level_info:this.userStatus.level_info,pendant:this.userStatus.pendant,nameplate:{nid:0,name:"",image:"",image_small:"",level:"",condition:""},official_verify:this.userStatus.officialVerify,vip:{vipType:this.userStatus.vipType,vipDueDate:this.userStatus.vipDueDate,dueRemark:this.userStatus.dueRemark,accessStatus:this.userStatus.accessStatus,vipStatus:this.userStatus.vipStatus,vipStatusWarn:"",themeType:this.userStatus.vip_theme_type}},content:{message:o.unhtml(e),plat:1,device:"",members:[]},replies:null},a=$(this._createReplyItem(i,1)),s=this.$root.find(".comment-list .list-item:eq(0)");if(s.length>0?s.before(a):(this.$root.find(".no-more-reply").remove(),this.$root.find(".comment-list").append(a)),this.mounted){var n=this.fbData;n.unshift(i),this.mounted(n)}},e.prototype._appendSubReplyToTop=function(t,e,i){var a={rpid:t,mid:this.userStatus.mid,type:1,count:0,rcount:0,floor:"",state:0,attr:0,ctime:"刚刚",like:0,action:0,member:{mid:this.userStatus.mid,uname:o.unhtml(this.userStatus.uname),avatar:this.userStatus.face,level_info:this.userStatus.level_info,pendant:this.userStatus.pendant,nameplate:{nid:0,name:"",image:"",image_small:"",level:"",condition:""},official_verify:this.userStatus.officialVerify,vip:{vipType:this.userStatus.vipType,vipDueDate:this.userStatus.vipDueDate,dueRemark:this.userStatus.dueRemark,accessStatus:this.userStatus.accessStatus,vipStatus:this.userStatus.vipStatus,vipStatusWarn:"",themeType:this.userStatus.vip_theme_type}},content:{message:o.unhtml(e),plat:1,device:"",members:[]},replies:null},s=$(this._createSubReplyItem(a));i.prepend(s),this._fixEmojiPosition()},t.bbComment=e}(window)},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e){},function(t,e,i){function o(t,e,i){this.container=t,this.isVip=e,this.data=i,this.defaultEmojis=["(⌒▽⌒)","（￣▽￣）","(=・ω・=)","(｀・ω・´)","(〜￣△￣)〜","(･∀･)","(°∀°)ﾉ","(￣3￣)","╮(￣▽￣)╭","( ´_ゝ｀)","←_←","→_→","(<_<)","(>_>)","(;¬_¬)",'("▔□▔)/',"(ﾟДﾟ≡ﾟдﾟ)!?","Σ(ﾟдﾟ;)","Σ( ￣□￣||)","(´；ω；`)","（/TДT)/","(^・ω・^ )","(｡･ω･｡)","(●￣(ｴ)￣●)","ε=ε=(ノ≧∇≦)ノ","(´･_･`)","(-_-#)","（￣へ￣）","(￣ε(#￣) Σ","ヽ(`Д´)ﾉ","(╯°口°)╯(┴—┴","（#-_-)┯━┯","_(:3」∠)_","(笑)","(汗)","(泣)","(苦笑)"],this.currentSelect=0,this.curPage=1,this.totalPage=1,this.tabNum=5,this.tabWidth=58,this.avalEmojiNum=1,this.emojiData=[],this.emojiDom="<div class='emoji-box'><div class='emoji-title'><span></span></div><div class='emoji-wrap'></div><div class='emoji-tabs'><div class='emoji-container'><div class='emoji-tab-wrap clearfix'></div></div></div></div>",this.init()}i(6);var a=i(1);o.prototype={init:function(){$(this.container).find(".emoji-box").remove(),$(this.container).append(this.emojiDom),this.emojiBox=$(this.container).find(".emoji-box"),this.hide();var t=$(this.container).find(".emoji-tabs"),e=$(this.container).find(".emoji-wrap"),i=$(this.container).find(".emoji-title"),o=this,s=this.data.free,n=this.data.vip;this.freeLength=s.length,this.defaultCursor=s.length;for(var r=0;r<s.length;r++)this.emojiData.push(s[r]),0==n[r].pstate&&this.avalEmojiNum++;if(this.emojiData.push({pname:"颜文字",pid:-1,pstate:0,emojis:this.defaultEmojis,purl:"//static.hdslb.com/images/base/emoji-tab-default.png"}),this.isVip)for(var r=0;r<n.length;r++)this.emojiData.push(n[r]),0==n[r].pstate&&this.avalEmojiNum++;this.createTabs(t),this.createEmoji(e,i,this.emojiData[0].pid),t.off("click.tab").on("click.tab",".tab-link",function(){o.currentSelect=+$(this).attr("data-index");var t=+$(this).data("pid");o.oldCurrentSelect=o.currentSelect,$(this).addClass("on").siblings(".tab-link").removeClass("on"),o.createEmoji(e,i,t)}),e.off("click").on("click",".emoji-list",function(t){var e=$(this).attr("data-emoji-text");o.insertAtCursor($(o.ta)[0],e),o.emojiBox.hide();var i=$(this),s=i.data("pid"),n=i.data("id"),r=i.data("index"),l={};s?l={pid:s,id:n}:r&&(l={index:r}),a.customReport("emoji_click",l)}),$(document).off("click.offEmoji").on("click.offEmoji",function(t){o.emojiBox.is(t.target)||0!==o.emojiBox.has(t.target).length||o.emojiBox.hide()}),t.off("click.prev").on("click.prev",".prev",function(){o.curPage>1&&o.curPage--,o.updateTabSlide()}),t.off("click.next").on("click.next",".next",function(){o.curPage<o.totalPage&&o.curPage++,o.updateTabSlide()})},updateTabSlide:function(){var t=$(this.container).find(".emoji-tab-slider"),e=t.find(".prev"),i=t.find(".next");this.curPage>1?e.addClass("on"):e.removeClass("on"),this.curPage<this.totalPage?i.addClass("on"):i.removeClass("on"),$(this.container).find(".emoji-tab-wrap").css({left:-1*(this.curPage-1)*this.tabWidth*this.tabNum})},createTabs:function(t){var e="";this.totalPage=Math.ceil(this.avalEmojiNum/this.tabNum);for(var i=0;i<this.emojiData.length;i++)if(0==this.emojiData[i].pstate){var o=this.currentSelect==i?"on":"",s=this.emojiData[i].pid;e+="<a class='tab-link "+o+"' data-index='"+i+"' data-pid='"+s+"'><img src='"+a.trimHttp(a.webp(this.emojiData[i].purl,{w:44,h:44}))+"'></a>"}t.find(".emoji-tab-wrap").html(e).css({width:this.emojiData.length*this.tabWidth,left:0}),t.find(".emoji-tab-slider").remove(),this.totalPage>1&&t.append('<div class="emoji-tab-slider clearfix"><span class="prev"></span><span class="next on"></span></div>')},createEmoji:function(t,e,i){if(e.find("span").text(this.emojiData[this.currentSelect].pname),this.currentSelect==this.defaultCursor){for(var o="",s=0;s<this.emojiData[this.defaultCursor].emojis.length;s++)o+="<a class='emoji-list emoji-text emoji-default' data-emoji-text='"+this.emojiData[this.defaultCursor].emojis[s]+"' data-index='"+s+"'>"+this.emojiData[this.defaultCursor].emojis[s]+"</a>";t.html("").append(o)}else{for(var o="",n=this.emojiData[this.currentSelect].emojis,s=0;s<n.length;s++)if(0==n[s].state){var r="emoji-list emoji-text emoji-pic";n[s].size&&"s"===n[s].size&&(r+=" emoji-small");var l=n[s].id;o+="<a class='"+r+"' data-emoji-text='"+n[s].name+"' data-pid='"+i+"' data-id='"+l+"'><img src='"+a.trimHttp(a.webp(n[s].url,{w:56,h:56}))+"' title='"+n[s].name+"'></a>"}t.html("").append(o)}},insertAtCursor:function(t,e){if(document.selection)t.focus(),sel=document.selection.createRange(),sel.text=e,sel.select();else if(t.selectionStart||"0"==t.selectionStart){var i=t.selectionStart,o=t.selectionEnd,a=t.scrollTop;t.value=t.value.substring(0,i)+e+t.value.substring(o,t.value.length),a>0&&(t.scrollTop=a),t.focus(),t.selectionStart=i+e.length,t.selectionEnd=i+e.length}else t.value+=e,t.focus()},show:function(t,e,i,o){this.ta=t,this.emojiBox.show().css({left:e,top:i}),$(this.container).find(".emoji-tabs .tab-link"),$(this.container).find(".emoji-tab-slider")},hide:function(){this.emojiBox.hide()}},t.exports=o},function(t,e,i){i(8),function(t){var e={init:function(t,i){return function(){e.fillHtml(t,i),e.bindEvent(t,i)}()},fillHtml:function(t,e){return function(){t.empty(),e.pageCount>1&&!e.jump&&t.append('<span class="result">共'+e.pageCount+"页</span>"),e.current>1?t.append('<a href="javascript:;" class="prev">上一页</a>'):(t.remove(".prev"),t.append('<span class="disabled">上一页</span>')),1!=e.current&&e.current>=4&&4!=e.pageCount&&t.append('<a href="javascript:;" class="tcd-number">1</a>'),e.current-2>2&&e.current<=e.pageCount&&e.pageCount>5&&t.append('<span class="dian">...</span>');var i=e.current-2,o=e.current+2;for((i>1&&e.current<4||1==e.current)&&o++,e.current>e.pageCount-4&&e.current>=e.pageCount&&i--;i<=o;i++)i<=e.pageCount&&i>=1&&(i!=e.current?t.append('<a href="javascript:;" class="tcd-number">'+i+"</a>"):t.append('<span class="current">'+i+"</span>"));e.current+2<e.pageCount-1&&e.current>=1&&e.pageCount>5&&t.append('<span class="dian">...</span>'),e.current!=e.pageCount&&e.current<e.pageCount-2&&4!=e.pageCount&&t.append('<a href="javascript:;" class="tcd-number">'+e.pageCount+"</a>"),e.current<e.pageCount?t.append('<a href="javascript:;" class="next">下一页</a>'):(t.remove(".next"),t.append('<span class="disabled">下一页</span>')),e.pageCount>1&&e.jump&&t.append('<div class="page-jump">共<span>'+e.pageCount+'</span>页，跳至<input type="text" />页</div>')}()},bindEvent:function(i,o){return function(){i.off("click"),i.off("keydown"),i.on("click","a.tcd-number",function(){var a=parseInt(t(this).text());e.fillHtml(i,{current:a,pageCount:o.pageCount,jump:o.jump}),"function"==typeof o.backFn&&o.backFn(a)}),i.on("click","a.prev",function(){var t=parseInt(i.children("span.current").text());e.fillHtml(i,{current:t-1,pageCount:o.pageCount,jump:o.jump}),"function"==typeof o.backFn&&o.backFn(t-1)}),i.on("click","a.next",function(){var t=parseInt(i.children("span.current").text());e.fillHtml(i,{current:t+1,pageCount:o.pageCount,jump:o.jump}),"function"==typeof o.backFn&&o.backFn(t+1)}),i.on("keydown","input",function(a){if(13==a.keyCode){var s=Math.abs(parseInt(t(this).val())),n=s?s:1;n=n>o.pageCount?o.pageCount:n,e.fillHtml(i,{current:n,pageCount:o.pageCount,jump:o.jump}),"function"==typeof o.backFn&&o.backFn(n)}})}()}};t.fn.paging=function(i){var o=t.extend({pageCount:10,current:1,jump:!1,backFn:function(){}},i);e.init(this,o)}}(jQuery)},function(t,e,i){function o(t){if(!s.browser.version.mobile){var e={isLogin:!1,vipStatus:0,vipType:0,mid:null};this.userStatus=$.extend(e,t),s.browser.version.mobile||this._registerEvent()}}i(9);var a=i(2),s=i(1),n=i(3),r={},l=new a,c=0;o.prototype.reset=function(t){this.userStatus=t,r={}},o.prototype._renderCard=function(t){$(".user-card").remove(),$("body").append(this._createCard(t)),s.videoReport("playpage_namecard2")},o.prototype._renderErrorCard=function(){$(".user-card").remove(),$("body").append(this._createErrorCard())},o.prototype._renderLoadingCard=function(){$(".user-card").remove(),$("body").append(this._createLoadingCard())},o.prototype._isLikeMe=function(t){if(t.card&&t.card.attentions)for(var e=0,i=t.card.attentions.length;e<i;++e)if(t.card.attentions[e]===this.userStatus.mid)return!0;return!1},o.prototype._createCard=function(t){var e=t.space.s_img?t.space.s_img:"//i0.hdslb.com/bfs/static/c9dae917e24b4fc17c4d544caf6b6c0b17f8692b.jpg",i=0===t.card.official_verify.type?'<i title="个人认证" class="auth p-auth"></i>':"",o=1===t.card.official_verify.type?'<i title="企业/团体认证" class="auth o-auth"></i>':"",a="保密"===t.card.sex?"":"男"===t.card.sex?'<i class="sex men"></i>':'<i class="sex women"></i>',n=t.card.sign?'<p class="sign">'+s.unhtml(t.card.sign)+"</p>":"",r="";r=1===t.card.vip.theme_type&&2===t.card.vip.vipType?"vip-green-name":2===t.card.vip.vipType&&1===t.card.vip.vipStatus?"vip-red-name":"";var l=this._isLikeMe(t),c=t.following?"已关注":"+关注",d=t.following?"liked":"";return d+=l?" liked-me":"",'<div class="user-card"><div class="bg" style="background-image:url('+s.trimHttp(s.webp(e,{w:750,h:240}))+')"></div><a target="_blank" href="//space.bilibili.com/'+t.card.mid+'" class="face"><img src="'+s.trimHttp(s.webp(t.card.face,{w:50,h:50}))+'" />'+i+o+'</a><div class="info"><p class="user"><a target="_blank" href="//space.bilibili.com/'+t.card.mid+'" class="name '+r+'">'+s.unhtml(t.card.name)+"</a>"+a+'<a href="//www.bilibili.com/html/help.html#k_'+t.card.level_info.current_level+'" target="_blank"><i class="level l'+t.card.level_info.current_level+'"></i></a></p><p class="social"><a href="//space.bilibili.com/'+t.card.mid+'/#!/fans/follow" target="_blank">关注: <span class="like">'+t.card.friend+'</span></a><a href="//space.bilibili.com/'+t.card.mid+'/#!/fans/fans" target="_blank">粉丝: <span class="fans">'+s.formatNum(t.card.fans)+"</span></a></p>"+n+'</div><div class="btn-box"><a class="like '+d+'" mid="'+t.card.mid+'" uname="'+s.unhtml(t.card.name)+'"'+(t.quiet?' quiet="true"':"")+'><span class="default-text">'+c+'</span><span class="hover-text">取消关注</span></a><a href="//message.bilibili.com/#whisper/mid'+t.card.mid+'" target="_blank" class="message">发消息</a></div></div>'},o.prototype._createErrorCard=function(){return'<div class="user-card"><p class="error-card">加载失败</p></div>'},o.prototype._createLoadingCard=function(){return'<div class="user-card"><p class="loading-card">正在加载中...请稍后。</p></div>'},o.prototype._setPosition=function(t){var e=$(t).offset().left,i=$(t).offset().top;if($(t).outerWidth(),$(t).offset().top<$(window).scrollTop()+$(".user-card").height()+32)var o=i+$(t).outerHeight()+8;else var o=i-$(".user-card").height()-32;$(t.height),$(".user-card").css({left:e,top:o})},o.prototype._registerEvent=function(){var t=this;$("body").off("click.userCardAttention").on("click.userCardAttention",".user-card .btn-box .like",function(){if(t.userStatus.isLogin){var e=$(this).hasClass("liked"),i=($(this).hasClass("liked-me"),$(this).attr("mid")),o=$(this).attr("uname"),a=this;e?(l.unFollow(i,function(t){t&&0===t.code?($(a).removeClass("liked").find(".default-text").text("+关注"),delete r[i],(new n).show($(a),"取消关注成功!",1e3,"ok")):t&&(new n).show($(a),t.message,1e3,"error")},$(this).attr("quiet")),s.videoReport("playpage_unfollow2")):(l.follow(i,function(t){22006==t.code?$.getScript("//static.hdslb.com/plugins/attentionLimitPopup/attentionLimitPopup.js",function(){new attentionLimitPopup}):t&&0===t.code?($(a).text("取消关注").addClass("liked"),$.getScript("//static.hdslb.com/common/js/followGroupDialog.js",function(){$(".user-card").remove(),followGroupDialog(i,o,{showErrMsgInDialog:!1,onAddTagError:function(t){(new n).show($(".follow-dialog-window .submit"),t||"添加分组失败")},onSubmitError:function(t){(new n).show($(".follow-dialog-window .submit-move"),t||"移动分组失败")},onSubmitSuccess:function(){(new n).show($(".follow-dialog-window"),"加入分组成功")},onEmptyTagSubmit:function(){(new n).show($(".follow-dialog-window"),"加入分组成功")}})}),delete r[i]):t&&(new n).show($(a),t.message,1e3,"error")}),s.videoReport("playpage_follow2"))}else document.location.href="https://account.bilibili.com/login"}),$("body").on("mouseenter.data-userCard","[data-usercard-mid]",function(e){var i=$(this).attr("data-usercard-mid"),o=this;clearTimeout(c),c=setTimeout(function(){r[i]?(t._renderCard(r[i]),t._setPosition(o)):(t._renderLoadingCard(),t._setPosition(o),$.ajax({url:"//api.bilibili.com/x/web-interface/card",dataType:"jsonp",data:{mid:i,photo:1,jsonp:"jsonp"},dataType:"jsonp",cache:!0,success:function(e){e&&0===e.code&&$.ajax({url:"//api.bilibili.com/x/relation",data:{fid:i,jsonp:"jsonp"},dataType:"jsonp"}).done(function(i){i&&0===i.code?(e.data.following=1===i.data.attribute||2===i.data.attribute||6===i.data.attribute,e.data.quiet=1===i.data.attribute):e.data.following=!1,t._renderCard(e.data),t._setPosition(o),r[e.data.card.mid]=e.data}).fail(function(){t._renderErrorCard(),t._setPosition(o)})},error:function(){t._renderErrorCard(),t._setPosition(o)}}))},300)}),$("body").on("mouseleave.data-userCard","[data-usercard-mid]",function(t){clearTimeout(c),c=setTimeout(function(){$(".user-card").remove()},100)}),$("body").on("mouseenter.userCard",".user-card",function(t){clearTimeout(c)}),$("body").on("mouseleave.userCard",".user-card",function(t){$(".user-card").remove()})},t.exports=o}]);