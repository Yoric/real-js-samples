define(["jquery","base/view","util/helpers"],function(a,b,c){"use strict";var d={};return b.extend({autoInit:!0,public:{init:function(){this.options.fn&&this.run(this.options.fn)},run:function(b){var e=this,f="("+b.toString()+")()";window.URL=window.URL||window.webkitURL;try{this.options.cache?(this.urlBlob=d[f],this.urlBlob||(this.blob=this.createBlob(f),this.urlBlob=window.URL.createObjectURL(this.blob),d[f]=this.urlBlob,this.worker=new Worker(this.urlBlob))):(this.blob=this.createBlob(f),this.urlBlob=window.URL.createObjectURL(this.blob),this.worker=new Worker(this.urlBlob)),this.worker.onmessage=this.onMessage.bind(this)}catch(d){this.worker={fn:b,postMessage:function(a){"inside"!==a.type?c.isFunction(this.onmessage)&&this.onmessage({data:a}):e.onMessage({data:a})}},a.extend(!0,this.worker,this.options.globalVars),this.worker.fn()}return this},destroy:function(){return window.URL=window.URL||window.webkitURL,this.options.cache||(window.URL.revokeObjectURL(this.urlBlob),this.worker.terminate(),delete this.blob,delete this.urlBlob,delete this.worker),this},postMessage:function(a,b){return this.worker&&this.worker.postMessage({cmd:a,data:b}),this}},protected:{createBlob:function(a){var b;try{b=new Blob([a],{type:"application/javascript"})}catch(c){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,b=new window.BlobBuilder,b.append(a),b=b.getBlob()}return b},onMessage:function(a){this.trigger("message",a.data)}}})});