var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),BootstrapMapsAnswerForMapOverlay=function(n){function t(t,i,r){var u=n.call(this,t,i)||this,f;return u._slimHeaderClass="b_slimHead",u._savedIdentityLoginMode=0,u._detailsCardWidth=380,u._overlayPageName="o",u._isAttractionOverlay=!1,u.padding={left:390,right:75,top:70,bottom:30},u._mapOptions.showScalebar=!0,u._mapOptions.showBreadcrumb=!0,u._mapOptions.showLocateMeButton=!0,u._mapOptions.showLandmarks=!0,u._navigateToMapsVertical=!1,u._taskBar=null,u._mapchangedListener=null,u._streetsideLaunchedDirectly=!1,u._largeMapOverlayAttribute=r,u._internalNS=Microsoft.Maps.Internal,u._gimme=u._internalNS._Gimme,u._mapsGlobalConfig=Microsoft.Maps.GlobalConfig,f=u._mapOptions&&u._mapOptions.searchQueryCategory,f&&(u._isAttractionOverlay=f.toLowerCase().indexOf("attraction")>-1),sj_evt.bind("TaskDisplayed",function(n){u._onTaskDisplayed(n[1])}),u}return __extends(t,n),t.prototype.bootstrap=function(t,i,r,u){n.prototype.bootstrap.call(this,t,i,r,u);this._initOverlayScenario()},t.prototype._getExploreMoreElement=function(){var t=n.prototype._getExploreMoreElement.call(this);return t?(t.style.display="block",t.parentElement):null},t.prototype._initOverlayScenario=function(){var u=this,i=this._gimme(".mv_lm")[0],r,n,t;i&&(r=this._largerMapLink=i.firstChild,n=this._dynamicMapDiv=document.getElementsByClassName("dynMap")[0],t=document.createElement("div"),t.setAttribute("data-tasklayout",'{ "defaultLayout": "MultiCardLeftLayout", "cardPrimerShown": true }'),t.style.display="block",t.className="Light taskLayoutContainer",n.appendChild(t),n.className=n.className+" MicrosoftMap",n.setAttribute("data-global","{}"),this._largerMapContent=r.firstChild,this._originalNextSibling=n.nextSibling,this._originalParent=n.parentNode,this._originalHeight=n.style.height,this._originalWidth=n.style.width,this.serializableObjectChanged=new this._internalNS._JSEvent,this._mapsGlobalConfig.dynamicProperties.mapOverlayInSerpEnabled=!0,sj_evt.bind("dynMapRendered",function(){var n=u._map.getV8Map().getContainer();n.downloadDependencyAsync("LocalSearchTask");n.downloadDependencyAsync("MapsFeedback")}));this._trackMapPanOrZoom();this._removeGLinkPingLinks()},t.prototype.getContentArea=function(){return document.getElementById("b_content")},t.prototype.getDynamicMapDiv=function(){return this._dynamicMapDiv},t.prototype.serialize=function(){return{}},t.prototype.deserialize=function(){this._mapsGlobalConfig.dynamicProperties.largeMapShownOnSerp&&this._taskManager.getStacks().length===0&&(this._logBackButtonClick(),this._showOrHideLargeMap(!1))},t.prototype.replaceNextHistoryPoint=function(){this._browserHistoryManager&&this._browserHistoryManager.nextHistoryPointReplace()},t.prototype.updateAddressBarPathOnOverlayOpen=function(){this._browserHistoryManager&&this._browserHistoryManager.updateAddressBar("/maps")},t.prototype.updateAddressBarPathOnOverlayClose=function(){this._browserHistoryManager&&this._browserHistoryManager.updateAddressBar("/search")},t.prototype.hasUserChangedMapView=function(){return this.userChangedMapView},t.prototype.getOriginIG=function(){return this._impressionGuids.serpIG},t.prototype.getLargeMapLinkPermalinkState=function(){var n=this._getExploreMoreElement();return n&&this._largeMapOverlayAttribute?n.getAttribute(this._largeMapOverlayAttribute):null},t.prototype.getLargeMapSize=function(){return this._largeMapSize},t.prototype.getPadding=function(){return Microsoft.Maps.GlobalConfig.features.localSearch.doubleWideListEnabled&&this._isAttractionOverlay&&this.padding?{left:758,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}:this.padding},t.prototype.getDetailsCardWidth=function(){return this._detailsCardWidth},t.prototype.getV8Map=function(){return this._map.getV8Map()},t.prototype._trackMapPanOrZoom=function(){var n=this;this.userChangedMapView=!1;this._map&&(this._map.getV8Map().mapPanStarted.addOne(function(){n.userChangedMapView=!0}),this._map.getV8Map().mapZoomStarted.addOne(function(){n.userChangedMapView=!0}))},t.prototype._logBackButtonClick=function(){var n={logData:{feature:"Browser",action:t.Clicked,data:{overlay:InstrumentationBase.getOverlayType(),CN:"BackButton"}}},i=Microsoft.Maps.logger;i.logObject(n.logData)},t.prototype._removeGLinkPingLinks=function(){var t,n,i;Microsoft.Maps.GlobalConfig.features.localSearch.sendMoreInstrumentationForOverlay||(t=_ge("mv_lm"),t&&(n=t.querySelector("[h]"),n&&(i=n.getAttribute("h"),n.removeAttribute("h"),n.setAttribute("data-h",i))))},t.prototype._changeLargeMapLinkVisibility=function(n){var t=this._gimme(".mv_lm")[0];t&&(t.style.display=n?"none":"block",n?this._map.setOptions({supressLargerMapClick:!0}):this._map.setOptions({supressLargerMapClick:this._smallMapState.supressLargeMapClick}))},t.prototype._changeStreetsideImageVisibility=function(n){var t=this._gimme("#dm_street")[0];t&&(t.style.display=n?"none":"block")},t.prototype.setBestMapView=function(n,t){var i,r,o,u,h,c,f,s,l,a;if(!this.userChangedMapView||this._mapOptions.pushpins&&this._mapOptions.pushpins.length>1){if(this._mapOptions.vectorDataPipelineId&&!t){if(this._mapOptions.bestMapViewBasedOnMapEntities){var e=this._mapOptions.bestMapViewBasedOnMapEntities,v=parseFloat(e.nwLatitude),y=parseFloat(e.nwLongitude),p=parseFloat(e.seLatitude),w=parseFloat(e.seLongitude);i=Microsoft.Maps.LocationRect.fromEdges(v,y,p,w)}else i=this._map.getBounds();this._map.getV8Map().setView(this._getUpdatedView(i,n))}else if((this._mapOptions.pushpins&&this._mapOptions.pushpins.length===1||this._mapOptions.scenarioType===3)&&!t){if(this._mapOptions.scenarioType===3){for(o=this._mapOptions.pushpins,u=0,h=o.length;u<h;u++)if(parseInt(o[u].IconStyle)===118){r=o[u];break}}else r=this._mapOptions.pushpins[0];r&&(c=new Microsoft.Maps.Location(r.Location.Latitude,r.Location.Longitude),this._map&&this._map.setView({zoom:16}),this._internalNS.MapHelper.setMapCenter(this._map.getV8Map(),c,undefined,undefined,undefined,undefined,undefined,this.padding,n))}else if(this._mapOptions.pushpins&&this._mapOptions.pushpins.length>1||t){if(!t)for(t={},t.mapBounds=[],f=0;f<this._mapOptions.pushpins.length;f++)s=this._mapOptions.pushpins[f],t.mapBounds[f]=new Microsoft.Maps.Location(s.Location.Latitude,s.Location.Longitude);t.mapBounds?(l=this._map.getV8Map().getMode().getMapViewForLocationsInView(t.mapBounds,this.padding,n),this._map.getV8Map().setView(l)):t.mapCenter&&t.mapZoom&&(a=t.customPadding?t.customPadding:this.padding,this._map.setView({zoom:t.mapZoom}),this._internalNS.MapHelper.setMapCenter(this._map.getV8Map(),t.mapCenter,undefined,null,null,null,undefined,a,n))}}else i=this._map.getBounds(),this._map.getV8Map().setView(this._getUpdatedView(i,n))},t.prototype.changeMapLayoutOnSerp=function(n,t,i){var u=this._gimme,f=document.getElementById("b_header"),e=this._mapsGlobalConfig.features.mapDelay.changeLayoutBeforeTimeout,h,o,c,l,y,a,r,v,s;if(n)h=0,o=0,f&&(e||(u(f).add_class(this._slimHeaderClass),u(f).add_class("bm_oneMap"),u(f).add_class("bm_hideHeader")),document.getElementsByTagName("body")[0].style.minWidth=this._mapsGlobalConfig.features.taskBar.windowMinWidth.toString()+"px",u("#b_content").add_class("v8OverlayMap"),c=document.getElementById("bm_upsellBanner"),l=c?c.clientHeight:0,h=e?o=l:o=f.clientHeight+l,this._showOrHideIdControls(!0),e||this._adjustScope(!0)),this._savedIdentityLoginMode=Identity.headerLoginMode,Identity.headerLoginMode=1,this._largeMapSize=this._getLargeMapSize(o),y=this.getBestMapViewForOverlay(t),this.setBestMapView(this._largeMapSize,y),r=this._dynamicMapDiv,window.scrollTo(0,0),a=this.getContentArea(),a.insertBefore(r,a.firstChild),r.style.top=h+"px",r.style.height="calc(100vh - "+o+"px)",r.style.width="100vw",this._map.getV8Map().getSizeHelper().pollSize(),e?this.adjustOverlayScroll(!0):(document.getElementsByTagName("html")[0].style["overflow-y"]="hidden",document.getElementsByTagName("html")[0].style["overflow-x"]="hidden"),u(r).add_class("noMapTypeBuffer");else{if(r=this._dynamicMapDiv,u(r).remove_class("noMapTypeBuffer"),this._originalNextSibling?this._originalNextSibling.parentNode.insertBefore(r,this._originalNextSibling):this._originalParent.appendChild(r),e||(u(f).remove_class(this._slimHeaderClass),u(f).remove_class("bm_oneMap"),u(f).remove_class("bm_hideHeader")),document.getElementsByTagName("body")[0].removeAttribute("style"),this._showOrHideIdControls(!1),v=u(".id_button",f),v[0].hasAttribute("styles"))for(s=0;s<v.length;s++)u(".id_button",f)[s].removeAttribute("style");u("#b_content").remove_class("v8OverlayMap");e||this._adjustScope(!1);Identity.headerLoginMode=this._savedIdentityLoginMode;i||(f.style.display="block");r.style.top="0px";r.style.height=this._originalHeight;r.style.width=this._originalWidth;this._map.getV8Map().getSizeHelper().pollSize();e?this.adjustOverlayScroll(!1):(document.getElementsByTagName("html")[0].style["overflow-y"]="auto",document.getElementsByTagName("html")[0].style["overflow-x"]="auto")}},t.prototype.adjustOverlayScroll=function(n){var i=this._gimme,t=i(document.getElementById("b_header"));document.getElementsByTagName("html")[0].style["overflow-y"]=n?"hidden":"auto";document.getElementsByTagName("html")[0].style["overflow-x"]=n?"hidden":"auto";n?(t.add_class(this._slimHeaderClass),t.add_class("bm_oneMap")):(t.remove_class(this._slimHeaderClass),t.remove_class("bm_oneMap"))},t.prototype.setDirectStreetsideLaunch=function(){this._streetsideLaunchedDirectly=!0},t.prototype.getBestMapViewForOverlay=function(n){return n&&n.getBestMapView(this._largeMapSize,this.getPadding(),this.getDetailsCardWidth())},t.prototype.attachOrRemoveOverlayCloseButtonHandler=function(n){var i=this,r=this._gimme,t=r(".overlayCloseBtn");n?(this._closeButtonClickHandler||(this._closeButtonClickHandler=function(n){n&&n.preventDefault&&n.preventDefault();var t=r(".streetsideExit");t&&t.length>0&&t[0].click();i._mapsGlobalConfig.dynamicProperties.mapsOverlayClosing=!0;i._removeAllStacks();i._showOrHideLargeMap(!1)}),t.length>0&&t.add_event("click",this._closeButtonClickHandler)):t.length>0&&this._closeButtonClickHandler&&(t.remove_event("click",this._closeButtonClickHandler),this._closeButtonClickHandler=null)},t.prototype._adjustScope=function(n){for(var o,e,i=this._gimme,t=i(".b_scopebar ul li a"),r=-1,u=-1,f=0;f<t.length;f++)o=t[f],e=o.getAttribute("href"),r==-1&&e.indexOf("scope=web")!=-1&&(r=f),u==-1&&(e.indexOf("/maps?")!=-1||e.indexOf("/maps/")!=-1)&&(u=f);r!=-1&&u!=-1&&(n?(i(t[r].parentElement).remove_class("b_active"),i(t[u].parentElement).add_class("b_active")):(i(t[u].parentElement).remove_class("b_active"),i(t[r].parentElement).add_class("b_active")))},t.prototype._saveOrRestoreLargeMapState=function(n){n===0?this._largeMapState={viewportPadding:this._map.getV8Map().getViewportPadding()}:(this._largeMapState&&this._largeMapState.viewportPadding&&this._map.getV8Map().setViewportPadding(this._largeMapState.viewportPadding),this._cityPolygonManager&&this._cityPolygonManager.removeLayer(),this._mapOptions.pushpins&&this._map.entities.setVisible(!1),this._childrenBoundariesLayer&&this._childrenBoundariesLayer.setVisible(!1))},t.prototype._saveOrRestoreSmallMapState=function(n){var t=this;n===0?this._smallMapState={center:this._map.getCenter(),zoom:this._map.getZoom(),viewportPadding:this._map.getV8Map().getViewportPadding(),mapStyleSelectorShown:this._mapOptions.showMapTypeSelector,disableScrollWheelZoom:this._mapOptions.disableScrollWheelZoom,supressLargeMapClick:this._mapOptions.supressLargerMapClick,showDashboard:this._mapOptions.showDashboard,disableZooming:this._mapOptions.disableZooming,disablePanning:this._mapOptions.disablePanning}:Microsoft.Maps.setTimeout(function(){t._map.getV8Map().getFrameManager().frameRendered.addOne(function(){t._smallMapState&&(t._smallMapState.viewportPadding&&t._map.getV8Map().setViewportPadding(t._smallMapState.viewportPadding),t._smallMapState.center&&t._smallMapState.zoom&&t._map.setView({center:t._smallMapState.center,zoom:t._smallMapState.zoom}),t._map.setOptions({showMapTypeSelector:t._smallMapState.mapStyleSelectorShown}))});t._mapOptions.childrenBoundaryNames?t._bootstrapChildrenBoundariesScenario():t._mapOptions.vectorDataPipelineId&&t._bootstrapBoundaryScenario();t._mapOptions.pushpins&&t._map.entities.setVisible(!0);t._mapOptions.showTraffic&&t._trafficManager&&t._trafficManager.show()},100)},t.prototype._enableOrDisableScrollForSafari=function(n){var i=/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor),t;i&&(t=window,t.stopScrolling=t.stopScrolling||function(){t.scrollTo(0,0)},n?window.removeEventListener("scroll",t.stopScrolling):window.addEventListener("scroll",t.stopScrolling))},t.prototype._showOrHideLargeMap=function(n,t,i){var r=this,u;i===void 0&&(i=!0);u=this._internalNS._PerfV2Logger;u&&u.flush();this._isTaskLoadStarted=!1;n?(this._isResultsWithDetailsOverlay=t&&t instanceof BootstrapMapsAnswerForResultsWithDetailsOverlay,u&&u.logStart(u.serpOverlayPltLogKey),Microsoft.Maps.logger.logObject({feature:"OverlayExpansion",T:"CI.ExpandContent",FID:"OverlayExpansion"},_G.IG),this._setOverlayType(!0),this._loadComponentsForSearchPrefetch(function(){Microsoft.Maps.GlobalConfig.dynamicProperties.prefetchingResultsOnSerp=!0;r._showOrHideTasklayoutContainer(!1);r._setOverlayClassOverrides(!0);r._processPermalinkState(t.getPermalinkState(r._impressionGuids.serpIG),i)}),this._loadComponentsForMapsVertical(function(){r._saveOrRestoreLargeMapState(1);var n=r._map.getV8Map().getFrameManager();n.frameRendered.addOne(function(){r._enableOrDisableScrollForSafari(!1);r._showMapTypeSelector();r._changeScrollWheelZoomOption(!0);r._changezorderOfMap(!0);r._showOrHideStaticImage(!0);r._addOrRemoveMapModeChangeListener(!0);r._addOrRemoveMapTypeChangeListener(!0);var n=r.constructor.name==="BootstrapMapsAnswerForTravelOverlay"?"TravelL2":t&&t.getOutingsUpsellCategory(),i=r._showOrHideOutingsUpsell(!0,n);r.changeMapLayoutOnSerp(!0,t);r._changeLargeMapLinkVisibility(!0);r._changeStreetsideImageVisibility(!0);r._changeMapOverlayElementsVisibility(!0);r._turnOnOrOffStreetSideLayer(!0);r._setGlobalStates(!0);i&&r._logUpsellImpression("Shown",{category:n});r._changeNavBarOrientation(!0);r._changeStreetSideOverlayMapMode(!0);r._changeCopyrightOrientation(!0);r._changeMapContainerClassName(!0);r._storeOrRestoreMapType(!0);r._hookUpKeypressListeners();r.updateAddressBarPathOnOverlayOpen();r.serializableObjectChanged.invoke({magnitude:2});r._saveOrRestoreLargeMapState(0);r._showOrHideTasklayoutContainer(!0);Microsoft.Maps.GlobalConfig.dynamicProperties.prefetchingResultsOnSerp=!1;r.attachOrRemoveOverlayCloseButtonHandler(!0);r.attachOrRemoveBrowserPrintMessage(!0);r._logPerfCounters();sj_evt.fire("LargeMapShown",r);InstrumentationBase.SendInstrumentationToServer("",r._overlayPageName)});n.hackHackSetFrame()})):(this._mapsGlobalConfig.features.mapDelay.changeLayoutBeforeTimeout&&this.adjustOverlayScroll(!1),Microsoft.Maps.setTimeout(function(){r._saveOrRestoreSmallMapState(1);r._enableOrDisableScrollForSafari(!0);r._showOrHideOutingsUpsell(!1);r._changeScrollWheelZoomOption(!1);r._changezorderOfMap(!1);r._showOrHideStaticImage(!1);r._addOrRemoveMapModeChangeListener(!1);r._addOrRemoveMapTypeChangeListener(!1);r.changeMapLayoutOnSerp(!1);r._changeLargeMapLinkVisibility(!1);r._changeStreetsideImageVisibility(!1);r._changeMapOverlayElementsVisibility(!1);r._turnOnOrOffStreetSideLayer(!1);r._setGlobalStates(!1);r._setOverlayType(!1);r._setOverlayClassOverrides(!1);r._changeNavBarOrientation(!1);r._changeStreetSideOverlayMapMode(!1);r._changeCopyrightOrientation(!1);r._changeMapContainerClassName(!1);r._storeOrRestoreMapType(!1);r._unHookKeypressListeners();r._trackMapPanOrZoom();r._showOrHideTasklayoutContainer(!1);r.attachOrRemoveOverlayCloseButtonHandler(!1);r.attachOrRemoveBrowserPrintMessage(!1);r.updateAddressBarPathOnOverlayClose();sj_evt.fire("LargeMapHidden",r);r._mapsGlobalConfig.dynamicProperties.mapsOverlayClosing=!1},100))},t.prototype.attachOrRemoveBrowserPrintMessage=function(n){var e=this._gimme,u=e(this.getContentArea()),o=u.getParent(),i,f,r,t;n?(u.add_class("mapOverlayOnSerp"),t=this.createElement("div","MicrosoftMap defaultPrintMessage showPrintErrorMessage"),t.set_attr("data-tag","defaultPrintMessage"),t.set_attr("id","defaultPrintMessage"),i=this.createElement("span","printErrorMessage"),f=this._mapsGlobalConfig.dynamicProperties.defaultPrintMessage,i.set_attr("data-text",f),i.appendText(f),r=this.createElement("img","printErrorImage rms_img"),r.set_attr("data-tag","printErrorImage"),r.set_attr("src",this._mapsGlobalConfig.dynamicProperties.defaultPrintImage),t.append(i),t.append(r),o.insertBefore(t,this.getContentArea())):(u.remove_class("mapOverlayOnSerp"),t=e(o).select(".defaultPrintMessage"),t&&t.length>0&&t.removeFromParent())},t.prototype._showOrHideOutingsUpsell=function(n,t){var u=!1,i,r;return n?t&&!this.isUpsellDismissed()&&(this.createAndInsertUpsellDiv(),this._attachOrRemoveOutingsCloseClickHandler(!0),u=!0):(this._attachOrRemoveOutingsCloseClickHandler(!1),i=this.getContentArea(),r=document.getElementById("bm_upsellBanner"),i&&r&&i.removeChild(r)),u},t.prototype._logUpsellImpression=function(n,t){var i={logData:{feature:"Outings",action:n,data:t}},r=Microsoft.Maps.logger;r.logObject(i.logData)},t.prototype._attachOrRemoveOutingsCloseClickHandler=function(n){var i=this,t=this._gimme,r=t(".bm_outingsClose"),u=t(".b_footer");n?this._outingsUpsellCloseClickHandler||(this._outingsUpsellCloseClickHandler=function(n){n&&n.preventDefault&&n.preventDefault();localStorage.setItem("outingsUpsellDismissed","1");var r=u&&u.length>0?u[0].clientHeight:0;i._adjustIdHeightBaseOnOutingsBanner();t(".bm_outingsBase").set_style({display:"none"});Microsoft.Maps.GlobalConfig.isMapsAnswer?t(i._dynamicMapDiv).set_style({top:"0",height:"100vh"}):t(i._dynamicMapDiv).set_style({top:"0",height:"calc(100vh - "+r+"px)"});i._logUpsellImpression("Click",{item:"Close"})},r.length>0&&r.add_event("click",this._outingsUpsellCloseClickHandler)):r.length>0&&this._outingsUpsellCloseClickHandler&&(r.remove_event("click",this._outingsUpsellCloseClickHandler),this._outingsUpsellCloseClickHandler=null)},t.prototype.isUpsellDismissed=function(){var n=localStorage.getItem("outingsUpsellDismissed");return n&&n==="1"},t.prototype.createElement=function(n,t,i,r,u){var f=this._gimme(document.createElement(n));return t&&f.add_class(t),i&&f.set_attr("role","button"),r&&f.set_attr("target","_blank"),u&&f.set_attr("href",u),f},t.prototype.createAndInsertUpsellDiv=function(){var i=Microsoft.Maps.GlobalConfig.features.localSearch,n=this.createElement("div","bm_outingsBase"),t;n.set_attr("id","bm_upsellBanner");n.append(this.createElement("div","bm_outingsPromo"));n.append(this.createElement("a","bm_outingsWebLink",!0,!0,i.outingsUpsellWebsiteUrl));n.append(this.createElement("a","bm_outingsAppStoreLink",!0,!0,i.outingsUpselliOSUrl).append(this.createElement("div","bm_outingsAppstore")));n.append(this.createElement("a","bm_outingsPlayStoreLink",!0,!0,i.outingsUpsellAndroidUrl).append(this.createElement("div","bm_outingsPlaystore")));n.append(this.createElement("a","bm_outingsCloseLink",!0,!1).append(this.createElement("div","bm_outingsClose")));t=this.getContentArea();t&&t.insertBefore(n[0],t.firstChild)},t.prototype._removeAllStacks=function(){Microsoft.Maps.GlobalDataEventHandler.invokeHandler(Microsoft.Maps.DataHandlerKeys.taskDataHandlerKey,{action:"removeAllStacks"})},t.prototype._adjustIdHeightBaseOnOutingsBanner=function(){var u=this._gimme,e=u(".bm_outingsBase"),t,f,n,i,r;e.length!==0&&(t=e[0].clientHeight,f=u("#b_header"),f.length>0&&(n=u("#id_h",f[0]),n.length>0&&(i=Number(n.get_style("top").substr(0,n.get_style("top").indexOf("px"))),i>=t?(r=i-t,n.set_style({top:r+"px"})):(r=t-i,n.set_style({top:r+"px"})))))},t.prototype._showOrHideIdControls=function(n){var u=this._gimme,e=u("#b_header"),r=u("#id_h",e[0]),t,i,f;r.length>0&&(t=u("#id_l",r[0]),i=u("#id_rh",r[0]),n?(t.length>0&&!t.has_class("hide")&&t.add_class("hide"),i.length>0&&!i.has_class("hide")&&i.add_class("hide"),this._adjustIdHeightBaseOnOutingsBanner()):(t.length>0&&t.has_class("hide")&&t.remove_class("hide"),i.length>0&&i.has_class("hide")&&i.remove_class("hide")),n||(f=r.get_style("top"),f&&f.indexOf("px")>0&&r.set_style({top:"0px"})))},t.prototype._showOrHideTasklayoutContainer=function(n){n?this._gimme(".MicrosoftMap .taskLayoutContainer").remove_class("hideTaskLayout"):this._gimme(".MicrosoftMap .taskLayoutContainer").add_class("hideTaskLayout")},t.prototype._showMapTypeSelector=function(){this._map.setOptions({showMapTypeSelector:!0})},t.prototype._logPerfCounters=function(){var n=this,t=this.getV8Map();this._frameRenderedListener&&this._frameRenderedListener.dispose();this._frameRenderedListener=t.getFrameManager().frameRendered.add(function(){if(n._isTaskLoadStarted){n._frameRenderedListener.dispose();var t=n._internalNS._PerfV2Logger,i=n._internalNS._Helper,r=n._mapOptions.searchQueryCategory,u=i._isHotelsCategory(r)?t.serpOverlayHotelsPltLogKey:i._isRestaurantCategory(r)?t.serpOverlayRestaurantsPltLogKey:i._isHouseCategory(r)?t.serpOverlayRealEstatePltLogKey:i._isAttractionCategory(r)?t.serpOverlayAttractionPltLogKey:typeof BootstrapMapsAnswerForTravelOverlay!="undefined"&&n instanceof BootstrapMapsAnswerForTravelOverlay?t.serpOverlayTravelPltLogKey:"";u&&t.log(u,t.logStartTime(t.serpOverlayPltLogKey));t.log(t.serpOverlayPltLogKey)}})},t.prototype._onTaskDisplayed=function(n){(!this._isResultsWithDetailsOverlay||n.indexOf("DetailsTask")>-1)&&(this._isTaskLoadStarted=!0)},t.prototype._addOrRemoveMapModeChangeListener=function(n){var r=this,u=this._gimme,t,i;this._map&&(t=this._map.getV8Map().mapModeChanged,i=this.getDynamicMapDiv(),n?!this._mapchangedListener&&t&&(this._mapchangedListener=t.add(function(n){if(n&&n.newMode===2&&r._streetsideLaunchedDirectly)u(i).add_class("streetside");else{var t=!(n&&n.newMode===2);r._turnOnOrOffOverlayComponents(t)}})):(this._mapchangedListener&&t&&(u(i).remove_class("streetside"),t.remove(this._mapchangedListener),this._mapchangedListener=null),this._streetsideLaunchedDirectly=!1))},t.prototype._addOrRemoveMapTypeChangeListener=function(n){var i=this,u=this._gimme,t,r;this._map&&(t=this._map.getV8Map().mapTypeChanged,r=this.getDynamicMapDiv(),n?!this._mapTypeChangedListener&&t&&(this._mapTypeChangedListener=t.add(function(n){var t=!(n&&n.newMapTypeId==="be2");i._turnOnOrOffOverlayComponents(t)})):this._mapTypeChangedListener&&t&&(t.remove(this._mapTypeChangedListener),this._mapTypeChangedListener=null))},t.prototype._turnOnOrOffStreetSideLayer=function(n){this._streetSideAutoEntryBehavior&&(n?this._streetSideAutoEntryBehavior.showStreetSideOverlay(this._map.getZoom()):this._streetSideAutoEntryBehavior.hideStreetSideOverlay())},t.prototype._turnOnOrOffOverlayComponents=function(n){var i=n?"block":"none",r=this._gimme,t=r(".overlayCloseBtn ")[0];t&&(t.style.display=i)},t.prototype._getOverlayType=function(){return this._isAttractionOverlay?"attractionOverlay":"mapsOverlay"},t.prototype._setOverlayType=function(n){var t=this._getOverlayType()+"OnSerp";this._mapsGlobalConfig.dynamicProperties[t]=n?{visible:!0,isNearbyScenario:this._mapOptions.scenarioType===3?!0:!1}:{visible:!1,isNearbyScenario:undefined}},t.prototype._updateClassOverrides=function(n,t,i){var f=this._gimme,r=t,h=i?i:r,u=f(".taskBar"),e=f(".taskLayoutContainer"),o=f(".toggleButton"),s=f(".overlayCloseBtn"),a=h+"OnSerp",l=f("#b_notificationContainer"),c=f(this.getDynamicMapDiv());n?(c.add_class(h),u.length>0&&(u[0].classList.add(r),u[0].classList.contains("bm_oneMap")&&u[0].classList.remove("bm_oneMap"),u[0].classList.add("bm_oneMap"),document.getElementsByTagName("body")[0].style.minWidth=this._mapsGlobalConfig.features.taskBar.windowMinWidth.toString()+"px"),e.length>0&&e[0].classList.add(r),o.length>0&&o[0].classList.add(r),s.length>0&&s[0].classList.add(r),l.set_style({display:"none"})):(c.remove_class(h),u.length>0&&(u[0].classList.remove(r),u[0].classList.contains("bm_oneMap")&&u[0].classList.remove("bm_oneMap")),e.length>0&&e[0].classList.remove(r),o.length>0&&o[0].classList.remove(r),s.length>0&&s[0].classList.remove(r))},t.prototype._setOverlayClassOverrides=function(n){this._updateClassOverrides(n,"mapsOverlay")},t.prototype._setGlobalStates=function(n){var i=this._mapsGlobalConfig,r=this._mapOptions,t=i.features;n?(i.isMapsVertical=!0,i.dynamicProperties.largeMapShownOnSerp=!0,i.dynamicProperties.impressionGuid=this._impressionGuids.mapIG,t.traffic.enableCameras=!0,t.traffic.incidentsClickable=!0,r.disableBirdseye=!1,r.disableStreetside=!1,r.disableStreetsideAutoCoverage=!1,t.labels.dynamicLandmarks=!0,t.labels.staticLandmarks=!1,_G.IG=this._impressionGuids.mapIG):(i.isMapsVertical=!1,i.dynamicProperties.largeMapShownOnSerp=!1,t.traffic.enableCameras=!1,t.traffic.incidentsClickable=!1,r.disableBirdseye=!0,r.disableStreetside=!0,r.disableStreetsideAutoCoverage=!0,t.labels.dynamicLandmarks=!1,t.labels.staticLandmarks=!0,_G.IG=this._impressionGuids.serpIG)},t.prototype.getLocalListingTaskState=function(n){var r,t,i;if(n&&n.stacks)for(r=0;r<n.stacks.length;r++)if(t=n.stacks[r].tasks,t)for(i=0;i<t.length;i++)if(t[i].type==="LocalListing")return t[i].state;return n},t.prototype._processPermalinkState=function(n,t){var r,u,i;t===void 0&&(t=!0);r=n&&n[0]&&n[0].data;r&&(u=JSON.parse(r),i=this.getLocalListingTaskState(u),i&&!t&&i.primerPois&&(i.primerPois=null,n[0].data=JSON.stringify(u)));this._permalinkProcessor&&(this._mapsGlobalConfig.dynamicProperties.mapsOverlayProcessingPermalink=!0,this._permalinkProcessor.processSharedStates(n,this._map.getV8Map()),this._mapsGlobalConfig.dynamicProperties.mapsOverlayProcessingPermalink=!1)},t.prototype._changeCopyrightOrientation=function(n){var r=this._gimme(".bottomLeftOverlay")[0],t=this._gimme(".bottomRightOverlay")[0],i=this._gimme(".CopyrightContainer")[0];r&&t&&i&&(n?(t.style.bottom="0px",t.appendChild(i)):r.appendChild(i))},t.prototype._changeNavBarOrientation=function(n){var i=this._gimme,t;n?(this._map.setOptions({showDashboard:!0,disableZooming:!1,disablePanning:!1}),t=this._map.getV8Map().getNavigationBar(),t.setNavigationBarOrientation(0),t.setNavigationBarMode(0),t.setRotateButtonVisible(!1),t.setBirdseyeV2InfoExitControlVisible(!1),i("#MicrosoftNav").remove_class("OnSerp")):(this._map.setOptions({showDashboard:this._smallMapState.showDashboard,disableZooming:this._smallMapState.disableZooming,disablePanning:this._smallMapState.disablePanning}),t=this._map.getV8Map().getNavigationBar(),t.setNavigationBarOrientation(1),t.setNavigationBarMode(2),t.setRotateButtonVisible(!1),t.setBirdseyeV2InfoExitControlVisible(!1),i("#MicrosoftNav").add_class("OnSerp"))},t.prototype._changeMapContainerClassName=function(n){var t=this._gimme(this._dynamicMapDiv)[0];t&&(n?(t.classList.remove("dynMap"),t.classList.add("largeMap")):(t.classList.add("dynMap"),t.classList.remove("largeMap")))},t.prototype._storeOrRestoreMapType=function(n){n?(this._previousMapType=this._map.getV8Map().getMapType(),this._previousMode=this._map.getV8Map().getMode()):(this._map.getV8Map().setMapType(this._previousMapType),this._map.getV8Map().setMode(this._previousMode))},t.prototype._changezorderOfMap=function(n){var t=this._gimme(this._dynamicMapDiv)[0];t&&(t.style["z-index"]=n?1e3:1)},t.prototype._changeScrollWheelZoomOption=function(n){n?this._map.setOptions({disableScrollWheelZoom:!1}):this._map.setOptions({disableScrollWheelZoom:this._smallMapState.disableScrollWheelZoom})},t.prototype._showOrHideStaticImage=function(n){var t=this._gimme("#mv_baseMap")[0];t&&(t.style.display=n?"none":"block")},t.prototype._changeStreetSideOverlayMapMode=function(n){var t=this._map.getV8Map().getMapOptions().streetsideOptions=this._map.getV8Map().getMapOptions().streetsideOptions||{};t.overviewMapMode=n?0:2},t.prototype._getUpdatedView=function(n,t){var i=this._map.getV8Map();return i.getMode().getMapViewForLocationsInView([n.getNorthwest(),n.getSoutheast()],this.padding,t)},t.prototype._getLargeMapSize=function(n){var t=window,i=document,r=i.documentElement,u=i.body,f=t.innerWidth||r.clientWidth||u.clientWidth,e=t.innerHeight||r.clientHeight||u.clientHeight;return{width:f,height:e-n}},t.prototype._loadComponentsForSearchPrefetch=function(n){var i=this,r,t;this._permalinkProcessorAlreadyLoaded?n&&n():(this._permalinkProcessorAlreadyLoaded=!0,r=this._gimme,t=this._map.getV8Map().getContainer(),t.instanceAsync("TaskActivator",function(){t.instanceAsync("Permalink",function(t){i._permalinkProcessor=t;n&&n()})}))},t.prototype._loadComponentsForMapsVertical=function(n){var t=this;if(this._componentsAlreadyLoaded)n&&n();else{this._componentsAlreadyLoaded=!0;var i=this._gimme,f=this._map.getV8Map().getContainer(),r=[{name:"BrowserHistoryManager"},{name:"MapModeStateHistory"},{name:"LayoutManager"},{name:"TaskBar"},{name:"MapsFeedback",args:{footerFeedback:i("#sb_feedback"),corpFeedback:i("#fbpgbt")}},{name:"TaskManager"},{name:"StreetsideAutoEntryBehavior"}],u=this._mapsGlobalConfig.features.transientLens;u&&u.isEnabled&&r.push({name:"TransientLens"});f.instanceAsyncAll(r,function(i){t._streetSideAutoEntryBehavior=i.StreetsideAutoEntryBehavior;t._taskManager=i.TaskManager;t._browserHistoryManager=i.BrowserHistoryManager;var r=i.TaskBar;r&&(t._taskBar=r);i.BrowserHistoryManager.register("BootstrapMapsAnswer",t);r&&t._mapsGlobalConfig.features.autosuggest.focusInSearchBox&&r.setSearchBoxFocus();Microsoft.Maps.setTimeout(function(){return r.initializeAutosuggest()},0);n&&n()})}},t.prototype._hookUpKeypressListeners=function(){var n=this._gimme("#mapsFeedback"),t=this._gimme(".MicrosoftMap .b_logoArea"),i,r;n.length!==0&&t.length!==0&&(i=n[0],r=t[0],this._feedbackBtnListener=function(n){n.keyCode!==9||n.shiftKey||(n.preventDefault(),r.focus())},this._bingLogoListener=function(n){n.keyCode===9&&n.shiftKey&&(n.preventDefault(),i.focus())},n.add_event("keydown",this._feedbackBtnListener),t.add_event("keydown",this._bingLogoListener))},t.prototype._unHookKeypressListeners=function(){var n=this._gimme("#mapsFeedback"),t=this._gimme(".MicrosoftMap .b_logoArea");n.remove_event("keydown",this._feedbackBtnListener);t.remove_event("keydown",this._bingLogoListener)},t.prototype._getSearchQuery=function(n){var t="";return n&&n.length>0?(n.forEach(function(n){if(n.featureType==="taskFramework"){t="";return}(n.featureType==="localSearch"||n.featureType==="localDetails"||n.featureType==="localListing")&&(t=JSON.parse(n.data).query)}),t):""},t.prototype.completeBootstrapping=function(){this._saveOrRestoreSmallMapState(0);n.prototype.completeBootstrapping.call(this)},t.prototype._changeMapOverlayElementsVisibility=function(n){var r=this._gimme,u=n?"block":"none",i=r(".ScaleBar"),t;i&&i.length>0&&(i[0].style.display=u);t=r(".taskBar");t&&t.length>0&&(t[0].style.display=u)},t.Clicked="C",t}(BootstrapMapsAnswer)