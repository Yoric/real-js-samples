(function(){try{(function(){var n={L_AddCollection_Title:"Create a Collection",L_AddToCollection_Title:"Add to My Places",L_Collection_Empty_Message:"To add to your Collection, tap Save from one of your search results.",L_MyPlaces_Title:"My Places",L_MyCollections_BackButton:"My Collections",L_SignIn_Text:"<link>Sign in<\/link> with your Microsoft account to view your Places.",L_AddCollection_Text:"New Collection",L_AddCollection_Description:"Create a new personalized collection",L_AddItinerary_Text:"New Itinerary",L_AddItinerary_Description:"Create a new personalized travel itinerary",L_EditModeDone_Text:"Done",L_EditMode_Text:"Edit",L_CancelButton_Text:"Cancel",L_CreateButton_Text:"Create",SignInAndSaveButton:"Sign in & Save",SignInTip:"<link>Sign in<\/link> to save",TempCollectionTip:"View your temporary collection, or create a new one.",EmptyTempCollectionLine1:"Your temporary collection is empty.",EmptyTempCollectionLine2:"Save places to your temporary collection from your search results on the map. Just tap ",L_CreateCollection_ToolTip:"Create a Collection",L_DeleteCollection_ToolTip:"Delete this Collection",L_DeleteItinerary_ToolTip:"Delete this Itinerary",L_DeleteEntity_ToolTip:"Delete this place",L_EnterEdit_ToolTip:"Edit My Places",L_ExitEdit_ToolTip:"Exit edit mode",L_FailedEntitySave_Text:"There was a problem adding this place to your Collection Try again.",L_NewCollectionDescription_Text:"Description",L_NewCollectionDescription_Watermark:"Example: Places to visit on my trip",L_NewCollectionName_Text:"Name",L_NewCollectionName_Watermark:"Example: My summer trip",L_NewCollectionPrivacy_Text:"Allow sharing",L_CollectionError_Adding_Text:"There was a problem creating the Collection. Try again.",L_CollectionError_Deleting_Text:"There was a problem deleting the Collection or place. Try again.",L_ItineraryError_Deleting_Text:"There was a problem deleting the Itinerary. Please try again.",L_CollectionError_Retrieving_Text:"There was a problem displaying your Collection. Please try again.",L_ItineraryError_Retrieving_Text:"There was a problem displaying your Itineraries. Please try again.",L_CollectionError_Updating_Text:"There was a problem saving your changes to the Collection. Try again.",L_CollectionError_SaveToExisting:"There was a problem saving these places to your collection. Try again.",L_CollectionNameMissing_Text:"Don't forget to name your Collection.",L_DragToolTip_Text:"Drag to reorder",L_CollectionError_ViewShared_Text:"We can't show you this Collection. Check your network connection, or check with the person who shared them to make sure sharing is allowed.",L_DescLengthError_Text:"Try a shorter description. (1000 character maximum)",L_TitleLengthError_Text:"Try a shorter name. (100 character maximum)",L_Collections_MyLocation:"My location",L_FavoriteDirections_Text:"Get Directions",L_RouteAll_Text:"All my places",L_RouteSelectMessage_Text:"Select places and tap Get Directions",L_RouteSelect_Text:"Select places",L_SeeAllButton:"See all in map view",L_CollectionDirectionButton_Text:"Directions",L_CollectionDirectionButton_ToolTip:"Select route all or select destinations",L_CollectionEditButton_ToolTip:"Click to edit the title or description of this collection",L_CollectionShareButton_Text:"Share",L_CollectionShareButton_ToolTip:"Click to share this collection",L_CollectionSaveButton_ToolTip:"Click to save to a collection",L_AddCollectionWhenNone_Text:"Add to your Collections by tapping the New Collection button.",L_DirectionsCancelToolTip_Text:"Cancel selecting a route",L_GetDirectionsToolTip_Text:"Get Directions for the selected places",L_MakePublicFail_Text:"Our system is unable to share this Collection right now. Please try again.",L_MakePublicSuccess_Text:'You changed "{0}" Collection from private to sharing mode.',L_UndoFail_Text:"Our system is unable to undo the change right now. Please try again.",L_Undo_Text:"Undo",L_ShareOnlySpecificCollection_Text:"Unable to share this My Places card. Try sharing a single Collection.",L_CollectionDescriptionEdit_Text:"You can add a description or notes here (1000 character maximum)",L_EnterEditText_ToolTip:"Edit title or description",L_FavoriteTitle_Text:"Favorites",L_HomeFavorite_Text:"Home",L_WorkFavorite_Text:"Work",L_MissingHomeFavorite_Text:"Click or tap to add your Home",L_MissingWorkFavorite_Text:"Click or tap to add your Work",L_CollectionSubTitle_Text:"Collections",L_ItinerariesSubTitle_Text:"Itineraries",L_AddCollectionMessage_Text:"Organize your favorites by creating Collection",L_AddFavoritesMessage_Text:"Your Favorites list is empty. Add a place to your Favorites by pressing Save in a search card",L_SeeLess_Text:"See Less",L_SeeMore_Text:"See More",L_SeeLess_ToolTip:"See Less {0} ",L_SeeMore_ToolTip:"See More {0}",L_FavoriteErrorMessage_Text:"We were unable to retrieve your Favorites from storage",L_HomeEditText_ToolTip:"Open edit dialog for Home",L_WorkEditText_ToolTip:"Open edit dialog for Work",L_AddHome_Text:"Add your Home",L_AddHome_Title:"Home",L_AddWork_Text:"Add your Work",L_AddWork_Title:"Work",L_AddHomeWork_Button:"Add",L_CreateFavoriteError_AlreadyExists:"We were unable to save this place, as it is already in your favorites.",L_EditHome_Text:"Edit your Home",L_EditWork_Text:"Edit your Work",L_AllowLCAStatement_Text:"Checking this box enables you to share this collection via URL.",L_AutoSuggestSearchFailed_Message:'Couldn\'t find "{0}"',L_FailedSaveFavorite_Message:"There was a problem saving this place to your Favorites. Try again.",L_BackToDetails_Text:"Local search details",L_DeleteFavorite_ToolTip:"Remove this Favorite",L_DeleteHome_ToolTip:"Remove this as your Home",L_DeleteWork_ToolTip:"Remove this as your Work",L_EditFavoriteText_ToolTip:"Edit this Favorite",L_EditHomeText_ToolTip:"Edit your Home",L_EditWorkText_ToolTip:"Edit your Work",L_PlaceTitleEditSuggestion_Text:"Give this place a name",L_PlaceAddressEditSuggestion_Text:"Give this place an address",L_PlaceDescriptionEditSuggestion_Text:"Add a note",L_FormatDescription_Text:"{0}: {1}",L_CollectionCount_Text:"{0} items",L_CollectionCountSingle_Text:"{0} item",L_AddressLabel_Text:"Address",L_NoteLabel_Text:"Notes",L_TitleLabel_Text:"Title",L_AddHomeWorkSearch_Button:"Search",L_ShowHomeWorkCheckbox:"Show this place on my map",L_MaxDirectionsItems_Text:"There is a maximum of 25 waypoints allowed.",L_SignInButton_Text:"Sign In",L_PrintNotes_Watermark:"Type your notes here.",L_SharedTemporaryCollection_Title:"Shared Places",L_TemporaryCollectionTitle:"Temporary Collection",L_TemporaryCollectionDescription:"Places saved locally in your browser",L_TemporaryCollectionSignIn:"Sign in for more saving options and to access your collections from anywhere.",L_TemporaryCollectionClearButton:"Clear",L_TemporaryCollectionClearButton_Cardified:"Clear temporary collection",L_TemporaryCollectionSaveButton:"Save",L_TemporaryCollectionRemoveButton:"Delete",L_TemporaryCollectionDeleteConfirmationMessage:"Are you sure you want to delete this place?",L_CollectionsListDeleteConfirmationMessage:"Are you sure you want to permanently delete this collection?",L_ItineraryDeleteConfirmationMessage:"Are you sure you want to permanently delete this itinerary?",L_TemporaryCollectionClearConfirmationMessage:"Are you sure you want to clear all of your places?",L_TemporaryCollectionSaveMessage:"Save this collection to access it from any device in the future. Save to:",L_TemporaryCollectionSaveToNew:"New Collection",L_RemoveEntity_ToolTip:"Remove this place from the temporary collection",L_ContextMenu_ToolTip:"Additional actions on this entity",L_MeasureMapTask_Title:"Measure Distance & Area",L_MeasureMapTask_InitialInstructions:"Click or tap on the map to create a new point. Tap and drag an existing point to move it. Right-click (or tap and hold) on a point to remove it.",L_MeasureMapTask_PerimeterFormat:"Distance: {primary} ({secondary})",L_MeasureMapTask_AreaFormat:"Area: {primary} ({secondary})",L_MeasureMapTask_NewLink_Text:"Reset",L_MeasureMapTask_DoneLink_Text:"Done",L_MeasureMapTask_EditLink_Text:"Edit",L_MeasureMapTask_AreaLink_Text:"Close shape",L_MeasureMapTask_NewLink_Title:"Clear any current shape and start over",L_MeasureMapTask_DoneLink_Title:"Finish editing the current shape and leave on map",L_MeasureMapTask_EditLink_Title:"Continue editing the current shape",L_MeasureMapTask_AreaLink_Title:"Convert current shape to a polygon and display its contained area",L_MeasureMapTask_DistanceUnitKm_Text:"km",L_MeasureMapTask_DistanceUnitMeter_Text:"m",L_MeasureMapTask_DistanceUnitMile_Text:"mi",L_MeasureMapTask_DistanceUnitFoot_Text:"ft",L_MeasureMapTask_AreaUnitKm_Text:"sq km",L_MeasureMapTask_AreaUnitMeter_Text:"sq m",L_MeasureMapTask_AreaUnitMile_Text:"sq mi",L_MeasureMapTask_AreaUnitFoot_Text:"sq ft",L_MeasureMapTask_ValueUnitFormat:"{value} {unit}",L_Migration_In_Progress_Message:"Server Maintenance, please try again in a few minutes",L_User_Migrated_Message:"Server Maintenance, please refresh your browser and try again",L_Max_Collections_Message:"You have reached the limit of {0} collections in your account. In order to create a new collection, you must delete one or more existing collections.",L_Max_Entities_Message:"You have reached the limit of {0} places in this collection. In order to add a new place to this collection, you must delete one or more existing places.",L_EditSaveButton:"Save",L_NicknameTitle:"Nickname",L_DescriptionTitle:"Description",L_CollectionPrivateMessage:"Make this collection public.",L_CollectionPublicMessage:"Make this collection private.",L_CollectionMadePrivateMessage:"This collection is now private and cannot be shared with others.",L_CollectionMadePublicMessage:"This collection can now be shared with others.",L_AddCollectionPrivateMessage:"This Collection cannot be shared. Tap lock icon to make collection shareable.",L_AddCollectionPublicMessage:"You can share this collection with others. Tap lock icon to make collection private.",L_UpcomingEventsName:"Upcoming Events",L_UpcomingEventEntity_TimeLabelFormat:"{date} @ {time}",L_SeeMoreEventsLink:"See more upcoming events",L_SeeLessEventsLink:"See less upcoming events",L_FlightToText:"Flight to {0}",L_EmptyItinerariesMessage:"Make the most of every day - save Bing itineraries you like, or customize them and make them your own.",L_EmptyItinerariesSearchLink1:'Search to get started (e.g. "',L_EmptyItinerariesSearchLink2:"Seattle itineraries",L_EmptyItinerariesSearchLink3:'").',L_CreateNewItinerary:"Create a new itinerary",SaveOnSerp_ConfirmationLink:"<link>View My Places<\/link>"};window.$MicrosoftMaps8.ResourceManager?window.$MicrosoftMaps8.ResourceManager.init("Collections",n):window.$MicrosoftMaps8.ResourcesObject=n})(),function(){var n={Attribution:"Data from:",GettyImageAttribution:"© {0} Getty Images",TravelGuide:"{0} Travel Guide",ItinTitleSingular:"{0} Itinerary {1} Day",ItinTitlePlural:"{0} Itinerary {1} Days",DayHeader:"Day {0}",DaySingular:"{0} day",DayPlural:"{0} days",AddDay:"Add day",Discover:"Discover",AttractSingular:"{0} attraction",AttractPlural:"{0} attractions",BackToList:"return to list",ItineraryShare_ToolTip:"Click to share this itinerary",ItineraryDrag_ToolTip:"Drag to reorder",PrintNotesWaterMark:"Type your route notes here",PrintDay:"Day {0}",DeleteDay:"Delete this day",NicknameTitle:"Nickname",DescriptionTitle:"Description",CancelButton_Text:"Cancel",EditSaveButton:"Save",EditButton_ToolTip:"Edit Name",SaveButton_ToolTip:"Save",ShareButton_ToolTip:"Share",DeleteButton_ToolTip:"Remove",ContextMenuButton_ToolTip:"More",NewItineraryDescription_Watermark:"Example: Summer escape to Paris",Add_Attractions:"Find attractions",Attractions_Query:"{0} attractions",Restaurants_Query:"{0} restaurants",Hotels_Query:"{0} hotels",AddToDay_ToolTip:"{0} has been added to day {1} of your <link>itinerary<\/link>",AddToDayOfItinerary_ToolTip:"{0} has been added to day {1} of <link>{2}<\/link>",DeleteDay_ToolTip:"A day has been removed from your itinerary",AddDay_ToolTip:"Day {0} has been added to your itinerary",DeleteItem_ToolTip:"{0} has been removed from your itinerary.",MoveToDay_ToolTip:"{0} has been moved to day {1}",OperationFailed_ToolTip:"Operation Failed",ItinerarySaved_ToolTip:"All edits you make will be automatically saved to My Places.",SaveItinerary_ToolTip_Line1:"Save a copy - keep your edits",SaveItinerary_ToolTip_Line2:"Save a copy of this itinerary to view your edits later.",SavedCopyName:"{0} - copy",L_SignInRequiredItinerary:"<link>Sign in<\/link> to save a copy",EmptyRecommendationsMessage:"No recommendations are available for this destination. ",EmptyRecommendationsMessageLink1:"Search for ",AttractionsSuggestionLink:"attractions",EmptyRecommendationsMessageLink2:", ",RestaurantsSuggestionLink:"restaurants",EmptyRecommendationsMessageLink3:", ",HotelsSuggestionLink:"hotels",EmptyRecommendationsMessageLink4:" and more to find places to add to your itinerary.",EmptyDayMessage:" directly from the search results or the map to save to your itinerary.",EmptyDaySuggestionLink1:"In addition to ",EmptyDaySuggestionLink2:"attractions",EmptyDaySuggestionLink3:", you can find ",EmptyDaySuggestionLink4:"restaurants",EmptyDaySuggestionLink5:", ",EmptyDaySuggestionLink6:"hotels",EmptyDaySuggestionLink7:", and more to add to your itinerary by searching on the map.",L_DeleteDayConfirmationMessage:"Are you sure you want to permanently delete this day?",L_ConfirmDeleteDayButton:"Delete",L_CancelDeleteDayButton:"Cancel",New_Itinerary_Title:"New Itinerary",New_Itinerary_Title_One_Destination:"{0} Itinerary",New_Itinerary_Title_Multiple_Destinations:"{0} - {1} Itinerary",Destinations_Title:"Where do you want to go?",Destinations_WaterMark:"City, State, National Park, etc.",Travel_Dates_CheckBox:"I know my dates",Add_Location:"Add location",Get_Started:"Get Started",Trip_Summary:"Trip summary",Destinations_Summary:"{0} (+{1})",Separator:" · ",Add_Dates_Hint:"Know your dates?",Edit_Destinations:"Edit",Directions_Not_Available:"Directions not available"};window.$MicrosoftMaps8.ResourceManager?window.$MicrosoftMaps8.ResourceManager.init("Travel",n):window.$MicrosoftMaps8.ResourcesObject=n}();var r=window.$MicrosoftMaps8,f=r.Internal,lt=f.TaskData=f.TaskData||{},e=r.CloudGraphDataManager=r.CloudGraphDataManager||{},wi=r.Anchor,bi=r.CommonControls.AutosuggestV2,ki=r.CommonControls.AutosuggestViewModel,di=f.BaseTask,gi=f.BaseTaskViewModel,nr=r.BitmapImageTemplate,at=r.BasicTemplate,tr=lt.CollectionActions,ir=r.CommonControls.CollectionsAutosuggestDataModel,n=r.GlobalConfig.features.collections,rr=r.CollectionsTaskPoiManager,ur=r.Constants,fr=f.ControlTemplate,ti=r.DataHandlerKeys,u=r.Internal._Debug,er=lt.DistanceUnit,ii=f._EntryPoints,or=f.GeolocationProvider,tt=f._Gimme,rt=r.GlobalConfig,ri=r.GlobalDataEventHandler,sr=r.ImageFromCssHelper,g=f._JSEvent,p=f._Helper,vt=f._LatLonCrs,ht=f._LocalStorageCache,hr=r.LocationRect,cr=f._LoggerConstants,lr=f.MapHelper,ar=r.MapLayer,k=r.Location,ut=r.MapMath,vr=r.MapTypeId,yr=r.MapView,ui=f._Network,pr=f._Observable,v=f._ObservableCollection,nt=f._ObservableObject,wr=f._ObservableObjectChangedArgs,br=f._OverlayEntity,kr=r.GlobalConfig.features.print,dr=f.PrintContent,gr=f.PrintManager,it=r.ResourceManager.Collections,fi=r.SignInState,ei=r.SimplePointPrimitive,nu=r.TabControlRequester,oi=r.TaskTypes,tu=f.TransientLensActions,si=lt.TravelAttractionEntity,hi=r.GlobalConfig.features.travel,ci=f.UserTipControl,iu=r.VectorMapLayer,ru=lt.Waypoint,uu=r.ZoomLevel,li='<div class="{Binding ShowSaveButton Converter=saveRootClass}" data-tag="saveRoot">    <div class="auxillaryButtons" style:display="{Binding ShowSaveButton Converter=boolToDisplay}">        <a class="saveButton" data-tag="saveButton" event:click="onSaveClick" href="#">            <span class="saveButtonIcon"><\/span>        <\/a>    <\/div>    <div class="saveDropdown popOutTop" style:display="{Binding ShowDropdown Converter=boolToDisplay}" style:top="{Binding TopPosition}" style:left="{Binding LeftPosition}">        <div class="popOutInner" data-tag="popOutInner">            <a class="saveEntry dropdownEntry" data-tag="saveEntry" event:click="onFavoritesClick" href="#" style:display="{Binding signInState.IsSignedIn Converter=boolToDisplay}">                <span class="saveButton saveIcon"><\/span>                <TextBlock Text="{Binding resources.L_FavoriteTitle_Text}" />            <\/a>            <div class="transientLensSeparator" style:display="{Binding signInState.IsSignedIn Converter=boolToDisplay}"><\/div>            <ItemsControl ItemsSource="{Binding Itineraries}">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <a class="saveEntry dropdownEntry" data-tag="saveEntry" data-entityid="{Binding collectionId}" event:click="onItineraryClick" href="#">                            <span class="saveButton saveIcon"><\/span>                            <TextBlock Text="{Binding Name}" />                        <\/a>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>            <div class="transientLensSeparator" style:display="{Binding signInState.IsSignedIn Converter=boolToDisplay}"><\/div>            <a class="saveEntry dropdownEntry" data-tag="saveEntry" event:click="onTemporaryCollectionClick" href="#">                <span class="saveButton saveIcon"><\/span>                <TextBlock Text="{Binding resources.L_TemporaryCollectionTitle}" />            <\/a>            <ItemsControl ItemsSource="{Binding Collections}">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <a class="saveEntry dropdownEntry" data-tag="saveEntry" data-entityid="{Binding id}" event:click="onCollectionClick" href="#">                            <span class="saveButton saveIcon"><\/span>                            <TextBlock Text="{Binding name}" />                        <\/a>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/div>    <\/div><\/div>',l=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),a=function(n){function r(t,r){var u=n.call(this)||this;return u.primitives=new v,u._privates.defineProperty("itemCount"),u.id=t,u.name=r,u.disposed=new g,u.eTag="0",u.dateCreated=i.convertJavascriptDateToDateInTicks(new Date),u.dateModified=u.dateCreated,u.dateAccessed=u.dateCreated,u.primitives.changed.add(function(){u.setItemCount(u.primitives.length)}),u}return l(r,n),r.deserialize=function(n,t){var i,o,e,u,f;if(t)return r.deserializeCgCollection(n);if(n&&n.id&&n.name&&(i=new r(n.id,n.name),i.description=n.description,i.isPublic=n.isPublic,n.primitives))for(o=n.primitives.length,e=0;e<o;e++){u=n.primitives[e];switch(u.geometryType){case 1:f=b.deserialize(u);break;case 2:f=st.deserialize(u);i.containsPolyshapes=!0;break;case 3:f=ot.deserialize(u);i.containsPolyshapes=!0}f&&i.primitives.insert(f)}return i},r.deserializeCgCollection=function(n){var t,e,f,i,u;if(n&&n.CollectionId&&(n.Name||n.CollectionId===r.upcomingEventsId)&&(t=new r(n.CollectionId,n.Name||it.L_UpcomingEventsName),t.description=n.Description,t.isPublic=n.CanShare,t.eTag=n.ETag,t.dateAccessed=n.DateAccessed,t.dateCreated=n.DateCreated,t.dateModified=n.DateModified,t.setItemCount(n.ItemsCount),n.Items))for(e=n.Items.length,t.setItemCount(e),f=0;f<e;f++){if(i=n.Items[f],i.Geometry)switch(i.Geometry.$type){case"GeometryPoint":u=b.deserialize(i,!0);break;case"GeometryLine":u=st.deserialize(i,!0);t.containsPolyshapes=!0;break;case"GeometryPolygon":u=ot.deserialize(i,!0);t.containsPolyshapes=!0}else u=b.deserialize(i,!0);u&&t.primitives.insert(u)}return t},r.serialize=function(n,i){var u,s,o,f,e;if(i)return r.serializeCgCollection(n);if(n&&(u={},u[t.id]=n.id,u[t.nameField]=n.name,u[t.description]=n.description,u[t.isPublic]=n.isPublic,u[t.primitives]=[],n.primitives))for(s=n.primitives.length,o=0;o<s;o++){f=n.primitives[o];switch(f[t.geometryType]){case 1:e=b.serialize(f);break;case 2:e=st.serialize(f);break;case 3:e=ot.serialize(f)}e&&u[t.primitives].push(e)}return u},r.serializeCgCollection=function(n){var r,o,s,e,u,f;if(n){if(o=i.convertJavascriptDateToDateInTicks(new Date),r={$type:"GeoAnnotationsCollection",Name:n.name,Description:n.description,CanShare:n.isPublic,Items:[],AlwaysShowPOI:!0,CopyAllowed:!0,DisplayOrder:1,DateCreated:n.dateCreated,DateModified:o,DateAccessed:o},n.id&&(r.CollectionId=n.id),n.primitives)for(s=n.primitives.length,e=0;e<s;e++){u=n.primitives[e];switch(u[t.geometryType]){case 1:f=b.serialize(u,!0);break;case 2:f=st.serialize(u,!0);break;case 3:f=ot.serialize(u,!0)}f&&r.Items.push(f)}r.ItemsCount=r.Items.length}return r},r.prototype.copy=function(){var n=new r(this.id,this.name);return n.description=this.description,n.isPublic=this.isPublic,n.primitives=new v,n},r.localCollectionId="0",r.upcomingEventsId="default.user.upcomingevents",r}(nt),bt=function(){function n(){this.collections=new v}return n.deserialize=function(t,i){var u,e,r,f;if(t)for(u=new n,e=t.length,r=0;r<e;r++)f=a.deserialize(t[r],i),f&&u.collections.insert(f);return u},n.serialize=function(n,t){var r=[],u,i;if(n&&n.collections)for(u=n.collections.length,i=0;i<u;i++)r[i]=a.serialize(n.collections[i],t);return r},n.getAllCollectionNamesAndIds=function(n){var i=[],r,t,u;if(n&&n.collections)for(r=n.collections.length,t=0;t<r;t++)u={name:n.collections[t].name,id:n.collections[t].id},i[t]=u;return i},n}(),ct=function(t){function i(){var n=t.call(this)||this;return n.geometryType=1,n.crs=vt.instance,n}return l(i,t),i.prototype.dispose=function(){this.entity.dispose();this.entity=null;this.geometry=null;this.crs=null},i.prototype.getGeometry=function(){return this.geometry},i.prototype.setGeometry=function(n){this.geometry=n;this.entity&&this.entity.setGeometry(n)},i.prototype.getArea=function(){return 0},i.prototype.getLength=function(){return 0},i.prototype.createPointFromSimplePoint=function(n){return this.entity=new yt,this.entity.createFavoriteFromCollectionEntity(n.entity),this.setGeometry(n.getGeometry()),this.geometry!==null},i.prototype.createPointFromPlace=function(n){return this.entity=new yt,this.entity.createFavoriteFromPlace(n),this.geometry=this.entity.getGeometry(),this.geometry!==null},i.prototype.isTapEnabled=function(){return n.simplePointTapEnabled},i}(nt),yt=function(n){function t(){var t=this,i={};return t=n.call(this,i)||this,i.defineProperty("name",function(n,i){t._onNameChanged(n,i)}),i.defineProperty("originalName",function(n,i){t._onOriginalNameChanged(n,i)}),i.defineProperty("description",function(n,i){t._onDescriptionChanged(n,i)}),i.defineProperty("address",function(n,i){t._onAddressChanged(n,i)}),i.defineProperty("phone",function(n,i){t._onAddressChanged(n,i)}),i.defineProperty("businesslistingid",function(n,i){t._onBusinesslistingidChanged(n,i)}),i.defineProperty("photoUrl",function(n,i){t._onPhotoUrlChanged(n,i)}),i.defineProperty("url",function(n,i){t._onUrlChanged(n,i)}),i.defineProperty("geometry",function(n,i){t._onGeometryChanged(n,i)}),i.defineProperty("isHomeOrWork",function(n,i){t._onIsHomeOrWorkChanged(n,i)}),i.defineProperty("showOnMap",function(n,i){t._onShowOnMapChanged(n,i)}),i.defineProperty("iconText"),i.defineProperty("iconSource"),t.id="",t._place=null,t.setIsHomeOrWork(""),t}return l(t,n),t.prototype.dispose=function(){n.prototype.dispose.call(this);this._place=null},t.prototype.getTitle=function(){switch(this.getIsHomeOrWork()){case"home":return it.L_HomeFavorite_Text;case"work":return it.L_WorkFavorite_Text;default:return this.getName()}},t.prototype.getPlace=function(){return this._place},t.prototype.getPlaceId=function(){return this._place?this._place.Id:(this._isBusiness=this._checkIsBusiness(this.getBusinesslistingid()),this.getBusinesslistingid()&&this.getBusinesslistingid()!=="0"?this.getBusinesslistingid().replace("ypid:","").replace("sid:",""):this.getGeometry()&&this.getGeometry().y+"_"+this.getGeometry().x)},t.prototype.createFavoriteFromCollectionEntity=function(n){n&&(this.setName(n.name),this.setAddress(n.address),this.setDescription(n.description),this.setBusinesslistingid(n.businesslistingid),this.setPhotoUrl(n.photoUrl))},t.prototype.ToCollectionEntity=function(){var t={name:this.getName(),description:this.getDescription(),address:this.getAddress(),photoUrl:this.getPhotoUrl()},u=this.getGeometry(),r,n;return u&&(t.routableLocation=t.labelLocation=new k(u.y,u.x)),n=this.getBusinesslistingid(),n&&(n.indexOf("ypid:")!==-1||n.indexOf("sid:")!==-1?r=n:n!=="0"&&(i.hasSearchId(n)?r="ypid:"+n:n.split("_").length!==2&&(r="sid:"+n)),r&&(t.businesslistingid=n)),t},t.prototype.createFavoriteFromPlace=function(n){if(n&&(n.Geometry||n.DisplayCoordinates)){if(n.Id&&(this.id=n.Id),n.Name&&this.setName(n.Name.Value),n.OriginalName&&this.setOriginalName(n.OriginalName.Value),!this.getName()&&this.getOriginalName()&&this.setName(this.getOriginalName()),n.Description&&this.setDescription(n.Description.Value),n.Address&&n.Address.AddressSingleLine&&this.setAddress(n.Address.AddressSingleLine.Value),n.Phone&&this.setPhone(n.Phone.Value),n.BingEntityId){var t=i.addIdPrefix(n.BingEntityId.Value);this.setBusinesslistingid(t)}n.BusinessType&&(this.categoryId=n.BusinessType.Value);n.ImageUri&&this.setPhotoUrl(n.ImageUri.Value);n.Url&&this.setUrl(n.Url.Value);n.ShowOnMap?this.setShowOnMap(n.ShowOnMap.Value):this.setShowOnMap(!0);n.Geometry?n.Geometry.Longitude&&n.Geometry.Latitude&&this.setGeometry({x:n.Geometry.Longitude.Value,y:n.Geometry.Latitude.Value,bounds:[n.Geometry.Latitude.Value,n.Geometry.Longitude.Value,n.Geometry.Latitude.Value,n.Geometry.Longitude.Value]}):n.DisplayCoordinates&&n.DisplayCoordinates.Longitude&&n.DisplayCoordinates.Latitude&&this.setGeometry({x:n.DisplayCoordinates.Longitude.Value,y:n.DisplayCoordinates.Latitude.Value,bounds:[n.DisplayCoordinates.Latitude.Value,n.DisplayCoordinates.Longitude.Value,n.DisplayCoordinates.Latitude.Value,n.DisplayCoordinates.Longitude.Value]});this._place=n}},t.prototype.createPlaceFromFavorite=function(){var t,n,i;return this._place||(t=this.getPlaceId(),n=graph.Me.Preferences.Favorites.Collections.Default.CreatePlace(t),n.Id&&(this.id=n.Id),this.getName()&&(n.Name=graph.CreateText(this.getName())),i=this.getOriginalName()?this.getOriginalName():this.getName(),i&&(n.OriginalName=graph.CreateText(i)),this.getDescription()&&(n.Description=graph.CreateText(this.getDescription())),this.getAddress()&&(n.Address=graph.CreateTyped(graph.Entities.PostalAddress,t),n.Address.AddressSingleLine=graph.CreateText(this.getAddress())),this.getPhone()&&(n.Phone=graph.CreateText(this.getPhone())),t&&(n.BingEntityId=graph.CreateText(t)),this._isBusiness&&(n.IsBusiness=graph.Create(!0)),this.categoryId&&(n.BusinessType=graph.CreateText(this.categoryId)),this.getPhotoUrl()&&(n.ImageUri=graph.CreateText(this.getPhotoUrl())),this.getUrl()&&(n.Url=graph.CreateText(this.getUrl())),this.getGeometry()&&(n.DisplayCoordinates=graph.CreateGeometryPoint(this.getGeometry().y,this.getGeometry().x)),this._place=n),this._place},t.prototype.removePlace=function(){if(this._place){var n=this._place;this._place=null;graph.Me.Preferences.Favorites.Collections.Default.Members.Remove(n);n.Delete()}},t.prototype._onNameChanged=function(n,t){var i=this;this.name=this.getTitle();this._updatePlaceFields(function(n){n&&(i._place.Name=graph.CreateText(t))})},t.prototype._onOriginalNameChanged=function(n,t){var i=this;this._updatePlaceFields(function(n){n&&(i._place.OriginalName=graph.CreateText(t))})},t.prototype._onDescriptionChanged=function(n,t){var i=this;this._updatePlaceFields(function(n){n&&(i._place.Description=graph.CreateText(t))})},t.prototype._onAddressChanged=function(n,t){var i=this;this._updatePlaceFields(function(n){n&&(i._place.Address||(i._place.Address=graph.CreateTyped(graph.Entities.PostalAddress,i._place.BingEntityId.Value)),i._place.Address.AddressSingleLine=graph.CreateText(t))})},t.prototype._onPhoneChanged=function(n,t){var i=this;this._updatePlaceFields(function(n){n&&(i._place.Phone=graph.CreateText(t))})},t.prototype._onBusinesslistingidChanged=function(n,t){var i=this;this._updatePlaceFields(function(n){n&&(i._isBusiness=i._checkIsBusiness(t),i._isBusiness&&(i._place.IsBusiness=graph.Create(!0)),i._place.BingEntityId=graph.CreateText(t.replace("ypid:","").replace("sid:","")))})},t.prototype._onPhotoUrlChanged=function(n,t){var i=this;this._updatePlaceFields(function(n){n&&(i._place.ImageUri=graph.CreateText(t))})},t.prototype._onUrlChanged=function(n,t){var i=this;this._updatePlaceFields(function(n){n&&(i._place.Url=graph.CreateText(t))})},t.prototype._onGeometryChanged=function(n,t){var i=this;this._updatePlaceFields(function(n){n&&(i._place.Geometry=graph.CreateGeometryPoint(t.y,t.x),i._place.DisplayCoordinates=graph.CreateGeometryPoint(t.y,t.x))})},t.prototype._onIsHomeOrWorkChanged=function(n,t){this.name=this.getTitle();this.homeOrWork=t},t.prototype._onShowOnMapChanged=function(n,t){var i=this;this._updatePlaceFields(function(n){n&&(i._place.ShowOnMap=graph.Create(t))})},t.prototype._updatePlaceFields=function(n){if(this._place&&graph){var t=function(t){n(t===200);ft.ensureGraphCommit()};u.getFunctionalTestHooksEnabled()?t(200):ft.ensureGraphCommit(t);return}n(!1)},t.prototype._checkIsBusiness=function(n){return n&&(n.indexOf("ypid:")!==-1||i.hasSearchId(n)&&n.indexOf("sid:")===-1)},t}(nt),i=function(){function n(){}return n.logAction=function(n,i){var r={logData:{feature:t.logFeatureName,action:n,data:i},impressionGuid:rt.dynamicProperties.mapsIG};ri.invokeHandler(ti.instrumentationDataHandlerKey,r)},n.perfLog=function(n,t){return n?n.start("CX_"+t):null},n._getLocations=function(n){var r,t,i;return n&&(t=n,t.rings&&t.rings.length>0?r={x:t.rings[0].x,y:t.rings[0].y}:(i=n,i.x&&i.y&&(r={x:i.x,y:i.y}))),r},n.calculateLength=function(t){var u=0,i,f,r;if(t&&(i=n._getLocations(t),i&&i.x.length>=2))for(f=i.x.length,r=0;r<f-1;r++)u+=n._greatCircleDistance(i.y[r],i.x[r],i.y[r+1],i.x[r+1]);return u},n.calculateArea=function(t){var l=0,i,r;if(t&&(i=n._getLocations(t),i&&i.x.length>=3)){var u=n.getMedianCentroid(t),o=n._getUnitSpherePoint(u[0],u[1]),a=n._getTangentPlaneBasis(o),v=a[0],y=a[1],s=0,p=0,h=n._greatCircleDistance(u[0],u[1],i.y[p],i.x[p])/ut.earthRadiusMajorAxis,c,f=n._getProjectedCoordinates(o,v,y,i.y[0],i.x[0]),e;if(f.length===0)return-1;var b=h,k=f,w=i.x.length;for(r=1;r<w;r++){if(c=n._greatCircleDistance(u[0],u[1],i.y[r],i.x[r])/ut.earthRadiusMajorAxis,e=n._getProjectedCoordinates(o,v,y,i.y[r],i.x[r]),e.length===0)return-1;s=s+n._signedExcess(n._triangleExcess(i.y[r-1],i.x[r-1],i.y[r],i.x[r],h,c),f,e);f=e;h=c}l=Math.abs(s)*ut.earthRadiusMajorAxis*ut.earthRadiusMajorAxis}return l},n.getMedianCentroid=function(t){var i=[0,0],r=n._getLocations(t);return r&&r.x.length>=3&&(i[0]=(t.bounds[0]+t.bounds[2])/2,i[1]=(t.bounds[1]+t.bounds[3])/2),i},n.hasSearchId=function(t){var i=(t||"").toLowerCase(),r=i.match(n.ypidRegex);return r&&r.length>0||i.indexOf("sid")!==-1||i.indexOf("eventId")!==-1},n.hasSatoriId=function(t){var i=(t||"").toLowerCase(),r=i.match(n.sidRegex);return r&&r.length>0||i.indexOf("sid")!==-1},n.hasEventId=function(t){var i=(t||"").toLowerCase(),r=i.match(n.eventIdRegex)||i.match(n.sidRegex);return r&&r.length>0||i.indexOf("eventId")!==-1},n.addIdPrefix=function(t){return n.hasSatoriId(t)?t.indexOf("sid:")===-1&&(t="sid:"+t):n.hasEventId(t)?t.indexOf("eventId:")===-1&&(t="eventId:"+t):n.hasSearchId(t)&&t.indexOf("ypid:")===-1&&(t="ypid:"+t),t},n.convertDashesToStrokeDashStyle=function(n){for(var i="",t=0;t<n.length;t++)i+=n[t],t<n.length-1&&(i+=",");return i},n.convertStrokeDashStyleToDashes=function(t){var i,r,u,f;if(!t)return n.solidDashStyle;switch(t.toUpperCase()){case"SOLID":i=n.solidDashStyle;break;case"SHORTDASH":i=n.shortDashStyle;break;case"SHORTDOT":i=n.shortDotStyle;break;case"SHORTDASHDOT":i=n.shortDashDotStyle;break;case"SHORTDASHDOTDOT":i=n.shortDashDotDotStyle;break;case"DOT":i=n.dotStyle;break;case"DASH":i=n.dashStyle;break;case"LONGDASH":i=n.longDashStyle;break;case"DASHDOT":i=n.dashDotStyle;break;case"LONGDASHDOT":i=n.longDashDotStyle;break;case"LONGDASHDOTDOT":i=n.longDashDotDotStyle;break;default:if(r=t.split(","),r.length===1||r.length===0||r.length%2!=0)i=n.solidDashStyle;else{for(i=[],u=0;u<r.length;u++)f=parseInt(r[u]),isNaN(f)||i.push(f);i.length===0&&(i=n.solidDashStyle)}}return i},n.convertLineWidthToStrokeWeight=function(n){return n+"px"},n.convertStrokeWeightToLineWidth=function(n){if(!n)return 1;var i,t;return n.indexOf("px")!==-1?(t=parseInt(n.substr(0,n.length-2)),i=t):n.indexOf("em")!==-1?(t=parseFloat(n.substr(0,n.length-2)),i=8*t):n.indexOf("en")!==-1?(t=parseFloat(n.substr(0,n.length-2)),i=6*t):n.indexOf("pt")!==-1?(t=parseFloat(n.substr(0,n.length-2)),i=2*t):n.indexOf("%")!==-1?(t=parseFloat(n.substr(0,n.length-1)),i=1):(t=parseInt(n),i=t),i},n.convertDateInTicksToJavascriptDate=function(t){var i=(new Date).getTimezoneOffset()*6e4;return new Date(t/1e4-n.epochDiff+i)},n.convertJavascriptDateToDateInTicks=function(t){var i=(new Date).getTimezoneOffset()*6e4;return(t.getTime()+n.epochDiff-i)*1e4},n._greatCircleDistance=function(n,t,i,r){return ut.greatCircleDistance(new k(n,t),new k(i,r))},n._getUnitSpherePoint=function(n,t){var i=[0,0,0],r=Math.PI/180;return i[0]=Math.cos(n*r),i[1]=i[0]*Math.sin(t*r),i[0]=i[0]*Math.cos(t*r),i[2]=Math.sin(n*r),i},n._getTangentPlaneBasis=function(n){var t=[0,0,0],u=[0,0,0],e=[t,u],r=0,i=1,f;return Math.abs(n[2])>Math.abs(n[0])?(r=2,Math.abs(n[0])>Math.abs(n[1])&&(i=0)):Math.abs(n[2])>Math.abs(n[1])&&(i=2),f=Math.sqrt(n[r]*n[r]+n[i]*n[i]),t[r]=-n[i]/f,t[i]=n[r]/f,u[0]=n[1]*t[2]-n[2]*t[1],u[1]=n[2]*t[0]-n[0]*t[2],u[2]=n[0]*t[1]-n[1]*t[0],e},n._getProjectedCoordinates=function(t,i,r,u,f){var o=[],e=n._getUnitSpherePoint(u,f),s=e[0]*t[0]+e[1]*t[1]+e[2]*t[2];return s>0&&(e[0]=e[0]-t[0],e[1]=e[1]-t[1],e[2]=e[2]-t[2],o[0]=(e[0]*i[0]+e[1]*i[1]+e[2]*i[2])/s,o[1]=(e[0]*r[0]+e[1]*r[1]+e[2]*r[2])/s),o},n._triangleExcess=function(t,i,r,u,f,e){var s=n._greatCircleDistance(t,i,r,u)/ut.earthRadiusMajorAxis,o=(f+e+s)/2;return o=Math.tan(o/2)*Math.tan((o-f)/2)*Math.tan((o-e)/2)*Math.tan((o-s)/2),o>0?(o=Math.sqrt(o),o=4*Math.atan(o)):o=0,o},n._signedExcess=function(n,t,i){return t[0]*i[1]-i[0]*t[1]>0?n:-n},n.ypidRegex="yn\\d+x[A-Z,a-z,0-9]+",n.eventIdRegex="f\\d{9}",n.sidRegex="^[A-Z,a-z,0-9]{8}-[A-Z,a-z,0-9]{4}-[A-Z,a-z,0-9]{4}-[A-Z,a-z,0-9]{4}-[A-Z,a-z,0-9]{12}",n.solidDashStyle=[0],n.shortDashStyle=[6,2],n.shortDotStyle=[2,2],n.shortDashDotStyle=[6,2,2,2],n.shortDashDotDotStyle=[6,2,2,2,2,2],n.dotStyle=[2,6],n.dashStyle=[10,6],n.longDashStyle=[20,6],n.dashDotStyle=[10,6,2,6],n.longDashDotStyle=[20,6,2,6],n.longDashDotDotStyle=[20,6,2,6,2,6],n.epochDiff=621355968e5,n}(),o=function(){function t(){}return t.makeCgRetrieveAllCollectionsMetadataRequest=function(i,r){var e={RequestType:1,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion},f=null;u.getFunctionalTestHooksEnabled()&&(f=n.retrieveAllCollectionsBag);t._makeCgRequest(i,r,e,f)},t.makeCgRetrieveAllCollectionsRequest=function(i,r){var u={RequestType:2,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion};t._makeCgRequest(i,r,u)},t.makeCgRetrieveCollectionRequest=function(i,r,f,e){var s={RequestType:3,CollectionId:i,ClientETag:r,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion},o=null;u.getFunctionalTestHooksEnabled()&&(o=n.retrieveCollectionBag);t._makeCgRequest(f,e,s,o)},t.makeCgRetrieveUpcomingEventsRequest=function(r,f){var s=i.convertJavascriptDateToDateInTicks(new Date),o={RequestType:3,CollectionId:a.upcomingEventsId,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion},e;n.showOldEvents||(o.EventTimeRangeFilterUTC={StartTime:s});e=null;u.getFunctionalTestHooksEnabled()&&(e=n.retrieveCollectionBag);t._makeCgRequest(r,f,o,e,n.testUser)},t.makeCgRetrieveSharedCollectionRequest=function(i,r,f,e,o){var h={RequestType:10,CollectionId:i,ClientETag:r,ExternalUserId:f,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion},s=null;u.getFunctionalTestHooksEnabled()&&(s=n.retrieveCollectionBag);t._makeCgRequest(e,o,h,s)},t.makeCgCreateCollectionRequest=function(i,r,f){var o={RequestType:5,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:i.eTag,CollectionToBeWritten:a.serialize(i,!0)},e=null;u.getFunctionalTestHooksEnabled()&&(e=n.insertCollectionBag);t._makeCgRequest(r,f,o,e)},t.makeCgUpdateCollectionRequest=function(i,r,f){var o={RequestType:5,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:i.eTag,CollectionId:i.id,CollectionToBeWritten:a.serialize(i,!0)},e=null;u.getFunctionalTestHooksEnabled()&&(e=n.updateCollectionBag);t._makeCgRequest(r,f,o,e)},t.makeCgUpdateCollectionMetadataRequest=function(i,r,f){var o=a.serialize(i,!0),s,e;o.Items=null;s={RequestType:6,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:i.eTag,CollectionId:i.id,MetaToBeWritten:o};e=null;u.getFunctionalTestHooksEnabled()&&(e=n.updateCollectionMetaBag);t._makeCgRequest(r,f,s,e)},t.makeCgAddPrimitiveRequest=function(i,r,f,e,o){var s,h,c;if(r){switch(r.geometryType){case 1:s=b.serialize(r,!0);break;case 2:s=st.serialize(r,!0);break;case 3:s=ot.serialize(r,!0);break;default:e&&e(1);return}h={RequestType:4,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:i.eTag,CollectionId:i.id,ItemToBeWritten:s};c=null;u.getFunctionalTestHooksEnabled()&&(c=n.insertItemBag);o&&(h.ItemId=r.entity.id);t._makeCgRequest(f,e,h,c)}},t.makeCgDeleteCollectionRequest=function(i,r,f){var o={RequestType:7,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:i.eTag,CollectionId:i.id},e=null;u.getFunctionalTestHooksEnabled()&&(e=n.deleteCollectionBag);t._makeCgRequest(r,f,o,e)},t.makeCgDeletePrimitiveRequest=function(i,r,f,e){var s={RequestType:8,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:r.eTag,CollectionId:r.id,ItemId:i},o=null;u.getFunctionalTestHooksEnabled()&&(o=n.deleteItemBag);t._makeCgRequest(f,e,s,o)},t._getMarket=function(){return rt.dynamicProperties.market},t._makeCgRequest=function(t,r,u,f,e){function c(n){t&&t(tt.Internals.parseJSON(n))}function l(n,t,f){r&&(n&&n!==" "&&!!t?(t===404&&f.indexOf("No Collection found for the user")!==-1||i.logAction(h.pdpRequestFailure,{status:t,statusText:f,reqType:u.RequestType,colId:u.CollectionId}),r(1,tt.Internals.parseJSON(n),t)):t===304?r(0,null):(i.logAction(h.pdpRequestFailure,{status:t,statusText:f,reqType:u.RequestType,colId:u.CollectionId}),r(1,null)))}var o=n.cgApiUrl,s;f&&(o=f);e&&(s={"Test-User-AuthToken":e});ui.doPost(o,tt.Internals.stringify(u),{onError:l,onSuccess:c,headers:s})},t}(),ft=function(){function t(i){if(this._invalidIndex=-1,this._collectionAlreadyLogged=!1,this._myPlacesAlreadyLogged=!1,this._favoritesAlreadyLogged=!1,t.instance&&!i)return t.instance;this.favoritesLoaded=new g;this.favoritePrimitivesChanged=new g;this.homeOrWorkChanged=new g;this.favoritesFailedToLoad=new g;this.upcomingEventsSet=new g;this.collectionAdded=new g;this._favoritesSynced=!1;graph&&(graph.Settings._useSSL=window.location.protocol==="https:",graph.Settings._useProd=n.clientGraphUseProd)}return t.prototype.doesMyPlacesExist=function(){return!!this._myPlaces},t.prototype.findCollectionById=function(n){var r=null,u,t,i;if(n&&this._myPlaces)for(u=this._myPlaces.collections.length,t=0;t<u;t++)if(i=this._myPlaces.collections[t],i.id.toLowerCase()===n.toLowerCase()){r=i;break}return r},t.ensureGraphCommit=function(n){var t,i=0;t=function(r){i++;r!==200?i<=4?graph.Sync(t):n(r):n&&n(r)};u.getFunctionalTestHooksEnabled()||graph.Sync(t)},t.prototype.syncFavorites=function(r){var f=this,e;graph&&(e=function(n){var s,u,l,c;if(n===200){var a=graph.Me.Preferences.Favorites.GetPreferredPlace(graph.Entities.FavoritesCategoryHome),y=graph.Me.Preferences.Favorites.GetPreferredPlace(graph.Entities.FavoritesCategoryWork),p=graph.Me.Preferences.Favorites.Collections.Default.Members,e,o;for(f.favorites=new v,s=p.Count-1;s>=0;s--)if(u=p.GetAt(s),u.IsEntity&&u.Type===graph.Entities.Place){if(a===u&&!e){e=new ct;e.createPointFromPlace(a)&&(f.home=e,f.home.entity.setIsHomeOrWork("home"));continue}if(y===u&&!o){o=new ct;o.createPointFromPlace(y)&&(f.work=o,f.work.entity.setIsHomeOrWork("work"));continue}l=new ct;c=u;(c.Geometry||c.DisplayCoordinates)&&l.createPointFromPlace(c)&&f.favorites.insert(l)}f.favoriteErrorCode=0;f.favoritesLoaded.invoke();f._favoritesAlreadyLogged||(i.logAction(h.itemCounts,{FAV:f.favorites.length}),f._favoritesAlreadyLogged=!0);f.favoritePrimitivesChanged.invoke();f._favoritesSynced=!0;r(0);t.ensureGraphCommit()}else f.favoriteErrorCode=9,f.favoritesFailedToLoad.invoke(),r(9)},u.getFunctionalTestHooksEnabled()?(!n.returnMockFavorites||this.favorites&&this.favorites.length||this._fillGraphWithMockFavorites(),e(200)):this._favoritesSynced?(r(0),t.ensureGraphCommit()):t.ensureGraphCommit(e))},t.prototype.setHome=function(n,r){var f=this,e,o;graph&&(e=function(n,t){if(t===0||t===10&&n!==f.work){var i=n.entity.getPlace();graph.Me.Preferences.Favorites.SetPreferredPlace(graph.Entities.FavoritesCategoryHome,i);f.favorites.indexOf(n)!==-1&&f.favorites.remove(n);f.home&&f.favorites.indexOf(f.home)===-1&&f.home.entity.removePlace();f.home=n;f.home.entity.setIsHomeOrWork("home");f.homeOrWorkChanged.invoke();f.favoritePrimitivesChanged.invoke();r(n,0)}else r(null,t)},n.entity.getPlace()===null?this.createFavorite(n,e):(o=function(r){r===200?(e(n,0),i.logAction(h.favorites,{SHM:"True"}),t.ensureGraphCommit()):(i.logAction(h.favorites,{SHM:"False",ERR:r}),e(n,9))},u.getFunctionalTestHooksEnabled()?o(200):t.ensureGraphCommit(o)))},t.prototype.setWork=function(n,r){var f=this,e,o;graph&&(e=function(n,t){if(t===0||t===10&&n!==f.home){var i=n.entity.getPlace();graph.Me.Preferences.Favorites.SetPreferredPlace(graph.Entities.FavoritesCategoryWork,i);f.favorites.indexOf(n)!==-1&&f.favorites.remove(n);f.work&&f.favorites.indexOf(f.work)===-1&&f.work.entity.removePlace();f.work=n;f.work.entity.setIsHomeOrWork("work");f.homeOrWorkChanged.invoke();f.favoritePrimitivesChanged.invoke();r(n,0)}else r(null,t)},n.entity.getPlace()===null?this.createFavorite(n,e):(o=function(r){r===200?(e(n,0),i.logAction(h.favorites,{SWK:"True"}),t.ensureGraphCommit()):(i.logAction(h.favorites,{SWK:"False",ERR:r}),e(n,9))},u.getFunctionalTestHooksEnabled()?o(200):t.ensureGraphCommit(o)))},t.prototype.createFavorite=function(n,r){var f=this,e;graph&&n&&n.entity&&(e=function(u){var e,s,o,c;u===200?(e=n.entity.getPlaceId(),s=f.getExistingFavorite(e),s!==null?r(s,12):(o=f.favorites.length,f.home&&o++,f.work&&o++,o>=t._maxFavorites?r(null,4):(e=i.addIdPrefix(e),n.entity.setBusinesslistingid(e),f.favorites.indexOf(n)===-1&&(f.favorites.insert(n,0),f.favoritePrimitivesChanged.invoke()),c=n.entity.createPlaceFromFavorite(),r(n,0),i.logAction(h.favorites,{CFA:"True"}),t.ensureGraphCommit()))):(i.logAction(h.favorites,{CFA:"False",ERR:u}),r(null,9))},u.getFunctionalTestHooksEnabled()?e(200):t.ensureGraphCommit(e))},t.prototype.removeFavorite=function(n,r){var f=this,e;graph&&(e=function(u){u===200?(f.home===n&&(f.home=null,graph.Me.Preferences.Favorites.GetPreferredPlace(graph.Entities.FavoritesCategoryHome).Delete(),f.homeOrWorkChanged.invoke()),f.work===n&&(f.work=null,graph.Me.Preferences.Favorites.GetPreferredPlace(graph.Entities.FavoritesCategoryWork).Delete(),f.homeOrWorkChanged.invoke()),n.entity.removePlace(),f.favorites.remove(n),f.favoritePrimitivesChanged.invoke(),r(0),i.logAction(h.favorites,{DEL:"True"}),t.ensureGraphCommit()):(i.logAction(h.favorites,{DEL:"False",ERR:u}),r(9))},u.getFunctionalTestHooksEnabled()?e(200):t.ensureGraphCommit(e))},t.prototype.isExistingFavorite=function(n){return this.getExistingFavorite(n)?!0:!1},t.prototype.getExistingFavorite=function(n){if(this.home&&this.home.entity.id.indexOf(n)!==-1)return this.home;if(this.work&&this.work.entity.id.indexOf(n)!==-1)return this.work;if(this.favorites)for(var t=0;t<this.favorites.length;t++)if(this.favorites[t]&&this.favorites[t].entity.id.indexOf(n)!==-1)return this.favorites[t];return null},t.prototype.retrieveAllCollectionsMetaData=function(n){var t=this;this._myPlaces?n&&n(this._myPlaces,0):o.makeCgRetrieveAllCollectionsMetadataRequest(function(i){return t._handleCollectionsServiceRetrieveAllResponse(i,n)},function(i,r,u){r===null||r.CollectionsMetaMap?n&&n(null,i?9:0):t._handleCollectionsServiceRetrieveAllResponse(r,n,u)});this.home&&this.work&&this.favorites?this.favoritesLoaded.invoke():this.syncFavorites(function(){})},t.prototype.retrieveAllCollections=function(n){var t=this;o.makeCgRetrieveAllCollectionsRequest(function(i){return t._handleCollectionsServiceRetrieveAllResponse(i,n)},function(i,r,u){r===null||r.CollectionsMap?n&&n(null,i?9:0):t._handleCollectionsServiceRetrieveAllResponse(r,n,u)})},t.prototype.retrieveCollection=function(n,t,i){var f=this,r,u,e,s;!n&&t?t(null,7):(r=this._getCollectionIndexFromCache(n),u=null,r!==this._invalidIndex&&this._myPlaces.collections[r].primitivesRetrieved&&(u=this._myPlaces.collections[r].eTag),e=function(n){return f._handleSingleCollectionResponse(n,t,r,!0)},s=function(n,i){i===null||i.CollectionsMap?n===0?t&&t(f._myPlaces.collections[r],0):t&&t(null,n?9:0):f._handleSingleCollectionResponse(i,t,r,!0)},i?o.makeCgRetrieveSharedCollectionRequest(n,u,i,e,s):o.makeCgRetrieveCollectionRequest(n,u,e,s))},t.prototype.retrieveUpcomingEvents=function(n){var t=this,i=function(i){var r=function(i,r){r===0&&(t._sortEvents(i),t.upcomingEvents=i,t.upcomingEventsSet.invoke());n(i,r)};return t._handleSingleCollectionResponse(i,r,-1,!0)},r=function(i,r){r===null||r.CollectionsMap||t._handleSingleCollectionResponse(r,n,-1,!0)};o.makeCgRetrieveUpcomingEventsRequest(i,r)},t.prototype.createCollection=function(i,r){var u=this,f;!i&&r?r(null,7):(f=this._getCollectionIndexFromCache(i.id),this._myPlaces&&this._myPlaces.collections.length>=t._getMaxAllowedCollections()?r&&r(null,2):f===this._invalidIndex?o.makeCgCreateCollectionRequest(i,function(t){u._myPlaces||(u._myPlaces=new bt);u._myPlaces.collections&&u._myPlaces.collections.insert(i,0);i.id=t.CollectionId;i.eTag=t.ServerETag;i.primitivesRetrieved=!0;i.externalUserId=t.ExternalUserId;n.enableMostRecentlyUsedList&&et.instance.pushCollection(i);r(i,0)},function(n){r&&r(null,n?9:0)}):r&&r(null,8))},t.prototype.deleteCollection=function(n,t){var i,r;!n&&t?t(7):(i=this._getCollectionIndexFromCache(n),i!==this._invalidIndex?(r=this._myPlaces.collections[i],this._myPlaces.collections.removeAt(i),o.makeCgDeleteCollectionRequest(r,function(){r.disposed.invoke();t(0)},function(n){t&&t(n?9:0)})):t&&t(5))},t.prototype.updateCollection=function(n,t){var r=this,i;!n&&t?t(null,7):(i=this._getCollectionIndexFromCache(n.id),n.primitivesRetrieved?o.makeCgUpdateCollectionRequest(n,function(n){return r._handleUpdateCollectionResponse(n,t,i)},function(n){t&&t(null,n?9:0)}):n.primitives.length?this.retrieveCollection(n.id,function(u,f){if(f===0){for(var e=0;e<u.primitives.length;e++)n.primitives.insert(u.primitives[e]);o.makeCgUpdateCollectionRequest(n,function(u){return r._handleUpdateCollectionResponse(u,t,i,n)},function(n){t&&t(null,n?9:0)})}else t&&t(null,f)}):o.makeCgUpdateCollectionMetadataRequest(n,function(n){return r._handleUpdateCollectionResponse(n,t,i)},function(n){t&&t(null,n?9:0)}))},t.prototype.updateCollectionMeta=function(n,t){var r=this,i;!n&&t?t(null,7):(i=this._getCollectionIndexFromCache(n.id),o.makeCgUpdateCollectionMetadataRequest(n,function(n){return r._handleUpdateCollectionResponse(n,t,i)},function(n){t&&t(null,n?9:0)}))},t.prototype.addPrimitive=function(i,r,u){var c=this,e,f,h;u&&(i?r?(e=this._getCollectionIndexFromCache(i),e===this._invalidIndex?u(null,5):r.entity&&r.entity.id!==s.localEntityId?u(null,10):(f=this._myPlaces.collections[e],h=this._checkIfRequestShouldBeDone(f,r),f.primitivesRetrieved&&f.primitives.length>=t._getMaxAllowedCollectionEntites()||f.getItemCount()>=t._getMaxAllowedCollectionEntites()?u(null,3):h?o.makeCgAddPrimitiveRequest(f,r,function(t){r.entity.id=t.ItemId;f.primitives.insert(r,0);t.ServerETag&&(f.eTag=t.ServerETag);c._filterOutPolylinesAndPolygons(f,!1);n.enableMostRecentlyUsedList&&et.instance.pushCollection(f);u&&u(f,0,t.ItemId)},function(n){u(null,n===0?0:9)}):u(f,12))):u(null,10):u(null,7))},t.prototype.deletePrimitive=function(n,t,i){var u,f,r;i&&(n?t?(u=this._getPrimitiveIndexFromCollection(n,t),u!==this._invalidIndex?(f=this._getCollectionIndexFromCache(n),r=this._myPlaces.collections[f],o.makeCgDeletePrimitiveRequest(t,r,function(n){r.primitives.removeAt(u);r.primitives.changed.invoke();n.ServerETag&&(r.eTag=n.ServerETag);i(0)},function(){i(9)})):i(11)):i(10):i(7))},t.prototype.updatePrimitive=function(n,t,i){if(i)if(n)if(t){var r=this._getPrimitiveIndexFromCollection(n.id,t.entity.id);r===this._invalidIndex?i(11):o.makeCgAddPrimitiveRequest(n,t,function(t){t.ServerETag&&(n.eTag=t.ServerETag);i&&i(0)},function(n){i(n===0?0:9)},!0)}else i(10);else i(7)},t.prototype._handleCollectionsServiceRetrieveAllResponse=function(n,t,r){var u=new bt,f=n.RequestType===1?n.CollectionsMetaMap:n.CollectionsMap,o,s,e;if(f){for(o in f)f.hasOwnProperty(o)&&(s=f[o],e=a.deserialize(s,!0),e&&(e.externalUserId=n.ExternalUserId,u.collections.insert(e)));this._myPlaces=u;this._myPlacesAlreadyLogged||(i.logAction(h.itemCounts,{COL:u.collections.length}),this._myPlacesAlreadyLogged=!0);t&&t(this._myPlaces,0)}else n&&r===404?(this._myPlaces=u,t&&t(this._myPlaces,0)):t&&t(this._myPlaces,9)},t.prototype._handleSingleCollectionResponse=function(n,t,i,r,u){var e=n.CollectionsMap,c=this._myPlaces&&this._myPlaces.collections[i],o=c&&e[c.id],s,f,h;if(!o)for(s in e)if(e.hasOwnProperty(s)){o=e[s];break}if(f=a.deserialize(o,!0),!f){t&&t(null,5);return}f.externalUserId=n.ExternalUserId;h=9;f&&(i!==this._invalidIndex&&(this._myPlaces.collections[i]=f,this._myPlaces.collections[i].primitivesRetrieved=!u,this._myPlaces.collections.changed.invoke()),this._filterOutPolylinesAndPolygons(f,r),h=0);t&&t(f,h)},t.prototype._handleUpdateCollectionResponse=function(n,t,i,r){var u=this._myPlaces.collections[i];r&&(u.primitives=r.primitives);n.ServerETag&&(u.eTag=n.ServerETag);t&&t(u,0)},t.prototype._checkIfRequestShouldBeDone=function(n,t){for(var r,u=!0,f=t.entity,i=0;i<n.primitives.length;i++)if(r=n.primitives[i].entity,r.businesslistingid&&f.businesslistingid&&r.businesslistingid===f.businesslistingid){u=!1;break}return u},t.prototype._getCollectionIndexFromCache=function(n){var i=this._invalidIndex,r,t,u;if(n&&this._myPlaces)for(r=this._myPlaces.collections.length,t=0;t<r;t++)if(u=this._myPlaces.collections[t],u.id.toLowerCase()===n.toLowerCase()){i=t;break}return i},t.prototype._getPrimitiveIndexFromCollection=function(n,t){var u=this._getCollectionIndexFromCache(n),f=this._invalidIndex,r,e,i,o;if(u!==this._invalidIndex)for(r=this._myPlaces.collections[u],e=r.primitives.length,i=0;i<e;i++)if(o=r.primitives[i],o.entity.id.toLowerCase()===t.toLowerCase()){f=i;break}return f},t.prototype._filterOutPolylinesAndPolygons=function(t){var r;if(t&&t.primitives){var f=0,u=t.primitives,e=u.length;for(r=u.length-1;r>=0;r--)u[r].geometryType!==1&&(f++,n.enablePolyshapes||u.removeAt(r));n.enablePolyshapes||(t.containsPolyshapes=!1);this._collectionAlreadyLogged||(i.logAction(h.itemCounts,{PRI:e,DRG:f}),this._collectionAlreadyLogged=!0);i.logAction(h.privacySharingState,{PUB:t.isPublic})}},t.prototype._sortEvents=function(n){for(var u,f,r,t=n.primitives,i=1;i<t.length;i++)if(u=t[i],f=u.entity.startDate,!(f.valueOf()>t[i-1].entity.startDate.valueOf())){for(t.removeAt(i),r=i-2,r;r>=0;r--)if(f.valueOf()>t[r].entity.startDate.valueOf())break;t.insert(u,r+1)}},t._getMaxAllowedCollections=function(){return n.maxAllowedCollections},t._getMaxAllowedCollectionEntites=function(){return n.maxAllowedCollectionEntities},t.prototype._fillGraphWithMockFavorites=function(){var n="47.603569_-122.329498",i=graph.Me.Preferences.Favorites.Collections.Default.CreatePlace(n),t,r,f,e,u;i.Name=graph.CreateText("Seattle");i.OriginalName=graph.CreateText("Seattle");i.Address=graph.CreateTyped(graph.Entities.PostalAddress,n);i.Address.AddressSingleLine=graph.CreateText("Seattle, WA");i.BingEntityId=graph.CreateText("5fbba6b8-85e1-4d41-9444-d9055436e473");i.Description=graph.CreateText("My Home City");i.DisplayCoordinates=graph.CreateGeometryPoint(47.603569,-122.329498);graph.Me.Preferences.Favorites.SetPreferredPlace(graph.Entities.FavoritesCategoryHome,i);n="47.61492538452_-122.1939697265625";t=graph.Me.Preferences.Favorites.Collections.Default.CreatePlace(n);t.Name=graph.CreateText("Microsoft CCP");t.OriginalName=graph.CreateText("Microsoft Bravern");t.Address=graph.CreateTyped(graph.Entities.PostalAddress,n);t.Address.AddressSingleLine=graph.CreateText("500 108th Ave Ne Ste 1810, Bellevue, WA 98004");t.BingEntityId=graph.CreateText(n);t.Description=graph.CreateText("On the 9th floor");t.DisplayCoordinates=graph.CreateGeometryPoint(47.614925384521484,-122.1939697265625);graph.Me.Preferences.Favorites.SetPreferredPlace(graph.Entities.FavoritesCategoryWork,t);n="YN926x15799544";r=graph.Me.Preferences.Favorites.Collections.Default.CreatePlace(n);r.Name=graph.CreateText("Portage Bay Cafe");r.OriginalName=graph.CreateText("Portage Bay Cafe");r.Description=graph.CreateText("My favorite sea food place");r.Address=graph.CreateTyped(graph.Entities.PostalAddress,n);r.Address.AddressSingleLine=graph.CreateText("4130 Roosevelt Way Ne, Seattle, WA, United States");r.BingEntityId=graph.CreateText(n);r.DisplayCoordinates=graph.CreateGeometryPoint(47.657768,-122.317802);n="YN873x112609011";f=graph.Me.Preferences.Favorites.Collections.Default.CreatePlace(n);f.Name=graph.CreateText("Space Needle");f.OriginalName=graph.CreateText("Space Needle");f.Address=graph.CreateTyped(graph.Entities.PostalAddress,n);f.Address.AddressSingleLine=graph.CreateText("400 Broad Street, Seattle, WA, United States");f.BingEntityId=graph.CreateText(n);f.DisplayCoordinates=graph.CreateGeometryPoint(47.620491,-122.349297);n="YN926x15812295";e=graph.Me.Preferences.Favorites.Collections.Default.CreatePlace(n);e.Name=graph.CreateText("Cafe Flora");e.OriginalName=graph.CreateText("Cafe Flora");e.Address=graph.CreateTyped(graph.Entities.PostalAddress,n);e.Address.AddressSingleLine=graph.CreateText("2901 E Madison St, Seattle, WA 98112");e.BingEntityId=graph.CreateText(n);e.DisplayCoordinates=graph.CreateGeometryPoint(47.624046,-122.295097);n="47.640049_-122.129797";u=graph.Me.Preferences.Favorites.Collections.Default.CreatePlace(n);u.Name=graph.CreateText("Microsoft Main Campus");u.OriginalName=graph.CreateText("Microsoft Main Campus");u.Description=graph.CreateText("Microsoft Home office");u.Address=graph.CreateTyped(graph.Entities.PostalAddress,n);u.Address.AddressSingleLine=graph.CreateText("1 Microsoft Way, Redmond, WA");u.BingEntityId=graph.CreateText(n);u.DisplayCoordinates=graph.CreateGeometryPoint(47.640049,-122.129797)},t._maxFavorites=300,t.instance=new t,t}(),y=function(){function n(){}return n.convertTravelItineraryToItineraryCollection=function(t){var f,i,s,e,r,h,u,c,o;if(!t)return null;if(f=t.Days?t.Days.length:0,i={$type:"ItineraryCollection",Name:t.Name,CollectionId:t.CollectionId,Description:t.Description,ItineraryDays:f||t.DayCount,Properties:{ItineraryDays:f||t.DayCount},InterestTypes:t.InterestTypes,Url:t.SeeAllPoisUrl,Image:t.Image&&t.Image.Url,ETag:t.ETag,ItineraryMetaETag:t.ItineraryMetaETag,CanShare:!0,Items:[]},t.gettyID&&(i.Properties.GettyId=t.gettyID,i.Properties.Photographer=t.photographer),t.startDate&&(i.Properties.StartDate=""+t.startDate),t.endDate&&(i.Properties.EndDate=""+t.endDate),t.Destinations&&t.Destinations.length){for(s=[],e=0;e<t.Destinations.length;e++)s.push(n.convertTravelItemToPlace(t.Destinations[e]));i.Properties.Destinations=tt.Internals.stringify(s)}for(r=0;r<f;r++)for(h=t.Days[r],u=0;u<h.length;u++)c=h[u],o=n.convertTravelItemToPlace(c),o.ItineraryInformation.DayIndex=r+1,o.DisplayOrder=u,i.Items.push(o);return i.ItemsCount=i.Items.length,i},n.convertTravelItemToPlace=function(n){var u={$type:"GeometryPoint",Latitude:n.Lat,Longitude:n.Lon},f={InterestTypes:n.InterestTypes,StayDurationInMinutes:n.StayDurationInMinutes,TimeToNextInSeconds:n.TimeToNext,KmToNext:n.KmToNext,ModeToNext:n.ModeToNext,DayIndex:n.DayIndex+1},t={$type:"Place",RoutableCoordinates:u,DisplayCoordinates:u,Geometry:u,ShowOnMap:!0,Name:n.Name,OriginalName:n.OriginalName||n.Name,Description:n.Description,Image:n.Image&&n.Image.Url,ItineraryInformation:f,ItemId:n.CloudGraphId,DisplayOrder:n.ItemIndex,BusinessType:n.CategoryId},r;return n.EntityTypes&&n.EntityTypes.length&&(t.EntityType=n.EntityTypes[0]),r=n.Id,i.hasSatoriId(r)?(t.EntityIdType="SatoriID",t.EntityId=r):i.hasSearchId(r)&&(t.EntityIdType="YPID",t.EntityId=r),t},n.convertItineraryCollectionToTravelItinerary=function(t){var s,i,f,h,c,e,l,v,o,u,r;if(!t)return null;if(s=t.ItineraryDays||t.Properties.ItineraryDays,i={Image:{Url:t.Image},InterestTypes:t.InterestTypes,Name:t.Name,CollectionId:t.CollectionId,SeeAllPoisUrl:t.Url,Description:t.Description,ETag:t.ETag,ItineraryMetaETag:t.ItineraryMetaETag,GuideUrl:"",DayCount:s,AttractionCount:t.ItemsCount,Days:[]},t.Properties.GettyId&&(i.gettyID=t.Properties.GettyId,i.photographer=t.Properties.Photographer),t.Properties.StartDate&&(i.startDate=parseInt(t.Properties.StartDate)),t.Properties.EndDate&&(i.endDate=parseInt(t.Properties.EndDate)),f=t.Properties.Destinations,f&&f.length){for(h=tt.Internals.parseJSON(f),c=[],e=0;e<h.length;e++)c.push(n.convertPlaceToTravelItem(h[e]));i.Destinations=c}for(l=0;l<s;l++)i.Days.push([]);for(v=t.Items?t.Items.length:0,o=0;o<v;o++){for(var y=t.Items[o],a=n.convertPlaceToTravelItem(y),p=y.ItineraryInformation.DayIndex-1;p>=i.Days.length;)i.Days.push([]);if(u=i.Days[p],u){for(r=0;r<a.ItemIndex;)if(u[r]&&u[r].ItemIndex<a.ItemIndex)r++;else break;u.splice(r,0,a)}}return i},n.convertPlaceToTravelItem=function(n){var t=n.Geometry,i={Name:n.Name,OriginalName:n.OriginalName||n.Name,Description:n.Description,Id:n.EntityId,Lat:t&&t.Latitude,Lon:t&&t.Longitude,Image:{Url:n.Image},InterestTypes:n.ItineraryInformation.InterestTypes,StayDurationInMinutes:n.ItineraryInformation.StayDurationInMinutes,TimeToNext:n.ItineraryInformation.TimeToNextInSeconds,KmToNext:n.ItineraryInformation.KmToNext,ModeToNext:n.ItineraryInformation.ModeToNext,CloudGraphId:n.ItemId,ItemIndex:n.DisplayOrder,CategoryId:n.BusinessType};return n.EntityType&&(i.EntityTypes=[n.EntityType]),i},n}(),et=function(){function n(){if(n.instance)return n.instance;this._mostRecentlyUsed=new v}return n.prototype.pushItinerary=function(n){var t={IsItinerary:!0,Itinerary:n};this._dedupeItem(t);this._pushItem(t);this._trimList()},n.prototype.pushCollection=function(n){var t={IsItinerary:!1,Collection:n};this._dedupeItem(t);this._pushItem(t);this._trimList()},n.prototype.pushOpenItinerary=function(n,t){var i={IsItinerary:!0,IsOpenTask:!0,TaskId:n,TaskTitle:t};this._dedupeItem(i);this._pushItem(i);this._trimList()},n.prototype.removeItinerary=function(n){for(var i,t=0,r=this._mostRecentlyUsed.length;t<r;t++)if(i=this._mostRecentlyUsed[t],i.IsItinerary&&i.Itinerary.collectionId===n.collectionId){this._mostRecentlyUsed.removeAt(t);break}},n.prototype.removeOpenItinerary=function(n){for(var i,t=0,r=this._mostRecentlyUsed.length;t<r;t++)if(i=this._mostRecentlyUsed[t],i.IsOpenTask&&i.TaskId===n){this._mostRecentlyUsed.removeAt(t);break}},n.prototype.getLength=function(){return this._mostRecentlyUsed.length},n.prototype.getList=function(){return this._mostRecentlyUsed.slice()},n.prototype._pushItem=function(n){this._mostRecentlyUsed.insert(n,0)},n.prototype._dedupeItem=function(n){for(var i,r=n.IsItinerary,u=n.IsOpenTask,t=0,f=this._mostRecentlyUsed.length;t<f;t++)if(i=this._mostRecentlyUsed[t],r&&!u&&i.Itinerary===n.Itinerary||!r&&i.Collection===n.Collection){this._mostRecentlyUsed.removeAt(t);break}},n.prototype._trimList=function(){var n=this._mostRecentlyUsed.length;n>3&&this._mostRecentlyUsed.removeAt(3,n-3)},n.instance=new n,n}(),w=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return l(i,t),i.makeRetrieveAllItinerariesMetadataRequest=function(t,i){var f={RequestType:1,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,CollectionType:"ItineraryCollection"},r=null;u.getFunctionalTestHooksEnabled()&&(r=n.retrieveAllItinerariesBag);o._makeCgRequest(t,i,f,r)},i.makeRetrieveItineraryRequest=function(t,i,r,f,e){var h={RequestType:e?10:3,CollectionId:t,ClientETag:i,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,CollectionType:"ItineraryCollection"},s;e&&(h.ExternalUserId=e);s=null;u.getFunctionalTestHooksEnabled()&&(s=n.retrieveItineraryBag);o._makeCgRequest(r,f,h,s)},i.makeCreateItineraryRequest=function(t,i,r){var e={RequestType:5,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:"0",ItineraryMetaClientETag:"0",CollectionToBeWritten:t,MetaToBeWritten:{},CollectionType:"ItineraryCollection"},f=null;u.getFunctionalTestHooksEnabled()&&(f=n.insertItineraryBag);o._makeCgRequest(i,r,e,f)},i.makeUpdateItineraryRequest=function(t,i,r){var e={RequestType:5,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:t.ETag,ItineraryMetaClientETag:t.ItineraryMetaETag,CollectionId:t.CollectionId,CollectionToBeWritten:t,CollectionType:"ItineraryCollection"},f=null;u.getFunctionalTestHooksEnabled()&&(f=n.updateItineraryBag);o._makeCgRequest(i,r,e,f)},i.makeUpdateItineraryMetadataRequest=function(t,i,r){t.Items=null;var e={RequestType:6,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:t.ETag,ItineraryMetaClientETag:t.ItineraryMetaETag,CollectionId:t.CollectionId,MetaToBeWritten:t,CollectionType:"ItineraryCollection"},f=null;u.getFunctionalTestHooksEnabled()&&(f=n.updateItineraryMetaBag);o._makeCgRequest(i,r,e,f)},i.makeDeleteItineraryRequest=function(t,i,r){var e={RequestType:7,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:t.ETag,ItineraryMetaClientETag:t.ItineraryMetaETag,CollectionId:t.CollectionId,CollectionType:"ItineraryCollection"},f=null;u.getFunctionalTestHooksEnabled()&&(f=n.deleteItineraryBag);o._makeCgRequest(i,r,e,f)},i.makeItineraryUpsertPrimitiveRequest=function(t,i,r,f,e){if(i){var s={RequestType:4,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:t.ETag,ItineraryMetaClientETag:t.ItineraryMetaETag,CollectionId:t.CollectionId,ItemToBeWritten:i,CollectionType:"ItineraryCollection"},h=null;u.getFunctionalTestHooksEnabled()&&(h=n.insertItineraryItemBag);e&&(s.ItemId=i.ItemId);o._makeCgRequest(r,f,s,h)}},i.makeItineraryDeletePrimitiveRequest=function(t,i,r,f){var s={RequestType:8,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:i.ETag,ItineraryMetaClientETag:i.ItineraryMetaETag,CollectionId:i.CollectionId,ItemId:t,CollectionType:"ItineraryCollection"},e=null;u.getFunctionalTestHooksEnabled()&&(e=n.deleteItineraryItemBag);o._makeCgRequest(r,f,s,e)},i}(o),pt=function(t){function i(){var n=this;return i.itineraryInstance?i.itineraryInstance:t.call(this,!0)||this}return l(i,t),i.prototype.retrieveAllItinerariesMetaData=function(n){var t=this;this._itineraries&&this._itinerariesRetrieved?n&&n(this._itineraries,0):w.makeRetrieveAllItinerariesMetadataRequest(function(i){t._handleItineraryRetrieveAllResponse(i,n)},function(i,r,u){r===null||r.CollectionsMetaMap?n&&n(null,i?9:0):t._handleItineraryRetrieveAllResponse(r,n,u)})},i.prototype.retrieveItinerary=function(n,t,i){var u=this,r,f,e,o;!n&&t?t(null,7):(r=this.getItineraryIndexFromCache(n),f=null,r!==this._invalidIndex&&this._itineraries[r].itemsRetrieved&&(f=this._itineraries[r].eTag),e=function(n){return u._handleSingleItineraryResponse(n,t)},o=function(n,i){i!==null&&i.CollectionsMap?u._handleSingleItineraryResponse(i,t):n===0?t&&t(u._itineraries[r],0):t&&t(null,n?9:0)},w.makeRetrieveItineraryRequest(n,f,e,o,i))},i.prototype.createItinerary=function(t,i){var r=this,u,f;!t&&i?i(null,7):(u=this.getItineraryIndexFromCache(t.collectionId),this._itineraries&&this._itineraries.length>=ft._getMaxAllowedCollections()?i&&i(null,2):u===this._invalidIndex?(this._compareItineraryNames(t),f=y.convertTravelItineraryToItineraryCollection(d.serialize(t)),w.makeCreateItineraryRequest(f,function(u){var o,f,h,s,e,c,l;for(r._itineraries||(r._itineraries=new v),t.collectionId=u.CollectionId,t.eTag=u.ServerETag,t.itineraryMetaETag=u.ItineraryMetaServerETag,t.itemsRetrieved=!0,t.externalUserId=u.ExternalUserId,o=t.getDays(),f=0,h=o.length;f<h;f++)for(s=o[f],e=0,c=s.length;e<c;e++)l=s[e],l.setCollectionId(u.CollectionId);r._itineraries.insert(t,0);n.enableMostRecentlyUsedList&&et.instance.pushItinerary(t);i(t,0)},function(n){i&&i(null,n?9:0)})):i&&i(null,8))},i.prototype.deleteItinerary=function(t,i){var e=this,u,r,f;!t&&i?i(7):(u=this.getItineraryIndexFromCache(t),u!==this._invalidIndex?(r=this._itineraries[u],f=y.convertTravelItineraryToItineraryCollection(d.serialize(r)),w.makeDeleteItineraryRequest(f,function(){n.enableMostRecentlyUsedList&&et.instance.removeItinerary(r);r.collectionId="";r.changed.invoke();e._itineraries.removeAt(u);i(0)},function(n){i&&i(n?9:0)})):i&&i(5))},i.prototype.updateItinerary=function(n,t){var u=this,i,r;!n&&t?t(null,7):(i=this.getItineraryIndexFromCache(n.collectionId),r=y.convertTravelItineraryToItineraryCollection(d.serialize(n)),w.makeUpdateItineraryRequest(r,function(n){return u._handleUpdateItineraryResponse(n,t,i)},function(n){t&&t(null,n?9:0)}))},i.prototype.updateItineraryMeta=function(n,t){var u=this,i,r;!n&&t?t(null,7):(i=this.getItineraryIndexFromCache(n.collectionId),r=y.convertTravelItineraryToItineraryCollection(d.serialize(n)),w.makeUpdateItineraryMetadataRequest(r,function(n){var r=function(n){var i=function(i){i.ServerETag&&(n.eTag=i.ServerETag);i.ItineraryMetaServerETag&&(n.itineraryMetaETag=i.ItineraryMetaServerETag);t&&t(n,0)},r=function(n){t&&t(null,n?9:0)};w.makeRetrieveItineraryRequest(n.collectionId,n.eTag,i,r)};return u._handleUpdateItineraryResponse(n,r,i)},function(n){t&&t(null,n?9:0)}))},i.prototype.addItineraryItem=function(t,i,r){var f,u,e;if(r){if(t){if(!i){r(null,10);return}}else{r(null,7);return}if(f=this.getItineraryIndexFromCache(t),f===this._invalidIndex){r(null,5);return}if(u=this._itineraries[f],u.itemsRetrieved&&u.getAttractionCount()>=ft._getMaxAllowedCollectionEntites()){r(null,3);return}e=y.convertTravelItineraryToItineraryCollection(d.serialize(u));w.makeItineraryUpsertPrimitiveRequest(e,y.convertTravelItemToPlace(i.getItineraryItemMeta()),function(t){i.cloudGraphId=t.ItemId;t.ServerETag&&(u.eTag=t.ServerETag);t.ItineraryMetaServerETag&&(u.itineraryMetaETag=t.ItineraryMetaServerETag);n.enableMostRecentlyUsedList&&et.instance.pushItinerary(u);r&&r(u,0,t.ItemId)},function(n){r(null,n===0?0:9)})}},i.prototype.deleteItineraryItem=function(n,t,i){if(i){if(!n){i(7);return}if(!t){i(10);return}var u=this.getItineraryIndexFromCache(n),r=this._itineraries[u],f=y.convertTravelItineraryToItineraryCollection(d.serialize(r));w.makeItineraryDeletePrimitiveRequest(t,f,function(n){n.ServerETag&&(r.eTag=n.ServerETag);n.ItineraryMetaServerETag&&(r.itineraryMetaETag=n.ItineraryMetaServerETag);i(0)},function(){i(9)})}},i.prototype.updateItineraryItem=function(n,t,i){if(i){if(!n){i(7);return}if(!t){i(10);return}var u=this.getItineraryIndexFromCache(n),r=this._itineraries[u],f=y.convertTravelItineraryToItineraryCollection(d.serialize(r));w.makeItineraryUpsertPrimitiveRequest(f,y.convertTravelItemToPlace(t.getItineraryItemMeta()),function(n){n.ServerETag&&(r.eTag=n.ServerETag);n.ItineraryMetaServerETag&&(r.itineraryMetaETag=n.ItineraryMetaServerETag);i&&i(0)},function(n){i(n===0?0:9)},!0)}},i.prototype._handleItineraryRetrieveAllResponse=function(n,t,i){var u=new v,f=n&&n.CollectionsMetaMap,e,h,r;if(f){for(e in f)if(f.hasOwnProperty(e)){var o=f[e],c=y.convertItineraryCollectionToTravelItinerary(o),s=this.getItineraryIndexFromCache(o.CollectionId);s!==this._invalidIndex?(h=this._itineraries[s],u.insert(h)):(r=new d(c),r&&(r.externalUserId=n.ExternalUserId,r.eTag="",r.itineraryMetaETag=o.ETag,u.insert(r)))}this._itinerariesRetrieved=!0;this._itineraries=u;t&&t(this._itineraries,0)}else n&&i===404?(this._itinerariesRetrieved=!0,this._itineraries=u,t&&t(this._itineraries,0)):t&&t(this._itineraries,9)},i.prototype._handleSingleItineraryResponse=function(n,t){var u=n.CollectionsMap,r=u[n.CollectionId],f,e,i,o;if(!r)for(f in u)if(u.hasOwnProperty(f)){r=u[f];break}if(this._itineraries||(this._itineraries=new v),e=this.getItineraryIndexFromCache(r.CollectionId),r&&(o=y.convertItineraryCollectionToTravelItinerary(r),e!==this._invalidIndex?(i=this._itineraries[e],i.deserializeItineraryProperties(o)):(i=new d(o),this._itineraries.insert(i))),!i){t&&t(null,5);return}i.externalUserId=n.ExternalUserId;i.eTag=n.ServerETag;i.itineraryMetaETag=n.ItineraryMetaServerETag;t&&t(i,0)},i.prototype._handleUpdateItineraryResponse=function(n,t,i){var r=this._itineraries[i];n.ServerETag&&(r.eTag=n.ServerETag);n.ItineraryMetaServerETag&&(r.itineraryMetaETag=n.ItineraryMetaServerETag);t&&t(r,0)},i.prototype.getItineraryIndexFromCache=function(n){var i=this._invalidIndex,r,t,u;if(n&&this._itineraries)for(r=this._itineraries.length,t=0;t<r;t++)if(u=this._itineraries[t],u.collectionId.toLowerCase()===n.toLowerCase()){i=t;break}return i},i.prototype._compareItineraryNames=function(n){var e=this._invalidIndex,r,i,t,u,f;if(n&&this._itineraries)for(r=1,i=n.getName(),t=0,u=this._itineraries.length;t<u;t++)f=this._itineraries[t],f.getName().indexOf(i)!==-1&&n.setName(i+" "+ ++r)},i.itineraryInstance=new i,i}(ft),t=function(){function n(){}return n.id="id",n.ypid="ypid",n.sid="sid",n.eventId="eventid",n.nameField="name",n.description="description",n.address="address",n.isPublic="isPublic",n.entity="entity",n.primitives="primitives",n.geometry="geometry",n.geometryType="geometryType",n.geometryLongitudes="x",n.geometryLatitudes="y",n.bounds="bounds",n.area="area",n.style="style",n.displayOrder="displayOrder",n.routableLocation="routableLocation",n.labelLocation="labelLocation",n.photoId="photoId",n.photoUrl="photourl",n.businesslistingid="businesslistingid",n.serviceEndPoint="{ServiceEndPoint}",n.market="{Market}",n.collectionId="{CollectionId}",n.entityId="{EntityId}",n.logFeatureName="CX",n.defaultStyle={fillStyle:"rgba(189, 213, 245, .3)",strokeStyle:"#00ff00",lineWidth:6,strokeWidth:6,dashes:[0]},n.latLongPrecision=6,n}(),h=function(){function n(){}return n.viewMyPlaces="VMP",n.viewCollection="VCO",n.viewCollectionItemDetails="VCID",n.viewTemporaryCollection="VTC",n.processCollections="PC",n.viewAddNewCollection="VANC",n.newCollectionSave="NCS",n.saveButtonClicked="SBC",n.deleteButtonClicked="DBC",n.saveTemporaryCollection="STC",n.temporaryCollectionStatus="TCS",n.editCollection="ECO",n.editMyPlaces="EMP",n.routeCollection="RC",n.privacySharingState="PSS",n.itemCounts="CNT",n.favorites="FAV",n.pdpRequestFailure="PDPERR",n.seeAllCollectionClick="SAC",n.viewUpcomingEvents="VUE",n.loadUpcomingEvents="LUE",n.hasHomeWork="HWS",n.clickEntity="CE",n}(),ai=function(){function n(){}return n.getCollections="GC",n.getCollectionList="GCL",n.getCollectionDetails="GCD",n.loadMyPlacesView="LMPV",n.loadCollectionEntitiesView="LCEV",n.loadCollectionDetailsView="LCDV",n.renderCollectionPois="RCP",n.getFavorites="GFL",n}(),s=function(){function n(n,t,r){this.description=r;this.id=n;this.name=t;this.originalName=t;this.dateCreated=i.convertJavascriptDateToDateInTicks(new Date);this.dateModified=this.dateCreated;this.dateAccessed=this.dateCreated}return n.deserialize=function(i){var r;return i&&i.id&&i.name&&(r=new n(i.id,i.name,i.description),r.displayOrder=i.displayOrder,r.routableLocation=i.routableLocation,r.routableLocation||(r.routableLocation=new k(0,0)),r.labelLocation=i.labelLocation,r.photoId=i.photoId,r.photoUrl=i.photoUrl||i[t.photoUrl],r.businesslistingid=i.businesslistingid,r.address=i.address,r.originalName=i.originalName),r},n.deserializeCgEntity=function(r,u){var e=r.Name?r.Name:r.OriginalName,f;if(u||(u=new n(r.ItemId,e,r.Description)),r.OriginalName&&(u.originalName=r.OriginalName),u.routableLocation=new k(0,0),f=r.DisplayCoordinates||r.RoutableCoordinates||r.Geometry,u.routableLocation.latitude=f.Latitude,u.routableLocation.longitude=f.Longitude,u.displayOrder=r.DisplayOrder,u.labelLocation=u.routableLocation,u.photoUrl=r.Image,r.DateAccessed&&(u.dateAccessed=r.DateAccessed),r.DateCreated&&(u.dateCreated=r.DateCreated),r.DateModified&&(u.dateModified=r.DateModified),u.categoryId=r.BusinessType,r.Address&&r.Address.SingleLine&&(u.address=r.Address.SingleLine),r.EntityIdType){switch(r.EntityIdType.toLowerCase()){case"ypid":u.businesslistingid=t.ypid+":";r.EntityId.toLowerCase().indexOf("yn")===-1&&(u.businesslistingid+="YN");u.businesslistingid+=r.EntityId;break;case"satoriid":u.businesslistingid=t.sid+":";u.businesslistingid+=r.EntityId;break;case"eventid":u.businesslistingid=t.eventId+":";u.businesslistingid+=r.EntityId}u.entityId=r.EntityId;u.entityIdType=r.EntityIdType}else i.hasSatoriId(r.EntityId)?u.businesslistingid=t.sid+":"+r.EntityId:i.hasEventId(r.EntityId)?u.businesslistingid=t.eventId+":"+r.EntityId:i.hasSearchId(r.EntityId)&&(u.businesslistingid=t.ypid+":"+r.EntityId);return u},n.serialize=function(n){var i,r,u;return n&&(i={},i[t.nameField]=n.name,i[t.id]=n.id,i[t.address]=n.address,i[t.description]=n.description,i[t.displayOrder]=n.displayOrder,i[t.routableLocation]=n.routableLocation,i[t.labelLocation]=n.labelLocation,i[t.photoId]=n.photoId,i.originalName=n.originalName,n.photoUrl&&n.photoUrl!==""&&(r=n.photoUrl,u=n.photoUrl.match("^/th/?"),u&&u.length>-1&&(r=location.protocol+"//"+location.hostname+n.photoUrl),i[t.photoUrl]=r),i[t.businesslistingid]=n.businesslistingid),i},n.serializeCgEntity=function(n,r){var u="Unknown",f,e,o;n.entityId&&n.entityIdType?(u=n.entityIdType,r.EntityId=n.entityId):n.businesslistingid&&(n.businesslistingid.indexOf(t.ypid)!==-1?u="YPID":n.businesslistingid.indexOf(t.sid)!==-1?u="SatoriID":n.businesslistingid.indexOf(t.eventId)!==-1&&(u="EventID"),r.EntityId=n.businesslistingid.replace("ypid:","").replace("sid:","").replace("eventId:",""));r.Name=n.name;r.OriginalName=n.originalName;r.ItemId=n.id;r.Description=n.description;r.EntityIdType=u;r.Address={SingleLine:n.address};r.DisplayOrder=n.displayOrder;r.BusinessType=n.categoryId;f=i.convertJavascriptDateToDateInTicks(new Date);r.DateCreated=n.dateCreated;r.DateModified=f;r.DateAccessed=f;n.photoUrl&&n.photoUrl!==""&&(e=n.photoUrl,o=n.photoUrl.match("^/th/?"),o&&o.length>-1&&(e=location.protocol+"//"+location.hostname+n.photoUrl),r.Image=e)},n.buildEntityDataTaskOptions=function(n){var r={},i={};return i.entryPoint=ii.Collections,i.descriptionList=[],n&&(n.businesslistingid&&(n.businesslistingid.indexOf("ypid:")!==-1||n.businesslistingid.indexOf("sid:")!==-1||n.businesslistingid.indexOf("eventId:")!==-1?i.id=n.businesslistingid:n.businesslistingid!=="0"&&(i.id="ypid:"+n.businesslistingid)),i.query=!i.id&&n.routableLocation?n.routableLocation.latitude.toFixed(t.latLongPrecision)+", "+n.routableLocation.longitude.toFixed(t.latLongPrecision):n.originalName,i.taskTitle=n.name,n.name!==n.originalName&&(i.originalName=n.originalName),n.description&&n.name!==n.description&&i.descriptionList.push(n.description),n.categoryId&&(i.selectedCategoryId=n.categoryId)),r.type=oi.localDetailsTask,r.state=i,r},n.prototype.getTitle=function(){return this.name},n.prototype.getOriginalName=function(){return this.originalName},n.prototype.getDescription=function(){return this.description},n.prototype.getAddress=function(){return this.address},n.prototype.getPhotoUrl=function(){return this.photoUrl},n.localEntityId="",n}(),kt=function(n){function t(t,i,r){var u=n.call(this,t,i,r)||this;return u.entityShown=!0,u}return l(t,n),t.deserializeCgEntity=function(r,u){if(r){var f=r.Name?r.Name:r.OriginalName;return u||(u=new t(r.ItemId||r.EntityId,f,r.Description)),n.deserializeCgEntity.call(this,r,u),u.type=r.$type,r.TimeInformationLocal&&(u.startDate=i.convertDateInTicksToJavascriptDate(r.TimeInformationLocal.StartTime),u.endDate=i.convertDateInTicksToJavascriptDate(r.TimeInformationLocal.EndTime)),r.ReservationDetails&&(u.emailLink=r.ReservationDetails.EmailDeepLinkId,u.reservationId=r.ReservationDetails.BookingConfirmationId),u}return null},t.prototype.getPrimaryLabelText=function(){return this.name},t.prototype.getSecondaryLabelText=function(){return it.L_UpcomingEventEntity_TimeLabelFormat.replace("{date}",p._formatLongDateString(this.startDate)).replace("{time}",p._formatTimeString(this.startDate))},t}(s),dt=function(n){function t(t,i,r){return n.call(this,t,i,r)||this}return l(t,n),t.deserializeCgEntity=function(i){var r,u;return i?(r=new t(i.ItemId||i.EntityId,i.Name,i.Description),n.deserializeCgEntity.call(this,i,r),i.ArrivalAirport&&(i.ArrivalAirport.$type="Airport",r.arrivalAirport=b.deserialize(i.ArrivalAirport,!0),r.arrivalAirport.entity.flight=r,r.arrivalAirport.entity.startDate=r.endDate),i.DepartureAirport&&(i.DepartureAirport.$type="Airport",r.departureAirport=b.deserialize(i.DepartureAirport,!0),r.departureAirport.entity.flight=r,r.name=r.departureAirport.entity.name,r.departureAirport.entity.startDate=r.startDate),i.FlightSegmentEvents&&i.FlightSegmentEvents.length>0&&(u=i.FlightSegmentEvents[0].FlightSegmentInformation,u&&(r.flightNumber=u.FlightNumber,r.airline=u.AirlineName)),r):null},t}(kt),vi=function(n){function t(t,i,r){return n.call(this,t,i,r)||this}return l(t,n),t.deserializeCgEntity=function(i){if(i){var u=i.Name?i.Name:i.OriginalName,r=new t(i.ItemId||i.EntityId,u,i.Description);return n.deserializeCgEntity.call(this,i,r),r.airportCode=i.AirportCode,r.city=i.Address.Locality,r}return null},t.prototype.getSecondaryLabelText=function(){return it.L_UpcomingEventEntity_TimeLabelFormat.replace("{date}",p._formatLongDateString(this.startDate)).replace("{time}",p._formatTimeString(this.startDate))},t}(s),yi=function(){function t(){}return t.deserializeEntity=function(t){var r=null,u,i;if(t&&t.$type){for(u=n.filteredEvents.split(";"),i=0;i<u.length;i++)if(t.$type===u[i])return r;r=t.$type.indexOf("Events")===0?t.$type.indexOf("FlightEvent")!==-1?dt.deserializeCgEntity(t):kt.deserializeCgEntity(t):t.$type.indexOf("Airport")===0?vi.deserializeCgEntity(t):s.deserializeCgEntity(t)}return r},t}(),c;(function(n){n[n.AddItem=1]="AddItem";n[n.DeleteItem=2]="DeleteItem";n[n.MetaUpdate=3]="MetaUpdate";n[n.ItineraryUpdate=4]="ItineraryUpdate"})(c||(c={}));var d=function(n){function t(t){var i=n.call(this)||this;return i._privates.defineProperty("days",function(n,t){i.setDayCount(t.length)}),i._privates.defineProperty("cityName"),i._privates.defineProperty("image"),i._privates.defineProperty("guideUrl"),i._privates.defineProperty("interestTypes"),i._privates.defineProperty("attribution"),i._privates.defineProperty("itineraryId"),i._privates.defineProperty("gettyID"),i._privates.defineProperty("photographer"),i._privates.defineProperty("name",function(n,t){i._metaChangedHandler(n,t)}),i._privates.defineProperty("description",function(n,t){i._metaChangedHandler(n,t)}),i._privates.defineProperty("dayCount",function(n,t){i._updateAttractionCount();i._dayCountChangedHandler(n,t)}),i._privates.defineProperty("attractionCount"),i._privates.defineProperty("destinations",function(n,t){i._destinationsChangedHandler(n,t)}),i._privates.defineProperty("startDate",function(n,t){i._travelDatesChangedHandler(n,t)}),i._privates.defineProperty("endDate",function(n,t){i._travelDatesChangedHandler(n,t)}),i._dataManager=new pt,i.disposables=[],i._updateQueue=[],i.errorEvent=new g,i.itemsRetrieved=!1,i.isActive=!1,i.activeDay=0,t&&(i.deserializeItineraryProperties(t),i._initialized=!0),i}return l(t,n),t.prototype.dispose=function(){n.prototype.dispose.call(this);p._clearDisposables(this.disposables)},t.deserialize=function(n){return new t(n)},t.serialize=function(n){for(var r,i,o,u,t={CityName:n.getCityName(),GuideUrl:n.getGuideUrl(),InterestTypes:n.getInterestTypes(),Attribution:n.getAttribution(),ItineraryId:n.getItineraryId(),SeeAllPoisUrl:n.seeAllPoisUrl,CollectionId:n.collectionId,Name:n.getName(),Description:n.getDescription(),Image:{Url:n.getImage()},ETag:n.eTag,ItineraryMetaETag:n.itineraryMetaETag,Days:[],gettyID:n.getGettyID(),photographer:n.getPhotographer(),startDate:n.getStartDate(),endDate:n.getEndDate()},f=n.getDays(),s=0,e=0,a=f.length;e<a;e++){var h=f[e],c=h.length,l=[];for(r=0;r<c;r++)l.push(h[r].getItineraryItemMeta());t.Days.push(l);s+=c}if(t.DayCount=f.length,t.AttractionCount=s,i=n.getDestinations(),i&&i.length){for(o=[],u=0;u<i.length;u++)o.push(i[u].getItineraryItemMeta());t.Destinations=o}return t},t.prototype.deserializeItineraryProperties=function(n){var p=this,a,s,f,y,t,h,u,e,i,c;this.setCityName(n.CityName);this.setImage(n.Image&&n.Image.Url);this.setGuideUrl(n.GuideUrl);this.setInterestTypes(n.InterestTypes);this.setAttribution(n.Attribution);this.setItineraryId(n.ItineraryId);this.setName(n.Name);this.setDescription(n.Description||"");this.setGettyID(n.gettyID);this.setPhotographer(n.photographer);n.startDate&&this.setStartDate(n.startDate);n.endDate&&this.setEndDate(n.endDate);this.seeAllPoisUrl=n.SeeAllPoisUrl;this.collectionId=n.CollectionId;this.eTag=n.ETag;this.itineraryMetaETag=n.ItineraryMetaETag;var r=n.Days,o=[],l=0;if(!this.itemsRetrieved&&n.Destinations){for(a=new v,s=0;s<n.Destinations.length;s++)a.insert(new wt(n.Destinations[s],-1,0));this.setDestinations(a)}else this.itemsRetrieved||this.setDestinations(new v);if(r)if(f=this.getDays(),this.itemsRetrieved&&f&&f.length&&f.length===r.length&&this.getAttractionCount()===n.AttractionCount)for(t=0,h=r.length;t<h;t++)for(y=f[t],u=r[t],i=0,c=u.length;i<c;i++)y[i].cloudGraphId=u[i].CloudGraphId;else{for(t=0,h=r.length;t<h;t++){for(u=r[t],e=new v,i=0,c=u.length;i<c;i++)e.insert(new wt(u[i],t,i,this.collectionId));this.disposables.push(e.changed.add(function(n){return p._dayChangedHandler(n)}));o.push(e);l+=e.length}o.length&&n.AttractionCount===l&&(this.itemsRetrieved=!0);this.setDays(o);this.setDayCount(n.DayCount||o.length);this.setAttractionCount(n.AttractionCount||l)}},t.prototype.copy=function(n){var i=t.serialize(this);return n&&(i.Days=[]),new t(i)},t.prototype.addDay=function(){var i=this,n=new v,t;return this.disposables.push(n.changed.add(function(n){return i._dayChangedHandler(n)})),t=this.getDays(),t.push(n),this.setDayCount(t.length),n},t.prototype.removeDay=function(n){var t=this.getDays(),i;return n>=0&&n<t.length?(i=t.splice(n,1)[0],this.setDayCount(t.length),i):null},t.prototype.startReorder=function(){this._isReordering=!0},t.prototype.endReorder=function(){if(this.collectionId&&this._initialized){this._isReordering=!1;var n={UpdateType:c.ItineraryUpdate};this._updateQueue.push(n);this._requestOut||this._checkUpdateQueue()}},t.prototype.routeInfoUpdated=function(){if(this.collectionId&&this._initialized){var n={UpdateType:c.ItineraryUpdate};this._updateQueue.push(n);this._requestOut||this._checkUpdateQueue()}},t.prototype._checkUpdateQueue=function(){if(this._updateQueue.length>0){var n=this._updateQueue.splice(0,1)[0];switch(n.UpdateType){case c.AddItem:this._makeAddCall(n.ChangeEvent);break;case c.DeleteItem:this._makeDeleteCall(n.ChangeEvent);break;case c.MetaUpdate:this._makeUpdateMetaDataCall();break;case c.ItineraryUpdate:this._makeUpdateItineraryCall()}}},t.prototype._metaChangedHandler=function(n,t){if(t!==n&&this.collectionId&&this._initialized){var i={UpdateType:c.MetaUpdate};this._updateQueue.push(i);this._requestOut||this._checkUpdateQueue()}},t.prototype._travelDatesChangedHandler=function(n,t){if(t!==n&&this.collectionId&&this._initialized){var i={UpdateType:c.MetaUpdate};this._updateQueue.push(i);this._requestOut||this._checkUpdateQueue()}},t.prototype._destinationsChangedHandler=function(n,t){if(t&&t.length!==0&&this.collectionId&&this._initialized){var i={UpdateType:c.MetaUpdate};this._updateQueue.push(i);this._requestOut||this._checkUpdateQueue()}},t.prototype._dayCountChangedHandler=function(n,t){var i=t>n?c.MetaUpdate:t<n?c.ItineraryUpdate:null,r;i&&this.collectionId&&this._initialized&&(r={UpdateType:i},this._updateQueue.push(r),this._requestOut||this._checkUpdateQueue())},t.prototype._dayChangedHandler=function(n){var t=n.added&&n.added.length?c.AddItem:n.removed&&n.removed.length?c.DeleteItem:null,i,r;if(!t||!this.collectionId||!this._initialized||this._isReordering){t&&!this.collectionId&&this._initialized&&!this._isReordering&&(i=this.getAttractionCount()+(t===c.AddItem?1:-1),this.setAttractionCount(i));return}r={UpdateType:t,ChangeEvent:n};this._updateQueue.push(r);this._requestOut||this._checkUpdateQueue()},t.prototype._makeUpdateMetaDataCall=function(){var n=this;this._requestOut=!0;this._dataManager.updateItineraryMeta(this,function(t,i){n._requestOut=!1;i===0?n._checkUpdateQueue():n.errorEvent.invoke(i)})},t.prototype._makeUpdateItineraryCall=function(){for(var r,t,f,e,i=this,u=this.getDays(),n=0,o=u.length;n<o;n++)for(r=u[n],t=0,f=r.length;t<f;t++)e=r[t],e.dayIndex=n;this._requestOut=!0;this._dataManager.updateItinerary(this,function(n,t){i._requestOut=!1;t===0?i._checkUpdateQueue():i.errorEvent.invoke(t)})},t.prototype._makeAddCall=function(n){var t=this,i=n.added[0];this._requestOut=!0;this._dataManager.addItineraryItem(this.collectionId,i,function(i,r){t._requestOut=!1;r===0?(t.setAttractionCount(t.getAttractionCount()+n.added.length),t._checkUpdateQueue()):t.errorEvent.invoke(r)})},t.prototype._makeDeleteCall=function(n){var t=this,i=n.removed[0];this._requestOut=!0;this._dataManager.deleteItineraryItem(this.collectionId,i.cloudGraphId,function(i){t._requestOut=!1;i===0?(t.setAttractionCount(t.getAttractionCount()-n.removed.length),t._checkUpdateQueue()):t.errorEvent.invoke(i)})},t.prototype._updateAttractionCount=function(){for(var t=this.getDays(),i=0,n=0,r=t.length;n<r;n++)i+=t[n].length;this.setAttractionCount(i)},t}(nt),wt=function(n){function t(t,i,r,u,f){var e=this,o={},h,a,c,l,s;return e=n.call(this,o)||this,h=rt.features,a=h&&h.directions&&h.directions.unit,e._useKm=a===2,o.defineProperty("name",function(n,t){return e._updateItineraryItem(n,t)},null,{defaultValue:t.Name||t.OriginalName}),o.defineProperty("originalName",null,null,{defaultValue:t.OriginalName||t.Name}),o.defineProperty("description",function(n,t){return e._updateItineraryItem(n,t)},null,{defaultValue:t.Description||""}),o.defineProperty("interestTypes",null,null,{defaultValue:t.InterestTypes}),o.defineProperty("stayDuration",null,null,{defaultValue:t.StayDuration||t.StayDurationInMinutes&&p._formatDurationString(t.StayDurationInMinutes*60)}),o.defineProperty("modeToNext",function(){e._updatePrimitiveModeToNext()},null,{defaultValue:t.ModeToNext}),o.defineProperty("itemIndex",function(){e._updatePrimitiveIndex()},null,{defaultValue:r}),o.defineProperty("timeToNext",function(){e._updateDirectionsText()},null,{defaultValue:t.TimeToNext}),o.defineProperty("kmToNext",function(){e._updateDirectionsText()},null,{defaultValue:t.KmToNext}),o.defineProperty("directionsText"),e._dataManager=new pt,e._updateDirectionsText(),e.errorEvent=new g,c=t.Image.Url,hi.isCardified&&(c=e._formatImageUrl(c)),e.imageUrl=c,e.cloudGraphId=t.CloudGraphId||"",e._collectionId=u||"",e._stayDurationInMinutes=t.StayDurationInMinutes,e.dayIndex=i,e.categoryId=t.CategoryId,e.entityTypes=t.EntityTypes,e.destination=t.Destination,t.Lat&&t.Lon&&(l=new k(t.Lat,t.Lon),s=new si(t.Name,"",t.Id,l),s.modeToNext=t.ModeToNext,s.dayIndex=i,s.itemIndex=e.getItemIndex(),s.iconText=(e.getItemIndex()+1).toString(),s.isActiveDay=f,s.originalName=e.getOriginalName(),s.imageUrl=e.imageUrl,e._primitive=new ei(l,s)),e}return l(t,n),t.getItemFromLocalSearchEntity=function(n){var f=n.getImageUrl()||"",u=f.match("/th/??"),r,i;return u&&u.length>-1&&n.setImageUrl(f.substr(u.index)),r={Name:n.getTitle(),Id:n.id,Lat:n.getLocation().latitude,Lon:n.getLocation().longitude,Image:{Url:n.getImageUrl()},CategoryId:n.getSelectedCategoryForIcon()},i=n.addressFields,r.Destination=i&&(i.city||i.stateMunicipality||i.country),r.EntityTypes=n.getSegmentTypes(),new t(r,-1,0)},t.prototype.setIsActive=function(n){this._primitive&&this._primitive.entity&&(this._primitive.entity.isActiveDay=n)},t.prototype.updatePrimitiveHTMLElement=function(n){this._primitive&&this._primitive.entity&&(this._primitive.entity.htmlElement=n)},t.prototype.getPrimitive=function(){return this._primitive},t.prototype.getPrimitiveLocation=function(){var n=this._primitive&&this._primitive.entity&&this._primitive.entity;return n&&n.getLocation()},t.prototype.getId=function(){var n=this._primitive&&this._primitive.entity&&this._primitive.entity;return n&&n.id},t.prototype.dispose=function(){n.prototype.dispose.call(this);this._primitive.dispose();this._primitive=null},t.prototype.getItineraryItemMeta=function(){var i=this._primitive&&this._primitive.entity&&this._primitive.entity,n,t;return i?(n={Url:this.imageUrl},t={Name:this.getName(),OriginalName:this.getOriginalName(),Description:this.getDescription(),Id:this._primitive.entity.id,Lat:this._primitive.getLocation().latitude,Lon:this._primitive.getLocation().longitude,StayDuration:this.getStayDuration(),StayDurationInMinutes:this._stayDurationInMinutes,Image:n,InterestTypes:this.getInterestTypes(),TimeToNext:this.getTimeToNext(),KmToNext:this.getKmToNext(),ModeToNext:this.getModeToNext(),CloudGraphId:this.cloudGraphId,DayIndex:this.dayIndex,ItemIndex:this.getItemIndex(),CategoryId:this.categoryId,EntityTypes:this.entityTypes,Destination:this.destination},t):null},t.prototype.setCollectionId=function(n){this._collectionId=n},t.prototype._updateDirectionsText=function(){var n=p._formatDurationString(this.getTimeToNext())+" · "+p._readableTextFromDistance(this.getKmToNext()*1e3,this._useKm);this.setDirectionsText(n)},t.prototype._updatePrimitiveIndex=function(){if(this._primitive&&this._primitive.entity){var n=this._primitive.entity;n.itemIndex=this.getItemIndex();n.iconText=(this.getItemIndex()+1).toString()}},t.prototype._updatePrimitiveModeToNext=function(){if(this._primitive&&this._primitive.entity){var n=this._primitive.entity;n.modeToNext=this.getModeToNext()}},t.prototype._updateItineraryItem=function(n,t,i){var r=this;(t!==n||i)&&this._collectionId&&(this._updateRequestOut?this._updateAgain=!0:(this._updateAgain=!1,this._updateRequestOut=!0,this._dataManager.updateItineraryItem(this._collectionId,this,function(n){n===0?(r._updateRequestOut=!1,r._updateAgain&&r._updateItineraryItem("","",!0)):r.errorEvent.invoke(n)})))},t.prototype._formatImageUrl=function(n){return n&&n.indexOf("h=80&w=80")>=0&&(n=n.replace("h=80&w=80","h=112&w=92")),n},t}(nt),ot=function(r){function u(){var n=r.call(this)||this;return n.geometryType=3,n.crs=vt.instance,n}return l(u,r),u.prototype.getGeometry=function(){return this.geometry},u.prototype.setGeometry=function(n){this.geometry=n;this._length=i.calculateLength(this.geometry);this._area=i.calculateArea(this.geometry)},u.prototype.getArea=function(){return this._area||(this._area=i.calculateArea(this.geometry)),this._area},u.prototype.getLength=function(){return this._length||(this._length=i.calculateLength(this.geometry)),this._length},u.prototype.getLengthText=function(){var n=rt.features,t=n&&n.directions&&n.directions.unit;return p._createLengthText(this.getLength(),t===2)},u.prototype.getAreaText=function(){var n=rt.features,t=n&&n.directions&&n.directions.unit;return p._createAreaText(this.getArea(),t===2)},u.deserialize=function(n,t){if(t)return u.deserializeCgPolygon(n);var i;return n&&(i=new u,i.setGeometry(n.geometry),i.entity=s.deserialize(n.entity),i.polyShapeStyle=n.style,i.template=new at(n.style),i.entity.routableLocation.latitude&&i.entity.routableLocation.longitude||(i.entity.routableLocation.latitude=i.geometry.rings[0].y[0],i.entity.routableLocation.longitude=i.geometry.rings[0].x[0])),i},u.deserializeCgPolygon=function(n){var o,h,r,f,e,c,l,a;if(n&&n.Geometry){for(h=n.Geometry,r=h.OuterBoundary,o=new u,f={rings:[{x:[r[0].Longitude],y:[r[0].Latitude]}],bounds:[r[0].Latitude,r[0].Longitude,r[0].Latitude,r[0].Longitude]},e=1;e<r.length;e++)c=r[e].Latitude,l=r[e].Longitude,f.rings[0].x[e]=l,f.rings[0].y[e]=c,c>f.bounds[0]?f.bounds[0]=c:c<f.bounds[2]&&(f.bounds[2]=c),l>f.bounds[1]?f.bounds[1]=l:l<f.bounds[3]&&(f.bounds[3]=l);if(r=h.InnerBoundary,r&&r.length)for(f.rings[1]={x:[],y:[]},e=0;e<r.length;e++)c=r[e].Latitude,l=r[e].Longitude,f.rings[1].x[e]=l,f.rings[1].y[e]=c;o.setGeometry(f);o.entity=s.deserializeCgEntity(n);h.Style?(a=i.convertStrokeWeightToLineWidth(h.Style.StrokeWeight),o.polyShapeStyle={fillStyle:h.Style.FillColor,strokeStyle:h.Style.StrokeColor,lineWidth:a,strokeWidth:a,dashes:i.convertStrokeDashStyleToDashes(h.Style.StrokeDashStyle)}):o.polyShapeStyle=t.defaultStyle;o.template=new at(o.polyShapeStyle)}return o},u.serialize=function(n,i){if(i)return u.serializeCgPolygon(n);var r;return n&&(r={},r[t.geometryType]=n.geometryType,r[t.geometry]=n.getGeometry(),r[t.entity]=s.serialize(n.entity),r[t.style]=n.polyShapeStyle),r},u.serializeCgPolygon=function(n){var u,f,r,t;if(n){for(f=n.entity,r={$type:"GeometryPolygon",OuterBoundary:[],InnerBoundary:[],Style:{FillColor:n.polyShapeStyle.fillStyle,StrokeColor:n.polyShapeStyle.strokeStyle,StrokeWeight:i.convertLineWidthToStrokeWeight(n.polyShapeStyle.lineWidth),StrokeDashStyle:i.convertDashesToStrokeDashStyle(n.polyShapeStyle.dashes)}},t=0;t<n.geometry.rings[0].x.length;t++)r.OuterBoundary[t]={Latitude:n.geometry.rings[0].y[t],Longitude:n.geometry.rings[0].x[t]};if(n.geometry.rings[1])for(t=0;t<n.geometry.rings[1].x.length;t++)r.InnerBoundary[t]={Latitude:n.geometry.rings[1].y[t],Longitude:n.geometry.rings[1].x[t]};u={$type:"GeoAnnotation",Geometry:r,RoutableCoordinates:r.OuterBoundary[0],DisplayCoordinates:r.OuterBoundary[0],ShowOnMap:!0};s.serializeCgEntity(f,u)}return u},u.prototype.isTapEnabled=function(){return n.polygonTapEnabled},u}(nt),st=function(r){function u(){var n=r.call(this)||this;return n.geometryType=2,n.crs=vt.instance,n}return l(u,r),u.prototype.getGeometry=function(){return this.geometry},u.prototype.setGeometry=function(n){this.geometry=n;this._length=i.calculateLength(this.geometry)},u.prototype.getArea=function(){return 0},u.prototype.getLength=function(){return this._length||(this._length=i.calculateLength(this.geometry)),this._length},u.prototype.getLengthText=function(){var n=rt.features,t=n&&n.directions&&n.directions.unit;return p._createLengthText(this.getLength(),t===2)},u.deserialize=function(n,t){if(t)return u.deserializeCgPolyline(n);var i;return n&&(i=new u,i.setGeometry(n.geometry),i.entity=s.deserialize(n.entity),i.polyShapeStyle=n.style,i.template=new at(n.style),i.entity.routableLocation.latitude&&i.entity.routableLocation.longitude||(i.entity.routableLocation.latitude=i.geometry.y[0],i.entity.routableLocation.longitude=i.geometry.x[0])),i},u.deserializeCgPolyline=function(n){var e,o,f,r,h,c,l,a;if(n&&n.Geometry){for(o=n.Geometry,f=o.Points,e=new u,r={x:[f[0].Longitude],y:[f[0].Latitude],bounds:[f[0].Latitude,f[0].Longitude,f[0].Latitude,f[0].Longitude]},h=1;h<f.length;h++)c=f[h].Latitude,l=f[h].Longitude,r.x[h]=l,r.y[h]=c,c>r.bounds[0]?r.bounds[0]=c:c<r.bounds[2]&&(r.bounds[2]=c),l>r.bounds[1]?r.bounds[1]=l:l<r.bounds[3]&&(r.bounds[3]=l);e.setGeometry(r);e.entity=s.deserializeCgEntity(n);o.LineStyle?(a=i.convertStrokeWeightToLineWidth(o.LineStyle.StrokeWeight),e.polyShapeStyle={fillStyle:o.LineStyle.FillColor,strokeStyle:o.LineStyle.StrokeColor,strokeWidth:a,lineWidth:a,dashes:i.convertStrokeDashStyleToDashes(o.LineStyle.StrokeDashStyle)}):e.polyShapeStyle=t.defaultStyle;e.template=new at(e.polyShapeStyle)}return e},u.serialize=function(n,i){if(i)return u.serializeCgPolyline(n);var r;return n&&(r={},r[t.geometryType]=n.geometryType,r[t.geometry]=n.getGeometry(),r[t.entity]=s.serialize(n.entity),r[t.style]=n.polyShapeStyle),r},u.serializeCgPolyline=function(n){var u,f,r,t;if(n){for(f=n.entity,r={$type:"GeometryLine",Points:[],LineStyle:{FillColor:n.polyShapeStyle.fillStyle,StrokeColor:n.polyShapeStyle.strokeStyle,StrokeWeight:i.convertLineWidthToStrokeWeight(n.polyShapeStyle.lineWidth),StrokeDashStyle:i.convertDashesToStrokeDashStyle(n.polyShapeStyle.dashes)}},t=0;t<n.geometry.x.length;t++)r.Points[t]={Latitude:n.geometry.y[t],Longitude:n.geometry.x[t]};u={$type:"GeoAnnotation",Geometry:r,RoutableCoordinates:r.Points[0],DisplayCoordinates:r.Points[0],ShowOnMap:!0};s.serializeCgEntity(f,u)}return u},u.prototype.isTapEnabled=function(){return n.polylineTapEnabled},u}(nt),b=function(i){function r(){var n=i.call(this)||this;return n.geometryType=1,n.crs=vt.instance,n}return l(r,i),r.simplePointFactory=function(n){var o=n.location,f=o?+o.latitude.toFixed(6):0,e=o?+o.longitude.toFixed(6):0,c=n.title?n.title:f+", "+e,v=n.description?n.description:"",y=n.address,l=n.photoUrl?n.photoUrl:"",i=new s(s.localEntityId,c,v),u,h;if(i.address=y,l!==""&&(i.photoUrl=l),i.routableLocation=i.labelLocation=new k(f,e),i.displayOrder=1,i.categoryId=n.categoryId,u=n.id,u&&u.length<=50){var a=u.toLowerCase().indexOf(t.ypid)===0,p=u.toLowerCase().indexOf(t.sid)===0,w=u.toLowerCase().indexOf(t.eventId)===0;a&&u.toLowerCase().indexOf("yn")===-1&&(u=u.replace(":",":YN"));(a||p||w)&&(i.businesslistingid=u)}return n.nickName&&(i.originalName=c,i.name=n.nickName),h=new r,h.setGeometry({x:e,y:f,bounds:[f,e,f,e]}),h.entity=i,h},r.createSimplePointFromSearchEntity=function(n){var h=n.getTitle(),c=n.getAddress(),l=n.getDescription(),a=n.id&&n.id.length<=50&&(n.id.toLowerCase().indexOf(t.ypid)===0||n.id.toLowerCase().indexOf(t.sid)===0)?n.id:null,u=n.getLocation(),f=u?u.latitude:0,e=u?u.longitude:0,i=new s(s.localEntityId,h,l),o;return i.address=c,i.routableLocation=i.labelLocation=new k(f,e),i.displayOrder=1,i.businesslistingid=a,o=new r,o.setGeometry({x:e,y:f,bounds:[f,e,f,e]}),o.entity=i,o},r.prototype.getGeometry=function(){return this.geometry},r.prototype.setGeometry=function(n){this.geometry=n},r.prototype.getArea=function(){return 0},r.prototype.getLength=function(){return 0},r.deserialize=function(n,t){var i,u;return t?r.deserializeCgPoint(n):(n&&(i=new r,i.setGeometry(n.geometry),i.entity=s.deserialize(n.entity),i.entity.routableLocation.latitude&&i.entity.routableLocation.longitude&&(i.entity.routableLocation.latitude!==0||i.entity.routableLocation.longitude!==0)||(i.entity.routableLocation.latitude=i.geometry.y,i.entity.routableLocation.longitude=i.geometry.x),u=i.entity),i)},r.deserializeCgPoint=function(t){var u,i,f;if(t)if(i=t.Geometry||t.DisplayCoordinates||t.RoutableCoordinates,u=new r,u.setGeometry({x:i.Longitude,y:i.Latitude,bounds:[i.Latitude,i.Longitude,i.Latitude,i.Longitude]}),n.enableUpcomingEvents)if(f=yi.deserializeEntity(t),f)u.entity=f;else return null;else u.entity=s.deserializeCgEntity(t);return u},r.serialize=function(n,i){if(i)return r.serializeCgPoint(n);var u;return n&&(u={},u[t.geometryType]=n.geometryType,u[t.geometry]=n.getGeometry(),u[t.entity]=s.serialize(n.entity)),u},r.serializeCgPoint=function(n){var i,r,t;return n&&(r=n.entity,t={$type:"GeometryPoint",Latitude:n.geometry.y,Longitude:n.geometry.x},i={$type:"Place",RoutableCoordinates:t,DisplayCoordinates:t,Geometry:t,ShowOnMap:!0},s.serializeCgEntity(r,i)),i},r.prototype.isTapEnabled=function(){return n.simplePointTapEnabled},r}(nt),pi=function(n){function i(t){var i=this,r={};return i=n.call(this,r)||this,r.defineProperty("showDropdown",function(n,t){return i._onShowPopOutChanged(n,t)}),r.defineProperty("showSaveButton",null,null,{defaultValue:!0}),r.defineProperty("itineraries"),r.defineProperty("collections"),r.defineProperty("entityName"),r.defineProperty("entityId"),r.defineProperty("entityLat"),r.defineProperty("entityLong"),r.defineProperty("entityCatId"),r.defineProperty("entityImage"),r.defineProperty("topPosition"),r.defineProperty("leftPosition"),i.signInState=new fi,i.controlTemplateFactory=t,i._templateName=li,i.disposables=[],i.resources=it,i._dataManager=new pt,i._windowClickEventHandler=function(n){i._hideDropdown(n)},i.fetchItineraries(),i.fetchCollections(),i}return l(i,n),i.prototype.setEntityInformation=function(n){var i=n.data,r;if(i){this.setEntityName(i.title);r=i.id;switch(i.entityIdType){case 2:r=t.sid+":"+r;break;case 1:default:r=t.ypid+":"+r}this.setEntityId(r);this.setEntityLat(i.location.latitude);this.setEntityLong(i.location.longitude);this.setEntityCatId(i.categoryId);this.setEntityImage(i.photoUrl)}},i.prototype.saveOnSerpClicked=function(){var n=this;if(this.signInState.getIsSignedIn())this.onFavoritesClick(null,function(){return n._launchConfirmationTip()})},i.prototype.boolToDisplay=function(n){return n?"":"none"},i.prototype.boolToNotDisplay=function(n){return n?"none":""},i.prototype.fetchItineraries=function(){var n=this;this._dataManager.retrieveAllItinerariesMetaData(function(t){t&&n.setItineraries(t)})},i.prototype.fetchCollections=function(){var n=this;this._dataManager.retrieveAllCollectionsMetaData(function(t){t&&t.collections&&n.setCollections(t.collections)})},i.prototype.getControl=function(){if(!this._control){if(!this.controlTemplateFactory)throw"control template factory must be defined.";var n=this.controlTemplateFactory({templateText:this._templateName,staticResources:this});this._control=n.applyDataTemplate(this);this.disposables.push(n)}return this._control},i.prototype.dispose=function(){for(var n=0;n<this.disposables.length;n++)this.disposables[n].dispose();this.disposables=[]},i.prototype.onSaveClick=function(n){this.setShowDropdown(!0);n.stopPropagation();n.preventDefault()},i.prototype.onItineraryClick=function(n){var u=this,t,r,e,o;if(n){n.stopPropagation();n.preventDefault();var s=n.currentTarget,f=s.attributes["data-entityId"],i=f&&f.value;for(t=0,r=this.getItineraries();t<r.length;t++)e=r[t],o={Name:this.getEntityName(),Id:this.getEntityId(),Lat:this.getEntityLat(),Lon:this.getEntityLong(),StayDuration:"",InterestTypes:[],Image:{Url:this.getEntityImage()},CategoryId:this.getEntityCatId()},e.collectionId===i&&this._dataManager.retrieveItinerary(i,function(n,t){n&&t===0&&u._dataManager.addItineraryItem(i,new wt(o,0,0),function(){u.setShowDropdown(!1)})})}},i.prototype.onCollectionClick=function(n){var u=this,t,r,e;if(n){n.stopPropagation();n.preventDefault();var o=n.currentTarget,f=o.attributes["data-entityId"],i=f&&f.value,s=b.simplePointFactory({title:this.getEntityName(),id:this.getEntityId(),categoryId:this.getEntityCatId(),location:new k(this.getEntityLat(),this.getEntityLong()),photoUrl:this.getEntityImage()});for(t=0,r=this.getCollections();t<r.length;t++)e=r[t],e.id===i&&this._dataManager.retrieveCollection(i,function(n,t){n&&t===0&&u._dataManager.addPrimitive(i,s,function(){u.setShowDropdown(!1)})})}},i.prototype.onTemporaryCollectionClick=function(n){if(n){n.stopPropagation();n.preventDefault();var t=b.simplePointFactory({title:this.getEntityName(),id:this.getEntityId(),categoryId:this.getEntityCatId(),location:new k(this.getEntityLat(),this.getEntityLong()),photoUrl:this.getEntityImage()}),i=Math.floor(Math.random()*1e3)+"_"+Math.floor(Math.random()*1e3);t.entity.id=i;gt.addPoint(t);this.setShowDropdown(!1)}},i.prototype.onFavoritesClick=function(n,t){var i=this;n&&(n.stopPropagation(),n.preventDefault());this._dataManager.syncFavorites(function(n){var e,s;if(n===0){var u=i.getEntityLat(),f=i.getEntityLong(),o=i.getEntityName(),r=new ct;r.entity=new yt;r.entity.setOriginalName(o);r.entity.setName(o);r.entity.categoryId=i.getEntityCatId();e=i.getEntityId();e&&r.entity.setBusinesslistingid(e);r.entity.setPhotoUrl(i.getEntityImage());r.setGeometry({x:f,y:u,bounds:[u,f,u,f]});s=function(){i.setShowDropdown(!1);t&&t()};i._dataManager.createFavorite(r,s)}})},i.prototype.saveRootClass=function(n){return"bm_saveRoot"+(n?"":" noButton")},i.prototype._onShowPopOutChanged=function(n,t){var r=this,i=tt(window);t?Microsoft.Maps.setTimeout(function(){i.add_event("click,contextmenu",r._windowClickEventHandler)},1):n&&i.remove_event("click,contextmenu",this._windowClickEventHandler)},i.prototype._hideDropdown=function(){this.getShowDropdown()?this.setShowDropdown(!1):tt(window).remove_event("click,contextmenu",this._windowClickEventHandler)},i.prototype._launchConfirmationTip=function(){var r=this,n=new ci(null,null,[this.resources.SaveOnSerp_ConfirmationLink],!0,!0,!1,!0),t,i;n.setShowClose(!1);n.setShowBeak(!0);t=n.getRootElement();this.disposables.push(n.tipRemoved.add(function(){r.confirmationTip=null}));this.disposables.push(n.messageLinkClicked.add(function(){r.confirmationTip.removeTip();sj_evt.fire("ShowSaveMapOverlay")}));this._control.append(t);t.set_style({top:this.getTopPosition()+8,left:this.getLeftPosition()});i=tt(".tooltipsLink",t[0]);i.length&&i[0].focus();this.confirmationTip&&this.confirmationTip.removeTip();this.confirmationTip=n},i}(nt),gt=function(){function t(){}return t.addPoint=function(n){if(t._temporaryCollectionEnabled()){t.temporaryCollection&&t.syncedFromStorage||t.getCollection();var i=t._findExistingPoint(n.entity.id);return i===-1?(t.temporaryCollection.primitives.insert(n),t.commitChanges(),0):12}return 1},t.removePoint=function(n){if(t._temporaryCollectionEnabled()){var i=t._findExistingPoint(n);i!==-1&&t.temporaryCollection.primitives.removeAt(i);t.commitChanges()}},t.updatePoint=function(n,i,r){var f,u;t._temporaryCollectionEnabled()&&(f=t._findExistingPoint(n),f!==-1&&(u=t.temporaryCollection.primitives[f],u.entity.name=i,u.entity.description=r,u.changed.invoke(),t.temporaryCollection.primitives.changed.invoke()),t.commitChanges())},t.getCollection=function(){if(t._temporaryCollectionEnabled()){if(t.temporaryCollection||t._resetTemporaryCollection(),!t.syncedFromStorage){var i=ht.getItem(t.collectionsLocalStorageKey),n=a.deserialize(JSON.parse(i));n&&n.primitives&&(t.temporaryCollection.primitives=n.primitives);t.syncedFromStorage=!0}return t.temporaryCollection}return null},t.commitChanges=function(){if(t._temporaryCollectionEnabled()){var n=JSON.stringify(a.serialize(t.temporaryCollection));ht.setItem(t.collectionsLocalStorageKey,n)}},t.clearCollection=function(){t._temporaryCollectionEnabled()&&(ht.removeItem(t.collectionsLocalStorageKey),t._resetTemporaryCollection())},t.logTemporaryCollection=function(){if(t._temporaryCollectionEnabled()&&!t.alreadyLogged){var r=ht.getItem(t.collectionsLocalStorageKey),n=a.deserialize(JSON.parse(r));n&&n.primitives&&i.logAction(h.temporaryCollectionStatus,{ENT:n.primitives.length});t.alreadyLogged=!0}},t._resetTemporaryCollection=function(){t.temporaryCollection?(t.temporaryCollection.primitives.clear(),t.temporaryCollection.description=""):t.temporaryCollection=new a("TEMP",it.L_TemporaryCollectionTitle)},t._temporaryCollectionEnabled=function(){return(rt.isMapsVertical||n.enableSaveOnSerp)&&ht.isEnabled()},t._findExistingPoint=function(n){var r,u,i;if(t.temporaryCollection)for(r=t.temporaryCollection.primitives,u=r?r.length:0,i=0;i<u;i++)if(r[i].entity.id===n)return i;return-1},t.collectionsLocalStorageKey="BingMapsUserCollections",t.maxLimit=100,t.temporaryCollection=new a("TEMP",it.L_TemporaryCollectionTitle),t.syncedFromStorage=!1,t.alreadyLogged=!1,t}();e.ServerRequestFactory=o;e.Collection=a;e.CollectionConstants=t;e.CollectionEntity=s;e.CollectionLogActionName=h;e.CollectionsDataManager=ft;e.CollectionsLocalStorageHelper=gt;e.EventEntity=kt;e.FavoriteEntity=yt;e.FavoritePoint=ct;e.FlightEntity=dt;e.Itinerary=d;e.ItineraryConverter=y;e.ItineraryDataManager=pt;e.ItineraryItem=wt;e.ItineraryRequestFactory=w;e.MostRecentlyUsedList=et;e.MyPlaces=bt;e.PerfEventNames=ai;e.Polygon=ot;e.Polyline=st;e.SaveDropdownControl=pi;e.SimplePoint=b;e.Utilities=i}catch(ni){if(r.logger)r.logger.logCriticalError(ni);else throw ni;}}).call(window)