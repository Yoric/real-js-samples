(function(){try{(function(){var n={L_AddCollection_Title:"Create a Collection",L_AddToCollection_Title:"Add to My Places",L_Collection_Empty_Message:"To add to your Collection, tap Save from one of your search results.",L_MyPlaces_Title:"My Places",L_MyCollections_BackButton:"My Collections",L_SignIn_Text:"<link>Sign in<\/link> with your Microsoft account to view your Places.",L_AddCollection_Text:"New Collection",L_AddCollection_Description:"Create a new personalized collection",L_AddItinerary_Text:"New Itinerary",L_AddItinerary_Description:"Create a new personalized travel itinerary",L_EditModeDone_Text:"Done",L_EditMode_Text:"Edit",L_CancelButton_Text:"Cancel",L_CreateButton_Text:"Create",SignInAndSaveButton:"Sign in & Save",SignInTip:"<link>Sign in<\/link> to save",TempCollectionTip:"View your temporary collection, or create a new one.",EmptyTempCollectionLine1:"Your temporary collection is empty.",EmptyTempCollectionLine2:"Save places to your temporary collection from your search results on the map. Just tap ",L_CreateCollection_ToolTip:"Create a Collection",L_DeleteCollection_ToolTip:"Delete this Collection",L_DeleteItinerary_ToolTip:"Delete this Itinerary",L_DeleteEntity_ToolTip:"Delete this place",L_EnterEdit_ToolTip:"Edit My Places",L_ExitEdit_ToolTip:"Exit edit mode",L_FailedEntitySave_Text:"There was a problem adding this place to your Collection Try again.",L_NewCollectionDescription_Text:"Description",L_NewCollectionDescription_Watermark:"Example: Places to visit on my trip",L_NewCollectionName_Text:"Name",L_NewCollectionName_Watermark:"Example: My summer trip",L_NewCollectionPrivacy_Text:"Allow sharing",L_CollectionError_Adding_Text:"There was a problem creating the Collection. Try again.",L_CollectionError_Deleting_Text:"There was a problem deleting the Collection or place. Try again.",L_ItineraryError_Deleting_Text:"There was a problem deleting the Itinerary. Please try again.",L_CollectionError_Retrieving_Text:"There was a problem displaying your Collection. Please try again.",L_ItineraryError_Retrieving_Text:"There was a problem displaying your Itineraries. Please try again.",L_CollectionError_Updating_Text:"There was a problem saving your changes to the Collection. Try again.",L_CollectionError_SaveToExisting:"There was a problem saving these places to your collection. Try again.",L_CollectionNameMissing_Text:"Don't forget to name your Collection.",L_DragToolTip_Text:"Drag to reorder",L_CollectionError_ViewShared_Text:"We can't show you this Collection. Check your network connection, or check with the person who shared them to make sure sharing is allowed.",L_DescLengthError_Text:"Try a shorter description. (1000 character maximum)",L_TitleLengthError_Text:"Try a shorter name. (100 character maximum)",L_Collections_MyLocation:"My location",L_FavoriteDirections_Text:"Get Directions",L_RouteAll_Text:"All my places",L_RouteSelectMessage_Text:"Select places and tap Get Directions",L_RouteSelect_Text:"Select places",L_SeeAllButton:"See all in map view",L_CollectionDirectionButton_Text:"Directions",L_CollectionDirectionButton_ToolTip:"Select route all or select destinations",L_CollectionEditButton_ToolTip:"Click to edit the title or description of this collection",L_CollectionShareButton_Text:"Share",L_CollectionShareButton_ToolTip:"Click to share this collection",L_CollectionSaveButton_ToolTip:"Click to save to a collection",L_AddCollectionWhenNone_Text:"Add to your Collections by tapping the New Collection button.",L_DirectionsCancelToolTip_Text:"Cancel selecting a route",L_GetDirectionsToolTip_Text:"Get Directions for the selected places",L_MakePublicFail_Text:"Our system is unable to share this Collection right now. Please try again.",L_MakePublicSuccess_Text:'You changed "{0}" Collection from private to sharing mode.',L_UndoFail_Text:"Our system is unable to undo the change right now. Please try again.",L_Undo_Text:"Undo",L_ShareOnlySpecificCollection_Text:"Unable to share this My Places card. Try sharing a single Collection.",L_CollectionDescriptionEdit_Text:"You can add a description or notes here (1000 character maximum)",L_EnterEditText_ToolTip:"Edit title or description",L_FavoriteTitle_Text:"Favorites",L_HomeFavorite_Text:"Home",L_WorkFavorite_Text:"Work",L_MissingHomeFavorite_Text:"Click or tap to add your Home",L_MissingWorkFavorite_Text:"Click or tap to add your Work",L_CollectionSubTitle_Text:"Collections",L_ItinerariesSubTitle_Text:"Itineraries",L_AddCollectionMessage_Text:"Organize your favorites by creating Collection",L_AddFavoritesMessage_Text:"Your Favorites list is empty. Add a place to your Favorites by pressing Save in a search card",L_SeeLess_Text:"See Less",L_SeeMore_Text:"See More",L_SeeLess_ToolTip:"See Less {0} ",L_SeeMore_ToolTip:"See More {0}",L_FavoriteErrorMessage_Text:"We were unable to retrieve your Favorites from storage",L_HomeEditText_ToolTip:"Open edit dialog for Home",L_WorkEditText_ToolTip:"Open edit dialog for Work",L_AddHome_Text:"Add your Home",L_AddHome_Title:"Home",L_AddWork_Text:"Add your Work",L_AddWork_Title:"Work",L_AddHomeWork_Button:"Add",L_CreateFavoriteError_AlreadyExists:"We were unable to save this place, as it is already in your favorites.",L_EditHome_Text:"Edit your Home",L_EditWork_Text:"Edit your Work",L_AllowLCAStatement_Text:"Checking this box enables you to share this collection via URL.",L_AutoSuggestSearchFailed_Message:'Couldn\'t find "{0}"',L_FailedSaveFavorite_Message:"There was a problem saving this place to your Favorites. Try again.",L_BackToDetails_Text:"Local search details",L_DeleteFavorite_ToolTip:"Remove this Favorite",L_DeleteHome_ToolTip:"Remove this as your Home",L_DeleteWork_ToolTip:"Remove this as your Work",L_EditFavoriteText_ToolTip:"Edit this Favorite",L_EditHomeText_ToolTip:"Edit your Home",L_EditWorkText_ToolTip:"Edit your Work",L_PlaceTitleEditSuggestion_Text:"Give this place a name",L_PlaceAddressEditSuggestion_Text:"Give this place an address",L_PlaceDescriptionEditSuggestion_Text:"Add a note",L_FormatDescription_Text:"{0}: {1}",L_CollectionCount_Text:"{0} items",L_CollectionCountSingle_Text:"{0} item",L_AddressLabel_Text:"Address",L_NoteLabel_Text:"Notes",L_TitleLabel_Text:"Title",L_AddHomeWorkSearch_Button:"Search",L_ShowHomeWorkCheckbox:"Show this place on my map",L_MaxDirectionsItems_Text:"There is a maximum of 25 waypoints allowed.",L_SignInButton_Text:"Sign In",L_PrintNotes_Watermark:"Type your notes here.",L_SharedTemporaryCollection_Title:"Shared Places",L_TemporaryCollectionTitle:"Temporary Collection",L_TemporaryCollectionDescription:"Places saved locally in your browser",L_TemporaryCollectionSignIn:"Sign in for more saving options and to access your collections from anywhere.",L_TemporaryCollectionClearButton:"Clear",L_TemporaryCollectionClearButton_Cardified:"Clear temporary collection",L_TemporaryCollectionSaveButton:"Save",L_TemporaryCollectionRemoveButton:"Delete",L_TemporaryCollectionDeleteConfirmationMessage:"Are you sure you want to delete this place?",L_CollectionsListDeleteConfirmationMessage:"Are you sure you want to permanently delete this collection?",L_ItineraryDeleteConfirmationMessage:"Are you sure you want to permanently delete this itinerary?",L_TemporaryCollectionClearConfirmationMessage:"Are you sure you want to clear all of your places?",L_TemporaryCollectionSaveMessage:"Save this collection to access it from any device in the future. Save to:",L_TemporaryCollectionSaveToNew:"New Collection",L_RemoveEntity_ToolTip:"Remove this place from the temporary collection",L_ContextMenu_ToolTip:"Additional actions on this entity",L_MeasureMapTask_Title:"Measure Distance & Area",L_MeasureMapTask_InitialInstructions:"Click or tap on the map to create a new point. Tap and drag an existing point to move it. Right-click (or tap and hold) on a point to remove it.",L_MeasureMapTask_PerimeterFormat:"Distance: {primary} ({secondary})",L_MeasureMapTask_AreaFormat:"Area: {primary} ({secondary})",L_MeasureMapTask_NewLink_Text:"Reset",L_MeasureMapTask_DoneLink_Text:"Done",L_MeasureMapTask_EditLink_Text:"Edit",L_MeasureMapTask_AreaLink_Text:"Close shape",L_MeasureMapTask_NewLink_Title:"Clear any current shape and start over",L_MeasureMapTask_DoneLink_Title:"Finish editing the current shape and leave on map",L_MeasureMapTask_EditLink_Title:"Continue editing the current shape",L_MeasureMapTask_AreaLink_Title:"Convert current shape to a polygon and display its contained area",L_MeasureMapTask_DistanceUnitKm_Text:"km",L_MeasureMapTask_DistanceUnitMeter_Text:"m",L_MeasureMapTask_DistanceUnitMile_Text:"mi",L_MeasureMapTask_DistanceUnitFoot_Text:"ft",L_MeasureMapTask_AreaUnitKm_Text:"sq km",L_MeasureMapTask_AreaUnitMeter_Text:"sq m",L_MeasureMapTask_AreaUnitMile_Text:"sq mi",L_MeasureMapTask_AreaUnitFoot_Text:"sq ft",L_MeasureMapTask_ValueUnitFormat:"{value} {unit}",L_Migration_In_Progress_Message:"Server Maintenance, please try again in a few minutes",L_User_Migrated_Message:"Server Maintenance, please refresh your browser and try again",L_Max_Collections_Message:"You have reached the limit of {0} collections in your account. In order to create a new collection, you must delete one or more existing collections.",L_Max_Entities_Message:"You have reached the limit of {0} places in this collection. In order to add a new place to this collection, you must delete one or more existing places.",L_EditSaveButton:"Save",L_NicknameTitle:"Nickname",L_DescriptionTitle:"Description",L_CollectionPrivateMessage:"Make this collection public.",L_CollectionPublicMessage:"Make this collection private.",L_CollectionMadePrivateMessage:"This collection is now private and cannot be shared with others.",L_CollectionMadePublicMessage:"This collection can now be shared with others.",L_AddCollectionPrivateMessage:"This Collection cannot be shared. Tap lock icon to make collection shareable.",L_AddCollectionPublicMessage:"You can share this collection with others. Tap lock icon to make collection private.",L_UpcomingEventsName:"Upcoming Events",L_UpcomingEventEntity_TimeLabelFormat:"{date} @ {time}",L_SeeMoreEventsLink:"See more upcoming events",L_SeeLessEventsLink:"See less upcoming events",L_FlightToText:"Flight to {0}",L_EmptyItinerariesMessage:"Make the most of every day - save Bing itineraries you like, or customize them and make them your own.",L_EmptyItinerariesSearchLink1:'Search to get started (e.g. "',L_EmptyItinerariesSearchLink2:"Seattle itineraries",L_EmptyItinerariesSearchLink3:'").',L_CreateNewItinerary:"Create a new itinerary",SaveOnSerp_ConfirmationLink:"<link>View My Places<\/link>"};window.$MicrosoftMaps8.ResourceManager?window.$MicrosoftMaps8.ResourceManager.init("Collections",n):window.$MicrosoftMaps8.ResourcesObject=n})();var f=window.$MicrosoftMaps8,s=f.Internal,k=f.Collections=f.Collections||{},kt=s.TaskData=s.TaskData||{},a=f.CloudGraphDataManager=f.CloudGraphDataManager||{},du=f.Anchor,tr=f.CommonControls.AutosuggestV2,ir=f.CommonControls.AutosuggestViewModel,gu=s._BaseMapTemplateSelector,si=s.BaseTask,dt=s.BaseTaskViewModel,nf=f.BasicTemplate,tf=f.BitmapImageTemplate,rf=a.CloudGraphRequestFactory,g=a.Collection,t=kt.CollectionActions,ft=a.CollectionConstants,yt=a.CollectionEntity,r=a.CollectionLogActionName,gt=f.CommonControls.CollectionsAutosuggestDataModel,h=f.GlobalConfig.features.collections,ni=a.CollectionsDataManager,b=a.CollectionsLocalStorageHelper,uf=f.CollectionsTaskPoiManager,ff=f.Constants,hi=s.ControlTemplate,y=f.DataHandlerKeys,ti=f.Internal._Debug,ci=kt.DistanceUnit,et=s._EntryPoints,rr=a.EventEntity,ii=a.FavoriteEntity,ht=a.FavoritePoint,ur=a.FlightEntity,ef=s.GeolocationProvider,i=s._Gimme,ct=f.GlobalConfig,p=f.GlobalDataEventHandler,of=f.ImageFromCssHelper,ri=a.ItineraryDataManager,o=s._JSEvent,ui=s._Helper,sf=s._LatLonCrs,ot=s._LocalStorageCache,hf=f.LocationRect,fi=s._LoggerConstants,fr=s.MapHelper,cf=f.MapLayer,lt=f.Location,lf=f.MapMath,er=f.MapsInfobox,or=f.MapTypeId,af=f.MapView,sr=a.MostRecentlyUsedList,li=a.MyPlaces,vf=s._Network,yf=s._Observable,pt=s._ObservableCollection,pf=s._ObservableObject,wf=s._ObservableObjectChangedArgs,bf=s._OverlayEntity,nt=a.PerfEventNames,hr=f.Point,kf=a.Polygon,df=a.Polyline,wt=f.GlobalConfig.features.print,cr=s.PrintContent,lr=s.PrintManager,u=f.ResourceManager.Collections,gf=s.SDK,bt=f.SignInState,ut=a.SimplePoint,ar=f.SimplePointPrimitive,vr=f.TabControlRequester,c=f.TaskTypes,tt=s.TransientLensActions,it=f.ResourceManager.Travel,ai=s.UserTipControl,n=a.Utilities,ne=f.VectorMapLayer,yr=kt.Waypoint,te=f.ZoomLevel,pr='<div id="collectionsTop" data-tag="collectionsTop" class="collectionsCard" event:touchmove="onTouchScroll">    <div class="collectionMobileControlRoot" data-tag="collectionMobileControlRoot">        <a class="headerBar" event:click="onHeaderBarClick" href="#">        <\/a>        <div class="headerBarCollectionName">            <TextBlock text="{Binding collection.name}" />        <\/div>        <div style:display="{Binding error Converter=successToDisplay}">            <div class="descriptionSection">                <TextBlock text="{Binding collection.description}" />            <\/div>            <div class="viewingPane" data-tag="viewingPane">                <div class="collectionItemList">                    <div class="entityResults" id="entitiesList" data-tag="entitiesList">                        <ItemsControl ItemsSource="{Binding Collection.primitives}" panelTagName="ul">                            <ItemsControl.ItemTemplate>                                <DataTemplate>                                    <li ordinal="{Binding entity.displayOrder}" data-entityid="{Binding entity.id}">                                        <hr class="collectionSeparator" />                                        <a class="collectionItem" data-tag="collectionItem" data-entityid="{Binding entity.id}" event:click="onEntityClick" href="#">                                            <img class="collectionEntityImage" src="{Binding entity.photoUrl Converter=convertPhotoUrlToSource}" event:error="handleImageErrorEvent" alt=""/>                                            <div>                                                <div class="collectionItemHeader">                                                    <div class="collectionItemTitle" data-tag="collectionItemTitle" ordinal="{Binding entity.displayOrder}">                                                        <TextBlock Text="{Binding entity.name}" />                                                    <\/div>                                                <\/div>                                                <div class="collectionAddressContainer" style:display="{Binding entity Converter=showAddress}">                                                    <div class="collectionItemAddress" data-tag="collectionItemAddress">                                                        <TextBlock Text="{Binding entity Converter=setAddressText}" />                                                    <\/div>                                                <\/div>                                                <div class="itemDescriptionContainer">                                                    <div class="collectionItemDescription" data-tag="collectionItemDescription">                                                        <TextBlock Text="{Binding entity Converter=showDescription}" />                                                    <\/div>                                                <\/div>                                            <\/div>                                        <\/a>                                    <\/li>                                <\/DataTemplate>                            <\/ItemsControl.ItemTemplate>                        <\/ItemsControl>                    <\/div>                <\/div>            <\/div>        <\/div>        <div class="errorMessage" style:display="{Binding error Converter=errorToDisplay}">            <TextBlock Text="{Binding resources.L_CollectionError_Retrieving_Text}" />        <\/div>    <\/div><\/div>',vi='<div class="collectionPrint" data-tag="collectionPrint">    <div class="collectionHeaderContent">        <div class="collectionPanelTitle cardTitle" data-tag="collectionPanelTitle" id="collectionTitleText">            <div class="overflowText collectionTitleTextBlock" data-tag="collectionTitleTextBlock">                <TextBlock Text="{Binding collection.name}" />            <\/div>        <\/div>        <div class="isText showText collectionDescription" style:display="{Binding collection.description Converter=nullToDisplayNone}" data-tag="collectionDescription" id="collectionDescriptionText">            <div class="collectionDescriptionTextBlock">                <TextBlock Text="{Binding collection.description}" />            <\/div>        <\/div>    <\/div>    <div class="isText showText collectionItemListPrint">        <div class="entityResults" id="entitiesList" data-tag="entitiesList">            <div class="collectionItemList">                <ItemsControl ItemsSource="{Binding collection.primitives}" panelTagName="ul">                    <ItemsControl.ItemTemplate>                        <DataTemplate>                            <li ordinal="{Binding entity.displayOrder}" data-entityid="{Binding entity.id}">                                <a class="collectionItem collectionItemPrint" data-tag="collectionItem" data-entityid="{Binding entity.id}">                                    <div class="entityIcon">                                        <img class="iconImage" src="{Binding entity.iconSource}" alt=""/>                                        <span class="entityIconText">                                            <TextBlock Text="{Binding entity.iconText}" />                                        <\/span>                                    <\/div>                                    <div class="collectionItemHeader collectionItemHeaderPrint">                                        <div class="collectionItemTitle printItemTitle" data-tag="collectionItemTitle" ordinal="{Binding entity.displayOrder}">                                            <TextBlock Text="{Binding entity.name}" />                                        <\/div>                                        <div class="auxillaryTextFields">                                            <div class="collectionAddressContainer printItemAddress" style:display="{Binding entity Converter=showAddress}">                                                <div class="collectionItemAddress" data-tag="collectionItemAddress">                                                    <TextBlock Text="{Binding entity.address}" />                                                <\/div>                                            <\/div>                                            <div class="itemDescriptionContainer printItemDescription" style:display="{Binding entity Converter=showPrintDescription}">                                                <div class="collectionItemDescription collectionItemDescriptionPrint" data-tag="collectionItemDescription">                                                    <TextBlock Text="{Binding entity.description}" />                                                <\/div>                                            <\/div>                                        <\/div>                                    <\/div>                                <\/a>                            <\/li>                        <\/DataTemplate>                    <\/ItemsControl.ItemTemplate>                <\/ItemsControl>            <\/div>        <\/div>    <\/div><\/div>',wr='<div event:touchmove="onTouchScroll">    <div id="collectionsList" class="collectionList" style:display="{Binding error Converter=successToDisplay}" data-tag="collectionsList">        <ul class="favoritesList">            <div data-tag="fullCollectionsList">                <ItemsControl ItemsSource="{Binding myPlaces.collections}">                    <ItemsControl.ItemTemplate>                        <DataTemplate>                            <li>                                <a class="collectionEntry" data-tag="collectionEntry" data-collectionid="{Binding id}" value="{Binding name}" event:click="onCollectionClick" href="#">                                    <div class="collectionTitleContainer">                                        <span class="entryTitle" data-tag="entryTitle">                                            <TextBlock Text="{Binding name}" />                                        <\/span>                                    <\/div>                                    <div class="collectionDescriptionContainer" style:display="{Binding description Converter=nullToDisplayNone}">                                        <span class="collectionDescriptionPreview" data-tag="collectionDescriptionPreview">                                            <TextBlock Text="{Binding description}" />                                        <\/span>                                    <\/div>                                <\/a>                            <\/li>                        <\/DataTemplate>                    <\/ItemsControl.ItemTemplate>                <\/ItemsControl>            <\/div>        <\/ul>    <\/div>    <div class="errorMessage" style:display="{Binding error Converter=errorToDisplay}">        <TextBlock Text="{Binding resources.L_CollectionError_Retrieving_Text}" />    <\/div><\/div>',br='<div event:touchmove="onTouchScroll">    <div class="graphFavorites" style:display="{Binding error Converter=successToDisplay}" data-tag="graphFavorites">        <div class="HomeWorkSection">            <div class="homeWorkContainer">                <a class="homeContainer" data-tag="HomeContainer" data-entityid="{Binding Home.entity.Businesslistingid}" event:click="onEntityClick" style:display="{Binding Home Converter=nullToDisplayNone}" href="#">                    <img class="homeImage" src="{Binding Home.entity Converter=setHomePhotoSrc}" />                    <div class="homeTextContainer">                        <div class="homeTitle" data-tag="homeTitle">                            <TextBlock Text="{StaticBinding resources.L_HomeFavorite_Text}" />                        <\/div>                        <div class="favoriteItemNonTitle" data-tag="homeOriginalName" style:display="{Binding Home.entity Converter=noShowOnDupeName}">                            <TextBlock Text="{Binding Home.entity.OriginalName Converter=getHomeOriginalName}" />                        <\/div>                        <div class="favoriteItemNonTitle" data-tag="homeAddress">                            <TextBlock Text="{Binding Home.entity.Address}" />                        <\/div>                        <div class="favoriteItemNonTitle" data-tag="homeDescription">                            <TextBlock Text="{Binding Home.entity.Description Converter=getHomeDescription}" />                        <\/div>                    <\/div>                <\/a>                <hr class="collectionSeparator" style:display="{Binding Home Converter=nullToDisplayNone}" />                <a class="workContainer" data-tag="WorkContainer" data-entityid="{Binding Work.entity.Businesslistingid}" event:click="onEntityClick" style:display="{Binding Work Converter=nullToDisplayNone}" href="#">                    <img class="workImage" src="{Binding Work.entity Converter=setWorkPhotoSrc}" />                    <div class="workTextContainer">                        <div class="workTitle" data-tag="workTitle">                            <TextBlock Text="{StaticBinding resources.L_WorkFavorite_Text}" />                        <\/div>                        <div class="favoriteItemNonTitle" data-tag="workOriginalName" style:display="{Binding Work.entity Converter=noShowOnDupeName}">                            <TextBlock Text="{Binding Work.entity.OriginalName Converter=getWorkOriginalName}" />                        <\/div>                        <div class="favoriteItemNonTitle" data-tag="workAddress">                            <TextBlock Text="{Binding Work.entity.Address}" />                        <\/div>                        <div class="favoriteItemNonTitle" data-tag="workDescription">                            <TextBlock Text="{Binding Work.entity.Description Converter=getWorkDescription}" />                        <\/div>                    <\/div>                <\/a>                <hr class="collectionSeparator" style:display="{Binding Work Converter=nullToDisplayNone}" />            <\/div>        <\/div>        <ul class="favoritesList">            <div class="favoriteItemList" data-tag="favoriteItemList">                <ItemsControl ItemsSource="{Binding Favorites}">                    <ItemsControl.ItemTemplate>                        <DataTemplate>                            <li data-entityid="{Binding entity.Businesslistingid}">                                <a class="favoriteEntry" data-tag="favoriteEntry" data-entityid="{Binding entity.Businesslistingid}" event:click="onEntityClick" href="#">                                    <img class="favoriteImage" src="{Binding entity.PhotoUrl Converter=setFavoritePhotoSrc}" />                                    <div class="favoriteContainer">                                        <div class="favoriteItemHeader">                                            <div class="favoriteTitleContainer" data-tag="favoriteTitleContainer">                                                <TextBlock Text="{Binding entity Converter=getFavoriteTitle}" />                                            <\/div>                                        <\/div>                                        <div class="favoriteItemNonTitle" data-tag="favoriteOriginalNameContainer" style:display="{Binding entity Converter=noShowOnDupeName}">                                            <TextBlock Text="{Binding entity.OriginalName}" />                                        <\/div>                                        <div class="favoriteItemNonTitle" data-tag="favoriteAddressContainer" style:display="{Binding entity Converter=showAddress}">                                            <TextBlock Text="{Binding entity Converter=getFavoriteAddress}" />                                        <\/div>                                        <div class="favoriteItemNonTitle" data-tag="favoriteDescriptionContainer" style:display="{Binding entity Converter=noShowOnDupe}">                                            <TextBlock Text="{Binding entity Converter=getFavoriteDescription}" />                                        <\/div>                                    <\/div>                                <\/a>                                <hr class="collectionSeparator" />                            <\/li>                        <\/DataTemplate>                    <\/ItemsControl.ItemTemplate>                <\/ItemsControl>            <\/div>        <\/ul>    <\/div>    <div class="errorMessage" style:display="{Binding error Converter=errorToDisplay}">        <TextBlock Text="{Binding resources.L_FavoriteErrorMessage_Text}" />    <\/div><\/div>',yi='<div class="isText showText favoritesPrint" data-tag="favoritesPrint">    <div class="graphFavorites" data-tag="graphFavorites">        <div class="HomeWorkSection">            <div class="homeWorkContainer">                <div class="homeContainer" data-tag="HomeContainer" data-entityid="{Binding Home.entity.Businesslistingid}" style:display="{Binding Home Converter=nullToDisplayNone}">                    <img class="homeImage" src="{Binding Home.entity Converter=setHomePrintSrc}" alt="" />                    <div class="homeTextContainer">                        <div class="homeTitle" data-tag="homeTitle">                            <TextBlock Text="{Binding resources.L_HomeFavorite_Text}" />                        <\/div>                        <div class="favoriteItemNonTitle" data-tag="homeOriginalName">                            <TextBlock Text="{Binding Home.entity.OriginalName Converter=getHomeOriginalName}" />                        <\/div>                        <div class="favoriteItemNonTitle" data-tag="homeAddress" style:display="{Binding home.entity.Businesslistingid Converter=showHomeWorkAddress}">                            <TextBlock Text="Home.entity.Address" />                        <\/div>                        <div class="favoriteItemNonTitle" data-tag="homeDescription" style:display="{Binding home.entity.Businesslistingid Converter=hideHomeWorkDescription}">                            <TextBlock Text="{Binding Home.entity.Description Converter=getHomeDescription}" />                        <\/div>                    <\/div>                <\/div>                <div class="workContainer" data-tag="WorkContainer" data-entityid="{Binding Work.entity.Businesslistingid}" style:display="{Binding Home Converter=nullToDisplayNone}">                    <img class="workImage" src="{Binding Work.entity Converter=setWorkPrintSrc}" alt=""/>                    <div class="workTextContainer">                        <div class="workTitle" data-tag="workTitle">                            <TextBlock Text="{Binding resources.L_WorkFavorite_Text}" />                        <\/div>                        <div class="favoriteItemNonTitle" data-tag="workOriginalName">                            <TextBlock Text="{Binding Work.entity.OriginalName Converter=getWorkOriginalName}" />                        <\/div>                        <div class="favoriteItemNonTitle" data-tag="workAddress" style:display="{Binding work.entity.Businesslistingid Converter=showHomeWorkAddress}">                            <TextBlock Text="{Binding Work.entity.Address Converter=getWorkAddress}" />                        <\/div>                        <div class="favoriteItemNonTitle" data-tag="workDescription" style:display="{Binding work.entity.Businesslistingid Converter=hideHomeWorkDescription}">                            <TextBlock Text="{Binding Work.entity.Description Converter=getWorkDescription}" />                        <\/div>                    <\/div>                <\/div>            <\/div>        <\/div>        <div class="favoritesList">            <div class="favoriteItemList" data-tag="favoriteItemList">                <ItemsControl ItemsSource="{Binding favorites}" panelTagName="ul">                    <ItemsControl.ItemTemplate>                        <DataTemplate>                            <li data-entityid="{Binding entity.Businesslistingid}">                                <a class="favoriteEntry" data-tag="favoriteEntry" data-entityid="{Binding entity.Businesslistingid}" role="none">                                    <div class="entityIcon">                                        <img class="iconImage" src="{Binding entity.iconSource}" alt=""/>                                        <span class="entityIconText">                                            <TextBlock Text="{Binding entity.iconText}" />                                        <\/span>                                    <\/div>                                    <div class="favoriteContainer">                                        <div class="favoriteItemHeader">                                            <div class="favoriteTitleContainer" data-tag="favoriteTitleContainer">                                                <TextBlock Text="{Binding entity Converter=getFavoriteTitle}" />                                            <\/div>                                        <\/div>                                        <div class="favoriteItemNonTitle" data-tag="favoriteOriginalNameContainer" style:display="{Binding entity Converter=noShowOnDupeName}">                                            <TextBlock Text="{Binding entity.OriginalName}" />                                        <\/div>                                        <div class="favoriteItemNonTitle" data-tag="favoriteAddressContainer" style:display="{Binding entity Converter=showAddress}">                                            <TextBlock Text="{Binding entity Converter=getFavoriteAddress}" />                                        <\/div>                                        <div class="favoriteItemNonTitle" data-tag="favoriteDescriptionContainer" style:display="{Binding entity Converter=noShowPrintDupe}">                                            <TextBlock Text="{Binding entity Converter=getFavoriteDescription}" />                                        <\/div>                                    <\/div>                                <\/a>                            <\/li>                        <\/DataTemplate>                    <\/ItemsControl.ItemTemplate>                <\/ItemsControl>            <\/div>        <\/div>    <\/div><\/div>',kr='<div class="CollectionsPanelRoot" event:touchmove="onTouchScroll">    <div id="collectionsPanelRoot" data-tag="collectionsPanelRoot">        <ul  class="itineraryList refresh" data-tag="itinerariesList">            <ItemsControl ItemsSource="{Binding Itineraries}">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <li>                            <a class="itineraryEntry" data-tag="itineraryEntry" data-collectionid="{Binding collectionId}" value="{Binding name}" href="#" event:click="onItineraryClick">                                <img class="itineraryImage" src="{Binding Image Converter=setItineraryImage}" />                                <div class="itineraryTitleContainer">                                    <span class="entryTitle" data-tag="entryTitle">                                        <TextBlock Text="{Binding Name}" />                                    <\/span>                                <\/div>                                <div class="itineraryDescriptionContainer" style:display="{Binding Description Converter=nullToDisplayNone}">                                    <span class="itineraryDescriptionPreview" data-tag="itineraryDescriptionPreview">                                        <TextBlock Text="{Binding Description}" />                                    <\/span>                                <\/div>                                <div class="itinerarySummaryContainer">                                    <span><TextBlock Text="{Binding DayCount Converter=displayItineraryDayCount}" /><\/span>                                    <span><TextBlock Text="{Binding AttractionCount Converter=displayItineraryAttractionCount}" /><\/span>                                <\/div>                            <\/a>                        <\/li>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/ul>    <\/div>    <div class="emptyItinerariesMessage" style:display="{Binding Itineraries.length Converter=emptyItinerariesToDisplay}">        <div class="emptyItinerarySuggestion">            <TextBlock Text="{StaticBinding resources.L_EmptyItinerariesMessage}" />        <\/div>    <\/div><\/div>',dr='<div class="CollectionsPanelRoot" event:touchmove="onTouchScroll">    <div id="itinerariesPanelRoot" data-tag="collectionsPanelRoot">        <ul class="itineraryList refresh" data-tag="itinerariesList">            <li style:display="{Binding NewItineraryEnabled Converter=boolToDisplay}">                <a class="itineraryAdd" data-tag="itineraryAdd" href="#" event:click="onItineraryAddClick">                    <div class="itinContents">                        <div class="itineraryImageContainer">                            <div class="itineraryImagePlaceholder"><\/div>                        <\/div>                        <div class="itinDetails">                            <div class="itinTitle">                                <TextBlock Text="{Binding resources.L_AddItinerary_Text}" />                            <\/div>                            <div class="itinDescription">                                <TextBlock Text="{Binding resources.L_AddItinerary_Description}" />                            <\/div>                        <\/div>                    <\/div>                <\/a>            <\/li>            <li>                <hr class="collectionSeparator" style:display="{Binding NewItineraryEnabled Converter=boolToDisplay}" />            <\/li>            <li>                <ItemsControl ItemsSource="{Binding Itineraries}" panelTagName="ul">                    <ItemsControl.ItemTemplate>                        <DataTemplate>                            <li>                                <a class="itineraryEntry" data-tag="itineraryEntry" data-entityid="{Binding collectionId}" value="{Binding name}" href="#" event:click="onItineraryClick" event:keydown="onItineraryKeyDown">                                    <div class="itinContents">                                        <div>                                            <img class="itineraryImage" src="{Binding Image Converter=setItineraryImage}" alt="" />                                        <\/div>                                        <div class="itinDetails">                                            <div class="itinTitle">                                                <TextBlock Text="{Binding Name}" />                                            <\/div>                                            <div class="itinDescription" style:display="{Binding Description Converter=nullToDisplayNone}">                                                <TextBlock Text="{Binding Description}" />                                            <\/div>                                            <div class="itinerarySummaryContainer">                                                <span><TextBlock Text="{Binding DayCount Converter=displayItineraryDayCount}" /><\/span>                                                <span><TextBlock Text="{Binding AttractionCount Converter=displayItineraryAttractionCount}" /><\/span>                                            <\/div>                                        <\/div>                                        <a class="bm_deleteItem" data-entityid="{Binding collectionId}" data-tag="deleteItem" title="{StaticBinding resources.L_DeleteItinerary_ToolTip}" event:click="onDeleteClick" href="#"><\/a>                                    <\/div>                                    <div class="cardDeleteConfirmationRow" data-tag="deleteConfirmationRow" data-entityid="{Binding collectionId}">                                        <div class="deleteConfirmationText">                                            <TextBlock Text="{StaticBinding resources.L_ItineraryDeleteConfirmationMessage}" />                                        <\/div>                                        <span class="cardDeleteConfirmationButtonContainer">                                            <a class="commonButtonControl cancelDeleteButton" data-tag="cancelDelete" event:click="onCancelDeleteClick" href="#">                                                <TextBlock Text="{StaticBinding resources.L_CancelButton_Text}" />                                            <\/a>                                            <a class="commonButtonControl highlighted confirmDeleteButton" data-tag="confirmDelete" event:click="onConfirmDeleteClick" href="#">                                                <TextBlock Text="{StaticBinding resources.L_TemporaryCollectionRemoveButton}" />                                            <\/a>                                        <\/span>                                    <\/div>                                <\/a>                            <\/li>                        <\/DataTemplate>                    <\/ItemsControl.ItemTemplate>                <\/ItemsControl>            <\/li>        <\/ul>    <\/div>    <div class="collectionProgress MicrosoftMap_progress" style:display="{Binding ShowProgress Converter=boolToDisplay}" style:visibility="{Binding ShowProgress Converter=boolToVisibility}">    <\/div>    <div style:display="{Binding signInState.IsSignedIn Converter=boolToDisplay}">        <div class="emptyItinerariesMessage" style:display="{Binding Itineraries.length Converter=emptyItinerariesToDisplay}">            <div class="emptyItinerarySuggestion">                <TextBlock Text="{StaticBinding resources.L_EmptyItinerariesMessage}" />            <\/div>            <div class="emptyItineraryExample">                <span>                    <TextBlock Text="{StaticBinding resources.L_EmptyItinerariesSearchLink1}" />                <\/span>                <a class="itinerarylink" event:click="onItineraryLinkClick" href="#">                    <TextBlock Text="{StaticBinding resources.L_EmptyItinerariesSearchLink2}" />                <\/a>                <span>                    <TextBlock Text="{StaticBinding resources.L_EmptyItinerariesSearchLink3}" />                <\/span>            <\/div>        <\/div>        <div class="placesMessage" style:display="{Binding MessageText Converter=nullToDisplayNone}" data-tag="placesMessage" role="alert">            <TextBlock Text="{Binding MessageText}" />        <\/div>    <\/div>    <div class="signInBlock" style:display="{Binding signInState.IsSignedIn Converter=displaySignIn}">        <a event:click="onSignInClick" href="#" class="commonButtonControl highlighted signInAndSaveButton" data-tag="validateSignIn">            <TextBlock Text="{Binding resources.L_SignInButton_Text}" />        <\/a>    <\/div><\/div>',gr='<div class="measureTaskRoot" data-tag="measureTaskRoot">    <div class="instruct" style:display="{Binding Instructions Converter=nullToDisplayNone}" data-tag="measureInstructions">        <TextBlock Text="{Binding Instructions}" />    <\/div>    <div class="perimeter" style:display="{Binding Perimeter Converter=nullToDisplayNone}" data-tag="measurePerimeter">        <TextBlock Text="{Binding Perimeter}" />    <\/div>    <div class="area" style:display="{Binding Area Converter=nullToDisplayNone}" data-tag="measureArea">        <TextBlock Text="{Binding Area}" />    <\/div>    <div class="actions">        <ul>            <li><a href="#" event:click="onNewClick" title="{Binding resources.L_MeasureMapTask_NewLink_Title}"><TextBlock Text="{Binding resources.L_MeasureMapTask_NewLink_Text}" /><\/a><\/li>            <li><a href="#" event:click="onDoneClick" title="{Binding resources.L_MeasureMapTask_DoneLink_Title}" style:display="{Binding ShowDoneLink Converter=boolToDisplay}"><TextBlock Text="{Binding resources.L_MeasureMapTask_DoneLink_Text}" /><\/a><\/li>            <li><a href="#" event:click="onEditClick" title="{Binding resources.L_MeasureMapTask_EditLink_Title}" style:display="{Binding ShowEditLink Converter=boolToDisplay}"><TextBlock Text="{Binding resources.L_MeasureMapTask_EditLink_Text}" /><\/a><\/li>            <li><a href="#" event:click="onAreaClick" title="{Binding resources.L_MeasureMapTask_AreaLink_Title}" style:display="{Binding ShowAreaLink Converter=boolToDisplay}"><TextBlock Text="{Binding resources.L_MeasureMapTask_AreaLink_Text}" /><\/a><\/li>        <\/ul>    <\/div><\/div>',nu='<div class="myPlacesMobileHeader">    <div class="signInBlock" style:display="{Binding IsSignedIn Converter=boolToNotDisplay}">        <div class="mobileSignInText">            <TextBlock Text="{Binding signInButtonText}" />        <\/div>        <a class="mobileSignInButton textbutton" event:click="onSignInButtonClick" href="#">            <TextBlock Text="{Binding resources.L_SignInButton_Text}" />        <\/a>    <\/div><\/div>',pi='ï»¿<div class="myPlacesPrintPanel" data-tag="myPlacesPrintPanel">    <table>        <tr>            <td class="textColumn" data-tag="textColumn">                <Tab TabContent="{Binding entitiesPrintViewModel}" TabTemplate="{Binding entitiesPrintTemplate}" IsDisplayed="true"><\/Tab>            <\/td>            <td class="noteColumn">                <div class="printNotes collectionPrintNotes">                    <div class="searchNotesTableData screenNotes">                        <textarea class="myplacesNotes" placeholder="{Binding resources.L_PrintNotes_Watermark}" aria-label="{Binding resources.L_PrintNotes_Watermark}" maxlength="{Binding notesMaxCharSize}" data-tag="printNotes" />                    <\/div>                    <div class="printedNotes">                    <\/div>                <\/div>            <\/td>        <\/tr>    <\/table>    <div>    <\/div>    <div class="myPlacesMapPrint isMap showMap taskMapPrintPageBreak" data-tag="MyPlacesMapPrint">        <div class="printArea" data-tag="printArea">            <div class="printMap" data-tag="printMap">            <\/div>        <\/div>    <\/div><\/div>',tu='<div class="CollectionsPanelRoot oneMap cardified" data-tag="collectionsPanelRoot">    <div class="collectionsCard">        <div id="AddCollectionRoot" class="addCollectionRoot" data-tag="addCollectionRoot">            <div class="backButtonContainer">                <a class="collectionBack commonButton backArrowButton" data-tag="collectionBack" title="{Binding resources.L_MyPlaces_Title}" style:display="{Binding ShowBackButton Converter=boolToDisplay}" event:click="onEditCancelClick" href="#">                    <TextBlock Text="{Binding UseDetailsBackText Converter=useCorrectBackText}" />                <\/a>            <\/div>            <div class="addCollectionTitle">                <TextBlock Text="{Binding resources.L_AddCollection_Text}" />            <\/div>            <div class="addCollectionControlBlock">                <div class="collectionControlHeader" id="nameLabel">                    <TextBlock Text="{Binding resources.L_NewCollectionName_Text}" />                <\/div>                <div class="collectionControl nameControl">                    <textarea class="addNameControl" placeholder="{Binding resources.L_NewCollectionName_Watermark}" data-tag="nameControl" rows="1" maxlength="100" value="{Binding newTitle Mode=TwoWay}" aria-labelledby="nameLabel"><\/textarea>                <\/div>                <div class="collectionControlHeader" id="descriptionLabel">                    <TextBlock Text="{Binding resources.L_NewCollectionDescription_Text}" />                <\/div>                <div class="collectionControl descriptionControl">                    <textarea class="addDescriptionControl" placeholder="{Binding resources.L_NewCollectionDescription_Watermark}" data-tag="descriptionControl" rows="4" maxlength="1000" value="{Binding newDescription Mode=TwoWay}" aria-labelledby="descriptionLabel"><\/textarea>                <\/div>                <div class="collectionControl privacyControl refresh">                    <a class="collectionActions" data-tag="privacyButton" title="{Binding IsPublic Converter=privacyToTooltip}" role="button" aria-pressed="{Binding IsPublic Converter=setPressedState}" event:click="onPrivacyClick" href="#">                        <span class="{Binding IsPublic Converter=privacyButtonClass}"><\/span>                    <\/a>                    <div class="collectionPrivacyMessage">                        <TextBlock Text="{Binding IsPublic Converter=privacyToDisclaimer}" />                    <\/div>                <\/div>            <\/div>        <\/div>        <div id="actionsDiv" class="addCollectionsButtons" data-tag="collectionsFooter">            <div style:display="{Binding signInState.IsSignedIn Converter=displaySave}">                <a event:click="onEditSaveClick" href="#" class="commonButtonControl highlighted createButton" data-tag="validateCreate" role="button">                    <TextBlock Text="{Binding resources.L_CreateButton_Text}" />                <\/a>            <\/div>            <div style:display="{Binding signInState.IsSignedIn Converter=displaySignIn}">                <a event:click="onSignInAndSaveClick" href="#" class="commonButtonControl highlighted signInAndSaveButton" data-tag="validateSignIn" role="button">                    <TextBlock Text="{Binding resources.SignInAndSaveButton}" />                <\/a>            <\/div>        <\/div>        <div class="collectionProgress MicrosoftMap_progress" style:display="{Binding ShowProgress Converter=boolToDisplay}"><\/div>        <div class="placesMessage" style:display="{Binding MessageText Converter=nullToDisplayNone}" data-tag="placesMessage" role="alert">            <TextBlock Text="{Binding MessageText}" />        <\/div>    <\/div><\/div>',iu='<div class="CollectionsPanelRoot oneMap cardified" data-tag="collectionsPanelRoot">    <div class="collectionsCard">        <div class="addHomeWork" data-tag="addHomeWork">            <div class="backButtonContainer">                <a class="collectionBack backArrowButton" data-tag="collectionBack" title="{Binding resources.L_MyPlaces_Title}" event:click="onBackClick" href="#">                    <TextBlock Text="{Binding resources.L_MyPlaces_Title}" />                <\/a>            <\/div>            <div class="addHomeWorkControlBlock" data-tag="collectionSearchboxContainer">                <div class="collectionControlHeader">                    <TextBlock Text="{Binding ViewText}" />                <\/div>                <div class="collectionControl homeWorkSearchbox" data-tag="searchboxInputContainer">                    <WatermarkedTextInput Watermark="" Value="{Binding inputText Mode=TwoWay}" MaxLength="1000" />                <\/div>                <div class="collectionControlHeader" id="noteLabel">                    <TextBlock Text="{Binding resources.L_NoteLabel_Text}" />                <\/div>                <div class="collectionControl" data-tag="descriptionInputContainer">                    <textarea class="editHomeWorkDescriptionControl" placeholder="{StaticBinding resources.L_PlaceDescriptionEditSuggestion_Text}" data-fieldid="editHomeWorkDescriptionControl" data-tag="editHomeWorkDescriptionControl" contenteditable="true" rows="2" maxlength="200" event:blur="onDescriptionBlur" event:click="onDescriptionClick" aria-labelledby="noteLabel"/>                <\/div>            <\/div>            <div class="addHomeWorkActionsContainer">                <div class="showOnMapCheckbox">                    <a class="checkboxItem" data-tag="showOnMapCheckbox" role="checkbox" aria-checked="{Binding ShowOnMap Converter=SetIsChecked}" event:click="onShowOnMapClick" href="#">                        <span class="{Binding ShowOnMap Converter=itemCheckedClass}"><\/span>                        <span class="itemName">                            <TextBlock Text="{Binding resources.L_ShowHomeWorkCheckbox}" />                        <\/span>                    <\/a>                <\/div>                <div class="addHomeWorkButtons">                    <a class="secondaryButton addHomeWorkButton" role="button" style:display="{Binding inputText Converter=inputTextToHideButton}" data-tag="searchHomeWorkButton" title="{Binding resources.L_AddHomeWorkSearch_Button}" event:click="onSearchButtonClick" href="#">                        <TextBlock Text="{Binding resources.L_AddHomeWorkSearch_Button}" />                    <\/a>                    <div style:display="{Binding signInState.IsSignedIn Converter=boolToDisplay}">                        <a class="secondaryButton addHomeWorkButton" role="button" style:display="{Binding inputText Converter=inputTextToShowButton}" data-tag="addHomeWorkButton" title="{Binding IsAdd Converter=addEditButtonText}" event:click="onAddButtonClick" href="#">                            <TextBlock Text="{Binding IsAdd Converter=addEditButtonText}" />                        <\/a>                    <\/div>                <\/div>            <\/div>        <\/div>    <\/div>    <div class="collectionProgress MicrosoftMap_progress" data-tag="collectionProgress" style:display="{Binding ShowProgress Converter=boolToDisplay}"><\/div>    <div class="placesMessage" data-tag="placesMessage" style:display="{Binding MessageText Converter=nullToDisplayNone}" role="alert">        <TextBlock Text="{Binding MessageText}" />    <\/div>    <div style:display="{Binding inputText Converter=inputTextToShowButton}">        <div class="signInBlock" style:display="{Binding signInState.IsSignedIn Converter=displaySignIn}">            <a event:click="onSignInAndSaveClick" href="#" role="button" class="commonButtonControl highlighted signInAndSaveButton" data-tag="validateSignIn">                <TextBlock Text="{Binding resources.SignInAndSaveButton}" />            <\/a>        <\/div>    <\/div>    <div class="searchboxWithAS favoritesAS" data-tag="favoritesAS" style:display="{Binding ShowAutoSuggest Converter=boolToDisplay}">    <\/div><\/div>',ru='<div class="CollectionsPanelRoot oneMap" event:touchmove="onTouchScroll">    <div id="collectionsPanelRoot" data-tag="collectionsPanelRoot">        <div class="viewingPane" data-tag="viewingPane" style:display="{Binding signInState.IsSignedIn Converter=shouldDisplayTab}">            <ul id="collectionsList" class="collectionList refresh" data-tag="collectionsList">                <li>                    <a class="collectionAdd" data-tag="addCollection" href="#" event:click="onCollectionAddClick">                        <div class="collectionContents">                            <div class="collectionImageContainer">                                <div class="collectionImagePlaceholder"><\/div>                            <\/div>                            <div class="collectionDetails">                                <div class="collectionListTitle">                                    <TextBlock Text="{Binding resources.L_AddCollection_Text}" />                                <\/div>                                <div class="collectionListDescription">                                    <TextBlock Text="{Binding resources.L_AddCollection_Description}" />                                <\/div>                            <\/div>                        <\/div>                    <\/a>                <\/li>                <li>                    <hr class="collectionSeparator" />                <\/li>                <li>                    <a class="collectionEntry" data-tag="temporaryCollectionEntry" id="TEMP" value="Temporary Collection" href="#" event:click="onTemporaryCollectionClick" event:keydown="onTemporaryCollectionKeyDown">                        <div class="collectionContents">                            <div class="collectionDetails">                                <div class="collectionListTitle" data-tag="entryTitle">                                    <TextBlock Text="{Binding resources.L_TemporaryCollectionTitle}" />                                <\/div>                                <div class="collectionListDescription">                                    <TextBlock Text="{Binding resources.L_TemporaryCollectionDescription}" />                                <\/div>                                <div class="collectionListSummary">                                    <TextBlock Text="{Binding TempItemCount Converter=displayCountText}" />                                <\/div>                            <\/div>                        <\/div>                    <\/a>                <\/li>                <li data-tag="fullCollectionsList">                    <ItemsControl ItemsSource="{Binding MyPlaces.collections}" panelTagName="ul">                        <ItemsControl.ItemTemplate>                            <DataTemplate>                                <li class="collectionsListItem">                                    <a class="collectionEntry" data-tag="collectionEntry" id="{Binding id}" value="{Binding name}" href="#" event:click="onCollectionClick" event:keydown="onCollectionKeyDown">                                        <div class="collectionContents">                                            <div class="collectionDetails">                                                <div class="collectionListTitle" data-tag="entryTitle">                                                    <TextBlock Text="{Binding name}" />                                                <\/div>                                                <div class="collectionListDescription" style:display="{Binding description Converter=nullToDisplayNone}">                                                    <TextBlock Text="{Binding description}" />                                                <\/div>                                                <div class="collectionListSummary">                                                    <TextBlock Text="{Binding ItemCount Converter=displayCountText}" />                                                <\/div>                                            <\/div>                                            <a class="bm_deleteItem" data-entityid="{Binding id}" data-tag="deleteItem" title="{StaticBinding resources.L_DeleteCollection_ToolTip}" event:click="onDeleteClick" event:mouseover="onDeleteHover" href="#"><\/a>                                        <\/div>                                        <div class="cardDeleteConfirmationRow" data-tag="deleteConfirmationRow" data-entityid="{Binding id}">                                            <div class="deleteConfirmationText">                                                <TextBlock Text="{StaticBinding resources.L_CollectionsListDeleteConfirmationMessage}" />                                            <\/div>                                            <span class="cardDeleteConfirmationButtonContainer">                                                <a class="commonButtonControl cancelDeleteButton" data-tag="cancelDelete" event:click="onCancelDeleteClick" href="#">                                                    <TextBlock Text="{StaticBinding resources.L_CancelButton_Text}" />                                                <\/a>                                                <a class="commonButtonControl highlighted confirmDeleteButton" data-tag="confirmDelete" event:click="onConfirmDeleteClick" href="#">                                                    <TextBlock Text="{StaticBinding resources.L_TemporaryCollectionRemoveButton}" />                                                <\/a>                                            <\/span>                                        <\/div>                                    <\/a>                                <\/li>                            <\/DataTemplate>                        <\/ItemsControl.ItemTemplate>                    <\/ItemsControl>                <\/li>            <\/ul>        <\/div>    <\/div>    <div class="collectionProgress MicrosoftMap_progress" style:display="{Binding ShowProgress Converter=boolToDisplay}" style:visibility="{Binding ShowProgress Converter=boolToVisibility}">    <\/div>    <div style:display="{Binding signInState.IsSignedIn Converter=boolToDisplay}">        <div class="placesMessage" style:display="{Binding MessageText Converter=nullToDisplayNone}" data-tag="placesMessage" role="alert">            <TextBlock Text="{Binding MessageText}" />        <\/div>    <\/div>    <div class="signInBlock collectionsTab" style:display="{Binding signInState.IsSignedIn Converter=displaySignIn}">        <a event:click="onSignInClick" href="#" class="commonButtonControl highlighted signInAndSaveButton" data-tag="validateSignIn">            <TextBlock Text="{Binding resources.L_SignInButton_Text}" />        <\/a>    <\/div><\/div>',uu='<div class="CollectionsPanelRoot oneMap cardified" id="collectionsPanelRoot" data-tag="collectionsPanelRoot">    <div class="collectionsCard refresh" data-tag="collectionsTop">        <div class="collection" id="{Binding collection.id}">            <div class="collectionHeader" data-tag="collectionHeader">                <div class="backButtonContainer" style:display="{Binding State.action Converter=hideHeaderBlock}">                    <a class="collectionBack backArrowButton" data-tag="collectionBack" style:display="{Binding State.action Converter=hideBackButton}" event:click="onBackButtonClick" href="#">                        <TextBlock Text="{Binding UseDetailsBackText Converter=useCorrectBackText}" />                    <\/a>                <\/div>                <div class="collectionHeaderContent" style:display="{Binding IsNoResponse Converter=boolToNotDisplay}">                    <div style:display="{Binding TitleEdit Converter=boolToNotDisplay}">                        <div class="privacyConfirmation popOutTop" data-tag="privacyConfirmation" style:display="{Binding ShowPrivacyConfirmation Converter=boolToDisplay}">                            <div class="privacyConfirmationText">                                <TextBlock Text="{Binding ConfirmationMessage}" />                            <\/div>                        <\/div>                        <div class="collectionPanelTitle cardTitle" data-tag="collectionPanelTitle" id="collectionTitleText">                            <TextBlock Text="{Binding collection.name}" />                        <\/div>                        <div class="collectionDescription" style:display="{Binding collection.description Converter=nullToDisplayNone}" data-tag="collectionDescription" id="collectionDescriptionText">                            <TextBlock Text="{Binding collection.description Converter=displayDescription}" />                        <\/div>                        <div class="collectionTitleButtons" style:display="{StaticBinding State.action Converter=hideEditActions}">                            <a class="collectionActions edit" data-tag="annotateButton" title="{Binding resources.L_CollectionEditButton_ToolTip}" event:click="onEditTitleClick" href="#">                                <span class="annotateButton"><\/span>                            <\/a>                            <a class="collectionActions" data-tag="privacyButton" title="{Binding IsPublic Converter=privacyToTooltip}" event:click="onPrivacyClick" href="#">                                <span class="{Binding IsPublic Converter=privacyButtonClass}"><\/span>                            <\/a>                        <\/div>                        <div class="actionsDivHeader" data-tag="actionHeader" style:display="{Binding collection.primitives.length Converter=emptyCollectionToNotDisplay}">                            <Button ButtonText="{Binding resources.L_CollectionDirectionButton_Text}" ButtonIcon="oneMapDirectionsIcon" ButtonClass="getDirectionsButton" event:click="onRouteAllClick" hoverText="{Binding resources.L_CollectionDirectionButton_ToolTip}" />                            <Button ButtonText="{Binding resources.L_CollectionShareButton_Text}" ButtonIcon="oneMapShareIcon" ButtonClass="collectionShareButton" event:click="onShareButtonClick" hoverText="{Binding resources.L_CollectionShareButton_ToolTip}" />                        <\/div>                        <div class="seeAllBlock" style:display="{Binding collection.primitives.length Converter=displaySeeAll}">                            <a class="seeAllButton" href="#" data-tag="seeAllButton" event:click="onSeeAllClick">                                <TextBlock Text="{Binding resources.L_SeeAllButton}" />                            <\/a>                        <\/div>                    <\/div>                <\/div>            <\/div>            <div class="titleEditEntryRow" data-tag="titleEditEntryRow" style:display="{Binding TitleEdit Converter=boolToDisplay}">                <input type="text" class="nameEditBox" data-tag="nameEditBox" maxlength="100" value="{StaticBinding TempName Mode=TwoWay}" />                <div class="titleEditSpacing"><\/div>                <textarea class="descriptionEditBox" data-tag="descriptionEditBox" placeholder="{Binding resources.L_NewCollectionDescription_Watermark}" contenteditable="true" rows="4" maxlength="1000" value="{StaticBinding TempDescription Mode=TwoWay}"><\/textarea>                <span class="editRowButtonContainer">                    <a class="cancelEditButton commonButtonControl" data-tag="cancelEdit" event:click="onCancelTitleEditClick" href="#">                        <TextBlock Text="{StaticBinding resources.L_CancelButton_Text}" />                    <\/a>                    <a class="confirmEditButton commonButtonControl" data-tag="confirmEdit" event:click="onConfirmTitleEditClick" href="#">                        <TextBlock Text="{StaticBinding resources.L_EditSaveButton}" />                    <\/a>                <\/span>            <\/div>            <hr class="collectionSeparator" />            <div class="collectionItemList" data-tag="entitiesList">                <div style:display="{Binding IsNoResponse Converter=boolToNotDisplay}">                    <div class="collectionEmpty" style:display="{Binding collection.primitives.length Converter=emptyCollectionToDisplay}">                        <TextBlock Text="{Binding State Converter=emptyMessage}" />                    <\/div>                <\/div>                <DraggableList ItemsSource="{Binding collection.primitives}" gripClass="{Binding collection.primitives.length Converter=displayDragGrip}" event:onDragComplete="onDragComplete" event:onDragBegin="onDragBegin" tooltip="{StaticBinding resources.L_DragToolTip_Text}" useWholeDrag="true">                    <DraggableList.ItemTemplate>                        <DataTemplate>                            <div class="collectionEntityRow" ordinal="{Binding entity.displayOrder}" data-entityid="{Binding entity.id}" event:mouseover="onCollectionItemHover" event:mouseout="onCollectionItemHover" event:contextmenu="onContextMenu">                                <a class="collectionEntity" data-tag="collectionItem" data-entityid="{Binding entity.id}" event:click="onCollectionItemClick" data-task="{Binding $self$ Converter=buildDataTaskAttributeFromPrimitive}" href="#">                                    <div class="collectionEntityContents">                                        <div class="collectionEntityImageContainer">                                            <div class="collectionEntityImagePlaceholder" style:display="{Binding entity.photoUrl Converter=nullToDisplay}"><\/div>                                            <img class="collectionEntityImage" src="{Binding entity.photoUrl Converter=convertPhotoUrlToSource}" event:error="handleImageErrorEvent" event:load="onImageLoad" style:display="{Binding entity.photoUrl Converter=nullToDisplayNone}" alt=""/>                                        <\/div>                                        <div class="collectionEntityDetails">                                            <div class="collectionEntityTitle" data-tag="collectionItemTitle" ordinal="{Binding entity.displayOrder}">                                                <TextBlock Text="{Binding entity.name}" />                                            <\/div>                                            <div class="collectionEntityOriginalName" data-tag="collectionItemOriginalName" style:display="{Binding entity Converter=noShowOnDupeName}">                                                <TextBlock Text="{Binding entity.originalName}" />                                            <\/div>                                            <div class="collectionEntityAddress" data-tag="collectionItemAddress" style:display="{Binding entity Converter=showAddress}">                                                <TextBlock Text="{Binding entity Converter=setAddressText}" />                                            <\/div>                                            <div class="collectionEntityDescription" data-tag="collectionItemDescription" style:display="{Binding entity Converter=noShowOnDupeDescription}">                                                <TextBlock Text="{Binding entity Converter=showDescription}" />                                            <\/div>                                        <\/div>                                        <a class="bm_deleteItem" data-entityid="{Binding entity.id}" data-tag="deleteItem" title="{StaticBinding resources.L_RemoveEntity_ToolTip}" event:click="onDeleteClick" event:mouseover="onDeleteHover" href="#" style:display="{StaticBinding State.action Converter=hideEditButton}"><\/a>                                        <a class="bm_contextMenuButton" data-entityid="{Binding entity.id}" data-tag="contextMenuButton" title="{StaticBinding resources.L_ContextMenu_ToolTip}" event:click="onContextMenu" event:mouseover="onDeleteHover" href="#"><\/a>                                    <\/div>                                    <div class="cardDeleteConfirmationRow" data-tag="deleteConfirmationRow" data-entityid="{Binding entity.id}">                                        <div class="deleteConfirmationText">                                            <TextBlock Text="{StaticBinding resources.L_TemporaryCollectionDeleteConfirmationMessage}" />                                        <\/div>                                        <span class="cardDeleteConfirmationButtonContainer">                                            <a class="commonButtonControl cancelDeleteButton" data-tag="cancelDelete" event:click="onCancelDeleteClick" href="#">                                                <TextBlock Text="{StaticBinding resources.L_CancelButton_Text}" />                                            <\/a>                                            <a class="commonButtonControl highlighted confirmDeleteButton" data-tag="confirmDelete" event:click="onConfirmDeleteClick" href="#">                                                <TextBlock Text="{StaticBinding resources.L_TemporaryCollectionRemoveButton}" />                                            <\/a>                                        <\/span>                                    <\/div>                                    <div class="editEntryRow" data-tag="editEntryRow" data-entityid="{Binding entity.id}">                                        <div class="editNicknameText">                                            <TextBlock Text="{StaticBinding resources.L_NicknameTitle}" />                                        <\/div>                                        <input type="text" class="nameEditBox" data-tag="nameEditBox" maxlength="100" value="{StaticBinding TempName Mode=TwoWay}" event:keydown="onKeyPressName" />                                        <div class="editDescriptionText">                                            <TextBlock Text="{StaticBinding resources.L_DescriptionTitle}" />                                        <\/div>                                        <textarea class="descriptionEditBox" data-tag="descriptionEditBox" contenteditable="true" rows="4" maxlength="1000" value="{StaticBinding TempDescription Mode=TwoWay}" event:keydown="onKeyPressNote"><\/textarea>                                        <span class="editRowButtonContainer">                                            <a class="cancelEditButton commonButtonControl" data-tag="cancelEdit" event:click="onCancelEditClick" href="#">                                                <TextBlock Text="{StaticBinding resources.L_CancelButton_Text}" />                                            <\/a>                                            <a class="confirmEditButton commonButtonControl" data-tag="confirmEdit" event:click="onConfirmEditClick" href="#">                                                <TextBlock Text="{StaticBinding resources.L_EditSaveButton}" />                                            <\/a>                                        <\/span>                                    <\/div>                                <\/a>                            <\/div>                        <\/DataTemplate>                    <\/DraggableList.ItemTemplate>                <\/DraggableList>            <\/div>        <\/div>        <div class="collectionProgress MicrosoftMap_progress" style:display="{Binding ShowProgress Converter=boolToDisplay}" style:visibility="{Binding ShowProgress Converter=boolToVisibility}"><\/div>        <div class="placesMessage" style:display="{Binding MessageText Converter=nullToDisplayNone}" data-tag="placesMessage" role="alert">            <TextBlock Text="{Binding MessageText}" />        <\/div>    <\/div><\/div>',fu='<div class="CollectionsPanelRoot oneMap" event:touchmove="onTouchScroll">    <div id="favoritesPanelRoot" data-tag="collectionsPanelRoot">        <div style:display="{Binding signedOutEnabled Converter=boolToNotDisplay}">            <SignInPopUpControl SignInMessage="{Binding resources.L_SignIn_Text}" />        <\/div>        <div class="viewingPane" data-tag="viewingPane" style:display="{Binding signInState.IsSignedIn Converter=shouldDisplayTab}">            <div class="favoritesList" data-tag="graphFavorites">                <div class="homeWorkContainer">                    <a class="homeContainer" data-tag="HomeContainer" data-entityid="{Binding Home.entity.Businesslistingid}" event:click="onHomeClick" href="#">                        <div class="homeContents">                            <div class="homeImageContainer">                                <div class="homeImagePlaceholder" style:display="{Binding Home.entity.PhotoUrl Converter=nullToDisplay}"><\/div>                                <img class="homeImage" alt="" src="{Binding Home.entity Converter=setHomePhotoSrc}" event:load="onImageLoad" style:display="{Binding Home.entity.PhotoUrl Converter=nullToDisplayNone}" alt="" />                            <\/div>                            <div class="homeDetails">                                <div class="homeTitle" data-tag="homeTitle">                                    <TextBlock Text="{StaticBinding resources.L_HomeFavorite_Text}" />                                <\/div>                                <div class="homeOriginalName" data-tag="homeOriginalName">                                    <TextBlock Text="{Binding Home.entity.OriginalName Converter=getHomeOriginalName}" />                                <\/div>                                <div class="homeAddress" data-tag="homeAddress" style:display="{Binding home.entity.Businesslistingid Converter=showHomeWorkAddress}">                                    <TextBlock Text="{Binding Home.entity.Address Converter=getHomeAddress}" />                                <\/div>                                <div class="homeDescription" data-tag="homeDescription" style:display="{Binding home.entity.Businesslistingid Converter=hideHomeWorkDescription}">                                    <TextBlock Text="{Binding Home.entity.Description Converter=getHomeDescription}" />                                <\/div>                            <\/div>                            <a class="bm_deleteItem" data-tag="deleteHome" style:display="{Binding Home Converter=nullToDisplayNone}" title="{StaticBinding resources.L_DeleteHome_ToolTip}" event:click="onDeleteHomeClick" event:mouseover="onDeleteHover" href="#"><\/a>                            <a class="annotateButton" data-tag="editHome" style:display="{Binding Home Converter=showEditHomeWork}" title="{Binding resources.L_EditHomeText_ToolTip}" event:click="onHomeEditClick" event:mouseover="onDeleteHover" href="#"><\/a>                            <a class="{Binding contextMenuButtonClass}" data-entityid="{Binding Home.entity.Businesslistingid}" style:display="{Binding Home Converter=nullToDisplayNone}" data-tag="contextMenuButton" title="{StaticBinding resources.L_ContextMenu_ToolTip}" event:click="onContextMenu" event:mouseover="onDeleteHover" href="#"><\/a>                        <\/div>                        <div class="cardDeleteConfirmationRow" data-tag="deleteConfirmationRow" data-entityid="home">                            <div class="deleteConfirmationText">                                <TextBlock Text="{StaticBinding resources.L_TemporaryCollectionDeleteConfirmationMessage}" />                            <\/div>                            <span class="cardDeleteConfirmationButtonContainer">                                <a class="commonButtonControl cancelDeleteButton" data-tag="cancelDelete" event:click="onCancelDeleteClick" href="#">                                    <TextBlock Text="{StaticBinding resources.L_CancelButton_Text}" />                                <\/a>                                <a class="commonButtonControl highlighted confirmDeleteButton" data-tag="confirmDelete" event:click="onConfirmDeleteHomeClick" href="#">                                    <TextBlock Text="{StaticBinding resources.L_TemporaryCollectionRemoveButton}" />                                <\/a>                            <\/span>                        <\/div>                    <\/a>                    <a class="workContainer" data-tag="WorkContainer" data-entityid="{Binding Work.entity.Businesslistingid}" event:click="onWorkClick" href="#">                        <div class="workContents">                            <div class="workImageContainer">                                <div class="workImagePlaceholder" style:display="{Binding Work.entity.PhotoUrl Converter=nullToDisplay}"><\/div>                                <img class="workImage" alt="" src="{Binding Work.entity Converter=setWorkPhotoSrc}" event:load="onImageLoad" style:display="{Binding Work.entity.PhotoUrl Converter=nullToDisplayNone}" alt=""/>                            <\/div>                            <div class="workDetails">                                <div class="workTitle" data-tag="workTitle">                                    <TextBlock Text="{StaticBinding resources.L_WorkFavorite_Text}" />                                <\/div>                                <div class="workOriginalName" data-tag="workOriginalName">                                    <TextBlock Text="{Binding Work.entity.OriginalName Converter=getWorkOriginalName}" />                                <\/div>                                <div class="workAddress" data-tag="workAddress" style:display="{Binding work.entity.Businesslistingid Converter=showHomeWorkAddress}">                                    <TextBlock Text="{Binding Work.entity.Address Converter=getWorkAddress}" />                                <\/div>                                <div class="workDescription" data-tag="workDescription" style:display="{Binding work.entity.Businesslistingid Converter=hideHomeWorkDescription}">                                    <TextBlock Text="{Binding Work.entity.Description Converter=getWorkDescription}" />                                <\/div>                            <\/div>                            <a class="bm_deleteItem" data-tag="deleteWork" style:display="{Binding Work Converter=nullToDisplayNone}" title="{StaticBinding resources.L_DeleteWork_ToolTip}" event:click="onDeleteWorkClick" event:mouseover="onDeleteHover" href="#"><\/a>                            <a class="annotateButton" data-tag="editWork" style:display="{Binding Work Converter=showEditHomeWork}" title="{Binding resources.L_EditWorkText_ToolTip}" event:click="onWorkEditClick" event:mouseover="onDeleteHover" href="#"><\/a>                            <a class="{Binding contextMenuButtonClass}" data-entityid="{Binding Work.entity.Businesslistingid}" style:display="{Binding Work Converter=nullToDisplayNone}" data-tag="contextMenuButton" title="{StaticBinding resources.L_ContextMenu_ToolTip}" event:click="onContextMenu" event:mouseover="onDeleteHover" href="#"><\/a>                        <\/div>                        <div class="cardDeleteConfirmationRow" data-tag="deleteConfirmationRow" data-entityid="work">                            <div class="deleteConfirmationText">                                <TextBlock Text="{StaticBinding resources.L_TemporaryCollectionDeleteConfirmationMessage}" />                            <\/div>                            <span class="cardDeleteConfirmationButtonContainer">                                <a class="commonButtonControl cancelDeleteButton" data-tag="cancelDelete" event:click="onCancelDeleteClick" href="#">                                    <TextBlock Text="{StaticBinding resources.L_CancelButton_Text}" />                                <\/a>                                <a class="commonButtonControl highlighted confirmDeleteButton" data-tag="confirmDelete" event:click="onConfirmDeleteWorkClick" href="#">                                    <TextBlock Text="{StaticBinding resources.L_TemporaryCollectionRemoveButton}" />                                <\/a>                            <\/span>                        <\/div>                    <\/a>                <\/div>                <hr class="collectionSeparator" />                <div class="favoriteItemList" data-tag="favoriteItemList">                    <ItemsControl ItemsSource="{Binding Favorites}">                        <ItemsControl.ItemTemplate>                            <DataTemplate>                                <div class="bm_favoritesListItem" data-entityid="{Binding entity.Businesslistingid}" event:mouseover="onFavoriteItemHover" event:mouseout="onFavoriteItemHover" event:contextmenu="onContextMenu">                                    <a class="favoriteEntry" data-tag="favoriteEntry" data-task="{Binding entity Converter=buildDataTaskAttribute}" data-entityid="{Binding entity.Businesslistingid}" event:click="onFavoriteClick" href="#">                                        <div class="favoriteContents">                                            <div class="favoriteImageContainer">                                                <div class="favoriteImagePlaceholder" style:display="{Binding entity.PhotoUrl Converter=nullToDisplay}"><\/div>                                                <img class="favoriteImage" alt="" src="{Binding entity.PhotoUrl Converter=setFavoritePhotoSrc}" event:load="onImageLoad" style:display="{Binding entity.PhotoUrl Converter=nullToDisplayNone}" />                                            <\/div>                                            <div class="favoriteDetails">                                                <div class="favoriteTitle" data-tag="favoriteTitleContainer">                                                    <TextBlock Text="{Binding entity Converter=getFavoriteTitle}" />                                                <\/div>                                                <div class="favoriteOriginalName" data-tag="favoriteOriginalNameContainer" style:display="{Binding entity Converter=noShowOnDupeName}">                                                    <TextBlock Text="{Binding entity.OriginalName}" />                                                <\/div>                                                <div class="favoriteAddress" data-tag="favoriteAddressContainer" style:display="{Binding entity Converter=showAddress}">                                                    <TextBlock Text="{Binding entity Converter=getFavoriteAddress}" />                                                <\/div>                                                <div class="favoriteDescription" data-tag="favoriteDescriptionContainer" style:display="{Binding entity Converter=noShowOnDupe}">                                                    <TextBlock Text="{Binding entity Converter=getFavoriteDescription}" />                                                <\/div>                                            <\/div>                                            <a class="bm_deleteItem" data-entityid="{Binding entity.Businesslistingid}" data-tag="deleteItem" title="{StaticBinding resources.L_RemoveEntity_ToolTip}" event:click="onDeleteClick" href="#"><\/a>                                            <a class="bm_contextMenuButton" data-entityid="{Binding entity.Businesslistingid}" data-tag="contextMenuButton" title="{StaticBinding resources.L_ContextMenu_ToolTip}" event:click="onContextMenu" href="#"><\/a>                                        <\/div>                                        <div class="cardDeleteConfirmationRow" data-tag="deleteConfirmationRow" data-entityid="{Binding entity.Businesslistingid}">                                            <div class="deleteConfirmationText">                                                <TextBlock Text="{StaticBinding resources.L_TemporaryCollectionDeleteConfirmationMessage}" />                                            <\/div>                                            <span class="cardDeleteConfirmationButtonContainer">                                                <a class="commonButtonControl cancelDeleteButton" data-tag="cancelDelete" event:click="onCancelDeleteClick" href="#">                                                    <TextBlock Text="{StaticBinding resources.L_CancelButton_Text}" />                                                <\/a>                                                <a class="commonButtonControl highlighted confirmDeleteButton" data-tag="confirmDelete" event:click="onConfirmDeleteClick" href="#">                                                    <TextBlock Text="{StaticBinding resources.L_TemporaryCollectionRemoveButton}" />                                                <\/a>                                            <\/span>                                        <\/div>                                        <div class="editEntryRow" data-tag="editEntryRow" data-entityid="{Binding entity.Businesslistingid}">                                            <div class="editNicknameText">                                                <TextBlock Text="{StaticBinding resources.L_NicknameTitle}" />                                            <\/div>                                            <input type="text" class="nameEditBox" data-tag="nameEditBox" maxlength="100" value="{StaticBinding TempName Mode=TwoWay}" event:keydown="onKeyPressName" />                                            <div class="editDescriptionText">                                                <TextBlock Text="{StaticBinding resources.L_DescriptionTitle}" />                                            <\/div>                                            <textarea class="descriptionEditBox" data-tag="descriptionEditBox" contenteditable="true" rows="4" maxlength="1000" value="{StaticBinding TempDescription Mode=TwoWay}" event:keydown="onKeyPressNote"><\/textarea>                                            <span class="editRowButtonContainer">                                                <a class="cancelEditButton commonButtonControl" data-tag="cancelEdit" event:click="onCancelEditClick" href="#">                                                    <TextBlock Text="{StaticBinding resources.L_CancelButton_Text}" />                                                <\/a>                                                <a class="confirmEditButton commonButtonControl" data-tag="confirmEdit" event:click="onConfirmEditClick" href="#">                                                    <TextBlock Text="{StaticBinding resources.L_EditSaveButton}" />                                                <\/a>                                            <\/span>                                        <\/div>                                    <\/a>                                <\/div>                            <\/DataTemplate>                        <\/ItemsControl.ItemTemplate>                    <\/ItemsControl>                <\/div>            <\/div>            <div class="collectionProgress MicrosoftMap_progress" style:display="{Binding ShowProgress Converter=boolToDisplay}" style:visibility="{Binding ShowProgress Converter=boolToVisibility}"><\/div>            <div style:display="{Binding signInState.IsSignedIn Converter=boolToDisplay}">                <div style:display="{Binding ShowProgress Converter=boolToNotDisplay}">                    <div class="favoritesMessage" style:display="{Binding Favorites Converter=noFavoritesShowMessage}" data-tag="favoritesMessage">                        <TextBlock Text="{Binding FavoriteMessage}" />                    <\/div>                <\/div>            <\/div>            <div class="signInBlock" style:display="{Binding signInState.IsSignedIn Converter=displaySignIn}">                <a event:click="onSignInClick" href="#" class="commonButtonControl highlighted signInAndSaveButton" data-tag="validateSignIn">                    <TextBlock Text="{Binding resources.L_SignInButton_Text}" />                <\/a>            <\/div>        <\/div>        <div class="placesMessage" style:display="{Binding MessageText Converter=nullToDisplayNone}" data-tag="placesMessage" role="alert">            <TextBlock Text="{Binding MessageText}" />        <\/div>    <\/div><\/div>',eu='<div data-tag="collectionsTop" class="collectionsCard oneMap cardified">    <div data-tag="collectionsPanelRoot">        <div class="temporaryCollectionCard" data-tag="temporaryCollectionCard" style:padding-bottom="{Binding IsInactiveState Converter=adjustCardBottomPadding}">            <div style:display="{Binding signedOutEnabled Converter=boolToNotDisplay}">                <div class="signInBlock" style:display="{Binding signInState.IsSignedIn Converter=boolToNotDisplay}">                    <SignInPopUpControl SignInMessage="{Binding resources.L_TemporaryCollectionSignIn}" />                <\/div>            <\/div>            <div class="collection" id="{Binding collection.id}">                <div class="collectionHeader" data-tag="collectionHeader">                    <div class="backButtonContainer" style:display="{Binding signInState.IsSignedIn Converter=showBackButton}">                        <a class="collectionBack commonButton backArrowButton" data-tag="collectionBack" event:click="onBackButtonClick" href="#">                            <TextBlock Text="{Binding UseDetailsBackText Converter=useCorrectBackText}" />                        <\/a>                    <\/div>                    <div class="collectionHeaderContent" style:display="{Binding isInactiveState Converter=boolToNotDisplay}">                        <div class="temporaryCollectionTitle overflowText" data-tag="collectionPanelTitle" id="collectionTitleText">                            <TextBlock Text="{Binding resources.L_TemporaryCollectionTitle}" />                        <\/div>                        <div data-tag="actionHeader" class="actionsDivHeader" style:display="{Binding collection.primitives.length Converter=emptyCollectionToNotDisplay}">                            <Button ButtonText="{Binding resources.L_CollectionDirectionButton_Text}" ButtonIcon="oneMapDirectionsIcon" ButtonClass="getDirectionsButton" event:click="onRouteAllClick" hoverText="{Binding resources.L_CollectionDirectionButton_ToolTip}" />                            <Button ButtonText="{Binding resources.L_CollectionShareButton_Text}" ButtonIcon="oneMapShareIcon" ButtonClass="collectionShareButton" event:click="onShareButtonClick" hoverText="{Binding resources.L_CollectionShareButton_ToolTip}" />                            <div class="saveTempContainer" style:display="{Binding signInState.IsSignedIn Converter=shouldDisplayTab}">                                <Button ButtonText="{Binding resources.L_TemporaryCollectionSaveButton}" ButtonIcon="oneMapSaveIcon" ButtonClass="collectionSaveButton" event:click="onSaveClick" hoverText="{Binding resources.L_CollectionSaveButton_ToolTip}" />                            <\/div>                        <\/div>                        <div class="saveDropdown popOutTop" data-tag="saveDropdown" style:display="{Binding IsSaveOpened Converter=boolToDisplay}">                            <div class="saveTitle" data-tag="saveTitle">                                <TextBlock Text="{Binding resources.L_TemporaryCollectionSaveMessage}" />                            <\/div>                            <a class="saveEntry dropdownEntry new" data-tag="saveEntry" event:click="onSaveToNewCollection" href="#">                                <TextBlock Text="{Binding resources.L_TemporaryCollectionSaveToNew}" />                            <\/a>                            <ItemsControl ItemsSource="{Binding CollectionsList}">                                <ItemsControl.ItemTemplate>                                    <DataTemplate>                                        <a class="saveEntry dropdownEntry" data-tag="saveEntry" data-entityid="{Binding id}" event:click="onSaveToExistingCollection" href="#">                                            <TextBlock Text="{Binding name}" />                                        <\/a>                                    <\/DataTemplate>                                <\/ItemsControl.ItemTemplate>                            <\/ItemsControl>                        <\/div>                        <div class="seeAllBlock" style:display="{Binding collection.primitives.length Converter=displaySeeAll}">                            <a class="seeAllButton" href="#" data-tag="seeAllButton" event:click="onSeeAllClick">                                <TextBlock Text="{Binding resources.L_SeeAllButton}" />                            <\/a>                        <\/div>                    <\/div>                <\/div>                <hr class="collectionSeparator" />                <div class="collectionItemList" data-tag="entitiesList">                    <div class="collectionEmpty" style:display="{Binding collection.primitives.length Converter=emptyCollectionToDisplay}">                        <div style:display="{Binding signedOutEnabled Converter=boolToNotDisplay}">                            <TextBlock Text="{Binding State Converter=emptyMessage}" />                        <\/div>                        <div style:display="{Binding signedOutEnabled Converter=boolToDisplay}">                            <div class="emptyTempLine1">                                <TextBlock Text="{Binding resources.EmptyTempCollectionLine1}" />                            <\/div>                            <div class="emptyTempLine2">                                <TextBlock Text="{Binding resources.EmptyTempCollectionLine2}" />                                <span class="saveIcon"><\/span>                            <\/div>                        <\/div>                    <\/div>                    <DraggableList ItemsSource="{Binding collection.primitives}" gripClass="{Binding collection.primitives.length Converter=displayDragGrip}" event:onDragComplete="onDragComplete" event:onDragBegin="onDragBegin" tooltip="{StaticBinding resources.L_DragToolTip_Text}" useWholeDrag="true">                        <DraggableList.ItemTemplate>                            <DataTemplate>                                <div class="collectionEntityRow" ordinal="{Binding entity.displayOrder}" data-entityid="{Binding entity.id}" event:mouseover="onCollectionItemHover" event:mouseout="onCollectionItemHover" event:contextmenu="onContextMenu">                                    <a class="collectionEntity" data-tag="collectionItem" data-entityid="{Binding entity.id}" event:click="onCollectionItemClick" data-task="{Binding $self$ Converter=buildDataTaskAttributeFromPrimitive}" href="#">                                        <div class="collectionEntityContents">                                            <div class="collectionEntityImageContainer">                                                <div class="collectionEntityImagePlaceholder" style:display="{Binding entity.photoUrl Converter=nullToDisplay}"><\/div>                                                <img class="collectionEntityImage" src="{Binding entity.photoUrl Converter=convertPhotoUrlToSource}" event:error="handleImageErrorEvent" event:load="onImageLoad" style:display="{Binding entity.photoUrl Converter=nullToDisplayNone}" alt=""/>                                            <\/div>                                            <div class="collectionEntityDetails">                                                <div class="collectionEntityTitle" data-tag="collectionItemTitle" ordinal="{Binding entity.displayOrder}">                                                    <TextBlock Text="{Binding entity.name}" />                                                <\/div>                                                <div class="collectionEntityOriginalName" data-tag="collectionItemOriginalName" style:display="{Binding entity Converter=noShowOnDupeName}">                                                    <TextBlock Text="{Binding entity.originalName}" />                                                <\/div>                                                <div class="collectionEntityAddress" data-tag="collectionItemAddress" style:display="{Binding entity Converter=showAddress}">                                                    <TextBlock Text="{Binding entity Converter=setAddressText}" />                                                <\/div>                                                <div class="collectionEntityDescription" data-tag="collectionItemDescription" style:display="{Binding entity Converter=noShowOnDupeDescription}">                                                    <TextBlock Text="{Binding entity Converter=showDescription}" />                                                <\/div>                                            <\/div>                                            <a class="bm_deleteItem" data-entityid="{Binding entity.id}" data-tag="deleteItem" title="{StaticBinding resources.L_RemoveEntity_ToolTip}" event:click="onDeleteClick" event:mouseover="onDeleteHover" href="#"><\/a>                                            <a class="bm_contextMenuButton" data-entityid="{Binding entity.id}" data-tag="contextMenuButton" title="{StaticBinding resources.L_ContextMenu_ToolTip}" event:click="onContextMenu" event:mouseover="onDeleteHover" href="#"><\/a>                                        <\/div>                                        <div class="cardDeleteConfirmationRow" data-tag="deleteConfirmationRow" data-entityid="{Binding entity.id}">                                            <div class="deleteConfirmationText">                                                <TextBlock Text="{StaticBinding resources.L_TemporaryCollectionDeleteConfirmationMessage}" />                                            <\/div>                                            <span class="cardDeleteConfirmationButtonContainer">                                                <a class="commonButtonControl cancelDeleteButton" data-tag="cancelDelete" event:click="onCancelDeleteClick" href="#">                                                    <TextBlock Text="{StaticBinding resources.L_CancelButton_Text}" />                                                <\/a>                                                <a class="commonButtonControl highlighted confirmDeleteButton" data-tag="confirmDelete" event:click="onConfirmDeleteClick" href="#">                                                    <TextBlock Text="{StaticBinding resources.L_TemporaryCollectionRemoveButton}" />                                                <\/a>                                            <\/span>                                        <\/div>                                        <div class="editEntryRow" data-tag="editEntryRow" data-entityid="{Binding entity.id}">                                            <div class="editNicknameText">                                                <TextBlock Text="{StaticBinding resources.L_NicknameTitle}" />                                            <\/div>                                            <input type="text" class="nameEditBox" data-tag="nameEditBox" maxlength="100" value="{StaticBinding TempName Mode=TwoWay}" event:keydown="onKeyPressName" />                                            <div class="editDescriptionText">                                                <TextBlock Text="{StaticBinding resources.L_DescriptionTitle}" />                                            <\/div>                                            <textarea class="descriptionEditBox" data-tag="descriptionEditBox" contenteditable="true" rows="4" maxlength="1000" value="{StaticBinding TempDescription Mode=TwoWay}" event:keydown="onKeyPressNote"><\/textarea>                                            <span class="editRowButtonContainer">                                                <a class="cancelEditButton commonButtonControl" data-tag="cancelEdit" event:click="onCancelEditClick" href="#">                                                    <TextBlock Text="{StaticBinding resources.L_CancelButton_Text}" />                                                <\/a>                                                <a class="confirmEditButton commonButtonControl" data-tag="confirmEdit" event:click="onConfirmEditClick" href="#">                                                    <TextBlock Text="{StaticBinding resources.L_EditSaveButton}" />                                                <\/a>                                            <\/span>                                        <\/div>                                    <\/a>                                <\/div>                            <\/DataTemplate>                        <\/DraggableList.ItemTemplate>                    <\/DraggableList>                    <div style:display="{Binding collection.primitives.length Converter=emptyCollectionToNotDisplay}">                        <div class="clearButtonContainer" style:display="{Binding IsClearConfirmationOpen Converter=boolToNotDisplay}">                            <a class="commonButtonControl clearTemp" data-tag="clearButton" data-entityid="CLEAR" event:click="onDeleteClick" href="#">                                <TextBlock Text="{Binding resources.L_TemporaryCollectionClearButton_Cardified}" />                            <\/a>                        <\/div>                        <div class="cardDeleteConfirmationRow" data-tag="deleteConfirmationRow" data-entityid="CLEAR">                            <div class="deleteConfirmationText">                                <TextBlock Text="{Binding resources.L_TemporaryCollectionClearConfirmationMessage}" />                            <\/div>                            <span class="cardDeleteConfirmationButtonContainer">                                <a class="commonButtonControl cancelDeleteButton" data-tag="cancelDelete" event:click="onCancelDeleteClick" href="#">                                    <TextBlock Text="{Binding resources.L_CancelButton_Text}" />                                <\/a>                                <a class="commonButtonControl highlighted confirmDeleteButton" data-tag="confirmDelete" event:click="onConfirmDeleteClick" href="#">                                    <TextBlock Text="{Binding resources.L_TemporaryCollectionClearButton}" />                                <\/a>                            <\/span>                        <\/div>                    <\/div>                <\/div>            <\/div>            <div class="collectionProgress MicrosoftMap_progress" style:display="{Binding ShowProgress Converter=boolToDisplay}" style:visibility="{Binding ShowProgress Converter=boolToVisibility}"><\/div>        <\/div>        <div class="placesMessage" style:display="{Binding MessageText Converter=nullToDisplayNone}" data-tag="placesMessage" role="alert">            <TextBlock Text="{Binding MessageText}" />        <\/div>    <\/div><\/div>',ou='<div class="CollectionsPanelRoot" data-tag="collectionsPanelRoot">    <div class="collectionsCard">        <div class="polyshapeDetails" data-tag="polyshapeDetails">            <div class="backButtonContainer" style:display="{Binding collectionTitle Converter=nullToNotDisplayNone}">                <a class="collectionBack commonButton backArrowButton" data-tag="collectionBack" title="{Binding collectionTitle}" event:click="onBackClick" href="#">                    <TextBlock Text="{Binding collectionTitle}" />                <\/a>            <\/div>            <div class="polyshapeInfoContainer" data-tag="polyshapeInfoContainer">                <div class="overflowText polyshapeTitle" data-tag="polyshapeTitle">                    <TextBlock Text="{Binding polyshape.entity.name}" />                <\/div>                <div class="overflowText polyshapeDescription" data-tag="polyshapeDescription">                    <TextBlock Text="{Binding polyshape.entity.description}" />                <\/div>                <div class="overflowText polyshapeLengthArea" data-tag="polyshapeLengthArea">                    <TextBlock Text="{Binding lengthText}" />                    <TextBlock Text="{Binding areaText}" />                <\/div>                <div style:display="{Binding polyshape.entity.photoUrl Converter=shouldShowPhoto}" data-tag="polyshapePhoto">                    <img class="collectionEntityImage polyshape" src="{Binding polyshape.entity.photoUrl Converter=convertPhotoUrlToSource}" event:error="handleImageErrorEvent"/>                <\/div>            <\/div>        <\/div>    <\/div><\/div>',su='<div data-tag="tabbedMyPlaces" class="bm_tabbedMyPlaces cardified oneMap">    <div data-tag="collectionsTop" class="collectionsCard">    <\/div>    <div class="collectionProgress MicrosoftMap_progress" style:display="{Binding ShowProgress Converter=boolToDisplay}" style:visibility="{Binding ShowProgress Converter=boolToVisibility}">    <\/div>    <div class="placesMessage" style:display="{Binding MessageText Converter=nullToDisplayNone}" data-tag="placesMessage">        <TextBlock Text="{Binding MessageText}" />    <\/div><\/div>',l=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),at=function(t){function i(n,i,r,f){var e=t.call(this,n,r,i)||this;return e.dataManager=f,e.resources=u,e.signInState=new bt,e}return l(i,t),i.prototype.onEntityClick=function(n){var t,i;n&&n.currentTarget&&(t=n.currentTarget.attributes["data-entityid"],t&&(i=this._getEntityL2PageUrl(t.value),window.open(i,"_self")))},i.prototype.onTouchScroll=function(n){n.stopPropagation()},i.prototype.successToDisplay=function(n){return n===0?"":"none"},i.prototype.errorToDisplay=function(n){return n!==0?"":"none"},i.prototype.getEntityFromId=function(){throw"Method not implemented on base class";},i.prototype.makePhotoUrlHttps=function(n){return window.location.protocol==="https:"&&n&&(n=n.replace(/http:/g,"https:")),n},i.prototype._getEntityL2PageUrl=function(t){var r=this.getEntityFromId(t),f=r instanceof ht,u,e;return f?t=t.replace("ypid:","").replace("sid:",""):(t=r.entity.businesslistingid,t&&(t=t.replace("ypid:","").replace("sid:",""))),u=ct.features.optIn.serpEntityPageUrl+"?",u+=n.hasSearchId(t)?"&ypid="+t:n.hasSatoriId(t)?"&sid="+t:i.placeTypeIndicator,r&&r.entity&&(e=f?r.entity.getOriginalName()||r.entity.getName():r.entity.originalName||r.entity.name,u+="&q="+e),u},i.placeTypeIndicator="&eeptype=MapEntity",i}(dt),hu=function(t){function i(n,i,r){var f=this,u={};return f=t.call(this,u,n,i,r)||this,u.defineProperty("collection"),u.defineProperty("windowWidth"),f}return l(i,t),i.prototype.onHeaderBarClick=function(){var n=ct.features.optIn.myPlacesMobileUrl;n+="?coltab="+(h.enableItineraryTab?2:1);window.open(n,"_self")},i.prototype.setAddressText=function(t){return t?t.address?t.address:n.hasSearchId(t.businesslistingid)?"":u.L_PlaceAddressEditSuggestion_Text:""},i.prototype.showDescription=function(n){return n&&n.description&&n.address!==n.description?n.description:""},i.prototype.showAddress=function(n){return n&&n.address&&n.name!==n.address?"":"none"},i.prototype.convertPhotoUrlToSource=function(n){return n!==""?this.makePhotoUrlHttps(n):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyBAMAAADsEZWCAAAAGFBMVEWpqani4uJ1dXX///+2trbDw8PY2Njr6+tZYlZfAAAAoklEQVR4Xt3SPQ6CQBiE4dmwi61/cABOIE7Q1sp6DYk1RA9gYrHXlx8Jcfm2MLEwvMlUTztYhZqJpBZXWSoA9VQSXNCkpmKhW4mncgK+lLHZyh1duvYlxbvYl2QQ48t2EC3KLiSmCInKQxKxk3XWNYpzTzr3EOTGtkoQ00IBQbAgjxBFkbksEUlZysOZVpSNRbnshfsPsWgmSd9PJJP67/e+AHsUWtUxgpHkAAAAAElFTkSuQmCC"},i.prototype.getEntityFromId=function(n){var f=this.getCollection(),u,t,i,r;if(n&&f)for(u=f.primitives,t=0;t<u.length;t++)if(i=u[t],r=i&&i.entity,r&&r.id&&n.toLowerCase()===r.id.toLowerCase())return i;return null},i}(at),cu=function(n){function t(t,i,r,u,f){var e=this,o={};return e=n.call(this,o,t,i,r)||this,o.defineProperty("myPlaces"),e.error=f,f===0&&e.setMyPlaces(u),e}return l(t,n),t.prototype.onCollectionClick=function(n){if(n&&n.currentTarget){var i=ct.features.optIn.collectionMobileUrl+"?",t=n.currentTarget.attributes["data-collectionid"];t&&t.value&&(i+="cid="+t.value,window.open(i,"_self"))}},t}(at),lu=function(){function n(n){this._dataManager=ni.instance;this._viewModel=new hu(pr,n,this._dataManager);this._viewModel.error=0;i("#myPlacesControlRoot").append(this._viewModel.getControl())}return n.prototype.setCollectionId=function(n,t){var i=this,r,u;this.cid=n;this.euid=t;r=function(n,t){i._viewModel.error=t;i._viewModel.changed.invoke();t===0&&i._viewModel.setCollection(n)};u=n.indexOf("!");t||u===-1||(this.euid=n.substr(0,u).toLowerCase());this.euid?this._dataManager.retrieveCollection(this.cid,r,this.euid):this._dataManager.retrieveCollection(this.cid,r)},n.prototype.loadSerializedCollection=function(){var n=b.getCollection();n&&(n.name=u.L_SharedTemporaryCollection_Title,this._viewModel.error=0,this._viewModel.changed.invoke(),this._viewModel.setCollection(n))},n}(),e=function(n){function t(t,i,r,f){var e=n.call(this,t,i,r)||this;return t.defineProperty("showProgress"),t.defineProperty("messageText",function(n,t){return e.onMessageChanged(t)}),t.defineProperty("useDetailsBackText"),t.defineProperty("isPublic",function(n,t){return e.onPrivacyChanged(t)}),t.defineProperty("tempName"),t.defineProperty("tempDescription"),t.defineProperty("signedOutEnabled"),e.setSignedOutEnabled(h.enableSignedOutRefresh),e.resources=u,e.signInState=new bt,e.dataManager=f,e.showMessage=new o,e}return l(t,n),t.prototype.onMessageChanged=function(n){n&&this.showMessage.invoke()},t.prototype.hideContextMenu=function(){this._contextMenuElement&&(this._contextMenuElement.removeFromParent(),this._contextMenuElement=null);this._contextMenu.hide()},t.prototype.makeDeleteCall=function(){throw"Method not implemented on base class";},t.prototype.numberToPixelString=function(n){return n+t.unlocalizedStrings.pixel},t.prototype.idToGripString=function(n){return t.unlocalizedStrings.gripPrefix+n},t.prototype.idToEditString=function(n){return t.unlocalizedStrings.editPrefix+n},t.prototype.idToDeleteString=function(n){return t.unlocalizedStrings.deletePrefix+n},t.prototype.displayCountText=function(n){n||(n=0);var t=n===1?this.resources.L_CollectionCountSingle_Text:this.resources.L_CollectionCount_Text;return t.replace("{0}",n)},t.prototype.shouldDisplayTab=function(n){return n||h.enableSignedOutRefresh?"":"none"},t.prototype.displaySignIn=function(n){return!n&&h.enableSignedOutRefresh?"":"none"},t.prototype.panelClass=function(n){return"CollectionsPanelRoot"+(n?" favoritePanelDimmed":"")},t.prototype.useCorrectBackText=function(n){return n?this.resources.L_BackToDetails_Text:this.resources.L_MyCollections_BackButton},t.prototype.displayDragGrip=function(n){var u="defaultGrip collectionGrip",t="inactive",r;return n?n>1?(this._inactiveGripSet&&(r=i("span[data-grip=grip]",this.getControl()[0]),r.remove_class(t),r.add_class(u)),this._inactiveGripSet=!1,u):n===1?(this._inactiveGripSet=!0,t):void 0:t},t.prototype.onPrivacyChanged=function(){},t.prototype.setPressedState=function(n){return n?n:!1},t.prototype.onDeleteClick=function(n){if(n.target!==null){var i=this._extractIdFromTarget(n,t.unlocalizedStrings.deletePrefix);this.makeDeleteCall(i,function(){})}n.stopPropagation();n.preventDefault()},t.prototype.onDeleteHover=function(n){n&&n.stopPropagation()},t.prototype.onCancelDeleteClick=function(n){this._deleteConfirmationShown&&(this._deleteConfirmationShown.set_style({display:"none"}),this._deleteConfirmationShown=null);n.stopPropagation();n.preventDefault()},t.prototype.onConfirmDeleteClick=function(n){var i=this,t;this._deleteConfirmationShown&&(t=this._deleteConfirmationShown[0].attributes["data-entityId"].value,this.makeDeleteCall(t,function(){i._deleteConfirmationShown=null}));n.stopPropagation();n.preventDefault()},t.prototype.onCancelEditClick=function(n){this._editEntryShown&&(this._editEntryShown.set_style({display:"none"}),this._editEntryShown=null,this._editPrimitive=null,this.setTempName(""),this.setTempDescription(""));n.stopPropagation();n.preventDefault()},t.prototype.onSignInClick=function(n){this.signInState.signIn();n.preventDefault()},t.prototype.onTouchScroll=function(n){n.stopPropagation()},t.prototype.onImageLoad=function(n){var t=n.target,i;t&&(i=t.naturalHeight/t.naturalWidth>=112/92?" tall":" wide",t.className+=i)},t.prototype.adjustCardBottomPadding=function(n){var t="0";return n&&(t="25px"),t},t.prototype.privacyButtonClass=function(n){return"privacyButton"+(n?" unlocked":" locked")},t.prototype.privacyToTooltip=function(n){return n?this.resources.L_CollectionPublicMessage:this.resources.L_CollectionPrivateMessage},t.prototype.privacyToDisclaimer=function(n){return n?this.resources.L_AddCollectionPublicMessage:this.resources.L_AddCollectionPrivateMessage},t.prototype.makePhotoUrlHttps=function(n){return window.location.protocol==="https:"&&n&&(n=n.replace(/http:/g,"https:")),n},t.prototype._extractIdFromTarget=function(n,i){var r=n.target[t.unlocalizedStrings.id];return r&&r.indexOf(i)!==-1?r.replace(i,t.unlocalizedStrings.emptyString):null},t._contextMenuTopPadding=25,t.unlocalizedStrings={block:"block",inlineBlock:"inline-block",click:"click",confirmPrefix:"confirm_",deletePrefix:"delete_",editPrefix:"edit_",emptyString:"",entitiesList:"entitiesList",gripPrefix:"grip_",id:"id",input:"input",invisible:"invisible",last:"last",none:"none",pin:"pin",pixel:"px",selected:"selected",spacePrefix:"space_",keydown:"keydown"},t}(dt),v=function(f){function s(n,t,i,r,u,e,s,h,c,l,a){var v=this;return l||(l={}),v=f.call(this,l,n,a||uu,t)||this,l.defineProperty("state"),l.defineProperty("isNoResponse"),l.defineProperty("isSelectState"),l.defineProperty("isInactiveState"),l.defineProperty("isActiveSelectState"),l.defineProperty("isSelected"),l.defineProperty("routeClass",null,null,{defaultValue:""}),l.defineProperty("selectButtonClass",null,null,{defaultValue:"selectButton"}),l.defineProperty("titleEdit"),l.defineProperty("showPrivacyConfirmation",function(n,t){return v._onShowPopOutChanged(n,t)}),l.defineProperty("confirmationMessage"),v.launchPolyshapeDetails=new o,v.launchDetails=new o,v.completed=new o,v.routeAll=new o,v._panelDim=0,v.setIsInactiveState(v.getIsSelectState()),v._poiManager=r,v._isDragging=!1,v._taskId=i,v._perfLog=c,v._selectedRouteItemCount=0,v.setMessageText(null),v.entitiesPrintViewModel=null,v.routeAll.add(function(){for(var t,i=v.collection.primitives.length>25?25:v.collection.primitives.length,n=0;n<i;n++)t=v.collection.primitives[n],v._createSelectItems(t,t.geometryType===1);v._selectedRouteItems&&v._selectedRouteItems.length>0&&v._routeItems("ALL");v.cleanUpSelectMode()}),v.transientLensViewModel=e,v.disposables.push(v.transientLensViewModel.invalidateLayer.add(function(){return v.hideContextMenu()})),v.disposables.push(v.transientLensViewModel.moveToNewCollection.add(function(){v._inMoveToFlow=!0})),v.dataManager.collectionAdded&&v.disposables.push(v.dataManager.collectionAdded.add(function(n){if(n&&v._inMoveToFlow){var t=v.transientLensViewModel.collectionPrimitive,i=t&&t instanceof ut&&t.entity.id;i&&v.makeDeleteCall(i,function(){return})}v._inMoveToFlow=!1})),v._primitiveInteracted=h,v._contextMenu=s,v._windowClickEventHandler=function(n){var i=v.getControl(),t=i.select(".privacyConfirmation");t&&t.has(n.target)||v._hidePrivacyConfirmation(n)},v}return l(s,f),s.prototype.dispose=function(){f.prototype.dispose.call(this)},s.prototype.resetCollectionTitle=function(){this.collection&&this._tempTitle&&(this.collection.name=this._tempTitle)},s.prototype.getCollectionContent=function(i,u){var f=this,e;this.setShowProgress(!0);e=n.perfLog(this._perfLog,nt.getCollectionList);this._retrieveCollection(i,function(i,o){if(o===0)f.setMessageText(null),f.disposables.push(i.disposed.add(function(){f.onBackButtonClick(null)})),f._tempTitle=i.name,f.setIsPublic(i.isPublic),i.isPublic?f.setConfirmationMessage(f.resources.L_CollectionPublicMessage):f.setConfirmationMessage(f.resources.L_CollectionPrivateMessage),f.collection=i,h.enableMostRecentlyUsedList&&sr.instance.pushCollection(i);else{n.logAction(r.viewCollection,{ERR:o});var s;s=f.getState()&&f.getState().action===t.ViewCollectionReadOnly?f.resources.L_CollectionError_ViewShared_Text:f.resources.L_CollectionError_Retrieving_Text;f.setMessageText(s);f.setShowProgress(!1);f.setIsNoResponse(!0)}e&&e.end();u()})},s.prototype.getPrimitives=function(){var t=[],i,n;if(this.collection&&this.collection.primitives)for(i=this.collection.primitives.length,n=0;n<i;n++)t.push(this.collection.primitives[n]);return t},s.prototype.getPrintContent=function(){var n=this,t,i,r;return this.entitiesPrintViewModel=new bi(this.controlTemplateFactory,this.dataManager,this.collection),this.notesMaxCharSize=wt.notesMaxChars,t={boolToDisplay:function(t){return n.boolToDisplay(t)},nullToDisplayNone:function(t){return n.nullToDisplayNone(t)},boolToNotDisplay:function(t){return n.boolToNotDisplay(t)},setAddressText:function(t){return n.setAddressText(t)},showDescription:function(t){return n.showDescription(t)},showPrintDescription:function(t){return n.showPrintDescription(t)},showAddress:function(t){return n.showAddress(t)}},this.entitiesPrintTemplate=new hi(vi,t),i=this.controlTemplateFactory({templateText:pi,staticResources:t}),r=i.applyDataTemplate(this),r[0].outerHTML},s.prototype.makeDeleteCall=function(t,i){var u=this;this.dataManager.deletePrimitive(this.collection.id,t,function(f){if(f===0){n.logAction(r.editCollection,{TYPE:"DEL"});u.setMessageText(null);var e=u._getEntityIndexFromId(t);e!==null&&e>-1&&u.collection.primitives.removeAt(e);u.collection.changed.invoke()}else n.logAction(r.editCollection,{TYPE:"DEL",ERR:f}),u.setMessageText(u.resources.L_CollectionError_Deleting_Text),u.setShowProgress(!1);i(f)})},s.prototype.makeUpdateCall=function(n,t){this.dataManager.updatePrimitive(this.collection,n,t)},s.prototype.collectionIsShared=function(){return this.collection.isPublic},s.prototype.handleImageErrorEvent=function(){},s.prototype.onSeeAllClick=function(t){this._poiManager.mapAllEntities();t.stopPropagation();t.preventDefault();n.logAction(r.seeAllCollectionClick,{Count:this.collection.primitives.length})},s.prototype.onGeolocationCallback=function(n){n.error||(this.userLocation=n.location)},s.prototype.onActivateSelectClick=function(n){this.setRouteClass(this.getRouteClass()===""?"dropdownOpen":"");this.setSelectButtonClass(this.getSelectButtonClass()==="selectButton active"?"selectButton":"selectButton active");n.stopPropagation();n.preventDefault()},s.prototype.onRouteAllClick=function(n){this.setRouteClass("");this.routeAll.invoke();n.preventDefault();n.stopPropagation()},s.prototype.onRouteSelectClick=function(n){this.setRouteClass("");this._enableSelectMode();n.preventDefault();n.stopPropagation()},s.prototype.onDeleteClick=function(t){var e;if(this._primitiveInteracted&&this._primitiveInteracted.invoke({action:2}),t.target&&!this._deleteConfirmationShown){var u=t.target.attributes["data-entityId"].value,f=i("div[data-entityId="+u+"].cardDeleteConfirmationRow",this.getControl()[0]);f.length>0&&(this._deleteConfirmationShown=f,this._deleteConfirmationShown.set_style({display:"block"}));e=u==="CLEAR"?u:"ENT";n.logAction(r.deleteButtonClicked,{Type:e})}else this._deleteConfirmationShown&&(this._deleteConfirmationShown.set_style({display:"none"}),this._deleteConfirmationShown=null);this._primitiveInteracted&&this._primitiveInteracted.invoke({action:3});t.stopPropagation();t.preventDefault()},s.prototype.onConfirmEditClick=function(n){var f=this,t,r,u;this._editEntryShown&&this._editPrimitive&&(this._editEntryShown.set_style({display:"none"}),t=i(".descriptionEditBox",this._editEntryShown[0]),this._editEntryShown=null,r=this._editPrimitive,this._editPrimitive=null,u=r.entity,u.name=this.getTempName().trim()?this.getTempName().trim():u.originalName,u.description=t&&t[0]?t[0].value:this.getTempDescription(),this.setTempName(""),this.setTempDescription(""),this.makeUpdateCall(r,function(n){f._handleEditRefreshResponse(r,n);f.collection.primitives.changed.invoke()}));n.stopPropagation();n.preventDefault()},s.prototype.onPrivacyClick=function(n){this.setIsPublic(!this.getIsPublic());this.setShowPrivacyConfirmation(!0);n.stopPropagation();n.preventDefault()},s.prototype.onEditTitleClick=function(n){this.onCancelEditClick(n);this.setTitleEdit(!0);this.setTempName(this.collection.name);this.setTempDescription(this.collection.description);var r=i(".titleEditEntryRow",this.getControl()[0]),t=i(".descriptionEditBox",r[0]);t&&t.length&&(t[0].value=this.getTempDescription());n.stopPropagation();n.preventDefault()},s.prototype.onCancelTitleEditClick=function(n){this.setTitleEdit(!1);this.setTempName("");this.setTempDescription("");n.stopPropagation();n.preventDefault()},s.prototype.onConfirmTitleEditClick=function(t){var i=this,u=this.getTempName().trim();!u||(this.setTitleEdit(!1),u&&(this.collection.name=u),this.collection.description=this.getTempDescription().trim(),this.collection.changed.invoke(),this.setTempName(""),this.setTempDescription(""),this._isUpdating=!0,this.dataManager.updateCollectionMeta(this.collection,function(t,u){u===0&&i._isUpdating?(n.logAction(r.editCollection,{TYPE:"C"}),i.collection.name=t.name,i.collection.description=t.description,i.collection.isPublic=t.isPublic,i.collection.changed.invoke(),i._tempTitle=i.collection.name,i.setMessageText(null),i._isUpdating=!1):(n.logAction(r.editCollection,{TYPE:"C",ERR:u}),i.setMessageText(i.resources.L_CollectionError_Updating_Text))}));t.stopPropagation();t.preventDefault()},s.prototype.onShareButtonClick=function(n){p.invokeHandler(y.shareDataHandlerKey,{action:"shareTasks",taskIds:[this._taskId],entryPoint:et.Collections});n.stopPropagation();n.preventDefault()},s.prototype.onContextMenu=function(n){var r=this,f;if(n.stopPropagation(),n.preventDefault(),this._contextMenuElement){this.hideContextMenu();return}this._contextMenu.hide();var o=n.pageX,s=n.pageY-e._contextMenuTopPadding,h=n.currentTarget.attributes["data-entityId"].value,u=this._getCollectionPrimitiveFromId(h);this.transientLensViewModel.updateActionListWithMoveTo();f=this.getState();f&&f.action!==t.ViewCollectionReadOnly&&(this._editCallback&&this._editCallback.dispose(),this._editCallback=this.transientLensViewModel.editEvent.add(function(n){return r._onContextMenuEdit(n,u)}),this.disposables.push(this._editCallback),this.transientLensViewModel.updateActionListWithEdits(u.entity.originalName!==u.entity.name,!!u.entity.description));this.transientLensViewModel.buildMenu(u,i(n.currentTarget),function(n){r._contextMenuElement=ui._createElement("div").add_class("bm_listMenu").set_style({left:o,top:s});n.appendTo(r._contextMenuElement);r._primitiveInteracted.invoke({action:1,element:r._contextMenuElement})})},s.prototype.onPrivacyChanged=function(t){var i=this;this.collection&&t!==this.collection.isPublic&&(t?this.setConfirmationMessage(this.resources.L_CollectionMadePublicMessage):this.setConfirmationMessage(this.resources.L_CollectionMadePrivateMessage),this.collection.isPublic=t,this.dataManager.updateCollectionMeta(this.collection,function(t,u){u===0?(n.logAction(r.editCollection,{TYPE:"PSS"}),i.collection.isPublic=t.isPublic,i.collection.changed.invoke(),i.setMessageText(null)):(n.logAction(r.editCollection,{TYPE:"PSS",ERR:u}),i.setMessageText(i.resources.L_CollectionError_Updating_Text))}))},s.prototype.onCollectionItemClick=function(t){if(t.type===e.unlocalizedStrings.click){if(t.currentTarget){var u,i,f=t.currentTarget.attributes["data-entityid"];f&&(u=f.value);u&&(i=this._getCollectionPrimitiveFromId(u));this.launchDetails.invoke();i&&(i.geometryType===2||i.geometryType===3)?(this._poiManager.setPoiState(i,2),t.preventDefault(),t.stopPropagation()):i===this._editPrimitive?(t.preventDefault(),t.stopImmediatePropagation()):n.logAction(r.clickEntity,{Type:"COL"})}n.logAction(r.viewCollectionItemDetails,{EP:6})}else this._isDragging||t.stopPropagation()},s.prototype.onCollectionItemHover=function(n){var t,i,r;n.type==="mouseover"?(t=null,i=null,n.currentTarget&&(r=n.currentTarget.attributes["data-entityid"],r&&(t=r.value),t&&(i=this._getCollectionPrimitiveFromId(t))),i&&(this._highlightedPrimitive&&this._poiManager.setPoiState(this._highlightedPrimitive,0),this._highlightedPrimitive=i,(this._highlightedPrimitive.geometryType===2||this._highlightedPrimitive.geometryType===3)&&this._highlightedPrimitive.hasSubstitute&&(this._highlightedPrimitive=this._highlightedPrimitive.substitutePoi),this._poiManager.setPoiState(this._highlightedPrimitive,1),this._highlightedPrimitive.entity.changed.invoke())):n.type==="mouseout"&&this._highlightedPrimitive&&(this._poiManager.setPoiState(this._highlightedPrimitive,0),this._highlightedPrimitive.entity.changed.invoke(),this._highlightedPrimitive=null)},s.prototype.onDragBegin=function(){this._primitiveInteracted&&this._primitiveInteracted.invoke({action:2});this._isDragging=!0},s.prototype.onDragComplete=function(t){var i=this;this._isDragging=!1;this._primitiveInteracted&&this._primitiveInteracted.invoke({action:3});t&&(this._updateDisplayOrder(),this._updateCollection(this.collection,function(t,u){u===0&&i._isUpdating?(n.logAction(r.editCollection,{TYPE:"REO"}),i.setMessageText(null),i._isUpdating=!1):(n.logAction(r.editCollection,{TYPE:"REO",ERR:u}),i.setMessageText(i.resources.L_CollectionError_Updating_Text),i.setShowProgress(!1))}))},s.prototype.onBackButtonClick=function(n){this.hideContextMenu();n&&n.preventDefault()&&n.stopPropagation();this.completed.invoke()},s.prototype.onItemSelect=function(n){var f,e,t;if(this.getIsSelectState()){var u=null,i=null,r=!1;n.currentTarget&&(f=n.currentTarget,e=f.attributes["data-entityid"],e&&(u=e.value),u&&(i=this._getCollectionPrimitiveFromId(u)),t=f.childNodes.item(0).firstChild,this._selectedRouteItemCount<25?t&&t.checked?(this._selectedRouteItemCount++,this.setIsActiveSelectState(!0),r=!0):(this._selectedRouteItemCount--,r=!1):t&&t.checked?(this.setMessageText(this.resources.L_MaxDirectionsItems_Text),i=null,t.checked=!1):(this.setMessageText(null),this._selectedRouteItemCount--,r=!1));i&&(this._createSelectItems(i,r),this._selectedRouteItems.length===0&&this.setIsActiveSelectState(!1))}n.stopPropagation()},s.prototype.onGetDirectionsClick=function(n){this.getIsActiveSelectState()&&(this._routeItems("SEL"),this.cleanUpSelectMode());n.preventDefault();n.stopPropagation()},s.prototype.onCancelDirectionsClick=function(n){this.cleanUpSelectMode();n.preventDefault();n.stopPropagation()},s.prototype.processCollectionsData=function(n){var i,r,u,f;n&&n.inData&&n.inData.requestorState&&(i=n.inData.requestState,r=n.outData&&n.outData[0]&&n.outData[0].data,r&&r.actionSucceeded&&i&&i.data&&this.transientLensViewModel.collectionPrimitive instanceof ut&&(i.action===t.AddEntity||i.action===t.AddFavorite||i.action===t.SetHome||i.action===t.SetWork)&&(u=this.transientLensViewModel.collectionPrimitive,f=u&&u.entity.id,this.makeDeleteCall(f||i.data.id,function(){return})))},s.prototype.entityIdToDisplayAddress=function(t){var i=this._getCollectionPrimitiveFromId(t);return i&&i.entity&&(n.hasSearchId(i.entity.businesslistingid)||n.hasSatoriId(i.entity.businesslistingid)||i.geometryType!==1)?e.unlocalizedStrings.none:""},s.prototype.polyshapeToNotDisplay=function(n){return n&&n.geometryType===1?"":e.unlocalizedStrings.none},s.prototype.businessIdToDisplay=function(t){var r=this._getCollectionPrimitiveFromId(t),i;return r&&r.entity?(i=r.entity,n.hasSearchId(i.businesslistingid)?i&&i.address.length===0?e.unlocalizedStrings.none:"":e.unlocalizedStrings.none):""},s.prototype.emptyCollectionToDisplay=function(n){return n?e.unlocalizedStrings.none:""},s.prototype.emptyCollectionToNotDisplay=function(n){return n?"":e.unlocalizedStrings.none},s.prototype.displaySeeAll=function(n){return n&&h.displaySeeAll?"":e.unlocalizedStrings.none},s.prototype.noPointsToNotDisplay=function(n){for(var t=!1,i=0;n&&i<n.length&&!t;)t=n[i].geometryType===1,i++;return t?"":e.unlocalizedStrings.none},s.prototype.showOnBusinessEdit=function(t){return t&&n.hasSearchId(t.businesslistingid)?t.address?"":"none":"none"},s.prototype.displayDescription=function(n){return n?n:u.L_NewCollectionDescription_Watermark},s.prototype.convertPhotoUrlToSource=function(n){return n&&n!==""&&n.indexOf("livefilestore")===-1?this.makePhotoUrlHttps(n):""},s.prototype.hideBackButton=function(n){return n===t.ViewCollectionReadOnly||n===t.AddEntity?e.unlocalizedStrings.none:e.unlocalizedStrings.inlineBlock},s.prototype.hideHeaderBlock=function(n){return n===t.ViewCollectionReadOnly||n===t.AddEntity?e.unlocalizedStrings.none:e.unlocalizedStrings.inlineBlock},s.prototype.hideEditButton=function(n){return n===t.ViewCollectionReadOnly||this.getIsInactiveState()?e.unlocalizedStrings.none:e.unlocalizedStrings.inlineBlock},s.prototype.hideEditActions=function(n){return n===t.ViewCollectionReadOnly||this.getIsInactiveState()?e.unlocalizedStrings.none:"inline"},s.prototype.emptyMessage=function(n){return n&&n.action&&n.action===t.AddEntity?this.resources.L_FailedEntitySave_Text:this.resources.L_Collection_Empty_Message},s.prototype.displayDragGrip=function(n){var r=f.prototype.displayDragGrip.call(this,n),i=this.getState();return i&&i.action===t.ViewCollectionReadOnly?"inactive":r},s.prototype.entityIdToPrimitiveNumber=function(n){return(this.collection.primitives.indexOf(this._getCollectionPrimitiveFromId(n))+1).toString()+"."},s.prototype.buildCollectionTaskOptions=function(){var n={},i={};return i.entryPoint=6,i.flippingCard=!0,i.action=t.GetAllCollections,n.type=c.collectionsTask,n.activateOptions={parentId:this._taskId},n.state=i,n},s.prototype.buildDirectionsTaskOptions=function(){var u={},i={},f,e,r;for(i.entryPoint=6,i.flippingCard=!1,i.waypoints=[],e=this._selectedRouteItems.length>25?25:this._selectedRouteItems.length,r=0;r<e;r++){var t=this._selectedRouteItems[r],h=new lt(t.entity.routableLocation.latitude,t.entity.routableLocation.longitude),o=t.entity.address?t.entity.address:t.entity.name,s=null,l=t.entity;n.hasSearchId(l.businesslistingid)&&(o=t.entity.address,s=t.entity.businesslistingid);f=new yr(o,h,t.entity.name);f.eid=s;f.waypointType=2;i.waypoints[r]=f}return u.action="activate",u.type=c.directionsTask,u.state=i,u},s.prototype.buildDataTaskOptions=function(n){var t=yt.buildEntityDataTaskOptions(n);return t.state.flippingCard=!0,t.state.collectionId=this.collection.id,t.state.savedEntityId=n.id,t.activateOptions={parentId:this._taskId},t},s.prototype.directionsCancelClass=function(n){return"textButton collectionDirections Cancel"+(n?"":" isNotActive")},s.prototype.buildDataTaskAttribute=function(n){return i.Internals.stringify(this.buildDataTaskOptions(n))},s.prototype.buildDataTaskAttributeFromPrimitive=function(n){if(n&&n.geometryType===1){var t=n.entity;if(!t.iconText)return this.buildDataTaskAttribute(n.entity)}},s.prototype.getTitle=function(){return this.collection&&this.collection.name},s.prototype.setNameText=function(n){return n?n.name.indexOf(n.routableLocation.latitude.toString().substr(0,5))>-1?u.L_PlaceTitleEditSuggestion_Text:n.name:""},s.prototype.setAddressText=function(t){return t?t.address?t.address:n.hasSearchId(t.businesslistingid)?"":u.L_PlaceAddressEditSuggestion_Text:""},s.prototype.businessHideEditText=function(t){return t&&n.hasSearchId(t.businesslistingid)?"none":""},s.prototype.showEditOrDescription=function(n){return n&&n.description&&n.address!==n.description?n.description:u.L_PlaceDescriptionEditSuggestion_Text},s.prototype.showDescription=function(n){return n&&n.description&&n.address!==n.description?n.description:""},s.prototype.showAddress=function(n){return n&&n.address&&n.name!==n.address?"":"none"},s.prototype.noShowOnDupeName=function(n){if(n){var i=n.getTitle(),t=n.originalName,r=n.getAddress(),u=n.getDescription();return i&&t&&(i===t||r&&r===t||u&&u===t)?"none":""}return"none"},s.prototype.noShowOnDupeDescription=function(n){if(n){var i=n.getTitle(),r=n.getAddress(),t=n.getDescription();return!t||t.length===0||i&&t===i||r&&r===t?"none":""}return"none"},s.prototype.showPrintDescription=function(n){return n&&n.description&&n.description!==n.address?"":"none"},s.prototype.cleanUpSelectMode=function(){this._selectedRouteItems&&this._selectedRouteItems.length>0&&(this._selectedRouteItems.clear(),this._clearCheckBoxes());this._selectedRouteItemCount=0;this.setSelectButtonClass("selectButton");this.setIsSelectState(!1);this.setIsInactiveState(this.getIsSelectState());this.setIsActiveSelectState(!1)},s.prototype._createSelectItems=function(n,t){if(this._selectedRouteItems||(this._selectedRouteItems=new pt),t)this._selectedRouteItems.insert(n,this._selectedRouteItems.length);else for(var i=0;i<this._selectedRouteItems.length;i++)if(this._selectedRouteItems[i].entity.id===n.entity.id){this._selectedRouteItems.removeAt(i);break}},s.prototype._clearCheckBoxes=function(){for(var t=document.getElementsByClassName("selectFavorite"),n=0,r,i,n=0;n<t.length;n++)t[n]&&(r=t[n],i=r.children[0].childNodes[0],i&&(i.checked=!1))},s.prototype._retrieveCollection=function(n,i){var r=this.getState(),u=null,f;r.action===t.ViewCollectionReadOnly&&(u=r&&r.externalUserId,f=r.collectionId.indexOf("!"),u||f===-1||(u=r.collectionId.substr(0,f).toLowerCase()));this.dataManager.retrieveCollection(n,function(n,t){i&&i(n,t)},u)},s.prototype._updateCollection=function(n,t){this._isUpdating=!0;this.dataManager.updateCollection(n,t)},s.prototype._getCollectionEntity=function(n){var t=this._getCollectionPrimitive(n);return t!==null?t.entity:null},s.prototype._getCollectionPrimitive=function(n){var t=this._getPrimitiveId(n);return t?this._getCollectionPrimitiveFromId(t):null},s.prototype._getEntityIndexFromId=function(n){var r,t,u,i;if(n)for(r=this.collection.primitives.length,t=0;t<r;t++)if(u=this.collection.primitives[t],i=u.entity,i&&i.id&&n.toLowerCase()===i.id.toLowerCase())return t;return null},s.prototype._getCollectionPrimitiveFromId=function(n){var t=this._getEntityIndexFromId(n);return t!==null?this.collection.primitives[t]:null},s.prototype._getPrimitiveId=function(n){var r=i(n),u=r&&r.get_attr(e.unlocalizedStrings.id),t;return n&&n.tagName.toLowerCase()!=="li"?(t=n.parentElement,t)?this._getPrimitiveId(t):e.unlocalizedStrings.emptyString:u},s.prototype._enableSelectMode=function(){this.setIsSelectState(!0);this.setIsInactiveState(this.getIsSelectState());this._clearCheckBoxes()},s.prototype._updateDisplayOrder=function(){var n=0,t=this.collection.primitives,i=t.length,r=-1;do t[n].entity.displayOrder=++r,n++;while(n<i)},s.prototype._routeItems=function(t){n.logAction(r.routeCollection,{TYPE:t,NM:this._selectedRouteItems.length});p.invokeHandler(y.taskDataHandlerKey,this.buildDirectionsTaskOptions())},s.prototype._onContextMenuEdit=function(t,u){var o=this,h,e,f,s;t===tt.deleteName?(u.entity.name=u.entity.originalName,this.makeUpdateCall(u,function(n){o._handleEditRefreshResponse(u,n);o.collection.primitives.changed.invoke()})):t===tt.deleteDescription?(u.entity.description="",this.makeUpdateCall(u,function(n){o._handleEditRefreshResponse(u,n);o.collection.primitives.changed.invoke()})):(this._editEntryShown&&(this._editEntryShown.set_style({display:"none"}),this._editEntryShown=null),this._editPrimitive=u,u.entity.name!==u.entity.originalName&&this.setTempName(u.entity.name),this.setTempDescription(u.entity.description),h=u.entity.id,e=i("div[data-entityId="+h+"].editEntryRow",this.getControl()[0]),e.length>0&&(this._primitiveInteracted&&this._primitiveInteracted.invoke({action:2}),this._editEntryShown=e,this._editEntryShown.set_style({display:"block"}),this._primitiveInteracted&&this._primitiveInteracted.invoke({action:3}),f=i(".descriptionEditBox",e[0]),t===tt.editName?(s=i(".nameEditBox",e[0]),s&&s.length&&s[0].focus()):f&&f.length&&f[0].focus(),f&&f.length&&(f[0].value=this.getTempDescription())),n.logAction(r.editCollection,{Type:"EP"}))},s.prototype._handleEditRefreshResponse=function(t,i){i===0?(n.logAction(r.editCollection,{TYPE:"inline"}),this.setMessageText(null),t&&this._poiManager.setPoiState(t,0)):(n.logAction(r.editCollection,{TYPE:"inline",ERR:i}),this.setMessageText(this.resources.L_CollectionError_Updating_Text),this.setShowProgress(!1))},s.prototype._onShowPopOutChanged=function(n,t){var u=this,r=i(window);t?Microsoft.Maps.setTimeout(function(){r.add_event("click,contextmenu",u._windowClickEventHandler)},1):n&&r.remove_event("click,contextmenu",this._windowClickEventHandler)},s.prototype._hidePrivacyConfirmation=function(){this.getShowPrivacyConfirmation()?this.setShowPrivacyConfirmation(!1):i(window).remove_event("click,contextmenu",this._windowClickEventHandler)},s}(e),au=function(f){function e(n,t,i,r,u,s,h){var l=f.call(this,h)||this,a,v;return l._map=n,l.type=c.collectionsTask,l.displayState={colorIndex:4,groupName:"Collections"},e._eventsNotToRender||(e._eventsNotToRender=[]),l.signInStateHandler=new bt,l.poiManager=r,l._dataManager=ni.instance,l._infoboxOptions={showCloseButton:!1,zIndex:1006,showPointer:!1,visible:!0,htmlContent:null,location:null,autoAlignment:!0},l._viewManager||(l._viewManager=new wi(t,l._dataManager,l.poiManager,i,l.primitiveInteracted,u,s,h)),a=l._viewManager.viewLoading.add(function(){return l._onViewLoading()}),v=l._viewManager.viewLoaded.add(function(n){return l._onViewLoaded(n)}),l.disposables.push(a),l.disposables.push(v),l.setMapPrimitives([]),l.processCallbacks=new o,l.disposables.push(l.processCallbacks.add(function(n){n.processorType===c.directionsTask?l.processDirectionsData(n):n.processorType===c.collectionsTask?l.processCollectionsData(n):n.processorType===c.itineraryDetailsTask&&l.processItineraryData(n)})),l.scrollLane=new o,l._favoritesChangedEventSet=!1,l._polyshapeState=0,l.transientLensViewModel=u,b.logTemporaryCollection(),l._alwaysOnPoiRequests=0,l}return l(e,f),e.prototype.process=function(n,i){var f=n.requestState,u,r;if(this._viewManager.taskId=this.id,u={notSignedIn:!1,actionSucceeded:!1,collections:[]},r=f&&f.action,!this.signInStateHandler.getIsSignedIn()&&r!==t.AddToTemporaryCollection&&r!==t.UpdateEntity&&r!==t.ProcessCardlessPrimitives&&r!==t.GetActiveTasks){u.notSignedIn=!0;i&&i({processorId:this.id,data:u});return}this.processHelper(n,i,r,u)},e.prototype.processHelper=function(i,f,e,o){var c=this,s=i.requestState;e?e===t.GetAllCollections||e===t.GetAllCollectionNamesAndIds?this._viewManager.getAllCollections(function(u){o.collections=e===t.GetAllCollectionNamesAndIds?li.getAllCollectionNamesAndIds(u):li.serialize(u);o.actionSucceeded=!0;c._requestorIdValid(i)&&n.logAction(r.processCollections,{EP:s.entryPoint,TYPE:"GCL"});f&&f({processorId:c.id,data:o})}):e===t.GetHomeAndWork?this._dataManager.syncFavorites(function(t){if(t!==0)o.actionSucceeded=!1;else{o.actionSucceeded=!0;var i=c._dataManager.home;i&&(n.logAction(r.processCollections,{EP:s.entryPoint,TYPE:"GHM"}),o.home=i.entity.ToCollectionEntity());i=c._dataManager.work;i&&(n.logAction(r.processCollections,{EP:s.entryPoint,TYPE:"GWK"}),o.work=i.entity.ToCollectionEntity())}f&&f({processorId:c.id,data:o})}):e===t.AddEntity&&s.data&&s.collectionId&&s.data.title&&s.data.location?this._viewManager.saveEntityToCollection(s.data,s.collectionId,function(t,i,e){i!==0?(i===12?(o.entityId="",o.collections.push(g.serialize(t))):i===3&&(o.failureMessage=u.L_Max_Entities_Message.replace("{0}",h.maxAllowedCollectionEntities+"")),n.logAction(r.processCollections,{EP:s.entryPoint,TYPE:"SP2C",ERR:i}),o.actionSucceeded=!1):(o.actionSucceeded=!0,o.entityId=e?e:"",o.collections.push(g.serialize(t)),n.logAction(r.processCollections,{EP:s.entryPoint,TYPE:"SP2C"}));f&&f({processorId:c.id,data:o})}):e===t.SetCollectionSharingAccess&&s.collectionId&&s.enableSharing!==null?(n.logAction(r.processCollections,{EP:s.entryPoint,TYPE:"PSS"}),this._viewManager.getCollection(s.collectionId,function(n){return c._updateRetrievedCollection(n,s,o,f)})):(e===t.SetHome||e===t.SetWork||e===t.AddFavorite)&&s.data&&s.data.location&&s.data.title?this._dataManager?(this._viewManager.leaveAddHomeWork(),this._dataManager.syncFavorites(function(i){var l,w,b,a,v;if(i!==0)n.logAction(r.processCollections,{EP:s.entryPoint,TYPE:"SFA",ERR:i}),f&&f({processorId:c.id,data:o});else{o.actionSucceeded=!0;var h=s.data,y=+h.location.latitude.toFixed(6),p=+h.location.longitude.toFixed(6),u=new ht;u.entity=new ii;u.entity.setOriginalName(h.title);u.entity.setName(h.nickName||h.title);u.entity.setAddress(h.address);u.entity.setDescription(h.description);u.entity.categoryId=h.categoryId;l=h.id;l&&l.length<=50&&(w=l.toLowerCase().indexOf(ft.ypid)===0,b=l.toLowerCase().indexOf(ft.sid)===0,w&&l.toLowerCase().indexOf("yn")===-1&&(l=l.replace(":",":YN")),(w||b)&&u.entity.setBusinesslistingid(l));u.entity.setPhotoUrl(h.photoUrl);u.entity.setPhone(h.phone);u.setGeometry({x:p,y:y,bounds:[y,p,y,p]});v=function(t,i){i!==0?(o.actionSucceeded=!1,o.maxFavorites=i===4,o.favorite=i===12&&t.entity,n.logAction(r.processCollections,{EP:s.entryPoint,TYPE:a,ERR:i})):(o.actionSucceeded=!0,o.favorite=t.entity,o.entityId=t.entity.getIsHomeOrWork()?"":t.entity.getPlaceId(),n.logAction(r.processCollections,{EP:s.entryPoint,TYPE:a}),c._dataManager.favoritesLoaded.invoke());f&&f({processorId:c.id,data:o})};e===t.SetHome?(a="SHM",c._dataManager.setHome(u,v)):e===t.SetWork?(a="SWK",c._dataManager.setWork(u,v)):(a="AFV",c._dataManager.createFavorite(u,v))}})):f&&f({processorId:this.id,data:o}):e===t.GetActiveTasks?s.collectionId?this._viewManager.isActiveCollection(s.collectionId,function(n,t,i){o.actionSucceeded=!0;o.entityId=s.entityId;i||o.collections.push(g.serialize(n));o.taskId=t===0?c.id:null;f&&f({processorId:c.id,data:o})}):this._viewManager.isMyPlacesActive(s.entityId,function(n,t){o.taskId=null;o.actionSucceeded=!0;o.entityId=s.entityId;t===0&&c._currentViewModel instanceof d&&n&&(o.taskId=c.id);f&&f({processorId:c.id,data:o})}):e===t.AddToTemporaryCollection?this._processAddToTemporaryCollection(s,o,f):e===t.UpdateEntity?this._processUpdateEntity(s,o,f):e===t.ProcessCardlessPrimitives?this._cardlessPrimitivesSet?(this.poiManager.setPrimitives([]),this._cardlessPrimitivesSet=!1,f&&f({processorId:this.id,data:o})):this._processCardlessPrimitives(f,o):(n.logAction(r.processCollections,{EP:s.entryPoint,ERR:"Missing action param"}),f&&f({processorId:this.id,data:o})):f&&f({processorId:this.id,data:o})},e.prototype.processCallback=function(n){this.processCallbacks.invoke(n)},e.prototype.processDirectionsData=function(n){n&&n.inData&&n.inData.requestorState&&this.transientLensViewModel.processDirectionsData(n)},e.prototype.processCollectionsData=function(n){n&&n.inData&&n.inData.requestorState&&this.transientLensViewModel.processCollectionsData(n)},e.prototype.processItineraryData=function(n){n&&n.inData&&n.inData.requestorState&&this.transientLensViewModel.processTravelData(n)},e.prototype.activate=function(n,t){this.activateHelper(n,t)},e.prototype.activateHelper=function(i,r){var e=this,s,c,o;if(f.prototype.activate.call(this,i,r),this.transientLensViewModel&&this.transientLensViewModel.setOptions({requestorId:this.id}),this._viewManager.taskId=this.id,r.action!==t.ShowTemporaryCollection&&this.setTitle(u.L_MyPlaces_Title),this.map&&(this._currentZoom=this.map.getMercatorZoomLevel()),this.signInStateHandler.getIsSignedIn()?r&&!r.action&&(r.collectionId?r.action=t.ViewCollectionReadOnly:r.showMyPlaces&&(r.action=t.ViewFavorites,r.entityId="1")):!h.enableSignedOutRefresh&&r&&r.action&&r.action!==t.ViewCollectionReadOnly&&r.action!==t.LoadSharedTemporaryCollection&&r.action!==t.ShowTemporaryCollection?r.action=t.GetAllCollections:r&&r.collectionId&&r.collectionId!==w.tempCollectionId&&(r.action=t.ViewCollectionReadOnly),this._placesToResolve=0,this._placesResolved=0,r&&!r.action&&r.collectionFromSp&&(r.action=t.LoadSharedTemporaryCollection,r.entryPoint=4,r.addressesToResolve))for(this.disposables.push(this.processCallbacks.add(function(t){e._processSearchForAddressResponse(t,r);e._placesResolved++;e._placesResolved===e._placesToResolve&&(n.logAction(fi.Activated,{CX:"Activated",EP:r.entryPoint}),e._viewManager.start(r))})),this._placesToResolve=r.addressesToResolve.length,s=0;s<this._placesToResolve;s++)this._resolvePlace(r.addressesToResolve[s]);this._compareStateHelper(r,this._taskState)&&this._placesToResolve===0&&(c="InitializeMyPlaces",r&&r.action?c=t[r.action]:(r||(r={}),r.action=t.GetAllCollections),o=r.entryPoint,o||(r.action===t.ViewCollectionReadOnly?o=4:r.showMyPlaces&&(o=12)),n.logAction(fi.Activated,{CX:"Activated",EP:o}),this._viewManager.start(r))},e.prototype.deactivate=function(){this._viewManager.end();this._hideInfobox();n.logAction(fi.Deactivated,{CX:"Deactivated"});f.prototype.deactivate.call(this)},e.prototype.hasDefaultFocusElement=function(){return this._viewManager.selectViewDefaultFocus()},e.prototype.getMenuList=function(){if(this._currentViewModel instanceof v){var n=this._currentViewModel.getState();if(n&&n.action!==t.ViewCollectionReadOnly)return f.prototype.getMenuList.call(this)}else if(this._currentViewModel instanceof d)return f.prototype.getMenuList.call(this);return[]},e.prototype.hasPrintContent=function(){return wt.isEnabled&&(this.signInStateHandler.getIsSignedIn()||this._taskState.action===t.ShowTemporaryCollection)},e.prototype.getPrintContent=function(){var t=this;if(!wt.isEnabled)return null;var i=this._viewManager.getPrintContent(),n=new pt;return n.insert(this.poiManager.getLayerId(),0),lr.onPrintDialogClose.addOne(function(){return t._viewManager.cleanUpPrintPrimitives()}),new cr(i,n,null)},e.prototype.serialize=function(n,i){return this._taskState&&(this._taskState.taskTitle=this.getTitle(),n&&i&&i===2&&(this._taskState.action=t.ViewCollectionReadOnly,this._taskState.entryPoint=4),this._currentViewModel instanceof w&&(n?(this._taskState.action=t.LoadSharedTemporaryCollection,this._taskState.enableSharing=!0,this._taskState.taskTitle=u.L_SharedTemporaryCollection_Title,this._taskState.serializedCollection=this._currentViewModel.serializeCollection(),this._taskState.entryPoint=4):(this._taskState.action=t.ShowTemporaryCollection,this._taskState.taskTitle=u.L_TemporaryCollectionTitle,this._taskState.serializedCollection=null))),this._taskState},e.prototype.setDisplayState=function(n){f.prototype.setDisplayState.call(this,n);this._viewManager&&this._viewManager.setTaskDisplayState(this.displayState);this.changed.invoke()},e.prototype.isPublicCollection=function(){return this._currentViewModel instanceof w?!0:this._currentViewModel instanceof v?this._currentViewModel.collection.isPublic:!1},e.prototype.makePublic=function(n){this._changeIsPublicValue(!0,n)},e.prototype.makePrivate=function(n){this._changeIsPublicValue(!1,n)},e.prototype.isSharable=function(){return this._taskState.collectionId!==null&&this._taskState.collectionId!==undefined||this._currentViewModel instanceof w},e.prototype._onPoiViewStateChanged=function(u){var e,o,a,s,l,k,nt,g,it;if(u.primitive.entity instanceof yt){if(e=u.primitive.entity,this._currentViewModel instanceof v?o=this._currentViewModel:this._previousViewModel instanceof v&&(o=this._previousViewModel),e){a=e.id&&i("[data-entityId="+e.id+"]",this.panelRoot[0]);s=null;a&&a.length&&(s=i(a[0].children&&a[0].children[0]));switch(u.newValue){case 1:this._hideInfobox();this._showInfobox(e);s&&s.add_class("pinHover");break;case 2:if(this._hideInfobox(),s&&s.remove_class("pinHover"),l=u.primitive,l instanceof ut&&l.isPolyshapeSubstitute){this.poiManager.setPoiState(l.originalPolyshape,2);break}l.geometryType===1?e.id&&o?p.invokeHandler(y.taskDataHandlerKey,o.buildDataTaskOptions(e)):o||(k=yt.buildEntityDataTaskOptions(e),(e instanceof rr||e instanceof ur)&&(k.state.taskTitle=""),p.invokeHandler(y.taskDataHandlerKey,k)):(l.geometryType===3||l.geometryType===2)&&(this.displayState.activationState!==1&&(nt={action:"focus",id:this.id},p.invokeHandler(y.taskDataHandlerKey,nt)),o&&o.launchPolyshapeDetails.invoke(l));break;case 0:this._hideInfobox();s&&s.remove_class("pinHover")}}}else if(u.primitive.entity instanceof ii){var w=u.primitive.entity,b=w.getBusinesslistingid(),f,d=!1,tt=this._dataManager.home&&this._dataManager.home.entity&&w.id===this._dataManager.home.entity.id,rt=this._dataManager.work&&this._dataManager.work.entity&&w.id===this._dataManager.work.entity.id;tt||rt?(f=b&&i(".homeWorkContainer a[data-entityId="+b+"]",this.panelRoot[0]),d=!0):f=b&&i(".favoritesList a.favoriteEntry[data-entityId="+b+"]",this.panelRoot[0]);switch(u.newValue){case 1:this._hideInfobox();this._showInfobox(null,w);f&&f.length&&f.add_class("pinHover");break;case 2:this._hideInfobox();f&&f.length&&f.remove_class("pinHover");h.editHomeWork&&d?(it={action:t.ViewFavorites},g={action:this.isHiddenTask?"activate":"focus",id:this.isHiddenTask?null:this.id,type:c.collectionsTask,state:it}):g=di.buildDataTaskOptionsFromFavorite(w,this.id,!o);n.logAction(r.clickEntity,{Type:d?tt?"HOME":"WORK":"FAV",IsPoi:!0});p.invokeHandler(y.taskDataHandlerKey,g);break;case 0:this._hideInfobox();f&&f.length&&f.remove_class("pinHover")}}},e.prototype.getCardIconInfo=function(){return{iconClass:"colTsk"}},e.prototype._onViewLoading=function(){this.setPercentLoaded(0)},e.prototype._hideMenu=function(n){for(var t=this.panelRoot,r;t&&t.length&&t[0].classList&&!(t[0].classList.contains("cardFace")&&t[0].classList.contains("front"));)t=t.getParent();t&&t.length&&this.signInStateHandler.getIsSignedIn()&&(r=t[0].getElementsByClassName("menu")[0],r&&(n===1?i(r).set_style({display:"block"}):i(r).set_style({display:"none"})))},e.prototype._onViewLoaded=function(i){var o=this,r,f,l,s,a,e;this._previousViewModel=this._currentViewModel;this._currentViewModel=i;this.setPercentLoaded(1);i?(this.addControl(i.getControl()),i instanceof v?(r=i,f=r.getState(),!f||f.action!==t.ViewCollectionReadOnly||f.collectionFromSp||f.serializedCollection?f&&f.serializedCollection?(f.action=t.LoadSharedTemporaryCollection,this._taskState=f):this._taskState=f&&(f.action===t.ShowTemporaryCollection||f.collectionFromSp)&&r instanceof w?f:{action:t.ViewCollection,collectionId:r.collection.id,externalUserId:r.collection&&r.collection.externalUserId}:this._taskState=r.collection?{action:t.ViewCollectionReadOnly,collectionId:r.collection.id,externalUserId:r.collection.externalUserId}:r.getState(),r.disposables.push(this.processCallbacks.add(function(n){n.processorType===c.collectionsTask&&r.processCollectionsData(n)})),r.collection&&this.setTitle(r.collection.name),this.serializableObjectChanged.invoke(),r.collection&&r.disposables.push(r.collection.primitives.changed.add(function(){o.setMapPrimitives(r.getPrimitives())})),r.collection&&h.enablePolyshapes&&r.collection.containsPolyshapes&&r.disposables.push(this.map.mapZoomStopped.add(function(n){o._swapPoiForShape(n);o._currentZoom=n.zoom})),l=n.perfLog(this.perfLog,nt.renderCollectionPois),this.poiManager.primitivesRendered.addOne(function(){l&&l.end()}),this.scrollLane.invoke(this.panelRoot),this.setMapPrimitives(r.getPrimitives())):i instanceof d?(this._taskState={action:t.GetAllCollections},this.setTitle(u.L_MyPlaces_Title),s=i,s.tabDeactivated.add(function(n){o._hideMenu(n)}),this.serializableObjectChanged.invoke(),a=s.getControl().select(".tab-active"),a.length>0&&a[0].focus(),this._favoriteCallbackAdded||(s.favoritesViewModel.disposables.push(this.processCallbacks.add(function(n){n.processorType===c.collectionsTask&&s.favoritesViewModel.processCollectionsData(n)})),this._favoriteCallbackAdded=!0),this._setFavoritesPoi(s)):i instanceof rt?(this.setTitle(u.L_AddCollection_Title),this._taskState={action:t.AddCollection},this.serializableObjectChanged.invoke(),i.setPlaceholder()):i instanceof oi?(this.setTitle(i.getTitle()),e=i,e.disposables.push(e.resolveSuggestion.add(function(n){o._resolveSuggestion(n)})),e.disposables.push(e.resolveSearch.add(function(n){o._resolvePlace(n)})),e.disposables.push(e.processLocalDetailsCards.add(function(){o._getLocalDetailsCards()})),e.disposables.push(this.processCallbacks.add(function(n){e.handleResolveSuggestionCallback(n)})),e.initAutosuggest(this.map)):i instanceof st&&(this.setTitle(i.getTitle()),this._swapPoiForShape())):this._close()},e.prototype._setFavoritesPoi=function(n){var t=this,i;this._dataManager?(i=function(){var n=[];h.editHomeWork||(t._dataManager.home&&n.push(t._dataManager.home),t._dataManager.work&&n.push(t._dataManager.work));t._dataManager.favorites&&t._dataManager.favorites.length&&(n=n.concat(t._dataManager.favorites.slice()));t.displayState.activationState!==2&&t._currentViewModel instanceof d&&t.setMapPrimitives(n)},this._favoritesChangedEventSet||(n.disposables.push(this._dataManager.favoritePrimitivesChanged.add(i)),this._favoritesChangedEventSet=!0),(this._dataManager.home||this._dataManager.work||this._dataManager.favorites&&this._dataManager.favorites.length)&&i()):this.setMapPrimitives([])},e.prototype._close=function(){var n={action:"remove",id:this.id};p.invokeHandler(y.taskDataHandlerKey,n)},e.prototype._compareStateHelper=function(n,t){return n&&t&&n.action===t.action&&n.collectionId===t.collectionId&&n.entityId===t.entityId&&n.data===t.data?!1:!0},e.prototype._requestorIdValid=function(n){return n!==null},e.prototype._updateRetrievedCollection=function(n,t,i,r){var u=this;n===null&&(i.actionSucceeded=!1,r&&r({processorId:this.id,data:i}));n.isPublic===t.enableSharing&&(i.actionSucceeded=!0,r&&r({processorId:this.id,data:i}));n.isPublic=t.enableSharing;this._dataManager.updateCollection(n,function(n,t){i.actionSucceeded=t===0?!0:!1;r&&r({processorId:u.id,data:i})})},e.prototype._changeIsPublicValue=function(n,i){var f=this,r,u;if(!(this._currentViewModel instanceof v)||this._currentViewModel.getState().action===t.ViewCollectionReadOnly){i&&i(!1);return}if(r=this._currentViewModel.collection,r.isPublic===n){i&&i(!0);return}u=r.isPublic;r.isPublic=n;this._dataManager.updateCollection(r,function(t,e){var o=e===0;o?f._currentViewModel.setIsPublic(n):r.isPublic=u;i&&i(o)})},e.prototype._resolveSuggestion=function(n){this._resolvePlace(n.title,n.entityId)},e.prototype._resolvePlace=function(n,t){var i={query:n,disableTaskActivate:!0,filterUrlParam:t,entryPoint:et.Autosuggest},r={requestorId:this.id,requestorState:{callbackState:n},type:c.localSearchTask,requestState:i};p.invokeHandler(y.taskProcessDataHandlerKey,r)},e.prototype._getLocalDetailsCards=function(){var n,t,i;gt.resetCurrentLocalDetailsCards();n={searchEntitiesRequested:!0};t={requestorType:"CollectionsTask",requestorId:this.id,type:c.localDetailsTask,requestState:n,useActiveTasks:!0};p.invokeHandler(y.taskProcessDataHandlerKey,t);i={requestorType:"CollectionsTask",requestorId:this.id,type:c.polygonEntityDetailsTask,requestState:n,useActiveTasks:!0};p.invokeHandler(y.taskProcessDataHandlerKey,i)},e.prototype._swapPoiForShape=function(t){var y=t?t.zoom:this.map.getMercatorZoomLevel(),l=y>this._currentZoom,f=null,e,i,o,r,u,c;if(this._currentViewModel instanceof v?f=this._currentViewModel.getPrimitives():this._currentViewModel instanceof st&&this._previousViewModel instanceof v&&(f=this._previousViewModel.getPrimitives()),f&&(this._polyshapeState===0&&!l||this._polyshapeState===2&&l||this._polyshapeState===1)){var s=[],a=0,h=0;for(e=0;e<f.length;e++)i=f[e],o=i.geometryType!==1,o&&a++,o&&this._isShapeTooSmall(i)?(r=new ut,r.isPolyshapeSubstitute=!0,r.originalPolyshape=i,i.hasSubstitute=!0,i.substitutePoi=r,r.entity=i.entity,u=n.getMedianCentroid(i.geometry),r.geometry={x:u[1],y:u[0],bounds:[u[0],u[1],u[0],u[1]]},s.push(r),h++):(o&&(i.hasSubstitute=!1,c=i.substitutePoi,i.substitutePoi=null,c&&(c.originalPolyshape=null)),s.push(i));this.setMapPrimitives(s);this._polyshapeState=h===0?0:a===h?2:1}},e.prototype._isShapeTooSmall=function(n){var i=this.map.getBounds(),t=n.geometry.bounds,r=(t[1]-t[3])/i.width,u=(t[0]-t[2])/i.height;return r*u<.001},e.prototype._processAddToTemporaryCollection=function(t,i,u){var o,f,e,s;i.actionSucceeded=!0;o=t.data;f=ut.simplePointFactory(o);f.entity.id=this._createRandomId();e=b.addPoint(f);s="ATC";i.actionSucceeded=e===0;i.favorite=(e===0||e===12)&&f.entity;i.entityId=f.entity.id;i.collections.push(g.serialize(b.getCollection()));!this.displayState||this.displayState.activationState===0||!this._currentViewModel||this._currentViewModel instanceof v&&!(this._currentViewModel instanceof w)||(i.taskId=this.id);n.logAction(r.processCollections,{EP:t.entryPoint,TYPE:s});u&&u({processorId:this.id,data:i})},e.prototype._processUpdateEntity=function(t,i,u){var g=this,e=t.entityId,f=null,v=t.data.title,y=t.data.description||"",s="UP",nt=t.collectionId===w.tempCollectionId,o,h,p,k,c,d,l,a;if(nt)b.updatePoint(e,v,y),i.actionSucceeded=!0,i.entityId=e,u&&u({processorId:this.id,data:i}),s="UPT";else if(o=this._dataManager.findCollectionById(t.collectionId),o){for(h=0;h<o.primitives.length;h++)if(p=o.primitives[h],p.entity.id===e){f=p;break}f&&(f.entity.name=v,f.entity.description=y,this._dataManager.updatePrimitive(o,f,function(){i.actionSucceeded=!0;i.entityId=e;o.primitives.changed.invoke();u&&u({processorId:g.id,data:i})}),s="UPC")}else{for(k=this._dataManager.favorites,c=0;c<k.length;c++)if(d=k[c],d.entity.id===e){f=d;break}f||(l=this._dataManager.home,a=this._dataManager.work,l&&l.entity.id===e?f=l:a&&a.entity.id===e&&(f=a));f&&(f.entity.setName(v),f.entity.setDescription(y),f.changed.invoke(),i.actionSucceeded=!0,i.entityId=e,u&&u({processorId:this.id,data:i}),s="UPF")}n.logAction(r.processCollections,{EP:t.entryPoint,TYPE:s})},e.prototype._processSearchForAddressResponse=function(n,t){var o,r,u,e,f,i;if(n.processorType===c.localSearchTask&&n.outData&&n.outData.length===1&&n.outData[0].data&&n.outData[0].data.entities&&n.outData[0].data.entities.length>0&&(o=n.outData[0].data.entities,r=o[0],r&&r.getLocation()&&(u=ut.createSimplePointFromSearchEntity(r),t.collectionFromSp.primitives.length)))for(e=t.collectionFromSp.primitives,f=0;f<e.length;f++)if(i=e[f],i.entity.address===n.inData.requestState.query&&i.geometryType===1){i.geometry=u.geometry;i.entity.address=u.entity.address;i.entity.businesslistingid=u.entity.businesslistingid;break}},e.prototype._processCardlessPrimitives=function(n,t){var i=this,r=function(){i._alwaysOnPoiRequests++;i.poiManager.suppressViewChangeOnRefreshOnce();i._dataManager.syncFavorites(function(r){r===0&&(i._alwaysOnPoiRequests--,i._alwaysOnPoiRequests===0&&(i._setAlwaysOnPrimitives(),i._cardlessPrimitivesSet=!0,t.taskId=i.id,t.actionSucceeded=!0,n&&n({processorId:i.id,data:t})))})},u;this.signInStateHandler.getIsSignedIn()?(r(),this.disposables.push(this._dataManager.homeOrWorkChanged.add(function(){r()}))):(u=this.signInStateHandler.notifySignedIn.add(function(){r();i.disposables.push(i._dataManager.homeOrWorkChanged.add(function(){r()}))}),this.disposables.push(u))},e.prototype._setAlwaysOnPrimitives=function(){var f=this,t,u,i;for(this.poiManager&&!this.poiManager.poiViewStateChanged.hasHandlersRegistered()&&this.disposables.push(this.poiManager.poiViewStateChanged.add(function(n){f._onPoiViewStateChanged(n)})),t=[],this._dataManager.home&&this._dataManager.home.entity.getShowOnMap()&&t.push(this._dataManager.home),this._dataManager.work&&this._dataManager.work.entity.getShowOnMap()&&t.push(this._dataManager.work),u=this._dataManager.home?this._dataManager.work?"B":"H":this._dataManager.work?"W":"N",n.logAction(r.hasHomeWork,{Has:u}),this.poiManager.setPrimitives(t,!0),i=0;i<t.length;i++)t[i].entity.changed.invoke()},e.prototype._createRandomId=function(){var n=Math.floor(Math.random()*1e3),t=Math.floor(Math.random()*1e3);return n+"_"+t},e.prototype._showInfobox=function(n,t){var i,r;n===void 0&&(n=null);t===void 0&&(t=null);i=n?new lt(n.routableLocation.latitude,n.routableLocation.longitude):new lt(t.getGeometry().y,t.getGeometry().x);this._infoboxOptions.offset=new hr(8,8);this._infoboxOptions.location=i;r=n?this._getInfoBoxHtmlContent(n):this._getInfoBoxHtmlContent(t);r&&(this._infoboxOptions.htmlContent=r,this._infobox?this._infobox.setOptions(this._infoboxOptions):(this._infobox=new er(i,this._infoboxOptions),this._infobox.setMap(this._map)))},e.prototype._hideInfobox=function(){this._infobox&&this._infobox.getVisible()&&(this._infobox.preventAutoClose||this._infobox.setOptions({visible:!1,closeDelayTime:800}))},e.prototype._getInfoBoxHtmlContent=function(n){var t={},r,u,f,y;if(n!==null&&(t=this._getInfoboxItems(n),r=n?n.getPhotoUrl():n.getPhotoUrl()),f=t&&t.title,f){var e="",o='<div class=bm_ib_container><div class="bm_ib_title" data-tag="myPlacesInfoBoxTitle"><span>'+t.title+"<\/span><\/div>",s=t.address,h=t.description,c=t.originalName,l="",a="",v="";return h&&(l+='<div class="bm_ib_metadata_noImg description" data-tag="myPlacesInfoboxData"><span>'+h+"<\/span><\/div>"),s&&(a='<div class="bm_ib_metadata_noImg address" data-tag="myPlacesInfoboxData"><span>'+s+"<\/span><\/div>"),c&&(v='<div class="bm_ib_metadata_noImg originalName" data-tag="myPlacesInfoboxData"><span>'+c+"<\/span><\/div>"),(r||u)&&(y=r?r:u,e='<div class="bm_ib_imageContainer" data-tag="myPlacesInfoBoxImage"><img class="bm_ib_image" src="'+i.Internals.HTMLEncode(y)+'"/><\/div>'),o+=v+a+l,e+o+"<\/div>"}return},e.prototype._getInfoboxItems=function(n){var r={},o=n?n:n,e=o.getTitle(),u,t,f;if(e)return u=o.getOriginalName(),u&&e!==u?(r.title=i.Internals.HTMLEncode(e),r.originalName=u.length>32?i.Internals.HTMLEncode(u.substr(0,31)+"â¦"):i.Internals.HTMLEncode(u)):r.title=i.Internals.HTMLEncode(e),t=o.getAddress(),t&&e!==t&&(!u||u!==t)&&(r.address=t.length>32?i.Internals.HTMLEncode(t.substr(0,31)+"â¦"):i.Internals.HTMLEncode(t)),f=o.getDescription(),f&&(!t||t!==f)&&(r.originalName?f.length>32&&(r.description=i.Internals.HTMLEncode(f.substr(0,31)+"â¦")):r.description=f.length>58?i.Internals.HTMLEncode(f.substr(0,57)+"â¦"):i.Internals.HTMLEncode(f)),r},e}(si),vt;(function(n){n[n.None=0]="None";n[n.D=1]="D";n[n.C=2]="C"})(vt||(vt={}));var ei=function(n){function t(t,i,r,e,s){var h=this,c={};h=n.call(this,c,i,gr)||this;h._privates=c;h._map=t;h._drawingTools=r;h._entities=e;h.measuringToolMode=0;h._measuringToolDisposables=[];h._valueFormat=u.L_MeasureMapTask_ValueUnitFormat;h._areaFormat=u.L_MeasureMapTask_AreaFormat;h._perimeterFormat=u.L_MeasureMapTask_PerimeterFormat;h.resources=u;h.shapeChanged=new o;c.defineProperty("instructions",null,null,{isPrivate:!0,defaultValue:u.L_MeasureMapTask_InitialInstructions});c.defineProperty("perimeter",null,null,{isPrivate:!0});c.defineProperty("area",null,null,{isPrivate:!0});h.disposables.push(t.mapTypeButtonClicked.add(function(){h.finish()}));var v=h._spatialMath=f.SpatialMath,l=v.DistanceUnits,a=v.AreaUnits,y={distance:{big:l.Kilometers,bigText:u.L_MeasureMapTask_DistanceUnitKm_Text,small:l.Meters,smallText:u.L_MeasureMapTask_DistanceUnitMeter_Text},area:{big:a.SquareKilometers,bigText:u.L_MeasureMapTask_AreaUnitKm_Text,small:a.SquareMeters,smallText:u.L_MeasureMapTask_AreaUnitMeter_Text},threshold:2},p={distance:{big:l.Miles,bigText:u.L_MeasureMapTask_DistanceUnitMile_Text,small:l.Feet,smallText:u.L_MeasureMapTask_DistanceUnitFoot_Text},area:{big:a.SquareMiles,bigText:u.L_MeasureMapTask_AreaUnitMile_Text,small:a.SquareFeet,smallText:u.L_MeasureMapTask_AreaUnitFoot_Text},threshold:1};return s===ci.miles?(h._primaryUnitSetting=p,h._secondaryUnitSetting=y):(h._primaryUnitSetting=y,h._secondaryUnitSetting=p),h}return l(t,n),t.prototype.getShowDoneLink=function(){return!!this._measuringTool},t.prototype.getShowEditLink=function(){return!!this._shape},t.prototype.getShowAreaLink=function(){var t=this.getShape(),r=!1,n,i;return t&&t.geometryType===2&&(n=t.geometry,i=3,this._inAddPointsMode()&&i++,r=n&&n.x&&n.x.length>=i),r},t.prototype.getShape=function(){return this._measuringToolInstance?this._measuringToolInstance.getShape():this._shape},t.prototype.finish=function(){this._measuringTool&&this._measuringTool.then(function(n){n.finish()})},t.prototype.measureFrom=function(n){var i=this;this._isDisposed||(this._resetShape(),this._updateMeasurements(null),this._initMeasuringTool(),this._measuringTool.then(function(r){if(i._isDisposed)i._disposeMeasuringTool();else{var u=n?[n]:[];r.measure(t.createPolyline(u));i.changed.invoke()}}))},t.prototype.showShape=function(n,t){this._isDisposed||(this._resetShape(),this._disposeMeasuringTool(),this._validateAndSave(n,t))},t.prototype.onNewClick=function(n){if(n.preventDefault(),this._resetShape(),this._map){var t=fr.getMapCenter(this._map);this.measureFrom(null)}},t.prototype.onDoneClick=function(n){n.preventDefault();this.finish()},t.prototype.onEditClick=function(n){n.preventDefault();this._editExisting()},t.prototype.onAreaClick=function(n){n.preventDefault();var r=this.getShape(),i=r&&r.geometryType===2&&r.geometry,u=3,f=this._inAddPointsMode();f&&u++;i&&i.x&&i.x.length>=u?this.showShape(t.createPolygon(i,f),vt.C):(this._resetShape(),this._disposeMeasuringTool(),this._updateMeasurements(null))},t.prototype._onDrawingEnded=function(n){this._entities&&this._validateAndSave(n,vt.D);this._disposeMeasuringTool()},t.prototype.dispose=function(){this._disposeMeasuringTool();this._drawingTools=null;this._entities=null;this._shape=null;this._map=null;n.prototype.dispose.call(this);this._isDisposed=!0},t.createPolyline=function(n){var u=f.Polyline,r=n,i=n;return i.x&&(r={x:i.x.slice(),y:i.y.slice()}),new u(r,t._polyOptionsLight)},t.createPolygon=function(n,i){var u,r,e;return i===void 0&&(i=!1),u=f.Polygon,i&&(r=-1),e={x:n.x.slice(0,r),y:n.y.slice(0,r)},new u({rings:[e]},t._polyOptionsLight)},t.prototype._disposeMeasuringTool=function(){for(var n=0,t=this._measuringToolDisposables.length;n<t;n++)this._measuringToolDisposables[n].dispose();this._measuringToolDisposables=[];this._measuringTool=null;this._measuringToolInstance=null;this.measuringToolMode=0;this.changed.invoke()},t.prototype._initMeasuringTool=function(){var n=this;!this._measuringTool&&this._drawingTools&&(this._measuringTool=this._drawingTools.getMeasuringTool(),this._measuringTool.then(function(t){n._measuringToolInstance=t;n._measuringToolDisposables.push(t,t.doubleTapped.add(function(){return n.finish()}),t.drawingModeChanged.add(function(t){n.measuringToolMode=t.editorMode}),t.drawingEnded.add(function(t){return n._onDrawingEnded(t)}),t.measurementsChanged.add(function(t){return n._updateMeasurements(t)}))}),this.changed.invoke())},t.prototype._inAddPointsMode=function(){return this.measuringToolMode===3||this.measuringToolMode===1},t.prototype._editExisting=function(){var n=this,t;!this._isDisposed&&this._shape&&(t=this._shape,this._resetShape(),this._initMeasuringTool(),this._measuringTool.then(function(i){n._isDisposed?n._disposeMeasuringTool():i.measure(t)}))},t.prototype._resetShape=function(){this._entities&&(this._entities.clear(),this._shape=null,this.changed.invoke(),this.shapeChanged.invoke())},t.prototype._roundValue=function(n,t){var i=0;return t&&(n<10?i=2:n<100&&(i=1)),n.toFixed(i)},t.prototype._formatDistance=function(n,t,i){var r=t.distance,u=this._spatialMath.convertDistance(n,this._spatialMath.DistanceUnits.Meters,i?r.big:r.small),f=this._roundValue(u,i);return this._valueFormat.replace("{value}",f).replace("{unit}",i?r.bigText:r.smallText)},t.prototype._formatArea=function(n,t,i){var r=t.area,u=this._spatialMath.convertArea(n,this._spatialMath.AreaUnits.SquareMeters,i?r.big:r.small),f=this._roundValue(u,i);return this._valueFormat.replace("{value}",f).replace("{unit}",i?r.bigText:r.smallText)},t.prototype._useBigUnits=function(n){var t=!1;if(n){var i=this._primaryUnitSetting,r=i.distance,u=this._spatialMath.convertDistance(n,this._spatialMath.DistanceUnits.Meters,r.big);t=u>=i.threshold}return t},t.prototype._updateMeasurements=function(n,i){var f=n&&n.area,u=n&&n.perimeter,e,o,r=this._useBigUnits(u);f&&(e=this._areaFormat.replace("{primary}",this._formatArea(f,this._primaryUnitSetting,r)).replace("{secondary}",this._formatArea(f,this._secondaryUnitSetting,r)));u&&(o=this._perimeterFormat.replace("{primary}",this._formatDistance(u,this._primaryUnitSetting,r)).replace("{secondary}",this._formatDistance(u,this._secondaryUnitSetting,r)));this._privates.setArea(e);this._privates.setPerimeter(o);this._addPointMeasures(n,r);t._logEvent(i,n)},t.prototype._addPointMeasures=function(n,t){var e=n&&n.segments,r=this._shape,i,f,o,u,s;if(e&&e.length&&r&&r.geometry){for(f=[],r.geometryType===2?(i=r.geometry,f.push(this._createPointLabel(i.x[0],i.y[0]))):r.geometryType===3&&(o=r.geometry.rings,i=o&&o[0]),u=1,s=i.x.length;u<s;u++)f.push(this._createPointLabel(i.x[u],i.y[u],e[u].totalLength,t));this._entities.add(f)}},t.prototype._createPointLabel=function(n,i,r,u){var e={id:"MeasurePoint_"+t._pointId++,collisionBehavior:2},f;return typeof r=="number"&&(e.title=this._formatDistance(r,this._primaryUnitSetting,u)),f=new ar(new lt(i,n),e,t._pointIcon),f.bucket="999999",f},t.prototype._validateAndSave=function(n,t){var e=this,f=!1,i,r,u;n&&(n.geometryType===2?(i=n.geometry,f=i&&i.x&&i.x.length>1):n.geometryType===3&&(r=n.geometry,u=r&&r.rings&&r.rings[0],f=u&&u.x&&u.x.length>3),f?(this._entities.add(n),this._shape=n,this._drawingTools.measureShape(n,function(n){e._updateMeasurements(n,t)}),this.shapeChanged.invoke()):this._updateMeasurements(null))},t._logEvent=function(n,i){var u,f,r,e,o;n&&i&&i.shape&&(u=i.shape,f=u.geometryType,f===2?r=u.geometry:f===3&&(e=u.geometry.rings,r=e&&e[0]),o={logData:{feature:t._featureName,action:vt[n],data:{ST:f,SA:Math.round(i.area),SP:Math.round(i.perimeter),VC:r&&r.x&&r.x.length}}},p.invokeHandler(y.instrumentationDataHandlerKey,o))},t._featureName="MT",t._pointId=0,t._pointIcon={records:[{vectorType:2,style:{strokeStyle:"#fff",lineWidth:3},centerX:0,centerY:0,radiusX:4,radiusY:4},{vectorType:2,style:{fillStyle:"#fff",strokeStyle:"#000",lineWidth:2},centerX:0,centerY:0,radiusX:4,radiusY:4}]},t._polyOptionsLight={strokeColor:"#222222",strokeThickness:2,secondaryStrokeColor:"#ffffff",secondaryStrokeThickness:4,fillColor:"rgba(137,226,249,0.3)"},t._polyOptionsDark={strokeColor:"#ffffff",strokeThickness:2,secondaryStrokeColor:"#333333",secondaryStrokeThickness:4,fillColor:"rgba(137,226,249,0.3)"},t}(dt),vu=function(n){function t(t){var i=n.call(this)||this,r;return i._controlTemplateFactory=t,r=ct.features.directions,i._distanceUnit=r.unit||ci.km,i.type=c.measureMap,i.setTitle(u.L_MeasureMapTask_Title),i.displayState={colorIndex:5,groupName:"Measure"},i}return l(t,n),t.prototype.activate=function(t,i){var f=this,r,u;n.prototype.activate.call(this,t);this._viewModel||(this._initDrawingTools(),this._initEntityCollection(),this._viewModel=new ei(this.map,this._controlTemplateFactory,this._drawingTools,this._entities,this._distanceUnit),this.disposables.push(this._viewModel,this._viewModel.shapeChanged.add(function(){f.serializableObjectChanged.invoke()}),t.mapTypeChanged.add(function(n){n.newMapTypeId===or.birdseyeV2&&f._viewModel.finish()})),this.addControl(this._viewModel.getControl()));r=i;r.location?this._viewModel.measureFrom(r.location):r.geometryType&&r.geometry&&(r.geometryType===2?u=ei.createPolyline(r.geometry):r.geometryType===3&&(u=ei.createPolygon(r.geometry)),u&&this._viewModel.showShape(u))},t.prototype.deactivate=function(){this._viewModel=null;this._drawingTools=null;this._entities&&(this.map.getLayers().remove(this._entities),this._entities=null);n.prototype.deactivate.call(this)},t.prototype.getCardIconInfo=function(){return{iconClass:"msrTsk"}},t.prototype.getMenuList=function(){return[]},t.prototype.hasPrintContent=function(){return wt.isEnabled&&!1},t.prototype.getPrintContent=function(){return null},t.prototype.serialize=function(){var i={},r=this._viewModel,n,u,t,f,o,e;return r&&(n=r.getShape(),i.initialized=!0,n&&n.geometry&&(u=n.geometryType,u===3?(f=n.geometry,t=f.rings&&f.rings[0]):u===2&&(t=n.geometry),t&&t.x&&(o=r.measuringToolMode===3||r.measuringToolMode===1,o&&(e=-1),i.geometryType=u,i.geometry={x:t.x.slice(0,e),y:t.y.slice(0,e)}))),i},t.prototype.setDisplayState=function(n){var t=n&&n.activationState;t&&t!==1&&this._viewModel&&this._viewModel.finish()},t.prototype.isSharable=function(){return!1},t.prototype._initDrawingTools=function(){if(!this._drawingTools){var n=f.DrawingTools;this._drawingTools=new n(this.map);this.disposables.push(this._drawingTools)}},t.prototype._initEntityCollection=function(){if(!this._entities){var n=f.EntityCollection;this._entities=new n;this.map.getLayers().insert(this._entities);this.disposables.push(this._entities)}},t}(si),yu=function(n){function t(t,r,u){var f=this,e={},o,s,c;return f=n.call(this,e,t,r,u)||this,e.defineProperty("signInUrl"),e.defineProperty("isSignedIn"),f.signInButtonText=f.resources.L_SignIn_Text.replace("<link>","").replace("<\/link>",""),sj_evt.bind("bnp.notif.shown",function(){f.AdjustHamburgerTop()},1,0),sj_evt.bind("bnp.notif.closed",function(){f.AdjustHamburgerOnBNPClose()},1,0),f._removeHidingHamburger(),f.setIsSignedIn(f.signInState.getIsSignedIn()),f.getIsSignedIn()&&(o=i(".tabControlContainer"),o.set_style({display:"block"}),s=i(".myPlacesMobileContent"),s.set_style({display:"none"}),f.dataManager.syncFavorites(function(n){f._favoritesViewModel=new ku(br,r,f.dataManager,n);var t=i(".favoritesControl");t.append(f._favoritesViewModel.getControl())}),f.dataManager.retrieveAllCollectionsMetaData(function(n,t){f._collectionsViewModel=new cu(wr,r,f.dataManager,n,t);var u=i(".collectionsControl");u.append(f._collectionsViewModel.getControl())}),h.enableItineraryTab&&(f._itinerariesViewModel=new wu(kr,r,f.dataManager),c=i(".itinerariesControl"),c.append(f._itinerariesViewModel.getControl()))),f}return l(t,n),t.prototype.onSignInButtonClick=function(){window.open(this.getSignInUrl(),"_self")},t.prototype.AdjustHamburgerTop=function(){var t=i("#bnp_ttc_div"),r,n;if(t.length>0&&(r=t[0].clientHeight,n=i("#mHamburger"),n.length>0)){var u=n.get_style("top"),f=Number(u.substr(0,u.indexOf("px"))),e=f+r;n.set_style({top:e+"px"})}},t.prototype.AdjustHamburgerOnBNPClose=function(){var n=i("#mHamburger");n.length>0&&n.set_style({top:""})},t.prototype._removeHidingHamburger=function(){var n=i("#mHamburger");n.length>0&&n.has_class("b_hide")&&n.remove_class("b_hide")},t}(at),pu=function(){function n(n){this._dataManager=h.enableItineraryTab?new ri:ni.instance;this._viewModel=new yu(nu,n,this._dataManager);var t=i("#myPlacesControlRoot");t.append(this._viewModel.getControl())}return n.prototype.setSignInUrl=function(n){this._viewModel&&this._viewModel.setSignInUrl(n)},n}(),rt=function(t){function f(n,i,r,u){var f=this,e={};return f=t.call(this,e,n,tu,i)||this,f.newTitle="",f.newDescription="",e.defineProperty("showBackButton"),f.setShowBackButton(r),f.setIsPublic(!0),f.setShowProgress(!1),f.completed=new o,f.setMessageText(null),f._primitives=u,f}return l(f,t),f.prototype.dispose=function(){t.prototype.dispose.call(this)},f.prototype.AddCollection=function(n,t,i,r){var u=new g(g.localCollectionId,n);u.description=t;u.isPublic=i;this._primitives&&u.primitives.insertAll(this._primitives.slice());this.dataManager.createCollection(u,r)},f.prototype.setPlaceholder=function(){var r=this.getControl(),n,t;r[0]&&(n=i(".addDescriptionControl",r[0]),n&&n.length>0&&(n[0].focus(),n[0].setAttribute("placeholder",this.resources.L_NewCollectionDescription_Watermark)),t=i(".addNameControl",r[0]),t&&t.length>0&&(t[0].focus(),t[0].setAttribute("placeholder",this.resources.L_NewCollectionName_Watermark)))},f.prototype.onPrivacyClick=function(n){this.setIsPublic(!this.getIsPublic());n.stopPropagation();n.preventDefault()},f.prototype.onEditSaveClick=function(n){this._validateTitleAndDescription()&&this._createCollection(n);n.preventDefault()},f.prototype.onSignInAndSaveClick=function(n){var t=this;this._validateTitleAndDescription()&&(this.disposables.push(this.signInState.notifySignedIn.add(function(){t._createCollection(n)})),this.signInState.signIn());n.preventDefault()},f.prototype.onEditCancelClick=function(n){this._clear();this.completed.invoke(null);n&&n.preventDefault()&&n.stopPropagation()},f.prototype.onTaskStateChanged=function(n){if(n.animationState===1||n.activationState===1){var t=this.getControl().select(".addNameControl");t[0]&&t[0].focus()}},f.prototype._clear=function(){this.newTitle="";this.newDescription=""},f.prototype.getTitle=function(){return u.L_AddCollection_Title},f.prototype.displaySave=function(n){return n||!h.enableSignedOutRefresh?"":"none"},f.prototype._createCollection=function(t){var u=this,f;this.setShowProgress(!0);f=i(t.target);f.add_class("inactive");this.AddCollection(this.newTitle,this.newDescription,this.getIsPublic(),function(t,i){if(u.setShowProgress(!1),f.has_class("inactive")&&f.remove_class("inactive"),i===0)n.logAction(r.newCollectionSave,{SUCCESS:"True"}),u.setMessageText(null),u._primitives&&b.clearCollection(),u._clear(),u.completed.invoke(t?t.id:null);else{n.logAction(r.newCollectionSave,{SUCCESS:"False",ERR:i});switch(i){case 2:u.setMessageText(u.resources.L_Max_Collections_Message.replace("{0}",h.maxAllowedCollections+""));break;default:u.setMessageText(u.resources.L_CollectionError_Adding_Text)}}})},f.prototype._validateTitleAndDescription=function(){return this.getShowProgress()?!1:this.newTitle&&this.newTitle.trim().length!==0?this.newTitle.length>100?(this.setMessageText(this.resources.L_TitleLengthError_Text),!1):this.newDescription.length>1e3?(this.setMessageText(this.resources.L_DescLengthError_Text),!1):!0:(this.setMessageText(this.resources.L_CollectionNameMissing_Text),!1)},f}(e),oi=function(t){function f(n,i,r,f,e,s){var h=this,c={},l;return h=t.call(this,c,n,iu,i)||this,c.defineProperty("showAutoSuggest"),c.defineProperty("inputText"),c.defineProperty("descriptionText"),c.defineProperty("isAddHome"),c.defineProperty("viewText"),c.defineProperty("isAdd"),c.defineProperty("showOnMap"),h.setIsAddHome(f),h.setIsAdd(!e||e===""),h._titleText=h._inputText=e,h._descriptionText=s,h.setViewText(e&&e!==""?f?u.L_EditHome_Text:u.L_EditWork_Text:f?u.L_AddHome_Text:u.L_AddWork_Text),h.setShowAutoSuggest(!1),h.setShowProgress(!1),h.setMessageText(null),e?(l=f?i.home:i.work,l&&h.setShowOnMap(l.entity.getShowOnMap())):h.setShowOnMap(!0),h.setInputText(e),h.setDescriptionText(s),h.completed=new o,h.resolveSuggestion=new o,h.resolveSearch=new o,h.processLocalDetailsCards=new o,h._suggestionItemSelected=new o,h._suggestionItemSelected.add(function(n){h._onSuggestionSelected(n)}),h._suggestionItemClicked=new o,h._suggestionItemClicked.add(function(n){h._onSuggestionClicked(n)}),h._onFocus=new o,h._onFocus.add(function(n){h._onInputFocus(n)}),h._onAutosuggest=new o,h._onAutosuggestBlur=new o,h._onAutosuggestKeydown=new o,h._onAutosuggestKeydown.add(function(n){h._onKeydown(n)}),h._geoLocationProvider=r,h._favorite=null,h}return l(f,t),f.prototype.onBackClick=function(n){var t=this,i;this._inputText!==this._titleText&&this._favorite?(this.setInputText(""),this.setDescriptionText(""),i=function(){t._favorite=null;t.completed.invoke()},this.dataManager.removeFavorite(this._favorite,i)):(this.dataManager.favoritePrimitivesChanged.invoke(),this.completed.invoke());n&&n.preventDefault()&&n.stopPropagation()},f.prototype.initAutosuggest=function(n){var t=this.getControl(),r=i("input",t[0]),u=i(".searchboxWithAS.favoritesAS",t[0]),f,e;u&&r&&n&&(f=i(u[0]),this._autoSuggestModel=new gt,this._autoSuggestModel.updateOptions({showMyLocation:!1}),this.processLocalDetailsCards.invoke(),this._autosuggest&&this._autosuggest.removeEventHandlers(),this._autosuggestViewModel=new ir(this._autoSuggestModel,this.controlTemplateFactory),e="as_container_directions",this._autosuggest=new tr(f,r,e,this._autosuggestViewModel,n),this._autosuggest.setItemSelectionEventHandler(this._suggestionItemSelected),this._autosuggest.setItemClickEventHandler(this._suggestionItemClicked),this._autosuggest.setFocusEventHandler(this._onFocus),this._autosuggest.setAutosuggestKeydownHandler(this._onAutosuggestKeydown),this._autosuggest.setOnAutosuggestHandler(this._onAutosuggest),this._autosuggest.setAutosuggestBlurHandler(this._onAutosuggestBlur),this._focusSearchBox())},f.prototype.setIsChecked=function(n){return n?n:!1},f.prototype.getTitle=function(){return this.getIsAddHome()?u.L_AddHome_Title:u.L_AddWork_Title},f.prototype.handleResolveSuggestionCallback=function(n){var f,e,i,r,o,t;if(n.processorType===c.localDetailsTask||n.processorType===c.polygonEntityDetailsTask){if(n.outData){for(f=n.outData,e=[],i=0;i<f.length;i++)r=f[i].data,r&&r.length&&e.push(r[0]);gt.appendLocalDetailCards(e);this._autosuggest&&this._autosuggest.refreshAutosuggest()}}else if(n.processorType===c.localSearchTask){if(n.outData&&n.outData.length===1&&n.outData[0].data&&n.outData[0].data.entities&&n.outData[0].data.entities.length>0&&(o=n.outData[0].data.entities,t=o[0],t&&t.getLocation())){this._titleText=t.getTitle();this.setInputText(this._titleText);this._newHomeOrWork=t;(!h.enableSignedOutRefresh||this.signInState.getIsSignedIn())&&this._setHomeOrWork(t);this.setShowProgress(!1);return}this.setShowProgress(!1);this.setShowAutoSuggest(!1);this.setMessageText(u.L_AutoSuggestSearchFailed_Message.replace("{0}",this.getInputText()))}},f.prototype.onAddButtonClick=function(t){t&&t.preventDefault()&&t.stopPropagation();this.getInputText()&&this.getInputText()!==""&&(this.setMessageText(null),h.enableSignedOutRefresh?this._newHomeOrWork&&this._setHomeOrWork(this._newHomeOrWork):this._commitSuggestionToFavorite(),this.dataManager.favoritePrimitivesChanged.invoke(),this._favorite&&(this.getIsAddHome()?n.logAction(r.favorites,{SHM:"True"}):n.logAction(r.favorites,{SWK:"True"})),this.completed.invoke())},f.prototype.onSearchButtonClick=function(n){this.getInputText()&&this.getInputText()!==""&&(this.setMessageText(null),this._commitSuggestionToFavorite());n.preventDefault()},f.prototype.onShowOnMapClick=function(n){n.preventDefault();n.stopPropagation();this.setShowOnMap(!this.getShowOnMap())},f.prototype.onDescriptionBlur=function(n){var t=n.currentTarget,i;t.value!==null&&(i=t.value,this.setDescriptionText(i));n.preventDefault()},f.prototype.onDescriptionClick=function(n){var r=n.currentTarget,t,i;r instanceof HTMLTextAreaElement&&(this._inputHasFocus=!1,t=r,t.placeholder="",i=t.value.length,i>0&&t.selectionStart-t.selectionEnd==0?t.select():t.selectionStart=i);n.stopPropagation();n.preventDefault()},f.prototype.addEditButtonText=function(n){return n?u.L_AddHomeWork_Button:u.L_EditMode_Text},f.prototype.itemCheckedClass=function(n){return"multiselectCheckbox"+(n?" checked":"")},f.prototype.setDescriptionEditTextValue=function(){var t=this.getControl()[0],n=i(".editHomeWorkDescriptionControl",t)[0];n&&n instanceof HTMLTextAreaElement&&this.getDescriptionText()&&(n.value=this.getDescriptionText())},f.prototype.inputTextToHideButton=function(n){return this.boolToNotDisplay(!this._inputHasFocus&&n&&n===this._titleText)},f.prototype.inputTextToShowButton=function(n){return this.boolToDisplay(!this._inputHasFocus&&n&&n===this._titleText)},f.prototype.onSignInAndSaveClick=function(n){var t=this;this.disposables.push(this.signInState.notifySignedIn.add(function(){t.onAddButtonClick(n)}));this.signInState.signIn();n.preventDefault()},f.prototype._onSuggestionSelected=function(n){this._suggestion=n;this._inputHasFocus=!1;n&&this.setInputText(n.title)&&(this._titleText=n.title)},f.prototype._onSuggestionClicked=function(n){this._suggestion=n;n&&this.setInputText(n.title)&&(this._titleText=n.title);this._commitSuggestionToFavorite()},f.prototype._onInputFocus=function(n){this._inputHasFocus=n;n?(this.setShowAutoSuggest(!0),this.setMessageText(null),this._autosuggest.refreshAutosuggest()):this.setShowAutoSuggest(!1)},f.prototype._onKeydown=function(n){this.getShowAutoSuggest()||(this.setShowAutoSuggest(!0),this.setMessageText(null));var t=n.keyCode||n.which;t===13&&(this._onSuggestionSelected(this._autosuggestViewModel.getSelectedSuggestion()),this._commitSuggestionToFavorite())},f.prototype._commitSuggestionToFavorite=function(){var n,t,i,r;this.setShowProgress(!0);this._suggestion?this._suggestion.searchText===u.L_Collections_MyLocation?this._getCurrentPosition():this.resolveSuggestion.invoke(this._suggestion):(n=this.getInputText().trim(),n&&n!==""?n!==this._titleText&&this.resolveSearch.invoke(n):(this.setMessageText(u.L_FailedSaveFavorite_Message),this.setShowProgress(!1)));this.getDescriptionText()!==this._descriptionText&&(this.getIsAddHome()?(t=this.dataManager.home.entity,t&&t.setDescription(this.getDescriptionText())):(i=this.dataManager.work.entity,i&&i.setDescription(this.getDescriptionText())),this.dataManager.homeOrWorkChanged.invoke());this._titleText&&(r=this.getIsAddHome()?this.dataManager.home:this.dataManager.work,r&&r.entity.setShowOnMap(this.getShowOnMap()),this.dataManager.homeOrWorkChanged.invoke())},f.prototype._setHomeOrWork=function(n){var i=n.getAddress(),r=n.getDescription(),u=n.id&&n.id.length<=50&&(n.id.toLowerCase().indexOf(ft.ypid)===0||n.id.toLowerCase().indexOf(ft.sid)===0)?n.id:null,t=n.getLocation();this._createHomeOrWork(n.getTitle(),i,u,{x:t.longitude,y:t.latitude,bounds:[t.latitude,t.longitude,t.latitude,t.longitude]},n.getImageUrl(),i===r?"":r)},f.prototype._createHomeOrWork=function(n,t,i,r,f,e){var s=this,o=new ht,h;o.entity=new ii;o.entity.setOriginalName(n);o.entity.setName(n);o.entity.setAddress(t);o.entity.setShowOnMap(this.getShowOnMap());e&&e.length>0&&o.entity.setDescription(e);o.entity.setBusinesslistingid(i);f&&o.entity.setPhotoUrl(f);o.setGeometry(r);h=function(n,t){s.setShowProgress(!1);s.setMessageText(null);s._favorite=n;t!==0&&(s.setShowAutoSuggest(!1),t===12?s.setMessageText(u.L_CreateFavoriteError_AlreadyExists):s.setMessageText(u.L_FailedSaveFavorite_Message))};this.getIsAddHome()?this.dataManager.setHome(o,h):this.dataManager.setWork(o,h)},f.prototype._onGeolocationCallback=function(n){if(!n.error){var i=u.L_Collections_MyLocation,r=n.addressList&&n.addressList[0].formattedAddress?n.addressList[0].formattedAddress:null,t=new lt(n.location.latitude,n.location.longitude);this._createHomeOrWork(i,r,null,{x:t.longitude,y:t.latitude,bounds:[t.latitude,t.longitude,t.latitude,t.longitude]},null,this.getDescriptionText());this._titleText=i;this.setInputText(this._titleText)}this.setShowProgress(!1)},f.prototype._getCurrentPosition=function(){var n=this,t={callback:function(t){n._onGeolocationCallback(t)},performReverseGeocoding:!0};this._geoLocationProvider.GetCurrentPosition(t)},f.prototype._focusSearchBox=function(){var n=i(".searchboxAS input",this.getControl()[0]);n[0]&&n[0].focus()},f}(e),st=function(n){function t(t,i,r,u,f){var e=this;return e=n.call(this,{},t,ou,i)||this,e.completed=new o,e.polyshape=u,e._poiManager=r,e._poiManager.viewThisPrimitive(e.polyshape),e.collectionTitle=f,e.polyshape.geometryType===2?e.lengthText=e.polyshape.getLengthText():e.polyshape.geometryType===3&&(e.areaText=e.polyshape.getAreaText()),e}return l(t,n),t.prototype.dispose=function(){n.prototype.dispose.call(this)},t.prototype.onBackClick=function(n){this.completed.invoke();n.preventDefault()},t.prototype.getTitle=function(){return this.polyshape&&this.polyshape.entity?this.polyshape.entity.name:"Polyshape"},t.prototype.shouldShowPhoto=function(n){return this.boolToDisplay(n&&n.length>0)},t.prototype.convertPhotoUrlToSource=function(n){return n!==""?this.makePhotoUrlHttps(n):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyBAMAAADsEZWCAAAAGFBMVEWpqani4uJ1dXX///+2trbDw8PY2Njr6+tZYlZfAAAAoklEQVR4Xt3SPQ6CQBiE4dmwi61/cABOIE7Q1sp6DYk1RA9gYrHXlx8Jcfm2MLEwvMlUTztYhZqJpBZXWSoA9VQSXNCkpmKhW4mncgK+lLHZyh1duvYlxbvYl2QQ48t2EC3KLiSmCInKQxKxk3XWNYpzTzr3EOTGtkoQ00IBQbAgjxBFkbksEUlZysOZVpSNRbnshfsPsWgmSd9PJJP67/e+AHsUWtUxgpHkAAAAAElFTkSuQmCC"},t.prototype.handleImageErrorEvent=function(n){var t=n.target;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyBAMAAADsEZWCAAAAG1BMVEXi4uKoqKj///+4uLjX19fR0dHv7++CgoJ1dXX5BwZcAAAAoklEQVQ4y+3SsQ6CMBSF4QvVnaZEHM0xYa6JD9DEPoASdTYMzA4kPII+trVxau/dZOMfunw5tANES/O0usWuuSgda5wk21GUl5PkPTJS4RIkGyl977DXzTQ9UzHog4Qq/p6/i5XEkCRWEkPc147DSVvFvKAGoOjASB/koZhXbwK0VDBSfifU5lLHSYkiky5OgF0q698EOKd/lffekY/n0jx9ADnBHVdIITYgAAAAAElFTkSuQmCC"},t}(e),d=function(n){function t(t,i,r,f,e,s,c,l,a){var v=this,p={},y,w,b;return v=n.call(this,p,t,su,i)||this,p.defineProperty("favoriteMessage"),p.defineProperty("showFavoriteProgress"),v._poiManager=f,v.setShowProgress(!0),v.setMessageText(null),v.tabDeactivated=new o,v._perfLog=s,v._taskId=r,v.setFavoriteMessage(v.resources.L_AddFavoritesMessage_Text),y=[u.L_FavoriteTitle_Text,u.L_CollectionSubTitle_Text],w=function(){vr.requestTabControl(y,function(n,t){v._tabControlId=t;v.setShowProgress(!1);v._insertTabControl(n)},null,0,!0)},v.favoritesViewModel=new di(t,v.dataManager,v._taskId,v._poiManager,c,l,a),v.collectionsViewModel=new bu(t,v.dataManager,e,s,a),h.enableItineraryTab?(y=[u.L_FavoriteTitle_Text,u.L_ItinerariesSubTitle_Text,u.L_CollectionSubTitle_Text],v.itinerariesViewModel=new gi(t),w()):(b=new ri,b.retrieveAllItinerariesMetaData(function(n,i){i===0&&n&&n.length&&(y=[u.L_FavoriteTitle_Text,u.L_ItinerariesSubTitle_Text,u.L_CollectionSubTitle_Text],v.itinerariesViewModel=new gi(t));w()})),v}return l(t,n),t.prototype.dispose=function(){n.prototype.dispose.call(this);this._tabDeactivateHandler&&sj_evt.unbind("tabdeactive",this._tabDeactivateHandler)},t.prototype.getPrintContent=function(){return this.favoritesViewModel.getPrintContent()},t.prototype._insertTabControl=function(n){var r=this,u=this.getControl(),f=u.length&&i(".collectionsCard",u[0]),s,o,c,l,a,e;f&&(n.length>0&&n[0].innerHTML?f.appendHTML(n[0].innerHTML):f.append(n),this._tabDeactivateHandler=function(n){n[1]===r._tabControlId&&r.tabDeactivated.invoke(n[2])},sj_evt.bind("tabdeactive",this._tabDeactivateHandler),s=i(".tabNumber0",u[0]),s.append(this.favoritesViewModel.getControl()),o=i(".tabNumber1",u[0]),this.itinerariesViewModel?(o.append(this.itinerariesViewModel.getControl()),c=i(".tabNumber2",u[0]),c.append(this.collectionsViewModel.getControl()),h.enableSignedOutRefresh&&!this.signInState.getIsSignedIn()&&(l=ot&&ot.isEnabled()&&ot.getItem(t.localStorageKey),l||(a=i(".tab-head",u[0]),this._windowClickEventHandler=function(){window.clearTimeout(r._tipShownTimeout);window.removeEventListener("click",r._windowClickEventHandler)},Microsoft.Maps.setTimeout(function(){window.addEventListener("click",r._windowClickEventHandler)},1),this._tipShownTimeout=Microsoft.Maps.setTimeout(function(){window.removeEventListener("click",r._windowClickEventHandler);r._showTempCollectionTip(a)},2e3)))):o.append(this.collectionsViewModel.getControl()),e=f.select(".tab-container"),e&&e.length&&e.set_style({"-ms-touch-action":"auto"}).set_style({"touch-action":"auto"}))},t.prototype._showTempCollectionTip=function(n){var f=this,i=new ai(null,"",[u.TempCollectionTip],!1,!0,!0),r;i.setShowClose(!1);i.setShowBeak(!0);this.disposables.push(i.tipRemoved.add(function(){f.tooltip=null}));r=i.getRootElement();n.append(r);this.tooltip&&this.tooltip.removeTip();this.tooltip=i;ot&&ot.isEnabled()&&ot.setItem(t.localStorageKey,!0)},t.localStorageKey="SignedOutTipShown",t}(e),w=function(t){function f(i,u,f,e,s,h,c,l,a){var v=this,y={},p;return v=t.call(this,i,u,f,e,s,h,c,l,a,y,eu)||this,y.defineProperty("isSaveOpened",function(n,t){return v._onIsSaveOpenedChange(n,t)}),y.defineProperty("collectionsList"),y.defineProperty("isClearConfirmationOpen"),v.addCollectionRequested=new o,v.flipToCollection=new o,v._windowClickEventHandler=function(n){v._hideSaveDropdown(n)},p=v.signInState.getIsSignedIn(),p||v.signInState.notifySignedIn.add(function(){v.collection.primitives.length===0&&v.completed.invoke()}),n.logAction(r.viewTemporaryCollection,{STATE:p}),v}return l(f,t),f.prototype.getTemporaryCollection=function(n){this.setShowProgress(!0);this.setMessageText(null);var t=b.getCollection();t&&(this.setIsPublic(t.isPublic),this.collection=t);n()},f.prototype.serializeCollection=function(){return JSON.stringify(g.serialize(this.collection))},f.prototype.makeDeleteCall=function(n,t){n==="CLEAR"?(b.clearCollection(),this._deleteConfirmationShown.set_style({display:"none"})):b.removePoint(n);t(0)},f.prototype.makeUpdateCall=function(n){b.updatePoint(n.entity.id,n.entity.name,n.entity.description)},f.prototype.onActivateSelectClick=function(n){this._deleteConfirmationShown&&(this._deleteConfirmationShown.set_style({display:"none"}),this._deleteConfirmationShown=null);t.prototype.onActivateSelectClick.call(this,n)},f.prototype.onDeleteClick=function(t){var e;if(this._primitiveInteracted&&this._primitiveInteracted.invoke({action:2}),t.target&&!this._deleteConfirmationShown){var u=t.target.attributes["data-entityId"].value,f=i("div[data-entityId="+u+"].cardDeleteConfirmationRow",this.getControl()[0]);f.length>0&&(this._deleteConfirmationShown=f,this._deleteConfirmationShown.set_style({display:"block"}),this.setIsClearConfirmationOpen(u==="CLEAR"));e=u==="CLEAR"?"CLEAR":"ENT";n.logAction(r.deleteButtonClicked,{Type:e})}else this._deleteConfirmationShown.set_style({display:"none"}),this._deleteConfirmationShown=null,this.setIsClearConfirmationOpen(!1);this._primitiveInteracted&&this._primitiveInteracted.invoke({action:3});t.stopPropagation();t.preventDefault()},f.prototype.onCancelDeleteClick=function(n){this.setIsClearConfirmationOpen(!1);t.prototype.onCancelDeleteClick.call(this,n)},f.prototype.onSaveClick=function(t){var i=this;this.signInState.getIsSignedIn()?(this.setIsSaveOpened(!0),this.dataManager.retrieveAllCollectionsMetaData(function(n,t){t===0&&i.setCollectionsList(n.collections)})):h.enableSignedOutRefresh&&this._showSignInTip();n.logAction(r.saveButtonClicked,{EP:6});t.stopPropagation();t.preventDefault()},f.prototype.onSaveToNewCollection=function(t){this.setIsSaveOpened(!1);this.addCollectionRequested.invoke(this.collection.primitives);n.logAction(r.saveTemporaryCollection,{EP:6,TYPE:"NEW"});t.stopPropagation();t.preventDefault()},f.prototype.onSaveToExistingCollection=function(t){var h=this,s,u,f,i,e,o;for(this.setIsSaveOpened(!1),s=t.target.attributes["data-entityId"].value,f=this.getCollectionsList(),i=0;i<f.length;i++)if(f[i].id===s){u=f[i];break}if(u){for(e=this.collection.primitives.length,i=e-1;i>=0;i--)o=this.collection.primitives[i],o.entity.id="",u.primitives.insert(o,0);u.setItemCount(u.getItemCount()+e);this.dataManager.updateCollection(u,function(n,t){h._handleUpdateResponse(n,t)},!0)}n.logAction(r.saveTemporaryCollection,{EP:6,TYPE:"EX"});t.stopPropagation();t.preventDefault()},f.prototype.onDragBegin=function(){this._primitiveInteracted&&this._primitiveInteracted.invoke({action:2})},f.prototype.onDragComplete=function(n){this._primitiveInteracted&&this._primitiveInteracted.invoke({action:3});n&&(this._updateDisplayOrder(),b.commitChanges())},f.prototype.showBackButton=function(n){return n||h.enableSignedOutRefresh?e.unlocalizedStrings.emptyString:e.unlocalizedStrings.none},f.prototype._onIsSaveOpenedChange=function(n,t){var u=this,r=i(window);t?Microsoft.Maps.setTimeout(function(){r.add_event("click,contextmenu",u._windowClickEventHandler)},1):n&&r.remove_event("click,contextmenu",this._windowClickEventHandler)},f.prototype._hideSaveDropdown=function(){this.getIsSaveOpened()?this.setIsSaveOpened(!1):i(window).remove_event("click,contextmenu",this._windowClickEventHandler)},f.prototype._handleUpdateResponse=function(t,i){i===0?(this.setMessageText(null),b.clearCollection(),t.primitivesRetrieved=!1,this.flipToCollection.invoke(t.id)):(this.setMessageText(this.resources.L_CollectionError_SaveToExisting),n.logAction(r.saveTemporaryCollection,{Success:!1,ERR:i}),this.setShowProgress(!1))},f.prototype._showSignInTip=function(){var t=this,n=new ai(null,"",[],!0,!0),i,r;n.setShowClose(!1);n.setShowBeak(!0);n.setSignInTitle(u.SignInTip);this.disposables.push(n.tipRemoved.add(function(){t.signInTooltip=null}));this.disposables.push(n.signedIn.add(function(){t.signInTooltip.removeTip()}));i=this.getControl().select("div.saveTempContainer");r=n.getRootElement();i.append(r);this.signInTooltip&&this.signInTooltip.removeTip();this.signInTooltip=n},f.tempCollectionId="TEMP",f}(v),wi=function(){function i(n,t,i,r,u,f,e,s){this._viewModelStack=[];this._controlTemplateFactory=n;this._dataManager=t;this._poiManager=i;this._geoLocationProvider=r;this._primitiveToAdd=null;this.viewLoading=new o;this.viewLoaded=new o;this._primitiveInteracted=u;this._disposables=[];this.taskId="";this._perfLog=s;this._transientLensViewModel=f;this._contextMenu=e}return i.prototype.start=function(i){var u=this,e,o,f;if(i&&i.action){this._state=i;switch(i.action){case t.AddEntity:i.data&&(e=i.data,this._createPrimitiveToAddFromData(e),i.collectionId||(n.logAction(r.viewAddNewCollection,{EP:i.entryPoint}),this._createAddCollectionViewModel()));break;case t.AddCollection:n.logAction(r.viewAddNewCollection,{EP:i.entryPoint});this._createAddCollectionViewModel();break;case t.GetAllCollections:n.logAction(r.viewMyPlaces,{EP:i.entryPoint});o=new bt;o.getIsSignedIn()||h.enableSignedOutRefresh?this._createTabbedMyPlacesViewModel():this._createTemporaryCollectionViewModel();break;case t.ViewCollection:i.collectionId&&this._activateCollectionEntitiesView(i);break;case t.ViewCollectionReadOnly:i.collectionId&&(i.entryPoint||(i.entryPoint=4),n.logAction(r.viewCollection,{EP:i.entryPoint}),this._createCollectionEntitiesViewModel(i.collectionId));break;case t.LoadSharedTemporaryCollection:i.action=t.ViewCollectionReadOnly;i.serializedCollection?this._createCollectionEntitiesViewModel(null,!0,i.serializedCollection):i.collectionFromSp&&this._createCollectionEntitiesViewModel(null,!0,null,i.collectionFromSp);break;case t.ViewFavorites:i.entityId?this.isMyPlacesActive(i.entityId,function(n,t){n&&t===0?(u._taskDisplayState.activationState=1,u.setTaskDisplayState(u._taskDisplayState)):u._createTabbedMyPlacesViewModel()}):this._createTabbedMyPlacesViewModel();break;case t.ShowTemporaryCollection:f=this._getActiveViewModel();f&&f instanceof w||this._createTemporaryCollectionViewModel();break;default:ti.assert(!1,"Invalid action when starting the collections flow")}}else ti.assert(!1,"Invalid state when starting the collections flow")},i.prototype.end=function(){while(this._viewModelStack.length)this._viewModelStack.pop().dispose();if(this._viewModelStack=[],this._activeEntitiesViewModel=null,this._disposables)for(var n=0;n<this._disposables.length;n++)this._disposables[n].dispose()},i.prototype.setDataManager=function(n){this._dataManager=n},i.prototype.getAllCollections=function(t){var i=n.perfLog(this._perfLog,nt.getCollections);this._dataManager.retrieveAllCollectionsMetaData(function(n,r){i&&i.end();r===0?t(n):t(null)})},i.prototype.getCollection=function(t,i){var u=n.perfLog(this._perfLog,nt.getCollectionList);this._dataManager.retrieveCollection(t,function(t,f){u&&u.end();f===0?i(t):(n.logAction(r.processCollections,{TYPE:"PSS",ERR:f}),i(null))})},i.prototype.saveEntityToCollection=function(n,t,i){var r=this;this._createPrimitiveToAddFromData(n);this._dataManager.retrieveCollection(t,function(n,u){u===0&&n&&r._dataManager.addPrimitive(t,r._primitiveToAdd,i)})},i.prototype.getPrintContent=function(){var n=this._getActiveViewModel(),t=null;return n instanceof d?t=n.getPrintContent():n instanceof v&&(t=n.getPrintContent()),t},i.prototype.cleanUpPrintPrimitives=function(){var n=this._getActiveViewModel(),t;n instanceof d?(t=n.favoritesViewModel.getFavorites(),t&&this._resetFavoritePrimitives(t,n)):n instanceof v&&this._resetCollectionPrimitives(n)},i.prototype.setTaskDisplayState=function(n){var t=null,u,i,r;if(n.activationState===1||n.activationState===2)for(u=this._viewModelStack.length-1;u>=0;u--)t=this._viewModelStack[u],t instanceof d&&n.activationState===2&&(i=t,i.setShowProgress(!1),i.favoritesViewModel&&i.favoritesViewModel.setShowProgress(!1),i.collectionsViewModel&&i.collectionsViewModel.setShowProgress(!1)),n.stackOrder>1&&t instanceof rt&&t.setShowBackButton(!0);else t=this._getActiveViewModel(),t&&t instanceof v&&(r=t,r.setIsSelectState(!1),r.resetCollectionTitle(),r.cleanUpSelectMode(),r.setRouteClass(""));if(t!==null&&t instanceof rt)t.onTaskStateChanged(n);this._taskDisplayState=n},i.prototype.isActiveCollection=function(n,t){var u=!1,r,i;if(t){if(this._taskDisplayState&&(this._taskDisplayState.activationState===1||this._taskDisplayState.activationState===3||this._taskDisplayState.activationState===2))for(r=0;r<this._viewModelStack.length;r++)if(i=this._viewModelStack[r],i instanceof v&&i.collection.id===n){if(i instanceof w){t(null,0,!0);return}this._dataManager.retrieveCollection(n,function(n,r){r===0?(i.collection=n,i.collection.changed.invoke(),i.changed.invoke(),t(n,r)):t(null,r)});u=!0;break}u||t(null,7)}},i.prototype.selectViewDefaultFocus=function(){return this._getActiveViewModel()instanceof rt},i.prototype.isMyPlacesActive=function(n,t){var r,u,i;t&&(this._isActiveTask()?(r=this._getActiveViewModel(),r instanceof d?(u=r,i=u.favoritesViewModel.getEntityFromId(n),i&&i.entity.getPlaceId().length>0?t(i.entity,0):t(null,10)):t(null,11)):t(null,5))},i.prototype.leaveAddHomeWork=function(){var n=this._getActiveViewModel();if(n instanceof oi)n.onBackClick(null)},i.prototype._resetFavoritePrimitives=function(n,t){for(var i,f,e,r=[],u=0;u<n.length;u++)i=n[u].entity,i.getIconText()&&i.getIconText().length>0&&i.setIconText(""),i.getIconSource()&&i.getIconSource().length>0&&i.setIconSource(""),r.push(n[u]);f=t.favoritesViewModel.getHome();f&&r.push(f);e=t.favoritesViewModel.getWork();e&&r.push(e);this._poiManager.setPrimitives(r)},i.prototype._resetCollectionPrimitives=function(n){var i=n.collection,u,r,t;if(i&&i.primitives){for(u=[],r=0;r<i.primitives.length;r++)t=i.primitives[r].entity,t.iconText&&t.iconText.length>0&&(t.iconText=""),t.iconSource&&t.iconSource.length>0&&(t.iconSource=""),u.push(i.primitives[r]);this._poiManager.setPrimitives(u)}},i.prototype._isActiveTask=function(){return this._taskDisplayState&&(this._taskDisplayState.activationState===1||this._taskDisplayState.activationState===3||this._taskDisplayState.activationState===2)},i.prototype._activateCollectionEntitiesView=function(t){var i=this;this._dataManager.doesMyPlacesExist()?this._createCollectionEntitiesViewModel(t.collectionId):this.getAllCollections(function(n){n&&i._createCollectionEntitiesViewModel(t.collectionId)});n.logAction(r.viewCollection,{EP:t.entryPoint})},i.prototype._activateFavoritesView=function(t){var i=this;this._dataManager.doesMyPlacesExist()?this._createTabbedMyPlacesViewModel():this.getAllCollections(function(n){n&&i._createTabbedMyPlacesViewModel()});n.logAction(r.viewMyPlaces,{EP:t.entryPoint})},i.prototype._onAddCollectionRequested=function(n){this._createAddCollectionViewModel(n)},i.prototype._onAddCollectionCompleted=function(n,t){var i=this._state.isMove;this._addPrimitiveFlow(n,t||i);i&&this._dataManager.collectionAdded.invoke(!!n);this._primitiveToAdd=null;(!n||t||i)&&this._goBack()},i.prototype._addPrimitiveFlow=function(t,i){var u=this;t&&(this.viewLoading.invoke(),this._primitiveToAdd?this._dataManager.addPrimitive(t,this._primitiveToAdd,function(f,e){e!==0?n.logAction(r.editCollection,{TYPE:"SP2NC",ERR:e}):(n.logAction(r.editCollection,{TYPE:"SP2NC",EP:6}),i||u._createCollectionEntitiesViewModel(t))}):this._createCollectionEntitiesViewModel(t))},i.prototype._goBack=function(){var n=this._viewModelStack.pop(),r=n instanceof rt?!0:!1,u=n instanceof v?!0:!1,f=n instanceof w?!0:!1,e=n instanceof st?!0:!1,i;n.dispose();i=this._getActiveViewModel();i?(i instanceof rt?this._viewModelStack.length<=1?p.invokeHandler(y.taskDataHandlerKey,{action:"remove",id:this.taskId}):(n=this._viewModelStack.pop(),n instanceof rt&&n.dispose(),this._reloadMyPlaces(),i=this._getActiveViewModel()):!(i instanceof v)||e||this._state.action===t.ShowTemporaryCollection&&r||(this._state.action=t.ViewCollection,n=this._viewModelStack.pop(),n instanceof v&&n.dispose(),this._reloadMyPlaces(),i=this._getActiveViewModel()),this.viewLoading.invoke(),this.viewLoaded.invoke(i)):r&&this._taskDisplayState.stackOrder&&(this._taskDisplayState.stackOrder>1||this._state.action===t.AddEntity)?p.invokeHandler(y.taskDataHandlerKey,{action:"remove",id:this.taskId}):r&&this._state.action===t.AddCollection||u&&this._state.action===t.ViewCollection||u&&f?this._createTabbedMyPlacesViewModel():ti.assert(!0,"Failed to return to previous task")},i.prototype._reloadMyPlaces=function(){var n=this._getActiveViewModel(),t;n&&n instanceof d?(t=n,t.collectionsViewModel.getCollectionsContent(function(){t.collectionsViewModel.getMyPlaces().collections.changed.invoke()})):this._createTabbedMyPlacesViewModel()},i.prototype._onCollectionSelected=function(n){n!==w.tempCollectionId?this._createCollectionEntitiesViewModel(n):this._createTemporaryCollectionViewModel()},i.prototype._getActiveViewModel=function(){return this._viewModelStack&&this._viewModelStack.length>0&&this._viewModelStack[this._viewModelStack.length-1]},i.prototype._createPrimitiveToAddFromData=function(n){this._primitiveToAdd=ut.simplePointFactory(n)},i.prototype._createTabbedMyPlacesViewModel=function(){var i=this,r,t,u,f,e,o;this.viewLoading.invoke();r=n.perfLog(this._perfLog,nt.loadMyPlacesView);t=new d(this._controlTemplateFactory,this._dataManager,this.taskId,this._poiManager,this._primitiveToAdd?!0:!1,this._perfLog,this._transientLensViewModel,this._contextMenu,this._primitiveInteracted);this._viewModelStack.push(t);u=t.collectionsViewModel.collectionSelected.add(function(n){i._onCollectionSelected(n);i._primitiveInteracted&&i._primitiveInteracted.invoke({action:2})});this._disposables.push(u);f=t.collectionsViewModel.addCollectionRequested.add(function(){i._onAddCollectionRequested()});this._disposables.push(f);e=t.favoritesViewModel.addHomeWorkRequested.add(function(n){i._createAddHomeWorkViewModel(n)});this._disposables.push(e);this.viewLoaded.invoke(t);o=t.favoritesViewModel.favoritesLoadedInView.add(function(){r&&r.end()});this._disposables.push(o)},i.prototype._createTemporaryCollectionViewModel=function(){var i=this,u,r,f,e,o,s,h;this.viewLoading.invoke();u=n.perfLog(this._perfLog,nt.loadCollectionEntitiesView);r=new w(this._controlTemplateFactory,this._dataManager,this.taskId,this._poiManager,this._geoLocationProvider,this._transientLensViewModel,this._contextMenu,this._primitiveInteracted,this._perfLog);this._state.action=t.ShowTemporaryCollection;f=r.completed.add(function(){i._goBack();i._poiManager.refreshMap(!1)});this._disposables.push(f);e=r.addCollectionRequested.add(function(n){i._onAddCollectionRequested(n)});this._disposables.push(e);o=r.flipToCollection.add(function(n){i._goBack();n&&i._createCollectionEntitiesViewModel(n)});this._disposables.push(o);this._activeEntitiesViewModel=r;s=r.launchDetails.add(function(){i._primitiveInteracted.invoke({action:2})});this._disposables.push(s);h=r.launchPolyshapeDetails.add(function(n){var t=i._getActiveViewModel();t instanceof st&&(i._poiManager.setPoiState(t.polyshape,0),i._goBack());i._createPolyshapeDetailsViewModel(n)});this._disposables.push(h);r.setState(this._state);r.getTemporaryCollection(function(){i._viewModelStack.push(r);i.viewLoaded.invoke(r);r.setShowProgress(!1);u&&u.end()})},i.prototype._createCollectionEntitiesViewModel=function(t,i,r,f){var o=this,h,s,e,c,l,a,y,p;this.viewLoading.invoke();s=n.perfLog(this._perfLog,nt.loadCollectionEntitiesView);e=new v(this._controlTemplateFactory,this._dataManager,this.taskId,this._poiManager,this._geoLocationProvider,this._transientLensViewModel,this._contextMenu,this._primitiveInteracted,this._perfLog);this._activeEntitiesViewModel=e;this._viewModelStack.length>0&&(h=this._viewModelStack[0]);c=e.completed.add(function(){o._goBack();o._poiManager.refreshMap(!1)});l=e.showMessage.add(function(){o._primitiveInteracted.invoke({action:2})});this._disposables.push(l);this._disposables.push(c);a=e.launchDetails.add(function(){o._primitiveInteracted.invoke({action:2})});this._disposables.push(a);y=e.launchPolyshapeDetails.add(function(n){var t=o._getActiveViewModel();t instanceof st&&(o._poiManager.setPoiState(t.polyshape,0),o._goBack());o._createPolyshapeDetailsViewModel(n)});this._disposables.push(y);e.setState(this._state);i?(p=!f,p&&(f=JSON.parse(r)),e.collection=g.deserialize(f),e.collection.name=u.L_SharedTemporaryCollection_Title,e.collection.isPublic=!0,this._viewModelStack.push(e),this.viewLoaded.invoke(e),s&&s.end()):e.getCollectionContent(t,function(){o._activeEntitiesViewModel===e&&(o._viewModelStack.push(e),e.setUseDetailsBackText(o._state.entryPoint===3&&o._primitiveToAdd?!0:!1),o.viewLoaded.invoke(e),h&&h.setShowProgress(!1),e.setShowProgress(!1),s&&s.end())})},i.prototype._createAddCollectionViewModel=function(n){var u=this,i,r,f,e;this.viewLoading.invoke();i=new rt(this._controlTemplateFactory,this._dataManager,this._state.action!==t.AddEntity,n);this._viewModelStack.push(i);r=this._state.entryPoint===3;f=i.completed.add(function(n){u._onAddCollectionCompleted(n,r)});this._disposables.push(f);e=i.showMessage.add(function(){u._primitiveInteracted.invoke({action:2})});this._disposables.push(e);i.setUseDetailsBackText(r);this.viewLoaded.invoke(i)},i.prototype._createAddHomeWorkViewModel=function(n){var f=this,i,e,o;this.viewLoading.invoke();var r=null,u=null,t=null;n&&this._dataManager.home&&this._dataManager.home.entity?(t=this._dataManager.home.entity,r=t.getName(),u=t.getDescription()):!n&&this._dataManager.work&&this._dataManager.work.entity&&(t=this._dataManager.work.entity,r=t.getName(),u=t.getDescription());i=new oi(this._controlTemplateFactory,this._dataManager,this._geoLocationProvider,n,r,u);i.setDescriptionEditTextValue();this._viewModelStack.push(i);e=i.completed.add(function(){f._goBack()});o=i.showMessage.add(function(){f._primitiveInteracted.invoke({action:2})});this._disposables.push(o);this._disposables.push(e);this.viewLoaded.invoke(i)},i.prototype._createPolyshapeDetailsViewModel=function(n){var i=this,u;this.viewLoading.invoke();var r=this._getActiveViewModel(),f=r&&r.getTitle(),t=new st(this._controlTemplateFactory,this._dataManager,this._poiManager,n,f);this._viewModelStack.push(t);u=t.completed.add(function(){i._goBack();i._poiManager.setPoiState(n,0)});this._disposables.push(u);this.viewLoaded.invoke(t)},i}(),bi=function(n){function t(t,i,r){var u=this,f={};return u=n.call(this,f,t,vi,i)||this,f.defineProperty("Collection"),u._collection=r,u.setPrintIconText(),u.setCollection(u._collection),u}return l(t,n),t.prototype.dispose=function(){this._collection=null},t.prototype.setPrintIconText=function(){for(var t=this._collection.primitives,n=0;n<t.length;n++)t[n].entity.iconText=(n+1).toString(),t[n].entity.iconSource="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAXCAMAAADX9CSSAAAARVBMVEVHcEz5oRv5oRv5oRv5oRv5oRv5oRv5oRv5oRv5oRv5oRv5oRv////6qS38xXP6s0b+6Mb80I37ulf/9+v94rj+7dT93KoSX7LkAAAAC3RSTlMAz6coXOSPEIBAv/JnNQYAAAC5SURBVCjPdZHbDoQgDAVR5OaxgKD7/5+6VVwFyc4LyZykpa0QBTPpeZ71ZESNGfFjrJJJAWGNMa4BUNOt2calEDm5Agf45cED7qytGn0E6uhhQbnxmWDZK3yWlg+UEBK0vCFI/kzqfOIvWaydX7nBf+8779k7hM4HnswA+aUzwIONXSGPsawnNjpeC9KgvdI7QZejDKDt1hthuE7DAVJJtoRbnztlQgrHY+sDS63O6yotxQvjnHsqfAGnsBLW6TbeiAAAAABJRU5ErkJggg=="},t}(e),wu=function(n){function t(t,i,r){var u=this,f={};return u=n.call(this,f,t,i,r)||this,f.defineProperty("itineraries"),u.dataManager.retrieveAllItinerariesMetaData(function(n,t){t===0?u.setItineraries(n):u.setItineraries(new pt)}),u}return l(t,n),t.prototype.onItineraryClick=function(n){if(n&&n.currentTarget){var i=ct.features.optIn.mobileItineraryUrl+"?",t=n.currentTarget.attributes["data-collectionid"];t&&t.value&&(i+="cid="+t.value,window.open(i,"_self"))}},t.prototype.emptyItinerariesToDisplay=function(n){return n>0?"none":""},t.prototype.setItineraryImage=function(n){return n?this.makePhotoUrlHttps(n):""},t.prototype.displayItineraryDayCount=function(n){return(n===1?it.DaySingular:it.DayPlural).replace("{0}",""+n)+" - "},t.prototype.displayItineraryAttractionCount=function(n){return(n===1?it.AttractSingular:it.AttractPlural).replace("{0}",""+n)},t}(at),bu=function(t){function u(n,i,r,u,f){var e=this,h={},s;return e=t.call(this,h,n,ru,i)||this,h.defineProperty("myPlaces"),h.defineProperty("isNoCollections"),h.defineProperty("tempItemCount"),r===null&&(r=!1),e.setMessageText(null),e.disposables.push(e.signInState.notifySignedIn.add(function(n){n&&(e.setShowProgress(!0),e._getMyPlaces(function(){}))})),f&&(e._primitiveInteracted=f),e._perfLog=u,e.collectionSelected=new o,e.addCollectionRequested=new o,e.setIsNoCollections(!1),s=b.getCollection(),s&&s.primitives&&(e.setTempItemCount(s.primitives.length),e.disposables.push(s.primitives.changed.add(function(){e.setTempItemCount(s.primitives.length)}))),e.getCollectionsContent(function(){}),e}return l(u,t),u.prototype.getCollectionsContent=function(n){this.signInState.getIsSignedIn()?(this.setShowProgress(!0),this._getMyPlaces(n)):n()},u.prototype.retrieveAllCollectionsMetadata=function(n){this.dataManager.retrieveAllCollectionsMetaData(function(t,i){n(t,i)})},u.prototype.makeDeleteCall=function(t,i){var u=this;this.dataManager.deleteCollection(t,function(t){t===0?(n.logAction(r.editMyPlaces,{TYPE:"DELC"}),u.setMessageText(null)):(n.logAction(r.editMyPlaces,{TYPE:"DELC",ERR:t}),u.setMessageText(u.resources.L_CollectionError_Deleting_Text));i(t)})},u.prototype.dispose=function(){t.prototype.dispose.call(this)},u.prototype.onCollectionAddClick=function(t){var i=t.target;i&&i.blur();n.logAction(r.viewAddNewCollection,{EP:6});this.addCollectionRequested.invoke();t.preventDefault()},u.prototype.onCollectionClick=function(n){n.type===e.unlocalizedStrings.click&&this._selectCollection(n);n.stopPropagation();n.preventDefault()},u.prototype.onCollectionKeyDown=function(n){if(n.type===e.unlocalizedStrings.keydown){var t=n,i=t.keyCode||t.which;i===13?this._selectCollection(n):i!==9&&(n.stopPropagation(),n.preventDefault())}},u.prototype.onTemporaryCollectionClick=function(n){n.type===e.unlocalizedStrings.click&&this.collectionSelected.invoke(w.tempCollectionId);n.stopPropagation();n.preventDefault()},u.prototype.onDeleteClick=function(t){if(this._primitiveInteracted&&this._primitiveInteracted.invoke({action:2}),t.target&&!this._deleteConfirmationShown){var f=t.target.attributes["data-entityId"].value,u=i("div[data-entityId="+f+"].cardDeleteConfirmationRow",this.getControl()[0]);u.length>0&&(this._deleteConfirmationShown=u,this._deleteConfirmationShown.set_style({display:"block"}));n.logAction(r.deleteButtonClicked,{Type:"COL"})}else this._deleteConfirmationShown&&(this._deleteConfirmationShown.set_style({display:"none"}),this._deleteConfirmationShown=null);this._primitiveInteracted&&this._primitiveInteracted.invoke({action:3});t&&t.stopPropagation();t&&t.preventDefault()},u.prototype.descriptionText=function(n){return n?n:this.resources.L_CollectionDescriptionEdit_Text},u.prototype.setCollectionDescriptionEditTextValue=function(n){var t=i(".collectionDescriptionPreview",n)[0],r;t&&t.textContent.length>0&&(r=i(".editNoteControl",n)[0],this._setDescriptionTextBoxAfterEdit(r,t.textContent))},u.prototype.getTitle=function(){return this.resources.L_MyPlaces_Title},u.prototype.checkNoCollections=function(){var n=this.getMyPlaces();this.setIsNoCollections(!n||!n.collections||n.collections.length===0)},u.prototype._setDescriptionTextBoxAfterEdit=function(n,t){n&&n instanceof HTMLTextAreaElement&&(n.value=t)},u.prototype._getMyPlaces=function(t){var i=this,u=n.perfLog(this._perfLog,nt.getCollections);this.retrieveAllCollectionsMetadata(function(f,e){e===0?(i.setMyPlaces(f),i.setShowProgress(!1),i.checkNoCollections(),i.getIsNoCollections()?i.setMessageText(i.resources.L_AddCollectionWhenNone_Text):i.setMessageText(null),i.changed.invoke()):(n.logAction(r.viewMyPlaces,{ERR:e}),i.setMessageText(i.resources.L_CollectionError_Retrieving_Text),i.setIsNoCollections(!0),i.setShowProgress(!1));u&&u.end();t()})},u.prototype._selectCollection=function(t){var i=t.currentTarget,u=i.id;n.logAction(r.viewCollectionItemDetails,{EP:6});this.collectionSelected.invoke(u)},u.prototype._getCollectionIndexFromId=function(n){var r,u,t,i;if(n)for(r=this.getMyPlaces(),u=r.collections.length,t=0;t<u;t++)if(i=r.collections[t],i&&i.id&&i.id.toLowerCase()===n.toLowerCase())return t;return null},u.prototype._requestCollection=function(n){var t=this;this.dataManager.retrieveCollection(n,function(n,i){i===0?t._activeCollection=n:t.setMessageText(t.resources.L_CollectionError_Retrieving_Text)})},u}(e),ku=function(n){function t(t,i,r,u){var f=this,e={};return f=n.call(this,e,t,i,r)||this,e.defineProperty("home"),e.defineProperty("work"),e.defineProperty("favorites"),f.error=u,u===0&&(f.setHome(f.dataManager.home),f.setWork(f.dataManager.work),f.setFavorites(f.dataManager.favorites)),f}return l(t,n),t.prototype.getHomeOriginalName=function(n){return n&&n.length>0?n:this.resources.L_MissingHomeFavorite_Text},t.prototype.getWorkOriginalName=function(n){return n&&n.length>0?n:this.resources.L_MissingWorkFavorite_Text},t.prototype.getFavoriteTitle=function(n){var t,i;return n&&(t=n.getName(),i=n.getOriginalName()),t?t:i},t.prototype.noShowOnDupeName=function(n){if(n){var i=n.getName(),t=n.getOriginalName(),r=n.getAddress(),u=n.getDescription();return i&&t&&(i===t||r&&r===t||u&&u===t)?"none":""}return"none"},t.prototype.noShowOnDupe=function(n){if(n){var i=n.getName(),r=n.getAddress(),t=n.getDescription();return t&&(i&&t===i||r&&r===t)?"none":""}return"none"},t.prototype.showAddress=function(n){return n&&n.getAddress()?"":"none"},t.prototype.getFavoriteDescription=function(n){if(n){var t=n.getDescription();return t?t:""}return""},t.prototype.getFavoriteAddress=function(n){if(n){var t=n.getAddress();return t&&(t.indexOf("http:")===-1||t.indexOf("https:")===-1)?t:""}return""},t.prototype.getHomeDescription=function(n){var t=this.getHome();return n&&t&&t.entity&&n!==t.entity.getOriginalName()&&n!==t.entity.getAddress()?n:""},t.prototype.getWorkDescription=function(n){var t=this.getWork();return n&&t&&t.entity&&n!==t.entity.getOriginalName()&&n!==t.entity.getAddress()?n:""},t.prototype.setFavoritePhotoSrc=function(n){return n?this.makePhotoUrlHttps(n):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyBAMAAADsEZWCAAAAGFBMVEWpqani4uJ1dXX///+2trbDw8PY2Njr6+tZYlZfAAAAoklEQVR4Xt3SPQ6CQBiE4dmwi61/cABOIE7Q1sp6DYk1RA9gYrHXlx8Jcfm2MLEwvMlUTztYhZqJpBZXWSoA9VQSXNCkpmKhW4mncgK+lLHZyh1duvYlxbvYl2QQ48t2EC3KLiSmCInKQxKxk3XWNYpzTzr3EOTGtkoQ00IBQbAgjxBFkbksEUlZysOZVpSNRbnshfsPsWgmSd9PJJP67/e+AHsUWtUxgpHkAAAAAElFTkSuQmCC"},t.prototype.setHomePhotoSrc=function(n){return n?n.getPhotoUrl()?this.makePhotoUrlHttps(n.getPhotoUrl()):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyBAMAAADsEZWCAAAALVBMVEV4zshNTU3Q9fIAggBdfXtzx76l495ErXJlv6eL19G97elUY2ItnktpoZ4UjyHBIxj0AAAAqklEQVQ4y2NgGK6AbZHWBOwyi5SU1LAIz9KapgQEmJo4lSAgAdMOMmSGL+BtwCXjKItDgkVQ8AIOLYKCsri0CAo6YJFgdQTJiGCRiRYUxK6JdSNERgSXFmRNh+0akLQgaWI3NjYFycAkBKVhMszGxuZgBkyGgbAMj7GxxeMX2GRYHxuXG9tAZJSUkGUYOCzYweZhyjAYMBw+gEsmOACXDDMDlWSMsYHBnY4B0FMn3LJXk+sAAAAASUVORK5CYII=":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyBAMAAADsEZWCAAAAHlBMVEXi4uJ1dXWoqKj////Z2dnIyMienp68vLyysrKIiIjSZeFBAAAApUlEQVQ4y93SwQqCQBSF4Utotr0bpV0cEtv7AoObaieuWuYbSI8gvkBvXCoTydyzaBeezYAfP4MwImtd3BfOlh7Ijc+34oz3wijCvDq8g0pCZb2L6c+2GYGtakcS1YwlqncDonaU1JCrqh1Fz1lSloSRT76jBMMoHnT/kQaYTi+LR1jbAioP4HJyk5TlQnbIG3SWSOWYbKSCIyJHYXL4SdTaf7/jF8pbIINXjX+zAAAAAElFTkSuQmCC"},t.prototype.setWorkPhotoSrc=function(n){return n?n.getPhotoUrl()?this.makePhotoUrlHttps(n.getPhotoUrl()):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyBAMAAADsEZWCAAAAKlBMVEVNTU3Mf7zw1uqqKY90bXLItMONaoWfkpxsWWjpyuLUkcZgXGDhste3d6qiZE+DAAAAoklEQVQ4y2MQxAUYhoeM1CGlU9hlFikpKS3ElJGZeRAooTQRU+aQkiZIRgtTZpKSEskyAxc6Yh0QkIghk8AAASwYMgwwQIoMi4sLg4vLBiwyrEqqDEpKBVSSwW0PDFzEKcNyEZc9DGw4ZRBSGDIMe1Fl2MrLGMrLHRiQNKG5gBQZmD2eU3DIcE/S3IBdhkVJyYENa7hhkYEFDuUyxtjA4C5DAGQmaL1CIS8NAAAAAElFTkSuQmCC":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyBAMAAADsEZWCAAAAHlBMVEV1dXXi4uL///+pqamYmJiNjY26urrd3d3R0dH39/d4/zKWAAAAoUlEQVQ4y2MQxAUYhoeMRLJxOnaZZmNj40ZMGTHjdKCEsSGmTLKxGUjGHJsMGFiQIjNwoSMWCgGJGDIGDBDAgiHDAAOkyLC6uDK4uARgkWFXUmdQUkqgkgxue2CgEacMSyMuexiYC3HJMLDhlGGIQJVhTktmSEtzAMkwY3cBKTIweyKn4pBhnaQZgF2GRUnJgRlruGGRgQUO5TIM2MDgLkMA+PFfCMUhMZQAAAAASUVORK5CYII="},t.prototype.getEntityFromId=function(n){var r,t,i;if(n){if(t=this.getHome(),i=this.getWork(),this._compareFavoriteEntityIds(t,n))return t;if(this._compareFavoriteEntityIds(i,n))return i;if((r=this._getEntityIndexFromId(n))!==-1)return this.getFavorites()[r]}return null},t.prototype._getEntityIndexFromId=function(n){var i,t;if(n)for(i=this.getFavorites(),t=0;t<i.length;t++)if(this._compareFavoriteEntityIds(i[t],n))return t;return-1},t.prototype._compareFavoriteEntityIds=function(n,t){var i=n&&n.entity&&n.entity.getBusinesslistingid();return i&&i.toLowerCase()===t.toLowerCase()?!0:!1},t}(at),ki=function(n){function t(t,i,r,u,f){var e=this,o={};return e=n.call(this,o,t,yi,i)||this,o.defineProperty("Favorites"),o.defineProperty("Home"),o.defineProperty("Work"),e.setHome(r),e.setWork(u),e._favorites=f,e.setPrintIconText(),e.setFavorites(e._favorites),e}return l(t,n),t.prototype.dispose=function(){this._favorites=null},t.prototype.setPrintIconText=function(){for(var t=this._favorites,n=0;n<t.length;n++)t[n].entity.setIconText((n+1).toString()),t[n].entity.setIconSource("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAXCAMAAADX9CSSAAAARVBMVEVHcEz5oRv5oRv5oRv5oRv5oRv5oRv5oRv5oRv5oRv5oRv5oRv////6qS38xXP6s0b+6Mb80I37ulf/9+v94rj+7dT93KoSX7LkAAAAC3RSTlMAz6coXOSPEIBAv/JnNQYAAAC5SURBVCjPdZHbDoQgDAVR5OaxgKD7/5+6VVwFyc4LyZykpa0QBTPpeZ71ZESNGfFjrJJJAWGNMa4BUNOt2calEDm5Agf45cED7qytGn0E6uhhQbnxmWDZK3yWlg+UEBK0vCFI/kzqfOIvWaydX7nBf+8779k7hM4HnswA+aUzwIONXSGPsawnNjpeC9KgvdI7QZejDKDt1hthuE7DAVJJtoRbnztlQgrHY+sDS63O6yotxQvjnHsqfAGnsBLW6TbeiAAAAABJRU5ErkJggg==")},t}(e),di=function(s){function a(t,i,u,f,e,c,l){var a=this,v={},y,p,w;return a=s.call(this,v,t,fu,i)||this,v.defineProperty("home"),v.defineProperty("work"),v.defineProperty("favorites"),v.defineProperty("upcomingEvents"),v.defineProperty("showAllEvents",function(n,t){return a._onShowAllEventsChanged(n,t)}),v.defineProperty("isNoFavorites"),v.defineProperty("favoriteMessage"),v.defineProperty("showFavoriteProgress"),a._poiManager=f,a.setShowProgress(!0),a.setMessageText(null),a.disposables.push(a.signInState.notifySignedIn.add(function(n){n&&(a.setShowProgress(!0),a.getFavoritesContent(function(){a.setShowProgress(!1)}))})),a._taskId=u,a.favoritesLoadedInView=new o,a.homeEditRequested=new o,a.workEditRequested=new o,a.addHomeWorkRequested=new o,a.setFavoriteMessage(a.resources.L_AddFavoritesMessage_Text),a.entitiesPrintViewModel=null,a.contextMenuButtonClass=h.editHomeWork?"bm_contextMenuButton bm_moreSpace":"bm_contextMenuButton",e&&c&&l&&(a.transientLensViewModel=e,a.disposables.push(a.transientLensViewModel.invalidateLayer.add(function(){return a.hideContextMenu()})),a.disposables.push(a.transientLensViewModel.moveToNewCollection.add(function(){a._inMoveToFlow=!0})),a.dataManager.collectionAdded&&a.disposables.push(a.dataManager.collectionAdded.add(function(n){if(n&&a._inMoveToFlow){var t=a.transientLensViewModel.collectionPrimitive,i=t&&t instanceof ht&&t.entity.getBusinesslistingid();i&&a.makeDeleteCall(i,function(){return})}a._inMoveToFlow=!1})),a._primitiveInteracted=l,a._contextMenu=c),y=a.dataManager.favoritesLoaded.add(function(){a._setFavorites()}),a.disposables.push(y),p=a.dataManager.upcomingEventsSet.add(function(){var t=a.dataManager.upcomingEvents&&a.dataManager.upcomingEvents.primitives.length;t&&a.setUpcomingEvents(a.dataManager.upcomingEvents);a.setShowAllEvents(!1);n.logAction(r.viewUpcomingEvents,{Count:t})}),a.disposables.push(p),w=a.dataManager.favoritesFailedToLoad.add(function(){a._setFavorites()}),a.disposables.push(w),a.disposables.push(a.dataManager.homeOrWorkChanged.add(function(){a.setHome(a.dataManager.home);a.setWork(a.dataManager.work)})),a.getFavoritesContent(function(){a.setShowProgress(!1)}),a}return l(a,s),a.buildDataTaskOptionsFromFavorite=function(t,i,r){var e={},u={},f,o,s,h;return u.entryPoint=et.Collections,u.flippingCard=!r,u.descriptionList=[],t&&(f=t.getBusinesslistingid(),o=!1,f&&(f.indexOf("ypid:")!==-1||f.indexOf("sid:")!==-1?(u.id=f,o=!0):f!=="0"&&(n.hasSatoriId(f)||n.hasSearchId(f))&&(u.id=n.addIdPrefix(f),o=!0)),u.taskTitle=t.getTitle(),u.originalName=t.getOriginalName(),o?u.query=t.getOriginalName():(s=t.getGeometry(),u.query=s?s.y.toFixed(ft.latLongPrecision)+", "+s.x.toFixed(ft.latLongPrecision):t.getOriginalName()),h=t.getDescription(),h&&h.length>0&&u.descriptionList.push(h),u.savedEntityId=t.id,u.selectedCategoryId=t.categoryId),e.type=c.localDetailsTask,e.activateOptions={parentId:i},e.state=u,e},a.prototype.buildDataTaskAttribute=function(n){return i.Internals.stringify(this.buildDataTaskOptionsForFavorite(n))},a.prototype.buildEventDataTaskAttribute=function(n){var t=yt.buildEntityDataTaskOptions(n);return t.state.taskTitle="",t.state.flippingCard=!0,t.activateOptions={parentId:this._taskId},i.Internals.stringify(t)},a.prototype.buildDataTaskOptionsForFavorite=function(n){return a.buildDataTaskOptionsFromFavorite(n,this._taskId)},a.prototype.processCollectionsData=function(n){var i,r,u,f;n&&n.inData&&n.inData.requestorState&&(i=n.inData.requestState,r=n.outData&&n.outData[0]&&n.outData[0].data,r&&r.actionSucceeded&&i&&i.data&&this.transientLensViewModel.collectionPrimitive instanceof ht&&(i.action===t.AddEntity||i.action===t.AddFavorite||i.action===t.SetHome||i.action===t.SetWork)&&(u=this.transientLensViewModel.collectionPrimitive,f=u&&u.entity.getBusinesslistingid(),this.makeDeleteCall(f||i.data.id,function(){return})))},a.prototype.getFavoritesContent=function(n){var t=this;this.signInState.getIsSignedIn()?this.dataManager.syncFavorites(function(i){i===0?(t._setFavorites(),t.favoritesLoadedInView.invoke()):(t.setFavoriteMessage(t.resources.L_FavoriteErrorMessage_Text),t._checkAndSetNoFavorites());n()}):n()},a.prototype.getPrintContent=function(){var n=this,t,i,r;return this.entitiesPrintViewModel=new ki(this.controlTemplateFactory,this.dataManager,this.getHome(),this.getWork(),this.getFavorites()),t={boolToDisplay:function(t){return n.boolToDisplay(t)},nullToDisplayNone:function(t){return n.nullToDisplayNone(t)},boolToNotDisplay:function(t){return n.boolToNotDisplay(t)},setHomePrintSrc:function(t){return n.setHomePrintSrc(t)},getHomeOriginalName:function(t){return n.getHomeOriginalName(t)},showHomeWorkAddress:function(t){return n.showHomeWorkAddress(t)},hideHomeWorkDescription:function(t){return n.hideHomeWorkDescription(t)},getHomeDescription:function(t){return n.getHomeDescription(t)},setWorkPrintSrc:function(t){return n.setWorkPrintSrc(t)},getWorkOriginalName:function(t){return n.getWorkOriginalName(t)},getWorkDescription:function(t){return n.getWorkDescription(t)},noShowOnDupeName:function(t){return n.noShowOnDupeName(t)},showAddress:function(t){return n.showAddress(t)},getFavoriteTitle:function(t){return n.getFavoriteTitle(t)},noShowPrintDupe:function(t){return n.noShowPrintDupe(t)},getFavoriteAddress:function(t){return n.getFavoriteAddress(t)},getFavoriteDescription:function(t){return n.getFavoriteDescription(t)}},this.entitiesPrintTemplate=new hi(yi,t),i=this.controlTemplateFactory({templateText:pi,staticResources:t}),r=i.applyDataTemplate(this),r[0].outerHTML},a.prototype.dispose=function(){s.prototype.dispose.call(this)},a.prototype.onFavoriteClick=function(t){if(t.type===e.unlocalizedStrings.click&&this.setShowProgress(!0),t.currentTarget){var i=t.currentTarget.attributes["data-entityId"].value,u=this.getEntityFromId(i);u===this._editPrimitive?(t.preventDefault(),t.stopImmediatePropagation()):n.logAction(r.clickEntity,{Type:"FAV",IsPoi:!1})}},a.prototype.onHomeClick=function(n){this._homeOrWorkClick(n,this.getHome(),!0)},a.prototype.onWorkClick=function(n){this._homeOrWorkClick(n,this.getWork(),!1)},a.prototype.onHomeEditClick=function(n){this.addHomeWorkRequested.invoke(!0);this._checkAndSetNoFavorites();n.stopPropagation();n.preventDefault()},a.prototype.onWorkEditClick=function(n){this.addHomeWorkRequested.invoke(!1);this._checkAndSetNoFavorites();n.stopPropagation();n.preventDefault()},a.prototype.onDeleteHomeClick=function(n){this.onDeleteClick(n,!0)},a.prototype.onConfirmDeleteHomeClick=function(n){var t=this,u=this.getHome(),f,r;u&&(this.dataManager.removeFavorite(u,function(){t.changed.invoke();t._checkAndSetNoFavorites();t._deleteConfirmationShown.set_style({display:"none"});t._deleteConfirmationShown=null}),f=this.getControl(),r=i(".editModeButton.active",f[0]),r.length>0&&r[0].focus());n.stopPropagation();n.preventDefault()},a.prototype.onDeleteWorkClick=function(n){this.onDeleteClick(n,!1,!0)},a.prototype.onConfirmDeleteWorkClick=function(n){var t=this,u=this.getWork(),f,r;u&&(this.dataManager.removeFavorite(u,function(){t.changed.invoke();t._checkAndSetNoFavorites();t._deleteConfirmationShown.set_style({display:"none"});t._deleteConfirmationShown=null}),f=this.getControl(),r=i(".editModeButton",f[0]),r.length>0&&r[0].focus());n.stopPropagation();n.preventDefault()},a.prototype.onDeleteClick=function(t,u,f){if(this._primitiveInteracted&&this._primitiveInteracted.invoke({action:2}),t.target&&!this._deleteConfirmationShown){var o=u?"home":f?"work":t.target.attributes["data-entityId"].value,e=i("div[data-entityId="+o+"].cardDeleteConfirmationRow",this.getControl()[0]);e.length>0&&(this._deleteConfirmationShown=e,this._deleteConfirmationShown.set_style({display:"block"}));n.logAction(r.deleteButtonClicked,{Type:u?"HOME":f?"WORK":"FAV"})}else this._deleteConfirmationShown&&(this._deleteConfirmationShown.set_style({display:"none"}),this._deleteConfirmationShown=null);this._primitiveInteracted&&this._primitiveInteracted.invoke({action:3});t&&t.stopPropagation();t&&t.preventDefault()},a.prototype.makeDeleteCall=function(n,t){var r=this,i=this.getEntityFromId(n);i&&i.entity&&(this.setShowProgress(!0),this.dataManager.removeFavorite(i,function(n){r._checkAndSetNoFavorites();r.setShowProgress(!1);t(n)}))},a.prototype.onDeleteFavoriteClick=function(n){var u=this,o=n.target,f,r,t,e;o instanceof HTMLInputElement||(f=n.currentTarget,r=this.getEntityFromId(f.getAttribute("data-entityid")),r&&r.entity&&(this.setShowProgress(!0),this.dataManager.removeFavorite(r,function(){u._checkAndSetNoFavorites();u.setShowProgress(!1)})),t=i(n.target).get_ancestor(2).get_sibling(1).select("a"),t.length===0&&(e=this.getControl(),t=i(".editModeButton.active",e[0])),t.length>0&&t[0].focus());n.stopPropagation();n.preventDefault()},a.prototype.onContextMenu=function(t){var u=this,f,o,c;if(t.stopPropagation(),t.preventDefault(),this._contextMenuElement){this.hideContextMenu();return}this._contextMenu.hide();var l=t.pageX,a=t.pageY-e._contextMenuTopPadding,s=t.currentTarget.attributes["data-entityId"].value,r=this.getEntityFromId(s),h;r?(f=r===this.getHome(),o=r===this.getWork(),this.transientLensViewModel.updateActionListWithMoveTo(),this._editCallback&&this._editCallback.dispose(),this._editCallback=this.transientLensViewModel.editEvent.add(function(n){return u._onContextMenuEdit(n,r,f,o)}),f||o?this.transientLensViewModel.updateActionListWithHomeWorkEdit():this.transientLensViewModel.updateActionListWithEdits(r.entity.getOriginalName()!==r.entity.getName(),!!r.entity.getDescription()),c=n.addIdPrefix(r.entity.getBusinesslistingid()),r.entity.setBusinesslistingid(c)):(h=this._getEntityFromEvents(s),this.transientLensViewModel.updateActionListForEvent());this.transientLensViewModel.buildMenu(r||h,i(t.currentTarget),function(n){u._contextMenuElement=ui._createElement("div").add_class("bm_listMenu").set_style({left:l,top:a});n.appendTo(u._contextMenuElement);u._primitiveInteracted.invoke({action:1,element:u._contextMenuElement})})},a.prototype.onConfirmEditClick=function(n){var r,t;this._editEntryShown&&(this._editEntryShown.set_style({display:"none"}),r=i(".descriptionEditBox",this._editEntryShown[0]),this._editEntryShown=null,t=this._editPrimitive,this._editPrimitive=null,this.getTempName().trim()?t.entity.setName(this.getTempName().trim()):t.entity.setName(t.entity.getOriginalName()),r&&r[0]?t.entity.setDescription(r[0].value):t.entity.setDescription(this.getTempDescription()),this.setTempName(""),this.setTempDescription(""),this._poiManager.setPoiState(t,0),t.changed.invoke());n.stopPropagation();n.preventDefault()},a.prototype.onFavoriteItemHover=function(n){var r,t,i;n.type==="mouseover"?(r=null,t=null,n.currentTarget&&(i=n.currentTarget.attributes["data-entityid"],i&&(t=this.getEntityFromId(i.value))),t&&(this._highlightedPrimitive&&this._poiManager.setPoiState(this._highlightedPrimitive,0),this._highlightedPrimitive=t,this._poiManager.setPoiState(this._highlightedPrimitive,1),this._poiManager.refreshMap())):n.type==="mouseout"&&this._highlightedPrimitive&&(this._poiManager.setPoiState(this._highlightedPrimitive,0),this._poiManager.refreshMap(),this._highlightedPrimitive=null)},a.prototype.onFavoriteDescriptionEditClick=function(n){var r=n.currentTarget,t,i;r instanceof HTMLTextAreaElement&&(t=r,t.placeholder="",i=t.value.length,i>0&&t.selectionStart-t.selectionEnd==0?t.select():t.selectionStart=i);n.stopPropagation();n.preventDefault()},a.prototype.onSeeMoreEventsClick=function(n){this.setShowAllEvents(!this.getShowAllEvents());n.stopPropagation();n.preventDefault()},a.prototype.getHomeOriginalName=function(n){return n&&n.length>0?n:this.resources.L_MissingHomeFavorite_Text},a.prototype.getWorkOriginalName=function(n){return n&&n.length>0?n:this.resources.L_MissingWorkFavorite_Text},a.prototype.showEditableAddress=function(t){var i=this._getFavoriteEntity(t);return i&&i.getAddress()&&!(n.hasSearchId(i.getBusinesslistingid())||n.hasSatoriId(i.getBusinesslistingid()))?"":e.unlocalizedStrings.none},a.prototype.showAddressOrEdit=function(t){var i=this._getFavoriteEntity(t);return i?n.hasSearchId(i.getBusinesslistingid())&&i.getAddress()?i.getAddress()?i.getAddress():this.resources.L_PlaceAddressEditSuggestion_Text:!i.getAddress()||i.name.indexOf(i.getGeometry().x.toString().substr(0,5))>-1?this.resources.L_PlaceAddressEditSuggestion_Text:i.getAddress():""},a.prototype.showEditOrDescription=function(n){var t=this._getFavoriteEntity(n);return t&&t.getDescription()&&t.getAddress()!==t.getDescription()?t.getDescription():u.L_PlaceDescriptionEditSuggestion_Text},a.prototype.getFavoriteTitle=function(n){var t,i;return n&&(t=n.getName(),i=n.getOriginalName()),t?t:i},a.prototype.noShowOnDupeName=function(n){if(n){var i=n.getName(),t=n.getOriginalName(),r=n.getAddress(),u=n.getDescription();return i&&t&&(i===t||r&&r===t||u&&u===t)?"none":""}return"none"},a.prototype.noShowOnDupe=function(n){if(n){var i=n.getName(),r=n.getAddress(),t=n.getDescription();return!t||t.length===0||i&&t===i||r&&r===t?"none":""}return"none"},a.prototype.noShowPrintDupe=function(n){if(this.noShowOnDupe(n)==="none")return"none";var t=n&&n.getDescription();return t&&t===u.L_PlaceDescriptionEditSuggestion_Text?"none":""},a.prototype.showAddress=function(n){return n&&n.getAddress()?"":"none"},a.prototype.getFavoriteDescription=function(n){if(n){var t=n.getDescription();return t?t:""}return""},a.prototype.getFavoriteAddress=function(n){if(n){var t=n.getAddress();return t&&(t.indexOf("http:")===-1||t.indexOf("https:")===-1)?t:""}return""},a.prototype.showHomeWorkAddress=function(n){var t=this._getFavoriteEntity(n);return t&&t.getAddress()&&t.getAddress()!==t.getOriginalName()?"":"none"},a.prototype.showEditHomeWork=function(n){return n&&h.editHomeWork?"":"none"},a.prototype.hideHomeWorkDescription=function(n){var t=this.getEntityFromId(n);return t&&t.entity&&t.entity.getDescription()&&(!t.entity.getAddress()||t.entity.getAddress()!==t.entity.getDescription())?"":"none"},a.prototype.getHomeDescription=function(n){var t=this.getHome();return n&&t&&t.entity&&n!==t.entity.getOriginalName()&&n!==t.entity.getAddress()?n:""},a.prototype.getWorkDescription=function(n){var t=this.getWork();return n&&t&&t.entity&&n!==t.entity.getOriginalName()&&n!==t.entity.getAddress()?n:""},a.prototype.getEventDate=function(n){return n?n.getSecondaryLabelText():""},a.prototype.getFlightText=function(n){return n&&n.arrivalAirport?this.resources.L_FlightToText.replace("{0}",n.arrivalAirport.entity.city):""},a.prototype.getCollapsExpandText=function(n){return n?this.resources.L_SeeLessEventsLink:this.resources.L_SeeMoreEventsLink},a.prototype.lengthToDisplay=function(n){return n>=3?"":"none"},a.prototype.flightToDisplay=function(n){return n&&n.indexOf("FlightEvent")!==-1?"":"none"},a.prototype.setFavoritePhotoSrc=function(n){return n?this.makePhotoUrlHttps(n):""},a.prototype.setEventPhotoSrc=function(n){return n?this.makePhotoUrlHttps(n):""},a.prototype.setHomePhotoSrc=function(n){return n?n.getPhotoUrl()?this.makePhotoUrlHttps(n.getPhotoUrl()):"":""},a.prototype.setWorkPhotoSrc=function(n){return n?n.getPhotoUrl()?this.makePhotoUrlHttps(n.getPhotoUrl()):"":""},a.prototype.setHomePrintSrc=function(n){return n?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAAAh1BMVEXI5uTK5+bR6+1APD3c8fzh8//x9vXG5ePE5OKNyKE2MDHZ/PrV9fTe//5OTk6g1rb//f5FRETq+/+Uzqnb7u62z86rwsBYWlqY1a59ionC4tzq8/NPUFCOnp1bsGhptnh3v4gAYgCx2snz//9UgVobOhWKiZU3IjEnSCJIN0SBxJNOplgAdwBUgCz1AAAA2ElEQVQY04WQB27DMAxFNa3pSFY8ZEfxyF73P1+poAWStEA/QUJ4/AQFIoSQQEJCoFcJIfGmqN+gxEVReO9r+QoJwA1Y5cd8FkL/w5+etfIXNE1jPv6Fy4YmYeQ7aynVHS6fXswDgXZmKelueHrJPA0E262u0mqVaNVagGpZJm9J21VJ60S7JsP4eNzvqg5g7ftKb0MeZ7fZLWMoe02Nobov86IwOD8PfH86Xxm7nk97BnvX0+jGm3KH40Wpy/Hg1I4gpdYQUGNUKkZ4AmQgnpPz70Lkn6f5AseFDlDUqvmeAAAAAElFTkSuQmCC":""},a.prototype.setWorkPrintSrc=function(n){return n?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAAAeFBMVEXhzOIkJSPYxNjn2enfxt/t1e1DQ0Pj0OTgyuH34fhbWVvu4+60pbPNj8Py2/TPu881NDRJSkk6Ojn+//6bj5nbt9jo0umob566q7urmqj+4/uvoK1SUVJqZmny6/LIhr6rcqHGtMaIf4b28vbivtjhytt8dXutdKSsNebuAAAAv0lEQVQY04WQiQ7CIBBEQSg3hdL7vuv//6E0atpqjAPZkJeZ3Q0A/Bf7Jgz788mYnOXVjFE8x3Es8RV2nZQdekEW8F0h3vVOZ6ZWStVjdsplQEDoICQmPGBwI1MtysQW/AyjOmjX0ZmKnWATiUY0JAkryo54UbW+WqEyejjbSWxbZKEbw6PnpPwgkiSuOMFybY0iFScFp3sDirEhEFq/6rLYMkhTTAFKe33P88FfrYde6z5Fu5fyp/wDAUp//P8DwekMEpkPmvgAAAAASUVORK5CYII=":""},a.prototype.noFavoritesShowMessage=function(n){return!this.getShowProgress()&&n&&n.length>0?"none":""},a.prototype.businessIdToNotDisplay=function(t){var i=this._getFavoriteEntity(t);return i&&(n.hasSearchId(i.getBusinesslistingid())||n.hasSatoriId(i.getBusinesslistingid()))?e.unlocalizedStrings.none:""},a.prototype.getEventDay=function(n){return n&&n.getDate()},a.prototype.getEventMonth=function(n){if(!n)return"";switch(n.getMonth()){case 0:return f.ResourceManager.CommonControls.L_ShortMonthJanuary;case 1:return f.ResourceManager.CommonControls.L_ShortMonthFebruary;case 2:return f.ResourceManager.CommonControls.L_ShortMonthMarch;case 3:return f.ResourceManager.CommonControls.L_ShortMonthApril;case 4:return f.ResourceManager.CommonControls.L_ShortMonthMay;case 5:return f.ResourceManager.CommonControls.L_ShortMonthJune;case 6:return f.ResourceManager.CommonControls.L_ShortMonthJuly;case 7:return f.ResourceManager.CommonControls.L_ShortMonthAugust;case 8:return f.ResourceManager.CommonControls.L_ShortMonthSeptember;case 9:return f.ResourceManager.CommonControls.L_ShortMonthOctober;case 10:return f.ResourceManager.CommonControls.L_ShortMonthNovember;case 11:return f.ResourceManager.CommonControls.L_ShortMonthDecember;default:return""}},a.prototype.getEventTime=function(n){return n&&ui._formatTimeString(n)},a.prototype._setFavorites=function(){var i=this,t;this.setHome(this.dataManager.home);this.setWork(this.dataManager.work);this.setFavorites(this.dataManager.favorites);t=this.dataManager.upcomingEvents&&this.dataManager.upcomingEvents.primitives.length;t&&!this.getUpcomingEvents()&&(this.setUpcomingEvents(this.dataManager.upcomingEvents),this.setShowAllEvents(!1),n.logAction(r.viewUpcomingEvents,{Count:t}));Microsoft.Maps.setTimeout(function(){return i._checkAndSetNoFavorites()},10)},a.prototype._getFavoriteEntity=function(n){var t=this.getEntityFromId(n);return t&&t.entity},a.prototype._getEntityFromEvents=function(n){var i=this.getUpcomingEvents(),t;if(i)for(t=0;t<i.primitives.length;t++)if(n===i.primitives[t].entity.businesslistingid)return i.primitives[t]},a.prototype.getEntityFromId=function(n,t){var u,i,r;if(n){if(i=this.getHome(),r=this.getWork(),this._compareFavoriteEntityIds(i,n,t))return i;if(this._compareFavoriteEntityIds(r,n,t))return r;if((u=this._getEntityIndexFromId(n,t))!==-1)return this.getFavorites()[u]}return null},a.prototype._getEntityIndexFromId=function(n,t){var r,i;if(n)for(r=this.getFavorites(),i=0;i<r.length;i++)if(this._compareFavoriteEntityIds(r[i],n,t))return i;return-1},a.prototype._compareFavoriteEntityIds=function(n,t,i){var r=n&&n.entity&&(i?n.entity.id:n.entity.getBusinesslistingid());return r&&r.toLowerCase()===t.toLowerCase()?!0:!1},a.prototype._homeOrWorkClick=function(t,i,u){this.setShowProgress(!0);i&&i.entity?(p.invokeHandler(y.taskDataHandlerKey,this.buildDataTaskOptionsForFavorite(i.entity)),n.logAction(r.clickEntity,{Type:u?"HOME":"WORK",IsPoi:!1})):(this.setShowProgress(!1),this.addHomeWorkRequested.invoke(u),this._checkAndSetNoFavorites());t.stopPropagation();t.preventDefault()},a.prototype._checkAndSetNoFavorites=function(){var n=this.getFavorites();n&&n.length>0||this.getHome()||this.getWork()?this.setIsNoFavorites(!1):this.setIsNoFavorites(!0)},a.prototype._onContextMenuEdit=function(t,u,f,e){var c,s,o,h;t===tt.deleteName?(u.entity.setName(u.entity.getOriginalName()),u.changed.invoke()):t===tt.deleteDescription?(u.entity.setDescription(""),u.changed.invoke()):t===tt.editHomeWork&&(f||e)?this.addHomeWorkRequested.invoke(f):t===tt.hideHomeWork&&(f||e)?(u.entity.setShowOnMap(!u.entity.getShowOnMap()),this.dataManager.homeOrWorkChanged.invoke()):(this._editEntryShown&&(this._editEntryShown.set_style({display:"none"}),this._editEntryShown=null),this._editPrimitive=u,u.entity.name!==u.entity.getOriginalName()&&this.setTempName(u.entity.getName()),this.setTempDescription(u.entity.getDescription()||""),c=u.entity.getBusinesslistingid(),s=i("div[data-entityId="+c+"].editEntryRow",this.getControl()[0]),s.length>0&&(this._primitiveInteracted&&this._primitiveInteracted.invoke({action:2}),this._editEntryShown=s,this._editEntryShown.set_style({display:"block"}),this._primitiveInteracted&&this._primitiveInteracted.invoke({action:3}),o=i(".descriptionEditBox",s[0]),t===tt.editName?(h=i(".nameEditBox",s[0]),h&&h.length&&h[0].focus()):o&&o.length&&o[0].focus(),o&&o.length&&(o[0].value=this.getTempDescription())),n.logAction(r.editMyPlaces,{Type:"F"}))},a.prototype._onShowAllEventsChanged=function(n,t){var i=this.getUpcomingEvents(),r;if(i){for(r=3;r<i.primitives.length;r++)i.primitives[r].entity.entityShown=t;i.primitives.changed.invoke()}},a}(e),gi=function(n){function t(t){var i=this,r={};return i=n.call(this,r,t,dr,new ri)||this,r.defineProperty("itineraries"),r.defineProperty("newItineraryEnabled"),i.setNewItineraryEnabled(h.enableCreateNewItinerary),i.signInState.getIsSignedIn()?i._fetchItinerariesList():i.disposables.push(i.signInState.notifySignedIn.add(function(){i._fetchItinerariesList()})),i}return l(t,n),t.prototype.makeDeleteCall=function(n,t){var i=this;this.dataManager.deleteItinerary(n,function(n){n===0?i.setMessageText(null):i.setMessageText(i.resources.L_ItineraryError_Deleting_Text);t(n)})},t.prototype.dispose=function(){n.prototype.dispose.call(this)},t.prototype.onItineraryClick=function(n){var r,u;if(n){n.stopPropagation();n.preventDefault();var f=n.currentTarget,t=f.attributes["data-entityId"],i=t&&t.value;i&&(r={entryPoint:et.Collections,itineraryCollectionId:i},u={type:c.itineraryDetailsTask,activateOptions:{},state:r},p.invokeHandler(y.taskDataHandlerKey,u))}},t.prototype.onItineraryAddClick=function(n){if(n){n.stopPropagation();n.preventDefault();var t={entryPoint:et.MyPlacesNew},i={type:c.itineraryDetailsTask,activateOptions:{},state:t};p.invokeHandler(y.taskDataHandlerKey,i)}},t.prototype.onDeleteClick=function(n){if(n&&(n.stopPropagation(),n.preventDefault(),this._deleteConfirmationShown&&(this._deleteConfirmationShown.set_style({display:"none"}),this._deleteConfirmationShown=null),n.target)){var r=n.target.attributes["data-entityId"].value,t=i("div[data-entityId="+r+"].cardDeleteConfirmationRow",this.getControl()[0]);t.length>0&&(this._deleteConfirmationShown=t,this._deleteConfirmationShown.set_style({display:"block"}))}},t.prototype.onItineraryLinkClick=function(n){n.stopPropagation();n.preventDefault();var t={query:"Seattle Itineraries",entryPoint:et.Collections},i={type:c.localSearchTask,requestState:t};p.invokeHandler(y.taskProcessDataHandlerKey,i)},t.prototype.emptyItinerariesToDisplay=function(n){return n>0?"none":""},t.prototype.setItineraryImage=function(n){var t=n?this.makePhotoUrlHttps(n):"";return t.replace("h=200&w=400","h=112&w=92")},t.prototype.displayItineraryDayCount=function(n){return(n===1?it.DaySingular:it.DayPlural).replace("{0}",""+n)+" Â· "},t.prototype.displayItineraryAttractionCount=function(n){return(n===1?it.AttractSingular:it.AttractPlural).replace("{0}",""+n)},t.prototype._fetchItinerariesList=function(){var n=this;this.setShowProgress(!0);this.dataManager.retrieveAllItinerariesMetaData(function(t,i){n.setShowProgress(!1);i===0?n.setItineraries(t):(n.setItineraries(new pt),n.setMessageText(n.resources.L_ItineraryError_Retrieving_Text))})},t}(e);k.CollectionBaseViewModel=e;k.CollectionsTask=au;k.CollectionEntitiesViewModel=v;k.CollectionPrintViewModel=bi;k.FavoritesPrintViewModel=ki;k.MeasureMapTask=vu;k.MyPlacesMobileControl=pu;k.CollectionMobileControl=lu;k.TemporaryCollectionViewModel=w;k.ViewManager=wi}catch(nr){if(f.logger)f.logger.logCriticalError(nr);else throw nr;}}).call(window)