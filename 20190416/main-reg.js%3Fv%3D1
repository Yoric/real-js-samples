$(document).ready(function(){var form={state:{step:1},executeForm:function(){this.bindEvent();},initElem:function(){this.$itemCount='.js-step-item';this.$step='.js-step';this.$nextBtn=$('.js-btn-next');this.$name=$('.js-name');this.$nameVal=$('.js-name').val();this.$nameError=$('.js-error-name');this.$gender=$('.gender');this.$radio=$('.radio');this.$errorGender=$('.js-error-choose-gender');},bindEvent:function(){var self=this;self.$nextBtn.on('click',function(){var currentStep=config[self.state.step];var checkValid=currentStep.checkStatus();if(!checkValid){return;}
showNextStep(self.state.step+1);});function showNextStep(step){if(step===5)return;$(self.$itemCount+'[data-item='+step+']').addClass('active');$(self.$step+'[data-step='+self.state.step+']').removeClass('active');$(self.$step+'[data-step='+step+']').addClass('active');self.state.step=step;}}};var config={1:{checkStatus:function(){this.nameBool=false;this.genderBool=false;this.checkName();this.checkGender();if(this.nameBool&&this.genderBool){return true;}},checkName:function(){var self=this;var $nameVal=$('.js-name').val();var $nameErrorLetters=$('.js-error-name-letters');var $nameErrorLength=$('.js-error-name-length');$nameErrorLetters.addClass('error-hide');$nameErrorLength.addClass('error-hide');var unicode=XRegExp("^(\\pL+['-\\s]?)*\\pL+$");if($nameVal.length<2){$($nameErrorLength).removeClass('error-hide');self.nameBool=false;return;}else if(!unicode.test($nameVal)){$($nameErrorLetters).removeClass('error-hide');self.nameBool=false;return;}
document.querySelector(".fin_name").value=$nameVal;self.nameBool=true;return;},checkGender:function(){var self=this;var $genderMale=$('.gender-male');var $genderFemale=$('.gender-female');var $errorGender=$('.js-error-choose-gender');if($($genderMale).children('.radio').hasClass('active')){self.genderBool=true;document.querySelector(".fin_gender").value=$genderMale.data('gender');document.querySelector(".fin_search_gender").value='f';return;}else if($($genderFemale).children('.radio').hasClass('active')){self.genderBool=true;document.querySelector(".fin_gender").value=$genderFemale.data('gender');document.querySelector(".fin_search_gender").value='m';return;}
$($errorGender).removeClass('error-hide');self.genderBool=false;}},2:{checkStatus:function(){if(!this.checkBday()){return false;}
return true;},checkBday:function(){var self=this;var $dayVal=$('.js-day').val();var $monthVal=$('.js-month').val();var $yearVal=$('.js-year').val();var $errorEmail=$('.js-error-bday');var $errorEmailAge=$('.js-error-bday-age');var chooseMonth=$('.js-month').find(':selected').data('month');var bDay=""+$yearVal+"-"+chooseMonth+"-"+$dayVal+"";var checkAge=Math.floor(new Date().getTime()-new Date(""+chooseMonth+"/"+$dayVal+"/"+$yearVal+""))/(24*3600*365.25*1000);if($dayVal===null||$monthVal===null||$yearVal===null){$($errorEmail).removeClass('error-hide');$($errorEmailAge).addClass('error-hide');return false;}
if(checkAge<18&&chooseMonth!==undefined&&$yearVal!==null){$($errorEmail).addClass('error-hide');$($errorEmailAge).removeClass('error-hide');return;}
document.querySelector('.bday').value=bDay;return true;}},3:{checkStatus:function(){return this.checkValidation();},checkValidation:function(){this.$hideElements=$('.js-error-email-empty, .js-error-email, .js-error-email-type-two, .js-error-email-type-zero, .js-error-email-type-three');var reg=/^[A-z0-9_-]+([\.+-]?[A-z0-9_-]+)*@(?!_)[A-zА-я0-9]+([\.-]?[A-zА-я0-9_-]+)*(\.[A-zА-я0-9_-]{2,10})+$/;this.$emailVal=$('.js-email').val();var $errorEmpty=$('.js-error-email-empty');var $errorValid=$('.js-error-email');this.$emailErrorZero=$('.js-error-email-type-zero');this.$emailErrorTwo=$('.js-error-email-type-two');this.$emailErrorThree=$('.js-error-email-type-three');if(this.$emailVal.trim()===''){$(this.$hideElements).addClass('error-hide');$($errorEmpty).removeClass('error-hide');return false;}
if(!reg.test(this.$emailVal)){$(this.$hideElements).addClass('error-hide');$($errorValid).removeClass('error-hide');return false;}
this.mailFire();},mailFire:function(){var self=this;this.$itemCount='.js-step-item';this.$step='.js-step';function showNextStep(step){if(step===5)return;$(self.$itemCount+'[data-item='+step+']').addClass('active');$(self.$step+'[data-step='+form.state.step+']').removeClass('active');$(self.$step+'[data-step='+step+']').addClass('active');form.state.step=step;}
var productId=document.querySelector(".product-id").innerHTML;var $email=$("#email").val();$.ajax({url:"/restapi/sign/checkemail?email="+$email+"&product_id="+productId,method:"GET",success:function(data){var statusRes=data.response.status;var fixedEmail=data.response.fixed_email;switch(statusRes){case 3:$(self.$hideElements).addClass('error-hide');$(self.$emailErrorThree).removeClass("error-hide");break;case 2:$(self.$hideElements).addClass('error-hide');$(self.$emailErrorTwo).removeClass("error-hide");break;case 0:if(fixedEmail){$("#email").val(fixedEmail);$(self.$hideElements).addClass('error-hide');$(self.$emailErrorZero).removeClass("error-hide");return;}
$(self.$hideElements).addClass('error-hide');is_field_empty('email');$('#email').on('emailBusy',function(){$(self.$hideElements).addClass('error-hide');$(self.$emailErrorThree).removeClass("error-hide");return false;});$('#email').on('emailNotBusy',function(){$(self.$hideElements).addClass('error-hide');$(".fin_email").val(self.$emailVal);showNextStep(form.state.step+1);return true;});$('#email').on('fail_request',function(){$('#email').trigger('emailNotBusy');});}},error:function(){}})},checkBusyEmail:function(){}},4:{checkStatus:function(){this.passBool=false;this.checkBool=false;this.checkPass();this.checkBox();if(this.passBool&&this.checkBool){$('.js-fin_form').submit();}},checkPass:function(){var self=this;var $passVal=$('.js-inp-pass').val();var $passError=$('.js-error-pass');if($passVal.length<8){$($passError).removeClass('error-hide');self.passBool=false;return;}
$passError.addClass('error-hide');$('.fin_pass').val($passVal);self.passBool=true;},checkBox:function(){var $checkbox=$('.checkbox').is(':checked');this.checkBool=$checkbox;}}};form.initElem();function renderSelects(i){return '<option class="selector-item" data-year='+i+' >'+i+'</option>';}
var date=new Date().getFullYear()-18;for(var i=date;i>=1942;i--){$('.year').append(renderSelects(i));}
$(form.$name).on('input',function(){var $nameVal=$('.js-name').val();if($nameVal.length>=2){$(form.$nameError).addClass('error-hide');}});function clearRadio(){for(var i=0;i<form.$radio.length;i++){form.$radio[i].classList.remove('active');}}
$(form.$gender).on('click',function(){clearRadio();$(this).children('.radio').addClass('active');$(form.$errorGender).addClass('error-hide');});var $email=$('.reg-date');$($email).on('change focus blur keydown keyup click',function(){var $day=$('.js-day');var $dayVal=$('.js-day').val();var $month=$('.js-month ');var $year=$('.js-year');var $yearVal=$('.js-year').val();var $errorBday=$('.js-error-bday');var $errorEighteen=$('.js-error-bday-age');var $chooseMonth=$('.js-month').find(':selected').data('month');var bDay=""+$yearVal+"-"+$chooseMonth+"-"+$dayVal+"";var checkAge=Math.floor(new Date().getTime()-new Date(""+$chooseMonth+"/"+$dayVal+"/"+$yearVal+""))/(24*3600*365.25*1000);if(checkAge>=18){$($errorBday).addClass('error-hide');$($errorEighteen).addClass('error-hide');return;}
if($day.val()!==null&&$month.val()!==null&&$year.val()!==null){$($errorBday).addClass('error-hide');}});var $email=$('#email');var $incorrectEmail=$('.js-error-email');var $hideElements=$('.js-error-email-empty, .js-error-email, .js-error-email-type-two, .js-error-email-type-zero, .js-error-email-type-three');function checkEmailValid(email){var $emailVal=$(email).val();var reg=/^[A-z0-9_-]+([\.+-]?[A-z0-9_-]+)*@(?!_)[A-zА-я0-9]+([\.-]?[A-zА-я0-9_-]+)*(\.[A-zА-я0-9_-]{2,10})+$/;if(reg.test($emailVal)){$($incorrectEmail).addClass('error-hide');return;}
if($emailVal.trim()===''){$($hideElements).addClass("error-hide");}}
$($email).on('input',function(){checkEmailValid($email);});var $pass=$('.js-inp-pass');var $passError=$('.js-error-pass');$($pass).on('input',function(){var $passVal=$('.js-inp-pass').val();if($passVal.length>=8){$($passError).addClass('error-hide');}});var $checkText=$('.check-box');var $checkBox=$('.checkbox');var $check=$('.check');$($checkBox).on('click',function(){var $isCheck=$(this).is(':checked');if(!($isCheck)){$checkText.addClass('error');return;}
$checkText.removeClass('error');});form.executeForm();});