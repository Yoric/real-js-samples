/* product-list/1.0.4 tools.js Date:2017-04-20 15:43:33 */
define("//misc.360buyimg.com/product/list/1.0.4/js/tools.js",[],function(require,a){var c;!function(){var a=!1;var b={};var d=!1;function e(c,e,f){$.isFunction(e)&&(f=e,e=!1),d=!!e,$.isArray(c)&&c.length>0&&$.isFunction(f)&&(c.requestID=h(),a?b[c.requestID]={skus:c,callback:f}:q(c,f))}var f=1;var g='<div class="authcode-tip"> <div class="tip-inner">     <i class="tip-icon"></i>     <div class="tip-cont">         <h5 class="tip-title">\u52a0\u6cb9\uff01\u60a8\u548c\u5b9d\u8d1d\u53ea\u6709\u4e00\u4e2a\u9a8c\u8bc1\u7801\u7684\u8ddd\u79bb\u5566\uff01</h5>         <div class="authcode-input authcode-warn">             <input class="authcode" type="text" placeholder="\u8f93\u5165\u540e\u65b9\u663e\u793a\u7684\u901a\u5173\u5bc6\u7801">             <img alt="" src="" class="code">             <a href="#" class="change">\u6362\u4e00\u6362</a>             <div style="display:none" class="input-tip">\u9a8c\u8bc1\u7801\u4e0d\u6b63\u786e\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\uff01</div>         </div>         <div class="btnbox"><a href="#none" class="f-submit">\u63d0\u4ea4</a></div>     </div> </div></div>';function h(){return f++}function i(){return $.ajax({url:"//pcp.jd.com/captcha/registry",dataType:"jsonp",timeout:2e3})}function j(a,b){return $.ajax({url:"//pcp.jd.com/verify/cp",dataType:"jsonp",timeout:2e3,data:{acId:b,authCode:a}})}function k(a){i().then(function(b){l(b,a)},n)}function l(a,b){b.data("acId",a.acId),b.attr("src","//"+a.imageUrl)}function m(){a=!1,$.closeDialog(),$.each(b,function(a,b){q(b.skus,b.callback)})}function n(){d=!0,m()}function o(){a||(a=!0,i().then(function(a){require.async(["//misc.360buyimg.com/product/module/authcode.css","//misc.360buyimg.com/jdf/1.0.0/ui/dialog/1.0.0/dialog"],function(){$("body").dialog({title:"\u63d0\u793a",width:498,type:"text",extendMainClass:"popup-authcode",source:g,onReady:function(){var b=$(this.content);var c=b.find(".code");l(a,c),b.delegate(".change","click",function(a){a.preventDefault(),a.stopPropagation(),k(c)}),b.find(".authcode").bind("keydown",function(a){13==a.keyCode&&(b.find(".f-submit").trigger("click"),a.stopPropagation(),a.preventDefault())}),b.delegate(".f-submit","click",function(a){a.stopPropagation();var d=$.trim($(".authcode").val());d&&c.data("acId")&&j(d,c.data("acId")).then(function(a){600==a||602==a?b.find(".input-tip").show():605==a?m():n()},n)})}})})},n))}function p(){var a=readCookie("__jda");return a&&a.indexOf(".")>-1?a.split(".")[1]:""}function q(a,c){var e={type:1,area:readCookie("ipLoc-djd")?readCookie("ipLoc-djd").split(".")[0].replace(/-/g,"_"):1,skuIds:$.map(a,function(a){return"J_"+a}).join(","),pdbp:d?1:0,pdtk:readCookie("pdtk")?decodeURIComponent(readCookie("pdtk")):"",pdpin:readCookie("pin")?decodeURIComponent(readCookie("pin")):"",pduid:p(),source:window.pageConfig&&window.pageConfig.pSource?window.pageConfig.pSource:"pg_"+window.location.host};$.ajax({url:"//p.3.cn/prices/mgets",dataType:"jsonp",data:e,success:function(d){if(d)if(d.error&&"pdos_captcha"==d.error)o(),b[a.requestID]={skus:a,callback:c};else{if(d.error)return;$.each(d,function(a,b){b.sku=b.id.replace(/^J_/,"")}),c.call(null,d),delete b[a.requestID]}}})}c=e}();var d=function(a){var d=readCookie("ipLoc-djd")&&readCookie("ipLoc-djd").split(".")[0]||"";var e=a.skus||[];a.loc||d;var g=a.$el||$("body");a.type||1;var i=a.selector||".J-p-";var j=a.text||"\uffe5{NUM}";var k=a.debug||!1;var l=a.callback||function(){};c(e,pageConfig&&!!pageConfig.price_pdos_off,function(a){var b,c;if(k&&console.info(a),!a&&!a.length)return!1;for(c=a.length,b=0;c>b;b++){if(!a[b].id)return!1;var d=a[b].id.replace("J_","");var e=parseFloat(a[b].p);{parseFloat(a[b].m)}g.find(i+d).html(e>0?j.replace("{NUM}",a[b].p):"\u6682\u65e0\u62a5\u4ef7"),"function"==typeof l&&l(d,a[b])}})};var e=function(a){var b=a.loc||readCookie("ipLoc-djd")&&readCookie("ipLoc-djd").split(".")[0]||"1_0_0";var c=a.skus||[];var d=a.$el||$("body");a.$target;var f=a.selector||".J-ad-";var g=a.debug||!1;var h=a.callback||function(){};$.ajax({url:"//ad.3.cn/ads/mgets",data:{skuids:"AD_"+c.join(",AD_"),areaCode:b,source:window.pageConfig&&window.pageConfig.pSource?window.pageConfig.pSource:"pg_"+window.location.host},dataType:"jsonp",success:function(a){var c,e,i,b=0;if(g&&console.log(a),a&&a.length>0)for(c=a.length,b;c>b;b++)e=a[b].ad,i=a[b].id.replace("AD_",""),d.find(f+i).html(e),h(i,a[b])}})};var f=function(a){var b=a.skus||[];var c=a.$el||$("body");var d=a.prefix||".J-pt-";if(0!=b.length){function e(a){var b="";switch(a){case 22:b='<i class="goods-icons" title="\u4f7f\u7528\u4eac\u8c46\u53ef\u4eab\u53d7\u4f18\u60e0">\u4f18\u60e0\u8d2d</i>';break;case 11:b='<i class="goods-icons" title="\u6307\u5b9a\u7ea7\u522b\u4f1a\u5458\u53ef\u4eab\u53d7\u4f18\u60e0">\u7279\u4ef7</i>';break;case 1:b='<i class="goods-icons" title="\u672c\u5546\u54c1\u6b63\u5728\u964d\u4ef7\u9500\u552e\u4e2d">\u76f4\u964d</i>';break;case 5:b='<i class="goods-icons" title="\u8d2d\u4e70\u672c\u5546\u54c1\u9001\u8d60\u54c1">\u8d60\u54c1</i>';break;case 3:b='<i class="goods-icons" title="\u8d2d\u4e70\u672c\u5546\u54c1\u8fd4\u4f18\u60e0\u5238">\u8fd4\u5238</i>';break;case 4:b='<i class="goods-icons" title="\u8d2d\u4e70\u672c\u5546\u54c1\u9001\u4eac\u8c46">\u9001\u4eac\u8c46</i>'}return b}$.ajax({url:"//pf.3.cn/flags/mgets?",dataType:"jsonp",data:{skuids:"J_"+b.join(",J_"),source:window.pageConfig&&window.pageConfig.pSource?window.pageConfig.pSource:"pg_"+window.location.host},success:function(a){var b=[];for(var g=0;g<a.length;g++){var h="";var i=c.find(d+a[g].pid);b=a[g].pf;for(var j=0;j<b.length;j++)h+=e(b[j]);i.html(h)}}})}};var g=function(a){var b=a.skus||[];var c=a.$el||$("body");var d=a.selector||".J-comm-";var e=a.text||"(\u5df2\u6709{NUM}\u4eba\u8bc4\u4ef7)";var f=a.debug||!1;var g=a.callback||function(){};if(!$.isArray(b))throw new Error("Please give skus param with Array type.");$.ajax({url:"//club.jd.com/clubservice.aspx?method=GetCommentsCount&referenceIds="+b,dataType:"jsonp",success:function(a){var b,h;if(a&&a.CommentsCount.length){b=a.CommentsCount.length;for(var i=0;b>i;i++)h=c.find(d+a.CommentsCount[i].SkuId),h.find(".star").removeClass("sa5").addClass("sa"+a.CommentsCount[i].AverageScore),h.html(e.replace("{NUM}",a.CommentsCount[i].CommentCount)),f&&console.log(h),g&&g(a.CommentsCount[i].SkuId,a.CommentsCount[i])}}})};var h=function(a,b){var c=b||"data-src";var d=a.find("img["+c+"]");d.length&&d.each(function(){$(this).attr("src",$(this).attr(c)).removeAttr(c)})};var i=function(a,b){var c=a.length/b;var d=[];for(var e=0;c>e;e++)d.push({tabs:[],increment:null,count:b,skuids:[]});var f=0;for(var g=0;g<a.length;g++)g%b==0&&f++,d[f-1].tabs.push(a[g]),d[f-1].increment=f,d[f-1].skuids.push(a[g].wid);return d};a.commentMeta=g,a.priceNum=d,a.promTag=f,a.adWords=e,a.triggerLazyImg=h,a.reBuildJSON=i,a.getPrice=c});