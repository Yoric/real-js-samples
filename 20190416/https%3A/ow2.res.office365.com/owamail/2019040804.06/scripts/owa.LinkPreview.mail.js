window.scriptsLoaded = window.scriptsLoaded || {}; window.scriptProcessStart = window.scriptProcessStart || {}; window.scriptProcessStart['owa.LinkPreview.mail.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[156],{1630:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(51);t.default=function(e){return r.makeServiceRequest("GetBposShellInfoNavBarData",{},e)}},1640:function(e,t,n){"use strict";var r=n(1),i=Object(r.createStore)("bposStore",{bposNavBarData:null})(),o=Object(r.mutatorAction)("setBposNavBarData",function(e){i.bposNavBarData=e}),s=n(1630),a=n.n(s);var c=n(29),u=Object(r.action)("LOAD_BposNavBarData"),d=u;Object(r.orchestrator)(u,function(e){Object(c.m)()||a()().then(function(e){o(e)})});var l=n(27);function f(){return i.bposNavBarData}n.d(t,"a",function(){return f}),Object(l.d)(function(){d()})},1874:function(e,t,n){"use strict";n.r(t);var r=n(4164);n.d(t,"createLinkPreview",function(){return r.a});var i=n(4165);n.d(t,"rehydrateLinkPreview",function(){return i.a})},2991:function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"a",function(){return i});var r="owa-remove-on-send-start",i="owa-remove-on-send-end"},3179:function(e,t,n){"use strict";var r=n(1640),i=n(5),o=n(11),s=n(139),a=["https://microsoft.sharepoint.com","https://microsoft-my.sharepoint.com","https://microsoft.sharepoint-df.com","https://microsoft-my.sharepoint-df.com"];function c(e){var t=Object(r.a)();return t?!!u(e,t.SPO_MySiteHostUrl)||(!!u(e,t.SPO_RootSiteUrl)||!!Object(i.d)("doc-SharePoint-dogfoodUser")&&a.some(function(t){return u(e,t)})):(o.c.info("isSharePointLink:bposNavBarData is null"),!1)}function u(e,t){return Object(s.parse)(e).hostname===Object(s.parse)(t).hostname&&e!==t}function d(e){return!!e&&(e.indexOf("?at=")>0||e.indexOf("&at=")>0)}n.d(t,"a",function(){return c}),n.d(t,"b",function(){return d})},4164:function(e,t,n){"use strict";n.d(t,"a",function(){return d});var r=n(0),i=n(3143),o=n(3432),s=n(3526),a=n(4526),c=n(11),u=n(3179);function d(e,t){return r.__awaiter(this,void 0,void 0,function(){var n,d;return r.__generator(this,function(r){switch(r.label){case 0:return n=null,0!==e.id.indexOf(i.f)&&0!==e.id.indexOf(i.u)?[3,1]:[3,3];case 1:return Object(u.a)(e.href)?[2,n]:(e.id&&e.id.length>0?e.id=i.f+e.id:e.id=i.f+i.w(),[4,Object(a.a)(e.href,e.id)]);case 2:(d=r.sent())?n=function(e,t,n){if(e.Error)c.c.info("GetLinkPreview returned error response: "+e.Error);else if(!e.IsDisabled)return function(e,t,n){if(e)switch(e.__type){case i.a:return Object(o.b)(e,t,n);case i.b:return Object(s.b)(e,t,n)}return null}(e.LinkPreview,t,n);return null}(d,e,t):c.c.error("No response for getLinkPreview request with id: "+e.id),r.label=3;case 3:return[2,n]}})})}},4165:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(0),i=n(3143),o=n(3432),s=n(3526);function a(e){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(t){if(0===e.id.indexOf(i.g))switch(n=e.id,r=n.split("_"),r&&r.length>1&&0===r[1].indexOf(i.i)?i.i:0===r[1].indexOf(i.h)?i.h:null){case i.i:return[2,Object(o.c)(e)];case i.h:return[2,Object(s.c)(e)]}var n,r;return[2,Promise.reject("div did not match a known link preview type")]})})}},7148:function(e,t,n){"use strict";n.r(t);var r=n(3142),i=n(3526);function o(e,t){Object(r.b)(e,t),e.hasOwnProperty("videoPlayer")&&Object(i.a)(e)}var s=n(4164),a=n(4165),c=n(4524),u=n(181),d=n(7),l=n(2991),f=new RegExp("\x3c!--"+l.b+"--\x3e.*?\x3c!--"+l.a+"--\x3e","gim");var v=n(3143),h=700,p=function(){function e(e){var t=this;this.scrollAdapter=e,this.onResize=function(){var e=t.scrollAdapter&&t.scrollAdapter.getScrollContainer();e&&(e.clientWidth<h?t.setPreviewSize(c.a.Compact):t.setPreviewSize(c.a.Standard))},this.linkPreviewObjects=[],this.featureEnabled=Object(d.a)().UserOptions.LinkPreviewEnabled}return e.prototype.getName=function(){return"LinkPreview"},e.prototype.initialize=function(e){this.editor=e,u.a.importAndExecute(this.onResize),this.onResize()},e.prototype.dispose=function(){this.linkPreviewObjects=null,this.editor=null,this.scrollAdapter=null,this.isDisposed=!0,u.c.importAndExecute(this.onResize)},e.prototype.onPluginEvent=function(e){var t;if(this.featureEnabled)if(6===e.eventType){var n=e;if("AutoLink"===n.source&&n.data&&n.data instanceof HTMLAnchorElement){var r=n.data;this.generateLinkPreviewBelowAnchor(r)}else"SetContent"===n.source&&this.rehydrateLinkPreviewsInEditorBody()}else if(7===e.eventType){var i=e;i.content=(t=i.content)?t.replace(f,""):t}else if(0===e.eventType){var o=e,s=o.rawEvent;this.onKeyDownEvent(o,s)}else if(8===e.eventType){var a=e.fragment;if(a&&a.childNodes&&1==a.childNodes.length){var c=a.firstElementChild;if(c instanceof HTMLAnchorElement){r=c;this.generateLinkPreviewBelowAnchor(r)}}}},e.onLinkPreviewRemoved=function(e){return function(t){e.editor&&t&&t.border&&t.border.parentElement&&(e.moveCursorBelowElement(t.border),e.editor.deleteNode(t.border),e.linkPreviewObjects=e.linkPreviewObjects.filter(function(e){return e!=t}))}},e.prototype.isImageLink=function(e){var t=e.href;return!!t&&!!t.match(".(bmp|gif|jpe?g|png)$")},e.prototype.onImageLoadedIntoEditor=function(e){var t=e.target;t&&(t.onload=null,t.onerror=null)},e.prototype.onImageError=function(e){var t=e.target;t&&(t.onload=null,t.onerror=null,null!=t.parentNode&&t.parentNode.removeChild(t))},e.prototype.generateLinkPreviewBelowAnchor=function(t){var n=this;this.isImageLink(t)?this.tryInsertImageIntoEditor(t):Object(s.a)(t,!0).then(function(r){r&&!n.isDisposed&&(n.linkPreviewObjects.push(r),Object(c.b)(r,n.previewSize),n.insertLinkPreview(t,r.border),o(r,e.onLinkPreviewRemoved(n)))})},e.prototype.insertLinkPreview=function(e,t){this.editor&&(this.insertLinkPreviewElementIntoEditor(t,e),t.parentNode&&t.parentNode.insertBefore(this.editor.getDocument().createElement("br"),t.nextSibling))},e.prototype.tryInsertImageIntoEditor=function(e){if(this.editor){var t=this.editor.getDocument().createElement("img");t.onload=this.onImageLoadedIntoEditor,t.onerror=this.onImageError,t.style.maxWidth="100%",t.src=e.href,this.insertLinkPreviewElementIntoEditor(t,e)}},e.prototype.insertLinkPreviewElementIntoEditor=function(e,t){var n=this.editor.getDocument().createElement("span");this.editor.insertNode(n,{insertOnNewLine:!1,position:2,replaceSelection:!1,updateCursor:!0}),this.moveCursorBelowElement(t),this.editor.insertNode(e,{insertOnNewLine:!0,position:2,replaceSelection:!1,updateCursor:!0}),this.moveCursorBelowElement(n),this.editor.deleteNode(n),this.editor.triggerContentChangedEvent("LinkPreview"),this.editor.addUndoSnapshot()},e.prototype.rehydrateLinkPreviewsInEditorBody=function(){var t=this;this.editor.queryElements("[id^=LPBorder]",function(n){Object(a.a)(n).then(function(n){t.isDisposed||(t.linkPreviewObjects.push(n),o(n,e.onLinkPreviewRemoved(t)))})})},e.prototype.setPreviewSize=function(e){var t=this;e!=this.previewSize&&(this.previewSize=e,this.linkPreviewObjects&&this.linkPreviewObjects.forEach(function(e){Object(c.b)(e,t.previewSize)}))},e.prototype.moveCursorBelowElement=function(e){this.editor.select(e,-3)},e.prototype.onKeyDownEvent=function(e,t){if(this.linkPreviewObjects&&this.linkPreviewObjects.length>0&&(8==t.which||46==t.which)){var n=this.editor.getBlockTraverser(2);if(!n)return;var r=n.currentBlockElement&&n.currentBlockElement.getEndNode();if(r){var i=null,o=this.findLinkPreviewAboveElement(r);if(o)i=o;else if(8==t.which){n.getPreviousInlineElement()||(i=this.findLinkPreviewBeforeOrAfterElement(r,!0))}else if(46==t.which){n.getNextInlineElement()||(i=this.findLinkPreviewBeforeOrAfterElement(r,!1))}i&&(this.editor.deleteNode(i),this.preventDefaultEventAndStopPropagation(e),this.editor.addUndoSnapshot())}}},e.prototype.findLinkPreviewAboveElement=function(e){if(v.x(e,v.r)){var t=v.v(e.id,v.g),n=this.editor.queryElements("."+t);return n?n[0]:null}return null},e.prototype.findLinkPreviewBeforeOrAfterElement=function(e,t){var n=t?e.previousSibling:e.nextSibling;return v.x(n,v.g)?n:null},e.prototype.preventDefaultEventAndStopPropagation=function(e){e.rawEvent.preventDefault(),e.rawEvent.stopPropagation()},e}();t.default=p},7155:function(e,t,n){"use strict";n.r(t);var r=n(3526);function i(e){e.hasOwnProperty("videoPlayer")&&Object(r.a)(e)}n.d(t,"addInteractiveElementsForReadingPane",function(){return i})}},0,[289,109]]);
//# sourceMappingURL=owa.LinkPreview.mail.js.map
window.scriptsLoaded['owa.LinkPreview.mail.js'] = 1; window.scriptProcessEnd = window.scriptProcessEnd || {}; window.scriptProcessEnd['owa.LinkPreview.mail.js'] = (new Date()).getTime();