window.scriptsLoaded = window.scriptsLoaded || {}; window.scriptProcessStart = window.scriptProcessStart || {}; window.scriptProcessStart['owa.Lightning.mail.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[153],{7010:function(n,e,t){"use strict";t.r(e);var i=t(11),r=t(4),o=t(117),c=t(0),a=t(9),s=t(956),u=Object(r.action)("initializeLightning")(function(n){var e,t;i.c.info("initialize lightning store");var r=Object(s.a)();if(r.lastShownId=null,r.lightedCount=0,r.unseenItems=new a.ObservableMap,n)try{for(var o=c.__values(n),u=o.next();!u.done;u=o.next()){var l=u.value;r.unseenItems.set(l.identity,l)}}catch(n){e={error:n}}finally{try{u&&!u.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}});var l,g=t(56),h="ows/v1.0/lightning/items/unseen";function d(){return i.c.info("initialize lightning from server"),Object(g.b)(h).then(function(n){var e=n.map(f);u(e)})}function f(n){return n.category?{identity:n.id,visible:!1,category:n.category}:{identity:n,visible:!1}}var v="lightning";function b(){if(!l){var n="undefined"!=typeof location&&location.search?Object(o.parse)(location.search.substr(1)):null;l=n&&n.hasOwnProperty(v)?function(n){i.c.info("initialize lightning from override query parameter");var e=n.split(",").map(function(n){return{identity:n,visible:!1}});return u(e),Promise.resolve()}(n[v]):d()}return l}var I,m=t(12),p=Object(r.action)("lightup")(function(n){i.c.info("lightup - id:"+n);var e=Object(s.a)();e.lastShownId=n,e.lightedCount++,e.unseenItems.get(n).visible=!0,Object(m.k)("LIGHTUP",[n])}),w=t(96);!function(n){n.None="0",n.UpSell="1",n.FeatureDiscovery="2",n.TeachingMoment="3",n.UITeachingMoment="4",n.UIFeatureDiscovery="5",n.UIUpSell="6",n.JITNewUser="7",n.Compliance="8",n.SatCoreMetric="9",n.UpSellExperiment="10"}(I||(I={}));var y=Object(r.select)({lastShownId:function(){return s.b.lastShownId},lightedCount:function(){return s.b.lightedCount},unseenItems:function(){return s.b.unseenItems}})(function(n,e,t){(i.c.info("lightupOrReject - id:"+n+", recurrenceCount:"+e+", lightedCount:"+s.b.lightedCount+", lastShown:"+s.b.lastShownId),Object(w.s)(location))?i.c.info("lightning is disabled for deeplink"):t.unseenItems.has(n)&&(!function(n){return!!n.lastShownId}(t)||function(n,e,t){var i=!1;if(e.lastShownId&&t&&!function(n){return n.unseenItems.get(n.lastShownId)&&n.unseenItems.get(n.lastShownId).visible}(e)){var r=t.indexOf(e.lastShownId),o=t.indexOf(n);r>=0&&r+1==o&&(i=!0)}return i}(n,t,e)||function(n,e){return e.unseenItems.get(n).category==I.UIFeatureDiscovery}(n,t))&&p(n)});var O=Object(r.action)("beginLightning")(function(n,e,t){i.c.info("beginLightning - id:"+n),e(function(){b().then(function(){return y(n,t)}).catch(function(e){i.c.warn("something is wrong, lightning id:"+n+", reason:"+e)})})}),j="ows/v1.0/lightning/items";var S="undefined"!=typeof location&&location.search?Object(o.parse)(location.search.substr(1)):null,C=Object(r.action)("endLightning")(function(n,e){i.c.info("endLightning - id:"+n);var t=Object(s.a)().unseenItems;return Object(s.a)().lastShownId==n&&t.get(n)&&t.get(n).visible?(t.delete(n),Object(m.k)("Lighted",[n]),S&&S.hasOwnProperty("lightning")?(i.c.info("skipping the update because override exists"),Promise.resolve()):function(n,e){return void 0===e&&(e="Primary"),Object(g.e)(j+"/"+n+"?actionType="+e,{id:n})}(n,e)):Promise.resolve()});t.d(e,"beginLightningImp",function(){return O}),t.d(e,"endLightningImp",function(){return C})}},0,[279,51,280,57]]);
//# sourceMappingURL=owa.Lightning.mail.js.map
window.scriptsLoaded['owa.Lightning.mail.js'] = 1; window.scriptProcessEnd = window.scriptProcessEnd || {}; window.scriptProcessEnd['owa.Lightning.mail.js'] = (new Date()).getTime();