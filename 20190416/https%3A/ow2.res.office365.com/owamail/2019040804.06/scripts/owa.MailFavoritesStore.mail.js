window.scriptsLoaded = window.scriptsLoaded || {}; window.scriptProcessStart = window.scriptProcessStart || {}; window.scriptProcessStart['owa.MailFavoritesStore.mail.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[164],{3221:function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=t(0);r.default=function(e){return o.__assign({__type:"UpdateFavoriteFolderRequest:#Exchange"},e)}},3556:function(e,r,t){"use strict";t.d(r,"a",function(){return l});var o=t(408),a=t.n(o),n=t(65),i=t.n(n),s=t(3221),d=t.n(s),c=t(3785),u=t.n(c);function l(e,r){var t=function(e,r){var t=i()({Id:e.FolderId.Id,ChangeKey:e.FolderId.ChangeKey});return d()({Folder:a()({FolderId:t,DisplayName:e.DisplayName}),Operation:r?0:1})}(e,r);return u()({request:t}).then(function(e){return e})}},3785:function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o=t(51),a=t(3221);r.default=function(e,r){return void 0===e.request||e.request.__type||(e.request=a.default(e.request)),o.makeServiceRequest("UpdateFavoriteFolder",e,r)}},6976:function(e,r,t){"use strict";t.r(r);var o=t(0),a=t(1),n=t(30),i=t(5),s=t(42),d=1e4,c={folderId:"",timeRemoved:null};var u=Object(a.action)("ADD_FAVORITE_FOLDER",function(e,r){return Object(n.a)({name:Object(i.d)("tri-favorites-roaming")?"AddOutlookFavoriteFolder":"AddFavoriteFolder",customData:{actionSource:r,distinguishedFolderName:Object(s.a)(e),wasFolderUnfavoritedRecently:(t=e,!(!c.folderId||c.folderId!=t)&&(new Date).getTime()-c.timeRemoved.getTime()<d)}},{folderIdToAdd:e,actionSource:r});var t}),l=t(3556),v=t(10),f=t(4),b=t(14),F=Object(f.action)("addFavoriteFolderV1")(Object(f.select)({favoritesFolderNodes:function(){return b.n.favoritesFolderNodes},orderedFavoritesNodeIds:function(){return b.n.orderedFavoritesNodeIds},folder:function(e){return v.n.folderTable.get(e)}})(function(e,r){if(r.favoritesFolderNodes.has(e))throw new Error("addFavoriteFolderV1: Cannot add duplicate folder to favorites.");r.orderedFavoritesNodeIds.push(e),r.favoritesFolderNodes.set(e,{id:e,type:0}),Object(b.kb)(),Object(l.a)(r.folder,!0)})),m=(Object(a.orchestrator)(u,function(e){return o.__awaiter(void 0,void 0,void 0,function(){var r;return o.__generator(this,function(t){switch(t.label){case 0:return r=e.folderIdToAdd,Object(i.d)("tri-favorites-roaming")?[4,b.K.import()]:[3,2];case 1:return t.sent()(r),[3,3];case 2:F(r),t.label=3;case 3:return[2]}})})}),Object(a.action)("REMOVE_FAVORITE_FOLDER",function(e,r){return Object(n.a)({name:Object(i.d)("tri-favorites-roaming")?"RemoveFavoriteFolderV2":"RemoveFavoriteFolderV1",customData:{actionSource:r,distinguishedFolderName:Object(s.a)(e)}},{folderIdToRemove:e,actionSource:r})})),O=Object(f.action)("removeFavoriteFolderV1")(Object(f.select)({favoritesFolderNodes:function(){return b.n.favoritesFolderNodes},orderedFavoritesNodeIds:function(){return b.n.orderedFavoritesNodeIds},folder:function(e){return v.n.folderTable.get(e)}})(function(e,r){if(!r.favoritesFolderNodes.has(e))throw new Error("removeFavoriteFolderV1: Cannot find the folder id in favorite folder list.");r.orderedFavoritesNodeIds.splice(r.orderedFavoritesNodeIds.indexOf(e),1),r.favoritesFolderNodes.delete(e),Object(b.kb)(),c={folderId:e,timeRemoved:new Date},Object(l.a)(r.folder,!1)})),p=(Object(a.orchestrator)(m,function(e){return o.__awaiter(void 0,void 0,void 0,function(){var r;return o.__generator(this,function(t){switch(t.label){case 0:return r=e.folderIdToRemove,Object(i.d)("tri-favorites-roaming")?[4,b.X.import()]:[3,2];case 1:return t.sent()(r),[3,3];case 2:O(r),t.label=3;case 3:return[2]}})})}),t(651)),h=t(53),j=t(133);Object(a.orchestrator)(b.fb,function(e){var r=e.categoryId;p.a(r),function(e){var r=Object(h.b)(e),t=Object(j.c)(r,!0);Object(h.j)(t,!1,function(r,t,o,a,n){return function(e){p.b(e)}(e)})}(r)});Object(a.orchestrator)(b.gb,function(e){p.b(e.categoryId)});var g=t(8),N=t.n(g),_=t(857);function I(e){return o.__awaiter(this,void 0,void 0,function(){var r,t;return o.__generator(this,function(o){return r=e?_.c.RemoveFavoritePersonaFailedNotification:_.c.AddFavoritePersonaFailedNotification,Object(_.g)(r,null),t={actionType:r,title:e?N.a.favoritesRemoveErrorTitleText:N.a.favoritesErrorTitleText,description:e?N.a.favoritesRemoveErrorDescriptionText:N.a.favoritesErrorDescriptionText,actionLink:N.a.favoritesErrorCloseButtonText},Object(_.f)(t),[2]})})}var w=t(11);function y(e){return o.__awaiter(this,void 0,void 0,function(){var r;return o.__generator(this,function(t){return r=e?N.a.favoritesRemoveErrorTitleText:N.a.favoritesErrorTitleText,w.c.warn(r),[2]})})}Object(a.orchestrator)(b.b,function(e){var r=e.favoriteKind;"persona"===r?I(!1):"privatedistributionlist"===r&&y(!1)}),Object(a.orchestrator)(b.ib,function(e){var r=e.favoriteKind,t=e.error;t&&404===t.statusCode||("persona"===r?I(!0):"privatedistributionlist"===r&&y(!0))});var E=Object(f.action)("markFavoritePersonaNodeAsAdded")(Object(f.select)({favoritesPersonaNodes:function(){return b.n.favoritesPersonaNodes}})(function(e,r){var t=r.favoritesPersonaNodes.get(e);t&&(t.isJustAdded=!1)})),P=t(1154),A=t(1168),T=t(12),R=t(253),D=Object(n.b)("validateAndUpdateFavorite",R.a.ValidateAndUpdateFavorite)(function(e){return o.__awaiter(this,void 0,void 0,function(){var r,t,a,n,i,s,d,c,u,l,v,f,F;return o.__generator(this,function(o){switch(o.label){case 0:return r=Object(b.v)(),t=r.favoritesPersonaNodes.get(e),a=Object(b.B)(e)?e:"",t.personaId?(n=Object(A.a)(t.mainEmailAddress,t.displayName,!1),[4,Object(P.a)(t.personaId)]):[3,5];case 1:return(F=o.sent())?(s=F,[3,4]):[3,2];case 2:return[4,n];case 3:s=o.sent(),o.label=4;case 4:return(i=s)?(d=i.DisplayName,c=C(i.EmailAddress),u=(i.EmailAddresses||[]).map(C),l=t.displayName!==d,v=t.mainEmailAddress!==c,m=t.allEmailAddresses,O=u,f=!(m&&O&&m.length===O.length&&m.every(function(e){return O.includes(e)})),l||v||f?(Object(T.k)("ValidateAndUpdateFavorite: Change Detected",["ContactToUpdatedContact",a,l,v,f]),S(t,d,c,u,i.PersonaId.Id),[2,!0]):[2,!1]):(Object(T.k)("ValidateAndUpdateFavorite: Change Detected",["ContactToRecipentCache",a]),S(t,t.displayName,t.mainEmailAddress,t.allEmailAddresses),[2,!0]);case 5:return[4,Object(A.a)(t.mainEmailAddress,t.displayName,!1)];case 6:return(F=o.sent())?(Object(T.k)("ValidateAndUpdateFavorite: Change Detected",["RecipientCacheToContact",a]),S(t,F.DisplayName,C(F.EmailAddress),F.EmailAddresses.map(C),F.PersonaId.Id),[2,!0]):[2,!1];case 7:return[2]}var m,O})})}),S=Object(f.action)("updatePersona")(function(e,r,t,o,a){e.displayName=r||t,e.mainEmailAddress=t,e.allEmailAddresses=o,a?e.personaId=a:delete e.personaId});function C(e){return e?e.RoutingType&&"EX"===e.RoutingType.toUpperCase()?e.OriginalDisplayName:e.EmailAddress||e.OriginalDisplayName:""}var k=t(1105),U=t(59),V=Object(f.action)("updateSelectedNodeWithNewPersona")(function(e){var r=Object(b.v)().favoritesPersonaNodes.get(e),t=Object(U.d)();t.selectedNode=o.__assign({},t.selectedNode,{displayName:r.displayName,mainEmailAddress:r.mainEmailAddress})}),x=t(819),q=Object(n.b)("onFavoritePersonaSelected",R.a.OnFavoritePersonaSelectedAction)(Object(f.select)({favoritesPersonaNodes:function(){return b.n.favoritesPersonaNodes}})(function(e,r){return o.__awaiter(this,void 0,void 0,function(){var t,a,n,i,s;return o.__generator(this,function(o){switch(o.label){case 0:if((t=r.favoritesPersonaNodes.get(e)).isSyncUpdateDone)return[2];o.label=1;case 1:return o.trys.push([1,6,,7]),[4,D(t.id)];case 2:return(a=o.sent())&&V(t.id),[4,Object(k.a)(t,"OnClick",a)];case 3:return(n=o.sent())&&setTimeout(function(){Object(x.b)(t.id)},x.a),a||n?[4,Object(b.kb)()]:[3,5];case 4:o.sent(),o.label=5;case 5:return[3,7];case 6:return i=o.sent(),s="UpdatePersonaAndSearchFolderFailure",w.c.warn(s+": "+i),Object(T.k)(s,[i.toString()]),[3,7];case 7:return[2]}})})})),K=Object(n.b)("onFavoritePersonaUpdated",R.a.OnFavoritePersonaUpdatedAction)(function(e){return o.__awaiter(this,void 0,void 0,function(){var r,t,a;return o.__generator(this,function(o){switch(o.label){case 0:return r=Object(b.v)().favoritesPersonaNodes.get(e),[4,D(r.id)];case 1:return t=o.sent(),[4,Object(k.a)(r,"OnFavoriteUpdate",t)];case 2:return a=o.sent(),t||a?[4,Object(b.kb)()]:[3,4];case 3:o.sent(),o.label=4;case 4:return[2]}})})}),B=t(262);function L(e){return o.__awaiter(this,void 0,void 0,function(){var r,t,a,n;return o.__generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),e.markedForDeletion?[4,Object(B.c)([e.searchFolderId],!0)]:[3,2];case 1:o.sent(),o.label=2;case 2:return[3,4];case 3:return r=o.sent(),t=R.a.DeleteFolderFailure,a=t.name,n=t.customData,w.c.warn(a+": "+r),Object(T.k)(a,n(r.toString())),[3,4];case 4:return[2]}})})}var M=t(608),W=Object(n.b)("removeFavoritePersona",R.a.RemoveFavoritePersonaAction)(function(e,r){return o.__awaiter(this,void 0,void 0,function(){var r,t,a,n,i,s,d,c,u,l,v,f,F;return o.__generator(this,function(m){switch(m.label){case 0:r=Object(b.v)(),t=r.favoritesPersonaNodes.get(e),a=void 0,n=!1,m.label=1;case 1:if(m.trys.push([1,9,,10]),!t)throw new Error("RemoveFavoritePersona - NodeId could not be found in the store");if(a=t.mainEmailAddress||t.personaId||t.id,Object(M.a)(a))throw new Error("RemoveFavoritePersona - Favoriting is already in progress");return p.a(a),n=!0,(i=r.orderedFavoritesNodeIds.indexOf(e))>-1&&r.orderedFavoritesNodeIds.splice(i,1),r.favoritesPersonaNodes.delete(e),[4,Object(b.kb)()];case 2:m.sent(),s=t.searchFolderId,m.label=3;case 3:return m.trys.push([3,7,,8]),s?(d=Object(U.c)()).id!==e?[3,4]:(d.markedForDeletion=!0,[3,6]):[3,6];case 4:return[4,Object(B.c)([s],!0)];case 5:m.sent(),m.label=6;case 6:return[3,8];case 7:return c=m.sent(),u=R.a.DeleteFolderFailure,f=u.name,l=u.customData,w.c.warn(f+": "+c),Object(T.k)(f,l(c.toString())),[3,8];case 8:return p.b(a),[3,10];case 9:throw v=m.sent(),n&&p.b(a),f="RemoveFavoritePersonaFailure",w.c.warn(f+": "+v),F=r.favoritesPersonaNodes.size,Object(T.k)(f,[v.toString(),e,F.toString()]),t&&!r.favoritesPersonaNodes.has(t.id)&&(r.orderedFavoritesNodeIds.push(t.id),r.favoritesPersonaNodes.set(t.id,t)),o.__assign({type:"RemoveFavoritePersonaError"},v);case 10:return[2]}})})});function X(e,r){return o.__awaiter(this,void 0,void 0,function(){return o.__generator(this,function(t){switch(t.label){case 0:return Object(i.d)("tri-favorites-roaming")?[4,b.ab.import()]:[3,2];case 1:return t.sent()(e,r),[3,4];case 2:return[4,W(e,r)];case 3:return[2,t.sent()];case 4:return[2]}})})}var $=Object(n.b)("RemoveFavoriteSearch",R.a.RemoveFavoriteSearch)(function(e,r){var t=Object(b.v)();if(!t.favoriteSearches.has(e))throw new Error("Cannot find the search query in favorite search list.");t.orderedFavoritesNodeIds.splice(t.orderedFavoritesNodeIds.indexOf(e),1),t.favoriteSearches.delete(e),Object(b.kb)()}),z=t(60),J=t.n(z),G=t(36),H=t.n(G),Q=t(7),Y=t(79),Z=Object(f.action)("toggleFavoritesTreeExpansion")(function(){var e=Object(Q.a)().UserOptions;e.IsFavoritesFolderTreeCollapsed=!e.IsFavoritesFolderTreeCollapsed,Object(Y.a)("OWA.UserOptions",[J()({DictionaryKey:H()({Type:"String",Value:["IsFavoritesFolderTreeCollapsed"]}),DictionaryValue:H()({Type:"Boolean",Value:[String(e.IsFavoritesFolderTreeCollapsed)]})})])});t.d(r,"addFavoriteFolder",function(){return u}),t.d(r,"removeFavoriteFolder",function(){return m}),t.d(r,"markFavoritePersonaNodeAsAdded",function(){return E}),t.d(r,"onFavoritePersonaSelected",function(){return q}),t.d(r,"onFavoritePersonaUpdated",function(){return K}),t.d(r,"onSelectedPersonaNodeChanged",function(){return L}),t.d(r,"removeFavoritePersona",function(){return X}),t.d(r,"handleToggleFavoritePersonaError",function(){return I}),t.d(r,"removeFavoriteSearch",function(){return $}),t.d(r,"toggleFavoritesTreeExpansion",function(){return Z})}},0,[5,6,9,11,217,2,3,8,66,0,1,176,10,14,17,193,7,23,62,279,51,280,57,283,80,300,186,100,175,360]]);
//# sourceMappingURL=owa.MailFavoritesStore.mail.js.map
window.scriptsLoaded['owa.MailFavoritesStore.mail.js'] = 1; window.scriptProcessEnd = window.scriptProcessEnd || {}; window.scriptProcessEnd['owa.MailFavoritesStore.mail.js'] = (new Date()).getTime();