window.scriptsLoaded = window.scriptsLoaded || {}; window.scriptProcessStart = window.scriptProcessStart || {}; window.scriptProcessStart['owa.MarkRead.mail.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[178],{1572:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(51),a=n(1749);t.default=function(e,t){return void 0===e||e.__type||(e=a.default(e)),r.makeServiceRequest("ApplyConversationAction",e,t)}},1573:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"ApplyConversationActionRequest:#Exchange"},e)}},1574:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"ConversationAction:#Exchange"},e)}},1749:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"ApplyConversationActionJsonRequest:#Exchange"},e)}},1775:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n(6),o={markConversationAsRead:{name:function(e,t,n,r,a,o,i){var c="TnS_MarkConversation";return c+=n?"Read":"Unread",r||(c+="Background"),c},options:function(e,t,n,r,a,o,i){return r?{isCore:!0}:{}},customData:function(e,t,n,r,o,i,c){return[o,e.length,Object(a.k)(t),Object(a.D)(t)]},cosmosOnlyData:function(e,t,n,o,i,c,s){var u,d,l=[],f=Object(a.w)(e,t);try{for(var b=r.__values(f),v=b.next();!v.done;v=b.next()){var m=v.value;l.push(a.b.getItemIds(m,t))}}catch(e){u={error:e}}finally{try{v&&!v.done&&(d=b.return)&&d.call(b)}finally{if(u)throw u.error}}return JSON.stringify({itemIds:l,conversationIds:e})}},markItemReadUnread:{name:function(e,t,n,r,a,o){var i="TnS_MarkItem";return i+=n?"Read":"Unread",r||(i+="Background"),i},options:function(e,t,n,r,a,o){return r?{isCore:!0}:{}},customData:function(e,t,n,r,o,i){var c=e?e.tableQuery.type:null,s=e?Object(a.k)(e):null,u=e?Object(a.D)(e):null;return[c,t.length,s,u]},cosmosOnlyData:function(e,t,n,r,a,o){return JSON.stringify({itemIds:t})},actionSource:function(e,t,n,r,a){return a}}},i=n(22);var c=n(4),s=n(1),u=Object(s.createStore)("markread",{markAsReadTimerTask:null,suppressedItemIdsMap:{}})(),d=Object(c.action)("AddMarkReadSuppressedItemIds")(Object(c.select)({store:function(){return u}})(function(e,t){e.forEach(function(e){return t.store.suppressedItemIdsMap[e]=!0})})),l=Object(c.action)("RemoveMarkReadSuppressedItemIds")(Object(c.select)({store:function(){return u}})(function(e,t){e.forEach(function(e){return delete t.store.suppressedItemIdsMap[e]})})),f=Object(c.action)("ClearMarkReadSuppressedMap")(Object(c.select)({store:function(){return u}})(function(e){e.store.suppressedItemIdsMap={}}));function b(e){for(var t=0;t<e.length;t++)if(!u.suppressedItemIdsMap[e[t]])return!1;return!0}var v=n(363),m=n(7),O=n(556),p=n.n(O),j=n(167),R=n.n(j),I=n(557),y=n.n(I),h=n(558),k=n.n(h),g=n(31);function A(e,t,n){var r=function(e,t){var n="AlwaysSend"!=Object(m.a)().UserOptions.ReadReceipt,r=Object(v.a)("IsRead",t),a=[];return e.forEach(function(e){return a.push(p()({Updates:[r],ItemId:R()({Id:e})}))}),k()({ItemChanges:a,ConflictResolution:"AlwaysOverwrite",MessageDisposition:"SaveOnly",SuppressReadReceipts:n})}(e,t);return y()({Header:Object(g.getJsonRequestHeader)(),Body:r},n).then(function(e){return e.Body.ResponseMessages.Items[0]})}var w=n(2903),_=n(40),S=n(632),M=n(58),C=n(11),P=n(30),T=Object(P.b)("markItemsAsReadBasedOnItemIds",o.markItemReadUnread)(function(e,t,n,o,c,s){return r.__awaiter(this,void 0,void 0,function(){var u,f,b;return r.__generator(this,function(r){return 0==(u=function(e,t){var n=[];return e.forEach(function(e){var r=i.a.items.get(e);Object(a.F)(r)&&r.IsRead!=t&&n.push(e)}),n}(t,n)).length?[2,Promise.resolve()]:(n?l(u):o?d(u):C.c.warn("Invalid scenario to implicitly mark item as unread."),f=e?e.id:null,Object(S.a)(u,n,o,f),w.a.import().then(function(t){t(e?e.tableQuery:null,!1,n,c,u)}),n?o?Object(_.n)("MarkAsRead",s):Object(_.n)("MarkAsReadImplicit",s):Object(_.n)("MarkAsUnread",s),b=Object(M.b)(e).requestOptions,[2,A(u,n,b).then(function(e){var t=e.ResponseClass;if(void 0!==t&&"Success"!=t){var n=new Error("ResponseCode="+e.ResponseCode+", Stacktrace="+e.StackTrace);return n.fetchErrorType="ServerFailure",Promise.reject(n)}return Promise.resolve()}).catch(function(e){return Promise.reject(e)})])})})}),U=Object(c.action)("autoMarkItemAsRead")(function(e,t){"Unread"!==Object(a.D)(t)&&(b([e])||(T(t,[e],!0,!1,null,[]),f()))}),D=Object(c.action)("onItemPartDeselected")(function(e,t){t&&"OnSelectionChange"==Object(m.a)().UserOptions.PreviewMarkAsRead&&U(e,t)}),E=n(2911),F=n(2632),x=n(1573),V=n.n(x),B=n(1574),q=n.n(B),N=n(1572),Q=n.n(N),H=n(726);function J(e,t,n){var r=Object(F.a)(n),a=e.map(function(e){return function(e,t,n){return q()({Action:"SetReadState",ConversationId:R()({Id:e.conversationId}),IsRead:t,ConversationLastSyncTime:Object(E.a)(e.conversationLastSyncTimeStamp),SuppressReadReceipts:!0,ContextFolderId:n})}(e,t,r)});return V()({ConversationActions:a,ReturnMovedItemIds:!1})}var K=n(628),L=n(1013),G=n(2231);var $=Object(P.b)("markConversationsAsReadBasedOnConversationIds",o.markConversationAsRead)(function(e,t,n,o,i,c,s){var u=function(e,t,n){var r=[];return e.forEach(function(e){var o=Object(a.A)(e,t);o&&o.unreadCount>0===n&&r.push(e)}),r}(s,t.id,n);if(0==u.length)return Promise.resolve();if(1==e.length&&1==t.selectedRowKeys.size){var l=a.b.getRowIdString(u[0],t),b=Object(a.A)(r.__spread(t.selectedRowKeys.keys())[0],t.id);if(l==b.id){var v=b.itemIds;n?f():o?d(v):C.c.warn("Invalid scenario to implicitly mark conversation as unread.")}}var m=Object(L.a)(t),O=u.map(function(e){return Object(a.f)(e,t.id)});Object(K.a)(e,t.id,n,o),w.a.import().then(function(r){r(t.tableQuery,!1,n,i,e)}),n?o?Object(_.n)("MarkAsRead",c):Object(_.n)("MarkAsReadImplicit",c):Object(_.n)("MarkAsUnread",c);var p=Object(M.b)(t).requestOptions,j=function(e,t,n,r){var a=J(e,t,n);return Q()({Header:Object(H.getJsonRequestHeader)(),Body:a},r).then(function(e){return e.Body.ResponseMessages.Items[0]})}(O,n,m,p),R=Object(a.J)(t,n,o);return Object(G.d)(j,u,m,t,R)}),z=n(106),W=Object(c.action)("autoMarkConversationAsRead")(Object(c.select)({items:function(){return i.a.items}})(function(e,t,n){var r=Object(a.w)([e],t),o=Object(z.a)(r[0],t.id);if(o&&"Unread"!==Object(a.D)(t)){var i=o.itemIds;b(i)||(0==Object.keys(u.suppressedItemIdsMap).length?$([e],t,!0,!1,null,[],r):i.forEach(function(e){!b([e])&&n.items.get(e)&&T(t,[e],!0,!1,null,[])}),f())}}));function X(e,t){var n=a.b.getRowIdString(e,t);switch(t.tableQuery.listViewType){case 0:W(n,t);break;case 1:U(n,t)}}var Y=n(46),Z=Object(c.action)("onReadingPaneClosed")(function(e,t){Object(m.a)().UserOptions.GlobalReadingPanePositionReact==Y.a.Off&&!i.a.mailModule.showReadingPane&&i.a.mailModule.showListPane||C.c.error("onReadingPaneClosed should only be called when reading pane is closed in single line view."),"OnSelectionChange"==Object(m.a)().UserOptions.PreviewMarkAsRead&&X(e,t)}),ee=Object(c.action)("onSingleSelectionChanged")(function(e,t,n){var r=Object(m.a)().UserOptions;r.GlobalReadingPanePositionReact!=Y.a.Off&&"OnSelectionChange"==r.PreviewMarkAsRead&&n&&X(e,t)}),te=Object(s.action)("MARK_ITEMS_READ_BASED_ON_NODE_IDS",function(e,t,n,r,a){return{nodeIds:e,tableViewId:t,isReadValueToSet:n,isExplicit:r,actionSource:a}}),ne=Object(c.action)("markItemAsReadFromReadingPane")(function(e,t,n,r,o){var c=[],s=null;if(t){if(1==t.tableQuery.listViewType)c=Object(a.w)([e],t);else{var u=i.a.items.get(e).ConversationId.Id;c=Object(a.w)([u],t)}s=Object(a.i)(t)}T(t,[e],n,!0,o,r).then(function(){t&&Object(G.b)(c,s)}).catch(function(e){t&&(Object(G.b)(c,s),Object(G.c)(t))})}),re=n(358),ae=Object(c.action)("markConversationsAsReadFromTable")(function(e,t,n,r){var o=Object(a.u)(e,t.id),i=Object(re.a)(e,t);return $(o,t,n,!0,r,i,e)}),oe=Object(c.action)("markItemsReadFromTable")(function(e,t,n,r,o){var i=Object(a.u)(e,t.id),c=Object(re.a)(e,t),s=T(t,i,n,r,o,c),u=Object(a.i)(t),d=Object(a.J)(t,n,r);s.then(function(t){Object(G.b)(e,u,d)}).catch(function(n){Object(G.b)(e,u,d),Object(G.c)(t)})}),ie=n(721),ce=Object(c.action)("toggleRowReadState")(function(e,t,n){var r=a.H.tableViews.get(t),o=a.b.getUnreadCount(e,r)>0;switch(r.tableQuery.listViewType){case 0:ae([e],r,o,n);break;case 1:oe([e],r,o,!0,n)}Object(ie.b)()}),se=Object(c.action)("onNavigateAwayViaUpDown")(function(e,t){"OnSelectionChange"==Object(m.a)().UserOptions.PreviewMarkAsRead&&X(e,t)}),ue=n(68),de=n(127),le=n(20),fe=n(4998),be=n.n(fe),ve=n(4999),me=n.n(ve);var Oe=n(3562),pe=n(75),je=n(10),Re=n(219),Ie=n(419),ye=n(8),he=n.n(ye),ke=n(15),ge=n.n(ke),Ae=n(12),we=Object(c.action)("markAsReadInTable")(function(e,t,n,o,i,c){var s=this;if(i.length&&n)throw new Error("If in virtual select all mode, rowKeysToActOn should be empty.");if(t.length&&!n)throw new Error("If not in virtual select all mode, exclusionList should be empty.");var u=je.n.folderTable.get(c.tableQuery.folderId),d=n&&u&&u.UnreadCount>=Oe.b||Object(a.o)(c)&&i.length>=Oe.b,l=u?u.DisplayName:he.a.searchFolderName,f=o?he.a.markAsRead:he.a.markAsUnread,b=o?Object(le.format)(he.a.markAsReadFolderConfirmSubtext,l):Object(le.format)(he.a.markAsUnreadFolderConfirmSubtext,l);Object(de.b)(f,b,!d,{delayCallbackAfterAnimation:!0,okText:ge.a.okButton}).then(function(u){return r.__awaiter(s,void 0,void 0,function(){var s,d;return r.__generator(this,function(r){if(u===de.a.ok)if(Re.b(),n)s=Object(m.a)(),d="DoNotAutomaticallySend"==s.UserOptions.ReadReceipt||"NeverSend"==s.UserOptions.ReadReceipt||Object(Ie.a)(c.tableQuery.folderId),function(e,t,n){var r="TnS_MarkAllAs";r+=t?"Read":"Unread",Object(Ae.k)(r,[e,Object(a.k)(n)])}(e,o,c),w.a.import().then(function(t){t(c.tableQuery,!0,o,e)}),Object(pe.raiseAction)(ue.e.MarkAllAsReadStoreUpdate)(c,o,t),function(e,t,n,r,a){var o=null!=n?n.map(function(e){return R()({Id:e})}):void 0;me()({Header:Object(g.getJsonRequestHeader)(),Body:be()({ReadFlag:t,SuppressReadReceipts:r,FromFilter:null,FolderIds:[e],ItemIdsToExclude:o})},a).then(function(e){return e.Body.ResponseMessages.Items[0]})}(Object(a.h)(c),o,t,d,Object(M.b)(c).requestOptions);else switch(c.tableQuery.listViewType){case 0:ae(i,c,o,e);break;case 1:oe(i,c,o,!0,e)}return[2]})})})});var _e=n(149),Se=Object(c.action)("setAutoMarkAsReadTimer")(Object(c.select)({markAsReadDelaytime:function(){return Object(m.a)().UserOptions.MarkAsReadDelaytime},store:function(){return u},userOptions:function(){return Object(m.a)().UserOptions}})(function(e,t){var n=t.markAsReadDelaytime,r=t.store,o=t.userOptions,i=Object(_e.a)();i&&"Unread"!==Object(a.D)(i)&&"Delayed"==o.PreviewMarkAsRead&&(r.markAsReadTimerTask=setTimeout(function(){Ce(e,i)},1e3*n))})),Me=Object(c.action)("clearAutoMarkAsReadTimer")(Object(c.select)({store:function(){return u}})(function(e){e.store.markAsReadTimerTask&&(clearTimeout(e.store.markAsReadTimerTask),e.store.markAsReadTimerTask=null)})),Ce=Object(c.action)("setMarkAsReadTimer:timeout")(function(e,t){switch(Me(),t.tableQuery.listViewType){case 0:W(e,t);break;case 1:U(e,t)}}),Pe=n(3058),Te=(Object(s.orchestrator)(te,function(e){var t=Object(Pe.a)(e.nodeIds),n=a.H.tableViews.get(e.tableViewId);T(n,t,e.isReadValueToSet,e.isExplicit,e.actionSource,null)}),n(82)),Ue=n(26),De=n(2092);Object(s.orchestrator)(Te.q,function(e){var t=Object(De.b)(e.nodeIdToSelect);if(t){var n=Object(Ue.b)().tableViews.get(e.tableViewId);U(t.ItemId.Id,n)}}),n.d(t,"onItemPartDeselected",function(){return D}),n.d(t,"onReadingPaneClosed",function(){return Z}),n.d(t,"onSingleSelectionChanged",function(){return ee}),n.d(t,"markItemsAsReadBasedOnNodeIds",function(){return te}),n.d(t,"markItemAsReadFromReadingPane",function(){return ne}),n.d(t,"toggleRowReadState",function(){return ce}),n.d(t,"onNavigateAwayViaUpDown",function(){return se}),n.d(t,"markAsReadInTable",function(){return we}),n.d(t,"clearAutoMarkAsReadTimer",function(){return Me}),n.d(t,"setAutoMarkAsReadTimer",function(){return Se})},2092:function(e,t,n){"use strict";n.d(t,"a",function(){return u}),n.d(t,"c",function(){return d}),n.d(t,"b",function(){return l});var r=n(0),a=n(22),o=n(923),i=n(59),c=n(7),s=n(243);function u(e){var t,n,c=e&&e.itemIds?e.itemIds.length:0;if(0==c)return[null,!1,!1];var u=null,d=2==Object(i.c)().type||!Object(i.b)();if(1==c){if(!(u=a.a.items.get(e.itemIds[0])))return[null,!1,!1];d=d||u.ParentFolderId&&u.ParentFolderId.Id==Object(i.b)()}else{var l=null;try{for(var f=r.__values(e.itemIds),b=f.next();!b.done;b=f.next()){var v=b.value,m=a.a.items.get(v);if(!m)return[null,!1,!1];if(m.ParentFolderId&&m.ParentFolderId.Id==Object(i.b)()){u=m,d=!0;break}Object(s.a)(m.ParentFolderId.Id,"sentitems")&&(l=m)}}catch(e){t={error:e}}finally{try{b&&!b.done&&(n=f.return)&&n.call(f)}finally{if(t)throw t.error}}u||(u=l||a.a.items.get(e.itemIds[0]))}return[u,d,Object(o.a)(u.ParentFolderId.Id)]}function d(e,t,n){var r=Object(c.a)().UserOptions.HideDeletedItems;return e&&!((e.IsDraft||r)&&t&&!n)}function l(e){var t=a.a.conversationNodes.get(e),n=r.__read(u(t),3),o=n[0],i=n[1];return d(o,n[2],i)?o:null}},2231:function(e,t,n){"use strict";var r=n(112);function a(e,t,n){n&&r.a.removeRowsFromTombstone(e,t)}var o=n(505);function i(e){e&&Object(o.a)(e)}var c=n(0),s=n(13);function u(e){var t,n;if(!e)return Promise.reject(d("500","Server returned a null response!"));var r=Array.isArray(e)?e:[e];try{for(var a=c.__values(r),o=a.next();!o.done;o=a.next()){var i=o.value;if(i&&!Object(s.f)(i))return Promise.reject(d(i.ResponseCode,i.StackTrace))}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return Promise.resolve()}function d(e,t){var n=new Error("ResponseCode="+e+", Stacktrace="+t);return n.fetchErrorType="ServerFailure",n}function l(e,t,n,r,o){return e.then(function(e){return a(t,n,o),u(e)}).catch(function(e){return a(t,n,o),i(r),Promise.reject(e)})}function f(e,t,n,r,o){return e.then(function(e){if(a(t,n,o),e.ResponseMessages){var s=function(e,t){var n,r;try{for(var a=c.__values(e),o=a.next();!o.done;o=a.next()){var s=o.value;if(s&&"Success"!=s.ResponseClass){i(t);var u=new Error("ResponseCode="+s.ResponseCode+", Stacktrace="+s.StackTrace);return u.fetchErrorType="ServerFailure",u}}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return null}(e.ResponseMessages.Items,r);return s?Promise.reject(s):Promise.resolve()}return Promise.reject(new Error("processUpdateItemActionResponseMessage empty response"))}).catch(function(e){return a(t,n,o),i(r),Promise.reject(e)})}n.d(t,"d",function(){return l}),n.d(t,"e",function(){return f}),n.d(t,"a",function(){return u}),n.d(t,"b",function(){return a}),n.d(t,"c",function(){return i})},2632:function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r=n(65),a=n.n(r),o=n(170),i=n.n(o);function c(e){return e?i()({BaseFolderId:a()({Id:e})}):null}},2903:function(e,t,n){"use strict";n.d(t,"a",function(){return o}),n.d(t,"b",function(){return i}),n.d(t,"c",function(){return c});var r=n(2),a=new r.c(function(){return Promise.all([n.e(2),n.e(3),n.e(8),n.e(135)]).then(n.bind(null,4293))}),o=new r.b(a,function(e){return e.addMarkAsReadDiagnostics}),i=new r.b(a,function(e){return e.addUnreadCountNotificationDiagnostics}),c=new r.b(a,function(e){return e.addUnreadCountSubscriptionDiagnostics})},2911:function(e,t,n){"use strict";function r(e){return e?new Date(e).toISOString():null}n.d(t,"a",function(){return r})},3058:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(0),a=n(2092);function o(e){var t,n,o=[];try{for(var i=r.__values(e),c=i.next();!c.done;c=i.next()){var s=c.value,u=Object(a.b)(s);u&&o.push(u.ItemId.Id)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return o}},3562:function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return a});var r=1e4,a=25},363:function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(552),a=n.n(r),o=n(33),i=n.n(o),c=n(742),s=n.n(c);function u(e,t){var n;return s()({Path:i()({FieldURI:e}),Item:a()((n={},n[e]=t,n))})}},4998:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"MarkAllItemsAsReadRequest:#Exchange"},e)}},4999:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(51),a=n(5e3);t.default=function(e,t){return void 0===e||e.__type||(e=a.default(e)),r.makeServiceRequest("MarkAllItemsAsRead",e,t)}},5000:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"MarkAllItemsAsReadJsonRequest:#Exchange"},e)}}},0,[2,3,8,9,66,7,23,62,279,51,280,57,283,80,100]]);
//# sourceMappingURL=owa.MarkRead.mail.js.map
window.scriptsLoaded['owa.MarkRead.mail.js'] = 1; window.scriptProcessEnd = window.scriptProcessEnd || {}; window.scriptProcessEnd['owa.MarkRead.mail.js'] = (new Date()).getTime();