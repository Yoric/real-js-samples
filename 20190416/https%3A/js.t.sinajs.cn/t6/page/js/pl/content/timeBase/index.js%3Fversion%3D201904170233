STK.namespace("v6page",function(a,b){var STK=arguments[0],$=arguments[1];
STK.register("lib.kit.extra.listener",function(a){var b={},c={};c.define=function(c,d){if(b[c]!=null)throw"lib.kit.extra.listener.define: 频道已被占用";b[c]=d;var e={};e.register=function(d,e){if(b[c]==null)throw"lib.kit.extra.listener.define: 频道未定义";a.listener.register(c,d,e)};e.fire=function(d,e){if(b[c]==null)throw"commonlistener.define: 频道未定义";a.listener.fire(c,d,e)};e.remove=function(b,d){a.listener.remove(c,b,d)};e.cache=function(b){return a.listener.cache(c,b)};return e};return c});
STK.register("conf.channel.timeBase",function(a){return a.lib.kit.extra.listener.define("conf.channel.timeBase",["setTimeBase"])});
STK.register("lib.kit.extra.language",function(a){window.$LANG||(window.$LANG={});return function(b){var c=[].splice.call(arguments,1,arguments.length),d=[b,$LANG].concat(c),e=a.core.util.language.apply(this,d);return e}});
STK.register("lib.kit.dom.firstChild",function(a){var b=a.core.dom.next;return function(a){var c=a.firstChild;c&&c.nodeType!=1&&(c=b(c));return c}});
STK.register("pl.content.timeBase.source.init",function(a){function c(){var b=a.queryToJson(FM.getURL().query||"");if(b.is_searchadv==1)return!1;if(b.rank)return!1;if(b.is_tag==1)return!1;if(b.is_hot==1)return!1;if(b.timefeed==1)return!1;if(b.is_ori==1)return!1;if(b.is_pic==1)return!1;if(b.is_video==1)return!1;if(b.is_music==1)return!1;if(b.is_article==1)return!1;if(b.type=="topic")return!1;if(b.is_all==1)return!0;return!1}var b=a.lib.kit.extra.language;return function(d){function s(c){var e=a.sizzle("[action-type=select]",d),f;if(c==="previous"){while(f=e.pop())if(a.core.dom.hasClassName(f,"current"))break;(f=e.pop())?j.fireDom(f,"click",null):a.ui.alert(b("#L{已经没有更近的微博了}"),{icon:"warnB"})}else if(c==="next"){while(f=e.shift())if(a.core.dom.hasClassName(f,"current"))break;(f=e.shift())?j.fireDom(f,"click",null):a.ui.alert(b("#L{已经没有更早的微博了}"),{icon:"warnB"})}else while(f=e.shift())if(c=a.queryToJson(f.getAttribute("action-data")||"").date){j.fireDom(f,"click",null);break}}function r(b){var c=a.sizzle("[module-type=feed]")[0];if(c){k=a.core.dom.dir(c,{expr:"[id]"})[0];b()}else setTimeout(function(){r(b)},1e3)}function q(){if(!!k){var b=a.scrollPos().top,c=a.position(k).t-50,d=f.offsetHeight+120,e=k.offsetHeight;if(b<c-50){f.style.position="absolute";f.style.top=c+"px"}else if(b+d+50>c+e){f.style.position="absolute";e>d?f.style.top=c+e-d+"px":f.style.top=c+"px"}else if(!a.core.util.browser.IE6){f.style.position="fixed";f.style.top="50px"}else{f.style.position="absolute";f.style.top=b+50+"px"}}}function p(){var b={stat_date:undefined,firstfeed:undefined},e=a.queryToJson(FM.getURL().query||""),f=e.stat_date,j;a.foreach(g,function(b){var c=a.lib.kit.dom.firstChild(b);a.addClassName(b,"none");a.removeClassName(b,"block");a.removeClassName(c,"current")});a.foreach(i,function(c){var d=a.core.json.merge(b,a.queryToJson(c.getAttribute("action-data")||"")),f=!0;for(var g in d)d.hasOwnProperty(g)&&d[g]!=e[g]&&(f=!1);if(f){a.addClassName(c,"current");var h=a.core.dom.dir(c,{expr:"[node-type=year]"})[0];if(h){var i=a.lib.kit.dom.firstChild(h);if(h){a.removeClassName(h,"none");a.addClassName(h,"block");a.addClassName(i,"current")}}}else a.removeClassName(c,"current")});f?a.removeClassName(h,"current"):a.addClassName(h,"current");d.style.visibility=c()?"":"hidden"}function o(b){var c=a.sizzle("[action-type=select]",b.el.parentNode)[0];c&&j.fireDom(c,"click",null)}function n(b){var c={pids:k.id,is_all:1};delete c.page;delete c.stat_date;delete c.firstfeed;var d="?"+a.jsonToQuery(c);$CONFIG.bigpipe==="true"?FM.setState(d+"#feedtop"):setTimeout(function(){location.href=d})}function m(b){var c=a.core.json.merge(b.data,{pids:k.id}),d=FM.getURL().path+"?"+a.jsonToQuery(c);$CONFIG.bigpipe==="true"?FM.setState(d+"#feedtop"):setTimeout(function(){location.href=d})}var e=a.builder(d).list,f=e.box[0],g=e.year,h=a.sizzle("[action-type=select_now]")[0],i=a.sizzle("[action-type=select]"),j=a.delegatedEvent(d),k,l={};j.add("select","click",m);j.add("select_year","click",o);j.add("select_now","click",n);FM.onstateChange(p);FM.onplJsReady(q);a.addEvent(window,"scroll",q);a.conf.channel.timeBase.register("setTimeBase",s);p();r(function(){q();f.style.display=""});l.destroy=function(){f.style.display="none";j.destroy();a.removeEvent(window,"scroll",q);a.conf.channel.timeBase.remove("setTimeBase",s);FM.unstateChange(p);FM.unplJsReady(q)};return l}});
FM.register("pl.content.timeBase.index",function(b,c){return a.pl.content.timeBase.source.init(a.E(b),{})})});
