!function(e){function t(t){for(var r,s,a=t[0],c=t[1],u=t[2],p=0,d=[];p<a.length;p++)s=a[p],i[s]&&d.push(i[s][0]),i[s]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(l&&l(t);d.length;)d.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,a=1;a<n.length;a++){var c=n[a];0!==i[c]&&(r=!1)}r&&(o.splice(t--,1),e=s(s.s=n[0]))}return e}var r={},i={7:0},o=[];function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var a=window.swcJsonp=window.swcJsonp||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var u=0;u<a.length;u++)t(a[u]);var l=c;o.push([456,0]),n()}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(42),i=window;t.swcWindow=i,i.swc=i.swc||i.SkypeWebControl||{},i.swc.shared=i.swc.shared||{},i.swc.scriptLoader=i.swc.scriptLoader||r.ScriptLoader,i.SKYPE=i.SKYPE||{},i.SkypeWebControl=i.swc,i.swc.vendors=i.swc.vendors||{};var o=i.swc;t.swc=o,t.SKYPE=i.SKYPE||{}},,function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=n(50),s=n(22),a=function(){function e(){}return Object.defineProperty(e,"ECS",{get:function(){return r({},{frameless:""},i.swc.EcsConfig)},set:function(e){i.swc.EcsConfig=e},enumerable:!0,configurable:!0}),e.getPlatformId=function(){return o.PlatformUtils.getPlatformId()},e.getPlatformName=function(){return o.PlatformUtils.getPlatformName()},e.getClientVersion=function(){if(e.CLIENT_VERSION!==e.DEFAULT_CLIENT_VERSION)return e.CLIENT_VERSION;for(var t=e.ECS.version.split("."),n=t.length,r=0;r<4-n;r++)t.splice(t.length-1,0,"0");return e.CLIENT_VERSION=e.getPlatformId()+"/"+t.join("."),e.CLIENT_VERSION},e.getVersion=function(){if(e.VERSION!==e.DEFAULT_VERSION)return e.VERSION;for(var t=e.ECS.version.split("."),n=t.length,r=0;r<4-n;r++)t.splice(t.length-1,0,"0");return e.VERSION=t.join("."),e.VERSION},e.getChatClientInfo=function(){if(this.CHAT_CLIENT_INFO)return this.CHAT_CLIENT_INFO;var t=i.swc.EcsHeaderConfig&&i.swc.EcsHeaderConfig.CountryCode?i.swc.EcsHeaderConfig.CountryCode:"NR";return this.CHAT_CLIENT_INFO="os=Windows; osVer=10; proc=Win32; lcid=en-us; deviceType=1; country="+t+"; clientName=swc; clientVer="+e.getUiVersion(),this.CHAT_CLIENT_INFO},e.getUiVersion=function(){return this.UI_VERSION?this.UI_VERSION:(this.UI_VERSION=e.getClientVersion()+"//swc",this.UI_VERSION)},e.getClientInfo=function(){if(this.SYSTEM_INFO)return this.SYSTEM_INFO;var t=s.UNKNOWN_VERSION;try{t=window.navigator.platform}catch(e){}return this.SYSTEM_INFO=e.getUiVersion()+"os="+s.default.getOsName()+"; osVer="+s.default.getOsVersion()+"; proc="+t+"; deviceType="+s.default.getDeviceType()+"; browser="+s.default.getBrowserName()+"; browserVer="+s.default.getBrowserVersion(),this.SYSTEM_INFO},e.APPNAME="SWC",e.LOCALE="en-us",e.PES_LOCALE="en",e.ORIGIN="SkypeLWC",e.ORIGIN_CALLING="SkypeCalling",e.MSG_MAX_LENGTH=2e3,e.PLATFORM_ID=912,e.BUTTON_MARKER_CLASS=".skype-button",e.CHAT_MARKER_CLASS=".skype-chat",e.RECENTS_MARKER_CLASS=".skype-recents",e.CHAT_FRAME_MARKER_CLASS=".lwc-chat-frame",e.CALL_FRAME_MARKER_CLASS=".swc-call-frame",e.LOGIN_CLIENT_ID="919866",e.LOGIN_PAGE_URL="https://login.skype.com/login",e.LOGIN_THEME="skype-white",e.LOGOUT_PAGE_URL="https://login.skype.com/logout",e.LOGIN_POPUP_URL="https://demoplayground.skype.com/joinlwc?t=",e.LOGIN_POPUP_FEATURES="width=600, height=620, menubar=no, status=no, titlebar=no, toolbar=no",e.LOGOUT_POPUP_FEATURES="width=1, height=1, menubar=no, status=no, titlebar=no, toolbar=no",e.TEAMS_URL="https://api.teams.skype.com/",e.TEAMS_AUTH_URL="https://authsvc.teams.microsoft.com/v1.0",e.TEAMS_PROFILE_URL="https://teams.microsoft.com/",e.TEAMS_MIDDLE_TIER_URL="https://teams.microsoft.com/api/mt/amer",e.TEAMS_CSA_URL="https://chatsvcagg.teams.microsoft.com",e.SHAREPOINT_URL="https://microsoft-my.sharepoint.com/",e.AMS_HOST_URL="https://api.asm.skype.com/v1/",e.APS_HOST_URL="https://api.aps.skype.com/v1/",e.CDN_SERVICE_HOST="secure.skypeassets.com",e.OA_URL="https://pro.skype.com/v1/onboarding",e.OA_URL_INT="https://havana-latest.skype.com/v1/onboarding",e.URLP_SERVICE_URL="https://urlp.asm.skype.com",e.ECS_GRAPH_URL="https://skypegraph.skype.com/",e.MS_GRAPH_URL="https://graph.microsoft.com/v1.0/me/",e.MS_APP_CLIENT_ID="b8d5facb-2aee-4653-98cb-4acc8f0d0e97",e.MS_APP_REDIRECT_URL_DEMO="https://latest-swc.cdn.skype.com/demo/connect.html",e.MS_APP_REDIRECT_URL_OUTLOOK="https://latest-swc.cdn.skype.com/demo/msauth.html",e.MS_AUTHORIZE_URL="https://login.microsoftonline.com/common/oauth2/v2.0/authorize",e.ECS_GRAPH_ETAG=null,e.ECS_GRAPH_SERVICE_SETTINGS=null,e.INVITE_HOST_URL_INT="https://latest-join.skype.com/api/v1/",e.INVITE_HOST_URL="https://join.skype.com/api/v1/",e.CHAT_CLIENT_INFO="",e.CHAT_GUEST_HOST_URL="https://client-s.gateway.messenger.live.com/v1/",e.CHAT_HOST_URL="https://client-s.gateway.messenger.live.com/v1/",e.CHAT_JOIN_URL="https://latest-join.skype.com/api/v2/conversation",e.SKYPE_CALLER_ID="lwc",e.CONTACTS_HOST_URL="https://edge.skype.com/pcs-df/contacts/v2/",e.CONTACTS_SCD_HOST_URL="https://scd.skype.com/contacts/v3/",e.AGENTS_HOST_URL="https://join.skype.com/",e.AVATAR_SERVICE_URL="https://avatar.skype.com/v1/",e.STRATUS_DOMAIN_HOST_URL="https://profile.skype.com/profile/v1/",e.WX_HOST_URL="https://wx.skype.com/api/v1/scom/",e.USER_OPTIONS_SERVICE={OLD:"https://options.skype.com/",PROD:"https://edge.skype.com/",INT:"https://optionsservice-test-northeurope.cloudapp.net:443/"},e.ECS_CLIENT_NAME="skype",e.ECS_TEAM_NAME="lwc",e.ECS_CLIENT_VERSION="1.00",e.GET_HELP_URL="https://support.skype.com/en/faq/FA34704/what-is-skype-web-control",e.THIRD_PARTY_NOTICES_PATH="/third-party_attributions.html",e.PRIVACY_AND_COOKIES_URL="https://go.microsoft.com/fwlink/?LinkId=521839",e.TERMS_OF_USE_URL="https://go.microsoft.com/fwlink/?LinkID=246338",e.CONCIERGE_BOT_MRI="28:concierge",e.CONCIERGE_BOT_DF_MRI="28:concierge_df",e.BRB_BOT_MRI="28:a62068e3-63e9-4ffc-89a6-14d841e224d2",e.BRB_BOT_MRI_TEAMS="28:5932bde2-77dd-4eb7-a704-d1da88e37485",e.BRB_START_MESSAGE="Sending feedback details...",e.NEW_CHAT_COMPOSER_ID="newChatComposerId",e.DEFAULT_VERSION="0.0.0.0",e.DEFAULT_CLIENT_VERSION=e.getPlatformId()+"/"+e.DEFAULT_VERSION,e.CLIENT_VERSION=e.DEFAULT_CLIENT_VERSION,e.VERSION=e.DEFAULT_VERSION,e.DEFAULT_AVATAR_URI="https://swc.cdn.skype.com/assets/img/defaultAvatar.png",e.MSG_DELETED_CLASSIC_SKYPE="Edited previous message: ",e.UI_VERSION="",e.SYSTEM_INFO="",e.MESSAGE_PROPERTIES={GLOBAL:{ACTIVITY_DATA:"activityData",PINNED:"pinned",PROTOTYPE_SKYPEX:"prototype_skypex"},PER_USER:{EMOTIONS:"emotions",POLL:"poll",TRANSLATIONS:"translations",ACTIVITY_DATA:"activityData",SMS_REPORT:"smsdeliveryreports"}},e.CHAT_SERVICE_COMMANDS={SET_MESSAGE_PROPERTY:"setMessageProperty",REMOVE_MESSAGE_PROPERTY:"removeMessageProperty",REMOVE_ALL_MESSAGES:"removeAllMessage",SET_IS_FAVORITE:"setIsFavorite",SMS_PRICE:"getSmsPrice"},e}();t.Configuration=a},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.compatEvent="compatEvent",e.CreateControl="createControl",e.IncomingCall="incomingCall",e.CallingReady="callingReady",e.RecentsReady="recentsReady",e.InChatCallingReady="inChatCallingReady",e.BotAddedToThread="botAddedToThread",e.RecentDataLoaded="recentDataLoaded",e.StartChat="startChat",e.StartReportProblemChat="startReportProblemChat",e.StartCall="startCall",e.AcceptCall="acceptCall",e.RejectCall="rejectCall",e.UpdateCallingScreen="updateCallingScreen",e.ForceExpandChat="forceExpandChat",e.ToggleExpressionPicker="toggleExpressionPicker",e.HideExpressionPicker="hideExpressionPicker",e.PesConfigInitialized="pesConfigInitialized",e.Ready="ready",e.ChatOpen="chat-open",e.Click="click",e.Fullscreenchange="fullscreenchange",e.UpdateUnreadMessageCounter="updateUnreadMessageCounter",e.InappActivityStarted="inappActivityStarted",e.ClientOpened="clientOpened",e.ClientFocused="clientFocused",e.ChatServiceUnavailable="chatServiceUnavailable",e.RemoveAllMessagesFromUi="removeAllMessagesFromUi",e.RequestEditingMessage="requestEditingMessage",e.OnVisibilityChange="onVisibilityChange",e.OnMessageSent="onMessageSent",e.OnMessageReceived="onMessageReceived",e.onFocused="onFocused",e.OnConversationReady="onConversationReady",e.onControlShow="onControlShow",e.onControlHide="onControlHide",e.onControlClose="onControlClose",e.OnCallStart="onCallStart",e.OnCallConnect="onCallConnect",e.OnCallEnd="onCallEnd",e.CallingLayoutChanged="callingLayoutChanged",e.CallStatusChanged="callStatusChanged",e.DevicesPermissions="devicesPermissions",e.DominantSpeakerChanged="dominantSpeakerChanged",e.EndpointRegistered="endpointRegistered",e.RecentConversationsFetched="recentConversationsFetched",e.UnreadConversationsUpdate="unreadConversationsUpdate",e.UnsupportedFileSelected="unsupportedFileSelected",e.ReceivedNotification="receivedNotification",e.HideNotification="hideNotification",e.OpenRecentList="openRecentList",e.recentsShown="recentsShown",e.recentsHidden="recentsHidden",e.RecentItemSelected="onRecentItemSelected",e.recentsUIReady="recentsUIReady",e.recentItemsLoaded="recentItemsLoaded",e.onMessageExpand="onMessageExpand",e.onMessageCollapse="onMessageCollapse",e.OnConversationDelete="onConversationDelete",e.scrollToBottom="scrollToBottom",e.hideBubbleWindow="hideBubbleWindow",e.openChatLocal="openChatLocal",e.errorCode="errorCode",e.contactAdded="contactAdded",e.notificationSettingsChange="notificationSettingsChange",e.invoke={sendMessageToBotResponse:"invoke:sendMessageToBot:response",sendMessageToBot:"invoke:sendMessageToBot",signOut:"invoke:signOut",startCall:"invoke:startCall",stopCall:"invoke:stopCall",setAad:"invoke:setAad",getTokenExpirationTime:"invoke:getTokenExpirationTime",registerMask:"registerMask",unregisterMask:"unregisterMask"},e.cmd={reg:"cmd:register",unreg:"cmd:unregister",exec:"cmd:execute"},e.threadNotificationsProxy={reg:"proxy:threadNotifications:register",unreg:"proxy:threadNotifications:unregister",notify:"proxy:threadNotifications:notify"},e.messagingProxy={disconnect:"proxy:messaging:disconnect",disconnected:"proxy:messaging:disconnected"},e.recentsProxy={options:{request:"proxy:recents:options:request",resolve:"proxy:recents:options:resolve"}},e.conversationProxy={regIsTyping:"proxy:conversation:regIsTyping",resIsTyping:"proxy:conversation:resIsTyping",disableInput:"proxy:conversation:disableInput",expand:"proxy:conversation:expand",connected:"proxy:conversation:connected",focusInput:"proxy:conversation:focusInput",openFilePicker:"proxy:conversation:filepicker",setInputPlaceholder:"proxy:conversation:placeholder",setMessageProperties:"proxy:conversation:setMessageProperties",setInputText:"proxy:conversation:inputtext",toggleEmoticonPicker:"proxy:conversation:emoticonpicker",showConfirmationDialog:"proxy:conversation:showConfirmationDialog",resShowConfirmationDialog:"proxy:conversation:resShowConfirmationDialog",regMessageReceived:"proxy:conversation:regMessageReceived",messageReceived:"proxy:conversation:messageReceived",regUnreadCount:"proxy:conversation:regUnreadCount",unreadCount:"proxy:conversation:unreadCount",setActionBar:"proxy:conversation:setActionBar",resActionBar:"proxy:conversation:resActionBar",regDownload:"proxy:conversation:regDownload",resDownload:"proxy:conversation:resDownload",regAvatar:"proxy:conversation:regAvatar",resAvatar:"proxy:conversation:resAvatar",regTitle:"proxy:conversation:regTitle",resTitle:"proxy:conversation:resTitle",regPresenceStatus:"proxy:conversation:regPresenceStatus",resPresenceStatus:"proxy:conversation:resPresenceStatus",regCollapse:"proxy:conversation:regCollapse",resCollapse:"proxy:conversation:resCollapse",regClose:"proxy:conversation:regClose",resClose:"proxy:conversation:resClose"},e.applicationProxy={setLanguage:"proxy:application:setLanguage"},e.presenceProxy={setStatus:"proxy:presence:setStatus",setStatusResponse:"proxy:presence:setStatus:response",getStatus:"proxy:presence:getStatus",getStatusResponse:"proxy:presence:getStatus:response",getUserStatus:"proxy:presence:getUserStatus",getUserStatusResponse:"proxy:presence:getUserStatus:response",announceUserStatus:"proxy:presence:announceUserStatus",subscribeToUserStatus:"proxy:presence:subscribeToUserStatus",unsubscribeFromUserStatus:"proxy:presence:unsubscribeFromUserStatus",getStatusList:"proxy:presence:getStatusList",getStatusListResponse:"proxy:presence:getStatusList:response"},e.notificationsSettingsProxy={setOption:"proxy:settings:notification:setOption",setOptionResponse:"proxy:settings:notification:setOption:response",readOption:"proxy:settings:notification:readOption",readOptionResponse:"proxy:settings:notification:readOption:response"},e.proxy={resolve:"proxy:resolve",request:"proxy:request"},e.bridge={theme:{request:"bridge:request:theme",return:"bridge:request:return"}},e}();t.ApiEvents=r;var i=function(){function e(){}return e.SELECTED_PARTICIPANTS_CHANGE="selectedParticipants:change",e}();t.ParticipantEvents=i;var o=function(){function e(){}return e.SCROLL_RECOUNT="scroll:recount",e}();t.ScrollEvents=o;var s=function(){function e(){}return e.ITEM_SEND_REQUEST="pes:picker:sendRequest",e.ITEM_CANCEL_REQUEST="pes:picker:cancelRequest",e.OPEN_PICKER="pes:picker:open",e}();t.ExpressionPickerEvents=s;var a=function(){function e(){}return e.SEARCH_START="search:start",e.UPDATE_SEARCH_RESULTS="update:searchResults",e.TOGGLE_RESULTS_COMPONENT="search:toggleResultsComponent",e.SEARCH_CREATE_CONTACTLIST="create:contactlist",e.EMPTY_SEARCH_INPUT="search:emptyInput",e.FOCUS_SEARCH_INPUT="search:FocusInput",e.RESET_PARTICIPANTS_SEARCH_RESULT="search:resetParticipantsResult",e}();t.SearchEvents=a;var c=function(){function e(){}return e.SHOW="campaign:show",e.DISMISS="campaign:dismiss",e}();t.CampaignEvents=c,function(e){e.Ready="services:ready",e.Loaded="services:loaded",e.Init="services:init"}(t.ServicesEvents||(t.ServicesEvents={})),function(e){e.Ready="messaging:ready"}(t.MessagingEvents||(t.MessagingEvents={})),function(e){e.Add="viewport:add",e.Ready="viewport:ready",e.Remove="viewport:remove",e.Update="viewport:update"}(t.ViewportEvents||(t.ViewportEvents={}))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=n(10),a=n(11),c=n(0),u=n(28),l=function(e){function t(){var t=e.call(this)||this;return t.sessionId="",t.backend=a.MessagingBackend.UNDETERMINED,t.style="",t.translatorEnabled=!1,t.frameless=!1,t.callingReady=!1,t.standaloneCalling=!1,t.largeEmoticonClass=!1,t.isParallelView=!1,t.parentProtocol="n/a",t.bridge(),t}return i(t,e),Object.defineProperty(t,"get",{get:function(){return c.swc.shared.app||(c.swc.shared.app=new t),c.swc.shared.app},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentLocale",{get:function(){return u.LocaleInfo.instance.getLocale()},enumerable:!0,configurable:!0}),t.prototype.copy=function(e){e&&Object.getOwnPropertyNames(e).forEach(function(n){var r=Object.getOwnPropertyDescriptor(e,n);r&&r.writable&&(t[n]=r.value||t[n])})},t.prototype.isTeams=function(){return this.backend===a.MessagingBackend.TEAMS},Object.defineProperty(t.prototype,"theme",{get:function(){return this._theme},set:function(e){e!==this._theme&&(this._theme=e,this.publish("theme",e))},enumerable:!0,configurable:!0}),t.prototype.bridge=function(){var e=this;c.swc.Eventing.registerEvent(o.ApiEvents.bridge.theme.return,function(t){return e.theme=t}),c.swc.Eventing.triggerEvent(o.ApiEvents.bridge.theme.request)},t}(s.default);t.default=l},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.getComposedBlockClassName=function(){var e=this.blockClassName;return this.props.className&&(e+=" "+this.props.className),e},t}(n(3).Component);t.SwcBaseComponent=o},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(35)),r(n(51)),r(n(52)),r(n(53)),r(n(54)),r(n(55))},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=function(){function e(){}return e.throwError=function(e,t,n,i){var o=new Error(function(){if(!n||0===Object.getOwnPropertyNames(n).length)return e+(t?": "+t:"");if("string"==typeof n)return n;var r="";return Object.getOwnPropertyNames(n).forEach(function(e){r+=e+": "+n[e]+";"}),r}());r.swc.Eventing.triggerEvent("errorCode",e);try{r.swc.Telemetry.sendEvent.runtimeError(e,o.message,e+(t?": "+t:""),o.stack,i)}catch(e){}},e.throwHttpErrorCode=function(e,t){e+=1e3,r.swc.Eventing.triggerEvent("errorCode",e)},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){var e=this;this.callbacks={},this.subscribe=function(t,n){void 0===e.callbacks[t]&&(e.callbacks[t]=new Array),e.callbacks[t].push(n)},this.unsubscribe=function(t,n){if(void 0!==e.callbacks[t]){var r=e.callbacks[t].indexOf(n);r>-1&&e.callbacks[t].splice(r,1)}},this.publish=function(t,n){void 0!==e.callbacks[t]&&e.callbacks[t].map(function(e){return e}).forEach(function(e){e(n)})}}return e.prototype.dispose=function(){for(var e in this.callbacks)this.callbacks.hasOwnProperty(e)&&(this.callbacks[e]=null);this.callbacks={}},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.UNDETERMINED=10]="UNDETERMINED",e[e.SKYPE=100]="SKYPE",e[e.TEAMS=300]="TEAMS"}(t.MessagingBackend||(t.MessagingBackend={}))},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),i=n(5),o=n(2),s=n(25),a=n(464),c=n(465),u=n(288),l=n(466),p=n(17),d=n(29),f=n(0),h=n(180),g=n(28),m=n(467),v=n(469),y=n(472),_=n(475),b=n(289),S=n(290),T=n(477),w=n(480),P=n(291),C=n(483),E=n(486),O=n(488),k=n(489),M=n(491),I=n(295),A=n(494),R=n(297),N=n(496),U=n(497),x=n(298),D=n(500),L=n(115),j=n(503),F=n(506),H=n(507),B=n(508),G=n(511),z=n(512),V=n(518),W=n(301),q=n(530),K=n(531),J=n(535),Y=n(538),Q=n(541),X=n(542),$=n(545),Z=n(546),ee=n(548),te=n(549),ne=n(550),re=n(552),ie=n(554),oe=n(175),se=n(555),ae=n(557),ce=n(558),ue=n(584),le=n(61),pe=function(){function e(){this.activeEndpoints=[]}return Object.defineProperty(e,"unreadCounterStore",{get:function(){return this._unreadCounterStore||(this._unreadCounterStore=new Q.UnreadCounterStore(e.mePerson.mri)),this._unreadCounterStore},enumerable:!0,configurable:!0}),e.ready=function(){try{return e.initPromise.then(function(){return e})}catch(e){return Promise.reject("Initialize services first")}},Object.defineProperty(e,"initPromise",{get:function(){return e._initPromise.promise},enumerable:!0,configurable:!0}),e.setExternalLogin=function(t){e._externalLogin||(e._externalLogin=t)},Object.defineProperty(e,"presenceService",{get:function(){return x.UnifiedPresenceService},enumerable:!0,configurable:!0}),e.completePostSignInActions=function(t,n){n.userSettings&&n.userSettings.forceDisplayName&&e.mePerson.forceDisplayName(n.userSettings.forceDisplayName),i.default.get.isTeams()?e.presenceService.startPolling():e.contactsManager.fetchMyContacts(),(new U.PresenceProxyOperator).registerServices(),e.notificationSettingsStore.registerProxy(),e.unreadCounterStore.subscribe(function(e){f.swc.Eventing.triggerEvent(r.ApiEvents.UnreadConversationsUpdate,e,null,!0)});var o=function(){return f.swc.Eventing.triggerEvent("swc:recents:loaded")};e.conversations.prefetchRecents().then(function(t){o();var n=[];Object.keys(e.conversations.getAll()).forEach(function(t){var r=e.conversations.get(t);r.isUnread&&n.push(r)}),e.notificationsManager.enableNotifications(),e.notificationsManager.registerUnreadIConversationsSummary(n)}).catch(function(e){o()}).then(function(){return e._polling});var s=t||g.LocaleInfo.instance.getLocale();e.signInManager.isAadSupported()&&e.avatarService,f.swc.Telemetry&&(f.swc.Telemetry.Context.ServiceManager.setUsername(e.signInManager.currentUserName),f.swc.Telemetry.Context.ServiceManager.setGuest(e.signInManager.userIdentityType===d.IdentityType.GUEST),f.swc.Telemetry.Context.ServiceManager.setIdentityType(e.signInManager.userIdentityType),f.swc.Telemetry.Context.ServiceManager.setCommercial(e.signInManager.isAadSupported()),f.swc.Telemetry.Context.ServiceManager.setLanguage(s),f.swc.Telemetry.Context.ServiceManager.setBackend(i.default.get.backend))},e.readyAndSignedIn=function(){var t=e.signInManager;return t.onceSignedIn().then(function(){return t.isAadSupported()?L.TokenType.Aad:L.TokenType.Skype})},Object.defineProperty(e,"teamsMiddleTier",{get:function(){return e._teamsMiddleTierPromise||(e._teamsMiddleTierPromise=e.readyAndSignedIn().then(function(t){return t===L.TokenType.Aad?new O.TeamsMiddleTierClient(o.Configuration.TEAMS_MIDDLE_TIER_URL,e.signInManager.aad):Promise.reject("Not supported for Consumer")})),e._teamsMiddleTierPromise},enumerable:!0,configurable:!0}),Object.defineProperty(e,"teamsChatServiceAggregatorClient",{get:function(){return!e._teamsChatServiceAggregatorClient&&e.signInManager.isAadSupported()&&(e._teamsChatServiceAggregatorClient=new E.ChatServiceAggregatorClient(o.Configuration.ECS.teamsCsaUrl||o.Configuration.TEAMS_CSA_URL,e.signInManager.aad,o.Configuration.ECS.teamsCsaHeaders)),e._teamsChatServiceAggregatorClient},enumerable:!0,configurable:!0}),Object.defineProperty(e,"userService",{get:function(){return e._userService||(e._userService=e.readyAndSignedIn().then(function(){return e.teamsMiddleTier.then(function(e){return new se.UserService(e)})})),e._userService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"i18n",{get:function(){return e._i18n},enumerable:!0,configurable:!0}),Object.defineProperty(e,"signInManager",{get:function(){return e._skypeSignInManager?e._skypeSignInManager:null},enumerable:!0,configurable:!0}),Object.defineProperty(e,"agentsManager",{get:function(){return this._agentsManager||(this._agentsManager=new c.SkypeAgentsManager),this._agentsManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"sessionStorage",{get:function(){return Y.getSessionStorage()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"polling",{get:function(){return e._polling||(i.default.get.isTeams()?(e._polling=C.getTeamsPolling(),e._polling.start(),o.Configuration.ECS.isLongPollTabActivationEnabled&&o.Configuration.ECS.cnsPollingDisabled&&w.enableLongPollTabActivation(C.getTeamsPolling())):e._polling=new P.Polling),e._polling},enumerable:!0,configurable:!0}),Object.defineProperty(e,"localStorage",{get:function(){return Y.getLocalStorage()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"conversations",{get:function(){return e._conversationsManager||(e._conversationsManager=new ce.default),e._conversationsManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"viewports",{get:function(){return e._viewports||(e._viewports=new ae.ViewportManager)},enumerable:!0,configurable:!0}),Object.defineProperty(e,"teamsGraphService",{get:function(){return new Z.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"skypeGraphService",{get:function(){return new J.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"microsoftGraphService",{get:function(){return new B.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"stratusService",{get:function(){return e._stratusService||(e._stratusService=i.default.get.isTeams()?new $.default:new X.default),e._stratusService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"amsManager",{get:function(){if(!e._amsManager)if(i.default.get.isTeams()){var t=!(!e._options||!e._options.fileSharing)&&!!e._options.fileSharing.forceEnterpriseAms;e._amsManager=new l.TeamsAmsManager(new K.SharepointService,new m.AmsService,t)}else e._amsManager=new u.SkypeAmsManager(new m.AmsService);return e._amsManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"webApi",{get:function(){return this._webApi},enumerable:!0,configurable:!0}),Object.defineProperty(e,"pesManager",{get:function(){return e._pesManager||(i.default.get.isTeams()?e._pesManager=new q.default:e._pesManager=new W.default),e._pesManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"mePersonManager",{get:function(){return e._mePersonManager||(e._mePersonManager=new a.default),e._mePersonManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"contactsManager",{get:function(){return e._contactsManager||(e._contactsManager=new A.SkypeContactsManager),e._contactsManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"searchManager",{get:function(){return e._searchManager||(i.default.get.isTeams()?e._searchManager=new N.TeamsSearchManager:e._searchManager=new R.default),e._searchManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"persons",{get:function(){return e._persons||(e._persons=new ue.default),e._persons},enumerable:!0,configurable:!0}),Object.defineProperty(e,"botsService",{get:function(){return new j.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"agentsService",{get:function(){return e._agentsService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"contactsService",{get:function(){return e._contactsService||(e._contactsService=i.default.get.isTeams()?new M.default:new I.default),e._contactsService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"userOptionsService",{get:function(){return e._userOptionsService||(e._userOptionsService=i.default.get.isTeams()?new ie.TeamsUserOptionsService:new re.SkypeUserOptionsService),e._userOptionsService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"notificationSettingsStore",{get:function(){return e._notificationSettingsStore||(e._notificationSettingsStore=new G.default),e._notificationSettingsStore},enumerable:!0,configurable:!0}),Object.defineProperty(e,"trouterService",{get:function(){return e._trouterService||(e._trouterService=new ne.Trouter),e._trouterService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"capabilitiesService",{get:function(){if(!e._capabilitiesService){var t=e.signInManager.aad;if(e.signInManager.isAadSupported()){var n=new oe.TeamsUserPolicyService(t,new h.LocalCacheStorage(e.signInManager.currentUserName));e._capabilitiesService=new _.TeamsCapabilitiesService(n)}else e._capabilitiesService=new b.SkypeCapabilitiesService}return e._capabilitiesService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"outlookContactsService",{get:function(){return e._outlookContactsService||(e._outlookContactsService=new k.default),e._outlookContactsService},enumerable:!0,configurable:!0}),Object.defineProperty(e,"translatorService",{get:function(){return te.default},enumerable:!0,configurable:!0}),Object.defineProperty(e,"oa",{get:function(){return V},enumerable:!0,configurable:!0}),Object.defineProperty(e,"wx",{get:function(){return e._wx},enumerable:!0,configurable:!0}),Object.defineProperty(e,"mePerson",{get:function(){return e._mePerson},enumerable:!0,configurable:!0}),Object.defineProperty(e,"notificationsManager",{get:function(){return e._notificationsManager||(e._notificationsManager=new z.default),e._notificationsManager},enumerable:!0,configurable:!0}),Object.defineProperty(e,"avatarService",{get:function(){return e._avatarService||(e._avatarService=new y.default),e._avatarService},enumerable:!0,configurable:!0}),e.setEverOpenedChats=function(t){e._everOpenedChats=t},e.signinStateHandler=function(){switch(this.signInManager.state){case s.SigninState.SignedOut:this.webApi.reset(),this.persons.dispose(),this._mePerson=null;break;case s.SigninState.SignedIn:this._mePerson||(this._mePerson=new H.default("8:"+this.signInManager.currentUserName))}},e.recentVisibilityHandler=function(t){if(e._isRecentsVisible=t,t){var n=Date.now().toString();e.localStorage.setItem("swc-recentslastseen",n),this._webApi.startEndpointActivation()}else e.isActive()||this._webApi.stopEndpointActivation()},e.chatShownHandler=function(t,n){if(n&&n.currentConversationId){if(t)return e._isChatShown=!0,void this.webApi.startEndpointActivation();e._isChatShown=!1;for(var r=Object.getOwnPropertyNames(e._everOpenedChats),i=0;i<r.length;i++){if(e._everOpenedChats[r[i]].onStage){e._isChatShown=!0;break}}e._isChatShown?this.webApi.startEndpointActivation():e.isActive()||this.webApi.stopEndpointActivation()}},e.focusHandler=function(t){e._isFocused=t,e._isFocused?this.webApi.startEndpointActivation():e.isActive()||this.webApi.stopEndpointActivation()},e.callingStateHandler=function(t){var n=!1;if(t)switch(t.status){case 2:case 3:case 4:case 9:n=!0}e._isInCall=n,n?this.webApi.startEndpointActivation():e.isActive()||this.webApi.stopEndpointActivation()},e.updateListOfActiveEndpoints=function(e){},e.isActive=function(){return(e._isInCall||e._isFocused)&&(e._isRecentsVisible||e._isChatShown)},e._isInitialized=!1,e._everOpenedChats={},e._wx=new F.WX,e._agentsService=new v.default,e._pesInitialized=!1,e.isZombie=!0,e.initManagers=function(t,n,o){if(e._initPromise=e._initPromise||new p.CancelablePromise,e._isInitialized)return e.initPromise;e._isInitialized=!0;var s=[Promise.resolve()];return e._i18n||(e._i18n=new D.I18N),s.push(e._i18n.init(t||g.LocaleInfo.instance.getLocale())),e._options=o,e._skypeSignInManager||(e._skypeSignInManager=new le.default(n.tokenProvider,n.initialToken,n.externalLogin||e._externalLogin,n.tokenType,n.enterpriseAuth),e.signInManager.subscribe("state",e.signinStateHandler.bind(e))),e._webApi||(i.default.get.isTeams()?e._webApi=new T.ConversationTeamsWebApi(e.teamsChatServiceAggregatorClient):e._webApi=new S.ConversationConsumerWebApi),e.notificationsManager.disableNotifications(),e.signInManager.onceSignedIn().then(function(){e.completePostSignInActions(t,o)}),f.swc.Eventing.registerEvent(r.ApiEvents.InappActivityStarted,ee.reportInappActivityStartEvent),f.swc.Eventing.registerEvent(r.ApiEvents.recentsShown,function(){return e.recentVisibilityHandler(!0)}),f.swc.Eventing.registerEvent(r.ApiEvents.recentsHidden,function(){return e.recentVisibilityHandler(!1)}),f.swc.Eventing.registerEvent(r.ApiEvents.onControlShow,function(t){return e.chatShownHandler(!0,t)}),f.swc.Eventing.registerEvent(r.ApiEvents.onControlHide,function(t){return e.chatShownHandler(!1,t)}),f.swc.Eventing.registerEvent(r.ApiEvents.onControlClose,function(t){return e.chatShownHandler(!1,t)}),f.swc.Eventing.registerEvent(r.ApiEvents.onFocused,function(t){return e.focusHandler(t)}),f.swc.Eventing.registerEvent(r.ApiEvents.CallStatusChanged,function(t){e.callingStateHandler(t),e.notificationsManager.callStateHandler(t)}),Promise.all(s).then(function(){e._initPromise.resolve()}),e._initPromise.promise},e.initPesManager=function(){e._pesInitialized||(e.signInManager.onceSignedIn().then(function(){e.pesManager.init()}),e._pesInitialized=!0)},e._isRecentsVisible=!1,e._isChatShown=!1,e._isFocused=!1,e._isInCall=!1,e}();t.ServicesManager=pe},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(2),o=n(11),s=n(32),a=n(67),c=n(44),u={"<":"&lt;",">":"&gt;","&lt;":"<","&gt;":">","&LT;":"<","&GT;":">","&":"&amp;",'"':"&quot;","'":"&apos;","&amp;":"&","&quot;":'"',"&apos;":"'","&#39;":"'","&#96;":"`","&AMP;":"&","&QUOT;":'"',"&APOS;":"'"},l='(?:(?:\\s*title="[^"]+?"\\s*)|(?:\\s*tabindex="-1"\\s*)|(?:\\s*target="_blank"\\s*)){0,3}',p=a.default.multilineRegExp(["(&lt;a ",l,'href="((?:https?://|mailto:)[^"]+?)"',l,"&gt;)","((?:(?!&lt;/a&gt;)[\\s\\S])*)","(&lt;/a&gt;)"],"gi"),d={ALLOWED_TAGS:["span","canvas"],ALLOWED_ATTR:["id","type","data-item-id","class","data-is-animated"]},f={ALLOWED_TAGS:["b","i","s","hr","br","at","ss","h1","h2","h3","h4","h5","h6","span","div","quote","ul","li","ol","em","strong","br","canvas","p","title","description"],ALLOWED_ATTR:["tabindex","title","target","id","type","data-item-id","class","data-is-animated"]},h=function(){function e(){}return Object.defineProperty(e,"anchor",{get:function(){return e._anchor||(e._anchor=document.createElement("a"))},enumerable:!0,configurable:!0}),e.map=function(e){return u[e]},e.modifyLinkAnchorOpening=function(e,t){return e.search(a.default.escapeSpecialChars(t))>-1?e:e.replace(/(<a|&lt;a)/,function(e){return e+" "+t})},e.validateUrl=function(t,n){var r=e.anchor;return r&&e.validateUrlFormat(t)&&e.validateURLProtocol(r,n)},e.validateURLProtocol=function(e,t){return(t||["https:"]).indexOf(e.protocol)>-1&&-1===["javascript:"].indexOf(e.protocol)},e.validateUrlFormat=function(e){return!!e.match(/^(https:\/\/)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)/g)},e.escapeBrackets=function(e){return e.replace(/([<>])/gi,this.map)},e.unescapeBrackets=function(e){return e.replace(/(&lt;|&gt;)/gi,this.map)},e.unescape=function(e){return e.replace(/(&lt;|&gt;|&amp;|&quot;|&apos;|&#39;|&#96;)/gi,this.map)},e.validateUnescapedLink=function(e){return this.escapeBrackets(e).replace(p,this.validateAnchor)},e.parseTopic=function(t){return t?(t?e.unescape(t):"").replace(/<[^a\/].*?>(.*?)<\/[^a].*?>/gi,"$1").replace(/(<.*?\.{3,})$/,"").trim():t},e.getMessageSanitizedContent=function(e,t){var n={ALLOWED_TAGS:[],ALLOWED_ATTR:[]};return t&&t.noLinks?n=f:t&&t.noFormatting?n=d:(n={ALLOWED_TAGS:f.ALLOWED_TAGS.concat(["a"]),ALLOWED_ATTR:f.ALLOWED_ATTR.concat(["href"])},r.default.get.backend===o.MessagingBackend.TEAMS&&(n.ALLOWED_TAGS.push("img"),n.ALLOWED_ATTR.push("src","style","alt"))),s.default.dompurify.sanitize(e,n)},e.normalizeUrl=function(t){var n=e.anchor;return n.href=t,e.validateUrl(t)&&n.href},e.validateAnchor=function(t,n,r,i,o){var s=e.unescapeBrackets(n),a=e.unescapeBrackets(o);return 0!==r.indexOf("mailto:")&&(s=e.modifyLinkAnchorOpening(s,'target="_blank"')),s=e.modifyLinkAnchorOpening(s,'tabindex="-1"'),(s=e.modifyLinkAnchorOpening(s,'title="'+r+'"'))+i+a},e.webify=function(e){return e.replace(/(\r?\n)|(&lt;br\s?\/&gt;)/gm,"<br/>")},e.attachActionToLinks=function(e,t,n,r){if(1===e.nodeType&&e.matches(t))for(var i=e.querySelectorAll("a"),o=0;o<i.length;o++){var s=i[o];if(s.href.indexOf(n)>1){var a=c.default.getQueryParameter(s.href,n);a&&(s.setAttribute("data-swc-payload",a),s.addEventListener("click",r))}}},e.getSenderIdFromUrl=function(e){if(!e)return e;var t=e.match(/\/(\d+:[^?\/]*)/);return t&&t[1]?t[1]:(e.match(/(\d+:[^?\/]*)/),e)},e.extractMsgContent=function(e){return 0!==e.indexOf(i.Configuration.MSG_DELETED_CLASSIC_SKYPE)?e:e.slice(i.Configuration.MSG_DELETED_CLASSIC_SKYPE.length,e.length)},e.sanitizeTopic=function(e){return s.default.dompurify.sanitize(e,{ALLOWED_TAGS:f.ALLOWED_TAGS.concat(["img","a"]),ALLOWED_ATTR:f.ALLOWED_ATTR.concat(["src","href"])})},e.getMessagePreviewContent=function(t){return t=e._dropNewLineTag(t),t=e._dropAnchorTag(t),t=e._dropImgTag(t)},e._dropNewLineTag=function(e){return e.replace(/<br\s*\/?>/gm," ")},e._dropAnchorTag=function(e){return e.replace(/<\/*a.*?>/g," ")},e._dropImgTag=function(e){return e.replace(/<img .*?>/g,"")},e}();t.MessageUtils=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(30),i=n(0),o=n(37),s=n(43),a={allowedDomains:["swc.cdn.skype.com","latest-swc.cdn.skype.com"]},c=function(){function e(){}return e.combine=function(e,t){return e.lastIndexOf("/")!==e.length-1&&"/"!==t.substring(0,1)?e+"/"+t:this.getAppPath()+e+t},e.getAbsoluteUrl=function(e,t){var n=this.getCompletePath(e,t),o="css"===t?"css/":"";return e===r.PackageName.SDK_LOADER_CHAT?this.combine(i.swc.EcsConfig.loaderUrl,n):e===r.PackageName.CONNECT?this.combine(i.swc.EcsConfig.loaderUrl,n):this.combine(o,n)},e.getCompletePath=function(e,t){var n="";switch(i.swc.EcsConfig.environment){case"df":case"ppe":case"prod":n=".min"}return""+e+n+"."+t},e.setQueryParameters=function(e,t){return e+"?"+this.buildQueryParameters(t)},e.buildQueryParameters=function(e){var t=[];return Object.keys(e).forEach(function(n){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]))}),t.join("&")},e.getHost=function(){try{var e=window.location.hostname;return!e&&e.length>0?e:("file:"===window.location.protocol.toLowerCase()&&(e="local"),e)}catch(e){return null}},e.getVendorPath=function(){return e.getCDNPath()+"/vendors"},e.getConnectPagePath=function(){return e.getAppPath()+"connect.html"},e.getAppPath=function(){var t=i.swc.EcsConfig.version||i.swc.SDK.version,n=o.getBranchParentFolder(t);return e.getCDNPath()+"/"+n+"/"+t+"/"},e.getCDNPath=function(){var t=i.swc.EcsConfig.domain;return e.validateUriOrDie(t,a),t},e.validateUriOrDie=function(e,t){if(!s.UrlValidator.instance.validate(e,t))throw new Error("Invalid URI!")},e.appendQueryParam=function(e,t,n){return e+(-1===e.indexOf("?")?"?":"&")+encodeURIComponent(t)+"="+encodeURIComponent(n)},e}();t.UrlHelper=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.guid={generate:function(){var e=new Uint16Array(8);(window.crypto||window.msCrypto).getRandomValues(e);var t=0,n=function(){return(4369|e[t++]).toString(16)};return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()},isGuid:function(e){return/^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$/.test(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=function(){function e(e){var t=this;this._isCanceled=!1,this._status=r.Pending,this.cancel=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t._isCanceled||(t._isCanceled=!0,e[0]=e[0]||{},e[0].isCanceled=!0,t._status=r.Rejected,t._reject.apply(t._promise,e))},this._promise=new Promise(function(n,i){t._resolve=n,t._reject=i,e&&(e.then(function(e){t._isCanceled||(t._status=r.Resolved,n(e))},function(e){t._status=r.Rejected,i(e)}),e.catch(function(e){t._status=r.Rejected,t._isCanceled?i({isCanceled:!0}):i(e)}))})}return Object.defineProperty(e.prototype,"promise",{get:function(){return this._promise},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isCanceled",{get:function(){return this._isCanceled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),e.prototype.resolve=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._status!==r.Resolved&&(this._status=r.Resolved,this._resolve.apply(this._promise,e))},e.prototype.cancelQuitely=function(){this.status===r.Pending&&(this.promise.then(function(){},function(){}),this.cancel())},e}();t.CancelablePromise=i,function(e){e[e.Pending=0]="Pending",e[e.Resolved=1]="Resolved",e[e.Rejected=2]="Rejected"}(r=t.PromiseStatus||(t.PromiseStatus={}))},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NA="n/a"},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.getWindow=function(){return window},e.getDocument=function(){return window.document},e.getParentWithClass=function(e,t){for(;e&&!this.hasClass(e,t);)e=e.parentNode;return e},e.isInViewport=function(e,t){return t=t||this.getWindow(),e.bottom>0&&e.right>0&&e.top<t.innerHeight&&e.left<t.innerWidth},e.readDataset=function(e,t,n){return e.dataset?e.dataset[t]:e.getAttribute("data-"+n)},e.writeDataset=function(e,t,n,r){e.dataset?e.dataset[t]=r:e.setAttribute("data-"+n,r)},e.hasClass=function(e,t){if(e.classList)return e.classList.contains(t);for(var n=0,r=e.className?e.className.split(" "):[];n<r.length;n++){if(r[n]===t)return!0}return!1},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i,o,s=n(0),a=n(21),c=n(16),u={5.1:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"};!function(e){e.Desktop="Desktop",e.Mobile="Mobile",e.Tablet="Tablet"}(r=t.DeviceType||(t.DeviceType={})),function(e){e.MSIE="MSIE",e.CHROME="Chrome",e.FIREFOX="Firefox",e.SAFARI="Safari",e.EDGE="Edge",e.ELECTRON="Electron",e.SKYPE_SHELL="SkypeShell",e.PHANTOMJS="PhantomJS",e.UNKNOWN="Unknown"}(i=t.BrowserVendor||(t.BrowserVendor={})),function(e){e.WINDOWS="Windows",e.MACOSX="Mac OS X",e.WINDOWS_PHONE="Windows Phone",e.WINDOWS_RT="Windows RT",e.IOS="iOS",e.ANDROID="Android",e.LINUX="Linux",e.UNKNOWN="Unknown"}(o=t.OperatingSystem||(t.OperatingSystem={})),t.UNKNOWN_VERSION="U";var l=function(){function e(){}return e.getDeviceType=function(){return window.navigator.userAgent.match(/(android|ipod|windows phone|wpdesktop|windows ce|blackberry\w*|meego|webos|palm|symbian|pda|\w*?mobile\w*?|\w*?phone\w*?)/i)?r.Mobile:window.navigator.userAgent.match(/tablet|ipad/i)?r.Tablet:r.Desktop},e.getUserAgent=function(){return a.default.getWindow().navigator.userAgent},e.userAgentContainsString=function(e){return this.getUserAgent().indexOf(e)>-1},e.isChrome=function(){return this.userAgentContainsString(i.CHROME)&&!this.userAgentContainsString(i.EDGE)},e.isIe=function(){return this.userAgentContainsString("Trident")},e.isEdge=function(){return this.userAgentContainsString(i.EDGE)},e.isOpera=function(){return this.userAgentContainsString("OPR/")},e.testSupporedList=function(t){if(!t)return!1;t.constructor!==Array&&"string"==typeof t&&(t=[t]);for(var n=e.getBrowserName().toLocaleLowerCase(),r=0;r<t.length;r++)if(t[r].toLowerCase().indexOf(n)>-1)return!0;return!1},e.getBrowserName=function(){return this.isOpera()?i.UNKNOWN:this.userAgentContainsString(i.PHANTOMJS)?i.PHANTOMJS:this.isEdge()?i.EDGE:this.userAgentContainsString(i.ELECTRON)?i.ELECTRON:this.userAgentContainsString(i.CHROME)?i.CHROME:this.userAgentContainsString(i.FIREFOX)?i.FIREFOX:this.userAgentContainsString(i.SAFARI)?i.SAFARI:this.userAgentContainsString(i.SKYPE_SHELL)?i.SKYPE_SHELL:this.isIe()?i.MSIE:i.UNKNOWN},e.getBrowserVersion=function(){var e,n,r,o,s,a=this;return this.isIe()?(o=a.getUserAgent(),(s=o.match(new RegExp(i.MSIE+" ([\\d,.]+)")))?s[1]:(r=o.match(new RegExp("rv:([\\d,.]+)")))?r[1]:void 0):((e=this.getBrowserName())===i.SAFARI&&(e="Version"),(n=a.getUserAgent().match(new RegExp(e+"/([\\d,.]+)")))?n[1]:t.UNKNOWN_VERSION)},e.getScreenInfo=function(){var e=a.default.getWindow(),t=a.default.getWindow().navigator;return{width:a.default.getWindow().screen&&a.default.getWindow().screen.width||0,height:a.default.getWindow().screen&&a.default.getWindow().screen.height||0,pixelRatio:a.default.getWindow().devicePixelRatio||0,colorDepth:a.default.getWindow().screen&&a.default.getWindow().screen.colorDepth||0,isTouchEnabled:Object.prototype.hasOwnProperty.call(e,"ontouchstart")||t.MaxTouchPoints>0}},e.getOsName=function(){var e=this.getUserAgent();return e.match(/windows\sphone\s\d+\.\d+/i)?o.WINDOWS_PHONE:e.match(/ arm;/i)?o.WINDOWS_RT:e.match(/(iPad|iPhone|iPod)(?=.*like Mac OS X)/i)?o.IOS:e.match(/android/i)?o.ANDROID:e.match(/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|cros)/i)?o.LINUX:e.match(/(macintosh|mac os x)/i)?o.MACOSX:e.match(/(windows|win32)/i)?o.WINDOWS:o.UNKNOWN},e.getOsVersion=function(e){var n=this;void 0===e&&(e=!1);var r;return this.getOsName()===o.WINDOWS?function(e){var r=n.getUserAgent().match(new RegExp("Windows NT ([\\d,.]+)"));if(r){if(e)return r[1];if(u[r[1]])return u[r[1]]}return t.UNKNOWN_VERSION}(e):this.getOsName()===o.MACOSX&&(r=n.getUserAgent().match(new RegExp(o.MACOSX+" ([\\d,_,.]+)")))?r[1].replace(/_/g,"."):t.UNKNOWN_VERSION},e.getDeviceId=function(){var e=s.swc.services.localStorage,t=e.getItem("swc-deviceId");return t||(t=c.guid.generate(),e.setItem("swc-deviceId",t)),t},e}();t.default=l},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r=n(17),i=n(0),o=n(9),s=n(62),a=n(116),c=500;t.default=function(e,t,n,r){return 0,new Promise(function(i,o){var s=function(a){u(e,t.timeout,n,r).then(function(e){e.callCount=a,i(e)}).catch(function(e){0===e.status&&a<t.retryCount?setTimeout(function(){s(a+1)},c):o(e)})};s(1)})};var u=function(t,n,c,u){var p=Date.now(),d=u?u.method:null,f=function(e){var n=Date.now()-p;return e.ok||(a.reportServiceFault(t,e,n),o.default.throwHttpErrorCode(e.status,e.statusText)),i.swc.Telemetry.sendEvent.serviceQos(t,c+"",n,e,d),Promise.resolve(e)},h=function(e){var n=Date.now()-p;return a.reportServiceFault(t,e,n),i.swc.Telemetry.sendEvent.serviceQos(t,c+"",n,e,d),Promise.reject(e)};return s.get().onceOnline().then(function(){var t=e(c,u),i=new r.CancelablePromise(t);return l(i,n).then(f,h)},function(e){return Promise.reject(e)})},l=function(e,t){var n=setTimeout(function(){n=null,e.cancel({ok:!1,status:0,statusText:"Timeout"})},t),r=function(){n&&clearTimeout(n)};return e.promise.then(r,r),e.promise}}).call(this,n(72))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.SignedOut=0]="SignedOut",e[e.SigningIn=1]="SigningIn",e[e.SignedIn=2]="SignedIn",e[e.SigningOut=3]="SigningOut"}(t.SigninState||(t.SigninState={}))},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),i=n(0),o=n(75),s=function(){function e(){this.requests={}}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e)},enumerable:!0,configurable:!0}),e.prototype.async=function(e,t,n){var o=this;return this.requests[t]=this.requests[t]||new Promise(function(s,a){var c=n&&setTimeout(a,n),u=function(n){n&&n.refId&&n.refId===t&&(c&&clearTimeout(c),i.swc.Eventing.unregisterEvent(r.ApiEvents.proxy.resolve,u),s(o.create(e,n)))};i.swc.Eventing.registerEvent(r.ApiEvents.proxy.resolve,u)}),i.swc.Eventing.triggerEvent(r.ApiEvents.proxy.request,t),this.requests[t]},e.prototype.create=function(e,t){return new e(t)},e}();t.ProxyFactory=s;var a=function(){return function(e){var t=this;this.data={},this.callCount=0,this.exec=function(e,t){return i.swc.Eventing.triggerEvent(e,t)},this.reg=function(e,t){return i.swc.Eventing.registerEvent(e,t)},this.unreg=function(e,t){return i.swc.Eventing.unregisterEvent(e,t)},this.createCID=function(){return o.hashCode((t.callCount++).toString()+t.refId)},this.refId=e.refId,this.data=e,this.init()}}();t.Proxy=a;var c=function(){function e(){var e=this;this.connections={},this.answer=function(t){var n=e.connections[t];n&&i.swc.Eventing.triggerEvent(r.ApiEvents.proxy.resolve,Object.assign(n,{refId:t}))},i.swc.Eventing.registerEvent(r.ApiEvents.proxy.request,this.answer)}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e)},enumerable:!0,configurable:!0}),e.prototype.connect=function(e,t,n){this.connections[e]||(this.connections[e]=t||{},n&&n(),this.answer(e))},e.prototype.disconnect=function(e){delete this.connections[e]},e}();t.ProxyConnector=c},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(10),s=n(0),a=function(e){function t(){return e.call(this)||this}return i(t,e),Object.defineProperty(t,"instance",{get:function(){return t._instance||(t._instance=new t)},enumerable:!0,configurable:!0}),t.prototype.getLocale=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=null),t?(this.locale=t,this._locale):e?(this.locale=e,this._locale):this._locale?this._locale:s.swc.SDK&&s.swc.SDK.locale?(this.locale=s.swc.SDK.locale,this._locale):document.documentElement.lang?document.documentElement.lang.toLowerCase():window.navigator.languages&&0!==window.navigator.languages.length?window.navigator.languages[0].toLowerCase():navigator.language.toLowerCase()},Object.defineProperty(t.prototype,"locale",{set:function(e){e&&this._locale!==e.toLowerCase()&&(this._locale=e.toLowerCase(),this.publish("locale",this._locale))},enumerable:!0,configurable:!0}),t}(o.default);t.LocaleInfo=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.UNDETERMINED=10]="UNDETERMINED",e[e.GUEST=100]="GUEST",e[e.SKYPE=200]="SKYPE",e[e.DL_TOKEN=300]="DL_TOKEN",e[e.TEAMS=400]="TEAMS"}(t.IdentityType||(t.IdentityType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.SDK_LOADER_CHAT="sdk-loader",e.SDK_CORE="sdk-core",e.ASSETS="assets-bundle",e.BUILDER="builder-bundle",e.BUILDER_CORE="builder-core",e.CALLING="calling-bundle",e.CALLING_STANDALONE="callingStandalone-bundle",e.SERVICES="services-bundle",e.CHAT_BUNDLE="chat-bundle",e.RECENTS_BUNDLE="recents-bundle",e.UICOMPONENT_BUNDLE="uicomponent-bundle",e.TELEMETRY_BUNDLE="telemetry-bundle",e.CONNECT="connect",e.HOST_CHAT_PAGE="host-chat",e.HOST_BING_PAGE="host-button",e.HOST_BUILDER_PAGE="host-builder",e.STYLE_BUILDER="swc-builder",e.STYLE_SDK="swc-sdk",e.STYLE_CHAT_SKYPE="swc-chat",e.STYLE_RECENTS_SKYPE="swc-recents",e.STYLE_CHAT_BING="swc-bing",e.STYLE_CHAT_THEME_DARK="swc-dark",e.STYLE_CALLING="swc-calling",e}();t.PackageName=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(34),i=n(7),o=n(9),s=function(){function e(){}return e.strip=function(e){var t=e.match(this.idRegExp);return t?t[2]:e},e.detectConversationType=function(e){if(!e)return i.ConversationType.UNDEFINED;if(this.typeMapppings[e])return this.typeMapppings[e];var t,n=e.match(this.idRegExp);if(n&&(t=this.getTypeByPrefix(n[1])),t)return this.typeMapppings[e]=t,t;if(0===e.indexOf("https://join.skype.com/"))return this.typeMapppings[e]=i.ConversationType.JOIN,i.ConversationType.JOIN;if(/^(28:)?[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i.test(e))return this.typeMapppings[e]=i.ConversationType.AGENT,i.ConversationType.AGENT;if(/^(19:)?[\S]+[@]([\S].)?[\S]*thread\.skype/i.test(e))return this.typeMapppings[e]=i.ConversationType.GROUP,i.ConversationType.GROUP;return/(?:00|\+)?(^[^a-z][^A-Z])(\d+$)/i.test(e.replace(/\s+|[()\-\+]/gi,""))?(this.typeMapppings[e]=i.ConversationType.PHONE,i.ConversationType.PHONE):(this.typeMapppings[e]=i.ConversationType.PERSON,i.ConversationType.PERSON)},e.getSdkModeFromId=function(e){switch(this.detectConversationType(e)){case i.ConversationType.PERSON:return r.SDKMode.PERSON;case i.ConversationType.AGENT:return r.SDKMode.BOT;case i.ConversationType.JOIN:return r.SDKMode.JOIN_URL;case i.ConversationType.PHONE:return r.SDKMode.PHONE;case i.ConversationType.GROUP:return r.SDKMode.THREAD}return r.SDKMode.UNDEFINED},e.toFullIdentifier=function(e){var t=this.getPrefixForId(e);return 0===e.indexOf(t+":")?e:t?t+":"+e:e},e.addPrefix=function(e,t){return 0===t.indexOf(e+this.SPLITTER)?t:0===t.indexOf(this.SPLITTER)?e+t:e+this.SPLITTER+t},e.getNormalizeId=function(e){return e.match(this.idRegExp)?e.replace(/\d{1,2}:/,""):e},e.isEqual=function(e,t){return this.toFullIdentifier(e).toLowerCase()===this.toFullIdentifier(t).toLowerCase()},e.getPrefixForId=function(e){if(this.hasAlreadyPrefix(e))return"";var t=this.getSdkModeFromId(e);switch(t){case r.SDKMode.PERSON:return"8";case r.SDKMode.BOT:return"28";case r.SDKMode.THREAD:return"19";case r.SDKMode.PHONE:return"4";default:o.default.throwError(10502,"Unable to define conversation prefix",{id:e,sdkMode:t})}return""},e.getTypeByPrefix=function(e){if(!e)return i.ConversationType.UNDEFINED;switch(e.indexOf(":")>-1&&(e=e.replace(":","")),e){case"4":return i.ConversationType.PHONE;case"8":return i.ConversationType.PERSON;case"19":return i.ConversationType.GROUP;case"28":return i.ConversationType.AGENT;default:return i.ConversationType.UNDEFINED}},e.hasAlreadyPrefix=function(e){var t=/^\d+:/.exec(e);return!!t&&!!t[0]},e.SPLITTER=":",e.idRegExp=/(\d{1,2}:)([\S]*)/,e.typeMapppings={},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=function(){function e(){}return Object.defineProperty(e,"dompurify",{get:function(){return r.swcWindow.DOMPurify},enumerable:!0,configurable:!0}),e}();t.default=i},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.PERSON=1]="PERSON",e[e.THREAD=2]="THREAD",e[e.BOT=3]="BOT",e[e.JOIN_URL=4]="JOIN_URL",e[e.PHONE=5]="PHONE"}(t.SDKMode||(t.SDKMode={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Skype=8]="Skype",e[e.Agent=28]="Agent",e[e.Pstn=4]="Pstn",e[e.MSA=1]="MSA",e[e.Undefined=0]="Undefined"}(t.ContactType||(t.ContactType={}))},,function(e,t,n){"use strict";function r(e){return!!e&&(0===e.indexOf("fb-")||0===e.indexOf("pr-"))}Object.defineProperty(t,"__esModule",{value:!0}),t.versionRegExp=/\d+.\d+.\d+/,t.getBranchParentFolder=function(e){return r(e)?"fb":"v"},t.isAppVersion=function(e){return!!e&&t.versionRegExp.test(e)},t.isFeatureBranch=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SKYPE_TOKEN_KEY="skype|token",t.SKYPE_REGTOKEN_KEY="skype|registrationtoken",t.SKYPE_ENDPOINT_ID_KEY="skype|epid",t.SKYPE_ENDPOINT_KEY="skype|endpoint",t.SKYPE_HAS_HISTORY_KEY="skype|hasHistory",t.SKYPE_GRAPH_ACCESS_TOKEN_KEY="skype|graphAccessToken",t.SKYPE_ENDPOINT_OWNER_KEY="skype|endpointowner",t.SWC_SFB_DISMISSED_KEY="swc-sfb-dismissed"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="px",i="all 0.5s ease";function o(e,t){var n=e.style;n.top=t.top+r,n.left=t.left+r,n.width=t.width+r,n.height=t.height+r}function s(e){return window.getComputedStyle(e)}t.transport=function(e,t,n,r,s,a){var c=e.getBoundingClientRect(),u=function(e){return t.appendChild(e)};a||u(e),e.style.transition=i,o(e,c),setTimeout(function(){return o(e,n)},0),setTimeout(function(){s(),e.style.transition=null,a&&u(e)},r)},t.setRectStyle=o,t.resetRectStyle=function(e){var t=e.style;t.width=t.height=t.top=t.bottom=t.right=t.left=null},t.isInDom=function(e){if(e)for(;e.parentNode;)if((e=e.parentNode)===document.documentElement)return!0;return!1},t.innerSize=function(e){var t=s(e);return{width:e.offsetWidth-parseInt(t.paddingLeft,10)-parseInt(t.paddingRight,10),height:e.offsetHeight-parseInt(t.paddingTop,10)-parseInt(t.paddingBottom,10)}},t.setStyle=function(e,t){e.setAttribute("style",t)},t.style=s,t.copyStyle=function(e,t,n){for(var r=s(t),i=e.style,o=0,a=n;o<a.length;o++){var c=a[o];i[c]=r[c]}},t.isInIframe=function(){try{return window.self!==window.top}catch(e){return!0}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(41),i=n(14),o="returnDefaultImage=false",s="returnDefaultImage=true",a="?returnDefaultImage",c="?auth_key=",u=["rgb(153, 180, 51)","rgb(107, 165, 231)","rgb(231, 115, 189)","rgb(0, 163, 0)","rgb(30, 113, 69)","rgb(255, 0, 151)","rgb(126, 56, 120)","rgb(96, 60, 186)","rgb(29, 29, 29)","rgb(0, 171, 169)","rgb(45, 137, 239)","rgb(43, 87, 151)","rgb(218, 83, 44)","rgb(185, 29, 71)","rgb(238, 17, 17)"];t.loadAvatarUri=function(e,t,n){e&&(e.indexOf(c)<0&&(e=e.indexOf(a)<0?function(e){var t=e.split("?")[0],n=e.split("?")[1],r=function(e){return e.indexOf("/profile/avatar")>-1||e.indexOf("/public")>-1}(e);return n?(e=t+"?"+n,e+=r?"&"+o:""):e+=r?"?"+o:"",e}(e):e.replace(s,o)),r.default.preloadImage(e,t,n))},t.getBackgroundColor=function(e){for(var t=0,n=(e&&e.length||0)-1;n>=0;n--){var r=e.charCodeAt(n),i=n%8;t^=(r<<i)+(r>>8-i)}return u[t%u.length]},t.getInitials=function(e){var t="",n=(e=function(e){return i.MessageUtils.getMessageSanitizedContent(e).replace(/\s+/gi," ").trim()}(e)).split(" ");return n.length>1?(t+=n[0][0]?n[0][0]:"",t+=n[1][0]?n[1][0]:""):n.length&&(t+=n[0][0]?n[0][0]:"",t+=n[0][1]?n[0][1]:""),t.toUpperCase()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),i=n(0),o={caseFirst:"upper"},s=function(){function e(){}return e.mapSearchProfileInfo=function(e){return e&&e.results?e.results.map(function(e){var t=e.nodeProfileData.skypeId,n={skypeid:-1===t.indexOf("8:")?"8:"+t:t,name:e.nodeProfileData.name,avatar:e.nodeProfileData.avatarUrl,type:r.ContactType.Skype,contactType:e.nodeProfileData.contactType,annotation:e.nodeAnnotation,jobTitle:e.nodeProfileData.jobTitle,department:e.nodeProfileData.department,location:e.nodeProfileData.location};return e.nodeConnectionData&&(n.distance=e.nodeConnectionData.distance,n.mutualFriendCount=e.nodeConnectionData.mutualFriendCount),n}):[]},e.getWrappedIdWithMri=function(e){var t=/^\d+:/.exec(e.id);if(t&&t[0])return e.id;var n=e.isAgent?/^28:/:/^8:/;return(e.isAgent?"28:":"8:")+e.id.replace(n,"")},e.sortByName=function(e,t){var n=e.person.displayName.localeCompare(t.person.displayName,void 0,o);return 0===n?e.person.id.localeCompare(t.person.id):n},e.getSortedByRelevance=function(t){var n=t.filter(function(e){return e.rawPerson.mutualFriendCount}).sort(function(e,t){return t.rawPerson.mutualFriendCount-e.rawPerson.mutualFriendCount}),r=t.filter(function(e){return!e.rawPerson.mutualFriendCount}).sort(e.sortByName);return n.concat(r)},e.preloadImage=function(e,t,n){if(e.indexOf("data:image/jpeg;base64")>-1)t&&"function"==typeof t&&t(e);else{if(-1!==e.indexOf("https://teams.microsoft.com")){var r=i.swc.services.avatarService;if(r.fetchSingleAvatar&&t&&"function"==typeof t)return void r.fetchSingleAvatar(e).then(function(e){t(e)})}var o=new Image,s=encodeURI(decodeURI(e));o.onload=function(){t&&"function"==typeof t&&t(s)},o.onerror=function(e){n&&"function"==typeof n&&n()},o.src=s}},e.replaceAvatarPath=function(e){return e.indexOf("data:image/jpeg;base64")>-1?e:e=(e=e.replace("URL@","")).indexOf("/views/avatar_fullsize")<0?e+"/views/avatar_fullsize":e},e.resolveConversationAvatar=function(t,n){return n?t?e.replaceAvatarPath(n):n:""},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21),i=n(15),o=function(){function e(){}return e.addScript=function(t,n,o,s){var a=n?i.UrlHelper.getAbsoluteUrl(t,"js"):t;if(-1===e.loaded.indexOf(a)){var c=e.progress;if(c[a])return o&&-1===c[a].success.indexOf(o)&&c[a].success.push(o),void(s&&-1===c[a].failure.indexOf(s)&&c[a].failure.push(s));c[a]={success:[],failure:[]},o&&c[a].success.push(o),s&&c[a].failure.push(s);var u=r.default.getDocument(),l=u.createElement("script");l.crossOrigin="anonymous",l.type="text/javascript",l.src=a,o&&(l.onload=function(){e.progress[a].success.forEach(function(e){try{e()}catch(e){}}),delete e.progress[a],e.loaded.push(a)}),s&&(l.onerror=function(){e.progress[a].failure.forEach(function(e){try{e()}catch(e){}}),delete e.progress[a]}),u.getElementsByTagName("body")[0].appendChild(l)}else o&&o()},e.loaded=[],e.progress={},e}();t.ScriptLoader=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={allowedProtocols:["https:"]},i=function(){function e(){this.probe=document.createElement("a")}return Object.defineProperty(e,"instance",{get:function(){return e.init()},enumerable:!0,configurable:!0}),e.init=function(){return e._instance||(e._instance=new e)},e.prototype.validate=function(e,t){if(!e)return!1;var n=Object.assign(r,t||{}),i=function(e,t){if(!t)return!0;for(var n,r=0,i=t;r<i.length;r++){if(n=i[r]===e)break}return n};this.probe.href=e;var o=i(this.probe.protocol,n.allowedProtocols)&&i(this.probe.hostname,n.allowedDomains)&&i(this.probe.port,n.allowedPorts);return this.probe.href="",o},e}();t.UrlValidator=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.getQueryParameters=function(){var e=window.location.search.substring(1);return this.extractQueryParameters(e)},e.extractQuery=function(e){var t="";return e.indexOf("?")>-1&&(t=e.split("?")[1]),t},e.getQueryParameter=function(e,t){var n=this.extractQuery(e);return n?this.extractQueryParameters(n)[t]:null},e.extractQueryParameters=function(e){var t=e.split("&"),n={};return t.forEach(function(e){var t=e.split("=");n[decodeURIComponent(t[0])]=decodeURIComponent(t[1])||""}),n},e.extractProtocol=function(e){var t=null;return e.indexOf("://")>-1&&(t=e.split("://")[0]),t},e.extractHostname=function(e){return(e.indexOf("//")>-1?e.split("/")[2]:e.split("/")[0]).split(":")[0].split("?")[0]},e.extractPath=function(e){var t="";e.indexOf("//")>-1&&(e=e.split("//")[1]);var n=e.indexOf("/");return n>-1&&(t=e.substring(n)),t=t.split("?")[0]},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Online="Online",e.Busy="Busy",e.Offline="Offline",e.Undefined="Undefined",e.OnThePhone="OnThePhone",e.Away="Away",e.Idle="Idle",e.OutToLunch="OutToLunch",e.BeRightBack="BeRightBack",e.DoNotDisturb="DoNotDisturb"}(t.PresenceStatus||(t.PresenceStatus={}))},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(110),i=n(7),o=n(153),s=n(0),a=n(14),c=n(85),u=function(){function e(){var e=this;this.encoder=new r.Encoder,this.decodeContent=function(t){return e.encoder.decode(t)}}return e.prototype.generate=function(e){return null},e.prototype._createMessageModel=function(e,t,n){var r;void 0===n&&(n=!1);var u=new o.default(n),l=void 0!==t?t:e.content;n?e.customType&&(u.customType=e.customType):(u.senderId=a.MessageUtils.getSenderIdFromUrl(e.from),u.sender=s.swc.services.persons.getPerson(u.senderId));var p=s.swc.services.mePersonManager.isMe(c.default.normalizePersonId(u.senderId));u.id=e.id,u.content=l?this.decodeContent(l):"",u.timestamp=new Date(e.originalarrivaltime),u.originalTimestamp=u.timestamp,u.composeTime=new Date(e.composetime),u.skypeEditedId=e.skypeeditedid,u.key=e.skypeeditedid||e.clientmessageid||e.id||"0",u.direction=n||!p?i.Direction.Incoming:i.Direction.Outgoing,u.rawMessageType=e.messagetype,u.clientMessageId=e.clientmessageid,u.editedTimestamp=e.properties&&e.properties.edittime?new Date(parseInt(e.properties.edittime,10)):null,u.deletedTimestamp=e.properties&&e.properties.deletetime?new Date(parseInt(e.properties.deletetime,10)):null;var d=!!e.skypeeditedid||!!u.editedTimestamp,f=!l&&!!e.skypeeditedid||!!u.deletedTimestamp;if(u.properties=e.properties,u.isEdited=d,u.isDeleted=f,u.version=Number(e.version),u.imdisplayname=e.imdisplayname,e.properties&&e.properties.files)try{var h=void 0;h="string"==typeof e.properties.files?JSON.parse(e.properties.files):e.properties.files,(r=u.files).pushObservable.apply(r,h)}catch(e){}return u},e.prototype._generateOutgoingModel=function(e){var t,n=new o.default(!1,e);if(n.id=e.clientmessageid,n.timestamp=new Date(e.composetime),n.originalTimestamp=n.timestamp,n.key=e.clientmessageid,n.senderId=s.swc.services.mePersonManager.mePerson.mri,n.direction=i.Direction.Outgoing,n.content=this.decodeContent(e.content),n.processedContent=e.processedcontent,n.rawMessageType=e.messagetype,n.clientMessageId=e.clientmessageid,e.properties&&(n.properties=e.properties,"string"==typeof e.properties))try{var r=JSON.parse(e.properties).files||[];(t=n.files).pushObservable.apply(t,r)}catch(e){}return n},e.prototype.parseContentFor=function(e,t){var n=new RegExp("<"+t+">(.+?)</"+t+">","i"),r=e.match(n);return r?r[1]:""},e}();t.default=u},,,function(e,t,n){"use strict";var r,i,o;Object.defineProperty(t,"__esModule",{value:!0}),window.swc=window.swc||{},function(e){e[e.iwapp=927]="iwapp",e[e.todo=927]="todo",e[e.wac=928]="wac",e[e.powerbi=930]="powerbi",e[e.sharepoint=931]="sharepoint",e[e.adminportal=932]="adminportal",e[e.yammer=933]="yammer",e[e.dynamics365=934]="dynamics365",e[e.dynamicsnav=934]="dynamicsnav"}(r||(r={})),function(e){e[e.outlook=915]="outlook",e[e.interviews=916]="interviews",e[e.bing=917]="bing",e[e.msn=918]="msn",e[e.azureportal=919]="azureportal",e[e.onedrive=920]="onedrive",e[e.scom=921]="scom",e[e.office=927]="office",e[e.word=928]="word",e[e.excel=929]="excel",e[e.powerpoint=930]="powerpoint",e[e.sharepoint=931]="sharepoint",e[e.adminportal=932]="adminportal",e[e.yammer=933]="yammer",e[e.dynamics=934]="dynamics",e[e["office default"]=935]="office default"}(i=t.NameMapping||(t.NameMapping={})),function(e){e[e["outlook.live.com"]=915]="outlook.live.com",e[e["outlook-sdf.live.com"]=915]="outlook-sdf.live.com",e[e["outlook.office.com"]=915]="outlook.office.com",e[e["outlook-sdf.office.com"]=915]="outlook-sdf.office.com",e[e["interviews.skype.com"]=916]="interviews.skype.com",e[e["interviews-df.skype.com"]=916]="interviews-df.skype.com",e[e["interviews-int.skype.com"]=916]="interviews-int.skype.com",e[e["www.bing.com"]=917]="www.bing.com",e[e["www.staging-bing-int.com"]=917]="www.staging-bing-int.com",e[e["www.bing-int.com"]=917]="www.bing-int.com",e[e["www.msn.com"]=918]="www.msn.com",e[e["int.msn.com"]=918]="int.msn.com",e[e["int1.msn.com"]=918]="int1.msn.com",e[e["wtskype2.azurewebsites.net"]=919]="wtskype2.azurewebsites.net",e[e["azuresupportextension-ms.hosting.portal.azure.net"]=919]="azuresupportextension-ms.hosting.portal.azure.net",e[e["portal.azure.com"]=919]="portal.azure.com",e[e["rc.portal.azure.com"]=919]="rc.portal.azure.com",e[e["ms.portal.azure.com"]=919]="ms.portal.azure.com",e[e["onedrive.live.com"]=920]="onedrive.live.com",e[e["www.skype.com"]=921]="www.skype.com",e[e["www.office.com"]=927]="www.office.com",e[e["microsoft-my.sharepoint.com"]=931]="microsoft-my.sharepoint.com",e[e["www.onedrive.com"]=920]="www.onedrive.com",e[e["word.office.com"]=928]="word.office.com",e[e["word.live.com"]=928]="word.live.com",e[e["excell.office.com"]=929]="excell.office.com",e[e["excell.live.com"]=929]="excell.live.com",e[e["powerpoint.office.com"]=930]="powerpoint.office.com",e[e["powerpoint.live.com"]=930]="powerpoint.live.com",e[e["sharepoint.office.com"]=931]="sharepoint.office.com",e[e["adminportal.office.com"]=932]="adminportal.office.com",e[e["www.yammer.com"]=933]="www.yammer.com",e[e["dynamics.office.com"]=934]="dynamics.office.com",e[e[".office.com"]=935]=".office.com"}(o||(o={}));var s=function(){function e(){}return e.getPlatformId=function(e){if(void 0===e&&(e=null),this._platformId)return this._platformId;if(swc.SDK&&swc.SDK.platformId&&swc.SDK.platformId>0)return this._platformId=swc.SDK.platformId,this._platformId;var t=-1;return e&&(t=this.getPlatformIdByAttribute(e)),t<=0&&(t=this.getPlatformIdByDomain()),t>0?t:912},e.getPlatformIdByAttribute=function(e){if(e){e=e.trim().toLowerCase();var t=parseInt(e,10);return t&&t>0?t:this.getPlatformIdForOffice(e)}return-1},e.getPlatformName=function(){var e=this.getPlatformId();return i[e]?i[e]:"other"},e.getPlatformIdForOffice=function(e){return r[e]||935},e.getPlatformIdByDomain=function(){var t=e.getHost();if(o.hasOwnProperty(t))return o[t];for(var n in o)if("."===n.charAt(0)&&t.indexOf(n)>0)return o[n];return-1},e.getHost=function(){try{var e=window.location.hostname;return!e&&e.length>0?e:("file:"===window.location.protocol.toLowerCase()&&(e="local"),e)}catch(e){return null}},e}();t.PlatformUtils=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.unknown=0]="unknown",e[e.card=1]="card",e[e.carousel=2]="carousel",e[e.signin=3]="signin",e[e.receipt=4]="receipt",e[e.multiline=5]="multiline",e[e.adaptive=6]="adaptive"}(t.SwiftCardType||(t.SwiftCardType={})),function(e){e[e.unknown=0]="unknown",e[e.hero=1]="hero",e[e.thumb=2]="thumb",e[e.receipt=3]="receipt",e[e.signin=4]="signin",e[e.video=5]="video",e[e.audio=6]="audio",e[e.animation=7]="animation",e[e.actionImage=8]="actionImage",e[e.flex=9]="flex",e[e.adaptive=10]="adaptive"}(t.SwiftCardContentType||(t.SwiftCardContentType={})),function(e){e[e.unknown=0]="unknown",e[e.unsupported=1]="unsupported",e[e.openUrl=2]="openUrl",e[e.imBack=3]="imBack",e[e.signin=4]="signin",e[e.call=5]="call",e[e.showImage=6]="showImage",e[e.payment=7]="payment",e[e.postBack=8]="postBack"}(t.SwiftCardActionType||(t.SwiftCardActionType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.UserMessage="UserMessage",e.SwiftCard="SwiftCard",e.SystemMessage="SystemMessage",e.Unsupported="Unsupported",e.SkypeLogo="SkypeLogo",e.Welcome="Welcome",e.Translate="Translate",e.LwcImage="LwcImage",e.LwcFile="LwcFile",e.UnreadSplitter="UnreadSplitter"}(t.MessageType||(t.MessageType={})),function(e){e.CallEnd="CallEndMsg",e.MissedCall="MissedCallMsg",e.MissedGroupCall="MissedGroupCallMsg",e.Call="CallMsg",e.Custom="CustomMsg",e.MeLeftGroup="MeLeftGroupConversation"}(t.CustomMessageType||(t.CustomMessageType={})),function(e){e[e.Incoming=0]="Incoming",e[e.Outgoing=1]="Outgoing"}(t.Direction||(t.Direction={})),function(e){e[e.Pending=0]="Pending",e[e.Sent=1]="Sent",e[e.Failed=2]="Failed"}(t.DeliveryStatus||(t.DeliveryStatus={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.addMember="addMember",e.changeTopic="changeTopic",e.changePicture="changePicture",e.kickMember="kickMember",e.editMsg="editMsg",e.callP2P="callP2P",e.sendText="sendText",e.sendSms="sendSms",e.sendFileP2P="sendFileP2P",e.sendContacts="sendContacts",e.sendVideoMsg="sendVideoMsg",e.sendMediaMsg="sendMediaMsg",e.changeModerated="changeModerated"}(t.ParticipantCapabilities||(t.ParticipantCapabilities={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.UNDEFINED="",e.PERSON="person",e.PHONE="phone",e.AGENT="agent",e.JOIN="join",e.GROUP="group"}(t.ConversationType||(t.ConversationType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Admin="Admin",e.User="User"}(t.ParticipantRole||(t.ParticipantRole={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="NFKD",i={"":"a","":"o","":"a","":"a","":"a","":"a","":"a","":"a","":"c","":"e","":"e","":"e","":"e","":"i","":"i","":"i","":"i","":"n","":"o","":"o","":"o","":"o","":"o","":"u","":"u","":"u","":"u","":"y","":"y","":"a","":"a","":"a","":"c","":"c","":"c","":"c","":"d","":"e","":"e","":"e","":"e","":"e","":"g","":"g","":"g","":"g","":"h","":"i","":"i","":"i","":"i","":"ij","":"j","":"k","":"l","":"l","":"l","":"l","":"n","":"n","":"n","":"n","":"o","":"o","":"o","":"r","":"r","":"r","":"s","":"s","":"s","":"s","":"t","":"t","":"u","":"u","":"u","":"u","":"u","":"u","":"w","":"y","":"z","":"z","":"z","":"s","":"o","":"u","":"dz","":"Lj","":"lj","":"Nj","":"nj","":"a","":"i","":"o","":"u","":"u","":"u","":"u","":"u","":"a","":"a","":"g","":"k","":"o","":"o","":"j","":"dz","":"g","":"n","":"a","":"a","":"a","":"e","":"e","":"i","":"i","":"o","":"o","":"r","":"r","":"u","":"u","":"s","":"t","":"h","":"a","":"e","":"o","":"o","":"o","":"o","":"y","":"h","":"j","":"r","":"w","":"y","":"l","":"s","":"x"};function o(e,t){var n=e.substring(0,t).search(/\S+$/),r=e.substring(t).search(/\s/);return-1===n&&(n=t),-1===r?r=e.length:r+=t,{start:n,end:r}}t.toBoolean=function(e){return e?"true"===e.toLowerCase():null},t.wordAt=function(e,t){var n=o(e,t);return e.substring(n.start,n.end)},t.inject=function(e,t,n,r){return void 0===r&&(r=n),e.substr(0,n)+t+e.substr(r,e.length)},t.wordBoundariesAt=o,t.b64DecodeUnicode=function(e){return decodeURIComponent(Array.prototype.map.call(atob(e),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))},t.normalizeString=function(e){if(e=e.toLowerCase(),String.prototype.normalize)return e.normalize(r).replace(/[\u0300-\u036f]/g,"");var t=parseInt("0xD800",16),n=parseInt("0xDBFF",16),o=0,s="",a="",c=void 0;if(!e)return e;for(;o<e.length;)s+=e.charAt(o),((c=e.charCodeAt(o))<t||c>n)&&(a+=i.hasOwnProperty(s)?i[s]:s,s=""),o++;return a},t.startsWith=function(e,t){return 0===e.indexOf(t)},t.endsWith=function(e,t){return e.lastIndexOf(t)===e.length-t.length}},,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(5),o=n(2),s=n(29),a=n(11),c=n(0),u=n(64);t.TEAMS_NOTIFICATION_CHANNEL_ID="48:notifications";var l=function(e){void 0===e&&(e="");var t=e.match((r||(r=i.default.get.backend===a.MessagingBackend.TEAMS?/^(https?:.+?\.microsoft\.com\/V\d+\/)/i:/^(https?:.+?\.live\.com\/V\d+\/)/i),r));return t?t[1]:null};function p(e){return l(e).replace(/\/(v2)\/?$/i,"/v1/")}t.parseChatServiceHostUrl=p,t.handle404Redirect=function(e,t,n){var r=e.headers.get("location");return 404===e.status&&r&&l(r)?(o.Configuration.CHAT_HOST_URL=p(r),n?t(r):t()):Promise.resolve(e)},t.getDomain=function(){return c.swc.services.signInManager.userIdentityType===s.IdentityType.GUEST&&o.Configuration.CHAT_GUEST_HOST_URL!==o.Configuration.CHAT_HOST_URL&&c.swc.Telemetry.sendEvent.serviceQos("webapi-guestInDogfood","",0,null,""),o.Configuration.CHAT_HOST_URL},t.getConversationIdFromUrl=function(e){var t=e&&e.match(/\/(\d+:[^\/]*)[\/]?/);return t&&t[1]?t[1]:void 0},t.reset=function(){o.Configuration.CHAT_HOST_URL=o.Configuration.CHAT_GUEST_HOST_URL},t.normalizePersonId=function(e){var t=e.match(/(\d+:)([\S]*)/);return t?t[2]:e},t.isThread=function(e){try{var t=e.threadtype;if(t&&(t===u.ThreadType.Space||t===u.ThreadType.Topic))return!0}catch(e){}return!1},t.isThreadExtended=function(e){try{var t=(e.threadtype||e.threadType||e.threadProperties&&(e.threadProperties.threadtype||e.threadProperties.threadType)||e.properties&&(e.properties.threadtype||e.properties.threadType)||e.type||"").toLowerCase();if(t&&(t===u.ThreadType.Space||t===u.ThreadType.Topic))return!0}catch(e){}return!1}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),s=n(2),a=n(169),c=n(170),u=n(25),l=n(17),p=n(10),d=n(29),f=n(11),h=n(34),g=n(171),m=n(38),v=n(0),y=n(39),_=n(144),b=n(15),S=n(117),T=n(115),w=n(172),P=n(173);n(174);var C,E="Please disable your popup blocker as it affects sign in/out process. Repeat the operation again after disabling the blocker.",O=2e4;!function(e){e.SpacesApi="https://api.spaces.skype.com",e.Sharepoint="https://microsoft-my.sharepoint.com",e.Presence="https://presence.teams.microsoft.com",e.AggregationApi="https://chatsvcagg.teams.microsoft.com"}(C=t.AadAudience||(t.AadAudience={}));var k=function(){function e(e,t){var n=this;this.tokenProvider=e,this.regionGtmsProvider=t,this.tokenProviderCallback=function(){return Promise.all([n.tokenProvider(),n.regionGtmsProvider()]).then(function(e){var t=e[0],r=e[1];return{tokens:{skypeToken:t,expiresIn:n.getExiresIn(t)},regionGtms:r}})}}return e.prototype.getExiresIn=function(e){return(new _.TokenParser).getTokenData(e).exp-Math.floor(Date.now()/1e3)},e}(),M=function(e){function t(n,r,i,p,g){var m=e.call(this)||this;m.outerTokenProvider=n,m.tokenType=p,m._signOutContext=new P.default,m._reloginContext=new a.default(!1),m._tokenParser=new _.TokenParser,m._userIdentityType=d.IdentityType.UNDETERMINED,m._failedSilentLoginCount=0,m.isSilentLoginEnabled=!0,m.login=function(e){if(m._externalLogin&&"function"==typeof m._externalLogin)return m._externalLogin(),void m.sendSignedInTelemetry("","externalLogin");var t=s.Configuration.LOGIN_PAGE_URL;if(t+="?client_id="+s.Configuration.LOGIN_CLIENT_ID,t+="&redirect_uri="+encodeURI(b.UrlHelper.getConnectPagePath()),t+="&lang="+s.Configuration.LOCALE,t+="&response_type=token",m._getTokenPromise&&m._getTokenPromise.status===l.PromiseStatus.Pending){var n=m.showLoginPopup.bind(m,t,e);m._getTokenPromise.promise.then(null,n)}else m.showLoginPopup(t,e)},m.logout=function(e){if(m.outerTokenProvider)return Promise.resolve();if(m._signOutContext.signoutPromise)return m._signOutContext.signoutPromise;if(m.state===u.SigninState.SigningOut)return Promise.resolve();if(m.prelogoutActions.length>0){var t=m._logout.bind(m,e);return m._signOutContext.signoutPromise=m.execPrelogoutAction(m.prelogoutActions.pop()).then(t,t),m._signOutContext.signoutPromise}return m._signOutContext.signoutPromise=m._logout(e),m._signOutContext.signoutPromise},m._logout=function(e){if(m.state===u.SigninState.SigningOut)return Promise.resolve();var t=Date.now();m._reloginContext.canRelogin||m._reloginContext.setContext(m.activeConversationSdkMode===h.SDKMode.BOT,function(){return m.getGuestToken()});var n=s.Configuration.LOGOUT_PAGE_URL;n+="?",n+="&client_id="+s.Configuration.LOGIN_CLIENT_ID,n+="&redirect_uri="+b.UrlHelper.getConnectPagePath(),n+="&redirect=true",n+="&response_type=token";var r=window.open(n,"_blank",s.Configuration.LOGOUT_POPUP_FEATURES),i=null==r;return i&&m._userIdentityType===d.IdentityType.SKYPE?(m.sendSignedOutTelemetry(e,t,!0),alert(E),Promise.resolve()):(!i&&window.focus&&r.focus(),m.state=u.SigninState.SigningOut,m.state=u.SigninState.SignedOut,m.reset(),m.sendSignedOutTelemetry(e,t),m._lastAuthSource=c.AuthSource.UserLogout,o.default.get.meId="",Promise.resolve())},m.execPrelogoutAction=function(e){var t=function(){if(m.prelogoutActions.length>0){var e=m.prelogoutActions.pop();return m.execPrelogoutAction(e)}return Promise.resolve()};e&&"function"==typeof e||t();var n=e();return n&&"function"==typeof n.then?n.then(t.bind(m),t.bind(m)):t()},m.getGuestToken=function(){if(m._guestUserPromise)return m._guestUserPromise;var e=Date.now();return m._guestUserPromise=w.getGuestToken("Guest").then(function(t){return m._userIdentityType=d.IdentityType.GUEST,m.setTokenDataToCache(t.SkypeToken,86400,!0),m.sendSignedInTelemetry(t.SkypeToken,"guest",e),m._signOutContext.reset(),t},function(t){m.sendSignedInTelemetry(void 0,"guest",e,t.message),m.clearUserDataFromCache(),m._guestUserPromise=null}),m._guestUserPromise},m.showLoginPopup=function(e,t){var n,r,i=Date.now(),o=m.state===u.SigninState.SignedOut,a=function(e){var s=/(?:access_token=)([\S]*)(?:&)(?:expires_in=)([\d*]*)/g.exec(e.data);if(s&&(n=s[1],r=s[2]),s||(n=e.data.token,r=Date.now()+864e5+""),!n)return m.state=u.SigninState.SignedOut,void window.removeEventListener("message",a);m._failedSilentLoginCount=0,o&&(m.currentUsername=n?m._tokenParser.retrieveMeName(n):"",m.setTokenDataToCache(n,parseInt(r,10),!1),m.publish("resurrect",!0),m._signOutContext.reset()),o?t&&t(n):(m._reloginContext.setContext(!0,function(){return m._userIdentityType=d.IdentityType.SKYPE,m.setTokenDataToCache(n,parseInt(r,10),!1),m.sendSignedInTelemetry(n,"popup",i),t&&t(n),Promise.resolve()}),m._signOutContext.reset(),m._signOutContext.isRelogin=!0,m.logout()),m._lastAuthSource=c.AuthSource.Popup,window.removeEventListener("message",a)};window.addEventListener("message",a,!1);var l=window.open(e,"_blank",s.Configuration.LOGIN_POPUP_FEATURES);l&&window.focus&&l.focus()},m.aadTokens={},m.aad=function(e){if(!m.outerTokenProvider)return Promise.reject("outerTokenProvider is not defined");e||(e=C.SpacesApi);var t=function(e){return m.outerTokenProvider(e).then(function(e){return-1===e.indexOf("Bearer")?"Bearer "+e:e})};return m.aadTokens[e]||(m.aadTokens[e]=t(e)),m.aadTokens[e].then(function(n){return function(e){var t=m._tokenParser.getTokenData(e),n=Date.now()+1e4;return t&&1e3*t.exp>n}(n)?n:(m.aadTokens[e]=t(e),m.aadTokens[e])})};var v=!o.default.get.frameless&&window!==window.top&&!!window.parent,y=!p||p!==T.TokenType.Aad,S=!y&&v;return m.isSilentLoginEnabled=y,m._onceSingedInPromise=new l.CancelablePromise,m._state=u.SigninState.SignedOut,S||(m.getSkypeToken=n||m._getSkypeToken),m._externalLogin=i,o.default.get.backend=p&&"aad"===p?f.MessagingBackend.TEAMS:f.MessagingBackend.SKYPE,S&&g&&(m.teamsRemoteTokenExchange=new k(g.skypetokenProvider,g.regionGtmsProvider),m.getSkypeToken=function(){return m._getSkypeTokenFromAad()}),m.outerTokenProvider?y?(m.clearUserDataFromCache(),m._getInfoFromExternalToken()):m._getSkypeTokenFromAad():r&&(m.clearUserDataFromCache(),m.setTokenDataToCache(r.skypeToken,r.expiresAt,r.isGuest),y?(m._userIdentityType=t._getUserIdentityType(r),m._lastAuthSource=c.AuthSource.WX):(m.teamsTokenPromise=Promise.resolve(r.skypeToken),m.currentUsername=m._tokenParser.retrieveMeName(r.skypeToken),m.state=u.SigninState.SignedIn,m._lastAuthSource=c.AuthSource.AAD,m._userIdentityType=d.IdentityType.SKYPE)),m.prelogoutActions=[],m}return i(t,e),t._getUserIdentityType=function(e){return e.isGuest?d.IdentityType.GUEST:"aad"===e.tokenType?d.IdentityType.TEAMS:d.IdentityType.SKYPE},t.prototype._getInfoFromExternalToken=function(){var e=this;o.default.get.backend=f.MessagingBackend.SKYPE,this.outerTokenProvider().then(function(t){e.currentUsername=t?e._tokenParser.retrieveMeName(t):"";var n=e._userId.indexOf("guest:")>-1;e.state=t?u.SigninState.SignedIn:u.SigninState.SignedOut,e._lastAuthSource=n?c.AuthSource.Guest:c.AuthSource.External,e._userIdentityType=n?d.IdentityType.GUEST:d.IdentityType.SKYPE,e.sendSignedInTelemetry(t,"external",Date.now())},function(){e.state=u.SigninState.SignedOut,e._lastAuthSource=c.AuthSource.External,e.sendSignedInTelemetry(null,"external",Date.now())})},t.prototype._getSkypeToken=function(){var e=this;if(o.default.get.backend=f.MessagingBackend.SKYPE,this._getTokenPromise&&this._getTokenPromise.status===l.PromiseStatus.Pending)return this._getTokenPromise.promise;this._lastAuthSource=c.AuthSource.UNDEFINED;var t=this.getTokenDataFromCache();if(t&&t.isGuest&&o.default.get.isSkypeOnly&&(t=null),o.default.get.isGuestOnlyMode&&t&&!t.isGuest&&(this.clearUserDataFromCache(),t=null),this._signedIn||!t||t.isGuest||(t=null),t)return this.currentUsername=this._tokenParser.retrieveMeName(t.token),this._userIdentityType=t.isGuest?d.IdentityType.GUEST:d.IdentityType.SKYPE,void 0===this._signedIn&&(this.sendSignedInTelemetry(t.token,"cache",Date.now()),this.callExternalHandler(this.externalSuccessCallback)),this._lastAuthSource=c.AuthSource.Cache,this.state=u.SigninState.SignedIn,Promise.resolve(t.token);this.state=u.SigninState.SigningIn,this.clearUserDataFromCache();var n=new Promise(function(t,n){var r=e;function i(e){r.activeConversationSdkMode===h.SDKMode.BOT?(r.state!==u.SigninState.SignedIn&&(r.state=u.SigninState.SigningIn),r.getGuestToken().then(function(e){r.currentUsername=r._tokenParser.retrieveMeName(e.SkypeToken),r.state=u.SigninState.SignedIn,t(e.SkypeToken),r.callExternalHandler(r.externalSuccessCallback),r._lastAuthSource=c.AuthSource.Guest}).catch(function(e){r.clearUserDataFromCache(),r.callExternalHandler(r.externalFailureCallback,r.formatError(e)),r._guestTokenRetryInterval||(r._guestTokenRetryInterval=new S.FixedTimeout(i.bind(r),O)),r._guestTokenRetryInterval.start()})):(r.state=u.SigninState.SignedOut,n(),r.callExternalHandler(r.externalFailureCallback,r.formatError(e)))}e.state!==u.SigninState.SignedIn&&(e.state=u.SigninState.SigningIn),o.default.get.isGuestOnlyMode?i():e.silentLogin().then(function(e){this.state=u.SigninState.SignedIn,this.currentUsername=this._tokenParser.retrieveMeName(e),t(e),this.callExternalHandler(this.externalSuccessCallback),this._lastAuthSource=c.AuthSource.SilentLogin}.bind(e),function(e){return o.default.get.isSkypeOnly?(r.state=u.SigninState.SignedOut,r.callExternalHandler(r.externalFailureCallback),n()):i(e)}.bind(e))});return this._getTokenPromise=new l.CancelablePromise(n),this._getTokenPromise.promise},t.prototype.onceSignedIn=function(){return this.getSkypeToken().then(null,function(){}),this._onceSingedInPromise.promise},t.prototype.getLastAuthSource=function(){return this._lastAuthSource},Object.defineProperty(t.prototype,"lastAuthSource",{get:function(){return this._lastAuthSource},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTrusted",{get:function(){return this._signedIn&&!y.isInIframe()||!!this.outerTokenProvider||s.Configuration.ECS.enableExtendedFrameApiOn.indexOf(document.referrer)>-1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},set:function(e){if(e===u.SigninState.SignedIn&&(this._lastSignedInTimestamp=Date.now()),e!==this._state){this._state=e,this._signedIn=this._state===u.SigninState.SignedIn,this.publish("state",e),this.publish("isSignedIn",this._signedIn);var t=this._onceSingedInPromise.status===l.PromiseStatus.Pending;this._signedIn&&t?this._onceSingedInPromise.resolve():this._state!==u.SigninState.SignedOut||t||(this._onceSingedInPromise=new l.CancelablePromise)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"userIdentityType",{get:function(){return this._userIdentityType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentUsername",{set:function(e){this._userId=e,o.default.get.meId=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentUserName",{get:function(){return this._userId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSignedIn",{get:function(){return this._signedIn},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reloginContext",{get:function(){return this._reloginContext},enumerable:!0,configurable:!0}),t.prototype.checkAuthFailuresCount=function(e){e>=3&&this.clearUserDataFromCache()},t.prototype.setExternalCallbacks=function(e,t){this.externalSuccessCallback=e,this.externalFailureCallback=t,this._state===u.SigninState.SignedIn&&this.callExternalHandler(this.externalSuccessCallback)},t.prototype.getTokenExpirationTime=function(){var e=this.getTokenDataFromCache();return e&&e.expiresAt},t.prototype.sendSignedInTelemetry=function(e,t,n,r){this.currentUsername=e?this._tokenParser.retrieveMeName(e):"",v.swc.Telemetry.sendEvent.signIn(e?200:500,t,n?Date.now()-n:-1,r)},t.prototype.sendSignedOutTelemetry=function(e,t,n){v.swc.Telemetry.sendEvent.signOut(n?500:200,e,t?Date.now()-t:-1,n?"Popup is blocked":void 0)},t.prototype.getRegistrationToken=function(){var e,t=v.swc.services.sessionStorage.getItem(m.SKYPE_REGTOKEN_KEY);if(t)try{e=JSON.parse(t)}catch(e){}return e},t.prototype.getTokenDataFromCache=function(){if(!this._tokenData)try{this._tokenData=JSON.parse(v.swc.services.sessionStorage.getItem(m.SKYPE_TOKEN_KEY))}catch(e){return this.clearUserDataFromCache(),null}return this._tokenData&&(this._tokenData=this.isTokenValid(this._tokenData)?this._tokenData:null),this._tokenData},t.prototype.isTokenValid=function(e){var t=this.getRegistrationToken();return!(t&&!t.value&&t.failureCount>=3)&&(!(e.expiresAt<Date.now())&&(this._userIdentityType===d.IdentityType.SKYPE&&this.activeConversationSdkMode===h.SDKMode.PERSON&&e.isGuest?(this._tokenData=null,this.clearUserDataFromCache(),!1):!(this._userIdentityType===d.IdentityType.GUEST&&this.activeConversationSdkMode===h.SDKMode.BOT&&!e.isGuest)||(this._tokenData=null,this.clearUserDataFromCache(),!1)))},t.prototype.setTokenDataToCache=function(e,t,n){var r=this,i=0;t&&(i=Date.now()+1e3*t,this._tokenRenovationTimeout&&this._tokenRenovationTimeout.reset(),this._tokenRenovationTimeout=new S.FixedTimeout(function(){o.default.get.backend===f.MessagingBackend.TEAMS?(r.teamsTokenPromise=null,r._getSkypeTokenFromAad()):n?r.getGuestToken():r.silentLogin()},1e3*Math.abs(t-60)),this._tokenRenovationTimeout.start()),v.swc.services.sessionStorage.setItem(m.SKYPE_TOKEN_KEY,JSON.stringify({token:e,expiresAt:i,isGuest:n}))},t.prototype.clearUserDataFromCache=function(){this._tokenData=null,v.swc.services.sessionStorage.removeItem(m.SKYPE_TOKEN_KEY),v.swc.services.sessionStorage.removeItem(m.SKYPE_REGTOKEN_KEY),v.swc.services.sessionStorage.removeItem(m.SKYPE_ENDPOINT_ID_KEY),v.swc.services.sessionStorage.removeItem(m.SKYPE_HAS_HISTORY_KEY)},t.prototype.silentLogin=function(){var e=this;if(!this.isSilentLoginEnabled)return Promise.reject("Silent login is disabled");if(this._silentLoginPromise)return this._silentLoginPromise;var t=Date.now();return this._silentLoginPromise=new Promise(function(n,r){var i={client_id:s.Configuration.LOGIN_CLIENT_ID,env:"live",callback:function(i){var o,s=function(r){e.sendSignedInTelemetry(r,"silent",t),e._silentLoginPromise=null,n(r)};try{o=JSON.parse(i.data)}catch(e){o=i.data?i.data:i}o.error?(o.error,"invalid_grant"===o.error&&e.clearUserDataFromCache(),e._failedSilentLoginCount<1&&e.sendSignedInTelemetry(void 0,"silent",t,o.error),e._failedSilentLoginCount++,e._silentLoginPromise=null,r(o.error)):o.token?(e.setTokenDataToCache(o.token,o.expires_in,!1),s(o.token)):o.skypetoken&&(e.setTokenDataToCache(o.skypetoken,o.expires_in,!1),s(o.skypetoken)),r(new Error("Neither token nor skypeToken in the response"))}};v.SKYPE.login.Silent.init(i).load()}),this._silentLoginPromise},t.prototype.callExternalHandler=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(e&&"function"==typeof e)try{e.apply(null,[].slice.call(arguments,1))}catch(e){}},t.prototype.formatError=function(e){var t;return e instanceof Error?t=Object.create(e):"string"==typeof e?t=new Error(e):(t=new Error("Unknown: please check *data* property for more info")).data=e,t.name="SWCApi:signin:"+t.name,t},t.prototype.reset=function(){this.clearUserDataFromCache(),this._signOutContext.reset(),this._guestUserPromise=null,this._silentLoginPromise=null,this._signedIn=!1,this._tokenData=null,this.currentUsername="",this._getTokenPromise&&this._getTokenPromise.status===l.PromiseStatus.Pending&&this._getTokenPromise.cancel(),this._getTokenPromise=null,this._aad=null,this._tokenRenovationTimeout&&(this._tokenRenovationTimeout.reset(),this._tokenRenovationTimeout=null)},t.prototype.isAadSupported=function(){return!!this.outerTokenProvider&&this.tokenType===T.TokenType.Aad},t.prototype.setTeamsUrls=function(e){e&&(s.Configuration.CHAT_HOST_URL=e.chatService+"/v1/",s.Configuration.CHAT_GUEST_HOST_URL=e.chatService+"/v1/",s.Configuration.AMS_HOST_URL=e.ams+"/v1/",s.Configuration.AVATAR_SERVICE_URL=e.mtImageService,s.Configuration.TEAMS_MIDDLE_TIER_URL=e.middleTier)},t.prototype._signInWithAadSkypetokens=function(e,t){void 0===t&&(t=!1),this.setTeamsUrls(e.regionGtms),o.default.get.backend=f.MessagingBackend.TEAMS,this.setTokenDataToCache(e.tokens.skypeToken,e.tokens.expiresIn,t),this.currentUsername=this._tokenParser.retrieveMeName(e.tokens.skypeToken),this.state=e.tokens.skypeToken?u.SigninState.SignedIn:u.SigninState.SignedOut,this._lastAuthSource=c.AuthSource.AAD,this._userIdentityType=d.IdentityType.SKYPE,this.sendSignedInTelemetry(e.tokens.skypeToken,"aad",Date.now())},t.prototype._getSkypeTokenFromAad=function(){var e=this;return this.teamsTokenPromise?this.teamsTokenPromise:this.teamsRemoteTokenExchange?(this.teamsTokenPromise=this.teamsRemoteTokenExchange.tokenProviderCallback().then(function(t){return e._signInWithAadSkypetokens(t),t.tokens.skypeToken}),this.teamsTokenPromise):(this.teamsTokenPromise=new Promise(function(t,n){var r=function(t){e.clearUserDataFromCache(),e.state=u.SigninState.SignedOut,e.sendSignedInTelemetry(null,"aad",Date.now()),n()};e.outerTokenProvider(C.SpacesApi).then(function(n){-1===n.indexOf("Bearer")&&(n="Bearer "+n),g.default.exchangeForSkypeToken(n).then(function(n){n.json?n.json().then(function(n){n.tokens?(e.setTeamsUrls(n.regionGtms),e.setTokenDataToCache(n.tokens.skypeToken,n.tokens.expiresIn,!1),e.currentUsername=e._tokenParser.retrieveMeName(n.tokens.skypeToken),e.state=n.tokens.skypeToken?u.SigninState.SignedIn:u.SigninState.SignedOut,e._lastAuthSource=c.AuthSource.AAD,e._userIdentityType=d.IdentityType.SKYPE,e.sendSignedInTelemetry(n.tokens.skypeToken,"aad",Date.now()),t(n.tokens.skypeToken)):r()},r):r()},r)},function(e){})}),this.getSkypeToken=this._skypeTokenBasedOnAad.bind(this),this.teamsTokenPromise)},t.prototype._skypeTokenBasedOnAad=function(){var e=this;return this.teamsTokenPromise.then(function(t){var n=Date.now()+6e4;return e.getTokenExpirationTime()<=n?(e.teamsTokenPromise=void 0,e._getSkypeTokenFromAad()):t})},t}(p.default);t.default=M},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,s=n(10),a=n(17),c=function(e){function t(){var t=e.call(this)||this;return t._isOnline=navigator.onLine,t.subscribeOnlineHandlers(),t}return i(t,e),Object.defineProperty(t.prototype,"isOnline",{get:function(){return this._isOnline},set:function(e){e!==this._isOnline&&(this._isOnline=e,this.publish("isOnline",e),e&&this._onlinePromise&&this._onlinePromise.status===a.PromiseStatus.Pending&&this._onlinePromise.resolve())},enumerable:!0,configurable:!0}),t.prototype.onceOnline=function(){return this.isOnline?Promise.resolve():(this._onlinePromise&&this._onlinePromise.status===a.PromiseStatus.Pending||(this._onlinePromise=new a.CancelablePromise),this._onlinePromise.promise)},t.prototype.subscribeOnlineHandlers=function(){window.addEventListener("online",this.onlineStatusHandler.bind(this)),window.addEventListener("offline",this.onlineStatusHandler.bind(this))},t.prototype.onlineStatusHandler=function(){this.isOnline=navigator.onLine},t}(s.default);t.get=function(){return o||(o=new c),o}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.OneOnOne="1on1",e.Chat="chat",e.Space="space",e.Topic="topic",e.SfbInterop="sfbinterop",e.SfbInteropChat="sfbinteropchat",e.Meeting="meeting"}(t.ThreadType||(t.ThreadType={})),function(e){e.EventMessage="EventMessage"}(t.EventType||(t.EventType={})),function(e){e.Text="Text",e.RichText="RichText",e.RichTextUriObject="RichText/UriObject",e.RichTextMedia_GenericFile="RichText/Media_GenericFile",e.ControlClearTyping="Control/ClearTyping",e.ControlTyping="Control/Typing",e.ControlLiveState="Control/LiveState",e.SystemMessage="SystemMessage",e.InviteFreeRelationshipChangedInitialized="InviteFreeRelationshipChanged/Initialized",e.SignalFlamingo="Signal/Flamingo",e.RichTextHtml="RichText/Html",e.EventCall="Event/Call"}(t.MessagePayloadType||(t.MessagePayloadType={})),function(e){e.Audio="Audio",e.Video="Video"}(t.PresenceCapabilities||(t.PresenceCapabilities={}))},function(e,t,n){(function(t){var n="Expected a function",r=NaN,i="[object Symbol]",o=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt,l="object"==typeof t&&t&&t.Object===Object&&t,p="object"==typeof self&&self&&self.Object===Object&&self,d=l||p||Function("return this")(),f=Object.prototype.toString,h=Math.max,g=Math.min,m=function(){return d.Date.now()};function v(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function y(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&f.call(e)==i}(e))return r;if(v(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=v(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(o,"");var n=a.test(e);return n||c.test(e)?u(e.slice(2),n?2:8):s.test(e)?r:+e}e.exports=function(e,t,r){var i,o,s,a,c,u,l=0,p=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError(n);function _(t){var n=i,r=o;return i=o=void 0,l=t,a=e.apply(r,n)}function b(e){var n=e-u;return void 0===u||n>=t||n<0||d&&e-l>=s}function S(){var e=m();if(b(e))return T(e);c=setTimeout(S,function(e){var n=t-(e-u);return d?g(n,s-(e-l)):n}(e))}function T(e){return c=void 0,f&&i?_(e):(i=o=void 0,a)}function w(){var e=m(),n=b(e);if(i=arguments,o=this,u=e,n){if(void 0===c)return function(e){return l=e,c=setTimeout(S,t),p?_(e):a}(u);if(d)return c=setTimeout(S,t),_(u)}return void 0===c&&(c=setTimeout(S,t)),a}return t=y(t)||0,v(r)&&(p=!!r.leading,s=(d="maxWait"in r)?h(y(r.maxWait)||0,t):s,f="trailing"in r?!!r.trailing:f),w.cancel=function(){void 0!==c&&clearTimeout(c),l=0,i=u=o=c=void 0},w.flush=function(){return void 0===c?a:T(m())},w}}).call(this,n(24))},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.multilineRegExp=function(e,t){return new RegExp(e.join(""),t)},e.escapeSpecialChars=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},e}();t.default=r},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(10),s=n(0),a=n(28),c=n(4),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isFocused=!0,t.restart=function(){t.dispose(),t._initManagers&&t._initManagers(),t._signInManager.getSkypeToken().then(null,function(){}),s.swc.services.mePersonManager.fetch(),t.restoreLastConversation()},t}return i(t,e),Object.defineProperty(t,"instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.initServices=function(e){t._initParams=e;var n=t._initParams;return s.swc.Eventing.registerEvent(c.ApiEvents.CallStatusChanged,function(e){if(e)switch(e.status){case 2:case 3:case 4:case 9:t._isInCall=!0;break;default:t._isInCall=!1}}),s.swc.services.initManagers(a.LocaleInfo.instance.getLocale(),{tokenProvider:n.skypeTokenProvider||n.tokenProvider,initialToken:n.initialSkypeTokenData,externalLogin:n.externalLogin,tokenType:n.tokenType,enterpriseAuth:n.enterpriseAuth},{fileSharing:n.fileSharing,userSettings:n.userSettings}).then(function(){t.instance.SignInManager,s.swc.services.persons})},t.prototype.dispose=function(){var e;(e=this._mePersonManager)&&(e.dispose(),e=null),this._amsManager&&this._amsManager.dispose(),this._persons&&this._persons.dispose(),this._isCleared=!1},Object.defineProperty(t.prototype,"SignInManager",{get:function(){return this._signInManager||(this._signInManager=s.swc.services.signInManager,this._signInManager&&this._signInManager.subscribe("resurrect",this.restart)),this._signInManager},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCleared",{get:function(){return this._isCleared},set:function(e){e!==this._isCleared&&(this._isCleared=e,this.publish("isCleared",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFocused",{get:function(){return this._isFocused},set:function(e){e!==this._isFocused&&(this._isFocused=e,this.publish("isFocused",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isInCall",{get:function(){return t._isInCall},enumerable:!0,configurable:!0}),t.prototype.setRestoreOfLastConversation=function(e){this._lastConversationCallback=e},t.prototype.restoreLastConversation=function(){this._lastConversationCallback&&this._lastConversationCallback()},t.prototype.setManagersInit=function(e){this._initManagers||(this._initManagers=e)},t._isInCall=!1,t}(o.default);t.default=u},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(110),i=n(111),o=n(14),s=n(112),a=function(){function e(){}return Object.defineProperty(e,"encoder",{get:function(){return e._encoder||(e._encoder=new r.Encoder),this._encoder},enumerable:!0,configurable:!0}),e.INVALID_VALUE="invalidValue",e.filterOutNotValidItems=function(t,n){for(var r=e.mapArray(t,n),i=[],o=0;o<r.length;o++){var s=r[o];s.isValid&&!s.isValid()||i.push(s)}return i},e.filterOutDisabledItems=function(t,n){for(var r=e.mapArray(t,n),i=[],o=0;o<r.length;o++){var s=r[o];s.isDisabled&&s.isDisabled()||i.push(s)}return i},e.getItemIfNotDisabled=function(e){return e.isDisabled&&e.isDisabled()?null:e},e.mapArray=function(e,t){var n=[];if(!e)return n;for(var r=0;r<e.length;r++){var i=e[r];i&&n.push(t(i))}return n},e.mapImages=function(e,t,n,r){var i=[];return e.forEach(function(e){e.url&&i.push(new s.default(e,t,n,r))}),i},e.normalizeText=function(e){return e?o.MessageUtils.getMessageSanitizedContent(e):null},e.normalizeUrl=function(e){return o.MessageUtils.normalizeUrl(e)},e.normalizeDestination=function(t){return/^(skype|tel):/i.test(t)?o.MessageUtils.getMessageSanitizedContent(t):e.INVALID_VALUE},e.normalizeRichText=function(t){if(!t)return"";t=e.encoder.decode(e.encoder.encode(t)),t=o.MessageUtils.unescapeBrackets(t);var n=i.default.parse(t);return o.MessageUtils.getMessageSanitizedContent(n)},e}();t.default=a},function(e,t,n){(function(t){(function(){!function(e){"use strict";if(!e.fetch){var t={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(t.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],r=function(e){return e&&DataView.prototype.isPrototypeOf(e)},i=ArrayBuffer.isView||function(e){return e&&n.indexOf(Object.prototype.toString.call(e))>-1};l.prototype.append=function(e,t){e=a(e),t=c(t);var n=this.map[e];n||(n=[],this.map[e]=n),n.push(t)},l.prototype.delete=function(e){delete this.map[a(e)]},l.prototype.get=function(e){var t=this.map[a(e)];return t?t[0]:null},l.prototype.getAll=function(e){return this.map[a(e)]||[]},l.prototype.has=function(e){return this.map.hasOwnProperty(a(e))},l.prototype.set=function(e,t){this.map[a(e)]=[c(t)]},l.prototype.forEach=function(e,t){Object.getOwnPropertyNames(this.map).forEach(function(n){this.map[n].forEach(function(r){e.call(t,r,n,this)},this)},this)},l.prototype.keys=function(){var e=[];return this.forEach(function(t,n){e.push(n)}),u(e)},l.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),u(e)},l.prototype.entries=function(){var e=[];return this.forEach(function(t,n){e.push([n,t])}),u(e)},t.iterable&&(l.prototype[Symbol.iterator]=l.prototype.entries);var o=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];m.prototype.clone=function(){return new m(this,{body:this._bodyInit})},g.call(m.prototype),g.call(y.prototype),y.prototype.clone=function(){return new y(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new l(this.headers),url:this.url})},y.error=function(){var e=new y(null,{status:0,statusText:""});return e.type="error",e};var s=[301,302,303,307,308];y.redirect=function(e,t){if(-1===s.indexOf(t))throw new RangeError("Invalid status code");return new y(null,{status:t,headers:{location:e}})},e.Headers=l,e.Request=m,e.Response=y,e.fetch=function(e,n){return new Promise(function(r,i){var o=new m(e,n),s=new XMLHttpRequest;s.onload=function(){var e,t,n={status:s.status,statusText:s.statusText,headers:(e=s.getAllResponseHeaders()||"",t=new l,e.split("\r\n").forEach(function(e){var n=e.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();t.append(r,i)}}),t)};n.url="responseURL"in s?s.responseURL:n.headers.get("X-Request-URL");var i="response"in s?s.response:s.responseText;r(new y(i,n))},s.onerror=function(){i(new TypeError("Network request failed"))},s.ontimeout=function(){i(new TypeError("Network request failed"))},s.open(o.method,o.url,!0),"include"===o.credentials&&(s.withCredentials=!0),"responseType"in s&&t.blob&&(s.responseType="blob"),o.headers.forEach(function(e,t){s.setRequestHeader(t,e)}),s.send(void 0===o._bodyInit?null:o._bodyInit)})},e.fetch.polyfill=!0}function a(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function c(e){return"string"!=typeof e&&(e=String(e)),e}function u(e){var n={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return t.iterable&&(n[Symbol.iterator]=function(){return n}),n}function l(e){this.map={},e instanceof l?e.forEach(function(e,t){this.append(t,e)},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function p(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function d(e){return new Promise(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function f(e){var t=new FileReader,n=d(t);return t.readAsArrayBuffer(e),n}function h(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function g(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(t.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(t.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(t.arrayBuffer&&t.blob&&r(e))this._bodyArrayBuffer=h(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!t.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!i(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=h(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},t.blob&&(this.blob=function(){var e=p(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?p(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(f)}),this.text=function(){var e,t,n,r=p(this);if(r)return r;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=d(t),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this.text().then(v)}),this.json=function(){return this.text().then(JSON.parse)},this}function m(e,t){var n,r,i=(t=t||{}).body;if("string"==typeof e)this.url=e;else{if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new l(e.headers)),this.method=e.method,this.mode=e.mode,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new l(t.headers)),this.method=(n=t.method||this.method||"GET",r=n.toUpperCase(),o.indexOf(r)>-1?r:n),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function v(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(i))}}),t}function y(e,t){t||(t={}),this.type="default",this.status="status"in t?t.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new l(t.headers),this.url=t.url||"",this._initBody(e)}}("undefined"!=typeof self?self:this),e.exports=t.fetch}).call(t)}).call(this,n(24))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(22),i={id:"flik",ariaLabelLocKey:"expressionPicker_mruMojiPack_ariaLabel",titleLocKey:"expressionPicker_mruMojiPack_title",mruLimit:10},o=function(){function e(){var e=this;this.CACHE_KEY="swx|pes",this.SAVED_DATA_VERSION="v1.0",this.FEATURED_IN_PREFIX="FeaturedIn-",this.pesCDNAuthentication={skypeServiceHost:"static.asm.skype.com",tokenSourceEndpoint:"/pes/v1/petoken",cdnServiceHost:"static-asm.secure.skypeassets.com",cookieSourceEndpoint:"/token/token_to_cookies",securedPathsPatter:"static[.]asm[.]skype[.]com",cdnTokenTtlMs:3e5,rewriteRules:[{from:"static.asm.skype.com",to:"static-asm.secure.skypeassets.com"},{from:"api.asm.skype.com",to:"static-asm.secure.skypeassets.com"}]},this.itemTypes={typeKeyName:"type",tab:{id:"tab",ariaLabelLocKey:"expressionPicker_mruTab_ariaLabel",titleLocKey:"expressionPicker_mruTab_title"},emoticon:{id:"emoticon",ariaLabelLocKey:"expressionPicker_mruEmoticonPack_ariaLabel",titleLocKey:"expressionPicker_mruEmoticonPack_title",mruLimit:27},moji:i,image:{id:"image"},message:{id:"message"},sticker:{id:"sticker"},flik:i},this.mru={TAB_ID:"mru",PACK_PREFIX:"mru:"},this.bingSearch={TAB_ID:"bing",PACK_PREFIX:"bing:"},this.giphyImageSearch={TAB_ID:"giphyImages",PACK_PREFIX:"giphy-imh:"},this.localSearch={TAB_ID:"localSearch",PACK_PREFIX:"local:",titleLocKey:"expressionPicker_localSearchPack_title",ariaLabelLocKey:"expressionPicker_localSearchPack_ariaLabel"},this.frameHeights={emoticons:{SMALL:20,LARGE:40,EXTRA_LARGE:60,SUPER_LARGE:120},moji:{THUMBNAIL:40,KEYFRAME:80},packs:{TAB:19}},this.profiles={emoticons:{getSmall:function(){return e.highDpi?"default_40_f":"default_20_f"},getLarge:function(){return e.highDpi?"default_80_f":"default_40_f"},getExtraLarge:function(){return e.highDpi?"default_120_f":"default_60_f"},getSuperLarge:function(){return e.highDpi?"default_240_f":"default_120_f"},getSmallAnimated:function(){return e.highDpi?"default_40_anim_f":"default_20_anim_f"},getLargeAnimated:function(){return e.highDpi?"default_80_anim_f":"default_40_anim_f"},getExtraLargeAnimated:function(){return e.highDpi?"default_120_anim_f":"default_60_anim_f"},getSuperLargeAnimated:function(){return e.highDpi?"default_240_anim_f":"default_120_anim_f"}},moji:{thumbnail:"thumbnail",content:"default"}}}return Object.defineProperty(e.prototype,"highDpi",{get:function(){return this._highDpi||(this._highDpi=r.default.getScreenInfo().pixelRatio>1),this._highDpi},enumerable:!0,configurable:!0}),e}();t.default=new o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(9),o={version:"1.0.0.0",urls:["https://config.edge.skype.com"]};t.configLoader=function(e,t,n){return new Promise(function(n,c){var u=function(){var e=r.Configuration.ECS?r.Configuration.ECS.version:o.version;/\d\.\d\.\d/.test(e)||(e=o.version);for(var t=e.split(".",4),n=r.Configuration.getPlatformId();t.length<4;)t.unshift("0");var i=t.join(".");return n?n+"_"+i:i}(),l=a(e,u,t),p=0,d=function(){if(p<l.length){var t=l[p++];s(e,t).then(function(e){return e?n(e):d()}).catch(function(e){var n="Error: "+e+" URL: "+t;i.default.throwError(12001,n),d()})}else{var r="Unable to fetch config from ECS, name: "+e+", urls: "+l;i.default.throwError(12001,r),c(r)}};d()})};var s=function(e,t){return new Promise(function(n,r){var o=encodeURIComponent("jsonSwcEcsFetch"+e+Date.now()),s=document.querySelector("body"),a=document.createElement("script"),c=-1===t.indexOf("?")?"?":"&",u=""+t+c+"callback="+o;a.src=u;var l=function(){delete window[o],s.removeChild(a)};window[o]=function(e){clearTimeout(p),l(),n(e)};var p=setTimeout(function(){l();var e="[configLoader.fetchJson] ECS timed out after 10000 ms, url: "+u;i.default.throwError(12003,"[configLoader.fetchJson] ECS returned values:"+e),r("ECS timed out "+e)},1e4);s.appendChild(a)})},a=function(e,t,n){var r,i,s=[],a=(i=[],r=(r=n)||{},Object.keys(r).forEach(function(e){i.push(encodeURIComponent(e)+"="+encodeURIComponent(r[e]))}),i.join("&"));return o.urls.forEach(function(n){s.push(n+"/config/v1/"+e+"/"+t+(a?"?"+a:""))}),s}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hashCode=function(e){var t=0,n=e.length,r=0;if(n>0)for(;r<n;)t=(t<<5)-t+e.charCodeAt(r++)|0;return t}},,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addGetParamsToUrl=function(e,t){var n=[],r=function(e){if(void 0!==t[e]){var r=encodeURIComponent(e);if(Array.isArray(t[e]))t[e].forEach(function(e){var t=encodeURIComponent(e);n.push(r+"="+t)});else{var i=encodeURIComponent(t[e].toString());n.push(r+"="+i)}}};for(var i in t)r(i);return e+"?"+n.join("&")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=function(e){try{var t=r.swc.services.mePerson.mri;return r.swc.services.webApi.createThread([{id:t,role:"Admin"},{id:e,role:"Admin"}]).then(function(e){return e.headers.get("location").match(/threads\/(19:.*)$/)[1]})}catch(e){}return Promise.resolve(void 0)};t.generateOneToOneConversationId=function(e){try{if(t.isEnterpriseObjectId(e))return function(e){try{var t=r.swc.services.contactsService;if(t.getContactByObjectId)return t.getContactByObjectId(e).then(function(e){return i(e.mri)})}catch(e){}return Promise.resolve(void 0)}(t.getGuidFromEnterpriseObjectId(e));if(t.isEnterpriseUserMri(e))return i(e)}catch(e){}return Promise.resolve(void 0)},t.isEnterpriseUserMri=function(e){return/^8:orgid:[^@]+$/.test(e)},t.isEnterpriseObjectId=function(e){return/^objectId:[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$/.test(e)},t.getGuidFromEnterpriseObjectId=function(e){return e.replace("objectId:","")}},,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.transformRawToXml=function(e,t,n,r){var i=[];for(i.push(t);0!==i.length;){var o=i.pop();o.nodeType===Node.TEXT_NODE?this.encodeTextNodeToXml(e,o,n,r):this.isElementAllowed(o)&&this.pushChildNodes(i,o)}},e.prototype.wordMatcher=function(){return/[\w()#:\-=<>;'\|\$"\]\*\^&\+@\{\?\/\\!~]+/g},e.prototype.getAllWords=function(e){for(var t,n=this.wordMatcher(),r=new Array;null!==(t=n.exec(e));)r.push(t);return r},e.prototype.encodeTextNodeToXml=function(e,t,n,r){var i=t.parentNode,o=this.encodeWords(e,t,n,r);o&&o.length&&(o.forEach(function(e){i.insertBefore(e,t)}),i.removeChild(t))},e.prototype.encodeWords=function(e,t,n,r){var i=this,o=t.nodeValue,s=this.getAllWords(o),a=0,c=[];return s.forEach(function(t){var s=i.wordRawToXml(e,t[0],n,r);0!==s.length&&(a!==t.index&&c.push(e.createTextNode(o.substring(a,t.index))),a=t.index+t[0].length,c=c.concat(s))}),0!==a&&a<o.length&&c.push(e.createTextNode(o.substring(a))),c},e.prototype.pushChildNodes=function(e,t){for(var n=0;n<t.childNodes.length;n++)e.push(t.childNodes[n])},e}();t.WordDomTransformer=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(35),i=function(){function e(){}return e._personIdRegExp=/(\d+:)([\S]*)/,e.normalizePersonId=function(t){var n=t&&t.match(e._personIdRegExp);return n?n[2]:t},e.parsePersonId=function(t){var n=t.match(e._personIdRegExp);return n?{id:n[2],type:parseInt(n[1],0)}:{id:t,type:null}},e.getContactType=function(e){var t=/\d{0,}[^:]/g.exec(e.mri);return t&&t[0]?parseInt(t[0],0):r.ContactType.Undefined},e}();t.default=i},,function(e,t,n){(function(t){var n=1/0,r="[object Symbol]",i=/[&<>"'`]/g,o=RegExp(i.source),s="object"==typeof t&&t&&t.Object===Object&&t,a="object"==typeof self&&self&&self.Object===Object&&self,c=s||a||Function("return this")();var u,l=(u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},function(e){return null==u?void 0:u[e]}),p=Object.prototype.toString,d=c.Symbol,f=d?d.prototype:void 0,h=f?f.toString:void 0;function g(e){if("string"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&p.call(e)==r}(e))return h?h.call(e):"";var t=e+"";return"0"==t&&1/e==-n?"-0":t}e.exports=function(e){var t;return(e=null==(t=e)?"":g(t))&&o.test(e)?e.replace(i,l):e}}).call(this,n(24))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);function i(e){var t=e.definition;return r.swc.Telemetry.createEventProps.conversation(e.id,e.backend,t&&t.TrafficProvider,t&&t.TrafficSource,t&&t.PlatformFeature)}t.createConversationEvent=i,t.createConversationEventFromId=function(e){try{var t=r.swc.services.conversations.getIfExist(e);if(t)return i(t)}catch(e){}return{}}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7);t.getConversationType=function(e){if(0===e.indexOf("http"))return r.ConversationType.JOIN;switch(e.split(":")[0]){case"4":return r.ConversationType.PHONE;case"8":return r.ConversationType.PERSON;case"28":case"99":return r.ConversationType.AGENT;case"19":return r.ConversationType.GROUP;default:return r.ConversationType.UNDEFINED}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(25),o=n(0),s=n(16),a=n(23),c=n(246),u=n(60),l={retryCount:3,timeout:5e4,policy:""},p=function(e,t){void 0===t&&(t={});var n=Object.assign({},t);return c.getHeaders().then(function(t){return n.method=e,n.headers=n.headers||{},Object.assign(n.headers,{ClientInfo:r.Configuration.getChatClientInfo(),Pragma:"no-cache",Expires:0,ContextId:"tcid="+s.guid.generate(),BehaviorOverride:"redirectAs404",Accept:"application/json"},t),n})},d=function(e,t,n,r,i){return void 0===i&&(i=3),429===t.status||500===t.status||503===t.status?0===i?Promise.reject(t):a.default("webapi-"+e,l,n,r).then(function(t){return new Promise(function(o){setTimeout(function(){o(d(e,t,n,r,i-1))},2e3*(3-i+1))})}):Promise.resolve(t)},f=function(e,t,n,r,s,h){return p(t,r).then(function(g){if(!u.getDomain())return o.swc.services.signInManager.logout("services:domain is undefined"),Promise.reject({message:"Domain is undefined"});var m=s?n:u.getDomain()+n;return a.default("webapi-"+e,l,m,g).then(c.handleRegTokenExpiry).catch(function(n){return o.swc.services.signInManager.state===i.SigninState.SignedOut?Promise.reject(n):p(t,r).then(function(t){return a.default("webapi-"+e,l,m,t)})}).then(c.handleRegTokenExpiry).catch(function(e){return Promise.reject(e)}).then(function(s){return o.swc.services.signInManager.state===i.SigninState.SignedOut?Promise.reject(s):p(t,r).then(function(t){return d(e,s,u.getDomain()+n,t)})}).then(c.processHeaders).then(function(i){return u.handle404Redirect(i,function(i){return void 0===i&&(i=n),f(e,t,i,r,s)},h)})})};t.get=function(e,t,n,r,i){return f(e,"GET",t,n,r,i)},t.getWithDomain=function(e,t,n,r){return void 0===r&&(r=!1),f(e,"GET",t,n,!0,r)},t.put=function(e,t,n,r,i){return f(e,"PUT",t,n,r,i)},t.del=function(e,t,n){return f(e,"DELETE",t,n)},t.post=function(e,t,n,r){return f(e,"POST",t,n,r)},t.parseJson=function(e){return e.json().then(function(t){return e.ok?Promise.resolve(t):Promise.reject(t)})},t.reset=function(){c.reset(),u.reset()};var h=n(80);t.addGetParamsToUrl=h.addGetParamsToUrl},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=1048576;t.checkFile=function(e,t){if(!t)return{supportedFileSize:!0,supportedFileExtension:!0,supportedFileType:!0};var n=isNaN(t.size)||e.size/i<=t.size,r=e.name.split("."),o=function(e,t){return!t||!t.length||e&&t.indexOf(e)>-1};return{supportedFileSize:n,supportedFileExtension:o(r.length>1&&"."+r.pop(),t.extensions),supportedFileType:o(e.type,t.types)}},t.isDocumentTypeImage=function(e){return-1!==e.indexOf("image")},t.createImageMessage=function(e,t){var n=r.Configuration.AMS_HOST_URL+"objects/"+t,i=r.Configuration.AMS_HOST_URL+"objects/"+t+"/views/imgt1",o="https://login.skype.com/login/sso?go=webclient.xmm&amp;pic="+t,s=e.name;return['<URIObject type="Picture.1" uri="'+n+'" url_thumbnail="'+i+'">','To view this shared photo, go to: <a href="'+o+'">'+o+"</a>",'<OriginalName v="'+s+'"/><meta type="photo" originalName="'+s+'"/>',"</URIObject>"].join("")},t.createFileMessage=function(e,t){var n=r.Configuration.AMS_HOST_URL+"objects/"+t,i=r.Configuration.AMS_HOST_URL+"objects/"+t+"/views/thumbnail",o="https://login.skype.com/login/sso?go=webclient.xmm&amp;docid="+t,s=e.name;return['<URIObject type="File.1" uri="'+n+'" url_thumbnail="'+i+'">',"<Title>Title: "+s+"</Title>","<Description> Description: "+s+"</Description>",'<a href="'+o+'">'+o+"</a>",'<OriginalName v="'+s+'"/>','<FileSize v="'+e.size+'"/>',"</URIObject>"].join("")},t.getNameAndExtension=function(e){var t=(e||"").split("."),n="",r="";return t.length>1?(r=t.pop().toLowerCase(),n=t.join(".")):(r="",n=t[0]),{name:n,extension:r}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.BUTTON_SEND_CLICK=1]="BUTTON_SEND_CLICK",e[e.KEYPRESS_ENTER=2]="KEYPRESS_ENTER",e[e.WELCOME_MESSAGE=3]="WELCOME_MESSAGE",e[e.TYPING=4]="TYPING",e[e.SUGGESTED_ACTION=5]="SUGGESTED_ACTION",e[e.BUTTON_SWIFT_CLICKED=6]="BUTTON_SWIFT_CLICKED",e[e.INVITE=7]="INVITE",e[e.ADDON=8]="ADDON"}(t.ActionTrigger||(t.ActionTrigger={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.read=0]="read"}(t.Permission||(t.Permission={})),function(e){e[e.Success=1]="Success",e[e.InProgress=2]="InProgress",e[e.ScanInProgress=3]="ScanInProgress",e[e.Failed=4]="Failed",e[e.Malware=5]="Malware"}(t.DocumentStatus||(t.DocumentStatus={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(136),i=n(93),o=n(7),s=n(0),a=n(71),c="https://www.skype.com/",u="width=600, height=620, menubar=no, status=no, titlebar=no, toolbar=no, rel=noopener noreferrer",l=function(){function e(e,t,n){var l=this;switch(this.type=o.SwiftCardActionType.unknown,this.actions={},this.isValid=function(){return!!l.title||!!l.value||!!l.fallbackUri},this.isDisabled=function(){return!1},this.isSupported=function(){return null!==l.type&&l.type!==o.SwiftCardActionType.unknown},this.action=function(){return l.isValid()?l.actions[o.SwiftCardActionType[l.type]]().then(function(){}).catch(function(){}):Promise.resolve()},this.openUrl=function(){return l.value.match(/^skype:\?payments/)||l.value.match(/^skype:/),window.open(l.value,"_blank").opener=null,Promise.resolve()},this.imBack=function(){return l.conversation.sendSwift({title:l.title,value:l.value}).then(function(){return Promise.resolve()}).catch(function(){})},this.showImage=function(){var e=l.value||"";return l.conversation.sendMessage(e,i.ActionTrigger.SUGGESTED_ACTION),Promise.resolve()},this.postBack=function(){return l.conversation.sendSwift({title:l.title,value:l.value,image:l.image}),Promise.resolve()},this.payment=function(){var e=l.fallbackUri?l.fallbackUri:l.value;if(e){var t=window.open(e,"_blank",u);return t&&window.focus&&t.focus(),t.opener=null,Promise.resolve()}},this.convertToActionType=function(e){if(!e)return null;try{switch(e.toLowerCase()){case"unsupported":return o.SwiftCardActionType.unsupported;case"openurl":return o.SwiftCardActionType.openUrl;case"imback":return o.SwiftCardActionType.imBack;case"signin":return o.SwiftCardActionType.signin;case"call":return o.SwiftCardActionType.call;case"showimage":return o.SwiftCardActionType.showImage;case"payment":case"anypayment":return o.SwiftCardActionType.payment;case"postback":return o.SwiftCardActionType.postBack;default:return o.SwiftCardActionType.unknown}}catch(e){return o.SwiftCardActionType.unknown}},this.type=this.convertToActionType(e.type),this.isCallActionType=this.type===o.SwiftCardActionType.call,this.title=a.default.normalizeText(e.title),this.value=e.value?a.default.normalizeUrl(e.value):null,this.senderId=n,this.tooltip=this.title,this.image=e.image?e.image:null,this.fallbackUri=e.fallback&&e.fallback.uri?a.default.normalizeUrl(e.fallback.uri):null,this.actions[o.SwiftCardActionType[o.SwiftCardActionType.call]]=this.call,this.actions[o.SwiftCardActionType[o.SwiftCardActionType.imBack]]=this.imBack,this.actions[o.SwiftCardActionType[o.SwiftCardActionType.postBack]]=this.postBack,this.actions[o.SwiftCardActionType[o.SwiftCardActionType.openUrl]]=this.openUrl,this.actions[o.SwiftCardActionType[o.SwiftCardActionType.showImage]]=this.showImage,this.actions[o.SwiftCardActionType[o.SwiftCardActionType.signin]]=this.openUrl,this.actions[o.SwiftCardActionType[o.SwiftCardActionType.payment]]=this.payment,this.type){case o.SwiftCardActionType.call:this.value=a.default.normalizeDestination(this.value);break;case o.SwiftCardActionType.imBack:if(t.isGroup){var p=this.value,d=n.substring(3),f=function(){var e=new r.MentionDomEncoder,n=e.getMentionUserData(d,t);if(n){var i=e.createXmlElement(document,n).outerHTML;l.value=i+" "+p}};t.participants.filter(function(e){return e.person.id.toLowerCase()===d}).forEach(function(e){e.person.subscribe("displayName",f)}),f()}break;case o.SwiftCardActionType.showImage:this.value&&(this.value=a.default.normalizeUrl(e.value)),this.title||(this.title=s.swc.services.i18n.fetch("s_showImageTitle"));break;case o.SwiftCardActionType.payment:this.value&&(this.value.match(/^skype:\?payments/)?this.value=a.default.normalizeDestination(this.value):this.value=a.default.normalizeUrl(e.value));break;case o.SwiftCardActionType.openUrl:this.value&&(this.value.match(/^skype:/)?this.value=a.default.normalizeDestination(this.value):this.value=a.default.normalizeUrl(e.value),this.tooltip?this.tooltip+="\n\n"+this.value:this.tooltip=this.value);break;case o.SwiftCardActionType.signin:this.value=a.default.normalizeUrl(e.value),this.title||(this.title=s.swc.services.i18n.fetch("s_signInTitle"));break;case o.SwiftCardActionType.unsupported:this.type=o.SwiftCardActionType.openUrl,this.title||(this.title=s.swc.services.i18n.fetch("s_unsupported_button")),this.value||(this.value=c);break;case o.SwiftCardActionType.postBack:this.title=a.default.normalizeText(this.title),this.value=a.default.normalizeText(this.value),this.tooltip||(this.tooltip=this.title)}this.conversation=t}return e.prototype.call=function(){return Promise.reject("Calling is not supported")},e}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2);!function(e){e.Connecting="Skype_Call_Connecting.m4a",e.Dialing="Skype_Call_Dialing.m4a",e.Ended="Skype_Call_Ended.m4a",e.Reconnected="Skype_Call_Reconnected.m4a",e.Ringback="Skype_Call_Ringback.m4a",e.Ringing="Skype_Call_Ringing.m4a",e.Notification="Skype_Notification.m4a",e.Message_Received="Skype_Msg_Received.m4a"}(t.SupportedSounds||(t.SupportedSounds={}));var i=function(){function e(t){var n=[];for(var r in t)t.hasOwnProperty(r)&&n.push(t[r]);this.soundsArr=n.map(e.loadSound)}return e.loadSound=function(t){var n=new Audio(e.getSoundPath(t));return n.preload="auto",{fileName:t,audioObject:n}},e.getSoundPath=function(e){return r.Configuration.ECS.domain+"/assets/sounds/"+e},e.prototype.getSound=function(e){for(var t=0,n=this.soundsArr;t<n.length;t++){var r=n[t];if(r.fileName===e)return r.audioObject}return null},e.prototype.play=function(e,t){var n=this;return void 0===t&&(t=!0),new Promise(function(r){var i=n.getSound(e);null!==i&&(i.loop=t,i.onended=function(){return r()},i.play())})},e.prototype.playOnce=function(e){return this.play(e,!1)},e.prototype.stop=function(e){var t=this.getSound(e);null!==t&&(t.pause(),t.currentTime=0)},e.prototype.stopAll=function(){var e=this;this.soundsArr.forEach(function(t){return e.stop(t.fileName)})},e}();t.SoundPlayer=i},,,,function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return e.call(this)||this}return i(t,e),t.create=function(){var e=Object.create(t.prototype);return e.callbacks=[],e},t.prototype.pushObservable=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.prototype.push.apply(this,t);var r=new s(t);return this.publish(r),this.length},t.prototype.popObservable=function(){var t=e.prototype.pop.call(this);return this.publish(),t},t.prototype.shiftObservable=function(){var t=e.prototype.shift.call(this);return this.publish(),t},t.prototype.unshiftObservable=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.prototype.unshift.apply(this,t);var r=new s(t);return this.publish(r),this.length},t.prototype.sortObservable=function(t){var n=e.prototype.sort.call(this,t);return this.publish(),n},t.prototype.spliceObservable=function(t,n){for(var r,i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];r=n?i?e.prototype.splice.apply(this,[t,n].concat(i)):e.prototype.splice.call(this,t,n):e.prototype.splice.call(this,t);var a=new s([],r);return this.publish(a),r},t.prototype.subscribe=function(e){this.callbacks.push(e)},t.prototype.unsubscribe=function(e){var t=this.callbacks.indexOf(e);t>-1&&this.callbacks.splice(t,1)},t.prototype.dispose=function(){var e=this;this.callbacks.forEach(function(t,n){e.callbacks[n]=null}),this.callbacks=[]},t.prototype.publish=function(e){var t=this;e||(e=new s),this.callbacks.forEach(function(n){n(t,e)})},t}(Array);t.ObservableCollection=o;var s=function(){return function(e,t){void 0===e&&(e=[]),void 0===t&&(t=[]),this.newItems=e,this.oldItems=t}}()},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),a=n(0),c=n(16),u=function(e){function t(t){var n=e.call(this,t)||this;return n.blockClassName="emoticon",n._id=c.guid.generate(),n.state=o({isAnimated:!1,textOnly:!1},n._getNewState(t)),t.setUpdateCallback&&t.setUpdateCallback(function(e){n.setState(function(){return n._getNewState(e)})}),n}return i(t,e),t.prototype._getNewState=function(e){var t=a.swc.services.pesManager.emoticonMap,n=e.emoticonId||this.props.emoticonId,r=e.textContent||this.props.textContent,i=e.title||this.props.title;if(!n||!t.hasOwnProperty(n))return{textOnly:!0,textContent:r};var o={textOnly:!1,textContent:r,title:i,emoticonId:n};return!0===e.isAnimated?o.isAnimated=!0:!1===e.isAnimated&&(o.isAnimated=!1),o},t.prototype.componentDidMount=function(){var e=this;this.setState(function(t,n){return e._getNewState(n)})},t.prototype.componentWillReceiveProps=function(e){var t=this;this.setState(function(n,r){return t._getNewState(e)})},t.prototype.getComposedBlockClassName=function(){var t=e.prototype.getComposedBlockClassName.call(this);return this.props.large&&(t+=" "+this.props.largeEmoticonClass),t},t.prototype.render=function(){if(this.state.textOnly)return s.createElement("span",null,this.state.textContent);var e={"data-item-id":this.state.emoticonId,"data-is-animated":this.state.isAnimated,textContent:this.state.textContent,title:this.state.title};return this.props.large&&["emoticon"].push(this.props.largeEmoticonClass),s.createElement("span",{className:this.getComposedBlockClassName()},s.createElement("canvas",o({},e,{id:this._id}),this.state.textContent))},t}(n(6).SwcBaseComponent);t.SwcEmoticon=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(0),o=function(){function e(e,t,n){var r=this;this._createMessageModel=e,this._generateContent=t,this._subscribedCallbacks={},this.subscribeOnceToPersonsName=function(e){r._subscribedCallbacks[e.id]||(r._subscribedCallbacks[e.id]=r._onDisplayNameChanged.bind(r,e.id),e.subscribe("displayName",r._subscribedCallbacks[e.id]))},this._onDisplayNameChanged=function(e){r._messageModel.content=r._generateContent(r),r._initiator.unsubscribe("displayName",r._subscribedCallbacks[e])},this.getInitiatorFromContent(n.content),this.getTargetsFromContent(n.content),this._messageModel=this._createMessageModel(n,this._generateContent(this),!0)}return e.prototype.isSelfAction=function(){return 1===this._targets.length&&this._targets[0].id===this._initiator.id},e.prototype.getInitiatorFromContent=function(e){var t=e.match(/<initiator>(\d+:.+)<\/initiator>/i);t&&(this._initiator=i.swc.services.persons.getPerson(t[1]))},e.prototype.getTargetsFromContent=function(e){var t=this,n=/(?:<target>|<id>)(\d+:.+?)(?:<\/id>|<\/target>)/i,o=e.match(/<target>.+?<\/target>/gi)||[],s=[];o.forEach(function(e){var t=e.match(n);t&&s.push(t[1])}),this._targets=s.map(function(e){return i.swc.services.persons.getPerson(e,!0)}),r.default.get.isTeams()&&this._targets.length>1&&(this._targets=this._targets.filter(function(e){return e.mri!==t._initiator.mri}))},e}();t.default=o},,,function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Outlook="OUTLOOK",e.Scom="SCOM",e.Office="OFFICE"}(r=t.NotificationSupportedHost||(t.NotificationSupportedHost={})),function(e){e.All="ALL",e.Notification="NOTIFICATION",e.Off="OFF"}(i=t.NotificationAllowedValue||(t.NotificationAllowedValue={})),function(e){e.swc="swc",e.api="api"}(t.NotificationSettingSource||(t.NotificationSettingSource={})),function(e){e.IncomingCall="swc.notification.incoming-call",e.NewMessage="swc.notification.new-message"}(t.NotificationSettingType||(t.NotificationSettingType={})),t.NOTIFICATION_DEFAULT=[{host:r.Outlook,value:i.All},{host:r.Scom,value:i.All},{host:r.Office,value:i.All}]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Calling="calling",e.Messaging="chat",e.Recents="recents"}(t.ModuleType||(t.ModuleType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(108);!function(e){e[e.default=100]="default",e[e.extended=200]="extended"}(t.PAGE_SIZE||(t.PAGE_SIZE={})),t.SYNC_STATE_LINK_REGEX=/syncState=([^&]+)/,t.getPolling=function(){return r.swc.services.polling};var o=function(){function e(){this.resetCallbacks=[],this.allConversations=[],this.syncState="",this.updateConsumptionHorizonToLastMessage=function(e){}}return e.prototype.subscribeConversation=function(e,n,r){return t.getPolling().subscribeConversation(e,n,r)},e.prototype.unsubscribeConversation=function(e){t.getPolling().unsubscribeConversation(e)},e.prototype.subscribeResource=function(e,n){return t.getPolling().subscribeResource(e,n)},e.prototype.unsubscribeResource=function(e){t.getPolling().unsubscribeResource(e)},e.prototype.startEndpointActivation=function(){i.startActivation()},e.prototype.stopEndpointActivation=function(){i.stopActivation()},e.prototype.addResetSubscriber=function(e){e&&this.resetCallbacks.push(e)},e.prototype.reset=function(){return this.allConversations=[],this.syncState="",this.resetCallbacks.forEach(function(e){e()}),r.swc.Telemetry.flushAll(),t.getPolling().reset().then(null,function(){})},e.prototype.getSyncState=function(e){if(!e||!t.SYNC_STATE_LINK_REGEX.test(e))return"";var n=e.match(t.SYNC_STATE_LINK_REGEX);return n?n[1]:""},e}();t.ConversationWebApi=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(5),o=n(25),s=n(29),a=n(11),c=n(38),u=n(0),l=n(62),p=n(107),d=n(91),f=function(){p.getPolling().authorization.then(function(){h()?t.activationRequest().then(function(e){t.stopActivation(),e&&e.ok&&(r=setTimeout(f,12e3))},function(){t.stopActivation()}):t.stopActivation()})};function h(){return u.swc.services.signInManager.userIdentityType===s.IdentityType.SKYPE&&u.swc.services.signInManager.state===o.SigninState.SignedIn&&l.get().isOnline&&i.default.get.backend!==a.MessagingBackend.TEAMS}t.activationRequest=function(){var e=u.swc.services.sessionStorage.getItem(c.SKYPE_ENDPOINT_ID_KEY),t="users/ME/endpoints/"+e+"/active",n={body:JSON.stringify({timeout:15})};return!e&&h()?Promise.reject({}):d.post("active",t,n)},t.startActivation=function(){r||h()&&f()},t.stopActivation=function(){r&&(clearTimeout(r),r=null)},l.get().subscribe("isOnline",function(e){e||t.stopActivation()})},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(87),i=n(11),o=n(0),s=n(253),a=n(5),c=n(254),u=n(149),l=n(255),p=n(136),d=n(257),f=n(258),h={LARGE:"large",EXTRA_LARGE:"extraLarge"},g=3,m=function(e){var t;return(o.swc.services.pesManager.config?o.swc.services.pesManager.config.items:[]).forEach(function(n){t||n.id!==e||(t=n)}),t},v=function(){return function(e,t){var n=this;this.outgoingDomTransformers=[],this.incomingDomTransformers=[],this.encode=function(e,t,i){var o=new DOMParser,s=r(e),a=c.default.addFormatting(s),u=o.parseFromString(a,"text/html");if(0!==u.getElementsByTagName("parsererror").length)return s;try{return n.outgoingDomTransformers.forEach(function(e){try{e.transformRawToXml(u,u.body,t,i)}catch(e){}}),n.convertHtmlDomToXmlString(u)}catch(e){return s}},this.decode=function(e){var t,r,c,u=n;a.default.get.backend===i.MessagingBackend.TEAMS&&(e=s.TeamsMessageUtil.prepare(e));try{var l=n._private.parseXML(n._private.encapsulateInRootElement(e));if(l)return r=l.documentElement,o.swc.services.pesManager.canRenderConfigItems()&&function(e){var n=a.default.get.largeEmoticonClass?h.EXTRA_LARGE:h.LARGE,i=r.getElementsByTagName("ss"),o=[],s=i.length<=g&&i.length>0;if(s){var c=r.childNodes;for(a.default.get.isTeams()&&1===c.length&&"message"===c[0].tagName&&(c=c[0].childNodes),t=0;t<c.length;++t){var l=0===c[t].textContent.replace(" ","").replace(/<br\s*\/?>/g,"").replace(/\n/g,"").length;s=s&&("ss"===c[t].tagName||l)}}var p,d,f=i.length>20;for(t=0;t<i.length;++t){var m=u.emoticonEncoder.createHtmlElement(e,i[t].getAttribute("type"),i[t].textContent,s,f,n);m&&o.push([m,i[t]])}for(t=0;t<o.length;++t)p=o[t][0],(d=o[t][1]).parentNode&&d.parentNode.replaceChild(p,d)}(l),(c=r.getElementsByTagName("e_m"))&&0!==c.length&&c[0].parentNode.removeChild(c[0]),n.incomingDomTransformers.forEach(function(e){try{e.transformRawToXml(l,r)}catch(e){}}),u.emoticonEncoder.fixInvalidHtml(n._private.decapsulateFromRootElement(n._private.xmlToString(l)))}catch(e){}return e},this.convertHtmlDomToXmlString=function(e){for(var t=e.implementation.createDocument(e.body.namespaceURI,"message",null);0!==e.body.childNodes.length;)t.childNodes[0].appendChild(e.body.childNodes[0]);var r=t.childNodes[0].outerHTML;return a.default.get.backend===i.MessagingBackend.TEAMS&&(r=n._translateToTeamsEmoticons(r,e,t)),r.replace(/(?:^<message.*?>|<\/message>$)/g,"")},this._translateToTeamsEmoticons=function(e,t,n){var r=e.match(/<ss[^>]+>[^<]+<\/ss>/g);if(r){var i=r.length===n.firstChild.childNodes.length&&r.length<=g&&r.length>0,s=o.swc.services.pesManager.map;for(var a in r){var c=r[a],u=c.match(/<ss type="([^"]+)">([^<]+)<\/ss>/),l=u[1],p=s[u[2]];p.match(/^\(.*\)$/)||(p="("+p+")");var d=m(l),f=t.implementation.createDocument(t.body.namespaceURI,"emoticon",null),h=f.createElement("span"),v=i?50:20;h.setAttribute("class","animated-emoticon-"+v+"-"+l),h.setAttribute("title",l),h.setAttribute("type",p);var y=f.createElement("img");y.setAttribute("alt",d.description),y.setAttribute("itemid",l),y.setAttribute("itemscope",""),y.setAttribute("itemtype","http://schema.skype.com/Emoji"),y.setAttribute("src","https://statics.teams.microsoft.com/evergreen-assets/funstuff/skype-emoticons-f/"+l+"/default_"+v+".png"),y.setAttribute("style","width:"+v+"px;height:"+v+"px;"),h.appendChild(y),f.childNodes[0].appendChild(h);var _=f.childNodes[0].outerHTML.replace(/(?:^<emoticon.*?>|<\/emoticon>$)/g,"");e="<div><div>"+(e=e.replace(c,_))+"</div></div>"}}return e},this._private={separators:{"   ":!0,"\n":!0,"\r":!0," ":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0,"":!0},createFlagElement:function(e,t,n){var r=e.createElement("span");return r.textContent=n,r.setAttribute("class","flag "+t),r.textContent="(flag:"+t+")",r},encapsulateInRootElement:function(e){for(var t;t!==e;)t=e,e=e.replace(/<\s*?root[\s\S]*?>.*?(<\s*?\/\s*?root\s*?>)?/gi,"");return"<root>"+e+"</root>"},decapsulateFromRootElement:function(e){return e.match(/<root ?\/>/)?"":e.length==="</root>".length?"":e.substring("<root>".length,e.length-"</root>".length)},parseXML:function(e){var t;try{if(o.swcWindow.DOMParser){var n=new DOMParser;n.async=!1,t=n.parseFromString(e,"text/xml")}else{var r=new ActiveXObject("Microsoft.XMLDOM");if(r.async=!1,r.loadXML(e))return r}}catch(e){return null}var i=t.parseError;return i&&0!==i.errorCode?null:t.getElementsByTagName("parsererror").length>0?null:t},xmlToString:function(e){var t;try{t=(new XMLSerializer).serializeToString(e)}catch(n){t=e.xml}return t},xmlEscapeMap:{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&apos;"},escapeXml:function(e){var t=this.xmlEscapeMap;return e.replace(/[<>&"']/g,function(e){return t[e]})},unescapeXml:function(e){var t={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&apos;":"'"};return e.replace(/&lt;|&gt;|&amp;|&quot;|&apos/g,function(e){return t[e]})}},this.emoticonEncoder=new u.default,e?e.forEach(function(e){n.incomingDomTransformers.push(e)}):this.incomingDomTransformers=[new d.NewLineDomTransformer,new l.MentionDomDecoder],t?t.forEach(function(e){n.outgoingDomTransformers.push(e)}):this.outgoingDomTransformers=[new f.URLDomTransformer,new d.NewLineDomTransformer,new p.MentionDomEncoder,this.emoticonEncoder]}}();t.Encoder=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(0),o=function(){function e(){}return Object.defineProperty(e,"Marked",{get:function(){return i.swc.vendors.marked},enumerable:!0,configurable:!0}),Object.defineProperty(e,"renderer",{get:function(){return this._renderer||(this._renderer=new e.Marked.Renderer),this._renderer},enumerable:!0,configurable:!0}),e.parse=function(t,n){return e.Marked.setOptions({renderer:this.renderer,gfm:!0,tables:!1,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!0,smartypants:!1,xhtml:!1}),r.default.get.isTeams()&&(t=t.replace(/<br\/><br\/>/g,"<br/>").replace(/<br\s*\/?>\r\n/g,"  \n")),t=t.replace(/<br\s*\/?><br\s*\/?>/g,"\n\n").replace(/<br\s*\/?>/g,"  \n").replace(/<\/p>\n<p>/g,"\n\n"),t=(t=e.Marked(t).trim()).replace(/(^<p>)|(<\/p>$)/g,"").replace(/<\/p>\n<p>/g,"<br><br />")},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(7),o=n(0),s=n(9),a=n(137),c=n(95),u=n(71),l=function(){return function(e,t,n,l){var p=this;this.url=ko.observable(),this.destinationSize={narrow:{},default:{},carouselDefault:{},carouselNarrow:{}},this.trustedDomains=[r.Configuration.AMS_HOST_URL,r.Configuration.CDN_SERVICE_HOST],this.shouldProcessThroughAMS=function(e){return p._conversation.isSkypeBackend()&&!p.isTrustedUrl(e)},this.processImage=function(e){p.shouldProcessThroughAMS(e)?p.processViaAMS(e).then(function(e){var t=e.url||e.thumbnail,n=e.thumbnail_meta?e.thumbnail_meta:null;n?(p.url(t),p.naturalSize({height:n.height,width:n.width})):p.loadImageSize(u.default.normalizeUrl(t))},function(e){}):p.loadImageSize(p._conversation.isSkypeBackend()?u.default.normalizeUrl(e):e)},this.hasProcessedUrl=function(){return!!p.url()},this.isTrustedUrl=function(e){var t=!1;return p.trustedDomains.forEach(function(n){t=e.indexOf(n)>-1}),t},this.processViaAMS=function(e){var t=r.Configuration.URLP_SERVICE_URL+"/v1/url/info?url=",n=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),i=new RegExp(n,"g"),s=e.indexOf(t)>0?e.replace(i,""):e;return new Promise(function(e){return o.swc.services.amsManager.getPictureThumbnail(t+encodeURIComponent(s)).then(e)})},this.loadImageSize=function(e){var t=new Image;t.onload=function(){p.url(e),p.naturalSize({height:t.naturalHeight,width:t.naturalWidth})},t.onerror=function(e){s.default.throwError(10110,"Unable to load an image",e)},t.src=e},this.getUiSize=function(){var e=a.default.instance.CurrentStyle,t=p.getDestinationSize(p.contentType,e,p.isImageInCarousel()),n=p.naturalSize(),r={height:0,width:0};if(0===n.height||0===n.width||0===t.height)return r;var o=t.width/t.height,s=n.width/n.height;switch(p.contentType){case i.SwiftCardContentType.hero:s<o?(r.width=t.width,r.height=n.height*t.width/n.width,p.bottomAlignment((r.height-t.height)/2)):(r.height=t.height,r.width=n.width*t.height/n.height),p.leftAlignment(r.width/-2);break;case i.SwiftCardContentType.animation:case i.SwiftCardContentType.audio:s<o?(r.width=n.width*t.height/n.height,r.height=n.height*t.height/n.height):(r.height=t.height,r.width=n.width*t.height/n.height);break;case i.SwiftCardContentType.thumb:case i.SwiftCardContentType.actionImage:s<o?(r.height=t.height,r.width=r.height*s):s===o?(r.height=t.height,r.width=n.width*t.height/n.height):(r.width=t.width,r.height=r.width/s),p.bottomAlignment((r.height-t.height)/2),p.leftAlignment(r.width/-2);break;case i.SwiftCardContentType.receipt:s<o?(r.height=t.height,r.width=r.height*s):s===o?(r.height=t.height,r.width=n.width*t.height/n.height):(r.width=t.width,r.height=r.width/s,p.bottomAlignment((r.height-t.height)/2)),p.leftAlignment(r.width/-2);break;case i.SwiftCardContentType.flex:s<=o?(1===s?(r.height=t.height,r.width=t.height):(r.width=n.width*t.height/n.height,r.height=t.height),p.leftAlignment((r.width-t.width)/-2)):(r.height=t.height,r.width=n.width*t.height/n.height,p.leftAlignment((r.width-t.width)/-2))}return r},this.getTitleByType=function(){switch(p.tap.type){case i.SwiftCardActionType.call:case i.SwiftCardActionType.imBack:return p.createImageTitle();case i.SwiftCardActionType.openUrl:return p.createImageTitle()+"\n\n"+p.tap.value;case i.SwiftCardActionType.showImage:return(p.alt?p.alt+" ":"")+p.lowerFirstLetter(p.tap.title)}return""},this.createImageTitle=function(){var e=p.tap.title||"",t=o.swc.services.i18n.fetch("accessibility_swift_action_prefix",{swiftAction:p.lowerFirstLetter(e)});return(p.alt?p.alt+" ":"")+t},this.lowerFirstLetter=function(e){return e?e[0].toLowerCase()+e.substring(1):""},this.getDestinationSize=function(e,t,n){return(t===a.StyleModes.NORMAL?n?p.destinationSize.carouselDefault:p.destinationSize.default:n?p.destinationSize.carouselNarrow:p.destinationSize.narrow)[e]},this._conversation=t,this.destinationSize.narrow[i.SwiftCardContentType.hero]={height:105,width:188},this.destinationSize.default[i.SwiftCardContentType.hero]={height:153,width:272},this.destinationSize.carouselDefault[i.SwiftCardContentType.hero]={height:145,width:270},this.destinationSize.carouselNarrow[i.SwiftCardContentType.hero]={height:105,width:188},this.destinationSize.narrow[i.SwiftCardContentType.thumb]={height:76,width:76},this.destinationSize.default[i.SwiftCardContentType.thumb]={height:112,width:112},this.destinationSize.carouselDefault[i.SwiftCardContentType.thumb]={height:112,width:112},this.destinationSize.carouselNarrow[i.SwiftCardContentType.thumb]={height:76,width:76},this.destinationSize.narrow[i.SwiftCardContentType.receipt]={height:76,width:76},this.destinationSize.default[i.SwiftCardContentType.receipt]={height:112,width:112},this.destinationSize.narrow[i.SwiftCardContentType.animation]={height:105,width:172},this.destinationSize.default[i.SwiftCardContentType.animation]={height:153,width:256},this.destinationSize.carouselDefault[i.SwiftCardContentType.animation]={height:145,width:256},this.destinationSize.carouselNarrow[i.SwiftCardContentType.animation]={height:105,width:172},this.destinationSize.narrow[i.SwiftCardContentType.audio]={height:105,width:172},this.destinationSize.default[i.SwiftCardContentType.audio]={height:145,width:256},this.destinationSize.carouselDefault[i.SwiftCardContentType.audio]={height:145,width:256},this.destinationSize.carouselNarrow[i.SwiftCardContentType.audio]={height:105,width:172},this.destinationSize.default[i.SwiftCardContentType.actionImage]={height:20,width:20},this.destinationSize.narrow[i.SwiftCardContentType.actionImage]={height:16,width:16},this.destinationSize.narrow[i.SwiftCardContentType.flex]={height:105,width:188},this.destinationSize.default[i.SwiftCardContentType.flex]={height:153,width:272},this.destinationSize.carouselDefault[i.SwiftCardContentType.flex]={height:145,width:256},this.destinationSize.carouselNarrow[i.SwiftCardContentType.flex]={height:105,width:188},this.contentType=l,this.alt=u.default.normalizeRichText(e.alt),e.url&&this.processImage(e.url),this.tap=null,e.tap&&(this.tap=u.default.getItemIfNotDisabled(new c.default(e.tap,t,n)),this.tap&&this.tap.type===i.SwiftCardActionType.showImage&&!this.tap.value&&(this.tap.value=this.url())),this.naturalSize=ko.observable({height:0,width:0}),this.uiSize=ko.pureComputed(this.getUiSize.bind(this)),this.isValid=ko.pureComputed(this.hasProcessedUrl),this.bottomAlignment=ko.observable(),this.leftAlignment=ko.observable(),this.isImageInCarousel=ko.observable(!1)}}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i,o=n(5),s=n(45);!function(e){e.Mobile="Mobile",e.Desktop="Desktop",e.Web="Web"}(t.DeviceType||(t.DeviceType={})),function(e){e.Available="Available",e.AvailableIdle="AvailableIdle",e.Busy="Busy",e.BusyIdle="BusyIdle",e.DoNotDisturb="DoNotDisturb",e.BeRightBack="BeRightBack",e.Away="Away",e.Offline="Offline",e.PresenceUnknown="PresenceUnknown"}(r=t.Availability||(t.Availability={})),function(e){e.Available="Available",e.Inactive="Inactive",e.Busy="Busy",e.InMeeting="InAMeeting",e.InCall="InACall",e.InConferenceCall="InAConferenceCall",e.UrgentInterruptionOnly="UrgentInterruptionOnly",e.DoNotDisturb="DoNotDisturb",e.Presenting="Presenting",e.BeRightBack="BeRightBack",e.Away="Away",e.Offwork="Offwork",e.OutOfOffice="OutOfOffice",e.Offline="Offline",e.PresenceUnknown="PresenceUnknown"}(i=t.Activity||(t.Activity={}));var a={};a[r.Available]=[i.Available],a[r.Busy]=[i.Busy],a[r.DoNotDisturb]=[i.DoNotDisturb],a[r.BeRightBack]=[i.BeRightBack],a[r.Away]=[i.Away,i.Offline],t.allowedForcedAvailabilities=[r.Available,r.Busy,r.DoNotDisturb,r.BeRightBack,r.Away],t.isForcedAvailabilityAllowed=function(e){return 1===t.allowedForcedAvailabilities.filter(function(t){return t===e}).length},t.isActivityCombinationAllowed=function(e,t){return!(!a[t]||1!==a[e].filter(function(e){return e===t}).length)},t.getAvailabilityFromStatus=function(e){if(o.default.get.isTeams())switch(e){case s.PresenceStatus.Online:return r.Available;case s.PresenceStatus.Busy:return r.Busy;case s.PresenceStatus.BeRightBack:return r.BeRightBack;case s.PresenceStatus.Away:return r.Away;case s.PresenceStatus.DoNotDisturb:return r.DoNotDisturb;default:return}else switch(e){case s.PresenceStatus.Online:return r.Available;case s.PresenceStatus.Away:return r.Away;case s.PresenceStatus.Busy:return r.Busy;default:return}},t.getStatusFromAvailability=function(e){if(o.default.get.isTeams())switch(e){case r.Available:case r.AvailableIdle:return s.PresenceStatus.Online;case r.Away:return s.PresenceStatus.Away;case r.BeRightBack:return s.PresenceStatus.BeRightBack;case r.DoNotDisturb:return s.PresenceStatus.DoNotDisturb;case r.Busy:case r.BusyIdle:return s.PresenceStatus.Busy;default:return s.PresenceStatus.Offline}else switch(e){case r.Available:case r.AvailableIdle:return s.PresenceStatus.Online;case r.Away:return s.PresenceStatus.Away;case r.BeRightBack:return s.PresenceStatus.BeRightBack;case r.DoNotDisturb:return s.PresenceStatus.DoNotDisturb;case r.Busy:case r.BusyIdle:return s.PresenceStatus.Busy;default:return s.PresenceStatus.Offline}}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(168))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(19);t.reportServiceFault=function(e,t,n){t=t||{};var o=i.NA;t.headers&&"function"==typeof t.headers.get&&(o=t.headers.get("contextid")||t.headers.get("X-Skype-Caller")||t.headers.get("X-Skype-Request-Id")),r.swc.Telemetry.sendEvent.serviceFault(e,t.status,t.statusText||t.message,r.swc.services.isZombie,t.url,o,n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.callback=e,this.timeout=t}return e.prototype.start=function(){this.reset(),this.retryTimeout=setTimeout(this.callback,this.timeout)},e.prototype.reset=function(){this.retryTimeout&&clearTimeout(this.retryTimeout)},e}();t.FixedTimeout=r,t.build=function(e,t){return new r(e,t)}},,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(122),o=function(){function e(e){void 0===e&&(e=[]),this._namespace=e}return e.prototype.createChild=function(t,n){return new e(this._namespace.concat(["string"==typeof t?function(){return t}:t]))},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e&&e.length&&e[0].name&&this.reportEvent(e[0].name,e[0].properties)},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e&&e.length&&e[0].name&&this.reportEvent(e[0].name,e[0].properties)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e&&e.length&&e[0].name&&this.reportEvent(e[0].name,e[0].properties)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.reportError("warn",e),e&&e.length&&e[0].name&&this.reportEvent(e[0].name,e[0].properties)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.reportError("error",e),e&&e.length&&e[0].name&&this.reportEvent(e[0].name,e[0].properties)},Object.defineProperty(e.prototype,"_prefix",{get:function(){return this._namespace.map(function(e){return e()}).join("/")},enumerable:!0,configurable:!0}),e.prototype.reportError=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(t&&0!==t.length)try{r.swc.Telemetry.sendEvent.callingError(this._prefix,t.join("; "),e)}catch(e){}},e.prototype.reportEvent=function(e,t){var n=r.swc.Telemetry.getLogger("trouter"),o=i.createTrouterEvent(e,t);n.logEvent(o)},e}();t.LocalCallingLogger=o},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),o=n(22);t.createTrouterEvent=function(e,t){return{name:e,properties:r({},t,{AppInfo_Version:i.Configuration.getUiVersion(),"DeviceInfo.BrowserName":o.default.getBrowserName(),"DeviceInfo.BrowserVersion":o.default.getBrowserVersion(),"DeviceInfo.OsName":o.default.getOsName(),"DeviceInfo.OsVersion":o.default.getOsVersion(),"DeviceInfo.Id":o.default.getDeviceId().replace(/-/g,""),ua:"SWC"})}}},,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(107));var r=n(108);t.startEndpointActivation=r.startActivation,t.stopEndpointActivation=r.stopActivation},,,,function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(84),s=/(\(|\))/g,a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.isElementAllowed=function(e){return"i"!==e.nodeName.toLowerCase()||-1===e.className.toLowerCase().indexOf("mention")},t.prototype.wordRawToXml=function(e,t,n,r){for(var i,o=[],s=/[\.,_:\-;?]$/,a=t.substring(1),c=this.getMentionUserData(a,n,r);!c&&a.match(s);)i=a.charAt(a.length-1),a=a.substring(0,a.length-1),c=this.getMentionUserData(a,n,r);return c&&(o.push(this.createXmlElement(e,c)),i&&o.push(e.createTextNode(i))),o},t.prototype.getMentionUserData=function(e,t,n){var r,i={defaultDisplayName:"",displayName:"",skypeId:"",type:"",isMePerson:!1};if(!e)return null;var o=0===(e=e.toLowerCase()).indexOf("("),a=o?e.substring(1,e.length-1):"",c=t?t.participants:[];if(i.isMePerson=!!n&&(e===n.id.toLowerCase()||o&&n.displayName.replace(s,"").toLowerCase()===a),i.isMePerson)r=n;else{var u=c.filter(function(t){return t.person.id.toLowerCase()===e||o&&t.person.displayName.replace(s,"").toLowerCase()===a});u.length&&(r=u[0].person)}return r?(i.skypeId=r.id,i.type="28",i.displayName=r.displayName,i.defaultDisplayName||(i.defaultDisplayName=i.displayName),i):null},t.prototype.wordMatcher=function(){return/@([a-z0-9\.,\-_:]+|\(.+?\))/gi},t.prototype.createXmlElement=function(e,t){var n=e.createElement("at");return n.setAttribute("id",t.type+":"+t.skypeId),n.innerText=t.defaultDisplayName,n},t}(o.WordDomTransformer);t.MentionDomEncoder=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(65),o=n(21),s=function(){function e(){var e=this;this.handlers=[],this.dispose=function(){o.default.getWindow().removeEventListener("resize",e.windowResizeHandler)},this.getCurrentStyle=function(){return(e.forcedWidth||o.default.getWindow().innerWidth)<356?r.NARROW:r.NORMAL},this.onResize=function(){e._currentStyle=e.getCurrentStyle();for(var t=0,n=e.handlers;t<n.length;t++){var r=n[t];try{r()}catch(e){}}};this.windowResizeHandler=i(this.onResize,500),o.default.getWindow().addEventListener("resize",this.windowResizeHandler)}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CurrentStyle",{get:function(){return this._currentStyle},enumerable:!0,configurable:!0}),e.prototype.forceWidth=function(e){this.forcedWidth=e,this._currentStyle=this.getCurrentStyle()},e.prototype.addResizeHandler=function(e){-1===this.handlers.indexOf(e)&&this.handlers.push(e)},e.prototype.removeResizeHandler=function(e){var t=this.handlers.indexOf(e);-1!==t&&this.handlers.splice(t,1)},e}();t.default=s,function(e){e[e.NARROW=0]="NARROW",e[e.NORMAL=1]="NORMAL"}(r=t.StyleModes||(t.StyleModes={}))},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),o={isEnabled:!0,pollingInterval:240};t.getConfig=function(){return r({},o,i.Configuration.ECS.presence)}},,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=function(){function e(){}return e.testOrigin=function(t){return e.origin!==t},e.post=function(t,n){try{e.targets[t].target.postMessage(n,e.targets[t].targetDomain)}catch(e){}},e.cast=function(t,n,r,i){var o={name:t,origin:e.origin,payload:n};r?Array.isArray(r)?r.forEach(function(t){return e.post(t,o)}):e.post(r,o):Object.keys(e.targets).forEach(function(t){return i!==e.targets[t].origin&&e.post(t,o)})},e.exists=function(t){return!!e.registry[t]},e.copy=function(t){t&&t.registry&&Object.getOwnPropertyNames(t.registry).forEach(function(n){var r=Object.getOwnPropertyDescriptor(t.registry,n);r&&r.writable&&(e.registry[n]=r.value||e.registry[n])})},e.addTarget=function(t,n,r,i){e.targets[t]=e.targets[t]||{target:i,origin:n,targetDomain:r}},e.removeTarget=function(t){delete e.targets[t]},e.connect=function(t){e.origin=e.origin||t,e.connected||(window.addEventListener("message",e.receiver),e.connected=!0)},e.disconnect=function(){window.removeEventListener("message",e.receiver),e.connected=!1},e.registerEvent=function(t,n){if(t&&n){var r=e.registry;if(r[t]){if(-1!==r[t].indexOf(n))return}else r[t]=[];r[t].push(n)}},e.unregisterEvent=function(t,n){if(t&&n){var r=e.registry;if(r[t]&&r[t].length){var i=r[t].indexOf(n);-1!==i&&r[t].splice(i,1)}}},e.secure=function(){r.swc.secured&&e.castBuffer()},e.castBuffer=function(){for(;e.buffer.length;){var t=e.buffer.pop();e.cast(t.name,t.payload,null,t.origin)}},e.triggerLocalEvent=function(t,n){return e.triggerEvent(t,n,!0,!1)},e.triggerEvent=function(t,n,r,i,o,s){void 0===i&&(i=!0),e.connected&&i&&e.cast(t,n,o,s);var a=!1,c=e.registry;return c[t]&&c[t].forEach(function(e){try{e(n),a=!0}catch(e){}}),a},e.dispose=function(){for(var t in e.registry)e.registry.hasOwnProperty(t)&&delete e.registry[t];e.disconnect()},e.buffer=[],e.targets={},e.receiver=function(t){var n=t.data;n&&n.origin&&e.testOrigin(n.origin)&&n.name&&e.triggerEvent(n.name,n.payload,!0,!0,null,n.origin)},e.registry={},e}();t.default=i},,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){var e=this;this.getDataPart=function(e){var t=e.substring(e.indexOf(".")+1);return t.substring(0,t.indexOf("."))},this.retrieveMeName=function(t){return t&&e.getTokenData(t).skypeid||""},this.getTokenData=function(t){return JSON.parse(atob(e.getDataPart(t)))}}}();t.TokenParser=r},,,,,function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),s=n(1),a=n(0),c=n(101),u=n(84),l=/^\w$/,p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.hasLargeEmoticon=function(e){return/<span(\sxmlns=".*")? class="emoticon\s?\w*\s?(animated)?\s+\w*large"><canvas(\s?(data-[-a-z]*|height|width|id|textcontent)=".*")*?>.*<\/canvas><\/span>/i.test(e)},t.prototype.fixInvalidHtml=function(e){return e.replace(/<canvas((?:\s?(?:data-[-a-z]*|height|width)="[a-z0-9]*")*)\s*\/>/g,"<canvas$1></canvas>")},t.prototype.createHtmlElement=function(e,t,n,r,i,a){var u={large:r,largeEmoticonClass:a,textContent:n,emoticonId:t,isAnimated:!i},l=s.createElement(c.SwcEmoticon,u),p=document.createDocumentFragment();return o.render(l,p),p},t.prototype.isElementAllowed=function(e){return"span"!==e.nodeName.toLowerCase()||-1===e.className.toLowerCase().indexOf("emoticon")},t.prototype.encodeTextNodeToXml=function(t,n,r,i){n.parentNode&&"a"!==n.parentNode.nodeName.toLowerCase()&&e.prototype.encodeTextNodeToXml.call(this,t,n,r,i)},t.prototype.wordRawToXml=function(e,t,n){var r=[],i=0,o=a.swc.services.pesManager.map;if(!a.swc.services.pesManager.canRenderConfigItems()||n&&n.isSfB)return r;for(var s=0;s<t.length;s++){for(var c="",u=-1,l=s+1;l<t.length+1;l++){var p=t.substring(s,l),d=o.hasOwnProperty(p)&&o[p];d&&!this.isWordChar(t[l])&&(c=d,u=l)}c&&(i!==s&&r.push(e.createTextNode(t.substring(i,s))),i=u,r.push(this.createXmlElement(e,c,t.substring(s,u))),s=u-1)}return 0!==i&&i<t.length&&r.push(e.createTextNode(t.substring(i))),r},t.prototype.createXmlElement=function(e,t,n){var r=e.createElement("ss");return r.setAttribute("type",t),r.innerText=n,r},t.prototype.isWordChar=function(e){return l.test(e)},t}(u.WordDomTransformer);t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.implode=function(e){return e.join(",")},e.explode=function(e){return e?e.replace(/\s/g,"").split(","):[]},e.find=function(t,n){return e.explode(t).indexOf(n)>-1},e.add=function(t,n,r){if(!r||!e.find(t,n)){var i=e.explode(t);i.push(n),t=e.implode(i)}return t},e}();t.default=r},,function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(113)),r(n(138))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),s=n(10),a=n(100),c=n(7),u=function(e){function t(t,n){var r=e.call(this)||this;return r.customType=c.CustomMessageType.Custom,r.supportedAnnotations=[],r.type=c.MessageType.UserMessage,r._isDeleted=!1,r._isEdited=!1,r.timestamp=new Date,r.originalTimestamp=r.timestamp,r._payload=n,r._status=c.DeliveryStatus.Pending,r.suggestedActions=a.ObservableCollection.create(),t&&(r.type=c.MessageType.SystemMessage),r.supportedAnnotations.push(o.Configuration.MESSAGE_PROPERTIES.PER_USER.EMOTIONS),r.emotions=a.ObservableCollection.create(),r._files=a.ObservableCollection.create(),r}return i(t,e),Object.defineProperty(t.prototype,"files",{get:function(){return this._files},set:function(e){this._files=e,this.publish("files",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clientMessageId",{get:function(){return this._clientMessageId},set:function(e){this._clientMessageId=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"composeTime",{get:function(){return this._composeTime},set:function(e){e!==this._composeTime&&(this._composeTime=e,this.publish("composeTime",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"content",{get:function(){return this._content},set:function(e){e.indexOf("customDebug"),e!==this._content&&(this._content=e,this.publish("content",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._direction},set:function(e){e!==this._direction&&(this._direction=e,this.publish("direction",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(e){e!==this._id&&(this._id=e,this.publish("id",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageContent",{get:function(){return this._imageContent},set:function(e){e!==this._imageContent&&(this._imageContent=e,this.publish("imageContent",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDeleted",{get:function(){return this._isDeleted},set:function(e){e!==this._isDeleted&&(this._isDeleted=e,this.publish("isDeleted",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isEdited",{get:function(){return this._isEdited},set:function(e){e!==this._isEdited&&(this._isEdited=e,this.publish("isEdited",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFirst",{get:function(){return this._isFirst},set:function(e){e!==this._isFirst&&(this._isFirst=e,this.publish("isFirst",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTranslated",{get:function(){return this._isTranslated},set:function(e){e!==this._isTranslated&&(this._isTranslated=e,this.publish("isTranslated",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this._key},set:function(e){e!==this._key&&(this._key=e,this.publish("key",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"originalTimestamp",{get:function(){return this._originalTimestamp},set:function(e){e!==this._originalTimestamp&&(this._originalTimestamp=e,this.publish("originalTimestamp",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"payload",{get:function(){return this._payload},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"processedContent",{get:function(){return this._processedContent},set:function(e){e!==this._processedContent&&(this._processedContent=e,this.publish("processedContent",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rawMessageType",{get:function(){return this._rawMessageType},set:function(e){this._rawMessageType=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sender",{get:function(){return this._sender},set:function(e){e!==this._sender&&(this._sender=e,this.publish("sender",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"senderId",{get:function(){return this._senderId},set:function(e){e!==this._senderId&&(this._senderId=e,this.publish("senderId",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skypeEditedId",{get:function(){return this._skypeEditedId},set:function(e){e!==this._skypeEditedId&&(this._skypeEditedId=e,this.publish("skypeEditedId",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"status",{get:function(){return this._status},set:function(e){e!==this._status&&(this._status=e,this.publish("status",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"timestamp",{get:function(){return this._timestamp},set:function(e){e!==this._timestamp&&(this._timestamp=e,this.publish("timestamp",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"translation",{get:function(){return this._content},set:function(e){e!==this._translation&&(this._translation=e,this.publish("translation",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){return this._version},set:function(e){e!==this._version&&(this._version=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imdisplayname",{get:function(){return this._imdisplayname},set:function(e){e!==this._imdisplayname&&(this._imdisplayname=e)},enumerable:!0,configurable:!0}),t.prototype.getKey=function(){return this._key||this._skypeEditedId||this._clientMessageId||this._id||"0"},t}(s.default);t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(457),i=n(458),o=n(459),s=n(460),a=n(461),c=n(462),u=function(){return function(e){this.announcer=new r.Announcer(e),this.keyboardNavigation=new o.KeyboardNavigationState(e),this.focusedElement=new i.FocusedElementState(e),this.outline=new s.Outline(e),this.focusDeloser=new a.FocusDeloser(e),this.focusables=new c.Focusables}}();var l,p=((l=window).__abilityHelpers||(l.__abilityHelpers={helpers:new u(l),mainWindow:l}),l.__abilityHelpers),d=p.helpers;t.AbilityHelpers=d,t.setupIFrame=function(e){var t=e.ownerDocument&&e.ownerDocument.defaultView;t&&!t.__abilityHelpers&&(t.__abilityHelpers={helpers:p.helpers,mainWindow:p.mainWindow},i.setupFocusedElementStateInIFrame(p.mainWindow,e),o.setupKeyboardNavigationStateInIFrame(p.mainWindow,e),s.setupOutlineInIFrame(p.mainWindow,e))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),i=n(0),o=n(16),s=n(96),a=function(){function e(e){this.id=o.guid.generate(),this.title="",this.description="",this.sender="",this.avatarUrl="",this.actions=[],this.type=e,this.sound=this._getSoundFile(e)}return e.prototype._getSoundFile=function(e){var t=null;switch(e){case"UnreadMessage":t=s.SupportedSounds.Notification,this.loopSound=!1;break;case"Calling":t=s.SupportedSounds.Ringing,this.loopSound=!0}return t},e.prototype.hide=function(){i.swc.Eventing.triggerEvent(r.ApiEvents.HideNotification,this.id)},e}();t.Notification=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(11),i=n(60),o=n(7),s=n(304),a=n(90),c=n(14),u=n(85);t.UNREAD_TYPES={Text:1,RichText:1,"RichText/UriObject":1,"RichText/Media_GenericFile":1,"Event/Call":1,"Signal/Flamingo":1,"RichText/Html":1};var l=function(){function e(){}return e.getType=function(e){return a.getConversationType(e)},e.getBackend=function(e,t){if(t!==r.MessagingBackend.UNDETERMINED)return t;switch(e.split(":")[0]){case"8":case"28":case"19":t=r.MessagingBackend.SKYPE;break;default:return r.MessagingBackend.UNDETERMINED}return t},e.replaceMapped=function(e,t,n){return n&&(t[n]=""),this.replaceMap(e,t)},e.replaceMap=function(e,t){return Object.keys(t).forEach(function(n){e=e.replace(n,t[n])}),e.trim().replace(/(^,|[ ],|,$)/,"").trim()},e.parseConversationTopic=function(e,t,n){if(void 0===t&&(t={}),void 0===n&&(n=""),n&&t[n]&&delete t[n],!e&&t)return Object.keys(t).map(function(e){return t[e]}).sort().join(", ");if(e){e=this.replaceMapped(e,t,n);var r=u.default.normalizePersonId(n),i={};Object.keys(t).forEach(function(e){i[u.default.normalizePersonId(e)]=t[e]}),e=this.replaceMapped(e,i,r)}return c.MessageUtils.parseTopic(e)||""},e.isConversationReadOnServer=function(e,t){if(!e)return!1;var n=new s.ConsumptionHorizon;n.set(e);var r=t.skypeeditedid||t.clientmessageid||t.messageid||t.id||"0",i=n.lastReadMessageId===r||""===n.lastReadMessageId||n.lastReadMessageId===t.id,o=new Date(t.originalarrivaltime).getTime();t.skypeeditedid&&+t.skypeeditedid>0&&(o=new Date(+t.skypeeditedid).getTime());var a=n.lastReadMessageTimestamp>=o;return i||a},e.isUnread=function(n,r,s,a){if(!a)return!1;if(e.getType(r)===o.ConversationType.PHONE)return!1;if(!t.UNREAD_TYPES[a.messagetype])return!1;if(a.from){var u=i.normalizePersonId(c.MessageUtils.getSenderIdFromUrl(a.from));if(i.normalizePersonId(n)===u)return!1}return!!a.content&&(!s.consumptionhorizon&&"AcceptPendingRecipient"===s.conversationstatus||!e.isConversationReadOnServer(s.consumptionhorizon,a))},e}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.UNDETERMINED=10]="UNDETERMINED",e[e.TEXT=100]="TEXT",e[e.IMAGE=200]="IMAGE",e[e.FILE=300]="FILE",e[e.SWIFT=400]="SWIFT",e[e.TYPING=500]="TYPING",e[e.EMOTICON=600]="EMOTICON",e[e.QUICK_REPLY=700]="QUICK_REPLY",e[e.LIVE_STATE=9999999999]="LIVE_STATE"}(t.MessageType||(t.MessageType={}))},,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.alias=function(t,n,r,i){var o=e.pathToArray(n),s=o.pop(),a=e.build(o,r);return a[s]=i?t:a[s]||t},e.build=function(t,n){var r=n||window;return e.pathToArray(t).forEach(function(e){return r=r[e]=r[e]||{}}),r},e.pathToArray=function(e){return e instanceof Array?e:e.split(".")},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createTelemetryConfigFromEcs=function(e){var t={};return e&&(e.trouterTenantId&&(t.trouter={ingestionKey:e.trouterTenantId}),e.ariaTenantId&&(t.default={ingestionKey:e.ariaTenantId}),e.ariaServicesTenantId&&(t.services={ingestionKey:e.ariaServicesTenantId})),t}},,,,,function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=n(27),a=o.ApiEvents.presenceProxy;t.ME="ME";var c=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.subscriptions={},t.announceUserStatus=function(e){t.subscriptions[e.userId]&&t.subscriptions[e.userId].forEach(function(t){t(e.status)})},t}return i(n,e),n.prototype.init=function(){var e=this;this.reg(a.announceUserStatus,function(t){return e.announceUserStatus(t)})},n.prototype.setMyStatus=function(e){var t=this;return new Promise(function(n,r){var i=function(e){e.status?n():r("Failed to set status"),t.unreg(a.getUserStatusResponse,i)};t.reg(a.setStatusResponse,i),t.exec(a.setStatus,e)})},n.prototype.getMyStatus=function(){var e=this;return new Promise(function(t,n){e.reg(a.getStatusResponse,function(e){t(e)}),e.exec(a.getStatus)})},n.prototype.getStatusList=function(){var e=this;return new Promise(function(t,n){var r=function(n){t(n),e.unreg(a.getStatusListResponse,r)};e.reg(a.getStatusListResponse,r),e.exec(a.getStatusList)})},n.prototype.getUserStatus=function(e){var t=this;return new Promise(function(n,r){var i=function(r){e===r.userId&&(n(r.status),t.unreg(a.getUserStatusResponse,i))};t.reg(a.getUserStatusResponse,i),t.exec(a.getUserStatus,e)})},n.prototype.subscribeToUserStatus=function(e,t){this.subscriptions[e]||(this.subscriptions[e]=[]),this.subscriptions[e].push(t),this.exec(a.subscribeToUserStatus,e)},n.prototype.unsubscribeFromUserStatus=function(e,t){this.subscriptions[e]&&(this.subscriptions[e]=this.subscriptions[e].filter(function(e){return e!==t}),this.exec(a.unsubscribeFromUserStatus,e))},n.prototype.subscribeToMyStatus=function(e){this.subscriptions[t.ME]||(this.subscriptions[t.ME]=[]),this.subscriptions[t.ME].push(e),this.exec(a.subscribeToUserStatus,t.ME)},n}(s.Proxy);t.PresenceProxy=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Skype="skype",e.Aad="aad"}(t.TokenType||(t.TokenType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){var n=this;this.execCallback=function(){if(n._callback){var e=n.reset.bind(n);return n._callback().then(e,e)}return n.reset(),Promise.resolve()},this.reset=function(){n._callback=null,n._toRelogin=!1},this.setContext(e,t)}return e.prototype.setContext=function(e,t){this._toRelogin=e,this._callback=t},Object.defineProperty(e.prototype,"canRelogin",{get:function(){return this._toRelogin},enumerable:!0,configurable:!0}),e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e.Cache=10]="Cache",e[e.SilentLogin=20]="SilentLogin",e[e.Popup=30]="Popup",e[e.Guest=40]="Guest",e[e.UserLogout=50]="UserLogout",e[e.External=60]="External",e[e.WX=70]="WX",e[e.AAD=80]="AAD"}(t.AuthSource||(t.AuthSource={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(23),o={retryCount:3,timeout:12e4,policy:""},s=function(){function e(){}return e.exchangeForSkypeToken=function(e){var t={method:"post",headers:{Authorization:e,"x-ms-client-type":"web","x-ms-user-type":"user"}};return i.default("teams-exchange",o,r.Configuration.TEAMS_AUTH_URL+"/authz",t)},e.fetchGuestTokenForTenant=function(e){var t={method:"post",body:JSON.stringify({tenantId:e})};return i.default("teams-anonymout",o,r.Configuration.TEAMS_AUTH_URL+"/authz/visitor",t)},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(23),o={retryCount:3,timeout:12e4,policy:""};t.getGuestToken=function(e){var t={name:e};return new Promise(function(e,n){(function(e,t,n){var s={};s.method=e,s.body=JSON.stringify(n);var a=new Headers;return a.append("Content-Type","application/json"),a.append("X-Skype-Caller",r.Configuration.getUiVersion()),s.headers=a,i.default("scom-invite",o,r.Configuration.INVITE_HOST_URL+t,s)})("POST","users/guests/lwc",t).then(function(t){t.json().then(function(t){e(t)}).catch(function(e){n(e)})},function(e){n(e)})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.isRelogin=!1}return e.prototype.reset=function(){this.isRelogin=!1,this.signoutPromise=null},e}();t.default=r},function(e,t){!function(){"use strict";var e,t,n,r,i,o,s,a,c,u,l,p,d,f,h,g,m,v,y;void 0===window.SKYPE&&(window.SKYPE={}),window.SKYPE.login=window.SKYPE.login||{},window.SKYPE.login.Silent=(n={qa:"https://a.qa.lw.skype.net",live:"https://a.lw.skype.com"},r=null,i={},o=null,s=null,a="",c=!1,u=!1,l=null,p={env:"live",client_id:null,redirect_uri:null},d=function(e,t){if(null===l&&(l=window.location.host.match(/^(pre|dev|qa).*\.net$/)||document.cookie.indexOf("debug")>-1||window.location.search.indexOf("debug")>-1),l)try{if("object"==typeof t){var n=[];for(var r in t)"skypetoken"===r?n.push(r+": <HIDDEN>"):n.push(r+": "+JSON.stringify(t[r]));e+=" - "+n.join(", ")}else"string"==typeof t&&(e+=" - "+t);e="[silentlogin.js] - "+e}catch(e){}},f=function(e){if(d("Received message from "+e.origin),s&&e.origin===s){var t=e.data;if("string"==typeof e.data)try{t=JSON.parse(e.data)}catch(e){}d("Message data",t);var n=t.state||null;if(a===n){for(var r in window.clearTimeout(o),i={},t)t.hasOwnProperty(r)&&(i[r]=t[r]);g()}else d("State "+n+" doesn't match the last submitted state "+a)}},h=function(){r&&(e.removeChild(r),r=null)},g=function(){d("Calling callback function",i),u=!1,"function"==typeof t&&t(i)},m=function(){h(),(i={}).error="timeout",g()},v=function(){var e=(new Date).getTime(),t=n;a="silentloginsdk_"+e;var r={response_type:"postmessage",client_id:p.client_id,partner:"999",redirect_uri:p.redirect_uri,state:a,_accept:"1.0",_nc:e};return(s=t[p.env]||t.live)+"/login/silent?"+function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}(r)},{init:function(e){if("object"==typeof e)for(var t in(e=e||{}).hasOwnProperty("callback")&&y(e.callback),p)e.hasOwnProperty(t)&&(p[t]=e[t]);return c||(c=!0,window.addEventListener?window.addEventListener("message",f,!1):window.attachEvent("onmessage",f)),this},setCallback:y=function(e){return"function"==typeof e&&(t=e),this},load:function(){if(!u){if(function(){if(!p.client_id)throw"[silentlogin.js] client_id not initialized. Call init() first.";p.redirect_uri||(p.redirect_uri=window.location.protocol+"//"+window.location.host+window.location.pathname)}(),u=!0,!("postMessage"in window&&"object"==typeof JSON&&JSON.parse))return i={error:"unsupported_browser"},void g();var t;window.clearTimeout(o),o=window.setTimeout(m,2e4),t=v(),h(),void 0===e&&(e=document.body||document.head||document.getElementsByTagName("head")[0]),(r=document.createElement("iframe")).frameBorder=0,r.width="1px",r.height="1px",r.style.display="none",r.style.visibility="hidden",r.id="silentLoginFrame"+Math.floor(10*Math.random()+1),r.setAttribute("src",t),e.appendChild(r),d("Created iFrame: "+t)}},getSkypetoken:function(){return i.skypetoken||null},getFullResponse:function(){return i}})}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(176);t.TeamsUserPolicyService=r.TeamsUserPolicyService},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(177),o=n(179),s=function(){function e(e,t){this.aadTokenProvider=e,this.cache=t,this._storedSettings={},this._defaultSettingsService=new i.DefaultUserPolicyService,this._requestPromises={}}return e.prototype.getMessagingPolicy=function(){return this._getSettings("messagingPolicy")},e.prototype.getCallingPolicy=function(){return this._getSettings("callingPolicy")},e.prototype.getUserPolicies=function(){return this._getSettings("policySettings")},e.prototype.getUpgradePolicy=function(){var e=this;if(this._storedUpgradePolicy)return Promise.resolve(this._storedUpgradePolicy);var t=this.cache.get("teamsUpgradePolicy");return t?(this._storedUpgradePolicy=t,Promise.resolve(t)):this._fetchTeamsUpgradePolicy().then(function(t){return e._storedUpgradePolicy=t,e.cache.set("teamsUpgradePolicy",t),t})},e.prototype._getSettings=function(e){var t=this,n=this._getStoredSettings(e);return n?Promise.resolve(n):this._fetchSettings(e).then(function(n){return n?(t._storeSettings(e,n),n):t._getDefaultSettings(e)})},e.prototype._getStoredSettings=function(e){if(!this._storedSettings[e]){var t=this.cache.get(e);t&&(this._storedSettings[e]=t)}return this._storedSettings[e]},e.prototype._storeSettings=function(e,t){this.cache.set(e,t),this._storedSettings[e]=t},e.prototype._fetchSettings=function(e){var t,n=this;if(!this._requestPromises[e]){var i=r.Configuration.TEAMS_PROFILE_URL+"api/mt/amer/beta/users/useraggregatesettings",s=((t={})[e]=!0,t);this._requestPromises[e]=o.post("useraggregatesettings",i,JSON.stringify(s),this.aadTokenProvider).then(function(t){var r=t[e];return delete n._requestPromises[e],r.value}).catch(function(){delete n._requestPromises[e]})}return this._requestPromises[e]},e.prototype._fetchTeamsUpgradePolicy=function(){var e=r.Configuration.TEAMS_PROFILE_URL+"api/mt/amer/beta/me/settings/teamsupgradev2";return o.get("useraggregatesettings",e,this.aadTokenProvider).then(function(e){return e.value})},e.prototype._getDefaultSettings=function(e){return this._defaultSettingsService.getDefaultPolicy(e)},e}();t.TeamsUserPolicyService=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(178),i=function(){function e(){this._defaultPolicy={messagingPolicy:{allowOwnerEditMessage:!1,allowOwnerDeleteMessage:!1,allowUserEditMessage:!1,allowUserDeleteMessage:!1,allowUserChat:!1,allowGiphy:!1,allowUserTranslation:!1,giphyRatingType:r.GiphyRatingType.Strict,allowMemes:!1,allowStickers:!1,readReceiptsEnabledType:r.ReadReceiptsEnabledType.None},callingPolicy:{allowPrivateCalling:!1,allowGroupCalling:!1,allowCallForwarding:!1,allowCallForwardingToPhone:!1,allowCallForwardingToUser:!1,allowCallGroups:!1,allowDelegation:!1,allowVoicemail:"AlwaysDisabled"}}}return e.prototype.getDefaultPolicy=function(e){return this._defaultPolicy[e]},e}();t.DefaultUserPolicyService=i},function(e,t,n){"use strict";var r,i,o,s,a,c,u,l,p,d,f,h;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Strict=0]="Strict",e[e.Moderate=1]="Moderate",e[e.NoRestriction=2]="NoRestriction"}(t.GiphyRatingType||(t.GiphyRatingType={})),function(e){e.Everyone="Everyone",e.None="None",e.UserPreference="UserPreference"}(t.ReadReceiptsEnabledType||(t.ReadReceiptsEnabledType={})),function(e){e[e.Success=0]="Success",e[e.Warning=1]="Warning",e[e.Error=2]="Error"}(r||(r={})),function(e){e[e.Unknown=0]="Unknown",e[e.InvalidArguments=1]="InvalidArguments",e[e.AccessDenied=2]="AccessDenied",e[e.BadRequest=3]="BadRequest",e[e.Forbidden=4]="Forbidden",e[e.GatewayTimeout=5]="GatewayTimeout",e[e.NotFound=6]="NotFound",e[e.SharepointSiteNotExists=7]="SharepointSiteNotExists",e[e.UserNotFound=8]="UserNotFound",e[e.UserNotFoundInSkypeTeam=9]="UserNotFoundInSkypeTeam",e[e.GroupExceededMaxSupportedNestedGroups=10]="GroupExceededMaxSupportedNestedGroups",e[e.GroupExceededMaxSupportedTeamMembers=11]="GroupExceededMaxSupportedTeamMembers",e[e.TeamNotFound=12]="TeamNotFound",e[e.ThreadNotFound=13]="ThreadNotFound",e[e.TeamOwnerNotFound=14]="TeamOwnerNotFound",e[e.TeamGroupIdMissing=15]="TeamGroupIdMissing",e[e.ChannelsRosterFailed=16]="ChannelsRosterFailed",e[e.MaxChannelLimitExceeded=17]="MaxChannelLimitExceeded",e[e.FileDoesNotExist=18]="FileDoesNotExist",e[e.FileLocked=19]="FileLocked",e[e.OneNoteNotAvailable=20]="OneNoteNotAvailable",e[e.GetPersonalSiteUrlError=21]="GetPersonalSiteUrlError",e[e.NotesSectionCreationError=22]="NotesSectionCreationError",e[e.GroupNotesStartedButNotFinishedYet=23]="GroupNotesStartedButNotFinishedYet",e[e.MissingTeamSmtpAddress=24]="MissingTeamSmtpAddress",e[e.UpdateTeamMembershipInExchangeFailed=25]="UpdateTeamMembershipInExchangeFailed",e[e.UpdateTeamMembershipInSkypeFailed=26]="UpdateTeamMembershipInSkypeFailed",e[e.UpdateBotTeamMembershipInSkypeFailed=27]="UpdateBotTeamMembershipInSkypeFailed",e[e.UpdateTeamMembershipFailed=28]="UpdateTeamMembershipFailed",e[e.ChannelThreadNotExist=29]="ChannelThreadNotExist",e[e.ChannelNameAlreadyExist=30]="ChannelNameAlreadyExist",e[e.MaxChannelNameCharacterLimitExceeded=31]="MaxChannelNameCharacterLimitExceeded",e[e.MaxChannelDescriptionCharacterLimitExceeded=32]="MaxChannelDescriptionCharacterLimitExceeded",e[e.MaxTeamNameCharacterLimitExceeded=33]="MaxTeamNameCharacterLimitExceeded",e[e.MaxTeamDescriptionCharacterLimitExceeded=34]="MaxTeamDescriptionCharacterLimitExceeded",e[e.InvalidTeamName=35]="InvalidTeamName",e[e.UserIsNotOwnerToPerformMigration=36]="UserIsNotOwnerToPerformMigration",e[e.GroupHasMoreMemberThanSkypeTeamsSupports=37]="GroupHasMoreMemberThanSkypeTeamsSupports",e[e.InvalidChannelName=38]="InvalidChannelName",e[e.UpdateChannelNameFailed=39]="UpdateChannelNameFailed",e[e.UpdateChannelDescriptionFailed=40]="UpdateChannelDescriptionFailed",e[e.ChannelNameUpdateToTeamThreadFailed=41]="ChannelNameUpdateToTeamThreadFailed",e[e.CreateChannelThreadFailed=42]="CreateChannelThreadFailed",e[e.CreateChatThreadFailed=43]="CreateChatThreadFailed",e[e.NotAbleToGetChannelThreadAfterCreating=44]="NotAbleToGetChannelThreadAfterCreating",e[e.DeleteChannelThreadFailed=45]="DeleteChannelThreadFailed",e[e.UnableToFetchTeamThread=46]="UnableToFetchTeamThread",e[e.GetUnifiedGroupMembersInExchangeFailed=47]="GetUnifiedGroupMembersInExchangeFailed",e[e.NotImplemented=48]="NotImplemented",e[e.CreateTeamInExchangeNotAuthorized=49]="CreateTeamInExchangeNotAuthorized",e[e.CreateTeamInSkypeFailed=50]="CreateTeamInSkypeFailed",e[e.CreateTeamInExchangeFailed=51]="CreateTeamInExchangeFailed",e[e.UnableToGenerateUniqueAlias=52]="UnableToGenerateUniqueAlias",e[e.TeamCreationInProgress=53]="TeamCreationInProgress",e[e.UpdateTeamInSkypeFailed=54]="UpdateTeamInSkypeFailed",e[e.UpdateTeamInExchangeFailed=55]="UpdateTeamInExchangeFailed",e[e.DeleteTeamNotAuthorized=56]="DeleteTeamNotAuthorized",e[e.DeleteTeamFailedChannelNotFound=57]="DeleteTeamFailedChannelNotFound",e[e.DeleteTeamFailedSettingTopicsProperty=58]="DeleteTeamFailedSettingTopicsProperty",e[e.DeleteTeamFailedRemovingInitiator=59]="DeleteTeamFailedRemovingInitiator",e[e.DeletingTeamInExchangeFailed=60]="DeletingTeamInExchangeFailed",e[e.DeletingTeamInSkypeFailed=61]="DeletingTeamInSkypeFailed",e[e.DeletingTeamSettingStatusPropertyFailed=62]="DeletingTeamSettingStatusPropertyFailed",e[e.AadGetUserCallFailed=63]="AadGetUserCallFailed",e[e.AadUserSearchCallFailed=64]="AadUserSearchCallFailed",e[e.AadGroupsSearchCallFailed=65]="AadGroupsSearchCallFailed",e[e.AadGroupMembersCallFailed=66]="AadGroupMembersCallFailed",e[e.AadGetProfilePictureCallFailed=67]="AadGetProfilePictureCallFailed",e[e.ChatProfilePictureCallFailed=68]="ChatProfilePictureCallFailed",e[e.ExchangeGetProfilePictureCallFailed=69]="ExchangeGetProfilePictureCallFailed",e[e.ExchangeSetProfilePictureCallFailed=70]="ExchangeSetProfilePictureCallFailed",e[e.ExchangeFindPeopleCallFailed=71]="ExchangeFindPeopleCallFailed",e[e.ExchangeInvalidLicense=72]="ExchangeInvalidLicense",e[e.ErrorNonExistentMailbox=73]="ErrorNonExistentMailbox",e[e.ExchangeAccessDenied=74]="ExchangeAccessDenied",e[e.ExchangeOrganizationAccessBlocked=75]="ExchangeOrganizationAccessBlocked",e[e.OrgChartGetManagerAadCallFailed=76]="OrgChartGetManagerAadCallFailed",e[e.JsonResponseParsingFailed=77]="JsonResponseParsingFailed",e[e.GetMyPropertiesFailed=78]="GetMyPropertiesFailed",e[e.GetUserPropertiesFailed=79]="GetUserPropertiesFailed",e[e.SetMyPropertyFailed=80]="SetMyPropertyFailed",e[e.ReconcileExchangeTeamStatusInvalid=81]="ReconcileExchangeTeamStatusInvalid",e[e.ReconcileExchangeTeamFailed=82]="ReconcileExchangeTeamFailed",e[e.MaximumTeamMembersLimitReached=83]="MaximumTeamMembersLimitReached",e[e.MaximumTeamOwnersLimitReached=84]="MaximumTeamOwnersLimitReached",e[e.MemberIsNotAdminToPerformOperation=85]="MemberIsNotAdminToPerformOperation",e[e.OperationDeniedAsMemberIsLastMemberInTeam=86]="OperationDeniedAsMemberIsLastMemberInTeam",e[e.OperationDeniedAsMemberIsLastAdminInTeam=87]="OperationDeniedAsMemberIsLastAdminInTeam",e[e.MSGraphRequestThrottled=88]="MSGraphRequestThrottled",e[e.MSGraphGetGroupWithFilterFailed=89]="MSGraphGetGroupWithFilterFailed",e[e.MSGraphGetGroupMembersFailed=90]="MSGraphGetGroupMembersFailed",e[e.MSGraphGetGroupOwnersFailed=91]="MSGraphGetGroupOwnersFailed",e[e.MSGraphAddGroupMemberFailed=92]="MSGraphAddGroupMemberFailed",e[e.MSGraphAddGroupOwnerFailed=93]="MSGraphAddGroupOwnerFailed",e[e.GroupOwnersLimitExceeded=94]="GroupOwnersLimitExceeded",e[e.MSGraphRemoveGroupMemberFailed=95]="MSGraphRemoveGroupMemberFailed",e[e.MSGraphRemoveGroupOwnerFailed=96]="MSGraphRemoveGroupOwnerFailed",e[e.MSGraphGetGroupUsersFailed=97]="MSGraphGetGroupUsersFailed",e[e.ExchangeTeamNotProvisionedGroupIdMissing=98]="ExchangeTeamNotProvisionedGroupIdMissing",e[e.ThreadIsNotSpaceOrTopic=99]="ThreadIsNotSpaceOrTopic",e[e.ThreadUpgradeForTopicThreadFailed=100]="ThreadUpgradeForTopicThreadFailed",e[e.ThreadUpgradeForSpaceThreadFailed=101]="ThreadUpgradeForSpaceThreadFailed",e[e.ThreadUpgradeFailedCalledOnWrongObject=102]="ThreadUpgradeFailedCalledOnWrongObject",e[e.ConversationUpgradeForSpaceThreadFailed=103]="ConversationUpgradeForSpaceThreadFailed",e[e.ConversationUpgradeFailedCalledOnWrongObject=104]="ConversationUpgradeFailedCalledOnWrongObject",e[e.ConversationUpgradeFailedToSetUserSubscriberState=105]="ConversationUpgradeFailedToSetUserSubscriberState",e[e.InvalidUserId=106]="InvalidUserId",e[e.AadGroupCreationLimitExceeded=107]="AadGroupCreationLimitExceeded",e[e.MsGraphReplicationUnavailable=108]="MsGraphReplicationUnavailable",e[e.SkypeTeamCreationFailed=109]="SkypeTeamCreationFailed",e[e.MigratingToSkypeTeamFailed=110]="MigratingToSkypeTeamFailed",e[e.AadGroupDeletionFailed=111]="AadGroupDeletionFailed",e[e.AadGetUserGroupsFailed=112]="AadGetUserGroupsFailed",e[e.AadGetUserGroupsFailedMailboxTemporaryUnavailable=113]="AadGetUserGroupsFailedMailboxTemporaryUnavailable",e[e.AadGetGroupMembersFailed=114]="AadGetGroupMembersFailed",e[e.AadGetGroupOwnersFailed=115]="AadGetGroupOwnersFailed",e[e.AadSmtpAddressMissing=116]="AadSmtpAddressMissing",e[e.GetTeamMembersFailed=117]="GetTeamMembersFailed",e[e.BotNotFound=118]="BotNotFound",e[e.BotsNotSupportedInChannels=119]="BotsNotSupportedInChannels",e[e.UpdateBotRoleNotSupported=120]="UpdateBotRoleNotSupported",e[e.GetPeopleFailed=121]="GetPeopleFailed",e[e.GetSuggestedGroupsFromExchangeFailed=122]="GetSuggestedGroupsFromExchangeFailed",e[e.GetAllGroupsFailed=123]="GetAllGroupsFailed",e[e.FindingGroupsFailed=124]="FindingGroupsFailed",e[e.FeatureDisabled=125]="FeatureDisabled",e[e.SkypeTeamsStoreAreSkypeTeamsFailed=126]="SkypeTeamsStoreAreSkypeTeamsFailed",e[e.ExchangeMailboxTemporaryUnavailable=127]="ExchangeMailboxTemporaryUnavailable",e[e.GetTenantSettingsFailed=128]="GetTenantSettingsFailed",e[e.SetTenantSettingsFailed=129]="SetTenantSettingsFailed",e[e.InvalidEndDateInRecurrence=130]="InvalidEndDateInRecurrence",e[e.InvalidPatternPropertiesInRecurrence=131]="InvalidPatternPropertiesInRecurrence",e[e.MissingCorrectRecurrencePatternObject=132]="MissingCorrectRecurrencePatternObject",e[e.CalendarEventCreationFailedInExchange=133]="CalendarEventCreationFailedInExchange",e[e.CalendarEventDeletionFailedInExchange=134]="CalendarEventDeletionFailedInExchange",e[e.CalendarEventCancellationFailedInExchange=135]="CalendarEventCancellationFailedInExchange",e[e.CalendarEventUpdateFailedInExchange=136]="CalendarEventUpdateFailedInExchange",e[e.InvalidCancelEventRequest=137]="InvalidCancelEventRequest",e[e.CalendarEventRespondFailure=138]="CalendarEventRespondFailure",e[e.SharepointResponseFailure=139]="SharepointResponseFailure",e[e.DeepLinkTypeNotSupported=140]="DeepLinkTypeNotSupported",e[e.DocumentLibraryNotFound=141]="DocumentLibraryNotFound",e[e.DocumentLibrarySettingsNotFound=142]="DocumentLibrarySettingsNotFound",e[e.UserMailboxDoesNotExist=143]="UserMailboxDoesNotExist",e[e.TaskCanceled=144]="TaskCanceled",e[e.CalendarEventNotFound=145]="CalendarEventNotFound",e[e.GetTeamOutgoingWebhooksFailed=146]="GetTeamOutgoingWebhooksFailed",e[e.SetTeamOutgoingWebhooksFailed=147]="SetTeamOutgoingWebhooksFailed",e[e.RemoveTeamOutgoingWebhookFailed=148]="RemoveTeamOutgoingWebhookFailed",e[e.GetOutgoingWebhookConfigurationFailed=149]="GetOutgoingWebhookConfigurationFailed",e[e.SetOutgoingWebhookConfigurationFailed=150]="SetOutgoingWebhookConfigurationFailed",e[e.GetEmailAddressDetailsFailed=151]="GetEmailAddressDetailsFailed",e[e.GetChannelSettingsFailed=152]="GetChannelSettingsFailed",e[e.ProvisionEmailAddressFailed=153]="ProvisionEmailAddressFailed",e[e.EmailAddressAlreadyProvisioned=154]="EmailAddressAlreadyProvisioned",e[e.TeamCachedPropertiesNotFound=155]="TeamCachedPropertiesNotFound",e[e.GetTeamAppEntitlementsFailed=156]="GetTeamAppEntitlementsFailed",e[e.SetTeamAppEntitlementFailed=157]="SetTeamAppEntitlementFailed",e[e.RemoveTeamAppEntitlementFailed=158]="RemoveTeamAppEntitlementFailed",e[e.GetUserAppEntitlementsFailed=159]="GetUserAppEntitlementsFailed",e[e.SetUserAppEntitlementFailed=160]="SetUserAppEntitlementFailed",e[e.RemoveUserAppEntitlementFailed=161]="RemoveUserAppEntitlementFailed",e[e.GetTeamAppDefinitionsFailed=162]="GetTeamAppDefinitionsFailed",e[e.SetTeamAppDefinitionFailed=163]="SetTeamAppDefinitionFailed",e[e.RemoveTeamAppDefinitionFailed=164]="RemoveTeamAppDefinitionFailed",e[e.GetUserAppDefinitionsFailed=165]="GetUserAppDefinitionsFailed",e[e.SetUserAppDefinitionFailed=166]="SetUserAppDefinitionFailed",e[e.RemoveUserAppDefinitionFailed=167]="RemoveUserAppDefinitionFailed",e[e.GetAppDefinitionFailed=168]="GetAppDefinitionFailed",e[e.UserAlreadyExists=169]="UserAlreadyExists",e[e.UserAlreadyExistsInTeam=170]="UserAlreadyExistsInTeam"}(i||(i={})),function(e){e[e.RequiredOutsideScheduleMeeting=0]="RequiredOutsideScheduleMeeting",e[e.NotRequired=1]="NotRequired",e[e.AlwaysRequired=2]="AlwaysRequired"}(o||(o={})),function(e){e[e.Immediate=0]="Immediate",e[e.Simultaneous=1]="Simultaneous"}(s||(s={})),function(e){e[e.Voicemail=0]="Voicemail",e[e.SingleTarget=1]="SingleTarget",e[e.MyDelegates=2]="MyDelegates"}(a||(a={})),function(e){e[e.Regular=0]="Regular",e[e.CallQueue=1]="CallQueue",e[e.CallGroup=2]="CallGroup",e[e.Delegate=3]="Delegate"}(c||(c={})),function(e){e[e.Ring=0]="Ring",e[e.Bop=1]="Bop",e[e.Bounce=2]="Bounce",e[e.Bubbles=3]="Bubbles",e[e.DripDrop=4]="DripDrop",e[e.Eureka=5]="Eureka",e[e.Flutter=6]="Flutter",e[e.HighScore=7]="HighScore",e[e.NextLevel=8]="NextLevel",e[e.Plink=9]="Plink",e[e.RingRing=10]="RingRing",e[e.Ripple=11]="Ripple",e[e.Spacetime=12]="Spacetime",e[e.WishGranted=13]="WishGranted",e[e.Wobble=14]="Wobble"}(u||(u={})),function(e){e[e.Unknown=0]="Unknown",e[e.Online=1]="Online",e[e.OnPrem=2]="OnPrem"}(l||(l={})),function(e){e[e.Unknown=0]="Unknown",e[e.Online=1]="Online",e[e.OnPrem=2]="OnPrem"}(p||(p={})),function(e){e[e.Default=0]="Default",e[e.Immediately=1]="Immediately",e[e.Every10Mins=2]="Every10Mins",e[e.Hourly=3]="Hourly",e[e.EveryEightHours=4]="EveryEightHours",e[e.Daily=5]="Daily",e[e.Never=6]="Never"}(d||(d={})),function(e){e[e.All=0]="All",e[e.CallMentionChats=1]="CallMentionChats",e[e.Off=2]="Off"}(f||(f={})),function(e){e[e.Unknown=0]="Unknown",e[e.Teacher=1]="Teacher",e[e.Student=2]="Student"}(h||(h={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(61),o=n(23),s={retryCount:3,timeout:12e4,policy:""},a=function(e,t,n){return o.default("teamsmiddleware-"+e,s,t,n)};t.post=function(e,n,r,i){return t.getHeaders(i).then(function(t){return a(e,n,{method:"POST",cache:"no-cache",headers:t,body:r}).then(function(e){return e.json()})})},t.get=function(e,n,r){return t.getHeaders(r).then(function(t){return a(e,n,{method:"GET",cache:"no-cache",headers:t}).then(function(e){return e.json()})})},t.getHeaders=function(e){return e(i.AadAudience.SpacesApi).then(function(e){return e=0===e.toLowerCase().indexOf("bearer")?e:"Bearer "+e,new Headers({Authorization:e,"x-skype-client":r.Configuration.getClientVersion(),Accept:"application/json","Content-Type":"application/json"})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.username=e;try{this.storage=window.localStorage}catch(e){}}return e.prototype.isValid=function(e){return e.username===this.username&&e.expiresAt>Date.now()},e.prototype.get=function(e){try{var t=JSON.parse(this.storage.getItem(e));if(t&&this.isValid(t))return t.value;this.storage.removeItem(e)}catch(e){}},e.prototype.set=function(e,t,n){void 0===n&&(n=864e5);var r={username:this.username,expiresAt:Date.now()+n,value:t};try{this.storage.setItem(e,JSON.stringify(r))}catch(e){}},e}();t.LocalCacheStorage=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){this.skypeLogo=n(182),this.iconSkype=n(183),this.iconLogoMicrosoft=n(184),this.iconDock=n(185),this.iconUndock=n(186),this.iconChats=n(187)}}();t.SVG=new r},function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 220 80">\r\n    <path d="M90 57.3v-4.9c.6.5 1.2.9 2 1.3s1.6.7 2.5 1c.9.3 1.7.5 2.6.6.9.1 1.7.2 2.4.2 2.5 0 4.4-.5 5.7-1.4 1.3-.9 1.9-2.3 1.9-4.1 0-1-.2-1.8-.6-2.5-.4-.7-1-1.4-1.7-1.9-.7-.6-1.6-1.1-2.6-1.7-1-.5-2.1-1.1-3.2-1.7-1.2-.6-2.4-1.3-3.4-1.9-1.1-.6-2-1.3-2.8-2.1-.8-.8-1.4-1.6-1.9-2.6s-.7-2.1-.7-3.4c0-1.6.4-3 1.1-4.2.7-1.2 1.6-2.2 2.8-2.9 1.1-.8 2.4-1.3 3.9-1.7 1.5-.4 3-.6 4.5-.6 3.5 0 6 .4 7.6 1.3v4.7c-2.1-1.4-4.7-2.2-8-2.2-.9 0-1.8.1-2.7.3-.9.2-1.7.5-2.4.9s-1.3 1-1.7 1.7c-.4.7-.7 1.5-.7 2.5 0 .9.2 1.7.5 2.3.3.7.8 1.3 1.5 1.8s1.5 1.1 2.4 1.6c.9.5 2 1.1 3.2 1.7 1.3.6 2.5 1.3 3.6 2s2.1 1.5 3 2.3c.9.8 1.5 1.8 2 2.8.5 1 .7 2.2.7 3.5 0 1.7-.3 3.2-1 4.4-.7 1.2-1.6 2.2-2.7 2.9-1.2.8-2.5 1.3-4 1.6-1.5.3-3.1.5-4.8.5-.6 0-1.2 0-2.1-.1-.8-.1-1.7-.2-2.5-.4s-1.7-.4-2.4-.6c-1-.4-1.6-.7-2-1m45.7 1.4H130l-11-12.1h-.1v12.1h-4.1V21.3h4.1V45h.1l10.5-11.6h5.3l-11.7 12.2zm23.7-25.3l-11.5 29.3c-2.1 5.2-5 7.8-8.7 7.8-1 0-1.9-.1-2.6-.3v-3.6c.9.3 1.7.4 2.4.4 2 0 3.5-1.2 4.6-3.6l2-4.8-9.8-25.2h4.5l6.8 19.4c.1.2.3.9.5 1.9h.1c.1-.4.2-1 .5-1.9l7.1-19.5h4.1zm6.3 11.5v3.5c0 2.1.7 3.9 2 5.3 1.4 1.5 3.1 2.2 5.1 2.2 2.4 0 4.3-.9 5.7-2.8 1.4-1.9 2.1-4.5 2.1-7.8 0-2.8-.6-5-1.9-6.6-1.3-1.6-3-2.4-5.2-2.4-2.3 0-4.2.8-5.6 2.5-1.5 1.5-2.2 3.6-2.2 6.1m.1 10.1l-.1 15.3h-4V33.4h4v4.4h.1c2-3.4 4.9-5 8.7-5 3.2 0 5.8 1.1 7.6 3.4 1.8 2.3 2.7 5.3 2.7 9.1 0 4.2-1 7.6-3.1 10.1-2 2.5-4.8 3.8-8.4 3.8-3.2.1-5.8-1.3-7.5-4.2M205 43.7c0-2.3-.6-4.2-1.7-5.5-1.1-1.3-2.6-1.9-4.6-1.9-1.9 0-3.5.7-4.8 2-1.3 1.4-2.1 3.1-2.5 5.4H205zm4.1 3.4h-17.7c.1 2.8.8 5 2.3 6.5 1.4 1.5 3.4 2.3 5.9 2.3 2.8 0 5.4-.9 7.8-2.8v3.8c-2.2 1.6-5.1 2.4-8.8 2.4-3.5 0-6.3-1.1-8.4-3.4-2-2.3-3-5.5-3-9.7 0-3.9 1.1-7.1 3.3-9.6 2.2-2.5 5-3.7 8.3-3.7 3.3 0 5.8 1.1 7.6 3.2 1.8 2.1 2.7 5.1 2.7 8.9v2.1zM41.4 59.2c-10.1 0-14.7-5.1-14.7-8.9 0-1.9 1.5-3.3 3.5-3.3 4.3 0 3.2 6.5 11.3 6.5 4.1 0 6.5-2.5 6.5-4.8 0-1.4-.8-3-3.5-3.6l-9-2.3C28.3 41 27 36.9 27 33.2c0-7.7 7.1-10.5 13.8-10.5 6.2 0 13.6 3.4 13.6 8.1 0 2-1.7 3.1-3.6 3.1-3.7 0-3.1-5.2-10.5-5.2-3.7 0-5.6 1.7-5.6 4.1 0 2.4 2.9 3.2 5.4 3.8l6.6 1.5c7.3 1.6 9.2 5.9 9.2 10 0 6.2-4.9 11.1-14.5 11.1m27.9-13.4c.3-1.6.4-3.3.4-5C69.7 25 57 12.2 41.3 12.2c-1.7 0-3.3.1-4.9.4-2.5-1.4-5.3-2.2-8.4-2.2-9.3 0-16.9 7.6-16.9 17 0 3.1.8 5.9 2.2 8.4-.3 1.6-.4 3.3-.4 5 0 15.8 12.7 28.6 28.4 28.6 1.7 0 3.3-.1 4.9-.4 2.5 1.4 5.3 2.2 8.4 2.2 9.3 0 16.9-7.6 16.9-17 0-3-.8-5.9-2.2-8.4"/>\r\n</svg>\r\n'},function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" class="icon logo" viewBox="0 0 200 200">\r\n    <path d="M1933 623 Q1933 519 1892.5 426.5 Q1852 334 1783 265 Q1714 196 1621.5 155.5 Q1529 115 1425 115 Q1360 115 1298 131 Q1236 147 1179 179 Q1100 165 1024 165 Q906 165 796.5 196 Q687 227 591.5 283 Q496 339 417.5 417.5 Q339 496 283 591.5 Q227 687 196 796.5 Q165 906 165 1024 Q165 1100 179 1179 Q147 1236 131 1298 Q115 1360 115 1425 Q115 1529 155.5 1621.5 Q196 1714 265 1783 Q334 1852 426.5 1892.5 Q519 1933 623 1933 Q688 1933 750 1917 Q812 1901 869 1869 Q948 1883 1024 1883 Q1142 1883 1251.5 1852 Q1361 1821 1456.5 1765 Q1552 1709 1630.5 1630.5 Q1709 1552 1765 1456.5 Q1821 1361 1852 1251.5 Q1883 1142 1883 1024 Q1883 948 1869 869 Q1901 812 1917 750 Q1933 688 1933 623 Z M1462 807 Q1462 885 1434.5 938.5 Q1407 992 1362 1027 Q1317 1062 1259.5 1083 Q1202 1104 1141.5 1118 Q1081 1132 1023.5 1142.5 Q966 1153 921 1167.5 Q876 1182 848.5 1204.5 Q821 1227 821 1264 Q821 1298 837.5 1321.5 Q854 1345 879.5 1359.5 Q905 1374 935.5 1380.5 Q966 1387 994 1387 Q1044 1387 1080 1375.5 Q1116 1364 1143 1347 Q1170 1330 1190.5 1309.5 Q1211 1289 1229.5 1272 Q1248 1255 1266.5 1243.5 Q1285 1232 1309 1232 Q1329 1232 1349 1238.5 Q1369 1245 1384.5 1257 Q1400 1269 1409.5 1286.5 Q1419 1304 1419 1326 Q1419 1368 1398 1402 Q1377 1436 1342.5 1463 Q1308 1490 1264.5 1510 Q1221 1530 1175.5 1543 Q1130 1556 1086.5 1562.5 Q1043 1569 1010 1569 Q936 1569 861 1552 Q786 1535 725.5 1497 Q665 1459 627 1398.5 Q589 1338 589 1251 Q589 1175 616 1124 Q643 1073 687.5 1039 Q732 1005 789 985 Q846 965 905 950.5 Q964 936 1021 924.5 Q1078 913 1122.5 896.5 Q1167 880 1194 855 Q1221 830 1221 790 Q1221 754 1202 728 Q1183 702 1154.5 685.5 Q1126 669 1092 661 Q1058 653 1028 653 Q972 653 933 667 Q894 681 866 702 Q838 723 817.5 747 Q797 771 778 792 Q759 813 738 827 Q717 841 688 841 Q667 841 649 833.5 Q631 826 617 812.5 Q603 799 595 781 Q587 763 587 742 Q587 692 609 653 Q631 614 666.5 585 Q702 556 748.5 536 Q795 516 844 503.5 Q893 491 941 485.5 Q989 480 1028 480 Q1106 480 1183.5 497 Q1261 514 1323 552.5 Q1385 591 1423.5 653.5 Q1462 716 1462 807 Z " transform="scale(0.1, -0.1) translate(0, -2000)"/>\r\n</svg>\r\n'},function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200">\r\n    <path d="M2048 1087 L1087 1087 L1087 2048 L2048 2048 L2048 1087 Z M961 1087 L0 1087 L0 2048 L961 2048 L961 1087 Z M2048 0 L1087 0 L1087 961 L2048 961 L2048 0 Z M961 0 L0 0 L0 961 L961 961 L961 0 Z " transform="scale(0.1, -0.1) translate(0, -2000)"/>\r\n</svg>\r\n'},function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" class="dock" viewBox="0 0 34 34">\r\n    <g fill="white" fill-rule="nonzero">\r\n        <path d="M24.8 9.2c-.1-.1-.3-.3-.5-.4-.2-.1-.4-.1-.7-.1H2c-.2 0-.5 0-.7.1-.1.1-.3.2-.5.4s-.3.3-.4.5c-.1.2-.1.4-.1.7V32c0 .5.2.9.5 1.2.3.3.7.5 1.2.5h21.6c.2 0 .5 0 .7-.1.2-.1.4-.2.5-.4.1-.2.3-.3.4-.5.1-.2.1-.4.1-.7V10.3c0-.2 0-.5-.1-.7-.1-.2-.2-.3-.4-.4zM22 13.7v16.7H3.7V12H22v1.7zM26.9.3h1.7V2h-1.7zM17 .3h1.7V2H17zM20.3.3H22V2h-1.7zM23.6.3h1.7V2h-1.7zM13.7 3.7h1.7v1.7h-1.7zM15.3 2V.3h-.2c-.4 0-.7.1-1 .4-.3.3-.4.6-.4 1V2h1.6zM32 2V.3h-1.7V2H32v1.7h1.7V2M32 5.3h1.7V7H32zM32 8.7h1.7v1.7H32zM32 12h1.7v1.6H32zM32 15.3h1.7V17H32zM28.7 18.7h1.7v1.7h-1.7zM32 18.7v1.7h.2c.4 0 .7-.1 1-.4.3-.3.4-.6.4-1v-.2H32v-.1z"/>\r\n    </g>\r\n</svg>\r\n'},function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" class="undock" viewBox="0 0 24 24">\r\n    <g fill="none" fill-rule="evenodd">\r\n        <path stroke="white" stroke-linecap="square" stroke-width="1" d="M5 5h14M5 19h14M19 5v14M5 5v14"/>\r\n        <path fill="white" stroke="white" stroke-linecap="square" stroke-width="1" d="M12 11h7v7h-7z"/>\r\n    </g>\r\n</svg>\r\n'},function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 91 83">\r\n\t<path fill-rule="evenodd" d="M17 52v13l11-11v8L11 79V58H0V1h80v23h-6V6H6v46h11zm17-23h57v40H80v15L64 69H34V29zm51 34V35H40v28h27l7 8v-8h11z"/>\r\n</svg>\r\n'},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getLastItemFromArray=function(e,t){return e&&e.length>0?e[e.length-1]:t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(5),o=n(11),s=n(38),a=n(0),c=!1,u=function(e){return{value:null,expiry:null,failureCount:e.value?e.failureCount+1||1:e.failureCount||0}};t.handleRegTokenExpiry=function(e){var t=403===e.status&&(!e.headers||"Quarantine limit Exceeded"!==e.headers.get("StatusText")),n=401===e.status;return t||n?(r=u(r),a.swc.services.sessionStorage.setItem(s.SKYPE_REGTOKEN_KEY,JSON.stringify(r)),a.swc.services.signInManager.checkAuthFailuresCount(r.failureCount),Promise.reject(e)):Promise.resolve(e)},t.handleSkypeTokenExpiry=function(e){return 401===e.status?(a.swc.services.signInManager.logout("services:401"),Promise.reject(e)):Promise.resolve(e)},t.processHeaders=function(e){var t=e.headers.get("set-registrationtoken");if(t){var n=t.match(/registrationToken=(.+); expires=(\d+)/);n&&(r.value=n[1],r.expiry=parseInt(n[2],10),r.expiry<1e10&&(r.expiry*=1e3),delete r.failureCount,a.swc.services.sessionStorage.setItem(s.SKYPE_REGTOKEN_KEY,JSON.stringify(r)))}return e},t.getHeaders=function(){c&&r.expiry<Date.now()&&(r=u(r));var e={};i.default.get.backend===o.MessagingBackend.TEAMS&&(e["x-ms-user-type"]="user",e["x-ms-client-type"]="web");var t=function(){return r.value?(e.RegistrationToken="registrationToken="+r.value,Promise.resolve(e)):new Promise(function(t,n){a.swc.services.signInManager.getSkypeToken().then(function(n){e.Authentication="skypetoken="+n,t(e)},function(){return n()})})};return c?t():a.swc.services.signInManager.onceSignedIn().then(function(){return function(){var e,t=null;if(!r){try{t=a.swc.services.sessionStorage.getItem(s.SKYPE_REGTOKEN_KEY)}catch(e){}if(t)try{e=JSON.parse(t)}catch(e){}r=e&&e.value&&e.expiry?e:{value:null,expiry:null}}c=!0}(),t()})},t.reset=function(){r={value:null,expiry:null}}},,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prepare=function(e){return e=(e=e.replace(/&nbsp;/g," ").replace(/<div( itemprop="copy-paste-block")?>/g,"").replace(/<\/div>/g,"").trim()).replace(/<span[^>]*type="(\([a-z]+\))"[^>]*><img[^>]*itemid="(\w+)"[^>]*><\/span>/g,'<ss type="$2">$1</ss>')},e}();t.TeamsMessageUtil=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.addFormatting=function(t){return t=e.addFormattingTags(t,"s",/(\s|^|_|\*|i>|b>|s>)~((?!~\s).)*~(\s|$|_|\*|<)/gi,"~")},e.addFormattingTags=function(t,n,r,i){for(var o=t.match(r);o&&o.length>0&&2!==o[0].trim().length;)o.forEach(function(r){var o=r.trim(),s=(o=o.substring(o.indexOf(i),o.lastIndexOf(i)+1)).substr(1,o.length-2);s=e.createStartTag(n,i)+s+e.createEndTag(n),t=t.replace(o,s)}),o=t.match(r);return t},e.createStartTag=function(e,t){return"<"+e+' raw_pre="'+t+'" raw_post="'+t+'">'},e.createEndTag=function(e){return"</"+e+">"},e}();t.default=r},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.isElementAllowed=function(e){return"i"!==e.nodeName.toLowerCase()||-1===e.className.toLowerCase().indexOf("mention")},t.prototype.xmlNodeToHtml=function(e,t){if("at"===t.nodeName.toLowerCase()&&t.attributes.getNamedItem("id")){var n=e.createElement("i");return n.setAttribute("class","mention"),n.setAttribute("title",t.attributes.getNamedItem("id").value),n.textContent=t.textContent,[n]}return[]},t}(n(256).DomTransformerBase);t.MentionDomDecoder=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.transformRawToXml=function(e,t,n,r){var i=[];for(i.push(t);0!==i.length;){var o=i.pop();this.encodeTextNodeToXml(e,o,n,r)&&o.nodeType!==Node.TEXT_NODE&&this.isElementAllowed(o)&&this.pushChildNodes(i,o)}},e.prototype.encodeTextNodeToXml=function(e,t,n,r){var i=t.parentNode,o=this.xmlNodeToHtml(e,t,n,r);if(!o||!o.length)return!0;for(var s=0;s<o.length;s++)i.insertBefore(o[s],t);return i.removeChild(t),!1},e.prototype.pushChildNodes=function(e,t){for(var n=0;n<t.childNodes.length;n++)e.push(t.childNodes[n])},e}();t.DomTransformerBase=r},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.isElementAllowed=function(e){return"pre"!==e.nodeName.toLowerCase()},t.prototype.wordRawToXml=function(e,t){return[s(e)]},t.prototype.getAllWords=function(e){for(var t,n=/\r?\n/g,r=new Array;null!==(t=n.exec(e));)r.push(t);return r},t}(n(84).WordDomTransformer);function s(e){return e.createElement("br")}t.NewLineDomTransformer=o},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.isElementAllowed=function(e){return"a"!==e.nodeName.toLowerCase()},t.prototype.wordRawToXml=function(e,t){var n,r=t.match(/^(?:https?:\/\/|mailto:)(.+)$/i),i=r&&r[0],o=i;return i||(i=(r=t.match(/^[^@]+@(?:\w+(?:\.\w+)+)$/i))&&"mailto:"+r[0],o=r&&r[0]),i||(r=t.match(/^(?:www(?:\.\w+){1,}\.(?:com|org|net|edu|gov|mil|aero|arpa|asia|biz|cat|coop|info|int|jobs|mobi|museum|name|pro|tel|travel|[a-z]{2,3}))$/i))&&r[0]&&(n=r.input?r.input.split("?")[1]:"",i="https://"+r[0],o=i=n?i+"?"+n:i),i?[s(e,i,o)]:[]},t.prototype.wordMatcher=function(){return/\S+/g},t}(n(84).WordDomTransformer);function s(e,t,n){var r=e.createElement("a");return r.setAttribute("href",t),r.setAttribute("title",t),r.setAttribute("target","_blank"),r.setAttribute("tabindex","-1"),r.innerText=n,r}t.URLDomTransformer=o},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),s=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i.actionType=o.SwiftCardActionType.unknown,i.originalPayload=t,i.actionType=t.type,i.image=t.image||t.image_url||null,i}return i(t,e),t}(n(95).default);t.default=s},,function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Element=0]="Element",e[e.Document=1]="Document",e[e.Window=2]="Window"}(r=t.EventFromIFrameDescriptorType||(t.EventFromIFrameDescriptorType={})),t.setupIFrameToMainWindowEventsDispatcher=function(e,t,n,i){var o=t.ownerDocument,s=o&&o.defaultView;if(!o||!s||s===e)throw new Error("setupIFrameToMainWindowEventsDispatcher() is called on a wrong element.");i.forEach(function(i){switch(i.type){case r.Element:t.addEventListener(i.name,a,i.capture);break;case r.Document:o.addEventListener(i.name,a,i.capture);break;case r.Window:s.addEventListener(i.name,a,i.capture)}function a(t){var r=document.createEvent("HTMLEvents");r.initEvent(n,!0,!0),r.originalEvent=t,r.targetDetails={descriptor:i,target:t.target,document:o,window:s},e.dispatchEvent(r)}})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(23),o=n(468),s={retryCount:3,timeout:12e4,policy:""};t.request=function(e,t,n){var o=0===t.indexOf("http")?t:r.Configuration.AMS_HOST_URL+t;return i.default("ams-"+e,s,o,n)},t.putData=function(e,n,r){return o.getHeaders().then(function(i){var o={method:"PUT"};return o.body=r,o.headers=i,t.request(e,n,o)})},t.getData=function(e,n){return o.getHeaders().then(function(r){r.append("Accept","image/webp,image/*,*/*;q=0.8"),r.append("Accept-Encoding","gzip, deflate, sdch, br");var i={method:"GET"};return i.headers=r,t.request(e,n,i).then(function(e){return e.blob()})})},t.getJson=function(e,n){return o.getHeaders().then(function(r){r.append("Accept","image/webp,image/*,*/*;q=0.8"),r.append("Accept-Encoding","gzip, deflate, sdch, br");var i={method:"GET"};return i.headers=r,t.request(e,n,i).then(function(e){return e.json()})})},t.post=function(e,n,r){return o.getHeaders().then(function(i){i.append("Content-Type","application/json");var o={method:"POST"};return o.body=r,o.headers=i,t.request(e,n,o)})},t.postForm=function(e,n,r){return o.getHeaders().then(function(i){i.append("Content-Type","application/x-www-form-urlencoded");var o={method:"POST"};return o.headers=i,o.credentials="include",r&&(o.body=r),t.request(e,n,o)})},t.get=function(e,n){return o.getHeaders().then(function(r){r.append("Content-Type","application/json");var i={method:"GET"};return i.headers=r,t.request(e,n,i)})},t.parseJson=function(e){return e.json().then(function(t){return e.ok?Promise.resolve(t):Promise.reject(t)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.maxLength=16,t.minLength=2,t.firstLetters="8:(B;|I]>+xX<*\\",t.firstLettersMap={8:"8",":":":","(":"(",B:"B",";":";","|":"|",I:"I","]":"]",">":">","+":"+",x:"x",X:"X","<":"<","*":"*","\\":"\\"},t.clearShortcutMap=function(){t.shortcutIdMap={}},t.idEmoticonMap={},t.shortcutIdMap={":)":"smile",":-)":"smile",":=)":"smile","(smile)":"smile",":(":"sad",":-(":"sad",":=(":"sad","(sad)":"sad",":<":"sad",":-<":"sad",":D":"laugh",":-D":"laugh",":=D":"laugh",":d":"laugh",":-d":"laugh",":=d":"laugh","(laugh)":"laugh",":>":"laugh",":->":"laugh","(lol)":"laugh","(LOL)":"laugh","(cool)":"cool","8-)":"cool","8=)":"cool","B-)":"cool","B=)":"cool",":O":"surprised",":-O":"surprised",":=O":"surprised",":o":"surprised",":-o":"surprised",":=o":"surprised","(surprised)":"surprised",";)":"wink",";-)":"wink",";=)":"wink","(wink)":"wink",";(":"cry",";-(":"cry",";=(":"cry","(cry)":"cry",":'(":"cry","(:|":"sweat","(sweat)":"sweat",":|":"speechless",":-|":"speechless",":=|":"speechless","(speechless)":"speechless","(kiss)":"kiss",":*":"kiss",":-*":"kiss",":=*":"kiss","(xo)":"kiss","(K)":"kiss","(k)":"kiss",":P":"tongueout",":-P":"tongueout",":=P":"tongueout",":p":"tongueout",":-p":"tongueout",":=p":"tongueout","(tongueout)":"tongueout",":$":"blush",":-$":"blush",":=$":"blush",':">':"blush","(blush)":"blush",":^)":"wonder","(wonder)":"wonder","|-)":"sleepy","I-)":"sleepy","I=)":"sleepy","(snooze)":"sleepy","|-(":"dull","|(":"dull","|=(":"dull","(dull)":"dull","(inlove)":"inlove","(love)":"inlove",":]":"inlove",":-]":"inlove","]:)":"eg",">:)":"eg","(grin)":"eg","(yn)":"fingerscrossed","(fingers)":"fingerscrossed","(fingerscrossed)":"fingerscrossed","(crossedfingers)":"fingerscrossed","(yawn)":"yawn","(puke)":"puke",":&":"puke",":-&":"puke",":=&":"puke","+o(":"puke","(doh)":"doh","(angry)":"angry",":@":"angry",":-@":"angry",":=@":"angry","x(":"angry","x-(":"angry","X(":"angry","X-(":"angry","x=(":"angry","X=(":"angry",";@":"angry",";-@":"angry","(wasntme)":"wasntme","(wm)":"wasntme","(party)":"party","<O)":"party","<o)":"party","<:o)":"party","(worry)":"worry",":S":"worry",":s":"worry",":-s":"worry",":-S":"worry",":=s":"worry",":=S":"worry","(mm)":"mmm","(mmm)":"mmm","(mmmm)":"mmm","(nerd)":"nerdy","8-|":"nerdy","B-|":"nerdy","8|":"nerdy","B|":"nerdy","8=|":"nerdy","B=|":"nerdy",":x":"lipssealed",":-x":"lipssealed",":X":"lipssealed",":-X":"lipssealed",":#":"lipssealed",":-#":"lipssealed",":=x":"lipssealed",":=X":"lipssealed",":=#":"lipssealed","(wave)":"hi","(hi)":"hi","(bye)":"hi","(BYE)":"hi","(Bye)":"hi","(Hi)":"hi","(HI)":"hi","(facepalm)":"facepalm","(fail)":"facepalm","(devil)":"devil","(6)":"devil","(angel)":"angel","(A)":"angel","(a)":"angel","(envy)":"envy","(V)":"envy","(v)":"envy","(wait)":"wait","(hug)":"hug","(bear)":"hug","(makeup)":"makeup","(kate)":"makeup","(chuckle)":"giggle","(giggle)":"giggle","(clap)":"clap","(think)":"think",":-?":"think",":?":"think",":=?":"think","*-)":"think","(bow)":"bow","(rofl)":"rofl","(rotfl)":"rofl","(whew)":"whew","(phew)":"whew","(happy)":"happy","(smirk)":"smirk","(nod)":"nod","(shake)":"shake","(waiting)":"waiting","(forever)":"waiting","(impatience)":"waiting","(emo)":"emo","(y)":"yes","(Y)":"yes","(ok)":"yes","(yes)":"yes","(OK)":"yes","(oK)":"yes","(Ok)":"yes","(n)":"no","(N)":"no","(no)":"no","(handshake)":"handshake","(highfive)":"highfive","(hifive)":"highfive","(h5)":"highfive","(heart)":"heart","(h)":"heart","(H)":"heart","(l)":"heart","(L)":"heart","<3":"heart","(lalala)":"lalala","(lalalala)":"lalala","(lala)":"lalala","(notlistening)":"lalala","(heidy)":"heidy","(squirrel)":"heidy","(F)":"flower","(f)":"flower","(flower)":"flower","(rain)":"rain","(london)":"rain","(st)":"rain","(ST)":"rain","(St)":"rain","(sun)":"sun","(#)":"sun","(tumbleweed)":"tumbleweed","(music)":"music","(8)":"music","(bandit)":"bandit","(tmi)":"tmi","(coffee)":"coffee","(c)":"coffee","(C)":"coffee","(pi)":"pizza","(pizza)":"pizza","(cash)":"cash","(mo)":"cash","($)":"cash","(flex)":"muscle","(muscle)":"muscle","(^)":"cake","(cake)":"cake","(beer)":"beer","(bricklayers)":"beer","(B)":"beer","(b)":"beer","(d)":"drink","(D)":"drink","(drink)":"drink","\\o/":"dance","\\:D/":"dance","\\:d/":"dance","(dance)":"dance","(ninja)":"ninja","(J)":"ninja","(j)":"ninja","(*)":"star","(star)":"star","(headbang)":"headbang","(banghead)":"headbang","(swear)":"swear","(drunk)":"drunk","(finger)":"finger","(poolparty)":"poolparty","(hrv)":"poolparty","(rock)":"rock","(smoking)":"smoke","(smoke)":"smoke","(ci)":"smoke","(bug)":"bug","(toivo)":"toivo","(wfh)":"wfh","(@h)":"wfh","(@H)":"wfh","(hollest)":"hollest","(zilmer)":"priidu","(e)":"mail","(m)":"mail","(mail)":"mail","(E)":"mail","(o)":"time","(O)":"time","(time)":"time","(clock)":"time","(0)":"time","(~)":"movie","(film)":"movie","(movie)":"movie","(mp)":"phone","(ph)":"phone","(phone)":"phone","(talk)":"talk","(call)":"call","(T)":"call","(t)":"call","(punch)":"punch","*|":"punch","*-|":"punch","(skype)":"skype","(ss)":"skype","(u)":"brokenheart","(U)":"brokenheart","(brokenheart)":"brokenheart","(mooning)":"mooning","(oliver)":"oliver","(bartlett)":"bertlett","(football)":"bertlett","(soccer)":"bertlett","(so)":"bertlett","(talktothehand)":"talktothehand","(idea)":"idea",":i":"idea",":I":"idea","*-:)":"idea","(sheep)":"sheep","(bah)":"sheep","(cat)":"cat",":3":"cat","(@)":"cat","(meow)":"cat","(bike)":"bike","(bicycle)":"bike","(sander)":"bike","(dog)":"dog",":o3":"dog","(&)":"dog"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(15),i=n(73),o={small:"getSmall",large:"getLarge",extraLarge:"getExtraLarge",superLarge:"getSuperLarge"};t.buildEmoticonUrl=function(e,n,s,a){var c=e+"/"+n.id+"/views/";c=t.rewriteUrls(c,i.default.pesCDNAuthentication.rewriteRules);var u=o[s]+(a?"Animated":"");return r.UrlHelper.setQueryParameters(c+i.default.profiles.emoticons[u](),{etag:n.etag})},t.rewriteUrls=function(e,t){if("string"!=typeof e)return e;var n,r=e;for(n in t)if(-1!==n.search(n.from)){r=r.replace(n.from,n.to);break}return r}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(10),s=n(7),a=function(e){function t(t,n){var r=e.call(this)||this;return r._isTyping=!1,r._person=t,r._role=n&&n.role?n.role:s.ParticipantRole.User,r._capabilities=n&&n.capabilities?n.capabilities:[],r}return i(t,e),Object.defineProperty(t.prototype,"person",{get:function(){return this._person},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"role",{get:function(){return this._role},set:function(e){e!==this._role&&(this._role=e,this.publish("role",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"capabilities",{get:function(){return this._capabilities},set:function(e){e!==this._capabilities&&(this._capabilities=e,this.publish("capabilities",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTyping",{get:function(){return this._isTyping},set:function(e){if(this._isTyping=e,this.publish("isTyping",e),this._typingIndicatorTimoutId&&clearTimeout(this._typingIndicatorTimoutId),e){var t=this;this._typingIndicatorTimoutId=setTimeout(function(){t.isTyping=!1,t._typingIndicatorTimoutId=void 0},5e3)}},enumerable:!0,configurable:!0}),t}(o.default);t.default=a},,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(154);t.AbilityHelpers=r.AbilityHelpers,t.setupIFrame=r.setupIFrame},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._callbacks=[]}return e.prototype.dispose=function(){this._callbacks=[]},e.prototype.subscribe=function(e){this._callbacks.indexOf(e)<0&&this._callbacks.push(e)},e.prototype.unsubscribe=function(e){var t=this._callbacks.indexOf(e);t>=0&&this._callbacks.splice(t,1)},e.prototype.setVal=function(e,t){this._val!==e&&(this._val=e,this._callCallbacks(e,t))},e.prototype.getVal=function(){return this._val},e.prototype._callCallbacks=function(e,t){this._callbacks.forEach(function(n){return n(e,t)})},e}();t.Subscribable=r},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(10),s=n(94),a=n(88),c=n(0),u=function(e){function t(t){var n=e.call(this)||this;return n._amsService=t,n._authenticated=!1,n._cache={},n._uploads={},n}return i(t,e),t.prototype.downloadFileByDocumentId=function(e){var t=this;return this.authenticate().then(function(){return t._amsService.downloadFile(e)})},t.prototype.downloadRawFile=function(e){return Promise.reject("Not supported")},t.prototype.authenticate=function(){return this._authenticated?Promise.resolve():(this._authenticated=!0,this._amsService.authenticate())},t.prototype.sendFile=function(e,t){var n=this,r=Date.now().toString();this._uploads[r]=s.DocumentStatus.InProgress;var i=this.createAmsDocument(e,t),o=i.then(function(e){return{documentId:e.id}}),a=i.then(function(r){return n.uploadFileContent(e,r.id,t)}).catch(function(){n._uploads[r]=s.DocumentStatus.Failed});return e.sendFile({file:t,clientMessageId:r,uploadPromise:a,registerPromise:o})},t.prototype.createAmsDocument=function(e,t){var n=this;return this.authenticate().then(function(){return n._amsService.createNewDocument(e.id,t)})},t.prototype.retryFileUpload=function(e,t){var n=this._cache[t];return n?this.uploadFileContent(e,t,n):Promise.reject(null)},t.prototype.uploadFileContent=function(e,t,n){var r=this,i=Date.now();return this._cache[t]=n,this._amsService.sendFile(t,n).then(function(o){return delete r._cache[t],c.swc.Telemetry.sendEvent.fileUpload(n,Date.now()-i,o.status,a.createConversationEvent(e)),o})},t.prototype.getFileStatus=function(e){var t=this._uploads[e];return t?Promise.resolve({uploadStatus:t}):this._amsService.getFileStatus(e)},t.prototype.downloadPictureThumbnail=function(e){var t=this;return this.authenticate().then(function(){return t._amsService.downloadPictureThumbnail(e)})},t.prototype.getPictureThumbnail=function(e){var t=this;return this.authenticate().then(function(){return t._amsService.getPictureThumbnail(e)})},t.prototype.downloadPicture=function(e){var t=this;return this.authenticate().then(function(){return t._amsService.downloadPicture(e)})},t.prototype.dispose=function(){this._authenticated=!1,this._cache=null},t}(o.default);t.SkypeAmsManager=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(22),o=function(){function e(){}return e.prototype.getCommonCapabilities=function(e){var t=e.CanUploadFile,n=e.DisableSendingEmoticons,o=i.default.testSupporedList(r.Configuration.ECS.callingSupportedBrowsers)&&e.EnableCalling;return Promise.resolve({allowEditMessage:!0,allowDeleteMessage:!0,allowChat:!0,allowUploadFiles:t,allowSendEmoticons:!n&&r.Configuration.ECS.expressionPickerEnabled,allowCalling:o})},e.prototype.getCapabilitiesForConversation=function(e){return this.getCommonCapabilities(e.definition).then(function(t){var n=e.isWithMe(),r=e.isChatEnabled,i=e.isUnderQuarantine,o=!n&&r&&!i,s=t.allowCalling&&!n;return{allowEditMessage:o&&t.allowEditMessage,allowDeleteMessage:o&&t.allowDeleteMessage,allowChat:o&&t.allowChat,allowUploadFiles:o&&t.allowUploadFiles,allowSendEmoticons:t.allowSendEmoticons,allowCalling:s}})},e}();t.SkypeCapabilitiesService=o},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(132),s=n(5),a=n(2),c=n(17),u=n(11),l=n(9),p=n(14),d=n(7),f=n(13),h=n(107),g=n(91),m=n(60),v={"8:echo123":!0},y=["Online","Busy","Away","Hidden"],_=function(){return o.getPolling()},b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._createConsumptionHorizon=function(e){var t=e.skypeeditedid||e.clientmessageid||e.id||"0";return new Date(e.originalarrivaltime).getTime()+";"+(new Date).getTime()+";"+t},t._createConsumptionHorizonFromProcessedMessage=function(e){var t=e.skypeEditedId||e.clientMessageId||e.id||"0";return e.originalTimestamp.getTime()+";"+(new Date).getTime()+";"+t},t.updateConsumptionHorizonToLastMessage=function(e){if(null!==e.lastMessage){var n=t._createConsumptionHorizonFromProcessedMessage(e.lastMessage);t.updateConsumptionHorizon(e.id,n).then(function(){e.updateConsumptionHorizon(n)})}},t.markAllConversationsAsRead=function(){var e=t.recents();Object.keys(e).forEach(function(n){e[n].isUnread&&t.updateConsumptionHorizonToLastMessage(e[n])})},t.markConversationAsUnread=function(e,n){var r=function(n){var r=t._createConsumptionHorizon(n);t.updateConsumptionHorizon(e,r)};n?r(n):t.fetchMessages(e).then(function(e){var t=e.messages;if(!(t.length<=1)){var n=t.filter(function(e){return m.normalizePersonId(p.MessageUtils.getSenderIdFromUrl(e.from))!==f.ServicesManager.signInManager.currentUserName}).sort(function(e,t){return t.originalarrivaltime>e.originalarrivaltime?-1:1});r(n[n.length-2])}})},t.markConversationAsRead=function(e){t.updateConsumptionHorizonToLastMessage(t.recents()[e])},t.fetchMessagesByLink=function(e){return e=e.substring(e.indexOf("users/ME/conversations/")),_().authorization.then(function(){return g.get("fetchMessagesByLink",e).then(function(e){return g.parseJson(e)})},console.warn)},t.sendDataToBot=function(e,t){var n="agents/"+e+"/invoke";return g.post("invoke",n,{body:JSON.stringify(t)}).then(function(e){return g.parseJson(e).then(void 0,console.warn).catch(function(e){})})},t.getMyPresence=function(){return _().authorization.then(function(){return g.get("getPresence","users/ME/presenceDocs/messagingService?view=expanded").then(function(e){return e.ok||e.json?e.json():null})})},t}return i(t,e),t.prototype.recents=function(){return f.ServicesManager.conversations.getAll()},t.prototype.prefetchRecents=function(e,t){return this._prefetchPromise||(this._prefetchPromise=this.fetchRecentConversations(e,t)),this._prefetchPromise},t.prototype.fetchRecentConversations=function(e,t){var n=this;if(this._prefetchPromise){var r=this._prefetchPromise;if(this._prefetchPromise=void 0,t<=h.PAGE_SIZE.default)return r}if((this._fetchRecentsPromise?this._fetchRecentsPromise.status:void 0)===c.PromiseStatus.Pending)return this._fetchRecentsPromise.promise;var i;return this._fetchRecentsPromise&&this._fetchRecentsPromise.status===c.PromiseStatus.Pending||(this._fetchRecentsPromise=new c.CancelablePromise),i=e,_().authorization.then(function(){var e={pageSize:t,view:"supportsExtendedHistory|msnp24Equivalent"};i&&!n.syncState&&Object.assign(e,{startTime:i}),n.syncState?Object.assign(e,{syncState:n.syncState}):Object.assign(e,{targetType:"All|InviteFree|Agent"});var r=g.addGetParamsToUrl("users/ME/conversations",e);g.get("fetchRecents",r).then(function(e){e.ok?n._fetchRecentsPromise.isCanceled||g.parseJson(e).then(function(e){n.syncState=n.getSyncState(e._metadata.syncState);var t=e.conversations.filter(function(e){return e.id.lastIndexOf("48:",0)});n.allConversations=n.allConversations.concat(t),n._fetchRecentsPromise.resolve({conversations:n.allConversations,hasMoreConversations:!!e._metadata.backwardLink})}).catch(function(t){l.default.throwError(111,"fetchRecentConversations::getConversationsPage unable to parse response",t),n._fetchRecentsPromise.cancel(e,n.allConversations)}):n._fetchRecentsPromise.cancel(e,n.allConversations)},function(e){n._fetchRecentsPromise.cancel(e,n.allConversations)})}),this._fetchRecentsPromise.promise},t.prototype.fetchMeProperties=function(){return _().authorization.then(function(){return g.get("fetchMeProperties","users/ME/properties",null,!1,!0).then(function(e){return g.parseJson(e)})})},t.prototype.setMeProperty=function(e,t){var n="users/ME/properties?name="+e,r={};return r[e]=t,_().authorization.then(function(){return g.put("setMeProperty",n,{body:JSON.stringify(r)},!1,!0).then(function(e){})})},t.prototype.fetchMeProperty=function(e){var t="users/ME/properties?name="+e;return _().authorization.then(function(){return g.get("setMeProperty",t,null,!1,!0).then(function(t){return g.parseJson(t).then(function(t){return t[e]||void 0})})})},t.prototype.fetchMessages=function(e,t,n){void 0===t&&(t=20),void 0===n&&(n=0);var r={pageSize:t,view:"supportsExtendedHistory|msnp24Equivalent|supportsMessageProperties",startTime:n},i=g.addGetParamsToUrl("users/ME/conversations/"+e+"/messages",r);return _().authorization.then(function(){return g.get("fetchMessages",i).then(function(e){return g.parseJson(e).then(function(e){return e})})})},t.prototype.fetchConversation=function(e){var t=g.addGetParamsToUrl("users/ME/conversations/"+e,{view:"msnp24Equivalent",targetType:"All"});return g.get("fetchConversation",t).then(function(e){return g.parseJson(e).catch(function(e){return e})})},t.prototype.deleteConversation=function(e){var t="users/ME/conversations/"+e+"/messages";return g.del("deleteConversation",t)},t.prototype.sendMessage=function(e,t){var n="users/ME/conversations/"+e+"/messages";return _().authorization.then(function(){return g.post("sendMessage",n,{body:JSON.stringify(t)})}).then(function(e){return g.parseJson(e)})},t.prototype.editMessage=function(e,t,n,r){var i="users/ME/conversations/"+e+"/messages/"+t,o={messagetype:n,content:r};return g.put("edit",i,{body:JSON.stringify(o)})},t.prototype.deleteMessage=function(e,t){var n="users/ME/conversations/"+e+"/messages/"+t;return g.del("deleteMessage",n)},t.prototype.enableJoining=function(e,t){void 0===t&&(t=!0);var n=g.addGetParamsToUrl("threads/"+e+"/properties",{name:"joiningenabled"}),r={body:JSON.stringify({joiningenabled:t})};return g.put("enableJoining",n,r)},t.prototype.discloseHistory=function(e,t){void 0===t&&(t=!0);var n=g.addGetParamsToUrl("threads/"+e+"/properties",{name:"historydisclosed"}),r={body:JSON.stringify({historydisclosed:t})};return g.put("historyDisclosed",n,r)},t.prototype.fetchThread=function(e){var t=g.addGetParamsToUrl("threads/"+e,{view:"msnp24Equivalent"});return g.get("fetchThread",t,null,!1,!0).then(function(e){return g.parseJson(e)})},t.prototype.createThread=function(e){var t={headers:{"Content-Type":"application/json",Accept:"application/json, text/javascript"},body:JSON.stringify({members:e})};return g.post("thread","threads",t)},t.prototype.setConversationTopic=function(e,t){var n=g.addGetParamsToUrl("threads/"+e+"/properties",{name:"topic"});return _().authorization.then(function(){return g.put("setTopic",n,{body:JSON.stringify({topic:t})})})},t.prototype.muteConversation=function(e){var t=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"alerts"});return _().authorization.then(function(){return g.put("muteConversation",t,{body:JSON.stringify({alerts:"false"})})})},t.prototype.unmuteConversation=function(e){var t=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"alerts"});return _().authorization.then(function(){return g.put("unmuteConversation",t,{body:JSON.stringify({alerts:"true"})})})},t.prototype.setFavoriteConversation=function(e){var t=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"favorite"});return this.setPinnedConversation(e),_().authorization.then(function(){return g.put("setFavoriteConversation",t,{body:JSON.stringify({favorite:"true"})})})},t.prototype.removeFavoriteConversation=function(e){var t=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"favorite"});return this.removePinnedConversation(e),_().authorization.then(function(){return g.put("removeFavoriteConversation",t,{body:JSON.stringify({favorite:"false"})})})},t.prototype.setPinnedConversation=function(e){var t=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"pinned"});return _().authorization.then(function(){return g.put("setPinnedConversation",t,{body:JSON.stringify({pinned:"true"})})})},t.prototype.removePinnedConversation=function(e){var t=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"pinned"});return _().authorization.then(function(){return g.put("removePinnedConversation",t,{body:JSON.stringify({pinned:"false"})})})},t.prototype.addParticipant=function(e,t,n){var r="threads/"+e+"/members/"+t,i=n?"Admin":"User";return _().authorization.then(function(){return g.put("addParticipant",r,{body:JSON.stringify({role:i})})})},t.prototype.removeParticipant=function(e,t){var n="threads/"+e+"/members/"+t;return _().authorization.then(function(){return g.del("removeParticipant",n,{body:""})})},t.prototype.acceptConversation=function(e){var t=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"conversationstatus"});return g.put("acceptConversation",t,{body:JSON.stringify({conversationstatus:"Accepted"})})},t.prototype.setBlockedConversation=function(e,t){var n=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"conversationblocked"});return g.put("setBlockedConversation",n,{body:JSON.stringify({conversationblocked:t?"true":"false"})})},t.prototype.updateConsumptionHorizon=function(e,t){var n=g.addGetParamsToUrl("users/ME/conversations/"+e+"/properties",{name:"consumptionhorizon"});return g.put("consumptionHorizon",n,{body:JSON.stringify({consumptionhorizon:t})})},t.prototype.getUsersPresence=function(e){e.length>10&&e.splice(10);var t=g.addGetParamsToUrl("users/ME/contacts/ALL/presenceDocs/messagingService",{cMri:e});return _().authorization.then(function(){return g.get("getUsersPresence",t).then(function(e){return e.json().then(function(e){return e.Responses})})})},t.prototype.sendLocalSystemMessage=function(e,t,n){var r=new Date,i=m.getDomain()+"users/ME/conversations/"+e+"/messages/"+r.getTime(),o={id:r.getTime()+"",from:"",messagetype:d.MessageType.SystemMessage,originalarrivaltime:r.toISOString(),content:t};n&&(o.customType=n);var s={resource:o,resourceLink:i,resourceType:"NewMessage"};_().sendLocalMessage(s)},t.prototype.setMessageProperty=function(e,t,n,r){var i=this.messageProperties(e,t,n),o={};return s.default.get.backend===u.MessagingBackend.TEAMS&&n===a.Configuration.MESSAGE_PROPERTIES.PER_USER.EMOTIONS&&"yes"===r.key&&(r.key="like"),o[n]=JSON.stringify(r),g.put(a.Configuration.CHAT_SERVICE_COMMANDS.SET_MESSAGE_PROPERTY,i,{body:JSON.stringify(o),headers:{"Content-Type":"application/json"}})},t.prototype.messageProperties=function(e,t,n){return"users/ME"+("/conversations"+("/"+e+"/messages")+("/"+t+"/properties"))+"?name="+n},t.prototype.removeMessageProperty=function(e,t,n,r){var i=this.messageProperties(e,t,n),o={};return s.default.get.backend===u.MessagingBackend.TEAMS&&n===a.Configuration.MESSAGE_PROPERTIES.PER_USER.EMOTIONS&&"yes"===r.key&&(r.key="like"),o[n]=JSON.stringify(r),g.del(a.Configuration.CHAT_SERVICE_COMMANDS.REMOVE_MESSAGE_PROPERTY,i,{body:JSON.stringify(o),headers:{"Content-Type":"application/json"}})},t.prototype.subscribeContactPresence=function(e){var t=this;return a.Configuration.ECS.contactPresenceEnabled?(-1===e.indexOf("8:")&&(e="8:"+e),v[e]?Promise.resolve():_().authorization.then(function(){return _().subscribeContactPresence(e).then(function(){return t.getUsersPresence([e]).then(function(t){f.ServicesManager.persons.handlePresenceData(e,t[0].Payload)})})})):Promise.resolve()},t.prototype.unsubscribeContactPresence=function(e){return _().unsubscribeContactPresence(e)},t.prototype.setMyPresence=function(e){return y.some(function(t){return t===e})?_().authorization.then(function(){return g.put("setPresence","users/ME/presenceDocs/messagingService",{body:JSON.stringify({status:e})})}):Promise.reject("Unsupported presence")},t.prototype.setEndpointPresence=function(){return _().authorization.then(function(){return _().setEndpointPresence()})},t}(o.ConversationWebApi);t.ConversationConsumerWebApi=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(65),i=n(4),o=n(2),s=n(17),a=n(38),c=n(0),u=n(9),l=n(292),p=n(481),d=n(482),f=n(117),h=n(7),g=n(108),m=n(91),v=n(60);t.SET_ENDPOINT_PROPERTY="supportsMessageProperties";var y=5e3,_=3,b=1,S=2,T=2e3,w={get:function(e){if(e)try{var t=JSON.parse(c.swc.services.sessionStorage.getItem(a.SKYPE_ENDPOINT_KEY)||"");if(t&&t.validUntil>Date.now()&&e===t.username)return t.value}catch(e){}return""},set:function(e,t){var n={username:e,value:t,validUntil:Date.now()+6e5};c.swc.services.sessionStorage.setItem(a.SKYPE_ENDPOINT_KEY,JSON.stringify(n))},invalidate:function(){c.swc.services.sessionStorage.removeItem(a.SKYPE_ENDPOINT_KEY)}},P=function(){function e(){var n=this;this._handledConversations={},this._handledResourceTypes={},this._isPolling=!1,this._followedContacts={},this.reset=function(){return g.stopActivation(),n._waitingForRetry=!1,n._handledConversations={},n._handledResourceTypes={},n._followedContacts={},n._stopPolling(),n._authPromise.promise.then(null,function(){}).catch(),n._authPromise.cancel(),n._removeEndpoint()},this.subscribeConversation=function(e,t,r){return n._handledConversations[e]||(n._handledConversations[e]={eventHandler:t,backfillCallback:r}),n._endpointCreationPromise&&!n._endpointCreationPromise.isCanceled||n._startPollingSequence(),n._endpointCreationPromise.promise},this.unsubscribeConversation=function(e){n._handledConversations[e]&&delete n._handledConversations[e]},this.subscribeContactPresence=function(e){return n._followedContacts[e]?Promise.resolve():(n._followedContacts[e]=!0,!n._endpointCreationPromise||n._endpointCreationPromise.isCanceled?n._startPollingSequence():n._subscriptionId&&n._updateSubscription(),n._endpointCreationPromise.promise)},this.unsubscribeContactPresence=function(e){n._followedContacts[e]&&(delete n._followedContacts[e],n._endpointCreationPromise.status===s.PromiseStatus.Resolved&&n._updateSubscription())},this.subscribeResource=function(e,t){return n._handledResourceTypes[e]&&u.default.throwError(10004,"Resource with that name was already handled",e),n._handledResourceTypes[e]=t,Promise.resolve()},this.unsubscribeResource=function(e){n._handledResourceTypes[e]&&delete n._handledResourceTypes[e]},this.sendLocalMessage=function(e){var t={eventMessages:[e]};n._handlePollData(t)},this._poll=function(e){n._isPolling||(n._pollingRetryInterval&&n._pollingRetryInterval.reset(),n._pollingRetryInterval=new f.FixedTimeout(n._poll.bind(n,e),y),n._isPolling=!0,n._waitingForRetry=!1,n._pollingPromise=new s.CancelablePromise(m.post("polling","users/ME/endpoints/SELF/subscriptions/"+e+"/poll",{body:JSON.stringify({})})),n._pollingPromise.promise.then(function(t){n._isPolling=!1,t.ok||404===t.status?(n._pollingFailedCount=0,t.json().then(function(t){n._pollingPromise.isCanceled||(n._handlePollData(t),729===t.errorCode?(w.invalidate(),n._startPollingSequence()):450===t.errorCode?(n._subscribeToEndpoint(),n.triggerBackfilling()):n._endpointCreationPromise&&n._endpointCreationPromise.status===s.PromiseStatus.Resolved&&n._poll(e))}).catch(function(t){n._poll(e)})):n.retryPollingIfNeeded(t,e)},function(e){n._isPolling=!1,n.retryPollingIfNeeded()}))},this._handlePollData=function(e){if(e&&e.eventMessages){e.eventMessages.forEach(function(e){!function(e){var t=e.resourceType,r=n._handledResourceTypes[t];r&&r(v.getConversationIdFromUrl(e.resourceLink),e.resource)}(e),"NewMessage"===e.resourceType||"MessageUpdate"===e.resourceType||"ConversationUpdate"===e.resourceType?function(e){var t;t=e.resource&&e.resource.conversationid?e.resource.conversationid:e.resource.conversationLink?v.getConversationIdFromUrl(e.resource.conversationLink):v.getConversationIdFromUrl(e.resourceLink);var r=n._handledConversations[t];r||c.swc.services.conversations.get(t);var i=r&&r.eventHandler,o=e.resource,s=v.getConversationIdFromUrl(o.from),a=p.ThreadNotifications.instance;s&&!a.empty&&l.default.detectConversationType(s)===h.ConversationType.AGENT&&a.notify(l.default.getNormalizeId(s),t,o.content);i&&i(e.resourceType,o)}(e):"UserPresence"===e.resourceType?function(e){var t=v.getConversationIdFromUrl(e.resourceLink);if(!t&&e.resource&&e.resource.selfLink&&(t=v.getConversationIdFromUrl(e.resource.selfLink)),t){var r=c.swc.services.mePerson.mri===t;(n._followedContacts[t]||r)&&c.swc.services.persons.handlePresenceData(t,e.resource)}}(e):"ThreadUpdate"===e.resourceType&&function(e){if("ThreadUpdate"===e.resourceType){var t=e.resource;c.swc.services.conversations.get(t.id).update(t),c.swc.services.unreadCounterStore.update(t)}}(e)})}},this.retryPollingIfNeeded=function(e,t){if(!n._pollingPromise.isCanceled){if(n._pollingFailedCount>=_)return n._startPollingSequence(),void n.triggerBackfilling();n._pollingFailedCount++,e&&"Timeout"===e.statusText?n._poll(t):(n._pollingRetryInterval.start(),n.triggerBackfilling())}},this.triggerBackfilling=function(){for(var e in n._handledConversations){if(n._handledConversations.hasOwnProperty(e))n._handledConversations[e].backfillCallback()}},this._startPollingSequence=function(e){if(n._endpointCreationPromise&&n._endpointCreationPromise.status===s.PromiseStatus.Pending)return n._endpointCreationPromise.promise;if(n._isPolling)return Promise.resolve();if(n._waitingForRetry&&!e)return Promise.resolve();n._endpointRetryInterval.reset(),d.stop(),n._pollingFailedCount=0,n._pollingRetryInterval&&n._pollingRetryInterval.reset(),n._pollingRemoved=!1,n._authPromise.status!==s.PromiseStatus.Pending&&(n._authPromise=new s.CancelablePromise);return n._endpointCreationPromise=new s.CancelablePromise(n._createEndpoint().then(function(e){d.reset(),e.json().then(function(e){if(!n._endpointCreationPromise.isCanceled){if(!(e.subscriptions&&e.subscriptions.length>0))return n._subscribeToEndpoint();n._poll(e.subscriptions[0].id)}})},function(){n._endpointCreationPromise.isCanceled||(n._endpointFailedCount++,n._waitingForRetry=!0,n._endpointFailedCount>=b?(d.execute(n._startPollingSequence.bind(n,!0)),n._endpointFailedCount>=S&&c.swc.Eventing.triggerEvent(i.ApiEvents.ChatServiceUnavailable,null,!0)):n._endpointRetryInterval.start())})),n._endpointCreationPromise.promise},this._storeEpid=function(t){var n=(t=t||"").match(/endpoints\/(%7B[\da-z\-]+%7D)/),r=n&&n[1]||e._epid;r&&(e._epid=r,c.swc.services.sessionStorage.setItem(a.SKYPE_ENDPOINT_ID_KEY,e._epid))},this.onEndpointCreation=function(e){n._setEndpointProperty(t.SET_ENDPOINT_PROPERTY,!0),n.setEndpointPresence()},this._createEndpoint=function(){var e={endpointFeatures:"Agent,InviteFree,MessageProperties"},t=function(e){if(!e.ok)return Promise.reject("Failed to create endpoint");n._storeEpid(e.headers.get("location"));var t=n._authPromise.resolve.bind(n._authPromise);return setTimeout(t,1),c.swc.services.isActive()&&g.startActivation(),n.onEndpointCreation(e),c.swc.Eventing.triggerEvent(i.ApiEvents.EndpointRegistered,null,!0),e},r=c.swc.services.mePerson?c.swc.services.mePerson.id:"",s=w.get(r);if(s){return m.put("endpointCreation",s,{body:JSON.stringify(e),headers:{"Content-Type":"application/json"}},!0,!0).then(function(e){return o.Configuration.CHAT_HOST_URL=v.parseChatServiceHostUrl(e.url),e}).then(t).catch(function(e){return w.invalidate(),n._createEndpoint()})}return m.post("endpointCreation","users/ME/endpoints",{body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then(function(e){if(e.ok){var t=e.headers.get("location");w.set(r,t)}return e}).then(t)},this._requestSubscription=function(){var e={channeltype:"httpLongPoll",interestedResources:n._getInterestedResources()};return m.post("endpointSubscription","users/ME/endpoints/SELF/subscriptions",{body:JSON.stringify(e)})},this.setEndpointPresence=function(){var t={id:"messagingService",privateInfo:{epname:"skype"},epname:"skype",publicInfo:{capabilities:"video|audio",nodeInfo:"",skypeNameVersion:"skype.com",type:1},version:o.Configuration.getClientVersion(),selfLink:"uri",type:"EndpointPresenceDoc"};return m.put("setEndpointPresence","users/ME/endpoints/"+e._epid+"/presenceDocs/messagingService",{body:JSON.stringify(t)})},this.modifySubscription=function(){var e={interestedResources:n._getInterestedResources()};if(void 0===n._subscriptionId)return Promise.resolve();var t="users/ME/endpoints/SELF/subscriptions/"+n._subscriptionId+"?name=interestedResources",r=e.interestedResources.length;return m.put("endpointSubscription",t,{body:JSON.stringify(e)}).then(function(e){e&&!e.ok&&u.default.throwError(10005,"Unable to update subscription. Number of followed contacts: "+r,e)},function(e){u.default.throwError(10005,"Unable to update subscription. Number of followed contacts: "+r,e)})},e._epid=c.swc.services.sessionStorage.getItem(a.SKYPE_ENDPOINT_ID_KEY),this._authPromise=new s.CancelablePromise,this._endpointRetryInterval=new f.FixedTimeout(this._startPollingSequence.bind(this,!0),y),this._pollingFailedCount=0,this._endpointFailedCount=0,this._updateSubscription=r(this.modifySubscription.bind(this),T,{leading:!0}),p.ThreadNotifications.init()}return Object.defineProperty(e.prototype,"authorization",{get:function(){return this._startPollingSequence(),this._authPromise.promise},enumerable:!0,configurable:!0}),e.prototype._setEndpointProperty=function(e,n){var r={};return r[e]=n,m.put("endpointProperties","users/ME/endpoints/SELF/properties?name="+t.SET_ENDPOINT_PROPERTY,{body:JSON.stringify(r),headers:{"Content-Type":"application/json"}})},e.prototype._getInterestedResources=function(){var e=["/v1/users/ME/conversations/ALL/messages","/v1/users/ME/conversations/ALL/properties","/v1/threads/ALL"];return Object.getOwnPropertyNames(this._followedContacts).forEach(function(t){e.push("/v1/users/ME/contacts/"+t)}),e},e.prototype._subscribeToEndpoint=function(){var e=this;return this._requestSubscription().then(function(t){if(!e._endpointCreationPromise.isCanceled){var n=(t.headers.get("location")||"").match(/\/(\d+)$/);n?(e._subscriptionId=n[1],e._poll(n[1])):e._startPollingSequence()}},function(t){if(!t||!t.json)return e._waitingForRetry=!0,void e._endpointRetryInterval.start();t.json().then(function(t){!t||729!==t.errorCode&&201!==t.errorCode||(729===t.errorCode&&w.invalidate(),e._startPollingSequence())},function(){})})},e.prototype._removeEndpoint=function(){if(this._pollingRemoved)return Promise.resolve();function t(){m.reset(),e._epid=null}return this._pollingRemoved=!0,e._epid||(e._epid=c.swc.services.sessionStorage.getItem(a.SKYPE_ENDPOINT_ID_KEY)),e._epid?m.del("deleteEndpoint","users/ME/endpoints/"+e._epid).then(t,t):(m.reset(),Promise.resolve())},e.prototype._stopPolling=function(){this._endpointRetryInterval.reset(),this._pollingRetryInterval&&this._pollingRetryInterval.reset(),this._pollingFailedCount=0,this._endpointFailedCount=0,this._endpointCreationPromise&&this._endpointCreationPromise.cancel(),this._pollingPromise&&(this._pollingPromise.cancel(),this._isPolling=!1)},e}();t.Polling=P},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(34),i=n(7),o=n(9),s=function(){function e(){}return e.strip=function(e){var t=e.match(this.idRegExp);return t?t[2]:e},e.detectConversationType=function(e){if(!e)return i.ConversationType.UNDEFINED;if(this.typeMapppings[e])return this.typeMapppings[e];var t,n=e.match(this.idRegExp);if(n&&(t=this.getTypeByPrefix(n[1])),t)return this.typeMapppings[e]=t,t;if(0===e.indexOf("https://join.skype.com/"))return this.typeMapppings[e]=i.ConversationType.JOIN,i.ConversationType.JOIN;if(/^(28:)?[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i.test(e))return this.typeMapppings[e]=i.ConversationType.AGENT,i.ConversationType.AGENT;if(/^(19:)?[\S]+[@]([\S].)?[\S]*thread\.skype/i.test(e))return this.typeMapppings[e]=i.ConversationType.GROUP,i.ConversationType.GROUP;return/(?:00|\+)?(^[^a-z][^A-Z])(\d+$)/i.test(e.replace(/\s+|[()\-\+]/gi,""))?(this.typeMapppings[e]=i.ConversationType.PHONE,i.ConversationType.PHONE):(this.typeMapppings[e]=i.ConversationType.PERSON,i.ConversationType.PERSON)},e.getSdkModeFromId=function(e){switch(this.detectConversationType(e)){case i.ConversationType.PERSON:return r.SDKMode.PERSON;case i.ConversationType.AGENT:return r.SDKMode.BOT;case i.ConversationType.JOIN:return r.SDKMode.JOIN_URL;case i.ConversationType.PHONE:return r.SDKMode.PHONE;case i.ConversationType.GROUP:return r.SDKMode.THREAD}return r.SDKMode.UNDEFINED},e.toFullIdentifier=function(e){var t=this.getPrefixForId(e);return 0===e.indexOf(t+":")?e:t?t+":"+e:e},e.addPrefix=function(e,t){return 0===t.indexOf(e+this.SPLITTER)?t:0===t.indexOf(this.SPLITTER)?e+t:e+this.SPLITTER+t},e.getNormalizeId=function(e){return e.match(this.idRegExp)?e.replace(/\d{1,2}:/,""):e},e.isEqual=function(e,t){return this.toFullIdentifier(e).toLowerCase()===this.toFullIdentifier(t).toLowerCase()},e.getPrefixForId=function(e){if(this.hasAlreadyPrefix(e))return"";var t=this.getSdkModeFromId(e);switch(t){case r.SDKMode.PERSON:return"8";case r.SDKMode.BOT:return"28";case r.SDKMode.THREAD:return"19";case r.SDKMode.PHONE:return"4";default:o.default.throwError(10502,"Unable to define conversation prefix",{id:e,sdkMode:t})}return""},e.getTypeByPrefix=function(e){if(!e)return i.ConversationType.UNDEFINED;switch(e.indexOf(":")>-1&&(e=e.replace(":","")),e){case"4":return i.ConversationType.PHONE;case"8":return i.ConversationType.PERSON;case"19":return i.ConversationType.GROUP;case"28":return i.ConversationType.AGENT;default:return i.ConversationType.UNDEFINED}},e.hasAlreadyPrefix=function(e){var t=/^\d+:/.exec(e);return!!t&&!!t[0]},e.SPLITTER=":",e.idRegExp=/(\d{1,2}:)([\S]*)/,e.typeMapppings={},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(487),i=n(23),o={retryCount:3,timeout:5e4,policy:""},s=function(){function e(e,t){this.serviceName=e,this.baseUrl=t,this.authentication=function(e){return Promise.resolve(e)}}return e.prototype.issueRequest=function(e,t,n){var s=this;void 0===t&&(t={}),void 0===n&&(n={});var a=r.buildUriFromTemplate(this.baseUrl,e,t);return n.headers=n.headers||{},n.headers["Content-Type"]="application/json",this.onBeforeRequest(n).then(function(t){return i.default(s.serviceName+"-"+e,o,a,t).then(function(e){return e.ok?e.json():Promise.reject(e)})})},e.prototype.onBeforeRequest=function(e){return this.authentication(e)},e.prototype.setAuthentication=function(e){this.authentication=e},e.prototype.post=function(e,t,n,r){return void 0===t&&(t={}),void 0===r&&(r={}),r.method="POST",r.body=JSON.stringify(n),this.issueRequest(e,t,r)},e.prototype.get=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n={}),n.method="GET",this.issueRequest(e,t,n)},e}();t.JsonClient=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(23),o=n(490),s={retryCount:3,timeout:12e4,policy:""},a=function(e,t,n,o){var a;return a=o?o+t:r.Configuration.CONTACTS_HOST_URL+t,i.default("contacts-"+e,s,a,n)};t.get=function(e,t){return o.getHeaders().then(function(n){var r={method:"GET"};return r.headers=n,r.cache="no-cache",a(e,t,r).then(function(e){return e.json()})})},t.getRaw=function(e,t,n){return o.getHeaders().then(function(r){n&&Object.getOwnPropertyNames(n).forEach(function(e){r.append(e,n[e])});var i={method:"GET"};return i.headers=r,i.cache="no-cache",a(e,t,i)})},t.post=function(e,t,n,r){return o.getHeaders().then(function(i){i.append("Content-Type","application/json");var o={method:"POST"};return o.body=n,o.headers=i,a(e,t,o,r)})},t.put=function(e,t,n){return o.getHeaders().then(function(r){r.append("Content-Type","application/json");var i={method:"PUT"};return i.body=n,i.headers=r,a(e,t,i)})},t.deleteMethod=function(e,t){return o.getHeaders().then(function(n){var r={method:"DELETE"};return r.headers=n,a(e,t,r)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(2),o=n(25),s=n(17),a=n(0),c=n(9),u=n(492),l=n(13),p=n(493),d=n(294),f=n(296),h="X-Skype-Continuation-Token",g="If-None-Match",m="Etag",v=4e3,y=3;t.reasons={DEFAULT:"default",NOTIFICATION:"notification"};var _=function(){function e(){var e=this;this._contacts=[],this._groups=[],this._blocklist=[],this._pendingContactFetching={},this._haveAllContacts=!1,this._retryCount=0,this._retryTimeout=v,this._etagHeader="",this.fetchMyContacts=function(t,n){void 0===t&&(t=100);var r=Date.now(),i=0;if(e._fetchContactsPromise)return n&&n(e._contacts),e._fetchContactsPromise.promise;var o=new p.ContactsInfo,d=function(s,p){var f=function(g){if(i++,!e._fetchContactsPromise||!e._fetchContactsPromise.isCanceled){var v=Date.now(),_=l.ServicesManager.signInManager.currentUserName;e.fetchContacts(_,t,g).then(function(l){if(!e._fetchContactsPromise||!e._fetchContactsPromise.isCanceled){if(!l.ok){if(429===l.status||500===l.status||502===l.status)return void(e._retryCount<y&&new Promise(function(t,n){setTimeout(function(){d(s,p)},e._retryTimeout),e._retryTimeout=2*e._retryTimeout,e._retryCount++}));var g={code:l.status,message:l.statusText};return c.default.throwError(11001,"Unable to fetch contacts",g),p(g),void(e._fetchContactsPromise=null)}l.json().then(function(c){return function(c){if(e._haveAllContacts=!0,!c)return e._contacts?s(o):(p({status:l.status,statusText:l.statusText}),e._fetchContactsPromise=null),void a.swc.Telemetry.sendEvent.contactsLoadedQos(l.status,i);c.duration=Date.now()-v,o.update(c);var u={"If-None-Match":"/"};n&&n(c.contacts);var d=l.headers.get(h),g=l.headers.get(m);return g&&(e._etagHeader=g),d?(u[h]=d,f(u)):(e._contacts=o.contacts.getItems(),c.contacts=e._contacts,e._groups=o.groups.getItems(),c.groups=e._groups,e._blocklist=o.blocklist.getItems(),c.blocklist=e._blocklist,c.scope=o.firstScope,c.duration=o.duration,s(c),void a.swc.Telemetry.sendEvent.contactsLoadedQos(l.status,i,c.contacts.length,c.blocklist.length,c.groups.length,o.filter(4).length,o.filter(8).length,o.filter(28).length,t,Date.now()-r))}(c)},function(t){c.default.throwError(11001,"Unable to fetch contacts",t),p(t),e._fetchContactsPromise=null,u.reportContactsLoadedQosError(l.status,t)})}})}};l.ServicesManager.signInManager.onceSignedIn().then(f.bind(e))},f=new Promise(d);return e._fetchContactsPromise=new s.CancelablePromise(f),e._fetchContactsPromise.promise},this.getContactsUpdate=function(n){return e._fetchContactsDelta(t.reasons.NOTIFICATION).then(function(e){return e.json()})},this.fetchContacts=function(e,t,n){if(void 0===t&&(t=100),r.default.get.isTeams())return Promise.resolve({status:200,statusText:"Aad is here"});var i="users/"+encodeURIComponent(e)+"?page_size="+t+"&reason=default";return d.getRaw("fetchContacts",i,n)},this._fetchContactsDelta=function(n){void 0===n&&(n=t.reasons.DEFAULT),n=n||t.reasons.DEFAULT;var i=l.ServicesManager.signInManager.currentUserName,o=e._etagHeader||"/",s={};if(s[g]=o,r.default.get.isTeams())return Promise.resolve({status:200,statusText:"Aad is here"});var a="users/"+encodeURIComponent(i)+"?delta&reason="+encodeURIComponent(n);return d.getRaw("fetchContactsDelta",a,s)},this.getContact=function(t,n){if(e._fetchContactsPromise&&e._fetchContactsPromise.status===s.PromiseStatus.Pending)return e._fetchContactsPromise.promise.then(function(){for(var t,r=0;r<e._contacts.length;r++)if(e._contacts[r].mri===n){t=e._contacts[r];break}return t});if(e._pendingContactFetching[n])return e._pendingContactFetching[n];for(var r,i=0;i<e._contacts.length;i++)if(e._contacts[i].mri===n){r=e._contacts[i];break}return r?(delete e._pendingContactFetching[n],Promise.resolve(r)):e._haveAllContacts?Promise.resolve():(e._pendingContactFetching[n]=new Promise(function(r,i){e.fetchContact(t,n).then(function(t){return t.json().then(function(t){var i,o=t.contacts||[];t.contacts&&t.contacts.length&&e._contacts.push(o),delete e._pendingContactFetching[n];for(var s=0;s<o.length;s++)if(o[s].mri&&o[s].mri===n){i=o[s];break}r(i)},function(t){delete e._pendingContactFetching[n],c.default.throwError(11002,"Unable to fetch contact",t),i(t)})},function(t){delete e._pendingContactFetching[n],c.default.throwError(11002,"Unable to fetch contact",t)})}),e._pendingContactFetching[n])},this.fetchContact=function(e,t){if(r.default.get.isTeams())return Promise.resolve({status:200,statusText:"Aad is here"});var n=f.default.normalizePersonId(t),i="users/"+e+"/contacts?$filter=mri%2Fnamespace+eq+%27"+f.default.parsePersonId(t).type+"%27+and+mri%2Fidentifier+eq+%27"+n+"%27";return d.getRaw("fetchContact",i)},l.ServicesManager.signInManager.subscribe("state",function(t){t===o.SigninState.SignedOut&&e.dispose()})}return Object.defineProperty(e.prototype,"fetchMyContactsPromise",{get:function(){return this._fetchContactsPromise&&this._fetchContactsPromise.promise},enumerable:!0,configurable:!0}),e.prototype.addContact=function(e,t){var n="users/"+l.ServicesManager.signInManager.currentUserName+"/contacts",r={mri:e,greeting:t};return d.post("addContact",n,JSON.stringify(r))},e.prototype.addFavoriteContact=function(e){var t="users/"+l.ServicesManager.signInManager.currentUserName+"/contacts/favorites/"+e;return d.put("addFavoriteContact",t,"")},e.prototype.removeFavoriteContact=function(e){var t="users/"+l.ServicesManager.signInManager.currentUserName+"/contacts/favorites/"+e;return d.deleteMethod("removeFavoriteContact",t)},e.prototype.blockContact=function(e,t,n){var r=this;void 0===t&&(t=!0),void 0===n&&(n="spam");var o=l.ServicesManager.signInManager.currentUserName,s="users/"+o+"/contacts/blocklist/"+e,a={delete_contact:!1,report_abuse:t,ui_version:i.Configuration.getUiVersion(),reason:n};return this.invalidateCache(),t?d.put("blockContact",s,JSON.stringify(a)).then(function(){return r.reportAbuse(o,e,n)}):d.put("blockContact",s,JSON.stringify(a))},e.prototype.reportAbuse=function(e,t,n){void 0===n&&(n="spam");var r="users/"+e+"/contacts/"+t+"/report",o={ui_version:i.Configuration.getUiVersion(),reason:n,report_context:"contact_request",content:{hash:"af94h"}};return d.post("reportAbuse",r,JSON.stringify(o))},e.prototype.unblockContact=function(e){var t="users/"+l.ServicesManager.signInManager.currentUserName+"/contacts/blocklist/"+e;return this.invalidateCache(),d.deleteMethod("unblockContact",t)},e.prototype.invalidateCache=function(){this._fetchContactsPromise&&(this._fetchContactsPromise.cancel(),this._fetchContactsPromise=null),this.fetchMyContacts()},e.prototype.getContactByMriIfPresent=function(e){var t=this._contacts.filter(function(t){return t.mri===e});return t.length?t[0].display_name:null},e.prototype.getContactByMri=function(e){var t=this._contacts.filter(function(t){return t.mri===e});return t.length?t[0]:void 0},e.prototype.getBlockedList=function(){return this._fetchContactsPromise?this._fetchContactsPromise.promise.then(function(e){return e.blocklist}):Promise.resolve()},Object.defineProperty(e.prototype,"contactsList",{get:function(){return this._contacts},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._contacts=[],this._groups=[],this._blocklist=[],this._fetchContactsPromise&&this._fetchContactsPromise.status===s.PromiseStatus.Pending&&this._fetchContactsPromise.cancel(),this._fetchContactsPromise=null},e}();t.default=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(35),i=function(){function e(){}return e._personIdRegExp=/(\d+:)([\S]*)/,e.normalizePersonId=function(t){var n=t.match(e._personIdRegExp);return n?n[2]:t},e.parsePersonId=function(t){var n=t.match(e._personIdRegExp);return n?{id:n[2],type:parseInt(n[1],0)}:{id:t,type:null}},e.getContactType=function(e){var t=/\d{0,}[^:]/g.exec(e.mri);return t&&t[0]?parseInt(t[0],0):r.ContactType.Undefined},e.replaceAvatarPath=function(e){return e.indexOf("data:image/jpeg;base64")>-1?e:e=(e=e.replace("URL@","")).indexOf("/views/avatar_fullsize")<0?e+"/views/avatar_fullsize":e},e.resolveConversationAvatar=function(t,n){return n?t?e.replaceAvatarPath(n):n:""},e}();t.default=i},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(17),s=n(10),a=n(35),c=n(0),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.searchSkypeDirectory=function(e){return this._searchPromise&&this._searchPromise.status===o.PromiseStatus.Pending&&(this._searchPromise.cancel(),this._searchPromise=null),this._searchKey=e,this._searchPromise=new o.CancelablePromise(c.swc.services.skypeGraphService.fetchProfiles(e)),this._searchPromise.promise},t.prototype.searchAgents=function(e){return new Promise(function(t,n){return c.swc.services.agentsService.searchAgents(e).then(function(e){if(e&&e.agentDescriptions){var n=e.agentDescriptions.map(function(e){return{skypeid:"28:"+e.agentId,name:e.displayName,avatar:e.userTileSmallUrl||e.userTileStaticUrl||"",type:a.ContactType.Agent}});t(n)}else t([])})})},t}(s.default);t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(9),o=n(13),s=n(138),a=n(113),c=n(498),u=n(499),l=function(e,t){return void 0===t&&(t=function(){}),o.ServicesManager.signInManager.aad&&s.getConfig().isEnabled?e():t()},p=function(){function e(){}return Object.defineProperty(e,"isEnabled",{get:function(){return l(function(){return!0},function(){return!1})},enumerable:!0,configurable:!0}),e.setMyPresence=function(t,n){if(void 0===n&&(n=null),!a.isForcedAvailabilityAllowed(t))return Promise.reject("Availability can only be one of ("+a.allowedForcedAvailabilities.join(",")+")");if(null!==n&&!a.isActivityCombinationAllowed(t,n))return Promise.reject("Combination of '"+t+"/"+n+"' is not allowed");return l(function(){var r={activity:n,availability:t};return u.put("Presence.setMyPresence","/me/forceAvailability",JSON.stringify(r)).then(function(n){return n.ok?(e.lastStatus=t,Promise.resolve()):(i.default.throwError(103503),Promise.reject("Unable to set Presence"))})},function(){return Promise.resolve()})},e.getMyPresence=function(){return l(function(){return e.lastStatus?Promise.resolve(e.lastStatus):new Promise(function(t,n){var r=0,i=setInterval(function(){return r++>5?(clearInterval(i),n("Unable to getPresence info")):e.lastStatus?(clearInterval(i),t(e.lastStatus)):void 0},1e3)})},function(){return Promise.reject("Presence is disabled")})},e.getMeEndpoints=function(){return l(function(){return u.get("Presence.getMeEndpoints","/me/endpoints")},function(){return Promise.resolve([])})},e.pollPresence=function(e){return l(function(){return u.post("Presence.pollPresence","/presence/getpresence",JSON.stringify(e))},function(){return Promise.resolve([])})},e.subscribe=function(e,t){var n=c.PresencePollingService.get();n.subscribe(e,t),n.isRunning&&n.forceDelayedPoll()},e.unsubscribe=function(e,t){c.PresencePollingService.get().unsubscribe(e,t)},e.subscribeToMyUpdates=function(){if(e.mePersonMri)return Promise.resolve();var t=r.swc.services;return t.signInManager&&t.signInManager.isAadSupported()?t.signInManager.onceSignedIn().then(function(){e.mePersonMri=t.mePerson.mri,e.subscribe(e.mePersonMri,function(t){t.presence&&t.presence.availability&&(e.lastStatus=t.presence.availability)})}):void 0},e.startPolling=function(){l(function(){e.subscribeToMyUpdates().then(function(){c.PresencePollingService.get().start()})})},e}();t.UnifiedPresenceService=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=[{language:"ar",defaultLocale:"ar-sa"},{language:"bg",defaultLocale:"bg-bg"},{language:"ca",defaultLocale:"ca-es"},{language:"cs",defaultLocale:"cs-cz"},{language:"cy",defaultLocale:"cy-gb"},{language:"da",defaultLocale:"da-dk"},{language:"de",defaultLocale:"de-de"},{language:"el",defaultLocale:"el-gr"},{language:"en-ca",defaultLocale:"en-gb"},{language:"en-au",defaultLocale:"en-gb"},{language:"en-in",defaultLocale:"en-gb"},{language:"en-hk",defaultLocale:"en-gb"},{language:"en-ie",defaultLocale:"en-gb"},{language:"en-pk",defaultLocale:"en-gb"},{language:"en-sg",defaultLocale:"en-gb"},{language:"en-gb",defaultLocale:"en-gb"},{language:"en",defaultLocale:"en-us"},{language:"es-ar",defaultLocale:"es-mx"},{language:"es-uy",defaultLocale:"es-mx"},{language:"es-py",defaultLocale:"es-mx"},{language:"es-co",defaultLocale:"es-mx"},{language:"es-cl",defaultLocale:"es-mx"},{language:"es-pe",defaultLocale:"es-mx"},{language:"es-ec",defaultLocale:"es-mx"},{language:"es-ve",defaultLocale:"es-mx"},{language:"es-cr",defaultLocale:"es-mx"},{language:"es-do",defaultLocale:"es-mx"},{language:"es-pa",defaultLocale:"es-mx"},{language:"es-gt",defaultLocale:"es-mx"},{language:"es-bo",defaultLocale:"es-mx"},{language:"es-ev",defaultLocale:"es-mx"},{language:"es-hn",defaultLocale:"es-mx"},{language:"es-ni",defaultLocale:"es-mx"},{language:"es-pu",defaultLocale:"es-mx"},{language:"es-br",defaultLocale:"es-mx"},{language:"es-419",defaultLocale:"es-mx"},{language:"es-us",defaultLocale:"es-us"},{language:"es",defaultLocale:"es-es"},{language:"et",defaultLocale:"et-ee"},{language:"eu",defaultLocale:"eu-es"},{language:"gl",defaultLocale:"gl-es"},{language:"fi",defaultLocale:"fi-fi"},{language:"fr-ca",defaultLocale:"fr-ca"},{language:"fr",defaultLocale:"fr-fr"},{language:"iw",defaultLocale:"he-il"},{language:"he",defaultLocale:"he-il"},{language:"hi",defaultLocale:"hi-in"},{language:"hr",defaultLocale:"hr-hr"},{language:"hu",defaultLocale:"hu-hu"},{language:"in",defaultLocale:"id-id"},{language:"id",defaultLocale:"id-id"},{language:"it",defaultLocale:"it-it"},{language:"ja",defaultLocale:"ja-jp"},{language:"kk",defaultLocale:"kk-kz"},{language:"ko",defaultLocale:"ko-kr"},{language:"lt",defaultLocale:"lt-lt"},{language:"lv",defaultLocale:"lv-lv"},{language:"ms",defaultLocale:"ms-my"},{language:"no",defaultLocale:"nb-no"},{language:"nb",defaultLocale:"nb-no"},{language:"nn",defaultLocale:"nn-no"},{language:"nl",defaultLocale:"nl-nl"},{language:"pl",defaultLocale:"pl-pl"},{language:"pt-pt",defaultLocale:"pt-pt"},{language:"pt-br",defaultLocale:"pt-br"},{language:"pt",defaultLocale:"pt-br"},{language:"ro",defaultLocale:"ro-ro"},{language:"ru",defaultLocale:"ru-ru"},{language:"sk",defaultLocale:"sk-sk"},{language:"sl",defaultLocale:"sl-si"},{language:"sr",defaultLocale:"sr-latn-rs"},{language:"sr-cyrl",defaultLocale:"sr-cyrl-rs"},{language:"sr-latn",defaultLocale:"sr-latn-rs"},{language:"sv",defaultLocale:"sv-se"},{language:"th",defaultLocale:"th-th"},{language:"tr",defaultLocale:"tr-tr"},{language:"uk",defaultLocale:"uk-ua"},{language:"vi",defaultLocale:"vi-vn"},{language:"zh",defaultLocale:"zh-cn"},{language:"zh-tw",defaultLocale:"zh-tw"},{language:"zh-hant",defaultLocale:"zh-tw"},{language:"zh-cht",defaultLocale:"zh-tw"},{language:"zh-hk",defaultLocale:"zh-hk"},{language:"zh-mo",defaultLocale:"zh-tw"}],i=[{locale:"am-et",pesLocale:"am"},{locale:"ar-sa",pesLocale:"ar"},{locale:"az-latn-az",pesLocale:"az"},{locale:"be-by",pesLocale:"be-BY"},{locale:"bg-bg",pesLocale:"bg"},{locale:"bn-bd",pesLocale:"bn"},{locale:"bn-in",pesLocale:"bn"},{locale:"bs-latn-ba",pesLocale:"bs-Latn-BA"},{locale:"ca-es",pesLocale:"ca"},{locale:"ca-es-valencia",pesLocale:"ca"},{locale:"cs-cz",pesLocale:"cs"},{locale:"cy-gb",pesLocale:"cy-GB"},{locale:"da-dk",pesLocale:"da"},{locale:"de-de",pesLocale:"de"},{locale:"el-gr",pesLocale:"el"},{locale:"en-gb",pesLocale:"en"},{locale:"en-us",pesLocale:"en"},{locale:"es-es",pesLocale:"es"},{locale:"et-ee",pesLocale:"et"},{locale:"eu-es",pesLocale:"eu"},{locale:"fa-ir",pesLocale:"fa"},{locale:"fi-fl",pesLocale:"fi"},{locale:"fil-ph",pesLocale:"fil_PH"},{locale:"fr-fr",pesLocale:"fr"},{locale:"gd-gb",pesLocale:"gd-GB"},{locale:"gl-es",pesLocale:"gl"},{locale:"gu-in",pesLocale:"gu-IN"},{locale:"he-il",pesLocale:"he"},{locale:"hi-in",pesLocale:"hi"},{locale:"hr-hr",pesLocale:"hr"},{locale:"hu-hu",pesLocale:"hu"},{locale:"id-id",pesLocale:"id"},{locale:"is-is",pesLocale:"is"},{locale:"it-it",pesLocale:"it"},{locale:"ja-jp",pesLocale:"ja"},{locale:"ka-ge",pesLocale:"ka-GE"},{locale:"kk-kz",pesLocale:"kk"},{locale:"kn-in",pesLocale:"kn"},{locale:"ko-kr",pesLocale:"ko"},{locale:"ku-arab-iq",pesLocale:"ku-Arab-IQ"},{locale:"lb-lu",pesLocale:"lb-LU"},{locale:"lt-lt",pesLocale:"lt"},{locale:"lv-lv",pesLocale:"lv"},{locale:"mk-mk",pesLocale:"mk"},{locale:"ml-in",pesLocale:"ml"},{locale:"mr-in",pesLocale:"mr-IN"},{locale:"ms-my",pesLocale:"ms"},{locale:"nb-no",pesLocale:"no"},{locale:"nl-nl",pesLocale:"nl"},{locale:"nn-no",pesLocale:"no"},{locale:"or-in",pesLocale:"or-IN"},{locale:"pl-pl",pesLocale:"pl"},{locale:"pt-pt",pesLocale:"pt-PT"},{locale:"pt-br",pesLocale:"pt-BR"},{locale:"ro-ro",pesLocale:"ro"},{locale:"ru-ru",pesLocale:"ru"},{locale:"sk-sk",pesLocale:"sk"},{locale:"sl-sl",pesLocale:"sl"},{locale:"sq-al",pesLocale:"sq"},{locale:"sr-cyrl-ba",pesLocale:"sr"},{locale:"sr-cyrl-rs",pesLocale:"sr"},{locale:"sr-latn-rs",pesLocale:"sr"},{locale:"sv-se",pesLocale:"sv"},{locale:"sw-ke",pesLocale:"sw"},{locale:"ta-in",pesLocale:"ta"},{locale:"te-in",pesLocale:"te"},{locale:"th-th",pesLocale:"th"},{locale:"tr-tr",pesLocale:"tr"},{locale:"uk-ua",pesLocale:"uk"},{locale:"ur-pk",pesLocale:"ur-PK"},{locale:"uz-latn-uz",pesLocale:"uz"},{locale:"vi-vn",pesLocale:"vi"},{locale:"zh-cn",pesLocale:"zh_Hans"},{locale:"zh-tw",pesLocale:"zh_Hant"}],o=function(){function e(){}return e.prototype.getLocale=function(e){var t=this.getMappingByLanguage(e);if(t)return t.defaultLocale;var n=e.lastIndexOf("-");return n>-1?this.getLocale(e.substring(0,n)):e},e.prototype.getPesLocale=function(e){var t,n;return e?(t=this.getPESMapping(e))&&t.pesLocale?t.pesLocale:(n=this.getLocale(e))!==e&&(t=this.getPESMapping(n))?t.pesLocale:"default":"default"},e.prototype.getPESMapping=function(e){for(var t=0;t<i.length;t++)if(i[t].locale.toLowerCase()===e.toLowerCase())return i[t];return null},e.prototype.getMappingByLanguage=function(e){for(var t=0;t<r.length;t++)if(r[t].language.toLowerCase()===e.toLowerCase())return r[t];return null},e}();t.default=new o},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),s=n(2),a=n(10),c=n(80),u=n(40),l=n(14),p=n(9),d=n(85),f=n(13),h="guest:";var g=function(e){function t(t,n,r){void 0===n&&(n=!1),void 0===r&&(r=!0);var i=e.call(this)||this;i._id=t,i._displayName="",i._isAgent=!1,i._isGuest=!1,i._isPstn=!1,i._isBlocked=!1,i._isFavorite=!1,i._avatarData="",i._email="",i._setAvatarDataIfValidUrl=function(e,t){u.loadAvatarUri(e,function(e){i.avatarData=e},t)},i.getPersonData=function(){if(i.displayName&&i.avatarData&&i._isFilled)return Promise.resolve();if(i._isFilled=!0,i.isAgent||i.isPstn)return Promise.resolve();if(i._ongoingStratusRequest)return i._ongoingStratusRequest;var e=function(e){p.default.throwError(10801,"Unable to resolve user details",e)};if(i._isMePerson){i._ongoingStratusRequest=f.ServicesManager.stratusService.fetchMeProperties().then(function(e){if(e){var t=e.firstname||"";t+=e.lastname?" "+e.lastname:"",i.displayName=t||i.displayName;var n=e.avatarUrl||e.avatarData;i._setAvatarDataIfValidUrl(n)}},e)}else{if(!i.shouldFetchProfile())return Promise.resolve();i._ongoingStratusRequest=f.ServicesManager.stratusService.fetchPerson(i._id).then(function(e){var t=(e=e||[]).filter(function(e){return e.username===i._id||e.username===i._mri})[0];if(t){var n=t.displayname?t.displayname:"",r=t.username?t.username:"",o=n||r;o&&(i.displayName=o),i._id===i._mri&&(i._mri=(i.isAgent?"28:":"8:")+i._id),t.avatarUrl&&i._setAvatarDataIfValidUrl(t.avatarUrl,function(){}),t.avatarData&&(i.avatarData=t.avatarData)}else p.default.throwError(10801,"Unable to resolve user details")},e)}return i._ongoingStratusRequest},i.getDataFromContactsService=function(){return i._ongoingContactsRequest?i._ongoingContactsRequest:i.isPstn?Promise.resolve():(i._ongoingContactsRequest=f.ServicesManager.signInManager.getSkypeToken().then(function(){var e=f.ServicesManager.signInManager.currentUserName;return e.indexOf("guest")>-1||i.isGuest||i._isMePerson?i._fetchDisplayNameAndAvatar():f.ServicesManager.contactsService.getContact(e,i._mri).then(function(e){if(e){var t=e.avatar,n=e.display_name;return t||(t=e.profile?e.profile.avatar_url:""),n&&(i.displayName=n),t?i._setAvatarDataIfValidUrl(t):i._fetchDisplayNameAndAvatar(),i._ongoingContactsRequest=null,""}return i._ongoingContactsRequest=null,i._fetchDisplayNameAndAvatar()},function(){return i._ongoingContactsRequest=null,i._fetchDisplayNameAndAvatar()})},function(){return i._ongoingContactsRequest=null}),i._ongoingContactsRequest)};var o=/^\d+:/;o.test(i._id)?(i._mri=i._id,i._id=i.id.replace(o,"")):i._mri="8:"+i._id,i._mri.indexOf("https://");var s=d.default.normalizePersonId(i._id);return s!==i._id&&(i._id=s),i._isAgent=n||i._mri.indexOf("28:")>-1,i._isGuest=i._id.indexOf(h)>-1,i._isPstn=i._mri.indexOf("4:")>-1,i._description="",i._isMePerson=i._id===f.ServicesManager.signInManager.currentUserName||d.default.normalizePersonId(i._id)===f.ServicesManager.signInManager.currentUserName,r&&i.fetchDisplayNameAndAvatar(),i}return i(t,e),Object.defineProperty(t.prototype,"isAgent",{get:function(){return this._isAgent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPstn",{get:function(){return this._isPstn},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBlocked",{get:function(){return this._isBlocked},set:function(e){e!==this._isBlocked&&(this._isBlocked=e,this.publish("isBlocked",this._isBlocked))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFavorite",{get:function(){return this._isFavorite},set:function(e){e!==this._isFavorite&&(this._isFavorite=e,this.publish("isFavorite",this._isFavorite))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isGuest",{get:function(){return this._isGuest},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mri",{get:function(){return this._mri},set:function(e){this._mri=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayName",{get:function(){return this._displayName||this.fetchDisplayNameAndAvatar(),this._displayName},set:function(e){this.setDisplayName(e)},enumerable:!0,configurable:!0}),t.prototype.setDisplayName=function(e){e&&e!==this._displayName&&(this._displayName=l.MessageUtils.parseTopic(e),this.publish("displayName",this._displayName))},t.prototype.getDisplayName=function(){return this._displayName},Object.defineProperty(t.prototype,"description",{get:function(){return this._description},set:function(e){e!==this._description&&(this._description=e,this.publish("description",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"avatarData",{get:function(){return o.default.get.isTeams()?(e=this._mri,t=this._displayName,n=s.Configuration.TEAMS_MIDDLE_TIER_URL+"/beta/users/"+e+"/profilepicturev2",r={displayname:t},c.addGetParamsToUrl(n,r)):this._avatarData;var e,t,n,r},set:function(e){e!==this._avatarData&&(this._avatarData=e,this.publish("avatarData",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extraLargeAvatarUrl",{get:function(){return this.extraLargeAvatarUrl},set:function(e){e!==this._extraLargeAvatarUrl&&(this._extraLargeAvatarUrl=e,this.publish("extraLargeAvatarUrl",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"email",{get:function(){return this._email},set:function(e){e!==this._email&&(this._email=e,this.publish("email",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"presenceStatus",{get:function(){return this._presenceStatus},set:function(e){this._presenceStatus!==e&&(this._presenceStatus=e,this.publish("presenceStatus",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFilled",{get:function(){return this._isFilled},enumerable:!0,configurable:!0}),t.prototype.fetchDisplayNameAndAvatar=function(){return this.isFilled?Promise.resolve():this.getDataFromContactsService()},t.prototype._fetchDisplayNameAndAvatar=function(){var e=this;return this._isFilled=!0,this.isAgent?f.ServicesManager.agentsService.getAgentDetails(this._id).then(function(t){if(t&&t.agentDescriptions&&1===t.agentDescriptions.length){var n=t.agentDescriptions[0].displayName;e._description=t.agentDescriptions[0].description,e._setAvatarDataIfValidUrl(t.agentDescriptions[0].userTileExtraLargeUrl),n&&(e.displayName=n)}return e._displayName}):this.getPersonData().then(function(){return e.displayName})},t.prototype.shouldFetchProfile=function(){return this._mri.indexOf("8:")>-1&&(!o.default.get.isTeams()||o.default.get.isTeams()&&!this._displayName)},t}(a.default);t.default=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(9),o=n(521),s=function(){function e(){var e=this;this.pesManager=null,this.isLoading=!1,this.setLoadingFinished=function(){e.isLoading=!1},this.init=function(){return e.initSkype()},this.canRenderConfigItems=function(){return e.pesManager.canRenderConfigItems()},this.getConfiguration=function(){return new Promise(function(t,n){e.config?t(e.config):e.init().then(function(n){t(e.config)})})},this.pesManager=new o.PesManager}return e.prototype.refresh=function(){this.pesManager.refresh()},e.prototype.initSkype=function(){var e=this;return this.getConfigurationPromise?this.getConfigurationPromise:(this.isLoading=!0,this.getConfigurationPromise=new Promise(function(t,n){r.swc.services.mePersonManager.fetch().then(function(n){e.pesManager.isInitialized||e.pesManager.init(n.id).then(function(n){e.config=n,e.setLoadingFinished(),t(e.config)},e.setLoadingFinished)},function(t){e.setLoadingFinished(),n(t),i.default.throwError(10503,"Unable to fetch me person and load PES",t)})}),this.getConfigurationPromise)},Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this.isLoading||this.pesManager.isInitialized},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"map",{get:function(){return this.pesManager.map},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emoticonMap",{get:function(){return this.pesManager.emoticonMap},enumerable:!0,configurable:!0}),e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.SMALL="small",e.LARGE="large",e.EXTRA_LARGE="extraLarge",e.SUPER_LARGE="superLarge"}(t.ITEM_SIZES||(t.ITEM_SIZES={})),t.STATIC_MEDIA_INFO={firstFrame:0,framesCount:1,fps:1},function(e){e.camel="drawState",e.dash="draw-state"}(t.DRAW||(t.DRAW={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._items={}}return Object.defineProperty(e.prototype,"length",{get:function(){return Object.keys(this._items).length},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this._items={}},e.prototype.getItem=function(e){return this._items[e]},e.prototype.key=function(e){return null},e.prototype.removeItem=function(e){delete this._items[e]},e.prototype.setItem=function(e,t){this._items[e]=t},e}();t.MemoryStorage=r},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var n=e.call(this)||this;return n.lastReadMessageTimestamp=-1,n.modificationTime=-1,n.lastReadMessageId="",n.value="",t&&n.set(t),n}return i(t,e),t.prototype.set=function(e,t){if(e){var n=e.split(";");this.lastReadMessageTimestamp=Number(n[0]),this.modificationTime=Number(n[1]),this.lastReadMessageId=n[2],this.value=e,!0===t&&this.publish("value",this.value)}},t}(n(10).default);t.ConsumptionHorizon=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.callbacks=[]}return e.prototype.subscribe=function(e){return 0===this.callbacks.filter(function(t){return t===e}).length&&(this.callbacks.push(e),!0)},e.prototype.unsubscribe=function(e){this.callbacks=this.callbacks.filter(function(t){return t!==e})},e.prototype.notify=function(e){this.callbacks.forEach(function(t){t(e)})},e.prototype.dispose=function(){delete this.callbacks},e}();t.SubscribeableStore=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(157),i=function(){function e(){}return e.getSentMessageType=function(t){switch(t){case r.MessageType.FILE:case r.MessageType.IMAGE:return e.File;case r.MessageType.SWIFT:return e.Card;default:return e.Text}},e.getReceivedMessageType=function(t){switch(t){case"":return e.File;default:return e.Text}},e.Text="text",e.File="file",e.Card="card",e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(14),o=n(296),s=function(){function e(){}return e._processUsers=function(e,t){for(var n=r.swc.services.mePersonManager.mePerson,s=0;s<e.users.length;s++){var a=null,c=e.users[s],u=o.default.normalizePersonId(c.mri);c.person=n.id===u?n:r.swc.services.persons.getPerson(c.mri,!0),c.value=c.value?i.MessageUtils.getMessageSanitizedContent(c.value):"";for(var l=0;l<t.users.length;l++){var p=t.users[l];if(c.mri===p.mri){a=p;break}}a||t.users.push(c)}},e.parseMessageProperties=function(t,n){n.properties&&t.supportedAnnotations.forEach(function(r){var i=n.properties?n.properties[r]:[],o=t[r];if(i)for(var s=function(t){var n=null,r=i[t];r&&"reactionsConsumptionHorizon"!==r.key&&function(){for(var t=0;t<o.length;t++){var i=o[t];r.key===i.key&&(n=i)}n||(n={key:r.key,users:[]},o.pushObservable(n)),e._processUsers(r,n)}()},a=0;a<i.length;a++)s(a)})},e.updateMessageProperties=function(e,t){t&&e.supportedAnnotations.forEach(function(n){var r=e[n],i=t[n];r&&i&&(r.spliceObservable(0,r.length),i&&i.forEach(function(e){r.pushObservable(e)}))})},e}();t.default=s},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(286),i=n(140),o=n(4),s=n(161),a=n(5),c=n(181),u=n(106),l=n(68),p=n(30),d=n(463),f=n(74),h=n(13),g=n(162),m=n(0),v=n(28),y=n(585),_=n(15),b=n(587),S=s.default.build("SkypeWebControl",window);!function(){var e=function(){m.swc.Eventing=m.swc.Eventing||i.default,m.swc.Eventing.connect("services"),s.default.alias(c.SVG,"Assets.SVG",m.swc);var e=function(){return b.vendorLoader.preloadDeps().then(function(){S.services=S.services||h.ServicesManager,m.swc.Eventing.registerEvent(o.ServicesEvents.Init,function(e){return e&&function(e){e&&(e.tokenProvider&&(e.tokenProvider=y.createClientFromPlaceHolder(e.tokenProvider)),e.enterpriseAuth&&(e.enterpriseAuth={skypetokenProvider:y.createClientFromPlaceHolder(e.enterpriseAuth.skypetokenProvider),regionGtmsProvider:y.createClientFromPlaceHolder(e.enterpriseAuth.regionGtmsProvider)})),l.default.initServices(e),m.swc.services.signInManager.onceSignedIn().then(function(){return m.swc.services.polling.authorization.then(function(){})}),m.swc.services.initManagers(v.LocaleInfo.instance.getLocale(),{tokenProvider:e.skypeTokenProvider||e.tokenProvider,initialToken:e.initialSkypeTokenData,externalLogin:e.externalLogin,tokenType:e.tokenType,enterpriseAuth:e.enterpriseAuth},{fileSharing:e.fileSharing,userSettings:e.userSettings}).then(function(){l.default.instance.SignInManager,m.swc.services.persons,r.AbilityHelpers.announcer.setup({title:m.swc.services.i18n.fetch("recent_notification_announcements")}),r.AbilityHelpers.outline.setup({areaClass:"swc-focus-outline-area"}),m.swc.Eventing.triggerEvent(o.ServicesEvents.Ready)})}(e)}),m.swc.Eventing.registerEvent("createModule",function(e){var t="";switch(e.module){case u.ModuleType.Calling:t=p.PackageName.CALLING_STANDALONE;break;case u.ModuleType.Recents:t=p.PackageName.RECENTS_BUNDLE;break;case u.ModuleType.Messaging:default:t=p.PackageName.CHAT_BUNDLE}if(t){m.swc.options=m.swc.options||{},m.swc.options[e.module]=e.options;var n=_.UrlHelper.getAbsoluteUrl(t,"js");m.swc.scriptLoader.addScript(n)}}),m.swc.Eventing.triggerEvent(o.ServicesEvents.Loaded,null,!0)})};if(m.swc.Telemetry)e();else{m.swc.scriptLoader.addScript("telemetry-bundle",!0,function(){var t=g.createTelemetryConfigFromEcs(m.swc.EcsConfig);m.swc.Telemetry.init(m.swc.initSettings.env,t),window.swc.Telemetry=m.swc.Telemetry,e()})}};if(m.swc.framed){var t=function(){var t;(m.swc.initSettings.env,t={Environment:m.swc.initSettings.env,Host:document.referrer,Platform:m.swc.initSettings.platform},f.configLoader("SkypeWebControl",t)).then(function(t){m.swc.EcsConfig=t.SWC,m.swc.EcsHeaderConfig=t.Headers;var n=t.SWC.enableExtendedFrameApiOn;n&&-1!==n.indexOf(m.swc.initSettings.parent)&&(m.swc.isTrustedHost=!0),e(),a.default.get.frameless=!1,parent&&m.swc.Eventing.addTarget("core","core",m.swc.initSettings.parent,parent)})};if(d.shouldPolyfill()){var n=document.createElement("script");n.type="text/javascript",n.src="https://"+location.host+"/vendors/polyfills.min.js",n.onload=function(){return t()},document.head.appendChild(n),document.createElement("script")}else t()}else e()}()},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i={title:"Latest accessibility announcements",historyLength:10},o=function(){function e(e){this._props=i,this._announcements=[],this._mainWindow=e}return e.prototype.setup=function(e){this._props=r({},this._props,e),e.title&&this._container&&this._container.setAttribute("aria-label",e.title),e.historyLength&&this._shrinkHistory()},e.prototype.dispose=function(){var e=this;this._container&&(this._cleanupTimer&&(this._mainWindow.clearTimeout(this._cleanupTimer),this._cleanupTimer=void 0),this._announcements.forEach(function(t){t.timer&&(e._mainWindow.clearTimeout(t.timer),t.timer=void 0)}),this._announcements=[],this._container.parentNode&&(this._container.parentNode.removeChild(this._container),this._container=void 0))},e.prototype.announce=function(e){if(e.trim()&&(this._container||this._init(),this._container)){var t=document.createElement("div");t.setAttribute("role","log"),t.setAttribute("aria-live","polite");var n=t.style;n.position="absolute",n.left=n.top=n.right=n.bottom="0";var r={node:t};r.timer=this._mainWindow.setTimeout(function(){delete r.timer,r.node.innerText=e},100),this._announcements.push(r),this._container.appendChild(t),this._shrinkHistory()}},e.prototype._shrinkHistory=function(){if(this._container)for(;this._announcements.length>this._props.historyLength;){var e=this._announcements.shift();e&&(e.timer&&this._mainWindow.clearTimeout(e.timer),this._container.removeChild(e.node))}},e.prototype._init=function(){if(!this._container){this._container=document.createElement("div"),this._container.setAttribute("role","list"),this._container.setAttribute("aria-label",this._props.title);var e=this._container.style;e.position="absolute",e.overflow="hidden",e.width=e.height="1px",e.right=e.bottom="0",e.opacity="0",e.zIndex="-1",this._mainWindow.document.body.appendChild(this._container)}},e}();t.Announcer=o},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(261),s=n(287),a="ability-helpers:focused-element-related",c=function(e){function t(t){var n=e.call(this)||this;return n._init=function(){n._initTimer=void 0,n._mainWindow.document.body.addEventListener("focusin",n._onFocusIn,!0),n._mainWindow.document.body.addEventListener("focusout",n._onFocusOut,!0),n._mainWindow.addEventListener(a,n._onIFrameEvent,!0)},n._onFocusIn=function(e){n._setFocusedElement(e.target,e.relatedTarget||void 0)},n._onFocusOut=function(e){n._setFocusedElement(void 0,e.relatedTarget||void 0)},n._onIFrameEvent=function(e){if(e.targetDetails)switch(e.targetDetails.descriptor.name){case"focusin":n._setFocusedElement(e.targetDetails.target,e.originalEvent.relatedTarget||void 0);break;case"focusout":n._setFocusedElement(void 0,e.originalEvent.relatedTarget||void 0)}},n._mainWindow=t,n._initTimer=n._mainWindow.setTimeout(n._init,0),n}return i(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this),this._initTimer&&(this._mainWindow.clearTimeout(this._initTimer),this._initTimer=void 0),this._mainWindow.document.body.removeEventListener("focusin",this._onFocusIn,!0),this._mainWindow.document.body.removeEventListener("focusout",this._onFocusOut,!0),this._mainWindow.removeEventListener(a,this._onIFrameEvent,!0)},t.prototype.getFocusedElement=function(){return this.getVal()},t.prototype._setFocusedElement=function(e,t){this.setVal(e,{relatedTarget:t})},t}(s.Subscribable);t.FocusedElementState=c,t.setupFocusedElementStateInIFrame=function(e,t){o.setupIFrameToMainWindowEventsDispatcher(e,t,a,[{type:o.EventFromIFrameDescriptorType.Document,name:"focusin",capture:!0},{type:o.EventFromIFrameDescriptorType.Document,name:"focusout",capture:!0}])}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(261),a=n(287),c=n(154),u="ability-helpers:keyboard-navigation-related",l=9,p=27,d={extendedDetectionInside:!1,extendedDetectionOutside:!1},f=function(e){function t(t){var n=e.call(this)||this;return n._props=d,n._isMouseUsed=!1,n._init=function(){n._initTimer=void 0,n._mainWindow.document.body.addEventListener("mousedown",n._onMouseDown,!0),n._mainWindow.addEventListener("keydown",n._onKeyDown,!0),n._mainWindow.addEventListener(u,n._onIFrameEvent,!0),c.AbilityHelpers.focusedElement.subscribe(n._onElementFocused)},n._onMouseDown=function(e){n._isMouseUsed=!0,n.setVal(!1,void 0)},n._onKeyDown=function(e){var t=n.isNavigatingWithKeyboard();t||e.keyCode!==l?t&&e.keyCode===p&&n._scheduleDismiss():n.setVal(!0,void 0)},n._onIFrameEvent=function(e){if(e.targetDetails)switch(e.targetDetails.descriptor.name){case"mousedown":n._onMouseDown(e.originalEvent);break;case"keydown":n._onKeyDown(e.originalEvent)}},n._onElementFocused=function(e,t){if(e)if(n._isMouseUsed)n._isMouseUsed=!1;else if(t.relatedTarget&&(n._props.extendedDetectionInside||n._props.extendedDetectionOutside)){if(c.AbilityHelpers.focusDeloser.isElementInContainer(e)){if(!n._props.extendedDetectionInside)return}else if(!n._props.extendedDetectionOutside)return;c.AbilityHelpers.focusables._getLastFocusedProgrammatically(!0)!==e&&n.setVal(!0,void 0)}},n._mainWindow=t,n._initTimer=n._mainWindow.setTimeout(n._init,0),n}return i(t,e),t.prototype.setup=function(e){this._props=o({},this._props,e)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._initTimer&&(this._mainWindow.clearTimeout(this._initTimer),this._initTimer=void 0),this._dismissTimer&&(this._mainWindow.clearTimeout(this._dismissTimer),this._dismissTimer=void 0),this._mainWindow.document.body.removeEventListener("mousedown",this._onMouseDown,!0),this._mainWindow.removeEventListener("keydown",this._onKeyDown,!0),this._mainWindow.removeEventListener(u,this._onIFrameEvent,!0),c.AbilityHelpers.focusedElement.unsubscribe(this._onElementFocused)},t.prototype.isNavigatingWithKeyboard=function(){return this.getVal()||!1},t.prototype._scheduleDismiss=function(){var e=this;this._dismissTimer&&(this._mainWindow.clearTimeout(this._dismissTimer),this._dismissTimer=void 0);var t=c.AbilityHelpers.focusedElement.getFocusedElement();this._dismissTimer=this._mainWindow.setTimeout(function(){e._dismissTimer=void 0;var n=c.AbilityHelpers.focusedElement.getFocusedElement();t&&n&&t===n&&e.setVal(!1,void 0)},500)},t}(a.Subscribable);t.KeyboardNavigationState=f,t.setupKeyboardNavigationStateInIFrame=function(e,t){s.setupIFrameToMainWindowEventsDispatcher(e,t,u,[{type:s.EventFromIFrameDescriptorType.Document,name:"mousedown",capture:!0},{type:s.EventFromIFrameDescriptorType.Window,name:"keydown",capture:!0}])}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i,o,s=n(261),a=n(154),c="ability-helpers:outline-related",u={areaClass:"focus-outline-area",outlineClass:"focus-outline",outlineColor:"#ff4500",outlineWidth:2,zIndex:2147483647};"onfullscreenchange"in document?(i="fullscreenchange",o="fullscreenElement"):"onwebkitfullscreenchange"in document?(i="webkitfullscreenchange",o="webkitFullscreenElement"):"onmozfullscreenchange"in document?(i="mozfullscreenchange",o="mozFullScreenElement"):"onmsfullscreenchange"in document&&(i="msfullscreenchange",o="msFullscreenElement");var l=function(){function e(e,t,n,r){this.left=e,this.top=t,this.right=n,this.bottom=r}return e.prototype.equalsTo=function(e){return this.left===e.left&&this.top===e.top&&this.right===e.right&&this.bottom===e.bottom},e.prototype.clone=function(){return new e(this.left,this.top,this.right,this.bottom)},e}(),p=function(){function e(t){var n=this;this._props=u,this._isVisible=!1,this._allOutlineElements=[],this._init=function(){n._initTimer=void 0,a.AbilityHelpers.keyboardNavigation.subscribe(n._onKeyboardNavigationStateChanged),a.AbilityHelpers.focusedElement.subscribe(n._onElementFocused),n._mainWindow.addEventListener("scroll",n._onScroll,!0),n._mainWindow.addEventListener(c,n._onIFrameEvent,!0),i&&n._mainWindow.document.addEventListener(i,n._onFullScreenChanged)},this._onFullScreenChanged=function(e){if(o&&e.target){var t=e.target.body||e.target,r=n._getOutlineDOM(t);if(t.ownerDocument&&r){var i=t.ownerDocument[o];i?(i.appendChild(r.container),n._fullScreenElement=i):(t.ownerDocument.body.appendChild(r.container),n._fullScreenElement=void 0)}}},this._onKeyboardNavigationStateChanged=function(e){n._outlinedElement=e?a.AbilityHelpers.focusedElement.getFocusedElement():void 0,n._setOutlinePosition()},this._onElementFocused=function(e){if(n._outlinedElement=void 0,n._updateTimer&&(n._mainWindow.clearTimeout(n._updateTimer),n._updateTimer=void 0),n._curPos=void 0,a.AbilityHelpers.keyboardNavigation.isNavigatingWithKeyboard())if(e){if("INPUT"===e.tagName){if(!(e.type in{button:!0,checkbox:!0,file:!0,image:!0,radio:!0,range:!0,reset:!0,submit:!0}))return}else if("TEXTAREA"===e.tagName)return;if(!n._shouldShowCustomOutline(e))return;n._updateTimer=n._mainWindow.setTimeout(function(){n._updateTimer=void 0,n._outlinedElement=e,n._updateOutline()},0)}else n._setOutlinePosition()},this._onIFrameEvent=function(e){if(e.targetDetails)switch(e.targetDetails.descriptor.name){case"scroll":n._onScroll(e.originalEvent);break;case i:n._onFullScreenChanged(e.originalEvent)}},this._onScroll=function(t){n._outlinedElement&&e._isParentChild(t.target,n._outlinedElement)&&(n._scrollTimer&&n._mainWindow.clearTimeout(n._scrollTimer),n._curPos=void 0,n._setOutlinePosition())},this._mainWindow=t,this._mainWindow.setTimeout(this._init,0)}return e.prototype.setup=function(e){this._props=r({},this._props,e)},e.prototype.dispose=function(){var e=this;this._initTimer&&(this._mainWindow.clearTimeout(this._initTimer),this._initTimer=void 0),this._updateTimer&&(this._mainWindow.clearTimeout(this._updateTimer),this._updateTimer=void 0),this._scrollTimer&&(this._mainWindow.clearTimeout(this._scrollTimer),this._scrollTimer=void 0),a.AbilityHelpers.keyboardNavigation.unsubscribe(this._onKeyboardNavigationStateChanged),a.AbilityHelpers.focusedElement.unsubscribe(this._onElementFocused),this._mainWindow.removeEventListener("scroll",this._onScroll,!0),this._mainWindow.removeEventListener(c,this._onIFrameEvent,!0),i&&this._mainWindow.document.removeEventListener(i,this._onFullScreenChanged),this._allOutlineElements.forEach(function(t){return e._removeOutlineDOM(t.container)}),this._allOutlineElements=[]},e.prototype._shouldShowCustomOutline=function(e){for(var t=e;t;t=t.parentNode)if(t.classList&&t.classList.contains(this._props.areaClass))return!0;return!1},e.prototype._updateOutline=function(){var e=this;this._setOutlinePosition(),this._updateTimer&&this._mainWindow.clearTimeout(this._updateTimer),this._updateTimer=this._mainWindow.setTimeout(function(){e._updateTimer=void 0,e._updateOutline()},30)},e.prototype._setOutlineVisibility=function(e){this._isVisible=e,this._curOutlineElements&&(e?this._curOutlineElements.container.classList.add(this._props.outlineClass+"_visible"):this._curOutlineElements.container.classList.remove(this._props.outlineClass+"_visible"))},e.prototype._setOutlinePosition=function(){if(this._outlinedElement){var e=this._outlinedElement.getBoundingClientRect(),t=new l(e.left,e.top,e.right,e.bottom);if(!this._curPos||!t.equalsTo(this._curPos)){var n=this._getOutlineDOM(this._outlinedElement),r=this._outlinedElement.ownerDocument&&this._outlinedElement.ownerDocument.defaultView;if(n&&r){this._curOutlineElements!==n&&(this._setOutlineVisibility(!1),this._curOutlineElements=n),this._curPos=t;var i=t.clone(),o=!1,s=n.container;if(s.parentElement){for(var a=this._outlinedElement.parentElement;a&&a!==this._fullScreenElement;a=a.parentElement){e=a.getBoundingClientRect();var c=a.ownerDocument&&a.ownerDocument.defaultView;if(!c)return;var u=c.getComputedStyle(a);"absolute"===u.position&&(o=!0),o&&"hidden"!==u.overflow||(e.left>i.left&&(i.left=e.left),e.top>i.top&&(i.top=e.top),e.right<i.right&&(i.right=e.right),e.bottom<i.bottom&&(i.bottom=e.bottom))}var p=s.parentElement.clientWidth,d=s.parentElement.clientHeight,f=this._props.outlineWidth;i.left=i.left>f?i.left-f:0,i.top=i.top>f?i.top-f:0,i.right=i.right<p-f?i.right+f:p,i.bottom=i.bottom<d-f?i.bottom+f:d;var h=i.right-i.left,g=i.bottom-i.top;if(h>2*f&&g>2*f){var m=n.left,v=n.top,y=n.right,_=n.bottom,b=this._fullScreenElement?0:r.scrollX,S=this._fullScreenElement?0:r.scrollY;m.style.left=v.style.left=_.style.left=i.left+b+"px",y.style.left=i.left+b+h-f+"px",m.style.top=y.style.top=v.style.top=i.top+S+"px",_.style.top=i.top+S+g-f+"px",m.style.height=y.style.height=g+"px",v.style.width=_.style.width=h+"px",this._setOutlineVisibility(!0)}else this._setOutlineVisibility(!1)}}}}else this._isVisible&&this._setOutlineVisibility(!1)},e.prototype._getOutlineDOM=function(e){var t=e.ownerDocument,n=t&&t.defaultView;if(t&&n&&n.__abilityHelpers){if(!n.__abilityHelpers.outline){var r={style:d(t,this._props),container:t.createElement("div"),left:t.createElement("div"),top:t.createElement("div"),right:t.createElement("div"),bottom:t.createElement("div")};r.container.className=this._props.outlineClass,r.left.className=this._props.outlineClass+"__left",r.top.className=this._props.outlineClass+"__top",r.right.className=this._props.outlineClass+"__right",r.bottom.className=this._props.outlineClass+"__bottom",r.container.appendChild(r.left),r.container.appendChild(r.top),r.container.appendChild(r.right),r.container.appendChild(r.bottom),t.body.appendChild(r.container),n.__abilityHelpers.outline=r}return n.__abilityHelpers.outline}},e.prototype._removeOutlineDOM=function(e){var t=e.ownerDocument&&e.ownerDocument.defaultView,n=t&&t.__abilityHelpers&&t.__abilityHelpers.outline;n&&(n.container.parentNode&&n.container.parentNode.removeChild(n.container),n.style.parentNode&&n.style.parentNode.removeChild(n.style),delete t.__abilityHelpers.outline)},e._isParentChild=function(e,t){return t===e||!!(e.compareDocumentPosition(t)&document.DOCUMENT_POSITION_CONTAINED_BY)},e}();function d(e,t){var n=e.createElement("style");return n.type="text/css",n.appendChild(e.createTextNode(function(e){return"\n        ."+e.areaClass+" *, ."+e.areaClass+" *:focus {\n            outline: none !important;\n        }\n\n        ."+e.outlineClass+" {\n            display: none;\n            position: absolute;\n            background: "+e.outlineColor+";\n            width: 0;\n            height: 0;\n            left: 0;\n            top: 0;\n            z-index: "+e.zIndex+";\n        }\n\n        ."+e.outlineClass+"."+e.outlineClass+"_visible {\n            display: block;\n        }\n\n        ."+e.outlineClass+"__left {\n            position: absolute;\n            background: inherit;\n            width: "+e.outlineWidth+"px;\n            height: "+e.outlineWidth+"px;\n            border-top-left-radius: "+e.outlineWidth+"px;\n            border-bottom-left-radius: "+e.outlineWidth+"px;\n        }\n\n        ."+e.outlineClass+"__top {\n            position: absolute;\n            background: inherit;\n            width: "+e.outlineWidth+"px;\n            height: "+e.outlineWidth+"px;\n            border-top-left-radius: "+e.outlineWidth+"px;\n            border-top-right-radius: "+e.outlineWidth+"px;\n        }\n\n        ."+e.outlineClass+"__right {\n            position: absolute;\n            background: inherit;\n            width: "+e.outlineWidth+"px;\n            height: "+e.outlineWidth+"px;\n            border-top-right-radius: "+e.outlineWidth+"px;\n            border-bottom-right-radius: "+e.outlineWidth+"px;\n        }\n\n        ."+e.outlineClass+"__bottom {\n            position: absolute;\n            background: inherit;\n            width: "+e.outlineWidth+"px;\n            height: "+e.outlineWidth+"px;\n            border-bottom-left-radius: "+e.outlineWidth+"px;\n            border-bottom-right-radius: "+e.outlineWidth+"px;\n        }"}(t))),e.head.appendChild(n),n}t.Outline=p,t.setupOutlineInIFrame=function(e,t){var n=[{type:s.EventFromIFrameDescriptorType.Window,name:"scroll",capture:!0}];i&&n.push({type:s.EventFromIFrameDescriptorType.Document,name:i,capture:!1}),s.setupIFrameToMainWindowEventsDispatcher(e,t,c,n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(154),i=10,o=function(){function e(e){this.isFocusInside=!1,this._history=[],this._container=e}return e.prototype.dispose=function(){this.isFocusInside=!1,this._history=[],this._container=void 0},e.prototype.unshift=function(e){for(this._history=this._history.filter(function(t){return t!==e}),this._history.unshift(e);this._history.length>i;)this._history.pop()},e.prototype.focusDefault=function(){var e=this._findDefaultFocusable();return e?(r.AbilityHelpers.focusables.focus(e),!0):this.resetFocus()},e.prototype.resetFocus=function(){if(!this._container||!this.isVisible())return!1;if(r.AbilityHelpers.focusables.isFocusable(this._container))r.AbilityHelpers.focusables.focus(this._container);else{var t=this._container.getAttribute("tabindex"),n=this._container.getAttribute("aria-hidden");this._container.tabIndex=-1,this._container.setAttribute("aria-hidden","true"),e.lastResetElement=this._container,r.AbilityHelpers.focusables.focus(this._container,!0),this._setOrRemoveAttribute(this._container,"tabindex",t),this._setOrRemoveAttribute(this._container,"aria-hidden",n)}return!0},e.prototype.findAvailable=function(e){if(this._container&&this.isVisible()){for(var t=function(t){var i=n._history[t];if(n._isInDOM(i)){if(r.AbilityHelpers.focusables.isFocusable(i))return{value:i}}else if(!e){var o=[];if(i.id&&o.push("#"+i.id),i.className&&i.className.split(" ").forEach(function(e){(e=e.trim())&&o.push("."+e)}),o.length){o.unshift(i.tagName.toLowerCase());for(var s=n._container.querySelectorAll(o.join("")),a=0;a<s.length;a++){var c=s[a];if(c&&r.AbilityHelpers.focusables.isFocusable(c))return{value:c}}}}},n=this,i=0;i<this._history.length;i++){var o=t(i);if("object"==typeof o)return o.value}return e?void 0:this._findDefaultFocusable()}},e.prototype.isVisible=function(){return!!this._container&&r.AbilityHelpers.focusables.isVisible(this._container)},e.prototype.clearHistory=function(e){var t=this;this._history=this._history.filter(function(n){return!!e&&t._isInDOM(n)})},e.prototype._findDefaultFocusable=function(){if(this._container&&r.AbilityHelpers.focusables.isVisible(this._container)){for(var e=this._container.querySelectorAll(".ability-helpers-default-focusable"),t=0;t<e.length;t++){var n=e[t];if(n&&r.AbilityHelpers.focusables.isFocusable(n))return n}return r.AbilityHelpers.keyboardNavigation.isNavigatingWithKeyboard()?r.AbilityHelpers.focusables.getFocusables(this._container)[0]:void 0}},e.prototype._isInDOM=function(e){return!!this._container&&!(this._container.compareDocumentPosition(e)&document.DOCUMENT_POSITION_DISCONNECTED)},e.prototype._setOrRemoveAttribute=function(e,t,n){null===n?e.removeAttribute(t):e.setAttribute(t,n)},e}(),s=function(){function e(e){var t=this;this._isInSomeContainer=!1,this._history=[],this._init=function(){t._initTimer=void 0,r.AbilityHelpers.focusedElement.subscribe(t._onElementFocused)},this._onElementFocused=function(e){if(t._restoreFocusTimer&&(t._mainWindow.clearTimeout(t._restoreFocusTimer),t._restoreFocusTimer=void 0),!e){var n=t._curFocusedElement;return t._curFocusedElement=void 0,n&&n===o.lastResetElement||t._scheduleRestoreFocus(!0),void(o.lastResetElement=void 0)}var s;t._curFocusedElement=e;for(var a=e;a;){if(a.__focusDeloser){s=a;break}a=a.parentNode}if(s&&s.__focusDeloser){t._isInSomeContainer=!0;var c=s.__focusDeloser;for(c!==t._curContainer&&(t._curContainer&&(t._curContainer.isFocusInside=!1),t._curContainer=c,c.isFocusInside=!0),t._history=t._history.filter(function(e){return c!==e}),t._history.unshift(c),r.AbilityHelpers.focusables.isFocusable(e)&&c.unshift(e);t._history.length>i;)t._history.pop()}else t._isInSomeContainer=!1,t._curContainer=void 0},this._mainWindow=e,this._initTimer=this._mainWindow.setTimeout(this._init,0)}return e.prototype.dispose=function(){this._initTimer&&(this._mainWindow.clearTimeout(this._initTimer),this._initTimer=void 0),r.AbilityHelpers.focusedElement.unsubscribe(this._onElementFocused)},e.prototype.addContainer=function(e,t){var n=e;n.__focusDeloser||(n.__focusDeloser=new o(e),t&&n.__focusDeloser.focusDefault())},e.prototype.removeContainer=function(e){var t=e;if(t.__focusDeloser){var n=t.__focusDeloser;this._history=this._history.filter(function(e){return n!==e}),n.isFocusInside&&this._scheduleRestoreFocus(),n.dispose(),delete t.__focusDeloser}},e.prototype.focusContainerDefault=function(e){var t=e;return!!t.__focusDeloser&&t.__focusDeloser.focusDefault()},e.prototype.clearContainerHistory=function(e,t){var n=e;if(n.__focusDeloser)return n.__focusDeloser.clearHistory(t)},e.prototype.getAbilityDefaultFocusableClassName=function(){return"ability-helpers-default-focusable"},e.prototype.isElementInContainer=function(e){for(var t=e;t;t=t.parentNode)if(t.__focusDeloser)return!0;return!1},e.prototype._scheduleRestoreFocus=function(e){var t=this;this._restoreFocusTimer=this._mainWindow.setTimeout(function(){if(t._restoreFocusTimer=void 0,t._isInSomeContainer){if(e&&t._curContainer&&t._curContainer.isVisible()){if(t._curContainer.findAvailable(!0))return;var n=t._curContainer.findAvailable();if(n)return void r.AbilityHelpers.focusables.focus(n);if(!n&&t._curContainer.resetFocus())return}t._focusAvailable()||(t._isInSomeContainer=!1,t._curContainer&&(t._curContainer.isFocusInside=!1,t._curContainer=void 0))}},100)},e.prototype._focusAvailable=function(){for(var e=0;e<this._history.length;e++){var t=this._history[e],n=t.findAvailable();if(n)return r.AbilityHelpers.focusables.focus(n),!0;if(t.resetFocus())return!0}return!1},e}();t.FocusDeloser=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=["a[href]","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","*[tabindex]","*[contenteditable]"].join(", "),i=function(){function e(){}return e.prototype.isFocusable=function(e,t){return!!e.matches(r)&&(this.isVisible(e)&&(!!t||this.isAccessible(e)))},e.prototype.isVisible=function(e){if(null===e.offsetParent)return!1;var t=e.ownerDocument&&e.ownerDocument.defaultView;return!!t&&"hidden"!==t.getComputedStyle(e).visibility},e.prototype.isAccessible=function(e){for(var t=e;t&&t.getAttribute;t=t.parentNode){var n=t.getAttribute("aria-hidden");if(n&&"true"===n.toLowerCase())return!1;if((n=t.getAttribute("aria-disabled"))&&"true"===n.toLowerCase())return!1}return!0},e.prototype.getFocusables=function(e,t,n){var i=r+", iframe";return this._getFocusables(e,i,t,n)},e.prototype.focus=function(e,t){return!!this.isFocusable(e,t)&&(this._lastFocusedProgrammatically=e,e.focus(),!0)},e.prototype._getLastFocusedProgrammatically=function(e){var t=this._lastFocusedProgrammatically;return e&&(this._lastFocusedProgrammatically=void 0),t},e.prototype._getFocusables=function(e,t,n,r){for(var i=e.querySelectorAll(t),o=[],s=0;s<i.length;s++){var a=i[s];if((n||this.isVisible(a))&&(r||this.isAccessible(a))){var c=a.contentWindow;c&&c.document&&c.document.body?o.push.apply(o,this._getFocusables(c.document.body,t)):o.push(a)}}return o},e}();t.Focusables=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldPolyfill=function(){return!(Array.prototype.find&&Element.prototype.matches&&Object.assign&&window.CustomEvent&&window.Promise)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(17),o=n(29),s=n(11),a=n(45),c=n(0),u=n(9),l=function(){function e(){var e=this;this.fetch=function(){return e.mePerson?Promise.resolve(e.mePerson):e._mePersonPromise&&e._mePersonPromise.status===i.PromiseStatus.Pending?e._mePersonPromise.promise:(e._mePersonPromise=new i.CancelablePromise(e._fetchMePerson()),e._mePersonPromise.promise.catch(function(e){u.default.throwError(10007,"Unable to fetch me person",e)}),e._mePersonPromise.promise)},this.getFavouriteConversations=function(t){return void 0===t&&(t=!1),e.getMeProperties(t).then(function(e){return e.favorites?JSON.parse(e.favorites):{}})},this.getMeProperties=function(t){return void 0===t&&(t=!1),!t&&e._mePropertiesPromise||(e._mePropertiesPromise=new Promise(function(e,t){c.swc.services.signInManager.userIdentityType!==o.IdentityType.GUEST?c.swc.services.webApi.fetchMeProperties().then(function(t){e(t)}):t()})),e._mePropertiesPromise}}return Object.defineProperty(e.prototype,"mePerson",{get:function(){return c.swc.services.mePerson},enumerable:!0,configurable:!0}),e.prototype.getDetails=function(){var e=this;c.swc.services.signInManager.userIdentityType!==o.IdentityType.GUEST&&(this.getMeProperties().then(function(t){e.fillDetails(t)}),c.swc.services.webApi.getMyPresence().then(function(t){t&&t.status?e.mePerson.presenceStatus=t.status:e.mePerson.presenceStatus=a.PresenceStatus.Offline}),this.mePerson.fetchDisplayNameAndAvatar())},e.prototype.fillDetails=function(e){if(e)if(r.default.get.backend===s.MessagingBackend.TEAMS){var t=e.userDetails?JSON.parse(e.userDetails):{},n=e.personalFileSite?JSON.parse(e.personalFileSite):{},i=e.favorites?JSON.parse(e.favorites):{};n&&(this.mePerson.personalFileSite=n),i&&(this.mePerson.pinnedConversations=i),t.name&&(this.mePerson.displayName=t.name),t.avatarUrl&&(this.mePerson.avatarData=t.avatarUrl),this.mePerson.msaId=t.upn}else this.mePerson.msaId=e.cid},e.prototype.isMe=function(e){return!!this.mePerson&&(this.mePerson.id===e||this.mePerson.msaId===e||this.mePerson.mri===e)},e.prototype._fetchMePerson=function(){var e=this;return this.mePerson?Promise.reject("[skypeConversationsManager] mePerson has been already fetched."):c.swc.services.signInManager.onceSignedIn().then(function(){return e.getDetails(),e.mePerson})},e.prototype.dispose=function(){this._mePersonPromise&&this._mePersonPromise.status!==i.PromiseStatus.Pending&&(this._mePersonPromise=null),this.mePerson&&this.mePerson.dispose()},e}();t.default=l},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(10),s=n(0),a=function(e){function t(){var t=e.call(this)||this;return t.addAgent=function(e){return t._botsService.addAgentToContacts(e)},t.getAgent=function(e){return t._agentsService.getAgentDetails(e)},t._agentsService=s.swc.services.agentsService,t._botsService=s.swc.services.botsService,t}return i(t,e),t}(o.default);t.SkypeAgentsManager=a},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),s=n(0),a=n(92),c=function(e){function t(t,n,r){void 0===r&&(r=!1);var i=e.call(this,n)||this;return i._sharepointService=t,i._useAms=!1,i._useAms=!!r,i}return i(t,e),t.prototype.downloadRawFile=function(e){return this._sharepointService.downloadFile(e)},t.prototype.getFileStatus=function(t){return this._useAms?e.prototype.getFileStatus.call(this,t):Promise.resolve({uploadStatus:this._sharepointService.getFileStatus(t)})},t.prototype.sendFile=function(t,n){return this._useAms?e.prototype.sendFile.call(this,t,n):this.sendFileViaSharepoint(t,n)},t.prototype.sendFileViaSharepoint=function(e,t){var n=this;return(a.isDocumentTypeImage(t.type)?this.createAndUploadAmsDocument(e,t):Promise.resolve({documentId:void 0,uploadPromise:Promise.resolve()})).then(function(r){return n.sendAndShare(e,t,r)})},t.prototype.createAndUploadAmsDocument=function(e,t){var n=this;return this.createAmsDocument(e,t).then(function(r){return{uploadPromise:n.uploadFileContent(e,r.id,t),documentId:r.id}})},t.prototype.sendAndShare=function(e,t,n){var r=this,i=n.documentId,c=n.uploadPromise,u=function(e,t){return{"@type":"http://schema.skype.com/File",version:2,id:Date.now().toString(),baseUrl:"",type:e.type,title:e.name,state:"active",objectUrl:"",providerData:'{"code":null,"type":0}',itemid:"",fileName:e.name,fileType:a.getNameAndExtension(e.name).extension,fileInfo:{fileUrl:"",siteUrl:"",serverRelativeUrl:""},botFileProperties:{},filePreview:{previewUrl:t?URL.createObjectURL(e):void 0},fileChicletState:{serviceName:"p2p",state:"active"}}}(t,i),l=this._sharepointService.checkAndUploadFile(t,u.id),p=l.then(function(e){var t=function(e,t){return{"@type":"http://schema.skype.com/File",version:2,id:e.objectId,baseUrl:e.siteInfo.siteUrl,type:e.type,title:e.title,state:"active",objectUrl:e.objectUrl,providerData:'{"code":null,"type":0}',itemid:e.objectId,fileName:e.title,fileType:e.type,fileInfo:{fileUrl:e.objectUrl,siteUrl:e.siteInfo.siteUrl,serverRelativeUrl:e.serverRelativeUrl},botFileProperties:{},filePreview:{previewUrl:t?o.Configuration.AMS_HOST_URL+"objects/"+t+"/views/imgo":void 0},fileChicletState:{serviceName:"p2p",state:"active"}}}(e.fileCheckValue,i);return{clientMessageId:u.id,files:[t]}}),d=l.then(function(t){var n=t.fileCheckValue,i=t.uploadPromise,o=e.members.map(function(e){return s.swc.services.contactsService.getContact("",e.id)}),a=Promise.all(o).then(function(e){return i.then(function(){var t=e.filter(function(e){return e&&e.email}).map(function(e){return e.email});return r._sharepointService.shareFile(n.objectUrl,t)})});return Promise.all([a,c])});return e.sendFilesAsProperties({clientMessageId:u.id,files:[u],registerPromise:p,uploadPromise:d}),d},t}(n(288).SkypeAmsManager);t.TeamsAmsManager=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(92),o=n(13),s=n(94),a=n(262),c=function(){function e(){}return e.prototype.createNewDocument=function(e,t){var n,r,o={filename:t.name,type:(r=t.type,i.isDocumentTypeImage(r)?"pish/image":"sharing/file"),permissions:(n={},n[e]=[s.Permission[s.Permission.read]],n)};return a.post("createNewDocument","objects",JSON.stringify(o)).then(function(e){return e.json()})},e.prototype.sendFile=function(e,t){var n="objects/"+e+"/content/"+(i.isDocumentTypeImage(t.type)?"imgpsh":"original");return a.putData("sendFile",n,t)},e.prototype.getFileStatus=function(t){var n=e.composeStatusUri(t,"original");return this.getViewStatus(n).then(function(e){return e.scan&&"malware"===e.scan.status?{uploadStatus:s.DocumentStatus.Malware}:"ready"===e.view_state?{uploadStatus:s.DocumentStatus.Success}:e.scan&&"in progress"===e.scan.status?{uploadStatus:s.DocumentStatus.ScanInProgress}:"failed"!==e.view_state?{uploadStatus:s.DocumentStatus.InProgress}:{uploadStatus:s.DocumentStatus.Failed}})},e.prototype.downloadPictureThumbnail=function(t){var n=this,r=e.composeStatusUri(t,"imgt1");return new Promise(function(e){n.getViewUri(r).then(function(t){a.getData("downloadPictureThumbnail",t).then(e)})})},e.prototype.downloadFile=function(t){var n=this,r=e.composeStatusUri(t,"original");return new Promise(function(e){n.getViewUri(r).then(function(t){return a.getData("downloadPicture",t).then(e)})})},e.prototype.downloadPicture=function(t){var n=this,r=e.composeStatusUri(t,"imgpsh_fullsize");return new Promise(function(e){n.getViewUri(r).then(function(t){return a.getData("downloadPicture",t).then(e)})})},e.prototype.getPictureThumbnail=function(e){return new Promise(function(t){return a.get("getPictureThumbnail",e).then(function(e){return a.parseJson(e)}).then(t)})},e.prototype.authenticate=function(){return new Promise(function(e){o.ServicesManager.signInManager.getSkypeToken().then(function(t){var n="skypetoken="+t;return a.postForm("authenticate","skypetokenauth",n).then(e)},function(){})})},e.prototype.logout=function(){return a.get("logout","skypetokenauth/expire")},e.composeStatusUri=function(e,t){return r.Configuration.AMS_HOST_URL+"objects/"+e+"/views/"+t+"/status"},e.prototype.getViewUri=function(e,t){var n=this;return void 0===t&&(t=0),this.getViewStatus(e,t).then(function(t){var r=t.scan&&"malware"===t.scan.status;return!t.view_location||"failed"===t.view_state||r?Promise.reject({}):"ready"!==t.view_state?n.getViewUri(e,500):"expired"===t.content_state?Promise.reject({}):Promise.resolve(t.view_location)})},e.prototype.getViewStatus=function(e,t,n){var r=this;return void 0===t&&(t=0),void 0===n&&(n=3),0===n?Promise.reject({}):new Promise(function(e){setTimeout(e,t)}).then(function(){return a.getJson("getViewStatus",e).then(function(e){return e.status_location&&!e.view_state?r.getViewStatus(e.status_location,t,n):Promise.resolve(e)}).catch(function(i){return 401===i.status||403===i.status?(n--,r.authenticate().then(function(){return r.getViewStatus(e,t,n)})):Promise.reject({})})})},e}();t.AmsService=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(13);t.getHeaders=function(){var e=new Headers,t=r.Configuration.getClientVersion();return new Promise(function(n){i.ServicesManager.signInManager.getSkypeToken().then(function(i){e.append("Authorization","skype_token "+i),r.Configuration.ECS.version&&e.append("X-MS-Client-Version",t),n(e)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13),i=n(470),o=function(){function e(){var e=this;this._agents={},this.addAgentToContacts=function(e,t){var n="relationship/"+t+"/"+e;return i.put("addAgentToContacts",n)},this.getAgentDetails=function(t){if(e._agents[t])return Promise.resolve({agentDescriptions:[e._agents[t]]});var n="agents?agentId="+t;return i.get("getAgentDetails",n).then(function(t){return t&&t.agentDescriptions&&t.agentDescriptions.forEach(function(t){e._agents[t.agentId]=t;var n=r.ServicesManager.persons.getPerson("28:"+t.agentId);n.displayName=t.displayName,n.avatarData=t.userTileSmallUrl||t.userTileStaticUrl||""}),t})},this.searchAgents=function(t){var n="agents?q="+t;return i.get("searchAgents",n).then(function(t){return t&&t.agentDescriptions&&t.agentDescriptions.forEach(function(t){e._agents[t.agentId]=t;var n=r.ServicesManager.persons.getPerson("28:"+t.agentId);n.displayName=t.displayName,n.avatarData=t.userTileSmallUrl||t.userTileStaticUrl||""}),t})}}return Object.defineProperty(e.prototype,"agents",{get:function(){return this._agents},enumerable:!0,configurable:!0}),e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(23),o=n(471),s={retryCount:3,timeout:12e4,policy:""};t.get=function(e,t){return o.getHeaders().then(function(n){var o={method:"GET"};return o.headers=n,function(e,t,n){return i.default("aps-"+e,s,r.Configuration.APS_HOST_URL+t,n).then(function(e){return e.json()})}(e,t,o)})},t.put=function(e,t,n){return void 0===n&&(n=""),o.putHeaders().then(function(o){var a={method:"PUT"};return a.body=n,a.headers=o,function(e,t,n){return i.default("aps-"+e,s,r.Configuration.APS_HOST_URL+t,n)}(e,t,a)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13);t.getHeaders=function(){var e=new Headers;return new Promise(function(t){r.ServicesManager.signInManager.getSkypeToken().then(function(n){e.append("X-Skypetoken",n),e.append("Pragma","no-cache"),e.append("Cache-Control","no-cache, no-store, must-revalidate"),t(e)},function(){})})},t.putHeaders=function(){var e=new Headers;return new Promise(function(t){r.ServicesManager.signInManager.getSkypeToken().then(function(n){e.append("X-Skypetoken",n),t(e)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13),i=n(473),o=function(){function e(){var e=this;this.resetAuth=function(){e.authenticationPromise=null},this.authenticate()}return e.prototype.authenticate=function(){var e=this;if(this.authenticationPromise)return this.authenticationPromise;return this.authenticationPromise=i.postRaw("cookie","/beta/imageauth/cookie"),this.authenticationPromise.then(function(){setTimeout(function(){e.authenticationPromise=null},54e4)}),this.authenticationPromise},e.prototype.fetchAvatars=function(e,t){var n=this,r="/beta/users/"+e+"/profilepicturev2",o={displayname:t,voidCache:"true"},s=i.addGetParamsToUrl(r,o);return this.authenticate().then(function(){return n.fetchSingleAvatar(s)},this.resetAuth)},e.prototype.fetchSingleAvatar=function(e){return i.getRaw("avatars",e,{cache:"default"}).then(function(e){return e.url},this.resetAuth)},e.prototype.fetchMergedAvatars=function(e){var t=e.filter(function(e){return e.userId!==r.ServicesManager.mePerson.mri});t.length>4&&(t=t.slice(0,3));var n="/beta/users/mergedProfilePicturev2?usersInfo="+encodeURIComponent(JSON.stringify(t))+"&size=HR64x64&voidCache=true";return this.authenticate().then(function(){return i.getRaw("mergedAvatars",n).then(function(e){return e.url})},this.resetAuth)},e}();t.default=o},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),o=n(23),s=n(474),a={retryCount:3,timeout:12e4,policy:""},c=function(e,t,n){return 0!==t.toString().indexOf("http")&&(t=i.Configuration.AVATAR_SERVICE_URL+t),o.default("avatar-"+e,a,t,n)};t.get=function(e,n){return t.getRaw(e,n).then(function(e){return e.json()})},t.getRaw=function(e,t,n){return void 0===n&&(n={}),s.getHeaders().then(function(i){var o={method:"GET"};return o.headers=i,o.cache="no-cache",o.credentials="include",c(e,t,r({},o,n||{}))})},t.post=function(e,n){return t.postRaw(e,n).then(function(e){return e.json()})},t.postRaw=function(e,t){var n="cookie"===e;return s.getHeaders(n).then(function(n){var r={method:"POST"};return r.headers=n,r.cache="no-cache",r.credentials="include",c(e,t,r)})};var u=n(80);t.addGetParamsToUrl=u.addGetParamsToUrl},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(2),o=n(11),s=n(13);t.getHeaders=function(e){return void 0===e&&(e=!1),r.default.get.backend===o.MessagingBackend.TEAMS?s.ServicesManager.signInManager.aad().then(function(t){var n=new Headers;return e&&n.append("authorization",t),n.append("x-ms-client-type","web"),n.append("x-ms-user-type","user"),n}):new Promise(function(e){s.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=new Headers;n.append("x-skypetoken",t),n.append("x-skype-client",i.Configuration.getClientVersion()),e(n)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(476);t.TeamsCapabilitiesService=r.TeamsCapabilitiesService},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){var n=e.call(this)||this;return n.userPolicyService=t,n}return i(t,e),t.prototype.getCommonCapabilities=function(t){return Promise.all([e.prototype.getCommonCapabilities.call(this,t),this.userPolicyService.getMessagingPolicy(),this.userPolicyService.getCallingPolicy()]).then(function(e){var t=e[0],n=e[1],r=e[2];return{allowEditMessage:t.allowEditMessage&&n.allowUserEditMessage,allowDeleteMessage:t.allowDeleteMessage&&n.allowUserDeleteMessage,allowChat:t.allowChat&&n.allowUserChat,allowUploadFiles:t.allowUploadFiles,allowSendEmoticons:t.allowSendEmoticons,allowCalling:t.allowCalling&&(r.allowPrivateCalling||r.allowGroupCalling)}})},t.prototype.getCapabilitiesForConversation=function(t){return Promise.all([e.prototype.getCapabilitiesForConversation.call(this,t),this.userPolicyService.getCallingPolicy()]).then(function(e){var t=e[0],n=e[1];return o({},t,{allowCalling:t.allowCalling&&n.allowPrivateCalling})})},t}(n(289).SkypeCapabilitiesService);t.TeamsCapabilitiesService=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(2),a=n(17),c=n(9),u=n(15),l=n(152),p=n(13),d=n(61),f=n(23),h=n(478),g=n(132),m=n(290),v=n(64),y=n(91),_=[v.ThreadType.Chat,v.ThreadType.SfbInterop,v.ThreadType.SfbInteropChat];function b(e){var t={conversations:[],users:[],_metadata:{},hasMoreConversations:!!e.continuationToken},n={};return e.items.forEach(function(e){t.conversations.push(S(e)),e.members.forEach(function(e){return n[e.mri]=e})}),Object.keys(n).map(function(e){return t.users.push(n[e])}),t}function S(e){var t=e.consumptionHorizon,n=t?t.timeStamp+";"+t.originalArrivalTime+";"+t.clientMessageId:void 0,r=e.lastMessage;return{id:e.id,lastMessage:{id:r.id,clientmessageid:r.clientMessageId,from:r.from,messagetype:r.messageType,originalarrivaltime:r.originalArrivalTime,content:r.content,composetime:r.composeTime,version:r.version+"",messageid:r.id},isOneOnOne:e.isOneOnOne,properties:{consumptionhorizon:n,picture:"",lastimreceivedtime:""},threadProperties:{topic:e.title,picture:"",historydisclosed:!0,threadType:T(e)},version:e.version,members:e.members.map(function(e){return{id:e.mri,role:e.role,name:e.displayName}})}}function T(e){return 1===e.interopType||-1!==e.id.indexOf("@sfb.unq.gbl.spaces")?v.ThreadType.SfbInterop:v.ThreadType.Chat}var w=function(e){function t(t){var n=e.call(this)||this;return n.chatServiceAggregatorClient=t,n.setContinuationToken=function(e){return e.continuationToken&&(n.csaContinuationToken=e.continuationToken),e},n.fetchMessagesByLink=function(e){if(-1===e.indexOf("startTime")&&(e=u.UrlHelper.appendQueryParam(e,"startTime",0)),0!==e.indexOf(s.Configuration.CHAT_HOST_URL))try{var t=new URL(e),n=new URL(s.Configuration.CHAT_HOST_URL);t.hostname=n.hostname,e=t.toString()}catch(e){}return g.getPolling().authorization.then(function(){return y.getWithDomain("fetchMessagesByLink",e,{},!0).then(function(e){return y.parseJson(e)})},console.warn)},n}return i(t,e),t.prototype.fetchRecentConversationsV2=function(e){return this.chatServiceAggregatorClient.getUserChats(e,this.csaContinuationToken).then(this.setContinuationToken).then(b)},t.prototype.fetchRecentConversations=function(e,t){var n=this;if(this._prefetchPromise){var r=this._prefetchPromise;return this._prefetchPromise=void 0,r}if(s.Configuration.ECS.isCsaV2Enabled)return this.fetchRecentConversationsV2(t);if(this._fetchRecentsPromise&&this._fetchRecentsPromise.status===a.PromiseStatus.Pending)return this._fetchRecentsPromise.promise;var i=p.ServicesManager.signInManager.aad(d.AadAudience.AggregationApi).then(function(r){return p.ServicesManager.signInManager.onceSignedIn().then(function(){return f.default("teams-recents",{retryCount:1,timeout:12e4,policy:""},"https://chatsvcagg.teams.microsoft.com/api/v1/teams/users/me/chats?isPrefetch=false&enableMembershipSummary=false",{method:"get",headers:{Authorization:r,"x-ms-client-type":"swc","x-ms-user-type":s.Configuration.getUiVersion()}}).then(function(r){return r?r.json&&r.json().then(function(e){var t=[],n=[],r={};return e.forEach(function(e){var i=S(e);t.push(i),e.members.forEach(function(e){!r[e.mri]&&e.displayName&&(r[e.mri]=!0,n.push(e))})}),{conversations:t,users:n,_metadata:{},hasMoreConversations:!1}},function(r){return n.fetchRecentConversationsFallback(e,t)}):n.fetchRecentConversationsFallback(e,t)},function(r){return n.fetchRecentConversationsFallback(e,t)})},function(){n._fetchRecentsPromise.cancel(),n._fetchRecentsPromise=null})});return this._fetchRecentsPromise=new a.CancelablePromise(i),this._fetchRecentsPromise.promise},t.prototype.fetchRecentConversationsFallback=function(e,t){var n=this;if(void 0===e&&(e=1),void 0===t&&(t=100),!this._fetchRecentsPromise||this._fetchRecentsPromise.status!==a.PromiseStatus.Pending){return Promise.resolve({conversations:[],_metadata:{},hasMoreConversations:!1})}var r={view:"supportsExtendedHistory|msnp24Equivalent|supportsMessageProperties",pageSize:t,startTime:e};this.syncState?r.syncState=this.syncState:r.targetType="Passport|Skype|Lync|Thread|Agent|ShortCircuit|PSTN|SmsMms|Flxt|NotificationStream|Highlights|Cast|CortanaBot|ModernBots|InviteFree";var i=y.addGetParamsToUrl("users/ME/conversations",r);return y.get("fetchRecents-teams",i).then(function(e){e.ok?n._fetchRecentsPromise.isCanceled||y.parseJson(e).then(function(e){n.syncState=n.getSyncState(e._metadata.syncState);var t=e.conversations.filter(function(e){return e.threadProperties&&(t=e.threadProperties.threadType,_.some(function(e){return e===t}));var t});n.allConversations=n.allConversations.concat(t),n._fetchRecentsPromise.resolve({conversations:n.allConversations,hasMoreConversations:!!e._metadata.backwardLink})}).catch(function(t){c.default.throwError(112,"fetchRecentConversationsFallback unable to parse response",t),n._fetchRecentsPromise.cancel(e,n.allConversations)}):n._fetchRecentsPromise.cancel(e,n.allConversations)}),this._fetchRecentsPromise=new a.CancelablePromise,this._fetchRecentsPromise.promise},t.prototype.fetchMessages=function(e,t,n){void 0===t&&(t=20),void 0===n&&(n=0);var r={pageSize:t,view:"msnp24Equivalent|supportsMessageProperties",startTime:n},i=y.addGetParamsToUrl("users/ME/conversations/"+e+"/messages",r);return g.getPolling().authorization.then(function(){return y.get("fetchMessages",i).then(function(e){return y.parseJson(e).then(function(e){return e})})})},t.prototype.sendMessage=function(t,n){var r=o({},n,{messagetype:n.messagetype===v.MessagePayloadType.RichText?v.MessagePayloadType.RichTextHtml:n.messagetype});if(h.isInteropEnabled(t)){if(n.messagetype===v.MessagePayloadType.ControlTyping||n.messagetype===v.MessagePayloadType.ControlClearTyping)return Promise.reject("Typing not supported in SFB");r=h.addInteropDataToMessage(t,n)}return e.prototype.sendMessage.call(this,t,r)},t.prototype.editMessage=function(t,n,r,i){return r=r===v.MessagePayloadType.RichText?v.MessagePayloadType.RichTextHtml:r,e.prototype.editMessage.call(this,t,n,r,i)},t.prototype.deleteMessage=function(e,t){var n="users/ME/conversations/"+e+"/messages/"+t,r=y.addGetParamsToUrl(n,{behavior:"softDelete"});return y.del("deleteMessage",r)},t.prototype.addParticipant=function(e,t,n){var r="threads/"+e+"/members",i={members:[{id:t,role:"Admin",shareHistoryTime:-1}]};return y.post("addParticipant",r,{body:JSON.stringify(i)})},t.prototype.setFavoriteConversation=function(e,t){var n=y.addGetParamsToUrl("users/ME/properties",{name:"favorites"});return g.getPolling().authorization.then(function(){return y.put("setFavoriteConversation",n,{body:JSON.stringify({favorites:JSON.stringify(t)})})})},t.prototype.removeFavoriteConversation=function(e,t){return this.setFavoriteConversation(e,t)},t.prototype.createThread=function(e){e.forEach(function(e){return e.role="Admin"});var t={members:e,properties:{chatFilesIndexId:2,threadType:v.ThreadType.Chat}};2===e.length&&(t.properties=o({},t.properties,{fixedRoster:!0,uniquerosterthread:!0}));var n={headers:{"Content-Type":"application/json",Accept:"application/json, text/javascript"},body:JSON.stringify(t)};return y.post("thread","threads",n)},t.prototype.setBlockedConversation=function(e,t){return Promise.resolve(null)},t.prototype.subscribeContactPresence=function(e){return s.Configuration.ECS.contactPresenceEnabled?(-1===e.indexOf("8:")&&(e="8:"+e),p.ServicesManager.presenceService.subscribe(e,function(t){var n=p.ServicesManager.persons.getPerson(e);t.presence&&(n.presenceStatus=l.getStatusFromAvailability(t.presence.availability))}),Promise.resolve()):Promise.resolve()},t}(m.ConversationConsumerWebApi);t.ConversationTeamsWebApi=w},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(479))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(64);t.isInteropEnabled=function(e){return-1!==e.indexOf("@sfb.unq.gbl.spaces")},t.addInteropDataToMessage=function(e,t){try{var n=r.swc.services.conversations.get(e),c=s(n).email,u=a(n).mri;return t={clientmessageid:t.clientmessageid,content:t.content,contenttype:t.contenttype,messagetype:i.MessagePayloadType.Text,amsreferences:t.amsreferences||[],imdisplayname:t.imdisplayname,properties:{importance:"",interopType:"receiverSfB",subject:null},fromSipUri:"sip:"+c,toSipUri:"sip:"+o(u)}}catch(e){}return t};var o=function(e){var t=r.swc.services.contactsService.getContactByMri(e);return t?t.email:void 0},s=function(e){return e.selfParticipant.person},a=function(e){var t,n=e.selfParticipant.person.mri;return e.participants.some(function(e){return e.person.mri!==n&&(t=e.person,!0)}),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.enableLongPollTabActivation=function(e){r.swcWindow.addEventListener("focus",function(){e.resume()}),r.swcWindow.addEventListener("blur",function(){e.pause()})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),i=n(27),o=n(0),s=function(){function e(){var e=this;this.registrations={},this.setupProxy=function(){o.swc.Eventing.registerEvent(r.ApiEvents.threadNotificationsProxy.reg,function(t){return e.register(t.botId,t.conversationId)}),o.swc.Eventing.registerEvent(r.ApiEvents.threadNotificationsProxy.unreg,function(t){return e.unregister(t.botId,t.conversationId)})},i.ProxyConnector.instance.connect("threadNotifications",null,this.setupProxy)}return Object.defineProperty(e,"instance",{get:function(){return e.init()},enumerable:!0,configurable:!0}),e.init=function(){return e._instance||(e._instance=new e)},Object.defineProperty(e.prototype,"empty",{get:function(){return!Object.keys(this.registrations).length},enumerable:!0,configurable:!0}),e.prototype.register=function(e,t){var n=this.registrations[e]=this.registrations[e]||[];t&&-1===n.indexOf(t)&&n.push(t)},e.prototype.unregister=function(e,t){var n=this.registrations[e];if(n)if(t){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}else delete this.registrations[e]},e.prototype.notify=function(e,t,n){var i=this.registrations[e];!i||i.length&&-1===i.indexOf(t)||o.swc.Eventing.triggerEvent(r.ApiEvents.threadNotificationsProxy.notify,{botId:e,conversationId:t,message:n})},e}();t.ThreadNotifications=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=null,o=1;function s(){r&&clearTimeout(r)}t.execute=function(e){s(),null===i&&(i=1e3),r=setTimeout(e,i+.5*Math.random()*i),i<12e4&&(i*=++o)},t.stop=function(){s()},t.reset=function(){s(),i=null,o=1}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s,a,c,u=n(2),l=n(17),p=n(16),d=n(62),f=n(13),h=n(484),g=n(91);!function(e){e.ConversationProperties="/v1/users/ME/conversations/ALL/properties",e.ConversationMessages="/v1/users/ME/conversations/ALL/messages",e.Threads="/v1/threads/ALL"}(s||(s={})),function(e){e.Agent="Agent",e.Presence="Presence2015",e.MessageProperties="MessageProperties",e.CustomUserProperties="CustomUserProperties",e.NotificationStream="NotificationStream"}(a||(a={})),function(e){e.Poll="HttpLongPoll"}(c||(c={}));var m={baseUrl:"",isActiveUrl:"",longPollUrl:"",clientInfo:"",cnsEnabled:!1},v=function(){return o({},m,{baseUrl:u.Configuration.CHAT_HOST_URL.replace(/\/v\d\/?$/,""),clientInfo:u.Configuration.getChatClientInfo(),cnsEnabled:!u.Configuration.ECS.cnsPollingDisabled})};t.getTeamsPolling=function(){return v().cnsEnabled?new b:new h.PollingTeams};var y,_=!1,b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.currentAttempt=0,t._startPollingSequence=function(e){return Promise.resolve()},t.reset=function(){return t.stop(),t.start(),Promise.resolve()},t.setupPolling=function(e){return m.isActiveUrl=e.isActiveUrl,m.longPollUrl=e.subscriptions.pop().longPollUrl,v().longPollUrl},t.createEndpoint=function(){var e={startingTimeSpan:0,endpointFeatures:[a.Agent,a.MessageProperties].join(","),subscriptions:[{channelType:c.Poll,interestedResources:[s.ConversationMessages,s.ConversationProperties,s.Threads]}]},n=new Headers,r={headers:n,body:JSON.stringify(e)},i=f.ServicesManager.signInManager.getSkypeToken().then(function(e){n.set("authentication","skypetoken="+e),n.set("BehaviorOverride","redirectAs404"),n.set("clientinfo",u.Configuration.getChatClientInfo()),n.set("content-type","application/json");var t=p.guid.generate();return g.put("polling-teams",v().baseUrl+"/v2/users/ME/endpoints/"+t,r,!0,!0)}).then(function(e){return e.ok&&e.json?(t._authPromise.resolve(),e.json()):Promise.reject("Failed to create endpoint")});return t._endpointCreationPromise=new l.CancelablePromise(i),i},t.poll=function(e){if(t.longPollPromise)return t.longPollPromise;var n=new Headers,r={headers:n};return t.longPollPromise=new l.CancelablePromise(f.ServicesManager.signInManager.getSkypeToken().then(function(t){return n.set("authentication","skypetoken="+t),n.set("BehaviorOverride","redirectAs404"),n.set("clientinfo",v().clientInfo),n.set("content-type","application/json"),y=void 0,g.get("polling-teams",e,r,!0)}).then(function(e){t.longPollPromise.isCanceled||(t.longPollPromise=void 0,e.ok&&e.json&&e.json().then(function(e){return e.eventMessages&&t.dispatch(e.eventMessages),y=e.next,_?Promise.reject("[PollingTeamsCns.poll] Polling Paused, stopping"):e.next?t.poll(e.next):Promise.reject("[PollingTeamsCns.poll] No next link returned, reseting")}))}).catch(function(){return t.longPollPromise=void 0})),t.longPollPromise},t.dispatch=function(e){t.handlePollData({eventMessages:e})},t}return i(t,e),t.prototype.pause=function(){_=!0},t.prototype.resume=function(){_&&y&&(_=!1,this.poll(y))},t.prototype.start=function(){var e=this;if(!this.isPolling){this.retryTimeout&&(clearTimeout(this.retryTimeout),this.retryTimeout=void 0);var t=this.createEndpoint().then(this.setupPolling).then(this.poll).then(function(){e.currentAttempt=0}).catch(function(t){var n=1e3*Math.exp(++e.currentAttempt);e.retryTimeout=setTimeout(e.reset,n)});this._pollingPromise=new l.CancelablePromise(t),d.get().subscribe("isOnline",function(t){t?e.reset():e.stop()})}},t.prototype.stop=function(){try{this._pollingPromise.cancel(),this.longPollPromise.cancel()}catch(e){}},Object.defineProperty(t.prototype,"isPolling",{get:function(){return!!this.longPollPromise},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"authorization",{get:function(){return this._authPromise.promise},enumerable:!0,configurable:!0}),t}(h.PollingTeams);t.PollingTeamsCns=b},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(9),a=n(152),c=n(485),u=n(291),l=n(60),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setEndpointPresence=function(){if(o.swc.services.signInManager.isAadSupported())try{var e=o.swc.services.mePerson.mri;o.swc.services.presenceService.subscribe(e,t.handleNotifications),o.swc.services.presenceService.startPolling()}catch(e){s.default.throwError(103501,"Presence init failed.")}return Promise.resolve()},t.handleNotifications=function(e){e.etagMatch||("Self"===e.presence.sourceNetwork&&e.presence.deviceType===a.DeviceType.Desktop?o.swc.services.notificationsManager.disableNotifications():o.swc.services.notificationsManager.enableNotifications())},t.onEndpointCreation=function(e){0===o.swc.services.signInManager.currentUserName.indexOf("teamsvisitor:")||(t._setEndpointProperty(u.SET_ENDPOINT_PROPERTY,!0),t.setEndpointPresence())},t.filterOutUnsupportedEvents=function(e){var n=!!e.resource,r=e.resource,i=n&&"ThreadActivity/MemberConsumptionHorizonUpdate"===r.messagetype,o=l.getConversationIdFromUrl(e.resourceLink),s=n&&o===l.TEAMS_NOTIFICATION_CHANNEL_ID,a=n&&l.isThread(r),u=!a&&n&&r.threadtype;return!(i||s||a)&&(!(!u||a)||(c.reportEnterprisePollFormatViolation(e),(!n||!l.isThreadExtended(r))&&(t.validateAndDispatch(e),!1)))},t.ongoingValidations={},t.validateAndDispatch=function(e){var n=l.getConversationIdFromUrl(e.resourceLink);t.ongoingValidations[n]||(t.ongoingValidations[n]=o.swc.services.webApi.fetchConversation(n)),t.ongoingValidations[n].then(function(n){!l.isThreadExtended(n)&&n.id&&(o.swc.services.conversations.get(n.id).update(n),t._handlePollData({eventMessages:[e]}))})},t.handlePollData=function(e){e.eventMessages&&(e.eventMessages=e.eventMessages.filter(t.filterOutUnsupportedEvents)),t._handlePollData(e)},t}return i(t,e),t.prototype.start=function(){},t.prototype._getInterestedResources=function(){return["/v1/users/ME/conversations/ALL/properties","/v1/users/ME/conversations/ALL/messages","/v1/threads/ALL","/v1/users/ME/contacts/ALL"]},t}(u.Polling);t.PollingTeams=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(60),o=n(19);function s(e,t){var n=t.split("."),r=e;return!1===n.some(function(e){return!r[e]||(r=r[e],!1)})?r:void 0}t.reportEnterprisePollFormatViolation=function(e){try{var t=i.getConversationIdFromUrl(e.resourceLink),n=(c=e,["resource.threadtype","resource.threadType","resource.threadProperties.threadtype","resource.threadProperties.threadType","resource.properties.threadtype","resource.properties.threadType","resource.type"].some(function(e){return!!s(c,e)&&(u=e,!0)}),u),a=s(e,n);r.swc.Telemetry.sendEvent.pollingFormatViolation(t,n,a,e.resourceType,e.resource&&e.resource.messagetype||o.NA,e.resource&&e.resource.type||o.NA)}catch(e){}var c,u}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),o=n(61),s=n(293),a="teams-csa",c=function(){function e(e,t,n){void 0===n&&(n={}),this.customHeaders=n,this.client=new s.JsonClient(a,e),this.createAuthenticationHandler(t),this.client.setAuthentication(this.authenticationHandler)}return e.prototype.createAuthenticationHandler=function(e){var t=this;this.authenticationHandler=function(n){return void 0===n&&(n={}),n.headers=n.headers||{},e(o.AadAudience.AggregationApi).then(function(e){var o=r({Authorization:e,"x-ms-client-type":"swc","x-ms-client-version":i.Configuration.getClientVersion()},t.customHeaders);return Object.assign(n.headers,o),n})}},e.prototype.getUserChats=function(e,t){void 0===e&&(e=20);var n={version:"v2",pageSize:e,continuationToken:t};return this.client.get("/api/:version/teams/users/me/chats",n)},e}();t.ChatServiceAggregatorClient=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(80);t.buildUriFromTemplate=function(e,t,n){n=Object.assign({},n);var i=t.split("/");return i.forEach(function(e,t){var r=e.substr(1);(function(e){return 0===e.indexOf(":")})(e)&&n[r]&&(i[t]=n[r].toString(),delete n[r])}),t=i.join("/"),e.lastIndexOf("/")===e.length-1&&(e=e.substr(0,e.length-1)),0!==t.indexOf("/")&&(t="/"+t),r.addGetParamsToUrl(""+e+t,n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(61),o=n(293),s="teams-middletier",a=function(){function e(e,t){this.client=new o.JsonClient(s,e),this.createAuthenticationHandler(t),this.client.setAuthentication(this.authenticationHandler)}return e.prototype.createAuthenticationHandler=function(e){this.authenticationHandler=function(t){return void 0===t&&(t={}),t.headers=t.headers||{},e(i.AadAudience.SpacesApi).then(function(e){0!==e.toLowerCase().indexOf("bearer")&&(e="Bearer "+e);var n={Authorization:e,"x-ms-client-type":"swc","x-ms-client-version":r.Configuration.getClientVersion()};return Object.assign(t.headers,n),t})}},e.prototype.getUsers=function(e){return this.client.post("/:version/users/fetch",{version:"v2",isMailAddress:!1,canBeSmtpAddress:!1,enableGuest:!0,skypeTeamsInfo:!0},e).then(function(e){return e.value})},e}();t.TeamsMiddleTierClient=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(25),o=n(17),s=n(13),a=n(294),c=function(){function e(){var e=this;this._contactsByEmail=[],this._haveAllContactsByEmail=!1,this.fetchContactsByMail=function(t,n,r){void 0===t&&(t=100),void 0===n&&(n=10);var i=0;if(e._fetchContactsByMailPromise)return r&&r(e._contactsByEmail),e._fetchContactsByMailPromise.promise;var a=new Promise(function(o,a){var c=function(){if(!e._fetchContactsByMailPromise||!e._fetchContactsByMailPromise.isCanceled){s.ServicesManager.microsoftGraphService.fetchCommonEmails(t,i*t).then(function(s){if(!e._fetchContactsByMailPromise.isCanceled)if(s&&s.value){if(0===s.value.length)return void(e._haveAllContactsByEmail=!0);var u=[];s.value.forEach(function(e){e.scoredEmailAddresses.forEach(function(e){u.push(e.address)})}),e.getContactsByEmail(u).then(function(s){if(!e._fetchContactsByMailPromise.isCanceled){if(!s.ok){var l={code:s.status,message:s.statusText};return a(l),void(e._fetchContactsByMailPromise=null)}s.json().then(function(l){return function(l){if(!l)return e._haveAllContactsByEmail=!0,void(e._contactsByEmail?o(e._contactsByEmail):(a({status:s.status,statusText:s.statusText}),e._fetchContactsByMailPromise=null));r&&r(l.contacts),e._contactsByEmail=e._contactsByEmail.concat(l.contacts),e._haveAllContactsByEmail=e._haveAllContactsByEmail||e._contactsByEmail.length>=n||u.length<t,e._haveAllContactsByEmail?o(e._contactsByEmail):(i++,c())}(l)},function(t){a(t),e._fetchContactsByMailPromise=null})}}).catch(function(e){a(e)})}else e._contactsByEmail?o(e._contactsByEmail):(a({status:0,statusText:"No emails to get skypeIds"}),e._fetchContactsByMailPromise=null)}).catch(function(e){a(e)})}};s.ServicesManager.signInManager.onceSignedIn().then(c.bind(e))});return e._fetchContactsByMailPromise=new o.CancelablePromise(a),e._fetchContactsByMailPromise.promise},s.ServicesManager.signInManager.subscribe("state",function(t){t===i.SigninState.SignedOut&&e.dispose()})}return Object.defineProperty(e.prototype,"fetchContactsByMailPromise",{get:function(){return this._fetchContactsByMailPromise&&this._fetchContactsByMailPromise.promise},enumerable:!0,configurable:!0}),e.prototype.getContactsByEmail=function(e){var t={Emails:e};return a.post("fetchContactsByEmail","scdemaillookup",JSON.stringify(t),r.Configuration.CONTACTS_SCD_HOST_URL)},e.prototype.dispose=function(){this._contactsByEmail=[],this._fetchContactsByMailPromise&&this._fetchContactsByMailPromise.status===o.PromiseStatus.Pending&&this._fetchContactsByMailPromise.cancel(),this._fetchContactsByMailPromise=null},e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13),i=n(2);t.getHeaders=function(){return new Promise(function(e){r.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=new Headers;n.append("X-Skypetoken",t),n.append("X-Skype-Caller",i.Configuration.getUiVersion()),e(n)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(17),i=n(9),o=n(13),s=function(){function e(){var e=this;this._rawContacts=[],this._rawContactIds={},this.fetchMyContacts=function(t,n){if(e._fetchContactsPromise)return e._fetchContactsPromise.promise;var s=o.ServicesManager.webApi.fetchRecentConversations().then(function(t){e._rawContacts=[];var n=t;if(!n)return i.default.throwError(11010,"Unable to fetch contacts"),{};if(!n.users)return{contacts:[],count:0,scope:"",duration:0};var r=o.ServicesManager.mePerson;return n.users.forEach(function(t){if(t.mri===r.mri)return r.displayName=t.displayName,void(r.email=t.userPrincipalName);e._rawContacts.push({id:t.mri,person_id:t.mri,type:t.type,display_name:t.displayName,authorized:!0,blocked:!1,avatar_url:"",mood:"",name:{first:t.givenName,surname:t.surname,nickname:"",company:""},mri:t.mri,email:t.userPrincipalName,objectId:t.objectId}),e._rawContactIds[t.mri]=!0}),{contacts:e._rawContacts,count:n.users.length,scope:"",duration:0}},function(t){e._fetchContactsPromise=null,i.default.throwError(11010,"Unable to fetch contacts",t)});return e._fetchContactsPromise=new r.CancelablePromise(s),e._fetchContactsPromise.promise},this.getContactsUpdate=function(e){return Promise.resolve()},this.getContact=function(t,n){var r=e._rawContacts.filter(function(e){return e.mri.indexOf(n)>-1});return r.length?Promise.resolve(r[0]):e.fetchContactById(n)},this.addContact=function(t,n,r){return r&&!e._rawContactIds[r.mri]&&e._rawContacts.push(r),Promise.resolve()},this.blockContact=function(e,t,n){return Promise.resolve()},this.unblockContact=function(e){return Promise.resolve()},this.addFavoriteContact=function(e){return Promise.resolve()},this.removeFavoriteContact=function(e){return Promise.resolve()},this.dispose=function(){},this.getContactByObjectId=function(t){var n;return e._rawContacts.some(function(e){return t===e.objectId&&(n=e,!0)}),n?Promise.resolve(n):e.fetchContactById(t)}}return e.prototype.getContactByMri=function(e){var t=this._rawContacts.filter(function(t){return t.mri===e});return t.length?t[0]:void 0},Object.defineProperty(e.prototype,"contactsList",{get:function(){return this._rawContacts},enumerable:!0,configurable:!0}),e.prototype.getBlockedList=function(){return Promise.resolve([])},e.prototype.getContactByMriIfPresent=function(e){return""},e.prototype.fetchContactById=function(t){var n=this;return o.ServicesManager.stratusService.fetchShortProfile([t]).then(function(t){return e.createContactFromShortProfile(t[0])}).then(function(e){return n.addContact(e.mri,"",e),e})},e.createContactFromShortProfile=function(e){return{id:e.mri,person_id:e.mri,type:e.type,display_name:e.displayName,authorized:!0,blocked:!1,avatar_url:"",mood:"",mri:e.mri,email:e.email,objectId:e.objectId}},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.reportContactsLoadedQosError=function(e,t){r.swc.Telemetry.sendEvent.contactsLoadedQos(e,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.items=[],this.key=e}return e.prototype.reset=function(){this.items=[]},e.prototype.add=function(e,t){var n=this;e&&(e.forEach(function(e){n.items=n.items.filter(function(t){return t[n.key]!==e[n.key]})}),t&&(e=e.filter(function(e){return!e.deleted})),this.items=this.items.concat(e))},e.prototype.getItems=function(){return this.items},e.prototype.getItemsByType=function(e){return this.items.filter(function(t){return 0===t.person_id.indexOf(e+":")})},e}(),i=function(){function e(){this.callCount=0,this.contacts=new r("mri"),this.blocklist=new r("mri"),this.groups=new r("id"),this.duration=0,this.firstScope=""}return e.prototype.reset=function(){this.firstScope="",this.contacts.reset(),this.groups.reset(),this.blocklist.reset()},e.prototype.update=function(e){this.callCount++,e&&(this.callCount>1&&"full"===e.scope&&this.reset(),e.scope&&!this.firstScope&&(this.firstScope=e.scope),this.contacts.add(e.contacts,!0),this.groups.add(e.groups,!1),this.blocklist.add(e.blocklist,!0))},e.prototype.filter=function(e){return this.contacts.getItemsByType(e)},e}();t.ContactsInfo=i},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=n(5),a=n(25),c=n(10),u=n(29),l=n(0),p=n(85),d=n(56),f=n(132),h=n(13),g=n(121),m=n(495),v=n(295),y="8:echo123",_=function(e){function t(){var t=e.call(this)||this;return t._contactsData={contacts:[],blocked:[],groups:[]},t._fetchContactsResolved=!1,t._updateContact=function(e,t){var n=h.ServicesManager.persons.getPerson(e.skypeid,!1);e.blocked=n.isBlocked=t.blocked,e.favorite=n.isFavorite=t.favorite;var r=t.profile&&t.profile.avatar_url?t.profile.avatar_url:null;r&&r!==e.avatar&&(e.avatar=n.avatarData=r),t.display_name&&t.display_name!==e.name&&(e.name=n.displayName=t.display_name)},t._addNewContact=function(e){var n=t._mapContact(e);t._contactsData.contacts.push(n),t._createPerson(n),l.swc.Eventing.triggerEvent(o.ApiEvents.contactAdded,n)},t._handleContactUpdate=function(e){e.contacts&&e.contacts.length&&e.contacts.forEach(function(e){for(var n=!1,r=0;r<t._contactsData.contacts.length;r++){var i=t._contactsData.contacts[r];if(i.skypeid===e.mri){t._updateContact(i,e),n=!0;break}}n||t._addNewContact(e)})},t._onContactListChangedNotification=function(){t._contactsService.getContactsUpdate(v.reasons.NOTIFICATION).then(t._handleContactUpdate)},t._mapContact=function(e){return{skypeid:e.mri,name:e.display_name,favorite:e.favorite,blocked:e.blocked,normalized_name:d.normalizeString(e.display_name),avatar:e.profile&&e.profile.avatar_url?e.profile.avatar_url:"",type:p.default.getContactType({mri:e.mri})}},t.fetchMyContacts=function(e){var n=Date.now();return t._fetchContactsResolved?new Promise(function(e){e(t._contactsData)}):t._contactsService.fetchMyContacts(f.PAGE_SIZE.default).then(function(e){if(!t._fetchContactsResolved&&e){var r=[];e&&e.contacts&&(r=e.contacts.filter(function(e){return!(e.mri.indexOf("4:")>-1)&&e.mri!==y})),t._contactsData.groups=e.groups,t._contactsData.contacts=r.map(t._mapContact),t._createPersonForAllContacts(t._contactsData.contacts),e.blocklist&&(t._contactsData.blocked=e.blocklist.map(function(e){return{skypeid:e.mri}})),t._fetchContactsResolved=!0,t._sendTelemetryData(t._contactsData,n)}return t._contactsData},function(e){})},t.isPersonContact=function(e){return new Promise(function(n,r){t._isPersonContactPromiseRejectCallback=r,l.swc.services.signInManager.getSkypeToken().then(function(r){var i=l.swc.services.signInManager.currentUserName;if(l.swc.services.signInManager.userIdentityType===u.IdentityType.GUEST)return n(!0);t._contactsService.getContact(i,e).then(function(r){t._isPersonContactPromiseRejectCallback=null,n(t.isContact(r,e))},function(e){t._isPersonContactPromiseRejectCallback(!1),t._isPersonContactPromiseRejectCallback=null})},t._isPersonContactPromiseRejectCallback.bind(t,{source:"onSigninFailed"}))})},t.addContact=function(e,n){return t._contactsService.addContact(e,n)},t.blockContact=function(e,n,r){return t._contactsService.blockContact(e,n,r)},t.unblockContact=function(e){return t._contactsService.unblockContact(e)},t.addFavoriteContact=function(e){return t._contactsService.addFavoriteContact(e)},t.removeFavoriteContact=function(e){return t._contactsService.removeFavoriteContact(e)},t.getBlockedlist=function(){return t._contactsService.getBlockedList()},t.signinStateChangedHandler=function(){l.swc.services.signInManager.state===a.SigninState.SignedOut&&(t._contactsService.dispose(),t._isPersonContactPromiseRejectCallback&&t._isPersonContactPromiseRejectCallback({source:"signout"}),t._contactsData={blocked:[],groups:[],contacts:[]},t._fetchContactsResolved=!1)},t.isContact=function(e,t){return!!e&&(!!e&&e.mri===t&&e.authorized)},t._sendTelemetryData=function(e,t){var n=e.contacts?e.contacts:[];l.swc.Telemetry.sendEvent.contactsLoaded(n.length,n.filter(function(e){return 4===e.type}).length,n.filter(function(e){return 8===e.type}).length,n.filter(function(e){return 28===e.type}).length,Date.now()-t)},t._contactsService=l.swc.services.contactsService,t._outlookContactsService=l.swc.services.outlookContactsService,l.swc.services.signInManager.subscribe("state",t.signinStateChangedHandler),t._initTrouter(),t}return i(t,e),t.prototype._initTrouter=function(){var e=new g.LocalCallingLogger,t=h.ServicesManager.signInManager.getSkypeToken.bind(h.ServicesManager.signInManager),n={onContactListChangedNotification:this._onContactListChangedNotification};h.ServicesManager.trouterService.init(e,t,s.default.get.sessionId),h.ServicesManager.trouterService.registerMessageHandler(this._handleTrouterMessage(n))},t.prototype._getEventId=function(e){return e.eventId?e.eventId:e.body&&e.body.eventId},t.prototype._handleTrouterMessage=function(e){var t=this;return{handleMessage:function(e){switch(t._getEventId(e)){case m.trouterEvents.CONTACTLIST_CHANGE:return t._onContactListChangedNotification(),m.HANDLER_RESULT_STATUS_OK}return m.HANDLER_RESULT_STATUS_UNHANDLED}}},t.prototype._createPerson=function(e){var t=h.ServicesManager.persons.getPerson(e.skypeid,!1);return t.displayName=e.name,t.avatarData=e.avatar,t.isBlocked=e.blocked,t.isFavorite=e.favorite,t},t.prototype._createPersonForAllContacts=function(e){e.forEach(this._createPerson)},t.prototype.dispose=function(){this._contactsService.dispose(),this._isPersonContactPromiseRejectCallback&&this._isPersonContactPromiseRejectCallback({source:"onDispose"}),l.swc.services.signInManager.unsubscribe("state",this.signinStateChangedHandler)},t}(c.default);t.SkypeContactsManager=_,t.default=_},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.OK=200]="OK",e[e.created=201]="created",e[e.badRequest=400]="badRequest",e[e.unauthorized=401]="unauthorized",e[e.notFound=404]="notFound",e[e.forbidden=403]="forbidden",e[e.preconditionFailed=412]="preconditionFailed",e[e.unprocessableEntity=422]="unprocessableEntity",e[e.internalServerError=500]="internalServerError"}(r=t.httpStatusCodes||(t.httpStatusCodes={})),function(e){e[e.CONTACTLIST_CHANGE=6]="CONTACTLIST_CHANGE",e[e.OFFLINE_AUTHREQUEST=14]="OFFLINE_AUTHREQUEST",e[e.INCOMING_SKYPE_NGC_CALL=107]="INCOMING_SKYPE_NGC_CALL",e[e.INCOMING_SKYPE_P2P_CALL=108]="INCOMING_SKYPE_P2P_CALL",e[e.INCOMING_SKYPE_NGC_GVC_CALL=109]="INCOMING_SKYPE_NGC_GVC_CALL",e[e.INCOMING_LYNC_NGC_CALL=105]="INCOMING_LYNC_NGC_CALL",e[e.INCOMING_STOP_RINGER=104]="INCOMING_STOP_RINGER",e[e.INCOMING_SKYPE_NGC_STOP_RINGER=110]="INCOMING_SKYPE_NGC_STOP_RINGER",e[e.INCOMING_SKYPE_NGC_PSTN_CALL=111]="INCOMING_SKYPE_NGC_PSTN_CALL",e[e.USER_SERVICES_CHANGE=601]="USER_SERVICES_CHANGE",e[e.INCOMING_CONTACT_INVITE=801]="INCOMING_CONTACT_INVITE",e[e.OUTGOING_CONTACT_INVITE_ACCEPTED=802]="OUTGOING_CONTACT_INVITE_ACCEPTED",e[e.CONTACT_INVITES_LIST_CHANGE=803]="CONTACT_INVITES_LIST_CHANGE",e[e.USER_PROFILE_CHANGE=20]="USER_PROFILE_CHANGE",e[e.USER_AVATAR_CHANGE=21]="USER_AVATAR_CHANGE"}(t.trouterEvents||(t.trouterEvents={})),t.HANDLER_RESULT_STATUS_OK={isHandled:!0,resultCode:r.OK},t.HANDLER_RESULT_STATUS_UNHANDLED={isHandled:!1}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(17),s=n(0),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._searchAadDirectory=function(e){return t._searchPromise&&t._searchPromise.status===o.PromiseStatus.Pending&&(t._searchPromise.cancel(),t._searchPromise=null),t._searchKey=e,t._searchPromise=new o.CancelablePromise(s.swc.services.teamsGraphService.fetchProfiles(e)),t._searchPromise.promise},t}return i(t,e),t.prototype.searchSkypeDirectory=function(e){var t=function(e){return{nodeProfileData:{avatarUrl:"",city:"",contactType:"",country:"",countryCode:"",language:"",state:"",name:e.displayName,skypeId:e.mri,jobTitle:e.jobTitle,department:e.department,location:e.userLocation},nodeAnnotation:"",nodeConnectionData:{distance:0,mutualFriendCount:0}}},n=function(e){return!!e.mri};return this._searchAadDirectory(e).then(function(e){return{requestId:"",results:e.filter(n).map(t)}})},t}(n(297).default);t.TeamsSearchManager=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),i=n(5),o=n(2),s=n(167),a=n(27),c=n(0),u=n(85),l=n(45),p=n(113),d=function(e){return c.swc.services.i18n.fetch(e)},f=function(){function e(){this.isConnected=!1}return e.prototype.registerServices=function(){var e=c.swc.services;e.signInManager&&e.signInManager.isAadSupported()?this.registerEnterpriseProxy(e.presenceService,e.persons,e.mePerson):this.registerConsumerProxy(e.persons)},e.prototype.registerSharedProxy=function(){c.swc.Eventing.registerEvent(r.ApiEvents.presenceProxy.getStatusList,function(){i.default.get.isTeams()?c.swc.Eventing.triggerEvent(r.ApiEvents.presenceProxy.getStatusListResponse,[{key:"Online",description:d("presence_status_online"),url:o.Configuration.ECS.domain+"/assets/personas/status/Available.svg"},{key:"BeRightBack",description:d("presence_status_berightback"),url:o.Configuration.ECS.domain+"/assets/personas/status/Away.svg"},{key:"Away",description:d("presence_status_away"),url:o.Configuration.ECS.domain+"/assets/personas/status/Away.svg"},{key:"Busy",description:d("presence_status_busy"),url:o.Configuration.ECS.domain+"/assets/personas/status/Busy.svg"},{key:"DoNotDisturb",description:d("presence_status_donotdisturb"),url:o.Configuration.ECS.domain+"/assets/personas/status/DoNotDisturb.svg"}]):c.swc.Eventing.triggerEvent(r.ApiEvents.presenceProxy.getStatusListResponse,[{key:"Online",description:d("presence_status_online"),url:o.Configuration.ECS.domain+"/assets/personas/status/Available.svg"},{key:"Busy",description:d("presence_status_busy"),url:o.Configuration.ECS.domain+"/assets/personas/status/Busy.svg"},{key:"Away",description:d("presence_status_away"),url:o.Configuration.ECS.domain+"/assets/personas/status/Away.svg"}])})},e.prototype.registerEnterpriseProxy=function(e,t,n){if(e.isEnabled&&!this.isConnected){this.registerSharedProxy(),c.swc.Eventing.registerEvent(r.ApiEvents.presenceProxy.getStatus,function(){e.getMyPresence().catch(function(){return p.Availability.PresenceUnknown}).then(function(e){var t=p.getStatusFromAvailability(e);c.swc.Eventing.triggerEvent(r.ApiEvents.presenceProxy.getStatusResponse,t)})}),c.swc.Eventing.registerEvent(r.ApiEvents.presenceProxy.setStatus,function(t){var n=p.getAvailabilityFromStatus(t);n?e.setMyPresence(n).then(function(){c.swc.Eventing.triggerEvent(r.ApiEvents.presenceProxy.setStatusResponse,{status:!0})}):c.swc.Eventing.triggerEvent(r.ApiEvents.presenceProxy.setStatusResponse,{status:!1})});var i=function(e){c.swc.Eventing.triggerEvent(r.ApiEvents.presenceProxy.announceUserStatus,{userId:u.default.normalizePersonId(e.mri),status:p.getStatusFromAvailability(e.presence.availability)})};c.swc.Eventing.registerEvent(r.ApiEvents.presenceProxy.subscribeToUserStatus,function(r){if(s.ME!==r){var o=t.getPerson(r);o&&e.subscribe(o.mri,i)}else e.subscribe(n.mri,function(e){e.mri=s.ME,i(e)})}),c.swc.Eventing.registerEvent(r.ApiEvents.presenceProxy.unsubscribeFromUserStatus,function(r){s.ME===r&&e.unsubscribe(n.mri,i);var o=t.getPerson(r);o&&e.unsubscribe(o.mri,i)}),c.swc.Eventing.registerEvent(r.ApiEvents.presenceProxy.getUserStatus,function(n){var i=t.getPerson(n);if(i){var o=function(t){c.swc.Eventing.triggerEvent(r.ApiEvents.presenceProxy.getUserStatusResponse,{userId:n,status:p.getStatusFromAvailability(t.presence.availability)}),e.unsubscribe(i.mri,o)};e.subscribe(i.mri,o)}}),a.ProxyConnector.instance.connect("presence",{}),this.isConnected=!0}},e.prototype.registerConsumerProxy=function(e){this.isConnected||(this.registerSharedProxy(),c.swc.Eventing.registerEvent(r.ApiEvents.presenceProxy.getStatus,function(){var t=e.getMyStatus()||l.PresenceStatus.Offline;c.swc.Eventing.triggerEvent(r.ApiEvents.presenceProxy.getStatusResponse,t)}),c.swc.Eventing.registerEvent(r.ApiEvents.presenceProxy.setStatus,function(t){e.setMyStatus(t).then(function(){return c.swc.Eventing.triggerEvent(r.ApiEvents.presenceProxy.setStatusResponse,{status:!0})}).catch(function(){return c.swc.Eventing.triggerEvent(r.ApiEvents.presenceProxy.setStatusResponse,{status:!1})})}),c.swc.Eventing.registerEvent(r.ApiEvents.presenceProxy.subscribeToUserStatus,function(t){s.ME!==t?e.subscribeToUserStatus(t,function(e,n){c.swc.Eventing.triggerEvent(r.ApiEvents.presenceProxy.announceUserStatus,{userId:t,status:n})}):e.subscribeToMyStatus(function(e){c.swc.Eventing.triggerEvent(r.ApiEvents.presenceProxy.announceUserStatus,{ME:s.ME,status:e})})}),c.swc.Eventing.registerEvent(r.ApiEvents.presenceProxy.unsubscribeFromUserStatus,function(t){e.unsubscribeFromUserStatus(t)}),c.swc.Eventing.registerEvent(r.ApiEvents.presenceProxy.getUserStatus,function(t){e.getUserStatus(t).then(function(e){c.swc.Eventing.triggerEvent(r.ApiEvents.presenceProxy.getUserStatusResponse,{userId:t,status:e})}).catch(function(){c.swc.Eventing.triggerEvent(r.ApiEvents.presenceProxy.getUserStatusResponse,{userId:t,status:null})})}),a.ProxyConnector.instance.connect("presence",{}),this.isConnected=!0)},e}();t.PresenceProxyOperator=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(138),i=n(113),o=n(298),s=function(){function e(){var e=this;this.subscriptions={},this.subscribe=function(t,n){/^\d+:orgid:/.test(t)&&(e.subscriptions[t]||(e.subscriptions[t]={handlers:[]}),0===e.subscriptions[t].handlers.filter(function(e){return e===n}).length&&e.subscriptions[t].handlers.push(n))},this.unsubscribe=function(t,n){e.subscriptions[t]||(e.subscriptions[t].handlers=e.subscriptions[t].handlers.filter(function(e){return e!==n}))},this.start=function(){e.isRunning||(e.poll(),e.pollInterval=setInterval(function(){return e.poll()},1e3*r.getConfig().pollingInterval))},this.stop=function(){clearInterval(e.pollInterval),e.clearForcedDelayedPoll(),e.pollInterval=void 0},this.getUsers=function(){return Object.keys(e.subscriptions).map(function(t){return{mri:t,etag:e.subscriptions[t].etag||""}})},this.handlePoll=function(t){return t.forEach(function(t){if(t.status>=2e4&&t.status<=29999&&e.subscriptions.hasOwnProperty(t.mri))if(t.etagMatch&&e.subscriptions[t.mri].lastResponse)e.subscriptions[t.mri].handlers.forEach(function(n){return n(e.subscriptions[t.mri].lastResponse)});else if(t.presence)try{var n=e.subscriptions[t.mri].lastResponse&&e.subscriptions[t.mri].lastResponse.presence.availability||i.Availability.Offline;t.presence.availability!==n&&e.subscriptions[t.mri].handlers.forEach(function(e){return e(t)}),e.subscriptions[t.mri].etag=t.etag,e.subscriptions[t.mri].lastResponse=t}catch(e){}}),t},this.poll=function(){var t=e.getUsers();return e.clearForcedDelayedPoll(),t?o.UnifiedPresenceService.pollPresence(t).then(e.handlePoll):Promise.resolve([])}}return e.get=function(){return e.instance||(e.instance=new e),e.instance},Object.defineProperty(e.prototype,"isRunning",{get:function(){return!!this.pollInterval},enumerable:!0,configurable:!0}),e.prototype.forceDelayedPoll=function(){var e=this;this.forcedPollTimeout||(this.forcedPollTimeout=setTimeout(function(){e.poll()},1e4))},e.prototype.clearForcedDelayedPoll=function(){this.forcedPollTimeout&&(clearTimeout(this.forcedPollTimeout),this.forcedPollTimeout=void 0)},e}();t.PresencePollingService=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(0),o=n(9),s=n(16),a=n(61),c=n(23),u={baseUrl:"https://presence.teams.microsoft.com/v1"},l={retryCount:3,timeout:12e4,policy:""},p=function(e,t,n){return c.default("presence-"+e,l,u.baseUrl+t,n).then(function(r){if(404===r.status){var i=r.headers.get("location");if(i){var o=/^(https:\/\/[^\/]+\/v1)/g.exec(i)[0];return u.baseUrl=o,c.default("presence-"+e,l,u.baseUrl+t,n)}}return r})},d=function(e){void 0===e&&(e=a.AadAudience.SpacesApi);var t=i.swc.services.signInManager;return t.isAadSupported()&&t.aad?Promise.all([t.aad(e),t.getSkypeToken()]).then(function(e){var t=e[0],n=new Headers;return n.append("Authorization",t),n.append("Accept","application/json"),n.append("x-skype-client",r.Configuration.getClientVersion()),n.append("x-ms-correlation-id",s.guid.generate()),n.append("x-ms-client-type","Web"),n.append("x-ms-client-version",r.Configuration.getClientVersion()),n.append("x-ms-client-user-agent","swc"),n.append("content-type","application/json;charset=UTF-8"),n.append("BehaviorOverride","redirectAs404"),n}):(o.default.throwError(103502,"Unable to get AAD Token"),Promise.reject("Unable to get AAD Token"))};t.post=function(e,t,n){return d().then(function(r){return p(e,t,{method:"POST",cache:"no-cache",headers:r,body:n}).then(function(e){return e.ok?e.json():Promise.reject("Failed")})})},t.put=function(e,t,n){return d().then(function(r){return p(e,t,{method:"PUT",cache:"no-cache",headers:r,body:n})})},t.get=function(e,t){return d().then(function(n){var r={method:"GET"};return r.headers=n,p(e,t,r).then(function(e){return e.ok?e.json():Promise.reject("Failed")})})}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(17),o=n(27),s=n(0),a=n(15),c=n(299),u=n(501),l=n(502),p=function(){function t(){var e=this;this.initPromise=new i.CancelablePromise,this.setLanguage=function(t){return e.defaults.then(function(n){return e.lang=c.default.getLocale(t.toLowerCase()),e.load(e.lang).then(function(t){l.default.set(n),l.default.merge(t),u.default.init(e.lang)})})},this.whenReady=function(){return e.initPromise.promise},this.defaults=this.load("en-us"),u.default.init(r.Configuration.LOCALE),this.registerProxy()}return t.prototype.registerProxy=function(){var e=this;s.swc.Eventing.registerEvent("proxy:configuration:setLanguage",function(t){e.setLanguage(t).then(function(){s.swc.Eventing.triggerEvent("proxy:configuration:setLanguage:response",void 0,!0)})}),o.ProxyConnector.instance.connect("configurationProxy",{})},t.prototype.init=function(e){var t=this;return e||(e=r.Configuration.LOCALE),this.setLanguage(e).then(function(){t.initPromise.resolve()}).catch(function(){t.init(t.lang)})},t.prototype.load=function(t){var n=a.UrlHelper.getAppPath()+"resources/i18n/"+t+"/Strings.json";return e(n).then(function(e){return e.json()})},t.prototype.fetch=function(e,t){void 0!==t&&void 0!==t.count&&(e+=u.default.getPluralSuffix(t.count));var n=this._getKeyValueText(e);return this._replaceParams(n,t)},t.prototype._replaceParams=function(e,t){for(var n in void 0===t&&(t={}),t)if(t.hasOwnProperty(n)){var r=t[n].toString(),i="{"+n+"}";e=e.replace(i,r)}return e},t.prototype._getKeyValueText=function(e){var t=l.default.get();return t&&t[e]?t[e]:e},t}();t.I18N=p}).call(this,n(72))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i={af:"af",am:"am",ar:"ar",as:"as",az:"az",be:"be",bg:"bg",bn:"bn",bs:"bs",chr:"chr",ca:"ca",cs:"cs",cy:"cy",da:"da",de:"de",el:"el",en:"en",es:"es",et:"et",eu:"eu",fa:"fa",fi:"fi",fil:"fil",fr:"fr",ga:"ga",gd:"gd",gl:"gl",gu:"gu",ha:"ha",he:"he",hi:"hi",hr:"hr",hu:"hu",hy:"hy",id:"id",ig:"ig",is:"is",it:"it",iw:"iw",ja:"ja",ka:"ka",kk:"kk",km:"km",kn:"kn",ko:"ko",kok:"kok",ku:"ku",ky:"ky",lb:"lb",lt:"lt",lv:"lv",mi:"mi",ml:"ml",mn:"mn",mr:"mr",ms:"ms",ne:"ne",nl:"nl",nn:"nn",nb:"nb",no:"no",nso:"nso",or:"or",pa:"pa",pl:"pl",prs:"prs",pt_br:"pt-br",pt_pt:"pt-pt",qps:"qps",qut:"qut",quz:"quz",ro:"ro",ru:"ru",rw:"rw",sd:"sd",si:"si",sl:"sl",sk:"sk",sq:"sq",sr:"sr",sv:"sv",sw:"sw",ta:"ta",te:"te",tg:"tg",th:"th",ti:"ti",tk:"tk",tn:"tn",tr_tr:"tr-tr",tt:"tt",ug:"ug",uk:"uk",ur:"ur",uz:"uz",vi:"vi",wo:"wo",xh:"xh",yo:"yo",zh:"zh",zu:"zu"},o={group0:{languages:[i.ja,i.id,i.ko,i.tr_tr,i.vi,i.zh,i.az,i.ig,i.fa,i.ka,i.km,i.kn,i.ms,i.prs,i.th,i.tt,i.ug,i.wo,i.yo]},group1:{languages:[i.bg,i.ca,i.cy,i.da,i.de,i.el,i.en,i.es,i.et,i.fi,i.he,i.hu,i.it,i.iw,i.nb,i.nl,i.no,i.pt_pt,i.qps,i.sv,i.af,i.as,i.bn,i.chr,i.eu,i.gl,i.gu,i.ha,i.hy,i.is,i.kk,i.kok,i.ku,i.ky,i.lb,i.mi,i.ml,i.mn,i.mr,i.ne,i.nn,i.or,i.pa,i.qut,i.quz,i.rw,i.sd,i.si,i.sq,i.sw,i.ta,i.te,i.tk,i.tn,i.ur,i.xh,i.zu]},group2:{languages:[i.fr,i.pt_br,i.am,i.fil,i.hi,i.nso,i.tg,i.ti,i.uz]},group3:{languages:[i.lv]},group4:{languages:[i.gd]},group5:{languages:[i.ro]},group6:{languages:[i.lt]},group7:{languages:[i.ru,i.uk,i.hr,i.sr,i.be,i.bs,i.sl]},group8:{languages:[i.cs,i.sk]},group9:{languages:[i.pl]},group11:{languages:[i.ga]},group12:{languages:[i.ar]}},s=function(){function e(){}return e.prototype.init=function(e){void 0===e&&(e=i.en);var t=e.replace("-","_").toLowerCase();if(!i[t]){var n=t.split("_");1===n.length&&r.default.throwError(10050,"Unsupported language:"+e),t=n[0]}this._currentLocale=t},e.prototype.getPluralSuffix=function(e){var t,n=null,r="";for(t in o)-1!==o[t].languages.indexOf(this._currentLocale)&&(n=t);switch(n){case"group0":r=1===e?"":"_few";break;case"group1":r=1===e?"":"_many";break;case"group2":r=e>1?"_many":"";break;case"group3":r=e%10==1&&e%100!=11?"":0===e?"_few":"_many";break;case"group4":r=1===e||11===e?"":2===e||12===e?"_few":"_many";break;case"group5":r=1===e?"":0===e||e%100>0&&e%100<20?"_few":"_many";break;case"group6":r=e%10==1&&e%100!=11?"":e%10>=2&&(e%100<10||e%100>=20)?"_many":"_few";break;case"group7":r=e%10==1&&e%100!=11?"":e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?"_few":"_many";break;case"group8":r=1===e?"":e>=2&&e<=4?"_few":"_many";break;case"group9":r=1===e?"":e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?"_few":"_many";break;case"group11":r=1===e?"":e>=2&&e<=10?"_few":"_many";break;case"group12":r=1===e?"":2===e?"_few":"_many";break;default:r=""}return r},e}();t.default=new s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=function(){function e(){this._resourcesLocation={}}return e.prototype.set=function(e){this._throwIfFalsy(e),this._resourcesLocation=e},e.prototype.merge=function(e){this._throwIfFalsy(e),Object.assign(this._resourcesLocation,e)},e.prototype.get=function(){return this._resourcesLocation},e.prototype._throwIfFalsy=function(e){e||r.default.throwError(10009,"[i18n / resources] Specified destination for localizations resources is not reachable")},e}();t.default=new i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(504),i=function(){return function(){this.addAgentToContacts=function(e){var t="api/v1/bots/add/"+e;return r.put("addAgentToContacts",t)}}}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(23),o=n(505),s={retryCount:3,timeout:12e4,policy:""},a=function(e,t,n){return i.default("joinAgents-"+e,s,r.Configuration.AGENTS_HOST_URL+t,n)};t.getResponse=function(e,t){return a(e,t)},t.get=function(e,t){var n={method:"GET"};return function(e,t,n){return i.default("joinAgents-"+e,s,r.Configuration.AGENTS_HOST_URL+t,n).then(function(e){return e.json()})}(e,t,n)},t.put=function(e,t,n){return void 0===n&&(n=""),o.putHeaders().then(function(r){var i={method:"PUT"};return i.body=n,i.headers=r,a(e,t,i)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13);t.putHeaders=function(){var e=new Headers;return new Promise(function(t){r.ServicesManager.signInManager.getSkypeToken().then(function(n){e.append("X-Skypetoken",n),t(e)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(23),o=n(5),s=n(31),a={retryCount:3,timeout:12e4,policy:""},c=function(){function e(){}return e.prototype.auth=function(e){void 0===e&&(e="customer");var t={method:"POST",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,lang:"en",greeniddc:"none"})};return i.default("join-auth",a,r.Configuration.WX_HOST_URL,t).then(function(e){return e.json()})},e.prototype.join=function(e,t){void 0===t&&(t="guest"),t=t||"guest",e=s.default.toFullIdentifier(e);var n=r.Configuration.INVITE_HOST_URL_INT+"users/guests/light",c={method:"POST",cache:"no-cache",headers:{"Content-Type":"application/json",Accept:"application","Accept-Language":"en-US,en;"},body:JSON.stringify({name:t,threadId:e,longId:"swc",shortId:"swc",flowId:o.default.get.sessionId})};return i.default("join-join",a,n,c).then(function(e){return e.json()})},e}();t.WX=c},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var n=e.call(this,t,!1,!0)||this;return n._isMePerson=!0,n}return i(t,e),Object.defineProperty(t.prototype,"msaId",{get:function(){return this._msaId},set:function(e){e&&(this._msaId=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"personalFileSite",{get:function(){return this._personalFileSite},set:function(e){e&&(this._personalFileSite=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayName",{get:function(){return this._forcedDisplayName?this._forcedDisplayName:e.prototype.getDisplayName.call(this)},set:function(t){e.prototype.setDisplayName.call(this,t)},enumerable:!0,configurable:!0}),t.prototype.forceDisplayName=function(e){this._forcedDisplayName=e,this.publish("displayName",e)},t}(n(300).default);t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(509),i=function(){function e(){}return e.prototype.fetchCommonEmails=function(e,t){void 0===e&&(e=10),void 0===t&&(t=0);var n="people/?$top="+e+"&$skip="+t+"&$Select=scoredEmailAddresses";return r.get("scoredMails",n).then(function(e){return e})},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(23),o=n(510),s={retryCount:3,timeout:12e4,policy:""},a=function(e,t,n){return i.default("msGraph-"+e,s,r.Configuration.MS_GRAPH_URL+t,n)};t.postWithoutHeaders=function(e,t,n){var r={method:"GET",cache:"no-cache"};return n&&(r.headers=n),a(e,t,r).then(function(e){return e.json()})},t.get=function(e,t){return o.getHeaders().then(function(n){var r={method:"GET"};return r.headers=n,r.cache="no-cache",a(e,t,r).then(function(e){return e.json()})},function(e){})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(38),o=n(80),s=n(16),a=n(75),c=n(13);function u(){return{clientID:r.Configuration.MS_APP_CLIENT_ID,graphScopes:["People.Read","openid","profile"]}}var l=function(){return function(e,t,n){var r=JSON.parse(c.ServicesManager.sessionStorage.getItem(e)),i=Math.round((new Date).getTime()/1e3);if(r){if(r.expiresIn>i)return Promise.resolve(r.token);c.ServicesManager.sessionStorage.removeItem(e)}return new Promise(function(i,o){var s;r&&(s=r.token),n(s).then(function(n){var r={expiresIn:t(n),token:n};c.ServicesManager.sessionStorage.setItem(e,JSON.stringify(r)),i(n)}).catch(o)})}(i.SKYPE_GRAPH_ACCESS_TOKEN_KEY+a.hashCode(c.ServicesManager.signInManager.currentUserName),function(e){return Math.round((new Date).getTime()/1e3)+ +e.expires_in},function(){return new Promise(function(e,t){var n=c.ServicesManager.signInManager.currentUserName,i=s.guid.generate(),a=r.Configuration.MS_AUTHORIZE_URL,l=r.Configuration.MS_APP_REDIRECT_URL_DEMO;window.location.hostname.toLowerCase().indexOf("outlook")>=0&&(l=r.Configuration.MS_APP_REDIRECT_URL_OUTLOOK);var p={response_type:"token",scope:u().graphScopes.join(" "),client_id:u().clientID,username:n,nonce:i,redirect_uri:l},d=o.addGetParamsToUrl(a,p),f=function(n){if(n.data){window.removeEventListener("message",f);var r=n.data;if(-1!==r.indexOf("access_token")){var i={};r.split("&").forEach(function(e){var t=e.split("="),n=t[0],r=t[1];i[n]=decodeURIComponent(r)}),e(i)}t(r)}};window.addEventListener("message",f),window.open(d,"_blank",r.Configuration.LOGIN_POPUP_FEATURES)})})};t.getHeaders=function(){return new Promise(function(e,t){var n=new Headers;l().then(function(t){n.append("Authorization",[t.token_type,t.access_token].join(" ")),e(n)}).catch(function(e){t(e)})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),i=n(2),o=n(27),s=n(0),a=n(13),c=n(105),u=36e5,l=function(){function e(){}return e.prototype._getDefaults=function(){var e=function(){return[{host:c.NotificationSupportedHost.Outlook,value:c.NotificationAllowedValue.All},{host:c.NotificationSupportedHost.Scom,value:c.NotificationAllowedValue.All},{host:c.NotificationSupportedHost.Office,value:c.NotificationAllowedValue.All}]};return{"swc.notification.new-message":e(),"swc.notification.incoming-call":e()}},e.prototype.get=function(){var e=this;return a.ServicesManager.webApi.fetchMeProperty("swcSettings").then(function(t){var n=t?JSON.parse(t):{};return e.swcSettings=n&&n.hasOwnProperty()?n:e._getDefaults(),{options:n}}).catch(function(t){return e.swcSettings=e.swcSettings||e._getDefaults(),{options:e.swcSettings}})},e.prototype.fetchUserOption=function(e){return this.fetchUserOptionsBatch([e]).then(function(e){return e.options.length>0?e.options.pop():void 0})},e.prototype.fetchUserOptionsBatch=function(e){return this.get().then(function(t){var n=[];return e.forEach(function(e){t.options&&t.options[e]&&n.push({name:e,value:t.options[e]})}),{options:n}})},e.prototype.setUserOption=function(e){var t=this.swcSettings;t[e.name]=e.value;var n=a.ServicesManager.webApi.setMeProperty("swcSettings",JSON.stringify(t));return n.then(function(){s.swc.Eventing.triggerEvent(r.ApiEvents.notificationSettingsChange,e)}),n},e.prototype.setUserOptionsBatch=function(e){return Promise.resolve()},e}(),p=function(){function e(){var e=this;this._hostName=i.Configuration.getPlatformName(),this._registered=!1,this._getStorageItem=function(e){var t=s.swc.services.sessionStorage.getItem(e);return t?JSON.parse(t):null},this._setStorageItem=function(e){e&&s.swc.services.sessionStorage.setItem(e.id,JSON.stringify(e))},this._checkIfValid=function(e){return e&&e.validUntil>Date.now()},this._getItem=function(e,t){return{id:e,value:t&&t.length?t:c.NOTIFICATION_DEFAULT,validUntil:Date.now()+u}},this.registerProxy=function(){e._registered||(s.swc.Eventing.registerEvent(r.ApiEvents.notificationsSettingsProxy.readOption,function(t){t.name&&e.get(t.name).then(function(e){e.pairId=t.id,s.swc.Eventing.triggerEvent(r.ApiEvents.notificationsSettingsProxy.readOptionResponse,e)})}),s.swc.Eventing.registerEvent(r.ApiEvents.notificationsSettingsProxy.setOption,function(t){if(t.o){var n=Date.now();e.set(t.o).then(function(e){s.swc.Telemetry.sendEvent.userSettings(c.NotificationSettingSource.api,t.o.name,t.o.value,Date.now()-n,"200"),e.pairId=t.id,s.swc.Eventing.triggerEvent(r.ApiEvents.notificationsSettingsProxy.setOptionResponse,e)},function(e){s.swc.Telemetry.sendEvent.userSettings(c.NotificationSettingSource.api,t.o.name,t.o.value,Date.now()-n,e)})}}),o.ProxyConnector.instance.connect("notificationSettings",{}),e._registered=!0)},this.readSettings=function(t){return new Promise(function(n,r){var i=[],o=[];t.forEach(function(t){var n=e._getStorageItem(t);e._checkIfValid(n)?i.push(n):o.push(t)});var s=e._getOptionsForHost(i);o.length?e.service.fetchUserOptionsBatch(o).then(function(t){var r=[];t&&t.options&&t.options.forEach(function(t){r.push(e._createItem(t.name,t.value))});var i=e._getOptionsForHost(r);n(s.concat(i))},function(e){r(e)}):n(s)})},this.service||(a.ServicesManager.signInManager&&a.ServicesManager.signInManager.isAadSupported()?this.service=new l:this.service=a.ServicesManager.userOptionsService)}return e.prototype._createItem=function(e,t){var n=this._getItem(e,t);return this._setStorageItem(n),n},e.prototype._resolveHeaderName=function(e){var t="";switch(e){case c.NotificationSettingType.NewMessage:t="notification_settings_header_new_message";break;case c.NotificationSettingType.IncomingCall:t="notification_settings_header_incoming_calls"}return t?s.swc.services.i18n.fetch(t):t},e.prototype._getOptionsForHost=function(e){var t=this,n=[];return e.forEach(function(e){n.push({name:t._resolveHeaderName(e.id),id:e.id,value:t._getValueForHost(e.value)})}),n},e.prototype._getValueForHost=function(e){var t=this,n=null;return e.forEach(function(e){e.host&&e.host.toLowerCase()===t._hostName&&(n=e.value)}),n||(n=c.NotificationAllowedValue.All),n},e.prototype._getOptionForHost=function(e,t){var n=this._createItem(e,t);return{name:e,value:this._getValueForHost(n.value)}},e.prototype.get=function(e){var t=this,n=this._getStorageItem(e);return new Promise(function(r,i){n&&t._checkIfValid(n)?r({name:n.id,value:t._getValueForHost(n.value)}):t.service.fetchUserOption(e).then(function(n){n&&r(t._getOptionForHost(e,n.value))},function(){r(t._getOptionForHost(e,null))})})},e.prototype.set=function(e){var t=this;return new Promise(function(n,i){var o=function(o){var a;if(!o||!o.value||!o.value.length){var u={name:e.name,value:c.NOTIFICATION_DEFAULT};o=u}if(o.value.forEach(function(n){n.host.toLocaleLowerCase()===t._hostName&&(n.value=e.value,a=!0)}),!a&&o.name===e.name){var l={host:t._hostName.toUpperCase(),value:e.value};o.value.push(l)}t.service.setUserOption(o).then(function(){var e=t._getOptionForHost(o.name,o.value);n(e),s.swc.Eventing.triggerEvent(r.ApiEvents.notificationSettingsChange,e)},function(e){i(e)})};t.service.fetchUserOption(e.name).then(o,o)})},e}();t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),i=n(0),o=n(9),s=n(13),a=n(513),c=n(514),u=n(515),l={"Event/Call":1,"Signal/Flamingo":1},p=function(){function e(){this.activeCallNotifications={},this.idOfShowedMessageNotifications={},this.everOpenedChats={},this.notifications=[],this.unreadMessageObserver=new u.default,this.isEnabled=!0}return e.prototype.enableNotifications=function(){this.isEnabled=!0},e.prototype.disableNotifications=function(){this.isEnabled=!1},e.prototype.registerUnreadMessage=function(e,t){if(!this.idOfShowedMessageNotifications[t.id]&&!this.isOpenedIConversation(e.id)&&!l[t.rawMessageType]){var n=this.unreadMessageObserver.getNotification(e,t);n&&(this.idOfShowedMessageNotifications[t.id]=!0,this.notifications.push(n),this.showNotifications())}},e.prototype.registerUnreadIConversationsSummary=function(e){if(c.default.isEnabled&&0!==(e=e.filter(function(e){return!e.alertsOff})).length&&!c.default.isIgnored()){var t=this.getUnreadIConversationsNotification(e);t&&this.notifications.push(t),this.showNotifications()}},e.prototype.registerCall=function(e){var t=new a.default(e),n=t.getNotification();n?(this.activeCallNotifications[t.callId]=n,i.swc.Eventing.triggerEvent(r.ApiEvents.ReceivedNotification,n)):o.default.throwError(200003,"Unable to create call notification")},e.prototype.callStateHandler=function(e){this.activeCallNotifications[e.id]&&1!==e.status&&(this.activeCallNotifications[e.id].hide(),delete this.activeCallNotifications[e.id])},e.prototype.setOpenedConversations=function(e){this.everOpenedChats=e,s.ServicesManager.setEverOpenedChats(e)},e.prototype.isOpenedIConversation=function(e){var t=this.everOpenedChats[e];return t&&t.onStage},e.prototype.showNotifications=function(){if(this.isEnabled)for(var e=this.notifications.length,t=0;t<e;t++){var n=this.notifications.pop();i.swc.Eventing.triggerEvent(r.ApiEvents.ReceivedNotification,n),i.swc.Telemetry.sendEvent.notificationCreated(n.type)}else this.notifications=[]},e.prototype.getUnreadIConversationsNotification=function(e){var t=i.swc.services.localStorage.getItem("swc-recentslastseen");if(!t)return new c.default(e);var n=e.filter(function(e){return e.lastMessage.originalTimestamp.getTime()>+t});return n.length?new c.default(n):null},e}();t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),i=n(5),o=n(0),s=n(81),a=n(155),c=function(){function e(e){this._callInfo=e,this.reject=function(e){var t={id:e.callId,reject:!0,callerMri:e.callerMri||""};o.swc.Eventing.triggerEvent(r.ApiEvents.RejectCall,t),o.swc.Telemetry.sendEvent.notificationAction("Calling","Ignore")},this.accept=function(e){if(o.swc.ChatContent){var t=e.mri;(s.isEnterpriseUserMri(t)?s.generateOneToOneConversationId(t):Promise.resolve(t)).then(function(n){var s={ConversationId:n||"",ExecuteCall:{id:e.callId,accept:!0,callerMri:t||""},Style:i.default.get.style};o.swc.Eventing.triggerEvent(r.ApiEvents.StartChat,s),o.swc.Telemetry.sendEvent.notificationAction("Calling","Accept")})}}}return Object.defineProperty(e.prototype,"callId",{get:function(){return this._callInfo.callId},enumerable:!0,configurable:!0}),e.prototype.getNotification=function(){var e=new a.Notification("Calling");return e.title=this._callInfo.displayName||"",e.description="Incoming call",e.avatarUrl=this._callInfo.avatar,e.actions=this.getActions(this._callInfo),e},e.prototype.getActions=function(e){var t=this;return[{type:"Accept",title:o.swc.services.i18n.fetch("accept"),description:o.swc.services.i18n.fetch("accept_descr"),action:function(){t.accept(e)}},{type:"Ignore",title:o.swc.services.i18n.fetch("ignore"),description:o.swc.services.i18n.fetch("ignore_descr"),action:function(){t.reject(e)}}]},e}();t.default=c},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=n(2),a=n(0),c=n(75),u=n(13),l=n(155),p=/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)/,d=function(e){function t(n){var r=e.call(this,"Summary")||this;return r.description=a.swc.services.i18n.fetch("notification_summary",{count:n.length}),r.avatarUrl=r.getAvatar(n)||s.Configuration.DEFAULT_AVATAR_URI,r.actions=r.getActions(),t.isEnabled=!1,t.setIgnoreToStorage(),r}return i(t,e),t.prototype.getAvatar=function(e){var t=e.filter(function(e){return!e.isGroup}),n=t.length>0?t[0]:e[0];if(n.avatar&&n.avatar.match(p))return n.avatar;var r=n.isGroup?void 0:n.id.replace(/^\d+:/,""),i=r?encodeURIComponent(r):"thread",o="https://avatar.skype.com/v1/"+"avatars/${contactId}/public?returnDefaultImage=false&cacheHeaders=true".replace("${contactId}",i);return o=o.replace("returnDefaultImage=false","returnDefaultImage=true")},t.prototype.getActions=function(){return[{type:"Accept",title:a.swc.services.i18n.fetch("open"),description:a.swc.services.i18n.fetch("open_client_descr"),action:function(){a.swc.Eventing.triggerEvent(o.ApiEvents.OpenRecentList),a.swc.Telemetry.sendEvent.notificationAction("Summary","Accept")}},{type:"Ignore",title:a.swc.services.i18n.fetch("ignore"),description:a.swc.services.i18n.fetch("ignore_summary_notificaton_descr"),action:function(){a.swc.Telemetry.sendEvent.notificationAction("Summary","Ignore")}}]},t.setIgnoreToStorage=function(){try{var e=60*(s.Configuration.ECS.sumToastDelayMin||0)*1e3,t={ignoreUntil:Date.now()+(0===e?864e5:e),id:c.hashCode(u.ServicesManager.signInManager.currentUserName)};u.ServicesManager.localStorage.setItem("swc|notificationIgnore",JSON.stringify(t))}catch(e){}},t.isIgnored=function(){try{var e=u.ServicesManager.localStorage.getItem("swc|notificationIgnore"),t=c.hashCode(u.ServicesManager.signInManager.currentUserName);if(e){var n=JSON.parse(e);if(!n.id||n.id!==t)return u.ServicesManager.localStorage.removeItem("swc|notificationIgnore"),!1;if(!n.ignoreUntil||isNaN(n.ignoreUntil))return!1;if(n.ignoreUntil>Date.now())return!0}return!1}catch(e){return!1}},t.isEnabled=!0,t}(l.Notification);t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13),i=n(516),o=n(517),s=function(){function e(){this.freshUnreadConversations={}}return e.prototype.getNotification=function(e,t){if(!this.canShow(e,t))return null;if(!this.isAllowedByUnread(e)){if(3===this.freshUnreadConversations[e.id]){var n=Object.getOwnPropertyNames(this.freshUnreadConversations).map(function(e){return r.ServicesManager.conversations.get(e)});return new i.default(n,e)}return null}var s=new o.UnreadMessageNotification(e,t);return s&&s.description?s:null},e.prototype.canShow=function(e,t){return!e.isBlocked&&(e.isUnread&&!e.alertsOff)},e.prototype.isAllowedByUnread=function(e){var t=this;if(!this.freshUnreadConversations.hasOwnProperty(e.id)){var n=function(r){r||(delete t.freshUnreadConversations[e.id],e.unsubscribe("isUnread",n))};return e.subscribe("isUnread",n),this.freshUnreadConversations[e.id]=0,!0}return this.freshUnreadConversations[e.id]++,this.freshUnreadConversations[e.id]<3},e}();t.default=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),s=n(0),a=n(60),c=n(13),u=n(155),l=window,p=function(e){function t(n,r){var i=e.call(this,"Reminder")||this;return i.title=i.getTitle(n),i.description=t.getDescription(n),i.actions=i.getActions(r),i.sender="",i.avatarUrl=t.getAvatar(r),i}return i(t,e),t.prototype.getTitle=function(e){var t="",n=s.swc.services.i18n.fetch("separator");return e.forEach(function(e){if(e.isGroup)t+=""===t?e.topic:n+" "+e.topic;else{var r=c.ServicesManager.contactsService.getContactByMriIfPresent(e.id)||a.normalizePersonId(e.id);t+=""===t?r:n+" "+r}}),t},t.getDescription=function(e){return s.swc.services.i18n.fetch("notification_reminder_desc",{count:e.length})},t.getAvatar=function(e){return e.avatar||o.Configuration.DEFAULT_AVATAR_URI},t.prototype.getActions=function(e){return[{type:"Accept",title:s.swc.services.i18n.fetch("open"),description:s.swc.services.i18n.fetch("open_client_descr"),action:function(){l.swc.SDK.Chat.startChat({ConversationId:e.id}),s.swc.Telemetry.sendEvent.notificationAction("Reminder","Accept")}},{type:"Ignore",title:s.swc.services.i18n.fetch("ignore"),description:s.swc.services.i18n.fetch("ignore_reminder_notificaton_descr"),action:function(){s.swc.Telemetry.sendEvent.notificationAction("Reminder","Ignore")}}]},t}(u.Notification);t.default=p},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),s=n(0),a=n(14),c=n(60),u=n(13),l=n(32),p=function(e){function t(n,r){var i=e.call(this,"UnreadMessage")||this;return i.title=t.getTitle(n),i.description=t.getDescription(r),i.actions=i.getActions(n),i.sender=t.getSender(n,r),i.avatarUrl=t.getAvatar(n),i}return i(t,e),t.getTitle=function(e){return e.isGroup?e.topic:u.ServicesManager.contactsService.getContactByMriIfPresent(e.id)||c.normalizePersonId(e.id)},t.getDescription=function(e){switch(e.rawMessageType){case"RichText/UriObject":case"RichText/Html":return s.swc.services.i18n.fetch("pic_sent");case"RichText/Media_GenericFile":return s.swc.services.i18n.fetch("file_sent");case"Event/Call":return s.swc.services.i18n.fetch(t.getCallMessage(e.content));default:var n=l.default.dompurify.sanitize(e.content,{ALLOWED_TAGS:[]});return a.MessageUtils.unescape(n)}},t.getCallMessage=function(e){return/<partlist type="missed"="/.test(e)?"message_text_missedCall":(/<partlist type="ended"="/.test(e),"message_text_endedCall")},t.getAvatar=function(e){var t=e.avatar||o.Configuration.DEFAULT_AVATAR_URI;return t=t.replace("returnDefaultImage=false","returnDefaultImage=true")},t.prototype.getActions=function(e){return[{type:"Accept",title:s.swc.services.i18n.fetch("open"),description:s.swc.services.i18n.fetch("open_client_descr"),action:function(){s.swc.SDK.Chat.startChat({ConversationId:e.id}),s.swc.Telemetry.sendEvent.notificationAction("UnreadMessage","Accept")}},{type:"Ignore",title:s.swc.services.i18n.fetch("ignore"),description:s.swc.services.i18n.fetch("ignore_unread_notificaton_descr"),action:function(){s.swc.Telemetry.sendEvent.notificationAction("UnreadMessage","Ignore")}}]},t.getSender=function(e,t){return e.isGroup&&t.sender?t.sender.displayName:""},t}(n(155).Notification);t.UnreadMessageNotification=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(519);t.ping=function(){return r.sendRequest("ping","GET","/swc")},t.getExistingCompanies=function(){return r.sendRequest("getCompanies","GET","/companies")},t.createCompany=function(e,t){var n={businessName:e,description:t};return r.sendRequest("createCompany","POST","/swc",{body:JSON.stringify(n)})},t.setCompanyEnabledStatusTo=function(e){return r.sendPutRequest("enableCompany","/swc/status",{body:JSON.stringify({enabled:e})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(23),o=n(520),s={retryCount:3,timeout:12e4,policy:""},a=function(e,t,n){return i.default("oa-"+e,s,r.Configuration.OA_URL+t,n)},c=function(e,t,n){e.append("Content-Type","application/json");var r=Object.assign({},n);return r.method=t,r.headers=e,r.cache="no-cache",r};t.sendRequest=function(e,t,n,r){return o.getHeaders().then(function(i){return a(e,n,c(i,t,r)).then(function(e){return e.json()})})},t.sendPutRequest=function(e,t,n){return o.getHeaders().then(function(r){return a(e,t,c(r,"PUT",n))})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13);t.postHeaders=function(){return new Promise(function(e){r.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=new Headers;n.append("X-Skypetoken",t),e(n)},function(){})})},t.getHeaders=function(){return new Promise(function(e){r.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=new Headers;n.append("X-Skypetoken",t),e(n)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),i=n(263),o=n(0),s=n(522),a=n(523),c=n(526),u=n(527),l=function(){function e(){this._isInitialized=!1}return Object.defineProperty(e.prototype,"isInitialized",{get:function(){return this._isInitialized},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"map",{get:function(){return i.shortcutIdMap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emoticonMap",{get:function(){return i.idEmoticonMap},enumerable:!0,configurable:!0}),e.prototype.canRenderConfigItems=function(){return s.default.canRenderConfigItems()},e.prototype.refresh=function(){this.renderLoop&&this.renderLoop.updateEmoticonCanvases()},e.prototype.init=function(e){var t=this;return new Promise(function(n,i){c.default.init(e).then(function(e){t.renderLoop=new u.EmoticonsRenderLoop;var i=s.default.init(e);a.default.register(i),t.renderLoop.updateCache(i),i.items&&i.items.forEach(function(e){e.background=t.renderLoop.getUrlFromCache(e.id)}),n(i),t._isInitialized=!0,o.swc.Eventing.triggerEvent(r.ApiEvents.PesConfigInitialized,null,!0),t.renderLoop.updateEmoticonCanvases()}).catch(function(){i()})})},e}();t.PesManager=l},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(263),o=n(15),s=n(73),a=n(264),c=function(){function e(){this._configuration={countryCode:"",tabsRoot:"",itemsRoot:"",emoticonsRoot:"",packsRoot:"",items:[],packs:[],tabs:[],emoticonPreviewItem:null}}return e.prototype.canRenderConfigItems=function(){return this._configuration.items.length>0},e.prototype.init=function(e){var t=this._processItems(e);t.forEach(function(e){i.idEmoticonMap[e.id]=e});var n=this._processPacks(e,t),o=e.tabs?this._resolveTabsFromSections(e,n):this._makeTabsFromPacks(n,e.packsRoot);return this._configuration=r({},e,{packs:n,tabs:o,items:t},{emoticonPreviewItem:t[0]}),this._configuration},e.prototype._processPacks=function(e,t){return e.packs.map(function(e){var n=[];return e.items.forEach(function(e){var r=t.find(function(t){return t.id===e});r&&n.push(r)}),r({},e,{items:n})})},e.prototype._resolveTabsFromSections=function(e,t){var n=this;return e.tabs.map(function(i){var o=[];return i.sections.forEach(function(e){var n=t.find(function(t){return t.id===e.pack});n&&n.items&&n.items.length&&o.push(n)}),r({},i,{packs:o,type:s.default.itemTypes.tab.id,thumbnailUrl:n._createThumbnailUrl(i.id,e.tabsRoot)})})},e.prototype._createThumbnailUrl=function(e,t){var n=(t||"#")+"/"+e+"/views/thumbnail";return n=a.rewriteUrls(n,s.default.pesCDNAuthentication.rewriteRules)},e.prototype._makeTabsFromPacks=function(e,t){var n=this,r=[];return e?(e.forEach(function(e){if(!n._isFeaturedPack(e)){var i=n._createTabFromPack(e,t);r.push(i)}}),e.forEach(function(e){if(n._isFeaturedPack(e)){var i=e.title.replace(s.default.FEATURED_IN_PREFIX,""),o=r.find(function(e){return e.title===i});o?(e.isHidden=!1,o.packs.unshift(e)):!1===e.isHidden&&(e.title=i,o=n._createTabFromPack(e,t),r.push(o))}}),r):r},e.prototype._createTabFromPack=function(e,t){var n=this._createThumbnailUrl(e.id,t),i=r({},e,{type:s.default.itemTypes.tab.id,thumbnailUrl:n,packs:[e],sections:[{pack:e.id}],glyphBgColor:"",isDiscoverable:!1,badgeETag:""});return delete i.isSponsored,delete i.items,i},e.prototype._isFeaturedPack=function(e){return 0===(e.title||"").indexOf(s.default.FEATURED_IN_PREFIX)},e.prototype._processItems=function(e){var t=this,n=e.countryCode;return e.items.filter(function(e){return e.type===s.default.itemTypes.emoticon.id&&(!(n&&e.excludedCountries&&e.excludedCountries.indexOf(n)>=0)&&!(n&&e.includedCountries&&e.includedCountries.length&&e.includedCountries.indexOf(n)<0))}).map(function(n){var i={staticHtmlClass:n.id,staticExtraLargeHtmlClass:n.id+" extraLarge",animatedExtraLargeHtmlClass:n.id+" extraLarge animated",background:""},o=e.emoticonsRoot+"/"+n.id+"/views/",s=t._getEmoticonURLs(o,n.etag),a=r({},n,i,s);return delete a.includedCountries,delete a.excludedCountries,a})},e.prototype._getEmoticonURLs=function(e,t){return e=a.rewriteUrls(e,s.default.pesCDNAuthentication.rewriteRules),{smallStaticUrl:this._buildUrl(e+s.default.profiles.emoticons.getSmall(),t),largeStaticUrl:this._buildUrl(e+s.default.profiles.emoticons.getLarge(),t),extraLargeStaticUrl:this._buildUrl(e+s.default.profiles.emoticons.getExtraLarge(),t),superLargeStaticUrl:this._buildUrl(e+s.default.profiles.emoticons.getSuperLarge(),t),smallUrl:this._buildUrl(e+s.default.profiles.emoticons.getSmallAnimated(),t),largeUrl:this._buildUrl(e+s.default.profiles.emoticons.getLargeAnimated(),t),extraLargeUrl:this._buildUrl(e+s.default.profiles.emoticons.getExtraLargeAnimated(),t),superLargeUrl:this._buildUrl(e+s.default.profiles.emoticons.getSuperLargeAnimated(),t)}},e.prototype._buildUrl=function(e,t){return o.UrlHelper.setQueryParameters(e,{etag:t})},e}();t.default=new c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(263),i=n(73),o=n(524),s=n(525),a=function(){function e(){}return e.prototype.register=function(e){var t=this._getArtifacts(e),n="";r.clearShortcutMap(),t.encodingMaps.forEach(function(e){switch(e.type){case i.default.itemTypes.emoticon.id:r.shortcutIdMap[e.shortcut]=e.id;break;case i.default.itemTypes.tab.id:case i.default.itemTypes.moji.id:case i.default.itemTypes.sticker.id:throw new Error("mapping.type not implemented yet:"+e.type);default:throw new Error("mapping.type not supported yet:"+e.type)}}),t.pesStyles.forEach(function(e){n+=e}),this._registerStyles(n)},e.prototype._getArtifacts=function(e){var t=[],n=[],r=[];return e.tabs&&e.tabs.forEach(function(e){var i=s.default.getResources(e);t.push(i.styleDef),n.unshift(i.prefetchUrls[0]),e.packs.forEach(function(e){e.items.forEach(function(e){var i=o.default.getResources(e);i&&(t.push(i.styleDef),r.push.apply(r,i.encoderMaps),n.push.apply(n,i.prefetchUrls))})})}),{pesStyles:t,prefetchUrls:n,encodingMaps:r}},e.prototype._registerStyles=function(e){var t,n,r=document.getElementById("pesStyles");return r||(n=document.head,(r=document.createElement("style")).id="pesStyles",r.type="text/css"),r.styleSheet?r.styleSheet.cssText=e:(t=document.createTextNode(e),r.firstChild&&r.removeChild(r.firstChild),r.appendChild(t)),n&&n.appendChild(r),e},e}();t.default=new a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(73),i=function(){function e(){}return e.prototype.getResources=function(e){if(e.type!==r.default.itemTypes.emoticon.id)return null;var t=e.shortcuts.map(function(t){return{shortcut:t,id:e.id,type:r.default.itemTypes.emoticon.id}});return{styleDef:"",prefetchUrls:[e.smallUrl,e.smallStaticUrl,e.largeUrl,e.largeStaticUrl,e.extraLargeUrl,e.extraLargeStaticUrl,e.superLargeUrl,e.superLargeStaticUrl],encoderMaps:t}},e}();t.default=new i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(73),i=function(){function e(){}return e.prototype.getResources=function(e){if(e.type!==r.default.itemTypes.tab.id)return null;var t="\n.swx .tab_id_"+e.id+"\n";return t+="{\n",t+=" -ms-high-contrast-adjust: none;\n",t+=" background-image: url('"+e.thumbnailUrl+"'); \n",{styleDef:t+="} \n",prefetchUrls:[e.thumbnailUrl]}},e}();t.default=new i},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),o=n(262),s=n(299),a=n(74),c=n(23),u=n(5),l=n(9),p=n(73),d=n(264),f={retryCount:3,timeout:12e4,policy:""},h=function(){function e(){}return e.prototype.init=function(e){var t=this;return this._initPromise?this._initPromise:(u.default.get.pesLanguageLocale=s.default.getPesLocale(u.default.get.currentLocale||i.Configuration.LOCALE),this._initPromise=a.configLoader("Skype",{id:e}).then(function(e){var n=e.SkypePersonalization?e.SkypePersonalization.pes_config:null,i=e.Headers?e.Headers.CountryCode:null;return n||t._throwUncaughtError("No config URL",e),t._fetchConfiguration(n).then(function(e){return r({},e,{countryCode:i})})}),this._initPromise)},e.prototype._throwUncaughtError=function(e,t){var n=t&&"string"==typeof t?t:JSON.stringify(t);l.default.throwError(10080,"[PES] configSync, url "+e+", error "+n)},e.prototype._fetchConfiguration=function(e){var t=this;return this._fetch(this._getLocalizedUrl(e)).catch(function(){return t._fetch(e)}).catch(function(n){return t._throwUncaughtError(e,n)})},e.prototype._fetch=function(e){var t=this;return e=d.rewriteUrls(e,p.default.pesCDNAuthentication.rewriteRules),Promise.resolve(c.default("pes-CDNTokenFromSkypeToken",f,e,{method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json, text/javascript"}}).then(function(e){return o.parseJson(e)}).catch(function(n){return t._throwUncaughtError(e,n)}))},e.prototype._getLocalizedUrl=function(e){var t=u.default.get.pesLanguageLocale||i.Configuration.PES_LOCALE;return e.replace("/default","/"+t)},e}();t.default=new h},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=n(21),s=n(39),a=n(73),c=n(528),u=n(302),l=["conversation","recentsList"],p={running:!1,active:!0,lastBoundsTimestamp:-1313,lastDrawTimestamp:-1313},d=function(){function e(){var e=this;if(this._pixelRatio=1,this._refreshTime=0,this._bounds={},this.BOUNDS_REFRESH_TIMEOUT=100,this._imageCache={},this.viewports={},this.updateViewport=function(t){e.viewports[t.id]?e.viewports[t.id].active=t.state.active:e.viewports[t.id]=r({},p,{active:t.state.active,window:t.window})},s.isInIframe()){var t=i.swc.services.viewports;t.byType(l).forEach(function(t){return e.updateViewport(t)}),t.onChange(this.updateViewport)}else this.viewports.default=r({},p,{window:o.default.getWindow()})}return e.prototype.updateCache=function(e){var t=this,n=0;e.items.forEach(function(r){if(!t._imageCache[r.id]&&r.type===a.default.itemTypes.emoticon.id){t._imageCache[r.id]=new c.default(e.emoticonsRoot,r);var i=r.media;i&&i.default&&i.default.fps>n&&(n=i.default.fps)}}),0!==n&&(this._refreshTime=Math.floor(1e3/n))},e.prototype.getUrlFromCache=function(e){var t="";for(var n in this._imageCache)if(this._imageCache[n].id===e){var r=this._imageCache[n].largeStatic;t=r?r.url:"";break}return t},e.prototype.updateEmoticonCanvases=function(){for(var e=0,t=Object.keys(this.viewports);e<t.length;e++){var n=t[e],r=this.viewports[n];r&&r.active&&(r.canvases=r.window.document.querySelectorAll(".swc span.emoticon canvas")),r.running=r.active&&r.canvases&&!!r.canvases.length,r.running&&this.start(r)}},e.prototype.start=function(e){var t=this,n=e.window;"devicePixelRatio"in n&&(this._pixelRatio=n.devicePixelRatio),e.lastDrawTimestamp=-1313,n.requestAnimationFrame(function(n){return t.draw(n,e)})},e.prototype.draw=function(e,t){var n=this;if(e-t.lastDrawTimestamp>=this._refreshTime){t.lastDrawTimestamp=e;var r=e-t.lastBoundsTimestamp>this.BOUNDS_REFRESH_TIMEOUT;r&&(t.lastBoundsTimestamp=e);var i=t.canvases;i&&Array.prototype.forEach.call(i,function(i){r&&delete n._bounds[i.id],n._bounds[i.id]||(n._bounds[i.id]=i.getBoundingClientRect());var s=n._bounds[i.id];if(!(s.width<=2)&&o.default.isInViewport(s,t.window)){r&&n.setDimensionsIfNeeded(i,s);var c="itemId",l="item-id",p="isAnimated",d="is-animated",f=o.default.readDataset(i,c,l),h=n._imageCache[f],g="true"===o.default.readDataset(i,p,d);try{h&&function(e,t,n,r,i){var o;o=n<=a.default.frameHeights.emoticons.SMALL?u.ITEM_SIZES.SMALL:n<=a.default.frameHeights.emoticons.LARGE?u.ITEM_SIZES.LARGE:n<=a.default.frameHeights.emoticons.EXTRA_LARGE?u.ITEM_SIZES.EXTRA_LARGE:u.ITEM_SIZES.SUPER_LARGE;t[o+(r?"Animated":"Static")].draw(e,i)}(i,h,s.width,g,e/1e3)}catch(e){}}})}t.running&&t.window.requestAnimationFrame(function(e){return n.draw(e,t)})},e.prototype.setDimensionsIfNeeded=function(e,t){var n=t.width*this._pixelRatio;e.width===n&&e.height===n||(e.width=n,e.height=n)},e}();t.EmoticonsRenderLoop=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(264),i=n(302),o=n(529),s=function(){return function(e,t){this.id=t.id,this.smallAnimated=new o.default(r.buildEmoticonUrl(e,t,i.ITEM_SIZES.SMALL,!0),t.media.default),this.largeAnimated=new o.default(r.buildEmoticonUrl(e,t,i.ITEM_SIZES.LARGE,!0),t.media.default),this.extraLargeAnimated=new o.default(r.buildEmoticonUrl(e,t,i.ITEM_SIZES.EXTRA_LARGE,!0),t.media.default),this.superLargeAnimated=new o.default(r.buildEmoticonUrl(e,t,i.ITEM_SIZES.SUPER_LARGE,!0),t.media.default),this.smallStatic=new o.default(r.buildEmoticonUrl(e,t,i.ITEM_SIZES.SMALL,!1),i.STATIC_MEDIA_INFO),this.largeStatic=new o.default(r.buildEmoticonUrl(e,t,i.ITEM_SIZES.LARGE,!1),i.STATIC_MEDIA_INFO),this.extraLargeStatic=new o.default(r.buildEmoticonUrl(e,t,i.ITEM_SIZES.EXTRA_LARGE,!1),i.STATIC_MEDIA_INFO),this.superLargeStatic=new o.default(r.buildEmoticonUrl(e,t,i.ITEM_SIZES.SUPER_LARGE,!1),i.STATIC_MEDIA_INFO)}}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.isLoaded=!1,this.isLoading=!1,this.url=e,this.mediaInfo=t}return e.prototype.draw=function(e,t){var n=this;if(!this.isLoading)if(this.isLoaded){var r=e.getContext("2d"),i=this.image.naturalWidth;r.clearRect(0,0,e.width,e.width);var o=void 0;o=1===this.mediaInfo.framesCount?0:Math.floor(t*this.mediaInfo.fps)%this.mediaInfo.framesCount,r.drawImage(this.image,0,i*o,i,i,0,0,e.width,e.width)}else this.image=new Image,this.isLoading=!0,this.image.onload=function(){n.isLoading=!1,n.isLoaded=!0,n.draw(e,t)},this.image.src=this.url},e}();t.default=r},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(301),s=["smile","laugh","heart","kiss","sad","tongueout","wink","cry","inlove","hug","cwl","lips","blush","surprised","penguin","yes","like","cool","rofl","cat","monkey","hi","snowangel","flower","giggle","devil","party","worry","champagne","sun","star","polarbear","dull","speechless","wonder","angry","puke","facepalm","sweat","holidayspirit","sleepy","bow","makeup","cash","lipssealed","shivering","cake","headbang","dance","wasntme","hungover","yawn","gift","angel","xmastree","brokenheart","think","clap","punch","envy","handshake","nod","nerdy","emo","muscle","mmm","ok","highfive","turkey","call","movember","dog","coffee","poke","swear","donttalktome","fingerscrossed","rainbow","headphones","waiting","festiveparty","bandit","heidy","beer","doh","bomb","happy","ninja"],a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.init=function(){return new Promise(function(e,n){t.initSkype().then(function(n){t.config=t._filterConfiguration(n),e(t.config)})})},t.getConfiguration=function(){return new Promise(function(e,n){t.config?e(t.config):t.init().then(function(t){e(t)})})},t}return i(t,e),t.prototype._filterConfiguration=function(e){var t=function(e){return s.indexOf(e)>-1};return e.items=e.items.filter(function(e){return t(e.id)}),e.packs.forEach(function(e){e.items=e.items.filter(function(e){return t(e.id)})}),e},t}(o.default);t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(532))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(16),o=n(94),s=n(91),a=n(533),c=n(534),u=function(){function e(){this._uploads={}}return e.prototype.checkAndUploadFile=function(e,t){var n,r=this;this._uploads[t]=o.DocumentStatus.InProgress;var i=this._getPersonalFileSite().then(function(e){return n=e,e}).then(function(){return r._checkFileCycle(n,e.name)}).then(function(t){return{fileCheckValue:t,uploadPromise:r.uploadFile(e,t,n)}});return i.catch(function(){r._uploads[t]=o.DocumentStatus.Failed}),i},e.prototype.uploadFile=function(e,t,n){var r=this,s=t.objectId,a=i.guid.generate(),u="_api/web/GetFolderByServerRelativeUrl(@folder)/Files/getByUrlOrAddStub(@file)/StartUpload(uploadId=guid'"+a+"')",l="@folder='"+t.siteInfo.relativeUrl+"'&@file='"+t.title+"'",p=""+n.personalSiteUrl+u+"?"+l,d=function(t){var i="_api/web/GetFolderByServerRelativeUrl(@folder)/Files/getByUrlOrAddStub(@file)/FinishUpload(uploadId=guid'"+a+"',fileOffset="+e.size+")",u=""+n.personalSiteUrl+i+"?"+l;return c.post(u,"").then(function(){r._uploads[s]=t?o.DocumentStatus.Failed:o.DocumentStatus.Success}).catch(function(){r._uploads[s]=o.DocumentStatus.Failed})};return this._uploads[s]=o.DocumentStatus.InProgress,c.post(p,e).then(function(){return d()}).catch(function(e){return d(e)})},e.prototype.shareFile=function(e,t){var n=r.Configuration.SHAREPOINT_URL+"_api/SP.Sharing.DocumentSharingManager.UpdateDocumentSharingInfo",i={additiveMode:!1,customMessage:"Shared a file",includeAnonymousLinksInNotification:!0,resourceAddress:e,sendServerManagedNotification:!1,userRoleAssignments:t.map(function(e){return{Role:2,UserId:e}}),validateExistingPermissions:!1};return c.postJson(n,JSON.stringify(i))},e.prototype._checkFileCycle=function(e,t,n,r){var i=this;return void 0===n&&(n=t),void 0===r&&(r=0),new Promise(function(o){i._checkFileOnce(e,n).then(function(e){return o(e.value)}).catch(function(){var n=function(e,t){var n="$1 ("+t+")$2";return e.replace(/^(.+)(\.[\w\d]+)$/g,n)}(t,++r);return i._checkFileCycle(e,t,n,r).then(o)})})},e.prototype._getPersonalFileSite=function(){var e=this;if(this._sharepointLocations)return Promise.resolve(this._sharepointLocations);var t=r.Configuration.TEAMS_PROFILE_URL+"api/mt/amer/beta/me/files/availability";return a.post("teams-mt-filesAvailability",t,"").then(function(t){if(t.errorCode)throw new Error(t.message);return e._sharepointLocations=t,t})},e.prototype._checkFileOnce=function(e,t){var n={parentServerRelativeUrl:e.personalRootFolderUrl.match(/^https?:\/\/[^\/]+(.*)\/?$/)[1]+"/Microsoft Teams Chat Files",itemName:t,createBlankFile:!1,overwrite:!1},i=r.Configuration.TEAMS_PROFILE_URL+"api/mt/amer/beta/me/files",o=s.addGetParamsToUrl(i,n);return a.post("teams-mt-fileCheck",o,"").then(function(e){return e.errorCode&&"FilenameCollision"===e.errorCode?Promise.reject(e):e})},e.prototype.downloadFile=function(e){var t="_api/web/GetFileByServerRelativeUrl('"+(e.fileInfo.serverRelativeUrl||function(e){var t="";if(e){var n=e.split("/").slice(3);n&&n.length&&(t="/"+n.join("/"))}return t}(e.objectUrl))+"')/GetPreAuthorizedAccessUrl(1)";return a.get("SharepointService.downloadFile",""+e.baseUrl+t).then(function(e){return e.value?a.getData("SharepointService.downloadFile",e.value):null})},e.prototype.getFileStatus=function(e){return this._uploads[e]},e}();t.SharepointService=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(262),o=n(13),s=n(61),a=n(23),c={retryCount:3,timeout:12e4,policy:""};t.post=function(e,n,r){return t.getHeaders().then(function(t){return function(e,t,n){return a.default("sharepoint-"+e,c,t,n)}(e,n,{method:"POST",cache:"no-cache",headers:t,body:r}).then(function(e){return e.json()})})},t.getHeaders=function(e){return void 0===e&&(e=s.AadAudience.SpacesApi),new Promise(function(t){Promise.all([o.ServicesManager.signInManager.aad(e),o.ServicesManager.signInManager.getSkypeToken()]).then(function(e){var n=e[0],i=e[1],o=new Headers({Authorization:n,"x-skypetoken":i,"x-skype-client":r.Configuration.getClientVersion(),Accept:"application/json","Content-Type":"application/json"});t(o)})})},t.get=function(e,n){var r=n.match(/^(https?:\/\/[^\/]+).*\/?$/)[1];return t.getHeaders(r).then(function(t){var r={method:"GET"};return r.headers=t,i.request(e,n,r).then(function(e){return e.json()})})},t.getData=function(e,t){var n=new Headers;n.append("Accept","text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8"),n.append("Accept-Encoding","gzip, deflate, sdch, br");var r={method:"GET"};return r.headers=n,i.request(e,t,r).then(function(e){return e.blob()})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(13),o=n(61),s=n(23);function a(e){return new Promise(function(t){i.ServicesManager.signInManager.aad(o.AadAudience.Sharepoint).then(function(n){var i=new Headers;i.append("Authorization",n),i.append("x-skype-client",r.Configuration.getClientVersion()),i.append("Accept","application/json"),e&&i.append("content-type",e),t(i)})})}function c(e,t,n){return s.default("sharepoint-"+e,{retryCount:3,timeout:12e4,policy:""},t,n)}t.postJson=function(e,t){return a("application/json").then(function(n){return c("sharepoint",e,{method:"POST",cache:"no-cache",headers:n,body:t}).then(function(e){try{return e.json()}catch(t){return e}})})},t.post=function(e,t){return a().then(function(n){return c("sharepoint",e,{method:"POST",cache:"no-cache",headers:n,body:t}).then(function(e){try{return e.json()}catch(t){return e}})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(9),o=n(16),s=n(74),a=n(13),c=n(536),u=function(){function e(){this._profiles={}}return e.prototype.fetchProfiles=function(e){var t=this;return this.getEcsConfig().then(function(){var n="?requestid="+t.getAppDataParams()+"&locale="+r.Configuration.LOCALE+"&searchstring="+e;return c.get("namesearch",n).then(function(e){return e&&e.results.forEach(function(e){var t=a.ServicesManager.persons.getPerson(e.nodeProfileData.skypeId,!1,!1);t.displayName=e.nodeProfileData.name,t.avatarData=e.nodeProfileData.avatarUrl}),e})},this.searchV1.bind(this,e))},e.prototype.searchV1=function(e){var t="search/v1.1/namesearch/swx/?requestid="+this.getAppDataParams()+"&locale="+r.Configuration.LOCALE+"&searchstring="+e;return c.get("namesearch",t)},e.prototype.getAppDataParams=function(){return[r.Configuration.APPNAME,r.Configuration.ECS.version,o.guid.generate()].join("-")},e.prototype.getEcsConfig=function(){if(e.getEcsConfigPromise)return e.getEcsConfigPromise;var t={id:a.ServicesManager.signInManager.currentUserName};return e.getEcsConfigPromise=s.configLoader("Skype",t).then(function(e){r.Configuration.ECS_GRAPH_ETAG=e.Headers.ETag;var t=e.PeopleSearch?e.PeopleSearch:void 0;if(t&&t.v2Endpoint&&(r.Configuration.ECS_GRAPH_URL=t.v2Endpoint),t&&t.serviceSettings){var n=t.serviceSettings;r.Configuration.ECS_GRAPH_SERVICE_SETTINGS="experiment="+n.experiment+";geoProximity="+n.geoProximity}},function(e){throw i.default.throwError(12002,"Unable to get advanced search params",e),e}),e.getEcsConfigPromise},e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(23),o=n(537),s={retryCount:3,timeout:12e4,policy:""};t.get=function(e,t){return o.getHeaders().then(function(n){var o={method:"GET"};return o.headers=n,o.cache="no-cache",function(e,t,n){return i.default("skypegraph-"+e,s,r.Configuration.ECS_GRAPH_URL+t,n)}(e,t,o).then(function(e){return e.json()})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(13);t.getHeaders=function(){return new Promise(function(e){i.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=new Headers;n.append("x-skypetoken",t),n.append("x-skype-client",r.Configuration.getClientVersion()),r.Configuration.ECS_GRAPH_ETAG&&n.append("x-ecs-etag",r.Configuration.ECS_GRAPH_ETAG),r.Configuration.ECS_GRAPH_SERVICE_SETTINGS&&n.append("x-skypegraphservicesettings",r.Configuration.ECS_GRAPH_SERVICE_SETTINGS),e(n)},function(){})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(539);t.getSessionStorage=r.getSessionStorage;var i=n(540);t.getLocalStorage=i.getLocalStorage},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(303);t.getSessionStorage=function(){if(r)return r;try{"object"==typeof sessionStorage&&(sessionStorage.setItem("ss","0"),sessionStorage.removeItem("ss"),r=window.sessionStorage)}catch(e){r=new i.MemoryStorage}return r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(303);t.getLocalStorage=function(){if(r)return r;try{"object"==typeof localStorage&&(localStorage.setItem("ls","0"),localStorage.removeItem("ls"),r=window.localStorage)}catch(e){r=new i.MemoryStorage}return r}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(65),s=n(156),a=function(e){function t(t){var n=e.call(this)||this;return n.mePersonMri=t,n.unreadMap={},n.debouncedNotify=o(function(){n.notify(n.unreadCounter)}),n}return i(t,e),Object.defineProperty(t.prototype,"unreadCounter",{get:function(){return Object.keys(this.unreadMap).length},enumerable:!0,configurable:!0}),t.prototype.markAsUnread=function(e){this.unreadMap[e]=!0,this.debouncedNotify()},t.prototype.markAsRead=function(e){delete this.unreadMap[e],this.debouncedNotify()},t.prototype.update=function(e){var t=s.default.isUnread(this.mePersonMri,e.id,e.properties,e.lastMessage);!("false"===e.properties.alerts)&&t?this.markAsUnread(e.id):this.markAsRead(e.id)},t}(n(305).SubscribeableStore);t.UnreadCounterStore=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(543),o=function(){function e(){this.timeout=0,this.idInQueue=[]}return e.prototype.fetchMeProperties=function(){return i.get("fetchMeProfiles","users/self/profile")},e.prototype.fetchPerson=function(e){var t=this;return this.idInQueue.push(e),10!==this.idInQueue.length?this.idInQueue.length>1?this.idInQueuePromise:(this.idInQueuePromise=new Promise(function(e,n){t.lastCreatedRequest=function(){t.fetchPersons(t.idInQueue).then(e,n),t.idInQueue=[],clearTimeout(t.timeout)},t.timeout=setTimeout(t.lastCreatedRequest,2e3)}),this.idInQueuePromise):(this.lastCreatedRequest(),this.idInQueuePromise)},e.prototype.getAvatarUrl=function(e){return r.Configuration.STRATUS_DOMAIN_HOST_URL+"users/"+e+"/profile/avatar?cacheHeaders=1"},e.prototype.fetchPersons=function(e){var t={usernames:e};return i.post("fetchPersons","batch/profiles",JSON.stringify(t))},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(23),o=n(544),s={retryCount:3,timeout:12e4,policy:""},a=function(e,t,n){return i.default("stratus-"+e,s,r.Configuration.STRATUS_DOMAIN_HOST_URL+t,n)};t.put=function(e,t,n){return o.putHeaders().then(function(r){var i={method:"PUT"};return i.body=n,i.headers=r,a(e,t,i)})},t.post=function(e,t,n){return o.getHeaders().then(function(r){r.append("Content-Type","application/json");var i={method:"POST"};return i.body=n,i.headers=r,a(e,t,i).then(function(e){return e.json()})})};t.get=function(e,t){return o.getHeaders().then(function(n){var o={method:"GET"};return o.headers=n,function(e,t,n,o){return i.default("stratus-"+e,s,(o||r.Configuration.STRATUS_DOMAIN_HOST_URL)+t,n).then(function(e){return e.json()})}(e,t,o)})},t.getData=function(e,t){return o.getDataHeaders().then(function(n){var o={method:"GET"};return o.headers=n,function(e,t,n,o){return i.default("stratus-"+e,s,(o||r.Configuration.STRATUS_DOMAIN_HOST_URL)+t,n).then(function(e){return e.blob()})}(e,t,o)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(13);function o(e){var t=new Headers;return e&&t.append("X-Skypetoken",e),t.append("X-Stratus-Caller",r.Configuration.getUiVersion()),t}t.putHeaders=function(){return new Promise(function(e){i.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=o(t);n.append("Content-Type","application/x-www-form-urlencoded"),e(n)},function(){})})},t.getHeaders=function(){return new Promise(function(e){i.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=o(t);e(n)},function(){})})},t.getProxyHeaders=function(){return new Promise(function(e){var t=o();t.append("Accept","application/json, text/javascript"),e(t)})},t.getDataHeaders=function(){return new Promise(function(e){i.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=o(t);n.append("Accept","image/webp,image/*,*/*;q=0.8"),n.append("Accept-Encoding","gzip, deflate, sdch"),e(n)},function(){})})},t.getDataProxyHeaders=function(){return new Promise(function(e){var t=o();t.append("Accept","image/webp,image/*,*/*;q=0.8"),t.append("Accept-Encoding","gzip, deflate, sdch"),e(t)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13);function i(e){return"8:"+e}var o=function(){function e(){}return e.prototype.fetchMeProperties=function(){return Promise.resolve()},e.prototype.fetchShortProfile=function(e){return r.ServicesManager.userService.then(function(t){return t.getUsers(function(e){return e.map(function(e){return function(e){return 0===e.indexOf("8:")}(e)?e:i(e)})}(e))})},e.prototype.fetchPerson=function(e){return r.ServicesManager.userService.then(function(t){return t.getUser(i(e)).then(function(e){return r.ServicesManager.avatarService.fetchAvatars(e.mri,e.displayName).then(function(t){return[{avatarUrl:"",username:e.mri,displayname:e.displayName,avatarData:t[0]}]})})})},e.prototype.getAvatarUrl=function(e){return""},e.prototype.fetchPersons=function(e){return Promise.resolve([])},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(13),i=n(547),o=function(){function e(){}return e.prototype.fetchProfiles=function(e){if(e.length>3){return new Promise(function(t){i.post("search","https://teams.microsoft.com/api/mt/amer/beta/users/search?includeDLs=true&includeBots=true&enableGuest=true&skypeTeamsInfo=true",e).then(function(e){e.value&&e.value.forEach(function(e){if(e.mri){var t=r.ServicesManager.persons.getPerson(e.mri,!1,!1);t.displayName=e.displayName,t.email=e.email,t.description=e.jobTitle,r.ServicesManager.avatarService.fetchAvatars(e.mri,e.displayName).then(function(e){e&&(t.avatarData=e)})}}),t(e.value)})})}return Promise.resolve([])},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(13),o=n(61),s=n(23),a={retryCount:3,timeout:12e4,policy:""};t.post=function(e,n,r){return t.getHeaders().then(function(t){return function(e,t,n){return s.default("teamsgraph-"+e,a,t,n)}(e,n,{method:"POST",cache:"no-cache",headers:t,body:r}).then(function(e){return e.json()})})},t.getHeaders=function(){return new Promise(function(e){Promise.all([i.ServicesManager.signInManager.aad(o.AadAudience.SpacesApi),i.ServicesManager.signInManager.getSkypeToken()]).then(function(t){var n=t[0],i=t[1],o=new Headers;o.append("Authorization",n),o.append("x-skypetoken",i),o.append("x-skype-client",r.Configuration.getClientVersion()),e(o)})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(2),o=n(0),s=n(22);t.reportInappActivityStartEvent=function(e){var t=r.default.get.isTeams()?"AAD":"MSA";o.swc.services.signInManager.onceSignedIn().then(function(){return o.swc.Telemetry.sendEvent.inAppActivityStarted(e,o.swc.services.signInManager.currentUserName,i.Configuration.getUiVersion(),s.default.getOsVersion(),t)})}},function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r=n(13),i=function(){function t(){}return t.translate=function(e,t,n){var r="https://dev.microsofttranslator.com/api/skype/translate?from="+e+"&to="+t+"&text="+n;return this._requestWithToken(r)},t.detect=function(t){var n="https://f3cc4fc2.ngrok.io/detect?text="+t;return new Promise(function(t,r){return e(encodeURI(n),{method:"GET"}).then(function(e){e.json().then(function(e){var n=e.string.$t.split("-")[0];t(n)}).catch(function(e){r(e)})},function(e){r(e)})})},t.getLanguages=function(){return this._requestWithToken("https://dev.microsofttranslator.com/api/languages")},t._requestWithToken=function(t){var n=new Headers,i={};return new Promise(function(o,s){r.ServicesManager.signInManager.getSkypeToken().then(function(r){return n.append("Content-Type","application/x-www-form-urlencoded"),n.append("X-Skypetoken",r),n.append("X-ScenarioId","FF63883DDDED40068EC45030A601460C"),i.method="GET",i.headers=n,e(encodeURI(t),i).then(function(e){e.json().then(function(e){o(e)}).catch(function(e){s(e)})},function(e){s(e)})})})},t}();t.default=i}).call(this,n(72))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(551),i=n(2),o=n(16),s=function(){return function(e){var t=this;this.logEvent=function(e){t._logger.debug(e)},this._logger=e}}(),a=function(){function e(){var e,t,n=this;this._platformName="chrome",this._stateCallback=function(e,t){e===r.TrouterState.Connected&&n.trouterUrl(t)},this._trouterUrlChangeListenerRegistry=(e=[],(t=function(t){e.push(t)}).off=function(t){var n=e.indexOf(t,0);n>-1&&e.splice(n,1)},t.notifyAll=function(t){e.forEach(function(e){e(t)})},t),this.trouterUrl=function(){var e=function(e){if(n._logger.info("trouterUrl change"),void 0===e)return n._trouterUrl;n._trouterUrl!==e&&(n._trouterUrl=e,n._trouterUrlChangeListenerRegistry.notifyAll(e))};return e.changed=n._trouterUrlChangeListenerRegistry,e}()}return e.prototype._getSettings=function(e,t){return{registrationId:o.guid.generate(),registrarServiceUrl:t.incomingCalls.registrarServiceUrl,registrarTtlInSeconds:t.incomingCalls.registrarTtlInSeconds,maxRegistrationTimeInMs:t.incomingCalls.maxRegistrationTimeInMs,registrarRefreshTimeoutInMs:t.incomingCalls.registrarRefreshTimeoutInMs,pnhAppId:t.incomingCalls.pnhAppId,pnhTemplate:t.incomingCalls.pnhTemplate,platform:e,platformUIVersion:"0.0.0",trouterServiceUrl:t.incomingCalls.trouterServiceUrl,version:t.version,trouterConnectTimeoutInMs:t.incomingCalls.trouterConnectTimeoutInMs,productName:t.productName,sessionId:t.sessionId,environment:"",incallModeTimeoutMs:0}},e.prototype._getTrouterSettings=function(){return{version:i.Configuration.getUiVersion(),productName:"swc",incomingCalls:{trouterServiceUrl:"https://go.trouter.skype.com/v4/a",registrarServiceUrl:"https://prod.registrar.skype.com/v2/registrations",registrarTtlInSeconds:360,registrarRefreshTimeoutInMs:35e4,trouterReadyTimeoutInMs:6e4,trouterConnectTimeoutInMs:2e4,maxRegistrationTimeInMs:864e5,pnhAppId:"skype",pnhTemplate:"SkypeWebNGC_1.7"},telemetry:{jSkypeTenantToken:"dummy-not-used",skypeConcoreToken:""}}},e.prototype._createTrouterTelemetryConfig=function(e){return{eventLogger:new s(e.createChild("TrouterTelemetry")),settings:{enabled:!0,logHealthCheckError:!0,trouter_js_client_connected:!0,trouter_js_client_disconnected:!0,trouter_js_client_error:!0,trouter_js_client_progress:!0,trouter_js_client_response:!0,numberOfStepsToMaintain:0,sendProgressTimeoutSecs:0}}},e.prototype._getTrouterConfig=function(e,t,n,r){return{trouterSettings:this._getSettings(t,n),skypeTokenProvider:r,telemetryConfig:this._createTrouterTelemetryConfig(e)}},e.prototype.init=function(e,t,n){var i=this._getTrouterSettings(),o={sessionId:n};return this._logger=e,this._logger.info("Trouterservice init"),this._trouterService?this._logger.warn("Trouterservice already initialized"):(this._options=this._getTrouterConfig(e,this._platformName,i,t),this._trouterService=r.createTrouterService(e.createChild("Trouter")),this.start(o)),this},e.prototype.start=function(e){this._logger.info("Trouterservice start"),this._trouterService?(e&&(this._options.trouterSettings.environment=e.environment,this._options.trouterSettings.sessionId=e.sessionId),this._trouterService.start(this._options),this._trouterService.onStateChanged(this._stateCallback)):this._logger.error("Trouterservice not initialized")},e.prototype.stop=function(){this._logger.info("Trouterservice stop"),this._trouterService?(this._trouterService.stop(),this._trouterService=void 0):this._logger.error("Trouterservice not inited")},e.prototype.registerMessageHandler=function(e){this._logger.info("Trouterservice registerMessageHandler"),this._trouterService&&this._trouterService.registerMessageHandler(e)},e.prototype.clearMessageHandlers=function(){this._trouterService&&this._trouterService.clearMessageHandlers()},e.prototype.checkConnection=function(){this._trouterService&&this._trouterService.checkConnection()},e.prototype.state=function(){return this._logger.info("Trouterservice state"),this._trouterService?this._trouterService.state():r.TrouterState.Unknown},e.prototype.onStateChanged=function(e){this._logger.info("Trouterservice onStateChanged"),this._trouterService&&this._trouterService.onStateChanged(e)},e.prototype.getTrouterUrlAsync=function(){return this._trouterService?(this._logger.info("getTrouterUrlAsync called"),this._trouterService.getTrouterUrlAsync()):Promise.reject("Trouterservice not started yet")},e}();t.Trouter=a},function(module,exports,__webpack_require__){(function(fetch){var e;e=function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=19)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.name=e,this.logger=t}return e.prototype.debug=function(e){this.logger.debug("["+this.name+"] "+e)},e.prototype.info=function(e){this.logger.info("["+this.name+"] "+e)},e.prototype.warn=function(e){this.logger.warn("["+this.name+"] "+e)},e.prototype.error=function(e){this.logger.error("["+this.name+"] "+e)},e}();t.Logger=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.constants={TROUTER_INIT:"trouterinit",TROUTER_READY_EVENT:"trouterReadyEvent",TROUTER_READY_TIMEOUT:"trouterReadyTimeout",TROUTER_TOKEN_REQUEST:"trouterTokenRequest",TROUTER_TOKEN_GET_SUCCEEDED:"trouterTokenGetSucceeded",TROUTER_TOKEN_GET_FAILED:"trouterTokenGetFailed",TROUTER_RECONNECTING:"trouterReconnecting",RENEWAL:"renewal",NEW_CONNECTION:"newConnection",ENDPOINT_REGISTRATION_FAILED:"endpointRegistrationFailed"},t.CLIENT_VERSION="2019.03.01.1",t.HANDLED_MESSAGE_ACK=200,t.UNHANDLED_MESSAGE_ACK=404,t.FAILED_MESSAGE_ACK=500},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toJson=function(e){try{return JSON.stringify(e)}catch(t){return"Unable to serialize object of type "+typeof e}},t.calculateTtlInSec=function(e){var t=Math.round((new Date).getTime()/1e3);return void 0!==e&&e>t?e-t:0},t.calculateExpireTsInSec=function(e){return Math.round((new Date).getTime()/1e3)+e};var r=function(){function e(){this.start=Date.now()}return e.prototype.duration=function(){return Date.now()-this.start},e.prototype.reset=function(){this.start=Date.now()},e}();t.Timespan=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(){}}();t.HttpHeaders=r,function(e){e[e.Unknown=0]="Unknown",e[e.Connected=2]="Connected",e[e.Disconnected=3]="Disconnected",e[e.Switching=9]="Switching"}(t.TrouterState||(t.TrouterState={}))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=function(){function e(e){this.logger=e,this.messageHandlers=[]}return e.prototype.register=function(e){if(this.messageHandlers.some(function(t){return t===e}))throw new Error("Registering the same handler twice is not allowed");this.messageHandlers.push(e)},e.prototype.clear=function(){this.logger.debug("Clearing message handlers"),this.messageHandlers=[]},e.prototype.handleMessage=function(e){for(var t={resultCode:r.UNHANDLED_MESSAGE_ACK},n=0,i=this.messageHandlers;n<i.length;n++){var o=i[n],s=this.safeExecuteHandle(o,e);if(void 0!==s&&(void 0===s.isHandled||s.isHandled))return void 0===s.resultCode&&(s.resultCode=r.HANDLED_MESSAGE_ACK),s}return t},e.prototype.safeExecuteHandle=function(e,t){try{return e.handleMessage(t)}catch(e){return void this.logger.warn("A trouter message handler is throwing exceptions. exception: "+e)}},e}();t.MessageHandlerRegistry=i},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(s=2&n[0]?o.return:n[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],o=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0}),t.addCacheAsBackupTo=function(e){var t,n=this;return function(o){return r(n,void 0,void 0,function(){return i(this,function(n){return o&&(t=void 0),[2,new Promise(function(n,r){e(o).then(function(e){t=e,n(e)}).catch(function(e){void 0!==t&&t.length>0&&n(t),r(e)})})]})})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(0),o=n(16),s=n(18),a=function(){function e(e,t,n,o,a,c){var u=this;this.logFunc=e,this.options=t,this.tokenProvider=n,this.messageHandlers=o,this.trouterUrlPromise=a,this.stateChangedListener=c,this.notifyStateChanged=function(){try{var e=void 0!==u.firstConnection?u.firstConnection.getServerState():void 0;u.logger.info("Notifying listener about Changed State"),u.stateChangedListener(u.getState(),e)}catch(e){u.logger.error("Error in callback "+e)}},this.logger=new i.Logger("Manager",e),this.logger.info("Created TrouterManager with options "+r.toJson(this.options)),this.fsm=new s.TrouterManagerFsm(e,this)}return e.prototype.start=function(){this.fsm.start()},e.prototype.stop=function(){this.fsm.stop()},e.prototype.checkConnection=function(e){void 0!==this.firstConnection&&this.firstConnection.checkConnection(e),void 0!==this.secondConnection&&this.secondConnection.checkConnection(e)},e.prototype.getServerState=function(){if(void 0!==this.firstConnection)return this.firstConnection.getServerState()},e.prototype.registerMessageHandler=function(e){this.messageHandlers.register(e)},e.prototype.clearMessageHandlers=function(){this.messageHandlers.clear()},e.prototype.getState=function(){return this.fsm.getState()},e.prototype.startFirstConnection=function(){this.firstConnection=new o.TrouterConnection(this.logFunc,this.options,this,this.tokenProvider),this.firstConnection.start()},e.prototype.startSecondConnection=function(){this.secondConnection=new o.TrouterConnection(this.logFunc,this.options,this,this.tokenProvider),this.secondConnection.start()},e.prototype.stopFirstConnection=function(e){void 0!==this.firstConnection&&(this.firstConnection.stop(e),this.storedFirstConnection=this.firstConnection,this.firstConnection=void 0)},e.prototype.stopSecondConnection=function(e){void 0!==this.secondConnection&&(this.secondConnection.stop(e),this.secondConnection=void 0)},e.prototype.switchConnections=function(){var e=this.firstConnection;this.firstConnection=this.secondConnection,this.secondConnection=e},e.prototype.doesSecondConnectionExist=function(){return void 0!==this.secondConnection},e.prototype.dispatchConnected=function(){void 0!==this.firstConnection&&(this.trouterUrlPromise.resolveUrl(this.firstConnection.getServerState().url),this.notifyStateChanged())},e.prototype.dispatchReconnecting=function(){this.notifyStateChanged()},e.prototype.dispatchStopped=function(){this.notifyStateChanged()},e.prototype.onDownstreamRequest=function(e,t,n){var r=this.buildMessage(t),i=this.messageHandlers.handleMessage(r);n.writeHead(i.resultCode,i.responseHeaders),n.end(i.responseBody)},e.prototype.onConnected=function(e){this.fsm.onConnected(e===this.firstConnection)},e.prototype.onRegistered=function(e){this.fsm.onRegistered(e===this.firstConnection)},e.prototype.onReconnecting=function(e){this.fsm.onReconnecting(e===this.firstConnection)},e.prototype.onReconnectIsRequired=function(e){this.fsm.onReconnectionRequired(e===this.firstConnection)},e.prototype.onDisconnected=function(e){this.fsm.onDisconnected(e===this.storedFirstConnection)},e.prototype.getEventIdFromRequestBody=function(e){return e&&(e.evt||e.eventId)||null},e.prototype.buildMessage=function(e){var t,n=null;try{t=JSON.parse(e.body),n=this.getEventIdFromRequestBody(t)}catch(e){}return{eventId:n,url:e.url,body:t,rawBody:e.body,headers:e.headers}},e}();t.TrouterManager=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.logger=e}return e.prototype.getPromise=function(){var e=this;return void 0!==this.url?(this.logger.debug("[TrouterUrlPromise] returning previously resolved url: "+this.url),Promise.resolve(this.url)):(void 0===this.pendingPromise?(this.logger.debug("[TrouterUrlPromise] creating and returning promise"),this.pendingPromise=new Promise(function(t,n){e.pendingPromiseResolveRef=t,e.pendingPromiseRejectRef=n})):this.logger.debug("[TrouterUrlPromise] returning existing promise"),this.pendingPromise)},e.prototype.resolveUrl=function(e){this.url=e,this.logger.debug("[TrouterUrlPromise] got url: "+this.url);var t=this.pendingPromiseResolveRef;this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,void 0!==t&&(this.logger.debug("[TrouterUrlPromise] resolving promise"),t(e))},e.prototype.rejectUrl=function(e){this.logger.debug("[TrouterUrlPromise] aborting");var t=this.pendingPromiseRejectRef;this.url=void 0,this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,void 0!==t&&(this.logger.debug("[TrouterUrlPromise] rejecting promise"),t(e))},e.prototype.resetUrl=function(){this.logger.debug("[TrouterUrlPromise] resetting url"),this.url=void 0},e}();t.TrouterUrlPromise=r},function(module,exports,__webpack_require__){(function(global,module){var t,e,n;t=module.exports,e=void 0===global?window:global,n=t,n.version="0.9.6",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(t,r){var i,o,s=n.util.parseUri(t);e&&e.location&&(s.protocol=s.protocol||e.location.protocol.slice(0,-1),s.host=s.host||(e.document?e.document.domain:e.location.hostname),s.port=s.port||e.location.port),i=n.util.uniqueUri(s);var a={host:s.host,secure:"https"==s.protocol,port:s.port||("https"==s.protocol?443:80),query:s.query||""};return n.util.merge(a,r),!a["force new connection"]&&n.sockets[i]||(o=new n.Socket(a)),!a["force new connection"]&&o&&(n.sockets[i]=o),(o=o||n.sockets[i]).of(s.path.length>1?s.path:"")};var io=module.exports;!function(e,t){var n=e.util={},r=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.parseUri=function(e){for(var t=r.exec(e||""),n={},o=14;o--;)n[i[o]]=t[o]||"";return n},n.uniqueUri=function(e){var n=e.protocol,r=e.host,i=e.port;return"document"in t?(r=r||document.domain,i=i||("https"==n&&"https:"!==document.location.protocol?443:document.location.port)):(r=r||"localhost",i||"https"!=n||(i=443)),(n||"http")+"://"+r+":"+(i||80)},n.query=function(e,t){var r=n.chunkQuery(e||""),i=[];for(var o in n.merge(r,n.chunkQuery(t||"")),r)r.hasOwnProperty(o)&&i.push(o+"="+r[o]);return i.length?"?"+i.join("&"):""},n.chunkQuery=function(e){for(var t,n={},r=e.split("&"),i=0,o=r.length;i<o;++i)(t=r[i].split("="))[0]&&(n[t[0]]=t[1]);return n};var o=!1;n.load=function(e){if("document"in t&&"complete"===document.readyState||o)return e();n.on(t,"load",e,!1)},n.on=function(e,t,n,r){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,r)},n.request=function(e){if(e&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||n.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}return null},"undefined"!=typeof window&&n.load(function(){o=!0}),n.defer=function(e){if(!n.ua.webkit||"undefined"!=typeof importScripts)return e();n.load(function(){setTimeout(e,100)})},n.merge=function(e,t,r,i){var o,s=i||[],a=void 0===r?2:r;for(o in t)t.hasOwnProperty(o)&&n.indexOf(s,o)<0&&("object"==typeof e[o]&&a?n.merge(e[o],t[o],a-1,s):(e[o]=t[o],s.push(t[o])));return e},n.mixin=function(e,t){n.merge(e.prototype,t.prototype)},n.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},n.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},n.intersect=function(e,t){for(var r=[],i=e.length>t.length?e:t,o=e.length>t.length?t:e,s=0,a=o.length;s<a;s++)~n.indexOf(i,o[s])&&r.push(o[s]);return r},n.indexOf=function(e,t,n){var r=e.length;for(n=n<0?n+r<0?0:n+r:n||0;n<r&&e[n]!==t;n++);return r<=n?-1:n},n.toArray=function(e){for(var t=[],n=0,r=e.length;n<r;n++)t.push(e[n]);return t},n.ua={},n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(e){return!1}return null!=e.withCredentials}(),n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent)}(void 0!==io?io:module.exports,void 0===global?window:global),function(e,t){function n(){}e.EventEmitter=n,n.prototype.on=function(e,n){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(n):this.$events[e]=[this.$events[e],n]:this.$events[e]=n,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(e,t){function n(){r.removeListener(e,n),t.apply(this,arguments)}var r=this;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,n){if(this.$events&&this.$events[e]){var r=this.$events[e];if(t.util.isArray(r)){for(var i=-1,o=0,s=r.length;o<s;o++)if(r[o]===n||r[o].listener&&r[o].listener===n){i=o;break}if(i<0)return this;r.splice(i,1),r.length||delete this.$events[e]}else(r===n||r.listener&&r.listener===n)&&delete this.$events[e]}return this},n.prototype.removeAllListeners=function(e){return this.$events&&this.$events[e]&&(this.$events[e]=null),this},n.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},n.prototype.emit=function(e){if(!this.$events)return!1;var n=this.$events[e];if(!n)return!1;var r=Array.prototype.slice.call(arguments,1);if("function"==typeof n)n.apply(this,r);else{if(!t.util.isArray(n))return!1;for(var i=n.slice(),o=0,s=i.length;o<s;o++)i[o].apply(this,r)}return!0}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(exports,nativeJSON){"use strict";function f(e){return e<10?"0"+e:e}function date(e,t){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,o,s,a=gap,c=t[e];switch(c instanceof Date&&(c=date(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(c)){for(o=c.length,n=0;n<o;n+=1)s[n]=str(n,c)||"null";return i=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,i}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;n<o;n+=1)"string"==typeof rep[n]&&((i=str(r=rep[n],c))&&s.push(quote(r)+(gap?": ":":")+i));else for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(i=str(r,c))&&s.push(quote(r)+(gap?": ":":")+i);return i=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,i}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(e,t,n){var r;if(gap="",indent="","number"==typeof n)for(r=0;r<n;r+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})},JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&"object"==typeof i)for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(void 0!==(r=walk(i,n))?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}(void 0!==io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(e,t){var n=e.parser={},r=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],i=n.reasons=["transport not supported","client not handshaken","unauthorized"],o=n.advice=["reconnect"],s=t.JSON,a=t.util.indexOf;n.encodePacket=function(e){var t=a(r,e.type),n=e.id||"",c=e.endpoint||"",u=e.ack,l=null;switch(e.type){case"error":var p=e.reason?a(i,e.reason):"",d=e.advice?a(o,e.advice):"";""===p&&""===d||(l=p+(""!==d?"+"+d:""));break;case"message":""!==e.data&&(l=e.data);break;case"event":var f={name:e.name};e.args&&e.args.length&&(f.args=e.args),l=s.stringify(f);break;case"json":l=s.stringify(e.data);break;case"connect":e.qs&&(l=e.qs);break;case"ack":l=e.ackId+(e.args&&e.args.length?"+"+s.stringify(e.args):"")}var h=[t,n+("data"==u?"+":""),c];return null!=l&&h.push(l),h.join(":")},n.encodePayload=function(e){var t="";if(1==e.length)return e[0];for(var n=0,r=e.length;n<r;n++)t+=""+e[n].length+""+e[n];return t};var c=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;n.decodePacket=function(e){if(!(a=e.match(c)))return{};var t=a[2]||"",n=(e=a[5]||"",{type:r[a[1]],endpoint:a[4]||""});switch(t&&(n.id=t,a[3]?n.ack="data":n.ack=!0),n.type){case"error":var a=e.split("+");n.reason=i[a[0]]||"",n.advice=o[a[1]]||"";break;case"message":n.data=e||"";break;case"event":try{var u=s.parse(e);n.name=u.name,n.args=u.args}catch(e){}n.args=n.args||[];break;case"json":try{n.data=s.parse(e)}catch(e){}break;case"connect":n.qs=e||"";break;case"ack":if((a=e.match(/^([0-9]+)(\+)?(.*)/))&&(n.ackId=a[1],n.args=[],a[3]))try{n.args=a[3]?s.parse(a[3]):[]}catch(e){}}return n},n.decodePayload=function(e){if(""==e.charAt(0)){for(var t=[],r=1,i="";r<e.length;r++)""==e.charAt(r)?(t.push(n.decodePacket(e.substr(r+1).substr(0,i))),r+=Number(i)+1,i=""):i+=e.charAt(r);return t}return[n.decodePacket(e)]}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t){function n(e,t){this.socket=e,this.sessid=t,this.connectErrorCallback=void 0,this.isOpened=!1}e.Transport=n,t.util.mixin(n,t.EventEmitter),n.prototype.onData=function(e){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==e){var n=t.parser.decodePayload(e);if(n&&n.length)for(var r=0,i=n.length;r<i;r++)this.onPacket(n[r])}return this},n.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),"heartbeat"==e.type?this.onHeartbeat():("connect"==e.type&&""==e.endpoint&&this.onConnect(),"error"==e.type&&"reconnect"==e.advice&&(this.isOpened=!1),this.socket.onPacket(e),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.close&&this.isOpened&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this.connectErrorCallback=void 0,this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},n.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.isOpened=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){this.isOpened=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},n.prototype.ready=function(e,t){t.call(this)},n.prototype.clearEventHandlers=function(){return this}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t,n){function r(e){if(this.options={port:80,secure:!1,document:"document"in n&&document,resource:"socket.io",transports:t.transports.slice(),"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!0,"auto connect":!0,"flash policy port":10843},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var r=this;t.util.on(n,"unload",function(){r.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function i(){}e.Socket=r,t.util.mixin(r,t.EventEmitter),r.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),""!==e&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},r.prototype.publish=function(){var e;for(var t in this.emit.apply(this,arguments),this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t)).$emit.apply(e,arguments)},r.prototype.handshake=function(e){function n(t){t instanceof Error?r.onError(t.message):e.apply(null,t.split(":"))}var r=this,o=this.options,s=["http"+(o.secure?"s":"")+":/",o.host+":"+o.port,o.resource,t.protocol,t.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS){var a=document.getElementsByTagName("script")[0],c=document.createElement("script");c.src=s+"&jsonp="+t.j.length,a.parentNode.insertBefore(c,a),t.j.push(function(e){n(e),c.parentNode.removeChild(c)})}else{var u=t.util.request();u.open("GET",s,!0),u.withCredentials=!0,u.onreadystatechange=function(){4==u.readyState&&(u.onreadystatechange=i,200==u.status?n(u.responseText):!r.reconnecting&&r.onError(u.responseText))},u.send(null)}},r.prototype.getTransport=function(e){for(var n,r=e||this.transports,i=0;n=r[i];i++)if(t.Transport[n]&&t.Transport[n].check(this)&&(!this.isXDomain()||t.Transport[n].xdomainCheck()))return new t.Transport[n](this,this.sessionid);return null},r.prototype.connect=function(e){if(this.connecting)return this;var n=this;return this.handshake(function(r,i,o,s){function a(){if(!n.connected)if(n.connecting=!1,clearTimeout(n.connectTimeoutTimer),n.options["try multiple transports"]){for(;n.remainingTransports.length>0&&n.remainingTransports.splice(0,1)[0]!=n.transport.name;);n.remainingTransports.length?c(n.remainingTransports):n.publish("connect_failed")}else n.publish("connect_failed")}function c(e){if(n.transport&&(n.transport.clearTimeouts(),n.transport.clearEventHandlers()),n.transport=n.getTransport(e),!n.transport)return n.publish("connect_failed");n.transport.ready(n,function(){n.connecting=!0,n.publish("connecting",n.transport.name),n.transport.open(a),n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout(function(){a()},n.options["connect timeout"]))})}n.sessionid=r,n.closeTimeout=1e3*o+2e3,n.heartbeatTimeout=1e3*i+2e3,n.transports=s?t.util.intersect(s.split(","),n.options.transports):n.options.transports,n.setHeartbeatTimeout(),n.remainingTransports=n.transports.slice(0),c(n.transports),n.once("connect",function(){clearTimeout(n.connectTimeoutTimer),e&&"function"==typeof e&&e()})}),this},r.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);var e=this;this.heartbeatTimeoutTimer=setTimeout(function(){e.transport.onClose()},this.heartbeatTimeout)},r.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},r.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.transport.payload(this.buffer),this.buffer=[])},r.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},r.prototype.disconnectSync=function(){var e=t.util.request(),n=this.resource+"/"+t.protocol+"/"+this.sessionid;e.open("GET",n,!0),this.onDisconnect("booted")},r.prototype.isXDomain=function(){var e=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=e},r.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},r.prototype.onOpen=function(){this.open=!0},r.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},r.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},r.prototype.onError=function(e){e&&e.advice&&"reconnect"===e.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},r.prototype.onDisconnect=function(e){var t=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(t||n)&&(this.transport.close(),this.transport.clearTimeouts(),t&&(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},r.prototype.reconnect=function(){function e(){if(n.connected){for(var e in n.namespaces)n.namespaces.hasOwnProperty(e)&&""!==e&&n.namespaces[e].packet({type:"connect"});n.publish("reconnect",n.transport.name,n.reconnectionAttempts)}clearTimeout(n.reconnectionTimer),n.removeListener("connect_failed",t),n.removeListener("connect",t),n.reconnecting=!1,delete n.reconnectionAttempts,delete n.reconnectionDelay,delete n.reconnectionTimer,delete n.redoTransports,n.options["try multiple transports"]=i}function t(){if(n.reconnecting)return n.connected?e():n.connecting&&n.reconnecting?n.reconnectionTimer=setTimeout(t,1e3):void(n.reconnectionAttempts++>=r?n.redoTransports?(n.publish("reconnect_failed"),e()):(n.on("connect_failed",t),n.options["try multiple transports"]=!0,n.transport=n.getTransport(),n.redoTransports=!0,n.connect()):(n.reconnectionDelay<o&&(n.reconnectionDelay*=2),n.connect(),n.publish("reconnecting",n.reconnectionDelay,n.reconnectionAttempts),n.reconnectionTimer=setTimeout(t,n.reconnectionDelay)))}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var n=this,r=this.options["max reconnection attempts"],i=this.options["try multiple transports"],o=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(t,this.reconnectionDelay),this.on("connect",t)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t){function n(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new r(this,"json"),this.ackPackets=0,this.acks={}}function r(e,t){this.namespace=e,this.name=t}e.SocketNamespace=n,t.util.mixin(n,t.EventEmitter),n.prototype.$emit=t.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},n.prototype.send=function(e,t){var n={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=t),this.packet(n)},n.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),n=t[t.length-1],r={type:"event",name:e};return"function"==typeof n&&(r.id=++this.ackPackets,r.ack="data",this.acks[r.id]=n,t=t.slice(0,t.length-1)),r.args=t,this.packet(r)},n.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},n.prototype.onPacket=function(e){function n(){r.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var r=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason);break;case"message":case"json":var i=["message",e.data];"data"==e.ack?i.push(n):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,i);break;case"event":i=[e.name].concat(e.args);"data"==e.ack&&i.push(n),this.$emit.apply(this,i);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):"unauthorized"==e.reason?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},r.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},r.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(void 0!==io?io:module.exports,void 0!==io?io:module.parent.exports),function(e,t,n){function r(e){t.Transport.apply(this,arguments)}function i(){}e.websocket=r,t.util.inherit(r,t.Transport),r.prototype.name="websocket",r.prototype.open=function(e){var r,i=t.util.query(this.socket.options.query),o=this;return this.connectErrorCallback=e,r||(r=n.MozWebSocket||n.WebSocket),this.websocket=new r(this.prepareUrl()+i),this.websocket.onopen=function(){o.onOpen(),o.socket.setBuffer(!1)},this.websocket.onmessage=function(e){o.onData(e.data)},this.websocket.onclose=function(){o.onClose(),o.socket.setBuffer(!0)},this.websocket.onerror=function(e){o.onError(e)},this},r.prototype.send=function(e){return this.websocket.send(e),this},r.prototype.payload=function(e){for(var t=0,n=e.length;t<n;t++)this.packet(e[t]);return this},r.prototype.close=function(){return this.websocket.close(),this},r.prototype.onError=function(e){void 0!==this.connectErrorCallback&&(this.connectErrorCallback(),this.connectErrorCallback=void 0),this.socket.onError(e)},r.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},r.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n},r.xdomainCheck=function(){return!0},r.prototype.clearEventHandlers=function(){return this.websocket&&(this.websocket.onopen=this.websocket.onmessage=this.websocket.onclose=this.websocket.onerror=i),this},t.transports.push("websocket")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t,n){function r(e){e&&(t.Transport.apply(this,arguments),this.sendBuffer=[])}function i(){}e.XHR=r,t.util.inherit(r,t.Transport),r.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},r.prototype.payload=function(e){for(var n=[],r=0,i=e.length;r<i;r++)n.push(t.parser.encodePacket(e[r]));this.send(t.parser.encodePayload(n))},r.prototype.send=function(e){return this.post(e),this},r.prototype.post=function(e){var t=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=function(){this.onload=i,t.socket.setBuffer(!1)}:this.sendXHR.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=i,t.posting=!1,200==this.status?(t.socket.setBuffer(!1),clearTimeout(t.sendXHR.ackTimeoutTimer)):t.onClose())},this.sendXHR.send(e),t.sendXHR.ackTimeoutTimer=setTimeout(function(){t.onClose()},t.socket.options.ackTimeoutMs)},r.prototype.close=function(){return this.onClose(),this},r.prototype.request=function(e){var n=t.util.request(this.socket.isXDomain()),r=t.util.query(this.socket.options.query,"t="+ +new Date);if(n.open(e||"GET",this.prepareUrl()+r,!0),"POST"==e)try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(e){}return n},r.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},r.check=function(e,r){try{var i=t.util.request(r),o=n.XDomainRequest&&i instanceof XDomainRequest,s=(e&&e.options&&e.options.secure?"https:":"http:")!=n.location.protocol;if(i&&(!o||!s))return!0}catch(e){}return!1},r.xdomainCheck=function(){return r.check(null,!0)},r.prototype.clearEventHandlers=function(){return this.sendXHR&&(this.sendXHR.onreadystatechange=this.sendXHR.onload=i),this}}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),function(e,t,n){function r(){t.Transport.XHR.apply(this,arguments)}function i(){}e["xhr-polling"]=r,t.util.inherit(r,t.Transport.XHR),t.util.merge(r,t.Transport.XHR),r.prototype.name="xhr-polling",r.prototype.open=function(e){return this.connectErrorCallback=e,t.Transport.XHR.prototype.open.call(this),!1},r.prototype.get=function(){if(this.isOpened){var e=this;this.xhr=this.request(),n.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=function(){e.connectErrorCallback=void 0,this.onload=i,this.onerror=i,e.onData(this.responseText),e.get()},this.xhr.onerror=function(){e.onClose(),void 0!==e.connectErrorCallback&&(e.connectErrorCallback(),e.connectErrorCallback=void 0)}):this.xhr.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=i,200==this.status?(e.connectErrorCallback=void 0,e.onData(this.responseText),e.get()):(e.onClose(),void 0!==e.connectErrorCallback&&(e.connectErrorCallback(),e.connectErrorCallback=void 0)))},this.xhr.send(null)}},r.prototype.onClose=function(){if(t.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i;try{this.xhr.abort()}catch(e){}this.xhr=null}},r.prototype.ready=function(e,n){var r=this;t.util.defer(function(){n.call(r)})},r.prototype.clearEventHandlers=function(){return t.Transport.XHR.prototype.clearEventHandlers.call(this),this.xhr&&(this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i),this},t.transports.push("xhr-polling")}(void 0!==io?io.Transport:module.exports,void 0!==io?io:module.parent.exports,void 0===global?window:global),exports.io=io}).call(exports,__webpack_require__(4),__webpack_require__(12)(module))},function(e,t,n){(function(t,r){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   4.0.5
 */
!function(t,n){e.exports=n()}(0,function(){"use strict";function e(e){return"function"==typeof e}function i(){var e=setTimeout;return function(){return e(o,1)}}function o(){for(var e=0;e<w;e+=2)(0,R[e])(R[e+1]),R[e]=void 0,R[e+1]=void 0;w=0}function s(e,t){var n=arguments,r=this,i=new this.constructor(c);void 0===i[U]&&_(i);var o=r._state;return o?function(){var e=n[o-1];E(function(){return y(o,i,e,r._result)})}():g(r,i,e,t),i}function a(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(c);return p(t,e),t}function c(){}function u(e){try{return e.then}catch(e){return j.error=e,j}}function l(t,n,r){n.constructor===t.constructor&&r===s&&n.constructor.resolve===a?function(e,t){t._state===D?f(e,t._result):t._state===L?h(e,t._result):g(t,void 0,function(t){return p(e,t)},function(t){return h(e,t)})}(t,n):r===j?h(t,j.error):void 0===r?f(t,n):e(r)?function(e,t,n){E(function(e){var r=!1,i=function(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}(n,t,function(n){r||(r=!0,t!==n?p(e,n):f(e,n))},function(t){r||(r=!0,h(e,t))},e._label);!r&&i&&(r=!0,h(e,i))},e)}(t,n,r):f(t,n)}function p(e,t){e===t?h(e,new TypeError("You cannot resolve a promise with itself")):function(e){return"function"==typeof e||"object"==typeof e&&null!==e}(t)?l(e,t,u(t)):f(e,t)}function d(e){e._onerror&&e._onerror(e._result),m(e)}function f(e,t){e._state===x&&(e._result=t,e._state=D,0!==e._subscribers.length&&E(m,e))}function h(e,t){e._state===x&&(e._state=L,e._result=t,E(d,e))}function g(e,t,n,r){var i=e._subscribers,o=i.length;e._onerror=null,i[o]=t,i[o+D]=n,i[o+L]=r,0===o&&e._state&&E(m,e)}function m(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,i=void 0,o=e._result,s=0;s<t.length;s+=3)r=t[s],i=t[s+n],r?y(n,r,i,o):i(o);e._subscribers.length=0}}function v(){this.error=null}function y(t,n,r,i){var o=e(r),s=void 0,a=void 0,c=void 0,u=void 0;if(o){if((s=function(e,t){try{return e(t)}catch(e){return F.error=e,F}}(r,i))===F?(u=!0,a=s.error,s=null):c=!0,n===s)return void h(n,new TypeError("A promises callback cannot return that same promise."))}else s=i,c=!0;n._state!==x||(o&&c?p(n,s):u?h(n,a):t===D?f(n,s):t===L&&h(n,s))}function _(e){e[U]=H++,e._state=void 0,e._result=void 0,e._subscribers=[]}function b(e,t){this._instanceConstructor=e,this.promise=new e(c),this.promise[U]||_(this.promise),T(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?f(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&f(this.promise,this._result))):h(this.promise,new Error("Array Methods must be provided an Array"))}function S(e){this[U]=H++,this._result=this._state=void 0,this._subscribers=[],c!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof S?function(e,t){try{t(function(t){p(e,t)},function(t){h(e,t)})}catch(t){h(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}var T=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},w=0,P=void 0,C=void 0,E=function(e,t){R[w]=e,R[w+1]=t,2===(w+=2)&&(C?C(o):N())},O="undefined"!=typeof window?window:void 0,k=O||{},M=k.MutationObserver||k.WebKitMutationObserver,I="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),A="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,R=new Array(1e3),N=void 0;N=I?function(){return t.nextTick(o)}:M?function(){var e=0,t=new M(o),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}():A?function(){var e=new MessageChannel;return e.port1.onmessage=o,function(){return e.port2.postMessage(0)}}():void 0===O?function(){try{var e=n(20);return void 0!==(P=e.runOnLoop||e.runOnContext)?function(){P(o)}:i()}catch(e){return i()}}():i();var U=Math.random().toString(36).substring(16),x=void 0,D=1,L=2,j=new v,F=new v,H=0;return b.prototype._enumerate=function(){for(var e=this.length,t=this._input,n=0;this._state===x&&n<e;n++)this._eachEntry(t[n],n)},b.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===a){var i=u(e);if(i===s&&e._state!==x)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(n===S){var o=new n(c);l(o,e,i),this._willSettleAt(o,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(r(e),t)},b.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===x&&(this._remaining--,e===L?h(r,n):this._result[t]=n),0===this._remaining&&f(r,this._result)},b.prototype._willSettleAt=function(e,t){var n=this;g(e,void 0,function(e){return n._settledAt(D,t,e)},function(e){return n._settledAt(L,t,e)})},S.all=function(e){return new b(this,e).promise},S.race=function(e){var t=this;return new t(T(e)?function(n,r){for(var i=e.length,o=0;o<i;o++)t.resolve(e[o]).then(n,r)}:function(e,t){return t(new TypeError("You must pass an array to race."))})},S.resolve=a,S.reject=function(e){var t=new this(c);return h(t,e),t},S._setScheduler=function(e){C=e},S._setAsap=function(e){E=e},S._asap=E,S.prototype={constructor:S,then:s,catch:function(e){return this.then(null,e)}},S.polyfill=function(){var e=void 0;if(void 0!==r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=S},S.Promise=S,S})}).call(t,n(11),n(4))},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(e){if(u===setTimeout)return setTimeout(e,0);if((u===n||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function o(){h&&d&&(h=!1,d.length?f=d.concat(f):g=-1,f.length&&s())}function s(){if(!h){var e=i(o);h=!0;for(var t=f.length;t;){for(d=f,f=[];++g<t;)d&&d[g].run();g=-1,t=f.length}d=null,h=!1,function(e){if(l===clearTimeout)return clearTimeout(e);if((l===r||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(e);try{l(e)}catch(t){try{return l.call(null,e)}catch(t){return l.call(this,e)}}}(e)}}function a(e,t){this.fun=e,this.array=t}function c(){}var u,l,p=e.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:n}catch(e){u=n}try{l="function"==typeof clearTimeout?clearTimeout:r}catch(e){l=r}}();var d,f=[],h=!1,g=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];f.push(new a(e,t)),1!==f.length||h||i(s)},a.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=c,p.addListener=c,p.once=c,p.off=c,p.removeListener=c,p.removeAllListeners=c,p.emit=c,p.prependListener=c,p.prependOnceListener=c,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(2),o=n(1),s=n(0),a=function(){return function(e){this.id=e,this.status=200,this.headers={},this.body=""}}();t.ResponseData=a,function(e){e.Connected="trouter_js_client_connected",e.Disconnected="trouter_js_client_disconnected",e.Error="trouter_js_client_error",e.Progress="trouter_js_client_progress",e.Response="trouter_js_client_response",e.Request="trouter_js_client_request",e.CheckConnection="trouter_js_client_check_connection",e.Registration="trouter_js_client_registration",e.Unregistration="trouter_js_client_unregistration"}(r=t.ClientEventName||(t.ClientEventName={}));var c=function(){return function(e,t,n,r,i){this.stepName=e,this.operation=t,this.delta=n,this.ts=r,this.error=i}}();t.TrackerStep=c;var u=function(){return function(){}}();t.Properties=u;var l=function(){return function(){this.numberOfPingReplies=0,this.connectedTimestamp=0,this.isNewUrl=!1,this.transportType="",this.connectionNumber=0}}(),p=function(){return function(){this.enabled=!1,this.numberOfStepsToMaintain=40,this.logHealthCheckError=!1,this.sendProgressTimeoutSecs=55,this.logSendPingError=!1,this.maxBackoffInMs=12e4,this.trouter_js_client_connected=!1,this.trouter_js_client_disconnected=!1,this.trouter_js_client_error=!1,this.trouter_js_client_progress=!1,this.trouter_js_client_response=!1,this.trouter_js_client_request=!1,this.trouter_js_client_registration=!1,this.trouter_js_client_unregistration=!1,this.trouter_js_client_check_connection=!0}}(),d=function(){function e(e,t,n,r,o,a){this.clientId=t,this.clientInfo=n,this.getServerState=r,this.clientCorrelationID=o,this.environment=a,this.logger=new s.Logger("ConnectionTracker",e),this.clientCorrelationID=void 0!==o?o:"",this.steps=[],this.connectionAttempt=0,this.totalStepCount=0,this.beginTimestamp=new i.Timespan,this.eventLogSettings=new p,this.connectedInfo=new l}return e.prototype.enable=function(e){this.eventLogSettings.enabled=!0,this.eventLogger=e},e.prototype.disable=function(){this.eventLogSettings.enabled=!1},e.prototype.sendProgress=function(e){this.steps.length>0&&this.sendTelemetry(r.Progress,e,this.steps)},e.prototype.cancelProgressTimer=function(){void 0!==this.progressTimeout&&(clearTimeout(this.progressTimeout),this.progressTimeout=void 0)},e.prototype.resetProgressSendTimer=function(){var e=this;this.cancelProgressTimer(),void 0!==this.eventLogSettings.sendProgressTimeoutSecs&&this.eventLogSettings.sendProgressTimeoutSecs>0&&(this.progressTimeout=setTimeout(function(){e.sendProgress({reason:"timeout",timeoutSecs:e.eventLogSettings.sendProgressTimeoutSecs})},1e3*this.eventLogSettings.sendProgressTimeoutSecs))},e.prototype.setConnectedInfo=function(e,t){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=Date.now(),this.connectedInfo.isNewUrl=e,this.connectedInfo.transportType=t,++this.connectedInfo.connectionNumber},e.prototype.clearConnectedInfo=function(){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=0,this.connectedInfo.isNewUrl=!0,this.connectedInfo.transportType=""},e.prototype.copyProperties=function(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var i=r[n];t.hasOwnProperty(i)&&void 0!==t[i]&&(e[i.replace(/-/g,"_")]={value:t[i]})}},e.prototype.increasePingResponseCount=function(){++this.connectedInfo.numberOfPingReplies},e.prototype.sendTelemetry=function(e,t,n){try{if(!0===this.eventLogSettings.enabled&&!0===this.eventLogSettings[e]&&void 0!==this.eventLogger){var r=this.getServerState(),s={name:e,properties:{connectionAttempt:{value:this.connectionAttempt},clientCorrelationID:{value:this.clientCorrelationID},steps:{value:i.toJson(n)},clientID:{value:this.clientId},eventVersion:{value:3},environment:{value:this.environment},cv:{value:o.CLIENT_VERSION},ua:{value:this.clientInfo.ua},connectionId:{value:r.connectionId},connectedClientId:{value:r.connectedClientId},domId:{value:r.domId},url:{value:r.unsecureUrl},surl:{value:r.url},ttlInSecs:{value:r.getRemainingTtlInSec()},numberOfPingReplies:{value:this.connectedInfo.numberOfPingReplies},connectedTimestamp:{value:this.connectedInfo.connectedTimestamp},isNewUrl:{value:this.connectedInfo.isNewUrl},transportType:{value:this.connectedInfo.transportType},connectionNumber:{value:this.connectedInfo.connectionNumber}}};this.copyProperties(s.properties,t),this.eventLogger.logEvent(s)}}catch(t){this.logger.warn("error in sending event "+e+": "+i.toJson(t))}},e.prototype.createStep=function(e,t,n){return new c(e,t,this.beginTimestamp.duration(),Date.now(),n)},e.prototype.addStep=function(e,t,n){if(!1!==this.eventLogSettings.enabled&&(0===this.steps.length&&this.beginTimestamp.reset(),this.steps.push(this.createStep(e,t,n)),++this.totalStepCount,void 0!==this.eventLogSettings.numberOfStepsToMaintain&&this.steps.length>this.eventLogSettings.numberOfStepsToMaintain)){var i=this.steps.slice(0);this.steps.length=0,this.sendTelemetry(r.Progress,{reason:"flush"},i)}},e.prototype.trackStart=function(e){this.addStep(e,"start")},e.prototype.trackEnd=function(e){this.addStep(e,"end")},e.prototype.trackError=function(e,t,n,i){void 0===i&&(i=!1),"health"===e&&!0!==this.eventLogSettings.logHealthCheckError||"ping"===e&&!1===this.eventLogSettings.logSendPingError||(!0===i&&this.addStep(e,t,n),this.sendTelemetry(r.Error,{},[this.createStep(e,t,n)]))},e.prototype.trackProgress=function(e,t){this.addStep(e,t)},e.prototype.trackConnected=function(e,t){this.setConnectedInfo(e,t);var n=this.steps.slice(0),i=this.totalStepCount,o=this.beginTimestamp.duration();this.steps.length=0,this.totalStepCount=0,this.sendTelemetry(r.Connected,{stepCount:n.length,totalStepCount:i,connectionEstablishmentMs_Total:o},n),this.cancelProgressTimer()},e.prototype.trackDisconnected=function(e){e.sessionLengthMS=Date.now()-this.connectedInfo.connectedTimestamp,this.sendTelemetry(r.Disconnected,e,[]),this.resetProgressSendTimer()},e.prototype.trackNewConnection=function(){++this.connectionAttempt},e.prototype.trackRequest=function(e,t){var n={};void 0!==t&&(n.hasError=!0,n.error=t);try{if(e){n.requestID=e.id,n.httpMethod=e.method,n.url=e.url,n.bodyLength=e.body.length,n.shortUrl=e.shortUrl,n.requestTimeStamp=e.startTS;for(var o=e.headers,s=0,a=Object.keys(o);s<a.length;s++){var c=a[s];o.hasOwnProperty(c)&&(n[c]=o[c])}}}catch(e){n.hasError=!0,n.error=n.error+" error creating request context "+i.toJson(e)}this.sendTelemetry(r.Request,n,[])},e.prototype.trackResponse=function(e,t,n,o){var s={};void 0!==o&&(s.hasError=!0,s.error=o);try{if(s.responseTimestamp=void 0!==n?n.sentTS:Date.now(),e){s.requestID=e.id,s.httpMethod=e.method,s.shortUrl=e.shortUrl;for(var a=e.headers,c=0,u=Object.keys(a);c<u.length;c++){var l=u[c];a.hasOwnProperty(l)&&(s[l]=a[l])}}n&&(s.latencyMS=t,s.responseCode=n.status,s.responseLength=n.body.length)}catch(e){s.hasError=!0,s.error=s.error+" error creating response context "+i.toJson(e)}this.sendTelemetry(r.Response,s,[])},e.prototype.sendResponseError=function(e,t,n){this.trackResponse(t,void 0,n,e)},e.prototype.close=function(){this.sendProgress({reason:"closed"}),this.steps.length=0,this.cancelProgressTimer()},e.prototype.mergeSettings=function(e){if(e){this.eventLogSettings.numberOfStepsToMaintain=Math.min(40,Math.max(10,void 0!==e.numberOfStepsToMaintain?e.numberOfStepsToMaintain:0)),this.eventLogSettings.sendProgressTimeoutSecs=Math.min(3600,Math.max(55,void 0!==e.sendProgressTimeoutSecs?e.sendProgressTimeoutSecs:0)),this.eventLogSettings.logHealthCheckError=e.logHealthCheckError,this.eventLogSettings.logSendPingError=e.logSendPingError;for(var t=0,n=Object.keys(r).map(function(e){return r[e]});t<n.length;t++){var i=n[t];e.hasOwnProperty(i)&&void 0!==e[i]&&(this.eventLogSettings[i]=e[i])}this.resetProgressSendTimer()}},e}();t.ConnectionTracker=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.logger=e,this.maxBackoffInMs=t,this.backoffId=0,this.backoffCount=0}return e.calculateNextBackoffMs=function(e,t){var n=1+.4*(Math.random()-.5),r=1e3*Math.pow(2,e)*n;return r=Math.round(r),Math.min(t,r)},e.prototype.setMaxBackoffMs=function(e){this.maxBackoffInMs=e},e.prototype.backoff=function(t,n){var r=this;void 0!==this.timerHandle&&(this.logger.debug("Clearing current back off"),clearTimeout(this.timerHandle),this.timerHandle=void 0);var i=e.calculateNextBackoffMs(this.backoffCount,this.maxBackoffInMs);this.backoffId++,this.backoffCount++,this.logger.info("Backing off "+t+" for "+i+" milliseconds with ID "+this.backoffId),this.timerHandle=setTimeout(function(){r.logger.info("Back off for "+t+" with ID "+r.backoffId+" complete, invoking handler"),r.timerHandle=void 0,n()},i)},e.prototype.reset=function(){void 0!==this.timerHandle&&(this.logger.debug("Resetting back off"),clearTimeout(this.timerHandle),this.timerHandle=void 0),this.backoffCount=0},e}();t.ExponentialBackoff=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=function(){function e(e,t,n,r,i,o){this.connectionId=e,this.connectedClientId=t,this.domId=n,this.unsecureUrl=r,this.url=i,this.expirationTsSec=o}return e.prototype.getRemainingTtlInSec=function(){return r.calculateTtlInSec(this.expirationTsSec)},e}();t.ServerState=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),i=n(2),o=n(13),s=n(1),a=n(14),c=n(15),u=n(0),l=n(17),p=n(9),d=function(){return function(){this.cv=s.CLIENT_VERSION,this.ua="",this.hr="",this.v=""}}(),f=function(){return function(){this["force new connection"]=!0,this.reconnect=!1,this.query="",this.ackTimeoutMs=5e3}}(),h=function(){function e(e){var t=JSON.parse(e);this.startTS=t.hasOwnProperty("startTS")?t.startTS:0,this.url=t.hasOwnProperty("url")?t.url:"",this.shortUrl=t.hasOwnProperty("shortUrl")?t.shortUrl:"",this.body=t.hasOwnProperty("body")?t.body:"",this.headers=t.hasOwnProperty("headers")?t.headers:{},this.id=t.hasOwnProperty("id")&&"number"==typeof t.id?t.id:-1,this.method=t.hasOwnProperty("method")?t.method:""}return e.prototype.on=function(e,t){"data"===e?this.dataCallback=t:"end"===e&&("function"==typeof this.dataCallback&&this.dataCallback(this.body),t())},e}(),g=function(){function e(e,t,n){this.request=e,this.responseData=t,this.sendResponse=n}return e.prototype.writeHead=function(e,t){this.responseData.status=e,this.responseData.headers=t},e.prototype.write=function(e){this.responseData.body+=e},e.prototype.end=function(e){e&&(this.responseData.body+=e),this.sendResponse(this.request,this.responseData)},e}(),m=function(){function e(e,t,n,r){var c=this;this.options=t,this.manager=n,this.tokenProvider=r,this.connectionId="",this.inIncallMode=!1,this.connectionAttempt=0,this.connectedClientId="",this.UNKNOWN_TRANSPORT="unknown_transport",this.logger=new u.Logger("Connection",e),this.timeoutOptions=this.options.timeoutOptions,this.healthBackoff=new a.ExponentialBackoff(this.logger,this.timeoutOptions.maxBackoffMs),this.tokenBackoff=new a.ExponentialBackoff(this.logger,this.timeoutOptions.maxBackoffMs),this.clientID=Date.now(),this.healthUrl=this.options.trouterUrl,"undefined"!=typeof window&&window.location&&(this.domId=window.location.hostname),this.clientInfo=new d,this.clientInfo.cv=s.CLIENT_VERSION,this.clientInfo.ua="",this.options&&this.options.clientInfo&&(this.clientInfo.ua=this.safeString(this.options.clientInfo.ua),this.clientInfo.v=this.safeString(this.options.clientInfo.v)),this.connectionTracker=new o.ConnectionTracker(e,this.clientID,this.clientInfo,function(){return c.getServerState()},this.options.clientCorrelationID,this.options.environment);try{this.options.eventLogger&&"function"==typeof this.options.eventLogger.logEvent?(this.connectionTracker.mergeSettings(this.options.telemetrySettings),this.connectionTracker.enable(this.options.eventLogger)):this.logger.warn("Trouter client event logging disabled due to invalid configuration.")}catch(e){this.connectionTracker.disable(),this.logger.warn("Trouter client event logging disabled. error in initialization: "+i.toJson(e))}var p=this.options.incallModeTimeoutMs>0;this.fsm=new l.TrouterFsm(e,this,p)}return e.prototype.start=function(){this.logger.info("Starting"),this.fsm.start()},e.prototype.stop=function(e){this.logger.info("Stopping"),this.connectionTracker.close(),this.fsm.stop(e)},e.prototype.checkConnection=function(e){this.logger.info("checkConnection called with "+e),this.fsm.checkConnection(e),e&&this.connectionTracker.sendTelemetry(o.ClientEventName.CheckConnection,{disconnectDetected:e},[])},e.prototype.getServerState=function(){return new c.ServerState(this.connectionId,this.connectedClientId,this.domId?this.domId:"",this.allocateResult?this.allocateResult.url:"",this.allocateResult?this.allocateResult.surl:"",this.connectionExpireTimestampInSecs)},e.prototype.getToken=function(e,t){var n=this;this.logger.info("Getting token "+(t?"with backoff":"without backoff"));var r=function(){n.connectionTracker.trackStart("token"),n.tokenProvider(!e).then(function(e){n.logger.debug("token is received"),n.connectionTracker.trackEnd("token"),n.fsm.onTokenReceived(e)}).catch(function(t){var r=i.toJson(t);n.logger.error("Error getting token - retry after timeout: "+r),n.connectionTracker.trackError("token","error",r,!0),n.getToken(e,!0)})};t?this.tokenBackoff.backoff("getting token",r):(this.tokenBackoff.reset(),r())},e.prototype.startConnectionTimer=function(){var e=this;this.logger.debug("Starting connection timeout for "+this.timeoutOptions.connectionTimeoutMs+" ms"),this.connectionTimeoutId=setTimeout(function(){e.logger.info("Connection timeout is fired"),e.fsm.onConnectingTimeout()},this.timeoutOptions.connectionTimeoutMs)},e.prototype.stopConnectionTimer=function(){this.connectionTimeoutId&&(this.logger.debug("Stopping connection timeout"),clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=void 0)},e.prototype.startPingTimer=function(){var e=this;"websocket"===this.transportTypeName?(this.logger.debug("Starting ping timeout for "+this.timeoutOptions.pingTimeoutMs+" ms"),this.pingTimerId=setInterval(function(){e.logger.info("Ping interval fired"),e.fsm.onPingInterval()},this.timeoutOptions.pingTimeoutMs)):this.logger.debug("Not starting ping for transport "+this.transportTypeName)},e.prototype.stopPingTimer=function(){this.pingTimerId&&(this.logger.debug("Stopping ping timeout"),this.clearPingResponseTimer(),clearInterval(this.pingTimerId),this.pingTimerId=void 0)},e.prototype.shouldSkipRegistration=function(){return void 0===this.options.registration},e.prototype.hasCustomRegisterTtl=function(){return this.options.registration&&this.options.registration.registrarTtlSec},e.prototype.startRegisterTimer=function(){var e=this;if(void 0===this.registrationTimerId){var t=this.getRegistrationTtl()-30;this.logger.debug("Starting registration timeout for "+t+" sec"),this.registrationTimerId=setTimeout(function(){e.logger.info("Registration timeout is fired"),e.registrationTimerId=void 0,e.fsm.onRegistrationTimeout()},1e3*t)}else this.logger.error("Another registration timer is set - don't create another one")},e.prototype.stopRegisterTimer=function(){this.registrationTimerId&&(this.logger.debug("Stopping registration timeout"),clearTimeout(this.registrationTimerId),this.registrationTimerId=void 0)},e.prototype.buildSocketIoUrlParams=function(){if(!this.allocateResult)throw new Error("Allocate result is undefined in buildSocketIoUrlParams()");var e={};if(this.allocateResult.connectparams)for(var t=this.allocateResult.connectparams,n=0,r=Object.keys(t);n<r.length;n++){var o=r[n];t.hasOwnProperty(o)&&void 0!==t[o]&&(e[o]=t[o])}return e.v="v4",e.tc=encodeURI(i.toJson(this.clientInfo)),e.timeout=this.timeoutOptions.pingTimeoutMs/1e3,e.auth="true",this.appendConnectedClientIds(this.buildQuery(e),!0)},e.prototype.startSocketIo=function(){var e=this;if(this.logger.info("Starting socket io"),this.connectionTracker.trackStart("connectSocket"),!this.allocateResult)throw new Error("Allocate result is undefined in startSocketIo()");var t=this.options.ioOptions||new f;if(t["force new connection"]=!0,t.reconnect=!1,t.query=this.buildSocketIoUrlParams(),this.logger.info("connecting to "+this.allocateResult.socketio+"?"+t.query),this.stopSocketIo(),this.socket=(this.options.io||p).connect(this.allocateResult.socketio,t),void 0===this.socket)throw new Error("Can't create Socket.io object");this.socket.on("connecting",function(t){e.onSocketConnecting(t)}),this.socket.on("connect",function(){e.onSocketConnect()}),this.socket.on("connect_failed",function(t){e.onSocketConnectFailed(t)}),this.socket.on("disconnect",function(){e.onSocketDisconnect()}),this.socket.on("reconnect",function(){e.onSocketReconnect()}),this.socket.on("reconnect_failed",function(t){e.onSocketReconnectFailed(t)}),this.socket.on("reconnecting",function(){e.onSocketReconnecting()}),this.socket.on("error",function(t){e.onSocketError(t)}),this.socket.on("message",function(t){e.onSocketMessage(t)}),this.socket.on("trouter.connected",function(t){e.onTrouterConnected(t)}),this.socket.on("trouter.reconnect",function(){e.onTrouterReconnect()})},e.prototype.stopSocketIo=function(){if(this.socket){this.logger.info("clearing socket.io");try{for(var e=0,t=["connecting","connect","connect_failed","disconnect","reconnect","reconnect_failed","reconnecting","error","message","trouter.connected","trouter.reconnect"];e<t.length;e++){var n=t[e];this.socket.removeAllListeners(n)}this.socket.disconnect(),this.logger.debug("cleared socket"),this.socket=void 0}catch(e){this.logger.error("exception in disconnecting previous socket: "+i.toJson(e.stack))}}},e.prototype.dispatchConnected=function(){this.logger.info("dispatching connected"),this.manager.onConnected(this)},e.prototype.dispatchRegistered=function(){this.logger.info("dispatching connected"),this.manager.onRegistered(this)},e.prototype.dispatchDownstreamRequest=function(e){var t=this;this.logger.info("dispatching downstream request");try{var n=new g(e,new o.ResponseData(e.id),function(e,n){t.logger.info("sending response to downstream"),t.sendResponse(e,n)});this.manager.onDownstreamRequest(this,e,n)}catch(e){this.logger.error("exception in socket.on message: "+i.toJson(e.stack))}},e.prototype.dispatchReconnecting=function(){this.logger.info("dispatching reconnecting"),this.manager.onReconnecting(this)},e.prototype.dispatchReconnectIsRequired=function(){this.logger.info("dispatching reconnect is required by server"),this.manager.onReconnectIsRequired(this)},e.prototype.dispatchDisconnected=function(){this.logger.info("dispatching disconnected"),this.manager.onDisconnected(this)},e.prototype.resetAllocationConnectionParams=function(){this.allocateResult&&(this.logger.info("Resetting allocation connection parameters"),this.allocateResult.connectparams=void 0)},e.prototype.sendAllocateRequest=function(e){var t=this;this.connectionAttempt++,this.connectionTracker.trackNewConnection();var n=this.appendCorrelationIds(this.options.trouterUrl,!1);this.allocateResult&&this.allocateResult.connectparams&&(n+="&"+this.buildQuery(this.allocateResult.connectparams),this.allocateResult.connectparams.v||(n+="&v=v4"));var r=new Request(n,{method:"POST",mode:"cors",headers:new Headers({"X-Skypetoken":e,"Content-Type":"text/plain"})});this.logger.info("sendAllocateRequest: POST "+n),this.connectionTracker.trackStart("allocation"),this.fetchWithTimeout(r,this.timeoutOptions.fetchTimeoutMs).then(function(e){if(401===e.status)throw{message:e.statusText||"Request not authorized",status:401};if(200!==e.status)throw new Error("Response status "+e.status+" "+e.statusText);var n=e.headers.get("content-type");if(!n||"application/json"!==n&&"application/json;"!==n.substring(0,17))throw new Error("Content-type "+n+" is unexpected");return t.connectionTracker.trackEnd("allocation"),e.json()}).then(function(e){t.onAllocationResponse(e)}).catch(function(e){t.logger.error("Allocation request failed with "+e.message),t.connectionTracker.trackError("allocation","end",e.message,!0),t.fsm.onAllocationFailed(e.status&&401===e.status)})},e.prototype.sendPingRequest=function(){var e=this;if(this.socket&&void 0===this.pingResponseTimerId)try{this.logger.info("emitting ping event"),this.socket.emit("ping",function(){e.onPingResponse()}),this.pingResponseTimerId=setTimeout(function(){e.logger.error("Ping response timeout is fired"),e.clearPingResponseTimer(),e.fsm.onPingResponseTimeout()},this.timeoutOptions.pongTimeoutMs)}catch(e){var t=i.toJson(e.stack);this.logger.error("unable to send ping, error: "+t),this.connectionTracker.trackError("ping","send",t)}},e.prototype.sendRegisterRequest=function(e){var t=this;this.logger.info("sending register request");var n=new i.Timespan;if(!this.options.registration)throw new Error("Internal error - options.registration is undefined");if(!this.allocateResult)throw new Error("Allocate result is undefined in sendRegisterRequest()");var r={clientDescription:{appId:this.options.registration.pnhAppId,aesKey:"",languageId:"en-US",platform:this.options.registration.platform,templateKey:this.options.registration.pnhTemplateKey,platformUIVersion:this.options.registration.platformUIVersion},registrationId:this.options.registration.registrationId,nodeId:"",transports:{TROUTER:[{context:"",path:this.allocateResult.surl,ttl:this.getRegistrationTtl()}]}},s=new Request(this.options.registration.registrarUrl,{method:"POST",mode:"cors",headers:new Headers({"X-Skypetoken":e,"content-type":"application/json",accept:"application/json, text/javascript"}),body:i.toJson(r)});this.connectionTracker.trackStart("registration"),this.fetchWithTimeout(s,this.timeoutOptions.fetchTimeoutMs).then(function(e){e.ok?(t.logger.info("onRegisterResponse: status "+e.status),t.connectionTracker.trackEnd("registration"),t.fsm.onRegistrationSucceed()):(t.logger.error("Error status in register response: "+e.status),t.connectionTracker.trackError("registration","registration",e.status.toString()),t.fsm.onRegistrationFailed(401===e.status)),t.connectionTracker.sendTelemetry(o.ClientEventName.Registration,{status:e.status,duration:n.duration()},[])}).catch(function(e){t.logger.error("Error while sending register request: "+e.message),t.fsm.onRegistrationFailed(!1),t.connectionTracker.sendTelemetry(o.ClientEventName.Registration,{status:-1,duration:n.duration()},[])})},e.prototype.sendUnregisterRequest=function(e){var t=this;this.logger.info("sending unregister request");var n=new i.Timespan;if(!this.options.registration)throw new Error("Internal error - options.registration is undefined");var r=new Request(this.options.registration.registrarUrl+"/"+this.options.registration.registrationId,{method:"DELETE",mode:"cors",headers:new Headers({"X-Skypetoken":e,accept:"application/json, text/javascript"})});this.connectionTracker.trackStart("unregistration"),this.fetchWithTimeout(r,this.timeoutOptions.fetchTimeoutMs).then(function(e){e.ok?(t.logger.info("onUnregisterResponse: status "+e.status),t.connectionTracker.trackEnd("unregistration"),t.fsm.onUnregistrationSucceed()):(t.logger.error("Error status in unregister response: "+e.status),t.connectionTracker.trackError("unregistration","unregistration",e.status.toString()),t.fsm.onUnregistrationFailed(401===e.status)),t.connectionTracker.sendTelemetry(o.ClientEventName.Unregistration,{status:e.status,duration:n.duration()},[])}).catch(function(e){t.logger.error("Error while sending unregister request: "+e.message),t.fsm.onUnregistrationFailed(!1),t.connectionTracker.sendTelemetry(o.ClientEventName.Unregistration,{status:-1,duration:n.duration()},[])})},e.prototype.fetchWithTimeout=function(e,t){return new r.Promise(function(n,r){fetch(e).then(n).catch(r),0!==t&&setTimeout(r,t,new Error("Fetch for '"+e.url+"' timed out"))})},e.prototype.sendHealthRequest=function(e){var t=this;this.logger.info("sending health request "+(e?"with backoff":"without backoff"));var n=new Request(this.healthUrl,{method:"POST",mode:"cors",headers:new Headers}),r=function(){t.logger.info("sendHealthRequest: POST "+n.url),t.connectionTracker.trackStart("health"),t.fetchWithTimeout(n,t.timeoutOptions.fetchTimeoutMs).then(function(e){if(!e.ok)throw new Error("Response status "+e.status+" "+e.statusText);t.connectionTracker.trackEnd("health"),t.logger.info("Health check request succeed"),t.fsm.onHealthSucceed()}).catch(function(e){t.logger.error("Health check request failed with "+e.message),t.connectionTracker.trackEnd("health"),t.connectionTracker.trackError("health","health error",e.message),t.fsm.onHealthFailed()})};e?this.healthBackoff.backoff("health request",r):(this.healthBackoff.reset(),r())},e.prototype.resetHealthBackoff=function(){this.healthBackoff.reset()},e.prototype.resetTokenBackoff=function(){this.tokenBackoff.reset()},e.prototype.restartIncallModeTimer=function(){var e=this;this.clearIncallModeTimerId(),this.logger.debug("Restarting incall mode timer"),this.incallModeTimerId=setTimeout(function(){e.logger.info("Call mode timer fired"),e.fsm.onIncallModeTimer()},this.options.incallModeTimeoutMs)},e.prototype.enterIncallMode=function(){this.logger.info("Entering incall mode"),this.timeoutOptions=this.options.incallTimeoutOptions,this.healthBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!0},e.prototype.exitIncallMode=function(){this.logger.info("Exiting incall mode"),this.clearIncallModeTimerId(),this.timeoutOptions=this.options.timeoutOptions,this.healthBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!1},e.prototype.isIncallMode=function(){return this.inIncallMode},e.prototype.onSocketConnecting=function(e){this.logger.info("onSocketConnecting("+e+")"),this.transportTypeName=e,this.connectionTracker.trackProgress("connecting",this.transportTypeName),this.fsm.onConnecting()},e.prototype.onSocketConnect=function(){this.logger.info("onSocketConnect")},e.prototype.onSocketConnectFailed=function(e){this.logger.error("onSocketConnectFailed"),this.connectionTracker.trackError("connect_failed",this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT,e,!0),this.fsm.onConnectingFailed()},e.prototype.onSocketDisconnect=function(){this.logger.error("onSocketDisconnect"),this.connectionTracker.trackDisconnected({serverClosed:!this.fsm.isActive()}),this.connectionTracker.clearConnectedInfo(),this.fsm.onSocketError(void 0),this.connectionExpireTimestampInSecs=void 0},e.prototype.onSocketReconnect=function(){this.logger.error("onSocketReconnect"),this.fsm.onTrouterConnected()},e.prototype.onSocketReconnectFailed=function(e){this.logger.error("onSocketReconnectFailed with '"+e+"'"),this.fsm.onSocketError("string"==typeof e?e:void 0)},e.prototype.onSocketReconnecting=function(){this.logger.error("onSocketReconnecting")},e.prototype.onSocketError=function(e){this.logger.error("onSocketError with '"+i.toJson(e)+"'"),this.connectionTracker.trackError("connectSocket","socketio.error",e,!0),this.fsm.onSocketError("string"==typeof e?e:void 0)},e.prototype.onSocketMessage=function(e){var t;this.logger.info("onSocketMessage");try{t=new h(e),this.logger.info("Received request N "+t.id+" to '"+t.url+"'"),t.startTS=Date.now(),t.url&&this.urlPath&&0===t.url.indexOf(this.urlPath)&&(t.shortUrl=t.url.substring(this.urlPath.length))}catch(e){var n=i.toJson(e.stack);return this.logger.error("unable to parse request, error: "+n),this.connectionTracker.trackRequest(void 0,n),void this.connectionTracker.sendResponseError("unable to parse request, error: "+e.message)}try{this.connectionTracker.trackRequest(t),this.fsm.onDownstreamRequest(t)}catch(e){this.logger.error("exception in socket.on message: "+i.toJson(e.stack)),this.connectionTracker.sendResponseError(e.message,t,void 0)}},e.prototype.onTrouterConnected=function(e){if(this.allocateResult){this.logger.info("onTrouterConnected: "+this.allocateResult.url),this.socket&&this.socket.socket&&this.socket.socket.options&&this.socket.socket.options.query&&(this.socket.socket.options.query+="&connected=true"),this.urlPath=this.allocateResult.url.replace(/https?:\/\/([A-z0-9\:\$\-\_\.\+\!\*\"\(\)\,]*)\//,"/");var t=this.connectedUrl!==this.allocateResult.url;this.connectedUrl=this.allocateResult.url,this.connectionExpireTimestampInSecs=i.calculateExpireTsInSec(e.ttl),this.connectionTracker.trackEnd("connectSocket"),this.connectionTracker.trackConnected(t,this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT),this.fsm.onTrouterConnected()}else this.logger.error("Invalid internal state - received onTrouterConnected while allocateResult is not set")},e.prototype.onTrouterReconnect=function(){this.logger.info("onTrouterReconnect"),this.fsm.onReconnectRequired()},e.prototype.onAllocationResponse=function(e){this.logger.info("Received allocation response"),this.allocateResult=e;var t=+e.ttl;this.connectionExpireTimestampInSecs=i.calculateExpireTsInSec(t),this.connectionId=this.allocateResult.id||"",this.allocateResult.healthUrl?this.healthUrl=this.allocateResult.healthUrl:(this.healthUrl=this.getHealthUrl(this.options.trouterUrl),this.logger.warn("No healthUrl property found when parsing allocation.")),this.connectedClientId=this.allocateResult.ccid,this.logger.info("connected client id set {connectedClientId:"+this.connectedClientId+"}"),this.healthUrl=this.appendConnectedClientIds(this.healthUrl,!1),this.fsm.onAllocationSucceed()},e.prototype.onPingResponse=function(){this.logger.info("onPingResponse"),this.connectionTracker.increasePingResponseCount(),this.clearPingResponseTimer(),this.fsm.onPingResponse()},e.prototype.clearPingResponseTimer=function(){void 0!==this.pingResponseTimerId&&(clearTimeout(this.pingResponseTimerId),this.pingResponseTimerId=void 0)},e.prototype.buildQuery=function(e){for(var t=[],n=0,r=Object.keys(e);n<r.length;n++){var i=r[n];e.hasOwnProperty(i)&&void 0!==e[i]&&t.push(i+"="+e[i])}return t.join("&")},e.prototype.appendConnectedClientIds=function(e,t){var n="";e.indexOf("ccid=")<0&&(n="ccid="+this.connectedClientId+"&"),this.domId&&(n+="dom="+this.domId+"&"),n.length>0&&(n=n.slice(0,-1));var r=t||-1!==e.indexOf("?")?"&":"?";return this.appendCorrelationIds(e+r+n,t)},e.prototype.appendCorrelationIds=function(e,t){var n=t||-1!==e.indexOf("?")?"&":"?";return e.indexOf("cor_id")<0?""+e+n+"cor_id="+this.options.clientCorrelationID+"&con_num="+this.clientID+"_"+this.connectionAttempt:e},e.prototype.getHealthUrl=function(e){return e.substring(0,e.lastIndexOf("/a"))+"/h"},e.prototype.safeString=function(e){return"string"==typeof e?e:""},e.prototype.sendResponse=function(e,t){this.logger.info("Sending response for request N "+e.id+" with status "+t.status),t.headers=t.headers||{},e.headers&&e.headers["trouter-request"]&&!t.headers["trouter-request"]&&(t.headers["trouter-request"]=e.headers["trouter-request"]);var n=Date.now()-e.startTS;if(t.headers["trouter-client"]=i.toJson({cd:n}),this.logger.debug("response: "+i.toJson(t)),this.socket)try{this.socket.send(i.toJson(t)),t.sentTS=Date.now(),this.connectionTracker.trackResponse(e,n,t),"websocket"===this.transportTypeName&&this.sendPingRequest()}catch(n){var r="unable to send data on response.end, err: "+i.toJson(n.stack);this.connectionTracker.sendResponseError(r,e,t),this.logger.error(r)}else this.connectionTracker.sendResponseError("no socket",e,t)},e.prototype.getRegistrationTtl=function(){var e=i.calculateTtlInSec(this.connectionExpireTimestampInSecs);return this.logger.debug("Current connectionID will expire in "+e+" seconds"),this.options.registration&&this.options.registration.registrarTtlSec&&e>0?Math.min(this.options.registration.registrarTtlSec,e):this.options.registration&&this.options.registration.registrarTtlSec?this.options.registration.registrarTtlSec:e>0?e:3600},e.prototype.clearIncallModeTimerId=function(){void 0!==this.incallModeTimerId&&(this.logger.debug("Clearing in-call mode timer"),clearTimeout(this.incallModeTimerId),this.incallModeTimerId=void 0)},e}();t.TrouterConnection=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i,o=n(0);!function(e){e[e.Initial=0]="Initial",e[e.RetrievingToken=1]="RetrievingToken",e[e.Allocating=2]="Allocating",e[e.Handshaking=3]="Handshaking",e[e.Connecting=4]="Connecting",e[e.Connected=5]="Connected",e[e.CheckingHealth=6]="CheckingHealth",e[e.UnregisteringRetrievingToken=7]="UnregisteringRetrievingToken",e[e.Unregistering=8]="Unregistering"}(r=t.State||(t.State={})),function(e){e[e.Initial=0]="Initial",e[e.RetrievingToken=1]="RetrievingToken",e[e.Registering=2]="Registering",e[e.Registered=3]="Registered",e[e.NotRegistered=4]="NotRegistered"}(i||(i={}));var s=function(){function e(e,t,n){this.worker=t,this.incallModeEnabled=n,this.state=r.Initial,this.isAllocateResultValid=!1,this.connectionErrors=0,this.logger=new o.Logger("ConnectionFsm",e),this.connectedSubstate=i.Initial}return e.prototype.getState=function(){return this.state},e.prototype.isActive=function(){return this.state===r.Allocating||this.state===r.CheckingHealth||this.state===r.Connected||this.state===r.Handshaking||this.state===r.Connecting||this.state===r.RetrievingToken},e.prototype.start=function(){return this.state===r.Initial?(this.setState(r.RetrievingToken),this.worker.getToken(!0,!1),!0):(this.showIgnored("start"),!1)},e.prototype.stop=function(e){e&&(this.connectedSubstate=i.Initial),this.worker.isIncallMode()&&this.worker.exitIncallMode(),this.worker.resetHealthBackoff(),this.worker.resetTokenBackoff(),this.state!==r.Connecting&&this.state!==r.Handshaking&&this.state!==r.Connected&&this.state!==r.CheckingHealth||this.worker.stopSocketIo(),this.isRegistered()?(this.setState(r.UnregisteringRetrievingToken),this.worker.stopRegisterTimer(),this.worker.getToken(!0,!1)):(this.setState(r.Initial),this.worker.dispatchDisconnected())},e.prototype.onTokenReceived=function(e){this.state===r.RetrievingToken?(this.setState(r.Allocating),this.worker.sendAllocateRequest(e)):this.state===r.Connected&&this.connectedSubstate===i.RetrievingToken?(this.connectedSubstate=i.Registering,this.worker.sendRegisterRequest(e)):this.state===r.UnregisteringRetrievingToken?(this.setState(r.Unregistering),this.worker.sendUnregisterRequest(e)):this.showIgnored("onTokenReceived")},e.prototype.checkConnection=function(e){e?this.onPingInterval():this.onHealthSucceed()},e.prototype.onAllocationSucceed=function(){return this.state===r.Allocating?(this.isAllocateResultValid=!0,this.setState(r.Handshaking),this.connectedSubstate=i.Initial,this.worker.startSocketIo(),!0):this.state===r.CheckingHealth?(this.isAllocateResultValid=!0,this.setState(r.Handshaking),this.worker.startConnectionTimer(),this.connectedSubstate=i.Initial,this.worker.startSocketIo(),!0):(this.showIgnored("onAllocationSucceed"),!1)},e.prototype.onAllocationFailed=function(e){this.state===r.Allocating?(this.setState(r.RetrievingToken),this.worker.stopConnectionTimer(),this.worker.getToken(!e,!0)):this.showIgnored("onAllocationFailed")},e.prototype.onConnectingTimeout=function(){this.state===r.Allocating||this.state===r.Connecting||this.state===r.Handshaking?(this.setState(r.CheckingHealth),this.resetAllocationIfNecessary(void 0),this.worker.sendHealthRequest(!1)):this.showIgnored("onConnectingTimeout")},e.prototype.onConnecting=function(){this.state===r.Handshaking?this.setState(r.Connecting):this.showIgnored("onConnecting")},e.prototype.onConnectingFailed=function(){this.state===r.Connecting?this.onConnectingTimeout():this.state===r.Handshaking?(this.logger.error("Unexpected error in Socket.io - no valid transports"),this.onConnectingTimeout()):this.showIgnored("onConnectingFailed")},e.prototype.onSocketError=function(e){this.state===r.Handshaking?(this.setState(r.CheckingHealth),this.worker.resetAllocationConnectionParams(),this.resetAllocationIfNecessary(e),this.worker.sendHealthRequest(!1)):this.state===r.Connected?(this.setState(r.CheckingHealth),this.worker.dispatchReconnecting(),this.resetAllocationIfNecessary(e),this.worker.sendHealthRequest(!1)):this.showIgnored("onSocketError")},e.prototype.onHealthSucceed=function(){this.state===r.CheckingHealth?(this.worker.stopSocketIo(),this.isAllocateResultValid?(this.logger.info("Allocation exists - connecting"),this.setState(r.Handshaking),this.worker.startConnectionTimer(),this.worker.startSocketIo()):(this.logger.info("Allocation doesn't exists - start with getting token"),this.setState(r.RetrievingToken),this.worker.getToken(!0,!0))):this.showIgnored("onHealthSucceed")},e.prototype.onHealthFailed=function(){this.state===r.CheckingHealth?this.worker.sendHealthRequest(!0):this.showIgnored("onHealthFailed")},e.prototype.onTrouterConnected=function(){this.state===r.Connecting||this.state===r.CheckingHealth?(this.setState(r.Connected),this.isAllocateResultValid=!0,this.worker.resetTokenBackoff(),this.worker.stopConnectionTimer(),this.connectionErrors=0,this.worker.shouldSkipRegistration()?(this.connectedSubstate=i.NotRegistered,this.worker.dispatchRegistered()):(this.connectedSubstate=i.RetrievingToken,this.worker.getToken(!0,!1))):this.showIgnored("onTrouterConnected")},e.prototype.onReconnectRequired=function(){this.worker.dispatchReconnectIsRequired()},e.prototype.onDownstreamRequest=function(e){this.state===r.Connected?(this.switchToIncallModeIfEnabled(),this.worker.dispatchDownstreamRequest(e)):this.state===r.CheckingHealth?(this.setState(r.Connected),this.switchToIncallModeIfEnabled(),this.worker.dispatchDownstreamRequest(e)):this.showIgnored("onDownstreamRequest")},e.prototype.onPingInterval=function(){this.state===r.Connected?this.worker.sendPingRequest():this.showIgnored("onPingInterval")},e.prototype.onPingResponseTimeout=function(){this.state===r.Connected?(this.setState(r.CheckingHealth),this.worker.dispatchReconnecting(),this.worker.sendHealthRequest(!1)):this.showIgnored("onPingResponseTimeout")},e.prototype.onPingResponse=function(){this.state===r.CheckingHealth?this.setState(r.Connected):this.state===r.Connected||this.showIgnored("onPingResponse")},e.prototype.onRegistrationFailed=function(e){this.state===r.Connected&&this.connectedSubstate===i.Registering?(this.connectedSubstate=i.RetrievingToken,this.worker.getToken(!e,!0)):this.showIgnored("onRegistrationFailed")},e.prototype.onRegistrationSucceed=function(){this.state===r.Connected?(this.connectedSubstate===i.Registering&&(this.connectedSubstate=i.Registered,this.worker.dispatchRegistered()),this.worker.hasCustomRegisterTtl()&&this.worker.startRegisterTimer()):this.showIgnored("onRegistrationSucceed")},e.prototype.onRegistrationTimeout=function(){this.state===r.Connected&&this.connectedSubstate!==i.NotRegistered?(this.connectedSubstate=i.RetrievingToken,this.worker.getToken(!0,!1)):this.showIgnored("onRegistrationTimeout")},e.prototype.onUnregistrationFailed=function(e){this.state===r.Unregistering?(this.setState(r.UnregisteringRetrievingToken),this.worker.getToken(!e,!e)):this.showIgnored("onUnregistrationFailed")},e.prototype.onUnregistrationSucceed=function(){this.state===r.Unregistering?(this.setState(r.Initial),this.worker.dispatchDisconnected()):this.showIgnored("onUnregistrationSucceed")},e.prototype.onIncallModeTimer=function(){this.worker.exitIncallMode(),this.state===r.Connected?(this.worker.stopPingTimer(),this.worker.startPingTimer()):this.showIgnored("onIncallModeTimer")},e.prototype.showIgnored=function(e){this.logger.debug("Ignoring event '"+e+"' in state '"+r[this.state]+"'")},e.prototype.setState=function(e){this.logger.info("Switching from state '"+r[this.state]+"' to state '"+r[e]+"'"),this.state!==e?(this.onStateExit(this.state),this.state=e,this.onStateEnter(this.state)):this.logger.error("Attempt to switching into the current state '"+r[e]+"'")},e.prototype.onStateExit=function(e){e===r.Connected&&this.worker.stopPingTimer()},e.prototype.onStateEnter=function(e){e===r.Connected?(this.worker.startPingTimer(),this.worker.dispatchConnected()):e===r.CheckingHealth?this.worker.stopConnectionTimer():e===r.Allocating&&this.worker.startConnectionTimer()},e.prototype.resetAllocationIfNecessary=function(e){this.connectionErrors++,this.connectionErrors>=2||void 0!==e&&/^4\d\d /.test(e)?(this.logger.error("Connection error count is "+this.connectionErrors+" - will reset allocation"),this.connectionErrors=0,this.isAllocateResultValid=!1):this.logger.info("Connection error count is "+this.connectionErrors+" - will NOT reset allocation")},e.prototype.isRegistered=function(){return this.connectedSubstate===i.Registered||this.connectedSubstate===i.Registering},e.prototype.switchToIncallModeIfEnabled=function(){this.incallModeEnabled&&(this.worker.isIncallMode()||(this.worker.enterIncallMode(),this.worker.stopPingTimer(),this.worker.startPingTimer()),this.worker.restartIncallModeTimer())},e}();t.TrouterFsm=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),i=n(0),o=function(){function e(e,t){this.worker=t,this.state=r.TrouterState.Unknown,this.logger=new i.Logger("ManagerFsm",e)}return e.prototype.start=function(){this.state===r.TrouterState.Unknown?(this.setState(r.TrouterState.Disconnected),this.worker.startFirstConnection()):this.showIgnored("start")},e.prototype.stop=function(){this.state!==r.TrouterState.Unknown?(this.setState(r.TrouterState.Unknown),this.worker.stopFirstConnection(!1),this.worker.stopSecondConnection(!1)):this.showIgnored("stop")},e.prototype.getState=function(){return this.state},e.prototype.onConnected=function(e){this.state===r.TrouterState.Disconnected&&e?this.worker.doesSecondConnectionExist()?this.setState(r.TrouterState.Switching):(this.setState(r.TrouterState.Connected),this.worker.dispatchConnected()):this.showIgnored("onConnected("+e+")")},e.prototype.onRegistered=function(e){this.state===r.TrouterState.Disconnected&&!e||this.state===r.TrouterState.Switching&&!e?(this.setState(r.TrouterState.Connected),this.worker.switchConnections(),this.worker.stopSecondConnection(!0),this.worker.dispatchConnected()):this.showIgnored("onRegistered("+e+")")},e.prototype.onReconnecting=function(e){this.state===r.TrouterState.Connected&&e?(this.setState(r.TrouterState.Disconnected),this.worker.dispatchReconnecting()):this.state===r.TrouterState.Switching&&e?(this.setState(r.TrouterState.Disconnected),this.worker.dispatchReconnecting()):this.showIgnored("onReconnecting("+e+")")},e.prototype.onReconnectionRequired=function(e){this.state===r.TrouterState.Connected&&e?(this.setState(r.TrouterState.Switching),this.worker.startSecondConnection()):this.state===r.TrouterState.Disconnected&&e?this.worker.startSecondConnection():this.showIgnored("onReconnectionRequired("+e+")")},e.prototype.onDisconnected=function(e){this.state===r.TrouterState.Unknown&&e?this.worker.dispatchStopped():this.showIgnored("onDisconnected("+e+")")},e.prototype.showIgnored=function(e){this.logger.info("Ignoring event '"+e+"' in state '"+r.TrouterState[this.state]+"'")},e.prototype.setState=function(e){this.logger.info("Switching from state '"+r.TrouterState[this.state]+"' to state '"+r.TrouterState[e]+"'"),this.state!==e?this.state=e:this.logger.error("Attempt to switching into the current state '"+r.TrouterState[e]+"'")},e}();t.TrouterManagerFsm=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=n(3);t.TrouterState=o.TrouterState;var s=n(5),a=n(6),c=n(7),u=n(8),l=function(){function e(e){this.logger=e,this.stateChangedListeners=[]}return e.prototype.onStateChanged=function(e){this.logger.info("onStateChanged called"),void 0===e?this.stateChangedListeners=this.stateChangedListeners.filter(function(e){return void 0===e.wrappedCallback}):(this.offStateChanged(e),this.stateChangedListeners.push(function(e){var t=function(t,n){e(t,n?n.url:"")};return t.wrappedCallback=e,t}(e)))},e.prototype.offStateChanged=function(e){this.logger.info("offStateChanged called");var t=this.stateChangedListeners.length;return this.stateChangedListeners=this.stateChangedListeners.filter(function(t){return t.wrappedCallback!==e}),t>this.stateChangedListeners.length},e.prototype.addCallback=function(e){this.logger.info("addListener called"),-1===this.stateChangedListeners.indexOf(e,0)&&void 0!==e&&this.stateChangedListeners.push(e)},e.prototype.removeCallback=function(e){this.logger.info("removeListener called");var t=this.stateChangedListeners.indexOf(e,0);return t>-1&&(this.stateChangedListeners.splice(t,1),!0)},e.prototype.notifyStateChanged=function(e,t){var n=this;this.logger.info("notifyStateChanged called, will forward to "+this.stateChangedListeners.length+" listeners"),this.stateChangedListeners.forEach(function(r){try{r(e,t)}catch(e){n.logger.error("Error in callback "+e)}})},e}();t.TrouterConnectionObserver=l;var p=function(e){function t(t){var n=e.call(this,t)||this;return n.trouterUrlPromise=new u.TrouterUrlPromise(t),n.messageHandlers=new s.MessageHandlerRegistry(t),n.logger.info("Created TrouterService version "+i.CLIENT_VERSION),n}return r(t,e),t.prototype.state=function(){return void 0!==this.trouterServer?this.trouterServer.getState():o.TrouterState.Unknown},t.prototype.getServerState=function(){if(void 0!==this.trouterServer)return this.trouterServer.getServerState()},t.prototype.start=function(e){var t=this;if(this.logger.info("Start"),!e.trouterSettings.disableInternalSkypeTokenCache){var n=e.skypeTokenProvider;e.skypeTokenProvider=a.addCacheAsBackupTo(n)}void 0===this.trouterServer&&(this.trouterServer=new c.TrouterManager(this.logger,function(e){return{clientInfo:{ua:e.trouterSettings.productName,v:e.trouterSettings.version},ioOptions:{ackTimeoutMs:5e3},clientCorrelationID:e.trouterSettings.sessionId,environment:e.trouterSettings.environment,telemetrySettings:e.telemetryConfig.settings,eventLogger:e.telemetryConfig.eventLogger,trouterUrl:e.trouterSettings.trouterServiceUrl,registration:e.trouterSettings.registrarServiceUrl?{registrarUrl:e.trouterSettings.registrarServiceUrl,registrationId:e.trouterSettings.registrationId||"",pnhAppId:e.trouterSettings.pnhAppId||"",platform:e.trouterSettings.platform||"",pnhTemplateKey:e.trouterSettings.pnhTemplate||"",platformUIVersion:e.trouterSettings.platformUIVersion||"",registrarTtlSec:(e.trouterSettings.maxRegistrationTimeInMs||0)/1e3}:void 0,timeoutOptions:e.trouterSettings.timeoutOptions||{connectionTimeoutMs:e.trouterSettings.trouterConnectTimeoutInMs||3e4,fetchTimeoutMs:1e4,pingTimeoutMs:4e4,pongTimeoutMs:5e3,maxBackoffMs:3e4},incallTimeoutOptions:e.trouterSettings.incallTimeoutOptions||{connectionTimeoutMs:1e4,fetchTimeoutMs:5e3,pingTimeoutMs:5e3,pongTimeoutMs:2e3,maxBackoffMs:1e4},incallModeTimeoutMs:e.trouterSettings.incallModeTimeoutMs||0}}(e),e.skypeTokenProvider,this.messageHandlers,this.trouterUrlPromise,function(e,n){t.notifyStateChanged(e,n)})),this.trouterServer.start()},t.prototype.stop=function(){this.logger.log("[Trouter] close connection"),this.trouterUrlPromise.rejectUrl(new Error("TrouterSerice is stopped")),void 0!==this.trouterServer&&this.trouterServer.stop()},t.prototype.registerMessageHandler=function(e){this.logger.info("registerMessageHandler is called"),this.messageHandlers.register(e)},t.prototype.clearMessageHandlers=function(){this.logger.info("clearMessageHandlers is called"),this.messageHandlers.clear()},t.prototype.checkConnection=function(e){void 0!==this.trouterServer&&this.trouterServer.checkConnection(e||!1)},t.prototype.getTrouterUrlAsync=function(){return void 0!==this.trouterServer?this.trouterUrlPromise.getPromise():Promise.reject(new Error("TrouterService has not been started"))},t}(l);t.TrouterService=p,t.createTrouterService=function(e){return new p(e)},t.getTrouterServiceVersion=function(){return i.CLIENT_VERSION}},function(e,t){}])},module.exports=e()}).call(this,__webpack_require__(72))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=n(553),o=r.Configuration.USER_OPTIONS_SERVICE.PROD+"options/v1/users/self/options",s=function(){function e(){}return e.prototype.fetchUserOption=function(e){var t=o+"/"+e;return new Promise(function(e,n){i.get("fetchUserOption",encodeURI(t)).then(function(t){t&&t.code?50300===t.code||50100===t.code||40100===t.code||n(t):e(t)},function(e){n(e)})})},e.prototype.fetchUserOptionsBatch=function(e){if(!e.length)return null;var t=o+"?names="+e.join(",");return new Promise(function(e,n){i.get("fetchUserOptionsBatch",encodeURI(t)).then(function(t){t&&t.code?50300===t.code||50100===t.code||40100===t.code||n(t):e(t)},function(e){n(e)})})},e.prototype.setUserOption=function(e){var t=o+"/"+e.name,n={value:e.value};return new Promise(function(e,r){i.putData("setUserOption",t,JSON.stringify(n)).then(function(t){t&&202===t.status?e(t):r(t)},function(e){r(e)})})},e.prototype.setUserOptionsBatch=function(e){var t={options:e};return i.post("setUserOptionsBatch",o,JSON.stringify(t)).then(null,function(e){})},e}();t.SkypeUserOptionsService=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(16),o=n(13),s=n(23),a={retryCount:3,timeout:12e4,policy:""},c=function(e,t,n){return s.default("userOptions-"+e,a,t,n)},u=function(){return new Promise(function(e,t){return o.ServicesManager.signInManager.getSkypeToken().then(function(t){var n=new Headers({"x-microsoft-skype-chain-id":r.default.get.correlationId,"x-microsoft-skype-message-id":i.guid.generate(),"x-skypetoken":t,Accept:"application/json","Content-Type":"application/json"});e(n)})})};t.post=function(e,t,n){return u().then(function(r){return c(e,t,{method:"POST",cache:"no-cache",headers:r,body:n}).then(function(e){return e.json()})})},t.putData=function(e,t,n){return u().then(function(r){var i={method:"PUT"};return i.body=n,i.headers=r,s.default("userOptions-"+e,a,t,i)})},t.get=function(e,t){return u().then(function(n){var r={method:"GET"};return r.headers=n,c(e,t,r).then(function(e){return e.json()})})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.fetchUserOption=function(e){return Promise.resolve()},e.prototype.setUserOption=function(e){return Promise.resolve()},e.prototype.fetchUserOptionsBatch=function(e){return Promise.resolve()},e.prototype.setUserOptionsBatch=function(e){return Promise.resolve()},e}();t.TeamsUserOptionsService=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(17),i=n(556),o=function(){function e(e){var t=this;this.client=e,this._userProfiles={},this.resolve=function(e){var n=[];return e.forEach(function(e){t._userProfiles[e.mri].resolve(e),n.push(e)}),n},this._requestQueue=new i.BatchQueue(function(e){return t.getUsers(e)},{timeout:200})}return e.prototype.cleanUpUnresolved=function(e){var t=this;e.forEach(function(e){t._userProfiles[e]&&t._userProfiles[e].status!==r.PromiseStatus.Resolved&&(t._userProfiles[e].cancel(),delete t._userProfiles[e])})},e.prototype.getExisting=function(e){var t=this,n=[];return e.forEach(function(e){t._userProfiles[e]&&n.push(t._userProfiles[e].promise)}),Promise.all(n)},e.prototype.getUser=function(e){return this._userProfiles[e]||(this._userProfiles[e]=new r.CancelablePromise,this._requestQueue.push(e)),this._userProfiles[e].promise},e.prototype.getUsers=function(e){var t=this,n=e.filter(function(e){return!t._userProfiles[e]||t._userProfiles[e].status!==r.PromiseStatus.Resolved});return n.forEach(function(e){t._userProfiles[e]=t._userProfiles[e]||new r.CancelablePromise}),n.length>0?this.client.getUsers(n).then(this.resolve).then(function(){return t.cleanUpUnresolved(e)}).then(function(){return t.getExisting(e)}):Promise.resolve(this.getExisting(e))},e}();t.UserService=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(65),i=function(){function e(e,t){void 0===t&&(t={});var n=this;this.onFlush=e,this.options=t,this._items=[],this._flush=function(){n.onFlush(n._items),delete n._items,n._items=[]},this.flush=r(this._flush,this.options.timeout||500)}return e.prototype.push=function(e){this._items.push(e),this.flush()},e}();t.BatchQueue=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(286),i=n(4),o=n(17),s=n(0),a=n(16),c=function(){function e(e){this.viewports=[],this.requests={},this.callbacks=[],this.options=e||{}}return Object.defineProperty(e.prototype,"all",{get:function(){return this.viewports},enumerable:!0,configurable:!0}),e.prototype.byGroup=function(e,t){var n="string"==typeof e?[e]:e;return(t||this.viewports).filter(function(e){return 1!==n.indexOf(e.options.group)})},e.prototype.byType=function(e,t){var n="string"==typeof e?[e]:e;return(t||this.viewports).filter(function(e){return-1!==n.indexOf(e.options.type)})},e.prototype.byName=function(e,t){return(t||this.viewports).filter(function(t){return t.options.name===e})[0]},e.prototype.byChild=function(e){var t=function(t){return t&&16&t.compareDocumentPosition(e)};return this.viewports.filter(function(e){return t(e.document)||t(e.stash)})[0]},e.prototype.byId=function(e){return this.viewports.filter(function(t){return t.id===e})[0]},e.prototype.resolve=function(e){var t=this;if(function(e){return e&&e.viewport&&e.location.origin===s.swcWindow.location.origin}(e)){var n=e.viewport.id,r=this.byId(n);r&&(r.window=e,r.document=e.document),r.stash?setTimeout(function(){return t.restore(r)}):(r.state.connected=!0,this.requests[n].resolve(r),s.swc.Eventing.triggerEvent(i.ViewportEvents.Ready,n,!0),this.notify(r))}},e.prototype.stash=function(e,t){var n=this.byId(e);n.stash=document.createDocumentFragment(),n.stash.appendChild(t),n.state.connected=!1,this.notify(n)},e.prototype.create=function(e,t){var n=a.guid.generate();return this.viewports.push({id:n,options:e||{},state:t||{}}),this.requests[n]=new o.CancelablePromise,s.swc.Eventing.triggerEvent(i.ViewportEvents.Add,{id:n,options:e,state:t},!0),this.requests[n].promise},e.prototype.update=function(e,t){e.state=t,s.swc.Eventing.triggerEvent(i.ViewportEvents.Update,{id:e.id,state:t},!0),this.notify(e),e.document&&r.setupIFrame(e.document.body)},e.prototype.onChange=function(e){-1===this.callbacks.indexOf(e)&&this.callbacks.push(e)},e.prototype.notify=function(e){this.callbacks.forEach(function(t){return t(e)})},e.prototype.restore=function(e){var t=e.document;t&&(t.replaceChild(e.stash,t.lastChild),e.stash=null,e.state.connected=!0,this.update(e,e.state))},e}();t.ViewportManager=c},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(156),a=n(7),c=n(559),u=n(305),l=n(13),p=function(e){function t(){var t=e.call(this)||this;return t._conversations={},t._enterpriseFavourites={},t.updateConversation=function(e,n){if(a.ConversationType.UNDEFINED!==s.default.getType(e)){var r=t._conversations[e];t.initialiseFavouriteForEnterprise(r),r.update(n)}},l.ServicesManager.ready().then(function(e){e.signInManager.onceSignedIn().then(function(){e.signInManager.isAadSupported()&&e.mePersonManager.getMeProperties().then(function(e){t._enterpriseFavourites=e,Object.keys(e).forEach(function(e){t._conversations[e]&&(t._conversations[e].isFavorite=!0)})})})}),t}return i(t,e),t.prototype.get=function(e,t){return this._conversations.hasOwnProperty(e)||this.createConversationModel(e),t&&(this._conversations[e].definition=t),this._conversations[e]},t.prototype.getIfExist=function(e){return this._conversations.hasOwnProperty(e)?this._conversations[e]:null},t.prototype.getAll=function(){return this._conversations},t.prototype.deleteConversation=function(e){var t=this;return this._conversations[e]?this._conversations[e].deleteConversation().then(function(){t._conversations[e].dispose(),delete t._conversations[e]}):o.swc.services.webApi.deleteConversation(e)},t.prototype.initialiseFavouriteForEnterprise=function(e){this._enterpriseFavourites[e.id]&&(e.isFavorite=!0)},t.prototype.isLeftGroupConversation=function(e){var t=e.threadProperties?parseInt(e.threadProperties.lastleaveat,10):null,n=e.threadProperties?parseInt(e.threadProperties.lastjoinat,10):null;return!!t&&t>n},t.prototype.isRecentConversation=function(e){return!!e.lastMessage&&((!e.properties.conversationblocked||"true"!==e.properties.conversationblocked.toLocaleLowerCase())&&(!this._conversations[e.id]&&(!!e.lastMessage.originalarrivaltime&&!this.isLeftGroupConversation(e))))},t.prototype.createConversationModel=function(e,t){var n=this,r=this.getIfExist(e),i=!r;return i&&(r=new c.default(e,{})),this._conversations[e]=r,t?this.updateConversation(e,t):i&&o.swc.services.webApi.fetchConversation(e).then(function(t){n.updateConversation(e,t)}),i&&this.notify(this._conversations[e]),r},t.prototype.loadConversations=function(e,t){var n=this;return void 0===t&&(t=100),l.ServicesManager.webApi.fetchRecentConversations(e,t).then(function(e){var t={hasMoreConversations:!1,conversations:[]};return e.conversations.forEach(function(e){if(n.isRecentConversation(e)){var r=n.createConversationModel(e.id,e);t.conversations.push(r)}}),t.hasMoreConversations=e.hasMoreConversations,t})},t.prototype.loadAllConversations=function(){var e=this;if(this.conversationSyncPromise)return this.conversationSyncPromise;var t=function(n,r){return l.ServicesManager.webApi.fetchRecentConversations(0,100).then(function(i){return i.conversations.forEach(function(t){e.isRecentConversation(t)&&e.createConversationModel(t.id,t)}),i.hasMoreConversations?new Promise(function(e){setTimeout(function(){t(n,r).then(function(){return e()})},200)}):Promise.resolve()})};return this.conversationSyncPromise=t(0,100),this.conversationSyncPromise},t.prototype.prefetchRecents=function(e,t){var n=this;return void 0===e&&(e=0),void 0===t&&(t=100),l.ServicesManager.webApi.prefetchRecents(0,100).then(function(e){return e&&e.conversations&&e.conversations.forEach(function(e){n.isRecentConversation(e)?n.createConversationModel(e.id,e):n._conversations[e.id]&&n.updateConversation(e.id,e)}),e})},t.prototype.subscribeToNewConversations=function(e){return this.subscribe(e)},t}(u.SubscribeableStore);t.default=p},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(65),s=n(306),a=n(4),c=n(5),u=n(2),l=n(10),p=n(100),d=n(11),f=n(34),h=n(0),g=n(41),m=n(156),v=n(9),y=n(245),_=n(31),b=n(560),S=n(561),T=n(60),w=n(7),P=n(13),C=n(562),E=n(32),O=n(304),k=n(265),M=function(e){function t(t,n){var r=e.call(this)||this;r._definition=n,r.backend=d.MessagingBackend.UNDETERMINED,r._isSealed=!1,r.messagesReceived=0,r.messagesSent=0,r.sdkMode=f.SDKMode.UNDEFINED,r._contextAad="",r._isChatEnabled=!0,r._topic="",r._alertsOff=!1,r._isFavorite=!1,r.handleIsReadChange=function(e){r.debouncedPublishIsUnread();var t=!1,n=r.lastMessage||r.messages.length>0&&r.messages[r.messages.length-1];n&&(t=n.originalTimestamp.getTime()<Date.now()-2592e6);r.alertsOff||t||e?P.ServicesManager.unreadCounterStore.markAsRead(r.id):P.ServicesManager.unreadCounterStore.markAsUnread(r.id)},r.debouncedPublishIsUnread=o(function(){return r.publish("isUnread",r.isUnread)}),r.debouncedPublishIsRead=o(function(){return r.publish("isRead",r.isRead)}),r.sendLiveState=function(){return r._messagingService.sendLiveState()},r.download=function(e){return r.externalDownload&&h.swc.Eventing.triggerEvent(a.ApiEvents.conversationProxy.resDownload,{refId:r.refId,url:e})},r.setupProxy=function(){var e=function(e){return e===r.id};r._isOneOnOne||h.swc.Eventing.registerEvent(a.ApiEvents.conversationProxy.connected,function(t){e(t.id)&&r.heartBeat&&(t.connected?r.heartBeat.connect():r.heartBeat.disconnect())}),h.swc.Eventing.registerEvent(a.ApiEvents.conversationProxy.regMessageReceived,function(t){e(t.id)&&(r.refId=t.refId,r.messageReceivedProxied=!0)}),h.swc.Eventing.registerEvent(a.ApiEvents.conversationProxy.regDownload,function(t){e(t.id)&&(r.refId=t.refId,r.externalDownload=!0)})},r._id=t;var i,s=m.default.getType(t);return r.isAgent=s===w.ConversationType.AGENT,r.isPerson=s===w.ConversationType.PERSON,r.isGroup=s===w.ConversationType.GROUP,r.sdkMode=_.default.getSdkModeFromId(r._id),r.isSfB=c.default.get.isTeams()&&S.isSfB(t),r._messages=p.ObservableCollection.create(),r._allMessages=p.ObservableCollection.create(),r._participants=p.ObservableCollection.create(),r._messagingService=new C.default(r),r._isControlOpen=!1,r._consumptionHorizon=new O.ConsumptionHorizon,r._unreadMessagesCount=0,r.subscribe("isRead",r.handleIsReadChange),r.messages.subscribe(function(e){var t=r.lastMessage;t&&(r.publish("lastMessage",t),r.lastReceivedMessage&&r.publish("lastReceivedMessage",r.lastReceivedMessage));r.publish("lastReceivedMessage",r.lastReceivedMessage),r.isControlOpen||r.debouncedPublishIsRead()}),r.subscribe("lastReceivedMessage",function(e){e&&e.direction===w.Direction.Incoming&&i!==e&&(P.ServicesManager.notificationsManager.registerUnreadMessage(r,e),i=e)}),r._consumptionHorizon.subscribe("value",function(e){r.debouncedPublishIsRead()}),P.ServicesManager.mePerson&&(r.selfParticipant=new k.default(P.ServicesManager.mePerson)),c.default.get.isTeams()?r._isOneOnOne=-1!==t.indexOf("@unq.gbl.spaces"):r._isOneOnOne=r.getConversationType()!==w.ConversationType.GROUP,r.isBRB=r._isBRBConversation(),r._isOneOnOne||(r.heartBeat=new b.HeartBeat(r.sendLiveState)),r.setupProxy(),r.members=[],r}return i(t,e),Object.defineProperty(t.prototype,"isSealed",{get:function(){return this._isSealed},set:function(e){this._isSealed!==e&&(this._isSealed=!!e,this.publish("isSealed",this._isSealed))},enumerable:!0,configurable:!0}),t.prototype._isBRBConversation=function(){if(c.default.get.isTeams()&&this.isOneOnOne){var e=u.Configuration.BRB_BOT_MRI_TEAMS.substring(3);return this.id.indexOf(e)>-1}return this.id===u.Configuration.BRB_BOT_MRI},Object.defineProperty(t.prototype,"isRead",{get:function(){if(this.isPstn)return!0;if(!this.isPerson&&!this.isGroup&&!this.isAgent)return!0;if(!this.properties)return!0;if(!this.properties.consumptionhorizon&&"AcceptPendingRecipient"===this.properties.conversationstatus)return!0;var e=this.lastReceivedMessage||this.lastMessage,t=this.selfParticipant&&this.selfParticipant.person||P.ServicesManager.mePerson;return!!(!e||!m.UNREAD_TYPES[e.rawMessageType]||e.sender&&t&&T.normalizePersonId(e.sender.mri)===T.normalizePersonId(t.mri)||!e.content||""===e.content||e.id===this.consumptionHorizon.lastReadMessageId||e.clientMessageId===this.consumptionHorizon.lastReadMessageId||e.skypeEditedId===this.consumptionHorizon.lastReadMessageId||e.timestamp.getTime()<=this.consumptionHorizon.lastReadMessageTimestamp||"CallEndMsg"===e.customType)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isUnread",{get:function(){return!this.isRead},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFavorite",{get:function(){return this._isFavorite},set:function(e){this._isFavorite!==e&&(this._isFavorite=e,this.publish("isFavorite",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sortedMessages",{get:function(){return this.messages.sort(function(e,t){return e.timestamp.getTime()-t.timestamp.getTime()})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastReceivedMessage",{get:function(){var e=this.messages.filter(function(e){return e.direction===w.Direction.Incoming});return y.getLastItemFromArray(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastMessage",{get:function(){return y.getLastItemFromArray(this.sortedMessages)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allMessages",{get:function(){return this._allMessages},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"avatar",{get:function(){return this._avatar},set:function(e){((e=g.default.resolveConversationAvatar(this.isGroup,e))||e!==this._avatar)&&(this._avatar=e,this.publish("avatar",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"consumptionHorizon",{get:function(){return this._consumptionHorizon},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contextAad",{get:function(){return this._contextAad},set:function(e){e=(e=E.default.dompurify.sanitize(e,{ALLOWED_TAGS:[],ALLOWED_ATTR:[]})).replace(/["()\'\/+*`~!@#$%^\[\]:=]/g,""),this._contextAad=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"definition",{get:function(){return this._definition},set:function(e){this._definition=e,this.publish("definition",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(e){e!==this._id&&(this._id=e,this.publish("id",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isActive",{get:function(){return this._isActive},set:function(e){var t=e&&e!==this._isActive;this._isActive=e,t&&this.markAsRead()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBlocked",{get:function(){return this._isBlocked},set:function(e){e!==this._isBlocked&&(this._isBlocked=e,this.publish("isBlocked",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isChatEnabled",{get:function(){return this._isChatEnabled},set:function(e){e!==this._isChatEnabled&&(this._isChatEnabled=e,this.publish("isChatEnabled",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isControlOpen",{get:function(){return this._isControlOpen},set:function(e){this._isControlOpen=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return this._isLoaded},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isNew",{get:function(){return this._isNew},set:function(e){e!==this._isNew&&(this._isNew=e,this.publish("isNew",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isOneOnOne",{get:function(){return this._isOneOnOne},set:function(e){this._isOneOnOne!==e&&(this._isOneOnOne="true"===e,this.publish("isOneOnOne",this._isOneOnOne))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isUnderQuarantine",{get:function(){return this._isUnderQuarantine},set:function(e){e!==this._isUnderQuarantine&&(this._isUnderQuarantine=e,this.publish("isUnderQuarantine",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"members",{get:function(){return this._members},set:function(e){this._members=e,this.publish("members",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"messages",{get:function(){return this._messages},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"participants",{get:function(){return this._participants},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"theOtherParticipant",{get:function(){var e=this,t=this.participants.filter(function(t){return t.person.id!==e.selfParticipant.person.id});return 1===t.length?t.pop():void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selfParticipant",{get:function(){return this._selfParticipant},set:function(e){e!==this._selfParticipant&&(this._selfParticipant=e,this.publish("selfParticipant",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topic",{get:function(){return this._topic},set:function(e){e!==this._topic&&(this._topic=e,this.publish("topic",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"unreadMessagesCount",{get:function(){return this._unreadMessagesCount},set:function(e){this._unreadMessagesCount!==e&&(this._unreadMessagesCount=e,this.publish("unreadMessagesCount",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alertsOff",{get:function(){return this._alertsOff},set:function(e){e!==this._alertsOff&&(this._alertsOff=e,this.publish("alertsOff",e))},enumerable:!0,configurable:!0}),t.prototype.addBotToThread=function(e){this._messagingService.addBotToThread(e)},t.prototype.addParticipant=function(e){this._messagingService.addParticipantToThread(e)},t.prototype.deleteConversation=function(){return this._messagingService.deleteConversation(this.id)},t.prototype.deleteMessage=function(e){var t=this,n=this.lastMessage;return this._messagingService.deleteMessage(e).then(function(){e.content="",e.isDeleted=!0,e.isEdited=!0,e.id===n.id&&t.publish("lastMessage",n)})},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._contextAad="",this._messages&&(this._messages.forEach(function(e){e.dispose()}),this._messages.dispose(),this._messages.spliceObservable(0,this._messages.length)),this._participants.dispose(),this._isDisposed=!0,this._messagingService.dispose()},t.prototype.editMessage=function(e,t){return this._messagingService.editMessage(e,t)},t.prototype.getBackend=function(){return this.backend=m.default.getBackend(this.id,this.backend),this.backend},t.prototype.getConversationType=function(){return m.default.getType(this._id)},t.prototype.getReceviedMessagesCount=function(){return 0},t.prototype.getSentMessagesCount=function(){return 0},t.prototype.isSkypeBackend=function(){return this.getBackend()===d.MessagingBackend.SKYPE},t.prototype.isWithMe=function(){return h.swc.services.signInManager.currentUserName&&this.getConversationType()===w.ConversationType.PERSON&&_.default.isEqual(this.id,h.swc.services.signInManager.currentUserName)},t.prototype.loadMoreMessages=function(){return this._messagingService.loadMoreMessages(this)},t.prototype.markAsRead=function(){this._messagingService.markAsRead()},t.prototype.removeMessageProperty=function(e,t,n,r){return this._messagingService.removeMessageProperty(e,t,n,r)},t.prototype.removeParticipant=function(e){return this._messagingService.removeParticipantFromThread(e)},t.prototype.sendDataToBot=function(e){if(this.getConversationType()===w.ConversationType.GROUP){var t=this.participants.filter(function(e){return e.person.isAgent});if(t.length>0)return this._messagingService.sendDataToBot(_.default.toFullIdentifier(t[0].person.id),e)}return this.isAgent?this._messagingService.sendDataToBot(this.id,e):Promise.resolve()},t.prototype.sendFile=function(e){return h.swc.Eventing.triggerEvent(a.ApiEvents.OnMessageSent,{type:s.default.File}),this._messagingService.sendFile(e)},t.prototype.sendFilesAsProperties=function(e){return h.swc.Eventing.triggerEvent(a.ApiEvents.OnMessageSent,{type:s.default.Card}),this._messagingService.sendFilesAsProperties(e)},t.prototype.sendMessage=function(e,t,n){this._messagingService.sendMessage(e,t,n),h.swc.Eventing.triggerEvent(a.ApiEvents.OnMessageSent,{type:s.default.Text})},t.prototype.sendSwift=function(e){return h.swc.Eventing.triggerEvent(a.ApiEvents.OnMessageSent,{type:s.default.Card}),this._messagingService.sendSwift(e)},t.prototype.setIsTyping=function(e){this._messagingService.setIsTyping(e)},t.prototype.setMessageProperty=function(e,t,n,r){return this._messagingService.setMessageProperty(e,t,n,r)},t.prototype.setParticipantTyping=function(e,t){var n=this._participants.filter(function(t){return t.person.id===e});n.length&&(n[0].isTyping=t)},t.prototype.setTopic=function(e){this._messagingService.setConversationTopic(e)},t.prototype.start=function(){var e=this;return this._isDisposed=!1,this._messagingService.startConversation().then(function(){e._isLoaded=!0,e.publish("isLoaded",!0)},function(t){v.default.throwError(100001,"Unable to start conversation",t,e.id)})},t.prototype.update=function(e){var t=this;if(this._id===e.id){if(this.isTeamsOneOnOne=this.isTeamsOneOnOne||e.isOneOnOne,this.properties=e.properties||this.properties,this.threadProperties=e.threadProperties||this.threadProperties,this.isBlocked=I(e.properties),this.updateConsumptionHorizon(this.properties.consumptionhorizon),this.alertsOff=A(e.properties),this.isFavorite=e.properties&&"true"===e.properties.favorite,e.members){this.members=e.members,this._participants.spliceObservable(0,this._participants.length);var n=P.ServicesManager.mePerson;this.members.forEach(function(e){var r=P.ServicesManager.persons.getPerson(e.id);!r.displayName&&e.name&&(r.displayName=e.name),t._participants.pushObservable(new k.default(r,e)),n&&n.mri===e.id&&(t.selfParticipant=new k.default(n,e))})}if(e.threadProperties&&e.threadProperties.picture&&(this.avatar=e.threadProperties.picture),0===this.members.length&&e.threadProperties&&e.threadProperties.members)try{var r=JSON.parse(e.threadProperties.members);r.length>0&&(this._participants.spliceObservable(0,this._participants.length),r.forEach(function(e){var n=P.ServicesManager.persons.getPerson(e);n&&t._participants.pushObservable(new k.default(n))}))}catch(e){}var i=this.topic&&-1!==this.topic.indexOf("8:orgid");if(!this.topic||i){var o=P.ServicesManager.signInManager.isAadSupported(),s=e.threadProperties&&e.threadProperties.topic||e.properties&&e.properties.topic||e.lastMessage&&e.lastMessage.threadtopic||this.isOneOnOne&&!o&&this.id||null;if(!o&&this.isOneOnOne){var a=P.ServicesManager.persons.getPerson(this.id);a.displayName?s=a.displayName:a.subscribe("displayName",function(e){return t.topic=e})}else if(this.isPstn)s=this.id.replace("4:","");else{var c=this._messagingService.parseConversationTopic(s);1!==c.trim().length&&""!==c.trim().replace(",","")&&(s=c)}this.topic=s||""}e.lastMessage&&e.lastMessage.id&&this._messagingService.processNewMessage(this,e.lastMessage,void 0,void 0,!0)}},t.prototype.startGuestConversation=function(){return this.isAgent?this._messagingService.startGuestConversation():Promise.resolve()},t.prototype.updateConsumptionHorizon=function(e){e&&e!==this._consumptionHorizon.value&&this._consumptionHorizon.set(e,!0)},t.prototype.messageReceived=function(e,t){var n={type:e,messageType:t};h.swc.Eventing.triggerEvent(a.ApiEvents.OnMessageReceived,n),this.messageReceivedProxied&&h.swc.Eventing.triggerEvent(a.ApiEvents.conversationProxy.messageReceived,{refId:this.refId,message:n})},Object.defineProperty(t.prototype,"refId",{get:function(){return this._refId},set:function(e){this._refId=this._refId||e},enumerable:!0,configurable:!0}),t}(l.default);t.default=M;var I=function(e){return!!e.conversationblocked&&"true"===e.conversationblocked.toLocaleLowerCase()},A=function(e){return!!e.alerts&&/false/i.test(e.alerts)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.callback=e}return e.prototype.connect=function(){this.timer||(this.callback(),this.timer=setInterval(this.callback,3e4))},e.prototype.disconnect=function(){clearInterval(this.timer)},e}();t.HeartBeat=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(56),i="sip:",o="8:orgid:sfb:",s="@sfb.unq.gbl.spaces",a="19:sfb:";t.isSfB=function(e){return!!e&&(t=e,!!t&&r.startsWith(t,i)||function(e){return!!e&&r.startsWith(e,o)}(e)||function(e){return!!e&&(function(e){return r.startsWith(e,a)&&!r.endsWith(e,s)}(e)||function(e){return r.endsWith(e,s)}(e))}(e));var t}},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(306),o=n(4),s=n(5),a=n(2),c=n(110),u=n(68),l=n(563),p=n(17),d=n(100),f=n(93),h=n(582),g=n(29),m=n(157),v=n(11),y=n(111),_=n(32),b=n(38),S=n(0),T=n(259),w=n(156),P=n(150),C=n(9),E=n(92),O=n(90),k=n(16),M=n(31),I=n(583),A=n(14),R=n(62),N=n(85),U=n(22),x=n(307),D=n(64),L=n(117),j=n(7),F=n(265),H=n(88),B=/(^|\s)(https?:\/\/[^\s]*\.(?:png\?\d+|png|jpg\?\d+|jpg|jpeg\?\d+|jpeg|gif))($|<|\s)/gim,G={ALLOWED_TAGS:["img","a"],ALLOWED_ATTR:["target","src","alt","class","href"]},z=/<a href="([^"]+)"( target="([^"]+)")?>([^<]+)<\/a>/g,V=730,W=5e3,q=3e3,K=!0,J=function(){function e(e){var t=this;this._encoder=new c.Encoder(null,null),this._isBackfillEnabled=!1,this._handleMessageResource=function(e,n){if(t._messageTypesHandler.isTypingIndicator(n)&&n.from){var r=N.default.normalizePersonId(A.MessageUtils.getSenderIdFromUrl(n.from));e.setParticipantTyping(r,"Control/Typing"===n.messagetype)}else{var o=n.contentOriginal&&0===n.contentOriginal.trim().length;if(n.content&&0!==n.content.trim().length||!o||n.skypeeditedid){t._setHistoryParamToCache(e.id);var s=t.processNewMessage(e,n,null,!1);if(s&&s.direction===j.Direction.Incoming){var a=A.MessageUtils.getSenderIdFromUrl(n.from);(r=N.default.normalizePersonId(a))&&e.setParticipantTyping(r,!1),e.messagesReceived++,t._updateUnreadMessageCounter(e,s),s.isDeleted||s.isEdited||"SystemMessage"===s.type||S.swc.Telemetry.sendEvent.messageReceived(H.createConversationEvent(e),s.type,e.sdkMode,e.topic,e.isControlOpen),e.messageReceived(i.default.getReceivedMessageType(s.type),s.type)}}}},this._updateUnreadMessageCounter=function(e,n){if(e.isControlOpen)t.updateConsumptionHorizonToLastMessage(),e.unreadMessagesCount=0;else if(n.isDeleted){var r=n.originalTimestamp.getTime();!(e.consumptionHorizon.lastReadMessageTimestamp>=r)&&n.isEdited&&e.unreadMessagesCount>0&&e.unreadMessagesCount--}else n.isEdited||e.unreadMessagesCount++},this._isFetched=!1,this._isTeamsBackend=s.default.get.backend===v.MessagingBackend.TEAMS,this._isUseEditMessageClassic=function(){return K&&s.default.get.backend!==v.MessagingBackend.TEAMS},this._messageToBotWasSent=!1,this._pendingContactRequest=!1,this._quarantineCountDown=-1,this.checkConversationStatus=function(e){return t.isConversationNotFoundError(e)?Promise.resolve():S.swc.services.webApi.fetchConversation(t.conversation.id).then(function(e){if(!t.isConversationNotFoundError(e)){if(t.isConversationBlocked(e))return t.conversation.isBlocked=!0,void(t.conversation.isChatEnabled=!1);switch(e.properties.conversationstatus){case"Accepted":return t.conversation.isUnderQuarantine=!1,t.conversation.isChatEnabled=!0,void(t._quarantineCountDown=-1);case"AcceptPendingSender":break;case"AcceptPendingRecipient":return t._pendingContactRequest=!0,t.conversation.isUnderQuarantine=!1,void(t.conversation.isChatEnabled=!0);default:return}t.checkIfBuddy()}},function(e){t.isConversationNotFoundError(e)||C.default.throwError(105002,"Unable to check IConversation Status",e)})},this.checkIfBuddy=function(){t._checkContactTimeout||(t._checkContactTimeout=L.build(t.checkConversationStatus.bind(t),W)),t._checkContactTimeout.start()},this.fetchUserMessages=function(e){return new Promise(function(n,r){S.swc.services.webApi.fetchMessages(t.conversation.id).then(function(r){t._isBackfillEnabled=!0,t._messagesHandler(t.conversation,e,r),t._isFetched=!0,n(r)},function(e){t.onConversationLoadingFinished(),r(e)})})},this.isConversationBlocked=function(e){return!!e.properties.conversationblocked&&"true"===e.properties.conversationblocked.toLocaleLowerCase()},this.isConversationNotFoundError=function(e){return!(!e||e.errorCode!==V)&&(t.conversation.isChatEnabled=!0,t._quarantineCountDown=0,!0)},this.isOneToOneOrBot=function(){return t.conversation.isPerson||t.conversation.isAgent},this.startConversationWithBot=function(e){void 0===e&&(e=!0);var n=t.conversation.id,r=t.conversation.id.slice(3),i=t;if(0===t.conversation.participants.length){var o=new F.default(S.swc.services.persons.getPerson(t.conversation.id,!0));t.conversation.participants.pushObservable(o)}return t.executeWhenSignedIn(function(){S.swc.services.contactsManager.isPersonContact(n).then(function(n){n?(i.subscribeToConversation(),t.conversation.isChatEnabled=!0,S.swc.services.signInManager.userIdentityType===g.IdentityType.GUEST&&(t.conversation.isNew=!0,t.conversation.startGuestConversation()),t.conversation.definition.Payload&&t.conversation.sendDataToBot({payload:t.conversation.definition.Payload})):(t.conversation.isChatEnabled=!1,t.conversation.isNew=!0,e&&S.swc.services.agentsManager.addAgent(r),t._checkContactTimeout=L.build(function(){i.startConversationWithBot(!1)},q),t._checkContactTimeout.start()),t.fetchUserMessages(Date.now())},function(e){C.default.throwError(105001,"Unable to start conversation with bot",e,n)})})},this.startConversationWithPerson=function(){t.conversation.id.slice(2);if(0===t.conversation.participants.length){var e=new F.default(S.swc.services.persons.getPerson(t.conversation.id,!0));t.conversation.participants.pushObservable(e)}return t.executeWhenSignedIn(function(){return S.swc.services.contactsManager.isPersonContact(t.conversation.id).then(function(e){return e?(t.conversation.isNew=!1,S.swc.services.webApi.subscribeContactPresence(t.conversation.id),t.subscribeToConversation()):(t.conversation.isNew=!0,t.subscribeToConversation().then(t.checkConversationStatus.bind(t)))}).then(function(e){return t.fetchUserMessages(Date.now()),e})})},this.presubscribeConversation=function(e){if(void 0===e&&(e=!1),t._subscriptionPromise)return t._subscriptionPromise;var n=t.currentUserHasHistory(t._conversationId);return e=e&&S.swc.services.signInManager.userIdentityType===g.IdentityType.SKYPE||n,t._subscriptionPromise=S.swc.services.webApi.subscribeConversation(t._conversationId,t._eventHandler,function(){return t._backfilllingHandler(!0)}),t._subscriptionPromise},this.subscribeToConversation=function(){var e=t,n=t.currentUserHasHistory(e.conversation.id),r=S.swc.services.signInManager.userIdentityType===g.IdentityType.SKYPE||n;S.swc.Eventing.triggerEvent(o.ApiEvents.OnConversationReady,{id:t.conversation.id}),S.swc.Telemetry.sendEvent.conversationLoaded(H.createConversationEvent(t.conversation));var i=function(n){if(t.isConversationNotFoundError(n))return n;n&&n.properties&&n.properties.consumptionhorizon&&t.conversation.updateConsumptionHorizon(n.properties.consumptionhorizon),n&&n.threadProperties&&t.updateConversationProperties(n.threadProperties,!0);var r=t.isConversationBlocked(n);return t.conversation.isBlocked=r,t.conversation.isChatEnabled=!r,e.onConversationLoadingFinished(),n};return t.presubscribeConversation().then(function(){return r?S.swc.services.webApi.fetchConversation(t.conversation.id).then(i):Promise.reject("Do not fetch Properties (this is not and error)")}).catch(function(n){t._messageToBotWasSent?t.fetchUserMessages(Date.now()):e.onConversationLoadingFinished()})},this.sendSwift=function(e){return t.sendMessageToService(m.MessageType.SWIFT,t.createMessageData({content:e.title,properties:e.value||e,messagetype:D.MessagePayloadType.RichText,processedcontent:e.title}))},this.sendLiveState=function(){return t.sendMessageToService(m.MessageType.LIVE_STATE,t.createMessageData({content:"",messagetype:D.MessagePayloadType.ControlLiveState}))},this.setIsTyping=function(e){return t.sendMessageToService(m.MessageType.TYPING,t.createMessageData({content:"",messagetype:e?D.MessagePayloadType.ControlTyping:D.MessagePayloadType.ControlClearTyping}))},this._getReportProblemContext=function(){var e=k.guid.generate().slice(0,5),t=s.default.get.isTeams()?"enterprise":"consumer",n="swc,feedback,"+a.Configuration.getPlatformName()+","+t;return s.default.get.isTeams()?"#bug | Platform: "+a.Configuration.getPlatformId()+" | App Version: "+a.Configuration.getVersion()+" | OS Version: "+U.default.getOsName()+" "+U.default.getOsName()+" | Device: "+U.default.getDeviceType()+" | Language: "+window.navigator.language+") | Tags: "+n+' | Network: WIFI<context feedbackId ="'+e+'"></context>':'<context PlatformID="'+a.Configuration.getPlatformId()+'" AppVersion="'+a.Configuration.getVersion()+'" OS="'+U.default.getOsName()+" "+U.default.getOsName()+'" Device="'+U.default.getDeviceType()+'" Language="'+window.navigator.language+'" BrbEnabled="true" Tags="'+n+'" feedbackId="'+e+'"></context>'},this._eventHandler=function(e,n){switch(e){case"NewMessage":case"MessageUpdate":t._handleMessageResource(t.conversation,n);break;case"ConversationUpdate":t._isFetched||t.fetchUserMessages(Date.now()),t.conversation.update(n)}},I.Masks.init(),e||C.default.throwError(10501,"conversation is missing"),this._conversationId=e.id,this._messageTypesHandler=new l.default,this._firstMessagePopulationPromise=new p.CancelablePromise,S.swc.services.mePersonManager.fetch(),this._backfilllingHandler=this.backFillLostMessges.bind(this),R.get().subscribe("isOnline",this._backfilllingHandler),this.presubscribeConversation()}return Object.defineProperty(e.prototype,"mePerson",{get:function(){return S.swc.services.mePersonManager.mePerson},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"conversation",{get:function(){return S.swc.services.conversations.get(this._conversationId)},enumerable:!0,configurable:!0}),e.prototype.startGroupConversation=function(){var e=this,t=function(){return S.swc.services.webApi.fetchThread(e.conversation.id).then(function(t){if(t.properties){var n=t.properties;t.members&&(n.members=t.members),e.updateConversationProperties(n);var r=n.joiningenabled,i=n.capabilities,s=!i||0===i.length;if(e._isTeamsBackend){var a=n.fixedRoster&&n.uniquerosterthread;e.conversation.isOneOnOne=a}else e.conversation.isOneOnOne=-1===t.id.indexOf("19:");var c=e.isMember(S.swc.services.signInManager.currentUserName,t);!s||r||e._isTeamsBackend&&c?e.subscribeToConversation():C.default.throwError(10506,"Joining to a group conversation is disabled",{},e.conversation.id);var u=e.conversation.participants;u.spliceObservable(0,u.length),t.members.forEach(function(e){var t=S.swc.services.persons.getPerson(e.id,!0),n=new F.default(t,e);u.pushObservable(n),t.isAgent&&S.swc.Eventing.triggerEvent(o.ApiEvents.BotAddedToThread,t.id)}),S.swc.services.mePersonManager.fetch().then(function(t){u.forEach(function(n){t.id===n.person.id&&(e.conversation.selfParticipant=n)})})}else e.subscribeToConversation();return e.conversation.members=t.members,t},function(t){C.default.throwError(10509,"Unable to fetch a thread",t,e.conversation.id)})},n=function(t){return S.swc.services.webApi.addParticipant(e.conversation.id,t).then(null,function(t){C.default.throwError(10507,"Unable to join conversation",t,e.conversation.id)})};return this.executeWhenSignedIn(function(){var r="8:"+S.swc.services.signInManager.currentUserName;new Promise(function(t){0===e.conversation.id.indexOf("19:guest")&&-1===S.swc.services.signInManager.currentUserName.indexOf("guest")?n(r).then(function(){return t()}):t()}).then(function(){e.fetchUserMessages(Date.now()),t().then(function(i){e.isMember(S.swc.services.signInManager.currentUserName,i)||n(r).then(t),e.conversation.topic||(e.conversation.topic=e.parseConversationTopic(i.properties.topic||null))})})})},e.prototype.isMember=function(e,t){var n="8:"+e;return t&&t.members&&t.members.some(function(e){return e.id===n})},e.prototype.addBotToThread=function(e){S.swc.services.webApi.addParticipant(this.conversation.id,"28:"+e).then(function(e){},function(t){C.default.throwError(10510,"Unable to add bot to conversation",t,e)})},e.prototype.addParticipantToThread=function(e){S.swc.services.webApi.addParticipant(this.conversation.id,e).then(function(e){},function(t){C.default.throwError(10511,"Unable to add participant to conversation",t,e)})},e.prototype.createConversation=function(e){e&&S.swc.services.webApi.createThread([])},e.prototype.deleteConversation=function(e){return S.swc.services.webApi.deleteConversation(e)},e.prototype.deleteMessage=function(e){return this._isUseEditMessageClassic()?this.editMessageClassicWay(e):S.swc.services.webApi.deleteMessage(this.conversation.id,e.id)},e.prototype.dispose=function(){this._messageToBotWasSent=!1,this.stopListeningConversation(),this._checkContactTimeout&&(this._checkContactTimeout.reset(),this._checkContactTimeout=null),this._firstMessagePopulationPromise.status===p.PromiseStatus.Pending&&(this._firstMessagePopulationPromise.promise.then(null,function(){}),this._firstMessagePopulationPromise.cancel()),this._firstMessagePopulationPromise=new p.CancelablePromise,R.get().unsubscribe("isOnline",this._backfilllingHandler)},e.prototype.mask=function(e,t){var n=I.Masks.instance;return n&&n.shouldMask(e)&&(e=n.process(e),t&&(t.tags=t.tags||"",t.tags=P.default.add(t.tags,"masked",!0))),e},e.prototype.editMessage=function(e,t){t=this.mask(t);var n=this._encoder.encode(t,this.conversation,this.mePerson),r=y.default.parse(n);return this._isUseEditMessageClassic()?this.editMessageClassicWay(e,r):S.swc.services.webApi.editMessage(this.conversation.id,e.id,e.rawMessageType,r)},e.prototype.getUnreadMessagesCount=function(){return this.conversation.unreadMessagesCount},e.prototype.loadMoreMessages=function(e){return this._backwardLink?S.swc.services.webApi.fetchMessagesByLink(this._backwardLink).then(this._messagesHandler.bind(this,e,Date.now())):Promise.resolve()},e.prototype.markAsRead=function(){(S.swc.services.signInManager.userIdentityType===g.IdentityType.SKYPE||this.currentUserHasHistory(this.conversation.id))&&this.updateConsumptionHorizonToLastMessage()},e.prototype.removeMessageProperty=function(e,t,n,r){return S.swc.services.webApi.removeMessageProperty(e,t,n,r)},e.prototype.removeParticipantFromThread=function(e){return S.swc.services.webApi.removeParticipant(this.conversation.id,e).then(function(e){},function(t){C.default.throwError(10512,"Unable to remove participant from conversation",t,e)})},e.prototype.sendDataToBot=function(e,t){var n={name:"SWC",conversation:{id:this.conversation.isGroup?this.conversation.id:S.swc.services.signInManager.currentUserName},value:t};return this._messageToBotWasSent=!0,S.swc.services.webApi.sendDataToBot(e,n)},e.prototype.sendFile=function(e){var t=this,n=e.file,r=e.uploadPromise,i=e.registerPromise,o=e.clientMessageId,s=E.isDocumentTypeImage(n.type)?m.MessageType.IMAGE:m.MessageType.FILE,a=this.generateFileMessagePayload(n,o),c=this.pushMessageToConversation(s,a);return i.then(function(e){var i=e.documentId,a=t.generateFileMessagePayload(n,o,i);return t.sendMessageToService(s,a,null,r,c)}).catch(function(){c.status=j.DeliveryStatus.Failed})},e.prototype.generateFileMessagePayload=function(e,t,n){void 0===n&&(n=t);var r=E.isDocumentTypeImage(e.type),i={content:r?E.createImageMessage(e,n):E.createFileMessage(e,n),clientmessageid:t,messagetype:r?D.MessagePayloadType.RichTextUriObject:D.MessagePayloadType.RichTextMedia_GenericFile,properties:JSON.stringify(this.conversation.currentMessageProperties||{})};return this.createMessageData(i)},e.prototype.sendFilesAsProperties=function(e){var t=this,n=e.clientMessageId,i=this.createMessageData({content:"",messagetype:D.MessagePayloadType.RichTextHtml,clientmessageid:n,properties:JSON.stringify(r({},this.conversation.currentMessageProperties||{},{files:e.files}))}),o=this.pushMessageToConversation(m.MessageType.TEXT,i);return e.registerPromise.then(function(i){var s=t.createMessageData({content:"",messagetype:D.MessagePayloadType.RichTextHtml,clientmessageid:n,properties:JSON.stringify(r({},t.conversation.currentMessageProperties||{},{files:JSON.stringify(i.files)}))});return t.sendMessageToService(m.MessageType.TEXT,s,null,e.uploadPromise,o)}).catch(function(){o.status=j.DeliveryStatus.Failed})},e.prototype.sendMessage=function(e,t,n){var i,o={messageLength:e.length,origin:t};if(n=r({},this.conversation.currentMessageProperties,n)||{},this.conversation.isBRB)i=e+this._getReportProblemContext();else{var s=this.mask(e,n);i=this._encoder.encode(s,this.conversation,this.mePerson)}var a=y.default.parse(i).replace(/<br\s*\/?>/g,"<br/>").replace(/<hr\s*\/?>/g,"<hr/>"),c=this.createMessageData({content:a,messagetype:D.MessagePayloadType.RichText,"Has-Mentions":this.messageContainsMention(i)});return Object.keys(n).length&&(c.properties=n),this.sendMessageToService(m.MessageType.TEXT,c,o)},e.prototype.setConversationTopic=function(e){S.swc.services.webApi.setConversationTopic(this.conversation.id,e)},e.prototype.setMessageProperty=function(e,t,n,r){return S.swc.services.webApi.setMessageProperty(e,t,n,r)},e.prototype.startConversation=function(){return this.isOneToOneOrBot()?this.conversation.isPerson?this.startConversationWithPerson():this.startConversationWithBot():this.startGroupConversation()},e.prototype.startGuestConversation=function(){var e={name:"startConversation",conversation:{id:M.default.toFullIdentifier(S.swc.services.signInManager.currentUserName)},value:{}};return S.swc.services.webApi.sendDataToBot(this.conversation.id,e)},e.prototype.stopListeningConversation=function(){S.swc.services.webApi.unsubscribeConversation(this.conversation.id)},e.prototype._messagesHandler=function(e,t,n){var r,i=this;if(e.messages)if(n){this._backwardLink=n._metadata.backwardLink;var o=d.ObservableCollection.create();n.messages.forEach(function(t){i.processNewMessage(e,t,o,!0)}),o.sortObservable(function(e,t){return e.timestamp.getTime()>t.timestamp.getTime()?1:-1}),S.swc.Telemetry.sendEvent.messagesFetched(H.createConversationEvent(this.conversation),Date.now()-t,200,n.messages.length),(r=e.messages).pushObservable.apply(r,o),this.onConversationLoadingFinished()}else this.onConversationLoadingFinished();else this.onConversationLoadingFinished()},e.prototype._setHistoryParamToCache=function(e){if(S.swc.services.signInManager.userIdentityType!==g.IdentityType.SKYPE&&!this.currentUserHasHistory(e)){var t=S.swc.services.sessionStorage.getItem(b.SKYPE_HAS_HISTORY_KEY)||"";t=""===t?e:t+";"+e,S.swc.services.sessionStorage.setItem(b.SKYPE_HAS_HISTORY_KEY,t)}},e.prototype._triggerCustomAction=function(e){var t=e.content;if(t){var n=/<swc-event>(?:<name>([\s\S]*)<\/name>)[\s]?(?:<action>([\s\S]*)<\/action>)[\s]?(?:<data>([\s\S]*)<\/data>)<\/swc-event>/i,r=t.match(n);if(r&&!(r.length<3)){var i=r[1],o=r[2],s=r[3];o&&o.toLowerCase()===h.default.DELIVERED.toLowerCase()&&(i&&S.swc.Eventing.triggerEvent(i,s),e.content=t.replace(n,""))}}},e.prototype.backFillLostMessges=function(e){var t=this;if((!this._backfilllingPromise||this._backfilllingPromise.status!==p.PromiseStatus.Pending)&&this._isBackfillEnabled){var n=this;this._backfilllingPromise=new p.CancelablePromise(S.swc.services.webApi.fetchMessages(this.conversation.id)),this._backfilllingPromise.promise.then(function(e){e.messages&&e.messages.sort(function(e,t){var n=new Date(e.originalarrivaltime),r=new Date(t.originalarrivaltime);return n>r?1:n<r?-1:0}),n._messagesHandler(t.conversation,Date.now(),e)},function(e){})}},e.prototype.currentUserHasHistory=function(e){return(S.swc.services.sessionStorage.getItem(b.SKYPE_HAS_HISTORY_KEY)||"").indexOf(e)>=0||O.getConversationType(e)===j.ConversationType.GROUP},e.prototype.editMessageClassicWay=function(e,t){void 0===t&&(t="");var n={messagetype:e.rawMessageType,content:t,skypeeditedid:e.clientMessageId?e.clientMessageId:e.key};return S.swc.services.webApi.sendMessage(this.conversation.id,n)},e.prototype.executeWhenSignedIn=function(e){return S.swc.services.signInManager.getSkypeToken().then(function(t){return e()})},e.prototype.filterMessagesByKey=function(e,t){return e.filter(function(e){return e.key===t})[0]},e.prototype.getExistingMessage=function(e,t,n){var r=n!==t,i=this.filterMessagesByKey(n,e.key);return i||(r&&(i=this.filterMessagesByKey(t,e.key)),i)},e.prototype.mapSuggestedActionsArray=function(e,t,n){e.forEach(function(e){t.suggestedActions.pushObservable(n(e))})},e.prototype.messageContainsMention=function(e){return/<at id="(.*?)">.*?<\/at>/g.test(e).toString().toLowerCase()},e.prototype.onConversationLoadingFinished=function(){this._firstMessagePopulationPromise.status===p.PromiseStatus.Pending&&(this._firstMessagePopulationPromise.resolve(),(S.swc.services.signInManager.userIdentityType===g.IdentityType.SKYPE||this.currentUserHasHistory(this.conversation.id))&&this.updateConsumptionHorizonToLastMessage())},e.prototype.processNewMessage=function(e,t,n,r,i){function o(t){return t.title&&(t.title=this._encoder.decode(this._encoder.encode(t.title))),new T.default(t,e,s.senderId)}this._triggerCustomAction(t),n=n||e.messages;var s=this._messageTypesHandler.handle(t,{conversation:this.conversation,isHistory:r});if("Control/LiveState"===t.messagetype)return null;if(!s)return null;x.default.parseMessageProperties(s,t),s.status=j.DeliveryStatus.Sent,t.suggestedActions&&t.suggestedActions.actions&&this.mapSuggestedActionsArray(t.suggestedActions.actions,s,o.bind(this)),t.properties&&t.properties.suggestedActions&&t.properties.suggestedActions.actions&&this.mapSuggestedActionsArray(t.properties.suggestedActions.actions,s,o.bind(this));var a,c,u=this.getExistingMessage(s,n,e.messages);if((a=s)&&"SystemMessage"===a.type)return u?(s.isEdited=!0,this._messageTypesHandler.updateExistingMessage(u,s,r),s.subscribe("content",function(e){return u.content=e}),s):(n.pushObservable(s),s);if(!this._isTeamsBackend&&!u&&s.skypeEditedId)return(c=this.filterMessagesByKey(e.allMessages,s.key))?this._messageTypesHandler.updateExistingMessage(c,s,r):(i&&s.skypeEditedId&&((u=this._messageTypesHandler.handle(t,{conversation:this.conversation,isHistory:r})).id=s.skypeEditedId,u.skypeEditedId=void 0,this._messageTypesHandler.updateExistingMessage(u,s,r),n.pushObservable(u)),e.allMessages.pushObservable(s)),s;if(!u&&!s.skypeEditedId&&(c=this.filterMessagesByKey(e.allMessages,s.key)))return this._messageTypesHandler.updateExistingMessage(c,s,r),n.pushObservable(c),c;if(B.test(s.content)&&(s.content=s.content.replace(B,"$1"+_.default.dompurify.sanitize('<a class="replacedImg" href="$2" target="_blank"><img src="$2" alt=""></a>',G)+"$3")),z.test(s.content)){var l=s.content.match(z);l&&!l[2]&&(s.content=s.content.replace(l[0],_.default.dompurify.sanitize(l[0],G)))}return u?this._messageTypesHandler.updateExistingMessage(u,s,r):n.pushObservable(s),s},e.prototype.createMessageData=function(e){var t={contenttype:"text",composetime:(new Date).toISOString(),clientmessageid:Date.now().toString()};return Object.assign(t,e||{})},e.prototype.pushMessageToConversation=function(e,t){var n;return m.MessageType.SWIFT!==e&&(n=this._messageTypesHandler.generateOutgoing(t)),n&&this.conversation.messages.pushObservable(n),n},e.prototype.prepareForSending=function(e){var t=this;return new Promise(function(n,r){t.conversation.isSealed&&r("Conversation is Sealed and cannot be used for sending messaged");var i=-1!==e.messagetype.indexOf("Control");t._quarantineCountDown>=0&&!i&&(t._quarantineCountDown++,t.conversation.isChatEnabled=t.conversation.isChatEnabled&&t._quarantineCountDown<10,t.checkIfBuddy()),t._pendingContactRequest&&!i&&(t._pendingContactRequest=!1,S.swc.services.webApi.acceptConversation(t.conversation.id));var o=t.mePerson;o&&o.displayName&&(e.imdisplayname=o.displayName);var s=Date.now(),a=t.conversation.isAgent&&"RichText"===e.messagetype&&R.get().isOnline;a&&t.conversation.participants.length&&(t.conversation.participants[0].isTyping=!0),t.conversation.contextAad&&(e.content+='<context reason="customAad">'+t.conversation.contextAad+"</context>"),n({startTime:s,showTypingInAdvance:a})})},e.prototype.sendMessageToService=function(e,t,n,r,i){var o=this;return this.prepareForSending(t).then(function(s){var a=s.startTime,c=s.showTypingInAdvance;i=i||o.pushMessageToConversation(e,t);var u=function(r){i&&(i.status=j.DeliveryStatus.Sent),n&&n.origin!==f.ActionTrigger.TYPING&&(o.conversation.messagesSent++,o.updateConsumptionHorizonToLastMessage()),S.swc.Telemetry.sendEvent.messageSent(H.createConversationEvent(o.conversation),e,Date.now()-a,200,t.content.length||0,o.conversation.messagesSent)},l=function(n){i&&(i.status=j.DeliveryStatus.Failed),c&&o.conversation.participants.length&&(o.conversation.participants[0].isTyping=!1),S.swc.Telemetry.sendEvent.messageSent(H.createConversationEvent(o.conversation),e,Date.now()-a,n.status,t.content.length||0,o.conversation.messagesSent,void 0,n.errorCode,n.message),804===n.errorCode&&(o.conversation.isChatEnabled=!1,o.conversation.isUnderQuarantine=!0,o.checkIfBuddy()),403!==n.status&&404!==n.status||(o.conversation.isSealed=!0,o.conversation.isChatEnabled=!1)};return(r||Promise.resolve({})).then(function(){return S.swc.services.webApi.sendMessage(o.conversation.id,t).then(u,l)},l)})},e.prototype.updateConsumptionHorizonToLastMessage=function(){var e=this;if(0!==this.conversation.messages.length&&this.conversation.isActive&&u.default.instance.isFocused){var t=this.conversation.messages[this.conversation.messages.length-1],n=t.timestamp.getTime()+";"+(new Date).getTime()+";"+t.key;this.conversation.consumptionHorizon.lastReadMessageTimestamp>=t.timestamp.getTime()||S.swc.services.webApi.updateConsumptionHorizon(this.conversation.id,n).then(function(){e.conversation.updateConsumptionHorizon(n)})}},e.prototype.parseConversationTopic=function(e){var t={};return this.conversation.participants.forEach(function(e){t[e.person.mri]=e.person.displayName}),0===this.conversation.participants.length&&this.conversation.members&&this.conversation.members.forEach(function(e){t[e.id]=e.name}),w.default.parseConversationTopic(e,t,this.mePerson.mri)},e.prototype.updateConversationProperties=function(e,t){var n=this;if(void 0===t&&(t=!1),e&&(e.topic&&(this.conversation.topic=this.parseConversationTopic(e.topic)),e.picture&&(this.conversation.avatar=e.picture.replace("URL@","")),this._isTeamsBackend&&e.members)){var r=[];if(e.members.forEach(function(e){if(!S.swc.services.mePersonManager.isMe(e.id)){var t=S.swc.services.persons.getPerson(e.id);t.displayName&&r.push({userId:e.id,displayName:t.displayName})}}),0===r.length)return;S.swc.services.signInManager.isAadSupported()&&S.swc.services.avatarService.fetchMergedAvatars(r).then(function(e){e&&(n.conversation.avatar=e)})}},e}();t.default=J},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5),i=n(2),o=n(307),s=n(7),a=n(14),c=n(564),u=n(565),l=n(569),p=n(570),d=n(571),f=n(572),h=n(573),g=n(574),m=n(575),v=n(576),y=n(577),_=n(578),b=n(579),S=n(580),T=n(581),w=function(){function e(){this._processors=[],this._xmmFallbackProcessor=new T.default,this._processors.push(new b.default),this._processors.push(new c.default),this._processors.push(new l.default),this._processors.push(new y.default),this._processors.push(new S.default),this._processors.push(new v.default),this._processors.push(new f.default),this._processors.push(new g.default),this._processors.push(new _.default),this._processors.push(new u.default),this._processors.push(new h.default),this._processors.push(new d.FileMessageProcessor),this._processors.push(new m.default),this._processors.push(new p.default)}return e.prototype.handle=function(e,t){var n,r=0;for(e.contentOriginal&&e.contentOriginal!==e.content?e.content=e.contentOriginal:e.contentOriginal=e.contentOriginal||e.content;!n&&r<this._processors.length;)n=this._processors[r].process(e,t),r++;return n||(n=this._xmmFallbackProcessor.process(e)),n},e.prototype.generateOutgoing=function(e){for(var t,n=0;!t&&n<this._processors.length;)t=this._processors[n].generate(e),n++;return t},e.prototype.updateExistingMessage=function(e,t,n){if(!t||e.senderId!==t.senderId&&e.customType!==s.CustomMessageType.Call)return e;var c=0===t.content.indexOf(i.Configuration.MSG_DELETED_CLASSIC_SKYPE),u=0===e.content.indexOf(i.Configuration.MSG_DELETED_CLASSIC_SKYPE),l=t.skypeEditedId&&c,p=t.version>e.version,d=t.originalTimestamp>e.originalTimestamp,f=p||d;return d&&n&&(e.content=l?a.MessageUtils.extractMsgContent(t.content):t.content,e.timestamp=t.timestamp,e.originalTimestamp=t.originalTimestamp),e.type!==s.MessageType.LwcFile&&e.type!==s.MessageType.LwcImage||(e.content=t.content),e.status=t.status,t.skypeEditedId?t.editedTimestamp&&o.default.updateMessageProperties(e,t):o.default.updateMessageProperties(e,t),t.isEdited&&(e.isEdited=!0,u&&(e.content=a.MessageUtils.extractMsgContent(e.content)),(t.editedTimestamp>e.timestamp||f)&&(e.content=t.content)),e.isEdited&&!d&&n&&(e.timestamp=t.timestamp),t.isDeleted&&(e.isDeleted=!0),r.default.get.isTeams()&&(e.isDeleted=t.isDeleted,e.files=t.files,e.id===t.clientMessageId&&(e.id=t.id)),e},e.prototype.isTypingIndicator=function(e){return"Control/Typing"===e.messagetype||"Control/ClearTyping"===e.messagetype},e}();t.default=w},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=n(265),a=n(0),c=n(47),u=n(102),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.process=function(e,t){if("ThreadActivity/AddMember"!==e.messagetype)return null;var n=new u.default(this._createMessageModel.bind(this),this._generateContent,e);n.subscribeOnceToPersonsName(n._initiator),n._targets.forEach(n.subscribeOnceToPersonsName);var r=this.parseContentFor(e.content,"target"),i=a.swc.services.persons.getPerson(r),c=t.conversation.participants;if(!t.isHistory&&r&&c&&!c.some(function(e){return e.person.id===i.id})){var l=new s.default(i);c.pushObservable(l),i.isAgent&&a.swc.Eventing.triggerEvent(o.ApiEvents.BotAddedToThread,i.id)}return t.conversation.isOneOnOne&&(n._messageModel.content=""),n._messageModel},t.prototype._generateContent=function(e){var t=e._initiator.displayName||e._initiator.id,n=document.createElement("p");return n.innerText=t,e.isSelfAction()?a.swc.services.i18n.fetch("joinedConversation",{participant:"<b>"+n.innerHTML+"</b>"}):a.swc.services.i18n.fetch("wasAdded",{participant:"<b>"+n.innerHTML+"</b>",contact:"<b>"+e._targets.filter(function(t){return t.id!==e._initiator.id}).map(function(e){var t=e.displayName||e.id,n=document.createElement("p");return n.innerText=t,n.innerHTML}).join("</b>, <b>")+"</b>"})},t}(c.default);t.default=l},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),s=n(566),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.process=function(e,t){return(o.Configuration.ECS.showEngagementCampaings&&"PopCard"===e.messagetype||"Notice"===e.messagetype)&&s.default.instance.register(e,t),null},t}(n(47).default);t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),i=n(2),o=n(0),s=n(567),a=12096e5,c=function(){function e(){var e=this;this.register=function(t,n){var i,a;if(e._isSupported(n.conversation)&&e._isWithinTwoWeeks(t)){try{a=JSON.parse(t.content)}catch(e){}if(a&&a.length){switch(t.messagetype){case"Notice":i=new s.default(a[0],t.messagetype)}e._isInValid(i.validUntilTimestamp)||i&&o.swc.Eventing.triggerEvent(r.CampaignEvents.SHOW,i)}}},this._isSupported=function(t){return t.isAgent&&e._isConversationWithConciergeBot(t.id)},this._isInValid=function(e){return Date.now()>e.getTime()},this._isWithinTwoWeeks=function(e){var t=Date.now()-a;return new Date(e.originalarrivaltime).getTime()>t},this._isConversationWithConciergeBot=function(e){return e===i.Configuration.CONCIERGE_BOT_MRI||e===i.Configuration.CONCIERGE_BOT_DF_MRI}}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e}();t.default=c},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.campaignId=t.campaignId,r.schemaVersion=t.schemaVersion,r.attachment=t.attachments&&t.attachments.length?t.attachments[0]:null,r}return i(t,e),t}(n(568).default);t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(16);t.NOTICE_CONTENT_TYPE={GENERIC:"application/vnd.microsoft.notice",USER:"application/vnd.microsoft.notice.avatar"};var i=function(){return function(e,t){this.id=e.campaignGuid||e.campaignId||r.guid.generate(),this.type=t,this.language=e.language,this.clientVersion=e.clientVersion,this.platformList=e.platformList,this.userTagging=e.userTagging,this.validUntilTimestamp=e.validUntilTimestamp?new Date(e.validUntilTimestamp):null,this.experimentName=e.experimentName,this.contentCategory=e.contentCategory,this.telemetry=e.telemetry}}();t.default=i},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(47),a=n(102),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.process=function(e,t){if("ThreadActivity/DeleteMember"!==e.messagetype)return null;var n=new a.default(this._createMessageModel.bind(this),this._generateContent,e);if(n.subscribeOnceToPersonsName(n._initiator),n._targets.forEach(function(e){n.subscribeOnceToPersonsName(e),t.conversation&&e===o.swc.services.mePersonManager.mePerson&&(t.conversation.isChatEnabled=!1)}),!1===t.isHistory)for(var r=this.parseContentFor(e.content,"target"),i=o.swc.services.persons.getPerson(r),s=0;s<t.conversation.participants.length;s++){if(t.conversation.participants[s].person.id===i.id){t.conversation.participants.spliceObservable(s,1);break}}return n._messageModel},t.prototype._generateContent=function(e){var t=e._initiator.displayName||e._initiator.id,n=document.createElement("p");return n.innerText=t,e.isSelfAction()?o.swc.services.i18n.fetch("hasLeftConversation",{participant:"<b>"+n.innerHTML+"</b>"}):o.swc.services.i18n.fetch("wasRemoved",{participant:"<b>"+n.innerHTML+"</b>",removedParticipant:"<b>"+e._targets.map(function(e){var t=e.displayName||e.id,n=document.createElement("p");return n.innerText=t,n.innerHTML}).join("</b>, <b>")+"</b>"})},t}(s.default);t.default=c},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),s=n(0),a=n(292),c=n(14),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._getMissedCallMessage=function(e,t){var n=s.swc.services.persons.getPerson(e),r=s.swc.services.i18n.fetch("message_text_missedCallFrom",{fromParticipant:n.displayName||n.id});return n.displayName||n.fetchDisplayNameAndAvatar().then(function(){var n=s.swc.services.persons.getPerson(e),r=s.swc.services.i18n.fetch("message_text_missedCallFrom",{fromParticipant:n.displayName});t.content=c.MessageUtils.getMessageSanitizedContent(r)}),r},t._getParticipantIds=function(e){for(var t=[],n=/<part identity="(.*?)">/g,r=n.exec(e);null!==r;)t.push(r[1]),r=n.exec(e);return t},t._getDurationMessage=function(e){var t="",n=Math.floor(e/3600);n>0&&(t+=n+s.swc.services.i18n.fetch("message_text_hours")+" ");e%=3600;var r=Math.floor(e/60);r>0&&(t+=r+s.swc.services.i18n.fetch("message_text_minutes")+" ");var i=e%60;i>0&&(t+=i+s.swc.services.i18n.fetch("message_text_seconds"));return t.trim()},t}return i(t,e),t.prototype.process=function(e,t){if("Event/Call"!==e.messagetype&&"Signal/Flamingo"!==e.messagetype)return null;var n=this._createMessageModel(e,"",!0),r=e.conversationId||e.conversationid||"",i=t&&t.conversation&&t.conversation.isGroup||a.default.detectConversationType(r)===o.ConversationType.GROUP,u=e.content.replace(/\r?\n/g,""),l=null,p=o.CustomMessageType.Call;if(u.indexOf("<partlist")>-1){var d=/(<partlist alt ?= ?"">\s*<\/partlist>)|(<partlist type="started")/.test(u),f=/(^<ended)|(<partlist type="ended")/.test(u),h=/<partlist type="missed"/.test(u),g=new RegExp("<duration>([\\d|\\.]+)</duration>"),m=u.match(g.source),v=this._getParticipantIds(u),y=1===v.length,_=m?parseInt(m[1],10):0,b=c.MessageUtils.getSenderIdFromUrl(e.from),S=i?"GroupCall":"Call";if(d)l=s.swc.services.i18n.fetch("message_text_startedCall"),p=o.CustomMessageType.Call;else if(f&&!y){var T=_?"<span>"+this._getDurationMessage(_)+"</span>":"";l=_?s.swc.services.i18n.fetch("message_text_ended"+S)+" "+T:s.swc.services.i18n.fetch("message_text_noAnswer"+S),p=o.CustomMessageType.CallEnd}else if(h||f&&y){var w=s.swc.services.mePersonManager.isMe(b);l=s.swc.services.i18n.fetch("message_text_missed"+S),h&&!w&&(l=this._getMissedCallMessage(b,n)),w=v&&s.swc.services.mePersonManager.isMe(v[0]),f&&y&&!w&&(l=this._getMissedCallMessage(v[0],n)),p=i?o.CustomMessageType.MissedGroupCall:o.CustomMessageType.MissedCall}}var P=c.MessageUtils.getMessageSanitizedContent(l);return n.senderId=c.MessageUtils.getSenderIdFromUrl(e.from),n.sender=s.swc.services.persons.getPerson(n.senderId),n.content=P,n.isDeleted=!1,n.isEdited=!1,n.customType=p,n.content?n:null},t}(n(47).default);t.default=u},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),s=n(14),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.parseRawMessage=function(e){if(!e)return null;var t=e.match(/<URIObject[^>]*?\suri=\"([^"]+?)\"/i),n=e.match(/<URIObject[^>]*?\stype=\"([^"]+?)\"/i),r=e.match(/<meta[^>]*?\stype=\"([^"]+?)\"/i);return t?{uri:t[1],uriObjectType:r?r[1]:null,xmmType:n?n[1].split(".")[0]:null,size:null,originalName:null}:null},t.isValidFileMessage=function(e){return null===e||null===e.uri||"File"!==e.xmmType},t.createFileContent=function(e){return'<LwcFile url="'+e.uri+'" size="'+e.size+'" originalName="'+e.originalName+'"></LwcFile>'},t}return i(t,e),t.prototype.process=function(e){if(-1===["RichText/UriObject","RichText/Media_GenericFile","RichText/Media_Video","RichText/Media_AudioMsg","RichText/Media_Card"].indexOf(e.messagetype))return null;var t=e.content,n=this.parseRawMessage(t);if(!n)return e.content=s.MessageUtils.getMessageSanitizedContent(e.content),this._createMessageModel(e);if(this.isValidFileMessage(n))return null;var r=t.match(/<FileSize[\s]+[^<]*v=\"([\d]*?)\"[^<]/i),i=t.match(/<OriginalName[\s]+[^<]*v=\"([\s\S]*?)\"[^<]/);n.size=r?r[1]:"0",n.originalName=i?i[1]:null;var a=this._createMessageModel(e);return a.type=o.MessageType.LwcFile,a.content=this.createFileContent(n),a},t.prototype.generate=function(e){if("RichText/Media_GenericFile"!==e.messagetype)return null;var t=e.content,n=this.parseRawMessage(t);if(this.isValidFileMessage(n))return null;var r=t.match(/<FileSize[\s]+[^<]*v=\"([\d]*?)\"[^<]/i),i=t.match(/<OriginalName[\s]+[^<]*v=\"([\s\S]*?)\"[^<]/);n.size=r?r[1]:"0",n.originalName=i?i[1]:null;var s=this._generateOutgoingModel(e);return s.type=o.MessageType.LwcFile,s.content=this.createFileContent(n),s},t}(n(47).default);t.FileMessageProcessor=a},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(47),a=n(102),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.process=function(e){if("ThreadActivity/HistoryDisclosedUpdate"!==e.messagetype)return null;var t=new a.default(this._createMessageModel.bind(this),this._generateContent.bind(this,e.content),e);return t.subscribeOnceToPersonsName(t._initiator),t._messageModel},t.prototype._generateContent=function(e,t){var n=t._initiator.displayName||t._initiator.id,r=document.createElement("p");return r.innerText=n,"false"===this._getUpdateValue(e)?o.swc.services.i18n.fetch("historyDisclosed",{participant:"<b>"+r.innerHTML+"</b>"}):o.swc.services.i18n.fetch("historyClosed",{participant:"<b>"+r.innerHTML+"</b>"})},t.prototype._getUpdateValue=function(e){var t=e.match(/<value>(.+)<\/value>/i);return t?t[1]:""},t}(s.default);t.default=c},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),s=n(14),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.parseRawMessage=function(e){if(!e)return null;var t=e.match(/<URIObject[^>]*?\suri=\"([^"]+?)\"/i),n=e.match(/<URIObject[^>]*?\stype=\"([^"]+?)\"/i),r=e.match(/<meta[^>]*?\stype=\"([^"]+?)\"/i),i=e.match(/<originalname[^>]*?\sv=\"([^"]+?)\"/i);if(!t)return null;var o=new c;return o.filename=i?i[1]:null,o.uri=s.MessageUtils.normalizeUrl(t[1]),o.uriObjectType=r?r[1]:null,o.xmmType=n?n[1].split(".")[0]:null,o},t.isValidImageMessage=function(e){return null===e||null===e.uri||!("Picture"===e.xmmType||"photo"===e.uriObjectType)},t.createImageContent=function(e){return'<LwcImage url="'+e.uri+'" filename="'+e.filename+'" ></LwcImage>'},t}return i(t,e),t.prototype.process=function(e){if("RichText/UriObject"!==e.messagetype)return null;var t=this.parseRawMessage(e.content);if(!t&&e.skypeeditedid)return this._createMessageModel(e);if(t&&""===t.uri)return e.content=null,this._createMessageModel(e);if(this.isValidImageMessage(t))return null;var n=this._createMessageModel(e);return n.type=o.MessageType.LwcImage,n.content=this.createImageContent(t),n},t.prototype.generate=function(e){if("RichText/UriObject"!==e.messagetype)return null;var t=this.parseRawMessage(e.content);if(this.isValidImageMessage(t))return null;var n=this._generateOutgoingModel(e);return n.type=o.MessageType.LwcImage,n.content=this.createImageContent(t),n},t}(n(47).default);t.default=a;var c=function(){return function(){}}()},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(47),a=n(102),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.process=function(e){if("ThreadActivity/JoiningEnabledUpdate"!==e.messagetype)return null;var t=new a.default(this._createMessageModel.bind(this),this._generateContent.bind(this,e.content),e);return t.subscribeOnceToPersonsName(t._initiator),t._messageModel},t.prototype._generateContent=function(e,t){var n=t._initiator.displayName||t._initiator.id,r=document.createElement("p");return r.innerText=n,"true"===this._getUpdateValue(e)?o.swc.services.i18n.fetch("joiningEnabled",{participant:"<b>"+r.innerHTML+"</b>"}):o.swc.services.i18n.fetch("joiningDisabled",{participant:"<b>"+r.innerHTML+"</b>"})},t.prototype._getUpdateValue=function(e){var t=e.match(/<value>(.+)<\/value>/i);return t?t[1]:""},t}(s.default);t.default=c},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),s=n(14),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.process=function(e){if(e.messagetype!==o.MessageType.SystemMessage)return null;var t=s.MessageUtils.getMessageSanitizedContent(e.content);return this._createMessageModel(e,t,!0)},t}(n(47).default);t.default=a},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(47),a=n(102),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.process=function(e,t){if("ThreadActivity/PictureUpdate"!==e.messagetype)return null;var n=new a.default(this._createMessageModel.bind(this),this._generateContent,e);if((n.subscribeOnceToPersonsName(n._initiator),t.conversation&&t.conversation.messages&&t.conversation.messages.length)&&t.conversation.messages[t.conversation.messages.length-1].timestamp<n._messageModel.timestamp){var r=this.getNewPicture(e.content);t.conversation.avatar=r||t.conversation.avatar}return n._messageModel},t.prototype._generateContent=function(e){var t=e._initiator.displayName||e._initiator.id,n=document.createElement("p");return n.innerText=t,o.swc.services.i18n.fetch("threadPictureUpdated",{participant:"<b>"+n.innerHTML+"</b>"})},t.prototype.getNewPicture=function(e){var t=e.match(/URL@([^<]+)(?=<\/value>)/g);return t?t[0].replace("URL@",""):null},t}(s.default);t.default=c},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),s=n(0),a=n(47),c=n(102),u={admin:o.ParticipantRole.Admin,user:o.ParticipantRole.User},l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._updateParticipantRoles=function(e,t,n){var r=u[n.toLowerCase()];t.forEach(function(t){e.participants.forEach(function(e){var n=e.person.id;t.id===n&&(e.role=r)})})},t}return i(t,e),t.prototype.process=function(e,t){if("ThreadActivity/RoleUpdate"!==e.messagetype)return null;var n=this._getRole(e.content),r=new c.default(this._createMessageModel.bind(this),this._generateContent.bind(this,n),e);return r.subscribeOnceToPersonsName(r._initiator),r._targets.forEach(r.subscribeOnceToPersonsName),t.conversation&&t.conversation.participants&&this._updateParticipantRoles(t.conversation,r._targets,n),r._messageModel},t.prototype._generateContent=function(e,t){var n=t._initiator.displayName||t._initiator.id,r=document.createElement("p");r.innerText=n;var i=t._targets[0].displayName||t._targets[0].id,o=document.createElement("p");return o.innerText=i,s.swc.services.i18n.fetch("roleUpdated",{who:"<b>"+r.innerHTML+"</b>",whom:"<b>"+o.innerHTML+"</b>",role:"<b>"+e+"</b>"})},t.prototype._getRole=function(e){var t=e.match(/<role>(.+)<\/role>/i);return t?t[1]:""},t}(a.default);t.default=l},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),s=n(32),a=n(0),c=n(14),u=n(56),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._getTitle=function(e){var t=e.content.match(/<Title>(.*)<\/Title>/i);return t?t[1]:a.swc.services.i18n.fetch("s_title",{mesageType:e.messagetype})},t}return i(t,e),t.prototype.process=function(e){if("RichText/Media_Card"!==e.messagetype)return null;var t=this._getTitle(e),n=e.content.match(/<Swift b64="([^"]+)"\s*\/>/i);try{var r=u.b64DecodeUnicode(n[1]);r=c.MessageUtils.getMessageSanitizedContent(r),r=encodeURIComponent(r),e.content='<SwiftCard Swift="'+r+'">'+s.default.dompurify.sanitize(t,{ALLOWED_TAGS:[]})+"</SwiftCard>"}catch(e){return null}var i=this._createMessageModel(e);i.type=o.MessageType.SwiftCard;try{i.content=decodeURIComponent(e.content)}catch(e){return null}return i},t}(n(47).default);t.default=l},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(111),s=n(14),a=n(47),c=/<context reason=\"customAad\">.*<\/context>/g,u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.process=function(e,t){if("RichText"!==e.messagetype&&"Text"!==e.messagetype&&"InviteFreeRelationshipChanged/Initialized"!==e.messagetype&&"RichText/Html"!==e.messagetype)return null;e.content||(e.content="");var n=e.content,r=n.match(c);r&&r[0]&&(n=n.replace(r[0],"")),e.content=n;var i=this._createMessageModel(e);return i.content=o.default.parse(i.content),i.content=s.MessageUtils.getMessageSanitizedContent(i.content,t),i},t.prototype.generate=function(e){return"RichText"!==e.messagetype&&"RichText/Html"!==e.messagetype?null:this._generateOutgoingModel(e)},t}(a.default);t.default=u},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),s=n(14),a=n(47),c=n(102),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.process=function(e,t){if("ThreadActivity/TopicUpdate"!==e.messagetype)return null;e.threadtopic&&t.conversation&&(t.conversation.topic=s.MessageUtils.parseTopic(e.threadtopic));var n=new c.default(this._createMessageModel.bind(this),this._generateContent.bind(this,e.content),e);return n.subscribeOnceToPersonsName(n._initiator),n._messageModel},t.prototype._generateContent=function(e,t){var n=this.parseContentFor(e,"value");n=(n=n?s.MessageUtils.unescape(n):"")?s.MessageUtils.parseTopic(n):"";var r=t._initiator.displayName||t._initiator.id,i=document.createElement("p");i.innerText=r;var a=document.createElement("p");return a.innerText=n,o.swc.services.i18n.fetch("topicUpdated",{participant:"<b>"+i.innerHTML+"</b>",topic:"<i>"+a.innerHTML+"</i>"})},t}(a.default);t.default=u},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(14),s=n(7),a=n(0),c=n(47),u=["RichText/UriObject","RichText/Media_GenericFile","RichText/Media_Video","RichText/Media_FlikMsg","RichText/Media_Card","RichText/Contacts","RichText/Location","RichText/Files","RichText/Sms","Event/SkypeVideoMessage","Event/SkypeAudioMessage"],l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.process=function(e){if(u.indexOf(e.messagetype)<0)return null;var t=e.content.match(/^<uriobject[^>]*?>(.*?)<\/uriobject>$/i);if(!t){var n=a.swc.services.i18n.fetch("m_unsupported"),r=this._createMessageModel(e,n);return r.type=s.MessageType.Unsupported,r}var i=o.MessageUtils.getMessageSanitizedContent(t[1]);return this._createMessageModel(e,i)},t}(c.default);t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.DELIVERED="delivered",e.CLICK="click",e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i=n(4),o=n(27),s=n(0);!function(e){e[e.replace=1]="replace"}(r=t.Rule||(t.Rule={}));var a=function(){function e(e,t,n){var r=this;this.pattern=e,this.rule=t,this.replace=function(e){return e.replace(r.pattern,r.replacer)},this.replacer=function(e){for(var t=e.length,n="",i=r.replacement;t--;)n+=i;return n},this.replacement=n}return Object.defineProperty(e.prototype,"replacement",{get:function(){return this.char?String.fromCharCode(this.char):void 0},set:function(e){this.char=e?e.charCodeAt(0):this.char},enumerable:!0,configurable:!0}),e}(),c=function(){function e(){var e=this;this.masks=[],this.setupProxy=function(){s.swc.Eventing.registerEvent(i.ApiEvents.invoke.registerMask,function(t){e.register(t,r.replace,"#")}),s.swc.Eventing.registerEvent(i.ApiEvents.invoke.unregisterMask,function(t){e.unregister(t)})},o.ProxyConnector.instance.connect("messageMasking",null,this.setupProxy)}return Object.defineProperty(e,"instance",{get:function(){return e.init()},enumerable:!0,configurable:!0}),e.init=function(){return e._instance||(e._instance=new e)},Object.defineProperty(e.prototype,"empty",{get:function(){return!this.masks.length},enumerable:!0,configurable:!0}),e.prototype.register=function(e,t,n){var r=this.masks.find(function(n){return n.pattern===e&&n.rule===t});r?r.replacement!==n&&(r.replacement=n):this.masks.push(new a(e,t,n))},e.prototype.unregister=function(e,t){this.masks.forEach(function(n,r,i){n.pattern!==e||t&&n.rule!==t||i.splice(r,1)})},e.prototype.shouldMask=function(e){if(this.empty)return!1;for(var t,n=0,r=this.masks;n<r.length;n++){var i=r[n];if(t=e.search(i.pattern)>-1)break}return t},e.prototype.process=function(e){return this.masks.forEach(function(t){return e=t.replace(e)}),e},e}();t.Masks=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(85),i=n(45),o=n(300),s=n(13),a=function(){function e(){var e=this;this.persons={},this.subscribedPresenceStatus={},this.subscribeToUserStatus=function(t,n){if(!t||!n)return Promise.resolve(!1);if(e.subscribedPresenceStatus[t])return Promise.resolve(!0);var r=function(){return delete e.subscribedPresenceStatus[t],Promise.resolve(!1)},o=n.bind(null,t);return e.subscribedPresenceStatus[t]=o,s.ServicesManager.initPromise.then(function(){return s.ServicesManager.signInManager.onceSignedIn().then(function(){var n=s.ServicesManager.signInManager.currentUserName,a=e.getMri(t);return s.ServicesManager.contactsService.getContact(n,a).then(function(t){if(!t)return!1;var n=e.getPerson(a);return n.subscribe("presenceStatus",o),s.ServicesManager.webApi.subscribeContactPresence(a),n.presenceStatus&&n.presenceStatus!==i.PresenceStatus.Undefined&&o(n.presenceStatus),!0},r)},r)},r)}}return e.prototype.getPerson=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var i=this.persons[e];if(!i){var a=r.default.normalizePersonId(e);i=this.persons[a]}var c=s.ServicesManager.mePerson,u=c&&(e===c.mri||e===c.id||e.indexOf(c.msaId)>-1);return!i&&c&&u&&(i=this.persons[c.mri],e=c.mri,u=!0,i||(i=c)),i||(i=this.persons[e]=new o.default(e,n,t)),i.isFilled||!t||u||i.fetchDisplayNameAndAvatar(),i},e.prototype.dispose=function(){var e=this;Object.getOwnPropertyNames(this.persons).forEach(function(t){e.persons[t].dispose()}),this.persons={},this.subscribedPresenceStatus={}},e.prototype.createEmptyPerson=function(e){var t=new o.default(e,!1,!1);return this.persons[t.id]=t,t},e.prototype.handlePresenceData=function(e,t){var n=this.getPerson(e),r=t.status;n.presenceStatus=r},e.prototype.unsubscribeFromUserStatus=function(e){if(!e||!this.subscribedPresenceStatus[e])return!1;var t=this.getMri(e);return this.getPerson(t).unsubscribe("presenceStatus",this.subscribedPresenceStatus[e]),delete this.subscribedPresenceStatus[e],!0},e.prototype.getUserStatus=function(e){var t=this;if(!e)return Promise.resolve(null);var n=function(){return Promise.resolve(null)};return s.ServicesManager.initPromise.then(function(){return s.ServicesManager.signInManager.onceSignedIn().then(function(){var r=s.ServicesManager.signInManager.currentUserName,o=t.getMri(e);return s.ServicesManager.contactsService.getContact(r,o).then(function(e){if(!e)return null;var n=t.getPerson(o);return n.presenceStatus&&n.presenceStatus!==i.PresenceStatus.Undefined?n.presenceStatus:s.ServicesManager.webApi.getUsersPresence([o]).then(function(e){var t=e[0];return t.Payload&&t.Payload.status})},n)},n)},n)},e.prototype.subscribeToMyStatus=function(e){var t=this;return s.ServicesManager.initPromise.then(function(){return s.ServicesManager.signInManager.onceSignedIn().then(function(){var n=s.ServicesManager.mePerson;return n.subscribe("presenceStatus",e),s.ServicesManager.webApi.subscribeContactPresence(n.mri),t.subscribedPresenceStatus[n.id]=e,!0},function(e){return Promise.resolve(!1)})},function(e){return Promise.resolve(!1)})},e.prototype.getMyStatus=function(){return s.ServicesManager.mePerson.presenceStatus},e.prototype.setMyStatus=function(e){return s.ServicesManager.webApi.setMyPresence(e).then(function(e){return e.ok?Promise.resolve(!0):Promise.resolve(!1)},function(e){return Promise.resolve(!1)})},e.prototype.getMri=function(e){return-1===e.indexOf("8:")?"8:"+e:e},e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(586);t.createClientFromPlaceHolder=function(e){if("string"==typeof e&&0===e.indexOf("command_createBridgeClient"))try{var t=e.split("##"),n=(t[0],t[1]);return r.createBridgeClient(n)}catch(e){}return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(16);t.createBridgeClient=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new Promise(function(n){var o={requestId:i.guid.generate(),args:t};r.swc.Eventing.registerEvent(e+":response",function(e){e.requestId===o.requestId&&n(e.value)}),r.swc.Eventing.triggerEvent(e+":request",o)})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=new(function(){function e(){}return e.prototype.preloadDeps=function(){return this.loadPromise?this.loadPromise:(this.loadPromise=new Promise(function(e,t){r.swc.scriptLoader.addScript("vendors",!0,e,t)}),this.loadPromise)},e}());t.vendorLoader=i}]);