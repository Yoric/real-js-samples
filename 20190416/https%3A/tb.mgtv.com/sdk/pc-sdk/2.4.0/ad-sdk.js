/*!
 * mgtv-ad-sdk.js v2.4.2
 *
 * @author MGTV AD F2E Group
 * Released under the ISC License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.getADObject=e()}(this,function(){"use strict";var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function u(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var I=function(){return(I=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function c(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&(i[n[r]]=t[n[r]])}return i}function s(){var t=navigator.platform,e=navigator.userAgent;return"Win32"===t||"Windows"===t?function(t){var e;if(e=-1!==t.indexOf("WOW64")?"64位":"32位",-1!==t.indexOf("Windows NT 6.0")||-1<t.indexOf("Windows Vista")){if("64位"===e||-1<t.indexOf("Windows Vista"))return"Windows_vista "+e}else if(-1<t.indexOf("Windows NT 6.1")||-1<t.indexOf("Windows 7")){if("32位"===e||-1<t.indexOf("Windows 7"))return"Windows_7 "+e}else try{var i=t.match(/Windows NT 5.\d/i).toString();return"Windows_"+["2000","XP","2003"][Number(i.replace(/Windows NT 5.(\d)/i,"$1"))]+" "+e}catch(t){return"Windows"}}(e)||"Windows":"Mac68K"===t||"MacPPC"===t||"Macintosh"===t||"MacIntel"===t?"Mac":"X11"===t?"Unix":-1<String(t).indexOf("Linux")?"Linux":"Unknow"}function h(t){return/iPad/i.test(t)}function a(t){return/Android/i.test(t)}function p(t){return/iPhone/i.test(t)}var d,t,l,e,v,i,r,f="PCWEBSDK_V2.4.2_20190404"+(h(navigator.userAgent)?"_pad":"");(t=d||(d={})).CMS_DATA="cmsData",t.VIDEO_PLAY="videoPlay",t.VIDEO_PAUSE="videoPause",t.VIDEO_DRAG="videoDrag",t.VIDEO_RELOAD="videoReload",t.VIDEO_RESUME="videoResume",t.VIDEO_END="videoEnd",t.C_RESIZE="c_resize",t.MINI_MODE="miniModeChange",t.FRONT_AD_PLAY="frontAdPlay",t.MID_AD_PLAY="midAdPlay",t.SPLASH_SHOW="splashShow",t.API_REQ_ERR="apiRequestError",t.CONTROL_BAR_CHANGE="controlbarChange",t.PRO_BAR_HOVER="progressbarHover",t.PRO_BAR_UPDATE="progressbarUpdate",(e=l||(l={})).PLAYER_DESTROY="PLAYER_DESTROY",e.SYNC_PLAY_TIME="SYNC_PLAY_TIME",e.SYNC_WATCH_TIME="SYNC_WATCH_TIME",e.FETCH_CONFIG_SUC="FETCH_CONFIG_SUC",e.FETCH_CONFIG_FAIL="FETCH_CONFIG_FAIL",e.AD_PREPARE_SUC="AD_PREPARE_SUC",e.AD_PREPARE_FAIL="AD_PREPARE_FAIL",e.AD_WILL_SHOW="AD_WILL_SHOW",e.AD_SHOW="AD_SHOW",e.AD_HIDE="AD_HIDE",e.AD_WILL_END="AD_WILL_END",e.AD_END="AD_END",e.AD_IMP="AD_IMP",e.AD_REQUEST_END="AD_REQUEST_END",e.VIDEO_AD_START="VIDEO_AD_START",e.AD_EVENT_TRIGGER="AD_EVENT_TRIGGER",e.CDN_REPORT="CDN_REPORT",e.PLAYER_LOG="PLAYER_LOG",(i=v||(v={})).JUMP_CLICK="JUMP_CLICK",i.MUTE="MUTE",i.UNMUTE="UNMUTE",i.SKIP="SKIP",i.TIME_UPDATE="TIME_UPDATE",i.SHOW_INTERACT="SHOW_INTERACT",i.CLOSE_INTERACT="CLOSE_INTERACT",i.PAUSE="PAUSE",i.RESUME="RESUME",(r||(r={})).IMPRESSION="IMPRESSION";var o={suuid:"",cxid:"",sessionid:"",wver:"",did:"",href:"",ref:"",uuid:""},y=null;function m(){var t=function(){var t=window.STK;if(t)try{var e=t.$.sessionid(),i=t.$.getCxid("cxid"),n=t.wver;return{suuid:t.$.getsUUID(),cxid:i,sessionid:e,wver:n,did:t.$.stkuuid(),href:"",ref:"",uuid:""}}catch(t){console.log(t)}}();return y||t?I({},t,y):o}var g="as_",E=g+"stage-item",T=g+"icon",C=g+"close-button",L=g+"circle_close-btn",R=g+"video-modal",D=R+"_btn",A=D+"--txt",_=D+"--circle",P=R+"_group",O=R+"_row as_clear",S=g+"fill_player";function w(t){t&&(t.remove?t.remove():t.parentNode&&t.parentNode.removeChild(t))}function N(t,e,i){var n=document.createElement(t);return e&&(n.className=e),"string"==typeof i?n.innerText=i:Array.isArray(i)&&i.forEach(function(t){return n.appendChild(t)}),n}var M="as-track-click";function k(t){t.setAttribute(M,"")}function b(t,e,i){var n=N(t,e,i);return k(n),n}function x(t){var e,i,n,r,o=t.url,s=(i=(e=t).width,n=e.height/i*100+"%",(r=N("div")).style.paddingBottom=n,r.style.position="relative",r),a=N("div");return o&&(a.style.backgroundImage="url("+o+")"),a.style.position="absolute",a.style.height="100%",a.style.width="100%",a.style.backgroundSize="100% 100%",a.classList.add("adsdk_image"),s.appendChild(a),s}function U(t,e){void 0===t&&(t=""),void 0===e&&(e="");var i=N("div","as_image-block "+e);return t&&V(i,t),i}function B(){return U("","as_close-image")}function V(t,e){t&&(t.style.backgroundImage="url("+e+")")}var F=function(){function t(t){this.linkDOM=N("a"),this.linkDOM.href=t}return t.prototype.getProperty=function(t){return this.linkDOM[t]},t.prototype.getQueryValue=function(t){var e=this.getProperty("search");if(window.URLSearchParams)return new URLSearchParams(e).get(t);var i=new RegExp("[?&]"+t+"=([^&]*)").exec(e);return i&&decodeURIComponent(i[1].replace(/\+/g," "))},t}();function H(t){return Array.isArray(t)?t.concat():[t]}function W(t){if(t){if(Array.isArray(t))return 0<t.length;if(t instanceof Object)return 0<Object.keys(t).length}return!1}function G(t,e,i){if("function"==typeof e&&Array.isArray(t)){if(Array.prototype.find)return Array.prototype.find.call(t,e,i);for(var n=0,r=t.length;n<r;){var o=t[n];if(e.call(i,o,n,t))return o;n+=1}}}var Y,j,K,q,z,J,Q,X,Z,$,tt,et,it,nt=function(){function t(t){this.eventBus=t}return t.prototype.generateReportURL=function(t,i){if(i){var n=t;return Object.keys(i).forEach(function(t){var e="["+t+"]";n=n.replace(e,i[t])}),n}var e=-1===t.indexOf("?")?"?":"&";return""+t+e+"sdk_rnd="+Date.now()},t.prototype.sendReport=function(t,e){var i=this;H(t).forEach(function(t){(new Image).src=i.generateReportURL(t,e)})},t.prototype.sendReportAsync=function(t,e){var i=this;setTimeout(function(){return i.sendReport(t,e)},0)},t}(),rt=function(i){function h(t){var e=i.call(this,t)||this;return e.eventBus.addListener(l.CDN_REPORT,e.handleReportEvent,e),e}return u(h,i),h.prototype.handleReportEvent=function(t){var e=t.data;if(e){var i=window.mangoPlayer,n=i?f+"_"+i.pver:f,s=I({},h.COMMON_PARAMS,{sdkver:n},e),r=m();if(r){var o=r.wver,a=r.did,u=r.sessionid,p=r.suuid;s.v=o,s.cookie=a,s.sessionid=u,s.suuid=p}var c=Object.keys(s).map(function(t){var e=s[t];if(null==e)return"";if("url"!==t)return t+"="+e;var i=new F(e),n=i.getProperty("host"),r=i.getProperty("pathname"),o="h="+n;return/\/\S+/.test(r)&&(o+="&l="+encodeURIComponent(r)),o}).join("&"),d=[h.REPORT_URL+"?time="+this.getTimeTxt()+"&"+c];this.sendReportAsync(d)}},h.prototype.getTimeTxt=function(){var t=new Date;return""+t.getFullYear()+("0"+(t.getMonth()+1)).slice(-2)+("0"+t.getDate()).slice(-2)+("0"+t.getHours()).slice(-2)+("0"+t.getMinutes()).slice(-2)+("0"+t.getSeconds()).slice(-2)},h.REPORT_URL="http://v2.res.log.hunantv.com/info.php",h.COMMON_PARAMS={z:1,t:4},h}(nt);function ot(t){return void 0===t&&(t=""),"ad_sdk_"+t+"_"+Date.now()+"_"+Math.ceil(1e5*Math.random())}(j=Y||(Y={})).FRONT="front",j.PAUSE="pause",j.FLOAT="float",j.MID="mid",j.LOADING="loading",j.PROGRESS="progress",(q=K||(K={}))[q.USER_CLICK=0]="USER_CLICK",q[q.TIME_OUT=1]="TIME_OUT",q[q.EXPIRED=2]="EXPIRED",q[q.CREATIVE_ERROR=3]="CREATIVE_ERROR",(J=z||(z={}))[J.IMAGE_TEXT=1]="IMAGE_TEXT",J[J.NORMAL_IMAGE=2]="NORMAL_IMAGE",J[J.BUBBLE=3]="BUBBLE",J[J.SPECIAL_IMAGE=4]="SPECIAL_IMAGE",J[J.DYNAMIC_IMAGE=5]="DYNAMIC_IMAGE",J[J.ECommerce=6]="ECommerce",J[J.VOTE=7]="VOTE",J[J.BOTTOM_BANNER=8]="BOTTOM_BANNER",(Q||(Q={})).PLAYER_BANNER="player-banner",(Z=X||(X={})).LAND_CLOSE="landClose",Z.CLICK="click",Z.CLOSE="close",Z.START="start",Z.FIRSTQUARTILE="firstQuartile",Z.MIDPOINT="midpoint",Z.THIRDQUARTILE="thirdQuartile",Z.COMPLETE="complete",Z.MUTE="mute",Z.UNMUTE="unmute",Z.PROGRESS="progress",Z.SKIP="skip",Z.ERR="err",Z.FAVOR="favor",(tt=$||($={})).H5="H5",tt.VIDEO="VIDEO",tt.IMG="IMG",(it=et||(et={})).BUTTON="button",it.INTERACT="interact",it.PREVIEW="preview";var st,at,ut=h(navigator.userAgent)?9000101:9000100;(at=st||(st={}))[at.FRONT=1]="FRONT",at[at.MID=2]="MID";function pt(t){for(var e=t.split(":"),i=0,n=0;n<e.length;)i+=Math.pow(60,n)*Number(e[e.length-n-1]),n++;return i}var ct,dt,ht=function(){function t(t){this.id=ot("creative_item"),this.duration=0,this.trackingEvents={},this.width=0,this.height=0,this.parseCommonVast(t)}return t.prototype.saveTrackingEvents=function(t){var s=this;t.forEach(function(t){var e=t.event,i=t.content,n=t.offset,r=t.skip,o={url:i};n&&(o.offset=n),r&&(o.skip=Number(r)),s.addTracking(e,o)})},t.prototype.saveClickTracking=function(t){var i=this;t.forEach(function(t){var e="string"==typeof t?t:t.content;i.addTracking(X.CLICK,{url:e})})},t.prototype.addTracking=function(t,e){this.trackingEvents[t]||(this.trackingEvents[t]=[]),this.trackingEvents[t].push(e)},t.prototype.parseCommonVast=function(t){var e=t.duration,i=t.trackingEvents;if(this.duration=pt(e.content),i&&i.tracking){var n=H(i.tracking);W(n)&&this.saveTrackingEvents(n)}},t}(),lt=function(n){function t(t){var e=this;if(t&&t.nonLinearAds){var i=t.nonLinearAds;(e=n.call(this,i)||this).parseCommonNonLinearVast(i),e.parse(i)}return e}return u(t,n),t.prototype.parseCommonNonLinearVast=function(t){if(t.nonLinear){var e=t.nonLinear,i=e.width,n=e.height,r=e.nonLinearClickThrough,o=e.nonLinearClickTracking,s=e.title;if(this.width=Number(i),this.height=Number(n),r){var a=r.content,u=c(r,["content"]);this.clickThrough=a,this.clickThroughConfig=u}if(o){var p=H(o);this.saveClickTracking(p)}s&&(this.title=s.content)}},t}(ht),vt=function(t){var e=t.messages,i=t.options;this.messages=H(e.message||[]),this.options=H(i.option||[]),this.options.forEach(function(t){t.message&&(t.message=H(t.message))})},ft=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.parse=function(t){var e=t.nonLinear.bubbleInfo;e&&(this.bubbleInfo=new vt(e))},e}(lt),yt="as_stages-wrapper",mt=function(){function t(t,e){this.player=t,this.eventBus=e,this.stages=[],this.initContainer(),this.initEventHandlers(),this.getADPluginContainer().appendChild(this.dom),this.detectPlayerMode()}return t.prototype.reset=function(){this.interruptAllPlayers(),this.stages=[],this.dom&&w(this.dom),this.initContainer()},t.prototype.initEventHandlers=function(){this.eventBus.addListener(d.C_RESIZE,this.detectPlayerMode,this)},t.prototype.interruptAllPlayers=function(){this.stages.forEach(function(t){t&&t.interrupt()})},t.prototype.getADPluginContainer=function(){return this.player.adContainer},t.prototype.detectPlayerMode=function(){var t=this.dom;if(t){var e=this.player.getVideoSize();if(e){var i=e.isFloating,n=yt+"--mini";i?t.classList.add(n):t.classList.remove(n)}}},t}();(dt=ct||(ct={}))[dt.SHOW=0]="SHOW",dt[dt.HIDE=1]="HIDE";var gt,Et,It=function(){function t(t,e,i,n){this.mgPlayer=e,this.eventBus=i,this.isFillContent=n,this.players=[],this.status=ct.HIDE,this.dom=N("div",E),this.dom.style.display="",t.appendChild(this.dom),this.initEventListeners()}return t.prototype.isHidden=function(){return this.status===ct.HIDE},t.prototype.canRemove=function(){return 0===this.players.length},t.prototype.show=function(){this.status=ct.SHOW,this.dom.style.display="",this.players.forEach(this.showPlayer.bind(this))},t.prototype.hide=function(){var t=this.status;this.status=ct.HIDE,this.dom.style.display="none",t!==ct.HIDE&&this.players.forEach(this.hidePlayer.bind(this))},t.prototype.destroy=function(){var t=this.dom;this.eventBus.removeListenersByScope(this),w(t)},t.prototype.interrupt=function(){var e=this;W(this.players)&&this.players.forEach(function(t){try{e.interruptPlayer(t)}catch(t){console.log(t)}}),this.destroy()},t.prototype.addPlayer=function(t){this.players=this.players.concat(t),this.status===ct.SHOW&&this.startPlayer(t)},t.prototype.removePlayer=function(e){this.players=this.players.filter(function(t){return t!==e}),this.exitPlayer(e)},t.prototype.initEventListeners=function(){this.isFillContent&&this.startAutoResponsive()},t.prototype.startPlayer=function(t){t.start(this.dom,this.mgPlayer)},t.prototype.showPlayer=function(t){t.show(this.dom,this.mgPlayer)},t.prototype.hidePlayer=function(t){t.hide(this.dom,this.mgPlayer)},t.prototype.exitPlayer=function(t){t.exit(this.dom,this.mgPlayer)},t.prototype.interruptPlayer=function(t){t.interrupt(this.dom,this.mgPlayer)},t.prototype.adjustStageSize=function(){var t=this.mgPlayer,e=this.dom;if(e){var i=t.getVideoSize();if(i&&!i.isFloating){var n=(16/9*i.height).toFixed(3);e.style.width=n+"px"}}},t.prototype.startAutoResponsive=function(){this.adjustStageSize(),this.eventBus.addListener(d.C_RESIZE,this.adjustStageSize,this)},t}();(Et=gt||(gt={}))[Et.NONE=0]="NONE",Et[Et.NORMAL=1]="NORMAL",Et[Et.MODAL=2]="MODAL",Et[Et.VIDEO=3]="VIDEO",Et[Et.SPLASH=4]="SPLASH";var Tt,Ct,Lt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.topLayer=gt.NONE,t.playerMap={},t}return u(t,e),t.prototype.reset=function(){e.prototype.reset.call(this),this.topLayer=gt.NONE,this.playerMap={}},t.prototype.addPlayer=function(t,e){var i=this.canAddToStage(e);if(i){var n=this.playerMap,r=this.stages;r[n[t.id]=e]||(r[e]=this.createStage(e));var o=r[e];(this.topLayer===gt.SPLASH||e>this.topLayer)&&(this.topLayer=e,this.hideSubStages(e),o.show()),o.addPlayer(t)}return i},t.prototype.removePlayer=function(t){var e=this.playerMap,i=this.stages,n=e[t.id];if(null!=n&&i[n]){var r=i[n];r.removePlayer(t),n!==gt.NORMAL&&r.canRemove()&&(r.destroy(),i[n]=null,this.showSubStage(n))}},t.prototype.canAddToStage=function(t){if(this.dom){var e=this.stages,i=this.topLayer;return t>gt.NORMAL?i===gt.SPLASH||i<t&&null==e[t]:i<=t}return!1},t.prototype.initContainer=function(){var t=this.getADPluginContainer();if(t){this.dom=N("div",yt);var e=5,i=Number(t.style.zIndex);0<i&&(e=i-1),this.dom.style.zIndex=""+e,t.appendChild(this.dom)}},t.prototype.showSubStage=function(t){for(var e=this.getSubStagesArr(t),i=e.length;0<=i;i-=1){var n=e[i];if(n)return this.topLayer=i,void n.show()}this.topLayer=gt.NONE},t.prototype.hideSubStages=function(t){this.getSubStagesArr(t).forEach(function(t){t&&t.hide()})},t.prototype.getSubStagesArr=function(t){return this.stages.slice(0,t)},t.prototype.createStage=function(t){var e=this.dom,i=this.player,n=this.eventBus,r=t===gt.NORMAL;return new It(e,i,n,r)},t}(mt),Rt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.players=[],t}return u(t,e),t.prototype.addPlayer=function(t){var e=this.canAddToStage();if(e){this.players.push(t);var i=this.getStage();i.isHidden()&&i.show(),i.addPlayer(t)}return e},t.prototype.removePlayer=function(e){var t=this.players;-1!==t.indexOf(e)&&(this.getStage().removePlayer(e),this.players=t.filter(function(t){return t!==e}))},t.prototype.canAddToStage=function(){return null!=this.dom},t.prototype.initContainer=function(){var t=this.getADPluginContainer();if(t){this.dom=N("div",yt);var e=7,i=Number(t.style.zIndex);0<i&&(e=i+1),this.dom.style.zIndex=""+e,t.appendChild(this.dom)}},t.prototype.getStage=function(){var t=this.stages[0];if(!t){var e=this.dom,i=this.player,n=this.eventBus;t=new It(e,i,n,!1),this.stages[0]=t}return t},t}(mt);(Ct=Tt||(Tt={}))[Ct.INNER=0]="INNER",Ct[Ct.OUTTER=1]="OUTTER";var Dt,At,_t,Pt,Ot=function(){function t(t,e){this.eventBus=t,this.player=e,this.players={},this.buildStage(),this.initEventListener()}return t.prototype.reset=function(){this.players={},this.innerStage.reset(),this.outterStage.reset()},t.prototype.canAddPlayerToStage=function(t,e){var i=this.getStageByType(t);return null!=i&&i.canAddToStage(e)},t.prototype.buildStage=function(){var t=this.player,e=this.eventBus;this.innerStage=new Lt(t,e),this.outterStage=new Rt(t,e)},t.prototype.initEventListener=function(){var t=this.eventBus;t.addListener(l.AD_WILL_SHOW,this.onADWillShow,this),t.addListener(l.AD_WILL_END,this.onADWillEnd,this)},t.prototype.onADWillShow=function(t){if(t.data){var e=t.data,i=e.player,n=e.layer,r=e.type,o=this.getStageByType(r);o&&(this.players[i.id]=r,o.addPlayer(i,n))}},t.prototype.onADWillEnd=function(t){if(t.data){var e=t.data,i=e.player,n=this.players,r=this.eventBus;if(i&&null!=n[i.id]){var o=this.getStageByType(n[i.id]);delete n[i.id],o&&(o.removePlayer(i),r.dispatch({type:l.AD_END,data:e}))}}},t.prototype.getStageByType=function(t){return t===Tt.INNER?this.innerStage:this.outterStage},t}(),St=function(){function t(t,e){this.sdkId=ot("ad_item"),this.errorUrls=[],this.impressionUrls=[],this.adLostUrls=[],this.hideADLogo=!1,this.parse(t,e)}return t.prototype.parse=function(t,e){var i=t.inLine,n=t.type,r=t.id,o=t.hideLog;if(this.spaceId=r,this.type=n,this.hideADLogo=null!=o,i){var s=i.impression,a=i.extensions,u=i.error,p=i.creatives,c=H(s),d=H(u),h=function(t){return t.filter(function(t){return null!=t}).map(function(t){return t.content})};if(this.impressionUrls=h(c),this.errorUrls=h(d),a&&a.adLost){var l=H(a.adLost);this.adLostUrls=h(l)}p&&p.creative&&(this.creative=this.parseCreative(p.creative,e))}},t}(),wt=function(n){function t(t,e){var i=n.call(this,t,e)||this;return i.parseFloatData(t),i}return u(t,n),t.prototype.parseCreative=function(t,e){return new e(t)},t.prototype.parseFloatData=function(t){var e=t.interact,i=t.adstyle,n=t.subType;e&&(this.interact=Number(e)),i&&(this.adStyle=Number(i)),t.subType=n},t}(St);(At=Dt||(Dt={})).WEBVIEW="webview",At.POSTER="poster",At.MULTI_POSTER="multi_poster",At.VOTE_NATIVE="vote_native",(Pt=_t||(_t={}))[Pt.MID=1]="MID",Pt[Pt.RIGHT=2]="RIGHT",Pt[Pt.LEFT=3]="LEFT";var Nt=function(t){this.sdkId=ot("companion");var e=t.type,i=t.showStyle;this.type=e,this.position=Number(i)},Mt=function(){function t(t){var r=this;this.sdkId=ot("native_info"),this.trackingEvents={},this.clickThrough="";var e=t.companionClickThrough,i=t.trackingEvents;e&&e.content&&(this.clickThrough=e.content),i&&i.tracking&&H(i.tracking).forEach(function(t){var e=t.content,i=t.event,n={url:e};r.addTracking(i,n)})}return t.prototype.addTracking=function(t,e){this.trackingEvents[t]||(this.trackingEvents[t]=[]),this.trackingEvents[t].push(e)},t}(),kt=function(e){function t(t){var n=e.call(this,t)||this;n.mainImage="",n.subImage="",n.title="",n.desc="",n.buttonTitle="";var r=t.nativeInfo;if(r){["mainImage","subImage","title","desc","buttonTitle"].forEach(function(t){var e=r[t],i="";e&&e.content&&(i=e.content),n[t]=i}),n.subImage||(n.subImage=n.mainImage),n.buttonTitle||(n.buttonTitle="查看更多")}return n}return u(t,e),t}(Mt),bt=function(i){function t(t){var e=i.call(this,t)||this;return e.natives=[],e.parse(t),e}return u(t,i),t.prototype.parse=function(t){var e=this.type;if(e===Dt.POSTER&&t.nativeInfo){var i={trackingEvents:t.trackingEvents,nativeInfo:t.nativeInfo,companionClickThrough:t.companionClickThrough},n=new kt(i);this.natives=[n]}else e===Dt.MULTI_POSTER&&t.natives&&t.natives.native&&(this.natives=H(t.natives.native).map(function(t){return new kt(t)}))},t}(Nt),xt=function(i){var n=this;this.sdkId=ot("vote_option"),Object.keys(i).forEach(function(t){var e=i[t];n[t]="counter"===t?e?Number(e.content):0:e&&e.content?e.content:""})},Ut=function(){function t(i){var n=this;Object.keys(i).forEach(function(t){if("voteOptions"===t)n.saveOptions(i[t]);else{var e=i[t];n[t]=e&&e.content?e.content:""}})}return t.prototype.saveOptions=function(t){t&&Array.isArray(t.voteOption)&&(this.options=t.voteOption.map(function(t){return new xt(t)}))},t}(),Bt=function(i){function t(t){var e=i.call(this,t)||this;return e.vote=new Ut(t.voteNative),e}return u(t,i),t}(Mt),Vt=function(i){function t(t){var e=i.call(this,t)||this;return e.trackingEvents={},e.parse(t),e}return u(t,i),t.prototype.parse=function(t){t&&t.voteNative&&(this.native=new Bt(t))},t}(Nt),Ft=function(){function t(t){this.options=t,this.needRecalculate=!0}return t.prototype.addVote=function(t,e){void 0===e&&(e=1);var i=this.getVoteInfo(t);i&&(i.counter+=e,this.needRecalculate=!0)},t.prototype.getRatiosInfo=function(){this.needRecalculate&&this.updateInfo();return{ratios:this.ratios,maxItemId:this.maxItemId}},t.prototype.getVoteInfo=function(t){for(var e=0,i=this.options;e<i.length;e++){var n=i[e];if(n.sdkId===t)return n}},t.prototype.updateInfo=function(){for(var t=this.options,e=t.reduce(function(t,e){return t+e.counter},0),i={},n=t.length,r=100,o=0;o<n;o+=1){var s=t[o],a=s.sdkId,u=s.counter,p=0;o!==n-1?r-=p=Math.round(100*u/e):p=r,i[a]=p}this.findMaxItemId(i),this.ratios=i,this.needRecalculate=!1},t.prototype.findMaxItemId=function(n){var t=Object.keys(n).reduce(function(t,e){if(t){var i=n[t];return n[e]<i?t:e}return e});this.maxItemId=t},t}(),Ht=function(){function t(t){this.eventbus=t,this.id=ot("player")}return t.prototype.sendADReportEvent=function(t,e){this.eventbus.dispatch({type:l.AD_EVENT_TRIGGER,data:{urls:t,params:e}})},t.prototype.sendCDNReportEvent=function(t){this.eventbus.dispatch({type:l.CDN_REPORT,data:t})},t}();function Wt(t){var e=t.clientX,i=t.clientY,n=t.offsetX,r=t.offsetY,o=window.screen;return{CLICK_AD_POS:n+"*"+r,CLICK_DEV_POS:e+"*"+i,RS:o.width+"*"+o.height}}function Gt(t,e){if(t&&e){if((n=t)&&null!=n.getAttribute(M))return!0;var i=t.querySelectorAll("["+M+"]");if(i)return[].slice.call(i).some(function(t){return t.contains(e)})}var n;return!1}var Yt,jt,Kt="as-vote-panel",qt=Kt+"_vote",zt=function(o){function t(t,e){var i=o.call(this,e)||this,n=t.position,r=t.native;return i.native=r,i.position=n,i.voteManager=new Ft(r.vote.options),i}return u(t,o),t.prototype.start=function(t,i){var n=this;this.createDOM(i),this.updateContent(),t.appendChild(this.playerDOM),t.classList.add(Kt+"-bg"),t.addEventListener("click",function(t){var e=t.target;e&&e.classList.contains("as_stage-item")&&n.end(i)}),setTimeout(function(){n.playerDOM.classList.add("active")},50)},t.prototype.show=function(t,e){},t.prototype.hide=function(t,e){},t.prototype.interrupt=function(){this.exit()},t.prototype.exit=function(){var t=this.playerDOM;t&&(w(t),this.playerDOM=null)},t.prototype.createDOM=function(t){var i=this,e=this.native.vote,n=e.title,r=e.banner,o=this.createTitle(n),s=this.createBanner(r),a=B(),u=N("div",C,[a]);u.addEventListener("click",function(){return i.end(t)});var p=N("div",Kt+"_content as_scroll"),c=N("div",""+Kt,[u,o,p,s]);this.position===_t.RIGHT&&c.classList.add(Kt+"--right"),c.addEventListener("click",function(t){if(Gt(c,t.target)){var e=Wt(t);i.sendNativeTrackingEvent(X.CLICK,!1,e)}}),this.contentDOM=p,this.playerDOM=c},t.prototype.getVoteOptions=function(){return this.native.vote.options},t.prototype.updateContent=function(){var t=null;this.isVoted()?t=this.createResultList():(t=this.createVoteList(),this.bindVoteListEvent(t));var e=this.contentDOM,i=this.listDOM;i?e.replaceChild(t,i):e.appendChild(t),this.listDOM=t},t.prototype.bindVoteListEvent=function(u){var p=this,c=function(t){var e=t.target;if(e)for(var i=u.querySelectorAll("."+qt),n=i.length,r=0;r<n;r+=1){var o=i[r];if(o.contains(e)){u.removeEventListener("click",c);var s=o.dataset.id;p.voteManager.addVote(s);var a=p.voteManager.getVoteInfo(s).voteUri;p.sendADReportEvent(H(a)),sessionStorage.setItem(p.native.sdkId+"_vote","1"),p.updateContent()}}};u.addEventListener("click",c)},t.prototype.createVoteList=function(){var t=this.getVoteOptions(),a=!!t[0].image;return N("ul","",t.map(function(t){var e=t.sdkId,i=t.image,n=t.content,r=[N("div",qt+"-name",n),N("div",qt+"-btn "+T,"投票")];if(a){var o=U(i,qt+"-img");r.unshift(o)}var s=N("li",qt+" as_clear",r);return s.dataset.id=e,s}))},t.prototype.createResultList=function(){var t=this.getVoteOptions(),v=!!t[0].image,e=this.voteManager.getRatiosInfo(),f=e.ratios,y=e.maxItemId;return N("ul","",t.map(function(t){var e=t.sdkId,i=t.image,n=t.content,r=N("p",qt+"-result-name",n),o=f[e],s=N("p",qt+"-result-ratio-txt",o+"%"),a=N("div",qt+"-result-ratio "+T,[s]),u=N("div",qt+"-result-bar-inner",[a]);setTimeout(function(){return u.style.width=o+"%"},100);var p=N("div",qt+"-result-bar",[u]),c=[N("div",qt+"-result",[r,p])],d=" "+T+" icon-crown";if(v){var h=U(i,qt+"-img "+d);c.unshift(h)}else r.className+=d;var l=N("div",qt+" as_clear",c);return e===y&&l.classList.add(qt+"--top"),l.dataset.id=e,l}))},t.prototype.isVoted=function(){var t=this.native.sdkId+"_vote";return null!=sessionStorage.getItem(t)},t.prototype.createTitle=function(t){var e=N("p","",t);return N("div",Kt+"_title",[e])},t.prototype.createBanner=function(t){var e=Kt+"_banner",i=[U(t,Kt+"_banner-img"),N("p",Kt+"_banner-flag","go")],n=this.native.clickThrough;if(n){var r=b("a",e,i);return r.target="_blank",r.href=n,r}return N("div",e,i)},t.prototype.end=function(t){var e=this,i=this.playerDOM,n=this.eventbus;i.classList.remove("active"),this.sendNativeTrackingEvent(X.CLOSE,!0),setTimeout(function(){n.dispatch({type:l.AD_WILL_END,data:{player:e,reason:K.USER_CLICK}})},350)},t.prototype.sendNativeTrackingEvent=function(t,e,i){if(this.native){var n=this.native,r=n.sdkId,o=n.trackingEvents,s=r+"_"+t,a=!0;if(e)a=!(null!=sessionStorage.getItem(s));if(a){var u=o[t];u&&this.sendADReportEvent(u.map(function(t){return t.url}),i),sessionStorage.setItem(s,"1")}}},t}(Ht),Jt="as_poster",Qt=Jt+"-panel",Xt=function(o){function t(t,e){var i=o.call(this,e)||this;i.currentNativeIndex=0;var n=t.position,r=t.natives;return i.natives=r,i.position=n,i}return u(t,o),t.prototype.start=function(t,i){var n=this;t.classList.add(Jt+"-bg"),this.isMid=this.position===_t.MID;var e=this.natives[0],r=this.createNativeInfoDom(e);this.sendNativeTrackingEvent(X.START,e);var o=this.createContainer(i,r,t);1<this.natives.length&&this.initMultiPoster(o,e,r),this.playerDOM=o,this.infoDOM=r,t.appendChild(this.playerDOM),t.addEventListener("click",function(t){var e=t.target;e&&e.classList.contains("as_stage-item")&&n.end(i)}),this.isMid&&(this.initEventsHandlerForMid(),i.pause()),setTimeout(function(){o.classList.add("active")},100)},t.prototype.show=function(t,e){},t.prototype.hide=function(t,e){},t.prototype.interrupt=function(){this.exit()},t.prototype.exit=function(){this.stopChangeItemTask();var t=this.playerDOM;t&&(w(t),this.playerDOM=null)},t.prototype.createContainer=function(t,e,i){var r=this,n=this.createCloseBtn(t),o=N("div",Qt,[e,n]);return this.addContainerClassNameByType(i,o),o.addEventListener("click",function(t){if(Gt(o,t.target)){var e=r.getCurrentNative();if(e){var i=e.trackingEvents[X.CLICK];if(i){var n=Wt(t);r.sendADReportEvent(i.map(function(t){return t.url}),n)}}}}),o},t.prototype.createCloseBtn=function(t){var e=this,i=B(),n=N("div",C,[i]);return n.addEventListener("click",function(){return e.end(t)}),n},t.prototype.initMultiPoster=function(t,e,i){var n=this;t.classList.add(Qt+"--multi"),this.switcher=this.createPosterSwitcher(this.natives),this.switcher.addEventListener("click",function(t){var e=t.target;if(e&&e.classList.contains("as_poster-switcher-image")&&!e.classList.contains("active")){var i=e.dataset.id;n.stopChangeItemTask(),n.changeNativeItemById(i),n.startChangeItemTask()}}),this.changeActiveSwitcherImage(e.sdkId),i.appendChild(this.switcher),this.startChangeItemTask()},t.prototype.addContainerClassNameByType=function(t,e){if(this.isMid)t.classList.add(Jt+"-bg--pause"),e.classList.add(Qt+"--mid");else{var i=Qt+"--side";e.classList.add(i),this.position===_t.LEFT?e.classList.add(i+"-left"):e.classList.add(i+"-right")}},t.prototype.sendNativeTrackingEvent=function(t,e,i){if(e){var n=e.sdkId,r=e.trackingEvents,o=n+"_"+t;if(!sessionStorage.getItem(o)){var s=r[t];s&&this.sendADReportEvent(s.map(function(t){return t.url}),i),sessionStorage.setItem(o,"1")}}},t.prototype.changeActiveSwitcherImage=function(t){var e=this.switcher.querySelector("."+Jt+"-switcher-image.active");e&&e.classList.remove("active"),this.switcher.querySelector('[data-id="'+t+'"]').classList.add("active")},t.prototype.createPosterSwitcher=function(t){var i=this,n=N("div",Jt+"-switcher"),r=1/t.length*100+"%";return t.forEach(function(t){var e=i.createSwitcherImage(t);i.isMid&&(e.style.height=r),n.appendChild(e)}),N("div",Jt+"-switcher-wrapper",[n])},t.prototype.createSwitcherImage=function(t){var e=t.sdkId,i=U(t.subImage,Jt+"-switcher-image");return i.dataset.id=e,N("div",Jt+"-switcher-item",[i])},t.prototype.createNativeInfoDom=function(t){var e=[U(t.mainImage,Jt+"-main-image"),this.createNativeDetailBox(t)];return N("div",Jt+"-info",e)},t.prototype.changeNativeItemById=function(e){var t=function(t,e,i){if("function"==typeof e&&Array.isArray(t)){if(Array.prototype.findIndex)return Array.prototype.findIndex.call(t,e,i);for(var n=0,r=t.length;n<r;){var o=t[n];if(e.call(i,o,n,t))return n;n+=1}return-1}}(this.natives,function(t){return t.sdkId===e});this.changeNativeItemByIndex(t)},t.prototype.changeNativeItemByIndex=function(t){this.currentNativeIndex=t;var e=this.natives[t],i=e.sdkId;this.changeActiveSwitcherImage(i),this.playerDOM.querySelector('[data-id="'+i+'"]').classList.add("active");var n=this.createNativeDetailBox(e);V(this.playerDOM.querySelector("."+Jt+"-main-image"),e.mainImage);var r=this.infoDOM.querySelector("."+Jt+"-detail");this.infoDOM.replaceChild(n,r),this.sendNativeTrackingEvent(X.START,e)},t.prototype.createNativeDetailBox=function(t){var e=t.title,i=t.desc,n=[N("div",Jt+"-image-mask"),N("p",Jt+"-title",e),N("p",Jt+"-content",i),this.createNativeButton(t)];return N("div",Jt+"-detail",n)},t.prototype.createNativeButton=function(t){var e=t.clickThrough,i=t.buttonTitle,n=t.sdkId,r=this.createLeftBtn(i,e),o=this.createRightBtn(n,t);return N("div",Jt+"-detail-button",[r,o])},t.prototype.createRightBtn=function(t,e){return N("div","rightButton",[this.createVoteBtn(t,e),N("div","rightButtonMask")])},t.prototype.createVoteBtn=function(t,e){var i=this,n=t+"_vote",r=U("","voteImage");return"1"===sessionStorage.getItem(n)&&r.classList.add("select"),r.addEventListener("click",function(){var t=r.classList.contains("select");r.classList.toggle("select"),t?sessionStorage.removeItem(n):(i.sendNativeTrackingEvent(X.FAVOR,e),sessionStorage.setItem(n,"1"))}),r},t.prototype.createLeftBtn=function(t,e){var i=N("div","leftButton",t);if(e){var n=b("a",null,[i]);return n.target="_blank",n.href=e,n}return i},t.prototype.startChangeItemTask=function(){var e=this,i=this.natives.length;this.changeItemTask=window.setInterval(function(){var t=(e.currentNativeIndex+1)%i;e.changeNativeItemByIndex(t)},5e3)},t.prototype.stopChangeItemTask=function(){clearInterval(this.changeItemTask)},t.prototype.initEventsHandlerForMid=function(){var t=this;this.pauseEventHandler=function(){return t.end()},this.eventbus.addListener(d.VIDEO_RESUME,this.pauseEventHandler)},t.prototype.end=function(t){var e=this;this.stopChangeItemTask();var i=this.playerDOM,n=this.isMid,r=this.eventbus;i.classList.remove("active");var o=n?0:350;this.sendNativeTrackingEvent(X.CLOSE,this.getCurrentNative());setTimeout(function(){r.dispatch({type:l.AD_WILL_END,data:{player:e,reason:K.USER_CLICK}}),n&&(r.removeListener(d.VIDEO_RESUME,e.pauseEventHandler),t&&t.resume())},o)},t.prototype.getCurrentNative=function(){var t=this.currentNativeIndex;return this.natives[t]},t}(Ht),Zt=function(r){function t(t,e,i){var n=r.call(this,e)||this;return n.closeTrackingUrls=i,n.url=t.url,n}return u(t,r),t.prototype.start=function(t,e){var i=this,n=N("iframe");n.src=this.url,n.scrolling="no",n.frameBorder="0";var r=N("div","closeButton","关闭");r.addEventListener("click",function(){return i.end()});var o=N("div","as_iframe-panel",[r,n]);t.appendChild(o),t.classList.add("interactive"),t.addEventListener("click",function(t){var e=t.target;e&&e.classList.contains("as_stage-item")&&i.end()}),this.playerDOM=o,setTimeout(function(){return o.classList.add("active")},100)},t.prototype.show=function(t,e){},t.prototype.hide=function(t,e){},t.prototype.interrupt=function(){this.exit()},t.prototype.exit=function(){var t=this.playerDOM;t&&(w(t),this.playerDOM=null)},t.prototype.end=function(){var t=this;this.playerDOM.classList.remove("active"),this.closeTrackingUrls&&this.sendADReportEvent(this.closeTrackingUrls),setTimeout(function(){t.eventbus.dispatch({type:l.AD_WILL_END,data:{player:t,reason:K.USER_CLICK}})},500)},t}(Ht),$t=function(){function t(){}return t.createPanelPlayer=function(t,e){var i=t.type,n=t.data,r=t.options;return i===Dt.WEBVIEW?new Zt(n,e,r):i===Dt.POSTER||i===Dt.MULTI_POSTER?new Xt(n,e):i===Dt.VOTE_NATIVE?new zt(n,e):void 0},t}(),te="as-float-button__container",ee=function(r){function t(t,e,i){var n=r.call(this,e)||this;return n.canClose=!1,n.fixedPos=!1,n.parse(t,i),n}return u(t,r),t.prototype.show=function(t,e){this.playerDOM||this.start(t,e)},t.prototype.hide=function(t){},t.prototype.interrupt=function(t){this.exit(t)},t.prototype.exit=function(t){this.isExit=!0,this.playerDOM&&(w(this.playerDOM),this.playerDOM=null)},t.prototype.parse=function(t,e){var i=t.ad,n=t.extensions;if(n){var r=n.rollTime,o=n.position;if(r&&(this.rollTime=Number(r.content)),o){var s=o.close,a=c(o,["close"]);this.canClose="1"===s,this.position=a}}this.adItem=new wt(i,e);var u=i.inLine.creatives.creative;u&&u.companionAds&&this.parseCompanion(u.companionAds)},t.prototype.buildPlayerDOM=function(){var r=this,o=N("div",te),n=this.position;if(!this.fixedPos)if("1"===n.center){o.classList.add("as_pos-hori-center");var t=Math.max(Number(n.rbottom),12.5);o.style.bottom=t+"%"}else{["rleft","rright","rbottom","rtop"].forEach(function(t){var e=n[t];if(e){var i=t.substr(1);o.style[i]=e+"%"}})}o.addEventListener("click",function(t){if(Gt(o,t.target)){var e=r.getTrackingEventData(X.CLICK);if(e){var i=Wt(t),n=e.map(function(t){return t.url});r.sendADReportEvent(n,i)}r.invokePromotionAction()}}),this.playerDOM=o},t.prototype.getTrackingEventData=function(t){return this.adItem.creative.trackingEvents[t]},t.prototype.invokePromotionAction=function(){var t=this.adItem,e=t.creative,i=t.interact,n=this.companionInfo;if(12===i&&n){var r={type:n.type,data:n},o=$t.createPanelPlayer(r,this.eventbus);this.eventbus.dispatch({type:l.AD_WILL_SHOW,data:{player:o,layer:gt.MODAL,type:Tt.INNER}})}else if(e.clickThrough){var s=e.clickThrough,a=e.clickThroughConfig;if(a&&"2"===a.external){var u=this.getTrackingEventData(X.LAND_CLOSE),p=u?u.map(function(t){return t.url}):null;r={type:Dt.WEBVIEW,data:{url:s},options:p},o=$t.createPanelPlayer(r,this.eventbus);this.eventbus.dispatch({type:l.AD_WILL_SHOW,data:{player:o,layer:gt.MODAL,type:Tt.INNER}})}else window.open(s),window.opener=null}},t.prototype.afterAppend=function(){var t=this.adItem.impressionUrls;t&&this.eventbus.dispatch({type:l.AD_EVENT_TRIGGER,data:{urls:t}})},t.prototype.end=function(t){this.isExit=!0,this.eventbus.dispatch({type:l.AD_WILL_END,data:{player:this,reason:t}})},t.prototype.sendCloseReport=function(){var t=this.getTrackingEventData(X.CLOSE);t&&this.sendADReportEvent(t.map(function(t){return t.url}))},t.prototype.reportCreativeFetchResult=function(t,e){var i={url:t,s:3,ptype:Y.FLOAT,f:e?-1:0,error:e?3e5:0};if(this.sendCDNReportEvent(i),e){var n=this.adItem;n.errorUrls&&this.sendADReportEvent(n.errorUrls,{ERRORCODE:502,ERRORURL:encodeURIComponent(t)})}},t.prototype.createCloseButton=function(){var t=this,e=B(),i=N("div",C,[e]);return i.addEventListener("click",function(){t.sendCloseReport(),t.end(K.USER_CLICK)}),i},t.prototype.parseCompanion=function(t){var e=t.companions,i=t.companion,n=e&&e.companion||i;if(n){var r=n.type;r===Dt.POSTER||r===Dt.MULTI_POSTER?this.companionInfo=new bt(n):r===Dt.VOTE_NATIVE&&(this.companionInfo=new Vt(n))}},t.OUTTER_CLOSE_CLASS=te+"--outter-close",t}(Ht),ie=g+"bubble",ne=ie+"_msg-list",re=ie+"_option-btn",oe=function(i){function t(t,e){return i.call(this,t,e,ft)||this}return u(t,i),t.prototype.start=function(t){this.buildPlayerDOM();var e=this.adItem.creative.bubbleInfo;if(e){this.playerDOM.classList.add(ie);var i=e.messages,n=e.options;this.messages=i.concat(),this.options=n.concat();var r=this.getInitBubbleDoms();this.contentBox=this.initContentBox(t,r);var o=N("div",ie+"_btn",[this.contentBox]);if(this.canClose){this.playerDOM.classList.add(ee.OUTTER_CLOSE_CLASS);var s=this.createCloseButton();setTimeout(function(){s.style.display="",s.style.opacity="1"},3e3),o.appendChild(s)}this.playerDOM.appendChild(o),t.appendChild(this.playerDOM),this.afterAppend(),this.messageList=o.querySelector("."+ne),this.startBubbleAnimate(this.messageList,r)}},t.prototype.getInitBubbleDoms=function(){var i=this,n=[];if(W(this.messages)&&this.messages.forEach(function(t){var e=i.createMessageItem(t);n.push(e)}),W(this.options)){var t=this.createOption(this.options);n.push(t)}return n},t.prototype.initContentBox=function(t,e){var i=N("div",ne,e),n=N("div",ie+"_content-box",[i]),r=this.calculateContentHeight(t,n),o=r<=360?r:360;return i.style.top=o+"px",n.style.height=o+"px",n},t.prototype.beforeBubbleShow=function(){var t=this.contentBox,e=this.messageList;t.style.overflow="hidden",e.style.position="absolute"},t.prototype.afterBubbleShow=function(){var t=this.contentBox,e=this.messageList;t.style.overflow="auto",e.style.position="static",t.scrollTop=t.scrollHeight},t.prototype.startBubbleAnimate=function(i,e){var n=this,r=parseInt(i.style.top,10),o=function(){var t=e.shift();t?(!function(t){t.style.visibility="visible",t.style.opacity="1",r-=t.clientHeight;var e=window.getComputedStyle(t,null).getPropertyValue("margin-top");e&&(r-=parseInt(e,10)),i.style.top=r+"px"}(t),setTimeout(o,1500)):setTimeout(function(){return n.afterBubbleShow()},1500)};o()},t.prototype.calculateContentHeight=function(t,e){e.style.visibility="hidden",t.appendChild(e);var i=e.clientHeight;return t.removeChild(e),e.style.visibility="",i},t.prototype.createOption=function(t){var r=this,e=t.map(function(t,e){var i=r.createOptionItem(t);return i.dataset.index=""+e,i}),o=N("div",ie+"_option as_clear",e),s=t.concat(),a=function(t){var e=t.target;if(e&&e.classList.contains(re)){o.removeEventListener("click",a),e.classList.add("selected");var i=e.dataset.index;if(null!=i){var n=s[Number(i)].message;W(n)&&r.appendMessagesToContent(n)}}};return o.addEventListener("click",a,!1),o},t.prototype.appendMessagesToContent=function(t){var e=this,i=t.map(function(t){return e.createMessageItem(t)});this.beforeBubbleShow(),i.forEach(function(t){e.messageList.appendChild(t)}),this.startBubbleAnimate(this.messageList,i)},t.prototype.createOptionItem=function(t){return N("div",re,t.content)},t.prototype.createMessageItem=function(t){var e=t.content,i=t.avatar,n=t.type,r=t.name,o=[U(i,ie+"_head"),N("p",ie+"_name",r)];if("text"===n){var s=N("div",ie+"_content",e);o.push(s)}else{var a=U(e,ie+"_image-content");k(a),o.push(a)}return N("div",ie+"_bubble-msg",o)},t}(ee),se=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.parse=function(t){var e=t.nonLinear;if(e&&e.staticResource){var i=e.staticResource,n=i.content,r=i.creativeType;this.mediaFile=n,this.mediaType=r}},e}(lt);(jt=Yt||(Yt={}))[jt.HORIZON=1]="HORIZON",jt[jt.VERTICAL=2]="VERTICAL";var ae=function(i){var n=this;["title","desc","buttonTitle"].forEach(function(t){var e=i[t];e&&(n[t]=e.content)}),["type","historyPrice","currentPrice"].forEach(function(t){var e=i[t];e&&e.content&&(n[t]=Number(e.content))})},ue=function(i){function t(){return null!==i&&i.apply(this,arguments)||this}return u(t,i),t.prototype.parse=function(t){i.prototype.parse.call(this,t);var e=t.nonLinear.eCommerce;e&&(this.commerceInfo=new ae(e))},t}(se);function pe(t,e,i){var n=new Image;n.onload=function(){return e(n)},n.onerror=i,n.src=t}var ce,de,he="as-ec-float",le=function(i){function t(t,e){return i.call(this,t,e,ue)||this}return u(t,i),t.prototype.start=function(o,t){var s=this,e=this.adItem.creative,a=e.mediaFile,i=e.mediaType,u=e.commerceInfo;if(/^image\//.test(i)){pe(a,function(){if(!s.isExit){s.buildPlayerDOM(),s.playerDOM.classList.add(he);var t=u.type===Yt.HORIZON;if(t&&s.playerDOM.classList.add(he+"--bar"),s.canClose){var e=s.createCloseButton();s.playerDOM.appendChild(e)}var i=s.generateImageElement(a,t),n=s.generateContent(u,t),r=N("div",he+"_content",[i,n]);s.playerDOM.appendChild(r),o.appendChild(s.playerDOM),s.reportCreativeFetchResult(a,!1),s.afterAppend()}},function(){s.reportCreativeFetchResult(a,!0),s.end(K.CREATIVE_ERROR)})}},t.prototype.generateContent=function(t,e){var i=t.title,n=t.desc,r=t.historyPrice,o=t.currentPrice,s=t.buttonTitle,a=N("div",he+"_detail-btn",s),u=N("div",he+"_title",i),p=N("span",he+"_current","￥"+o),c=he+"_price",d=N("p",c,[p]);if(r){var h=N("span",he+"_history","￥"+r);d.appendChild(h),d.classList.add(c+"--compare")}var l=N("p","");if(n){var v=N("span",he+"_desc",n);l.appendChild(v)}if(e){var f=this.generateADTag();l.appendChild(f)}return b("div",he+"_detail",e?[u,l,d,a]:[u,d,l,a])},t.prototype.generateImageElement=function(t,e){var i=U(t,he+"_img");if(!e){var n=this.generateADTag();i.appendChild(n)}return i},t.prototype.generateADTag=function(){return N("span",he+"_tag","广告")},t}(ee),ve=function(i){function t(t,e){return i.call(this,t,e,se)||this}return u(t,i),t.prototype.initPlayerDom=function(t,e){if(void 0===e&&(e="100%"),t.classList.add("as-float-image-button__wrapper"),"number"==typeof e){t.style.maxWidth=e+"px";var i=100*e/848;t.style.width=i+"%"}else t.style.width=e},t.prototype.createCloseButtonIfNeed=function(t,e){if(this.canClose){e&&t.classList.add(ee.OUTTER_CLOSE_CLASS);var i=this.createCloseButton();t.appendChild(i)}},t}(ee),fe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.start=function(t){this.showStaticImageButton(t)},e.prototype.showStaticImageButton=function(n){var r=this,t=this.adItem.creative,o=t.mediaFile,s=t.width,a=t.height;pe(o,function(){if(r.reportCreativeFetchResult(o,!1),!r.isExit){r.buildPlayerDOM();var t=r.playerDOM;r.initPlayerDom(t,s);var e=x({url:o,width:s,height:a});k(e),r.createCloseButtonIfNeed(t,!0);var i=N("div",null,[e]);t.appendChild(i),n.appendChild(t),r.afterAppend()}},function(){r.reportCreativeFetchResult(o,!0),r.end(K.CREATIVE_ERROR)})},e}(ve),ye="as_bottom-banner-float",me=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.start=function(t){this.fixedPos=!0,this.showStaticImageButton(t)},e.prototype.createCloseButton=function(){var t=this,e=N("div",L);return e.addEventListener("click",function(){t.sendCloseReport(),t.end(K.USER_CLICK)}),e},e.prototype.showStaticImageButton=function(n){var r=this,o=this.adItem.creative.mediaFile;pe(o,function(){if(r.reportCreativeFetchResult(o,!1),!r.isExit){r.buildPlayerDOM();var t=r.playerDOM;r.initPlayerDom(t),r.createADLogoIfNeed(),t.classList.add(ye),r.createCloseButtonIfNeed(t,!1);var e=x({url:o,width:848,height:145});k(e);var i=N("div",null,[e]);t.appendChild(i),n.appendChild(t),r.afterAppend()}},function(){r.reportCreativeFetchResult(o,!0),r.end(K.CREATIVE_ERROR)})},e.prototype.createADLogoIfNeed=function(){this.adItem.hideADLogo||this.playerDOM.appendChild(N("div",ye+"_ad-logo","广告"))},e}(ve),ge=function(i){function t(t,e){return i.call(this,t,e)||this}return u(t,i),t.prototype.start=function(t){this.showDynamicImageButton(t)},t.prototype.exit=function(t){i.prototype.exit.call(this,t),clearInterval(this.animateTask)},t.prototype.showDynamicImageButton=function(r){var o=this,t=this.adItem.creative,e=t.mediaFile,s=t.width,a=t.height,u=e.split("|||"),p=u.length,c=0;u.forEach(function(e){pe(e,function(){return function(t){if(o.reportCreativeFetchResult(t,!1),!o.isExit&&(c+=1)===p){o.buildPlayerDOM();var e=o.playerDOM;o.initPlayerDom(e,s),o.createCloseButtonIfNeed(e,!0);var i=x({width:s,height:a});k(i);var n=N("div",null,[i]);e.appendChild(n),r.appendChild(e),o.startImageAnimationTask(u,i.querySelector(".adsdk_image")),o.afterAppend()}}(e)},function(){return t=e,o.reportCreativeFetchResult(t,!0),void o.end(K.CREATIVE_ERROR);var t})})},t.prototype.startImageAnimationTask=function(e,i){var t=this,n=e.length,r=0,o=function(){var t=e[r%n];i.style.backgroundImage="url("+t+")",r+=1},s=function(){t.isExit?i.removeEventListener("animationiteration",s):o()};i.addEventListener("animationiteration",s,!1),o(),i.classList.add("as_animate-float")},t}(ve),Ee=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.start=function(t){this.showStaticImageButton(t)},e.prototype.showStaticImageButton=function(s){var a=this,t=this.adItem,e=t.creative,u=t.adStyle,p=e.mediaFile;pe(p,function(){if(a.reportCreativeFetchResult(p,!1),!a.isExit){a.buildPlayerDOM();var t=a.playerDOM,e=u===z.SPECIAL_IMAGE,i=a.getCreativeRealSize(e),n=i.width,r=i.height;a.initPlayerDom(t,n),t.classList.add("as_static-float");var o=x({url:p,width:n,height:r});k(o),a.createCloseButtonIfNeed(t,u!==z.NORMAL_IMAGE),t.appendChild(N("div",null,[o])),s.appendChild(t),a.afterAppend()}},function(){a.reportCreativeFetchResult(p,!0),a.end(K.CREATIVE_ERROR)})},e.prototype.getCreativeRealSize=function(t){return t?{width:250,height:80}:{width:120,height:90}},e}(ve),Ie="as_img-text-float",Te=Ie+"_label",Ce=Te+"-back",Le=function(i){function t(t,e){return i.call(this,t,e,se)||this}return u(t,i),t.prototype.start=function(s,t){var a=this,u=this.adItem.creative,p=u.mediaFile,e=u.mediaType;if(/^image\//.test(e)){pe(p,function(){if(!a.isExit){a.buildPlayerDOM();var t=a.generateImageElement(p),e=b("span",Ie+"_label",u.title),i=N("div",Ce,[e]);if(a.canClose){a.playerDOM.classList.add(ee.OUTTER_CLOSE_CLASS);var n=a.createCloseButton();a.playerDOM.appendChild(n)}var r=N("div",Te+"-mask",[i]),o=N("div","as_img-text-float_container",[t,r]);a.playerDOM.appendChild(o),s.appendChild(a.playerDOM),setTimeout(function(){i.classList.add(Ce+"--show")},0),a.reportCreativeFetchResult(p,!1),a.afterAppend()}},function(){a.reportCreativeFetchResult(p,!0),a.end(K.CREATIVE_ERROR)})}},t.prototype.generateImageElement=function(t){var e=U(t,Ie+"_img");return k(e),e},t}(ee),Re=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.parse=function(t){var e=t.nonLinear.vote;e&&(this.voteInfo=new Ut(e))},e}(lt),De="as-vote-float",Ae=De+"_vote-txt",_e=De+"_vote-item",Pe=function(n){function t(t,e){var i=n.call(this,t,e,Re)||this;return i.fixedPos=!0,i.voteManager=new Ft(i.adItem.creative.voteInfo.options),i}return u(t,n),t.prototype.start=function(o,t){var s=this,e=this.adItem.creative;if(e&&e.voteInfo){var a=e.voteInfo,u=a.banner;pe(u,function(){if(!s.isExit){s.buildPlayerDOM();var t=s.playerDOM;if(s.initPlayerDom(t,865),t.classList.add(De),t.classList.add(ee.OUTTER_CLOSE_CLASS),s.canClose){var e=s.createCloseButton();t.appendChild(e)}var i=x({url:u,width:865,height:150});k(i);var n=s.createBottomBanner(a),r=[s.createVoteList(a),i,n];t.appendChild(N("div",De+"_content",r)),o.appendChild(t),s.reportCreativeFetchResult(u,!1),s.afterAppend()}},function(){s.reportCreativeFetchResult(u,!0),s.end(K.CREATIVE_ERROR)})}},t.prototype.createVoteItems=function(t){var e=t.options,p=t.color;return e.map(function(t){var e=t.image,i=t.content,n=t.sdkId,r=U(e,De+"_vote-img"),o=N("div",De+"_vote-name",i),s=N("div",De+"_vote-mask");r.appendChild(s),r.appendChild(o);var a=N("div",Ae,"投票");a.style.backgroundColor="#"+p;var u=N("div",_e,[r,a]);return u.dataset.id=n,u})},t.prototype.createVoteList=function(t){var u=this,e=this.createVoteItems(t),p=N("div",De+"_vote-wrapper",e),c=function(t){var e=t.target;if(e)for(var i=p.querySelectorAll("."+_e),n=i.length,r=0;r<n;r+=1){var o=i[r];if(o.contains(e)){p.removeEventListener("click",c);var s=o.dataset.id;u.voteManager.addVote(s);var a=u.voteManager.getVoteInfo(s).voteUri;u.sendADReportEvent(H(a)),u.renderCounterInfo()}}};return p.addEventListener("click",c),p},t.prototype.renderCounterInfo=function(){var t=this.voteManager.getRatiosInfo(),i=t.ratios,n=t.maxItemId,e=this.playerDOM.querySelectorAll("."+_e);[].forEach.call(e,function(t){var e=t.dataset.id;null!==i[e]&&(t.querySelector("."+Ae).innerText=i[e]+"%");e===n&&(t.classList.add(_e+"--top"),t.classList.add(T))})},t.prototype.createBottomBanner=function(t){var e=t.title,i=t.icon,n=t.color,r=U(i,De+"_icon"),o=N("div",De+"_title",e);o.style.backgroundColor="#"+n;var s=N("div",De+"_bottom-content",[r,o]);return b("div",De+"_bottom",[s])},t.prototype.initPlayerDom=function(t,e){t.classList.add("as-float-image-button__wrapper"),t.style.maxWidth=e+"px";var i=100*e/1920;t.style.width=i+"%"},t}(ee),Oe="https://web.da.mgtv.com",Se="https://web2.da.mgtv.com",we=window,Ne={jsonpCallback:"callback",timeout:5e3};function Me(){return"jsonp_"+Date.now()+"_"+Math.ceil(1e5*Math.random())}function ke(e){try{delete we[e]}catch(t){we[e]=void 0}}function be(t,e,i){var n,r;i&&clearTimeout(i),ke(t),n=e,(r=document.getElementById(n))&&document.getElementsByTagName("head")[0].removeChild(r)}function xe(t,e){var i,n,r=-1===t.indexOf("?")?"?":"&";return""+t+r+(n=[],(i=e)&&Object.keys(i).forEach(function(t){n.push(encodeURIComponent(t)+"="+encodeURIComponent(i[t]))}),n.join("&"))}function Ue(t){var e,i=t.url,n=t.data,r=t.options,o=t.onSuccess,s=t.onFail,a=I({},Ne,r),u=a.timeout,p=a.jsonpCallback,c=a.charset,d=a.jsonpCallbackFunction,h=(void 0===d?Me():d)||Me(),l=p+"_"+h,v=window.setTimeout(function(){be(h,l),we[h]=function(){ke(h)},s&&s({code:ce.TIMEOUT})},u);we[h]=function(t){be(h,l,v),o&&o(t)};var f,y=xe(i,I({},n,((e={})[p]=h,e))),m=N("script");m.setAttribute("src",y),c&&m.setAttribute("charset",c),m.id=l,m.onerror=function(){be(h,l,v),s&&s({code:ce.NETWORK})},f=m,document.getElementsByTagName("head")[0].appendChild(f)}(de=ce||(ce={})).TIMEOUT="timeout",de.NETWORK="network";var Be=new(function(){function t(){this.keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}return t.prototype.encode=function(t,e){var i,n,r,o,s,a,u,p=this,c="",d=0;for(e||(t=this._utf8_encode(t));d<t.length;)o=(i=t.charCodeAt(d++))>>2,s=(3&i)<<4|(n=t.charCodeAt(d++))>>4,a=(15&n)<<2|(r=t.charCodeAt(d++))>>6,u=63&r,isNaN(n)?a=u=64:isNaN(r)&&(u=64),[o,s,a,u].forEach(function(t){c+=p.keyStr.charAt(t)});return c},t.prototype.decode=function(t){var e,i,n,r,o,s,a="",u=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");u<t.length;)e=this.keyStr.indexOf(t.charAt(u++))<<2|(r=this.keyStr.indexOf(t.charAt(u++)))>>4,i=(15&r)<<4|(o=this.keyStr.indexOf(t.charAt(u++)))>>2,n=(3&o)<<6|(s=this.keyStr.indexOf(t.charAt(u++))),a+=String.fromCharCode(e),64!==o&&(a+=String.fromCharCode(i)),64!==s&&(a+=String.fromCharCode(n));return a=this._utf8_decode(a)},t.prototype._utf8_encode=function(t){if(/^[\x00-\x7f]*$/.test(t))return t;for(var e=[],i=t.length,n=0,r=0;n<i;++n,++r){var o=t.charCodeAt(n);if(o<128)e[r]=t.charAt(n);else if(o<2048)e[r]=String.fromCharCode(192|o>>6,128|63&o);else{if(!(o<55296||57343<o)){if(n+1<i){var s=t.charCodeAt(n+1);if(o<56320&&56320<=s&&s<=57343){var a=65536+((1023&o)<<10|1023&s);e[r]=String.fromCharCode(240|a>>18&63,128|a>>12&63,128|a>>6&63,128|63&a),++n;continue}}throw new Error("Malformed string")}e[r]=String.fromCharCode(224|o>>12,128|o>>6&63,128|63&o)}}return e.join("")},t.prototype._utf8_decode=function(t){for(var e="",i=0,n=0,r=0,o=0;i<t.length;)(n=t.charCodeAt(i))<128?(e+=String.fromCharCode(n),i++):191<n&&n<224?(r=t.charCodeAt(i+1),e+=String.fromCharCode((31&n)<<6|63&r),i+=2):(r=t.charCodeAt(i+1),o=t.charCodeAt(i+2),e+=String.fromCharCode((15&n)<<12|(63&r)<<6|63&o),i+=3);return e},t}());function Ve(t){return function t(e){var i,n,r=Object.create(null);function o(t,e){var i=t.charAt(0).toLowerCase()+t.slice(1);if(r[i]){var n=r[i];Array.isArray(n)||(r[i]=[n]),r[i].push(e)}else r[i]=e}for(i=0;n=e.attributes[i];i++)o(n.name,n.value);for(i=0;n=e.childNodes[i];i++)1===n.nodeType?o(n.nodeName,t(n)):3!==n.nodeType&&4!==n.nodeType||o("content",n.data);return r}((e=t,DOMParser?i=(new DOMParser).parseFromString(e,"text/xml"):((i=new ActiveXObject("Microsoft.XMLDOM")).async="false",i.loadXML(e)),i).firstChild);var e,i}var Fe=2654435769;function He(t){return 4294967295&t}function We(t,e,i,n,r,o){return(i>>>5^e<<2)+(e>>>3^i<<4)^(t^e)+(o[3&n^r]^i)}function Ge(t,e){var i,n=t.length,r=n>>2;0!=(3&n)&&++r,e?(i=new Array(r+1))[r]=n:i=new Array(r);for(var o=0;o<n;++o)i[o>>2]|=t.charCodeAt(o)<<((3&o)<<3);return i}function Ye(t,e){if(t&&"string"==typeof t){var i=function(t,e){var i=t.length,n=i<<2;if(e){var r=t[i-1];if(r<(n-=4)-3||n<r)return null;n=r}for(var o=[],s=0;s<i;s++)o[s]=String.fromCharCode(255&t[s],t[s]>>>8&255,t[s]>>>16&255,t[s]>>>24&255);var a=o.join("");return e?a.substring(0,n):a}(function(t,e){var i,n,r,o,s,a,u=t.concat(),p=u.length,c=p-1;for(n=u[c],a=(r=0)|Math.floor(6+52/p);0<a;--a){for(o=(r=He(r+Fe))>>>2&3,s=0;s<c;++s)i=u[s+1],n=u[s]=He(u[s]+We(r,i,n,s,o,e));i=u[0],n=u[c]=He(u[c]+We(r,i,n,c,o,e))}return u}(Ge(t,!0),((n=Ge(e,!1)).length<4&&(n.length=4),n)),!1);return Be.encode(i,!0)}var n;return t}function je(t){var e=m();if(e){var i=e.did;return{au:Ye(Math.round(Date.now()/1e3)+"|"+i,t),auver:"v1"}}}var Ke,qe,ze,Je,Qe=new(function(){function t(){}return t.prototype.update=function(t){this.data=t},t.prototype.getInfo=function(){return this.data},t}()),Xe=null;function Ze(t){if(!t&&Xe)return Xe;var e,i,n=navigator.userAgent.toLowerCase(),r=m(),o=I({},r,{os:s(),platform:(i=navigator.userAgent,h(i)?Ke.IPAD:p(i)?Ke.IPHONE:a(i)?Ke.ANDROID:Ke.PC),player:(e=navigator.userAgent,h(e)?ze.PAD:p(e)||a(e)?ze.PHONE:ze.PC),ua:n});return Xe=I({},o),o}(qe=Ke||(Ke={}))[qe.IPAD=23]="IPAD",qe[qe.IPHONE=24]="IPHONE",qe[qe.ANDROID=22]="ANDROID",qe[qe.PC=1]="PC",(Je=ze||(ze={}))[Je.PAD=4482]="PAD",Je[Je.PHONE=4540]="PHONE",Je[Je.PC=4388]="PC";var $e=h(navigator.userAgent)?parseInt("10110111",2):parseInt("10111111",2),ti=function(){function t(t,e,i){void 0===i&&(i="pc/player"),this.mgPlayer=e,this.apiURL=i,this.stop=!1,this.reqTime=0,this.initReqParams(t)}return t.prototype.setBeforeLoad=function(t){this.beforeLoad=t},t.prototype.load=function(i,n,r){var o=this;this.reqTime+=1;var t=this.reqTime,e=this.apiURL,s=t-1;if(!(1<s)){var a=0<s,u=1===s,p=(a?Se:Oe)+"/"+e;this.beforeLoad&&this.beforeLoad(p,a);var c=5e3+1e3*s,d=this.params,h=d.mediaInfo,l=d.basicInfo,v=d.id,f=d.au,y=d.auver,m=JSON.stringify(I({},l,{retry:a?1:0})),g=JSON.stringify(h),E=JSON.stringify(v);Ue({url:p,data:{v:g,p:m,id:E,au:f,auver:y},options:{timeout:c},onSuccess:function(t){if(t&&t.v){if(!o.stop&&i){var e=null;try{e=Ve(t.v)}catch(t){return n.call(r,{code:104e3,url:p,isLast:u}),void o.load(i,n,r)}i.call(r,e,{url:p,isLast:u})}}else n.call(r,{code:103e3,url:p,isLast:u}),o.load(i,n,r)},onFail:function(t){var e=t.code===ce.TIMEOUT?105e3:101500;n.call(r,{code:e,url:p,isLast:u}),o.load(i,n,r)}})}},t.prototype.initReqParams=function(t){var e=I({},Ze(!1),{isContinue:0},t),i=Qe.getInfo(),n={p:e.player,aid:Number(e.aid),time:e.time||0,allowad:110110,ptype:e.adType,pu:i.info.url};0<e.trigger_time&&(n.trigger_time=e.trigger_time);var r={cxid:e.cxid,ck:e.did,sid:e.sessionid,id:Number(i.user.uid),vip:Number(i.user.isvip),isContinue:e.isContinue?1:0},o=window.screen.width+"*"+window.screen.height,s={type:e.platform,os:e.os,ua:e.ua,version:e.wver,rs:o,bs:this.getPlayerInfo(),did:e.did,mac:i.user.mac||""},a={sdkversion:f,_v:"1",fmt:"vast3",parameter:$e,float_ex:5,m:n,u:r,c:s};e.adType===Y.FRONT&&i.atc&&(a.atc={pm2:i.atc.pm2,tk2:function(e){var i=[];Object.keys(e).forEach(function(t){i.push(t+"="+e[t])});var t=i.join("|"),n=Be.encode(t);n=(n=(n=n.replace("+","_")).replace("/","~")).replace("=","-");for(var r="",o=0;o<n.length;o++)r=r.concat(n.charAt(n.length-o-1));return r}("clit="+Date.now())});var u={v:{hid:Number(i.info.collection_id),id:Number(i.info.video_id),rid:Number(i.info.root_id),url:i.info.url,on_date:"",clip_type:Number(i.info.clip_type),vtt:Number(i.info.duration),ispreview:0,ispay:0,vip:Number(i.user.isvip),uname:"",ucode:""}};this.params=I({basicInfo:a,id:{id:e.sessionid},mediaInfo:u},je(e.sessionid))},t.prototype.getPlayerInfo=function(){var t=this.mgPlayer;try{if(t){var e=t.getVideoSize();if(e)return e.width+"*"+e.height}}catch(t){console.log("getVideoSize error: "+t)}return null},t}(),ei=function(){function t(t,e){this.eventBus=t,this.mgPlayer=e}return t.prototype.createPlayer=function(t,o,s){var a=this,e=t.id,i=t.isFixed,n=t.time,r={aid:e,adType:Y.FLOAT};i&&(r.trigger_time=n);new ti(r,this.mgPlayer).load(function(t,e){var i=e.url;if(t&&t.ad&&t.ad.id){var n=a.createButton(t);n&&o(n)}else s({noAD:!0});var r={url:i,e:0,f:0,z:1};a.sendCDNReport(r)},function(t){var e=t.code,i=void 0===e?0:e,n=t.url,r=t.isLast,o={url:n,e:i,f:-1,z:r?1:0};a.sendCDNReport(o),r&&s({})})},t.prototype.createButton=function(t){if(t){var e=t.ad;if(e.adstyle)switch(Number(e.adstyle)){case z.IMAGE_TEXT:return new Le(t,this.eventBus);case z.BUBBLE:return new oe(t,this.eventBus);case z.NORMAL_IMAGE:case z.SPECIAL_IMAGE:return new Ee(t,this.eventBus);case z.DYNAMIC_IMAGE:return new ge(t,this.eventBus);case z.ECommerce:return new le(t,this.eventBus);case z.VOTE:return new Pe(t,this.eventBus);case z.BOTTOM_BANNER:return new me(t,this.eventBus);default:return}else if(e.subType===Q.PLAYER_BANNER)return new fe(t,this.eventBus)}},t.prototype.sendCDNReport=function(t){this.eventBus.dispatch({type:l.CDN_REPORT,data:I({},t,{ptype:Y.FLOAT,s:1})})},t}(),ii=function(){function t(t,e,i){var n=this;this.eventBus=t,this.mgPlayer=e,this.stage=i,this.sendEndPlayerEvent=function(t,e){void 0===e&&(e=K.EXPIRED);var i={type:l.AD_WILL_END,data:{reason:e,player:t}};n.eventBus.dispatch(i)}}return t.prototype.sendShowPlayerEvent=function(t,e,i){void 0===i&&(i=Tt.INNER);var n={type:l.AD_WILL_SHOW,data:{player:t,type:i,layer:e}};this.eventBus.dispatch(n)},t}(),ni={fetching:!1,info:null,showTime:null,duration:null,rollTime:null};function ri(t){if(t){var e=t.rollTime,i=t.duration;return I({},ni,{rollTime:e,duration:i})}return I({},ni)}var oi=function(r){function t(t,e,i){var n=r.call(this,t,e,i)||this;return n.playerLists={idle:[],ready:[],playing:[]},n.factory=new ei(t,e),n}return u(t,r),t.prototype.reset=function(){this.eventBus.removeListener(l.SYNC_PLAY_TIME,this.handlePlayTimeUpdate),this.eventBus.removeListener(l.AD_END,this.onADEnd),this.playerLists={idle:[],ready:[],playing:[]}},t.prototype.setPlayerInfo=function(t){if(!h(navigator.userAgent)){var e=t.ads;this.playerLists.idle=e.map(function(t){return I({},t,{player:ri()})}),this.initEventHandlers()}},t.prototype.initEventHandlers=function(){this.eventBus.addListener(l.SYNC_PLAY_TIME,this.handlePlayTimeUpdate,this),this.eventBus.addListener(l.AD_END,this.onADEnd,this)},t.prototype.onADEnd=function(t){var e=t.data,i=e.player,n=e.reason;if(n===K.USER_CLICK||n===K.CREATIVE_ERROR){var r=G(this.playerLists.playing,function(t){return t.player.info===i});r&&r.deletable&&(this.removeFromList("playing",r),this.removeDeletableItems(r.id))}},t.prototype.handlePlayTimeUpdate=function(t){if(this.mgPlayer.isVideoPlaying){var e=t.data.time;this.endExpiredPlayingPlayers(e),this.endExpiredReadyPlayers(e),this.createPlayers(e),this.showPlayers(e)}},t.prototype.removeDeletableItems=function(i){var t=this.playerLists,e=t.ready,n=t.idle,r=function(t){var e=t.id;return!(t.deletable&&e===i)};t.ready=e.filter(r),t.idle=n.filter(r)},t.prototype.endExpiredPlayingPlayers=function(t){var i=this,e=this.getExpiredPlayerLists(t,!0);W(e)&&e.forEach(function(t){var e=t.player.info;i.sendEndPlayerEvent(e),t.player=ri(t.player),i.changeItemList("playing","idle",t)})},t.prototype.endExpiredReadyPlayers=function(t){var e=this,i=this.getExpiredPlayerLists(t,!1);W(i)&&i.forEach(function(t){t.player=ri(t.player),e.changeItemList("ready","idle",t)})},t.prototype.getExpiredPlayerLists=function(u,p){var t=this.playerLists,e=t.playing,i=t.ready;return(p?e:i).filter(function(t){var e=t.player,i=t.isFixed,n=t.time,r=e.showTime,o=e.duration;if(e.info){var s=i?n:r,a=s+o<=u;return p?a||u<s:a||u<s-5}return!1})},t.prototype.createPlayers=function(e){var i=this,t=this.getPlayerCreateList(e);W(t)&&t.forEach(function(t){return i.createADPlayer(t,e)})},t.prototype.createADPlayer=function(a,u){var p=this,t=a.id,c=a.time,d=a.isFixed,h=a.player;h.fetching=!0;var e={id:t,time:c,isFixed:d};this.factory.createPlayer(e,function(t){var e=t.rollTime,i=t.adItem.creative.duration;if(i){if(h.duration=i,!d){e&&(h.rollTime=e);var n=u-c;if(n<0)h.showTime=c;else{var r=i+e,o=n%r,s=n/r;h.showTime=r-5<=o?Math.ceil(s)*r+c:Math.floor(s)*r+c}}h.info=t,h.fetching=!1,p.changeItemList("idle","ready",a)}},function(t){var e=t.noAD;h.fetching=!1,(d?e:null==h.duration)&&p.removeFromList("idle",a)})},t.prototype.getPlayerCreateList=function(c){return this.playerLists.idle.filter(function(t){var e=t.time,i=t.isFixed,n=t.player,r=n.fetching,o=n.duration,s=n.rollTime;if(r)return!1;var a=Math.abs(c-e);if(i)return a<=5;if(null==o||null==s)return e<=c;var u=o+s,p=a%u;return p<=5||u-5<=p})},t.prototype.showPlayers=function(t){var e=this,i=this.getWillShowPlayer(t);W(i)&&i.forEach(function(t){e.changeItemList("ready","playing",t),e.sendShowPlayerEvent(t.player.info,gt.NORMAL)})},t.prototype.getWillShowPlayer=function(r){return this.playerLists.ready.filter(function(t){var e=t.isFixed,i=t.time,n=t.player;return(e?i:n.showTime)-r<=.3})},t.prototype.changeItemList=function(t,e,i){this.removeFromList(t,i),this.addToList(e,i)},t.prototype.removeFromList=function(t,e){var i=this.playerLists,n=i[t];i[t]=n.filter(function(t){return t!==e})},t.prototype.addToList=function(t,e){var i=this.playerLists,n=i[t];i[t]=n.concat(e)},t}(ii),si=function(n){function t(t){var e=this;if(t&&t.linear){var i=t.linear;(e=n.call(this,i)||this).parse(i)}return e}return u(t,n),t.prototype.parse=function(t){var e=t.videoClicks,i=t.mediaFiles,n=t.button;if(e){var r=e.clickThrough,o=e.clickTracking;if(this.clickThrough=r?r.content:"",o){var s=H(o);this.saveClickTracking(s)}}if(i&&i.mediaFile){var a=i.mediaFile,u=a.content,p=a.type,c=a.width,d=a.height;this.mediaFile=u,this.mediaType=p,this.width=Number(c),this.height=Number(d)}n&&n.title&&(this.clickBtnTxt=n.title.content)},t}(ht),ai=function(){function t(t){var r=this;this.sdkId=ot("video_companion"),this.trackingEvents={};var e=t.type,i=t.trackingEvents,n=t.duration;this.type=e,i&&i.tracking&&H(i.tracking).forEach(function(t){var e=t.content,i=t.event,n={url:e};r.addTracking(i,n)}),n&&(this.duration=pt(n.content))}return t.prototype.addTracking=function(t,e){this.trackingEvents[t]||(this.trackingEvents[t]=[]),this.trackingEvents[t].push(e)},t}(),ui=function(h){function t(t){var e=h.call(this,t)||this,i=t.adSlotId,n=t.t,r=void 0===n?"0":n,o=t.assetHeight,s=void 0===o?"0":o,a=t.assetWidth,u=void 0===a?"0":a,p=t.width,c=t.height,d=t.staticResource;t.duration;return e.slotId=i,e.time=Number(r),e.position={top:Number(s),left:Number(u)},e.width=Number(p),e.height=Number(c),d&&(e.mediaURL=d.content),e}return u(t,h),t}(ai);var pi=function(a){function t(t){var e=a.call(this,t)||this,i=t.id,n=t.width,r=t.height,o=t.staticResource,s=t.companionClickThrough;return e.id=i,e.width=Number(n),e.height=Number(r),e.interactType=function(t){var e=$.H5;if(t&&t.creativeType){var i=t.creativeType;/^image/.test(i)?e=$.IMG:/^video/.test(i)&&(e=$.VIDEO)}return e}(o),e.mediaURL=o.content,e.jumpURL=s.content,e}return u(t,a),t}(ai),ci=function(n){function t(t){var e=n.call(this,t)||this,i=t.staticResource;return e.mediaURL=i.content,e}return u(t,n),t}(ai),di=function(i){function t(t){var e=i.call(this,t)||this;return e.parseADInfo(t),e.parseCompanions(t),e}return u(t,i),t.prototype.parseCreative=function(t){return new si(t)},t.prototype.parseADInfo=function(t){t&&null!=t.skip&&(this.skip=Number(t.skip)),this.startTime=Number(t.t)},t.prototype.parseCompanions=function(t){if(t&&t.inLine&&t.inLine.creatives.creative.companionAds){var e=t.inLine.creatives.creative.companionAds,i=e.companions,n=e.companion,r=i&&i.companion||n;r&&(this.companions=H(r).map(function(t){var e=t.type;return e===et.BUTTON?new ui(t):e===et.INTERACT?new pi(t):e===et.PREVIEW?new ci(t):void 0}))}},t}(St),hi=function(i){function t(t,e){var n=i.call(this,e)||this;return n.currentADIndex=-1,n.showModalIndex=-1,n.adItems=[],n.eventReportRecorder={},n.adReportRecorder={},n.isExit=!1,n.startPlay=!1,n.onVisibilityChange=function(){"visible"!==document.visibilityState||n.isPause||n.video.resume()},n.parse(t),n.duration=n.getDuration(),n.adItems.forEach(function(t){var e=t.creative.id,i=t.sdkId;n.eventReportRecorder[e]=[],n.adReportRecorder[i]=[]}),n}return u(t,i),t.prototype.show=function(){},t.prototype.hide=function(){},t.prototype.interrupt=function(){this.stopTimeOutTasks(),this.disposeVideo()},t.prototype.initVideoEvents=function(){var t=this.video,e=this.eventbus;document.addEventListener("visibilitychange",this.onVisibilityChange),e.addListener(v.TIME_UPDATE,this.onTimeUpdate,this),e.addListener(v.UNMUTE,this.onUnmute,this),e.addListener(v.MUTE,this.onMute,this),e.addListener(v.JUMP_CLICK,this.onADClick,this),e.addListener(v.SKIP,this.onSkip,this),e.addListener(v.PAUSE,this.onPause,this),e.addListener(v.RESUME,this.onResume,this),t.addEventListener("ended",this.onEnded,this),t.addEventListener("timeupdate",this.onBroadTimeUpdate,this),t.addEventListener("error",this.onError,this)},t.prototype.onPause=function(){this.isPause=!0,clearTimeout(this.suspendTimeOutTask)},t.prototype.updateModalIfNeed=function(){var t=this.showModalIndex,e=this.currentADIndex,i=this.modal,n=this.startPlay;t!==e&&i&&n&&(this.showModalIndex=e,i.changeADIndex(e))},t.prototype.onResume=function(){this.isPause=!1,this.startSuspendTimeOutTask()},t.prototype.onSkip=function(){this.stopTimeOutTasks(),this.sendADItemReport(this.getPlayingItem(),"adLost"),this.playNext()},t.prototype.onEnded=function(){this.stopTimeOutTasks(),this.sendCreativeItemADReport(this.getCurrentCreative(),[X.COMPLETE]),this.playNext()},t.prototype.onPlaying=function(){var t=this.currentADIndex;0<t&&(this.stopListenForLoadTimeout(),this.reportADItemImpression(t))},t.prototype.onADPlay=function(){this.startPlay||(this.startPlay=!0,this.video.removeEventListener("error"),this.updateModalIfNeed(),this.onPlaying())},t.prototype.reportFirestOneImpression=function(){this.reportADItemImpression(0)},t.prototype.reportADItemImpression=function(t){var e=this.adItems[t];this.sendADItemReport(e,"impression"),this.sendCreativeItemADReport(e.creative,[X.START])},t.prototype.onTimeUpdate=function(t){var e=t.data,i=e.currentTime,n=e.duration;0<i&&this.startSuspendTimeOutTask();var r=this.getCurrentCreative();if(r){var o=r.id,s=r.trackingEvents,a=i/n,u=this.eventReportRecorder[o],p=[];.25<=a&&-1===u.indexOf(X.FIRSTQUARTILE)&&p.push(X.FIRSTQUARTILE),.5<=a&&-1===u.indexOf(X.MIDPOINT)&&p.push(X.MIDPOINT),.75<=a&&-1===u.indexOf(X.THIRDQUARTILE)&&p.push(X.THIRDQUARTILE);var c=s[X.SKIP];if(c)for(var d=0,h=c;d<h.length;d++){var l=h[d],v=l.skip,f=l.url;if(v<=i){var y="skip_"+v+"_"+f;-1===u.indexOf(y)&&p.push(I({},l,{eventName:y}))}}W(p)&&this.sendCreativeItemADReport(r,p)}},t.prototype.onADClick=function(t){var e=this.getCurrentCreative();e.clickThrough&&this.sendCreativeItemADReport(e,[X.CLICK],!0,t.data)},t.prototype.onMute=function(){this.sendCreativeItemADReport(this.getCurrentCreative(),[X.MUTE])},t.prototype.onUnmute=function(){this.sendCreativeItemADReport(this.getCurrentCreative(),[X.UNMUTE])},t.prototype.sendCreativeItemADReport=function(t,e,n,r){var o=this,i=t.id,s=t.trackingEvents,a=this.eventReportRecorder[i];e.forEach(function(t){var e=t;if("string"==typeof t){var i=s[t];i&&o.sendADReportEvent(i.map(function(t){return t.url}),r)}else o.sendADReportEvent([t.url],r),e=t.eventName;n||a.push(e)})},t.prototype.sendADItemReport=function(t,e,i){var n=t.sdkId,r=t.creative,o=this.adReportRecorder[n];"impression"===e?-1===o.indexOf(e)&&t.impressionUrls&&(this.sendADReportEvent(t.impressionUrls),o.push(e)):"error"===e&&t.errorUrls?this.sendADReportEvent(t.errorUrls,I({},i,{url:r.mediaFile})):"adLost"===e&&t.adLostUrls&&this.sendADReportEvent(t.adLostUrls,I({},i,{url:r.mediaFile}))},t.prototype.parse=function(t){var e=H(t.ad);this.adItems=e.map(function(t){return new di(t)})},t.prototype.onFinishPlay=function(t){void 0===t&&(t=K.EXPIRED);var e={type:l.AD_WILL_END,data:{player:this,reason:t}};this.eventbus.dispatch(e)},t.prototype.onCreativeTimeOut=function(t,e,i){var n=e.errorUrls,r=e.creative.mediaFile;if(n){var o=i+"_timeout";this.sendADReportEvent(n,{ERRORURL:r,ERRORMSG:o,ERRORCODE:301001})}},t.prototype.getCurrentCreative=function(){var t=this.currentADIndex,e=this.adItems[t];if(e)return e.creative},t.prototype.playNext=function(){this.isExit||(this.currentADIndex+=1,this.video.playNext()?(this.updateModalIfNeed(),0<this.currentADIndex&&this.startLoadDataTimeOutTask(),this.eventbus.dispatch({type:l.PLAYER_LOG,data:{msg:"Video AD playNext: "+this.currentADIndex}})):(this.onFinishPlay(),this.eventbus.dispatch({type:l.PLAYER_LOG,data:{msg:"Video AD Finished"}})))},t.prototype.initVideoPlayer=function(t){this.video=t.getVideo(),this.initVideoEvents();var e={urls:this.getUrls()};this.video.initUrls(e)},t.prototype.getDuration=function(){return this.adItems.reduce(function(t,e){var i=e.creative;return i&&(t+=i.duration),t},0)},t.prototype.getUrls=function(){return this.adItems.map(function(t){var e=t.creative,i={};if(e){var n=e.mediaFile,r=e.duration,o=e.clickThrough;i.url=n,i.duration=r,i.showdetail=""!==o,i.jump=o}return i})},t.prototype.getPlayingItem=function(){return this.adItems[this.currentADIndex]},t.prototype.onError=function(){this.stopTimeOutTasks(),this.sendADItemReport(this.getPlayingItem(),"error",{ERRORCODE:301003,ERRORMSG:"video_error"}),this.playNext()},t.prototype.disposeVideo=function(){this.isExit=!0,this.modal.destroy();var t=this.video,e=this.eventbus;document.removeEventListener("visibilitychange",this.onVisibilityChange),t&&(t.removeEventListener("playing"),t.removeEventListener("ended"),t.removeEventListener("timeupdate"),t.removeEventListener("error"),t.removeEventListener("stalled"),t.removeEventListener("pause"),t.removeEventListener("resume"),t.dispose&&t.dispose(),this.video=null),e.removeEvents(v.TIME_UPDATE),e.removeEvents(v.UNMUTE),e.removeEvents(v.MUTE),e.removeEvents(v.JUMP_CLICK),e.removeEvents(v.SKIP)},t.prototype.stopTimeOutTasks=function(){this.stopListenForLoadTimeout(),clearTimeout(this.suspendTimeOutTask)},t.prototype.startSuspendTimeOutTask=function(){var t=this;if(!this.isPause){var e=this.currentADIndex,i=this.suspendTimeOutTask;clearTimeout(i),this.suspendTimeOutTask=window.setTimeout(function(){t.logCreativeTimeout(e,"suspend"),t.playNext()},5e3)}},t.prototype.stopListenForLoadTimeout=function(){clearTimeout(this.loadDataTimeOutTask),this.eventbus.removeListener(v.TIME_UPDATE,this.listenForLoadTimeout)},t.prototype.startLoadDataTimeOutTask=function(){var t=this;this.stopListenForLoadTimeout();var e=this.currentADIndex;this.loadDataTimeOutTask=window.setTimeout(function(){t.logCreativeTimeout(e,"load"),t.playNext()},5e3),this.eventbus.addListener(v.TIME_UPDATE,this.listenForLoadTimeout,this)},t.prototype.listenForLoadTimeout=function(t){0<t.data.currentTime&&this.onPlaying()},t.prototype.logCreativeTimeout=function(t,e){this.onCreativeTimeOut(t,this.adItems[t],e);var i="Video AD "+t+" "+e+"_timeout";this.eventbus.dispatch({type:l.PLAYER_LOG,data:{msg:i}})},t.prototype.onBroadTimeUpdate=function(){var t=this.video,e=t.getVideoProperty("currentTime"),i=t.getVideoProperty("duration");this.eventbus.dispatch({type:v.TIME_UPDATE,data:{currentTime:e,duration:i}})},t}(Ht),li=function(){function t(){}return t.prototype.destroy=function(){this.dom=null},t}(),vi=function(i){function t(t){var e=i.call(this)||this;return e.components=[],e.dom=N("div",t),e}return u(t,i),t.prototype.addComponents=function(t){var e=this;t.forEach(function(t){e.dom.appendChild(t.dom),e.components.push(t)})},t.prototype.destroy=function(){this.components.forEach(function(t){return t.destroy()}),i.prototype.destroy.call(this)},t}(li),fi=function(s){function t(t){var e=t.jumpURL,i=t.jumpBtnTxt,n=void 0===i?"了解详情":i,r=s.call(this)||this,o=b("a",null,n);return o.target="_blank",o.href=e,r.link=o,r.dom=N("div",D+" "+A,[r.link]),r}return u(t,s),t.prototype.destroy=function(){s.prototype.destroy.call(this),this.link=null},t}(li),yi=function(n){function t(t,e){var i=n.call(this)||this;return i.mgPlayer=t,i.eventBus=e,i.eventBus.addListener(d.C_RESIZE,i.setIconClass,i),i.icon=N("i"),i.setIconClass(),i.dom=N("div",D+" "+_,[i.icon]),i.dom.addEventListener("click",function(){i.handleClickBtn()}),i}return u(t,n),t.prototype.destroy=function(){n.prototype.destroy.call(this),this.icon=null,this.eventBus.removeListener(d.C_RESIZE,this.setIconClass)},t.prototype.handleClickBtn=function(){var t=this.mgPlayer;t&&(this.isFullScreen()?t.exitFullScreen():t.fullScreen())},t.prototype.setIconClass=function(){var t=this.isFullScreen()?T+"--normal-screen":T+"--full-screen";this.icon.className=T+" "+t},t.prototype.isFullScreen=function(){var t=this.mgPlayer;return!!t&&t.isFullScreen},t}(li),mi=function(o){function t(t,e){var i=o.call(this)||this;i.info=t,i.eventBus=e,i.dom=N("div",D+" "+_+" "+R+"_timer");var n=t.current,r=t.remain;return i.render(n+r),i.bindEventHandlers(),i}return u(t,o),t.prototype.destroy=function(){this.eventBus.removeListener(v.TIME_UPDATE,this.onTimeUpdate)},t.prototype.bindEventHandlers=function(){this.eventBus.addListener(v.TIME_UPDATE,this.onTimeUpdate,this)},t.prototype.onTimeUpdate=function(t){var e=t.data,i=e.duration,n=e.currentTime,r=Math.floor(i);if(!isNaN(r)){var o=r-Math.floor(n);this.render(Math.max(o,0)+this.info.remain)}},t.prototype.render=function(t){this.dom.innerText=""+t},t}(li),gi=R+"_skip",Ei=function(r){function t(t,e){var i=r.call(this)||this;i.info=t,i.eventBus=e,i.dom=N("div",D+" "+A+" "+gi);var n=t.skip;return t.skipCountDown?i.renderContent(n):i.dom.style.display="none",0<n&&i.bindVideoEventHandlers(),i}return u(t,r),t.prototype.destroy=function(){r.prototype.destroy.call(this),this.removeVideoEventHandlers()},t.prototype.renderContent=function(t){var e=this,i=this.info.skipTipTxt,n=this.dom;if(0<t){var r=6+i.length;n.innerText="您可在"+t+"秒后"+i,n.style.width=r+"em"}else{n.classList.add(gi+"--enable"),n.innerHTML=i+' <i class="'+T+" "+T+'--close"></i>';r=2+i.length;n.style.width=r+"em",n.addEventListener("click",function(){e.eventBus.dispatch({type:v.SKIP,data:{adItem:e.info.id}})})}},t.prototype.bindVideoEventHandlers=function(){this.eventBus.addListener(v.TIME_UPDATE,this.onTimeUpdate,this)},t.prototype.removeVideoEventHandlers=function(){this.eventBus.removeListener(v.TIME_UPDATE,this.onTimeUpdate)},t.prototype.onTimeUpdate=function(t){var e=t.data.currentTime,i=Math.floor(e);if(!isNaN(i)){var n=this.info,r=n.skip,o=n.skipCountDown,s=r-i;s<=0?(this.dom.style.display="",this.removeVideoEventHandlers(),this.renderContent(0)):o&&this.renderContent(s)}},t}(li),Ii="AD_SDK_VIP_INFO",Ti={noad_title:"会员跳过广告",noad_url:"https://order.mgtv.com/pay/pc/index.html"},Ci=new(function(){function t(){this.update()}return t.prototype.update=function(){Ue({url:"https://as.mgtv.com/cms/tips",data:{invoker:"pcweb"},onSuccess:function(t){t&&200===Number(t.status)&&localStorage.setItem(Ii,JSON.stringify(t.msg))}})},t.prototype.getInfo=function(){try{var t=localStorage.getItem(Ii);if(t)return JSON.parse(t)}catch(t){console.log("vip parse error")}return Ti},t}()),Li=function(r){function t(t){var e=r.call(this)||this;e.mgPlayer=t;var i=Ci.getInfo().noad_title,n=N("a","open-vip-dialog",[N("i",T+" "+T+"--vip"),N("span",null,i)]);return n.addEventListener("click",function(){t&&t.isFullScreen&&t.exitFullScreen()}),n.href="javascript:void(0);",n.target="_blank",e.dom=N("div",D+" "+A+" "+R+"_vip",[n]),e}return u(t,r),t.prototype.destroy=function(){this.dom=null},t}(li),Ri=function(n){function t(t,e){var i=n.call(this)||this;return i.mgPlayer=t,i.eventBus=e,i.icon=N("i"),i.dom=N("div",D+" "+_,[i.icon]),i.dom.addEventListener("click",function(){i.handleClickBtn()}),i.setIconClass(i.isMute()),i}return u(t,n),t.prototype.handleClickBtn=function(){var t=this.mgPlayer;if(t){this.isMute()?t.unmute():t.mute();var e=this.isMute();this.setIconClass(e),this.sendClickEvent(e)}},t.prototype.sendClickEvent=function(t){var e=v.MUTE,i=v.UNMUTE,n=t?e:i;this.eventBus.dispatch({type:n})},t.prototype.setIconClass=function(t){var e=t?T+"--mute":T+"--unmute";this.icon.className=T+" "+e},t.prototype.isMute=function(){var t=this.mgPlayer;return!!t&&t.isMute},t}(li),Di=function(){function t(t,e,i,n){this.ads=t,this.stage=e,this.mgPlayer=i,this.eventBus=n}return t.prototype.changeADIndex=function(t){var e=this.ads;this.destroy(),e[t]&&(this.createDOM(e[t],t),this.stage.appendChild(this.dom))},t.prototype.createDOM=function(t,e){var i=this.createModalComponents(t,e);this.dom=N("div",E,i)},t.prototype.createTopBar=function(t){var e=this.eventBus,i=this.mgPlayer,n=this.ads[t].duration,r=new Li(i),o={current:n,remain:this.calculateRemainDuration(t+1)},s=new mi(o,e),a=new vi(P+" "+P+"--top "+O);return a.addComponents([s,r]),a},t.prototype.createBottomBar=function(t,e){var i=this.ads,n=this.mgPlayer,r=this.eventBus,o=i[t],s=[];e||h(navigator.userAgent)||(s.push(new yi(n,r)),s.push(new Ri(n,r))),o.jumpURL&&s.push(new fi(o));var a=new vi(O+" "+R+"_controllers");a.addComponents(s);var u=new vi(P+" "+P+"--bottom"),p=[a];if(null!=o.skip){var c=new Ei(o,r),d=new vi(""+O);d.addComponents([c]),p.unshift(d)}return u.addComponents(p),u},t.prototype.createBackJumpLink=function(t){var e=t.jumpURL,i=b("a",S+" as_video_bg_url");return i.target="_blank",i.href=e,this.bindJumpClickEvent(i),i},t.prototype.bindCompJumpClickEvent=function(t){this.bindJumpClickEvent(t.dom)},t.prototype.calculateRemainDuration=function(t){var e=0,i=this.ads.slice(t);return 0<i.length&&(e=i.reduce(function(t,e){var i=e.duration;return i?t+i:t},0)),e},t.prototype.bindJumpClickEvent=function(e){var i=this;e.addEventListener("click",function(t){Gt(e,t.target)&&i.eventBus.dispatch({type:v.JUMP_CLICK,data:Wt(t)})})},t}(),Ai=function(n){function t(t,e){var i=n.call(this,e)||this;return i.info=t,i.id=i.info.sdkId,i}return u(t,n),t.prototype.start=function(i){var n=this;pe(this.info.mediaURL,function(){n.createDOM(),i.appendChild(n.dom),n.afterAppend()},function(){var t=n.getTrackingEventURLs(X.ERR);if(t){var e=t.map(function(t){return t.url});n.sendADReportEvent(e)}n.exit(i)})},t.prototype.show=function(t){},t.prototype.hide=function(t){},t.prototype.exit=function(t){this.isExit=!0,this.dom&&t.removeChild(this.dom)},t.prototype.interrupt=function(t){this.exit(t)},t.prototype.afterAppend=function(){var t=this.getTrackingEventURLs(X.START);if(t){var e=t.map(function(t){return t.url});this.sendADReportEvent(e)}},t.prototype.createDOM=function(){var r=this,t=this.info,e=t.width,i=t.height,n=t.mediaURL,o=t.position,s=t.slotId,a=x({width:e,height:i,url:n}),u=N("div",R+"_interact-btn",[a]);u.style.maxWidth=e+"px";var p=100*e/848;if(u.style.width=p+"%",o){var c=o.top,d=o.left;u.style.top=c+"%",u.style.left=d+"%"}this.dom=u,this.dom.addEventListener("click",function(t){var e=r.getTrackingEventURLs(X.CLICK);if(e){var i=e.map(function(t){return t.url}),n=Wt(t);r.sendADReportEvent(i,n)}r.eventbus.dispatch({type:v.SHOW_INTERACT,data:{slotId:s}})})},t.prototype.getTrackingEventURLs=function(t){return this.info.trackingEvents[t]},t}(Ht),_i=R+"_interact",Pi=function(n){function t(t,e){var i=n.call(this,e)||this;return i.info=t,i.id=i.info.sdkId,i}return u(t,n),t.prototype.start=function(t,e){var i=this;this.pauseVideoAD(e),this.contentDOM=this.createContent(t,e);var n=N("div","as_fill_player interactive as_video-modal_interact-modal",[this.contentDOM]);n.addEventListener("click",function(t){i.sendEndEvent()}),t.appendChild(n),this.dom=n,this.afterAppend()},t.prototype.show=function(t){},t.prototype.hide=function(t){},t.prototype.exit=function(t,e){this.isExit=!0,this.dom&&(t.removeChild(this.dom),this.resumeVideoAD(e),this.dom=null,this.reportClose())},t.prototype.interrupt=function(t,e){this.exit(t,e)},t.prototype.resumeVideoAD=function(t){t.resume(),this.eventbus.dispatch({type:v.RESUME})},t.prototype.pauseVideoAD=function(t){t.pause(),this.eventbus.dispatch({type:v.PAUSE})},t.prototype.reportClose=function(){var t=this.info.sdkId+"_close";if(!sessionStorage.getItem(t)){var e=this.getTrackingEventURLs(X.CLOSE);if(e){var i=e.map(function(t){return t.url});this.sendADReportEvent(i)}sessionStorage.setItem(t,"1")}},t.prototype.afterAppend=function(){var t=this.info.sdkId+"_start";if(!sessionStorage.getItem(t)){var e=this.getTrackingEventURLs(X.START);if(e){var i=e.map(function(t){return t.url});this.sendADReportEvent(i)}sessionStorage.setItem(t,"1")}},t.prototype.createContent=function(t,e){var r=this,i=N("div",_i+"-close "+T+" "+T+"--close"),o=null,n=this.info,s=n.interactType,a=n.mediaURL,u=n.jumpURL;if(s===$.H5){var p=N("iframe",_i+"-content");p.src=a,p.frameBorder="0",o=p}else{var c=null;if(c=s===$.IMG?U(a,_i+"-content"):this.createVideoElement(t,e),u){var d=b("a",_i+"-content",[c]);d.href=u,d.target="_blank",o=d}else o=c;o.addEventListener("click",function(t){if(t.stopPropagation(),Gt(o,t.target)){var e=r.getTrackingEventURLs(X.CLICK);if(e){var i=Wt(t),n=e.map(function(t){return t.url});r.sendADReportEvent(n,i)}}})}return N("div",_i+"-content-wrapper",[o,i])},t.prototype.createVideoElement=function(t,e){var i=this,n=this.info.mediaURL,r=N("div",_i+"-process"),o=N("video",_i+"-content");return o.setAttribute("autoplay","autoplay"),o.src=n,o.muted=e.isMute,o.addEventListener("ended",function(){i.sendEndEvent()}),o.addEventListener("timeupdate",function(){var t=o.duration,e=o.currentTime;isNaN(t)||(r.style.width=100*e/t+"%")}),this.reportVideoEvent(o),N("div",_i+"-content "+_i+"-video-wrapper",[o,r])},t.prototype.reportVideoEvent=function(a){var u=this,p=[],c=this.info.trackingEvents;a.addEventListener("timeupdate",function(){var t=a.duration,e=a.currentTime,i=e/t,n=[];if(.25<=i&&-1===p.indexOf(X.FIRSTQUARTILE)&&n.push(X.FIRSTQUARTILE),.5<=i&&-1===p.indexOf(X.MIDPOINT)&&n.push(X.MIDPOINT),.75<=i&&-1===p.indexOf(X.THIRDQUARTILE)&&n.push(X.THIRDQUARTILE),c.progress)for(var r=0,o=c.progress;r<o.length;r++){var s=o[r];if(s.offset&&-1===p.indexOf("offset_"+s.offset))if(-1!==s.offset.indexOf("%"))Number(s.offset.replace("%",""))/100<=i&&n.push(s);else pt(s.offset)<=e&&n.push(s)}W(n)&&u.sendVideoEvent(n,p)}),a.addEventListener("ended",function(){u.sendVideoEvent([X.COMPLETE])}),a.addEventListener("error",function(){u.sendVideoEvent([X.ERR],null,{ERRORCODE:302e3,ERRORMSG:"video_error"})})},t.prototype.sendVideoEvent=function(t,n,r){var o=this,s=this.info.trackingEvents;t.forEach(function(t){var e=t;if("string"==typeof t){var i=s[t];i&&o.sendADReportEvent(i.map(function(t){return t.url}),r)}else null!=t.offset&&(o.sendADReportEvent([t.url]),e="offset_"+t.offset);n&&n.push(e)})},t.prototype.getTrackingEventURLs=function(t){return this.info.trackingEvents[t]},t.prototype.sendEndEvent=function(){this.eventbus.dispatch({type:v.CLOSE_INTERACT})},t}(Ht),Oi=R+"--interact",Si=function(){function t(t,e,i){var n=this;this.mgPlayer=e,this.eventBus=i,this.buttons=[],this.interacts=[],t.forEach(function(t){var e=t.type;if("button"===e){var i={info:t,player:null,isPlaying:!1};n.buttons.push(i)}else"interact"===e&&n.interacts.push(t)}),this.buttonContainer=N("div",S),this.dom=N("div","",[this.buttonContainer]),this.dom.addEventListener("click",function(t){t.stopPropagation()}),this.autoResponsive(),this.bindEventHandlers()}return t.prototype.destroy=function(){this.eventBus.removeListener(d.C_RESIZE,this.adjustStageSize),this.eventBus.removeListener(v.SHOW_INTERACT,this.onShowInteract),this.eventBus.removeListener(v.CLOSE_INTERACT,this.onCloseInteract),this.eventBus.removeListener(v.TIME_UPDATE,this.onTimeUpdate)},t.prototype.bindEventHandlers=function(){this.eventBus.addListener(v.TIME_UPDATE,this.onTimeUpdate,this),this.eventBus.addListener(v.SHOW_INTERACT,this.onShowInteract,this),this.eventBus.addListener(v.CLOSE_INTERACT,this.onCloseInteract,this)},t.prototype.onShowInteract=function(t){var e=t.data.slotId,i=G(this.interacts,function(t){return t.id===e});if(i){var n=this.dom,r=this.mgPlayer;n.classList.add(Oi),this.interactModal=new Pi(i,this.eventBus),this.interactModal.start(n,r)}},t.prototype.onCloseInteract=function(){var t=this.dom,e=this.interactModal,i=this.mgPlayer;console.log("close"),e.exit(t,i),t.classList.remove(Oi)},t.prototype.onTimeUpdate=function(t){var e=t.data.currentTime;this.endExpiredPlayer(e),this.showPlayers(e)},t.prototype.getExpiredPlayer=function(o){return this.buttons.filter(function(t){var e=t.info,i=t.isPlaying;if(t.player&&i){var n=e.duration,r=e.time;return n+r<o||o<r}return!1})},t.prototype.endExpiredPlayer=function(t){var e=this.buttonContainer;this.getExpiredPlayer(t).forEach(function(t){t.isPlaying=!1,t.player.exit(e),t.player=null})},t.prototype.getCanShowPlayer=function(r){return this.buttons.filter(function(t){var e=t.info;if(t.isPlaying)return!1;var i=e.duration,n=e.time;return r<i+n&&n<=r})},t.prototype.showPlayers=function(t){var e=this.buttonContainer,i=this.eventBus;this.getCanShowPlayer(t).forEach(function(t){t.isPlaying=!0,t.player=new Ai(t.info,i),t.player.start(e)})},t.prototype.autoResponsive=function(){this.adjustStageSize(),this.eventBus.addListener(d.C_RESIZE,this.adjustStageSize,this)},t.prototype.adjustStageSize=function(){var t=this.mgPlayer,e=this.buttonContainer;if(e){var i=t.getVideoSize();if(i&&!i.isFloating){var n=16*i.height/9;e.style.width=n.toFixed(3)+"px"}}},t}(),wi=function(r){function t(t,e,i,n){return r.call(this,t,e,i,n)||this}return u(t,r),t.prototype.destroy=function(){if(this.dom){var t=this.basicLayer,e=this.interactLayer;t&&t.destroy(),e&&e.destroy(),this.stage.removeChild(this.dom),this.basicLayer=null,this.dom=null}},t.prototype.createModalComponents=function(t,e){var i=this.createBasicLayer(e),n=[i.dom];return this.basicLayer=i,t.jumpURL&&n.push(this.createBackJumpLink(t)),t.companions&&(this.interactLayer=this.createInteractLayer(t.companions),n.push(this.interactLayer.dom)),n},t.prototype.createBasicLayer=function(t){var e=this.createTopBar(t),i=this.createBottomBar(t,!1),n=new vi;return n.addComponents([e,i]),this.bindCompJumpClickEvent(n),n},t.prototype.createInteractLayer=function(t){var e=this.mgPlayer,i=this.eventBus;return new Si(t,e,i)},t}(Di),Ni=function(r){function t(){var t=null!==r&&r.apply(this,arguments)||this;return t.invokedLoadSource=!1,t.interrupted=!1,t}return u(t,r),t.prototype.start=function(t,e){this.adType=Y.FRONT,this.initVideoPlayer(e),this.startLoadSourceTaskIfNeed(e),this.createModal(t,e),this.playNext()},t.prototype.interrupt=function(){clearTimeout(this.loadSourceTask),this.interrupted=!0,this.invokedLoadSource=!0,r.prototype.interrupt.call(this)},t.prototype.exit=function(t,e){clearTimeout(this.loadSourceTask),this.invokedLoadSource||this.loadSource(e,this.atc),this.disposeVideo(),this.interrupted||(this.sendCDNReportEvent({url:this.adItems[this.adItems.length-1].creative.mediaFile,e:0,f:0,s:3,type:6}),e.adVideoEnd(st.FRONT))},t.prototype.initVideoEvents=function(){this.eventbus.addListener(d.FRONT_AD_PLAY,this.onADPlay,this),r.prototype.initVideoEvents.call(this)},t.prototype.disposeVideo=function(){this.eventbus.removeEvents(d.FRONT_AD_PLAY),r.prototype.disposeVideo.call(this)},t.prototype.onPlaying=function(){r.prototype.onPlaying.call(this);var t=this.getCurrentCreative();this.sendCDNReportEvent({url:t.mediaFile,f:0,e:0,s:3,type:3,ptype:this.adType})},t.prototype.onError=function(){var t=this.getPlayingItem().creative.mediaFile;this.sendCDNReportEvent({url:t,e:301003,f:-1,d:"video_error",s:3,type:3,tn:this.currentADIndex+1,ptype:this.adType}),r.prototype.onError.call(this)},t.prototype.onCreativeTimeOut=function(t,e,i){r.prototype.onCreativeTimeOut.call(this,t,e,i);var n=e.creative.mediaFile;this.sendCDNReportEvent({url:n,e:301001,f:-1,d:i+"_timeout",s:3,type:3,tn:t+1,ptype:this.adType})},t.prototype.onFinishPlay=function(){this.sendCDNReportEvent({url:this.adItems[this.adItems.length-1].creative.mediaFile,e:0,f:0,s:3,type:4,ptype:this.adType}),r.prototype.onFinishPlay.call(this)},t.prototype.parse=function(t){r.prototype.parse.call(this,t),t.extensions.atc&&this.parseAtcInfo(t.extensions.atc)},t.prototype.startLoadSourceTaskIfNeed=function(t){var e=this,i=this.atc;if(i)try{var n=function(t){try{for(var e="",i=0;i<t.length;i++)e=e.concat(t.charAt(t.length-i-1));e=(e=(e=e.replace("_","+")).replace("~","/")).replace("-","=");for(var n=Be.decode(e).split("|"),r={},o=0,s=n;o<s.length;o++){var a=s[o].split("=");r[a[0]]=a[1]}return r}catch(t){return null}}(i.tk2);if(n&&n.skipt){var r=Number(n.skipt);0<r&&(this.loadSourceTask=window.setTimeout(function(){e.loadSource(t,i)},1e3*r))}}catch(t){console.log(t)}},t.prototype.loadSource=function(t,e){if(!this.invokedLoadSource){this.invokedLoadSource=!0;try{t.loadSource(e)}catch(t){this.invokedLoadSource=!1}}},t.prototype.parseAtcInfo=function(t){var e=t.pm2,i=t.tk2;e&&i&&(this.atc={pm2:e.content,tk2:i.content})},t.prototype.createModal=function(t,e){this.modal=new wi(this.getModalInfo(),t,e,this.eventbus)},t.prototype.getModalInfo=function(){return this.adItems.map(function(t){var e=t.skip,i=t.creative,n=t.sdkId,r=t.companions;return{id:n,skip:e,jumpURL:i.clickThrough,duration:i.duration,skipTipTxt:"关闭广告",companions:r,skipCountDown:!0}})},t}(hi),Mi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.reset=function(){},e.prototype.setPlayerInfo=function(t){this.createADPlayer(t)},e.prototype.createADPlayer=function(e){try{var t=new Ni(e,this.eventBus);this.sendShowPlayerEvent(t,gt.VIDEO)}catch(t){this.handleCreateADError(t,e)}},e.prototype.handleCreateADError=function(t,e){console.log(t);var i=this.getAtcInfo(e);this.mgPlayer.loadSource(i),this.mgPlayer.adVideoEnd(st.FRONT)},e.prototype.getAtcInfo=function(t){if(t&&t.extensions&&t.extensions.atc){var e=t.extensions.atc,i=e.pm2,n=e.tk2;return{pm2:i&&i.content,tk2:n&&n.content}}return null},e}(ii),ki=function(t){var e=t.url,i=t.error,n=t.impression,r=t.width,o=t.height;this.sdkId=ot("ad_item"),this.spaceId=String(ut),this.type=Y.LOADING,this.creative={url:e,width:r,height:o},this.errorUrls=i,this.impressionUrls=n},bi=function(n){function t(t,e){var i=n.call(this,e)||this;return i.adItem=new ki(t),i}return u(t,n),t.prototype.start=function(t){var r=this,o="as_loading",s=this.adItem.creative;this.dom=N("div",o),t.appendChild(this.dom);pe(s.url,function(){if(r.reportCreativeFetchResult(s.url,!1),!r.isExit){var t=x(s),e=N("div",o+"_icon"),i=N("div",o+"_img",[t,e]),n=100*s.width/1920+"%";i.style.width=n,r.dom.appendChild(i),r.afterAppend()}},function(){r.reportCreativeFetchResult(s.url,!0),r.end(K.CREATIVE_ERROR)})},t.prototype.show=function(t){},t.prototype.hide=function(t){},t.prototype.exit=function(t){this.isExit=!0,this.dom&&t.removeChild(this.dom)},t.prototype.interrupt=function(t){this.exit(t)},t.prototype.afterAppend=function(){var t=this.adItem.impressionUrls;W(t)&&this.eventbus.dispatch({type:l.AD_EVENT_TRIGGER,data:{urls:t}}),this.eventbus.dispatch({type:l.AD_IMP,data:{player:this}})},t.prototype.reportCreativeFetchResult=function(t,e){var i={url:t,s:3,ptype:this.adItem.type,f:e?-1:0,error:e?3e5:0};if(this.sendCDNReportEvent(i),e){var n=this.adItem;n.errorUrls&&this.sendADReportEvent(n.errorUrls,{ERRORCODE:502,ERRORURL:encodeURIComponent(t)})}},t.prototype.end=function(t){this.isExit=!0,this.eventbus.dispatch({type:l.AD_WILL_END,data:{player:this,reason:t}})},t}(Ht),xi=function(){function t(){this.reqTime=0,this.initReqParams()}return t.prototype.load=function(i,n,r){var o=this;if(2!==this.reqTime){var t=0!==this.reqTime,s=t;this.reqTime+=1;var a=t?"https://web2.da.mgtv.com/player/loading":"https://web.da.mgtv.com/player/loading",e=5e3+1e3*this.reqTime,u=this.params,p=u.mediaInfo,c=u.basicInfo,d=u.id,h=u.au,l=u.auver,v=JSON.stringify(c),f=JSON.stringify(p),y=JSON.stringify(d);Ue({url:a,data:{v:f,p:v,id:y,au:h,auver:l},options:{timeout:e},onSuccess:function(t){if(t&&t.v){var e=null;try{e=JSON.parse(t.v)}catch(t){return n.call(r,{code:104e3,url:a,isLast:s}),void o.load(i,n,r)}i.call(r,e,{url:a,isLast:s})}else n.call(r,{code:103e3,url:a,isLast:s}),o.load(i,n,r)},onFail:function(t){var e=t.code===ce.TIMEOUT?105e3:101500;n.call(r,{code:e,url:a,isLast:s}),o.load(i,n,r)}})}},t.prototype.initReqParams=function(){var t=I({},Ze(!1),{isContinue:0}),e={p:t.player,id:ut,time:0,allowad:110110,ptype:Y.LOADING,pu:window.location.href},i={cxid:t.cxid,ck:t.did,sid:t.sessionid,isContinue:t.isContinue?1:0},n=window.screen.width+"*"+window.screen.height,r={type:t.platform,os:t.os,ua:t.ua,version:t.wver,rs:n,did:t.did},o={sdkversion:f,_v:"1",fmt:"vast3",parameter:parseInt("10110111",2),float_ex:3,retry:0,m:e,u:i,c:r},s={v:{url:window.location.href,on_date:"",ispreview:0,ispay:0,uname:"",ucode:""}};this.params=I({basicInfo:o,id:{id:t.sessionid},mediaInfo:s},je(t.sessionid))},t}(),Ui="AS_LOADING_AD_CACHE",Bi=new(function(){function t(){}return t.prototype.init=function(t){this.eventBus=t},t.prototype.update=function(){(new xi).load(this.onUpdateSuc,this.onUpdateFail,this)},t.prototype.getInfo=function(){var t=localStorage.getItem(Ui);if(t)try{return JSON.parse(t)}catch(t){console.log("parse loading ad"),localStorage.removeItem(Ui)}return null},t.prototype.onUpdateSuc=function(t,e){var i=e.url,n=this.eventBus;if(n){var r={url:i,e:0,f:0,z:1,s:1,ptype:Y.LOADING};n.dispatch({type:l.CDN_REPORT,data:r})}localStorage.setItem(Ui,JSON.stringify(t))},t.prototype.onUpdateFail=function(t){var e=t.code,i=void 0===e?0:e,n=t.url,r=t.isLast,o=this.eventBus;if(o){var s={url:n,e:i,f:-1,z:r?1:0,s:1,ptype:Y.LOADING};o.dispatch({type:l.CDN_REPORT,data:s})}},t}()),Vi=function(r){function t(t,e,i){var n=r.call(this,t,e,i)||this;return n.currentPlayer=null,t.addListener(d.SPLASH_SHOW,n.onSplashStatusChange,n),t.addListener(l.AD_IMP,n.onADImp,n),n}return u(t,r),t.prototype.reset=function(){this.currentPlayer=null},t.prototype.setPlayerInfo=function(t){},t.prototype.onADImp=function(t){var e=t.data.player;this.currentPlayer===e&&Bi.update()},t.prototype.onSplashStatusChange=function(t){if(t.data&&!0===t.data.show){if(null==this.currentPlayer){var e=Bi.getInfo();if(e){var i=this.matchADItem(e);i&&(this.currentPlayer=new bi(i,this.eventBus),this.sendShowPlayerEvent(this.currentPlayer,gt.SPLASH))}}}else this.currentPlayer&&(this.sendEndPlayerEvent(this.currentPlayer),this.currentPlayer=null)},t.prototype.matchADItem=function(t){var c,d,h=this.mgPlayer.getVideoInfo();h&&(c=Number(h.cid),d=Number(h.vid));var l=Date.now();return G(t,function(t){var e=t.vid,i=t.vid_ex,n=t.hid,r=t.hid_ex;if(1e3*t.expire_at<l)return!1;var o=!(W(e)||W(n));if(h){var s=W(i)&&-1!==i.indexOf(d),a=W(r)&&-1!==r.indexOf(c);if(s||a)return!1;if(!o){var u=W(e)&&-1!==e.indexOf(d),p=W(n)&&-1!==n.indexOf(c);return u||p}}return o})},t}(ii),Fi=function(r){function t(t,e,i,n){return r.call(this,t,e,i,n)||this}return u(t,r),t.prototype.destroy=function(){if(this.dom){var t=this.basicLayer;t&&t.destroy(),this.stage.removeChild(this.dom),this.basicLayer=null,this.dom=null}},t.prototype.createModalComponents=function(t,e){var i=[this.createBottomBar(e,!1)];t.isNative||i.push(this.createTopBar(e));var n=new vi;n.addComponents(i),this.bindCompJumpClickEvent(n);var r=[(this.basicLayer=n).dom];return t.jumpURL&&r.push(this.createBackJumpLink(t)),r},t}(Di),Hi=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return u(t,r),t.prototype.start=function(t,e){var i=this,n=e.getVideoCurrentTime(),r=this.adItems[0].startTime,o=Math.ceil(r-n),s=function(){return i.playVideo(t,e)};1<=o?this.showCountDownTimer(t,e,o,s):s()},t.prototype.exit=function(t,e){this.disposeVideo(),e.unlockUI(),e.adVideoEnd(st.MID)},t.prototype.onPlaying=function(){r.prototype.onPlaying.call(this);var t=this.getCurrentCreative();this.sendCDNReportEvent({f:0,e:0,s:3,url:t.mediaFile,ptype:this.adType})},t.prototype.onError=function(){var t=this.getPlayingItem().creative.mediaFile;this.sendCDNReportEvent({url:t,e:301003,f:-1,d:"video_error",s:3,tn:this.currentADIndex+1,ptype:this.adType}),r.prototype.onError.call(this)},t.prototype.onCreativeTimeOut=function(t,e,i){r.prototype.onCreativeTimeOut.call(this,t,e,i);var n=e.creative.mediaFile;this.sendCDNReportEvent({url:n,e:301001,f:-1,d:i+"_timeout",s:3,tn:t+1,ptype:this.adType})},t.prototype.initVideoEvents=function(){this.eventbus.addListener(d.MID_AD_PLAY,this.onADPlay,this),r.prototype.initVideoEvents.call(this)},t.prototype.disposeVideo=function(){r.prototype.disposeVideo.call(this),this.eventbus.removeEvents(d.MID_AD_PLAY),this.eventbus.removeListener(l.SYNC_PLAY_TIME,this.countDownTimerHandler)},t.prototype.createModal=function(t,e){this.modal=new Fi(this.getModalInfo(),t,e,this.eventbus)},t.prototype.getModalInfo=function(){return this.adItems.map(function(t){var e=t.skip,i=t.creative;return{id:t.sdkId,jumpURL:i.clickThrough,duration:i.duration,skip:e,skipTipTxt:"返回正片",skipCountDown:!0,isNative:!1}})},t.prototype.playVideo=function(t,e){this.adType=Y.MID,e.midAdStart(),this.reportFirestOneImpression(),this.initVideoPlayer(e),this.createModal(t,e),this.playNext()},t.prototype.showCountDownTimer=function(n,t,e,r){var o=this;t.lockUI();var s=N("div",g+"mid-player_timer"),a=this.adItems[0].startTime,u=function(t){s.innerHTML="即将进入广告 <span>"+t+"s</span>"};u(e),n.appendChild(s);var p=function(t){var e=t.data.time,i=Math.ceil(a-e);0<i?u(i):(o.eventbus.removeListener(l.SYNC_PLAY_TIME,p),n.removeChild(s),r())};this.eventbus.addListener(l.SYNC_PLAY_TIME,p),this.countDownTimerHandler=p},t}(hi),Wi=function(r){function t(){return null!==r&&r.apply(this,arguments)||this}return u(t,r),t.prototype.start=function(t,e){this.adType=Y.MID,e.midAdStart(),this.createModal(t,e),this.initVideoPlayer(e),this.playNext(),this.reportFirestOneImpression()},t.prototype.onPlaying=function(){if(clearTimeout(this.loadDataTimeOutTask),this.notPreview()){var t=this.getCurrentCreative();this.sendCDNReportEvent({f:0,e:0,s:3,url:t.mediaFile,ptype:this.adType})}},t.prototype.onEnded=function(){this.notPreview()?r.prototype.onEnded.call(this):(this.stopTimeOutTasks(),this.playNext())},t.prototype.onError=function(){this.isExit=!0,r.prototype.onError.call(this),this.onFinishPlay(K.CREATIVE_ERROR)},t.prototype.onCreativeTimeOut=function(t,e,i){if(this.notPreview()){r.prototype.onCreativeTimeOut.call(this,t,e,i);var n=e.creative.mediaFile;this.sendCDNReportEvent({url:n,e:301001,f:-1,d:i+"_timeout",s:3,tn:t+1,ptype:this.adType})}else this.isExit=!0,this.onFinishPlay(K.TIME_OUT)},t.prototype.onTimeUpdate=function(t){this.notPreview()?r.prototype.onTimeUpdate.call(this,t):this.startSuspendTimeOutTask()},t.prototype.getUrls=function(){var t=this.adItems[0],e=t.creative,i=t.companions,n={url:e.mediaFile,duration:e.duration},r=i[0];return[{url:r.mediaURL,duration:r.duration},n]},t.prototype.sendCreativeItemADReport=function(t,e,i){this.notPreview()&&r.prototype.sendCreativeItemADReport.call(this,t,e,i)},t.prototype.createModal=function(t,e){this.modal=new Fi(this.getModalInfo(),t,e,this.eventbus)},t.prototype.getModalInfo=function(){var t=this.adItems[0];return[this.createPreviewModalInfo(t.companions[0]),this.createADModalInfo(t)]},t.prototype.getPlayingItem=function(){return this.adItems[0]},t.prototype.getCurrentCreative=function(){return this.getPlayingItem().creative},t.prototype.createADModalInfo=function(t){var e=t.creative,i=t.sdkId,n=t.skip;return{id:i,jumpURL:e.clickThrough,duration:e.duration,skip:n,skipTipTxt:"返回正片",skipCountDown:!1,isNative:!0,jumpBtnTxt:e.clickBtnTxt}},t.prototype.createPreviewModalInfo=function(t){return{id:t.sdkId,jumpURL:"",duration:t.duration,skipTipTxt:"返回正片",isNative:!0}},t.prototype.notPreview=function(){return 1===this.currentADIndex},t}(Hi),Gi={needPlay:!0,fetching:!1,lastFinishTime:null,isNative:!1,vast:null,countDown:0},Yi=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.countDownTime=0,t}return u(t,e),t.prototype.reset=function(){this.eventBus.removeListener(l.AD_END,this.onADEnd),this.onADEnd=null,this.stopWatchPlayTimeUpdate(),this.stopListenUserWatchTime(),this.playingPlayer=null,this.playList=[]},t.prototype.setPlayerInfo=function(t){var e=t.ads,i=t.extensions;this.playList=e.map(function(t){return I({},t,{player:I({},Gi)})});var n=0;if(i){var r=i.midRollPreTime,o=i.midCountdown;r&&r.content&&(n=Number(r.content)),o&&o.content&&(this.countDownTime=Number(o.content))}this.initEventHandlers(n)},t.prototype.initEventHandlers=function(i){var n=this;0<i?(this.hanldeUserWatchTimeUpdate=function(t){var e=t.data;e&&e.time>=i&&(n.stopListenUserWatchTime(),n.watchPlayTimeUpdate())},this.eventBus.addListener(l.SYNC_WATCH_TIME,this.hanldeUserWatchTimeUpdate,this)):this.watchPlayTimeUpdate()},t.prototype.stopWatchPlayTimeUpdate=function(){this.eventBus.removeListener(l.SYNC_PLAY_TIME,this.handlePlayTimeUpdate)},t.prototype.watchPlayTimeUpdate=function(){this.eventBus.addListener(l.SYNC_PLAY_TIME,this.handlePlayTimeUpdate,this)},t.prototype.stopListenUserWatchTime=function(){var t=this.hanldeUserWatchTimeUpdate;t&&(this.eventBus.removeListener(l.SYNC_WATCH_TIME,t),this.hanldeUserWatchTimeUpdate=null)},t.prototype.handlePlayTimeUpdate=function(t){var e=this,i=t.data.time,n=this.getPlayerCreateList(i);if(0<n.length&&n.forEach(function(t){return e.createADPlayer(t)}),this.mgPlayer.isVideoPlaying&&null==this.playingPlayer){var r=this.getwillShowSpace(i);r&&this.showPlayer(r.player)}},t.prototype.showPlayer=function(t){var e=null,i=t.vast;e=t.isNative?new Wi(i,this.eventBus):new Hi(i,this.eventBus),this.playingPlayer=e,this.listenMidVideoStatus(e,t),this.sendShowPlayerEvent(e,gt.VIDEO)},t.prototype.listenMidVideoStatus=function(i,n){var r=this,o=function(t){var e=t.data.player;i===e&&(r.eventBus.removeListener(l.AD_END,o),r.playingPlayer=null,n.isNative?n.lastFinishTime=Date.now():(n.vast=null,n.needPlay=!1))};this.eventBus.addListener(l.AD_END,o),this.onADEnd=o},t.prototype.getwillShowSpace=function(t){for(var e=0,i=this.playList;e<i.length;e++){var n=i[e],r=n.time,o=n.player,s=o.isNative,a=o.lastFinishTime,u=o.needPlay,p=o.vast,c=o.countDown;if(u&&p){var d=r-t,h=-2<=d&&d<=c,l=!(s&&a&&Date.now()-a<=5e3);if(h&&l)return n}}},t.prototype.getPlayerCreateList=function(a){return this.playList.filter(function(t){var e=t.time,i=t.player,n=i.needPlay,r=i.fetching,o=i.vast;if(r||!n||null!=o)return!1;var s=e-a;return 1<=s&&s<=10})},t.prototype.createADPlayer=function(t){var s=this,a=t.player,e=t.id;a.fetching=!0;var i={adType:Y.MID,aid:e};new ti(i,this.mgPlayer).load(function(t,e){var i=e.url;a.fetching=!1,t&&t.ad?((a.vast=t).ad.inLine&&t.ad.inLine.creatives.creative.companionAds&&(a.isNative=!0),a.isNative||(a.countDown=s.countDownTime)):a.needPlay=!1;var n={url:i,e:0,f:0,z:1};s.sendCDNReport(n)},function(t){var e=t.code,i=void 0===e?0:e,n=t.url,r=t.isLast,o={url:n,e:i,f:-1,z:r?1:0};s.sendCDNReport(o),r&&(a.fetching=!1)})},t.prototype.sendCDNReport=function(t){this.eventBus.dispatch({type:l.CDN_REPORT,data:I({},t,{ptype:Y.MID,s:1})})},t}(ii),ji=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.parseCreative=function(t){return new se(t)},e}(St),Ki="as-pause",qi=Ki+"_dot-item",zi=Ki+"_img-wrapper",Ji=function(n){function t(t,e){var i=n.call(this,e)||this;return i.isExit=!1,i.currentPlayIndex=0,i.parse(t),i.listenVideoEnd(),i}return u(t,n),t.prototype.start=function(s){var a=this;if(!W(this.adItems))return this.exit();this.filterValidItems(function(t){if(!a.isExit)if(W(t)){var e=1<(a.playedADItems=t).length,i=(e?t.concat(t[0]):t).map(function(t,e){var i=t.creative;return a.createImageElement(i,e)}),n=t[0].creative,r=n.width,o=n.height;a.imgWrapper=a.createImageWrapper(r,o,i),a.playerDOM=a.createContainer(r,a.imgWrapper),e&&(a.navDots=a.createNavDots(t),a.playerDOM.appendChild(a.navDots),a.startSwitchItemTask()),a.showImgItem(0),s.appendChild(a.playerDOM)}else a.exit()})},t.prototype.show=function(){},t.prototype.hide=function(){},t.prototype.interrupt=function(){this.exit()},t.prototype.exit=function(){if(this.isExit=!0,this.stopSwitchItemTask(),this.eventbus.removeListener(d.VIDEO_END,this.exit),this.playerDOM){var t=this.getTrackingEventData(this.getCurrentCreative(),X.CLOSE);if(t){var e=t.map(function(t){return t.url});this.sendADReportEvent(e)}w(this.playerDOM),this.playerDOM=null,this.imgWrapper=null,this.navDots=null}},t.prototype.createNavDots=function(t){var n=this,e=t.map(function(t,e){var i=N("div",qi);return i.dataset.index=""+e,i}),i=N("div",Ki+"_dots",e);return i.addEventListener("click",function(t){var e=t.target;if(e.classList.contains(qi)){n.stopSwitchItemTask();var i=Number(e.dataset.index);n.showImgItem(i),n.startSwitchItemTask()}}),i},t.prototype.showNextImgItem=function(){var t=this.playedADItems,e=this.currentPlayIndex,i=t.length,n=(e+1)%i,r=e===i-1;this.showImgItem(n,r)},t.prototype.showImgItem=function(t,e){var i=this.navDots,n=this.playedADItems;this.currentPlayIndex=t,i&&this.scrollImgWrapper(t,e),this.afterShowImgItem(n[t])},t.prototype.scrollImgWrapper=function(t,e){var i=this,n=this.imgWrapper;if(this.changeSelectedDot(t),e){var r=this.playedADItems.length;n.style.left=-100*r+"%";var o=function(){if(n.removeEventListener("transitionend",o),!i.isExit&&0===i.currentPlayIndex){var t=zi+"--static";n.classList.add(t),n.style.left="0",setTimeout(function(){n.classList.remove(t)},0)}};n.addEventListener("transitionend",o)}else n.style.left=-100*t+"%"},t.prototype.changeSelectedDot=function(t){var e=this.navDots,i=qi+"--selected",n=e.querySelector("."+i);n&&n.classList.remove(i);var r=e.querySelector('[data-index="'+t+'"]');r&&r.classList.add(i)},t.prototype.stopSwitchItemTask=function(){clearInterval(this.switchTask)},t.prototype.startSwitchItemTask=function(){var t=this;this.switchTask=window.setInterval(function(){t.showNextImgItem()},1e3*this.rollTime)},t.prototype.filterValidItems=function(e){var o=this,i=this.adItems.length,s=[],n=0,a=function(t){return function(){n+=1,t(),n===i&&e(s)}};this.adItems.forEach(function(t){var e=t.creative,i=t.errorUrls;if(e){var n=e.mediaFile,r={url:n,s:3,ptype:Y.PAUSE};pe(n,a(function(){s.push(t),setTimeout(function(){r.f=0,r.e=0,o.sendCDNReportEvent(r)},0)}),a(function(){setTimeout(function(){r.f=-1,r.e=3e5,o.sendCDNReportEvent(r),i&&o.sendADReportEvent(i,{ERRORCODE:502,ERRORURL:encodeURIComponent(n)})},0)}))}})},t.prototype.getCurrentCreative=function(){var t=this.currentPlayIndex;return this.playedADItems[t].creative},t.prototype.getTrackingEventData=function(t,e){return t.trackingEvents[e]},t.prototype.afterShowImgItem=function(t){var e=t.sdkId,i=t.impressionUrls,n=e+"_imp";!("1"===sessionStorage.getItem(n))&&i&&(this.sendADReportEvent(i),sessionStorage.setItem(n,"1"))},t.prototype.createContainer=function(t,e){var i=N("div",Ki+"_ad-flag","广告"),n=this.createCloseBtn(),r=N("div",Ki+"_container",[n,i,e]),o=100*t/848;return r.style.maxWidth=t+"px",r.style.width=o+"%",r},t.prototype.createCloseBtn=function(){var t=this,e=B(),i=N("div",C,[e]);return i.addEventListener("click",function(){t.eventbus.dispatch({type:l.AD_WILL_END,data:{player:t,reason:K.USER_CLICK}})}),i},t.prototype.parse=function(t){var e=t.extensions,i=H(t.ad);W(i)&&(this.adItems=i.map(function(t){return new ji(t)}),1<i.length&&this.setRollTime(e))},t.prototype.setRollTime=function(t){var e=0;t&&t.rollTime&&(e=Number(t.rollTime.content)),this.rollTime=0<e?e:3},t.prototype.createImageWrapper=function(t,e,i){var n=100*(e/t)+"%",r=N("div",zi,i);return r.style.paddingBottom=n,r},t.prototype.createImageElement=function(r,t){var o=this,e=r.clickThrough,i=r.mediaFile,n=N("div",Ki+"_img-item"),s=U(i,Ki+"_img");if(e){var a=N("a",null,[s]);a.href=e,a.target="_blank",a.addEventListener("click",function(t){var e=o.getTrackingEventData(r,X.CLICK);if(e){var i=Wt(t),n=e.map(function(t){return t.url});o.sendADReportEvent(n,i)}}),n.appendChild(a)}else n.appendChild(s);return n.style.left=100*t+"%",n},t.prototype.listenVideoEnd=function(){this.eventbus.addListener(d.VIDEO_END,this.exit,this)},t}(Ht),Qi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e.prototype.setPlayerInfo=function(t){var e=t.ads;W(e)&&(this.playInfo=e[0],this.initEventHandlers())},e.prototype.reset=function(){this.playInfo=null,this.currentPlayer=null;var t=this.eventBus;t.removeListener(d.VIDEO_PAUSE,this.pauseEventHandler),t.removeListener(d.VIDEO_RESUME,this.resumeEventHandler),t.removeListener(d.VIDEO_END,this.videoEndHandler)},e.prototype.initEventHandlers=function(){var t=this.eventBus;t.addListener(d.VIDEO_PAUSE,this.pauseEventHandler,this),t.addListener(d.VIDEO_RESUME,this.resumeEventHandler,this),t.addListener(d.VIDEO_END,this.videoEndHandler,this)},e.prototype.createADPlayer=function(t){var r=this,e={adType:Y.PAUSE,aid:t},i=new ti(e,this.mgPlayer,"pc/pause");i.load(this.handlePreparePlayerSuccess,function(t){var e=t.code,i=void 0===e?0:e,n={url:t.url,e:i,f:-1,z:t.isLast?1:0};r.sendCDNReport(n)},this),this.currentRequest=i},e.prototype.handlePreparePlayerSuccess=function(t,e){var i=e.url;if(!this.mgPlayer.isVideoPlaying&&t.ad){var n=new Ji(t,this.eventBus);this.currentPlayer=n,this.sendShowPlayerEvent(n,gt.MODAL)}var r={url:i,e:0,f:0,z:1};this.sendCDNReport(r)},e.prototype.pauseEventHandler=function(){var t=this.currentPlayer,e=this.stage,i=this.playInfo;null==t&&e.canAddPlayerToStage(Tt.INNER,gt.MODAL)&&this.createADPlayer(i.id)},e.prototype.resumeEventHandler=function(){this.currentRequest=null;var t=this.currentPlayer;t&&(this.sendEndPlayerEvent(t),this.currentPlayer=null)},e.prototype.videoEndHandler=function(){this.currentRequest&&(this.currentRequest.stop=!0,this.currentPlayer=null)},e.prototype.sendCDNReport=function(t){this.eventBus.dispatch({type:l.CDN_REPORT,data:I({},t,{ptype:Y.PAUSE,s:1})})},e}(ii),Xi=function(i){function t(t){var e=i.call(this,t)||this;return e.type=Y.PROGRESS,e}return u(t,i),t.prototype.parseCreative=function(t){return new se(t)},t}(St),Zi="as_progress",$i=h(navigator.userAgent),tn=function(n){function t(t,e){var i=n.call(this,e)||this;return i.canClose=!1,i.isExit=!1,i.hasShown=!1,i.hasReportImp=!1,i.parseADInfo(t),i.initEventHanlders(),i}return u(t,n),t.prototype.start=function(t,e){this.isExit=!1,this.fetching||(null==this.dom?this.initADPlayer(t):this.showAD(t))},t.prototype.show=function(t,e){},t.prototype.hide=function(t,e){},t.prototype.exit=function(t,e){this.isExit=!0,this.hasReportImp=!1,this.hasShown&&(this.hasShown=!1,w(this.dom))},t.prototype.interrupt=function(t,e){this.eventbus.removeListenersByScope(this),this.exit(t,e)},t.prototype.initADPlayer=function(t){var e=this,i=this.adItem.creative,n=i.mediaFile;this.fetching=!0,pe(n,function(){e.fetching=!1,e.reportCreativeFetchResult(n,!1),e.dom=e.createDOM(i),e.isExit||e.showAD(t)},function(){e.fetching=!1,e.reportCreativeFetchResult(n,!0),e.end(K.CREATIVE_ERROR)})},t.prototype.createDOM=function(t){var e=t.mediaFile,i=t.width,n=x({url:e,width:i,height:t.height});n.classList.add(Zi+"_img");var r=N("div",Zi,[n]);this.canClose&&r.appendChild(this.createCloseBtn());var o=100*i/848+"%";return r.style.width=o,r.style.maxWidth=i+"px",r},t.prototype.parseADInfo=function(t){var e=t.ad;this.adItem=new Xi(e),this.canClose="1"===e.close},t.prototype.createCloseBtn=function(){var t=this,e=N("div",L);e.addEventListener("click",function(){t.end(K.USER_CLICK),t.sendCloseEvent()});var i=Zi+"_close",n=i;return $i&&(n+=" "+i+"--pad"),N("div",n,[e])},t.prototype.sendCloseEvent=function(){var t=this.adItem.creative.trackingEvents[X.CLOSE];if(W(t)){var e=t.map(function(t){return t.url});this.sendADReportEvent(e)}},t.prototype.initEventHanlders=function(){var t=this.eventbus;t.addListener(d.PRO_BAR_UPDATE,this.onBarUpdate,this),t.addListener(d.PRO_BAR_HOVER,this.onBarHover,this)},t.prototype.onBarUpdate=function(t){var e=t.data;this.needUpdateOffset(e)&&(this.currentOffset=I({},e),this.hasShown&&this.updateDOMOffset())},t.prototype.updateDOMOffset=function(){var t=this.dom,e=this.currentOffset;if(t&&e){var i=e.percent,n=e.yoffset,r=e.xoffset;t.style.left=100*i+"%",t.style.top=n+"px";var o=!this.hasEnoughSpace(r);if(this.changeDOMClassName(Zi+"--no-space",o),!this.hasReportImp&&!o){this.hasReportImp=!0;var s=this.adItem.impressionUrls;s&&this.sendADReportEvent(s)}}},t.prototype.hasEnoughSpace=function(t){return 0<this.dom.offsetWidth&&t-20>this.dom.offsetWidth},t.prototype.onBarHover=function(t){if(this.dom&&t.data){var e=t.data.hover;this.changeDOMClassName(Zi+"--hover-bar",e)}},t.prototype.changeDOMClassName=function(t,e){var i=this.dom;if(i){var n=i.classList;e?n.add(t):n.remove(t)}},t.prototype.needUpdateOffset=function(t){if(t){var e=t.xoffset,i=t.yoffset,n=t.percent;if(this.currentOffset){var r=this.currentOffset,o=r.xoffset,s=r.yoffset,a=r.percent;return o!==e||s!==i||.1<100*Math.abs(a-n)}return null!=e&&null!=i&&null!=n}return!1},t.prototype.reportCreativeFetchResult=function(t,e){var i={url:t,s:3,ptype:this.adItem.type,f:e?-1:0,error:e?3e5:0};if(this.sendCDNReportEvent(i),e){var n=this.adItem;n.errorUrls&&this.sendADReportEvent(n.errorUrls,{ERRORCODE:502,ERRORURL:encodeURIComponent(t)})}},t.prototype.end=function(t){this.isExit=!0,this.eventbus.dispatch({type:l.AD_WILL_END,data:{player:this,reason:t}})},t.prototype.showAD=function(t){var e=this;this.hasShown=!0;var i=Zi+"--wait-show";this.changeDOMClassName(i,!0),t.appendChild(this.dom);window.setTimeout(function(){e.changeDOMClassName(i,!1),e.isExit||e.updateDOMOffset()},800)},t}(Ht),en=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isPlaying=!1,t.canPlay=!1,t}return u(t,e),t.prototype.reset=function(){this.isPlaying=!1,this.canPlay=!1,this.player=null,this.eventBus.removeListenersByScope(this)},t.prototype.setPlayerInfo=function(t){this.createPlayer(t),this.initEventHandlers()},t.prototype.initEventHandlers=function(){var t=this.eventBus;t.addListener(d.CONTROL_BAR_CHANGE,this.onBarChange,this),t.addListener(l.AD_END,this.onADEnd,this)},t.prototype.onBarChange=function(t){if(t&&t.data?this.canPlay=t.data.visible:this.canPlay=!1,this.player)if(this.canPlay)this.showPlayerIfNeed();else{var e=this.isPlaying,i=this.player;e&&this.sendEndPlayerEvent(i,K.EXPIRED)}},t.prototype.onADEnd=function(t){var e=t.data;if(e&&e.player){var i=e.player,n=e.reason;this.player===i&&(this.isPlaying=!1,n!==K.USER_CLICK&&n!==K.CREATIVE_ERROR||this.reset())}},t.prototype.createPlayer=function(t){var e=t.ads;if(W(e)){var i={aid:e[0].id,adType:Y.PROGRESS};new ti(i,this.mgPlayer,"app/progress").load(this.onReqSuccess,this.onReqFail,this)}},t.prototype.onReqSuccess=function(t,e){var i=e.url;t&&t.ad&&(this.player=new tn(t,this.eventBus),this.showPlayerIfNeed());var n={url:i,e:0,f:0,z:1};this.sendCDNReport(n)},t.prototype.onReqFail=function(t){var e=t.code,i=void 0===e?0:e,n={url:t.url,e:i,f:-1,z:t.isLast?1:0};this.sendCDNReport(n),this.reset()},t.prototype.sendCDNReport=function(t){this.eventBus.dispatch({type:l.CDN_REPORT,data:I({},t,{ptype:Y.PROGRESS,s:1})})},t.prototype.showPlayerIfNeed=function(){var t=this.canPlay,e=this.player,i=this.isPlaying;t&&e&&!i&&(this.isPlaying=!0,this.sendShowPlayerEvent(e,null,Tt.OUTTER))},t}(ii);function nn(t){var e=window.AD_SDK_INFO;return!(e&&e.viewID&&t&&t!==e.viewID)}function rn(){var t=ot("video_view");return window.AD_SDK_INFO={viewID:t},t}var on=function(){function t(t,e,i){this.eventBus=t,this.mgPlayer=e,this.stage=i,this.registedManagers={},this.regManagers(),this.initEventHandles()}return t.prototype.reset=function(){var i=this;rn(),Object.keys(this.registedManagers).forEach(function(t){var e=i.registedManagers[t];e&&e.reset()})},t.prototype.regManagers=function(){this.registManager(Y.FRONT,Mi),this.registManager(Y.PAUSE,Qi),this.registManager(Y.MID,Yi),this.registManager(Y.FLOAT,oi),this.registManager(Y.LOADING,Vi),this.registManager(Y.PROGRESS,en)},t.prototype.initEventHandles=function(){this.eventBus.addListener(d.CMS_DATA,this.handleCMSDataEvent,this)},t.prototype.registManager=function(t,e){this.registedManagers[t]=new e(this.eventBus,this.mgPlayer,this.stage)},t.prototype.handleCMSDataEvent=function(t){var e=rn(),i=t.data;if(i){200===Number(i.code)&&(Qe.update(i.data),this.fetchADConfigInfo(e))}},t.prototype.fetchADConfigInfo=function(t){var i=this;this.mgPlayer.adFrontLoad();var e={adType:Y.FRONT,aid:0},n=new ti(e,this.mgPlayer);n.setBeforeLoad(function(t,e){i.eventBus.dispatch({type:l.CDN_REPORT,data:{url:t,s:1,e:0,f:0,type:0,z:e?1:0,ptype:Y.FRONT}})}),n.load(this.handleFetchConfigSuc(t),this.handleFetchConfigFail(t),this)},t.prototype.handleFetchConfigFail=function(s){var a=this;return function(t){var e=t.code,i=void 0===e?0:e,n=t.url,r=t.isLast,o={url:n,s:1,e:i,f:-1,z:r?1:0,ptype:Y.FRONT};a.eventBus.dispatch({type:l.CDN_REPORT,data:o}),nn(s)&&r&&a.handleNoFrontAD(n,!0)}},t.prototype.handleFetchConfigSuc=function(s){var a=this;return function(t,e){var i=e.url,n=a.getFrontADSourceInfo(t);n&&a.reportFirstFrontImp(n);var r={url:i,s:1,e:0,f:0,z:1,ptype:Y.FRONT,type:n?1:5};if(a.eventBus.dispatch({type:l.CDN_REPORT,data:r}),nn(s)){n?a.delegateManager(Y.FRONT,n):a.handleNoFrontAD(i,!1,a.getAtcInfo(t));var o=a.getExtraSpacesFromConfig(t);Object.keys(o).forEach(function(t){a.delegateManager(t,o[t])})}}},t.prototype.reportFirstFrontImp=function(t){var e=H(t.ad)[0],i=new di(e).impressionUrls;i&&this.eventBus.dispatch({type:l.AD_EVENT_TRIGGER,data:{urls:i}})},t.prototype.delegateManager=function(t,e){var i=this.registedManagers[t];i&&i.setPlayerInfo(e)},t.prototype.getSpaceExtensionsByType=function(t,i){if(t===Y.MID)return n={},["midRollPreTime","midCountdown"].forEach(function(t){var e=i[t];null!=e&&(n[t]=e)}),n;var n},t.prototype.getExtraSpacesFromConfig=function(t){var n=this,o={},r=t.extensions;if(r){var e=r.ads;e&&Array.isArray(e.ad)&&(e.ad.forEach(function(t){var e=t.id,i=t.type,n=t.t;o[i]||(o[i]={ads:[],extensions:{}});var r={id:Number(e),type:i,time:Number(n)};i===Y.FLOAT&&(r.isFixed=null!=t.fixed,r.deletable=null==t.cls_req),o[i].ads.push(r)}),Object.keys(o).forEach(function(t){var e=o[t],i=n.getSpaceExtensionsByType(t,r);i&&(e.extensions=i)}))}return o},t.prototype.getFrontADSourceInfo=function(t){var e=t.ad,i=t.extensions;if(e){var n={ad:e,extensions:{}};return i&&i.atc&&(n.extensions.atc=i.atc),n}},t.prototype.handleNoFrontAD=function(t,e,i){this.mgPlayer.loadSource(i||null),this.eventBus.dispatch({type:l.CDN_REPORT,data:{url:t,type:6,s:3,e:0,f:e?-1:0,ptype:Y.FRONT}}),this.mgPlayer.adVideoEnd(st.FRONT)},t.prototype.getAtcInfo=function(t){if(t&&t.extensions&&t.extensions.atc){var e=t.extensions.atc,i=e.pm2,n=e.tk2;return{pm2:i&&i.content,tk2:n&&n.content}}},t}(),sn=function(){function t(){this.eventMap={}}return t.prototype.removeListenersByScope=function(i){if(i){var n=this.eventMap;Object.keys(n).forEach(function(t){var e=n[t];W(e)&&(n[t]=e.filter(function(t){return t.scope!==i}))})}},t.prototype.addListener=function(t,n,r){var e=this.eventMap[t]||[];if(e.every(function(t){var e=n!==t.handler,i=null!=r||r!==t.scope;return e||i})){var i={handler:n,scope:r};this.eventMap[t]=e.concat(i)}},t.prototype.removeListener=function(t,e){var i=this.eventMap[t];Array.isArray(i)&&e&&(this.eventMap[t]=i.filter(function(t){return t.handler!==e}))},t.prototype.removeEvents=function(t){this.eventMap[t]=null},t.prototype.removeAllListener=function(){this.eventMap={}},t.prototype.dispatch=function(e){var t=this.eventMap[e.type];Array.isArray(t)&&t.forEach(function(t){try{t.handler.call(t.scope,e)}catch(t){console.log(t)}})},t}(),an=function(){function t(t,e){this.mgPlayer=e,t.addListener(l.PLAYER_LOG,this.handleLogEvent,this)}return t.prototype.handleLogEvent=function(t){var e=t.data,i=e.type||"log";this.mgPlayer.Log[i]("ad",e.msg)},t}();var un,pn=function(i){function t(t){var e=i.call(this,t)||this;return e.eventBus.addListener(l.AD_EVENT_TRIGGER,e.handleReportEvent,e),e}return u(t,i),t.prototype.handleReportEvent=function(t){var e=t.data;if(e){var i=e.urls,n=e.params,r=H(i).map(function(e){try{return function(t){var e=new F(t),i=e.getProperty("hostname");if(/^y\.da/.test(i)){var n=e.getQueryValue("sid");if(n){var r=je(n),o=r.au,s=r.auver;return t+(e.getProperty("search")?"&":"?")+"au="+encodeURIComponent(o)+"&auver="+encodeURIComponent(s)}}return t}(e)}catch(t){return e}});this.sendReportAsync(r,n)}},t}(nt),cn=function(){function t(t){this.eventBus=t,this.watchTime=0,this.initEventsHandlers()}return t.prototype.stopTimerTask=function(){clearInterval(this.syncTimeInterval)},t.prototype.initEventsHandlers=function(){this.eventBus.addListener(d.VIDEO_PAUSE,this.stopTimerTask,this),this.eventBus.addListener(l.PLAYER_DESTROY,this.stopTimerTask,this),this.eventBus.addListener(d.VIDEO_PLAY,this.startUpdateTime,this),this.eventBus.addListener(d.VIDEO_RESUME,this.startUpdateTime,this),this.eventBus.addListener(d.VIDEO_END,this.handleVideoEnd,this)},t.prototype.handleVideoEnd=function(){this.watchTime=0,this.stopTimerTask()},t.prototype.syncTime=function(){var t={type:l.SYNC_WATCH_TIME,data:{time:this.watchTime}};this.eventBus.dispatch(t)},t.prototype.startUpdateTime=function(){var t=this;this.stopTimerTask();this.syncTimeInterval=window.setInterval(function(){t.watchTime+=1,t.syncTime()},1e3)},t}(),dn=function(){function t(t,e){this.eventBus=t,this.player=e,this.initEventsHandlers()}return t.prototype.initEventsHandlers=function(){this.eventBus.addListener(d.VIDEO_PLAY,this.startUpdateTime,this),this.eventBus.addListener(d.VIDEO_RESUME,this.startUpdateTime,this),this.eventBus.addListener(d.VIDEO_END,this.stopTimerTask,this),this.eventBus.addListener(d.VIDEO_PAUSE,this.stopTimerTask,this),this.eventBus.addListener(d.VIDEO_DRAG,this.onVideoDrag,this),this.eventBus.addListener(l.PLAYER_DESTROY,this.stopTimerTask,this)},t.prototype.stopTimerTask=function(){clearInterval(this.syncTimeInterval)},t.prototype.onVideoDrag=function(){this.sendEvent({isDrag:!0})},t.prototype.syncTime=function(){this.sendEvent()},t.prototype.sendEvent=function(t){var e=this.player.getVideoCurrentTime(),i={type:l.SYNC_PLAY_TIME,data:I({time:e},t)};this.eventBus.dispatch(i)},t.prototype.startUpdateTime=function(){var t=this;this.stopTimerTask();this.syncTimeInterval=window.setInterval(function(){t.syncTime()},500)},t}(),hn=function(){function t(){this.initBaseComponents(),this.prefetchDatas()}return t.prototype.init=function(t){var e=this.eventBus;this.transmitMGPlayerEvent(e,t),this.initComponents(e,t),e.addListener(d.VIDEO_RELOAD,this.reset,this),e.addListener(d.API_REQ_ERR,this.reset,this)},t.prototype.dispose=function(){this.reset(),this.eventBus.dispatch({type:l.PLAYER_DESTROY})},t.prototype.prefetchDatas=function(){Bi.init(this.eventBus),Bi.update()},t.prototype.initBaseComponents=function(){var t=new sn;this.adReporter=new pn(t),this.cdnReporter=new rt(t),this.eventBus=t},t.prototype.initComponents=function(t,e){this.playerLogger=new an(t,e),this.videoPlayTimer=new dn(t,e),this.userWatchTimer=new cn(t),this.stage=new Ot(t,e),this.backStage=new on(t,e,this.stage)},t.prototype.reset=function(){this.backStage.reset(),this.stage.reset()},t.prototype.transmitMGPlayerEvent=function(i,n){Object.keys(d).forEach(function(t){var e=d[t];n.addListener(e,function(t){i.dispatch(t)})})},t}();(un=document.createElement("link")).rel="stylesheet",un.type="text/css",un.href="//tb.mgtv.com/sdk/pc-sdk/2.4.2/ad-sdk.css",document.getElementsByTagName("head")[0].appendChild(un);return function(t){return y=t,new hn}});
