/*!Name: im.js
 * Date: 2019-4-4 18:53:50 */
define("MOD_ROOT/contact/im",function(require,exports,module){var t=require("MOD_ROOT/common/core"),e=require("MOD_ROOT/common/tools/event").Event,i=function(t){this.cfg=t.cfg,this.sku=t.cfg.skuid,this.$el=t.$el||$("<div></div>"),this.trigger=t.trigger||".J-im-button",this.offlineClass=t.offlineClass||"jd-im-offline",this.template=t.template||'<a href="#none" class="J-im-button"><b></b>{text}</a>',this.debug=t.debug||!1,this.init()};i.prototype={init:function(){this.bindEvent(),this.get()},bindEvent:function(){var t=this;this.$el.delegate(this.trigger,"click",function(){var e=$(this).attr("data-domain");t.open(e)})},open:function(t,e){e=e||{};var i={pid:this.cfg.skuid};$.extend(e,i);var n="//{0}/index.action?".format(t);n+=$.param(e),open(n,"\u4eac\u4e1c\u549a\u549a\u5728\u7ebf\u5ba2\u670d")},exists:function(t){return t&&t.code&&(1==t.code||2==t.code||3==t.code||9==t.code)},get:function(){var i=this;$.ajax({url:"//chat1.jd.com/api/checkChat",data:{pid:i.sku,returnCharset:"utf-8"},dataType:"jsonp",success:function(n){var a=i.exists(n);a&&i.set(n),n&&!n.code&&t.isJd&&$("#popbox").remove(),e.fire({type:"onIMReady",exists:a})},error:function(){e.fire({type:"onIMReady",exists:!1})}})},set:function(e){var i=e.code,n=e.seller;n&&""!=n&&(n=n.replace("&qt;","'").replace("&dt;",'"'));var a=$(this.template.replace("{text}","\u8054\u7cfb\u5ba2\u670d")).attr({title:"\u8054\u7cfb\u5ba2\u670d","data-seller":n,"data-code":i,"data-domain":e.chatDomain});this.$el.html(a),t.customerServiceURL="//{0}/index.action?".format(e.chatDomain)+"pid="+this.sku}},module.exports=i});
/*!Name: followshop.js
 * Date: 2019-4-4 18:53:50 */
define("MOD_ROOT/contact/followshop",function(require,exports,module){var t=require("JDF_UNIT/login/1.0.0/login");require("JDF_UNIT/trimPath/1.0.0/trimPath");var o=function(t){this.vids=t.vids||[],this.$wrap=t.$wrap||$(".pop-score-summary"),this.$el=t.$el||$(".J-follow-shop"),this.checkStatus=!1,this.onFollow=t.onFollow||function(){},this.onunFollow=t.onunFollow||function(){},this.init()};o.prototype={init:function(){this.bindFollow(),this.setStatus()},setStatus:function(){var t=this,o=null,a=$(".J-fans-price .text");function l(l){for(var n in l)l.hasOwnProperty(n)&&(o=t.$wrap.find('[data-vid="'+n+'"]'),o.attr("data-follow",!!l[n]),l[n]?(o.addClass("followed").attr("title","\u70b9\u51fb\u53d6\u6d88\u5173\u6ce8"),o.find("span").html("\u5df2\u5173\u6ce8\u5e97\u94fa"),pageConfig.product.isFans=!0,pageConfig.product.hasFansPrice&&a.text("\u60a8\u5df2\u5173\u6ce8\u5e97\u94fa\uff0c\u53ef\u4eab\u7c89\u4e1d\u4ef7")):(o.removeClass("followed").attr("title","\u70b9\u51fb\u5173\u6ce8"),o.find("span").html("\u5173\u6ce8\u5e97\u94fa"),pageConfig.product.hasFansPrice&&a.text("\u5173\u6ce8\u5e97\u94fa\uff0c\u5373\u4eab\u7c89\u4e1d\u4ef7")))}this.checkStatus=!0,$.ajax({url:"//fts.jd.com/follow/vender/batchIsFollow",data:{venderIds:this.vids.join(","),sysName:"item.jd.com"},dataType:"jsonp",success:function(t){t&&"F10000"===t.code?l(t.data):t&&"F10002"===t.code&&pageConfig.product.hasFansPrice&&a.text("\u5173\u6ce8\u5e97\u94fa\uff0c\u5373\u4eab\u7c89\u4e1d\u4ef7")}})},bindFollow:function(){var o=this;this.$el.unbind().bind("click",function(){var a=$(this),l=a.attr("data-vid"),n="true"===a.attr("data-follow");t({modal:!0,complete:function(){o.checkStatus||o.setStatus(),n?o.unFollow(l,a):o.follow(l,a)}})})},follow:function(t,o){var a=this;if(isNaN(parseInt(t)))return alert("\u4e0d\u5b58\u5728\u7684\u5546\u5bb6"),!1;$.ajax({url:"//fts.jd.com/follow/vender/follow",dataType:"jsonp",data:{venderId:t,sysName:"item.jd.com"},success:function(t){if(!t)return!1;t.success&&"F10000"===t.code?(o.addClass("followed").attr("data-follow","true").attr("title","\u70b9\u51fb\u53d6\u6d88\u5173\u6ce8"),o.find("span").html("\u5df2\u5173\u6ce8\u5e97\u94fa"),a.onFollow.call(a)):"F0401"===t.code?alert("\u4e0d\u5b58\u5728\u7684\u5546\u5bb6"):"F0409"===t.code&&alert("\u5df2\u7ecf\u5173\u6ce8\u8fc7")}})},unFollow:function(t,o){var a=this;$.ajax({url:"//fts.jd.com/follow/vender/unfollow",dataType:"jsonp",data:{venderId:t,sysName:"item.jd.com"},success:function(t){t&&"F10000"===t.code&&(o.removeClass("followed").attr("data-follow","false").attr("title","\u70b9\u51fb\u5173\u6ce8"),o.find("span").html("\u5173\u6ce8\u5e97\u94fa"),a.onunFollow.call(a))}})}},module.exports=o});
