/*!Name: panorama.3d.js
 * Date: 2019-4-4 18:53:52 */
define("MOD_ROOT/preview/panorama.3d",function(require,exports,module){function e(e,t){return jdpanorama.viewer(e,{defaults:{firstScene:"pond",sceneFadeDuration:2e3,autoLoad:!0},fallback:"https://www.jd.com",showControls:!1,autoRotate:5,orientationOnByDefault:!1,scenes:{pond:{panorama:t}}})}window.libpanorama=function(e,t,a){"use strict";function o(o){function r(e,t){return 1==e.level&&1!=t.level?-1:1==t.level&&1!=e.level?1:t.timestamp-e.timestamp}function c(e,t){return e.level!=t.level?e.level-t.level:e.diff-t.diff}function d(){if(!L.drawInProgress){L.drawInProgress=!0;for(var e=0;e<L.currentNodes.length;e++)L.currentNodes[e].textureLoaded&&(I.bindBuffer(I.ARRAY_BUFFER,j),I.bufferData(I.ARRAY_BUFFER,new Float32Array(L.currentNodes[e].vertices),I.STATIC_DRAW),I.vertexAttribPointer(L.vertPosLocation,3,I.FLOAT,!1,0,0),I.bindBuffer(I.ARRAY_BUFFER,B),I.vertexAttribPointer(L.texCoordLocation,2,I.FLOAT,!1,0,0),I.bindTexture(I.TEXTURE_2D,L.currentNodes[e].texture),I.drawElements(I.TRIANGLES,6,I.UNSIGNED_SHORT,0));L.drawInProgress=!1}}function u(e,t,a,o,n,i){this.vertices=e,this.side=t,this.level=a,this.x=o,this.y=n,this.path=i.replace("%s",t).replace("%l",a).replace("%x",o).replace("%y",n)}function f(e,t,a,o,n){if(T(e,t.vertices)){var i=t.vertices,r=i[0]+i[3]+i[6]+i[9],s=i[1]+i[4]+i[7]+i[10],l=i[2]+i[5]+i[8]+i[11],h=Math.sqrt(r*r+s*s+l*l),c=Math.asin(l/h),d=Math.atan2(s,r),p=d-o;p+=p>Math.PI?-2*Math.PI:p<-Math.PI?2*Math.PI:0,p=Math.abs(p),t.diff=Math.acos(Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos(p));for(var m=!1,v=0;v<L.nodeCache.length;v++)if(L.nodeCache[v].path==t.path){m=!0,L.nodeCache[v].timestamp=L.nodeCacheTimestamp++,L.nodeCache[v].diff=t.diff,L.currentNodes.push(L.nodeCache[v]);break}if(m||(t.timestamp=L.nodeCacheTimestamp++,L.currentNodes.push(t),L.nodeCache.push(t)),t.level<L.level){var g=N.cubeResolution*Math.pow(2,t.level-N.maxLevel),w=Math.ceil(g*N.invTileResolution)-1,y=g%N.tileResolution*2,x=2*g%N.tileResolution;0===x&&(x=N.tileResolution),0===y&&(y=2*N.tileResolution);var b=.5;t.x!=w&&t.y!=w||(b=1-N.tileResolution/(N.tileResolution+x));var E,M,R=1-b,P=[],_=b,I=b,C=b,A=R,D=R,S=R;x<N.tileResolution&&(t.x==w&&t.y!=w?(I=.5,D=.5,"d"!=t.side&&"u"!=t.side||(C=.5,S=.5)):t.x!=w&&t.y==w&&(_=.5,A=.5,"l"!=t.side&&"r"!=t.side||(C=.5,S=.5))),y<=N.tileResolution&&(t.x==w&&(_=0,A=1,"l"!=t.side&&"r"!=t.side||(C=0,S=1)),t.y==w&&(I=0,D=1,"d"!=t.side&&"u"!=t.side||(C=0,S=1))),E=[i[0],i[1],i[2],i[0]*_+i[3]*A,i[1]*b+i[4]*R,i[2]*C+i[5]*S,i[0]*_+i[6]*A,i[1]*I+i[7]*D,i[2]*C+i[8]*S,i[0]*b+i[9]*R,i[1]*I+i[10]*D,i[2]*C+i[11]*S],M=new u(E,t.side,t.level+1,2*t.x,2*t.y,N.fullpath),P.push(M),t.x==w&&y<=N.tileResolution||(E=[i[0]*_+i[3]*A,i[1]*b+i[4]*R,i[2]*C+i[5]*S,i[3],i[4],i[5],i[3]*b+i[6]*R,i[4]*I+i[7]*D,i[5]*C+i[8]*S,i[0]*_+i[6]*A,i[1]*I+i[7]*D,i[2]*C+i[8]*S],M=new u(E,t.side,t.level+1,2*t.x+1,2*t.y,N.fullpath),P.push(M)),t.x==w&&y<=N.tileResolution||t.y==w&&y<=N.tileResolution||(E=[i[0]*_+i[6]*A,i[1]*I+i[7]*D,i[2]*C+i[8]*S,i[3]*b+i[6]*R,i[4]*I+i[7]*D,i[5]*C+i[8]*S,i[6],i[7],i[8],i[9]*_+i[6]*A,i[10]*b+i[7]*R,i[11]*C+i[8]*S],M=new u(E,t.side,t.level+1,2*t.x+1,2*t.y+1,N.fullpath),P.push(M)),t.y==w&&y<=N.tileResolution||(E=[i[0]*b+i[9]*R,i[1]*I+i[10]*D,i[2]*C+i[11]*S,i[0]*_+i[6]*A,i[1]*I+i[7]*D,i[2]*C+i[8]*S,i[9]*_+i[6]*A,i[10]*b+i[7]*R,i[11]*C+i[8]*S,i[9],i[10],i[11]],M=new u(E,t.side,t.level+1,2*t.x,2*t.y+1,N.fullpath),P.push(M));for(var k=0;k<P.length;k++)f(e,P[k],a,o,n)}}}function p(){return[-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,1,-1,1,1,1,1,-1,1,1,-1,-1]}function m(){return[1,0,0,0,1,0,0,0,1]}function v(e,t,a){var o=Math.sin(t),n=Math.cos(t);return"x"==a?[e[0],n*e[1]+o*e[2],n*e[2]-o*e[1],e[3],n*e[4]+o*e[5],n*e[5]-o*e[4],e[6],n*e[7]+o*e[8],n*e[8]-o*e[7]]:"y"==a?[n*e[0]-o*e[2],e[1],n*e[2]+o*e[0],n*e[3]-o*e[5],e[4],n*e[5]+o*e[3],n*e[6]-o*e[8],e[7],n*e[8]+o*e[6]]:"z"==a?[n*e[0]+o*e[1],n*e[1]-o*e[0],e[2],n*e[3]+o*e[4],n*e[4]-o*e[3],e[5],n*e[6]+o*e[7],n*e[7]-o*e[6],e[8]]:void 0}function g(e){return[e[0],e[1],e[2],0,e[3],e[4],e[5],0,e[6],e[7],e[8],0,0,0,0,1]}function w(e){return[e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]]}function y(e,t,a,o){var n=2*Math.atan(Math.tan(e/2)*_.height/_.width),i=1/Math.tan(n/2);return[i/t,0,0,0,0,i,0,0,0,0,(o+a)/(a-o),2*o*a/(a-o),0,0,-1,0]}function x(e,t){I.bindTexture(I.TEXTURE_2D,t),I.texImage2D(I.TEXTURE_2D,0,I.RGB,I.RGB,I.UNSIGNED_BYTE,e),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MAG_FILTER,I.LINEAR),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MIN_FILTER,I.LINEAR),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),I.bindTexture(I.TEXTURE_2D,null)}function b(e){e.textureLoad||(e.textureLoad=!0,G(encodeURI(e.path+"."+N.extension),function(t){e.texture=t,e.textureLoaded=!0}))}function E(e){for(var t=1;t<N.maxLevel&&_.width>N.tileResolution*Math.pow(2,t-1)*Math.tan(e/2)*.707;)t++;L.level=t}function M(e,t){return[e[0]*t[0],e[0]*t[1],e[0]*t[2],0,e[5]*t[4],e[5]*t[5],e[5]*t[6],0,e[10]*t[8],e[10]*t[9],e[10]*t[10],e[11],-t[8],-t[9],-t[10],0]}function R(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[4]*t[0]+e[5]*t[1]+e[6]*t[2],e[11]+e[8]*t[0]+e[9]*t[1]+e[10]*t[2],1/(e[12]*t[0]+e[13]*t[1]+e[14]*t[2])]}function P(e,t){var a=R(e,t),o=a[0]*a[3],n=a[1]*a[3],i=a[2]*a[3],r=[0,0,0];return o<-1&&(r[0]=-1),o>1&&(r[0]=1),n<-1&&(r[1]=-1),n>1&&(r[1]=1),(i<-1||i>1)&&(r[2]=1),r}function T(e,t){var a=P(e,t.slice(0,3)),o=P(e,t.slice(3,6)),n=P(e,t.slice(6,9)),i=P(e,t.slice(9,12)),r=a[0]+o[0]+n[0]+i[0];if(-4==r||4==r)return!1;var s=a[1]+o[1]+n[1]+i[1];return-4!=s&&4!=s&&4!=a[2]+o[2]+n[2]+i[2]}var _=t.createElement("canvas");_.style.width=_.style.height="100%",o.appendChild(_);var L,I,C,A,D,S,k,F,N,U,O,z,j,B,H;this.init=function(e,r,c,d,u,f,m,v){if(typeof r===a&&(r="equirectangular"),"equirectangular"!=r&&"cubemap"!=r&&"multires"!=r)throw console.log("Error: invalid image type specified!"),{type:"config error"};if(U=r,N=e,O=c,L){if(C&&(I.detachShader(L,C),I.deleteShader(C)),A&&(I.detachShader(L,A),I.deleteShader(A)),I.bindBuffer(I.ARRAY_BUFFER,null),I.bindBuffer(I.ELEMENT_ARRAY_BUFFER,null),L.texture&&I.deleteTexture(L.texture),L.nodeCache)for(var g=0;g<L.nodeCache.length;g++)I.deleteTexture(L.nodeCache[g].texture);I.deleteProgram(L),L=a}F=a;var w;if("cubemap"==U&&0!=(N[0].width&N[0].width-1)&&(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)||navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 9_/)||navigator.userAgent.match(/Trident.*rv[ :]*11\./))||I||(I=_.getContext("experimental-webgl",{alpha:!1,depth:!1})),!I&&("multires"==U&&N.hasOwnProperty("fallbackPath")||"cubemap"==U)&&("WebkitAppearance"in t.documentElement.style||navigator.userAgent.match(/Trident.*rv[ :]*11\./)||-1!==navigator.appVersion.indexOf("MSIE 10"))){S&&o.removeChild(S),S=t.createElement("div"),S.className="pnlm-world";var y;y=N.basePath?N.basePath+N.fallbackPath:N.fallbackPath;var x=["f","r","b","l","u","d"],b=0,E=function(){var e=t.createElement("canvas");e.className="pnlm-face pnlm-"+x[this.side]+"face",S.appendChild(e);var a=e.getContext("2d");e.style.width=this.width+4+"px",e.style.height=this.height+4+"px",e.width=this.width+4,e.height=this.height+4,a.drawImage(this,2,2);var n,i,r=a.getImageData(0,0,e.width,e.height),s=r.data;for(n=2;n<e.width-2;n++)for(i=0;i<4;i++)s[4*(n+e.width)+i]=s[4*(n+2*e.width)+i],s[4*(n+e.width*(e.height-2))+i]=s[4*(n+e.width*(e.height-3))+i];for(n=2;n<e.height-2;n++)for(i=0;i<4;i++)s[4*(n*e.width+1)+i]=s[4*(n*e.width+2)+i],s[4*((n+1)*e.width-2)+i]=s[4*((n+1)*e.width-3)+i];for(i=0;i<4;i++)s[4*(e.width+1)+i]=s[4*(2*e.width+2)+i],s[4*(2*e.width-2)+i]=s[4*(3*e.width-3)+i],s[4*(e.width*(e.height-2)+1)+i]=s[4*(e.width*(e.height-3)+2)+i],s[4*(e.width*(e.height-1)-2)+i]=s[4*(e.width*(e.height-2)-3)+i];for(n=1;n<e.width-1;n++)for(i=0;i<4;i++)s[4*n+i]=s[4*(n+e.width)+i],s[4*(n+e.width*(e.height-1))+i]=s[4*(n+e.width*(e.height-2))+i];for(n=1;n<e.height-1;n++)for(i=0;i<4;i++)s[n*e.width*4+i]=s[4*(n*e.width+1)+i],s[4*((n+1)*e.width-1)+i]=s[4*((n+1)*e.width-2)+i];for(i=0;i<4;i++)s[i]=s[4*(e.width+1)+i],s[4*(e.width-1)+i]=s[4*(2*e.width-2)+i],s[e.width*(e.height-1)*4+i]=s[4*(e.width*(e.height-2)+1)+i],s[4*(e.width*e.height-1)+i]=s[4*(e.width*(e.height-1)-2)+i];a.putImageData(r,0,0),6==++b&&(D=this.width,o.appendChild(S),m())};for(w=0;w<6;w++){var M=new Image;M.crossOrigin="anonymous",M.side=w,M.onload=E,M.src="multires"==U?encodeURI(y.replace("%s",x[w])+"."+N.extension):encodeURI(N[w].src)}}else{if(!I)throw console.log("Error: no WebGL support detected!"),{type:"no webgl"};N.basePath?N.fullpath=N.basePath+N.path:N.fullpath=N.path,N.invTileResolution=1/N.tileResolution;var R=p();for(k=[],w=0;w<6;w++)k[w]=R.slice(12*w,12*w+12),R=p();var P,T;if("equirectangular"==U){if(P=Math.max(N.width,N.height),T=I.getParameter(I.MAX_TEXTURE_SIZE),P>T)throw console.log("Error: The image is too big; it's "+P+"px wide, but this device's maximum supported width is "+T+"px."),{type:"webgl size error",width:P,maxWidth:T}}else if("cubemap"==U&&(P=N[0].width,T=I.getParameter(I.MAX_CUBE_MAP_TEXTURE_SIZE),P>T))throw console.log("Error: The cube face image is too big; it's "+P+"px wide, but this device's maximum supported width is "+T+"px."),{type:"webgl size error",width:P,maxWidth:T};v===a||v.horizonPitch===a&&v.horizonRoll===a||(F=[v.horizonPitch==a?0:v.horizonPitch,v.horizonRoll==a?0:v.horizonRoll]);var G=I.TEXTURE_2D;I.viewport(0,0,_.width,_.height),C=I.createShader(I.VERTEX_SHADER);var Y=n;"multires"==U&&(Y=i),I.shaderSource(C,Y),I.compileShader(C),A=I.createShader(I.FRAGMENT_SHADER);var X=l;if("cubemap"==U?(G=I.TEXTURE_CUBE_MAP,X=s):"multires"==U&&(X=h),I.shaderSource(A,X),I.compileShader(A),L=I.createProgram(),I.attachShader(L,C),I.attachShader(L,A),I.linkProgram(L),I.getShaderParameter(C,I.COMPILE_STATUS)||console.log(I.getShaderInfoLog(C)),I.getShaderParameter(A,I.COMPILE_STATUS)||console.log(I.getShaderInfoLog(A)),I.getProgramParameter(L,I.LINK_STATUS)||console.log(I.getProgramInfoLog(L)),I.useProgram(L),L.drawInProgress=!1,L.texCoordLocation=I.getAttribLocation(L,"a_texCoord"),I.enableVertexAttribArray(L.texCoordLocation),"multires"!=U){if(z||(z=I.createBuffer()),I.bindBuffer(I.ARRAY_BUFFER,z),I.bufferData(I.ARRAY_BUFFER,new Float32Array([-1,1,1,1,1,-1,-1,1,1,-1,-1,-1]),I.STATIC_DRAW),I.vertexAttribPointer(L.texCoordLocation,2,I.FLOAT,!1,0,0),L.aspectRatio=I.getUniformLocation(L,"u_aspectRatio"),I.uniform1f(L.aspectRatio,_.width/_.height),L.psi=I.getUniformLocation(L,"u_psi"),L.theta=I.getUniformLocation(L,"u_theta"),L.f=I.getUniformLocation(L,"u_f"),L.h=I.getUniformLocation(L,"u_h"),L.v=I.getUniformLocation(L,"u_v"),L.vo=I.getUniformLocation(L,"u_vo"),L.rot=I.getUniformLocation(L,"u_rot"),I.uniform1f(L.h,d/(2*Math.PI)),I.uniform1f(L.v,u/Math.PI),I.uniform1f(L.vo,f/Math.PI*2),"equirectangular"==U){L.backgroundColor=I.getUniformLocation(L,"u_backgroundColor");var q=v.backgroundColor?v.backgroundColor:[0,0,0];I.uniform4fv(L.backgroundColor,q.concat([1]))}L.texture=I.createTexture(),I.bindTexture(G,L.texture),"cubemap"==U?(I.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_X,0,I.RGB,I.RGB,I.UNSIGNED_BYTE,N[1]),I.texImage2D(I.TEXTURE_CUBE_MAP_NEGATIVE_X,0,I.RGB,I.RGB,I.UNSIGNED_BYTE,N[3]),I.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_Y,0,I.RGB,I.RGB,I.UNSIGNED_BYTE,N[4]),I.texImage2D(I.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,I.RGB,I.RGB,I.UNSIGNED_BYTE,N[5]),I.texImage2D(I.TEXTURE_CUBE_MAP_POSITIVE_Z,0,I.RGB,I.RGB,I.UNSIGNED_BYTE,N[0]),I.texImage2D(I.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,I.RGB,I.RGB,I.UNSIGNED_BYTE,N[2])):I.texImage2D(G,0,I.RGB,I.RGB,I.UNSIGNED_BYTE,N),I.texParameteri(G,I.TEXTURE_WRAP_S,I.CLAMP_TO_EDGE),I.texParameteri(G,I.TEXTURE_WRAP_T,I.CLAMP_TO_EDGE),I.texParameteri(G,I.TEXTURE_MIN_FILTER,I.LINEAR),I.texParameteri(G,I.TEXTURE_MAG_FILTER,I.LINEAR)}else L.vertPosLocation=I.getAttribLocation(L,"a_vertCoord"),I.enableVertexAttribArray(L.vertPosLocation),j||(j=I.createBuffer()),B||(B=I.createBuffer()),H||(H=I.createBuffer()),I.bindBuffer(I.ARRAY_BUFFER,B),I.bufferData(I.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1]),I.STATIC_DRAW),I.bindBuffer(I.ELEMENT_ARRAY_BUFFER,H),I.bufferData(I.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),I.STATIC_DRAW),L.perspUniform=I.getUniformLocation(L,"u_perspMatrix"),L.cubeUniform=I.getUniformLocation(L,"u_cubeMatrix"),L.level=-1,L.currentNodes=[],L.nodeCache=[],L.nodeCacheTimestamp=0;if(0!==I.getError())throw console.log("Error: Something went wrong with WebGL!"),{type:"webgl error"};m()}},this.destroy=function(){if(o!==a&&(_!==a&&o.removeChild(_),S!==a&&o.removeChild(S)),I){var e=I.getExtension("WEBGL_lose_context");e&&e.loseContext()}},this.resize=function(){var t=e.devicePixelRatio||1;_.width=_.clientWidth*t,_.height=_.clientHeight*t,I&&(I.viewport(0,0,_.width,_.height),"multires"!=U&&I.uniform1f(L.aspectRatio,_.width/_.height))},this.resize(),this.render=function(t,o,n,i){var s,l,h,p=0;if(i===a&&(i={}),i.roll&&(p=i.roll),F!==a){var x=F[0],R=F[1],P=t,T=o,C=Math.cos(R)*Math.sin(t)*Math.sin(x)+Math.cos(t)*(Math.cos(x)*Math.cos(o)+Math.sin(R)*Math.sin(x)*Math.sin(o)),A=-Math.sin(t)*Math.sin(R)+Math.cos(t)*Math.cos(R)*Math.sin(o),z=Math.cos(R)*Math.cos(x)*Math.sin(t)+Math.cos(t)*(-Math.cos(o)*Math.sin(x)+Math.cos(x)*Math.sin(R)*Math.sin(o));t=Math.asin(Math.max(Math.min(z,1),-1)),o=Math.atan2(A,C);var j=[Math.cos(P)*(Math.sin(R)*Math.sin(x)*Math.cos(T)-Math.cos(x)*Math.sin(T)),Math.cos(P)*Math.cos(R)*Math.cos(T),Math.cos(P)*(Math.cos(x)*Math.sin(R)*Math.cos(T)+Math.sin(T)*Math.sin(x))],B=[-Math.cos(t)*Math.sin(o),Math.cos(t)*Math.cos(o)],H=Math.acos(Math.max(Math.min((j[0]*B[0]+j[1]*B[1])/(Math.sqrt(j[0]*j[0]+j[1]*j[1]+j[2]*j[2])*Math.sqrt(B[0]*B[0]+B[1]*B[1])),1),-1));j[2]<0&&(H=2*Math.PI-H),p+=H}if(I||"multires"!=U&&"cubemap"!=U){if("multires"!=U){var G=2*Math.atan(Math.tan(.5*n)/(_.width/_.height));s=1/Math.tan(.5*G),I.uniform1f(L.psi,o),I.uniform1f(L.theta,t),I.uniform1f(L.rot,p),I.uniform1f(L.f,s),!0===O&&"equirectangular"==U&&(I.bindTexture(I.TEXTURE_2D,L.texture),I.texImage2D(I.TEXTURE_2D,0,I.RGB,I.RGB,I.UNSIGNED_BYTE,N)),I.drawArrays(I.TRIANGLES,0,6)}else{var Y=y(n,_.width/_.height,.1,100);E(n);var X=m();X=v(X,-p,"z"),X=v(X,-t,"x"),X=v(X,o,"y"),X=g(X),I.uniformMatrix4fv(L.perspUniform,!1,new Float32Array(w(Y))),I.uniformMatrix4fv(L.cubeUniform,!1,new Float32Array(w(X)));var q=M(Y,X);if(L.nodeCache.sort(r),L.nodeCache.length>200&&L.nodeCache.length>L.currentNodes.length+50)for(var W=L.nodeCache.splice(200,L.nodeCache.length-200),l=0;l<W.length;l++)I.deleteTexture(W[l].texture);L.currentNodes=[];var Z=["f","b","u","d","l","r"];for(h=0;h<6;h++)f(q,new u(k[h],Z[h],1,0,0,N.fullpath),t,o,n);for(L.currentNodes.sort(c),l=0;l<L.currentNodes.length;l++)if(!L.currentNodes[l].texture){setTimeout(b(L.currentNodes[l]),0);break}d()}if(i.returnImage!==a)return _.toDataURL("image/png")}else{h=D/2;var V={f:"translate3d(-"+(h+2)+"px, -"+(h+2)+"px, -"+h+"px)",b:"translate3d("+(h+2)+"px, -"+(h+2)+"px, "+h+"px) rotateX(180deg) rotateZ(180deg)",u:"translate3d(-"+(h+2)+"px, -"+h+"px, "+(h+2)+"px) rotateX(270deg)",d:"translate3d(-"+(h+2)+"px, "+h+"px, -"+(h+2)+"px) rotateX(90deg)",l:"translate3d(-"+h+"px, -"+(h+2)+"px, "+(h+2)+"px) rotateX(180deg) rotateY(90deg) rotateZ(180deg)",r:"translate3d("+h+"px, -"+(h+2)+"px, -"+(h+2)+"px) rotateY(270deg)"};s=1/Math.tan(n/2);var J=s*_.width/(e.devicePixelRatio||1)/2+"px",K="perspective("+J+") translateZ("+J+") rotateX("+t+"rad) rotateY("+o+"rad) ",Q=Object.keys(V);for(l=0;l<6;l++){var $=S.querySelector(".pnlm-"+Q[l]+"face").style;$.webkitTransform=K+V[Q[l]],$.transform=K+V[Q[l]]}}},this.isLoading=function(){if(I&&"multires"==U)for(var e=0;e<L.currentNodes.length;e++)if(!L.currentNodes[e].textureLoaded)return!0;return!1},this.getCanvas=function(){return _};var G=function(){function e(){var e=this;this.texture=this.callback=null,this.image=new Image,this.image.crossOrigin="anonymous",this.image.addEventListener("load",function(){x(e.image,e.texture),e.callback(e.texture),a(e)})}function t(e,t,a){this.src=e,this.texture=t,this.callback=a}function a(e){if(i.length){var t=i.shift();e.loadTexture(t.src,t.texture,t.callback)}else n[o++]=e}var o=4,n={},i=[];e.prototype.loadTexture=function(e,t,a){this.texture=t,this.callback=a,this.image.src=e};for(var r=0;r<o;r++)n[r]=new e;return function(e,a){var r=I.createTexture();return o?n[--o].loadTexture(e,r,a):i.push(new t(e,r,a)),r}}()}var n=["attribute vec2 a_texCoord;","varying vec2 v_texCoord;","void main() {","gl_Position = vec4(a_texCoord, 0.0, 1.0);","v_texCoord = a_texCoord;","}"].join(""),i=["attribute vec3 a_vertCoord;","attribute vec2 a_texCoord;","uniform mat4 u_cubeMatrix;","uniform mat4 u_perspMatrix;","varying mediump vec2 v_texCoord;","void main(void) {","gl_Position = u_perspMatrix * u_cubeMatrix * vec4(a_vertCoord, 1.0);","v_texCoord = a_texCoord;","}"].join(""),r=["precision mediump float;","uniform float u_aspectRatio;","uniform float u_psi;","uniform float u_theta;","uniform float u_f;","uniform float u_h;","uniform float u_v;","uniform float u_vo;","uniform float u_rot;","const float PI = 3.14159265358979323846264;","uniform sampler2D u_image;","uniform samplerCube u_imageCube;","varying vec2 v_texCoord;","uniform vec4 u_backgroundColor;","void main() {","float x = v_texCoord.x * u_aspectRatio;","float y = v_texCoord.y;","float sinrot = sin(u_rot);","float cosrot = cos(u_rot);","float rot_x = x * cosrot - y * sinrot;","float rot_y = x * sinrot + y * cosrot;","float sintheta = sin(u_theta);","float costheta = cos(u_theta);","float a = u_f * costheta - rot_y * sintheta;","float root = sqrt(rot_x * rot_x + a * a);","float lambda = atan(rot_x / root, a / root) + u_psi;","float phi = atan((rot_y * costheta + u_f * sintheta) / root);"].join("\n"),s=r+["float cosphi = cos(phi);","gl_FragColor = textureCube(u_imageCube, vec3(cosphi*sin(lambda), sin(phi), cosphi*cos(lambda)));","}"].join("\n"),l=r+["lambda = mod(lambda + PI, PI * 2.0) - PI;","vec2 coord = vec2(lambda / PI, phi / (PI / 2.0));","if(coord.x < -u_h || coord.x > u_h || coord.y < -u_v + u_vo || coord.y > u_v + u_vo)","gl_FragColor = u_backgroundColor;","else","gl_FragColor = texture2D(u_image, vec2((coord.x + u_h) / (u_h * 2.0), (-coord.y + u_v + u_vo) / (u_v * 2.0)));","}"].join("\n"),h=["varying mediump vec2 v_texCoord;","uniform sampler2D u_sampler;","void main(void) {","gl_FragColor = texture2D(u_sampler, v_texCoord);","}"].join("");return{renderer:function(e,t,a,n){return new o(e,t,a,n)}}}(window,document),window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}()),window.jdpanorama=function(e,t,a){"use strict";function o(o,n){function i(t){e.removeEventListener("deviceorientation",i),t&&null!==t.alpha&&null!==t.beta&&null!==t.gamma?(Xe.container.appendChild(Xe.orientation),qe=!0,We&&ie()):qe=!1}function r(){var n=t.createElement("div");if(n.innerHTML="\x3c!--[if lte IE 9]><i></i><![endif]--\x3e",1==n.getElementsByTagName("i").length)return void c();pe=le.hfov,me=le.pitch;var i,r;if("cubemap"==le.type){for(de=[],i=0;i<6;i++)de.push(new Image),de[i].crossOrigin="anonymous";Ge.load.lbox.style.display="block",Ge.load.lbar.style.display="none"}else if("multires"==le.type){var d=JSON.parse(JSON.stringify(le.multiRes));le.basePath&&le.multiRes.basePath&&!/^(?:[a-z]+:)?\/\//i.test(le.multiRes.basePath)?d.basePath=le.basePath+le.multiRes.basePath:le.multiRes.basePath?d.basePath=le.multiRes.basePath:le.basePath&&(d.basePath=le.basePath),de=d}else if(!0===le.dynamic)de=le.panorama;else{if(le.panorama===a)return void c("No panorama image was specified.");de=new Image}if("cubemap"==le.type){var u=6,f=function(){0==--u&&l()},p=function(e){var a=t.createElement("a");a.href=e.target.src,a.innerHTML=a.href,c("The file "+a.outerHTML+" could not be accessed.")};for(i=0;i<de.length;i++)de[i].onload=f,de[i].onerror=p,r=le.cubeMap[i],le.basePath&&!s(r)&&(r=le.basePath+r),de[i].src=encodeURI(r)}else if("multires"==le.type)l();else if(r="",le.basePath&&(r=le.basePath),!0!==le.dynamic){r=s(le.panorama)?le.panorama:r+le.panorama,de.onload=function(){e.URL.revokeObjectURL(this.src),l()};var m=new XMLHttpRequest;m.onloadend=function(){if(200!=m.status){var e=t.createElement("a");e.href=encodeURI(r),e.innerHTML=e.href,c("The file "+e.outerHTML+" could not be accessed.")}h(this.response),Ge.load.msg.innerHTML=""},m.onprogress=function(e){if(e.lengthComputable){var t=e.loaded/e.total*100;Ge.load.lbarFill.style.width=t+"%";var a,o,n;e.total>1e6?(a="MB",o=(e.loaded/1e6).toFixed(2),n=(e.total/1e6).toFixed(2)):e.total>1e3?(a="kB",o=(e.loaded/1e3).toFixed(1),n=(e.total/1e3).toFixed(1)):(a="B",o=e.loaded,n=e.total),Ge.load.msg.innerHTML=o+" / "+n+" "+a}else Ge.load.lbox.style.display="block",Ge.load.lbar.style.display="none"};try{m.open("GET",r,!0)}catch(e){c("There is something wrong with the panorama URL.")}m.responseType="blob",m.setRequestHeader("Accept","image/*,*/*;q=0.9"),m.send()}o.classList.add("jdpano-grab"),o.classList.remove("jdpano-grabbing")}function s(e){return new RegExp("^(?:[a-z]+:)?//","i").test(e)||"/"==e[0]||"blob:"==e.slice(0,5)}function l(){he||(he=new libpanorama.renderer(Be)),Ie||(Ie=!0,He.addEventListener("mousedown",f,!1),t.addEventListener("mousemove",v,!1),t.addEventListener("mouseup",g,!1),le.mouseZoom&&(o.addEventListener("mousewheel",R,!1),o.addEventListener("DOMMouseScroll",R,!1)),le.doubleClickZoom&&He.addEventListener("dblclick",p,!1),o.addEventListener("mozfullscreenchange",J,!1),o.addEventListener("webkitfullscreenchange",J,!1),o.addEventListener("msfullscreenchange",J,!1),o.addEventListener("fullscreenchange",J,!1),e.addEventListener("resize",D,!1),e.addEventListener("orientationchange",D,!1),o.addEventListener("keydown",P,!1),o.addEventListener("keyup",_,!1),o.addEventListener("blur",T,!1),t.addEventListener("mouseleave",g,!1),He.addEventListener("touchstart",w,!1),He.addEventListener("touchmove",y,!1),He.addEventListener("touchend",x,!1),He.addEventListener("pointerdown",b,!1),He.addEventListener("pointermove",E,!1),He.addEventListener("pointerup",M,!1),He.addEventListener("pointerleave",M,!1),e.navigator.pointerEnabled&&(o.style.touchAction="none")),j(),setTimeout(function(){Le=!0},500)}function h(t){var o=new FileReader;o.addEventListener("loadend",function(){var n=o.result;if(navigator.userAgent.toLowerCase().match(/(iphone|ipod|ipad).* os 8_/)){var i=n.indexOf("\xff\xc2");(i<0||i>65536)&&c("Due to iOS 8's broken WebGL implementation, only progressive encoded JPEGs work for your device (this panorama uses standard encoding).")}var r=n.indexOf("<x:xmpmeta");if(r>-1&&!0!==le.ignoreGPanoXMP){var s=n.substring(r,n.indexOf("</x:xmpmeta>")+12),l=function(e){var t;return s.indexOf(e+'="')>=0?(t=s.substring(s.indexOf(e+'="')+e.length+2),t=t.substring(0,t.indexOf('"'))):s.indexOf(e+">")>=0&&(t=s.substring(s.indexOf(e+">")+e.length+1),t=t.substring(0,t.indexOf("<"))),t!==a?Number(t):null},h={fullWidth:l("GPano:FullPanoWidthPixels"),croppedWidth:l("GPano:CroppedAreaImageWidthPixels"),fullHeight:l("GPano:FullPanoHeightPixels"),croppedHeight:l("GPano:CroppedAreaImageHeightPixels"),topPixels:l("GPano:CroppedAreaTopPixels"),heading:l("GPano:PoseHeadingDegrees"),horizonPitch:l("GPano:PosePitchDegrees"),horizonRoll:l("GPano:PoseRollDegrees")};null!==h.fullWidth&&null!==h.croppedWidth&&null!==h.fullHeight&&null!==h.croppedHeight&&null!==h.topPixels&&(Ne.indexOf("haov")<0&&(le.haov=h.croppedWidth/h.fullWidth*360),Ne.indexOf("vaov")<0&&(le.vaov=h.croppedHeight/h.fullHeight*180),Ne.indexOf("vOffset")<0&&(le.vOffset=-180*((h.topPixels+h.croppedHeight/2)/h.fullHeight-.5)),null!==h.heading&&Ne.indexOf("northOffset")<0&&(le.northOffset=h.heading,!1!==le.compass&&(le.compass=!0)),null!==h.horizonPitch&&null!==h.horizonRoll&&(Ne.indexOf("horizonPitch")<0&&(le.horizonPitch=h.horizonPitch),Ne.indexOf("horizonRoll")<0&&(le.horizonRoll=h.horizonRoll)))}de.src=e.URL.createObjectURL(t)}),o.readAsBinaryString!==a?o.readAsBinaryString(t):o.readAsText(t)}function c(e){e===a&&(e="Your browser does not have the necessary WebGL support to display this panorama."),Ge.errorMsg.innerHTML="<p>"+e+"</p>",Xe.load.style.display="none",Ge.load.box.style.display="none",Ge.errorMsg.style.display="table",_e=!0,Be.style.display="none",se("error",e)}function d(){_e&&(Ge.load.box.style.display="none",Ge.errorMsg.style.display="none",_e=!1,se("errorcleared"))}function u(e){var t=o.getBoundingClientRect(),a={};return a.x=e.clientX-t.left,a.y=e.clientY-t.top,a}function f(e){if(e.preventDefault(),o.focus(),Te&&le.draggable){var t=u(e);if(le.hotSpotDebug){var a=m(e);console.log("Pitch: "+a[0]+", Yaw: "+a[1]+", Center Pitch: "+le.pitch+", Center Yaw: "+le.yaw+", HFOV: "+le.hfov)}te(),ne(),le.roll=0,Ce.hfov=0,ge=!0,we=Date.now(),ye=t.x,xe=t.y,Ee=le.yaw,Me=le.pitch,o.classList.add("jdpano-grabbing"),o.classList.remove("jdpano-grab"),se("mousedown",e),S()}}function p(e){if(le.minHfov===le.hfov)ve.setHfov(pe,1e3);else{var t=m(e);ve.lookAt(t[0],t[1],le.minHfov,1e3)}}function m(t){var a=u(t),o=he.getCanvas(),n=o.width/(e.devicePixelRatio||1),i=o.height/(e.devicePixelRatio||1),r=a.x/n*2-1,s=(1-a.y/i*2)*i/n,l=1/Math.tan(le.hfov*Math.PI/360),h=Math.sin(le.pitch*Math.PI/180),c=Math.cos(le.pitch*Math.PI/180),d=l*c-s*h,f=Math.sqrt(r*r+d*d);return[180*Math.atan((s*c+l*h)/f)/Math.PI,180*Math.atan2(r/f,d/f)/Math.PI+le.yaw]}function v(t){if(ge&&Te){we=Date.now();var a=he.getCanvas(),o=a.width/(e.devicePixelRatio||1),n=a.height/(e.devicePixelRatio||1),i=u(t),r=180*(Math.atan(ye/o*2-1)-Math.atan(i.x/o*2-1))/Math.PI*le.hfov/90+Ee;Ce.yaw=(r-le.yaw)%360*.2,le.yaw=r;var s=2*Math.atan(Math.tan(le.hfov/360*Math.PI)*n/o)*180/Math.PI,l=180*(Math.atan(i.y/n*2-1)-Math.atan(xe/n*2-1))/Math.PI*s/90+Me;Ce.pitch=.2*(l-le.pitch),le.pitch=l}}function g(e){ge&&(ge=!1,Date.now()-we>15&&(Ce.pitch=Ce.yaw=0),o.classList.add("jdpano-grab"),o.classList.remove("jdpano-grabbing"),we=Date.now(),se("mouseup",e))}function w(e){if(Te&&le.draggable){te(),ne(),le.roll=0,Ce.hfov=0;var t=u(e.targetTouches[0]);if(ye=t.x,xe=t.y,2==e.targetTouches.length){var a=u(e.targetTouches[1]);ye+=.5*(a.x-t.x),xe+=.5*(a.y-t.y),be=Math.sqrt((t.x-a.x)*(t.x-a.x)+(t.y-a.y)*(t.y-a.y))}ge=!0,we=Date.now(),Ee=le.yaw,Me=le.pitch,S()}}function y(e){if(e.preventDefault(),Te&&(we=Date.now()),ge&&Te){var t=u(e.targetTouches[0]),a=t.x,o=t.y;if(2==e.targetTouches.length&&-1!=be){var n=u(e.targetTouches[1]);a+=.5*(n.x-t.x),o+=.5*(n.y-t.y);var i=Math.sqrt((t.x-n.x)*(t.x-n.x)+(t.y-n.y)*(t.y-n.y));ee(le.hfov+.1*(be-i)),be=i}var r=le.hfov/360,s=(ye-a)*r+Ee;Ce.yaw=(s-le.yaw)%360*.2,le.yaw=s;var l=(o-xe)*r+Me;Ce.pitch=.2*(l-le.pitch),le.pitch=l}}function x(){ge=!1,Date.now()-we>150&&(Ce.pitch=Ce.yaw=0),be=-1,we=Date.now()}function b(e){"touch"==e.pointerType&&(Ve.push(e.pointerId),Je.push({clientX:e.clientX,clientY:e.clientY}),e.targetTouches=Je,w(e),e.preventDefault())}function E(e){if("touch"==e.pointerType)for(var t=0;t<Ve.length;t++)if(e.pointerId==Ve[t])return Je[t]={clientX:e.clientX,clientY:e.clientY},e.targetTouches=Je,void y(e)}function M(e){if("touch"==e.pointerType){for(var t=!1,o=0;o<Ve.length;o++)e.pointerId==Ve[o]&&(Ve[o]=a),Ve[o]&&(t=!0);t||(Ve=[],Je=[],x()),e.preventDefault()}}function R(e){Te&&("fullscreenonly"!=le.mouseZoom||Pe)&&(e.preventDefault(),te(),we=Date.now(),e.wheelDeltaY?(ee(le.hfov-.05*e.wheelDeltaY),Ce.hfov=e.wheelDelta<0?1:-1):e.wheelDelta?(ee(le.hfov-.05*e.wheelDelta),Ce.hfov=e.wheelDelta<0?1:-1):e.detail&&(ee(le.hfov+1.5*e.detail),Ce.hfov=e.detail>0?1:-1),S())}function P(e){te(),we=Date.now(),ne(),le.roll=0;var t=e.which||e.keycode;je.indexOf(t)<0||(e.preventDefault(),27==t?Pe&&V():L(t,!0))}function T(){for(var e=0;e<10;e++)Re[e]=!1}function _(e){var t=e.which||e.keycode;je.indexOf(t)<0||(e.preventDefault(),L(t,!1))}function L(e,t){var a=!1;switch(e){case 109:case 189:case 17:case 173:Re[0]!=t&&(a=!0),Re[0]=t;break;case 107:case 187:case 16:case 61:Re[1]!=t&&(a=!0),Re[1]=t;break;case 38:Re[2]!=t&&(a=!0),Re[2]=t;break;case 87:Re[6]!=t&&(a=!0),Re[6]=t;break;case 40:Re[3]!=t&&(a=!0),Re[3]=t;break;case 83:Re[7]!=t&&(a=!0),Re[7]=t;break;case 37:Re[4]!=t&&(a=!0),Re[4]=t;break;case 65:Re[8]!=t&&(a=!0),Re[8]=t;break;case 39:Re[5]!=t&&(a=!0),Re[5]=t;break;case 68:Re[9]!=t&&(a=!0),Re[9]=t}a&&t&&(ue="undefined"!=typeof performance&&performance.now()?performance.now():Date.now(),S())}function I(){if(Te){var e,t=!1,o=le.pitch,n=le.yaw,i=le.hfov;e="undefined"!=typeof performance&&performance.now()?performance.now():Date.now(),ue===a&&(ue=e);var r=(e-ue)*le.hfov/1700;if(r=Math.min(r,1),Re[0]&&!0===le.keyboardZoom&&(ee(le.hfov+(.8*Ce.hfov+.5)*r),t=!0),Re[1]&&!0===le.keyboardZoom&&(ee(le.hfov+(.8*Ce.hfov-.2)*r),t=!0),(Re[2]||Re[6])&&(le.pitch+=(.8*Ce.pitch+.2)*r,t=!0),(Re[3]||Re[7])&&(le.pitch+=(.8*Ce.pitch-.2)*r,t=!0),(Re[4]||Re[8])&&(le.yaw+=(.8*Ce.yaw-.2)*r,t=!0),(Re[5]||Re[9])&&(le.yaw+=(.8*Ce.yaw+.2)*r,t=!0),t&&(we=Date.now()),Date.now(),le.autoRotate){if(e-ue>.001){var s=(e-ue)/1e3,l=(Ce.yaw/s*r-.2*le.autoRotate)*s;l=(-le.autoRotate>0?1:-1)*Math.min(Math.abs(le.autoRotate*s),Math.abs(l)),le.yaw+=l}le.autoRotateStopDelay&&(le.autoRotateStopDelay-=e-ue,le.autoRotateStopDelay<=0&&(le.autoRotateStopDelay=!1,Se=le.autoRotate,le.autoRotate=0))}if(ke.pitch&&(C("pitch"),o=le.pitch),ke.yaw&&(C("yaw"),n=le.yaw),ke.hfov&&(C("hfov"),i=le.hfov),r>0&&!le.autoRotate){Re[4]||Re[5]||Re[8]||Re[9]||ke.yaw||(le.yaw+=Ce.yaw*r*.85),Re[2]||Re[3]||Re[6]||Re[7]||ke.pitch||(le.pitch+=Ce.pitch*r*.85),Re[0]||Re[1]||ke.hfov||ee(le.hfov+Ce.hfov*r*.85)}if(ue=e,r>0){Ce.yaw=.8*Ce.yaw+(le.yaw-n)/r*.2,Ce.pitch=.8*Ce.pitch+(le.pitch-o)/r*.2,Ce.hfov=.8*Ce.hfov+(le.hfov-i)/r*.2;var h=le.autoRotate?Math.abs(le.autoRotate):5;Ce.yaw=Math.min(h,Math.max(Ce.yaw,-h)),Ce.pitch=Math.min(h,Math.max(Ce.pitch,-h)),Ce.hfov=Math.min(h,Math.max(Ce.hfov,-h))}Re[0]&&Re[0]&&(Ce.hfov=0),(Re[2]||Re[6])&&(Re[3]||Re[7])&&(Ce.pitch=0),(Re[4]||Re[8])&&(Re[5]||Re[9])&&(Ce.yaw=0)}}function C(e){var t=ke[e],a=Math.min(1,Math.max((Date.now()-t.startTime)/1e3/(t.duration/1e3),0)),o=t.startPosition+le.animationTimingFunction(a)*(t.endPosition-t.startPosition);if(t.endPosition>t.startPosition&&o>=t.endPosition||t.endPosition<t.startPosition&&o<=t.endPosition){o=t.endPosition,Ce[e]=0;var n=ke[e].callback,i=ke[e].callbackArgs;delete ke[e],"function"==typeof n&&n(i)}le[e]=o}function A(e){return e<.5?2*e*e:(4-2*e)*e-1}function D(){J()}function S(){Ae||(Ae=!0,k())}function k(){if(F(),fe&&clearTimeout(fe),ge||De)requestAnimationFrame(k);else if(Re[0]||Re[1]||Re[2]||Re[3]||Re[4]||Re[5]||Re[6]||Re[7]||Re[8]||Re[9]||le.autoRotate||ke.pitch||ke.yaw||ke.hfov||Math.abs(Ce.yaw)>.01||Math.abs(Ce.pitch)>.01||Math.abs(Ce.hfov)>.01)I(),le.autoRotateInactivityDelay>=0&&Se&&Date.now()-we>le.autoRotateInactivityDelay&&!le.autoRotate&&(le.autoRotate=Se,ve.lookAt(me,a,pe,3e3)),requestAnimationFrame(k);else if(he&&(he.isLoading()||!0===le.dynamic&&Ue))requestAnimationFrame(k);else{Ae=!1,ue=a;var e=le.autoRotateInactivityDelay-(Date.now()-we);e>0?fe=setTimeout(function(){le.autoRotate=Se,ve.lookAt(me,a,pe,3e3),S()},e):le.autoRotateInactivityDelay>=0&&Se&&(le.autoRotate=Se,ve.lookAt(me,a,pe,3e3),S())}}function F(){var e;if(Te){le.yaw>180?le.yaw-=360:le.yaw<-180&&(le.yaw+=360),e=le.yaw;var t=le.maxYaw-le.minYaw,a=-180,o=180;t<360&&(a=le.minYaw+le.hfov/2,o=le.maxYaw-le.hfov/2,t<le.hfov&&(a=o=(a+o)/2)),le.yaw=Math.max(a,Math.min(o,le.yaw)),!1!==le.autoRotate&&e!=le.yaw&&(le.autoRotate*=-1);var n=he.getCanvas(),i=2*Math.atan(Math.tan(le.hfov/180*Math.PI*.5)/(n.width/n.height))/Math.PI*180,r=le.minPitch+i/2,s=le.maxPitch-i/2;le.maxPitch-le.minPitch<i&&(r=s=(r+s)/2),isNaN(r)&&(r=-90),isNaN(s)&&(s=90),le.pitch=Math.max(r,Math.min(s,le.pitch)),he.render(le.pitch*Math.PI/180,le.yaw*Math.PI/180,le.hfov*Math.PI/180,{roll:le.roll*Math.PI/180}),q(),le.compass&&(Ze.style.transform="rotate("+(-le.yaw-le.northOffset)+"deg)",
Ze.style.webkitTransform="rotate("+(-le.yaw-le.northOffset)+"deg)")}}function N(e,t,a,o){this.w=e,this.x=t,this.y=a,this.z=o}function U(e,t,a){var o=[t?t*Math.PI/180/2:0,a?a*Math.PI/180/2:0,e?e*Math.PI/180/2:0],n=[Math.cos(o[0]),Math.cos(o[1]),Math.cos(o[2])],i=[Math.sin(o[0]),Math.sin(o[1]),Math.sin(o[2])];return new N(n[0]*n[1]*n[2]-i[0]*i[1]*i[2],i[0]*n[1]*n[2]-n[0]*i[1]*i[2],n[0]*i[1]*n[2]+i[0]*n[1]*i[2],n[0]*n[1]*i[2]+i[0]*i[1]*n[2])}function O(t,a,o){var n=U(t,a,o);n=n.multiply(new N(Math.sqrt(.5),-Math.sqrt(.5),0,0));var i=e.orientation?-e.orientation*Math.PI/180/2:0;return n.multiply(new N(Math.cos(i),0,-Math.sin(i),0))}function z(e){var t=O(e.alpha,e.beta,e.gamma).toEulerAngles();le.pitch=t[0]/Math.PI*180,le.roll=-t[1]/Math.PI*180,le.yaw=-t[2]/Math.PI*180+le.northOffset}function j(){try{var e={};le.horizonPitch!==a&&(e.horizonPitch=le.horizonPitch*Math.PI/180),le.horizonRoll!==a&&(e.horizonRoll=le.horizonRoll*Math.PI/180),le.backgroundColor!==a&&(e.backgroundColor=le.backgroundColor),he.init(de,le.type,le.dynamic,le.haov*Math.PI/180,le.vaov*Math.PI/180,le.vOffset*Math.PI/180,B,e),!0!==le.dynamic&&(de=a)}catch(e){if("webgl error"==e.type||"no webgl"==e.type)c();else{if("webgl size error"!=e.type)throw c("Unknown error. Check developer console."),e;c("This panorama is too big for your device! It's "+e.width+"px wide, but your device only supports images up to "+e.maxWidth+"px wide. Try another device. (If you're the author, try scaling down the image.)")}}}function B(){if(le.sceneFadeDuration&&he.fadeImg!==a){he.fadeImg.style.opacity=0;var e=he.fadeImg;delete he.fadeImg,setTimeout(function(){Be.removeChild(e),se("scenechangefadedone")},le.sceneFadeDuration)}le.compass?Ze.style.display="inline":Ze.style.display="none",G(),Ge.load.box.style.display="none",ce!==a&&(Be.removeChild(ce),ce=a),Te=!0,se("load"),le.ready&&le.ready(),S()}function H(e){e.pitch=Number(e.pitch)||0,e.yaw=Number(e.yaw)||0;var a=t.createElement("div");a.className="jdpano-hotspot-base",e.cssClass?a.className+=" "+e.cssClass:a.className+=" jdpano-hotspot jdpano-sprite jdpano-"+re(e.type);var o=t.createElement("span");e.text&&(o.innerHTML=re(e.text));var n;if(e.video){var i=t.createElement("video"),r=e.video;le.basePath&&!s(r)&&(r=le.basePath+r),i.src=encodeURI(r),i.controls=!0,i.style.width=e.width+"px",Be.appendChild(a),o.appendChild(i)}else if(e.image){var r=e.image;le.basePath&&!s(r)&&(r=le.basePath+r),n=t.createElement("a"),n.href=encodeURI(e.URL?e.URL:r),n.target="_blank",o.appendChild(n);var l=t.createElement("img");l.src=encodeURI(r),l.style.width=e.width+"px",l.style.paddingTop="5px",Be.appendChild(a),n.appendChild(l),o.style.maxWidth="initial"}else e.URL?(n=t.createElement("a"),n.href=encodeURI(e.URL),n.target="_blank",Be.appendChild(n),a.style.cursor="pointer",o.style.cursor="pointer",n.appendChild(a)):(e.sceneId&&(a.onclick=a.ontouchend=function(){return a.clicked||(a.clicked=!0,oe(e.sceneId,e.targetPitch,e.targetYaw,e.targetHfov)),!1},a.style.cursor="pointer",o.style.cursor="pointer"),Be.appendChild(a));e.createTooltipFunc?e.createTooltipFunc(a,e.createTooltipArgs):(e.text||e.video||e.image)&&(a.classList.add("jdpano-tooltip"),a.appendChild(o),o.style.width=o.scrollWidth-20+"px",o.style.marginLeft=-(o.scrollWidth-a.offsetWidth)/2+"px",o.style.marginTop=-o.scrollHeight-12+"px"),e.clickHandler&&(a.addEventListener("click",function(t){e.clickHandler(e.clickHandlerArgs)},"false"),a.style.cursor="pointer",o.style.cursor="pointer"),e.div=a}function G(){Oe||(le.hotSpots?(le.hotSpots=le.hotSpots.sort(function(e,t){return e.pitch<t.pitch}),le.hotSpots.forEach(H)):le.hotSpots=[],Oe=!0,q())}function Y(){if(le.hotSpots)for(var e=0;e<le.hotSpots.length;e++){for(var t=le.hotSpots[e].div;t.parentNode!=Be;)t=t.parentNode;Be.removeChild(t),delete le.hotSpots[e].div}Oe=!1,delete le.hotSpots}function X(t){var a=Math.sin(t.pitch*Math.PI/180),o=Math.cos(t.pitch*Math.PI/180),n=Math.sin(le.pitch*Math.PI/180),i=Math.cos(le.pitch*Math.PI/180),r=Math.cos((-t.yaw+le.yaw)*Math.PI/180),s=a*n+o*r*i;if(t.yaw<=90&&t.yaw>-90&&s<=0||(t.yaw>90||t.yaw<=-90)&&s<=0)t.div.style.visibility="hidden";else{var l=Math.sin((-t.yaw+le.yaw)*Math.PI/180),h=Math.tan(le.hfov*Math.PI/360);t.div.style.visibility="visible";var c=he.getCanvas(),d=c.width/(e.devicePixelRatio||1),u=c.height/(e.devicePixelRatio||1),f=[-d/h*l*o/s/2,-d/h*(a*i-o*r*n)/s/2],p=Math.sin(le.roll*Math.PI/180),m=Math.cos(le.roll*Math.PI/180);f=[f[0]*m-f[1]*p,f[0]*p+f[1]*m],f[0]+=(d-t.div.offsetWidth)/2,f[1]+=(u-t.div.offsetHeight)/2;var v="translate("+f[0]+"px, "+f[1]+"px) translateZ(9999px) rotate("+le.roll+"deg)";t.div.style.webkitTransform=v,t.div.style.MozTransform=v,t.div.style.transform=v}}function q(){le.hotSpots.forEach(X)}function W(e){le={};var t,a=["haov","vaov","vOffset","northOffset","horizonPitch","horizonRoll"];Ne=[];for(t in ze)ze.hasOwnProperty(t)&&(le[t]=ze[t]);for(t in n.defaults)n.defaults.hasOwnProperty(t)&&(le[t]=n.defaults[t],a.indexOf(t)>=0&&Ne.push(t));if(null!==e&&""!==e&&n.scenes&&n.scenes[e]){var o=n.scenes[e];for(t in o)o.hasOwnProperty(t)&&(le[t]=o[t],a.indexOf(t)>=0&&Ne.push(t));le.scene=e}for(t in n)n.hasOwnProperty(t)&&(le[t]=n[t],a.indexOf(t)>=0&&Ne.push(t))}function Z(e){if((e=e||!1)&&"preview"in le){var o=le.preview;le.basePath&&!s(o)&&(o=le.basePath+o),ce=t.createElement("div"),ce.className="jdpano-preview-img",ce.style.backgroundImage="url('"+encodeURI(o)+"')",Be.appendChild(ce)}var n=le.title,i=le.author;e&&("previewTitle"in le&&(le.title=le.previewTitle),"previewAuthor"in le&&(le.author=le.previewAuthor)),le.hasOwnProperty("title")||(Ge.title.innerHTML=""),le.hasOwnProperty("author")||(Ge.author.innerHTML=""),Ge.container.style.display="none";for(var l in le)if(le.hasOwnProperty(l))switch(l){case"title":Ge.title.innerHTML=re(le[l]),Ge.container.style.display="inline";break;case"author":Ge.author.innerHTML="by "+re(le[l]),Ge.container.style.display="inline";break;case"fallback":Ge.errorMsg.innerHTML='<p>Your browser does not support WebGL.<br><a href="'+encodeURI(le[l])+'" target="_blank">Click here to view this panorama in an alternative viewer.</a></p>';break;case"hfov":ee(Number(le[l]));break;case"autoLoad":!0===le[l]&&he===a&&(Ge.load.box.style.display="inline",Xe.load.style.display="none",r());break;case"showZoomCtrl":le[l]&&0!=le.showControls?Xe.zoom.style.display="block":Xe.zoom.style.display="none";break;case"showFullscreenCtrl":le[l]&&0!=le.showControls&&("fullscreen"in t||"mozFullScreen"in t||"webkitIsFullScreen"in t||"msFullscreenElement"in t)?Xe.fullscreen.style.display="block":Xe.fullscreen.style.display="none";break;case"hotSpotDebug":le[l]?Ye.style.display="block":Ye.style.display="none";break;case"showControls":le[l]||(Xe.orientation.style.display="none",Xe.zoom.style.display="none",Xe.fullscreen.style.display="none");break;case"orientationOnByDefault":le[l]&&(qe===a?We=!0:!0===qe&&ie());break;case"loadButtonLabel":Xe.load.innerHTML="<p>"+re(le[l])+"</p>"}e&&(n?le.title=n:delete le.title,i?le.author=i:delete le.author)}function V(e){if(Te&&!_e||e)if(Pe)t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitCancelFullScreen?t.webkitCancelFullScreen():t.msExitFullscreen&&t.msExitFullscreen(),e&&(Pe=!1);else{try{o.requestFullscreen?o.requestFullscreen():o.mozRequestFullScreen?o.mozRequestFullScreen():o.msRequestFullscreen?o.msRequestFullscreen():o.webkitRequestFullScreen&&o.webkitRequestFullScreen()}catch(e){}e&&(Pe=!0)}}function J(){t.fullscreen||t.mozFullScreen||t.webkitIsFullScreen||t.msFullscreenElement?(Xe.fullscreen.classList.add("jdpano-fullscreen-toggle-button-active"),le.onFullScreen&&le.onFullScreen(),Pe=!0):(Xe.fullscreen.classList.remove("jdpano-fullscreen-toggle-button-active"),le.onCancelFullScreen&&le.onCancelFullScreen(),Pe=!1),he.resize(),ee(le.hfov),S()}function K(){Te&&(ee(le.hfov-5),S())}function Q(){Te&&(ee(le.hfov+5),S())}function $(e){var t=le.minHfov;return"multires"==le.type&&he&&(t=Math.min(t,he.getCanvas().width/(le.multiRes.cubeResolution/90*.9))),t>le.maxHfov?(console.log("HFOV bounds do not make sense (minHfov > maxHfov)."),le.hfov):e<t?t:e>le.maxHfov?le.maxHfov:e}function ee(e){le.hfov=$(e)}function te(){ke={},Se=le.autoRotate?le.autoRotate:Se,le.autoRotate=!1}function ae(){d(),Xe.load.style.display="none",Ge.load.box.style.display="inline",r()}function oe(e,t,o,i,r){Te=!1,ke={};var s,l,h,c;if(le.sceneFadeDuration&&!r){s=new Image,s.className="jdpano-fade-img",s.style.transition="opacity "+le.sceneFadeDuration/1e3+"s",s.style.width="100%",s.style.height="100%",s.onload=function(){oe(e,t,o,i,!0)};var d=he.render(le.pitch*Math.PI/180,le.yaw*Math.PI/180,le.hfov*Math.PI/180,{returnImage:!0});return d!==a&&(s.src=d),Be.appendChild(s),void(he.fadeImg=s)}l="same"===t?le.pitch:t,h="same"===o?le.yaw:"sameAzimuth"===o?le.yaw+le.northOffset-n.scenes[e].northOffset:o,c="same"===i?le.hfov:i,Y(),W(e),Ce.yaw=Ce.pitch=Ce.hfov=0,Z(),l!==a&&(le.pitch=l),h!==a&&(le.yaw=h),c!==a&&(le.hfov=c),se("scenechange",e),ae()}function ne(){e.removeEventListener("deviceorientation",z),Xe.orientation.classList.remove("jdpano-orientation-button-active"),De=!1}function ie(){De=!0,e.addEventListener("deviceorientation",z),Xe.orientation.classList.add("jdpano-orientation-button-active"),requestAnimationFrame(k)}function re(e){return n.escapeHTML?String(e).split(/&/g).join("&amp;").split('"').join("&quot;").split("'").join("&#39;").split("<").join("&lt;").split(">").join("&gt;").split("/").join("&#x2f;").split("\n").join("<br>"):String(e).split("\n").join("<br>")}function se(e){if(e in Fe)for(var t=0;t<Fe[e].length;t++)Fe[e][t].apply(null,[].slice.call(arguments,1))}var le,he,ce,de,ue,fe,pe,me,ve=this,ge=!1,we=Date.now(),ye=0,xe=0,be=-1,Ee=0,Me=0,Re=new Array(10),Pe=!1,Te=!1,_e=!1,Le=!1,Ie=!1,Ce={yaw:0,pitch:0,hfov:0},Ae=!1,De=!1,Se=0,ke={},Fe={},Ne=[],Ue=!1,Oe=!1,ze={hfov:100,minHfov:50,maxHfov:120,pitch:0,minPitch:a,maxPitch:a,yaw:0,minYaw:-180,maxYaw:180,roll:0,haov:360,vaov:180,vOffset:0,autoRotate:!1,autoRotateInactivityDelay:-1,autoRotateStopDelay:a,type:"equirectangular",northOffset:0,showFullscreenCtrl:!0,dynamic:!1,doubleClickZoom:!0,keyboardZoom:!0,mouseZoom:!0,showZoomCtrl:!0,autoLoad:!1,showControls:!0,orientationOnByDefault:!1,hotSpotDebug:!1,backgroundColor:[0,0,0],animationTimingFunction:A,loadButtonLabel:"Click to\nLoad\nPanorama",draggable:!0},je=[16,17,27,37,38,39,40,61,65,68,83,87,107,109,173,187,189];o="string"==typeof o?t.querySelector(o):o,o.classList.add("jdpano-container"),o.tabIndex=0;var Be=t.createElement("div");Be.className="jdpano-render-container",o.appendChild(Be);var He=t.createElement("div");He.className="jdpano-dragfix",o.appendChild(He);var Ge={},Ye=t.createElement("div");Ye.className="jdpano-sprite jdpano-hot-spot-debug-indicator",o.appendChild(Ye),Ge.container=t.createElement("div"),Ge.container.className="jdpano-panorama-info",Ge.title=t.createElement("div"),Ge.title.className="jdpano-title-box",Ge.container.appendChild(Ge.title),Ge.author=t.createElement("div"),Ge.author.className="jdpano-author-box",Ge.container.appendChild(Ge.author),o.appendChild(Ge.container),Ge.load={},Ge.load.box=t.createElement("div"),Ge.load.box.className="jdpano-load-box",Ge.load.box.innerHTML="<p>Loading...</p>",Ge.load.lbox=t.createElement("div"),Ge.load.lbox.className="jdpano-lbox",Ge.load.lbox.innerHTML='<div class="jdpano-loading"></div>',Ge.load.box.appendChild(Ge.load.lbox),Ge.load.lbar=t.createElement("div"),Ge.load.lbar.className="jdpano-lbar",Ge.load.lbarFill=t.createElement("div"),Ge.load.lbarFill.className="jdpano-lbar-fill",Ge.load.lbar.appendChild(Ge.load.lbarFill),Ge.load.box.appendChild(Ge.load.lbar),Ge.load.msg=t.createElement("p"),Ge.load.msg.className="jdpano-lmsg",Ge.load.box.appendChild(Ge.load.msg),o.appendChild(Ge.load.box),Ge.errorMsg=t.createElement("div"),Ge.errorMsg.className="jdpano-error-msg jdpano-info-box",o.appendChild(Ge.errorMsg);var Xe={};Xe.container=t.createElement("div"),Xe.container.className="jdpano-controls-container",o.appendChild(Xe.container),Xe.load=t.createElement("div"),Xe.load.className="jdpano-load-button",Xe.load.addEventListener("click",function(){Z(),ae()}),o.appendChild(Xe.load),Xe.zoom=t.createElement("div"),Xe.zoom.className="jdpano-zoom-controls jdpano-controls",Xe.zoomIn=t.createElement("div"),Xe.zoomIn.className="jdpano-zoom-in jdpano-sprite jdpano-control",Xe.zoomIn.addEventListener("click",K),Xe.zoom.appendChild(Xe.zoomIn),Xe.zoomOut=t.createElement("div"),Xe.zoomOut.className="jdpano-zoom-out jdpano-sprite jdpano-control",Xe.zoomOut.addEventListener("click",Q),Xe.zoom.appendChild(Xe.zoomOut),Xe.container.appendChild(Xe.zoom),Xe.fullscreen=t.createElement("div"),Xe.fullscreen.addEventListener("click",V),Xe.fullscreen.className="jdpano-fullscreen-toggle-button jdpano-sprite jdpano-fullscreen-toggle-button-inactive jdpano-controls jdpano-control",(t.fullscreenEnabled||t.mozFullScreenEnabled||t.webkitFullscreenEnabled||t.msFullscreenEnabled)&&Xe.container.appendChild(Xe.fullscreen),Xe.orientation=t.createElement("div"),Xe.orientation.addEventListener("click",function(e){De?ne():ie()}),Xe.orientation.addEventListener("mousedown",function(e){e.stopPropagation()}),Xe.orientation.addEventListener("touchstart",function(e){e.stopPropagation()}),Xe.orientation.addEventListener("pointerdown",function(e){e.stopPropagation()}),Xe.orientation.className="jdpano-orientation-button jdpano-orientation-button-inactive jdpano-sprite jdpano-controls jdpano-control";var qe,We=!1;e.DeviceOrientationEvent?e.addEventListener("deviceorientation",i):qe=!1;var Ze=t.createElement("div");Ze.className="jdpano-compass jdpano-controls jdpano-control",o.appendChild(Ze),W(n.firstScene?n.firstScene:n.defaults&&n.defaults.firstScene?n.defaults.firstScene:null),Z(!0);var Ve=[],Je=[];N.prototype.multiply=function(e){return new N(this.w*e.w-this.x*e.x-this.y*e.y-this.z*e.z,this.x*e.w+this.w*e.x+this.y*e.z-this.z*e.y,this.y*e.w+this.w*e.y+this.z*e.x-this.x*e.z,this.z*e.w+this.w*e.z+this.x*e.y-this.y*e.x)},N.prototype.toEulerAngles=function(){return[Math.atan2(2*(this.w*this.x+this.y*this.z),1-2*(this.x*this.x+this.y*this.y)),Math.asin(2*(this.w*this.y-this.z*this.x)),Math.atan2(2*(this.w*this.z+this.x*this.y),1-2*(this.y*this.y+this.z*this.z))]},this.isLoaded=function(){return Te},this.getPitch=function(){return le.pitch},this.setPitch=function(e,t,o,n){return t=t==a?1e3:Number(t),t?ke.pitch={startTime:Date.now(),startPosition:le.pitch,endPosition:e,duration:t,callback:o,callbackArgs:n}:le.pitch=e,S(),this},this.getPitchBounds=function(){return[le.minPitch,le.maxPitch]},this.setPitchBounds=function(e){return le.minPitch=Math.max(-90,Math.min(e[0],90)),le.maxPitch=Math.max(-90,Math.min(e[1],90)),this},this.getYaw=function(){return le.yaw},this.setYaw=function(e,t,o,n){for(;e>180||e<-180;)e>0?e-=360:e+=360;var i=Math.abs(e-le.yaw);i=i<180?i:360-i;var r;return r=e>le.yaw+180?le.yaw-i:e<le.yaw-180?le.yaw+i:e,t=t==a?1e3:Number(t),t?ke.yaw={startTime:Date.now(),startPosition:le.yaw,endPosition:r,duration:t,callback:o,callbackArgs:n}:le.yaw=e,S(),this},this.getYawBounds=function(){return[le.minYaw,le.maxYaw]},this.setYawBounds=function(e){return le.minYaw=Math.max(-180,Math.min(e[0],180)),le.maxYaw=Math.max(-180,Math.min(e[1],180)),this},this.getHfov=function(){return le.hfov},this.setHfov=function(e,t,o,n){return t=t==a?1e3:Number(t),t?ke.hfov={startTime:Date.now(),startPosition:le.hfov,endPosition:$(e),duration:t,callback:o,callbackArgs:n}:ee(e),S(),this},this.getHfovBounds=function(){return[le.minHfov,le.maxHfov]},this.setHfovBounds=function(e){return le.minHfov=Math.max(0,e[0]),le.maxHfov=Math.max(0,e[1]),this},this.lookAt=function(e,t,o,n,i,r){return n=n==a?1e3:Number(n),e!==a&&(this.setPitch(e,n,i,r),i=a),t!==a&&(this.setYaw(t,n,i,r),i=a),o!==a&&this.setHfov(o,n,i,r),this},this.getNorthOffset=function(){return le.northOffset},this.setNorthOffset=function(e){return le.northOffset=Math.min(360,Math.max(0,e)),S(),this},this.startAutoRotate=function(e){return e=e||Se||1,le.autoRotate=e,ve.lookAt(me,a,pe,3e3),S(),this},this.stopAutoRotate=function(){return Se=le.autoRotate?le.autoRotate:Se,le.autoRotate=!1,le.autoRotateInactivityDelay=-1,this},this.getRenderer=function(){return he},this.setUpdate=function(e){return Ue=!0===e,he===a?l():S(),this},this.mouseEventToCoords=function(e){return m(e)},this.loadScene=function(e,t,a,o){return Te&&oe(e,t,a,o),this},this.getScene=function(){return le.scene},this.addScene=function(e,t){return n.scenes[e]=t,this},this.removeScene=function(e){return!(le.scene===e||!n.scenes.hasOwnProperty(e)||(delete n.scenes[e],0))},this.toggleFullscreen=function(e){return V(e),this},this.stopOrientation=function(){ne()},this.startOrientation=function(){ie()},this.getConfig=function(){return le},this.addHotSpot=function(e,t){if(t===a||le.scene==t)H(e),le.hotSpots.push(e),X(e);else{if(!n.scenes.hasOwnProperty(t))throw"Invalid scene ID!";n.scenes[t].hotSpots.push(e)}return this},this.removeHotSpot=function(e){if(!le.hotSpots)return!1;for(var t=0;t<le.hotSpots.length;t++)if(le.hotSpots[t].hasOwnProperty("id")&&le.hotSpots[t].id===e){for(var a=le.hotSpots[t].div;a.parentNode!=Be;)a=a.parentNode;return Be.removeChild(a),delete le.hotSpots[t].div,le.hotSpots.splice(t,1),!0}return!1},this.resize=function(){D()},this.isLoaded=function(){return Te},this.on=function(e,t){return Fe[e]=Fe[e]||[],Fe[e].push(t),this},this.off=function(e,t){if(!e)return Fe={},this;if(t){var a=Fe[e].indexOf(t);a>=0&&Fe[e].splice(a,1),(Fe[e].length=0)&&delete Fe[e]}else delete Fe[e];return this},this.destroy=function(){he&&he.destroy(),Ie&&(He.removeEventListener("mousedown",f,!1),He.removeEventListener("dblclick",p,!1),t.removeEventListener("mousemove",v,!1),t.removeEventListener("mouseup",g,!1),o.removeEventListener("mousewheel",R,!1),o.removeEventListener("DOMMouseScroll",R,!1),o.removeEventListener("mozfullscreenchange",J,!1),o.removeEventListener("webkitfullscreenchange",J,!1),o.removeEventListener("msfullscreenchange",J,!1),o.removeEventListener("fullscreenchange",J,!1),e.removeEventListener("resize",D,!1),e.removeEventListener("orientationchange",D,!1),o.removeEventListener("keydown",P,!1),o.removeEventListener("keyup",_,!1),o.removeEventListener("blur",T,!1),t.removeEventListener("mouseleave",g,!1),He.removeEventListener("touchstart",w,!1),He.removeEventListener("touchmove",y,!1),He.removeEventListener("touchend",x,!1),He.removeEventListener("pointerdown",b,!1),He.removeEventListener("pointermove",E,!1),He.removeEventListener("pointerup",M,!1),He.removeEventListener("pointerleave",M,!1)),o.innerHTML="",o.classList.remove("jdpano-container"),o.classList.remove("jdpano-grab"),o.classList.remove("jdpano-grabbing")}}return{viewer:function(e,t){return new o(e,t)}}}(window,document),module.exports={build3D:e}});
