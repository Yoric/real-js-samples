/* phoenix-common-1.0.0 address.js Date:2017-09-07 23:02:32 */
define("PHOENIX_COM/js/address",function(require,a){JDFN_Domain=pageConfig.FN_getDomain();var c=function(a,b){if($(a).length){var c={level4:!1,oversea:!1,comAddress:!1};this.cfg=$.extend(c,b),this.$root=$(a),this.$root.addClass("addr-selector-four m-addr-selector"),this.overseas_ID=53283,this.area=[1,72,4137,0],this.getAreaID(),this.province_ID=this.area[0],this.city_ID=this.area[1],this.level_3_ID=this.area[2],this.level_4_ID=this.cfg.level4?this.area[3]:0,this.cfg.oversea||this.area[0]!=this.overseas_ID||(this.area=[1,72,4137,0],this.province_ID=this.area[0],this.city_ID=this.area[1],this.level_3_ID=this.area[2],this.level_4_ID=this.cfg.level4?this.area[3]:0),this.province_ID==this.overseas_ID&&0==this.city_ID&&(this.city_ID=53309),this.init()}};c.prototype={init:function(){this.renderCadreHTML(),this.$tab_index=this.$root.find(".addr-tabs li"),this.$tab_panel=this.$root.find(".addr-tab-panel"),this.$current_addr=this.$root.find(".addr-curr"),this.$used_addr_list=this.$root.find(".addr-used-list"),this.$used_addr=this.$root.find(".addr-common-used"),this.$add_close=this.$root.find(".addr-close"),this.cfg.comAddress&&this.getComAddr(this.comAddr),this.render(),this.initStatus(),this.bindEvent()},initStatus:function(){for(var a=0;a<this.area.length&&0!=this.area[a];a++)(this.cfg.level4||3!=a)&&(this.$tab_index.removeClass("tab-curr").eq(a).addClass("tab-curr").show(),this.$tab_panel.hide().eq(a).show())},getCurrCountryIndex:function(){var a,b,d;for(a in countryMap)if(countryMap.hasOwnProperty(a))for(b=countryMap[a],d=0;d<b.length;d++)if(b[d].id==this.city_ID)return a;return""},initCountryStatus:function(){if(this.province_ID==this.overseas_ID){var a=this.getCurrCountryIndex();var b=this.$tab_panel.eq(1).find(".z-height-fixed");var c=b.find("#char-index-"+a);this.$tab_panel.eq(1).find(".z-height-fixed").unbind("scroll"),b.find(".letter-title").removeClass("title-active"),c.addClass("title-active"),$(".addr-letters li").removeClass("letter-active"),$(".addr-letters li a[data-value="+a+"]").parent().addClass("letter-active"),b.scrollTop(c.parent().offset().top-b.offset().top+b.scrollTop()+1)}},render:function(){this.renderPrvince(),this.province_ID==this.overseas_ID&&this.cfg.oversea?(this.renderCountry(),this.setTabIndex(),this.setCurrAddr(this.getCurrProvName()+this.getCurrCountryName())):(this.renderCity(),this.setTabIndex(),this.setCurrAddr(this.getCurrProvName()+this.getCurrCityName()),this.getLevel3(this.city_ID,function(a){if(a&&a.length){var b="\u8bf7\u9009\u62e9";this.packageLevel3(a);for(var c=0;c<a.length;c++){var d=a[c];d.id==this.level_3_ID&&(b=d.name)}this.$tab_index.eq(2).attr("title",b).find("em").text(b.substr(0,6)),this.setCurrAddr(this.getCurrProvName()+this.getCurrCityName()+b),this.cfg.level4&&this.getLevel4(this.level_3_ID,function(a){if(!a||!a.length)return this.$tab_index.eq(3).hide(),this.$tab_index.eq(2).addClass("tab-curr"),this.$tab_panel.eq(3).hide(),void this.$tab_panel.eq(2).show();var c="";this.packageLevel4(a);for(var d=0;d<a.length;d++){var e=a[d];if(e.id==this.level_4_ID){c=e.name;break}}""==c&&(c=a[0].name,this.level_4_ID=a[0].id,this.$tab_index.removeClass("tab-curr").eq(3).show(),this.$tab_index.eq(3).addClass("tab-curr"),this.$tab_panel.hide(),this.$tab_panel.eq(3).show()),this.$tab_index.eq(3).attr("title",c).find("em").text(c.substr(0,6)),this.setCurrAddr(this.getCurrProvName()+this.getCurrCityName()+b+c),this.setCookie()},function(){})}},function(){}))},getLevel3:function(a,b,c){$.ajax({url:"//d.jd.com/area/get",data:{fid:a},dataType:"jsonp",success:$.proxy(b,this),error:$.proxy(c,this)})},getLevel4:function(a,b,c){$.ajax({url:"//list.jd.com/lapi/area",data:{fid:a},dataType:"jsonp",success:$.proxy(b,this),error:$.proxy(c,this)})},packageLevel3:function(a){var g,b="",c="",d="",e="",f=0;for(;f<a.length;f++)g=a[f],g.id==this.level_3_ID&&(this.level3_name=b=g.name),g.name.length<=5?c+='<li><a href="javascript:;" data-value="'+g.id+'" data-name="'+g.name+'" data-level="2">'+g.name+"</a></li>":g.name.length>5&&g.name.length<=11?d+='<li class="long-area"><a href="javascript:;" data-value="'+g.id+'" data-name="'+g.name+'" data-level="2">'+g.name+"</a></li>":e+='<li class="longer-area"><a href="javascript:;" data-value="'+g.id+'" data-name="'+g.name+'" data-level="2">'+g.name+"</a></li>";this.$tab_panel.eq(2).empty().html('<ul class="addr-area-list">'+c+d+e+"</ul>")},packageLevel4:function(a){var g,b="",c="",d="",e="",f=0;if(a.length){for(;f<a.length;f++)g=a[f],g.id==this.level_4_ID&&(b=g.name),g.name.length<=5?c+='<li><a href="javascript:;" data-value="'+g.id+'" data-name="'+g.name+'" data-level="3">'+g.name+"</a></li>":g.name.length>5&&g.name.length<=11?d+='<li class="long-area"><a href="javascript:;" data-value="'+g.id+'" data-name="'+g.name+'" data-level="3">'+g.name+"</a></li>":e+='<li class="long-area"><a href="javascript:;" data-value="'+g.id+'" data-name="'+g.name+'" data-level="3">'+g.name+"</a></li>";this.$tab_panel.eq(3).empty().html('<ul class="addr-area-list">'+c+d+e+"</ul>")}},renderLevel3:function(){this.getLevel3(this.city_ID,this.packageLevel3,function(){})},renderLevel4:function(){this.getLevel4(this.level_3_ID,this.packageLevel4,function(){})},getCurrProvName:function(){return provinceMap[this.province_ID].name||""},getCurrCityName:function(){var c,a=cityMap[this.province_ID],b=0;for(;b<a.length;b++)if(c=a[b],c.id==this.city_ID)return c.name;return""},getCurrCountryName:function(){var a,b,d;for(a in countryMap)if(countryMap.hasOwnProperty(a))for(b=countryMap[a],d=0;d<b.length;d++)if(b[d].id==this.city_ID)return b[d].name;return""},setCurrAddr:function(a){a.length>17&&(a=a.substr(0,17)+"..."),this.$current_addr.html("<em>"+a+"</em><b></b>")},setTabIndex:function(){var a=this.getCurrProvName();var b=this.province_ID==this.overseas_ID?this.getCurrCountryName():this.getCurrCityName();this.$tab_index.eq(0).attr("title",a).find("em").text(a.substr(0,3)),this.$tab_index.eq(1).attr("title",b).find("em").text(b.substr(0,6))},renderPrvince:function(){var c,d,a="",b="";for(c in provinceMap)provinceMap.hasOwnProperty(c)&&(this.cfg.oversea||c!=this.overseas_ID)&&(d=provinceMap[c],d.name.length<4?a+='<li><a href="javascript:;" data-value="'+c+'" data-name="'+d.name+'" data-level="0">'+d.name+"</a></li>":b+='<li><a href="javascript:;" data-value="'+c+'" data-name="'+d.name+'" data-level="0">'+d.name+"</a></li>");this.$tab_panel.eq(0).html('<ul class="addr-area-list">'+a+b+"</ul>")},renderCity:function(){var e,f,a="",b="",c="",d=cityMap[this.province_ID];for(e in d)d.hasOwnProperty(e)&&(f=d[e],f.name.length<=5?c+='<li><a href="javascript:;" data-value="'+f.id+'" data-name="'+f.name+'" data-level="1">'+f.name+"</a></li>":f.name.length<=11&&f.name.length>5?a+='<li class="long-area"><a href="javascript:;" data-value="'+f.id+'" data-name="'+f.name+'" data-level="1">'+f.name+"</a></li>":b+='<li class="longer-area"><a href="javascript:;" data-value="'+f.id+'" data-name="'+f.name+'" data-level="1">'+f.name+"</a></li>");this.$tab_panel.eq(1).html('<ul class="addr-area-list">'+c+a+b+"</ul>")},renderCountry:function(){var a,c,f,g,h,i,j,k,l,b="",e=[];h=this.getCurrCountryName();for(a in countryMap)if(countryMap.hasOwnProperty(a)){for(i="",j="",k="",b+='<div class="addr-letter-item">',c=a.toUpperCase(),e=countryMap[a],b+='<div id="char-index-'+c+'" class="letter-title">'+c+'<em></em><i class="midline"></i></div>',b+='<ul class="addr-area-list">',f=0;f<e.length;f++)g=e[f],l="",h==g.name&&(l='style="color:#e4393c"'),g.name.length<=5?i+="<li><a "+l+' href="javascript:;" data-value="'+g.id+'" data-name="'+g.name+'" data-level="1">'+g.name+"</a></li>":g.name.length>5&&g.name.length<=11?j+='<li class="long-area"><a '+l+' href="javascript:;" data-value="'+g.id+'" data-name="'+g.name+'" data-level="1">'+g.name+"</a></li>":k+='<li class="longer-area"><a '+l+' href="javascript:;" data-value="'+g.id+'" data-name="'+g.name+'" data-level="1">'+g.name+"</a></li>";b=b+i+j+k+"</ul></div>"}this.$tab_panel.eq(1).html(countryIndexHTML+'<div class="addr-letter-list z-height-fixed">'+b+"</div>"),this.$tab_panel.eq(1).find(".z-height-fixed").unbind("scroll").bind("scroll",this.countryScroll)},getComAddr:function(a){$.ajax({url:"//cd.jd.com/usual/address",data:{count:20},dataType:"jsonp",scriptCharset:"gbk",success:$.proxy(a,this)})},comAddr:function(a){var b="";a&&a.length&&(b=this.comAddrPackage(a),this.$used_addr_list.html(b),this.initComAddrStatus())},initComAddrStatus:function(){this.$used_addr.show(),this.$used_addr.find(".addr-item-hd").show(),this.$root.find(".addr-main .addr-item-hd").show(),this.$used_addr_list.find("li").length>=10&&!this.$used_addr.hasClass("z-addr-used-hide")&&this.$used_addr_list.addClass("z-height-fixed"),this.$add_close.remove()},comAddrPackage:function(a){var e,b="",c="",d=0;if(!a.length)return b;for(;d<a.length;d++)e=a[d],this.com_area_ID==e.id?c='<li data-id="'+e.id+'" data-provinceId="'+e.provinceId+'" data-cityId="'+e.cityId+'" data-level3Id="'+e.countyId+'" data-level4Id="'+e.townId+'">                            <em class="used-label">'+e.name+'</em>                            <span class="used-info" title="'+e.fullAddress+'">'+e.fullAddress+"</span>                        </li>":b+='<li data-id="'+e.id+'" data-provinceId="'+e.provinceId+'" data-cityId="'+e.cityId+'" data-level3Id="'+e.countyId+'" data-level4Id="'+e.townId+'">                            <em class="used-label">'+e.name+'</em>                            <span class="used-info" title="'+e.fullAddress+'">'+e.fullAddress+"</span>                        </li>";return c+b},getAreaID:function(){var a=document.cookie.match(/(^| )ipLoc-djd=([^;]*)(;|$)/);a&&a.length>2&&""!=a[2]&&(a=a[2].split(/\./),this.area=a[0].split(/\,|\-/),this.com_area_ID=a[1]?a[1]:0)},setCookie:function(){var a=new Date,b=this.province_ID+"-"+this.city_ID+"-"+this.level_3_ID+"-"+this.level_4_ID;this.com_area_ID&&(b=b+"."+this.com_area_ID),a.setTime(a.getTime()+2592e6),document.cookie="ipLoc-djd="+b+";expires="+a.toGMTString()+";path=/;domain="+JDFN_Domain,document.cookie="areaId="+this.province_ID+";expires="+a.toGMTString()+";path=/;domain="+JDFN_Domain},refreshPage:function(a){var b="//"+window.location.hostname+"/list.html"+window.location.search.replace(/(^|\\?|&)jth=([^&#]*)/g,"").replace(/(^|\\?|&)area=([^&#]*)/g,"");this.$root.removeClass("z-addr-hover"),52993!=this.province_ID&&32!=this.province_ID&&53283!=this.province_ID||"list.jd.hk"==location.host||"coll.jd.com"==location.host||"fh.jd.com"==location.host||(b=b.replace(/delivery=1\&/g,"").replace(/delivery_daofu=3\&/g,"").replace(/delivery_211=1\&/g,"").replace(/global=1\&/g,"").replace(/delivery_glb=1\&/g,"")),a&&(b=b.replace(/delivery_211=1\&/g,"")),(baseConf.areaparam||baseConf.areaparam_djd&&params.isdjd)&&(b=b+"&area="+this.province_ID+","+this.city_ID+","+this.level_3_ID),b=b.replace(/(^|\\?|&)JL=([^&#]*)/g,""),b+="&JL=4_21_0",window.location.href=b},renderCadreHTML:function(){this.$root.html(cadreHTML)},setClickStatus:function(a,b){var c="";this.$tab_panel.hide(),this.$tab_index.eq(a).show().removeClass("tab-curr"),this.$tab_index.eq(a+1).show().addClass("tab-curr"),0==a&&(c=b.substr(0,3)),(1==a||2==a||3==a)&&(c=b.substr(0,6)),this.$tab_index.eq(a).attr("title",b).find("em").text(c),this.$tab_index.eq(a+1).find("em").text("\u8bf7\u9009\u62e9"),this.$tab_panel.eq(a+1).show()},bindEvent:function(){var a=this;var b=!1;var c=null;this.$root.unbind("mouseenter").bind("mouseenter",function(){b=!1,clearTimeout(c),c=setTimeout(function(){a.$root.addClass("z-addr-hover")},200)}),this.$root.unbind("mousemove").bind("mousemove",function(){b=!1}),this.$root.unbind("mouseleave").bind("mouseleave",function(){clearTimeout(c),b||(c=setTimeout(function(){a.$root.removeClass("z-addr-hover")},200))}),this.$tab_index.unbind("click").bind("click",function(){var c=$(this).attr("data-index");a.$tab_index.removeClass("tab-curr"),$(this).addClass("tab-curr"),a.$tab_panel.hide().eq(c).show()}),$("#js-close-common").unbind("click").bind("click",function(){var b=a.$root.find(".addr-common-used"),c=a.$root.find(".addr-main");b.hasClass("z-addr-used-hide")?(a.$used_addr_list.find("li").length>10&&a.$used_addr_list.addClass("z-height-fixed"),c.addClass("z-addr-main-hide"),b.removeClass("z-addr-used-hide")):(a.$used_addr_list.removeClass("z-height-fixed"),c.removeClass("z-addr-main-hide"),b.addClass("z-addr-used-hide"))}),$("#js-close-new").unbind("click").bind("click",function(){b=!0;var c=a.$root.find(".addr-main"),d=a.$root.find(".addr-common-used");c.hasClass("z-addr-main-hide")?(a.$used_addr_list.removeClass("z-height-fixed"),d.addClass("z-addr-used-hide"),c.removeClass("z-addr-main-hide")):(d.removeClass("z-addr-used-hide"),a.$used_addr_list.find("li").length>10&&a.$used_addr_list.addClass("z-height-fixed"),c.addClass("z-addr-main-hide"))}),$(".addr-close").unbind("click").bind("click",function(){a.$root.removeClass("z-addr-hover")}),$(".addr-used-list li").die("click").live("click",function(){a.province_ID=$(this).attr("data-provinceId"),a.city_ID=$(this).attr("data-cityId"),a.level_3_ID=$(this).attr("data-level3id"),a.level_4_ID=$(this).attr("data-level4id"),a.com_area_ID=$(this).attr("data-id"),a.setCookie(),a.refreshPage(!0)}),this.$tab_panel.find(".addr-area-list a").die("click").live("click",function(){var d="",e="",f="";b=!0,d=$(this).attr("data-name"),e=$(this).attr("data-value"),f=Number($(this).attr("data-level")),a.$tab_index.hide(),a.$tab_panel.hide(),0==f?(a.province_ID=e,a.city_ID=0,a.province_ID==a.overseas_ID?a.renderCountry():a.renderCity(),a.setClickStatus(f,d)):1==f?(a.city_ID=e,a.level_3_ID=0,a.level_4_ID=0,a.province_ID==a.overseas_ID?(this.com_area_ID=0,a.setCookie(),a.refreshPage(!0)):(a.$tab_panel.eq(2).empty(),a.renderLevel3(),a.$tab_index.eq(0).show(),a.setClickStatus(f,d))):2==f?(a.level_3_ID=e,a.level_4_ID=0,a.$tab_index.eq(0).show(),a.$tab_index.eq(1).show(),a.$tab_index.eq(2).show(),a.$tab_panel.eq(2).show(),a.cfg.level4?(a.$tab_panel.eq(3).empty(),a.getLevel4(a.level_3_ID,function(b){b&&b.length?(this.packageLevel4(b),a.setClickStatus(f,d)):(this.com_area_ID=0,this.setCookie(),this.refreshPage(!0))},function(){})):(a.com_area_ID=0,a.setCookie(),a.refreshPage(!0))):3==f&&(a.level_4_ID=e,a.com_area_ID=0,a.$tab_index.eq(0).show(),a.$tab_index.eq(1).show(),a.$tab_index.eq(2).show(),a.$tab_index.eq(3).show(),a.setCookie(),a.refreshPage(!0))});var d=null;a.$tab_panel.find(".addr-letters a").die("mouseenter").live("mouseenter",function(){var c=$(this).attr("data-value").toUpperCase();var e=a.$tab_panel.eq(1).find(".z-height-fixed");var f=e.find("#char-index-"+c);a.$tab_panel.eq(1).find(".z-height-fixed").unbind("scroll"),d=setTimeout(function(){e.find(".letter-title").removeClass("title-active"),f.addClass("title-active"),$(".addr-letters li").removeClass("letter-active"),$(".addr-letters li a[data-value="+c+"]").parent().addClass("letter-active"),e.stop().animate({scrollTop:f.parent().offset().top-e.offset().top+e.scrollTop()+1},"100")},100)}).die("mouseleave").live("mouseleave",function(){clearTimeout(d),a.$tab_panel.eq(1).find(".z-height-fixed").unbind("scroll").bind("scroll",a.countryScroll)}),a.$tab_panel.eq(1).find(".z-height-fixed").unbind("scroll").bind("scroll",a.countryScroll)},countryScroll:function(){var a=$(this).offset().top,b=$(this).scrollTop(),c=$(this).height();var e,f,g,i,d=[];for($item=$(".addr-letter-list .addr-letter-item"),i=0;i<$item.length;i++)f=$item.eq(i),g=f.offset().top,a+c>=g&&(e=f.find(".letter-title").text(),d.push(e));e=d.length?d[d.length-1]:"",0==b&&(e="a".toUpperCase()),$(".letter-title").removeClass("title-active"),$(".addr-letters li").removeClass("letter-active"),$("#char-index-"+e).addClass("title-active"),$(".addr-letters li a[data-value="+e+"]").parent().addClass("letter-active")}},a.Address=c});
