define("public/business/partition/partition",["public/business/partition/getPartitionInfo"],function(require,exports,module){function e(e){function t(e){if(e.length>0)for(var r=0;e[r];r++)for(var t=0;p[t];t++){var i=jQuery("["+p[t]+"="+e[r].goodsId+"]");i&&i.length>0&&(i.each(function(i,a){var n=jQuery(a).attr(p[t]);if(jQuery(a).attr(p[t],e[r].realSkuId),jQuery(a).closest("li").length>0){var o=new RegExp(n,"g"),s=jQuery(a).closest("li").html().replace(o,e[r].realSkuId);jQuery(a).closest("li").html(s)}}),c.resolve(o))}else c.resolve(o)}var i=jQuery.extend({skuIds:[],jsprice:"jsprice",jdprice:"jdprice",jspprice:"jspprice",jppprice:"jppprice",jtppprice:"jtppprice",jtkpprice:"jtkpprice",jprice:"jprice",jopprice:"jopprice",priceType:["jsprice","jdprice","jspprice","jppprice","jtppprice","jtkpprice","jprice","jopprice"],maxCount:20},e||{}),a=i.skuIds,p=i.priceType,n=i.maxCount,o=[],s=[],c=jQuery.Deferred();if(function(){for(var e=0;a[e];e++)for(var r=jQuery(a[e]),t=r.closest("[module-name]").attr("module-name"),i=["GoodsRec","sortRec","BusinessIntelligence"],n=0;p[n];n++)if(r.attr(p[n])&&!s.isIn(r.attr(p[n])))if(s.push(r.attr(p[n])),i.isIn(t)&&r.attr("data-cat")&&r.attr("data-cat").length>0){var c={goodsId:r.attr(p[n]),category:r.attr("data-cat"),fqsp:r.attr("data-fqsp")?r.attr("data-fqsp"):0,venderId:r.attr("data-venderId")?r.attr("data-venderId"):0};o.push(c)}else{var c={goodsId:r.attr(p[n]),category:"0,0,0",fqsp:0,venderId:0};o.push(c)}}(),0!=o.length)return function(){for(var e=Math.ceil(o.length/n),i=0,a=0,p=[],s=0;s<e;s++)a+=s;for(var s=0;s<e;s++){var c=o.slice(s*n,Math.min(o.length,(s+1)*n));!function(e,s,c){jQuery.when(r({skuInfo:c,num:n})).done(function(e){if(e)for(var r=0;o[r];r++)for(var n in e)n==o[r].goodsId&&(o[r].realSkuId=e[n].realSkuId,p.push(o[r]));(i+=s)==a&&t(p)})}(0,s,c)}}(),c.promise()}var r=require("public/business/partition/getPartitionInfo");module.exports=e});define("public/business/goodsBelt",[],function(require,exports,module){var e={jdprice:"jdprice"},t={50:1,68:1,85:1,120:1,142:1,96:1,115:1,134:1,82:1,84:1,141:1},n={1315:1,1318:1,1319:1,1620:1,1672:1,5025:1,6144:1,6196:1,6728:1,9192:1,9847:1,9855:1,11729:1,12379:1,13314:1};module.exports.processBeltAdvance=function(n,a){for(var s={},i=0,d=n.length;i<d;i++){var r=n[i].id;-1!==r.indexOf("J_")&&(r=r.replace("J_","")),s[r]={},n[i].np&&(s[r].np=n[i].np,s[r].np.jdprice=n[i].p)}for(var i=0,d=a.length;i<d;i++){var r=a[i].skuId;a[i].result&&"{}"!==JSON.stringify(a[i].result)&&(s[r]||(s[r]={}),s[r].belt=a[i].result)}if(0===$("#J_beltCss").length){$("body").append('<style id="J_beltCss">.d-belt{position:absolute;bottom:0;left:0;width:100%;height:42px;text-indent:5px;text-align:center;z-index:1}.d-belt .d-belt-img{position:absolute;top:0;left:0;width:100%!important;height:42px!important;background:url(//img11.360buyimg.com/uba/jfs/t8671/203/399747885/5687/a8387891/59a7b454N32b28f67.png) no-repeat;background-size:100% 42px;z-index:-1}.d-belt .d-belt-content{max-width:125px;overflow:hidden}.d-belt span{text-align:center;font-size:12px;color:white;font-weight:bold;line-height:61px;white-space:nowrap}.d-belt-mt-240 span{font-size:14px}.d-belt-lt-200{display:none}.d-belt-has-np{text-align:left}</style>')}if(0===$("#J_advancePriceCss").length){$("body").append('<style id="J_advancePriceCss">.d-advance-price{position:absolute;bottom:5px;right:3px;width:85px;height:88px;background:url(//img14.360buyimg.com/uba/jfs/t8224/223/416192047/3860/581e5ec2/59a79bd1N541bbcfa.png);color:#df3478;text-align:center;z-index:2}.d-advance-price .d-first-line{font-size:12px;font-weight:bold;margin-top:15px}.d-advance-price .d-second-line{font-size:20px;font-weight:bold;line-height:18px;}.d-advance-price .d-second-line span{margin-left:-4px;white-space:nowrap;}.d-advance-price .d-third-line{font-size:12px;font-weight:bold}</style>')}for(var i in s)!function(n,a){var s=a.np,i=a.belt,d="",r="";(s||i)&&(s&&!i?function(){var e=s.c,t=new Date(parseInt(s.e)),n=new Date(parseInt(s.s)),i=(a.id,s.p?s.p:s.jdprice);if(i<0||void 0===i||null===i)return void(d="");i=i.toString();var r=i.length,l=i.indexOf(".");-1!==l&&r>6&&(i=i.substring(0,l));var o,c=n.getFullYear(),p=n.getMonth()+1,v=n.getDate(),g=t.getFullYear(),u=t.getMonth()+1,f=t.getDate();o=c===g&&p===u&&v===f?p+"."+v:p+"."+v+"-"+u+"."+f,d='<div class="d-advance-price"><div class="d-first-line">'+e+'</div><div class="d-second-line"><span class="d-advence-rmb">￥</span><span class="d-advence-pricee J_advancePrice">'+i+'</span></div><div class="d-third-line"><span class="d-np-date">'+o+"</span></div></div>"}():i&&!s?function(){var e,t=new Date(parseInt(i.start+"000")),n=new Date(parseInt(i.end+"000")),a=t.getFullYear(),s=t.getMonth()+1,d=t.getDate(),l=n.getFullYear(),o=n.getMonth()+1,c=n.getDate();e=a===l&&s===o&&d===c?s+"."+d:s+"."+d+"-"+o+"."+c,r='<div class="d-belt"><div class="d-belt-img"></div><span class="d-belt-content" title="'+i.content+'">'+i.content+'</span> <span class="d-belt-date">('+e+")</span></div>"}():i&&s&&function(){var e,t=new Date(parseInt(i.start+"000")),n=new Date(parseInt(i.end+"000")),a=new Date(parseInt(s.s)),l=new Date(parseInt(s.e)),o=t.getFullYear(),c=t.getMonth()+1,p=t.getDate(),v=n.getFullYear(),g=n.getMonth()+1,u=n.getDate();e=o===v&&c===g&&p===u?c.toString()+"."+p.toString():c+"."+p+"-"+g+"."+u;var f,b=a.getFullYear(),h=a.getMonth()+1,m=a.getDate(),x=l.getFullYear(),D=l.getMonth()+1,w=l.getDate();if(f=b===x&&h===D&&m===w?h+"."+m:h+"."+m+"-"+D+"."+w,t.getTime()===a.getTime()&&n.getTime()===l.getTime()){var j=s.p?s.p:s.jdprice>0?s.jdprice:"暂无定价";if("暂无定价"===j)d="",r="";else{j=j.toString();var y=j.length,I=j.indexOf(".");-1!==I&&y>6&&(j=j.substring(0,I)),d='<div class="d-advance-price"><div class="d-first-line">'+s.c+'</div><div class="d-second-line"><span class="d-advence-rmb">￥</span><span class="d-advence-pricee J_advancePrice">'+j+'</span></div><div class="d-third-line"><span class="d-np-date">'+f+"</span></div></div>",r='<div class="d-belt"><div class="d-belt-img"></div><span class="d-belt-content" title="'+i.content+'">'+i.content+"</span></div>"}}else d="",r='<div class="d-belt"><div class="d-belt-img"></div><span class="d-belt-content" title="'+i.content+'">'+i.content+'</span> <span class="d-belt-date">('+e+")</span></div>"}(),function(){$("["+e.jdprice+"="+n+"]").each(function(e,n){var a=$(n);if("true"!==a.closest(".j-module").attr("no-belt")&&1!=t[a.closest("[modeid]").attr("modeid")]){var s=a.closest("li").find("a img").closest("a").parent();s.length>1&&(s=a.closest("li").find("a img").filter(function(){var e=$(this).attr("src");return!("string"!=typeof e||!/360buyimg\.com\/n[0-9]+\//.test(e))}).closest("a").parent()),s.hasClass("hasBelt")||""===r||("static"==s.css("position")&&s.css("position","relative"),s.append(r),s.addClass("hasBelt")),s.hasClass("hasAdvancePrice")||""===d||("static"==s.css("position")&&s.css("position","relative"),s.append(d),s.addClass("hasAdvancePrice"));var i=s.width();if(i<=200)return s.find(".d-belt").addClass("d-belt-lt-200"),void s.find(".d-advance-price").hide();i<=240?s.find(".d-belt").addClass("d-belt-200-240"):s.find(".d-belt").addClass("d-belt-mt-240"),""!==d&&""!==r&&s.find(".d-belt").addClass("d-belt-has-np")}})}())}(i,s[i])},module.exports.getBelt=function(e){var t=jQuery.Deferred();0===e.length&&t.resolve([]);for(var a={},s=0,i=e.length;s<i;s++){var d=e[s],r=d.getAttribute("jdprice")||d.getAttribute("jsprice");cid=d.getAttribute("data-cat"),venderid=d.getAttribute("data-venderid"),shopid=d.getAttribute("data-shopid"),canUseDq=d.getAttribute("data-canusedq"),oversea=d.getAttribute("data-overseapurchase"),a[r]={},a[r].cid=cid,a[r].venderid=venderid,a[r].shopid=shopid,a[r].canUseDq=canUseDq,a[r].oversea=oversea}return function(e){var t=$.Deferred(),a=[];for(var s in e)("string"!=typeof e[s].cid||n[e[s].cid.split(",")[0]])&&(null!==e[s].cid&&null!==e[s].venderid&&null!==e[s].shopid||a.push(s));return 0===a.length?t.resolve(e):$.ajax({url:INTERFACE.actJshop.goodsInfo,dataType:"jsonp",data:{skuIds:a.join(",")},timeout:5e3,success:function(n){for(var a=0;a<n.length;a++){var s=n[a].goodsId;e[s].cid=n[a].categoryIds.replace(/;/g,","),e[s].venderid=n[a].venderId,e[s].shopid=n[a].shopId,e[s].canUseDq=n[a].canUseDq,e[s].oversea=n[a].overseaPurchase}t.resolve(e)},error:function(n){t.resolve(e)}}),t.promise()}(a).done(function(){var e=[];for(var s in a){var i=a[s],d=[];if(i){var r=i.cid;r=r.split(",");var l=r[0];if(n[l]){var o=r.pop(),c=i.venderid,p=i.shopid,v="string"==typeof i.canUseDq?"0"===i.canUseDq?1:2:0,g="string"==typeof i.oversea?"0"===i.oversea||"null"===i.oversea?1:2:0;d=[s+"_"+v+"_"+g,o,c||0,p||0],d=d.join(","),e.push(d)}}}e=e.join(";"),""===e?setTimeout(function(){t.resolve([])},0):$.ajax({url:INTERFACE.beltInfo,data:{search:e},timeout:5e3,dataType:"jsonp",success:function(e){t.resolve(e)},error:function(e){t.resolve([])}})}),t.promise()}});