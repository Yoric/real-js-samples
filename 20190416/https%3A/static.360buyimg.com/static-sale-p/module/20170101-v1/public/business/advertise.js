define("public/business/advertise",[],function(require,exports,module){function sideSlip(t){function e(){r.css("top",a+$(this).scrollTop()+"px"),$(window).resize(function(){a=i.vValue,show&&r.css("top",a+$(this).scrollTop()+"px")})}function s(){var t=i.vValue;$(window).scroll(function(){var e=($("#service-2013").length?$("#service-2013").offset().top:$("body").height())-height-t;$(this).scrollTop()>=e?r.css({top:e-$(this).scrollTop()+t+"px"}):r.css({top:t+"px"})})}var a,r=$(this),i=$.extend({position:1,hValue:0,vValue:0},t);!function(){i.position=parseInt(i.position),width=r.width(),height=r.height(),1==i.position?r.css({left:i.hValue}):r.css({right:i.hValue}),a=i.vValue,r.css({position:"fixed",zIndex:101,top:a+"px",overflow:"hidden"}),$.browser.msie&&$.browser.version.match(/6/)?(r.css("position","absolute"),e()):s()}()}function getData(address){$.ajax({url:INTERFACE.actJshop.ad,data:{id:appId,type:1,appUrl:address},dataType:"jsonp",success:function success(data){try{var n=data;if(void 0!==n.middle&&""!=n.middle&&getRealAdHtml(n,"middle").then(function(html){var c=$(html).prependTo(".layoutcontainer");if(c.find(".js-user-script").html())try{eval(c.find(".js-user-script").html()),c.find(".js-user-script")[0].outerHTML=""}catch(t){}}),void 0!==n.top&&""!=n.top&&getRealAdHtml(n,"top").then(function(html){var a=$(html).insertAfter('[id^="shortcut"]');if(a.find(".js-user-script").html())try{eval(a.find(".js-user-script").html()),a.find(".js-user-script")[0].outerHTML=""}catch(t){}}),void 0!==n.left&&""!=n.left&&getRealAdHtml(n,"left").then(function(html){var g=$(html).appendTo("body"),p=eval("("+g.attr("position")+")");if(p&&void 0!==p.side&&void 0!==p.top&&sideSlip.call(g,{position:1,hValue:p.side,vValue:p.top}),g.find(".js-user-script").html())try{eval(g.find(".js-user-script").html()),g.find(".js-user-script")[0].outerHTML=""}catch(t){}}),void 0!==n.right&&""!=n.right&&getRealAdHtml(n,"right").then(function(html){var g=$(html).appendTo("body"),p=eval("("+g.attr("position")+")");if(p&&void 0!==p.side&&void 0!==p.top&&sideSlip.call(g,{position:2,hValue:p.side,vValue:p.top}),g.find(".js-user-script").html())try{eval(g.find(".js-user-script").html()),g.find(".js-user-script")[0].outerHTML=""}catch(t){}}),void 0!==n.bottom&&""!=n.bottom&&getRealAdHtml(n,"bottom").then(function(html){var h=$(html).insertAfter(".d-layout-area:last");if(h.find(".js-user-script").html())try{eval(h.find(".js-user-script").html()),h.find(".js-user-script")[0].outerHTML=""}catch(t){}}),void 0!==n.double11&&""!=n.double11){var channelFlag=$("#JSHOP_CHANNEL_FLAG").val();switch(channelFlag){case"jd":getRealAdHtml(n,"double11").then(function(html){if($("#nav-2014").empty().append(html),$("#nav-2014 .js-user-script").html())try{eval($("#nav-2014 .js-user-script").html()),$("#nav-2014 .js-user-script")[0].outerHTML=""}catch(t){}});break;case"hao":case"global":getRealAdHtml(n,"double11").then(function(html){if($("#nav-2014").empty().append(html).css("height","100%"),$("#nav-2014 .js-user-script").html())try{eval($("#nav-2014 .js-user-script").html()),$("#nav-2014 .js-user-script")[0].outerHTML=""}catch(t){}});break;case"yushou":getRealAdHtml(n,"double11").then(function(t){$("#discover-nav").empty().append(t).css("height","100%")});break;case"pinpaijie":getRealAdHtml(n,"double11").then(function(html){if($("#nav").empty().append(html).css("height","100%"),$("#nav .js-user-script").html())try{eval($("#nav .js-user-script").html()),$("#nav .js-user-script")[0].outerHTML=""}catch(t){}});break;case"xuan":getRealAdHtml(n,"double11").then(function(html){if($(".nav-2").empty().append(html).css("height","100%"),$(".nav-2 .js-user-script").html())try{eval($(".nav-2 .js-user-script").html()),$(".nav-2 .js-user-script")[0].outerHTML=""}catch(t){}});break;case"jdTuan":getRealAdHtml(n,"double11").then(function(html){if($("#nav-2015").empty().append(html).css("height","100%"),$("#nav-2015 .js-user-script").html())try{eval($("#nav-2015 .js-user-script").html()),$("#nav-2015 .js-user-script")[0].outerHTML=""}catch(t){}});break;case"red":getRealAdHtml(n,"double11").then(function(html){if($(".c-nav").empty().append(html).css("height","100%"),$(".c-nav .js-user-script").html())try{eval($(".c-nav .js-user-script").html()),$(".c-nav .js-user-script")[0].outerHTML=""}catch(t){}});break;case"vip":getRealAdHtml(n,"double11").then(function(html){if($("#vip-header").after(html).css("height","100%"),$("#vip-header .js-user-script").html())try{eval($("#vip-header .js-user-script").html()),$("#vip-header .js-user-script")[0].outerHTML=""}catch(t){}});break;case"vipplus":getRealAdHtml(n,"double11").then(function(html){if($(".pls-header").after(html).css("height","100%"),$(".pls-header .js-user-script").html())try{eval($(".pls-header .js-user-script").html()),$(".pls-header .js-user-script")[0].outerHTML=""}catch(t){}})}}}catch(t){}}})}function getRealAdHtml(data,type){var promise=$.Deferred();if(data.relation&&1==data.relation[type])promise.resolve(data[type]);else if(data.relation&&2==data.relation[type]){var node=$(data[type]),moduleNode=$($(data[type]).find(".j-module")[0].outerHTML),param=eval("("+moduleNode.attr("module-param")+")");if(0==moduleNode.length)promise.resolve("");else{var biPromise=jshop.module.biAds.call(moduleNode[0],param);biPromise.done(function(t){var e=$(data[type]);e.find(".j-module").html(t);var s=e[0].outerHTML;promise.resolve(s)})}}return promise.promise()}function reRenderBottomAd(){getBottomAd().then(function(t){t.result&&$(".J_bottomAdvertise").html(t.html)})}function getBottomAd(){var t=$.Deferred();return $.ajax({url:"//act-jshop.jd.com/newUserAdvServlet.html",dataType:"jsonp",timeout:5e3,success:function(e){e.success?t.resolve({result:!0,html:e.data}):t.resolve({result:!1})},error:function(e){t.resolve({result:!1})}}),t.promise()}if(!/ipad/i.test(navigator.userAgent)||/safari/i.test(navigator.userAgent)&&!/jdapp/i.test(navigator.userAgent)){var appId=$("#pageInstance_appId").val(),address=function(){var t=location.href.match(/\/\w+(?=\.html)/)||jQuery("#layoutSortUrl").val().match(/\/\w+(?=\.html)/);if(t)return t[0].split("/")[1]}();address&&getData(address),reRenderBottomAd()}});