window.tplVersion={},define("//static.360buyimg.com/mtd/pc/xinren/2.0.0/mod_xinren_bottom/mod_xinren_bottom.min.js",["//static.360buyimg.com/mtd/pc/base/1.0.0/base.js","//static.360buyimg.com/mtd/pc/components/1.0.0/util/util.js","//static.360buyimg.com/mtd/pc/cms/js/o2_ua.min.js","//wl.jd.com/wl.js"],function(require){var t=require("load_async"),i=require("o2tpl"),e=require("//static.360buyimg.com/mtd/pc/components/1.0.0/util/util.js");window.pageConfig=window.pageConfig||{};var o=window.pageConfig;o.isO2XinrenBottom=function(){var t=!1,i=location.search,e=i.match(/isO2XinrenBottom=((?:true))/);return e&&"true"===e[1]&&(t=!0),t}();var n=_.Class.extend({construct:function(t){this.conf=$.extend({$container:$("body"),productLineId:""},t),this.init()},init:function(){this.$el=null,this.ticketTpl=['<div id="J_mod_xinren_bottom" class="mod_xinren_bottom hidden">','        <div class="mod_xinren_bottom_inner">','            <a id="J_mod_xinren_bottom_lk" class="mod_xinren_bottom_lk" href="javascript:;" clstag="pageclick|keycount|201801051|1" onclick="log(\'PCNEWCoupon\',\'Get\')">','                <ul id="J_mod_xinren_bottom_quan" class="mod_xinren_bottom_quan">',"                {% if(o.equityList && o.equityList.length) { %}","                {% $.each(o.equityList, function(i, obj){ %}","                {% if (i < 4){ %}",'                {% var ticketName = obj.ticketName || ""; %}','                    <li class="item">','                        <div class="item_left">','                            <span class="item_left_yuan">¥</span>','                            <span class="item_left_money">{%= obj.ticketAmount %}</span>',"                        </div>",'                        <div class="item_right">','                            <p class="item_right_txt">{%= obj.ticketType === "2" ? ticketName.slice(0,4) : ticketName %}</p>','                            <p class="item_right_txt">{%= obj.ticketType === "2" ? ticketName.slice(4) : "满" + obj.ticketCondition + "可用" %}</p>',"                        </div>",'                        <div class="item_done">','                            <i class="item_done_icon"></i>',"                        </div>","                    </li>","                {% } %}","                {% }); %}","                {% } %}","                </ul>",'                <div id="J_mod_xinren_bottom_btn" class="mod_xinren_bottom_btn">立即领取</div>',"            </a>",'            <a id="J_mod_xinren_bottom_close" class="mod_xinren_bottom_close" href="javascript:;" clstag="pageclick|keycount|201801051|2" onclick="log(\'PCNEWCoupon\',\'Close\')"></a>','            <div id="J_mod_xinren_bottom_dialog" class="mod_xinren_bottom_dialog ok">','                <div class="mod_xinren_bottom_dialog_inner">','                    <i class="mod_xinren_bottom_dialog_icon"></i>','                    <span id="J_mod_xinren_bottom_result"></span>',"                </div>","            </div>","        </div>","    </div>"].join(""),this.API={checkUrl:"https://api.m.jd.com/?functionId=firstTimePurchaseOpenCheck&client=pc&appid=firstTimePurchaseH5&jsonp=modXinrenBottomIsShow",receiveUrl:"https://api.m.jd.com/?functionId=firstTimePurchaseOpenRights&client=pc&appid=firstTimePurchaseH5&jsonp=modXinrenBottomTicket",pin:this.readCookieField("pin"),productLineId:this.conf.productLineId,isNeedEquity:"1"},this.isShowBottom(this.showBottom,this.notShowBottom)},initSomeEl:function(){this.$elBtn=$("#J_mod_xinren_bottom_btn"),this.$elQuan=$("#J_mod_xinren_bottom_quan"),this.$elDialog=$("#J_mod_xinren_bottom_dialog"),this.$elResult=$("#J_mod_xinren_bottom_result")},initEvent:function(){var t=this;t.$el.delegate("#J_mod_xinren_bottom_close","click",$.proxy(e.throttle(t.closeBottom,300),t)),t.$el.delegate("#J_mod_xinren_bottom_lk","click",$.proxy(e.throttle(t.receiveTicket,300),t))},readCookieField:function(t){var i=readCookie(t)||"";return i=decodeURIComponent(i)},isShowBottom:function(i,e){var n={pin:this.API.pin,productLineId:this.API.productLineId,isNeedEquity:this.API.isNeedEquity},s={body:JSON.stringify(n)};t({url:this.API.checkUrl,params:s,timeout:3e3,times:2,jsonpCallback:"modXinrenBottomIsShow"}).then($.proxy(function(t){"object"==typeof t&&"0"===t.statusCode&&"0"===t.firstPurchaseMark&&"1"===t.riskControlMark?i&&i(this,t.equityList):o.isO2XinrenBottom&&t.equityList?i&&i(this,t.equityList):e&&e("modXinrenBottomIsShow：不符合条件展示，接口返回statusCode为 "+t.statusCode)},this),e)},receiveTicket:function(){var i={pin:this.API.pin,productLineId:this.API.productLineId,requestActiveList:this.getActiveList(this.equityList)},e={body:JSON.stringify(i)};t({url:this.API.receiveUrl,params:e,timeout:3e3,times:2,jsonpCallback:"modXinrenBottomTicket"}).then($.proxy(function(t){"object"==typeof t&&"0"===t.statusCode?this.receiveTicketIsSucc(t.statusCode):(_.console.log("modXinrenBottomTicket：receiveTicketError1"),this.receiveTicketIsSucc(t.statusCode))},this),$.proxy(function(){_.console.log("modXinrenBottomTicket：receiveTicketError2"),this.receiveTicketIsSucc()},this))},receiveTicketIsSucc:function(t){var i=this,e={SUCCESS:"领取成功，请去“我的优惠券”选择","ERROR-1":"很抱歉喔亲，优惠券正在拼命补货中","ERROR-2":"很抱歉，优惠券繁忙中","ERROR-3":"很抱歉，优惠券补货中","ERROR-4":"亲，只有新用户才可以领取优惠券喔","ERROR-5":"很抱歉，优惠券发完啦！","ERROR-6":"操作过于频繁，系统正在排队，请稍后再试喔","ERROR-7":"很抱歉亲亲，优惠券实在太繁忙啦","ERROR-8":"亲，你已经领取过优惠券了喔","ERROR-9":"很抱歉亲，优惠券抢光啦！","ERROR-77777":"亲操作过于频繁，系统正在排队，请稍后再试喔","ERROR-88888":"很抱歉喔亲，系统开小差啦","ERROR-99999":"系统开小差啦",ERROR_NET:"网络异常，请再试一次！",ERROR_OTHER:"很抱歉喔亲，优惠券系统繁忙"};switch(_.console.log("modXinrenBottomTicket：领取优惠券接口返回statusCode为"+t),t){case"0":this.receiveTicketSucc(e.SUCCESS);break;case"-1":case"-2":case"-3":case"-4":case"-5":case"-6":case"-7":case"-8":case"-9":case"-77777":case"-88888":case"-99999":this.receiveTicketError(e["ERROR"+t]);break;default:var o=$('<img src="//static.360buyimg.com/mtd/pc/cms/images/mod_1x1.png?'+new Date+'">');o.appendTo("body").css("display","none").load(function(){_.console.log("联网成功！"),$(this).remove(),i.receiveTicketError(e.ERROR_OTHER)}).error(function(){_.console.log("断网了！"),$(this).remove(),i.receiveTicketError(e.ERROR_NET)})}},receiveTicketSucc:function(t){this.$elDialog.removeClass("ok error animate").addClass("ok animate"),this.$elResult.html(t),this.$elQuan.addClass("ok"),this.$elBtn.html("领取完成"),this.setTimeoutCloseDialog(!0)},receiveTicketError:function(t){this.$elDialog.removeClass("ok error animate").addClass("error animate"),this.$elResult.html(t),this.setTimeoutCloseDialog()},setTimeoutCloseDialog:function(t){var i=this,e=i.$elDialog;setTimeout(function(){t&&i.closeBottom(),e.removeClass("ok error animate")},3e3)},getActiveList:function(t){var i=[];if($.isArray(t)){var e={};$.each(t,function(t,o){e={activeId:o.batchNum,typeId:o.ticketType},i.push(e)})}return i},showBottom:function(t,i){var e={};e.equityList=i,t.equityList=i,t.renderTicket(e),log("PCNEWCoupon","ToastExpo")},renderTicket:function(t){try{var e=i(this.ticketTpl,t);this.conf.$container.append(e),this.$el=$("#J_mod_xinren_bottom"),this.$el.removeClass("hidden").addClass("shown"),this.initSomeEl(),this.initEvent()}catch(o){_.console.log("modXinrenBottom：渲染失败")}},closeBottom:function(){this.$el.removeClass("shown").addClass("hidden")},notShowBottom:function(t){var i=t||"modXinrenBottom：接口失败";_.console.log(i)}});return n});