!function(e){function a(a){for(var o,r,s=a[0],d=a[1],l=a[2],_=0,p=[];_<s.length;_++)r=s[_],i[r]&&p.push(i[r][0]),i[r]=0;for(o in d)Object.prototype.hasOwnProperty.call(d,o)&&(e[o]=d[o]);for(c&&c(a);p.length;)p.shift()();return n.push.apply(n,l||[]),t()}function t(){for(var e,a=0;a<n.length;a++){for(var t=n[a],o=!0,s=1;s<t.length;s++){var d=t[s];0!==i[d]&&(o=!1)}o&&(n.splice(a--,1),e=r(r.s=t[0]))}return e}var o={},i={"web/ui_media_selector":0},n=[];function r(a){if(o[a])return o[a].exports;var t=o[a]={i:a,l:!1,exports:{}};return e[a].call(t.exports,t,t.exports,r),t.l=!0,t.exports}r.m=e,r.c=o,r.d=function(e,a,t){r.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:t})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,a){if(1&a&&(e=r(e)),8&a)return e;if(4&a&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&a&&"string"!=typeof e)for(var o in e)r.d(t,o,function(a){return e[a]}.bind(null,o));return t},r.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(a,"a",a),a},r.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},r.p="";var s=window.webpackJsonp=window.webpackJsonp||[],d=s.push.bind(s);s.push=a,s=s.slice();for(var l=0;l<s.length;l++)a(s[l]);var c=d;n.push([146,"common"]),t()}({"/aNj":function(e,a,t){"use strict";t.r(a);var o=t("BxOC"),i=t("wetz"),n=function(){return function(e,a){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,a){var t=[],o=!0,i=!1,n=void 0;try{for(var r,s=e[Symbol.iterator]();!(o=(r=s.next()).done)&&(t.push(r.value),!a||t.length!==a);o=!0);}catch(e){i=!0,n=e}finally{try{!o&&s.return&&s.return()}finally{if(i)throw n}}return t}(e,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r="postpone",s="anonymous",d="poll_fixed",l="poll_closed",c="poll_background_id",_="poll_photo_id",p="poll_until",u="poll_is_multiple";window.MediaSelector=function(e,a,t,h,g,m){var v,f=[],w=(h=h||{}).mediaHandlers||{};each(t||[],function(a,t){var o=t[0],i=t[1],n=t[2];if(i){var s=!1,d=h.toId||cur.postTo,l={to_id:d,blockPersonal:h.blockPersonal};switch(l.mail_add=h.mail?1:"",l.from=h.from,o){case"graffiti":s=showBox.pbind("al_wall.php",{act:"canvas_draw_box",to_id:d,flash:browser.flash},{cache:1,dark:1});break;case"photos_list":s=showBox.pbind("al_photos.php",extend(l,{act:"choose_photo"}),{cache:1,stat:["photos.js","photos.css","upload.js"],dark:1});break;case"photo":s=w.photo?w.photo.pbind(h):showBox.pbind("al_photos.php",extend(l,{act:"choose_photo",max_files:h.limit||10,no_album_select:~(h.disabledTypes||[]).indexOf("album")?1:""}),{cache:1,stat:["photos.js","photos.css","upload.js"],dark:1});break;case"video":var c=extend(l,{act:"a_choose_video_box",max_files:h.limit||10});s=function(){var a=domClosest("_submit_post_box",e);hasClass(a,"anon_field_on")||showBox("al_video.php",c,{cache:1,dark:1})};break;case"audio":s=function(){var a=domClosest("_submit_post_box",e);hasClass(a,"anon_field_on")||stManager.add(["audio.js","indexer.js","auto_list.js","grid_sorter.js","audio.css"],function(){var a=!1;each(v.chosenMedias||[],function(){"audio_playlist"==this[0]&&(a=!0)}),cur.audioAttachOriginalOwnerId=!1,cur.audioAttachSwitchOwnerId=!1;var t=vk.id,o=parseInt((""+l.to_id||"").replace(/^board/,"-")),i=domClosest("_submit_post_box",e);domData(i,"from-oid")<0||"im"===cur.module&&cur.gid?(t=o,cur.audioAttachOriginalOwnerId=o,cur.audioAttachSwitchOwnerId=vk.id):cur.hasGroupAudioAccess&&(cur.audioAttachOriginalOwnerId=vk.id,cur.audioAttachSwitchOwnerId=o),AudioPage.showAttachBox(t,{canPlaylistAttach:!a&&!cur.editor,onAudioChoose:AudioUtils.onAudioChoose,onPlaylistChoose:AudioUtils.onPlaylistChoose})})};break;case"poll":s=function(){return v.chooseMedia("poll","",n)};break;case"doc":s=w.doc?w.doc.pbind(h):showBox.pbind("docs.php",Object.assign(l,h.docParams,{act:"a_choose_doc_box"}),{stat:["docs.css"]});break;case"map":s=showBox.pbind("al_places.php",extend(l,{act:"a_choose_place_box"}),{stat:["places.css","map.css","maps.js","ui_controls.css","ui_controls.js","boxes.css"],width:640,bodyStyle:"padding: 0px;",dark:1});break;case"note":s=showWiki.pbind({note:"new"},!0,!1,{queue:1});break;case r:s=function(e){if(m){var a=function(){cur["postPostponeTT"+v.lnkId].show()};v.postponeDatepicker?"DP_PLACEHOLDER"!==v.postponeDatepicker&&a():(cur.postponedLastDate&&(n.date=intval(cur.postponedLastDate)+3600),v.postponeDatepicker="DP_PLACEHOLDER",v.setupPostpone(n,null,a))}else v.chooseMedia(r,i,n);cancelEvent(e)};break;case"mark_as_ads":s=function(){return v.chooseMedia("mark_as_ads",i,n)};break;case"share":s=function(e){e=e||{},window.onShareChooseUrlBoxInit=function(){var e=geByClass1("share_url_input",curBox().bodyNode);addEvent(e,"keydown",function(e){if(e.which==KEY.ENTER)return t(curBox().btns.ok[0],e),!1})};var a=showBox("share.php",{act:"choose_url_box"},{dark:1}),t=function(t,o){var r=geByClass1("share_url_input",a.bodyNode),s=val(r);lockButton(t),disable(r,!0),hide("share_url_error"),v.chooseMedia("share",i,extend(n,{url:s,draft:!0,onSuccess:function(){disable(r,!1),unlockButton(t),a.hide(),e.videoId&&window.AdsEdit&&window.AdsEdit.showSnippetVideo&&window.AdsEdit.showSnippetVideo(e.videoId)},onError:function(e){var a="";e&&e!==getLang("global_unknown_error")&&(a=e+" "),disable(r,!1),unlockButton(t),ge("share_url_error").innerHTML=a+getLang("global_share_link_failed"),show("share_url_error")}}))};a.removeButtons(),a.addButton(getLang("global_continue"),t)};break;case"pretty_cards":s=function(e){e&&e.replace_owner_id&&(n.editor.owner_id=e.replace_owner_id),v.chooseMedia("pretty_cards",i,n)};break;case"gift":s=function(){var e=(e=h.peer<2e9?h.peer:0)||cur.peer;h.giftBoxPrepare&&h.giftBoxPrepare(e),showBox("al_gifts.php",{act:"get_gift_box",mid:e,fr:e==vk.id?1:0,ref:"media_selector"},{stat:["gifts.css","wide_dd.js","wide_dd.css"],dark:1})};break;case"money":s=function(){var e=cur.peer;d>-2e9&&d<0&&(l.owner_id=d),showBox("al_payments.php",extend(l,{act:"money_transfer_box",to_id:e}),{onFail:function(e){return setTimeout(showFastBox(getLang("global_error"),e).hide,2e3),!0}})};break;case"market":d==vk.id?(s=showBox.pbind("al_market.php",extend(l,{act:"a_choose_user_product_box"}),{cache:1}),n.tt_words&&(cur.checkMessageHandler=function(e){if(!cur.marketIntroShown&&(e=" "+e+" ").match(new RegExp("\\s("+n.tt_words.join("|")+")\\s","i"))){var a=getSize(v.menu.moreWrap);showTooltip(v.menu.moreWrap,{text:n.tt_text,dir:"left",slideX:15,width:230,shift:[-a[0]-5,-a[1]/2],hasover:1}),cur.marketIntroShown=!0}})):s=showBox.pbind("al_market.php",extend(l,{act:"a_choose_product_box"}),{cache:1});break;case"article":s=function(){return openArticleEditor(d)};break;case"podcast":s=function(){stManager.add([jsc("web/podcast.js")],function(){Podcast.select()})}}s&&f.push([o,i,s])}}),a=ge(a||"media_preview"),g=!1!==g&&ge(g||"post_settings_btn"),m=!1!==m&&ge(m||"post_actions_btns");var b=h.limit||10,k=b>1,y=h.editable&&(!browser.msie||parseInt(browser.version)>8),C=h.sortable&&(!browser.msie||parseInt(browser.version)>8),x=!!m,M=function(e,a,t){if(!(e=ge(e)))return!1;t=t||{},window.__addMediaIndex||(window.__addMediaIndex=0);var o=++__addMediaIndex;e.innerHTML='<div class="media_selector clear_fix"></div>';var i,n=domByClass(e,"media_selector"),s=[],d={id:o,menuNode:n,types:a,lastTypes:a,activate:function(e){d.touched=!0===e,t.onActivate&&t.onActivate()},show:function(){if(i&&(clearTimeout(i),i=0),d.moreWrap&&!hasClass(d.moreWrap,"shown")){t.forceToUp||replaceClass(d.moreWrap,"to_up","to_down");var e=domByClass(d.moreWrap,"_more_items"),a=getClientRectOffsetY(e);(a>0||t.forceToUp)&&replaceClass(d.moreWrap,"to_down","to_up"),setTimeout(addClass.pbind(d.moreWrap,"shown"),0)}},hide:function(e){function a(a){return e.apply(this,arguments)}return a.toString=function(){return e.toString()},a}(function(e){if(!i){var a=function(){i=0,d.moreWrap&&removeClass(d.moreWrap,"shown")};if(e){var t=domByClass(d.moreWrap,"_more_items");hide(t),a(),setTimeout(show.pbind(t),0)}else i=setTimeout(a,300)}}),setOptions:function(e){extend(t,e)},setItems:function(e){for(window.tooltips&&tooltips.destroyAll(n);n.firstChild;)re(n.firstChild);var a=void 0!==t.hideAfterCount?t.hideAfterCount:4,o=void 0!==t.maxShown?t.maxShown:3,i=!1,l=t.hideItem,c=(l||e.length>a)&&(!browser.mobile||t.ignoreMobile),_=t.hideLabel||getLang("global_media_selector_more");function p(e,a,o,i,n,r){var l=ce("a",{innerHTML:i?a:'<span class="blind_label">'+a+"</span>",className:"ms_item ms_item_"+e+" _type_"+e});if(!i&&d.moreWrap?domInsertBefore(l,d.moreWrap):(i||n).appendChild(l),l.setAttribute("tabindex",0),!i){l.setAttribute("data-title",a),l.setAttribute("aria-label",a),l.setAttribute("role","link");var c=function(){hasClass(this,"ms_item_article_highlight")||showTitle(this,!1,r||!1,{noZIndex:!0})};addEvent(l,"mouseover",c),s.push(function(){removeEvent(l,"mouseover",c)})}if(o&&!cur.viewAsBox){var _=function(){return d.activate(),d.hide(!0),!(t.onItemClick&&!t.onItemClick(e))&&(o(),!1)};addEvent(l,"click",_),s.push(function(){removeEvent(l,"click",_)})}}d.moreWrap=!1,d.lastTypes=e,each(e,function(e,a){var u=a[0],h=a[1],g=a[2];if("article"!=u){if(u==r&&x&&!d.postponeBtn){var m=getLang("wall_publication_now");d.postponeBtn=se('<div class="post_action_btn" id="post_postpone_btn'+d.id+'">\n                <div class="post_action_btn_layout">\n                  <span class="post_action_btn_text" role="button" aria-label="'+replaceEntities(m)+'">'+m+'</span>\n                  <div class="post_action_tt_content _postpone" id="post_postpone_tt_content'+d.id+'" onclick="cancelEvent(event)"></div>\n                </div>\n               </div>'),t.actionsEl.appendChild(d.postponeBtn);var f="post_postpone_btn"+d.id,w=ge(f),b=geByClass1("post_action_tt_content",w),k=geByClass1("post_action_btn_layout",w),y=[-4*(vk.rtl?-1:1),4],C=new ElementTooltip(k,{appendTo:domPN(w),forceSide:"bottom",autoShow:!1,customShow:!0,cls:"eltt_fancy eltt_fancy_actions _postpone",noOverflow:!1,centerShift:0,offset:y,content:b,noHideOnClick:!0,align:"left",onShow:function(){v.activeState=!0},onHide:function(){v.activeState=!1},onWindowClick:function(){C.hide(),v.resetPostpone(+v.postponeDate)},onFirstTimeShow:function(){show(b)}});return cur["postPostponeTT"+d.id]=C,cur.destroy.push(function(){C&&C.destroy()}),addEvent(d.postponeBtn,"click",g),void s.push(function(){removeEvent(d.postponeBtn,"click",g)})}if(c&&(l?u==l:e==o)){var M=n.appendChild(ce("div",{className:"ms_items_more_wrap"})),S=function(e){d.fromKeyboard=checkKeyboardEvent(e),"mouseover"==e.type&&(d.touched||d.fromKeyboard)||(d.fromKeyboard&&hasClass(d.moreWrap,"shown")?d.hide():d.show())},P=function(){d.fromKeyboard||d.hide()};addEvent(M,"mouseover click",S),addEvent(M,"mouseout",P),s.push(function(){removeEvent(M,"mouseover click",S),removeEvent(M,"mouseout",P)}),t.vectorIcon&&(_='<span class="blind_label">'+_+"</span>",addClass(M,"ms_items_more_wrap_vector"));var B=M.appendChild(ce("a",{className:"ms_item_more",innerHTML:'<span class="ms_item_more_label">'+_+"</span>"}));B.setAttribute("tabindex",0),B.setAttribute("role","button");var I=ce("div",{className:"ms_items_more_helper"});i=ce("div",{className:"ms_items_more _more_items"}),I.appendChild(i),M.appendChild(I),d.moreWrap=M}p(u,h,g,i,n)}else isArticleEditorAvailable()&&p(u,h,g,!1,n,[6,8])})}};a&&d.setItems(a),browser.msie&&(removeEvent(e,"MSPointerDown"),addEvent(e,"MSPointerDown",d.activate.pbind(!0)));removeEvent(e,"mouseover"),addEvent(e,"mouseover click",d.activate),t.global||cur.destroy.push(function(){removeEvent(e,"mouseover click",d.activate)});t.forceToUp&&addClass(geByClass1("ms_items_more_wrap",n),"to_up");return d.handlersToClean=s,d}(e,f,{onActivate:function(){cur.attachCount=v.attachCount,cur.chooseMedia=v.chooseMedia,cur.hasChosenMedia=v.hasChosenMedia,cur.lastAddMedia=v,cur.onMediaUploadStarted=h.onMediaUploadStarted,cur.showMediaProgress=v.showMediaProgress,cur.unchooseMedia=v.unchooseMedia,cur.updateChosenMedia=v.updateChosenMedia},onItemClick:function(e){return!(k&&v.attachCount()>=b&&"postpone"!==e&&"mark_as_ads"!==e&&"copyright"!==e)||(vk.widget?showBox("blank.php",{code:1900,limit:b}):showFastBox(getLang("global_error"),getLang("attachments_limit",b)),!1)},hideAfterCount:h.hideAfterCount,topOffset:h.topOffset,forceUp:h.forceUp,global:h.global,maxShown:h.maxShown,forceToUp:h.forceToUp,vectorIcon:h.vectorIcon,ignoreMobile:h.ignoreMobile,actionsEl:m,hideLabel:h.hideLabel});if(M){var S=intval(M.id);if(k){a.innerHTML='<div id="page_pics_preview'+S+'" class="page_pics_preview media_preview clear_fix"></div><div id="page_dpics_preview'+S+'" class="page_pics_preview post_thumbed_media page_media_sortable media_preview clear_fix"></div><div id="page_docs_preview'+S+'" class="page_docs_preview post_thumbed_media page_media_sortable media_preview clear_fix"></div><div id="page_pdocs_preview'+S+'" class="page_docs_preview media_preview clear_fix"></div><div id="page_ldocs_preview'+S+'" class="page_docs_preview media_preview clear_fix"></div><div id="page_adocs_preview'+S+'" class="page_docs_preview media_preview clear_fix"></div><div id="page_mpics_preview'+S+'" class="page_pics_preview media_preview clear_fix"></div><div id="page_ppdocs_preview'+S+'" class="page_docs_preview media_preview _page_ppdocs_preview clear_fix"></div><div id="page_progress_preview'+S+'" class="page_progress_preview media_preview clear_fix"></div>';var P=domFC(a),B=domNS(P),I=domNS(B),A=domNS(I),T=domNS(A),D=domNS(T),L=domNS(D),E=domNS(L),N=domNS(E);removeClass(a,"media_preview"),addClass(a,"multi_media_preview")}else addClass(a,"med_no_attach"),show(a);return x&&(E=ge("post_postpone_tt_content"+S)),(v={_addMediaLink:e,lnkId:S,menu:M,types:f,phLists:{},handlers:{},postponeIsTooltip:x,chosenMedias:[],limit:b,_showAddMedia:function(){M.show()},_hideAddMedia:function(e){M.hide(e)},hasRestrictingAttach:function(){return geByClass1("medadd_c_market",I)||geByClass1("medadd_c_story",I)},updateChosenMedia:function(e,a,t){v.chooseMedia(e,a,t,null,null,null,!0)},hasChosenMedia:function(e,a){var t=!1;return each(v.chosenMedias,function(){if(this[0]===e&&this[1]===a)return t=!0,!1}),t},chooseMedia:function(t,o,i,s,d,l,c){if(!cur.articleEditorLayer||"article"==t){if(vk.widget&&(o=clean(o)),t==r&&x){if(hasClass(v.menu.postponeBtn,"on"))return!1;addClass(v.menu.postponeBtn,"on")}if(h.poster&&h.poster.isOpen()&&t!==r&&"copyright"!==t&&h.poster.closeEditor(),v.onChange&&!1===v.onChange(t,o,i,s))return void 0!==i.upload_ind&&re("upload"+i.upload_ind+"_progress_wrap"),!1;if("note"===t&&(cur.pbNoteAdded=!1),inArray(t,h.disabledTypes||[]))return!1;if((v.attachCount()>=b&&void 0===i.upload_ind&&t!==r&&"mark_as_ads"!==t||v.hasRestrictingAttach())&&"copyright"!==t){if(k)return!1;v.unchooseMedia()}var _=!1,p={},u=null;if(k&&(each(v.chosenMedias,function(e){if(u=e,this[0]==t&&this[1]==o)return _=!0,!1;p[this[0]]=p[this[0]]?p[this[0]]+1:1}),_&&!c||c&&!_))return!1;var g,m,f="",w="",N=!1,U=I,z="",q="";switch(t){case"graffiti":if(p.pretty_cards)return!1;isObject(i)||(i={thumb:i||""}),f='<div class="fl_l page_preview_graffiti"><img class="page_preview_graffiti" src="'+(i=Pe(i)).thumb+'" /></div>',U=N=L;break;case"photos_list":if(vk.widget||p.pretty_cards)return!1;hide(this._addMediaLink),vkImage().src=i[1],(O=i[3].replace(/^{|}$/g,""))&&(O+=","),O+='"queue":1',f="<div"+(h.nocl?"":" onclick=\"return showPhoto('"+i[4]+"', '"+i[2]+"', '"+O.replace(/"/g,"&quot;")+');"')+' class="fl_l page_preview_photo"><img class="page_preview_photo" src="'+i[1]+'" /></div>',U=N=P;break;case"photo":if(p.pretty_cards)return!1;isObject(i)||(i={thumb_m:i[0]||"",thumb_s:i[1]||"",list:i[2]||"",view_opts:i[3]||"",upload_ind:i.upload_ind||void 0}),i=Pe(i),vkImage().src=i.thumb_m;var O=i.view_opts.replace(/^{|}$/g,"");if(vk.widget&&(O=O.replace(/&quot;/g,'"')),O&&(O+=","),O+='"queue":1',v.phLists[o]=i.list,y){if(!i.editable)return!1;if(!h.nocl){var F="{"+O+"}";F=vk.widget?JSON.parse(F):parseJSON(F),i.editable.click=v.showPhoto.pbind(o,i.list,F)}}f="<div "+(h.nocl?"":' onclick="return cur.addMedia['+v.lnkId+"].showPhoto('"+o+"', '"+i.list+"', {"+O.replace(/"/g,"&quot;")+'});"')+' class="fl_l page_preview_photo'+(l?" page_preview_ph_graff":"")+'"><img class="page_preview_photo" src="'+i.thumb_m+'" /></div>',N=1,U=P;break;case"video":if(p.pretty_cards)return!1;if(isObject(i)||(i={thumb:i||""}),y){if(!i.editable)return!1;h.nocl||(i.editable.click=showVideo.pbind(o,i.list_id,{queue:1,autoplay:1}))}i=Pe(i),f="<div "+(h.nocl?"":"onclick=\"return showVideo('"+o+"', '"+i.list_id+"', {queue:1,autoplay:1});\"")+' class="fl_l page_preview_video"><img class="page_preview_video" src="'+i.thumb+'" /></div>',N=1,U=P,m=i.list_id;break;case"article":if(vk.widget||p.article||p.page||p.pretty_cards||!i)return!1;f='<div class="medadd_h medadd_h_pretty_cards inl_bl">'+getLang("global_article")+"</div>",w=i.snippet_html,o=i.url,i.rev&&(o+="?rev="+i.rev),U=T;break;case"audio":if(p.pretty_cards)return!1;i=Pe(i),f=Page.addAudioPreview(clean(o),i),z=' id="pam'+S+"_audio"+clean(o)+'"';break;case"audio_playlist":if(p.audio_playlist)return!1;var R=(i=Pe(i)).coverUrl?"background-image:url('"+i.coverUrl+"'); background-size: cover;":"",j="";j=i.authorHref?'<a href="'+i.authorHref+'" onclick="return nav.go(this)">'+i.authorName+"</a>":i.authorName;var H="'"+(i.accessHash||"")+"'";w='<div class="audio_pl_attach_preview _audio_pl _audio_pl_'+i.ownerId+"_"+i.id+' clear_fix"><div class="audio_pl_attach_preview__play" onclick="return getAudioPlayer().playPlaylist('+i.ownerId+", "+i.id+", "+H+')"></div><div class="audio_pl_attach_preview__cover" style="'+R+'">'+(i.gridCovers||"")+'</div><div class="audio_pl_attach_preview__title">'+i.title+'</div><div class="audio_pl_attach_preview__info_line">'+j+"</div></div>",f='<span class="medadd_h">'+getLang("global_audio_playlist")+"</span>",U=T;break;case"artist":if(p.artist)return!1;var W=i.coverUrl?"background-image:url('"+i.coverUrl+"');":"";w='<div class="audio_artist_attach_preview _audio_artist _audio_pl _audio_pl_'+i.ownerId+"_artist"+i.blockId+' clear_fix"><div class="audio_artist_snippet__cover" style="'+W+'"></div><div class="audio_artist_snippet__info"><div class="audio_artist_snippet__play" onclick="return getAudioPlayer().playBlock(\''+i.ownerId+"', 'artist"+i.blockId+"', '', '', 'artist')\">"+getLang("audio_listen_snippet")+'</div><div class="audio_artist_snippet__title">'+i.title+'</div><div class="audio_artist_snippet__subtitle">'+getLang("global_artist")+"</div></div></div>",f='<span class="medadd_h">'+getLang("global_artist")+"</span>",U=T;break;case"doc":if(vk.widget||p.pretty_cards)return!1;if(i.editable){var G="stopEvent(event);";(i=Pe(i)).hasBox&&(i.editable.click=function(e){Page.showGifBox(i.id,i.ownerId,intval(i.postId),intval(i.postOwnerId),i.hash,e)},G="Page.showGifBox("+intval(i.id)+", "+intval(i.ownerId)+", "+intval(i.postId)+", "+intval(i.postOwnerId)+", '"+i.hash+"', event);"),q+=" page_preview_doc_as_photo_wrap";var V=i.editable.sizes.m||i.editable.sizes.s,$=n(V,1)[0];f='<a href="'+i.editable.href+'" onclick="'+(h.nocl?"":G)+'" class="page_preview_doc_as_photo" target="_blank" rel="noopener" style="background-image: url(\''+$+'\');"><img class="page_preview_doc_as_photo" src="'+$+'" />'+i.editable.label+"</a>",N=1,U=P}else i.thumb&&i.thumb_s?(f="gif"==i.ext?'<a onclick="if (cur.cancelClick) return (cur.cancelClick = false);" target="_blank" rel="noopener" href="'+i.href+'" class="pam_dpic"><div class="page_preview_doc_photo"><img src="'+i.thumb+'" align="center" /></div><div class="page_preview_doc_photo_hint doc_gif">'+i.title+"</div>":'<a onclick="if (cur.cancelClick) return (cur.cancelClick = false);" target="_blank" rel="noopener" href="'+i.href+'" class="pam_dpic"><div class="page_preview_doc_photo"><img src="'+i.thumb+'" align="center" /></div><div class="page_preview_doc_photo_hint">'+i.title+"</div>",w='</a><div class="pam_bg"></div>',U=N=B,z=' id="pam'+S+"_doc"+o+'"'):(f="",w='<div class="page_doc_row"><a target="_blank" rel="noopener" href="'+i.href+'" class="page_doc_icon page_doc_icon'+intval(i.type)+'"></a><a target="_blank" href="'+i.href+'" class="page_doc_title">'+i.title+'</a><div class="page_doc_description_row"><div class="page_doc_size">'+i.size_str+"</div></div></div>",z=' id="pam'+S+"_doc"+o+'"');break;case"story":if(vk.widget||p.pretty_cards)return!1;f='<div class="medadd_c_story"><a target="_blank" rel="noopener" '+i.attr+'"><div class="medadd_c_story_thumb fl_l" style="background-image:url('+i.thumb+')"></div></a><div class="medadd_c_story_info fl_l"><a class="medadd_c_story_title" target="_blank" '+i.attr+'">'+i.title+'</a><div class="medadd_c_story_desc">'+i.date_string+"</div></div>",hide(e);break;case"narrative":if(p.narrative)return!1;f='<span class="medadd_h">'+getLang("global_type_narrative")+"</span>",w=i.snippet_html;break;case"mask":if(vk.widget||p.pretty_cards)return!1;f='<div class="medadd_c_mask"><div class="medadd_c_story_thumb fl_l" style="background-image:url(/images/landings/vkmasks/masksSnippet_2x.png)"></div></a><div class="medadd_c_story_info fl_l"><div class="medadd_c_story_title">'+i.share.title+'</div><div class="medadd_c_story_desc">'+i.share.desc+"</div></div>";break;case"share":if(p.share||p.page||p.pretty_cards||p.market||!i.lang)return!1;if(isArray(i)&&(i={domain:i[0],url:i[1],initialPattern:i[2],title:i[3],description:i[4],images:[i[5]],user_id:i[6],photo_id:i[7]}),i.draft){var K={onSuccess:i.onSuccess,onError:i.onError};return v.checkURL(i.url,void 0,{},K),!1}if(!i.title&&!(cur.options.share||{}).allow_preview_empty_links)return(i.onError||function(){})(),!1;if(i.title=unclean((i.title||"").replace(/<br>/g,"\n")),i.description=unclean((i.description||"").replace(/<br>/g,"\n")),i.description_short=unclean((i.description_short||"").replace(/<br>/g,"\n")),i.description_narrow=unclean((i.description_narrow||"").replace(/<br>/g,"\n")),cur.options=cur.options||{},cur.options.share&&cur.options.share.max_title_len&&(i.title=(i.title||"").substr(0,cur.options.share.max_title_len)),cur.options.share&&cur.options.share.max_desc_len&&(i.description=(i.description||"").substr(0,cur.options.share.max_desc_len),i.description_short=(i.description_short||"").substr(0,cur.options.share.max_desc_len),i.description_narrow=(i.description_narrow||"").substr(0,cur.options.share.max_desc_len)),i.media=i.media||o,i.lang&&(cur.lang=extend(cur.lang||{},i.lang)),i=Pe(i),f='<a target="_blank" rel="noopener" href="/away.php?to='+encodeURIComponent(i.url)+'" class="medadd_h medadd_h_link inl_bl">'+clean(unclean(i.lang.profile_choose_link))+"</a>",v.shareData=extend(v.shareData||{},i,{imagesStyles:[""]}),U=T,(i.onSuccess||function(){})(),(cur.options.share||{}).button_exclusive&&i.shareButtons)hide(e),(X=ge("signed"))&&disable(X);hide(domByClass(M.menuNode,"_type_share")),hide(domByClass(M.menuNode,"_type_market"));break;case"pretty_cards":if(p.share||p.pretty_cards||vk.widget)return!1;var X;f='<div class="medadd_h medadd_h_pretty_cards inl_bl">'+i.lang.global_wall_pretty_cards+"</div>",(X=ge("signed"))&&disable(X),hide(domByClass(M.menuNode,"_type_pretty_cards")),hide(e),U=T;break;case"poll":if(!i.lang||vk.vidget||p.poll||!A||p.pretty_cards)return!1;hide(domByClass(M.menuNode,"_type_poll")),U=A;break;case"map":if(vk.widget||p.pretty_cards)return!1;f="<div class=\"fl_l\"><a onclick=\"return showBox('al_places.php', {act: 'geo_box', lat: "+i[0]+", long: "+i[1]+", provider: "+intval(i[3])+'}, {dark: 1});"><div class="page_media_map_point"></div><img class="page_preview_map" width="340" height="127" src="/maps?lat='+i[0]+"&lng="+i[1]+"&z=11&"+(window.devicePixelRatio,"w=680&h=254")+'" /></a></div>',U=N=L,hide(domByClass(M.menuNode,"_type_map"));break;case"page":if(p.share||p.page||!i.lang||vk.widget||p.pretty_cards)return!1;var Y=i.media.split("_");f='<a href="/page'+i.media+'" onclick="return showWiki({oid: '+Y[0]+", id: "+Y[1]+'}, false, event, {queue: 1})" class="medadd_h medadd_h_page inl_bl">'+i.lang.profile_choose_page+"</a>",U=T;break;case"album":if(vk.widget||p.pretty_cards)return!1;if(i.is_private_album){extend(i.editable,{title:i.title,size:0}),N=1,U=P;break}if(i.thumb.match(/^\/images\//)&&(i.thumb=""),y){if(!i.editable)return!1;extend(i.editable,{title:i.title,size:i.count,click:!h.nocl&&nav.change.pbind({z:"album"+o})})}var Q=i.thumb;vkImage().src=Q,g=h.nocl?"":' href="/album'+o+'" onclick="return nav.change({z: \'album'+o+"'}, event)\"",f='<a class="'+("fl_l page_album_link"+(Q?"":" page_album_nocover"))+'" '+g+">\n              "+(Q?'<div class="page_album_thumb_wrap"><img class="page_album_thumb" src="'+Q+'"/></div>':"")+'\n              <div class="page_album_title">\n                <div class="page_album_size">'+i.count+'</div>\n                <div class="page_album_title_text">'+i.title+"</div>\n              </div>\n            </a>",N=1,U=P;break;case"note":if(!i.lang||vk.widget||p.pretty_cards)return!1;f="<a onclick=\"showWiki({w: 'note"+i.raw+'\', edit: 1}, true, event, {queue: 1})" class="medadd_h medadd_h_note inl_bl">'+i.lang.profile_choose_note+"</a>",w='<div class="medadd_c medadd_c_note"><a onclick="showWiki({w: \'note'+i.raw+'\', edit: 1}, true, event, {queue: 1})" id="share_note_title'+i.raw+'">'+i.title+"</a></div>",U=T;break;case"market":if(vk.widget||p.pretty_cards||p.share)return!1;f='<div class="medadd_c_market"><a target="_blank" rel="noopener" href="'+i.href+'"><img class="medadd_c_market_thumb fl_l" src="'+i.thumb+'" /></a><div class="medadd_c_market_info fl_l"><a class="medadd_c_market_title" target="_blank" href="'+i.href+'">'+i.title+'</a><div class="medadd_c_market_price">'+i.price+"</div></div>",hide(e);break;case"market_album":if(vk.widget||p.pretty_cards)return!1;if(i.is_private_album){extend(i.editable,{title:i.title,msize:""}),N=1,U=P;break}if(y){if(!i.editable)return!1;extend(i.editable,{title:i.title,msize:langNumeric(i.count,i.lang.profile_X_market_items),click:!1})}Y=o.split("_");vkImage().src=i.thumb,g=h.nocl?"":' href="/market'+Y[0]+"?section=album_"+Y[1]+'"',f='<a class="'+("fl_l page_preview_album wall_album_cover_wrap wall_market_album_cover"+(i.thumb?"":" page_album_nocover"))+'" '+g+">\n              "+(i.thumb?'<img class="wall_album_cover" src="'+i.thumb+'"/>':"")+'\n              <div class="wall_album_caption">\n                <div class="wall_album_title_wrap clear_fix">\n                  <div class="wall_album_count fl_r">'+i.count+'</div>\n                  <div class="wall_album_title">'+i.title+"</div>\n                </div>\n              </div>\n            </a>",N=1,U=P;break;case"copyright":if(vk.widget)return!1;v.copyrightCreate(i);break;case r:if(vk.widget)return!1;var J="";if(cur.editingPost&&!k)o=intval(o),i.date=o||intval(cur.editingPost[7]),ge("wpe_save").innerHTML=getLang("global_save"),J=getLang("global_save");else if(cur.editingPost&&"wpe_media_preview"==a.id){o=intval(o),i.date=o||intval(cur.editingPost[7]);var Z=geByClass1("medadd_c_timersett",E);if(Z){var ee=domPN(Z);Z=ee.innerHTML,re(ee)}else Z="";ge("wpe_save").innerHTML=getLang("global_save"),J=getLang("global_save")}else{i.draft?i.date=intval(o):cur.postponedLastDate&&(i.date=intval(cur.postponedLastDate)+3600);var ae=ge("official");if(!(we=gpeByClass("_submit_post_box",ae))&&h.poster&&domClosest("poster",ae)&&(we=ge("submit_post_box")),ae&&we){var te=domData(we,"from-oid"),oe=domData(we,"oid");te==vk.id&&oe&&wall.setReplyAsGroup(ae,{from:oe}),disable(ae);var ie=window.data(ae,"tt");if(ie&&ie.rdBtns){var ne=ie.rdBtns[1],de=ie.rdBtnsGroup,le=domData(ne,"as");radiobtn(ne,le,de)}}(ne=ge("send_post"))&&(ne.innerHTML=i.lang.profile_wall_postpone_btn,J=i.lang.profile_wall_postpone_btn)}x?(v.updatePostponeBtnText(!1,i.date),v.postponeDate=i.date):f='<div class="medadd_h medadd_h_timer inl_bl">'+i.lang.profile_choose_timer+'<span id="postpone_preview'+S+'"></span></div>',!v.postponeDatepicker&&x&&v.setupPostpone(i,Z),h.poster&&h.poster.changeBtnText(J);var _e=Math.round((new Date).getTime()/1e3);intval(i.date)<_e&&(i.date=_e+3600),hide(domByClass(M.menuNode,"_type_postpone")),U=E;break;case"mark_as_ads":if(vk.widget)return!1;f='<div class="medadd_h medadd_h_mark_as_ads inl_bl">'+i.lang.global_ads_wall_post_mark_as_ads_action+"</div>",hide(domByClass(M.menuNode,"_type_mark_as_ads")),U=E;break;case"wall":if(vk.widget||p.pretty_cards)return!1;f='<div class="medadd_c_wall"><a target="_blank" rel="noopener" href="'+i.href+'"><img class="medadd_c_wall_thumb fl_l" src="'+i.thumb+'" /></a><div class="medadd_c_wall_info fl_l"><a class="medadd_c_wall_author" target="_blank" href="'+i.href+'">'+i.author+'</a><div class="medadd_c_wall_type">'+i.lang.title+"</div></div>",z=' id="pam'+S+"_wall"+o+'"',hide(e);break;case"wall_reply":if(vk.widget||p.pretty_cards)return!1;f='<div class="medadd_c_wall"><a target="_blank" rel="noopener" href="'+i.href+'"><img class="medadd_c_wall_thumb fl_l" src="'+i.thumb+'" /></a><div class="medadd_c_wall_info fl_l"><a class="medadd_c_wall_author" target="_blank" href="'+i.href+'">'+i.author+'</a><div class="medadd_c_wall_type">'+i.lang.title+"</div></div>",z=' id="pam'+S+"_wall_reply"+o+'"',hide(e);break;case"podcast":if(vk.widget||p.pretty_cards)return!1;var pe="_im_media_preview"===domPN(U).id,ue=!pe&&cur.editingPost&&"wpe_media_preview"===domPN(U).id;if(pe)f='<div class="medadd_c_podcast"><a target="_blank" rel="noopener" href="'+i.href+'"><img class="medadd_c_podcast_thumb fl_l" src="'+i.thumb+'" /></a><div class="medadd_c_podcast_info fl_l"><a class="medadd_c_podcast_title" target="_blank" href="'+i.href+'">'+i.title+'</a><div class="medadd_c_podcast_type">'+i.lang.title+"</div></div>";else{var he=!1;each(v.chosenMedias||[],function(e,a){isArray(a)&&"podcast"===a[0]&&(cur.addMedia[v.lnkId].unchooseMedia(e),he=!0)}),he&&v.onChange&&v.onChange(t,o,i,s),f='<div class="podcast_preview_title">'+getLang("audio_podcast_attach_media")+"</div>";var me=i.audio[AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+i.audio[AudioUtils.AUDIO_ITEM_INDEX_ID];cur.podcastEditData={audioId:me,ref:"post",onCreate:function(e,a){v.chooseMedia("podcast",e[AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[AudioUtils.AUDIO_ITEM_INDEX_ID],{audio:e,coverUrl:a})}};var ve="<span class=\"podcast_snippet__edit\" onclick=\"cur.chooseMedia = cur.podcastEditData.chooseMedia; stManager.add([jsc('web/podcast.js')], function() { Podcast.edit('"+me+"'); });\"></span>";f+='<div class="podcast_snippet_loading" id="podcast_loading'+o[0]+'"></div>',stManager.add([jsc("web/podcast.js")],function(){domReplaceEl(ge("podcast_loading"+o[0]),Podcast.drawSnippet(i.audio,i.coverUrl,ve))},!0)}if(U=D,hide(domByClass(M.menuNode,"_type_podcast")),!pe&&!ue){var fe=ge("official"),we=fe&&gpeByClass("_submit_post_box",fe);if(fe&&we)(te=domData(we,"from-oid"))!==(oe=domData(we,"oid"))&&(q=" attach_disabled")}}if(k){var be=v.chosenMedias,ke=_?u:be.length,ye="";if(ye=(!y||1!==N)&&("photos_list"===t?se('<div class="page_preview_'+t+"_wrap"+q+'" style="position: relative">'+f+'<div class="page_photos_count">'+o.split(",").length+"</div></div>"):!(t==r&&x||"copyright"===t)&&se('<div class="page_preview_'+t+"_wrap"+q+'"'+(h.nocl?' style="cursor: default"':"")+z+">"+f+'<div nosorthandle="1" class="page_media_x_wrap inl_bl" data-title="'+getLang("dont_attach")+'" aria-label="'+getLang("dont_attach")+'" role="button" onmouseover="showTitle(this)" onclick="cur.addMedia['+v.lnkId+"].unchooseMedia("+ke+'); return cancelEvent(event);"><div class="page_media_x" nosorthandle="1"></div></div>'+w+"</div>")),addClass(ye,N?"fl_l":"clear_fix"),void 0!==i.upload_ind&&re("upload"+i.upload_ind+"_progress_wrap"),h.toggleLnk&&!_){var Ce=v.attachCount()+1<b;toggle(e,Ce),h.onToggleBlock&&h.onToggleBlock(Ce)}y&&1===N?(addClass(U,"editable_thumbs_wrap"),U=domLC(U)&&hasClass(domLC(U),"editable_thumbs")?domLC(U):U.appendChild(ce("div",{id:"thumbs_edit"+S,className:"editable_thumbs"})),stManager.add(["thumbs_edit.css",jsc("web/thumbs_edit.js")],function(){if(be[ke]&&(be[ke].type===t||be[ke].media!==o)){if(h.toggleLnk&&!_){var n=v.attachCount()+1<b;toggle(e,n),h.onToggleBlock&&h.onToggleBlock(n)}i.editable.remove=v.unchooseMedia.pbind(ke),show(domPN(U));var r=ThumbsEdit.convert(t,o,i.editable);domData(U,"te-inited")?_?ThumbsEdit.updateMedia(U,t,o,i):ThumbsEdit.addMedia(U,r):ThumbsEdit.init(U,[r],{width:h.teWidth,height:h.teHeight,force:!0,onMove:h.onAddMediaChange,onUpdate:h.onChangedSize,deferred:!0}),toggleClass(a,"media_preview_has_medias",v.hasVisibleRows()&&(hasClass(a,"reply_media_preview")||isVisible(e)||!hasClass("signed","disabled"))),h.onChangedSize&&h.onChangedSize()}},!0)):((t!=r&&"copyright"!=t||!x)&&(show(U),_?U.replaceChild(ye,be[u][2]):U.appendChild(ye)),C&&(U==I?stManager.add(["sorter.js"],function(){var e=getXY(I),a=getSize(I),t=function(){I.sorter?sorter.added(I):U.childNodes.length>1&&sorter.init(I,{onReorder:h.onAddMediaChange})};e[0]||e[1]||a[0]||a[1]?t():cur.sorterClbk=t,h.onChangedSize&&h.onChangedSize()},!0):U==B&&stManager.add(["qsorter.js"],function(){B.qsorter?qsorter.added(B):U.childNodes.length>1&&qsorter.init(B,v.qsorterOpts()),h.onChangedSize&&h.onChangedSize()},!0)),h.onChangedSize&&h.onChangedSize()),_?be[u]=[t,o,ye,s,m,i]:be.push([t,o,ye,s,m,i])}else{ke=0;if(t===r?ke=1:"mark_as_ads"===t&&(ke=2),t==r&&x||"copyright"===t)ye=!1;else{var xe=(!1===N?"page_docs_preview":"page_pics_preview")+(ke?"":" post_thumbed_media");ye=se('\n            <div class="'+(xe+=N?" fl_l":" clear_fix")+'">\n              <div class="page_preview_'+t+"_wrap "+q+'" '+(h.nocl?'style="cursor: default"':"")+z+">\n                "+f+'\n                <div nosorthandle="1" class="page_media_x_wrap inl_bl" data-title="'+getLang("dont_attach")+'" aria-label="'+getLang("dont_attach")+'" role="button" onmouseover="showTitle(this)" onclick="cur.addMedia['+v.lnkId+"].unchooseMedia("+ke+'); return cancelEvent(event);">\n                  <div class="page_media_x" nosorthandle="1"></div>\n                </div>\n                '+w+"\n              </div>\n            </div>")}void 0!==i.upload_ind&&re("upload"+i.upload_ind+"_progress_wrap"),"postpone"!==t&&"mark_as_ads"!==t&&"copyright"!==t&&(v.chosenMedia=[t,o],v.chosenMedia[5]=i,v.chosenMediaData=i),v.singleAdded(ye,t)}"share"==t?!i.title||s||i.url?i.video?(cur.shareShowImg=0,v.bigLink=!0,v.showExternalPreview()):v.showExternalPreview():(cur.shareShowImg=0,v.showPreview(!0),v.shareData.images=!1):"page"==t?i.nopreview||(cur.shareShowImg=0,v.shareData=extend(v.shareData||{},i,{images:!1}),v.showPreview()):"poll"===t?v.pollCreate(i):t==r?x?v.postponeInd=ke:v.setupPostpone(i,Z):"mark_as_ads"==t?v.markAsAds=1:"pretty_cards"==t&&v.createPrettyCards(i),toggleClass(a,"media_preview_has_medias",v.hasVisibleRows()&&(isVisible(e)||!hasClass("signed","disabled"))),h.onChangedSize&&h.onChangedSize();var Me=window.event;return Me&&"click"==Me.type&&(Me.ctrlKey||Me.metaKey||Me.shiftKey)&&v.attachCount()+1<=b&&(d=!0),cur.fileApiUploadStarted&&void 0!==i.upload_ind||cur.preventBoxHideWithSharedBox||cur.preventBoxHide||!0===d||inArray(t,["poll","share","page","postpone","mark_as_ads","pretty_cards","copyright"])||boxQueue.hideLast(),cur.lastPostMsg=!1,h.onMediaAdd&&h.onMediaAdd(),getAudioPlayer().updateCurrentPlaying(),cur.onMediaChanged&&cur.onMediaChanged(v.chosenMedias),h.onMediaChanged&&h.onMediaChanged(),void 0!==i.upload_ind&&delete i.upload_ind,!1}function Se(e,a){return isString(e)?e=clean(unclean(unclean(e))):(isObject(e)||isArray(e))&&(e=Pe(e,a)),e}function Pe(e,a){if(!vk.widget)return e;if((a=positive(a))>5)return e;if(isArray(e))e.forEach(function(t,o){e[o]=Se(t,a+1)});else if(isObject(e))for(var t in e)e.hasOwnProperty(t)&&(e[t]=Se(e[t],a+1));return e}},unchooseMedia:function(t,o){if(v.onChange&&!1===v.onChange(!1,t))return!1;if(k){if(cur.checkURLDomainRequest&&cur.checkURLDomainRequest.abort(),clearTimeout(cur.showLoaderTimeout),clearInterval(cur.shareImgInterval),clearTimeout(cur.shareImgInterval2),clearTimeout(cur.imgLoadTimeout),clearTimeout(cur.checkURLDomainTO),void 0===t){if(window.ThumbsEdit&&ThumbsEdit.removeAll("thumbs_edit"+S),each(v.chosenMedias,function(e,a){!a||void 0===e||o&&!inArray(a[0],o)||v.unchooseMedia(e)}),v.urlsCancelled=[],h.onChangedSize){h.onChangedSize();var i=setInterval(h.onChangedSize,50);setTimeout(clearTimeout.bind(null,i),500)}return void(v.copyrightToggle&&v.copyrightToggle(!0))}var n=v.chosenMedias;if(n[t]){var r;switch("podcast"===n[t][0]&&(r=cur.editingPost&&!cur.editingPost[3].reply&&"wpe_media_preview"===gpeByClass("multi_media_preview",n[t][2]).id),n[t][2]?((w=geByClass1("page_media_x_wrap",n[t][2],"div"))&&w.tt&&w.tt.el&&w.tt.destroy(),domPN(n[t][2])==I&&I.sorter?(each(I.sorter.elems,function(){setStyle(this,{top:"auto",left:"auto",cursor:"auto"})}),I.sorter.destroy(),re(n[t][2]),I.childNodes.length>1&&sorter.init(I,{onReorder:h.onAddMediaChange})):domPN(n[t][2])==B&&B.qsorter?(each(B.qsorter.elems,function(){setStyle(domFC(this),{top:"auto",left:"auto"}),setStyle(this,{cursor:"auto"})}),B.qsorter.destroy(),re(n[t][2]),B.childNodes.length>1&&qsorter.init(B,v.qsorterOpts())):re(n[t][2])):"photo"!=n[t][0]&&"video"!=n[t][0]&&"album"!=n[t][0]||window.ThumbsEdit&&ThumbsEdit.removeById("thumbs_edit"+S,n[t][0]+n[t][1]),n[t][0]){case"page":case"share":v.shareData={},re(v.sharePreview),hide("medadd_c_linkimg_loader"),delete v.sharePreview,show(domByClass(M.menuNode,"_type_share")),show(e),(s=ge("signed"))&&disable(s,!isChecked("official")),show(domByClass(M.menuNode,"_type_market"));break;case"pretty_cards":var s;re(v.prettyCardGallery.el),delete v.prettyCardGallery,(s=ge("signed"))&&disable(s,!isChecked("official")),show(domByClass(M.menuNode,"_type_pretty_cards")),show(e);break;case"poll":re(v.pollPreview),delete v.pollPreview,show(domByClass(M.menuNode,"_type_poll"));break;case"map":show(domByClass(M.menuNode,"_type_map"));break;case"podcast":var d=!0;if(r)+cur.editingPost[0].split("_")[0]!==cur.oid&&(d=!1);else{var l=(c=ge("official"))&&gpeByClass("_submit_post_box",c);if(c&&l)domData(l,"from-oid")!==domData(l,"oid")&&(d=!1)}toggle(domByClass(M.menuNode,"_type_podcast"),d);break;case"market":case"wall":case"wall_reply":case"story":case"narrative":show(e);break;case"postpone":var c,_=geByClass1("medadd_c_timersett",v.postponePreview);cur.editingPost&&_&&!x?re(domFC(v.postponePreview)):(E.innerHTML="",v.postponeDatepicker=null,v.postponeDate=null),v.postponePreview=!1,(c=ge("official"))&&disable(c,!1);var p=h.poster,u="";if(cur.editingPost)if(cur.editingPost[6]&&intval(cur.editingPost[6].getAttribute("data-suggest"))){u=getLang("wall_publish_suggest");var g=ge("wpe_save");g&&(g.innerHTML=u)}else{u=getLang("wall_publish_now");var m=ge("wpe_save");m&&(m.innerHTML=u)}else u=getLang("wall_send"),ge("send_post").innerHTML=u;p&&p.changeBtnText(u),x?(removeClass(v.menu.postponeBtn,"on"),v.updatePostponeBtnText(!0)):show(domByClass(M.menuNode,"_type_postpone"));break;case"mark_as_ads":show(domByClass(M.menuNode,"_type_mark_as_ads")),v.markAsAds=!1;break;case"copyright":v.copyrightRemove()}n[t]=!1}if(h.toggleLnk){d=v.attachCount()<b;toggle(e,d),h.onToggleBlock&&h.onToggleBlock(d)}toggle(P,!!(y?geByClass1("thumb_wrap",P):domFC(P))),toggle(B,!!domFC(B)),toggle(I,!!domFC(I)),toggle(A,!!domFC(A)),toggle(T,!!domFC(T)),toggle(D,!!domFC(D)),toggle(L,!!domFC(L)),x||toggle(E,!!domFC(E)),toggle(N,!!domFC(N))}else{var f,w;if(void 0==t&&(t=0),(w=geByClass("page_media_x_wrap",a,"div")[t])&&w.tt&&w.tt.el&&w.tt.destroy(),1==t&&v.postponePreview)if(x)E.innerHTML="",v.postponeDatepicker=null,v.postponeDate=null,removeClass(v.menu.postponeBtn,"on"),v.updatePostponeBtnText(!0);else{show(geByClass1("add_media_type_"+S+"_postpone",M.menuNode,"a"));var C=domPN(v.postponePreview);window.tooltips&&tooltips.destroyAll(C),re(C),v.postponePreview=!1;var U=M.lastTypes;each(M.types,function(e,a){"postpone"===a[0]&&U.push(a)}),M.setItems(U)}else if(2==t&&v.markAsAds){v.markAsAds=!1;var z=geByClass1("page_preview_mark_as_ads_wrap",a);window.tooltips&&z&&tooltips.destroyAll(z),re(z);U=M.lastTypes;each(M.types,function(e,a){"mark_as_ads"===a[0]&&U.push(a)}),M.setItems(U)}else if(3===t)v.copyrightRemove();else{if(v.postponePreview||v.markAsAds){C=v.postponePreview&&domPN(v.postponePreview),z=v.markAsAds&&domPN(geByClass1("page_preview_mark_as_ads_wrap",a));for(var q=[],O=0;O<a.childNodes.length;O++){var F=a.childNodes[O];"DIV"==F.nodeName&&F!=C&&F!=z&&q.push(F)}each(q,function(e,a){re(a)});U=[];each(M.types,function(e,a){"postpone"===a[0]&&v.postponePreview||"mark_as_ads"===a[0]&&v.markAsAds||U.push(a)}),M.setItems(U)}else val(a,""),addClass(a,"med_no_attach"),M.setItems(M.types);v.chosenMedia&&(v.chosenMedia=!1,v.chosenMediaData=!1),(f=v.shareData)&&(f.url&&v.urlsCancelled.push(f.url),f.initialPattern&&v.urlsCancelled.push(f.initialPattern),v.shareData={}),each([v.sharePreview,v.pollPreview],function(){re(this)}),v.sharePreview=v.pollPreview=!1}h.toggleLnk&&show(e)}if(toggleClass(a,"media_preview_has_medias",v.hasVisibleRows()&&(hasClass(a,"reply_media_preview")||isVisible(e)||!hasClass("signed","disabled"))),v.copyrightToggle&&v.copyrightToggle(!0),cur.onMediaChanged&&cur.onMediaChanged(n),h.onMediaChanged&&h.onMediaChanged(),cur.lastPostMsg=!1,v.onChange&&v.onChange(!1),h.onChangedSize){h.onChangedSize();i=setInterval(h.onChangedSize,50);setTimeout(clearTimeout.bind(null,i),500)}},singleAdded:function(t,o){if("copyright"!==o){if(o===r){if(x)return;a.appendChild(t)}else"mark_as_ads"===o?v.postponePreview?a.insertBefore(t,domLC(a)):a.appendChild(t):domFC(a)?a.insertBefore(t,domFC(a)):a.appendChild(t);removeClass(a,"med_no_attach");var i=[];each(M.lastTypes,function(e,a){("postpone"!==a[0]||!v.postponePreview&&"postpone"!==o)&&("mark_as_ads"!==a[0]||!v.markAsAds&&"mark_as_ads"!==o)&&(inArray(o,["postpone","mark_as_ads"])||inArray(a[0],["postpone","mark_as_ads"]))&&i.push(a)}),M.setItems(i),h.toggleLnk&&!i.length&&hide(e)}},getMedias:function(e){if(k){var a=window.ThumbsEdit?ThumbsEdit.getMedias("thumbs_edit"+S):[],t={},o=v.chosenMedias||[],i=[],n=function(e,a,o){if(o[0]+o[1]==e)return i.push(o),t[e]=!0,!1};return each(a,function(e,a){each(o,n.pbind(a[0]+a[1]))}),each(B.childNodes,function(e,a){var t=(a.id||"").match(/^pam\d+_([a-z]+)(-?\d+_\d+)/);t&&each(o,n.pbind(t[1]+t[2]))}),each(I.childNodes,function(e,a){var t=(a.id||"").match(/^pam\d+_([a-z]+)(-?\d+_\d+)/);t&&each(o,n.pbind(t[1]+t[2]))}),each(o,function(e,a){a&&isArray(a)&&a.length&&!t[a[0]+a[1]]&&i.push(a)}),i}return(o=v.chosenMedia)?[e?o:o[0]+o[1]]:[]},showPhoto:function(e){function a(a,t,o,i){return e.apply(this,arguments)}return a.toString=function(){return e.toString()},a}(function(e,a,t,o){for(var i in!cur.pvData||cur.pvShown&&cur.pvListId==a||delete cur.pvData[a],ajaxCache)i.toString().match(/^\/al_photos\.php\#act=show&draft_photos/)&&delete ajaxCache[i];var n=v.getMedias(),r=[];return each(n,function(e,a){a&&"photo"==a[0]&&r.push(a[1]+"/"+(v.phLists[a[1]]||""))}),t.additional={},t.additional.open_pe=intval(cur.openEditor),cur.openEditor||(t.additional.draft_photos=r.join(";")),delete cur.openEditor,showPhoto(e,a,extend(t,{queue:1}),o)}),showMediaProgress:function(a,t,o){if(v.onProgress&&!1===v.onProgress(a,t,o))return!1;var i=o.loaded/o.total,n=intval(100*i),r=(o.fileName||o.name||"").replace(/[&<>"']/g,""),s=r?t+"_"+r:t,d=r?r.length>33?r.substr(0,30)+"...":r:"",l=ge("upload"+s+"_progress");if(l){show(l);u=geByClass1("ui_progress_bar",l);setStyle(u,{width:n+"%"})}else{cur.attachMediaIndexes||(cur.attachMediaIndexes={}),cur.attachMediaIndexes[s]=S;var c='\n          <div class="fl_l">\n            <div class="page_attach_progress_wrap" style="margin-top: 3px; margin-bottom: 4px;">\n              <div id="upload'+s+'_progress" class="page_attach_progress ui_progress">\n                <div class="ui_progress_back"></div>\n                <div class="ui_progress_bar"></div>\n              </div>\n            </div>\n          </div>\n          '+(d?'<div class="attach_label fl_l">'+d+"</div>":"")+'\n          <div class="progress_x fl_l" onmouseover="animate(this, {opacity: 1}, 200);showTooltip(this, {text: \''+getLang("dont_attach")+'\', shift: [16, 8, 8], black: 1})" onmouseout="animate(this, {opacity: 0.6}, 200);" onclick="Upload.terminateUpload('+t+", '"+(r||t)+"', this);\"></div>\n          ";if(k){if(N.appendChild(ce("div",{id:"upload"+s+"_progress_wrap",innerHTML:c,className:"clear_fix upload_"+t+"_progress"},{marginTop:"6px"})),show(N),h.toggleLnk){var _=v.attachCount()<b;toggle(e,_),h.onToggleBlock&&h.onToggleBlock(_)}}else{var p=ce("div",{id:"upload"+s+"_progress_wrap",innerHTML:c,className:"clear_fix upload_"+t+"_progress"});v.chosenMedia="progress",v.singleAdded(p,"progress")}h.onChangedSize&&h.onChangedSize(),l=ge("upload"+s+"_progress");var u=geByClass1("ui_progress_bar",l);n?setStyle(u,{width:n+"%"}):(setStyle(u,{width:"1px"}),hide(l))}},hasVisibleRows:function(){var e=!1;return each(geByClass("media_preview",a),function(){if(isVisible(this))return e=!0,!1}),e},attachCount:function(){if(v.attachedCount)return v.attachedCount();if(!a)return 0;if(!k)return a.childNodes.length-(v.postponePreview?1:0)-(v.markAsAds?1:0);var e=(y&&window.ThumbsEdit?(ThumbsEdit.cache()["thumbs_edit"+S]||{}).previews||[]:P.childNodes).length+B.childNodes.length+L.childNodes.length+I.childNodes.length/(I.sorter?2:1)+N.childNodes.length;return v.sharePreview&&++e,v.pollPreview&&++e,e},pollCreate:function(e){var a=e.poll_html;if(cur.addMedia[S].pollInputData=e,A)if(a){var t='<div class="medadd_c" id="poll_dummy'+S+'">'+a+"</div>";v.pollPreview=A.appendChild(domFC(cf(t)))}else stManager.add(["ui_controls.css","ui_controls.js","datepicker.css","datepicker.js"],function(){var a=e.poll_question_length,t=e.question,o=e.lang,i=e[s],r=e.answers,g=e[d],m=e[l],f=e[c],w=e[_],b=e[p],k=e[u],y=e.poll_is_board,C=e.poll_is_edit,x=e.poll_is_not_posted,M=e.poll_backgrounds,P=e.poll_answers_limit||10,B='\n          <div class="medadd_h medadd_h_poll inl_bl">\n            '+o.question+'\n            <span class="medadd_poll_question_warning"></span>\n          </div>\n          <input onkeydown="cur.addMedia[%lnkid%].pollKeydown(this, event)" oninput="cur.addMedia[%lnkid%].pollChangeQuestion(this)" maxlength="'+a+'" onkeyup="cur.addMedia[%lnkid%].pollKeyup(this, event)" class="text dark medadd_poll_question'+(y&&C?" disabled":"")+'"'+(y&&C?' readonly="readonly"':"")+' id="create_poll_question%lnkid%" value="%question%" />\n          <div class="medadd_h">'+o.answers+'</div>\n          <div class="medadd_poll_answers" id="create_poll_answers%lnkid%">\n            %answers%\n          </div>\n          '+(y&&C?"":'<div class="medadd_poll_answer_add_wrap" id="create_poll_add%lnkid%">\n            <div class="medadd_poll_answer_add fakeinput dark" onclick="cur.addMedia[%lnkid%].pollAnswerAdd()">'+o.answer_add+"</div>\n          </div>")+'\n          %backgrounds%\n          %settings%\n          <div class="checkbox medadd_datepicker_checkbox medadd_poll_cb%classuntil%" id="create_poll_until%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">'+o.until+'</div>\n          <div class="medadd_datepicker">\n            <input type="text" class="medadd_datepicker_date dark" id="create_poll_untildate%lnkid%"/><div class="medadd_datepicker_at datepicker_at">'+o.at+'</div><input type="text" class="medadd_datepicker_time dark" id="create_poll_untiltime%lnkid%"/>\n          </div>\n          '+(y?'\n          <div class="checkbox medadd_poll_cb%classonmain%" id="create_poll_onmain%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">'+o.add_to_main+"</div>\n          ":"")+"\n          "+(y&&C?'\n          <div class="checkbox medadd_poll_cb%classclosed%" id="create_poll_closed%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">'+o.close+"</div>\n          ":"")+"\n        ",I='\n          <div class="medadd_h">'+o.settings+"</div>\n          "+(C&&!x||y?"":'<div class="checkbox medadd_poll_cb%classanon%" id="create_poll_anonymous%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">'+o.anonymous+"</div>")+"\n          "+(C?"":'<div class="checkbox medadd_poll_cb%classmulty%" id="create_poll_multy%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">'+o.multy+"</div>")+"\n        ",T='\n          <div class="medadd_poll_answer_wrap">\n            <input onkeydown="cur.addMedia[%lnkid%].pollKeydown(this, event)" onkeyup="cur.addMedia[%lnkid%].pollKeyup(this, event)" class="text dark medadd_poll_answer'+(y&&C?" disabled":"")+'"'+(y&&C?' readonly="readonly"':"")+' %attrs%/>\n            <div class="page_media_x_wrap medadd_poll_answer_remove" data-title="'+o.answer_remove+'" aria-label="'+o.answer_remove+'" role="button" onmouseover="showTitle(this)" onclick="cur.addMedia[%lnkid%].pollAnswerRemove(this)">\n              <div class="page_media_x"></div>\n            </div>\n          </div>\n        ',D='\n          <div class="medadd_h">'+o.background+'</div>\n          <div class="medadd_poll_backgrounds_wrap" id="create_poll_backgrounds_wrap%lnkid%">\n            <div class="medadd_poll_backgrounds_arrow_prev" onclick="cur.addMedia[%lnkid%].pollBackgroundsPaging(\'prev\')"></div>\n            <div class="medadd_poll_backgrounds_arrow_next" onclick="cur.addMedia[%lnkid%].pollBackgroundsPaging(\'next\')"></div>\n            <div class="medadd_poll_backgrounds" id="create_poll_backgrounds%lnkid%">\n              %backgrounds%\n            </div>\n          </div>\n        ';cur.addMedia[S].answersLimit=P,cur.addMedia[S].tplAnswer=T;var L="";y||(L+=cur.addMedia[S].pollBackgroundGetHtml(),M&&M.forEach(function(e){L+=cur.addMedia[S].pollBackgroundGetHtml(e)}),L+=rs('\n          <div class="medadd_poll_background medadd_poll_background_uploader" onclick="cur.addMedia[%lnkid%].pollBackgroundUpload(this);">\n            <div class="medadd_poll_background_preview"></div>\n          </div>\n        ',{lnkid:S}),L=rs(D,{lnkid:S,backgrounds:L}));var E="";if(!r||isArray(r)&&!r.length){var N=[];for(var U in e)if(e.hasOwnProperty(U)){var z="answers".length+1;if("answers["===U.substr(0,z)){var q=intval(U.slice(z,-1));N.push([q,e[U]])}}N.length?(r=[],N.sort(function(e,a){return e[0]<0&&a[0]<0?e[0]<a[0]:e[0]>=0&&a[0]>=0?e[0]>a[0]:a[0]<0}).forEach(function(e){r.push([e[0]<0?e[0]:0,e[1]])})):r=[[0,""],[0,""]]}r.forEach(function(e,a){var t=n(e,2),o=t[0],i=t[1];E+=rs(T,{attrs:(o?' id="create_poll_ans'+o+'"':"")+(i?' value="'+clean(unclean(i))+'"':""),lnkid:S})}),v.pollPreview=A.appendChild(ce("div",{className:"medadd_c medadd_poll",innerHTML:rs(B,{lnkid:S,question:t?clean(unclean(t)):"",classuntil:b?" on":"",settings:rs(I,{lnkid:S,classanon:i?" on":"",classmulty:k?" on":""}),backgrounds:L,answers:E,classonmain:g?" on":"",classclosed:m?" on":""})})),r.length==P&&hide("create_poll_add"+S);var O="create_poll_untildate"+S,F=new Datepicker(O,{time:"create_poll_untiltime"+S,width:157,noPast:!0,activePeriod:2592e6,minStep:1,date:b||Math.round(((new Date).getTime()+864e5)/1e3),onUpdate:function(){var e=new Date,a=new Date(1e3*positive(val(O)));a.getTime()>=e.getTime()+2592e6&&(F.timePicker.hourDD.val(e.getHours()),a.getMinutes()>e.getMinutes()&&F.timePicker.minDD.val(e.getMinutes()),F.setDate(a.getFullYear(),a.getMonth()+1,a.getDate(),!0,e.getHours(),e.getMinutes())),cur.addMedia[S].pollChanged()}});if(cur.addMedia[S].pollBackgroundsPos=0,cur.addMedia[S].pollBackgroundSelect(w?-w:intval(f)),cur.addMedia[S].pollChangeQuestion(ge("create_poll_question"+S)),t)elfocus("create_poll_question"+S),h.onChangedSize&&h.onChangedSize(),cur.addMedia[S].pollUpdateArrows();else{v.pollPreview.style.position="absolute",v.pollPreview.style.visibility="hidden";var R=v.pollPreview.offsetHeight;v.pollPreview.style.height=0,v.pollPreview.style.position="",v.pollPreview.style.visibility="",animate(v.pollPreview,{height:R},h.mail?0:200,function(){v.pollPreview.style.height="",elfocus("create_poll_question"+S),h.onChangedSize&&h.onChangedSize(),cur.addMedia[S].pollUpdateArrows()})}var j=ge("create_poll_backgrounds_wrap"+S);function H(){addEvent(j,browserFeatures.wheelEvent,cur.addMedia[S].pollMouseWheel)}function W(){removeEvent(j,browserFeatures.wheelEvent,cur.addMedia[S].pollMouseWheel)}addEvent(j,"mouseenter",H),addEvent(j,"mouseleave",W),cur.destroy.push(function(){removeEvent(j,browserFeatures.wheelEvent,cur.addMedia[S].pollMouseWheel),removeEvent(j,"mouseenter",H),removeEvent(j,"mouseleave",W)})})},pollMouseWheel:function(e){cancelEvent(e);var a=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX;cur.addMedia[S].pollBackgroundsPaging(a,!0)},pollBackgroundsPaging:function(e,a){var t=ge("create_poll_backgrounds_wrap"+S),o=ge("create_poll_backgrounds"+S),i=t.offsetWidth,n=cur.addMedia[S].pollBackgroundsPos;isNumeric(e)?n+=e:"next"===e?n+=i:n-=i,cur.addMedia[S].pollBackgroundsPos=Math.max(0,Math.min(n,o.scrollWidth-i)),a?removeClass(o,"animated"):addClass(o,"animated"),setStyle(o,"transform","translateX("+cur.addMedia[S].pollBackgroundsPos*(vk.rtl?1:-1)+"px)"),cur.addMedia[S].pollUpdateArrows()},pollUpdateArrows:function(){var e=ge("create_poll_backgrounds_wrap"+S),a=ge("create_poll_backgrounds"+S);if(e){var t=e.offsetWidth,o=a.scrollWidth-t;toggleClass(e,"medadd_poll_backgrounds_arrow_prev_disabled",0===cur.addMedia[S].pollBackgroundsPos),toggleClass(e,"medadd_poll_backgrounds_arrow_next_disabled",cur.addMedia[S].pollBackgroundsPos===o||o<=0)}},pollUntilGet:function(){var e=isChecked("create_poll_until"+S)?positive(val("create_poll_untildate"+S)):0;return Math.min(e,(new Date).getTime()+2592e6)},pollBackgroundChange:function(e,a){var t=gpeByClass("medadd_poll_backgrounds",e),o=geByClass1("medadd_poll_background_radio",e);geByClass("medadd_poll_background_radio",t).forEach(function(e){checkbox(e,e===o)}),cur.addMedia[S].pollChanged()},pollAnswerAdd:function(){var e=ge("create_poll_answers"+S),a=geByClass("medadd_poll_answer_wrap",e).length,t=cur.addMedia[S].answersLimit;if(a<t){var o=cf(rs(cur.addMedia[S].tplAnswer,{lnkid:S}));e.appendChild(o);var i=geByClass("medadd_poll_answer",e).pop();elfocus(i)}h.onChangedSize&&h.onChangedSize(),toggle("create_poll_add"+S,a<t-1)},pollAnswerRemove:function(e){e.tt&&e.tt.el&&e.tt.destroy(),re(domPN(e)),h.onChangedSize&&h.onChangedSize(),cur.addMedia[S].pollChanged(),show("create_poll_add"+S)},pollKeydown:function(e,a){if((a=a||window.event)&&(10==a.keyCode||a.keyCode==KEY.ENTER||a.keyCode==KEY.TAB)){var t=hasClass(e,"medadd_poll_question"),o=a.shiftKey;if(t&&o)return;var i=t?domFC(domNS(domNS(e))):(o?domPS:domNS)(domPN(e));return i?elfocus(geByTag1("input",i)):o?elfocus(geByClass1("medadd_poll_question",domPN(domPN(domPN(e))))):this.pollAnswerAdd(),cancelEvent(a)}},pollKeyup:function(e,a){(!(a=a||window.event)||10!=a.keyCode&&a.keyCode!=KEY.ENTER&&a.keyCode!=KEY.TAB)&&(cur.addMedia[S].pollChangedTimeout&&clearTimeout(cur.addMedia[S].pollChangedTimeout),cur.addMedia[S].pollChangedTimeout=setTimeout(function(){return cur.addMedia[S].pollChanged()},100))},pollBackgroundGetHtml:function(e){var a="",t=n(e||[0],1)[0];if(t<0){var o=n(e,5),i=o[1],r=o[2],s=o[3],d=o[4];a='\n          <div class="medadd_poll_background" onclick="cur.addMedia['+S+'].pollBackgroundChange(this);">\n            <div class="medadd_poll_background_preview">\n              <div class="medadd_poll_background_preview_lines1"></div>\n              <div class="medadd_poll_background_preview_lines2"></div>\n              <div class="medadd_poll_background_photo" style="background: rgb('+r+", "+s+", "+d+');">\n                <div class="medadd_poll_background_photo_holder">\n                  <div class="medadd_poll_background_photo_gradient" style="background: linear-gradient(0, rgba('+r+", "+s+", "+d+", 1) 0, rgba("+r+", "+s+", "+d+', 0) 50%)"></div>\n                  <img src="'+i+'" class="medadd_poll_background_photo_img"/>\n                </div>\n              </div>\n            </div>\n            <div class="medadd_poll_background_radio radiobtn" data-id="'+t+'" data-photo-r="'+r+'" data-photo-g="'+s+'" data-photo-b="'+d+'" data-photo-url="'+i+'"></div>\n          </div>\n        '}else{var l="",c="";if(t){var _=n(e,2)[1];if("gradient"===_){var p=n(e,4),u=p[2],h=[];p[3].forEach(function(e){var a=n(e,2),t=a[0],o=a[1];h.push("#"+o+" "+Math.round(100*t)+"%")}),l="background: linear-gradient("+(u-90)+"deg, "+h.join(",")+');"'}else if("tile"===_){var g=n(e,5),m=g[2],v=g[3];l="background: url("+g[4]+") top center;background-size: "+m+"px "+v+'px;"'}}else c=" medadd_poll_background_default";a='\n          <div class="medadd_poll_background'+c+'" onclick="cur.addMedia['+S+'].pollBackgroundChange(this);">\n            <div class="medadd_poll_background_preview"'+(l?' style="'+l+'"':"")+'>\n              <div class="medadd_poll_background_preview_lines1"></div>\n              <div class="medadd_poll_background_preview_lines2"></div>\n            </div>\n            <div class="medadd_poll_background_radio radiobtn" data-id="'+t+'"></div>\n          </div>\n        '}return a},pollBackgroundAdd:function(e){var a=ge("create_poll_backgrounds"+S),t=geByClass1("medadd_poll_background_uploader",a),o=cf(cur.addMedia[S].pollBackgroundGetHtml(e));o=domFC(o),a.insertBefore(o,t)},pollBackgroundSelect:function(e){var a=ge("create_poll_backgrounds"+S);if(a){var t=domQuery1('.radiobtn[data-id="'+e+'"]',a)||domQuery1('.radiobtn[data-id="0"]',a);if(t){var o=domPN(t);cur.addMedia[S].pollBackgroundsPos=(o.offsetLeft-a.offsetWidth/2+o.offsetWidth/2)*(vk.rtl?-1:1),cur.addMedia[S].pollBackgroundsPaging(0,!0),cur.addMedia[S].pollBackgroundChange(o)}}},pollBackgroundGet:function(){var e=domQuery1("#create_poll_backgrounds"+S+" .radiobtn.on");return intval(domData(e,"id"))},pollBackgroundUploaded:function(e,a,t){var o=-intval(e);cur.addMedia[S].pollBackgroundAdd([o,clean(a),intval(t.r),intval(t.g),intval(t.b)]),cur.addMedia[S].pollBackgroundSelect(o)},pollBackgroundUpload:function(){var e=cur.addMedia[S].pollInputData;showBox("al_page.php",{act:"owner_photo_box",oid:e&&e.poll_owner_id||(h.mail?cur.gid?-cur.gid:vk.id:cur.oid||vk.id),lnk_id:S,is_voting:1},{stat:["owner_photo.css","owner_photo.js"]})},pollChanged:function(){h.onMediaChange&&h.onMediaChange()},pollBackgroundsGet:function(){var e=cur.addMedia[S].pollInputData,a=[];e&&e.poll_backgrounds&&e.poll_backgrounds.forEach(function(e){n(e,1)[0]>0&&a.push(e)});var t=ge("create_poll_backgrounds"+S);return geByClass("radiobtn",t).forEach(function(e){var t=intval(domData(e,"id"));t&&t<0&&a.push([t,domData(e,"photo-url"),intval(domData(e,"photo-r")),intval(domData(e,"photo-g")),intval(domData(e,"photo-b"))])}),a},pollData:function(e,a){var t=cur.addMedia[S],o={};if(t&&ge("create_poll_question"+S)){for(var i=ge("create_poll_answers"+S),r=!1,g=0,m=domFC(i);m;m=domNS(m)){var v=trim(val(domFC(m)));if(v){var f=-intval((domFC(m).id.match(/^create_poll_ans(\d+)$/)||[0,-g++])[1]);o["answers["+f+"]"]=v,r=!0}}if(!r)return domFC(i)||t.pollAnswerAdd(),!0!==e&&notaBene(domFC(domFC(i))),!1;var w=trim(val("create_poll_question"+S));if(!w)return!0!==e&&notaBene("create_poll_question"+S),!1;o.question=w,o[p]=t.pollUntilGet();var b=t.pollBackgroundGet();if(b<0?(o[_]=-b,o[c]=0):b>=0&&(o[_]=0,o[c]=b),o[s]=isChecked("create_poll_anonymous"+S)?1:0,o[d]=isChecked("create_poll_onmain"+S)?1:0,o[l]=isChecked("create_poll_closed"+S)?1:0,o[u]=isChecked("create_poll_multy"+S)?1:0,t.pollInputData&&a){o.poll_backgrounds=t.pollBackgroundsGet();var k=["poll_is_board","poll_is_edit","poll_id","poll_answers_limit"];h.mail&&k.push("lang"),k.forEach(function(e){t.pollInputData[e]&&(o[e]=t.pollInputData[e])}),h.mail&&(o.poll_is_edited=0,o["answers[0]"]||o.question!=t.pollInputData.question?o.poll_is_edited=1:[s,d,l,u,p,_,c].forEach(function(e){intval(o[e])!==intval(t.pollInputData[e])&&(o.poll_is_edited=1)}),o.poll_is_edited||t.pollInputData.answers.forEach(function(e){var a=n(e,2),t=a[0],i=a[1];void 0!==o["answers["+-t+"]"]&&o["answers["+-t+"]"]==i||(o.poll_is_edited=1)}))}}else t&&ge("poll_dummy"+S)&&t.pollInputData&&t.pollInputData.poll_id&&(o.poll_id=t.pollInputData.poll_id);return o},pollChangeQuestion:function(e){var a=cur.addMedia[S].pollInputData,t=a.poll_question_length-e.value.length,o=geByClass1("medadd_poll_question_warning");o.innerHTML=t<=20?langNumeric(t,a.lang.question_length):""},markAsAdsInit:function(){var e=this.markAsAdsGetCheckboxEl();e&&attr(e,"onclick","cur.addMedia["+this.lnkId+"].markAsAdsChanged();")},markAsAdsGetCheckboxEl:function(){return!!g&&g.querySelector(".Post__markAsAdsButton")},markAsAdsData:function(e){var a=!!e&&{},t=this.markAsAds||isChecked(this.markAsAdsGetCheckboxEl());return!t&&this.chosenMedias&&(t=this.chosenMedias.some(function(e){if(isArray(e)&&"mark_as_ads"===n(e,1)[0])return!0})),(t||e)&&(a={mark_as_ads:t?1:0}),a},markAsAdsChanged:function(){var e=this.markAsAdsGetCheckboxEl();if(e){checkbox(e),Wall&&Wall.togglePostMarkAsAds(e,e.dataset.muteId);var a=this.markAsAdsData(!0).mark_as_ads;v.copyrightToggle&&v.copyrightToggle(!a),h.onMediaChange&&h.onMediaChange()}},copyrightInit:function(){var e=this.copyrightGetBtnEl();e&&attr(e,"onclick","cur.addMedia["+this.lnkId+"].copyrightShowBox();"),this.markAsAdsData(!0).mark_as_ads&&this.copyrightToggle(!1)},copyrightToggle:function(e){var a=document.querySelector("#post_copyright_btn"+this.lnkId);toggle(a,e);var t=this.copyrightGetBtnEl();t&&(e?(this.copyrightData(!0).copyright?(val(t,getLang("wall_post_copyright_edit_button")),t.classList.add("Post__copyrightButton--added")):(val(t,getLang("wall_post_copyright_add_button")),t.classList.remove("Post__copyrightButton--added")),t.classList.remove("Post__copyrightButton--disabled")):(val(t,getLang("wall_post_copyright_add_button")),t.classList.remove("Post__copyrightButton--added"),t.classList.add("Post__copyrightButton--disabled")))},copyrightGetBtnEl:function(){return!!g&&g.querySelector(".Post__copyrightButton")},copyrightCreate:function(e){if(this.copyrightInputData=e,m&&e&&e.copyright){var a="post_copyright_btn"+this.lnkId,t=document.querySelector("#"+a);if(!t){var o=getLang("wall_post_copyright_source_text");t=cf('<div class="post_action_btn on" id="'+a+'" onclick="cur.addMedia['+this.lnkId+'].copyrightShowBox();">\n              <div class="post_action_btn_layout">\n                <span class="post_action_btn_text" role="button" aria-label="'+replaceEntities(o)+'">'+o+"</span>\n              </div>\n             </div>"),m.appendChild(t)}}this.copyrightChanged()},copyrightRemove:function(){var e=document.querySelector("#post_copyright_btn"+this.lnkId);e&&e.parentNode.removeChild(e),this.copyrightInputData&&(this.copyrightInputData.copyright=""),this.copyrightChanged()},copyrightUnchoose:function(){var e=this;this.chosenMedias&&this.chosenMedias.forEach(function(a,t){isArray(a)&&"copyright"===a[0]&&e.unchooseMedia(t)}),this.multi||this.copyrightRemove()},copyrightBoxAccept:function(e){var a=this,t=e.btns.ok[0],o=document.querySelector(".PostCopyrightBox__input"),i=document.querySelector(".PostCopyrightBox__error");if(hide(i),!buttonLocked(t)){var n=val(o);if(!n)return notaBene(o);ajax.post("al_wall.php",{act:"copyright_check_link",link:n},{onDone:function(){a.copyrightInputData||(a.copyrightInputData={}),a.copyrightInputData.copyright=n,a.chooseMedia("copyright","",a.copyrightInputData),e.hide()},onFail:function(e){return val(i,e),show(i),!0},showProgress:function(){return lockButton(t)},hideProgress:function(){return unlockButton(t)}})}},copyrightBoxDecline:function(e,a){a&&this.copyrightUnchoose(),e.hide()},copyrightShowBox:function(){var e=this;showBox("al_wall.php",{act:"copyright_box"},{cache:!0,onDone:function(a){cur.postCopyrightFeatureTT&&cur.postCopyrightFeatureTT.hide();var t=e.copyrightData(!0);a.removeButtons(),t.copyright?(a.setOptions({width:400,title:getLang("wall_post_copyright_mb_title_text_edit")}),a.setButtons(getLang("wall_post_copyright_edit_button"),function(){return e.copyrightBoxAccept(a)},getLang("global_cancel"),function(){return e.copyrightBoxDecline(a)}),a.setControlsText('<a onclick="cur.addMedia['+e.lnkId+'].copyrightBoxDecline(curBox(), true);">'+getLang("global_delete")+"</a>")):(a.setOptions({width:400,title:getLang("wall_post_copyright_mb_title_text")}),a.setButtons(getLang("wall_post_copyright_add_button"),function(){return e.copyrightBoxAccept(a)},getLang("global_cancel"),function(){return e.copyrightBoxDecline(a)}),a.setControlsText("")),a.show();var o=document.querySelector(".PostCopyrightBox__input");val(o,t.copyright||""),addEvent(o,"keypress",function(t){return Object(i.d)(function(){e.copyrightBoxAccept(a)},t)}),o.focus()}})},copyrightChanged:function(){var e=this.markAsAdsData(!0).mark_as_ads;this.copyrightToggle(!e),h.onMediaChange&&h.onMediaChange()},copyrightData:function(e){var a=!!e&&{};return(this.copyrightInputData&&this.copyrightInputData.copyright||e)&&(a={copyright:this.copyrightInputData&&this.copyrightInputData.copyright||""}),a},urlsCancelled:[],shareData:{},checkMessageURLs:function(e,a,t){if(!(cur.noCheckMessageURLs||v.chosenMedia||v.urlAttachmentLoading&&v.urlAttachmentLoading[0]>vkNow()-1e4||v.attachCount()>=b)){if(cur.checkMessageHandler&&isFunction(cur.checkMessageHandler)&&cur.checkMessageHandler(e),cur.reply_to&&cur.reply_to[0]){var o=Wall.getReplyName(cur.reply_to[0]);if(o=o&&isArray(o)&&o[1]?o[1]:""){var i=extractUrls(o,a);for(var n in i)if(i.hasOwnProperty(n)){var r=i[n].url;r.match(/^https?:\/\//)||(r="http://"+r),inArray(r,v.urlsCancelled)||v.urlsCancelled.push(r)}}}var s=extractUrls(e,a).map(function(e){var a=e.url,t=e.query,o=e.domain,i=a,n={};a.match(/^https?:\/\//)||(a="http://"+a);var r=inArray(a,v.urlsCancelled)||inArray(i,v.urlsCancelled),s=!0,d=!1;if(!r&&o.match(/(^|\.|\/\/)(vkontakte\.ru|vk\.com)/i)){s=!!t.match(/(#photo|^\/(photo|video|album|page|audio|doc|mask|poll|podcast)|z=(album|photo|video|audio_playlist|podcast)|w=(page|product|poll))(-?\d+_)?\d+|app\d+(?:_-\d+)?|\.(jpg|png|gif)$|artist\/([^\/]+).*$|market-?\d+\?section=album_\d+|^\/stickers\/.+$|\?w\=story(\d+)_(\d+)$|stor(y|ies)(\d+)_(\d+)$|^(\/dev)?\/(blog|press)\/.+$|^\/jobs\?w=job\d+$|^\/landings\/.+$|\?w\=vk10\_years(\d+)$|^\/messenger$|^\/bestgames2016$|^\/bestgames2017$|^\/services$|^\/vk_apps_contest$|^\/data_protection(\?section=(rules|requests|principles))?$|^\/safety(\?section=(social|parents|youth|tips))?$|^\/ads(\/([a-zA-Z0-9\_]+))?$|^http:\/\/instagram\.com\/p\/.+/),t.match(/narrative(-?\d+_\d+)/)&&(s=!0);var l=t.match(/^(\/@[._a-zA-Z0-9-]+)([\?|\&]rev=[_a-z0-9]+|[\?|\&]anchor=[-a-zа-я0-9]+)*$/);l&&(i="vk.com"+l[1],delete(n=nav.fromStr(a))[0],s=!0),!s&&t.match(/[a-zA-Z0-9_\.-]{2,32}/)&&(s=!0,d=!0)}return e.url=a,e.canceled=r,e.valid=s,e.initialUrl=i,e.params=n,e.needsCheckDomain=d,e}).filter(function(e){return!e.canceled&&e.valid}).sort(function(e,a){return e.needsCheckDomain-a.needsCheckDomain});if(s.length){var d=s[0];d.needsCheckDomain?v.checkURLDomain(d.query,d.initialUrl,t):v.checkURL(d.initialUrl,t,d.params)}}},checkURLDomain:function(e,a,t){cur.checkURLDomainTO&&clearTimeout(cur.checkURLDomainTO),cur.checkURLDomainTO=setTimeout(function(e,a,t){cur.checkURLDomainRequest=ajax.post("apps",{act:"a_aid_by_link",url:e},{onDone:function(e,o){e&&!o&&v.checkURL(a,t)},onFail:function(){return!0}})}.pbind(e,a,t),100)},clearCheckURL:function(){clearTimeout(cur.checkURLTO),re(v.urlAttachmentLoading[2]),k?toggle(N,N.childNodes>0):toggleClass(a,"med_no_attach",!a.childNodes),v.urlAttachmentLoading=!1,setStyle(bodyNode,{cursor:"default"})},onCheckURLDone:function(e,a,t){var o="";a=a||{},v.urlAttachmentLoading&&(o=v.urlAttachmentLoading[1],v.clearCheckURL()),e?v.chooseMedia(t[0],t[1],extend({},t[2],a),o,!0):((h.onCheckURLDone||function(){})(e,t),(a.onError||function(){})(t))},cancelCheckUrl:function(){re(v.checkURLForm)},_getShareTimeHash:function(){var e=cur.share_timehash||((cur.options||{}).share||{}).timehash||"",a=Math.floor(Date.now()/1e3),t=-1;return e&&(t=parseInt(e.split("_",1)[0])+36e3),t-a<60?Object(o.b)("share.php?act=renew_url_attachment_hash",{act:"renew_url_attachment_hash",hash:e}).then(function(e){var a=e[0];return cur.share_timehash=a,a}):Promise.resolve(e)},checkURL:function(e,a){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e?this._getShareTimeHash().then(function(i){v.urlsCancelled.push(e),v.urlAttachmentLoading=[vkNow(),e],re(v.checkURLForm),v.checkURLForm=ce("div",{innerHTML:'<iframe name="share_parse_iframe'+S+'"></iframe>'}),utilsNode.appendChild(v.checkURLForm);var n=v.checkURLForm.appendChild(ce("form",{action:"share.php?act=url_attachment",method:"post",target:"share_parse_iframe"+S}));each(extend({hash:i,allowed_share_buttons:((cur.options||{}).share||{}).allowed_buttons||"",index:S,url:e,to_mail:h.mail?1:""},t),function(e,a){n.appendChild(ce("input",{type:"hidden",name:e,value:a}))}),setStyle(bodyNode,{cursor:"wait"}),window.onUploadDone=v.onCheckURLDone.pbind(!0,o),window.onUploadFail=v.onCheckURLDone.pbind(!1,o),a&&(cur.checkURLTO=setTimeout(function(){v.urlAttachmentLoading.length>0&&v.clearCheckURL()},a)),n.submit()}):(o.onError||function(){})()},addPreview:function(e){return v.sharePreview=T.appendChild(ce("div",{className:"medadd_c medadd_c_link",innerHTML:'<div class="medadd_c_linkcon"><div></div>'+(e?'<div class="medadd_c_linkprg">'+getProgressHtml("","medadd_c_linkprg_inner")+"</div>":"")+"</div>"}))},shareImgUrl:function(e){var a=v.shareData;if(isArray(a.preview_images)&&a.preview_images[e])return a.preview_images[e];if(a.images_proxy&&a.images_proxy[e])return a.images_proxy_url+a.images_proxy[e];if(a.images){var t=a.images[e];return isArray(t)&&(t=t[0]?t[0]:""),t}return""},initSnippetVideoFunctions:function(){cur.selectSnippetVideo=function(){var e={to_id:h.toId||cur.postTo,act:"a_choose_video_box",snippet_video:1};showBox("al_video.php",e,{cache:1,dark:1})},cur.chooseSnippetVideo=function(e,a){var t=v.shareData,o=e.split("_");t.video_owner_id=o[0],t.video_id=o[1],t.video_full_id=e,t.video=a;var i=!1,n=!0,r=!1,s=void 0;try{for(var d,l=Object.keys(a.editable.sizes)[Symbol.iterator]();!(n=(d=l.next()).done);n=!0){var c=d.value;(i&&a.editable.sizes[c][1]>a.editable.sizes[i][1]||!i)&&(i=c)}}catch(e){r=!0,s=e}finally{try{!n&&l.return&&l.return()}finally{if(r)throw s}}if(i){var _=a.editable.sizes[i];t.images[t.images.length-1]=[_[0],o[0],o[1],"video",a.editable.duration],cur.shareShowNext(0,1)}v.showVideoSnippetPreview()}},showPreview:function(e){var t,o,i=v.shareData,n=v.sharePreview||v.addPreview();i.is_product?addClass(domFC(n),"medadd_c_link_product"):removeClass(domFC(n),"medadd_c_link_product"),i.images&&(t=i.images[cur.shareShowImg],o=!(!v.bigLink&&!i.big_link||i.force_small_link));var r=!(!cur.options.share||!cur.options.share.allow_snippet_video),s=i.video&&r;if(i.failed)var d=getLang("page_not_loaded");else{var l,c="",_=clean(v.shareImgUrl(cur.shareShowImg));if(r&&v.initSnippetVideoFunctions(),i.images&&i.images[cur.shareShowImg]&&_){var p=i.images[cur.shareShowImg];if(i.images.length>0){var u=!(!cur.options.share||!cur.options.share.allow_custom_photo),g=u&&!(cur.options.share&&cur.options.share.require_image),m="onmouseover=\"showTooltip(this, {text: '"+getLang("global_link_choose_own_photo")+"', black: 1, shift: [7, 11, 8], appendParentCls: 'post'})\"",f="onmouseover=\"showTooltip(this, {text: '"+getLang("global_link_choose_own_video")+"', black: 1, shift: [7, 11, 8], appendParentCls: 'post'})\"",w="onmouseover=\"showTooltip(this, {text: '"+getLang("global_link_remove_photo")+"', black: 1, shift: [7, 11, 8], appendParentCls: 'post'})\"",b=isArray(p)&&1==p.length,k=b&&!r,y=b&&r,C=i.media&&"_"!=i.media&&u?'<div class="medadd_c_linkimg_controls">  <div class="medadd_c_linkimg_controls_btn_group clear_fix fl_l">'+(i.images.length>1?'    <div class="medadd_c_linkimg_controls_btn_arrows_group">      <div class="medadd_c_linkimg_controls_btn" id="medadd_ctrl_left" onclick="cur.shareShowNext(true);"></div>      <div class="medadd_c_linkimg_controls_btn" id="medadd_ctrl_right" onclick="cur.shareShowNext();"></div>    </div>':"")+'    <div class="medadd_c_linkimg_controls_btn '+(i.images.length>1?"medadd_c_btn_side_padd":"")+'" id="medadd_ctrl_upload" '+m+" onclick=\"Page.ownerPhoto('"+i.media+"');\"></div>"+(r?'<div class="medadd_c_linkimg_controls_btn '+(i.images.length>1?"medadd_c_btn_side_padd":"")+'" id="medadd_ctrl_upload_video" '+f+' onclick="cur.selectSnippetVideo();"></div>':"")+"  </div>"+(g?'  <div class="medadd_c_linkimg_controls_btn_group clear_fix fl_r">    <div class="medadd_c_linkimg_controls_btn" id="medadd_ctrl_remove" '+w+' onclick="tooltips.hide(this);cur.removeLinkImage(this)"></div>  </div>':"")+"</div>":"",x=(t?"":"display: none")+";background-image:url("+_+")";i.image_ratio>0&&(x+=";height: 0px; padding-top: "+100*i.image_ratio+"%;min-height: 0px;");var M="video"===p[3];c='<div class="medadd_c_linkimg_container '+(T&&T.offsetWidth>550?"medadd_c_linkimg_container_wide":"")+'" style="'+x+'">'+c+(M?'<div class="medadd_c_linkimg_container_video_overlay"></div>':"")+(M?'<div class="video_thumb_label"><span class="video_thumb_label_item"></span><span class="video_thumb_label_item">'+p[4]+"</span></div>":"")+(k?'<div class="medadd_c_linkimg_button"><button class="flat_button secondary_dark" onclick="Page.ownerPhoto(\''+i.media+"');\">"+getLang("global_link_choose_own_photo")+"</button></div>":"")+(y?'<div class="medadd_c_linkimg_button"><div class="medadd_c_linkimg_button_half_container"><button class="flat_button secondary_dark" onclick="Page.ownerPhoto(\''+i.media+"');\">"+getLang("global_link_choose_own_photo")+'</button></div><div class="medadd_c_linkimg_button_half_container"><button class="flat_button secondary_dark medadd_c_linkimg_video_button" onclick="cur.selectSnippetVideo();">'+getLang("global_link_choose_own_video")+"</button></div></div>":"")+C+'<div id="medadd_c_linkimg_loader" class="medadd_c_linkimg_loader">'+getProgressHtml("","inv medadd_c_linkimg_loader_inner")+"</div></div>"}}var S="";i.microdata&&i.microdata_preview_html&&(S=i.microdata_preview_html);var P={title:{placeholder:'<span class="medadd_inline_placeholder">'+getLang("global_link_edit_title")+"</span>",editable:cur.options.share&&cur.options.share.allow_edit_title},description:{placeholder:'<span class="medadd_inline_placeholder">'+getLang("global_link_edit_desc")+"</span>",editable:cur.options.share&&cur.options.share.allow_edit_desc}},B=i.shareButtons,I=B&&B.length&&B[0],A=i.button_text||I&&I[1],D=i.button_text_lang||I&&I[2],L=i.button_action||I&&I[0];if(B&&B.length&&D===A)for(var E=0;E<B.length;++E)if(B[E][0]===L&&B[E][2]===A){A=B[E][1];break}var N=!1;B&&B.length&&(N=B.length>1||D===A||I[0]!==L||I[1]!==A);var U=!!B&&B.length,z=cur.options.share&&cur.options.share.allow_remove_button&&!s;d=c+'<div class="medadd_c_linkwrap '+(c?"":"no_photo")+'"><div class="medadd_c_linkwrap_block">'+(i.title||P.title.editable?'<div class="medadd_c_linkhead '+(P.title.editable?"medadd_inline_editable":"")+'">'+(P.title.editable?'<div class="medadd_inline_editable_icon"></div>':"")+'<span class="medadd_inline_edit_target" data-max-length="'+(cur.options.share&&cur.options.share.max_title_len?cur.options.share.max_title_len:0)+'" data-field="title">'+(clean(i.title).replace(/\n/g,"<br>")||P.title.placeholder)+"</span></div>":"")+(S?'<div class="medadd_c_linkmicrodata">'+S+"</div>":"")+(i.domain?'<div class="page_media_link_url medadd_c_linkaddr">'+i.domain+"</div>":"")+"</div>"+(D&&U?'<div class="medadd_c_linkwrap_block medadd_c_linkwrap_block_button">'+(z?'<div class="hide_icon medadd_c_linkbtn_remove" onclick="cur.shareRemoveButton();" onmouseover="showTooltip(this, {text: \''+getLang("global_share_button_remove_tooltip")+"', black: 1, shift: [15, 10, 0]})\"></div>":"")+'<div class="wall_postlink_preview_btn medadd_c_linkbtn"><a onclick="cur.toggleShareButton(this);return false;" onmouseout="Page.actionsDropdownHide(domNS(this), 0, cur.setActiveShareButton.pbind(false))" onmouseover="Page.actionsDropdownUnhide()" class="flat_button"><span onmouseover="Page.actionsDropdownUnhide()" class="'+(N?"page_actions_dd_label":"")+' wall_postlink_preview_btn_label" data-field="button_text">'+D+"</span></a></div></div>":"")+'</div><div class="clear_fix"></div>'}if(o?addClass(domFC(n),"medadd_c_linkimg_big"):removeClass(domFC(n),"medadd_c_linkimg_big"),e)cur.preventShareAnim&&(cur.preventShareAnim.stop(),clearInterval(cur.animateUpdateInterval),h.onChangedSize&&h.onChangedSize()),val(domFC(n),d),domFC(n).style.height="auto",l&&ge("snippet_video_preview_wrap").appendChild(l),shortCurrency();else{show(T);var q=a.appendChild(ce("div",{innerHTML:'<div class="medadd_c_linkcon '+(o?"medadd_c_linkimg_big":"")+'">'+d+"</div>"},{position:"absolute",width:getSize(n)[0]-10,visibility:"hidden"})),O=getSize(q)[1];re(q),setStyle(domFC(n),{height:"0"}),setStyle(n,{overflow:"hidden"}),val(domFC(n),d),l&&ge("snippet_video_preview_wrap").appendChild(l),shortCurrency(),cur.animateUpdateInterval=setInterval(function(){h.onChangedSize&&h.onChangedSize()},100),cur.preventShareAnim=animate(domFC(n),{height:O},200,function(){setStyle(domFC(n),{height:"auto",display:""}),setStyle(n,{overflow:""}),clearInterval(cur.animateUpdateInterval),h.onChangedSize&&h.onChangedSize()}),re(geByClass1("medadd_c_linkprg",T))}function F(e){if(!e||e.inlineEdit)return!1;var a=getSize(e),t=gpeByClass("medadd_inline_editable",e);e.inlineEdit=!0,addClass(t,"medadd_inline_editing");var o=ce("textarea",{className:"medadd_inline_edit"},{width:a[0],height:a[1]}),i=parseInt(e.getAttribute("data-max-length"));i&&o.setAttribute("maxlength",i);var n=e.getAttribute("data-field");val(o,v.shareData[n]),val(e,""),e.appendChild(o);var r=ce("span",{className:"medadd_inline_edit_target"},{opacity:0,zIndex:-1,width:a[0],height:"auto",wordWrap:"break-all",position:"absolute"});t.appendChild(r);var s=a[1];elfocus(o),o.onblur=function(){re(r),v.shareData[n]=val(o),val(e,clean(val(o)).replace(/\n/g,"<br>")||P[n].placeholder),removeClass(t,"medadd_inline_editing"),e.inlineEdit=!1};var d=function(){var e=clean(val(o)+" M").replace(/\n/g,"<br>");if(val(r,e),!(e.length>=i)){var a=getSize(r);s!=a[1]&&(s=a[1],animate(o,{height:a[1]},200))}};addEvent(o,"click keyup change",d),setTimeout(d,0)}if(P.title.editable){var R=geByClass1("medadd_c_linkhead",domFC(n)),j=geByClass1("medadd_inline_edit_target",R);R&&j&&(R.onclick=F.bind(this,j))}if(P.description.editable){var H=geByClass1("medadd_inline_edit_target",geByClass1("medadd_c_linkdsc",domFC(n)));H&&(H.onclick=F.bind(this,H))}if(U&&(v.shareData.button_text=A,v.shareData.button_text_lang=D,v.shareData.button_action=L,N)){var W=domPN(geByClass1("wall_postlink_preview_btn_label",domFC(n))),G=[],V=0,$=0,K=[];for(var E in B)if(B.hasOwnProperty(E)){var X=B[E];X[0]==L&&X[1]==A&&(V=$),G.push([$++,X[1]]),K.push('<a class="page_actions_item" tabindex="0" role="link" onclick="cur.updateShareButton(this);Page.actionsDropdownHide(domPN(domPN(this)), 1, cur.setActiveShareButton.pbind(false));return false;" data-button-text="'+X[1]+'" data-button-text-lang="'+X[2]+'" data-button-action="'+X[0]+'">'+X[2]+"</a>")}W.setAttribute("data-items",JSON.stringify(G)),W.setAttribute("data-value",V);var Y=['<div class="page_actions_wrap medadd_c_linkbtn_actions_wrap unshown" onmouseout="Page.actionsDropdownHide(this, 0, cur.setActiveShareButton.pbind(false))" onmouseover="Page.actionsDropdownUnhide()" onmouseup="setTimeout(function() { Page.actionsDropdownUnhide(); }, 5)">','<div class="page_actions_inner">',K.join(""),"</div>","</div>"].join("");domPN(W).appendChild(se(Y)),ls.get("share_button_text_tooltip_shown")||cur.buttonTextTooltip||setTimeout(function(){cur.closeButtonTextTooltip=function(){cur.buttonTextTooltip.hide(),ls.set("share_button_text_tooltip_shown",1)};var e=geByClass1("wall_postlink_preview_btn_label",domFC(n)),a=domCA(e,".box_layout");cur.buttonTextTooltip=new ElementTooltip(e,{autoShow:!1,appendTo:a||geByTag1("body"),content:'<div class="feature_intro_tt_hide" onclick="cur.closeButtonTextTooltip();"></div>'+getLang("global_share_button_text_tooltip"),forceSide:"left",cls:"feature_intro_tt",offset:[-10,0,0],onHide:function(){cur.buttonTextTooltip.destroy()}}),cur.buttonTextTooltip.show(),addEvent(e,"mouseover",function(){cur.buttonTextTooltip&&cur.buttonTextTooltip.hide()})},1e3)}},showVideoSnippetPreview:function(){if(!(!cur.options.share||!cur.options.share.allow_snippet_video)){var e=v.shareData,a=e.video,t=e.video_owner_id,o=e.video_id;a&&isObject(a)&&t&&o&&a.editable&&(v.initSnippetButtonFunctions(),v.showPreview())}},initSnippetButtonFunctions:function(){cur.shareRemoveButton=function(){var a=v.sharePreview;window.tooltips&&tooltips.destroyAll(a),re(geByClass1("medadd_c_linkwrap_block_button",a)),v.shareData.button_text="",v.shareData.button_text_lang="",v.shareData.button_action="",show(domByClass(e,"media_selector"))},cur.updateShareButton=function(e){var a=e.getAttribute("data-button-text"),t=e.getAttribute("data-button-text-lang"),o=e.getAttribute("data-button-action");v.shareData.button_text=a,v.shareData.button_text_lang=t,v.shareData.button_action=o;var i=v.sharePreview;return val(geByClass1("page_actions_header_inner",i),t),val(geByClass1("wall_postlink_preview_btn_label",i),t),!1},cur.setActiveShareButton=function(e){var a=v.sharePreview;(e?addClass:removeClass)(domPN(geByClass1("wall_postlink_preview_btn_label",a)),"active")},cur.toggleShareButton=function(e){hasClass(e,"active")?(Page.actionsDropdownHide(domNS(e),1),cur.setActiveShareButton(!1)):(Page.actionsDropdown(domNS(e)),cur.setActiveShareButton(!0))}},showExternalPreview:function(){var e=v.shareData;e.images||(e.images=[]);var a,t=[],o=[],i={};each(e.images,function(a,n){i[n]||(i[n]=!0,t.push(n),e.images_proxy&&o.push(e.images_proxy[a]))}),e.uniqueImagesCount=t.length,e.images=t,e.images_proxy=o;var n=!(!cur.options.share||!cur.options.share.allow_snippet_video);if(a=T&&T.offsetWidth>550?isRetina()?"/images/post_snippet_image_placeholder_w_2x.png":"/images/post_snippet_image_placeholder_w.png":n?isRetina()?"/images/post_snippet_image_video_placeholder_2x.png":"/images/post_snippet_image_video_placeholder.png":isRetina()?"/images/post_snippet_image_placeholder_2x.png":"/images/post_snippet_image_placeholder.png",e.placeholder_inserted||(e.images.push([(cur.options.share||{}).allow_custom_photo?a:""]),e.placeholder_inserted=!0),!e.images||!e.images.length)return cur.shareShowImg=0,void v.showPreview();cur.shareShowImg=0,cur.shareShowImg--,v.addPreview(!0),e.imagesStyles={};var r=!1;cur.shareSetOwnPhoto=function(a){curBox()&&curBox().hide(),v.bigLink=!0,e.images[e.images.length-1]=[a.photo_url,a.user_id,a.photo_id],cur.shareShowNext(0,1)},cur.shareClearOwnPhoto=function(){e.images[e.images.length-1]=[],cur.shareShowNext(0,0,1)},cur.removeLinkImage=function(e){var a=gpeByClass("medadd_c_linkcon",e);addClass(a,"no_photo"),removeClass(a,"medadd_c_linkimg_big"),re(gpeByClass("medadd_c_linkimg_container",e)),setStyle(a,"height",""),v.shareData.noPhoto=!0},v.initSnippetButtonFunctions(),cur.shareShowNext=function(t,o,i){var n=vkImage();cur.prevShareShowDir=t,i||(o?cur.shareShowImg=e.images.length-1:t?cur.shareShowImg-=1:cur.shareShowImg+=1);var s=isArray(e.images[e.images.length-1])&&!!e.images[e.images.length-1][0];if(!s&&cur.shareShowImg>e.images.length-2)cur.shareShowImg=0;else if(cur.shareShowImg>e.images.length-1)cur.shareShowImg=0;else if(!s&&cur.shareShowImg<0)cur.shareShowImg=e.images.length-2;else if(cur.shareShowImg<0)cur.shareShowImg=e.images.length-1;else if(0==cur.shareShowImg)for(var d=1;d<e.images.length-1;d++){vkImage().src=v.shareImgUrl(d)}if(!e.images.length||isEmpty(e.images)||void 0===e.images[cur.shareShowImg])return v.showPreview(r),void(r=!0);var l=v.shareImgUrl(cur.shareShowImg);l&&(n.src=l),e.video=0,isArray(e.images[cur.shareShowImg])&&e.images[cur.shareShowImg][1]&&e.images[cur.shareShowImg][2]?"video"===e.images[cur.shareShowImg][3]?(e.video=1,e.video_owner_id=e.images[cur.shareShowImg][1],e.video_id=e.images[cur.shareShowImg][2]):(e.user_id=e.images[cur.shareShowImg][1],e.photo_id=e.images[cur.shareShowImg][2],e.share_own_image=!0):(e.user_id=void 0,e.photo_id=void 0,e.share_own_image=!1);var c=null;l&&(cur.imgLoadTimeout=c=setTimeout(function(){!0!==cur.shareImgInterval&&(isArray(e.images[cur.shareShowImg])||(e.images.splice(cur.shareShowImg,1),e.images_proxy&&e.images_proxy.length>cur.shareShowImg&&e.images_proxy.splice(cur.shareShowImg,1),cur.shareShowNext()))},5e3));var _=setTimeout(function(){show("medadd_c_linkimg_loader"),_=null,h.onChangedSize&&h.onChangedSize()},100);cur.showLoaderTimeout=_;var p=function(){if(n.width||n.height||!l){var t=n.width,o=n.height,i="",s="";if(c&&(clearTimeout(c),c=null),_&&(clearTimeout(_),_=null),hide("medadd_c_linkimg_loader"),clearInterval(cur.shareImgInterval),!isArray(e.images[cur.shareShowImg])&&(t<150||o<67)){if(e.images.splice(cur.shareShowImg,1),e.images_proxy&&e.images_proxy.length>cur.shareShowImg&&e.images_proxy.splice(cur.shareShowImg,1),e.images.length)return setTimeout(cur.shareShowNext.pbind(0,0,1),0)}else{var d=t>=532&&o>=235,p=(d||!!e.big_link)&&!e.force_small_link;if(cur.options.share&&cur.options.share.force_big_link&&!d){e.images.splice(cur.shareShowImg,1),e.images_proxy.splice(cur.shareShowImg,1);var u=(cur.options.share||{}).allow_custom_photo||(cur.options.share||{}).require_image;return 0==e.images.length&&u&&e.images.push([u?a:""]),cur.prevShareShowDir||cur.shareShowImg--,void cur.shareShowNext(cur.prevShareShowDir)}v.bigLink=p,p?i="width: 100%;":(t>150&&(o=150*o/t,t=150),i="width: "+t+"px; height: "+o+"px;")}e.images.length>1&&(s=""),e.imagesStyles[cur.shareShowImg]='style="'+i+'"'+s,v.showPreview(r),r=!0,h.onAddMediaChange&&h.onAddMediaChange("share",e.media,e)}};clearInterval(cur.shareImgInterval),cur.shareImgInterval=setInterval(p,300),cur.shareImgInterval2=setTimeout(p,0)},cur.shareShowNext()},uploadShare:function(e){var a=v.shareData,t=v.sharePreview,o=t.appendChild(ce("div",{innerHTML:'<iframe class="upload_frame" name="share_upload_iframe'+S+'"></iframe>'})),i=o.appendChild(ce("form",{action:"/share.php",method:"post",target:"share_upload_iframe"+S})),n=a.images[cur.shareShowImg];each({act:"a_photo",url:a.url,index:S,image:n,extra:a.extra||0,hash:vk.ip_h},function(e,a){i.appendChild(ce("input",{type:"hidden",name:e,value:a}))}),window.onUploadDone=function(a,i){window.onUploadFail=window.onUploadDone=function(){},t.removeChild(o),v.shareData=extend(v.shareData,{user_id:i.user_id,photo_id:i.photo_id,photo_url:n}),setTimeout(e,0)},window.onUploadFail=function(a,i){window.onUploadFail=window.onUploadDone=function(){},t.removeChild(o),v.shareData.share_upload_failed=1,setTimeout(e,0)},cur.shareLastParseSubmitted=vkNow(),i.submit()},setupPostpone:function(e,t,o){var i;i=k||E?E:domPN(geByClass1("page_preview_postpone_wrap",a));var n=cur.editingPost&&"wpe_media_preview"==domPN(i).id,s=n||!k?"":"1px",d=!1,l="",c='<div class="clear_fix">\n        <div class="fl_l datepicker_item"><input type="hidden" id="postpone_date'+S+'" value="'+(e.date||"")+'" /></div>\n        <div class="fl_l datepicker_item medadd_c_timerat">'+e.lang.profile_wall_postpone_at+'</div>\n        <div class="fl_l datepicker_item"><input type="hidden" id="postpone_time'+S+'"/></div></div>';if(cur.editingPost&&void 0!=e.friends_only){c+='<div class="medadd_c_timersett">';var _=e.friends_only?e.lang.friends_only:e.lang.wall_post_access_all;if(d=!0,l='<div class="post_action_btn post_available '+(e.friends_only?"on":"")+'" id="post_visibility_btn'+S+'">\n                          <div class="post_action_btn_layout">\n                            <span class="post_action_btn_text" role="button" aria-label="'+replaceEntities(_)+'">'+_+'</span>\n                            <div class="post_action_tt_content" id="post_visibility_tt_content'+S+'">\n                              <div class="eltt_fancy_action radiobtn '+(e.friends_only?"":"on")+'" id="no_friends_only'+S+'" onclick="Wall.togglePostFriendsOnly(this, false, '+S+')" role="radio" aria-checked="'+!e.friends_only+'" aria-label="'+replaceEntities(e.lang.wall_post_access_all)+'">'+e.lang.wall_post_access_all+'</div>\n                              <div class="eltt_fancy_action radiobtn '+(e.friends_only?"on":"")+'" id="friends_only'+S+'" onclick="Wall.togglePostFriendsOnly(this, true, '+S+')" role="radio" aria-checked="'+e.friends_only+'" aria-label="'+replaceEntities(e.lang.friends_only)+'">'+e.lang.friends_only+"</div>\n                            </div>\n                          </div>\n                         </div>"){var p=geByClass1("post_action_btn",m);p?m.insertBefore(se(l),p):m.appendChild(se(l)),Wall.createVisibilityPostTooltip(S)}}else cur.editingPost&&t&&(c+=t,d=!0);if(x&&(v.postponeTitle=i.appendChild(se('<div class="medadd_h medadd_h_timer inl_bl">'+e.lang.profile_choose_timer+'<span id="postpone_preview'+S+'"></span></div>'))),v.postponePreview=i.appendChild(ce("div",{className:"medadd_c medadd_c_timer clear_fix"+(d?" medadd_c_nofixed":"")+(x?" timer_in_tt":""),innerHTML:c})),x){var u=ce("button",{className:"post_postpone_save flat_button",innerHTML:getLang("global_save")}),g=ce("button",{className:"post_postpone_cancel flat_button secondary button_light",innerHTML:getLang("wall_post_timer_reset")});u.setAttribute("role","button"),u.setAttribute("aria-label",replaceEntities(getLang("global_save"))),g.setAttribute("role","button"),g.setAttribute("aria-label",replaceEntities(getLang("wall_post_timer_reset"))),v.postponeSubmitWrapper=ce("div",{className:"post_postpone_submit_wrapper clear_fix"}),v.postponeDate||hide(g),v.postponeSubmitWrapper.appendChild(u),v.postponeSubmitWrapper.appendChild(g),i.appendChild(v.postponeSubmitWrapper);var f=function(e){cur["postPostponeTT"+v.lnkId].hide(),null!=v.postponeInd&&setTimeout(function(){v.unchooseMedia(v.postponeInd)},ElementTooltip.FADE_SPEED),setTimeout(function(){hide(g)},ElementTooltip.FADE_SPEED),cancelEvent(e)},w=function(a){cur["postPostponeTT"+v.lnkId].hide();var t=!v.postponeDate;v.postponeDate=val("postpone_date"+v.lnkId),t&&v.chooseMedia(r,v.postponeDate,e),v.updatePostponeBtnText(),setTimeout(function(){show(g)},ElementTooltip.FADE_SPEED),cancelEvent(a)};addEvent(g,"click",f),addEvent(u,"click",w),cur.destroy.push(function(){g&&removeEvent(g,"click",f),u&&removeEvent(u,"click",w)})}x||(v.postponePreview.style.height=s),stManager.add(["ui_controls.css","ui_controls.js","datepicker.css","datepicker.js"],function(){v.postponeDatepicker=new Datepicker("postpone_date"+S,{time:"postpone_time"+S,width:155,noPast:!0,minStep:1,onUpdate:h.onMediaChange,hideAnotherMonth:!1}),n||!k||x||animate(v.postponePreview,{height:33},200,function(){v.postponePreview.style.height=""}),isFunction(o)&&o()})},getPostponeDateString:function(e){if(val("postpone_date"+v.lnkId)||e){e=(e=e||+val("postpone_date"+v.lnkId))+(60*(new Date).getTimezoneOffset()+intval(vk.tz))+intval(vk.dt);var a=new Date(1e3*e),t=a.getDate(),o=a.getMonth()+1,i=a.getFullYear();return"{day} {month} {year}".replace("{day}",t).replace("{month}",winToUtf(getLang("Month"+o+"_of"))).replace("{year}",i)+(" "+getLang("profile_wall_postpone_at")+" ")+(a.getHours()+":"+("0"+a.getMinutes()).slice(-2))}},resetPostpone:function(e){if(e){e=e+(60*(new Date).getTimezoneOffset()+intval(vk.tz))+intval(vk.dt);var a=new Date(1e3*e);if(a){var t=a.getDate(),o=a.getMonth()+1,i=a.getFullYear(),n=a.getHours(),r=a.getMinutes();v.postponeDatepicker.timePicker.hourDD.val(n),v.postponeDatepicker.timePicker.minDD.val(r),v.postponeDatepicker.setDate(i,o,t,null,n,r)}}},updatePostponeBtnText:function(e,a){if(x){var t=geByClass1("post_action_btn_text",v.menu.postponeBtn),o="";if(e)o=getLang("wall_publication_now");else{var i=v.getPostponeDateString(a);if(!i)return;o=i}t.innerHTML=o,t.setAttribute("aria-label",replaceEntities(o))}},createPrettyCards:function(e){cur.lang=extend(cur.lang||{},e.lang||{});var a=se(e.editor.container_html);T.appendChild(a),v.prettyCardGallery=new PrettyCardGallery(a,e.editor,e.pretty_cards)},destroy:function(){(I||{}).sorter&&I.sorter.destroy();for(var t=0;t<M.handlersToClean.length;t++)M.handlersToClean[t]();(B||{}).qsorter&&B.qsorter.destroy(),removeClass(a,"media_preview_has_medias"),a&&(a.innerHTML=""),show(e)},qsorterOpts:function(){return{xsize:Math.floor(B.offsetWidth/135),width:135,height:102,onReorder:h.onAddMediaChange,clsUp:"pam_dpic_up"}},resized:function(){window.ThumbsEdit&&ThumbsEdit.setWide("thumbs_edit"+cur.wallEditComposer.addMedia.lnkId),B.qsorter&&(B.qsorter.destroy(),window.qsorter.init(B,v.qsorterOpts()))}}).copyrightInit(),v.markAsAdsInit(),cur.addMedia||(cur.addMedia={}),cur.addMedia[S]=v,h.onAddMediaChange&&(v.onChange=h.onAddMediaChange),v}};try{stManager.done(jsc("web/ui_media_selector.js"))}catch(e){}},146:function(e,a,t){e.exports=t("/aNj")},BxOC:function(e,a,t){"use strict";t.d(a,"b",function(){return n}),t.d(a,"a",function(){return r});var o=window.ajax,i=2;function n(e,a,t){return a&&(a.im_v=i),new Promise(function(i,n){o.post(e,a,{timeout:t,onDone:function(){i.apply(null,[[].concat(Array.prototype.slice.call(arguments))])},onFail:function(){return n.apply(null,arguments),!0}})})}function r(e,a){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=void 0;return i=window.XDomainRequest?new XDomainRequest:o._getreq(),{request:new Promise(function(o,n){var r=void 0,s=Date.now(),d=t.timeout||60,l=ajx2q(a);if(window.XDomainRequest)i.open("get",e+"?"+l),i.ontimeout=function(e){n([e,{}])},i.onerror=function(e){n([e,{}])},i.onload=function(){o([i.responseText,{}])},setTimeout(function(){i.send()},0);else{i.onreadystatechange=function(){4==i.readyState&&(clearInterval(r),i.status>=200&&i.status<300?o([i.responseText,i]):n([i.responseText,i]))};try{i.open("GET",e+"?"+l,!0)}catch(e){return n([e,i])}i.send()}r=setInterval(function(){Date.now()-s>1e3*d&&(n(["",{}]),clearInterval(r))},1e3)}),cancel:function(){i.abort()}}}}});