/*!
 * @vplayer/mango-player v6.2.6-eaa0bbd
 *
 * @author Mgtv.com F2E Group
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).mangoPlayer=e()}(this,function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function e(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}function i(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function n(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function r(t,e,i,n,r){var o={};return Object.keys(n).forEach(function(t){o[t]=n[t]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=i.slice().reverse().reduce(function(i,n){return n(t,e,i)||i},o),r&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(t,e,o),o=null),o}var o=Object.defineProperty,s=Object.getOwnPropertyDescriptor,a=Object.assign,c=Object.keys;function h(t){return void 0!==t}function l(t){return null==t}function d(t){return Array.isArray(t)}function u(t){return"function"==typeof t}function p(t){return Object(t)===t&&"[object Object]"===String(t)&&!u(t)&&!d(t)}function f(t){return"number"==typeof t}function m(t){return!d(t)&&t-Number.parseFloat(t)+1>=0}function v(t){return Number.isInteger(t)}function g(t){return d(t)?0===t.length:p(t)?0===c(t).length:!t}function y(t){return t instanceof Event||(t&&t.originalEvent)instanceof Event}function _(t){return"string"==typeof t||t instanceof String}function w(t){return"boolean"==typeof t}function b(t){return!!t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then}function E(t){return l(t)||w(t)||_(t)||f(t)}function T(t){return!!("object"==typeof Node?t instanceof Node:t&&"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName)}function R(t){return!!("object"==typeof HTMLElement?t instanceof HTMLElement:t&&"object"==typeof t&&null!==t&&1===t.nodeType&&"string"==typeof t.nodeName)}function A(t,e){if(!T(t)||!T(e))return!1;for(;e.parentNode;)if((e=e.parentNode)===t)return!0;return!1}function S(t){return t instanceof Error}var k,P,C=(k=function(t){return t},void 0===P&&(P=function(t,e,i){t[e]=i}),function t(e,i,n){if(d(e)||p(e)){for(var r in i=E(i)?p(e)?{}:[]:i,e)P(i,r,t(e[r],i[r],r));return i}return k(e,i,n)});function D(t){if(E(t))throw new TypeError("deepClone only accept non primitive type");return C(t)}function x(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if(e.length<2)throw new Error("deepAssign accept two and more argument");for(var n=e.length-1;n>-1;n--)if(E(e[n]))throw new TypeError("deepAssign only accept non primitive type");var r=e.shift();return e.forEach(function(t){return C(t,r)}),r}function I(t,e){return t.replace(/(^|[^a-zA-Z]+)([a-zA-Z])/g,function(t,i,n,r){return e||0!==r?n.toUpperCase():n.toLowerCase()})}function L(t,e){return t.bind?t.bind(e):t.apply?function(){for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return t.apply(e,n)}:function(){for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return t.call.apply(t,[e].concat(n))}}function O(t,e,i){var n=void 0===i?{}:i,r=n.throwError,o=void 0!==r&&r,s=n.backup;if(_(e)&&(e=e.split(".")),!d(e))throw new TypeError("keys of getDeepProperty must be string or Array<string>");for(var a=[],c=t,h=0,u=e.length;h<u;h++){var p=e[h];if(l(c)){if(o)throw new Error("obj"+(a.length>0?"."+a.join("."):" itself")+" is "+c);return s}c=c[p],a.push(p)}return c}var M="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function F(){throw new Error("setTimeout has not been defined")}function N(){throw new Error("clearTimeout has not been defined")}var V=F,B=N;function U(t){if(V===setTimeout)return setTimeout(t,0);if((V===F||!V)&&setTimeout)return V=setTimeout,setTimeout(t,0);try{return V(t,0)}catch(e){try{return V.call(null,t,0)}catch(e){return V.call(this,t,0)}}}"function"==typeof M.setTimeout&&(V=setTimeout),"function"==typeof M.clearTimeout&&(B=clearTimeout);var W,z=[],j=!1,q=-1;function G(){j&&W&&(j=!1,W.length?z=W.concat(z):q=-1,z.length&&K())}function K(){if(!j){var t=U(G);j=!0;for(var e=z.length;e;){for(W=z,z=[];++q<e;)W&&W[q].run();q=-1,e=z.length}W=null,j=!1,function(t){if(B===clearTimeout)return clearTimeout(t);if((B===N||!B)&&clearTimeout)return B=clearTimeout,clearTimeout(t);try{B(t)}catch(e){try{return B.call(null,t)}catch(e){return B.call(this,t)}}}(t)}}function Y(t,e){this.fun=t,this.array=e}Y.prototype.run=function(){this.fun.apply(null,this.array)};var X=M.performance||{};X.now||X.mozNow||X.msNow||X.oNow||X.webkitNow,"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function Q(t,e){return t(e={exports:{}},e.exports),e.exports}var J=Q(function(t,e){var i;t.exports=(i="undefined"!=typeof window&&window.Math===Math?window:"undefined"!=typeof self&&self.Math===Math?self:Function("return this")(),"number"==typeof __g&&(__g=i),i)}),Z="undefined"!=typeof window&&window.document||{},tt=function(t){if("string"!=typeof t)throw new Error("trim need a string as parameter");for(var e=t.length,i=0,n=e-1,r=/(\u3000|\s|\t|\u00A0)/;i<e&&r.test(t.charAt(i));)++i;for(;n>=0&&r.test(t.charAt(n));)--n;return t.substring(i,n+1)},et=function(t){for(var e,i,n,r=t?t.split("; "):[],o={},s=-1,a=r.length;++s<a;)~(e=(t=tt(r[s])).indexOf("="))&&(i=t.substring(0,e),n=t.substring(e+1),o[i]=n);return o},it=function(t,e,i){if(i=i||{},void 0!==e){if(i=function(t){var e={};for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}(i),null===e&&(e="",i.expires=-1),"number"==typeof i.expires){var n=i.expires,r=i.expires=new Date;r.setTime(r.getTime()+864e5*n)}var o=function(t){try{return i.raw?t:encodeURIComponent(t)}catch(t){}return t};return Z.cookie=[o(t),"=",o(e),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join(""),e}var s;return s=et(Z.cookie)[t],i.raw?s:s&&decodeURIComponent(s)||null};it.set=function(t,e,i){return it(t,e,i)},it.get=function(t){return it(t)},it.remove=function(t){return it(t,null)},it.keys=function(){return c(et(Z.cookie))};var nt=void 0!==J&&"[object Object]"!==Object.prototype.toString.call(J);function rt(t,e){return void 0===e&&(e=function(t,e){return+t-+e}),c(t).sort(e).reduce(function(e,i){return e.concat(t[i])},[])}function ot(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return new Promise(function(e,n){var r=function(o){if(!(o>=t.length)){var s=u(t[o])?t[o].apply(t,i):t[o];return!1===s?n("stop"):Promise.resolve(s).then(function(){return r(o+1)}).catch(function(t){return n(t||"stop")})}e()};r(0)})}function st(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];var r=function(e){return e>=t.length||!1!==(u(t[e])?t[e].apply(t,i):t[e])&&r(++e)};return r(0)}function at(t,e,i){var n,r,o,s,a,c=function(){var h=new Date-s;h<e&&h>=0?n=setTimeout(c,e-h):(n=null,i||(a=t.apply(o,r),n||(o=r=null)))};return function(){o=this,r=arguments,s=new Date;var h=i&&!n;return n||(n=setTimeout(c,e)),h&&(a=t.apply(o,r),o=r=null),a}}function ct(t,e,i,n){var r,o,s,a=null,c=0;i||(i={});var h=function(){c=!1===i.leading?0:new Date-0,a=null,s=t.apply(r,o),a||(r=o=null)};return e=e||0,function(){var l=new Date;c||!1!==i.leading||(c=l);var d=e-(l-c);return r=n||this,o=arguments,d<=0||d>e?(a&&(clearTimeout(a),a=null),c=l,s=t.apply(r,o),a||(r=o=null)):a||!1===i.trailing||(a=setTimeout(h,d)),s}}var ht=nt&&(J.requestAnimationFrame||J.mozRequestAnimationFrame||J.webkitRequestAnimationFrame||J.msRequestAnimationFrame||J.oRequestAnimationFrame)||function(t){return setTimeout(t,17)},lt=nt&&(J.cancelAnimationFrame||J.mozCancelAnimationFrame||J.webkitCancelAnimationFrame||J.webkitCancelRequestAnimationFrame||J.msCancelAnimationFrame||J.oCancelAnimationFrame)||function(t){clearTimeout(t)},dt=J.setImmediate||function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];z.push(new Y(t,e)),1!==z.length||j||U(K)};function ut(t){var e=Math.floor(t/60)<10?"0"+Math.floor(t/60):Math.floor(t/60);return e+":"+(Math.floor(t-60*e)<10?"0"+Math.floor(t-60*e):Math.floor(t-60*e))}function pt(t,e){return t.replace(/{{(\w+)}}/g,function(t,i){return 0===e[i]?0:e[i]||""})}function ft(t,e){void 0===t&&(t=new Date),void 0===e&&(e="yyyy-MM-dd hh:mm:ss.i");var i=t.getFullYear().toString(),n={M:t.getMonth()+1,d:t.getDate(),h:t.getHours(),m:t.getMinutes(),s:t.getSeconds(),i:t.getMilliseconds()};e=e.replace(/(y+)/gi,function(t,e){return i.substr(4-Math.min(4,e.length))});var r=function(t){e=e.replace(new RegExp("("+t+"+)","g"),function(e,i){return(n[t]<10&&i.length>1?"0":"")+n[t]})};for(var o in n)r(o);return e}function mt(t){return it.get(t)}function vt(t){return c(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(void 0===t[e]?"":t[e])}).join("&")}function gt(t,e){e=void 0===e?location.search.substr(1):e;var i=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),n=e.match(i);return null!=n?unescape(n[2]):null}function yt(t){var e="clipbrd-"+Math.floor(1e6*Math.random());$("body").append('<input type="textarea" id="'+e+'"/>');var i=$("#"+e);i.val(t);try{i.select(),document.execCommand("copy")}catch(t){}i.remove()}var _t=function(t,e){if(!t)throw new Error("get(o, k): object not valid.");if(~e.indexOf("."))for(var i=e.split(".").filter(Boolean),n=-1,r=i.length-1;++n<r;)t=t&&t[i[n]],e=i[n+1];return[t,t&&t[e]]};function wt(t,e,i){var n;return p(t)&&(n=_t(t,e)[1]),void 0===n?i:n}function bt(t,e,i){try{return function(t,e,i){if(t){var n=_t(t,e),r=n[0],o=n[1];if("function"==typeof o)return o.apply(r,i||[])}}(t,e,i)}catch(t){}}function Et(t){var e=document.createElement("a");return e.href=t,e}function Tt(t){var e=Et(t);return!(!e||!e.pathname||-1==e.pathname.indexOf(".mp4"))}function Rt(t){var e=Et(t);return!(!e||!e.pathname||-1==e.pathname.indexOf(".mpd"))}function At(t){var e=navigator,i=(e.userAgent,J),n=(e.userAgent.toLowerCase(),[0,0,0]),r=null;if(void 0!==e.plugins&&"object"==typeof e.plugins["Shockwave Flash"])!(r=e.plugins["Shockwave Flash"].description)||void 0!==e.mimeTypes&&e.mimeTypes["application/x-shockwave-flash"]&&!e.mimeTypes["application/x-shockwave-flash"].enabledPlugin||(r=r.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),n[0]=parseInt(r.replace(/^(.*)\..*$/,"$1"),10),n[1]=parseInt(r.replace(/^.*\.(.*)\s.*$/,"$1"),10),n[2]=/[a-zA-Z]/.test(r)?parseInt(r.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(void 0!==i.ActiveXObject)try{var o=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");o&&(r=o.GetVariable("$version"))&&(r=r.split(" ")[1].split(","),n=[parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)])}catch(t){}var s=t.split(".");return s[0]=parseInt(s[0],10),s[1]=parseInt(s[1],10)||0,s[2]=parseInt(s[2],10)||0,100*n[0]+10*n[1]+n[2]>100*s[0]+10*s[1]+s[2]}var St,kt,Pt,Ct=Date.now||function(){return+new Date},Dt="function"==typeof WeakMap&&(WeakMap.prototype||0).set?(St=new WeakMap,function(t,e){var i=St.get(t);return null===e?void 0!==i&&St.delete(t):!i&&e?(St.set(t,i={}),i):i}):(kt=Ct(),Pt="__$widΦ"+kt.toString(36),St={},function(t,e){if(!t||"object"!=typeof t)throw TypeError("Invalid host object apply with weak data");var i;return null===e?t[Pt]&&(delete St[t[Pt]],delete t[Pt]):(i=t[Pt]||e&&(i=++kt,St[i]={},t[Pt]=i))&&St[i]}),xt={}.hasOwnProperty;function It(t,e){for(var i in t)xt.call(t,i)&&e(t[i],i)}var Lt=Date.now||function(){return+new Date},Ot=Object.defineProperty,Mt=Ot?function(t,e,i){return Ot(t,e,{writable:!0,value:i})}:function(t,e,i){return t[e]=i},$t=Object.keys||function(t){var e=[];return It(t,function(t,i){e.push(i)}),e},Ft=2,Nt=0,Vt=1,Ht=2,Bt=/\s+/,Ut=Lt()*Math.random()&65535,Wt=function(t,e,i){var n=[];return n[Nt]=t,n[Vt]=e,n[Ht]=i,n};function zt(){}var jt=zt.prototype;function qt(t,e,i){var n;switch(i.length){case 0:n=e?t.call(e):t();break;case 1:n=t.call(e,i[0]);break;case 2:n=t.call(e,i[0],i[1]);break;default:n=t.apply(e,i)}return n}function Gt(t,e,i,n){var r=!0;if(e)for(var o,s,a,c=-1,h={type:t,timeStamp:Lt(),data:i};o=e[++c];){s=o[Nt],a=o[Vt]||n;try{r=o[Ht]===Ft?!1!==qt(s,a,[h,i])&&r:!1!==qt(s,a,i)&&r}catch(t){setTimeout(function(){},1)}}return r}jt.addListener=function(t,e,i,n){var r,o,s=1;if(e&&"object"==typeof e&&(e=(i=e).handleEvent,s=Ft),!e)return this;for(r=Dt(this,1),this._events||Mt(this,"_events",r),t=t.split(Bt);o=t.shift();)(!n&&r[o]||(r[o]=[])).push(Wt(e,i,s));return this},jt.on=jt.addListener,jt.once=function(t,e,i){var n=!1,r=this,o=function o(){r.removeListener(t,o),n||(n=!0,e.apply(i||r,arguments))};return o.guid=e.guid||(e.guid=Ut++),r.on(t,o)},jt.removeListener=function(t,e,i){var n,r,o,s,a,c;if(e&&"object"==typeof e&&(e=(i=e).handleEvent),!(n=Dt(this)))return this;if(!(t||e||i))return It(n,function(t,e){delete n[e]}),Dt(this,null),this;for(t=t?t.split(Bt):$t(n);r=t.shift();)if(o=n[r])if(e||i){for(s=o.length;--s>=0;)c=(a=o[s])[Nt],e&&c!==e&&(void 0===c.guid||c.guid!==e.guid)||i&&a[Vt]!==i||o.splice(s,1);o.length||delete n[r]}else delete n[r];return function(t){for(var e in t)if(xt.call(t,e))return!1;return!0}(n)&&Dt(this,null),this},jt.off=jt.removeListener,jt.removeAllListeners=function(t){return this.removeListener(t)},jt.emit=function(t){var e,i,n,r,o=!0;if(!(e=Dt(this)))return this;t=t.split(Bt);for(var s=arguments.length,a=new Array(s>1?s-1:0),c=1;c<s;c++)a[c-1]=arguments[c];for(;i=t.shift();)(n=e.all)&&(n=n.slice()),(r=e[i])&&(r=r.slice()),"all"!==i&&(o=Gt(i,r,a,this)&&o),o=Gt(i,n,[i].concat(a),this)&&o;return o},jt.listenerCount=function(t){var e,i=Dt(this);return i&&(e=i[t])?e.length:0},zt.EventEmitter=zt;var Kt=function(t,e,i){return o(t,e,{writable:!0,enumerable:!1,configurable:!0,value:i})},Yt=Object.create(null),Xt=0;function Qt(t,e,i){void 0===i&&(i="__evt_id");var n=t[i];n||Kt(t,i,n=++Xt);var r=n+"_"+e,o=Yt[r];return o||(o=Yt[r]=[]),o}function Jt(t,e,i,n,r){void 0===n&&(n=!1),u(n)&&!r&&(r=n,n=void 0);var o=[i,void 0,n];n&&!r&&(r=function(){Zt(t,e,i,n);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];i.apply(t,o)}),r&&(o[1]=r),Qt(t,e).push(o)}function Zt(t,e,i,n){void 0===n&&(n=!1);var r=Qt(t,e);if(i||n){var o,s=-1;return r.find(function(t,e){if((!i||t[0]===i)&&(!n||t[2]))return s=e,o=t[1],!0}),-1!==s&&r.splice(s,1),o}r.length=0}var te=function(t){function e(){return t.apply(this,arguments)||this}return i(e,t),e.prototype.emit=function(e,i){var n=a(Object.create(null),{type:e,data:i,target:this});return t.prototype.emit.call(this,e,n)},e}(zt.EventEmitter),ee=nt?document.createElement("div"):{},ie="innerText";"textContent"in ee&&(ie="textContent");var ne=Array.prototype;function re(t,e){return t.getAttribute(e)}function oe(t,e,i){void 0===i?t.removeAttribute(e):t.setAttribute(e,i)}function se(t,e){if(e&&(e=e.trim())){var i=e.split(/\s+/);if(t.classList)i.forEach(function(e){return t.classList.add(e)});else{var n=" "+(t.className||"")+" ";i.forEach(function(t){-1===n.indexOf(" "+t+" ")&&(n+=" "+t)}),t.className=n.trim()}}}function ae(t,e){if(e&&(e=e.trim())){var i=e.split(/\s+/);if(t.classList)i.forEach(function(e){return t.classList.remove(e)});else{var n=" "+t.className+" ";i.forEach(function(t){for(var e=" "+t+" ";-1!==n.indexOf(e);)n=n.replace(e," ")}),t.className=n.trim()}}}function ce(t,e){return new RegExp("(?:^|\\s)"+e+"(?=\\s|$)").test(t.className)}var he=!1;try{var le=o({},"passive",{get:function(){he=!0}});nt&&window.addEventListener("test",null,le)}catch(t){}function de(t,e,i,n,r){if(void 0===n&&(n=!1),void 0===r&&(r=!1),void 0!==r&&!w(r)&&he&&(r={passive:!0}),n){var o=Zt(t,e+"_once",i);o&&(i=o)}t.removeEventListener(e,i,r)}function ue(t,e,i,n,r){if(void 0===n&&(n=!1),void 0===r&&(r=!1),void 0!==r&&!w(r)&&he&&(r={passive:!0}),n){var o=i;i=function(){for(var s=arguments.length,a=new Array(s),c=0;c<s;c++)a[c]=arguments[c];o.apply(this,a),de(t,e,i,n,r)},Jt(t,e+"_once",o,i)}t.addEventListener(e,i,r)}function pe(t,e){return!t.getBoundingClientRect||"width"!==e&&"height"!==e?(t.currentStyle||document.defaultView.getComputedStyle(t,null))[e]||t.style[e]:t.getBoundingClientRect()[e]}function fe(t,e,i){if(p(e))for(var n in e)fe(t,n,e[n]);else t.style[e]=i}function me(t,e,i){void 0===e&&(e=document);var n=e.querySelectorAll(t);return i?Array.from(n):n}var ve=function(){function t(t,e){void 0===e&&(e=document);var i,n;this.selector=t,t&&t.constructor===NodeList?(n=t,i=Array.from(n)):d(t)?i=t:_(t)?0===t.indexOf("<")?(ee.innerHTML=t,i=me("*",ee,!0)):i=me(t,e,!0):i=[t],a(this,i),this.length=i.length}var e=t.prototype;return e.each=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return ne.forEach.apply(this,e),this},e.push=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return ne.push.apply(this,e),this},e.splice=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return ge(ne.splice.apply(this,e))},e.find=function(t){var e=[];this.each(function(i){e=e.concat(me(t,i,!0))});var i=ge(e);return i.parent=this,i.selector=t,i},e.append=function(t){var e=ge(t),i=this[0];return e.each(function(t){return i.appendChild(t)}),this},e.appendTo=function(t){return ge(t).append(this),this},e.text=function(t){return 0===arguments.length?this[0][ie]:this.each(function(e){e[ie]=t})},e.hide=function(){return this.each(function(t){t.style.display="none"})},e.show=function(){return this.each(function(t){t.style.display="block"})},e.html=function(t){return 0===arguments.length?this[0].innerHTML:this.each(function(e){e.innerHTML=t})},e.attr=function(t,e){return 1===arguments.length?re(this[0],t):this.each(function(i){return oe(i,t,e)})},e.data=function(t,e){return 0===arguments.length?this[0].dataset||{}:1===arguments.length?(this[0].dataset||{})[t]:this.each(function(i){(i.dataset||(i.dataset={}))[t]=e})},e.css=function(t,e){return 1!==arguments.length||p(t)?this.each(function(i){return fe(i,t,e)}):pe(this[0],t)},e.addClass=function(t){return this.each(function(e){return se(e,t)})},e.removeClass=function(t){return this.each(function(e){return ae(e,t)})},e.hasClass=function(t){return ce(this[0],t)},e.on=function(t,e,i,n){return void 0===i&&(i=!1),void 0===n&&(n=!1),this.each(function(r){return ue(r,t,e,i,n)})},e.off=function(t,e,i,n){return void 0===i&&(i=!1),void 0===n&&(n=!1),this.each(function(r){return de(r,t,e,i,n)})},e.delegate=function(t,e,i,n){return void 0===n&&(n=!1),this.each(function(r){return function(t,e,i,n,r){void 0===r&&(r=!1),void 0!==r&&!w(r)&&he&&(r={passive:!0});var o=function(i){var r,o=function(t,e,i,n){void 0===e&&(e=null);var r=[];for(i&&r.push(t);t&&t.parentNode!==e;)(t=t.parentNode)&&r.push(t);return n&&r.push(e),r}(i.target||i.srcElement,t,!0),s=me(e,t,!0);s.find?r=s.find(function(t){return o.find(function(e){return t===e})}):s.forEach(function(t){return!r&&o.forEach(function(e){r||t!==e||(r=e)})}),r&&n.apply(r,arguments)};Jt(t,i+"_delegate_"+e,n,o),t.addEventListener(i,o,r)}(r,t,e,i,n)})},e.undelegate=function(t,e,i,n){return void 0===n&&(n=!1),this.each(function(r){return function(t,e,i,n,r){void 0===r&&(r=!1),void 0!==r&&!w(r)&&he&&(r={passive:!0});var o=Zt(t,i+"_delegate_"+e,n);o&&t.removeEventListener(i,o,r)}(r,t,e,i,n)})},e.remove=function(){return this.each(function(t){return function(t){t.parentNode.removeChild(t)}(t)})},t}();function ge(t,e){return t.constructor===ve?t:new ve(t,e)}var ye={isBuffered:function(t,e){try{if(t)for(var i=t.buffered,n=0;n<i.length;n++)if(e>=i.start(n)&&e<=i.end(n))return!0}catch(t){}return!1},bufferInfo:function(t,e,i){try{if(t){var n,r=t.buffered,o=[];for(n=0;n<r.length;n++)o.push({start:r.start(n),end:r.end(n)});return this.bufferedInfo(o,e,i)}}catch(t){}return{len:0,start:e,end:e,nextStart:void 0}},bufferedInfo:function(t,e,i){var n,r,o,s,a,c=[];for(t.sort(function(t,e){var i=t.start-e.start;return i||e.end-t.end}),a=0;a<t.length;a++){var h=c.length;if(h){var l=c[h-1].end;t[a].start-l<i?t[a].end>l&&(c[h-1].end=t[a].end):c.push(t[a])}else c.push(t[a])}for(a=0,n=0,r=o=e;a<c.length;a++){var d=c[a].start,u=c[a].end;if(e+i>=d&&e<u)r=d,n=(o=u)-e;else if(e+i<d){s=d;break}}return{len:n,start:r,end:o,nextStart:s}}},_e={timeout:5e3,jsonpCallback:"callback",jsonpCallbackFunction:null};function we(t){var e=new Error(t.msg);return e.name=e.name,e}function be(t){try{delete window[t]}catch(e){window[t]=void 0}}function Ee(t){var e=document.getElementById(t);e&&document.getElementsByTagName("head")[0].removeChild(e)}function Te(t,e){void 0===e&&(e={});var i,n=t,r=e.timeout||_e.timeout,o=e.jsonpCallback||_e.jsonpCallback;return new Promise(function(s,a){var c=e.jsonpCallbackFunction||"jsonp_"+Date.now()+"_"+Math.ceil(1e5*Math.random()),h=o+"_"+c;window[c]=function(t){s({ok:!0,json:function(){return Promise.resolve(t)}}),i&&clearTimeout(i),Ee(h),be(c)},n+=-1===n.indexOf("?")?"?":"&";var l=document.createElement("script");l.setAttribute("src",""+n+o+"="+c),e.charset&&l.setAttribute("charset",e.charset),l.id=h,document.getElementsByTagName("head")[0].appendChild(l),i=setTimeout(function(){a(we({name:"NETWORK_TIMEOUT",msg:"JSONP request to "+t+" timed out"})),be(c),Ee(h),window[c]=function(){be(c)}},r),l.onerror=function(){a(we({name:"NETWORK_ERROR",msg:"JSONP request to "+t+" failed"})),be(c),Ee(h),i&&clearTimeout(i)}})}var Re=J.localStorage,Ae=!1;try{Re.setItem("a","a"),Ae="a"===Re.getItem("a")}catch(t){}var Se={isSupport:Ae,get:function(t){try{var e=Re.getItem(t);return e=JSON.parse(e)}catch(t){}},set:function(t,e){try{return(d(e)||p(e))&&(e=JSON.stringify(e)),Re.setItem(t,e)}catch(t){}},remove:function(t){try{return Re.removeItem(t)}catch(t){}},clear:function(){try{return Re.clear()}catch(t){}}},ke=/iPad/i.test(navigator.userAgent)?"05":"02",Pe="抱歉！视频文件获取失败",Ce="抱歉！视频文件异常",De={ADINFO_FAIL:{type:"ADINFO_FAIL",code:ke+2210,msg:Pe},ADINFO_TIMEOUT:{type:"ADINFO_TIMEOUT",code:ke+2211,msg:Pe},AD_DOWNLOAD_CANCEL:{type:"AD_DOWNLOAD_CANCEL",code:ke+2212,msg:Pe},AD_DOWNLOAD_TIMEOUT:{type:"AD_DOWNLOAD_TIMEOUT",code:ke+2213,msg:Pe},AD_MEDIA_ERROR:{type:"AD_MEDIA_ERROR",code:ke+2214,msg:Pe},AD_MEDIA_UNSUPPORT:{type:"AD_MEDIA_UNSUPPORT",code:ke+2215,msg:Pe},AD_MEDIA_UNKOWN:{type:"AD_MEDIA_UNKOWN",code:ke+2216,msg:Pe},VIDEOINFO_FAIL:{type:"VIDEOINFO_FAIL",code:ke+2110,msg:Pe},VIDEOINFO_TIMEOUT:{type:"VIDEOINFO_TIMEOUT",code:ke+2111,msg:Pe},VIDEOINFO_DATA_FAIL:{type:"VIDEOINFO_DATA_FAIL",code:ke+2112,msg:Pe},SOURCE_FAIL:{type:"SOURCE_FAIL",code:ke+2310,msg:Pe},SOURCE_TIMEOUT:{type:"SOURCE_TIMEOUT",code:ke+2311,msg:Pe},SOURCE_DATA_FAIL:{type:"SOURCE_DATA_FAIL",code:ke+2312,msg:Ce},DISPATCHER_WRONG:{type:"DISPATCHER_WRONG",code:ke+2420,msg:Pe},DISPATCHER_TIMEOUT:{type:"DISPATCHER_TIMEOUT",code:ke+2421,msg:Pe},DISPATCHER_DATA_FAIL:{type:"DISPATCHER_DATA_FAIL",code:ke+2422,msg:Ce},CDN_DING_DOWNLOAD_TIMEOUT:{type:"CDN_DING_DOWNLOAD_TIMEOUT",code:ke+2530,msg:Pe},CDN_METADATA_PARSE_FAIL:{type:"CDN_METADATA_PARSE_FAIL",code:ke+2531,msg:"抱歉！视频播放失败"},CDN_MEDIA_TIMEOUT:{type:"CDN_MEDIA_TIMEOUT",code:ke+2532,msg:Pe},CDN_MEDIA_ERROR:{type:"CDN_MEDIA_ERROR",code:ke+2533,msg:Pe},CDN_OTHER_ERROR:{type:"CDN_OTHER_ERROR",code:ke+2534,msg:Pe},DRM_FAIL_ERROR:{type:"DRM_FAIL_ERROR",code:ke+2541,msg:Pe},DRM_NOT_SUPPORT_ERROR:{type:"DRM_NOT_SUPPORT_ERROR",code:ke+2542,tips:"请使用最新版本Chrome浏览器或者Edge浏览器进行播放 <br/>",msg:"浏览器不支持该视频播放"},AUTOPLAY_FAIL_ERROR:{type:"AUTOPLAY_FAIL_ERROR",code:ke+2610,msg:Pe}};function xe(t,e){if(!_(t))throw new TypeError("Log's method only acccept string as argument, but not "+t+" in "+typeof t);return _(e)?"[mango-player]["+(t=Me.FORCE_GLOBAL_TAG?Me.GLOBAL_TAG:t||Me.GLOBAL_TAG)+"] > "+e:"["+Me.GLOBAL_TAG+"] > "+t}var Ie=window.sessionStorage,Le=0;!function(){try{c(Ie).forEach(function(t,e){-1!==t.indexOf("vplayer-log-")&&Ie.removeItem(t)})}catch(t){}}();var Oe={error:0,warn:1,info:2,log:3,debug:4,verbose:5},Me=function(){var t=this;t.level=4;var e=M.console||0;["log","info","error","warn","debug","verbose"].forEach(function(i){var n=Oe[i];t[i]=function(t,r){r&&"object"==typeof r&&(r=JSON.stringify(r));var o=xe(t,r);if(n<Oe.log&&function(t){var e="vplayer-log-"+Le;dt(function(){try{Ie.setItem(e,t)}catch(t){}}),Le++}(o),!(this.level<n)&&e){for(var s=e[i]||e.log,a=arguments.length,c=new Array(a>2?a-2:0),h=2;h<a;h++)c[h-2]=arguments[h];s.apply(e,[o].concat(c))}}.bind(t)}),t.setLevel=function(t){var e=Oe[t]||0;this.level=e}.bind(t)};Me.GLOBAL_TAG="mango-player",Me.FORCE_GLOBAL_TAG=!1;var $e=new Me,Fe={}.hasOwnProperty,Ne=function(t,e){return Fe.call(t,e)},Ve=function(t,e,i){return null==e?t:t+"="+(i?function(t){try{return encodeURIComponent(t)}catch(t){}return t}(String(e)):e)};var He=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},Be=window,Ue=function(){},We=Be.setImmediate||function(t){return setTimeout(t,1)},ze=function(t){return"function"==typeof t},je=function(){function t(){He(this,t),this._l=new Image,this._r=!1}return t.prototype.load=function(t,e){var i=this;this._r=!0;var n=this._l,r=function(t,r){n.onload=n.onerror=Ue,e(t,r),i.reset()};n.onload=function(t){return r(null,t)},n.onerror=function(t){return r(t)},n.src=t},t.prototype.reset=function(){this._r=!1},t}(),qe=[],Ge=Be.$nextRequest||(Be.$nextRequest=new function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=0,i=t.concurrent||5,n=[],r=function(t,e){var i=t[0],n=t[1],r=t[2],o=n&&function(t,e){if("object"!=typeof t)return t;var i,n,r,o=[];for(i in e=void 0===e?1:0,t)if(Ne(t,i))if((n=t[i])&&"object"==typeof n){if("number"==typeof n.length)for(r=n.length;r--;)o.push(Ve(i,n[r],e))}else o.push(Ve(i,n,e));return o.join("&").replace(/%20/g,"+")}(n),s=i+(o?(~i.indexOf("?")?"&":"?")+o:"");We(function(){return function(){for(var t,e=-1,i=qe.length;++e<i;)if(!(i=qe[e])._r)return i;return t=new je,qe.length<5&&qe.push(t),t}().load(s,function(t,i){if(ze(r))try{r(t,i)}catch(i){}e(t)})})};return{push:function(){var t=function(t){for(var e=t.length,i=Array(e),n=0;n<e;n++)i[n]=t[n];return i}(arguments),o=t[1];2===t.length&&ze(o)&&(t[2]=o,t[1]=null),n.push(t),function t(){if(n.length&&e<i){var o=n.shift();++e,r(o,function(){--e,t()})}}()}}}),Ke=function(t,e,i){return Ge.push.apply(Ge,arguments)};function Ye(t,e){for(var i in e)t=t.replace(e[i].pattern,e[i].value);return t}function Xe(t,e){if((t=t&&"string"==typeof t?[t]:t)&&t.length)for(var i=0,n=t.length;i<n;i++){var r=t[i];e&&(r=Ye(r,e)),Ke(r)}}var Qe=Object.getOwnPropertyDescriptor;function Je(t){if(!t||!t.hasOwnProperty)return!1;for(var e=["value","initializer","get","set"],i=0,n=e.length;i<n;i++)if(t.hasOwnProperty(e[i]))return!0;return!1}function Ze(t){return!!t&&(u(t.get)||u(t.set))&&w(t.configurable)&&w(t.enumerable)&&void 0===t.writable}function ti(t){return!!t&&t.hasOwnProperty("value")&&w(t.configurable)&&w(t.enumerable)&&w(t.writable)}function ei(t){return!!t&&u(t.initializer)&&w(t.configurable)&&w(t.enumerable)&&w(t.writable)}function ii(t,e){if(void 0===e&&(e="You must pass me an array of function"),!d(t)||t.length<1)throw new TypeError(e);if(1===t.length){if(!u(t[0]))throw new TypeError(e);return t[0]}return t.reduce(function(t,i){if(!u(i)||!u(t))throw new TypeError(e);return function(e){return L(i,this)(L(t,this)(e))}})}var ni,ri,oi=(ni=Object.getOwnPropertyNames,u(ri=Object.getOwnPropertySymbols)?function(t){return Array.from(ni(t).concat(ri(t)))}:ni);var si=u(Object.getOwnPropertyDescriptors)?Object.getOwnPropertyDescriptors:function(t){return oi(t).reduce(function(e,i){return e[i]=Qe(t,i),e},{})};function ai(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if(!e.length)throw new TypeError("You must pass in decorators in compressMultipleDecorators");return e.forEach(function(t){if(!u(t))throw new TypeError('Decorators must be a function, but not "'+t+'" in '+typeof t)}),1===e.length?e[0]:function(t,i,n){return e.reduce(function(e,n){return n(t,i,e)},n)}}function ci(t,e){var i=void 0===t?{}:t,n=i.get,r=i.set,o=void 0===e?{}:e,s=o.preGet,a=void 0!==s&&s,c=o.preSet,h=void 0===c||c;if(!(u(n)||u(r)||d(n)&&n.length>0||d(r)&&r.length>0))throw new TypeError("@accessor need a getter or setter. If you don't need to add setter/getter. You should remove @accessor");var l="@accessor only accept function or array of function as getter/setter";return n=d(n)?ii(n,l):n,r=d(r)?ii(r,l):r,function(t,e,i){var o=i||{},s=o.configurable,c=void 0===s||s,l=o.enumerable,d=void 0===l||l,p=u(n),f=u(r),m=function(t){return p?L(n,this)(t):t},v=function(t){return f?L(r,this)(t):t};if(Ze(i)){var g=i.get,y=i.set,_=u(g),w=u(y);return{get:_||p?function(){var t=this,e=L(m,this),i=function(){return _?L(g,t)():void 0};return(a?[e,i]:[i,e]).reduce(function(t,e){return e(t)},void 0)}:void 0,set:w||f?function(t){var e=this,i=L(v,this),n=function(t){return w?L(y,e)(t):t};return(h?[i,n]:[n,i]).reduce(function(t,e){return e(t)},t)}:void 0,configurable:c,enumerable:d}}if(ei(i)){var b,E=i.initializer,T=!1;return{get:function(){var t=L(m,this);return T?t(b):(b=L(E,this)(),T=!0,t(b))},set:function(t){var e=L(v,this);return b=h?e(t):t,T=!0,h||e(b),b},configurable:c,enumerable:d}}var R=(i||{}).value;return{get:function(){return L(m,this)(R)},set:function(t){var e=L(v,this);return R=h?e(t):t,h||e(R),R},configurable:c,enumerable:d}}}function hi(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if(0===e.length)throw new Error("@before accept at least one parameter. If you don't need to preprocess before your function, do not add @before decorators");if(e.length>2&&Je(e[2]))throw new Error("You may use @before straightly, @before return decorators, you should call it before you set it as decorator.");for(var n=e.length-1;n>-1;n--)if(!u(e[n]))throw new TypeError("@before only accept function parameter");return function(t,i,n){var r=n||{},o=r.value,s=r.configurable,a=r.enumerable,c=r.writable;if(!u(o))throw new TypeError('@before can only be used on function, please check the property "'+i+'" is a method or not.');return{value:function(){for(var t=this,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];var s=e.reduce(function(e,i){var n=L(i,t).apply(void 0,e);return void 0===n?e:d(n)?n:[n]},n);return L(o,this).apply(void 0,s)},configurable:s,enumerable:a,writable:c}}}function li(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if(0===e.length)throw new Error("@initialize accept at least one parameter. If you don't need to initialize your value, do not add @initialize.");if(e.length>2&&Je(e[2]))throw new Error("You may use @initialize straightly, @initialize return decorators, you need to call it");var n=ii(e,"@initialize only accept function parameter");return function(t,e,i){if(void 0===i)return{value:L(n,t)(),configurable:!0,writable:!0,enumerable:!0};if(Ze(i)){var r=!1;return ci({get:function(t){return r?t:L(n,this)(t)},set:i.set?function(t){return r=!0,t}:void 0})(t,e,i)}if(ei(i)){var o=i.initializer;return{initializer:function(){return L(n,this)(L(o,this)())},configurable:i.configurable,writable:i.writable,enumerable:i.enumerable}}return{value:L(n,this)(i.value),writable:i.writable,configurable:i.configurable,enumerable:i.enumerable}}}var di=Object.getOwnPropertyDescriptor,ui=Object.defineProperty;function pi(t,e,i,n,r,o){var s=i.configurable,a=i.enumerable,c=o.force,h=o.omit,l=di(n,r);if(void 0!==l){if(h)return;if(!c)throw new Error('"'+e+'" is an existing property, if you want to override it, please set "force" true in @alias option.');if(!l.configurable)throw new Error('property "'+e+'" is unconfigurable.')}ui(n,r,{get:function(){return t[e]},set:function(i){return t[e]=i,e},configurable:s,enumerable:a})}function fi(t,e,i){if(2===arguments.length?_(t)&&(i=e,e=t,t=void 0):1===arguments.length&&(e=t,t=void 0),!_(e))throw new TypeError("@alias need a string as a key to find the porperty to set alias on");var n="If you want to use @alias to set alias on other instance, you must pass in a legal instance";if(void 0!==t&&E(t))throw new TypeError(n);var r=p(i)?i:{force:!1,omit:!1},o=r.force,s=r.omit;return function(i,r,a){function c(t,e,i){var r=E(t)?e:t,o=i.split("."),s=o.slice(-1)[0];if(E(r=O(r,o.slice(0,-1),{throwError:!0})))throw new TypeError(n);return{target:r,name:s}}if(ei(a=a||{value:void 0,configurable:!0,writable:!0,enumerable:!0}))return li(function(i){var n=c(t,this,e),h=n.target,l=n.name;return pi(this,r,a,h,l,{force:o,omit:s}),i})(i,r,a);if(Ze(a)){var h,l=function(i){if(h)return i;var n=c(t,this,e),l=n.target,d=n.name;return pi(this,r,a,l,d,{force:o,omit:s}),h=!0,i};return ci({get:l,set:l})(i,r,a)}var d=c(t,i,e),u=d.target,p=d.name;return pi(i,r,a,u,p,{force:o,omit:s}),a}}var mi=Object.defineProperty;function vi(t,e){var i=void 0===e?{}:e,n=i.requirement,r=i.customArgs,o=void 0!==r&&r;return function(e){for(var i=void 0===e?{}:e,r=i.exclude,s=void 0===r?[]:r,a=i.include,c=void 0===a?[]:a,h=i.construct,p=void 0!==h&&h,f=i.self,m=void 0!==f&&f,v=arguments.length,g=new Array(v>1?v-1:0),y=1;y<v;y++)g[y-1]=arguments[y];if(!d(s))throw new TypeError("options.exclude must be an array");if(!d(c))throw new TypeError("options.include must be an array");return function(e){var i=u(e);if(!m&&!i)throw new TypeError("@"+t.name+"Class can only be used on class");if(m&&E(e))throw new TypeError("@"+t.name+"Class must be used on non-primitive type value in 'self' mode");var r=m?e:e.prototype;if(l(r))throw new Error("The prototype of the "+e.name+" is empty, please check it");var a=si(r);oi(r).concat(c).forEach(function(e){var c=a[e];"constructor"===e&&!p||m&&i&&["name","length","prototype"].indexOf(e)>-1||s.indexOf(e)>-1||u(n)&&!1===n(r,e,c,{self:m})||mi(r,e,(o?t.apply(void 0,g):t)(r,e,c))})}}}var gi,yi=vi(_i,{requirement:function(t,e,i){return ti(i)&&u(i.value)}});function _i(t,e,i){if(1===arguments.length)return yi()(t);var n=i||{},r=n.value,s=n.configurable;if(!u(r))throw new TypeError('@autobind can only be used on functions, not "'+r+'" in '+typeof r+' on property "'+e+'"');var a,c=t.constructor;return{configurable:s,enumerable:!1,get:function(){var i=this,n=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return r.call.apply(r,[i].concat(e))};return this===t?r:this.constructor!==c&&Object.getPrototypeOf(this).constructor===c?r:this.constructor!==c&&e in this.constructor.prototype?function(t,e){if("undefined"==typeof WeakMap)throw new Error("Using @autobind on "+e.name+"() requires WeakMap support due to its use of super."+e.name+"()");gi||(gi=new WeakMap),!1===gi.has(t)&&gi.set(t,new WeakMap);var i=gi.get(t);return!1===i.has(e)&&i.set(e,L(e,t)),i.get(e)}(this,r):(o(this,e,{configurable:!0,writable:!0,enumerable:!1,value:n}),n)},set:(a=e,function(t){return o(this,a,{configurable:!0,writable:!0,enumerable:!0,value:t}),t})}}var wi=Object.defineProperty;function bi(t,e,i){if(void 0===i)return{value:void 0,writable:!1,enumerable:!1,configurable:!1};if(i.enumerable=!1,i.configurable=!1,Ze(i)){var n=i.get;if(i.set=void 0,!u(n))return;return{get:function(){var t=L(n,this)();return wi(this,e,{value:t,writable:!1,configurable:!1,enumerable:!1}),t},set:void 0,configurable:!1,enumerable:!1}}return i.writable=!1,i}var Ei=Object.getOwnPropertyDescriptor,Ti=Object.defineProperty;function Ri(t,e){var i=(void 0===e?{}:e).other;if(!u(t)&&!b(t)&&!_(t))throw new TypeError("@waitUntil only accept Function, Promise or String");return function(e,n,r){var o=r||{},s=o.value,a=o.configurable;if(!u(s))throw new TypeError("@waituntil can only be used on function, but not "+s+' on property "'+n+'"');var c=!1,h=[],d=b(t)?function(){return t}:u(t)?t:function(){var e=t.split("."),n=e.slice(-1),r=E(i)?this:i;if(!c){var o=O(r,e.slice(0,-1));if(l(o))return o;var s=Ei(o,n),a=function(t){if(!0===t)for(;h.length>0;)h[0](),h.shift();return t},d=Je(s)?ci({set:a})(o,n,s):ci({set:a})(o,n,{value:void 0,configurable:!0,enumerable:!0,writable:!0});Ti(o,n,d),c=!0}return O(r,e)};return{value:function(){for(var t=this,e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];var r=L(s,this),o=L(d,this).apply(void 0,i);return b(o)?Promise.resolve(o).then(function(){return L(s,t).apply(void 0,i)}):!0===o?L(s,this).apply(void 0,i):new Promise(function(t){h.push(function(){r.apply(void 0,i),t()})})},enumerable:!1,configurable:a,writable:!1}}}function Ai(t,e,i){return void 0===i?{value:void 0,enumerable:!1,configurable:!0,writable:!0}:(i.enumerable=!1,i)}var Si=Object.defineProperty,ki=Object.getOwnPropertyDescriptor;function Pi(t,e,i){var n=void 0===i?{}:i,r=n.self,o=void 0!==r&&r,s=n.omit,a=void 0!==s&&s,c=u(e);if(c||d(e)){if(!u(t))throw new TypeError("If you want to decorator class, you must pass it a legal class");if(c)e(t);else for(var h=0,f=e.length;h<f;h++){var m=e[h];if(!u(m))throw new TypeError("If you want to decorate an class, you must pass it function or array of function");m(t)}return t}if(!o&&!u(t))throw new TypeError("applyDecorators only accept class as first arguments. If you want to modify instance, you should set options.self true.");if(o&&E(t))throw new TypeError("We can't apply docorators on a primitive value, even in self mode");if(!p(e))throw new TypeError("applyDecorators only accept object as second arguments");var v=o?t:t.prototype;if(l(v))throw new Error("The class muse have a prototype, please take a check");for(var g in e){var y=e[g],_=d(y)?y:[y],w=void 0;try{w=ai.apply(void 0,_)}catch(t){throw new Error("The decorators set on props must be Function or Array of Function")}var b=ki(v,g);if(!b||b.configurable)Si(v,g,w(v,g,b));else if(!a)throw new Error(g+" of "+v+" is unconfigurable")}return t}var Ci=["push","pop","unshift","shift","splice","sort","reverse"];function Di(t,e,i){var n,r=i.diff,o=i.operationPrefix,s={},a=!1,c=new Proxy(t,{get:function(t,i,n){var c=t[i];if(d(t)&&Ci.indexOf(i)>-1)return function(){a=!0,L(c,n).apply(void 0,arguments),a=!1,e()};if(!0===s[i])return c;if(p(c)||d(c)){var h=s[i]||Di(c,e,{diff:r,operationPrefix:o});return s[i]=h,h}return s[i]=!0,c},set:function(t,i,n){var c=t[i],h=p(n)||d(n)?Di(n,e,{diff:r,operationPrefix:o}):n;return t[i]=h,s[i]=!0,!!(a||r&&c===h)||(e(),!0)},deleteProperty:function(t,i){return delete t[i],delete s[i],!!a||(e(),!0)}}),h=((n={})[o+"set"]=[li(function(t){return function(t,e){c[t]=e}}),Ai],n[o+"del"]=[li(function(t){return function(t){delete c[t]}}),Ai],n);return Pi(c,h,{self:!0}),c}function xi(t,e,i){var n,r=this,o=i.operationPrefix,s=i.diff,a={},c=!1;function h(t){var i;return t.reduce(function(t,n){return t[n]=[ci({set:function(t){return i=this[n],t}}),ci({get:function(t){return a[n]?t:((p(t)||d(t))&&xi(t,e,{operationPrefix:o,diff:s}),a[n]=!0,t)},set:function(t){return(p(t)||d(t))&&xi(t,e,{operationPrefix:o,diff:s}),a[n]=!0,c||s&&i===t||e(),t}},{preSet:!1})],t},{})}var l=h(oi(t));if(Pi(t,l,{self:!0,omit:!0}),d(t)){var f=Ci.reduce(function(i,n){return i[n]=[li(function(i){return i=u(i)?i:Array.prototype[n],function(){var n=t.length;if(c=!0,L(i,t).apply(void 0,arguments),c=!1,n<t.length){var r=h(new Array(t.length-n).fill(1).map(function(t,e){return(e+n).toString()}));Pi(t,r,{self:!0,omit:!0})}e()}}),Ai],i},{});Pi(t,f,{self:!0})}var m=((n={})[o+"set"]=[li(function(e){return function(i,n,o){var s=void 0===o?{}:o,a=s.disable,c=s.isNewVal;if(c=c||-1===oi(t).indexOf(i),u(e)&&L(e,r)(i,n,{disable:!0,isNewVal:c}),c){var l=h([i]);Pi(t,l,{self:!0,omit:!0})}a||(t[i]=n)}}),Ai],n[o+"del"]=[li(function(i){return function(n){u(i)?L(i,r)(n):delete t[n],e()}}),Ai],n);return Pi(t,m,{self:!0}),t}function Ii(t,e){var i=void 0===e?{}:e,n=i.other,r=i.backup;if(!u(t)&&!_(t))throw new TypeError("@runnable only accept Function or String");return function(e,i,o){var s=o||{},a=s.value,c=s.configurable;if(!u(a))throw new TypeError("@runnable can only be used on method, but not "+a+' on property "'+i+'".');var h=u(t)?t:function(){var e=t.split(".");return O(E(n)?this:n,e)};return r=u(r)?r:function(){},{value:function(){return!0===L(h,this).apply(void 0,arguments)?L(a,this).apply(void 0,arguments):L(r,this).apply(void 0,arguments)},enumerable:!1,configurable:c,writable:!1}}}function Li(t,e,i){return void 0===i?{value:void 0,enumerable:!0,configurable:!0,writable:!0}:(i.configurable=!0,i)}function Oi(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var n=_(e[0])?e.shift():"";return e.unshift(function(t){return _(t)?t:n}),ci({set:e,get:e})}function Mi(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var n=!!w(e[0])&&e.shift();return e.unshift(function(t){return w(t)?t:n}),ci({set:e,get:e})}function $i(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var n=f(e[0])?e.shift():0;return e.unshift(function(t){return f(t)?t:n}),ci({set:e,get:e})}vi(hi,{requirement:function(t,e,i){return ti(i)&&u(i.value)},customArgs:!0}),vi(function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if(0===e.length)throw new Error("@after accept at least one parameter. If you don't need to preprocess after your function, do not add @after decorators");if(e.length>2&&Je(e[2]))throw new Error("You may have used @after straightly. @after return decorators. You should call it before you use it as decorators");var n=ii(e,"@after only accept function parameter");return function(t,e,i){var r=i||{},o=r.value,s=r.configurable,a=r.enumerable,c=r.writable;if(!u(o))throw new TypeError('@after can only be used on function, please checkout your property "'+e+'" is a method or not.');return{value:function(){var t=L(o,this).apply(void 0,arguments);return L(n,this)(t)},configurable:s,enumerable:a,writable:c}}},{requirement:function(t,e,i){return ti(i)&&u(i.value)},customArgs:!0}),vi(Ii,{requirement:function(t,e,i){return ti(i)&&u(i.value)},customArgs:!0}),vi(Ri,{requirement:function(t,e,i){return ti(i)&&u(i.value)},customArgs:!0});var Fi=0,Ni=function(t){function e(e,i,n){var r;if(r=t.call(this)||this,!R(e))throw new Error("You must pass in an legal video element but not "+typeof e);return r.video=e,r.config=i,r.customConfig=n,r}i(e,t),e.isSupport=function(){return!0};var n=e.prototype;return n.load=function(t,e){var i=this;if(void 0===e&&(e=-1),this.video.setAttribute("src",t),this.video.src=t,-1!=e){var n=function(){i.seek(e),de(i.video,"canplaythrough",n,!0)};ue(this.video,"canplaythrough",n,!0),this.seek(e)}},n.startLoad=function(t,e){void 0===e&&(e=-1);var i=-1!=e?e:this.video.currentTime||Fi;this.load(t,i),this.seek(i)},n.stopLoad=function(){Fi=this.video.currentTime,this.video.src="",this.video.removeAttribute("src")},n.destroy=function(){R(this.video)&&this.stopLoad(),this.removeAllListeners()},n.play=function(){return this.video.play()},n.pause=function(){return this.video.pause()},n.refresh=function(){this.video.src=this.config.src},n.getMetadata=function(){return{}},n.getSpeed=function(){return 0},n.getFps=function(){return 29.9},n.getBufferInfo=function(){},n.attachMedia=function(){},n.seek=function(t){this.video.currentTime=t},e}(te),Vi={isLive:!1,box:"",preset:{},presetConfig:{}},Hi="2.0.1",Bi=function(t,e){return(Bi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};var Ui=function(){return(Ui=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function Wi(t,e,i,n){var r,a=arguments.length,c=a<3?e:null===n?n=s(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,i,n);else for(var h=t.length-1;h>=0;h--)(r=t[h])&&(c=(a<3?r(c):a>3?r(e,i,c):r(e,i))||c);return a>3&&c&&o(e,i,c),c}function zi(t,e,i,n){return new(i||(i=Promise))(function(r,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(s,a)}c((n=n.apply(t,e||[])).next())})}function ji(t,e){var i,n,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var qi,Gi,Ki,Yi,Xi,Qi,Ji=function(){function t(t,e){void 0===e&&(e=!1);var i=this;this.eventMap={},this.ready=!1,this.currentStreamId="",this.initTimeout=0,this.eventMap={},this.ready=!1;var n="string"==typeof t?document.getElementById(t):t;this.element=n,this.flashplayer=this.element.childNodes[0],(window||document).Player=this,this.addEventListener("loaded",this.onReady,this),this.addEventListener("loadedmetadata",this.onMetaData,this),this.initTimeout=setTimeout(function(){i.dispatchEvent("flashInitFail",null),i.removeEvents()},5e3)}var e=t.prototype;return e.onReady=function(){this.ready=!0,clearTimeout(this.initTimeout)},e.getReady=function(){return zi(this,void 0,void 0,function(){var t=this;return ji(this,function(e){return[2,new Promise(function(e){t.ready?e():t.addEventListener("loaded",function(){e()},t)})]})})},e.getProp=function(t){return this.flashplayer?this.flashplayer.getProp(t):null},e.setProp=function(t,e){return this.flashplayer?this.flashplayer.setProp(t,e):null},e.getCurrentTime=function(){return this.ready&&this.flashplayer&&this.flashplayer.getProp?this.flashplayer.getProp("currentTime"):0},e.createStream=function(t){return zi(this,void 0,void 0,function(){var e=this;return ji(this,function(i){return[2,new Promise(function(i){e.addEventListener("streamcreated",function(t){e.removeEvent("streamcreated"),i(t)},e),e.flashplayer.createStream(t)})]})})},e.loadStream=function(t,e,i){return this.flashplayer.loadStream(t,e,i)},e.attachStream=function(t){return this.currentStreamId=t,this.flashplayer.attachStream(t)},e.disposeStream=function(t){return this.flashplayer.disposeStream(t)},e.onMetaData=function(t){this.metadata=t,this.dispatchEvent("metadata",t)},e.eventHandler=function(t,e){this.dispatchEvent(t,e)},e.play=function(){this.flashplayer.play()},e.play2=function(t,e,i){this.flashplayer.play2(t)},e.pause=function(){this.flashplayer.pause()},e.resume=function(){this.flashplayer.resume()},e.stop=function(){this.flashplayer.stop()},e.seek=function(t){this.flashplayer.seek(t)},e.addEventListener=function(t,e,i){void 0===i&&(i=null),null==this.eventMap[t]&&(this.eventMap[t]=[]),this.eventMap[t].some(function(t){return e===t.callback})||this.eventMap[t].push({callback:e,thisIs:i})},e.dispatchEvent=function(t,e){this.eventMap[t]&&this.eventMap[t].forEach(function(t){t.callback.call(t.thisIs,e)})},e.removeEventListener=function(t,e){if(null!=this.eventMap[t])for(var i=0;i<this.eventMap[t].length;i++)if(this.eventMap[t][i].callback===e){this.eventMap[t].splice(i,1);break}},e.removeEvent=function(t){delete this.eventMap[t]},e.removeEvents=function(){this.eventMap={}},e.destroy=function(){},t}(),Zi=function(t){function e(e,i){var n=t.call(this)||this;return n._currentStreamId="",n._nextStreamId="",n._config=i,n.player=new Ji(e,!0),n.player.addEventListener("flashInitFail",n.onFlashInitFail,n),n}!function(t,e){function i(){this.constructor=t}Bi(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}(e,t);var i=e.prototype;return i.onFlashInitFail=function(){this.emit("flashInitFail",{data:{},type:"flashInitFail"})},i.load=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=16/9),zi(this,void 0,void 0,function(){var n;return ji(this,function(r){switch(r.label){case 0:return[4,this.player.getReady()];case 1:return r.sent(),this.player.setProp("ratio",i),this._currentStreamId&&this.player.disposeStream(this._currentStreamId),[4,this.player.createStream(this.getVideoType(t))];case 2:return n=r.sent(),this.player.loadStream(n,t,e),this._currentStreamId=n,this.player.attachStream(n),this.player.play(),[2]}})})},i.play=function(){try{this.player.play()}catch(t){}},i.playNext=function(t){var e=this;return new Promise(function(t,i){if(""!=e._nextStreamId){e._currentStreamId&&e.player.disposeStream(e._currentStreamId),e._currentStreamId=e._nextStreamId,e._nextStreamId="",e.player.attachStream(e._currentStreamId);try{var n=setTimeout(function(){e.player.removeEvent("timeupdate"),clearTimeout(n),i("flash preload play fail.")},1e3);e.player.addEventListener("timeupdate",function(){e.player.getProp("currentTime")>0&&(e.player.removeEvent("timeupdate"),clearTimeout(n),t())}),e.player.play()}catch(t){i("flash player not ready!")}}else i("no perload")})},i.preload=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=!0),zi(this,void 0,void 0,function(){var i;return ji(this,function(n){switch(n.label){case 0:return[4,this.player.getReady()];case 1:return n.sent(),[4,this.player.createStream(this.getVideoType(t))];case 2:return i=n.sent(),this.player.loadStream(i,t,e),this._nextStreamId=i,[2]}})})},i.startLoad=function(t,e){void 0===e&&(e=-1);var i=-1!=e?e:0;this.load(t,i)},i.refresh=function(){this.load(this._config.src,0)},i.stopLoad=function(){},i.getMetadata=function(){return this.player.metadata},i.getSpeed=function(){return this.player.getProp("currentBytesPerSecond")/8e3},i.getVideoType=function(t){return-1!=t.indexOf(".m3u8")?"hls":-1!=t.indexOf(".mp4")||-1!=t.indexOf(".flv")?"mp4":"auto"},i.seek=function(t){this.player.seek(t)},i.pause=function(){this.player.pause()},Object.defineProperty(i,"currentTime",{get:function(){return this.player.getCurrentTime()},enumerable:!0,configurable:!0}),i.getBufferInfo=function(){return{len:this.player.getProp("buffered")-this.player.getProp("currentTime")}},i.getFps=function(){return this.player.element.currentFPS||0},i.destroy=function(){return this.player.destroy()},e}(zt),tn="mango-kernel",en={flv:".flv",hls:".m3u8",flash:".m3u8",dash:".mpd",mp4:".mp4"},nn=["mediaInfo","heartbeat","hlsSegmentLoaded","hlsBufferFull","hlsBufferEmpty","hlsRecoverStreamError","hlsStreamError","hlsLevelSwitched","dashBufferEmpty","dashBufferFull","dashStreamError","dashRecoverStreamError","dashLicenseRequest","error","stats","flashInitFail"],rn=(r((qi=function(t){function n(e,i){var n;if((n=t.call(this)||this).VERSION=Hi,!R(e))throw new Error("You must pass in an video element to the mango-kernel");return n.config=x({},Vi,i),n.videoElement=e,n.initVideoKernel(),n.bindEvents(n.videoKernel),n}i(n,t);var r=n.prototype;return r.destroy=function(){this.bindEvents(this.videoKernel,!0),this.videoKernel.destroy(),this.removeAllListeners()},r.initVideoKernel=function(){var t=this.config,e=this.chooseBox(t);this.box=e;var i=this.chooseVideoKernel(this.box,t.preset);if(!u(i))throw new Error("We can't find video kernel for "+e+". Please check your config and make sure it's installed or provided");var n=t.presetConfig[this.box];n&&x(t,n),this.videoKernel=new i(this.videoElement,t,n)},r.chooseBox=function(t){var e=t.src,i=t.box;if(_(i)&&i)return i;for(var n in e=e.toLowerCase(),en){var r=en[n];if(e.indexOf(r)>-1)return n}return"native"},r.playNext=function(t){return this.videoKernel.playNext?this.videoKernel.playNext(t):Promise.reject("kernal not support preload.")},r.chooseVideoKernel=function(t,e){switch(t){case"flash":return Zi;case"native":return Ni;case"mp4":return this.getMp4Kernel(e.mp4);case"flv":case"dash":case"hls":return e[t];default:throw new Error("We currently do not support box "+t)}},r.getMp4Kernel=function(t){var e=t&&u(t.isSupport);return e&&t.isSupport()?t:(e&&this.warnLog("mp4 decode is not support in this browser, we will switch to the native video kernel"),this.box="native",Ni)},r.attachMedia=function(){this.videoKernel.attachMedia()},r.load=function(t,e,i,n){void 0===t&&(t=this.config.src),void 0===e&&(e=-1),this.config.src=t,this.videoKernel.load(t,e,i,n)},r.preload=function(t,e,i){void 0===t&&(t=this.config.src),void 0===e&&(e=-1),this.config.src=t,this.videoKernel.preload(t,e,i)},r.loadLevel=function(t){if(!u(this.videoKernel.loadLevel))throw new Error("This video kernel do not support loadLevel");return this.videoKernel.loadLevel(t)},r.startLoad=function(t){if(void 0===t&&(t=-1),!u(this.videoKernel.startLoad))throw new Error("This video kernel do not support startLoad");this.videoKernel.startLoad(this.config.src,t)},r.stopLoad=function(){u(this.videoKernel.stopLoad)&&this.videoKernel.stopLoad()},r.play=function(){this.videoKernel.play()},r.pause=function(){this.videoKernel.pause()},r.seek=function(t){t=f(t)?t:~~t,f(t)?this.videoKernel.seek(t):this.errorLog("When you try to seek, you must offer us a number, but not "+typeof t)},r.refresh=function(){this.videoKernel.refresh()},r.on=function(t,e){this.videoKernel.on(t,e)},r.off=function(t,e){this.videoKernel.off(t,e)},r.errorLog=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this.emit("error",new Error(e[0])),$e.error.apply($e,[tn].concat(e))},r.warnLog=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return $e.warn.apply($e,[tn].concat(e))},r.handleEvent=function(t){var e=t.type,i=t.data;this.emit(e,i)},r.bindEvents=function(t,e){var i=this;void 0===e&&(e=!1),nn.forEach(function(n){return t[e?"off":"on"](n,i.handleEvent)})},e(n,[{key:"currentTime",get:function(){return this.videoKernel.currentTime||this.videoElement.currentTime||0}},{key:"metadata",get:function(){return this.videoKernel.getMetadata()}},{key:"downloadSpeed",get:function(){return this.videoKernel.getSpeed()}},{key:"fps",get:function(){return this.videoKernel.getFps()}},{key:"bufferInfo",get:function(){return this.videoKernel.getBufferInfo()}},{key:"stats",get:function(){return"hls"===this.box?this.videoKernel.stats:null}}]),n}(te)).prototype,"handleEvent",[_i],s(qi.prototype,"handleEvent"),qi.prototype),qi),on=["abort","canplay","canplaythrough","durationchange","emptied","encrypted","ended","error","interruptbegin","interruptend","loadeddata","loadedmetadata","loadstart","mozaudioavailable","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],sn=["buffered","currentSrc","duration","error","ended","networkState","paused","readyState","seekable","sinkId","controlsList","tabIndex","dataset","offsetHeight","offsetLeft","offsetParent","offsetTop","offsetWidth"],an=["beforeinput","blur","click","compositionend","compositionstart","compositionupdate","dblclick","focus","focusin","focusout","input","keydown","keypress","keyup","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","resize","scroll","select","wheel","mousewheel","fullscreenchange","contextmenu","touchstart","touchmove","touchend"],cn=["keydown","keypress","keyup","click","touchstart","touchmove","touchend"],hn=["wheel","mousewheel","touchstart","touchmove"],ln=["loadLevel","silentLoad","preload","fullscreen"],dn=["playNext","play","pause","seek","refresh","startLoad","stopLoad"],un=["load"],pn=["focus","fullscreen","requestFullscreen","exitFullscreen"],fn=["canPlayType","captureStream","setSinkId"],mn=/^(before|after|_)/;function vn(t){return!t.match(mn)}var gn,yn,_n,wn,bn,En,Tn,Rn,An=(Gi=Ii(vn),Ki=Ii(vn,{backup:function(){return!1}}),Yi=Ii(vn),Xi=Ii(vn,{backup:function(){return!1}}),r((Qi=function(){function t(t){this.events={},this.onceMap={},this.__dispatcher=t}var e=t.prototype;return e.on=function(t,e,i){var n=this._getEventStage(e),r=n.stage,o=n.key;this._addEvent([o,r,t],i)},e.off=function(t,e,i){var n=this._getEventStage(e),r=n.stage,o=[n.key,r,t];if(!this._removeEvent(o,i)){var s=this._getHandlerFromOnceMap(o,i);u(s)&&this._removeEvent(o,s)&&this._removeFromOnceMap(o,i,s)}},e.once=function(t,e,i){var n=this._getEventStage(e),r=n.stage,o=n.key,s=this,a=[o,r,t],c=function(){L(i,this).apply(void 0,arguments),s._removeEvent(a,c),s._removeFromOnceMap(a,i,c)};this._addEvent(a,c),this._addToOnceMap(a,i,c)},e.emit=function(t){for(var e=this,i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var o=this.events[t];if(g(o))return ln.indexOf(t)>-1?Promise.resolve():this._eventProcessor.apply(this,[t,{sync:!1}].concat(n));var s=this._getEventQueue(o.before,this.__dispatcher.order);return ot.apply(void 0,[s].concat(n)).then(function(){if(!(ln.indexOf(t)>-1))return e._eventProcessor.apply(e,[t,{sync:!1}].concat(n))}).catch(function(t){return S(t)&&e.__dispatcher.throwError(t),Promise.reject(t)})},e.emitSync=function(t){for(var e=this.events[t],i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];if(g(e))return ln.indexOf(t)>-1||this._eventProcessor.apply(this,[t,{sync:!0}].concat(n));var o=this._getEventQueue(e.before,this.__dispatcher.order);return st.apply(void 0,[o].concat(n))&&(ln.indexOf(t)>-1||this._eventProcessor.apply(this,[t,{sync:!0}].concat(n)))},e.trigger=function(t){for(var e=this,i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var o=this.events[t];if(g(o))return Promise.resolve(!0);var s=this._getEventQueue(o.main,this.__dispatcher.order);return ot.apply(void 0,[s].concat(n)).then(function(){var t=e._getEventQueue(o.after,e.__dispatcher.order);return ot.apply(void 0,[t].concat(n))}).then(function(){return e._runSideEffectEvent.apply(e,[t,e.__dispatcher.order].concat(n))}).catch(function(i){return S(i)&&e.__dispatcher.throwError(i),e._runSideEffectEvent.apply(e,[t,e.__dispatcher.order].concat(n))})},e.triggerSync=function(t){var e=this.events[t];if(g(e))return!0;for(var i=this._getEventQueue(e.main,this.__dispatcher.order),n=this._getEventQueue(e.after,this.__dispatcher.order),r=arguments.length,o=new Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];var a=st.apply(void 0,[i].concat(o))&&st.apply(void 0,[n].concat(o));return this._runSideEffectEvent.apply(this,[t,this.__dispatcher.order].concat(o)),a},e.destroy=function(){delete this.events,delete this.__dispatcher},e._addEvent=function(t,e){var i=(t=D(t)).pop(),n=t.reduce(function(t,e){return t[e]=t[e]||{},t[e]},this.events);n[i]=n[i]||[],n[i].push(e)},e._removeEvent=function(t,e){for(var i=(t=D(t)).pop(),n=this.events,r=0,o=t.length;r<o;r++){var s=n[t[r]];if(g(s))return;n=s}var a=n[i]||[],c=a.indexOf(e),h=c>-1;return h&&a.splice(c,1),a.length<1&&delete n[i],h},e._addToOnceMap=function(t,e,i){var n=t.join("-"),r=this.onceMap[n]=this.onceMap[n]||new Map;r.has(e)||r.set(e,[]),r.get(e).push(i)},e._removeFromOnceMap=function(t,e,i){var n=t.join("-"),r=this.onceMap[n],o=r.get(e),s=o.indexOf(i);o.splice(s,1),g(o)&&r.delete(e)},e._getHandlerFromOnceMap=function(t,e){var i=t.join("-"),n=this.onceMap[i];if(!l(n)&&n.has(e))return n.get(e)[0]},e._getEventStage=function(t){var e=t.match(mn),i=e&&e[0]||"main";return e&&(t=I(t.replace(mn,""))),{stage:i,key:t}},e._getEventQueue=function(t,e){var i=this;return e=d(e)?e.concat(["_vm"]):["_vm"],g(t)?[]:e.reduce(function(e,n){return g(t[n])||!d(t[n])||!i.__dispatcher.plugins[n]&&"_vm"!==n?e:e.concat(t[n].map(function(t){return L(t,i.__dispatcher.plugins[n]||i.__dispatcher.vm)}))},[])},e._eventProcessor=function(t,e){for(var i=e.sync,n=dn.indexOf(t)>-1,r=pn.indexOf(t)>-1,o=un.indexOf(t)>-1,s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];if(n||r||o){var h,l;if(o)(h=this.__dispatcher)[t].apply(h,a);else(l=this.__dispatcher[n?"kernel":"dom"])[t].apply(l,a);if(on.indexOf(t)>-1||an.indexOf(t)>-1)return!0}return this[i?"triggerSync":"trigger"].apply(this,[t].concat(a))},e._runSideEffectEvent=function(t,e){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];var o=this.events[t];return!g(o)&&(this._getEventQueue(o._,e).forEach(function(t){return t.apply(void 0,n)}),!0)},t}()).prototype,"emit",[Gi],s(Qi.prototype,"emit"),Qi.prototype),r(Qi.prototype,"emitSync",[Ki],s(Qi.prototype,"emitSync"),Qi.prototype),r(Qi.prototype,"trigger",[Yi],s(Qi.prototype,"trigger"),Qi.prototype),r(Qi.prototype,"triggerSync",[Xi],s(Qi.prototype,"triggerSync"),Qi.prototype),Qi);function Sn(t,e){if(!_(t))throw new TypeError("key parameter must be String");if(!u(e))throw new TypeError("fn parameter must be Function")}function kn(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return e.length>2?["set"].concat(e):2===e.length?["video","container","wrapper","videoElement"].indexOf(e[0])>-1?["get"].concat(e):["set","container"].concat(e):["get","container"].concat(e)}function Pn(t){return _(t)?t:void 0}function Cn(t){return ci({get:function(e){return this.dispatcher.videoConfigReady&&this.inited?this.dom.videoElement[t]:e},set:function(e){return this.dispatcher.videoConfigReady?(this.dom.videoElement[t]=e,e):e}})}function Dn(t){var e=p(t)?t:{set:t,get:t,isBoolean:!1},i=e.set,n=e.get,r=e.isBoolean;return ci({get:function(t){return this.dispatcher.videoConfigReady&&this.inited?this.dom.videoElement[n]:t},set:function(t){if(!this.dispatcher.videoConfigReady)return t;var e=r?t?"":void 0:null===t?void 0:t;return this.dom.setAttr("video",i,e),t}},{preSet:!1})}function xn(t,e){return ci({get:function(i){var n=this.dom.getAttr("video",t);return this.dispatcher.videoConfigReady&&this.inited?e?!!n:n:i},set:function(i){if(!this.dispatcher.videoConfigReady)return i;var n=e?i||void 0:null===i?void 0:i;return this.dom.setAttr("video",t,n),i}})}function In(t){return ci({get:function(e){if(!this.dispatcher.videoConfigReady||!this.inited)return e;var i=this.dom.getAttr("video",t),n=this.dom.videoElement[t];return m(i)&&f(n)?n:i||void 0},set:function(e){return this.dispatcher.videoConfigReady?(void 0===e||f(e)?i=e:_(e)&&!Number.isNaN(parseFloat(e))&&(i=e),this.dom.setAttr("video",t,i),i):e;var i}})}var Ln,On={src:[Oi(),ci({set:function(t){return this.dispatcher.readySync&&this.autoload&&t!==this.src&&(this.needToLoadSrc=!0),t}}),ci({set:function(t){return this.needToLoadSrc&&(this.needToLoadSrc=!1,this.dispatcher.bus.emit("load",t)),t}},{preSet:!1})],autoload:Mi(),autoplay:[Mi(),Cn("autoplay")],controls:[Mi(),Cn("controls")],width:[In("width")],height:[In("height")],crossOrigin:[ci({set:Pn}),Dn({set:"crossorigin",get:"crossOrigin"})],loop:[Mi(),Cn("loop")],defaultMuted:[Mi(),Dn({get:"defaultMuted",set:"muted",isBoolean:!0})],muted:[Mi(),Cn("muted")],preload:[ci({set:function(t){return["none","auto","metadata",""].indexOf(t)>-1?t:"none"}},{preSet:!0}),Dn("preload")],poster:[Oi(),ci({get:function(t){return this.dispatcher.videoConfigReady&&this.inited&&this.dom.videoElement.poster||t},set:function(t){return this.dispatcher.videoConfigReady?(t.length&&this.dom.setAttr("video","poster",t),t):t}})],playsInline:[ci({get:function(t){var e=this.dom.videoElement.playsInline;return this.dispatcher.videoConfigReady&&this.inited?void 0===e?t:e:t},set:function(t){if(!this.dispatcher.videoConfigReady)return t;this.dom.videoElement.playsInline=t;var e=t?"":void 0;return this.dom.setAttr("video","playsinline",e),this.dom.setAttr("video","webkit-playsinline",e),this.dom.setAttr("video","x5-playsinline",e),t}}),Mi()],x5VideoPlayerFullscreen:[ci({set:function(t){return!!t},get:function(t){return!!t}}),xn("x5-video-player-fullscreen",!0)],x5VideoOrientation:[ci({set:Pn}),xn("x5-video-orientation")],x5VideoPlayerType:[ci({set:function(t){if(!this.dispatcher.videoConfigReady)return t;var e="h5"===t?"h5":void 0;return this.dom.setAttr("video","x5-video-player-type",e),t},get:function(){return this.dom.getAttr("video","x5-video-player-type")?"h5":void 0}})],xWebkitAirplay:[ci({set:function(t){return!!t},get:function(t){return!!t}}),xn("x-webkit-airplay",!0)],playbackRate:[$i(1),Cn("playbackRate")],defaultPlaybackRate:[Cn("defaultPlaybackRate"),$i(1)],disableRemotePlayback:[Mi(),Cn("disableRemotePlayback")],volume:[$i(1),Cn("volume")]},Mn=(gn=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var n=!!w(e[0])&&e.shift();return e.unshift(function(t){return w(t)?t:n}),li.apply(void 0,e)}(),yn=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var n=_(e[0])?e.shift():"";return e.unshift(function(t){return _(t)?t:n}),li.apply(void 0,e)}(function(t){return t.toLocaleLowerCase()}),wn=r((_n=function(){function t(t,e){n(this,"needToLoadSrc",wn,this),n(this,"changeWatchable",bn,this),n(this,"inited",En,this),this.src="",n(this,"isLive",Tn,this),n(this,"box",Rn,this),this.preset={},this.presetConfig={},this.autoload=!0,this.autoplay=!1,this.controls=!1,this.width="100%",this.height="100%",this.crossOrigin=void 0,this.loop=!1,this.defaultMuted=!1,this.muted=!1,this.preload="auto",this.poster=void 0,this.playsInline=!1,this.x5VideoPlayerFullscreen=!1,this.x5VideoOrientation=void 0,this.x5VideoPlayerType=void 0,this.xWebkitAirplay=!1,this.playbackRate=1,this.defaultPlaybackRate=1,this.disableRemotePlayback=!1,this.volume=1,this._kernelProperty=["isLive","box","preset","kernels","presetConfig"],this._realDomAttr=["src","controls","width","height","crossOrigin","loop","muted","preload","poster","autoplay","playsInline","x5VideoPlayerFullscreen","x5VideoOrientation","xWebkitAirplay","playbackRate","defaultPlaybackRate","autoload","disableRemotePlayback","defaultMuted","volume","x5VideoPlayerType"],Pi(this,On,{self:!0}),o(this,"dispatcher",{value:t,enumerable:!1,writable:!1,configurable:!1}),o(this,"dom",{value:t.dom,enumerable:!1,writable:!1,configurable:!1}),this.set(e)}var e=t.prototype;return e.init=function(){var t=this;this._realDomAttr.forEach(function(e){t[e]=t[e]}),this.inited=!0},e.set=function(t,e){p(t)?x(this,t):this[t]=e},e.get=function(t,e){return wt(this,t,e)},t}()).prototype,"needToLoadSrc",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bn=r(_n.prototype,"changeWatchable",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),En=r(_n.prototype,"inited",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Tn=r(_n.prototype,"isLive",[gn,Li],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Rn=r(_n.prototype,"box",[yn,Li],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),_n),$n=function(){function t(){this.__events={},this.__unwatchHandlers=[]}var e=t.prototype;return e.__wrapAsVideo=function(t){var e=this;sn.forEach(function(t){Object.defineProperty(e,t,{get:function(){return this.__dispatcher.dom.videoElement[t]},set:void 0,configurable:!1,enumerable:!1})}),fn.forEach(function(t){Object.defineProperty(e,t,{get:function(){var e=this.__dispatcher.dom.videoElement;return L(e[t],e)},set:void 0,configurable:!1,enumerable:!1})}),Pi(this,t._realDomAttr.concat(t._kernelProperty).reduce(function(e,i){return e[i]=[ci({get:function(){return t[i]},set:function(e){return t[i]=e,e}}),Ai],e},{}),{self:!0}),dn.forEach(function(t){Object.defineProperty(e,t,{value:function(){for(var e=this,i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];return new Promise(function(n){var r;e.__dispatcher.bus.once(e.__id,"_"+t,n),(r=e.__dispatcher.bus)[/^(seek)$/.test(t)?"emitSync":"emit"].apply(r,[t].concat(i))})},configurable:!0,enumerable:!1,writable:!0})}),pn.forEach(function(t){"fullscreen"!==t&&Object.defineProperty(e,t,{value:function(){for(var e,i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];return(e=this.__dispatcher.dom)[t].apply(e,i)},configurable:!0,enumerable:!1,writable:!0})})},Object.defineProperty(e,"currentTime",{get:function(){return this.__dispatcher.kernel.currentTime},set:function(t){this.__dispatcher.bus.emitSync("seek",t)},enumerable:!0,configurable:!0}),Object.defineProperty(e,"metadata",{get:function(){return this.__dispatcher.kernel.metadata},enumerable:!0,configurable:!0}),Object.defineProperty(e,"downloadSpeed",{get:function(){return this.__dispatcher.kernel.downloadSpeed},enumerable:!0,configurable:!0}),Object.defineProperty(e,"fps",{get:function(){return this.__dispatcher.kernel.fps},enumerable:!0,configurable:!0}),Object.defineProperty(e,"bufferInfo",{get:function(){return this.__dispatcher.kernel.bufferInfo},enumerable:!0,configurable:!0}),Object.defineProperty(e,"stats",{get:function(){return this.__dispatcher.kernel.stats},enumerable:!0,configurable:!0}),e.$watch=function(t,e,i){var n,r=this,o=void 0===i?{}:i,s=o.deep,a=o.diff,c=void 0===a||a,h=o.other,l=o.proxy,f=void 0!==l&&l;if(!_(t)&&!d(t))throw new TypeError("$watch only accept string and Array<string> as key to find the target to spy on, but not "+t+", whose type is "+typeof t);var m=!0,v=function(){m=!1;var t=r.__unwatchHandlers.indexOf(v);t>-1&&r.__unwatchHandlers.splice(t,1)},g=_(t)?t.split("."):t,y=g.pop(),w=this.__dispatcher.videoConfig;return Pi(0===g.length&&!h&&w._realDomAttr.indexOf(y)>-1?w:["isFullscreen","fullscreenElement"].indexOf(y)>-1?this.__dispatcher.dom:O(h||this,g,{throwError:!0}),((n={})[y]=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var n=p(e[e.length-1])?e[e.length-1]:{},r=n.deep,o=n.omit,s=n.other,a=n.operationPrefix,c=void 0===a?"__":a,h=n.diff,l=void 0===h||h,f=n.proxy;if("function"!=typeof Proxy&&(f=!1),!e.length)throw new TypeError("You must pass a function or a string to find the hanlder function.");if(void 0!==s&&E(s))throw new TypeError("If you want us to trigger function on the other instance, you must pass in a legal instance");if(!_(c))throw new TypeError("operationPrefix must be an string");return function(t,i,n){var a,h,m,v=e.reduce(function(i,n,r){if(!_(n)&&!u(n)){if(!r||r!==e.length-1)throw new TypeError("You can only pass function or string as handler");return i}return i.push(_(n)?function(e,i){var r=O(s||t,n);if(u(r))return L(r,this)(e,i);if(!o)throw new Error("You pass in a function for us to trigger, please ensure the property to be a function or set omit flag true")}:n),i},[]),g=function(t,e){var i=this;v.forEach(function(n){return L(n,i)(t,e)})},y=!1;return ai(ci({set:function(t){var e=this;a=this[i],m=void 0;var n=function(){return L(g,e)(h,a)};return r&&(p(t)||d(t))?f?Di(t,n,{diff:l,operationPrefix:c}):xi(t,n,{operationPrefix:c,diff:l}):t},get:function(t){var e=this;if(m)return m;if(!y){y=!0;var i=function(){return L(g,e)(h,a)};if(r&&(p(t)||d(t))){if(f)return m=Di(t,i,{diff:l,operationPrefix:c}),a=m,h=m,m;xi(t,i,{operationPrefix:c,diff:l})}a=t,h=t}return t}},{preSet:!0}),ci({set:function(t){return h=t,l&&a===t||L(g,this)(h,a),a=t,t}},{preSet:!1}))(t,i,n)}}(function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];!m||this instanceof Mn&&!this.dispatcher.changeWatchable||L(e,this).apply(void 0,t)},{deep:s,diff:c,proxy:f}),n),{self:!0}),this.__unwatchHandlers.push(v),v},e.$set=function(t,e,i){if(!p(t)&&!d(t))throw new TypeError("$set only support Array or Object, but not "+t+", whose type is "+typeof t);u(t.__set)?t.__set(e,i):t[e]=i},e.$del=function(t,e){if(!p(t)&&!d(t))throw new TypeError("$del only support Array or Object, but not "+t+", whose type is "+typeof t);u(t.__del)?t.__del(e):delete t[e]},e.load=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return new Promise(function(i){var n;t.__dispatcher.bus.once(t.__id,"_load",i),(n=t.__dispatcher.bus).emit.apply(n,["load"].concat(e))})},e.$silentLoad=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return this.__dispatcher.bus.emit("silentLoad").then(function(){var i;return(i=t.__dispatcher).silentLoad.apply(i,e)}).then(function(e){t.__dispatcher.bus.trigger("silentLoad",e)})},e.$preLoadAd=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return this.__dispatcher.bus.emit("preLoadAd").then(function(){var i;return(i=t.__dispatcher).preLoadAd.apply(i,e)}).then(function(e){t.__dispatcher.bus.trigger("preLoadAd",e)})},e.$playNextAd=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return this.__dispatcher.bus.emit("playNextAd").then(function(){var i;return(i=t.__dispatcher).playNextAd.apply(i,e)}).then(function(e){t.__dispatcher.bus.trigger("playNextAd",e)})},e.$preLoad=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return this.__dispatcher.bus.emit("preLoad").then(function(){var i;return(i=t.__dispatcher).preLoad.apply(i,e)}).then(function(e){t.__dispatcher.bus.trigger("preLoad",e)})},e.$load2=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return this.__dispatcher.bus.emit("load2").then(function(){var i;return(i=t.__dispatcher).load2.apply(i,e)}).then(function(e){return t.__dispatcher.bus.trigger("load2",e),e})},e.$switchKernel=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return this.__dispatcher.bus.emit("switchKernel").then(function(){var i;return(i=t.__dispatcher).switchKernel.apply(i,e)}).then(function(e){t.__dispatcher.bus.trigger("switchKernel",e)})},e.$loadLevel=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return this.__dispatcher.bus.emit("loadLevel").then(function(){var i;return(i=t.__dispatcher).loadLevel.apply(i,e)}).then(function(e){t.__dispatcher.bus.trigger("loadLevel",e)})},e.$fullscreen=function(t,e){if(void 0===t&&(t=!0),void 0===e&&(e="container"),!this.__dispatcher.bus.emitSync("fullscreen",t,e))return!1;var i=this.__dispatcher.dom.fullscreen(t,e);return this.__dispatcher.bus.triggerSync("fullscreen",t,e),i},e.$emit=function(t){for(var e,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];if(!_(t))throw new TypeError("emit key parameter must be String");(e=this.__dispatcher.bus).emit.apply(e,[t].concat(i))},e.$emitSync=function(t){for(var e,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];if(!_(t))throw new TypeError("emitSync key parameter must be String");return(e=this.__dispatcher.bus).emitSync.apply(e,[t].concat(i))},e.$on=function(t,e){this.__dispatcher.bus.on(this.__id,t,e),this.__addEvents(t,e)},e.$off=function(t,e){this.__dispatcher.bus.off(this.__id,t,e),this.__removeEvents(t,e)},e.$once=function(t,e){var i=this,n=function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];L(e,this).apply(void 0,r),i.__removeEvents(t,n)};i.__addEvents(t,n),this.__dispatcher.bus.once(this.__id,t,n)},e.$css=function(t){for(var e,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];return(e=this.__dispatcher.dom)[t+"Style"].apply(e,i)},e.$attr=function(t){for(var e,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];if("set"===t&&/video/.test(i[0])){if(!this.__dispatcher.videoConfigReady)return i[2];if(this.__dispatcher.videoConfig._realDomAttr.indexOf(i[1])>-1){var r=i[1],o=i[2];return this.__dispatcher.videoConfig[r]=o,o}}return(e=this.__dispatcher.dom)[t+"Attr"].apply(e,i)},Object.defineProperty(e,"$plugins",{get:function(){return this.__dispatcher.plugins},enumerable:!0,configurable:!0}),Object.defineProperty(e,"$pluginOrder",{get:function(){return this.__dispatcher.order},enumerable:!0,configurable:!0}),Object.defineProperty(e,"$wrapper",{get:function(){return this.__dispatcher.dom.wrapper},enumerable:!0,configurable:!0}),Object.defineProperty(e,"$container",{get:function(){return this.__dispatcher.dom.container},enumerable:!0,configurable:!0}),Object.defineProperty(e,"$video",{get:function(){return this.__dispatcher.dom.videoElement},enumerable:!0,configurable:!0}),Object.defineProperty(e,"isFullscreen",{get:function(){return this.__dispatcher.dom.isFullscreen},enumerable:!0,configurable:!0}),Object.defineProperty(e,"fullscreenElement",{get:function(){return this.__dispatcher.dom.fullscreenElement},enumerable:!0,configurable:!0}),Object.defineProperty(e,"container",{get:function(){return this.__dispatcher.containerConfig},set:function(t){if(!p(t))throw new Error("The config of container must be Object, but not "+typeof t+".");return x(this.__dispatcher.containerConfig,t),this.__dispatcher.container},enumerable:!0,configurable:!0}),e.__addEvents=function(t,e){this.__events[t]=this.__events[t]||[],this.__events[t].push(e)},e.__removeEvents=function(t,e){if(!g(this.__events[t])){var i=this.__events[t].indexOf(e);i<0||(this.__events[t].splice(i,1),g(this.__events[t])&&delete this.__events[t])}},e.__destroy=function(){var t=this;this.__unwatchHandlers.forEach(function(t){return t()}),Object.keys(this.__events).forEach(function(e){d(t.__events[e])&&t.__events[e].forEach(function(i){return t.$off(e,i)})}),delete this.__events},Wi([fi("silentLoad")],t.prototype,"$silentLoad",null),Wi([fi("preLoadAd")],t.prototype,"$preLoadAd",null),Wi([fi("playNextAd")],t.prototype,"$playNextAd",null),Wi([fi("preLoad")],t.prototype,"$preLoad",null),Wi([fi("load2")],t.prototype,"$load2",null),Wi([fi("switchKernel")],t.prototype,"$switchKernel",null),Wi([fi("loadLevel")],t.prototype,"$loadLevel",null),Wi([fi("fullScreen")],t.prototype,"$fullscreen",null),Wi([fi("emit")],t.prototype,"$emit",null),Wi([fi("emitSync")],t.prototype,"$emitSync",null),Wi([fi("on"),fi("addEventListener"),hi(Sn)],t.prototype,"$on",null),Wi([fi("off"),fi("removeEventListener"),hi(Sn)],t.prototype,"$off",null),Wi([fi("once"),hi(Sn)],t.prototype,"$once",null),Wi([fi("css"),hi(kn)],t.prototype,"$css",null),Wi([fi("attr"),hi(kn)],t.prototype,"$attr",null),Wi([Ai],t.prototype,"$plugins",null),Wi([Ai],t.prototype,"$pluginOrder",null),Wi([Ai],t.prototype,"$wrapper",null),Wi([Ai],t.prototype,"$container",null),Wi([Ai],t.prototype,"$video",null),t=Wi([yi()],t)}(),Fn=yi()(Ln=function(t){function n(e,i,n){var r,s=void 0===e?{}:e,a=s.id,h=s.name,l=s.level,d=void 0===l?0:l,f=s.operable,m=void 0===f||f,y=s.beforeCreate,b=s.create,E=s.init,T=s.inited,R=s.destroy,A=s.events,S=void 0===A?{}:A,k=s.data,P=void 0===k?{}:k,C=s.computed,D=void 0===C?{}:C,I=s.methods,O=void 0===I?{}:I,M=s.el,$=s.penetrate,F=void 0!==$&&$,N=s.inner,V=void 0===N||N,H=s.autoFocus,B=s.className;if(void 0===n&&(n={name:h}),(r=t.call(this)||this).destroyed=!1,r.VERSION="6.2.6-eaa0bbd",r.__operable=!0,r.__level=0,g(i))throw new TypeError("lack of dispatcher");if(!_(a))throw new TypeError("id of PluginConfig must be string");r.__id=a,r.__dispatcher=i,r.$videoConfig=r.__dispatcher.videoConfig,r.__wrapAsVideo(r.$videoConfig),r.beforeCreate=r.beforeCreate||y;try{u(r.beforeCreate)&&r.beforeCreate({events:S,data:P,computed:D,methods:O},n)}catch(t){r.$throwError(t)}if(!g(O)&&p(O)&&c(O).forEach(function(t){var e=O[t];if(!u(e))throw new TypeError("plugins methods must be Function");o(r,t,{value:L(e,r),writable:!0,enumerable:!1,configurable:!0})}),!g(S)&&p(S)&&c(S).forEach(function(t){if(!u(S[t]))throw new TypeError("plugins events hook must bind with Function");r.$on(t,S[t])}),!g(P)&&p(P)&&x(r,P),!g(D)&&p(D)){var U=c(D).reduce(function(t,e){var i=D[e];return u(i)?(t[e]=ci({get:i}),t):p(i)&&(u(i.get)||u(i.set))?(t[e]=ci(i),t):t},{});Pi(r,U,{self:!0})}r.create=r.create||b,r.init=r.init||E,r.inited=r.inited||T,r.destroy=r.destroy||R,r.$dom=r.__dispatcher.dom.insertPlugin(r.__id,M,{penetrate:F,inner:V,autoFocus:H,className:B}),r.$inner=V,r.$autoFocus=H,r.$penetrate=F,Pi(r,{$inner:bi,$autoFocus:bi,$penetrate:bi},{self:!0}),r.$operable=w(n.operable)?n.operable:m,r.__level=v(n.level)?n.level:d,r.$config=n;try{u(r.create)&&r.create()}catch(t){r.$throwError(t)}return r}i(n,t);var r=n.prototype;return r.__init=function(t){try{u(this.init)&&this.init(t)}catch(t){this.$throwError(t)}},r.__inited=function(){var t,e=this;try{t=u(this.inited)&&this.inited()}catch(t){this.$throwError(t)}return this.readySync=!b(t),this.ready=this.readySync?Promise.resolve():t.then(function(t){return e.readySync=!0,t}).catch(function(t){return S(t)?e.$throwError(t):Promise.reject(t)}),this.readySync||this.ready},r.$bumpToTop=function(){var t=this.__dispatcher._getTopLevel(this.$inner);this.$level=t+1},r.$throwError=function(t){this.__dispatcher.throwError(t)},r.$destroy=function(){u(this.destroy)&&this.destroy(),t.prototype.__destroy.call(this),this.__dispatcher.dom.removePlugin(this.__id),delete this.__dispatcher,delete this.$dom,this.destroyed=!0},e(n,[{key:"$operable",set:function(t){w(t)&&(this.$dom.style.pointerEvents=t?"auto":"none",this.__operable=t)},get:function(){return this.__operable}},{key:"$level",set:function(t){v(t)&&(this.__level=t,this.__dispatcher._sortZIndex())},get:function(){return this.__level}}]),n}($n))||Ln;function Nn(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),o(t,n.key,n)}}function Vn(t,e,i,n,r){var o={};return Object.keys(n).forEach(function(t){o[t]=n[t]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=i.slice().reverse().reduce(function(i,n){return n(t,e,i)||i},o),r&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(t,e,o),o=null),o}var Hn,Bn,Un,Wn,zn,jn,qn,Gn,Kn=Object.getOwnPropertyDescriptor,Yn=Object.keys,Xn=["","o","ms","moz","webkit","webkitCurrent"],Qn=[["",""],["exit","cancel"],["screen","Screen"]],Jn={position:"fixed",zIndex:"2147483647",left:0,top:0,right:0,bottom:0,overflow:"hidden",width:"100%",height:"100%"},Zn=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],tr=["fullscreenerror","webkitfullscreenerror","mozfullscreenerror","MSFullscreenError"],er=J.document,ir=void 0!==er;function nr(t,e,i){if(p(e))for(var n in e)nr(t,n,e[n]);else t.style[e]=i}function rr(t,e,i){void 0===i&&(i={}),p(e)&&(i=e),_(t)&&(e=t);var n=i.keyOnly,r=void 0!==n&&n;if(!ir)return r?"":void 0;if(R(t)||(t=er),!_(e))throw new Error("You must pass in a string as name, but not "+typeof e+".");for(var o=0;o<Qn.length;o++){e=e.replace(Qn[o][0],Qn[o][1]);for(var s=0;s<Xn.length;s++){var a=0===s?e:Xn[s]+e.charAt(0).toUpperCase()+e.substr(1);if(void 0!==t[a])return r?a:t[a]}}return r?"":void 0}function or(t,e,i){var n,r=void 0===i?{}:i,o=r.bubbles,s=void 0===o||o,a=r.cancelable,c=void 0===a||a;if(u(Event)?n=new Event(e,{bubbles:s,cancelable:c}):ir&&er.createEvent?(n=er.createEvent("HTMLEvents")).initEvent(e,!0,!0):ir&&er.createEventObject&&((n=er.createEventObject()).eventType=e,n.eventName=e),!p(n)&&!y(n))throw new Error("We can't create an object on this browser, please report to author");t.dispatchEvent?t.dispatchEvent(n):t.fireEvent?t.fireEvent("on"+n.eventType,n):t[e]?t[e]():t["on"+e]&&t["on"+e]()}var sr=rr("fullscreenEnabled"),ar=!1,cr=new(Hn=yi(),Bn=fi("requestFullscreen"),Un=fi("exitFullscreen"),Wn=fi("addEventListener"),zn=fi("removeEventListener"),Hn((Vn(Gn=(qn=function(){function t(){this._fullscreenElement=null,this.isNativelySupport=h(rr("fullscreenElement"))&&(!h(sr)||!0===sr),this._openKey=ir?rr(er.body||er.documentElement,"requestFullscreen",{keyOnly:!0}):"",this._exitKey=rr("exitFullscreen",{keyOnly:!0}),this._useStyleFirst=!1,this.hasUsedStyle=!1}var e,i,n,r=t.prototype;return r.open=function(t,e){var i=(void 0===e?{}:e).force,n=void 0!==i&&i,r=this.fullscreenElement;if(r&&r!==t){if(!n)return or(er,"fullscreenerror"),!1;this.exit()}if(!this.useStyleFirst){if(this.isNativelySupport)return u(t[this._openKey])&&t[this._openKey](),!0;if(t instanceof HTMLVideoElement&&t.webkitSupportsFullscreen&&u(t.webkitEnterFullscreen))return t.webkitEnterFullscreen(),this._fullscreenElement=t,!0}return this._savedStyles=Yn(Jn).reduce(function(e,i){return e[i]=t.style[i],e},{}),nr(t,Jn),er.body&&(this._bodyOverflow=er.body.style.overflow,er.body.style.overflow="hidden"),er.documentElement&&(this._htmlOverflow=er.documentElement.style.overflow,er.documentElement.style.overflow="hidden"),this._fullscreenElement=t,this.hasUsedStyle=!0,or(t,"fullscreenchange"),!0},r.exit=function(){if(!this.isFullscreen)return!1;if(this.isNativelySupport&&!this.useStyleFirst&&!this.hasUsedStyle)return er[this._exitKey](),!0;var t=this._fullscreenElement;return nr(t,this._savedStyles),er.body&&(er.body.style.overflow=this._bodyOverflow),er.documentElement&&(er.documentElement.style.overflow=this._htmlOverflow),this._fullscreenElement=null,this._savedStyles={},or(t,"fullscreenchange"),!0},r.on=function(t,e,i){void 0===i&&(i=er),this._handleEvent(i,"addEventListener",t,e)},r.off=function(t,e,i){void 0===i&&(i=er),this._handleEvent(i,"removeEventListener",t,e)},r._handleEvent=function(t,e,i,n){("fullscreenchange"===i?Zn:"fullscreenerror"===i?tr:[i]).forEach(function(i){t[e](i,n)})},e=t,(i=[{key:"useStyleFirst",get:function(){return ar},set:function(t){return(t=!!t)===ar?t:(ar=t,or(er,"esfullscreenmethodchange"),t)}},{key:"fullscreenElement",get:function(){return["fullscreenElement","webkitFullscreenElement","mozFullScreenElement","msFullscreenElement"].reduce(function(t,e){return t||er[e]},null)||this._fullscreenElement}},{key:"isFullscreen",get:function(){return R(this.fullscreenElement)}}])&&Nn(e.prototype,i),n&&Nn(e,n),t}()).prototype,"open",[Bn],Kn(Gn,"open"),Gn),Vn(Gn,"exit",[Un],Kn(Gn,"exit"),Gn),Vn(Gn,"on",[Wn],Kn(Gn,"on"),Gn),Vn(Gn,"off",[zn],Kn(Gn,"off"),Gn),jn=qn))||jn),hr=function(){if("undefined"!=typeof Map)return Map;function t(t,e){var i=-1;return t.some(function(t,n){return t[0]===e&&(i=n,!0)}),i}return function(){function e(){this.__entries__=[]}return o(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(e){var i=t(this.__entries__,e),n=this.__entries__[i];return n&&n[1]},e.prototype.set=function(e,i){var n=t(this.__entries__,e);~n?this.__entries__[n][1]=i:this.__entries__.push([e,i])},e.prototype.delete=function(e){var i=this.__entries__,n=t(i,e);~n&&i.splice(n,1)},e.prototype.has=function(e){return!!~t(this.__entries__,e)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,e){void 0===e&&(e=null);for(var i=0,n=this.__entries__;i<n.length;i++){var r=n[i];t.call(e,r[1],r[0])}},e}()}(),lr="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,dr=void 0!==M&&M.Math===Math?M:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),ur="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(dr):function(t){return setTimeout(function(){return t(Date.now())},1e3/60)},pr=2;var fr=20,mr=["top","right","bottom","left","width","height","size","weight"],vr="undefined"!=typeof MutationObserver,gr=function(){function t(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(t,e){var i=!1,n=!1,r=0;function o(){i&&(i=!1,t()),n&&a()}function s(){ur(o)}function a(){var t=Date.now();if(i){if(t-r<pr)return;n=!0}else i=!0,n=!1,setTimeout(s,e);r=t}return a}(this.refresh.bind(this),fr)}return t.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},t.prototype.removeObserver=function(t){var e=this.observers_,i=e.indexOf(t);~i&&e.splice(i,1),!e.length&&this.connected_&&this.disconnect_()},t.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},t.prototype.updateObservers_=function(){var t=this.observers_.filter(function(t){return t.gatherActive(),t.hasActive()});return t.forEach(function(t){return t.broadcastActive()}),t.length>0},t.prototype.connect_=function(){lr&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),vr?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},t.prototype.disconnect_=function(){lr&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},t.prototype.onTransitionEnd_=function(t){var e=t.propertyName,i=void 0===e?"":e;mr.some(function(t){return!!~i.indexOf(t)})&&this.refresh()},t.getInstance=function(){return this.instance_||(this.instance_=new t),this.instance_},t.instance_=null,t}(),yr=function(t,e){for(var i=0,n=c(e);i<n.length;i++){var r=n[i];o(t,r,{value:e[r],enumerable:!1,writable:!1,configurable:!0})}return t},_r=function(t){return t&&t.ownerDocument&&t.ownerDocument.defaultView||dr},wr=Sr(0,0,0,0);function br(t){return parseFloat(t)||0}function Er(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return e.reduce(function(e,i){return e+br(t["border-"+i+"-width"])},0)}function Tr(t){var e=t.clientWidth,i=t.clientHeight;if(!e&&!i)return wr;var n=_r(t).getComputedStyle(t),r=function(t){for(var e={},i=0,n=["top","right","bottom","left"];i<n.length;i++){var r=n[i],o=t["padding-"+r];e[r]=br(o)}return e}(n),o=r.left+r.right,s=r.top+r.bottom,a=br(n.width),c=br(n.height);if("border-box"===n.boxSizing&&(Math.round(a+o)!==e&&(a-=Er(n,"left","right")+o),Math.round(c+s)!==i&&(c-=Er(n,"top","bottom")+s)),!function(t){return t===_r(t).document.documentElement}(t)){var h=Math.round(a+o)-e,l=Math.round(c+s)-i;1!==Math.abs(h)&&(a-=h),1!==Math.abs(l)&&(c-=l)}return Sr(r.left,r.top,a,c)}var Rr="undefined"!=typeof SVGGraphicsElement?function(t){return t instanceof _r(t).SVGGraphicsElement}:function(t){return t instanceof _r(t).SVGElement&&"function"==typeof t.getBBox};function Ar(t){return lr?Rr(t)?function(t){var e=t.getBBox();return Sr(0,0,e.width,e.height)}(t):Tr(t):wr}function Sr(t,e,i,n){return{x:t,y:e,width:i,height:n}}var kr=function(){function t(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=Sr(0,0,0,0),this.target=t}return t.prototype.isActive=function(){var t=Ar(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},t.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},t}(),Pr=function(){return function(t,e){var i,n,r,o,s,a,c,h=(n=(i=e).x,r=i.y,o=i.width,s=i.height,a="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,c=Object.create(a.prototype),yr(c,{x:n,y:r,width:o,height:s,top:r,right:n+o,bottom:s+r,left:n}),c);yr(this,{target:t,contentRect:h})}}(),Cr=function(){function t(t,e,i){if(this.activeObservations_=[],this.observations_=new hr,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=e,this.callbackCtx_=i}return t.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof _r(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)||(e.set(t,new kr(t)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof _r(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)&&(e.delete(t),e.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(e){e.isActive()&&t.activeObservations_.push(e)})},t.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,e=this.activeObservations_.map(function(t){return new Pr(t.target,t.broadcastRect())});this.callback_.call(t,e,t),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),Dr="undefined"!=typeof WeakMap?new WeakMap:new hr,xr=function(){return function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var i=gr.getInstance(),n=new Cr(e,i,this);Dr.set(this,n)}}();["observe","unobserve","disconnect"].forEach(function(t){xr.prototype[t]=function(){var e;return(e=Dr.get(this))[t].apply(e,arguments)}});var Ir,Lr,Or,Mr,$r,Fr,Nr,Vr=void 0!==dr.ResizeObserver?dr.ResizeObserver:xr;function Hr(t){if("video"===t&&(t="videoElement"),!R(this[t]))throw new TypeError('Your target "'+t+'" is not a legal HTMLElement');for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return[t].concat(i)}function Br(t,e,i){if(!_(e))throw new TypeError("to handle dom's attribute or style, your attr parameter must be string, but not "+e+" in "+typeof e);if(!_(t))throw new TypeError("to handle dom's attribute or style, your target parameter must be string, , but not "+t+" in "+typeof t);return[t,e,i]}var Ur,Wr,zr,jr,qr,Gr,Kr=(Ir=Ri("__dispatcher.videoConfigReady"),Lr=hi(Br,Hr),Or=hi(Br,Hr),Mr=hi(Br,Hr),$r=hi(Br,Hr),Fr=hi(Hr),r((Nr=function(){function t(t,e){var i=this;if(i.plugins={},i.originHTML="",i.videoEventHandlerList=[],i.videoDomEventHandlerList=[],i.containerDomEventHandlerList=[],i.wrapperDomEventHandlerList=[],i.wrapperGuestureEventHandlerList=[],i.globalEventHandlerList=[],i.__domEventHandlerList={},i.__mouseInVideo=!1,i.__videoExtendedNodes=[],i.isFullscreen=!1,i.fullscreenElement=void 0,i.__dispatcher=e,!R(t)&&!_(t))throw new TypeError("Wrapper can only be string or HTMLElement, but not "+typeof t);var n=ge(t);if(0===n.length)throw new TypeError("Can not get dom node accroding wrapper. Please check your wrapper");i.wrapper=n[0],i.originHTML=i.wrapper.innerHTML;var r=n.find("video")[0];r||(r=document.createElement("video")),i.installVideo(r),i._addDomEvents(i.container,i.containerDomEventHandlerList,function(t){return function(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=i.__dispatcher.bus).triggerSync.apply(e,["c_"+t].concat(r))}}),i._addDomEvents(i.wrapper,i.wrapperDomEventHandlerList,function(t){return function(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=i.__dispatcher.bus).triggerSync.apply(e,["w_"+t].concat(r))}}),i._fullscreenMonitor(),cr.on("fullscreenchange",i._fullscreenMonitor),i.containerResizeObserver=new Vr(i._resizeMonitor),i.containerResizeObserver.observe(i.container),i._addGlobalEvents(document,i.globalEventHandlerList,function(t){return function(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=i.__dispatcher.bus).triggerSync.apply(e,["g_"+t].concat(r))}})}var e=t.prototype;return e.installVideo=function(t,e){var i=(void 0===e?{}:e).bindEvent,n=void 0===i||i;if(this.__videoExtendedNodes.push(t),oe(t,"tabindex",-1),this._autoFocusToVideo(t),R(this.container)){var r=this.container;0===r.childNodes.length?r.appendChild(t):r.insertBefore(t,r.childNodes[0])}else t.parentElement&&R(t.parentElement)&&t.parentElement!==this.wrapper?this.container=t.parentElement:(this.container=document.createElement("container"),ge(this.container).append(t));return this.container.parentElement!==this.wrapper&&ge(this.wrapper).append(this.container),n&&this.bindVideoEvents(t),this.videoElement=t,t},e.bindVideoEvents=function(t){var e=this;on.forEach(function(i){var n=function(){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(t=e.__dispatcher.bus).trigger.apply(t,[i].concat(r))};e.videoEventHandlerList.push(n),ue(t,i,n)}),this._addDomEvents(t,this.videoDomEventHandlerList,function(t){return e._getEventHandler(t,{penetrate:!0})})},e.removeVideo=function(){var t=this,e=this.videoElement;return this._autoFocusToVideo(this.videoElement,!1),on.forEach(function(e,i){de(t.videoElement,e,t.videoEventHandlerList[i])}),this.videoEventHandlerList=[],an.forEach(function(e,i){de(t.videoElement,e,t.videoDomEventHandlerList[i])}),this.videoDomEventHandlerList=[],ge(e).remove(),delete this.videoElement,e},e.insertPlugin=function(t,e,i){var n=this;if(void 0===i&&(i={}),!_(t))throw new TypeError("insertPlugin id parameter must be string");if(R(this.plugins[t])&&this.removePlugin(t),_(e))if(/<[^>]+?>/.test(e)){var r=document.createElement("div");r.innerHTML=e,e=r.children[0]}else e=document.createElement(function(t){return I(t).replace(/([A-Z])/g,function(t){return"-"+t.toLowerCase()})}(e));else p(e)&&(i=e);var o=i,s=o.inner,a=o.penetrate,c=o.autoFocus,h=i.className,l=e&&R(e)?e:document.createElement("div");d(h)&&(h=h.join(" ")),_(h)&&se(l,h),this.plugins[t]=l;var u=s?this.container:this.wrapper,f=s?this.videoElement:this.container;return(w(c)?c:s)&&this._autoFocusToVideo(l),a&&(this.__domEventHandlerList[t]=this.__domEventHandlerList[t]||[],this._addDomEvents(l,this.__domEventHandlerList[t],function(t){return n._getEventHandler(t,{penetrate:a})}),this.__videoExtendedNodes.push(l)),u.lastChild===f?(u.appendChild(l),l):(u.insertBefore(l,f.nextSibling),l)},e.removePlugin=function(t){var e=this;if(_(t)){var i=this.plugins[t];R(i)&&(i.parentNode&&i.parentNode.removeChild(i),this._autoFocusToVideo(i,!0)),g(this.__domEventHandlerList[t])||(an.forEach(function(i,n){de(e.plugins[t],i,e.__domEventHandlerList[t][n])}),delete this.__domEventHandlerList[t]),delete this.plugins[t]}},e.setPluginsZIndex=function(t){var e=this;t.forEach(function(t,i){return fe(t.match(/^(videoElement|container)$/)?e[t]:e.plugins[t],"z-index",++i)})},e.setAttr=function(t,e,i){oe(this[t],e,i)},e.getAttr=function(t,e){return re(this[t],e)},e.setStyle=function(t,e,i){fe(this[t],e,i)},e.getStyle=function(t,e){return pe(this[t],e)},e.requestFullscreen=function(t){return cr.open(this[t])},e.exitFullscreen=function(){return cr.exit()},e.fullscreen=function(t,e){void 0===t&&(t=!0),void 0===e&&(e="container");for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];return t?this.requestFullscreen.apply(this,[e].concat(n)):this.exitFullscreen.apply(this,n)},e.focus=function(){this.videoElement.focus()},e.destroy=function(){var t=this;this.removeVideo(),an.forEach(function(e,i){de(t.container,e,t.containerDomEventHandlerList[i]),de(t.wrapper,e,t.wrapperDomEventHandlerList[i])}),cn.forEach(function(e,i){de(document,e,t.globalEventHandlerList[i])}),cr.off("fullscreenchange",this._fullscreenMonitor),this.containerResizeObserver.unobserve(this.container),this.containerResizeObserver.disconnect(),this.wrapper.innerHTML=this.originHTML,delete this.containerResizeObserver,delete this.wrapper,delete this.plugins},e._addDomEvents=function(t,e,i){an.forEach(function(n){var r=i(n);e.push(r),hn.indexOf(n)>-1?ue(t,n,r,!1,{passive:!0}):ue(t,n,r)})},e._addGlobalEvents=function(t,e,i){cn.forEach(function(n){var r=i(n);e.push(r),hn.indexOf(n)>-1?ue(t,n,r,!1,{passive:!0}):ue(t,n,r)})},e._autoFocusToVideo=function(t,e){void 0===e&&(e=!1),R(t)&&((e?de:ue)(t,"mouseup",this._focusToVideo,!1,!0),(e?de:ue)(t,"touchend",this._focusToVideo,!1,!0))},e._focusToVideo=function(){var t=window.scrollX,e=window.scrollY;u(this.videoElement.focus)&&this.videoElement.focus(),window.scrollTo(t,e)},e._resizeMonitor=function(t,e){var i=t,n=Array.isArray(i),r=0;for(i=n?i:i[Symbol.iterator]();;){var o;if(n){if(r>=i.length)break;o=i[r++]}else{if((r=i.next()).done)break;o=r.value}var s=o,c=s.contentRect;c.left,c.top,c.width,c.height;this.__dispatcher.bus.triggerSync("c_resize",a({},s.contentRect))}},e._fullscreenMonitor=function(t){var e=cr.fullscreenElement,i=this.isFullscreen;!e||!A(this.wrapper,e)&&e!==this.wrapper?(this.isFullscreen=!1,this.fullscreenElement=void 0):(this.isFullscreen=!0,this.fullscreenElement=this.wrapper===e?"wrapper":this.container===e?"container":this.videoElement===e?"video":e),y(t)&&i!==this.isFullscreen&&this.__dispatcher.bus.triggerSync("fullscreenchange",t)},e._getEventHandler=function(t,e){var i=this;if(!e.penetrate||["mouseenter","mouseleave"].indexOf(t)<0)return function(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];(e=i.__dispatcher.bus).triggerSync.apply(e,[t].concat(r))};var n=function(t){return i.__videoExtendedNodes.indexOf(t)>-1||i.__videoExtendedNodes.reduce(function(e,i){return e||A(i,t)},!1)};return function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var o,s,a=e[0],c=a.toElement,h=a.currentTarget,l=a.relatedTarget,d=a.type,u=c||l;return i.__mouseInVideo&&"mouseleave"===d&&!n(u)?(i.__mouseInVideo=!1,(o=i.__dispatcher.bus).triggerSync.apply(o,["mouseleave"].concat(e))):!i.__mouseInVideo&&"mouseenter"===d&&n(h)?(i.__mouseInVideo=!0,(s=i.__dispatcher.bus).triggerSync.apply(s,["mouseenter"].concat(e))):void 0}},t}()).prototype,"setAttr",[Ir,Lr],s(Nr.prototype,"setAttr"),Nr.prototype),r(Nr.prototype,"getAttr",[Or],s(Nr.prototype,"getAttr"),Nr.prototype),r(Nr.prototype,"setStyle",[Mr],s(Nr.prototype,"setStyle"),Nr.prototype),r(Nr.prototype,"getStyle",[$r],s(Nr.prototype,"getStyle"),Nr.prototype),r(Nr.prototype,"requestFullscreen",[Fr],s(Nr.prototype,"requestFullscreen"),Nr.prototype),r(Nr.prototype,"_focusToVideo",[_i],s(Nr.prototype,"_focusToVideo"),Nr.prototype),r(Nr.prototype,"_resizeMonitor",[_i],s(Nr.prototype,"_resizeMonitor"),Nr.prototype),r(Nr.prototype,"_fullscreenMonitor",[_i],s(Nr.prototype,"_fullscreenMonitor"),Nr.prototype),Nr),Yr={width:"100%",height:"100%",position:"relative",display:"block"},Xr=function(t,e,i){var n=this;n.__dispatcher=t,n.__target=e,["width","height","position","display"].forEach(function(t){o(n,t,{get:function(){return this.__dispatcher.dom.getStyle(this.__target,t)},set:function(e){if(f(e)&&(e+="px"),!_(e))throw new Error("The value of "+t+" in "+this.__target+"Config must be string, but not "+typeof e+".");this.__dispatcher.dom.setStyle(this.__target,t,e)},configurable:!0,enumerable:!0})}),x(n,i)},Qr=["audioTracks","autoPlay","controller","controls","crossOrigin","currentSrc","currentTime","defaultMuted","defaultPlaybackRate","duration","ended","error","loop","mediaGroup","muted","networkState","paused","playbackRate","poster","preload","readyState","seekable","seeking","src","startDate","textTracks","videoTracks","videoWidth","videoHeight","volume","currentFPS","videoBytesPerSecond","currentBytesPerSecond","ratio","type","p2p","bufferTime"],Jr=["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting","statechange"],Zr=["canPlayType","load","play","pause","switchVideo","seek"],to="6.2.6-eaa0bbd";function eo(t){var e=t.type,i=t.p2p,n=document.createElement("flash"),r="mgtv-player-"+ +new Date,s=[],a=Object.create(null);a.count=0,n.style.position="relative",n.style.display="block",n.style.width="100%",n.style.height="100%",n.innerHTML='<object id="'+r+'" data="//player.mgtv.com/mgtv_v6_player/PlayerCore.swf?ver='+to+'" type="application/x-shockwave-flash" width="100%" height="100%">\n                <param name="allowScriptAccess" value="always">\n                <param name="quality" value="best">\n                <param name="allowFullScreen" value="true">\n                <param name="wmode" value="Opaque">\n                <param name="allowScriptAccess" value="always">\n                <param name="flashvars" value="type='+e+"&p2p="+i+'">\n                <param name="bgcolor" value="#000000">\n                <param name="type" value="application/x-shockwave-flash">\n                <param name="pluginspage" value="https://www.macromedia.com/go/getflashplayer">\n            </object><overlay style="width:100%;height:100%;position:absolute;top:0;left:0;"></overlay>';var c=n.childNodes[0],h=n.childNodes[1];return n._addEventListener=n.addEventListener,n._removeEventListener=n.removeEventListener,n._setAttribute=n.setAttribute,n._getAttribute=n.getAttribute,n.setAttribute=function(t,e){c.setAttribute(t,e)},n.getAttribute=function(t){return c.getAttribute(t)},n.install=function(t){(t=t||document.getElementById("mgtv-player-1")).append(n)},n.addEventListener=function(t,e,i){-1!==Jr.findIndex(function(e){return e===t})?(a[t]||(a[t]=[]),a[t].push(e)):n._installed?h.addEventListener(t,e,i):s.push(function(){h.addEventListener(t,e,i)})},n.removeEventListener=function(t,e,i){if(-1!==Jr.findIndex(function(e){return e===t})){var r=a[t]||[];r=r.filter(function(t){return t!==e}),a[t]=r}else n._installed?h.removeEventListener(t,e,i):s.push(function(){h.removeEventListener(t,e,i)})},n.emitEventCache=function(t,e,i){var n=Object.create(null);n.type=e,n.target=t,(a[e]||[]).forEach(function(e){e.apply(t,[n,i])})},o(n,"buffered",{get:function(){if(n._installed){var t=c.getProp("currentTime"),e=c.getProp("buffered");return{length:1,start:function(e){return t},end:function(t){return e}}}}}),Qr.forEach(function(t){o(n,t,{get:function(){if(n._installed)return c.getProp(t)},set:function(e){c.setProp?c.setProp(t,e):s.push(function(){c.setProp(t,e)})}})}),Zr.forEach(function(t){o(n,t,{value:function(){for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];n._installed?c[t]&&c[t].apply(c,i):s.push(function(){c[t]&&c[t].apply(c,i)})}})}),window.onVideoEvent=function(t,e){"loaded"==t&&(n._installed=!0,s.forEach(function(t){return t.apply(n)})),"statechange"==t&&1==n.readyState&&n.play(),n.emitEventCache(n,t,e)},n}var io={},no={};function ro(t){if(!_(t))throw new Error("Plugin's name must be a string, but not \""+t+'" in '+typeof t);return I(t)}var oo,so,ao,co,ho,lo,uo,po,fo,mo,vo,go,yo,_o,wo,bo,Eo,To,Ro=(Ur=hi(ro),Wr=hi(function(t){if(u(t)){if(!(t.prototype instanceof Fn))throw new TypeError("Your are trying to install plugin "+t.name+", but it's not extends from Mango.plugin.")}else{if(!p(t)||g(t))throw new TypeError("plugin's config must be an Object, but not \""+t+'" in '+typeof t);var e=t.name;if(!_(e)||e.length<1)throw new TypeError('plugin must have a legal namea, but not "'+e+'" in '+typeof e)}}),zr=hi(ro),jr=hi(ro),qr=hi(ro),r((Gr=function(){function t(t,e){var i=this;if(i.plugins={},i.order=[],i.readySync=!1,i.zIndexMap={inner:[],outer:[]},i.changeWatchable=!0,!p(t))throw new TypeError('UserConfig must be an Object, but not "'+t+'" in '+typeof t);i.dom=new Kr(t.wrapper,i),i.bus=new An(i),i.vm=e,i.videoConfigReady=!1,i.videoConfig=new Mn(i,t),d(t.plugins)&&!d(t.plugin)&&(t.plugin=t.plugins,delete t.plugins),i._initUserPlugin(t.plugin);var n=x({},Yr,t.container||{});i.order.forEach(function(t){return i.plugins[t].__init(i.videoConfig,n)}),i.videoConfigReady=!0,i.videoConfig.init(),i.containerConfig=new Xr(i,"container",n),i.kernel=i._createKernel(i.dom.videoElement,i.videoConfig),i._bindKernelEvents(i.kernel);var r=[];i.order.forEach(function(t){var e=i.plugins[t].__inited();b(e)&&r.push(e)}),i.readySync=0===r.length,i.ready=i.readySync?Promise.resolve():Promise.all(r).then(function(){i.readySync=!0,i.bus.trigger("ready"),i._autoloadVideoSrcAtFirst()}),i.readySync&&i._autoloadVideoSrcAtFirst()}var e=t.prototype;return e.addPlugins=function(t){var e=this;void 0===t&&(t=[]);var i=[],n=this.order;d(t)||(t=[t]),this.videoConfigReady=!1,t.map(function(t){e.use(t),i.push(n[n.length-1])}),this.videoConfigReady=!0;var r=x({},Yr,this.videoConfig.container||{});i.forEach(function(t){return e.plugins[t].__init(e.videoConfig,r)});var o=[];i.forEach(function(t){var i=e.plugins[t].__inited();b(i)&&o.push(i)}),this.ready.then(function(){return Promise.all(o)})},e.use=function(e){if(_(e)&&(e={name:e,alias:void 0}),!p(e)||p(e)&&!_(e.name))throw new TypeError("pluginImpl do not match requirement");_(e.alias)||(e.alias=void 0);var i=e,n=i.name,r=i.alias;e.name=r||n,delete e.alias;var s=I(n),a=I(r||n),c=e,h=t.getPluginConfig(s);if(g(h))throw new TypeError("You have not installed plugin "+s);p(h)&&(h.id=a);var l=u(h)?new h({id:a},this,c):new Fn(h,this,c);return this.plugins[a]=l,o(this.vm,a,{value:l,configurable:!0,enumerable:!1,writable:!1}),this.order.push(a),this._sortZIndex(),this.videoConfigReady&&l.__inited(),l.ready},e.unuse=function(t){var e=this.plugins[t];if(p(e)&&u(e.$destroy)){e.$destroy();var i=this.order.indexOf(t);i>-1&&this.order.splice(i,1),delete this.plugins[t],delete this.vm[t]}else delete this.plugins[t]},e.handleEvent=function(t){var e=t.type;switch(e){case"error":this.throwError(t)}this.bus.triggerSync(e,t)},e.throwError=function(t){this.vm.__throwError(t)},e.loadLevel=function(t){return this.kernel.loadLevel(t)},e.silentLoad=function(t,e){var i=this;void 0===e&&(e={});var n=e,r=n.duration,o=void 0===r?3:r,s=n.bias,a=void 0===s?0:s,c=n.repeatTimes,h=void 0===c?0:c,l=n.increment,d=void 0===l?0:l,u=n.waitingBuffer,p=n.isLive,f=void 0===p?this.videoConfig.isLive:p,m=n.box,v=void 0===m?this.videoConfig.box:m,y=n.kernels,_=void 0===y?this.videoConfig.kernels:y,w=n.preset,b=void 0===w?this.videoConfig.preset:w,E=e.immediate||f,T={isLive:f,box:v,src:t,kernels:_,preset:b},R=null;return ot(new Array(h+1).fill(1).map(function(t,n){return function(){return new Promise(function(t,r){if(e.abort)return r({error:!0,message:"user abort the mission"});var s,c=document.createElement("video"),l=i.kernel.bufferInfo;!u&&l&&l.len-2>o+d*n?(s=i.kernel.currentTime+l.len-2,i.kernel.stopLoad()):s=i.kernel.currentTime+o+d*n,c.muted=!0;var p,m,v,y,_=!1,w=function(){var e=i.kernel.currentTime;if(a<=0&&e>=s||a>0&&(Math.abs(s-e)<=a&&_||e-s>a)){if(de(i.dom.videoElement,"timeupdate",w),de(c,"error",m,!0),!_)return de(c,"canplay",v,!0),de(c,"loadedmetadata",y,!0),i.kernel.startLoad(),t();f||p.seek(e-1e-4),r({error:!1,video:c,kernel:p})}};v=function(){_=!0,E&&(de(i.dom.videoElement,"timeupdate",w),de(c,"error",m,!0),p.off("error",m),r({error:!1,video:c,kernel:p}))},y=function(){f||p.seek(s+1)},m=function(e){var o;if(de(c,"canplay",v,!0),de(c,"loadedmetadata",y,!0),de(i.dom.videoElement,"timeupdate",w),p.off("error",m),e.target===p){var s=e.data.errmsg;$e.error("mango's silentload bump into a kernel error",s),o=new Error(s)}else o=g(c.error)?new Error("unknow video error"):new Error(c.error.message),$e.error("mango's silentload",o.message);return i.kernel.startLoad(),n===h?r(o):t(o)},ue(c,"canplay",v,!0),ue(c,"loadedmetadata",y,!0),ue(c,"error",m,!0),R&&R.destroy(),(p=i._createKernel(c,T)).on("error",m),ue(i.dom.videoElement,"timeupdate",w),p.load(),R=p})}})).then(function(){var e="The silentLoad for "+t+" timed out. Please set a longer duration or check your network";return R&&R.destroy(),Promise.reject(new Error(e))}).catch(function(t){if(S(t)||t.error)return t=S(t)?t:new Error(t.message),R&&R.destroy(),i.kernel.startLoad(),Promise.reject(t);var e=t,n=e.video,r=e.kernel;return i.dom.videoElement.paused?(i.switchKernel({video:n,kernel:r,config:T}),Promise.resolve()):new Promise(function(t){ue(n,"play",function(){i.switchKernel({video:n,kernel:r,config:T}),t()},!0),n.play()})})},e.playNextAd=function(){var t=this;return"flash"==this.videoConfig.box?this.kernel.playNext():new Promise(function(e,i){var n=t.preloadObj;if(n){var r=n.video,o=n.kernel,s=n.config,a=setTimeout(function(){clearTimeout(a),o.destroy(),i("play timeout")},1e3);ue(r,"play",function(){t.switchKernel({video:r,kernel:o,config:s}),clearTimeout(a),e()},!0),r.play(),t.preloadObj=null}else i("no perload")})},e.preLoadAd=function(t,e){e.duration,e.bias,e.repeatTimes,e.increment;var i=e.box,n=void 0===i?this.videoConfig.box:i,r=e.kernels,o=void 0===r?this.videoConfig.kernels:r,s=e.preset,a=void 0===s?this.videoConfig.preset:s,c=e.isLive,h={box:n,src:t,kernels:o,preset:a,isLive:void 0===c?this.videoConfig.isLive:c};if("flash"==n)this.kernel.preload(t,0,!1);else{var l,d,u,p,f=document.createElement("video");f.muted=!0,p=function(){},d=function(t){var e;if(de(f,"canplay",u,!0),de(f,"loadedmetadata",p,!0),l.off("error",d),t.target===l){var i=t.data.errmsg;$e.error("mango's preload bump into a kernel error",i),e=new Error(i)}else e=g(f.error)?new Error("unknow video error"):new Error(f.error.message),$e.error("mango's preload",e.message)},ue(f,"canplay",u=function(){},!0),ue(f,"loadedmetadata",p,!0),ue(f,"error",d,!0),(l=this._createKernel(f,h)).on("error",d),l.load(),this.preloadObj={kernel:l,video:f,config:h}}},e.preLoad=function(t,e){var i=this;void 0===e&&(e={});var n=e,r=n.duration,o=void 0===r?5e3:r,s=(n.bias,n.repeatTimes),a=void 0===s?0:s,c=(n.increment,n.box),h=void 0===c?this.videoConfig.box:c,l=n.kernels,d=void 0===l?this.videoConfig.kernels:l,u=n.preset,p=void 0===u?this.videoConfig.preset:u,f=n.isLive,m=void 0===f?this.videoConfig.isLive:f,v={box:h,src:t,kernels:d,preset:p,isLive:m},y=e.immediate||!1,_=null;return ot(new Array(a+1).fill(1).map(function(n,r){return function(){return new Promise(function(n,s){if(e.abort)return s({error:!0,message:"user abort the mission"});if("flash"==h)i.kernel.preload(t,0,!1);else{var c=document.createElement("video");c.muted=!0;var l,d,u,p,f=!1,m=!1,w=null,b=function(){m=!0,de(i.dom.videoElement,"ended",b),de(c,"error",d,!0),w&&clearTimeout(w),f?s({error:!1,video:c,kernel:l}):(de(c,"canplay",u,!0),de(c,"loadedmetadata",p,!0),n())};u=function(){f=!0,m&&(de(i.dom.videoElement,"ended",b),de(c,"error",d,!0),w&&clearTimeout(w),l.off("error",d),s({error:!1,video:c,kernel:l}))},p=function(){},d=function(t){var e;if(de(c,"canplay",u,!0),de(c,"loadedmetadata",p,!0),de(i.dom.videoElement,"ended",b),w&&clearTimeout(w),l.off("error",d),t.target===l){var o=t.data.errmsg;$e.error("mango's preload bump into a kernel error",o),e=new Error(o)}else e=g(c.error)?new Error("unknow video error"):new Error(c.error.message),$e.error("mango's preload",e.message);return r===a?s(e):n(e)},ue(c,"canplay",u,!0),ue(c,"loadedmetadata",p,!0),ue(c,"error",d,!0),_&&_.destroy(),(l=i._createKernel(c,v)).on("error",d),ue(i.dom.videoElement,"ended",b),y&&(w&&clearTimeout(w),w=setTimeout(b,o)),l.load(),_=l}})}})).then(function(){var e="The preload for "+t+" timed out. Please set a longer duration or check your network";return _&&_.destroy(),Promise.reject(new Error(e))}).catch(function(t){if(S(t)||t.error)return t=S(t)?t:new Error(t.message),_&&_.destroy(),Promise.reject(t);var e=t,n=e.video,r=e.kernel;return new Promise(function(t){ue(n,"play",function(){i.switchKernel({video:n,kernel:r,config:v}),t()},!0),n.play()})})},e.load=function(t,e){void 0===e&&(e={});var i=_(t)?t:p(t)&&_(t.src)?t.src:"";p(t)&&(delete t.src,e=t);var n=this.kernel.box,r=this.videoConfig,o=e,s=o.playlist,a=void 0===s?r.playlist:s,c=o.isLive,h=void 0===c?r.isLive:c,l=o.box,d=void 0===l?r.box:l,u=o.preset,f=void 0===u?r.preset:u,m=o.kernels,v=void 0===m?r.kernels:m,g=o.startPosition,y=void 0===g?-1:g,w=o.drmData,b=o.p2p,E=void 0===b||b,T=o.ratio;if("hls"===d||d!==n||"flv"===d){var R=Tt(i)?"mp4":"hls",A="flash"===d?eo({type:R,p2p:E}):document.createElement("video"),S={isLive:h,box:d,preset:f,src:i,playlist:a,kernels:v},k=this._createKernel(A,S);$e.warn("kernel","switch kernel from ["+n+"] to ["+d+"]."),this.switchKernel({video:A,kernel:k,config:S})}var P=this.videoConfig.autoload;this._changeUnwatchable(this.videoConfig,"autoload",!1),this.videoConfig.src=i||this.videoConfig.src,this.videoConfig.playlist=a||this.videoConfig.playlist,this.kernel.load(this.videoConfig.src,y,T,w),this._changeUnwatchable(this.videoConfig,"autoload",P)},e.load2=function(t,e){void 0===e&&(e={});var i=_(t)?t:p(t)&&_(t.src)?t.src:"";p(t)&&(delete t.src,e=t);var n=this.videoConfig,r=e,o=r.playlist,s=void 0===o?n.playlist:o,a=r.isLive,c=void 0===a?n.isLive:a,h=r.box,l=void 0===h?n.box:h,d=r.preset,u=void 0===d?n.preset:d,f=r.kernels,m=void 0===f?n.kernels:f,v=r.startPosition,g=void 0===v?-1:v,y=r.p2p,w=void 0===y||y,b=r.drmData,E=r.ratio,T=Tt(i)?"mp4":"hls",R="flash"===l?eo({type:T,p2p:w}):document.createElement("video"),A={isLive:c,box:l,preset:u,src:i,playlist:s,kernels:m},S=this._createKernel(R,A);return S.load(i,g,E,b),{video:R,kernel:S,config:A}},e.switchKernel=function(t){var e=this,i=t.video,n=t.kernel,r=t.config,o=this.kernel,s=D(this.videoConfig);this.dom.removeVideo(),this.dom.installVideo(i,{bindEvent:!1}),this.videoConfig.changeWatchable=!1,this.videoConfig.autoload=!1,this.videoConfig.src=r.src,this.videoConfig._realDomAttr.forEach(function(t){if("src"!==t){var i=s[t];(function(t){return null==t})(i)||(e.videoConfig[t]=i)}}),this.videoConfig.changeWatchable=!0,this._bindKernelEvents(o,!0),this._bindKernelEvents(n),this.kernel=n;var c=r.isLive,h=r.box,l=r.preset,d=r.kernels;a(this.videoConfig,{isLive:c,box:h,preset:l,kernels:d}),o.destroy(),setTimeout(function(){return e.dom.bindVideoEvents(i)})},e.destroy=function(){for(var t in this.plugins)this.unuse(t);this.bus.destroy(),delete this.bus,this.dom.destroy(),delete this.dom,this._bindKernelEvents(this.kernel,!0),this.kernel.destroy(),delete this.kernel,delete this.vm,delete this.plugins,delete this.order},e._initUserPlugin=function(t){var e=this;return void 0===t&&(t=[]),d(t)||(t=[]),t.map(function(t){return e.use(t)})},e._sortZIndex=function(){var t=this,e=this.order.reduce(function(e,i){var n=t.plugins[i];if(g(n))return e;var r=e[n.$inner?"inner":"outer"],o=n.$level;return r[o]=r[o]||[],r[o].push(i),e},{inner:{},outer:{}}),i=e.inner,n=e.outer;i[0]=i[0]||[],i[0].unshift("videoElement"),n[0]=n[0]||[],n[0].unshift("container");var r=rt(i),o=rt(n);this.dom.setPluginsZIndex(r),this.dom.setPluginsZIndex(o),this.zIndexMap.inner=r,this.zIndexMap.outer=o},e._getTopLevel=function(t){var e=this.zIndexMap[t?"inner":"outer"],i=this.plugins[e[e.length-1]];return g(i)?0:i.$level},e._autoloadVideoSrcAtFirst=function(){if(this.videoConfig.video_id)$e.warn("When you has config video_id, it will not autoreload");else if(this.videoConfig.autoload){if(!this.videoConfig.src)return void $e.warn("You have not set the src, so you better set autoload to be false. Accroding to https://github.com/Mangojs/mango/blob/master/doc/zh-cn/mango-api.md#src.");this.bus.emit("load",this.videoConfig.src)}},e._changeUnwatchable=function(t,e,i){this.changeWatchable=!1,t[e]=i,this.changeWatchable=!0},e._createKernel=function(t,e){var i=e.kernels,n=e.preset,r={},o={};return d(i)&&(o=i.reduce(function(t,e){if(_(e)){var i=no[e];return u(i)?(t[e]=i,t):($e.warn("You have not installed kernel for "+e+"."),t)}if(p(e)){var n=e.name,o=e.handler;if(_(o)){var s=no[o];return u(s)?(t[o]=s,r[o]=e,t):($e.warn("You have not installed kernel for "+o+"."),t)}if(u(o)){var a=n||o.name;return t[a]=o,r[a]=e,t}return $e.warn("When you pass in an SingleKernelConfig in Array, you must clarify it's handler, we only support handler in string or function but not "+typeof o),t}return $e.warn("If you pass in kernels as array, you must pass in kernels in string or function, but not "+typeof e),t},{})),p(i)&&c(i).forEach(function(t){var e=i[t];if(!u(e)){if(p(e)){var n=e.handler;if(_(n)){var s=no[n];return u(s)?(o[t]=s,void(r[t]=e)):void $e.warn("You have not installed kernel for "+n+".")}return u(n)?(o[t]=n,void(r[t]=e)):void $e.warn("When you pass in an SingleKernelConfig in Object, you must clarify it's handler, we only support handler in string or function but not "+typeof n)}return $e.warn("If you pass in kernels as object, you must pass in kernels in string or function, but not "+typeof e),i}o[t]=e}),e.preset=a(o,n),e.presetConfig=r,new rn(t,e)},e._bindKernelEvents=function(t,e){var i=this;void 0===e&&(e=!1),nn.forEach(function(n){return t[e?"off":"on"](n,i.handleEvent)})},t.install=function(t){var e=I(t.name);g(io[e]);var i=u(t)?t:x({id:e},t);return io[e]=i,e},t.hasInstalled=function(t){return!g(io[t])},t.uninstall=function(t){delete io[t]},t.getPluginConfig=function(t){return io[t]},t.installKernel=function(t,e){(p(t)?Object.entries(t):[[t,e]]).forEach(function(t){var e=t[0],i=t[1];if(!u(i))throw new Error("The kernel you install on "+e+" must be a Function, but not "+typeof i);u(no[e])&&$e.warn("You have alrady install a kernel on "+e+", and now we will replace it"),no[e]=i})},t.uninstallKernel=function(t){delete no[t]},t.hasInstalledKernel=function(t){return u(no[t])},t}()).prototype,"unuse",[Ur],s(Gr.prototype,"unuse"),Gr.prototype),r(Gr.prototype,"handleEvent",[_i],s(Gr.prototype,"handleEvent"),Gr.prototype),r(Gr,"install",[Wr],s(Gr,"install"),Gr),r(Gr,"hasInstalled",[zr],s(Gr,"hasInstalled"),Gr),r(Gr,"uninstall",[jr],s(Gr,"uninstall"),Gr),r(Gr,"getPluginConfig",[qr],s(Gr,"getPluginConfig"),Gr),Gr),Ao=(so=r((oo=function(){function t(){this.log={error:!0,info:!0,warn:!0,debug:!0,verbose:!0},n(this,"_silent",so,this),this.errorHandler=void 0;var t=c(this.log).reduce(function(t,e){return t[e]=ci({get:function(){return $e["ENABLE_"+e.toUpperCase()]},set:function(t){return $e["ENABLE_"+e.toUpperCase()]=t,!0===t&&(this.silent=!1),t}}),t},{});Pi(this.log,t,{self:!0})}return e(t,[{key:"silent",get:function(){return this._silent},set:function(t){var e=this;void 0!==t&&(t=!!t,this._silent=t,c(this.log).forEach(function(i){e.log[i]=!t}))}}]),t}()).prototype,"_silent",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),oo),So=yi()((Eo=bo=function(t){function e(e){var i;if((i=t.call(this)||this).destroyed=!1,n(i,"__id",ho,i),n(i,"version",lo,i),_(e)||R(e))e={wrapper:e,controls:!0};else{if(!p(e))throw new Error("You must pass in an Object containing wrapper or string or element to new a Mango");if(!e.wrapper)throw new Error("You must pass in an legal object")}var r=new Ro(e,i);return i.config=r.videoConfig,i.cversion=r.kernel.VERSION,i.ready=r.ready,i.readySync=r.readySync,i.__dispatcher=r,i.__wrapAsVideo(r.videoConfig),i}i(e,t),e.registerEvents=function(t){var e=void 0===t?{}:t,i=e.name,n=e.target;if(!i||!_(i))throw new Error("The event name must be a string, but not "+typeof i);if(!n||!_(n))throw new Error("The event target must be a string, but not "+typeof n);"kernel"===n&&nn.push(i)};var r=e.prototype;return r.destroy=function(){this.destroyed||(t.prototype.__destroy.call(this),this.__dispatcher.destroy(),o(this,"__dispatcher",{get:function(){throw new Error("This instance has been destroyed.")},enumerable:!0,configurable:!0}),ge(this.config.wrapper).html(""),this.destroyed=!0)},r.addPlugins=function(t){return void 0===t&&(t=[]),this.__dispatcher.addPlugins(t)},r.use=function(t){return this.__dispatcher.use(t)},r.unuse=function(t){return this.__dispatcher.unuse(t)},r.__throwError=function(t){_(t)&&(t=new Error(t));var i=this.config.errorHandler||e.config.errorHandler;if(u(i))return i(t);if(!e.config.silent&&S(t))throw t},e}($n),bo.plugin=Fn,bo.config=new Ao,bo.install=Ro.install,bo.uninstall=Ro.uninstall,bo.hasInstalled=Ro.hasInstalled,bo.installKernel=Ro.installKernel,bo.uninstallKernel=Ro.uninstallKernel,bo.hasInstalledKernel=Ro.hasInstalledKernel,bo.getPluginConfig=Ro.getPluginConfig,ho=r((co=Eo).prototype,"__id",[bi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"_vm"}}),lo=r(co.prototype,"version",[bi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"6.2.6-eaa0bbd"}}),r(co,"plugin",[bi],(uo=(uo=s(co,"plugin"))?uo.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return uo}}),co),r(co,"config",[bi],(po=(po=s(co,"config"))?po.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return po}}),co),r(co,"install",[bi],(fo=(fo=s(co,"install"))?fo.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return fo}}),co),r(co,"uninstall",[bi],(mo=(mo=s(co,"uninstall"))?mo.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return mo}}),co),r(co,"hasInstalled",[bi],(vo=(vo=s(co,"hasInstalled"))?vo.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return vo}}),co),r(co,"installKernel",[bi],(go=(go=s(co,"installKernel"))?go.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return go}}),co),r(co,"uninstallKernel",[bi],(yo=(yo=s(co,"uninstallKernel"))?yo.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return yo}}),co),r(co,"hasInstalledKernel",[bi],(_o=(_o=s(co,"hasInstalledKernel"))?_o.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return _o}}),co),r(co,"getPluginConfig",[bi],(wo=(wo=s(co,"getPluginConfig"))?wo.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return wo}}),co),ao=co))||ao,ko=["//pcweb.api.mgtv.com","//pcweb2.api.mgtv.com","//pcweb3.api.mgtv.com"],Po={CMSDATA_TIMEOUT:[4e3,4e3,4e3],MAX_CMSDATA_RETRY:3,CMSDATA_RETRY_DOMAINS:ko,GETSOURCE_TIMEOUT:[4e3,4e3,4e3],MAX_GETSOURCE_RETRY:3,GETSOURCE_RETRY_DOMAINS:ko,DISPATCHER_TIMEOUT:[11e3,11e3,11e3],MAX_DISPATCHER_RETRY:3,ANTI_THEFT_PNO:1020,ANTI_THEFT_VERSION:"0.3.0301"},Co=/iPad/i.test(navigator.userAgent),Do=function(t){var e=Co?"1121":"1030",i=Co?"pad":"pch5",n=(t||0).lobparam||{},r=n.did,o=void 0===r?"":r,s=n.suuid,a=void 0===s?"":s,c=n.cxid,h=void 0===c?"":c,l=~~(+new Date/1e3);return{did:o,suuid:a,cxid:h,type:i,pno:e,tk2:btoa("did="+o+"|pno="+e+"|ver=0.3.0301|clit="+l).replace(/\+/g,"_").replace(/\//g,"~").replace(/=/g,"-").split("").reverse().join(""),timestamp:l}},xo=function(){function t(t){this.vm=t.vm,this.reset()}var e=t.prototype;return e.reset=function(){this.getCMSDataRetry=0,this.getSourceRetry=0,this.getDispatcherRetry=0},e._genVParams=function(t){var e=Do(this.vm._config),i=e.tk2;return vt({did:e.did,suuid:e.suuid,cxid:e.cxid,tk2:i,video_id:t,type:e.type,_support:1e7})},e.getVinfo=function(t){var e=this._genVParams(t),i=Po.CMSDATA_RETRY_DOMAINS[0]+"/player/video?"+e;return $e.info("cms","fetch videoinfo, request url is "+i+"."),Te(i,{timeout:3*Po.CMSDATA_TIMEOUT[0]}).then(function(t){return t.json()})},e.getP2pConfig=function(t){this._genVParams(t);var e="//pc.bz.mgtv.com/confs/p2p";return $e.info("cms","fetch p2p config, request url is "+e+"."),Te(e,{jsonpCallbackFunction:"callback_p2pconfig"}).then(function(t){return t.json()})},e.getCMSData=function(t){var e=this,i=Po.CMSDATA_TIMEOUT[this.getCMSDataRetry],n=this._genVParams(t),r=Po.CMSDATA_RETRY_DOMAINS[this.getCMSDataRetry]+"/player/video?"+n;return $e.info("cms","fetch videoinfo, request url is "+r+", timeout ["+i+"], retring "+this.getCMSDataRetry+" nth."),Te(r,{timeout:i}).then(function(t){return t.json()}).then(function(t){var i=t||{},n=i.code,o=void 0===n?"":n,s=i.data,a=void 0===s?"":s;return 200==+o&&a?e.getCMSDataRetry=0:($e.info("cms","fetch videoinfo fail, error code ["+o+"], stop retry."),e.vm.emit("cmsData",{status:"loadError",api:"cmsData",retry:e.getCMSDataRetry,maxRetry:Po.MAX_CMSDATA_RETRY,url:r,code:o,data:{}}),e.vm.emit("apiRequestError",{type:"error",target:e,rawdata:t,data:Ui({fatal:!0},De.VIDEOINFO_DATA_FAIL)})),{data:a,code:o,url:r}}).catch(function(i){if($e.info("cms","fetch videoinfo timeout, reason "+i),e.vm.emit("cmsData",{status:"loadTimeout",api:"cmsData",retry:e.getCMSDataRetry,maxRetry:Po.MAX_CMSDATA_RETRY,url:r,code:"500",data:{}}),e.getCMSDataRetry++,e.getCMSDataRetry<Po.MAX_CMSDATA_RETRY)return e.getCMSData(t);throw e.vm.emit("apiRequestError",{type:"error",target:e,data:Ui({fatal:!0},De.VIDEOINFO_TIMEOUT)}),i})},e.getSource=function(t,e){var i=this,n=Do(this.vm._config),r=n.tk2,o=n.type,s=Po.GETSOURCE_TIMEOUT[this.getSourceRetry],a=Po.GETSOURCE_RETRY_DOMAINS[this.getSourceRetry]+"/player/getSource?"+vt({_support:"10000000",tk2:r,pm2:e,video_id:t,type:o});if(!(this.getSourceRetry>=Po.MAX_GETSOURCE_RETRY))return $e.info("cms","fetch video source detail, request url is "+a+", retring "+this.getSourceRetry+" nth."),Te(a,{timeout:s}).then(function(t){return t.json()}).then(function(n){if(200!=n.code||!n.data){if($e.info("cms","fetch video source detail fail, status code is ["+n.code+"]."),i.vm.emit("getSource",{status:"loadError",api:"getSource",retry:i.getSourceRetry,maxRetry:Po.MAX_GETSOURCE_RETRY,url:a,code:n.code,data:{}}),i.getSourceRetry++,i.getSourceRetry<Po.MAX_GETSOURCE_RETRY)return i.getSource(t,e).catch(function(t){});throw i.vm.emit("apiRequestError",{type:"error",target:i,data:Ui({fatal:!0},De.SOURCE_DATA_FAIL)}),new Error("retry reach the max limit, stop retry.")}return $e.info("cms","fetch video source detail ok, status code ["+n.code+"]."),n.data.stream=n.data.stream.reverse(),i.vm.emit("getSource",{status:"loadComplete",url:a,code:"200",data:n.data}),i.getSourceRetry=0,n}).catch(function(n){if(i.getSourceRetry<Po.MAX_GETSOURCE_RETRY&&($e.info("cms","fetch video source detail timeout. reason "+n),i.vm.emit("getSource",{status:"loadTimeout",api:"getSource",retry:i.getSourceRetry,maxRetry:Po.MAX_GETSOURCE_RETRY,url:a,code:"500",data:{}})),i.getSourceRetry++,i.getSourceRetry<Po.MAX_GETSOURCE_RETRY)return i.getSource(t,e).catch(function(t){});throw i.vm.emit("apiRequestError",{type:"error",target:i,data:Ui({fatal:!0},De.SOURCE_TIMEOUT)}),n})},e.getNextVideoInfo=function(t,e){var i=this;if(p(t))this.vm.emit("nextVideoInfo",t);else{var n,r,o="",s=!1;if(_(t)&&t.indexOf("&")?(o=t.split("&")[0],s="false"==t.split("&")[1]):o=t.toString(),s){var a=this.vm.getVideoInfo();n=a.cid||"",r=a.plid||""}if(o){var c=this.vm._config.lobparam.cxid||"",h="//pcweb.api.mgtv.com/player/vinfo?"+vt({video_id:o,cid:n,pid:r,cxid:c});return $e.info("cms","fetch nextvideoinfo, request url is "+h),Te(h,{timeout:1e4}).then(function(t){return t.json()}).then(function(t){if(200!=t.code||!t.data)throw $e.info("cms","fetch nextvideoinfo fail, video ["+o+"], status code ["+t.code+"]"),new Error(t.msg);$e.info("cms","fetch nextvideoinfo ok, video ["+o+"], status code ["+t.code+"]"),i.nextVideoInfo=t.data,i.vm.emit("nextVideoInfo",i.nextVideoInfo)}).catch(function(t){$e.info("cms","fetch nextvideoinfo fail, "+t+".")})}$e.info("cms","invalid next video id ["+o+"]")}},e.getDispatcher=function(t,e,i,n,r){var o=this;void 0===i&&(i=0),void 0===n&&(n=""),void 0===r&&(r=!0);var s=this.vm._config.lobparam,a=s.did,c=s.suuid,h=t.stream_domain[i]||t.stream_domain[0],l=t.stream.find(function(t){return~~t.def==e});if(!(i>=Po.MAX_DISPATCHER_RETRY)&&l&&l.url){var d=-1!==l.url.indexOf("?")?"&":"?",u=n?"&svrip="+n:"",p=h+l.url+d+"did="+a+"&suuid="+c+u,f=Po.DISPATCHER_TIMEOUT[i];return $e.info("cms","fetch dispatcher, CDN domain ["+h+"], definition ["+l.name+"], request url "+p+", retring "+i+" nth"),Te(p,{timeout:f}).then(function(t){return t.json()}).then(function(n){if(!n||"ok"!=n.status||!n.info){if($e.info("cms","fetch dispatcher fail, status code ["+n.status+"]"),r&&o.vm.emit("getDispatcher",{status:"loadError",api:"getDispatcher",retry:i,maxRetry:Po.MAX_DISPATCHER_RETRY,url:p,code:n.code||0,data:{}}),++i<Po.MAX_DISPATCHER_RETRY)return o.getDispatcher(t,e,i,"",r);throw r&&o.vm.emit("apiRequestError",{type:"error",target:o,data:Ui({fatal:!0},De.DISPATCHER_DATA_FAIL)}),new Error("retry reach the max limit, stop retry.")}o.sourceInfo=n;try{var s=l.scale.split(":");l.ratio=Number(s[0])/Number(s[1])}catch(t){l.ratio=16/9}return o.sourceInfo.ratio=l.ratio,Co||o.vm._config.useFlash||(o.sourceInfo.info=o.sourceInfo.info.replace(/^http:\/\//,"https://")),$e.info("cms","fetch dispatcher ok. source ["+o.sourceInfo.info+"]"),r&&o.vm.emit("getDispatcher",{status:"loadComplete",url:p,code:"200",data:n.info}),o.sourceInfo}).catch(function(n){if(i<Po.MAX_DISPATCHER_RETRY&&r&&($e.info("cms","fetch dispatcher timeout, "+n+"."),o.vm.emit("getDispatcher",{status:"loadTimeout",api:"getDispatcher",retry:i,maxRetry:Po.MAX_DISPATCHER_RETRY,url:p,code:"500",data:{}})),++i<Po.MAX_DISPATCHER_RETRY)return o.getDispatcher(t,e,i,"",r);throw r&&o.vm.emit("apiRequestError",{type:"error",target:o,data:Ui({fatal:!0},De.DISPATCHER_TIMEOUT)}),n})}},t}();!function(t){t[t.IDLE=0]="IDLE",t[t.FRONT_AD_BEGIN=1]="FRONT_AD_BEGIN",t[t.FRONT_AD_PLAY=2]="FRONT_AD_PLAY",t[t.FRONT_AD_END=3]="FRONT_AD_END",t[t.VIDEO_PLAY=4]="VIDEO_PLAY",t[t.VIDEO_PAUSE=5]="VIDEO_PAUSE",t[t.MID_AD_BEGIN=6]="MID_AD_BEGIN",t[t.MID_AD_END=7]="MID_AD_END",t[t.VIDEO_END=8]="VIDEO_END",t[t.END_AD_BEGIN=9]="END_AD_BEGIN",t[t.END_AD_END=10]="END_AD_END"}(To||(To={}));var Io=To,Lo=/iPad/i.test(navigator.userAgent),Oo="cms",Mo=function(){function t(t){var e=this;this.vm=t.vm,this.dataFetcher=new xo({vm:this.vm}),this.startLevel=-1,this.state=Io.IDLE,this.cfgDeferred=this.dataFetcher.getP2pConfig().then(function(t){var i=t&&t.data;i.p2p&&i.p2p.pc&&(Math.floor(100*Math.random())>i.p2p.pc&&(e.p2pSwitch=!1));return i}).catch(function(t){$e.error(Oo,"get p2p config fail, reason: "+t)}),this.bindEvent(),$e.info(Oo,"cms middleware is created.")}var e=t.prototype;return e.ready=function(t){return this.cfgDeferred.then(function(e){return t(e)})},Object.defineProperty(e,"state",{get:function(){return this._state},set:function(t){this.vm.state=this._state=t},enumerable:!0,configurable:!0}),e.init=function(t){var e=this;this.dashRecoverStreamErrorRetry=0,this.hlsRecoverStreamErrorRetry=0,this.recoverVideoErrorRetry=0,this.hasDrmData=!1,this.hasMp4Source=!1,this.hasDashSource=!1,this.p2pSwitch=!0,this.currrentDef=0,this._state=Io.IDLE,this.video_id=t,this.cdnip="",this.emitMockPlaying=at(function(){"hidden"!=document.visibilityState||!e.vm.isAutoplay||e.state!=Io.FRONT_AD_BEGIN&&e.state!=Io.FRONT_AD_END||e.vm.emit("playing")},2e3),Promise.all([this.cfgDeferred,this.dataFetcher.getCMSData(t)]).then(function(t){t[0];var i,n=t[1],r=n.url,o=n.data,s=n.code;if(200==+s&&o&&($e.info(Oo,"fetch videoinfo ok, status code ["+s+"]."),e.vm.emit("cmsData",{url:r,code:s,data:o,status:"loadComplete"})),o.drm&&o.info&&"1"==o.info.drmFlag){e.vm._config.useFlash=!1;var a=navigator.userAgent.indexOf("Trident")>-1&&navigator.userAgent.indexOf("rv:11.0")>-1,c=document.createElement("video");!a||"onmsneedkey"in c||e.vm.emit("dashStreamError",{data:{error:{code:112,message:"eme is not supported."}}}),i="com.widevine.alpha",1==o.drm.drmType&&(i="com.microsoft.playready"),o.drmData={},o.drmData[i]={serverURL:o.drm.licenseUrl},e.vm.drm=i}e.cmsData=o,e.vm.getCMSDataEvent(e.cmsData)}).catch(function(e){$e.error(Oo,"get video info fail, video id ["+t+"], reason: "+e)})},e.getVinfo=function(t){return this.dataFetcher.getVinfo(t)},e.getCurrentCDN=function(){return(this.fakeMasterPlaylistUrl||wt(this.sourceInfo,"info","")).match(/^(?:https?:\/\/)?(?:[^@\n]+@)?(?:www\.)?([^:\/\n\?\=]+)/im)[1]||""},e.getHighestFisibleDef=function(t,e){var i;if(e)for(var n=0;n<t.length;n++)if(t[n].def==e&&""!=t[n].url){i=t[n];break}if(!i)for(n=0;n<t.length;n++)if(""!=t[n].url){i=t[n];break}return i},e.setNextVideoId=function(t,e){$e.info(Oo,"received next video id ["+t+"]"),this.nextId=t},e.getStartTime=function(){if("200"!=this.cmsData.user.purview)return 0;for(var t=0,e=~~gt("start_time"),i=~~this.cmsData.info.watchTime,n=Se.get("honey-rec")||[],r=0!==Se.get("mango-skip-start"),o=0,s=0;s<n.length;s++)if(this.video_id==n[s].vid){o=~~n[s].time;break}return this.skipStartTime=Number(this.cmsData.points.start.split("|")[0])||0,this.skipEndTime=Number(this.cmsData.points.end.split("|")[0])||0,t=e||i||o||0,(r&&this.skipEndTime?this.skipEndTime:~~this.cmsData.info.duration)-t<=3&&(t=0),r&&this.skipStartTime>0&&t<this.skipStartTime?($e.info(Oo,"skip start is on, seek to "+t),this.vm.emit("showBottomTip",{_type:"skipStartTPL",_time:2e3}),t=this.skipStartTime):t>1&&($e.info(Oo,"continue play from recent watch point, seek to "+t),this.vm.emit("showBottomTip",{_type:"continuePlayTPL",_time:2e3,time:ut(t)})),t},e.loadVideoSource=function(){var t=this.getStartTime(),e=this.sourceInfo&&Tt(this.sourceInfo.info),i=this.sourceInfo&&Rt(this.sourceInfo.info),n="native";this.vm._config.useFlash||this.vm._config.isIpad||e||i?(n=i?"dash":this.vm._config.useFlash?"flash":e?"mp4":"native",$e.info(Oo,"use "+n+" kernel to load video source."),this.vm.load({src:this.sourceInfo.info,ratio:this.sourceInfo.ratio,p2p:this.p2pSwitch,box:n,drmData:this.cmsData.drmData,startPosition:t})):(n="hls",$e.info(Oo,"use "+n+" kernel to load video source."),this.fakeMasterPlaylist?this.preloadKernel?(this.vm.switchKernel(this.preloadKernel),this.vm.play(),this.vm.emit("playing"),this.preloadKernel=null):this.vm.load({src:this.fakeMasterPlaylistUrl,playlist:this.fakeMasterPlaylist,p2p:this.p2pSwitch,drmData:this.cmsData.drmData,startPosition:t,box:n}):this.vm.load({src:this.sourceInfo.info,p2p:this.p2pSwitch,startPosition:t,drmData:this.cmsData.drmData,box:n})),this.vm.emit("videoReady"),$e.info(Oo,"set <video> source attr, send player event [videoReady].")},e.onRecoverHlsStreamError=function(t){this.hlsRecoverStreamErrorRetry<2?($e.info(Oo,"trying recover from hlsStream error, retry "+this.hlsRecoverStreamErrorRetry+"."),t.retry=this.hlsRecoverStreamErrorRetry,this.hlsRecoverStreamError(),this.hlsRecoverStreamErrorRetry++):($e.info(Oo,"send [hlsStreamError] event."),t.retry=this.hlsRecoverStreamErrorRetry,this.vm.emit("hlsStreamError",t))},e.onRecoverDashStreamError=function(t){this.dashRecoverStreamErrorRetry<2?($e.info(Oo,"trying recover from dashStream error, retry "+this.dashRecoverStreamErrorRetry+"."),t.retry=this.dashRecoverStreamErrorRetry,this.recoverVideoError(),this.dashRecoverStreamErrorRetry++):($e.info(Oo,"send [dashStreamError] event."),t.retry=this.dashRecoverStreamErrorRetry,this.vm.emit("hlsStreamError",t))},e.hlsRecoverStreamError=function(){if("hls"==this.vm.box){var t=this.dispatchData.stream;this.mockMasterPlaylist(t,this.currrentDef,this.isAutoDef,!0)}else this.recoverVideoError()},e.recoverVideoError=function(){var t=this;this.dataFetcher.getDispatcher(this.dispatchData,this.currrentDef,0,this.cdnip,!0).then(function(e){t.sourceInfo=e,t.cdnip=Et(t.sourceInfo.info).hostname,t.loadVideoSource()})},e.onPlaying=function(t){var e=this;if(this.state==Io.FRONT_AD_BEGIN){if(!this.vm.manualClickPlay&&!this.vm.isAutoplay)return;return this.state=Io.FRONT_AD_PLAY,$e.info(Oo,"front ad is playing, send player event [frontAdPlay]."),void this.vm.emit("frontAdPlay")}if(this.state==Io.MID_AD_BEGIN)return $e.info(Oo,"middle ad is playing, send player event [midAdPlay]."),void this.vm.emit("midAdPlay");if(this.state!=Io.FRONT_AD_END)return this.state==Io.MID_AD_END?(this.state=Io.VIDEO_PLAY,this.vm._config.isIpad&&this._pauseTime&&(this.vm.seek(this._pauseTime),this._pauseTime=0,this.vm.play()),void this.vm.emit("videoResumeMid")):this.state==Io.VIDEO_PAUSE?(this.state=Io.VIDEO_PLAY,$e.info(Oo,"send player event [videoResume]."),void this.vm.emit("videoResume")):void 0;this.state=Io.VIDEO_PLAY,this.vm.emit("videoPlay"),$e.info(Oo,"video is playing, send player event [videoPlay]."),this.videoPlayTimeoutTimer&&clearTimeout(this.videoPlayTimeoutTimer),this.vm.getPlayEvent(),this.vm.enableFloatWindow(!0);var i=this.vm.getPlayerNextId()||this.nextId;i?this.dataFetcher.getNextVideoInfo(i):setTimeout(function(){(i=e.vm.getPlayerNextId())&&e.dataFetcher.getNextVideoInfo(i)},2e3)},e.onSwitchClarity=function(t){var e=this;$e.info("cms","switch definition to ["+t.name+"].");var i=this.dispatchData.stream.find(function(e){return e.def==t.def});if(i){if(""==i.url)return $e.info("cms","user is not authorized to watch, open hd1080 dialog."),void this.vm.emit("showHdDialog",this.cmsData);var n=this.sourceInfo&&Tt(this.sourceInfo.info),r=this.sourceInfo&&Rt(this.sourceInfo.info);this.vm._config.isIpad||this.vm._config.useFlash||n||r?(this.currrentDef=~~t.def,this.dataFetcher.getDispatcher(this.dispatchData,~~t.def,0).then(function(o){e.sourceInfo=o,e.cdnip=Et(e.sourceInfo.info).hostname;var s=e.vm.currentTime,a=r?"dash":e.vm._config.useFlash?"flash":n?"mp4":"native";e.vm.load({src:o.info,ratio:o.ratio,p2p:e.p2pSwitch,drmData:e.cmsData.drmData,box:a,startPosition:s}),setTimeout(function(){Se.set("mango-def",~~t.def),Se.set("mango-def-auto",t.auto?"1":"0"),$e.info("cms","switch definition ok, definition ["+t.name+"], source ["+o.info+"]."),e.vm.emit("clarityChanged",{error:null,stream:i,auto:t.auto,silent:t.silent})},1e3)}).catch(function(n){$e.info("cms","switch definition fail , "+n+"."),e.vm.emit("clarityChanged",{error:n,stream:i,auto:t.auto,silent:t.silent})})):this.vm.loadLevel(~~t.def-1).then(function(){Se.set("mango-def",~~t.def),Se.set("mango-def-auto",t.auto?"1":"0"),$e.info("cms","switch definition ok, definition ["+t.name+"]"),e.vm.emit("clarityChanged",{error:null,stream:i,auto:t.auto,silent:t.silent})})}},e.onFrontAdBegin=function(t){this.state=Io.FRONT_AD_BEGIN},e.onVideoPrefetch=function(t){var e=this;this.isPreFetchedVideo=!0;var i=this.vm._config.video_id;this.dataFetcher.getSource(i,t.atc.pm2).then(function(t){e.dispatchData=t.data;var i,n=e.dispatchData.stream,r=e.cmsData.user,o=Se.get("mango-def");Lo||(null===Se.get("mango-def-auto")?(i=!0,o="1"):i=!!~~Se.get("mango-def-auto"));var s=e.getHighestFisibleDef(n,o);if(!s)return $e.error("cms","can't find fesible definition for current user, stream="+n),void $e.error("cms","user vip=["+r.isvip+"] purview=["+r.purview+"].");e.hasDrmData="1"==e.cmsData.info.drmFlag,e.hasDashSource=-1!==n.findIndex(function(t){return"MPEG-DASH"===t.fileformat}),e.vm.emit("clarityData",{stream:n,def:s,isAutoDef:i,isDrm:e.hasDrmData}),$e.info("cms","find fesible definition for current user, def=["+s.name+"] index="+s.def+"."),Lo||e.vm._config.useFlash||e.hasDrmData||e.hasMp4Source||e.hasDashSource?(e.currrentDef=~~s.def,e.dataFetcher.getDispatcher(e.dispatchData,e.currrentDef,0).then(function(t){e.sourceInfo=t,e.cdnip=Et(e.sourceInfo.info).hostname,e.state==Io.FRONT_AD_END&&e.loadVideoSource()})):(e.currrentDef=~~s.def,e.isAutoDef=i,e.mockMasterPlaylist(n,e.currrentDef,i,!1))})},e.mockMasterPlaylist=function(t,e,i,n){var r,o=this,s=[],a="#EXTM3U\n",c=n?this.cdnip:"";(t=t.filter(function(t){return""!=t.url})).sort(function(t,e){return Number(t.filebitrate)-Number(e.filebitrate)}),this.levels=t,t.forEach(function(t,n){~~t.def!==e||i?r=i&&0==n?o.dataFetcher.getDispatcher(o.dispatchData,~~t.def,0,c,!0).then(function(t){return o.cdnip=Et(t.info).hostname,t}):o.dataFetcher.getDispatcher(o.dispatchData,~~t.def,0,c,!1):(o.startLevel=n,r=o.dataFetcher.getDispatcher(o.dispatchData,~~t.def,0,c,!0).then(function(t){return o.cdnip=Et(t.info).hostname,t})),s.push(r)}),Promise.all(s).then(function(e){if(e.forEach(function(e,i){if(e){var n=1e3*Number(t[i].filebitrate),r=t[i].name;a+="#EXT-X-STREAM-INF:BANDWIDTH="+n+",NAME="+r+"\n"+e.info+"\n"}}),o.fakeMasterPlaylist=a,o.fakeMasterPlaylistUrl=Et(e[0].info).origin+"/master.m3u8",n||o.state==Io.FRONT_AD_END)o.loadVideoSource(),o.vm.loadLevel(o.startLevel);else{var i=o.getStartTime();o.vm.load2({src:o.fakeMasterPlaylistUrl,playlist:o.fakeMasterPlaylist,p2p:o.p2pSwitch,startPosition:i,drmData:o.cmsData.drmData,box:"hls"}).then(function(t){o.preloadKernel=t})}}).catch(function(t){})},e.onFrontAdEnd=function(t){this.state=Io.FRONT_AD_END,this.isPreFetchedVideo?(this.sourceInfo&&this.loadVideoSource(),this.fakeMasterPlaylist&&(this.loadVideoSource(),this.vm.loadLevel(this.startLevel))):this.onVideoPrefetch(t)},e.onMidAdBegin=function(t){this.state=Io.MID_AD_BEGIN,this._pauseTime=t.time},e.onMidAdEnd=function(){this.state=Io.MID_AD_END;var t=this._pauseTime||0,e=this.sourceInfo&&Tt(this.sourceInfo.info),i=this.sourceInfo&&Rt(this.sourceInfo.info);if(this._pauseTime=0,this.vm._config.isIpad||this.vm._config.useFlash||e||i){var n=i?"dash":this.vm._config.useFlash?"flash":e?"mp4":"native";this.vm.load({src:this.sourceInfo.info,ratio:this.sourceInfo.ratio,p2p:this.p2pSwitch,startPosition:t,drmData:this.cmsData.drmData,box:n})}else this.fakeMasterPlaylist?this.vm.load({src:this.fakeMasterPlaylistUrl,playlist:this.fakeMasterPlaylist,p2p:this.p2pSwitch,startPosition:t,drmData:this.cmsData.drmData,box:"hls"}):this.vm.load({src:this.sourceInfo.info,p2p:this.p2pSwitch,startPosition:t,drmData:this.cmsData.drmData,box:"hls"})},e.onSeeking=function(){"hls"===this.vm.__dispatcher.kernel.box&&this.state==Io.VIDEO_PLAY&&this.vm.startLoad()},e.onSeeked=function(){this.state==Io.VIDEO_PLAY&&($e.info(Oo,"send player event [videoDrag]."),this.vm.emit("videoDrag",{seektime:this.vm.currentTime,isCurPoint:0,dragType:1}),this.vm.getSeekEvent(this.vm.currentTime,this.cmsData.info.duration))},e.onTimeupdate=function(){this.emitMockPlaying()},e.onEnded=function(){this.state!=Io.FRONT_AD_BEGIN&&this.state!=Io.FRONT_AD_PLAY||(this.vm.emit("adFragmentEnd"),$e.info(Oo,"send player event [adFragmentEnd].")),this.state!=Io.VIDEO_PLAY&&this.state!=Io.VIDEO_PAUSE||(this.state=Io.VIDEO_END,this.vm.emit("videoEnd"),$e.info(Oo,"send player event [videoEnd]."),this.vm.getStopEvent()),this.state==Io.END_AD_BEGIN&&(this.state=Io.END_AD_END)},e.onWaiting=function(){this.state!=Io.FRONT_AD_BEGIN&&this.state!=Io.FRONT_AD_PLAY?this.state!=Io.VIDEO_PLAY||this.vm.emit("videoWaiting"):this.vm.emit("frontAdWaiting")},e.onError=function(t){if(void 0===t&&(t={}),t.data=t.data||{},t.data.url=t.data.url||this.sourceInfo&&this.sourceInfo.info,this.state!=Io.FRONT_AD_BEGIN&&this.state!=Io.FRONT_AD_PLAY){if(this.state==Io.FRONT_AD_END||this.state==Io.VIDEO_PLAY)return("native"==this.vm.box||"flash"==this.vm.box)&&this.recoverVideoErrorRetry<2?($e.info(Oo,"trying recover from video error, retry "+this.recoverVideoErrorRetry+"."),t.retry=this.recoverVideoErrorRetry,this.recoverVideoError(),this.recoverVideoErrorRetry++):($e.info(Oo,"send [videoError] event, after retry "+this.recoverVideoErrorRetry+" times."),t.retry=this.recoverVideoErrorRetry),void this.vm.emit("videoError",t)}else this.vm.emit("frontAdError",t)},e.onPlay=function(t){var e=this;this.state==Io.FRONT_AD_END&&(this.vm.emit("videoPlayStart"),(this.vm._config.isIpad||this.vm._config.useFlash)&&(this.videoPlayTimeoutTimer&&clearTimeout(this.videoPlayTimeoutTimer),this.videoPlayTimeoutTimer=setTimeout(function(){$e.info(Oo,"load video source timeout, send video timeout error event.");var t=e.recoverVideoErrorRetry>=2;e.vm.emit("error",{data:{fatal:t,type:"videoNetworkError",code:2,url:e.sourceInfo.info,details:"timeoutError"}})},11e3)))},e.onPause=function(t){this.state==Io.VIDEO_PLAY&&(this.state=Io.VIDEO_PAUSE,this.vm.emit("videoPause"),$e.info(Oo,"send player event [videoPause]."))},e.onVideoWillEnd=function(t){var e=this;t&&t.time&&(this.videoWillEndTimer&&clearTimeout(this.videoWillEndTimer),this.videoWillEndTimer=setTimeout(function(){e.onEnded(),e.vm.stopLoad(),e.vm.pause()},1e3*t.time))},e.onCancelVideoWillEnd=function(){this.videoWillEndTimer&&clearTimeout(this.videoWillEndTimer)},e.onVideoReplay=function(){this.vm.getPlayEvent(),this.state=Io.VIDEO_PLAY,Lo&&this.vm.load({src:this.sourceInfo.info,ratio:this.sourceInfo.ratio,drmData:this.cmsData.drmData,box:"native"})},e.onVideoReload=function(){this.dashRecoverStreamErrorRetry=0,this.hlsRecoverStreamErrorRetry=0,this.recoverVideoErrorRetry=0,this.currrentDef=0,this.hasDrmData=!1,this.p2pSwitch=!0,this.startLevel=-1,this.isPreFetchedVideo=!1,this.sourceInfo=null,this.fakeMasterPlaylist=null,this.fakeMasterPlaylistUrl=null,this.nextId=null,this.preloadKernel=null,this.state=Io.IDLE,this.dataFetcher.reset(),this.vm.stopLoad(),this.vm.pause()},e.onHlsLevelSwitched=function(t){$e.info(Oo,"Hls level switched: "+t.data.prevLevel+" ----\x3e "+t.data.level+".");var e,i=this.levels[t.data.level];e=null===Se.get("mango-def-auto")?1:~~Se.get("mango-def-auto");var n=!1;null==t.data.prevLevel&&(n=!0),this.vm.emit("clarityChanged",{stream:i,auto:e,silent:n})},e.bindEvent=function(){this.vm.on("playing",this.onPlaying),this.vm.on("play",this.onPlay),this.vm.on("pause",this.onPause),this.vm.on("seeking",this.onSeeking),this.vm.on("seeked",this.onSeeked),this.vm.on("waiting",this.onWaiting),this.vm.on("timeupdate",this.onTimeupdate),this.vm.on("ended",this.onEnded),this.vm.on("error",this.onError),this.vm.on("switchClarity",this.onSwitchClarity),this.vm.on("frontAdBegin",this.onFrontAdBegin),this.vm.on("frontAdEnd",this.onFrontAdEnd),this.vm.on("midAdBegin",this.onMidAdBegin),this.vm.on("midAdEnd",this.onMidAdEnd),this.vm.on("videoPrefetch",this.onVideoPrefetch),this.vm.on("videoWillEnd",this.onVideoWillEnd),this.vm.on("cancelVideoWillEnd",this.onCancelVideoWillEnd),this.vm.on("videoReplay",this.onVideoReplay),this.vm.on("videoRefresh",this.onVideoReplay),this.vm.on("videoReload",this.onVideoReload),this.vm.on("hlsLevelSwitched",this.onHlsLevelSwitched),this.vm.on("hlsRecoverStreamError",this.onRecoverHlsStreamError),this.vm.on("dashRecoverStreamError",this.onRecoverDashStreamError)},e.destroy=function(){delete this.cmsData,delete this.dispatchData,delete this.sourceInfo},Wi([_i],t.prototype,"onRecoverHlsStreamError",null),Wi([_i],t.prototype,"onRecoverDashStreamError",null),Wi([_i],t.prototype,"onPlaying",null),Wi([_i],t.prototype,"onSwitchClarity",null),Wi([_i],t.prototype,"onFrontAdBegin",null),Wi([_i],t.prototype,"onVideoPrefetch",null),Wi([_i],t.prototype,"onFrontAdEnd",null),Wi([_i],t.prototype,"onMidAdBegin",null),Wi([_i],t.prototype,"onMidAdEnd",null),Wi([_i],t.prototype,"onSeeking",null),Wi([_i],t.prototype,"onSeeked",null),Wi([_i],t.prototype,"onTimeupdate",null),Wi([_i],t.prototype,"onEnded",null),Wi([_i],t.prototype,"onWaiting",null),Wi([_i],t.prototype,"onError",null),Wi([_i],t.prototype,"onPlay",null),Wi([_i],t.prototype,"onPause",null),Wi([_i],t.prototype,"onVideoWillEnd",null),Wi([_i],t.prototype,"onCancelVideoWillEnd",null),Wi([_i],t.prototype,"onVideoReplay",null),Wi([_i],t.prototype,"onVideoReload",null),Wi([_i],t.prototype,"onHlsLevelSwitched",null),t}(),$o={ERROR_FAIL:"抱歉！视频文件获取失败",ERROR_WRONG:"抱歉！视频文件异常",PLAY_WRONG:"抱歉！视频播放失败",LIU_WRONG:"视频获取失败，请确保您的网络正常"},Fo={LogEvent:{ACT_PV:"pv",ACT_CMSBEGIN:"cmsbegin",ACT_CMSEND:"cmsend",ACT_ROUTEBEGIN:"routebegin",ACT_ROUTEEND:"routeend",ACT_STREAMBEGIN:"streambegin",ACT_ADINIT:"adinit",ACT_AD_FRONT_BEGIN:"adfrontbegin",ACT_AD_FRONT_END:"adfrontend",ACT_ADBEGIN:"adbegin",ACT_ADEND:"adend",ACT_PLAY:"play",ACT_STOP:"stop",ACT_PAUSE:"pause",ACT_RESUME:"resume",ACT_FORWARD:"forward",ACT_BACKWARD:"backward",ACT_DRAG:"drag",ACT_HEARTBEAT:"hb",ACT_NEXT:"next",ACT_OPENFSCREEN:"openfscreen",ACT_CLOSEFSCREEN:"closefscreen",ACT_CHANGEFSCREEN:"changefscreen",ACT_SHARE:"share",ACT_TOVIP:"noad",ACT_POPCLICK:"popclick",ACT_POPCLOSE:"popclose",ACT_VOICE:"voice",ACT_DEFINITION:"definition",ACT_SCALE:"scale",ACT_BRIGHTNESS:"brightness",ACT_CONTRAST:"contrast",ACT_SKIP:"skip",ACT_SEARCH:"psearch",ACT_BUFFER:"buffer",ACT_EXIT_CODE:"exit",ACT_ERROR_CODE:"er",ACT_P2P:"h5p2p"},LogParam:{PARAM_TIME:"time",PARAM_VERSION:"pver",PARAM_CVERSION:"cver",PARAM_SUUID:"suuid",PARAM_GUID:"guid",PARAM_URL:"url",PARAM_COOKIE:"cookie",PARAM_UUID:"uuid",PARAM_CH:"ch",PARAM_SESSIONID:"sessionid",PARAM_ACT:"act",PARAM_BID:"bid",PARAM_IDX:"idx",PARAM_REF:"ref",PARAM_PT:"pt",PARAM_CF:"cf",PARAM_CT:"ct",PARAM_ET:"et",PARAM_TD:"td",PARAM_VTS:"vts",PARAM_VID:"vid",PARAM_PLID:"plid",PARAM_CID:"cid",PARAM_CDNIP:"cdnip",PARAM_PURL:"purl",PARAM_PAY:"pay",PARAM_AP:"ap",PARAM_DEF:"def",PARAM_PSTATUS:"pstatus",PARAM_ISTRY:"istry",PARAM_BDID:"bdid",PARAM_EXT1:"ext1",PARAM_EXT2:"ext2",PARAM_EXT3:"ext3",PARAM_EXT4:"ext4",PARAM_EXT5:"ext5",PARAM_EXT6:"ext6",PARAM_EXT7:"ext7",PARAM_BFTYPE:"bftype",PARAM_HT:"ht",PARAM_BSID:"bsid",PARAM_CPN:"cpn",PARAM_CP:"cp",PARAM_UVIP:"uvip",PARAM_NFID:"nfid",PARAM_RDC:"rdc",PARAM_WVER:"wver",PARAM_MP:"mp",PARAM_PIX:"pix"},RequestType:{CMS:10,DISPATCHER:20,CDN:30,GETSOURCE:40},RequestErrorType:{ERROR_VIDEOINFO_TIMEOUT:{code:12110,msg:$o.ERROR_FAIL},ERROR_CMS_FAIL:{code:101e3,msg:$o.ERROR_FAIL},ERROR_CMS_DATA_FAIL:{code:102e3,msg:$o.ERROR_WRONG},ERROR_CMS_TIMEOUT:{code:103e3,msg:$o.ERROR_FAIL},ERROR_SOURCE_FAIL:{code:101e3,msg:$o.ERROR_FAIL},ERROR_SOURCE_DATA_FAIL:{code:102e3,msg:$o.ERROR_WRONG},ERROR_SOURCE_TIMEOUT:{code:103e3,msg:$o.ERROR_FAIL},ERROR_DISPATCHER_FAIL:{code:201e3,msg:$o.ERROR_FAIL},ERROR_DISPATCHER_DATA_FAIL:{code:202e3,msg:$o.ERROR_WRONG},ERROR_DISPATCHER_TIMEOUT:{code:203e3,msg:$o.ERROR_FAIL},ERROR_DISPATCHER_WRONG:{code:204e3,msg:$o.ERROR_FAIL},ERROR_CDN_STREAM_NOT_FOUND:{code:301e3,msg:$o.ERROR_WRONG},ERROR_CDN_DOWNLOAD_TIMEOUT:{code:302e3,msg:$o.ERROR_WRONG},ERROR_VIDEO_HEAD_TIMEOUT:{code:303e3,msg:$o.ERROR_FAIL},ERROR_CDN_DING_DOWNLOAD_TIMEOUT:{code:304e3,msg:$o.ERROR_PLAY_WRONG},ERROR_CDN_METADATA_PARSE_FAIL:{code:305e3,msg:$o.ERROR_PLAY_WRONG},ERROR_CDN_NETWORK_ERROR:{code:306e3,msg:$o.ERROR_FAIL},ERROR_CDN_MEDIA_ERROR:{code:307e3,msg:$o.ERROR_PLAY_WRONG},ERROR_MEDIA_ERR_ABORTED:{code:307001,msg:$o.ERROR_PLAY_WRONG},ERROR_MEDIA_ERR_NETWORK:{code:307002,msg:$o.ERROR_PLAY_WRONG},ERROR_MEDIA_ERR_DECODE:{code:307003,msg:$o.ERROR_PLAY_WRONG},ERROR_MEDIA_ERR_SRC_NOT_SUPPORTED:{code:307004,msg:$o.ERROR_PLAY_WRONG},ERROR_HLS_BUFFER_APPENDING:{code:307005,msg:$o.ERROR_PLAY_WRONG},ERROR_HLS_BUFFER_FULL:{code:307006,msg:$o.ERROR_PLAY_WRONG},ERROR_HLS_SEGMENT_PARSING:{code:307007,msg:$o.ERROR_PLAY_WRONG},ERROR_HLS_FRAG_DECRYPT:{code:307008,msg:$o.ERROR_PLAY_WRONG},ERROR_HLS_BUFFER_STALLED:{code:307009,msg:$o.ERROR_PLAY_WRONG},ERROR_CDN_OTHER_ERROR:{code:308e3,msg:$o.ERROR_PLAY_WRONG},ERROR_DRM_NOT_SUPPORT_ERROR:{code:309001,msg:$o.ERROR_PLAY_WRONG},ERROR_DRM_FAIL_ERROR:{code:309002,msg:$o.ERROR_PLAY_WRONG}}},No=Fo.LogParam,Vo=Fo.RequestType,Ho="//v1-play.log.mgtv.com/info.php?",Bo=/iPad/i.test(navigator.userAgent),Uo=function(){function t(t){this.init(t)}var i=t.prototype;return i.init=function(t){this.config=t||this.config,this.method=this.config.method,this.videoUrl="",this.mHeartBeatTimerTicker=0,this.mBufferEmpty=0,this.mHeartBeatTimeValue=3e5,this.mVideoPlayTime=0,this.commonParams={},this.commonParams.p=Bo?"5":"13",this.commonParams.t=this.config.isLive?"1":"0",this.commonParams.cv="20170105",this.commonParams.v="imgotv-"+this.config.pcore+"-"+this.config.pver,this.commonParams.c=1,this.commonParams.pt=4,this.commonParams.ld=this.method.getSessionId(),this.setA(0),this.setU(),this.canPlayParams={},this.canPlayParams[No.PARAM_BID]=Bo?"1.1.26":"1.1.90",this.canPlayParams[No.PARAM_SUUID]=this.method.getSuuid(),this.canPlayParams[No.PARAM_COOKIE]=this.method.getCookie(),this.canPlayParams[No.PARAM_CH]=this.method.getCxid(),this.canPlayParams[No.PARAM_URL]=document.location.href||"",this.canPlayParams[No.PARAM_REF]=location.referrer||document.referrer||"",this.canPlayParams[No.PARAM_MP]=0,this.canPlayParams[No.PARAM_SESSIONID]=this.method.getSessionId(),this.canPlayParams[No.PARAM_WVER]=this.config.wver,this.sendHeartbeat=this._sendHeartbeat.bind(this)},i.setPCore=function(t){this.config.pcore=t,this.commonParams.v="imgotv-"+this.config.pcore+"-"+this.config.pver},i.setV=function(t){this.commonParams.v=t},i.setU=function(){this.commonParams.u=this.method.getGUID()},i.setB=function(t){switch(t){case"流畅":this.commonParams.b=0;break;case"标清":this.commonParams.b=1;break;case"高清":this.commonParams.b=2;break;case"超清":this.commonParams.b=3;break;case"蓝光":this.commonParams.b=4;break;default:this.commonParams.b=2}},i.setA=function(t){this.commonParams.a=t},i.start=function(){this.startHeartbeat()},i.bufferEmptyCount=function(){this.mBufferEmpty++,1==this.mBufferEmpty&&this.sendFirstBuffer()},i.setVideoUrl=function(t){this.videoUrl=t.h},i.stop=function(){this.sendPlayComplete(),this.stopHeartbeat()},i.startHeartbeat=function(){0==this.mHeartBeatTimerTicker&&(this.mHeartBeatTimerTicker=setInterval(this.sendHeartbeat,this.mHeartBeatTimeValue),this.sendHeartbeat())},i.stopHeartbeat=function(){clearInterval(this.mHeartBeatTimerTicker),this.mHeartBeatTimerTicker=0,this.mBufferEmpty=0},i.sendFirstBuffer=function(){var t={};if(t.f=this.mBufferEmpty,t.r="0",t.o=this.mVideoPlayTime,this.videoUrl){var e=this.method.parseURL(this.videoUrl);t.h=e.host,t.l=e.relative}this.sendLog(Ho,t)},i._sendHeartbeat=function(){var t={};if(t.f=this.mBufferEmpty,t.r="1",this.videoUrl){var e=this.method.parseURL(this.videoUrl);t.h=e.host,t.l=e.relative,this.sendLog(Ho,t)}this.mBufferEmpty=0},i.sendError=function(t){var e={};if(this.videoUrl){var i=this.method.parseURL(this.videoUrl);e.h=i.host,e.l=i.relative}e.f="1",e.r="2",e.e=t.code,e.o=this.mVideoPlayTime,this.sendLog(Ho,e)},i.sendPlayComplete=function(){var t={};if(this.videoUrl){var e=this.method.parseURL(this.videoUrl);t.h=e.host,t.l=e.relative}t.f=this.mBufferEmpty,t.r="3",t.o=this.mVideoPlayTime,this.sendLog(Ho,t)},i.sendRequestResult=function(t){var e={};if(e.s=this.createS(t.type),e.f=t.f,t.h){var i=this.method.parseURL(t.h);e.h=i.host,e.l=i.relative}for(var n in null!=t.a&&(this.commonParams.a=t.a),e.si=this.method.findSI(t.h),t.code&&(e.e=t.code),e.z=t.z,e.type=Number(e.s)-1,e.time=this.method.getTime(),this.canPlayParams)e[n]=this.canPlayParams[n];this.sendLog("//v2.log.mgtv.com/info.php?",e)},i.createS=function(t){var e="";switch(t){case Vo.CMS:e="10";break;case Vo.GETSOURCE:e="1";break;case Vo.DISPATCHER:e="2";break;case Vo.CDN:e="3"}return e},i.sendLog=function(t,e){var i=a({},this.commonParams,e);Xe(t+this.method.params(i))},e(t,[{key:"VideoPlayTime",set:function(t){this.mVideoPlayTime=t}}]),t}(),Wo=Fo.LogEvent,zo=/iPad/i.test(navigator.userAgent),jo=zo?"1.1.26":"1.1.90",qo=function(){function t(t){this.init(t)}var e=t.prototype;return e.init=function(t,e){this.config=t||this.config,this.method=this.config.method,this.stats={},this._hbIntervalTimeArr=[15e3,3e4,15e3,12e4],this._hbIntervalTypeArr=["3","4","5","6"],this._pstatus=-1;var i="0";this.config.liveType&&("tv"===this.config.liveType?i="1":"scene"===this.config.liveType&&(i="4"));var n=this.commonParams={};n.suuid=this.method.getSuuid(),n.cookie=this.method.getCookie(),n.uuid=this.method.getUUID(),n.guid=this.method.getGUID(),n.ch=this.method.getCxid(),n.uvip=this.method.getUVIP(),n.url=document.location.href||"",n.ref=location.referrer||document.referrer||"",n.ap="0",n.ext1="0",n.ext2="html5",n.bid="1.1.1",n.time="",n.pver="imgotv-"+this.config.pcore+"-"+this.config.pver,n.cver="h5."+this.config.cver,n.sessionid="",n.act="",n.idx="",n.pt=i,n.cf="",n.ct="",n.et="",n.td="",n.vts="",n.vid="",n.plid="",n.cid="",n.bsid="",n.pay="",n.def="",n.pstatus="",n.istry="",n.bdid="",n.ht="",n.bftype="",n.cpn="1",n.nfid=this.method.getNFID(),n.wver=this.config.wver,n.cp="",n.rdc="",n.mp="0",this.hbTimerHandler=this.onTimerHandler.bind(this),this.getCurHBType=this._getCurHBType.bind(this),this.resetData(e)},e.setStats=function(t){this.stats=t},e.setDrmInfo=function(t){this.drmInfo=t},e.setMp=function(t){this.commonParams.mp=t},e.setPCore=function(t){this.config.pcore=t,this.commonParams.pver="imgotv-"+this.config.pcore+"-"+this.config.pver},e.resetData=function(t){this._hbIdx=0,this._dragIdx=0,this._pauseIdx=0,this._resumeIdx=0,this._forwardIdx=0,this._backwardIdx=0,this._openFSIdx=0,this._closeFSIdx=0,this._changeFSIdx=0,this._shareIdx=0,this._noADIdx=0,this._setVoiceIdx=0,this._setDefIdx=0,this._setScaleIdx=0,this._setBrightIdx=0,this._setContrastIdx=0,this._setSkipIdx=0,this._bufferEmptyTime=0,this._bufferIdx=0,this._adNumDict={},t||(this.drmInfo={}),this.clearHBTimer()},e.setVideoInfo=function(t){if(t.info&&(this.commonParams.vid=t.info.video_id||"",this.commonParams.cid=t.info.root_id||"",this.commonParams.plid=t.info.collection_id||"",this.commonParams.bsid=t.info.series_id||"",this.commonParams.cf=t.info.clip_type||"",this.commonParams.pay=t.info.paymark||"",this.commonParams.vts=t.info.duration||""),t.user&&(this.commonParams.uuid=t.user.uuid,this.commonParams.uvip=t.user.isvip,this.commonParams.istry=200==t.user.purview?"0":"1"),t.drm){var e=t.drm;t.info&&(e.drmFlag=t.info.drmFlag),this.setDrmInfo(e)}},e.convertPStatus=function(t){var e="";switch(t){case-1:e="initialize";break;case 0:e="ad";break;case 1:e="play";break;case 2:e="buffer";break;case 3:e="pause";break;case 4:e="seek";break;case 5:e="stop"}return e},e.convertVideoScale=function(t){var e=0;switch(t){case"默认":e=0;break;case"4:3":e=1;break;case"16:9":e=2}return e},e.actCMSBegin=function(t,e){void 0===t&&(t=""),void 0===e&&(e=""),t&&""!=t&&(this.commonParams.vid=t),e&&(this.commonParams.bdid=e);var i={bid:jo};this.sendLog(Wo.ACT_CMSBEGIN,i)},e.actCMSEnd=function(t,e){e&&this.setVideoInfo(e);var i={bid:jo,ext4:t?1:0};this.sendLog(Wo.ACT_CMSEND,i)},e.actRouteBegin=function(t){if(this.commonParams.def=this.method.convertDefinition(t),!(this._setDefIdx>0)){var e={bid:jo};this.sendLog(Wo.ACT_ROUTEBEGIN,e)}},e.actRouteEnd=function(t,e){if(void 0===e&&(e=null),e&&this.setVideoInfo(e),!(this._setDefIdx>0)){var i={ext4:t?1:0,bid:jo};this.sendLog(Wo.ACT_ROUTEEND,i)}},e.actStreamBegin=function(){if(!(this._setDefIdx>0)){var t={bid:jo};this.sendLog(Wo.ACT_STREAMBEGIN,t),this._bufferEmptyTime=(new Date).getTime()}},e.actAdInit=function(){var t={bid:jo};this.sendLog(Wo.ACT_ADINIT,t)},e.actAdFrontBegin=function(t,e,i,n){void 0===n&&(n=0);var r={bid:jo,ext4:t,ext5:e,ext6:i,ext7:n};this._adNumDict[e]=n,this.sendLog(Wo.ACT_AD_FRONT_BEGIN,r)},e.actAdFrontEnd=function(t,e,i,n){void 0===n&&(n=0);var r={bid:jo,ext4:t,ext5:e,ext6:i,ext7:n};this._adNumDict[e]=n,this.sendLog(Wo.ACT_AD_FRONT_END,r)},e.updateADProgress=function(t){switch(t.progress){case 1:t.type>0&&t.type<=3&&(t.ids&&(t.aid=t.ids.join("_"),t.time=t.duration,t.adNum=t.count),this.actADBegin(t.aid,t.type-1,t.time,t.adNum?t.adNum:0));break;case 2:break;case 3:this._adNumDict[t.type-1]&&(t.ids&&(t.aid=t.ids.join("_"),t.time=t.duration,t.adNum=t.count),this.actADEnd(t.aid,t.type-1,t.time,t.adNum))}},e.actADBegin=function(t,e,i,n){void 0===n&&(n=0),this._pstatus=0,this._adNumDict[e]?this._adNumDict[e]++:this._adNumDict[e]=1;var r={bid:jo,ext4:t,ext5:e,ext6:i,ext7:n};this.sendLog(Wo.ACT_ADBEGIN,r)},e.actADEnd=function(t,e,i,n){var r={bid:jo,ext4:t,ext5:e,ext6:i,ext7:n};this.sendLog(Wo.ACT_ADEND,r)},e.actPlayStart=function(t){var e,i=this.config.getVideoInfo();this._pstatus=1;var n=((e={bid:zo?"4.0.3":this.config.isLive?"1.1.1.1":"1.1.1.0",isad:this._adNumDict[0]?1:0,cdnip:"",ftl:"",ap:t}).ftl="",e.ctl=i.mod,e.isdrm=this.drmInfo.drmFlag||"0",e);this.sendLog(Wo.ACT_PLAY,n),this.startHB()},e.startHB=function(){var t=this.getCurDelay();this._hbTimer||clearTimeout(this._hbTimer),this._hbTimer=setTimeout(this.hbTimerHandler,t),this._hbStartTime=(new Date).getTime(),this._hbLeftTime=t},e.getCurDelay=function(){var t=this._hbIntervalTimeArr.length;return this._hbIntervalTimeIndex=this._hbIdx<t?this._hbIdx:t-1,this._hbIntervalTimeArr[this._hbIntervalTimeIndex]},e.pauseHB=function(){clearTimeout(this._hbTimer),this._hbLeftTime=this._hbLeftTime-((new Date).getTime()-this._hbStartTime)},e.resumeHB=function(){this._hbTimer=setTimeout(this.hbTimerHandler,this._hbLeftTime),this._hbStartTime=(new Date).getTime()},e.stopHB=function(){this.sendHB(),this.clearHBTimer()},e.clearHBTimer=function(){this._hbLeftTime=0,this._hbStartTime=0,clearTimeout(this._hbTimer),this._hbTimer=0},e.onTimerHandler=function(){this.sendHB(),this._hbStartTime=(new Date).getTime();var t=this.getCurDelay();this._hbLeftTime=t,this._hbTimer||clearTimeout(this._hbTimer),this._hbTimer=setTimeout(this.hbTimerHandler,t)},e.sendHB=function(){var t=this.stats,e={ht:this.getCurHBType(),idx:this._hbIdx,bid:zo?"1.1.26":"1.1.25",pflow:~~t.p2p||0,tflow:~~t.total||0,switcher:0,submit:0},i=zo?"//padweb-v0.log.mgtv.com/hb.php?":null;this.sendLog(Wo.ACT_HEARTBEAT,e,i),this._hbIdx++},e._getCurHBType=function(){return 5==this._pstatus?"2":this._hbIntervalTypeArr[this._hbIntervalTimeIndex]},e.updatePlayTime=function(t){this.commonParams.ct=Math.round(t)},e.setDef=function(t){this.commonParams.def=this.method.convertDefinition(t)},e.actPlayPause=function(){this._pstatus=3,this.pauseHB();var t={idx:this._pauseIdx};this.sendLog(Wo.ACT_PAUSE,t),this._pauseIdx++},e.actPlayResume=function(){this._pstatus=1,this.resumeHB();var t={idx:this._resumeIdx};this.sendLog(Wo.ACT_RESUME,t),this._resumeIdx++},e.actPlayForward=function(t){this._pstatus=4,this._bufferEmptyTime=(new Date).getTime();var e={et:t,idx:this._forwardIdx};this.sendLog(Wo.ACT_FORWARD,e),this._pstatus=1,this._forwardIdx++},e.actPlayBackward=function(t){this._pstatus=4,this._bufferEmptyTime=(new Date).getTime();var e={et:t,idx:this._backwardIdx};this.sendLog(Wo.ACT_BACKWARD,e),this._pstatus=1,this._backwardIdx++},e.actDrag=function(t,e,i){this._pstatus=4,this._bufferEmptyTime=(new Date).getTime();var n={et:t,idx:this._dragIdx,ext4:e?1:0,ext5:i};this.sendLog(Wo.ACT_DRAG,n),this._dragIdx++,this._pstatus=1},e.actPlayBufferEmpty=function(){this._pstatus=2,this._bufferEmptyTime>0||(this._bufferEmptyTime=(new Date).getTime())},e.actPlayBufferFull=function(){this._pstatus=1},e.actBuffer=function(t){if(this._bufferEmptyTime>0){var e={td:(new Date).getTime()-this._bufferEmptyTime,bftype:t,bid:zo?"1.1.26":"1.1.25",idx:this._bufferIdx},i=zo?"//padweb-v0.log.mgtv.com/buffer.php?":null;this.sendLog(Wo.ACT_BUFFER,e,i),this._bufferIdx++,this._bufferEmptyTime=0}},e.actPlayStop=function(){this._pstatus=5,this.stopHB()},e.actReplay=function(){this.resetData()},e.actNext=function(){this.sendLog(Wo.ACT_NEXT)},e.actOpenFullScreen=function(){var t={idx:this._openFSIdx};this.sendLog(Wo.ACT_OPENFSCREEN,t),this._openFSIdx++},e.actCloseFullScreen=function(){var t={idx:this._closeFSIdx};this.sendLog(Wo.ACT_CLOSEFSCREEN,t),this._closeFSIdx++},e.actChangeFullScreen=function(t){var e={ext4:this.method.convertChangeFSScale(t),idx:this._changeFSIdx};this.sendLog(Wo.ACT_CHANGEFSCREEN,e),this._changeFSIdx++},e.actShare=function(t,e){var i={ext4:t,ext5:e,idx:this._shareIdx};this.sendLog(Wo.ACT_SHARE,i),this._shareIdx++},e.actNoAD=function(){var t={idx:this._noADIdx};this.sendLog(Wo.ACT_TOVIP,t),this._noADIdx++},e.actPopClick=function(t){var e={ext4:t};this.sendLog(Wo.ACT_POPCLICK,e)},e.actPopClose=function(t){var e={ext4:t};this.sendLog(Wo.ACT_POPCLOSE,e)},e.actSetVoice=function(t){var e={ext4:t,idx:this._setVoiceIdx};this.sendLog("voice",e),this._setVoiceIdx++},e.actSetDef=function(t){this._bufferEmptyTime=(new Date).getTime();var e=this.method.convertDefinition(t),i={idx:this._setDefIdx,ext4:e};this.sendLog("definition",i),this._setDefIdx++,this.commonParams.def=e},e.actSetScale=function(t){var e={ext4:t,idx:this._setScaleIdx};this.sendLog("scale",e),this._setScaleIdx++},e.actSetBrightness=function(t){var e={ext4:t,idx:this._setBrightIdx};this.sendLog("brightness",e),this._setBrightIdx++},e.actSetContrast=function(t){var e={ext4:t,idx:this._setContrastIdx};this.sendLog("contrast",e),this._setContrastIdx++},e.actSetSkip=function(t){var e={ext4:t,idx:this._setSkipIdx};this.sendLog("skip",e),this._setSkipIdx++},e.actErrorCode=function(t,e,i,n,r){var o={c:t,z:n,api:e,pcode:i,bid:"1.1.91",msg:r};this.sendLog("er",o)},e.actExitCode=function(t){var e={code:t,bid:jo};this.sendLog("exit",e)},e.actAutoPlayFail=function(){var t={bid:jo};this.sendLog("autoplayfail",t)},e.actDrm=function(t,e,i){if(!this.drmInfo||"0"!=this.drmInfo.drmFlag){var n={bid:"1.2.11",retry:"0",ec:t,em:e,lic:i,firm:this.drmInfo.drmFirm||"",drmType:this.drmInfo.drmType||"",browser:this.method.getBrowser()};this.sendLog("drm",n)}},e.actManualClickPlay=function(){var t={bid:jo};this.sendLog("clickplay",t)},e.sendLog=function(t,e,i){void 0===e&&(e={}),this.commonParams.act=t,this.commonParams.time=this.method.getTime(),this.commonParams.sessionid=this.method.getSessionId(),this.commonParams.pstatus=this.convertPStatus(this._pstatus),this.updateVideoInfo();var n=a({},this.commonParams,e);Xe((i||"//pcweb-v1.log.mgtv.com/dispatcher.do?")+this.method.params(n))},e.updateVideoInfo=function(){var t=this.config.getVideoInfo();this.commonParams.cpn=t.cpn,this.commonParams.vid=t.vid,this.commonParams.plid=t.cid,this.commonParams.cid=t.rid,this.commonParams.bsid=t.sid,this.commonParams.bdid=t.bdid,this.commonParams.ctl=t.mod},e.updateLiveInfo=function(t){for(var e in t)if(t.hasOwnProperty(e)){t[e];this.commonParams[e]=t[e]}},t}(),Go=Fo.LogParam,Ko=/iPad/i.test(navigator.userAgent),Yo=function(){function t(t){this.config=t||this.config,this.method=this.config.method,this.commonParams={},this.commonParams[Go.PARAM_SUUID]=this.method.getSuuid(),this.commonParams[Go.PARAM_COOKIE]=this.method.getCookie(),this.commonParams[Go.PARAM_SESSIONID]="",this.commonParams[Go.PARAM_UUID]=this.method.getUUID(),this.commonParams[Go.PARAM_GUID]=this.method.getGUID(),this.commonParams[Go.PARAM_CH]=this.method.getCxid(),this.commonParams[Go.PARAM_UVIP]=this.method.getUVIP(),this.commonParams[Go.PARAM_URL]=document.location.href||"",this.commonParams[Go.PARAM_REF]=document.referrer||"",this.commonParams[Go.PARAM_NFID]=this.method.getNFID(),this.commonParams[Go.PARAM_PIX]=this.method.getScreenPIX(),this.commonParams[Go.PARAM_WVER]=this.config.wver,this.commonParams[Go.PARAM_VID]="",this.commonParams[Go.PARAM_PLID]="",this.commonParams[Go.PARAM_CID]="",this.commonParams[Go.PARAM_CF]="",this.commonParams[Go.PARAM_RDC]=""}var e=t.prototype;return e.getUNID=function(t){return t.playlist_id?"0_"+t.playlist_id+"_"+(t.video_id||""):(t.collection_id||"")+"_"+(t.video_id||"")},e.setVideoInfo=function(t){t.info&&(this.commonParams[Go.PARAM_VID]=t.info.video_id||"",this.commonParams[Go.PARAM_CID]=t.info.root_id||"",this.commonParams[Go.PARAM_PLID]=t.info.collection_id||"",this.commonParams[Go.PARAM_BSID]=t.info.series_id||"",this.commonParams[Go.PARAM_CF]=t.info.clip_type||""),t.user&&(this.commonParams[Go.PARAM_UUID]=t.user.uuid,this.commonParams[Go.PARAM_UVIP]=t.user.isvip,this.commonParams[Go.PARAM_ISTRY]=200==t.user.purview?"0":"1"),this.data_unid=this.getUNID(t.info)},e.showVipDialog=function(t){var e=this.method.getUVIP(),i=0;t.info&&"live"==t.info.paymark&&(i="10"),t.info&&"1"==t.info.paymark&&(i="1"),t.info&&"2"==t.info.paymark&&(i="5"),t.info&&"3"==t.info.paymark&&(i="3");var n={bid:Ko?"4.1.11":"1.1.11",uvip:e,ext1:3,ext2:"",ext3:i,ch:""};this.sendLog("tovippv",n,"//vip.log.mgtv.com/audit_pc.html?")},e.showHdDialog=function(t){var e=this.method.getUVIP(),i={bid:Ko?"4.1.11":"1.1.11",dname:"pc_dialogpv_player_blue",ptype:3,uvip:e,unid:this.data_unid,dmtype:""};this.sendLog("dialogpv",i,"//vip.log.mgtv.com/audit_vip_bhv.html?")},e.sendLog=function(t,e,i){void 0===e&&(e=null),this.commonParams[Go.PARAM_ACT]=t,this.commonParams[Go.PARAM_TIME]=this.method.getTime(),this.commonParams[Go.PARAM_SESSIONID]=this.method.getSessionId();var n=a({},e,this.commonParams);Xe(i+this.method.params(n))},t}(),Xo=Fo.RequestErrorType,Qo=Fo.RequestType,Jo=function(){function t(t){this.mStates=0,this.mplayType=0,this.isSwitching=!1,this.isUserDrag=!1,this.hasAd=!1,this.playingAd=!1,this.config=t,this.cdnLog=new Uo(t),this.actionLog=new qo(t),this.vipLog=new Yo(t)}var e=t.prototype;return e.playAdStart=function(){this.hasAd=!0,this.playingAd=!0,this.actionLog.actAdInit()},e.playAdBegin=function(){this.actionLog.actAdFrontBegin()},e.playAdEnd=function(t,e,i,n){void 0===n&&(n=0),this.playingAd=!1,this.actionLog.actAdFrontEnd(t,e,i,n),this.actionLog.actADEnd(t,e,i,n)},e.playExit=function(t){this.actionLog.actExitCode(t)},e.playStart=function(t){var e=t.ap;this.mStates=2,this.cdnLog.start(),this.actionLog.actPlayStart(e)},e.playStop=function(){this.mStates=3,this.cdnLog.stop(),this.actionLog.actPlayStop()},e.playPause=function(){this.actionLog.actPlayPause()},e.playResume=function(){this.actionLog.actPlayResume()},e.videoReplay=function(t){void 0===t&&(t=1),this.mplayType=2,this.actionLog.init(null,!0),this.actionLog.setMp(2),this.actionLog.actPlayStart(t),this.cdnLog.init()},e.videoRefresh=function(t){void 0===t&&(t=1),this.mplayType=3,this.actionLog.init(),this.actionLog.setMp(3),this.actionLog.actPlayStart(t),this.cdnLog.init()},e.videoReload=function(){this.mplayType=1,this.actionLog.init(),this.actionLog.setMp(1),this.cdnLog.init()},e.playDrag=function(t){var e=this;this.actionLog.actDrag(t.seektime,t.isCurPoint,t.dragType),this.isUserDrag=!0,setTimeout(function(){e.isUserDrag=!1},1e3)},e.errorCode=function(t){this.actionLog.actErrorCode(t.c,t.api,t.pcode,t.z,t.msg)},e.playSwitch=function(t){this.actionLog.actSetDef(t),this.cdnLog.setB(t),this.cdnLog.setA(1)},e.playBufferEmpty=function(){2==this.mStates&&(this.isUserDrag||this.cdnLog.bufferEmptyCount()),this.actionLog.actPlayBufferEmpty()},e.playBufferFull=function(){this.actionLog.actPlayBufferFull(),1==this.mStates?this.actionLog.actBuffer(1):2==this.mStates&&(this.isSwitching?(this.isSwitching=!1,this.actionLog.actBuffer(4)):this.actionLog.actBuffer(this.isUserDrag?3:2),this.isUserDrag=!1)},e.requestStart=function(t){switch(t.type){case Qo.CMS:this.actionLog.actCMSBegin(t.vid,t.bdid);break;case Qo.DISPATCHER:this.actionLog.actRouteBegin(t.def);break;case Qo.CDN:this.actionLog.actStreamBegin()}},e.requestSuccess=function(t){switch(t.f="0",t.z="1",this.cdnLog.sendRequestResult(t),t.type){case Qo.GETSOURCE:break;case Qo.CMS:this.actionLog.actCMSEnd(!0,t.data),this.vipLog.setVideoInfo(t.data);break;case Qo.DISPATCHER:this.actionLog.actRouteEnd(!0);break;case Qo.CDN:this.cdnLog.setVideoUrl(t)}},e.requestError=function(t){if(t.type!=Qo.CDN||t.code!=Xo.ERROR_CDN_DING_DOWNLOAD_TIMEOUT){if(t.type!=Qo.CMS||"40001"!=t.pcode&&"40002"!=t.pcode&&"40003"!=t.pcode&&"40004"!=t.pcode&&"40005"!=t.pcode?(t.f="-1",this.cdnLog.sendRequestResult(t)):(t.f="0",t.z="1",this.cdnLog.sendRequestResult(t)),"1"==t.z)switch(t.type){case Qo.GETSOURCE:break;case Qo.CMS:this.actionLog.actCMSEnd(!1,t);break;case Qo.DISPATCHER:this.actionLog.actRouteEnd(!1,t);break;case Qo.CDN:}}else 2==this.mStates&&this.cdnLog.sendError(t)},e.updatePcore=function(t){this.config.pcore=t,this.actionLog.setPCore(t),this.cdnLog.setPCore(t)},e.updatePlayTime=function(t){this.actionLog.updatePlayTime(t),this.cdnLog.VideoPlayTime=t},e.updateDef=function(t){this.cdnLog.setB(t),this.actionLog.setDef(t)},e.showVipDialog=function(t){this.vipLog.showVipDialog(t)},e.showHdDialog=function(t){this.vipLog.showHdDialog(t)},e.updateVersion=function(t){this.config.pcore=t},e.autoPlayFail=function(){this.actionLog.actAutoPlayFail()},e.manualClickPlay=function(){this.actionLog.actManualClickPlay()},e.updateLiveInfo=function(t){this.actionLog.updateLiveInfo(t)},e.actDrm=function(t,e,i){this.actionLog.actDrm(t,e,i)},t}(),Zo=function(){var t=self.navigator.userAgent.toLowerCase(),e=/(edge)\/([\w.]+)/.exec(t)||/(opr)[\/]([\w.]+)/.exec(t)||/(chrome)[ \/]([\w.]+)/.exec(t)||/(iemobile)[\/]([\w.]+)/.exec(t)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[],i=/(ipad)/.exec(t)||/(ipod)/.exec(t)||/(windows phone)/.exec(t)||/(iphone)/.exec(t)||/(kindle)/.exec(t)||/(android)/.exec(t)||/(windows)/.exec(t)||/(mac)/.exec(t)||/(linux)/.exec(t)||/(cros)/.exec(t)||[],n={browser:e[5]||e[3]||e[1]||"",version:e[2]||e[4]||"0",majorVersion:e[4]||e[2]||"0",platform:i[0]||""},r={};if(n.browser){r[n.browser]=!0;var o=n.majorVersion.split(".");r.version={major:parseInt(n.majorVersion,10),string:n.version},o.length>1&&(r.version.minor=parseInt(o[1],10)),o.length>2&&(r.version.build=parseInt(o[2],10))}return n.platform&&(r[n.platform]=!0),(r.chrome||r.opr||r.safari)&&(r.webkit=!0),(r.rv||r.iemobile)&&(r.rv&&delete r.rv,n.browser="msie",r.msie=!0),r.edge&&(delete r.edge,n.browser="msedge",r.msedge=!0),r.opr&&(n.browser="opera",r.opera=!0),r.safari&&r.android&&(n.browser="android",r.android=!0),r.name=n.browser,r.platform=n.platform,r}(),ts={stk:{}},es=function(){};ts.parseURL=function(t){var e=document.createElement("a");e.href=t;var i=e.hash,n=i.split("?");i=n.shift();var r,o=e.search;return!o&&n&&n.length>0&&(o="?"+n.join("&")),{source:t,protocol:e.protocol.replace(":",""),host:e.hostname,port:e.port,query:o,file:(e.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:i.replace("#",""),path:e.pathname.replace(/^([^\/])/,"/$1"),relative:(e.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:e.pathname.replace(/^\//,"").split("/"),params:(r={},o.replace(/\?/g,"&").split("&").filter(function(t,e){if(""!==t&&t.indexOf("="))return!0}).forEach(function(t,e){var i=t.indexOf("="),n=t.substring(0,i),o=t.substring(i+1);r[n]=o}),r)}},ts.GetWWW=function(t,e){void 0===e&&(e=0);var i=new RegExp("//([^/]+)/","im");return t.match(i)[e]||""},ts.getHost=function(t){return ts.GetWWW(t,1)},ts.findSI=function(t){var e=new RegExp("(^|&|\\?)gsid=([^&]*)(&|$)","im"),i=t&&t.match(e);return null==i?"":i[2]},ts.getGUID=function(){return wt(this,"stk.$.cookie.get",es)("MQGUID")||""},ts.getCxid=function(){return wt(this,"stk.$.getRequest",es)("cxid")||""},ts.getUVIP=function(){return wt(this,"stk.$.cookie.get",es)("vipStatus")||"0"},ts.getScreenPIX=function(){var t=window.screen;return t.width+"X"+t.height},ts.getNFID=function(){var t="",e=window.screen,i=e.width,n=e.height,r=wt(this,"stk.$.os.sys",""),o=wt(this,"stk.$.getFootprintId");return o?t=o()||"":window.Fingerprint&&(t=new window.Fingerprint({screen_resolution:!0}).get()),t+i+"X"+n+r},ts.getSuuid=function(){return wt(this,"stk.$.getSessionStorage",es)("player_suuid")||""},ts.getUUID=function(){return wt(this,"stk.$.uuid",es)()||""},ts.getCookie=function(){return wt(this,"stk.$.stkuuid",es)()||""},ts.getSessionId=function(){return wt(this,"stk.$.sessionid",es)()||""},ts.getBrowser=function(){return Zo&&Zo.version?Zo.name+Zo.version.string:""},ts.convertDefinition=function(t){var e="";switch(t){case"超清":e="3";break;case"高清":e="2";break;case"标清":e="1";break;case"流畅":e="0";break;case"蓝光":e="4";break;case"全景声":e="5"}return e},ts.convertChangeFSScale=function(t){switch(t){case"50%":return"0";case"75%":return"1";case"100%":return"2";case"全屏":return"3"}return""},ts.getTime=function(){return ft(new Date,"yyyyMMddhhmmss")},ts.params=function(t){return vt(t)};var is=Fo.RequestErrorType,ns=Fo.RequestType,rs=function(){},os=/iPad/i.test(navigator.userAgent),ss=function(t){return(t=~~t)>=1e3&&(t=Math.floor(t/100)+t%100),t};function as(t,e){for(var i=[],n=0;n<t.length;n++)i.push(t[n][e]);return i.join(",")}var cs,hs,ls,ds=function(){function t(t){var e=t.vm,i=wt(e,"_injector.stk");this.vm=e,this.stk=ts.stk=i,i&&i.start&&(this.stkLog=new i.start),this.playerLog=new Jo({pcore:e._config.useFlash?"h5flash":os?"padh5":"pch5",pver:e.version.split("-")[0],cver:e.cversion,wver:this.getWver(),method:ts,getVideoInfo:e.getVideoInfo.bind(this.vm),isLive:e._config.isLive,liveType:e._config.liveType}),this.bindEvent()}var e=t.prototype;return e.getWver=function(){var t=this.vm._config.lobparam.wver;return os&&(t=t.replace(/pcweb-/,"padweb-")),t},e.bindEvent=function(){var t=this,e=this.vm,i=this.playerLog;e.on("stats",function(t){var e=t.data.stats;i.actionLog.setStats(e)}),e.on("videoReady",function(){var t=e._config.useFlash?"h5flash":os?"padh5":"pch5";i.updatePcore(t)}),e.on("cmsData",function(t){var e,n,r=t.retry==t.maxRetry-1?"1":"0";switch(t.status){case"loadComplete":i.requestSuccess({type:ns.CMS,h:t.url,data:t.data});break;case"loadError":e=t.code||0,n=De.VIDEOINFO_FAIL.code,i.requestError({type:ns.CMS,h:t.url,z:r,code:is.ERROR_CMS_FAIL.code+ss(e),msg:is.ERROR_CMS_FAIL.msg,pcode:e}),i.errorCode({c:n,api:t.url,pcode:e,z:t.retry}),"40001"!=e&&"40002"!=e&&"40003"!=e&&"40004"!=e&&"40005"!=e||i.playExit(e);break;case"loadTimeout":e=t.code,n=De.VIDEOINFO_TIMEOUT.code,i.requestError({type:ns.CMS,h:t.url,z:r,code:is.ERROR_CMS_TIMEOUT.code+ss(e),msg:is.ERROR_CMS_TIMEOUT.msg}),i.errorCode({c:n,api:t.url,pcode:e,z:t.retry})}}),e.on("getSource",function(t){var e,n;void 0===t&&(t={}),e=t.code||0,n=De.SOURCE_DATA_FAIL.code;var r=t.retry==t.maxRetry-1?"1":"0";switch(t.status){case"loadComplete":i.requestSuccess({type:ns.GETSOURCE,h:t.url});break;case"loadError":i.requestError({type:ns.GETSOURCE,h:t.url,z:r,code:is.ERROR_SOURCE_FAIL.code+ss(e),msg:is.ERROR_SOURCE_FAIL.msg}),n=De.SOURCE_FAIL.code,i.errorCode({c:n,api:t.url,pcode:e,z:t.retry});break;case"loadTimeout":i.requestError({type:ns.GETSOURCE,h:t.url,z:r,code:is.ERROR_SOURCE_TIMEOUT.code,msg:is.ERROR_SOURCE_TIMEOUT.msg}),n=De.SOURCE_TIMEOUT.code,i.errorCode({c:n,api:t.url,pcode:t.code,z:t.retry})}}),e.on("getDispatcher",function(e){var n,r;void 0===e&&(e={}),n=e.code||0,r=De.DISPATCHER_DATA_FAIL.code;var o=e.retry==e.maxRetry-1?"1":"0";switch(e.status){case"loadComplete":t.videoUrl=e.data,i.requestSuccess({type:ns.DISPATCHER,h:e.url});break;case"loadError":r=De.DISPATCHER_WRONG.code,i.requestError({type:ns.DISPATCHER,h:e.url,z:o,code:is.ERROR_DISPATCHER_FAIL.code+ss(n),msg:is.ERROR_DISPATCHER_FAIL.msg}),i.errorCode({c:r,api:e.url,pcode:n,z:e.retry});break;case"loadTimeout":i.requestError({type:ns.DISPATCHER,h:e.url,z:o,code:is.ERROR_DISPATCHER_TIMEOUT.code,msg:is.ERROR_DISPATCHER_TIMEOUT.msg}),r=De.DISPATCHER_TIMEOUT.code,i.errorCode({c:r,api:e.url,pcode:"",z:e.retry})}}),e.on("getStream",function(e){t.videoUrl=e.url,t.playerLog.updateLiveInfo(e);e.retry,e.maxRetry;switch(e.status){case"loadComplete":i.requestSuccess({type:ns.CDN,h:e.url})}}),e.on("frontAdBegin",function(t){i.playAdStart(),i.playAdBegin()}),e.on("frontAdEnd",function(t){void 0===t&&(t={}),i.playAdEnd("",0,t.duration||0,t.total||0)}),e.on("adBlockException",function(t){var e=De.ADINFO_TIMEOUT.code;i.errorCode({c:e,api:t.url||"",pcode:t.code,z:0})}),e.on("videoPlayStart",function(t){i.requestStart({type:ns.CDN})}),e.on("videoPlay",function(n){t.videoUrl&&""!=t.videoUrl||(t.videoUrl=n.videoUrl||""),t.playStartTime=+new Date,i.requestSuccess({type:ns.CDN,h:t.videoUrl}),i.playStart({ap:e.isAutoplay,mp:e.isLoopPlay?2:e.isContinuePlay?1:0}),i.actDrm("0","","1")}),e.on("videoPause",function(t){i.playPause()}),e.on("videoResume",function(t){i.playResume()}),e.on("videoEnd",function(t){i.playStop()}),e.on("videoReplay",function(t){i.videoReplay(),i.actDrm("0","","1")}),e.on("videoRefresh",function(t){i.videoRefresh()}),e.on("videoReload",function(e){t.isTrialViewEnd=!1,i.videoReload()}),e.on("videoWaiting",function(e){t.playStartTime&&+new Date-t.playStartTime<1e3||i.playBufferEmpty()}),e.on("videoDrag",function(t){i.playDrag(t)}),e.on("clarityData",function(t){t&&t.def&&i.updateDef(t.def.name)}),e.on("clarityChanged",function(t){!t.error&&t.stream&&i.playSwitch(t.stream.name)}),e.on("hlsSegmentLoaded",function(t){i.segmentLoaded(t)}),e.on("hlsBufferEmpty",function(t){}),e.on("hlsBufferFull",function(t){i.playBufferFull()}),e.on("hlsStreamError",function(t){if(t&&t.data&&t.data.fatal){var e,n,r=a({},t.data),o=r.type,s=r.context&&r.context.url||"";switch(o){case"hlsNetworkError":e=is.ERROR_CDN_NETWORK_ERROR.code,n=De.CDN_DING_DOWNLOAD_TIMEOUT.code;break;case"hlsMuxError":case"hlsMediaError":e=is.ERROR_CDN_MEDIA_ERROR.code,n=De.CDN_MEDIA_ERROR.code;break;case"hlsOtherError":e=is.ERROR_CDN_OTHER_ERROR.code,n=De.CDN_OTHER_ERROR.code}switch(r.details){case"manifestParsingError":e="308001";break;case"manifestLoadError":e="306001";break;case"manifestLoadTimeOut":e="306002";break;case"fragLoadError":e="306003";break;case"fragLoadTimeOut":e="306004";break;case"fragParsingError":e="307007";break;case"bufferStalledError":e="307009";break;case"fragDecryptError":e="307008";break;case"bufferAppendError":case"bufferAppendingError":e="307005";break;case"bufferFullError":e="307006"}i.requestError({type:ns.CDN,h:s||"",code:e,z:"1",error:r}),i.errorCode({c:n,api:s||"",pcode:e,z:0,msg:encodeURIComponent(o+r.details)}),i.playStop()}}),e.on("dashBufferEmpty",function(t){i.playBufferEmpty()}),e.on("dashStreamError",function(t){var e,n,r=(t.data||{}).error,o=wt(r,"data.request.url","");if(r){switch(r.code>=100&&r.code<=114&&(e=is.ERROR_DRM_FAIL_ERROR.code,n=De.DRM_FAIL_ERROR.code),r.code){case 111:e=is.ERROR_DRM_NOT_SUPPORT_ERROR.code,n=De.DRM_NOT_SUPPORT_ERROR.code;break;case 112:case 114:e=is.ERROR_DRM_FAIL_ERROR.code,n=De.DRM_FAIL_ERROR.code;break;case 28:e=is.ERROR_CDN_NETWORK_ERROR.code,n=De.CDN_DING_DOWNLOAD_TIMEOUT.code;break;case 10:e=is.ERROR_CDN_MEDIA_ERROR.code,n=De.CDN_MEDIA_ERROR.code;break;default:e=is.ERROR_CDN_OTHER_ERROR.code,n=De.CDN_OTHER_ERROR.code}i.requestError({type:ns.CDN,h:o||"",code:e,z:"1",error:r.message}),i.errorCode({c:n,api:o||"",pcode:e,z:0,msg:"DashErrorCode:"+r.code}),i.actDrm(r.code,r.message,"1"),i.playStop()}}),e.on("frontAdError",function(t){void 0===t&&(t={});var n=(t.data?t.data.code:e.$video.error.code)||2,r=t.data?t.data.url:e.$video.src,o=De.AD_MEDIA_UNKOWN;n&&(o={1:De.AD_DOWNLOAD_CANCEL,2:De.AD_DOWNLOAD_TIMEOUT,3:De.AD_MEDIA_ERROR,4:De.AD_MEDIA_UNSUPPORT}[n],i.errorCode({c:o.code,api:r,pcode:"",z:0}))}),e.on("videoError",function(t){void 0===t&&(t={});var n,r=(t.data?t.data.code:e.$video.error.code)||2,o=t.data?t.data.url:e.$video.src,s=2==t.retry?"1":"0",a={1:De.CDN_DING_DOWNLOAD_TIMEOUT,2:De.CDN_MEDIA_TIMEOUT,3:De.CDN_METADATA_PARSE_FAIL,4:De.CDN_MEDIA_ERROR},c={1:is.ERROR_MEDIA_ERR_ABORTED,2:is.ERROR_MEDIA_ERR_NETWORK,3:is.ERROR_MEDIA_ERR_DECODE,4:is.ERROR_MEDIA_ERR_SRC_NOT_SUPPORTED};n=a[r],(r=c[r])&&n&&(i.requestError({type:ns.CDN,h:o||"",code:r.code,z:s,error:""}),i.errorCode({c:n.code,api:o||"",pcode:"",z:t.retry||0}))}),e.on("adRequestError",function(t){var e=De.ADINFO_TIMEOUT,n=t.url;i.errorCode({c:e.code,api:n||"",pcode:"",z:0})}),e.on("timeupdate",function(t){i.updatePlayTime(e.currentTime)}),e.on("showVipDialog",function(e){i.showVipDialog(e),0!=(e.info&&e.info.trialtime)||t.isTrialViewEnd||(i.playExit("10001"),t.isTrialViewEnd=!0)}),e.on("showHdDialog",function(t){i.showHdDialog(t)}),e.on("switchToFlash",function(t){i.updateVersion("h5flash")}),e.on("switchToHtml5",function(t){var e=os?"padh5":"pch5";i.updateVersion(e)}),e.on("autoplayFail",function(t){var e=De.AUTOPLAY_FAIL_ERROR;i.errorCode({c:e.code,api:"",pcode:"",z:0}),i.autoPlayFail()}),e.on("manualClickPlay",function(t){i.manualClickPlay()}),e.on("errorRefreshClick",function(i){var n=i.vinfo,r=wt(e,"_injector.stk.$.browser.brName",""),o=wt(e,"_injector.stk.$.browser.version",""),s=wt(e,"_injector.stk.$.os.sys",""),a=wt(e,"_injector.stk.$.setSessionStorage",rs),c={act:"cp1",bid:"isIpad"==s?"14.1.90":"1.1.90",mp:1,idx:0,pver:e.version.split("-")[0],suuid:a("player_suuid")||"",modl:n.mod||"",vid:n.vid||"",cid:n.rid||"",os:s||"",browser:r+" "+o};t.stkLog&&t.stkLog.pageStart(c)}),e.on("installAppClick",function(i){var n=i.pos,r=i.vinfo,o={bid:"4.1.2",time:wt(e,"_injector.stk.$.getTimer",rs)("yyyyMMddhhmmss")||"",act:"click",vid:r.video_id,cid:r.root_id,plid:r.collection_id,bdid:r.playlist_id,pos:n};t.stkLog&&t.stkLog.pageStart(o)}),e.on("recommendVideoShow",function(i){var n=i.vinfo,r=i.recommendVideos,o={bid:"1.1.4",time:wt(e,"_injector.stk.$.getTimer",rs)("yyyyMMddhhmmss")||"",act:"hotpv",ver:r.ver||"",reqid:r.reqid||"",region:8,cid:n.rid,rcdata:as(r.data,"videoId")||"",videoid:n.vid,vidauto:0,rctype:as(r.data,"rcType")};t.stkLog&&t.stkLog.pageEvent(o,"//rc.log.mgtv.com/rpt")}),e.on("recommandVideoClick",function(i){var n=i.vinfo,r=i.hitid,o=i.pos,s=i.recommendVideos,a={bid:"1.1.4",time:wt(e,"_injector.stk.$.getTimer",rs)("yyyyMMddhhmmss"),act:"recommended_hot",ver:s.ver||"",reqid:s.reqid||"",region:8,cid:n.rid,rcdata:as(s.data,"videoId")||"",hitid:r,pos:o,videoid:n.vid,vidauto:0,rctype:as(s.data,"rcType")};t.stkLog&&t.stkLog.pageEvent(a,"//rc.log.mgtv.com/rpt")})},e.destroy=function(){this.playerLog=null,this.vm=null},t}(),us=function(){function t(t){this.parent=t}var e=t.prototype;return e.create=function(){this.createEl(),this.addAllEvent()},e.destroy=function(){this.removeAllEvent()},e.createEl=function(){this.$dom=document.createElement(this.option.tag),this.option.cls&&(this.$dom.className=this.option.cls),this.$dom.innerHTML=this.option.html,this.option.alignTop?this.parent.$dom.appendChild(this.$dom):this.option.alignRight?this.parent.$wrapRight.appendChild(this.$dom):this.parent.$wrapLeft.appendChild(this.$dom)},e.addAllEvent=function(){var t=this;this.option.defaultEvent&&c(this.option.defaultEvent).forEach(function(e){var i=t.option.defaultEvent[e];t[i]=L(t[i],t),ue(t.$dom,e,t[i],!1,!1)}),this.option.event&&c(this.option.event).forEach(function(e){var i="__"+e;t[i]=L(t.option.event[e],t),ue(t.$dom,e,t[i],!1,!1)})},e.removeAllEvent=function(){var t=this;this.option.defaultEvent&&c(this.option.defaultEvent).forEach(function(e){var i=t.option.defaultEvent[e];t[i]=L(t[i],t),de(t.$dom,e,t[i],!1,!1)}),this.option.event&&c(this.option.event).forEach(function(e){var i="__"+e;t[i]=L(t.option.event[e],t),de(t.$dom,e,t[i],!1,!1)})},t}(),ps=function(t){function e(e,i){var n;return(n=t.call(this,e)||this).option=i,n.init(),n}return i(e,t),e.prototype.init=function(){t.prototype.create.call(this),se(this.$dom,"control-item")},e}(us),fs={tag:"mango-control-state",html:'\n  <a href="javascript:void(0);" class="btn" title="暂停">\n      <svg class="svgPlayPuase1" viewBox="0 0 18 18" version="1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"> \n        <g>\n          <path d="M15.503,6.42L5.127,0.376C3.293-0.692,1,0.643,1,2.78v12.44c0,2.137,2.293,3.473,4.127,2.404l10.376-6.044C17.499,10.417,17.499,7.583,15.503,6.42z"></path>\n        </g>\n      </svg>\n      <svg class="svgPlayPuase2" viewBox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"> \n        <g>\n          <path d="M3.5,0C2.675,0,2,0.675,2,1.5v15C2,17.325,2.675,18,3.5,18S5,17.325,5,16.5v-15C5,0.675,4.325,0,3.5,0z"></path>\n          <path d="M14.5,0C13.675,0,13,0.675,13,1.5v15c0,0.825,0.675,1.5,1.5,1.5s1.5-0.675,1.5-1.5v-15C16,0.675,15.325,0,14.5,0z"></path>\n        </g>\n      </svg>\n      </a>\n  ',defaultEvent:{click:"click",touchstart:"click"}},ms=function(t){function e(e,i){var n;return(n=t.call(this,e)||this).option=x(fs,p(i)?i:{}),n.animate=!1,n.init(),n}i(e,t);var n=e.prototype;return n.init=function(){t.prototype.create.call(this),this.$dom=ge(this.$dom),this.$dom.addClass("control-item btn-play"),this.changeState("pause")},n.changeState=function(t){var e="play"===t?"pause":"play";this.state=t,se(this.parent.$dom,e),ae(this.parent.$dom,t)},n.click=function(t){var e="play"===this.state?"pause":"play";return this.changeState(e),this.parent.$emit(e),$e.info("PluginControlbar","user trigger action ["+e+"]."),"play"==e&&7==this.parent.vm.state&&($e.info("PluginControlbar","send player event [videoRefresh]."),this.parent.vm.emit("videoRefresh")),t.stopPropagation(),t.preventDefault(),!1},e}(us),vs={tag:"mango-control-loop",cls:"control-item",html:'\n  <mango-control-loop-btn>\n      <a class="btn" href="javascript:void(0);" title="">\n        \n\n        <svg class="icon n-loop" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18">\n\t<path d="M8.923,3.382c0.101-0.245,0.101-0.52,0-0.764C8.872,2.495,8.799,2.385,8.707,2.293l-2-2c-0.391-0.391-1.023-0.391-1.414,0\n\t\ts-0.391,1.023,0,1.414L5.71,2.124C2.465,2.732,0,5.581,0,9c0,3.428,2.455,6.331,5.837,6.902c0.056,0.01,0.112,0.014,0.167,0.014\n\t\tc0.479,0,0.903-0.345,0.985-0.833c0.092-0.544-0.275-1.061-0.819-1.152C3.792,13.529,2,11.409,2,9c0-2.757,2.243-5,5-5h1\n\t\tc0.13,0,0.26-0.027,0.382-0.077C8.627,3.821,8.821,3.627,8.923,3.382z"/>\n\t<path d="M18,9c0-3.421-2.449-6.323-5.823-6.9c-0.546-0.094-1.061,0.273-1.154,0.817c-0.093,0.544,0.273,1.061,0.817,1.154\n\t\tC14.211,4.477,16,6.596,16,9c0,2.757-2.243,5-5,5h-1c-0.13,0-0.26,0.027-0.382,0.077c-0.244,0.101-0.439,0.296-0.541,0.541\n\t\tc-0.101,0.245-0.101,0.52,0,0.764c0.051,0.122,0.124,0.233,0.216,0.325l2,2C11.488,17.902,11.744,18,12,18s0.512-0.098,0.707-0.293\n\t\tc0.391-0.391,0.391-1.023,0-1.414l-0.417-0.417C15.535,15.268,18,12.419,18,9z"/>\n</svg>\n\n<svg class="icon n-loop-open" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18">\n\t<path d="M7,4h1c0.13,0,0.26-0.027,0.382-0.077c0.244-0.101,0.439-0.296,0.541-0.541c0.101-0.245,0.101-0.52,0-0.764\n\t\tC8.872,2.495,8.799,2.385,8.707,2.293l-2-2c-0.391-0.391-1.023-0.391-1.414,0s-0.391,1.023,0,1.414L5.71,2.124\n\t\tC2.465,2.732,0,5.581,0,9c0,3.428,2.455,6.331,5.837,6.902c0.056,0.01,0.112,0.014,0.167,0.014c0.479,0,0.903-0.345,0.985-0.833\n\t\tc0.092-0.544-0.275-1.061-0.819-1.152C3.792,13.529,2,11.409,2,9C2,6.243,4.243,4,7,4z"/>\n\t<path d="M18,9c0-3.421-2.449-6.323-5.823-6.9c-0.546-0.094-1.061,0.273-1.154,0.817c-0.093,0.544,0.273,1.061,0.817,1.154\n\t\tC14.211,4.477,16,6.596,16,9c0,2.757-2.243,5-5,5h-1c-0.13,0-0.26,0.027-0.382,0.077c-0.244,0.101-0.439,0.296-0.541,0.541\n\t\tc-0.101,0.245-0.101,0.52,0,0.764c0.051,0.122,0.124,0.233,0.216,0.325l2,2C11.488,17.902,11.744,18,12,18s0.512-0.098,0.707-0.293\n\t\tc0.391-0.391,0.391-1.023,0-1.414l-0.417-0.417C15.535,15.268,18,12.419,18,9z"/>\n\t<path d="M10,11V7c0-0.552-0.448-1-1-1C8.448,6,8,6.448,8,7v4c0,0.552,0.448,1,1,1C9.552,12,10,11.552,10,11z"/>\n</svg>\n\n      </a>\n    <div class="u-control-tips"><p class="video_loop_tips">打开循环播放</p></div>\n  </mango-control-loop-btn>\n  ',defaultEvent:{click:"click",touchstart:"click"}},gs=function(t){function e(e,i){var n;return(n=t.call(this,e)||this).option=x(vs,p(i)?i:{}),n.init(),n}i(e,t);var n=e.prototype;return n.init=function(){t.prototype.create.call(this),this.$domWrap=ge(this.$dom)},n.inited=function(){var t="";this.parent.userSetting.isLoop?(t="关闭",this.$domWrap.addClass("on")):(t="打开",this.$domWrap.removeClass("on")),this.$domWrap.find(".video_loop_tips").html(t+"循环播放")},n.click=function(t){var e="",i="";this.parent.userSetting.isLoop?(this.parent.userSetting.isLoop=0,Se.set("mango-loop-open",0),this.$domWrap.removeClass("on"),e="打开",i="关闭"):(this.parent.userSetting.isLoop=1,Se.set("mango-loop-open",1),this.$domWrap.addClass("on"),e="关闭",i="打开"),this.$domWrap.find(".video_loop_tips").html(e+"循环播放"),this.parent.config.isIpad&&this.parent.children.tip.showBottomTip({_type:"commonTPL",_time:2e3,info:"已"+i+"循环播放",text:""}),$e.info("PluginControlbar","user trigger action [togglePlayLoop], status ["+e+"]."),t.stopPropagation(),t.preventDefault()},e}(us),ys={tag:"mango-control-playnext",html:'\n    <mango-control-playnext-btn>\n      <svg id="n-next" viewBox="0 0 18 18" width="100%" height="100%">\n        <path d="M11.626 6.457L3.452 1.334C1.937.384.042 1.571.042 3.471v11.057c0 1.9 1.894 3.087 3.41 2.137l8.174-5.123c1.875-1.174 1.875-3.91 0-5.085zM16.5 1c-.825 0-1.5.675-1.5 1.5v13c0 .825.675 1.5 1.5 1.5s1.5-.675 1.5-1.5v-13c0-.825-.675-1.5-1.5-1.5z"></path>\n      </svg>\n    </mango-control-playnext-btn>\n    <mango-control-nextvideoinfo>\n    <div class="u-next-box">\n      <div class="u-next-box-cent">\n        <p class="pic"><img src="" width="130" height="74"><em class="pn-time"></em></p>\n        <h2 class="tit">下一个</h2>\n        <p class="n"></p>\n      </div>\n    </div>\n    </mango-control-nextvideoinfo>\n    <mango-control-nextvideo-tip class="u-control-sporting">\n      <div class="u-next-box">\n        <div class="u-next-box-cent">\n          <p class="pic"><img src="" width="130" height="74"><em class="pn-time"></em></p>\n          <h2 class="tit"><i>10s</i>即将播放</h2>\n          <p class="n"></p>\n        </div>\n      </div>\n    </mango-control-nextvideoinfo>\n  ',defaultEvent:{click:"click",touchstart:"click"}},_s=function(t){function e(e,i){var n;return(n=t.call(this,e)||this).option=x(ys,p(i)?i:{}),n.init(),n}i(e,t);var n=e.prototype;return n.init=function(){t.prototype.create.call(this),this.$dom=ge(this.$dom),this.$dom.addClass("control-item").hide(),this.$nextvideo=this.$dom.find(".u-next-box"),this.$nextvideotip=this.$dom.find("mango-control-nextvideo-tip")},n.setNextVideoInfo=function(t){this.$nextvideo.find("img").attr("src",t.img),this.$nextvideo.find(".n").html(t.title),this.$nextvideo.find(".pn-time").html(ut(t.duration)),this.$dom.css("display","inline-block")},n.onVideoWillEnd=function(t){var e=this;void 0===t&&(t={});var i=t.time;!this.parent.userSetting.isLoop&&i>0?(this.$nextvideotip.find(".tit i").html(i+"s"),this.$nextvideotip.find(".u-next-box").css("display","block"),this.dcTimer&&clearInterval(this.dcTimer),this.dcTimer=setInterval(function(){i>0?(i--,e.$nextvideotip.find(".tit i").html(i+"s")):e.cancelVideoEnd()},1e3)):this.cancelVideoEnd()},n.cancelVideoEnd=function(){this.dcTimer&&clearInterval(this.dcTimer),this.$nextvideotip.find(".u-next-box").css("display","none")},n.playNext=function(){if(this.parent.vm._config.webJump)this.parent.vm.requesetRefreshPage();else{var t=this.parent.vm.getNextPlayUrl();if(t)return void(window.location.href=t);this.parent.nextvideoinfo&&this.parent.nextvideoinfo.url&&(window.location.href=this.parent.nextvideoinfo.url)}},n.hide=function(){this.$dom.hide()},n.click=function(t){this.playNext(),this.parent.$emit("playNextVideo"),$e.info("PluginControlbar","user trigger action [playNext]."),t.stopPropagation(),t.preventDefault()},e}(us),ws={tag:"mango-volume",html:"\n    <mango-volume-state>\n      <mango-volume-state-mute></mango-volume-state-mute>\n      <mango-volume-state-low></mango-volume-state-low>\n      <mango-volume-state-high></mango-volume-state-high>\n    </mango-volume-state>\n    <mango-volume-bar>\n      <mango-volume-bar-wrap>\n        <mango-volume-bar-bg></mango-volume-bar-bg>\n        <mango-volume-bar-all>\n          <mango-volume-bar-ball></mango-volume-bar-ball>\n        </mango-volume-bar-all>\n        <mango-volume-bar-track></mango-volume-bar-track>\n      </mango-volume-bar-wrap>\n    </mango-volume-bar>\n  ",alignRight:!0,animate:{icon:'\n    <svg class="icon n-voice" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18">\n\t<path style="fill:none;" d="M10.383,2.904c-0.145-0.06-0.651-0.222-1.09,0.217l-2,2C6.727,5.688,5.973,6,5.171,6H4\n\t\tC2.897,6,2,6.897,2,8v2c0,1.103,0.897,2,2,2h1.171c0.801,0,1.555,0.312,2.122,0.879l2,2c0.438,0.438,0.944,0.277,1.09,0.217\n\t\tC10.527,15.036,11,14.792,11,14.171V3.829C11,3.208,10.527,2.964,10.383,2.904z"/>\n\t<path d="M11.148,1.057c-1.141-0.472-2.395-0.224-3.269,0.65l-2,2C5.69,3.896,5.438,4,5.171,4H4C1.794,4,0,5.794,0,8v2\n\t\tc0,2.206,1.794,4,4,4h1.171c0.267,0,0.519,0.104,0.708,0.293l2,2c0.581,0.582,1.33,0.886,2.102,0.886\n\t\tc0.389,0,0.784-0.077,1.167-0.236C12.291,16.47,13,15.408,13,14.171V3.829C13,2.592,12.291,1.53,11.148,1.057z M11,14.171\n\t\tc0,0.62-0.473,0.864-0.617,0.924c-0.146,0.06-0.651,0.221-1.09-0.217l-2-2C6.727,12.312,5.973,12,5.171,12H4c-1.103,0-2-0.897-2-2\n\t\tV8c0-1.103,0.897-2,2-2h1.171c0.801,0,1.555-0.312,2.122-0.879l2-2c0.439-0.439,0.945-0.277,1.09-0.217\n\t\tC10.527,2.964,11,3.208,11,3.829V14.171z"/>\n\t<path d="M16.895,4.553c-0.247-0.494-0.847-0.694-1.342-0.447c-0.494,0.247-0.694,0.848-0.447,1.342\n\t\tc1.112,2.225,1.112,4.881,0,7.105c-0.247,0.494-0.046,1.095,0.447,1.342C15.696,13.966,15.849,14,15.999,14\n\t\tc0.367,0,0.72-0.203,0.896-0.553C18.287,10.663,18.287,7.337,16.895,4.553z"/>\n</svg>\n\n    <svg class="icon n-voice-no" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18">\n\t<path d="M2.707,1.293c-0.391-0.391-1.023-0.391-1.414,0s-0.391,1.023,0,1.414l14,14C15.488,16.902,15.744,17,16,17\n\t\ts0.512-0.098,0.707-0.293c0.391-0.391,0.391-1.023,0-1.414L2.707,1.293z"/>\n\t<path d="M10.383,15.096c-0.146,0.06-0.651,0.221-1.09-0.217l-2-2C6.727,12.312,5.973,12,5.171,12H4c-1.103,0-2-0.897-2-2V8\n\t\tc0-0.701,0.364-1.317,0.912-1.674L1.494,4.908C0.59,5.642,0,6.748,0,8v2c0,2.206,1.794,4,4,4h1.171\n\t\tc0.267,0,0.519,0.104,0.708,0.293l2,2c0.581,0.582,1.33,0.886,2.102,0.886c0.389,0,0.784-0.077,1.167-0.236\n\t\tc0.554-0.229,1.004-0.599,1.323-1.059l-1.51-1.51C10.867,14.835,10.509,15.043,10.383,15.096z"/>\n\t<path d="M9.293,3.121c0.439-0.439,0.945-0.276,1.09-0.217C10.527,2.964,11,3.208,11,3.829v3.757l2,2V3.829\n\t\tc0-1.237-0.709-2.299-1.852-2.772c-1.142-0.473-2.395-0.224-3.269,0.65L6.5,3.086L7.914,4.5L9.293,3.121z"/>\n\t<path d="M15.364,11.95l1.517,1.517c0.004-0.007,0.01-0.012,0.014-0.02c1.392-2.785,1.392-6.11,0-8.895\n\t\tc-0.247-0.494-0.847-0.694-1.342-0.447c-0.494,0.247-0.694,0.848-0.447,1.342C16.119,7.475,16.198,9.858,15.364,11.95z"/>\n</svg>\n\n    '},layout:"vertical",defaultEvent:{mousedown:"mousedown",mouseleave:"mouseleave"}},bs=(r((cs=function(t){function e(e,i){var n;return(n=t.call(this,e)||this).parent.preVolume=0,n.option=x(ws,p(i)?i:{}),n.init(),n}i(e,t);var n=e.prototype;return n.init=function(){t.prototype.create.call(this),this.$dom=ge(this.$dom),this.$state=this.$dom.find("mango-volume-state"),this.$bar=this.$dom.find("mango-volume-bar"),this.$all=this.$dom.find("mango-volume-bar-all"),this.$bg=this.$dom.find("mango-volume-bar-bg"),this.layout="vertical"===this.option.layout?"vertical":"horizonal",this.option.icon&&this.option.icon.mute&&this.option.icon.low?(this.option.icon.high=this.option.icon.high||this.option.icon.low,this.$mute=this.$dom.find("mango-volume-state-mute"),this.$low=this.$dom.find("mango-volume-state-low"),this.$high=this.$dom.find("mango-volume-state-high"),this.$mute.html(this.option.icon.mute),this.$low.html(this.option.icon.low),this.$high.html(this.option.icon.high)):this.option.bitmap||(this.animate=!0,this.$state.html(this.option.animate.icon)),this.$dom.addClass("control-item "+this.layout),this.changeState()},n.inited=function(){this.parent.volume=this.parent.userSetting.volume,this.update()},n.destroy=function(){t.prototype.destroy.call(this)},n.changeState=function(){this.parent.muted||0===this.parent.volume?this.state="mute":this.parent.volume>0&&this.parent.volume<=.5?this.state="low":this.parent.volume>.5&&this.parent.volume<=1&&(this.state="high"),this.$dom.removeClass("mute low high"),this.$dom.addClass(this.state)},n.adjust=function(t){var e=Math.floor(100*this.parent.volume);e=t>0?Math.min(e+10,100):Math.max(e-10,0),this.parent.volume=e/100,this.parent.children.tip&&this.parent.children.tip.showBottomTip({_type:"commonTPL",_time:2e3,info:"当前音量 ",text:e+"%"})},n.click=function(t){var e=t.path||function(t){var e=[];if(null===t)return e;for(e.push(t);null!==t.parentNode;)t=t.parentNode,e.push(t);return e}(t.target);return-1!==e.indexOf(this.$state[0])?(this.stateClick(t),"state"):-1!==e.indexOf(this.$bar[0])?(this.barClick(t),"bar"):"padding"},n.stateClick=function(){if(this.parent.muted)this.parent.muted=!1;else{var t=this.parent.volume;this.parent.volume=0===t?this.parent.preVolume||.5:0,this.parent.preVolume=t,this.changeState()}this.parent.children.tip&&this.parent.children.tip.showBottomTip({_type:"commonTPL",_time:2e3,info:"当前音量 ",text:Math.floor(100*this.parent.volume)+"%"}),$e.info("PluginControlbar","user trigger action [adjustVolume], volume ["+this.parent.volume+"]")},n.barClick=function(t){var e="vertical"===this.layout?1-t.offsetY/this.$bg[0].offsetHeight:t.offsetX/this.$bg[0].offsetWidth;this.parent.volume=e<0?0:e>1?1:e,this.update(),this.parent.children.tip&&this.parent.children.tip.showBottomTip({_type:"commonTPL",_time:2e3,info:"当前音量 ",text:Math.floor(100*this.parent.volume)+"%"}),$e.info("PluginControlbar","user trigger action [adjustVolume], volume ["+this.parent.volume+"]")},n.mouseleave=function(t){this.dragEnd()},n.mousedown=function(t){"bar"===this.click(t)&&(this.startX="vertical"===this.layout?t.clientY:t.clientX,this.startVolume=this.parent.volume,ue(window,"mousemove",this.draging),ue(window,"mouseup",this.dragEnd),ue(window,"contextmenu",this.dragEnd))},n.update=function(){this.changeState();var t=this.parent.muted?0:this.parent.volume;"vertical"===this.layout?this.$all.css("height",100*t+"%"):this.$all.css("width",100*t+"%")},n.draging=function(t){this.endX="vertical"===this.layout?t.clientY:t.clientX;var e="vertical"===this.layout?(this.startX-this.endX)/this.$bg[0].offsetHeight:(this.endX-this.startX)/this.$bg[0].offsetWidth,i=+(this.startVolume+e).toFixed(2);this.parent.volume=i<0?0:i>1?1:i,this.parent.muted=!1,this.parent.children.tip&&this.parent.children.tip.showBottomTip({_type:"commonTPL",_time:2e3,info:"当前音量 ",text:Math.floor(100*this.parent.volume)+"%"})},n.dragEnd=function(){this.startX=0,this.startVolume=0,de(window,"mousemove",this.draging),de(window,"mouseup",this.dragEnd),de(window,"contextmenu",this.dragEnd)},e}(us)).prototype,"draging",[_i],s(cs.prototype,"draging"),cs.prototype),r(cs.prototype,"dragEnd",[_i],s(cs.prototype,"dragEnd"),cs.prototype),cs),Es={tag:"mango-progressbar",cls:"u-control-loading",html:'\n    <mango-progressbar-wrap class="u-control-loading-box">\n      <mango-progressbar-bg class="loadingbg"></mango-progressbar-bg>\n      <mango-progressbar-buffer class="buffered"></mango-progressbar-buffer>\n      <mango-progressbar-all class="loading">\n        <mango-progressbar-ball class="button progress-button"></mango-progressbar-ball>\n      </mango-progressbar-all>\n      \n      \x3c!-- 时间轴预览功能 --\x3e\n      <mango-progressbar-preview class="message"> \n        <dl>\n            <dd>\n                <div class="preview"></div>\n                <em class="time"></em>\n            </dd>\n            <dt class="title"></dt>\n        </dl>\n      </mango-progressbar-preview>\n\n      <mango-progressbar-previewimg class="player-previewlist"></mango-progressbar-previewimg>\n      \n      <mango-progressbar-previewtime class="previewtime-message">\n        <div class="message-time" node-type="time-preview">00:00</div> \n      </mango-progressbar-previewtime>\n\n      <mango-progressbar-preview-btn class="button progress-indicator">\n        <mango-progressbar-preview-line></mango-progressbar-preview-line>\n      </mango-progressbar-preview-btn>\n\n      \x3c!-- 打点数据功能 --\x3e\n      <mango-progressbar-keypoints></mango-progressbar-keypoints>\n    </mango-progressbar-wrap>\n  '},Ts=/iPad/i.test(navigator.userAgent),Rs=(r((hs=function(t){function e(e,i){var n;return(n=t.call(this,e)||this).option=x(Es,p(i)?i:{}),n.visiable=!1!==i,n.init(),n}i(e,t);var n=e.prototype;return n.init=function(){t.prototype.create.call(this),this.keyPoints=null,this.keyframes=null,this.isShowTips=!0,this.$dom=ge(this.$dom),this.$wrap=this.$dom.find("mango-progressbar-wrap"),this.$buffer=this.$dom.find("mango-progressbar-buffer"),this.$all=this.$dom.find("mango-progressbar-all"),this.$tip=this.$dom.find("mango-progressbar-preview"),this.$preview=this.$dom.find(".message .preview"),this.$track=this.$dom.find("mango-progressbar-track"),this.$line=this.$dom.find(".mango-progressbar-line"),this.$ball=this.$dom.find("mango-progressbar-ball"),this.$previewBtn=this.$dom.find("mango-progressbar-preview-btn"),this.$points=this.$dom.find("mango-progressbar-keypoints"),this.$previewimg=this.$dom.find("mango-progressbar-previewimg"),!this.visiable&&this.$dom.css("visibility","hidden"),Ts&&this.$dom.addClass("u-control-loading-ipad"),this.addWrapEvent()},n.destroy=function(){this.removeWrapEvent(),this.watch_screen&&this.watch_screen(),t.prototype.destroy.call(this)},n.initKeyPoints=function(t,e){this.videoinfo=this.parent.videoinfo,this.keyPoints=t,this.duration=e,this.createPoints()},n.initFrames=function(t){this.keyframes=t},n.preFetch=function(){var t=this;this.prefetchTimer&&clearTimeout(this.prefetchTimer),this.prefetchTimer=setTimeout(function(){t.keyframes&&t.keyframes.images&&t.keyframes.images.forEach(function(t){(new Image).src=t})},1e3)},n.createPoints=function(){var t=this;this.$points.html(""),this.skipStartTime=Number(this.keyPoints.start.split("|")[0])||0,this.skipEndTime=Number(this.keyPoints.end.split("|")[0])||0,this.skipStartTime>0&&this.skipStartTime<this.duration&&this.createPoint(this.skipStartTime),this.skipEndTime>0&&this.skipStartTime<this.duration&&this.createPoint(this.skipEndTime),this.points=this.keyPoints.content.map(function(e){var i=e.split("|");return t.createPoint(i[0],i[1]),{time:i[0],title:i[1]}})},n.getPointByTime=function(t){return this.points.find(function(e){return Math.abs(e.time-t)<10})},n.createPoint=function(t,e){var i;i=ge('<mango-progressbar-keypoint class="button point"\n          data-title='+e+" data-time="+t+' style="left:'+t/this.duration*100+'%">\n      </mango-progressbar-keypoint>'),this.$points.append(i)},n.addWrapEvent=function(){this.parent.config.isIpad?(this.$dom.on("touchstart",this.mousedown),this.$dom.on("touchmove",this.tipShow),this.$dom.on("touchend",this.tipEnd),this.$dom.on("touchcancel",this.tipEnd)):(this.$dom.on("mousedown",this.mousedown),this.$dom.on("mousemove",this.tipShow),this.$dom.on("mouseleave",this.tipEnd))},n.removeWrapEvent=function(){this.parent.config.isIpad?(this.$dom.off("touchstart",this.mousedown),this.$dom.off("touchmove",this.tipShow),this.$dom.off("touchend",this.tipEnd),this.$dom.off("touchcancel",this.tipEnd)):(this.$dom.off("mousedown",this.mousedown),this.$dom.off("mousemove",this.tipShow),this.$dom.off("mouseleave",this.tipEnd))},n.progress=function(){var t=0;try{t=ye.bufferInfo(this.parent,this.parent.currentTime,.5).end}catch(t){}var e=t/this.duration*100+"%";this.$buffer.css("width",e)},n.update=function(){var t=this.resize();this.$all.css("width",100*t.percent+"%")},n.resize=function(){var t=void 0!==this._currentTime?this._currentTime:this.parent.currentTime,e={percent:t?t/this.duration:0,xoffset:this.$ball[0].offsetLeft,yoffset:parseInt(this.parent.vm.container.height)-50};return this.parent.emit("progressbarUpdate",e),e},n.getFrameImageList=function(t,e,i,n){if(i){var r,o=this.$previewimg,s=130,a=125,c=(this.$previewimg.find(".player-previewlist-bg").length,t.frame);if(c.imgSize){var h=c.imgSize||"";s=h.split("*")[0]||s,h.split("*")[1]||100}if("115*65"==c.imgSize||0==c.images.length)return!1;var l=this.$dom[0].offsetWidth;r=5*Math.ceil(Math.ceil(l/a)/2),o.css({width:2*Math.ceil(l/a)*a+178+"px",marginLeft:"-"+(2*Math.ceil(l/a)*a+178)/2+"px"});var d=[],u=e=Math.ceil(e),p=r,f=[],m=[],v=u,g=u,y=[],_=ut(e);for(d.push(As(c,e,s));v<=u+p;)if((v+=5)<=n)m.push(As(c,v,s));else{m.push({image:"none",x:0,y:0,scale:0})}for(;g>=u-p;)if((g-=5)<=0){f.unshift({image:"none",x:0,y:0})}else f.unshift(As(c,g,s));var w=f.concat(d,m),b="",E="";switch(s){case"130":E="previwlist-size"}for(var T=0;T<w.length;T++)T==Math.ceil(w.length/2)-1?(b="previewlist-current "+E,w[T].scale=178/s):b="",y.push('<div class="player-previewlist-bg '+b+'">\n          <div class="preview" style="-o-transform:scale('+w[T].scale+");-moz-transform:scale("+w[T].scale+");-webkit-transform:scale("+w[T].scale+");transform:scale("+w[T].scale+");background-image:url('"+w[T].image+"');background-position:-"+w[T].x+"px -"+w[T].y+'px;"></div>    \n          <p class="previwlist-mask">'+_+"</p>\n          </div>");this.$previewimg.html(y.join("")).show()}},n.mousedown=function(t){if(t.target!==this.$tip[0]){var e,i;if("mousedown"==t.type)e=t.clientX,i=t.offsetX;else{var n=t.target.getBoundingClientRect();i=t.targetTouches[0].pageX-n.left,e=t.changedTouches[0].clientX}this.startX=e,this._currentTime=i/this.$dom[0].offsetWidth*this.duration,this.startTime=this._currentTime,Ts?(ue(window,"touchmove",this.draging),ue(window,"touchend",this.dragEnd),ue(window,"touchcancel",this.dragEnd)):(ue(window,"mousemove",this.draging),ue(window,"mouseup",this.dragEnd),ue(window,"contextmenu",this.dragEnd)),t.stopPropagation(),t.preventDefault()}},n.draging=function(t){var e;e="mousemove"==t.type?t.pageX:t.changedTouches[0].clientX,this.endX=e;var i=e-this.$dom[0].getBoundingClientRect().left,n=(this.endX-this.startX)/this.$dom[0].offsetWidth*this.duration,r=+(this.startTime+n).toFixed(2);this._currentTime=r<0?0:r>this.duration?this.duration:r,this.parent.userIsDragging=!0,this.update();var o=(i=Math.min(Math.max(0,i),this.$wrap[0].offsetWidth))/this.$wrap[0].offsetWidth*this.duration;e-this.$dom[0].getBoundingClientRect().left<=0?o=0:e-this.$dom[0].getBoundingClientRect().right>=0&&(o=this.duration),this.$dom[0].offsetWidth>600&&this.duration>38&&(this.isShowTips=!1,this.getFrameImageList(this.videoinfo,o,!0,this.duration)),t.preventDefault()},n.dragEnd=function(){this.update(),this.startX=0,this.startTime=0,this.parent.currentTime=this._currentTime,$e.info("PluginControlbar","user trigger action [seek], time ["+this.parent.currentTime+"]"),this._currentTime=void 0,Ts?(de(window,"touchmove",this.draging),de(window,"touchend",this.dragEnd),de(window,"touchcancel",this.dragEnd)):(de(window,"mousemove",this.draging),de(window,"mouseup",this.dragEnd),de(window,"contextmenu",this.dragEnd)),this.isShowTips=!0,this.$previewimg.css("display","none"),this.parent.userIsDragging&&Ts&&this.parent.emit("progressbarHover",{hover:!1}),this.parent.userIsDragging=!1},n.tipShow=function(t){if(this.parent.emit("progressbarHover",{hover:!0}),this.keyframes){if(t.target===this.$tip[0]||t.target===this.$preview[0]||t.target===this.$ball[0])return this.$tip.css("display","none"),void this.$previewBtn.css("display","none");var e=t.offsetX/this.$dom[0].offsetWidth*this.duration,i=ut(e=e<0?0:e>this.duration?this.duration:e),n=As(this.keyframes,e),r=this.getPointByTime(e);if(n&&!this.isShowTips)return this.$tip.css("display","none"),this.$previewBtn.css("display","none"),!1;this.$tip.css("display","inline-block");var o=t.offsetX-this.$tip[0].offsetWidth/2,s=this.$dom[0].offsetWidth-this.$tip[0].offsetWidth-10;if(o=o<10?10:o>s?s:o,this.$tip.find(".time").text(i),this.$tip.css("left",o+"px"),n){var a=this.$tip.find(".preview");a.css("backgroundImage","url("+n.image+")"),a.css("transform","scale("+n.scale+")"),a.css("-webkit-transform","scale("+n.scale+")"),a.css("-o-transform","scale("+n.scale+")"),a.css("-moz-transform","scale("+n.scale+")"),a.css("backgroundPosition","-"+n.x+"px -"+n.y+"px")}else this.$tip.addClass("message2");r&&r.title?(this.$tip.find(".title").text(r.title),this.$tip.addClass("message1")):this.$tip.removeClass("message1"),this.$previewBtn.css("display","inline-block"),this.$previewBtn.css("left",t.offsetX+"px")}},n.tipEnd=function(){this.parent.userIsDragging||(this.$tip.css("display","none"),this.$previewBtn.css("display","none"),this.parent.emit("progressbarHover",{hover:!1}))},e}(us)).prototype,"mousedown",[_i],s(hs.prototype,"mousedown"),hs.prototype),r(hs.prototype,"draging",[_i],s(hs.prototype,"draging"),hs.prototype),r(hs.prototype,"dragEnd",[_i],s(hs.prototype,"dragEnd"),hs.prototype),r(hs.prototype,"tipShow",[_i],s(hs.prototype,"tipShow"),hs.prototype),r(hs.prototype,"tipEnd",[_i],s(hs.prototype,"tipEnd"),hs.prototype),hs),As=function(t,e,i){var n,r,o,s,a,c,h,l=i||178;if("115*65"==t.imgSize)return null;if(t.imgSize){var d=t.imgSize||"";c=d.split("*")[0]||l,h=d.split("*")[1]||100}if(t.second&&t.second[0]&&t.images){n=(s=(r=t.second.join("|").split("|")).length)-1;for(var u=0;u<s-1;u++)if(e>=r[u]&&e<r[u+1]){n=u;break}return a=n%100,{idx:o=Math.floor(n/100),scale:l/c,index:n,image:t.images[o],x:a%10*c,y:Math.floor(a/10)*h}}return null},Ss={tag:"mango-progresstime",html:"\n    <mango-progresstime-pass>00:00</mango-progresstime-pass\n    ><mango-progresstime-total\n      ><span>/</span\n      ><mango-progresstime-total-value>00:00</mango-progresstime-total-value>\n    </mango-progresstime-total>\n  "},ks=function(t){function e(e,i){var n;return(n=t.call(this,e)||this).option=x(Ss,p(i)?i:{}),n.init(),n}i(e,t);var n=e.prototype;return n.init=function(){t.prototype.create.call(this),this.$dom=ge(this.$dom),this.$total=this.$dom.find("mango-progresstime-total-value"),this.$pass=this.$dom.find("mango-progresstime-pass"),this.$dom.addClass("control-item")},n.updatePass=function(){this.$pass.text(ut(this.parent.currentTime))},n.updateTotal=function(t){this.$total.text(ut(t))},e}(us),Ps='\n<svg id="n-unselected" class="icon n-unselected" viewBox="0 0 12 12" width="100%" height="100%">\n  <path d="M6 0a6 6 0 1 0 0 12A6 6 0 0 0 6 0zm0 11c-2.757 0-5-2.243-5-5s2.243-5 5-5 5 2.243 5 5-2.243 5-5 5z"></path>\n</svg>\n<svg id="n-selected" class="icon n-selected" viewBox="0 0 12 12" width="100%" height="100%">\n  <path d="M6 0a6 6 0 1 0 0 12A6 6 0 0 0 6 0zm0 11c-2.757 0-5-2.243-5-5s2.243-5 5-5 5 2.243 5 5-2.243 5-5 5z"></path><path d="M8.646 3.646L5 7.293 3.354 5.646a.5.5 0 0 0-.707.707l2 2a.502.502 0 0 0 .707.001l4-4a.5.5 0 0 0-.708-.708z"></path>\n</svg>\n',Cs={tag:"mango-setting",cls:"u-control-set m-show-btn control-item",html:'\n  <a class="btn" href="javascript:;" title="设置" action="togglePanel">\n    <svg class="icon n-set" id="n-set" viewBox="0 0 18 18" width="100%" height="100%" action="togglePanel">\n    <path d="M11.485 18h-4.97a2.978 2.978 0 0 1-2.121-.879L.879 13.606A2.976 2.976 0 0 1 0 11.485v-4.97c0-.802.312-1.555.879-2.121L4.394.879A2.976 2.976 0 0 1 6.515 0h4.971c.801 0 1.555.312 2.121.879l3.515 3.515A2.98 2.98 0 0 1 18 6.515v4.971c0 .801-.312 1.555-.879 2.121l-3.515 3.515a2.98 2.98 0 0 1-2.121.878zM6.515 2c-.264 0-.521.107-.707.293L2.293 5.808A1.006 1.006 0 0 0 2 6.515v4.971c0 .263.107.521.293.707l3.515 3.515c.186.185.443.292.707.292h4.971c.263 0 .521-.107.707-.293l3.515-3.515a1.01 1.01 0 0 0 .292-.707v-4.97c0-.263-.107-.521-.293-.707l-3.515-3.515A1.006 1.006 0 0 0 11.485 2h-4.97z"></path><path d="M10.243 13H7.757a.997.997 0 0 1-.707-.293L5.293 10.95A1 1 0 0 1 5 10.243V7.757c0-.265.105-.52.293-.707L7.05 5.293A1 1 0 0 1 7.757 5h2.485c.265 0 .52.105.707.293l1.757 1.757a.996.996 0 0 1 .294.707v2.485c0 .265-.105.52-.293.707l-1.757 1.757a.996.996 0 0 1-.707.294zm-2.072-2h1.657L11 9.829V8.171L9.829 7H8.171L7 8.171v1.657L8.171 11z"></path>\n  </svg>\n  </a>\n  <div class="u-set-box">\n      <dl class="ucbox">\n          <dt class="name">播放器</dt>\n          <dd class="selbox">\n              <a class="on" style="display:none" href="javascript:;" action="useHTML5">'+Ps+'HTML5</a>\n              <a href="javascript:;" action="useFlash">'+Ps+'FLASH</a>\n          </dd>\n          <dd class="jump"> <a class="" href="javascript:;" action="switchSkipStart">'+Ps+"跳过片头片尾</a></dd>\n      </dl>\n  </div>\n</li>\n  ",alignRight:!0,defaultEvent:{click:"click",touchstart:"click",mouseout:"mouseout",mouseover:"mouseover"}},Ds=function(t){function e(e,i){var n;return(n=t.call(this,e)||this).option=x(Cs,p(i)?i:{}),n.init(),n}i(e,t);var n=e.prototype;return n.init=function(){t.prototype.create.call(this),this.$domWrap=ge(this.$dom),this.$domWrap.attr("action","togglePanel"),this.$btn=this.$domWrap.find(".btn"),this.$panel=this.$domWrap.find(".u-set-box"),this.isShow=!1},n.inited=function(){this.resetUI()},n.resetUI=function(){this.parent.userSetting.isSkip?this.$panel.find('[action="switchSkipStart"]').addClass("on"):this.$panel.find('[action="switchSkipStart"]').removeClass("on")},n.switchSkipStart=function(){this.parent.userSetting.isSkip=!this.parent.userSetting.isSkip,Se.set("mango-skip-start",this.parent.userSetting.isSkip?"1":"0"),this.resetUI(),$e.info("PluginControlbar","user trigger action [toggleSkipStart], status ["+this.parent.userSetting.isSkip+"]")},n.hide=function(){this.$domWrap.removeClass("on")},n.togglePanel=function(){this.$domWrap.hasClass("on")?this.$domWrap.removeClass("on"):this.$domWrap.addClass("on")},n.click=function(t){var e=t.target.getAttribute("action");u(this[e])&&(this[e](t),t.stopPropagation(),t.preventDefault())},n.mouseover=function(t){this.hideTimer&&clearTimeout(this.hideTimer)},n.mouseout=function(t){var e=this;this.hideTimer&&clearTimeout(this.hideTimer),this.hideTimer=setTimeout(function(){e.hide()},200)},e}(us),xs={tag:"mango-webscreen",html:'\n    <a class="btn" href="javascript:void(0);">\n      <svg class="icon n-web-zoom"  viewBox="0 0 18 18">\n\t<path d="M14,18H4c-2.206,0-4-1.794-4-4V4c0-2.206,1.794-4,4-4h10c2.206,0,4,1.794,4,4v10C18,16.206,16.206,18,14,18z M4,2\n\t\tC2.897,2,2,2.897,2,4v10c0,1.103,0.897,2,2,2h10c1.103,0,2-0.897,2-2V4c0-1.103-0.897-2-2-2H4z"/>\n\t<path d="M5,9C4.448,9,4,8.552,4,8V6c0-1.103,0.897-2,2-2h2c0.552,0,1,0.448,1,1S8.552,6,8,6H6v2C6,8.552,5.552,9,5,9z"/>\n\t<path d="M12,14h-2c-0.552,0-1-0.448-1-1s0.448-1,1-1h2v-2c0-0.552,0.448-1,1-1s1,0.448,1,1v2C14,13.103,13.103,14,12,14z"/>\n</svg>\n\n      <svg class="icon n-web-zoom-s" viewBox="0 0 18 18">\n\t<path style="fill:none;" d="M14,2H4C2.897,2,2,2.897,2,4v10c0,1.103,0.897,2,2,2h10c1.103,0,2-0.897,2-2V4C16,2.897,15.103,2,14,2z\n\t\t M7,9H5C4.448,9,4,8.553,4,8s0.448-1,1-1h2V5c0-0.553,0.448-1,1-1s1,0.447,1,1v2C9,8.103,8.103,9,7,9z M13,11h-2v2\n\t\tc0,0.553-0.448,1-1,1s-1-0.447-1-1v-2c0-1.103,0.897-2,2-2h2c0.553,0,1,0.447,1,1S13.553,11,13,11z"/>\n\t<path d="M14,0H4C1.794,0,0,1.794,0,4v10c0,2.206,1.794,4,4,4h10c2.206,0,4-1.794,4-4V4C18,1.794,16.206,0,14,0z M16,14\n\t\tc0,1.103-0.897,2-2,2H4c-1.103,0-2-0.897-2-2V4c0-1.103,0.897-2,2-2h10c1.103,0,2,0.897,2,2V14z"/>\n\t<path d="M9,5c0-0.553-0.448-1-1-1S7,4.447,7,5v2H5C4.448,7,4,7.447,4,8s0.448,1,1,1h2c1.103,0,2-0.897,2-2V5z"/>\n\t<path d="M13,9h-2c-1.103,0-2,0.897-2,2v2c0,0.553,0.448,1,1,1s1-0.447,1-1v-2h2c0.553,0,1-0.447,1-1S13.553,9,13,9z"/>\n</svg>\n\n    </a>\n    <div class="u-control-tips"><p>网页全屏</p></div>\n  ',alignRight:!0,defaultEvent:{click:"click"}},Is=function(t){function e(e,i){var n;return(n=t.call(this,e)||this).state="websmall",n.option=x(xs,p(i)?i:{}),n.init(),n}i(e,t);var n=e.prototype;return n.init=function(){t.prototype.create.call(this),this.$dom=ge(this.$dom),this.changeState(this.state),this.$dom.addClass("control-item"),this.$full=this.$dom.find("mango-webscreen-full"),this.$small=this.$dom.find("mango-webscreen-small")},n.changeState=function(t){var e="websmall"===t?"webfull":"websmall";se(this.parent.$dom,t),ae(this.parent.$dom,e)},n.onFullScreenChange=function(){this.parent.isFullscreen&&"webfull"===this.state&&this.exit()},n.enter=function(){this.state="webfull",this.changeState(this.state),se(this.parent.$wrapper,"webfullscreen"),fe(document.documentElement,{overflow:"hidden"})},n.exit=function(){this.state="websmall",this.changeState(this.state),ae(this.parent.$wrapper,"webfullscreen"),fe(document.documentElement,{overflow:"auto"})},n.onEscKeyPressed=function(t){"webfull"===this.state&&(this.exit(),this.parent.emit("webFullScreenChange",{state:this.state}),$e.info("PluginControlbar","user trigger action [toggleWebScreen], status ["+this.state+"]."))},n.toggleWebFullScreen=function(){"websmall"===this.state?this.enter():this.exit(),this.parent.emit("webFullScreenChange",{state:this.state})},n.click=function(t){this.toggleWebFullScreen(),$e.info("PluginControlbar","user trigger action [toggleWebScreen], status ["+this.state+"]."),t.stopPropagation(),t.preventDefault()},e}(us),Ls={tag:"mango-screen",html:'\n    <mango-screen-full>\n      <svg id="n-zoom-s" viewBox="0 0 18 18" width="100%" height="100%">\n        <path d="M6 0a1 1 0 0 0-1 1v2c0 .178-.031.347-.075.511L1.707.293A.999.999 0 1 0 .293 1.707l3.218 3.218A1.96 1.96 0 0 1 3 5H1a1 1 0 0 0 0 2h2c2.206 0 4-1.794 4-4V1a1 1 0 0 0-1-1zM17 13a1 1 0 0 0 0-2h-2c-2.206 0-4 1.794-4 4v2a1 1 0 0 0 2 0v-2c0-.178.031-.347.075-.511l3.218 3.218a.997.997 0 0 0 1.414 0 .999.999 0 0 0 0-1.414l-3.218-3.218A1.96 1.96 0 0 1 15 13h2zM6 16H4c-1.103 0-2-.897-2-2v-2a1 1 0 0 0-2 0v2c0 2.206 1.794 4 4 4h2a1 1 0 0 0 0-2zM14 0h-2a1 1 0 0 0 0 2h2c1.103 0 2 .897 2 2v2a1 1 0 0 0 2 0V4c0-2.206-1.794-4-4-4z"></path>\n      </svg>\n    </mango-screen-full>\n    <mango-screen-small>\n      <svg id="n-zoom" viewBox="0 0 18 18" width="100%" height="100%">\n        <path d="M6 0H4C1.794 0 0 1.794 0 4v2a1 1 0 0 0 2 0V4c0-1.103.897-2 2-2h2a1 1 0 0 0 0-2zM17 11a1 1 0 0 0-1 1v2c0 1.103-.897 2-2 2h-2a1 1 0 0 0 0 2h2c2.206 0 4-1.794 4-4v-2a1 1 0 0 0-1-1zM6 16H4c-1.103 0-2-.897-2-2v-2a1 1 0 0 0-2 0v2c0 2.206 1.794 4 4 4h2a1 1 0 0 0 0-2zM14 0h-2a1 1 0 0 0 0 2h2c1.103 0 2 .897 2 2v2a1 1 0 0 0 2 0V4c0-2.206-1.794-4-4-4z"></path>\n      </svg>\n    </mango-screen-small>\n  ',alignRight:!0,defaultEvent:{click:"click",touchstart:"click"}},Os=(r((ls=function(t){function e(e,i){var n;return(n=t.call(this,e)||this).state="small",n.option=x(Ls,p(i)?i:{}),n.init(),n}i(e,t);var n=e.prototype;return n.init=function(){t.prototype.create.call(this),this.$dom=ge(this.$dom),this.changeState(this.state),this.$dom.addClass("control-item"),this.$full=this.$dom.find("mango-screen-full"),this.$small=this.$dom.find("mango-screen-small")},n.changeState=function(t){var e="small"===t?"full":"small";se(this.parent.$dom,t),ae(this.parent.$dom,e)},n.onWebFullScreenChange=function(t){"webfull"==t.state&&"full"===this.state&&this.exit()},n.exit=function(){this.state="small",this.changeState(this.state),this.parent.$fullscreen(!1,"container")},n.onIpadEndFullscreen=function(){this.state="small",this.changeState(this.state),this.parent.play(),de(this.parent.__dispatcher.dom.videoElement,"webkitendfullscreen",this.onIpadEndFullscreen)},n.fullscreenchange=function(){var t=this.parent.fullscreenElement;this.state=t?"full":"small",this.changeState(this.state),t?se(this.parent.$wrapper,"fullscreen"):ae(this.parent.$wrapper,"fullscreen")},n.click=function(){if(this.parent.config.isIpad){var t=this.parent.__dispatcher.dom.videoElement;t.webkitEnterFullscreen(),ue(t,"webkitendfullscreen",this.onIpadEndFullscreen)}else{var e=!this.parent.fullscreenElement;this.parent.$fullscreen(e,"container")}$e.info("PluginControlbar","user trigger action [toggleFullScreen].")},e}(us)).prototype,"onIpadEndFullscreen",[_i],s(ls.prototype,"onIpadEndFullscreen"),ls.prototype),ls),Ms={tag:"mango-playrate",cls:"u-control-speed control-item",width:"2em",html:'\n  <span class="btn" action="togglePanel">倍速</span>\n  <div class="u-box">\n      <p class="ucbox">\n          <a href="javascript:;" action="switch"  data-rate="6">2.0x</a>\n          <a href="javascript:;" action="switch"  data-rate="5">1.5x</a>\n          <a href="javascript:;" action="switch"  data-rate="4">1.25x</a>\n          <a href="javascript:;" action="switch"  data-rate="3" class="focus">1.0x</a>\n          <a href="javascript:;" action="switch"  data-rate="2">0.75x</a>\n          <a href="javascript:;" action="switch"  data-rate="1">0.5x</a>\n      </p>\n  </div>\n  ',alignRight:!0,defaultEvent:{click:"click",mouseout:"mouseout",mouseover:"mouseover"},list:[{index:1,name:"0.5"},{index:2,name:"0.75"},{index:3,name:"1.0"},{index:4,name:"1.25"},{index:5,name:"1.5"},{index:6,name:"2.0"}],selected:0,duration:10,increment:1},$s=function(t){function e(e,i){var n;return(n=t.call(this,e)||this).option=x(Ms,p(i)?i:{}),n.list=n.option.list||[],n.init(),n}i(e,t);var n=e.prototype;return n.init=function(){t.prototype.create.call(this),this.$text=ge(this.$dom).find(".btn"),this.$list=ge(this.$dom).find(".ucbox")},n.inited=function(){var t=this.parent.userSetting.playbackRate;this.selected=this.list.findIndex(function(e){return e.index==t});var e=this.$list.find('[data-rate="'+t+'"]'),i=this.list[this.selected],n=3==i.index?"倍速":i.name+"x";this.parent.playbackRate=parseFloat(i.name),this.$text.text(n),this.$list.find("a").removeClass("focus"),e.addClass("focus"),this.parent.vm._config.useFlash&&this.enable(!1)},n.restoreRate=function(){var t=this.parent.userSetting.playbackRate;this.selected=this.list.findIndex(function(e){return e.index==t});var e=this.list[this.selected];this.parent.playbackRate=parseFloat(e.name)},n.enable=function(t){void 0===t&&(t=!0),fe(this.$dom,t?{display:"inline-block"}:{display:"none"})},n.hide=function(){ae(this.$dom,"on")},n.togglePanel=function(){this.parent.children.clarity.hide(),this.parent.children.setting.hide(),ce(this.$dom,"on")?ae(this.$dom,"on"):se(this.$dom,"on")},n.adjust=function(t){if(!this.parent.vm._config.useFlash){var e=this.selected+t;(e=Math.max(0,Math.min(e,this.list.length-1)))!=this.selected&&(this.selected=e,this.setRate(this.list[e]))}},n.switch=function(t){var e=t.target.dataset.rate||3;this.selected=this.list.findIndex(function(t){return t.index==e}),this.setRate(this.list[this.selected])},n.setRate=function(t){var e=this.$list.find('[data-rate="'+t.index+'"]'),i=3==t.index?"倍速":t.name+"x",n=parseFloat(t.name);this.$list.find("a").removeClass("focus"),e.addClass("focus"),this.$text.text(i),Se.set("mango-playback-rate",t.index),this.parent.userSetting.playbackRate=t.index,this.parent.playbackRate=n,this.parent.emit("switchPlayRate",{rate:n,name:i}),this.parent.children.tip.showBottomTip({_type:"commonTPL",_time:2e3,info:"正以 ",text:t.name+"x",other:"倍速播放，键盘 [ ] 快速调节"}),$e.info("PluginControlbar","user trigger action [setRate], rate ["+t.name+"x].")},n.click=function(t){var e=t.target.getAttribute("action");u(this[e])?this[e](t):t.stopPropagation()},n.mouseover=function(t){this.hideTimer&&clearTimeout(this.hideTimer)},n.mouseout=function(t){var e=this;this.hideTimer&&clearTimeout(this.hideTimer),this.hideTimer=setTimeout(function(){e.hide()},200)},e}(us),Fs="PluginControlbar",Ns=/iPad/i.test(navigator.userAgent),Vs={tag:"mango-clarity",cls:"u-control-clarity",width:"2em",html:'\n      <span class="btn" action="togglePanel">标清</span>\n      <div class="u-box">\n          <div class="ucbox"></div>\n      </div>\n  ',vipIcon:'<svg class="icon n-vip" id="n-vip" viewBox="0 0 14 14" width="100%" height="100%">\n  <path d="M1.507 1.5L.135 4h2.538zM12.495 1.5L11.329 4h2.533zM5.706 12.375a1.705 1.705 0 0 0 2.652.002L13.585 6H.421l5.285 6.375zM9.281 4l1.399-3H3.318l1.399 3z"></path>\n</svg>',alignRight:!0,defaultEvent:{click:"click",mouseout:"mouseout",mouseover:"mouseover"},lastShowDowngradeTipTime:0,waitingRecords:[],autoDef:!1,list:[],autoSelected:0,selected:0,duration:10,increment:1,targetDef:-1},Hs=function(t){function e(e,i){var n;return(n=t.call(this,e)||this).option=x(Vs,p(i)?i:{}),n.init(),n}i(e,t);var n=e.prototype;return n.init=function(){t.prototype.create.call(this),se(this.$dom,"control-item"),this.$text=ge(this.$dom).find(".btn"),this.$list=ge(this.$dom).find(".ucbox"),this.reset()},n.reset=function(){this.waitingTooLongTimer&&clearTimeout(this.waitingTooLongTimer),this._autoDefDetectLoopTimer&&clearInterval(this._autoDefDetectLoopTimer),this.lastShowDowngradeTipTime=0,this._autoDefDetectLoopCounter=0,this.targetDef=-1,this.waitingRecords=[]},n.calculateClarityBySpeed=function(t){for(var e,i=this.clarityList,n=i.length,r=0;r<n-1;r++){var o=i[r];if(t>o.speed&&o.purview){e=o;break}}return!e&&i[n-2].purview&&(e=i[n-2]),e},n.showDowngradeTip=function(){var t=this;if(!Ns){var e=this.parent.vm.downloadSpeed.toFixed(2),i=this.calculateClarityBySpeed(e);if(i&&!(i&&this.selected&&i.def>=this.selected.def)){var n=i.def,r=i.name;this.lastShowDowngradeTipTime=+new Date,this.parent.children.tip&&this.parent.children.tip.showBottomTip({_type:"commonTPL",_time:3e3,info:"网络有点卡，点击切换清晰度至",text:"["+r+"]",action:"changeClarity",actionCallback:function(e){t.parent.emit("switchClarity",{def:n,name:r,purview:!0}),t.changeState({def:n,name:r})}})}}},n.onTimeUpdate=function(){this.waitingTooLongTimer&&clearTimeout(this.waitingTooLongTimer)},n.onVideoWaiting=function(){var t=this,e=+new Date;this.autoDef||(this.waitingTooLongTimer&&clearTimeout(this.waitingTooLongTimer),this.waitingTooLongTimer=setTimeout(function(){e-t.lastShowDowngradeTipTime>3e5&&($e.info(Fs,"waiting too long, show downgrade tip."),t.showDowngradeTip())},5e3),this.waitingRecords.push({currentTime:this.parent.currentTime,timestamp:e}),this.waitingRecords.length>=3&&(4==this.waitingRecords.length&&this.waitingRecords.shift(),this.waitingRecords[2].timestamp-this.waitingRecords[0].timestamp<1e4&&e-this.lastShowDowngradeTipTime>3e5&&($e.info(Fs,"waiting too frequently, show downgrade tip."),this.showDowngradeTip())))},n.supportAutoDef=function(){return!this.parent.vm._config.useFlash&&!Ns&&!this.parent.vm._config.isLive},n.initTextList=function(t,e,i,n){var r=this;this.reset();var o=(t||this.option.list||[]).slice(0);this.supportAutoDef()&&!n?o.push({def:"0",name:"自动",vip:0,purview:!0}):(i=!1,this.autoDef=!1),this.clarityList=t,t.forEach(function(t,e){t.speed=1.5*t.filebitrate/8,""!=t.url?t.purview=!0:t.purview=!1}),this.option.list=o,this.autoDef=i,this.autoDef?this.autoSelected=e:this.selected=e,this.$list.html(""),o.forEach(function(t){var e=ge(document.createElement("a")),i="";e.attr("data-def",t.def),e.attr("data-name",t.name),e.attr("data-purview",t.purview),e.attr("data-speed",t.speed),e.attr("action","switch"),0!=t.vip&&(i=r.option.vipIcon,e.addClass("vip")),e.html(t.name+i),r.$list.append(e)}),this.changeState(e)},n.hide=function(){ae(this.$dom,"on")},n.togglePanel=function(){this.parent.children.playrate&&this.parent.children.playrate.hide(),this.parent.children.setting&&this.parent.children.setting.hide(),ce(this.$dom,"on")?ae(this.$dom,"on"):se(this.$dom,"on")},n.switch=function(t){var e=t.target.dataset.def||"",i=t.target.dataset.name||"",n="true"==t.target.dataset.purview;if($e.info(Fs,"user trigger action [switchClarity], definition ["+i+"}]."),!n)return $e.info(Fs,"user is not vip, cannot watch current definition ["+i+"}]."),this.parent.emit("switchClarity",{def:e,name:i,purview:n}),!1;0==e?(this.autoDef=!0,this.autoSelected=this.selected,Se.set("mango-def-auto",1)):(this.autoDef=!1,this.targetDef=e,this.parent.emit("switchClarity",{def:e,name:i,purview:n})),this.hide(),this.changeState({def:e,name:i})},n.changeState=function(t){0!=t.def&&(this.selected=t),this.autoDef?(this.$list.find("a").removeClass("focus"),this.$list.find('[data-def="0"]').addClass("focus"),this.$list.find('[data-def="0"]').html("自动("+this.autoSelected.name+")"),this.$text.text("自动")):(this.$list.find("a").removeClass("focus"),this.$list.find('[data-def="'+t.def+'"]').addClass("focus"),this.$text.text(t.name),this.$list.find('[data-def="0"]').html("自动"))},n.click=function(t){var e=t.target.getAttribute("action");u(this[e])?this[e](t):t.stopPropagation()},n.mouseover=function(t){this.hideTimer&&clearTimeout(this.hideTimer)},n.mouseout=function(t){var e=this;this.hideTimer&&clearTimeout(this.hideTimer),this.hideTimer=setTimeout(function(){e.hide()},200)},n.clarityChanged=function(t){if(t.error)this.autoDef||this.changeState(this.selected),$e.info(Fs,"switch definition to ["+t.stream.name+"}] fail, restore to last definition ["+this.selected.name+"].");else if(this.autoDef)this.autoSelected=t.stream,this.changeState(this.autoSelected),$e.info(Fs,"auto switch definition to ["+t.stream.name+"}] ok.");else{if(t.stream.def!==this.targetDef)return;this.selected=t.stream,this.changeState(this.selected),$e.info(Fs,"user switch definition to ["+t.stream.name+"}] ok.")}},e}(us),Bs={buyVipTPL:'<p>非会员可以试看<i>{{time}}</i>分钟，点击<a href="javascript:void(0);" action="showVipDialog">开通会员</a></p>',buyMovieTPL:'<p>免费试看<i>{{time}}</i>分钟,观看完整影片请 <a href="javascript:void(0);" action="showVipDialog">购买单片</a></p>',useCouponTPL:'<p>免费试看<i>{{time}}</i>分钟,观看完整影片请 <a href="javascript:void(0);" action="showVipDialog">使用观影券</a></p>',skipStartTPL:"<p>已经为您跳过片头</p>",skipEndTPL:"<p>即将为您跳过片尾</p>",continuePlayTPL:"<p>接上次观看时间{{time}}继续播出</p>",commonTPL:'<p>{{info}}<b class="hot" action="custom{{action}}">{{text}}</b> {{other}}</p>'},Us={tag:"mango-control-tip",html:'<div class="u-control-tips">\n    <div class="control-tips-pop"></div>\n    <div class="control-tips-line"></div>\n  </div>\n  <div class="u-control-toast"></div>',defaultEvent:{click:"click"}},Ws=function(t){function e(e,i){var n;return(n=t.call(this,e)||this).option=x(Us,p(i)?i:{}),n.init(),n}i(e,t);var n=e.prototype;return n.init=function(){t.prototype.create.call(this),this.$dom=ge(this.$dom),this.$tipsBox=this.$dom.find(".u-control-tips"),this.$tip=this.$dom.find(".control-tips-pop"),this.$tipLine=this.$dom.find(".control-tips-line"),this.$toast=this.$dom.find(".u-control-toast"),this.permanent=!1},n.initTip=function(){var t=this.parent.videoinfo,e=t.info.paymark,i=t.user.purview,n=0;n=t.info.trialtime>60?Math.floor(t.info.trialtime/60):(t.info.trialtime/60).toFixed(1),this.permanent=!1,200!=i&&(this.permanent=!0,this.showBottomTip({_type:["","buyVipTPL","buyMovieTPL","useCouponTPL"][e],_time:0,time:n,permanent:!0}))},n.showToast=function(t){var e=this;if(t&&t.toast){var i=t.duration||3e3;this.$toast.html("<span>"+t.toast+"</span>").show(),this.toastTimer=setTimeout(function(){e.$toast.html("").hide()},i)}},n.showBottomTip=function(t){var e=this,i=Bs[t._type]||t._tpl;null!=i&&(t.action&&t.actionCallback&&(this["custom"+t.action]=t.actionCallback),this.timerId&&clearTimeout(this.timerId),i=function(t,e){return _(t)&&p(e)?t.replace(/{{(\w+)}}/g,function(t,i){return 0===e[i]?0:e[i]||""}):""}(i,t),t&&t.permanent?(this.$tip.hide(),this.$tipLine.html(i).show(),this.permanent=!0):(this.$tipLine.hide(),this.$tip.html(i).show()),~~t._time>0&&(this.timerId=setTimeout(function(){e.$tip.html("").hide(),e.permanent&&e.$tipLine.show()},t._time)))},n.showVipDialog=function(){this.parent.emit("showVipDialog",this.parent.videoinfo)},n.close=function(){this.timerId&&clearTimeout(this.timerId),this.toastTimer&&clearTimeout(this.toastTimer),this.$tip.html("").hide(),this.$tipLine.html("").hide(),this.$toast.html("").hide(),this.permanent=!1},n.click=function(t){var e=t.target.getAttribute("action");u(this[e])&&this[e](t)},e}(us),zs={tag:"mango-control-status",cls:"u-control-status",html:'\n  <div class="mph-header-box">\n      <div class="mph-header-left">\n          <a class="scale50" action="onSetDisplayRatio" data-ratio="50">\n            <svg class="icon n-scale50" id="n-scale50" viewBox="0 0 16 16" width="100%" height="100%">\n              <path d="M13.5 1h-11A2.503 2.503 0 0 0 0 3.5v9C0 13.878 1.122 15 2.5 15h11c1.378 0 2.5-1.122 2.5-2.5v-9C16 2.122 14.878 1 13.5 1zM15 12.5c0 .827-.673 1.5-1.5 1.5h-11c-.827 0-1.5-.673-1.5-1.5v-9C1 2.673 1.673 2 2.5 2h11c.827 0 1.5.673 1.5 1.5v9z"></path><path d="M10 6H6a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1z"></path>\n            </svg>50%\n          </a>\n          <a class="scale75" action="onSetDisplayRatio" data-ratio="75">\n            <svg class="icon n-scale75" id="n-scale75" viewBox="0 0 16 16" width="100%" height="100%">\n              <path d="M13.5 1h-11A2.503 2.503 0 0 0 0 3.5v9C0 13.878 1.122 15 2.5 15h11c1.378 0 2.5-1.122 2.5-2.5v-9C16 2.122 14.878 1 13.5 1zM15 12.5c0 .827-.673 1.5-1.5 1.5h-11c-.827 0-1.5-.673-1.5-1.5v-9C1 2.673 1.673 2 2.5 2h11c.827 0 1.5.673 1.5 1.5v9z"></path><path d="M12 5H4a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1z"></path>\n            </svg>75%\n          </a>\n          <a class="scale100 sel" action="onSetDisplayRatio" data-ratio="100">\n            <svg class="icon n-scale100" id="n-scale100" viewBox="0 0 16 16" width="100%" height="100%">\n              <path d="M13.5 1h-11A2.503 2.503 0 0 0 0 3.5v9C0 13.878 1.122 15 2.5 15h11c1.378 0 2.5-1.122 2.5-2.5v-9C16 2.122 14.878 1 13.5 1zM15 12.5c0 .827-.673 1.5-1.5 1.5h-11c-.827 0-1.5-.673-1.5-1.5v-9C1 2.673 1.673 2 2.5 2h11c.827 0 1.5.673 1.5 1.5v9z"></path><path d="M13 3H3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1z"></path>\n            </svg>100%\n          </a>\n      </div>\n      <div class="mph-header-mid"></div>\n      <div class="mph-header-right">00:00</div>\n  </div>\n  ',alignTop:!0,defaultEvent:{click:"click"}},js=function(t){function e(e,i){var n;return(n=t.call(this,e)||this).option=x(zs,p(i)?i:{}),n.init(),n}i(e,t);var n=e.prototype;return n.init=function(){t.prototype.create.call(this),this.$domWrap=ge(this.$dom),this.updateTime()},n.inited=function(){var t=this.parent.userSetting.fullscreenRatio;this.$domWrap.find(".mph-header-left a").removeClass("on"),this.$domWrap.find('[data-ratio="'+t+'"]').addClass("on")},n.initInfo=function(){var t=this.parent.vm.getVideoInfo()||this.parent.videoinfo.info;this.$domWrap.find(".mph-header-mid").html(t.title)},n.setDisplayRatio=function(t){this.parent.width=t+"%",this.parent.userSetting.fullscreenRatio=t,this.$domWrap.find(".mph-header-left a").removeClass("on"),this.$domWrap.find('[data-ratio="'+t+'"]').addClass("on")},n.onSetDisplayRatio=function(t){var e=t.target.dataset.ratio;this.setDisplayRatio(e),$e.info("PluginControlbar","user trigger action [setDisplayRatio], ratio ["+e+"].")},n.onFullScreenChange=function(t){var e=this,i=this.parent.children.screen,n=this.parent.children.webscreen;this.detectTimer&&clearTimeout(this.detectTimer),this.detectTimer=setTimeout(function(){if("webfull"==n.state||"full"===i.state){var t=e.parent.userSetting.fullscreenRatio;e.setDisplayRatio(t)}else e.parent.width="100%"},0)},n.updateTime=function(){var t=this;clearTimeout(this.updateTimerId);var e=ft(new Date,"hh:mm");this.$domWrap.find(".mph-header-right").html(e),this.updateTimerId=setTimeout(function(){t.updateTime()},3e4)},n.click=function(t){var e=t.target.getAttribute("action");u(this[e])&&this[e](t)},e}(us),qs={tag:"mango-danmu-switch",cls:"u-control-danmu",html:'<div class="btn">\n    <span>\n      <svg class="icon n-dan" id="n-dan" viewBox="0 0 11 10" width="100%" height="100%">\n        <path d="M0 1h2v2H0v4h2v2H0v1h3V6H1V4h2V0H0zM5 0h1v1H5zM9 0h1v1H9zM9 2V1H8v1H7V1H6v1H4v5h3v1H4v1h3v1h1V9h3V8H8V7h3V2H9zM7 6H5V5h2v1zm0-2H5V3h2v1zm3 2H8V5h2v1zm0-2H8V3h2v1z"></path>\n      </svg>\n    </span>\n  </div>',alignRight:!0,defaultEvent:{click:"click"}},Gs={play:ms,playLoop:gs,playNext:_s,volume:bs,progressBar:Rs,progressTime:ks,setting:Ds,webscreen:Is,screen:Os,playrate:$s,clarity:Hs,tip:Ws,danmu:function(t){function e(e,i){var n;return(n=t.call(this,e)||this).option=x(qs,p(i)?i:{}),n.init(),n}i(e,t);var n=e.prototype;return n.init=function(){t.prototype.create.call(this),this.$domWrap=ge(this.$dom),this.$domWrap.addClass("control-item"),this.vm=this.parent.__dispatcher.vm},n.hide=function(){this.$domWrap.css("visibility","hidden")},n.onDanmuConfig=function(t){t.switcher?this.$domWrap.css("visibility","visible"):this.$domWrap.css("visibility","hidden"),t.userConfig?this.$domWrap.addClass("on"):this.$domWrap.removeClass("on")},n.changeState=function(t){void 0!==t.state&&null!==t.state&&(t.state?this.$domWrap.addClass("on"):this.$domWrap.removeClass("on"))},n.inited=function(){var t=Se.get("mango-danmu-switch");this.changeState({state:t})},n.click=function(t){this.parent.userSetting.danmuSwitch?(this.parent.userSetting.danmuSwitch=0,Se.set("mango-danmu-switch",0),this.$domWrap.removeClass("on"),this.vm.toggleDanmuButton(this.parent.userSetting.danmuSwitch)):(this.parent.userSetting.danmuSwitch=1,Se.set("mango-danmu-switch",1),this.$domWrap.addClass("on"),this.vm.toggleDanmuButton(this.parent.userSetting.danmuSwitch)),this.parent.emit("danmuStatusChange",{state:this.parent.userSetting.danmuSwitch}),$e.info("PluginControlbar","user trigger action [toggleDanmu], status ["+this.parent.userSetting.danmuSwitch+"]")},e}(us),playStatus:js,default:ps},Ks=function(t){var e=t.config.isIpad,i=t.config.disableDanmuPlugin;return t.$config.children?t.$config.children:t.isLive?{play:!0,danmu:!0,volume:!0,clarity:!0,screen:!0,tip:!0}:{play:!0,playNext:!0,playLoop:!0,progressTime:!0,progressBar:!0,danmu:!(e||i),clarity:!e,playrate:!e,volume:!e,setting:!0,webscreen:!e,screen:!0,tip:!0,playStatus:!e}};var Ys={},Xs=!1,Qs=M.document;function Js(t){if(Xs)setTimeout(Js,0,t);else{var e=Ys[t];if(e){Xs=!0;try{!function(t){var e=t.callback,i=t.args;switch(i.length){case 0:e();break;case 1:e(i[0]);break;case 2:e(i[0],i[1]);break;case 3:e(i[0],i[1],i[2]);break;default:e.apply(void 0,i)}}(e)}finally{!function(t){delete Ys[t]}(t),Xs=!1}}}}var Zs,ta,ea=Object.getPrototypeOf&&Object.getPrototypeOf(M);ea=ea&&ea.setTimeout?ea:M,"[object process]"==={}.toString.call(M.process)||(!function(){if(M.postMessage&&!M.importScripts){var t=!0,e=M.onmessage;return M.onmessage=function(){t=!1},M.postMessage("","*"),M.onmessage=e,t}}()?M.MessageChannel?(new MessageChannel).port1.onmessage=function(t){Js(t.data)}:Qs&&"onreadystatechange"in Qs.createElement("script")&&Qs.documentElement:(Zs="setImmediate$"+Math.random()+"$",ta=function(t){t.source===M&&"string"==typeof t.data&&0===t.data.indexOf(Zs)&&Js(+t.data.slice(Zs.length))},M.addEventListener?M.addEventListener("message",ta,!1):M.attachEvent("onmessage",ta)));Function.prototype.apply;function ia(t){"number"==typeof t&&"function"==typeof M.clearInterval?M.clearInterval(t):function(t){t&&"function"==typeof t.close&&t.close()}(t)}var na=/iPad/i.test(navigator.userAgent),ra="PluginControlbar",oa={hideBarTime:3e3,barShowByMouse:"move"},sa={name:"mangoControl",el:"mango-control",data:{children:{},show:!0,adlock:!1,disabled:!0},level:101,operable:!1,penetrate:!1,create:function(){},init:function(t){var e=this;t.controls&&(this.show=!0,t.controls=!1);var i,n,r=this;Pi(t,{controls:ci({get:function(){return r.show},set:function(t){return r.show=Boolean(t),r._display(),!1}},{preSet:!0})},{self:!0}),this.config=p(this.$config)?x(oa,this.$config):oa,this.vm=this.__dispatcher.vm,this.__wrapper=this.__dispatcher.dom.wrapper,this.config.isIpad=na,this.config.disableDanmuPlugin=this.vm._config.disableDanmuPlugin,this.config.hideBarTime=na?0:this.config.hideBarTime,this.$dom.innerHTML="\n    <mango-control-bg></mango-control-bg>\n    <mango-control-wrap>\n        <mango-control-wrap-left></mango-control-wrap-left>\n        <mango-control-wrap-slot></mango-control-wrap-slot>\n        <mango-control-wrap-right></mango-control-wrap-right>\n    </mango-control-wrap>",this.$domWrap=ge(this.$dom),this.$wrap=this.$dom.querySelector("mango-control-wrap"),this.$wrapLeft=this.$dom.querySelector("mango-control-wrap-left"),this.$wrapRight=this.$dom.querySelector("mango-control-wrap-right"),this.children=(n=(i=this).config.children=Ks(i),c(n).filter(function(t){return n[t]}).reduce(function(t,e){var r=Gs[e]||Gs.default;return t[e]=new r(i,n[e]),t},{})),na&&(this.show=!1),this.$controlWrap=ge(this.$wrap),this.autoHideControlsLock=!1,this.midAdWillBeginTimer&&ia(this.midAdWillBeginTimer),this.addEvent(),this.getUserSetting(),this.onTimeUpdate=ct(function(){e._progressUpdate(),e.detectVideoWillEnd(),e.children.clarity&&e.children.clarity.onTimeUpdate(),e.children.progressBar&&e.children.progressBar.progress()},200),this.onSeeked=ct(function(t){e._onSeeked(t)},500),$e.info(ra,"plugin init ok.")},destroy:function(){window.clearTimeout(this.timeId),$e.info(ra,"plugin destroy ok.")},inited:function(){for(var t in this.children)this.children[t].inited&&this.children[t].inited();this.$status=this.$dom.querySelector("mango-control-status"),$e.info(ra,"plugin inited ok.")},events:{play:function(){this.children.play&&this.children.play.changeState("play")},cmsData:function(t){if("loadComplete"==t.status){if(this.videoinfo=t.data,this.skipStartTime=Number(this.videoinfo.points.start.split("|")[0])||0,this.skipEndTime=Number(this.videoinfo.points.end.split("|")[0])||0,200!=this.videoinfo.user.purview&&0==this.videoinfo.info.trialtime)return void this.emit("showVipDialog",this.videoinfo);this.children.progressBar&&this.children.progressBar.initKeyPoints(t.data.points,t.data.info.duration),this.children.progressBar&&this.children.progressBar.initFrames(t.data.frame),this.children.tip&&this.children.tip.initTip(),this.children.playStatus&&this.children.playStatus.initInfo(),this.children.progressTime&&this.children.progressTime.updateTotal(t.data.info.duration)}},nextVideoInfo:function(t){this.nextvideoinfo=t,this.children.playNext&&this.children.playNext.setNextVideoInfo(t)},clarityData:function(t){this.children.clarity&&this.children.clarity.initTextList(t.stream,t.def,t.isAutoDef,t.isDrm)},switchClarity:function(t){if(t.purview){if(this.paused&&this.play(),t.auto||t.silent)return;this.vm._config.isLive||this.children.tip.showBottomTip({_type:"commonTPL",_time:3e3,info:"正在为您切换至 ",text:"["+t.name+"]"})}},clarityChanged:function(t){var e=this.children.clarity;if(e&&e.clarityChanged(t),!t.auto&&!t.silent)if(t.error)this.children.tip.showBottomTip({_type:"commonTPL",_time:3e3,info:"抱歉，清晰度切换失败，请重试",text:""});else{var i=e&&e.targetDef;if(t.stream.def!==i)return;e.targetDef=-1,this.children.tip.showBottomTip({_type:"commonTPL",_time:5e3,info:"已切换至 ",text:"["+t.stream.name+"]"})}},switchToFlash:function(){this.vm._config.useFlash=!0,$e.info(ra,"user trigger action [switchToFlash]."),this.vm.reload(this.vm._config.video_id),this.children.playrate&&this.children.playrate.enable(!1)},switchToHtml5:function(){this.vm._config.useFlash=!1,$e.info(ra,"user trigger action [switchToHtml5]."),this.vm.reload(this.vm._config.video_id),this.children.playrate&&this.children.playrate.enable(!0)},danmuConfig:function(t){this.children.danmu&&this.children.danmu.onDanmuConfig(t)},danmuStatusChange:function(t){this.children.danmu&&this.children.danmu.changeState(t)},toggleWebFullScreen:function(){this.children.webscreen&&this.children.webscreen.toggleWebFullScreen()},webFullScreenChange:function(t){this.isWebFullScreen="webfull"==t.state,this.children.screen&&this.children.screen.onWebFullScreenChange(t),this.children.playStatus&&this.children.playStatus.onFullScreenChange(t)},fullscreenchange:function(t){var e=this.fullscreenElement?"full":"small";this.isFullScreen=!!this.fullscreenElement,this.children.webscreen&&this.children.webscreen.onFullScreenChange({state:e}),this.children.playStatus&&this.children.playStatus.onFullScreenChange({state:e}),this.children.screen&&this.children.screen.fullscreenchange({state:e})},frontAdBegin:function(){this.playbackRate=1,this.adLockUI(!0)},midAdWillBegin:function(t){var e=this;this.adlock=!0,this._disable(!0),this._hideItself();var i=Math.floor(t.time/this.playbackRate),n=function(){e.children.tip.showBottomTip({_type:"commonTPL",_time:1e3,info:"即将进入广告  ",text:i+"s"})};n(),this.midAdWillBeginTimer=setInterval(function(){--i>0?n():ia(e.midAdWillBeginTimer)},1e3)},midAdBegin:function(){this.playbackRate=1,this.adLockUI(!0),this.children.clarity&&this.children.clarity.reset()},midAdEnd:function(){this.children.playrate&&this.children.playrate.restoreRate(),this.adLockUI(!1),this.volume=this.userSetting.volume,this.children.volume&&this.children.volume.update()},videoPlay:function(){this.adLockUI(!1),this.children.play&&this.children.play.changeState("play"),this.children.playrate&&this.children.playrate.inited(),this.children.progressBar&&this.children.progressBar.preFetch(),this.volume=this.userSetting.volume,this.children.volume&&this.children.volume.update(),"0px"==pe(this.$wrap,"bottom")&&this.emit("controlbarChange",{visible:!0}),na||this._hideItself()},videoPause:function(){this.adlock||(this.children.play&&this.children.play.changeState("pause"),this._showItself(),this.children.playNext&&this.children.playNext.cancelVideoEnd(),this.vm.emit("cancelVideoWillEnd"))},videoResume:function(){this.children.playrate&&this.children.playrate.restoreRate()},videoEnd:function(){if(200!=this.videoinfo.user.purview)return $e.info("PluginControl","user has right to watch full, [LoopPlay]  disabled."),!1;this.userSetting.isLoop?(this.vm.emit("videoReplay"),$e.info("PluginControl","LoopPlay setting is on, start loop play. "),this.children.playNext&&this.children.playNext.cancelVideoEnd()):(this.children.playNext&&this.children.playNext.playNext(),this.children.playNext&&this.children.playNext.cancelVideoEnd()),this.children.play&&this.children.play.changeState("pause")},videoRefresh:function(){this.onVideoReplay()},videoReplay:function(){this.onVideoReplay()},videoReload:function(){this.adlock=!0,this._disable(!0),this.midAdWillBeginTimer&&ia(this.midAdWillBeginTimer),fe(this.$dom,{visibility:"hidden"}),fe(this.$dom,{display:"none"}),this.children.tip&&this.children.tip.close(),this.children.playNext&&this.children.playNext.hide(),this.children.danmu&&this.children.danmu.hide(),this.children.clarity&&this.children.clarity.reset()},lockUI:function(){this.adLockUI(!0)},unlockUI:function(){this.adLockUI(!1)},contextmenu:function(){this.contextMenuIsShow=!0},contextmenuClose:function(){this.contextMenuIsShow=!1},showHdDialog:function(){this.children.webscreen&&this.children.webscreen.exit(),this.children.screen&&this.children.screen.exit()},showVipDialog:function(){this.children.webscreen&&this.children.webscreen.exit(),this.children.screen&&this.children.screen.exit()},showBottomTip:function(t){this.children.tip&&this.children.tip.showBottomTip(t)},showToast:function(t){this.children.tip&&this.children.tip.showToast(t)},videoWaiting:function(){this.children.clarity&&this.children.clarity.onVideoWaiting()},hlsStreamError:function(t){t&&t.data&&t.data.fatal&&this.adLockUI(!0)},c_resize:function(t){this.children.progressBar&&this.children.progressBar.resize()},c_mouseenter:function(){na||this.adlock||this._mousemove()},c_mousemove:function(){na||this.adlock||this._mousemove()},c_mouseleave:function(){na||this.adlock||this._hideItself(300)},timeupdate:function(){this.onTimeUpdate()},progress:function(){},volumechange:function(){this.disabled||this.adlock||(this.userSetting.volume=this.volume,Se.set("mango-volume",this.volume),this.children.volume&&this.children.volume.update())},w_swipe:function(t){if(!this.disabled&&!this.adlock){var e=t.detail.data[0].currentDirection;if(e>=330||e<=30){var i=this.currentTime+10;return this.currentTime=i>this.duration?this.duration:i,void this._mousemove()}if(e>150&&e<=210){var n=this.currentTime-10;return this.currentTime=n<0?0:n,void this._mousemove()}if(e>=60&&e<=120){var r=this.volume+.1;this.volume=r>1?1:r}else if(e>=240||e<=300){var o=this.volume-.1;this.volume=o<0?0:o}else;}},g_keydown:function(t){var e=document.activeElement.tagName.toUpperCase(),i=document.activeElement.getAttribute("contenteditable");if("INPUT"==e||"TEXTAREA"==e||""==i||"true"==i)return!1;if(!this.disabled)switch(t.stopPropagation(),t.keyCode){case 27:this.children.webscreen&&this.children.webscreen.onEscKeyPressed(t);break;case 32:t.preventDefault(),this.children.play&&this.children.play.click(t);break;case 37:t.preventDefault(),this.onSeeked(-1);break;case 39:t.preventDefault(),this.onSeeked(1);break;case 38:t.preventDefault(),this.children.volume&&this.children.volume.adjust(1);break;case 40:t.preventDefault(),this.children.volume&&this.children.volume.adjust(-1);break;case 219:t.preventDefault(),this.children.playrate&&this.children.playrate.adjust(-1);break;case 221:t.preventDefault(),this.children.playrate&&this.children.playrate.adjust(1)}},c_touchstart:function(t){this.adlock||na&&!this.adlock&&-1!=t.target.tagName.indexOf("VIDEO")&&(this.isExpand?this._hideItself():this._showItself(),this.isExpand=!this.isExpand)},click:function(t){var e=this;if(na);else{if(this.contextMenuIsShow)return;var i=new Date,n=this.clickTime;if(this.clickTime=i,i-n<300)return void clearTimeout(this.clickTimeId);this.clickTimeId=setTimeout(function(){!e.disabled&&e.children.play&&e.children.play.click(t)},300)}},dblclick:function(t){!this.disabled&&this.children.screen&&this.children.screen.click()}},methods:{onVideoReplay:function(){var t=0;this.userSetting.isSkip&&this.skipStartTime>0&&t<this.skipStartTime&&($e.info(ra,"skip start is on, seek to "+t),t=this.skipStartTime,this.children.tip.showBottomTip({_type:"skipStartTPL",_time:2e3})),this.stopLoad(),this.startLoad(),this.seek(t),this.play()},adLockUI:function(t){void 0===t&&(t=!0),t?(this.adlock=!0,this._disable(!0),fe(this.$dom,{visibility:"hidden"})):(this.adlock=!1,this._disable(!1),fe(this.$dom,{visibility:"visible"}))},addEvent:function(){this.$controlWrap.on("mouseover",this._isShowControl),this.$controlWrap.on("mouseenter",this._isShowControl),this.$controlWrap.on("mouseout",this._isHideControl)},_progressUpdate:function(){this.children.progressBar&&this.children.progressBar.update(),this.children.progressTime&&this.children.progressTime.updatePass()},_onSeeked:function(t){if(t>0){var e=this.currentTime+10;this.currentTime=e>this.duration?this.duration:e,this._mousemove()}else{var i=this.currentTime-10;this.currentTime=i<0?0:i,this._mousemove()}},getUserSetting:function(){this.userSetting={isSkip:0!==Se.get("mango-skip-start"),isLoop:Se.get("mango-loop-open"),volume:Se.get("mango-volume")||.5,playbackRate:Se.get("mango-playback-rate")||3,fullscreenRatio:100,danmuSwitch:Se.get("mango-danmu-switch")}},trialViewEnd:function(){return 200!=this.videoinfo.user.purview&&(this.currentTime>=this.videoinfo.info.trialtime||0==this.videoinfo.info.trialtime)&&(this.emit("showVipDialog",this.videoinfo),$e.info(ra,"user not logiged or not authorized, open VIP payment dialog."),!0)},detectVideoWillEnd:function(){if(!this.vm._config.isLive&&!this.adlock&&!this.trialViewEnd()){var t=this.videoinfo.info.duration;this.userSetting.isSkip&&this.skipEndTime>0&&(t=this.skipEndTime);var e=parseInt(t-this.currentTime);if(t>60&&e<=10&&!this.videoWillEndFlag){this.videoWillEndFlag=!0;var i=Math.floor(e/this.playbackRate);this.vm.emit("videoWillEnd",{time:i}),this.children.playNext.onVideoWillEnd({time:i}),this.userSetting.isSkip&&this.skipEndTime>0&&this.children.tip.showBottomTip({_type:"skipEndTPL",_time:2e3})}else this.videoWillEndFlag&&(e>10||e<0)&&(this.videoWillEndFlag=!1,this.children.playNext&&this.children.playNext.cancelVideoEnd(),this.vm.emit("cancelVideoWillEnd"))}},_isShowControl:function(){this.autoHideControlsLock=!0},_isHideControl:function(){this.autoHideControlsLock=!1,this._hideItself()},_hideItself:function(t){var e=this;return!this.autoHideControlsLock&&(!this.userIsDragging&&(t=t||this.config.hideBarTime,window.clearTimeout(this.timeId),void(this.timeId=setTimeout(function(){var t=e.$wrap.offsetHeight;t=na?-8-t:-2-t,se(e.$dom,"hide"),fe(e.$wrap,{bottom:t+"px"}),e.$status&&fe(e.$status,{top:"-80px"}),e.emit("controlbarChange",{visible:!1}),(e.isWebFullScreen||e.isFullScreen)&&fe(e.__wrapper,{cursor:"none"})},t))))},_showItself:function(){window.clearTimeout(this.timeId),this.emit("controlbarChange",{visible:!0}),ae(this.$dom,"hide"),fe(this.$dom,{display:"block"}),fe(this.$wrap,{bottom:"0"}),fe(this.__wrapper,{cursor:"default"}),this.$status&&fe(this.$status,{top:"0px"})},_display:function(){var t=this.show?"block":"none";fe(this.$dom,{display:t})},_mousemove:function(t){this.adlock||(this._showItself(),this._hideItself())},_disable:function(t){this.show&&(this.disabled=t,fe(this.$wrap,"pointerEvents",t?"none":"auto"))}}};function aa(t){var e=void 0===t?{}:t,i=e.tagName,n=void 0===i?"mango-popup":i,r=e.className,o=e.name,s=void 0===o?"popup":o,a=e.html,c=e.title,h=void 0===c?"这是一个信息框":c,l=e.body,d=void 0===l?"这里是信息内容":l,f=e.offsetAttr,m=void 0===f?"left top":f,v=e.offset,g=void 0===v?"50% 50%":v,y=e.translate,_=void 0===y?"":y,w=e.width,b=e.height,E=e.level,T=e.init,R=e.inited,A=e.data,S=e.create,k=e.beforeCreate,P=e.destroy,C=e.events,D=e.computed,I=e.methods,L=void 0===I?{}:I,O=e.penetrate,M=void 0!==O&&O,$=e.operable,F=void 0===$||$,N=e.hide,V=void 0!==N&&N,H=e.opened,B=e.closed,U=e.autoFocus,W={html:a||"\n      <mg-popup-close>×</mg-popup-close>\n      "+(!1!==h?"<mg-popup-head>"+h+"</mg-popup-head>":"")+"\n      "+(!1!==d?"<mg-popup-body>"+d+"</mg-popup-body>":"")+"\n    ",closeSelector:"._close"};return{name:s,el:n,className:r,beforeCreate:function(t,e){var i=void 0===t?{}:t,n=i.events,r=i.methods;p(e)&&(p(e.events)&&x(n,e.events),p(e.methods)&&x(r,e.methods)),k&&k.apply(this,arguments)},create:function(){var t=p(this.$config)?x(W,this.$config):W;(this.$domWrap=ge(this.$dom).css("display","none")).html(t.html).delegate("mg-popup-close, "+t.closeSelector,"click",this.close),this.width(w).height(b).offset(g).translate(_),this._hide=V;for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];S&&S.apply(this,i),!this._hide&&this.open()},destroy:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];P&&P.apply(this,e),this.$domWrap.undelegate(this.$config.closeSelector,"click",this.close).remove()},level:E,init:T,inited:R,data:A,events:C,computed:D,penetrate:M,operable:F,autoFocus:U,methods:x({open:function(){if(this.destroyed)return this;this.$domWrap.css("display","block"),this._hide=!1;for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this.$emit("popupOpen",e,this),u(H)&&H.apply(this,e),this},close:function(){if(this.destroyed)return this;this.$domWrap.css("display","none"),this._hide=!0;for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this.$emit("popupClose",e,this),u(B)&&B.apply(this,e),this},width:function(t){return t&&this.$domWrap.css("width",t),this},height:function(t){return t&&this.$domWrap.css("height",t),this},offset:function(t){var e=(""+(t||"")).split(" "),i={};if(e.length>2)return["top","right","bottom","left"].forEach(function(t,n){e[n]&&(i[t]=e[n])}),this.$domWrap.css(i),this;var n=e[0],r=e[1];if(""===n)return this;var o=r||n,s=m.split(" ");i[s[0]]=n,i[s[1]]=o,this.$domWrap.css(i);var a=[];return"50%"===n&&a.push("-50%"),"50%"===o&&a.push("-50%"),a.length>0&&this.translate(a.join(" ")),this},translate:function(t){var e=(""+(t||"")).split(" "),i=e[0],n=e[1];return""!==i&&(this.$domWrap.css("transform","translate("+i+", "+(n||i)+")"),!("transform"in document.createElement("a").style)&&window.console&&window.console.warn),this}},L)}}var ca,ha=["currentTime","buffered","currentSrc","duration","error","ended","networkState","paused","readyState","seekable","sinkId","controlsList","tabIndex","dataset","offsetHeight","offsetLeft","offsetParent","offsetTop","offsetWidth"],la=/iPad/i.test(navigator.userAgent),da=function(t){function n(e){var i;return(i=t.call(this)||this).Log=$e,i.reset(),i.init(),i.__vm=e.vm,i.videoId=e.videoId,i.adContainer=e.vm.$dom,i}i(n,t);var r=n.prototype;return r.init=function(){},r.restoreVolume=function(){this._volume&&(this.__vm.volume=this._volume,this.__vm.muted=!1,this._volume=null)},r.mute=function(){this.__vm.muted=!0,this.isAdMute=!0,this._volume=this.__vm.volume,this.__vm.volume=0},r.unmute=function(){this.__vm.muted=!1,this.restoreVolume()},r.fullScreen=function(){la?this.__vm.vm.__dispatcher.dom.videoElement.webkitEnterFullscreen():this.__vm.$fullscreen(!0,"container")},r.exitFullScreen=function(){la||this.__vm.$fullscreen(!1,"container")},r.reset=function(){this._isPlayingMidAd=!1,this._isPlayingFrontAd=!0,this._videoTime=0},r.getVideoInfo=function(){return this.__vm.getVideoInfo()},r.getVideoType=function(){return this.__vm._congig.isLive?"live":"vod"},r.restoreLevel=function(){this.__vm.restoreLevel()},r.bumpToTop=function(){this.__vm.bumpToTop()},r.adFrontLoad=function(){this.__vm.onFrontAdLoad()},r.midAdStart=function(){this._videoTime=this.__vm.currentTime,this._isPlayingMidAd=!0,this.__vm.midAdStart()},r.initUrls=function(t){this.__vm.initUrls(t)},r.playNext=function(){return this.__vm.playNextAdFragment()},r.pause=function(){this.__vm.pause()},r.getVideoSize=function(){return{isFloating:this.__vm.vm.getFloatWindowMode(),height:parseInt(this.__vm.container.height),width:parseInt(this.__vm.container.width)}},r.resume=function(){this.__vm.play()},r.midAdWillBegin=function(t){void 0===t&&(t=5),this.__vm.emit("midAdWillBegin",{time:t})},r.lockUI=function(){this.__vm.emit("lockUI")},r.unlockUI=function(){$e.info("adsdk","unlock ui .... "),this.__vm.emit("unlockUI")},r.adVideoEnd=function(t){1==t?this._isPlayingFrontAd=!1:2==t&&(this._isPlayingMidAd=!1),this.__vm.onAdEnd(t)},r.loadSource=function(t){this.__vm.onLoadSource(t)},r.getVideo=function(){return this},r.getVideoProperty=function(t){return-1!==ha.indexOf(t)?this.__vm[t]:void 0},r.getVideoCurrentTime=function(){return this._isPlayingFrontAd||this._isPlayingMidAd||!this.isVideoPlaying?this._videoTime:this.__vm.currentTime},r.addListener=function(t,e,i){this.on(t,e.bind(i))},r.addEventListener=function(t,e,i){this.on(t,e.bind(i))},r.removeEventListener=function(t){this.off(t)},r.removeListener=function(t){this.off(t)},r.dispose=function(){delete this.idx,delete this.adData},e(n,[{key:"isMute",get:function(){return this.__vm.muted}},{key:"isFullScreen",get:function(){return!!this.__vm.fullscreenElement}}]),n}(te),ua="PluginAd",pa=/iPad/i.test(navigator.userAgent),fa=function(t,e,i){t&&t.emit&&t.emit(e,i)},ma=aa({tagName:"mango-plugin-ad",name:"mangoAdPlugin",html:"  ",offset:"0",hide:!1,operable:!1,level:99,data:{downcountTimer:0,blackTimer:0,videoinfo:{},isAdPlaying:!1,isAdMute:!1,isAdFullScreen:!1,playerStatus:0,isAdBlocked:!1,status:1,adFetcher:{},index:-1,atc:null,adsdk:{},videoObject:{},adData:{info:{},urls:[]}},init:function(){this.vm=this.__dispatcher.vm,window.getADObject&&(this.adsdk=window.getADObject(this.vm.config.lobparam),this.videoObject=new da({vm:this,videoId:this.vm._config.video_id}),this.adsdk.init(this.videoObject))},destroy:function(){this.adsdk&&this.adsdk.dispose&&this.adsdk.dispose(),this.videoObject&&this.videoObject.dispose(),delete this.videoObject,delete this.adsdk},events:{error:function(){fa(this.videoObject,"error")},playing:function(){fa(this.videoObject,"playing")},pause:function(){fa(this.videoObject,"pause")},resume:function(){fa(this.videoObject,"resume")},loadedmetadata:function(){fa(this.videoObject,"loadedmetadata")},ended:function(){fa(this.videoObject,"ended")},timeupdate:function(){fa(this.videoObject,"timeupdate")},c_resize:function(){fa(this.videoObject,"c_resize")},cmsData:function(t){if("loadComplete"==t.status){if(this.videoinfo=t.data,200!=this.videoinfo.user.purview&&0==this.videoinfo.info.trialtime)return;window.getADObject||this.onLoadSource(),fa(this.videoObject,"cmsData",t)}},liveSource:function(t){fa(this.videoObject,"liveSource",t)},frontAdPlay:function(){this.videoObject.isVideoPlaying=!1,$e.info(ua,"Front advertisement is playing, duration "+this.adData.duration),fa(this.videoObject,"frontAdPlay")},splashShow:function(t){fa(this.videoObject,"splashShow",t)},controlbarChange:function(t){fa(this.videoObject,"controlbarChange",t)},progressbarHover:function(t){fa(this.videoObject,"progressbarHover",t)},progressbarUpdate:function(t){fa(this.videoObject,"progressbarUpdate",t)},midAdPlay:function(){this.videoObject.isVideoPlaying=!1,$e.info(ua,"Middle advertisement is playing, duration "+this.adData.duration),fa(this.videoObject,"midAdPlay")},videoPlay:function(){this.isAdPlaying=!1,this.videoObject.isVideoPlaying=!0,fa(this.videoObject,"videoPlay")},videoDrag:function(){this.videoObject.isVideoPlaying=!0,fa(this.videoObject,"videoDrag")},videoPause:function(){this.videoObject.isVideoPlaying=!1,fa(this.videoObject,"videoPause")},videoResume:function(){this.videoObject.isVideoPlaying=!0,fa(this.videoObject,"videoResume")},videoResumeMid:function(){this.videoObject.isVideoPlaying=!0},videoEnd:function(){fa(this.videoObject,"videoEnd")},videoReload:function(){this.status=1,this.reset(),this.videoObject.reset(),clearTimeout(this.blackTimer),clearInterval(this.downcountTimer),clearTimeout(this.jumpAdTipTimer),fa(this.videoObject,"videoReload")},apiRequestError:function(t){fa(this.videoObject,"apiRequestError"),this.pause()}},methods:{restoreLevel:function(){this.$level=0},bumpToTop:function(){this.$bumpToTop()},getVideoInfo:function(){return this.vm.getVideoInfo()},playNextAdFragment:function(){var t=this;if(this.index++,this.adData.urls.length<=this.index)return!1;var e=this.adData.urls[this.index],i=this.adData.urls[this.index+1];if(pa)this.load({src:e.url,box:"native"}),this.play(),$e.warn(ua,"playing the ["+this.index+"th] ad fragment, url "+e.url);else{var n=this.vm._config.useFlash?"flash":"native",r=function(e){i&&i.url&&(t.preloadTimer&&clearTimeout(t.preloadTimer),t.preloadTimer=setTimeout(function(){t.vm.$preLoadAd(i.url,{box:n}).then(function(t){$e.warn("cms","preload next ad, source ["+i.url+"].")}).catch(function(e){fa(t.videoObject,"error",e)})},1e3*e))};0==this.index&&e&&e.url?(this.load({src:e.url,box:n}),$e.warn(ua,"playing the ["+this.index+"th] ad fragment, url "+e.url),r(e.duration-5)):this.vm.$playNextAd().then(function(){r(e.duration-5)}).catch(function(i){"no perload"===i?(t.load({src:e.url,box:n}),r(e.duration-5)):r(0)})}return 1==this.status&&0==this.index&&this.adData.urls.length>0&&(this.isAdPlaying=!0,this.emit("frontAdReady")),!0},onFrontAdLoad:function(){$e.info(ua,"Fetching front advertisement ..."),this.vm=this.__dispatcher.vm,this.lobparam=this.vm._config.lobparam||{},this.emit("frontAdBegin"),this.status=1},initUrls:function(t){if(t&&t.urls){var e=0;t.urls.forEach(function(t){t.duration&&!isNaN(t.duration)||(t.duration=0),e=t.duration+e}),t.duration=e,1==this.status?(this.index=-1,this.adData=t,$e.info(ua,"Fetch front advertisement ok, total "+(t&&t.urls.length)+" ads.")):2==this.status&&(this.index=-1,this.adData=t,$e.info(ua,"Fetch middile advertisement ok, total "+(t&&t.urls.length)+" ads."))}else $e.warn(ua,"initUrls params validate error.")},reset:function(){this.atc=null,this.adData={info:{},urls:[]},this.isAdBlocked=!1,this.index=-1,this.preloadTimer&&clearTimeout(this.preloadTimer)},midAdStart:function(){$e.info(ua,"Middle advertisement begin."),this.status=2,this.emit("midAdBegin",{time:this.currentTime})},onAdEnd:function(t){this.isAdPlaying=!1,1==t?this.isAdBlocked||($e.info(ua,"Front Advertisement ended, status [normal]."),this.emit("frontAdEnd",{duration:this.adData.duration||0,total:this.adData.urls.length,atc:this.atc,adStatus:"normal"}),this.videoObject.restoreVolume(),this.status=2):2==t&&($e.info(ua,"Middle Advertisement ended."),this.emit("midAdEnd"),this.videoObject.restoreVolume())},onLoadSource:function(t){var e,i=this;if(t)$e.info(ua,"Advertisement is about to end, prefetch video source is allowed."),this.atc=t,this.emit("videoPrefetch",{atc:this.atc,adStatus:"normal"});else{this.isAdBlocked=!0;var n=~~gt("blt",(e=this.videoinfo.atc.tk2,atob(e.split("").reverse().join("").replace(/-/g,"=").replace(/~/g,"/").replace(/_/g,"+"))).replace(/\|/g,"&"));$e.info(ua,"Advertisement was blocked, punish black screen for ["+n+"] seconds."),n>=0&&(this.emit("adBlockException",{type:"front",url:"",blacktime:n}),this.blackTimer=setTimeout(function(){i.emit("frontAdEnd",{adStatus:"abnormal",atc:i.videoinfo.atc}),$e.info(ua,"Black screen punishment ended. trying to fetch video source..."),i.status=2},1e3*n))}}}}),va=function(){function t(t,e){this.create(t.pDom),this.thread=t.thread,this.renderTime=t.renderTime,this.timer=null,this.pDom=t.pDom,this.fontSize=e.fontSize,this.lineHeight=e.lineHeight}var e=t.prototype;return e.create=function(t){var e=document.createElement("canvas");e.className="c-player-danmu-main",t.appendChild(e),this.layer=e,this.width=this.layer.width=t.offsetWidth,this.height=this.layer.height=t.offsetHeight,this.context=this.layer.getContext("2d")},e.destroy=function(){lt.call(window,this.timer),this.layer.parentNode.removeChild(this.layer)},e.createPiece=function(t){var e=document.createElement("canvas"),i=e.getContext("2d"),n="small"===t.fontSize?.6:1,r=Math.floor(n*this.fontSize)+"px",o=t.fontFamily||"serif";return i.font=r+" "+o,e.width=i.measureText(t.text).width,e.height=this.lineHeight,i.font=r+" "+o,i.textAlign="left",i.textBaseline="top",i.fillStyle=t.color||"#ffffff",i.fillText(t.text,0,0),e},e.start=function(){this.render()},e.pause=function(){lt.call(window,this.timer)},e.draw=function(t){this.context.drawImage(t.piece,t.offset.x,t.offset.y,t.piece.width,t.piece.height)},e.resize=function(){this.width=this.layer.width=this.pDom.offsetWidth,this.height=this.layer.height=this.pDom.offsetHeight,this.render(),this.pause()},e.render=function(){var t=this;this.clear(),this.thread.pool.forEach(function(e,i){if(t.draw(e),"flow"===e.mode)e.offset.x-=e.speed,e.offset.x<-e.piece.width&&t.thread.remove(i);else{var n=new Date,r=e.row;e.startTime=e.startTime||new Date,n-e.startTime>5e3&&(t.thread.remove(i),t.thread.vRows[r].shift())}}),this.timer=ht.call(window,function(){t.render()})},e.clear=function(){this.context.clearRect(0,0,this.layer.width,this.layer.height)},t}(),ga=function(){function t(t,e){this.pool=[],this.pDom=t,this.config=e,this.resize()}var e=t.prototype;return e.resize=function(){this.rows=Math.floor(this.pDom.offsetHeight/this.config.lineHeight),this.rows>0&&this.rows<=3&&(this.rows=3),this.rows>18&&(this.rows=18),this.rows<=0||(this.vRows=a(new Array(this.rows),this.vRows))},e.get=function(t){return this.pool[t]},e.push=function(t){this.pool.push(t)},e.remove=function(t){this.pool.splice(t,1)},e.empty=function(){this.pool=[],this.rows<=0||(this.vRows=new Array(this.rows))},e.changeSpeedFactor=function(t,e){this.pool.forEach(function(i){i.speed=i.speed*e/t})},t}(),ya=(r((ca=function(){function t(t,e){this.create(t.pDom),this.thread=t.thread,this.renderTime=t.renderTime,this.timer=null,this.pDom=t.pDom,this.fontSize=e.fontSize,this.lineHeight=e.lineHeight}var e=t.prototype;return e.create=function(t){var e=document.createElement("div");e.className="c-player-danmu-wrapper",t.appendChild(e),this.layer=e,this.width=t.offsetWidth,this.height=t.offsetHeight},e.destroy=function(){lt.call(window,this.timer),this.layer.parentNode.removeChild(this.layer)},e.createPiece=function(t){var e=document.createElement("div"),i='<span class="txt">'+t.content+"</span>",n=t.avatar||"https://img.mgtv.com/imgotv-member/user/avt.jpg",r="danmu-txt ",o=t.bg?t.bg:"";return 2==t.type&&(r="danmu-txt danmu-2 bgcol-"+o,i='<span class="pic"><img src="'+n+'"></span><span class="txt"><svg class="icon dmarr"><use xlink:href="#dmarr"></use></svg>'+t.uname+"："+t.content+"</span>"),1==t.type&&o&&o>=3&&o&&o<=5?r="danmu-txt danmu-3 bgcol-"+o:1==t.type&&(r="danmu-txt danmu-1"),fe(e,{position:"absolute",top:"-100px",left:"0"}),e.className=r,e.innerHTML=i,this.layer.appendChild(e),e.width=e.offsetWidth,e.height=this.lineHeight,e},e.start=function(){this.timer&&lt.call(window,this.timer),this.render()},e.pause=function(){lt.call(window,this.timer)},e.resize=function(){this.width=this.pDom.offsetWidth,this.height=this.pDom.offsetHeight},e.render=function(){var t=this;this.thread.pool.forEach(function(e,i){var n="translate3d("+e.offset.x+"px, "+e.offset.y+"px , 0) ";if(fe(e.piece,{top:0,transform:n,"-webkit-transform":n,"-o-transform":n}),"flow"===e.mode)e.offset.x-=e.speed,(e.offset.x<-e.piece.width||e.row>=t.thread.rows)&&(e.piece.parentNode.removeChild(e.piece),t.thread.remove(i));else{var r=new Date,o=e.row;e.startTime=e.startTime||new Date,r-e.startTime>5e3&&(e.piece.parentNode.removeChild(e.piece),t.thread.remove(i),t.thread.vRows[o].shift())}}),this.timer=ht.call(window,this.render)},e.clear=function(){this.layer.innerHTML=""},t}()).prototype,"render",[_i],s(ca.prototype,"render"),ca.prototype),ca),_a={debug:!1,apiEndpoint:"//galaxy.bz.mgtv.com",maxTimeout:1e4,minimalStageHeight:360,renderInterval:1e3,cacheSize:1e4,preRenderTime:5e3,timeTolerance:1e3,backTimeTorrence:5e3,maxArtistCacheSize:20,stageWidths:[360,860,1340],fontSize:20,gap:80,padding:36,paddingBottom:50,lineHeight:40,mode:"css",updateByVideo:!0,datamode:"batch",minScrollSpeed:1.8,maxScrollSpeed:2,speedFactor:1},wa=0,ba=function(){function t(t,e){this.plugin=t,this.pDom=t.$dom,this.config=e,this.danmuCache=[],this.artistDanmuCache=[],this.thread=new ga(t.$dom,e),this.changeMode(e.mode||"css"),this.changeSpeedFactor(e.speedFactor||_a.speedFactor),this.lineHeight=e.lineHeight,this.timer=null}var e=t.prototype;return e.start=function(){this.paper.start()},e.pause=function(){this.paper.pause()},e.clear=function(){this.danmuCache=[],this.artistDanmuCache=[],this.thread.empty(),this.paper&&this.paper.clear()},e.destroy=function(){this.paper.destroy()},e.resize=function(){this.paper.resize(),this.thread.resize()},e.changeMode=function(t){t&&t!==this.mode&&(this.thread.empty(),this.paper&&this.destroy(),this.paper="canvas"===t?new va(this,this.config):new ya(this,this.config),!this.plugin.paused&&this.paper.start(),this.mode=t)},e.changeSpeedFactor=function(t){var e=this.config.speedFactor;this.thread.changeSpeedFactor(e,t),this.config.speedFactor=t},e.changeDisplayRatio=function(t){this.paper.resize(),this.thread.resize()},e._line=function(t){var e=this.thread.pool,i=(e.length,new Array(this.thread.rows)),n=this.config.speedFactor||_a.speedFactor;e.forEach(function(t){if(!(t.row>i)&&"flow"===t.mode){var e=t.row;i[e]=t.offset.x+t.piece.width}});for(var r=-1,o=1e7,s=0;s<i.length;s++){if(!i[s]){r=s,o=this.paper.width;break}var a=Math.max(this.paper.width,i[s]+t),c=Math.min(2*n*this.paper.width,1.5*window.screen.width);a<(c=Math.max(c,2*this.paper.width))&&o>a&&(o=Math.max(this.paper.width,i[s]+_a.gap),r=s)}return{row:r,minX:o}},e._vLine=function(t){var e=this.thread.vRows,i=e.length,n=0;return n=e.every(function(t,i){return Array.isArray(e[0])&&t.length===e[0].length})?"top"===t.mode?0:i-1:this._cLine(e,t),e[n]=e[n]?e[n].concat(t):[t],{row:n}},e._cLine=function(t,e){for(var i=t.length,n=[],r=0;r<i;r++){var o=0===r?i-1:r-1,s=r===i-1?0:r+1,a=Array.isArray(t[o])?t[o].length:0,c=Array.isArray(t[s])?t[s].length:0,h=Array.isArray(t[r])?t[r].length:0;(!h||h<a||h<c)&&n.push(r)}return"top"===e.node?n[0]:n[n.length-1]},e.push=function(t){2==t.type?this.artistDanmuCache.push(t):this.danmuCache.length<100&&this.danmuCache.push(t)},e.pulse=function(t){var e=this;this.config.debug&&$e.log("danmuPlugin","total danmu cache length: "+this.danmuCache.length),this.danmuCache=this.danmuCache.filter(function(i){var n=i.time-t,r=_a.preRenderTime,o=0<n&&n<r;return e.config.debug&&!o&&$e.log("danmuPlugin","drop danmu item: "+i.content+" "+ut(i.time/1e3)+" from cache"),o}),this.config.debug&&$e.log("danmuPlugin","danmu cache length after filtered ："+this.danmuCache.length);for(var i=this.artistDanmuCache.length,n=0;n<i;n++){var r=this.artistDanmuCache.shift();if(!this.emit(r)){this.artistDanmuCache.unshift(r);break}}for(var o=this.danmuCache.length,s=0;s<o;s++){var a=this.danmuCache.shift();if(!this.emit(a)){this.danmuCache.unshift(a);break}this.config.debug&&$e.log("danmuPlugin","show danmu item: "+a.content+" "+ut(a.time/1e3)+"from cache")}},e.emit=function(t){if("close"!==this.status){var e={};"string"==typeof t?e.content=t:e=t;(t=x({},e)).mode=t.mode||"flow";var i=_a.padding+t.content.length*_a.fontSize,n="flow"===t.mode?this._line(i):this._vLine(t),r=n.row,o=n.minX;if(r<0)return!1;this.config.debug&&(t.content=t.content+ut(t.time/1e3));var s=this.paper.createPiece(t),a=(this.config.speedFactor||_a.speedFactor)*(r%2==0?_a.maxScrollSpeed:_a.minScrollSpeed);return wa++,this.thread.pool.push({id:wa,piece:s,text:t.content,content:t.content,type:t.type,avatar:t.avatar,bg:t.bg,uname:t.uname,mode:t.mode,speed:a,row:r,offset:{x:"flow"===t.mode?o:(this.paper.width-s.width)/2,y:this.lineHeight*r}}),!0}},e.getPieceByPoint=function(t,e){var i=[];return this.thread.pool.map(function(n){var r=[n.offset.x,n.offset.y],o=[n.offset.x+n.piece.width,n.offset.y+n.piece.width];t>=r[0]&&t<=o[0]&&e>=r[1]&&e<=o[1]&&i.push(n)}),i},t}(),Ea=function(t){return c(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")},Ta={name:"mangoDanmu",el:"mango-danmu",data:{version:"2.0.0",sysConfig:!1,status:"close",displayRatio:1,speedFactor:1,videoinfo:{video_id:4247448,playlist_id:"",collection_id:313552},config:{},interval:6e4,cache:[],count:0,_currentTime:0,lastCurrentTime:0,fetchLock:!0,videoPlayed:!1,danmu:{},danmuList:[],currentPostion:0,currentPiece:{}},operable:!1,penetrate:!0,level:2,create:function(){},init:function(t){if(!t||!1!==t.danmu){var e=p(this.$config)?x(_a,this.$config):_a;this.vm=this.__dispatcher.vm,this.danmu=new ba(this,e),ue(document,"visibilitychange",this.onVisibilityChange),ue(document,"webkitvisibilitychange",this.onVisibilityChange),this.updateByVideo=e.updateByVideo,this.datamode=e.datamode}},inited:function(){!this.updateByVideo&&this.danmu.start()},destroy:function(){this.danmu.destroy(),this.$dom.parentNode.removeChild(this.$dom),de(document,"visibilitychange",this.onVisibilityChange),de(document,"webkitvisibilitychange",this.onVisibilityChange)},events:{videoPlay:function(){this.updateByVideo&&("open"===this.status&&this.danmu.start(),this.fetchLock=!1,this.videoPlayed=!0,this.getSwitch(),this.checkVideoWith())},videoResume:function(){this.updateByVideo&&("open"===this.status&&this.danmu.start(),this.fetchLock=!1,this.checkVideoWith())},videoPause:function(){this.updateByVideo&&("open"===this.status&&this.danmu.pause(),this.fetchLock=!0)},videoReload:function(){this.danmu.clear(),this.cache=[],this.count=0,this.lastCurrentTime=0,this.fetchLock=!0,this.videoPlayed=!1},videoReplay:function(){this.lastCurrentTime=0,"open"===this.status&&this.danmu.start()},videoRefresh:function(){this.lastCurrentTime=0,"open"===this.status&&this.danmu.start()},midAdBegin:function(){this.danmu.clear(),this.danmu.pause(),this.cache=[],this.fetchLock=!0},midAdEnd:function(){"open"===this.status&&this.danmu.start(),this.fetchLock=!1},seek:function(){this.danmu.clear(),this._currentTime=1e3*this.currentTime+_a.preRenderTime*this.playbackRate,this.lastCurrentTime=0,this.cache.forEach(function(t){t.forEach(function(t){t._sent=!1})})},timeupdate:function(){var t=this;if(this.sysConfig&&"close"!==this.status){if("batch"==this.datamode){var e=(this.vm._config.useFlash?1:this.playbackRate)*_a.preRenderTime;this._currentTime=1e3*this.currentTime+e;var i=Math.floor(this._currentTime/this.interval);if(this.cache[i]||this._fetchDanmu(this._currentTime),this._currentTime-this.lastCurrentTime>_a.renderInterval&&this.cache[i])this.cache[i].filter(function(e){var i=Math.abs(e.time-t._currentTime)<_a.timeTolerance&&!e._sent;return _a.debug&&!i&&e.time<t._currentTime&&!e.droped&&!e._sent&&(e.droped=!0,$e.log("danmuPlugin","drop item: "+e.content)),i}).forEach(function(e){e._sent=!0,t.danmu.push(e)}),this.lastCurrentTime=this._currentTime}else for((Math.abs(this.currentTime-this.currentPiece.time)>1||void 0===this.currentPiece.time)&&this._searchPosition();this.currentTime>=this.currentPiece.time&&this.currentPiece.time;)this.danmu.push(this.currentPiece),this.currentPiece=this.danmuList[this.currentPostion++]||{};this.count++,this.count%20==0&&(this.count=0,this.danmu.pulse(1e3*this.currentTime))}},contextmenu:function(t){t.preventDefault();var e=this.danmu.getPieceByPoint(t.offsetX,t.offsetY);this.$emit("danmuContextmenu",e)},cmsData:function(t){"loadComplete"==t.status&&(this.videoinfo=t.data.info)},c_resize:function(t){this.videoPlayed&&(parseInt(this.container.height)<=_a.minimalStageHeight||this.vm.getFloatWindowMode()?(this.danmu.clear(),this.danmu.pause(),this.cache=[],this.fetchLock=!0):(this.fetchLock=!1,this._resize(),"open"!=this.status||this.paused||this.danmu.start()))},fullscreenchange:function(){this._resize()},danmuStatusChange:function(t){void 0!==t.state&&null!==t.state&&(t.state?this.open():this.close()),this.validate(t.ratio,.25,1)&&this.setDisplayRatio(t.ratio),this.validate(t.opacity,.1,1)&&this.setDisplayOpacity(t.opacity),this.validate(t.speed,.5,2)&&this.setDisplaySpeed(t.speed)}},methods:{validate:function(t,e,i){return m(t)&&t>=e&&t<=i},checkVideoWith:function(){(parseInt(this.container.height)<=_a.minimalStageHeight||this.vm.getFloatWindowMode())&&(this.fetchLock=!0)},getSwitch:function(){var t=this;return Te(_a.apiEndpoint+"/getctlbarrage?"+Ea({version:this.version,vid:this.videoinfo.video_id,abroad:0,pid:this.videoinfo.playlist_id,os:"",uuid:"",deviceid:"",cid:this.videoinfo.collection_id,ticket:"",mac:"",platform:0}),{timeout:_a.maxTimeout}).then(function(t){return t.json()}).then(function(e){if(e&&0==e.status&&e.data){t.config=e.data;var i=Se.get("mango-danmu-speed")||1,n=Se.get("mango-danmu-ratio")||.5,r=Se.get("mango-danmu-opacity")||.9,o=Se.get("mango-danmu-switch"),s=0;.6==n&&(n=.5,Se.get("mango-danmu-ratio",.5)),t.config.switcher&&(s=t.config.render?1:0),null===o&&(o=s),t.emit("danmuConfig",a({},t.config,{userConfig:o})),t.vm.toggleDanmuInput(t.config.switcher,o,n,r,i),t.emit("danmuStatusChange",{state:o,ratio:n,opacity:r,speed:i}),Se.set("mango-danmu-switch",o),t.config.switcher&&o?(t.sysConfig=!0,t.status="open"):(t.sysConfig=!1,t.status="close",t.fetchLock=!0,t.danmu.clear(),t.pause())}}).catch(function(t){$e.warn("pluginDanmu","get getctlbarrage fail: "+t)})},_fetchDanmu:function(t){var e=this;if(!this.fetchLock)return Te(_a.apiEndpoint+"/rdbarrage?"+Ea({version:this.version,vid:this.videoinfo.video_id,abroad:0,pid:this.videoinfo.playlist_id,os:"",uuid:"",deviceid:"",cid:this.videoinfo.collection_id,ticket:"",time:parseInt(t),mac:"",platform:0}),{timeout:_a.maxTimeout}).then(function(t){return t.json()}).then(function(t){if(t&&0==t.status&&t.data){e.interval=1e3*t.data.interval;var i=t.data.next-e.interval/2,n=Math.floor(i/e.interval);e.cache[n]=t.data.items||[]}}).catch(function(t){})},_searchPosition:function(){var t=this.danmuList.length;if(0!==t){if(this.currentTime>this.danmuList[t-1].time)return this.currentPiece={},void(this.currentPostion=t+1);if(this.currentTime<this.danmuList[0].time)return this.currentPiece=this.danmuList[0],void(this.currentPostion=0);for(var e=0;e<t;e++){var i=this.danmuList[e];if(i.time>=this.currentTime){this.currentPostion=e,this.currentPiece=i;break}}}},setDisplayRatio:function(t,e){.6==t&&(t=.5),(t!=this.displayRatio||e)&&(Se.set("mango-danmu-ratio",t),this.displayRatio=t,this._resize(t))},setDisplayOpacity:function(t){fe(this.$dom,{opacity:t}),Se.set("mango-danmu-opacity",t)},setDisplaySpeed:function(t){t!=this.speedFactor&&(this.speedFactor=t,this.danmu.changeSpeedFactor(t),Se.set("mango-danmu-speed",t))},open:function(){this.status="open",this.danmu.start(),Se.set("mango-danmu-switch",1)},close:function(){this.status="close",this.danmu.clear(),this.danmu.pause(),Se.set("mango-danmu-switch",0)},start:function(){this.danmu.start()},pause:function(){this.danmu.pause()},changeMode:function(t){this.danmu.changeMode(t)},sendMsg:function(t){"open"===this.status&&this.danmu.emit(t)},receiveData:function(t){this.danmuList=t,this.currentPiece=this.danmuList[this.currentPostion++]||{}},_resize:function(t){t=t||this.displayRatio;var e=this.vm.__dispatcher.dom.container.clientHeight,i=_a.paddingBottom,n=Math.max(e*(1-t),i);fe(this.$dom,{marginBottom:n+"px"}),this.danmu.resize()},onVisibilityChange:function(){this.danmu.clear()}}},Ra=aa({tagName:"mango-menu",name:"mangoContextmenu",html:'<mango-menu-list class="mango-menu-list"></mango-menu-list>',offset:"0",hide:!0,data:{baseMenus:[]},init:function(){this.vm=this.__dispatcher.vm,this.refreshMenu()},create:function(){var t=this,e=this.$config,i=e.baseMenus,n=e.menus;d(i)&&(this.baseMenus=i),this.updatemenu(n),this.$domWrap.on("click",this.clickHandler),this.$domWrap.on("contextmenu",function(t){return t.preventDefault()}),this._doc=new this.$domWrap.constructor(document),this._doc_click=function(e){2!=e.button&&(t.emit("contextmenuClose"),t.close())},this._doc.on("click",this._doc_click)},destroy:function(){this._doc.off("click",this._doc_click)},opened:function(){this.$bumpToTop()},events:{c_contextmenu:function(t){var e=t.offsetX,i=t.offsetY;this.open(t);var n=this.$dom.offsetWidth,r=this.$dom.offsetHeight,o=this.$dom.parentElement;o.parentElement;if(u(o.getBoundingClientRect)){var s=o.getBoundingClientRect();s.right-t.clientX<n&&(e=s.right-s.left-n),s.bottom-t.clientY<r&&(i=s.bottom-s.top-r)}this.offset(e+"px "+i+"px"),t.preventDefault()},switchToFlash:function(){this.updateKernelMenu("flash")},switchToHtml5:function(){this.updateKernelMenu("html5")},videoReady:function(){this.refreshMenu()}},methods:{refreshMenu:function(){var t=this.vm.box;"flash"==t?this.updateKernelMenu("flash"):"dash"==t?this.updateKernelMenu("dash"):this.updateKernelMenu("html5")},copyPlayerAddress:function(){yt("https://www.mgtv.com/s/"+this.vm._config.video_id+".html")},copyLivePlayerAddress:function(){yt(window.location.href)},copyCurrentPlayerAddress:function(){yt("https://www.mgtv.com/s/"+this.vm._config.video_id+".html?start_time="+this.currentTime)},updateKernelMenu:function(t){"dash"==t?(this.$domWrap.find('[data-action="switchToHtml5"]').css("display","none"),this.$domWrap.find('[data-action="switchToFlash"]').css("display","none")):"flash"==t?(this.$domWrap.find('[data-action="switchToHtml5"]').css("display",""),this.$domWrap.find('[data-action="switchToFlash"]').css("display","none")):(this.$domWrap.find('[data-action="switchToHtml5"]').css("display","none"),this.$domWrap.find('[data-action="switchToFlash"]').css("display",""))},updatemenu:function(t){var e=this,i=[];d(t)&&(i=i.concat(t));var n=i.concat(this.baseMenus).map(function(t){var i=t.hide,n=t.disable,r=t.action,o=t.className,s=t.text,a=t.url,c=n?"disable":"",h=r?'data-action="'+r+'"':"",l=o?'class="'+o+'"':"",d=i?'style="display:none"':"",u=s.replace(/\{([^)]*)\}/g,function(t,i){return e[i]});return a&&(u='<a href="'+a+'" target="_blank">'+u+"</a>"),"<mango-menu-item "+c+" "+h+" "+l+" "+d+">"+u+"</mango-menu-item>"}).join("");this.$domWrap.find("mango-menu-list").html(n)},clickHandler:function(t){var e=t.target;if(!e.disable){var i=e.dataset.action;i&&(this.$emit(i),u(this[i])&&this[i](t)),this.emit("contextmenuClose"),this.close()}t.stopPropagation()}}}),Aa=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],Sa=function(t,e){var i=t;return"string"==typeof e?i=t.toLocaleString(e):!0===e&&(i=t.toLocaleString()),i},ka=function(t,e){if(!Number.isFinite(t))throw new TypeError("Expected a finite number, got "+typeof t+": "+t);if((e=a({},e)).signed&&0===t)return" 0 B";var i=t<0,n=i?"-":e.signed?"+":"";if(i&&(t=-t),t<1)return n+Sa(t,e.locale)+" B";var r=Math.min(Math.floor(Math.log10(t)/3),Aa.length-1);return t=Number((t/Math.pow(1e3,r)).toPrecision(3)),n+Sa(t,e.locale)+" "+Aa[r]},Pa=aa({tagName:"mango-debug",name:"mangoDebugPanel",html:'<mgdiv class="mango-debug-inner"></mgdiv>',offset:"0",hide:!0,operable:!1,data:{},init:function(){var t=this;this.vm=this.__dispatcher.vm,this.$videoWrapper=this.__dispatcher.dom.wrapper;var e=[{title:"VID",prop:"videoId",cls:"",val:function(){return t.vm._config.video_id}},{title:"播放模式",prop:"playMode",cls:"",val:function(){return t.vm.box}},{title:"分辨率",prop:"resolution",cls:"",val:function(){return window.screen.width+" x "+window.screen.height}},{title:"视频宽高",prop:"videoSize",cls:"",val:function(){var e=t.vm.metadata;return e?e.width+" x "+e.height:""}},{title:"音量",prop:"volume",cls:"",val:function(){return parseInt(100*t.volume)+"%"}},{title:"视频协议",prop:"protocol",cls:"",val:function(){return t.vm._config.useFlash?"http":"https"}},{title:"CDN",prop:"cdn",cls:"",val:function(){return t.vm.cms?t.vm.cms.getCurrentCDN():""}},{title:"下载速度",prop:"downloadSpeed",cls:"",val:function(){return ka(1024*t.vm.downloadSpeed||0)+"/s"}},{title:"缓冲时长",prop:"buffer",cls:"",val:function(){var e=t.vm.bufferInfo;return e?parseInt(e.len)+"s":"0s"}},{title:"P2P",prop:"p2p",cls:"",val:function(){var e=t.vm.stats||{},i=e.total,n=(e.http,e.upload),r=e.p2p,o=e.p2pRatio;if(!i)return"N/A";var s=+(100*o).toFixed(3)+"%";return pt("&#x2193;{{p2p}} &#x2191;{{upload}} &#x2301; {{scale}}",{p2p:r=ka(r),upload:n=ka(n),scale:s})}},{title:"FPS",prop:"fps",cls:"",val:function(){return t.vm.fps?t.vm.fps.toFixed(2):""}},{title:"版本号",prop:"version",cls:"",val:function(){return t.vm.version}},{title:"播放流水",prop:"suuid",cls:"",val:function(){return t.vm._config.lobparam.suuid}},{title:"drm",prop:"drm",cls:"",val:function(){return t.vm.drm||""}}];this._items=e,this._cfg=e.reduce(function(t,e){return t[e.prop]=e,t},{})},create:function(){this.$domWrap.on("click",this.clickHandler)},destroy:function(){this.togglePanel(!1),this.$domWrap.off("click",this.clickHandler)},events:{videoReload:function(){this.closeDebugPanel()},showDebugPanel:function(){this._timer||(this.render(),this.togglePanel())},c_resize:function(t){(parseInt(this.container.height)<400||this.vm.getFloatWindowMode())&&this.closeDebugPanel()}},methods:{togglePanel:function(t){var e=this;if(void 0===t&&(t=!0),this._timer&&(clearTimeout(this._timer),this._timer=null),t){var i=function(){e._timer=setTimeout(function(){e.updateMenu(),i()},200)};this.open(),this.$bumpToTop(),i()}else this.close(),this.$level=0},updateMenu:function(t){var e=this;void 0===t&&(t=["videoSize","volume","downloadSpeed","fps","buffer","p2p"]),t.map(function(t){var i=e.getCustomHTML(t),n=e._getval(t);e.$domWrap.find('[data-role="'+t+'"]').find(".mango-debug-value").html(i+n)})},_getval:function(t){var e=this._cfg[t].val;return"function"==typeof e?e():e},getCustomHTML:function(t){var e="";"buffer"==t&&(e='<mgdiv class="mango-debug-progress">\n                  <mgdiv class="mango-debug-progress-indicator" style="width: '+(100*wt(this,"vm.bufferInfo.len",0)/60+"%")+';"></mgdiv>\n                </mgdiv>');if("downloadSpeed"==t){var i=this.vm.downloadSpeed;e='<mgdiv class="mango-debug-progress">\n                  <mgdiv class="mango-debug-progress-indicator" style="background-color:#ff6f00;width: '+(100*Math.min(i/5120,1)+"%")+';"></mgdiv>\n                </mgdiv>'}return e},render:function(){var t=this,e=this._items.map(function(e){var i=e.action,n=void 0===i?"":i,r=e.cls,o=void 0===r?"":r,s=e.title,a=void 0===s?"":s,c=e.prop,h=void 0===c?"":c;return'\n              <mgdiv class="mango-debug-line '+o+'" data-role="'+h+'"\n                    data-action="'+n+'" >\n                <mgdiv class="mango-debug-label">'+a+':</mgdiv>\n                <mgdiv class="mango-debug-value">'+t.getCustomHTML(h)+t._getval(h)+"</mgdiv>\n              </mgdiv>\n              "}).join("");this.$domWrap.find(".mango-debug-inner").html('<mgdiv class="mango-debug-copy" title="复制" data-action="copyDebugLog"><svg version="1.1" id="i_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 14 14" style="enable-background:new 0 0 14 14;" xml:space="preserve"><g><path d="M13,2.938C13,1.318,11.718,0,10.143,0H3.857C2.282,0,1,1.318,1,2.938v8.125C1,12.683,2.282,14,3.857,14h4.432 c0.048,0,0.095-0.011,0.143-0.014C8.455,13.99,8.476,14,8.5,14c0.069,0,0.134-0.014,0.193-0.039 c0.565-0.084,1.089-0.333,1.502-0.739l2.011-1.98c0.433-0.426,0.695-0.994,0.764-1.592C12.985,9.602,13,9.553,13,9.5 c0-0.018-0.008-0.032-0.01-0.049C12.991,9.418,13,9.386,13,9.353V2.938z M2,11.063V2.938C2,1.869,2.833,1,3.857,1h6.286 C11.167,1,12,1.869,12,2.938V9H9.7C8.763,9,8,9.763,8,10.7V13H3.857C2.833,13,2,12.131,2,11.063z M9.494,12.509 C9.351,12.649,9.182,12.758,9,12.841V10.7C9,10.314,9.314,10,9.7,10h2.164c-0.084,0.196-0.205,0.377-0.359,0.528L9.494,12.509z"/> <path d="M4,5h5c0.276,0,0.5-0.224,0.5-0.5S9.276,4,9,4H4C3.724,4,3.5,4.224,3.5,4.5S3.724,5,4,5z"/><path d="M6,7H4C3.724,7,3.5,7.224,3.5,7.5S3.724,8,4,8h2c0.276,0,0.5-0.224,0.5-0.5S6.276,7,6,7z"/></g></svg></mgdiv><mgdiv class="mango-debug-close" title="关闭" data-action="closeDebugPanel"><svg version="1.1" id="i_2" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="-3 -3 20 20" style="enable-background:new 0 0 14 14;" xml:space="preserve"><path d="M7.707,7l6.146-6.146c0.195-0.195,0.195-0.512,0-0.707s-0.512-0.195-0.707,0L7,6.293L0.854,0.146 c-0.195-0.195-0.512-0.195-0.707,0s-0.195,0.512,0,0.707L6.293,7l-6.146,6.146c-0.195,0.195-0.195,0.512,0,0.707 C0.244,13.951,0.372,14,0.5,14s0.256-0.049,0.354-0.146L7,7.707l6.146,6.146C13.244,13.951,13.372,14,13.5,14 s0.256-0.049,0.354-0.146c0.195-0.195,0.195-0.512,0-0.707L7.707,7z"/></svg></mgdiv> '+e)},copyDebugLog:function(t){var e=[];$e.info("pluginDebug","user click [copyDebugLog] btn.");try{for(var i=window.sessionStorage,n=0,r=i.length;n<r;n++){var o=i.key(n);-1!=o.indexOf("vplayer-log-")&&e.push({index:o.replace(/vplayer-log-/g,""),log:i.getItem(o)})}e=(e=e.sort(function(t,e){return t-e})).map(function(t){return t.log})}catch(t){}yt(e=e.join("####"))},closeDebugPanel:function(t){this.togglePanel(!1)},clickHandler:function(t){var e=t.target.dataset.action;u(this[e])&&this[e](t),t.stopPropagation()}}}),Ca=function(){function t(t){this.parent=t}var e=t.prototype;return e.create=function(){this.createEl(),this.addAllEvent()},e.destroy=function(){this.removeAllEvent()},e.createEl=function(){this.$dom=document.createElement(this.option.tag),this.option.cls&&(this.$dom.className=this.option.cls),this.$domWrap=ge(this.$dom),this.$dom.innerHTML=this.option.html,this.parent.$dom.appendChild(this.$dom)},e.addAllEvent=function(){var t=this;this.option.defaultEvent&&c(this.option.defaultEvent).forEach(function(e){var i=t.option.defaultEvent[e];t[i]=L(t[i],t),ue(t.$dom,e,t[i],!1,!1)}),this.option.event&&c(this.option.event).forEach(function(e){var i="__"+e;t[i]=L(t.option.event[e],t),ue(t.$dom,e,t[i],!1,!1)})},e.removeAllEvent=function(){var t=this;this.option.defaultEvent&&c(this.option.defaultEvent).forEach(function(e){var i=t.option.defaultEvent[e];t[i]=L(t[i],t),de(t.$dom,e,t[i],!1,!1)}),this.option.event&&c(this.option.event).forEach(function(e){var i="__"+e;t[i]=L(t.option.event[e],t),de(t.$dom,e,t[i],!1,!1)})},t}(),Da={tag:"mango-center-state-splash",html:'\n    <div class="splash-wrapper">\n        <div class="splash-inner">\n            <div class="loading-ico"></div>\n        </div>\n    </div>\n    ',defaultEvent:{click:"click"}},xa=function(t){function e(e,i){var n;return(n=t.call(this,e)||this).option=x(Da,p(i)?i:{}),n.animate=!1,n.init(),n}i(e,t);var n=e.prototype;return n.init=function(){t.prototype.create.call(this),this.$dom=ge(this.$dom),this.parent.emit("splashShow",{show:!0})},n.show=function(t){var e=!1===t?"none":"block";this.$domWrap.css("display",e),this.parent.emit("splashShow",{show:t})},n.click=function(t){},e}(Ca),Ia={tag:"mango-center-state-start",html:'\n    <div class="c-player-client-pad">\n        <a href="#" class="u-install" action="onClickInstallApp" data-pos="6">安装芒果TV，享3倍流畅度</a>\n        <a href="javascript:;" class="u-play" action="play">播放</a>\n    </div>\n    <div class="alert-loading-play" action="play">\n        <div class="round" action="play">\n            <span class="arr">\n            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 34 34" class="iconsvg">\n<path d="M28.26,11.961L11.035,0.813C7.464-1.498,3,1.391,3,6.013v21.974c0,4.622,4.464,7.511,8.035,5.2L28.26,22.039\n\tC31.913,19.675,31.913,14.325,28.26,11.961z"/>\n</svg>\n            </span>\n        </div>\n    </div>\n    ',defaultEvent:{click:"click",touchstart:"click"}},La=function(t){function e(e,i){var n;return(n=t.call(this,e)||this).option=x(Ia,p(i)?i:{}),n.animate=!1,n.init(),n}i(e,t);var n=e.prototype;return n.init=function(){t.prototype.create.call(this),this.$domWrap=ge(this.$dom)},n.show=function(t){if(this.isAd=t,this.$domWrap.show(),this.parent.videoinfo){var e=this.parent.videoinfo.info||{},i="https://msite.api.mgtv.com/ipad-download.html?from=pcweb&start_time=0&clipId="+e.collection_id+"&plId="+e.playlist_id+"&videoId="+e.video_id+"&type=1&pos=pc6";this.$domWrap.find(".u-install").attr("href",i)}this.parent.$bumpToTop()},n.close=function(){this.$domWrap.hide(),this.parent.$level=0},n.play=function(t){t.preventDefault(),this.close(),this.parent.play(),this.parent.vm.manualClickPlay=!0,document.getElementsByTagName("video")[0].play(),this.parent.emit("manualClickPlay")},n.onClickInstallApp=function(t){var e=t.target.dataset.pos,i=this.parent.videoinfo.info;this.parent.emit("installAppClick",{pos:e,vinfo:i})},n.click=function(t){var e=t.target.getAttribute("action");u(this[e])&&this[e](t),t.stopPropagation()},e}(Ca),Oa={tag:"mango-center-state-loading",html:'\n    <div class="loading-inner">\n        <div class="loading-icon"></div>\n    </div>\n    ',defaultEvent:{click:"click"}},Ma=function(t){function e(e,i){var n;return(n=t.call(this,e)||this).option=x(Oa,p(i)?i:{}),n.animate=!1,n.init(),n}i(e,t);var n=e.prototype;return n.init=function(){t.prototype.create.call(this),this.$dom=ge(this.$dom)},n.show=function(t){!1===t?this.parent.$domWrap.removeClass("loading"):this.parent.$domWrap.addClass("correct loading")},n.click=function(t){},e}(Ca),$a="correct tip play pause back forward volume-high volume-low replay",Fa={play:"播放",pause:"暂停",replay:"重播",back:"后退",forward:"前进","volume-high":"音量高","volume-low":"音量低"},Na={tag:"mango-center-state-status",html:'\n    <mango-center-state-tip>\n        <span class="u-icon u-icon-pause">\n        <a href="javascript:void(0);" title="暂停">\n        <svg class="icon n-pause" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 34 34">\n            <path d="M6,0C4.35,0,3,1.35,3,3v28c0,1.65,1.35,3,3,3c1.65,0,3-1.35,3-3V3C9,1.35,7.65,0,6,0z"/>\n            <path d="M28,0c-1.65,0-3,1.35-3,3v28c0,1.65,1.35,3,3,3c1.65,0,3-1.35,3-3V3C31,1.35,29.65,0,28,0z"/>\n        </svg>\n        </a>\n        </span>\n        <span class="u-icon u-icon-play">\n        <a href="javascript:void(0);" title="播放">\n        <svg class="icon n-play" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 34 34">\n        <path d="M28.26,11.961L11.035,0.813C7.464-1.498,3,1.391,3,6.013v21.974c0,4.622,4.464,7.511,8.035,5.2L28.26,22.039\n            C31.913,19.675,31.913,14.325,28.26,11.961z"/>\n        </svg>        \n        </a>\n        </span>\n        <span class="u-icon u-icon-replay" action="onReplay">\n        <a href="javascript:void(0);" title="重播" action="onReplay">\n        <svg class="icon n-replay" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36">\n        <path d="M34.246,20.002c-1.076-0.273-2.159,0.377-2.43,1.448c-0.616,2.432-1.886,4.662-3.673,6.449c-2.645,2.644-6.16,4.1-9.899,4.1\n            s-7.255-1.456-9.899-4.1c-2.645-2.645-4.101-6.16-4.101-9.9s1.456-7.255,4.101-9.899S14.505,4,18.244,4\n            c1.941,0,3.82,0.389,5.584,1.157C25.394,5.838,26.795,6.801,28.02,8h-3.373c-1.104,0-2,0.896-2,2s0.896,2,2,2h6.918\n            c1.697,0,3.078-1.381,3.078-3.08V2c0-1.104-0.896-2-2-2c-1.104,0-2,0.896-2,2v2.982c-1.531-1.462-3.274-2.646-5.219-3.492\n            C23.155,0.501,20.739,0,18.244,0C13.437,0,8.916,1.873,5.517,5.272C2.117,8.671,0.244,13.192,0.244,18s1.872,9.328,5.272,12.728\n            C8.916,34.128,13.437,36,18.244,36s9.328-1.872,12.728-5.272c2.297-2.296,3.93-5.165,4.722-8.296\n            C35.965,21.361,35.317,20.274,34.246,20.002z"/>\n        </svg>\n        </a>\n        </span>\n    </mango-center-state-tip>\n    ',defaultEvent:{click:"click",touchstart:"click"}},Va=function(t){function e(e,i){var n;return(n=t.call(this,e)||this).option=x(Na,p(i)?i:{}),n.animate=!1,n.init(),n}i(e,t);var n=e.prototype;return n.init=function(){t.prototype.create.call(this),this.$dom=ge(this.$dom)},n.close=function(){this.replayTimer&&clearTimeout(this.replayTimer),this.tipTimer&&clearTimeout(this.tipTimer),this.parent.$domWrap.removeClass($a),this.parent.$level=0},n.showTip=function(t){var e=this;this.replayTimer&&clearTimeout(this.replayTimer),this.parent.$domWrap.removeClass($a).addClass("correct tip "+t),this.$domWrap.find("mango-center-state-tip-text").html(Fa[t]||""),this.tipTimer&&clearTimeout(this.tipTimer),this.tipTimer=setTimeout(function(){e.parent.$domWrap.removeClass("tip "+t)},500)},n.showVideoEnd=function(){var t=this;this.replayTimer=setTimeout(function(){t.parent.$domWrap.removeClass($a).addClass("correct tip replay"),t.$domWrap.find("mango-center-state-tip-text").html(Fa.replay),t.parent.$bumpToTop()},1e3)},n.onReplay=function(){$e.info("CenterStatePlugin","user clicked [Refresh] btn, trigger event [videoRefresh]."),this.parent.emit("videoRefresh"),this.parent.$domWrap.removeClass("tip replay"),this.parent.$level=0},n.click=function(t){var e=t.target.getAttribute("action");u(this[e])&&this[e](t),t.stopPropagation(),t.preventDefault()},e}(Ca);function Ha(t){void 0===t&&(t={});return!t.bdid||""===t.bdid&&0===t.bdid?(t.cid||"")+"_"+(t.vid||""):"0_"+(t.bdid||"")+"_"+(t.vid||"")}var Ba=mt;function Ua(t,e,i){var n,r=/iPad/i.test(navigator.userAgent),o=e,s=i,a=Ba("HDCN")?Ba("HDCN").match(/\b\w+\b/g)[0]:"",c=7,h=r?"4.1.11":"1.1.11",l=Ba("sessionid")||"",d=(Ba("uuid"),Ba("__STKUUID")),u=(new Date,'//as.mgtv.com/client/qrcode/getqrcodeinfo?data={"bid":"'+h+'","ftype":"'+s+'","clocation":"'+c+'","uvip":"'+(Ba("vipStatus")||"")+'","isscan":"1","unid":"'+o+'","cookie":"'+d+'","sessionid":"'+l+'","ticket":"'+a+'"}&sign=11&'+vt({invoker:"pcweb",version:"5.0.0.1",ticket:Ba("HDCN")?Ba("HDCN").match(/\b\w+\b/g)[0]:"",product_id:0,product_type:1,product_level:3,action:4,voucher_id:0,ip:"127.0.0.1",mac:Ba("__STKUUID")||"00000000-0000-0000-0000-000000000000",cxid:Ba("sessionid")||"",t:Math.round((new Date).getTime()/1e3),os:navigator.platform||"Win32",scene_code:"system",auto_buy:0}));if(window.jQuery&&(n=window.jQuery(t[0]).parent()),n&&n.qrcode)return Te(u).then(function(t){return t.json()}).then(function(e){e&&"200"==e.status?(n.html(""),n.qrcode({render:"canvas",width:110,height:110,text:e.msg.url})):t.attr("src",u).show()}).catch(function(e){t.attr("src",u).show()});t.attr("src",u).show()}var Wa={tag:"mango-center-state-error",cls:"c-player-error",html:" ",defaultEvent:{click:"click"}},za=function(t){function e(e,i){var n;return(n=t.call(this,e)||this).option=x(Wa,p(i)?i:{}),n.animate=!1,n.init(),n}i(e,t);var n=e.prototype;return n.init=function(){t.prototype.create.call(this),this.$domWrap=ge(this.$dom),this.token=Math.ceil(1e9*Math.random())},n.show=function(t){var e=this.getFeedBackURL(),i=this.getQRCodeURL(),n=Ya;switch(~~t.code){case 40001:case 40002:n=Ka,this.delayJumpToHome(),this.getRecommendVideo();break;case 40003:case 40005:n=Ga;break;case 40004:n=qa;break;default:n=Ya}var r=pt(n,a({},t,{feedbackUrl:e,qrcodeUrl:i}));this.$domWrap.html(r).show(),this.parent.children.start.close(),this.parent.pause(),this.parent.$bumpToTop()},n.close=function(){this.$domWrap.html("").hide(),this.parent.$level=0},n.refreshPage=function(){window.location.reload()},n.click=function(t){var e=t.target.getAttribute("action");u(this[e])&&this[e](t)},n.delayJumpToHome=function(){var t=this;clearTimeout(this.jumptohomeTimer),this.jumptohomeTimer=setTimeout(function(){window.location.href=t.jumpUrl||"https://www.mgtv.com/"},1e4)},n.cancelJump=function(t){this.jumptohomeTimer&&clearTimeout(this.jumptohomeTimer),this.$domWrap.find(".celist li").removeClass("focus")},n.getRecommendVideo=function(){var t=this,e=this.parent.vm._config.lobparam.did;return Te("//rc.mgtv.com/pc/ranklist?"+vt({rt:"v",c:111,limit:6,guid:"",uid:this.parent.vm._config.lobparam.uuid,cookie:e})).then(function(t){return t.json()}).then(function(e){if(e&&200==e.code&&e.data&&e.data.length){var i=t.recommendVideos=e,n=t.renderRecommendList(e.data),r=t.parent.vm.getVideoInfo();t.$domWrap.find('[node="video-error-recommended"]').html(n),t.parent.emit("recommendVideoShow",{vinfo:r,recommendVideos:i})}})},n.getQRCodeURL=function(){var t=this.parent.vm._config.lobparam.cxid,e=this.parent.vm.getVideoInfo();return"//pcweb.api.mgtv.com/qrcode/?"+vt({source:"pc2",from:"pc",p:e.vid,plid:e.plid||"",cxid:t})},n.getFeedBackURL=function(){var t="";return u(window.honeyUuid)?t=window.honeyUuid():u(String.fromCharCode)&&(t="feedback-rom-"+String.fromCharCode(65+Math.ceil(25*Math.random()))+Math.ceil(1e9*Math.random())),this.token=t,"https://www.mgtv.com/feedback/?token="+t},n.renderRecommendList=function(t){void 0===t&&(t=[]);var e="";return this.jumpUrl=t[0].play_url,t.forEach(function(t,i){t.klass=0==i?"focus":"",e+=pt(Xa,a({},t,{index:i}))}),e},n.onErrorRetry=function(){var t=this.parent.vm._config.video_id,e=this.parent.vm.getVideoInfo();this.parent.vm.reload(t),this.parent.emit("errorRefreshClick",{vinfo:e})},n.onFeedBackClick=function(){this.parent.emit("feedbackClick",{token:this.token})},n.sendClickEvent=function(t){var e=t.target.dataset.vid,i=1+~~t.target.dataset.index,n=this.parent.vm.getVideoInfo(),r=this.recommendVideos;this.parent.emit("recommandVideoClick",{hitid:e,pos:i,vinfo:n,recommendVideos:r})},e}(Ca),ja='<svg viewBox="0 0 14 14"><g>\n    <path class="p1" d="M11.5,1.2h-9C1.7,1.2,1,1.9,1,2.7v6.1c0,0.8,0.7,1.5,1.5,1.5h1.8l2.4,2.4c0.2,0.2,0.5,0.2,0.7,0l2.4-2.4h1.8\n        c0.8,0,1.5-0.7,1.5-1.5V2.7C13,1.9,12.3,1.2,11.5,1.2z M5.7,6.5C5.5,6.7,5.2,6.8,5,6.8c-0.1,0-0.3,0-0.4-0.1\n        c-0.1,0-0.2-0.1-0.3-0.2C4.1,6.3,4,6,4,5.8C4,5.6,4,5.5,4,5.4c0-0.1,0.1-0.2,0.2-0.3c0.4-0.4,1.1-0.4,1.4,0C5.9,5.3,6,5.5,6,5.8\n        C6,6,5.9,6.3,5.7,6.5z M9.7,6.5C9.5,6.7,9.3,6.8,9,6.8S8.5,6.7,8.3,6.5C8.1,6.3,8,6,8,5.8c0-0.1,0-0.3,0.1-0.4\n        c0-0.1,0.1-0.2,0.2-0.3C8.6,4.8,9,4.7,9.4,4.9c0.1,0,0.2,0.1,0.3,0.2C9.9,5.3,10,5.5,10,5.8C10,6,9.9,6.3,9.7,6.5z"/>\n    <path d="M11.5,0.2h-9C1.1,0.2,0,1.3,0,2.7v6.1c0,1.4,1.1,2.5,2.5,2.5h1.4L6,13.4c0.3,0.3,0.6,0.4,1,0.4s0.8-0.2,1-0.4l2.1-2.1h1.4\n        c1.4,0,2.5-1.1,2.5-2.5V2.7C14,1.3,12.9,0.2,11.5,0.2z M13,8.8c0,0.8-0.7,1.5-1.5,1.5H9.7l-2.4,2.4c-0.2,0.2-0.5,0.2-0.7,0\n        l-2.4-2.4H2.5C1.7,10.3,1,9.6,1,8.8V2.7c0-0.8,0.7-1.5,1.5-1.5h9c0.8,0,1.5,0.7,1.5,1.5V8.8z"/>\n    <path d="M4.3,5.1C4.2,5.2,4.1,5.3,4,5.4C4,5.5,4,5.6,4,5.8C4,6,4.1,6.3,4.3,6.5c0.1,0.1,0.2,0.2,0.3,0.2C4.7,6.8,4.8,6.8,5,6.8\n        c0.3,0,0.5-0.1,0.7-0.3C5.9,6.3,6,6,6,5.8c0-0.3-0.1-0.5-0.3-0.7C5.3,4.7,4.6,4.7,4.3,5.1z"/>\n    <path d="M9.4,4.9C9,4.7,8.6,4.8,8.3,5.1C8.2,5.2,8.2,5.3,8.1,5.4C8.1,5.5,8,5.6,8,5.8C8,6,8.1,6.3,8.3,6.5C8.5,6.7,8.8,6.8,9,6.8\n        s0.5-0.1,0.7-0.3C9.9,6.3,10,6,10,5.8c0-0.3-0.1-0.5-0.3-0.7C9.6,5,9.5,4.9,9.4,4.9z"/>\n</g></svg>',qa='<div class="cebox mini-error-copyright" style="display:block" node-type="error-copyright">\n    <h2 class="tit">{{msg}}</h2>\n    <p class="txt1 pbot25">错误码：<i>{{code}}</i>\n        <i class="svgicon svg-fback">'+ja+'</i>\n        <a href="{{feedbackUrl}}" action="onFeedBackClick" target="_blank">立即反馈</a>\n    </p>\n    <p class="txt2">芒果APP扫码观看 ↓</p>\n    <p class="pic"><img width="115" height="115" src="{{qrcodeUrl}}"></p>\n</div>',Ga='<div class="cebox mini-error-area">\n    <h2 class="tit ptop80">{{msg}}</h2>\n    <p class="txt1">错误码：<i>{{code}}</i>\n        <i class="svgicon svg-fback">'+ja+'</i>\n        <a href="{{feedbackUrl}}" action="onFeedBackClick" target="_blank">立即反馈</a>\n    </p>\n</div>',Ka='\n    <div class="cebox mini-error-playerdown" style="display:block;">\n    <h2 class="tit">{{msg}}</h2>\n    <p class="txt1">错误码：<i>{{code}}</i>\n        <i class="svgicon svg-fback">'+ja+'</i>\n        <a href="{{feedbackUrl}}" action="onFeedBackClick" target="_blank">立即反馈</a>\n    </p>\n    <div class="celist">\n        <ul class="clearfix" node="video-error-recommended"></ul>\n    </div>\n</div>',Ya='<div class="cebox mini-error-playerpub">\n    <h2 class="tit ptop30">{{msg}}</h2>\n    <p class="txt1">{{tips}}错误码：{{code}}</p>\n    <p class="btn">\n        <a href="javascript:void(0);" action="onErrorRetry"><i class="svgicon svg-ref"><svg viewBox="0 0 14 14">\n    <path d="M13.5,6.5C13.2,6.5,13,6.7,13,7c0,3.3-2.7,6-6,6s-6-2.7-6-6s2.7-6,6-6c1.6,0,3.2,0.7,4.3,1.8c0.1,0.1,0.2,0.2,0.4,0.4H9.6\n    c-0.3,0-0.5,0.2-0.5,0.5s0.2,0.5,0.5,0.5h2.8c0.5,0,0.9-0.4,0.9-0.9V0.5c0-0.3-0.2-0.5-0.5-0.5s-0.5,0.2-0.5,0.5l0,2\n    c-0.1-0.2-0.3-0.3-0.3-0.4C10.7,0.8,8.9,0,7,0C3.1,0,0,3.1,0,7c0,3.9,3.1,7,7,7c3.9,0,7-3.1,7-7C14,6.7,13.8,6.5,13.5,6.5z"/>\n</svg></i>刷新重试</a>\n    </p>\n    <p class="txt3">\n        <i class="svgicon svg-fback">'+ja+'</i>\n        <a href="{{feedbackUrl}}" action="onFeedBackClick" target="_blank">反馈问题获得帮助</a>\n    </p>\n</div>',Xa='<li class="{{klass}}">\n<div class="picbox">\n    <a href="{{play_url}}" class="error-list-uihot">\n        <span class="pimg">\n            <img src="{{image}}_160x90.jpg" width="160" height="90" data-vid="{{videoId}}" data-index="{{index}}" action="sendClickEvent"/>\n        </span>\n        <span class="pnum">\n            <i class="svgicon svg-play">\n                <svg viewBox="0 0 9 9">\n                    <path d="M7.4,3.3l-4.1-3C2.3-0.4,1,0.3,1,1.5v5.9c0,1.2,1.3,2,2.3,1.2l4.1-3C8.2,5.1,8.2,3.9,7.4,3.3z"/>\n                </svg>\n            </i>\n            <i>{{info}}</i>\n        </span>\n        <span class="pbg"></span>\n    </a>\n    <span class="pbtn">\n        <a href="{{play_url}}" class="error-list-uihot">\n            <i class="svgicon svg-next">\n                <svg viewBox="0 0 14 14">\n                    <g>\n                        <path d="M9.1,5.3l-6.3-4C1.5,0.6,0,1.5,0,3.1v8c0,1.5,1.5,2.5,2.8,1.7l6.3-4C10.3,8,10.3,6.1,9.1,5.3z"/>\n                        <path d="M13,1.1c-0.5,0-1,0.5-1,1v10c0,0.5,0.5,1,1,1s1-0.5,1-1v-10C14,1.5,13.5,1.1,13,1.1z"/>\n                    </g>\n                </svg>\n            </i>\n        </a>\n        <i class="t" action="cancelJump">取消</i>\n        <i class="line"></i>\n    </span>\n</div>\n<span class="ptxt">{{name}}</span>\n</li>',Qa={tag:"mango-center-state-ad-error",html:" ",defaultEvent:{click:"click"}},Ja={tag:"mango-center-state-blue",html:" ",defaultEvent:{click:"click"}},Za=101,tc=102,ec=200,ic='\n    <div class="c-player-paytips {{hideQRcodeCls}}">\n        <div class="c-player-paytips-wrapper">\n            <div class="c-player-paytips-title">\n                <i class="warning"></i><span>{{tips}}</span>\n            </div>\n            <div class="c-player-paytips-content">\n                \x3c!-- 左侧 --\x3e\n                <div class="c-player-paytips-primary" bosszone="{{boss}}">\n                    {{bottom}}\n                    <p class="c-player-paytips-adds">\n                        {{text}}\n                    </p>\n                    \x3c!-- 分割线 --\x3e\n                    <div class="c-player-paytips-divding"></div>\n                    \x3c!-- 特权 --\x3e\n                    <div class="c-player-paytips-welfare">\n                        <h5 class="title">开通会员享特权</h5>\n                        <div class="list">\n                            <div class="c-player-paytips-welfare-listitem"><i class="welfare-1"></i><span>观影无广告</span></div>\n                            <div class="c-player-paytips-welfare-listitem"><i class="welfare-2"></i><span>专属片库</span></div>\n                            <div class="c-player-paytips-welfare-listitem"><i class="welfare-3"></i><span>移动端覆盖</span><p class="listitem-tips">\n                                打开芒果APP，抢海量会员大礼包！<a href="javascript:void(0)" action="onClickInstallApp" data-pos="8">立即领取</a>\n                            </p></div>\n                            <div class="c-player-paytips-welfare-listitem"><i class="welfare-4"></i><span>赠送观影券</span></div>\n                        </div>\n                    </div>\n                </div>\n                \x3c!-- 右侧 --\x3e\n                <div class="c-player-paytips-sidebar">\n                    <span class="u-paycode">\n                        <span class="u-pic paycode-qrcode"><img class="pay-qrcode-info" node-type="pay-qrcode-info" style="display:none" src="" alt="我是二维码"></span>\n                        <i class="u-mask refresh-qrcode" action="refreshCode()"><i class="u-refresh"></i></i>\n                    </span>\n                    <p class="u-tips">\n                        扫一扫，开通会员\n                    </p>\n                </div>\n            </div>\n            <div class="c-player-paytips-reload">\n                开通后请登录并刷新页面观看\n            </div>\n        </div>\n    </div>\n',nc={isvip:'<em class="noad">全站畅享大片+无广告</em>',vip_tips:"开通会员可以免费观看本片",vip_pay_tips:"该片为付费点播影片,您享有优惠特权",pay_tips:"该片为付费点播影片,开通会员享优惠",no_ticket:"你的观影券已经用完,续费会员可以获赠观影券免费看",is_ticket:"你可以使用观影券继续观看影片",vip_no_ticket:"续费会员用券免费看",allpay:"该片仅限付费点播，购买后可观看完整视频",play_button:"购买本片"},rc={play_tips:"应版权方要求该片付费播放",buy_title:"",play_link:"购买本片",play_tips2:"会员每月获取2个张观音券",preview_tips:"免费试看5分钟",play_button:"购买本片",vip_promotion:"开通会员"},oc={tag:"mango-center-state-payment",html:" ",defaultEvent:{click:"click"}},sc={tag:"mango-center-state-finish",html:'\n    <div class="hd">\n        <div class="u-finish-share">\n            <span class="t">分享视频</span>\n            <div class="m-h5-share-list">\n                <a class="sina" href="#">新浪微博</a>\n                <a class="qzone" href="#">QQ空间</a>\n                <a class="weixin" href="#">微信</a>\n                <a class="qq" href="#">QQ</a>\n                <a class="link" href="#">分享链接</a>\n            </div>\n        </div>\n        <h2>相关推荐</h2>\n    </div>\n    ',defaultEvent:{click:"click"}},ac={tag:"mango-center-state-flash-error",html:" ",defaultEvent:{click:"click"}},cc={splash:xa,start:La,loading:Ma,status:Va,error:za,aderror:function(t){function e(e,i){var n;return(n=t.call(this,e)||this).option=x(Qa,p(i)?i:{}),n.animate=!1,n.init(),n}i(e,t);var n=e.prototype;return n.init=function(){t.prototype.create.call(this),this.$domWrap=ge(this.$dom)},n.show=function(t){var e=~~t.blacktime,i=pt('\n<div class="aderror-wrapper">\n    <p class="aderror-p aderror-ts">\n        <i class="ico">\n            <svg class="icon group"><path d="M0 0h2v8H0V0zm0 10h2v2H0v-2z"></path></svg>\n            <svg class="icon arrow-down"><path d="M5.1 5.9h.7l5-5a.5.5 0 0 0-.7-.7L5.5 4.8.9.1a.5.5 0 0 0-.8.8z"></path></svg>\n        </i>广告被插件误伤啦，视频将在<em node="downcount">{{downcount}}</em>秒后播放\n    </p>\n    <p class="aderror-p aderror-help">\n    <span class="help-t1">\n        <a href="//www.mgtv.com/v/2018/rhgbcj/" target="_blank" class="closea">如何关闭插件</a>\n        <span>关闭后仍无法播放广告?</span>\n        <a href="//www.mgtv.com/feedback/" target="_blank">立即反馈</a>\n    </span>\n    <span class="help-t2">观看广告，让小芒果能更好的为您服务</span>\n    </p>\n    <p class="aderror-p aderror-button"><a href="{{openVipUrl}}" target="_blank">开通会员</a></p>\n    <p class="aderror-p aderror-txt">开通会员不仅可以免广告，更有蓝光大片任您看。</p>\n</div>\n',{downcount:e,unid:Ha(this.parent.vm.getVideoInfo())});this.$domWrap.html(i).show(),this.parent.$bumpToTop(),this.countDown(e)},n.countDown=function(t){var e=this;clearInterval(this.timerid),this.timerid=setInterval(function(){--t>0?e.$domWrap.find('[node="downcount"]').html(t):clearInterval(e.timerid)},1e3)},n.close=function(){clearInterval(this.timerid),this.$domWrap.html("").hide(),this.parent.$level=0},n.click=function(t){var e=t.target.getAttribute("action");u(this[e])&&this[e](t),t.stopPropagation()},e}(Ca),blue:function(t){function e(e,i){var n;return(n=t.call(this,e)||this).option=x(Ja,p(i)?i:{}),n.animate=!1,n.init(),n}i(e,t);var n=e.prototype;return n.init=function(){t.prototype.create.call(this),this.$dom=ge(this.$dom)},n.show=function(){var t=this.parent.vm.getVideoInfo();this.data_ftype=10,this.data_unid=Ha(t);var e=pt('\n    <div class="c-player-windowmask" node-type="c-player-windowmask"></div>\n    <div class="c-player-1080p" node-type="hd-video-box" bosszone="tovip">\n        <div class="c-player-1080p-wrapper">\n            <div class="c-player-paytips-title">会员尊享蓝光极致清晰</div>\n            <div class="c-player-paytips-content">\n                \x3c!-- 左侧 --\x3e\n                <div class="c-player-paytips-primary">\n                    <a class="c-player-paytips-button open-vip-dialog" unid="{{data_unid}}" clocation="61001" \n                    ftype="10"  target="_blank" type="11"\' \n                    href="//order.mgtv.com/pay/pc/index.html?unid={{data_unid}}&ftype=10&clocation=61001">\n                        开通会员免费观看\n                        <i class="price" style="display:{{show}}">{{buy_tips}}</i>\n                    </a>\n                    <p class="c-player-paytips-adds">开通后请<a class="u-reload" href="javascript:;">登录</a>并<a class="u-reload" href="javascript:;">刷新</a>页面观看</p>\n                    \x3c!-- 分割线 --\x3e\n                    <div class="c-player-paytips-divding"></div>\n                    \x3c!-- 特权 --\x3e\n                    <div class="c-player-paytips-welfare">\n                        <h5 class="title">开通会员享特权</h5>\n                        <div class="list">\n                            <div class="c-player-paytips-welfare-listitem">\n                                <i class="welfare-1"></i><span>观影无广告</span>\n                            </div>\n                            <div class="c-player-paytips-welfare-listitem">\n                                <i class="welfare-2"></i><span>专属片库</span>\n                            </div>\n                            <div class="c-player-paytips-welfare-listitem">\n                                <i class="welfare-3"></i><span>移动端覆盖</span>\n                                <p class="listitem-tips">打开芒果APP，抢海量会员大礼包！<a href="#">立即领取</a></p>\n                            </div>\n                            <div class="c-player-paytips-welfare-listitem">\n                                <i class="welfare-4"></i><span>赠送观影券</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                \x3c!-- 右侧 --\x3e\n                <div class="c-player-paytips-sidebar">\n                    <span class="u-paycode">\n                        <span class="u-pic paycode-qrcode" node-type="paycode-qrcode"><img class="pay-qrcode-info" node-type="pay-qrcode-info" style="display:none" src="" alt="我是二维码"></span>\n                        <i class="u-mask refresh-qrcode" node-type="refresh-qrcode">\n                            <i class="u-refresh" action="refreshCode"></i>\n                        </i>\n                    </span>\n                    <p class="u-tips">扫一扫，开通会员</p>\n                </div>\n            </div>\n            <div class="c-player-paytips-divding"></div>\n            <div class="c-player-paytips-status" style="display:{{login}}">\n                您还未登录，请<a href="javascript:void(0);" action="login">登录</a>\n            </div>\n        </div>\n        <span class="c-player-paytips-close" action="close">关闭</span>\n    </div>',{show:"none",login:""===Ba("HDCN")?"block":"none",uvip:Ba("vipStatus")||0,data_unid:this.data_unid,buy_tips:""});this.$domWrap.html(e).show(),this.refreshCode()},n.refreshCode=function(){var t=this.$domWrap.find('[node-type="pay-qrcode-info"]'),e=this.$domWrap.find('[node-type="refresh-qrcode"]');e.hide(),this.qrcodeTimer&&clearTimeout(this.qrcodeTimer),Ua(t,this.data_unid,this.data_ftype),this.qrcodeTimer=setTimeout(function(){e.show()},18e4)},n.login=function(){window.H&&H.loginDialog&&H.loginDialog()},n.close=function(){this.qrcodeTimer&&clearTimeout(this.qrcodeTimer),this.$domWrap.html("").hide(),this.parent.play(),this.parent.$level=0},n.click=function(t){var e=t.target.getAttribute("action");u(this[e])&&(this[e](t),t.stopPropagation())},e}(Ca),payment:function(t){function e(e,i){var n;return(n=t.call(this,e)||this).option=x(oc,p(i)?i:{}),n.animate=!1,n.init(),n}i(e,t);var n=e.prototype;return n.init=function(){t.prototype.create.call(this),this.$dom=ge(this.$dom)},n.show=function(t){this.createHTMLFragment(t)},n.buildDialog=function(t,e,i){this.$domWrap.html(t).show(),this.refreshCode(e,i);var n=this.parent.videoinfo.info||{},r="https://msite.api.mgtv.com/ipad-download.html?from=pcweb&start_time=0&clipId="+n.collection_id+"&plId="+n.playlist_id+"&videoId="+n.video_id+"&type=1&pos=pc8";this.$domWrap.find('[action="onClickInstallApp"]').attr("href",r)},n.createHTMLFragment=function(t){var e=this,i="",n=t.info,r=t.user,o="",s=this.parent.vm.getVideoInfo(),a=n.price_novip||0,c=n.price_vip||0,h=1==r.isvip?c:a,l=Ha(s),d=encodeURIComponent(window.location.href),u=3,p=3;n&&n.tips&&(rc={play_tips:n.tips.play_tips,buy_title:n.tips.buy_title,play_link:n.tips.play_link,play_tips2:n.tips.play_tips2,preview_tips:n.tips.preview_tips,play_button:n.tips.play_button,vip_promotion:n.tips.vip_promotion},o=n.tips.vip_promotion||o);var f=""==o?"none":"block";nc.vip_tips=rc.play_tips,nc.play_button=rc.play_button;var m=function(t,e){return'<a class="c-player-paytips-button open-vip-dialog" unid="'+l+'"  clocation="60303" ftype="3" type="1" target="_blank" href="//order.mgtv.com/pay/pc/index.html?unid='+l+"&ftype="+u+"&clocation="+p+'">'+rc.play_button+'<i class="price" node-type="promotion-info" style="display: '+f+'">'+o+"</i> </a>"},v=function(){return'<em class="tickets">'+rc.play_tips2+'</em><a class="anotherway" type="2" target="_blank" href="//order.mgtv.com/pc/order?videoId='+s.vid+"&page="+d+"&unid="+l+"&ftype="+u+'&clocation=4">'+rc.play_link+"</a>"};if("live"==n.paymark&&(r.purview===Za&&r.purview==tc||(l=n.channelId||"",u=4,p=1,i=pt(ic,{bottom:m(),text:3==s.rid?v():nc.isvip,tips:"开通会员免费观看本直播",nickname:1==r.isvip?"尊敬的会员":"尊敬的用户",boss:"tovip"}),e.buildDialog(i,l,u))),"1"==n.paymark&&(r.purview===Za&&r.purview==tc||(i=pt(ic,{bottom:m(),text:3==s.rid?v():nc.isvip,tips:nc.vip_tips,nickname:1==r.isvip?"尊敬的会员":"尊敬的用户",boss:"tovip"}),e.buildDialog(i,l,u))),"2"==n.paymark){var g=['<a class="c-player-paytips-button" href="//order.mgtv.com/pc/order?videoId='+s.vid+"&page="+d+"&unid="+l+"&ftype="+u+'&clocation=4" target="_blank" type="5">'+nc.play_button+"</a>"].join(""),y=['<em class="tickets">'+rc.play_tips2+"</em>"].join(""),_=nc.vip_tips;1==r.isvip&&(_=nc.vip_pay_tips),r.purview!=Za&&r.purview==ec||(i=pt(ic,{bottom:g,price:h,text:y,tips:_,nickname:1==r.isvip?"尊敬的会员":"尊敬的用户",boss:"tovip",hideQRcodeCls:"c-player-paytips-nowxpay"}),e.buildDialog(i,l,u))}if("3"==n.paymark){var w='<a class="c-player-paytips-button" type="3" action="useCoupon">确认使用1张观影券</a>',b='<a class="c-player-paytips-button" type="4" target="_blank" href="//order.mgtv.com/pay/pc/index.html?unid='+l+"&ftype="+u+'&clocation=3">续费会员用券免费看</a>';""==r.uuid?(i=pt(ic,{bottom:m(),text:v(),tips:nc.vip_tips,nickname:1==r.isvip?"尊敬的会员":"尊敬的用户",boss:"tovip"}),e.buildDialog(i,l,u)):e.getCoupons().then(function(t){var n,o=t>0,s='<em class="tickets">您目前有<b>'+t+'张</b>观影券</em><em class="anotherway">48小时内随意观看</em>';n=1==r.isvip?{bottom:o?w:b,text:o?s:v(),tips:o?nc.is_ticket:nc.no_ticket,nickname:1==r.isvip?"尊敬的会员":"尊敬的用户",boss:"tovip"}:{bottom:o?w:m(),text:o?s:v(),tips:o?nc.is_ticket:nc.vip_tips,nickname:1==r.isvip?"尊敬的会员":"尊敬的用户",boss:"tovip"},i=pt(ic,n),e.buildDialog(i,l,u)})}},n.refreshCode=function(t,e){var i=this.$domWrap.find('[node-type="pay-qrcode-info"]'),n=this.$domWrap.find('[node-type="refresh-qrcode"]');n.hide(),this.qrcodeTimer&&clearTimeout(this.qrcodeTimer),Ua(i,t,e),this.qrcodeTimer=setTimeout(function(){n.show()},18e4)},n.login=function(){var t=getval(this,"parent.vm._injector.honey.loginDialog");u(t)&&t(),this.parent.emit("loginBtnClick")},n.close=function(){this.qrcodeTimer&&clearTimeout(this.qrcodeTimer),this.$domWrap.html("")},n.useCoupon=function(){var t=this.parent.vm.getVideoInfo();return Te("//i.mgtv.com/coupon/use?"+vt({video_id:t.vid,clip_id:t.cid})).then(function(t){return t.json()}).then(function(t){t&&200==t.err_code?window.location.reload():alert("非常抱歉,数据出现异常,请重新尝试")})},n.getCoupons=function(){return Te("//i.mgtv.com/coupon/count?"+vt({})).then(function(t){return t.json()}).then(function(t){return t&&200==t.err_code&&t.data.count>=0?t.data.count:0})},n.onClickInstallApp=function(t){var e=t.target.dataset.pos,i=this.parent.videoinfo.info;this.parent.emit("installAppClick",{vinfo:i,pos:e})},n.click=function(t){var e=t.target.getAttribute("action");u(this[e])&&(this[e](t),t.stopPropagation())},e}(Ca),finish:function(t){function e(e,i){var n;return(n=t.call(this,e)||this).option=x(sc,p(i)?i:{}),n.animate=!1,n.init(),n}i(e,t);var n=e.prototype;return n.init=function(){t.prototype.create.call(this),this.$dom=ge(this.$dom)},n.click=function(t){},e}(Ca),flashinstall:function(t){function e(e,i){var n;return(n=t.call(this,e)||this).option=x(ac,p(i)?i:{}),n.animate=!1,n.init(),n}i(e,t);var n=e.prototype;return n.init=function(){t.prototype.create.call(this),this.$domWrap=ge(this.$dom)},n.show=function(t){var e=wt(this,"parent.vm._injector.stk.$.getCxid",function(){})("cxid")||"",i=this.parent.vm.getVideoInfo(),n=pt('\n<div class="mgtv-flash-install">\n    <div class="mgtv-flash-install-con">\n        <p class="con-tagtxt">亲，您的FLASH插件出现异常，无法播放视频</p>\n        <p class="con-tagtxt-s">您可以 ↓</p>\n        <p class="con-iconlist">\n            <span class="iconlist">\n                <a href="//www.adobe.com/go/getflashplayer" target="_blank" class="ico flash"></a>\n                <a href="//www.adobe.com/go/getflashplayer" target="_blank" class="txt first">修复FLASH插件<em>(推荐)</em></a>\n            </span>\n            <span class="iconlist">\n                <a href="javascript:void(0)" class="ico code"><img src="{{qrcodeUrl}}" alt=""></a>\n                <a href="javascript:void(0)" class="txt">手机扫码观看</a>\n            </span>\n            <span class="iconlist">\n                <a href="//pc.api.mgtv.com/client/download" target="_blank" class="ico mgtv"></a>\n                <a href="//pc.api.mgtv.com/client/download" target="_blank" class="txt">桌面客户端观看</a>\n            </span>\n        </p>\n    </div>\n</div>\n',{qrcodeUrl:"//pcweb.api.mgtv.com/qrcode/?source=pc2&from=pcweb&p="+(i.vid||"")+"&plid="+(i.plid||"")+"&cxid="+e});this.$domWrap.html(n).show(),this.parent.$bumpToTop()},n.close=function(){this.$domWrap.hide()},n.click=function(t){},e}(Ca)},hc=function(t){return t.$config.children||c(cc).reduce(function(t,e){return t[e]=1,t},{})};var lc={errorTips:"加载失败，请刷新重试"},dc=/iPad/i.test(navigator.userAgent),uc=aa({name:"mangoCenterState",tagName:"mango-center-state",html:" ",offset:"0",hide:!1,operable:!1,penetrate:!1,create:function(){},init:function(){var t,e;this.config=p(this.$config)?x(lc,this.$config):lc,this.vm=this.__dispatcher.vm,this.vm.isAutoplay=1,this.children=(e=(t=this).config.children=hc(t),c(e).filter(function(t){return e[t]&&cc[t]}).reduce(function(i,n){var r=cc[n];return i[n]=new r(t,e[n]),i},{}))},inited:function(){for(var t in this.src&&this.children.loading.show(!0),this.children)this.children[t].inited&&this.children[t].inited()},destroy:function(){this.clearTimeout()},events:{videoReady:function(){this.hasDetected||this.detectAutoPlay(!1)},frontAdReady:function(){this.hasDetected||this.detectAutoPlay(!0)},noFlashInstallException:function(t){this.flashInstallFail()},adBlockException:function(t){t.blacktime>0&&(this.children.splash.show(!1),this.children.aderror.show(t))},cmsData:function(t){"loadComplete"==t.status&&(this.videoinfo=t.data,this.vm.getPaymentInfo(this.videoinfo.user,this.videoinfo.info))},frontAdBegin:function(){},frontAdPlay:function(){this.splashEnd=!0,this.children.splash.show(!1),this.children.start.close(),this.children.flashinstall.close()},frontAdEnd:function(){this.children.aderror.close()},videoEnd:function(){this.vm.isLoopPlay=0,this.children.status.showVideoEnd()},videoPlay:function(){this.splashEnd=!0,this.children.splash.show(!1),this.children.status.close(),this.children.start.close(),this.children.flashinstall.close()},videoPause:function(){this.children.status.showTip("pause"),this.children.loading.show(!1)},videoResume:function(){this.children.status.showTip("play")},videoReplay:function(){var t=this;this.children.status.close(),setTimeout(function(){t.children.status.close()},500),this.vm.isLoopPlay=1},videoRefresh:function(){var t=this;this.children.status.close(),setTimeout(function(){t.children.status.close()},500),this.vm.isRefreshPlay=1},videoDrag:function(){this.children.loading.show(!1)},videoReload:function(){this.children.loading.show(!1),this.children.error.close(),this.children.aderror.close(),this.children.blue.close(),this.children.payment.close(),this.children.status.close(),this.splashEnd=!1,this.children.splash.show(!0),this.vm.isContinuePlay=1,this.vm.isAutoplay=1,this.vm.manualClickPlay=!1},showHdDialog:function(t){this.children.blue.show(t),this.$bumpToTop(),this.pause()},showVipDialog:function(t){this.children.payment.show(t),this.$bumpToTop(),this.pause(),this.vm.setFloatingWindow(0)},clarityChanged:function(t){this.children.loading.show(!1)},canplay:function(){this.playing()},playing:function(){this.playing()},videoWaiting:function(){this.waiting()},timeupdate:function(){},apiRequestError:function(t){this.onError(t)},hlsStreamError:function(t){this.onError(t)},frontAdError:function(t){this.onError(t)},videoError:function(t){this.onError(t)},flashInitFail:function(){this.flashInstallFail()},dashStreamError:function(t){var e,i=t.data.error;if(p(i)&&i.code){switch(i.code>=100&&i.code<=114&&(e=De.DRM_FAIL_ERROR),i.code){case 111:case 112:e=De.DRM_NOT_SUPPORT_ERROR;break;case 114:e=De.DRM_FAIL_ERROR;break;case 28:e=De.CDN_MEDIA_TIMEOUT;case 10:e=De.CDN_MEDIA_ERROR;break;default:e=De.CDN_OTHER_ERROR}this.showErrorDialog(e)}}},methods:{flashInstallFail:function(){var t=this;this.children.splash.show(!1),this.children.flashinstall.show(),setTimeout(function(){t.children.splash.show(!1)},200)},onError:function(t){if(t&&t.data&&t.data.fatal){var e=a({},t.data),i=e.type;if("fragLoopLoadingError"==e.details)return;switch(i){case"hlsNetworkError":case"videoNetworkError":e=De.CDN_DING_DOWNLOAD_TIMEOUT;break;case"hlsMuxError":case"hlsMediaError":e=De.CDN_MEDIA_ERROR;break;case"hlsOtherError":e=De.CDN_OTHER_ERROR}e=t.rawdata||e,this.showErrorDialog(e)}},showErrorDialog:function(t){var e=this;this.children.error.show(t),this.children.splash.show(!1),setTimeout(function(){e.children.start.close()},200),this.pause()},detectAutoPlay:function(t){var e=this;if(dc)return this.hasDetected=!0,this.vm.isAutoplay=0,this.children.splash.show(!1),this.children.start.show(t),void this.vm.emit("autoplayFail");var i=this.__dispatcher.dom.videoElement.play();this.hasDetected=!0,void 0!==i&&i.then(function(){$e.info("PluginState","video autoplay ok."),e.vm.isAutoplay=1}).catch(function(i){e.vm.emit("autoplayFail"),$e.info("PluginState","video autoplay fail, show manual [Play] button. "+i),e.vm.isAutoplay=0,e.children.splash.show(!1),e.children.start.show(t),e.pause()})},playing:function(){this.clearTimeout(),this.children.loading.show(!1)},waiting:function(){this.clearTimeout(),!this.paused&&this.splashEnd&&this.children.loading.show(!0)},clearTimeout:function(){this._timeout&&(clearTimeout(this._timeout),this._timeout=null)}}}),pc=Q(function(t,e){var i,n,r,o,s;i=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,n=/^([^\/?#]*)(.*)$/,r=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,s={buildAbsoluteURL:function(t,e,i){if(i=i||{},t=t.trim(),!(e=e.trim())){if(!i.alwaysNormalize)return t;var r=s.parseURL(t);if(!r)throw new Error("Error trying to parse base URL.");return r.path=s.normalizePath(r.path),s.buildURLFromParts(r)}var o=s.parseURL(e);if(!o)throw new Error("Error trying to parse relative URL.");if(o.scheme)return i.alwaysNormalize?(o.path=s.normalizePath(o.path),s.buildURLFromParts(o)):e;var a=s.parseURL(t);if(!a)throw new Error("Error trying to parse base URL.");if(!a.netLoc&&a.path&&"/"!==a.path[0]){var c=n.exec(a.path);a.netLoc=c[1],a.path=c[2]}a.netLoc&&!a.path&&(a.path="/");var h={scheme:a.scheme,netLoc:o.netLoc,path:null,params:o.params,query:o.query,fragment:o.fragment};if(!o.netLoc&&(h.netLoc=a.netLoc,"/"!==o.path[0]))if(o.path){var l=a.path,d=l.substring(0,l.lastIndexOf("/")+1)+o.path;h.path=s.normalizePath(d)}else h.path=a.path,o.params||(h.params=a.params,o.query||(h.query=a.query));return null===h.path&&(h.path=i.alwaysNormalize?s.normalizePath(o.path):o.path),s.buildURLFromParts(h)},parseURL:function(t){var e=i.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(r,"");t.length!==(t=t.replace(o,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}},t.exports=s}),fc="mango-kernel-hls:hls",mc=window.Hls.Events,vc=window.Hls.isSupported;mc.P2P_STATS="stats";var gc,yc,_c,wc,bc,Ec,Tc=pc.parseURL,Rc=function(t){t=a({},t);var e,i,n=window.P2Hls,r=window.Hls,o=t.p2p||{};delete t.p2p;try{i=JSON.parse("false")}catch(t){}if(i&&(o=a({enable:!0},o,p(i)?i:{enable:!!i})),o.enable&&p(n)&&u(n.isSupported)&&n.isSupported()){var s=new n.Engine(x({xhrLoader:r.DefaultConfig.loader,loader:{trackerAnnounce:[location.protocol.replace("http","ws")+"//signal.hitv.com"],rtcConfig:{iceServers:[{urls:"stun:stun.hitv.com"}]},cacheSize:"1.2gb",getFPSig:function(t){var e,i=((Tc(t.url)||"").path||"").split("/").pop();return i&&-1!==(e=i.indexOf("_"))?i.substring(0,e):null}},segments:{swarmId:function(t){var e=t.split("?")[0],i=Tc(e);return i&&i.path||e}}},o)),c=s.peerId;$e.info(fc,"\n----------------------------\nHLS.js: v"+r.version+"\nP2P Client: v"+n.version+"\nPeer Id: "+c+"\n----------------------------");var h=n.Events,l=new Map,d={p2p:0,http:0},f=0,m=[],v=[],g=function(){$e.info(fc,"peers => "+JSON.stringify(Array.from(l.values()).map(function(t){return t.id+(t.remoteAddress?"@"+t.remoteAddress+":"+t.remotePort:"")})))},y=at(function(){var t,i,n,r,o=(i=(t=d).http,n=t.p2p,{peerId:c,total:r=i+n,http:i,p2p:n,upload:f,p2pRatio:+(n/r).toFixed(3)});$e.debug(fc,"stats => "+pt("↓{{p2p}} | ↑{{upload}} ⌁ {{p2pRatio}} x {{total}}",o)),e.trigger(mc.P2P_STATS,{stats:o})},500);s.on(h.PeerConnect,function(t){l.set(t.id,t),g()}).on(h.PeerClose,function(t){l.delete(t),g()}).on(h.PieceBytesLoaded,function(t,e){v.push({method:t,size:e,timeStamp:performance.now()}),d[t]+=e,y()}).on(h.PieceBytesUploaded,function(t,e){m.push({size:e,timestamp:performance.now()}),f+=e,y()}),(e=new r(a({},t,{loader:s.loaderCreator()}))).on(mc.DESTROYING,function(){$e.info(fc,"HLS instance destroying..."),s.destroy(),l.clear(),d={p2p:0,http:0},m.length=0,f=0,v.length=0}),s.attach(e)}else e=new r(t);return e},Ac={debug:!1,enableBitrateTest:!1,enableWorker:!1,maxBufferSize:6e4,manifestLoadingMaxRetry:0,manifestLoadingTimeOut:11e3,levelLoadingTimeOut:11e3,levelLoadingMaxRetry:0,nudgeMaxRetry:20,fragLoadingMaxRetry:9999},Sc="1.0.1",kc="mango-kernel-hls",Pc=(_c=yc=function(t){function n(e,i,n){var r;if(void 0===n&&(n={}),(r=t.call(this)||this).version=Sc,r._speed=0,r._stats={},!R(e))throw new Error("video element passed in "+kc+" must be a HTMLVideoElement, but not "+typeof e);if(!p(i))throw new Error("config of "+kc+" must be an Object but not "+typeof i);r.video=e,r.config=i;var o=x({},Ac,n);return r.config.drmData&&(o.emeEnabled=!0,o.widevineLicenseUrl=unescape(r.config.drmData["com.widevine.alpha"].serverURL)),r.hlsKernel=Rc(o),r.bindEvents(),r.attachMedia(),r}i(n,t),n.isSupport=function(){return vc()};var r=n.prototype;return r.bindEvents=function(t){var e=this;void 0===t&&(t=!1);var i=this.hlsKernel;if(i){var n=t?"off":"on";[mc.ERROR,mc.BUFFER_EMPTY,mc.BUFFER_FULL,mc.FRAG_PARSING_INIT_SEGMENT,mc.FRAG_LOADED,mc.FRAG_LOAD_PROGRESS,mc.FRAG_PARSING_DATA,mc.LEVEL_SWITCHED,mc.P2P_STATS].forEach(function(t){i[n](t,e.hlsEventHandler)})}},r.load=function(t,e){void 0===e&&(e=-1),this.hlsKernel.loadSource(this.config.src,this.config.playlist),-1!=e&&this.hlsKernel.startLoad(e)},r.startLoad=function(t,e){return void 0===e&&(e=-1),this.hlsKernel.startLoad(e)},r.stopLoad=function(){return this.hlsKernel.stopLoad()},r.attachMedia=function(){return this.hlsKernel.attachMedia(this.video)},r.play=function(){return this.video.play()},r.destroy=function(){return this.bindEvents(!0),this.removeAllListeners(),this.hlsKernel.destroy()},r.loadLevel=function(t){var e=this;return new Promise(function(i,n){e._loadLevel(t,function(){i("level switched.")})})},r._loadLevel=function(t,e){this.hlsKernel.loadLevel=t,this.loadLevelCallback=e},r.seek=function(t){this.video.currentTime=t},r.pause=function(){return this.video.pause()},r.refresh=function(){return this.hlsKernel.stopLoad(),this.hlsKernel.loadSource(this.config.src,this.config.fakeMasterPlaylist)},r.getMetadata=function(){return this.metadata},r.getSpeed=function(){return this._speed},r.getFps=function(){return this.fps||0},r.getBufferInfo=function(){return this.hlsKernel.bufferInfo},r.hlsEventHandler=function(t,e){var i=e.stats;switch(t){case mc.LEVEL_SWITCHED:this.loadLevelCallback&&this.loadLevelCallback(),this.loadLevelCallback=null;break;case mc.BUFFER_EMPTY:$e.warn(kc,"hlscore buffer is empty.");break;case mc.FRAG_PARSING_DATA:"video"===e.type&&(this.fps=e.nb/(e.endPTS-e.startPTS));break;case mc.FRAG_PARSING_INIT_SEGMENT:this.metadata=wt(e,"tracks.video.metadata",{});break;case mc.FRAG_LOADED:case mc.FRAG_LOAD_PROGRESS:var n=i.speed;n&&(this._speed=n);break;case mc.ERROR:this._handleHlsError(t,e);break;case mc.P2P_STATS:i.speed=i.speed||this._speed||0,this._stats=i}this.emit(t,e)},r._handleHlsError=function(t,e){var i=this.hlsKernel.levels,n=e&&e.details,r=i[this.hlsKernel.loadLevel];if(e.context=e.context||{},e.context.url=e.context.url||r&&r.details&&r.details.url||"","levelLoadTimeOut"==n||"levelLoadError"==n||"manifestLoadTimeOut"==n||"manifestLoadError"==n)return this.emit("hlsRecoverStreamError",e);this.emit("hlsStreamError",e),this.emit(t,e),$e.error(kc,"hlscore error ouccurred at event ["+t+"], detail "+n+" - "+(e&&e.err))},e(n,[{key:"stats",get:function(){return this._stats}}]),n}(te),yc.version=Sc,r((gc=_c).prototype,"hlsEventHandler",[_i],s(gc.prototype,"hlsEventHandler"),gc.prototype),gc),Cc={debug:!1,withCredentials:!1,enableBitrateTest:!1,enableWorker:!1,maxBufferSize:6e4,manifestLoadingMaxRetry:0,manifestLoadingTimeOut:11e3,levelLoadingTimeOut:11e3,levelLoadingMaxRetry:0,nudgeMaxRetry:20,fragLoadingMaxRetry:9999,fragLoadingTimeout:11e3},Dc="mango-kernel-dash",xc=window.dashjs.MediaPlayer.events,Ic=window.dashjs.Protection.events,Lc=(Ec=bc=function(t){function n(e,i,n){var r;if(void 0===n&&(n={}),(r=t.call(this)||this).kernel={},r._speed=0,r._stats={},r._startPosition=-1,r._retry=0,!R(e))throw new Error("video element passed in "+Dc+" must be a HTMLVideoElement, but not "+typeof e);if(!p(i))throw new Error("config of "+Dc+" must be an Object but not "+typeof i);r.video=e,r.config=i,r._startPosition=-1,r._retry=0;var o=x({},Cc,n),s=r.kernel=dashjs.MediaPlayer().create();return s.initialize(),s.getDebug().setLogToBrowserConsole(o.debug),s.setScheduleWhilePaused(!0),s.setFastSwitchEnabled(!0),s.setManifestLoaderRetryAttempts(o.manifestLoadingMaxRetry),s.setManifestLoaderRetryTimeout(o.manifestLoadingTimeOut),s.setFragmentLoaderRetryAttempts(o.fragLoadingMaxRetry),s.setFragmentLoaderRetryTimeout(o.fragLoadingTimeout),s.setXHRWithCredentialsForType("MPD",o.withCredentials),s.setXHRWithCredentialsForType("MediaSegment",o.withCredentials),s.setBufferToKeep(70),s.setFragmentLoaderRetryInterval(500),s.setStableBufferTime(60),r.bindEvents(),r.attachMedia(),r}i(n,t);var r=n.prototype;return r.bindEvents=function(t){var e=this;void 0===t&&(t=!1);var i=this.kernel;if(i){var n=t?"off":"on";[xc.BUFFER_EMPTY,xc.BUFFER_LOADED,xc.MANIFEST_LOADED,xc.PLAYBACK_METADATA_LOADED,xc.PLAYBACK_PLAYING,xc.METRIC_CHANGED,xc.METRIC_UPDATED,xc.METRICS_CHANGED,xc.PERIOD_SWITCH_COMPLETED,xc.PERIOD_SWITCH_STARTED,xc.ERROR,Ic.LICENSE_REQUEST_COMPLETE].forEach(function(t){i[n](t,e.dashEventHandler)})}},r.load=function(t,e,i,n){var r=this;void 0===e&&(e=-1),n&&this.kernel.setProtectionData(n),this.kernel.attachSource(this.config.src),-1!=e&&(this._startPosition=e,this.kernel.seek(e)),this._eventPoller&&clearInterval(this._eventPoller),this._eventPoller=setInterval(function(){r.eventPoller()},1e3)},r.startLoad=function(t,e){return void 0===e&&(e=-1),this.kernel.seek(e)},r.stopLoad=function(){},r.attachMedia=function(){return this.kernel.attachView(this.video)},r.play=function(){return this.video.play()},r.eventPoller=function(){var t=this.kernel.getDashMetrics();this.kernel.getDashAdapter();t&&(this._bufferLevel=t.getCurrentBufferLevel("video"))},r.destroy=function(){return this.bindEvents(!0),this._eventPoller&&clearInterval(this._eventPoller),this._eventPoller=null,this.kernel.reset()},r.seek=function(t){this.kernel.seek(t)},r.pause=function(){return this.video.pause()},r.getMetadata=function(){return this.metadata},r.getSpeed=function(){return this._speed},r.getFps=function(){return this.fps||0},r.getBufferInfo=function(){return{len:this._bufferLevel}},r.dashEventHandler=function(t){switch(t.type){case xc.BUFFER_EMPTY:this.emit("dashBufferEmpty",t),$e.warn(Dc,"dashcore buffer is empty.");break;case xc.ERROR:this.dashErrorHandler(t);break;case xc.MANIFEST_LOADED:break;case xc.PLAYBACK_METADATA_LOADED:-1!=this._startPosition&&(this.kernel.seek(this._startPosition),this._startPosition=-1);break;case Ic.LICENSE_REQUEST_COMPLETE:this.emit("dashLicenseRequest",t),$e.info(Dc,"dashcore fetch drm license."+JSON.stringify(t))}},r.isFatalError=function(t){var e=t.code;return-1!==[3].indexOf(e)},r.dashErrorHandler=function(t){p(t.error)&&(this._retry<2&&!this.isFatalError(t.error)?(this._retry++,this.emit("dashRecoverStreamError",t)):this.emit("dashStreamError",t),$e.error(Dc,"dashcore error ouccurred at event ["+JSON.stringify(t.error||{}).message+"]"))},e(n,[{key:"stats",get:function(){return this._stats}}]),n}(te),bc.version="1.0.0",r((wc=Ec).prototype,"dashEventHandler",[_i],s(wc.prototype,"dashEventHandler"),wc.prototype),wc),Oc=/iPad/i.test(navigator.userAgent);function Mc(t,e){for(var i=!0,n=0,r=[];t.length;){var o=t.shift();if(o.vid===e.vid&&(o=e,i=!1),r.push(o),++n>10)break}return i&&r.unshift(e),r}function $c(t){var e=mt("uuid")||"";return"//playhistory.bz.mgtv.com/playHistory"+("/heartbeat?pid=&ticket="+(mt("HDCN")||"").split("-")[0]+"&uid="+e+"&cid="+(t.cid||"")+"&vid="+(t.vid||"")+"&sid="+(t.sid||"")+"&from="+(Oc?"3":"1"))}function Fc(t,e,i,n){var r,o,s=t.vid,a=+new Date,c=Se.get("honey-rec")||[],h=Se.get("player-add")?c:[];r={updateTime:a,video_id:s,vid:s,cid:t.cid||"",url:"//www.mgtv.com/s/"+s+".html?start_time="+i,sid:t.sid||"",video_name:t.title||"",watchTime:e,time:i,isEnd:n},o={updateTime:a,vid:s,cid:t.cid||"",sid:t.sid||"",watchTime:i,isEnd:n},c=Mc(c,r),h=Mc(h,o),Se.set("honey-rec",JSON.stringify(c)),Se.set("player-add",JSON.stringify(h))}function Nc(t,e,i,n){var r=!!(mt("HDCN")||"").split("-")[0];if(0==e){var o=Oc?6:1;Xe("//vc.mgtv.com/v3/watch?vid="+(t.vid||"")+"&cid="+(t.cid||"")+"&pid="+(t.bdid||"")+"&invoker="+o+"&_t="+Math.random())}else if(1==e){var s="已观看"+Math.ceil(i/n*100)+"%",a=$c(t)+"&watchTime="+parseInt(i)+"&isEnd=0";r?Xe(a):Fc(t,s,i,0)}else if(2==e){var c=$c(t)+"&watchTime=0&isEnd=1";r?Xe(c):Fc(t,"已看完",0,1)}}var Vc={getPlayEvent:function(){this._config.writeHistory&&Nc(this.getVideoInfo(),0);bt(H,"MGTV_VIDEO_FUN.getPlayEvent")},getStopEvent:function(){this._config.writeHistory&&Nc(this.getVideoInfo(),2);bt(H,"MGTV_VIDEO_FUN.getStopEvent")},getSeekEvent:function(t,e){this._config.writeHistory&&Nc(this.getVideoInfo(),1,t,e);bt(H,"MGTV_VIDEO_FUN.getSeekEvent",[t,e])},getCMSDataEvent:function(t){bt(H,"MGTV_VIDEO_FUN.getCMSDataEvent",[t])},setFloatingWindow:function(t){bt(J,"FLASH_FLOATIONPLAYERWINDOW",[t])},setFloatingWindowStatus:function(t){bt(J,"clipStart",[t])},initVipDialog:function(t){return bt(H,"vipDialog",[t])},showHDPayDialog:function(t){return bt(J,"FLASH_MGTV_VIDEOHD",[t])},getPaymentInfo:function(t,e){return bt(J,"FLASH_showPayMovie",[t,e])},getPlayerNextId:function(){return bt(J,"FLASH_MGTV_FUN.getPlayerNextId")},getNextPlayUrl:function(){return bt(J,"FLASH_MGTV_FUN.getNextPlayUrl")},requesetRefreshPage:function(){bt(J,"refreshPage")},OnGetNextVideoInfo:function(t,e){this.cms.setNextVideoId(t,e)},toggleDanmuInput:function(t,e,i,n,r){.5==i&&(i=.6),bt(J,"FLASH_MGTV_FUN_DANMU",[t,e,i,1-n,r])},toggleDanmuButton:function(t){bt(J,"FLASH_MGTV_FUN_SHOWDANMU",[t])},setDanmuStatus:function(t){var e=void 0===t?options:t,i=e.visible,n=e.ratio,r=e.transparency,o=e.speed;.6==n&&(n=.5),this.emit("danmuStatusChange",{state:i,ratio:n,opacity:1-r,speed:o})},setDanmuVisible:function(t,e){void 0===e&&(e=1),this.emit("danmuStatusChange",{state:t})},sendDanmu:function(t){if(this.mangoDanmu){var e={content:t,type:1};this.mangoDanmu.sendMsg(e)}},toggleWebFullScreen:function(){this.emit("toggleWebFullScreen",{})},showToast:function(t){var e={};e=_(t)?{toast:t}:t,this.emit("showToast",e)},screenshot:function(t){return function(t,e){void 0===e&&(e="image/png");var i=document.createElement("canvas");i.width=t.videoWidth,i.height=t.videoHeight,i.getContext("2d").drawImage(t,0,0,i.width,i.height);var n=i.toDataURL(e);return i.remove(),n}(this.__dispatcher.dom.videoElement,t)},OnFMPlayerVersion:function(){return this.version},get_time:function(){return this.currentTime},getFloatWindowMode:function(){return bt(J,"getFloatingWindowMode")},enableFloatWindow:function(t){return bt(J,"FLASH_FLOATIONPLAYERWINDOW",[t?"1":"0"])}},Hc=["94l6w226e","94l6w226d","94l6w226c","94l6w226b","94l6w226a","94l6w2269","94l6w2268","94l6w226n","94l6w226m","95exclax3","95exclax2","95exclax1","95exclax0","95exclawz","95exclawy","95exclawx","95exclaww","95exclaxb","95exclaxa","95exclapz","95exclapy","95exclapx","95exclapw","95exclapv","95exclapu","95exclapt","95exclaps","95exclaq7","95exclaq6","95exclaiv","90f12f8na","90f12f8n9","90f12f8n8","90f12f8n7","90f12f8n6","90f12f8n5","90f12f8n4","90f12f8nj","90f12f8ni","90f945a4n","90f945a4m","90f945a4l","90f945a4k","90f945a4j","90f945a4i","90f945a4h","90f945a4g","90f945a4v","90f945a4u","90f9459xj","90f9459xi","90f9459xh","90f9459xg","90f9459xf","90f9459xe","90f9459xd","90f9459xc","90f9459xr","90f9459xq","90f9459qf","90f9459qe","90f9459qd","90f9459qc","90f9459qb","90f9459qa","90f9459q9","90f9459q8","90f9459qn","90f9459qm","90f945b47","90f12gp6u","90f12gp6t","90f12gp6s","90f12gp6r","90f12gp6q","90f12gp6p","90f12gp6o","90f12gp73","90f12gp72","90f8tgeiv","90f8tgeiu","90f8tgeit","90f8tgeis","90f8tgeir","90f8tgeiq","90f8tgeip","90f8tgeio","90f8tgej3","90f8tgej2","90f8tgebr","90f8tgebq","90f8tgebp","90f8tgebo","90f8tgebn","90f8tgebm","90f8tgebl","90f8tgebk","90f8tgebz","90f8tgeby","90f8tge4n","90f8tge4m","90f8tge4l","90f8tge4k","90f8tge4j","90f8tge4i","90f8tge4h","90f8tge4g","90f8tge4v","90f8tge4u","90f8tgfif","90f62oqfm","90f945b46","90f945b45","90f945b44","90f945b43","90f945b42","90f945b41","90f945b40","90f945b4f","90f945b4e","90f945ax3","90f945ax2","90f945ax1","90f945ax0","90f945awz","90f945awy","90f945awx","90f945aww","90f945axb","90f945axa","90f945apz","90f75k8zq","90f75k8zp","90f75k8zo","90f75k8zn","90f75k8zm","90f75k8zl","90f75k8zk","90f75k8zz","90f75k8zy","90f75k8sn","90f75k8sm","90f75k8sl","90f75k8sk","90f75k8sj","90f75k8si","90f75k8sh","90f75k8sg","90f75k8sv","90f75k8su","90f75k8lj","90f6clzly","90f6clzlx","90f6clzlw","90f6clzlv","90f6clzlu","90f6clzlt","90f6clzls","90f6clzm7","90f6clzm6","90f6clzev"];var Bc="\n.nonceWrapper{\n    postion:relative;\n}\n.nonceWrapper .u-icon-play{\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    z-index: 10;\n    margin: -50px 0 0 -50px;\n}\n.nonceWrapper .u-icon-play a{\n    width: 100px;\n    height: 140px;\n    width: 100px;\n    height: 100px;\n    display: block;\n    background: url(//img.mgtv.com/imgotv-miniv6/player/h5skin/icon-h5.png) no-repeat;\n    background-position: -442px 0;\n    text-indent: -9999px;\n}\n",Uc=function(){},Wc=!!window.ActiveXObject||"ActiveXObject"in window||navigator.userAgent.indexOf("Edge")>1,zc=/iPad/i.test(navigator.userAgent),jc=/Mac/i.test(navigator.userAgent),qc=Pc.isSupport(),Gc=Wc||!(qc&&!At("11.2.0"))&&!jc&&!zc,Kc=!1,Yc=navigator.userAgent.toLowerCase();/spider|googlebot|bingbot|robot/.test(Yc)&&(Kc=!0);var Xc,Qc,Jc="mango-player";return $e.setLevel("error"),[ma,Ta,sa,uc,Ra,Pa].forEach(function(t){return So.install(t)}),Xc="https://s1.hitv.com/libs/??vplayer/6.2.6/vplayer.css",(Qc=document.createElement("link")).rel="stylesheet",Qc.href=Xc,document.head.appendChild(Qc),function(t){i(r,t);var n=r.prototype;function r(e){var i;if(!p(e))throw new TypeError("You must pass an Object as config when you new MangoPlayer");if(!e.video_id)throw new TypeError("You must pass an video_id property in config when you new MangoPlayer");for(var n in $e.info(Jc,"player init."),e.isIpad=zc,e.listenGuestureEvents=zc,e.kernels=x(e.kernels||{},{hls:{debug:!1,handler:Pc},dash:{debug:!1,handler:Lc}}),(i=t.call(this,e)||this).isAutoplay=0,i.isContinuePlay=0,i.isLoopPlay=0,i.isSupportFlash=At("11.2.0"),i.isSupportHLS=window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),i._videoinfo=e.VIDEOINFO,i._injector=e.injector||{stk:window.STK,honey:window.H},e=i.config,i._config=e,i.config.useFlash=Gc,i.report=new ds({vm:i}),i.cms=new Mo({vm:i}),Vc)i[n]=Vc[n].bind(i);(function(t){for(var e=!1,i=0;i<Hc.length;i++)if(Hc[i]===t){e=!0;break}return e})(e.lobparam.cxid)||Kc?function(t){var e,i,n=ge(t._config.wrapper);t.cms.getVinfo(t._config.video_id).then(function(t){if(t&&t.data&&t.data.info){e=t.data.info.thumb,(i=document.createElement("div")).className="nonceWrapper";var r="<style>"+Bc+'</style>\n            <img style="" id="h5-show-dev-nonce" width="100%" height="100%" src="'+e+'">\n            <div class="u-icon u-icon-play">\n                <p class="btn"><a href="javascript:void(0);" title="播放">播放</a></p>\n            </div>';i.innerHTML=r;var o=n[0].firstChild;n[0].insertBefore(i,o),n.find("mango-center-state-splash").hide()}});var r=function(){n[0].removeChild(i),t.init(),de(n[0],"click",r)};ue(n[0],"click",r)}(i):i.init();var r=e.get("kernels.hls.p2p.enable",!1);return i.on("cmsData",function(t){"loadComplete"===t.status&&i.cms.ready(function(t){$e.info(Jc,"player is ready, cfg => "+JSON.stringify(t));var i=wt(t,"p2p.h5",!0),n=p(i)?a({enable:!0},i):{enable:!!i};n.enable=r&&n.enable,e.set({kernels:{hls:{p2p:n}}}),$e.info(Jc,"JIT hls-loader p2p settings => "+JSON.stringify(n))})}),i.ready.then(function(){e.plugin=e.plugin||e.plugins,d(e.plugin)||(e.plugin=[]);var t=[{text:"复制视频地址",action:"copyPlayerAddress"},{text:"复制当前时间的视频地址",action:"copyCurrentPlayerAddress"},{text:"播放器版本："+i.version,action:"showDebugPanel"},{text:"使用FLASH播放器",action:"switchToFlash"},{text:"使用HTML5播放器",action:"switchToHtml5"}],n=[sa.name,uc.name,Pa.name,{name:Ra.name,baseMenus:t}];zc||e.disableDanmuPlugin||n.unshift({name:Ta.name,mode:"css",updateByVideo:!0}),n.unshift(ma.name);var r=e.plugin.map(function(t){return p(t)?t.name:t});n.forEach(function(t){r.indexOf(t)>-1||e.plugin.push(t)}),i.addPlugins(e.plugin),i.config.useFlash&&!i.isSupportFlash&&i.emit("noFlashInstallException")}),i}return n.isSupportHls=function(){return Pc.isSupport()},e(r,null,[{key:"version",get:function(){return"6.2.6-eaa0bbd"}},{key:"pver",get:function(){return"imgotv-"+(Gc?"h5flash":zc?"padh5":"pch5")+"-"+this.version.split("-")[0]}},{key:"PopupFactory",get:function(){return aa}}]),n.init=function(){this.cms.init(this.config.video_id),this.detectMiniMode(),this.bindEvent(),$e.info(Jc,"player init end.")},n.bindEvent=function(){this.on("c_resize",this.detectMiniMode.bind(this)),this.on("feedbackClick",function(t){void 0===t&&(t={});try{FUN_VIDEO_FEEDBACK_POST&&FUN_VIDEO_FEEDBACK_POST(t.token)}catch(t){}})},n.detectMiniMode=function(){var t=this.__dispatcher.dom.wrapper;t.offsetWidth<600?se(t,"m-player-h5-mini"):ae(t,"m-player-h5-mini"),zc&&se(t,"m-player-h5-ipad")},n.playVideo=function(t){this.reload(t)},n.reload=function(t){this.config.video_id=t,this.updateLobParam(),this.cms.init(t),this.stopLoad(),this.pause(),this.emit("videoReload",{video_id:t}),$e.info(Jc,"reload new video ["+t+"]."),Gc=this.config.useFlash,this.config.useFlash&&!this.isSupportFlash&&this.emit("noFlashInstallException")},n.updateLobParam=function(){var t=wt(this._injector,"stk.$.getSessionStorage",Uc);this.config.lobparam=x(this.config.lobparam,{suuid:t("player_suuid")||"",ref:location.referrer||document.referrer})},n.getVideoInfo=function(){return this._videoinfo||window.VIDEOINFO||{}},n.updateVideoInfo=function(t){this._videoinfo=t},r}(So)});
/* b06f90d33fb2cd6258364e98f1bba53e */