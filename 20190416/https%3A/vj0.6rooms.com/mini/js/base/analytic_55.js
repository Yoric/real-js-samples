/*!
 * isVis - v0.5.5 Aug 2011 - Page Visibility API Polyfill
 * Copyright (c) 2011 Addy Osmani
 * Dual licensed under the MIT and GPL licenses.
 */
(function(){window.visibly={b:null,q:document,p:undefined,prefixes:["webkit","ms"],props:["VisibilityState","visibilitychange","Hidden"],m:["focus","blur"],visibleCallbacks:[],hiddenCallbacks:[],_callbacks:[],onVisible:function(a){this.visibleCallbacks.push(a)},onHidden:function(a){this.hiddenCallbacks.push(a)},isSupported:function(){return(this._supports(0)||this._supports(1))},_supports:function(a){return((this.prefixes[a]+this.props[2]) in this.q)},runCallbacks:function(a){if(a){this._callbacks=(a==1)?this.visibleCallbacks:this.hiddenCallbacks;for(var b=0;b<this._callbacks.length;b++){this._callbacks[b]()}}},_visible:function(){window.visibly.runCallbacks(1)},_hidden:function(){window.visibly.runCallbacks(2)},_nativeSwitch:function(){((this.q[this.b+this.props[2]])===true)?this._hidden():this._visible()},listen:function(){try{if(!(this.isSupported())){if(document.addEventListener){window.addEventListener(this.m[0],this._visible,1);window.addEventListener(this.m[1],this._hidden,1)}else{this.q.attachEvent("onfocusin",this._visible);this.q.attachEvent("onfocusout",this._hidden)}}else{this.b=(this._supports(0)==this.p)?this.prefixes[1]:this.prefixes[0];this.q.addEventListener(this.b+this.props[1],function(){window.visibly._nativeSwitch.apply(window.visibly,arguments)},1)}}catch(a){}},init:function(){this.listen()}};this.visibly.init()})();(function(){var doc=document;var loc=window.location;var navigator=window.navigator;var screen=window.screen;var userAgent=navigator.userAgent;var isIE=/MSIE|Edge|Trident/i.test(userAgent);var isMobile=/Android|webOS|iPhone|iPad|iPod|BB10|IEMobile/i.test(userAgent);var LANCE_API="//shrek.6.cn/live.6.cn/e6u2/rp.php";var LANCE_CALLBACK=(new Date().getTime()).toString(36);var ZHANG_ZHI_API="//sclick.6rooms.com/s.html";var ZHANG_ZHI_QUERY_NAME="_tra_";var ZHANG_ZHI_COOKIE_NAME="_tracing";var ZHANG_ZHI_COOKIE_DOMAIN=isIE?"":"6.cn";var via=window.via=window.via||{};via._h=via._h||[];via.uuid="";via.ready=function(handler){this._h.push(handler);if(this.uuid){this.triggerReady()}};via.triggerReady=function(){var handlerList=this._h;var handler;while(handler=handlerList.shift()){handler.apply(null,[this.uuid,identifyPageName()])}};var cookie={_createCookieString:function(name,value,options){var text=name+"="+encodeURIComponent(value);var options=options||{};var expires=options.expires;var domain=options.domain;var path=options.path||"/";if(expires instanceof Date){text+=";expires="+expires.toUTCString()}if(domain){text+=";domain="+domain}if(path){text+=";path="+path}if(options.secure===true){text+=";secure"}return text},_parseCookieString:function(text){if(!text){return null}var cookies={};var cookiePark=text.split(/;\s/g);var cookieNameValue;for(var i=0;i<cookiePark.length;i++){cookieNameValue=cookiePark[i].split("=");cookies[cookieNameValue[0]]=decodeURIComponent(cookieNameValue[1])}return cookies},get:function(name){var cookies=this._parseCookieString(doc.cookie);if(cookies&&cookies[name]!==undefined){return cookies[name]}return null},set:function(name,value,options){var text=this._createCookieString(name,value,options);doc.cookie=text},remove:function(name,options){options=options||{};options.expires=new Date(0);doc.cookie=this._createCookieString(name,"",options)}};var getFlashVersion=function(){var result="-";if(navigator.plugins&&navigator.plugins.length){for(var c=0;c<navigator.plugins.length;c++){if(navigator.plugins[c].name.indexOf("Shockwave Flash")>-1){result=navigator.plugins[c].description.split("Shockwave Flash ")[1];break}}}else{if(window.ActiveXObject){for(var c=10;c>=2;c--){try{if(eval("new ActiveXObject('ShockwaveFlash.ShockwaveFlash."+c+"');")){result=c+".0";break}}catch(d){}}}}return result};var stripProtocal=function(url){return encodeURIComponent(url.replace(/^https?\:\/\//,""))};var getUid=function(){var result="0";var vinfo=cookie.get("_vinfo");var coin6=cookie.get("_coin6");var ticket=cookie.get("ticket_v");if(ticket&&vinfo&&vinfo!="deleted"){result=coin6.split(":")[0]}return result};var insertScript=function(url){var script=document.createElement("script");var head=document.getElementsByTagName("head")[0];script.type="text/javascript";script.src=url;head.insertBefore(script,head.firstChild)};var toLance=function(){insertScript(LANCE_API+"?location="+stripProtocal(loc.href)+"&referer="+stripProtocal(document.referrer||"")+"&browser="+encodeURIComponent(userAgent.toLowerCase())+"&flash="+encodeURIComponent(getFlashVersion())+"&msr="+encodeURIComponent(screen.width+","+screen.height)+"&uid="+getUid()+"&pro=4&stamp="+(new Date().getTime())+"&callback="+LANCE_CALLBACK)};var identifyPageName=function(){var pathname=loc.pathname;var result="";if(pathname=="/"){result=window.VIA_PAGEID||"index"}else{if(/^\/\d+$/.test(pathname)){result="room";if(window.page){if(page.tpl=="voice2018"){result="room_voice"}else{if(page.tpl=="voice_personal"){result="room_voice_personal"}else{result="room"}}}}else{if(/^\/f\/\d+$/.test(pathname)){result="room_family"}else{if(/^\/f\/p\/\d+\.html$/.test(pathname)){result="family_index"}else{if(/^\/a\/\d+$/.test(pathname)){result="army_index"}else{if(/^\/video\/\d+\.html$/.test(pathname)){result="video_play"}else{result=pathname}}}}}}return result};var identifyPageId=function(pageName){var url=loc.href;var pathname=loc.pathname;var reg=[];var result="";if(pageName=="room"||pageName=="room_family"||pageName=="army_index"||pageName=="room_voice"||pageName=="room_voice_personal"){result=(window.page&&page.rid)?page.rid:""}else{if(pageName=="family_index"){result=(window.PAGE_ENV&&PAGE_ENV.fuid)?PAGE_ENV.fuid:""}else{if(pageName=="video_play"){reg=pathname.match(/^\/video\/(\d+)\.html$/);result=reg[1]}else{if(url.indexOf("/yuliao/profile.php")>-1){reg=url.match(/sid=(\d+)/);result=reg[1]}else{result=""}}}}return result};var identifyClickTarget=function(target){var event="click";var mod="noname";var url="";var recid=window.ZHANG_ZHI_RECID||"";var topageid="";var parentAnchor=null;while(target&&target.parentNode){if(target.tagName.toLowerCase()=="a"){var href=target.getAttribute("href");if(href&&href.indexOf("#")<0){event="in";url=href;parentAnchor=target;var reg=href.match(/\/(\d+)\/?/)||[];topageid=reg[1]||""}}var dataRecid;if((dataRecid=target.getAttribute("data-recid"))){recid=dataRecid}var dataTracing;if((dataTracing=target.getAttribute("data-tracing"))){mod=dataTracing;target=null}else{target=target.parentNode}}return{event:event,mod:mod,url:url,recid:recid,topageid:topageid,parentAnchor:parentAnchor}};var makeTracingCode=function(pageName,mdouleId){return pageName+"-"+mdouleId};var toZhangZhi=function(event,mod,url,recid,topageid){var resolution=encodeURIComponent(screen.width+"/"+screen.height);var userInfo=(typeof pageMessage=="object"&&pageMessage.user&&pageMessage.user.uid)?('{"uid":'+pageMessage.user.uid+',"coinrank":'+pageMessage.user.rich+',"wealthrank":'+pageMessage.user.star+"}"):"";var param="uuid="+(pageMessage._uuid||"")+"&reft="+(pageMessage._reft||0)+"&event="+event+"&page="+pageMessage._page+"&pageid="+pageMessage._pageid+"&data="+encodeURIComponent(userInfo)+"&module="+(mod||"")+"&from_module="+(pageMessage._tracing||"")+"&recid="+(recid||window.ZHANG_ZHI_RECID||"")+"&watchid="+(pageMessage._watchid||"")+"&platform="+pageMessage._platform+"&ver="+encodeURIComponent(pageMessage._ver||"");if(event=="in"){param=param+"&topageid="+(topageid||"")+"&url="+encodeURIComponent(url||"")}if(event=="load"){param=param+"&from_pageid="+(pageMessage._from_pageid||"")+"&from_recid="+(pageMessage._from_recid||"")+"&resolution="+resolution+"&url="+encodeURIComponent(url||"")+"&reffer="+encodeURIComponent(document.referrer)}new Image().src=ZHANG_ZHI_API+"?"+param;if(event=="in"){if(url&&(url.indexOf("payshow.php")>-1||url.indexOf("ylPayShow.php")>-1)){cookie.set("pay_tracing",pageMessage._page+"|"+pageMessage._pageid+"|"+(pageMessage._tracing||"")+"|"+(mod||"")+"|"+pageMessage._watchid,{domain:ZHANG_ZHI_COOKIE_DOMAIN})}else{cookie.set(ZHANG_ZHI_COOKIE_NAME,makeTracingCode(pageMessage._page,mod)+"|"+(pageMessage._pageid||"")+"|"+(recid||""),{domain:ZHANG_ZHI_COOKIE_DOMAIN})}}};var establishZhangZhiAnalytic=function(uuid,reft){if(typeof JSF=="object"&&JSF.jq&&JSF.login){$LAB.script(JSF.jq,JSF.login).wait(function(){pageMessage._uuid=uuid;pageMessage._reft=reft;pageMessage._watchid=new Date().getTime();pageMessage._page=identifyPageName();pageMessage._pageid=identifyPageId(pageMessage._page);pageMessage._platform="web";pageMessage._ver="1.3";var $=jQuery;var pageName=pageMessage._page;if(pageName=="index"){window.inRoomClick=function(url,tracing){url=decodeURIComponent(url);var recid="";var pattern=/recid\=([^\&\#]+)(?:\&|$|\#)/;var match=pattern.exec(url);var recid=match&&match[1]||"";toZhangZhi("in",tracing||"ipvafi4f",url,recid)}}else{if(pageName=="room"){var count=0;var accumulator=0;var setTimeoutTime=0;var beatPaused=true;var timer=null;var getInterval=function(){var result=60;if(count<3){result=5}else{if(count<6){result=10}else{if(count<9){result=30}}}return result};var prepareNextBeat=function(){cancelNextBeat();setTimeoutTime=(new Date()).getTime();timer=setTimeout(heartBeat,getInterval()*1000)};var cancelNextBeat=function(){clearTimeout(timer)};var startHeartBeat=function(){if(beatPaused){prepareNextBeat();beatPaused=false}};var pauseHeartBeat=function(){if(!beatPaused){cancelNextBeat();reportHeartBeat();beatPaused=true}};var reportHeartBeat=function(){var userInfo=(typeof pageMessage=="object"&&pageMessage.user&&pageMessage.user.uid)?('{"uid":'+pageMessage.user.uid+',"coinrank":'+pageMessage.user.rich+',"wealthrank":'+pageMessage.user.star+"}"):"";var now=(new Date()).getTime();var durationFromLast=Math.round((Math.min(now-setTimeoutTime,60*1000))/1000);var lookType=0;var param;accumulator+=durationFromLast;if(window.page&&page.liveType/1){lookType=page.liveVideo/1?2:1}param="?uuid="+pageMessage._uuid+"&event=loop&reft="+(pageMessage._reft||0)+"&page="+pageName+"&pageid="+pageMessage._pageid+"&data="+encodeURIComponent(userInfo)+"&from_module="+pageMessage._tracing+"&tm="+durationFromLast+"&looktm="+accumulator+"&lookType="+lookType+"&watchid="+pageMessage._watchid+"&platform="+pageMessage._platform+"&ver="+encodeURIComponent(pageMessage._ver);if(durationFromLast>3){(new Image()).src=ZHANG_ZHI_API+param}};var heartBeat=function(){count++;reportHeartBeat();prepareNextBeat()};var mouseoverHandler=function(event){startHeartBeat();$(document).off("mouseover",mouseoverHandler)};var detectAction=function(){$(document).on("mouseover",mouseoverHandler);pauseHeartBeat();setTimeout(detectAction,15*60*1000)};startHeartBeat();visibly.onVisible(startHeartBeat);visibly.onHidden(pauseHeartBeat);setTimeout(detectAction,15*60*1000);window.__kekeRocket=function(url){toZhangZhi("in","iqrfeduc","https://v.6.cn"+url)}}}if(pageName=="index"||pageName=="room"){$(document).on("click",function(event){if(event.originalEvent){var target=event.target;var identity=identifyClickTarget(target);if(identity.event=="in"){toZhangZhi(identity.event,identity.mod,identity.url,identity.recid,identity.topageid)}else{if(identity.mod){toZhangZhi(identity.event,identity.mod,identity.url,identity.recid)}}if(isIE&&identity.event=="in"&&loc.hostname=="www.6.cn"&&identity.url.indexOf(ZHANG_ZHI_QUERY_NAME)<0&&identity.parentAnchor){var tracingCode=makeTracingCode(pageName,identity.mod)+"|"+(pageMessage._pageid||"")+"|"+(identity.recid||"");var url=identity.url;var explodeByHash=url.split("#");var hash=explodeByHash[1]?"#"+explodeByHash[1]:"";var urlWithoutHash=explodeByHash[0];url+=(urlWithoutHash.indexOf("?")>-1?"&":"?")+ZHANG_ZHI_QUERY_NAME+"="+tracingCode+hash;identity.parentAnchor.href=url}}})}else{$(document).on("click",function(event){if(event.originalEvent){var target=event.target;var identity=identifyClickTarget(target);if(identity.event=="in"){toZhangZhi(identity.event,identity.mod,identity.url,identity.recid,identity.topageid)}}})}if(loc.search.indexOf(ZHANG_ZHI_QUERY_NAME+"=")>-1){var pattern=new RegExp(ZHANG_ZHI_QUERY_NAME+"\\=(.*)(?:$|\\&)");var matchObj=pattern.exec(loc.search);var tracingCookie=matchObj?matchObj[1].split("|"):[];pageMessage._tracing=tracingCookie[0]||"";pageMessage._from_pageid=tracingCookie[1]||"";pageMessage._from_recid=tracingCookie[2]||""}else{var tracingCookie=(cookie.get(ZHANG_ZHI_COOKIE_NAME)||"").split("|");pageMessage._tracing=tracingCookie[0]||"";pageMessage._from_pageid=tracingCookie[1]||"";pageMessage._from_recid=tracingCookie[2]||""}cookie.remove(ZHANG_ZHI_COOKIE_NAME,{domain:ZHANG_ZHI_COOKIE_DOMAIN});if(loc.search.indexOf(ZHANG_ZHI_QUERY_NAME+"=")==-1){$(window).on("beforeunload",function(){if(!cookie.get(ZHANG_ZHI_COOKIE_NAME)&&pageMessage._tracing){cookie.set(ZHANG_ZHI_COOKIE_NAME,pageMessage._tracing+"|"+pageMessage._from_pageid+"|"+pageMessage._from_recid,{domain:ZHANG_ZHI_COOKIE_DOMAIN})}})}toZhangZhi("load","",loc.href)})}};window[LANCE_CALLBACK]=function(data){cookie.set("shrek_uuid",data.u||"",{expires:new Date(new Date().getTime()+30*24*60*60*1000)});var _reft=data.r||0,_reftCK=cookie.get("shrek_reft");if(_reftCK){_reftCK=_reftCK.split("|");if(_reftCK[1]==data.t){_reft=_reftCK[0]}}cookie.set("shrek_reft",_reft+"|"+data.t,{expires:new Date(new Date().getTime()+30*24*60*60*1000)});if(isMobile&&data.u&&data.t){cookie.set("shrek",data.u+"|"+data.t,{domain:"6.cn"})}via.uuid=data.u||"";via.triggerReady();establishZhangZhiAnalytic(data.u||"",_reft);if(data.o){cookie.set("_apkReft",data.o,{path:"/event/liveClient"})}};toLance()})();