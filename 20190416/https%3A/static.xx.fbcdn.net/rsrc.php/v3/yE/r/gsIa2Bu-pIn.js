if (self.CavalryLogger) { CavalryLogger.start_js(["9Lx6I"]); }

__d("CameraPostDirectMarkSeenMutationWebGraphQLMutation",["WebGraphQLMutationBase"],(function(a,b,c,d,e,f){"use strict";__p&&__p();e.exports=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}b.__getDocID=function(){return"1644150182303893"};b.getQueryID=function(){return"171816796723339"};return b}(b("WebGraphQLMutationBase"))}),null);
__d("CameraPostLoggingEvents",[],(function(a,b,c,d,e,f){"use strict";e.exports={SEND_REPLY_ATTEMPT:"send_direct_reply_attempted",SEND_REPLY_SUCCESS:"send_direct_reply_success",SEND_REPLY_FAILURE:"send_direct_reply_failure",THREAD_VIEWED:"view",THREAD_MARK_SEEN_ATTEMPT:"mark_thread_seen_attempted",THREAD_MARK_SEEN_SUCCESS:"mark_thread_seen_success",THREAD_MARK_SEEN_FAILURE:"mark_thread_seen_failure",DIRECT_VIEWER_CLICKOUT:"clickout"}}),null);
__d("CameraPostQueryWebGraphQLQuery",["WebGraphQLQueryBase"],(function(a,b,c,d,e,f){"use strict";__p&&__p();e.exports=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}b.__getDocID=function(){return"2217242731640138"};b.getQueryID=function(){return"2218304265112137"};return b}(b("WebGraphQLQueryBase"))}),null);
__d("CameraPostRepliesQueryWebGraphQLQuery",["WebGraphQLQueryBase"],(function(a,b,c,d,e,f){"use strict";__p&&__p();e.exports=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}b.__getDocID=function(){return"1494166853955273"};b.getQueryID=function(){return"1468697053209427"};return b}(b("WebGraphQLQueryBase"))}),null);
__d("CameraPostReplyMutationWebGraphQLMutation",["WebGraphQLMutationBase"],(function(a,b,c,d,e,f){"use strict";__p&&__p();e.exports=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}b.__getDocID=function(){return"1459763854077111"};b.getQueryID=function(){return"1849675045338105"};return b}(b("WebGraphQLMutationBase"))}),null);
__d("CameraPostUserQueryWebGraphQLQuery",["WebGraphQLQueryBase"],(function(a,b,c,d,e,f){"use strict";__p&&__p();e.exports=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}b.__getDocID=function(){return"1652248708148952"};b.getQueryID=function(){return"143159039576179"};return b}(b("WebGraphQLQueryBase"))}),null);
__d("CameraPostGraphQLAPI",["Banzai","CameraPostDirectMarkSeenMutationWebGraphQLMutation","CameraPostLoggingEvents","CameraPostQueryWebGraphQLQuery","CameraPostRepliesQueryWebGraphQLQuery","CameraPostReplyMutationWebGraphQLMutation","CameraPostUserQueryWebGraphQLQuery","DirectMessagingTypedLogger","FBStoriesLoggingConstants","WebGraphQL","uuid"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=function(a,c,d,e,f,g,h){__p&&__p();var i=new(b("DirectMessagingTypedLogger"))().setCameraPostType(c).setProductSurface("www").setName(e).setCardID(a.toString());if(d.message){var j=d.message.length;i.setMessageLength(j)}h&&i.setReplyType(h);d.sticker_id&&i.addToExtraData("sticker_id",d.sticker_id);d.gif_url&&i.addToExtraData("gif_url",d.gif_url);i.log();b("Banzai").post("stories_interaction_poseidon_logging_banzai",{name:e,thread_id:String(a)});var k={};k.is_fb_story=!0;k.thread_id=a;k.camera_post_type=c;k.attempt_name=e;k.event=b("FBStoriesLoggingConstants").ACTION_SEND_REPLY_ATTEMPT;return b("WebGraphQL").exec(new(b("CameraPostReplyMutationWebGraphQLMutation"))({input:d})).then(function(e){var d=new(b("DirectMessagingTypedLogger"))().setCameraPostType(c).setProductSurface("www").setName(f).setCardID(a.toString());h&&d.setReplyType(h);d.log();k.success_name=f;b("Banzai").post("fb_stories_banzai_generic",{ft:k});return e},function(e){var d=new(b("DirectMessagingTypedLogger"))().setCameraPostType(c).setProductSurface("www").setName(g).setCardID(a.toString());h&&d.setReplyType(h);d.log();k.failure_name=g;b("Banzai").post("fb_stories_banzai_generic",{ft:k});return e})};e.exports={sendDirectMessageReply:function(a,c,d,e,f){var h=b("uuid")();h={client_mutation_id:h,actor_id:a,thread_id:c,message:d};f?(a=b("FBStoriesLoggingConstants").ACTION_SEND_REPLY_ATTEMPT,d=b("FBStoriesLoggingConstants").ACTION_SEND_REPLY_SUCCESS,f=b("FBStoriesLoggingConstants").ACTION_SEND_REPLY_FAILURE):(a=b("CameraPostLoggingEvents").SEND_REPLY_ATTEMPT,d=b("CameraPostLoggingEvents").SEND_REPLY_SUCCESS,f=b("CameraPostLoggingEvents").SEND_REPLY_FAILURE);return g(c,e,h,a,d,f)},sendDirectStickerReply:function(a,c,d,e){var f=b("uuid")();f={client_mutation_id:f,actor_id:a,thread_id:c,sticker_id:e};return g(c,d,f,b("FBStoriesLoggingConstants").ACTION_SEND_STICKER_ATTEMPT,b("FBStoriesLoggingConstants").ACTION_SEND_STICKER_SUCCESS,b("FBStoriesLoggingConstants").ACTION_SEND_STICKER_FAILURE)},sendDirectGifReply:function(a,c,d,e){var f=b("uuid")();f={client_mutation_id:f,actor_id:a,thread_id:c,gif_url:e};return g(c,d,f,b("FBStoriesLoggingConstants").ACTION_SEND_GIF_ATTEMPT,b("FBStoriesLoggingConstants").ACTION_SEND_GIF_SUCCESS,b("FBStoriesLoggingConstants").ACTION_SEND_GIF_FAILURE)},sendLightweightReactionReply:function(a,c,d,e,f){var h="LIGHT_WEIGHT";a={client_mutation_id:b("uuid")(),actor_id:a,thread_id:c,message:e,story_reply_type:h,is_lightweight_reaction:!0,lightweight_reaction_actions:{reaction:e,offsets:[f||0]}};return g(c,d,a,b("FBStoriesLoggingConstants").ACTION_SEND_REACTION_ATTEMPT,b("FBStoriesLoggingConstants").ACTION_SEND_REACTION_SUCCESS,b("FBStoriesLoggingConstants").ACTION_SEND_REACTION_FAILURE,"light_weight")},loadThreadFullInformation:function(a,c){return b("WebGraphQL").exec(new(b("CameraPostQueryWebGraphQLQuery"))({thread_id:c})).then(function(a){var d;d=(d=a)!=null?(d=d.node)!=null?d.camera_post_type:d:d;new(b("DirectMessagingTypedLogger"))().setCameraPostType(d).setName(b("CameraPostLoggingEvents").THREAD_VIEWED).setProductSurface("www").setCardID(c.toString()).log();return a},function(a){return a})},loadUserInfo:function(){return b("WebGraphQL").exec(new(b("CameraPostUserQueryWebGraphQLQuery"))())},loadRepliesForThread:function(a){return b("WebGraphQL").exec(new(b("CameraPostRepliesQueryWebGraphQLQuery"))({thread_id:a}))},markThreadSeen:function(a,c,d,e,f){__p&&__p();var g={};f?g={client_mutation_id:b("uuid")(),actor_id:a,story_id:f,last_message_seen_id:d}:g={client_mutation_id:b("uuid")(),actor_id:a,thread_id:c,last_message_seen_id:d};f=new(b("DirectMessagingTypedLogger"))().setCameraPostType(e).setName(b("CameraPostLoggingEvents").THREAD_MARK_SEEN_ATTEMPT).setProductSurface("www").setCardID(c.toString());f.log();var h={};h.is_fb_story=!0;h.camera_post_type=e;h.event=b("CameraPostLoggingEvents").THREAD_MARK_SEEN_ATTEMPT;h.thread_id=c;h.latest_message_id=d;return b("WebGraphQL").exec(new(b("CameraPostDirectMarkSeenMutationWebGraphQLMutation"))({input:g})).then(function(a){new(b("DirectMessagingTypedLogger"))().setCameraPostType(e).setProductSurface("www").setName(b("CameraPostLoggingEvents").THREAD_MARK_SEEN_SUCCESS).setCardID(c.toString()).log();h.sucess_name=b("CameraPostLoggingEvents").THREAD_MARK_SEEN_SUCCESS;b("Banzai").post("fb_stories_banzai_generic",{ft:h});return a},function(a){new(b("DirectMessagingTypedLogger"))().setCameraPostType(e).setProductSurface("www").setName(b("CameraPostLoggingEvents").THREAD_MARK_SEEN_FAILURE).setCardID(c.toString()).log();h.failur_name=b("CameraPostLoggingEvents").THREAD_MARK_SEEN_FAILURE;b("Banzai").post("fb_stories_banzai_generic",{ft:h});return a})},_getLogger:function(){return new(b("DirectMessagingTypedLogger"))()}}}),null);
__d("CameraPostBucketOwnerHelper",["CurrentUser","GroupPurposes"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g={getId:function(a){return((a=a)!=null?a.id:a)||""},getName:function(a){return((a=a)!=null?a.name:a)||""},getGender:function(a){return!a?"":a.gender?a.gender:""},isEventHost:function(a){if(!a)return!1;var b=a.event_hosts&&a.event_hosts.edges.some(function(a){return g.isEventHostPageAdmin(a.node)});return!!(a.is_viewer_host||b)},isEventHostPageAdmin:function(a){a=a.page_admin_users;if(!a)return!1;var c=b("CurrentUser").getID();return a.edges.some(function(a){return a.node.id===c})},isViewerFriend:function(a){return!a?!1:a.is_viewer_friend?!!a.is_viewer_friend:!1},isEmployee:function(a){return!a?!1:a.is_employee?!!a.is_employee:!1},getProfilePictureUri:function(a){return!a||!a.profile_picture?"":a.profile_picture.uri||""},getCoverPhotoUri:function(a){return!a||!a.cover_photo?"":((a=a)!=null?(a=a.cover_photo)!=null?(a=a.photo)!=null?(a=a.image)!=null?a.uri:a:a:a:a)||""},isViewerPageContentAdmin:function(a){a=g._getViewerProfilePermissions(a);return a&&a.includes("EDIT_PROFILE")||!1},isViewerGroupModerator:function(a){a=g._getViewerAdminType(a);return a==="MODERATOR"},isViewerGroupAdmin:function(a){a=g._getViewerAdminType(a);return a==="ADMIN"},isViewerGroupMember:function(a){return!a||!a.is_viewer_member?!1:a.is_viewer_member},_getViewerProfilePermissions:function(a){return!a||!a.viewer_profile_permissions?null:((a=a)!=null?a.viewer_profile_permissions:a)||null},_getViewerAdminType:function(a){return!a||!a.viewer_admin_type?null:((a=a)!=null?a.viewer_admin_type:a)||null},requiresAdminApproval:function(a){return!a?!1:a.story_approval_required&&!!a.story_approval_required||(a.stories_admin_approval_required_setting?a.stories_admin_approval_required_setting==="ON":!1)},isGroupAdmin:function(a,b){if(!a||!a.group_admin_profiles)return!1;a=((a=a)!=null?(a=a.group_admin_profiles)!=null?a.edges:a:a)||[];a=g._getIdsFromEdges(a);a=new Set(a);return a.has(b)},isGroupMember:function(a,b){b=(b=b.groups)==null?void 0:b.edges;if(b==null)return!1;b=new Set(b.map(function(a){return(a=a.node)==null?void 0:a.id}));return b.has(a.id)},isBuySellGroup:function(a){if(!a||!a.group_purposes)return!1;a=a.group_purposes.edges.map(function(a){return a.node.purpose_enum});return a.includes(b("GroupPurposes").FOR_SALE.toUpperCase())},isMutedFromGroup:function(a,b){if(!a||!a.group_muted_members)return!1;a=a.group_muted_members.edges;return g._getIdsFromEdges(a).includes(b)},setIsMutedFromGroup:function(a,b,c){if(!a||!a.group_muted_members)return;var d=a.group_muted_members.edges,e=g.isMutedFromGroup(a,b);c!==e&&(c?d.push({node:{id:b}}):a.group_muted_members={edges:d.filter(function(a){a.node.id!==b})})},_getIdsFromEdges:function(a){return a.map(function(a){return a.node.id})}};e.exports=g}),null);
__d("CameraPostMediaHelper",["gkx"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g={getId:function(a){return((a=a)!=null?a.id:a)||""},getWidth:function(a){if(!a)return 0;if(a.width)return a.width;return a.image?a.image.width||0:0},getHeight:function(a){if(!a)return 0;if(a.height)return a.height;return a.image?a.image.height||0:0},getType:function(a){return((a=a)!=null?a.__typename:a)||""},getImageUri:function(a){return!a?null:a.image?a.image.uri:null},getBlurImageUri:function(a){return!a?null:a.image_blurred?a.image_blurred.uri:null},isSphericalPhoto:function(a){return!a?!1:a.photo_encodings?a.photo_encodings.length>0:!1},isImage:function(a){return g.getType(a)==="Photo"},isVideo:function(a){return g.getType(a)==="Video"},getPreviewImage:function(a){return!a?null:a.preview_image?a.preview_image.uri:null},makeOptimisticPhotoMedia:function(a){return{id:null,message:null,__typename:"Photo",preview_image:{uri:a,width:null,height:null},image:{uri:a,width:null,height:null},image_blurred:{uri:a,width:null,height:null}}},hasObjectionableContent:function(a){__p&&__p();if(!b("gkx")("679612"))return!1;if(!a||!g.isImage(a)&&!g.isVideo(a))return!1;a=a.objectionable_content_info?a.objectionable_content_info:null;if(a){a=a.categories;return a&&a.length>0}return!1}};e.exports=g}),null);
__d("CameraPostThreadOwnerHelper",[],(function(a,b,c,d,e,f){"use strict";a={getId:function(a){return(a=a)!=null?a.id:a},getName:function(a){return((a=a)!=null?a.name:a)||""},getIsViewerFriend:function(a){return!!((a=a)!=null?a.is_viewer_friend:a)},getProfilePictureUri:function(a){return((a=a)!=null?(a=a.profile_picture)!=null?a.uri:a:a)||""}};e.exports=a}),null);
__d("CameraPostTypesHelper",["CameraPostTypes"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g={isEventStory:function(a){return a===b("CameraPostTypes").EVENT_STORY},isGroupStory:function(a){return a===b("CameraPostTypes").GROUP_STORY},isBirthdayStory:function(a){return a===b("CameraPostTypes").BIRTHDAY_STORY},isMultiAuthor:function(a){return g.isEventStory(a)||g.isGroupStory(a)||g.isBirthdayStory(a)},isPageStory:function(a){return a===b("CameraPostTypes").PAGE_STORY},isPromotionStory:function(a){return a===b("CameraPostTypes").PROMOTION_STORY},isStory:function(a){return a===b("CameraPostTypes").STORY},isStoryNux:function(a){return a===b("CameraPostTypes").STORY_NUX}};e.exports=g}),null);
__d("FBStoriesActionTypes",[],(function(a,b,c,d,e,f){a=Object.freeze({LOAD:"FB_STORIES.LOAD",LOADING:"FB_STORIES.LOADING",LOADED:"FB_STORIES.LOADED",LOADED_ERROR:"FB_STORIES.LOADED_ERROR",VIEWER_LIST_LOADED_FOR_THREAD:"FB_STORIES.VIEWER_LIST_LOADED_FOR_THREAD",RESET_LOCAL_SEEN_HISTORY:"FB_STORIES.RESET_LOCAL_SEEN_HISTORY",SELECTED_BUCKET_IDX_CHANGED:"FB_STORIES.SELECTED_BUCKET_IDX_CHANGED",SET_ALL_BUCKETS_VIEWED:"FB_STORIES.SET_ALL_BUCKETS_VIEWED",SET_UNSEEN_MODE:"FB_STORIES.SET_UNSEEN_MODE",SELECTED_THREAD_IDX_CHANGED:"FB_STORIES.SELECTED_THREAD_IDX_CHANGED",SELECTED_THREAD_PERCENT_DONE:"FB_STORIES.SELECTED_THREAD_PERCENT_DONE",SUBSCRIPTION_BUCKET_UPDATE:"FB_STORIES.SUBSCRIPTION_BUCKET_UPDATE",UPDATE_THREAD_SEEN_OPTIMISTIC:"FB_STORIES.UPDATE_THREAD_SEEN_OPTIMISTIC",UPDATE_THREAD_VIEWERS_SEEN_OPTIMISTIC:"FB_STORIES.UPDATE_THREAD_VIEWERS_SEEN_OPTIMISTIC",DELETE_THREAD_FROM_BUCKET:"FB_STORIES.DELETE_THREAD_FROM_BUCKET",REMOVE_BUCKET:"FB_STORIES.REMOVE_BUCKET",REMOVE_ENDED_LIVE_VIDEO_FROM_BUCKET:"FB_STORIES.REMOVE_ENDED_LIVE_VIDEO_FROM_BUCKET",SET_IS_COMMERCIAL_BREAK_RUNNING:"FB_STORIES.SET_IS_COMMERCIAL_BREAK_RUNNING",UNSELECT_BUCKET:"FBSTORIES.UNSELECT_BUCKET",SET_VIEWER_OPEN:"FB_STORIES.SET_VIEWER_OPEN",OPTIMISTIC_CREATE_PHOTO_STORY:"FB_STORIES.OPTIMISTIC_CREATE_PHOTO_STORY",SET_USER_BUCKET_UPLOAD_STATUS:"FB_STORIES.SET_USER_BUCKET_UPLOAD_STATUS",RESET_STATE:"FB_STORIES.RESET_STATE",SET_SUBSCRIPTION_TOKEN:"FB_STORIES.SET_SUBSCRIPTION_TOKEN",OPTIMISTIC_POLL_VOTE:"FB_STORIES.OPTIMISTIC_POLL_VOTE",TAP_ON_REACTION_STICKER:"FB_STORIES.TAP_ON_REACTION_STICKER",SET_IS_PRODUCTION_DIALOG_LOADING:"FB_STORIES.SET_IS_PRODUCTION_DIALOG_LOADING",APPROVE_PENDING_THREAD:"FB_STORIES.APPROVE_PENDING_THREAD"});e.exports=a}),null);
__d("FBStoriesDispatcher",["ExplicitRegistrationReactDispatcher"],(function(a,b,c,d,e,f){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(b){b=a.call(this,b)||this;babelHelpers.assertThisInitialized(b).dispatch=b.dispatch.bind(babelHelpers.assertThisInitialized(b));return b}return b}(b("ExplicitRegistrationReactDispatcher"));e.exports=new a({strict:!0})}),null);
__d("FBStoriesActions",["CameraPostBucketOwnerHelper","CameraPostGraphQLAPI","FBLogger","FBStoriesActionsHelper","FBStoriesActionTypes","FBStoriesDispatcher","FBStoriesGraphQLAPI","FBStoriesLoggingConstants","FBStoriesLoggingHelper","FBStoriesMutedBucketOwnersActions","FBStoriesPrefetcher","FBStoriesStore","promiseDone"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("FBStoriesDispatcher").dispatch,h={resetStore:function(){g({type:b("FBStoriesActionTypes").RESET_STATE})},loadData:function(a,c,d,e,f){g({type:b("FBStoriesActionTypes").LOADED,data:{userInfo:{userName:a,userID:c,userGender:null,userProfilePic:{uri:d}},userBucketData:null,friendsBucketData:f}})},nextThread:function(a){var c=b("FBStoriesStore").isSelectedBucketLive();if(c){h.nextBucket();return}c=b("FBStoriesStore").getThreadsForSelectedBucket();var d=b("FBStoriesStore").getCurrentThreadIndexForSelectedBucket();a=a!==void 0?a:d+1;c.length===0?h.nextBucket():a<=c.length-1?h.currentThreadIndexChanged(a):h.nextBucket()},prevThread:function(a){var c=b("FBStoriesStore").isSelectedBucketLive();if(c){h.prevBucket();return}c=b("FBStoriesStore").getThreadsForSelectedBucket();var d=b("FBStoriesStore").getCurrentThreadIndexForSelectedBucket();a=a!==void 0?a:d-1;c.length===0?h.prevBucket():a>=0?h.currentThreadIndexChanged(a,!0):h.prevBucket()},nextBucket:function(){return h._transitionBucket(!0)},prevBucket:function(){return h._transitionBucket(!1)},userSelectedBucket:function(a){__p&&__p();var c=b("FBStoriesStore").getBucketIndexByBucketId(a);if(c===-1)return!1;var d=b("FBStoriesStore").getUnseenThreadIndex(c),e=Math.max(0,d);a=b("FBStoriesStore").isOwnBucket(a);g({type:b("FBStoriesActionTypes").RESET_LOCAL_SEEN_HISTORY});g({type:b("FBStoriesActionTypes").SET_UNSEEN_MODE,value:!a&&d>=0});g({type:b("FBStoriesActionTypes").SET_ALL_BUCKETS_VIEWED,value:!1});g({type:b("FBStoriesActionTypes").SELECTED_BUCKET_IDX_CHANGED,bucketIndex:c});h.currentThreadIndexChanged(e);return!0},updateCurrentThreadPercentDone:function(a){g({type:b("FBStoriesActionTypes").SELECTED_THREAD_PERCENT_DONE,percentDone:a})},currentThreadIndexChanged:function(a,c){__p&&__p();c===void 0&&(c=!1);var d=b("FBStoriesStore").isOwnBucket();g({type:b("FBStoriesActionTypes").SELECTED_THREAD_IDX_CHANGED,index:a});h.updateCurrentThreadPercentDone(0);a=b("FBStoriesStore").getCurrentThreadData();if(a){if(d&&!a.isLive){var e=a.threadID;b("promiseDone")(b("FBStoriesGraphQLAPI").loadViewerListForThread(e),function(a){return g({type:b("FBStoriesActionTypes").VIEWER_LIST_LOADED_FOR_THREAD,threadID:e,data:a})},function(a){return b("FBLogger")("fbstories").catching(a).mustfix("Cannot load viewer list for thread: %s",e)})}h.markCurrentThreadAsSeen();b("FBStoriesPrefetcher").prefetchForCurrentThreadAndBucket()}else c?h.prevThread():h.nextThread()},markCurrentThreadAsSeen:function(){var a=b("FBStoriesStore").getUserInfo().userID,c=b("FBStoriesStore").getCurrentThreadData();if(!c||c.isLive)return;var d=c.latestMessageID,e=c.cameraPostType;c=c.threadID;g({type:b("FBStoriesActionTypes").UPDATE_THREAD_SEEN_OPTIMISTIC,bucketID:null,threadID:c});b("CameraPostGraphQLAPI").markThreadSeen(a,c,d,e)},markThreadViewersSeen:function(a){g({type:b("FBStoriesActionTypes").UPDATE_THREAD_VIEWERS_SEEN_OPTIMISTIC,threadID:a}),b("FBStoriesGraphQLAPI").updateThreadSeenReciept(a)},_transitionBucket:function(a,c){__p&&__p();c=c!==void 0?c:b("FBStoriesStore").getSelectedBucketIndex();c=b("FBStoriesActionsHelper").getNextBucketAndThreadIndex(c,a);var d=c.nextBucketIndex;c=c.nextThreadIndex;var e=b("FBStoriesActionsHelper").checkAllBucketsViewed(d);g({type:b("FBStoriesActionTypes").SET_ALL_BUCKETS_VIEWED,value:e});if(e)return void 0;h.removeEndedLiveVideo();g({type:b("FBStoriesActionTypes").SELECTED_BUCKET_IDX_CHANGED,bucketIndex:d});if(!b("FBStoriesStore").hasDataInSelectedBucket()&&!b("FBStoriesStore").isSelectedBucketLive())return a?h.nextBucket():h.prevBucket();h.currentThreadIndexChanged(c);b("FBStoriesLoggingHelper").storyLog(b("FBStoriesLoggingConstants").ACTION_OPEN_STORY);return void 0},deleteThreadFromBucket:function(a,c){if(!b("FBStoriesStore").isUserManagedThread(a,c))return;b("FBStoriesGraphQLAPI").deleteStory(b("FBStoriesStore").getUserInfo().userID,a);g({type:b("FBStoriesActionTypes").DELETE_THREAD_FROM_BUCKET,threadID:a,bucketID:c});h.nextThread(b("FBStoriesStore").getCurrentThreadIndexForSelectedBucket())},muteBucketOwner:function(a,c){b("FBStoriesMutedBucketOwnersActions").setBucketOwnerMuted(b("CameraPostBucketOwnerHelper").getId(a),b("CameraPostBucketOwnerHelper").getName(a),b("CameraPostBucketOwnerHelper").getProfilePictureUri(a),!0);if(!c)return;g({type:b("FBStoriesActionTypes").REMOVE_BUCKET,bucketID:c});h._transitionBucket(!0,b("FBStoriesStore").getSelectedBucketIndex()-1)},reportThreadToAdmin:function(a){b("FBStoriesGraphQLAPI").reportThreadToAdmin(b("FBStoriesStore").getUserInfo().userID,a)},takeNegativeFeedbackAction:function(a,c){b("FBStoriesGraphQLAPI").takeNegativeFeedbackAction(b("FBStoriesStore").getUserInfo().userID,a,c)},removeEndedLiveVideo:function(){if(!b("FBStoriesStore").isSelectedBucketLiveAndEnded())return;var a=b("FBStoriesStore").getSelectedBucketId();b("FBStoriesStore").getThreadsForSelectedBucket().length>0?g({type:b("FBStoriesActionTypes").REMOVE_ENDED_LIVE_VIDEO_FROM_BUCKET,bucketID:a}):g({type:b("FBStoriesActionTypes").REMOVE_BUCKET,bucketID:a})},setIsCommercialBreakRunning:function(a,c){g({type:b("FBStoriesActionTypes").SET_IS_COMMERCIAL_BREAK_RUNNING,isCommercialBreakRunning:c,videoID:a})},unselectBucket:function(){g({type:b("FBStoriesActionTypes").UNSELECT_BUCKET})},optimisticCreateStoryPhoto:function(a){if(!a)return;g({type:b("FBStoriesActionTypes").OPTIMISTIC_CREATE_PHOTO_STORY,imageURL:a})},setUserBucketUploadStatus:function(a){g({type:b("FBStoriesActionTypes").SET_USER_BUCKET_UPLOAD_STATUS,isUploading:a})},onPollOptionVoted:function(a,c){g({type:b("FBStoriesActionTypes").OPTIMISTIC_POLL_VOTE,index:c}),b("FBStoriesGraphQLAPI").pollVote(a,c)},onReactToSticker:function(a,c){g({type:b("FBStoriesActionTypes").TAP_ON_REACTION_STICKER,stickerID:a,count:c}),b("FBStoriesGraphQLAPI").reactToSticker(a,c)},setIsProductionDialogLoading:function(a){g({type:b("FBStoriesActionTypes").SET_IS_PRODUCTION_DIALOG_LOADING,value:a})},approvePendingThread:function(a,c){g({type:b("FBStoriesActionTypes").APPROVE_PENDING_THREAD,bucketID:a,threadID:c})}};e.exports=h}),null);
__d("FBStoriesReactionStickerConstants",[],(function(a,b,c,d,e,f){"use strict";a={WIDTH:150,HEIGHT:150};b=1e3;c=300;d="StoryOverlayReactionSticker";e.exports={DIMENSIONS:a,HOLD_DELAY:b,ANIMATIONS_INTERVAL_THROTTLE:c,StoryOverlayReactionSticker:d}}),null);
__d("FBStoriesStoryCardHelper",["CameraPostTypes","CurrentUser","NFXActionConst"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={getId:function(a){return((a=a)!=null?a.id:a)||""},getActor:function(a){a=(a=a)!=null?a.actors:a;return a?a[0]:null},getMedia:function(a){a=(a=a)!=null?a.attachments:a;return a?a[0].media:null},getActivityDescription:function(a){return(a=a)!=null?a.activity_description:a},getBackdropImage:function(a){a=(a=a)!=null?(a=a.backdrop)!=null?(a=a.media)!=null?(a=a.image)!=null?a.uri:a:a:a:a;return{image:{uri:a}}},getCameraPostSource:function(a){return((a=a)!=null?(a=a.story_card_info)!=null?(a=a.logging)!=null?a.source:a:a:a)||"CAMERA_SYSTEM"},getCameraPostType:function(a){return((a=a)!=null?(a=a.story_card_info)!=null?a.story_card_type:a:a)||b("CameraPostTypes").STORY},getDefaultBackground:function(a){return((a=a)!=null?a.story_default_background:a)||null},getExplicitPlace:function(a){return((a=a)!=null?a.explicit_place:a)||null},getInlineActivities:function(a){return((a=a)!=null?a.inline_activities:a)||null},getInstagramProfileURL:function(a){return((a=a)!=null?(a=a.story_card_info)!=null?a.instagram_profile_url:a:a)||null},getIsPlainText:function(a){return((a=a)!=null?(a=a.story_card_info)!=null?a.is_plain_text:a:a)||!1},isSeenByViewer:function(a){return!!((a=a)!=null?(a=a.story_card_seen_state)!=null?a.is_seen_by_viewer:a:a)},getMediaBackground:function(a){a=(a=a)!=null?(a=a.story_card_info)!=null?(a=a.background_color_info)!=null?a.color_info:a:a:a;return a?a[0]:null},getMessageText:function(a){return((a=a)!=null?(a=a.message)!=null?a.text:a:a)||""},getMessageRanges:function(a){return((a=a)!=null?(a=a.message)!=null?a.messageRanges:a:a)||null},getTextFormatMetadata:function(a){return((a=a)!=null?a.text_format_metadata:a)||null},getTime:function(a){a=((a=a)!=null?(a=a.story_card_info)!=null?a.local_creation_time:a:a)||"";return Date.parse(a)/1e3},getOriginalPostStoryAttribution:function(a){return((a=a)!=null?(a=a.story_card_info)!=null?a.shareable_attribution:a:a)||null},getWithTags:function(a){return((a=a)!=null?a.with_tags:a)||null},getNegativeFeedbackActions:function(a){var b=this;if(!a)return null;a=(a=a)!=null?(a=a.negative_feedback_actions)!=null?a.edges:a:a;return a?a.map(function(a){return a.node}).filter(function(a){return a&&b._shouldRenderNFXAction(a.negative_feedback_action_type)}):null},_shouldRenderNFXAction:function(a){switch(a){case b("NFXActionConst").UNTAG:case b("NFXActionConst").UNTAG_SPONSOR_PAGE:return!0;default:return!1}},isLandscape:function(a){var b;a=this.getMedia(a);return(a==null?void 0:(b=a.image)==null?void 0:b.height)<(a==null?void 0:(b=a.image)==null?void 0:b.width)},getStoryOverlays:function(a){return((a=a)!=null?a.story_overlays:a)||[]},getPoll:function(a){a=this.getStoryOverlays(a).find(function(a){return a.__typename==="StoryOverlayPollSticker"});return!a?null:(a=a)!=null?a.poll:a},getStoryViewerId:function(a){return(a=a)!=null?(a=a.node)!=null?a.id:a:a},getStoryViewerSeenTime:function(a){return((a=a)!=null?a.seen_time:a)||0},getSeenReceiptsLastSeenTime:function(a){return((a=a)!=null?(a=a.story_card_seen_state)!=null?a.seen_receipts_last_seen_time:a:a)||0},getNonFriendsSeenCount:function(a){return((a=a)!=null?(a=a.story_card_seen_state)!=null?(a=a.seen_receipent_seen_followers)!=null?a.count:a:a:a)||0},getfriendsSeenCount:function(a){return((a=a)!=null?(a=a.story_card_seen_state)!=null?(a=a.seen_receipent_seen_friends)!=null?a.count:a:a:a)||0},getThreadViewers:function(a,c){__p&&__p();var d=this,e={hasNewViewers:!1,hasNewFriendViewers:!1,hasNewConnectionsViewers:!1,friends:[],connections:[],totalCount:0,totalNew:0,nonFriendsCount:0};if(!c||!a)return e;var f=(c=a)!=null?c.isCardViewed:c;c=((c=a)!=null?(c=c.story_card_info)!=null?(c=c.story_viewers)!=null?c.edges:c:c:c)||[];var g=b("CurrentUser").getID();e=c.reduce(function(b,c){__p&&__p();var e=d.getStoryViewerId(c);if(!e)return b;if(e!==g){e=((e=c)!=null?(e=e.node)!=null?e.is_viewer_friend:e:e)||!1;var h=e?"friends":"connections",i=d.getStoryViewerSeenTime(c),j=d.getStoryViewerReactions(c),k=i>=d.getSeenReceiptsLastSeenTime(a);b[h].push(babelHelpers["extends"]({},c.node,{seenTime:i,isNewViewer:k,reactions:j}));b.totalNew+=k?1:0;b.hasNewViewers=(b.hasNewViewers||k)&&!f;b.hasNewFriendViewers=b.hasNewFriendViewers||k&&e;b.hasNewConnectionsViewers=b.hasNewViewers||k&&!e}return b},e);var h=this.getNonFriendsSeenCount(a);return Object.assign(e,{totalCount:h+c.length,nonFriendsCount:h})},getStoryViewerReactions:function(a){var b;a=((a=a)!=null?(a=a.feedback)!=null?a.lightweight_reactions:a:a)||[];a=a&&a.length>0?((b=a[0])!=null?(b=b.messaging_actions)!=null?b.nodes:b:b)||[]:[];return a.map(function(a){return a.reaction})},getAllowedNavigationType:function(a,b){var c=a===0;a=a===b-1;if(c)return"NEXT_ONLY";return a?"PREV_ONLY":"BOTH"},getCurrentCardData:function(a,b){var c=this.getActor(a),d=this.getTextFormatMetadata(a),e=null,f=null;d&&(e={body_style:d.font_style,preset_id:d.preset_id,text_input_style:d.text_input_style,swatch_style:{background_color:d.background_color,background_image:d.background_image}},f={portrait_background_image:d.portrait_background_image,portrait_keyframes_animation:d.portrait_keyframes_animation,inspirations_custom_font_object:d.inspirations_custom_font_object});d={id:c.id,name:c.name,short_name:c.short_name,gender:c.gender,is_viewer_friend:c.is_viewer_friend,profile_picture:c.profile_picture};return{activityDescription:this.getActivityDescription(a),backdropImage:this.getBackdropImage(a),bucketOwner:d,cameraPostSource:this.getCameraPostSource(a),cameraPostType:this.getCameraPostType(a),defaultBackground:this.getDefaultBackground(a),explicitLocation:this.getExplicitPlace(a),inlineActivities:this.getInlineActivities(a),instagramProfileURL:this.getInstagramProfileURL(a),isLive:!1,isPlainText:this.getIsPlainText(a),isSeen:this.isSeenByViewer(a),latestMessageID:null,linkAttachment:null,media:this.getMedia(a),mediaBackground:this.getMediaBackground(a),messageText:this.getMessageText(a),messageRanges:this.getMessageRanges(a),delightRanges:[],participants:[],textFormatMetadata:f,threadOwner:{name:c.name,id:c.id,is_viewer_friend:c.is_viewer_friend,profile_picture:c.profile_picture},time:this.getTime(a),threadID:b,originalPostStoryAttribution:this.getOriginalPostStoryAttribution(a),withTags:this.getWithTags(a),wwwTextFormatMetadata:e,negativeFeedbackActions:this.getNegativeFeedbackActions(a)}}};e.exports=a}),null);
__d("FBStoriesThreadHelper",["CameraPostMediaHelper","CameraPostThreadOwnerHelper","CameraPostTypes","FBLogger","FBStoriesReactionStickerConstants","FBStoriesStoryCardHelper"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g={getId:function(a){return((a=a)!=null?a.id:a)||""},getCameraPostType:function(a){return((a=a)!=null?a.camera_post_type:a)||b("CameraPostTypes").STORY},getCameraPostSource:function(a){return((a=a)!=null?a.post_source:a)||"CAMERA_SYSTEM"},isSeenByViewer:function(a){return!!((a=a)!=null?a.is_seen_by_viewer:a)},notSeenByViewer:function(a){return!g.isSeenByViewer(a)},setIsSeenByViewer:function(a,b){if(!a)return;a.is_seen_by_viewer=b},getLatestMessageID:function(a){return(a=a)!=null?(a=a.latest_message)!=null?a.id:a:a},getStatus:function(a){return(a=a)!=null?a.thread_status:a},isReviewStatusPending:function(a){a=g._getReviewStatus(a);return a==="PENDING"||a==="DENIED"},_getReviewStatus:function(a){return(a=a)!=null?a.thread_review_status:a},getTime:function(a){return((a=a)!=null?a.time:a)||0},getExpiryTime:function(a){return((a=a)!=null?a.thread_expiry_time:a)||0},isExpired:function(a){a=g.getExpiryTime(a);return!a?!1:a<Date.now()/1e3},isPending:function(a){return g.getStatus(a)==="PENDING"},isPublished:function(a){return g.getStatus(a)==="PUBLISHED"},getNonFriendsSeenCount:function(a){a=((a=a)!=null?a.non_friends_seen_count:a)||0;a<0&&b("FBLogger")("fbstories").mustfix("Non friend seen count should not be negative!");return a},setNonFriendsSeenCount:function(a,b){if(!a)return;a.non_friends_seen_count=b},getFriendsSeenCount:function(a){return((a=a)!=null?a.friends_seen_count:a)||0},setFriendsSeenCount:function(a,b){if(!a)return;a.friends_seen_count=b},getSeenCount:function(a){return g.getNonFriendsSeenCount(a)+g.getFriendsSeenCount(a)},getSeenReceiptsLastSeenTime:function(a){return((a=a)!=null?a.seen_receipts_last_seen_time:a)||0},setSeenReceiptsLastSeenTime:function(a,b){if(!a)return;a.seen_receipts_last_seen_time=b},getSeenReceiptsUnseenCount:function(a){return((a=a)!=null?a.seen_receipts_unseen_count:a)||0},doesThreadHasUnseenViewers:function(a){return!a?!1:g.getSeenReceiptsUnseenCount(a)>0||g.getSeenReceiptsFollowersUnseenCount(a)>0},getSeenReceiptsFollowersUnseenCount:function(a){return((a=a)!=null?a.seen_receipts_followers_unseen_count:a)||0},setSeenReceiptsUnseenCount:function(a,b){if(!a)return;a.seen_receipts_unseen_count=b},setSeenReceiptsFollowersUnseenCount:function(a,b){if(!a)return;a.seen_receipts_followers_unseen_count=b},getOwner:function(a){return(a=a)!=null?a.camera_post_thread_owner:a},getOwnerId:function(a){return b("CameraPostThreadOwnerHelper").getId(g.getOwner(a))},isViewerFriendOfOwner:function(a){return b("CameraPostThreadOwnerHelper").getIsViewerFriend(g.getOwner(a))},getViewers:function(a){return((a=a)!=null?(a=a.story_thread_viewers)!=null?a.edges:a:a)||[]},setViewers:function(a,b){if(!a)return;a.story_thread_viewers={edges:b}},getRootMessage:function(a){return(a=a)!=null?a.root_message:a},getStoryOverlays:function(a){return!a?[]:((a=g.getRootMessage(a))!=null?a.story_overlays:a)||[]},getReactionStickersReactors:function(a){__p&&__p();var c={};a=this.getStoryOverlays(a)||[];a.forEach(function(a){if(a.__typename===b("FBStoriesReactionStickerConstants").StoryOverlayReactionSticker){var d,e=(d=a)!=null?(d=d.reaction_sticker)!=null?d.id:d:d,f=(d=a)!=null?(d=d.reaction_sticker)!=null?(d=d.sticker_asset)!=null?d.image_asset_url:d:d:d;a=((d=a)!=null?(d=d.reaction_sticker)!=null?(d=d.sticker_reactions)!=null?d.nodes:d:d:d)||[];a.forEach(function(a){a=a.reactor.id;c[a]?c[a].push({stickerID:e,imgURL:f}):c[a]=[{stickerID:e,imgURL:f}]})}});return c},getPoll:function(a){a=this.getStoryOverlays(a).find(function(a){return a.__typename==="StoryOverlayPollSticker"});return!a?null:(a=a)!=null?a.poll:a},getMedia:function(a){return(a=g.getRootMessage(a))!=null?a.message_media:a},getMediaId:function(a){return b("CameraPostMediaHelper").getId(g.getMedia(a))},getMediaType:function(a){return b("CameraPostMediaHelper").getType(g.getMedia(a))},getMediaPreviewImage:function(a){return b("CameraPostMediaHelper").getPreviewImage(g.getMedia(a))},getWWWTextFormatMetadata:function(a){return((a=g.getRootMessage(a))!=null?a.www_text_format_metadata:a)||null},getIsPlainText:function(a){return((a=g.getRootMessage(a))!=null?a.is_plain_text:a)||!1},getTextFormatMetadata:function(a){return((a=g.getRootMessage(a))!=null?a.text_format_metadata:a)||null},getBackdropImage:function(a){return((a=g.getRootMessage(a))!=null?a.backdrop_image:a)||null},getMessageText:function(a){return((a=g.getRootMessage(a))!=null?a.message_text:a)||""},getMessageRanges:function(a){return((a=g.getRootMessage(a))!=null?a.message_ranges:a)||null},getDelightRanges:function(a){return((a=g.getRootMessage(a))!=null?a.delight_ranges:a)||[]},getActivityDescription:function(a){return!a?null:a.activity_description||null},getMediaBackground:function(a){if(!a)return null;a=(a=a.background_color_info)!=null?a.color_info:a;return a&&a.length>0?a[0]:null},getLinkAttachment:function(a){return!a?null:a.share_story_attachment||null},getWithTags:function(a){return!a?null:a.with_tags||null},getDefaultBackground:function(a){return!a?null:a.story_default_background||null},getExplicitLocation:function(a){return!a?null:a.explicit_place||null},getInlineActivities:function(a){return!a?null:a.inline_activities||null},getInstagramProfileURL:function(a){return((a=a)!=null?a.instagram_profile_url:a)||null},getOriginalPostStoryAttribution:function(a){return!a?null:((a=g.getRootMessage(a))!=null?a.original_post_story_attribution:a)||null},getNegativeFeedbackActions:function(a){return b("FBStoriesStoryCardHelper").getNegativeFeedbackActions(a)},getStoryViewerId:function(a){return(a=a)!=null?(a=a.node)!=null?a.id:a:a},getStoryViewerSeenTime:function(a){return((a=a)!=null?a.seen_time:a)||0},getStoryViewerReactions:function(a){var b;a=((a=a)!=null?(a=a.feedback)!=null?a.lightweight_reactions:a:a)||[];a=a&&a.length>0?((b=a[0])!=null?(b=b.messaging_actions)!=null?b.nodes:b:b)||[]:[];return a.map(function(a){return a.reaction})},makeOptimisticPhotoThread:function(a){var c=this._getDefaultThread();a=b("CameraPostMediaHelper").makeOptimisticPhotoMedia(a);return babelHelpers["extends"]({},c,{is_seen_by_viewer:!1,root_message:{message_media:a},thread_expiry_time:Math.floor(Date.now()/1e3+24*60*60),thread_status:"UPLOADING",time:Math.floor(Date.now()/1e3)})},_getDefaultThread:function(){return{id:null,camera_post_type:null,post_source:null,time:null,thread_expiry_time:null,seen_receipts_last_seen_time:null,seen_receipts_unseen_count:null,seen_receipts_followers_unseen_count:null,thread_status:null,thread_review_status:null,root_message:{message_media:null,delight_ranges:[]},latest_message:{id:null},is_seen_by_viewer:null,is_user_story_thread_viewer:null,camera_post_thread_owner:null,friends_seen_count:null,non_friends_seen_count:null,story_thread_viewers:{edges:null},activity_description:null}}};e.exports=g}),null);
__d("FBStoriesBucketHelper",["CameraPostBucketOwnerHelper","CameraPostTypes","CameraPostTypesHelper","CurrentUser","FBStoriesLoggingConstants","FBStoriesThreadHelper","QE2Logger"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g={getUnseenThread:function(a){var b=h.getThreads(a);return b[Math.max(0,h.getUnseenThreadIndex(a))]}},h={isUserBucket:function(a){return h.getOwnerId(a)===b("CurrentUser").getID()},getLiveVideo:function(a){return(a=a)!=null?a.live_video:a},getMediaIDForLiveBucket:function(a){return(a=a)!=null?(a=a.live_video)!=null?a.id:a:a},isLive:function(a){return!!((a=h.getLiveVideo(a))!=null?a.id:a)},setLiveVideo:function(a,b){if(!a)return;a.live_video=b},hasData:function(a){return!a?!1:this.isLive(a)||h.getThreads(a).length>0},getThreads:function(a){a=((a=a)!=null?(a=a.threads)!=null?a.nodes:a:a)||[];return a.filter(function(a){return b("FBStoriesThreadHelper").isPublished(a)&&!b("FBStoriesThreadHelper").isExpired(a)})},getPendingThreads:function(a){return((a=a)!=null?(a=a.pending_threads)!=null?a.nodes:a:a)||[]},getThreadIDs:function(a){a=h.getThreads(a);return a.map(function(a){return((a=a)!=null?a.id:a)||""})},setThreads:function(a,b){if(!a)return;a.threads={nodes:b}},setPendingThreads:function(a,b){if(!a)return;a.pending_threads={nodes:b}},hasPendingThreads:function(a){if(!a.pending_stories)return!1;a=(a=a)!=null?(a=a.pending_stories)!=null?a.count:a:a;return!a?!1:a>0},getUnseenThreadIndex:function(a){var c=h.getThreads(a);a=h.isUserBucket(a);return a?c.findIndex(b("FBStoriesThreadHelper").doesThreadHasUnseenViewers):c.findIndex(b("FBStoriesThreadHelper").notSeenByViewer)},hasNewViewers:function(a){if(!a)return!1;a=this.getThreads(a);a=a.filter(b("FBStoriesThreadHelper").doesThreadHasUnseenViewers);return a.length>0},hasUnseenThreads:function(a){return this.getThreads(a).findIndex(b("FBStoriesThreadHelper").notSeenByViewer)>=0},getPreviewImage:function(a){a=g.getUnseenThread(a);return b("FBStoriesThreadHelper").getMediaPreviewImage(a)},getId:function(a){return((a=a)!=null?a.id:a)||""},getCameraPostType:function(a){return((a=a)!=null?a.camera_post_type:a)||b("CameraPostTypes").STORY},getUnseenCount:function(a){return((a=a)!=null?a.unseen_count:a)||0},setUnseenCount:function(a,b){if(!a)return;a.unseen_count=b},hasLiveVideoEnded:function(a){return!!((a=a)!=null?a.has_live_video_ended:a)},setHasLiveVideoEnded:function(a,b){if(!a)return;a.has_live_video_ended=b},getOwner:function(a){return((a=a)!=null?a.camera_post_bucket_owner:a)||{id:null,name:null,short_name:null,gender:null,is_viewer_friend:!1,profile_picture:null}},getOwnerId:function(a){return b("CameraPostBucketOwnerHelper").getId(h.getOwner(a))},getOwnerGender:function(a){return b("CameraPostBucketOwnerHelper").getGender(h.getOwner(a))},isOwnerEmployee:function(a){return b("CameraPostBucketOwnerHelper").isEmployee(h.getOwner(a))},isViewerEventHost:function(a){return b("CameraPostBucketOwnerHelper").isEventHost(h.getOwner(a))},isViewerPageContentAdmin:function(a){return b("CameraPostBucketOwnerHelper").isViewerPageContentAdmin(h.getOwner(a))},isViewerGroupAdmin:function(a){return b("CameraPostBucketOwnerHelper").isViewerGroupAdmin(h.getOwner(a))},isViewerGroupModerator:function(a){return b("CameraPostBucketOwnerHelper").isViewerGroupModerator(h.getOwner(a))},isViewerFriendOfOwner:function(a){return b("CameraPostBucketOwnerHelper").isViewerFriend(h.getOwner(a))},getOwnerProfilePictureUri:function(a){return b("CameraPostBucketOwnerHelper").getProfilePictureUri(h.getOwner(a))},getOwnerCoverPhotoUri:function(a){return b("CameraPostBucketOwnerHelper").getCoverPhotoUri(h.getOwner(a))},getOwnerName:function(a,c){c===void 0&&(c=!1);var d=h.getCameraPostType(a);a=h.getOwner(a);if(!c&&b("CameraPostTypesHelper").isStory(d)&&a.short_name)return a.short_name;else return a.name},getLatestThreadCreationTime:function(a){return!a?null:(a=a)!=null?a.latest_thread_creation_time:a},getLoggingType:function(a){__p&&__p();if(!a)return b("FBStoriesLoggingConstants").MISSING_STORY_DATA;if(h.isUserBucket(a))return b("FBStoriesLoggingConstants").SELF_STORY;var c=h.getCameraPostType(a);if(b("CameraPostTypesHelper").isPageStory(c))return b("FBStoriesLoggingConstants").PAGE_STORY;if(b("CameraPostTypesHelper").isGroupStory(c))return b("FBStoriesLoggingConstants").GROUP_STORY;if(b("CameraPostTypesHelper").isEventStory(c))return b("FBStoriesLoggingConstants").EVENT_STORY;if(b("CameraPostTypesHelper").isPromotionStory(c))return b("FBStoriesLoggingConstants").STORY_PROMOTION;return!h.isViewerFriendOfOwner(a)?b("FBStoriesLoggingConstants").FOLLOWEE_STORY:b("FBStoriesLoggingConstants").FRIEND_STORY},addThreadToBucket:function(a,b){var c=h.getThreads(a);h.setThreads(a,c.concat(b))},getDefaultBucket:function(){return{id:null,camera_post_type:null,unseen_count:0,ranking:null,live_video:null,camera_post_bucket_owner:null,threads:null,pending_threads:null,latest_thread_creation_time:null}},isUploading:function(a){if(!a)return!1;a=(a=a)!=null?a.is_uploading:a;return!!a},setUploading:function(a,b){if(!a)return;a.is_uploading=b}};e.exports=h}),null);
__d("FBStoriesLiveVideoActionTypes",["keyMirror"],(function(a,b,c,d,e,f){a=b("keyMirror")({SET_UI_COMPONENTS:null,REMOVE_UI_COMPONENTS:null,LIVE_BUCKET_LOADED:null,LOAD_UI_COMPONENTS_FAILED:null});e.exports=a}),null);
__d("FBStoriesMutedBucketOwnerHelper",[],(function(a,b,c,d,e,f){"use strict";a={getId:function(a){return((a=a)!=null?a.id:a)||""},getName:function(a){return((a=a)!=null?a.name:a)||""},getProfilePictureUri:function(a){return((a=a)!=null?a.profilePictureUri:a)||""},getMuted:function(a){return!!((a=a)!=null?a.muted:a)},setMuted:function(a,b){a.muted=b}};e.exports=a}),null);
__d("FBStoriesMutedBucketOwnersActionTypes",[],(function(a,b,c,d,e,f){"use strict";a=Object.freeze({LOADING:"FB_STORIES_MUTED_BUCKET_OWNERS.LOADING",LOADED:"FB_STORIES_MUTED_BUCKET_OWNERS.LOADED",LOADED_ERROR:"FB_STORIES_MUTED_BUCKET_OWNERS.LOADED_ERROR",SET_IS_CURRENTLY_MUTING:"FB_STORIES_MUTED_BUCKET_OWNERS.SET_IS_CURRENTLY_MUTING",UPDATE_MUTED_OPTIMISTIC:"FB_STORIES_MUTED_BUCKET_OWNERS.UPDATE_MUTED_OPTIMISTIC"});e.exports=a}),null);
__d("fbStoriesMutedBucketOwnersSelectors",[],(function(a,b,c,d,e,f){"use strict";var g={isLoading:function(a){return a.data.isLoading()},getMutedBucketOwners:function(a){a=a.data;return a.hasValue()?a.getValueEnforcing():[]},getCurrentlyMutingBucketOwners:function(a){return a.currentlyMutingBucketOwners},isCurrentlyMutingBucketOwners:function(a){return g.getCurrentlyMutingBucketOwners(a).length!==0},canReload:function(a){return!this.isCurrentlyMutingBucketOwners(a)&&!this.isLoading(a)}};e.exports=g}),null);
__d("fbStoriesMutedBucketOwnersReducer",["FBStoriesMutedBucketOwnerHelper","FBStoriesMutedBucketOwnersActionTypes","LoadObject","fbStoriesMutedBucketOwnersSelectors"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a,c){__p&&__p();switch(c.type){case b("FBStoriesMutedBucketOwnersActionTypes").LOADING:return babelHelpers["extends"]({},a,{data:b("LoadObject").loading()});case b("FBStoriesMutedBucketOwnersActionTypes").LOADED:return babelHelpers["extends"]({},a,{data:b("LoadObject").withValue(c.data),currentlyMutingBucketOwners:[]});case b("FBStoriesMutedBucketOwnersActionTypes").LOADED_ERROR:return babelHelpers["extends"]({},a,{data:b("LoadObject").withError(new Error(c.error.errorSummary))});case b("FBStoriesMutedBucketOwnersActionTypes").SET_IS_CURRENTLY_MUTING:var d=a.currentlyMutingBucketOwners,e=a.currentlyMutingBucketOwners.indexOf(c.ownerID);c.value&&e===-1?(d=d.slice(),d.push(c.ownerID)):!c.value&&e!==-1&&(d=d.slice(),d.splice(e,1));return babelHelpers["extends"]({},a,{currentlyMutingBucketOwners:d});case b("FBStoriesMutedBucketOwnersActionTypes").UPDATE_MUTED_OPTIMISTIC:e=b("fbStoriesMutedBucketOwnersSelectors").getMutedBucketOwners(a);var f=c.value;d=!1;var g=e.map(function(a){if(b("FBStoriesMutedBucketOwnerHelper").getId(a)===c.ownerID){var e=babelHelpers["extends"]({},a);d=!0;b("FBStoriesMutedBucketOwnerHelper").setMuted(e,f);return e}else return a});d||(g=e.concat({id:c.ownerID,name:c.ownerName,profilePictureUri:c.ownerProfilePictureUri,muted:f}));return babelHelpers["extends"]({},a,{data:b("LoadObject").withValue(g)});default:return a}}e.exports=a}),null);
__d("FBStoriesMutedBucketOwnersStore",["FBStoriesDispatcher","FluxReduceStore","LoadObject","fbStoriesMutedBucketOwnersReducer"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.getInitialState=function(){return{data:b("LoadObject").empty(),currentlyMutingBucketOwners:[]}};d.reduce=function(a,c){return b("fbStoriesMutedBucketOwnersReducer")(a,c)};return c}(b("FluxReduceStore"));a.__moduleID=e.id;e.exports=new a(b("FBStoriesDispatcher"))}),null);
__d("fbStoriesRootSelectors",["FBStoriesBucketHelper","reselect"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=b("reselect").createSelector;var g=function(a,b,c){return c===0?a:(a=b)!=null?a[c-1]:a};c=function(a){return a.data};d=a([c],function(a){return a.hasValue()?a.getValueEnforcing():{friendsBucketData:[],userBucketData:b("FBStoriesBucketHelper").getDefaultBucket(),userInfo:{userName:"",userID:"",userGender:"",userProfilePic:{uri:""}}}});f=a(c,function(a){return a.isLoading()});c=a([d],function(a){return a.userBucketData||{}});var h=a([c],function(a){return a&&a.id}),i=a([d],function(a){return a.friendsBucketData||[]}),j=a([i],function(a){return a.map(function(a){return a.id?a.id:""})});h=a([j,h],function(b,a){return[a].concat(b)});d=a([d],function(a){return a.userInfo||{}});var k=function(a){return a.selectedBucketIndex};k=a([k,c,i],function(b,c,a){return g(c,a,b)});var l=a([k],function(a){return a&&a.id}),m=a(c,function(a){return b("FBStoriesBucketHelper").isUploading(a)});a=a([i,c],function(a,c){c=[c].concat(a);return c.reduce(function(a,c){if(!c||!c.id)return a;if(!b("FBStoriesBucketHelper").hasData(c))return a;c={bucketID:b("FBStoriesBucketHelper").getId(c),cameraPostType:b("FBStoriesBucketHelper").getCameraPostType(c),owner:b("FBStoriesBucketHelper").getOwner(c),previewImageUri:b("FBStoriesBucketHelper").getPreviewImage(c),profileImageUri:b("FBStoriesBucketHelper").getOwnerProfilePictureUri(c),hasUnseenThreads:b("FBStoriesBucketHelper").hasUnseenThreads(c),hasNewViewers:b("FBStoriesBucketHelper").hasNewViewers(c),ownedByViewer:b("FBStoriesBucketHelper").isUserBucket(c),isLive:b("FBStoriesBucketHelper").isLive(c),latestThreadCreationTime:b("FBStoriesBucketHelper").getLatestThreadCreationTime(c),actorName:b("FBStoriesBucketHelper").getOwnerName(c,!0),actorShortName:b("FBStoriesBucketHelper").getOwnerName(c),actorGender:b("FBStoriesBucketHelper").getOwnerGender(c)};return a.concat([c])},[])});e.exports={bucketDescriptors:a,loading:f,userBucketData:c,friendsBucketData:i,friendsBucketIds:j,userInfo:d,bucketIds:h,selectedBucket:k,selectedBucketId:l,uploading:m}}),null);
__d("fbStoriesStateSelectors",["FBStoriesBucketHelper","fbStoriesRootSelectors"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("fbStoriesRootSelectors").bucketIds,h=b("fbStoriesRootSelectors").friendsBucketData,i=b("fbStoriesRootSelectors").selectedBucketId,j=b("fbStoriesRootSelectors").userBucketData,k={bucketByBucketId:function(a,b){b=k.bucketIndexByBucketId(a,b);return k.bucketByIndex(a,b)},bucketByIndex:function(a,b){return b===0?j(a):(a=h(a))!=null?a[b-1]:a},bucketIndexByBucketId:function(a,b){a=g(a);return a.indexOf(b)},isOwnBucket:function(a,c){return(c!=void 0?c:i(a))===b("FBStoriesBucketHelper").getId(j(a))},isProductionDialogLoading:function(a){return a.isProductionDialogLoading}};e.exports=k}),null);
__d("friendsBucketSorter",["CameraPostTypesHelper"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a){return function(b,c){var d=b.live_video&&b.live_video.id,e=c.live_video&&c.live_video.id;if(d!==e)return d?-1:1;if(g(b,c))return i(b)?-1:1;if(h(b,c))return j(b)?-1:1;return k(b,c,a)?l(b,a)?-1:1:n(b)>=n(c)?-1:1}}function g(a,b){return m(a,b,i)}function h(a,b){return m(a,b,j)}function i(a){return a.unseen_count>0}function j(a){return b("CameraPostTypesHelper").isEventStory(a.camera_post_type)}function k(a,b,c){return l(a,c)!==l(b,c)}function l(a,b){a=((a=a)!=null?(a=a.threads)!=null?a.nodes:a:a)||[];for(var c=0;c<a.length;c++){var d;d=(d=a[c])!=null?(d=d.camera_post_thread_owner)!=null?d.id:d:d;if(d===b)return!0}return!1}function m(a,b,c){a=c(a);c=c(b);return a!=c}function n(a){return((a=a)!=null?(a=a.ranking)!=null?a.score:a:a)||0}e.exports=a}),null);
__d("FBStoriesStore",["BackstageMediaType","CameraPostMediaHelper","CameraPostTypes","FBStoriesActionTypes","FBStoriesBucketHelper","FBStoriesDataHelper","FBStoriesDispatcher","FBStoriesGating","FBStoriesLiveVideoActionTypes","FBStoriesMutedBucketOwnersStore","FBStoriesReactionStickerConstants","FBStoriesThreadHelper","FluxReduceStore","LoadObject","fbStoriesMutedBucketOwnersSelectors","fbStoriesRootSelectors","fbStoriesStateSelectors","friendsBucketSorter","qex"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.getInitialState=function(){return{data:b("LoadObject").empty(),selectedBucketIndex:-1,currentThreadIndex:-1,currentThreadPercentDone:0,unseenMode:!1,allBucketsViewed:!1,lastViewedThreadIndexForBucket:new Map(),isProductionDialogLoading:!1,isCommercialBreakRunning:new Map(),isViewerOpen:!1,subscriptionToken:null,viewerEntrypoint:null}};d.reduce=function(a,c){__p&&__p();var d=this;switch(c.type){case b("FBStoriesActionTypes").LOADING:return babelHelpers["extends"]({},a,{data:b("LoadObject").loading()});case b("FBStoriesActionTypes").LOADED:var e=c.data,f=e.userInfo;e=e.userBucketData;var g=c.data.friendsBucketData;g=b("FBStoriesDataHelper").getFriendsDataWithEndedLiveBucket(g,this.$FBStoriesStore1(),this.isOwnBucket(this.getSelectedBucketId()));return babelHelpers["extends"]({},a,{data:b("LoadObject").withValue({userInfo:f,userBucketData:e,friendsBucketData:g})});case b("FBStoriesActionTypes").VIEWER_LIST_LOADED_FOR_THREAD:var h=c.data.node;f=babelHelpers["extends"]({},this.getUserBucketData(),{threads:{nodes:this.$FBStoriesStore2().map(function(a){if(b("FBStoriesThreadHelper").getId(a)===c.threadID){var d=babelHelpers["extends"]({},a);b("FBStoriesThreadHelper").setFriendsSeenCount(d,b("FBStoriesThreadHelper").getFriendsSeenCount(h));b("FBStoriesThreadHelper").setNonFriendsSeenCount(d,b("FBStoriesThreadHelper").getNonFriendsSeenCount(h));b("FBStoriesThreadHelper").setViewers(d,b("FBStoriesThreadHelper").getViewers(h));return d}return a})}});return babelHelpers["extends"]({},a,{data:b("LoadObject").withValue({userBucketData:f,userInfo:this.getUserInfo(),friendsBucketData:this.getFriendsBucketData()})});case b("FBStoriesActionTypes").SUBSCRIPTION_BUCKET_UPDATE:var i=c.bucketData;e=b("FBStoriesBucketHelper").getOwnerId(i);if(this.isMutedBucketOwner(e))return a;g=b("FBStoriesBucketHelper").getThreads(i);var j=g.length>0||this.$FBStoriesStore3(i),k=b("FBStoriesBucketHelper").getId(i);f=b("fbStoriesRootSelectors").friendsBucketData(a);e=!1;g=f.reduce(function(a,c){b("FBStoriesBucketHelper").getId(c)===k?(e=!0,j&&a.push(i)):a.push(c);return a},[]);!e&&j&&(g=[i].concat(f));g=b("FBStoriesDataHelper").getFriendsDataWithEndedLiveBucket(g,b("fbStoriesRootSelectors").selectedBucket(a),b("fbStoriesStateSelectors").isOwnBucket(a,b("fbStoriesRootSelectors").selectedBucketId(a)));f=b("FBStoriesGating").shouldUseTrayMigration();f||g.sort(b("friendsBucketSorter")(b("fbStoriesRootSelectors").userInfo(a).userID));return babelHelpers["extends"]({},a,{data:b("LoadObject").withValue({userBucketData:b("fbStoriesRootSelectors").userBucketData(a),userInfo:b("fbStoriesRootSelectors").userInfo(a),friendsBucketData:g})});case b("FBStoriesActionTypes").LOADED_ERROR:return babelHelpers["extends"]({},a,{data:b("LoadObject").withError(new Error(c.error.message))});case b("FBStoriesActionTypes").RESET_LOCAL_SEEN_HISTORY:return babelHelpers["extends"]({},a,{lastViewedThreadIndexForBucket:new Map()});case b("FBStoriesActionTypes").SELECTED_BUCKET_IDX_CHANGED:f=c.bucketIndex;return f<0||f>=this.getBucketCount()?a:babelHelpers["extends"]({},a,{selectedBucketIndex:f});case b("FBStoriesActionTypes").SELECTED_THREAD_IDX_CHANGED:g=this.getThreadCountForSelectedBucket();if(!this.isSelectedBucketLive()&&(c.index<0||c.index>=g))return a;f=new Map(a.lastViewedThreadIndexForBucket);f.set(this.getSelectedBucketIndex(),c.index);return babelHelpers["extends"]({},a,{lastViewedThreadIndexForBucket:f,currentThreadIndex:c.index});case b("FBStoriesActionTypes").SELECTED_THREAD_PERCENT_DONE:g=Math.min(100,Math.max(c.percentDone,0));return babelHelpers["extends"]({},a,{currentThreadPercentDone:g});case b("FBStoriesActionTypes").SET_ALL_BUCKETS_VIEWED:f=c.value;return f===a.allBucketsViewed?a:babelHelpers["extends"]({},a,{allBucketsViewed:f,unseenMode:a.unseenMode&&f?!1:a.unseenMode});case b("FBStoriesActionTypes").SET_UNSEEN_MODE:return babelHelpers["extends"]({},a,{unseenMode:c.value});case b("FBStoriesActionTypes").UPDATE_THREAD_SEEN_OPTIMISTIC:var l=this.getSelectedBucketId()?this.getSelectedBucketId():c.bucketID;g=function(a){__p&&__p();if(b("FBStoriesBucketHelper").getId(a)===l){var e=b("FBStoriesBucketHelper").getUnseenCount(a),f=d.$FBStoriesStore4(a).map(function(a){if(b("FBStoriesThreadHelper").getId(a)===c.threadID){b("FBStoriesThreadHelper").isSeenByViewer(a)||(e=Math.max(e-1,0));var d=babelHelpers["extends"]({},a);b("FBStoriesThreadHelper").setIsSeenByViewer(d,!0);return d}else return a}),g=babelHelpers["extends"]({},a);b("FBStoriesBucketHelper").setUnseenCount(g,e);b("FBStoriesBucketHelper").setThreads(g,f);return g}else return a};f=this.isOwnBucket()?g(this.getUserBucketData()):this.getUserBucketData();g=this.isOwnBucket()?this.getFriendsBucketData():this.getFriendsBucketData().map(g);return babelHelpers["extends"]({},a,{data:b("LoadObject").withValue({userBucketData:f,friendsBucketData:g,userInfo:this.getUserInfo()})});case b("FBStoriesActionTypes").UPDATE_THREAD_VIEWERS_SEEN_OPTIMISTIC:f=babelHelpers["extends"]({},this.getUserBucketData(),{threads:{nodes:this.$FBStoriesStore2().map(function(a){if(b("FBStoriesThreadHelper").getId(a)===c.threadID){var d=babelHelpers["extends"]({},a);b("FBStoriesThreadHelper").setSeenReceiptsLastSeenTime(d,Date.now());b("FBStoriesThreadHelper").setSeenReceiptsUnseenCount(d,0);b("FBStoriesThreadHelper").setSeenReceiptsFollowersUnseenCount(d,0);return d}else return a})}});return babelHelpers["extends"]({},a,{data:b("LoadObject").withValue({userBucketData:f,userInfo:this.getUserInfo(),friendsBucketData:this.getFriendsBucketData()})});case b("FBStoriesActionTypes").DELETE_THREAD_FROM_BUCKET:var m=c.threadID,n=c.bucketID;if(!this.isUserManagedThread(m,n))return a;g=this.getUserBucketData();f=null;n===b("FBStoriesBucketHelper").getId(g)?(b("FBStoriesBucketHelper").setThreads(g,this.$FBStoriesStore4(g).filter(function(a){return b("FBStoriesThreadHelper").getId(a)!==m})),f=this.getFriendsBucketData()):f=this.getFriendsBucketData().map(function(a){if(b("FBStoriesBucketHelper").getId(a)===n){var c=d.$FBStoriesStore4(a).filter(function(a){return b("FBStoriesThreadHelper").getId(a)!==m}),e=babelHelpers["extends"]({},a);b("FBStoriesBucketHelper").setThreads(e,c);return e}else return a}).filter(function(a){return d.$FBStoriesStore4(a).length>0});var o=a.lastViewedThreadIndexForBucket;m===this.getCurrentThreadIDForSelectedBucket()&&(o=new Map(o),o.set(this.getSelectedBucketIndex(),void 0));return babelHelpers["extends"]({},a,{lastViewedThreadIndexForBucket:o,data:b("LoadObject").withValue({userBucketData:g,friendsBucketData:f,userInfo:this.getUserInfo()})});case b("FBStoriesActionTypes").REMOVE_BUCKET:var p=c.bucketID;o=this.getFriendsBucketData().filter(function(a){return b("FBStoriesBucketHelper").getId(a)!==p});return babelHelpers["extends"]({},a,{data:b("LoadObject").withValue({userBucketData:this.getUserBucketData(),friendsBucketData:o,userInfo:this.getUserInfo()})});case b("FBStoriesLiveVideoActionTypes").LIVE_BUCKET_LOADED:g=c.data;f=b("FBStoriesDataHelper").getFriendsBucketDataFromLoadedObject(g);o=[].concat(this.getFriendsBucketData());g=f.reduce(function(a,c){d.$FBStoriesStore3(c)&&d.getBucketIndexByBucketId(b("FBStoriesBucketHelper").getId(c))===-1&&a.push(c);return a},o);return babelHelpers["extends"]({},a,{data:b("LoadObject").withValue({userBucketData:this.getUserBucketData(),userInfo:this.getUserInfo(),friendsBucketData:g})});case b("FBStoriesActionTypes").REMOVE_ENDED_LIVE_VIDEO_FROM_BUCKET:var q=c.bucketID;f=this.getFriendsBucketData().map(function(a){b("FBStoriesBucketHelper").getId(a)===q&&(b("FBStoriesBucketHelper").setLiveVideo(a,null),b("FBStoriesBucketHelper").setHasLiveVideoEnded(a,!1));return a});return babelHelpers["extends"]({},a,{data:b("LoadObject").withValue({userBucketData:this.getUserBucketData(),friendsBucketData:f,userInfo:this.getUserInfo()})});case b("FBStoriesActionTypes").SET_IS_COMMERCIAL_BREAK_RUNNING:o=new Map(this.getState().isCommercialBreakRunning);return babelHelpers["extends"]({},a,{isCommercialBreakRunning:o.set(c.videoID,c.isCommercialBreakRunning)});case b("FBStoriesActionTypes").UNSELECT_BUCKET:return babelHelpers["extends"]({},a,{selectedBucketIndex:-1,currentThreadIndex:-1});case b("FBStoriesActionTypes").SET_VIEWER_OPEN:return babelHelpers["extends"]({},a,{isViewerOpen:c.value,viewerEntrypoint:c.entrypoint});case b("FBStoriesActionTypes").SET_USER_BUCKET_UPLOAD_STATUS:g=babelHelpers["extends"]({},this.getUserBucketData());b("FBStoriesBucketHelper").setUploading(g,c.isUploading);return babelHelpers["extends"]({},a,{data:b("LoadObject").withValue({userBucketData:g,friendsBucketData:this.getFriendsBucketData(),userInfo:this.getUserInfo()})});case b("FBStoriesActionTypes").OPTIMISTIC_CREATE_PHOTO_STORY:f=b("FBStoriesThreadHelper").makeOptimisticPhotoThread(c.imageURL);o=babelHelpers["extends"]({},this.getUserBucketData());b("FBStoriesBucketHelper").addThreadToBucket(o,f);return babelHelpers["extends"]({},a,{data:b("LoadObject").withValue({userBucketData:o,friendsBucketData:this.getFriendsBucketData(),userInfo:this.getUserInfo()})});case b("FBStoriesActionTypes").RESET_STATE:return babelHelpers["extends"]({},this.getInitialState());case b("FBStoriesActionTypes").SET_SUBSCRIPTION_TOKEN:return babelHelpers["extends"]({},a,{subscriptionToken:c.token});case b("FBStoriesActionTypes").OPTIMISTIC_POLL_VOTE:var r=c.index,s=this.getSelectedBucketId();g=function(a){__p&&__p();if(b("FBStoriesBucketHelper").getId(a)===s){var c=d.$FBStoriesStore4(a).map(function(a){__p&&__p();if(b("FBStoriesThreadHelper").getId(a)===d.getCurrentThreadIDForSelectedBucket()){var c,e=babelHelpers["extends"]({},a);(((c=e)!=null?(c=c.root_message)!=null?c.story_overlays:c:c)||[]).map(function(a){if(a.__typename==="StoryOverlayPollSticker"){var b=a.poll,c=babelHelpers["extends"]({},b);c.viewer_vote_index=r;c.poll_options=[].concat(b.poll_options);b=c.poll_options[r];b!==void 0&&(b.vote_count+=1);a.poll=c}return a});return e}else return a}),e=babelHelpers["extends"]({},a);b("FBStoriesBucketHelper").setThreads(e,c);return e}else return a};f=this.isOwnBucket()?g(this.getUserBucketData()):this.getUserBucketData();o=this.isOwnBucket()?this.getFriendsBucketData():this.getFriendsBucketData().map(g);return babelHelpers["extends"]({},a,{data:b("LoadObject").withValue({userBucketData:f,friendsBucketData:o,userInfo:this.getUserInfo()})});case b("FBStoriesActionTypes").TAP_ON_REACTION_STICKER:var t=c.stickerID,u=c.count,v=this.getUserInfo().userID,w=!1,x=this.getSelectedBucketId();g=function(a){__p&&__p();if(b("FBStoriesBucketHelper").getId(a)===x){var c=d.$FBStoriesStore4(a).map(function(a){__p&&__p();if(b("FBStoriesThreadHelper").getId(a)===d.getCurrentThreadIDForSelectedBucket()){var c,e=babelHelpers["extends"]({},a);(((c=e)!=null?(c=c.root_message)!=null?c.story_overlays:c:c)||[]).map(function(a){__p&&__p();if(a.__typename===b("FBStoriesReactionStickerConstants").StoryOverlayReactionSticker&&a.reaction_sticker.id===t){var c=a.reaction_sticker.sticker_reactions.nodes;for(var d=c,e=Array.isArray(d),f=0,d=e?d:d[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{f=d.next();if(f.done)break;g=f.value}g=g;if(v===g.reactor.id){g.reaction_count+=u;w=!0;break}}w||c.push({reaction_count:u,reactor:{id:v}})}return a});return e}else return a}),e=babelHelpers["extends"]({},a);b("FBStoriesBucketHelper").setThreads(e,c);return e}else return a};f=this.isOwnBucket()?g(this.getUserBucketData()):this.getUserBucketData();o=this.isOwnBucket()?this.getFriendsBucketData():this.getFriendsBucketData().map(g);return babelHelpers["extends"]({},a,{data:b("LoadObject").withValue({userBucketData:f,friendsBucketData:o,userInfo:this.getUserInfo()})});case b("FBStoriesActionTypes").SET_IS_PRODUCTION_DIALOG_LOADING:return babelHelpers["extends"]({},a,{isProductionDialogLoading:c.value});case b("FBStoriesActionTypes").APPROVE_PENDING_THREAD:var y=c.bucketID,z=c.threadID;g=this.getFriendsBucketData().map(function(a){__p&&__p();if(b("FBStoriesBucketHelper").getId(a)===y){var c=b("FBStoriesBucketHelper").getPendingThreads(a),e=c.findIndex(function(a){return b("FBStoriesThreadHelper").getId(a)===z});if(e===-1)return a;var f=c[e];c.splice(e,1);b("FBStoriesBucketHelper").setPendingThreads(a,c);e=b("FBStoriesThreadHelper").getTime(f);c=d.$FBStoriesStore4(a);var g=0;if(c.length===0)c.push(f);else for(g=c.length-1;g>=0;g--){var h=b("FBStoriesThreadHelper").getTime(c[g]);if(e>h){c.splice(g+1,0,f);break}else g===0&&c.splice(0,0,f)}b("FBStoriesBucketHelper").setThreads(a,c);h=babelHelpers["extends"]({},a);return h}return a});return babelHelpers["extends"]({},a,{data:b("LoadObject").withValue({userBucketData:this.getUserBucketData(),friendsBucketData:g,userInfo:this.getUserInfo()})});default:return a}};d.$FBStoriesStore5=function(){var a=this.getState().data;return a.hasValue()?a.getValueEnforcing():{friendsBucketData:[],userBucketData:b("FBStoriesBucketHelper").getDefaultBucket(),userInfo:{userName:"",userID:"",userGender:"",userProfilePic:{uri:""}}}};d.getUserBucketData=function(){return this.$FBStoriesStore5().userBucketData||{}};d.getUserInfo=function(){return this.$FBStoriesStore5().userInfo||{}};d.getFriendsBucketData=function(){return this.$FBStoriesStore5().friendsBucketData||[]};d.isMutedBucketOwner=function(a){var c=b("FBStoriesMutedBucketOwnersStore").getState();c=b("fbStoriesMutedBucketOwnersSelectors").getMutedBucketOwners(c);return c.find(function(b){return b.id===a})!==void 0};d.isLoading=function(){return this.getState().data.isLoading()};d.getBucketIds=function(){var a=this.getFriendsBucketData().map(function(a){return a.id?a.id:""}),b=this.getUserBucketData().id||"";return[b].concat(a)};d.getSelectedBucketIndex=function(){return this.getState().selectedBucketIndex};d.getSelectedBucketId=function(){return this.getBucketIds()[this.getSelectedBucketIndex()]};d.areAllBucketsViewed=function(){return this.getState().allBucketsViewed};d.getCameraPostTypeForBucketId=function(a){return b("FBStoriesBucketHelper").getCameraPostType(this.$FBStoriesStore6(a))};d.doesBucketContainThreadId=function(a,c){a=this.$FBStoriesStore6(a);a=b("FBStoriesBucketHelper").getThreads(a);return a.find(function(a){return b("FBStoriesThreadHelper").getId(a)===c})!==void 0};d.$FBStoriesStore6=function(a){return this.getBucketByIndex(this.getBucketIndexByBucketId(a))};d.getBucketIndexByBucketId=function(a){return this.getBucketIds().indexOf(a)};d.getSelectedBucketCameraPostType=function(){return b("FBStoriesBucketHelper").getCameraPostType(this.$FBStoriesStore1())};d.getSelectedBucketOwner=function(){return b("FBStoriesBucketHelper").getOwner(this.$FBStoriesStore1())};d.getSelectedBucketOwnerID=function(){return b("FBStoriesBucketHelper").getOwnerId(this.$FBStoriesStore1())};d.getSelectedBucketUnseenCount=function(){return b("FBStoriesBucketHelper").getUnseenCount(this.$FBStoriesStore1())};d.getThreadsForSelectedBucket=function(){return this.$FBStoriesStore4(this.$FBStoriesStore1())};d.getCurrentThreadIndexForSelectedBucket=function(){return this.getState().currentThreadIndex};d.getCurrentThreadIDForSelectedBucket=function(){return b("FBStoriesThreadHelper").getId(this.getCurrentThreadForSelectedBucket())};d.getCurrentThreadStatusForSelectedBucket=function(){return b("FBStoriesThreadHelper").getStatus(this.getCurrentThreadForSelectedBucket())};d.getCurrentThreadCameraPostTypeForSelectedBucket=function(){return this.isSelectedBucketLive()?b("CameraPostTypes").STORY:b("FBStoriesThreadHelper").getCameraPostType(this.getCurrentThreadForSelectedBucket())};d.getCurrentThreadMediaTypeForSelectedBucket=function(){return this.isSelectedBucketLive()?b("BackstageMediaType").LIVE:b("FBStoriesThreadHelper").getMediaType(this.getCurrentThreadForSelectedBucket())};d.getFeedTrackingData=function(a){__p&&__p();var b={};b.is_fb_story=!0;b.media_id=this.getCurrentThreadMediaIDForSelectedBucket();b.camera_post_type=this.getSelectedBucketCameraPostType();b.story_owner_fbid=this.getSelectedBucketOwnerID();b.story_owner_type=this.getSelectedBucketOwnerType();b.story_size=this.getThreadCountForSelectedBucket();b.new_content_size=this.getSelectedBucketUnseenCount();b.bucket_index=this.getSelectedBucketIndex();b.event=a;b.bucket_ids=this.getBucketIds();a=this.getUserBucketData();a&&(b.bucket_data=a);a=this.getCurrentThreadData();a&&(b.thread_data=a);return b};d.getCurrentThreadMediaIDForSelectedBucket=function(){if(this.isSelectedBucketLive()){var a=this.getThreadDataForSelectedLiveBucket();return a&&a.media.id}return b("FBStoriesThreadHelper").getMediaId(this.getCurrentThreadForSelectedBucket())};d.getCurrentThreadMediaViewerCountForSelectedBucket=function(){var a=this.getCurrentThreadForSelectedBucket();return b("FBStoriesThreadHelper").getSeenCount(a)};d.getCurrentThreadForSelectedBucket=function(){return this.getThreadsForSelectedBucket()[this.getCurrentThreadIndexForSelectedBucket()]};d.getCurrentThreadData=function(){return this.isSelectedBucketLive()?this.getThreadDataForSelectedLiveBucket():this.$FBStoriesStore7(this.getState().currentThreadIndex)};d.shouldDisableReply=function(){var a=this.isOwnThread(),c=b("FBStoriesBucketHelper").isViewerFriendOfOwner(this.$FBStoriesStore1()),d=b("FBStoriesThreadHelper").isViewerFriendOfOwner(this.getCurrentThreadForSelectedBucket());return a||!c&&!d||this.isSelectedBucketLive()};d.getNonFriendsSeenCount=function(){return b("FBStoriesThreadHelper").getNonFriendsSeenCount(this.getCurrentThreadForSelectedBucket())};d.getFriendsSeenCount=function(){return b("FBStoriesThreadHelper").getFriendsSeenCount(this.getCurrentThreadForSelectedBucket())};d.isOwnBucket=function(a){return(a!=void 0?a:this.getSelectedBucketId())===b("FBStoriesBucketHelper").getId(this.getUserBucketData())};d.isOwnThread=function(){if(this.isOwnBucket())return!0;var a=this.getCurrentThreadForSelectedBucket();a=b("FBStoriesThreadHelper").getOwnerId(a);return a===this.getUserInfo().userID};d.isBucketViewerEventHost=function(){var a=this.$FBStoriesStore1();return b("FBStoriesBucketHelper").isViewerEventHost(a)};d.isCurrentThreadUserManaged=function(){return this.isUserManagedThread(this.getCurrentThreadIDForSelectedBucket()||"",this.getSelectedBucketId())};d.canUserReportCurrentThreadToFacebook=function(){return this.canUserReportThreadToFacebook(this.getCurrentThreadIDForSelectedBucket()||"",this.getSelectedBucketId())};d.isCurrentBucketUserManaged=function(){return this.isUserManagedBucket(this.getSelectedBucketId())};d.isUserManagedThread=function(a,c){var d=this.$FBStoriesStore6(c);if(!d)return!1;a=this.$FBStoriesStore8(a,d);d=b("FBStoriesThreadHelper").getOwnerId(a);return a&&d===this.getUserInfo().userID||this.isUserManagedBucket(c)};d.canUserReportThreadToFacebook=function(a,c){c=this.$FBStoriesStore6(c);if(!c)return!1;a=this.$FBStoriesStore8(a,c);return a===null?!1:b("FBStoriesThreadHelper").getOwnerId(a)!==this.getUserInfo().userID&&!b("FBStoriesBucketHelper").isViewerEventHost(c)&&!b("FBStoriesBucketHelper").isViewerPageContentAdmin(c)};d.isUserManagedBucket=function(a){a=this.$FBStoriesStore6(a);return!a?!1:b("FBStoriesBucketHelper").getId(a)===b("FBStoriesBucketHelper").getId(this.getUserBucketData())||b("FBStoriesBucketHelper").isViewerEventHost(a)||b("FBStoriesBucketHelper").isViewerPageContentAdmin(a)||b("FBStoriesBucketHelper").isViewerGroupModerator(a)||b("FBStoriesBucketHelper").isViewerGroupAdmin(a)};d.canSeeCurrentThreadViewCount=function(){return this.isOwnThread()&&!this.isSelectedBucketLive()||this.isCurrentBucketPageAdmin()};d.canOpenCurrentThreadViewerSheet=function(){return this.isOwnThread()&&!this.isSelectedBucketLive()};d.isCurrentBucketGroupAdmin=function(){return this.isGroupAdminBucket(this.getSelectedBucketId())};d.isCurrentBucketPageAdmin=function(){return this.isPageAdminBucket(this.getSelectedBucketId())};d.isGroupAdminBucket=function(a){a=this.$FBStoriesStore6(a);return!a?!1:b("FBStoriesBucketHelper").isViewerGroupModerator(a)||b("FBStoriesBucketHelper").isViewerGroupAdmin(a)};d.isPageAdminBucket=function(a){a=this.$FBStoriesStore6(a);return!a?!1:b("FBStoriesBucketHelper").isViewerPageContentAdmin(a)};d.isCurrentThreadReviewStatusPending=function(){var a=this.getThreadsForSelectedBucket()[this.getCurrentThreadIndexForSelectedBucket()];return b("FBStoriesThreadHelper").isReviewStatusPending(a)};d.hasPendingThreads=function(){var a=this.$FBStoriesStore6(this.getSelectedBucketId());return!a?!1:b("FBStoriesBucketHelper").hasPendingThreads(a)};d.getBucketCount=function(){return this.getFriendsBucketData().length+1};d.hasDataInSelectedBucket=function(){return b("FBStoriesBucketHelper").hasData(this.$FBStoriesStore1())};d.hasOwnBucketViewers=function(){return this.userBucketIsLive()?!1:b("FBStoriesBucketHelper").hasNewViewers(this.getUserBucketData())};d.hasOwnBucketUpdates=function(){return this.userBucketIsLive()?!1:b("FBStoriesBucketHelper").hasUnseenThreads(this.getUserBucketData())};d.hasOwnBucketContent=function(){return this.$FBStoriesStore2().length>0||this.userBucketIsLive()};d.getCurrentThreadPercentDone=function(){return this.getState().currentThreadPercentDone};d.getThreadCountForSelectedBucket=function(){return this.getThreadsForSelectedBucket().length};d.userBucketIsLive=function(){return this.$FBStoriesStore3(this.getUserBucketData())};d.isSelectedBucketLive=function(){return this.$FBStoriesStore3(this.$FBStoriesStore1())};d.getSelectedBucketOwnerType=function(){return b("FBStoriesBucketHelper").getLoggingType(this.$FBStoriesStore1())};d.$FBStoriesStore3=function(a){return b("FBStoriesBucketHelper").isLive(a)};d.getCurrentThreadViewers=function(){__p&&__p();var a={hasNewViewers:!1,hasNewFriendViewers:!1,hasNewConnectionsViewers:!1,friends:[],connections:[],totalCount:0,totalNew:0,nonFriendsCount:0};if(!this.canSeeCurrentThreadViewCount())return a;var c=this.getCurrentThreadForSelectedBucket(),d=b("FBStoriesThreadHelper").getViewers(c),e=this.getUserInfo().userID,f=b("FBStoriesThreadHelper").getReactionStickersReactors(c);a=d.reduce(function(a,d){__p&&__p();var g=b("FBStoriesThreadHelper").getStoryViewerId(d);if(!g)return a;if(g!==e){var h;h=((h=d)!=null?(h=h.node)!=null?h.is_viewer_friend:h:h)||!1;var i=h?"friends":"connections",j=b("FBStoriesThreadHelper").getStoryViewerSeenTime(d),k=b("FBStoriesThreadHelper").getStoryViewerReactions(d),l=j>=b("FBStoriesThreadHelper").getSeenReceiptsLastSeenTime(c);a[i].push(babelHelpers["extends"]({},d.node,{seenTime:j,isNewViewer:l,reactions:k,reactionStickers:f[g]}));a.totalNew+=l?1:0;a.hasNewViewers=a.hasNewViewers||l;a.hasNewFriendViewers=a.hasNewFriendViewers||l&&h;a.hasNewConnectionsViewers=a.hasNewViewers||l&&!h}return a},a);var g=this.getNonFriendsSeenCount();return Object.assign(a,{totalCount:g+d.length,nonFriendsCount:g})};d.isUnseenMode=function(){return this.getState().unseenMode};d.getThreadCount=function(a){__p&&__p();var b=this.getBucketByIndex(a);if(this.$FBStoriesStore3(b))return 0;if(a===0){var c=this.$FBStoriesStore4(this.getUserBucketData());return c.length}if(a>0){c=this.$FBStoriesStore4(b);return c.length}return-1};d.getUnseenThreadIndex=function(a){return b("FBStoriesBucketHelper").getUnseenThreadIndex(this.getBucketByIndex(a))};d.getAllowedNavigationType=function(){var a=this.getSelectedBucketIndex(),c=a===0||a==1&&!b("FBStoriesBucketHelper").hasData(this.getUserBucketData());a=a===this.getBucketCount()-1;c=c&&this.getCurrentThreadIndexForSelectedBucket()==0;a=a&&this.getCurrentThreadIndexForSelectedBucket()===this.getThreadsForSelectedBucket().length-1;if(c)return"NEXT_ONLY";return a?"PREV_ONLY":"BOTH"};d.hasSeenBucketInCurrentSession=function(a){var b=this.getState().lastViewedThreadIndexForBucket;return b.get(a)!==void 0};d.getLastSeenThreadIndexForBucket=function(a){var b=this.getState().lastViewedThreadIndexForBucket;b=b.get(a);return b==void 0?0:b};d.$FBStoriesStore2=function(){return this.$FBStoriesStore4(this.getUserBucketData())};d.$FBStoriesStore1=function(){return this.getBucketByIndex(this.getSelectedBucketIndex())};d.getBucketByIndex=function(a){var b;return a===0?this.getUserBucketData():(b=this.getFriendsBucketData())!=null?b[a-1]:b};d.$FBStoriesStore8=function(a,b){b=this.$FBStoriesStore4(b);b=b.filter(function(b){return b.id===a});return b.length>0?b[0]:null};d.$FBStoriesStore4=function(a){return b("FBStoriesBucketHelper").getThreads(a)};d.$FBStoriesStore7=function(a){var c=this.getSelectedBucketOwner();a=this.getThreadsForSelectedBucket()[a];if(!a)return null;var d=b("FBStoriesThreadHelper").getMedia(a),e=b("FBStoriesThreadHelper").getWWWTextFormatMetadata(a),f=b("FBStoriesThreadHelper").getTextFormatMetadata(a),g=b("FBStoriesThreadHelper").getBackdropImage(a),h=b("FBStoriesThreadHelper").getMessageText(a),i=b("FBStoriesThreadHelper").getMessageRanges(a),j=b("FBStoriesThreadHelper").getDelightRanges(a),k=b("FBStoriesThreadHelper").getIsPlainText(a),l=b("FBStoriesThreadHelper").getInstagramProfileURL(a),m=b("FBStoriesThreadHelper").getOriginalPostStoryAttribution(a);return{isLive:!1,media:d,bucketOwner:c,threadOwner:b("FBStoriesThreadHelper").getOwner(a)||{name:null,id:null,is_viewer_friend:!1,profile_picture:null},participants:[],isSeen:b("FBStoriesThreadHelper").isSeenByViewer(a),latestMessageID:b("FBStoriesThreadHelper").getLatestMessageID(a),time:b("FBStoriesThreadHelper").getTime(a),threadID:b("FBStoriesThreadHelper").getId(a),cameraPostType:b("FBStoriesThreadHelper").getCameraPostType(a),cameraPostSource:b("FBStoriesThreadHelper").getCameraPostSource(a),wwwTextFormatMetadata:e,messageText:h,messageRanges:i,delightRanges:j,textFormatMetadata:f,backdropImage:g,instagramProfileURL:l,isPlainText:k,originalPostStoryAttribution:m,activityDescription:b("FBStoriesThreadHelper").getActivityDescription(a),withTags:b("FBStoriesThreadHelper").getWithTags(a),explicitLocation:b("FBStoriesThreadHelper").getExplicitLocation(a),inlineActivities:b("FBStoriesThreadHelper").getInlineActivities(a),defaultBackground:b("FBStoriesThreadHelper").getDefaultBackground(a),linkAttachment:b("FBStoriesThreadHelper").getLinkAttachment(a),mediaBackground:b("FBStoriesThreadHelper").getMediaBackground(a),negativeFeedbackActions:b("FBStoriesThreadHelper").getNegativeFeedbackActions(a)}};d.getThreadDataForSelectedLiveBucket=function(){var a=this.$FBStoriesStore1();return this.$FBStoriesStore9(a)};d.$FBStoriesStore9=function(a){if(!a)return null;var c=b("FBStoriesBucketHelper").getLiveVideo(a);if(!c||!this.$FBStoriesStore3(a))return null;var d=this.getSelectedBucketOwner();return{isLive:!0,media:c,bucketOwner:d,isSeen:!1,cameraPostType:b("FBStoriesBucketHelper").getCameraPostType(a)}};d.isSelectedBucketLiveAndEnded=function(){return this.isSelectedBucketLive()&&b("FBStoriesBucketHelper").hasLiveVideoEnded(this.$FBStoriesStore1())};d.getIsCommercialBreakRunning=function(a){return!!this.getState().isCommercialBreakRunning.get(a)};d.getVideoMediaIdForBucketIndexAndThreadIndex=function(a,c){__p&&__p();a=this.getBucketByIndex(a);if(!a)return null;if(this.$FBStoriesStore3(a)){var d=this.$FBStoriesStore9(a);return(d=d)!=null?(d=d.media)!=null?d.id:d:d}d=this.$FBStoriesStore4(a);if(c<0||c>=d.length)return null;a=b("FBStoriesThreadHelper").getMedia(d[c]);if(!a)return null;return!b("CameraPostMediaHelper").isVideo(a)?null:a.id};d.isViewerOpen=function(){return this.getState().isViewerOpen};d.getCurrentViewerEntrypoint=function(){return this.getState().viewerEntrypoint};d.getCurrentThreadOverlays=function(){return b("FBStoriesThreadHelper").getStoryOverlays(this.getCurrentThreadForSelectedBucket())};d.isProductionDialogLoading=function(){return this.getState().isProductionDialogLoading};return c}(b("FluxReduceStore"));a.__moduleID=e.id;e.exports=new a(b("FBStoriesDispatcher"))}),null);
__d("FBStoriesMutedBucketOwnersActions",["CurrentUser","FBLogger","FBStoriesDataHelper","FBStoriesDispatcher","FBStoriesGraphQLAPI","FBStoriesMutedBucketOwnersActionTypes","FBStoriesMutedBucketOwnersStore","promiseDone"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("FBStoriesDispatcher").dispatch;a=function(){__p&&__p();function a(){b("FBStoriesDispatcher").explicitlyRegisterStores([b("FBStoriesMutedBucketOwnersStore")])}var c=a.prototype;c.loadMutedOwners=function(){g({type:b("FBStoriesMutedBucketOwnersActionTypes").LOADING}),b("promiseDone")(b("FBStoriesGraphQLAPI").loadMutedBucketOwnersList(),function(a){g({type:b("FBStoriesMutedBucketOwnersActionTypes").LOADED,data:b("FBStoriesDataHelper").getMutedBucketOwnersFromLoadedQuery(a)})},function(){b("FBLogger")("fbstories").mustfix("failed to load muted bucket owners for: %s",b("CurrentUser").getID())})};c.setBucketOwnerMuted=function(a,c,d,e){b("promiseDone")(b("FBStoriesGraphQLAPI").muteBucketOwner(b("CurrentUser").getID(),a,e),function(){g({type:b("FBStoriesMutedBucketOwnersActionTypes").SET_IS_CURRENTLY_MUTING,ownerID:a,value:!1})},function(){b("FBLogger")("fbstories").mustfix("failed to mute bucket with owner id: %s",a)}),g({type:b("FBStoriesMutedBucketOwnersActionTypes").SET_IS_CURRENTLY_MUTING,ownerID:a,value:!0}),g({type:b("FBStoriesMutedBucketOwnersActionTypes").UPDATE_MUTED_OPTIMISTIC,ownerID:a,ownerName:c,ownerProfilePictureUri:d,value:e})};return a}();e.exports=new a()}),null);
__d("FBStoriesActionsHelper",["FBStoriesStore","nullthrows"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g={},h=function(a,c){__p&&__p();var d=c?a+1:a-1,e=0,f=b("FBStoriesStore").getLastSeenThreadIndexForBucket(a),h=b("FBStoriesStore").hasSeenBucketInCurrentSession(a),j=g[a];if(!j)j={prev:null,next:null,curThreadIdx:f},g[a]=j;else{h&&(j.curThreadIdx=f);h=j.next!=null?g[j.next]:null;f=j.prev!=null?g[j.prev]:null;if(c&&h!=null&&h.curThreadIdx!=null){h.prev=a;return{nextBucketIndex:b("nullthrows")(j.next),nextThreadIndex:h.curThreadIdx}}else if(!c&&f!=null&&f.curThreadIdx!=null){f.next=a;return{nextBucketIndex:b("nullthrows")(j.prev),nextThreadIndex:f.curThreadIdx}}}h=!1;while(h===!1&&!i.checkAllBucketsViewed(d))e=b("FBStoriesStore").getUnseenThreadIndex(d),h=e>=0,h||(d=c?d+1:d-1);if(h){c?b("nullthrows")(j).next=d:b("nullthrows")(j).prev=d;f=g[d];f||(g[d]={prev:null,next:null,curThreadIdx:e},f=g[d]);c?b("nullthrows")(f).prev=a:b("nullthrows")(f).next=a}return{nextBucketIndex:d,nextThreadIndex:e}},i={checkAllBucketsViewed:function(a){var c=b("FBStoriesStore").getBucketCount();return a>=c||a<0},resetNavMap:function(){g={}},getNextBucketAndThreadIndex:function(a,c){var d=c?a+1:a-1,e=0;if(b("FBStoriesStore").isUnseenMode()){a=h(a,c);d=a.nextBucketIndex;e=a.nextThreadIndex}else c||(e=b("FBStoriesStore").getLastSeenThreadIndexForBucket(d));return{nextBucketIndex:d,nextThreadIndex:e}}};e.exports=i}),null);
__d("FBStoriesDataHelper",["CameraPostTypesHelper","CurrentUser","FBLogger","FBStoriesActions","FBStoriesActionTypes","FBStoriesBucketHelper","FBStoriesDispatcher","FBStoriesGating","FBStoriesGraphQLAPI","dotAccess","friendsBucketSorter","gkx","promiseDone"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g={getBucketsDataFromLoadedObject:function(a){__p&&__p();var c=g.getUserDataNodesFromLoadedObject(a);c=c[0];var d=g.getUserInfoFromLoadedObject(a);a=g.getFriendsBucketDataFromLoadedObject(a);a=a.reduce(function(a,c){__p&&__p();var d=b("FBStoriesBucketHelper").getThreads(c);d=d&&d.length>0;var e=b("FBStoriesBucketHelper").getCameraPostType(c),f=b("CameraPostTypesHelper").isStoryNux(e),g=b("CameraPostTypesHelper").isStory(e),h=b("CameraPostTypesHelper").isEventStory(e),i=b("CameraPostTypesHelper").isPageStory(e),j=b("CameraPostTypesHelper").isGroupStory(e);e=b("CameraPostTypesHelper").isBirthdayStory(e);var k=b("gkx")("678355");if(k&&b("FBStoriesBucketHelper").isOwnerEmployee(c))return a;if(f)return a;if(!d)return b("FBStoriesBucketHelper").isLive(c)?a.concat([c]):a;return g||i||h||j||e?a.concat([c]):a},[]);var e=b("FBStoriesGating").shouldUseTrayMigration();e||a.sort(b("friendsBucketSorter")(d.userID));return{userInfo:d,userBucketData:c,friendsBucketData:a}},hasData:function(a){return!a?!1:g.getFriendsBucketDataFromLoadedObject(a).length>0&&g.getUserDataNodesFromLoadedObject(a).length>0},getFriendsBucketDataFromLoadedObject:function(a){var c=b("FBStoriesGating").shouldUseTrayMigration();if(c){return((c=a)!=null?(c=c.me)!=null?(c=c.unified_stories_buckets)!=null?c.nodes:c:c:c)||[]}return((c=a)!=null?(c=c.me)!=null?(c=c.friends_stories_buckets)!=null?c.nodes:c:c:c)||[]},getUserDataNodesFromLoadedObject:function(a){return((a=a)!=null?(a=a.me)!=null?(a=a.story_bucket)!=null?a.nodes:a:a:a)||[]},getUserInfoFromLoadedObject:function(a){var b;return{userName:(b=a)!=null?(b=b.me)!=null?b.name:b:b,userID:(b=a)!=null?(b=b.me)!=null?b.id:b:b,userGender:(b=a)!=null?(b=b.me)!=null?b.gender:b:b,userProfilePic:(b=a)!=null?(b=b.me)!=null?b.profile_picture:b:b}},getFriendsDataWithEndedLiveBucket:function(a,c,d){__p&&__p();if(!c||d||!b("FBStoriesBucketHelper").isLive(c))return a;var e=b("FBStoriesBucketHelper").getId(c);d=!1;a=a.reduce(function(a,f){if(b("FBStoriesBucketHelper").getId(f)===e){d=!0;var g=!b("FBStoriesBucketHelper").isLive(f);c&&g&&(b("FBStoriesBucketHelper").setLiveVideo(f,c.live_video),b("FBStoriesBucketHelper").setHasLiveVideoEnded(f,!0))}a.push(f);return a},[]);d||(b("FBStoriesBucketHelper").setHasLiveVideoEnded(c,!0),a=[c].concat(a));return a},getMutedBucketOwnersFromLoadedQuery:function(a){a=((a=a)!=null?(a=a.me)!=null?(a=a.unfollowees_for_camera_post_story)!=null?a.edges:a:a:a)||[];return a.map(function(a){var b,c,d;a=a.node;d=(d=a)!=null?d.id:d;c=(c=a)!=null?c.name:c;b=(b=a)!=null?(b=b.profile_picture)!=null?b.uri:b:b;a=(a=a)!=null?(a=a.cover_photo)!=null?(a=a.photo)!=null?(a=a.image)!=null?a.uri:a:a:a:a;return{id:d,name:c,profilePictureUri:a?a:b,muted:!0}})},loadData:function(a){b("promiseDone")(b("FBStoriesGraphQLAPI").load(),function(a){a=g.getBucketsDataFromLoadedObject(a);b("FBStoriesDispatcher").dispatch({type:b("FBStoriesActionTypes").LOADED,data:a})},a?a:function(a){a=a.errors;a.length>0&&a[0].message&&b("FBLogger")("fbstories").mustfix("Error loading user tray data, err msg: %s",a[0].message)})},loadPageBucketData:function(a,c){b("promiseDone")(b("FBStoriesGraphQLAPI").loadPageBucketStoryData(a),function(a){a=b("dotAccess")(a,"node.page_story_bucket.nodes");(a||a.length>0)&&(b("FBStoriesActions").resetStore(),b("FBStoriesActions").loadData(b("CurrentUser").getName(),b("CurrentUser").getID(),null,null,[babelHelpers["extends"]({},a[0])]))},c?c:function(c){c=c.errors;c.length>0&&c[0].message&&b("FBLogger")("fbstories").mustfix("Error loading page story data, page id: %s, err msg: %s",a,c[0].message)})}};e.exports=g}),null);
__d("FBStoriesWWWPerfTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();function a(){this.$1={}}var c=a.prototype;c.log=function(){b("GeneratedLoggerUtils").log("logger:FBStoriesWWWPerfLoggerConfig",this.$1,b("Banzai").BASIC)};c.logVital=function(){b("GeneratedLoggerUtils").log("logger:FBStoriesWWWPerfLoggerConfig",this.$1,b("Banzai").VITAL)};c.logImmediately=function(){b("GeneratedLoggerUtils").log("logger:FBStoriesWWWPerfLoggerConfig",this.$1,{signal:!0})};c.clear=function(){this.$1={};return this};c.getData=function(){return babelHelpers["extends"]({},this.$1)};c.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};c.setEventTotalTime=function(a){this.$1.event_total_time=a;return this};c.setEventType=function(a){this.$1.event_type=a;return this};c.setTime=function(a){this.$1.time=a;return this};c.setVC=function(a){this.$1.vc=a;return this};c.setWeight=function(a){this.$1.weight=a;return this};return a}();c={event_total_time:!0,event_type:!0,time:!0,vc:!0,weight:!0};e.exports=a}),null);
__d("FBStoriesLoggingHelper",["BackstageMediaType","Banzai","DirectMessagingTypedLogger","FBLogger","FBStoriesBucketHelper","FBStoriesLoggingConstants","FBStoriesStore","FBStoriesWWWPerfTypedLogger","uuid"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=null,h={_traySessionID:null,_viewerSessionID:null,_eventStartTimes:{},logStoryTrayLoad:function(a){__p&&__p();this._traySessionID=b("uuid")();var c=a.userBucketData;a=a.friendsBucketData;var d=b("FBStoriesBucketHelper").hasData(c),e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=new Map();b("FBStoriesBucketHelper").isLive(c)&&g++;a.forEach(function(a){__p&&__p();e++;b("FBStoriesBucketHelper").getUnseenCount(a)>0&&f++;b("FBStoriesBucketHelper").isLive(a)&&g++;var c=b("FBStoriesBucketHelper").getLoggingType(a);switch(c){case b("FBStoriesLoggingConstants").PAGE_STORY:h++;break;case b("FBStoriesLoggingConstants").EVENT_STORY:i++;break;case b("FBStoriesLoggingConstants").GROUP_STORY:j++;break;case b("FBStoriesLoggingConstants").STORY_PROMOTION:k++;break;case b("FBStoriesLoggingConstants").FOLLOWEE_STORY:l++;break;case b("FBStoriesLoggingConstants").FRIEND_STORY:m++;break;default:b("FBLogger")("fbstories").mustfix("storyOwnerType not found: %s",c)}c=b("FBStoriesBucketHelper").getOwnerId(a);var d=b("FBStoriesBucketHelper").getThreadIDs(a);if(b("FBStoriesBucketHelper").isLive(a)){a=(a=b("FBStoriesBucketHelper").getLiveVideo(a))!=null?a.id:a;a&&d.push(a)}n.set(c,d)});this._getLogger().setName(b("FBStoriesLoggingConstants").ACTION_TRAY_LOAD).setHasMyStory(d).setNumberStories(e).setNumberNewStories(f).setNumberLiveStories(g).setLiveStoriesInTray(g).setPageStoriesInTray(h).setGroupStoriesInTray(j).setEventStoriesInTray(i).setFolloweeStoriesInTray(l).setFriendStoriesInTray(m).setPromotionStoriesInTray(k).setClientStoryThreadIds(n).setTraySessionID(this._traySessionID).log()},storyLog:function(a,c){g==null&&(g=c);a===b("FBStoriesLoggingConstants").ACTION_OPEN_STORY&&!this._viewerSessionID&&(this._viewerSessionID=b("uuid")());var d=b("FBStoriesStore").getSelectedBucketCameraPostType(),e=b("FBStoriesStore").getSelectedBucketOwnerID(),f=b("FBStoriesStore").getSelectedBucketOwnerType(),h=b("FBStoriesStore").getThreadCountForSelectedBucket(),i=b("FBStoriesStore").getSelectedBucketUnseenCount()>0,j=b("FBStoriesStore").getSelectedBucketIndex();d=this._getLogger().setCameraPostType(d).setName(a).setSource(c==null?g:c).setStoryOwner(e).setStoryOwnerType(f).setThreadCount(h).setHasNewContent(i).setStoryIndex(j).setTraySessionID(this._traySessionID).setClientViewerSessionID(this._viewerSessionID);d.log();b("Banzai").post("stories_interaction_poseidon_logging_banzai",{name:a,source:c,story_owner:String(e),number_media:String(h)})},storyInsightsLog:function(a){b("Banzai").post("fb_stories_insights_logging_banzai",a.getData())},getLoggingMediaType:function(a){var c=b("BackstageMediaType").UNKNOWN;a==="Photo"?c=b("BackstageMediaType").PHOTO:a==="Video"?c=b("BackstageMediaType").VIDEO:a===b("BackstageMediaType").LIVE&&(c=b("BackstageMediaType").LIVE);return c},getMediaLogger:function(a,c,d){d=d||{cameraPostType:b("FBStoriesStore").getCurrentThreadCameraPostTypeForSelectedBucket(),storyOwnerFbid:b("FBStoriesStore").getSelectedBucketOwnerID(),storyOwnerType:b("FBStoriesStore").getSelectedBucketOwnerType(),mediaID:b("FBStoriesStore").getCurrentThreadMediaIDForSelectedBucket(),mediaType:b("FBStoriesStore").getCurrentThreadMediaTypeForSelectedBucket(),viewers:b("FBStoriesStore").getCurrentThreadMediaViewerCountForSelectedBucket(),bucketIndex:b("FBStoriesStore").getSelectedBucketIndex(),threadIndex:b("FBStoriesStore").getCurrentThreadIndexForSelectedBucket(),threadID:b("FBStoriesStore").getCurrentThreadIDForSelectedBucket(),threadCount:b("FBStoriesStore").getThreadCountForSelectedBucket()};var e=d.cameraPostType,f=d.storyOwnerFbid,g=d.storyOwnerType,h=d.mediaID,i=d.mediaType,j=d.viewers,k=d.bucketIndex,l=d.threadIndex,m=d.threadID;d=d.threadCount;m=m?m.toString():"";i=this.getLoggingMediaType(i);c=c||b("FBStoriesLoggingConstants").SOURCES.UNKNOWN;return this._getLogger().setCameraPostType(e).setName(a).setSource(c).setStoryOwner(f).setStoryOwnerType(g).setMediaType(i).setClientMediaID(h).setNumberViewers(j).setCardID(m).setStoryIndex(k).setMediaIndex(l).setNumberMedia(d).setTraySessionID(this._traySessionID).setClientViewerSessionID(this._viewerSessionID).setExtraClientData(JSON.stringify({story_size:d}))},mediaLog:function(a,b,c){this.getMediaLogger(a,b,c).log()},_getLogger:function(){return new(b("DirectMessagingTypedLogger"))()},openMediaLog:function(a,c){var d=b("FBStoriesStore").getFeedTrackingData(b("FBStoriesLoggingConstants").ACTION_OPEN_MEDIA);b("Banzai").post("stories_www_vpv_banzai",{media_id:b("FBStoriesStore").getCurrentThreadMediaIDForSelectedBucket(),owner_id:b("FBStoriesStore").getSelectedBucketOwnerID()});b("Banzai").post("fb_stories_banzai_generic",{ft:d});h.mediaLog(b("FBStoriesLoggingConstants").ACTION_OPEN_MEDIA,a,c)},deleteMediaLog:function(){h.mediaLog(b("FBStoriesLoggingConstants").ACTION_DELETE_MEDIA)},openSeenSummaryLog:function(){h.mediaLog(b("FBStoriesLoggingConstants").ACTION_OPEN_SEEN_SUMMARY)},storyNavigationLog:function(a){a=h.getMediaLogger(b("FBStoriesLoggingConstants").ACTION_STORY_NAVIGATION).setGesture(a);a.log();h.storyInsightsLog(a)},closeStoryLog:function(a,c){var d=b("FBStoriesLoggingConstants").ACTION_CLOSE_STORY;a=h.getMediaLogger(b("FBStoriesLoggingConstants").ACTION_CLOSE_STORY).setGesture(a).setActionSource(c);a.log();h.storyInsightsLog(a);a=b("FBStoriesStore").getSelectedBucketOwnerID();var e=b("FBStoriesStore").getThreadCountForSelectedBucket();b("Banzai").post("stories_interaction_poseidon_logging_banzai",{name:d,source:c,story_owner:String(a),number_media:String(e)});this._viewerSessionID=null}};e.exports=h}),null);
__d("FBStoriesPrefetcher",["Bootloader","FBStoriesActionsHelper","FBStoriesStore"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={prefetchForCurrentThreadAndBucket:function(){this.prefetch(b("FBStoriesStore").getSelectedBucketIndex(),b("FBStoriesStore").getCurrentThreadIndexForSelectedBucket())},prefetch:function(a,b){this._prefetchVideos(a,b)},_prefetchVideos:function(a,b){this._prefetchThreadVideo(a,b),this._prefetchForwardVideo(a,b),this._prefetchBackwardsVideo(a,b)},_prefetchForwardVideo:function(a,b){this._prefetchVideo(!0,a,b)},_prefetchBackwardsVideo:function(a,b){this._prefetchVideo(!1,a,b)},_prefetchVideo:function(a,c,d){__p&&__p();var e=b("FBStoriesStore").getThreadCount(c);d=a?d+1:d-1;while(d>=0&&d<e){if(this._prefetchThreadVideo(c,d))return!0;d=a?d+1:d-1}d=c;while(!b("FBStoriesActionsHelper").checkAllBucketsViewed(d)){e=b("FBStoriesActionsHelper").getNextBucketAndThreadIndex(d,a);c=e.nextBucketIndex;e=e.nextThreadIndex;if(this._prefetchThreadVideo(c,e))return!0;d=c}return!1},_prefetchThreadVideo:function(a,c){var d=b("FBStoriesStore").getVideoMediaIdForBucketIndexAndThreadIndex(a,c);if(!d)return!1;b("Bootloader").loadModules(["VideoPlayerMetaData"],function(a){a.genVideoData(d,{allowDashPrefetch:!0,forceHD:!0})},"FBStoriesPrefetcher");return!0}};e.exports=a}),null);