var PopIn5Conf=PopIn5Conf||{status:0};if(PopIn5Conf.status===0){PopIn5Conf.status=1;PopIn5Conf.load=function(a,b){if(typeof _popIn5_config!="undefined"&&typeof _popIn5_config[a]!="undefined"){b(_popIn5_config[a])}}}(function(){if(typeof window.PopIn5!="undefined"){return}window.PopIn5={};if((typeof window.performance!=="undefined")&&(typeof window.performance.getEntries==="function")){PopIn5.__PERFORMANCE_DISCOVERY_INIT__=window.performance.now()}PopIn5.ajaxCache=[];PopIn5.load=function(b){var a=this;var d={func:b,self:this,loaded:false};var e=function(){if(!d.loaded){d.loaded=true;d.func()}};if(PopIn5.$F.isIE6||PopIn5.$F.isIE7){return}if(!PopIn5.$F.isIE8&&!PopIn5.$F.isIE9){setTimeout(e,1)}else{var c="readyState" in document?document.readyState:null;if(c){if(c==="complete"||c==="loaded"){e()}else{if(typeof document.attachEvent!=="undefined"){document.attachEvent("onreadystatechange",function(){if(document.readyState==="complete"){e()}})}else{if(typeof document.addEventListener!=="undefined"){document.addEventListener(document,"readystatechange",function(){if(document.readyState==="complete"){e()}})}}}}}};PopIn5.Loader={loaded:false,toLoad:[],start:function(){this.timeStart=new Date().getTime();var b=function(c){PopIn5.Loader.exec()};if(typeof document.addEventListener!=="undefined"){document.addEventListener("DOMContentLoaded",b,false)}var a="readyState" in document?document.readyState:null;if(a==="complete"||a==="interactive"||a==="loaded"){setTimeout(b,1)}},exec:function(){if(this.loaded){return}this.timeLoad=new Date().getTime();this.loadScroll=document.body.scrollTop||document.documentElement.scrollTop;this.loaded=true;for(var a=0,b=this.toLoad.length;a<b;a++){this.toLoad[a]()}this.toLoad=[]},load:function(a){if(this.loaded){return a()}this.toLoad.push(a)}};PopIn5.Loader.start();PopIn5.Class=function(d,c,b){if(typeof PopIn5[d]==="undefined"){PopIn5[d]={}}if(typeof PopIn5[d][c]!=="undefined"){return}var a=PopIn5[d];a[c]=function(){if(this.init){this.init.apply(this,arguments)}};a[c].prototype=b;a[c].prototype._package=d;a[c].prototype._className=c};PopIn5.ClassLoad=function(d,c,a){if(typeof PopIn5[d]!=="undefined"&&typeof PopIn5[d][c]!=="undefined"){return}PopIn5.Class(d,c,a);var b=function(){var e=new PopIn5[d][c]()};setTimeout(function(){PopIn5.load(b)},1)};PopIn5.StaticClass=function(d,c,b){if(typeof PopIn5[d]!=="undefined"&&(c===""||typeof PopIn5[d][c]!=="undefined")){return}if(typeof PopIn5[d]==="undefined"){PopIn5[d]={}}if(c!==""){var a=PopIn5[d];a[c]=b}else{PopIn5[d]=b}if(b.init){b.init()}};PopIn5.ErrorSafeStaticClass=function(d,c,b){for(var a in b){(function(e){var f=b[e];if(typeof f!="function"){return}b[e]=function(){try{return f.apply(this,arguments)}catch(g){}}})(a)}PopIn5.StaticClass(d,c,b)};PopIn5.Module=function(b,a){if(typeof PopIn5[b]!=="undefined"&&typeof PopIn5[b].Main!=="undefined"){return}PopIn5.Class(b,"Main",a);setTimeout(function(){var c=function(d){var e=function(){while(typeof d==="function"){d=d()}if(PopIn5.$F.notEmpty(d)){var f=new PopIn5[b].Main();f._config=new PopIn5[b].Config(d);f.initModule();PopIn5[b]._instance=f}};if(PopIn5.$F.notEmpty(d.load)&&d.load=="fast"){e()}else{PopIn5.load(e)}};PopIn5Conf.load(b,c)},1)}})();PopIn5.StaticClass("$","Config",{init:function(){this.setDefaults()},afterInit:function(){var a=this;PopIn5Conf.load("*",function(b){if(typeof b==="function"){b=b()}a.overrideAll(a,b);a.afterConfig()});PopIn5.Loader.load(function(){var b=PopIn5.$.Config;if(PopIn5.$F.notEmpty(b.articleSelector)){var d=PopIn5.$F.selector(b.articleSelector);b.isArticle=PopIn5.$F.notEmpty(d)}if(PopIn5.$F.notEmpty(b.articleFilter.url)){b.isArticle=PopIn5.$F.testOne(b.articleFilter.url,b.target)}for(var c in b.eventHandlers){PopIn5.$.Global.event.addEventListener(c,b.eventHandlers[c])}b.onLoad()},0)},overrideAll:function(c,a){for(var b in a){if(a.hasOwnProperty(b)){if(typeof c[b]=="object"&&typeof a[b]=="object"&&!PopIn5.$F.isArray(c[b])){this.overrideAll(c[b],a[b])}else{c[b]=a[b]}}}},setDefaults:function(){this.pid="0";this.partnerDomain=location.host;this.includeFilter={};this.urlReplace=[];this.displayUrlReplace=[];this.target=location.href;this.country=false;this.contextFactory=false;this.contextSelector="body";this.isArticle=true;this.articleSelector="";this.articleFilter={};this.readArticle=false;this.eventHandlers={};this.onLoad=function(){}},afterConfig:function(){this.target=PopIn5.$F.replaceAll(this.target,this.urlReplace)}});PopIn5.StaticClass("$","Context",{init:function(){var a=this;this.contexts=[];setTimeout(function(){if(PopIn5.$F.notEmpty(PopIn5.$.Config.contextFactory)){setInterval(function(){var b=PopIn5.$.Config.contextFactory();if(PopIn5.$F.notEmpty(b)){PopIn5.$.Global.event.fireEvent("newContext",[b])}},500)}else{if(PopIn5.$.Config.contextSelector=="body"){a.createContext(document.body)}else{setInterval(function(){var e=document.querySelectorAll(PopIn5.$.Config.contextSelector);for(var d=0;d<e.length;d++){var c=e[d];var b=a.getContext(c);if(b===false){b=a.createContext(c);PopIn5.$.Global.event.fireEvent("newContext",[b])}}},500)}}},1)},findContext:function(b){var a=this.getContext(b);return a===false?this.findContext(b.parentNode):a},getContext:function(c){for(var b=0;b<this.contexts.length;b++){var a=this.contexts[b];if(a.key===c){return a}}return false},createContext:function(b){var a={idx:this.contexts.length,configs:{},key:b,segmentData:{},target:PopIn5.$.Config.target};this.contexts.push(a);return a}});PopIn5.StaticClass("Cookie","",{init:function(){},setCookie:function(d,f,c){var a="";c=c||{};if(c.expires&&(typeof c.expires=="number"||c.expires.toUTCString)){var b;if(typeof c.expires=="number"){b=new Date();b.setTime(b.getTime()+(c.expires*24*60*60*1000))}else{b=c.expires}a="; expires="+b.toUTCString()}var h=c.path?"; path="+(c.path):"";var e=c.domain?"; domain="+(c.domain):"";var g=c.secure?"; secure":"";f=c.noencode?f:encodeURIComponent(f);document.cookie=[d,"=",f,a,h,e,g].join("")},getCookie:function(b){if(!navigator.cookieEnabled||document.cookie===""){return null}b=b.replace(/\W/g,"\\$&");var c=new RegExp("(?:^|;)\\s?"+b+"=([^;]*)","i"),a=document.cookie.match(c);return a&&decodeURIComponent(a[1])},removeCookie:function(a){this.setCookie(a,"",{expires:-1})}});PopIn5.StaticClass("$F","",{init:function(){this.inViewData=[];this.nua=navigator.userAgent;this.detectBrowser(this.nua.toLowerCase());this.cssExclude=/z-?index|font-?weight|opacity|zoom|line-?height/;this.boxModel=false;this.validDocType=this.isIE?(document.getElementById&&(document.compatMode=="CSS1Compat")):true;for(var a in PopIn5.$){var b=PopIn5.$[a];if(typeof b.afterInit==="function"){b.afterInit()}}},detectBrowser:function(g){this.browser="\v"=="v"?"ie":"firefox";this.browserType="unknown";var f=[["Firefox","firefox"],["Firefox3","firefox","3.0."],["IE","msie"],["IE6","msie 6"],["IE7","msie 7"],["IE8","msie 8"],["IE9","msie 9"],["IE10","msie 10"],["iPhone","iphone"],["iPad","ipad"],["iPod","ipod"],["Safari","safari"],["Chrome","chrome"],["Android","android"],["Windows","windows"],["Mac","mac"],["OperaMobile","opera mini","opera mobi"],["UCBrowser","ucbrowser"]];for(var e=0,h=f.length;e<h;e++){var d=f[e];var c=false;for(var b=1,a=d.length;b<a;b++){if(g.indexOf(d[b])!==-1){c=true}}this["is"+d[0]]=c;if(c===true){this.browserType=d[0]}}},isMobileDevice:function(){return this.isiPhone||this.isiPod||(this.isAndroid&&this.nua.toLowerCase().indexOf("mobile")!==-1)||this.isUCBrowser||this.isOperaMobile},isTabletDevice:function(){return(this.isAndroid&&this.nua.toLowerCase().indexOf("mobile")===-1)||this.isiPad},getPlatform:function(){var a="other";if(this.isiPhone||this.isiPod||this.isiPad){a="ios"}else{if(this.isAndroid){a="android"}else{if(this.isWindows){a="win"}else{if(this.isMac){a="mac"}}}}return a},getPageScrollTop:function(){if(!document.body){return 0}return document.body.scrollTop||document.documentElement.scrollTop},getWindowWidth:function(){var b=window;var a=b.document;return b.innerWidth||a.documentElement.clientWidth||a.body.clientWidth||a.scrollWidth},getWindowHeight:function(){var b=window;var a=b.document;return b.innerHeight||a.documentElement.clientHeight||a.body.clientHeight||a.body.scrollHeight},isEmpty:function(a){return !this.notEmpty(a)},notEmpty:function(a){return typeof a!="undefined"&&a!=""&&a!=0&&a!=false&&a!=null},firstNotEmpty:function(){for(var a=0,b=arguments.length;a<b;a++){if(this.notEmpty(arguments[a]||a===arguments.length-1)){return arguments[a]}}},testOne:function(c,d){for(var a=c.length;a-->0;){var b=new RegExp(c[a]);if(b.test(d)){return true}}return false},replaceAll:function(f,e){var c=f;for(var b=0,g=e.length;b<g;b++){var d=e[b];for(var a in d){c=c.replace(new RegExp(a),d[a])}}return c},parseUrl:function(a){var b={};if(a.indexOf("?")>0){qString=a.substring(a.indexOf("?"));a=a.substring(0,a.indexOf("?"));qString.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(d,c,f,e){b[c]=e})}return{url:a,qString:b}},parseUri:function(c){var b=/^(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/;var a=c.match(b);if(a){return{scheme:a[1],host:a[2],path:a[3],query:a[4],fragment:a[5]}}else{return null}},digest:function(g){var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!$".split("");var d=0,e="",c;for(var b=0,h=g.length;b<h;b++){c=g.charCodeAt(b);d=((d<<5)-d)+c;d|=0}for(var a=0;a<6;a++){e+=f[d&63];d>>>=6}return e},getInnerText:function(b){var a=b.innerText||b.textContent||b.data;return PopIn5.$F.notEmpty(a)?a:""},ajax_counter:0,ajax:function(){var d;if(arguments.length===2){d={url:arguments[0],success:arguments[1]}}else{if(arguments.length===1&&typeof arguments[0]==="object"){d=arguments[0]}else{throw"Invalid Arguments"}}var c=function(){};var j="pop"+new Date().getTime().toString(16)+"_";var a=d.callbackname?d.callbackname:j+this.ajax_counter++;var f=document.getElementsByTagName("head")[0];window[a]=function(g){window[a]=undefined;try{delete window[a]}catch(e){}if("callback" in d){window[d.callback](g)}if("success" in d){d.success(g)}try{setTimeout(c,10)}catch(e){}};var i=document.createElement("script");i.charset="utf-8";var b=d.url;b+=((b.indexOf("?")>=0)?"&":"?")+(d.callbackParameterName?d.callbackParameterName:"callback")+"="+encodeURIComponent(a);if(d.iframeLoad){var h=[];h.push('<body onload="');h.push("var js = document.createElement('script');");h.push("js.src = '"+b+"';");h.push("var d = document;d.getElementsByTagName('head')[0].appendChild(js);\">");h.push("<script type='text/javascript'>");h.push("window['"+a+"'] = function(data) {");h.push("parent['"+a+"'](data);");h.push("};");h.push("\x3c/script>");h.push("</body>");PopIn5.$F.iframeLoader(h.join(""),{width:1,height:1,css:{display:"none"}});c=function(){PopIn5.$F.remove(iframe)};return}i.src=b;if(d.charset){i.charset=d.charset}f.appendChild(i);c=function(){PopIn5.$F.remove(i)}},isArray:function(a){var b=Object.prototype.toString;return b.call(a)==="[object Array]"},join:function(d,c){var m;if(PopIn5.$F.isEmpty(d)){d={}}if(PopIn5.$F.isEmpty(c)){c={}}if(typeof d!=="object"||typeof c!=="object"){return}if(typeof d.length==="number"&&typeof c.length==="number"){m=[];for(var g=0,a=d.length;g<a;g++){m.push(d[g])}for(var f=0,h=c.length;f<h;f++){m.push(c[f])}return m}else{m={};for(var e in d){m[e]=d[e]}for(var b in c){m[b]=c[b]}return m}},pass:function(c,d,a){if(PopIn5.$F.isEmpty(a)){a=[]}var b=c;return function(){return b.apply(d,a)}},bind:function(a,e,b,d){var f=function(){return true};if(e=="mouseenter"&&!this.isIE){e="mouseover";f=function(h){var i=h.relatedTarget||h.fromElement;var g=true;while(g&&i){if(i==a){g=false}i=i.parentNode}return g}}if(e=="mouseleave"&&!this.isIE){e="mouseout";f=function(h){var i=h.relatedTarget||h.toElement;var g=true;while(g&&i){if(i==a){g=false}i=i.parentNode}return g}}var c=function(h){h=h||window.event;if(f.apply(this,[h])){var g=b.apply(a,[h,d]);if(!PopIn5.$F.isIE&&g===false){h.preventDefault();h.stopPropagation()}else{if(PopIn5.$F.isIE&&g===false){h.returnValue=false;h.cancelBubble=true}}}};if(a.addEventListener){a.addEventListener(e,c,false)}else{if(a.attachEvent){a.attachEvent("on"+e,c)}}return a},insertAdjacentElement:function(b,c,a){c=c.toLowerCase();switch(c){case"beforebegin":b.parentNode.insertBefore(a,b);break;case"afterend":b.parentNode.insertBefore(a,b.nextSibling);break;case"afterbegin":b.insertBefore(a,b.firstChild);break;case"beforeend":b.appendChild(a);break}},selector:function(){if(arguments.length===1){return document.querySelector(arguments[0])}else{if(arguments.length===2){try{return arguments[0].querySelectorAll(arguments[1])}catch(a){return[]}}}},oneSelector:function(b,a){return b.querySelectorAll(a)[0]},makeListener:function(a){a._listeners={};a.addEventListener=function(b,c){if(!this._listeners[b]){this._listeners[b]=[]}this._listeners[b].push(c)};a.fireEvent=function(c,b){if(this._listeners[c]){for(var d=0,f=this._listeners[c].length;d<f;d++){var e=this._listeners[c][d];e.apply(this,b)}}}},hasClass:function(b,a){return new RegExp("(\\s|^)"+a+"(\\s|$)").test(b.className)},addClass:function(b,a){if(!this.hasClass(b,a)){b.className+=(b.className?" ":"")+a}},removeClass:function(b,a){if(this.hasClass(b,a)){b.className=b.className.replace(new RegExp("(\\s|^)"+a+"(\\s|$)")," ").replace(/^\s+|\s+$/g,"")}},aspectBefore:function(d,c,b){var a=d[c];d[c]=function(){b.apply(this,arguments);return a.apply(this,arguments)}},aspectAfter:function(d,c,b){var a=d[c];d[c]=function(){var e=a.apply(this,arguments);b.apply(this,arguments);return e}},appendCSS:function(a){var b=document.createElement("style");b.type="text/css";b.rel="stylesheet";b.charSet="UTF-8";document.getElementsByTagName("head")[0].appendChild(b);if(b.styleSheet){b.styleSheet.cssText=a}else{b.appendChild(document.createTextNode(a))}},iframeLoader:function(e,c){var d=PopIn5.$F.notEmpty(c.parentNode)?c.parentNode:document.body;var b=PopIn5.$F.ce(d,"iframe");for(var a in c){if(a==="parentNode"){continue}else{if(a==="css"){PopIn5.$F.css(b,c[a])}else{if(c.hasOwnProperty(a)){b.setAttribute(a,c[a])}}}}if(PopIn5.$F.notEmpty(e)){var f=(b.contentWindow)?b.contentWindow:(b.contentDocument.document)?b.contentDocument.document:b.contentDocument;f.document.open();f.document.write(e);f.document.close();return f}return null},cio:function(a,c){a=a||"about:self";c=c||{};var d=(typeof c.pnode!=="undefined"&&typeof c.pnode.nodeValue!=="undefined")?c.pnode:document.body;var b=PopIn5.$F.ce(d,"iframe");b.src=a;b.setAttribute("scrolling","no");b.setAttribute("frameBorder","0");b.setAttribute("allowTransparency","true");(function(f){f.display="block";f.width="0px";f.height="0px";f.margin="0px";f.padding="0px";f.overflow="none"})(b.style);var e={element:b,document:b.contentDocument||b.contentWindow.document,window:(b.contentWindow)?b.contentWindow:(b.contentDocument.document)?b.contentDocument.document:b.contentDocument,write:function(f){e.document.open();e.document.write(f);e.document.close()}};return e},getMessage:function(a,b){var c=PopIn5.$F.iframeLoader("",{src:a,width:1,height:1,name:"popIniframe",css:{display:"none"}});PopIn5.$F.bind(window,"message",function(d){if(c===d.source){b(d.data)}})},inView:function(b){var c={element:false,offset:0,complete:function(){},showArea:0};this.inViewData.push(PopIn5.$F.join(c,b));var a=this;if(this.inViewData.length==1){this.inViewInterval=setInterval(function(){a.inViewHandleScroll()},100)}},inViewHandleScroll:function(){var c=PopIn5.$F.getPageScrollTop();var a=PopIn5.$F.getWindowHeight();var l=[];for(var d=0;d<this.inViewData.length;d++){var g=this.inViewData[d];var f=g.element;var k=PopIn5.$F.position(f).top;var m=PopIn5.$F.size(f);if(typeof f.__popInRealHeight__==="undefined"&&m.height===0&&f.style.height===""){var b=f.style.overflow;if(b===""||b==="visible"){f.style.overflow="hidden";f.__popInRealHeight__=f.offsetHeight;f.style.overflow=b}}var j=m.height>0?m.height:(f.__popInRealHeight__||0);if(m.width*j>0&&c+a+g.offset>k+g.showArea*j){try{g.complete()}catch(h){}}else{l.push(g)}}this.inViewData=l;if(l.length===0){clearInterval(this.inViewInterval)}},isSupportStorage:function(){try{return !!window.localStorage.getItem&&!!window.sessionStorage.getItem}catch(a){return false}},lsGet:function(a){try{return window.localStorage.getItem(a)}catch(b){return false}},lsRemove:function(a){try{window.localStorage.removeItem(a)}catch(b){return false}},lsSet:function(a,b){try{return window.localStorage.setItem(a,b)}catch(c){return false}},ssGet:function(a){try{return window.sessionStorage.getItem(a)}catch(b){return false}},ssRemove:function(a){try{window.sessionStorage.removeItem(a)}catch(b){return false}},ssSet:function(a,b){try{window.sessionStorage.setItem(a,b)}catch(c){return false}},toCamelCase:function(e){var c=e.split("-");if(c.length==1){return c[0]}var a=(e.indexOf("-")===0)?c[0].charAt(0).toUpperCase()+c[0].substring(1):c[0];for(var b=1,f=c.length;b<f;b++){var d=c[b];a+=d.charAt(0).toUpperCase()+d.substring(1)}return a},cssGet:function(c,b){var d=PopIn5.$F.toCamelCase(b),a=c.style[d];if(!a){if(document.defaultView){a=document.defaultView.getComputedStyle(c,"").getPropertyValue(b)}else{if(c.currentStyle){a=c.currentStyle[d]}else{if(c.style.getPropertyValue){a=c.style.getPropertyValue(b)}}}}if(!a&&b=="opacity"){return 1}return a},CSS_NEED_PREFIX:{transition:true,"transition-timing-function":true,"transition-duration":true,"transition-property":true,transform:true,"transform-origin":true,"backface-visibility":true},cssSet:function(b,a,c){if(typeof c=="number"&&!this.cssExclude.test(a)){c+="px"}if(a in this.CSS_NEED_PREFIX&&a.indexOf("-")!==0){a=(this.isIE?"-ms-":this.isFirefox?"-moz-":window.opera?"-o-":"-webkit-")+a;if(a.indexOf("transition")!=-1&&c.indexOf("transform")!=-1){c=a.substring(0,a.indexOf("transition"))+c}}if(!this.isIE){b.style.setProperty(a,c,null)}else{if(a.indexOf("-")>0){a=a.replace(/\-(\w)/g,function(e,f){return f.toUpperCase()})}try{b.style[a]=c}catch(d){}}},css:function(){var c=arguments[0];if(typeof arguments[1]==="string"&&arguments.length===2){return this.cssGet(c,arguments[1])}else{if(typeof arguments[1]==="string"&&arguments.length===3){this.cssSet(c,arguments[1],arguments[2]);return c}else{if(typeof arguments[1]==="object"){var b=arguments[1];for(var a in b){this.cssSet(c,a,b[a])}return c}}}},size:function(a){return{width:a.offsetWidth,height:a.offsetHeight}},position:function(c){if(c.getBoundingClientRect){var f=c.getBoundingClientRect();var b=document.documentElement;var a=document.body;return{left:Math.round(f.left+(a.scrollLeft||b.scrollLeft)-b.clientLeft),top:Math.round(f.top+(a.scrollTop||b.scrollTop)-b.clientTop)}}else{var e=0,d=0;for(;typeof c!=="undefined";c=c.offsetParent){d+=c.offsetLeft;e+=c.offsetTop}return{top:e,left:d}}},ce:function(a,c,d){var b=a.appendChild(document.createElement(c));if(PopIn5.$F.notEmpty(d)){b.appendChild(document.createTextNode(d))}return b},remove:function(a){if(a.parentNode){a.parentNode.removeChild(a)}return a},getParameterMap:function(){if(PopIn5.$F.notEmpty(this.parameterMap)){return this.parameterMap}if(typeof window._pop=="undefined"){return{}}var b=window._pop;var f={};for(var e=0,h=b.length;e<h;e++){var d=b[e];var c=d[0];var a=c.substring(0,5);var g=c.substring(5);if(a=="_set_"){f[g]=d[1]}if(a=="_add_"){if(PopIn5.isArray(f[g])){f[g].push(d[1])}else{if(PopIn5.$F.notEmpty(f[g])){f[g]=[f[g],d[1]]}else{f[g]=[d[1]]}}}}this.parameterMap=f;return f},getParam:function(a,b){this.paramMap=this.getParameterMap();if(typeof this.paramMap[a]!="undefined"){return this.paramMap[a]}if(typeof window["_popin_"+a]!="undefined"){return window["_popin_"+a]}if(typeof window["_popIn_"+a]!="undefined"){return window["_popIn_"+a]}return b},pageScrollTop:function(){return document.body.scrollTop||document.documentElement.scrollTop}});PopIn5.StaticClass("$","Global",{init:function(){this.uid="";this.device=PopIn5.$F.isMobileDevice()?"mobile":PopIn5.$F.isTabletDevice()?"tablet":"pc";this.deviceForAd=PopIn5.$F.isMobileDevice()?"mobile":"pc";this.protocol=(/^https:/.test(window.location.protocol)===true)?"https:":"http:";this.referrer="other";var e=[["news.google.co","portal_google"],["search.yahoo.co","search_yahoo"],["facebook.co","sns_facebook"],["twitter.co","sns_twitter"],["t.co$","sns_twitter"],["yahoo.co","portal_yahoo"],["goo.ne","portal_goo"],["infoseek.co","portal_infoseek"],["msn.com","portal_msn"],["excite.co.jp","portal_excite"],["livedoor.com","portal_livedoor"],["search.naver.com","search_naver"],["naver.com|naver.jp","sns_naver"],["hatena.ne.jp","sns_hatena"],["aol.jp","portal_aol"],["google.co","search_google"],["www.bing.com","search_bing"],["www.biglobe.ne.jp","portal_biglobe"],["www.smartnews.be|www.smartnews.com","app_smartnews"],["gunosy.com","app_gunosy"],["newspicks.com","app_newspicks"],["antenna.jp","app_antenna"],["paid.outbrain.com","paid_outbrain"],["trc.taboola.com","paid_yahoo"],["dsp.logly.co.jp","paid_logly"]];var d=location.host;e.push([d,"site"]);var c=PopIn5.$F.parseUri(document.referrer);for(var b=0,f=e.length;b<f;b++){var a=e[b];if(RegExp(a[0]).test(c.host)){this.referrer=a[1];break}}if(document.referrer===""){this.referrer="organic"}if(location.href.indexOf("utm_medium=logly")>-1){this.referrer="paid_logly"}this.baseDomain=typeof window._popIn_ad_block_enable!=="undefined"?"api.popin.cc":"i.popincdn.com";this.event={};PopIn5.$F.makeListener(this.event)}});PopIn5.StaticClass("$","Language",{init:function(){this.countries={};this.countries.jp={video_button_detail:"詳しくはこちら",video_button_calendar:"カレンダーに登録",video_button_share:"この動画をシェアする",video_counter_before:"再生回数 ",video_counter_after:"回",video_end_replay:"動画をリプレイ",video_end_detail:"詳しくはこちら",read_debug_container:"本文領域",read_debug_info_view:"本文表示率:",read_debug_info_read:"読了率:",read_debug_info_time:"読む時間:",read_debug_info_sec:"秒"};this.countries.tw={video_button_detail:"深入了解",video_button_calendar:"カレンダーに登録",video_counter_before:"觀看次數 ",video_counter_after:"次",video_end_replay:"再看一次",video_end_detail:"瞭解詳情",read_debug_container:"正文",read_debug_info_view:"正文顯示率:",read_debug_info_read:"正文閱讀率:",read_debug_info_time:"正文閱讀時間:",read_debug_info_sec:"秒"};this.countries.kr={video_button_detail:"詳しくはこちら",video_button_calendar:"カレンダーに登録",video_counter_before:"再生回数 ",video_counter_after:"回",video_end_replay:"動画をリプレイ",video_end_detail:"詳しくはこちら",read_debug_container:"本文領域",read_debug_info_view:"本文表示率:",read_debug_info_read:"読む時間:",read_debug_info_time:"読む時間:",read_debug_info_sec:"秒"}},getCurrent:function(){try{if(!this._curr){this._curr=this.countries[PopIn5.$.Config.country||"jp"]}return this._curr}catch(a){return{}}},getMessage:function(a){var b=this.getCurrent();return PopIn5.$F.notEmpty(b[a])?b[a]:a}});PopIn5.StaticClass("$","Log",{init:function(){this.history=[];this.category="";this.commonCategory="";this.enabled=true;PopIn5.$.Log.logDocument=document;if(PopIn5.$F.isIE){return}PopIn5.Loader.load(function(){var a=[];a.push("<body>");a.push("</body>");var b=PopIn5.$F.iframeLoader(a.join(""),{id:"_popIn_log",width:1,height:1,css:{display:"none"}});PopIn5.$.Log.logDocument=b.document;return})},uniqueLog:function(a,b,k){var g=false;var d=PopIn5.$F.isArray(a)?a:[a];for(var f=0,c=this.history.length;f<c;f++){var h=true;for(var e=0;e<d.length;e++){h=h&&(this.history[f].indexOf(d[e])>=0)}g=g||h}if(!g){this.log(b,k)}},log:function(b,a){if(!this.enabled){return}a=this.parseOptions(a);this.history.push(b);var d=this.logDocument;if(a.type=="image"){var c=new Image();if(PopIn5.$F.notEmpty(a.onLoad)){c.onload=a.onLoad}if(PopIn5.$F.notEmpty(a.onError)){c.onerror=a.onError}c.src=b}},parseOptions:function(a){var b={type:"image",onError:function(c){}};if(typeof a=="undefined"){a={}}PopIn5.$.Config.overrideAll(a,b);return a},logBuilder:function(b){var a={url:b,params:[],add:function(c,d){this.params.push([c,d]);return this},build:function(){var d={};var m=[];for(var h=0;h<this.params.length;h++){var f=this.params[h];var n=f[0];var e=f[1];if(typeof d[n]=="undefined"){d[n]=[];m.push(n)}d[n].push(e)}var c=this.url;for(var g=0,l=m.length;g<l;g++){var k=m[g];c+=(g===0?"?":"&")+k+"="+d[k].join("|")}this.paramsMap=d;return c}};return a}});PopIn5.Class("$","ProxyAjax",{init:function(a){if(typeof a=="string"){a={url:a}}this.status="init";this.success=false;this.data=a;this.timeout=1000},loaded:function(a){if(PopIn5.$F.isEmpty(PopIn5.$.Global.uid)&&PopIn5.$F.notEmpty(a)){var b=a.cookie;if(PopIn5.$F.notEmpty(b)&&PopIn5.$F.notEmpty(b.uid)){PopIn5.$.Global.uid=b.uid}}this.result=a;this.status="finish";this.func.call(this,a)},setCallback:function(a){this.func=a},load:function(){var a=this;var d=function(f){a.loaded(f)};this.status="start";for(var c=0,e=PopIn5.ajaxCache.length;c<e;c++){var b=PopIn5.ajaxCache[c];if(b.data.url==this.data.url){if(b.status=="finish"){this.loaded(b.result);return}else{if(b.status=="start"){PopIn5.$F.aspectAfter(b,"loaded",d);return}}}}PopIn5.ajaxCache.push(this);setTimeout(function(){if(!a.success){a.success=true;a.loaded(null)}},this.timeout);PopIn5.$F.ajax(PopIn5.$F.join(this.data,{success:function(f){if(a.success===false){a.success=true;a.loaded(f)}},fast:true}))}});PopIn5.StaticClass("$","Segment",{init:function(){},getSegmentData:function(d,b,m){if(PopIn5.$F.isEmpty(d)||PopIn5.$F.isEmpty(b)){return{}}m=PopIn5.$F.join({},m);var g=PopIn5.$F.join(b.segmentData,d.segmentData);var e=[["ca","category"],["ab","abtest"],["au","customField"]];if(PopIn5.$F.notEmpty(m.useCommonCategory)){e.push(["cc","commonCategory"])}if(PopIn5.$F.notEmpty(m.onlyCommonCategory)){e=[["cc","commonCategory"]]}var h={};for(var f=0,c=e.length;f<c;f++){var j=e[f];var l=j[0];var k=j[1];if(PopIn5.$F.notEmpty(g[k])){var a=g[k];a=PopIn5.$F.isArray(a)?a:[a];h[l]=a}}return h},addSegmentLog:function(a,d,c,i){var f=this.getSegmentData(d,c,i);for(var h in f){var b=f[h];b=PopIn5.$F.isArray(b)?b:[b];if(h==="cc"){b=[b[0]]}for(var e=0,g=b.length;e<g;e++){a.add("r5",h+"_"+encodeURIComponent(b[e]))}}}});PopIn5.StaticClass("$","Treasure",{init:function(){(function(g,k){if(void 0===k[g]){k[g]=function(){k[g].clients.push(this),this._init=[Array.prototype.slice.call(arguments)]},k[g].clients=[];for(var j=function(c){return function(){return this["_"+c]=this["_"+c]||[],this["_"+c].push(Array.prototype.slice.call(arguments)),this}},h=["addRecord","set","trackEvent","trackPageview","trackClicks","ready"],d=0;d<h.length;d++){var m=h[d];k[g].prototype[m]=j(m)}var l=document.createElement("script");l.type="text/javascript",l.async=!0,l.src=("https:"===document.location.protocol?"https:":"http:")+"//api.popin.cc/td_js_sdk_171.js";var f=document.getElementsByTagName("script")[0];f.parentNode.insertBefore(l,f)}})("Treasure2",window);this.interactionNumber=0;var a=this;var b=function(c){a.interactionNumber++;a.lastEvent=c};window.addEventListener("touchstart",b,false);window.addEventListener("click",b,false);window.addEventListener("mousedown",b,false)},treasureFactory:function(a,b){var c=new Treasure2({writeKey:"8378/25839e06ce4cc1cab55c1c1f1e49d336d6d1d48f",database:b});if(a){c.set("$global","td_global_id","td_global_id")}return c},createLogger:function(a){a=typeof a!=="undefined"?a:true;return this.treasureFactory(a,"popin_media")},createAdLogger:function(a){a=typeof a!=="undefined"?a:true;return this.treasureFactory(a,"popin_ads")},createUtsLogData:function(b){var c={};for(var a in b){c[a]=b[a]}var d=PopIn5.Discovery.Treasure.uainfo||{};c.td_browser=d.browser||"";c.td_browser_version=d.browser_version||"";c.td_language=navigator.language;c.td_os=d.os||"";c.td_os_version=d.os_version||"";delete c.td_version;delete c.td_ip;return c},sendLogDataToUts:function(h,c,f){try{var b=JSON.stringify(this.createUtsLogData(f));var a=[window.PopIn6.protocol+"//log.popin.cc/log","/"+h.client.database,"/"+c,"?data="+btoa(unescape(encodeURIComponent(b)))].join("");var d=new Image();d.src=a}catch(g){}},writeRecord:function(d,b,e){e.interaction_number=this.interactionNumber;if(PopIn5.$F.notEmpty(this.lastEvent)){if(PopIn5.$F.notEmpty(this.lastEvent.touches)){var f=this.lastEvent.touches[0];e.interaction_touchx=Math.round(f.pageX);e.interaction_touchy=Math.round(f.pageY)}if(this.lastEvent.type=="mousedown"){e.interaction_mousex=Math.round(event.pageX);e.interaction_mousey=Math.round(event.pageY)}}var a=function(){};var c=function(){};d.addRecord(b,e,a,c);this.sendLogDataToUts(d,b,e)}});PopIn5.StaticClass("$","User",{init:function(){this.afterLoad=[];this.status=0},getUser:function(a){if(PopIn5.$F.notEmpty(PopIn5.$.Global.uid)){a(PopIn5.$.Global.uid);return true}if(PopIn5.$F.isSupportStorage()&&PopIn5.$F.notEmpty(PopIn5.$F.ssGet("_ss_pp_id"))){a(PopIn5.$F.ssGet("_ss_pp_id"));return true}this.afterLoad.push(a);if(this.status===0){this.status=1;this.loadUser()}return false},loadUser:function(){var b=this.afterLoad;var a=function(d){PopIn5.$.Global.uid=d;while(b.length>0){var c=b.pop();c(d)}};PopIn5.$F.ajax("https://discoveryplus.popin.cc/popin_discovery/ck?name=uid",function(c){if(PopIn5.$F.notEmpty(c)&&PopIn5.$F.notEmpty(c.uid)){if(PopIn5.$F.isSupportStorage()){PopIn5.$F.ssSet("_ss_pp_id",c.uid)}a(c.uid)}else{var d=function(e){if(PopIn5.$F.isSupportStorage()){PopIn5.$F.ssSet("_ss_pp_id",c.uid)}a(e)};PopIn5.$F.getMessage(PopIn5.$.Global.protocol+"//api.popin.cc/retarget/uid.html?ac=",d)}})}});PopIn5.Class("Discovery","ArticleRenderer",{init:function(a,c,b){this.container=a;this.data=PopIn5.$F.join(c,{});this._config=b;this.renderParts={};this.isRender=true;this.fixData();if(this.isRender){this.render();this.afterRender()}},fixData:function(){var b=this.data;if(PopIn5.$F.notEmpty(this._config.delWord)&&b.type.indexOf("ad")<0){b.title=b.title.replace(new RegExp(this._config.delWord,"g"),"")}if(PopIn5.$F.isEmpty(b.title)){this.isRender=false;return}b.rank=b.renderIndex+1;b.formattedDate=PopIn5.$F.notEmpty(b.pubdate)?this.formatDate(b.pubdate):"";if(b.type.indexOf("ad")<0){b.url=PopIn5.$F.notEmpty(this._config.displayUrlReplace)?PopIn5.$F.replaceAll(b.url,this._config.displayUrlReplace):b.url;b.url+=(PopIn5.$F.notEmpty(this._config.addQuery)?(((/[?]/.test(b.url))?"&":"?")+this._config.addQuery):"")}b.media=PopIn5.$F.notEmpty(b.media)?this._config.mediaFormat.replace(/\$MEDIA/,b.media):"";if(b.media!==""&&PopIn5.$F.notEmpty(this._config.adTitle)){b.media=b.media.replace(/^\(/,"("+this._config.adTitle)}var a="";var f="";var e="";var g=PopIn5.$.Global.protocol;b.notFoundImg=this._config.notFoundImg;if(b.type.indexOf("ad")===0){e=b.image;if(PopIn5.$F.notEmpty(this._config.imageSize)&&(""+this._config.imageSize).indexOf("w")===0){f=g+"//f.popincdn.com/"+this._config.imageSize+"/";a=f+e}else{f=g;a=e.indexOf("http://images.popin.cc")>0?f+e.replace(/http:\/\/images.popin.cc/,"//i.popincdn.com"):e;if(f==="https:"&&a.indexOf("http://images.popin.cc")>-1){a=a.replace(/http:\/\/images.popin.cc/,"https://i.popincdn.com")}}}else{if(PopIn5.$F.notEmpty(this._config.imageSize)&&(""+this._config.imageSize).indexOf("w")===0){e=b.image_url;f=g+"//f.popincdn.com/"+this._config.imageSize+"/";a=f+e}else{if(PopIn5.$F.notEmpty(this._config.imageSize)&&(""+this._config.imageSize)=="original"){e=b.image_url;f="";a=f+e}else{e=b.image;if(e==="noimage"||PopIn5.$F.isEmpty(e)){e=""}else{f=e.indexOf("http")>-1?"":"https://i.popincdn.com/article/";a=f+((this._config.imageSize===""||e.indexOf("http")>-1)?e:e.replace(".","_"+this._config.imageSize+"."))}}}}b.hasImage=PopIn5.$F.notEmpty(e);b.imageUrl=b.hasImage?a:b.notFoundImg;b.authorName=PopIn5.$F.notEmpty(b.author_name)?b.author_name:"";if(b.type.indexOf("ad")===0){if(PopIn5.$F.notEmpty(this._config.channelId)){b.url+="&extra=m_ch_"+this._config.channelId}var d=PopIn5.$F.parseUri(PopIn5.Discovery._instance._config.apiUrl).host;var c=d.replace("discoveryplus.","jp.");b.url+="&api_host="+c;if(PopIn5.$.Global.logid){b.url+="&logid="+PopIn5.$.Global.logid}}},renderImageNode:function(f,b){var a=this;var e=PopIn5.$F.ce(f,"div");PopIn5.$F.addClass(e,"_popIn_recommend_art_img");this.renderParts.imageDiv=e;if(!b.hasImage){PopIn5.$F.addClass(e,"_popIn_recommend_no_img")}var d=PopIn5.$F.ce(e,"a");if(this._config.imageInView){new PopIn5.Discovery.ImageInView(d,b);return}var c=PopIn5.$F.ce(d,"img");c.src=b.imageUrl},renderCategoryNode:function(c,a){var b=PopIn5.$F.ce(c,"div",a.category);PopIn5.$F.addClass(b,"_popIn_recommend_art_category")},renderTitleNode:function(h,c){var a=this;var e=PopIn5.$F.ce(h,"div");PopIn5.$F.addClass(e,"_popIn_recommend_art_title");if(this._config.debugMode){var d=PopIn5.$F.ce(e,"span",c.type);PopIn5.$F.css(d,{color:"#ff0000"})}var b=c.title;var f=PopIn5.$F.ce(e,"a",b);var g=PopIn5.$F.cssGet(e,"overflow");if(g=="hidden"){this.addEllipsis(e,f,b)}},addEllipsis:function(b,c,e){var d=PopIn5.$F.size(b);var a=PopIn5.$F.size(c);while(a.height>d.height&&e.length>1){e=e.substr(0,e.length-1);c.innerHTML=e+"...";a=PopIn5.$F.size(c)}},formatDate:function(h){var a=this._config.dateFormat;var g=this._config.dateFormatShowYear;var e=new Date().getFullYear();var b="";if(h!=="000000000000000000"){if(h.slice(8,12)=="0000"&&/h|m|s/.test(a)){a=a.replace(/h|m|s|:|：|\s|時|分|秒/g,"")}if(!g&&h.slice(0,4)===e){a=a.replace(/Y年/,"")}var d={Y:[0,4],M:[4,6],D:[6,8],h:[8,10],m:[10,12],s:[12,14]};b=a;for(var c in d){var f=Number(h.slice(d[c][0],d[c][1]));if(/m|s/.test(c)&&f<10){f="0"+f}b=b.replace(new RegExp(c),f)}}return b},renderMediaNode:function(d,a){var b=PopIn5.$F.ce(d,"div");b.innerHTML=a.media;PopIn5.$F.addClass(b,"_popIn_recommend_art_media");this.renderParts.mediaDiv=b;var c=PopIn5.$F.cssGet(b,"overflow");if(c=="hidden"){this.addEllipsis(b,b,a.media)}},renderDateNode:function(c,b){var a=PopIn5.$F.ce(c,"div",b.formattedDate);PopIn5.$F.addClass(a,"_popIn_recommend_art_date")},renderAuthorNode:function(c,a){if(a.authorName!==""){var b=PopIn5.$F.ce(c,"div",a.authorName);PopIn5.$F.addClass(b,"_popIn_recommend_art_author")}},render:function(){var a=this.data;var b=PopIn5.$F.ce(this.container,"div");PopIn5.$F.addClass(b,"_popIn_recommend_article _popIn_recommend_article_"+a.type+" _popIn_idx"+(this.data.renderIndex+1));if(a.hasImage){PopIn5.$F.addClass(b,"_popIn_recommend_has_img")}this.renderParts.articleDiv=b;this.renderImageNode(b,a);this.renderTitleNode(b,a);this.renderCategoryNode(b,a);this.renderMediaNode(b,a);this.renderDateNode(b,a);this.renderAuthorNode(b,a);this.renderParts.imageDiv=PopIn5.$F.oneSelector(b,"._popIn_recommend_art_img");this.renderParts.imageLink=PopIn5.$F.oneSelector(b,"._popIn_recommend_art_img A");this.renderParts.image=PopIn5.$F.oneSelector(b,"._popIn_recommend_art_img IMG");this.renderParts.titleDiv=PopIn5.$F.oneSelector(b,"._popIn_recommend_art_title");this.renderParts.titleLink=PopIn5.$F.oneSelector(b,"._popIn_recommend_art_title A")},afterRender:function(){var d=this.renderParts.articleDiv;var b=d.getElementsByTagName("A");for(var e=0;e<b.length;e++){this.addClickEvent(b[e])}if(PopIn5.$F.notEmpty(this.renderParts.image)){var f=this.renderParts.image;var a=this;var c=function(){if(f.src!=a._config.notFoundImg){f.src=a._config.notFoundImg}};f.onerror=c}},addClickEvent:function(b){var a=this;b.href=this.data.url;PopIn5.$F.bind(b,"click",function(c){if(PopIn5.$F.notEmpty(c.preventDefault)){c.preventDefault()}else{c.returnValue=false}a.handleClick();return false})},handleClick:function(){var a=this;var b=PopIn5.$.Context.findContext(this.container);PopIn5.Discovery.Log.clickLog(this._config,b,function(){a.addClickCookie();a.afterClick()},this.data)},afterClick:function(){window.top.location=this.data.url},addClickCookie:function(){if(PopIn5.$F.notEmpty(this.data.hash)&&PopIn5.$F.notEmpty(this.data.hash.originalUrl)){var a=PopIn5.Cookie.getCookie("__prd")||"";if(a.indexOf(this.data.hash.originalUrl)===-1){a=this.data.hash.originalUrl+(a.length>0?"|"+a:"")}var b=a.split("|");if(b.length>50){b=b.splice(0,50)}PopIn5.Cookie.setCookie("__prd",b.join("|"),{expires:30,path:"/",noencode:true})}}});PopIn5.Class("Discovery","ArticleRendererAd",(function(){var b=PopIn5.Discovery.ArticleRenderer.prototype;var a=false;var e={};for(var d in b){e[d]=b[d]}var g=[];(function c(){if(!window.performance||!window.performance.getEntries){return}window.addEventListener("load",function(){try{var h=performance.getEntries();var l=/\.js$/;for(var j=0,k;k=h[j++];){if(l.test(k.name)){g.push(k.name)}}}catch(m){}},false)})();function f(k,i){var h="https://smartphone.popin.cc/post.php?";var j=JSON.stringify({resources:k,href:i,hasPopInView5:(window.PopInView5!==undefined)?true:false});var l=new XMLHttpRequest();l.open("POST",h+new Date().getTime(),true);l.setRequestHeader("Content-type","application/x-www-form-urlencoded");l.send("data="+j)}e.addClickEvent=function(i){var h=this;i.href=this.data.url;i.setAttribute("rel","nofollow");i.href=i.href+"&mode=20170420";i.href+="&piuid="+PopIn5.$.UserId.getUid();var j=PopIn5.$.Treasure.createLogger();j.ready(function(){i.href+="&td_client_id="+j.getTrackValues().td_client_id});PopIn5.$F.bind(i,"click",function(){var k=PopIn5.$.Context.findContext(h.container);if(PopIn5.$F.notEmpty(k.readOutput)){i.href=i.href+"&read="+(10*Math.round(k.readOutput.readPercent*10))}i.href=i.href+"&referer_type="+PopIn5.$.Global.referrer;i.href+="&hasPopInView5="+(window.PopInView5!==undefined?"1":"0");PopIn5.Discovery.Treasure.adClickLog(k,h.data);PopIn5.Discovery.Treasure.discoveryMediaDnaLog(k,h.data);if(h.data.campaign==="58ec60ca11e7bb2720549371"){f(g,i.href)}if(PopIn5.$F.notEmpty(h.click_tracking_pixel)){PopIn5.Discovery.Log.clickTrackingLog(h.click_tracking_pixel)}});i.target="_blank"};e.render=(function(h){return function(){h.apply(this);if(this.data.movie){var j=this.renderParts.articleDiv;PopIn5.$F.addClass(j,"_popIn_recommend_art_movie")}if(this.data.video_link){var o=this.renderParts.imageDiv;PopIn5.$F.cssSet(o,"position","relative");var i=PopIn5.$F.size(o);var n=this.renderParts.imageLink;var m=+PopIn5.$F.css(n,"margin-top").replace(/px/,"");var k=PopIn5.$F.isMobileDevice()?33:40;var l=PopIn5.$F.ce(o,"div");PopIn5.$F.css(l,{display:"display",background:"url(https://i.popincdn.com/videos/play.png) no-repeat left","background-size":"contain",position:"absolute",bottom:-m,right:0,width:k,height:k})}}})(e.render);return e})());PopIn5.Class("Discovery","ArticleRendererAd_video",(function(){var a=PopIn5.Discovery.ArticleRenderer.prototype;var c={};for(var b in a){c[b]=a[b]}c.renderImageNode=function(i,f){var d=this;if(typeof video_jsv=="undefined"){window.jsv_config={bufferSec:5,chunkSize:1000000,doNotPatchCreateElement:true};var h=document.createElement("script");h.type="text/javascript";h.charset="utf-8";h.async=true;h.onload=function(){d.loadVideo()};h.src="//"+PopIn5.$.Global.baseDomain+"/popin_video_ads-min.js";var g=document.getElementsByTagName("script")[0];g.parentNode.insertBefore(h,g)}else{this.loadVideo()}var e=PopIn5.$F.ce(i,"div");PopIn5.$F.addClass(e,"_popIn_recommend_art_video");this.videoDiv=e},c.loadVideo=function(){var g=PopIn5.$F.ce(this.videoDiv,"div");PopIn5.$F.css(g,{position:"absolute",width:"100%",height:"100%",top:"0px",bottom:"0px",left:"0px",right:"0px","text-align":"center"});var e=new video_jsv();g.appendChild(e);var f=PopIn5.$.Global.protocol+"//i.popincdn.com/jsv/"+this.data.nid+"/video.jsv";var d=this;e.addEventListener("canplay",function(){});e.setAttribute("preload","auto");e.setAttribute("data-audio","");e.setAttribute("autoplay","true");e.style.height="100%";e.setAttribute("src",f);e.firstChild.style.width=""};return c})());PopIn5.Class("Discovery","ArticleRendererYahoo",(function(){var a=this;var e=[];var b=PopIn5.Discovery.ArticleRenderer.prototype;var d={};for(var c in b){d[c]=b[c]}d.render=(function(f){return function(){var h=this.data;var g="_popy"+new Date().getTime().toString(16)+"_";var i=PopIn5.$F.ce(this.container,"div");PopIn5.$F.addClass(i,"_popIn_recommend_article _popIn_recommend_article_"+h.type+" _popIn_idx"+(this.data.renderIndex+1));i.id=g;e.push(g)}})(d.render);d.afterRender=(function(f){return function(){var k=PopIn5.$F.notEmpty(this._config.yads_ad_ds)?this._config.yads_ad_ds:"";var g=this._config.pages;if(k&&e.length===g){var j=null;var h=0;var i=function(){h++;if(h>10){clearInterval(j)}if(PopIn5.$F.isEmpty(window.YadsTimelineManager)){return}var m=new YadsTimelineManager({yads_ad_ds:k});for(var l=0,n=e.length;l<n;l++){m.insertAd(e[l])}clearInterval(j)};j=setInterval(i,500)}}})(d.afterRender);return d})());PopIn5.Class("Discovery","Box",{init:function(a,i,c,g){this.context=a;this.originalData=i;this._config=c;this.template=g;this.template.segmentData=PopIn5.$F.join(this._config.segmentData,this.template.segmentData);var b=g.selector;var h=a.key.querySelector(b);if(PopIn5.$F.isEmpty(h)){return}var e=this.prepareData();var d=this;var f=function(j){j()};if(g.loadAfter=="share"){f=function(j){PopIn5.$.Global.event.addEventListener("share-click",function(k){j()})}}if(g.loadAfter=="amp"){f=function(j){window.addEventListener("message",function(k){if(k.source!=window.parent||!k.data||k.data.sentinel!="amp"||k.data.type!="intersection"){return}k.data.changes.forEach(function(l){if(l.intersectionRect.height>0){j();j=function(){}}})})}}if(e){this.rendered=false;f(function(){if(!d.rendered){d.render();d.rendered=true}})}},prepareData:function(){if(PopIn5.$F.isEmpty(this.originalData)){return}this.includeRules=[].concat(this.template.includeRules);this.excludeRules=[].concat(this.template.excludeRules);if(PopIn5.$F.notEmpty(this.originalData.cookie)){this.processCookie(this.originalData.cookie)}var e=PopIn5.$F.notEmpty(this.template.type)?this.template.type:this._config.type;var c=new Date();this.nowDate=[c.getFullYear(),("00"+(c.getMonth()+1)).slice(-2),("00"+c.getDate()).slice(-2),"2359999999"].join("");if(PopIn5.$F.notEmpty(this._config.yads_ad_ds)){this.template.yads_ad_ds=this._config.yads_ad_ds;var b=100;this.originalData.yahoo=[];for(var a=0;a<b;a++){var d={image:"dummy"};d.title="dummy"+Math.floor(Math.random()*200);d.url="dummy"+Math.floor(Math.random()*200);this.originalData.yahoo.push(d)}}this.dataToRender=this._handleFunc(e);return true},processCookie:function(b){var e=b._click;if(PopIn5.$F.isEmpty(e)){return}var f={};var g=e.split("|");var c=new Date().getTime();for(var h=0,d=g.length;h<d;h++){var j=g[h].split(".");var a=j[1];var k=(c-j[2])/(24*60*60*1000);if(k>30){continue}if(typeof f[a]=="undefined"){f[a]=0}f[a]++}this.addExcludeRuleForAd(f)},addExcludeRuleForAd:function(a){this.excludeRules.push(function(b){if((b.type=="ad"||b.type=="ad_image")&&PopIn5.$F.notEmpty(a[b.nid])){var c=a[b.nid];if(c>=3){return false}}return true})},addValid:function(c,e,d){if(PopIn5.$F.notEmpty(e)){for(var b=0,f=e.length;b<f;b++){var a=this.fixOne(d,e[b]);if(this.isValid(a)){c.push(a)}}}},_handleFunc:function(k){var m=this.originalData;if(!m){return[]}var g=[];if(k in m&&PopIn5.$F.notEmpty(m[k])){this.addValid(g,m[k],k);return g}if(!PopIn5.$F.isArray(k)){return[]}k=[].concat(k);var h=k[0];if(h==="getRandomUnique"){h="rand"}var b="";var f=["left","right","rand","sort","pattern"];for(var e=0,a=f.length;e<a;e++){if(h==f[e]){b=k.pop()}}for(var d=1,l=k.length;d<l;d++){g=g.concat(this._handleFunc(k[d]))}g=this.getUnique(g);if(h=="add"){}if(h=="rand"){g.sort(function(j,i){return Math.random()-0.5})}if(h=="left"||h=="rand"){g=g.slice(0,Math.min(b,g.length))}if(h=="right"){g=g.slice(Math.max(0,g.length-b),g.length)}if(h=="pattern"){g=this.getPattern(g,b)}if(h=="sort"){var c=function(j,i){return j>i?1:(j<i?-1:0)};g.sort(function(j,i){var n=c(j[b],i[b]);return -n})}return g},getPattern:function(p,d){var h=true;var a=[].concat(p);var o=[];var c=d;while(h){h=false;if(typeof d=="function"){c=d()}for(var l=0,b=c.length;l<b;l++){var n=c[l];n=PopIn5.$F.isArray(n)?n:[n];loop:for(var g=0,r=n.length;g<r;g++){var q=n[g];for(var e=0,m=a.length;e<m;e++){var f=a[e];if(f.type2.search(q)>-1){h=true;o.push(f);a.splice(e,1);break loop}}}}}return o},getReadHistoryAll:function(){if(PopIn5.$F.notEmpty(this.readHistoryAll)){return this.readHistoryAll}var a=PopIn5.$F.lsGet("_prh_all");if(PopIn5.$F.notEmpty(a)){a=JSON.parse(a)}else{a=[]}this.readHistoryAll=a;return a},getUnique:function(E){var g=this.template.showLocation;var z=[];var C=["originalUrl","title"];var e={};for(var w=0,b=C.length;w<b;w++){e[C[w]]={}}if(!g){e[C[0]][PopIn5.$F.digest(this._config.target)]=1}for(var v=0,h=E.length;v<h;v++){var r=E[v];if(!r){continue}r.hash={};var d=true;for(var t=0,x=C.length;t<x;t++){var f=C[t];if(PopIn5.$F.notEmpty(f)&&PopIn5.$F.notEmpty(r[f])){var F=PopIn5.$F.digest(r[f]);r.hash[f]=F;if(PopIn5.$F.notEmpty(e[f][F])){d=false}else{e[f][F]=1}}}if(d){z.push(r)}}if(this._config.hideHistory){var u=(PopIn5.Cookie.getCookie("__prd")||"").split("|");for(var s=0,c=u.length;s<c;s++){var a=u[s];if(z.length<=5){break}for(var q=0,o=z.length;q<o;q++){if(z[q].hash.originalUrl==a){z.splice(q,1);break}}}var A=this.getReadHistoryAll();for(var B in A){if(!A.hasOwnProperty(B)){continue}if(z.length<=5){break}for(var p=0,y=z.length;p<y;p++){var D=PopIn5.$F.digest(z[p].url);if(B==D){z.splice(p,1);break}}}}return z},fixOne:function(d,b){b.type=d;if(this.template.delImage&&PopIn5.$F.notEmpty(b.image)&&b.image.indexOf(this.template.delImage)>=0){b.image=""}var a=(PopIn5.$F.notEmpty(this.template.imageSize)&&(""+this.template.imageSize).indexOf("w")===0)?b.image_url:b.image;if(a==="noimage"){a=""}b.hasImage=PopIn5.$F.notEmpty(a)?"1":"0";b.type2=b.type+(b.hasImage=="1"?"_img":"_noimg");b.originalUrl=b.url;if(b.url.indexOf("?url=")>0){var c=PopIn5.$F.parseUrl(b.url).qString.url;b.originalUrl=decodeURIComponent(c)}b.channelId=PopIn5.$F.notEmpty(this.template.channelId)?this.template.channelId:"";b.abtest=PopIn5.$F.notEmpty(this.template.abtestName)?this.template.abtestName:"";var e=PopIn5.$F.digest(b.originalUrl);b.hashCount=this.context.discoverySelected[e];return b},isValid:function(e){if(PopIn5.$F.isEmpty(e.title)){return false}if(PopIn5.$F.notEmpty(e.pubdate)&&e.pubdate>this.nowDate){return false}var f=null;for(var c=0,g=this.excludeRules.length;c<g;c++){f=this.excludeRules[c];if(!f(e)){return false}}for(var b=0,a=this.includeRules.length;b<a;b++){f=this.includeRules[b];if(f(e)){return true}}if(PopIn5.$F.notEmpty(e.position)){return false}var d=true;if((e.type=="ad"||e.type=="ad_image")&&e.media.indexOf("3rdparty")===0){d&=PopIn5.$F.notEmpty(e.thirdPartyEnabled)}return d},render:function(){this.renderer=new PopIn5.Discovery.BoxRenderer(this.context,this.template,this.dataToRender)}});new PopIn5.Class("Discovery","BoxRenderer",{init:function(d,b,c){this.context=d;this._config=b;this.data=c;if(this.data.length===0){PopIn5.Discovery.Treasure.emptyData(d,b);return}var a=Math.min(b.infinitePages,Math.floor(this.data.length/b.infiniteSize));if(a===0){return}this._config.pages=a;this.plugins=new PopIn5.Discovery.Plugins();if(PopIn5.$F.notEmpty(this._config.css)){PopIn5.$F.appendCSS(this._config.css)}this.createContainer();PopIn5.Discovery.Log.previewLog(this._config,this.context);this.render();var e=PopIn5.$F.parseUri(d.configs.discovery.apiUrl).host;PopIn5.Discovery.BrandSafety.process(this.container,{logid:this.context.discoveryData.logid,media:this.context.configs.discovery.media,apihost:e.replace("discoveryplus.","jp.")})},createContainer:function(){var a=document.createElement("div");a.id=this._config.containerId;PopIn5.$F.addClass(a,"_popIn_recommend_container");var c=this.context.key.querySelector(this._config.selector);if(c){var b=this.context.configs.discovery;if(PopIn5.$F.notEmpty(b.debugLog)){PopIn5.$.Log.log("https://rlog.popin.cc/s.gif?url="+location.host+"&uid=&type=paid_discovery_createContainer&t="+Date.now())}PopIn5.$F.insertAdjacentElement(c,this._config.position,a)}this.container=a},render:function(){var a=this.container;var c=this.context.configs.discovery;if(PopIn5.$F.notEmpty(c.debugLog)){PopIn5.$.Log.log("https://rlog.popin.cc/s.gif?url="+location.host+"&uid=&type=paid_discovery_render&t="+Date.now())}this.renderHeader(a);var d=PopIn5.$F.ce(a,"div");PopIn5.$F.addClass(d,"_popIn_recommend_articles");this.renderFooter(a);var b=(this._config.infiniteSize>0)?PopIn5.Discovery.ListInfiniteRenderer:PopIn5.Discovery.ListSimpleRenderer;new b(this._config,d,this.data);this._config.afterRender(this);this.plugins.afterRender(this);PopIn5.Discovery.Performance.addTimeMark("box_did_render").addMark("is_box_rendered",true).report();PopIn5.Discovery.Log.boxRenderedLog(this);if(PopIn5.$F.notEmpty(this._config.channelId)){PopIn5.Discovery.Log.intextBoxRenderedLog(this)}},renderHeader:function(a){if(this._config.title){var b=PopIn5.$F.ce(a,"div",this._config.title);PopIn5.$F.addClass(b,"_popIn_recommend_header")}},renderFooter:function(a){if(PopIn5.$F.notEmpty(this._config.credit)){var c=PopIn5.$F.ce(a,"div",this._config.credit);PopIn5.$F.addClass(c,"_popIn_recommend_credit");var b=PopIn5.$F.ce(c,"div");PopIn5.$F.addClass(b,"_popIn_recommend_credit_image");this.creditDiv=c;this.addCreditEvent(c)}},closeAbout:function(){var a=function(c){var b=document.getElementById(c);if(PopIn5.$F.notEmpty(b)){PopIn5.$F.remove(b)}};a("_popIn_about_black");a("_popIn_about_inner")},addCreditEvent:function(c){var a=this;var b=function(){a.closeAbout()};b();PopIn5.$F.bind(c,"click",function(){if(PopIn5.$F.isMobileDevice()){window.open("https://www.popin.cc/discovery/what-is.php");return true}var f=PopIn5.$F.ce(document.body,"div");f.id="_popIn_about_black";PopIn5.$F.css(f,{position:"fixed",width:"100%",height:"100%",left:"0px",top:"0px","background-color":"black",opacity:0.75,"z-index":9998});PopIn5.$F.bind(f,"click",b);var e=PopIn5.$F.ce(document.body,"div");e.id="_popIn_about_inner";PopIn5.$F.css(e,{position:"fixed",width:"500px",height:"450px",left:"50%",top:"50%","margin-left":"-250px","margin-top":"-225px","background-color":"white","border-radius":"6px","z-index":9999});var d=PopIn5.$F.ce(e,"div");PopIn5.$F.css(d,{position:"absolute",top:"-18px",left:"-18px",background:"url(https://"+PopIn5.$.Global.baseDomain+"/images/close.png) no-repeat",width:"36px",height:"36px",cursor:"pointer"});PopIn5.$F.bind(d,"click",b);PopIn5.$F.iframeLoader("",{parentNode:e,src:"https://www.popin.cc/discovery/what-is.php",frameBorder:"0",scrolling:"no",css:{width:"480px",height:"430px",border:"0px",margin:"10px 0px 0px 10px"}})})}});PopIn5.StaticClass("Discovery","BrandSafety",{init:function(){this.impIdArry=[]},process:function(b,a){a=a||{};if(!a.logid){return false}this.logid=a.logid||"";this.media=a.media||location.host;this.apiHost=a.apihost||"jp.popiin.cc";this.impIdArry[this.logid]=(typeof this.impIdArry[this.logid]!=="undefined")?this.impIdArry[this.logid]+1:1;this._momentumTagRender(b)},_momentumTagRender:function(c){var f="jp.popin.cc";if(f!==this.apiHost){return}var g=38,b="UUID_DIV",h=this.logid,a=this.impIdArry[this.logid],d=this.media,i=document.createElement("script");i.src="//assets-momentum.akamaized.net/js/axss.js";c.classList.add(b);var e=function(){momentum_heron.set_postbid_observer(b,g,h,String(a),d,{dest:"http://jp.popin.cc/popin_discovery/pbc",payload:{ext:{momentum:{heron:{require:[1,2,4]}}}}})};if(typeof i.onload!=="undefined"){i.onload=e}else{if(i.readyState){i.onreadystatechange=e}}document.body.appendChild(i)}});PopIn5.Class("Discovery","Config",{init:function(a){PopIn5.Discovery.Global.device=(PopIn5.$F.isMobileDevice())?"mobile":"pc";this.setDefaults();PopIn5.$.Config.overrideAll(this,a);this.afterConfig()},setDefaults:function(){this.agency="";this.adEnable=false;this.media=PopIn5.$.Config.partnerDomain;this.target=PopIn5.$.Config.target;this.apiUrl=PopIn5.$.Global.protocol+"//discoveryplus.popin.cc/popin_discovery/recommend?mode=new&url=%target";this.apiUrlAdd="";this.templates=[];this.hideHistory=true;this.personal=false;this.adVideo=false;this.adReservedVideo=false;this.videos=[];this.plugins=[];this.cfid="";this.ad=10;this.treasureDiscoveryLog=false;this.inrecLogEnable=false;this.segmentData={}},afterConfig:function(){if(this.adEnable){this.apiUrl+="&device="+PopIn5.Discovery.Global.device+"&media="+this.media+"&ad="+this.ad;this.apiUrl+="&extra="+PopIn5.$F.getPlatform();if(typeof PopIn5.Discovery.Global.device==="undefined"||PopIn5.Discovery.Global.device.indexOf("undefined")>-1){var b=PopIn5.$.Log.logBuilder(PopIn5.$.Global.protocol+"//rlog.popin.cc/s.gif");b.add("url",location.href);b.add("uid","");b.add("type","undefined_device");b.add("ua",encodeURIComponent(window.navigator.userAgent));b.add("nid","");b.add("media","");PopIn5.Discovery.Log.writeLog(b.build())}}if(PopIn5.$F.notEmpty(this.agency)){this.apiUrl+="&agency="+this.agency}if(PopIn5.$F.notEmpty(this.cfid)){this.apiUrl+=("&cf="+this.cfid)}if(PopIn5.$F.notEmpty(this.pathnum)){this.apiUrl+="&pathnum="+(this.pathnum+0)}if("number"===typeof this.topn&&this.topn){this.apiUrl+="&topn="+this.topn}else{this.apiUrl+="&topn=50"}this.apiUrl+="&piuid="+PopIn5.$.UserId.getUid();if(PopIn5.$F.notEmpty(this.apiUrlAdd)){var e=this.apiUrlAdd;if("string"===typeof e&&e.indexOf("&")!==0){e="&"+e}this.apiUrl+=e}if(PopIn5.$F.isEmpty(PopIn5.$.Config.country)){var m=PopIn5.$F.parseUri(this.apiUrl);var n=[["discoveryplus.popin.cc","jp"],["jp.popin.cc","jp"],["tw.popin.cc","tw"],["kr.popin.cc","kr"],["popin.cc","jp"]];for(var k=0;k<n.length;k++){var f=n[k];if(m.host.indexOf(f[0])>-1){PopIn5.$.Config.country=f[1];break}}}var c=PopIn5.Discovery.Global;c.media=this.media;c.target=this.target;c.adEnable=this.adEnable;c.adVideo=this.adVideo;c.performanceSample=this.performanceSample;c.enablePerformanceMonitor=this.enablePerformanceMonitor;if(PopIn5.$F.notEmpty(this.template)){this.templates.push(this.template);delete this.template}var q=[];for(var k=0,d=this.templates.length;k<d;k++){q.push(new PopIn5.Discovery.TemplateConfig(this.templates[k]))}this.templates=q;var l=PopIn5.$F.notEmpty(this.yads_ad_ds)?this.yads_ad_ds:"";if(l&&PopIn5.$F.isEmpty(window.YadsTimelineManager)){var r=PopIn5.$.Global.protocol;var h=(r==="https:")?"s":"i";var a=["//yads.c.yimg.jp/js/yads-async.js","//"+h+".yimg.jp/images/listing/tool/yads/yads-timeline-ex.js"];for(var g=0,p=a.length;g<p;g++){var o=document.createElement("script");o.type="text/javascript";o.charset="UTF-8";o.async=true;o.src=r+a[g];var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(o,t)}}}});PopIn5.StaticClass("Discovery","Global",{init:function(){}});new PopIn5.Class("Discovery","ImageInView",{init:function(b,a){PopIn5.$F.inView({element:b,complete:function(){var c=new Image();c.onload=function(){PopIn5.$F.css(b,{opacity:1,"background-image":"url("+a.imageUrl+")"})};c.onerror=function(){PopIn5.$F.css(b,{opacity:1,"background-image":"url("+a.notFoundImg+")"})};c.src=a.imageUrl}})}});PopIn5.StaticClass("Discovery","InfiniteAds",{init:function(){this.status=0;this.idx=0},prepareAds:function(){var e=[];var b=PopIn5.$F.firstNotEmpty(PopIn5.$F.notEmpty(window.popInInfiniteAds)?window.popInInfiniteAds():false,PopIn5.Discovery.Global.infinite);var f=1;var a=true;if(PopIn5.$F.notEmpty(b)){while(a&&e.length<20){a=false;for(var d=0;d<b.length;d++){var c=b[d];if(c.type=="ad"||f==1){e.push(c);a=true}}f++}}this.ads=e;this.status=1},getNextAd:function(){if(this.status===0){this.prepareAds()}if(PopIn5.$F.notEmpty(this.ads)){var a=this.ads[this.idx];this.idx++;return a}}});new PopIn5.Class("Discovery","ListInfiniteRenderer",{init:function(g,a,e){this._config=g;this.container=a;var h=g.infiniteSize;var j=g.infinitePages;var d=Math.min(j,Math.floor(e.length/g.infiniteSize));for(var b=0;b<d;b++){var c=[];for(var f=0;f<h;f++){var i=b*h+f;e[i].renderPosition=i;c.push(e[i])}this.renderPage(c)}},renderPage:function(a){var c=PopIn5.$F.ce(this.container,"div");PopIn5.$F.addClass(c,"_popIn_infinite_page");setTimeout(function(){PopIn5.$F.cssSet(c,"opacity",1)},1);var b=new PopIn5.Discovery.ListSimpleRenderer(this._config,c,a)}});new PopIn5.Class("Discovery","ListSimpleRenderer",{init:function(b,a,c){this.context=PopIn5.$.Context.findContext(a);this._config=b;this.data=c;this.container=a;this.plugins=new PopIn5.Discovery.Plugins();this.render();this.plugins.afterRender(this)},render:function(){var a=this.container;for(var b=0;b<this.data.length;b++){var c=this.data[b];c.renderIndex=b;this.renderArticle(a,c)}},renderArticle:function(e,b){var d=PopIn5.$F.digest(b.originalUrl);if(PopIn5.$F.isEmpty(this.context.discoverySelected[d])){this.context.discoverySelected[d]=0}this.context.discoverySelected[d]++;var a="ArticleRenderer"+b.type.substr(0,1).toUpperCase()+b.type.slice(1);if(typeof PopIn5.Discovery[a]=="undefined"){a="ArticleRenderer"}var c=new PopIn5.Discovery[a](e,b,this._config);this.plugins.afterRender(c);PopIn5.Discovery.Log.articleRenderedLog(this.context,b,c);return c}});PopIn5.StaticClass("Discovery","Log",{init:function(){},adRequestLog:function(a){PopIn5.Discovery.Treasure.adRequestLog(a)},boxRenderedLog:function(b){var a=PopIn5.$F.css(b.container,"position");if(a!=="fixed"){PopIn5.$F.inView({element:b.container,showArea:0,offset:-100,complete:function(){PopIn5.Discovery.Log.boxInViewLog(b)}})}else{PopIn5.Discovery.Log.boxInViewLog(b)}},boxInViewLog:function(g){var a=g._config;var b=g.context;PopIn5.Discovery.Treasure.discoveryInviewLog(g);var e=PopIn5.Discovery.Global.device;var f=PopIn5.Discovery.Global.media;var h=encodeURIComponent(b.target);var c=e+"_inview";var d=PopIn5.$.Log.logBuilder(PopIn5.$.Global.protocol+"//rlog.popin.cc/s.gif");d.add("url",h);d.add("uid","");d.add("type",c);d.add("nid",e);d.add("media",f);PopIn5.$.Segment.addSegmentLog(d,a,b);d.add("t",new Date().getTime());PopIn5.$.Log.uniqueLog(["type="+c,"url="+h],d.build())},intextBoxRenderedLog:function(c){var b="_channel_pv";this.channelLogAssit(b,c._config,c.context);var a=PopIn5.$F.css(c.container,"position");if(a!=="fixed"){PopIn5.$F.inView({element:c.container,showArea:0,offset:-100,complete:function(){PopIn5.Discovery.Log.intextBoxInViewLog(c._config,c.context)}})}else{PopIn5.Discovery.Log.intextBoxInViewLog(c._config,c.context)}},intextBoxInViewLog:function(a,b){var c="_channel_inview";this.channelLogAssit(c,a,b)},channelLogAssit:function(l,e,c){var b=PopIn5.Discovery.Global.device;var g=PopIn5.Discovery.Global.media;var k=encodeURIComponent(c.target);var f=e.channelId;var m=["url",k,"uid","","type",b+l,"nid",b,"media",g];var a=PopIn5.$.Log.logBuilder(PopIn5.$.Global.protocol+"//rlog.popin.cc/s.gif");for(var h=0,d=m.length;h<d;h+=2){var j=m[h];var n=m[h+1];a.add(j,n)}PopIn5.$.Segment.addSegmentLog(a,e,c);a.add("r5","ch_"+f);a.add("t",new Date().getTime());PopIn5.$.Log.uniqueLog(["type="+l,"url="+k],a.build())},logSns:function(e){if(Math.random()<1/10){return}var c=0;var b=0;var f=["facebook"];var g=f.length;var a=function(h){c+=h;b++;if(b==g){if(c>=30){var k=encodeURIComponent(e.target);var i=PopIn5.$.Log.logBuilder(PopIn5.$.Global.protocol+"//rlog.popin.cc/log.gif");i.add("url",k);i.add("share",c);var j=PopIn5.$F.parseUri(e.configs.discovery.apiUrl);if(j.host=="jp.popin.cc"){i.add("type","share-jp")}if(j.host=="tw.popin.cc"){i.add("type","share-tw")}if(j.host=="kr.popin.cc"){i.add("type","share-kr")}PopIn5.$.Log.log(i.build())}}};for(var d=0;d<g;d++){PopIn5.Share.Handlers.start(f[d],a,e.target)}},logRelated:function(b){var d=PopIn5.Discovery.Global.device;var e=PopIn5.Discovery.Global.media;var g=encodeURIComponent(b.target);var a="type=related";var f=PopIn5.$F.notEmpty(b.configs)&&PopIn5.$F.notEmpty(b.configs.discovery)?b.configs.discovery.apiUrl:"";if(/(jp|tw|kr).popin.cc/.test(f)){a="type=related-"+RegExp.$1}var c=PopIn5.$.Log.logBuilder(PopIn5.$.Global.protocol+"//r.popin.cc/log.gif");c.add("type",a.replace(/type=/,""));c.add("uid","");c.add("url",g);PopIn5.$.Log.uniqueLog([a,"url="+g],c.build()+"&"+new Date().getTime())},previewLog:function(a,b){PopIn5.Discovery.Treasure.discoveryPreviewData({context:b,_config:a});PopIn5.Discovery.Treasure.discoveryConcatnationPVLog({context:b});var d=PopIn5.Discovery.Global.device;var e=PopIn5.Discovery.Global.media;var f=encodeURIComponent(b.target);var c=PopIn5.$.Log.logBuilder(PopIn5.$.Global.protocol+"//rlog.popin.cc/s.gif");c.add("url",f);c.add("uid","");c.add("type",d+"_pv");c.add("nid",d);c.add("media",e);PopIn5.$.Segment.addSegmentLog(c,a,b);c.add("t",new Date().getTime());PopIn5.$.Log.uniqueLog(["type="+d+"_pv","url="+f],c.build())},adBoxRenderedLog:function(a,c){PopIn5.Discovery.Treasure.discoveryAdsImpressionLog({context:c,_config:a});var e=PopIn5.$.Global.deviceForAd;var b=PopIn5.$.Global.uid;var g=PopIn5.Discovery.Global.media;var f=encodeURIComponent(c.target);var d=PopIn5.$.Log.logBuilder(PopIn5.$.Global.protocol+"//rlog.popin.cc/s.gif");d.add("url",f);d.add("uid",b);d.add("type",e+"_imp");d.add("nid","");d.add("media",g);PopIn5.$.Segment.addSegmentLog(d,a,c,{onlyCommonCategory:true});if(PopIn5.$F.notEmpty(a.channelId)){d.add("r5","ch_"+a.channelId)}d.add("t",new Date().getTime());PopIn5.$.Log.uniqueLog(e+"_imp",d.build())},adChannelImpLog:function(a,c){if(typeof c._sentChannelIdForChannelImpLog==="undefined"){c._sentChannelIdForChannelImpLog=[]}if(PopIn5.$F.isEmpty(a.channelId)||(c._sentChannelIdForChannelImpLog.indexOf(a.channelId)>-1)){return}c._sentChannelIdForChannelImpLog.push(a.channelId);var e=PopIn5.$.Global.deviceForAd;var b=PopIn5.$.Global.uid;var g=PopIn5.Discovery.Global.media;var f=encodeURIComponent(c.target);var d=PopIn5.$.Log.logBuilder(PopIn5.$.Global.protocol+"//rlog.popin.cc/s.gif");d.add("url",f);d.add("uid",b);d.add("type",e+"_channel_imp");d.add("nid","");d.add("media",g);PopIn5.$.Segment.addSegmentLog(d,a,c,{onlyCommonCategory:true});d.add("r5","ch_"+a.channelId);d.add("t",new Date().getTime());PopIn5.$.Log.uniqueLog(["type="+e+"_channel_imp","url="+c.target],d.build())},articleRenderedLog:function(c,b,d){if(b.type.indexOf("ad")===0){var a=this;PopIn5.$F.inView({element:d.renderParts.articleDiv,showArea:0.5,complete:function(){a.adBoxRenderedLog(d._config,c);a.adChannelImpLog(d._config,c);setTimeout(function(){a.adInViewLog(d._config,c,b)},1000)}})}},adInViewLog:function(e,d,j){if(PopIn5.$F.notEmpty(j.debug)){return}var l=Math.round((new Date().getTime()-PopIn5.Loader.timeLoad)/1000);if(l>60*30){return}PopIn5.Discovery.Treasure.adInViewLog(e,d,j);var g=j.url.match(/token=(.+)&/)[1];var b=j.nid;var h=j.campaign;var c=PopIn5.$.Global.deviceForAd;var k=PopIn5.$.Global.uid;var i=PopIn5.Discovery.Global.media;var f=encodeURIComponent(d.target);var a=PopIn5.$.Log.logBuilder(PopIn5.$.Global.protocol+"//rlog.popin.cc/s.gif");a.add("url",f);a.add("uid",k);a.add("type",c+"_imp");a.add("nid",b);a.add("campaign",h);a.add("media",i);PopIn5.$.Segment.addSegmentLog(a,e,d,{onlyCommonCategory:true});a.add("r6",g);PopIn5.Discovery.Log.writeLog(a.build());if(PopIn5.$F.notEmpty(j.trackingPixel)){this._writeTrackingPixel(j.trackingPixel)}else{if(PopIn5.$F.notEmpty(j.tracking_pixel)){this._writeTrackingPixel(j.tracking_pixel)}}},videoTracking:function(a,b){if(PopIn5.$F.isEmpty(b.trackingPixel)){return}if(PopIn5.$F.isEmpty(b.impUrl)){return}if(a==="imp"||a==="playTimeSeconds"&&PopIn5.$F.notEmpty(b.play_time_seconds)){try{this._writeTrackingPixel(b.trackingPixel)}catch(c){}b.trackingPixel=""}},clickTrackingLog:function(a){this._writeTrackingPixel(a)},_writeTrackingPixel:function(c){var b=c.replace(/""/g,'"');var a=[];a.push('<body style="margin:0px;padding:0px;background-color: transparent;">');a.push("<script>window.inDapIF = true;<\/script>");a.push(b);a.push("</body>");PopIn5.$F.iframeLoader(a.join(""),{src:"about:self",scrolling:"no",frameBorder:"0",allowTransparency:true,css:{width:"0px",height:"0px",margin:"0px",padding:"0px",overflow:"none"}})},videoLog:function(k,n,h,f){var p="";try{this.videoTracking(n,k)}catch(m){}var r=(PopIn5.$F.notEmpty(k.videoObj.type)&&k.videoObj.type==="vast")?true:false;var c=function(e){e.forEach(function(s){PopIn5.$.Log.log(s)})};if(n==="imp"&&PopIn5.$F.notEmpty(k.impUrl)){p=k.impUrl;if(PopIn5.$F.notEmpty(k.play_time_seconds)){p+="&target=m"}PopIn5.Discovery.Treasure.adVideoLog(PopIn5.$.Global.deviceForAd+"_video_"+n,f,k);if(r&&PopIn5.$F.notEmpty(k.videoObj.Impression)){c(k.videoObj.Impression)}PopIn5.$.Log.log(p);return}if(n==="playTimeSeconds"&&PopIn5.$F.notEmpty(k.impUrl)){p=k.impUrl;if(PopIn5.$F.notEmpty(k.play_time_seconds)){p+="&target=c"}PopIn5.Discovery.Treasure.adVideoLog(PopIn5.$.Global.deviceForAd+"_video_"+n,f,k);PopIn5.$.Log.log(p);return}if(""+n=="100"&&PopIn5.$F.notEmpty(k.endUrl)){PopIn5.$.Log.log(k.endUrl)}var o="";var b=k.nid;var j=k.campaign;var d=PopIn5.$.Global.deviceForAd;var l=PopIn5.$.Global.uid;var g=PopIn5.Discovery.Global.media;var i=encodeURIComponent(PopIn5.Discovery.Global.target);if(n==="twoSeconds"){n="2s"}if(n==="threeSeconds"){n="3s"}var a=PopIn5.$.Log.logBuilder(PopIn5.$.Global.protocol+"//rlog.popin.cc/s.gif");a.add("url",i);a.add("uid",l);a.add("type",d+"_video_"+n);a.add("nid",b);a.add("campaign",j);a.add("media",g);if((""+n)==="100"){PopIn5.$.Segment.addSegmentLog(a,h,f,{useCommonCategory:true})}a.add("r5","cc_video");a.add("r6","video_imp");a.add("t",new Date().getTime());o=a.build();PopIn5.Discovery.Treasure.adVideoLog(d+"_video_"+n,f,k);if(n==="2s"){PopIn5.Discovery.Treasure.discoveryVideoMediaLog(f,k)}if(r){var q=(""+n);switch(q){case"full":c(k.videoObj.ClickTracking);break;case"2s":c(k.videoObj.start);break;case"25":c(k.videoObj.firstQuartile);break;case"50":c(k.videoObj.midpoint);break;case"75":c(k.videoObj.thirdQuartile);break;case"100":c(k.videoObj.complete);break;default:break}}PopIn5.$.Log.log(o)},clickLog:function(d,c,e,i){PopIn5.Discovery.Treasure.discoveryClickLog({context:c,item:i,_config:d});var b=PopIn5.Discovery.Global.device;var g=PopIn5.Discovery.Global.media;var f=d.channelId;var a=PopIn5.$.Log.logBuilder(PopIn5.$.Global.protocol+"//rlog.popin.cc/s.gif");a.add("url","");a.add("uid","");a.add("type",b+"_rclick");a.add("nid",b);a.add("media",g);PopIn5.$.Segment.addSegmentLog(a,d,c);var h=PopIn5.$.Global.protocol+"//r.popin.cc/log.gif?type=click&url="+encodeURIComponent(i.url)+"&common_category="+c.segmentData.commonCategory;PopIn5.$F.ssSet("__discovery_clicklog",h);if(PopIn5.$F.notEmpty(f)){a.add("r5","ch_"+f)}this.writeLog(a.build(),e)},writeLog:function(c,b){b=b||function(){};var a=(function(){var d=false;return function(){if(!d){d=true;b()}}})();c+=("&t="+new Date().getTime());setTimeout(a,200);PopIn5.$.Log.log(c,{onLoad:a,onError:a})}});PopIn5.Module("Discovery",{initModule:function(){var a=this;if(location.href.indexOf("popinbasedebug=true")>0){var f=function(j,h){var i=document.getElementById("_popIn_debug_base");if(PopIn5.$F.isEmpty(i)){i=PopIn5.$F.ce(document.body,"div");i.id="_popIn_debug_base";i.style.position="fixed";i.style.width="500px";i.style.height="500px";i.style.overflow="auto";i.style.right="10px";i.style.padding="10px";i.style.top="10px";i.style.border="solid 1px gray";i.style.backgroundColor="black";i.style.zIndex=999999}PopIn5.$F.ce(i,"div",j).style.color=h||"#00ff00"};var e=function(i,j,h){var k=i[h];if(typeof k!="function"){return}i[h]=function(){f("Discovery."+j+"."+h);try{return k.apply(this,arguments)}catch(l){f("ERROR: "+l,"#FF0000")}}};for(var d in PopIn5.Discovery){for(var c in PopIn5.Discovery[d].prototype){e(PopIn5.Discovery[d].prototype,d,c)}}}if(PopIn5.$F.notEmpty(this._config.debugLog)){PopIn5.$.Log.log("http://rlog.popin.cc/s.gif?url="+location.host+"&uid=&type=paid_discovery_initModule&t="+Date.now())}if(PopIn5.$F.notEmpty(PopIn5.$.Config.includeFilter.url)){if(!PopIn5.$F.testOne(PopIn5.$.Config.includeFilter.url,this._config.target)){return false}}this.testMode=0;this.testMode+=(location.href.indexOf("popinadtest=true")>-1?1:0);this.testMode+=(location.href.indexOf("popinadid=")>-1?1:0);this.testMode+=(location.href.indexOf("popinvideotest=")>-1?1:0);this.testMode+=(location.href.indexOf("popinadimage=")>-1?1:0);for(var b=0;b<PopIn5.$.Context.contexts.length;b++){a.initContext(PopIn5.$.Context.contexts[b])}PopIn5.$.Global.event.addEventListener("newContext",function(h){a.initContext(h)});var g=PopIn5.$F.ssGet("__discovery_clicklog");if(PopIn5.$F.notEmpty(g)){PopIn5.$.Log.log(g);PopIn5.$F.ssSet("__discovery_clicklog","")}},initContext:function(c){var b=c.key;var d=b.querySelector("._popIn_recommend");if(PopIn5.$F.notEmpty(d)){var a=d.getAttribute("data-url");if(PopIn5.$F.notEmpty(a)){c.target=PopIn5.$F.replaceAll(a,PopIn5.$.Config.urlReplace)}}this.startContext(c)},startContext:function(a){a.configs.discovery=this._config;a.discoverySelected={};this.initProxy(a);if(PopIn5.$.Config.isArticle){PopIn5.Discovery.Log.logRelated(a);PopIn5.Discovery.Log.logSns(a)}},initProxy:function(c){var t=false,u=null;for(var g=0,d=this._config.templates.length;g<d;g++){var o=this._config.templates[g];u=c.key.querySelector(o.selector);t=t||PopIn5.$F.notEmpty(u)}for(var f=0,n=this._config.videos.length;f<n;f++){var b=this._config.videos[f];u=c.key.querySelector(b.selector);t=t||PopIn5.$F.notEmpty(u)}if(t){var a=this._config.apiUrl;a=a.replace("%target",encodeURIComponent(c.target));if(!PopIn5.$.Config.isArticle){a+="&related=false"}var k=this;var q=function(e){PopIn5.Discovery.Performance.addTimeMark("api_data_will_deal");k.handleResult(c,e)};if(this.testMode>0){window._popIn_discovery_test={url:a,callback:q};var m=document.createElement("script");m.type="text/javascript";m.charset="UTF-8";m.async=true;m.src="https://i.popincdn.com/test/discovery_test.js";var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(m,r);return}var l=function(){PopIn5.Discovery.Performance.addMark("apiUrl",a).addTimeMark("api_will_request");var e=new PopIn5.$.ProxyAjax(a);e.timeout=5000;e.setCallback(q);e.load()};try{var p=PopIn5.$.Treasure.createLogger();p.ready(function(){try{var w=p.getTrackValues();w=PopIn5.Discovery.Treasure.updateBrowserInfo(w);var s={};for(var j in w){s["user_"+j]=j=="td_title"?encodeURIComponent(w[j]):w[j]}s.user_device=PopIn5.$.Global.device;s.user_time=Date.now();var v=JSON.stringify(s);var y=btoa(unescape(encodeURIComponent(v)));a+=("&info="+y)}catch(x){}l()})}catch(h){l()}PopIn5.Discovery.Treasure.discoverySelector(c,this._config)}},handleResult:function(b,l){if(PopIn5.$F.notEmpty(l)){PopIn5.$.Global.event.fireEvent("result-loaded",[l]);if(PopIn5.$F.notEmpty(l.category)){b.segmentData.category=l.category}if(PopIn5.$F.notEmpty(l.common_category)){b.segmentData.commonCategory=l.common_category}if(PopIn5.$F.notEmpty(l.logid)){PopIn5.$.Global.logid=l.logid}PopIn5.$.Global.event.fireEvent("start-render",[]);b.discoveryData=l;if(this._config.adEnable){PopIn5.Discovery.Log.adRequestLog(b)}for(var f=0,c=this._config.videos.length;f<c;f++){var a=this._config.videos[f];var d=new PopIn5.Discovery.VideoBox(b,l,this._config,a)}for(var e=0,h=this._config.templates.length;e<h;e++){var k=this._config.templates[e];var g=new PopIn5.Discovery.Box(b,l,this._config,k)}}else{PopIn5.$.Global.event.fireEvent("no-content",[])}}});PopIn5.StaticClass("Discovery","Performance",{isSupported:(typeof window.performance!=="undefined")&&(typeof window.performance.getEntries==="function"),enableMonitor:false,sample:0.5,isResourceReady:false,db:"popin_ads",table:"fe_performance_monitor",marks:{},data:{},resourceFilterRules:[function(a,b){if(/\/searchbox\/.+\.js$/.test(b.name)){a.addMark("request_config_start",b.startTime);a.set("rcd",parseInt(b.duration,10));a.addMark("request_config_end",b.responseEnd);return true}},function(a,b){if(/\/popin_discovery5.+\.js$/.test(b.name)){a.addMark("request_discovery_start",b.startTime);a.set("rdd",parseInt(b.duration,10));a.addMark("request_discovery_end",b.responseEnd);return true}},function(a,b){if(b.name.indexOf(a.marks.apiUrl)===0){a.addMark("request_api_start",b.startTime);a.set("rad",parseInt(b.duration,10));a.addMark("request_api_end",b.responseEnd);return true}}],init:function(a){if(!this.isSupported){return}this.addMark("discovery_init",PopIn5.__PERFORMANCE_DISCOVERY_INIT__);this.bindEvent();return this},check:function(){var a=PopIn5.Discovery.Global;if(typeof a.performanceSample==="number"){this.sample=a.performanceSample}if(typeof a.enablePerformanceMonitor!=="undefined"){this.enableMonitor=a.enablePerformanceMonitor}if(!this.isSupported||Math.random()>this.sample){this.enableMonitor=false}},bindEvent:function(){var a=this;window.addEventListener("load",function(){a.isResourceReady=true;if(a.marks.is_box_rendered){a.report()}},false)},addTimeMark:function(a){if(!this.isSupported){return this}if(a==="box_did_render"&&this.marks.box_did_render!==void 0){return this}this.marks[a]=window.performance.now();return this},addMark:function(a,b){this.marks[a]=b;return this},set:function(a,b){this.data[a]=b;return this},collectResourceInfo:function(){var a=window.performance.getEntries();var h=this.resourceFilterRules;var f=h.length;var b={};for(var d=0,e;e=a[d++];){for(var c=0,g;g=h[c];c++){if(!g(this,e)){continue}b[g.key]=e;h.splice(c,1);f--;break}if(f===0){break}}},analyse:function(){var b=this.data;var c=PopIn5.Discovery.Treasure.uainfo||{};b.host=window.location.host;b.user_agent=window.navigator.userAgent;b.browser=c.browser||"";b.browser_version=c.browser_version||"";b.os=c.os||"";b.os_version=c.os_version||"";b.device=PopIn5.Discovery.Global.device||"";var a=top.screen;b.screen=a?[a.width,a.height].join("x"):"-";b.libLoadMode="script";b.rce_rds=this.calculate("request_config_end","request_discovery_start");b.rde_di=this.calculate("request_discovery_end","discovery_init");b.di_awr=this.calculate("discovery_init","api_will_request");b.awr_ras=this.calculate("api_will_request","request_api_start");b.rae_adwd=this.calculate("request_api_end","api_data_will_deal");b.adwd_bdr=this.calculate("api_data_will_deal","box_did_render");b.total=this.calculate("request_config_start","box_did_render");b.popin_version=5},calculate:function(c,b){var a=this.marks;if(typeof a[c]==="undefined"||typeof a[b]==="undefined"){return"null"}return parseInt(a[b]-a[c],10)},report:function(){this.check();if(!this.enableMonitor||!this.isResourceReady||this.isReported){return}this.collectResourceInfo();this.analyse();if(this.data.total>0){var b=this;var a=new window.Treasure({writeKey:"8378/25839e06ce4cc1cab55c1c1f1e49d336d6d1d48f",database:this.db});a.addRecord(this.table,this.data)}this.isReported=true;return this}});PopIn5.Class("Discovery","PluginAfterinview",{init:function(a){if(a._className!="BoxRenderer"){return}this._height=Math.min(300,Math.ceil(Math.max.apply(null,[document.body.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.documentElement.clientHeight])/4));this._topPos=PopIn5.$F.getPageScrollTop();this.showWidget(a)},showWidget:function(d){var a=d.container;var f=PopIn5.$F.position(a);this._height+=f.top;var g=PopIn5.$F.css(a,"height");PopIn5.$F.css(a,{display:"none",opacity:0,height:1});var h=this,j=null;var i=function(){PopIn5.$F.css(a,{display:"",transition:"opacity 500ms, height 500ms"});PopIn5.$F.inView({element:a,offset:0,complete:function(){PopIn5.$F.css(a,{opacity:1,height:g})}})};var c=0;var e=false;var b=function(){var l=PopIn5.$F.getPageScrollTop();var k=l-h._topPos;if(l>h._height){e=true}if(k<c&&l<h._height&&l<f.top&&e){i();clearInterval(j)}else{c=k}};j=setInterval(b,500)}});PopIn5.Class("Discovery","PluginClickall",{init:function(a){if(a._className.indexOf("ArticleRenderer")<0){return}var b=a.renderParts.articleDiv;PopIn5.$F.bind(b,"click",function(c){c.preventDefault();var d=b.querySelector("A");var e=d.cloneNode(true);e.click()})}});PopIn5.Class("Discovery","PluginFullclick",{init:function(a){if(a._className.indexOf("ArticleRenderer")<0){return}var c=a.renderParts.articleDiv;var b=document.createElement("a");c.parentNode.insertBefore(b,c);while(c.childNodes.length>0){b.appendChild(c.firstChild)}c.parentNode.removeChild(c);b.setAttribute("class",c.getAttribute("class"));a.addClickEvent(b);a.renderParts.articleDiv=b}});PopIn5.Class("Discovery","PluginImageback",{init:function(a){if(a._className.indexOf("ArticleRenderer")<0){return}var b=a.renderParts.image;if(PopIn5.$F.notEmpty(b)){PopIn5.$F.css(b.parentNode,{"background-image":"url("+b.src+")"});PopIn5.$F.remove(b)}}});PopIn5.Class("Discovery","PluginInfinite",{init:function(a){if(a._className.indexOf("ListSimpleRenderer")<0){return}this.renderer=a;this.container=a.container;this.context=a.context;if(PopIn5.$F.notEmpty(this.context.discoveryData.infinite)){PopIn5.Discovery.Global.infinite=this.context.discoveryData.infinite}if(typeof _popIn_noVideo_loader==="function"){PopIn5.$.Global.event.addEventListener("no-video",_popIn_noVideo_loader)}this.render()},getVideo:function(){var c=PopIn5.Discovery.VideoUtils.getVideo(this.context);if(PopIn5.$F.isEmpty(c)){return}var b=window.navigator.userAgent;function e(g){var f=g.match(/android\s([0-9\.]*)/);return f?f[1]:false}var a=parseFloat(e(b));var d=/Chrome/.test(b)&&!/Version/.test(b);if(!isNaN(a)&&!d){PopIn5.$.Log.log("https://rlog.popin.cc/s.gif?url="+location.host+"&uid=&type=paid_video_NG1&t="+Date.now());return}if(!isNaN(a)&&a<4){PopIn5.$.Log.log("https://rlog.popin.cc/s.gif?url="+location.host+"&uid=&type=paid_video_NG2&t="+Date.now());return}PopIn5.$.Log.log("https://rlog.popin.cc/s.gif?url="+location.host+"&uid=&type=paid_video_OK&t="+Date.now());return c},render:function(){if(PopIn5.Discovery.InfiniteAds.idx==this.renderer._config.adVideoPosition){var b=this.getVideo();if(PopIn5.$F.notEmpty(b)){this.renderVideo(b,this.container);PopIn5.Discovery.InfiniteAds.idx++;return}}var a=PopIn5.Discovery.InfiniteAds.getNextAd();if(PopIn5.$F.notEmpty(a)){if(a.type=="ad"){this.renderAd(a,this.container)}if(a.type=="article"){this.renderArticle(a,this.container)}}else{var c=PopIn5.$F.ce(this.container,"div");PopIn5.$F.addClass(c,"_popIn_infinite_empty")}},renderAd:function(d,a){var e=PopIn5.$F.ce(a,"div");PopIn5.$F.addClass(e,"_popIn_infinite_ad");PopIn5.$F.cssSet(e,"height",d.height);var c=function(){var f=[];f.push('<body style="margin:0px;padding:0px;background-color: transparent;">');f.push("<script>window.inDapIF = true;<\/script>");f.push(d.script);f.push("</body>");PopIn5.$F.iframeLoader(f.join(""),{parentNode:e,src:"about:self",scrolling:"no",frameBorder:"0",allowTransparency:true,css:{width:d.width+"px",height:d.height+"px",margin:"0px",padding:"0px",overflow:"none"}})};var b=this.context.configs.discovery;if(this.renderer._config.adInView){PopIn5.$F.inView({element:e,complete:c})}else{c()}},renderArticle:function(b,a){var d=PopIn5.$F.ce(a,"div");PopIn5.$F.addClass(d,"_popIn_infinite_article");var c=new PopIn5.Discovery.ListSimpleRenderer(this.renderer._config,d,[PopIn5.$F.join(b,{type:"inf_ad",renderIndex:this.renderer.data.renderIndex})])},renderVideo:function(f,d){var c=this.renderer._config;var g=document.createElement("div");var b=c.adVideoInsertSelector;var a=c.adVideoInsertPosition;if(PopIn5.$F.notEmpty(b)&&PopIn5.$F.notEmpty(b)){var e=document.querySelector(b);if(PopIn5.$F.notEmpty(e)){PopIn5.$F.insertAdjacentElement(e,a,g)}}else{d.appendChild(g)}PopIn5.$F.addClass(g,"_popIn_infinite_video");new PopIn5.Discovery.Video2(this.renderer._config,this.renderer.context,g,f)}});PopIn5.Class("Discovery","PluginMultipledivs",{init:function(a){if(a._className!="BoxRenderer"){return}this.movePages(a)},movePages:function(e){var b=e.container;var c=b.querySelectorAll("._popIn_infinite_page");var k=document.querySelectorAll("._popIn_recommend");var d=Math.min(c.length,k.length);var f=false;for(var g=1;g<d;g++){var h=c[g];var a=k[g];var j=PopIn5.$F.ce(a,"div");PopIn5.$F.addClass(j,"_popIn_recommend_container");var l=PopIn5.$F.ce(j,"div");PopIn5.$F.addClass(l,"_popIn_recommend_articles");l.appendChild(h);f=j}if(f){f.appendChild(e.creditDiv)}}});PopIn5.Class("Discovery","PluginNewwindow",{init:function(a){if(a._className.indexOf("ArticleRenderer")<0){return}var b=a.data.url;a.handleClick=function(){var c=a;var d=PopIn5.$.Context.findContext(a.container);PopIn5.Discovery.Log.clickLog(a._config,d,function(){a.addClickCookie()},a.data);window.open(b)}}});PopIn5.Class("Discovery","PluginRanking",{init:function(a){if(a._className.indexOf("ArticleRenderer")<0){return}this.articleRenderer=a;this.render()},render:function(){var b=this.articleRenderer.data.renderIndex+1;var a=this.articleRenderer.renderParts.articleDiv;var c=document.createElement("div");PopIn5.$F.insertAdjacentElement(a,"afterbegin",c);PopIn5.$F.addClass(c,"_popIn_plugin_ranking _popIn_plugin_rank"+b);c.innerHTML=b}});PopIn5.Class("Discovery","PluginSamewindow",{init:function(b){if(b._className.indexOf("ArticleRenderer")<0){return}var g=b.renderParts.articleDiv;var a=g.querySelectorAll("a");for(var d=0,f=a.length;d<f;d++){var c=a[d];var e=c.getAttribute("target");if(e&&e==="_blank"){c.removeAttribute("target")}}}});PopIn5.Class("Discovery","PluginSns",{init:function(a){if(a._className.indexOf("ArticleRenderer")<0){return}this.articleRenderer=a;this.total=this.articleRenderer.data.share;this.render()},render:function(){if(PopIn5.$F.isEmpty(this.total)){return}var a=this.articleRenderer.renderParts.articleDiv;var c=document.createElement("div");PopIn5.$F.insertAdjacentElement(a,"afterbegin",c);PopIn5.$F.addClass(c,"_popIn_plugin_sns");this.numberElement=c;var b=this.articleRenderer._config.snsFormat;this.numberElement.innerHTML=b.replace(/\$SNS/,this.total)}});PopIn5.Class("Discovery","Plugins",{init:function(){},afterRender:function(c){var b=c._config;var a=b.plugins;for(var d=0;d<a.length;d++){this.initPlugin(a[d],c)}},initPlugin:function(c,a){var b="Plugin"+c.charAt(0).toUpperCase()+c.slice(1).toLowerCase();if(typeof PopIn5.Discovery[b]!="undefined"){new PopIn5.Discovery[b](a)}}});PopIn5.Class("Discovery","TemplateConfig",{init:function(a){this.setDefaults(a);PopIn5.$.Config.overrideAll(this,a);this.afterConfig(a)},setDefaults:function(a){this.selector="#_popIn_recommend";this.position="AfterBegin";this.containerId="_popIn_recommend_div";this.dateFormat=PopIn5.$F.getParam("date_format","(Y年M月D日)");this.dateShowYear=PopIn5.$F.getParam("date_format_show_year",true);this.title=false;this.credit="Recommended by";this.afterRender=function(){};this.includeRules=[];this.excludeRules=[];this.imageInView=PopIn5.$F.notEmpty(a.infiniteSize);this.imageSize=PopIn5.$F.isMobileDevice()?"":160;this.delImage=false;this.notFoundImg=PopIn5.$.Global.protocol+"//"+PopIn5.$.Global.baseDomain+"/images/noimg.png";this.debugMode=/popindebug=true/.test(location.href);this.addQuery="";this.plugins=[];this.infiniteSize=0;this.infinitePages=20;this.loadAfter=false;this.showLocation=false;this.inView=false;this.mediaFormat="($MEDIA)";this.adVideoPosition=0;this.adInView=true;this.adVideoInsertSelector=false;this.adVideoInsertPosition=false;this.autoPlay=false;this.videoPosition="AfterEnd";this.smoothOffset=-200;this.snsFormat="<span>$SNS</span>";this.segmentData={};this.channelId=false},afterConfig:function(){}});PopIn5.ErrorSafeStaticClass("Discovery","Treasure",{init:function(){this.history=[];this.specialLogHistory=[];this.setup()},setup:function(){var a=function(i,h){try{return c(i.split(h)[1].trim().split(/[^\w\.]/)[0])}catch(j){}return"0.0.0"};var c=function(h){var i=h.split(/[\._]/);return(parseInt(i[0],10)||0)+"."+(parseInt(i[1],10)||0)+"."+(parseInt(i[2],10)||0)};var b=function(h){switch(true){case /Android/.test(h):return"Android";case /iPhone|iPad|iPod/.test(h):return"iOS";case /Windows/.test(h):return"Windows";case /Mac OS X/.test(h):return"Mac"}return""};var f=function(h,i){switch(i){case"Android":return a(h,"Android");case"iOS":return a(h,/OS /);case"Windows":return a(h,/Phone/.test(h)?/Windows Phone (?:OS )?/:/Windows NT/);case"Mac":return a(h,/Mac OS X /)}return"0.0.0"};var d=function(h){switch(true){case /CriOS/.test(h):return"Chrome for iOS";case /Edge/.test(h):return"Edge";case /Chrome/.test(h):return"Chrome";case /Firefox/.test(h):return"Firefox";case /Android/.test(h):return"AOSP";case /MSIE|Trident/.test(h):return"IE";case /Safari\//.test(h):return"Safari";case /AppleWebKit/.test(h):return"WebKit";case /Vivaldi/.test(h):return"Vivaldi"}return""};var g=function(i,h){switch(h){case"Chrome for iOS":return a(i,"CriOS/");case"Edge":return a(i,"Edge/");case"Chrome":return a(i,"Chrome/");case"Firefox":return a(i,"Firefox/");case"Vivaldi":return a(i,"Vivaldi/");case"AOSP":return a(i,/Silk/.test(i)?"Silk/":"Version/");case"IE":return/IEMobile/.test(i)?a(i,"IEMobile/"):/MSIE/.test(i)?a(i,"MSIE "):a(i,"rv:");case"Safari":return a(i,"Version/");case"Webkit":return a(i,"WebKit/")}return""};var e=function(){var i=window.navigator.userAgent;var k=b(i);var l=f(i,k);var h=d(i);var j=g(i,h);return{os:k,os_version:l,browser:h,browser_version:j}};this.uainfo=e()},discoveryLogger:function(a,b){return{context:a,_logger:b,getTrackValues:function(){return(typeof this._logger.getTrackValues!=="undefined")?this._logger.getTrackValues():{}}}},getLogger:function(a){if(PopIn5.$F.isEmpty(this.tdLogger)){this.tdLogger=PopIn5.$.Treasure.createLogger()}return this.discoveryLogger(a,this.tdLogger)},getAdLogger:function(a){if(PopIn5.$F.isEmpty(this.adLogger)){this.adLogger=PopIn5.$.Treasure.createAdLogger()}return this.discoveryLogger(a,this.adLogger)},isLogExsists:function(e,d){var a=false;var c=PopIn5.$F.isArray(d)?d:[d];for(var b=0,f=e.length;b<f;b++){a=a||(e[b].indexOf(d.join(""))>=0)}return a},adClickLog:function(b,a){this.adLogOne("click",b,a)},adInViewLog:function(a,c,b){if(b.type==="ad"||b.type==="ad_image"){this.adLogOne("imp",c,b)}else{this.adLogOne("reserved_imp",c,b)}},adVideoLog:function(c,b,a){this.adLogOne(c,b,a)},adLogOne:function(d,c,b){var a=PopIn5.$F.parseUrl(b.url);this.adLogCommon(c,{type:d,nid:b.nid,campaign:b.campaign,token:a.qString.token,uid:a.qString.uid,timestamp:Date.now()},b)},adRequestLog:function(b){var c=(typeof b.configs!=="undefined"&&typeof b.configs.discovery!=="undefined")?b.configs.discovery.ad:0;var d=(typeof b.discoveryData!=="undefined"&&typeof b.discoveryData.ad!=="undefined")?b.discoveryData.ad.length:0;var a=(typeof b.discoveryData!=="undefined"&&typeof b.discoveryData.af!=="undefined")?b.discoveryData.af+"":"";this.adLogCommon(b,{type:"req",request_ad:c,response_ad:d,af:a})},adLogCommon:function(b,e,a){var f=Math.round((new Date().getTime()-PopIn5.Loader.timeLoad)/1000);var d=PopIn5.$F.join({},e);d.time_show_seconds=f;d.device=PopIn5.$F.isMobileDevice()?"mobile":"pc";if(PopIn5.$F.notEmpty(b.discoveryData)){var g=b.discoveryData.common_category;d.common_category=PopIn5.$F.notEmpty(g)?(PopIn5.$F.isArray(g)?g[0]:g):"";var c=PopIn5.$F.parseUri(b.configs.discovery.apiUrl).host;d.api_host=c.replace("discoveryplus.","jp.");d.media=PopIn5.Discovery.Global.media;if(b.discoveryData.logid){d.logid=b.discoveryData.logid}if(b.discoveryData.rid){d.rid=b.discoveryData.rid}if(b.discoveryData.sample_tag){d.sample_tag=b.discoveryData.sample_tag}}if(a){a.c1&&(d.c1=a.c1);a.c2&&(d.c2=a.c2)}d.popin_user_id=PopIn5.$.UserId.getUid();this.writeAdRecord(d,b,a)},writeAdRecord:function(d,c,b){var a=this.getAdLogger(c);d=PopIn5.$F.join(d,a.getTrackValues());d.url=c.target;this.writeRecord(a,"adlogs",d);if(d.type==="imp"){this.newSpecialLogForAd(a,d,b)}},emptyData:function(a,b){var k=this.getLogger(a);var g=PopIn5.$F.join({},k.getTrackValues());g.type="empty_data";var j=b.type;if(PopIn5.$F.notEmpty(j)&&PopIn5.$F.isArray(j)){if(j.join(",")==="rand,related,0"){return}if(j[0]=="pattern"){var h=[];for(var e=1;e<j.length-1;e++){var f=j[e];h.push(PopIn5.$F.isArray(f)?f.join(","):f)}g.template_type="pattern["+h.join("|")+"]"}else{g.template_type=j.join(",")}}else{g.template_type=j}var d=a.discoveryData;var c=JSON.stringify(d);c=c.substring(0,Math.min(c.length,1000));g.api_response=c;this.writeRecord(k,"errorlogs",g)},getDiscoveryCommonData:function(h){var j={};if(PopIn5.$F.notEmpty(h.context)){var a=h.context;var b=h.config;var g=a.discoveryData||{};var e=g.common_category;var i=PopIn5.$F.notEmpty(e)?(PopIn5.$F.isArray(e)?e[0]:e):"";var f=PopIn5.$F.parseUri(a.configs.discovery.apiUrl).host;var d=f.replace("discoveryplus.","jp.");var k=PopIn5.$F.notEmpty(a.configs.discovery.segmentData.abtest)?a.configs.discovery.segmentData.abtest:"";var c=PopIn5.$F.notEmpty(b.channelId)?"m_ch_"+b.channelId:"";j={device:PopIn5.$F.isMobileDevice()?"mobile":"pc",url:a.target,common_category:i,category:g.category,domain:location.host,media:PopIn5.Discovery.Global.media,api_host:d,abtest:k,extra:c,popin_user_id:PopIn5.$.UserId.getUid()};if(g.rid){j.rid=rid}}if(PopIn5.$F.notEmpty(h.logger)&&typeof h.logger.getTrackValues!=="undefined"){j.td_client_id=h.logger.getTrackValues().td_client_id}return j},discoverySelector:function(c,b){var a=this.getLogger(c);var e=this.getDiscoveryCommonData({logger:a,context:c,config:b});var d={r_url:"",type:9};d=PopIn5.$F.join(e,d);this.uniqueTreasureLog(["type="+d.device+"_selector","url="+d.url],a,d)},discoveryPreviewData:function(e){var b=this.getLogger(e.context);var d=this.getDiscoveryCommonData({logger:b,context:e.context,config:e._config});var c={r_url:"",type:0};c=PopIn5.$F.join(d,c);this.uniqueTreasureLog(["type="+c.device+"_pv","url="+c.url],b,c);var a=PopIn5.$F.join({url:e.context.target},c);this.newSpecialLogForType0(["type="+c.device+"_pv","url="+c.url],b,a)},discoveryInviewLog:function(g){var m=this.getLogger(g.context);var l=this.getDiscoveryCommonData({logger:m,context:g.context,config:g._config});var k={r_url:"",type:3};k=PopIn5.$F.join(l,k);this.writeRecord(m,"discoverylogs",k);var j=g.data;var n=g._config.infiniteSize;var d=g._config.pages;var a=0;for(var f=0,c=n*d;f<c&&a<3;f++){var h=j[f];if(h.type.indexOf("ad")<0){var e={r_url:h.url,extra:PopIn5.$F.notEmpty(h.channelId)?"m_ch_"+h.channelId:"",abtest:h.abtest,type:1,recommend_type:h.type};if(PopIn5.$F.notEmpty(h.RecallRefer)){e.recommend_type=h.RecallRefer}e=PopIn5.$F.join(l,e);this.writeRecord(m,"discoverylogs",e);var b=PopIn5.$F.join({url:g.context.target},e);this.newSpecialLog(b,m,h,"imp");a++}}},discoveryClickLog:function(e){var b=this.getLogger(e.context);var d=this.getDiscoveryCommonData({logger:b,context:e.context,config:e._config});var c={r_url:e.item.url,extra:PopIn5.$F.notEmpty(e.item.channelId)?"m_ch_"+e.item.channelId:"",abtest:e.item.abtest,type:2,recommend_position:e.item.renderPosition};c=PopIn5.$F.join(d,c);this.writeRecord(b,"discoverylogs",c);var a=PopIn5.$F.join({url:e.context.target},c);this.newSpecialLog(a,b,e.item,"click")},discoveryAdsImpressionLog:function(d){var a=this.getLogger(d.context);var c=this.getDiscoveryCommonData({logger:a,context:d.context,config:d._config});var b={r_url:"",type:4};b=PopIn5.$F.join(c,b);this.writeRecord(a,"discoverylogs",b)},discoveryMediaDnaLog:function(a,c){var k=this.getLogger(a);var b=PopIn5.$F.notEmpty(a.configs)&&PopIn5.$F.notEmpty(a.configs.discovery)?a.configs.discovery:{};var h=this.getDiscoveryCommonData({logger:k,context:a,config:b});var d={time:Date.now(),campaign_id:c.campaign};d=PopIn5.$F.join(h,d);try{var i=k.getTrackValues();var g={};for(var j in i){g[j]=i[j]}d=PopIn5.$F.join(g,d)}catch(f){}this.writeRecord(k,"mediadna_clicks",d)},discoveryConcatnationPVLog:function(d){if(typeof window._popIn_concatenation_param!=="undefined"){var c=this.getLogger(d);var a=window._popIn_concatenation_param;var e={user_id:a.user_id,useragent_popin:a.useragent,timestamp:Date.now()};var b=this.isLogExsists(this.history,"concatnation_pv");if(!b){this.history.push("concatnation_pv");this.writeRecord(c,"pageview_concatenation",e)}}},discoveryVideoMediaLog:function(a,c){var k=this.getLogger(a);var b=PopIn5.$F.notEmpty(a.configs)&&PopIn5.$F.notEmpty(a.configs.discovery)?a.configs.discovery:{};var h=this.getDiscoveryCommonData({logger:k,context:a,config:b});var d={time:Date.now(),campaign_id:c.campaign};d=PopIn5.$F.join(h,d);try{var i=k.getTrackValues();var g={};for(var j in i){g[j]=i[j]}d=PopIn5.$F.join(g,d)}catch(f){}this.writeRecord(k,"mediadna_clicks",d)},uniqueTreasureLog:function(d,b,c){var a=this.isLogExsists(this.history,d);if(!a){this.history.push(d.join(""));this.writeRecord(b,"discoverylogs",c)}},writeRecord:function(b,a,c){if(PopIn5.$F.notEmpty(b.context)){if(PopIn5.$F.notEmpty(b.context.discoveryData)){c.date=b.context.discoveryData.time}}PopIn5.$.Treasure.writeRecord(b._logger,a,c)},updateBrowserInfo:function(e){var d=["td_browser","td_browser_version","td_os","td_os_version"];for(var c=0,f=d.length;c<f;c++){var b=d[c];var a=b.replace(/td_/,"");if(PopIn5.$F.notEmpty(e[b])&&PopIn5.$F.notEmpty(this.uainfo[a])){e[b]=this.uainfo[a]}}return e},writeSpecialLog:function(d,b){d.popin_user_id=PopIn5.$.UserId.getUid();var a=JSON.stringify(d);var c=btoa(unescape(encodeURIComponent(a)));PopIn5.$.Log.log(b+c)},newSpecialLog:function(b,j,k,f){function g(m){var n=m.split(".");var e=[];for(var l=n.pop();n.length>0;l=n.pop()){if(l=="www"){break}e.push(l);if(l.length>3&&e.length>0){break}}return e.reverse().join(".")}try{var h=j.getTrackValues();var d={};for(var i in h){d[i]=h[i]}d=this.updateBrowserInfo(d);d.api_host=location.host;d.type=f;d.key="key"+PopIn5.Loader.timeStart;d.url=b.url;d.now=Date.now();d.dish_common_category=b.common_category;d.dish_domain=g(location.host);d.dish_td_title="";d.dish_pubdate="";d.dish_category="";d.dish_td_url=b.url;d.dish_media="";var a=k.originalUrl;d.fruit_common_category="";d.fruit_domain=g(PopIn5.$F.parseUri(a).host);d.fruit_td_title=k.title;d.fruit_pubdate=k.pubdate;d.fruit_category=k.category;d.fruit_td_url=a;d.fruit_media=k.media;d.fruit_image=k.image;d.fruit_recommend_position=k.renderPosition;if(PopIn5.$F.notEmpty(k.RecallRefer)){d.fruit_recommend_type=k.RecallRefer}d.logid=j.context.discoveryData.logid;this.writeSpecialLog(d,"//inrecsys.popin.cc/PopinService/Logs/discovery?data=")}catch(c){}},newSpecialLogForType0:function(h,c,g){var b=this.isLogExsists(this.specialLogHistory,h);if(!b){this.specialLogHistory.push(h.join(""));try{var f=c.getTrackValues();var a={};for(var d in f){a[d]=f[d]}a=this.updateBrowserInfo(a);a.now=Date.now();a.key="key"+PopIn5.Loader.timeStart;a.domain=location.host;a.client_id=f.td_client_id;a.url=g.url||"";a.logid=c.context.discoveryData.logid;this.writeSpecialLog(a,"//inrecsys.popin.cc/PopinService/Logs/other?data=")}catch(i){}}},newSpecialLogForAd:function(j,c,b){try{var f={};f.now=Date.now();f.key="key"+PopIn5.Loader.timeStart;for(var g in c){f[g]=c[g]}var h=j.getTrackValues();for(var i in h){f[i]=h[i]}f=this.updateBrowserInfo(f);f.client_id=h.td_client_id;var a=PopIn5.$F.parseUrl(location.href);f.token=a.qString.token;var k=j.context.discoveryData.ad;if(k&&k.length){f.ad_total=k.length;f.ad_index=k.indexOf(b)}f.ad_position=b.renderIndex;f.ad_request_origin="web";b.abtest&&(f.abtest=b.abtest);f.logid=j.context.discoveryData.logid;if(b.c1){f.c1=b.c1}if(b.c2){f.c2=b.c2}this.writeSpecialLog(f,"//inrecsys.popin.cc/PopinService/Logs/ad?data=")}catch(d){}}});(function(){var h="";var g="";var l="__pi_u_id__";var m=/^([\d\w]{32})|(\d{13})-\d+$/;var d="https://api.popin.cc";var s=d+"/iframe/piuid.html?ac=piuid&t=15009898";var k=null;var i=false;PopIn5.StaticClass("$","UserId",{init:function(){try{if(typeof window.PopIn6==="object"||(window.PopIn&&window.PopIn.VERSION===8)){return}if("function"===typeof window.postMessage){r()}g=e(l)||"";var v=e("_ss_pp_id")||"";if(m.test(g)){h=g.split("-")[0];return}else{b(l)}if(/^([\da-f]{32})|(\d{13})$/.test(v)){h=v;g=v+"-"+a();t(l,g);i=true;return}else{b("_ss_pp_id")}g=n();h=g.split("-")[0];t(l,g);i=true;PopIn5.$.Global.event.addEventListener("result-loaded",function(w){try{var x=w.cookie;if(x&&x.uid&&i){h=x.uid;g=h+"-"+a();t(l,g)}}catch(y){}})}catch(u){q(u)}},getUid:function(){return h}});function t(u,w){try{localStorage.setItem(u,w);return true}catch(v){return false}}function e(u){try{return localStorage.getItem(u)}catch(v){return""}}function b(u){try{return localStorage.removeItem(u)}catch(v){return""}}function r(){if(!PopIn5.$.Config){setTimeout(r,1);return}if(/.+_sdk$/.test(PopIn5.$.Config.pid)){return}k=c(s);function u(v){try{if(k.window!==v.source){return}var w=JSON.parse(v.data);if(w.action==="get"){p(w.payload)}else{if(w.action==="done"){window.removeEventListener("message",u);k.parentNode&&k.parentNode.removeChild(k);k=null}}}catch(x){q(x)}}window.addEventListener("message",u,false)}function f(u){if(!m.test(u)){return}k.window.postMessage(JSON.stringify({action:"setId",payload:u}),d)}function p(w){if("string"!==typeof w||!m.test(w)){f(g);return}if(i){h=w.split("-")[0];t(l,w);i=false;return}if(w===g){return}var v=w.split("-");var u=g.split("-");if(u[1]>=v[1]){h=v[0];t(l,w);if(v[0]!==u[0]&&e(l)===w){j({previous_id:u[0],previous_create_time:u[1],current_id:v[0],current_create_time:v[1],host:top.location.host})}return}f(g)}function o(u){var v=parseInt(Math.floor(Math.random()*Math.pow(16,u))).toString(16);return(""+Math.pow(10,u)+v).slice(-u)}function n(){var u=[o(8),o(4),o(4),o(4),o(12)].join("");return u+"-"+a()}function a(){var u=new Date;u.setMinutes(u.getMinutes()+u.getTimezoneOffset());return u.getTime()}function j(u){if(window.Treasure2){(new window.Treasure2({writeKey:"8378/25839e06ce4cc1cab55c1c1f1e49d336d6d1d48f",database:"popin_user_id"})).addRecord("uid_change_log",u)}else{setTimeout(function(){j(u)},1000)}}function q(u){if(window.Treasure2){(new window.Treasure2({writeKey:"8378/25839e06ce4cc1cab55c1c1f1e49d336d6d1d48f",database:"fe_monitor"})).addRecord("err_log",{msg:u.message||"",stack:u.stack||"",name:u.name||"",ua:navigator.userAgent})}else{setTimeout(function(){q(u)},1000)}}function c(u,w){u=u||"about:self";w=w||{};var x=(typeof w.pnode!=="undefined"&&typeof w.pnode.nodeValue!=="undefined")?w.pnode:document.body;var v=PopIn5.$F.ce(x,"iframe");v.src=u;v.setAttribute("scrolling","no");v.setAttribute("frameBorder","0");v.setAttribute("allowTransparency","true");(function(z){z.display="block";z.width="0px";z.height="0px";z.margin="0px";z.padding="0px";z.overflow="none"})(v.style);var y={element:v,document:v.contentDocument||v.contentWindow.document,window:(v.contentWindow)?v.contentWindow:(v.contentDocument.document)?v.contentDocument.document:v.contentDocument,write:function(z){y.document.open();y.document.write(z);y.document.close()}};return y}})();new PopIn5.Class("Discovery","Video2",{init:function(c,d,b,e){this.config=c;this.context=d;this.container=b;this.data=e;var a=this;this.render()},render:function(){var a=this;this.renderHeader();this.renderCanvas();this.renderFooter();this.addEvents();this.calendar=new PopIn5.Discovery.Video2Calendar(this);this.share=new PopIn5.Discovery.Video2Share(this)},renderHeader:function(){var c=PopIn5.$F.ce(this.container,"div");PopIn5.$F.addClass(c,"_popIn_video_title");PopIn5.$F.css(c,{"white-space":"nowrap",padding:"5px 2px","font-size":"14px","background-color":"#ffffff"});var a=PopIn5.$F.ce(c,"span","PR");PopIn5.$F.addClass(a,"_popIn_video_pr");PopIn5.$F.css(a,{color:"#ffffff","font-size":"12px","border-radius":"3px",padding:"3px 4px","z-index":98,"background-color":"rgb(239, 196, 57)"});var b=PopIn5.$F.ce(c,"span",this.data.title);PopIn5.$F.addClass(b,"_popIn_video_title_inner");PopIn5.$F.css(b,{"text-align":"left","font-size":"14px","font-weight":"bolder",color:"rgb(0, 0, 0)","margin-left":"7px","line-height":"18px","text-overflow":"ellipsis",overflow:"hidden","white-space":"nowrap",width:"80%",display:"inline-block","vertical-align":"middle"})},renderCanvas:function(){var e=PopIn5.$F.ce(this.container,"div");PopIn5.$F.css(e,{position:"relative",padding:"0px"});if(PopIn5.$F.notEmpty(this.data.background)){var b=function(){var f=PopIn5.$F.getWindowWidth()>PopIn5.$F.getWindowHeight()?"30%":"10%";PopIn5.$F.css(e,{padding:"0px "+f+" 0px "+f})};window.addEventListener("orientationchange",b,false);window.addEventListener("resize",b,false);b();var a=PopIn5.$F.ce(e,"div");PopIn5.$F.css(a,{position:"absolute",left:"0px",right:"0px",top:"0px",bottom:"0px",background:"url("+this.data.background+") no-repeat top center ","background-size":"cover","-webkit-filter":"brightness(150%) blur(5px)"})}this.canvasContainer=e;var c=PopIn5.$F.ce(e,"div");PopIn5.$F.addClass(c,"_popIn_video_box");PopIn5.$F.css(c,{position:"relative"});this.videoCanvas=new PopIn5.Discovery.Video2Canvas(this.config,this.context,c,this.data);this.videoCanvasClick=new PopIn5.Discovery.Video2CanvasClick(this.videoCanvas);var d=PopIn5.$F.notEmpty(this.data.videoObj.type)&&this.data.videoObj.type==="vast"?true:false;this.videoCanvasEnd=new PopIn5.Discovery.Video2CanvasEnd(this.videoCanvas,d)},renderFooter:function(){var a=this;var g=PopIn5.$F.ce(this.container,"div");var b=PopIn5.$F.ce(g,"div","ads by popIn");PopIn5.$F.addClass(b,"_popIn_video_powered");(function(h){h.textAlign="right";h.marginTop="3px";h.fontSize="12px";h.padding="0px 5px 0px 0px";h.fontFamily="sans-serif;";h.color="#ccc"})(b.style);var c=PopIn5.$F.ce(g,"div",this.data.description);PopIn5.$F.addClass(c,"_popIn_video_desc");PopIn5.$F.css(c,{"text-align":"left","font-size":"14px","font-weight":"normal",color:"#000000","line-height":"18px",padding:"7px","white-space":"normal"});var f=PopIn5.$F.ce(g,"div");PopIn5.$F.addClass(f,"_popIn_video_counter");PopIn5.$F.css(f,{"float":"left",margin:"4px 0px 5px 5px","text-align":"left","font-size":"12px","font-family":"sans-serif","font-weight":"bolder",color:"rgb(103, 107, 118)"});this.counterDiv=f;this.updateCounter();var d=null;var e=PopIn5.$F.notEmpty(this.data.videoObj.type)&&this.data.videoObj.type==="vast"?true:false;if(!e){d=PopIn5.$F.ce(g,"a",PopIn5.$F.notEmpty(this.data.detailMessage)?this.data.detailMessage:PopIn5.$.Language.getMessage("video_button_detail"));d.href=this.data.linkUrl;d.target="_blank";PopIn5.$F.addClass(d,"_popIn_video_moreButton");PopIn5.$F.css(d,{"float":"right",margin:"0px 5px 5px 0px","text-decoration":"none",color:"rgb(51, 51, 51)",border:"1px solid rgb(204, 204, 204)","font-size":"12px","font-weight":"bold","font-family":"sans-serif",padding:"2px 3px","text-align":"center","border-radius":"5px",background:"-webkit-gradient(linear, 0% 0%, 0% 100%, from(rgb(255, 255, 255)), to(rgb(235, 235, 235))) rgb(238, 238, 238)"});PopIn5.$F.bind(d,"click",function(){PopIn5.Discovery.Video2Log.link(a)})}PopIn5.$F.css(PopIn5.$F.ce(g,"div"),{clear:"both"})},increaseCounter:function(){this.counterCommand("imp")},updateCounter:function(){this.counterCommand("info")},counterCommand:function(c){var b=PopIn5.$.Global.protocol+"//discoveryplus.popin.cc/popin_discovery/video?op="+c+"&video="+this.data.nid+"&t="+new Date().getTime();var a=this;PopIn5.$F.ajax(b,function(d){var e=PopIn5.$F.notEmpty(d)&&PopIn5.$F.notEmpty(d.imp)?d.imp:"0";a.setCounterNumber(e)})},setCounterNumber:function(a){var b=function(d){var c=String(d).replace(/,/g,"");while(c!=(c=c.replace(/^(-?\d+)(\d{3})/,"$1,$2"))){}return c};this.counterDiv.textContent=PopIn5.$.Language.getMessage("video_counter_before")+b(a)+PopIn5.$.Language.getMessage("video_counter_after")},addEvents:function(){var a=this;this.videoCanvas.addEventListener("inview",function(){PopIn5.$.Log.log("https://rlog.popin.cc/s.gif?url="+location.host+"&uid=&type=paid_video_INVIEW&t="+Date.now())});this.videoCanvas.addEventListener("twoSeconds",function(){a.increaseCounter();a.saveHistory();PopIn5.Discovery.Video2Log.imp(a);PopIn5.Discovery.Video2Log.twoSeconds(a)});this.videoCanvas.addEventListener("threeSeconds",function(){PopIn5.Discovery.Video2Log.threeSeconds(a)});this.videoCanvas.addEventListener("playTimeSeconds",function(){PopIn5.Discovery.Video2Log.playTimeSeconds(a)});this.videoCanvas.addEventListener("percent",function(c){var b=[25,50,75,95,100];for(var d=0;d<b.length;d++){if(b[d]==c){PopIn5.Discovery.Video2Log.percent(a,""+c)}}});this.videoCanvas.addEventListener("click",function(){PopIn5.Discovery.Video2Log.full(this)})},saveHistory:function(){var a=PopIn5.$F.ssGet("_video");if(PopIn5.$F.notEmpty(a)){a+=("."+this.data.nid)}else{a=this.data.nid}PopIn5.$F.ssSet("_video",a)}});new PopIn5.Class("Discovery","Video2Calendar",{init:function(e){this.video=e;if(PopIn5.$F.isEmpty(e.data.calendar)){return}var c=e.container.querySelector("._popIn_video_moreButton");c.style.display="none";var b=document.createElement("div");b.appendChild(document.createTextNode(PopIn5.$.Language.getMessage("video_button_calendar")));c.parentNode.insertBefore(b,c);PopIn5.$F.addClass(b,"_popIn_video_moreButton");PopIn5.$F.css(b,{"float":"right","background-color":"#fff",border:"1px solid","border-color":"#e5e6e9 #dfe0e4 #d0d1d5",padding:"5px 5px 5px 30px",margin:"0px 10px 5px 0px","-webkit-border-radius":"3px","border-radius":"3px",cursor:"pointer","font-size":"12px","-webkit-font-smoothing":"antialiased!important","text-shadow":"1px 1px 1px rgba(0,0,0,0.004)","-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)",background:"url(https://addevent.com/gfx/icon-calendar-t5.png) no-repeat 7px"});var a=this;PopIn5.$F.bind(b,"click",function(){a.clickCalendar()});var f=this.video.videoCanvasEnd;var d=f.videoCanvasEnded;f.videoCanvasEnded=function(){d.apply(this,arguments);a.addEndButton()}},addEndButton:function(){var b=this.video.container.querySelector("._popIn_video_end_table");var e=b.querySelector("._popIn_video_end_detailRow");e.style.display="none";var c=PopIn5.$F.ce(b,"div");PopIn5.$F.addClass(c,"_popIn_video_end_detailRow");PopIn5.$F.css(c,{display:"table-row",height:"50%"});var d=PopIn5.$F.ce(c,"div",PopIn5.$.Language.getMessage("video_button_calendar"));PopIn5.$F.addClass(d,"_popIn_video_end_detailCell _popIn_video_end_detailLink");PopIn5.$F.css(d,{display:"table-cell","text-align":"left","vertical-align":"middle",color:"white",background:"url(https://i.popincdn.com/videos/lp.png) no-repeat left","padding-left":"80px"});var a=this;PopIn5.$F.bind(c,"click",function(){a.clickCalendar()})},clickCalendar:function(){var d=this.video.data.calendar;var e=d.start.split(" ");var a=d.end.split(" ");if(e.length>0){d.start=e[0]}if(e.length>1){d.starttime=e[1]}if(e.length>2){d.startext=e[2]}if(a.length>0){d.end=a[0]}if(a.length>1){d.endtime=a[1]}if(a.length>2){d.endext=a[2]}if(PopIn5.$F.isiPhone){d.service="iCalendar"}else{d.service="google"}var b=["https://addevent.com/dir/","?client=aDoyjOXdmzdeHwNStmZG11131"];for(var c in d){b.push("&"+c+"="+encodeURIComponent(d[c]))}window.open(b.join(""));PopIn5.Discovery.Video2Log.calendar(this.video)}});new PopIn5.Class("Discovery","Video2Canvas",{init:function(c,d,b,g){this.config=c;this.context=d;this.container=b;this.data=g;this.shown=false;var a=this;PopIn5.$F.makeListener(this);if(typeof video_jsv=="undefined"){window.jsv_config={bufferSec:5,chunkSize:1000000,doNotPatchCreateElement:true};var f=document.createElement("script");f.type="text/javascript";f.charset="utf-8";f.async=true;f.onload=function(){a.load()};f.src=PopIn5.$.Global.protocol+"//api.popin.cc/popin_video_ads-min.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(f,e)}else{this.load()}},load:function(){var a=this;var c=new video_jsv();this.container.appendChild(c);c.setAttribute("preload","auto");c.setAttribute("data-audio","");c.style.width="100%";c.style.fontSize="0px";c.setAttribute("src",this.data.url);c.addEventListener("canplay",function(){a.autoScroll()});var e=PopIn5.$F.ce(this.container,"div");PopIn5.$F.css(e,{position:"absolute",display:"none",bottom:"0px",right:"0px",width:"60px",height:"60px","---background":"url(https://i.popincdn.com/videos/animat-audio-color.gif)","background-size":"60px 60px"});var f=PopIn5.$F.ce(this.container,"div");PopIn5.$F.css(f,{position:"absolute",display:"none",bottom:"-4px",left:"0px",right:"0px",width:"100%",height:"4px","background-color":"white"});var g=PopIn5.$F.ce(f,"div");PopIn5.$F.css(g,{position:"absolute",top:"0px",left:"0px",width:"0%",height:"4px","background-color":"#295ED4"});this.player=c;this.status=0;PopIn5.$F.bind(c,"ended",function(){a.fireEvent("percent",[100]);e.style.display="none";f.style.display="none";a.fireEvent("ended",[]);a.status=2});PopIn5.$F.bind(c,"click",function(){a.fireEvent("click",[])});var b=0;var d=0;PopIn5.$F.bind(c,"timeupdate",function(){e.style.display="block";f.style.display="block";var i=c.currentTime;a.currentTime=i;if(b<1&&i>=1){a.fireEvent("oneSecond",[])}if(b<2&&i>=2){a.fireEvent("twoSeconds",[])}if(b<3&&i>=3){a.fireEvent("threeSeconds",[])}if(PopIn5.$F.notEmpty(a.data.play_time_seconds)){var j=parseInt(a.data.play_time_seconds);if(b<j&&i>=j){a.fireEvent("playTimeSeconds",[])}}var h=Math.round(c.currentTime/c.duration*100);g.style.width=h+"%";h=Math.floor(h/5)*5;if(h>d&&h<100){a.fireEvent("percent",[h])}b=i;d=h})},resume:function(){if(this.status<2){this.status=1;this.player.play()}},resumeAt:function(a){this.status=1;this.player.currentTime=a;this.player.play()},replay:function(){this.player.currentTime=0;this.status=1;this.player.play()},stop:function(){this.status=0;this.player.pause()},autoScroll:function(){var a=this;this.scrollInterval=setInterval(function(){a.checkScroll()},1000);this.checkScroll()},checkScroll:function(){var g=PopIn5.$F.getWindowHeight();var f=PopIn5.$F.pageScrollTop();var c=PopIn5.$F.position(this.player);var e=c.top;var b=PopIn5.$F.size(this.player).height;var d=e+b/2;var a=(d>f&&d<f+g);if(!this.shown&&a){this.shown=true;this.fireEvent("inview",[])}if(this.status===0&&a){this.resume()}else{if(this.status==1&&!a){this.stop()}}}});new PopIn5.Class("Discovery","Video2CanvasClick",{init:function(b){var a=this;this.videoCanvas=b;this.videoCanvas.addEventListener("click",function(){a.handleCanvasClick()})},handleCanvasClick:function(){var h=this;var f=PopIn5.$F.ce(document.body,"div");PopIn5.$F.css(f,{position:"fixed",top:"0px",left:"0px","background-color":"black",width:"100%",height:"100%","z-index":9999});var e=PopIn5.$F.ce(f,"div");PopIn5.$F.css(e,{position:"absolute",bottom:"20px",right:"20px",width:"64px",height:"64px",background:"url(//i.popincdn.com/videos/Close-icon.png) no-repeat center","background-size":"cover","z-index":10000});var c=PopIn5.$F.ce(f,"video");PopIn5.$F.css(c,{position:"absolute",width:"100%",height:"100%"});var b=this.videoCanvas.data.video;var a=PopIn5.$F.ce(c,"source");a.src=b;a.type="video/mp4";var d=this.videoCanvas.currentTime;c.setAttribute("autoplay","autoplay");c.setAttribute("controls","controls");c.load();c.play();var g=false;var i=function(){PopIn5.$F.remove(f)};f.addEventListener("click",function(j){i()});c.addEventListener("webkitendfullscreen",function(){i()});c.addEventListener("ended",function(){i()})}});new PopIn5.Class("Discovery","Video2CanvasEnd",{init:function(b,c){var a=this;this.videoCanvas=b;this.isVast=c;this.videoCanvas.addEventListener("ended",function(){a.videoCanvasEnded()})},videoCanvasEnded:function(){var g=this;var d=this.videoCanvas.container;var b=PopIn5.$F.ce(d,"div");PopIn5.$F.addClass(b,"_popIn_video_end_outerContainer");PopIn5.$F.css(b,{"background-color":"black",position:"absolute",top:"0px",left:"0px",right:"0px",height:"100%","text-align":"center",color:"white","z-index":99,transition:"opacity 0.5s ease-in",opacity:0});var i=PopIn5.$F.ce(d,"div");PopIn5.$F.addClass(i,"_popIn_video_end_innerContainer");PopIn5.$F.css(i,{"font-size":"16px",position:"absolute",left:"0px",right:"0px",height:"110px",top:"50%","margin-top":"-55px","text-align":"center","z-index":100});var h=PopIn5.$F.ce(i,"div");PopIn5.$F.addClass(h,"_popIn_video_end_table");PopIn5.$F.css(h,{display:"table",height:"100%",margin:"0px auto"});var a=PopIn5.$F.ce(h,"div");PopIn5.$F.addClass(a,"_popIn_video_end_replayRow");PopIn5.$F.css(a,{display:"table-row",height:"50%"});var c=PopIn5.$F.ce(a,"div",PopIn5.$.Language.getMessage("video_end_replay"));PopIn5.$F.addClass(c,"_popIn_video_end_replayCell");PopIn5.$F.css(c,{display:"table-cell","text-align":"left","vertical-align":"middle","padding-left":"80px",color:"white",background:"url(https://i.popincdn.com/videos/play.png) no-repeat left"});PopIn5.$F.bind(a,"click",function(){PopIn5.$F.remove(b);PopIn5.$F.remove(i);g.replayClick();return false});if(!this.isVast){var f=PopIn5.$F.ce(h,"div");PopIn5.$F.addClass(f,"_popIn_video_end_detailRow");PopIn5.$F.css(f,{display:"table-row",height:"50%"});var e=PopIn5.$F.ce(f,"div",PopIn5.$F.notEmpty(this.videoCanvas.data.detailMessage)?this.videoCanvas.data.detailMessage:PopIn5.$.Language.getMessage("video_end_detail"));PopIn5.$F.addClass(e,"_popIn_video_end_detailCell _popIn_video_end_detailLink");PopIn5.$F.css(e,{display:"table-cell","text-align":"left","vertical-align":"middle",color:"white",background:"url(https://i.popincdn.com/videos/lp.png) no-repeat left","padding-left":"80px"});PopIn5.$F.bind(f,"click",function(){g.detailClick();return false})}setTimeout(function(){PopIn5.$F.cssSet(b,"opacity","0.4")},1)},replayClick:function(){this.videoCanvas.replay()},detailClick:function(){window.open(this.videoCanvas.data.linkUrl);PopIn5.Discovery.Video2Log.link(this.videoCanvas)}});PopIn5.StaticClass("Discovery","Video2Log",{init:function(){},percent:function(b,a){this.uniqueLog(a,b)},imp:function(a){this.uniqueLog("imp",a)},full:function(a){this.uniqueLog("full",a)},link:function(a){this.uniqueLog("link",a)},calendar:function(a){this.uniqueLog("link",a);this.uniqueLog("calendar",a)},share:function(b,a){this.uniqueLog("share-"+a,b)},twoSeconds:function(a){this.uniqueLog("twoSeconds",a)},threeSeconds:function(a){this.uniqueLog("threeSeconds",a)},playTimeSeconds:function(a){this.uniqueLog("playTimeSeconds",a)},uniqueLog:function(c,d){var e=d.data;var a=d.config;var b=d.context;if(PopIn5.$F.isEmpty(d._log)){d._log={}}if(PopIn5.$F.isEmpty(d._log[c])){d._log[c]=0}if(d._log[c]>0){return}d._log[c]++;if(PopIn5.$F.notEmpty(e.debugMode)){return}PopIn5.Discovery.Log.videoLog(e,c,a,b)}});new PopIn5.Class("Discovery","Video2Share",{init:function(a){this.video=a;if(PopIn5.$F.isEmpty(a.data.share)){return}var g=encodeURIComponent("http://share.popin.cc/getVideoDemo?popinvideotest="+a.data.nid);var n=encodeURIComponent(a.data.title);var i="32px";var d=PopIn5.$F.ce(a.canvasContainer,"div");var j=[{type:"facebook",url:"https://m.facebook.com/sharer.php?u="+g+"&t="+n,background:"https://i.popincdn.com/videos/facebook.png"},{type:"twitter",url:"https://twitter.com/share?url="+g+"&text="+n,background:"https://i.popincdn.com/videos/twitter.png"},{type:"line",url:"https://line.naver.jp/R/msg/text/?"+n+g,background:"https://i.popincdn.com/videos/line.png"}];PopIn5.$F.css(d,{opacity:0,position:"absolute",left:"10%",right:"10%",bottom:"0px",width:"80%",transition:"opacity 0.2s","z-index":9999});a.videoCanvas.addEventListener("oneSecond",function(){d.style.opacity=1});var l=this;for(var e=0;e<j.length;e++){var f=j[e];var m=PopIn5.$F.ce(d,"a");m.href=f.url;m.target="_blank";PopIn5.$F.bind(m,"click",function(k,o){l.beforeClick(o)},f);PopIn5.$F.css(m,{width:"33.3%",display:"inline-block",height:i,"text-align":"center","margin-bottom":"15px"});var b=PopIn5.$F.ce(m,"div");PopIn5.$F.css(b,{display:"inline-block",width:i,height:i,background:"url("+f.background+") no-repeat center","background-size":"contain"})}var h=this.video.videoCanvasEnd;var c=h.videoCanvasEnded;h.videoCanvasEnded=function(){c.apply(this,arguments)}},beforeClick:function(a){PopIn5.Discovery.Video2Log.share(this.video,a.type)},addShareButton:function(){var e=this.video.container.querySelector("._popIn_video_end_table");var b=PopIn5.$F.ce(e,"div");PopIn5.$F.addClass(b,"_popIn_video_end_detailRow");PopIn5.$F.css(b,{display:"table-row"});var d=PopIn5.$F.ce(b,"div",PopIn5.$.Language.getMessage("video_button_share"));PopIn5.$F.addClass(d,"_popIn_video_end_detailCell _popIn_video_end_detailLink");PopIn5.$F.css(d,{display:"table-cell","text-align":"left","vertical-align":"middle",color:"white",background:"url(https://i.popincdn.com/videos/lp.png) no-repeat left","padding-left":"80px"});this.video.container.querySelector("._popIn_video_end_innerContainer").style.height="150px";var f=this.video.container.querySelectorAll("._popIn_video_end_table > div");for(var c=0;c<f.length;c++){f[c].style.height=(100/f.length)+"%"}var a=this;PopIn5.$F.bind(b,"click",function(){})}});PopIn5.StaticClass("Discovery","VideoUtils",{getVideo:function(f){var h=[];if(PopIn5.$F.notEmpty(f.configs.discovery.adVideo)&&PopIn5.$F.notEmpty(f.discoveryData.ad_video)){h=h.concat(f.discoveryData.ad_video)}if(PopIn5.$F.notEmpty(f.configs.discovery.adReservedVideo)&&PopIn5.$F.notEmpty(f.discoveryData.ad_reserved_video)){h=h.concat(f.discoveryData.ad_reserved_video)}if(PopIn5.$F.isEmpty(h)){PopIn5.$.Global.event.fireEvent("no-video",[]);return}if(!PopIn5.$F.isSupportStorage()){return}var g=PopIn5.$F.ssGet("_video");g=PopIn5.$F.notEmpty(g)?g.split("."):[];for(var e=0;e<h.length;e++){var d=h[e];var c=0;for(var a=0;a<g.length;a++){if(g[a]==d.nid){c++}}if(c>1){continue}var b=this.getVideoFromData2(d,f);if(PopIn5.$F.notEmpty(b)){return b}}PopIn5.$.Log.log("http://rlog.popin.cc/s.gif?url="+location.host+"&uid=&type=paid_video_NG3&t="+Date.now())},getVideoFromData2:function(b,a){if(PopIn5.$F.notEmpty(b.used)){return false}b.used=true;var e=PopIn5.$F.notEmpty(b.video.background)||(PopIn5.$F.notEmpty(b.video.type)&&b.video.type==="vertical")?true:false;var d=PopIn5.$F.parseUri(a.configs.discovery.apiUrl).host;var c=d.replace("discoveryplus.","jp.");return{calendar:b.calendar||false,share:b.share,detailMessage:b.video.btn||false,background:b.video.background||false,type:b.video.type||false,debugMode:PopIn5.$F.notEmpty(b.debugMode)?b.debugMode:false,title:b.title,nid:b.nid,description:PopIn5.$F.notEmpty(b.video.description)?b.video.description:"",play_time_seconds:PopIn5.$F.notEmpty(b.video.play_time_seconds)?b.video.play_time_seconds:"",campaign:b.campaign,impUrl:b.url+(b.url.indexOf("?")>0?"&":"?")+(e?"type=vertical_imp":"type=imp")+"&api_host="+c,endUrl:b.url+(b.url.indexOf("?")>0?"&":"?")+"type=end",linkUrl:b.origin_url,trackingPixel:b.tracking_pixel||false,url:PopIn5.$.Global.protocol+"//i.popincdn.com/jsv/"+b.nid+"/video.jsv",video:PopIn5.$.Global.protocol+"//i.popincdn.com/jsv/"+b.nid+"/video.mp4",videoObj:b}}});PopIn5.Class("Read","Config",{init:function(a){this.setDefaults();PopIn5.$.Config.overrideAll(this,a);this.afterConfig()},setDefaults:function(){this.nid="";this.media=PopIn5.$F.getParam("read_analysis_id","");this.urlReplace=PopIn5.$.Config.urlReplace;this.mainNode="";this.mainNodeElement="";this.useMainContentFinder=false;this.stopNode=false;this.segmentData={};this.readArticle=PopIn5.$.Config.readArticle;this.sessionParam="__read";this.useSessions=(typeof window.sessionStorage!=="undefined")?true:false;this.useUser=false;this.textSpeed=1000/60;this.imageSpeed=300*300/1;this.clickLog=false;this.engagement={format:PopIn5.$F.getParam("engagement_format",""),bid:PopIn5.$F.getParam("engagement_bid",""),pid:PopIn5.$F.getParam("engagement_pid","")};this.treasuredataLog=false},afterConfig:function(){this.target=PopIn5.$F.replaceAll(window.location.href,this.urlReplace);var b={category:PopIn5.$F.getParam("read_categoryName",PopIn5.$F.getParam("read_fragmentinfo_categoryName","")),customField:PopIn5.$F.getParam("read_customField",PopIn5.$F.getParam("read_fragmentinfo_customField","")),abtest:PopIn5.$F.getParam("read_abtest",PopIn5.$F.getParam("read_fragmentinfo_customField",""))};for(var a in b){if(b.hasOwnProperty(a)&&PopIn5.$F.notEmpty(b[a])){this.segmentData[a]=b[a]}}}});new PopIn5.ClassLoad("Read","Debug",{init:function(){var a=this;this.colors={text:"#60C560",img:"#5BC0DE"};this.url=PopIn5.$F.parseUrl(window.location.href);if(this.debug||PopIn5.$F.notEmpty(this.url.qString.popinread)){PopIn5.$F.aspectAfter(PopIn5.Read.ReadInstance.prototype,"elapsed",function(){if(typeof this._debug=="undefined"){a.initDebug(this)}a.afterCalculate(this)})}},initDebug:function(l){var h=l.data;var b=l.context;var a=PopIn5.$F.ce(document.body,"div");PopIn5.$F.css(a,{position:"absolute",top:h.top,height:h.height,left:(h.mainPosition.left-70)<0?0:h.mainPosition.left-70,opacity:(h.mainPosition.left-70)<0?0.7:1,width:45,border:"none","box-shadow":"2px 2px 2px 2px #888888","-webkit-border-radius":"10px","-moz-border-radius":"10px","border-radius":"10px",overflow:"hidden","background-color":"white","z-index":999999});var j=PopIn5.$F.ce(document.body,"div",PopIn5.$.Language.getMessage("read_debug_container"));PopIn5.$F.css(j,{position:"absolute",top:h.top-20,left:(h.mainPosition.left-70)<0?0:h.mainPosition.left-70,"font-size":"10px",width:45,"text-align":"center","z-index":999999});var n=PopIn5.$F.ce(document.body,"div");PopIn5.$F.css(n,{position:"absolute",top:h.top,left:(h.mainPosition.left-200)<0?0:h.mainPosition.left-200,width:100,padding:"10px","background-color":"#d9534f",color:"white","font-size":"18px","font-weight":"bold","line-height":"30px","-webkit-border-radius":"10px","-moz-border-radius":"10px","border-radius":"10px","box-shadow":"2px 2px 2px #888888","z-index":999999});PopIn5.$F.ce(n,"div",PopIn5.$.Language.getMessage("read_debug_info_view"));var p=PopIn5.$F.ce(n,"div","0%");PopIn5.$F.ce(n,"div",PopIn5.$.Language.getMessage("read_debug_info_read"));var m=PopIn5.$F.ce(n,"div","0%");PopIn5.$F.ce(n,"div",PopIn5.$.Language.getMessage("read_debug_info_time"));var o=PopIn5.$F.ce(n,"div","0 "+PopIn5.$.Language.getMessage("read_debug_info_sec"));var g=[];var d="";for(var f=0;f<h.count;f++){var c=h.parts[f];var e=PopIn5.$F.ce(a,"div");PopIn5.$F.css(e,{width:"0%",height:c.end-c.start,"background-color":this.colors[c.type],"z-index":999999});if(d!=c.type){var k=PopIn5.$F.ce(a,"div",c.type=="img"?"画像":"テキスト");PopIn5.$F.css(k,{position:"absolute",width:"100%","text-align":"center","font-size":"10px","font-weight":"bold",color:"white","z-index":999999})}d=c.type;g.push(e)}l._debug={container:a,infoDiv:n,viewInfo:p,readInfo:m,readTime:o,partDivs:g}},afterCalculate:function(k){var d=k.data;var e=k._debug.partDivs;var a=0;var j=0;for(var f=0;f<d.count;f++){var c=d.parts[f];var g=e[f];var h=c.viewPercent;PopIn5.$F.cssSet(g,"width",(h*100)+"%");a+=c.viewPercent/d.count;j+=(c.viewTime>0?1:0)/d.count;PopIn5.$F.cssSet(g,"opacity",h==1?1:0.6)}var l=k._debug.infoDiv;var b=PopIn5.$F.getPageScrollTop();var m=PopIn5.$F.size(l);PopIn5.$F.cssSet(l,"top",Math.min(Math.max(d.top,b),d.top+d.height-m.height));k._debug.viewInfo.innerHTML=Math.round(j*100)+"%";k._debug.readInfo.innerHTML=Math.round(a*100)+"%";k._debug.readTime.innerHTML=Math.floor(d.totalViewTime)+" "+PopIn5.$.Language.getMessage("read_debug_info_sec")}});PopIn5.StaticClass("Read","Log",{init:function(){},showAllLog:function(e){var a=e.readInstance;var c=PopIn5.$.Global.device;var d=e.readInstance.media;var f=encodeURIComponent(a._config.target);var b=PopIn5.$.Log.logBuilder(PopIn5.$.Global.protocol+"//rlog.popin.cc/s.gif");b.add("url",f);b.add("uid","");b.add("type",c+"_viewall");b.add("nid",c);b.add("media",d);PopIn5.$.Segment.addSegmentLog(b,a._config,a.context);b.add("t",new Date().getTime());PopIn5.$.Log.log(b.build())},read70Log:function(e){if(PopIn5.$F.isEmpty(e.read.clickCategory)){return}var a=e.readInstance;var c=PopIn5.$.Global.device;var d=e.readInstance.media;var f=encodeURIComponent(a._config.target);var b=PopIn5.$.Log.logBuilder(PopIn5.$.Global.protocol+"//rlog.popin.cc/s.gif");b.add("url",f);b.add("uid","");b.add("type",c+"_read70");b.add("nid",e.read.nid);b.add("campaign",e.read.campaign);b.add("media",d);b.add("r5",e.read.clickCategory);b.add("t",new Date().getTime());PopIn5.$.Log.log(b.build())},paidLog:function(f){var a=f.readInstance;var d=PopIn5.$.Global.device;var e=f.readInstance.media;var g=encodeURIComponent(a._config.target);var b=PopIn5.$.Global.referrer;var c=PopIn5.$.Log.logBuilder(PopIn5.$.Global.protocol+"//rlog.popin.cc/s.gif");c.add("url",g);c.add("uid","");c.add("type",b);c.add("t",new Date().getTime());PopIn5.$.Log.log(c.build())},monitorGMOLog:function(b){var a=PopIn5.$.Log.logBuilder(PopIn5.$.Global.protocol+"//rlog.popin.cc/s.gif");a.add("url",location.hostname+"_"+b);a.add("uid","");a.add("type","paid_gmo");a.add("t",new Date().getTime());PopIn5.$.Log.log(a.build())}});new PopIn5.Module("Read",{initModule:function(){if(PopIn5.$F.isIE){return}var a=this;this.uid="";this.sessionData=this._config.useSessions?PopIn5.$F.ssGet(this._config.sessionParam):"";this.sessionId=this._config.useSessions?PopIn5.$F.ssGet("__read_id"):"";this.newSession=false;this.readArticle=this._config.readArticle;this.readStorage=new PopIn5.Read.Storage(this);if(this._config.useSessions&&PopIn5.$F.isEmpty(this.sessionId)){PopIn5.$F.ssSet("__read_id","s"+new Date().getTime());this.newSession=true}if(this._config.useUser||PopIn5.Discovery.Global.adEnable){PopIn5.$.User.getUser(function(d){a.uid=d})}var b=document.referrer;var c=PopIn5.$F.getParam("contents_id","");if(PopIn5.$F.notEmpty(b)&&b.indexOf("a.popin.cc")>0){this.retrieveForAd()}if(PopIn5.$F.notEmpty(c)){this.nid=c}this.createInstances();this.readTimer=new PopIn5.Read.Timer();this.readTimer.start(function(d){var f=PopIn5.$F.getPageScrollTop();var g=PopIn5.$F.getWindowHeight();for(var e=0;e<a.readInstances.length;e++){if(PopIn5.$F.notEmpty(a.readInstances[e].mainNode)){a.readInstances[e].elapsed(d,f,g)}}})},createInstances:function(){var a=this;this.readInstances=[];for(var b=0;b<PopIn5.$.Context.contexts.length;b++){this.initContext(PopIn5.$.Context.contexts[b])}PopIn5.$.Global.event.addEventListener("newContext",function(c){a.initContext(c)})},initContext:function(c){var b=new PopIn5.Read.ReadInstance(this,c);var a=new PopIn5.Read.ReadLogger(this,b);this.readInstances.push(b)},retrieveForAd:function(){var a=this;var b=PopIn5.$.Global.protocol+"//discoveryplus.popin.cc/popin_discovery/ck?name=_click";PopIn5.$F.ajax(b,function(e){if(PopIn5.$F.notEmpty(e)){var c=parseInt(e.time);var d=e._click;if(PopIn5.$F.notEmpty(d)){var g=d.split("|").pop().split(".");if(g.length>2){var h=g[0];var j=g[1];var f=g[2];var i=(c-parseInt(f))/1000;if(i<10){a.campaign=h;a.nid=j;a.media=j;if(g.length>3){a.clickCategory=g[3]}}}}}})}});new PopIn5.StaticClass("Read","MainContentFinder",{init:function(){},find:function(j){function c(i){return i.offsetWidth*i.offsetHeight}function a(n){var m=0,p=n.childNodes;for(var l=0,o=p.length;l<o;l++){if(p[l].tagName!="IFRAME"&&p[l].tagName!="SCRIPT"){m+="textContent" in p[l]?p[l].textContent.length:p[l].innerText?p[l].innerText.length:0}}return m}var f=j.childNodes,d,h=null;for(var g=0,e=f.length;g<e;g++){d=f[g];if(d.nodeType!=1&&d.tagName!="IFRAME"&&d.tagName!="SCRIPT"){continue}if(h&&d.offsetWidth<h.offsetWidth&&h.offsetTop>10){continue}var k=d.getElementsByTagName("script").length>0?a(d):PopIn5.$F.isIE?d.innerText.replace(/\s+/,"").length:d.textContent.replace(/\s+/,"").length;var b=j.offsetWidth<1100?0.07:0;if(d.offsetTop<400&&d.offsetLeft<j.offsetWidth/2&&d.offsetWidth>300&&d.offsetHeight>250&&k>30&&c(d)>c(document.body)*b){h=d}}return h?this.find(h):j}});new PopIn5.Class("Read","ReadInstance",{init:function(b,a){this.read=b;this.context=a;this._config=b._config;if(!document.body){return}if(PopIn5.$F.notEmpty(this._config.mainNode)){this.mainNode=PopIn5.$F.selector(a.key||document.body,this._config.mainNode);this.mainNode=(this.mainNode.length>0)?this.mainNode[0]:""}if(PopIn5.$F.notEmpty(this._config.mainNodeElement)){this.mainNode=this._config.mainNodeElement}if(this._config.useMainContentFinder){this.mainNode=PopIn5.Read.MainContentFinder.find(document.body)}if(PopIn5.$F.isEmpty(this.mainNode)){return}this.data={};this.nid=PopIn5.$F.notEmpty(this._config.nid)?this._config.nid:PopIn5.$F.digest(window.location.host)+PopIn5.$F.digest(a.target);this.media=PopIn5.$F.notEmpty(this._config.media)?this._config.media:window.location.host;this.calculateRequiredTimeReading();this.calculateParts()},calculateRequiredTimeReading:function(){this.calculateTextLength();var a=this.data.textLength/this._config.textSpeed;this.data.textTime=a;this.calculateImages()},calculateTextLength:function(){var b="";var h=["A","IFRAME","SCRIPT","H1","H2","H3","H4","NOSCRIPT","STYLE"];var c=1000000;var a=0;var g=function(k){var m=PopIn5.$F.position(k);var j=PopIn5.$F.size(k);var l=isNaN(m.top)?0:m.top;var i=isNaN(j.height)?0:j.height;c=Math.min(c,l);a=Math.max(a,l+i)};var e=true;var d=false;if(PopIn5.$F.notEmpty(this._config.stopNode)){d=PopIn5.$F.selector(this._config.stopNode)}var f=function(n){if(!e){return}if(PopIn5.$F.notEmpty(d)){if(n==d){e=false;return}}if(n.nodeType==3){var m=PopIn5.$F.getInnerText(n).replace(/[\n\r\s]/g,"");if(m.length===0){return}b+=m;if(m.length>5){g(n.parentNode)}}else{if(n.nodeType==1){for(var k=0;k<h.length;k++){if(n.tagName==h[k]){return}}for(var l=0;l<n.childNodes.length;l++){var o=n.childNodes[l];f(o)}}}};f(this.mainNode);if(b===""){g(this.mainNode)}this.data.text=b;this.data.textLength=b.length;this.data.textStart=c;this.data.textEnd=a},calculateImages:function(){var b=PopIn5.$F.selector(this.mainNode,"IMG");var c=[];var a=0;for(var e=0;e<b.length;e++){var d=b[e];var f=PopIn5.$F.join(PopIn5.$F.size(d),PopIn5.$F.position(d));if(f.width*f.height>=200*200){c.push({element:d,box:f});a+=f.width*f.height}}this.data.imageTime=a/this._config.imageSpeed;this.data.images=c},calculateParts:function(){this.data.totalViewTime=0;this.data.mainSize=PopIn5.$F.size(this.mainNode);this.data.mainPosition=PopIn5.$F.position(this.mainNode);if(isNaN(this.data.mainSize.height)||isNaN(this.data.mainSize.width)){return}var g=this.data.mainPosition.top;var n=this.data.textEnd;if(isNaN(n)){n=this.data.mainPosition.top+this.data.mainSize.height}var h=n-g;this.data.top=g;this.data.height=h;this.data.count=Math.floor(h/10);this.data.partHeight=h/this.data.count;this.data.partSurface=this.data.mainSize.width*this.data.partHeight;this.data.parts=[];var l=0;var m=0;for(var e=0;e<this.data.count;e++){var a={};a.start=g+Math.round(e*this.data.partHeight);a.end=g+Math.round((e+1)*this.data.partHeight);a.viewTime=0;a.viewPercent=0;a.imageCovered=0;for(var d=0;d<this.data.images.length;d++){var b=this.data.images[d];if(b.box.top>=a.start&&b.box.top<a.end){a.imageCovered+=(a.end-b.box.top)/this.data.partHeight*b.box.width/this.data.mainSize.width}else{if(b.box.top+b.box.height>=a.start&&b.box.top+b.box.height<=a.end){a.imageCovered+=(b.box.top+b.box.height-a.start)/this.data.partHeight*b.box.width/this.data.mainSize.width}else{if(b.box.top<=a.start&&b.box.top+b.box.height>=a.end){a.imageCovered+=b.box.width/this.data.mainSize.width}}}}if(a.imageCovered>0.4){m++;a.type="img"}else{l++;a.type="text"}this.data.parts.push(a)}this.data.imageParts=m;this.data.textParts=l;this.data.textSurfaceSpeed=(l*this.data.partSurface)/this.data.textTime;this.data.imageSurfaceSpeed=(m*this.data.partSurface)/this.data.imageTime;for(var c=0;c<this.data.count;c++){var f=this.data.parts[c];if(f.type=="img"){f.readTime=this.data.imageTime/m}else{if(f.type=="text"){f.readTime=this.data.textTime/l}}}},elapsed:function(n,c,a){var k=parseInt(c)+parseInt(a);var l=[];for(var h=0;h<this.data.count;h++){var d=this.data.parts[h];if(d.start>c&&d.end<k&&d.viewPercent<1){l.push(d)}}var f=n/(l.length*this.data.partSurface);var m=0;for(var g=0;g<l.length;g++){var o=l[g];var e=(o.type=="img")?this.data.imageSurfaceSpeed:this.data.textSurfaceSpeed;var b=o.viewPercent;o.viewPercent=Math.min(1,b+f*e);if(o.viewPercent>b){m++}o.viewTime=o.viewPercent*o.readTime}if(m>0){this.data.totalViewTime+=n}else{return}},getOutput:function(){var a={};var e=0;var d=0;var f=this.data;for(var c=0;c<f.count;c++){var b=f.parts[c];if(b.viewTime>0){e++}d+=(b.viewPercent/f.count)}a.viewPercent=e/f.count;a.readPercent=d;return a}});new PopIn5.Class("Read","ReadLogger",{init:function(c,a){this.read=c;this._config=c._config;this.readInstance=a;this.firstLog=true;this.showAllLog=false;this.read70Log=false;this.paidLog=PopIn5.$.Global.referrer.indexOf("paid_")>-1;this.previousTime=0;var b=document.referrer;this.isAdPage=PopIn5.$F.notEmpty(b)&&b.indexOf("a.popin.cc")>0;this.adReadRecordFrame=null;if(PopIn5.$F.isEmpty(this.readInstance.mainNode)){return}if(this.isAdPage){this.initAdReadRecord()}setInterval(PopIn5.$F.pass(this.logWritterInterval,this,[]),2000)},initAdReadRecord:function(){try{if("function"!==typeof window.postMessage){return}this.adReadRecordFrame=PopIn5.$F.cio(PopIn5.$.Global.protocol+"//api.popin.cc/iframe/ad_read.html")}catch(a){}},updateAdReadPercent:function(c){try{var a=this.adReadRecordFrame.window;if(!a||!this.read.nid){return}a.postMessage(JSON.stringify({action:"updateAdRead",payload:{adId:this.read.nid,readPercent:c}}),"*")}catch(b){}},updateArticleReadPercentForRT:function(b){try{if("function"!==typeof window.postMessage||!this.articleReadLogForRT.articleId){return}if(!this.articleReadRecordFrame){this.articleReadRecordFrame=PopIn5.$F.cio(PopIn5.$.Global.protocol+"//api.popin.cc/iframe/article_read.html")}this.articleReadRecordFrame.window.postMessage(JSON.stringify({action:"updateArticleRead",payload:{articleId:this.articleReadLogForRT.articleId,readPercent:b}}),"*")}catch(a){}},logWritterInterval:function(){var b=this.getOutput();if(this.read.newSession){var a=Math.random()<0.5?"true":"false";if(this.isAdPage){a="true"}PopIn5.$F.ssSet("__read_rand",a)}if(!this.articleReadLogForRT&&window.popInGlobal&&window.popInGlobal.articleReadLogForRT){this.articleReadLogForRT=window.popInGlobal.articleReadLogForRT}if(!this.articleReadLogForRT&&"false"==PopIn5.$F.ssGet("__read_rand")&&window.location.href.indexOf("popinread")<0){return}this.writeLog(this.readInstance.data,b);if(b.viewPercent==1&&!this.showAllLog){this.showAllLog=true;PopIn5.Read.Log.showAllLog(this)}if(PopIn5.$F.notEmpty(this.read.nid)&&b.readPercent>=0.7&&!this.read70Log){this.read70Log=true;PopIn5.Read.Log.read70Log(this)}if(this.paidLog){PopIn5.Read.Log.paidLog(this);this.paidLog=false}},getOutput:function(){var c=this.readInstance.data;var a=this.readInstance.getOutput();this.readInstance.context.readOutput=a;a.stat={text:Math.round(c.textLength/100)*100,image:Math.round(100*c.imageParts/c.count)};if(this.firstLog&&this._config.useSessions){var d=this.readInstance.read.sessionData;a.stat.in_text=a.stat.text;a.stat.in_image=a.stat.image;if(PopIn5.$F.notEmpty(d)){var b=d.split("|");a.stat.out_text=b.length>0?b[0]:"";a.stat.out_r=b.length>2?b[2]:"";a.stat.out_image=b.length>1?b[1]:""}}return a},writeLog:function(k,f){var d=this.readInstance.context;var a=PopIn5.$.Log.logBuilder(PopIn5.$.Global.protocol+"//rlog.popin.cc/s.gif");var o=this.read.readArticle?d.target:window.location.href;a.add("url",encodeURIComponent(o));a.add("uid",this.read.uid);a.add("nid",PopIn5.$F.notEmpty(this.read.nid)?this.read.nid:this.readInstance.nid);a.add("media",PopIn5.$F.notEmpty(this.read.media)?this.read.media:this.readInstance.media);var n=PopIn5.$F.isEmpty(this.previousR1);var l="v"+parseInt(f.viewPercent*10)+"r"+parseInt(f.readPercent*10);var g=Math.round(f.readPercent*10)*10;if(g<=0){return}if(this.isAdPage){this.updateAdReadPercent(g)}else{if(this.articleReadLogForRT){this.updateArticleReadPercentForRT(g)}}a.add("r1",g);var e=n?0:this.previousR1;if(PopIn5.$F.notEmpty(this.previousR1)&&g==e){return}a.add("r2",e);var c=[];for(var j in f.stat){if(f.stat.hasOwnProperty(j)){a.add("r3",j+f.stat[j])}}var h=Math.min(k.totalViewTime,(k.textTime+k.imageTime)*1);var b=n?Math.round(h):Math.round(h-this.previousTime);a.add("r4",b);if(PopIn5.$F.notEmpty(this._config.category)&&this._config.category===true&&PopIn5.$F.isEmpty(this._config.segmentData.category)){this._config.segmentData.category=PopIn5.$F.notEmpty(d.segmentData.category)?d.segmentData.category:"all"}PopIn5.$.Segment.addSegmentLog(a,this._config,d,{});var m=PopIn5.$.Global.referrer;if(m!==""){a.add("r5","re_"+m)}a.add("r5","dv_"+PopIn5.$.Global.device);if(PopIn5.$F.notEmpty(f.stat.out_r)){a.add("r5","out_r"+f.stat.out_r)}if(this.read.newSession&&this.firstLog){a.add("r5","session");if(document.querySelector("#taxel_ab_test_parent")){PopIn5.Read.Log.monitorGMOLog("popin")}if(document.querySelector("._taxel_recommend_header")){PopIn5.Read.Log.monitorGMOLog("taxel")}}if(this._config.useSessions&&this.firstLog){a.add("r5","sstorage")}if(PopIn5.$F.notEmpty(this.read.clickCategory)){a.add("r5",this.read.clickCategory)}a.add("r6",Math.round(h));a.add("r7","-"+Math.round(this.previousTime));if(n){a.add("r8",k.textTime+k.imageTime)}a.add("t",new Date().getTime());PopIn5.$.Global.event.fireEvent("readChange",[g,b]);PopIn5.$.Log.log(a.build(),{});this.previousTime=h;this.previousR1=g;this.firstLog=false;PopIn5.$F.ssSet(this._config.sessionParam,[f.stat.text,f.stat.image,g].join("|"));PopIn5.Read.Treasure.writeReadLog(this.readInstance,g,h,f);return}});new PopIn5.Class("Read","Storage",{init:function(a){this.read=a;this._config=a._config;this.enabled=true},save:function(a){if(!this.enabled){return}this.saveUserClass(a);this.saveAllHistory(a);if(a>70){this.saveReadHistory(a)}},localGet:function(b){var a=localStorage.getItem(b);if(PopIn5.$F.notEmpty(a)){return JSON.parse(a)}else{return{}}},localSet:function(b,c){try{localStorage.setItem(b,JSON.stringify(c))}catch(a){}},saveUserClass:function(c){var h=this.localGet("_prh_class");var b=new Date();var f=function(i){return[i.getFullYear(),(i.getMonth()<9?"0":"")+(i.getMonth()+1),(i.getDay()<10?"0":"")+i.getDate()].join("")};var m=f(b);if(PopIn5.$F.notEmpty(h.lastSent)&&h.lastSent==m){return}h[m]=1;var e=[];for(var k=0;k<31;k++){var n=new Date(b.getTime()-k*1000*60*60*24);e.push(PopIn5.$F.notEmpty(h[f(n)])?1:0)}var d=0;for(var g=0,p=b.getDate();g<p;g++){d+=e[g]}var l=false;if(d==1){l="a"}if(d==10){l="b"}if(d==22){l="c"}if(l){var o=this.read.readArticle?this._config.target:window.location.href;var a=PopIn5.$.Global.protocol+"//rlog.popin.cc/s.gif";a+="?url="+encodeURIComponent(o);a+="&uid="+this.read.uid;a+="&nid="+this.read.nid;a+="&media="+this.read.media;a+="&month"+m.substring(0,6)+"="+l;a+=("&t="+new Date().getTime());PopIn5.$.Log.log(a,{});h.lastSent=m}this.localSet("_prh_class",h)},saveAllHistory:function(d){var c=this.localGet("_prh_all");var h=PopIn5.$F.digest(this._config.target);if(PopIn5.$F.isEmpty(c[this._config.target])){c[h]={read:0}}if(d>c[h].read){c[h].read=d}c[h].time=new Date().getTime();var a=0;var e="";var b=new Date().getTime()+10000;for(var f in c){var g=c[f];if(g.time<b){b=g.time;e=f}a++}if(a>100){delete c[e]}this.localSet("_prh_all",c)},saveReadHistory:function(d){var c=this.localGet("_prh");if(PopIn5.$F.isEmpty(c[this._config.target])){c[this._config.target]={read:0,category:category,title:document.title}}c[this._config.target].read=d;c[this._config.target].time=new Date().getTime();var a=0;var e="";var b=new Date().getTime()+10000;for(var f in c){var g=c[f];if(g.time<b){b=g.time;e=f}a++}if(a>50){delete c[e]}this.localSet("_prh",c)}});new PopIn5.Class("Read","Timer",{init:function(){this.activeDetector()},start:function(b){var a=this;var c=new Date().getTime();setInterval(function(){var e=new Date().getTime();var d=(e-c)/1000;c=e;if(!a.active||d>0.15){return}b(d)},100)},activeDetector:function(){var b=this;this.active=true;var c,a;if(typeof document.hidden!=="undefined"){c="hidden";a="visibilitychange"}else{if(typeof document.mozHidden!=="undefined"){c="mozHidden";a="mozvisibilitychange"}else{if(typeof document.msHidden!=="undefined"){c="msHidden";a="msvisibilitychange"}else{if(typeof document.webkitHidden!=="undefined"){c="webkitHidden";a="webkitvisibilitychange"}else{this.active=true;return}}}}document.addEventListener(a,function(d){b.active=!(document[c])},false)}});PopIn5.ErrorSafeStaticClass("Read","Treasure",{getLogger:function(a){if(PopIn5.$F.isEmpty(this.tdLogger)){this.tdLogger=PopIn5.$.Treasure.createLogger()}return this.tdLogger},writeReadLog:function(c,d,h,e){var o=this.getLogger();var b=c.context;var a=c.read.nid;var n={image:"",pubdate:"",domain:location.host,media:PopIn5.Discovery.Global.media||c.media||location.host,nid:a,device:PopIn5.$F.isMobileDevice()?"mobile":"pc",api_host:"jp.popin.cc"};if(PopIn5.$F.notEmpty(b.configs.discovery)){var f=PopIn5.$F.parseUri(b.configs.discovery.apiUrl).host;n.api_host=f.replace("discoveryplus.","jp.")}if(PopIn5.$F.notEmpty(PopIn5.$.Config.apiHost)){n.api_host=PopIn5.$.Config.apiHost}if(PopIn5.$F.notEmpty(b.discoveryData)){var m=b.discoveryData;n.category=PopIn5.$F.notEmpty(m.category)?m.category:"";n.image=PopIn5.$F.notEmpty(m.image_url)?m.image_url:"";n.pubdate=PopIn5.$F.notEmpty(m.pubdate)?m.pubdate:""}n.read_re=PopIn5.$.Global.referrer;if(document.referrer.indexOf("a.popin.cc")>-1){n.campaign=c.read.campaign}var l=PopIn5.$.Segment.getSegmentData(c._config,b,{useCommonCategory:true});for(var p in l){n["read_"+p]=l[p][0]}if(PopIn5.$F.notEmpty(n.read_cc)){n.common_category=n.read_cc;delete n.read_cc}if(PopIn5.$F.notEmpty(n.common_category)){var j=n.common_category.split("_");if(j.length>0){n.main_category=j[0]}}if(PopIn5.$F.notEmpty(b.segmentData.mainCategory)){n.main_category=b.segmentData.mainCategory}for(var g in e.stat){n["read_stat_"+g]=parseInt(e.stat[g])}n.read=d;n.read_time=Math.round(h*10)/10;n.popin_user_id=c.read.uid;n.piuid=(PopIn5.$F.lsGet("__pi_u_id__")||[""]).split("-")[0];var k=PopIn5.$F.join({},o.getTrackValues());k=PopIn5.$F.join(k,n);PopIn5.$.Treasure.writeRecord(o,"readlogs",k)}});new PopIn5.Class("Share","BoxRenderer",{init:function(a){this._config=a;PopIn5.$F.makeListener(this);if(PopIn5.$F.notEmpty(this._config.css)){PopIn5.$F.appendCSS(this._config.css)}this.createContainer();this.render()},createContainer:function(){var a=document.createElement("div");a.id=this._config.containerId;PopIn5.$F.addClass(a,"_popIn_share_container");var b=PopIn5.$F.selector(this._config.selector);if(b){PopIn5.$F.insertAdjacentElement(b,this._config.position,a)}this.container=a},render:function(){var a=this;var g=PopIn5.$F.ce(this.container,"div",this._config.headerLabel);PopIn5.$F.addClass(g,"_popIn_share_header");var c=function(){PopIn5.Share.Log.clickLog();a.fireEvent("click",[])};for(var d=0;d<this._config.items.length;d++){var e=this._config.items[d];var b=PopIn5.$F.ce(this.container,"div");var f=new PopIn5.Share.ItemRenderer(this._config,e,b);f.addEventListener("click",c)}}});PopIn5.Class("Share","Config",{init:function(a){this.setDefaults();PopIn5.$.Config.overrideAll(this,a);this.afterConfig()},setDefaults:function(){this.urlReplace=PopIn5.$.Config.urlReplace;this.selector="#_popIn_share";this.position="AfterBegin";this.css="";this.containerId="_popIn_share_container";this.headerLabel="";this.items=[["twitter","Twitter"],["facebook","Facebook"],["google","Google+"],["hatena","はてな"]]},afterConfig:function(){this.target=PopIn5.$F.replaceAll(window.location.href,this.urlReplace)}});new PopIn5.Class("Share","FacebookHandler",{init:function(c){PopIn5.$F.makeListener(this);var a=this;this.target=c;this.title=document.title;var b=new PopIn5.$.ProxyAjax("https://graph.facebook.com/?ids="+encodeURIComponent(c));b.timeout=500;b.setCallback(function(d){var g=0;try{for(var f in d){g+=d[f].share.share_count}}catch(h){}a.fireEvent("change",[g])});b.load()},handleClick:function(){var a=PopIn5.$F.isMobileDevice()?"https://m.facebook.com/sharer.php?u="+this.target+"&t="+this.title:"https://www.facebook.com/share.php?u="+this.target+"&t="+this.title;window.open(a,"facebookWindow","width=400,height=300,menubar=no, toolbar=no, scrollbar=yes")}});new PopIn5.Class("Share","GoogleHandler",{init:function(b){PopIn5.$F.makeListener(this);var a=this;this.target=b;this.title=document.title;setTimeout(function(){a.fireEvent("change",[0])},0)},handleClick:function(){var a="https://plus.google.com/share?url="+this.target;window.open(a,"googleWindow","width=400,height=300,menubar=no, toolbar=no, scrollbar=yes")}});new PopIn5.Class("Share","HatenaHandler",{init:function(b){PopIn5.$F.makeListener(this);var a=this;this.target=b;this.title=document.title;setTimeout(function(){a.fireEvent("change",[0])},0)},handleClick:function(){var a="https://b.hatena.ne.jp/add?mode=confirm&url="+this.target+"&t="+this.title;window.open(a,"hatenaWindow","width=400,height=300,menubar=no, toolbar=no, scrollbar=yes")}});new PopIn5.Class("Share","TwitterHandler",{init:function(b){PopIn5.$F.makeListener(this);var a=this;this.target=b;this.title=document.title;setTimeout(function(){a.fireEvent("change",[0])},0)},handleClick:function(){var a="https://twitter.com/share?url="+this.target+"&text="+encodeURIComponent(this.title);window.open(a,"twitterWindow","width=400,height=300,menubar=no, toolbar=no, scrollbar=yes")}});PopIn5.StaticClass("Share","Handlers",{init:function(){this.handlers={twitter:"TwitterHandler",facebook:"FacebookHandler",google:"GoogleHandler",hatena:"HatenaHandler"};this.targets={}},getInstance:function(a,c){if(typeof c=="undefined"){c=PopIn5.$.Global.target}if(typeof this.handlers[a]!="undefined"){if(typeof this.targets[c]=="undefined"){this.targets[c]={instances:{}}}var b=this.targets[c].instances;if(typeof b[a]=="undefined"){b[a]=new PopIn5.Share[this.handlers[a]](c)}return b[a]}return false},start:function(a,c,b){this.getInstance(a,b).addEventListener("change",function(d){c(d)})},click:function(a,b){this.getInstance(a,b).handleClick()}});new PopIn5.Class("Share","ItemRenderer",{init:function(c,b,a){this._config=c;this.container=a;this.itemId=b[0];this.itemLabel=b[1];PopIn5.$F.makeListener(this);this.render()},render:function(){PopIn5.$F.addClass(this.container,"_popIn_share_item _popIn_share_"+this.itemId);var c=PopIn5.$F.ce(this.container,"span",this.itemLabel);var b=PopIn5.$F.ce(this.container,"span","0");PopIn5.$F.cssSet(b,"display","none");PopIn5.$F.addClass(b,"counter");var a=this;PopIn5.Share.Handlers.start(this.itemId,function(d){b.innerHTML=d;if(d>0){PopIn5.$F.cssSet(b,"display","")}},a._config.target);PopIn5.$F.bind(this.container,"click",function(){PopIn5.Share.Handlers.click(a.itemId,a._config.target);a.fireEvent("click",[])})}});PopIn5.StaticClass("Share","Log",{init:function(){},clickLog:function(){var b=PopIn5.$.Log.logBuilder(PopIn5.$.Global.protocol+"//rlog.popin.cc/s.gif");var a=b.add("url",encodeURIComponent(location.href)).add("uid",PopIn5.$.Global.uid).add("type",PopIn5.$.Global.device+"_share").add("nid",PopIn5.$.Global.device).add("media",location.host).add("t",new Date().getTime()).build();PopIn5.$.Log.log(a,{})}});PopIn5.Module("Share",{initModule:function(){var a=this;var b=new PopIn5.Share.BoxRenderer(this._config);b.addEventListener("click",function(){a.handleClick()})},handleClick:function(){PopIn5.$.Global.event.fireEvent("share-click",[])}});PopIn5.Class("Engagement","Config",{init:function(a){this.setDefaults();PopIn5.$.Config.overrideAll(this,a);this.afterConfig()},setDefaults:function(){this.time=5000;this.logInterval=10000;this.useParts=false;this.format="_empty";this.bid="_empty";this.pid="_empty"},afterConfig:function(){var a=PopIn5.$.Global;a.nid=PopIn5.$F.digest(window.location.host)+PopIn5.$F.digest(PopIn5.$.Config.target);PopIn5.$.Config.overrideAll(PopIn5.Engagement.Global,this)}});PopIn5.StaticClass("Engagement","Global",{init:function(){}});PopIn5.StaticClass("Engagement","Log",{init:function(){},basicLog:function(c,g){var f=PopIn5.$.Global;var e=PopIn5.Engagement.Global;var b=f.uid;var h=encodeURIComponent(PopIn5.$.Config.target);if(!PopIn5.$F.notEmpty(b)){return}var d=PopIn5.$.Log.logBuilder(PopIn5.$.Global.protocol+"//rlog.popin.cc/e.gif");d.add("url",h);d.add("uid",f.uid);d.add("nid",f.nid);d.add("format",e.format);d.add("type",c);d.add("bid",e.bid);d.add("pid",e.pid);d.add("value",g);d.add("device",PopIn5.$.Global.device);d.add("t",new Date().getTime());PopIn5.$.Log.log(d.build());if(f.uid.indexOf("%")>-1){var a=PopIn5.$.Log.logBuilder(PopIn5.$.Global.protocol+"//rlog.popin.cc/e.gif");a.add("url",h);a.add("uid",f.uid);a.add("type","uidcheck");a.add("device",PopIn5.$.Global.device);a.add("browser",PopIn5.$F.browserType);a.add("ua",encodeURIComponent(PopIn5.$F.nua));a.add("t",new Date().getTime());PopIn5.$.Log.log(a.build())}}});new PopIn5.Module("Engagement",{initModule:function(){this.engagementLeft=this._config.time;this.totalEngagement=0;this.lastTime=new Date().getTime();this.lastLog=0;var a=this;PopIn5.$.User.getUser(function(b){a.sessionLog();a.logReferrer()});this.addEngagementEvents();if(this._config.useParts){this.parts=new PopIn5.Engagement.Parts()}setInterval(function(){a.oneStep()},250)},oneStep:function(){var b=new Date().getTime();var a=b-this.lastTime;if(this.engagementLeft>0){a=Math.min(this.engagementLeft,a);if(this._config.useParts){this.parts.elapsed(a)}this.totalEngagement+=a;if(this.totalEngagement-this.lastLog>this._config.logInterval&&PopIn5.$F.notEmpty(PopIn5.$.Global.uid)){this.writeLog();this.lastLog=this.totalEngagement}}this.lastTime=b;this.engagementLeft-=a},addEngagementEvents:function(){var a=this;var d=function(f){a.engagementLeft=a._config.time};var c=["focus","click","mousemove","scroll"];for(var b=0;b<c.length;b++){PopIn5.$F.bind(window,c[b],d)}},sessionLog:function(){var b="__engagement_session";if(typeof sessionStorage=="undefined"){return}var a=sessionStorage.getItem(b);if(!PopIn5.$F.notEmpty(a)){sessionStorage.setItem(b,1);PopIn5.Engagement.Log.basicLog("e_session",1)}},writeLog:function(){if(this.totalEngagement>600*1000){return}PopIn5.$.Global.event.fireEvent("engagementChange",[this.totalEngagement]);PopIn5.Engagement.Log.basicLog("e_time",Math.round((this.totalEngagement-this.lastLog)/1000))},logReferrer:function(){var a=document.referrer;if(PopIn5.$F.notEmpty(a)){var b=PopIn5.$F.parseUri(a);if(b.host.indexOf(location.host)<0){PopIn5.Engagement.Log.basicLog("e_ref_"+b.host,1)}}}});new PopIn5.Class("Engagement","Parts",{init:function(){this.parts=[];this.chunkSize=100;this.logCount=0},elapsed:function(f){var a=PopIn5.$F.pageScrollTop();var d=PopIn5.$F.getWindowHeight();var c=PopIn5.$F.getWindowWidth();if(c!=320){return}this.logCount++;var g=Math.round((a)/this.chunkSize);var b=Math.round((a+d)/this.chunkSize);for(var e=g;e<=b;e++){while(this.parts.length<=e){this.parts.push(0)}this.parts[e]+=f}if(this.logCount>=20){this.sendLog();this.logCount=0;this.parts=[]}},sendLog:function(){var b=[];for(var a=0;a<this.parts.length;a++){b.push(Math.round(this.parts[a]/100)/10)}PopIn5.Engagement.Log.basicLog("e_ptime",b.join("|"))}});