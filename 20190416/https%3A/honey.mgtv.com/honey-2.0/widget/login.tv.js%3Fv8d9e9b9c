honey.def("mod:dialog, plugin:encodePassword",function(d){"use strict";d.css("//css.mgtv.com/imgotv-member/page/member/member-dialog.css?version=20190415");var m,a=$(document),p=$(document),i="//i.mgtv.com",u=i+"/vcode?from=pcclient&time=",h=$("img[node-type=mini-yzm-src]"),n=i+"/my/userinfo?callback=?",f=null,g=$(".yzm-mod"),v=/(^(([0\+]\d{2,3}-)?(0\d{2,3})-)(\d{7,8})(-(\d{3,}))?$)|(^0{0,1}1[3|4|5|6|7|8|9][0-9]{9}$)/,w={},y={},b="login",c="fail",k=!1,x=['<div class="m-dialog-login" id="honey-mini-login-dialog" mg-stat-mod="c_login">','<div class="m-content honey-dialog-conBox">',"</div>","</div>"].join(""),S=null,l="",C={100:4,200:5,300:3},O=['<div node-type="honey-mini-dialog-box">','        <a href="#" class="close honey-dialog-destroy"><em>关闭</em></a>','        <ul class="tab" node-type="tab-nav">','            <li class="current" mg-stat-click="" action-type="honey-mini-login-tabs" node-type="honey-mini-login-account-tabs" type="login">账号登录</li>','            <li class="current" mg-stat-click="" type="register" node-type="honey-mini-register-btn-tabs" style="display:none;">注册</li>','            <li type="loginmes" mg-stat-click="" node-type="honey-mini-login-mes-btn" action-type="honey-mini-login-tabs">短信登录</li>',"        </ul>",'        <div class="m-form-login info-box honey-mini-dialog" id="honey-mini-box-login" node-type="honey-mini-box-login">','            <p class="row msg-validate" id="honey-mini-login-error" style="display:none;"></p>','            <p class="row-title">账号</p>','            <p class="row"><input type="text" class="text mini-login-name" id="honey-mini-login-auto" placeholder="请输入手机号码或邮箱">','                   <span class="rowlayer-list" node-type="honey-mini-login-auto" style="display:none"></span>','                   <a class="m-saoma-icon"></a>',"               </p>",'            <p class="row-title">密码</p>','            <p class="row">','               <input type="password" maxlength="20" class="text password login-dialog-password" placeholder="请输入密码">',"            </p>",'            <div class="yzm-mod" style="display:none;">','            <p class="row-title">验证码</p> ','            <p class="row">','                <input type="text" name="" class="text verifcode mini-login-yzm" placeholder="验证码">','                <span class="verif" mg-stat-click="">','                    <img class="verifimg-img" action-type="login-accout-yzm" node-type="mini-yzm-src" src="'+i+'/vcode" action-type="mini-yzm-refresh" alt="验证码">','                    <i class="verifimg-refresh" action-type="mini-yzm-refresh">刷新</i>',"                </span>","            </p>","            </div>",'            <p class="row-title"></p>','            <p class="row top2">','                <input type="checkbox" checked="checked" class="choose" node-type="honey-mini-login-auto">','                <label for="remember" class="label remember">记住我</label>','                <a class="note a-register" href="javascript:void(0)" type="register" node-type="honey-mini-register-btn" action-type="honey-mini-login-tabs">注册</a>','                <a class="note losepwd" target="_blank" href="'+i+'/account/backpwd">忘记密码？</a>',"            </p>",'            <p class="row"><a href="javascript:void(0)" class="btn btn-login" id="honey-mini-login-submit">登 录</a></p>',"        </div>",'       <div class="m-form-login info-box honey-mini-dialog" id="honey-mini-box-login-message" node-type="honey-mini-box-loginmes" style="display:none;">','           <div class="m-zhanghao-login">','               <p class="row msg-validate" id="honey-mini-mes-error" node-type="error-title"></p>','               <p class="row-title">账号</p>','               <div class="row a-phone">','                   <a class="m-saoma-icon"></a>','                   <span class="area" node-type="honey-mini-area" id="honey-mini-area-btns">','                       <b node-type="honey-mini-area-county" id="honey-mini-area-btns2"  style="border-right:1px solid #ddd;">+86</b>','                       <i id="honey-mini-area-btns3" style="display:none;"></i>',"                   </span>",'                   <ul class="area-ul" node-type="honey-mini-area-list">',"                       <li>","                           <span>中国</span>","                           <b>+86</b>","                       </li>","                   </ul>",'                   <input type="text" name="" maxlength="20" class="text" node-type="honey-mini-mes-phone" placeholder="请输入手机号">',"               </div>",'               <div class="yzm-mod">','                   <p class="row-title">验证码</p>','                   <p class="row">','                     <input type="text" name="" class="text verifcode" node-type="meslogin-code" placeholder="请输入验证码">','                    <span class="verif">','                         <img class="verifimg-img" id="login-yzm_img" src="" action-type="meslogin-img" alt="">','                         <i class="verifimg-refresh" action-type="meslogin-refresh">刷新</i>',"                    </span>","                   </p>","               </div>",'               <p class="yzm-mod">','                   </p><p class="row-title">校验码</p>','                   <p class="row">','                       <input type="text" name="" class="text verifcode" node-type="honey-mini-mes-code" placeholder="请输入校验码">','                       <span class="verif">','                           <a href="javascript:void(0)" class="verif-a" action-type="message-verify-code" node-type="honey-mini-mes-getcode">获取校验码</a>',"                       </span>","                   </p>","               <p></p>",'               <p class="row-title"></p>','               <p class="row">','                   <a href="javascript:void(0)" class="btn btn-login" id="honey-mini-mes-login-submit" action-type="message_login">登 录</a>',"               </p>","           </div>","       </div>",'        <div class="m-content" node-type="honey-mini-dialog-saoma" id="honey-mini-box-saoma" style="display:none;">','           <div class="m-form-saoma" node-type="register">','               <p class="m-form-image">','                   <img class="m-erweima-image" src="//www.mgtv.com/image/global/saoma_default.gif"/>','                   <span class="m-erweima-tips"><b>180</b> 秒后为你更新二维码</span>','                   <span class="m-erweima-failed">扫码失败，请<b class="m-erweima-again"> 重试</b></span>','                   <span class="m-repeat-image-bg"></span>','                   <span class="m-repeat-image-intro">二维码失效<br>请点击刷新</span>','                   <span class="m-repeat-image-success">扫码成功<br>请在手机上确定</span>',"               </p>",'               <p class="m-form-intro"></p>',"           </div>",'           <a class="m-back-login">返回账号登录</a>',"        </div>",'        <div class="m-form-register info-box honey-mini-dialog" id="honey-mini-box-register" node-type="honey-mini-box-register" style="display:none;">','            <p class="row msg-validate" id="honey-mini-register-error" style="display:none">错误提示</p>','            <p class="row msg-validate ok-ts" style="display:none;">校验码发送成功</p>','            <p class="row-title" node-type="mini-register-type">手机</p>','            <p class="row"><input type="text" name="" class="text register-name username-reg" node-type="honey-mini-reg-name" placeholder="请输入手机号码">','                <span class="rowlayer-btn" type="phone" action-type="honey-mini-reg-email" style="display:none">邮箱注册</span>','                <span class="rowlayer-list" node-type="honey-mini-reg-auto" style="display:none"></span>',"            </p>",'            <p class="row-title" node-type="honey-mini-reg-pas">密码</p>','            <p class="row" node-type="honey-mini-reg-pas"><input type="password" maxlength="20" name="" class="text register-password" node-type="honey-mini-reg-safe" placeholder="请输入6~20位密码"></p>','            <p class="row-password-line" id="honey-mini-pass-safe" node-type="honey-mini-reg-pas" style="display:none">','                <span class="row-txt step">强度</span>','                <em class="row-line" node-type="honey-mini-line"></em><em class="row-line" node-type="honey-mini-line"></em><em class="row-line" node-type="honey-mini-line"></em>',"            </p>",'            <p class="row-title" node-type="honey-mini-email-yzm">验证码</p> ','            <p class="row" node-type="honey-mini-email-yzm">','                <input type="text" name="" class="text verifcode honey-mini-register-yzm" placeholder="验证码">','                <span class="verif">','                    <img class="verifimg-img" action-type="register-account-yzm" node-type="mini-yzm-src" src="" action-type="mini-yzm-refresh" alt="验证码">','                    <i class="verifimg-refresh" action-type="mini-yzm-refresh">刷新</i>',"                </span>","            </p>",'            <p class="row-title" node-type="honey-mini-phone-regcode">校验码</p>','            <p class="row" node-type="honey-mini-phone-regcode"><input type="text" name="" class="text phone-yzm username-reg" placeholder="请输入校验码">','                <span class="rowlayer-btn zcm" action-type="honey-mini-get-pollcode">获取校验码</span>',"            </p>",'            <p class="row-title"></p>','            <p class="row row-license">','                <input type="checkbox" name="" class="choose" id="honey-mini-license" checked="checked">','                <label for="license" class="label license">我已阅读<a href="//i.mgtv.com/account/protocol" target="_blank">芒果tv用户协议</a>及<a href="//i.mgtv.com/account/protocol" target="_blank">版权声明</a></label>',"            </p>",'            <p class="row"><a href="javascript:void(0)" class="btn btn-register" id="honey-mini-register">注 册</a></p>','            <a href="javascript:void(0)" action-type="honey-mini-login-tabs" type="login" class="m-backto-login">返回账号登录</a>',"        </div>",'        <div id="honey-mini-box-email" node-type="honey-mini-box-email" class="m-form-register info-box honey-mini-dialog" style="display:none">','               <p class="row-sendemail">','                   <span class="row-sendemail-title" >还差一步即可完成注册</span>','                   <span class="row-sendemail-info">我们已经向您的邮箱 <em node-type="honey-mini-email-name"></em> <a href="#" action-type="honey-mini-reset-email">[更改注册邮箱]</a>发送了一封激活邮件，请点击邮件中的链接完成注册！</span>','                   <span class="row-sendemail-change">','                       <em class="ico-re" action-type="honey-mini-reset-send">重新发送</em>',"                   </span>","               </p>",'               <p class="row row-email"><a href="javascript:;" target="_blank" class="btn btn-register" node-type="honey-mini-reg-gotoEmail">立即进入邮箱</a></p>','               <p class="row-sendemail-ts">如果无法跳转，请手动打开邮箱</p>',"        </div>",'        <div class="c-union-login c-union-login-simple">','            <ul node-type="honey-mini-third">','                <li><a href="#" class="qq" type="100"><i></i><span>QQ</span></a></li>','                <li><a href="#" class="wx" type="300"><i></i><span>微信</span></a></li>','                <li class="last"><a href="#" class="wb" type="200"><i></i><span>新浪</span></a></li>',"            </ul>","        </div>","</div>",'<div class="m-content" node-type="honey-mini-dialog-suc" style="display:none;">','   <a href="#" class="close honey-dialog-close"><em>关闭</em></a>','   <p class="close-tx"><em node-type="honey-mini-suc-time">3s</em> 后自动关闭</p>','   <div class="m-form-register m-form-register-ok" node-type="register">','       <p class="register-ok">','           <span class="register-ok-title">恭喜您注册成功！</span>','           <span class="register-ok-info">昵称：<em node-type="honey-mini-suc-name"></em></span>',"       </p>",'       <p class="row row-email"><a href="#" class="btn btn-register btn-110 honey-dialog-close">关 闭</a></p>',"    </div>","</div>"].join(""),s=['<div class="login-check-dialog login-check-dialog-first">','<div class="m-content">','<div class="m-merr">','<a href="#" class="merr-close honey-dialog-destroy">关闭</a>','<p class="merr-head"><span>登录提醒</span></p>','<div class="merr-con">','<p class="merr-p1 merr-tips">您的账号登录的设备已超过上限，请<span class="title"></span>手机后再登录</p>','<p class="merr-p">','<a href="javascript:void(0)" class="merr-btn cancel honey-dialog-destroy">取消登录</a>','<a href="javascript:void(0)" class="merr-btn" id="login-check-first-btn"><span class="title"></span>手机</a>',"</p>","</div>","</div>","</div>","</div>",'<div class="login-check-dialog login-check-dialog-two " style="display:none;">','<div class="m-content">','<div class="m-merr">','<a href="javascript:void(0)" class="merr-close honey-dialog-destroy">关闭</a>','<p class="merr-head"><span><span class="title"></span>手机</span></p>','<div class="merr-con pt30">','<p class="merr-p">','<span class="merr-ts ok-ts">手机号码不能为空</span>','<span class="row-til">手机</span>','<span class="row"><input id="phone-name" name="" class="text user-phone" placeholder="请输入手机号码" type="text"></span>',"</p>",'<p class="merr-p">','<span class="row-til">校验码</span>','<span class="row row-1"><input id="yzm-name" name="" class="text phone-check-yzm" placeholder="请输入校验码" type="text"></span>','<a href="javascript:void(0)" class="merr-btn yzm-btn login-check-yzm-btn">获取校验码</a>',"</p>",'<p class="merr-p">','<span class="row-til"></span>','<a href="javascript:void(0)" class="merr-btn yzphone login-check-submit"><span class="title"></span>手机</a>',"</p>","</div>","</div>","</div>","</div>",'<div class="login-check-dialog login-check-dialog-three " style="display:none;">','<div class="m-content">','<div class="m-merr">','<a href="javascript:void(0)" class="merr-close honey-dialog-destroy">关闭</a>','<p class="merr-head"><span><span class="title"></span>手机</span></p>','<div class="merr-con">','<p class="merr-p1 okts">手机<span class="title"></span>成功<em><i class="login-check-dialog-three-clock">3<i>S 后关闭</em></p>',"</div>","</div>","</div>","</div>"].join(""),I={"qq.com":"http://mail.qq.com","gmail.com":"http://mail.google.com","sina.com":"http://mail.sina.com.cn","sina.cn":"http://mail.sina.com.cn","163.com":"http://mail.163.com","126.com":"http://mail.126.com","sohu.com":"http://mail.sohu.com","sogou.com":"http://mail.sogou.com","139.com":"http://mail.10086.cn","189.com":"http://webmail16.189.cn/webmail","foxmail.com":"http://www.foxmail.com"},E=function(e){var i=/http:\/\/([^\/]+)/i;var o,n,t=e.replace(i,""),a={"www.mgtv.com":0,"so.mgtv.com":9,"list.mgtv.com":8,"live.mgtv.com":7,"i.mgtv.com":12}[(o=e,n=o.match(i),null!=n&&0<n.length?n[1]:"")],s="";if(s=0<t.indexOf("?")?t.substring(0,t.indexOf("?")):0<t.indexOf("#")?t.substring(0,t.indexOf("#")):t,0==a){var r=13;return $.map({"^/$":0,"^/show/$":1,"^/movie/$":3,"^/tv/$":2,"^/cartoon/$":4,"^/child/$":5,"^/music/$":6,"^/live/$":7,"^/v/\\d{1,3}/\\d+/$":10,"^/v/\\d{1,3}/\\d+/[a-z]/\\d+\\.html$":11},function(e,i){var o=!1,n=new RegExp(i);try{o=n.test(s)}catch(t){}o&&(r=e)}),r}return a||13};function T(e){var i=new RegExp("(?:^|;+|\\s+)"+e+"=([^;]*)"),o=document.cookie.match(i);return o?o[1]:""}var e,o,N=function(e){e=e||"yyyyMMddhhmmss";var i=new Date,o={"M+":i.getMonth()+1,"d+":i.getDate(),"h+":i.getHours(),"m+":i.getMinutes(),"s+":i.getSeconds(),"q+":Math.floor((i.getMonth()+3)/3),S:i.getMilliseconds()};for(var n in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(i.getFullYear()+"").substr(4-RegExp.$1.length))),o)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?o[n]:("00"+o[n]).substr((""+o[n]).length)));return e},U=(e=/[xy]/g,o=function(e){var i=16*Math.random()|0;return("x"==e?i:3&i|8).toString(16)},function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(e,o).toUpperCase()}),z=function(e,i){var o,n;$(e);o=$("span[node-type=honey-mini-"+i+"-auto]");var t=['<a href="#" hz=""></a>','<a href="#" hz="@qq.com"></a>','<a href="#" hz="@163.com"></a>','<a href="#" hz="@126.com"></a>','<a href="#" hz="@sina.com"></a>','<a href="#" hz="@sohu.com"></a>','<a href="#" hz="@gmail.com"></a>'].join("");o.html(t),(n=o.find("a")).mousedown(function(){n.removeClass("hover"),$(this).addClass("hover"),$(e).val($(this).text()),o.hide()}),a.on("keyup",e,function(e){if(""==$(this).val()&&(o.hide(),n.html("")),/13|38|40|116/.test(e.keyCode)||""==$(this).val())return!1;var i=$(this).val();n.each(function(){this.innerHTML=(i.replace(/\@+.*/,"@")+$(this).attr("hz")).replace(/\@+/,"@"),0<=this.innerHTML.indexOf(i)?$(this).show():$(this).hide()}).filter(".hover").removeClass("hover"),o.show(),0==n.filter(":visible").length?o.hide():n.filter(":visible").eq(0).addClass("hover")}).keydown(function(e){38==e.keyCode?n.filter(".hover").prev().addClass("hover").next().removeClass("hover"):40==e.keyCode?n.filter(".hover").next().addClass("hover").prev().removeClass("hover"):13==e.keyCode&&(n.filter(".hover").mousedown(),e.preventDefault())}),a.on("blur",e,function(e){o.hide()})},R=function(e){var i="";for(var o in e)""!=i&&(i+="&"),i+=o+"="+encodeURIComponent(e[o]);new Image(1,1).src="//pcweb-v1.log.mgtv.com/dispatcher.do?"+i};function D(e){m.show()}function K(e,i){i.text(e).show()}function L(e){e.hide().empty()}var r,t=!1,j=function(o){t||(t=new Messenger("parent","MessengerLogin")),t.listen(function(e){if(e){var i=$.parseJSON(e);$.isFunction(o)&&o(i),t.clear()}})},J={login:function(e){e.preventDefault();$(this);var i=f.find("#honey-mini-box-login"),o=i.find(".mini-login-name"),n=o.val(),t=i.find("#honey-mini-login-error"),a=i.find(".password"),s=i.find(".mini-login-yzm"),r=s.val(),c=a.val();if(""==$.trim(n))return K("帐号不能为空",t),o.focus(),!1;if(y={act:"login",time:N(),guid:T("MQGUID")||"",suuid:U(),uuid:T("uuid"),cookie:"",bid:"1.1.11",ch:"",url:encodeURIComponent(window.location.href),ext3:0,ext1:"",ext2:E(window.location.href),ext4:"",ext5:1},0<n.indexOf("@")){if(y.ext1=5,!/^([a-zA-Z0-9\_\.\-])+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/gi.test(n))return K("邮箱格式错误",t),o.focus(),!1}else{if(!v.test(n))return K("请输入正确的手机号码",t),o.focus(),!1;y.ext1=4}if(""==$.trim(c))return K("密码不能为空",t),a.focus(),!1;if("block"==g.css("display")&&""==$.trim(r))return K("验证码不能为空",t),s.focus(),!1;var l=0;$("input[node-type=honey-mini-login-auto]").is(":checked")&&(l=1,y.ext3=l),c=honey.encodePassword(c),L(t),D(),J.doAjaxLogin({username:n,password:c,vcode:r,rem:l})},doAjaxLogin:function(e){$("#honey-mini-login-submit").addClass("loading");var i=$("#honey-login-from"),o=$(".honey-login-from"),n="honey-login-from";if(0==i.length&&$('<iframe frameborder="0" height="0" name="'+n+'" id="'+n+'" width="0"/>').appendTo("body"),0==o.length){o=$('<form action="//i.mgtv.com/account/loginVerify" target="honey-login-from" method="post" class="honey-login-from"><input type="hidden" name="sub" value="1" /><input type="hidden" name="account" /><input type="hidden" name="pwd" /><input type="hidden" name="vcode" /><input type="hidden" name="remember" value="1" /></form>').appendTo("body")}$('[name="remember"]',o).val(e.rem),$('[name="account"]',o).val(e.username),$('[name="vcode"]',o).val(e.vcode),$('[name="pwd"]',o).val(e.password),o.submit(),j(function(e){J.succeed(e)})},succeed:function(e){if(200==e.code){f.destroy(),window.USER=e,p.trigger("HONEY-LOGIN-DONE"),p.trigger("HONEY-LOGIN-SUCCESS",{user:window.USER,type:"direct"}),window.OnJSCallbackGetUID&&OnJSCallbackGetUID.call(window,e.data.uid),R(y),f=null;var i={type:1,httpcode:200,retcode:e.code||"",opt:1},o={bid:"1.5.5.5",act:"DoLogin",pos:1,value:encodeURI(JSON.stringify(i))};try{if(!n&&window.STK)var n=new window.STK.start;n&&n.pageEvent(o)}catch(t){}}else if(-129==e.code){window.USER=e,d.loginCheckDialog(e);i={type:1,httpcode:-1,retcode:e.code||"",opt:1},o={bid:"1.5.5.5",act:"DoLogin",pos:1,value:encodeURI(JSON.stringify(i))};try{if(!n&&window.STK)n=new window.STK.start;n&&n.pageEvent(o)}catch(t){}}else{e.code,p.trigger("HONEY-LOGIN-ERR"),$("#honey-mini-login-error").html(e.msg).show(),$("#honey-mini-login-submit").removeClass("loading");i={type:1,httpcode:-1,retcode:e.code||"",opt:1},o={bid:"1.5.5.5",act:"DoLogin",pos:1,value:encodeURI(JSON.stringify(i))};try{if(!n&&window.STK)n=new window.STK.start;n&&n.pageEvent(o)}catch(t){}$.ajax({url:"//i.mgtv.com/account/loginVerifyStatus",dataType:"jsonp",success:function(e){e&&200==e.code&&"success"==e.msg&&(1==e.data||2==e.data?($("img[node-type=mini-yzm-src]").attr("src",u+$.now()),$(".yzm-mod").show(),k=!0):($("img[node-type=mini-yzm-src]").attr("src",u+$.now()),$(".yzm-mod").hide(),k=!1))}})}}},G={login:function(e){e.preventDefault();$(this);var i=f.find("#honey-mini-box-login-message"),o=i.find("#honey-mini-mes-error"),n=i.find("[node-type=honey-mini-mes-phone]"),t=n.val(),a=i.find("[node-type=honey-mini-mes-code]"),s=a.val(),r=$("b[node-type=honey-mini-area-county]").html(),c=parseInt(r),l=i.find("[node-type=meslogin-code]"),d=l.val();return""==$.trim(t)?(K("手机号不能为空",o),n.focus(),!1):(y={act:"login",time:N(),guid:T("MQGUID")||"",suuid:U(),uuid:T("uuid"),cookie:"",bid:"1.1.11",ch:"",url:encodeURIComponent(window.location.href),ext3:0,ext1:"",ext2:E(window.location.href),ext4:"",ext5:1},v.test(t)?(y.ext1=4,""==$.trim(d)?(K("验证码不能为空",o),l.focus(),!1):""==$.trim(s)?(K("校验码不能为空",o),a.focus(),!1):(L(o),void G.doAjaxLogin({mobile:t,code:s,codeimg:d,county:c}))):(K("请输入正确的手机号码",o),n.focus(),!1))},doAjaxLogin:function(e){$("#honey-mini-mes-login-submit").addClass("loading"),$.ajax({url:i+"/account/mobileLogin",data:{mobile:e.mobile,code:e.code,county:e.county},type:"get",dataType:"jsonp",success:function(e){if(200==e.code){f.destroy(),window.USER=e,p.trigger("HONEY-LOGIN-DONE"),p.trigger("HONEY-LOGIN-SUCCESS",{user:window.USER,type:"direct"}),window.OnJSCallbackGetUID&&OnJSCallbackGetUID.call(window,e.data.uid),R(y),f=null;var i={type:2,httpcode:200,retcode:e.code||"",opt:1},o={bid:"1.5.5.5",act:"DoLogin",pos:1,value:encodeURI(JSON.stringify(i))};try{if(!n&&window.STK)var n=new window.STK.start;n&&n.pageEvent(o)}catch(t){}}else if(-129==e.code){window.USER=e,d.loginCheckDialog(e);i={type:2,httpcode:-1,retcode:e.code||"",opt:1},o={bid:"1.5.5.5",act:"DoLogin",pos:1,value:encodeURI(JSON.stringify(i))};try{if(!n&&window.STK)n=new window.STK.start;n&&n.pageEvent(o)}catch(t){}}else{p.trigger("HONEY-LOGIN-ERR"),$("#honey-mini-mes-error").removeClass("ok-ts").html(e.msg).show(),$("#honey-mini-mes-login-submit").removeClass("loading");i={type:2,httpcode:-1,retcode:e.code||"",opt:1},o={bid:"1.5.5.5",act:"DoLogin",pos:1,value:encodeURI(JSON.stringify(i))};try{if(!n&&window.STK)n=new window.STK.start;n&&n.pageEvent(o)}catch(t){}}}})}},_={check:function(e,i){var o=S.find(".login-check-dialog-two"),n=o.find(".user-phone"),t=o.find(".phone-check-yzm"),a=n.attr("mobile")?n.attr("mobile"):n.val(),s=t.val(),r=S.find(".merr-ts");function c(e){r.html(e).removeClass("ok-ts").show()}return""==$.trim(a)?(c("手机号码不能为空"),n.focus(),!1):v.test(a)?""==$.trim(s)?(c("校验码不能为空"),t.focus(),!1):(r.hide(),void _.doAjaxLogin({phone:a,code:s,is_relate_mobile:e,rtoken:i})):(c("请输入正确的手机号码"),n.focus(),!1)},doAjaxLogin:function(e){var a=S.find(".merr-ts");$.ajax({url:i+"/account/exceptionLogin",data:{phone:e.phone,code:e.code,is_relate_mobile:e.is_relate_mobile,rtoken:e.rtoken},type:"get",dataType:"jsonp",success:function(e){if(200==e.code&&"success"==e.msg){_.succeed(e);var i={type:1,httpcode:200,retcode:e.code||"",opt:1},o={bid:"1.5.5.5",act:"DoLogin",pos:1,value:encodeURI(JSON.stringify(i))};try{if(!n&&window.STK)var n=new window.STK.start;n&&n.pageEvent(o)}catch(t){}}else{a.html(e.msg).removeClass("ok-ts").show();i={type:1,httpcode:-1,retcode:e.code||"",opt:1},o={bid:"1.5.5.5",act:"DoLogin",pos:1,value:encodeURI(JSON.stringify(i))};try{if(!n&&window.STK)n=new window.STK.start;n&&n.pageEvent(o)}catch(t){}}}})},succeed:function(e){S.find(".login-check-dialog-two").hide(),S.find(".login-check-dialog-three").show();var i=S.find(".login-check-dialog-three-clock"),o=3;setInterval(function(){0==--o?(S.destroy(),window.USER=e,p.trigger("HONEY-LOGIN-DONE"),p.trigger("HONEY-LOGIN-SUCCESS",{user:window.USER,type:"direct"}),window.OnJSCallbackGetUID&&OnJSCallbackGetUID.call(window,e.data.uid)):i.html(o+"S 后关闭")},1e3)}},M={registe:function(e){e.preventDefault();$(this);var i=f.find("#honey-mini-box-register"),o=i.find(".honey-mini-register-yzm"),n=i.find(".register-name"),t=n.val(),a=i.find(".register-password"),s=i.find(".phone-yzm"),r=a.val(),c=o.val(),l=f.find("li[node-type=honey-mini-register-btn]"),d=f.find("a[node-type=honey-mini-reg-gotoEmail]"),m=f.find("em[node-type=honey-mini-email-name]"),p=i.find("span[action-type=honey-mini-reg-email]").attr("type"),h=$("#honey-mini-register-error"),g=$("#honey-mini-license");function y(e){h.html(e).removeClass("ok-ts").show()}return w={act:"register",time:N(),guid:T("MQGUID")||"",suuid:U(),uuid:T("uuid"),cookie:"",bid:"1.1.11",ch:"",url:encodeURIComponent(window.location.href),ext1:"",ext2:E(window.location.href)},""==$.trim(t)?(y("账号不能为空"),n.focus(),!1):"phone"!=p?(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/.test(t)?""==$.trim(c)?(y("验证码不能为空"),o.focus()):g.attr("checked")?(h.hide(),w.ext1=2,$.getJSON("//i.mgtv.com/account/sendRegEmail?callback=?",{email:t,vcode:c},function(e){e&&200==e.code?(R(w),d.attr("href",I[t.split("@")[1]]),m.html(t),i.hide(),l.attr("type","email"),$("#honey-mini-box-email").show()):(-109==e.code&&n.focus(),$("img[node-type=mini-yzm-src]").attr("src",u+$.now()),y(e.msg))})):y("请您勾选用户协议"):(y("邮箱格式错误"),n.focus()),!1):v.test(t)?""==$.trim(r)?(y("密码不能为空"),a.focus(),!1):r.length<6?(y("密码为6-20位，且仅限使用数字、字母或符号"),a.focus(),!1):""==$.trim(o.val())?(y("验证码不能为空"),o.focus(),!1):""==$.trim(s.val())?(y("短信验证码不能为空"),s.focus(),!1):g.attr("checked")?(w.ext1=1,h.hide(),r=honey.encodePassword(r),L(h),D(),void M.doAjaxLogin({account:t,password:r,mobileCode:s.val()})):(y("请您勾选用户协议"),!1):(y("请输入正确的手机号码"),n.focus(),!1)},doAjaxLogin:function(e){$("#honey-mini-register").addClass("loading");var i=$("#honey-login-from"),o=$(".honey-register-from"),n="honey-login-from";if(0==i.length&&$('<iframe frameborder="0" height="0" name="'+n+'" id="'+n+'" width="0"/>').appendTo("body"),0==o.length){o=$('<form action="//i.mgtv.com/account/mobileReg" target="honey-login-from" method="post" class="honey-register-from"><input type="hidden" name="sub" value="1" /><input type="hidden" name="account" /><input type="hidden" name="password" /><input type="hidden" name="mobileCode" value="" /></form>').appendTo("body")}$('[name="account"]',o).val(e.account),$('[name="password"]',o).val(e.password),$('[name="mobileCode"]',o).val(e.mobileCode),o.submit(),j(function(e){M.succeed(e)})},succeed:function(e){var i=$("#honey-mini-register-error");if(200==e.code){M.regSuccess(e.data.nickname),window.USER=e,p.trigger("HONEY-LOGIN-DONE"),p.trigger("HONEY-LOGIN-SUCCESS"),window.OnJSCallbackGetUID&&OnJSCallbackGetUID.call(window,e.data.uid),R(w);var o={httpcode:200,retcode:e.code||""},n={bid:"1.5.5.5",act:"MgAccountReg",pos:1,value:encodeURI(JSON.stringify(o))};try{if(!t&&window.STK)var t=new window.STK.start;t&&t.pageEvent(n)}catch(a){}}else{p.trigger("HONEY-LOGIN-ERR"),i.html(e.msg).removeClass("ok-ts").show(),$("#honey-mini-register").removeClass("loading"),h.attr("src",u+$.now());o={httpcode:-1,retcode:e.code||""},n={bid:"1.5.5.5",act:"MgAccountReg",pos:1,value:encodeURI(JSON.stringify(o))};try{if(!t&&window.STK)t=new window.STK.start;t&&t.pageEvent(n)}catch(a){}}},regSuccess:function(e){var i=$("div[node-type=honey-mini-dialog-box]"),o=$("div[node-type=honey-mini-dialog-suc]");$("em[node-type=honey-mini-suc-name]").html(e),i.hide(),o.show();var n=3;setInterval(function(){if(0==--n)return f.destroy(),f=null,!1;$("em[node-type=honey-mini-suc-time]").html(n+"s")},1e3)}},A=function(){var s=!1,i=0;N(),T("MQGUID"),U(),T("uuid"),encodeURIComponent(window.location.href),E(window.location.href);function o(e){clearTimeout(s),e&&0==e.err&&"00000"==e.status&&("waiting"!==c&&($(".m-form-image").removeClass("repeat"),$(".m-erweima-image").attr("src",e.msg.pic_url),window.erweiUID=e.msg.uid||"",i=0),s=setTimeout(r,1e3))}function r(){if(62<++i)return clearInterval(s),i=0,void $(".m-form-image").removeClass("success").addClass("repeat");$.ajax({url:"//oauth.mgtv.com/2.0/polling?invoker=pc",data:{uid:window.erweiUID},type:"get",dataType:"jsonp",success:function(e){if(0==e.err&&"00000"==e.status)if("201"==e.msg.code){0==(t=e).err&&"00000"==t.status&&"201"==t.msg.code&&$.ajax({url:"//i.mgtv.com/account/getByTicket?",data:{ticket:t.msg.ticket},type:"get",dataType:"jsonp",success:function(e){200==e.code?(f.destroy(),window.USER=e,p.trigger("HONEY-LOGIN-DONE"),p.trigger("HONEY-LOGIN-SUCCESS",{user:window.USER,type:"qrcode"}),window.OnJSCallbackGetUID&&OnJSCallbackGetUID.call(window,e.data.uid),f=null):(-102==e.code&&$("#honey-mini-login-auto").focus(),p.trigger("HONEY-LOGIN-ERR"),$("#honey-mini-login-error").html(e.msg).show(),$("#honey-mini-login-submit").removeClass("loading"),$("img[node-type=mini-yzm-src]").attr("src",u+$.now()))}}),c="success";var i={type:10,httpcode:200,retcode:e.msg.code||"",opt:2},o={bid:"1.5.5.5",act:"DoLogin",pos:1,value:encodeURI(JSON.stringify(i))};try{if(!n&&window.STK)var n=new window.STK.start;n&&n.pageEvent(o)}catch(a){}}else"203"==e.msg.code?(s=setTimeout(r,3e3),c="fail"):"208"==e.msg.code&&($(".m-form-image").addClass("success"),s=setTimeout(r,3e3),c="waiting");else 1==e.err&&"10045"==e.status&&($(".m-form-image").removeClass("success").addClass("repeat"),c="expire");var t}})}return{init:function(){var a,e;a=o,e="//oauth.mgtv.com/2.0/getqrcode?invoker=pc&deviceid="+(""==T("__STKUUID")?"0":T("__STKUUID"))+"&callback=?",$.ajax({url:e,dataType:"jsonp",timeout:2e3,success:function(e){if(e&&0==e.err&&"00000"==e.status){var i={type:10,httpcode:200,retcode:e.status||""},o={bid:"1.5.5.5",act:"PreLogin",pos:1,value:encodeURI(JSON.stringify(i))};try{if(!n&&window.STK)var n=new window.STK.start;n&&n.pageEvent(o)}catch(t){}$.isFunction(a)&&a.call(this,e)}else{$(".m-form-image").addClass("repeat").find(".m-repeat-image-intro").text("二维码获取失败，请点击刷新"),i={type:10,httpcode:-1,retcode:e.status||""},o={bid:"1.5.5.5",act:"PreLogin",pos:1,value:encodeURI(JSON.stringify(i))};try{!n&&window.STK&&(n=new window.STK.start),n&&n.pageEvent(o)}catch(t){}}},error:function(e,i){var o={bid:"1.5.5.5",act:"PreLogin",pos:1,value:encodeURI(JSON.stringify({type:10,httpcode:"",retcode:""}))};try{if(!n&&window.STK)var n=new window.STK.start;n&&n.pageEvent(o)}catch(t){}}})},stopInquiry:function(){clearTimeout(s),i=0}}}(),H=0;function q(){if(240<++H){K("登录失败",f.find("#honey-mini-login-error")),clearTimeout(r),H=0,m.hide();var e={type:C[l],httpcode:"",retcode:"",opt:2},i={bid:"1.5.5.5",act:"DoLogin",pos:1,value:encodeURI(JSON.stringify(e))};try{if(!o&&window.STK)var o=new window.STK.start;o&&o.pageEvent(i)}catch(t){}}else $.getJSON(n,function(e){if(e.code<0&&(clearTimeout(r),r=setTimeout(q,1e3)),200==~~e.code){f.destroy(),clearTimeout(r),H=0,window.USER=e,p.trigger("HONEY-LOGIN-DONE"),p.trigger("HONEY-LOGIN-SUCCESS",{user:window.USER,type:l}),window.OnJSCallbackGetUID&&OnJSCallbackGetUID.call(window,e.data.uid),f=null;var i={type:C[l],httpcode:200,retcode:e.code||"",opt:2},o={bid:"1.5.5.5",act:"DoLogin",pos:1,value:encodeURI(JSON.stringify(i))};try{if(!n&&window.STK)var n=new window.STK.start;n&&n.pageEvent(o)}catch(t){}}})}function Y(e){e.preventDefault();var i=$(this).attr("type");window.loginType&&"change"==window.loginType&&$.getJSON("//i.mgtv.com/account/logout?jsonp=1&callback=?",function(e){});var o,n=""==T("__STKUUID")?"0":T("__STKUUID"),t=0<=(o=navigator.userAgent.toLowerCase()).indexOf("msie")?"IE":0<=o.indexOf("chrome")?"Chrome":0<=o.indexOf("firefox")?"Firefox":0<=o.indexOf("opera")?"opera":0<=o.indexOf("safari")?"safari":0<=o.indexOf("mozilla")?"mozilla":"other",a="//oauth.mgtv.com/2.0/"+{100:"qq",110:"tencent",200:"weibo",300:"wechat"}[i]+"/login?invoker=pc&type=1&from="+location.protocol+"//i.mgtv.com&deviceid="+n+"&dname="+t;300==~~i&&(a="//oauth.mgtv.com/2.0/wechat/login?invoker=pc&type=1&from="+location.protocol+"//i.mgtv.com&deviceid="+n+"&dname="+t);window.open(a,"_blank","width=750, height=525");setTimeout(q,3e3),D();y.ext1={100:1,200:3,300:2}[i],R(y);var s={type:C[l=i],httpcode:"",retcode:"",msg:"后续Dologin无法感知"},r={bid:"1.5.5.5",act:"PreLogin",pos:1,value:encodeURI(JSON.stringify(s))};try{if(!c&&window.STK)var c=new window.STK.start;c&&c.pageEvent(r)}catch(e){}}d.loginDialog=function(e,i,o){e&&""!==e&&(window.loginType=e),f||((f=new d.dialog({id:"honey-mini-login-dialog",html:x,content:O,width:620,opacity:.5})).init(),f.find("#honey-mini-login-submit").click(J.login),f.find("#honey-mini-mes-login-submit").click(G.login),f.find("ul[node-type=honey-mini-third] a").click(Y),f.find(".mini-login-yzm").keyup(function(e){"13"==(e.keyCode?e.keyCode:e.which)&&f.find("#honey-mini-login-submit").trigger("click")}),f.find(".login-dialog-password").keyup(function(e){k||"13"==(e.keyCode?e.keyCode:e.which)&&f.find("#honey-mini-login-submit").trigger("click")}),$.fn.placeholder&&f.find("input").placeholder(),h=f.find("img[node-type=mini-yzm-src]"),$("[action-type=mini-yzm-refresh]").click(function(){h.attr("src",u+$.now())}),h.click(function(){$(this).attr("src",u+$.now())}),f.find("#honey-mini-register").click(M.registe),f.find(".phone-yzm").keyup(function(e){"13"==(e.keyCode?e.keyCode:e.which)&&f.find("#honey-mini-register").trigger("click")}),f.find(".text").blur(function(e){$("#honey-mini-register-error,#honey-mini-login-error,#honey-mini-mes-error").hide()}),m=f.find("#honey-login-loading")),$("[node-type=honey-mini-dialog-saoma]").hide(),$(".m-saoma-icon").show(),$(".c-union-login-simple").show(),i&&"register"==i?($("[action-type=honey-mini-login-tabs]").removeClass("current").hide(),$("[node-type=honey-mini-register-btn-tabs]").addClass("current").show(),$(".honey-mini-dialog").hide(),$("[node-type=honey-mini-box-register]").show(),$(".m-backto-login").show()):($("[node-type=honey-mini-register-btn]").show(),$("[node-type=honey-mini-register-btn-tabs]").removeClass("current").hide(),$("[node-type=honey-mini-login-account-tabs]").addClass("current").show(),$("[node-type=honey-mini-login-mes-btn]").removeClass("current").show(),$(".honey-mini-dialog").hide(),$("[node-type=honey-mini-box-login]").show()),p.trigger("HONEY-LOGIN-SHOW");try{if(!n&&window.STK)var n=new window.STK.start;if(n){var t={act:"pv",url:"http://www.mgtv.com/bdsfm/login",ref:window.location.href,bid:isPad?"4.1.1":"1.1.2",cid:window.VIDEOINFO?window.VIDEOINFO.rid:"",plid:window.VIDEOINFO?window.VIDEOINFO.cid:"",vid:window.VIDEOINFO?window.VIDEOINFO.vid:"",ext1:o&&o.entrance?o.entrance:"",ext2:""};i&&"register"==i&&(t.url="http://www.mgtv.com/bdsfm/reg"),n.pageEvent(t,"//pcweb-v1.log.mgtv.com/dispatcher.do")}}catch(l){}var a,s,r;$.ajax({url:"//i.mgtv.com/account/loginVerifyStatus",dataType:"jsonp",success:function(e){e&&200==e.code&&"success"==e.msg&&(1==e.data||2==e.data?($("img[node-type=mini-yzm-src]").attr("src",u+$.now()),$(".yzm-mod").show(),k=!0):($("img[node-type=mini-yzm-src]").attr("src",u+$.now()),$(".yzm-mod").hide(),k=!1))}}),m&&m.hide(),"saoma"==b&&A.init(),f.open(),z("#honey-mini-reg-auto","reg"),z("#honey-mini-login-auto","login"),s=[[(a="//i5.hitv.com/s1/2017/userimg/")+"dialog_1.jpg","#fff"],[a+"dialog_2.jpg","#fff"],[a+"dialog_3.jpg","#fff"],[a+"dialog_4.jpg","#fff"]],r=Math.round(Math.random()*(s.length-1)),$("span[node-type=honey-top-bg]").css("background-image","url("+s[r][0]+")");var c=T("loginAccount");c&&""!==c&&f.find("#honey-mini-login-auto").val(decodeURIComponent(c))},d.loginCheckDialog=function(e){f.destroy(),f=null;var i="",o=0;if((""==e.data.relate_mobile?(i="绑定",o=0):(i="验证",o=1),!S)&&((S=new d.dialog({id:"honey-mini-login-check-dialog",content:s,width:560,height:320,opacity:.5})).init(),S.find(".title").html(i),"624"==e.data.status&&S.find(".merr-tips").html("您本次登录地区为非常用登录地区，请验证手机后登录"),S.find("#login-check-first-btn").click(function(e){S.find(".login-check-dialog-first").hide(),S.find(".login-check-dialog-two").show()}),S.find(".login-check-yzm-btn").attr("hasMobile",o),S.find(".login-check-submit").click(function(){_.check(o,e.data.rtoken)}),""!==e.data.relate_mobile)){var n=e.data.relate_mobile,t=n.substring(0,4)+"****"+n.substring(8);S.find("#phone-name").attr({disabled:"true",mobile:e.data.relate_mobile}),S.find("#phone-name").val(t)}S.open()},a.on("click","[action-type=honey-mini-login-tabs]",function(e){e.preventDefault();var i=$(this).attr("type");A.stopInquiry(),$("[node-type=tab-nav]").children("li").removeClass("current").hide(),"register"==i?($("[node-type=honey-mini-register-btn-tabs]").addClass("current").show(),$("a.m-saoma-icon").hide(),$("[action-type=register-account-yzm]").attr("src",u+$.now()),b="register"):"login"==i?($("[node-type=honey-mini-register-btn]").show(),$("[node-type=honey-mini-login-account-tabs]").addClass("current").show(),$("[node-type=honey-mini-login-mes-btn]").show(),$("a.m-saoma-icon").show(),$("[action-type=login-accout-yzm]").attr("src",u+$.now()),b="login"):($("[node-type=honey-mini-login-account-tabs]").show(),$("[node-type=honey-mini-login-mes-btn]").addClass("current").show(),$("a.m-saoma-icon").hide(),$("[action-type=meslogin-img]").attr("src",u+$.now()),b="loginmes"),$(".honey-mini-dialog").hide(),$("div[node-type=honey-mini-box-"+i+"]").show(),$("div.c-union-login-simple").show(),$("div[node-type=honey-mini-dialog-saoma]").hide()}),a.on("click","span[action-type=honey-mini-reg-email]",function(e){var i=$(this);$("p[node-type=mini-register-type]").html("邮箱"),$("input[node-type=honey-mini-reg-name]").attr({placeholder:"请输入邮箱",id:"honey-mini-reg-auto"}).val("").focus(),i.attr("action-type","mini-reg-phone"),i.html("手机注册"),i.attr("type","email"),$("p[node-type=honey-mini-phone-regcode]").hide(),$("p[node-type=honey-mini-reg-pas]").hide(),$("#honey-mini-register-error").hide(),h.attr("src",u+$.now())}),a.on("click","span[action-type=mini-reg-phone]",function(e){var i=$(this);$("p[node-type=mini-register-type]").html("手机"),i.attr("action-type","honey-mini-reg-email"),$("input[node-type=honey-mini-reg-name]").attr({placeholder:"请输入手机号码",id:"honey-mini-type-phone"}).val("").focus(),i.html("邮箱注册"),i.attr("type","phone"),$("p[node-type=honey-mini-phone-regcode]").show(),$("p[node-type=honey-mini-reg-pas]").show(),$("#honey-mini-pass-safe").hide(),h.attr("src",u+$.now())}),a.on("keyup","input[node-type=honey-mini-reg-safe]",function(e){var i=new RegExp("^(?=.{8,})(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])(?=.*\\W).*$","g"),o=new RegExp("^(?![d]+$)(?![a-zA-Z]+$)(?![^da-zA-Z]+$).{6,20}$"),n=new RegExp("(?=.{6,}).*","g"),t=$("em[node-type=honey-mini-line]"),a=$("#honey-mini-pass-safe");0<$(this).val().length?a.slideDown():a.slideUp(),0==n.test($(this).val())?t.removeClass("step"):i.test($(this).val())?(t.removeClass("step"),t.addClass("step")):o.test($(this).val())?(t.removeClass("step"),$("em",a).each(function(e){1<e||$(this).addClass("step")})):(t.removeClass("step"),a.find(".row-line").first().addClass("step"))}),a.on("click","span[action-type=honey-mini-get-pollcode]",function(t){t.preventDefault();var a=$(this),s=60,e=$("input[node-type=honey-mini-reg-name]"),i=e.val(),r=$("#honey-mini-register-error"),o=$(".honey-mini-register-yzm");if(""==i)return r.html("手机号不能为空").removeClass("ok-ts").show(),void $("input[node-type=honey-mini-reg-name]").focus();if(!v.test(i))return r.html("请输入正确的手机号码").removeClass("ok-ts").show(),e.focus(),!1;if(""==o.val())return r.html("请输入验证码").removeClass("ok-ts").show(),o.focus(),!1;var n={phone:i,vcode:o.val()};if(a.data("lock"))return!1;a.data("lock",!0);var c=setInterval(function(){0==--s?(a.html("获取验证码"),clearInterval(c),s=0,a.data("lock",!1)):a.html(s+"s")},1e3);$.getJSON("//i.mgtv.com/account/sendRegMobileCode?callback=?",n,function(e){if(e&&200==e.code){r.addClass("ok-ts").html("校验码发送成功").show();var i={type:0,httpcode:200,retcode:e.code||""},o={bid:"1.5.5.5",act:"VerifySMSGet",pos:1,value:encodeURI(JSON.stringify(i))};try{if(!n&&window.STK)var n=new window.STK.start;n&&n.pageEvent(o)}catch(t){}}else{i={type:0,httpcode:-1,retcode:e.code||""},o={bid:"1.5.5.5",act:"VerifySMSGet",pos:1,value:encodeURI(JSON.stringify(i))};try{if(!n&&window.STK)n=new window.STK.start;n&&n.pageEvent(o)}catch(t){}a.data("lock",!1),clearInterval(c),s=0,a.html("获取校验码"),r.html(e.msg).removeClass("ok-ts").show(),h.attr("src",u+$.now())}})}),a.on("click","a.login-check-yzm-btn",function(t){t.preventDefault();var a=$(this),s=60,e=S.find(".login-check-dialog-two").find(".user-phone"),i=e.attr("mobile")?e.attr("mobile"):e.val(),r=S.find(".merr-ts");function c(e){r.html(e).removeClass("ok-ts").show()}if(""==$.trim(i))return c("手机号码不能为空"),e.focus(),!1;if(!v.test(i))return c("请输入正确的手机号码"),e.focus(),!1;var o={phone:i,is_relate_mobile:a.attr("hasMobile")};if(a.data("lock"))return!1;a.data("lock",!0);var l=setInterval(function(){0==--s?(a.html("获取验证码").removeClass("yzm-b1"),r.hide(),clearInterval(l),s=0,a.data("lock",!1)):(a.html(s+"秒后重新获取"),a.addClass("yzm-b1"))},1e3);$.getJSON("//i.mgtv.com/account/sendMobileCode?callback=?",o,function(e){if(e&&200==e.code){r.addClass("ok-ts").html("校验码发送成功").show();var i={type:1,httpcode:200,retcode:e.code||""},o={bid:"1.5.5.5",act:"VerifySMSGet",pos:1,value:encodeURI(JSON.stringify(i))};try{if(!n&&window.STK)var n=new window.STK.start;n&&n.pageEvent(o)}catch(t){}}else{i={type:1,httpcode:-1,retcode:e.code||""},o={bid:"1.5.5.5",act:"VerifySMSGet",pos:1,value:encodeURI(JSON.stringify(i))};try{if(!n&&window.STK)n=new window.STK.start;n&&n.pageEvent(o)}catch(t){}a.data("lock",!1),clearInterval(l),s=0,a.html("获取校验码").removeClass("yzm-b1"),c(e.msg)}})}),a.on("click","[action-type=meslogin-refresh]",function(e){$("[action-type=meslogin-img]").attr("src",u+$.now())}),a.on("click","[action-type=meslogin-img]",function(e){$(this).attr("src",u+$.now())});var V=!0;a.on("click","a[action-type=honey-mini-reset-email]",function(e){e.preventDefault(),$("li[node-type=honey-mini-register-btn]").attr("type","register"),$("#honey-mini-box-email").hide(),$("#honey-mini-box-register").show(),$("em[action-type=honey-mini-reset-send]").html("重新发送").addClass("ico-re"),h.attr("src",u+$.now()),V=!0}),a.on("click","em[action-type=honey-mini-reset-send]",function(e){var i=$("em[node-type=honey-mini-email-name]").html(),o=$(this);if(!V)return!1;$.getJSON("//i.mgtv.com/account/resendRegEmail?callback=?",{email:i},function(e){V=!1,e&&200==e.code?(o.html("发送成功").addClass("ico-ok"),setTimeout(function(){o.html("重新发送").removeClass("ico-ok").addClass("ico-re"),V=!0},4e3)):(V=!1,o.html(e.msg).removeClass("ico-ok ico-re"))})}),a.on("click touchstart","a.m-saoma-icon",function(e){e.preventDefault(),A.init();var i=$("div[node-type=honey-mini-dialog-saoma]"),o=$("div[node-type=honey-mini-box-login]"),n=$("div.c-union-login-simple");$(this).hide(),n.hide(),o.hide(),i.show(),b="saoma"}),a.on("click touchstart","a.m-back-login",function(e){e.preventDefault();var i=$("a.m-saoma-icon"),o=$("div[node-type=honey-mini-dialog-saoma]"),n=$("div[node-type=honey-mini-box-login]"),t=$("div.c-union-login-simple");i.show(),t.show(),n.show(),o.hide(),b="login",A.stopInquiry()}),a.on("click touchstart",".m-repeat-image-bg, .m-repeat-image-intro",function(e){e.preventDefault(),A.init()}),a.on("click touchstart",".c-header-user-loginout,a[action-type=u-header-loginout]",function(e){var i={bid:"1.5.5.5",act:"logout",pos:1,value:encodeURI(JSON.stringify({httpcode:"",retcode:""}))};try{if(!o&&window.STK)var o=new window.STK.start;o&&o.pageEvent(i)}catch(e){}}),a.on("click touchstart",".honey-dialog-destroy",function(){return f&&f.close(),S&&(S.destroy(),S=null),A.stopInquiry(),!1}),a.on("click","a[node-type=honey-mini-mes-getcode]",function(t){t.preventDefault();var a=$(this),s=60,e=$("input[node-type=honey-mini-mes-phone]"),i=e.val(),o=$("b[node-type=honey-mini-area-county]").html(),n=parseInt(o),r=$("#honey-mini-mes-error"),c=$("[node-type=meslogin-code]"),l=$("[node-type=meslogin-code]").val();if(""==i)return r.html("手机号不能为空").removeClass("ok-ts").show(),void e.focus();if(!v.test(i))return r.html("请输入正确的手机号码").removeClass("ok-ts").show(),e.focus(),!1;if(""==l)return r.html("验证码不能为空").removeClass("ok-ts").show(),void c.focus();var d={mobile:i,codeimg:l,county:n};if(a.data("lock"))return!1;a.data("lock",!0);var m=setInterval(function(){0==--s?(a.html("获取验证码"),clearInterval(m),s=0,a.data("lock",!1),a.removeClass("visited")):a.html(s+"s")},1e3);$.getJSON("//i.mgtv.com/account/mobileLoginCode?callback=?",d,function(e){if(e&&200==e.code){r.addClass("ok-ts").html("校验码发送成功").show(),a.addClass("visited");var i={type:2,httpcode:200,retcode:e.code||""},o={bid:"1.5.5.5",act:"VerifySMSGet",pos:1,value:encodeURI(JSON.stringify(i))};try{if(!n&&window.STK)var n=new window.STK.start;n&&n.pageEvent(o)}catch(t){}}else{a.data("lock",!1),clearInterval(m),s=0,a.html("获取校验码"),r.html(e.msg).removeClass("ok-ts").show(),$("[action-type=meslogin-img]").attr("src",u+$.now());i={type:2,httpcode:-1,retcode:e.code||""},o={bid:"1.5.5.5",act:"VerifySMSGet",pos:1,value:encodeURI(JSON.stringify(i))};try{if(!n&&window.STK)n=new window.STK.start;n&&n.pageEvent(o)}catch(t){}}})})});