"use strict";honey.def("lib:jquery",function(i){var n=$(document),t=function(i){var n=new RegExp("(?:^|;+|\\s+)"+i+"=([^;]*)"),e=document.cookie.match(n);return e?e[1]:""},o=function(i){var n="86";return 11==i.length?n="86":9==i.length?n="886":8==i.length&&(n=5==i[0]||6==i[0]||9==i[0]?"852":"853"),n};i.IdentityVerifyBox={init:function(){this.mount(),this.bindEvents()},mount:function(){$("body").append('\n    <link type="text/css" rel="stylesheet" href="//css.mgtv.com/imgotv-member/page/identify/dialog.css?version=20171016">\n    <div class="m-dialogid" id="identify-box" style="display:none;">\n        <div class="dgbox box1" style="display:none;">\n            <div class="hd">\n                <h2>实名认证</h2>\n            </div>\n            <div class="bd">\n                <p class="txt1">根据国家相关法规，发表评论、动态和弹幕等操作需要绑定手机完成实名认证</p>\n            </div>\n            <div class="ft">\n                <a class="cancel" href="javascript:;">稍后再验证</a>\n                <a class="confirm" href="javascript:;">去验证</a>\n            </div>\n            <a class="close" href="javascript:;">关闭</a>\n        </div>\n\n        <div class="dgbox box2" style="display:none;">\n            <div class="hd">\n                <h2>验证手机</h2>\n            </div>\n            <div class="bd">\n                <div class="cell">\n                    <div class="cellsbox">\n                        <div class="chd"><label class="label">手机</label></div>\n                        <div class="cbd"><input class="input" type="text" id="identify-mobile-input" placeholder="请输入手机号"></div>\n                    </div>\n                    <div class="cellsbox cellsbox-code">\n                        <div class="chd"><label class="label">校验码</label></div>\n                        <div class="cbd"><input class="input" type="text" id="identify-vcode-input" placeholder="请输入校验码"></div>\n                        <div class="ncode"><a href="javascript:;">获取校验码</a></div>\n                        <div class="ncode-t" style="display:none;"><span>60</span> 秒后重新获取</div>\n                    </div>\n                    <div class="cellsbox-erro"></div>\n                </div>\n            </div>\n            <div class="ft">\n                <a class="binding" href="javascript:;">验证</a>\n            </div>\n            <a class="close" href="javascript:;">关闭</a>\n        </div>\n\n        <div class="dgbox box3" style="display:none;">\n            <div class="hd">\n                <h2>手机验证成功</h2>\n            </div>\n            <div class="bd">\n                <p class="txt1" node-type="return-tips">该手机号仅作为身份验证，不可作为登录账号</p>\n            </div>\n            <div class="ft">\n                <a class="validate" href="javascript:;">确定</a>\n            </div>\n            <a class="close" href="javascript:;">关闭</a>\n        </div>\n    \n        <div class="mask" style="display:none;"></div>\n    </div>'),this.$box=$("#identify-box")},render:function(i){var n=$(document).height();this.$box.find(".dgbox").hide(),this.$box.find(".box"+i).show(),this.$box.find(".mask").css({height:n+"px"}).show(),this.$box.show()},tips:function(i){i?this.$box.find(".cellsbox-erro").addClass("cellsbox-show").html(i).show():this.$box.find(".cellsbox-erro").removeClass("cellsbox-show").hide()},sendVerifyCode:function(i,n){var e={invoker:"pc",mobile:i,smscode:o(i),operation:"certificate",deviceid:t("__STKUUID"),dname:"Chrome"};$.ajax({url:"//nuc.api.mgtv.com/GetMobileCode",dataType:"jsonp",data:e,jsonp:"callback",success:function(i){n&&n(i)}})},bindMobile:function(i,n,e){var s={invoker:"pc",ticket:t("HDCN").split("-")[0],mobile:i,mobilecode:n,smscode:o(i),deviceid:t("__STKUUID"),dname:"Chrome"};$.ajax({url:"//nuc.api.mgtv.com/VerifyMobileForCert",dataType:"jsonp",data:s,jsonp:"callback",success:function(i){e&&e(i)}})},close:function(){this.$box.hide(),this.tips(""),this.$box.find(".mask").hide()},bindEvents:function(){var t=this;n.on("identity.box.show",function(i,n){return t.render(1),!1}),t.$box.on("click",".cancel",function(i,n){return t.close(),!1}),t.$box.on("click",".confirm",function(i,n){return t.render(2),!1}),t.$box.on("click",".ncode",function(i,n){var e=$("#identify-mobile-input").val(),s=60;if(t.tips(""),0!=e.length){if(!(isNaN(e)||11!=e.length&&8!=e.length&&9!=e.length))return t.sendVerifyCode(e,function(n){if(n&&200==n.code){t.$box.find(".ncode").hide(),t.$box.find(".ncode-t").show(),t.$box.find(".ncode-t span").html(s);!function i(){var n=setTimeout(function(){1<--s?(t.$box.find(".ncode-t span").html(s),i()):(t.$box.find(".ncode").show(),t.$box.find(".ncode-t").hide(),n&&clearTimeout(n))},1e3)}()}else t.tips(n.msg||"发送校验码失败，请稍后再试")}),!1;t.tips("手机号码格式错误")}else t.tips("手机号码不能为空")}),t.$box.on("click",".binding",function(i,n){var e=$("#identify-mobile-input").val(),s=$("#identify-vcode-input").val();if(t.tips(""),0!=e.length)if(isNaN(e)||11!=e.length&&8!=e.length&&9!=e.length)t.tips("手机号码格式错误");else if(0!=s.length){if(!isNaN(s)&&6==s.length)return t.bindMobile(e,s,function(i){if(i&&200==i.code){if(t.render(3),i.data&&"verify"==i.data.optype)$("[node-type=return-tips]").html("该手机号仅作为身份验证，不可作为登录账号");else if(i.data&&"relate"==i.data.optype){var n=i.data.nickname||"";$("[node-type=return-tips]").html("该手机号已成功绑定账号"+n+"，可作为登录账号")}}else t.tips(i.msg||"验证手机失败，请稍后再试")}),!1;t.tips("验证码格式错误")}else t.tips("验证码不能为空");else t.tips("手机号码不能为空")}),t.$box.on("click",".close",function(i,n){return t.close(),t.$box.find("input").val(""),!1}),t.$box.on("click",".validate",function(i,n){return t.close(),!1})}},i.IdentityVerifyBox.init()});