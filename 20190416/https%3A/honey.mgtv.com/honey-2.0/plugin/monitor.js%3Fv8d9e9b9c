honey.def("monitor",function(o){"use strict";var e=Math.random(),c=(new Date).getTime(),w=function(){return e<.01},h=function(e,n){var o="";for(var i in n)-1!=n[i]&&(o+=i+"="+encodeURIComponent(n[i])+"&");return o=e+"?"+o.substring(0,o.length-1)};o.__onload=0,window.__jserror=0,window.onerror=function(){window.__jserror+=1};var n,i,T=(n=navigator.userAgent.toLowerCase(),i=/msie [\d.]+;/gi,window.ActiveXObject||"ActiveXObject"in window?{name:"ie",version:n.match(i)?n.match(i)[0].replace(/[^0-9.]/gi,""):11}:0<n.indexOf("firefox")?{name:"firefox",version:n.match(/firefox\/[\d.]+/gi)[0].replace(/[^0-9.]/gi,"")}:0<n.indexOf("chrome")?{name:"chrome",version:n.match(/chrome\/[\d.]+/gi)[0].replace(/[^0-9.]/gi,"")}:0<n.indexOf("safari")&&n.indexOf("chrome")<0?{name:"safari",version:n.match(/safari\/[\d.]+/gi)[0].replace(/[^0-9.]/gi,"")}:void 0),f=window.location?window.location.href.split("?")[0].replace("#",""):"",y="https:"==document.location.protocol?"https://bhm.log.mgtv.com/api/":"http://bhm.hunantv.com/api/",l="1.0.14";o.monitor=function(a){a.delay=a.delay||1e3,a.player_id=a.player_id||"hunantv-player-1";var d=y+"receive",m=0,_=function(e){var n=window.performance||window.webkitPerformance||window.msPerformance||window.mozPerformance;if(n===undefined)return{};var o=n.timing,i={};if(e=e||{},o){if(e&&!e.simple)for(var t in o)o.hasOwnProperty(t)&&(i[t]=o[t]);if(i.firstPaint===undefined){var r=0;window.chrome&&window.chrome.loadTimes?(r=1e3*window.chrome.loadTimes().firstPaintTime,i.firstPaintTime=r-1e3*window.chrome.loadTimes().startLoadTime):"number"==typeof window.performance.timing.msFirstPaint&&(r=window.performance.timing.msFirstPaint,i.firstPaintTime=r-window.performance.timing.navigationStart),e&&!e.simple&&(i.firstPaint=r)}i.dns=o.domainLookupEnd-o.domainLookupStart,i.tcp=o.connectEnd-o.connectStart,i.ttfb=o.responseStart-o.requestStart,i.navigationStart=o.navigationStart,i.loadTime=o.loadEventEnd-o.fetchStart,i.domReadyTime=o.domComplete-o.domInteractive,i.readyStart=o.fetchStart-o.navigationStart,i.redirectTime=o.redirectEnd-o.redirectStart,i.appcacheTime=o.domainLookupStart-o.fetchStart,i.unloadEventTime=o.unloadEventEnd-o.unloadEventStart,i.lookupDomainTime=o.domainLookupEnd-o.domainLookupStart,i.connectTime=o.connectEnd-o.connectStart,i.requestTime=o.responseEnd-o.requestStart,i.initDomTreeTime=o.domInteractive-o.responseEnd,i.loadEventTime=o.loadEventEnd-o.loadEventStart,i.dom_time=o.domContentLoadedEventEnd-o.navigationStart,i.load_time=o.loadEventEnd-o.navigationStart}return i},v=function(e){if(!window.performance.getEntriesByType)return 0;var n=$("img,embed"),o=window.innerHeight,i=[];e&&i.push(e);for(var t=0,r=n.length;t<r;t++){var a=n.eq(t);if(!(a.offset().top<o))break;i.push(a[0].src)}var d=window.performance.getEntriesByType("resource"),m=0;for(var s in i){var c=i[s];for(t=0;t<d.length;t++)if(-1<d[t].name.indexOf(c)){d[t].responseEnd>m&&(m=d[t].responseEnd);break}}return m},g=function(e){for(var n=e+"=",o=document.cookie.split(";"),i=0;i<o.length;i++){for(var t=o[i];" "==t.charAt(0);)t=t.substring(1);if(-1!=t.indexOf(n))return t.substring(n.length,t.length)}return 0},s=function(e){var n=document.getElementById(e);return n?-1!=navigator.appName.indexOf("Microsoft")?n:0<n.getElementsByTagName("embed").length?n.getElementsByTagName("embed")[0]:n:"noDom"},e=function(e){if(w()||e.test){var n,o=e.pageName?e.pageName:"index",i={resolution:window.screen.width+"*"+window.screen.height,page_name:o,version:e.version,cli_version:l};if(window.performance&&window.performance.timing.hasOwnProperty){var t=_(),r=v(e.first_view_bg);(new Date).valueOf(),e.resources&&e.resources;0<r&&0<t.dom_time&&0<t.load_time&&0<t.firstPaintTime&&(i=$.extend(i,{first_view:r,first_paint:t.firstPaintTime,dom_ready:t.dom_time,load_time:t.load_time}),i=window.__POSTMVPDATA?$.extend(i,{flash_js_load:window.__POSTMVPDATA-t.navigationStart}):i,i=window.__POSTMVPDATASTART?$.extend(i,{flash_js_load_start:window.__POSTMVPDATASTART-t.navigationStart}):i),i=$.extend(i,function(e){if(!window.performance.getEntriesByType)return null;for(var n={snail_name:"",snail_duration:0},o=window.performance.getEntriesByType("resource"),i=0;i<o.length;i++)n.snail_duration<o[i].duration&&(n.snail_name=o[i].name,n.snail_duration=o[i].duration),-1<o[i].name.indexOf("http://player.hunantv.com/mango-tv3-main/MangoTV_3.swf")&&0<o[i].duration&&(m=1);return n.snail_name&&(n.snail_name=n.snail_name.split("?").shift()),n}()),i=$.extend(i,{dns:t.dns,tcp:t.tcp,ttfb:t.ttfb})}i=!(i=!i.flash_js_load&&window.__POSTMVPDATA?$.extend(i,{flash_js_load:window.__POSTMVPDATA}):i).flash_js_load_start&&window.__POSTMVPDATASTART?$.extend(i,{flash_js_load_start:window.__POSTMVPDATASTART}):i,i=$.extend(i,{url:f,refer:document.referrer,hash:c,flash_load:(n=s(a.player_id),n&&n.OnFlashLoadSuccess?n.OnFlashLoadSuccess():"noDom"===n?2:0),flash_resource:m},e.extra,function(){var e=0,n=0;if(document.all)(o=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))&&(e=1,n=o.GetVariable("$version"));else if(navigator.plugins&&0<navigator.plugins.length){var o;(o=navigator.plugins["Shockwave Flash"])&&(e=1,n=o.description)}return{flash_installed:e,flash_version:n}}()),i=window.__POSTMVPDATAEND?$.extend(i,{flash_load_extra:window.__POSTMVPDATAEND}):i,i=window.__POSTMVPDATAIPAD?$.extend(i,{flash_load_extra:window.__POSTMVPDATAIPAD}):i,i=window.playerLen?$.extend(i,{playerLen:window.playerLen}):i,i=window.VIDEOINFO&&window.VIDEOINFO.mod?$.extend(i,{channel:window.VIDEOINFO.mod}):i,i=window.VIDEOINFO&&window.VIDEOINFO.title?$.extend(i,{title:window.VIDEOINFO.title}):i,(new Image).src=h(d,i)}},n=function(){var e=window.location.href.split("?")[0].replace("#","").replace("http://www.mgtv.com/","").split("/")[0],n=["","tv","show","movie","cartoon","child","music","ori","life","edu","doc","game","live","vip"],o=!1;for(var i in n)if(e==n[i]){o=!0;break}if(o&&!(.2<Math.random())){var t=g("sessionid"),r=!1,a=0;if(0<+t?(r=!0,a=1):Math.random()<.2&&(r=!0),r){var d=_(),m=function(e){if(!window.performance.getEntriesByType)return 0;var n=$("img,embed"),o=window.innerHeight,i=[],t=$("#honey-focus-big-image").attr("src"),r="";e&&i.push(e),t&&(i.push(t),r=t.split("_")[t.split("_").length-1]);for(var a=0,d=n.length;a<d;a++){var m=n.eq(a);if(!(m.offset().top<o))break;t?r&&-1==m[0].src.indexOf(r)&&i.push(m[0].src):i.push(m[0].src)}var s=window.performance.getEntriesByType("resource"),c=0,w="";for(var f in i){var l=i[f];for(a=0;a<s.length;a++)if(-1<s[a].name.indexOf(l)){s[a].responseEnd>c&&(c=s[a].responseEnd,w=l);break}}return{time:c,name:w}}(),s=Math.floor(v()),c=Math.floor(function(){if(!window.performance.getEntriesByName)return 0;var e=$("#honey-focus-big-image").attr("src");return e&&0<e.length?window.performance.getEntriesByName(e)[0].responseEnd:0}()),w=Math.floor(function(e){if(!window.performance.getEntriesByType)return 0;var n=$("img,embed"),o=window.innerHeight,i=[],t=$("#honey-focus-big-image").attr("src"),r="";e&&i.push(e),t&&(r=t.split("_")[t.split("_").length-1]);for(var a=0,d=n.length;a<d;a++){var m=n.eq(a);if(!(m.offset().top<o))break;t?r&&-1==m[0].src.indexOf(r)&&i.push(m[0].src):i.push(m[0].src)}var s=window.performance.getEntriesByType("resource"),c=0;for(var w in i){var f=i[w];for(a=0;a<s.length;a++)if(-1<s[a].name.indexOf(f)){s[a].responseEnd>c&&(c=s[a].responseEnd);break}}return c}()),f={},l=0;if(e||(e="index"),window.__tj)for(var i in l=d.navigationStart||__tj[0].time,__tj)f[__tj[i].name.split("/").pop()+"-"+i]=__tj[i].time-l;var p=y+"timeline/"+e,u={loadTime:d.load_time,residenceTime:g("residence_time"),onload:g("onLoad"),jserror:window.__jserror,browser:T.name,bversion:T.version,firstView:Math.floor(m.time),fve:encodeURIComponent(m.name),fvo:s,fvnb:w,bt:c,wh:window.innerHeight,sid:t,t:a};f=$.extend(f,u),(new Image).src=h(p,f)}}};!function(e){if(w()||e.test){var n={page_name:e.pageName?e.pageName:"index",cli_version:l};n=$.extend(n,{url:f,hash:c},e.extra),(new Image).src=h(y+"pv",n)}}(a),"底层"===a.pageName&&(a.delay=3e3),$(window).load(function(){window.setTimeout(function(){e(a),n()},a.delay)})},$(window).load(function(){o.__onload=1}),o.monitorPlayer=function(e,n){if(w()||1==n){window.performance&&window.performance.timing&&0<window.performance.timing.connectStart&&(e=(new Date).getTime()-window.performance.timing.connectStart);var o=y+"flash",i={load_time:e,url:f,hash:c,cli_version:l,cli_time:(new Date).getTime(),type:n||0};(new Image).src=h(o,i)}},o.monitorPlayerAd=function(e){o.monitorPlayerSend("ad",e)},o.monitorPlayerAdEnd=function(e){o.monitorPlayerSend("adend",e)},o.monitorPlayerVV=function(e){o.monitorPlayerSend("play",e)},o.monitorPlayerCMS=function(e){o.monitorPlayerSend("cms",e)},o.monitorPlayerDispatch=function(e){o.monitorPlayerSend("dispatch",e)},o.monitorPlayerVideoLoad=function(e){o.monitorPlayerSend("video",e)},o.monitorPlayerH5=function(e){o.monitorPlayerSend("h5",e)},o.monitorPlayerSend=function(e,n,o){if(w()||1==n){var i=y+"flash/"+e,t=$.extend({url:f,hash:c,cli_version:l,cli_time:(new Date).getTime(),type:n||0},o);(new Image).src=h(i,t)}},o.cdnStatus=function(){var i=new Image,t=(new Date).getTime(),r=0;window.performance&&window.performance.timing&&(r=performance.timing.domainLookupEnd-performance.timing.domainLookupStart),$.get("http://www.mgtv.com/do_not_delete/favicon.ico",null,function(e,n,o){if(clearTimeout(d),"success"==n){var i=(new Date).getTime()-t;a(!0,i)}else a(!1,"503"+o.status)});var a=function(e,n){var o="http://stv.log.mgtv.com/info.php?p=4&d="+r;o=e?o+"&e=&ti="+n+"&f=0":o+"&f=-1&e="+n,o=(o+="&cv=1.0.16")+"&u="+T.name,i.src=o},d=window.setTimeout(function(){a(!1,502e3)},3e3),m=0,s=function(){if(window.__monitorjs&&(window.__monitorjs.cdnImg||window.__monitorjs.cdnPlayer)){var e="http://stv.log.mgtv.com/info.php?p=4";if(e=(e+="&cv=1.0.17")+"&u="+T.name+"&x="+f,window.__monitorjs.cdnImg){var n=e+"&ti="+window.__monitorjs.cdnImg.t+"&f="+window.__monitorjs.cdnImg.f+"&e=",o=new Image;window.__monitorjs.cdnImg.e&&(n+=window.__monitorjs.cdnImg.e),n+="&l="+encodeURIComponent(window.__monitorjs.cdnImg.l),o.src=n}if(window.__monitorjs.cdnPlayer){n=e+"&ti="+window.__monitorjs.cdnPlayer.t+"&f="+window.__monitorjs.cdnPlayer.f+"&e=",o=new Image;window.__monitorjs.cdnPlayer.e&&(n+=window.__monitorjs.cdnPlayer.e),n+="&l="+encodeURIComponent(window.__monitorjs.cdnPlayer.l),o.src=n}}else m<3&&(m++,window.setTimeout(function(){s()},2e3))};s()},window.ActiveXObject||"ActiveXObject"in window||(window.onbeforeunload=function(){var e=window.performance||window.webkitPerformance||window.msPerformance||window.mozPerformance;if(e===undefined)return{};document.cookie="onLoad="+o.__onload+";";var n=(new Date).valueOf()-e.timing.navigationStart;return document.cookie="residence_time="+n+";",null})});