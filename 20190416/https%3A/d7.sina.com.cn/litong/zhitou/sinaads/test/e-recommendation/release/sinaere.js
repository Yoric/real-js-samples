/*!
 * sinaere
 * @author acelan <xiaobin8[at]staff.sina.com.cn>
 * @version 1.0.0
 * 
 *                          $$!   ;$;
 *                    !$  $$$$  !$$$   ;;
 *                 $ *$$;$$$$$$$$$$;*$$$
 *                $$$$$$$$$$$$$$$$$$$$$
 *               $$$$$$;         o$$$$$o
 *              *$$$   *#####;     $$$$$
 *              $$$   &#$*!###     $$$$!
 *              $$$;  $#!!###$   ;$$$$
 *                $$$o  ;**   !$$$$!
 *          !$&&&&$!  o$$$$$$o;   ;$&###&!     ;o$&&##&$;
 *       ###########$ o####*  #############!  o############
 *     ;#####;        #####  $####    *####;          ####*
 *      ###########  o####   ####;    ####$  $######;o####
 *          ;*#####o ####$  ####&    !#### o####     ####
 *    ####$**&####$ ;####  o####     ####o &####$o$#####
 *   ;o########$    *###   ####!    &####   ;######&!
 *                 ###;
 *                  ##o
 *                 ;#!
 *                 ;
 */

window._sinaereIsInited=window._sinaereIsInited||function(a,b){"use strict";var c=function(){function b(a){function b(){for(var b=0;b<c.length;b++){var d=c[b];try{d.apply(a.promise,a._args)}catch(e){}}}if("pending"!==a.state){var c="resolved"===a.state?a._doneCallbacks.slice():a._failCallbacks.slice();a.syncModeEnabled?b():f(b),a._doneCallbacks=[],a._failCallbacks=[]}}function c(a,b,c,d){return function(){if("function"==typeof c){var f=b.resolver;try{var g=c.apply(a.promise,arguments);e.isPromise(g)?g.then(f.resolve,f.reject):f.resolve(g)}catch(h){f.reject(h)}}else b[d].apply(b,a._args)}}function e(){this.state="pending",this._args=null,this._doneCallbacks=[],this._failCallbacks=[],this.promise={done:d.bind(this.done,this),fail:d.bind(this.fail,this),then:d.bind(this.then,this)},this.promise.promise=this.promise,this.resolver={resolve:d.bind(this.resolve,this),reject:d.bind(this.reject,this)}}var f="function"==typeof a.setImmediate?function(b){a.setImmediate(b)}:function(b){a.setTimeout(b,0)};return e.prototype={syncModeEnabled:!1,resolve:function(){"pending"===this.state&&(this.state="resolved",this._args=[].slice.call(arguments),b(this))},reject:function(){"pending"===this.state&&(this.state="rejected",this._args=[].slice.call(arguments),b(this))},done:function(a){return this.then(a)},fail:function(a){return this.then(null,a)},then:function(a,d){var f=new e;return f.syncModeEnabled=this.syncModeEnabled,this._doneCallbacks.push(c(this,f,a,"resolve")),this._failCallbacks.push(c(this,f,d,"reject")),b(this),f.promise}},e.isPromise=function(a){return a&&"function"==typeof a.then},e.all=function(){function a(a){f--;var b=[].slice.call(arguments,1);b.length<=1&&(b=b[0]),h[a]=b,0===f&&i[g].apply(i,h)}function b(){g="reject",a.apply(this,arguments)}var c=[].concat.apply([],arguments),f=c.length;if(!f)return e.resolved();for(var g="resolve",h=[],i=new e,j=0;j<c.length;j++){var k=c[j];k.then(d.bind(a,k,j),d.bind(b,k,j))}return i.promise},e.resolved=function(){var a=new e;return a.resolve.apply(a,arguments),a.promise},e.rejected=function(){var a=new e;return a.reject.apply(a,arguments),a.promise},e.when=function(a){if(e.isPromise(a))return a;var b=new e;return b.syncModeEnabled=!0,b.resolve(a),b.promise},e}(),d=function(){var b={},d=Function.prototype.bind;return b.bind=d?function(a){return d.apply(a,[].slice.call(arguments,1))}:function(a,b){var c=[].slice.call(arguments,2);return function(){var d=c.concat([].slice.call(arguments));return a.apply(b,d)}},b.noop=function(){},b.sio=b.sio||function(){function b(a,b,c){a.setAttribute("type","text/javascript"),c&&a.setAttribute("charset",c),a.setAttribute("src",b),document.getElementsByTagName("head")[0].appendChild(a)}function d(a){a&&a.parentNode&&a.parentNode.removeChild(a),a=null}return{jsonp:function(e,f){function g(b){return function(){try{b?i.reject():(i.resolve.apply(i,arguments),clearTimeout(h)),a[k]=null,delete a[k]}catch(c){}finally{d(j)}}}var h,i=new c,j=document.createElement("SCRIPT"),k="ere_callback"+Math.floor(2147483648*Math.random()).toString(36),l=f||{},m=l.charset||"utf-8",n=l.queryField||"callback",o=l.timeout||0,p=new RegExp("(\\?|&)"+n+"=([^&]*)");return a[k]=g(0),o&&(h=setTimeout(g(1),o)),e=e.replace(p,"$1"+n+"="+k),e.search(p)<0&&(e+=(e.indexOf("?")<0?"?":"&")+n+"="+k),b(j,e,m),i},log:function(b,c){var d=new Image,e="_ere_sio_log_"+Math.floor(2147483648*Math.random()).toString(36);a[e]=d,d.onload=d.onerror=d.onabort=function(){d.onload=d.onerror=d.onabort=null,a[e]=null,d=null},d.src=b+(c?"":(b.indexOf("?")>0?"&":"?")+e)},serilize:function(a){var b=[];for(var c in a)a[c]&&b.push(c+"="+encodeURIComponent(a[c]));return b.join("&")}}}(),b.url=b.url||{top:function(){var b;try{b=a.top.location.href}catch(c){}return b=b||(a.top===a.self?a.location.href:a.document.referrer)}()},b.cookie=b.cookie||{_isValidKey:function(a){return new RegExp('^[^\\x00-\\x20\\x7f\\(\\)<>@,;:\\\\\\"\\[\\]\\?=\\{\\}\\/\\u0080-\\uffff]+$').test(a)},_getRaw:function(a){if(b.cookie._isValidKey(a)){var c=new RegExp("(^| )"+a+"=([^;]*)(;|$)"),d=c.exec(document.cookie);if(d)return d[2]||null}return null},_setRaw:function(a,c,d){if(b.cookie._isValidKey(a)){d=d||{};var e=d.expires;"number"==typeof d.expires&&(e=new Date,e.setTime(e.getTime()+d.expires)),document.cookie=a+"="+c+(d.path?"; path="+d.path:"")+(e?"; expires="+e.toGMTString():"")+(d.domain?"; domain="+d.domain:"")+(d.secure?"; secure":"")}},get:function(a){var c=b.cookie._getRaw(a);return"string"==typeof c?c=decodeURIComponent(c):null},set:function(a,c,d){b.cookie._setRaw(a,encodeURIComponent(c),d)},remove:function(a,c){c=c||{},c.expires=new Date(0),b.cookie._setRaw(a,"",c)}},b.json=b.json||{parse:function(a){return new Function("return ("+a+")")()},stringify:function(){function a(a){return/["\\\x00-\x1f]/.test(a)&&(a=a.replace(/["\\\x00-\x1f]/g,function(a){var b=f[a];return b?b:(b=a.charCodeAt(),"\\u00"+Math.floor(b/16).toString(16)+(b%16).toString(16))})),'"'+a+'"'}function c(a){var c,d,e,f=["["],g=a.length;for(d=0;g>d;d++)switch(e=a[d],typeof e){case"undefined":case"function":case"unknown":break;default:c&&f.push(","),f.push(b.json.stringify(e)),c=1}return f.push("]"),f.join("")}function d(a){return 10>a?"0"+a:a}function e(a){return'"'+a.getFullYear()+"-"+d(a.getMonth()+1)+"-"+d(a.getDate())+"T"+d(a.getHours())+":"+d(a.getMinutes())+":"+d(a.getSeconds())+'"'}var f={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return function(d){switch(typeof d){case"undefined":return"undefined";case"number":return isFinite(d)?String(d):"null";case"string":return a(d);case"boolean":return String(d);default:if(null===d)return"null";if(d instanceof Array)return c(d);if(d instanceof Date)return e(d);var f,g,h=["{"],i=b.json.stringify;for(var j in d)if(Object.prototype.hasOwnProperty.call(d,j))switch(g=d[j],typeof g){case"undefined":case"unknown":case"function":break;default:f&&h.push(","),f=1,h.push(i(j)+":"+i(g))}return h.push("}"),h.join("")}}}()},b.iframe=b.iframe||{uid:0,init:function(a,b,c,d){var e=d?'"':"",f=e+"0"+e;a.width=e+b+e,a.height=e+c+e,a.frameborder=f,a.marginwidth=f,a.marginheight=f,a.vspace=f,a.hspace=f,a.allowtransparency=e+"true"+e,a.scrolling=e+"no"+e},createHTML:function(a){var c=[];a.name=a.name||a.id||"sinaere_iframe_uid_"+b.iframe.uid++;for(var d in a)c.push(" "+d+'="'+(null===a[d]?"":a[d])+'"');return"<iframe"+c.join("")+"></iframe>"}},b}(),e=function(b){function e(a){return/(^| )sinaere($| )/.test(a.className)&&"done"!==a.getAttribute("data-status")}function f(a){return/(^| )sinaere($| )/.test(a.className)&&"async"===a.getAttribute("data-status")}function g(a){var b,c=document.getElementsByTagName("ins"),d=0,g=c.length;for(b=c[d];g>d;b=c[++d])if(e(b)&&(!a&&!f(b)||b.id===a))return b;return null}function h(a,c,e){var f={cbrand:c.cbrand,country:c.country,cprice:c.cprice,cseries:c.cseries,ctype:c.ctype},g=[];for(var h in f)f[h]&&g.push(h+"="+f[h]);var i={type:"recmd_ad_exposure",ad_url:c.url,ad_pos:e.pos||"",host_url:d.url.top,uid:a,sinaglobal:d.cookie.get("SINAGLOBAL"),time:+new Date,features:c.meta||g.join("&")};b.sio.log("//slog.sina.com.cn/b.gif?"+d.sio.serilize(i))}function i(a,c,e){if(c&&c.data&&c.data.length){for(var f,g=0,i=c.uid;f=c.data[g++];)h(i,f,e);var j=parseInt(e.w,10),k=parseInt(e.h,10),m=(l?"../tpl/":"//d"+Math.floor(0+10*Math.random())+".sina.com.cn/litong/zhitou/sinaads/test/e-recommendation/tpl/")+["eretpl",e.tpl,j,k].join("_")+".html?"+ +new Date;a.style.cssText+=";display:block;overflow:hidden;text-decoration:none;",a.innerHTML='<ins style="text-decoration:none;margin:0px auto;display:block;overflow:hidden;width:'+j+"px;height:"+k+'px;"></ins>',a=a.getElementsByTagName("ins")[0];var n={};d.iframe.init(n,j,k,!1),n.src=m,n.name=encodeURIComponent(d.json.stringify(c)),a.innerHTML=b.iframe.createHTML(n)}}function j(b){var e=a._ereData||{},f={rfunc:107,cre:"ad_business",mod:"g",merge:3,statics:1,cateid:"carshopping",offset:0,multi_func:2,length:b.num};return(e=e[[b.tpl,b.w,b.h].join("_")])?c.resolved(e):d.sio.jsonp("//cre.mix.sina.com.cn/api/v3/get?"+d.sio.serilize(f),{rfunc:107,cre:"ad_business",mod:"g",merge:3,statics:1,cateid:"carshopping",offset:0,multi_func:2,length:f.num},{timeout:5e3})}var k=0,l=0;return function(a){var b=a.element,c=a.params||{};if("string"==typeof b&&(b=document.getElementById(b)),b){if(!e(b)&&(b=b.id&&g(b.id),!b))return;if(!("innerHTML"in b))return}else if(b=g(),!b)return;b.setAttribute("data-status","done"),c.uid=k++;for(var f=b.attributes,h=f.length,l=0;h>l;l++){var m=f[l];if(/data-/.test(m.nodeName)){var n=m.nodeName.replace("data-","").replace(/-/g,"_");c.hasOwnProperty(n)||(c[n]=m.value)}}c.page_url=d.url.top,j(c).done(function(a){a.referrer=d.url.top,a.pos=c.pos||"",i(b,a,c)}).fail(function(){console.log("fail")})}}(d),f=a.sinaere;if(f&&f.shift)for(var g,h=100;(g=f.shift())&&0<h--;)e(g);return a.sinaere={push:e},!0}(window);
