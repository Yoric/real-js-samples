STK.namespace("v6page",function(a,b){var STK=arguments[0],$=arguments[1];
STK.register("lib.kit.io.ajax",function(a){var b=function(b,c,d){c=c|0||1;d=d||"fail";var e=b.args;e.__rnd&&delete e.__rnd;(new Image).src="//weibolog.sinaapp.com/?t="+c+"&u="+encodeURIComponent(b.url)+"&p="+encodeURIComponent(a.core.json.jsonToQuery(e))+"&m="+d;(new Image).src="//s1.sinaedge.com/whb.gif?t="+c+"&u="+encodeURIComponent(b.url)+"&p="+encodeURIComponent(a.core.json.jsonToQuery(e))+"&m="+d};return function(c){var d={},e=[],f=null,g=!1,h=a.parseParam({url:"",method:"get",responseType:"json",timeout:3e4,onTraning:a.funcEmpty,isEncode:!0},c);h.onComplete=function(a){g=!1;c.onComplete(a,h.args);setTimeout(i,0)};h.onFail=function(a){g=!1;if(typeof c.onFail=="function")try{c.onFail(a,h.args)}catch(d){}setTimeout(i,0);try{b(h)}catch(d){}};h.onTimeout=function(a){try{b(h);c.onTimeout(a)}catch(d){}};var i=function(){if(!!e.length){if(g===!0)return;g=!0;h.args=e.shift();if(h.method.toLowerCase()=="post"){var b=a.core.util.URL(h.url);b.setParam("__rnd",+(new Date));h.url=b.toString()}f=a.ajax(h)}},j=function(a){while(e.length)e.shift();g=!1;if(f)try{f.abort()}catch(b){}f=null};d.request=function(a){a||(a={});c.noQueue&&j();if(!c.uniqueRequest||!f){e.push(a);a._t=0;i()}};d.abort=j;return d}});
STK.register("lib.kit.io.jsonp",function(a){return function(b){var c=a.parseParam({url:"",method:"get",responseType:"json",varkey:"_v",timeout:3e4,onComplete:a.funcEmpty,onTraning:a.funcEmpty,onFail:a.funcEmpty,isEncode:!0},b),d=[],e={},f=!1,g=function(){if(!!d.length){if(f===!0)return;f=!0;e.args=d.shift();e.onComplete=function(a){f=!1;c.onComplete(a,e.args);setTimeout(g,0)};e.onFail=function(a){f=!1;c.onFail(a);setTimeout(g,0)};a.jsonp(a.core.json.merge(c,{args:e.args,onComplete:function(a){e.onComplete(a)},onFail:function(a){try{e.onFail(a)}catch(b){}}}))}},h={};h.request=function(a){a||(a={});d.push(a);a._t=1;g()};h.abort=function(a){while(d.length)d.shift();f=!1;e=null};return h}});
STK.register("lib.kit.io.ijax",function(a){return function(b){var c=a.parseParam({url:"",timeout:3e4,isEncode:!0,abaurl:null,responseName:null,varkey:"callback",abakey:"callback"},b),d=[],e=null,f=!1;c.onComplete=function(a,d){f=!1;b.onComplete(a,c.form,d);c.form=null;c.args=null;setTimeout(g,0)};c.onFail=function(a,d){f=!1;b.onFail(a,c.form,d);c.form=null;c.args=null;setTimeout(g,0)};var g=function(){var b;if(!!d.length){if(f===!0)return;f=!0;b=d.shift();c.args=b.args;c.form=b.form;e=a.ijax(c)}},h=function(a){while(d.length)d.shift();f=!1;if(e)try{e.abort()}catch(b){}e=null},i={};i.request=function(c,e){if(!a.isNode(c))throw"[lib.kit.io.ijax.request] need a form as first parameter";e||(e={});b.noQueue&&h();d.push({form:c,args:e});g()};i.abort=h;return i}});
STK.register("lib.kit.io.inter",function(a){var b=a.core.json.merge;return function(){var c={},d={},e={},f=function(a,b){return function(c,d){try{b.onComplete(c,d)}catch(f){}try{c.code==="100000"?b.onSuccess(c,d):b.onError(c,d)}catch(f){}for(var g in e[a])try{e[a][g](c,d)}catch(f){}}},g=function(a,b,c){return function(d){try{b.onComplete(d,c)}catch(f){}try{d.code==="100000"?b.onSuccess(d,c):b.onError(d,c)}catch(f){}for(var g in e[a])try{e[a][g](d,c)}catch(f){}}};c.register=function(a,b){if(typeof d[a]!="undefined")throw a+" registered";d[a]=b;e[a]={}};c.addHook=function(b,c){var d=a.core.util.getUniqueKey();e[b][d]=c;return d};c.rmHook=function(a,b){e[a]&&e[a][b]&&delete e[a][b]};c.getTrans=function(c,e){var g=b(d[c],e);g.onComplete=f(c,e);g.url+=(g.url.indexOf("?")>=0?"&":"?")+"ajwvr=6";g.withDomain&&(g.url+="&domain="+$CONFIG.domain);var h=d[c].requestMode,i="ajax";if(h==="jsonp"||h==="ijax")i=h;return a.lib.kit.io[i](g)};c.request=function(c,e,f){var h=b(d[c],e);h.onComplete=g(c,e,f);h.url+=(h.url.indexOf("?")>=0?"&":"?")+"ajwvr=6";h.withDomain&&(h.url+="&domain="+$CONFIG.domain);h=a.core.obj.cut(h,["noqueue"]);h.args=f;var i=d[c].requestMode;return i==="jsonp"?a.jsonp(h):i==="ijax"?a.ijax(h):a.ajax(h)};return c}});
STK.register("conf.trans.comment",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("smallList",{url:"/aj/v6/comment/small",method:"get"});c("add",{url:"/p/aj/v6/comment/add",method:"post",withDomain:!0});c("delete",{url:"/aj/comment/del",method:"post"});c("hotChange",{url:"/aj/comment/hotchange"});c("privateSetting",{url:"/aj/account/setcommentprivacy",method:"post"});c("privateNoMore",{url:"/aj/bubble/closebubble",method:"get"});c("cfilter",{url:"/aj/v6/comment/small",method:"get"});c("isComment",{url:"/aj/comment/privacy",method:"get"});c("getIn",{url:"/aj/commentbox/in",method:"get"});c("getOut",{url:"/aj/commentbox/out",method:"get"});c("getComment",{url:"/aj/at/comment/comment",method:"get"});c("getCommonComent",{url:"/aj/commentbox/common",method:"get"});c("dialogue",{url:"/aj/v6/comment/conversation",method:"get"});c("commentDetail_photoView",{url:"/aj/v6/comment/photolayer",method:"get"});return b});
STK.register("lib.kit.extra.language",function(a){window.$LANG||(window.$LANG={});return function(b){var c=[].splice.call(arguments,1,arguments.length),d=[b,$LANG].concat(c),e=a.core.util.language.apply(this,d);return e}});
STK.register("lib.feed.imageLikeWhiteList",function(a){return function(){return!0}});
STK.register("lib.feed.feedTemps",function(a){var b=a.lib.kit.extra.language,c=$CONFIG.imgPath+"/style/images/common/loading.gif",d=a.lib.feed.imageLikeWhiteList();return{loadingIMG:b('<div class="WB_empty"> <div class="WB_innerwrap"> <div class="empty_con clearfix"> <p class="text"><i class="W_loading"></i>#L{正在加载，请稍候}...</p> </div> </div> </div>'),newFeedTipHTML:b('<a node-type="feed_list_newBar" action-type="feed_list_newBar" class="notes" href="javascript:void(0);">#L{有} [n] #L{条新微博}，#L{点击查看}</a>'),activityNewFeedTipHTML:b('<a node-type="feed_list_newBar" action-type="feed_list_newBar" class="notes" href="javascript:void(0);">#L{有} [n] #L{条新动态}，#L{点击查看}</a>'),newCloseFriendFeed:b('<a node-type="feed_list_newBar" action-type="feed_list_newBar" class="notes" href="javascript:void(0);">#L{有新密友微博}，#L{点击查看}</a>'),loadingHTML:b('<div requestType="[n]"><i class="W_loading"></i> <span>#L{正在加载，请稍候}...</span></div>'),loadErrorRetryHTML:b('<div class="zero_tips S_txt2"><span>#L{加载失败}，<a action-type="feed_list_retry" requestType="[n]" href="javascript:void(0)">#L{请重试}</a></span></div>'),loadErrorEndHTML:b('<div class="zero_tips S_txt2" requestType="[n]"><span>#L{加载失败}。</span></div>'),mediaIMGTEMP:b('<#et temp data><div class="WB_expand_media S_bg1"><div class="tab_feed_a clearfix"><div class="tab"><ul class="clearfix"><li><span class="line S_line1"><a action-type="feed_list_media_toSmall" href="javascript:void(0);" class="S_txt1" <#if (data.suda && data.suda.retract)>suda-data="${data.suda.retract}"</#if> ><i class="W_ficon ficon_arrow_fold S_ficon">k</i>#L{收起}</a></span></li><li><span class="line S_line1"><a action-type="widget_photoview" action-data="${data.acdata}" href="javascript:void(0);" class="S_txt1" <#if (data.suda && data.suda.showBig)>suda-data="${data.suda.showBig}"</#if>><i class="W_ficon ficon_search S_ficon">f</i>#L{查看大图}</a></span></li><li><span class="line S_line1"><a action-type="feed_list_media_toLeft" href="javascript:void(0);" class="S_txt1" <#if (data.suda && data.suda.left)>suda-data="${data.suda.left}"</#if>><i class="W_ficon ficon_turnleft S_ficon">m</i>#L{向左转}</a></span></li><li><span class="line S_line1"><a action-type="feed_list_media_toRight" href="javascript:void(0);" class="S_txt1" <#if (data.suda && data.suda.right)>suda-data="${data.suda.right}"</#if>><i class="W_ficon ficon_turnright S_ficon">n</i>#L{向右转}</a></span></li></ul></div></div><div class="WB_media_view"><div class="media_show_box"><ul class="clearfix"><li class="smallcursor" action-type="feed_list_media_bigimgDiv" action-data="${data.acdata}" node-type="feed_list_media_bigimgDiv" <#if (data.suda && data.suda.big)>suda-data="${data.suda.big}"</#if>><div node-type="artwork_box" class="artwork_box"><img dynamic-id="${data.uniqueId}" action-type="feed_list_media_bigimg" src="${data.bigSrc}" alt=""></div></li></ul></div></div></div></#et>'),mediaIMGTEMPwithBtn:b('<#et temp data><div class="WB_expand_media S_bg1"><div class="tab_feed_a clearfix"><div class="tab"><ul class="clearfix"><li><span class="line S_line1"><a action-type="feed_list_media_toSmall" action-data="key=${data.uniqueKey}" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_arrow_fold S_ficon">k</i>#L{收起}</a></span></li><#if (data.isPrivate == 1 && data.relation !=1 )><li><span class="line S_line1"><a action-type="widget_photoview" action-data="${data.acdata}" href="javascript:;" class="S_ficon_dis"><i class="W_ficon ficon_search S_ficon_dis">f</i>#L{查看大图}</a></span></li><li><span class="line S_line1"><a action-type="feed_list_media_toLeft" href="javascript:;" action-data="${data.acdata}"  class="S_ficon_dis"><i class="W_ficon ficon_turnleft S_ficon_dis">m</i>#L{向左旋转}</a></span></li><li><span class="line S_line1"><a action-type="feed_list_media_toRight" href="javascript:;"  action-data="${data.acdata}" class="S_ficon_dis"><i class="W_ficon ficon_turnright S_ficon_dis">n</i>#L{向右旋转}</a></span></li><#else><li><span class="line S_line1"><a action-type="widget_photoview" action-data="${data.acdata}" href="javascript:;" class="${data.type == "story" ? "S_ficon_dis" : "S_txt1"}"><i class="W_ficon ficon_search ${data.type == "story" ? "S_ficon_dis" : "S_ficon"}">f</i>#L{查看大图}</a></span></li><li><span class="line S_line1"><a action-type="feed_list_media_toLeft" href="javascript:;" action-data="${data.acdata}"  class="${data.uniqueKey ? "S_ficon_dis" : "S_txt1"}"><i class="W_ficon ficon_turnleft ${data.uniqueKey ? "S_ficon_dis" : "S_ficon"}">m</i>#L{向左旋转}</a></span></li><li><span class="line S_line1"><a action-type="feed_list_media_toRight" href="javascript:;"  action-data="${data.acdata}" class="${data.uniqueKey ? "S_ficon_dis" : "S_txt1"}"><i class="W_ficon ficon_turnright ${data.uniqueKey ? "S_ficon_dis" : "S_ficon"}">n</i>#L{向右旋转}</a></span></li></#if><li><span class="line S_line1"><a action-type="feed_list_media_replay" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_replay S_ficon">y</i>#L{重播}</a></span></li></ul></div></div><div action-type="feed_list_media_bigimgDiv" node-type="feed_list_media_bigimgDiv"  action-data="${data.acdata}" class="WB_media_view"><div class="media_show_box"><ul class="clearfix"><li class="smallcursor"><div node-type="artwork_box" class="artwork_box"><div action-type="feed_list_media_bigimg"><#if (!data.uniqueKey)><img dynamic-id="${data.uniqueId}"/></#if></div><span style="display:none;" action-type="feed_list_image_like" action-data="mid=${data.mid}&photo_id=${data.pid}&is_liked=${data.is_liked}&count=${data.count}&object_id=${data.object_id}"><#if (data.is_liked)><a href="javascript:;" class="W_btn_alpha" title="#L{取消赞}"><i class="icon_praised"></i><span node-type="count">(${data.count})</span></a></div><#else><a href="javascript:;" class="W_btn_alpha" title="#L{赞}"><i class="icon_praise"></i><span node-type="count">(${data.count})</span></a></#if></span></li></ul></div></div></div></#et>'),mediaVideoMusicTEMP:b('<#et temp data><div class="WB_expand_media S_bg1"><div class="tab_feed_a clearfix"><div class="tab"><ul class="clearfix"><li><span class="line S_line1"><a action-type="feed_list_media_toSmall" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_arrow_fold S_ficon">k</i>收起</a></span></li><#if (data.title)><li><span class="line S_line1"><a target="_blank" href="${data.full_url}" class="S_txt1"><em class="W_autocut"><i class="W_ficon ficon_arrow_bigimg S_ficon">l</i>${data.title}</em></a></span></li></#if></ul></div></div><div node-type="feed_list_media_big${data.type}Div" class="WB_app_view"><img class="loading_gif" src="'+c+'"/>'+"</div>"+"</div>"+"</#et>"),mediaVideoMusicFloatTEMP:b('<#et temp data><div node-type="outer" class="W_layer" style=""><div class="bg"><table border="0" cellspacing="0" cellpadding="0"><tr><td><div class="content"><div class="title"><h3>${data.title}</h3></div><a href="javascript:void(0);" onclick="return false;" node-type="close" class="W_close"></a><div node-type="mediaContent" style="text-align:center;width:440px;"><img style="margin:10px;" class="loading_gif" src="'+c+'"/></div>'+"</div>"+"</td>"+"</tr>"+"</table>"+"</div>"+"</div>"+"</#et>"),widgetTEMP:b('<#et temp data><div class="WB_expand_media S_bg1"><div class="tab_feed_a clearfix"><div class="tab"><ul class="clearfix"><li><span class="line S_line1"><a action-type="feed_list_media_toSmall" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_arrow_fold S_ficon">k</i>收起</a></span></li><#if (data.title && data.full_url)><li><span class="line S_line1"><a target="_blank" href="${data.full_url}" class="S_txt1"><em class="W_autocut"><i class="W_ficon ficon_arrow_bigimg S_ficon">l</i>${data.title}</a></em></span></li></#if></ul></div></div><div node-type="feed_list_media_widgetDiv" class="WB_app_view"><img class="loading_gif" src="'+c+'"/>'+"</div>"+"</div>"+"</#et>"),qingTEMP:b('<#et temp data><p class="medis_func S_txt3"><a href="javascript:void(0);" action-type="feed_list_media_toSmall" class="retract"><em class="W_ico12 ico_retract"></em>#L{收起}</a><i class="W_vline">|</i><a <#if (data.suda)>suda-data="${data.suda}"</#if> href="${data.full_url}" title="${data.full_url}" class="show_big" target="_blank"><em class="W_ico12 ico_showbig"></em>${data.title}</a></p><div node-type="feed_list_media_qingDiv"><img class="loading_gif" src="'+c+'"/></div>'+"</#et>"),commonMediaTEMP:b('<#et temp data><p class="medis_func S_txt3"><a href="javascript:void(0);" action-type="common_list_media_hide" action-data="type=${data.type}&id=${data.id}" suda-data="key=tblog_activity_click&value=fold_play" class="retract"><em class="W_ico12 ico_retract"></em>#L{收起}</a><i class="W_vline">|</i><a href="${data.url}" rel="noopener" action-type="feed_list_url" title="${data.title}" class="show_big" target="_blank" suda-data="key=tblog_activity_click&value=url_click"><em class="W_ico12 ico_showbig"></em>${data.title}</a><#if (data.tofloat)><i class="W_vline">|</i><a action-type="common_list_media_toFloat" action-data="title=${data.title}&type=${data.type}&id=${data.id}" href="javascript:void(0);" class="turn_right" suda-data="key=tblog_activity_click&value=bomb_play">#L{弹出}</a></#if></p><div node-type="common_list_media_Div" style="text-align:center;min-height:18px;"><img class="loading_gif" src="'+c+'"/></div>'+"</#et>"),translateTEMP:b('<#et temp data><div class="W_layer W_layer_pop" node-type="feed_translate" style="margin-left:-17px;"><div class="content"><div class="W_layer_close"><a href="javascript:void(0)" suda-data="key=tblog_bowen_translate&value=close_button" action-type="feed_translate_close" class="W_ficon ficon_close S_ficon">X</a></div><div class="layer_translation"><div class="tit W_f14 S_txt2">#L{翻译结果}:</div><div class="con" node-type="translate_rs">${data.text}</div><div class="link clearfix S_txt2"><span class="W_fr"><a href="javascript:void(0);" suda-data="key=tblog_bowen_translate&value=click_i_translate" action-type="feed_translate_by_me" action-data="${data.bymedata}">#L{我来翻译}</a></span>#L{翻译结果由}<a href="//weibo.com/youdaocidian" target="_blank" suda-data="key=tblog_bowen_translate&value=click_youdao_link" title="#L{有道词典}">#L{有道词典}</a>#L{提供}，#L{仅供参考}。</div></div></div></div></#et>')}});
STK.register("lib.kit.dom.firstChild",function(a){var b=a.core.dom.next;return function(a){var c=a.firstChild;c&&c.nodeType!=1&&(c=b(c));return c}});
STK.register("lib.kit.dom.lastChild",function(a){var b=a.core.dom.prev;return function(a){var c=a.lastChild;c&&c.nodeType!=1&&(c=b(c));return c}});
STK.register("lib.kit.dom.parentAttr",function(a){return function(a,b,c){var d;if(a&&b){c=c||document.body;while(a&&a!=c&&!(d=a.getAttribute(b)))a=a.parentNode}return d}});
STK.register("lib.kit.extra.parseURL",function(a){return function(){return STK.historyM&&STK.historyM.parseURL?STK.historyM.parseURL():a.core.str.parseURL(location.href)}});
STK.register("lib.feed.API",function(a){var b=a.lib.feed.feedTemps,c=a.lib.kit.dom.firstChild,d=a.lib.kit.dom.lastChild,e=a.core.dom.insertElement,f=a.lib.kit.extra.language,g={getMid:function(a,b){var c=g.getFeedNode(a,b);return c?c.getAttribute("mid"):null},getFeedNode:function(b,c){return a.core.dom.dir(b,{expr:"[action-type=feed_list_item]",endpoint:c||document.body})[0]},getFeeds:function(b,c){return a.sizzle("["+c+"]",b)},preventDefault:function(b){a.preventDefault();return!1}},h=function(b){a.custEvent.fire(b,"clearTips","base")},i=function(d,e){var f;switch(d){case"waiting":f=b.loadingHTML;break;case"retry":f=b.loadErrorRetryHTML;break;case"end":f=b.loadErrorEndHTML}return c(a.builder(f.replace("[n]",e)).box)};return function(b,j){a.isNode(b)||a.log("baseFeedList : parameter node is not a document node!");b.getAttribute("node-type")!="feed_list"&&(b=a.sizzle('div[node-type="feed_list"]',b)[0]);j=a.parseParam({end_id:""},j);var k={},l=new Date,m=a.core.evt.delegatedEvent(b),n,o,p=0,q=1,r=!1,s={},t=j.end_id;m.add("feed_list_retry","click",function(c){h(b);var d=c.el.getAttribute("requestType"),e=s[d].location;e=="top"?v("waiting",d):w("waiting",d);a.custEvent.fire(y,"request",[d,s[d].data]);return g.preventDefault(c.evt)});var u=function(){if(q<2){var a=y.getFirstFeed();a&&(t=a.getAttribute("mid"))}},v=function(a,c){r=!0;y.removeTopNode();e(b,n=i(a,c),"afterbegin")},w=function(a,c){y.removeBottomNode();b.appendChild(o=i(a,c))},x=!0,y={extra:{},extraData:{},getNode:function(){return b},getNewBar:function(){return a.sizzle('[node-type="feed_list_newBar"]',b)},removeNewBar:function(){var b=y.getNewBar();b&&b.length>0&&a.core.dom.removeNode(b[0])},clearNewBar:function(){var b=y.getNewBar();if(b&&b.length>0)for(var c in b)a.core.dom.removeNode(b[c]);n=null},getRecommend:function(){return a.sizzle('[node-type="feed_list_recommend"]',b)},removeRecommend:function(){var b=y.getRecommend();if(b&&b.length>0)for(var c in b)a.core.dom.removeNode(b[c])},getNodeList:function(){var c=a.sizzle('div[action-type="feed_list_item"]',b);return c.length?c:!1},getDEvent:function(){return m},removeTopNode:function(){a.removeNode(n);n=null},setTopNode:function(a){n=a},removeBottomNode:function(){a.removeNode(o);o=null},setBottomNode:function(a){o=a},getEndId:function(){return t},isTopWaiting:function(){return r},getCurrentPage:function(){var b=a.lib.kit.extra.parseURL(),c=a.core.json.queryToJson(b.query);q=c.page||1;return q},setCurrentPage:function(a){q=a},getFeedCount:function(){return g.getFeeds(b,'action-type="feed_list_item"').length},setRequestAction:function(b,c){k[b]=a.parseParam({top:!1,center:!1,bottom:!1},c)},setRequestData:function(a,b){s[a]={data:b,time:0}},getExtraData:function(a){return y.extraData[a]},setExtraData:function(a,b){y.extraData[a]=b},setExtraFunction:function(a,b){y.extra[a]=b},regCustEvent:function(b,c){a.custEvent.define(y,b);a.custEvent.add(y,b,c)},isFeed:function(a){return a.getAttribute("mid")&&!a.getAttribute("feedtype")?!0:!1},getFirstFeed:function(){var d=c(b);while(d&&!y.isFeed(d))d=a.core.dom.next(d);return d},getLastFeed:function(){var c=d(b);while(!y.isFeed(c))c=a.core.dom.prev(c);return c},getFirstFeedId:function(){var b=y.getFirstFeed();if(b){for(var c=0;c<p&&b;c++)b=a.core.dom.next(b);if(b)return b.getAttribute("mid")}},getLastFeedId:function(){var c=a.sizzle('[node-type="feed_list_shieldKeyword"]',b)[0],e=c?c:d(b),f=o?a.core.dom.prev(o):a.core.dom.prev(e);if(f)return f.getAttribute("mid")},getFirstFeedAttr:function(b){var c=a.sizzle("[action-type=feed_list_item]:not([feedtype])"),d=c[0];return d?d.getAttribute(b):""},getLastFeedAttr:function(b){var c=a.sizzle("[action-type=feed_list_item]:not([feedtype])"),d=c[c.length-1];return d?d.getAttribute(b):""},showZeroTip:function(){var c=a.sizzle('div[node-type="feed_list_zero"]',b)[0];c&&(c.style.display="")},hideZeroTip:function(){var c=a.sizzle('div[node-type="feed_list_zero"]',b)[0];c&&(c.style.display="none")},insertFakeFeed:function(c){setTimeout(function(){if(typeof c!="string")a.log("insertFakeFeed feedHtml is not String!");else{y.hideZeroTip();p++;var d=a.C("div");d.innerHTML=c;var e=a.sizzle('div[action-type="feed_list_item"]',d);e=e[0];n?a.core.dom.insertBefore(e,n):a.core.dom.insertElement(b,e,"afterbegin");var f=a.sizzle('[node-type="empty_module"]',b);f&&f[0]&&(f[0].style.display="none");setTimeout(function(){try{if(a.IE){var b=a.sizzle(".WB_frame_b")[0];b.style.visibility?b.style.visibility="":b.style.visibility="inherit"}}catch(c){}})}},200)},updateFeed:function(d,e,f){if(d&&e){y.hideZeroTip();if(e=="top"){r=!1;y.removeTopNode();for(var g=0;g<p;g++)a.removeNode(c(b));p=0;a.insertHTML(b,d,"afterbegin");u()}else if(e=="bottom"){y.removeBottomNode();a.insertHTML(b,d);u()}a.custEvent.fire(y,"updateFeed",[f,d]);setTimeout(function(){try{if(a.IE){var b=a.sizzle(".WB_frame_b")[0];b&&(b.style.visibility?b.style.visibility="":b.style.visibility="inherit")}}catch(c){}})}},showWait:function(c,d,e){c=="top"?v("waiting",d):c=="bottom"&&w("waiting",d);if(c=="center"){n&&a.core.util.hideContainer.appendChild(n);o&&a.core.util.hideContainer.appendChild(o);b.innerHTML="";n&&b.appendChild(n);o&&b.appendChild(o)}s[d]={data:e,time:0,location:c}},showError:function(b,c){if(b&&k[b]){var d=s[b],e;if(d.time>=3){d.time=0;e="end"}else{d.time++;e="retry"}b=="top"?v(e,c):b=="bottom"&&w(e,c);a.custEvent.fire(y,"showError",c)}},resetStartTime:function(){var a=l;l=new Date;return l-a},clearAllTimeTip:function(){var c=a.sizzle('[node-type="feed_list_timeTip"]',b),d=c.length,e=null,f=null;for(var g=d-1;g>=0;g--){e=c[g];f=a.core.dom.prev(e);f&&a.removeClassName(f,"WB_feed_new");e&&a.removeNode(e)}},updateTimeTip:function(c){var d=Math.ceil(y.resetStartTime()/6e4),e=f("[n]#L{你看到这里}"),g=f("#L{之前}");if(d>=60&&d<1440){var h=parseInt(d/60,10),i=d-h*60;g=h+f("#L{小时}")+(i>0?i+f("#L{分钟前，}"):f("#L{前，}"))}else d<60&&(g=d+f("#L{分钟前，}"));e=e.replace("[n]",g);var j=a.sizzle('[node-type="feed_list_timeText"]',b);j.length>0&&(j[0].innerHTML=c||e)},getLoadingData:function(){var b=a.sizzle('[node-type="lazyload"]',b)[0];return b?a.queryToJson(b.getAttribute("action-data")||"")||{}:{}},utils:g},z=function(){var b=y.getFirstFeed();!t&&q<2&&b&&(t=b.getAttribute("mid"));a.custEvent.define(y,["request","updateFeed","clearTips","updateEndId","showError","inView","smartSort","showRecommendTip","stopRecommendTip"]);a.custEvent.add(y,"updateEndId",u)};z();y.destroy=function(){m.destroy();a.custEvent.undefine(y)};return y}});
STK.register("lib.dialog.loginLayer",function(a){var b,c="//tjs.sjs.sinajs.cn/t5/register/js/page/remote/loginLayer.js?version=";return function(d){d=a.core.obj.parseParam({lang:"zh-cn",loginSuccessUrl:encodeURIComponent(window.location.href),version:window.$CONFIG&&window.$CONFIG.version||"20170103"},d||{});"$CONFIG"in window||(window.$CONFIG={});window.$CONFIG.sinaSSOControllerTemporary=window.$CONFIG.sinaSSOControllerTemporary||{};if(!window.$CONFIG.sinaSSOControllerTemporary.lock){window.$CONFIG.sinaSSOControllerTemporary.lock=!0;if(window.sinaSSOController){window.sinaSSOController.loginSuccessUrl&&window.sinaSSOController.loginSuccessUrl.indexOf("comefrom=loginlayer")>-1?window.$CONFIG.sinaSSOControllerTemporary.top=window.sinaSSOController:window.$CONFIG.sinaSSOControllerTemporary.oth=window.sinaSSOController;window.sinaSSOController=window.$CONFIG.sinaSSOControllerTemporary.top||{}}if(window.WBtopGlobal_loginLayer)window.WBtopGlobal_loginLayer(d);else{if(b)return;b=!0;a.core.io.scriptLoader({url:c+d.version,onComplete:function(){b=!1;window.WBtopGlobal_loginLayer(d)},timeout:1e4,onTimeout:function(){b=!1}})}}}});
STK.register("lib.kit.io.cssLoader",function(a){var b="",c="//img.t.sinajs.cn/t4/",d="//timg.sjs.sinajs.cn/t4/";if(typeof $CONFIG!="undefined"){c=$CONFIG.cssPath||c;b=$CONFIG.version||""}var e={};return function(f,g,h,i,j){i=i||b;h=h||function(){};var k=function(a,b){var c=e[a]||(e[a]={loaded:!1,list:[]});if(c.loaded){b(a);return!1}c.list.push(b);return c.list.length>1?!1:!0},l=function(a){var b=e[a].list;for(var c=0;c<b.length;c++)b[c](a);e[a].loaded=!0;delete e[a].list};if(!!k(f,h)){var m;j?m=d+f:m=c+f+"?version="+i;var n=a.C("link");n.setAttribute("rel","Stylesheet");n.setAttribute("type","text/css");n.setAttribute("charset","utf-8");n.setAttribute("href",m);document.getElementsByTagName("head")[0].appendChild(n);var o=a.C("div");o.id=g;a.core.util.hideContainer.appendChild(o);var p=3e3,q=function(){if(parseInt(a.core.dom.getStyle(o,"height"))==42){a.core.util.hideContainer.removeChild(o);l(f)}else if(--p>0)setTimeout(q,10);else{a.log(f+"timeout!");a.core.util.hideContainer.removeChild(o);delete e[f]}};setTimeout(q,50)}}});
STK.register("lib.dialog.authentication",function(a){return function(b){var c=a.lib.kit.extra.language,d=a.core.util.browser;b=a.parseParam({src:"//weibo.com/a/verify/realname?stage=home_verification",icon:"warn",isHold:!0,width:"380px",height:"240px",title:c("#L{帐号验证}")},b||{});var e={},f,g,h=!1,i="tblog_checkfailed_reform",j={init:function(){f=a.ui.dialog(b);var c=[];c.push('<iframe id="account_authentication" name="account_authentication" node-type="frame" width="'+b.width+'" height="'+b.height+'" allowtransparency="true" scrolling="no" frameborder="0" src=""></iframe>');var d=a.builder(c.join(""));f.setTitle(b.title);f.setContent(d.box);var e=f.getDomList()},show:function(){try{window.SUDA&&SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_box")}catch(c){}h||a.lib.kit.io.cssLoader("style/css/module/layer/layer_check_identity.css","js_style_css_module_layer_check_identity",function(){h=!0});f.show().setMiddle();g=a.E("account_authentication");var d=decodeURIComponent(b.src)+"&rnd=";g.attachEvent?g.attachEvent("onload",function(){g.height=b.height;f.setMiddle()}):g.onload=function(){g.height=b.height;f.setMiddle()};g.src=d+a.core.util.getUniqueKey()},destroy:function(){},hook:function(a,b){try{a=="100000"?j.verifySucc():j.verifyFail()}catch(c){}},verifySucc:function(){window.SUDA&&SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_success");f.hide();var b={title:c("#L{提示}"),icon:"success",OK:function(){window.SUDA&&SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_play");history.go(0)},OKText:c("#L{进入首页}"),msg:c("#L{恭喜，您的身份已验证成功，马上进入微博。}")},d=a.ui.alert(b.msg,b);a.custEvent.add(d,"hide",function(){history.go(0)})},verifyFail:function(){window.SUDA&&SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_twotimes");f.hide();var b={title:c("#L{提示}"),icon:"warn",OK:function(){SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_triple");j.show()},OKText:c("#L{再次验证}"),msg:c("#L{抱歉，您的身份信息不准确，请再次验证。<br/>}")+'<a class="S_spetxt" suda-data="key=tblog_checkfailed_reform&value=checkfailed_havealook" href="//weibo.com">'+c("#L{您也可以先体验微博，随后再验证身份信息>>}")+"</a>"},d=a.ui.alert(b.msg,b);a.custEvent.add(d,"hide",function(){history.go(0)})}};j.init();e.destroy=j.destory;e.show=j.show;window.App=window.App||{};window.App.checkRealName=j.hook;return e}});
STK.register("lib.dialog.memberDialog",function(a){var b='<div node-type="outer" class="layer_point"><dl class="point clearfix"><dt><span class="" node-type="icon"></span></dt><dd node-type="inner"><p class="S_txt1" node-type="textLarge"></p><p class="S_txt1" node-type="textComplex"></p><p class="S_txt2" node-type="textSmall"></p></dd></dl></div><div class="W_layer_btn S_bg1"><a href="javascript:void(0);" class="W_btn_b" node-type="OK"></a><a href="javascript:void(0);" class="W_btn_a" node-type="cancel"></a><a href="http://vip.weibo.com/paycenter?pageid=byebank" class="W_btn_a" node-type="member"><span><em class="W_icon icon_member"></em>#L{立即开通会员}</span></a></div>',c={success:"icon_succM",error:"icon_errorM",warn:"icon_warnM","delete":"icon_delM",question:"icon_questionM"},d=a.lib.kit.extra.language,e=function(e,f){var g,h,i,j,k,l;g=a.parseParam({title:"&nbsp;",icon:"warn",textLarge:e,textComplex:"",textSmall:"",OK:a.funcEmpty,OKText:d("#L{确定}"),cancel:a.funcEmpty,cancelText:d("#L{确认}")},f);g.icon=c[g.icon];h={};i=a.ui.dialog();i.setContent(d(b));l=i.getDomList(!0);l.icon.className=g.icon;l.textLarge.innerHTML=g.textLarge;l.textComplex.innerHTML=g.textComplex;l.textSmall.innerHTML=g.textSmall;l.OK.innerHTML="<span>"+g.OKText+"</span>";l.cancel.innerHTML="<span>"+g.cancelText+"</span>";i.setTitle(g.title);i.getDomList().title.style.borderBottomStyle="none";var m=function(){j=!0;k=a.htmlToJson(l.textComplex);i.hide()};a.addEvent(l.OK,"click",m);a.addEvent(l.cancel,"click",i.hide);a.custEvent.add(i,"hide",function(){a.custEvent.remove(i,"hide",arguments.callee);a.removeEvent(l.OK,"click",m);a.removeEvent(l.cancel,"click",i.hide);j?g.OK(k):g.cancel(k)});i.show().setMiddle();h.dia=i;return h};return function(b){b=a.parseParam({type:"follow",errortype:"1"},b);var c,f,g={textLarge:d("#L{您已达到悄悄关注上限！}"),textComplex:d('#L{开通}<a href="http://vip.weibo.com/privilege">#L{微博会员}</a>，#L{悄悄关注上限立即提高}'),textSmall:d('#L{可}<a href="http://vip.weibo.com/paycenter?pageid=byebank" class="S_link2">#L{开通会员}</a>#L{或先将悄悄关注减少至10人以下，再添加}'),OKText:d("#L{管理我的悄悄关注}"),OK:function(){a.preventDefault();window.location.href="/"+$CONFIG.uid+"/whisper"}},h={textLarge:d("#L{您已达到关注上限！}"),textComplex:d('#L{开通}<a href="http://vip.weibo.com/privilege">#L{微博会员}</a>，#L{关注上限立即提高}'),textSmall:d('#L{可}<a href="http://vip.weibo.com/paycenter?pageid=byebank" class="S_link2">#L{开通会员}</a>#L{或先将关注减少至2000人以下，再添加}'),OKText:d("#L{管理我的关注}"),OK:function(){a.preventDefault();window.location.href="/"+$CONFIG.uid+"/follow"}};if(b.type=="quiet"){switch(parseInt(b.errortype,10)){case 2:g.textLarge=d("#L{您当前已达会员等级悄悄关注上限啦！}");g.textSmall="";g.textComplex=d('<a href="http://vip.weibo.com/privilege" class="S_link2">#L{了解更多会员特权信息»}</a>');break;case 1:g.textLarge=d("#L{您已达到悄悄关注上限！}");g.textSmall="";g.textComplex=d('#L{开通}<a href="http://vip.weibo.com/privilege">#L{微博会员}</a>，#L{悄悄关注上限立即提高}');break;case 3:g.textLarge=d("#L{您已达到悄悄关注上限！}");g.textComplex=d('#L{开通}<a href="http://vip.weibo.com/privilege">#L{微博会员}</a>，#L{悄悄关注上限立即提高}');g.textSmall=d('#L{可}<a href="http://vip.weibo.com/paycenter">#L{开通会员}</a>#L{或将悄悄关注减少至10人以下，再添加}')}c=g}else{switch(parseInt(b.errortype,10)){case 2:h.textLarge=d("#L{您当前已达会员等级关注上限啦！}");h.textSmall="";h.textComplex=d('<a href="http://vip.weibo.com/privilege" class="S_link2">#L{了解更多会员特权信息»}</a>');break;case 1:h.textLarge=d("#L{您已达到关注上限！}");h.textSmall="";h.textComplex=d('#L{开通}<a href="http://vip.weibo.com/privilege">#L{微博会员}</a>，#L{关注上限立即提高}');break;case 3:h.textLarge=d("#L{您已达到关注上限！}");h.textComplex=d('#L{开通}<a href="http://vip.weibo.com/privilege">#L{微博会员}</a>，#L{关注上限立即提高}');h.textSmall=d('#L{可}<a href="http://vip.weibo.com/paycenter">#L{开通会员}</a>#L{或将关注减少至2000人以下，再添加}')}c=h}f=e("",c);parseInt(b.errortype,10)==2?f.dia.getDomList().member.style.display="none":f.dia.getDomList().cancel.style.display="none"}});
STK.register("conf.trans.publisher",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("publish_v6",{url:"/aj/mblog/add",method:"post"});c("publish_page",{url:"/p/aj/v6/mblog/add",method:"post",withDomain:!0});c("publish",{url:"/p/aj/v6/mblog/add",method:"post",withDomain:!0});c("publishPro",{url:"/aj/mblog/add",method:"post"});c("interactive",{url:"/aj/mblog/interactive",method:"post"});c("timingPublish",{url:"/aj/v6/mblog/addtime",method:"post"});c("getpublish",{url:"/p/aj/v6/publish",method:"get"});c("reviewadd",{url:"/p/aj/review/add",method:"post"});c("follow",{url:"/aj/f/followed",method:"post"});c("proxy",{url:"/p/aj/proxy",method:"post"});c("getReEdit",{url:"/p/aj/v6/edit",method:"get",withDomain:!0});c("checkeditable",{url:"/aj/v6/mblog/checkeditable",method:"get"});c("publisherReEdit",{url:"/p/aj/v6/mblog/edit",method:"post",withDomain:!0});c("getHistoricRecod",{url:"/p/aj/v6/history",method:"get",withDomain:!0});c("getTopic",{url:"/aj/v6/topic/recent",method:"get"});c("queryTopic",{url:"/aj/v6/topic/search",method:"get"});return b});
STK.register("lib.dialog.ioError",function(a){var b=a.lib.kit.extra.language,c,d;return function(d,e,f){var g={},h,i,j=function(){},k={init:function(){k.data()},data:function(){i=a.parseParam({auto:!0,call:j,ok:j,cancel:j,beside:null},f);h=a.parseParam({location:"",title:"",icon:"",oKText:b("#L{确 定}"),cancelText:b("#L{取 消}"),api:"",reload:"",suda:""},e.data);h.msg=e.msg||b("#L{网络繁忙}");e.data&&e.data.OKText&&(h.okText=e.data.OKText);h.OK=function(){a.preventDefault();var b=a.queryToJson(h.suda||"");b=b.ok||{};window.SUDA&&SUDA.uaTrack&&b.key&&SUDA.uaTrack(b.key,b.value);i.ok();e.data.openNewPage!=1&&h.location&&(window.location.href=h.location)};h.cancel=function(){a.preventDefault();var b=a.queryToJson(h.suda||"");b=b.cancel||{};window.SUDA&&SUDA.uaTrack&&b.key&&SUDA.uaTrack(b.key,b.value);i.cancel()}},run:function(){var a=l[e.code]||l[100001];return a()||i.call(h,e)},destroy:function(){c&&c.destroy()}},l={100001:function(){if(i.beside)a.ui.tipAlert(h.msg,a.core.json.merge(h,{autoHide:!1,icon:"warnS"})).beside(i.beside);else{var b=a.ui.alert(h.msg.split("\\n"),{isCenter:!0},a.core.json.merge(h,{icon:"warnB"}));a.addClassName(b.getOuter(),"W_translateZ")}},100002:function(){a.lib.dialog.loginLayer({lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn"})},100003:function(){function c(){if(h.location&&e.data.openNewPage==1)h.location&&window.open(h.location);else if(h.location)location.href=h.location;else if(h.api){var c=h.api.split("?"),d=a.core.json.merge({api:c[0]},a.queryToJson(c[1]||""));a.conf.trans.publisher.request("proxy",{onSuccess:function(c){a.ui.notice(b(c.msg)||b("#L{请求成功}")).on("hide",function(){var a=FM.getState();$CONFIG.bigpipe?FM.setState(a.split("#")[0]+"#_0"):location.reload()})},onError:function(b){a.lib.dialog.ioError(b.code,b)},onFail:function(b){a.lib.dialog.ioError(b.code,b)}},d)}}i.beside?a.ui.tipConfirm(h.msg,h).ok(c).beside(i.beside):a.ui.confirm(h.msg.split("\n"),h).ok(c)},100004:function(){c||(c=a.lib.dialog.authentication());c.show()},100005:function(){h.type=e.data&&(e.data.type?e.data.type:"follow");h.errortype=e.data&&(e.data.errortype||"1");return a.lib.dialog.memberDialog(h||{})},100008:function(){a.lib.dialog.loginLayer({lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn"})},100012:function(){e.data&&window.open(e.data,"_self")}};k.init();g.getdata=function(){return h};g.getAction=function(a){return a?l[a]:l};g.getCode=function(){return e.code||""};g.run=k.run;i.auto&&k.run();return g}});
STK.register("conf.trans.feed.feed",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("publish",{url:"/aj/mblog/add",method:"post"});c("delete",{url:"/aj/mblog/del",method:"post"});c("forward",{url:"/aj/mblog/forward",method:"post"});c("list",{url:"/aj/fav/mblog/favlist",method:"get"});c("fullText",{url:"/p/aj/mblog/getlongtext",method:"get"});c("getfeed",{url:"/p/aj/v6/mblog/mbloglist",method:"get",withDomain:!0});c("memberTopFeed",{url:"/p/aj/v6/mblog/settop",method:"post",withDomain:!0});c("mediaShow",{url:"//api.weibo.com/widget/show.jsonp",varkey:"jsonp",method:"get",requestMode:"jsonp"});c("widget",{url:"/aj/mblog/showinfo",method:"post"});c("third_rend",{url:"/aj/mblog/renderfeed",method:"post"});c("checkVmember",{url:"/aj/v6/mblog/getpicinfo",method:"get"});c("feedViews",{url:"/aj/vtasks/recom",method:"post"});c("popularizeEffect",{url:"/aj/vip/popeffect",method:"get"});c("deleteTimingBlog",{url:"/aj/mblog/deltime",method:"post"});c("addatonce",{url:"/aj/timeweibo/addatonce",method:"post"});c("timePublish",{url:"/aj/timeweibo/edit",method:"post"});c("timeSelect",{url:"/p/aj/timeweibo/select",method:"get"});c("changeLevel",{url:"/p/aj/v6/mblog/modifyvisible",method:"post",withDomain:!0});c("feedset",{url:"/p/aj/proxy/feedsetting",method:"post"});c("feedset_new",{url:"/p/aj/proxy/feedsettingv6",method:"post"});c("accountset",{url:"/aj/account/settings",method:"post"});c("delSpread",{url:"/aj/feedtrend/filter",method:"post"});c("proxy",{url:"/aj/proxy",method:"post"});c("setAD",{url:"/aj/proxy/adclickserve",method:"post"});c("setADs",{url:"//weibo.com/aj/proxy/adclickserve",method:"get",requestMode:"jsonp",varkey:"callback"});c("setADMonitor",{url:"/aj/proxy/monitor",method:"post"});c("setADMonitors",{url:"//weibo.com/aj/proxy/monitor",method:"get",requestMode:"jsonp",varkey:"callback"});c("adDeal",{url:"/aj/ad/deal",method:"post"});c("adDeals",{url:"//weibo.com/aj/ad/deal",method:"get",requestMode:"jsonp",varkey:"callback"});c("playstatistics",{url:"/aj/video/playstatistics",method:"post"});c("playstatisticss",{url:"//weibo.com/aj/video/playstatistics",method:"get",requestMode:"jsonp",varkey:"callback"});c("playInteractLog",{url:"/aj/log/h5playlog",method:"post"});c("newVideoUrl",{url:"/aj/mblog/videourl",method:"get"});c("newVideoUrls",{url:"//weibo.com/aj/mblog/videourl",method:"get",requestMode:"jsonp",varkey:"callback"});c("autoButton",{url:"/aj/onoff/setstatus",method:"post"});c("gifUrl",{url:"/aj/video/getgifurl",method:"get"});c("recommend",{url:"/p/aj/v6/mblog/videorecommend",method:"get"});c("getInfoFeed",{url:"/p/aj/recommendlist",method:"get"});c("getOtherInfoFeed",{url:"/hotfeedlist/aj_feedlist.php",method:"get"});c("getTianYiInfoFeed",{url:"/hotmblog/aj_feedlist.php",method:"get"});c("getlongtext",{url:"/hotfeedlist/aj_getlongtext.php",method:"get"});c("getrenderfeed",{url:"/hotfeedlist/aj_renderfeed.php",method:"get"});c("getOtherInfoFeed360",{url:"/hotfeedlist/aj_feedlist360.php",method:"get"});c("discoverLazyLoad",{url:"/p/aj/discover/loading",method:"get"});c("hisheadHotspotfeed",{url:"/p/aj/hotspot/hotspotfeed",method:"get"});c("getCuslikeWhiteList",{url:"/aj/praise/userwhite",method:"post"});c("VmemberPic",{url:"/aj/v6/mblog/getpicinfo",method:"get"});return b});
STK.register("lib.kit.extra.merge",function(a){return function(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c}});
STK.register("lib.feed.inter",function(a){var b=window.$CONFIG||{},c=a.lib.kit.extra.language,d=function(b){var c=a.C("div");c.innerHTML=b;window.WBEXP&&window.WBEXP.start(c);c=null};return function(e,f){if(!e)a.log("inter : need object of the baseFeedList Class");else{var g=e.getNode(),h=g.getAttribute("feed-type")||0,i=a.conf.trans.feed.feed,j=a.core.obj.parseParam({trans:i,plNode:null},f),k={request:function(f,g,i,k){if(arguments.length<3)throw new Error("[comp.content.homeFeed]:bindCustEvt()-custom event 'success' should supply enough arguments.");var l=a.lib.kit.extra.parseURL(),m=a.core.json.queryToJson(l.query),n=l.path;i=i||{};n=n.indexOf("/")==0?n:"/"+n;m.key_word&&(m.key_word=encodeURIComponent(m.key_word));m.tag_name&&(m.tag_name=encodeURIComponent(m.tag_name));i=a.lib.kit.extra.merge(i,{pl_name:j.plNode.id,id:b.page_id,script_uri:n,feed_type:h});i=a.lib.kit.extra.merge(m,i);i.page===undefined&&(i.page=1);i.pre_page===undefined&&(i.pre_page=i.page);if(g=="lazyload"){i=a.lib.kit.extra.merge(i,e.getLoadingData());i.domain_op=b.domain||"";var o=!0;function p(){var a=8e3,b=setTimeout(function(){if(!!k){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_home_new","feed_expo_servertimeout");if(o){o=!1;p()}else q(k,c("#L{请求超时}"))}},a+200);j.trans.request("getfeed",{timeout:a,onSuccess:function(a){clearTimeout(b);e.updateFeed(a.data,"bottom","lazyload");d(a.data)},onFail:function(a){clearTimeout(b);if(!!k)if(o){o=!1;p()}else q(k,c("#L{请求超时}"))},onError:function(a){if(a.code==100070)window.location.reload();else{clearTimeout(b);k&&q(k,a.msg||c("#L{请求失败}"))}}},i)}function q(b,d){var e=b.innerHTML;d=d?d+", ":"";a.sizzle(".text",b)[0].innerHTML=d+c('<a href="javascript:void(0);">#L{点击重新载入}</a>');a.addEvent(b,"click",function f(){a.removeEvent(b,"click",f);b.innerHTML=e;p();window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_home_new","feed_click_loadagain")});window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_home_new","feed_expo_loadagain")}p()}g=="newFeed"&&j.trans.request("getfeed",{onSuccess:function(a){e.updateFeed(a.data,"top","newFeed");d(a.data)},onFail:function(a){e.showError("top","newFeed")},onError:function(a){a.code==100070?window.location.reload():e.showError("top","newFeed")}},i)}},l=function(){a.custEvent.add(e,"request",k.request)};l();return{destroy:function(){}}}}});
STK.register("lib.feed.base",function(a){return function(b,c){a.isNode(b)||a.log("feed.base : parameter node is not a document node!");var d={},c=c||{},e=a.lib.feed.API(b,c);for(var f in e)!d[f]&&(d[f]=e[f]);var g=a.lib.feed.inter(d,c),h=function(){e.destroy&&e.destroy();g.destroy&&g.destroy()};d.destroy=h;return d}});
STK.register("lib.kit.dom.parseDOM",function(a){return function(a){for(var b in a)a[b]&&a[b].length==1&&(a[b]=a[b][0]);return a}});
STK.register("lib.feed.plugins.favorite.items.DataController",function(a){return function(b){var c={},d={},e=[],f=0;a.custEvent.define(c,["DispItem","DeletedItem","ItemSuggest"]);c.addItems=function(b){a.isArray(b)||(b=[b]);for(var c=0,g=b.length;c<g;c++){var h=b[c];if(!d[h.id]){f++;d[h.id]={data:h,index:e.length};e.push(h)}}};c.removeItems=function(b){a.isArray(b)||(b=[b]);for(var c=0,g=b.length;c<g;c++){var h=b[c];if(d[h.id]){f>0&&f--;var i=d[h.id].index;delete d[h.id];e[i]=null}}};c.getResult=function(){var a=[];for(var b=0,c=e.length;b<c;b++)e[b]&&a.push(e[b]);return a};c.getResultLength=function(){return f};c.hasKey=function(a){return d[a.id]};c.destroy=function(){a.custEvent.undefine(c);c=d=e=f=undefined};return c}});
STK.register("lib.feed.plugins.favorite.items.DispItem",function(a){return function(b){if(typeof b!="object")throw"DispItem need param object";if(typeof b.custObj!="object")throw"DispItem need custObj custEvent depute";if(typeof b.chosenTpl!="string")throw"DispItem need chosenTpl param";if(typeof b.unChosenTpl!="string")throw"DispItem need unChosenTpl param";if(!a.isNode(b.nodeList))throw"DispItem need nodeList to depute dom";if(typeof b.limitCount!="undefined"&&typeof b.DataController=="undefined")throw"DispItem need DataController when set limitCount";var c=a.core.util.easyTemplate,d=a.lib.kit.extra.language,e=a.lib.kit.dom.firstChild,f=a.lib.kit.extra.merge,g={},h,i;g.addItems=function(e,f){a.isArray(e)||(e=[e]);var g=c(d(f.type=="chosen"?b.chosenTpl:b.unChosenTpl),e).toString();a.insertHTML(b.nodeList,g,"beforeend")};g.addDefalutItems=function(e,f){if(b.defaultNodeList){a.isArray(e)||(e=[e]);var g=c(d(f.type=="chosen"?b.chosenTpl:b.unChosenTpl),e).toString();a.insertHTML(b.defaultNodeList,g,"beforeend")}};g.removeItems=function(c,d){a.isArray(c)||(c=[c]);for(var e=0,f=c.length;e<f;e++){var g=a.sizzle("[itemid='"+(d?c[e].id:c[e])+"']",b.nodeList);g.length&&a.removeNode(g[0])}};var j=function(f,g){a.isArray(f)||(f=[f]);for(var h=0,i=f.length;h<i;h++){var j=a.sizzle("[itemid='"+f[h].id+"']",b.nodeList);if(j.length){var k=a.C("DIV"),l=c(d(g?b.chosenTpl:b.unChosenTpl),[f[h]]).toString();k.innerHTML=l;a.replaceNode(e(k),j[0])}if(b.defaultNodeList){j=a.sizzle("[itemid='"+f[h].id+"']",b.defaultNodeList);if(j.length){var k=a.C("DIV"),l=c(d(g?b.chosenTpl:b.unChosenTpl),[f[h]]).toString();k.innerHTML=l;a.replaceNode(e(k),j[0])}}}},k=function(){if(b.limitCount){var a=b.DataController.getResultLength();return a>=b.limitCount?!0:!1}return!1};g.setCheckedItems=function(a){j(a,!0)};g.setUncheckedItems=function(a){j(a,!1)};g.fireDelegateCheck=function(c){a.foreach(c,function(c){var d=a.sizzle("[itemid="+c.id+"]",b.nodeList)[0];d&&h.fireDom(d,"click",null)})};var l=function(c){setTimeout(function(){if(!k()){var d=f(c.data,{data:c.el.getAttribute("action-data")});g.setCheckedItems(d);a.custEvent.fire(b.custObj,"DispItem",{type:"check",data:d})}else a.custEvent.fire(b.custObj,"DispItem",{type:"focusInput",data:{}})},0)},m=function(c){setTimeout(function(){var d=f(c.data,{data:c.el.getAttribute("action-data")});g.setUncheckedItems(d);a.custEvent.fire(b.custObj,"DispItem",{type:"uncheck",data:d})},0)};h=a.delegatedEvent(b.nodeList);h.add("check","click",l);h.add("uncheck","click",m);if(b.defaultNodeList){i=a.delegatedEvent(b.defaultNodeList);i.add("check","click",l);i.add("uncheck","click",m)}g.destroy=function(){h&&h.destroy();i&&i.destroy();c=d=e=f=g=h=j=k=undefined};return g}});
STK.register("lib.feed.plugins.favorite.items.DeletedItem",function(a){return function(b){if(typeof b!="object")throw"DeletedItem need param object";if(typeof b.custObj!="object")throw"DeletedItem need custObj custEvent depute";if(typeof b.template!="string")throw"DeletedItem need template to display";if(!a.isNode(b.nodeList))throw"DeletedItem need nodeList to depute dom";if(!a.isNode(b.insertBeforeNode))throw"DeletedItem need insertBeforeNode to insert dom";var c=a.core.util.easyTemplate,d=a.lib.kit.extra.language,e=a.lib.kit.extra.merge,f={},g;f.addItems=function(e){a.isArray(e)||(e=[e]);var f=c(d(b.template),e).toString();a.insertHTML(b.insertBeforeNode,f,"beforebegin")};f.removeItems=function(c,d){a.isArray(c)||(c=[c]);for(var e=0,f=c.length;e<f;e++){var g=a.sizzle("[itemid='"+(d?c[e].id:c[e])+"']",b.nodeList);g.length&&a.removeNode(g[0])}};g=a.delegatedEvent(b.nodeList);g.add("remove","click",function(c){setTimeout(function(){var d=e(c.data,{data:c.el.getAttribute("action-data")});f.removeItems(d,!0);a.custEvent.fire(b.custObj,"DeletedItem",{type:"remove",data:d})},0)});f.destroy=function(){g&&g.destroy();c=d=e=g=f=undefined};return f}});
STK.register("lib.feed.plugins.favorite.items.dynamicInputWidth",function(a){return function(b,c){c=c||{};var d={},e,f,g,h=a.core.dom.getSize,i=a.core.dom.setStyle,j,k;a.custEvent.define(d,"textChange");var l=function(){if(!e){e=1;var b=a.core.dom.cssText("");b.push("width","1000px");b.push("height","55px");b.push("position","absolute");b.push("left","-10000px");b.push("top","-10000px");b.push("visibility","hidden");var c=b.getCss();e=1;var d='<div node-type="wrap" style="'+c+'">'+'<span node-type="before"></span>'+"</div>",h=a.core.dom.builder(d);g=h.box;f=a.lib.kit.dom.parseDOM(h.list);document.body.appendChild(g)}},m={focus:function(){clearTimeout(k);k=setTimeout(m.focusFun,200)},focusFun:function(){var e=b.value;if(c.limitWords){var g=a.bLength(e);g>c.limitWords&&(b.value=e=a.leftB(e,c.limitWords))}if(e==j)m.focus();else{j=e;l();f.before.innerHTML=a.encodeHTML(e);var k=h(f.before),n=k.width+20;c.maxInputWidth&&n>c.maxInputWidth&&(n=c.maxInputWidth);i(b,"width",n+"px");m.focus();a.custEvent.fire(d,"textChange",e)}},blur:function(){clearTimeout(k)}},n=function(){a.addEvent(b,"focus",m.focus);a.addEvent(b,"blur",m.blur)},o=function(){a.removeEvent(b,"focus",m.focus);a.removeEvent(b,"blur",m.blur);d=null},p={custObj:d,destroy:o};n();return p}});
STK.register("lib.kit.dom.layoutPos",function(a){return function(b,c,d){if(!a.isNode(c))throw"lib.kit.dom.layerOutElement need element as first parameter";if(c===document.body)return!1;if(!c.parentNode)return!1;if(c.style.display==="none")return!1;var e,f,g,h,i,j,k;e=a.parseParam({pos:"left-bottom",offsetX:0,offsetY:0},d);f=c;if(!f)return!1;while(f!==document.body){f=f.parentNode;if(f.style.display==="none")return!1;j=a.getStyle(f,"position");k=f.getAttribute("layout-shell");if(j==="absolute"||j==="fixed")break;if(k==="true"&&j==="relative")break}f.appendChild(b);g=a.position(c,{parent:f});h={w:c.offsetWidth,h:c.offsetHeight};i=e.pos.split("-");i[0]==="left"?b.style.left=g.l+e.offsetX+"px":i[0]==="right"?b.style.left=g.l+h.w+e.offsetX+"px":i[0]==="center"&&(b.style.left=g.l+h.w/2+e.offsetX+"px");i[1]==="top"?b.style.top=g.t+e.offsetY+"px":i[1]==="bottom"?b.style.top=g.t+h.h+e.offsetY+"px":i[1]==="middle"&&(b.style.top=g.t+h.h/2+e.offsetY+"px");return!0}});
STK.register("lib.feed.plugins.favorite.items.ItemSuggest",function(a){return function(b){if(typeof b!="object")throw"ItemSuggest need object params";if(typeof b.textEl=="undefined")throw"ItemSuggest need textEl";if(typeof b.uiNode=="undefined")throw"ItemSuggest need uiNode";if(typeof b.suggestConf=="undefined")throw"ItemSuggest need suggestConf";if(typeof b.custObj=="undefined")throw"ItemSuggest need custObj";var c=a.lib.kit.dom.parseDOM(a.builder(b.uiNode).list),d,e,f;b=a.lib.kit.extra.merge({actionType:"suggestItem",actionData:"index",suggestType:"local"},b);var g={},h=a.ui.mod.suggest({textNode:b.textEl,uiNode:b.uiNode,actionType:b.actionType,actionData:b.actionData}),i={BACKSPACE:8,SPACE:32},j=a.core.util.easyTemplate,k=a.lib.kit.extra.language,l=a.core.dom.getSize,m={hideSuggest:function(){a.setStyle(b.uiNode,"display","none");a.custEvent.fire(h,"close",{})},keyboardSubmit:function(){a.custEvent.fire(b.custObj,"ItemSuggest",{type:"keyboardSubmit",data:{}})},addOneItem:function(){var c=a.trim(b.textEl.value),e=b.suggestConf.regexp;if(c)if(e(c)){a.custEvent.fire(b.custObj,"ItemSuggest",{type:"addItem",data:{id:c}});a.setStyle(b.textEl,"width","20px");b.textEl.value="";m.hideSuggest();d=null}else a.custEvent.fire(b.custObj,"ItemSuggest",{type:"inputError",data:{value:c}})},localSearch:function(a){var c=b.suggestConf.data,d=b.suggestConf.searchKey,e=[],f=b.suggestConf.suggestMaxCount,g=0;for(var h=0,i=c.length;h<i;h++)if(c[h][d]&&c[h][d].indexOf(a)==0)if(f){if(!(g<f))break;g++;e.push(c[h])}else e.push(c[h]);return e},setLayerPos:function(){a.lib.kit.dom.layoutPos(b.uiNode,b.textEl)},getTemplate:function(d){var e=j(k(b.suggestConf.template),d);c.suggestContent.innerHTML=e;m.setLayerPos();if(d.length){a.setStyle(b.uiNode,"display","");a.custEvent.fire(h,"open",b.textEl)}else m.hideSuggest()},reqSucc:function(b,c){a.isArray(b.data)?m.getTemplate(b.data):m.getTemplate([])},reqFail:function(a,b){m.getTemplate([])},buildTrans:function(){e=b.suggestConf.trans.getTrans(b.suggestConf.transName,{onSuccess:m.reqSucc,onError:m.reqFail,onFail:m.reqFail})},textChange:function(c,d){d&&(d=a.trim(d));if(!d)m.hideSuggest();else if(b.suggestType==="local"){var e=m.localSearch(d);m.getTemplate(e)}else if(b.suggestType==="net"){clearTimeout(f);f=setTimeout(function(){m.sendRequest(d)},100)}a.custEvent.fire(b.custObj,"ItemSuggest",{type:"textChange",data:{value:d}})},sendRequest:function(a){e||m.buildTrans();e.abort();e.request({q:a})},removeJudge:function(){var c=b.textEl.value;c==""&&a.custEvent.fire(b.custObj,"ItemSuggest",{type:"remove",data:{}})},onSpace:function(b){b=a.fixEvent();var c=b.keyCode||b.which;if(c==i.SPACE){m.addOneItem();a.preventDefault()}},onKeyDown:function(b){b=a.fixEvent();var c=b.keyCode||b.which;if(c==i.BACKSPACE)m.removeJudge();else if(c==13||c==10){m.hideSuggest();m.keyboardSubmit()}},blur:function(){var a=m.hideSuggest;setTimeout(function(){a();a=undefined},150)},changeCurrent:function(c,e){var f=b.suggestConf.currentClass;d&&a.removeClassName(d,f);var g=a.sizzle(b.suggestConf.itemTagName,b.uiNode);if(g[e]){a.addClassName(g[e],f);d=g[e]}else d=null},selectItem:function(c,e){c=a.fixEvent();if(!c.ctrlKey){var f=a.sizzle(b.suggestConf.itemTagName,b.uiNode);if(f[e]){a.setStyle(b.textEl,"width","20px");b.textEl.value="";var g=f[e].getAttribute("action-data");a.custEvent.fire(b.custObj,"ItemSuggest",{type:"select",data:g});m.hideSuggest();try{b.textEl.focus()}catch(h){}d=null}}}},n=a.lib.feed.plugins.favorite.items.dynamicInputWidth(b.textEl,{maxInputWidth:b.maxInputWidth,limitWords:b.limitWords});a.custEvent.add(n.custObj,"textChange",m.textChange);a.addEvent(b.textEl,"blur",m.blur);a.addEvent(b.textEl,"keypress",m.onSpace);a.addEvent(b.textEl,"keydown",m.onKeyDown);a.custEvent.add(h,"onIndexChange",m.changeCurrent);a.custEvent.add(h,"onSelect",m.selectItem);g.destroy=function(){a.custEvent.fire(h,"close",{});n&&a.custEvent.undefine(n.custObj);n&&n.destroy();a.removeEvent(b.textEl,"blur",m.blur);a.removeEvent(b.textEl,"keypress",m.onSpace);a.removeEvent(b.textEl,"keydown",m.onKeyDown);c=d=e=f=g=h=i=j=k=l=m=n=undefined};return g}});
STK.register("lib.kit.extra.textareaUtils",function(a){var b={},c=document.selection;b.selectionStart=function(a){if(!c)try{return a.selectionStart}catch(b){return 0}var d=c.createRange(),e,f,g=0,h=document.body.createTextRange();try{h.moveToElementText(a)}catch(b){}for(g;h.compareEndPoints("StartToStart",d)<0;g++)h.moveStart("character",1);return g};b.selectionBefore=function(a){return a.value.slice(0,b.selectionStart(a))};b.selectText=function(a,b,d){a.focus();if(!c)a.setSelectionRange(b,d);else{var e=a.createTextRange();e.collapse(1);e.moveStart("character",b);e.moveEnd("character",d-b);e.select()}};b.insertText=function(a,d,e,f){a.focus();f=f||0;if(!c){var g=a.value,h=e-f,i=h+d.length;a.value=g.slice(0,h)+d+g.slice(e,g.length);b.selectText(a,i,i)}else{var j=c.createRange();j.moveStart("character",-f);j.text=d}};b.replaceText=function(a,d){a.focus();var e=a.value,f=b.getSelectedText(a),g=f.length;if(f.length==0)b.insertText(a,d,b.getCursorPos(a));else{var h=b.getCursorPos(a);if(!c){var j=h+f.length;a.value=e.slice(0,h)+d+e.slice(h+g,e.length);b.setCursor(a,h+d.length);return}var i=c.createRange();i.text=d;b.setCursor(a,h+d.length)}};b.getCursorPos=function(a){var b=0;if(STK.core.util.browser.IE){a.focus();var d=null;d=c.createRange();var e=d.duplicate();e.moveToElementText(a);e.setEndPoint("EndToEnd",d);a.selectionStartIE=e.text.length-d.text.length;a.selectionEndIE=a.selectionStartIE+d.text.length;b=a.selectionStartIE}else if(a.selectionStart||a.selectionStart=="0")b=a.selectionStart;return b};b.getSelectedText=function(a){var b="",d=function(a){return a.selectionStart!=undefined&&a.selectionEnd!=undefined?a.value.substring(a.selectionStart,a.selectionEnd):""};window.getSelection?b=d(a):b=c.createRange().text;return b};b.setCursor=function(a,b,c){b=b==null?a.value.length:b;c=c==null?0:c;a.focus();if(a.createTextRange){var d=a.createTextRange();d.move("character",b);d.moveEnd("character",c);d.select()}else a.setSelectionRange&&a.setSelectionRange(b,b+c)};b.unCoverInsertText=function(a,b,c){c=c==null?{}:c;c.rcs=c.rcs==null?a.value.length:c.rcs*1;c.rccl=c.rccl==null?0:c.rccl*1;var d=a.value,e=d.slice(0,c.rcs),f=d.slice(c.rcs+c.rccl,d==""?0:d.length);a.value=e+b+f;this.setCursor(a,c.rcs+(b==null?0:b.length))};return b});
STK.register("lib.feed.plugins.favorite.items.DataItemPicker",function(a){return function(b){var c=a.core.dom.getSize,d=a.lib.kit.extra.merge,e={},f,g,h,i,j,k,l,m,n=0,o=!1,p=function(){if(typeof b!="object")throw"DataItemPicker need params object";if(!a.isNode(b.container))throw"DataItemPicker need container(node)";if(typeof b.DispItem=="undefined")throw"DataItemPicker need DispItem(boolean)";if(typeof b.DispItemConf!="object")throw"DataItemPicker need DispItemConf";if(typeof b.DeletedItem=="undefined")throw"DataItemPicker need DeleteItem(boolean)";if(typeof b.DeletedItemConf!="object")throw"DataItemPicker need DeletedItemConf";if(typeof b.ItemSuggest=="undefined")throw"DataItemPicker need DeleteItem(boolean)";if(typeof b.ItemSuggestConf!="object")throw"DataItemPicker need ItemSuggestConf";k=b.DispItem;l=b.DeletedItem;m=b.ItemSuggest;o=b.resetHeight},q=function(){f=a.lib.kit.dom.parseDOM(a.builder(b.container).list)},r=function(){if(m){a.addEvent(f.container,"click",u.focusInput);a.addEvent(f.suggestInput,"focus",u.suggestFocus);a.addEvent(f.suggestInput,"blur",u.suggestBlur)}},s=function(){g=a.lib.feed.plugins.favorite.items.DataController({custObj:e});k&&(h=a.lib.feed.plugins.favorite.items.DispItem({custObj:g,limitCount:b.limitCount,DataController:g,nodeList:f.dispItemList,defaultNodeList:f.dispItemListRecommend,chosenTpl:b.DispItemConf.chosenTpl,unChosenTpl:b.DispItemConf.unChosenTpl}));l&&(i=a.lib.feed.plugins.favorite.items.DeletedItem({custObj:g,template:b.DeletedItemConf.template,nodeList:f.container,insertBeforeNode:f.suggestInput}));m&&(j=a.lib.feed.plugins.favorite.items.ItemSuggest({textEl:f.suggestInput,uiNode:b.ItemSuggestConf.suggestList,suggestType:b.ItemSuggestConf.suggestType,suggestConf:b.ItemSuggestConf.suggestConf,maxInputWidth:b.ItemSuggestConf.maxInputWidth,limitWords:b.ItemSuggestConf.limitWords,regexp:b.ItemSuggestConf.regexp,custObj:g}));k&&a.custEvent.add(g,"DispItem",function(b,c){if(c.type=="check"){if(!u.getLimitReach()){g.addItems(c.data);a.custEvent.fire(e,"checkedDespItem",{data:c})}}else c.type=="uncheck"?g.removeItems(c.data):c.type=="focusInput"&&u.focusInput()});l&&a.custEvent.add(g,"DeletedItem",function(b,c){if(c.type=="remove"){g.removeItems(c.data);h.setUncheckedItems(c.data);u.resetHeight();a.custEvent.fire(e,"DeletedItemRemove",{DataController:g})}});m&&a.custEvent.add(g,"ItemSuggest",function(b,c){if(c.type=="remove"){var j=a.sizzle("[action-type='remove']:last",f.container);if(j.length){var k=a.queryToJson(j[0].getAttribute("action-data"));k=d(k,{data:j[0].getAttribute("action-data")});g.removeItems(k);i.removeItems(k,!0);h.setUncheckedItems(k);u.resetHeight()}a.custEvent.fire(e,"backspaceKey",{})}else if(c.type=="select"){var l=c.data,k=a.queryToJson(l);k=d(k,{data:l});var m=g.hasKey(k);if(!m){if(!u.getLimitReach()){g.addItems(k);i.addItems(k);h.setCheckedItems(k)}u.resetHeight()}}else if(c.type=="textChange"){u.resetHeight();a.custEvent.fire(e,"textChange",c.data)}else if(c.type=="inputError")a.custEvent.fire(e,"inputError",c.data);else if(c.type=="addItem"){var n=c.data.id,k={id:n,data:"id="+n+"&text="+n,text:n},m=g.hasKey(k);if(!m){if(!u.getLimitReach()){g.addItems(k);i.addItems(k);h.setCheckedItems(k);a.custEvent.fire(e,"spaceAddItem",c.data)}u.resetHeight()}}else c.type=="keyboardSubmit"&&a.custEvent.fire(e,"keyboardSubmit",c.data)})},t=function(){a.custEvent.define(e,["resultChange","textChange","inputError","keyboardSubmit","backspaceKey","DeletedItemRemove","spaceAddItem","checkedDespItem"])},u={suggestFocus:function(){n=1},suggestBlur:function(){n=0},getLimitReach:function(){if(b.limitCount){var a=g.getResultLength();return a>=b.limitCount?!0:!1}return!1},focusInput:function(){if(!n){a.lib.kit.extra.textareaUtils.setCursor(f.suggestInput);n=1}},resetHeight:function(){if(!!o){var d=g.getResultLength();if(d){var e=a.position(f.suggestInput),h=a.position(f.container),i=c(f.suggestInput),j=e.t+i.height-h.t+3,k=c(f.container).height;k!=j&&a.setStyle(f.container,"height",j+"px")}else a.setStyle(f.container,"height",b.containerMinHeight+"px")}}},v=function(){p();q();r();s();t()};v();e.getDispItem=function(){return h};e.getDeletedItem=function(){return i};e.getDataController=function(){return g};e.focusInput=u.focusInput;e.resetHeight=u.resetHeight;e.destroy=function(){g.destroy();k&&h&&h.destroy();l&&i&&i.destroy();if(m){j&&j.destroy();a.removeEvent(f.container,"click",u.focusInput);a.removeEvent(f.suggestInput,"focus",u.suggestFocus);a.removeEvent(f.suggestInput,"blur",u.suggestBlur)}e=f=g=h=i=j=undefined;c=d=k=l=m=n=v=u=undefined};return e}});
STK.register("conf.trans.feed.favorite",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("add",{url:"/aj/fav/mblog/add",method:"post"});c("del",{url:"/aj/fav/mblog/del",method:"post"});c("change",{url:"/aj/fav/tag/renew",method:"get"});c("tagList",{url:"/aj/fav/tag/list",method:"get"});c("delTag",{url:"/aj/fav/tag/destroy",method:"post"});c("updateTag",{url:"/aj/fav/tag/update",method:"post"});c("alter",{url:"/aj/fav/tag/alter",method:"post"});c("favlist",{url:"/aj/fav/mblog/favlist",method:"get"});c("getFav",{url:"/aj/fav/mblog/byTag",method:"get"});c("saveTag",{url:"/aj/fav/mblog/save",method:"post"});c("legend",{url:"/aj/fav/mblog/legend",method:"get"});c("edit",{url:"/aj/fav/tag/edit",method:"get"});return b});
STK.register("lib.kit.extra.getDiss",function(a){return function(){var b={},c=0,d={location:$CONFIG.location};arguments[0]&&!a.core.dom.isNode(arguments[0])&&(b=arguments[c++]);b=a.lib.kit.extra.merge(b,d);if(!arguments[c])return b;b=a.lib.kit.extra.merge(b,a.core.json.queryToJson(a.lib.kit.dom.parentAttr(arguments[c++],"diss-data",arguments[c])||""));return b}});
STK.register("lib.feed.plugins.favorite.borderedInput",function(a){return function(b,c){c=a.parseParam({addClass:"W_input_focus",removeClass:"W_input_focus",findEl:null},c);var d={};if(!a.isNode(b))return{destroy:a.funcEmpty};var e=function(){var a;c.findEl?a=c.findEl(b):a=b;return a},f=function(){var b=e();a.addClassName(b,c.addClass)},g=function(){var b=e();a.removeClassName(b,c.removeClass)};a.addEvent(b,"focus",f);a.addEvent(b,"blur",g);d.destroy=function(){a.removeEvent(b,"focus",f);a.removeEvent(b,"blur",g)};return d}});
STK.register("lib.feed.plugins.favorite.rectsPosition",function(a){var b=a.core.util.browser,c={},d=5,e=20,f={t:function(a,b){return a.t>b.h},b:function(a,b){return a.b>b.h},l:function(a,b){return a.l>b.w},r:function(a,b){return a.r>b.w}},g={domSize:function(b){var c=a.core.dom.getSize(b);return{w:Math.max(c.width,a.getStyle(b,"width").replace(/px|auto/gi,"")),h:Math.max(c.height,a.getStyle(b,"height").replace(/px|auto/gi,""))}},mouseXY:function(c){var d={x:c.pageX,y:c.pageY};if(b.IE6||b.IE7){var e=a.core.util.scrollPos();d.x=d.x+e.left;d.y=d.y+e.top}return d},getRows:function(a){var c=a.getClientRects();if(b.IE6||b.IE7){var d=[],e={},f;for(var g=0,h=c.length;g<h;g++){var i=c[g];e[i.top]||(e[i.top]=[]);e[i.top].push(i)}for(var j in e){var k=e[j],h=k.length,l=k[0];h>1&&(l.right=k[h-1].right);d.push(l)}c=d}return c},getTextRect:function(b,c){var d=a.parseParam({evt:""},c),e=a.core.util.scrollPos(),f;if(!b.getClientRects){var h=g.domSize(b);return{width:h.w,height:h.h,left:"",right:"",top:"",bottom:""}}var i={rows:g.getRows(b)},j=g.mouseXY(d.evt),k={x:j.x-e.left,y:j.y-e.top};for(var l=0,m=i.rows.length;l<m;l++){var n=i.rows[l];l==0&&(f=n);if(k.y>n.top&&k.y<n.bottom){f=n;break}}if(a.IE){var h=g.domSize(b);f=a.parseParam({width:h.w,height:h.h,left:"",right:"",top:"",bottom:""},f)}return f},getDistance:function(b,c){var d=a.core.util.winSize(),e=g.getTextRect(b,c);return{win:d,rect:e,w:e.width,h:e.height,t:e.top,l:e.left,r:d.width-e.right,b:d.height-e.bottom}},getSeat:function(b,c,d){var h=a.parseParam({distance:e,priority:"trbl"},d),i=g.getDistance(b,d),j=g.domSize(c);i.area="b";var k=h.priority.split("");for(var l=0,m=k.length;l<m;l++){var n=k[l];if(!f[n])throw'priority error, random use "tbrl" combination';if(f[n](i,j)){i.area=n;break}}return i},setArrow:function(b){var c=a.parseParam({evt:"",node:"",layer:"",arrow:"",priority:"trbl",css_t:"arrow arrow_b",css_r:"arrow arrow_l",css_b:"arrow arrow_t",css_l:"arrow arrow_r",offset:d,distance:e},b);if(!c.node)throw"target node is undefined";if(!c.layer)throw"layer node is undefined";if(!c.arrow)throw"arrow node is undefined";var f=g.getSeat(c.node,c.layer,c),h=f.area,i=f.rect;c.arrow.className=c["css_"+h];var j=g.domSize(c.layer),k=a.scrollPos(),l,m;if(h=="t"||h=="b"){l=h=="t"?i.top+k.top-j.h-c.offset:i.bottom+k.top+c.offset;m=i.left+k.left-c.distance}else{l=i.top+k.top-c.distance;m=h=="r"?i.right+k.left+c.offset:i.left+k.left-j.w-c.offset}c.layer.style.top=l+"px";c.layer.style.left=m+"px"},setLayer:function(b){var c=a.parseParam({evt:"",node:"",layer:"",priority:"btrl",offsetX:0,offsetY:0},b);if(!c.node)throw"target node is undefined";if(!c.layer)throw"layer node is undefined";var d=g.getSeat(c.node,c.layer,c),e=d.area,f=d.rect,h=g.domSize(c.layer),i=a.scrollPos(),j,k;if(e=="t"||e=="b"){j=e=="t"?f.top+i.top-h.h+c.offsetY:f.bottom+i.top-c.offsetY;k=f.left+i.left+c.offsetX}else{j=f.top+i.top+c.offsetY;k=e=="r"?f.right+i.left-c.offsetX:f.left+i.left-h.w+c.offsetX}c.layer.style.top=j+"px";c.layer.style.left=k+"px"}};c.getTextRect=g.getTextRect;c.getDistance=g.getDistance;c.getSeat=g.getSeat;c.setArrow=g.setArrow;c.setLayer=g.setLayer;return c});
STK.register("lib.kit.touch.cantouch",function(a){return STK.core.util.browser.IPAD});
STK.register("lib.feed.plugins.favorite.tagDialog",function(a){var b=function(a,b){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack(a,b)};return function(c){var d,e,f,g,h,i,j,k,l,m,n={},o=0,p,q,r=a.lib.kit.extra.language,s=a.core.util.easyTemplate,t={ADD:{text:r("#L{最多两个标签，用空格分隔}"),className:"W_tips tips_warn clearfix",classNameS:"icon_warnS W_icon"},DEFAULT:{text:r("#L{添加标签来管理你的收藏。}"),className:"W_tips tips_warn clearfix",classNameS:"icon_warnS W_icon"},ERROR:{text:r("#L{仅支持中英文、数字、冒号与“_”}"),className:"W_tips tips_rederror clearfix",classNameS:"W_icon icon_rederrorS"},MAX:{text:r("#L{每条微博最多添加两个标签}"),className:"W_tips tips_rederror clearfix",classNameS:"W_icon icon_rederrorS"},SAME:{text:r("#L{标签不能重复}"),className:"W_tips tips_rederror clearfix",classNameS:"W_icon icon_rederrorS"}},u=function(){if(typeof c=="undefined")throw"tagBubble need params";if(!a.isNode(c.el))throw"tagBubble need el to show";if(typeof c.mid=="undefined")throw"tagBubble need mid to commit";if(typeof c.serverData=="undefined")throw"tagBubble need serverData to show"},v=function(){d=(c.serverData.my_tags||"").split(" ");d.length==1&&d[0]==""?d.length=0:d.sort(function(a,b){return a.length>b.length});e=(c.serverData.recommend_tags||"").split(" ");e.length==1&&e[0]==""?e.length=0:e.sort(function(a,b){return a.length>b.length});f=(c.serverData.choose_tags||"").split(" ");f.length==1&&f[0]==""&&(f.length=0);g=c.serverData.mblog_tags||[];var b=y.getLabel(),j={labelText:b.text,labelClass:b.className,labelClassS:b.classNameS,uniqueId:a.getUniqueKey()},k=d.length&&e.length?"S_line1":"",l='<#et favouriteBubble data><div class="W_layer"><div class="content" node-type="inner"><div node-type="eventnode"><div class="W_layer_title" node-type="title">#L{收藏}</div><div class="W_layer_close"><a node-type="close" href="javascript:;" class="W_ficon ficon_close S_ficon">X</a></div><div class="layer_add_collect"><div class="tip-box"><div class="icon-box"><span class="W_icon icon_succB"></span></div><div class="txt-box">#L{收藏成功！}</div></div><div class="addbox"><div class="W_tips tips_warn clearfix" node-type="tipState"><p class="icon"><span class="W_icon icon_warnS" node-type="tipStateS"></span></p><p class="txt" node-type="labelText">#L{添加标签来管理你的收藏。}</p></div><dl class="f_normal clearfix" '+(e.length?"":'style="display:none;"')+">"+'<dt class="f_tit">#L{推荐标签：}</dt>'+'<dd class="f_con">'+'<div class="tags" node-type="dispItemListRecommend">'+"</div>"+"</dd>"+"</dl>"+'<dl class="f_normal clearfix" '+(d.length?"":'style="display:none;"')+">"+'<dt class="f_tit">#L{我的标签：}</dt>'+'<dd class="f_con">'+'<div class="tags" node-type="dispItemList">'+"</div>"+"</dd>"+"</dl>"+'<a href="javascript:void(0);" '+(e.length==0&&d.length==0?'style="display:none;"':"")+' action-type="createNew" class="btn_add S_txt1"><em class="W_ficon ficon_add">+</em>#L{创建新标签}</a>'+'<div class="input_outer W_input_focus" node-type="container" '+(e.length==0&&d.length==0?"":'style="display:none;"')+">"+'<input type="text" class="W_input" name="${data.uniqueId}" id="${data.uniqueId}" node-type="suggestInput" autocomplete="off">'+"</div>"+"</div>"+"</div>"+'<div class="W_layer_btn S_bg1">'+'<a action-type="commitBtn" node-type="commitBtn" href="javascript:;" class="W_btn_a">#L{添加}</a>'+'<a action-type="cancelBtn" href="javascript:;" class="W_btn_b">#L{取消}</a>'+"</div>"+"</div>"+'<div node-type="suggestList" class="layer_menu_list" style="position:absolute;z-index:10000;display:none;">'+'<ul node-type="suggestContent">'+"</ul>"+"</div>"+"</div>"+"</#et>",m=s(r(l),j).toString();i=a.ui.dialog({template:m}).show();h=a.lib.kit.dom.parseDOM(a.builder(i.getBox()).list)},w=function(){l=a.delegatedEvent(h.eventnode);l.add("commitBtn","click",y.commitBtn);l.add("createNew","click",y.createNew);l.add("cancelBtn","click",y.cancelBtn);q=a.lib.feed.plugins.favorite.borderedInput(h.suggestInput,{addClass:"W_input_focus",removeClass:"W_input_focus",findEl:function(a){return h.container}})},x=function(){var b=[];d.length&&(b=b.concat(y.buildItems(d)));g.length&&(b=b.concat(y.buildItems(g)));var c={};for(var e=0,f=b.length;e<f;e++)c[b[e].id]=b[e];b.length=0;for(var k in c)b[b.length]=c[k];j=a.lib.feed.plugins.favorite.items.DataItemPicker({resetHeight:!1,limitCount:2,container:i.getBox(),DispItem:!0,DeletedItem:!0,ItemSuggest:!0,DispItemConf:{chosenTpl:'<#et chosenTpl data><#list data as list><span action-type="uncheck" action-data="${list.data}" title="${list.text}" itemid="${list.id}" class="W_btn_b W_btn_tag W_btn_tag_cur"><span class="W_arrow_bor W_arrow_bor_l"><i class="S_line3"></i><em class="S_bg1_br"></em></span><a href="javascript:void(0);" class="tag_txt W_autocut S_txt1">${list.text}</a></span></#list></#et>',unChosenTpl:'<#et unChosenTpl data><#list data as list><span action-type="check" action-data="${list.data}" itemid="${list.id}" title="${list.text}" class="W_btn_b W_btn_tag"><span class="W_arrow_bor W_arrow_bor_l"><i class="S_line3"></i><em class="S_bg2_br"></em></span><a href="javascript:void(0);" class="tag_txt W_autocut S_txt1">${list.text}</a></span></#list></#et>'},DeletedItemConf:{template:function(){return'<#et deleteList data><#list data as list><span itemid="${list.id}" class="W_btn_b W_btn_tag"><span class="W_arrow_bor W_arrow_bor_l"><i class="S_line3"></i><em class="S_bg2_br"></em></span>${list.text}<a href="javascript:void(0);" action-type="remove" action-data="${list.data}" class="W_ficon ficon_close S_ficon">X</a></span></#list></#et>'}()},ItemSuggestConf:{suggestType:"none",suggestList:h.suggestList,suggestConf:{regexp:function(a){return a==="全部"||a==="未加标签"||a==="未加標籤"?!1:/^[a-zA-Z0-9\u4e00-\u9fa5_:：]+$/.test(a)?!0:!1},suggestMaxCount:5,itemTagName:"li",currentClass:"cur",template:'<#et suggest data><#list data as list><li action-type="suggestItem" action-data="${list.data}"><a href="javascript:void(0)">${list.text}</a></li></#list></#et>',data:b,searchKey:"text"},maxInputWidth:200,limitWords:12},containerMinHeight:22})},y={deletedItemRemove:function(b,c){var d=a.trim(h.suggestInput.value);y.regExpTest({},{value:d})},commitSucc:function(){a.custEvent.fire(n,"success",{})},commitError:function(b,c){a.custEvent.fire(n,"error",{msg:b.msg})},commitFail:function(){a.custEvent.fire(n,"error",{msg:r("#L{标签添加失败}")})},getResultStr:function(){var a=k.getResult(),b=[];for(var c=0,d=a.length;c<d;c++)b.push(a[c].id);return b.join(" ")},cancelBtn:function(b){a.preventDefault(b.evt);i.hide()},realSubmit:function(b){var d=y.getResultStr();b&&(d?d+=" "+b:d=b);if(!d)i.hide();else{var e={mid:c.mid,tags:d};e=a.lib.kit.extra.getDiss(e);o=1;try{h.suggestInput.blur()}catch(f){}a.conf.trans.feed.favorite.request("alter",{onSuccess:y.commitSucc,onError:y.commitError,onFail:y.commitFail},e);i.hide()}},inArray:function(a,b){for(var c=0,d=b.length;c<d;c++)if(b[c].id==a)return!0;return!1},commit:function(){y.commitSuda();var b=a.trim(h.suggestInput.value);if(b){var c=k.getResult();if(c.length>=2){y.setLabel("max");j.focusInput()}else if(!/^[a-zA-Z0-9\u4e00-\u9fa5_:：]+$/.test(b)){y.setLabel("error");j.focusInput()}else{var d=y.inArray(b,c);if(d){y.setLabel("same");j.focusInput()}else y.realSubmit(b)}}else y.realSubmit()},commitBtn:function(b){a.preventDefault(b.evt);o||y.commit()},createNew:function(a){a.el.style.display="none";h.container.style.display="";j.focusInput()},getLabel:function(){return d.length?t.ADD:t.DEFAULT},buildItems:function(a){var b=[];for(var c=0,d=a.length;c<d;c++){var e=a[c];b.push({id:e,data:"id="+e+"&text="+e,text:e})}return b},regExpTest:function(a,b){var c=b.value;if(c==""||/^[a-zA-Z0-9\u4e00-\u9fa5_:：]+$/.test(c)){var d=k.getResultLength();d?y.setLabel("add"):y.setLabel("default")}},backSpaceKey:function(){y.regExpTest({},{value:""})},setLabel:function(a,b){if(a=="right"){var c=y.getLabel();h.labelText.innerHTML=c.text;h.tipState.className=c.className;h.tipStateS.className=c.classNameS}else{var c=t[a.toUpperCase()];h.labelText.innerHTML=b||c.text;h.tipState.className=c.className;h.tipStateS.className=c.classNameS}},inputError:function(a,b){b.value==="全部"||b.value==="未加标签"||b.value==="未加標籤"?y.setLabel("error",r("#L{对不起，不能使用此标签}")):y.setLabel("error")},bubbleHide:function(){o||y.closeSuda();B();a.custEvent.remove(i,"hide",arguments.callee)},showFavSucc:function(){o||a.custEvent.fire(n,"success",{blankNoTag:!0});o=undefined;a.custEvent.remove(i,"hide",arguments.callee)},spaceAddItemSuda:function(){b("favor","input_tag")},checkedDespItemSuda:function(){b("favor","click_tag")},closeSuda:function(){b("favor","identify_cancel")},commitSuda:function(){b("favor","identify_do")}},z=function(){a.custEvent.define(n,["success","error"]);a.custEvent.add(j,"textChange",y.regExpTest);a.custEvent.add(j,"inputError",y.inputError);a.custEvent.add(j,"keyboardSubmit",y.commit);a.custEvent.add(j,"backspaceKey",y.backSpaceKey);a.custEvent.add(j,"DeletedItemRemove",y.deletedItemRemove);a.custEvent.add(j,"spaceAddItem",y.spaceAddItemSuda);a.custEvent.add(j,"checkedDespItem",y.checkedDespItemSuda)},A=function(){var b=j.getDispItem(),c=y.buildItems(d.slice(0,5));b.addItems(c,{type:"unChosen"});if(f.length){c=y.buildItems(f.slice(0,5));b.fireDelegateCheck(c)}if(e.length){c=y.buildItems(e.slice(0,5));b.addDefalutItems(c,{type:"unChosen"})}var h=j.getDeletedItem(),l=y.buildItems(g);h.addItems(l);b.setCheckedItems(l);k=j.getDataController();k.addItems(l);document.body.appendChild(i.getBox());i.show();a.custEvent.add(i,"hidden",y.showFavSucc);a.custEvent.add(i,"hidden",y.bubbleHide);j.resetHeight()},B=function(){q&&q.destroy&&q.destroy();l&&l.destroy();j&&j.destroy();a.removeNode(i.getBox());i&&i.destroy();a.custEvent.undefine(j);d=g=j=k=l=m=p=undefined;h=r=s=t=y=A=C=B=q=undefined},C=function(){u();v();w();x();z();a.lib.kit.touch.cantouch||A()};C();n.destroy=B;return n}});
STK.register("lib.kit.extra.sendImage",function(a){var b={};return function(c,d){c=[].concat(c);d=a.core.json.merge({wb_time:+(new Date)},d);var e;while(e=c.shift()){var f=a.getUniqueKey(),g=b[f]=new Image;g.onload=g.onerror=function(){g.onload=g.onerror=null;delete b[f];g=null};g.src=e+(e.indexOf("?")>-1?"&":"?")+a.jsonToQuery(d)}}});
STK.register("lib.feed.plugins.favorite.init",function(a){var b=a.lib.kit.extra.language,c=b("#L{取消收藏}"),d=b("#L{收藏}"),e=b('<span><em class="W_ficon ficon_favorite S_spetxt">û</em><em>#L{已收藏}</em></span>'),f=b('<span><em class="W_ficon ficon_favorite S_ficon">û</em><em>#L{收藏}</em></span>'),g=function(){window.location.href="/fav";return};return function(d,h){function q(a){var b=!a.el.getAttribute("favorite"),c=l.getFeedNode(a.el),d=c.getAttribute("mid");b?o(a.el,d,c):p(a.el,d,c)}function p(e,h,j){var k=a.queryToJson(j.getAttribute("data-mark")||""),l=function(a){var b=[];for(var c=0;c<a.attributes.length;c++)a.attributes[c].name.indexOf("data-mark-third-analysis")===0&&b.push(a.attributes[c].value);return b}(j),m=a.lib.kit.extra.getDiss(j),o={mid:h};o=a.core.json.merge(o,k);o=a.core.json.merge(o,m);a.ui.confirm(b("#L{确定要取消收藏吗？}")).ok(function(){n("del",o,function(b){e.removeAttribute("favorite");var h=a.sizzle('[node-type="favorite_btn_text"]',e)[0]||e;a.sizzle(".W_ficon",h)[0]?h.innerHTML=f:h.innerHTML=c;if(i)var m=a.tween(j,{end:function(){m.destroy();a.removeNode(j);var b=a.lib.kit.extra.parseURL(),c=a.core.json.queryToJson(b.query),e="";b.path=="fav"&&(e="page");a.custEvent.fire(d,"request",[e,c]);d.getFeedCount()<1&&g()}}).play({height:0});k.mark&&a.conf.trans.feed.feed.request("setADMonitor",{},{action_id:"14000045",monitor:a.foreach(l,function(a){return encodeURIComponent(a)}).join("|"),mark:k.mark})})})}function o(b,d,f){var g=a.queryToJson(f.getAttribute("data-mark")||""),h=function(a){var b=[];for(var c=0;c<a.attributes.length;c++)a.attributes[c].name.indexOf("data-mark-third-analysis")===0&&b.push(a.attributes[c].value);return b}(f),i=a.lib.kit.extra.getDiss(f),j={mid:d};j=a.core.json.merge(j,g);j=a.core.json.merge(j,i);n("add",j,function(f){b.setAttribute("favorite","1");var i=a.sizzle('[node-type="favorite_btn_text"]',b)[0]||b;a.sizzle(".W_ficon",i)[0]?i.innerHTML=e:i.innerHTML=c;a.lib.feed.plugins.favorite.tagDialog({mid:d,el:b,serverData:f});if(g.mark&&g.monitor_mask&&g.monitor_mask&1048576){a.lib.kit.extra.sendImage(h,{action_id:"14000045"});a.conf.trans.feed.feed.request("setADMonitor",{},{action_id:"14000045",monitor:a.foreach(h,function(a){return encodeURIComponent(a)}).join("|"),mark:g.mark})}})}function n(b,c,d){if(!m){m=!0;a.conf.trans.feed.favorite.request(b,{onError:function(b){m=!1;a.lib.dialog.ioError(b.code,b)},onFail:function(b){m=!1;a.lib.dialog.ioError(b.code,b)},onSuccess:function(a){m=!1;d(a.data)}},c)}}var i=h.isFavoritePage,j=d.getDEvent(),k=d.getNode(),l=d.utils,m=!1;j.add("fl_favorite","click",q);return{destroy:function(){j.remove("fl_favorite","click",q)}}}});
STK.register("lib.kit.dom.rotateImage",function(a){var b={},c=function(c){var d=a.core.dom.uniqueID(c);return b[d]||(b[d]={})},d={0:0,90:1,180:2,270:3},e=function(a,b){a=((b||0)+a)%360;a<0&&(a=360+a);var c=Math.PI*a/180,d=Math.round(Math.cos(c)*Math.pow(10,15))/Math.pow(10,15),e=Math.round(Math.sin(c)*Math.pow(10,15))/Math.pow(10,15);return{sin:e,cos:d,M11:d,M12:-e,M21:e,M22:d,angle:a,rotation:c}},f=function(b,c,f,g){f=f||440;var h=e(c,g.oldAngle);c=g.oldAngle=h.angle;b.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+h.M11+",M12="+h.M12+",M21="+h.M21+",M22="+h.M22+",SizingMethod='auto expand')";a.setStyle(b.parentNode,"position","relative");if(d[c]%2==0){b.width=g.originalWidth;b.height=g.originalHeight;a.setStyle(b.parentNode,"height",b.height+"px");a.setStyle(b,"position","static")}else if(d[c]%2==1){b.height=g.originalHeight>f?f:g.originalHeight;b.width=b.height*g.originalWidth/g.originalHeight;a.setStyle(b.parentNode,"height",b.width+"px");a.setStyle(b,"position","absolute");a.setStyle(b,"left",Math.abs((b.parentNode.offsetWidth-b.height)/2)+"px");a.setStyle(b,"top","0")}},g=function(a,b,c,d){var e=a;d.oldAngle=e.angle=((e.angle==undefined?0:e.angle)+b)%360;if(e.angle>=0)var f=Math.PI*e.angle/180;else var f=Math.PI*(360+e.angle)/180;var g=Math.cos(f),h=Math.sin(f),i=document.createElement("canvas");e.oImage?i.oImage=e.oImage:i.oImage=e;var j=new Image;j.onload=function(){i.style.width=i.width=Math.abs(g*j.width)+Math.abs(h*j.height);i.style.height=i.height=Math.abs(g*j.height)+Math.abs(h*j.width);if(i.width>c){i.style.width=c+"px";i.style.height=c*j.width/j.height+"px"}var a=i.getContext("2d");a.save();f<=Math.PI/2?a.translate(h*j.height,0):f<=Math.PI?a.translate(i.width,-g*j.height):f<=1.5*Math.PI?a.translate(-g*j.width,i.height):a.translate(0,-h*j.width);a.rotate(f);try{a.drawImage(j,0,0,j.width,j.height)}catch(b){}a.restore();i.angle=e.angle;e.parentNode.replaceChild(i,e);i.id=e.id;j.onload=null};j.src=i.oImage.src;return i},h=function(){var a=["transform","MozTransform","webkitTransform","OTransform"],b=0,c=document.createElement("div").style;while(a[b]&&!(a[b]in c))++b;return a[b]}(),i=function(b,c,f,g){var i=e(c,g.oldAngle),j;c=g.oldAngle=i.angle;if(!g.rotated){g.rotated=!0;j=a.C("div");j.style.position="relative";g.textAlign=j.style.textAlign=a.getStyle(b.parentNode,"textAlign");b.parentNode.insertBefore(j,b);j.appendChild(b);b.style.position="absolute"}else j=b.parentNode;if(d[c]%2==0){g.originalWidth>f?g.imgViewWidth=b.width=f:g.imgViewWidth=b.width=g.originalWidth;g.imgViewHeight=b.height=g.originalHeight;b.style.width=g.imgViewWidth+"px";b.style.height=g.imgViewHeight+"px"}else if(d[c]%2==1){g.originalHeight>f?g.imgViewWidth=b.height=f:g.imgViewWidth=b.height=g.originalHeight;g.imgViewHeight=b.width=g.imgViewWidth*g.originalWidth/g.originalHeight;b.style.width=g.imgViewHeight+"px";b.style.height=g.imgViewWidth+"px"}j.style.height=g.imgViewHeight+"px";f>j.offsetWidth&&(j.style.width=f+"px");b.style[h]="matrix("+i.M11+","+i.M21+","+i.M12+","+i.M22+", 0, 0)";var k=(g.imgViewHeight-g.imgViewWidth)/2,l=(g.imgViewWidth-g.imgViewHeight)/2;if(d[c]%2==0){b.style.top="0px";g.textAlign=="center"?b.style.left=(j.offsetWidth-g.imgViewWidth)/2+"px":b.style[g.textAlign=="right"?"right":"left"]="0px"}else{b.style.top=k+"px";g.textAlign=="center"?b.style.left=l+(j.offsetWidth-g.imgViewWidth)/2+"px":b.style[g.textAlign=="right"?"right":"left"]=l+"px"}},j=function(b,d,e){var j=c(b);if(!("originalWidth"in j)){j.originalWidth=b.width;j.originalHeight=b.height}e||(e=j.originalWidth);h?i(b,d,e,j):"getContext"in a.C("canvas")?g(b.canvas?b.canvas:b,d,e,j):"filters"in a.C("div")&&f(b,d,e,j)},k={rotateRight:function(a,b,c){j(a,b==undefined?90:b,c)},rotateLeft:function(a,b,c){j(a,b==undefined?-90:-b,c)},rotateDefault:function(a){var b=c(a);b.oldAngle&&j(a,360-b.oldAngle,b.originalWidth)},removeDataCache:function(c){var d=a.uniqueID(c),e;if(h)if(e=c.parentNode&&c.parentNode.parentNode){c.parentNode.parentNode.insertBefore(c,e);a.removeNode(e)}b[d]&&delete b[d]},destroy:function(){b={}}};return k});
STK.register("lib.kit.dom.fix",function(a){function f(c,e,f){if(!!d(c)){var g="fixed",h,i,j,k,l=c.offsetWidth,m=c.offsetHeight,n=a.core.util.winSize(),o=0,p=0,q=a.core.dom.cssText(c.style.cssText);if(!b){g="absolute";var r=a.core.util.scrollPos();o=h=r.top;p=i=r.left;switch(e){case"lt":h+=f[1];i+=f[0];break;case"lb":h+=n.height-m-f[1];i+=f[0];break;case"rt":h+=f[1];i+=n.width-l-f[0];break;case"rb":h+=n.height-m-f[1];i+=n.width-l-f[0];break;case"c":default:h+=(n.height-m)/2+f[1];i+=(n.width-l)/2+f[0]}j=k=""}else{h=k=f[1];i=j=f[0];switch(e){case"lt":k=j="";break;case"lb":h=j="";break;case"rt":i=k="";break;case"rb":h=i="";break;case"c":default:h=(n.height-m)/2+f[1];i=(n.width-l)/2+f[0];k=j=""}}if(e=="c"){h<o&&(h=o);i<p&&(i=p)}q.push("position",g).push("top",h+"px").push("left",i+"px").push("right",j+"px").push("bottom",k+"px");c.style.cssText=q.getCss()}}function e(b){b=a.core.arr.isArray(b)?b:[0,0];for(var c=0;c<2;c++)typeof b[c]!="number"&&(b[c]=0);return b}function d(b){return a.core.dom.getStyle(b,"display")!="none"}var b=!(a.core.util.browser.IE6||document.compatMode!=="CSS1Compat"&&STK.IE),c=/^(c)|(lt)|(lb)|(rt)|(rb)$/;return function(d,g,h){var i,j,k=!0,l;if(a.core.dom.isNode(d)&&c.test(g)){var m={getNode:function(){return d},isFixed:function(){return k},setFixed:function(a){(k=!!a)&&f(d,i,j);return this},setAlign:function(a,b){if(c.test(a)){i=a;j=e(b);k&&f(d,i,j)}return this},destroy:function(){b||b&&a.core.evt.removeEvent(window,"scroll",n);a.core.evt.removeEvent(window,"resize",n);a.core.evt.custEvent.undefine(l)}};l=a.core.evt.custEvent.define(m,"beforeFix");m.setAlign(g,h);function n(c){c=c||window.event;a.core.evt.custEvent.fire(l,"beforeFix",c.type);k&&(!b||i=="c")&&f(d,i,j)}b||a.core.evt.addEvent(window,"scroll",n);a.core.evt.addEvent(window,"resize",n);return m}}});
STK.register("lib.face.destroyFlash",function(a){var b=a.core.util.browser,c=function(a){if(a){for(var b in a)typeof a[b]=="function"&&(a[b]=null);a.parentNode.removeChild(a)}};return function(d){if(!!a.isNode(d)&&d&&d.nodeName==="OBJECT")if(a.IE&&b.OS==="windows"){d.style.display="none";(function(){d.readyState===4?c(d):setTimeout(arguments.callee,10)})()}else d.parentNode.removeChild(d)}});
STK.register("lib.face.magic",function(a){var b=a.core.util.swf,c=a.ui.mask,d,e,f,g,h,i,j,k=(new Date).getTime()+"",l=(Math.random()+"").replace(".",""),m="STK_flash_"+k+l,n=function(b){if(!d){d=a.C("div");if(!b)d.style.cssText="display:none;width:440px;height:360px;z-index:100000;";else{var c=a.core.util.winSize();d.style.cssText="display:none;width:"+c.width+"px;height:"+c.height+"px;z-index:100000;"}e=a.core.dom.uniqueID(d);h=function(b){b=a.fixEvent(b||window.event);b.target.getAttribute("name")!=e&&o.hide()};document.body.appendChild(d)}},o=function(k,l,p){j=typeof l=="function"?l:a.funcEmpty;p=a.parseParam({isV5update:!1},p);n(p.isV5update);if(!f){f=!0;c.showUnderNode(d);a.addEvent(c.getNode(),"click",h);c.getNode().title="点击关闭";d.style.display="";if(!p.isV5update){g?g.setAlign("c"):g=a.lib.kit.dom.fix(d,"c");d.innerHTML=b.html(k,{id:e,width:440,height:360,paras:{allowScriptAccess:"never",wmode:"transparent"},attrs:{name:e},flashvars:{playMovie:"true"}})}else{g?g.setAlign("lb"):g=a.lib.kit.dom.fix(d,"lb");_closeFun=function(){o.hide()};d.innerHTML=b.html(k,{id:e,width:"100%",height:"100%",paras:{menu:"false",scale:"noScale",allowFullscreen:"false",allowScriptAccess:"always",bgcolor:"#FFFFFF",wmode:"transparent",base:"//flashcrossdomain.mps.weibo.com/t5/home/static/upgrade/v5/"},attrs:{name:e},flashvars:{closeAPI:m,v:$CONFIG.version,bgMusic:"//service.weibo.com/staticjs/v5/bg001.mp3"}})}clearInterval(i);i=setInterval(function(){var a=document[e]||window[e],b=0;if(a&&a.PercentLoaded()==100){clearInterval(i);i=setInterval(function(){var c=a.CurrentFrame(),d;try{d=a.TotalFrames()}catch(e){d=a.TotalFrames}c<0||(c<d&&b<=c?b=c:o.hide())},80)}},100)}};o.hide=function(){clearInterval(i);if(d){d.style.display="none";a.lib.face.destroyFlash(a.sizzle("embed,object",d)[0]);d.innerHTML=""}a.removeEvent(c.getNode(),"click",h);c.getNode().title="";c.back();f=!1;setTimeout(function(){typeof j=="function"&&j()},0);return o};o.destroy=function(){o.hide();g&&g.destroy();a.removeNode(d);i=d=e=f=g=h};window[m]=function(){o.hide()};return o});
STK.register("widget.module.component",function(a){return function(){var b={};b.initParam=a.core.func.empty;b.initEvent=a.core.func.empty;b.destroyParam=a.core.func.empty;b.destroyEvent=a.core.func.empty;b.init=function(){b.initParam();b.initEvent()};b.destroy=function(){b.destroyEvent();b.destroyParam()};return b}});
STK.register("widget.parse",function(a){var b="//js.t.sinajs.cn/t5/page/js/",c="STK.",d=["destroy","part_destroy","part_flush"],e=1,f=typeof $CONFIG=="undefined"?e:$CONFIG.version;return function(e,g){var h=a.widget.module.component(),i=a.core.obj.sup(h,["init","destroy"]),j={},k,l;h.handler={getMethod:function(b){b=b.split(".");var c,d=a.namespace();while(c=b.shift())if(!(d=d[c]))break;return d},extract:function(a){var b=h.handler.getMethod(a.ns);if(b){j[a.uniqueID]={info:a,entity:b(a)};j[a.uniqueID].entity.init()}},getDomInfo:function(b){return{dom:b,top:h.entity.dom,ns:b.getAttribute("component"),uniqueID:a.core.dom.uniqueID(b),data:a.queryToJson(b.getAttribute("component-data")||""),param:a.queryToJson(b.getAttribute("component-param")||"")}},loadComponent:function(b){var c=h.handler.getDomInfo(b),d=[{url:[k.baseURL,c.ns.replace(/\./g,"/"),".js?version=",f].join(""),NS:k.baseNS+c.ns}];a.core.io.require(d,h.handler.extract,c)}};h.accept={partDestroy:function(b,c){var d=c.dom;for(var e in j)if(a.contains(d,j[e].info.dom)){j[e].entity.destroy();delete j[e].info;delete j[e].entity;delete j[e]}},partFlush:function(b,c){a.foreach(a.sizzle("[component]",c.dom),h.handler.loadComponent)}};h.initParam=function(){h.entity={dom:e};l=a.custEvent.define(h.entity.dom,d);k=a.parseParam({baseURL:b,baseNS:c},g);j={}};h.destroyParam=function(){k=null;j=null};h.initEvent=function(){a.custEvent.add(l,"part_destroy",h.accept.partDestroy);a.custEvent.add(l,"part_flush",h.accept.partFlush)};h.destroyEvent=function(){a.custEvent.remove(l,"part_destroy",h.accept.partDestroy);a.custEvent.remove(l,"part_flush",h.accept.partFlush)};h.destroy=function(){for(var a in j){j[a].entity.destroy();delete j[a].info;delete j[a].entity;delete j[a]}i.destroy()};h.init=function(){i.init();a.foreach(a.sizzle("[component]",h.entity.dom),h.handler.loadComponent)};return h}});
STK.register("lib.feed.widget",function(a){var b={};return{add:function(c,d){if(!b[c]){b[c]=a.widget.parse(d);b[c].init()}},clear:function(a){if(b[a]){b[a].destroy();delete b[a]}},destroy:function(){for(var a in b){b[a].destroy();delete b[a]}}}});
STK.register("lib.kit.extra.actionData",function(a){return function(b){return{set:function(c,d){if(!!a.isNode(b)){var e=a.queryToJson(b.getAttribute("action-data")||"")||{};e[c]=d;b.setAttribute("action-data",a.jsonToQuery(e))}},del:function(c){if(!!a.isNode(b)){var d=a.queryToJson(b.getAttribute("action-data")||"")||{};delete d[c];b.setAttribute("action-data",a.jsonToQuery(d))}},get:function(c){if(!a.isNode(b))return"";var d=a.queryToJson(b.getAttribute("action-data")||"")||{};return d[c]||""}}}});
STK.register("conf.trans.feed.attitude",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("feedSmall",{url:"/aj/attitude/small",method:"get"});c("add",{url:"/aj/attitude/add",method:"post"});c("big",{url:"/aj/v6/attitude/big",method:"get"});c("in",{url:"/aj/attitude/in",method:"get"});c("del",{url:"/aj/attitude/destroy",method:"get"});c("miniadd",{url:"/aj/v6/like/add",method:"post"});c("minismall",{url:"/aj/v6/like/small",method:"get"});c("likein",{url:"/aj/like/in",method:"get"});c("likebig",{url:"/aj/v6/like/big",method:"get"});c("minidel",{url:"/aj/like/del",method:"post"});c("objLike",{url:"/aj/v6/like/objectlike",method:"post"});c("photosmall",{url:"/aj/v6/like/object/photosmall",method:"get"});c("cmtLike",{url:"/aj/v6/like/object/small",method:"get"});c("cmtLikeMore",{url:"/aj/like/object/big",method:"get"});c("likeStatus",{url:"/aj/like/status",method:"get"});c("getCuslikeWhiteList",{url:"/aj/praise/userwhite",method:"post"});c("likelist",{url:"/aj/v6/like/likelist",method:"get"});return b});
STK.register("lib.feed.plugins.like.likestatus",function(a){var b={},c={},d=a.conf.trans.feed.attitude,e=function(a,c,e){d.getTrans("likeStatus",{onSuccess:function(c){var d=c.data.count,f=c.data.exists;for(var g in d){!b[g]&&(b[g]={});b[g].count=d[g]}for(var g in f)b[g].exits=f[g];e(b[a],b)},onError:function(){},onFail:function(){}}).request({object_ids:c})};return e});
STK.register("lib.kit.extra.setPlainHash",function(a){return function(b){try{var c=window.$CONFIG;c&&c.bigpipe==="true"&&a.historyM?a.historyM.setPlainHash(b):window.location.hash=b}catch(d){}}});
STK.register("lib.kit.extra.feedControlHash",function(a){var b=$CONFIG.g_mathematician||0;return function(){var c=Math.random();c<=b&&a.lib.kit.extra.setPlainHash("_rnd"+(+(new Date)).toString())}});
STK.register("lib.image.multiimage.hastags",function(a){var b={};return function(){return{add:function(a){if(!!a){_tags=a.split(",");for(var c in _tags)b[_tags[c]]=!0}},check:function(a){return!!b[a]}}}});
STK.register("conf.trans.image",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("recmodlayer",{url:"/aj/photo/recomlayer",method:"get"});c("waterfall",{url:"//photo.weibo.com/page/waterfall",method:"get",varkey:"callback",requestMode:"jsonp"});c("photoAlbum",{url:"/p/aj/album/loading",method:"get"});c("superPhotoAlbum",{url:"/p/aj/proxy?api=http://i.huati.weibo.com/pcpage/papp",method:"get"});c("recmodlayer_new",{url:"/aj/v6/photo/morepic",method:"get"});c("createTag",{url:"/aj/publishplug/bainian",method:"get"});c("showtip",{url:"/aj/bubble/checkshowbubble",method:"get"});c("hidetip",{url:"/aj/bubble/closebubble",method:"get"});c("followList",{url:"/aj/mblog/attention"});c("tagtopicList",{url:"/aj/photo/tag/recomtopic"});c("getTags",{url:"/aj/photo/tag/phototag"});c("viewTags",{url:"/aj/photo/tag/getphototag"});c("transGif",{url:"/aj/multimedia/giftranscode",method:"get"});c("transGifLog",{url:"/aj/v6/mblog/giftovideolog",method:"post"});c("VmemberPic",{url:"/aj/v6/mblog/getpicinfo",method:"get"});return b});
STK.register("lib.image.multiimage.showtag",function(a){var b='<#et temp data><a  title="${data.content}" node-type="tag"  action-type="tag" <#if (data.url)>target="_blank" href="${data.url}" class="tag_showpic${data.offset} tag_show${data.flag_type}${data.offset}"<#else>href="javascript:void(0);" onclick="return false;" class="tag_showpic${data.offset}"</#if> style="left:${data.left}px;top:${data.top}px;white-space: nowrap;"><span <#if (data.tag_uid)>usercard="id=${data.tag_uid}"</#if> class="inner"><#if (data.flag == "#")><em node-type="tagmove" class="txt W_autocut">${data.content}</em></#if><#if (data.flag == "@")><i class="codetag">@</i><em <#if (data.tag_uid)>usercard="id=${data.tag_uid}"</#if> node-type="tagmove" class="txt W_autocut">${data.content}</em></#if><#if (data.isshow != 1)><span action-type="removeTag" class="W_ficon ficon_close S_ficon" title="关闭">X</span></span></a></#if></#et>',c={};return function(d){function m(b,c){if(!b)return!1;var e,f=0,g=b.getAttribute("src"),h=a.C("img");h.onload=function(){e=setInterval(function(){f++;f>50&&e&&clearInterval(e);b||e&&clearInterval(e);if(b.parentNode){e&&clearInterval(e);d.container=b.parentNode;c&&c()}},100)};g&&(h.src=g)}function j(a,b){if(typeof a!="string")return a;b&&(a=a.replace(/\&/g,"&amp;"));return a.replace(/"/g,"&quot;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\'/g,"&#39;").replace(/(\u0020|\u000B|\u2028|\u2029|\f)/g,"&#32;")}var e={},f=a.conf.trans.image,g=[],h=!0,i=function(a,b){if(!a||a.type!="mouseout"&&a.type!="mouseover")return!1;var c=a.relatedTarget?a.relatedTarget:a.type=="mouseout"?a.toElement:a.fromElement;while(c&&c!=b)c=c.parentNode;return c!=b},k={getRPos:function(b,c,d){var e=a.position(b),f=a.position(c),g=a.core.dom.getSize(c),h={left:f.l-e.l+g.width*d.x-5,top:f.t-e.t+g.height*d.y-15};h={left:h.left>0?h.left:0,top:h.top>0?h.top:0};h.offset=d.x>.5?"R":"L";return h},offsetTar:function(b,c){if(c=="R"){var d=a.core.dom.getSize(b);b.style.marginLeft=0-d.width+12+"px"}else b.style.marginLeft=""},createTag:function(c,e){if(!!h){var f={};for(var i in e)f[i]=e[i];f.content=j(f.content);f.flag_type={"@":"User","#":"Topic"}[f.flag];var l=a.core.util.easyTemplate(b,f).toString(),m=a.lib.kit.dom.parseDOM(a.builder(l).list);d.container.appendChild(m.tag);k.offsetTar(m.tag,e.offset);m.tag.setAttribute("tag-id",c);g.push(m.tag);d.from!="add"&&a.addEvent(m.tag,"click",k.stopEvent)}},fixData:function(b){for(var c in b){var e=k.getRPos(d.container,d.img,{x:b[c].pos_x,y:b[c].pos_y});e.flag={user:"@",topic:"#"}[b[c].tag_type]||"#";e.content=a.encodeHTML(b[c].tag_name);e.url=b[c].url;!d.fromLayer&&e.flag=="@"&&b[c].url&&(e.tag_uid=b[c].tag_id.replace("1042:",""));e.isshow=1;k.createTag(c,e)}k.bindEvent()},showtags:function(a){if(!!i(a||window.event,d.container)){if(d.img.style.cssText.toLowerCase().indexOf("filter")!=-1&&!d.fromLayer)return;if(d.container!=d.img.parentNode){k.hidetags();return}for(var b in g)g[b].style.display=""}},hidetags:function(a){if(!!i(a||window.event,d.container))for(var b in g)g[b].style.display="none"},bindEvent:function(){a.addEvent(d.container,"mouseover",k.showtags);a.addEvent(d.container,"mouseout",k.hidetags)},removetags:function(){var b=a.sizzle('[node-type="tag"]',d.container);for(var c in b)b[c]&&a.removeNode(b[c])},stopEvent:function(b){b=a.fixEvent(b);b.cancelBubble=!0;b.stopPropagation&&b.stopPropagation();var c=b.target,d=a.core.dom.dir.parent(c,{expr:"[action-type=feed_list_item]"})[0]||"",e=a.queryToJson(d&&d.getAttribute("data-mark")||"");if(e){var f=d&&d.getAttribute("mid")||"",g={};g.mid=f;g.type="tagclick";g=a.core.json.merge(g,e);a.conf.trans.feed.feed.getTrans("setAD",{onSuccess:function(){},onFail:function(){},onError:function(){}}).request(g)}}},l=function(){},n=function(){if(!d.container){if(!d.img)return;d.container=d.img.parentNode}if(!d.tags){if(c[d.postdata.pid]){m(d.img,function(){k.fixData(c[d.postdata.pid])});return}if(!a.lib.image.multiimage.hastags().check(d.postdata.pid)&&!d.fromLayer)return;f.getTrans("viewTags",{onSuccess:function(a){for(var b in a.data){c[d.postdata.pid]=a.data[b].pic_tags;m(d.img,function(){k.fixData(a.data[b].pic_tags)})}},onError:function(a){c[d.postdata.pid]=[]}}).request(d.postdata)}else for(var b in d.tags)k.createTag(b,d.tags[b])};n();var o=function(){a.removeEvent(d.container,"mouseover",k.showtags);a.removeEvent(d.container,"mouseout",k.hidetags);k.hidetags();k.removetags();h=null;g=null};e.rend=l;e.destroy=o;return e}});
STK.register("lib.kit.extra.loadImageInBackground",function(a){function f(b){a.foreach([].concat(b),function(a){a&&c.push(a)});d()}function e(a,c){b[a]&&c();var d=function(){clearTimeout(e);b[a].onload=b[a].onerror=null;c()},e=setTimeout(d,2e3);b[a]=new Image;b[a].onload=b[a].onerror=d;b[a].src=a}function d(){var a=c.shift();a&&e(a,function(){d()})}var b={},c=[];return f});
STK.register("lib.connect.iframe",function(a){var b={},c={},d=function(c,d,e,f){try{var g=a.jsonToStr({cid:d,call:e,rs:f});b[c]&&b[c].contentWindow&&b[c].contentWindow.postMessage?b[c].contentWindow.postMessage(g,"*"):window.navigator["STK_IFRAME_CONNECT_"+c]&&window.navigator["STK_IFRAME_CONNECT_"+c](g)}catch(h){}},e=function(e){try{var f=a.strToJson(e.data);if(f.iid in c){a.custEvent.define(c[f.iid],[f.cmd]);a.custEvent.fire(c[f.iid],f.cmd,[b[f.iid],f.param,function(a,b){return d(f.iid,f.cid,a,b)}])}}catch(g){}};window.postMessage?a.addEvent(window,"message",e):window.navigator.STK_IFRAME_CONNECT_OUT===undefined&&(window.navigator.STK_IFRAME_CONNECT_OUT=function(a){e({data:a})});return function(e){if(!e)return!1;e.contentWindow.name=e.name=e.name||"iframe_"+a.getUniqueKey();if(e.name in b){if(b[e.name]!=e)throw"iframe:"+e.name+" is existed! "}else{b[e.name]=e;c[e.name]={};e.src=e.getAttribute("_src");e.removeAttribute("_src");e.contentWindow.name=e.name}return{trigger:function(a,b){d(e.name,"_EVENT_",a,b)},on:function(b,d){a.custEvent.define(c[e.name],b);a.custEvent.add(c[e.name],b,d)},off:function(b,d){a.custEvent.remove(c[e.name],b,d)},destroy:function(){a.custEvent.undefine(c[e.name]);delete b[e.name];delete c[e.name]}}}});
STK.register("lib.kit.extra.listener",function(a){var b={},c={};c.define=function(c,d){if(b[c]!=null)throw"lib.kit.extra.listener.define: 频道已被占用";b[c]=d;var e={};e.register=function(d,e){if(b[c]==null)throw"lib.kit.extra.listener.define: 频道未定义";a.listener.register(c,d,e)};e.fire=function(d,e){if(b[c]==null)throw"commonlistener.define: 频道未定义";a.listener.fire(c,d,e)};e.remove=function(b,d){a.listener.remove(c,b,d)};e.cache=function(b){return a.listener.cache(c,b)};return e};return c});
STK.register("conf.channel.feed",function(a){var b=["forward","publish","comment","delete","refresh","reply","feedTagUpdate","feedTagMoreUpdate","qfaceAdd","qfaceCount","timeFeedPublish","timeFeedEdit","videolayer","addAlbumToTextEl"];return a.lib.kit.extra.listener.define("conf.channel.feed",b)});
STK.register("lib.editor.count",function(a){function b(b){var c=41,d=140,e=20,f=b,g=b.match(/(http|https):\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/\,\:;@&=\?~#%]*)*/gi)||[],h=0;for(var i=0,j=g.length;i<j;i++){var k=a.core.str.bLength(g[i]);if(/^(http:\/\/t.cn)/.test(g[i]))continue;/^(http:\/\/)+(t.sina.com.cn|t.sina.cn)/.test(g[i])||/^(http:\/\/)+(weibo.com|weibo.cn)/.test(g[i])?h+=k<=c?k:k<=d?e:k-d+e:h+=k<=d?e:k-d+e;f=f.replace(g[i],"")}var l=Math.ceil((h+a.core.str.bLength(f))/2);return l}return function(a){a=a.replace(/\r\n/g,"\n");return b(a)}});
STK.register("lib.publisher.widget.count",function(a){return function(b){return a.lib.editor.count(b)}});
STK.register("conf.trans.validateCode",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("checkValidate",{url:"/aj/pincode/verified",method:"post"});return b});
STK.register("lib.dialog.validateCode",function(a){var b=window.$LANG,c=a.lib.kit.extra.language,d="/aj/pincode/pin?_wv=5&type=rule&lang="+$CONFIG.lang+"&ts=",e={dialog_html:'<div class="layer_point layer_verification"><div class="clearfix"><div class="v_img W_fl"><img height="25" width="250" class="yzm_img"/></div><div class="v_change W_fl"><a href="javascript:void(0);" class="yzm_change" action-type="yzm_change"><span class="W_ficon ficon_rotate S_ficon">e</span><span class="font S_txt1">#L{换一组}</span></a></div></div><div class="v_text yzm_wng"><span class="v_text">#L{请输入上面问题的答案}：</span><input type="text" class="yzm_input ontext W_input" action-type="yzm_input"/></div><div class="W_layer W_layer_pop yzm_error" style="display:none;top:70px;left:200px;"><div class="content layer_mini_info"><p class="main_txt"><i class="W_icon icon_rederrorS"></i><span class="txt S_txt1"></span><a class="W_ficon ficon_close S_ficon yzm_hideError">X</a></p><div class="W_layer_arrow"><span class="W_arrow_bor W_arrow_bor_b"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div></div></div><div class="W_layer_btn S_bg1"><a class="W_btn_a btn_34px yzm_submit" href="javascript:void(0);" action-type="yzm_submit">#L{确定}</a><a class="W_btn_b btn_34px yzm_cancel" href="javascript:void(0);" action-type="yzm_cancel" action-data="value=frombtn">#L{取消}</a></div>'},f;return function(){if(f)return f;var b={},g={},h,i,j,k,l=function(){g.yzm_error.innerHTML="";g.yzm_error_layer.style.display="none";a.removeClassName(g.yzm_wng,"v_wrong")},m=function(b){g.yzm_error.innerHTML=b;g.yzm_error_layer.style.display="";a.addClassName(g.yzm_wng,"v_wrong")},n=function(){a.lib.kit.io.cssLoader("style/css/module/layer/layer_verifycode.css","js_style_css_module_layer_layer_verifycode",function(){h||o();l();h.setTop();h.show();t.changesrc();h.setMiddle();g.input_text.value="";a.hotKey.add(document.documentElement,["esc"],t.closeDialog,{type:"keyup",disableInInput:!0})})},o=function(){h=a.ui.dialog({isHold:!0});h.setTitle(c("#L{请输入验证码}"));h.setContent(c(e.dialog_html));var b=h.getBox();s(b);u()},p=function(b){a.conf.trans.validateCode.request("checkValidate",{onError:function(){m(c("#L{验证码错误}"));t.changesrc();j=!1;g.input_text.value=""},onFail:function(){m(c("#L{验证码错误}"));t.changesrc();g.input_text.value="";j=!1},onSuccess:function(b,c){j=!1;var d=b.data.retcode;l();g.input_text.value="";h.hide();var e=i.requestAjax,f=a.lib.kit.extra.merge(i.param,{retcode:d});e.request(f)}},b)},q=function(){},r=function(){},s=function(b){g.vImg=a.core.dom.sizzle("img.yzm_img",b)[0];g.yzm_change=a.core.dom.sizzle("a.yzm_change",b)[0];g.yzm_submit=a.core.dom.sizzle("a.yzm_submit",b)[0];g.yzm_cancel=a.core.dom.sizzle("a.yzm_cancel",b)[0];g.input_text=a.core.dom.sizzle("input.yzm_input",b)[0];g.yzm_wng=a.core.dom.sizzle("div.yzm_wng",b)[0];g.yzm_error=a.core.dom.sizzle("div.yzm_error span.txt",b)[0];g.yzm_error_layer=a.core.dom.sizzle("div.yzm_error",b)[0];g.yzm_hideError=a.core.dom.sizzle(".yzm_hideError",b)[0]},t={enter:function(){a.fireEvent(g.yzm_submit,"click")},changesrc:function(){var b=d+a.getUniqueKey();g.vImg.setAttribute("src",b);try{g.yzm_change.blur()}catch(c){}},checkValidateCode:function(){l();var b=a.core.str.trim(g.input_text.value);b?j||p({secode:b,type:"rule",data:i.param}):m(c("#L{请输入验证码}"));try{g.yzm_submit.blur()}catch(d){}},closeDialog:function(b){typeof b=="object"&&b.el&&h.hide();typeof i=="object"&&i.onRelease&&typeof i.onRelease=="function"&&i.onRelease();a.hotKey.remove(document.documentElement,["esc"],t.closeDialog,{type:"keyup"});try{a.preventDefault()}catch(c){}},onFocus:function(b){b=a.core.evt.getEvent();var c=b.target||b.srcElement,d=c.value;d||l()}},u=function(){var b=h.getBox();k=a.core.evt.delegatedEvent(b);k.add("yzm_change","click",function(){t.changesrc();a.preventDefault()});k.add("yzm_submit","click",function(){t.checkValidateCode();a.preventDefault()});k.add("yzm_cancel","click",t.closeDialog);a.core.evt.addEvent(g.yzm_hideError,"click",l);a.core.evt.addEvent(g.input_text,"focus",t.onFocus);a.core.evt.addEvent(g.input_text,"blur",t.onFocus);a.hotKey.add(g.input_text,["enter"],t.enter,{type:"keyup"})},v=function(){if(h){k.destroy();a.core.evt.removeEvent(g.yzm_hideError,"click",l);a.core.evt.removeEvent(g.input_text,"focus",t.onFocus);a.core.evt.removeEvent(g.input_text,"blur",t.onFocus);h&&h.destroy&&h.destroy()}j=h=f=null},w=function(a,b,c){if(a.code=="100027"){i=c;n()}else if(a.code==="100000")try{var d=c.onSuccess;d&&d(a,b)}catch(e){}else try{var d=c.onError;d&&d(a,b)}catch(e){}};r();r=null;b.destroy=v;b.validateIntercept=w;b.addUnloadEvent=function(){h&&a.core.evt.addEvent(window,"unload",v)};f=b;return b}});
STK.register("lib.editor.plugin.count",function(a){function d(a,b){if(!a.textEl)throw"[editor plugin count]: plz check nodeList"}function c(b,c){var d=a.lib.editor.count(b),e=Math.abs(c-d),f;d>c||d<1?f={wordsnum:d,vnum:e,overflow:!0}:d==0?f={wordsnum:d,vnum:e,overflow:!0}:f={wordsnum:d,vnum:e,overflow:!1};return f}var b;return function(e){var f=e.nodeList,g,h=e.opts,i=a.lib.kit.extra.language;b=h.limitNum;d(f);a.core.evt.custEvent.define(e,"textNum");a.custEvent.define(e,"keyUpCount");var j=f.textEl,k=f.num,l;a.addEvent(j,"focus",function(){g=setInterval(function(){m()},200)});a.addEvent(j,"blur",function(){clearInterval(g)});var m=function(b,d){var f=a.core.str.trim(j.value).length==0?a.core.str.trim(j.value):j.value,g=e&&e.opts&&e.opts.extendText;f=f.replace(/\r\n/g,"\n");var m=c(f,h.limitNum);if(!m.wordsnum||m.wordsnum!=l||!d||d.type=="score"){f.length>=0&&j.focus?m.overflow&&m.wordsnum!=0?k.innerHTML=(g?i(g):"")+i("#L{已经超过%s字}",'<span class="S_error">'+m.vnum+"</span>"):k.innerHTML=(g?i(g):"")+i("#L{还可以输入%s字}","<span>"+m.vnum+"</span>"):f.length===0&&(k.innerHTML=(g?i(g):"")+i("#L{还可以输入%s字}","<span>"+m.vnum+"</span>"));a.core.evt.custEvent.fire(e,"textNum",{count:m.wordsnum,isOver:m.overflow});l=m.wordsnum}};STK.core.evt.addEvent(j,"keyup",m);a.custEvent.add(e,"keyUpCount",m)}});
STK.register("conf.trans.at",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("followList",{url:"/aj/mblog/attention"});c("topicList",{url:"/aj/mblog/topic"});c("stockList",{url:"/aj/mblog/stock"});return b});
STK.register("lib.kit.dom.isTurnoff",function(a){return function(a){return!a.parentNode||a.parentNode.nodeType==11||!!a.disabled}});
STK.register("lib.kit.dom.cssText",function(a){var b=function(a,b){var c=(a+";"+b).replace(/(\s*(;)\s*)|(\s*(:)\s*)/g,"$2$4"),d;while(c&&(d=c.match(/(^|;)([\w\-]+:)([^;]*);(.*;)?\2/i)))c=c.replace(d[1]+d[2]+d[3],"");return c};return function(a){a=a||"";var c=[],d={push:function(a,b){c.push(a+":"+b);return d},remove:function(a){for(var b=0;b<c.length;b++)c[b].indexOf(a+":")==0&&c.splice(b,1);return d},getStyleList:function(){return c.slice()},getCss:function(){return b(a,c.join(";"))}};return d}});
STK.register("lib.editor.at",function(a){var b=a.lib.kit.dom.cssText,c=a.lib.kit.dom.isTurnoff,d=a.lib.kit.extra.textareaUtils,e=window,f=document,g=a.core.util.browser,h="",i=d.selectionStart,j,k,l,m,n,o=function(){var a={"<":"&lt;",">":"&gt;",'"':"&quot;","\\":"&#92;","&":"&amp;","'":"&#039;","\r":"","\n":"<br>"," ":(navigator.userAgent.match(/.+(?:ie) ([\d.]+)/i)||[8])[1]<8?['<pre style="overflow:hidden;display:inline;',h,'word-wrap:break-word;"> </pre>'].join(""):['<span style="white-space:pre-wrap;',h,'"> </span>'].join("")};return function(b){var c=b.replace(/(<|>|\"|\\|&|\'|\n|\r| )/g,function(b){return a[b]});return c}}(),p=function(){var c=[],d=j.textEl.style.cssText,e;a.foreach(["margin","padding","border"],function(b){a.foreach(["Top","Left","Bottom","Right"],function(d){var e;b!="border"?e=c.push(b,"-",d.toLowerCase(),":",a.getStyle(j.textEl,b+d),";"):a.foreach(["Style","Width"],function(e){c.push(b,"-",d.toLowerCase(),"-",e.toLowerCase(),":",a.getStyle(j.textEl,[b,d,e].join("")),";")})})});c.push("font-size:"+a.getStyle(j.textEl,"fontSize")+";");return b([d,c.join(""),h,"\n\t\tword-wrap: break-word;\n\t\tline-height: 18px;\n\t\toverflow-y:auto;\n\t\toverflow-x:hidden;\n\t\toutline:none;\n\t"].join("")).getCss()},q=function(){var b=a.builder(['<div node-type="wrap" style="display:none;">','<span node-type="before"></span>','<span node-type="flag"></span>','<span node-type="after"></span>',"</div>"].join("")).list,c=b.wrap[0],d=b.flag[0],e=b.after[0],h=b.before[0],i=0,k,l,m,q=function(a){return g.MOZ?-2:g.MOBILE&&g.SAFARI&&(g.IPAD||g.ITOUCH||g.IPHONE)?-2:0};return{bind:function(){if(l!==j.textEl){n=a.position(j.textEl);var b=["left:",n.l,"px;top:",n.t+20,"px;"].join("");l=j.textEl;var d=p();l.style.cssText=d;m=[b,d,"\n\t\t\t\tposition:absolute;\n\t\t\t\tfilter:alpha(opacity=0);\n\t\t\t\topacity:0;\n\t\t\t\tz-index:-1000;\n\t\t\t"].join("");c.style.cssText=m;if(!i){i=1;f.body.appendChild(c)}}},content:function(b,f,g,i){c.style.cssText=[m,"\n\t\t\t\twidth:",(parseInt(a.getStyle(l,"width"))||l.offsetWidth)+q(),"px;\n\t\t\t\theight:",parseInt(a.getStyle(l,"height"))||l.offsetHeight,"px;\n\t\t\t\toverflow-x:hidden;\n\t\t\t\toverflow-y:",/webkit/i.test(navigator.userAgent)?"hidden":a.getStyle(l,"overflowY"),";\n\t\t\t"].join("");h.innerHTML=o(b);d.innerHTML=o(f)||"&thinsp;";e.innerHTML=o([g,i].join(""));clearTimeout(k);k=setTimeout(function(){var b=a.position(d);a.custEvent.fire(j.eId,"at",{t:b.t-l.scrollTop-n.t,l:b.l-n.l,fl:b.l,key:g,flag:f,textarea:j.textEl})},30)},hide:function(){c.style.display="none"},show:function(){c.style.display=""}}}(),r=function(){if(c(j.textEl))clearInterval(k);else{var b=j.textEl.value.replace(/\r/g,""),d=i(j.textEl);if(d<0||d==m)return;m=d;var e=b.slice(0,d),f=e.match(new RegExp(["(",j.flag,")([a-z/[A-Z0-9/\\]一-龥_-]{0,20})$"].join("")));if(!f){a.custEvent.fire(j.eId,"hidden");return}var g=b.slice(d);e=e.slice(0,-f[0].length);q.content(e,f[1],f[2],g)}};return function(b){if(!!b&&!!b.textEl){b=a.parseParam({textEl:null,flag:"@",eId:a.custEvent.define({},["at","hidden"])},b);var c=function(){if(!!j){clearInterval(k);a.removeEvent(j.textEl,"blur",c);q.hide()}},d=function(){c();j=b;m=null;q.bind();q.show();k=setInterval(r,200);a.addEvent(b.textEl,"blur",c)};a.addEvent(b.textEl,"focus",d);return b.eId}}});
STK.register("lib.editor.plugin.at",function(a){var b=a.lib.kit.extra.language,c='<div class="layer_menu_list"><ul node-type="suggestWrap"></ul></div>',d='<#et temp data><li class="suggest_title">${data.title}</li><#list data.data as list><li action-type="item" <#if (list_index == 0)>class="cur" </#if>action-data="value=${list.screen_name}" value="${list.screen_name}" ><a href="javascript:void(0);">${list.screen_name}<#if (list.remark)>(${list.remark})</#if></a></li><#if (list.count)><span>${list.count}</span></#if></#list></#et>',e='<#et temp data><li class="suggest_title">${data.title}</li><#list data.data as list><li action-type="item" <#if (list_index == 0)>class="cur" </#if>action-data="value=${list.topic}" value="${list.topic}" ><a href="javascript:void(0);">${list.topic}</a></li></#list></#et>',f='<#et temp data><li class="suggest_title">${data.title}</li><#list data.data as list><li action-type="item" <#if (list_index == 0)>class="cur" </#if>action-data="value=${list.stock}" value="${list.stock}" ><a href="javascript:void(0);">${list.stock}</a></li></#list></#et>',g={"@":{trans:"followList",itemTemplate:d,title:{normal:b("#L{选择昵称或轻敲空格完成输入}"),more:b("#L{选择最近@的人或直接输入}"),no:b("#L{轻敲空格完成输入}")},needClose:!1},"#":{trans:"topicList",itemTemplate:e,title:{normal:b("#L{想用什么话题？}")},needClose:!0},$:{trans:"stockList",itemTemplate:f,title:{normal:b("#L{输入股票名/股票代码}")},needClose:!0}},h=function(a){return"\\"+a},i,j,k,l,m,n,o,p,q=!1,r=0,s=function(){setTimeout(function(){a.custEvent.fire(i,"close")},200)},t=function(){m.style.display="none"},u=function(){a.custEvent.add(i,"onIndexChange",function(a,b){A(b)});a.custEvent.add(i,"onSelect",function(b,c,d,e){r=0;a.core.evt.stopEvent();var f=p[c].getAttribute("value")+"";e==="@"&&(f=f.replace(/\(.*\)/,""));try{d.focus()}catch(j){}var k=a.lib.kit.extra.textareaUtils;k.replaceText(d,"");var l=k.selectionStart(d)*1,m=new RegExp(h(e)+"([a-z/[A-Z0-9/\\]一-龥_-]{0,20})$"),n=d.value.replace(/\r+/g,"").slice(0,l).match(m),o=d.value.slice(l,l+1);n=n&&n[1]?n[1].length:0;g[e].needClose?typeof o!="undefined"&&o!=e&&(f=f+e+" "):f=f+" ";k.insertText(d,f,l,n);var q=k.getCursorPos(d);if(g[e].needClose&&o==e){k.setCursor(d,q+1);k.insertText(d," ",q+1,0)}q=k.getCursorPos(d);var s=k.getSelectedText(d),t=s==""||s==null?0:s.length;d.setAttribute("range",q+"&"+t);a.custEvent.fire(i,"close")});a.addEvent(k.textEl,"blur",s);a.custEvent.add(i,"onClose",t);a.custEvent.add(i,"onOpen",function(b,c){l.style.display="";m.style.display="";q=!0;setTimeout(function(){a.custEvent.fire(i,"indexChange",0)},100)})},v=function(b){a.custEvent.remove(b);a.removeEvent(k.textEl,"blur",s)},w=function(b,c,d){var e=g[b].title,f=g[b].itemTemplate;e.more&&e.no?c.data&&c.data.length>0?c.title=d==""?e.more:e.normal:c.title=e.no:c.title=e.normal;return a.core.util.easyTemplate(f,c)},x=function(){a.core.evt.custEvent.add(j,"hidden",function(b,c){a.custEvent.fire(i,"close")});a.core.evt.custEvent.add(j,"at",function(b,c){n=c.key;var d=c.flag;if(n.length==0&&!(d in g)||c.textarea&&!c.textarea.value)a.custEvent.fire(i,"close");else var e=a.conf.trans.at.request(g[d].trans,{onSuccess:function(b,e){var f=w(d,b,n);a.custEvent.fire(i,"openSetFlag",d);a.custEvent.fire(i,"open",c.textarea);var g=a.core.dom.builder(f),h=g.box;l.innerHTML=h;m.style.cssText=["z-index:11001;background-color:#ffffff;position:absolute;"].join("");var j=c.l;document.body.clientWidth<c.fl+a.core.dom.getSize(m).width&&c.fl>a.core.dom.getSize(m).width&&(j=c.l-a.core.dom.getSize(m).width);var k=0;a.winSize().height-c.textarea.getBoundingClientRect().bottom<200?k=-l.offsetHeight-4:k=c.t;a.lib.kit.dom.layoutPos(m,c.textarea,{pos:"left-top",offsetX:j,offsetY:k})},onError:function(){a.custEvent.fire(i,"close")}},{q:encodeURIComponent(n)})})},y=function(){o=k.textEl;var b=[];for(var c in g)b.push(h(c));b="["+b.join("|")+"]";j=a.lib.editor.at({textEl:o,flag:b})},z=function(b){r=0;m&&(m.style.display="none");m&&(m.innerHTML="");a.removeNode(m);m=STK.C("div");document.body.appendChild(m);if(m.innerHTML.length==0){m.innerHTML=c;l=a.core.dom.sizzle('[node-type="suggestWrap"]',m)[0];m.style.display="none"}if(i){a.custEvent.fire(i,"close");v(i)}i=a.ui.mod.suggest({textNode:b,uiNode:l,actionType:"item",actionData:"value",flag:"@"});u()},A=function(b){p=a.sizzle("li[class!=suggest_title]",l);p&&p[0]&&a.core.dom.removeClassName(p[r],"cur");a.core.dom.addClassName(p[b],"cur");r=b};return function(a,b){k=a.nodeList;var c={};c.init=function(){y();z(k.textEl);x()};return c}});
STK.register("lib.editor.plugin.sucTip",function(a){return function(b,c){var d=b.nodeList,e={},f=function(c){var c=c||{},e=a.core.obj.parseParam({className:"send_succpic",innerHTML:"",delay:2},c);d.successTip.className=e.className;d.successTip.innerHTML=e.innerHTML;a.core.evt.custEvent.fire(b,"setSucTipDelay",e.delay)},g=function(a){if(!a||!a.getTime)a=new Date;var b={year:a.getFullYear(),mouth:a.getMonth()+1,date:a.getDate(),hours:a.getHours(),minutes:a.getMinutes(),seconds:a.getSeconds()};return b},h={theEnd:function(a,b){var c=g(b.time);if(c.year==2012&&c.mouth==12&&c.date==21&&c.hours>=10){var d=!1;c.seconds%5==0&&(d=!0);b.text.indexOf("末日")!=-1&&(d=!0);b.text.indexOf("玛雅")!=-1&&(d=!0);b.text.indexOf("登船")!=-1&&(d=!0);d?f({className:"send_success_over2",innerHTML:'<a target="_blank" href="//huati.weibo.com/z/2013/"></a>',delay:3}):f()}else c.year==2012&&c.mouth==12&&c.date==22&&c.hours<=14?f({className:"send_success_over1",innerHTML:'<a target="_blank" href="//huati.weibo.com/z/2013/"></a>',delay:3}):f({})}},i=function(){a.core.evt.custEvent.define(b,"theEnd");a.core.evt.custEvent.add(b,"theEnd",h.theEnd)},j=function(){i()};e.init=j;return e}});
STK.register("lib.publisher.source.formdata",function(a){return function(b){function g(){var c={},d=a.sizzle("[name]",b);for(var e in d){var f=d[e].getAttribute("name"),g=d[e].getAttribute("value");f&&g&&(c[f]=g)}return c}function f(c){var d=a.sizzle('[name="'+c+'"]',b);d[0]&&a.removeNode(d[0])}function e(c,d){var e=a.sizzle('[name="'+c+'"]',b);e[0]&&e[0].setAttribute("value",d)}function d(c){var d=a.sizzle('[name="'+c+'"]',b);return d[0]?d[0].getAttribute("value"):"ABSENT"}if(!b)return!1;var c={},b=b;c={get:d,set:e,del:f,read:g,node:b};return c}});
STK.register("lib.kit.extra.refreshpl",function(a){return function(b,c){function g(e,g){var h=f(b);if(!!h){var i=FM.getURL().path,j=a.queryToJson(FM.getURL().query);j.pids=h;var k=a.jsonToQuery(j),l="";if(d){j=j?j:"";l=i+"?"+k+"#_0";FM.setState(l,g)}else c.iereload&&window.location.reload()}}function f(b){var c=[];if(a.isNode(b)){c.push(e(b));return c.join("|")}a.foreach(a.sizzle(b),function(a,b){c.push(e(a))});return c[0]?c.join("|"):!1}function e(a){return!a||a==document.body?!1:a.id?a.id:e(a.parentNode)}var d=$CONFIG.bigpipe==="true",c=c||{};g(c||{})}});
STK.register("lib.editor.plugin.score",function(a){return function(b,c){function s(b,c){if(q!==b||r!==c){var i=b%1!=0,j=b/1|0,l=-1;c&&(l=i?j:j-1);a.foreach(k,function(a,b){var c=f;if(j){c=l===b?e:d;j-=1}else if(i){c=l===b?h:g;i=!1}a.className=c});q=b;r=c}}if(!!(b&&b.nodeList&&b.nodeList.score)){var d="s_star_a",e="l_star_a",f="s_star_b",g="s_star_c",h="l_star_b",i={},j=b.nodeList.reviewadd,k=a.sizzle("a",j),l=0;a.foreach(k,function(b){switch(a.trim(b.className)){case d:l+=1;break;case g:case h:l+=.5}});var m=a.delegatedEvent(b.nodeList.score),n=a.lib.publisher.source.formdata(b.nodeList.extradata),o=a.lib.kit.extra.language,p={.5:o("#L{很差}"),1:o("#L{很差}"),1.5:o("#L{一般}"),2:o("#L{一般}"),2.5:o("#L{还行}"),3:o("#L{还行}"),3.5:o("#L{不错}"),4:o("#L{不错}"),4.5:o("#L{怒赞}"),5:o("#L{怒赞}")},q,r,t={reviewadd:function(c){var c=a.fixEvent(c),d=a.position(j),e={height:j.offsetHeight,width:j.offsetWidth};if(c.pageY>d.t&&c.pageY<d.t+e.height&&c.pageX>d.l&&c.pageX<d.l+e.width){var f=c.pageX-d.l,g=Math.floor(f/e.width*10+1)/2;s(g,!0);b.nodeList.score_title&&(b.nodeList.score_title.innerHTML=p[g])}else{s(l);b.nodeList.score_title&&(b.nodeList.score_title.innerHTML=p[l]||"&nbsp;")}},add:function(c){var d=a.position(j),e=c.data,f=c.evt.pageX-d.l,g={height:j.offsetHeight,width:j.offsetWidth};e.score=Math.floor(f/g.width*10+1)/2;a.conf.trans.publisher.getTrans("reviewadd",{onSuccess:function(c){l=e.score;s(l,!0);c.data.score_title&&b.nodeList.score_title&&(b.nodeList.score_title.innerHTML=c.data.score_title);n.set("score",e.score);c.data.prefixtext&&n.set("prefixtext",c.data.prefixtext);c.data.refreshpl&&a.lib.kit.extra.refreshpl('[node-type="'+c.data.refreshpl+'"]');a.custEvent.fire(b,"keyUpCount",{type:"score"})},onError:function(b){a.lib.dialog.ioError(b.code,b)},onFail:function(){a.lib.dialog.ioError(json.code,json)}}).request(e)}},u=function(){a.addEvent(document.body,"mousemove",t.reviewadd);m.add("reviewadd","click",t.add)},v=function(){u()};v();i.destroy=function(){a.removeEvent(document.body,"mousemove",t.reviewadd);m.remove("reviewadd","click",t.add)};return i}}});
STK.register("conf.trans.face",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("face",{url:"/aj/mblog/face?type=face&_wv=5"});c("magicFace",{url:"/aj/mblog/face?type=ani&_wv=5"});return b});
STK.register("lib.face.face",function(a){function h(b){if(f.length){b(f);return!0}a.conf.trans.face.request("face",{onSuccess:function(a,c){f=[];a.data.usual.norm&&f.push({name:g,hotmap:a.data.usual.hot.slice(0,12),map:a.data.usual.norm});for(var d in a.data.more)a.data.more.hasOwnProperty(d)&&f.push({name:d,map:a.data.more[d]});b(f)},onError:function(b,c){a.lib.dialog.ioError(b.code,b)}},{});return!1}var b=a.lib.kit.extra.language,c=["first","second","third","fouth","fifth","sixth","seventh","eighth","ninth","tenth","eleventh","twelfth"],d={"默认":"default","浪小花":"langxiaohua","暴走漫画":"baozou","小恐龙":"konglong","冷兔":"lengtu","明星表情":"star","郭斯特":"ghost","癫当":"diandang","阿狸":"ali","BOBO和TOTO":"boto","搞怪":"gaoguai","小纯洁":"chunjie","罗小黑":"xiaohei","白骨精":"baigujing","hello菜菜":"hello","面瘫萝卜":"miantan","阿拉兔":"alatu","小幺鸡":"yaoji","心情":"mood","摩丝摩丝":"mosi","桂宝":"guibao","懒猫猫":"lanmaomao","彼尔德":"bierde","天气":"weather","休闲":"relax","炮炮兵":"paopao","哎呦熊":"eiyou","块猫":"kuaimao","柏夫":"baifu","萌萌":"mengmeng","管不着":"guanbuzhe","臭臭":"chouchou",nonopanda:"nonopanda","恐龙宝贝":"konglongbaobei","影子":"shadow","大耳兔":"daertu","哈皮兔":"hapitu","星座":"xingzuo","爱心":"aixin","张小盒":"zhangxiaohe","悠嘻猴":"youxihou","小新小浪":"xinlang","大熊":"daxiong","蘑菇点点":"mogu","酷库熊":"kuku"},e='<div class="W_layer W_layer_pop"><div class="content"><div class="W_layer_close"><a href="javascript:void(0);" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div><div class="layer_faces"><div class="WB_minitab"><ul class="minitb_ul S_line1 S_bg1 clearfix"><li class="minitb_item S_line1" node-type="tab"><a href="javascript:void(0);" class="minitb_lk S_txt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a><span class="cur_block"></span></li><li class="minitb_item S_line1" node-type="tab"><a href="javascript:void(0);" class="minitb_lk S_txt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a><span class="cur_block"></span></li><li class="minitb_item S_line1" node-type="tab"><a href="javascript:void(0);" class="minitb_lk S_txt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a><span class="cur_block"></span></li><li class="minitb_item S_line1" node-type="tab"><a href="javascript:void(0);" class="minitb_lk S_txt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a><span class="cur_block"></span></li><li class="minitb_item S_line1" node-type="tab"><a href="javascript:void(0);" class="minitb_lk S_txt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a><span class="cur_block"></span></li></ul><ul class="W_fr minitb_ul S_line1 S_bg1 clearfix" node-type="face_nav"><li class="minitb_more S_line1" node-type="prev" action-type="prev"> <a href="javascript:void(0);" class="minitb_lk S_txt1"><i class="W_ficon ficon_arrow_left_lite S_ficon">j</i></a></li><li class="minitb_more S_line1" node-type="next" action-type="next"> <a href="javascript:void(0);" class="minitb_lk S_txt1"><i class="W_ficon ficon_arrow_right_lite S_ficon">i</i></a></li></ul></div><div class="faces_list_box"><div class="faces_list" node-type="scrollView"><div node-type="list"></div></div></div></div><div class="W_layer_arrow"><span class="W_arrow_bor" node-type="arrow"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div></div>',f=[],g=b("#L{默认}");return function(b,f){var g=a.ui.bubble(e,{clickBlankToHide:!0,stopClickPropagation:!0,autoRelease:!0,showWithAni:"fadeInDown:fast",hideWithAni:"fadeOutUp:fast"});a.custEvent.define(g,"insert");var i=g.getDomList(!0).list,j=[].concat(g.getDomList(!0).tab),k,l=0,m=0;h(function(b){function e(){g.getDomList().face_nav.style.display=b.length<=5?"none":"";a.foreach(j,function(c,d){d=d+m;a.removeClassName(c,"current");if(b[d]){if(d===l){a.addClassName(c,"current");c.innerHTML='<a href="javascript:void(0);" class="minitb_lk S_txt1 S_bg2" action-type="tab" action-data="index='+d+'">'+b[d].name+'</a><span class="cur_block"></span>'}else c.innerHTML='<a href="javascript:void(0);" class="minitb_lk S_txt1" action-type="tab" action-data="index='+d+'">'+b[d].name+'</a><span class="cur_block"></span>';c.title=b[d].name;c.style.display=""}else{c.innerHTML='<a href="javascript:void(0);" class="minitb_lk S_txt1"></a><span class="cur_block"></span>';c.title="";c.style.display="none"}c.offsetWidth});m<=0?a.addClassName(g.getDomList().prev,"W_btn_b_disable"):a.removeClassName(g.getDomList().prev,"W_btn_b_disable");m>=b.length-5?a.addClassName(g.getDomList().next,"W_btn_b_disable"):a.removeClassName(g.getDomList().next,"W_btn_b_disable")}g.on("tab","click",function(e){l=e.data.index|0;a.foreach(j,function(b,c){a.removeClassName(b,"current");a.removeClassName(b.firstChild,"S_bg2")});a.addClassName(e.el.parentNode,"current");a.addClassName(e.el,"S_bg2");var f="",h;if(b[l].hotmap){f+='<ul class="faces_list_hot clearfix">';a.foreach([].concat(b[l].hotmap),function(a,b){h='suda="key=mainpub_default_expr&value='+c[b]+'"';f+='<li action-type="select" action-data="insert='+encodeURIComponent(a.phrase)+'" title="'+a.phrase.replace(/\[|\]/g,"")+'" '+h+'><img src="'+a.icon+'"/></li>'});f+="</ul>"}f+="<ul>";a.foreach([].concat(b[l].map),function(a){h='suda="key=pub_expression&value='+d[b[l].name]+'"';f+='<li action-type="select" action-data="insert='+encodeURIComponent(a.phrase)+'" title="'+a.phrase.replace(/\[|\]/g,"")+'" '+h+'><img src="'+a.icon+'"/></li>'});f+="</ul>";i.innerHTML=f;i.offsetWidth;k||(k=a.ui.scrollView(g.getDomList(!0).scrollView));setTimeout(function(){k.reset();k.scrollTop(0)})});g.on("prev","click",function(a){m=Math.max(m-5,0);e()});g.on("next","click",function(a){m=Math.min(m+5,b.length-5);e()});g.on("select","click",function(b){var c=a.sizzle("img",b.el)[0].getAttribute("src");g.trigger("insert",{value:decodeURIComponent(b.data.insert),url:c});var d=b.el.getAttribute("suda");if(d){d=a.queryToJson(d);window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack(d.key,d.value)}});g.on("beforeHide",function(){k.scrollEl.style.overflowY="hidden"});g.on("hide",function(){if(k){k.destroy();k=null}});e();g.trigger(j[0].firstChild,"click",null)});g.getBub=function(){return g};f.refer?g.show().setArrow("top").setAlignPos(b,f.refer,f):g.show().beside(b,f);return g}});
STK.register("lib.publisher.widget.face",function(a){var b=a.lib.face.face;return function(c,d){var e={},f,g;d=a.parseParam({t:0,l:-15,refer:c.nodeList.textEl,useAlign:!0,arrowOffset:2},d||{});var h=function(a,b){var d=c.API.getCurrentLogType();c.API.addShortUrlLog(d);c.API.insertText(b.value)},i=function(){a.core.evt.preventDefault();var g,i=a.fixEvent(a.getEvent()).target;g=i;f=b(g,d);a.custEvent.add(f,"insert",h);a.custEvent.define(c,"close");a.custEvent.add(c,"close",e.hide);a.custEvent.add(f,"hide",function(){a.custEvent.remove(f,"hide",arguments.callee);a.custEvent.remove(f,"insert",h);a.custEvent.remove(c,"close",e.hide)})};e.init=function(b,d,e){c=b;g=d;a.addEvent(b.nodeList[g],"click",i)};e.show=i;e.hide=function(){f&&f.getBub().hide()};e.destroy=function(){c=null};return e}});
STK.register("conf.trans.imageUploadBubble",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("cartoon",{url:"/aj/mblog/face?type=cartoon&_wv=5"});return b});
STK.register("lib.kit.extra.crc32",function(a){return function(a,b){function c(a){a=a.replace(/\r\n/g,"\n");var b="";for(var c=0;c<a.length;c++){var d=a.charCodeAt(c);if(d<128)b+=String.fromCharCode(d);else if(d>127&&d<2048){b+=String.fromCharCode(d>>6|192);b+=String.fromCharCode(d&63|128)}else{b+=String.fromCharCode(d>>12|224);b+=String.fromCharCode(d>>6&63|128);b+=String.fromCharCode(d&63|128)}}return b}a=c(a);var d="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D",b;typeof b=="undefined"&&(b=0);var e=0,f=0;b=b^-1;for(var g=0,h=a.length;g<h;g++){f=(b^a.charCodeAt(g))&255;e="0x"+d.substr(f*9,8);b=b>>>8^e}var i=b^-1;i<0&&(i=4294967296+i);return i}});
STK.register("lib.kit.extra.imageURL",function(a){return function(b,c){function h(b,c){var d;typeof c=="undefined"&&(c="bmiddle");if(b.charAt(9)=="w"||b.charAt(9)=="y"){var e=(a.lib.kit.extra.crc32(b)&3)+1,f=b.charAt(21)=="g"?"gif":"jpg";d=b.charAt(9)=="w"?window.location.protocol+"//ww"+e+".sinaimg.cn/"+c+"/"+b+"."+f:window.location.protocol+"//wx"+e+".sinaimg.cn/"+c+"/"+b+"."+f}else{var e=((b.substr(-2,2),16)&15)+1;d=window.location.protocol+"//ss"+e+".sinaimg.cn/"+c+"/"+b+"&690"}return d}function f(a){a=(a+"").replace(/[^a-f0-9]/gi,"");return parseInt(a,16)}var d={size:"small"};if(typeof b=="string"){d=a.core.obj.parseParam(d,c);var e=d.size,g={ss:{middle:"&690",bmiddle:"&690",small:"&690",thumbnail:"&690",square:"&690",orignal:"&690",thumb180:"&690",mw1024:"&690",orj480:"&690"},ww:{middle:"bmiddle",large:"large",bmiddle:"bmiddle",small:"small",thumbnail:"thumbnail",square:"square",orignal:"large",thumb180:"thumb180",mw690:"mw690",mw1024:"mw1024",orj480:"orj480"}},i=h(b,g.ww[e]);return i}}});
STK.register("conf.trans.watermark",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("waterMark",{url:"/aj/account/watermark"});return b});
STK.register("lib.image.watermark",function(a){var b={trans:null,conf:null,success:function(a,c){b.conf=a.data}},c=[];return function(d){if(typeof d=="function"){c.push(d);if(b.conf)for(var e=0;e<c.length;e++){c[e]&&c[e](b.conf);c[e]=null}else{b.trans||(b.trans=a.conf.trans.watermark.getTrans("waterMark",{onSuccess:function(){b.success.apply(null,arguments);for(var a=0;a<c.length;a++){c[a]&&c[a](b.conf);c[a]=null}},onError:function(a){},onFail:function(a){}}));b.trans.abort();b.trans.request()}}}});
STK.register("lib.kit.extra.upload",function(a){var b=a.lib.kit.extra.language;return function(c){var d={},e=window.location.href,f;c=a.parseParam({type:"common",form:null,base64Str:"",imgName:"",uploadArgs:{},file_source:0},c);a.custEvent.define(d,["uploadError","uploadSucc"]);var g={base64form:null,upload:function(b){var d,e=b,h="weibo.com/",i=window.$CONFIG,j=c.type;if(j==="common")d=c.form;else if(j==="base64"){d=a.C("form");g.base64form=d;d.method="POST";var k=a.C("input");k.name="b64_data";k.type="hidden";k.value=c.base64Str;d.appendChild(k);document.body.appendChild(d)}var l={marks:1,app:"miniblog",s:"rdxt",file_source:c.file_source||0};c.type==="common"||c.type==="base64"?l=a.lib.kit.extra.merge({url:e.domain=="1"?h+(i&&i.watermark||i.domain):0,markpos:e.position||"",logo:e.logo||"",nick:e.nickname=="1"?"@"+(i&&i.nick):0},l):c.type==="custom"&&(l=a.lib.kit.extra.merge(c.uploadArgs,l));j==="base64"&&(l=a.lib.kit.extra.merge({mime:"image/jpeg",data:"base64"},l));f=a.core.io.ijax({url:window.location.protocol+"//picupload.weibo.com/interface/pic_upload.php",form:d,abaurl:window.location.protocol+"//"+document.domain+"/aj/static/upimgback.html?_wv=5",abakey:"cb",timeout:18e5,onComplete:g.handle,onTimeout:g.handle,args:l})},sendError:function(b){var c=new Image,d=encodeURIComponent(navigator.userAgent),f=window.$CONFIG,g=a.lib.kit.extra.merge(b,{ua:d,rnd:(new Date).getTime(),uid:f?f.uid:0,referer:encodeURIComponent(e)});g=a.core.json.jsonToQuery(g);g="//ww1.sinaimg.cn/do_not_delete/fc.html?"+g;c.setAttribute("src",g)},handle:function(e){a.removeNode(g.base64form);g.base64form=null;var f=Math.abs(e.ret);if(!e||e.ret<0){var h="";switch(f){case 1:h="#L{没有登录}";break;case 4:case 9:h="#L{请上传5M以内的JPG、GIF、PNG图片。}";break;default:h="#L{上传图片超时}"}e?g.sendError({ret:e.ret}):g.sendError({ret:"none"});a.custEvent.fire(d,"uploadError",{code:f,msg:b(h)})}else{var i=new Date,j=function(a){return a<10?"0"+a:a},k;if(c.type==="common")k=c.imgName;else if(c.type==="base64"){var l=[i.getFullYear(),j(i.getMonth()+1),j(i.getDate()),j(i.getHours()),j(i.getMinutes()),j(i.getSeconds())].join("");k=b("#L{微博桌面截图}")+l+".jpg"}a.custEvent.fire(d,"uploadSucc",{pid:e.pid,imgName:k})}},init:function(){c.type==="common"||c.type==="base64"?a.lib.image.watermark(function(a){g.upload(a)}):g.upload()},destroy:function(){a.custEvent.undefine(d);a.removeNode(g.base64form)}};g.init();d.destroy=g.destroy;d.abort=function(){if(f)try{f.abort()}catch(a){}};return d}});
STK.register("lib.kit.extra.getFlashVersion",function(a){return function(){var a="1",b=navigator;if(b.plugins&&b.plugins.length){for(var c=0;c<b.plugins.length;c++)if(b.plugins[c]&&b.plugins[c].name&&b.plugins[c].name.indexOf("Shockwave Flash")!=-1){a=b.plugins[c].description.split("Shockwave Flash ")[1];break}}else if(window.ActiveXObject)for(var c=10;c>=2;c--)try{var d=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+c);if(d){a=c+".0";break}}catch(e){}return parseInt(a.split(".")[0])}});
STK.register("lib.kit.extra.installFlash",function(a){var b=a.lib.kit.extra.language;return function(c){c=a.parseParam({onHide:a.funcEmpty},c);var d='<div class="layer_version_upgrade"><dl class="point clearfix"><dt><span class="icon_versionup"></span></dt><dd><p class="S_txt1">#L{你的Flash版本过低，请安装更高版本的Flash插件后，再刷新页面重试}</p></dd></dl><div class="versionup_btn"><a class="btn_l" href="http://get.adobe.com/cn/flashplayer/" target="_blank"><img width="16" height="16" class="icon_install" title="" src="'+$CONFIG.imgPath+'style/images/common/transparent.gif">'+'<span class="txt">#L{安装更新}</span></a><a class="btn_r" href="javascript:void(0);" onclick="window.location.reload()">'+' <img width="16" height="16" class="icon_refreshpage" title="" src="'+$CONFIG.imgPath+'style/images/common/transparent.gif">'+'<span class="txt">#L{刷新页面}</span></a></div>'+"</div>",e='<div class="layer_point"><dl class="point clearfix"><dt><span class="W_icon icon_warnB"></span></dt><dd><p class="S_txt1">你的Flash版本过低，请安装更高版本的Flash插件后，再刷新页面重试？</p></dd></dl></div><div class="W_layer_btn S_bg1"><a href="http://get.adobe.com/cn/flashplayer/" target="_blank" class="W_btn_a btn_34px">安装更新</a><a href="javascript:void(0);" onclick="window.location.reload()" class="W_btn_b btn_34px">刷新页面</a></div>';a.lib.kit.io.cssLoader("style/css/module/layer/layer_version_upgrade.css","js_style_css_module_layer_layer_version_upgrade",function(){var d=a.ui.dialog();d.setTitle(b("#L{提示}"));d.setContent(e);d.show();d.setMiddle();a.custEvent.add(d,"hide",function(){a.custEvent.remove(d,"hide",arguments.callee);setTimeout(function(){c.onHide()},0)})})}});
STK.register("lib.kit.extra.swfobject",function(a){var b=function(){function W(b){var c=/[\\\"<>\.;]/,d=c.exec(b)!=null;return d&&typeof encodeURIComponent!=a?encodeURIComponent(b):b}function V(a,b){if(!!y){var c=b?"visible":"hidden";u&&Q(a)?Q(a).style.visibility=c:U("#"+a,"visibility:"+c)}}function U(b,d,e,f){if(!z.ie||!z.mac){var g=j.getElementsByTagName("head")[0];if(!g)return;var h=e&&typeof e=="string"?e:"screen";if(f){w=null;x=null}if(!w||x!=h){var i=R("style");i.setAttribute("type","text/css");i.setAttribute("media",h);w=g.appendChild(i);z.ie&&z.win&&typeof j.styleSheets!=a&&j.styleSheets.length>0&&(w=j.styleSheets[j.styleSheets.length-1]);x=h}z.ie&&z.win?w&&typeof w.addRule==c&&w.addRule(b,d):w&&typeof j.createTextNode!=a&&w.appendChild(j.createTextNode(b+" {"+d+"}"))}}function T(a){var b=z.pv,c=a.split(".");c[0]=parseInt(c[0],10);c[1]=parseInt(c[1],10)||0;c[2]=parseInt(c[2],10)||0;return b[0]>c[0]||b[0]==c[0]&&b[1]>c[1]||b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]?!0:!1}function S(a,b,c){a.attachEvent(b,c);p[p.length]=[a,b,c]}function R(a){return j.createElement(a)}function Q(a){var b=null;try{b=j.getElementById(a)}catch(c){}return b}function P(a){var b=Q(a);if(b){for(var c in b)typeof b[c]=="function"&&(b[c]=null);b.parentNode.removeChild(b)}}function O(a){var b=Q(a);if(b&&b.nodeName=="OBJECT")if(z.ie&&z.win){b.style.display="none";(function(){b.readyState==4?P(a):setTimeout(arguments.callee,10)})()}else b.parentNode.removeChild(b)}function N(a,b,c){var d=R("param");d.setAttribute("name",b);d.setAttribute("value",c);a.appendChild(d)}function M(b,d,e){var g,h=Q(e);if(z.wk&&z.wk<312)return g;if(h){typeof b.id==a&&(b.id=e);if(z.ie&&z.win){var i="";for(var j in b)b[j]!=Object.prototype[j]&&(j.toLowerCase()=="data"?d.movie=b[j]:j.toLowerCase()=="styleclass"?i+=' class="'+b[j]+'"':j.toLowerCase()!="classid"&&(i+=" "+j+'="'+b[j]+'"'));var k="";for(var l in d)d[l]!=Object.prototype[l]&&(k+='<param name="'+l+'" value="'+d[l]+'" />');h.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+i+">"+k+"</object>";o[o.length]=b.id;g=Q(b.id)}else{var m=R(c);m.setAttribute("type",f);for(var n in b)b[n]!=Object.prototype[n]&&(n.toLowerCase()=="styleclass"?m.setAttribute("class",b[n]):n.toLowerCase()!="classid"&&m.setAttribute(n,b[n]));for(var p in d)d[p]!=Object.prototype[p]&&p.toLowerCase()!="movie"&&N(m,p,d[p]);h.parentNode.replaceChild(m,h);g=m}}return g}function L(a){var b=R("div");if(z.win&&z.ie)b.innerHTML=a.innerHTML;else{var d=a.getElementsByTagName(c)[0];if(d){var e=d.childNodes;if(e){var f=e.length;for(var g=0;g<f;g++)(e[g].nodeType!=1||e[g].nodeName!="PARAM")&&e[g].nodeType!=8&&b.appendChild(e[g].cloneNode(!0))}}}return b}function K(a){if(z.ie&&z.win&&a.readyState!=4){var b=R("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(L(a),b);a.style.display="none";(function(){a.readyState==4?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)})()}else a.parentNode.replaceChild(L(a),a)}function J(b,c,d,e){v=!0;s=e||null;t={success:!1,id:d};var f=Q(d);if(f){if(f.nodeName=="OBJECT"){q=L(f);r=null}else{q=f;r=d}b.id=g;if(typeof b.width==a||!/%$/.test(b.width)&&parseInt(b.width,10)<310)b.width="310";if(typeof b.height==a||!/%$/.test(b.height)&&parseInt(b.height,10)<137)b.height="137";j.title=j.title.slice(0,47)+" - Flash Player Installation";var h=z.ie&&z.win?"ActiveX":"PlugIn",k="MMredirectURL="+i.location.toString().replace(/&/g,"%26")+"&MMplayerType="+h+"&MMdoctitle="+j.title;typeof c.flashvars!=a?c.flashvars+="&"+k:c.flashvars=k;if(z.ie&&z.win&&f.readyState!=4){var l=R("div");d+="SWFObjectNew";l.setAttribute("id",d);f.parentNode.insertBefore(l,f);f.style.display="none";(function(){f.readyState==4?f.parentNode.removeChild(f):setTimeout(arguments.callee,10)})()}M(b,c,d)}}function I(){return!v&&T("6.0.65")&&(z.win||z.mac)&&!(z.wk&&z.wk<312)}function H(b){var d=null,e=Q(b);if(e&&e.nodeName=="OBJECT")if(typeof e.SetVariable!=a)d=e;else{var f=e.getElementsByTagName(c)[0];f&&(d=f)}return d}function G(){var b=n.length;if(b>0)for(var c=0;c<b;c++){var d=n[c].id,e=n[c].callbackFn,f={success:!1,id:d};if(z.pv[0]>0){var g=Q(d);if(g)if(T(n[c].swfVersion)&&!(z.wk&&z.wk<312)){V(d,!0);if(e){f.success=!0;f.ref=H(d);e(f)}}else if(n[c].expressInstall&&I()){var h={};h.data=n[c].expressInstall;h.width=g.getAttribute("width")||"0";h.height=g.getAttribute("height")||"0";g.getAttribute("class")&&(h.styleclass=g.getAttribute("class"));g.getAttribute("align")&&(h.align=g.getAttribute("align"));var i={},j=g.getElementsByTagName("param"),k=j.length;for(var l=0;l<k;l++)j[l].getAttribute("name").toLowerCase()!="movie"&&(i[j[l].getAttribute("name")]=j[l].getAttribute("value"));J(h,i,d,e)}else{K(g);e&&e(f)}}else{V(d,!0);if(e){var m=H(d);if(m&&typeof m.SetVariable!=a){f.success=!0;f.ref=m}e(f)}}}}function F(){var b=j.getElementsByTagName("body")[0],d=R(c);d.setAttribute("type",f);var e=b.appendChild(d);if(e){var g=0;(function(){if(typeof e.GetVariable!=a){var c=e.GetVariable("$version");if(c){c=c.split(" ")[1].split(",");z.pv=[parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10)]}}else if(g<10){g++;setTimeout(arguments.callee,10);return}b.removeChild(d);e=null;G()})()}else G()}function E(){l?F():G()}function D(b){if(typeof i.addEventListener!=a)i.addEventListener("load",b,!1);else if(typeof j.addEventListener!=a)j.addEventListener("load",b,!1);else if(typeof i.attachEvent!=a)S(i,"onload",b);else if(typeof i.onload=="function"){var c=i.onload;i.onload=function(){c();b()}}else i.onload=b}function C(a){u?a():m[m.length]=a}function B(){if(!u){try{var a=j.getElementsByTagName("body")[0].appendChild(R("span"));a.parentNode.removeChild(a)}catch(b){return}u=!0;var c=m.length;for(var d=0;d<c;d++)m[d]()}}var a="undefined",c="object",d="Shockwave Flash",e="ShockwaveFlash.ShockwaveFlash",f="application/x-shockwave-flash",g="SWFObjectExprInst",h="onreadystatechange",i=window,j=document,k=navigator,l=!1,m=[E],n=[],o=[],p=[],q,r,s,t,u=!1,v=!1,w,x,y=!0,z=function(){var b=typeof j.getElementById!=a&&typeof j.getElementsByTagName!=a&&typeof j.createElement!=a,g=k.userAgent.toLowerCase(),h=k.platform.toLowerCase(),m=h?/win/.test(h):/win/.test(g),n=h?/mac/.test(h):/mac/.test(g),o=/webkit/.test(g)?parseFloat(g.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,p=!1,q=[0,0,0],r=null;if(typeof k.plugins!=a&&typeof k.plugins[d]==c){r=k.plugins[d].description;if(r&&(typeof k.mimeTypes==a||!k.mimeTypes[f]||!!k.mimeTypes[f].enabledPlugin)){l=!0;p=!1;r=r.replace(/^.*\s+(\S+\s+\S+$)/,"$1");q[0]=parseInt(r.replace(/^(.*)\..*$/,"$1"),10);q[1]=parseInt(r.replace(/^.*\.(.*)\s.*$/,"$1"),10);q[2]=/[a-zA-Z]/.test(r)?parseInt(r.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else if(typeof i.ActiveXObject!=a)try{var s=new ActiveXObject(e);if(s){r=s.GetVariable("$version");if(r){p=!0;r=r.split(" ")[1].split(",");q=[parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)]}}}catch(t){}return{w3:b,pv:q,wk:o,ie:p,win:m,mac:n}}(),A=function(){if(!!z.w3){(typeof j.readyState!=a&&j.readyState=="complete"||typeof j.readyState==a&&(j.getElementsByTagName("body")[0]||j.body))&&B();if(!u){typeof j.addEventListener!=a&&j.addEventListener("DOMContentLoaded",B,!1);if(z.ie&&z.win){j.attachEvent(h,function(){if(j.readyState=="complete"){j.detachEvent(h,arguments.callee);B()}});i==top&&function(){if(!u){try{j.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}B()}}()}z.wk&&function(){if(!u){if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return}B()}}();D(B)}}}(),X=function(){z.ie&&z.win&&window.attachEvent("onunload",function(){var a=p.length;for(var c=0;c<a;c++)p[c][0].detachEvent(p[c][1],p[c][2]);var d=o.length;for(var e=0;e<d;e++)O(o[e]);for(var f in z)z[f]=null;z=null;for(var g in b)b[g]=null;b=null})}();return{registerObject:function(a,b,c,d){if(z.w3&&a&&b){var e={};e.id=a;e.swfVersion=b;e.expressInstall=c;e.callbackFn=d;n[n.length]=e;V(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){if(z.w3)return H(a)},embedSWF:function(b,d,e,f,g,h,i,j,k,l){var m={success:!1,id:d};if(z.w3&&!(z.wk&&z.wk<312)&&b&&d&&e&&f&&g){V(d,!1);C(function(){e+="";f+="";var n={};if(k&&typeof k===c)for(var o in k)n[o]=k[o];n.data=b;n.width=e;n.height=f;var p={};if(j&&typeof j===c)for(var q in j)p[q]=j[q];if(i&&typeof i===c)for(var r in i)typeof p.flashvars!=a?p.flashvars+="&"+r+"="+i[r]:p.flashvars=r+"="+i[r];if(T(g)){var s=M(n,p,d);n.id==d&&V(d,!0);m.success=!0;m.ref=s}else{if(h&&I()){n.data=h;J(n,p,d,l);return}V(d,!0)}l&&l(m)})}else l&&l(m)},switchOffAutoHideShow:function(){y=!1},ua:z,getFlashPlayerVersion:function(){return{major:z.pv[0],minor:z.pv[1],release:z.pv[2]}},hasFlashPlayerVersion:T,createSWF:function(a,b,c){return z.w3?M(a,b,c):undefined},showExpressInstall:function(a,b,c,d){z.w3&&I()&&J(a,b,c,d)},removeSWF:function(a){z.w3&&O(a)},createCSS:function(a,b,c,d){z.w3&&U(a,b,c,d)},addDomLoadEvent:C,addLoadEvent:D,getQueryParamValue:function(a){var b=j.location.search||j.location.hash;if(b){/\?/.test(b)&&(b=b.split("?")[1]);if(a==null)return W(b);var c=b.split("&");for(var d=0;d<c.length;d++)if(c[d].substring(0,c[d].indexOf("="))==a)return W(c[d].substring(c[d].indexOf("=")+1))}return""},expressInstallCallback:function(){if(v){var a=Q(g);if(a&&q){a.parentNode.replaceChild(q,a);if(r){V(r,!0);z.ie&&z.win&&(q.style.display="block")}s&&s(t)}v=!1}}}}();return b});
STK.register("lib.image.imgUpload",function(a){var b=document.documentElement,c=document.body,d={getScroll:function(){var a,d,e,f;if(b&&b.scrollTop){a=b.scrollTop;d=b.scrollLeft;e=b.scrollWidth;f=b.scrollHeight}else if(c){a=c.scrollTop;d=c.scrollLeft;e=c.scrollWidth;f=c.scrollHeight}return{t:a,l:d,w:e,h:f}},getScreen:function(){var c={};if(a.IE){c.w=b.clientWidth;c.h=b.clientHeight}else{c.w=window.innerWidth;c.h=window.innerHeight}return c}},e=function(a){var b={cn:"zh_CN",tw:"zh_TW"};a=a.toLowerCase();a=a.replace(/zh-/g,"");return b[a]};return function(b,f){var g={version:$CONFIG.version,swf_path:$CONFIG.jsPath+"home/static/swf/img/",service:b.service,ed_swf:b.swf||"PhotoEditor.swf",exp_swf:"expressInstall.swf",h:b.h||385,w:b.w||528,f_version:"10.0.0",channel:b.id+"_channel",id_panel:b.id+"_panel",id_swf:b.id+"_swf"},h={},i,j,k={init:function(){f.init&&f.init(h,b)},setHeight:function(b){a.IE||(m.getFlash(g.id_swf).height=b)},upComplate:function(a){b.sucess&&b.sucess(a);i.style.display="none";h.destory()},closeEditor:function(){i.style.display="none";h.destory();f.close&&f.close(h,b)},suda:function(a){window.SUDA&&SUDA.uaTrack&&SUDA.uaTrack("meitu","v4||"+a)}},l={version:g.version,language:e($CONFIG.lang),channel:g.channel,JSHandler:"STK.core.util.listener.fire",initFun:"init",changeFlashHeightFun:"setHeight",uploadCompleteFun:"upComplate",closePhotoEditorFun:"closeEditor",suda:"suda"},m={init:function(){if(!!b.id){i=a.E(g.id_panel);j=a.E(g.id_swf);if(!i){i=a.C("div");i.id=g.id_panel;c.appendChild(i)}if(!j){j=a.C("div");j.id=g.id_swf;i.appendChild(j)}i.style.display="none";m.getFlash(g.id_swf)||m.build()}},checkAction:function(a,b){var c=STK.core.util.listener.list;return!!c[a]&&!!c[a][b]},bindEvt:function(a){for(var b in a)k[a[b]]&&!m.checkAction(g.channel,a[b])&&STK.core.util.listener.register(g.channel,a[b],k[a[b]])},build:function(){var c=b.baseDir?b.baseDir+"/":"",d={menu:"true",scale:"noScale",allowFullscreen:"true",allowScriptAccess:"always",bgcolor:"#FFFFFF",wmode:a.IE?"window":"transparent",base:g.swf_path+c},e={id:b.id};m.bindEvt(l);a.lib.kit.extra.swfobject.embedSWF(g.swf_path+c+g.ed_swf+"?version="+g.version,g.id_swf,g.w,g.h,g.f_version,g.swf_path+g.exp_swf,l,d,e)},getFlash:function(){return a.lib.kit.extra.swfobject.getObjectById(b.id)},setPos:function(){var c,e,f,h,j=d.getScroll(),k=d.getScreen();f=Math.round(g.h>k.h?k.h/5+j.t:(k.h-g.h)/2+j.t);h=Math.round(g.w>k.w?k.w/5+j.l:(k.w-g.w)/2+j.l);c=b.pos.t-1||f;e=b.pos.l||h;i.style.zIndex=b.zIndex||2e4;a.setStyle(i,"position","absolute");a.setStyle(i,"left",e+"px");a.setStyle(i,"top",c+"px")},autoScroll:function(a,b,c){var d,e,f,g=8,h;g=c||g;h=a-b;e=[h];e[g]=0;f=1;for(f;f<g;f++)e[f]=h=h/2;clearInterval(d);d=setInterval(function(){e.length?window.scrollTo(0,b+e.shift()):clearInterval(d)},30)}};h.show=function(a){a&&(b.id=a);i&&(i.style.display="");m.setPos();return this};h.hide=function(){i&&(i.style.display="");return this};h.setPars=function(a){var b={imageURL:a||"",uploadURL:g.service};m.getFlash(g.id_swf).editPhoto(b);return this};h.getSwf=m.getFlash;h.destory=function(){for(var b in l)k[l[b]]&&STK.core.util.listener.remove(g.channel,l[b],k[l[b]]);i.innerHTML="";a.removeNode(i)};m.init();return h}});
STK.register("lib.browser.plugin.plugInstallState",function(a){return function(b,c,d,e){var f={},g=a.core.util.browser,h=window.navigator,i=!!window.ActiveXObject||"ActiveXObject"in window,j=g.MOZ,k=g.OPERA,l=g.SAFARI,m=g.CHROME,n=g.Version,o=c.embedId,p=c.embedType,q=b.pluginName,r=b.activeXName;f.instance=e;var s=function(){var a;for(a=0;a<d.length;a++)if(!(d.param[a]in f.instance))break;return a<d.length-1?!1:!0};f.getInstallState=function(){if(i){var b;if(!f.instance)try{f.instance=new ActiveXObject(r);b=!0}catch(c){f.instance=null}if(f.instance){if(s())return"ieinstalled";if(!b)try{f.instance=new ActiveXObject(r)}catch(c){f.instance=null}return f.instance?s()?"ieinstalled":"ieneedUpdate":"ieneedInstall"}return"ieneedInstall"}var d=h.plugins,e;if(d&&d.length)for(var g=0,j=d.length;g<j;g++){var k=d[g];if(k&&k.name&&k.name===q){e=!0;break}}if(e){if(!f.instance){var l=a.C("embed");l.id=o;l.type=p;l.setAttribute("hidden",!0);document.body.appendChild(l);f.instance=l}return"installed"}f.instance=null;return"needInstall"};return f}});
STK.register("lib.browser.plugin.screenCapture",function(a){var b=a.core.util.browser,c=a.lib.kit.extra.language,d=function(a,b){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack(a,b)},e=!!window.ActiveXObject||"ActiveXObject"in window,f=b.MOZ,g=b.OPERA,h=b.SAFARI,i=b.CHROME,j=b.Version,k="weibo_screen_grab_download",l={pluginName:"npScreenGrab Plugin",activeXName:"ScreenGrab.ScreenGrabCom.1"},m={embedId:"weibo_screen_grab_embed",embedType:"application/x-screengrab-sina"},n={param1:"OnGrapContent",param2:"CloseScreenGrabCtrlWnd",param3:"onmsgfireevent"},o,p={spec:null,setCurrentSpec:function(a){p.spec=a},setup:function(){if(typeof o.OnGrapContent!="function"){o.OnGrapContent=function(a,b,c,d){var e=p.spec;q.focusWindow();if(a===2){if(e.captureType==="base64")e.captureSuccess(c);else if(e.captureType==="pid"){e.beforeUpload();e.upload(c)}}else if(a===3){q.focusWindow();e.captureCancel()}};o.onmsgfireevent=function(a,b){if(b===2){q.focusWindow();spec.captureCancel()}};a.addEvent(window,"unload",function(){a.removeEvent(window,"unload",arguments.callee);if(o)try{o.CloseScreenGrabCtrlWnd();o.onmsgfireevent=null;o.OnGrapContent=null;o=null}catch(b){}})}}},q={};q.isSupport=function(){return b.OS==="windows"?e?!0:f?j>=3.6?!0:!1:g?!1:h?!1:i?j>=4?!0:!1:!1:!1};q.focusWindow=function(){window.focus()};q.hide=function(){o&&o.CloseScreenGrabCtrlWnd()};q.screenCapture=function(b){var g,h={uploadSucc:function(a,c){q.focusWindow();b.captureSuccess(c)},uploadErr:function(a,c){b.captureError(c)}},j=function(b){g&&g.destroy();g=a.lib.kit.extra.upload({type:"base64",base64Str:b});a.custEvent.add(g,"uploadSucc",h.uploadSucc);a.custEvent.add(g,"uploadError",h.uploadErr)},r=function(){b.upload=function(a){j(a)};p.setup();p.setCurrentSpec(b);if(a.isArray(b.showPos)){var c=b.showPos;o.ShowControlWnd(c[0],c[1],c[2],c[3])}else if(typeof b.showPos=="function"){var c=b.showPos();a.isArray(c)&&o.ShowControlWnd(c[0],c[1],c[2],c[3])}else if(b.showPos==="center"){var d=a.scrollPos(),e=200,f=200,g=a.winSize(),h=Math.floor(d.top+(g.height-e)/2),i=Math.floor(d.left+(g.width-f)/2);o.ShowControlWnd(window.screenLeft+i,window.screenTop+h,f,e)}else b.showPos==="default"&&o.ShowControlWnd(-1,-1,-1,-1)},s=function(b,e){var f="//desktop.weibo.com/download.php?source=jietu",g='<#et screentip data><div class="layer_screenshot_tips"><p class="tip"><span class="icon_warnM"></span>${data.titletip}。</p><div><a href="//desktop.weibo.com" target="_blank"><img src="${data.imgsrc}" alt=""></a></div></div></div></#et>',h={imgsrc:(window.$CONFIG&&window.$CONFIG.imgPath||"//img.t.sinajs.cn/t6/")+"style/images/layer/pic_screenshot.png?version="+(window.$CONFIG&&window.$CONFIG.version||""),titletip:b==="IE"?"#L{使用此功能，需要先安装微博桌面}":"#L{使用此功能，需要先安装微博桌面插件}"+(b==="FF"?"，#L{并重新启动浏览器才能使用}":""),downloadTitle:"#L{立即下载}"},i=a.ui.dialog();i.setTitle(c("#L{截屏插件安装提示}"));i.setContent(c(a.core.util.easyTemplate(g,h).toString()));i.show();i.setMiddle();var j=i.getDomList(!0),l=function(){i.hide();d("tblog_image_cut","cancel_download")},m=function(b){var c=a.E(k);if(!c){c=a.C("iframe");c.id=k;c.style.display="none";a.core.util.hideContainer.appendChild(c)}c.src=f;d("tblog_image_cut","download");i.hide()};a.custEvent.add(i,"hide",function(){a.custEvent.remove(i,"hide",arguments.callee);e()})},t=function(){b.beforeSupportTip();a.ui.alert(c("#L{微博截图功能暂未支持你的浏览器，目前微博截图插件支持Windows系统下的以下浏览器：IE浏览器，支持IE6及更新版本。IE内核浏览器，如360安全浏览器，傲游等浏览器。Firefox浏览器，支持3.6及更新版本。Chrome浏览器，支持4.0及更新版本。Chronium内核浏览器，如360急速浏览器，搜狗等浏览器}。"),{title:c("#L{暂不支持当前浏览器}"),icon:"warnB",OK:function(){setTimeout(function(){b.supportTipOk()},0)}});d("tblog_image_cut","not_support_browser")},u=function(){var c=e?"IE":f?"FF":i?"CHROME":"";b=a.parseParam({captureType:"base64",captureSuccess:a.funcEmpty,captureCancel:a.funcEmpty,captureError:a.funcEmpty,beforeUpload:a.funcEmpty,showPos:"default",beforeSupportTip:a.funcEmpty,supportTip:t,supportTipOk:a.funcEmpty,beforeIeInstallTip:a.funcEmpty,ieInstallTip:function(){b.beforeIeInstallTip();s(c,b.ieInstallTipOk)},ieInstallTipOk:a.funcEmpty,beforeInstallTip:a.funcEmpty,installTip:function(){b.beforeInstallTip();s(c,b.installTipOk)},installTipOk:a.funcEmpty},b||{});var d=q.isSupport();if(!d)b.supportTip();else{var g=a.lib.browser.plugin.plugInstallState(l,m,n,o),h=g.getInstallState();o=g.instance;h==="installed"||h==="ieinstalled"?r():h==="ieneedUpdate"||h==="ieneedInstall"?b.ieInstallTip():h==="needInstall"&&b.installTip()}};return{doit:u,hide:q.hide,focusWindow:q.focusWindow,abort:function(){try{g&&g.abort()}catch(a){}}}};return q});
STK.register("lib.image.uploadBubble",function(a){var b=window.$CONFIG,c=[];(function(){b&&b.bigpipe==="true"&&a.historyM&&a.historyM.onpopstate(function(b,d){if(d){a.foreach(c,function(a){a()});c=[]}})})();var d=a.conf.trans.imageUploadBubble;return function(e,f){var g,h,i=a.lib.browser.plugin.screenCapture,j=a.lib.kit.extra.language,k='<div node-type="outer"><div class="layer_send_pic" node-type="wrap"><div node-type="inner"><div node-type="tabs"><div class="profile_tab S_line5"><ul class="pftb_ul layer_tab S_line1"><li class="pftb_itm S_line1"><a class="pftb_lk current S_line5 S_txt1 S_bg5" href="javascript:void(0);" node-type="tab1" action-type="tab">#L{本地上传}</a></li><li class="pftb_itm pftb_itm_lst S_line1"><a  class="pftb_lk S_line5 S_txt1 S_bg1" href="javascript:void(0);" node-type="tab2" action-type="tab">#L{推荐配图}</a></li></ul></div></div><div node-type="content"></div></div><div node-type="uploaded" style="display:none"><div class="laPic_tit"><span node-type="pName"></span><span class="right"></span></div><div node-type="picWrap" class="laPic_Pic"></div><div class="lapic_edit"><a class="beautify" href="javascript:void(0);" node-type="beautify" action-type="beautify" suda-data="key=meitu&value=v4||publish||editor"><span class="W_ico12 icon_edit"></span>#L{编辑}</a><a class="delete" href="javascript:void(0);" action-type="delete"><span class="W_ico12 ico_del"></span>#L{删除}</a></div></div><div node-type="flashPanel"></div>',l='<#et uppic data><div node-type="uppic">    <div class="laPic_btnBox clearfix">        <div class="laPic_btnmore">            <a href="javascript:void(0);" class="W_btn_e" node-type="inputCover">                <span><em class="ico_one"></em>#L{单张图片}</span>                <form node-type="form" action-type="form" id="pic_upload" name="pic_upload" target="upload_target" enctype="multipart/form-data" method="POST" action="">                    <input class="input_f" type="file" hidefoucs="true" style="" node-type="fileBtn" name="pic1"/>                </form></a>        </div>        <div class="laPic_btnmore">            <a href="javascript:void(0);" class="W_btn_e" action-type="more" suda-data="key=meitu&value=v4||publish||more">                <span><em class="ico_ones"></em>#L{多张图片}</span>            </a>        </div>        <#if (data.supportCapture)><div class="laPic_btnmore">            <a href="javascript:void(0);" class="W_btn_e" action-type="screen_window" suda-data="key=tblog_image_cut&value=open_image_cut">                <span><em class="ico_screenshot"></em>#L{截屏上传}</span>            </a>        </div></#if>       <div class="laPic_btnmore">           <a href="javascript:void(0);" class="W_btn_e" action-type="face_sticker">               <span><em class="ico_bigface"></em>#L{大 头 贴}</span>           </a>       </div>       <div class="laPic_btnmore">           <a href="javascript:void(0);" class="W_btn_e" action-type="upload_album">               <span><em class="ico_toalbum"></em>#L{上传到相册}</span>           </a>       </div>    </div></div><div node-type="loading"  style="width:230px;display:none"><div class="laPic_con"><div><i class="W_loading"></i><span>#L{图片正在上传，请等待}...</span></div></div><div class="laPic_btn"><a href="javascript:void(0);" class="W_btn_b" action-type="cancel"><span>#L{取消上传}</span></a></div></div></#et>',m='<p class="tab_kind S_link2"><span class="right"><a class="pre_d" action-type="prev" node-type="prev" href="javascript:void(0);"></a><a class="next" action-type="next" node-type="next" href="javascript:void(0);"></a></span><em node-type="categorys"></em></p><div node-type="loading"></div><div class="detail"><ul node-type="list" class="faces_magic_list clearfix"></ul><div node-type="page" class="W_pages_minibtn"></div></div>',n='<div><i class="W_loading"></i> <span>正在加载，请稍候...</span></div>',o='<a href="javascript:void(0);" onclick="return false;" action-type="category" action-data="category=#{item}">#{item}</a>',p='<a href="javascript:void(0);"  onclick="return false;" action-type="category" action-data="category=#{item}" class="current S_txt1">#{item}</a>',q='<li><a action-type="insertSmiley" action-data="url=#{thumb}&pid=#{picid}&value=#{value}" class="img" href="javascript:void(0);"><img src="#{thumb}" original="#{original}" title="#{value}" alt="#{phrase}" /></a><span title="#{value}"  action-type="insertSmiley" action-data="url=#{thumb}&pid=#{picid}&value=#{value}">#{phrase}</span></li>',r='<a action-type="page" class="page S_bg1" action-data="num=#{number}" href="javascript:void(0);" >#{label}</a>',s='<a action-type="page" action-data="num=#{number}" href="javascript:void(0);"  class="page S_txt1"  onclick="return false;">#{label}</a>',t="",u=j("#L{默认}"),v="#L{分享图片}",w="##L{微博大头贴}#",x=5,y="weibo.com/",z,A,B,C,D,E,F,G,H,I,J,K,L={},M={page:0,cache:null,cPoniter:0,categorys:[],currentCategory:u,itemNumber:10},N,O,P=a.core.dom.position,Q=a.core.evt.addEvent,R=a.core.evt.removeEvent,S=function(){B=T;a.custEvent.define(L,["uploaded","hide","insert","deletePIC","picLoad"]);a.custEvent.add(g,"hide",function(b){return function(){T.abortUpload();T.hideCapture();a.custEvent.remove(b,"hide",arguments.callee);a.custEvent.fire(L,"hide",{});H=0}}(g));h=a.ui.mod.tab({templete:z,eventType:"click"});a.custEvent.add(h,"tabOut",function(a,b){b=="tab1"?U.init():b=="tab2"&&T.init()});K=a.core.evt.delegatedEvent(z);T.bind()},T={abortUpload:function(){E&&E.abort();F&&F.abort()},init:function(){B=T;T.initDom();T.bind()},initDom:function(){var b;N.wrap.className="layer_send_pic";var c={supportCapture:!0};N.content.innerHTML=j(a.core.util.easyTemplate(l,c).toString());N.close=a.builder(g.getBox()).list.close[0];b=a.lib.kit.dom.parseDOM(a.core.dom.builder(z).list);N=a.lib.kit.extra.merge(N,b);T.exchangeInput()},bind:function(){Q(N.fileBtn,"change",V.upload);Q(N.fileBtn,"click",T.hideCapture);K.add("delete","click",T.deletePic);K.add("cancel","click",T.cancelUpload);K.add("more","click",T.morePic);K.add("beautify","click",T.beautify);K.add("screen_window","click",T.captureWindow);K.add("face_sticker","click",T.faceSticker);K.add("upload_album","click",T.uploadAblum)},destroy:function(){N.fileBtn&&R(N.fileBtn,"click",T.hideCapture);N.fileBtn&&R(N.fileBtn,"change",V.upload)},handleError:function(b){T.stopUpload();g.stopBoxClose();T.resetInput();a.ui.alert(j(b.msg),{OK:function(){b.code==1&&window.location.reload();setTimeout(function(){g.startBoxClose()},0)}})},handleSucc:function(a){T.rendSucc(a);T.stopUpload()},rendLoad:function(){g.stopBoxClose();N.uppic.style.display="none";N.loading.style.display=""},rendSucc:function(b){var c=a.lib.kit.extra.imageURL(b.pid),d=[],e,f;J=J||b.pid;d=J.split(/\/|\\/);e=d[d.length-1];d=e.split(".");if(d.length>1&&a.bLength(d[0])>20){d[0]=a.leftB(d[0],20);f=[d[0],"...",d[1]].join("")}else f=e;D=b.pid;V.loadPic({url:c,value:f,pid:b.pid});N.beautify&&(N.beautify.style.display="")},deletePic:function(){a.preventDefault();N.close.style.display="";N.inner.style.display="";N.wrap.style.width="";N.uploaded.style.display="none";N.picWrap.innerHTML="";B.destroy();B.init();g.startBoxClose();a.custEvent.fire(L,"deletePIC",{text:j(I)});H=0},stopUpload:function(){N.loading.style.display="none";N.uppic.style.display=""},cancelUpload:function(){T.abortUpload();T.stopUpload();T.resetInput();g.startBoxClose()},exchangeInput:function(){var b=N.fileBtn,c=b.parentNode,d=b.className,e=b.name,f=a.C("input");f.className=d;f.name=e;f.type="file";f.hideFocus="true";N.fileBtn=f;c.removeChild(b);c.appendChild(f)},resetInput:function(){R(N.fileBtn,"click",T.hideCapture);R(N.fileBtn,"change",V.upload);T.exchangeInput();Q(N.fileBtn,"change",V.upload);Q(N.fileBtn,"click",T.hideCapture)},beautifySucess:function(a){J=a;T.handleSucc({pid:a})},faceStickerSucess:function(a){H=1;J=a;T.handleSucc({pid:a})},morePic:function(){T.uploadWaterMarkFlash({id:"photo_merge",swf:"SinaCollage.swf",width:528,height:470,sucess:T.beautifySucess})},faceSticker:function(){T.uploadWaterMarkFlash({id:"photo_facesticker",swf:"FacePhoto.swf",width:568,height:478,baseDir:"facesticker",sucess:T.faceStickerSucess})},uploadWaterMarkFlash:function(c){a.preventDefault();T.hideCapture();g.stopBoxClose();if(a.lib.kit.extra.getFlashVersion()<10)a.lib.kit.extra.installFlash({onHide:function(){g.startBoxClose()}});else{var d=function(d){var e=d.nickname!="0"||d.logo!="0"||d.domain!="0",f=b&&b.nick||"",h=O.protocol+"//picupload.weibo.com/interface/pic_upload.php?app=miniblog"+"&marks="+(e?"1":"0")+(d.logo=="1"?"&logo=1":"")+(d.nickname=="1"?"&nick="+(f?encodeURIComponent("@"+f):""):"")+(d.domain=="1"?"&url="+y+(b&&b.watermark||b.domain):"")+(d.position?"&markpos="+d.position:"")+"&s=xml&cb=//weibo.com/upimgback.html&rq=http%3A%2F%2Fphoto.i.weibo.com%2Fpic%2Fadd.php%3Fapp%3D1",i={id:c.id,pos:g.getPosition(),service:h,sucess:c.sucess,h:c.height,w:c.width,swf:c.swf,baseDir:c.baseDir||""};a.lib.image.imgUpload(i,{init:function(a,b){a.setPars()},close:function(a,b){setTimeout(function(){g.startBoxClose()},100)}}).show()};a.lib.image.watermark(function(a){d(a)})}},beautify:function(){a.preventDefault();if(a.lib.kit.extra.getFlashVersion()<10)a.lib.kit.extra.installFlash();else{var b={id:"photo_editor",pos:g.getPosition(),service:O.protocol+"//picupload.weibo.com/interface/pic_upload.php?app=miniblog&s=xml&cb=http://weibo.com/upimgback.html&rq=http%3A%2F%2Fphoto.i.weibo.com%2Fpic%2Fadd.php%3Fapp%3D1",sucess:T.beautifySucess,h:385,w:528,swf:"PhotoEditor.swf"};a.lib.image.imgUpload(b,{init:function(b,c){b.setPars(a.lib.kit.extra.imageURL(D,{size:"large"}))},close:function(a,b){}}).show()}},hideCapture:function(){F&&F.hide()},captureWindow:function(){a.preventDefault();if(!F){var b=function(){g.stopBoxClose()},c=function(){g.startBoxClose()};F=i.screenCapture({captureType:"pid",beforeUpload:T.beforeCaptureUpload,captureSuccess:T.captureSuccess,captureError:T.handleError,beforeSupportTip:b,supportTipOk:c,beforeIeInstallTip:b,ieInstallTipOk:c,beforeInstallTip:b,installTipOk:c})}F.doit()},beforeCaptureUpload:function(){T.rendLoad()},captureSuccess:function(a){J=a.imgName;G=1;T.handleSucc(a)},uploadAblum:function(){window.open("http://photo.weibo.com/upload/weibo","","width=650, height=470, top=300, left=400")}},U={init:function(){B=U;T.abortUpload();T.hideCapture();var b;N.wrap.className="layer_faces";T.destroy();N.content.innerHTML=j(m);b=a.lib.kit.dom.parseDOM(a.core.dom.builder(z).list);N=a.lib.kit.extra.merge(N,b);N.loading.innerHTML=j(n);U.cartoonStart();U.bind()},bind:function(){K.add("insertSmiley","click",function(a){STK.core.evt.preventDefault();N.beautify&&(N.beautify.style.display="none");var b=a.data.url,c=a.data.pid,d=a.data.value;V.loadPic({url:b,value:d,pid:c})});K.add("category","click",function(a){M.page=0;M.currentCategory=a.data.category;U.rend();setTimeout(function(){U.rendCategory(M);U.rendPage(M)},0)});K.add("prev","click",function(b){a.preventDefault(b.evt);var c=M.cPoniter;if(c<=0)return!1;M.cPoniter-=x;U.rendCategory(M)});K.add("next","click",function(b){a.preventDefault(b.evt);var c=M.cPoniter,d=M.categorys;if(c>=d.length-x)return!1;M.cPoniter+=x;U.rendCategory(M)});K.add("page","click",function(a){M.page=parseInt(a.data.num,10);U.rend();setTimeout(function(){U.rendPage(M)},0);return STK.preventDefault(a.evt)})},cartoonStart:function(){d.request("cartoon",{onSuccess:function(a,b){M.cache=a.data.more||{};M.categorys=[u];for(var c in M.cache)M.categorys.push(c);M.cache[u]=a.data.usual.norm;U.cartoonStart=function(){M.page=0;M.cPoniter=0;M.currentCategory=u;U.rend();U.rendCategory(M);U.rendPage(M)};U.cartoonStart()},onError:function(b){a.lib.dialog.ioError(b.code,b)}},{})},rend:function(b,c){var d=M.currentCategory,e=M.cache[d],f=M.page,g=M.itemNumber;e=e.slice(f*g,f*g+g);e=a.foreach(e,function(b,c){a.bLength(b.phrase)>8&&(b.phrase=[a.leftB(b.phrase,6),"..."].join(""));return a.templet(j(q),b)});N.loading.innerHTML="";N.list.innerHTML=e.join("")},rendCategory:function(b){var c=b.cPoniter,d=b.categorys,e=b.currentCategory,f=d.slice(c,c+x);f=a.foreach(f,function(b,c){return e===b?a.templet(j(p),{item:b}):a.templet(j(o),{item:b})});N.categorys.innerHTML=f.join(t);c+6>=d.length?N.next.className="next_d":N.next.className="next";c<=0?N.prev.className="pre_d":N.prev.className="pre"},rendPage:function(b){var c=b.page,d=b.cache[b.currentCategory],e=d.length/b.itemNumber,f=[];for(var g=0;g<e;g+=1)c==g?f.push(a.templet(j(s),{number:g,label:g+1})):f.push(a.templet(j(r),{number:g,label:g+1}));N.page.innerHTML=f.join("")},destroy:function(){}},V={trans:function(){E&&E.destroy();E=a.lib.kit.extra.upload({type:"common",form:N.form,imgName:J,file_source:1});a.custEvent.add(E,"uploadSucc",function(a,b){T.handleSucc(b)});a.custEvent.add(E,"uploadError",function(a,b){T.handleError(b)})},upload:function(){J=N.fileBtn.value;if(a.core.str.trim(J)!==""){T.rendLoad();V.trans()}},loadPic:function(b){N.picWrap.innerHTML="";var c=b.url,d=N.close,e=a.C("img");b.value&&(N.pName.innerHTML=b.value);G&&(e.onload=function(){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_image_cut","succeed_image_cut")});G=0;e.src=c;g.stopBoxClose();I=H?w:v;a.core.evt.custEvent.fire(L,"uploaded",{text:j(I),pid:b.pid});N.wrap.style.display="";N.wrap.className="layer_send_pic";N.wrap.style.width="240px";N.inner.style.display="none";N.uploaded.style.display="";d.style.display="none";N.picWrap.appendChild(e)}},W={};L={};L.getBub=function(){return g};if(!a.isNode(e))throw"common.bubble.image need el as first parameter!";O=window.location.href;N=a.lib.kit.dom.parseDOM(a.core.dom.builder(j(k)).list);z=N.outer;g=a.ui.bubble();T.initDom();if(f&&f.pid){var X=a.lib.kit.extra.imageURL(f.pid);V.loadPic({url:X,pid:f.pid})}S();g.setContent(z);f.fail=function(){g.setLayout(e,{offsetX:-24,offsetY:5})};g.setAlignPos(e,f.refer,f);L.bubble=g;g.show();c.push(function(){g&&g.hide()});return L}});
STK.register("lib.publisher.widget.image",function(a){return function(b){var c={},d,e,f,g,h=!1,i=function(a,c){var e=b.API.getImageLogType();b.API.addShortUrlLog(e);b.API.insertText(c.value);d.getBub().hide()},j=function(a,c){var d=b.API.getImageLogType();b.API.addShortUrlLog(d);h=!0;var e=b.API.getWords();e.length==0&&b.API.insertText(c.text);b.API.addExtraInfo(c.pid);f=!0},k=function(a,c){h=!1;b.API.delWords(c.text);b.API.addExtraInfo("");clearInterval(g);f=!1},l=function(e){if(!f){a.core.evt.preventDefault();var l,m=a.fixEvent(a.getEvent()).target;l=m;var n=b.nodeList.textEl;if(typeof e=="string"){d=a.lib.image.uploadBubble(l,{pid:e,refer:n});g=setInterval(function(){var a={fail:function(){d.bubble.setLayout(l,{offsetX:-29,offsetY:5})}};d.bubble.setAlignPos(l,n,a)},200)}else d=a.lib.image.uploadBubble(l,{refer:n});a.custEvent.add(d,"uploaded",j);a.custEvent.add(d,"insert",i);a.custEvent.add(d,"deletePIC",k);a.custEvent.add(b,"close",c.hide);a.custEvent.add(d,"hide",function(){a.custEvent.remove(d,"hide",arguments.callee);a.custEvent.remove(d,"uploaded",j);a.custEvent.remove(d,"insert",i);a.custEvent.remove(d,"deletePIC",k);a.custEvent.remove(d,"changeType");a.custEvent.remove(b,"close",c.hide);b.API.addExtraInfo("");h=!1;f=!1})}};c.init=function(c,d,f){b=c;e=d;a.addEvent(c.nodeList[e],"click",l);f&&f.pid&&l(f.pid)};c.show=l;c.hide=function(b,c){if(h&&d){var e=d.getBub();if(e){var f=a.builder(e.getBox()).list.close[0];a.isNode(f)&&a.setStyle(f,"display","")}}a.core.util.listener.fire("photo_merge_channel","closeEditor",[]);a.core.util.listener.fire("photo_editor_channel","closeEditor",[]);c&&c.type&&c.type=="publish"?d&&d.getBub().hide():h||d&&d.getBub().hide()};c.resetBubble=function(a){if(d){var c={fail:function(){d.bubble.setLayout(a,{offsetX:-29,offsetY:5})}};d.bubble.setAlignPos(a,b.nodeList.textEl,c)}};c.destroy=function(){b=null};return c}});
STK.register("lib.image.mUpload",function(a){var b="//js.t.sinajs.cn/t6/home/static/swf/",c=location.protocol+"//picupload.weibo.com/interface/pic_upload.php?app=miniblog&data=1",d,e,f="",g=a.lib.kit.extra.language;$CONFIG&&$CONFIG.uid&&(f=$CONFIG.uid||"");var h=window.FileReader&&!!a.C("canvas").getContext,i='<form node-type="form" action-type="form" id="pic_upload" name="pic_upload" target="upload_target" enctype="multipart/form-data" method="POST" style="overflow:hidden;opacity:0;filter:alpha(opacity=0);"><input type="file" accept="image/jpg,image/jpeg,image/png,image/gif" hidefoucs="true" node-type="fileBtn" name="pic1" style="cursor:pointer;width:1000px;height:1000px;position:absolute;bottom:0;right:0;font-size:200px;"/></form>';return function(j,k){function z(b){if(s){var c=l[b].base64,d=l[b].base64;u.uploading({fid:b,name:d});l[b]=a.lib.kit.extra.upload({type:"common",app:1001,type:"base64",imgName:d,base64Str:c});a.custEvent.add(l[b],"uploadSucc",function(a,c){u.uploaded({fid:b,pid:c.pid})});a.custEvent.add(l[b],"uploadError",function(a,d){l[b].base64=c;u.error({code:d.code,fid:b})})}else try{p&&p.reuploadById&&p.reuploadById(fid)}catch(e){}}function y(a){if(s)m=Math.max(0,Math.min(a,o.number));else try{p&&p.resetFileNum&&p.resetUploadedFileNum(a)}catch(b){}}function x(a){if(s){o.number=a;h&&o.number>1?q.setAttribute("multiple","multiple"):q.removeAttribute("multiple")}else try{p&&p.resetFileNum&&p.resetFileNum(a)}catch(b){}}var l={},m=0,n={},o={},p,q,r,s=a.lib.kit.extra.getFlashVersion()<10?!0:!1;window.location.protocol=="https:"&&(s=!0);a.core.util.browser.SAFARI&&STK.core.util.browser.OS==="macintosh"&&(s=!0);var t=function(){var c=a.core.dom.getSize(j);o=a.core.obj.parseParam({service:d,swf:b+"MultiFilesUpload.swf?version="+$CONFIG.version,exp_swf:b+"img/expressInstall.swf?version="+$CONFIG.version,h:c.height,w:c.width,version:"10.0.0",type:"*.png;*.jpg;*.gif;*.jpeg;",size:20971520,number:9,globalFun:"fcb_"+a.getUniqueKey(),callback:B,init:function(){},uploaded:function(){},uploading:function(){},error:function(){},extra:function(){}},k);o.id="swf_upbtn_"+a.getUniqueKey();o.channel=o.id+"_channel"},u={uploading:function(a){o.uploading({data:[{fid:a.fid,name:a.name}]})},uploaded:function(a){o.uploaded({data:{pid:a.pid},fid:a.fid})},error:function(a){var b="defaultErr",c="";if(a.code==9){b="singleError";c="A20001"}o.error({type:b,fid:a.fid,data:{sourceData:{code:c}}})}},v=function(){var b=!1;a.foreach(q.files,function(c){if(c&&c.size&&c.size>=o.size){!b&&a.ui.notice(g("#L{图片过大，请上传小于20M的图片}"),{icon:"rederrorB",hideDelay:2e3});b=!0}else{if(typeof c!="object"&&!c.type)return;if(m+1>o.number)return;m=m+1;if(c.type&&c.type.indexOf("image")>=0){var d=new FileReader,e=c.name,f=a.getUniqueKey();u.uploading({fid:f,name:e});d.onloadend=function(b){var c=b.target.result.split(",")[1];l[f]=a.lib.kit.extra.upload({type:"common",app:1001,type:"base64",imgName:e,base64Str:c,file_source:k.file_source||0});a.custEvent.add(l[f],"uploadSucc",function(a,b){u.uploaded({fid:f,pid:b.pid})});a.custEvent.add(l[f],"uploadError",function(a,b){l[f].base64=c;l[f].fileName=e;u.error({code:b.code,fid:f})})};d.readAsDataURL(c)}else a.ui.alert(g("#L{您上传的图片格式有误，请重新选择图片上传。}"),{icon:"warnB"})}});q.value=""},w=function(){if(h)v();else{if(m>=o.number)return;var b=a.getUniqueKey(),c=q.value;l[b]=a.lib.kit.extra.upload({type:"common",form:r,imgName:c,app:1001});m++;u.uploading({fid:b,name:c});q.value="";a.custEvent.add(l[b],"uploadSucc",function(a,c){var d=c.pid;u.uploaded({fid:b,pid:c.pid})});a.custEvent.add(l[b],"uploadError",function(a,c){u.error({code:c.code,fid:b})})}},A=function(){var b=a.E(o.id);if(!b){var c=a.C("div"),d=a.C("div");d.setAttribute("id",o.id);var e="position:absolute;left:0;top:0;display:block;overflow:hidden;background-color:#000;filter:alpha(opacity=0);-moz-opacity:0;opacity:0;";e+="width:"+o.w+"px;"+"height:"+o.h+"px;";c.style.cssText=e;j.appendChild(c);j.style.position="relative";var g={swfid:o.id,uploadAPIs:encodeURIComponent(o.service),maxFileSize:o.size,maxFileNum:o.number,jsHandler:o.globalFun,channel:o.channel,areaInfo:"0-0-"+o.w+"-"+o.h,fExt:o.type,fExtDec:"选择图片:*.jpg, *.jpeg, *.gif, *.png",uid:f},k={menu:"false",scale:"noScale",allowFullscreen:"false",allowScriptAccess:"always",bgcolor:"#FFFFFF",wmode:"opaque"};if(s){var l=a.builder(i).list;q=l.fileBtn[0];r=l.form[0];q.parentNode.style.height=o.h+"px";q.parentNode.style.width=o.w+"px";q.id=o.id;h&&o.number>1?q.setAttribute("multiple","multiple"):q.removeAttribute("multiple");c.appendChild(r)}else{c.appendChild(d);a.lib.kit.extra.swfobject.embedSWF(o.swf,o.id,o.w,o.h,o.version,o.exp_swf,g,k,o.id,C)}}},B=function(a,b,c){switch(c.type){case"flashInit":o.init(c);break;case"uploading":o.uploading(c);break;case"singleSuccess":o.uploaded(c);break;case"fileNumErr":return o.error(c);case"singleError":o.error(c);break;case"fileSizeErr":o.error(c);break;default:o.extra(c)}},C=function(a){p=a.ref},D=function(){s?a.core.evt.addEvent(q,"change",w):window[o.globalFun]=B},E=function(){a.lib.image.watermark(function(b){var f=b,g="weibo.com/",h=window.$CONFIG,i=f.nickname!="0"||f.logo!="0"||f.domain!="0",j={marks:i?1:0,file_source:k.file_source||0};e=a.lib.kit.extra.merge({url:f.domain=="1"?g+(h&&h.watermark||h.domain):0,markpos:f.position||"",logo:f.logo||"",nick:f.nickname=="1"?encodeURIComponent("@"+(h&&h.nick)):0},j);d=c;d+="&"+a.jsonToQuery(e);t();A();D()})};E();var F=function(){return o.id},G=function(b){var c;o.id&&(c=a.E(o.id));s?a.setStyle(c||q,"display",b?"none":"block"):a.setStyle(c||p,"width",b?"0px":"100%")},H=function(){return p},I=function(a){if(s){l[a]&&l[a].abort();delete l[a];q.value="";m=Math.max(0,Math.min(m-1,o.number))}else try{p&&p.removeFileById&&p.removeFileById(a)}catch(b){}},J=function(){delete window[o.globalFun];l={}};n.getId=F;n.disableInput=G;n.destroy=J;n.getswf=H;n.removeFile=I;n.resetUploadedFileNum=y;n.resetFileNum=x;n.reuploadById=z;return n}});
STK.register("lib.image.multiimage.index",function(a){var b='<div class="W_layer W_layer_pop"><div class="content"><div class="W_layer_title"><div class="W_layer_close"><a href="javascript:void(0);" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div></div><div class="layer_send_pic" node-type="inner"><div class="layer_send_btn clearfix"><ul class="clearfix"><li class="S_line2" suda-data="key=tblog_new_image_upload&value=fast_upload"><a href="javascript:void(0);" class="W_btn_l" node-type="mUpload"><span class="btn_45px"><em class="W_ficon ficon_add_pic S_ficon">È</em>#L{单图/多图}</span></a></li><li class="S_line2"><a href="javascript:void(0);" class="W_btn_l '+(location.protocol=="https:"?"W_btn_l_dis":"")+'" node-type="inputCover" '+(location.protocol=="https:"?"":'action-type="more"')+' suda-data="key=tblog_new_image_upload&value=pin_upload"><span class="btn_45px"><em class="W_ficon ficon_puzzle S_ficon">Æ</em>#L{拼图}</span></a></li>'+'<li class="S_line2"><a href="javascript:void(0);" class="W_btn_l" action-type="capture" suda-data="key=tblog_new_image_upload&value=screenshot_upload"><span class="btn_45px"><em class="W_ficon ficon_screenshot S_ficon">Ô</em>#L{截屏}</span></a></li>'+'<li class="S_line2"><a href="javascript:void(0);" class="W_btn_l" action-type="uploadAblum" suda-data="key=tblog_new_image_upload&value=upload_albums"><span class="btn_45px"><em class="W_ficon ficon_upload_album S_ficon">Ë</em>#L{传至相册}</span></a></li>'+"</ul>"+"</div>"+"</div>"+'<div class="W_layer_arrow"><span class="W_arrow_bor" node-type="arrow"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div>'+"</div>"+"",c,d,e;return function(f,g){var h={},i,j="weibo.com/",k=$CONFIG||{},l=a.lib.browser.plugin.screenCapture,m,n,o=f&&f.getAttribute("isReEdit"),p=a.lib.kit.extra.language,q=function(b){if(a.lib.kit.extra.getFlashVersion()<10)a.lib.kit.extra.installFlash({onHide:function(){c.startBoxClose()}});else{var d=function(d){var e=d.nickname!="0"||d.logo!="0"||d.domain!="0",f=$CONFIG&&$CONFIG.nick||"",g=location.protocol+"//picupload.weibo.com/interface/pic_upload.php?app=miniblog"+"&marks="+(e?"1":"0")+(d.logo=="1"?"&logo=1":"")+(d.nickname=="1"?"&nick="+(f?encodeURIComponent("@"+f):""):"")+(d.domain=="1"?"&url="+j+(k&&k.watermark||k.domain):"")+(d.position?"&markpos="+d.position:"")+"&s=xml&cb=//weibo.com/upimgback.html&rq=http%3A%2F%2Fphoto.i.weibo.com%2Fpic%2Fadd.php%3Fapp%3D1",h={id:b.id,pos:c.getPosition(),service:g,sucess:b.sucess,h:b.height,w:b.width,swf:b.swf,baseDir:b.baseDir||""};n=a.lib.image.imgUpload(h,{init:function(a,b){a.setPars()},close:function(a,b){setTimeout(function(){c.startBoxClose()},100)}});n.show()};a.lib.image.watermark(function(a){d(a)})}},r=function(b){c.startBoxClose();var b=b.pid||b,d=a.getUniqueKey();e.uploading({data:[{fid:d}]});e.uploaded({data:{pid:b},fid:d})},s={hideCapture:function(){m&&m.hide()},handleError:function(b){c.stopBoxClose();a.ui.alert(p(b.msg),{OK:function(){b.code==1&&window.location.reload();setTimeout(function(){c.startBoxClose()},0)}})},captureWindow:function(){a.preventDefault();if(!m){var b=function(){c.stopBoxClose()},d=function(){c.startBoxClose()};m=l.screenCapture({captureType:"pid",beforeUpload:s.beforeCaptureUpload,captureSuccess:r,captureError:s.handleError,beforeSupportTip:b,supportTipOk:d,beforeIeInstallTip:b,ieInstallTipOk:d,beforeInstallTip:b,installTipOk:d})}m.doit()},beforeCaptureUpload:function(){c.stopBoxClose()},captureSuccess:function(a){imgName=a.imgName;captureFlag=1;s.handleSucc(a)}},t={splice:function(){q({id:"photo_merge",swf:"SinaCollage.swf",width:528,height:470,sucess:function(a){r(a)}});c.hide()},face_sticker:function(){q({id:"photo_facesticker",swf:"FacePhoto.swf",width:568,height:478,baseDir:"facesticker",sucess:function(){}});c.hide()},uploadAblum:function(){window.open("http://photo.weibo.com/upload/weibo","","width=650, height=470, top=300, left=400")}},u=function(){function h(){c.stopBoxClose();c.getBox().style.marginLeft="-2000px"}c&&c.destroy();c=a.ui.bubble({template:p(b),clickBlankToHide:!0,showWithAni:"fadeInDown:fast",hideWithAni:"fadeOutUp:fast",showWithSetWidth:!1});c.show().setArrow("top").setAlignPos(f,g.refer,g);var i=a.sizzle('a[node-type="mUpload"]',c.getBox());e=g.editor.getPreview();a.lib.image.mUpload(i[0],{w:194,h:45,uploading:e.uploading,uploaded:e.uploaded,error:e.error,extra:e.extra,file_source:1,pri:0});a.custEvent.add(e,"loading",function(){h();a.custEvent.fire(g.editor,"disableVideo");g.editor.nodeList.textEl.setAttribute("data-multiimage-status","editing")});a.custEvent.add(e,"hide",function(){h();a.custEvent.fire(g.editor,"enableVideo");g.editor.nodeList.textEl.removeAttribute("data-multiimage-status")});d=a.delegatedEvent(c.getBox());d.add("more","click",t.splice);d.add("capture","click",s.captureWindow);d.add("uploadAblum","click",t.uploadAblum)},v=function(){u()};v();h.getPreview=function(){return e};h.hide=function(){c.hide()};h.getBub=function(){return c};h.destroy=function(){c.destroy();d.destroy();c=null};return h}});
STK.register("lib.publisher.widget.multiimage",function(a){var b=$CONFIG.isVmember;return function(b,c){var d={},e,f,g,h,i=!1,j,k={restore:function(){var a=STK.core.util.storage.get("editor_multiimage"+$CONFIG.uid);return a!="null"&&a!=null&&a.length!=0&&!b.nodeList.textEl.getAttribute("tid")?a:!1},store:function(a){STK.core.util.storage.set("editor_multiimage"+$CONFIG.uid,a)},delWord:function(){STK.core.util.storage.del("editor_multiimage"+$CONFIG.uid)}},l=function(c,f){var h=f||k.restore();c&&c.data&&(h=c.data.isReEdit?c.data.pic_id&&c.data.pic_id.split("|").join(" "):f||k.restore());h&&a.core.evt.preventDefault();if(!g){var l,m=a.fixEvent(a.getEvent()).target;a.contains(b.nodeList.widget,m)?l=m:l=b.nodeList.more;c&&c.data&&c.data.isReEdit==1&&l.setAttribute("isReEdit",1);var n=b.nodeList.textEl;e=a.lib.image.multiimage.index(l,{refer:n,editor:b});j=b.getPreview();if(c&&c.data&&c.data.isReEdit){var o=j.getDomList("title_addTag"),p=j.getDomList("box");o.style.display="none";p.setAttribute("isReEdit",1)}a.custEvent.add(j,"loading",function(){i=!0;g=!0});a.custEvent.add(b,"close",d.hide);a.custEvent.add(j,"hide",function(){i=!1;a.custEvent.remove(j,"hide",arguments.callee);a.custEvent.remove(j,"changeType");a.custEvent.remove(b,"close",d.hide);g=!1});if(!j.getNumInfo()&&h&&h!=""){g=!0;var f=h.split(" "),q=[];for(var r=0;f[r];r++){var s=f[r].split("|");q.push({fid:a.getUniqueKey(),pid:s[0],media_id:s[1]||"",object_id:s[2]||"",filetype:s.length==3?"gif":""})}if(!q[0])return;j.uploading({data:q});for(var r=0;q[r];r++)j.uploaded({fid:q[r].fid,data:q[r]})}}};d.init=function(c,d,e){b=c;f=d;a.addEvent(c.nodeList[f],"click",l);e&&e.pid&&l(null,e.pid)};d.show=l;d.hide=function(b,c){j&&j.hide();a.core.util.listener.fire("photo_merge_channel","closeEditor",[]);a.core.util.listener.fire("photo_editor_channel","closeEditor",[]);if(c&&c.type&&c.type=="publish"){e&&e.getBub().hide();g=!1}else e&&e.getBub().hide()};d.destroy=function(){e.destroy();b=null};return d}});
STK.register("lib.kit.extra.scrollMethod",function(a){var b={},c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){a()},d={debounce:function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null;c||a.apply(e,f)},h=c&&!d;clearTimeout(d);d=setTimeout(g,b);h&&a.apply(e,f)}},throttle:function(a,b,c){var d,e=new Date;return function(){var f=this,g=arguments,h=new Date;clearTimeout(d);if(h-e>=c){a.apply(f,g);e=h}else d=setTimeout(a,b)}},rAF:function(a){return function(){var b=!1;if(!b){c(a);b=!0}}}};b.debounce=d.debounce;b.throttle=d.throttle;b.rAF=d.rAF;return b});
STK.register("lib.kit.extra.sparkMD5",function(a){return function(a){"use strict";var b=function(a,b){return a+b&4294967295},c=function(a,c,d,e,f,g){c=b(b(c,a),b(e,g));return b(c<<f|c>>>32-f,d)},d=function(a,b,d,e,f,g,h){return c(b&d|~b&e,a,b,f,g,h)},e=function(a,b,d,e,f,g,h){return c(b&e|d&~e,a,b,f,g,h)},f=function(a,b,d,e,f,g,h){return c(b^d^e,a,b,f,g,h)},g=function(a,b,d,e,f,g,h){return c(d^(b|~e),a,b,f,g,h)},h=function(a,c){var h=a[0],i=a[1],j=a[2],k=a[3];h=d(h,i,j,k,c[0],7,-680876936);k=d(k,h,i,j,c[1],12,-389564586);j=d(j,k,h,i,c[2],17,606105819);i=d(i,j,k,h,c[3],22,-1044525330);h=d(h,i,j,k,c[4],7,-176418897);k=d(k,h,i,j,c[5],12,1200080426);j=d(j,k,h,i,c[6],17,-1473231341);i=d(i,j,k,h,c[7],22,-45705983);h=d(h,i,j,k,c[8],7,1770035416);k=d(k,h,i,j,c[9],12,-1958414417);j=d(j,k,h,i,c[10],17,-42063);i=d(i,j,k,h,c[11],22,-1990404162);h=d(h,i,j,k,c[12],7,1804603682);k=d(k,h,i,j,c[13],12,-40341101);j=d(j,k,h,i,c[14],17,-1502002290);i=d(i,j,k,h,c[15],22,1236535329);h=e(h,i,j,k,c[1],5,-165796510);k=e(k,h,i,j,c[6],9,-1069501632);j=e(j,k,h,i,c[11],14,643717713);i=e(i,j,k,h,c[0],20,-373897302);h=e(h,i,j,k,c[5],5,-701558691);k=e(k,h,i,j,c[10],9,38016083);j=e(j,k,h,i,c[15],14,-660478335);i=e(i,j,k,h,c[4],20,-405537848);h=e(h,i,j,k,c[9],5,568446438);k=e(k,h,i,j,c[14],9,-1019803690);j=e(j,k,h,i,c[3],14,-187363961);i=e(i,j,k,h,c[8],20,1163531501);h=e(h,i,j,k,c[13],5,-1444681467);k=e(k,h,i,j,c[2],9,-51403784);j=e(j,k,h,i,c[7],14,1735328473);i=e(i,j,k,h,c[12],20,-1926607734);h=f(h,i,j,k,c[5],4,-378558);k=f(k,h,i,j,c[8],11,-2022574463);j=f(j,k,h,i,c[11],16,1839030562);i=f(i,j,k,h,c[14],23,-35309556);h=f(h,i,j,k,c[1],4,-1530992060);k=f(k,h,i,j,c[4],11,1272893353);j=f(j,k,h,i,c[7],16,-155497632);i=f(i,j,k,h,c[10],23,-1094730640);h=f(h,i,j,k,c[13],4,681279174);k=f(k,h,i,j,c[0],11,-358537222);j=f(j,k,h,i,c[3],16,-722521979);i=f(i,j,k,h,c[6],23,76029189);h=f(h,i,j,k,c[9],4,-640364487);k=f(k,h,i,j,c[12],11,-421815835);j=f(j,k,h,i,c[15],16,530742520);i=f(i,j,k,h,c[2],23,-995338651);h=g(h,i,j,k,c[0],6,-198630844);k=g(k,h,i,j,c[7],10,1126891415);j=g(j,k,h,i,c[14],15,-1416354905);i=g(i,j,k,h,c[5],21,-57434055);h=g(h,i,j,k,c[12],6,1700485571);k=g(k,h,i,j,c[3],10,-1894986606);j=g(j,k,h,i,c[10],15,-1051523);i=g(i,j,k,h,c[1],21,-2054922799);h=g(h,i,j,k,c[8],6,1873313359);k=g(k,h,i,j,c[15],10,-30611744);j=g(j,k,h,i,c[6],15,-1560198380);i=g(i,j,k,h,c[13],21,1309151649);h=g(h,i,j,k,c[4],6,-145523070);k=g(k,h,i,j,c[11],10,-1120210379);j=g(j,k,h,i,c[2],15,718787259);i=g(i,j,k,h,c[9],21,-343485551);a[0]=b(h,a[0]);a[1]=b(i,a[1]);a[2]=b(j,a[2]);a[3]=b(k,a[3])},i=function(a){var b=[],c;for(c=0;c<64;c+=4)b[c>>2]=a.charCodeAt(c)+(a.charCodeAt(c+1)<<8)+(a.charCodeAt(c+2)<<16)+(a.charCodeAt(c+3)<<24);return b},j=function(a){var b=[],c;for(c=0;c<64;c+=4)b[c>>2]=a[c]+(a[c+1]<<8)+(a[c+2]<<16)+(a[c+3]<<24);return b},k=function(a){var b=a.length,c=[1732584193,-271733879,-1732584194,271733878],d,e,f,g,j,k;for(d=64;d<=b;d+=64)h(c,i(a.substring(d-64,d)));a=a.substring(d-64);e=a.length;f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<e;d+=1)f[d>>2]|=a.charCodeAt(d)<<(d%4<<3);f[d>>2]|=128<<(d%4<<3);if(d>55){h(c,f);for(d=0;d<16;d+=1)f[d]=0}g=b*8;g=g.toString(16).match(/(.*?)(.{0,8})$/);j=parseInt(g[2],16);k=parseInt(g[1],16)||0;f[14]=j;f[15]=k;h(c,f);return c},l=function(a){var b=a.length,c=[1732584193,-271733879,-1732584194,271733878],d,e,f,g,i,k;for(d=64;d<=b;d+=64)h(c,j(a.subarray(d-64,d)));a=d-64<b?a.subarray(d-64):new Uint8Array(0);e=a.length;f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(d=0;d<e;d+=1)f[d>>2]|=a[d]<<(d%4<<3);f[d>>2]|=128<<(d%4<<3);if(d>55){h(c,f);for(d=0;d<16;d+=1)f[d]=0}g=b*8;g=g.toString(16).match(/(.*?)(.{0,8})$/);i=parseInt(g[2],16);k=parseInt(g[1],16)||0;f[14]=i;f[15]=k;h(c,f);return c},m=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],n=function(a){var b="",c;for(c=0;c<4;c+=1)b+=m[a>>c*8+4&15]+m[a>>c*8&15];return b},o=function(a){var b;for(b=0;b<a.length;b+=1)a[b]=n(a[b]);return a.join("")},p=function(a){return o(k(a))},q=function(){this.reset()};p("hello")!=="5d41402abc4b2a76b9719d911017c592"&&(b=function(a,b){var c=(a&65535)+(b&65535),d=(a>>16)+(b>>16)+(c>>16);return d<<16|c&65535});q.prototype.append=function(a){/[\u0080-\uFFFF]/.test(a)&&(a=unescape(encodeURIComponent(a)));this.appendBinary(a);return this};q.prototype.appendBinary=function(a){this._buff+=a;this._length+=a.length;var b=this._buff.length,c;for(c=64;c<=b;c+=64)h(this._state,i(this._buff.substring(c-64,c)));this._buff=this._buff.substr(c-64);return this};q.prototype.end=function(a){var b=this._buff,c=b.length,d,e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],f;for(d=0;d<c;d+=1)e[d>>2]|=b.charCodeAt(d)<<(d%4<<3);this._finish(e,c);f=!a?o(this._state):this._state;this.reset();return f};q.prototype._finish=function(a,b){var c=b,d,e,f;a[c>>2]|=128<<(c%4<<3);if(c>55){h(this._state,a);for(c=0;c<16;c+=1)a[c]=0}d=this._length*8;d=d.toString(16).match(/(.*?)(.{0,8})$/);e=parseInt(d[2],16);f=parseInt(d[1],16)||0;a[14]=e;a[15]=f;h(this._state,a)};q.prototype.reset=function(){this._buff="";this._length=0;this._state=[1732584193,-271733879,-1732584194,271733878];return this};q.prototype.destroy=function(){delete this._state;delete this._buff;delete this._length};q.hash=function(a,b){/[\u0080-\uFFFF]/.test(a)&&(a=unescape(encodeURIComponent(a)));var c=k(a);return!b?o(c):c};q.hashBinary=function(a,b){var c=k(a);return!b?o(c):c};q.ArrayBuffer=function(){this.reset()};q.ArrayBuffer.prototype.append=function(a){var b=this._concatArrayBuffer(this._buff,a),c=b.length,d;this._length+=a.byteLength;for(d=64;d<=c;d+=64)h(this._state,j(b.subarray(d-64,d)));this._buff=d-64<c?b.subarray(d-64):new Uint8Array(0);return this};q.ArrayBuffer.prototype.end=function(a){var b=this._buff,c=b.length,d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e,f;for(e=0;e<c;e+=1)d[e>>2]|=b[e]<<(e%4<<3);this._finish(d,c);f=!a?o(this._state):this._state;this.reset();return f};q.ArrayBuffer.prototype._finish=q.prototype._finish;q.ArrayBuffer.prototype.reset=function(){this._buff=new Uint8Array(0);this._length=0;this._state=[1732584193,-271733879,-1732584194,271733878];return this};q.ArrayBuffer.prototype.destroy=q.prototype.destroy;q.ArrayBuffer.prototype._concatArrayBuffer=function(a,b){var c=a.length,d=new Uint8Array(c+b.byteLength);d.set(a);d.set(new Uint8Array(b),c);return d};q.ArrayBuffer.hash=function(a,b){var c=l(new Uint8Array(a));return!b?o(c):c};return q}()});
STK.register("lib.video.commTool",function(b){return function(){var b={};b.clear=function(){};b.show=function(){};b.destory=function(){};getNonEnglishLength=function(a){var b=escape(a);for(var c=0,d=0;c<b.length;c++)if(b.charAt(c)=="%"){if(b.charAt(++c)=="u"){c+=3;d++}c++}return d};getEnglishLength=function(a,b){var c=Math.ceil((a.length-b)/2);return c};b.getWordLengh=function(a){var b=getNonEnglishLength(a),c=getEnglishLength(a,b);return c+b};b.strCut=function(b,c){var d=0,e=0;str_cut=new String;e=b.length;for(var f=0;f<e;f++){a=b.charAt(f);d++;escape(a).length>4&&d++;str_cut=str_cut.concat(a);if(d>=c)return str_cut}if(d<c)return b};b.reverseCut=function(b,c){var d=0,e=0;str_cut=new String;e=b.length;for(var f=0;f<e;f++){a=b.charAt(e-f);d++;escape(a).length>4&&d++;str_cut=a+str_cut;if(d>c)return str_cut}if(d<c)return b};return b}()});
STK.register("lib.video.upload",function(a){var b=a.lib.kit.extra.sparkMD5,c=a.lib.kit.extra.language,d={upload:{url:{init:"//fileplatform.api.weibo.com/2/multimedia/init.json",upload:"//fileplatform.api.weibo.com/2/multimedia/upload.json",check:"//fileplatform.api.weibo.com/2/multimedia/check.json"},video_size_limit:1073741824,video_size_MB:1048576,video_size_KB:1024,init_time_limit:3,text:{init:"上传准备中，可能持续数分钟，请稍候...",fail:"上传失败！",reupload:"重新上传中，请稍候...",success:"视频上传成功",uploading:"已上传："}}};return function(e,f,g,h,i,j,k){var l,m,n,o=0,p={md5:{},discovery:{},init:{},upload:{},check:{}},q={},r=function(a){var b=p.init.start.getTime().toString(16),c=(+(new Date)).toString(16);o==0&&(o=b.slice(b.length-10,b.length-2)+n.fileCheck.slice(n.fileCheck.length-8));var d=c.slice(c.length-8)+n.fileCheck.slice(n.fileCheck.length-8);a.setRequestHeader("Trace-Id",o);a.setRequestHeader("Span-Id",d);a.setRequestHeader("Parent-Span-Id",o);a.setRequestHeader("Sampled",1)},s=function(a){var b=p.init.start.getTime().toString(16),c=(+(new Date)).toString(16);o==0&&(o=b.slice(b.length-10,b.length-2)+n.fileCheck.slice(n.fileCheck.length-8));var d=c.slice(c.length-8)+n.fileCheck.slice(n.fileCheck.length-8);a.wb_tid=o;a.wb_sid=d;a.wb_pid=o},t=function(){l=!1;w.setUploadStatus("init");a.addEvent(e.reupload,"click",v.startReupload);a.addEvent(e.cancelUpload,"click",v.cancelUpload);var b=f.id.split("_")[0];if(b=="publisher"){k.initUploadDOM("change");if(h){var c=f.id.replace(f.id.split("_")[0],"fcb");window[c].flashUtils=a.lib.kit.extra.merge(window[c].flashUtils,x)}}else w.resetData();w.formatName(i);if(!h){n={file:f.files[0],fileCheck:"",shardCount:0,shardSize:0,stage:"upload_init",initFailedTimes:0,failedTimes:0,serverFaultTimes:0,timeoutTimes:0,initTimes:1,isFromCheck:!1,chunkSize:2097152,fileToken:"",urlTag:"",usid:"",objectId:"",finished:0,loadedSize:0,currentSize:0};w.getFileMD5(n.file,function(a){n.fileCheck=a;k.updateLog({file_length:n.file.size,upload_id:a});l||u.discovery()})}},u={discovery:function(){p.discovery.start=new Date;k.updateLog({start_date:p.discovery.start.getTime(),process_status:"discovery"});var b=new XMLHttpRequest,c="//fileplatform.api.weibo.com/2/multimedia/discovery.json",e={source:j=="krcom"?"1908180863":"2637646381",type:"video",size:n.file.size,version:"",status:""};b.open("POST",c+"?"+a.jsonToQuery(e),!0);b.onload=function(){p.discovery.end=new Date;if(b.status==200){var c=JSON.parse(b.response),e=a.parseURL(c.init_url).scheme+":",f=a.parseURL(c.upload_url).scheme+":",g=a.parseURL(c.check_url).scheme+":";d.upload.url={init:c.init_url.replace(e,""),upload:c.upload_url.replace(f,""),check:c.check_url.replace(g,"")}}u.init()};b.onerror=function(){u.init()};b.ontimeout=function(){u.init()};b.withCredentials=!0;b.timeout=1e4;b.send()},init:function(){k.updateLog({discovery_time:(p.discovery.end-p.discovery.start)/1e3,process_status:"init"});p.init.start=new Date;var b=new XMLHttpRequest,c={screenshot:g?0:1,video_type:j||"normal"},e={length:n.file.size,check:n.fileCheck,type:"video",source:j=="krcom"?"1908180863":"2637646381",name:encodeURIComponent(n.file.name),client:"web",mediaprops:encodeURIComponent(a.jsonToStr(c)),status:"wired",ua:navigator.userAgent,count:n.initTimes};s(e);b.open("POST",d.upload.url.init+(/\?/.test(d.upload.url.init)?"&":"?")+a.jsonToQuery(e),!0);b.onload=function(){p.init.end=new Date;if(b.status==200){var a=JSON.parse(b.response);v.initCompleted(a,e)}else v.initFailed(e,"server fault: "+b.status)};b.onerror=function(){v.initFailed(e,"network failure")};b.ontimeout=function(){v.initFailed(e,"timeout")};b.withCredentials=!0;b.timeout=1e4;b.send()},upload:function(c){if(c==undefined){n.stage="upload_peices";c=0}var e=c*n.shardSize,f=Math.min(n.file.size,e+n.shardSize),g=w.sliceFile(n.file,e,f),h=new FileReader,i=h.readAsArrayBuffer(g);h.onload=function(e){var f=b.ArrayBuffer.hash(e.target.result);p.upload.curStart=new Date;var h=new XMLHttpRequest,i={source:j=="krcom"?"1908180863":"2637646381",filetoken:n.fileToken,sectioncheck:f,startloc:c*n.shardSize,client:"web",status:"wired",ua:navigator.userAgent,v:a.getUniqueKey()};s(i);h.open("POST",d.upload.url.upload+(/\?/.test(d.upload.url.upload)?"&":"?")+a.jsonToQuery(i),!0);h.onload=function(){p.upload.curEnd=new Date;if(h.status==200){var a=JSON.parse(h.response);v.uploadCompleted(c,a,i)}else v.uploadFailed(c,i,"server fault: "+h.status)};h.onerror=function(){v.uploadFailed(c,i,"network failure")};h.ontimeout=function(){v.uploadFailed(c,i,"timeout")};h.withCredentials=!0;h.timeout=3e4;h.setRequestHeader("Content-Type","multipart/form-data");h.send(g)}},check:function(){p.check.start=new Date;k.updateLog({start_date:p.check.start.getTime(),process_status:"check"});var b=new XMLHttpRequest,c={source:j=="krcom"?"1908180863":"2637646381",filetoken:n.fileToken,name:encodeURIComponent(n.file.name),length:n.file.size,type:"video",check:n.fileCheck,client:"web",mediaprops:"",status:"wired",ua:navigator.userAgent};b.open("POST",d.upload.url.check+(/\?/.test(d.upload.url.check)?"&":"?")+a.jsonToQuery(c),!0);b.onload=function(){p.check.end=new Date;if(b.status==200){var a=JSON.parse(b.response);v.checkCompleted(a,c)}else v.checkFailed(c,"server fault: "+b.status)};b.onerror=function(){v.checkFailed(c,"network failure")};b.ontimeout=function(){v.checkFailed(c,"timeout")};b.withCredentials=!0;b.timeout=1e4;b.send()}},v={initCompleted:function(a,b){if(a.error)v.initFailed(b,a.error,a);else{if(!a.fileToken){v.initFailed(b,"empty filetoken",a);return}n.shardSize=a.length*d.upload.video_size_KB;n.shardCount=Math.ceil(n.file.size/n.shardSize);n.urlTag=a.urlTag;n.fileToken=a.fileToken;n.isFromCheck=!1;k.updateLog({init_time:(p.init.end-p.init.start)/1e3,chunk_size:n.shardSize,seg_num:n.shardCount,file_token:a.fileToken});if(l)return;w.setProgressSt(0,n.shardSize,n.shardCount);p.upload.start=new Date;p.upload.rtt=0;k.updateLog({process_status:"upload"});u.upload()}},initFailed:function(b,c,e){if(n.initFailedTimes<2&&n.initTimes<d.upload.init_time_limit){if(l)return;n.initFailedTimes++;u.init()}else{k.updateLog({request_type:"init",request_url:d.upload.url.init,parameters:b,responseString:e?a.jsonToStr(e):"",error_code:e?e.error_code:"",error_msg:c,start_date:p.init.start.getTime()},"details");if(l)return;w.setUploadStatus("fail")}},uploadCompleted:function(a,b,c){var d,e,f,g;if(b.error)v.uploadFailed(a,c,b.error,b);else{if(a==n.shardCount-1&&!b.fid){v.uploadFailed(a,c,"merge error",b);return}p.upload.curEnd=new Date;g=p.upload.curEnd-p.upload.curStart;p.upload.rtt+=g/1e3;if(l)return;w.resetFailTimes();n.finished++;a++;e=a<n.shardCount?a*n.shardSize:n.file.size;n.currentSize=f=e-n.loadedSize;d=p.upload.curEnd&&p.discovery.start?(p.upload.curEnd-p.discovery.start)/1e3:0;k.updateLog({dataupload_time:p.upload.rtt,upload_time:d,upload_length:e,upload_speed:Math.ceil(d&&f/1e3/d)||0,current_upload_length:f,dataupload_speed:Math.ceil(n.shardSize/g)||0});w.setProgressSt(a,n.shardSize,n.shardCount);a<n.shardCount&&u.upload(a);if(a==n.shardCount&&b.fid){p.upload.end=new Date;v.uploadSuccess(b.fid)}}},uploadFailed:function(b,c,e,f){if(n.failedTimes<2&&n.serverFaultTimes<3&&n.timeoutTimes<3){if(l)return;if(e.indexOf("server fault: ")==0)n.serverFaultTimes++;else if(e.indexOf("timeout")==0){if(b==0&&n.timeoutTimes==1&&!n.isFromCheck){w.resetFailTimes();n.initTimes++;n.initFailedTimes=0;u.init();return}n.timeoutTimes++}else n.failedTimes++;u.upload(b)}else{k.updateLog({request_type:"upload",request_url:d.upload.url.upload,parameters:c,responseString:f?a.jsonToStr(f):"",error_code:f?f.error_code:"",error_msg:e,start_date:p.upload.curStart.getTime()},"details");if(l)return;w.setUploadStatus("fail")}},uploadSuccess:function(a){w.setUploadStatus("success");n.objectId=a;g||k.success(a);w.setData(a)},startReupload:function(){k.ajaxLog("reupload");k.updateLog({upload_uuid:$CONFIG.uid+"."+a.getUniqueKey()},"reupload");w.setUploadStatus("reupload");if(h)f.startReupload();else{w.resetFailTimes();if(n.fileToken)u.check();else{n.initFailedTimes=0;n.initTimes=1;u.init()}}},checkCompleted:function(a,b){if(a.error)v.checkFailed(b,a.error,a);else{if(!a.fileToken){v.checkFailed(b,"empty filetoken",a);return}k.updateLog({check_time:(p.check.end-p.check.start)/1e3});if(l)return;p.upload.start=new Date;p.upload.rtt=0;n.isFromCheck=!0;k.updateLog({process_status:"upload"});if(a.fileToken!=n.fileToken){n.fileToken=a.fileToken;n.urlTag=a.urlTag;n.shardSize=a.length*d.upload.video_size_KB;n.shardCount=Math.ceil(n.file.size/n.shardSize);n.finished=0;n.loadedSize=0;w.setProgressSt(0,n.shardSize,n.shardCount);k.updateLog({chunk_size:n.shardSize,seg_num:n.shardCount,file_token:a.fileToken});u.upload()}else{n.loadedSize=n.finished*n.shardSize;w.setProgressSt(n.finished,n.shardSize,n.shardCount);u.upload(n.finished)}}},checkFailed:function(b,c,e){k.updateLog({request_type:"check",request_url:d.upload.url.check,parameters:b,responseString:e?a.jsonToStr(e):"",error_code:e?e.error_code:"",error_msg:c,start_date:p.check.start.getTime()},"details");l||w.setUploadStatus("fail")},cancelUpload:function(b){var d="确定放弃上传视频吗？";m=a.ui.tipConfirm(c("#L{"+d+"}")).ok(v.confirmCancel).beside(b.target||b.srcElement,{pos:"bottom-left"})},confirmCancel:function(){if(!(a.core.dom.getSize(e.uploaded).height>0)){w.setCancelFlag(!0);a.setStyle(e.uploading,"display","none");a.setStyle(e.uploadVideo,"height","auto");k.initUploadDOM("afterCancel");k.resetProgram(!1);k.resetAlbum()}}},w={formatName:function(b){var c=i;c=c.split(".");var d=c[c.length-1];c.pop();c=c.join(".");var f=a.lib.video.commTool.getWordLengh(c);if(f>10){var g=a.lib.video.commTool.strCut(c,12)+"...",h=a.lib.video.commTool.reverseCut(c,6);c=g+h}e.fileName.innerText=c+"."+d},sliceFile:function(a,b,c){var d=File.prototype.slice||File.prototype.webkitSlice||File.prototype.mozSlice;return d.call(a,b,c)},getFileMD5:function(a,c){k.updateLog({process_status:"md5"});if(!!a){var d=this,e=new FileReader,f=0;n.shardCount=Math.ceil(a.size/n.chunkSize);var g=function(){var b=f*n.chunkSize,c=Math.min(b+n.chunkSize,a.size);e.readAsArrayBuffer(d.sliceFile(a,b,c))},h,i=new b.ArrayBuffer;e.onload=function(a){if(!l){i.append(a.target.result);f++;if(f<n.shardCount)g();else{p.md5.end=new Date;k.updateLog({md5_time:(p.md5.end-p.md5.start)/1e3});c(i.end())}}};p.md5.start=new Date;g()}},setUploadStatus:function(b,f){var g=e.status;g.innerHTML=c("#L{"+d.upload.text[b]+"}");if(b=="fail"){a.setStyle(e.reupload,"display","inline");a.setStyle(e.uploadDetail,"display","none");a.addClassName(e.loadingBar,"fail");e.uploadDetail.innerHTML=""}else if(b=="reupload")a.setStyle(e.reupload,"display","none");else if(b=="uploading"){a.removeClassName(e.loadingBar,"fail");g.innerHTML+=f;a.setStyle(e.uploadDetail,"display","inline")}else if(b=="success"){m&&m.getState()&&m.hide();e.uploadDetail.innerHTML="";a.setStyle(e.uploading,"display","none");a.setStyle(e.uploaded,"height","auto");k.initUploadDOM("change")}else if(b=="init"){e.uploadDetail.innerHTML="";a.setStyle(e.reupload,"display","none");a.setStyles(a.sizzle("em",e.loadingBar)[0],"width","0");a.setStyles([e.uploaded,e.uploadVideo],"height","0px");a.setStyle(e.uploading,"display","block")}},setProgressSt:function(b,c,f,g){var h=Math.floor(b/f*100)+"%",i=a.sizzle("em",e.loadingBar)[0],j=e.uploadDetail;a.setStyles(i,"width",h);k.updateLog({process_value:Math.floor(b/f*100)});w.setUploadStatus("uploading",h);var l=b*c,m;g=g||n.file.size;l=Math.min(l,g);g>=d.upload.video_size_MB?m=w.formatSize(l/d.upload.video_size_MB)+"MB / "+w.formatSize(g/d.upload.video_size_MB)+"MB":m=w.formatSize(l/d.upload.video_size_KB)+"KB / "+w.formatSize(g/d.upload.video_size_KB)+"KB";j.innerHTML=m},formatSize:function(a){var b=Math.round(a*10)%10;return Math.floor(a)+b/10},resetFailTimes:function(){n.failedTimes=0;n.serverFaultTimes=0;n.timeoutTimes=0},setCancelFlag:function(a){l=a;h&&f.cancelUpload()},setData:function(a){var b;e.upload.setAttribute("action-data","video_fid="+a);k.canPublish();b=p.upload.end&&p.discovery.start?(p.upload.end-p.discovery.start)/1e3:0;k.updateLog({is_success:!0,process_status:"edit",file_id:a,end_date:p.upload.end?p.upload.end.getTime():0,upload_time:b,upload_speed:Math.ceil(b&&n.currentSize/1e3/b)||0})},resetData:function(){e.upload.removeAttribute("action-data");k.canPublish()}},x={setUploadStatus:w.setUploadStatus,setProgressSt:w.setProgressSt,uploadSuccess:function(a){w.setUploadStatus("success");w.setData(a)}};t();q.init=t;q.setCancelFlag=w.setCancelFlag;q.setUploadStatus=w.setUploadStatus;q.destroy=function(){a.removeEvent(e.reupload,"click",v.startReupload);a.removeEvent(e.cancelUpload,"click",v.cancelUpload)};return q}});
STK.register("lib.video.tags",function(a){return function(b){var c='<span class="W_btn_b W_btn_tag" node-type="tagNode" action-type=""><span class="W_arrow_bor W_arrow_bor_l"><i class="S_line3"></i><em class="S_bg2_br"></em></span><input class="tag_txt W_autocut S_txt1" type="text" value="" action-type="inputTag" node-type="inputNode" size="2"><a href="javascript:void(0);" class="tag_txt W_autocut S_txt1" style="display:none;" action-type="editTag"></a></span>',d='<span class="W_btn_b W_btn_tag" node-type="localTagNode"><span class="W_arrow_bor W_arrow_bor_l"><i class="S_line3"></i><em class="S_bg2_br"></em></span><a href="javascript:void(0);" class="tag_txt W_autocut S_txt1" action-type="localTagClick"></a>',e=10,f=a.lib.kit.extra.language,g=a.builder(f(c)).list.tagNode[0],h=a.builder(f(d)).list.localTagNode[0],i=a.delegatedEvent(b),j=[],k=[],l,m,n={},o={restore:function(a){var b=STK.core.util.storage.get(a);return b!="null"&&b!=null&&b.length!=0?b:!1},store:function(a,b){STK.core.util.storage.set(a,b)},delWord:function(a){STK.core.util.storage.del(a)}},p={hasEditNode:function(){var c=a.sizzle('[node-type="inputNode"]',b);for(var d=0;d<c.length;d++)if(c[d].style.display=="")return!0},changeNode:function(c){if(c.value===""){a.removeNode(c.parentNode);a.sizzle('[node-type="tagNode"]',b).length===0&&a.setStyle(a.sizzle('[node-type="inputDesc"]',b)[0],"display","")}else{var d=c.value,e=a.core.arr.indexOf(d,j);if(e!==-1)a.ui.tipAlert(f("#L{重复标签}"),{icon:"rederrorS",autoHide:!0}).beside(c.parentNode,{pos:"top-left"});else{a.setStyle(c,"display","none");var g=a.sizzle("a",c.parentNode)[0],h=a.sizzle("a",c.parentNode)[1];g&&a.setStyle(g,"display","");g&&(g.innerHTML=c.value);h&&a.setStyle(h,"display","");j.push(c.value);p.setData()}}},getLocalTags:function(){var c=o.restore("editor_videotags"+$CONFIG.uid),d=a.strToJson(c),e=a.sizzle("div.tag",b)[0];if(c===!1||d.length==0)e.innerHTML=f("#L{历史标签：无}");else{k=d;for(var g=0;g<d.length;g++){var i=h.cloneNode(!0),j=a.sizzle("a",i)[0];j.innerHTML=d[g];var l=a.core.dom.lastChild(e);l===undefined?e.appendChild(i):a.insertAfter(i,l)}}},recoverLocalTag:function(c){aNodes=a.sizzle("a",a.sizzle("div.tag",b)[0]);for(var d=0;d<aNodes.length;d++)if(c==aNodes[d].innerHTML){a.setStyle(aNodes[d].parentNode,"display","");break}},isLocalTagRepeat:function(b){var c=a.core.arr.indexOf(b,j);return c===-1?!1:!0},setData:function(){var a="";if(j.length!==0){a=j.join("|");b.setAttribute("action-data","video_tags="+encodeURIComponent(a))}else b.setAttribute("action-data","")}},q={inputOut:function(a){var b=a.target||a.srcElement;b.style.display!=="none"&&p.changeNode(b)},inputKeyDown:function(b){var c=b.el,d=b.evt.keyCode||b.evt.which;if(d===32||d===13){p.changeNode(c);c.blur();a.core.evt.stopEvent()}},tagInput:function(b){var c=b.el,d=a.lib.video.commTool.getWordLengh(c.value);d>10&&(c.value=a.lib.video.commTool.strCut(c.value,20));d=a.lib.video.commTool.getWordLengh(c.value);c.size=d*2>2?d*2+1:4},inputDescClick:function(c){var d=c.target||c.srcElement;a.setStyle(d,"display","none");var e=g.cloneNode(!0);a.insertAfter(e,a.sizzle('[node-type="inputDesc"]',b)[0]);a.addEvent(a.sizzle("input",e)[0],"blur",q.inputOut);a.sizzle("input",e)[0].focus()},divClick:function(c){if(c.srcElement)var d=c.srcElement,h=d.tagName;else var d=c.target,h=d.tagName;h=h.toLocaleLowerCase();if(h=="div"){a.setStyle(a.sizzle('[node-type="inputDesc"]',b)[0],"display","none");var i=a.sizzle('[node-type="tagNode"]',d),j=g.cloneNode(!0);a.addEvent(a.sizzle("input",j)[0],"blur",q.inputOut);if(!p.hasEditNode())if(i.length===0){a.insertAfter(j,d.firstChild);a.sizzle("input",j)[0].focus()}else if(i.length>0&&i.length<e){a.insertAfter(j,i[i.length-1]);a.sizzle("input",j)[0].focus()}else i.length>=e&&a.ui.tipAlert(f("#L{最多可以添加十个标签}"),{icon:"rederrorS",autoHide:!0}).beside(d,{pos:"top-left"})}},delTag:function(c){var d=c.el,e=a.sizzle("[node-type=tagNode]",b);e.length===1&&a.setStyle(a.sizzle("[node-type=inputDesc]",b)[0],"display","");a.removeNode(d.parentNode);var f=a.sizzle("a",d.parentNode)[0].innerText;p.recoverLocalTag(f);var g=a.core.arr.indexOf(f,j);if(g!==-1){j.splice(g,1);p.setData()}},editTag:function(b){var c=b.el,d=a.sizzle('[node-type="inputNode"]',c.parentNode)[0],e=a.sizzle("a",c.parentNode);d&&a.setStyle(d,"display","");e[0]&&a.setStyle(e[0],"display","none");e[1]&&a.setStyle(e[1],"display","none");e[0]&&(d.value=e[0].innerText);d.focus();var f=a.sizzle("a",c.parentNode)[0].innerText,g=a.core.arr.indexOf(f,j);if(g!==-1){j.splice(g,1);p.setData()}},noticeOk:function(){o.store("editor_vTag_notice_"+$CONFIG.uid,1);l&&a.removeEvent(l.getDomList(!0).noticeOk,"click",q.noticeOk);l&&l.hide()},descClick:function(b){m=o.restore("editor_vTag_notice_"+$CONFIG.uid);var c='<div class="W_layer W_layer_pop"><div class="content layer_mini_opt"><p class="main_txt W_tc W_fb W_f14 S_txt1">视频标签说明</p><p class="sub_txt S_txt2"><span class="W_fb S_txt1">一、为什么打标签</span><br>带标签的视频将被推荐给更多观众，极大提升视频播放量。</p><p class="sub_txt S_txt2"><span class="W_fb S_txt1">二、打多少标签合适</span><br>通常在3个以上，优秀的标签在5～10个。</p><p class="sub_txt S_txt2"><span class="W_fb S_txt1">三、如何打标签</span><br>用简短通俗的词语去描述视频，可以参考以下几个维度去打标<br>签：<br>1、视频主题<br>如：手机测评、美食教程、电影预告、游戏解说<br>2、视频内容取材<br>如：影视剧名称、游戏名称、歌曲名称<br>3、视频中的关键人物或物品<br>如：明星姓名、名人、具体品牌<br>4、视频亮点或氛围<br>如：神转折、搞笑、惊恐、励志</p><p class="sub_txt S_txt2"><span class="W_fb S_txt1">四、标签与视频不相关会有什么问题</span><br>标签与视频不相关将不会被推荐，多次打不相关标签会被系统<br>惩罚。</p>'+(m?"":'<p class="btn" node-type="noticeOk"><a href="#" class="W_btn_a">知道了</a></p>')+'<div class="W_layer_arrow"><span class="W_arrow_bor W_arrow_bor_b" node-type="arrow"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div>'+"</div> "+"</div>",d=b.target||b.srcElement,e=m?"":'<p class="btn" node-type="noticeOk"><a href="javascript:void(0);" class="W_btn_a">知道了</a></p>';l=a.ui.mlayer(c,{clickBlankToHide:m,stopClickPropagation:!0,autoRelease:!1,showWithAni:"fadeInUp:fast",hideWithAni:"fadeOutDown:fast"}).show().beside(d,{pos:"top-left",offsetX:-20,offsetY:-10,appendTo:document.body});m||a.addEvent(l.getDomList(!0).noticeOk,"click",q.noticeOk)},locaTagClick:function(c){var d=c.el,h=d.innerText,i=g.cloneNode(!0),k=a.sizzle('[node-type="inputDesc"]',b)[0],l=a.sizzle("a",i),m=a.sizzle("input",i)[0];l[0]&&a.setStyle(l[0],"display","");l[1]&&a.setStyle(l[1],"display","");m&&a.setStyle(m,"display","none");l[0]&&(l[0].innerText=h);k&&a.setStyle(k,"display","none");var n=a.sizzle('[node-type="tagNode"]',b);if(!p.isLocalTagRepeat(h))if(n.length===0){a.addEvent(a.sizzle("input",i)[0],"blur",q.inputOut);a.insertAfter(i,k);a.setStyle(d.parentNode,"display","none");j.push(h);p.setData()}else if(n.length>0&&n.length<e){a.addEvent(a.sizzle("input",i)[0],"blur",q.inputOut);a.insertAfter(i,n[n.length-1]);a.setStyle(d.parentNode,"display","none");j.push(h);p.setData()}else n.length>=e&&a.ui.tipAlert(f("#L{最多可以添加十个标签}"),{icon:"rederrorS",autoHide:!0}).beside(a.sizzle("div",b)[0],{pos:"top-left"});else a.ui.tipAlert(f("#L{重复标签}"),{icon:"rederrorS",autoHide:!0}).beside(d,{pos:"top-left"})}},r=function(){p.getLocalTags();a.setStyle(a.sizzle("div",b)[0],"overflow","visible");a.addEvent(a.sizzle('[node-type="tagDesc"]',b)[0],"click",q.descClick);a.addEvent(a.sizzle('[node-type="inputDesc"]',b)[0],"click",q.inputDescClick);a.addEvent(a.sizzle(".input_outer3",b)[0],"click",q.divClick);i.add("inputTag","keydown",q.inputKeyDown);i.add("inputTag","keyup",q.tagInput);i.add("delTag","click",q.delTag);i.add("editTag","click",q.editTag);i.add("localTagClick","click",q.locaTagClick);m=o.restore("editor_vTag_notice_"+$CONFIG.uid);m||setTimeout(function(){a.fireEvent(a.sizzle('[node-type="tagDesc"]',b)[0],"click")},300)};r();n.setLocalTags=function(){var b=j;for(var c=0;c<k.length;c++){if(b.length>=10)break;a.core.arr.inArray(k[c],b)||b.push(k[c])}var d=a.jsonToStr(b);o.store("editor_videotags"+$CONFIG.uid,d)};n.destroy=function(){a.removeEvent(a.sizzle('[node-type="tagDesc"]',b)[0],"click",q.descClick);a.removeEvent(a.sizzle('[node-type="inputDesc"]',b)[0],"click",q.inputDescClick);a.removeEvent(a.sizzle(".input_outer3",b)[0],"click",q.divClick);i.destroy()};return n}});
STK.register("lib.video.screenshot",function(a){return function(b,c,d){var e,f,g,h,i,j,k,l=0,m=[],n={},o={},p=function(){c.updateLog({process_status:"frontshot"});if(!a.core.util.browser.CHROME)c.error();else try{e=window.URL.createObjectURL(b);f=a.C("video");g=a.C("canvas");a.setStyle(f,"visibility","hidden");(d||document.body).appendChild(f);f.src=e;f.muted=!0;a.addEvent(f,"seeked",q.videoSeeked);g.ctxInput=g.getContext("2d");var k=20;j=new Date;f.i=setInterval(function(){if(!k||f.error){clearInterval(f.i);c.error()}else{if(f.readyState>1){clearInterval(f.i);if(f.videoWidth==0||f.videoHeight==0||f.duration==0){c.error();return}var a=Math.max(1e3/f.videoWidth,564/f.videoHeight);a>1&&(a=1);f.width=g.width=n.width=Math.floor(f.videoWidth*a);f.height=g.height=n.height=Math.floor(f.videoHeight*a);h=f.duration;i=h/10;f.currentTime=l}k--}},100)}catch(m){c.error()}},q={videoSeeked:function(){try{g.ctxInput.drawImage(f,0,0,g.width,g.height);m.push(g.toDataURL("image/jpeg"));if(m.length==1&&r()){c.error();return}if(m.length==10){m.splice(0,1);s();return}g.ctxInput.clearRect(0,0,g.width,g.height);l+=i;f.currentTime=l}catch(a){c.error()}},videoPlaying:function(){setTimeout(function(){f.pause();a.removeEvent(f,"playing",q.videoPlaying);if(f.currentTime<f.duration){n.imgs=m;c.success(n);k=new Date;c.updateLog({cover_type:"front",screenshot_type:"front",is_screenshot_success:!0,screenshot_time:(k-j)/1e3})}else c.error()},50)}},r=function(){var a=g.ctxInput.getImageData(0,0,g.width,g.height);return a.data[a.data.length-1]==0?!0:!1},s=function(){var b=h-.5;a.removeEvent(f,"seeked",q.videoSeeked);a.addEvent(f,"playing",q.videoPlaying);f.currentTime=b;a.addEvent(f,"seeked",function(){f.play()})};p();o.destroy=function(){try{a.removeNode(f);window.URL.revokeObjectURL(e)}catch(b){}};return o}});
STK.register("lib.video.dragImg",function(a){return function(b,c){var d={},e={start:{},end:{},delta:{}},f={maxW:356,maxH:198},g={},h=function(){a.addEvent(c,"mousedown",l);a.addEvent(c,"mouseout",k);i()},i=function(){d.realW=b.width;d.realH=b.height;d.x=0;d.y=0;if(f.maxW/d.realW*d.realH>f.maxH){d.per=f.maxW/d.realW;d.w=f.maxW;d.h=d.per*d.realH;b.width=d.w;b.height=d.h;d.y=Math.floor((d.h-f.maxH)/2)*-1}else{d.per=f.maxH/d.realH;d.h=f.maxH;d.w=d.per*d.realW;b.width=d.w;b.height=d.h;d.x=Math.floor((d.w-f.maxW)/2)*-1}b.style.left=d.x+"px";b.style.top=d.y+"px"},j=function(c){c=a.fixEvent(c);var g,h;e.delta.x=c.pageX-e.end.x;e.delta.y=c.pageY-e.end.y;e.end.x=c.pageX;e.end.y=c.pageY;g=d.x+e.delta.x;h=d.y+e.delta.y;if(g+d.w>=f.maxW&&g<=0){d.x=g;b.style.left=d.x+"px"}if(h+d.h>=f.maxH&&h<=0){d.y=h;b.style.top=d.y+"px"}},k=function(b){a.removeEvent(c,"mousemove",j);a.removeEvent(c,"mouseup",k)},l=function(b){e.start.x=e.end.x=b.pageX;e.start.y=e.end.y=b.pageY;a.addEvent(c,"mousemove",j);a.addEvent(c,"mouseup",k)},m=function(){var a={x:-Math.floor(d.x/d.per),y:-Math.floor(d.y/d.per),w:Math.floor(f.maxW/d.per),h:Math.floor(f.maxH/d.per)};return{url:b.src.replace("large",["crop",a.x,a.y,a.w,a.h].join(".")),width:a.w*2,height:a.h*2}};h();g.getCrop=m;g.destroy=function(){a.removeEvent(c,"mousedown",l);a.removeEvent(c,"mouseout",k)};return g}});
STK.register("lib.video.cover",function(a){return function(b,c,d,e,f){f.ismcn=f.isPGC=!0;var g=f.isPGC||f.ismcn?'<ul class="minitb_ul S_line1 S_bg1 clearfix tab3up"><li class="minitb_item current S_line1"><a href="javascript:void(0);" class="minitb_lk S_txt1 S_bg2" action-type="showUpload">#L{上传封面}</a><span class="cur_block"></span></li><li class="minitb_item S_line1"><a href="javascript:void(0);" class="minitb_lk S_txt1" action-type="showScreenshot">#L{系统封面}</a><span class="cur_block"></span></li></ul>':'<h1 class="W_f14 W_fb" style="line-height:30px;">#L{系统封面}</h1>',h=f.isPGC||f.ismcn?'<div class="video_upbox" node-type="upload" style="display:none;"><div class="vd_input S_bg1"><a href="javascript:void(0);" class="upbtn" node-type="imgUpload" style="position:relative;">+</a></div><div class="W_tc S_txt2">#L{支持5MB以内的png/gif/jpg图片，图片比例建议16：9}</div></div><div class="video_upbox" node-type="uploading" style="display:none;"><div class="vd_input S_bg1"><span class="upinfo" node-type="uploadingDesc">#L{正在上传封面}...</span></div><div class="W_tc S_txt2">#L{支持5MB以内的png/gif/jpg图片，图片比例建议16：9}</div></div><div class="video_upbox" node-type="uploaded" style="display:none;"><div class="vd_input S_bg1"><span class="pic"><img alt="" node-type="uploadImg"></span><span class="bg" node-type="imgWrapper"></span></div><div class="W_tc S_txt2">#L{支持5MB以内的png/gif/jpg图片，图片比例建议16：9}</div></div>':"",i='<div class="W_layer_btn" node-type="button" style="display:none;"><a href="javascript:void(0);" class="W_btn_b" node-type="changeCover" style="position:relative;">#L{更换封面}</a><a href="javascript:void(0);" class="W_btn_a" node-type="setUploadCover" action-type="setUploadCover" style="display:none;">#L{确定}</a><a href="javascript:void(0);" class="W_btn_a W_btn_a_disable" node-type="setScreenshotCover" action-type="setScreenshotCover" style="display:none;">#L{确定}</a></div>',j='<div class="W_layer W_layer_pop" node-type="outer" style="display:none;"><div class="content"><div class="W_layer_close"><a href="javascript:void(0);" class="W_ficon ficon_close S_ficon" action-type="hide">X</a></div><div class="layer_send_video_v3 clearfix"><div class="WB_minitab">'+g+"</div>"+h+'<div class="video_upbox" node-type="processing" style="display:none;">'+'<div class="vd_pics_info"><span class="upinfo">#L{处理中，请稍候}</span></div>'+"</div>"+'<div class="video_upbox" node-type="screenshot" style="display:none;">'+'<ul class="vd_pics_v3 clearfix">'+'<li action-type="selectScreenshot"><a href="javascript:void(0);"><img alt=""></a></li>'+'<li action-type="selectScreenshot"><a href="javascript:void(0);"><img alt=""></a></li>'+'<li action-type="selectScreenshot"><a href="javascript:void(0);"><img alt=""></a></li>'+'<li action-type="selectScreenshot"><a href="javascript:void(0);"><img alt=""></a></li>'+'<li action-type="selectScreenshot"><a href="javascript:void(0);"><img alt=""></a></li>'+'<li action-type="selectScreenshot"><a href="javascript:void(0);"><img alt=""></a></li>'+'<li action-type="selectScreenshot"><a href="javascript:void(0);"><img alt=""></a></li>'+'<li action-type="selectScreenshot"><a href="javascript:void(0);"><img alt=""></a></li>'+'<li action-type="selectScreenshot"><a href="javascript:void(0);"><img alt=""></a></li>'+"</ul>"+'<div class="W_tc S_txt2">#L{请选取任意一张作为封面图}</div>'+"</div>"+"</div>"+i+'<div class="W_layer_arrow"><span class="W_arrow_bor W_arrow_bor_t" node-type="arrow"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div>'+"</div>"+"</div>",k='<form node-type="form" action-type="form" id="pic_upload" name="pic_upload" target="upload_target" enctype="multipart/form-data" method="POST"><input type="file" hidefoucs="true" node-type="fileBtn" name="pic1" accept=".png,.jpg,.gif,.jpeg"/></form>',l="//multimedia.api.weibo.com/2/multimedia/get_screenshot.json",m=5242880,n=a.lib.kit.extra.language,o,p,q,r,s,t,u,v="upload",w="processing",x,y=!1,z={},A=function(){a.addEvent(c,"click",F.showCover);B();C()},B=function(){o=a.ui.bubble({template:n(j),clickBlankToHide:!1,showWithAni:null,hideWithAni:null,showWithSetWidth:!1});p=o.getDomList(!0);var c=b.nodeList.textEl;o.setArrow("top").setAlignPos(d,c,{refer:c,editor:b});o.on("hide",F.hideCover)},C=function(){(f.isPGC||f.ismcn)&&D();q=a.delegatedEvent(o.getBox());q.add("hide","click",I.hideBub);q.add("selectScreenshot","click",F.clickScreenshot);q.add("setScreenshotCover","click",F.setScreenshotCover);if(f.isPGC||f.ismcn){q.add("showUpload","click",F.showUpload);q.add("showScreenshot","click",F.showScreenshot);q.add("setUploadCover","click",F.setUploadCover)}},D=function(){var b=p.imgUpload,c=a.builder(k).list;s=c.form[0];t=c.fileBtn[0];b.appendChild(s);a.addEvent(t,"change",F.uploadInputChange)},E={byH5:function(b,d){u&&u.destroy();u=a.lib.video.screenshot(b,{success:function(a){d(!0);F.setScreenshot(a)},error:function(){d(!1)},updateLog:e.updateLog},c)},byXHR:function(b){var c=0,d=new Date,f;e.updateLog({process_status:"endshot"});var g=setInterval(function(){if(y)clearInterval(g);else{if(c==30){clearInterval(g);F.setScreenshot({pids:[]});return}c++;var h=new XMLHttpRequest,i={fid:b,source:"2637646381",count:c};h.open("GET",l+"?"+a.jsonToQuery(i),!0);h.onload=function(){if(h.status==200){var a=JSON.parse(h.response);if(a.status=="done"){clearInterval(g);F.setScreenshot({pids:a.result.pids,width:a.result.width,height:a.result.height});f=new Date;e.updateLog({cover_type:"end",screenshot_type:"end",process_status:"edit",is_screenshot_success:!0,screenshot_time:(f-d)/1e3})}}};h.onerror=function(){};h.ontimeout=function(){};h.withCredentials=!0;h.timeout=1e4;h.send()}},1e3)}},F={uploadInputChange:function(b){var c=b.target||b.srcElement;if(!!c.value){G.uploading(s);if(t.files&&t.files[0].size&&t.files[0].size>m)p.uploadingDesc.innerText=n("#L{图片大小超限，请重新上传}");else{p.uploadingDesc.innerText=n("#L{正在上传封面}...");a.addClassName(p.changeCover,"W_btn_b_disable");a.setStyle(t,"display","none");H({type:"common",form:s,success:G.uploaded,error:G.error})}}},showCover:function(){if(!o.getState()||a.getStyle(p.outer,"display")!="block"){if(!o.getState()){o.show();var c=b.nodeList.textEl;o.setAlignPos(d,c,{refer:c,editor:b})}a.getStyle(p.outer,"display")=="none"&&a.setStyle(p.outer,"display","block");f.isPGC||f.ismcn?I.showBox(a.sizzle(".minitb_item.current [action-type=showScreenshot]",p.outer).length?w:v):I.showBox(w);e.disableCompleteBtn(!0)}},hideCover:function(){e.canPublish()=="uploading"?e.disableCompleteBtn(!0):e.disableCompleteBtn(!1)},showUpload:function(b){var c=a.sizzle(".minitb_item.current",p.outer)[0];if(c!=b.el){a.removeClassName(c,"current");a.addClassName(b.el.parentNode,"current");I.showBox(v)}},showScreenshot:function(b){var c=a.sizzle(".minitb_item.current",p.outer)[0];if(c!=b.el){a.removeClassName(c,"current");a.addClassName(b.el.parentNode,"current");I.showBox(w)}},setScreenshot:function(b){b.pids&&(b.imgs=a.foreach(b.pids,function(b,c){return a.lib.kit.extra.imageURL(b,{size:"orignal"})}));var d=b.height>0&&b.width*9>=b.height*16?"W_piccut_h":"W_piccut_v",e=a.sizzle("img",p.screenshot);a.foreach(e,function(c,e){var f=c.parentNode.parentNode,g=c.parentNode;a.removeClassName(g,"W_piccut_h");a.removeClassName(g,"W_piccut_v");if(b.imgs[e]){c.src=b.imgs[e];a.removeClassName(f,"default");a.removeClassName(f,"dis");a.addClassName(g,d)}else if(e==0){a.addClassName(f,"default");a.setStyle(a.sizzle(".S_txt2",p.screenshot)[0],"display","none")}else a.addClassName(f,"dis")});w="screenshot";b.width&&b.height&&p.screenshot.setAttribute("action-data","width="+b.width+"&height="+b.height);(!f.isPGC&&!f.ismcn||a.sizzle(".minitb_item.current [action-type=showScreenshot]",p.outer).length)&&I.showBox(w);if(!f.isPGC&&!f.ismcn||!p.uploadImg.getAttribute("src")){var g=a.sizzle("li",p.screenshot)[0];a.addClassName(g,"curr");a.removeClassName(p.setScreenshotCover,"W_btn_a_disable");if(a.hasClassName(g,"default")){a.addClassName(c,"upbtn_v3_d");a.setStyle(a.sizzle("span",c)[0],"visibility","hidden");a.addClassName(a.sizzle("em",c)[0],"em2")}else F.selectScreenshot(g)}},setUploadCover:function(){var b=r.getCrop();I.setData(b);var c=a.sizzle(".curr",p.screenshot)[0];c&&a.removeClassName(c,"curr");a.addClassName(p.setScreenshotCover,"W_btn_a_disable");o.hide()},clickScreenshot:function(b){if(!a.hasClassName(b.el,"dis")){var c=a.sizzle(".curr",p.screenshot)[0];if(c==b.el)return;c&&a.removeClassName(c,"curr");a.addClassName(b.el,"curr");a.removeClassName(p.setScreenshotCover,"W_btn_a_disable")}},setScreenshotCover:function(){if(!a.hasClassName("W_btn_a_disable",p.setScreenshotCover)){var b=a.sizzle(".curr",p.screenshot)[0];if(!b)return;if((f.isPGC||f.ismcn)&&p.uploadImg.getAttribute("src")){var c=a.sizzle("[action-type=showUpload]",p.outer)[0];a.ui.tipConfirm(n("#L{确定放弃已上传的封面吗？}")).ok(function(){F.selectScreenshot(b);o.hide()}).beside(c,{pos:"bottom-middle"})}else{F.selectScreenshot(b);o.hide()}}},selectScreenshot:function(b){var d=a.sizzle("img",b)[0],e=d.getAttribute("src")||"",g=e.indexOf("http")==0||e.indexOf("https")==0||e.indexOf("//")==0;if(a.hasClassName(b,"default")){if((f.isPGC||f.ismcn)&&p.uploadImg){I.clearUploadTab();I.resetData();a.addClassName(c,"upbtn_v3_d");a.setStyle(a.sizzle("span",c)[0],"visibility","hidden");a.addClassName(a.sizzle("em",c)[0],"em2")}}else if(g){var h=a.queryToJson(p.screenshot.getAttribute("action-data"));I.setData({url:e,width:h.width,height:h.height});I.clearUploadTab()}else H({type:"base64",base64Str:e.split(",")[1],success:function(b){var c=a.lib.kit.extra.imageURL(b,{size:"orignal"}),e=a.queryToJson(p.screenshot.getAttribute("action-data"));I.setData({url:c,width:e.width,height:e.height});d.src=c;I.clearUploadTab()}})}},G={uploading:function(a){v="uploading";p.changeCover.appendChild(a);r&&r.destroy();p.uploadImg.removeAttribute("width");p.uploadImg.removeAttribute("height");I.showBox(v)},uploaded:function(b){v="uploaded";var c=a.lib.kit.extra.imageURL(b,{size:"orignal"}),d=p.uploadImg;d.onload=function(){r=a.lib.video.dragImg(p.uploadImg,p.imgWrapper)};d.src=c;I.showBox(v);a.removeClassName(p.changeCover,"W_btn_b_disable");a.setStyle(t,"display","block")},error:function(){a.removeClassName(p.changeCover,"W_btn_b_disable");a.setStyle(t,"display","block");p.uploadingDesc.innerText=n("#L{封面上传失败}")}},H=function(b){var c,d={url:0,markpos:1,logo:"",nick:0,marks:1,app:"miniblog",s:"rdxt",file_source:10};if(b.type==="common")c=b.form;else if(b.type==="base64"){c=a.C("form");c.method="POST";var e=a.C("input");e.name="b64_data";e.type="hidden";e.value=b.base64Str;c.appendChild(e);document.body.appendChild(c);d=a.lib.kit.extra.merge({mime:"image/jpeg",data:"base64"},d)}a.core.io.ijax({url:location.protocol+"//picupload.weibo.com/interface/pic_upload.php",form:c,abaurl:location.protocol+"//"+document.domain+"/aj/static/upimgback.html?_wv=5",abakey:"cb",args:d,timeout:12e4,onComplete:function(d){b.type==="base64"&&a.removeNode(c);if(!d||d.ret<0)switch(Math.abs(d.ret)){case 1:d.message="#L{没有登录}";break;case 4:case 9:d.message="#L{请上传5M以内的JPG、GIF、PNG图片。}";break;default:d.message="#L{上传图片超时}"}else b.success(d.pid)},onTimeout:function(){b.type==="base64"&&a.removeNode(c);b.error()}})},I={showBox:function(b){if(x!=b){if(b!="screenshot"&&b!="processing"&&a.sizzle(".minitb_item.current [action-type=showScreenshot]",p.outer).length>0)return;if((b=="screenshot"||b=="processing")&&a.sizzle(".minitb_item.current [action-type=showUpload]",p.outer).length>0)return;a.setStyle(p[b],"display","block");x&&a.setStyle(p[x],"display","none");if(b=="uploading"||b=="uploaded"||b=="screenshot"){a.setStyle(p.button,"display","block");a.setStyle(p.changeCover,"display",b=="screenshot"?"none":"inline-block");a.setStyle(p.setUploadCover,"display",b=="uploaded"?"inline-block":"none");a.setStyle(p.setScreenshotCover,"display",b=="screenshot"?"inline-block":"none")}else p.button&&a.setStyle(p.button,"display","none");x=b}},hideBub:function(){o.hide()},clearUploadTab:function(){if(t&&p.uploadImg.getAttribute("src")){p.uploadImg.removeAttribute("src");t.value=null;v="upload";p.imgUpload.appendChild(s)}},setCancelFlag:function(a){y=a},setData:function(b){var d=a.sizzle("img",c)[0];d.src=b.url;a.addClassName(a.sizzle("em",c)[0],"em2");a.setStyle(d,"display","block");c.setAttribute("action-data","video_covers="+b.url+"|"+b.width+"|"+b.height);a.removeClassName(c,"W_piccut_h");a.removeClassName(c,"W_piccut_v");var e=b.height>0&&b.width*9>=b.height*16?"W_piccut_h":"W_piccut_v";a.addClassName(c,e);a.addClassName(c,"upbtn_v3_img")},resetData:function(){var b=a.sizzle("img",c)[0];a.setStyle(b,"display","none");b.removeAttribute("src");a.removeClassName(a.sizzle("em",c)[0],"em2");c.removeAttribute("action-data");a.removeClassName(c,"upbtn_v3_img")},resetScreenshot:function(){w="processing";(!f.isPGC&&!f.ismcn||a.sizzle(".minitb_item.current [action-type=showScreenshot]",p.outer).length)&&I.showBox(w);var b=a.sizzle("img",p.screenshot);a.foreach(b,function(b,c){b.removeAttribute("src");a.removeClassName(b.parentNode.parentNode,"default");a.removeClassName(b.parentNode.parentNode,"dis");a.removeClassName(b.parentNode.parentNode,"curr");a.setStyle(a.sizzle(".S_txt2",p.screenshot)[0],"display","block")});var d=a.sizzle("img",c)[0].getAttribute("src"),e="";p.uploadImg&&(e=p.uploadImg.getAttribute("src")||"");d&&(!f.isPGC&&!f.ismcn||d.replace(/crop.[^\/]*\//,"")!=e.replace("large/",""))&&I.resetData();if(a.hasClassName(c,"upbtn_v3_d")){a.removeClassName(c,"upbtn_v3_d");a.removeClassName(a.sizzle("em",c)[0],"em2");a.setStyle(a.sizzle("span",c)[0],"visibility","visible")}}};A();z.getScreenshot=E;z.setScreenshot=F.setScreenshot;z.setCancelFlag=I.setCancelFlag;z.resetScreenshot=I.resetScreenshot;z.destroy=function(){u&&u.destroy();r&&r.destroy();a.removeEvent(c,"click",F.showCover);(f.isPGC||f.ismcn)&&a.removeEvent(t,"change",F.uploadInputChange);q&&q.destroy();o&&o.destroy();o&&o.off("hide",F.hideCover);o=null;u=null;r=null};return z}});
STK.register("lib.video.title",function(a){return function(b,c,d){var e=a.lib.kit.extra.language,f=a.delegatedEvent(b),g="",h={},i={changeTitleCount:function(){var c=a.sizzle("div.input_outer",b),d=3-c.length,f=a.sizzle("em",a.sizzle("div.tips.clearfix",b)[0]),g=f[1];g.innerHTML=e("#L{(还可以添加"+d+"个)}");if(d===0){a.setStyle(a.sizzle('[action-type="addTitle"]')[0],"display","none");a.setStyle(g,"display","none")}else{a.setStyle(a.sizzle('[action-type="addTitle"]')[0],"display","");a.setStyle(g,"display","")}if(c.length==1){a.setStyle(a.sizzle("span.sp2",c[0])[0],"display","none");a.addClassName(a.sizzle("div",b)[0],"input_outer_only")}else a.setStyle(a.sizzle("span.sp2",c[0])[0],"display","")},setData:function(){if(g!==""&&g!==null&&g!==undefined){var c=[],d=a.sizzle("input",b);c.push(g);for(var e=0;e<d.length;e++)d[e].value!==g&&d[e].value!==""&&c.push(d[e].value);var f=c.join("|");b.setAttribute("action-data","video_titles="+encodeURIComponent(f))}else b.setAttribute("action-data","")},isDefaultNode:function(b){var c=a.sizzle('[node-type="defaultTitle"]',b)[0];return c.innerText==e("#L{默认标题}")?!0:!1}},j={addTitle:function(b){var c=b.box,d=a.sizzle("div.input_outer",c),f=d[d.length-1];if(d.length<3){var g=d[0].cloneNode(!0);a.removeClassName(g,"input_outer_default");a.removeClassName(g,"input_outer_only");a.sizzle("a",a.sizzle(".sp1",g)[0])[0].innerHTML=e("#L{设为默认标题}");a.setStyle(a.sizzle("span.sp2",g)[0],"display","");var h=a.sizzle("input",g)[0];h.placeholder=e("#L{请输入视频标题}");h.value="";a.insertAfter(g,f);a.removeClassName(d[0],"input_outer_only");i.changeTitleCount()}i.setData()},delTitle:function(c){var d=c.el,f=a.sizzle("div.input_outer",b),h=!1;if(f.length>1){a.sizzle('[node-type="defaultTitle"]',d.parentNode.parentNode)[0].innerText==e("#L{默认标题}")&&(h=!0);a.removeNode(d.parentNode.parentNode);i.changeTitleCount()}if(h){f=a.sizzle("div.input_outer",b);a.sizzle('[node-type="defaultTitle"]',f[0])[0].innerText=e("#L{默认标题}");a.addClassName(f[0],"input_outer_default");g=a.sizzle("input",f[0])[0].value}i.setData()},setDefault:function(c){var d=c.el,f=a.sizzle("input",d.parentNode.parentNode)[0];if(f.value!==""){var h=a.sizzle('[node-type="defaultTitle"]',b);for(var j=0;j<h.length;j++){h[j].innerHTML=e("#L{设为默认标题}");a.removeClassName(h[j].parentNode.parentNode,"input_outer_default");a.removeClassName(h[j].parentNode.parentNode,"input_outer_only")}d.innerHTML=e("#L{默认标题}");a.addClassName(d.parentNode.parentNode,"input_outer_default");var f=a.sizzle("input",d.parentNode.parentNode)[0];g=f.value;i.setData()}},inputChange:function(c){var d=c.el,e=d.value,f=a.lib.video.commTool.getWordLengh(e),h=a.sizzle('[node-type="countLimit"]',b)[0];h.innerHTML=f+"/30";if(f<25){a.removeClassName(h,"S_error");a.addClassName(h,"S_txt2")}else if(f>=25&&f<=30){a.removeClassName(h,"S_txt2");a.addClassName(h,"S_error")}else f>30&&(d.value=a.lib.video.commTool.strCut(d.value,60));f=a.lib.video.commTool.getWordLengh(d.value);h.innerHTML=f+"/30";i.isDefaultNode(d.parentNode)&&(g=d.value);i.setData()},inputFocusin:function(b){a.addClassName(b.el.parentNode,"W_input_focus")},inputFocusout:function(b){a.removeClassName(b.el.parentNode,"W_input_focus")}},k=function(){i.setData();var c=a.sizzle("div",b)[0];a.addClassName(c,"input_outer_only");var e=a.sizzle("[node-type=star]",b)[0];(d.isPGC||d.ismcn||d.level<=3)&&e&&a.setStyle(e,"visibility","visible");a.setStyle(a.sizzle("[node-type=titleCount]",b)[0],"display","none");a.setStyle(a.sizzle("[action-type=addTitle]",b)[0],"display","none");f.add("addTitle","click",j.addTitle);f.add("delTitle","click",j.delTitle);f.add("setDefault","click",j.setDefault);f.add("inputTitle","focusin",j.inputChange);f.add("inputTitle","keyup",j.inputChange);if(a.core.util.browser.IE7||a.core.util.browser.IE8){f.add("inputTitle","focusin",j.inputFocusin);f.add("inputTitle","focusout",j.inputFocusout)}};k();h.destroy=function(){f.destroy()};return h}});
STK.register("lib.video.sort",function(a){return function(b){var c,d={},e={sortShow:function(c){var d=a.sizzle("div.layer_sort_select",b);d=d[0];if(a.getStyle(d,"display")=="none"){a.setStyles(d,"display","block");a.sizzle("input",b)[0].focus()}else a.setStyles(d,"display","none")},selectSort:function(b){var c=b.box,d=b.el,e=d.innerText,g=a.sizzle("input",c)[0];g.value=e;var h=a.sizzle("a.sortItem.curr",c)[0];h&&a.removeClassName(h,"curr");a.addClassName(d,"curr");f.hideSort();f.setData(e)}},f={hideSort:function(){var c=a.sizzle("div.layer_sort_select",b)[0];a.getStyle(c,"display")=="block"&&a.setStyles(c,"display","none")},setData:function(a){b.setAttribute("action-data","video_categories="+a)}},g=function(){c=a.delegatedEvent(b);c.add("showSort","click",e.sortShow);c.add("selectSort","click",e.selectSort);a.addEvent(a.sizzle("input",b)[0],"click",e.sortShow)};g();d.hideSort=f.hideSort;d.destroy=function(){c.destroy();a.removeEvent(a.sizzle("input",b)[0],"click",e.sortShow)};return d}});
STK.register("lib.video.program",function(a){var b='<div class="W_layer W_layer_pop">    <div class="content layer_mini_info">        <p class="main_txt"><i class="W_icon icon_rederrorS"></i><span class="txt S_txt1">专辑只支持清晰度高于720P且时长1分钟以上的视频。</span></p>        <div class="W_layer_arrow"><span class="W_arrow_bor W_arrow_bor_b"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div>    </div></div>',c=a.core.json.queryToJson;return function(d){if(!d)return null;var e,f,g={},h=null,i=null,j=null,k=null,l=null,m={showProgram:function(b){if(!b.target){var c=a.sizzle("div.layer_menu_list",d),e=a.sizzle("[node-type=content_div]",d)[0];c=c[0];if(a.getStyle(c,"display")=="none"){a.setStyles(c,"display","block");setTimeout(function(){a.setStyles(e,"border-color","rgb(250, 125, 60)")},10);n.setCur();h.focus()}else{a.setStyles(c,"display","none");a.setStyles(e,"border-color","rgb(204, 204, 204)")}}},select_item:function(a){var b=a.el,c=a.data;n.hideProgram();h.value=c.value},disableProgram:function(c){a.ui.mlayer(b,{clickBlankToHide:!0,stopClickPropagation:!0,autoRelease:!1,showWithAni:"fadeInUp:fast",hideWithAni:"fadeOutDown:fast"}).show().beside(h,{pos:"top-left",offsetX:-20,offsetY:-10,appendTo:document.body})},program_tip:function(b){var c='<div class="W_layer W_layer_pop">    <div class="content layer_mini_opt">        <p class="main_txt W_tc W_fb W_f14 S_txt1">微博专辑</p>        <p class="sub_txt S_txt2">1、专辑功能可以让你对自己的视频作品<br>进行分类管理。<br>2、发布视频时可以自己新建专辑，也可<br>以将视频加入到已创建的专辑中。<br>3、制作优秀的专辑会被推荐到微博视频<br>精选频道，让你获得更多的曝光和涨粉<br>机会；视频被推荐的唯一标准是视频质量，<br>不受粉丝量影响。<br>4、专辑视频只支持清晰度高于720P且时<br>长1分钟以上的视频。</p>        <p class="btn" node-type="noticeOk"><a href="javascript:void(0);" class="W_btn_a">知道了</a></p>        <div class="W_layer_arrow"><span class="W_arrow_bor W_arrow_bor_b"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div>    </div></div>';f=a.ui.mlayer(c,{clickBlankToHide:!0,stopClickPropagation:!0,autoRelease:!1,showWithAni:"fadeInUp:fast",hideWithAni:"fadeOutDown:fast"}).show().beside(b.el,{pos:"top-left",offsetX:-20,offsetY:-10,appendTo:document.body});a.addEvent(f.getDomList(!0).noticeOk,"click",m.noticeOk)},noticeOk:function(b){f&&a.removeEvent(f.getDomList(!0).noticeOk,"click",m.noticeOk);f&&f.hide()},meprolist:function(a){n.clearCur()},mlprolist:function(a){n.setCur()}},n={hideProgram:function(){var b=a.sizzle("div.layer_menu_list",d)[0];if(a.getStyle(b,"display")=="block"){a.setStyles(b,"display","none");b.style.display}},setData:function(a){d.setAttribute("action-data","is_playlist="+a)},setCur:function(){var b=c(d.getAttribute("action-data"));for(var e in k){var f=c(a.sizzle("a",k[e])[0].getAttribute("action-data"));f.type==b.is_playlist?a.addClassName(k[e],"cur"):a.removeClassName(k[e],"cur")}},clearCur:function(){for(var b in k)a.removeClassName(k[b],"cur")},reset:function(){n.destroy();o()},destroy:function(){e&&e.destroy();a.removeEvent(h,"click",l?m.disableProgram:m.showProgram);a.removeEvent(j,"mouseenter",m.meprolist);a.removeEvent(j,"mouseleave",m.mlprolist);f=null;h=null;i=null;j=null;k=null;l=null;e=null}},o=function(){h=a.sizzle("[node-type=scroll_program]",d)[0];i=a.sizzle("[node-type=content_div]",d)[0];j=a.sizzle("[node-type=program_list]",d)[0];k=a.sizzle("li",j);l=a.hasClassName(i,"input_outer2_disabled");e=a.delegatedEvent(d);e.add("showProgram","click",l?m.disableProgram:m.showProgram);e.add("program_tip","click",m.program_tip);a.addEvent(h,"click",l?m.disableProgram:m.showProgram);a.addEvent(j,"mouseenter",m.meprolist);a.addEvent(j,"mouseleave",m.mlprolist);e.add("select_item","click",m.select_item)};o();g.hideProgram=n.hideProgram;g.destroy=n.destroy;g.reset=n.reset;return g}});
STK.register("lib.video.whiteList",function(a){return function(){var b={},c=function(){var b=["1775506770","1845864154","1887961351","5953365159","2714280233","6250824982","1994516565","2970452952","3948713134","5869525717","6037687121","5497993620","5135808743","5909185172","1788911247","5991896093","5291824241","1855947335","6124642021","5709892136","5935300594","6049304407","3901429666","2634877355","2263913525","5874204972","5933834580","1851231782","1897509683","3222817584","2701148474","2160160857","5414748091","1895944731","1805009330","6337212511","1189615035","6050873094","5593771225","2657550845","6070149577","2186363183","1775619747","1895291251","6100165591","1993670563","5882998192","5868150992","2451876495","5042958097","2477339061","5953072618","5795291765","6023864410","6135166906","5639849121","1696512981","1945295824","6326747761","1910848371","1684446114","5710586189","5232055343","5887973569","1573953470","5240187477","5340337769","1768511567","2832410790","1497087080","3182235182","5687064835","5722634120","5703511300","1926652273","1720664360","1271638160","5958520718","1745885344","1885904345","5174473062","5814211294","5997529482","2535267903","5902444708","2147514324","6098505303","1895327843","6142716952","1944603171","5887964956","5166184780","6004302211","6228906360","6245651750","6349940895","1745746033","6346490890","1698823241","2834835205","5413667853","5732547280","5976424681","5979631461","1301904252","5833583486","3645348205","5599900376","3314422837","6177529873","6088522679","6177332168","5860443567","2239529624","2944398347","5889506199","5794269312","6180454695","2297283717","3097378697","5055109473","6069791474","2409482243","5501375360","1785559280","6012806447","6202887421","5933392166","2286189313","2766134004","1652707015","6100945123","1900252997","5463794433","2835392520","5643044717","1770059175","1661493522","5741801557","6327641152","2701177800","1140554177","1054009064","5771690234","6132164159","2469653640","6348485093","6073515397","6246439935","6162866961","6190030326","2610441361","2403894253","2354904481","1996712263","6169111729","6069787217","5451021485","5716783177","5210781129","2837293720","1619764557","1596103295","5456396309","5836425666","1882345883","6167846250","5033393722","5985183603","1639804820","6061180654","5829345086","1743696432","1310630777","1804342245","1892305742","2206381882","5346583381","1894091913","1973326124","1264257802","1464041460","1729683760","6081574122","5873644422","6267261833","6097248903","6265138946","6021904413","3002769550","6079558971","1834123670","5540787756","1728135904","5878565502","2596119483","5837697857","6301459283","1915389755","5973621471","1667575473","5715109289","5866167425","5860481993","6063364171","1968202917","1757073867","2817145687","1760586325","5524008509","5994931208","1868478315","5939109236","6240962222","1945584665","5936492384","3751469395","3637354755","1879044834","2156045842","5822812020","5211873777","3094705583","5727695436","2722594160","5879823459","1993901865","6001598576","1874025570","6010944886","1778742953","1214835457","6172978260","1765148101","6221623314","5943596335","1212054905","3139407667","2521946384","3990543924","6088136883","1734591194","6023871080","6340133725","2245202631","6293260905","6445336651","5408051044","5880942279","5984799703","1727987701","2791546850","6212569431","5786902874","5822025738","3694243670","2823417024","1485095851","1659490917","2682076785","2198328875","6248647396","1846667353","6010488042","6009027636","1774181624","1842312240","2995921537","5540452645","5394636613","6050572478","6137455005","3193430923","6228233328","5908405358","1837659353","1939419914","2693420092","6257076674","3172232337","5754559290","1267283115","1977278337","1985375991","2979392192","1706675184","6060404248","1822884154","2011445377","1764357042","5995163148","6211153381","1815338681","2019094113","5807237691","2136013083","5872605952","3140891287","6187821083","6412479971","6345572255","5944465923","5985746143","2045571310","3479629641","5685395646","1976847931","6220503236","2395743084","5142555624","6065217953","2262824065","2702595367","1855787821","5222913979","1665662404","1780291857","3920497465","6153275498","6135194136","5606752094","2370899741","5941687237","3072968985","2479110454","2625858604","5721826695","6351705477","2324405933","5776930791","1786785744","5821585980","3668989607","5776706127","5888120096","1743660634","1112513873","2137281670","2613405435","6215261618","2125016281","6154237801","6105933956","6213927643","5636758069","5831481714","1767548274","5976903286","5628031823","1816741822","2427342952","6336567411","3215977500","6126520771","6250547665","6256894321","1798050592","1746383931","5687445105","5098547539","6063018876","6072469875","1660646684","2377006293","6271040636","1804955967","1845100562","6000046158","5626194021","1150085822","1965428461","1211113332","2760296044","5271530236","1289600983","1596931083","1563760787","6056657061","5974403004","2080259373","5822930158","6177287460","6249864698","2200249730","1750195003","6209962912","5111751117","2092149821","6040725343","1906385094","5807566080","1770529042","3886552901","5843534232","3733850024","3016882097","3157042815","5737166998","1863148892","1199129295","1104343893","5360179711","5324616226","1504145281","6260513135","1995855331","5887304245","1881940564","5983127367","3631166363","5745465714","1776536781","5617775353","1895520105","5313059495","6164864601","6256881206","6052121426","1696695190","2035812517","6427686056","5973681201","6087767848","6019888906","1673453232","6135021882","3053315777","6067766457","5984891494","6073302460","6212790103","1602406350","2169527444","1994464041","5594349046","1644636764","5589208548","1767921214","5866331795","5999021059","5860297558","3582513441","3472193662","5082202291","2212188093","5855496637","1746067030","2179113365","1565726780","1649754394","1810401530","1749937787","3569529184","6161723393","6016552897","5847366436","5995751503","1733084104","3224115587","5633299553","6432730710","6058837545","6099709769","5178765145","1838919975","1677574487","2152760185","5886252633","6098496418","6084437509","2606741827","6427628149","1640759315","2014149464","6275620464","1945206920","6083955636","6247083138","2163553891","3162483744","5632113527","2201154710","1656708160","5969479877","1496846495","5677484752","5669577493","6270128583","1399746707","6003325152","6330708010","2971648351","2742115297","2247805847","1696935595","6056929053","6351033817","5198881187","6013558705","3665928015","1756815507","5931412368","2004482285","3363163410","2721044084","2448391544","2194733512","5999951492","2610715291","3286285097","6073207611","1644358851","5910074034","1763472021","1862439655","2191355324","5704916395","1812982602","1789451151","1968758563","5848041511","1526131963","3768854581","6205512779","1294830503","2694882045","2319661860","2655410073","1478589492","2238160010","5108633597","5932557435","6135021939","5642361302","6177244226","2245349133","2057327125","6098693698","6306521393","3879989310","5143716103","5840068655","5187639875","1573021601","6248508812","2313012280","1595443924","5792230160","3184619657","1763760351","5593715987","2204454944","2921244052","6141884769","5321166652","6186357451","1787388727","5263758728","6270375959","3922861697","6366597443","1697536521","1706360617","3716355891","5662733778","5915218526","5769702533","5961036557","3030975747","3310129713","2479082722","3246413170","1928842387","6081870046","6078378340","2975014083","1684184801","5354288140","6244129343","5261119051","2992428482","5873839815","1557605344","1470809487","5711525301","3018475881","5013668220","1826246840","1750261121","6217402239","5565691983","5894128551","5354408684","5882329628","1277908801","6369501744","3639892812","5696799348","6073919907","1749254813","5686301704","6297902241","6137907478","6359358839","3173395971","5079220726","5692398432","5041890608","6016819397","6112759267","1964322754","3548759507","5083082187","5993089960","6308353487","5587099627","3212860325","6195216842","1765693852","6347778035","2478914783","1970647461","1760099287","1671416800","6399214485","1751044680","6098917910","6320346710","6362315374","1800271842","5893789485","1199712261","5845654059","6126520770","6147105964","5738586019","6086657284","5531372348","1765847045","5989311446","1647219501","6008162529","6186150900","6208461687","5687255483","5130818068","6135021877","5155643931","6178070102","6346879097","2668140364","6443665813","2236554840","1772469214","1889607690","1680445740","6396740838","2699294862","6055017390","6327283746","3205914067","5466272016","1615630607","1576284783","5333523066","1229008375","2874110744","5221041721","1880235745","6079527311","6348367123","3500537197","6174661189","6104806425","6236911367","1768919202","6224647408","2049777260","1832740403","2012587185","5648657816","1874781737","2128021282","6147168148","3740311277","6083960548","1876265021","2021654081","6016837939","6362129179","5300636312","5813614801","6065382792","5194095748","6258006230","1750880161","3908786319","1255965235","2511377292","1752369340","1410812623","3824282019","6079194958","6186389186","6196691234","6064833743","3184620963","5734325998","5863565993","6233399778","2394941152","1107614297","6182376050","1881907940","2305179711","6016400886","1763452763","5796516636","6126520842","6183801830","3899592205","1784742491","6443969416","1687660527","1668277257","5896765729","5928312445","5669461176","1768212874","5943570979","1419776167","1744616067","6240512250","6079192537","6324828790","1786833911","5933765431","1791576991","1688136964","5303595479","2025479687","5410326194","1916849715","1828269910","5814221498","2024042357","1962190703","1530160571","1683304193","6334862418","6085653393","6300358739","6349462921","2610287083","2643981120","5884212886","1585205741","6065255300","6034621767","1967366385","1739792883","5127225727","1813378072","6063046645","6027607284","6109985982","1678777395","1768743225","6269508067","1888068592","5993449331","2840252665","6086395237","1177461114","6378068281","1105790975","6108317581","1807384352","1748440995","2090807723","6273379646","6169423635","6008523580","5943608086","6200169407","6360522656","2290528280","1954301771","1908758204","5975373899","5812110275","1850550517","1746630350","1795509335","2723728523","2038891141","6415996216","1802741635","5559468986","5579818423","2120256690","5972917747","2119777555","6217683074","6077085361","3065243713","5996029013","2216623924","6351329921","6334857727","2380986174","3296776127","6259290720","5313269158","2409695701","1767961804","5675449379","6126520723","2089538657","2408951592","6025929693","2371191640","6371751454","3928734551","1291021104","2590381614","5662742072","2692952481","1664342722","2013767633","5994570806","1850235592","1130556244","1833383460","5927825669","5747171179","6246943737","1457699772","2492866750","1772194645","5888233693","6008396902","6364066642","6372732505","1626168054","6135021899","6296797069","5803934320","5162599980","5764537898","1835572812","6079556495","5980049710","1740833027","6126520743","5738735015","6228266754","1307488623","1228568651","1878213401","6357419820","3668962412","1670537187","6362632222","1590560830","3992699932","5618141126","6076620529","3145175562","5173243410","6090494539","2323056111","2280219221","2403599685","6225957370","3124670421","1634139750","6415903493","6090883695","6079250906","6114891937","1782459117","1657932147","5220549032","6048618809","6126520779","1732093045","1802338641","5818478557","2027702851","3810123211","2632277843","5931847615","6043332486","6353308620","5533018793","1752508465","2665846363","5986399562","5729016246","2247617502","2810864523","1649254297","5462422643","6163765186","6358317726","6156641637","6166923586","1790918185","6327284029","6334154321","5514931263","1448224822","5865684347","5816037017","1891128203","1814525871","5663252702","2053016910","5617355277","5828878472","1954778190","6168296494","6032438145","5658762725","6380644334","2934216447","1730933467","5388978610","1247317642","5271017437","2854330995","1733444583","1837729024","1626297211","1747618843","5363032799","5961182890","2094824032","6035041939","1813951113","5605297685","1566689524","6144351513","5583948100","6273298345","2150152830","2396874941","6414761150","6354465166","6073185772","3021559681","5726033596","6074474463","6190469910","2871654207","5216011723","6333942182","6244511702","1628251703","3276213840","1830517163","2176645133","1772239660","6010763425","1286891293","2010822807","1789528580","1290855045","1748386671","6210557079","1739545810","6062511615","1805696283","1866904841","5447493806","3737696342","1891235114","1276028642","5972836916","6050584529","6296587546","1073591895","1302651671","2655024514","6193771972","2608176154","2885256544","6409448749","6077908910","6407204753","5696365228","3137966277","6323207636","5855520747","1216883363","5363577705","1913199693","2299825394","6321600498","6254767000","5347861808","6004562698","1743527427","2164466345","6392887997","3503962735","1807379924","2358163423","2027687052","1703697272","5941352294","1943075753","1287139602","1643986137","2082383835","1968996013","5320574913","2207431247","6154573576","1866834751","5828028360","5994527442","1721032143","6092234830","1768644874","1746598137","1745465244","2447248383","5974135713","6217884455","6294963169","2481078607","1842357963","6388134095","2212758830","2054544227","2008864025","6115644584","6236030386","5537784338","6210540284","6299398758","1299286183","5804237124","6444593050","6077798496","3450091462","1306404105","1780362927","6231524614","2516416291","5825093412","6067003283","1918793231","1951359172","6047017070","1787333810","1731322414","5210128427","3977251805","6262465556","6297692516","5115007794","1963514023","2014482332","1737518574","6138087930","5644847012","6141086679","6171701451","2636991122","5983858658","6427893009","2152950405","1505533530","5621554646","2383199244","6279804563","5368940589","2536208032","1729187757","1724734630","6039735858","6049305333","2849557973","1581266912","6086072138","2132460967","1826637644","6438577592","6165944548","1778330365","1901720275","6431901616","3845183217","2190933887","2277080151","6446483433","1116285310","3960778415","1276025865","6431662536","1604935830","1803613277","6260242983","6137965011","6391432255","1651756987","6131058065","1906570245","1864817172","6121891378","1992298763","1240183873","1925086735","6020424093","5876858187","5868425085","5847941463","2012133640","2814493542","6267562324","2734474393","5228046997","3477696732","2879470994","5732776759","5957667629","5970326551","5864552793","1809074415","1558238441","1764610424","6147037878","2124177153","6401622813","6155337405","6077013667","5922092586","1700620653","6072551766","1835783522","5957435679","1537103950","6323859296","2299413505","5686734198","3104016823","6213803431","6315903841","3044580103","1784204605","1676582524","1831074395","1596409212","5345608506","6058957523","6301518425","1410364817","1663000150","2138160705","1783925411","6210688176","1877423263","1656203845","1928881645","5874104703","1296760945","1664822514","1683480272","6405539355","5344916506","5038744830","2667941195","1943619670","2528724870","3811093527","6086099350","6449384245","1756788837","1786718723","5321027004","5840448981","6348007319","6163581084","6190789917","1742693175","6179089668","1909984231","5680887803","2574255697","1912715061","5048679752","5445980157","6152136172","2830468794","5729126469","6242103049","6152974570","6182382625","2881139837","5092713518","6080495881","3926462846","5884867582","1803288993","5551133198","1903547712","1651423310","2959400784","6054896591","3435089784","6126520748","5527709149","6343944263","5897914993","1828886927","5890585170","1828697841","1631817013","2080038033","5323144279","2698161514","1949251875","5714563981","6219586406","6431343520","5347795977","6221181804","1908834133","1768767410","1897308315","1640015373","5217936433","5692191949","6260476347","1752608547","2181810222","1771861045","3513796010","5022028993","2725949701","6164807571","2211903027","3510756495","5115456923","6267245098","2610239182","1118446501","1742917523","1614012094","5549009875","1259655275","6208574181","1818820992","2534574910","6229437737","1973415983","5735370644","6331503532","1949330511","1817217077","5835875186","6000043063","1718614144","6079195070","5581363016","1628196115","6063716553","2869780604","2130829202","5969331520","2621678411","1912449555","5601474365","5539790913","2259878180","3229417061","3246911427","3390570594","2677042071","3173116834","2545036024","3586843777","5872392516","6158344658","2423907245","3733029140","5514962106","2212250221","6253454836","5614340993","1619434070","1742289737","5549487807","1812594835","6000211822","1549646253","1530141800","6006516628","2690801420","1933466191","6277973788","1792005311","6087213675","1464920000","1233146122","5964066970","6195579157","2230056924","3192398770","5938132570","5409825060","6361213541","1862530430","1779302123","6058977418","1885817103","6085762164","3297142041","5496700255","6210748969","5828843772","5560677307","2241779424","1948523667","1956789077","3174873942","2813511011","6080332707","6285405662","1049378775","1742094500","6197212492","1607806944","1867085277","1440103481","2942126433","2257911997","1740396270","6294851077","6124648978","6294427186","1830839147","6160846444","6414742214","2043148381","5809223561","2885955360","1640092243","1745461094","1746824254","6290869143","1476998161","6082256989","2982286565","6086361634","1292380541","1218957517","1666785255","1762305605","1772914881","6282046077","1726426884","6060392150","3156138515","1949381197","5320940071","2332486873","5566310241","2238593563","6085581264","1870543145","2541742611","2805468830","3786655514","6411666372","1769273820","1805630611","3953731115","5640157596","2798826614","5575663913","2160135722","2096152763","5040857202","5319493520","1804874007","6210585734","3785807171","5038743865","5893098413","1549654070","6097189795","1845749680","5356394754","6135021974","1052485627","3542195612","1894158641","3481729475","6353788941","5406629394","2708201812","5464686016","1565279562","1850959195","6382533989","6028642432","6228400541","2411945167","2657138821","6147164733","5832750248","1748686337","5666892465","2339953802","5543451942","6027416124","2933409317","2601225703","1901833852","5584922654","1745527490","1868332017","5389556920","5699629948","6071778252","6246789392","6281159578","3311804203","1778438911","3221615270","3398944814","6343512594","1713110944","1725607380","1845760364","6289422572","1800405703","1406718177","5885347895","5856049009","1788429933","2159348007","3905378173","2504353742","6073659803","5461712902","5767621772","1315703562","5872092080","5656376380","6082426608","1568061967","1891460681","5876396312","1100212330","3036656427","5743517627","1752748662","6171529581","5854848993","6301835196","6008941910","6268474301","1843282014","2167582977","2053060665","2141275333","3544531531","5556867997","1861845762","2541048460","6051959946","5878918315","2098258053","1862203812","6145268356","1517794950","2206287290","1827480803","2617399337","2313624891","2604834522","6193552605","2714632883","1698258640","5578073848","1744823950","5069238092","1733051625","1579383010","5868327825","1250733183","1917167752","3874761844","1369455674","3230974202","2243300265","2131575473","6033015018","6329451190","1590956147","6352339411","1259887470","6144611167","6340748815","1798710261","5833083517","6420615079","1727330020","5943836542","5983008557","5643376333","5815533753","5104385437","2815047183","5018790067","6304954429","3069844914","6248678646","5717496711","6022324429","5993335454","2514211585","6392019530","1299419371","1958291161","2765846685","6012719517","5385519765","6063642286","1750412575","6178936002","5516074506","2508526094","1726316967","3901998783","5995009672","2794510550","6142526777","5235370515","5998160280","1583042361","1313252464","2862637710","1273063067","5972729846","1940921935","3506372551","1703746915","5850750366","5593781551","1934968773","2621141021","1652466293","6263705008","6187084578","1654179935","5741831762","3093092175","1687486981","5308669069","6084429153","2731323430","1575416143","3496714651","2144584133","1824841510","1304254192","1961381224","1497796405","1262589764","5041572450","1729163722","1739049744","1772546535","6169757667","2665135857","6387566987","2079651001","3029879143","5742957074","6080551584","1886468085","5989312474","2754772891","1748067122","6012275787","5883593625","5753733089","1114198085","6015545925","1823591610","3407071510","2053713015","1834118654","5718918076","6095975641","2274605864","1679645790","3495854362","2703348994","2463496331","1282903762","1188369822","2731554564","2780148215","1666829172","5396477025","5783798079","2616743463","5608751455","2179423121","6071690406","6060366844","1700713382","2941363141","3214565343","6015166419","5647639502","2693728041","6014513352","6292726213","1729809687","5494061807","2312075675","6147162744","3923839470","6079196173","6298649148","2640489721","1760648487","2370306843","2607073175","2947584360","1642500775","5248167732","2465201120","5627015582","5240381466","6219565459","1026195314","6381662735","5943769322","6267167044","6048031187","2602010243","1590525042","6392950156","6028844508","5496384482","1768644550","5376109342","6378502232","1773732263","6178463979","3227976080","1766528535","6048624491","2916497573","2184634314","3408035022","3986233139","2568792052","2266200213","1214329262","6450166654","1975993251","2487613615","2694824157","3249656920","1666179680","1246856883","6002114769","6029186838","5594130905","1992403775","5821974195","3270847850","6275768809","5896325001","6372900231","2104460734","5991871590","3027491605","6317422942","2068200753","5471563074","1633950591","3109203651","2215805097","6339557944","1368942331","5607473947","5855820898","6137925503","1775710532","5217947713","5884376227","2607949285","1955292790","1874269842","1751902905","6422161255","3174813400","6446211954","6226132859","5839800471","1798115541","1497082810","5994610633","5724134783","5411547788","2689037485","1727230121","2978143310","1820485935","2833050332","1790059085","2385387524","1612279392","5750853306","1646343160","1989042943","1656386755","5201391220","2930474635","6154041648","6192085227","1272282165","1301596887","1729780650","5618031637","1973200523","3815389214","1830679800","1277654753","5305841349","3277457677","6088305701","1065838433","2417545750","5075529975","6083251968","2748328853","5664880173","2677056914","5700422399","6433469364","2034852690","6050589378","5829329531","1168581362","1619195575","2539007975","1974145444","5903474524","5163141742","1497583812","1802857681","5935748466","1976476374","5825305153","1595890361","1769636250","5886464676","6259543752","2624154717","1528577371","6137769251","1853185254","1867793731","2482578775","5111158994","2048834864","2937045961","1845651581","2353158755","6194137265","2583628287","1294317314","6285322608","1413142663","1750520665","2836135230","2011874330","2937566403","3103934253","1746653972","6013657906","5046347352","5507878378","2818435142","6298020525","3861960623","6304555072","1766865713","5724402884","1841579352","6135021977","1757972997","6303188209","2102231833","6267834756","6393904893","2154602205","1944097303","1849175022","5104035521","2585866007","1285272157","5789163623","1710717720","6079558227","1258547911","6102601777","5395535405","1738320255","6147051340","5240878883","6210080851","1879455032","2647384315","3290400553","5201771972","1629072852","1853449351","6300249300","1841130020","5882055154","6409709146","2132212384","1667086511","5758835595","5804879863","2810017187","6401702447","6289464693","6289464693","6013250944","1292321844","5754076452","6098447024","6305536226","6342253289","5715024534","6047690684","5252052954","6177239045","1737403247","3835687879","6202750053","5925008909","6301653401","5897808116","2917550761","3542455442","1720595064","2640824204","1381490962","6033568995","1752922740","2769885021","1253178171","5754078121","1840208253","2456246394","3316181835","2096496475","1756920891","1236937620","6020529025","6307157492","1837530430","1997894213","6088026662","1768730935","1772630300","1693604517","2000048795","1790048760","1841525720","6028856040","6068937345","2677016703","3986842950","1922328587","2610366995","3880519538","2398152481","5184785516","6246783324","1226799182","3802291063","1956034424","6213155698","5056788845","1855250780","3754714615","1994545144","1773975675","1970181353","1211756405","1848174240","1752673095","5394156245","6065250352","2275632685","6336248585","2124620995","6175186733","6098596320","2462366282","2128822703","6186691161","3928749426","1136131653","2722654571","1882307872","6455188898","1692974040","1699516131","5465718337","1651665455","1726089432","6336702184","2640662852","1796924270","2231573582","5911873703","5972179364","5831070929","6291957908","1785815190","1243835340","3305178641","2381886441","6209007274","5787597536","2531011765","6166783076","5878614097","5765512157","1752757352","5897708962","6356916998","2242184462","5708008118","6307291186","1893541525","5395757246","5892461125","6113048306","5041262490","3904866553","1858561902","5080407365","2390372595","5080772531","2820724107","6331062510","1053148552","5261491534","2795980052","5198567490","2639122163","5019885084","5623346827","1969825342","6063265986","1957917025","2866884621","1737850362","1760278507","3193315634","6299373734","6069004324","3985026379","1944956531","1977822955","5279748872","2426833274","1865992905","2368455454","1794940924","3280515934","1677327611","2360265675","6361206650","6215128231","5715170493","1438123671","1747171460","2481274781","1315041285","5911258927","6065022102","6324222758","1783681865","2147284961","1777928805","1773966761","2194098132","5685603006","5985174762","2253536081","1770165364","5926365604","6342497766","5973198651","2168712212","1847440100","3919956944","1228901227","6254773196","6210753890","1910141383","2011020237","6451505989","6095600073","3536781215","3805766460","6094630339","1765678631","2233671194","1762217232","5829912487","2313525837","5993447823","1823650485","5955148055","3536995267","5938030774","1512235495","5966885165","1872080645","2214600811","6280832991","1400526035","2659838522","1748615685","2021712267","1353065027","1785875507","6399613974","5998219604","5698181847","5852457614","6293821321","1832043482","1619332090","5087889151","3791399577","3153403623","1834961873","1721903472","1966048181","6171258184","5904477826","2853279062","1939702464","1953829925","6206268565","3891451193","2130513901","2282535415","6353826553","6045894747","2472606432","1821389535","1886097621","1533447021","5943121157","1915357705","6004723057","6171467571","2481041397","1775870380","2693249890","2820124260","5394154738","1936705842","6315526016","6180222331","1971556827","1254200157","1791591304","1622890522","6355155843","5582638906","3197993670","5872270314","2085966565","1866149335","6050949332","1737746645","2685019031","2419017395","6243783251","6072569059","6124611987","5268093883","1942808561","1902652273","1913425273","2484524985","1775666753","1807249320","5049052911","1792144581","1742826147","5717364383","1990844157","3845969110","6016555520","1549077107","5628576445","1701314291","1784360444","6279363183","2652440773","3217908364","3886911007","5140701898","5718185065","1195533745","2102386405","5276457036","1164361453","6055669744","1912306550","2038212177","6323899312","1781994303","5657792923","6088224880","1858139742","1630830190","6100383631","1873457315","6182954477","3924866750","1730311783","1251314420","1862936250","6052161672","5749738916","3227188517","5650977977","5746203326","2821147514","2407343837","6056355854","1819475381","5919521841","1875850067","3118085371","3221885462","2180641302","3394123104","6017583087","1222244775","5739380905","5969723226","2887968015","5196237525","5329899625","3903135431","1810187370","1118035050","1024763102","5943359113","5978789611","6186705081","1644207680","1594300630","3714607270","2433053763","2257396295","5623733303","1832010325","6164816672","2385942587","6036876719","1733838543","5597542886","5648227395","2254933014","6140116306","6304381077","5395531845","2772135307","6049272585","2216762003","1891961304","3055319071","5648488930","5456128954","1397206420","6246006586","1691305167","3825651010","1920780404","5750072964","6302210168","6235801749","1907621871","1224698770","1781301237","1886420340","2116080265","1819363871","1319066361","6030192468","6320676275","6102638872","5322987808","2883048712","5911079759","6300923309","5762686552","5521736002","1752040330","2179135684","2351714363","5786982278","3309001692","1764149945","5069424644","1233318413","5966655088","1882800210","2217439932","1743118882","1276564860","1594062984","6017120563","2196651081","3959627368","2235524680","1675767463","1844595290","5936988299","1727063921","6326647492","1662243091","1657091361","5061549993","1902896997","6100298483","5196547283","1916401801","2676790450","1449926762","1809973631","2589370961","1738149614","2377485191","1905611767","6062962099","1674651054","2716974492","2825953201","6087238171","2681321791","6167400865","1737357141","1910184183","1671194705","3710674180","1693585693","5883683894","6224907106","2256200994","1970833007","2727582844","2412470950","1574865254","1895761874","3125720085","1955896163","2609649397","5875195736","2161478957","1744537562","6320299038","1774041753","1734741902","5774279483","6090733362","6216676350","1601335730","2993307872","5862195168","5591532850","6137683616","1759411151","1797830954","5901290214","6411672697","6225953408","5030297800","1047672471","5262705677","2836749815","5467419946","2155159645","1737224242","1678613514","6190774254","1788209730","6094800227","6361446419","2433749821","6322802417","1066995495","6060710253","1766362445","1660266031","2157474502","5532856639","6147036958","5757883206","1691991065","1950138307","6047782789","6218547679","3700087932","1786222081","5880946416","2680721473","1866921631","1242159641","2637715867","6311246869","2389178170","1885270701","3835344858","1918203020","6248363850","1763189855","5832177778","3317632203","6140533125","1759553105","5743102390","2262073220","1677034681","1726702072","3216973612","2706481585","3746670370","1772797144","5706331822","2565119255","6066172379","1796542991","1816902855","2351803373","1825730853","1798047093","6077537703","5640270903","3293183735","1326937777","3317043473","5864774796","1972124003","1667974701","6274144748","1416671622","2144287705","1877335631","1750349211","1878128620","1241296055","2038373915","2106096045","2460186891","6033751892","1768117245","6096315525","5528927303","5614350686","5170195335","5976192507","5605507948","1786966103","2180922697","5055187994","3948645369","5182818430","2136384774","1976599387","1996814927","1638967621","3215763391","5054755122","3035946025","2731702163","2136341197","1814028040","2012940511","5955159136","1946048360","5626139459","1768020875","1842461004","2653881037","2887580753","2387327890","6261948487","3719096180","6012149804","1882386593","1915087884","1786323055","5144442015","3279716141","5869894762","1986946411","5857164378","6068029682","1792846602","5017973401","2233501571","1743043295","1781668001","1732654964","2124129261","6072705217","6371732781","6030055658","5710956829","2297712912","1781750204","1892205857","1667193577","1224838603","3852856947","6031622771","5753544169","1873676477","3934559525","1763678755","1738383877","3577743170","1782599683","1857639184","2501898851","2834622691","6219593881","2136342033","5950592847","6389380362","2423602242","2664363390","3217127827","2916423682","2710728757","5974514432","1765303145","1492351337","5960871378","1750867225","1767230231","2294284472","2710062607","2570149951","1225047627","1850101627","3152524900","1989871745","3649190185","5756685097","5571673140","2159985694","1752915254","5113302693","1745822675","6226316001","5880637149","2853310973","5331550696","1671198322","5922558314","2621639523","5740817969","6167842148","5721819603","6012581397","6053883820","2495158142","2608720237","6161532379","1884117324","6154333526","1741832310","5977662472","1740431401","1988478971","5960965538","1787051113","1805351084","2265700983","1746841372","2392425412","6112553631","5400449602","1656715760","3485182815","1826458524","2525454133","3788275372","1661649494","2964137215","5856605688","2459142683","1633625994","2632064921","5766292422","1667923314","2556789714","3895679708","5937834235","1902305500","5586771466","6045871239","1752536282","1892344372","6279803252","6426053425","1752417775","6405043135","5104866468","2749401781","5884330655","6101518182","2047399633","6195286395","3020935837","1389024564","5478379378","6090513802","5103024493","2124504487","5833712254","3928724083","2323454693","2170807522","1312452710","5339983603","1757187541","5786712330","2189057597","5910320667","1745507755","2801968387","5685853725","1965677130","3011906361","5991278385","6016643794","1737010797","6175006715","5452731952","6078282313","2661504823","1768346942","1647161640","5974113211","2529948723","1996669711","1644215181","6106258862","1239307135","6249014312","1037910543","1673977470","6016523223","5589804143","6354225202","2792466172","2540779460","1800326274","2482653764","6228268249","1705558344","1716277405","6362712993","1750105961","1857664073","1889958765","1218639357","6142680701","5324277173","3629649875","5348177776","2706770535","1842114595","5239050123","6339851818","2811045524","1676628784","2709214371","1820585307","6072541644","1700292462","5776024380","5332195677","1582255734","6361190359","6087547516","1644536874","5043048078","1786748545","2242287503","2019644164","1799912081","1941783004","6241013565","5847492709","2607172693","2505756312","1789918763","6321876580","6244258877","3170027603","2060137771","6413770272","6008130886","6272518362","1832671243","1712242822","6074200542","6248469087","3916330360","2642898453","1645586361","1792315295","5975373449","1736842401","6373163776","2841181874","5935325965","2103953802","1657895683","6331505801","2310028801","1848081070","1880086437","5673069610","5718495181","1231355464","5317615729","2036847162","2374424364","5940017533","2875994785","5385531468","1644804277","1731211293","5771904703","1768537660","1676280571","2870325572","2513627643","5989315853","1260215284","2349450841","1294704187","1850798973","5889915517","5497216627","5903888943","1612456124","2111240954","1301064830","1712924810","3225229861","2252747224","2238174422","1853544207","1827196633","6144655784","1758418565","1705618081","6250563967","3502801212","5935951212","6124966761","1772576793","6084436439","5719668727","6072868988","2950251663","3769148337","5168298228","6012578657","6344621434","6268127673","1910965581","6334151516","1824047962","5703626480","2647407011","6124894479","3186787494","2278623007","6419275053","2156220144","1819859334","3276377302","6036144092","1644516981","6271950249","5973324963","2120248484","6150922233","6065221233","3951908493","3227862455","3520552652","6218594244","1884462000","2503476185","1628669597","6210433848","2142396021","1764677561","3822558450","1782483831","5377392109","2008329181","5126936426","6027586679","1962180263","2467663041","6177934805","1678050883","6212635830","1214427307","2791892237","2610883974","1750273512","2061778403","1968773517","6132750297","6077153795","5067077650","5088895086","1385600575","1667631617","2868515692","6112410308","3730560251","6335120180","5105256551","6251952372","5870456131","2832166914","6279850837","1582694621","2437279040","5645535951","2094354492","2568266201","5043929174","2303538952","2884878450","6323583904","3392453860","6213628023","1735610583","1862258165","1967969673","2122474140","5086606326","1719123527","2587896052","2505660602","1723048792","5667812532","2058670431","2681327522","1707084125","5531783442","1774548007","1489813585","1967446923","6094607440","5143222859","2690536033","5095789739","1757698571","3117239641","6381512299","1631030844","1858620435","3182655070","3750353003","5709550782","5129888443","6202784195","6158634629","1865803292","5657003741","3317498184","1742884561","6072566788","2060801115","5731610658","6177304991","2044885315","1810156492","5284709124","2382871717","2811690187","2036054823","5297121480","2235857581","6163283832","2279615672","1947570060","5639365180","5102178742","3186832183","2707668053","5721480555","1767811494","2263123703","1802048235","6106323261","6021665560","6305388643","5582336574","1585967487","1271749497","1973111867","5056852539","1726061524","1763339832","2121271750","1308194860","6041759045","6312039321","5164715757","6050585172","5384245384","1638761775","3922563660","1772654262","5963833328","6177822907","5577229858","2154320573","1816165077","3199145447","2185643945","6219373884","1240276892","1947725275","3215898505","5545949020","1351062184","2924209385","6292274897","5581761386","5901107322","3026948643","2278026243","1972211525","6366928356","1869151271","5800786508","6104635878","2723035521","6411185828","6296848895","5973952559","5538598982","2036433442","2207781523","5978427563","3299310150","6017548119","1866245947","5617436794","2460915545","5255865940","5488187036","1692255303","2514231791","6202857183","5137287304","5832821911","5311959049","1246794541","1918611551","5730881669","5626340545","2106253475","6375248580","1887970593","6033737301","1787291957","1602126660","1750227530","1748284637","6210945990","5177867466","6070544868","1647170920","5824054570","5757422848","1860523327","1277766232","1953277197","6280921722","2677532541","2117885890","5869803817","5253803561","1717257814","2137858660","1776954647","6355155235","3942124084","6079558461","2204418754","5368192654","6023611993","5175623223","2255357487","6376748792","6166223017","2218115030","6207957169","1936282004","1278678934","1856591792","3308859715","2369754055","1645752321","1803533745","1553070785","1598167053","5602219608","2284722340","6349466507","1690974044","2011658674","5112040265","1865310972","3011827155","6144123311","6070629932","1835433564","2606813921","5024420036","1967565385","6244255858","1220089451","3963228388","6207846211","1719655067","6211302791","2875970262","5948857710","6301843506","3053205063","3544571243","3165665483","3668956232","1845824364","2199188903","3911601943","2433949022","1338696775","2806029605","6004592128","5573490919","1955067355","1799270605","3473390440","6246763320","2538380337","5567166935","2074020111","5708404020","5925605984","6032431915","6073182873","1818803567","3994897234","1862648570","1885707797","1860141440","1701650614","1415589253","3602662714","1880092510","1736650734","2755030790","6261531592","2304930591","6201093721","5637756876","6062522632","5694422797","3550407702","6135021894","1280436145","6366909312","1745815941","6052022229","6040539918","2371443891","1834208161","6049155395","1732482180","6225175192","5980231954","5734838554","1935631853","2879849577","6090674652","3567389575","2997570695","6168504694","3199583115","3396127952","6383246273","1779458917","6186811245","1642720480","2260101255","3101744173","5516807038","1738028070","1839461472","1743852073","2658139441","2298257241","6269606050","1865999357","1715294787","2030654315","1730863767","6298537695","6158526243","2062211414","3550358364","3301654242","5620646504","2259988422","3945926482","6285371327","5958068107","5435800011","5233570593","6320328055","5456962104","5345135587","2620507071","1953927693","2341172437","5850162937","1752630772","1860126854","5451505497","3674928171","6126520711","1736848884","6371851409","6380169281","6196918357","1746173800","2369340672","1732208170","1893161330","2265377677","6260344368","6026196986","1731813194","5794969215","1296280220","3653454900","1665312744","3864643822","1843832337","6089240880","6083515938","1739737800","1507385114","6233953672","2113575032","6062078631","1252571101","1843654184","1559944162","2707630293","3784750125","2270616407","2947476717","2187303504","1768814700","5579059076","1546621051","1395046852","2117996481","1788225650","5347550389","5944403358","1737182035","1082779430","1822427143","2722939193","2793112580","1709706301","5260465647","5776964597","1779227463","5834768650","2602276221","5254049582","6204344823","1935528821","3843060163","1350472077","1930130851","1732071482","1596148864","1231169592","1997478155","1801219447","6262019025","1746932890","1778856313","6190261488","1953647017","6228272269","6052890011","2231778824","1863061987","1774809675","3482078003","2760571517","2521377340","5990203552","5710223063","1873473232","5249312330","5744725664","1110802824","2533824307","6024123042","2200825945","5634689443","1767822580","6421413849","5960442133","2189440690","3092013841","6025782415","2771129655","1748464064","6369936521","3204515774","1884880667","1720551352","5723810323","5669128072","1877660481","6170471646","6065126077","1927228385","6054952902","2332966785","1759664015","2009507265","6022480494","1777931937","5938245216","5474509790","6135021851","5979918887","1872039843","2864340573","2337335270","6330905629","1636174957","6107932511","6183209830","1866638395","6420176220","1704814052","2829193093","6155331434","6094894410","1783474762","5349124420","1952166463","2627135940","2335668333","6210552327","5904549772","2217940104","5605264569","6013550815","1899108945","1832262764","6083277985","6218254993","1776660177","1618776221","6126895157","1510280094","1889030183","2763136955","6417993381","3626621930","6298234716","2217513045","3813018176","6455468540","1652275927","1862093555","5972922779","5551897270","6278457371","1962027627","6033719295","1897780087","6441559684","1224529374","6092193600","5255431360","2304581631","3448317524","5993409508","3232334132","1695732125","1152073824","6348503224","1769171570","1615956633","2109472342","5639487439","1237404571","1712223474","6268048932","5538943616","1858892034","1894705533","2155405107","1799145083","1688189171","1879664414","6336772983","6296596016","2648427272","1711096872","1813165723","1886255660","5920039068","5074148946","6015090278","1998209143","1807547481","1931416761","2424996425","2621061137","2633214551","5928866424","2793960590","6196874374","1731669631","5977661849","1794060483","3478201083","5948449546","6294029316","2671970291","2078567085","5513018214","1959511082","5405790211","2806897437","5884265542","2073394275","1825965334","1899449163","2683121201","2019071187","6102641485","3028556991","1046458657","6211189117","2465063583","6302193498","1780345441","5868408652","5020111740","5324657546","6406619833","2051223654","1626299865","1450707092","1744361825","1305355281","6243044412","3824231439","5319075675","1785605900","5882114525","6090476182","6088259504","1840601221","2541662310","1785720980","1236862694","6301645238","5562275070","5840078068","6114810095","6256144023","5678405990","5719408773","1830688123","6212646580","1884578317","1881016355","2188478703","6279874257","6033144694","1675282373","6090474961","6077200110","6135021834","6336773841","6126917381","6190425991","6119525545","6004484607","6000054211","5767304758","1270104072","1728123810","1572268691","2063068692","1995223761","2119644727","6083345283","5347549879","3060469405","2090956711","1240402597","5211873241","2522753200","1910211612","6228271748","1895802213","1281031805","5870054705","1838887532","1268500521","2541979481","1761865872","6334627283","6001989362","1336252671","2802045950","1870370274","2103181214","1752739565","5252008509","2684182083","1650904790","2530811457","5928789341","1593739465","2409694481","1687190330","5584079790","5349548096","5494357731","1846012417","6033431244","6218554388","1222988070","1766380603","6288688217","5189858123","3005811585","1728872581","2729349951","1967584007","5682572852","5126072892","6102672973","6224117698","6087967137","1556696581","6092510457","5885710293","6201489315","5632017804","5589760141","3177400230","5572760447","6054722526","1727029513","5871672245","1738469441","2524325320","5864672578","2090995181","6031685636","2648824720","6238935654","1799593721","3179531282","1951814295","2324689530","5780819427","1820383834","5782146258","6307202194","5601621285","5758429358","1694174821","2633456071","5948337386","6104136358","6202750375","3695547940","1792429693","1948696150","5886250940","6067366180","2430268437","2173572285","1903752395","5189413899","3888956540","1839961045","1250793084","5872623922","1826993760","2938268365","1923321061","1899387601","2678107150","5973230861","6047010304","2647929985","5893898663","2295274134","5349186987","3308311955","3976476730","5627070181","1812325227","6074482691","6064505286","6368176509","1883713334","1930079675","5967329225","6353066297","5684987014","1850822547","2182295750","6137510228","5769384198","1871365715","2345405513","6163555171","5996041019","6133938079","1224044524","2231271810","1571056451","1906468150","6248493552","1959418437","1792980072","1894491433","6387741586","1805632230","6307164558","5894851109","1752853115","5904435152","5882406117","2003926541","1793618460","5500136299","6430635686","6158532244","5646585924","5400214292","2372405421","6359184148","1249462867","2710112721","2232816627","1932563832","5236434677","3734886647","6078909611","1726530777","6256072411","5918920460","3427044272","1725896835","6369893595","5625043677","2910324331","1858730847","3987062301","6297975063","1743839357","2143951325","6359358623","6290515590","2153261130","3173661153","3229467213","2259878000","5033414396","2872275050","5293344441","6100134252","6232797182","1782385763","1900957493","6252272517","5181770788","2132521984","2097820141","1736292250","6220387689","6293168335","2743972353","1709330637","6019912756","2510797787","2997057351","1289130990","1650274234","2190580683","5182229541","1069237150","1665212684","1008527585","6087619851","2022922817","6144502492","1259761954","5180339316","1735534331","1285034720","6048825629","6320729273","6018493305","1600298330","2029300513","5288657168","6180642838","2592859251","5584278943","1002534227","2073721184","3320074640","5316771278","2060480585","1960510933","2174138470","6226160132","6138529362","3564230740","6067755733","1788836675","5482941950","2035212324","2823340854","5136296806","5753194055","5034047075","3194099031","5995406238","6243030473","6025807006","2724807565","6073176712","6338254380","5757053802","6100505684","1794825255","5887542464","1920389957","1401247560","6132860919","1856783650","5932453727","2261214033","5699833207","6053894744","5757096354","6204467179","1950644550","5441485808","1870845043","2028157365","2144814265","3911791715","3799563722","5802659080","1726801574","5896110300","1726423055","6087611398","6343666294","6164212962","2193283564","6014317912","3868228131","6086740221","2820770044","3517214637","6101922703","6087898002","5914252466","6166340899","2355770201","2128211740","2687020845","6229400221","2161422080","5763342683","5085613098","5499746019","2063808167","2171313380","2307066211","5367405190","6043157913","1863133542","3179550700","5753191069","6126520753","3819951798","5826416798","1829492447","1863295327","2255194341","1810210447","6050549413","3212420701","3197691901","6160630803","6190439869","3873982784","3373958372","2751384433","6083937138","1789468204","6071813651","5368459311","5525992620","6079225608","6168468335","2155426841","5979696402","2432009933","2409648662","1745992742","5617158193","1364765574","2341027332","1919550981","1759418677","3656324554","2679101132","1800021882","6082425893","2452844071","2032628220","5900781424","6225973129","1782476591","3816150406","3274663155","1795870795","5644960505","3200752095","6346465133","6457561794","5547926094","5096143767","5102828988","1902845400","5553048025","5211008611","3928814666","1915046765","6030184440","1616739304","5923397597","2355146325","6338100887","2263650584","6135565664","1676512160","1898999677","6027625327","1196550420","6342627967","1971283431","1870629353","5680097834","2967146723","6047071416","2914615665","1168688253","5866403239","6086268235","6067216411","5793228607","6310897548","3979299833","1590603390","1920384031","6298327437","2239881352","6178337786","3023498805","2266474760","3262237174","2817611877","2001352552","6042472338","5707827101","6062708456","1252773775","2194014251","5817501284","6267921421","6142018851","6241215621","5126127977","6213021587","5446383676","1877853065","2162847852","6387563781","6221206901","2206994250","5359366389","5908182232","1679682533","5984175954","6290523818","2324578007","1931703742","5018028748","5537492437","6072861667","6441263829","5438565820","1889281827","6336404645","6211132221","6222794655","1833512977","1659221830","5731572354","6405779939","1897149414","6418956380","6219787641","1819549767","5999262063","1934864440","2440395312","2405538080","6367634189","1978341253","5941389019","2674849964","1932625815","1740051523","1737349747","2140468533","6290850285","5842074957","5727112757","2067645375","5710289040","6043305172","6356435427","6235432050","5377276998","1717852815","6005772365","6126520712","1821778071","1866719725","1954332717","6180245127","5758019160","1050188622","5335920655","3760142393","5977493869","1201773480","6096998240","6312026288","1188264720","5685839016","2235390992","6095680566","1805668547","6060358223","5071510637","6339938169","5888751045","1764081332","5641143482","6244141247","5988215206","1954119172","6336774669","1909178977","1869774114","1885158655","1846378360","1364542407","1737488713","6153062050","5260761857","1779627601","5668057033","6180195431","6012853489","2005285993","6093407324","5732656645","6195621191","1763324694","6064840768","1793653954","5414475841","6076223880","5945397363","5228984545","5991044516","2282914800","2293151990","2043939941","5489724528","2862529332","5601378283","1905027655","3824879321","5831018035","5731278001","2616448445","6322675018","1621851240","2121495200","1656088645","6228377178","6126520709","6355377603","5899421869","6090658966","1308207564","6057049505","1876475567","3178462734","5941211014","3396111384","6025616311","2142609687","6275620467","2954765543","5726493363","6196782096","2154812423","6281160307","1844623031","6042646626","1748256893","1130315067","5878864044","2250591447","6343794925","2243701632","5901272611","5774145247","575355554","274900117","208083768","1855738272","1631177264","6407288126","6280725153","6334426133","5878877759","3199526524","5189381919","2147552111","1665315381","1679586351","598663963","2855406487","5248091228","2951445784","5886528943","6218504421","326206066","6011290770","5459932009","5291646547","5193718216","644151188","6031963253","5376394939","6242091537","6179352026","5654955491","277338697","277113842","202827257","1727532781","6135384502","5943235316","6304409058","5631377530","2528260254","572447796","6070395225","6299314866","2186898557","1005055013","1872676311","118861128","6413969507","5897785923","6313101030","1704180940","1406244300","1001030102","1569476092","5164321213","5148470378","3333577652","3223637555","3159323862","2829024421","1540814011","2938380624","2714270292","1952677404","5756829586","6308289665","6051921859","1467409843","5994521633","6314129687","1233219695","6192879384","613005672","1856084605","1763022491","5963720478","5597875844","6366738184","6440632987","1302409727","174546033","6154903975","338272768","6013777126","6334034423","6326648397","2736917841","3805995068","5972746334","5321135613","2711504270","1962965223","1805094492","1066919257","1684198604","2395038590","6409906555","6409649997","5509491983","2465235860","6366912503","6366910758","6366908138","6363475874","6358282486","6034756770","6346793461","6228563483","5889291505","5947180050","6314610992","1727255213","5637985620","6260352032","6159347126","6192985170","5344269135","6092409157","536812318","6230973389","6363100744","6361047697","6360756716","3051705684","6192927394","5926707005","6241546845","6248198572","1744088025","2008263305","5139088886","1664601317","6211134078","6087759881","5963835800","579977091","6244129344","5937875381","5889052040","6298705325","5943352601","5915166157","3396111620","6399185719","2259046270","1322559837","2140648811","6256123580","6226738585","6303375445","6246942897","6208461688","6128576228","5869679535","2085023917","2056012941","6071847388","5754337710","3809881533","3606928064","1982777674","1925007231","1885031302","1548178705","1916156031","5123125865","1831148002","577831144","1001030201","5955370100","6053090563","5648649988","5866131053","5861126740","5815864126","5680079252","5669566855","5616920290","3306498653","2524077327","5963417687","6135021948","526524456","1043848755","5433246115","1786724722","1516635112","1390415034","1418537172","1770710823","1871872227","1157840023","1668004737","1651401295","5132310244","2943840497","2493413823","2591912834","1639936150","5527316346","6306879671","1504989897","1246667095","1781721243","2281038582","1824131445","1683631694","1065131250","1937071537","5023423913","2334328627","5648777504","1310757702","5993294572","3549070230","2065368141","2669132727","1043848755","1516635112","1390415034","1418537172","1770710823","1871872227","1157840023","1668004737","1651401295","5132310244","2943840497","2493413823","2591912834","1639936150","5527316346","6306879671","1504989897","1246667095","1781721243","2281038582","1824131445","1683631694","1065131250","1937071537","5023423913","2334328627"];return a.core.arr.indexOf($CONFIG.uid,b)>=0};b.canUploadCover=c;return b}});
STK.register("conf.trans.videoUpload",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("initUser",{url:"/aj/mblog/getuserattribute",method:"get"});c("getgroups",{url:"/aj/video/getuserplaylists",method:"get"});c("addAlbum",{url:"/aj/video/addplaylists",method:"get"});return b});
STK.register("lib.video.index",function(a){var b=a.conf.trans.videoUpload,c=a.lib.kit.extra.scrollMethod,d={weibo:{title:"上传普通视频：",subTitle:"请上传4GB以下的视频，请勿上传色情、反动等违法视频"},krcom:{title:"上传酷燃视频：",subTitle:"请上传时长大于2分钟的1080p或以上视频，违规内容无法过审"},vplus:{title:"上传付费视频：",subTitle:"付费视频可免费试看30秒，请上传时长在1-15分钟以内的视频，请勿上传色情、反动等违法视频"}},e={lenMax:"文件大小超过4G，请选择小于4G的文件上传",timeMin:"视频时长小于2分钟，请重新选择文件",vTimeMin:"视频时长小于1分钟，请重新选择文件",timeMax:"视频时长大于60分钟，请重新选择文件","1080p":"仅支持上传1080p或以上视频，请重新选择文件"};return function(f,g){g=a.parseParam({targetBtn:a.sizzle('a[action-type="video"]',f.nodeList.widget)[0],type:"weibo"},g||{});var h=d[g.type],i=[],j=[],k="",l='<li><div class="empty S_txt2">暂时没有专辑</div></li>',l="",m={},n={},o=!1,p=0,q=0,r=1,s=!0,t=!1,u=[],v='<div class="layer_sort_select" style="display:none;" node-type="sortLayer"><ul class="clearfix"><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{搞笑}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{时尚美妆}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{电视剧}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{娱乐综艺}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{电影}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{财经}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{情感两性}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{旅行}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{汽车}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{美食}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{教育}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{体育}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{运动健身}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{育儿}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{数码}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{动漫}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{军事}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{社会时政}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{音乐}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{舞蹈}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{游戏}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{动物宠物}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{科技}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{医疗健康}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{历史}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{美女}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{帅哥}</a></li><li><a class="sortItem" href="javascript:void(0);" action-type="selectSort">#L{其他}</a></li></ul></div>',w='<div class="W_layer W_layer_pop" node-type="outer"><div class="content"><div class="W_layer_close"><a href="javascript:void(0);" class="W_ficon ficon_close S_ficon" node-type="outerClose">X</a></div><div class="layer_send_video_v3 clearfix"><div class="W_layer_con_tit"><h1 class="W_f14 W_fb">#L{'+h.title+"}</h1>"+'<h2 class="S_txt2">#L{'+h.subTitle+"}</h2>"+"</div>"+'<div class="video_upbox" node-type="upload">'+'<dl node-type="uploading">'+'<dt class="clearfix">'+'<span class="loading_bar" node-type="loadingBar"><em></em></span>'+'<span class="W_fr"><a href="javascript:void(0);" class="S_txt1" node-type="cancelUpload">#L{取消上传}</a></span>'+"</dt>"+"<dd>"+'<p class="S_txt2"><span node-type="status">#L{上传准备中，请稍候}...</span><span class="sp1" node-type="uploadDetail"></span><a href="javascript:void(0);" node-type="reupload" style="display:none;">#L{重新上传}</a></p>'+"</dd>"+"</dl>"+'<dl node-type="uploadVideo" style="height:0px;overflow:hidden;position:relative;">'+"<dd>"+'<p class="btn"><a href="javascript:void(0);" class="W_btn_a btn_30px" node-type="uploadBtn">上传视频</a></p>'+"</dd>"+"</dl>"+'<dl node-type="uploaded" style="height:0px;overflow:hidden;position:relative;">'+'<dt class="clearfix">'+'<span class="W_fr"><a href="javascript:void(0);" class="a_ipt S_txt1" node-type="changeBtn"><em class="W_ficon ficon_reload S_ficon">ù</em>重新上传</a></span>'+"</dt>"+"<dd>"+'<div class="dd_succ">'+'<p class="ico"><span class="W_icon icon_succ"></span><span class="W_f14">视频上传成功！</span></p>'+'<p class="W_autocut S_txt2" node-type="fileName"></p>'+"</div>"+"</dd>"+"</dl>"+'<dl node-type="editCompleted" style="display:none;">'+'<dt class="clearfix">'+'<span class="W_fr"><a href="javascript:void(0);" class="a_ipt S_txt1" node-type="editBtn"><em class="W_ficon ficon_longwb S_ficon">s</em>编辑</a></span>'+"</dt>"+"<dd>"+'<div class="dd_succ">'+'<p class="pic_v2 pic_default"><img src="" alt=""><em class="W_ficon ficon_video">q</em></p>'+"</div>"+"</dd>"+"</dl>"+"</div>"+'<div class="video_iptbox" node-type="editBox">'+'<div class="form_table_s">'+'<dl class="f_normal clearfix" node-type="title">'+'<dt class="f_tit"><span class="S_spetxt" node-type="star" style="visibility:hidden;">*</span>#L{标题}</dt>'+'<dd class="f_con">'+'<div class="input_outer input_outer_default input_outer_only"><input type="text" class="W_input" placeholder="#L{简明扼要的标题可吸引更多观看}" action-type="inputTitle"><span class="sp1"><a href="javascript:void(0);" node-type="defaultTitle" action-type="setDefault">#L{默认标题}</a></span><span class="sp2"><a href="javascript:void(0);" action-type="delTitle"><em class="W_ficon ficon_close S_ficon">X</em></a></span></div>'+'<div class="tips clearfix"><span class="W_fl"><a href="javascript:void(0);" class="S_txt1" action-type="addTitle"><em class="W_ficon ficon_add S_ficon">+</em>#L{添加标题}</a><em class="S_txt2" node-type="titleCount">#L{（还可以添加2个）}</em></span><span class="W_fr S_txt2" node-type="countLimit">0/30</span></div>'+"</dd>"+"</dl>"+"{{common_program}}"+'<dl class="f_normal clearfix" node-type="sort">'+'<dt class="f_tit"><span class="S_spetxt"></span>#L{分类}</dt>'+'<dd class="f_con">'+'<div class="input_outer2"><input type="text" class="W_input" placeholder="#L{请选择分类}" readonly="readonly"><span class="sp1"><a href="javascript:void(0);" action-type="showSort"><em class="W_ficon ficon_arrow_down_lite S_ficon">g</em></a></span>'+v+"</div>"+"</dd>"+"</dl>"+'<dl class="f_normal clearfix" node-type="tags">'+'<dt class="f_tit"><span class="S_spetxt" style="visibility:'+(g.type=="weibo"?"hidden":"visible")+';">*</span>#L{标签}</dt>'+'<dd class="f_con">'+'<div class="input_outer3"><input type="text" class="W_input" placeholder="#L{输入相关标签，多个标签空格分隔}" node-type="inputDesc"><span class="sp1"><a href="javascript:void(0);" node-type="tagDesc"><i class="W_icon icon_askS"></i></a></span></div>'+'<div class="tag">#L{历史标签}</div>'+"</dd>"+"</dl>"+'<dl class="f_normal clearfix">'+'<dt class="f_tit">#L{封面}</dt>'+'<dd class="f_con">'+'<div class="vd_input S_bg1"><a href="javascript:void(0);" class="upbtn_v3" node-type="cover"><span>+</span><img style="display:none;"><em>#L{设置视频封面}</em></a></div>'+"</dd>"+"</dl>"+"</div>"+"</div>"+"</div>"+'<div class="W_layer_btn" node-type="btnBox"><a href="javascript:void(0);" class="W_btn_a W_btn_a_disable" node-type="completeBtn">完成</a></div>'+'<div class="W_layer_arrow"><span class="W_arrow_bor W_arrow_bor_t" node-type="arrow"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div>'+"</div>"+"</div>",x='<dl class="f_normal clearfix" node-type="program" > <dt class="f_tit">专辑</dt> <dd class="f_con">  <!--/所选专辑--><div class="input_outer4 {{isProgramDisabled}}" node-type="content_div"><input node-type="album_input" disabled="disabled" placeholder="优质的专辑会获得更多的曝光和推荐" type="text" class="W_input" readonly="readonly" style="position: absolute;"><div class="tagbox " style="min-height: 24px;" action-type="showProgram" node-type="scroll_program">   <div style="max-height: 80px">      <div node-type="add_Album" style="padding-right: 8px">'+l+"      </div>"+"   </div>"+"</div>"+'<span class="sp1" node-type="album_arrow_icon" action-type="showProgram"><a href="javascript:void(0);" ><em class="W_ficon ficon_arrow_down_lite S_ficon">g</em></a></span>'+'<span class="sp2"><a href="javascript:void(0);" action-type="program_tip"><i class="W_icon icon_askS"></i></a></span>'+'<div class="layer_menu_list"  node-type="album_layer" style="display: none" >'+"  <!--/专辑所有选项-->"+'  <div class="list_a " node-type="scroll_ablum" >'+'<div style="max-height:150px">'+'   <ul node-type="albumTemp" >'+k+"   </ul>"+"</div>"+"  </div>"+"  <!--/新建专辑-->"+'  <div class="opt_box S_line1">'+'    <ul node-type="newAblbum">'+'      <li><a href="javascript:void(0);"><em class="W_ficon ficon_add S_ficon">+</em>新建专辑</a></li>'+"    </ul>"+'    <div class="opt_inner" node-type="add_Newalbum" style="display:none;">'+'      <div class="tit W_fb">新建专辑</div>'+'      <div class="ipt"><input type="text" class="W_input" node-type="albumInput" placeholder="1-15个字"><span><em node-type="limitAlbumName">0</em>/<em>15</span></div>'+'      <div class="btn W_tc"><a href="javascript:void(0);" class="W_btn_a W_btn_a_disable" node-type="savaNewAlbum">确认</a> <a href="javascript:void(0);" node-type="closeNewAlbum" class="W_btn_b">取消</a></div>'+"    </div>"+"  </div>"+"</div>"+"   </div>"+"  </dd>"+"</dl>",y='<form node-type="form" action-type="form" name="uploadForm" enctype="multipart/form-data" method="post" style="overflow:hidden;opacity:0;filter:alpha(opacity=0);"><input node-type="fileInput" type="file" name="video" hidefoucs="true" title="#L{视频}" accept=".mpg,.m4v,.mp4,.flv,.3gp,.mov,.avi,.rmvb,.mkv,.wmv" style="cursor:pointer;width:1000px;height:1000px;position:absolute;bottom:0;right:0;font-size:200px;"/></form>',z="//js.t.sinajs.cn/t5/album/static/swf/video/WeiboUploader3.1.swf",A=4294967296,B=a.lib.kit.extra.language,C=a.sizzle('a[action-type="video"]',f.nodeList.widget)[0],D,E,F,G=!1,H=!window.File||!window.FileReader,I,J,K="upvideo_"+a.getUniqueKey(),L="fcb_"+K,M={ismcn:0,level:5,isPGC:!1,duration:"0",monitor:"1",isReal:!1},N,O,P,Q,R,S,T,U,V={},W=function(){var b;if(!H){if(!C||a.sizzle('form[name="uploadForm"]',g.targetBtn).length)return;F=g.type=="weibo"?"normal":g.type=="vplus"?"pay_limit":g.type;bg.initUploadDOM("publisher");a.custEvent.define(f,["disableVideo","enableVideo"]);a.custEvent.add(f,"disableVideo",function(){bg.disableInput("publisher",!0)});a.custEvent.add(f,"enableVideo",function(){bg.disableInput("publisher",!1)});b=setTimeout(function(){b&&clearTimeout(b);bg.ajaxLog()},600)}},X=function(){a.custEvent.add(f,"close",bi,{type:"publish"});a.addEvent(E.outer,"click",be.outerClick);a.addEvent(E.outerClose,"click",be.outerClose);a.addEvent(E.completeBtn,"click",be.completeBtnClick);a.addEvent(E.editBtn,"click",be.editBtnClick);a.addEvent(E.albumTemp,"click",be.addAlbum);a.addEvent(E.newAblbum,"click",be.newAblbumClick);a.addEvent(E.savaNewAlbum,"click",be.saveAblbumClick);a.addEvent(E.closeNewAlbum,"click",be.saveAblbumClose)},Y=function(b){var c="",d="input_outer2_disabled";b&&"isDisplayProgram"in b&&(c=x.replace(/{{isProgramDisabled}}|{{isDisabled}}/g,function(a){var c="";a=="{{isProgramDisabled}}"?c=b.isDisplayProgram?"":d:c=b.isDisplayProgram?"":"disabled";return c}));D=a.ui.bubble({template:B(w.replace(/{{common_program}}/g,c)),clickBlankToHide:!1,showWithAni:"fadeInDown:fast",hideWithAni:null,showWithSetWidth:!1});E=D.getDomList(!0);var e=f.nodeList.textEl;D.show().setArrow("top").setAlignPos(C,e,{refer:e,editor:f});D.on("hide",bj);X();r=1},Z=function(b){if(b.code==1e5){var c=b.data.playlists;k="";if(!c||!c.length){o=!0;k='<li><div class="empty S_txt2">暂时没有专辑</div></li>'}else{p=c.length;for(var d=0;d<c.length;d++)k+='<li><a href="javascript:void(0);"><label class="W_label" style="display: block;width: 262px;height: 20px;"><input node-type="addAlbum" type="checkbox" value="'+c[d].name+'" id="'+c[d].id+'" class="W_checkbox"><span>'+c[d].name+"</span></label></a></li>"}E.albumTemp.innerHTML="";a.addHTML(E.albumTemp,k);setTimeout(function(){if(p>5){m=a.ui.scrollView(E.scroll_ablum);c.length>=20&&a.addEvent(m.scrollEl,"scroll",bb)}},50)}},_=function(a){if(a.code==1e5){var b=a.data.playlists,c="";for(var d=0;d<b.length;d++){var c='<a href="javascript:void(0);"><label class="W_label" style="display: block;width: 262px;height: 20px;"><input node-type="addAlbum" type="checkbox" value="'+b[d].name+'" id="'+b[d].id+'" class="W_checkbox"><span>'+b[d].name+"</span></label></a>",e=document.createElement("li");e.innerHTML=c;E.albumTemp.appendChild(e)}m.reset()}},ba=function(){if(r===0)a.removeEvent(m.scrollEl,"scroll",bb);else if(s){s=!1;b.request("getgroups",{onSuccess:function(b){r===1?Z(b):r>1&&_(b);r=b.data.next_page;s=!0;b.data.is_star&&(t=b.data.is_star?!0:!1);q=0;if(E.albumTemp&&t){var c=a.sizzle("input[value=明星VLOG]",E.albumTemp)[0];c&&c.click&&c.click();c&&c.checked&&(q=1)}},onError:function(b){a.lib.dialog.ioError(b.code,b)}},{page:r})}},bb=c.throttle(function(){m&&m.scrollHeight()<=m.scrollTop()+m.offsetHeight()+150&&ba()},200,400),bc=function(b,c){a.custEvent.fire(f,"videoUploading");f.nodeList.textEl.setAttribute("data-video-status","uploading");f.API.getWords().length&&a.custEvent.fire(f,"textNum",{count:f.API.count()});D&&bg.ajaxLog("change");bg.initLog();if(!D){Y(c);P=a.lib.video.title(E.title,b,M);S=a.lib.video.tags(E.tags);Q=a.lib.video.sort(E.sort);R=a.lib.video.program(E.program);T=a.lib.video.cover(f,E.cover,C,{updateLog:bg.updateLog,disableCompleteBtn:bg.disableCompleteBtn,canPublish:bg.canPublish},M);H&&(window[L].flashUtils.setScreenshot=T.setScreenshot);if(c&&c.isDisplayProgram){ba();n=a.ui.scrollView(E.scroll_program)}}else{bg.resetCover();bg.resetProgram(c);H||O.setUploadStatus("init");bg.albumReset();u=[]}O&&O.destroy();H?O=a.lib.video.upload(E,J,!1,H,b,F,{canPublish:bg.canPublish,updateLog:bg.updateLog,ajaxLog:bg.ajaxLog,initUploadDOM:bg.initUploadDOM,resetProgram:bg.resetProgram,resetAlbum:bg.albumReset}):T.getScreenshot.byH5(I.files[0],function(c){O=a.lib.video.upload(E,I,c,H,b,F,{success:be.uploadSucceed,canPublish:bg.canPublish,updateLog:bg.updateLog,ajaxLog:bg.ajaxLog,initUploadDOM:bg.initUploadDOM,resetProgram:bg.resetProgram,resetAlbum:bg.albumReset})})},bd=function(a,b){bg.initUser(function(){bc(a,b)});M.isReal||bg.ajaxUserConf()},be={getVData:function(b,c){var d,f=window.URL.createObjectURL(b),h=a.C("video");a.setStyle(h,"visibility","hidden");document.body.appendChild(h);h.src=f;h.muted=!0;var i=function(d){a.removeEvent(h,"canplay",i);a.removeEvent(h,"error",j);var f=this,k=f.videoWidth,l=f.videoHeight,m=f.duration;a.removeNode(h);if(g.type=="vplus")m<=60&&m>0?bg.tipAlert(e.vTimeMin,c):bd(b.name);else{if(k>0&&l>0&&Math.min(k,l)<1080){bg.tipAlert(e["1080p"],c);return}if(m<120&&m>0){bg.tipAlert(e.timeMin,c);return}if(m>3600){bg.tipAlert(e.timeMax,c);return}bd(b.name)}},j=function(c){a.removeEvent(h,"canplay",i);a.removeEvent(h,"error",j);a.removeNode(h);bd(b.name)};a.addEvent(h,"canplay",i);a.addEvent(h,"error",j)},getCommonVideo:function(b){var c,d=window.URL.createObjectURL(b),e=a.C("video");a.setStyle(e,"visibility","hidden");document.body.appendChild(e);e.src=d;e.muted=!0;var f=function(c){a.removeEvent(e,"canplay",f);a.removeEvent(e,"error",g);var d=this,h=d.videoWidth,i=d.videoHeight,j=d.duration;a.removeNode(e);var k=Math.min(h,i)>=720&&j>=60;bd(b.name,{isDisplayProgram:k})},g=function(c){a.removeEvent(e,"canplay",f);a.removeEvent(e,"error",g);a.removeNode(e);bd(b.name,{isDisplayProgram:!0})};a.addEvent(e,"canplay",f);a.addEvent(e,"error",g)},clickInput:function(b){var c=a.fixEvent(b).target,d=c.getAttribute("action-type")=="video"?c:a.core.dom.dir.parent(c,{expr:"a[action-type=video]"})[0],e=f.nodeList.textEl,g=e.getAttribute("tid"),h=e.getAttribute("extra")&&a.queryToJson(e.getAttribute("extra")),i={msg:B("#L{确定放弃之前的视频，重新上传吗？}"),type:"ask",okCallback:function(){bg.resetData();if(H){bg.disableInput("publisher",!1);setTimeout(function(){},500)}else setTimeout(function(){c.click()},500)},hideCallback:function(){}};if(g&&h&&h.video_fid||g&&h&&h.pic_id){H||a.preventDefault(b);h.pic_id&&(i.msg=B("#L{确定放弃之前的图片吗？}"));bg.showComfirm(d,i)}},inputChange:function(a){if(!!a.target.value){var b=a.target.id.split("_")[0];bg.setFileElement(b);bg.disableInput(b,!0);var c=I.files[0];if(c.size>A){bg.tipAlert(e.lenMax,b);return}g.type=="krcom"||g.type=="vplus"?be.getVData(c,b):be.getCommonVideo(c)}},uploadSucceed:function(a){if(T){T.setCancelFlag(!1);T.getScreenshot.byXHR(a)}},outerClick:function(b){a.contains(E.sort,b.target||b.srcElement)||Q&&Q.hideSort();E.program&&!a.contains(E.program,b.target||b.srcElement)&&R&&R.hideProgram();a.addEvent(E.albumInput,"keyup",be.inputChanges);m.destroy&&m.reset();n.destroy&&n.reset();a.getStyle(E.album_layer,"display")=="none"&&a.setStyles(E.content_div,"border-color","rgb(204, 204, 204)")},outerClose:function(b){var c="确定放弃上传视频吗？";a.ui.tipConfirm(B("#L{"+c+"}")).ok(be.closeConfirm).beside(b.target||b.srcElement,{pos:"bottom-left",offsetX:-9,offsetY:-6})},closeConfirm:function(){D&&D.hide()},completeBtnClick:function(b){var c=b.target||b.srcElement;if(!a.hasClassName(c,"W_btn_a_disable")){var d=bg.canPublish();if(d!=!0){a.ui.alert(B("#L{"+(d=="uploading"?"正在上传视频，请稍候":d)+"}"),{icon:"warnB"});return}var e=a.sizzle("img",E.cover)[0].getAttribute("src"),g=a.sizzle("p.pic_v2",E.editCompleted)[0];a.removeClassName(g,"W_piccut_h");a.removeClassName(g,"W_piccut_v");if(e){a.sizzle("img",E.editCompleted)[0].src=e;a.removeClassName(g,"pic_default");var h=a.hasClassName(E.cover,"W_piccut_h")?"W_piccut_h":"W_piccut_v";a.addClassName(g,h)}else{a.sizzle("img",E.editCompleted)[0].removeAttribute("src");a.addClassName(g,"pic_default")}a.setStyles([E.editBox,E.btnBox],"display","none");a.setStyle(E.uploaded,"height","0px");a.setStyle(E.editCompleted,"display","block");f.nodeList.textEl.setAttribute("data-video-status","ready");if(f.API.getWords().length==0)f.API.insertText(a.sizzle(".input_outer_default input",E.title)[0].value);else{a.custEvent.fire(f,"textNum",{count:f.API.count()});f.API.focus()}}},editBtnClick:function(){a.setStyles([E.editBox,E.btnBox],"display","block");a.setStyle(E.uploaded,"height","auto");a.setStyle(E.editCompleted,"display","none");f.nodeList.textEl.setAttribute("data-video-status","editing");a.custEvent.fire(f,"textNum",{count:f.API.count()})},addAlbum:function(b){b.stopPropagation();var c=b.srcElement?b.srcElement:b.target,d=c.value;if(c.checked&&d){i.push(d);j.push(c.id);bg.arrAlbum(i);if(be.isStar(d)){u.push(c.value);a.conf.channel.feed.fire("addAlbumToTextEl",[u])}}else if(d){bg.removeByValue(i,d);bg.removeByValue(j,c.id);bg.arrAlbum(i);if(be.isStar(d)){var e=u.indexOf(d);e>-1&&u.splice(e,1);a.conf.channel.feed.fire("addAlbumToTextEl",[u])}}},isStar:function(a){if(t)return a==="明星制片人微计划"||a==="明星VLOG"||a==="idoltube"?!0:!1},newAblbumClick:function(){var b=a.getStyle(E.add_Newalbum,"display")=="none";be.controlAblum(b);E.albumInput.focus()},saveAblbumClick:function(c){var d=c.srcElement?c.srcElement:c.target;if(!a.hasClassName(d,"W_btn_a_disable")){var e=encodeURIComponent(E.albumInput.value.replace(/["]+/g,""));e&&b.request("addAlbum",{onComplete:function(b){if(b.code=="100000"){var c=b.data;i.push(c.name);++p;j.push(c.album_id.toString());bg.addalbumTemp(c.name,c.album_id.toString());bg.arrAlbum(i);be.controlAblum(!1);if(p>5)if(m.destroy){m.reset();m.scrollTop(1)}else{m=a.ui.scrollView(E.scroll_ablum);m.reset()}}else if(b.code=="26002")a.ui.notice(b.msg,{icon:"rederrorB",hideDelay:1e3});else{be.controlAblum(!1);a.ui.notice(b.msg,{icon:"rederrorB",hideDelay:1e3})}}},{name:e})}},saveAblbumClose:function(){be.controlAblum(!1)},controlAblum:function(b){E.albumInput.value="";E.limitAlbumName.innerHTML=0;a.addClassName(E.savaNewAlbum,"W_btn_a_disable");a.setStyles(E.add_Newalbum,"display",b?"block":"none");a.setStyles(E.newAblbum,"display",b?"none":"block")},inputChanges:function(b){var c=b.target,d=a.lib.video.commTool.getWordLengh(c.value);d===0?a.addClassName(E.savaNewAlbum,"W_btn_a_disable"):d>=1&&a.removeClassName(E.savaNewAlbum,"W_btn_a_disable");d>15&&(c.value=a.lib.video.commTool.strCut(c.value,30));d=a.lib.video.commTool.getWordLengh(c.value);E.limitAlbumName.innerHTML=d}},bf={restore:function(){var b=a.storage.get("editor_videolog"+$CONFIG.uid);return b!="null"&&b!=null&&b.length!=0?b:!1},store:function(b){a.storage.set("editor_videolog"+$CONFIG.uid,b)},delWord:function(){a.storage.del("editor_videolog"+$CONFIG.uid)}},bg={resetProgram:function(b){if(!!E&&!!E.program){if(b&&b.isDisplayProgram){E.content_div&&a.removeClassName(E.content_div,"input_outer2_disabled");E.content_div_input&&(E.content_div_input.style.disabled=!1)}else{E.content_div&&a.addClassName(E.content_div,"input_outer2_disabled");E.content_div_input&&(E.content_div_input.style.disabled=!0)}R&&R.reset()}},tipAlert:function(b,c){a.ui.alert(B("#L{"+b+"}"),{icon:"warnB",OK:function(){setTimeout(function(){I&&(I.value=null);bg.disableInput(c,!1)},300)}})},showComfirm:function(b,c){a.isNode(b)||a.log("target : parameter target is not a document node!");b=b||feedList;c=a.parseParam({msg:B("#L{确定放弃吗？}"),clickBlankToHide:!0,type:"ask",okCallback:function(){},hideCallback:function(){}},c);U&&U.anihide&&U.anihide();U=a.ui.tipConfirm(c.msg,c).beside(b,{appendTo:document.body}).ok(c.okCallback).cancel(c.hideCallback)},showAlert:function(){a.ui.alert(B("#L{请升级至新版浏览器以使用视频上传功能！}"),{icon:"warnB"}).ok(B("#L{我知道了}"))},initUploadDOM:function(b){var c=b+"_"+K,d=a.E(c);if(d)bg.resetUploadDOM(b);else{var e;switch(b){case"publisher":e=g.targetBtn;break;case"change":e=E.changeBtn;break;case"afterCancel":e=E.uploadBtn}var f=a.C("div");setTimeout(function(){var b=a.core.dom.getSize(e),c="position:absolute;left:0;top:0;display:block;overflow:hidden;background-color:#000;filter:alpha(opacity=0);-moz-opacity:0;opacity:0;";c+="width:"+(b.width||25)+"px;"+"height:"+(b.height||24)+"px;";f.style.cssText=c},100);e.appendChild(f);e.style.position="relative";var h=a.builder(B(y)).list,i=h.form[0],j=h.fileInput[0];j.id=c;f.appendChild(i);H?setTimeout(function(){bg.initFlash(c,b)},100):a.addEvent(j,"change",be.inputChange)}},resetUploadDOM:function(b){var c=a.E(b+"_"+K);!H&&c&&(c.value=null);bg.disableInput(b,!1)},initFlash:function(b,c){var d={data:z+"?interface="+L+"&type="+c,width:"100%",height:"100%",style:"position:absolute;top:0;left:0;",id:b},e={allowscriptaccess:"always",allowfullscreen:"true",wmode:"transparent",quality:"high",text:"分享视频"};a.lib.kit.extra.swfobject.createSWF(d,e,b);c=="publisher"&&(window[L]={flashUtils:bh})},initLog:function(){N={is_success:!1,file_type:"video",file_length:0,file_id:"",upload_id:"",upload_uuid:$CONFIG.uid+"."+a.getUniqueKey(),process_value:0,process_status:"load",file_token:"",createtype:"web",upload_length:0,upload_time:0,upload_speed:0,seg_num:0,networktype:"wifi",error_code:"",error_msg:"",start_date:0,end_date:0,bussiness_type:g.type,chunk_size:0,md5_time:0,discovery_time:0,init_time:0,check_time:0,dataupload_time:0,dataupload_speed:0,current_upload_length:0,uid:$CONFIG.uid,ua:navigator.userAgent,is_flash:H,extra:"init",cover_type:"default",screenshot_type:"fail",screenshot_time:0,is_screenshot_success:!1}},updateLog:function(b,c){c=="reupload"&&delete N.details;if(c=="details"){N.details=N.details||[];N.details.push(b)}else N=a.lib.kit.extra.merge(N,b);bf.store(a.jsonToStr(N))},ajaxLog:function(b){var c=bf.restore();if(!!c){if(b&&N){bg.updateLog({extra:b});c=bf.restore()}if(G)return;G=!0;a.jsonp({url:"//fileplatform.api.weibo.com/2/multimedia/post_log.json",args:{source:"2637646381",data:encodeURIComponent(c)},onComplete:function(a){a.result=="ok"&&bf.delWord();G=!1},onTimeout:function(a){G=!1}})}},initUser:function(c){b.request("initUser",{onComplete:function(b){if(b.code==1e5){var d=b.data;M=a.parseParam(M,d)}c&&c()},onFail:function(a){c&&c()}},{uid:window.$CONFIG&&$CONFIG.uid})},ajaxUserAbility:function(b){a.jsonp({url:"//api.weibo.com/users/show.json",args:{source:"2637646381",uid:$CONFIG.uid},onComplete:function(a){if(!a.error){var c=a.data.user_ability;c&&(c&256)>0&&(M.isPGC=!0)}b()},onTimeout:function(){b()}})},ajaxUserConf:function(){a.ajax({url:"/aj/multimedia/videoconf",args:{uid:$CONFIG.uid},timeout:2e3,onComplete:function(a){if(a.code==1e4||a.code==null){M.duration=a.data.duration_limit;M.monitor=a.data.monitor;M.isReal=!0}},onFail:function(){},onTimeout:function(){}})},disableInput:function(b,c){var d;b&&(d=a.E(b+"_"+K));H?d&&a.setStyle(d||J,"width",c?"0px":"100%"):d&&a.setStyle(d||I,"display",c?"none":"block")},disableCompleteBtn:function(b){b?a.addClassName(E.completeBtn,"W_btn_a_disable"):a.removeClassName(E.completeBtn,"W_btn_a_disable")},setExtra:function(){var b=["upload","title","sort","tags","cover"],c=[];a.foreach(b,function(a,b){if(E[a]){var d=E[a].getAttribute("action-data");d&&c.push(d)}});c.push("video_monitor="+M.monitor);g.type=="vplus"&&c.push("isPri=1");if(j){var d=j.join(",");c.push("album_ids="+d)}if(q&&E.albumTemp&&t){var e=a.sizzle("input[value=明星VLOG]",E.albumTemp)[0];e&&e.checked&&c.push("auto_add_topic=1")}f.API.addExtraInfo(c.join("&"))},resetData:function(){f.nodeList.textEl.removeAttribute("extra")},canPublish:function(){var b=!0,c=g.type!="krcom"?M.isPGC||M.ismcn||M.level<=3?["upload","title"]:["upload"]:["upload","title","tags"],d;a.foreach(c,function(a,c){if(!E[a].getAttribute("action-data")){d=a;b=!1;return!1}});if(b){bg.setExtra();bg.disableCompleteBtn(!1);f.nodeList.textEl.setAttribute("data-video-status","editing")}else{switch(d){case"upload":b="uploading";break;case"title":b="标题不能为空哦";break;case"sort":b="分类不能为空哦";break;case"tags":b="标签不能为空哦"}var e=b=="uploading";bg.disableCompleteBtn(e);f.nodeList.textEl.setAttribute("data-video-status",e?"uploading":"editing")}return b},resetCover:function(){T&&T.resetScreenshot()},cancelUpload:function(){O&&O.setCancelFlag(!0);T&&T.setCancelFlag(!0)},albumReset:function(){i=[];j=[];bg.arrAlbum(i);be.controlAblum(!1);a.foreach(a.sizzle("[node-type=addAlbum]",E.albumTemp),function(a){a.checked=!1})},setFileElement:function(b){b=="change"&&(H?a.contains(E.changeBtn,J)||J.cancelUpload():T&&T.setCancelFlag(!0));var c=b+"_"+K;H?J=a.E(c):I=a.E(c)},layerAlbum:function(){var b=E.content_div.offsetHeight+3;a.core.dom.setStyle(E.album_layer,"top",b+"px")},arrAlbum:function(b){l="";for(var c=0;c<b.length;c++)l+='<span class="sp3"><em class="W_ficon ficon_album S_ficon"></em><em class="W_autocut">'+b[c]+"</em></span>";a.setStyles(E.album_input,"display",b.length?"none":"block");E.add_Album.innerHTML="";a.addHTML(E.add_Album,l);bg.layerAlbum();if(parseInt(a.getStyle(E.add_Album,"height"))>75){a.setStyles(E.album_arrow_icon,"display","none");n.reset();n.scrollTop(1e3)}else{a.setStyles(E.album_arrow_icon,"display","block");n||n.destroy()&&n.destroy()}},addalbumTemp:function(a,b){var c='<a href="javascript:void(0);"><label class="W_label" style="display: block;width: 262px;height: 20px;"><input node-type="addAlbum" checked="checked" type="checkbox" value="'+a+'" id="'+b+'" class="W_checkbox"><span>'+a+"</span></label></a>",d=document.createElement("li");d.innerHTML=c;o&&(E.albumTemp.innerHTML="");o=!1;E.albumTemp.insertBefore(d,E.albumTemp.childNodes[0])},removeByValue:function(a,b){for(var c=0;c<a.length;c++)if(a[c]==b){a.splice(c,1);break}}},bh={showBubble:function(a,b){bg.setFileElement(b);bg.disableInput(b,!0);bd(a)},alert:function(b,c){a.ui.alert(B("#L{"+b+"}"),{icon:"warnB",OK:function(){setTimeout(function(){c&&D?D.hide():bg.disableInput(null,!1)},300)}})},getUserAgent:function(){return navigator.userAgent},outerClick:function(){a.fireEvent(C,"click")},updateLog:bg.updateLog,ajaxLog:bg.ajaxLog},bi=function(a){a&&a.data&&a.data.type=="publish"&&S.setLocalTags();if(D&&D.getState()){bg.ajaxLog("publish");D.hide()}},bj=function(){var b;D&&D.off("hide",bj);f&&a.custEvent.fire(f,"videoHided");f&&f.nodeList&&f.nodeList.textEl.removeAttribute("data-video-status");bg.resetData();bg.cancelUpload();bg.setFileElement("publisher");bg.resetUploadDOM("publisher");b=setTimeout(function(){b&&clearTimeout(b);bk()},100)},bk=function(){a.custEvent.remove(f,"close",bi);E&&E.outer&&a.removeEvent(E.outer,"click",be.outerClick);E&&E.completeBtn&&a.removeEvent(E.completeBtn,"click",be.completeBtnClick);E&&E.editBtn&&a.removeEvent(E.editBtn,"click",be.editBtnClick);E&&E.albumTemp&&a.removeEvent(E.albumTemp,"click",be.addAlbum);E&&E.newAblbum&&a.removeEvent(E.newAblbum,"click",be.newAblbumClick);E&&E.savaNewAlbum&&a.removeEvent(E.savaNewAlbum,"click",be.saveAblbumClick);E&&E.closeNewAlbum&&a.removeEvent(E.closeNewAlbum,"click",be.saveAblbumClose);E&&E.albumInput&&a.removeEvent(E.albumInput,"keyup",be.inputChanges);m&&m.scrollEl&&a.removeEvent(m.scrollEl,"scroll",bb);P&&P.destroy();Q&&Q.destroy();R&&R.destroy();S&&S.destroy();O&&O.destroy();T&&T.destroy();m||m.destroy()&&m.destroy();n||n.destroy()&&n.destroy();if(D){D.getState()&&D.hide();bg.ajaxLog("close");D.off("hide",bj);D.destroy()}O=null;T=null;D=null;i=[];j=[];r=1;s=!0;u=[]};if(a.lib.video.whiteList().canUploadCover()||(g.type=="krcom"?!0:!1))M.isPGC=!0;W();V.clear=function(){};V.preShow=function(b,c){if(!!c&&!D){c=c.split("|");var d=c[0];a.custEvent.fire(f,"disableVideo");Y();var e=a.sizzle("p.pic_v2",E.editCompleted)[0];if(d){a.sizzle("img",E.editCompleted)[0].src=d;a.removeClassName(e,"pic_default");var g=c[2]>0&&c[1]*9>=c[2]*16?"W_piccut_h":"W_piccut_v";a.addClassName(e,g)}else{a.sizzle("img",E.editCompleted)[0].removeAttribute("src");a.addClassName(e,"pic_default")}a.setStyles([E.editBox,E.btnBox],"display","none");a.setStyle(E.uploaded,"height","0px");a.setStyle(E.uploading,"display","none");a.setStyle(E.editBtn,"display","none");a.setStyle(E.editCompleted,"display","block");f.nodeList.textEl.setAttribute("data-video-status","ready");if(f.API.getWords().length==0)f.API.insertText(a.sizzle(".input_outer_default input",E.title)[0].value);else{a.custEvent.fire(f,"textNum",{count:f.API.count()});f.API.focus()}a.sizzle(".W_layer_con_tit .S_txt2",E.outer)[0].innerText=""}};V.show=function(a){H&&bg.showAlert()};V.hide=bi;V.destroy=bk;return V}});
STK.register("lib.publisher.widget.video",function(a){var b=a.lib.kit.extra.language,c=a.lib.video.index,d=!window.File||!window.FileReader,e=$CONFIG.isKrMember==1?!0:!1,f=$CONFIG.isVmember==1?!0:!1,g='<div class="W_layer W_layer_pop"><div class="content"><div class="W_layer_title"><div class="W_layer_close"><a href="javascript:void(0);" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div></div><div class="layer_send_pic" node-type="inner"><div class="layer_send_btn clearfix"><ul class="clearfix">'+(f?'<li class="S_line2'+(e?" li_s4":"")+'"><a href="javascript:void(0);" class="W_btn_l" node-type="vUpload" action-type="vPlus_upload"><span class="btn_45px"><em class="W_ficon ficon_vplus_v2 S_ficon"></em>#L{付费视频}</span></a></li>':"")+(e?'<li class="S_line2'+(f?" li_s4":"")+'"><a href="javascript:void(0);" class="W_btn_l" node-type="krUpload" action-type="krcom_upload" action-data="url=http%3A%2F%2Fkrcom.cn%2Fupload"><span class="btn_45px"><em class="W_ficon ficon_krvideo S_ficon"></em>#L{酷燃视频}</span></a></li>':"")+'<li class="S_line2'+(e&&f?" li_s4":"")+'"><a href="javascript:void(0);" class="W_btn_l" node-type="upload" action-type="weibo_upload"><span class="btn_45px"><em class="W_ficon ficon_video S_ficon">q</em>#L{普通视频}</span></a></li>'+"</ul>"+"</div>"+"</div>"+'<div class="W_layer_arrow"><span class="W_arrow_bor" node-type="arrow"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div>'+"</div>"+"";return function(h){var i,j,k,l,m,n={},o={},p,q,r,s,t;t={showAlert:function(){a.ui.alert(b("#L{请升级至新版浏览器以使用视频上传功能！}"),{icon:"warnB"}).ok(b("#L{我知道了}"))},uploading:function(){l&&l();a.custEvent.fire(h,"disableMulti")},hided:function(){l&&l();!a.objIsEmpty(n)&&s.destroy();m&&m.destroy&&m.destroy();a.custEvent.fire(h,"enableMulti")},hide:function(){i&&i.off("hide",t.hide);t.hided()}};s={jumpUrl:function(a){var b=a.data,c=b.url&&decodeURIComponent(b.url);window.open(c,"_blank");t.hide()},build:function(d,e){var f;i&&i.destroy();i=a.ui.bubble({template:b(g),clickBlankToHide:!0,showWithAni:"fadeInDown:fast",hideWithAni:"fadeOutUp:fast",showWithSetWidth:!1});i.show().setArrow("top").setAlignPos(d,e.refer,e);l=function(){i.stopBoxClose();i.getBox().style.marginLeft="-2000px"};i&&i.on("hide",t.hide);a.custEvent.define(h,["videoUploading","videoHided"]);a.custEvent.add(h,"videoUploading",t.uploading);a.custEvent.add(h,"videoHided",t.hided);a.custEvent.add(h,"close",t.hide);f=i.getDomList();n.vplus=f.vUpload&&c(h,{targetBtn:f.vUpload,type:"vplus"});j.add("krcom_upload","click",s.jumpUrl);n.weibo=f.upload&&c(h,{targetBtn:f.upload,type:"weibo"})},show:function(b){if(!h.nodeList.textEl.getAttribute("data-video-status")){if(d){t.showAlert();return}var c,e,f=b.el;a.contains(h.nodeList.widget,f)?c=f:c=h.nodeList.more;e=h.nodeList.textEl;s.build(c,{refer:e,editor:h})}},preShow:function(){var a=arguments[0],b=arguments[1],c=arguments[2];!e&&!f?m.preShow&&m.preShow(a,b):n[c].preShow&&n[c].preShow(a,b)},destroy:function(){if(i){i.getState()&&i.hide();i.off("hide",t.hide);i.destroy();i=null}j.remove("krcom_upload","click",s.jumpUrl);j&&j.destroy&&j.destroy();a.custEvent.undefine(h,["videoUploading","videoHided"]);a.custEvent.remove(h,"videoUploading",t.uploading);a.custEvent.remove(h,"videoHided",t.hided);a.custEvent.remove(h,"close",t.hide);m&&m.destroy&&m.destroy();if(!a.objIsEmpty(n)){a.foreach(n,function(a,b){a&&a.destroy&&a.destroy()});n={}}}};p=function(){k=a.sizzle('a[action-type="video"]',h.nodeList.widget)[0];j=a.delegatedEvent(h.nodeList.wrap)};q=function(){if(!e){if(f)return;m=k&&c(h,{targetBtn:k,type:"weibo"});a.custEvent.define(h,["videoUploading","videoHided"]);a.custEvent.add(h,"videoUploading",t.uploading);a.custEvent.add(h,"videoHided",t.hided);a.custEvent.add(h,"close",t.hide)}};r=function(){p();q()};r();o.show=e||f?s.show:m&&m.show;o.hide=t.hide;o.preShow=s.preShow;o.destroy=s.destroy;return o}});
STK.register("lib.kit.dom.children",function(a){return function(b){if(!a.core.dom.isNode(b))throw"Parameter must be an HTMLEelement!";var c=[];for(var d=0,e=b.childNodes.length;d<e;d++)b.childNodes[d].nodeType==1&&c.push(b.childNodes[d]);return c}});
STK.register("conf.trans.media",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("parseVideo",{url:"/aj/mblog/video"});c("suggestMusic",{url:"/aj/mblog/music/suggest",requestMode:"jsonp"});c("searchMusic",{url:"//music.weibo.com/t/port/ajax_search_music_song.php",method:"get",requestMode:"jsonp"});c("addMusic",{url:"/aj/mblog/music/submit",requestMode:"jsonp"});c("parseMusic",{url:"/aj/mblog/music/parse",requestMode:"jsonp"});c("favSongSearch",{url:"//music.weibo.com/yueku/port/sina_t_getcollect.php",method:"get",requestMode:"jsonp"});c("getOutlinkInfo",{url:"//api.weibo.com/widget/info.json",varkey:"callback",method:"get",requestMode:"jsonp"});c("tabLog",{url:"//music.weibo.com/t/port/ajax_log_action.php",method:"get",requestMode:"jsonp"});c("videoThirdUrl",{url:"/aj/video/gettoken",method:"get"});return b});
STK.register("lib.media.publishMusicBubble",function(a){var b=window.$CONFIG&&window.$CONFIG.version,c='<div class="layer_send_music" node-type="outer"><div node-type="inner"><div node-type="tabs"><div class="profile_tab S_line5"><ul class="pftb_ul layer_tab S_line1"><li class="pftb_itm S_line1"><a class="pftb_lk current S_line5 S_txt1 S_bg5" action-type="tab" node-type="tab1" href="javascript:void(0);">#L{搜索歌曲}</a></li><li class="pftb_itm S_line1"><a class="pftb_lk S_line5 S_txt1 S_bg1" action-type="tab" node-type="tab2" href="javascript:void(0);">#L{喜欢的歌}</a></li><li class="pftb_itm pftb_itm_lst S_line1"><a href="javascript:void(0);" class="pftb_lk S_line5 S_txt1 S_bg1" action-type="tab" node-type="tab3">#L{输入音乐链接}</a></li><span style="float:left" node-type="miniplayer"></span></p></div><div node-type="content"><div node-type="tab1-block" class="laMed_border" ><div class="laMed_inp"><input type="text" autocomplete="off" style="color: rgb(153, 153, 153);" value="#L{请输入歌曲、歌手、专辑名}" class="W_input inp_music" node-type="songInput"><a class="W_btn_b" href="javascript:void(0);" onclick="return false;" node-type="nameSearch"><span>#L{搜索}</span></a><div style="display:none" class="layer_menu_list" node-type="suggestLay"></div><p style="display: none;" node-type="searchError" class="laMed_err S_error">#L{抱歉，没有找到和}"<span node-type="searchKey"></span>"#L{有关的歌曲，换个词再试一下}</p></div><div class="laMed_titS" node-type="searchRusult" style="display:none">#L{搜索结果}：</div><div class="laMed_mulist" node-type="songList" style="display:none"></div></div><div node-type="tab2-block" class="laMed_border" style="display:none"><div node-type="favRusult" class="laMed_titS" style="display:none">#L{我有}<a class="W_fb" href="http://music.weibo.com/ting/?musicpublisher=1#like" target="_blank" node-type="favSongCount">199</a>#L{首喜欢的歌}<i>(在<a href="http://ting.weibo.com?musicpublisher=2" target="_blank">#L{微博音乐盒}</a>#L{标记为红心})</i></div><div class="laMed_mulist" node-type="favSongList" style="display:none"></div><div class="W_pages_minibtn" node-type="favPagingBar" style="display:none"></div><p class="no_music" node-type="favNoSongs" style="display:none">#L{你还没有标记为喜欢的歌，快去} <a href="http://ting.weibo.com?musicpublisher=3" target="_blank">#L{微博音乐盒}</a> #L{听听}</p></div><div node-type="tab3-block" class="laMed_border" style="display:none"><div class="laMed_con S_txt2">#L{目前已支持}<a href="http://music.sina.com.cn/" target="_blank" class="S_link2">#L{新浪乐库}</a>、<a class="S_link2" href="http://www.kuwo.cn/" target="_blank">#L{酷我音乐}</a>、<a class="S_link2" href="http://www.songtaste.com/" target="_blank">#L{Songtaste}</a> #L{的播放页面链接，也支持MP3格式歌曲链接。}</div><div class="laMed_inp"><input action-type="inputAction" type="text" style="color: rgb(153, 153, 153);" node-type="linkInput" value="#L{请输入MP3链接或新浪乐库单曲播放页链接}" class="W_input inp_music"><a class="W_btn_b" onclick="return false;" node-type="searchLink" href="javascript:void(0)"><span>#L{搜索}</span></a><p node-type="linkError" style="display: none;" class="laMed_err S_error">#L{没有识别出相应的歌曲信息}</p><p node-type="linkOptional" style="display: none;" class="laMed_err"><a href="javascript:void(0)" action-type="normalLink">#L{作为普通的链接发布}</a>&nbsp;#L{或}&nbsp;<a href="javascript:void(0)" action-type="closeLayer">#L{取消操作}</a></p></div><div class="laMed_titS" node-type="integrity" style="display:none">#L{为了更好的分享音乐，请花一点时间完善歌曲资料}</div><div class="laMed_muinfo" node-type="songInfo" style="display:none"></div></div></div></div></div></div>',d='<#et tname data><ul><#list data.music_list as list><li action-type="songItem" action-data="index=${list_index}" songKeyWord="${list.title}"><a onclick="return false" href="javascript:void(0);">${list.title}</a></li></#list></ul></#et>',e='<#et tname data><ol><li><span class="mu_song">#L{歌曲名}</span></li><li><span class="mu_songer">#L{歌手名}</span></li><li><span class="mu_album">#L{专辑名}</span></li><li><span class="mu_play">#L{试听}</span></li></ol><ul><#list data.music_list as list><li artist="${list.artist}" title="${list.stitle}" mp3_url="${list.mp3_url}" ><div class="mu_name" action-type="song"><span class="mu_song" title="${list.title}"><span>${list.show_title}</span><em class="mu_icon_new" style="display:${list.isnew}"></em></span><span class="mu_songer" title="${list.artist}">${list.show_artist}</span><span class="mu_album" title="${list.album}">${list.show_album}</span></div><div class="W_ico16 icon_toplay" songUrl="${list.mp3_url}" action-type="player"><span></span></div></li></#list></ul></#et>',f='<table><tbody><tr><th><em class="S_spetxt">*</em>#L{歌曲名}</th><td><input type="text" value="" node-type="songName" class="W_input"></td></tr><tr><th>#L{演唱者}</th><td><input type="text" value="" node-type="artist" class="W_input"></td></tr><tr class="laMed_err S_error"><th></th><td><span class="S_error" node-type="errorSongName" style="display:none"></span></td></tr><tr class="laMed_btn"><th></th><td><a href="javascript:void(0);" class="W_btn_b" action-type="addSong"><span>#L{添加}</span></a></td></tr></tbody></table>',g='<#et tname data><ul><#list data.music_list as list><li artist="${list.artist}" title="${list.title}" mp3_url="${list.mp3_url}"><div class="mu_name" action-type="favsong">${list.title}</div><div class="W_ico16 icon_toplay" songUrl="${list.mp3_url}" action-type="player" ><span></span></div></li></#list></ul></#et>',h='<a action-type="favSongPage" action-data="num=#{number}" class="page S_bg1" href="javascript:;" onclick="return false;">#{label}</a>',i='<a action-data="num=#{number}" href="javascript:;" class="page S_txt1"  onclick="return false;">#{label}</a>',j='<a class="reverse" action-type="favPagPrev" href="javascript:;" onclick="return false;"></a>',k='<a class="next" action-type="favPagNext" href="javascript:;" onclick="return false;"></a>',l,m,n,o,p,q,r,s,t,u,v,w,x,y=-1,z,A,B,C=$CONFIG.jsPath,D=a.lib.kit.extra.language,E={songInput:D("#L{请输入歌曲、歌手、专辑名}"),linkInput:D("#L{请输入MP3链接或新浪乐库单曲播放页链接}"),songError:D("#L{歌曲名不能超过15个汉字}"),artistError:D("#L{演唱者不能超过15个汉字}"),interError:D("#L{接口错误}")},F={searchTab:{idx:0,logstatus:!1,logfn:function(){N.tabLog.request({coflag:500010,action:"search_click"});this.logstatus=!0}},favTab:{idx:1,logstatus:!1,logfn:function(){N.tabLog.request({coflag:500010,action:"collect_click"});this.logstatus=!0}},linkTab:{idx:2,logstatus:!1,logfn:function(){N.tabLog.request({coflag:500010,action:"link_click"});this.logstatus=!0}}},G={},H=a.conf.trans.media.getTrans,I=a.core.str.trim,J=a.core.util.easyTemplate,K=a.core.evt.preventDefault,L=function(){l=a.lib.kit.dom.parseDOM(a.core.dom.builder(D(c)).list);p=l.outer;n=a.ui.bubble();n.setArrow({style:"left:82px;"});U();a.custEvent.add(n,"hide",function(b){return function(){b.setArrow({style:"left:30px;"});a.custEvent.remove(b,"hide",arguments.callee);a.custEvent.fire(G,"hide",{});var c=a.sizzle("object,embed",l.miniplayer)[0];a.lib.face.destroyFlash(c);B=!1;s=null;x=null;window.origin_miniplayer_music=undefined}}(n));!F.searchTab.logstatus&&F.searchTab.logfn()},M={currentPage:0,maxShowPage:6,limit:10},N={suggestMusic:H("suggestMusic",{onSuccess:function(a){a.data&&O.rendSugg(a)}}),searchMusic:H("searchMusic",{onSuccess:function(a){O.rendList(a)},onError:function(){O.rendError()}}),parseMusic:H("parseMusic",{onSuccess:function(a){O.rendInfo(a)},onComplete:function(a){a.code!="100000"&&O.urlError(a)}}),addMusic:H("addMusic",{onSuccess:function(a){O.urlSucc(a)},onError:function(){var b=a.sizzle('[node-type="errorSongName"]',l.outer)[0];b.innerHTML=E.interError}}),favSongSearch:H("favSongSearch",{onSuccess:function(a){O.rendFavList(a)}}),getOutlinkInfo:function(a){return H("getOutlinkInfo",{onComplete:function(b){b.code=="1"&&O.listenOutLinkSong(a,b)}})},tabLog:H("tabLog")},O={rendSugg:function(b){var c=l.suggestLay,e,f=b.data;if(b.key==z&&f!==null){for(var g=0,h=f.music_list.length;g<h;g++)f.music_list[g].title=a.leftB(f.music_list[g].title,30);e=J(d,f);c.innerHTML=e;P.showSugg();l.suggestList=a.sizzle('[action-type="songItem"]',c)}},rendError:function(){var b=I(l.songInput.value);b=a.bLength(b)>25?a.leftB(b,25)+"...":b;P.clean();a.core.dom.insertHTML(l.searchKey,a.encodeHTML(b));a.setStyle(l.searchError,"display","");P.hideSugg()},rendList:function(b){var c=l.songList,d,f=b.data,g;P.clean();P.hideSugg();g=f.music_list;for(var h=0;h<g.length;h++){g[h].stitle=[g[h].title,g[h].artist,g[h].album].join("-");a.bLength(g[h].title)>13?g[h].show_title=[a.leftB(g[h].title,13),"..."].join(""):g[h].show_title=g[h].title;a.bLength(g[h].artist)>7?g[h].show_artist=[a.leftB(g[h].artist,7),"..."].join(""):g[h].show_artist=g[h].artist;a.bLength(g[h].album)>9?g[h].show_album=[a.leftB(g[h].album,9),"..."].join(""):g[h].show_album=g[h].album;a.bLength(g[h].stitle)>40&&(g[h].stitle=[a.leftB(g[h].stitle,40),"..."].join(""));g[h].isnew=g[h]["new"]?"":"none"}d=J(D(e),f).toString();c.innerHTML=d;a.setStyle(l.searchRusult,"display","");a.setStyle(l.songList,"display","");a.setStyle(c,"display","")},rendInfo:function(b){var c=a.core.dom.builder(D(f)),d=l.songInfo,e=c.list.artist[0],g=c.list.songName[0],h=b.data.artist?b.data.artist:"",i=b.data.title?b.data.title:"";d.innerHTML="";d.appendChild(c.box);g.value=i;e.value=h;Q.clean();a.setStyle(l.integrity,"display","");a.setStyle(d,"display","")},urlError:function(b){Q.clean();a.setStyle(l.linkError,"display","");a.setStyle(l.linkOptional,"display","")},urlSucc:function(b){var c=b.data.text;a.custEvent.fire(G,"insert",{value:c});Q.clean();n.hide()},favTabClick:function(a){if(a=="tab2"&&!B){B=!0;P.favSong(0)}a=="tab1"&&!F.searchTab.logstatus?F.searchTab.logfn():a=="tab2"&&!F.favTab.logstatus?F.favTab.logfn():a=="tab3"&&!F.linkTab.logstatus&&F.linkTab.logfn()},setFavPagingBar:function(b){function m(b,c){b.push("...");b.push(a.templet(h,{number:c-1,label:c}))}function g(b){b.push(a.templet(h,{number:0,label:1}));b.push("...")}function f(b,d,e){for(var f=d;f<e;f+=1)c==f?b.push(a.templet(i,{number:f,label:f+1})):b.push(a.templet(h,{number:f,label:f+1}))}var c=M.currentPage,d=l.favPagingBar,e=[];if(b<=M.maxShowPage+2)f(e,0,b);else if(M.currentPage<M.maxShowPage/2+1){f(e,0,M.maxShowPage);m(e,b)}else if(M.currentPage+(M.maxShowPage/2+1)>=b){g(e);f(e,b-M.maxShowPage,b)}else{g(e);f(e,M.currentPage-(M.maxShowPage/2-1),M.currentPage+(M.maxShowPage/2-1)+1);m(e,b)}if(b>1){e.unshift(a.templet(j));e.push(a.templet(k))}d.innerHTML=e.join("")},rendFavList:function(b){var c=l.favSongList,d=l.favSongCount,e,f=b.data,h,i,j;h=f.music_list;i=f.music_num;j=Math.ceil(i/M.limit);M.totalPage=j;if(h.length<1){a.setStyle(l.favNoSongs,"display","");a.setStyle(l.favSongList,"display","none");a.setStyle(l.favRusult,"display","none");a.setStyle(l.favPagingBar,"display","none")}else{for(var k=0;k<h.length;k++){h[k].title=[h[k].title,h[k].artist].join("-");a.bLength(h[k].title)>40&&(h[k].title=[a.leftB(h[k].title,40),"..."].join(""))}e=J(g,f);c.innerHTML=e;d.innerHTML=i;O.setFavPagingBar(j);a.setStyle(l.favSongList,"display","");a.setStyle(l.favRusult,"display","");a.setStyle(l.favPagingBar,"display","");a.setStyle(l.favNoSongs,"display","none");a.setStyle(c,"display","")}},listenOutLinkSong:function(a,b){x.setUrl(b.data[a].songurl)}},P={focus:function(b){var c=a.fixEvent(b).target,d=I(c.value),e=d==E.songInput||d===""?!1:!0;clearTimeout(v);e?I(l.suggestLay.innerHTML)!==""&&P.showSugg():c.value=""},blur:function(b){var c=a.fixEvent(b).target,d=I(c.value),e=d===""||d==E.songInput?!1:!0;e||(c.value=E.songInput);clearTimeout(v);v=setTimeout(P.hideSugg,1e3)},keyhandler:function(a){a.keyCode==13&&setTimeout(P.search,0);a.keyCode==27&&P.hideSugg()},setSuggestLayPos:function(){var b=a.lib.kit.dom.parseDOM(a.builder(n.getOuter()).list).layoutContent,c=a.core.dom.getSize(l.songInput),d=a.position(b),e=a.position(l.songInput),f=e.l-d.l,g=e.t-d.t+c.height-1;a.setStyle(l.suggestLay,"left",f+"px");a.setStyle(l.suggestLay,"top",g+"px")},showSugg:function(){y=-1;P.setSuggestLayPos();a.setStyle(l.suggestLay,"display","");a.custEvent.fire(A,"open",l.songInput);a.addEvent(document,"click",P.hideSugg)},hideSugg:function(b){var c=b?a.core.evt.fixEvent(b).target:null,d=l.suggestLay,e=l.songInput;if(c&&(c==e||a.core.dom.contains(d,c)))return!1;y>-1&&l.suggestList&&l.suggestList[y]&&a.removeClassName(l.suggestList[y],"cur");a.setStyle(d,"display","none");a.custEvent.fire(A,"close");a.removeEvent(document,"click",P.hideSugg)},goSugg:function(b){var c=l.songInput,d=I(c.value);clearTimeout(u);if(d!=E.songInput&&d!=r){if(d===""){P.hideSugg();return}l.suggestLay.innerHTML="";a.setStyle(l.suggestLay,"display","none");u=setTimeout(function(){z=a.core.util.getUniqueKey();N.suggestMusic.request({key:d,_k:z});r=d},200)}},searchChoose:function(a,b){var c=l.songInput,d,e;if(y>=0){d=l.suggestList[b];e=d.getAttribute("songkeyword");c.value=e;r=e}},search:function(){var a=l.songInput,b=I(a.value);if(b!==""&&b!=E.songInput){x&&x.songStop&&x.songStop();window.setTimeout(function(){N.searchMusic.request({key:b,isred:!1});t=b},0)}},clean:function(){var b=l.searchError,c=l.searchRusult,d=l.songList;r="";d.innerHTML="";l.searchKey.innerHTML="";a.setStyle(b,"display","none");a.setStyle(c,"display","none")},add:function(a){var b=a.el.parentNode,c=b.getAttribute("mp3_url"),d=b.getAttribute("title"),e=b.getAttribute("artist");K();N.addMusic.request({url:c,title:d,artist:e})},setIndex:function(b,c){var d;if(y>=0){d=l.suggestList[y]?l.suggestList[y]:null;d.parentNode&&d.parentNode.nodeType!=11&&a.removeClassName(d,"cur")}l.suggestList[c]&&a.addClassName(l.suggestList[c],"cur");y=c},controlSong:function(a){var b=a.el;w&&w!=b&&(w.className="W_ico16 icon_toplay");w=b;b.className!="W_loading"&&(b.className=="W_ico16 icon_toplay"?S.playSong(b):b.className=="W_ico16 icon_tostop"&&S.pauseSong())},addfavSong:function(b){var c=b.el.parentNode,d=c.getAttribute("mp3_url"),e=c.getAttribute("title"),f=c.getAttribute("artist");K();if(d.indexOf("http://t.cn")>=0){var g=e+"-"+d;a.custEvent.fire(G,"insert",{value:g});n.hide()}else N.addMusic.request({url:d,title:e,artist:f})},favSong:function(a){M.currentPage=Math.floor(a/M.limit);N.favSongSearch.request({start:a,limit:M.limit})},favSongPage:function(b){a.preventDefault(b.evt);P.favSong(b.data.num*M.limit)},favSongPrev:function(){a.preventDefault();if(!(M.currentPage<1)){M.currentPage--;P.favSong(M.currentPage*M.limit)}},favSongNext:function(){a.preventDefault();if(!(M.currentPage>=M.totalPage-1)){M.currentPage++;P.favSong(M.currentPage*M.limit)}},getOutlinkInfo:function(a){N.getOutlinkInfo(a).request({short_url:a,source:"872034675"})}},Q={focus:function(b){var c=a.fixEvent(b).target,d=I(c.value),e=d==E.linkInput||d===""?!1:!0;e||(c.value="");c.select()},blur:function(b){var c=a.fixEvent(b).target,d=I(c.value),e=d===""||d==E.linkInput?!1:!0;e||(c.value=E.linkInput)},clean:function(){a.setStyle(l.integrity,"display","none");a.setStyle(l.songInfo,"display","none");a.setStyle(l.linkError,"display","none");a.setStyle(l.linkOptional,"display","none")},addSong:function(){var b=I(a.sizzle('[node-type="songName"]',l.outer)[0].value),c=I(a.sizzle('[node-type="artist"]',l.outer)[0].value),d=I(l.linkInput.value),e=a.sizzle('[node-type="errorSongName"]',l.outer)[0];K();if(b===""){e.innerHTML=E.songInput;a.setStyle(e,"display","")}else{if(a.bLength(b)>30){e.innerHTML=E.songError;a.setStyle(e,"display","");return}if(a.bLength(c)>30){e.innerHTML=E.artistError;a.setStyle(e,"display","");return}N.addMusic.request({title:b,url:d,artist:c})}},search:function(){var a=I(l.linkInput.value);if(a!==""&&a!==E.linkInput){N.parseMusic.request({url:a});K()}},normal:function(){var b=I(l.linkInput.value);a.custEvent.fire(G,"insert",{value:b+" "});T.closeLayer()}},R=function(b,c){var d;if(c=="buffer"||c=="playing"){c=="playing"?d="W_ico16 icon_tostop":c=="buffer"&&(d="W_loading");a.core.dom.isNode(w)&&(w.className=d)}},S={init:function(){var c=l.miniplayer,d=a.getUniqueKey();window.origin_miniplayer_music=R;x=a.core.util.swf.create(c,C+"/home/static/swf/player/MiniPlayer.swf?version="+b,{id:d,flashvars:{statusListener:"origin_miniplayer_music"},paras:{quality:"high",allowScriptAccess:"always",wmode:"transparent",allowFullscreen:!0},attrs:{name:d}})},playSong:function(a){var b=a.getAttribute("songUrl");if(b==s)x.songPlay();else if(x&&x.setUrl){if(b.indexOf("http://t.cn/")>=0){var c=b.replace("http://t.cn/","");P.getOutlinkInfo(c)}else x.setUrl(b);s=b}},pauseSong:function(){w.className="W_ico16 icon_toplay";x.songStop()}},T={closeLayer:function(){n.hide()}},U=function(){var b=a.core.evt.delegatedEvent(l.outer);a.custEvent.define(G,"insert");a.custEvent.define(G,"hide");b.add("player","click",P.controlSong);b.add("addSong","click",Q.addSong);b.add("normalLink","click",Q.normal);b.add("closeLayer","click",T.closeLayer);b.add("song","click",P.add);b.add("favsong","click",P.addfavSong);b.add("favSongPage","click",P.favSongPage);b.add("favPagPrev","click",P.favSongPrev);b.add("favPagNext","click",P.favSongNext);a.addEvent(l.songInput,"focus",P.focus);a.addEvent(l.songInput,"blur",P.blur);a.addEvent(l.songInput,"keyup",P.goSugg);a.addEvent(l.songInput,"keydown",P.keyhandler);a.addEvent(l.nameSearch,"click",P.search);a.addEvent(l.linkInput,"focus",Q.focus);a.addEvent(l.linkInput,"blur",Q.blur);a.addEvent(l.searchLink,"click",Q.search);var c=a.ui.mod.tab({templete:l.outer,currentTab:"tab1"});a.custEvent.add(c,"tabIn",function(b,c){a.foreach(a.lib.kit.dom.children(l.content),function(a,b){a.style.display=a.getAttribute("node-type")==c+"-block"?"":"none"});O.favTabClick(c)});A=a.ui.mod.suggest({textNode:l.songInput,uiNode:l.suggestLay,actionType:"songItem",actionData:"index"});a.custEvent.add(A,"onIndexChange",P.setIndex);a.custEvent.add(A,"onSelect",P.searchChoose);setTimeout(S.init,100)};return function(b,c){L();if(!a.isNode(b))throw"common.bubble.music need el as first parameter!";n.setContent(p);n.setAlignPos(b,c.refer,{fail:function(){n.setLayout(b,{offsetX:-77,offsetY:5})}});n.show();G.hide=n.hide;return G}});
STK.register("lib.publisher.widget.music",function(a){return function(b){var c={},d,e,f,g,h=function(c,d){var e=d.value+" ",g=b.nodeList.textEl,h=g.value,i=e.length-2;if(h.indexOf(e)!=-1){var j=h.indexOf(e);a.lib.kit.extra.textareaUtils.setCursor(g,j+1,i)}else b.API.insertText(e,f);var k=b.API.getCurrentLogType();b.API.addShortUrlLog(k)},i=!1,j=function(e){i=!1;d=a.lib.media.publishMusicBubble(g,{refer:b.nodeList.textEl});a.custEvent.add(d,"insert",h);a.custEvent.add(b,"close",c.hide);a.custEvent.add(d,"hide",function(){a.custEvent.remove(d,"hide",arguments.callee);a.custEvent.remove(d,"insert",h);a.custEvent.remove(b,"close",c.hide)});f=b.API.getCurPos()},k=function(c){a.core.evt.preventDefault();if(!i){i=!0;var d=a.fixEvent(a.getEvent()).target;a.contains(b.nodeList.widget,d)?g=d:g=b.nodeList.more;j(c)}};c.clear=function(){};c.show=k;c.hide=function(){d&&d.hide()};c.destroy=function(){b=null};return c}});
STK.register("conf.trans.vote",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("add",{url:"/aj/vote/add",method:"post"});c("join",{url:"/aj/vote/join",method:"post"});return b});
STK.register("lib.kit.dom.parentElementBy",function(a){return function(a,b,c){if(!a||!b)throw new Error("传入的参数为空");var d=0,e;a=a.parentNode;while(a&&a.parentNode){d++;e=c(a);if(e===!1)return!1;if(e===!0)return a;if(e===b)return null;a=a.parentNode;if(d>3e4)return!1}return null}});
STK.register("lib.kit.extra.shine",function(a){var b=function(a){return a.slice(0,a.length-1).concat(a.concat([]).reverse())};return function(c,d){var e=a.parseParam({start:"#fff",color:"#fbb",times:2,step:5,length:4},d),f=e.start.split(""),g=e.color.split(""),h=[];for(var i=0;i<e.step;i+=1){var j=f[0];for(var k=1;k<e.length;k+=1){var l=parseInt(f[k],16),m=parseInt(g[k],16);j+=Math.floor(parseInt(l+(m-l)*i/e.step,10)).toString(16)}h.push(j)}for(var i=0;i<e.times;i+=1)h=b(h);var n=!1,o=a.timer.add(function(){if(!h.length)a.timer.remove(o);else{if(n){n=!1;return}n=!0;c.style.backgroundColor=h.pop()}})}});
STK.register("lib.image.imgUploadCode",function(a){var b=a.lib.kit.extra.language,c={"-1":b("#L{没有登录}"),"-2":b("#L{没有收到PUT的数据}"),"-3":b("#L{没有指定cb参数}"),"-4":b("#L{没有发现提交上传文件}"),"-5":b("#L{该app没有开放图片上传服务}"),"-6":b("#L{SINAPRO或uid非法}"),"-7":b("#L{参数s值不被支持}"),"-8":b("#L{数据上传失败}"),"-9":b("#L{文件mime类型不支持}"),"-10":b("#L{文件字节数超限}"),"-11":b("#L{存储错误}")};return function(a){return c[a]}});
STK.register("pl.setting.uploadPic",function(a){return function(b,c){var d={},e,f=a.core.evt.addEvent,g="weibo.com/",h="picupload.weibo.com",i=c,j={complete:function(b,c){a.log("complete",b,i);if(!b||b.ret<0)i.err?i.err(b):i.complete(b);else{var d=j.parseInfo(b);a.log("result",d,b,i);i.complete(d)}},parseInfo:function(b){var c=a.lib.kit.extra.imageURL(b.pid),d=[],e,f;return{url:c,pid:b.pid}}},k={upload:function(b,d){var e=d.value;if(a.core.str.trim(e)!==""){c.start&&c.start.call();a.core.io.ijax({url:location.protocol+"//"+h+"/interface/pic_upload.php",form:b,abaurl:location.protocol+"//"+document.domain+"/aj/static/upimgback.html?_wv=5",abakey:"cb",onComplete:j.complete,onTimeout:c.timeout,args:{marks:1,app:"miniblog",s:"rdxt"}})}}},l={},m={},n=function(){o();p();r();t();u()},o=function(){if(!b)throw"node is not defined"},p=function(){e=a.lib.kit.dom.parseDOM(a.core.dom.builder(b).list);if(!e.fileBtn)throw"[common.content.uploadPic]: nodes.fileBtn is not defined.";if(!e.form)throw"[common.content.uploadPic]: nodes.form is not defined."},q=function(){},r=function(){f(e.fileBtn,"change",function(){k.upload(e.form,e.fileBtn)})},s=function(){},t=function(){},u=function(){},v=function(){},w={};d.doUpload=k.upload;d.destroy=v;n();return d}});
STK.register("lib.vote.publishVoteBubble",function(a){var b=a.lib.kit.extra.language,c=a.core.util.templet,d=a.lib.kit.extra.shine,e,f=function(a,b,c,d,e){if(a>b)return"";var f=[];d||(d="");e||(e="");for(var g=a;g<=b;g++){var h=g;!c||(h=h<10?"0"+h:""+h);f.push('<option value="'+h+'">'+d+h+e+"</option>")}return f.join("")},g=function(a){var b=new Date,c;switch(a){case"Y":c=b.getFullYear();break;case"M":c=b.getMonth()+1;c<10&&(c="0"+c);break;case"D":c=b.getDate();c<10&&(c="0"+c);break;case"H":c=b.getHours();c<10&&(c="0"+c);break;case"I":c=b.getMinutes();c<10&&(c="0"+c);break;case"S":c=b.getSeconds();c<10&&(c="0"+c);break;default:c=b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate()+" "+b.getHours()+":"+b.getMinutes()+":"+b.getSeconds()}return c},h=function(a){var b=a?new Date(a):new Date,c={year:b.getFullYear(),month:b.getMonth()+1,day:b.getDate()};c.month<10&&(c.month="0"+c.month);c.day<10&&(c.day="0"+c.day);return c.year+"-"+c.month+"-"+c.day},i=function(){var a=""+Math.random();return a.replace(/^0\./,"s_")},j={FRAME:'<div class="W_layer W_layer_pop"><div class="content"><div class="W_layer_title"><div class="W_layer_close"><a href="javascript:void(0);" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div></div><div class="layer_send_vote" node-type="vote_switcher"><div class="layer_send_btn clearfix"><ul class="clearfix"><li class="S_line2"><a href="javascript:void(0);" action-type="switcher" action-data="type=0" class="W_btn_l"><span class="btn_45px"><em class="W_ficon ficon_vote_text S_ficon">Ì</em>#L{发起文字投票}</span></a></li><li class="S_line2"><a href="javascript:void(0);" action-type="switcher" action-data="type=1" class="W_btn_l"><span class="btn_45px"><em class="W_ficon ficon_vote_pic S_ficon">Í</em>#L{发起图片投票}</span></a></li></ul></div></div><div class="layer_vote" node-type="vote_content" style="display:none"><div class="title"><h5>#L{创建标题}：</h5><p class="tips" node-type="titleTips"><span class="txt S_txt2">#L{标题最多25字}</span></p></div><div class="con"><input node-type="title" type="text" name="title" class="W_input"/></div><div class="title"><h5>#L{投票选项}：</h5><p class="tips" node-type="itemsTips"><span class="txt S_txt2">#L{至少2项,每项最多20字}</span></p></div><div node-type="items"></div><div class="con"><a node-type="addItems" href="javascript:void(0);" class="addbox S_bg1 S_txt1"><em class="W_ficon ficon_add S_ficon">+</em>#L{添加选项}</a></div><div class="chooseBox S_line2"><h5>#L{单选/多选}：</h5><select  name="num" node-type="num"><option value="1">#L{单选}</option></select></div><div class="seniorBox S_line1"><h5><a node-type="advancedBtn" href="javascript:void(0);" class="S_txt1"><span class="txt">#L{高级设置}</span> <em class="W_ficon ficon_arrow_down S_ficon">c</em></a></h5><div node-type="advanced"><div class="title">#L{截止时间}：<span class="date"><select node-type="deadline"><option value="1 week">#L{一周}</option><option value="1 month">#L{一个月}</option><option value=".5 year">#L{半年}</option><option value="1 year">#L{一年}</option><option value="modify">#L{自定义}</option></select></span><p style="display:none;" class="date" node-type="modify"><input name="date" type="text" node-type="date_select" class="date_select" readonly /><span class="date"><select name="hours">'+f(0,23,1)+'</select>#L{时}</span><span class="date"><select name="minutes">'+f(0,59,1)+"</select>#L{分}</span></p>"+"</div>"+'<div class="title">#L{投票结果}：<span node-type="voteResult"><label class="W_label" for="vote_visibility_0"><input id="vote_visibility_0" value="0" type="radio" name="visibility" class="W_radio" checked="checked" /><span>#L{投票后可见}</span></label><label class="W_label" for="vote_visibility_1"><input id="vote_visibility_1" value="1" type="radio" name="visibility" class="W_radio" /><span>#L{任何人可见}</span></label></div>'+'<div class="title">#L{投票说明}：</div>'+'<div class="seniorpic" node-type="desc">'+'<div class="W_input clearfix">'+'<div style="display:none" node-type="pictureArea">'+'<div node-type="pictureArea_pic" class="pic S_bg1"><em class="W_ficon ficon_add_pic S_ficon">È</em><form node-type="pictureForm" id="vote_picture_upload" name="vote_picture_upload" target="upload_target" enctype="multipart/form-data" method="POST" action=""><span node-type="fileBtn"><input name="pic1" action-type="picuploadinput" type="file" style="width:100px;height:100px;position:absolute;bottom:0;right:0;opacity:0;filter:alpha(opacity=0);cursor:pointer;"></span></form></div>'+'<div node-type="pictureArea_pic" class="pic S_bg1"><em class="W_ficon ficon_add_pic S_ficon">È</em><a href="javascript:void(0);" action-type="cancel" class="ico_delpic"></a></div>'+'<div node-type="pictureArea_pic" class="pic S_bg1"><img node-type="pic" height="50" width="50"><a href="javascript:void(0);" action-type="cancel" class="ico_delpic"></a></div>'+"</div>"+'<textarea node-type="info" class="input" onfocus="this.parentNode.className=\'W_input W_input_focus clearfix\'" onblur="this.parentNode.className=\'W_input clearfix\'"></textarea>'+"</div>"+"</div>"+"</div>"+"</div>"+'<div node-type="secodeArea" class="coding S_line2" style="display:none;">#L{验证码}'+'<input node-type="secode" type="text" class="W_input" name="secode">'+b('<img action-type="secodeImg" node-type="secodeImg" width="75" height="24" title="#L{看不清，换一个}" alt="#L{看不清，换一个}" />')+'<p node-type="secodeTips"></p>'+"</div>"+'<div class="W_layer_btn">'+'<a node-type="submitBtn" href="javascript:void(0);" class="W_btn_a">#L{发起}</a>'+"</div>"+"</div>"+'<div class="W_layer_arrow"><span node-type="arrow" class="W_arrow_bor"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div>'+"</div></div>",ITEM:'<div node-type="vote_item" class="con"><div class="W_input"><span class="S_txt1" node-type="vote_item_index">#{NUMBER}</span><input class="input" onfocus="this.parentNode.className=\'W_input W_input_focus\'" onblur="this.parentNode.className=\'W_input\'" type="text" action-type="item"/><span action-type="removeItem" class="del S_line1"><a href="javascript:void(0);" class="W_ficon ficon_close S_ficon">X</a></span></div></div>',ITEM_PIC:'<div node-type="vote_item" class="option_pic clearfix"><div class="pic S_bg1"><em class="W_ficon ficon_add_pic S_ficon" node-type="pic_placeholder">È</em><em style="display:none;" class="W_ficon ficon_add_pic S_ficon" node-type="pic_loading">È</em><img node-type="pic" height="50" width="50" src="" style="display:none;"/><span style="visibility:hidden" node-type="ruTips">'+b("#L{重新上传}")+'</span><form node-type="form" enctype="multipart/form-data" method="POST"><input name="pic1" style="width:100px;height:100px;position:absolute;bottom:0;right:0;opacity:0;filter:alpha(opacity=0);cursor:pointer;" node-type="fileBtn" type="file" /></form></div>'+'<div class="piccon">'+'<div class="W_input">'+'<span class="S_txt1" node-type="vote_item_index">#{NUMBER}</span>'+'<input class="input" type="text" action-type="item" onfocus="this.parentNode.className=\'W_input W_input_focus\'" onblur="this.parentNode.className=\'W_input\'"/><span action-type="removeItem" class="del S_line1"><a href="javascript:void(0);" class="W_ficon ficon_close S_ficon">X</a></span>'+'</div><p class="S_spetxt" node-type="tips"></p>'+"</div>"+"</div>",ITEM_PIC_UPLOADING:$CONFIG.imgPath+"style/images/index/vote_img_loading.png",EDITOR:b("#L{我发起了一个投票}【#{TITLE}】，#L{地址} #{SHORTURL}"),ADVANCED:{PICUPLOADINPUT:'<input action-type="picuploadinput" type="file" name="pic1"/>',PICUPLOADTHUMBFRAME:'<div node-type="outer" class="W_layer"><div class="bg"><table border="0" cellspacing="0" cellpadding="0"><tr><td><div node-type="inner" class="content" style="padding:5px;"></div></td></tr></table><div class="arrow arrow_t"></div></div></div>',PICUPLOADTHUMBNAIL:'<img src="#{URL}"/>'},TITLE:{DEFAULT:b('<span class="txt S_txt2">#L{标题最多25字}</span>'),SUCCESS:b('<span class="txt S_txt2">#L{标题最多25字}</span>'),EMPTY:b('<span class="W_icon icon_rederrorS"></span><span class="txt S_txt2">#L{标题不能为空}</span>')},ITEMS:{DEFAULT:b('<span class="txt S_txt2">#L{至少2项,每项最多20字}</span>'),LESS:b('<span class="W_icon icon_rederrorS"></span><span class="txt S_txt2">#L{选项太少啦，至少两项哦。}</span>')},SUBMIT:{DEFAULT:b("#L{发起后不可删除或修改选项}"),ERROR:"#{MESSAGE}",ING:b("#L{正在提交}"),SUCCESS:b("#L{投票发起成功}")},SECODE:{DEFAULT:b('<em class="S_txt2">#L{请输入验证码}</em>'),EMPTY:b('<span class="icon_del"></span><em class="S_spetxt">#L{验证码不能为空}</em>'),ERROR:b('<span class="icon_del"></span><em class="S_spetxt">#L{验证码错误，请重新输入}</em>')},PICTUREUPLOAD:{ERRORSIZE:b("#L{请上传5M以内的JPG、GIF、PNG图片。}")}},k={},l={},m,n,o,p,q,r={},s="1 week",t={},u=0,v=!1,w=!1,x=0,y=!1,z=null,A,B,C=!1,D,E=["normal","picture"],F,G={itemMin:5,itemMax:10,defaultItem:5,addItemStep:1,itemMaxLen:20,titleMaxLen:25,maintain:365,itemMinActive:2},H,I={init:function(){I.bind();J.init()},changeTab:function(a){var b=E[a.data.type|0];I.stopLsn();n.vote_switcher.style.display="none";n.vote_content.style.display="";y=!1;w=!1;v=!1;u=0;F=I[b]();I.resetTitle();I.resetDeadline();I.resetVoteResult();I.clearItems();I.itemsNum();I.hideCalendar();I.hideAdvanced();I.startLsn();switch(b){case 0:case"default":G.itemMax=20;J.enable();break;case 1:case"picture":G.itemMax=15;J.disable();break;default:G.itemMax=20;J.enable()}I.addItems(G.defaultItem);n.itemsTips.innerHTML="";n.titleTips.innerHTML="";n.secodeTips.innerHTML="";setTimeout(function(){n.title.focus()},0)},bind:function(){r.items=a.core.evt.delegatedEvent(n.items);r.secode=a.core.evt.delegatedEvent(n.secodeArea);r.switcher=a.core.evt.delegatedEvent(n.vote_switcher);r.items.add("removeItem","click",I.removeItem);r.items.add("item","click",function(){n.itemsTips.innerHTML=j.ITEMS.DEFAULT});r.secode.add("secodeImg","click",I.secodeReflush);r.switcher.add("switcher","click",I.changeTab);a.addEvent(n.addItems,"click",I.addItemStep);a.addEvent(n.advancedBtn,"click",I.toggleAdvanced);a.addEvent(n.deadline,"change",I.toggleDeadline);a.addEvent(n.date_select,"click",I.showCalendar);a.addEvent(n.submitBtn,"click",I.submit);a.addEvent(n.info,"click",I.showInfo);a.addEvent(n.info,"blur",I.hideInfo);a.addEvent(n.title,"keyup",I.getTitle);a.addEvent(n.secode,"keyup",I.getSecode)},startLsn:function(){l.flushNum=window.setInterval(I.itemsReflushStatus,500)},stopLsn:function(){for(var a in l)window.clearInterval(l[a])},getBub:function(){return p},hide:function(){a.custEvent.remove(k,"hide");p.hide()},show:function(){p.show()},itemsNum:function(){u=a.sizzle("[node-type=vote_item]",n.items).length},itemsReMark:function(){var b=a.sizzle("[node-type=vote_item_index]",n.items);for(var c=0;c<u;c++)b[c].innerHTML=c+1+"."},addItems:function(a){F.addItems(a);I.removeItemsBtn.autoToggle();I.addItemsBtn.autoToggle()},addItemStep:function(){I.addItems(G.addItemStep)},clearItems:function(){n.items.innerHTML=""},addItemsBtn:{show:function(){n.addItems.style.display=""},hide:function(){n.addItems.style.display="none"},autoToggle:function(){u<G.itemMax?I.addItemsBtn.show():I.addItemsBtn.hide()}},removeItem:function(a){setTimeout(function(){I.itemsNum();F.removeItem(a.el);I.itemsReMark();I.removeItemsBtn.autoToggle();I.addItemsBtn.autoToggle()},0)},removeItemsBtn:{get:function(){return a.sizzle("[action-type=removeItem]",n.items)},show:function(){var a=I.removeItemsBtn.get();if(a.length>0)for(var b in a)a[b].style.display=""},hide:function(){var a=I.removeItemsBtn.get();if(a.length>0)for(var b in a)a[b].style.display="none"},autoToggle:function(){u>G.itemMin?I.removeItemsBtn.show():I.removeItemsBtn.hide()}},getTitle:function(){var b=a.core.str.trim(n.title.value);if(b=="")n.titleTips.innerHTML=j.TITLE.DEFAULT;else{b.length>=G.titleMaxLen&&(b=b.slice(0,G.titleMaxLen));n.titleTips.innerHTML=j.TITLE.SUCCESS}n.title.value!=b&&(n.title.value=b);return b},resetTitle:function(){n.title.value="";I.getTitle()},itemsFormat:function(){var b=a.sizzle("input[action-type=item]",n.items);if(b&&b.length>0){var c;for(var d in b){c=b[d].value;c=a.core.str.trim(c).replace(/,/,"").slice(0,G.itemMaxLen);b[d].value!=c&&(b[d].value=c)}}},itemsReflushStatus:function(){I.itemsFormat();var a=F.getItemsData();if(x!=a.length){I.flushNum(a.length);x=a.length}},getItemsFormData:function(){I.itemsFormat();var a=F.getItemsFormData();return a},getVoteResult:function(){var b=a.sizzle("[name=visibility]",n.vote);for(var c in b)if(b[c].checked==!0)return b[c].value;return 0},resetVoteResult:function(){a.sizzle("[name=visibility]",n.vote)[0].checked=!0},getDeadline:function(){var b=n.deadline.value,c={};c.hh=g("H");c.mm=g("I");switch(b){case"1 week":c.date=h((Math.round(+(new Date)/1e3)+604800)*1e3);break;case"1 month":c.date=h((Math.round(+(new Date)/1e3)+2592e3)*1e3);break;case".5 year":c.date=h((Math.round(+(new Date)/1e3)+15724800)*1e3);break;case"1 year":c.date=h((Math.round(+(new Date)/1e3)+31536e3)*1e3);break;default:c.date=a.sizzle("[name=date]",n.modify)[0].value;c.hh=a.sizzle("[name=hours]",n.modify)[0].value;c.mm=a.sizzle("[name=minutes]",n.modify)[0].value}return c},getSecode:function(){var b=a.core.str.trim(n.secode.value);if(b==""){n.secodeTips.innerHTML=j.SECODE.DEFAULT;return!1}n.secodeTips.innerHTML="";return b},secodeReflush:function(){if(y){n.secodeArea.style.display="";n.secodeImg.src=z+"&ts="+(new Date).getTime();n.secodeTips.innerHTML=j.SECODE.DEFAULT;n.secode.value="";n.secode.focus()}else n.secodeArea.style.display="none"},flushNum:function(b){n.num.innerHTML="";var c;c=a.C("option");c.value="1";c.innerHTML="单选";n.num.appendChild(c);if(b>=2)for(var d=2;d<=b;d++){c=a.C("option");c.value=d;c.innerHTML="最多选 "+d+" 项";n.num.appendChild(c)}},showAdvanced:function(){var b=a.sizzle("em",n.advancedBtn)[0];b.innerHTML="d";a.core.dom.toggleClassName("ficon_arrow_up","ficon_arrow_down");n.advanced.style.display="";v=!0},hideAdvanced:function(){var b=a.sizzle("em",n.advancedBtn)[0];b.innerHTML="c";a.core.dom.toggleClassName("ficon_arrow_down","ficon_arrow_up");n.advanced.style.display="none";I.hideCalendar();v=!1},toggleAdvanced:function(){v?I.hideAdvanced():I.showAdvanced()},showCalendar:function(){D||(D=a.ui.calendar({start:t.startDate,end:t.endDate,currentDate:t.currentDate,callback:function(a,b){n.date_select.value=a;D.hide()}}));D.show(n.date_select)},hideCalendar:function(){D&&D.hide()},lastDeadline:function(){s!=n.deadline.value&&n.deadline.value!="modify"&&(s=n.deadline.value)},showDeadline:function(){t.startDate=h();t.endDate=h((Math.round(+(new Date)/1e3)+G.maintain*86400)*1e3);switch(s){case"1 week":t.currentDate=h((Math.round(+(new Date)/1e3)+604800)*1e3);break;case"1 month":t.currentDate=h((Math.round(+(new Date)/1e3)+2592e3)*1e3);break;case".5 year":t.currentDate=h((Math.round(+(new Date)/1e3)+15724800)*1e3);break;case"1 year":t.currentDate=h((Math.round(+(new Date)/1e3)+31536e3)*1e3);break;default:t.currentDate=h((Math.round(+(new Date)/1e3)+604800)*1e3)}n.date_select.value=t.currentDate;a.sizzle("[name=hours]",n.modify)[0].value=g("H");a.sizzle("[name=minutes]",n.modify)[0].value=g("I");n.modify.style.display=""},hideDeadline:function(){n.modify.style.display="none"},toggleDeadline:function(){I.lastDeadline();n.deadline.value=="modify"?I.showDeadline():I.hideDeadline()},resetDeadline:function(){I.hideDeadline();s="1 week";n.deadline.value=a.sizzle("option",n.deadline)[0].value},showInfo:function(){n.info.style.height="100px"},hideInfo:function(){n.info.value=a.core.str.trim(n.info.value);n.info.value==""&&(n.info.style.height="")},getFormData:function(){var b=!0,c=I.getDeadline(),e=I.getTitle();if(!e){n.titleTips.innerHTML=j.TITLE.EMPTY;if(b){a.core.util.scrollTo(n.titleTips,{step:10});n.title.focus();d(n.title)}b&=!1}var f=I.getItemsFormData();if(!f){n.itemsTips.innerHTML=j.ITEMS.LESS;b&&a.core.util.scrollTo(n.titleTips,{step:10});b&=!1}if(y){var g=I.getSecode();if(!g){n.secodeTips.innerHTML=j.SECODE.EMPTY;if(b){n.secode.focus();d(n.secode)}b&=!1}c.secode=g}if(!!b){c.title=e;c.items=f;c.vote_result=I.getVoteResult();c.num=n.num.value;c.pid=J.getPid();c.info=a.core.str.trim(n.info.value);c.poll_category=H;return c}},submit:function(){if(!w){w=!0;o=I.getFormData();if(!o){w=!1;return}a.addClassName(n.submitBtn,"W_btn_a_disable");n.submitBtn.innerHTML=b('<i class="W_loading"></i>#L{提交中}');a.conf.trans.vote.request("add",{onComplete:I.handle},o)}},handle:function(e){a.removeClassName(n.submitBtn,"W_btn_a_disable");n.submitBtn.innerHTML=b("#L{发起}");if(e.code=="100000")a.ui.tipAlert(j.SUBMIT.SUCCESS).beside(n.submitBtn).on("hide",function(){a.custEvent.fire(k,"insert",c(j.EDITOR,{TITLE:o.title,SHORTURL:e.data.short_url}));w=!1;I.hide()});else{if(e.code=="100024"){y=!0;z=e.data.url;w=!1}else if(e.code=="100025"){n.secodeTips.innerHTML=j.SECODE.ERROR;d(n.secode);w=!1}else if(e.code=="100026"){y=!1;a.ui.tipAlert(e.msg,{icon:"warnS"}).beside(n.submitBtn).on("hide",function(){w=!1})}else if(e.code=="100030"){n.itemsTips.innerHTML=c(j.SUBMIT.ERROR,{MESSAGE:e.msg});w=!1}else{a.lib.dialog.ioError(e.code,e);w=!1}I.secodeReflush()}}};I.normal=function(){return function(){H=0;var b={addItems:function(b){G.itemMax<=u+b&&(b=G.itemMax-u);if(b>0){for(var d=0;d<b;d++)n.items.appendChild(a.core.dom.builder(c(j.ITEM,{NUMBER:u++ +1+"."})).box.firstChild);setTimeout(function(){a.sizzle("input",n.items).pop().focus()},0)}},removeItem:function(b){a.core.dom.removeNode(a.core.dom.dir.parent(b,{expr:"[node-type=vote_item]"})[0]);u--},getItemsData:function(){var b=[],c=a.sizzle('input[action-type="item"]',n.items),d;for(var e in c){d=c[e].value;!!d&&b.push(d)}return b},getItemsFormData:function(){var a=b.getItemsData();return a.length>=G.itemMinActive?a.join(","):""},destroy:function(){}};return b}}();I.picture=function(){return function(){H=1;var b=0,d={addItems:function(d){G.itemMax<=u+d&&(d=G.itemMax-u);if(d>0){var e,f,g;for(var h=0;h<d;h++){e=a.core.dom.builder(c(j.ITEM_PIC,{NUMBER:u++ +1+"."}));f=e.box.firstChild;g=a.lib.kit.dom.parseDOM(e.list);n.items.appendChild(f);a.pl.setting.uploadPic(f,{start:function(c){return function(){c.pic_placeholder.style.display="none";c.pic.style.display="none";c.pic_loading.style.display="";c.pic.setAttribute("last",c.pic.getAttribute("src"));a.setStyle(c.ruTips,"visibility","hidden");b++}}(g),err:null,complete:function(c){return function(d){c.pic_placeholder.style.display="none";c.pic_loading.style.display="none";c.pic.style.display="";if(d.pid){c.pic.setAttribute("src",a.lib.kit.extra.imageURL(d.pid,{size:"square"}));c.pic.setAttribute("pid",d.pid);c.tips.innerHTML=""}else if(d.ret&&d.ret<0){c.pic.setAttribute("src",c.pic.getAttribute("last"));d.ret=="-4"||d.ret=="-9"||d.ret=="-10"?c.tips.innerHTML=j.PICTUREUPLOAD.ERRORSIZE:c.tips.innerHTML=a.lib.image.imgUploadCode(d.ret)}a.setStyle(c.ruTips,"visibility","visible");b--}}(g)})}setTimeout(function(){a.sizzle("input",n.items).pop().focus()},0)}},removeItem:function(b){a.core.dom.removeNode(a.core.dom.dir.parent(b,{expr:"[node-type=vote_item]"})[0]);u--},getItemsData:function(){var b=[],c=a.sizzle(".option_pic",n.items),d,e,f;for(var g in c){f={};e=a.sizzle('img[node-type="pic"]',c[g])[0].getAttribute("pid");d=a.sizzle('input[action-type="item"]',c[g])[0].value;e&&(f.pid=e);d&&(f.content=d);(e||d)&&(b=b.concat([f]))}return b},getItemsFormData:function(){var b=d.getItemsData();return b.length>=G.itemMinActive?a.core.json.jsonToStr(b):""},canBeClose:function(){b>0?p.stopBoxClose():p.startBoxClose()},destroy:function(){}};return d}}();var J={img:{},pictureInUploading:!1,init:function(){var b=a.sizzle("[node-type=pictureArea_pic]",n.pictureArea);n.pictureAreaItems={upload:b[0],uploading:b[1],uploaded:b[2]};J.bind()},enable:function(){J.show.upload();n.pictureArea.style.display="";n.desc.className="seniorpic"},disable:function(){n.pictureArea.style.display="none";J.stopUpload();J.hideAll();n.desc.className="seniortxt"},hideAll:function(){for(var a in n.pictureAreaItems)n.pictureAreaItems[a].style.display="none"},show:{upload:function(){J.img={};J.hideAll();n.pictureAreaItems.upload.style.display=""},uploading:function(){J.hideAll();n.pictureAreaItems.uploading.style.display=""},uploadfail:function(){J.hideAll();n.pictureAreaItems.upload.style.display=""},uploaded:function(){J.hideAll();n.pictureAreaItems.uploaded.style.display="";a.sizzle("img",n.pictureAreaItems.uploaded)[0].src=J.img.url}},startUpload:function(){J.pictureInUploading=!0;p.stopBoxClose();J.show.uploading()},upload:function(){if(!J.pictureInUploading){J.img.name=a.core.str.trim(a.sizzle("input",n.fileBtn)[0].value);if(J.img.name==="")return;var b=J.img.name.split("\\");b.length>1&&(J.img.name=b[b.length-1]);b=null;J.startUpload();e=new Date;a.core.io.ijax({url:location.protocol+"//picupload.weibo.com/interface/pic_upload.php",form:a.E("vote_picture_upload"),abaurl:location.protocol+"//"+document.domain+"/aj/static/upimgback.html?_wv=5",abakey:"cb",onComplete:J.uploadHandle,onTimeout:J.uploadHandle,args:{marks:1,app:"miniblog",s:"rdxt",nick:"@"+$CONFIG.nick,logo:1,url:"vote.weibo.com"}})}},uploadHandle:function(b){if(b&&b.ret&&b.ret>=0){J.uploadSuccess(b);var c=new Date-e}else{b&&b.ret&&b.ret<0&&(b.ret=="-4"||b.ret=="-9"||b.ret=="-10"?n.updateImageTips.innerHTML=j.PICTUREUPLOAD.ERRORSIZE:n.updateImageTips.innerHTML=a.lib.image.imgUploadCode(b.ret));J.uploadFailed()}},stopUpload:function(){p.startBoxClose();a.removeEvent(a.sizzle("input",n.fileBtn)[0],"change",J.upload);n.fileBtn.innerHTML="";setTimeout(function(){n.fileBtn.innerHTML=j.ADVANCED.PICUPLOADINPUT;a.addEvent(a.sizzle("input",n.fileBtn)[0],"change",J.upload);J.pictureInUploading=!1},0)},uploadFailed:function(){J.stopUpload();J.show.uploadfail()},uploadSuccess:function(b){J.stopUpload();J.img.pid=b.pid;J.img.url=a.lib.kit.extra.imageURL(J.img.pid);J.show.uploaded()},getPid:function(){return J.img.pid?J.img.pid:""},viewThumbnail:function(b){if(!q){q=a.ui.mod.layer(j.ADVANCED.PICUPLOADTHUMBFRAME);n.vote.appendChild(q.getOuter())}var d=q.getOuter(),e=a.core.dom.position(n.picturePreview),f=a.core.dom.getSize(n.picturePreview);a.core.dom.setXY(d,{t:e.t+f.height+3,l:e.l-5});q.html(c(j.ADVANCED.PICUPLOADTHUMBNAIL,{URL:J.img.url}));q.show()},closeThumbnail:function(){q.hide()},bind:function(){r.pictureUploadfail=a.core.evt.delegatedEvent(n.pictureArea);r.pictureUploadfail.add("cancel","click",function(){J.stopUpload();J.show.upload()});a.addEvent(a.sizzle("input",n.fileBtn)[0],"change",J.upload);a.addEvent(n.picturePreview,"mouseover",J.viewThumbnail);a.addEvent(n.picturePreview,"mouseout",J.closeThumbnail)}},K=function(){D&&D.destroy&&D.destroy();I.stopLsn();k=null;I=null;J=null},L=function(){a.custEvent.define(k,"hide");a.custEvent.add(k,"hide",I.hide);p.on("hidden",function(){D&&D.hide&&D.hide();p&&p.destroy&&p.destroy()})};k.destroy=K;return function(b,c){var d=function(){G=a.parseParam(G,c);p=a.ui.bubble(j.FRAME,{showWithAni:"fadeInDown:fast",hideWithAni:"fadeOutUp:fast",clickBlankToHide:!0,showWithSetWidth:!1});m=p.getBox();n=p.getDomList(!0);L();I.init();p.show().setArrow("top").setAlignPos(b,c.refer);C=!0};d();k.layer=p;return k}});
STK.register("lib.publisher.widget.vote",function(a){return function(b){var c={},d,e,f=function(a,d){var e=b.API.getCurrentLogType();b.API.addShortUrlLog(e);b.API.insertText(d);c.hide()},g=!1,h=function(b,c){g=!1;d=a.lib.vote.publishVoteBubble(b,c);i()},i=function(){a.custEvent.define(d,"insert");a.custEvent.add(d,"insert",f);a.custEvent.add(b,"close",c.hide);a.custEvent.add(d.layer,"hide",function(){a.custEvent.remove(d,"insert",f);a.custEvent.remove(b,"close",c.hide)})},j=function(){a.core.evt.preventDefault();if(!g){g=!0;var c,d=a.fixEvent(a.getEvent()).target;a.contains(b.nodeList.widget,d)?c=d:c=b.nodeList.more;h(c,{itemMin:2,defaultItem:2,refer:b.nodeList.textEl})}};c.init=function(c,d,f){b=c;e=d;a.addEvent(b.nodeList[e],"click",j)};c.clear=function(){};c.show=j;c.hide=function(){a.custEvent.fire(d,"hide")};c.destroy=function(){b=null;a.custEvent.remove(d,"insert")};return c}});
STK.register("conf.trans.topic",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("getTopic",{url:"/aj/v6/mblog/trend"});return b});
STK.register("lib.topic.publishTopicBubble",function(a){var b=a.lib.kit.extra.language,c=b('<div class="W_layer W_layer_pop"><div class="content"><div class="W_layer_title"><div class="W_layer_close"><a href="javascript:void(0);" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div></div><div class="layer_send_topic"><div class="layer_send_btn clearfix"><ul class="clearfix"><li class="S_line2 li_s3"><a href="javascript:void(0);" action-type="blank_topic" action-data="text=##L{在这里输入你想要说的话题}#" class="W_btn_l"><span class="btn_45px"><em class="W_ficon ficon_add_topic S_ficon">Î</em>#L{插入话题}</span></a></li></ul></div><div class="topic_box"><div class="tit">#L{热门推荐}：</div><ul class="topic_ul clearfix" node-type="topic_list"></ul></div></div><div class="W_layer_arrow"><span node-type="arrow" class="W_arrow_bor"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div></div>'),d,e,f,g,h,i={},j=function(){f=a.ui.bubble(c,{showWithAni:"fadeInDown:fast",hideWithAni:"fadeOutUp:fast",clickBlankToHide:!0});d=f.getDomList(!0);g=f.getBox();h=d.topic_list;n();var b=a.conf.trans.topic.request("getTopic",{onComplete:function(a,b){l(a.data)}},{})},k=function(){j();m.add();a.custEvent.add(f,"hidden",function(b){return function(){a.custEvent.remove(b,"hidden",arguments.callee);m.destroy();b&&b.destroy&&b.destroy()}}(f))},l=function(a){h.innerHTML=a},m={add:function(){a.custEvent.add(i,"hide",function(){f.hide()})},destroy:function(){a.custEvent.remove(i,"blank_topic");a.custEvent.remove(i,"hide");a.custEvent.remove(i,"insert")}},n=function(){a.custEvent.define(i,"blank_topic");a.custEvent.define(i,"insert");a.custEvent.define(i,"hide");var b=STK.core.evt.delegatedEvent(g);b.add("add_topic","click",function(b){a.preventDefault(b.evt);a.custEvent.fire(i,"insert",{value:b.data.text})});b.add("blank_topic","click",function(b){a.preventDefault(b.evt);a.custEvent.fire(i,"blank_topic",{value:b.data.text})})};i.getBub=function(){return f};return function(b,c){if(!a.isNode(b))throw"common.bubble.topic need el as first parameter!";k();f.show().setArrow("top").setAlignPos(b,c.refer);return i}});
STK.register("lib.publisher.widget.topic",function(a){return function(b){var c={},d,e,f=!1,g=a.lib.kit.extra.textareaUtils,h={text:"#在这里输入你想要说的话题#"},i=function(a,d){b.API.insertText(d.value);c.hide()},j=function(a,d){var e=d.value,f=b.nodeList.textEl,h=f.value,i=e.length;if(h.indexOf(e)!=-1){var j=h.indexOf(e);g.setCursor(f,j+1+i)}else{b.API.insertText(e+" ");var k=g.getCursorPos(f);g.setCursor(f,k)}c.hide();var l=b.API.getCurrentLogType();b.API.addShortUrlLog(l)},k=function(a,d){var e=g.getSelectedText(b.nodeList.textEl),f=e.length*1;if(f==0||h.text.indexOf(e)>-1)j(a,d);else{var i="#"+e+"#";g.replaceText(b.nodeList.textEl,i);c.hide()}},l=function(){a.custEvent.add(d,"insert",j);a.custEvent.add(d,"blank_topic",k);a.custEvent.add(b,"close",c.hide);a.custEvent.add(d,"hide",function(){a.custEvent.remove(d,"blank_topic");a.custEvent.remove(d,"hide",arguments.callee);a.custEvent.remove(d,"insert");a.custEvent.remove(b,"close")})},m=function(){a.core.evt.preventDefault();var c,e=a.fixEvent(a.getEvent()).target;a.contains(b.nodeList.widget,e)?c=e:c=b.nodeList.more;d=a.lib.topic.publishTopicBubble(c,{refer:b.nodeList.textEl});f||l()};c.init=function(c,d,f){b=c;e=d;a.addEvent(c.nodeList[e],"click",m)};c.clear=function(){};c.show=m;c.hide=function(){d&&d.getBub().hide()};c.destroy=function(){b=null};return c}});
STK.register("lib.connect.job.musicplayer",function(a){handler="WEIBO_MUSIC_PLAYER";return function(a,b,c,d){var e=c.songid&&c.songid.split(","),f=c.object_id,g=c.source;if(handler in window){c.object_id?window[handler].playSongByObjectId(f,{source:g}):c.songid&&window[handler].playSong(e,{source:g});d("callback",!0)}else d("callback",!1)}});
STK.register("lib.connect.job.setHeight",function(a){return function(b,c,d,e){var f=d;if(!!f){f=(f|0)+"px";c.style.height!=f&&(c.style.height=f);e("callback");var g=c.getAttribute("connect_sid");g&&a.core.util.connect.request({sid:g,data:{height:f}})}}});
STK.register("lib.connect.job.uiAlert",function(a){return function(b,c,d,e){a.isArray(d)||(d=[d]);d[1]=d[1]||{};d[1].OK=function(){e("callback")};a.ui.alert.apply(window,d)}});
STK.register("lib.sandbox.publishPluginBubble",function(a){var b=a.lib.kit.extra.language,c='<div class="W_layer W_layer_pop"><div class="content"><div class="W_layer_title"><div class="W_layer_close"><a href="javascript:void(0);" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div></div><div node-type="inner"></div><div class="W_layer_arrow"><span node-type="arrow" class="W_arrow_bor"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div></div>';return function(d){var e={},f={},g=1,h={add:function(a){if(!f[a.id]){f[a.id]={};f[a.id].box=h.build(a)}f.ishow=a.id;return f[a.id]},has:function(a){return f[a.id]},remove:function(a){if(f[a]){try{f[a].iframe.destroy&&f[a].iframe.destroy()}catch(b){}f[a].box.destroy&&f[a].box.destroy();f[a].layer.destroy&&f[a].layer.destroy();var c=f[a].layer.getOuter();c.parentNode.removeChild(c);delete f[a]}},build:function(e){var h=a.ui.bubble(c,{showWithAni:"fadeInDown:fast",hideWithAni:"fadeOutUp:fast",clickBlankToHide:!0,showWithSetWidth:!1});g++;h.setContent(e.html).rebindClose();f[e.id].layer=h;var j=h.getDomList().inner;a.custEvent.once(h,"show",function(){setTimeout(function(){var c=a.builder(h.getBox()).list,g=c.iframe&&c.iframe[0],i;if(g){var j;(j=g.getAttribute("_src"))&&g.setAttribute("_src",j+(j.indexOf("?")>=0?"&":"?")+"skin="+$CONFIG.skin);f[e.id].iframe=i=a.lib.connect.iframe(g);i.on("insertIntoPublishTop",function(a,c,e,f){function g(a){return typeof a=="string"||a&&typeof a.substr=="function"}g(e)&&(e={text:e});d.insert("这个值没有用",{text:e.text,tip:e.tip||b("#L{添加成功}")})});i.on("formData",function(a,b,c,e){d.formData(c.key,c.value)});i.on("setWidth",function(a,b,c,d){b.style.width=c+"px"});i.on("close",function(a,b,c,d){h.hide();d("callback")});i.on("setTittle",function(b,c,d,e){var f=a.sizzle("div",h.getDomList().inner)[0]||null;f&&(f.innerHTML=d)});i.on("musicplayer",a.lib.connect.job.musicplayer);i.on("setHeight",a.lib.connect.job.setHeight);i.on("uiAlert",a.lib.connect.job.uiAlert);a.custEvent.add(h,"hide",function(){i.trigger("close")});a.custEvent.add(h,"show",function(){i.trigger("show")})}},10)});return h},destroy:function(){for(var a in f)h.remove(a)}};e.layers=f;e.add=h.add;e.remove=h.remove;e.destroy=h.destroy;return e}});
STK.register("lib.publisher.widget.plugin",function(a){var b=a.conf.trans.publisher;return function(c,d){d=a.parseParam({widget:c.nodeList.widget},d||{});var e={},f,g,h,i=!1,j={init:function(){f=a.delegatedEvent(d.widget);f.add("plugin","click",j.show)},show:function(b){c.API.setCurrentLogType(b.data.log);a.preventDefault();if(!i){i=!0;var d=a.fixEvent(a.getEvent()).target;a.contains(c.nodeList.widget,d)?h=d:h=c.nodeList.more;j.asynShow(b)}},asynShow:function(d){i=!1;g||(g=a.lib.sandbox.publishPluginBubble({insert:j.insert,formData:j.formData}));var e=function(){g.layers[f].layer.setArrow("top").show().setAlignPos(h,c.nodeList.textEl);setTimeout(function(){a.custEvent.add(c,"close",g.layers[f].layer.hide)},0)},f=d.data.type;g.layers[f]?e():b.request("interactive",{onSuccess:function(b){var c=a.lib.kit.extra.merge({html:b.data.html,id:f},d.data);g.add(c);e()},onError:function(b){a.lib.dialog.ioError(b.code,b)}},d.data)},insert:function(a,b){var d=c.API.getCurrentLogType();c.API.addShortUrlLog(d);c.API.insertText(b.text)},formData:function(b,d){var e=a.lib.publisher.source.formdata(c.nodeList.extradata);e.set(b+"",d+"")}};j.init();e.delegatedEvent=f;e.show=j.show;e.destroy=function(){f.destroy()};return e}});
STK.register("lib.image.multiimage.taglist",function(a){var b='<div style="position:absolute;z-index:10000;display:none;" class="layer_menu_list" node-type="layer_outer"><ul node-type="suggestWrap"></ul></div>',c={"@":'<#et temp data><li class="suggest_title">${data.title}</li><#list data.data as list><li action-type="item" action-data="value=${list.screen_name}" value="${list.screen_name}" objid="1042:${list.uid}"><a href="javascript:;">${list.screen_name}<#if (list.remark)>(${list.remark})</#if></a></li><#if (list.count)><span>${list.count}</span></#if></#list></#et>',"#":'<#et temp data><li class="suggest_title">${data.title}</li><#list data.data as list><li action-type="item" suda-data="key=tblog_associate&value=list_${list_index+1}"action-data="value=${list.topic}" value="${list.topic}" objid="${list.object_id}"><a href="javascript:;">${list.topic}<#if (list.count)>(${list.count})</#if></a></li></#list></#et>'};return function(d,e){var f={},g,h,i,j=a.lib.kit.extra.language,k=a.conf.trans.image,l=0,m,n,o=a.parseParam({flag:"@"},e),p=d.value,q={"@":"followList","#":"tagtopicList"},r={"@":{normalTitle:j("#L{选择昵称或轻敲空格完成输入}"),moreTitle:j("#L{选择最近@的人或直接输入}"),noTilte:j("#L{轻敲空格完成输入}"),tagTitle:j("#L{输入想要@的人并回车结束}")},"#":{normalTitle:j("#L{想用什么话题？}"),tagTitle:j("#L{输入想说的话并回车结束}")}},s={rendHtml:function(b,d,e){d.title=r[b].tagTitle;var f=a.core.util.easyTemplate(c[b],d);return f},getList:function(){k.getTrans(q[o.flag],{onSuccess:function(b){var c=s.rendHtml(o.flag,b);a.custEvent.fire(i,"open",d);h.innerHTML=c}}).request({q:p});g.style.display="";s.setPos(g)},setPos:function(b){var c=a.position(d);b.style.top=c.t+30+"px";b.style.left=c.l-12+"px";b.style.display=""},checkValue:function(){if(a.trim(d.value)!=p){p=a.trim(d.value);s.getList()}}},t=function(){var c=a.core.dom.builder(b);g=c.list.layer_outer[0];document.body.appendChild(g);h=c.list.suggestWrap[0];i=a.ui.mod.suggest({textNode:d,uiNode:h,actionType:"item",actionData:"value"})},u={item:function(){},blur:function(){clearInterval(n);n=null;setTimeout(function(){a.custEvent.fire(i,"close")},200)},focus:function(){s.getList();!n&&(n=setInterval(function(){s.checkValue()},200))},enterkey:function(b){if(!!a.trim(d.value)){if(d.value.indexOf("#")>=0){a.ui.alert(j("#L{请不要创建带有＃的话题}"),{icon:"rederrorB"});return}a.custEvent.fire(f,"createTag",{content:d.value,flag:o.flag,tag_object_id:0});i&&i.hide&&i.hide();d.value="";if(n){clearInterval(n);n=null}g.style.display="none";a.preventDefault(b)}},change:function(){var a=30;o.flag=="#"&&(a=100);d.value!=STK.core.str.leftB(d.value,a)&&(d.value=STK.core.str.leftB(d.value,a))}},v=function(){d.focus()},w=function(){a.custEvent.define(f,["createTag"]);a.custEvent.add(i,"onIndexChange",function(b,c){m=a.sizzle("li[class!=suggest_title]",h);m&&m[0]&&a.core.dom.removeClassName(m[l],"cur");a.core.dom.addClassName(m[c],"cur");l=c});a.custEvent.add(i,"onSelect",function(b,c,e,h){if(c==-1)u.enterkey();else{l=0;if(m[0]){var i=m[c].getAttribute("value")+"",j=m[c].getAttribute("objid");d.value=i}else var i=d.value,j=0;d.value="";if(n){clearInterval(n);n=null}g.style.display="none";a.custEvent.fire(f,"createTag",{content:i,flag:o.flag,tag_object_id:j})}});a.custEvent.add(i,"onClose",function(){if(n){clearInterval(n);n=null}g.style.display="none"});a.addEvent(d,"focus",u.focus);a.addEvent(d,"blur",u.blur);a.addEvent(d,"keydown",u.change);a.core.evt.hotKey.add(d,["enter"],u.enterkey)},x=function(){t();w()};x();f.show=v;f.destroy=function(){a.removeEvent(d,"focus",u.focus);a.removeEvent(d,"blur",u.blur);a.core.evt.hotKey.remove(d,["enter"],u.enterkey);g.style.display="none";i&&i.destroy&&i.destroy()};return f}});
STK.register("lib.image.multiimage.multiAddTags",function(a){function l(c){function x(){}function w(a){n||(n=d);a.appendChild(n);return p}function v(){n&&a.removeNode(n);l.value="";m.value="";n=undefined;return p}function u(a){if(n){k(n,a);o=a}return p}function t(){r(f)}function s(){r(e)}function r(b){if(n){a.replaceNode(b,n);n=b;k(n,o);n.suggust&&n.suggust.show()}}function q(b,d){if(n){j("pub_pic_upload",{"@":"main_pub_adperson","#":"main_pub_adtopic"}[d.flag]);c(d.flag,d.content,d.tag_object_id,a.core.json.merge({},o));p.remove()}}var d=a.builder(b(i.add)).box.firstChild,e=a.builder(b(i.topic_editor)).box.firstChild,f=a.builder(b(i.user_editor)).box.firstChild,g=a.sizzle(".inner_call",d)[0],h=a.sizzle(".inner_topic",d)[0],l=a.sizzle("input",e)[0],m=a.sizzle("input",f)[0],n,o={left:0,top:0},p={};e.suggust=a.lib.image.multiimage.taglist(l,{flag:"#"});f.suggust=a.lib.image.multiimage.taglist(m,{flag:"@"});a.custEvent.add(e.suggust,"createTag",q);a.custEvent.add(f.suggust,"createTag",q);a.addEvent(g,"click",t);a.addEvent(h,"click",s);p.setPosition=u;p.remove=v;p.appendTo=w;p.destroy=x;return p}function k(a,b,c){var d=10,e=5,f=a.parentNode,g={width:f.offsetWidth,height:f.offsetHeight};b.left=Math.min(g.width,Math.max(0,b.left));b.top=Math.min(g.height,Math.max(0,b.top));c==="last"&&(c=a.forWard);c===undefined&&(c=b.left<g.width/2?"L":"R");switch(c){case"L":a.className=a.className.replace(/R/g,"L");a.style.top=b.top-d+"px";a.style.left=b.left-e+"px";break;case"R":a.className=a.className.replace(/L/g,"R");a.style.top=b.top-d+"px";a.style.left=b.left-a.offsetWidth+e+"px"}a.forWard=c}function j(a,b){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack(a,b)}var b=a.lib.kit.extra.language,c=6,d=59,e="#L{点击图片添加标签，还可添加%s个标签}",f='<#et data data><li node-type="pic" action-type="select_pic" pid="${data.pid}" suda-data="key=pub_pic_upload&value=main_pub_changethumb"><a href="javascript:void(0);"><img class="S_line2" width="50" height="50" src="${data.src}"></a></li></#et>',g='<i class="W_loading" style="margin-top: 142px;"></i>',h='<div class="W_layer W_layer_pop"><div class="content"><div class="W_layer_close"><a href="javascript:void(0);" action-type="close" class="W_ficon ficon_close S_ficon">X</a></div><div class="layer_add_tag"><div class="W_layer_con_tit"><h1 class="W_f14 W_fb">#L{添加标签：}</h1><h2 class="clearfix"><span class="tit_txt W_fl" node-type="tip"></span><span class="W_fr"><a href="javascript:void(0);" suda-data="key=pub_pic_upload&value=main_pub_tagcomplete" action-type="ok" class="W_btn_a">#L{完成}</a></span></h2></div><div class="pic_choose_box clearfix" node-type="slider"><a href="javascript:void(0);" class="arrow_left_small arrow_dis S_bg2"  action-type="slider_prev" node-type="slider_prev" title="#L{上一页}"><i class="W_ficon ficon_arrow_left S_ficon">b</i></a><div class="stage_box"><ul class="choose_box clearfix" node-type="pic_list" style="-webkit-transition: margin-left .3s ease;-moz-transition: margin-left .3s ease;transition: margin-left .3s ease;"></ul></div><a href="javascript:void(0);" class="arrow_right_small S_bg1" action-type="slider_next" node-type="slider_next" title="#L{下一页}"><i class="W_ficon ficon_arrow_right S_ficon">a</i></a></div><div class="need_pic addtag_cur"><img/><div node-type="canvas" style="position:absolute;top:0;left:0;background:url(about:blank);"></div></div></div><div class="W_layer_arrow"><span node-type="arrow" class="W_arrow_bor W_arrow_bor_t"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div></div>',i={add:'<span class="tag_addpicL"><span class="inner"><a href="javascript:void(0);" class="inner_call" title="#L{添加人物标签}">#L{@这是谁}</a><a href="javascript:void(0);" class="inner_topic" title="#L{添加话题标签}">#L{说点什么}</a></span></span>',topic_editor:'<a href="javascript:void(0);" class="tag_editpicL tag_editTopicL"><span class="inner"><input type="text" placeholder="#L{说点什么}"></span></a>',user_editor:'<a href="javascript:void(0);" class="tag_editpicL tag_editUserL"><span class="inner"><i class="codetag">@</i><input type="text" class="" placeholder="添加人物标签"></span></a>',topic_show:'<a href="javascript:void(0);" node-type="tag" class="tag_showpicL tag_showTopicL"><span class="inner"><em class="txt W_autocut">{content}</em><em class="W_ficon ficon_close S_ficon" action-type="delete_tag" title="#L{关闭}">X</em></span></a>',user_show:'<a href="javascript:void(0);" node-type="tag" class="tag_showpicL tag_showUserL"><span class="inner"><i class="codetag">@</i><em class="txt W_autocut">{content}</em><em class="W_ficon ficon_close S_ficon" action-type="delete_tag" title="#L{关闭}">X</em></span></a>'};return function(m,n){function G(){var b=o.getDomList().canvas;a.removeEvent(b,"mousedown",C);a.removeEvent(document,"mousemove",D);a.removeEvent(document,"mouseup",E)}function F(){j("pub_pic_upload","main_pub_cover");o.edited=!1;var b=o.getDomList().canvas;a.addEvent(b,"mousedown",C);a.addEvent(document,"mousemove",D);a.addEvent(document,"mouseup",E)}function E(){if(B){a.preventDefault(event);k(B.tag,B.tag.pos);B=undefined;j("pub_pic_upload","main_pub_move")}}function D(b){a.preventDefault(b);if(B){b=a.fixEvent(b);var c=b.pageX-B.startLeft,d=b.pageY-B.startTop;B.tag.pos.left=c;B.tag.pos.top=d;k(B.tag,B.tag.pos,"last");o.getDomList().canvas.setAttribute("changed","changed")}}function C(b){b=a.fixEvent(b);var c=b.target,d=o.getDomList().canvas;if(c===d&&q()){var e={};e.top=b.clientY-d.getBoundingClientRect().top+7;e.left=b.clientX-d.getBoundingClientRect().left+10;I.remove().appendTo(d).setPosition(e);B=undefined}else{var f;c.getAttribute("node-type")=="tag"?f=c:f=a.core.dom.dir.parent(c,{expr:"[node-type=tag]"})[0];if(f){I.remove();a.preventDefault(b);B={tag:f,startLeft:b.pageX-f.pos.left,startTop:b.pageY-f.pos.top}}else B=undefined}}function A(b){var c=a.core.dom.dir.parent(b.el,{expr:"[node-type=tag]"})[0];a.removeNode(c);o.getDomList().canvas.setAttribute("changed","changed")}function z(a){var b=Math.max(0,o.getDomList().pic_list.childNodes.length-c);x(b)}function y(a){x(0)}function x(a){var b=Math.max(0,o.getDomList().pic_list.childNodes.length-c);a=Math.max(0,Math.min(b,a));o.getDomList().pic_list.style.marginLeft=-d*a+"px";var e=o.getDomList().slider_prev,f=o.getDomList().slider_next;a==0?e.className="arrow_left_small arrow_dis S_bg2":e.className="arrow_left_small S_bg1";a==b?f.className="arrow_right_small arrow_dis S_bg2":f.className="arrow_right_small S_bg1";H=a}function w(b){t();var d=b.el,e=d.getAttribute("tags"),f=d.getAttribute("pid"),h=o.getDomList().canvas,i=0;a.foreach(d.parentNode.childNodes,function(b,c){if(d===b){i=c;a.addClassName(b.firstChild,"current")}else a.removeClassName(b.firstChild,"current")});i==H?x(H-1):i==H+c-1&&x(H+1);a.replaceNode(a.builder(g).box.firstChild,h.previousSibling);h.parentNode.style.height="300px";h.setAttribute("pid",f);h.removeAttribute("changed");I.remove();var j=new Image;j.onload=function(){h.innerHTML="";h.parentNode.style.height="";j.onload=null;a.replaceNode(j,h.previousSibling);j.removeAttribute("width");j.removeAttribute("height");h.removeAttribute("changed");setTimeout(function(){h.style.width=j.offsetWidth+"px";h.style.height=j.offsetHeight+"px";h.style.left=(h.parentNode.offsetWidth-j.offsetWidth)/2+"px";h.style.top=(h.parentNode.offsetHeight-j.offsetHeight)/2+"px";s(e);e==="[]"&&I.appendTo(h).setPosition({left:Math.max(0,j.offsetWidth/2-80),top:Math.max(0,j.offsetHeight/2-18)})})};j.src=a.lib.kit.extra.imageURL(f,{size:"bmiddle"})}function v(){t();var b={},c={};a.foreach(a.sizzle("[node-type=pic]",o.getDomList().pic_list),function(d){var e=a.strToJson(d.getAttribute("tags"));if(e.length){b[e[0].pid]=e;c[e[0].pid]=a.foreach(e,function(a){return{tag:a.content,tag_type:{"@":"user","#":"topic"}[a.flag],tag_object_id:a.object_id,pos:{x:a.x.toFixed(2),y:a.y.toFixed(2)}}})}});for(var d in c)break;if(d)a.conf.trans.image.request("getTags",{onSuccess:function(a){o.trigger("setTags",[a.data,b]);o.hide()},onFail:function(b){a.lib.dialog.ioError(b.code,b)},onError:function(b){a.lib.dialog.ioError(b.code,b)}},{photo_tag:encodeURIComponent(a.jsonToStr(c))});else{o.trigger("setTags",[{},b]);o.hide()}}function u(c){t();o.edited==!1?o.hide():a.ui.tipConfirm(b("#L{是否保存编辑过的标签？}")).beside(c.el).ok(b("#L{保存}"),function(){v()}).cancel(b("#L{不保存}"),function(){setTimeout(function(){o.hide()})})}function t(){var b=o.getDomList().canvas,c=o.getDomList().pic_list,d=b.getAttribute("pid"),e=b.getAttribute("changed");if(d&&e){o.edited=!0;var f=a.sizzle("[node-type=pic][pid="+d+"]",c)[0],g=[];a.foreach(a.sizzle("[node-type=tag]",b),function(a){g.push({pid:d,content:a.content,flag:a.flag,x:a.pos.left/a.parentNode.offsetWidth,y:a.pos.top/a.parentNode.offsetHeight,object_id:a.object_id})});f.setAttribute("tags",a.jsonToStr(g))}}function s(b){var c=o.getDomList().canvas;a.foreach(a.strToJson(b),function(a){p(a.flag,a.content,a.object_id,{left:c.offsetWidth*a.x,top:c.offsetHeight*a.y})});q()}function r(){var b;a.foreach(m,function(c){var d=o.getDomList().pic_list.appendChild(a.builder(a.core.util.easyTemplate(f,{pid:c.pid,src:a.lib.kit.extra.imageURL(c.pid,{size:"square"})}).toString()).list.pic[0]);d.setAttribute("tags",c.tags);c.pid===n&&(b=d)});b&&o.trigger(b,"click");m.length<2&&(o.getDomList().slider.style.display="none")}function q(){var c=o.getDomList().tip,d=o.getDomList().canvas,f=a.sizzle("[node-type=tag]",d).length,g=5-f;c.innerHTML=b(e,Math.max(0,g));return g>0}function p(c,d,e,f){var g={"@":"user_show","#":"topic_show"},h=o.getDomList().canvas,j=a.builder(b(i[g[c]].replace("{content}",a.encodeHTML(d)))).box.firstChild;h.appendChild(j);j.pos=f;j.content=d;j.flag=c;j.object_id=e;k(j,j.pos);o.getDomList().canvas.setAttribute("changed","changed");q()}m=a.strToJson(m);var o=a.ui.bubble(b(h),{showWithAni:!1,hideWithAni:!1}),B,H=0,I=l(p);o.on("select_pic","click",w);o.on("slider_prev","click",y);o.on("slider_next","click",z);o.on("delete_tag","click",A);o.on("ok","click",v);o.on("close","click",u);o.on("show",F);o.on("hide",G);r();return o}});
STK.register("lib.image.multiimage.dragRank",function(a){return function(b){var c=b.preList,d={},e=[],f=[],g={},h=!1,i,j,k,l,m,n=!1,o=!1,p={getTargets:function(b){var c=e;for(var d in c)if(a.contains(c[d],b)||b==c[d])return function(a){return{dom:e[a],index:a}}(d);return!1},getDrop:function(a){for(var b=0;e[b];b++){var c=f[b];if(a.pageX>c.l&&a.pageX<c.l+g.width&&a.pageY>c.t&&a.pageY<c.t+g.height){var d=a.pageX-c.l>g.width/2?!0:!1;return function(a){return{tar:e[a],left:d,index:a}}(b)}}return!1},getEffectTar:function(b){var c=a.C("ul");a.addClassName(c,"drag_pic_list");var d=b.cloneNode();d.innerHTML=b.innerHTML;a.addClassName(b,"move");c.appendChild(d);return c},insertArr:function(a,b,c){var d=[],e=a.length;if(b>c)for(var f=0;f<e;f++){f<c&&d.push(a[f]);if(f==c){d.push(a[b]);d.push(a[f])}f>c&&f!=b&&d.push(a[f])}else if(b<c)for(var f=0;f<e;f++)f<b?d[f]=a[f]:f<c?d[f]=a[f+1]:f==c?d[f]=a[b]:f>c&&(d[f]=a[f]);else d=a;return d}},q={mousedown:function(b){var b=a.fixEvent(b);if(!b.target||!b.target.getAttribute("action-type")){if(!n){s();n=!0}var c=p.getTargets(b.target);if(!c)return;document.body.style.cssText="-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;";document.body.setAttribute("onselectstart","return false;");h=c;j=a.position(h.dom);i={x:b.clientX,y:b.clientY};k=p.getEffectTar(h.dom);k.style.position="absolute";k.style.zIndex="9999";k.style.top=j.t;k.style.left=j.l;document.body.appendChild(k)}},mousemove:function(b){if(!!h){var b=a.fixEvent(b),c={x:b.clientX,y:b.clientY},d=j.l+c.x-i.x,f=j.t+c.y-i.y;d<l.l&&(d=l.l);d>l.l+m.width-g.width&&(d=l.l+m.width-g.width);f<l.t&&(f=l.t);f>l.t+m.height-g.height&&(f=l.t+m.height-g.height);k.style.left=d+"px";k.style.top=f+"px";var n=p.getDrop(b);if(n){if(n.tar==h.dom||n.index==h.index)return;n.index>h.index?a.insertAfter(h.dom,e[n.index]):a.insertBefore(h.dom,e[n.index]);e=p.insertArr(e,h.index,n.index);h.index=n.index}}},mouseup:function(b){if(!!h){var b=a.fixEvent(b);document.body.style.cssText="";document.body.removeAttribute("onselectstart","return false;");a.removeNode(k);a.removeClassName(h.dom,"move");h=!1;s();a.custEvent.fire(d,"setExtra",{});o||window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_new_image_upload","drag_pic")}}},r=function(){a.custEvent.define(d,["setExtra"]);a.addEvent(document.body,"mousedown",q.mousedown);a.addEvent(document.body,"mousemove",q.mousemove);a.addEvent(document.body,"mouseup",q.mouseup)},s=function(){e=a.sizzle("li",c);e.pop();if(!!e[0]){g=a.core.dom.getSize(e[0]);f=[];for(var d=0;e[d];d++)f.push(a.position(e[d]));l=a.position(b.box);m=a.core.dom.getSize(b.box)}},t=function(){s();r()};t();d.freshDom=s;d.destroy=function(){o=null;a.removeEvent(document.body,"mousedown",q.mousedown);a.removeEvent(document.body,"mousemove",q.mousemove);a.removeEvent(document.body,"mouseup",q.mouseup)};return d}});
STK.register("lib.image.multiimage.preview",function(a){var b=$CONFIG.imgPath,c='<#et loading data><span class="txt S_txt1"><img class="picloading" src="'+b+'style/images/common/loading.gif">${data.filename}</span>'+'<a href="javascript:;" action-type="deleteImg"  title="#L{删除}" class="ico_delpic"></a>'+"</#et>",d='<#et image data><li class="loading" node-type="${data.type}">'+c+"</li>"+"</#et>",e='<#et err data><span class="txt S_txt1">${data.text}</span><span class="txt2 S_txt1">${data.filename}</span><a href="javascript:;" title="#L{删除}" action-type="deleteImg" class="ico_delpic"></a></#et>',f='<#et retry data><span class="txt S_txt1">#L{上传失败}<a class="W_btn_b" href="javascript:;" action-type="retryLoad" action-data="fid=${data.fid}"><span>#L{重传}</span></a></span><a href="javascript:;" title="#L{删除}" action-type="deleteImg" class="ico_delpic"></a></#et>';return function(b,g){var h=a.lib.kit.extra.language,i=g.refer&&g.refer.getAttribute("phototag")==="false",j=g.refer,k='<div class="layer_pic_list clearfix" node-type="box"><div class="W_layer_con_tit"><h1 class="W_f14 W_fb">#L{本地上传}</h1><h2 class="clearfix"><span class="tit_txt W_fl" node-type="picsInfo"></span><span class="W_fr"><a href="javascript:void(0);" class="W_btn_a" action-type="addTag" node-type="title_addTag" suda-data="key=pub_pic_upload&value=main_pub_tag"><em class="W_ficon ficon_add S_ficon">+</em>#L{标签}</a></span></h2></div><ul class="drag_pic_list clearfix" node-type="preList" special-node="weibo_pic_preList_ul"><li class="add" node-type="uploadBtn"><a href="javascript:;" title="">+</a></li></ul>'+(i?"":'<div node-type="tagtip" class="layer_tips_version layer_tips_intro" style="display:none; left:-165px; top:56px;z-index:9999"><div class="layer_tips_bg"><a class="W_ico12 icon_close" action-type="hideTip" href="javascript:;"></a><div class="layer_tips_cont"><p>#L{新功能！鼠标移到图片上点击}<i class="ico_showtag"></i>#L{就能给图片加标签}</p></div><span class="arrow_right"></span></div></div>')+"</div>"+"",l='<#et image data><div style="background:url(${data.src}) center center;width:80px;height:80px;"></div><span class="picbg"></span>'+(location.protocol=="http:"?'<a action-type="editImg" href="javascript:;" class="ico_editpic"></a><a href="javascript:;" action-type="deleteImg" class="ico_delpic"></a>':'<a href="javascript:;" action-type="deleteImg" class="ico_delpic"></a>')+"<#if (!data.isReEdit)>"+(i?"":'<span class="tag_v2"><a suda-data="key=pub_pic_upload&value=main_pub_tag" action-type="addTag"  node-type="addTag" href="javascript:;" class="W_btn_d"><em class="W_ficon ficon_add">+</em>#L{标签}</a></span>')+'<i style="display:none;" class="W_icon icon_taged_pic"></i>'+"</#if>"+"</#et>",m=a.parseParam({templete:h(k)},g),n=9,o={},p,q,r,s,t,u,v,w={},x=!1,y={},z={},A,B={init:function(){F.setNumInfo()},uploading:function(b,c){a.custEvent.fire(o,"loading");(!r||!r.getState())&&I();var e=b.data,f={},g=e.length;for(var i=0;i<g;i++){var j=F.getFileName(e[i].name),k=F.getFileType(e[i].name)||e[i].filetype||"";w[e[i].fid]={name:j,filetype:k};f[e[i].fid]={name:j}}var l="";for(var m in f)l+=a.core.util.easyTemplate(h(d),{type:m,filename:f[m].name||""});var n=a.builder(l),p=a.lib.kit.dom.parseDOM(n.list);for(var i in p)w[i].imgnode=p[i];a.insertBefore(n.box,q.uploadBtn);F.setNumInfo();D()},uploaded:function(b){!b.data.media_id&&w[b.fid].filetype.toLowerCase()=="gif"?a.conf.trans.image.request("transGif",{onComplete:function(a){if(a.code=="10000"){b.data.media_id=a.data.media_id;b.data.object_id=a.data.object_id;b.data.transGifStatus=1}else{b.data.transGifStatus=3;b.data.transGifMsg=a.data}C(b)},timeout:1e4,onTimeout:function(){b.data.transGifStatus=2;C(b)}},{source:2637646381,uid:$CONFIG.uid,pid:b.data.pid}):C(b)},error:function(b){if(b.type=="singleError"){b.data.sourceData&&b.data.sourceData.code=="A20001"?w[b.fid].imgnode.innerHTML=a.core.util.easyTemplate(h(e),{text:h("#L{文件格式错误}"),filename:w[b.fid].name||""}):w[b.fid].imgnode.innerHTML=a.core.util.easyTemplate(h(f),{fid:b.fid});w[b.fid].imgnode.className="opt";w[b.fid].err=1;F.setNumInfo()}if(b.type=="fileNumErr")return F.getReFileNum();b.type=="fileSizeErr"&&setTimeout(function(){var c=b.data.sizeErrAry.length;for(var d=0;d<c;d++){var f=a.getUniqueKey();B.uploading({data:[{fid:f,name:b.data.sizeErrAry[d]||""}]});w[f].imgnode.innerHTML=a.core.util.easyTemplate(h(e),{text:h("#L{图片大于20M}"),filename:w[f].name||""});w[f].imgnode.className="opt";w[f].err=1}F.setNumInfo()},30);if(b.type=="defaultErr"){w[b.fid].imgnode.innerHTML=a.core.util.easyTemplate(h(e),{text:h("#L{上传失败}"),filename:w[b.fid].name||""});w[b.fid].imgnode.className="opt";w[b.fid].err=1;F.setNumInfo()}},extra:function(a){a.type=="beclicked"&&window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_new_image_upload","fast_upload")}},C=function(b){var c=a.lib.kit.extra.imageURL(b.data.pid,{size:"square"}),d=q.box.getAttribute("isReEdit")?1:0;w[b.fid].pid=b.data.pid;F.togglePid(!0,b.data.pid);var e=a.C("img");e.onload=function(){e.onload=null;if(w[b.fid]){w[b.fid].imgnode.innerHTML=a.core.util.easyTemplate(h(l),{src:c,isReEdit:d});a.removeClassName(w[b.fid].imgnode,"loading");a.addClassName(w[b.fid].imgnode,"pic")}};e.src=c;w[b.fid].imgnode.setAttribute("action-data",b.data.pid);(b.data.transGifStatus||b.data.media_id)&&w[b.fid].imgnode.setAttribute("gif-data",(b.data.media_id||"")+"|"+(b.data.object_id||""));if(b.data.transGifStatus){var f=$CONFIG.uid,g=(new Date).toLocaleString();a.conf.trans.image.request("transGifLog",{},{gif_to_video_log:g+"|"+f+"|"+b.data.pid+"|"+b.data.transGifStatus+"|"+(b.data.transGifMsg||"")+"|"+(b.data.media_id||"")+"|"+(b.data.object_id||"")})}F.setExtra();(function(){if(!x){var b=a.sizzle("li",q.preList);if(b[0]&&b[1]){a.addClassName(b[0],"first");function c(){a.removeClassName(b[0],"first");a.removeEvent(b[0],"mouseover",c)}a.addEvent(b[0],"mouseover",c);x=!0}}})()},D=function(){t||(t=a.lib.image.mUpload(q.uploadBtn,{h:80,w:80,number:F.getReFileNum(),init:B.init,uploading:B.uploading,uploaded:B.uploaded,error:B.error,extra:B.extra,file_source:1}))},E={restore:function(){var a=STK.core.util.storage.get("editor_multiimage"+$CONFIG.uid);return a!="null"&&a!=null&&a.length!=0?a:!1},store:function(a){(!j||!j.getAttribute("tid"))&&STK.core.util.storage.set("editor_multiimage"+$CONFIG.uid,a)},delWord:function(){STK.core.util.storage.del("editor_multiimage"+$CONFIG.uid)}},F={getExtraInfo:function(a,b){var c=F.getImgNode(a);return c?c.getAttribute(b):null},getImgNode:function(a){if(a==document.body)return null;if(a.tagName.toLowerCase()=="li")return a;a=a.parentNode;return arguments.callee(a)},setExtra:function(){var b="";for(var c in w)if(w[c]&&!w[c].pid&&!w[c].err)return;var d=a.sizzle("li",q.preList),e="";for(var f in d){var g=d[f].getAttribute("action-data");if(g){var i=d[f].getAttribute("gif-data");b+=g+" ";e+=g+(i?"|"+i:"")+" "}}E.store(e);a.custEvent.fire(o,"setExtra",{pids:b,all_ids:e,text:h("#L{分享图片}")});v&&v.freshDom();if(!v){v=a.lib.image.multiimage.dragRank(q);a.custEvent.add(v,"setExtra",F.setExtra)}},getNumInfo:function(){var a=0;for(var b in w)w[b]&&!w[b].err&&a++;return a},setNumInfo:function(){var b=F.getNumInfo();if(b<n){q.uploadBtn.style.cssText="";q.picsInfo.innerHTML=h("#L{共%s张，还能上传%s张}",'<em class="num_totla">'+b+"</em>",'<em class="num_remain">'+(n-b)+"</em>")}else{q.uploadBtn.style.cssText="margin-left:-10000px;";q.picsInfo.innerHTML=h('<em class="error_txt">#L{最多选择9张图片上传}</em>')}b>0?a.removeClassName(q.title_addTag,"W_btn_a_disable"):a.addClassName(q.title_addTag,"W_btn_a_disable");if(t){t.resetFileNum(n);t.resetUploadedFileNum(b)}},getReFileNum:function(){var a=F.getNumInfo();return n-a>0?n-a:0},getFileName:function(b,c){var b=b||"",c=c||8,d=b.length,e=b.replace(/\*/g," ").replace(/[^\x00-\xff]/g,"**"),f=e.slice(e.length-c-1,e.length).replace(/\*\*/g," ").replace(/\*/g,"").length;if(e.length>c&&c>0&&d-f-1>0){b=b.slice(d-f-1,d);b="..."+b}return a.encodeHTML(b)},getFileType:function(a){var a=a||"",b=a.split(".");return b.length>1?b[b.length-1]:""},isReEdit:function(){console.log(q)},getAcData:function(b){if(!!b){var c=b.getAttribute("action-data"),d=c&&a.queryToJson(c)||!1;return d}},deletePid:function(a,b){if(!!a&&!!b){var c=a.split("|"),d=c.indexOf(b);d>-1&&c.splice(d,1);return c.join("|")}},addPid:function(a,b){if(!!b){var c=a?a.split("|"):[],d=c.indexOf(b);d==-1&&c.push(b);return c.join("|")}},reassemble:function(b,c){if(!!b&&!!c){var d=b.getAttribute("action-data"),e=d&&a.queryToJson(d)||!1;if(!e)return;for(var f in c)e[f]=c[f];b.setAttribute("action-data",a.jsonToQuery(e))}},togglePid:function(b,c){if(!!c){var d=b,e=a.sizzle('[node-type="multiimage"]');if(e&&e[0]){var f=F.getAcData(e[0]),g=f.pic_id;g=d?F.addPid(g,c):F.deletePid(g,c);F.reassemble(e[0],{pic_id:g})}}}},G={editImg:function(b){a.preventDefault();var c=F.getExtraInfo(b.el,"node-type"),d=F.getExtraInfo(b.el,"action-data"),e=function(a){B.uploaded({data:{pid:a},fid:c})};if(a.lib.kit.extra.getFlashVersion()<10)a.lib.kit.extra.installFlash();else{var f={id:"photo_editor",pos:r.getPosition(),service:location.protocol+"//picupload.weibo.com/interface/pic_upload.php?app=miniblog&s=xml&cb=//weibo.com/upimgback.html&rq=http%3A%2F%2Fphoto.i.weibo.com%2Fpic%2Fadd.php%3Fapp%3D1",sucess:e,h:385,w:528,swf:"PhotoEditor.swf"};a.lib.image.imgUpload(f,{init:function(b,c){b.setPars(a.lib.kit.extra.imageURL(d,{size:"large"}))},close:function(a,b){}}).show()}},deleteImg:function(b){var c=F.getImgNode(b.el),d=c.getAttribute("node-type"),e=c.getAttribute("action-data");w&&w[d]&&(w[d]=null);a.removeNode(c);t.removeFile(d);F.setExtra();F.setNumInfo();F.togglePid(!1,e);delete y[e];delete z[e];a.custEvent.fire(o,"setTags",{tags:a.jsonToStr(y),taginfos:a.jsonToStr(z)})},retryLoad:function(b){var d=b.data.fid;w[d].imgnode.innerHTML=a.core.util.easyTemplate(h(c),{filename:w[d].name||""});w[d].imgnode.className="loading";t.reuploadById(d)},close:function(){r.hide()},sendData:function(){},addTag:function(c){if(!a.core.dom.hasClassName(c.el,"W_btn_a_disable")){var d=a.core.dom.dir.parent(c.el,{expr:"li[action-data]"})[0],e=a.sizzle("li[action-data]",r.getBox());if(e.length==0)return;var f=d?d.getAttribute("action-data"):e[0].getAttribute("action-data"),i=a.foreach(e,function(a){var b=a.getAttribute("action-data"),c=a.getAttribute("tags")||"[]";return{pid:b,tags:c}});A=a.lib.image.multiimage.multiAddTags(a.jsonToStr(i),f);A.setArrow("top").show().setAlignPos(b,g.refer,g);A.on("setTags",function(b,c,d){a.foreach(e,function(b){var e=b.getAttribute("action-data");z=d;y=c;var f=z[e];if(f){b.setAttribute("tags",a.jsonToStr(f));a.sizzle("[action-type=addTag]",b)[0].innerHTML=h('<i class="icon_imgtag"></i>#L{编辑}');a.sizzle(".W_icon.icon_taged_pic",b)[0].style.display=""}else{b.removeAttribute("tags");a.sizzle("[action-type=addTag]",b)[0].innerHTML=h('<em class="W_ficon ficon_add">+</em>#L{标签}');a.sizzle(".W_icon.icon_taged_pic",b)[0].style.display="none"}});a.custEvent.fire(o,"setTags",{tags:a.jsonToStr(y),taginfos:a.jsonToStr(z)})});G.hideTip()}},hideTip:function(){q.tagtip.style.display="none";a.conf.trans.image.getTrans("hidetip",{onSuccess:function(){q.tagtip.style.display="none"},onError:function(){}}).request({bid:55})}},H=function(){s.add("editImg","click",G.editImg);s.add("deleteImg","click",G.deleteImg);s.add("retryLoad","click",G.retryLoad);s.add("addTag","click",G.addTag);s.add("hideTip","click",G.hideTip);a.addEvent(u,"click",G.sendData);a.custEvent.define(o,["setTags","setExtra","hide","insert","deletePIC","picLoad","loading"])},I=function(){if(r)r.setArrow("top").setAlignPos(b,g.refer,g);else{r=a.ui.bubble({showWithAni:null,hideWithAni:null});r.setContent(q.box);r.setArrow("top").setAlignPos(b,g.refer,g);u=r.getDomList().close;r.on("hide",function(){for(var b in w)try{w[b]&&w[b].imgnode&&a.removeNode(w[b].imgnode);t.removeFile(b);w[b]=null}catch(c){}y={};z={};a.custEvent.fire(o,"setTags",{tags:a.jsonToStr(y),taginfos:a.jsonToStr(z)});w={};F.setExtra();a.custEvent.fire(o,"hide",{});v&&v.destroy();v=null})}},J=function(){p=a.core.dom.builder(m.templete);q=a.lib.kit.dom.parseDOM(p.list);s=a.core.evt.delegatedEvent(q.box)},K=function(){r&&r.setAlignPos(b,g.refer,g)},L=function(){r.show()},M=function(){r.startBoxClose();r.hide()},N=function(){J();H()},O=function(){},P=function(){},Q=function(){var a=F.getNumInfo();return a<n?!1:!0},R=function(a){return q[a]||null};N();var S=function(){if(r){r.hide();r.destroy&&r.destroy()}s.destroy();a.removeEvent(u,"click",G.sendData);w=null;r=null;v&&v.destroy&&v.destroy();v=null;A&&A.destroy&&A.destroy()};o.destroy=S;o.uploading=B.uploading;o.uploaded=B.uploaded;o.error=B.error;o.extra=B.extra;o.show=L;o.hide=M;o.isOutstanding=Q;o.getNumInfo=F.getNumInfo;o.getDomList=R;return o}});
STK.register("lib.publisher.widget.imgPreview",function(a){return function(b){var c,d={},e={restore:function(){var a=STK.core.util.storage.get("editor_multiimage"+$CONFIG.uid);return a!="null"&&a!=null&&a.length!=0?a:!1},store:function(a){b.nodeList.textEl.getAttribute("tid")||STK.core.util.storage.set("editor_multiimage"+$CONFIG.uid,a||"")},delWord:function(){STK.core.util.storage.del("editor_multiimage"+$CONFIG.uid)}},f=function(a,c){var d=b.API.getImageLogType();b.API.addShortUrlLog(d);b.API.insertText(c.value);image.getBub().hide()},g=function(a,c){var d=(c.all_ids||"").split(" "),f=[];STK.core.arr.foreach(d,function(a){a.split("|")[1]&&f.push(a)});b.API.addExtraInfo("pic_id="+c.pids+"&gif_ids="+f.join(","));e.store(c.all_ids||c.pids);if(c.pids=="")b.API.delWords(c.text);else{var g=b.API.getWords();g.length==0&&b.API.insertText(c.text)}},h=function(a,c){if(c.tags=="{}"){b.nodeList.textEl.removeAttribute("tags");b.nodeList.textEl.removeAttribute("taginfos")}else{b.nodeList.textEl.setAttribute("tags",encodeURIComponent(c.tags));b.nodeList.textEl.setAttribute("taginfos",encodeURIComponent(c.taginfos))}},i=function(){var d=a.sizzle('a[action-type="multiimage"],a[node-type="more"]',b.nodeList.widget);if(!!d[0]){var e=b.nodeList.textEl;c=a.lib.image.multiimage.preview(d[0],{refer:e});j();b.getPreview=function(){return c}}},j=function(){a.custEvent.add(c,"setExtra",g);a.custEvent.add(c,"insert",f);a.custEvent.add(c,"setTags",h)};i();var k=function(){if(c){a.custEvent.remove(c,"setExtra",g);a.custEvent.remove(c,"insert",f);c.destroy()}};d.destroy=k;return d}});
STK.register("lib.publisher.widget.settime",function(a){function f(a,b){return(Array(b).join(0)+a).slice(-b)}var b=a.lib.kit.extra.language,c=["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],d=["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59"],e=b('<#et settimetip data><div class="set_timer S_line1 S_bg1 clearfix" node-type="settime" style="display: none;"><span class="set_date_txt W_fl">#L{发布时间：}</span><div class="set_data_mod W_fl S_line3 clearfix" action-type="settime_data" action-data="start=${data.startDate}&end=${data.endDate}"><input type="text" value="${data.startDate}" class="ipt W_fl" readonly="true" node-type="settime_data"> <i class="icon_calendar W_fr"></i></div><select class="sel_time S_line1 W_fl" action-type="settime_hour" node-type="settime_hour"><#list data.hourList as eachHour><option value="${eachHour}" <#if (eachHour_index == data.hour)>selected="true"</#if> >${eachHour}</option></#list></select><span class="set_time_txt W_fl">#L{时}</span><select class="sel_time S_line1 W_fl" action-type="settime_min" node-type="settime_min"><#list data.minuteList as eachMinute><option value="${eachMinute}" <#if (eachMinute_index == data.minute)>selected="true"</#if> >${eachMinute}</option></#list></select><span class="set_time_txt W_fl">#L{分}</span><a title="#L{取消发布定时微博}" href="javascript:void()" action-type="close" class="W_ficon ficon_close S_ficon">X</a><a target="_top" href="http://weibo.com/${data.uid}/profile?profile_ftype=1&timefeed=1" node-type="timing_blog_manage" class="rt_txt W_fr">#L{管理待发布微博}</a></div></#et>');return function(g){var h={},i,j,k=function(){g.nodeList.settime||function(){var b=new Date(+(new Date)+3e5),h=new Date(+b+6048e5),i=a.builder(a.core.util.easyTemplate(e,{hourList:c,minuteList:d,startDate:[b.getFullYear(),f(b.getMonth()+1,2),f(b.getDate(),2)].join("-"),endDate:[h.getFullYear(),f(h.getMonth()+1,2),f(h.getDate(),2)].join("-"),hour:b.getHours(),minute:b.getMinutes(),uid:$CONFIG.uid}).toString()).list;g.nodeList.textElDiv.appendChild(i.settime[0]);for(var j in i)g.nodeList[j]||(g.nodeList[j]=i[j][0])}();var h=g.nodeList.settime&&a.getStyle(g.nodeList.settime,"display");if(h==="none"){j=g.nodeList.submit.innerHTML;g.nodeList.settime.style.display="";g.nodeList.submit.innerHTML=b("#L{定时发布}");a.addClassName(g.nodeList.textElDiv,"input_set_timer");var k=a.delegatedEvent(g.nodeList.settime),l={settime_date:function(b){var c=(b.data.end||"").split(" ")[0],d=(b.data.start||"").split(" ")[0];!i&&(i=a.ui.calendar({start:d||mTime().ymd,end:c,callback:function(a){g.nodeList.settime_data.value=a;l.changed();i.hide()}}));i.show(b.el,{appendTo:document.body,pos:"bottom-left"})},settime_hour:function(){},settime_min:function(){},changed:function(){var a=g.nodeList.settime_data.value+" "+g.nodeList.settime_hour.value+":"+g.nodeList.settime_min.value;g.nodeList.textEl.setAttribute("settime",a)},reset:function(){a.removeClassName(g.nodeList.textElDiv,"input_set_timer");g.nodeList.textEl.setAttribute("settime","");g.nodeList.submit.innerHTML=j},changeBtn:function(a,b){j=b},close:function(){l.reset()}},m=function(){k.add("settime_data","click",l.settime_date);k.add("close","click",l.close);a.addEvent(g.nodeList.settime_data,"change",l.changed);a.addEvent(g.nodeList.settime_hour,"change",l.changed);a.addEvent(g.nodeList.settime_min,"change",l.changed);a.core.evt.custEvent.define(g,["resettime","changeBtn"]);a.core.evt.custEvent.add(g,"resettime",l.reset);a.core.evt.custEvent.add(g,"changeBtn",l.changeBtn)};m();l.changed()}};h.init=function(b,c,d){g=b;aim=c;a.addEvent(b.nodeList[aim],"click",k)};h.destroy=function(){a.removeEvent(owner.nodeList[aim],"click",k);a.core.evt.custEvent.undefine(g,["resettime","changeBtn"]);a.core.evt.custEvent.remove(g,"resettime",bindDomFuns.reset);a.core.evt.custEvent.remove(g,"changeBtn",bindDomFuns.changeBtn)};h.show=k;return h}});
STK.register("lib.publisher.widget.blog",function(a){return function(b,c){function k(c){var d;b.nodeList.extradata&&(d=a.lib.publisher.source.formdata(b.nodeList.extradata));var e="//weibo.com/guide/article";if(c&&c.data&&c.data.extend){e+=e.indexOf("?")>=0?"&":"?";e+="extend="+c.data.extend}if(d){e+=e.indexOf("?")>=0?"&":"?";var g=d.read()||{};g.defaultText=b.nodeList.textEl.defaultValue||"";$CONFIG.page_id&&$CONFIG.domain&&(g.domain=$CONFIG.domain);e+="weiboParams="+encodeURIComponent(a.jsonToStr(g))}f=a.ui.dialog({template:'<div style="width:662px;height:512px;position:absolute;z-index:9999;"><iframe allowtransparency="true" style="background:transparent" node-type="iframe" width="662" height="100%" frameborder="no" scrolling="no" _src="'+e+'"></iframe></div>'});var j=function(c){b.API.insertText(c.text+" ");a.ui.notice(c.tip).on("hide",function(){if(!!b.nodeList.textElDiv)var c=0,d=setInterval(function(){c%2==1?a.addClassName(b.nodeList.textElDiv,"clicked"):a.removeClassName(b.nodeList.textElDiv,"clicked");if(c==9){clearInterval(d);c=0}c++},200)})};f.on("show",function(){setTimeout(function(){function d(c){var d=(a.winSize().height-512)/2,e=(a.winSize().width-662)/2;d=d>=0?d:0;if(c){d=0;e=0}b.style.marginTop=d+"px";b.style.marginLeft=e+"px"}var b=f.getOuter(),c=a.sizzle('[node-type="iframe"]',b)[0];h=a.lib.connect.iframe(c);h.on("publish",function(b,c,d){setTimeout(function(){a.conf.channel.feed.fire("publish",[d.data,d.param])},1500)});h.on("insertIntoPublishTop",function(a,b,c,d){function e(a){return typeof a=="string"||a&&typeof a.substr=="function"}e(c)&&(c={text:c});f.hide();j({text:c.text,tip:c.tip||i("#L{添加成功}")})});h.on("setHeight",function(a,b,c,d){b.style.height=c+"px"});h.on("setWidth",function(a,b,c,d){b.style.width=c+"px"});h.on("publishView",function(a,c,d,e){if(b.style.position==="absolute"){c.height="740";b.style.height="740px"}});h.on("editView",function(a,c,d,e){if(b.style.position==="absolute"){c.height="512";b.style.height="512px"}});h.on("fullscreen",function(a,c,d,e){if(!d){document.body.style.overflowY="hidden";b.style.position="fixed";b.style.top="0";b.style.left="0";b.style.width="100%";b.style.height="100%";c.width="100%";c.height="100%";b.style.zIndex="9999"}else{document.body.style.overflowY="";b.style.position="absolute";c.width="662";c.height="512";b.style.width="662px";b.style.height="512px";f.setMiddle();b.style.zIndex="9999"}});h.on("close",function(a,b,c,d){f.hide();d("callback")});h.on("setTittle",function(b,c,d,e){var f=a.sizzle("div",layer.getDomList().inner)[0]||null;f&&(f.innerHTML=d)});f.on("hide",function(){document.body.style.overflowY=""})},10)});f.show().setMiddle()}var d={},e,f,g,h,i=a.lib.kit.extra.language,j=!0,l=function(b){a.core.evt.preventDefault();j?k(b):window.open("http://c.blog.sina.com.cn/cblog.php?from=weibo","newwindow","height=600, left=300,top=100,width=783, toolbar=no, menubar=no, scrollbars=yes, resizable=yes, location=no, status=no")};d.init=function(c,d,f){b=c;e=d;a.addEvent(c.nodeList[e],"click",l)};d.show=l;d.destroy=function(){b=null};return d}});
STK.register("lib.publisher.widget.superTopic",function(a){var b=a.lib.kit.extra.language,c=a.core.util.easyTemplate,d=a.conf.trans.publisher,e=a.lib.kit.extra.textareaUtils,f={"default":b("#L{搜超话}"),hot:c(b('<#et hotCard data><div class="topic_tit clearfix"><span class="W_fl W_f14">#L{最近使用：}</span><span class="W_pagegroup W_fr"><a href="javascript:void(0);" action-type="switch" action-data="type=hot&dir=0" class="W_btn_prev S_line3 ${data.hPage == 1 ? "W_btn_b_disable" : ""}"><em class="W_ficon ficon_arrow_left S_ficon">b</em></a><span class="page_txt">${data.hPage}/${data.hSum}</span><a href="javascript:void(0);" action-type="switch" action-data="type=hot&dir=1" class="W_btn_next S_line3 ${data.hPage == data.hSum ? "W_btn_b_disable" : ""}"><em class="W_ficon ficon_arrow_right S_ficon">a</em></a></span></div><ul class="topic_ul clearfix"><#list data.hList as list><li class="${list.description && list.fans_msg ? "li_a" : list.description ? "li_b" : "li_c"} S_bg1 clearfix" action-type="select" action-data="object_id=${list.object_id}&content=${list.content}&container_id=${list.container_id}"><div class="pic_box"><a href="javascript:void(0);" suda-uatrack=""><img class="pic" src=${list.image} alt=${list.title}></a></div><div class="info_box"><#if (list.title)><div class="title"><a href="javascript:void(0);" class="S_txt1" title=${list.title}>${list.title}</a></div></#if><#if (list.description)><div class="txt"><a href="javascript:void(0);" class="S_txt1">${list.description}</a></div></#if><#if (list.fans_msg)><div class="subtxt"><a href="javascript:void(0);" class="S_txt2">${list.fans_msg}</a></div></#if></div></li></#list></ul></#et>')),query:c(b('<#et queryCard data><div class="topic_tit clearfix"><span class="W_fl W_f14"><a href="javascript:void(0);" action-type="back" class="S_txt1"><em class="W_ficon ficon_arrow_left S_ficon">b</em>#L{返回}</a></span><span class="W_pagegroup W_fr"><a href="javascript:void(0);" action-type="switch" action-data="type=query&dir=0" class="W_btn_prev S_line3 ${data.qPage == 1 ? "W_btn_b_disable" : ""}"><em class="W_ficon ficon_arrow_left S_ficon">b</em></a><span class="page_txt">${data.qPage}/${data.qSum}</span><a href="javascript:void(0);" action-type="switch" action-data="type=query&dir=1" class="W_btn_next S_line3 ${data.qPage == data.qSum ? "W_btn_b_disable" : ""}"><em class="W_ficon ficon_arrow_right S_ficon">a</em></a></span></div><ul class="topic_ul clearfix topic_ul_row1"><#list data.qList as list><li class="${list.description && list.fans_msg ? "li_a" : list.description ? "li_b" : "li_c"} S_bg1 clearfix" action-type="select" action-data="object_id=${list.object_id}&content=${list.content}&container_id=${list.container_id}"><div class="pic_box"><a href="javascript:void(0);" suda-uatrack=""><img class="pic" src=${list.image} alt=${list.title}></a></div><div class="info_box"><#if (list.title)><div class="title"><a href="javascript:void(0);" class="S_txt1" title=${list.title}>${list.title}</a></div></#if><#if (list.description)><div class="txt"><a href="javascript:void(0);" class="S_txt1">${list.description}</a></div></#if><#if (list.fans_msg)><div class="subtxt"><a href="javascript:void(0);" class="S_txt2">${list.fans_msg}</a></div></#if></div></li></#list></ul></#et>')),content:b('<div class="layer_send_topic"><div class="topic_ipt clearfix"><input node-type="search_input" type="text" class="W_input" value="#L{搜超话}"><a href="javascript:void(0);" node-type="search_btn" action-type="search" action-data="type=topic&is_search=1" class="W_btn_a btn_30px W_btn_a_disable">#L{搜索}</a></div><div class="topic_box" node-type="search_box"></div></div>'),empty:c(b('<div class="topic_tit clearfix"><span class="W_fl W_f14"><a href="javascript:void(0);" action-type="back" class="S_txt1"><em class="W_ficon ficon_arrow_left S_ficon">b</em>#L{返回}</a></span></div><div class="WB_empty"><div class="WB_innerwrap"><div class="empty_con clearfix"><p class="icon_bed"><i class="W_icon icon_warnB"></i></p><p class="text">#L{你搜索的内容暂未找到}</p><p class="subtext S_txt2">#L{返回或换个搜索关键词试试}</p></div></div></div></#et>'))};return function(b){var c,g,h,i,j,k,l,m,n={hot:null,hPage:1,hLen:0,hSum:0,query:null,qPage:1,qLen:0,qSum:0};g={initHData:function(a){if(!!a){n||(n={});var b,c=a.length;for(b=0;b<c;b++){a[b].image&&(a[b].image=a[b].image.replace(/^https?:/,""));a[b].icon&&(a[b].icon=a[b].icon.replace(/^https?:/,""))}n.hot=a;n.hPage=1;n.hLen=c;n.hSum=Math.ceil(c/6);g.sliceData("hot")}},initQData:function(a){if(!!a){n||(n={});var b,c=a.length;for(b=0;b<c;b++){a[b].image&&(a[b].image=a[b].image.replace(/^https?:/,""));a[b].icon&&(a[b].icon=a[b].icon.replace(/^https?:/,""))}n.query=a;n.qPage=1;n.qLen=c;n.qSum=Math.ceil(c/3);g.sliceData("query")}},sliceData:function(a){if(!!n){var b,c,d;if(a=="hot"){if(!n.hot)return;d=n.hLen;!n.hPage&&(n.hPage=1);b=(n.hPage-1)*6||0;c=n.hPage*6;c=c>d?d:c;n.hList=n.hot.slice(b,c)}else{if(!n.query)return;d=n.qLen;!n.qPage&&(n.qPage=1);b=(n.qPage-1)*3||0;c=n.qPage*3;c=c>d?d:c;n.qList=n.query.slice(b,c)}}},renderCard:function(a){var b;a=a||"hot";b=f[a](n).toString();!l||(l.innerHTML=b)},"switch":function(b){var c=b.el,d=b.data,e=d.type;if(!a.hasClassName(c,"W_btn_b_disable")){var f=d.dir==1?1:-1;e=="hot"?n.hPage+=f:n.qPage+=f;g.sliceData(e);g.renderCard(e);return a.stopEvent(b.evt)}},select:function(a){var c=a.data,d=c.content,f=d.length,h=b.nodeList.textEl,i=h.value,j;if(i.indexOf(d)!=-1){j=i.indexOf(d);e.setCursor(h,j+f+1)}else{b.API.insertText(d+" ");j=e.getCursorPos(h);e.setCursor(h,j)}g.hide()},back:function(b){g.sliceData("hot");g.renderCard("hot");j&&(j.value=f.default);k&&a.addClassName(k,"W_btn_a_disable");return a.stopEvent(b.evt)},search:function(b){if(!!j){var c=b&&b.data,e=b&&b.el||k;if(a.hasClassName(e,"W_btn_a_disable")||j.value==""){j.focus();return}c.query=j&&j.value;var f=function(a){if(!!a)if(a.data&&a.data.list&&a.data.list.length){g.initQData(a.data.list);g.renderCard("query")}else g.renderCard("empty")},h=function(b){a.lib.dialog.ioError(b.code,b)};d.getTrans("queryTopic",{onSuccess:f,onError:h}).request(b.data)}},focus:function(b){a.trim(j.value)==f.default&&(j.value="")},blur:function(b){a.trim(j.value)==""&&(j.value=f.default)},change:function(b){a.trim(j.value)==""?k&&a.addClassName(k,"W_btn_a_disable"):k&&a.removeClassName(k,"W_btn_a_disable")},enterkey:function(b){var c=k&&a.queryToJson(k.getAttribute("action-data"));c.query=j&&j.value;g.search({data:c})},createBub:function(){h=a.ui.bubble({clickBlankToHide:!0});m=h.dEvent();return h},initBub:function(){if(!!h){i=h.getDomList(!0);j=i&&i.search_input;k=i&&i.search_btn;l=i&&i.search_box;m.add("switch","click",g.switch);m.add("search","click",g.search);m.add("select","click",g.select);m.add("back","click",g.back);if(!j)return;a.addEvent(j,"focus",g.focus);a.addEvent(j,"focus",g.change);a.addEvent(j,"blur",g.blur);a.addEvent(j,"keyup",g.change);a.core.evt.hotKey.add(j,["enter"],g.enterkey)}},show:function(c){var e,i=c.el;b.nodeList.widget&&a.contains(b.nodeList.widget,i)?e=i:e=b.nodeList.more;var j=function(a){!h&&g.createBub();h.setContent(f.content);g.initBub();g.initHData(a.data.list);g.renderCard("hot");h.show().setArrow("top").setAlignPos(e,b.nodeList.textEl)},k=function(b){a.lib.dialog.ioError(b.code,b)};d.getTrans("getTopic",{onSuccess:j,onError:k}).request({})},hide:function(){h&&h.startBoxClose();h&&h.hide();h=null;m.remove("switch","click",g.switch);m.remove("search","click",g.search);m.remove("select","click",g.select);m.remove("back","click",g.back);m&&m.destroy&&m.destroy();m=null;a.removeEvent(j,"focus",g.focus);a.removeEvent(j,"focus",g.change);a.removeEvent(j,"blur",g.blur);a.removeEvent(j,"keyup",g.change);a.core.evt.hotKey.remove(j,["enter"],g.enterkey);j=k=l=i=null;n={}}};c={show:g.show,hide:g.hide,destroy:function(){g.hide();n=null}};return c}});
STK.register("lib.publisher.widget.stock",function(a){return function(a,b){var c={};c.show=function(){a.API.insertText("$")};c.destroy=function(){};return c}});
STK.register("lib.publisher.widget.timing",function(a){return function(b){if(!!b.nodeList.settime){var c={},d=a.delegatedEvent(b.nodeList.settime),e,f=function(a){if(!a||!a.getTime)a=new Date;var b={year:a.getFullYear(),mouth:a.getMonth()+1,date:a.getDate(),hours:a.getHours(),minutes:a.getMinutes(),seconds:a.getSeconds()};b.ymd=b.year+"-"+b.mouth+"-"+b.date;return b},g={settime_date:function(c){var d=(c.data.end||"").split(" ")[0],g=(c.data.start||"").split(" ")[0];!e&&(e=a.ui.calendar({start:g||f().ymd,end:d,callback:function(a){b.nodeList.settime_data.value=a;e.hide()}}));e.show(c.el,{pos:"bottom-left",appendTo:document.body,offsetX:1,offsetY:1})},settime_hour:function(){},settime_min:function(){}},h=function(){d.add("settime_data","click",g.settime_date)},i=function(){h()};i();var j=function(){d.destroy()};c.destroy=j;return c}}});
STK.register("lib.publisher.widget.widgetloader",function(a){var b=a.lib.publisher.widget,c=$CONFIG.isKrMember==1?!0:!1,d=$CONFIG.isVmember==1?!0:!1;return function(e,f){f=a.parseParam({widget:e.nodeList.widget,devent:"",preType:"weibo"},f||{});var g={},h,i,j,k,l,m=e.nodeList.textEl,n={list:["face","image","multiimage","video","music","vote","topic","settime","blog","stock","superTopic"],entity:{},widgetList:{},func:function(g){return function(h){var i=m&&m.getAttribute("tid"),j=m&&m.getAttribute("extra")&&a.queryToJson(m.getAttribute("extra"));h.data.isimage?e.API.setImageLogType(h.data.log):e.API.setCurrentLogType(h.data.log);n.widgetList[g]||(n.widgetList[g]=b[g](e));if(g=="multiimage"&&m.getAttribute("data-video-status"))a.ui.confirm("确定放弃上传视频吗",{OK:function(){n.widgetList.video.hide()}});else{if(g=="video"&&m.getAttribute("data-multiimage-status")){a.ui.confirm("确定放弃上传图片吗",{OK:function(){n.widgetList.multiimage.hide()}});return}if(g=="multiimage"&&i&&j){if(j.gif_ids||j.pic_id){var k=(j.gif_ids||"").split(",").join(" "),l=k||j.pic_id||"";n.widgetList[g].show(h,l);return}n.widgetList[g].show(h);return}if(g=="video"&&i&&j){if(j.video_fid&&j.video_covers){if(c||d){n.widgetList[g].show(h);setTimeout(function(){a.custEvent.fire(e,"videoUploading");n.widgetList[g].preShow(h,j.video_covers,f.preType)},500);return}n.widgetList[g].preShow(h,j.video_covers,f.preType);return}n.widgetList[g].show(h);return}n.widgetList[g].show(h)}}}},o={showComfirm:function(b,c){a.isNode(b)||a.log("target : parameter target is not a document node!");b=b||feedList;c=a.parseParam({msg:$L("#L{确定放弃吗？}"),clickBlankToHide:!0,type:"ask",okCallback:function(){},hideCallback:function(){}},c);l&&l.anihide&&l.anihide();l=a.ui.tipConfirm(c.msg,c).beside(b,{appendTo:document.body}).ok(c.okCallback).cancel(c.hideCallback)},init:function(){o.bind()},bind:function(){a.custEvent.define(e,"close");h=f.devent?f.devent:a.delegatedEvent(f.widget);for(var c=0,d=n.list.length;c<d;c++){var g=n.list[c];n.entity[g]=n.func(g);h.add(g,"click",n.entity[g])}i=b.plugin(e,f);j=b.imgPreview(e);k=b.timing(e);n.widgetList.video||(n.widgetList.video=b.video(e))},close:function(){a.custEvent.fire(e,"close",{type:"publish"})},destroy:function(){for(var a=0,b=n.list.length;a<b;a++){var c=n.list[a];h.remove(c,"click",n.entity[c])}for(var d in n.widgetList)n.widgetList[d].destroy&&n.widgetList[d].destroy();i.destroy();j.destroy();k&&k.destroy&&k.destroy()}};o.init();g.close=o.close;g.destroy=o.destroy;return g}});
STK.register("lib.editor.plugin.morePlugin",function(a){var b=a.lib.kit.extra.language;return function(b){var c={},d,e,f,g,h=!1,i={number:4,defNumber:2},j={list:[],data:{},add:function(a){var b=a.type;j.data[b]=a},destroy:function(){j.list=[];j.data={}}},k,l={init:function(){var c=a.queryToJson(b.nodeList.widget.getAttribute("node-data")||"");i=a.parseParam(i,c);l.buildMenu()},showMenu:function(b){e.style.display="";e.style.zIndex="10000";var c=a.position(b),d=a.core.dom.getSize(b);a.core.dom.setXY(e,{t:c.t+d.height+3,l:c.l-5});a.ui.effect(e,"fadeInDown","fast");window.SUDA&&SUDA.uaTrack&&SUDA.uaTrack("tblog_home_edit",'unfold_more"')},hideMenu:function(){a.ui.effect(e,"fadeOutUp","fast",function(){e.style.display="none"})},buildMenu:function(){e=b.nodeList.morePlugin;if(!!e){document.body.appendChild(e);e.style.position="absolute";a.lib.publisher.widget.widgetloader(b,{widget:e});l.menuEvt()}},menuEvt:function(){a.addEvent(e,"click",l.hideMenu)},destroy:function(){a.removeEvent(e,"click",l.hideMenu);a.removeNode(e);d&&d.destroy()}};l.init();c.menu=e;c.show=l.showMenu;c.hide=l.hideMenu;c.destroy=l.destroy;return c}});
STK.register("lib.kit.dom.hover",function(a){function b(b,c){var d=c.length;while(d--)if(c[d]===b||a.contains(c[d],b))return!0;return!1}var c={};return a.lib.kit.touch.cantouch?function(d){var e=d.act,f=d.extra||[],g=function(a){d.onmouseover.apply(e,[a])},h=function(a){d.onmouseout.apply(e,[a])},i=function(c,d){b(a.fixEvent(d).target,[e].concat(f))?g(d):h(d)};if(!("inited"in c)){c.inited=!0;a.custEvent.define(c,["tap"]);a.addEvent(document.body,"tap",function(b){a.custEvent.fire(c,"tap",b)})}a.custEvent.add(c,"tap",i);return{destroy:function(){a.removeEvent(document.body,"tap",i)}}}:function(b){var c=b.delay||300,d=b.moutDelay||c,e=b.isover||!1,f=b.act,g=b.extra||[],h=null,i=function(a){e&&b.onmouseover.apply(f,[a])},j=function(a){e||b.onmouseout.apply(f,[a])},k=function(a){e=!0;h&&clearTimeout(h);h=setTimeout(function(){i(a)},c)},l=function(a){e=!1;h&&clearTimeout(h);h=setTimeout(function(){j(a)},d)};a.core.evt.addEvent(f,"mouseover",k);a.core.evt.addEvent(f,"mouseout",l);for(var m=0,n=g.length;m<n;m+=1){a.core.evt.addEvent(g[m],"mouseover",k);a.core.evt.addEvent(g[m],"mouseout",l)}var o={};o.destroy=function(){a.core.evt.removeEvent(f,"mouseover",k);a.core.evt.removeEvent(f,"mouseout",l);for(var b=0,c=g.length;b<c;b+=1){a.core.evt.removeEvent(g[b],"mouseover",k);a.core.evt.removeEvent(g[b],"mouseout",l)}};return o}});
STK.register("lib.editor.editor",function(a){var b=a.addEvent,c=a.removeEvent,d=a.custEvent,e=a.getStyle,f=a.setStyle,g=a.lib.kit.dom.parseDOM,h=a.lib.kit.extra.textareaUtils,i=a.lib.editor.count;return function(e,f){var j={},f=f,k={},l="",m="",n="",o={reset:function(){k.textEl.value="";d.fire(j,"changed");k.textEl.removeAttribute("extra");l=m=n=""},delWords:function(a){var b=o.getWords();if(!(b.indexOf(a)>-1))return!1;k.textEl.value="";q.textInput(b.replace(a,""))},getWords:function(){return a.core.str.trim(k.textEl.value)},getExtra:function(){var b,c=k.textEl.getAttribute("extra")||"";c!=null&&(b=a.core.str.trim(c));return b},focus:function(a,b){if(typeof a!="undefined")h.setCursor(k.textEl,a,b);else{var c=k.textEl.value.length;h.setCursor(k.textEl,c)}p.cacheCurPos()},blur:function(){k.textEl.blur()},addExtraInfo:function(a){typeof a=="string"&&k.textEl.setAttribute("extra",a)},disableEditor:function(a){c(k.textEl,"mouseup",p.cacheCurPos);if(a===!0)k.textEl.setAttribute("disabled","disabled");else{b(k.textEl,"mouseup",p.cacheCurPos);k.textEl.removeAttribute("disabled")}},getCurPos:function(){var a=k.textEl.getAttribute("range")||"0&0";return a.split("&")},count:function(){var b=a.core.str.trim(k.textEl.value).length==0?a.core.str.trim(k.textEl.value):k.textEl.value;return i(b)},addShortUrlLog:function(b){b=b&&a.trim(b);if(b){var c=new RegExp("^"+b+"$|"+"_"+b+"$|^"+b+"_|"+"_"+b+"_");c.test(l)||(l?l=l+"_"+b:l=b)}},getShortUrlLog:function(){return l},setCurrentLogType:function(a){m=a},getCurrentLogType:function(){return m},setImageLogType:function(a){n=a},getImageLogType:function(){return n}},p={textElFocus:function(){k.recommendTopic&&a.core.dom.setStyle(k.recommendTopic,"display","");d.fire(j,"focus");k.num&&a.core.dom.setStyle(k.num,"display","");o.getWords()==f.tipText&&o.delWords(f.tipText)},textElBlur:function(){setTimeout(function(){if(k.textEl.value.length===0){k.recommendTopic&&a.core.dom.setStyle(k.recommendTopic,"display","block");k.num&&k.recommendTopic&&a.core.dom.setStyle(k.num,"display","none");typeof f.tipText!="undefined"&&(k.textEl.value=f.tipText)}d.fire(j,"blur")},50)},cacheCurPos:function(){var b=h.getSelectedText(k.textEl),c=b==""||b==null?0:b.length,d=a.core.dom.textSelectArea(k.textEl).start,e=d+"&"+c;k.textEl.setAttribute("range",e)}},q={textChanged:function(){d.fire(j,"keyUpCount")},textInput:function(a,b){var c=o.getCurPos(),b=c[0],e=c[1];o.getWords()==f.tipText&&a!=f.tipText&&o.delWords(f.tipText);h.unCoverInsertText(k.textEl,a,{rcs:c[0],rccl:c[1]});p.cacheCurPos();d.fire(j,"changed")}},r={},s=function(){v();w()},t=function(){x();z();A();u();k.recommendTopic&&setTimeout(function(){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("top_textlink","textlink_expo")},3e3)},u=function(){f.storeWords?k.textEl.value.length==0&&q.textInput(f.storeWords):f.tipText&&(k.textEl.value=f.tipText)},v=function(){if(!e)throw"node is not defined in module editor"},w=function(){var b=a.core.dom.builder(e).list;k=g(b);if(!k.widget)throw"can not find nodes.widget in module editor"},x=function(){var a=k.textEl;b(a,"focus",p.textElFocus);b(a,"blur",p.textElBlur);b(a,"mouseup",p.cacheCurPos);b(a,"keyup",p.cacheCurPos)},y=function(){d.define(j,["changed","focus","blur"])},z=function(){y();d.add(j,"changed",q.textChanged)},A=function(){},B=function(){d.remove(j);d.undefine(j);var a=k.textEl;c(a,"focus",p.textElFocus);c(a,"blur",p.textElBlur);c(a,"mouseup",p.cacheCurPos);c(a,"keyup",p.cacheCurPos)};s();var C={reset:o.reset,getWords:o.getWords,getExtra:o.getExtra,delWords:o.delWords,focus:o.focus,blur:o.blur,insertText:q.textInput,check:q.textChanged,addExtraInfo:o.addExtraInfo,disableEditor:o.disableEditor,getCurPos:o.getCurPos,count:o.count,textElFocus:p.textElFocus,cacheCurPos:p.cacheCurPos,addShortUrlLog:o.addShortUrlLog,getShortUrlLog:o.getShortUrlLog,setCurrentLogType:o.setCurrentLogType,getCurrentLogType:o.getCurrentLogType,setImageLogType:o.setImageLogType,getImageLogType:o.getImageLogType};j.destroy=B;j.API=C;j.nodeList=k;j.init=t;j.opts=f;return j}});
STK.register("lib.editor.base",function(a){var b=a.lib.editor.service,c=a.lib.editor.plugin,d;return function(b,e){var f={},g,h,i,j,k,l;e=a.lib.kit.extra.merge({limitNum:140},e);var m=function(b){var c=a.fixEvent(b).target;if(a.contains(i.nodeList.more,c)||c==i.nodeList.more){n.showMenu();var d=a.lib.kit.dom.firstChild(i.nodeList.more);d&&a.addClassName(d,"W_arrow_turn")}else{n.hideMenu();var d=a.lib.kit.dom.firstChild(i.nodeList.more);d&&a.removeClassName(d,"W_arrow_turn")}},n={init:function(){n.build();n.bind()},build:function(){i=a.lib.editor.editor(b,e);d=i.nodeList;j=c.at(i,e);(typeof e.count=="undefined"||e.count=="enable")&&c.count(i);l=c.sucTip(i,e);k=c.score(i,e);h=c.morePlugin(i,e);j.init();i.init();l.init()},bind:function(){i.nodeList.more&&a.addEvent(document.body,"click",m)},showMenu:function(){h.show(i.nodeList.more)},hideMenu:function(){h.hide()},destroy:function(){k&&k.destroy&&k.destroy();i.destroy&&i.destroy();j.destroy&&j.destroy();h.destroy()},closeWidget:function(){}};n.init();f.editor=i;f.nodeList=d;f.destroy=n.destroy;f.closeWidget=n.closeWidget;return f}});
STK.register("conf.trans.publishTo",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("list",{url:"/aj/f/group/list",method:"get"});c("chatlist",{url:"/aj/f/groupchat/list",method:"get"});return b});
STK.register("lib.publisher.widget.keyboardCapture",function(a){var b={13:"enter",27:"esc",32:"space",38:"up",40:"down",9:"tab"};return function(c,d){d=d||{};var e={},f,g={keydown:function(c){d.stopScroll&&a.stopEvent();var f,g;!!(f=c)&&!!(g=f.keyCode)&&b[g]&&a.custEvent.fire(e,b[g])}},h={init:function(){h.pars();h.bind()},pars:function(){},bind:function(){for(var b in g)a.addEvent(c,b,g[b])},getKey:function(a){return b[a]},destroy:function(){for(var b in g)a.removeEvent(c,b,g[b])}};h.init();e.getKey=h.getKey;e.destroy=h.destroy;return e}});
STK.register("lib.kit.dom.textSelection",function(a){return function(b,c){var d,e;d={};e=a.parseParam({},c);var f=function(c){return a.core.dom.selectText(b,c)},g=function(){b.__areaQuery=a.jsonToQuery(a.core.dom.textSelectArea(b))},h=function(){b.__areaQuery=!1};a.addEvent(b,"beforedeactivate",g);a.addEvent(b,"active",h);var i=function(){var c=null;try{c=a.core.dom.textSelectArea(b)}catch(d){c=a.queryToJson(b.__areaQuery)}c.start===0&&c.len===0&&b.__areaQuery&&(c=a.queryToJson(b.__areaQuery));c.start=parseInt(c.start,10);c.len=parseInt(c.len,10);return c},j=function(a,c){var d=b.value,e=c.start,f=c.len||0,g=d.slice(0,e),h=d.slice(e+f,d.length);b.value=g+a+h;d=null;g=null;h=null;var e=null,f=null};d.setCursor=function(a){f(a)};d.getCursor=function(){return i()};d.insertCursor=function(a){var b=i();j(a,b);b.len=a.length;f(b)};d.TempletCursor=function(c){var d,e,g;d=i();d.len>0?e=b.value.substr(d.start,d.len):e="";g=a.templet(c,{origin:e});j(g,d);d.start=d.start+c.indexOf("#{origin");d.len=g.length-c.replace(/#\{[origin].+?\}/,"").length;f(d)};d.insertText=j;d.destroy=function(){a.removeEvent(b,"beforedeactivate",g);a.removeEvent(b,"active",h);b=null};return d}});
STK.register("lib.kit.dom.smartInput",function(a){return function(b,c){var d,e,f,g,h,i,j,k,l,m="stop",n,o,p,q,r;d=a.parseParam({notice:"",currentClass:null,noticeClass:null,noticeStyle:null,maxLength:null,needLazyInput:!1,LazyInputDelay:200},c);e=a.cascadeNode(b);h=a.lib.kit.dom.textSelection(b);a.custEvent.define(e,"enter");a.custEvent.define(e,"ctrlEnter");a.custEvent.define(e,"lazyInput");f=function(){d.maxLength&&a.bLength(b.value)>d.maxLength&&(b.value=a.leftB(b.value,d.maxLength))};o=function(){if(b.value===d.notice){b.value="";d.noticeClass!=null&&a.removeClassName(b,d.noticeClass)}d.currentClass!=null&&a.addClassName(b.parentNode,d.currentClass)};p=function(){if(b.value===""){b.value=d.notice;d.noticeClass!=null&&a.addClassName(b,d.noticeClass)}d.currentClass!=null&&a.removeClassName(b.parentNode,d.currentClass)};g=function(){f();return b.value===d.notice?"":b.value};q=function(b){b.keyCode===13&&a.custEvent.fire(e,"enter",g())};r=function(b){(b.keyCode===13||b.keyCode===10)&&b.ctrlKey&&a.custEvent.fire(e,"ctrlEnter",g())};i=function(){if(m==="stop"){l=setInterval(k,d.LazyInputDelay);m="sleep"}};j=function(){clearInterval(l);m="stop"};k=function(){if(n===b.value)if(m==="weakup"){a.custEvent.fire(e,"lazyInput",b.value);m="sleep"}else m==="waiting"&&(m="weakup");else m="waiting";n=b.value};if(d.needLazyInput){a.addEvent(b,"focus",i);a.addEvent(b,"blur",j)}a.addEvent(b,"focus",o);a.addEvent(b,"blur",p);a.addEvent(b,"keyup",f);a.addEvent(b,"keydown",q);a.addEvent(b,"keydown",r);e.getValue=g;e.setValue=function(a){b.value=a;f();return e};e.setNotice=function(a){d.notice=a;return e};e.setNoticeClass=function(a){d.noticeClass=a;return e};e.setNoticeStyle=function(a){d.noticeStyle=a;return e};e.setMaxLength=function(a){d.maxLength=a;return e};e.restart=function(){p()};e.startLazyInput=i;e.stopLazyInput=j;e.setCursor=h.setCursor;e.getCursor=h.getCursor;e.insertCursor=h.insertCursor;e.insertText=h.insertText;e.destroy=function(){if(d.needLazyInput){a.removeEvent(b,"focus",o);a.removeEvent(b,"blur",p)}j();a.removeEvent(b,"focus",o);a.removeEvent(b,"blur",p);a.removeEvent(b,"keyup",f);a.removeEvent(b,"keydown",q);a.removeEvent(b,"keydown",r);a.custEvent.undefine(e,"enter");a.custEvent.undefine(e,"ctrlEnter");a.custEvent.undefine(e,"lazyInput");h.destroy();e=null};return e}});
STK.register("conf.trans.groupMember",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("create",{url:"/aj/groupchat/create",method:"post"});c("update",{url:"/aj/groupchat/edit",method:"post"});c("userList",{url:"/aj/relation/groupallmembers",method:"get"});c("info",{url:"/aj/groupchat/query",method:"get"});c("setSummary",{url:"/aj/groupchat/setsummary",method:"post"});c("setAdmin",{url:"/aj/groupchat/setadmin",method:"post"});c("unsetAdmin",{url:"/aj/groupchat/unsetadmin",method:"post"});c("suggest",{url:"/aj/groupchat/attention",method:"get"});c("groupList",{url:"/aj/relation/grouplist",method:"get"});c("check",{url:"/aj/groupchat/getuser",method:"get"});c("getUser",{url:"/aj/groupchat/getlist",method:"get"});c("editGroup",{url:"/p/aj/groupchat/updategroupcard",method:"post"});c("fansgroup",{url:"/aj/groupchat/queryjoingroups",method:"get"});c("addFans",{url:"/aj/groupchat/addaffiliation",method:"post"});return b});
STK.register("lib.group.groupMember",function(a){var b='<#et data data><#if (!data.islist)><div node-type="group_fan_tool"><div class="webim_tab_hd" node-type="group_fan_filternav"><div class="hd_mod S_line1 clearfix"><h3 class="W_fl W_fb">#L{最近联系人}</h3><div class="W_fr" ><a href="javascript:void(0);" action-type="group_fans_filter" suda-data="key=button_build_group&value=screen_fans"  action-data="type=2">#L{筛选粉丝}</a></div></div></div><div  node-type="group_fan_nav" style="display:none;"><div class="webim_tab_hd hd_two S_line1"><div class="back"><a href="javascript:void(0);" suda-data="key=button_build_group&value=back" action-type="group_fan_back" action-data="type=1" class="S_txt1"><em class="W_ficon ficon_back S_ficon">«</em></a></div><p class="title W_fb">#L{筛选粉丝}</p></div><div class="webim_tab_btn"><div class="WB_minitab"><ul class="minitb_ul S_line1 S_bg1 clearfix"><li class="minitb_item current S_line1" action-type="group_fan_tab" suda-data="key=button_build_group&value=intera_group"  node-type="group_fan_tab" action-data="type=2"><a href="javascript:void(0);" class="minitb_lk S_txt1 S_bg2" node-type="group_fan_tabtext">#L{忠诚度}</a><span class="cur_block"></span></li><li class="minitb_item S_line1" action-type="group_fan_tab" suda-data="key=button_build_group&value=fans" node-type="group_fan_tab" action-data="type=3"><a href="javascript:void(0);" class="minitb_lk S_txt1" node-type="group_fan_tabtext">#L{粉丝数}</a><span class="cur_block"></span></li></ul></div></div></div></div><div class="webim_tab_bd" ><div class="webim_contacts_group" node-type="group_fan_scrollC"><ul class="webim_contacts_list" node-type="group_list_c"></#if><#list data.list as item><li class="contacts SW_fun_bg clearfix" action-type="add_group_member"  action-data="uid=${item.id}&screen_name=<#if (item.remark)>${item.remark}<#else>${item.screen_name}</#if>&profile_image_url=${item.profile_image_url}"><div class="head W_fl"><img width="30" height="30"  src="${item.profile_image_url}"></div><p class="name W_autocut W_fl S_txt1 W_f14"><#if (item.remark)>${item.remark}<#else>${item.screen_name}</#if></p><div class="icon_mod W_fl"><#if (data.verified && data.verified_type == 0)><i title="微博个人认证" class="W_icon icon_approve"></i></#if></div><div class="icon_add W_fr"><a href="javascript:void(0);"   class="W_ficon ficon_add S_ficon">+</a></div></li></#list><#if (!data.islist)></ul></div></div></#if></#et>';return function(c,d){var e={offest:50,isloading:!1,trans:"",page:1,isEnd:!1,extraParam:{}},f=a.lib.kit.extra.language;d=a.parseParam({isAjax:!0,members:""},d||{});var g={},h,i,j,k=a.conf.trans.groupMember,l={getData:function(){i&&clearInterval(i);e.trans&&e.trans.abort();e.isloading=!0;var c=e.extraParam;c.page=e.page;e.trans=k.getTrans("getUser",{onSuccess:function(c){var d={list:c.data.users,islist:!0},g=a.core.util.easyTemplate(f(b),d).toString();e.isloading=!1;h.group_list_c.innerHTML=g;uiscroll.reset();i=setInterval(l.srcollEvent,200)},onFail:function(){e.isloading=!1},onError:function(){e.isloading=!1}}).request(c)},srcollEvent:function(){if(!e.isloading){if(e.isEnd){clearInterval(i);return}if(uiscroll.scrollHeight()-uiscroll.offsetHeight()-uiscroll.scrollTop()<=e.offest){e.isloading=!0;e.page=e.page+1;e.trans&&e.trans.abort();var c=e.extraParam;c.page=e.page;e.trans=k.getTrans("getUser",{onSuccess:function(c){var d={list:c.data.users,islist:!0},g=a.core.util.easyTemplate(f(b),d).toString();e.isloading=!1;a.core.dom.insertHTML(h.group_list_c,g,"beforeend");e.page>=c.data.total_page&&(e.isEnd=!0)},onFail:function(){e.page=e.page-1;e.isloading=!1},onError:function(){e.page=e.page-1;e.isloading=!1}}).request(c)}}},addGroupMember:function(b){a.custEvent.fire(g,"addMember",b.data)},addGroupInject:function(a){return!1},groupFanBack:function(a){h.group_fan_filternav.style.display="";h.group_fan_nav.style.display="none";e.page=1;e.isloading=!1;e.isEnd=!1;e.extraParam=a.data;l.setListHeight();l.getData()},tabDomchange:function(b){var c;a.foreach(h.group_fan_tab,function(b,d){c=a.sizzle('[node-type="group_fan_tabtext"]',b)[0];c&&a.core.dom.removeClassName(c,"S_bg2");a.core.dom.removeClassName(b,"current")});c=a.sizzle('[node-type="group_fan_tabtext"]',b)[0];a.core.dom.addClassName(b,"current");c&&a.core.dom.addClassName(c,"S_bg2")},groupFanTab:function(b){if(!a.core.dom.hasClassName(b.el,"current")){l.tabDomchange(b.el);e.page=1;e.isloading=!1;e.isEnd=!1;e.extraParam=b.data;l.setListHeight();l.getData()}},groupFansFilter:function(a){h.group_fan_filternav.style.display="none";h.group_fan_nav.style.display="";e.page=1;e.isloading=!1;e.isEnd=!1;e.extraParam=a.data;l.setListHeight();l.tabDomchange(h.group_fan_tab[0]);l.getData()},setListHeight:function(){var a=h.group_fan_tool.offsetHeight;h.group_fan_scrollC.style.height=d.height-a+"px"}},m=function(){h=a.lib.kit.dom.parseDOM(a.builder(c).list)},n=function(){var b=a.delegatedEvent(c);a.custEvent.define(g,["addMember","addGroup","getUserInfo"]);b.add("add_group_member","click",l.addGroupMember);b.add("add_group_inject","click",l.addGroupInject);b.add("group_fans_filter","click",l.groupFansFilter);b.add("group_fan_tab","click",l.groupFanTab);b.add("group_fan_back","click",l.groupFanBack)},o=function(){n();k.getTrans("getUser",{onSuccess:function(d){var j={list:d.data.users},k=a.core.util.easyTemplate(f(b),j).toString(),n={currUser:d.data.viewer,addUser:d.data.members};a.custEvent.fire(g,"getUserInfo",n);c.innerHTML=k;m();l.setListHeight();uiscroll=a.ui.scrollView(h.group_fan_scrollC);e.page>=d.data.total_page&&(e.isEnd=!0);i=setInterval(l.srcollEvent,200)},onFail:function(){},onError:function(){}}).request({page:1,members:d.members})};o();g.setHeight=function(a){d.height=a;l.setListHeight();uiscroll.reset()};g.destroy=function(){i&&clearInterval(i);dEvent.destroy()};return g}});
STK.register("lib.group.gmemberSelect",function(a){return function(b){var c=a.lib.kit.extra.language,d={ENTER:13,ESC:27,UP:38,DOWN:40,LEFT:37,RIGHT:39},e=500,f="",g,h,i,j,k=!1,l,m='<div class="W_layer"><div class="content group_content"><div class="W_layer_hd"><div class="h_name_box clearfix" node-type="groupNamePanel"><p class="h_name W_fl W_autocut W_f14" node-type="titleText"></p><div class="h_change W_fl" action-type="editGroupName" suda-data="key=button_build_group&value=rev_name_group"  node-type="editGroupName" title="#L{修改群名称}"><em class="W_ficon ficon_edit S_ficon">7</em><span>#L{修改群名称}</span></div></div><div class="h_change_box clearfix" node-type="editGroupFrom" style="display:none;"><input name="" type="text" node-type="group_edit_input"  class="W_input W_fl" value="#L{输入群名称}"><a href="javascript:void(0);" class="W_btn_a W_fl" action-type="subimtEditGroup">#L{保存名称}</a><a href="javascript:void(0);" class="W_btn_b W_fl" action-type="cannelEditGroup">#L{取消}</a></div><div class="W_layer_close"><a href="javascript:void(0);" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div></div><div class="layer_msg_group"><ul class="group_nav S_line1 clearfix"><li class="W_fl S_line1 S_bg1 g_first">#L{添加群成员}</li><li class="W_fl S_bg1">已有成员 ( <span class="online" node-type="group_all_count">0</span>/<span class="all" node-type="maxConut">500</span> )<a href="http://weibo.com/" class="group_nav_href" node-type="batManage" style="display:none;">#L{批量管理}</a> </li></ul><div class="group_members clearfix"><div class="add_box S_bg1 W_fl"><div class="a_serch"><span class="WB_search_s"><input type="text" value="#L{查找联系人}"  class="W_input" node-type="group_search_input"><span class="pos"><a href="javascript:void(0);" title="#L{查找联系人}" class="W_ficon ficon_search S_ficon">f</a></span></span></div><div class="webim_contacts_bd" node-type="groupSelect"><div  node-type="groupMember"></div><div class="webim_tab_bd"><div node-type="searchLists" style="display:none;"></div></div></div></div><div class="existing_box W_fl"><div class="webim_contacts_bd" node-type="existing_box"><div class="webim_tab_bd"><div node-type="addUserLists" style="display:none;"><div class="webim_contacts_group mt10"><div class="webim_group_title webim_existing_title"><a href="javascript:void(0);" class="group_title_cont S_txt1"><span class="name" node-type="addUserCount"></span></a></div><ul class="webim_contacts_list" node-type="addUserListsContain"></ul></div><div class="W_layer_line S_line2" node-type="line" style="display:none;"></div></div><div class="webim_contacts_group mt10" node-type="joinMemberList"></div><div node-type="joinMemberListContain"></div></div></div></div></div></div><div class="W_layer_btn S_line1 S_bg1"><a href="javascript:void(0);" node-type="editsubmitBtn" action-type="groupPostSubmit" class="W_btn_a btn_34px W_btn_a_disable">#L{确定}</a><a href="javascript:void(0);" action-type="groupPostCannel" class="W_btn_b btn_34px">#L{取消}</a></div></div></div>',n='<ul class="webim_contacts_list">#L{%s}</ul>',o='<#et data data><#list data as item><li class="contacts SW_fun_bg clearfix" node-type="userItem" action-type="addMember" action-data="uid=<#if (item.id)>${item.id}<#else>${item.uid}</#if>&screen_name=<#if (item.remark)>${item.remark}<#else>${item.screen_name}</#if>&profile_image_url=${item.profile_image_url}"><div class="head W_fl"><img width="30" height="30"  src="${item.profile_image_url}"></div><p class="name W_autocut W_fl S_txt1 W_f14"><#if (item.remark)>${item.remark}<#else>${item.screen_name}</#if></p><div class="icon_mod W_fl"><#if (data.verified && data.verified_type == 0)><i title="微博个人认证" class="W_icon icon_approve"></i></#if></div><div class="icon_add W_fr"><a href="javascript:void(0);"  action-data="uid=<#if (item.id)>${item.id}<#else>${item.uid}</#if>&screen_name=<#if (item.remark)>${item.remark}<#else>${item.screen_name}</#if>&profile_image_url=${item.profile_image_url}" class="W_ficon ficon_add S_ficon">+</a></div></li></#list></#et>',p=c('<#et data data><#list data as item><li class="contacts <#if (!item.nopower)> SW_fun_bg</#if> clearfix" node-type="addUserItem"><div class="head W_fl"><img width="30" height="30"  src="${item.profile_image_url}"></div><p class="name W_autocut W_fl S_txt1 W_f14"><#if (item.remark)>${item.remark}<#else>${item.screen_name}</#if></p><div class="icon_mod W_fl"><#if (item.verified && item.verified_type == 0)><i title="微博个人认证" class="W_icon icon_approve"></i></#if></div><#if (item.is_owner)><div class="main W_fr"><a href="javascript:void(0);" class="icon_group icon_main" title="#L{群主}"></a></div><#elseif (item.is_admin)><#if (!item.nopower)><div class="close W_fr"><a href="javascript:void(0);" class="icon_group icon_admin" title="#L{群管理员}"></a><a href="javascript:void(0);" action-data="uid=<#if (item.id)>${item.id}<#else>${item.uid}</#if>&screen_name=<#if (item.remark)>${item.remark}<#else>${item.screen_name}</#if>&profile_image_url="${item.profile_image_url}" class="W_ficon ficon_close S_ficon"<#if (item.actiontype)> action-type="${item.actiontype}" <#else> action-type="kickMember" </#if> >X</a></div><#else><div class="main W_fr"><a href="javascript:void(0);" class="icon_group icon_admin" title="#L{群管理员}"></a></div></#if><#else><div class="close W_fr"><a href="javascript:void(0);" action-data="uid=<#if (item.id)>${item.id}<#else>${item.uid}</#if>&screen_name=<#if (item.remark)>${item.remark}<#else>${item.screen_name}</#if>&profile_image_url="${item.profile_image_url}" class="W_ficon ficon_close S_ficon"<#if (item.actiontype)> action-type="${item.actiontype}" <#else> action-type="kickMember" </#if> >X</a></div></#if></li></#list></#et>'),q=c('<#et data data><li class="contacts  clearfix" node-type="addUserItem"><div class="head W_fl"><img width="30" height="30" src="${data.profile_image_url}"></div><p class="name W_autocut W_fl S_txt1 W_f14">${data.screen_name}</p><div class="icon_mod W_fl"><#if (data.verified && data.verified_type == 0)><i title="微博个人认证" class="W_icon icon_approve"></i></#if></div><div class="main W_fr"><a href="javascript:void(0);" class="icon_group icon_main" title="#L{群主}"></a></div><div class="close W_fr"></div></li></#et>'),r={},s=a.ui.dialog(c(m)),t="";b=a.parseParam({gid:"",addUsers:"",minNum:3,extraData:{},addSuccessCallback:"",editSuccessCallback:""},b);var u=-1,v=[],w=[],x=[],y=[],z,A={},B,C,D,E,F,G=b.gid,H=a.conf.trans.groupMember,I,J,K={editGroupName:function(){D.groupNamePanel.style.display="none";D.editGroupFrom.style.display="";E.value=z?a.decodeHTML(z):t},cannelEditGroup:function(){D.groupNamePanel.style.display="";D.editGroupFrom.style.display="none"},subimtEditGroup:function(){var b=F.getValue();if(!b)a.ui.tipAlert("请输入群名称!").beside(E).on("hide",function(){E.foucs()});else{k=!0;D.groupNamePanel.style.display="";D.editGroupFrom.style.display="none";if(b==t)return;z=b.substring(0,16);D.titleText.innerHTML=a.encodeHTML(z);K.updateGroupName()}},groupPostCannel:function(a){s.hide()},checkIsOk:function(){if(!k&&b.extraData&&b.extraData.page_id){var d=D.editGroupFrom.style.display=="",e=d?E:D.editGroupName,f=d?c("#L{昵称还没保存哦}"):c("#L{请先换个好点的昵称吧}");a.ui.tipAlert(f).beside(e,{pos:"bottom-middle",appendTo:document.body,offsetY:d?-10:-20});return!1}if(D.editGroupFrom.style.display==""){a.ui.tipAlert(c("#L{昵称还没保存哦}")).beside(E,{pos:"bottom-middle",appendTo:document.body,offsetY:-10});return!1}return!0},groupPostSubmit:function(c){if(!a.hasClassName(c.el,"W_btn_a_disable")&&!!K.checkIsOk()){var d=b.extraData;if(G){d=a.lib.kit.extra.merge(d,{join_uids:x.join(","),kick_uids:w.join(","),name:z,gid:G});var e=d.name;k||delete d.name;H.getTrans("update",{onSuccess:function(c){c.data.name=e;a.custEvent.fire(r,"editSuccess",c.data);s.hide();try{b.editSuccessCallback&&b.editSuccessCallback(c.data)}catch(d){}K.errorBack(c)},onFail:function(b){a.lib.dialog.ioError(b.code,b)},onError:function(b){a.lib.dialog.ioError(b.code,b)}}).request(d)}else{d=a.lib.kit.extra.merge(d,{name:z?z:t,members:y.join(",")});var e=d.name;k||delete d.name;H.getTrans("create",{onSuccess:function(c){c.data.name=e;a.custEvent.fire(r,"addSuccess",c.data);s.hide();try{b.addSuccessCallback&&b.addSuccessCallback(c.data)}catch(d){}K.errorBack(c)},onFail:function(b){a.lib.dialog.ioError(b.code,b)},onError:function(b){a.lib.dialog.ioError(b.code,b)}}).request(d)}}},errorBack:function(b){var d=b.data,e=["error_uids","exceed_uids","unspported_uids"],f=[c("#L{还不是你的粉丝，暂时无法加群。}"),c("#L{群成员已满，操作失败。}"),c("#L{不支持群聊的用户。}")],g=[],h=1;for(var i=0;i<e.length;i++)if(d[e[i]]){g.push(h+"."+d[e[i]].join(" ")+" "+f[i]+"<br>");h++}h>1&&a.ui.alert(g.join(""))},removeIndexElement:function(b,c){var d=a.core.arr.indexOf(b,c);d!=-1&&c.splice(d,1)},getCurItem:function(b){var c=b.length;while(c--)if(a.hasClassName(b[c],"cur"))return b[c];return null},groupSuggest:function(b){var c=a.fixEvent().keyCode,e=D.searchLists;if(c==d.UP||c==d.DOWN||c==d.ENTER){a.preventDefault(b);var f=a.sizzle("[node-type='userItem']",e),g=f.length,h=K.getCurItem(f);if(c==d.UP){u=u<1?g-1:u-1;h&&a.removeClassName(h,"cur");a.addClassName(f[u],"cur")}else if(c==d.DOWN){u=u>=g-1?0:u+1;h&&a.removeClassName(h,"cur");f[u]&&a.addClassName(f[u],"cur")}else if(c==d.ENTER){var i=h&&a.queryToJson(h.getAttribute("action-data"));i&&K.addGroupMember(undefined,i)}}},groupinputclick:function(a){window.SUDA&&window.SUDA.uaTrack("button_build_group","search_box")},groupinputkeyup:function(b){var e=a.trim(B.getValue()),f=a.fixEvent().keyCode;if(f==d.UP||f==d.LEFT||f==d.DOWN||f==d.RIGHT||f==d.ENTER)a.preventDefault(b);else if(e){i&&clearTimeout(i);j&&j.abort&&j.abort();i=setTimeout(function(){j=H.getTrans("suggest",{onSuccess:function(b){u=-1;var d=a.core.util.easyTemplate(o,b.data).toString();d=c(n,d);D.groupMember.style.display="none";D.searchLists.innerHTML=d;D.searchLists.style.display=""},onFail:function(){},onError:function(){}}).request({q:e})},200)}else{i&&clearTimeout(i);j&&j.abort&&j.abort();D.groupMember.style.display="";D.searchLists.innerHTML="";D.searchLists.style.display="none"}},kickMember:function(b){var c=b.data,d=a.core.arr.indexOf(c.uid,y);if(d!=-1){y.splice(d,1);K.removeIndexElement(c.screen_name,v);K.removeIndexElement(c.uid,x);K.removeIndexElement(c.uid,y);w.push(c.uid)}var e=a.lib.kit.dom.parentElementBy(b.el,document.body,function(a){if(a.getAttribute("node-type")=="addUserItem")return!0});e&&a.removeNode(e);var f=a.sizzle("[node-type='addUserItem']",D.joinMemberListContain).length;K.updateGroupName()},addMember:function(b){var c=b.data.uid;b.data.actiontype="removeMember";if(y.length>e-1)a.ui.tipAlert("群人数已达上限!",{icon:"rederrorS",hideDelay:2e3}).beside(b.el);else if(!a.inArray(c,y)){y.push(c);x.push(c);v.push(b.data.screen_name);K.addMemberFunc([b.data]);K.updateGroupName();if(D.groupMember.style.display=="none"){C.value="";C.blur();D.groupMember.style.display="";D.searchLists.innerHTML="";D.searchLists.style.display="none"}}},addMemberFunc:function(b){var d=a.core.util.easyTemplate(p,b).toString();D.addUserLists.style.display="";a.insertHTML(D.addUserListsContain,d,"afterbegin");var e=a.sizzle("[node-type='addUserItem']",D.addUserListsContain).length;D.addUserCount.innerHTML=c("#L{新加成员（%s）}",e);e>0&&D.addUserCount.style.display==""},removeMember:function(b){var d=b.data;K.removeIndexElement(d.uid,y);K.removeIndexElement(d.screen_name,v);K.removeIndexElement(d.uid,x);var e=a.lib.kit.dom.parentElementBy(b.el,document.body,function(a){if(a.getAttribute("node-type")=="addUserItem")return!0});e&&a.removeNode(e);var f=a.sizzle("[node-type='addUserItem']",D.addUserListsContain).length;f!=0&&(D.addUserCount.innerHTML=c("#L{新加成员（%s）}",f));f==0&&(D.addUserLists.style.display="none");K.updateGroupName()},addGroupMember:function(b,c){c.actiontype="removeMember";var d=c.uid+"";if(!a.inArray(d,y)){y.push(d);x.push(d);v.push(c.screen_name);K.addMemberFunc([c])}K.updateGroupName()},updateGroupName:function(){D.group_all_count.innerHTML=y.length+(G?0:1);l&&l.reset();if(G)w.length==0&&x.length==0&&f==z?!a.hasClassName(D.editsubmitBtn,"W_btn_a_disable")&&a.addClassName(D.editsubmitBtn,"W_btn_a_disable"):a.hasClassName(D.editsubmitBtn,"W_btn_a_disable")&&a.removeClassName(D.editsubmitBtn,"W_btn_a_disable");else{var d=b.minNum-1;d=d>0?d:2;x.length>=d&&D.titleText.innerHTML!=""?a.hasClassName(D.editsubmitBtn,"W_btn_a_disable")&&a.removeClassName(D.editsubmitBtn,"W_btn_a_disable"):!a.hasClassName(D.editsubmitBtn,"W_btn_a_disable")&&a.addClassName(D.editsubmitBtn,"W_btn_a_disable")}if(!z){var e=v.length,g=c("#L{新建群}");t=g;e>0&&(g="");for(var h=0;h<e&&h<4;h++)g=g+v[h]+"、";e==1&&(g=g.substring(0,g.length-1));t=g.substring(0,16);D.titleText.innerHTML=t}},addGroupAllFunc:function(b){var d=b.length,f,g=[];for(var h=0;h<d;h++){var i=b[h];f=i.id+"";if(y.length>=e)break;if(!a.inArray(f,y)){i.actiontype="removeMember";g.push(i);y.push(f);x.push(f);v.push(i.screen_name)}}K.addMemberFunc(g);K.updateGroupName()},groupEditInputKeyup:function(){var b=F.getValue(),c=a.trim(b);c!=b&&F.setValue(c.substring(0,16))},addUserByName:function(){var b=B.getValue(),c=a.sizzle("[node-type='userItem']",D.searchLists),d=K.getCurItem(c);if(!d){if(y.length>e-1){a.ui.tipAlert("群成员已满!",{icon:"rederrorS",hideDelay:2e3}).beside(C);return}var f={nick:b};H.getTrans("check",{onSuccess:function(a){K.addGroupMember(undefined,a.data);C.value="";C.blur();D.groupMember.style.display="";D.searchLists.innerHTML="";D.searchLists.style.display="none"},onError:function(b){a.ui.tipAlert(b.msg,{icon:"rederrorS",hideDelay:2e3}).beside(C)},onFail:function(a){}}).request(f)}},setUserInfo:function(b,d){if(!G&&!!d){var e=d.currUser,f=d.addUser,g=a.core.util.easyTemplate(q,e).toString();K.addGroupAllFunc(f);D.addUserLists.style.display="";a.insertHTML(D.addUserListsContain,g,"afterbegin");var h=a.sizzle("[node-type='addUserItem']",D.addUserListsContain).length;D.addUserCount.innerHTML=c("#L{新加成员（%s）}",h);h>0&&D.addUserCount.style.display==""}},hideDialog:function(){a.custEvent.fire(r,"hide")}},L=function(){C=s.getDomList().group_search_input;E=s.getDomList().group_edit_input;D=s.getDomList();s.on("editGroupName","click",K.editGroupName);s.on("cannelEditGroup","click",K.cannelEditGroup);s.on("groupPostSubmit","click",K.groupPostSubmit);s.on("kickMember","click",K.kickMember);s.on("groupPostCannel","click",K.groupPostCannel);s.on("removeMember","click",K.removeMember);s.on("addMember","click",K.addMember);s.on("subimtEditGroup","click",K.subimtEditGroup);a.custEvent.define(r,["addSuccess","editSuccess","hide"])},M=function(){var b={gid:G};H.getTrans("info",{onSuccess:function(b){function j(){var c=b.data.admins,e=d,f={};a.foreach(e,function(a){f[a.uid]=a});a.foreach(c,function(a){f[a]&&(f[a].is_admin=1)});e=[];a.foreach(f,function(a){e.push(a)});e.sort(function(a,b){return(b.is_admin|0)-(a.is_admin|0)});e.sort(function(a,b){return(b.is_owner|0)-(a.is_owner|0)});d=e;e=f=null}z=b.data.name;f=z;var d=b.data.members||[],g=d.length,h=b.data.is_owner==1,i=a.inArray(parseInt($CONFIG.uid),b.data.admins);j();var k;for(var m=0;m<g;m++){k=d[m];y.push(k.uid+"");v.push(k.remark?k.remark:k.screen_name);d[m].nopower=!0;h?d[m].nopower=!1:i&&!d[m].is_owner&&!d[m].is_admin&&(d[m].nopower=!1)}if(h||i){var o="//weibo.com/p/230491"+G+"/members?from=managelayer";if(D.batManage){D.batManage.setAttribute("href",o);D.batManage.style.display=""}}e=parseInt(b.data.max_member)||e;D.maxConut.innerHTML=e;D.line.style.display="";var q=a.core.util.easyTemplate(p,d).toString();q=c(n,q);D.titleText.innerHTML=z;D.joinMemberListContain.innerHTML=q;!l&&(l=a.ui.scrollView(D.existing_box));l&&l.reset();!h&&!i&&(D.editGroupName.style.display="none");K.updateGroupName()},onFail:function(a){},onError:function(a){}}).request(b)},N=function(){B=a.lib.kit.dom.smartInput(C,{notice:C.defaultValue});F=a.lib.kit.dom.smartInput(E,{notice:E.defaultValue});a.custEvent.add(B,"enter",K.addUserByName);a.addEvent(C,"keydown",K.groupSuggest);a.addEvent(C,"keyup",K.groupinputkeyup);a.addEvent(C,"click",K.groupinputclick);a.addEvent(E,"keyup",K.groupEditInputKeyup);a.addEvent(s,"hide",K.hideDialog);G?M():K.updateGroupName();J=a.lib.group.groupMember(s.getDomList().groupMember,{members:b.addUsers});a.custEvent.add(J,"addMember",K.addGroupMember);a.custEvent.add(J,"getUserInfo",K.setUserInfo)},O=function(){L();N();s.on("shown",function(){var b=D.groupSelect.offsetHeight,c=D.existing_box.offsetHeight;D.searchLists.style.height=b+"px";!l&&(l=a.ui.scrollView(D.existing_box));l&&l.reset();J.setHeight(b)}).on("hide",function(){r.destroy()}).show()};O();r.destroy=function(){a.custEvent.undefine(r,["addSuccess","editSuccess","hide"]);a.removeEvent(C,"keydown",K.groupSuggest);a.removeEvent(C,"keyup",K.groupinputkeyup);a.removeEvent(E,"keyup",K.groupEditInputKeyup);a.custEvent.remove(B,"enter",K.addUserByName);a.removeEvent(C,"click",K.groupinputclick);J.destroy();F.destroy();B.destroy();l.destroy()};return r}});
STK.register("lib.publisher.source.publishTo",function(a){var b=a.lib.kit.extra.language,c=a.core.util.templet,d=a.core.util.easyTemplate,e=parseInt($CONFIG.isVmember),f;return function(c){var d,g,h=c&&c.editorWrapEl,i=c&&c.textEl,j=c&&c.trans||a.conf.trans.publishTo,k=c&&c.transName||"chatlist",l={},m=[],n,o={},p=c.isforward,q,r=!1,s,t,u,v=function(){if(!a.isNode(h))throw"publishTo need a wrapper node to parseDOM"},w=a.getUniqueKey(),x=function(a){var b=[],c;b.push('<div style="position: absolute;display:none;z-index:29999;outline:none;" hideFocus="true" node-type="publishTo" class="layer_menu_list" tabindex="10">');b.push('<ul id="'+w+'">');b.push('<li action-type="select" rank="0"><a title="#L{公开-你发表的微博可以被大家公开查看哦}" suda-data="key=tblog_edit_exposure&value=edit_public" href="javascript:void(0)" action-data="rank=0&text=#L{公开}&rankid=" action-type="publishTo"><i class="W_icon icon_type_public"></i>#L{公开}</a></li>');b.push('<li action-type="select" rank="6"><a title="#L{好友圈-发表的微博只有你的好友才能看到}" href="javascript:void(0)" action-data="rank=6&text=#L{好友圈}&rankid=" action-type="publishTo"><i class="W_icon icon_type_friends"></i>#L{好友圈}</a></li>');e&&b.push('<li action-type="select" rank="7"><a suda-data="key=tblog_edit_exposure&value=edit_vplus" title="#L{仅付费会员可见-发表的微博只有你的付费会员才能看到}" href="javascript:void(0)" action-data="rank=7&text=#L{仅付费会员可见}&rankid=" action-type="publishTo"><i class="W_icon icon_type_pay"></i>#L{仅付费会员可见}</a></li>');b.push('<li action-type="select" rank="1"><a title="#L{仅自己可见-发表的微博只有自己才能看到}" suda-data="key=tblog_edit_exposure&value=edit_private" href="javascript:void(0)" action-data="rank=1&text=#L{仅自己可见}&rankid=" action-type="publishTo"><i class="W_icon icon_type_self"></i>#L{仅自己可见}</a></li>');b.push('<li class="line S_line1"></li>');b.push('<li action-type="select"><a action-type="more" title="#L{群可见-发表的微博所有群成员都可以看到}" href="javascript:void(0);"><i class="W_icon icon_type_group_v2"></i>#L{群可见}</a></li>');b.push("</ul></div>");return b.join("")},y=function(a){var b=[],c=a.length,d;c>6?b.push('<ul class="scroll_bar W_scroll" id="'+w+'">'):b.push('<ul class="scroll_bar W_scroll" id="'+w+'" style="">');for(var e=0;e<c;e++){d=a[e];b.push('<li action-type="select"><a action-type="publishTo" action-data="rank=0&text='+d.gname+"&rankid="+d.gid+'" title="'+d.gname+'" href="javascript:void(0);" onclick="return false;"><em class="S_txt1">'+d.gname+"</em>");b.push('<span class="qunlist_right" action-type="setting" suda-data="key=adm_group&value=mail_publish"><em class="W_ficon ficon_setup S_ficon">J</em></span></a></li>')}b.push("</ul>");b.push('<ul><li class="line S_line1"></li>');b.push('<li  class="lotopt"><a href="javascript:void(0)" onclick="return false;" action-type="back">#L{返回}</a>');b.push('<a href="javascript:void(0);"suda－data="key=build_group&value=mail_publish"  action-data="minNum=2" action-type="createGroup" class="right"><em class="W_ficon ficon_add S_ficon">+</em><em class="S_txt1">#L{新建群}</em></a></li>');b.push("</ul>");return b.join("")},z=function(){g=a.lib.kit.dom.parseDOM(a.builder(h).list);g.wrap||(g.wrap=h);s=g.wrap.className;g.submit&&(t=g.submit.innerHTML)},A=function(){d=function(){var d={},e,l,o,p,v=g.showPublishTo;l=e=v&&v.getAttribute("action-data")&&a.core.json.queryToJson(v.getAttribute("action-data"))||{rank:"all",rankid:""};d.node=a.core.evt.delegatedEvent(h);var z=!1,A={hotKeyChangeRank:function(c,d){var g=d.match(/\d+/);if(g&&g[0]){var h=parseInt(g[0],10)-1,i=[{rank:0,rankid:"",text:b("#L{公开}"),title:b("#L{公开-你发表的微博可以被大家公开查看哦}")},{rank:6,rankid:"",text:b("#L{好友圈}"),title:b("#L{好友圈-发表的微博只有你的好友才能看到}")},{rank:1,rankid:"",text:b("#L{仅自己可见}"),title:b("#L{仅自己可见-发表的微博只有自己才能看到}")}],j=function(){a.foreach(k,function(a){a.rank=7;a.rankid=a.gid;a.text=a.gname;a.title=a.gname});i=i.concat(k);var b=window.$CONFIG&&window.$CONFIG.miyou=="1";b||i.splice(1,1);if(i[h]){e=i[h];F.btnContent(e.text);F.btnTitle(e.title);z=!1;a.custEvent.fire(F,"changeRank",e)}},k=function(){if(f)return a.core.arr.copy(f);G.group.request(function(b){k=a.core.arr.copy(b);j()});return null}();k&&j()}}},B=function(){d.node.add("showPublishTo","click",F.show)},C=function(){G.normal.bind();G.group.bind();D.bind()},D={keyboardManager:null,keyTypes:["up","down","esc","enter"],getIndex:function(b){var c=D.getList(),d=D.lastCur,e;a.foreach(c,function(a,b){if(d===a){e=b;return!1}});b>0?e++:e--;e>=c.length?e=0:e<0&&(e=c.length-1);return e},up:function(){r=!0;var a=D.getIndex(-1),b=D.getList()[a];D.setCur(b,a);r=!1},down:function(){r=!0;var a=D.getIndex(1),b=D.getList()[a];D.setCur(b,a);r=!1},enter:function(){var b=D.lastCur;if(!b.getAttribute("action-type")||b.getAttribute("action-type")=="select")b=a.sizzle("[action-type]",b)[0];b&&d.layer.fireDom(b,"click",null)},esc:function(){F.hide()},bind:function(){D.keyboardManager=a.lib.publisher.widget.keyboardCapture(g.publishTo,{stopScroll:!0});a.custEvent.define(D.keyboardManager,D.keyTypes);for(var b=0,c=D.keyTypes.length;b<c;b++){var d=D.keyTypes[b];a.custEvent.add(D.keyboardManager,d,D[d])}},list:null,lastCur:null,focusPublishTo:function(){g.publishTo.focus();var b=this.getList(!0),c=a.sizzle('li[rank="'+e.rank+'"]',g.publishTo)[0];this.setCur(c||b[0],0)},setCur:function(b,c,d){this.lastCur&&a.removeClassName(this.lastCur,"cur");a.addClassName(b,"cur");this.lastCur=b;var e=a.E(w);if(a.contains(e,b)){var f=function(b){return a.core.dom.getSize(b).height+(parseFloat(a.core.dom.getStyle(b,"marginTop"))||0)+(parseFloat(a.core.dom.getStyle(b,"marginBottom"))||0)},g=c+1,h=Math.max(f(b),f(a.sizzle("a",b)[0]));if(d)return;g>6?e.scrollTop=(g-6)*h:e.scrollTop=0}},getList:function(b){if(b||!this.list){var c=a.sizzle("li",g.publishTo),d=[];a.foreach(c,function(b){a.getStyle(b,"display")!="none"&&b.className!="line"&&d.push(b)});this.list=d}return this.list}},E={setPos:function(){var b=a.core.dom.getSize;document.body.appendChild(g.publishTo);var c=b(g.showPublishTo).width-b(g.publishTo).width;a.lib.kit.dom.layoutPos(g.publishTo,g.showPublishTo,{offsetX:c+2,offsetY:2})},overHandler:function(b){if(!r){var c=a.sizzle("[action-type=select]",g.publishTo);index=a.core.arr.indexOf(b.el,c);list=a.sizzle(".cur",g.publishTo);list&&list[0]&&a.core.dom.removeClassName(list[0],"cur");a.core.dom.addClassName(c[index],"cur");D.setCur(c[index],index,!0)}},init:function(){d.layer=a.core.evt.delegatedEvent(g.publishTo);d.closeFriend=a.core.evt.delegatedEvent(g.publishTo)},show:function(){var b=a.getStyle(g.publishTo,"display")!="none";a.setStyle(g.publishTo,"display","");E.setPos();D.focusPublishTo();b||a.ui.effect(g.publishTo,"fadeInDown","fast");if(!n){n=1;E.bindBodyEvt()}return!1},hide:function(){!g.publishTo||a.ui.effect(g.publishTo,"fadeOutUp","fast",function(){a.setStyle(g.publishTo,"display","none");z=!1;if(n){n=0;E.removeBodyEvt()}})},autoHide:function(b){b=a.core.evt.fixEvent(b);g.showPublishTo!==b.target&&!a.core.dom.contains(g.showPublishTo,b.target)&&!a.core.dom.contains(g.publishTo,b.target)&&F.hide()},content:function(a){if(typeof a=="undefined")return g.publishTo.innerHTML;g.publishTo.innerHTML=a},bindBodyEvt:function(){a.addEvent(document.body,"click",E.autoHide)},removeBodyEvt:function(){a.removeEvent(document.body,"click",E.autoHide)}},F={enable:function(){g.showPublishTo.setAttribute("action-type","showPublishTo")},disable:function(){g.showPublishTo.setAttribute("action-type","")},miYouStyle:function(a,c){var d="2",e=$CONFIG.lang=="zh-cn"?"":"_CHT";d==c.rank?g.submit.innerHTML=b('<span class="btn_30px">#L{好友发布}</span>'):g.submit.innerHTML=t},show:function(){var b=function(){a.custEvent.fire(F,"show");z?G.group.show():G.normal.show()};if(g.publishTo){var c=a.getStyle(g.publishTo,"display");if(c==="none")b();else{a.setStyle(g.publishTo,"display","none");z=!1}}else b();a.preventDefault()},btnContent:function(b){b&&(o.innerHTML=a.encodeHTML(b))},btnTitle:function(a){a&&g.showPublishTo.setAttribute("title",a)},hide:function(){E.hide()},toggle:function(){z||(g.publishTo.style.display=="none"?F.show():F.hide())},rank:function(){return e},setRank:function(d){var f={0:{rankid:"",text:b("#L{公开}"),title:b("#L{公开-你发表的微博可以被大家公开查看哦}")},6:{rankid:"",text:b("#L{好友圈}"),title:b("#L{好友圈-发表的微博只有你的好友才能看到}")},1:{rankid:"",text:b("#L{仅自己可见}"),title:b("#L{仅自己可见-发表的微博只有自己才能看到}")},7:{rankid:"",text:b("#L{仅付费会员可见}"),title:b("#L{仅付费会员可见-发表的微博只有你的付费会员才能看到}")}},h=i&&i.getAttribute("timer"),j=i&&i.getAttribute("tid"),k=c.editor&&c.editor.nodeList&&c.editor.nodeList.settime&&a.getStyle(c.editor.nodeList.settime,"display");if(f[d.rank]){d.rankid=f[d.rank].rankid;d.text=f[d.rank].text;d.title=f[d.rank].title}else d.pubToTxt&&(d.text=d.title=d.pubToTxt);F.enable();g.wrap.className=s;d.text&&F.btnContent(d.text);d.title&&F.btnTitle(d.title);d.rank=="6"?g.submit.innerHTML=c.editor&&c.editor.nodeList&&c.editor.nodeList.settime&&k!=="none"||h||j?b("#L{定时发布}"):b("#L{好友发布}"):g.submit.innerHTML=c.editor&&c.editor.nodeList&&c.editor.nodeList.settime&&k!=="none"||h||j?b("#L{定时发布}"):b("#L{发布}");c.editor&&a.custEvent.fire(c.editor,"changeBtn",[h||j?b("#L{定时发布}"):ret.data.rank=="6"?b("#L{好友发布}"):b("#L{发布}")]);e=d||l},reset:function(){var d=i&&i.getAttribute("timer"),f=i&&i.getAttribute("tid"),h=c.editor&&c.editor.nodeList&&c.editor.nodeList.settime&&a.getStyle(c.editor.nodeList.settime,"display");F.enable();g.wrap.className=s;t=c.editor&&c.editor.nodeList&&c.editor.nodeList.settime&&h!=="none"||d||f?b("#L{定时发布}"):b("#L{发布}")||t;F.btnContent(p.content);F.btnTitle(p.title);z=!1;g.submit.innerHTML=t;c.editor&&a.custEvent.fire(c.editor,"changeBtn",[b("#L{发布}")]);e=null;e=l},destroy:function(){try{for(var b in d)d[b].destroy()}catch(c){}m.length&&a.hotKey.remove(i,m,A.hotKeyChangeRank);a.removeNode(g.publishTo);a.custEvent.undefine(F);if(D.keyboardManager){D.keyboardManager.destroy();a.custEvent.undefine(D.keyboardManager,D.keyTypes)}},changeRank:function(b){b=b>0?b-1:0;var c=a.sizzle('a[action-type="publishTo"]',g.publishTo)[b];if(c){G.normal.changeRank({el:c,data:a.core.json.queryToJson(c.getAttribute("action-data")||"")});var d=c.getAttribute("suda-data");if(d){var e=d.match(/key=(.+?)&value=(.+)/);e&&e.length===3&&window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack(e[1],e[2])}}},getDomHeight:function(){return g.publishTo.style.display=="none"?{width:0,heigth:0}:a.core.dom.getSize(g.publishTo)},bindAltKey:function(){if(a.isNode(i)){var b=a.core.util.browser.OS==="macintosh";if(b)for(var c=1;c<=9;c++)m.push("ctrl+"+c);else for(var c=1;c<=9;c++)m.push("alt+"+c);a.hotKey.add(i,m,A.hotKeyChangeRank)}}},G={normal:{bind:function(){d.layer.add("publishTo","click",G.normal.changeRank);d.layer.add("more","click",G.normal.more);d.layer.add("select","mousemove",E.overHandler)},getList:function(){E.content(q)},more:function(){G.group.show();z=!0;a.core.evt.stopEvent()},show:function(){var a=function(){if(!g.publishTo){H();E.init();C()}G.normal.getList();E.show()};f?a():G.group.request(a)},editGroupCallback:function(b){G.group.request(function(b){groups=a.core.arr.copy(b);G.group.cache=null})},changeRank:function(d){try{a.preventDefault(d.evt)}catch(f){}var h=i&&i.getAttribute("pubType"),j=i&&i.getAttribute("timer"),k=i&&i.getAttribute("tid"),l=c.editor&&c.editor.nodeList&&c.editor.nodeList.settime&&a.getStyle(c.editor.nodeList.settime,"display"),m=a.fixEvent().target,n=!1;if(m.getAttribute("action-type")=="setting")n=!0;else{var o=a.lib.kit.dom.parentElementBy(m,g.publishTo,function(a){if(a.getAttribute("action-type")=="setting")return!0});o&&(n=!0)}if(n){var p=d.data.rankid.split(":")[1];F.hide();u=a.lib.group.gmemberSelect({gid:p,editSuccessCallback:G.normal.editGroupCallback})}else{e=d.data;var q=d.data.text,r=d.el.getAttribute("title");F.btnContent(q);F.btnTitle(r);e.rank=="group"?G.group.show():F.hide();a.custEvent.fire(F,"changeRank",e);d.data.rank=="6"?g.submit.innerHTML=c.editor&&c.editor.nodeList&&c.editor.nodeList.settime&&l!=="none"||j||k?b("#L{定时发布}"):b("#L{好友发布}"):g.submit.innerHTML=c.editor&&c.editor.nodeList&&c.editor.nodeList.settime&&l!=="none"||j||k?b("#L{定时发布}"):h&&h=="forward"?b("#L{转发}"):b("#L{发布}");c.editor&&a.custEvent.fire(c.editor,"changeBtn",[j||k?b("#L{定时发布}"):d.data.rank=="6"?b("#L{好友发布}"):b("#L{发布}")])}}},group:{request:function(b){j.request(k,{onSuccess:function(a){var c=a.data.length;for(var d=0;d<c;d++)a.data[d].index=d+1;f=a.data;b&&b(f)},onError:function(b){a.lib.dialog.ioError(b.code,b)}},{})},bind:function(){d.layer.add("back","click",G.group.back);d.layer.add("createGroup","click",G.group.createGroup)},getList:function(){if(!G.group.cache){var a=b(y(f));G.group.cache=a;E.content(G.group.cache)}else E.content(G.group.cache)},show:function(){G.group.getList();E.show()},back:function(){var b=a.core.evt.fixEvent();a.core.evt.stopEvent(b);z=!1;G.normal.show()},groupSelectCallback:function(b){e={rank:7,rankid:b.page_objectid,text:b.name,title:b.name};var c=b.name;F.btnContent(c);F.btnTitle(c);a.custEvent.fire(F,"changeRank",e);G.group.request(function(b){groups=a.core.arr.copy(b);G.group.cache=null})},createGroup:function(b){F.hide();var c=b.data;c.extraData={fromapp:1};c.addSuccessCallback=G.group.groupSelectCallback;u=a.lib.group.gmemberSelect(c)}}},H=function(c){var d=b(x(c));g.publishTo=a.insertHTML(document.body,d,"beforeend");q=g.publishTo.innerHTML},I=function(){if(!a.isNode(g.showPublishTo))return 0;o=g.publishTotext;p={content:o.innerHTML,title:g.showPublishTo.getAttribute("title")};B();return 1},J=I();a.custEvent.define(F,["show","hide","changeRank"]);return J?F:null}();d&&d.bindAltKey&&d.bindAltKey()},B=function(){v();z();A()};B();return d}});
STK.register("lib.publisher.source.shine",function(a){var b=function(a){return a.slice(0,a.length-1).concat(a.concat([]).reverse())};return function(c,d){var e=a.parseParam({start:"#fff",color:"#fbb",times:2,step:5,length:4},d),f=e.start.split(""),g=e.color.split(""),h=[];for(var i=0;i<e.step;i+=1){var j=f[0];for(var k=1;k<e.length;k+=1){var l=parseInt(f[k],16),m=parseInt(g[k],16);j+=Math.floor(parseInt(l+(m-l)*i/e.step,10)).toString(16)}h.push(j)}for(var i=0;i<e.times;i+=1)h=b(h);var n=!1,o=a.timer.add(function(){if(!h.length)a.timer.remove(o);else{if(n){n=!1;return}n=!0;c.style.backgroundColor=h.pop()}})}});
STK.register("lib.publisher.source.scoreshine",function(a){return function(b,c){var d=a.lib.kit.extra.language,e,f=0,e=setInterval(function(){c.innerHTML=d("#L{亲，先打个分吧}");b.style.width=f%2==0?"100%":"0%";f++;f>3&&clearInterval(e)},200)}});
STK.register("lib.kit.extra.keySubmit",function(a){function f(c,e){var f=a.core.dom.uniqueID(c);if(f in b){var g=a.core.arr.indexOf(e,b[f]);g>=0&&b[f].splice(g,1);if(b[f].length==0){delete b[f];a.removeEvent(c,"keydown",d)}}}function e(c,e){var f=a.core.dom.uniqueID(c);if(f in b)a.core.arr.inArray(e,b[f])||b[f].push(e);else{b[f]=[e];a.addEvent(c,"keydown",d)}}function d(d){d=a.fixEvent(d);var e=a.core.dom.uniqueID(d.target),f=d.keyCode===13||d.keyCode===10;f&&(c&&d.metaKey||!c&&d.ctrlKey)&&b[e]&&a.foreach(b[e],function(a){a(d)})}var b={},c=a.core.util.browser.OS==="macintosh";return{on:e,off:f}});
STK.register("conf.trans.rteditor",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("create",{url:"/aj/article/create",method:"post"});c("getvideo",{url:"/aj/article/getvideo",method:"post"});c("setdraft",{url:"/aj/article/setdraft",method:"post"});c("getdraft",{url:"/aj/article/getdraft",method:"post"});c("cleandraft",{url:"/aj/article/cleandraft",method:"post"});c("import",{url:"/aj/article/import",method:"get"});return b});
STK.register("conf.channel.at",function(a){var b=["open","close"];return a.lib.kit.extra.listener.define("conf.channel.at",b)});
STK.register("lib.kit.dom.autoHeightTextArea",function(a){var b=a.core.util.browser.MOZ,c=a.core.util.browser.IE6||a.core.util.browser.IE7||a.core.util.browser.IE8,d=function(d){var e=a.core.dom.getStyle,f;d.defaultHeight||(d.defaultHeight=parseInt(e(d,"height"),10)||parseInt(d.offsetHeight,10)||20);if(c){var g=parseInt(e(d,"paddingTop"),10)+parseInt(e(d,"paddingBottom"),10);f=Math.max(d.scrollHeight-g,d.defaultHeight)}else{var g=b?0:parseInt(e(d,"paddingTop"),10)+parseInt(e(d,"paddingBottom"),10),h=a.E("_____textarea_____");if(!h){h=a.C("textarea");h.id="_____textarea_____";document.body.appendChild(h)}if(h.currentTarget!=d){var i=[];i.push("width:"+e(d,"width"));i.push("font-size:"+e(d,"fontSize"));i.push("font-family:"+e(d,"fontFamily"));i.push("line-height:"+e(d,"lineHeight"));i.push("padding-left:"+e(d,"paddingLeft"));i.push("padding-right:"+e(d,"paddingRight"));i.push("padding-top:"+e(d,"paddingTop"));i.push("padding-bottom:"+e(d,"paddingBottom"));i.push("top:-1000px");i.push("height:0px");i.push("position:absolute");i.push("overflow:hidden");i.push("");i=i.join(";");h.style.cssText=i}h.value=d.value;f=Math.max(h.scrollHeight-g,d.defaultHeight);h.currentTarget=d}return f};return function(b){function j(b){var c=a.core.dom.getStyle,d,e=[];e.push("width:"+c(b,"width"));e.push("font-size:"+c(b,"fontSize"));e.push("font-family:"+c(b,"fontFamily"));e.push("line-height:"+c(b,"lineHeight"));e.push("padding-left:"+c(b,"paddingLeft"));e.push("padding-right:"+c(b,"paddingRight"));e.push("padding-top:"+c(b,"paddingTop"));e.push("padding-bottom:"+c(b,"paddingBottom"));e.push("top:-1000px");e.push("height:0px");e.push("position:absolute");e.push("overflow:hidden");e.push("");e=e.join(";");return e}var c=b.textArea,e=b.maxHeight,f=b.inputListener,g=c.style,h;(h=function(){typeof f=="function"&&f();setTimeout(function(){var a=d(c),b;e=e||a;var f=a>e;b=f?e:a;g.overflowY=f?"auto":"hidden";g.height=Math.min(e,a)+"px"},0)})();if(!a.core.util.browser.IE)try{a.conf.channel.at.register("open",function(){a.E("_____textarea_____").style.cssText=j(c)})}catch(i){a.log(i)}if(!c.binded){a.addEvent(c,"keyup",h);a.addEvent(c,"focus",h);a.addEvent(c,"blur",h);c.binded=!0;c.style.overflow="hidden"}}});
STK.register("conf.trans.follow",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("follow",{url:"/aj/f/followed",method:"post"});c("follows",{url:"//weibo.com/aj/f/followed",method:"get",requestMode:"jsonp",varkey:"callback"});c("unFollow",{url:"/aj/f/unfollow",method:"post"});c("block",{url:"/aj/f/addblack",method:"post"});c("unBlock",{url:"/aj/f/delblack",method:"post"});c("removeFans",{url:"/aj/f/remove",method:"post"});c("follow_object",{url:"/p/aj/relation/follow",method:"post"});c("unFollow_object",{url:"/p/aj/relation/unfollow",method:"post"});c("unloginfollow",{url:"/p/aj/official/unloginfollow",method:"post"});c("proxy",{url:"/aj/proxy",method:"post"});c("recommend",{url:"/aj/f/recomafterfollowv2",method:"get"});c("removeFollow",{url:"/aj/f/removerecomfollow",method:"get"});return b});
STK.register("conf.channel.follow",function(a){var b=["changeStatus","specialFollow"];return a.lib.kit.extra.listener.define("conf.channel.follow",b)});
STK.register("lib.follow.utils.follow",function(a){var b=a.lib.kit.extra.merge,c=a.conf.channel.follow;return function(d){var e={};d=a.parseParam({trans:a.conf.trans.follow,transNameFollow:"follow",transNameUnfollow:"unFollow",transNameBlock:"block",transNameUnBlock:"unBlock",transNameRemoveFans:"removeFans",refer_sort:"",refer_flag:""},d);var f=a.lib.kit.extra.merge,g=a.lib.dialog.validateCode(),h=function(b,c){a.lib.dialog.ioError(b.code,b)},i=function(e,h){var j=b({uid:undefined,objectid:undefined,f:0,extra:"",refer_sort:d.refer_sort,refer_flag:d.refer_flag,location:window.$CONFIG&&$CONFIG.location||"",oid:window.$CONFIG&&$CONFIG.oid||"",wforce:1,nogroup:!1},h),k=e+(j.objectid?"_object":"");if(e==="follow"){j.api?k="proxy":j.unlogin&&(k="unloginfollow");var l=d.trans.getTrans(k,{onComplete:function(b,d){var j={onSuccess:function(a,b){var d=f(h,a.data),g=h.onSuccessCb;typeof g=="function"&&g(d);c.fire("changeStatus",{uid:d.uid,objectid:d.objectid,action:e,both:d.relation&&d.relation.follow_me==1})},onError:function(b,c){b.code==100050?a.ui.confirm(b.msg,{OK:function(){h.wforce=0;i(e,h)}}):a.lib.dialog.ioError(b.code,b);var d=h.onFailCb;typeof d=="function"&&d(f(h,b.data))},requestAjax:l,param:d,onRelease:function(){var a=h.onRelease;typeof a=="function"&&a()}};g.validateIntercept(b,d,j)}});l.request(j)}else d.trans.request(k,{onSuccess:function(a,b){var d=f(h,a.data),g=h.onSuccessCb;typeof g=="function"&&g(d);c.fire("changeStatus",{uid:d.uid,objectid:d.objectid,action:e,fan:d.relation&&d.relation.follow_me==1})},onError:function(b,c){a.lib.dialog.ioError(b.code,b);var d=h.onFailCb;typeof d=="function"&&d()}},j)};e.follow=function(a){i(d.transNameFollow,a)};e.unFollow=function(a){i(d.transNameUnfollow,a)};e.block=function(a){i(d.transNameBlock,a)};e.unBlock=function(a){i(d.transNameUnBlock,a)};e.removeFans=function(a){i(d.transNameRemoveFans,a)};return e}});
STK.register("conf.trans.setGroup",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("list",{url:"/aj/f/group/list",method:"get"});c("update",{url:"/aj/f/group/update",method:"post"});c("batchSet",{url:"/aj3/attention/aj_group_batchupdate_v4.php",method:"post"});c("add",{url:"/aj/f/group/add",method:"post"});c("recommendfollow",{url:"/aj/f/recomafterfollow",method:"get"});c("closerecommend",{url:"/aj/f/closerecommend",method:"get"});c("checkcloserelation",{url:"/aj/f/checkcloserelation",method:"post"});c("addCloseFriend",{url:"/aj/f/createclosefriend",method:"post"});c("followGroup",{url:"/aj/f/group/followedgroup",method:"post"});return b});
STK.register("lib.dialog.groupListPanel",function(a){var b=a.lib.kit.extra.language,c=b("#L{我的推荐}");return function(c){var d={},e=a.C("div"),f={},g={},h,i=a.delegatedEvent(e),j=$CONFIG.imgPath+"style/images/common/transparent.gif",k=[{mode:"special",className:"W_ico16 i_conn_public",title:b("#L{所有人可见}")},{mode:"normal",className:"W_ico16 i_conn_public",title:b("#L{所有人可见}")}],l=function(a,b,c){if(!!a){c&&(c=c.toUpperCase());var d=a[b];while(d){if(d.nodeType==1&&(c?d.nodeName==c:!0))break;d=d[b]}return d}},m=c.multi?'style="display:none;"':'<#if (item.belong==1)><#else>style="display:none;"</#if>',n='<ul node-type="#{mode}" class="group_ul #{addOnClass} clearfix"></ul>',o=a.core.util.easyTemplate('<#et listItem gList><#list gList as item><li class="group_li" ><label for="${item.gid}" ><input action-type="select" id="${item.gid}" type="checkbox"<#if (item.recom_join)> recom_join="1" </#if><#if (item.belong==1 || item.recom_join || item.gid == 0)>checked="checked"</#if> <#if (item.ogname)>ogname="${item.ogname}"</#if>class="W_checkbox" value="${item.gid}"><span class="group_name <#if (item.gid==0 || item.recom_join)>W_autocut</#if>"  node-type="gplist_${item.gid}_gname"><span><#if (item.ogname)>${item.ogname}<#elseif (item.gname)>${item.gname}</#if></span><#if (item.needIcon == 1)><span class="W_icon icon_askS" action-type="specialAttentionTip"></span><#elseif (item.gid == 0)><i class="new_group_tag">'+b("#L{新分组}")+"</i></#if>"+"<#if (item.gid == 0)>"+'<em class="S_txt2">('+b("#L{建议创建并加到该组}")+'</em></span><em class="S_txt2">)</em>'+"<#elseif (item.recom_join)>"+'<em class="S_txt2">('+b("#L{建议加到该组}")+'</em></span><em class="S_txt2">)</em>'+"</#if>"+"<#if (item.recom_add)>"+'<em class="S_txt2">('+b("#L{勾选此组即可将这个帐号推荐给粉丝}")+'</em></span><em class="S_txt2">)</em>'+"</#if>"+"</label>"+"</li>"+"</#list>"+"</#et>"),p,q='<div class="W_layer W_layer_pop"><div class="content layer_mini_info"> <p class="main_txt"><i class="W_icon icon_succ"></i><span class="txt S_txt1">#L{不想错过Ta的每一条微博？<br>可以将其加到这个分组里，方便在首页查看}</span></p><div class="W_layer_arrow"><span node-type="arrow" class="W_arrow_bor"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div></div>',r=function(b){var c=document.createTextNode(b),d=a.C("div");d.appendChild(c);var e=d.innerHTML;d=c=null;return e},s=function(){var b="";for(var d=0;d<k.length;d++){d!=k.length-1?k[d].addOnClass="spec":k[d].addOnClass="";b+=a.templet(n,k[d])}e.innerHTML=b;h=a.lib.kit.dom.parseDOM(a.core.dom.builder(e).list);c.data&&A(c.data)},t=function(){for(var b=0;b<k.length;b++){var d=k[b].mode;if(d=="system"&&f[d]){c.fromFollow&&a.foreach(f[d],function(a,b){a.fromFollow=1});var e=o(f[d]).toString(),g=c.fromFollow?h.special:h.normal;g&&a.insertHTML(g,e,"afterbegin")}else if(f[d]){var e=o(f[d]).toString();h[d].innerHTML+=e}}!f.special&&h.special&&(h.special.style.display="none")};lengthLimit=function(b){var c=a.fixEvent(b).target;a.bLength(c.value)>16&&(c.value=a.leftB(c.value,16))},onEnter=function(b){if(b.keyCode===13){var c=a.fixEvent(b).target;a.fireEvent(c,"blur")}};var u=function(b){var c=l(b,"parentNode","li");if(!!c){var d=a.sizzle('input[action-type="select"]',c)[0];g[d.id]||(g[d.id]={});return g[d.id]}},v={show:function(c){p=a.ui.bubble(b(q)).show().beside(c.el,{pos:"bottom-left",offsetX:-10,offsetY:2})},hide:function(){p.hide()}},w=function(){i.add("specialAttentionTip","mouseover",v.show);i.add("specialAttentionTip","mouseout",v.hide)},x=function(){s();w()},y=function(){return e},z=function(b){var c=b.mode||"normal";f[c]=f[c]||[];f[c].push(b);var d=o([b]).toString();a.insertHTML(h[c],d,"beforeend")},A=function(d){f={};if(a.isArray(d))for(var e=0,g=d.length;e<g;e++){d[e].gid=="0"||d[e].recom_join==1?d[e].mode="special":d[e].mode="normal";c.fromFollow&&d[e].gname==b("#L{特别关注}")&&(d[e].needIcon=1);var h=d[e].mode;f[h]=f[h]||[];f[h].push(d[e])}t()},B=function(){var b=[],c={suda:[],diss:{allGroup:0,autoSelect:0,gid:[],uid:$CONFIG.uid}},d=a.sizzle('input[action-type="select"]',e),f,g;c.diss.allGroup=d.length;for(var h=d.length;h--;){var i={};f=g=!1;if(d[h].checked){f=!0;var j=u(d[h]);if(j){i.gid=d[h].value;i.gid=="0"&&(i.ogname=d[h].getAttribute("ogname")||"");b.push(i)}}if(d[h].getAttribute("recom_join")){g=!0;c.diss.autoSelect++;c.diss.gid.push(d[h].value)}(g||f)&&c.suda.push(d[h].value+(g?"_a":"_b")+(f?"_1":"_0"))}b.suda_diss=c;return b},C=function(){t()},D=function(){f={};t()},E=function(){i.destroy();g=null;f=null;h=null;e=null},F=function(){var b=a.sizzle('input[action-type="select"]',e);return b.length};x();d.getOuter=y;d.length=F;d.add=z;d.setData=A;d.getData=B;d.reset=C;d.clear=D;d.destroy=E;return d}});
STK.register("lib.dialog.vipError",function(a){var b='<#et temp data><div node-type="outer" class="layer_point"><dl class="point clearfix"><dt><span class="${data.icon}" node-type="icon"></span></dt><dd node-type="inner">${data.info}</dd></dl></div><div class="W_layer_btn S_bg1"><a href="javascript:void(0);" <#if (data.lbtnStyle == 1)>class="W_btn_a"<#else if (data.lbtn == 0)>class="W_btn_b"</#if> node-type="lbtn"><span><#if (data.lbtnIcon == 1)><i class="W_icon icon_member"></i></#if>${data.lbtnText}</span></a><a href="javascript:void(0);" <#if (data.rbtnStyle == 1)>class="W_btn_a"<#else if (data.rbtn == 0)>class="W_btn_b"</#if> node-type="rbtn"><span><#if (data.rbtnIcon == 1)><i class="W_icon icon_member"></i></#if>${data.rbtnText}</span></a></div></#et>',c={success:"icon_succM",error:"icon_errorM",warn:"icon_warnM","delete":"icon_delM",question:"icon_questionM"},d=a.lib.kit.extra.language,e=function(e){var f,g,h;f=a.parseParam({title:"&nbsp;",icon:"warn",info:"",lbtnFunc:a.funcEmpty,lbtnStyle:0,lbtnIcon:0,lbtnText:d("#L{立即开通会员}"),rbtnFunc:a.funcEmpty,rbtnStyle:0,rbtnIcon:0,rbtnText:d("#L{立即开通会员}")},e);f.icon=c[f.icon];g=a.ui.dialog();g.setContent(a.core.util.easyTemplate(b,f).toString());h=g.getDomList(!0);g.setTitle(f.title);g.getDomList().title.style.borderBottomStyle="none";var i=function(){f.lbtnFunc();g.hide()},j=function(){f.rbtnFunc();g.hide()};a.addEvent(h.lbtn,"click",i);a.addEvent(h.rbtn,"click",j);a.custEvent.add(g,"hide",function(){a.custEvent.remove(g,"hide",arguments.callee);a.removeEvent(h.lbtn,"click",i);a.removeEvent(h.rbtn,"click",j)});g.show().setMiddle();return g};return function(a,b){if(a=="100096"||a=="100098"){b.lbtnStyle=0;b.lbtnIcon=0;b.lbtnText=d("#L{管理分组}");b.rbtnStyle=1;b.rbtnIcon=1;b.rbtnText=d("#L{开通会员}");b.rbtnFunc=function(){location.href="//vip.weibo.com/paycenter?form=group"}}else if(a=="100097"){b.lbtnStyle=0;b.lbtnIcon=0;b.lbtnText=d("#L{管理分组}");b.rbtnStyle=0;b.rbtnIcon=0;b.rbtnText=d("#L{知道了}")}return e(b)}});
STK.register("lib.dialog.setGroup",function(a){var b=30,c="//rs.sinajs.cn/sgmark.gif",d=a.lib.kit.extra.language,e=a.lib.kit.extra.merge;return function(){function C(a){return s.extraPostData?e(a,typeof s.extraPostData=="function"?s.extraPostData():s.extraPostData):a}var f={},g=!1,h=0,i,j=5,k=a.ui.dialog(),l=a.ui.alert,m,n={groupBox:'<div class="layer_set_group" node-type="group_panel"><input type="hidden" node-type="uid" name="touid" ><div class="remark_set" node-type="remarkPanel"><label for=""><em class="W_fb">#L{备注名称：}</em><input type="text" node-type="remarkInput" name="remark" class="W_input" value="#L{填写备注名称}"></label></div><div class="group_box"><h4 class="tit W_fb" node-type="message">#L{选择分组：}</h4><div class="loading_box" node-type="loading"><i class="W_loading"></i><span class="S_txt1">正在加载，请稍候</span></div><div class="choose_area"><div class="group_list" node-type="groupList"></div><div node-type="addGroupPanel"><div class="opt_area" node-type="showBtnBox"><a href="javascript:void(0);" class="W_btn_b" action-type="showBtn"><em class="W_ficon ficon_add S_ficon">+</em>#L{创建新分组}</a></div><div style="display:block;" class="add_group clearfix" node-type="addGroupBox"><div class="W_fl"><input type="text" node-type="groupInput" class="W_input" value="#L{新分組}"><a href="javascript:void(0);" class="W_btn_a" action-type="addGroup" node-type="addGroup">#L{创建}</a><a action-type="hideBtn" href="javascript:void(0);" action-type="hideBtn">#L{取消}</a></div></div></div></div><div class="reco_area" style="display:none;" node-type="samelist"><div class="WB_cardtitle_a" ><h4 class="obj_name"><span class="main_title W_fb" node-type="recommMsg">#L{Ta 的粉丝也关注}</span></h4><div class="opt_box"><a href="javascript:void(0);"  suda-uatrack="key=V6addattenlayer&value=change" action-type="refresh" class="opt_change S_txt1" node-type="refreshbtn"><em class="W_ficon ficon_rotate W_f14 S_ficon">e</em>#L{换一换}</a></div></div><ul class="pt_ul clearfix" node-type="userList"></ul></div></div></div><div class="W_layer_btn S_bg1" node-type="confirmBox"><a href="javascript:void(0);" suda-data="key=V6addattenlayer&value=save" class="W_btn_a btn_34px" action-type="submit" node-type="submit">#L{保存}</a><a href="javascript:void(0);" suda-data="key=V6addattenlayer&value=cancel" class="W_btn_b btn_34px" action-type="cancel">#L{取消}</a></div>',checkBox:'<input type="checkbox" value="{value}" name="gid" class="W_checkbox" {checked} id="group_{groupId}"><label for="group_{groupId}">{name}</label>',userlist:'<#et data data><li class="picitems" uid="${data.uid}"><div class="midbox"><p class="pic_wrap"><span class="pic_box"><a href="${data.profile_url}" suda-data="key=V6addattenlayer&value=head" target="_blank"><img src="${data.profile_image_url}" width="50" height="50" alt="${data.fnick}"  class="pic"></a><a href="${data.profile_url}"  class="icon_bed" target="_blank"><em class="W_icon  ${data.icon}"></em></a></span></p><p class="name W_tc" ><a href="${data.profile_url}" target="_blank" suda-data="key=V6addattenlayer&value=nickname" class="S_txt1">${data.fnick}</a></p><p class="opt" node-type="widget_followBtnBox" action-data="uid=${data.uid}&fnick=${data.fnick}&template=2&nogroup=1&location=afterfollow_v6&refer_sort=similar&refer_lflag=${data.refer_lflag}&refer_flag=${data.refer_flag}"><a href="javascript:;" action-type="follow" suda-data="key=V6addattenlayer&value=follow" class="W_btn_b btn_22px"><em class="W_ficon ficon_add S_ficon">+</em>关注</a></p></div></li></#et>'},o={title:"#L{关注成功}",setGroupTitle:"#L{设置分组}",gEmpty:"#L{分组名不能为空}",rEmpty:"#L{备注名不能为空}",gMaxLen:"#L{请不要超过16个字符}",gDefVal:"#L{新分组}",okLabel:"#L{设置成功}",rDefVal:"#L{设置备注}",message:'#L{为   <span class="W_fb">%s</span>  选择分组}',recommMsg:'#L{<span class="W_fb">%s</span>  的粉丝也关注}',repeat:"#L{此分组名已存在}"},p=!1,q=[],r=!1,s,t,u,v,w,x,y,z,A,B,D=function(a){u.remarkInput.value=d(o.rDefVal);u.groupInput.value=d(o.gDefVal);u.showBtnBox.style.display="";u.addGroupBox.style.display="none";u.loading.style.display="";u.groupList.innerHTML=""},E=function(){},F=function(b,c){var e,f;if(b=="addGroup"){e=d("#L{创建}");f="addGroup"}else{e=d("#L{保存}");f="submit"}if(c=="normal"){a.addClassName(u[b],"btn_noloading");a.removeClassName(u[b],"W_btn_a_disable");u[f].innerHTML=e}else{a.addClassName(u[b],"W_btn_a_disable");a.removeClassName(u[b],"btn_noloading");u[f].innerHTML=d("#L{保存中...}")}},G=function(b){D(b);s=a.parseParam({uid:"",fnick:"",sex:"m",hasRemark:!0,fromFollow:!1,groupList:[],recommend:[],title:d(o.setGroupTitle),successCb:function(){},cancelCb:function(){},extraPostData:{},remark:undefined,refer_lflag:"",refer_flag:""},b);r=s.fromFollow;r&&(s.title=d(o.title));b.tarEl&&(s=a.lib.kit.extra.getDiss(s,b.tarEl));A=s.successCb;B=s.cancelCb;u.uid.value=s.uid;u.remarkInput.value=d(o.rDefVal);if(s.hasRemark){u.remarkInput.removeAttribute("disabled");u.remarkPanel.style.display=""}else{u.remarkInput.setAttribute("disabled","disabled");u.remarkPanel.style.display="none"}s.groupList.length?M(s.groupList):R.request({uid:s.uid});s.recommend.length?N(s.recommend):N([]);u.message.innerHTML=d(o.message,s.fnick);u.recommMsg.innerHTML=d(o.recommMsg,s.fnick);k.setTitle(s.title);k.getDomList().close.setAttribute("suda-uatrack","key=V6addattenlayer&value=shutdown");k.insertElement(u.group_panel,"beforeend");k.insertElement(u.confirmBox,"beforeend");s.fromFollow||(u.remarkPanel.style.display="none");k.show();window.WBEXP&&window.WBEXP.collect({V6addattenlayer:"addatten"})},H=function(b){if(!!b){if(s&&s.fromFollow!=!0)return;var d=parseInt(Math.random()*1e4),e=a.C("img");e.src=c+"?n="+b.allGroup+"_"+b.autoSelect+"&gid="+b.gid.join(",")+"&uid="+b.uid+"&rd="+d;document.body.appendChild(e);setTimeout(function(){e.parentNode.removeChild(e)},3e3)}},I=function(a){var a=a||{};k.hide()},J={defVal:d(o.gDefVal),check:function(b){var c="";b===""||b===this.defVal?c=o.gEmpty:a.core.str.bLength(b)>16&&(c=o.gMaxLen);return d(c)},checkRepeat:function(a){var b="";for(var c=q.length;c--;)if(a===q[c].gname){b=o.repeat;break}return d(b)},showError:function(b){m=a.ui.tipAlert('<span class="txt S_txt1">'+b+"</span>",{autoHide:!1,icon:"rederrorS"}).beside(u.groupInput,{pos:"top-middle"})},hideError:function(){m&&m.hide&&m.hide();m=undefined}},K={defVal:d(o.rDefVal),check:function(b){var c="";b===""?c=o.rEmpty:a.core.str.bLength(b)>16&&(c=o.gMaxLen);return d(c)},showError:function(a){},hideError:function(){}},L=function(b){var c=a.C("li"),d=n.checkBox.replace(/\{value\}/g,b.gid).replace(/\{groupId\}/g,b.gid).replace(/\{name\}/g,b.gname).replace(/\{checked\}/g,b.belong?"checked":"");c.innerHTML=d;return c},M=function(b){var c=b,d=b.recommend,e={data:c,fnick:s.fnick,uid:s.uid,fromFollow:r};t=a.lib.dialog.groupListPanel(e);u.groupList.appendChild(t.getOuter());u.loading.style.display="none";c.length>=20&&(u.addGroupPanel.style.display="none")},N=function(a){i=a;if(!!i){var b=i.length;if(b==0){u.samelist.style.display="none";u.userList.innerHTML="";return}window.WBEXP&&window.WBEXP.collect({V6addattenlayer:"similar"});var c=[];u.samelist.style.display="";u.refreshbtn.style.display=b>j?"":"none";P()}},O=function(a){a.icon="";a.verified?a.verified_type==0?a.icon="icon_pf_approve":a.verified_type>=1&&a.verified_type<=7&&(a.icon="icon_pf_approve_co"):a.verified_type==220&&(a.icon="icon_pf_club")},P=function(){var b,c=[],d=i.length,e=[];for(var f=0;f<d&&f<j;f++){h>=d&&(h=h-d);b=i[h];h++;O(b);b=a.core.json.merge(b,{refer_lflag:s.refer_lflag,refer_flag:s.refer_flag});var g=a.core.util.easyTemplate(n.userlist,b).toString();e.push(b.uid);c.push(g)}u.userList.innerHTML=c.join("");var k="p2p:"+e.join("_")+":"+$CONFIG.uid+":"+s.uid;window.WBEXP&&window.WBEXP.collect({similarhead:k})},Q={errorCd:function(b,c){g=!1;if(b.code=="100096"||b.code=="100097"||b.code=="100098"){var d=a.lib.dialog.vipError(b.code,{info:b.data.html,lbtnFunc:function(){location.href=b.data.gurl}});a.custEvent.add(d,"hide",I)}else a.lib.dialog.ioError(b.code,b);F("submit","normal")},getGroupSuccess:function(a,b){M(a.data);i=a.data.recommend||[];N(i)},setGroupSuccess:function(b,c){g=!1;F("submit","normal");I();A(b,c);a.ui.tip("lite",{msg:d(o.okLabel),type:"succM",timer:"500"})},setGroupError:function(a,b){g=!1;J.showError(a.msg)},addGroupSuccess:function(a,b){F("addGroup","normal");var c=a.data,e;u.addGroupPanel.style.display=c.length>=20?"none":"";for(var f in c)if(c[f].belong===1){e=c[f];break}e&&q.push(e);t.add(e);W.hideAddPanel();u.groupInput.value=d(o.gDefVal);t.length()>=20&&(u.addGroupPanel.style.display="none")}},R=a.conf.trans.setGroup.getTrans("list",{onSuccess:Q.getGroupSuccess,onError:Q.errorCd}),S=function(b){a.conf.trans.setGroup.getTrans("update",{onSuccess:Q.setGroupSuccess,onError:Q.errorCd,onFail:Q.errorCd}).request(C(b))},T=a.conf.trans.setGroup.getTrans("batchSet",{onSuccess:Q.setGroupSuccess,onError:Q.errorCd}),U=function(b){a.conf.trans.setGroup.getTrans("add",{onSuccess:Q.addGroupSuccess,onError:function(b,c){F("addGroup","normal");a.lib.dialog.ioError(b.code,b)}}).request(b)},V=function(b){var c=document.createTextNode(b),d=a.C("div");d.appendChild(c);var e=d.innerHTML;d=c=null;return e},W={showAddPanel:function(){u.showBtnBox.style.display="none";u.addGroupBox.style.display="";u.groupInput.focus()},hideAddPanel:function(){u.showBtnBox.style.display="";u.addGroupBox.style.display="none";J.hideError();u.groupInput.value=J.defVal},addGroup:function(){var b=V(a.trim(u.groupInput.value)),c=J.check(b)||J.checkRepeat(b);if(c)J.showError(c);else{J.hideError();F("addGroup","loading");U({name:b,ispublic:""})}},submit:function(){if(!g){g=!0;var b={};p=!0;b.type="s";var c=t.getData(),e=[],f=u.remarkInput.value;f===d(o.rDefVal)&&(f="");b.remark=f;var h=u.uid.value;b.user=h;b.gid=a.jsonToStr(c);if(c.suda_diss&&s.fromFollow==!0){var i=c.suda_diss.suda,j=c.suda_diss.diss;window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("group_aftermark","save:"+i.join(","))}F("submit","loading");S(b)}},followEnd:function(b){if(b.action=="follow"){var c=b.uid;if(!i)return;var d=i.length;for(var e=d-1;e>=0;e--)if(i[e].uid==c){i.splice(e,1);break}i.length<=j&&(u.refreshbtn.style.display="none");var f=a.sizzle("[uid="+c+"]",u.userList)[0];f&&a.tween(f,{end:function(){if(i.length>=j){var b=h-1;b>=i.length&&(b=0);O(i[b]);f=a.core.json.merge(f,{refer_lflag:s.refer_lflag,refer_flag:s.refer_flag});var c=a.core.util.easyTemplate(n.userlist,i[b]).toString(),d="p2p:"+i[b].uid+":"+$CONFIG.uid+":"+s.uid;window.WBEXP&&window.WBEXP.collect({similarhead:d});a.insertHTML(f,c,"afterend")}a.removeNode(f);f=null},duration:800}).play({opacity:0})}},cancel:function(){p=!1;I()},inputFocus:function(b){return function(c){var c=a.fixEvent(c),d=c.target,e=d.value;b.hideError();e===b.defVal&&(d.value="")}},inputBlur:function(b){return function(c){var c=a.fixEvent(c),d=c.target,e=a.trim(d.value);e||(d.value=b.defVal)}},inputMaxLen:function(c){var c=a.fixEvent(c),d=c.target,e=d.value,f=a.core.str.bLength(e);c.keyCode=="13"?W.submit():f>b&&(d.value=a.core.str.leftB(e,b))}},X=function(){_();Y();Z()},Y=function(){var b=k.getDomList().close;b&&b.setAttribute("suda-uatrack","key=group_aftermark&value=close");a.custEvent.define(f,["hide"]);v=a.core.evt.delegatedEvent(k.getDomList().inner);w=W.inputFocus(J);x=W.inputBlur(J);y=W.inputFocus(K);z=W.inputBlur(K);a.addEvent(u.remarkInput,"focus",y);a.addEvent(u.remarkInput,"blur",z);a.addEvent(u.groupInput,"focus",w);a.addEvent(u.groupInput,"blur",x);a.addEvent(u.remarkInput,"keyup",W.inputMaxLen);a.addEvent(u.groupInput,"keyup",W.inputMaxLen);v.add("showBtn","click",W.showAddPanel);v.add("hideBtn","click",W.hideAddPanel);v.add("addGroup","click",W.addGroup);v.add("submit","click",W.submit);v.add("cancel","click",W.cancel);v.add("refresh","click",P);a.conf.channel.follow.register("changeStatus",W.followEnd)},Z=function(){a.custEvent.add(k,"hide",function(){a.custEvent.fire(f,["hide"]);p||B();var b=t.getData();b&&b.suda_diss&&H(b.suda_diss.diss);J.hideError()})},_=function(){var b=a.core.dom.builder(d(n.groupBox));u=a.lib.kit.dom.parseDOM(b.list)},ba=function(){a.custEvent.undefine(f,["hide"]);a.removeEvent(u.remarkInput,"focus",y);a.removeEvent(u.remarkInput,"blur",z);a.removeEvent(u.groupInput,"focus",w);a.removeEvent(u.groupInput,"blur",x);a.removeEvent(u.remarkInput,"keyup",W.inputMaxLen);a.removeEvent(u.groupInput,"keyup",W.inputMaxLen);a.conf.channel.follow.remove("changeStatus",W.followEnd);w=null;x=null;y=null;z=null;v&&v.destroy();recommend&&recommend.destroy()};X();f.show=G;f.hide=I;f.destroy=ba;return f}});
STK.register("lib.publisher.source.follow",function(a){var b=a.lib.dialog.setGroup,c=a.lib.kit.extra.language,d=c('<#et contentTxt data><p class="S_txt1">#L{关注}@<a href="${data.profile_url}" title="${data.fnick}">${data.fnick}</a>#L{及时获取定时微博状态}</p></#et>');return function(c){c.face_img&&(c.face_img=decodeURIComponent(c.face_img));c.profile_url&&(c.profile_url=decodeURIComponent(c.profile_url));c=a.parseParam({cookieName:"WB_followHelper_"+$CONFIG.uid,followOpts:null,uid:"3941354960",fnick:"定时微博小助手",oid:window.$CONFIG&&window.$CONFIG.oid||"",refer_flag:"1005050001_",refer_from:"",location:"",wforce:"",face_img:"",profile_url:"",nogroup:0,title:"关注官方微博",icon:"questionB",content:""},c);c.face_img&&c.fnick&&(c.icon='<img src="'+c.face_img+'" alt="'+c.fnick+'" width="50" height="50" class="W_face_radius">');var e,f,g,h,i,j;g={follow:function(){var d=a.parseParam({uid:"",fnick:"",oid:"",refer_flag:"",refer_from:"",location:"",nogroup:""},c);d.onSuccessCb=function(a){a.groupList=a.group;a.fromFollow=!0;if(!a.nogroup){e||(e=b());setTimeout(function(){e.show(a)},700)}};d.onFailCb=function(a){};d.onRelease=function(){};setTimeout(function(){$follow.follow(d)},0)},showConfirm:function(){var b=c.content||a.core.util.easyTemplate(d,c).toString(),e=function(){a.cookie.set(c.cookieName,"1",{expire:168})};a.ui.confirm(b,{title:c.title||"",icon:c.icon||"",OK:g.follow,cancel:e})},destroy:function(){e&&e.destroy&&e.destroy()}};f=function(){j={};$follow=a.lib.follow.utils.follow(c.followOpts)};h=function(){};i=function(){f();h()};i();j.showConfirm=g.showConfirm;j.follow=g.follow;j.destroy=g.destroy;return j}});
STK.register("lib.publisher.publisher2",function(a){var b=a.lib.kit.extra.language,c=a.lib.publisher.widget.widgetloader;return function(d){function W(){g&&g.submit&&a.removeEvent(g.submit,"click",x);g&&g.textEl&&a.lib.kit.extra.keySubmit.off(g.textEl,x);i&&a.custEvent.remove(i,"textNum",A);i&&a.custEvent.remove(i,"blur",D);i&&a.custEvent.remove(i,"focus",E);if(g.feedconfig){a.removeEvent(g.feedconfig,"click",K);a.removeEvent(document.body,"click",L)}m&&a.custEvent.remove(m,"changeRank",N);a.custEvent.undefine(u,"publish");l&&l.destroy&&l.destroy();m&&m.destroy&&m.destroy();n&&n.destroy&&n.destroy();g=null;j=null;f=!1;for(var b in e)delete e[b];e=null;k&&k.destroy&&k.destroy()}function T(a){i.API.disableEditor(a)}function S(a){i.API.addExtraInfo(a)}function R(){m&&m.reset&&m.reset();m&&m.hide&&m.hide();n&&n.close&&n.close()}function Q(){I();M();O();P();try{G(p)}catch(a){}try{n=c(i,p)}catch(a){}}function P(){o&&o.get("api")&&o.get("api")!=="ABSENT"&&(p.transName="proxy");j=p.trans.getTrans(p.transName,{onComplete:function(b,c){l.validateIntercept(b,c,{onSuccess:B,onError:C,onFail:C,requestAjax:j,param:y(),onRelease:function(){f=!1;g.textEl.removeAttribute("readonly");g.submit&&a.core.dom.removeClassName(g.submit,"W_btn_a_disable");m&&m.enable()}})},onFail:C,onTimeout:C})}function O(){a.custEvent.add(i,"textNum",A);m&&a.custEvent.add(m,"changeRank",N)}function N(){m&&m.miYouStyle.apply(null,arguments)}function M(){a.addEvent(g.submit,"click",x);a.lib.kit.extra.keySubmit.on(g.textEl,x);a.custEvent.add(i,"blur",D);a.custEvent.add(i,"focus",E);if(g.feedconfig){a.addEvent(g.feedconfig,"click",K);a.addEvent(document.body,"click",L)}}function L(b){if(!!g&&!!g.feedconfig){var c=a.fixEvent(b).target;a.core.dom.hasClassName(g.feedconfig,"send_weibo_simple")&&!a.core.dom.hasClassName(g.feedconfig,J)&&c!==g.feedconfig&&(a.core.dom.hasClassName(c,"WB_miniblog_fb")||a.core.dom.hasClassName(c,"WB_frame_c"))&&a.addClassName(g.feedconfig,J)}}function K(b){function c(){if(a.core.dom.hasClassName(g.feedconfig,"send_weibo_simple")&&a.core.dom.hasClassName(g.feedconfig,"send_weibo_simple_remark_fold")){a.removeClassName(g.feedconfig,"send_weibo_simple_remark_fold");J="send_weibo_simple_remark_fold"}if(a.core.dom.hasClassName(g.feedconfig,"send_weibo_simple")&&a.core.dom.hasClassName(g.feedconfig,"send_weibo_simple_fold")){a.removeClassName(g.feedconfig,"send_weibo_simple_fold");J="send_weibo_simple_fold"}}if(!!g&&!!g.feedconfig){var d=g.textEl.getAttribute("check_url");if(d){var e=d.split("?");e=a.core.json.merge({api:e[0]},a.queryToJson(e[1]||""));p.trans.request("proxy",{onSuccess:function(){c();g.textEl.removeAttribute("check_url")},onError:function(b){g.textEl.blur();a.lib.dialog.ioError(b.code,b)},onFail:function(b){g.textEl.blur();a.lib.dialog.ioError(b.code,b)}},e)}else c()}}function I(){h=a.lib.editor.base(p.node,{limitNum:Infinity,extendText:""});i=h.editor;g=i.nodeList;var b=a.sizzle(".send_weibo",p.node)[0]||p.node;g.wrap=g.wrap||b;a.addClassName(b,"send_weibo_long");var c=a.sizzle(".func_area",b)[0];c&&c.setAttribute("layout-shell","true");p.tid&&g.textEl.setAttribute("tid",p.tid);p.timer&&g.textEl.setAttribute("timer",p.timer);a.core.util.browser.IE8&&(g.textEl.style.width=g.textEl.offsetWidth+"px");a.lib.kit.dom.autoHeightTextArea({textArea:g.textEl,maxHeight:360});p.dialog==="true"&&g.textEl.setAttribute("phototag","false");o=a.lib.publisher.source.formdata(g.extradata);try{H(g.textEl)}catch(d){}g.wrap&&(m=a.lib.publisher.source.publishTo({editor:i,editorWrapEl:g.wrap,textEl:g.textEl}));l=a.lib.dialog.validateCode();var e;w&&(e=w.read())?setTimeout(function(){if(a.trim(g.textEl.value).length===0||g.textEl.defaultValue&&g.textEl.value===g.textEl.defaultValue){g.textEl.value="";i.API.insertText(e||"");g.textEl.focus()}q=!1}):q=!1}function H(b){var c=a.core.dom.textSelectArea(b),d=c.start||b.value.length,e=c.len||0,f=d+"&"+e;b.setAttribute("range",f)}function G(b){b=a.parseParam({appkey:"",content:"",info:"",pid:"",extraSend:{},tid:"",preType:"weibo",timer:!1},b);p.extraSend=b.extraSend;p.extraSend.location=p.extraSend.location||$CONFIG.location||"";p.pid=b.pid;if(!!a.contains(document.body,g.textEl)){g.textEl.defaultValue&&g.textEl.defaultValue.length&&g.textEl.value!=g.textEl.defaultValue&&(g.textEl.value=g.textEl.defaultValue);p.tid&&g.textEl.setAttribute("tid",p.tid);p.timer&&g.textEl.setAttribute("timer",p.timer);b.content&&(g.textEl.value=b.content);g.info&&(g.info.innerHTML=b.info);b.appkey&&(p.appkey=b.appkey);A();n&&n.close&&n.close()}}function C(c,d){f=!1;g.textEl.removeAttribute("readonly");c.msg=c.msg||b("操作失败");a.lib.dialog.ioError(c.code,c);A();m&&m.enable()}function B(c,d){c.data.feedtype=="timefeed"&&c.data.followHelper&&(k=a.lib.publisher.source.follow(a.strToJson(c.data.followHelper)));i.API.blur();q=!1;g.successTip.style.display="";g.textEl.value="";var e=a.sizzle(".W_icon",g.successTip)[0],h=a.sizzle(".txt",g.successTip)[0];c.data.feedtype=="timefeed"&&window.$CONFIG&&window.$CONFIG.timeweibo=="1"?h.innerText=b("#L{定时成功}"):d.video_fid?h.innerText=d.video_monitor=="1"?b("#L{视频将在审核通过后自动发出，实名认证后可快速审核}"):b("#L{视频将在转码完成后自动发出}"):h.innerText=b("#L{发布成功}");h.style.display="none";a.ui.effect(e,"flipInY","normal");setTimeout(function(){h.style.display="";a.ui.effect(h,"fadeInRight","normal")},50);setTimeout(function(){!g||g.successTip&&a.ui.effect(g.successTip,"fadeOut","fast",function(){g.successTip.style.display="none";f=!1;g.textEl.removeAttribute("readonly");A();g.textEl.focus()})},2e3);a.custEvent.fire(u,"publish",[c.data,d]);a.custEvent.fire(u,"share");setTimeout(function(){if(c.data.feedtype=="timefeed"){a.conf.channel.feed.fire(d.tid?"timeFeedEdit":"timeFeedPublish",[c.data,d]);c.data.followHelper&&!d.tid&&a.cookie.get("WB_followHelper_"+$CONFIG.uid)!=1&&k&&k.showConfirm()}else a.conf.channel.feed.fire(d.tid?"timeFeedEdit":"publish",[c.data,d])},1500);A();F(c,d);m&&m.reset&&m.reset();w&&w.del();n&&n.close&&n.close();i.nodeList.textEl&&i.nodeList.textEl.getAttribute("tags")&&i.nodeList.textEl.removeAttribute("tags");i.nodeList.textEl&&i.nodeList.textEl.getAttribute("taginfos")&&i.nodeList.textEl.removeAttribute("taginfos")}function A(c,d){function e(a){if(o){var b=o.get(a);return b==="ABSENT"?"":b||""}return""}w&&w.write(a.core.str.trim(g.textEl.value)?g.textEl.value:"");var h=e("extraurl"),j=e("prefixtext"),k=parseFloat(e("score")),l=d?d.count:i.API.count(),m=a.lib.editor.count(h+j),n=p.maxLength-m,u=i.nodeList.textEl.getAttribute("data-video-status");u&&(n-=11);var x=Math.min(140-m,n);l===0?f="TEXT_EMPTY":l>n?f="TEXT_OVERFLOW":k===0?f="SCORE_EMPTY":u&&u!="ready"?f="VIDEO_NOT_READY":f=!1;f?a.core.dom.addClassName(g.submit,"W_btn_a_disable"):a.core.dom.removeClassName(g.submit,"W_btn_a_disable");if(l<=0)if(r&&document.activeElement===g.textEl){g.num.innerHTML=b("#L{可以发布超过%s字的微博啦}",v("140","S_spetxt"));a.cookie.set(s,1,{expire:t})}else g.num.innerHTML="";else l<x?g.num.innerHTML=b("#L{已输入%s字}",v(l)):l<=n?g.num.innerHTML=b("#L{已输入%s字}",v(l,"S_spetxt")):g.num.innerHTML=b("#L{已超出%s字}",v(l-n,"S_error"));if(!f&&!q&&z<x&&l>=x){q=!0;a.ui.effect(g.submit,"shake","fast")}z=l}function y(){var b={};b=a.core.json.merge(b,p.extraSend);b.text=i.API.getWords();b.appkey=p.appkey;b.style_type=p.styleId;b.pic_id=p.pid;b.tid=p.tid;b.pdetail=$CONFIG.page_id;b.mid=p.mid;b.isReEdit=p.isReEdit;var c=i.API.getExtra();if(c)if(c.indexOf("=")<0)b.pic_id=i.API.getExtra()||"";else{var d=c,e=a.core.json.queryToJson(d);for(var f in e)b[f]=e[f]}if(m&&m.rank){var h=m.rank();b.rank=h.rank;b.rankid=h.rankid;h.rankid&&h.text&&(b.pubToTxt=h.text)}g.transferkey&&a.foreach([].concat(g.transferkey),function(a){var c=a.value;a.getAttribute("type")==="checkbox"&&(c=a.checked?1:0);b[a.getAttribute("name")]=c});if(i.nodeList.textEl&&i.nodeList.textEl.getAttribute("settime")){b.addtime=i.nodeList.textEl.getAttribute("settime");b.module="autopub"}$CONFIG.bpType==="page"&&(i.nodeList.textEl&&i.nodeList.textEl.getAttribute("settime")?b.addtime=i.nodeList.textEl.getAttribute("settime"):g.settime_data&&(b.addtime=g.settime_data.value+" "+g.settime_hour.value+":"+g.settime_min.value));i.nodeList.textEl&&i.nodeList.textEl.getAttribute("tags")&&(b.photo_tag=i.nodeList.textEl.getAttribute("tags"));i.nodeList.textEl&&i.nodeList.textEl.getAttribute("taginfos")&&(b.photo_taginfo=i.nodeList.textEl.getAttribute("taginfos"));return b}function x(){var b=g.textEl;if(f){f.indexOf("TEXT_")===0&&a.lib.publisher.source.shine(b);g.scorecontrol&&f.indexOf("SCORE_")===0&&a.lib.publisher.source.scoreshine(g.scorecontrol,g.score_title)}else{f="LOADING";b.setAttribute("readonly","readonly");var c=a.lib.kit.extra.getDiss(y(),g.submit);c=a.lib.kit.extra.merge(c,a.queryToJson(g.submit.getAttribute("action-data")||""));o&&(c=a.lib.kit.extra.merge(c,o.read()));if(b&&b.getAttribute&&parseInt(b.getAttribute("pic_split"))==1&&b.getAttribute("data-multiimage-status")){var d=a.sizzle("[special-node=weibo_pic_preList_ul]",g.outer);if(d){var e=a.sizzle("li.pic",d[0]),h=e.length;if(h){c.updata_img_num=h;c.pic_id="";for(var i in e){var k=e[i].getAttribute("action-data");if(k){c.pic_id&&(c.pic_id+="|");c.pic_id+=k}}}}}var l=a.sizzle('[node-type="multiimage"]');if(l&&l[0]){tagPids=a.queryToJson(l[0].getAttribute("action-data")).pic_id;c.pic_id=tagPids==c.pic_id?tagPids:c.pic_id}c.txtExLink&&(c.text=c.text+c.txtExLink);c.pub_type="dialog";m&&m.disable();var n=function(b){j.request(b);if(g.followpresenter&&g.followpresenter.checked==!0){var c=a.queryToJson(g.followpresenter.getAttribute("action-data")||"");p.trans.getTrans("follow",{}).request(c)}};p.asyncBeforePublish?p.asyncBeforePublish(c,{success:function(a){n(a)},fail:function(){g.submit&&a.core.dom.removeClassName(g.submit,"W_btn_a_disable");b.removeAttribute("readonly");m&&m.enable();f=!1}}):n(c)}}function v(a,b){b=b?' class="'+b+'"':"";return"<span"+b+">"+a+"</span>"}var e={},f,g,h,i,j,k,l,m,n,o,p=a.parseParam({trans:a.conf.trans.publisher,transName:"publish",node:null,styleId:"1",maxLength:d.text_max_len?d.text_max_len:2e3,appkey:"",pid:"",mid:"",info:"",content:"",extraUrl:"",extraSend:{},dialog:!1,storage:$CONFIG.bpType==="main"?!0:!1,asyncBeforePublish:undefined,tid:"",preType:"weibo",timer:!1,isPri:0,isReEdit:!1},d),q=!0,r=!1,s="wb_publish_fist100_"+$CONFIG.uid,t=720;a.cookie.get(s)||(r=!1);p.extraSend.location=p.extraSend.location||$CONFIG.location||"";var u=a.custEvent.define(e,["publish","share"]),w=p.storage===!1?null:function(b){return{write:function(c){try{a.core.util.storage.set(b,c)}catch(d){}},read:function(){var a=STK.core.util.storage.get(b);return a!="null"&&a!=null&&a.length!=0?a:null},del:function(){a.core.util.storage.del(b)}}}("publisher_"+$CONFIG.uid),z=0,D=function(){a.removeClassName(g.textEl.parentNode,"clicked");if(/^\s+$/.test(g.textEl.value)){g.textEl.value="";a.fireEvent(g.textEl,"blur")}},E=function(){a.addClassName(g.textEl.parentNode,"clicked")},F=function(b,c){if(!!c.isReEdit||!!b.data.html){var d=a.sizzle('[mid="'+c.mid+'"]'),e=a.sizzle('[node-type="feed_content"]',d[0]);d[0]&&e[0]&&a.replaceNode(a.builder(b.data.html).list.feed_content[0],e[0])}},J="",U=[" #明星制片人微计划# "," #明星VLOG# "," #idoltube# "],V=function(a){var b=g.textEl.value,c="",d="";for(var e=0;e<a.length;e++)c+=" #"+a[e]+"# ";for(var f=0;f<U.length;f++)b=b.split(U[f]).join("");d=[c.slice(),b.slice()].join("");g.textEl.value=d};a.conf.channel.feed.register("addAlbumToTextEl",V);Q();e.publishTo=m;e.close=R;e.editor=i;e.rend=G;e.unrend=function(){f=!1};e.addExtraInfo=S;e.disableEditor=T;e.destroy=W;return e}});
STK.register("lib.publisher.publisher",function(a){var b={title:"#L{有什么新鲜事想告诉大家}"},c=a.lib.kit.extra.language,d="#在这里输入你想要说的话题#";return function(b){function u(){var c,d=a.sizzle("[node-type=top_all]"),e=null,f=a.sizzle("[name=longtext]",b.node)[0];if(d.length==1){var g=d[0].getAttribute("action-data");e=g?a.queryToJson(g):null}var h=e&&"text_max_len"in e?parseInt(e.text_max_len):2e3;if(f&&f.value){h=parseInt(f.value)?2e3:140;c="1"}else e&&"publish2000"in e?c=e.publish2000:"publish2000"in $CONFIG?c=$CONFIG.publish2000:c="1";b.text_max_len=h;return c}if(u()=="1")return a.lib.publisher.publisher2(b);var d=a.lib.publisher.widget.widgetloader,e={limitNum:140,extendText:""},f=140,g={},h,i=!0,j,k,l,m,n,o,p,q,r,s;h=a.parseParam({trans:a.conf.trans.publisher,transName:"publish",node:null,styleId:"1",appkey:"",pid:"",info:"",content:"",extraUrl:"",extraSend:{}},b);var t;h.extraSend.location=h.extraSend.location||$CONFIG.location||"";o=a.custEvent.define(g,["publish","share"]);var v=function(){var b=k.textEl;if(i){j==="error"&&a.lib.publisher.source.shine(b);t&&t.get("score")==0&&k.scorecontrol&&a.lib.publisher.source.scoreshine(k.scorecontrol,k.score_title)}else{if(a.hasClassName(k.submit,"W_btn_a_disable"))return;i=!0;j="loading";var c=a.lib.kit.extra.getDiss(w(),k.submit);c=a.lib.kit.extra.merge(c,a.queryToJson(k.submit.getAttribute("action-data")||""));t&&(c=a.lib.kit.extra.merge(c,t.read()));if(b&&b.getAttribute&&parseInt(b.getAttribute("pic_split"))==1&&b.getAttribute("data-multiimage-status")){var d=a.sizzle("[special-node=weibo_pic_preList_ul]",k.outer);if(d){var e=a.sizzle("li.pic",d[0]),f=e.length;if(f){c.updata_img_num=f;c.pic_id="";for(var g in e){var l=e[g].getAttribute("action-data");if(l){c.pic_id&&(c.pic_id+="|");c.pic_id+=l}}}}}c.pub_type="dialog";r&&r.disable();n.request(c);if(k.followpresenter&&k.followpresenter.checked==!0){var m=a.queryToJson(k.followpresenter.getAttribute("action-data")||"");h.trans.getTrans("follow",{}).request(m)}}},w=function(){var b=m.API.getWords();p&&b.indexOf(p)===-1&&(b=b+p);var c={};c=a.core.json.merge(c,h.extraSend);c.appkey=h.appkey;c.style_type=h.styleId;c.pic_id=h.pid;c.text=b;c.pdetail=$CONFIG.page_id;c.location=$CONFIG.location;var d=m.API.getExtra();if(d)if(d.indexOf("=")<0)c.pic_id=m.API.getExtra()||"";else{var e=d,f=a.core.json.queryToJson(e);for(var g in f)c[g]=f[g]}if(r&&r.rank){var i=r.rank();c.rank=i.rank;c.rankid=i.rankid}k.transferkey&&a.foreach([].concat(k.transferkey),function(a){var b=a.value;a.getAttribute("type")==="checkbox"&&(b=a.checked?1:0);c[a.getAttribute("name")]=b});k.settime_data&&(c.addtime=k.settime_data.value+" "+k.settime_hour.value+":"+k.settime_min.value);m.nodeList.textEl&&m.nodeList.textEl.getAttribute("tags")&&(c.photo_tag=m.nodeList.textEl.getAttribute("tags"));m.nodeList.textEl&&m.nodeList.textEl.getAttribute("taginfos")&&(c.photo_taginfo=m.nodeList.textEl.getAttribute("taginfos"));return c},x=function(a){if((a.keyCode===13||a.keyCode===10)&&a.ctrlKey){v();m.API.blur()}},y=function(b,d){var e=t&&t.get("prefixtext")||"";e==="ABSENT"&&(e="");var g=t&&t.get("extraurl")||"";g==="ABSENT"&&(g="");var h=f-a.lib.publisher.widget.count(e)-a.lib.publisher.widget.count(g),l=m.nodeList.textEl.getAttribute("data-video-status");l&&(h-=11);var n=h-d.count,o=n<0,p="#L{还可以输入%s字}",q="#L{已超出%s字}",r=o?q:p,s=o?'<span class="S_error">'+Math.abs(n)+"</span>":"<span>"+Math.abs(n)+"</span>";k.num.innerHTML=c(r,s);i=!1;j=undefined;if(d.count<=0){i=!0;j="TEXTEMPTY"}if(o){i=!0;j="TEXTOVER"}if(t&&t.get("score")!=="ABSENT"&&t.get("score")==0){i=!0;j="NOSCORE"}if(l&&l!="ready"){i=!0;j="VIDEO_NOT_READY"}i?a.core.dom.addClassName(k.submit,"W_btn_a_disable"):a.core.dom.removeClassName(k.submit,"W_btn_a_disable")},z=function(b,d){m.API.blur();j="";k.successTip.style.display="";k.textEl.value="";var f=a.sizzle(".W_icon",k.successTip)[0],g=a.sizzle(".txt",k.successTip)[0];d.video_fid?g.innerText=d.video_monitor=="1"?c("#L{视频将在审核通过后自动发出，实名认证后可快速审核}"):c("#L{视频将在转码完成后自动发出}"):g.innerText=c("#L{发布成功}");g.style.display="none";a.ui.effect(f,"flipInY","normal");setTimeout(function(){g.style.display="";a.ui.effect(g,"fadeInRight","normal")},50);B();setTimeout(function(){i=!1;a.ui.effect(k.successTip,"fadeOut","fast",function(){k.successTip.style.display="none"});var b=m.API.count();b>0?a.core.dom.removeClassName(k.submit,"W_btn_a_disable"):k.submit&&a.core.dom.addClassName(k.submit,"W_btn_a_disable");k.num.innerHTML=(e.extendText?c(e.extendText):"")+c("#L{还可以输入%s字}","<span>"+(e.limitNum-b)+"</span>")},2e3);a.custEvent.fire(o,"publish",[b.data,d]);a.custEvent.fire(o,"share");setTimeout(function(){b.data.feedtype=="timefeed"?a.conf.channel.feed.fire("timeFeedPublish",[b.data.html,d]):a.conf.channel.feed.fire("publish",[b.data,d])},1500);a.core.dom.addClassName(k.submit,"W_btn_a_disable");r&&r.reset&&r.reset();s&&s.close&&s.close();m.nodeList.textEl&&m.nodeList.textEl.getAttribute("tags")&&m.nodeList.textEl.removeAttribute("tags");if(m.nodeList.textEl&&m.nodeList.textEl.getAttribute("withdraft")=="true"){m.nodeList.textEl.removeAttribute("withdraft");a.conf.trans.rteditor.getTrans("cleandraft",{}).request()}},A=function(b,d){i=!1;j="";b.msg=b.msg||c("操作失败");a.lib.dialog.ioError(b.code,b);k.submit&&a.core.dom.removeClassName(k.submit,"W_btn_a_disable");r&&r.enable()},B=function(){k.num.style.display="block"},C=function(){k.num.style.display="block"},D=function(){a.removeClassName(k.textEl.parentNode,"clicked")},E=function(){a.addClassName(k.textEl.parentNode,"clicked")},F=function(b){var b=a.parseParam({appkey:"",content:"",info:"",pid:"",extraSend:{}},b);h.extraSend=b.extraSend;h.extraSend.location=h.extraSend.location||$CONFIG.location||"";h.pid=b.pid;if(!!a.contains(document.body,k.textEl)){k.textEl.defaultValue&&(k.textEl.value=k.textEl.defaultValue);b.content&&(k.textEl.value=b.content);k.textEl.setAttribute("content",b.content);k.info&&(k.info.innerHTML=b.info);b.appkey&&(h.appkey=b.appkey);var d=m.API.count();if(d>0){i=!1;j="";a.core.dom.removeClassName(k.submit,"W_btn_a_disable")}else{i=!0;j="error";a.core.dom.addClassName(k.submit,"W_btn_a_disable")}if(t&&t.get("score")!=="ABSENT"&&t.get("score")==0){i=!0;a.core.dom.addClassName(k.submit,"W_btn_a_disable")}k.num.innerHTML=(e.extendText?c(e.extendText):"")+c("#L{还可以输入%s字}","<span>"+(e.limitNum-d)+"</span>");s&&s.close&&s.close()}},G=function(){i=!1},H=function(b){var c=a.core.dom.textSelectArea(b),d=c.start||b.value.length,e=c.len||0,f=d+"&"+e;b.setAttribute("range",f)},I=function(){l=a.lib.editor.base(h.node,e);m=l.editor;k=m.nodeList;t=a.lib.publisher.source.formdata(k.extradata);var b=t&&t.get("extraurl")||"";b==="ABSENT"&&(b="");var c=t&&t.get("prefixtext")||"";c==="ABSENT"&&(c="");e.limitNum=e.limitNum-a.lib.publisher.widget.count(b+c);try{H(k.textEl)}catch(d){}k.wrap&&(r=a.lib.publisher.source.publishTo({editorWrapEl:k.wrap,textEl:k.textEl}));q=a.lib.dialog.validateCode()},J="",K=function(b){function c(){if(a.core.dom.hasClassName(k.feedconfig,"send_weibo_simple")&&a.core.dom.hasClassName(k.feedconfig,"send_weibo_simple_remark_fold")){a.removeClassName(k.feedconfig,"send_weibo_simple_remark_fold");J="send_weibo_simple_remark_fold"}if(a.core.dom.hasClassName(k.feedconfig,"send_weibo_simple")&&a.core.dom.hasClassName(k.feedconfig,"send_weibo_simple_fold")){a.removeClassName(k.feedconfig,"send_weibo_simple_fold");J="send_weibo_simple_fold"}}if(!!k&&!!k.feedconfig){var d=k.textEl.getAttribute("check_url");if(d){var e=d.split("?");e=a.core.json.merge({api:e[0]},a.queryToJson(e[1]||""));h.trans.request("proxy",{onSuccess:function(){c();k.textEl.removeAttribute("check_url")},onError:function(b){k.textEl.blur();a.lib.dialog.ioError(b.code,b)},onFail:function(b){k.textEl.blur();a.lib.dialog.ioError(b.code,b)}},e)}else c()}},L=function(b){if(!!k&&!!k.feedconfig){var b=a.fixEvent(b),c=b.target;a.core.dom.hasClassName(k.feedconfig,"send_weibo_simple")&&!a.core.dom.hasClassName(k.feedconfig,J)&&c!==k.feedconfig&&(a.core.dom.hasClassName(c,"WB_miniblog_fb")||a.core.dom.hasClassName(c,"WB_frame_c")||a.core.dom.hasClassName(c,"WB_main"))&&a.addClassName(k.feedconfig,J)}},M=function(){a.addEvent(k.submit,"click",v);a.lib.kit.extra.keySubmit.on(k.textEl,v);a.custEvent.add(m,"blur",D);a.custEvent.add(m,"focus",E);a.addEvent(k.feedconfig,"click",K);a.addEvent(document.body,"click",L)},N=function(){r&&r.miYouStyle.apply(null,arguments)},O=function(){a.custEvent.add(m,"textNum",y);r&&a.custEvent.add(r,"changeRank",N)},P=function(){t&&t.get("api")&&t.get("api")!=="ABSENT"&&(h.transName="proxy");n=h.trans.getTrans(h.transName,{onComplete:function(b,c){var d={onSuccess:z,onError:A,requestAjax:n,param:w(),onRelease:function(){i=!1;j="";k.submit&&a.core.dom.removeClassName(k.submit,"W_btn_a_disable");r&&r.enable()}};q.validateIntercept(b,c,d)},onFail:A,onTimeout:A})},Q=function(){I();M();O();P();try{F(h)}catch(a){}try{s=d(m)}catch(a){}},R=function(){r&&r.reset&&r.reset();r&&r.hide&&r.hide();s&&s.close&&s.close()},S=function(a){m.API.addExtraInfo(a)},T=function(a){m.API.disableEditor(a)},U=function(){k&&k.submit&&a.removeEvent(k.submit,"click",v);k&&k.textEl&&a.lib.kit.extra.keySubmit.off(k.textEl,v);a.custEvent.remove(m,"textNum",y);a.custEvent.remove(m,"blur",D);a.custEvent.remove(m,"focus",E);a.removeEvent(k.feedconfig,"click",K);a.removeEvent(document.body,"click",L);r&&a.custEvent.remove(r,"changeRank",N);a.custEvent.undefine(o,"publish");q&&q.destroy&&q.destroy();r&&r.destroy&&r.destroy();s&&s.destroy&&s.destroy();k=null;n=null;i=!1;for(var b in g)delete g[b];g=null;l&&l.destroy&&l.destroy()};Q();g.publishTo=r;g.close=R;g.editor=m;g.rend=F;g.unrend=G;g.addExtraInfo=S;g.disableEditor=T;g.destroy=U;return g}});
STK.register("lib.publisher.publisherDialog",function(a){var b='<#et temp data><div class="detail" node-type="outer"><div class="send_weibo clearfix" node-type="wrap"><div class="title_area clearfix"><div class="title" node-type="info"></div><div class="num S_txt2" node-type="num">#L{还可以输入}<span>140</span>#L{字}</div><div class="key S_textb"></div></div><div class="input "><textarea placeholder="" class="W_input" name="" node-type="textEl" range="26&amp;0"></textarea><div class="send_succpic" style="display:none" node-type="successTip"><span class="W_icon icon_succB"></span><span class="txt">发布成功</span></div><form style="display:none;" node-type="extradata"></form></div><div class="func_area clearfix"><div class="func"><#if (data.publishTo)><div class="limits"><a href="javascript:void(0);" class="S_txt1" node-type="showPublishTo" action-type="showPublishTo" action-data="rank=0"><span node-type="publishTotext" class="W_autocut">#L{所有人可见}</span><em class="W_ficon ficon_arrow_down S_ficon" node-type="publish_to_arrow">c</em></a></div></#if><a href="javascript:void(0)" class="W_btn_a btn_30px" node-type="submit">#L{发布}</a></div><div class="kind" node-type="widget"><#if (data.face)><a href="javascript:void(0);" class="S_txt1" action-type="face" action-data="type=500&amp;action=1&amp;log=face&amp;cate=1" title="#L{表情}" node-type="smileyBtn" suda-uatrack="key=tblog_home_edit&amp;value=phiz_button"><em class="W_ficon ficon_face">o</em></a></#if><#if (data.image)><a href="javascript:void(0);" class="S_txt1" action-type="multiimage" node-type="multiimage" action-data="type=508&amp;action=1&amp;log=image&amp;cate=1" title="#L{图片}" suda-uatrack="key=tblog_new_image_upload&amp;value=image_button"><em class="W_ficon ficon_image">p</em></a></#if><#if (data.video)><a href="javascript:void(0);" class="S_txt1" action-type="video" action-data="type=502&amp;action=1&amp;log=video&amp;cate=1" title="#L{视频}" suda-uatrack="key=tblog_home_edit&amp;value=video_button"><em class="W_ficon ficon_video">q</em></a></#if><#if (data.topic)><a href="javascript:void(0);" class="S_txt1" action-type="topic" action-data="type=504&amp;action=1&amp;log=topic&amp;cate=1" title="#L{话题}" suda-uatrack="key=tblog_home_edit&amp;value=topic_button"><em class="W_ficon ficon_swtopic">"</em></a></#if></div></div></div></div></#et>',c={title:"#L{有什么新鲜事想告诉大家?}"},d=a.lib.kit.extra.language,e=a.lib.publisher.publisher,f=a.core.util.easyTemplate,g=window.$CONFIG||{},h={limitNum:140,extendText:'<a target="_blank" class="S_txt2" href="http://weibo.com/z/guize/gongyue.html">#L{发言请遵守社区公约}</a>，'};return function(i){var j={},k,l;conf=a.parseParam({trans:a.conf.trans.publisher,transName:g.page_id?"publish_page":"publish_v6",template:d(b),appkey:"",styleId:"1",publishTo:!0,face:!0,image:!0,video:!1,topic:!1,storage:!1,pid:"",mid:"",content:"",info:"",title:d(c.title),extraUrl:"",extraSend:{},html:null,tid:"",preType:"weibo",isPri:0,isReEdit:!1},i);conf.extraSend.location=conf.extraSend.location||g.location||"";var m=f(d(conf.template),conf).toString();conf.html&&(m=conf.html);conf.editorOpts=h;a.custEvent.define(j,["show","hide","publishShare"]);var n=function(b){var e=a.parseParam({appkey:"",content:"",info:"",pid:"",title:d(c.title),extraSend:{},tid:"",preType:"weibo"},b);e.extraSend.location=e.extraSend.location||g.location||"";l.setTitle(e.title);l.show();a.custEvent.add(l,"hidden",r);k.rend(e);k.editor.API.focus();a.custEvent.fire(j,"show")},o=function(){setTimeout(r,1500)},p=function(b,c,d){a.custEvent.fire(j,"publishShare",[c,d])},q=function(){a.custEvent.add(k,"publish",o);a.custEvent.add(k,"publish",p)},r=function(){a.custEvent.remove(l,"hidden",r);k.close();l.hide();a.custEvent.fire(j,"hide")},s=function(){k&&o&&a.custEvent.remove(k,"publish",o);k&&k.destroy&&k.destroy();l&&l.destroy&&l.destroy()},t=function(){if(!l){l=a.ui.dialog();l.setContent(m)}conf.node=l.getBox();k=e(conf);a.custEvent.hook(k,j,{publish:"publish",hide:"hide"});q();n(conf);l.on("hide",function(){k.destroy();a.custEvent.fire(j,"hide")})};t();j.dialog=l;j.publishTo=k.publishTo;j.editor=k.editor;j.addExtraInfo=k.addExtraInfo;j.disableEditor=k.disableEditor;j.show=n;j.hide=r;j.destroy=s;return j}});
STK.register("lib.image.livephoto",function(a){var b=a.C("video"),c=navigator.userAgent.indexOf("Safari")>=0,d=c&&!!b.canPlayType&&!!b.canPlayType("video/mp4");b=null;return function(b,c,e){function i(){b.style.visibility="";f.style.visibility="hidden";if(f){e&&e.end&&e.end(f);a.removeEvent(f,"canplay",h);a.removeEvent(f,"ended",i);a.removeEvent(f,"error",i);clearTimeout(g);f.pause();a.removeNode(f);f.src=null}f=null}function h(){if(b&&a.contains(document.body,b)){b.style.visibility="hidden";f.style.visibility="";f.play();g=setTimeout(i,5e3)}else i()}if(!d){e&&e.canNotPlay&&e.canNotPlay();return!1}var f=a.C("video");setTimeout(function(){f.setAttribute("width",b.width);f.setAttribute("height",b.height);f.style.position="absolute";f.style.visibility="hidden";a.insertBefore(f,b);a.core.dom.setXY(f,a.core.dom.position(b));f.src="//video.weibo.com/media/play?livephoto="+c+"&KID=unistore,videomovSrc";f.load();e&&e.start&&e.start(f)},100);var g;a.addEvent(f,"canplay",h);a.addEvent(f,"ended",i);a.addEvent(f,"error",i)}});
STK.register("conf.channel.video",function(a){var b=["scroll","resize","docChange","showPicLayer","hidePicLayer","showPicDis","hidePicDis","vplusOne"];return a.lib.kit.extra.listener.define("conf.channel.video",b)});
STK.register("lib.kit.extra.HashTable",function(a){return function(){function a(){this.ObjArr={};this.Count=0;this.Add=function(a,b){if(this.ObjArr.hasOwnProperty(a))return!1;this.ObjArr[a]=b;this.Count++;return!0};this.Contains=function(a){return this.ObjArr.hasOwnProperty(a)};this.GetValue=function(a){if(this.Contains(a))return this.ObjArr[a];throw Error("Hashtable not cotains the key: "+String(a))};this.Remove=function(a){if(this.Contains(a)){delete this.ObjArr[a];this.Count--}};this.Clear=function(){this.ObjArr={};this.Count=0}}return new a}});
STK.register("lib.kit.extra.getWantTime",function(a){return function(a,b){function c(a,b){var c={"M+":b.getMonth()+1,"d+":b.getDate(),"h+":b.getHours(),"m+":b.getMinutes(),"s+":b.getSeconds(),"q+":Math.floor((b.getMonth()+3)/3),S:b.getMilliseconds()};/(y+)/.test(a)&&(a=a.replace(RegExp.$1,(b.getFullYear()+"").substr(4-RegExp.$1.length)));for(var d in c)(new RegExp("("+d+")")).test(a)&&(a=a.replace(RegExp.$1,RegExp.$1.length==1?c[d]:("00"+c[d]).substr((""+c[d]).length)));return a}if(!a&&isNaN(a))throw"differDay: differDay need a int number";if(b&&typeof b!="string")throw"formal: formal need a string like yyyy-MM-dd hh:mm:ss";a=parseInt(a)||0;var d={},e=864e5,f=new Date,g=new Date(f.getTime()+a*e);d.Today={time:f.getTime(),day:f.getDay(),year:f.getFullYear(),quarter:Math.floor((f.getMonth()+3)/3),month:f.getMonth()+1,date:f.getDate(),hour:f.getHours(),minute:f.getMinutes(),second:f.getSeconds(),MSecond:f.getMinutes(),Format:b&&c(b,f)||f.toLocaleString()};d.WantDay={time:g.getTime(),day:g.getDay(),year:g.getFullYear(),quarter:Math.floor((g.getMonth()+3)/3),month:g.getMonth()+1,date:g.getDate(),hour:g.getHours(),minute:g.getMinutes(),second:g.getSeconds(),MSecond:g.getMinutes(),Format:b&&c(b,g)||g.toLocaleString()};f.setHours(0);f.setMinutes(0);f.setSeconds(0);f.setMilliseconds(0);var h=new Date(f.getTime()+a*e);d.ZeroToday={time:f.getTime(),day:f.getDay(),year:f.getFullYear(),quarter:Math.floor((f.getMonth()+3)/3),month:f.getMonth()+1,date:f.getDate(),hour:f.getHours(),minute:f.getMinutes(),second:f.getSeconds(),MSecond:f.getMinutes(),Format:b&&c(b,f)||f.toLocaleString()};d.ZeroWantDay={time:h.getTime(),day:h.getDay(),year:h.getFullYear(),quarter:Math.floor((h.getMonth()+3)/3),month:h.getMonth()+1,date:h.getDate(),hour:h.getHours(),minute:h.getMinutes(),second:h.getSeconds(),MSecond:h.getMinutes(),Format:b&&c(b,h)||h.toLocaleString()};return d}});
STK.register("conf.trans.storage",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("h5playlog",{url:"/aj/log/h5playlog",method:"post"});c("h5playlogs",{url:"//weibo.com/aj/log/h5playlog",method:"get",requestMode:"jsonp",varkey:"callback"});return b});
STK.register("lib.kit.extra.storageLog",function(a){var b=a.conf.trans.storage,c=a.lib.kit.extra.sparkMD5,d={canStore:function(){return window.localStorage?!0:!1},count:0,getUniqueKey:function(){return Math.random().toString(36).substring(5,10)+"_"+ +(new Date)+Math.floor(Math.random()*1e4)+d.count++},resetID:function(a,b){return a+"_"+(b?b:d.getUniqueKey())},isString:function(a){return typeof a=="string"&&a.constructor==String},isJSON:function(a){var b=typeof a=="object"&&Object.prototype.toString.call(a).toLowerCase()=="[object object]"&&!a.length;return b},expTest:function(a,b){var c=new RegExp("^"+a+"_");return c.test(b)},md5Log:function(a,b,d){var e={};e.data=a;e.key=b;e.sig=a&&b&&d&&a+b+d;e.sig=c.hash(e.sig);return e},comLog:function(a,b){var c={};c.data=a;c.key=b;return c}},e={debug:!1,session:!1,str:"",uniqueID:"",resetID:!1,clear:!0,separator:"||",isEncode:!1,logLength:20,logTime:18e4,tabLength:30,trans:b,transKey:"",MD5:!0,MD5str:"encryptedString",params:{timeout:3e4,onComplete:function(){},onTimeout:function(){},onFail:function(){}}};return function(b){b.debug&&console.log(b);if(!!b&&b instanceof Object){if(!b.str||!d.isString(b.str)){console.log("storageLog : need str in parameters object");return}if(!b.transKey||!d.isString(b.transKey)){console.log("storageLog : need transKey in parameters object");return}if(b.separator=="&"){console.log("storageLog : separator can not be &");return}var c,f,g,h,i,j,k,l,m,n,o,p,q,r;p={setFlagTimer:function(){n&&clearTimeout(n);n=null;n=setTimeout(function(){l=!1},0)},setLogTimer:function(){g||(g=setTimeout(function(){try{p.timeout()}catch(a){}},c.logTime))},genValue:function(a){a=d.isJSON(a)?JSON.stringify(a):a;a=c.isEncode?encodeURIComponent(a):a;c.debug&&console.log(a+"........is generated");return a},reset:function(){g&&clearTimeout(g);g=null;l=!1;i=[];k="";c.clear?p.remove():h.setItem(j,k);j=c.resetID?d.resetID(c.str,c.uniqueID):j;c.debug&&console.log("reset........"+j);p.setFlagTimer();p.setLogTimer()},onComplete:function(a){p.reset();c.params.onComplete&&c.params.onComplete(a)},request:function(){c.debug&&console.log(j+"in storage is"+h.hasOwnProperty(j));g&&clearTimeout(g);g=null;var a;if(!(!h.hasOwnProperty(j)&&i.length>1))if(k){if(k.split(c.separator).length>=c.logLength*2){p.onComplete();return}a=c.MD5&&c.MD5str?d.md5Log(k,j,c.MD5str):d.comLog(k,j);c.debug&&console.log("send log is .........","\n",a);c.trans.request(c.transKey,{timeout:c.params.timeout||5e4,onComplete:p.onComplete,onTimeout:c.params.onTimeout||function(){p.onComplete()},onFail:c.params.onFail||function(){p.onComplete()}},a)}else{c.debug&&console.log("logTimer is ......."+g);p.setLogTimer()}},timeout:function(){c.debug&&console.log("running logTimer");if(l&&m<=3){c.debug&&console.log("now is setting storage");try{p.timeout()}catch(a){}m++}else{p.request();m=1}},get:function(){return j&&h.getItem(j)},remove:function(){j&&h.removeItem(j)},set:function(a){if(!!i){l=!0;i.push(p.genValue(a));k=i.join(c.separator);if(i.length>=c.logLength){c.debug&&console.log("arrValue.length is ....."+i.length);p.request();return}h.setItem(j,k);p.setFlagTimer();p.setLogTimer()}},compOne:function(a){return function(b){h.removeItem(a);c.params.onComplete&&c.params.onComplete(b)}},clearOne:function(a,b){if(!!h.hasOwnProperty(a)){var e;if(b){if(b.split(c.separator).length>=c.logLength*2){p.compOne(a)();return}e=c.MD5&&c.MD5str?d.md5Log(b,a,c.MD5str):d.comLog(b,a);c.debug&&console.log("send clearlog is .........","\n",e);c.trans.request(c.transKey,{timeout:c.params.timeout||8e3,onComplete:p.compOne(a),onTimeout:c.params.onTimeout||function(){p.compOne(a)()},onFail:c.params.onFail||function(){p.compOne(a)()}},e);c.debug&&console.log("clear send success")}else h.removeItem(a)}},clear:function(){c.debug&&console.log("clear start");var b=c.str&&h.getItem(c.str);if(!!b){b=b.split(c.separator);a.foreach(b,function(a){p.clearOne(a,h.getItem(a))});h.removeItem(c.str);c.debug&&console.log("clear end")}},unload:function(){a.custEvent.fire(f,"onbeforeunload");var b=c&&c.str&&h&&h.getItem(c.str);b?h.setItem(c.str,b+c.separator+j):h.setItem(c.str,j);c.debug&&console.log("set key is...."+j)},destroy:function(){p.unload();a.custEvent.undefine(f);a.removeEvent(window,"beforeunload",p.unload);f=null;c=null;p=null;n&&clearTimeout(n);n=null;g&&clearTimeout(g);g=null;l=!1;i=null;j=null;k=null;h=null;m=null}};o=function(){c=a.parseParam(e,b);h=c.session?window.sessionStorage:window.localStorage;l=!1;n&&clearTimeout(n);n=null;g&&clearTimeout(g);g=null;i=[];m=1;f={};j=d.resetID(c.str,c.uniqueID);c.debug&&console.log("init key is ......."+j)};q=function(){a.custEvent.define(f,["onbeforeunload"]);f.get=p.get;f.set=p.set;f.remove=p.remove;f.clear=p.clear;f.destroy=p.destroy;p.clear();a.addEvent(window,"beforeunload",p.unload);g=setTimeout(function(){try{p.timeout()}catch(a){}},c.logTime)};r=function(){if(d.canStore()){o();q();c.debug&&console.log("can storage")}else a.log("browser does not support storage")};r();return f}console.log("storageLog : need object of the spec Class");return}});
STK.register("lib.kit.extra.arrayRemove",function(a){return function(b,c){if(!a.isArray(c))throw"aSource: need an array as second parameter";var d=a.arrIndexOf(b,c);if(d<0)throw"oElememt: array does not contain this element";return c.slice(0,d).concat(c.slice(d+1,c.length))}});
STK.register("lib.kit.extra.supportVideo",function(a){var b={};b.video=function(b){var c=navigator.userAgent.toLowerCase(),d=function(){return c.indexOf("bidubrowser")>-1?!0:!1}(),e=function(){return c.indexOf("firefox")>-1?!0:!1}();if(a.core.util.browser.IE6||a.core.util.browser.IE7||a.core.util.browser.IE8||d)return!1;if(b&&(a.core.util.browser.IE9||a.core.util.browser.IE10))return!1;if(!document.createElement("video").canPlayType)return!1;var f=document.createElement("video"),g=f.canPlayType('video/ogg; codecs="theora, vorbis"');if(!g){var h=f.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');return h?h=="probably"?!0:!1:!1}return g==="probably"?!0:!1};b.live=function(){window.MediaSource=window.MediaSource||window.WebKitMediaSource;return window.MediaSource&&typeof window.MediaSource.isTypeSupported=="function"&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')};return b});
STK.register("lib.feed.plugins.video.utils",function(a){var b=document.documentElement,c=document.body,d={sensitiveHeight:200,senClientHeigth:200,count:0,getUniqueKey:function(a){return(a||"H5_")+Math.random().toString(36).substring(5,10)+"_"+ +(new Date)+Math.floor(Math.random()*1e4)+this.count++},sendSuda:function(a,b){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack(a,b)},isJSON:function(a){var b=typeof a=="object"&&Object.prototype.toString.call(a).toLowerCase()=="[object object]"&&!a.length;return b},getAttrData:function(b,c){if(!!b&&!!c){var d=b.getAttribute(c),e=d&&a.queryToJson(d)||!1;return e}},setAttrData:function(b,c,d){var e=this.getAttrData(b,c)||{};e=a.core.json.merge(e,d);b.setAttribute(c,a.jsonToQuery(e))},formateJson:function(a){if(!!this.isJSON(a)){var b=[];for(var c in a)b.push(a[c]);return b.join(";")}},setStyles:function(b,c){a.foreach(c,function(c,d){a.setStyle(b,d,c)})},getDocHeight:function(){return Math.max(c.scrollHeight,b.scrollHeight,c.offsetHeight,b.offsetHeight,b.clientHeight)},isOutClient:function(a,b,c,d){var e=a-b;return e>=d||e<=0-c?!0:!1},isInAutoPauseClient:function(a,b,c,d){var e=a-b;return e>=d-c+this.sensitiveHeight&&e<=d+this.sensitiveHeight||e>=0-c-this.sensitiveHeight&&e<=0-this.sensitiveHeight?!0:!1},isInAutoClinet:function(a,b,c,d){var e=a-b;return e>=0-this.sensitiveHeight&&e<=d-c+this.sensitiveHeight?!0:!1},getOneDomCenter:function(a,b,c){var d=a-b,e=c/2;return d+e},getOneDomAbsCenter:function(a,b,c,d){return Math.abs(this.getOneDomCenter(a,b,c)-d/2)},isInSensitiveClient:function(a,b,c,d){var e=this.getOneDomCenter(a,b,c),f=d/2;return e<=f+this.senClientHeigth&&e>=f-this.senClientHeigth?!0:!1},isInArrayZone:function(a,b,c,d){var e=a-b;return e>=0-4*c&&e<=d+4*c?!0:!1},isInAuto:function(a,b,c){var d=a-b;return d>=-2400&&d<=c+2400?!0:!1},filterAutoVideo:function(b,c,d){var e=[],f;a.foreach(c,function(a,c){e[c]=this.getOneDomAbsCenter(a.top,b,a.domHeight,d)});f=Math.min.apply(null,e);return c[a.core.arr.indexOf(f,e)]},CONauto:function(){return $CONFIG&&$CONFIG.isAuto=="1"?false:true}};return d});
STK.register("lib.feed.plugins.video.log",function(a){var b=a.lib.kit.extra.parseURL,c={},d={play_time:"",uid:null,object_id:null,mid:null,mid_uid:null,rootmid:null,rootuid:null,duration:null,isautoplay:"0",playduration:"",firstframe_status:"",quit_status:"",firstframe_time:"",startplay_time:"",valid_play_duration:"",download_size:"",bitrate:"",encode_mode:null,extend:""},e={vf:"following",sid:0},f={profile:["100505","100306","100406","103505","100205","100605","100606","101106","100206","100106","230267","101806"],page:["100101","101515","100202","100404","100120","100707","100117","100135","100153"],topic:["100808"]},g={count:0,getUniqueKey:function(a){return(a||"H5_")+Math.random().toString(36).substring(5,10)+"_"+ +(new Date)+Math.floor(Math.random()*1e4)+g.count++},isString:function(a){return typeof a=="string"&&a.constructor==String},isJSON:function(a){var b=typeof a=="object"&&Object.prototype.toString.call(a).toLowerCase()=="[object object]"&&!a.length;return b},extendToJson:function(b,c){var d=a.core.str.trim(b).split(","),e={},f=function(a){return c?decodeURIComponent(a):a};for(var g=0,h=d.length;g<h;g++)if(d[g]){var i=d[g].split("=>"),j=i[0],k=i[1];if(i.length<2){k=j;j="$nullName"}if(!e[j])e[j]=f(k);else{a.core.arr.isArray(e[j])!=!0&&(e[j]=[e[j]]);e[j].push(f(k))}}return e},jsonToExtend:function(b,c){var d=function(b,c){b=b==null?"":b;b=a.core.str.trim(b.toString());return c?encodeURIComponent(b):b},e=[];if(typeof b=="object")for(var f in b){if(f==="$nullName"){e=e.concat(b[f]);continue}if(b[f]instanceof Array)for(var g=0,h=b[f].length;g<h;g++)e.push(f+"=>"+d(b[f][g],c));else typeof b[f]!="function"&&e.push(f+"=>"+d(b[f],c))}return e.length?e.join(","):""},changeVF:function(b){var c=b&&b.host,d=b&&b.path,e=window.$CONFIG&&window.$CONFIG.location;if(/s\.weibo\.com/.test(c))return"s";if(/d\.weibo\.com/.test(c))return"hot";if(/weibo\.com/.test(c)){if(/^v6_/.test(e))return/(friends|mygroups|fav|like)/.test(d)?"group":"following";if(/^page_/.test(e)){if(/_single_weibo/.test(e))return"detail";var g,h=/^page_(\d*)_/g.exec(e)[1];for(var i in f)if(a.inArray(h,f[i])){g=i;break}return g?g:"page"}}}},h={getVF:function(a){if(a&&!g.isString(a))throw"str : need string as a parameter";return a||g.changeVF(b())},getSid:function(a){if(a&&!g.isString(a))throw"str : need string as a parameter";return a||g.getUniqueKey()},setExtend:function(b,c){if(!b||!c||!g.isJSON(b)||!g.isJSON(c))throw"logObj || extend: need json as parameter";b.extend=g.jsonToExtend(a.core.json.merge(g.extendToJson(b.extend),c));return b}};return function(){c.vf=h.getVF;c.sid=h.getSid;c.Obj=h.setExtend(a.jsonClone(d),a.parseParam(e,{vf:h.getVF(),sid:h.getSid()}));c.setExtend=h.setExtend;c.destory=function(){c=null;d=null;e=null};return c}});
STK.register("lib.feed.plugins.video.followBtn",function(a){var b=a.lib.kit.extra.language,c=a.core.util.easyTemplate,d=a.conf.trans.follow,e=a.lib.dialog.validateCode(),f=c('<#et followBtn data><div action-type="h5_author_img"><div class="img"><img src="${data.avatar_large}" title="${data.fnick}" class="W_face_radius"></div><div class="add" node-type="h5_author_info" style="display:none"><div class="inner"><div class="name W_autocut">${data.fnick}</div><div class="btn"><a href="javascript:void(0);" class="W_btn_b btn_22px" suda-uatrack="key=wb_PC_H5_player&value=video_profile_addatten" action-type="h5_author_follow" action-data="uid=${data.uid}&fnick=${data.fnick}&refer_flag=${data.refer_flag}"><em class="W_ficon ficon_add S_ficon">+</em>关注</a></div></div></div></div></#et>');return function(b){if(!b)a.log("media : need object of the baseFeedList Class");else{var c={},g,h,i,j,k,l;i={isMouseLeaveOrEnter:function(a,b){if(a&&a.type!="mouseout"&&a.type!="mouseover")return!1;var c=a.relatedTarget?a.relatedTarget:a.type=="mouseout"?a.toElement:a.fromElement;while(c&&c!=b)c=c.parentNode;return c!=b},show:function(b){if(!!i.isMouseLeaveOrEnter(b.evt,b.el)){var c=a.sizzle("[node-type=h5_author_info]",b.el)[0];g&&clearTimeout(g);c&&a.setStyle(c,"display","");c&&a.removeClassName(c,"hv-ani-addb");c&&a.addClassName(c,"hv-ani-adda")}},hide:function(b){if(!!i.isMouseLeaveOrEnter(b.evt,b.el)){var c=a.sizzle("[node-type=h5_author_info]",b.el)[0];g&&clearTimeout(g);c&&a.addClassName(c,"hv-ani-addb");g=setTimeout(function(){c&&a.setStyle(c,"display","none");c&&a.removeClassName(c,"hv-ani-addb")},200)}},initBtn:function(b){if(!!b){b.avatar_large=b.avatar_large&&decodeURIComponent(b.avatar_large);b=a.parseParam({uid:"",fnick:"",avatar_large:"",refer_flag:""},b);return f(b).toString()}},follow:function(b){var c=b.el;if(!!c){var f=c.parentNode,g,h;c.removeAttribute("action-type");a.addClassName(c,"hv-ani-add");g=setTimeout(function(){if(a.hasClassName(f,"con-9")){a.addClassName(f,"hv-s3-9b");h=setTimeout(function(){c&&a.removeNode(c);h&&clearTimeout(h);h=null},500)}g&&clearTimeout(g);g=null},1e3);var i=function(a){},j=function(a){},k=function(){g&&clearTimeout(g);g=null;c&&a.removeClassName(c,"hv-ani-add");c&&c.setAttribute("action-type","author_follow");f&&c&&(f.innerHTML=c);a.removeClassName(f,"hv-s3-9b")},l=d.getTrans("follow",{onComplete:function(a,b){var c={onSuccess:i,onError:j,requestAjax:l,param:b,onRelease:k};e.validateIntercept(a,b,c)}});l.request(b.data)}},follows:function(b){var c=b.el;if(!!c){var f=c.parentNode,g,h;c.removeAttribute("action-type");c.removeAttribute("suda-uatrack");c.innerHTML="已关注";a.addClassName(c,"W_btn_b_disable");var i=function(a){},j=function(a){},k=function(){c&&a.removeClassName(c,"W_btn_b_disable");c&&c.setAttribute("action-type","h5_author_follow");c&&c.setAttribute("suda-uatrack","key=wb_PC_H5_player&value=video_profile_addatten");c&&(c.innerHTML='<em class="W_ficon ficon_add S_ficon">+</em>关注')},l=d.getTrans("follow",{onComplete:function(a,b){var c={onSuccess:i,onError:j,requestAjax:l,param:b,onRelease:k};e.validateIntercept(a,b,c)}});l.request(b.data)}},destroy:function(){c=null;h.remove("h5_author_follow","click",i.follows);h.remove("h5_author_img","mouseover",i.show);h.remove("h5_author_img","mouseout",i.hide);h&&h.destroy&&h.destroy()},initplugins:function(){c.btn=i.initBtn;c.destroy=i.destroy}};j=function(){h=a.delegatedEvent(b)};k=function(){h.add("h5_author_follow","click",i.follows);h.add("h5_author_img","mouseover",i.show);h.add("h5_author_img","mouseout",i.hide)};l=function(){j();k();i.initplugins()};l();return c}}});
STK.register("lib.feed.plugins.video.ad",function(a){var b=a.lib.kit.extra.language,c=a.core.util.easyTemplate,d=a.conf.trans.feed.feed,e={front:c(b('<#et frontAD data><div class="ad hv-pos" node-type="h5_video_AD"><video uniqueKey=${data.uniqueKey} autoplay node-type="h5_video_media" _src="pre=${data.fUrl}&end=${data.eUrl}" fCount=${data.fCount} eCount=${data.eCount}>#L{您的浏览器不支持HTML5}</video><div class="pos"><span class="sp-1"><em node-type="h5_video_time">${data.fDuration || data.eDuration}</em>#L{秒后关闭广告}</span><span class="sp-2"><i class="hv-icon hv-icon-mute" node-type="h5_video_vol" action-type="h5_video_vol" action-data="uniqueKey=${data.uniqueKey}"></i></span></div></div></#et>'))};return function(b){if(!b)a.log("spec : need object of the ad Class");else{var c={},f,g,h,i,j,k,l,m,n,o,p,q;b.fUrl&&(b.fUrl=decodeURIComponent(b.fUrl));b.eUrl&&(b.eUrl=decodeURIComponent(b.eUrl));f=a.parseParam({video:"",node:"",uniqueKey:"",mid:"",fUrl:"",eUrl:"",fDuration:5,eDuration:5,fCount:2,eCount:2,fMark:"",eMark:""},b);if(!f.node)return;n={init:function(){f.node.innerHTML=e.front(f).toString();g=a.builder(f.node).list;h=g.h5_video_AD[0];i=g.h5_video_media[0];j=g.h5_video_time[0];k=g.h5_video_vol[0];!h||!i||!j||!k},countTimer:function(a){return function(){a===0?n.ended():j.innerHTML=--a}},start:function(){j.innerHTML=Math.floor(i.duration)||f.fDuration;a.addClassName(f.node,"hv-s3-10");l&&clearInterval(l);l=null;l=setInterval(n.countTimer(Math.round(i.duration)||f.fDuration),1e3)},ended:function(){l&&clearInterval(l);l=null;a.removeClassName(f.node,"hv-s3-10");if(!!i){i.removeAttribute("src");j.innerHTML=Math.floor(i.duration)||f.fDuration;a.removeEvent(i,"canplay",n.start);a.removeEvent(i,"ended",n.ended);a.removeEvent(i,"error",n.ended);a.custEvent.fire(c,"ended",{muted:i.muted,key:f.uniqueKey})}},play:function(b,c){var e,g,h,j;switch(b){case"pre":g="fCount";j={mid:f.mid,mark:f.fMark,type:"pread"};break;case"end":g="eCount";j={mid:f.mid,mark:f.eMark,type:"endad"};break;default:g="fCount";j={mid:f.mid,mark:f.fMark,type:"pread"}}e=i.getAttribute(g);if(e<=0)n.ended();else{i.setAttribute(g,--e);h=i&&a.queryToJson(i.getAttribute("_src"));if(!h)return;i.src=decodeURIComponent(h[b]);i.muted=c;if(c){a.removeClassName(k,"hv-icon-volume");a.addClassName(k,"hv-icon-mute")}else{a.removeClassName(k,"hv-icon-mute");a.addClassName(k,"hv-icon-volume")}d.request("setAD",{onSuccess:function(){},onFail:function(){},onError:function(){}},j);a.addEvent(i,"canplay",n.start);a.addEvent(i,"ended",n.ended);a.addEvent(i,"error",n.ended);!+i.getAttribute("fCount")&&!+i.getAttribute("eCount")&&f.video.removeAttribute("ad-data")}},hide:function(){l&&clearInterval(l);l=null;a.removeClassName(f.node,"hv-s3-10");if(!!i){i.removeAttribute("src");a.removeEvent(i,"canplay",n.start);a.removeEvent(i,"ended",n.ended);a.removeEvent(i,"error",n.ended)}},pushVol:function(b){var c=b.el;if(i.muted){a.removeClassName(c,"hv-icon-mute");a.addClassName(c,"hv-icon-volume");i.muted=!1}else{a.removeClassName(c,"hv-icon-volume");a.addClassName(c,"hv-icon-mute");i.muted=!0}},destroy:function(){c=null;m&&m.destroy&&m.destroy();m.remove("h5_video_vVol","click",n.pushVol);n.hide();a.custEvent.undefine(c,["ended"]);f.node.innerHTML=""},initplugins:function(){c.init=n.init;c.play=n.play;c.hide=n.hide;c.ended=n.ended;c.destroy=n.destroy}};o=function(){n.init();m=a.delegatedEvent(f.node)};p=function(){m.add("h5_video_vol","click",n.pushVol);a.custEvent.define(c,["ended"])};q=function(){o();p();n.initplugins()};q();return c}}});
STK.register("lib.feed.plugins.video.quality",function(a){var b=a.lib.kit.extra.language,c=a.core.util.easyTemplate,d={quality:c(b('<#et quality data><i suda-uatrack="key=wb_PC_H5_player&value=quality_click" action-type="h5_video_qShow" action-data="show=0&qType=${data["qType"]}">#L{${data["select"]}}</i><span node-type="h5_video_qMenu" style="display:none"><#if (data["1080"] && data["uniqueKey"])><a suda-uatrack="key=wb_PC_H5_player&value=quality_1080p" href="javascript:void(0);" action-type="h5_video_qSelect" action-data="uniqueKey=${data["uniqueKey"]}&qType=1080&src=${data["1080"]}"><em class="W_ficon ficon_video_v3"></em>#L{1080P}</a></#if><#if (data["720"] && data["uniqueKey"])><a suda-uatrack="key=wb_PC_H5_player&value=quality_720p" href="javascript:void(0);" action-type="h5_video_qSelect" action-data="uniqueKey=${data["uniqueKey"]}&qType=720&src=${data["720"]}">#L{高清}</a></#if><#if (data["480"] && data["uniqueKey"])><a suda-uatrack="key=wb_PC_H5_player&value=quality_480p" href="javascript:void(0);" action-type="h5_video_qSelect" action-data="uniqueKey=${data["uniqueKey"]}&qType=480&src=${data["480"]}">#L{标清}</a></#if><#if (data["fluency"] && data["uniqueKey"] && data["qType"] == "fluency")><a suda-uatrack="key=wb_PC_H5_player&value=quality_fluency" href="javascript:void(0);" action-type="h5_video_qSelect" action-data="uniqueKey=${data["uniqueKey"]}&qType=fluency&src=${data["fluency"]}">#L{流畅}</a></#if></span></#et>'))},e={480:"标清",720:"高清",1080:"1080P",fluency:"流畅"};return function(b){if(!b)a.log("media : need object of the baseFeedList Class");else{var c={},f,g,h,i,j;g={select:function(b){var c=b.el,d=b.data,e=a.core.dom.dir.parent(c,{expr:"[node-type=h5_video_qMenu]"})[0];a.setStyle(e,"display","none");if(d.qType=="1080")window.__WBH5VideoUtils__("jumpUrl",d);else{var f=a.core.dom.prev(e),g=a.queryToJson(f.getAttribute("action-data")).qType,h={show:0,qType:d.qType};f.setAttribute("action-data",a.jsonToQuery(h));if(g==d.qType)return;f.innerHTML=c.innerHTML;window.__WBH5VideoUtils__("reset",d)}},show:function(b){var c=b.el,d=b.data,e=a.core.dom.next(c);if(d.show==1){d.show=0;c.setAttribute("action-data",a.jsonToQuery(d));a.setStyle(e,"display","none")}else{d.show=1;c.setAttribute("action-data",a.jsonToQuery(d));a.setStyle(e,"display","block")}},btn:function(a){if(!!a){a.select=a.qType&&e[a.qType]||"标清";return d.quality(a).toString()}},destroy:function(){c=null;f.remove("h5_video_qSelect","click",g.select);f.remove("h5_video_qShow","click",g.show);f&&f.destroy&&f.destroy()},initplugins:function(){c.btn=g.btn;c.destroy=g.destroy}};h=function(){f=a.delegatedEvent(b)};i=function(){f.add("h5_video_qSelect","click",g.select);f.add("h5_video_qShow","click",g.show)};j=function(){h();i();g.initplugins()};j();return c}}});
STK.register("lib.feed.plugins.video.vplus",function(a){var b=a.lib.kit.extra.language,c=a.core.util.easyTemplate,d=a.conf.channel.video,e={icon:c(b("<#et icon data><span></span></#et>")),tip:c(b('<#et tip data><div class="inner" node-type="h5_video_vplus_tip">#L{试看部分视频，}<a href="javascript:void(0);" action-type="h5_video_vplus_tip" action-data="uniqueKey=${data.uniqueKey}&mid=${data.mid}&vuid=${data.vuid}&oid=${data.oid}">#L{开通Ta的专属会员}</a>#L{可观看完整视频及Ta的全部付费内容。}</div></#et>')),layer:c(b('<#et tip data><div class="inner" node-type="h5_video_vplus_layer" action-data="uniqueKey=${data.uniqueKey}&mid=${data.mid}&vuid=${data.vuid}&isFake=${data.isFake}&oUrl=${data.oUrl}&oid=${data.oid}"><div class="tip W_autocut" node-type="h5_video_vplus_txt"></div><div class="btn hv-center" node-type="h5_video_vplus_btn"><div node-type="h5_video_vplus_replay"><a href="javascript:void(0);" action-type="h5_video_vplus_replay"><span class="hv-ring"><i class="hv-icon hv-icon-replay"></i></span>#L{重播}</a></div><div node-type="h5_video_vplus_right"></div></div></div></#et>'))},f={tip:[b("#L{如果付费成功，可以观看完成视频；如果付费失败，只能试看部分视频。}"),b('<a href="javascript:void(0);" action-type="h5_video_vplus_goon"><span class="hv-ring"><i class="hv-icon hv-icon-play"></i></span>#L{继续播放}</a>')],end:[b("#L{试看结束，开通Ta的专属会员可观看Ta的全部付费内容。}"),b('<a href="javascript:void(0);" action-type="h5_video_vplus_open"><span class="hv-ring"><i class="hv-icon hv-icon-open"></i></span>#L{立即开通}</a>')],open:[b("#L{如果付费成功，请点击播放按钮继续观看。}"),b('<a href="javascript:void(0);" action-type="h5_video_vplus_goon"><span class="hv-ring"><i class="hv-icon hv-icon-play"></i></span>#L{继续播放}</a>')],fake:[b("#L{请去原博主的微博查看完整视频。}"),b('<a href="javascript:void(0);" action-type="h5_video_vplus_goto"><span class="hv-ring"><i class="hv-icon hv-icon-goto"></i></span>#L{去原微博}</a>')]},g={getAttrNode:function(b,c,d){return a.core.dom.dir(b,{expr:c,endpoint:d||document.body})[0]}};return function(b){if(!b)a.log("node : need object of the baseFeedList Class");else{var c={},h,i=["tip","replay"],j,k,l,m,n;k={tip:function(b,c){if(!!c.obj){var d,e,f,g,h,i,k,l,m=c.obj.action.data;e=m.hId;if(a.hasClassName(e,"hv-s3-12b"))return;h=m.vplusLayer;d=m.media;i=a.builder(h).list;if(!i)return;k=i.h5_video_vplus_txt[0];l=i.h5_video_vplus_right[0];if(c.layer=="tip"){c.obj.action.media.pause();window.__WBH5VideoUtils__("togglePlay",{uniqueKey:c.obj.key,paused:!0})}j.show(c.layer,{vTxt:k,vRight:l,vLayer:h,vBox:e})}},replay:function(b,c){if(!!c.obj){var d,e,f,g,h=c.obj.action.data;d=h.hId;e=h.vplusTip1;f=h.vplusTip2;g=h.vplusLayer;if(!a.hasClassName(d,"hv-s3-12b"))return;j.hide(c.open,{vBox:d,vLayer:g,vTip1:e,vTip2:f})}}};j={init:function(b){b=a.parseParam({video:"",uniqueKey:"",mid:"",oid:"",vuid:"",isPay:"",isOpen:"",isFake:"",oUrl:""},b);if(!!b.video){var c,d,f,g;c=b.video.data.vplusIcon;d=b.video.data.vplusTip1;f=b.video.data.vplusTip2;g=b.video.data.vplusLayer;if(b.isPay&&c&&!b.isFake){c.innerHTML=e.icon(b).toString();a.addClassName(c,"hv-show")}if(d&&f&&g&&!b.isOpen){var h,i=e.tip(b).toString();g.innerHTML=e.layer(b).toString();if(b.isFake)return;d.innerHTML=i;f.innerHTML=i}}},tipClick:function(a){var b=a.data,c=location.protocol+"//vipclub.weibo.com/vmember/opendetail?vuid="+b.vuid+"&F=video_"+b.oid;window.open(c,"_blank");b.type="tip";b.layer="tip";d.fire("vplusOne",b)},replay:function(b){var c=b.el,d=g.getAttrNode(c,"[node-type=h5_video_vplus_layer]"),e=a.queryToJson(d.getAttribute("action-data"));e.replay=!0;window.__WBH5VideoUtils__("reset",e)},open:function(b){var c=b.el,d=g.getAttrNode(c,"[node-type=h5_video_vplus_layer]"),e=a.queryToJson(d.getAttribute("action-data")),f=location.protocol+"//vipclub.weibo.com/vmember/opendetail?vuid="+e.vuid+"&F=video_"+e.oid;window.open(f,"_blank");var h=g.getAttrNode(c,"[node-type=h5_video_vplus_layer]"),i=a.builder(h).list,k=i.h5_video_vplus_txt[0],l=i.h5_video_vplus_right[0];j.show("open",{vLayer:h,vTxt:k,vRight:l})},goon:function(b){var c=b.el,d=g.getAttrNode(c,"[node-type=h5_video_vplus_layer]"),e=a.queryToJson(d.getAttribute("action-data"));e.goon=!0;window.__WBH5VideoUtils__("reset",e)},"goto":function(b){var c=b.el,d=g.getAttrNode(c,"[node-type=h5_video_vplus_layer]"),e=a.queryToJson(d.getAttribute("action-data"));e.oUrl&&window.open(decodeURIComponent(e.oUrl))},show:function(b,c){if(!!b&&!!c){if(!c.vTxt||!c.vRight||!c.vLayer)return;c.vTxt.innerHTML=f[b][0];c.vRight.innerHTML=f[b][1];c.vBox&&a.addClassName(c.vBox,"hv-s3-12b")}},hide:function(b,c){if(!!c){c.vBox&&a.removeClassName(c.vBox,"hv-s3-12b");if(b){c.vLayer&&(c.vLayer.innerHTML="");c.vTip1&&(c.vTip1.innerHTML="");c.vTip2&&(c.vTip2.innerHTML="")}}},destroy:function(){h.remove("h5_video_vplus_tip","click",j.tipClick);h.remove("h5_video_vplus_replay","click",j.replay);h.remove("h5_video_vplus_open","click",j.open);h.remove("h5_video_vplus_goon","click",j.goon);h.remove("h5_video_vplus_goto","click",j.goto);h&&h.destroy&&h.destroy();a.custEvent.undefine(c);c=null},initCust:function(){for(var b in k)a.custEvent.add(c,b,k[b])},initplugins:function(){c.init=j.init;c.destroy=j.destroy}};l=function(){h=a.delegatedEvent(b)};m=function(){a.custEvent.define(c,i);j.initCust();h.add("h5_video_vplus_tip","click",j.tipClick);h.add("h5_video_vplus_replay","click",j.replay);h.add("h5_video_vplus_open","click",j.open);h.add("h5_video_vplus_goon","click",j.goon);h.add("h5_video_vplus_goto","click",j.goto)};n=function(){l();m();j.initplugins()};n();return c}}});
STK.register("lib.feed.plugins.video.init",function(a){var b=a.lib.kit.dom.parseDOM,c=a.conf.trans.feed.feed,d=a.conf.channel.video,e=a.lib.kit.extra.merge,f=a.lib.kit.extra.language,g=a.lib.kit.extra.sparkMD5,h=a.lib.kit.extra.sendImage,i=a.lib.kit.extra.HashTable,j=a.lib.kit.extra.getWantTime,k=a.lib.kit.extra.scrollMethod,l=a.lib.kit.extra.storageLog,m=a.lib.kit.extra.arrayRemove,n=a.lib.kit.extra.supportVideo,o=a.lib.feed.plugins.video.utils,p=a.lib.feed.plugins.video.followBtn,q=a.lib.feed.plugins.video.ad,r=a.lib.feed.plugins.video.quality,s="WB_video_h5",t={str:"Log_h5paly",transKey:"h5playlog"},u="yixiong&zhaolong5",v={80000002:2,80000008:1},w={sensitiveHeight:270,md5Data:function(b,c,d){var e={};e.data=a.jsonToStr(b);e.key=c;e.sig=e.data&&c&&d&&e.data+c+d;e.sig=g.hash(e.sig);return e},sendAnalysisRequest:function(b,d){var e=b.getAttribute("data-mark")||"",f=a.queryToJson(e),g=v[d],i=function(a){var b=[];for(var c=0;c<a.attributes.length;c++)a.attributes[c].name.indexOf(d===80000008&&o.CONauto()&&f.monitor_mask?"auto-data-mark-third-analysis":"data-mark-third-analysis")===0&&b.push(a.attributes[c].value);return b}(b);if(f.monitor_mask&&f.monitor_mask&g){h(i,{action_id:d,autoplay:o.CONauto()?1:0});c.request("setADMonitor",{},{action_id:d,monitor:a.foreach(i,function(a){return encodeURIComponent(a)}).join("|"),mark:f.mark})}},showBubble:function(b){var c='<div class="W_layer_tips" style="position:absolute;"><div class="W_layer_close"><a href="javascript:void(0);" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div><div class="content"><div class="txt"><p>'+f("#L{视频滚出屏幕将自动暂停，再也不用点收起了哦}")+"</p></div>"+"</div>"+'<div class="W_layer_arrow"><span node-type="arrow" class="W_arrow_bor W_arrow_bor_t"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div>'+"</div>",d=j(1),e="wb_h5video_"+$CONFIG.uid,g,h=720,i=!1;if(!!b&&a.cookie.get(e)!="expand"&&!i){var k=a.ui.bubble(c,{showWithAni:"fadeInUp",hideWithAni:"fadeOutDown",autoRelease:!0}).show(),l=function(){if(a.contains(document.body,b)&&k._)k.beside(b,{pos:"top-left",offsetX:0,offsetY:0});else{k.hide();g&&clearInterval(g)}};g=setInterval(l,1e3);a.cookie.set(e,"expand",{expire:h})}}};o=e(o,w);return function(b,e){if(!b)a.log("media : need object of the baseFeedList Class");else{var f={},g,h,v,w,x,y,z=[],A=[],B,C,D,E=!1,F={},G,H,I=!1,J,K,L,M,N,O,P,Q=function(){g=o.CONauto();h=b.getNode();v=b.getDEvent();w=b.utils;K=a.pageSize().page.height;G=G&&G.Clear()||i();L=a.lib.feed.plugins.video.log();M=L.Obj;N=p(h);$qBtn=r(h);O=a.lib.feed.plugins.video.vplus(h);P=l(t)},R={fullScreen:function(){E=!0},unFullScreen:function(){E=!1},loaded:function(a){if(typeof a!="object")throw"DataItemPicker need params object";var b=a.uniqueKey&&G&&G.ObjArr&&G.ObjArr[a.uniqueKey];if(!!b){if(a.uniqueKey===x||a.uniqueKey===y){b.videoRoom.getAttribute("ad-data")&&T.insertAD(b,"pre");return}o.isInAuto(b.top,C,B)?g&&b.action.playStatus()&&b.action.playStatus()=="playing"&&b.action.toggleEPlay():T.outPlay(b)}},playLog:function(a){if(typeof a!="object")throw"DataItemPicker need params object";if(!!a.logObj&&!!a.uniqueKey){var b=G&&G.ObjArr&&G.ObjArr[a.uniqueKey]&&G.ObjArr[a.uniqueKey].logObj,c,d;if(b){a.logObj.duration&&(b.duration=a.logObj.duration);a.logObj.playduration&&(b.playduration=a.logObj.playduration);a.logObj.startplay_time&&(b.startplay_time=a.logObj.startplay_time);a.logObj.valid_play_duration&&(b.valid_play_duration=a.logObj.valid_play_duration);c=b}else c=a.logObj;a.logObj.valid_play_duration==9999&&console.log(33333,a.logObj.valid_play_duration);if(a.logObj.valid_play_duration<0||a.logObj.valid_play_duration>=5*a.logObj.duration*1e3)c=L.setExtend(c,{illegal:!0});c&&(d=o.formateJson(c));d&&P.set(d)}},reset:function(b){if(typeof b!="object")throw"DataItemPicker need params object";b=a.parseParam({goon:!1,replay:!1,uniqueKey:"",qType:"480"},b);var d=b.uniqueKey&&G&&G.ObjArr&&G.ObjArr[b.uniqueKey];if(!!d){b.replay&&d.qType&&(b.qType=d.qType);var e=d.videoRoom;if(!e)return;var f=o.getAttrData(e,"action-data");if(!f)return;if(f.type==="feedlive")return;var g=d.action.media&&d.action.media.currentTime,i=d.action.media&&d.action.media.muted,k=w.getFeedNode(e,h),l=f.type==="feedvideo"||f.type==="feedlive",m=k&&k.getAttribute("mid"),n=f&&f.objectid,p=d.vData,q=null;if(p&&p.isPay==1){if(p.isFake==1){b.replay&&O&&a.custEvent.fire(O,"replay",{obj:d,open:!1});d.action.media.play();window.__WBH5VideoUtils__("togglePlay",{uniqueKey:d.key,paused:!1});return}q=+p.isOpen}if(d.newUrl)return;d.newUrl=!0;c.request("newVideoUrl",{onComplete:function(h){if(h.code==="100000"&&h.data.video_size){var l,q=h.data.video_size;q.uniqueKey=b.uniqueKey;q.qType=d.action.media.qType||b.qType;q[b.qType]&&(l=decodeURIComponent(q[b.qType]).replace(/^https?:/,""));d.action.media.src=l;d.qType=b.qType;if(h.data.infos&&h.data.infos.id==n){o.setAttrData(e,"video-sources",q);p.isOpen="1";o.setAttrData(e,"vplus-data",p);d.logObj=L.setExtend(d.logObj,{pay:"l"})}(b.replay||b.goon)&&O&&a.custEvent.fire(O,"replay",{obj:d,open:!!+p.isOpen});d.logObj.play_time=j(0,"yyyy-MM-dd hh:mm:ss").Today.Format;d.logObj=L.setExtend(d.logObj,{qType:b.qType});d.action.media.muted=i;var r=function(c){d.newUrl=!1;d.action.media.play();window.__WBH5VideoUtils__("togglePlay",{uniqueKey:d.key,paused:!1});!b.replay&&(d.action.media.currentTime=g-2);a.removeEvent(d.action.media,"canplay",r)};a.addEvent(d.action.media,"canplay",r);d.init=!0;b.replay&&c.request("playstatistics",{},{uid:$CONFIG.uid,mid:m,keys:f.keys,type:f.type});if(k&&k.getAttribute("data-mark")){o.sendAnalysisRequest(k,80000008);c.request("adDeal",{},{mid:m,short_url:f.short_url,mark:a.queryToJson(k.getAttribute("data-mark")).mark})}}}},{object_id:n,mid:m,isOpen:q})}},rePlay:function(b){if(typeof b!="object")throw"DataItemPicker need params object";var d=G&&G.ObjArr&&b.uniqueKey&&G.ObjArr[b.uniqueKey];if(!!d){var e=d&&d.videoRoom,f=e&&o.getAttrData(e,"action-data"),g=e&&w.getFeedNode(e,h),i=f.type==="feedvideo"||f.type==="feedlive",k=g&&g.getAttribute("mid"),l=d&&d.logObj,m;d&&!d.preAd&&d.videoRoom.getAttribute("ad-data")&&(m=setTimeout(function(){T.insertAD(d,"pre");clearTimeout(m);m=null},300));l=L.setExtend(l,{sid:L.sid()});l.play_time=j(0,"yyyy-MM-dd hh:mm:ss").Today.Format;var n=o.md5Data({uid:$CONFIG.uid,mid:k,keys:f.keys,type:f.type},o.getUniqueKey(),u);i&&c.request("playstatistics",{},n);if(g&&g.getAttribute("data-mark")){o.sendAnalysisRequest(g,80000002);c.request("adDeal",{},{mid:k,short_url:f.short_url,mark:a.queryToJson(g.getAttribute("data-mark")).mark})}}},ended:function(b){if(typeof b!="object")throw"DataItemPicker need params object";var c=G&&G.ObjArr&&b.uniqueKey&&G.ObjArr[b.uniqueKey];if(!!c){c.preAd=null;c.videoRoom.getAttribute("ad-data")&&T.insertAD(c,"end");var d=c.vData;if(d&&d.isPay&&(d.isFake==1||d.isOpen==0)){var e=d.isFake==1?"fake":"end";O&&a.custEvent.fire(O,"tip",{obj:c,layer:e})}}},volPlay:function(b){if(typeof b!="object")throw"DataItemPicker need params object";var c=G&&G.ObjArr&&b.uniqueKey&&G.ObjArr[b.uniqueKey];if(!!c){c.type==="video"&&c.init&&c.logObj&&(c.logObj.isautoplay="0");if(b.muted)if(!c.init)c.init=!0;else{b.uniqueKey&&!a.inArray(b.uniqueKey,A)&&A.push(b.uniqueKey);c.type==="video"&&g&&b.uniqueKey===y&&(y=null)}else{b.uniqueKey&&a.inArray(b.uniqueKey,A)&&(A=m(b.uniqueKey,A));if(b.uniqueKey===y)return;if(b.uniqueKey!==x&&b.paused){b.uniqueKey&&!a.inArray(b.uniqueKey,z)&&z.push(b.uniqueKey);return}if(y){var d=G.ObjArr[y];if(!d)return;if(!o.isInAuto(d.top,C,B))T.outPlay(d);else if(d.action.playStatus()&&d.action.playStatus()=="playing")if(d.type==="video"){d.action.toggleEPlay();!a.inArray(y,z)&&z.push(y)}else if(d.type==="live"){d.action.destroy();d.init=!1}}b.uniqueKey&&a.inArray(b.uniqueKey,z)&&(z=m(b.uniqueKey,z));y=b.uniqueKey}}},togglePlay:function(b){if(typeof b!="object")throw"DataItemPicker need params object";var c=b&&b.uniqueKey,d=c&&G&&G.ObjArr&&G.ObjArr[c];if(!!d)if(b.paused)c&&!a.inArray(c,z)&&z.push(c);else{c&&a.inArray(c,z)&&(z=m(c,z));if(c&&!a.inArray(c,A)){d.type==="video"&&d.action.toggleMute(!1);R.volPlay({uniqueKey:b.uniqueKey,muted:!1,paused:!1})}}},sendSuda:function(a){if(typeof a!="object")throw"DataItemPicker need params object";var b=a&&a.key,c=a&&a.value;b&&c&&o.sendSuda(b,c)},jumpUrl:function(b){if(typeof b!="object")throw"DataItemPicker need params object";var c=b&&b.uniqueKey,d=c&&G&&G.ObjArr&&G.ObjArr[c];if(!!d){d.action.playStatus()&&d.action.playStatus()=="playing"&&d.action.toggleEPlay();var e=Math.floor(d.action.media&&d.action.media.currentTime),f=b.src&&decodeURIComponent(b.src).replace(/^https?/,"http");f=e?a.URL(f).setHash("w",e).toString():f;window.open(f,"_blank")}},initPlugins:function(b,c){if(!b||typeof b!="string")a.log("type : need String of the function type");else switch(b){case"fullScreen":R.fullScreen();break;case"unFullScreen":R.unFullScreen();break;case"loaded":R.loaded(c);break;case"playLog":R.playLog(c);break;case"reset":R.reset(c);break;case"rePlay":R.rePlay(c);break;case"ended":R.ended(c);break;case"volPlay":R.volPlay(c);break;case"togglePlay":R.togglePlay(c);break;case"sendSuda":R.sendSuda(c);break;case"jumpUrl":R.jumpUrl(c)}}},S={vplusOne:function(b){if(!!b){var c=b.uniqueKey,d=b.type,e=b.layer,f=c&&G&&G.ObjArr&&G.ObjArr[c];if(!d||!e)return;O&&a.custEvent.fire(O,d,{obj:f,layer:e})}}},T={getLogData:function(b,c,d){if(!!a.isNode(b)){var e=b&&w.getFeedNode(b,h),f=e&&e.getAttribute("tbinfo")&&a.queryToJson(e.getAttribute("tbinfo")),i=e&&e.getAttribute("minfo")&&a.queryToJson(e.getAttribute("minfo")),k=e&&e.getAttribute("mid");d.uid=$CONFIG&&$CONFIG.uid||"";d.mid=k?k:"";d.mid_uid=f&&f.ouid?f.ouid:"";d.rootuid=i&&i.ru||f&&f.ouid;d.rootmid=i&&i.rm&&i.rm||k&&k;d.object_id=c&&c.objectid;d.duration=c&&c.duration;d.encode_mode=c&&c.encode_mode;d.bitrate=c&&c.bitrate;d.play_time=j(0,"yyyy-MM-dd hh:mm:ss").Today.Format;d.isautoplay=g?"1":"0";return d}},getInitData:function(b){if(!(!b||!a.isNode(b.node)||!a.isNode(b.dom))){var c,d,e=b.actionData;if(!e)return;if(e.type==="feedlive")c={logObj:{},uid:window.$CONFIG&&window.$CONFIG.uid||"",objectId:e.objectid,thumbnail:e.cover_img&&decodeURIComponent(e.cover_img),videoH:e.card_height&&e.card_height+"px",videoW:e.card_width&&e.card_width+"px",dom:b.dom,playCount:e.play_count,duration:e.duration,liveStatus:e.liveStatus,cTime:e.cTime,allowMouseRight:!1,isWBLive:!0,uniqueKey:b.uniqueKey,extend:{is_premium:e.is_premium&&e.is_premium==1?!0:!1}};else{d=L.setExtend(M,{sid:L.sid(),qType:"480"});if(b.vData&&b.vData.isPay==1&&b.vData.isOpen==0||b.vData&&b.vData.isFake==1)d=L.setExtend(M,{pay:"s"});d=T.getLogData(b.node,e,d);c={logObj:d,thumbnail:e.cover_img&&decodeURIComponent(e.cover_img),shortUrl:e.short_url&&decodeURIComponent(e.short_url),videoUrl:e.video_src&&decodeURIComponent(e.video_src),videoH:e.card_height&&e.card_height+"px",videoW:e.card_width&&e.card_width+"px",selfW:500,dom:b.dom,followBtn:b.followData&&b.followData.need_follow&&N.btn(b.followData)||"",quality:b.vSrcs&&$qBtn.btn(b.vSrcs)||"",playCount:e.play_count,duration:e.duration,isAutoPlay:g?!0:!1,isShort:b.vData&&b.vData.isPay==1&&b.vData.isOpen==0||b.vData&&b.vData.isFake==1?!0:!1,uniqueKey:b.uniqueKey};if(b.vSrcs&&b.vSrcs.qType&&b.vSrcs[b.vSrcs.qType]){c.videoUrl=decodeURIComponent(b.vSrcs[b.vSrcs.qType]).replace(/^https?:/,"");c.logObj=L.setExtend(d,{qType:b.vSrcs.qType})}}return c}},bindAD:function(b,c){var d=function(e,f){if(typeof f!="object")throw"DataItemPicker need params object";var h=f&&f.key,i=h&&G&&G.ObjArr&&G.ObjArr[h];i.preAd=i.preAd=="pre"?"pred":null;if(h===x||h===y){if(!i.preAd)return;c.playStatus()&&c.playStatus()=="paused"&&c.toggleEPlay()}else{o.isInAuto(i.top,C,B)?g&&i.action.playStatus()&&i.action.playStatus()=="playing"&&i.action.toggleEPlay():T.outPlay(i);if(!i.videoRoom.getAttribute("ad-data")){a.custEvent.remove(b,"ended",d);i.preAd=null;b&&b.destroy&&b.destroy()}}};a.custEvent.add(b,"ended",d)},resetOne:function(a,b,c){var d=G.ObjArr[a].top,e=G.ObjArr[a].domHeight;d&&d!=b&&(G.ObjArr[a].top=F[a]=b);e&&e!=c&&(G.ObjArr[a].domHeight=c)},initOne:function(b,c,d){if(!!b){var e,f,g,h,i,j,k,l,m,p,r,t;e=o.getUniqueKey();f=w.getMid(b);g=o.getAttrData(b,"action-data");if(!g)return;if(g.type==="feedlive"&&!n.live())return;l=o.getAttrData(b,"follow-data");m=o.getAttrData(b,"video-sources");m.uniqueKey=e;if(m&&m.qType&&m.qType!="720"&&m.qType!="1080"){!g.video_src&&m[m.qType]&&(g.video_src=m[m.qType]);m=null}p=o.getAttrData(b,"ad-data");vData=o.getAttrData(b,"vplus-data");b.setAttribute("unique-video",e);a.addClassName(b,s);h=a.sizzle('[node-type="fl_h5_video_pre"]',b)[0];i=a.sizzle('[node-type="fl_h5_video_disp"]',b)[0];h.style.display="none";i.style.display="";j=T.getInitData({node:b,dom:i,actionData:g,followData:l||"",vData:vData||"",vSrcs:m||"",uniqueKey:e});if(g.type==="feedlive")k=new HlsPlayer(j);else{k=new VideoPlayer(j);k.thumbnail();if(p){t=q(a.core.json.merge({video:b,node:k.data.advertisement||a.sizzle(".con-10",b)[0],mid:f,uniqueKey:e},p));T.bindAD(t,k)}vData&&(vData.isPay==1||vData.isFake==1)&&O.init(a.core.json.merge({video:k,uniqueKey:e,mid:f,oid:g.objectid,isPay:vData.isPay==1,isOpen:vData.isOpen==1,isFake:vData.isFake==1,vuid:vData.vuid,oUrl:vData.oUrl}))}r={type:g.type==="feedlive"?"live":"video",key:e,logObj:a.jsonClone(j.logObj),init:!1,videoRoom:b,top:c,domHeight:d,action:k,adAction:t,preAd:null,qType:m&&m.qType,vData:vData};!F.hasOwnProperty(e)&&(F[e]=c);!G.Contains(e)&&G.Add(e,r)}},initVideos:function(){if(!E){var b=a.sizzle('[node-type="fl_h5_video"]',h);b&&a.foreach(b,function(b){var c=a.position(b).t,d=a.core.dom.getSize(b).height,e=b.getAttribute("unique-video");e?T.resetOne(e,c,d):T.initOne(b,c,d)})}},expandPlay:function(b){var d=b.data,f=b.el;if(f.getAttribute("node-type")!=="fl_h5_video"||d&&d.type==="feedlive"&&!n.live()){e&&e(b);return w.preventDefault(b.evt)}var i=w.getMid(f,h),k=w.getFeedNode(f,h),l=d.type==="feedvideo"||d.type==="feedlive",m=f&&f.getAttribute("unique-video"),p=m&&G.ObjArr[m];if(d.type!=="feedlive"){var q=p&&p.logObj;q.play_time=j(0,"yyyy-MM-dd hh:mm:ss").Today.Format;q.isautoplay="0"}if(!(p.init||g&&d.type!=="feedlive")){p.action.expandPlay();if(p.vData&&p.vData.isPay==1&&p.vData.isOpen==1&&p.vData.isFake!=1){var r=function(b){R.reset({uniqueKey:p.key});a.removeEvent(p.action.media,"canplay",r)};a.addEvent(p.action.media,"canplay",r)}p.init=!0;R.volPlay({uniqueKey:m,muted:!1,paused:!1});p&&!p.preAd&&p.videoRoom.getAttribute("ad-data")&&T.insertAD(p,"pre");var s=o.md5Data({uid:$CONFIG.uid,mid:i,keys:d.keys,type:d.type},o.getUniqueKey(),u);l&&c.request("playstatistics",{},s);if(k&&k.getAttribute("data-mark")){o.sendAnalysisRequest(k,80000008);c.request("adDeal",{},{mid:i,short_url:d.short_url,mark:a.queryToJson(k.getAttribute("data-mark")).mark})}return w.preventDefault(b.evt)}},autoLog:function(b,d,e){var f=w.getMid(b,h),g=w.getFeedNode(b,h),i=o.getAttrData(b,"action-data"),k=i.type==="feedvideo"||i.type==="feedlive";d.play_time=j(0,"yyyy-MM-dd hh:mm:ss").Today.Format;if(!e){var l=o.md5Data({uid:$CONFIG.uid,mid:f,keys:i.keys,type:i.type},o.getUniqueKey(),u);k&&c.request("playstatistics",{},l);if(g&&g.getAttribute("data-mark")){o.sendAnalysisRequest(g,80000008);c.request("adDeal",{},{mid:f,short_url:i.short_url,mark:a.queryToJson(g.getAttribute("data-mark")).mark})}}},outPlay:function(b){if(!b.action.playStatus()||b.action.playStatus()!="nail"){if(b.type==="live")b.action.destroy();else if(b.type==="video"){b.action.thumbnail();b.preAd=null}b.init=!1;z.length>0&&a.inArray(b.key,z)&&(z=m(b.key,z))}},inPlay:function(b,c,d,e){var f=b.action.playStatus();if(!f||f!="ended")if(o.isInAutoClinet(b.top,c,b.domHeight,d)){if(b.type==="live")return;if(y&&y==b.key)return;if(f&&f=="paused"){b.action.toggleEPlay();b.logObj.play_time=j(0,"yyyy-MM-dd hh:mm:ss").Today.Format}else if(f&&f=="nail"&&!b.init){b.logObj.play_time=j(0,"yyyy-MM-dd hh:mm:ss").Today.Format;b.action.expandPlay();if(b.vData&&b.vData.isPay==1&&b.vData.isOpen==1&&b.vData.isFake!=1){var g=function(c){R.reset({uniqueKey:b.key});a.removeEvent(b.action.media,"canplay",g)};a.addEvent(b.action.media,"canplay",g)}T.autoLog(b.videoRoom,b.logObj,b.init)}e.push(b)}else if(f&&f=="playing")if(y&&y==b.key){if(o.isOutClient(b.top,c,b.domHeight,d)){if(b.type==="live"){b.action.destroy();b.init=!1}else b.type==="video"&&b.action.toggleEPlay();y=null;b.key&&!a.inArray(b.key,z)&&z.push(b.key)}}else b.action.toggleEPlay();else f=="loading"&&e.push(b)},insertAD:function(a,b){if(!(!a||!a.adAction||!a.action)){(!a.preAd||a.preAd==b)&&b!="end"&&a.action.playStatus()&&a.action.playStatus()=="playing"&&a.action.toggleEPlay();if(!a.preAd){a.adAction.play(b,!0);a.preAd=b}}},filterAuto:function(b,c,d){var e=[],f,g,h;a.foreach(c,function(a,c){a.action.playStatus()&&a.action.playStatus()=="playing"&&a.action.toggleEPlay();e[c]=o.getOneDomAbsCenter(a.top,b,a.domHeight,d)});g=Math.min.apply(null,e);f=a.core.arr.indexOf(g,e);h=c[f];h&&(x=h.key);h&&!h.preAd&&h.videoRoom.getAttribute("ad-data")?T.insertAD(h,"pre"):h.action.playStatus()&&h.action.playStatus()=="paused"&&h.action.toggleEPlay()},changeStatus:function(){C=a.scrollPos().top;if(!(!g&&z&&z.length<=0)){var b=[],c,d=G&&G.ObjArr;F&&a.foreach(F,function(c,e){var f=d[e];if(!!f)if(!o.isInAuto(c,C,B))T.outPlay(f);else{if(!g||z.length>0&&a.inArray(e,z))return;T.inPlay(f,C,B,b)}});if(b&&b.length===1){x=b[0].key;c=d[x];c&&!c.preAd&&c.videoRoom.getAttribute("ad-data")&&T.insertAD(c,"pre")}b&&b.length>1&&T.filterAuto(C,b,B)}},checkDocHeight:function(){if(!I&&!E){var b=a.pageSize().page.height;if(b==K)return;K=b;T.initVideos();T.changeStatus();d.fire("docChange")}},checkWinHeight:function(){if(E!==!0){B=a.winSize().height;d.fire("resize")}},scroll:function(){if(!E&&!I){I===!1&&(I=!0);T.changeStatus();d.fire("scroll");clearTimeout(J);J=setTimeout(function(){I=!1},50)}},debounce:k.debounce(function(){T.scroll()},300),throttle:k.throttle(function(){T.scroll()},500,600),rAF:k.rAF(function(){T.scroll()}),initPlugins:function(){T.checkWinHeight();T.initVideos();T.changeStatus()},regChannel:function(){for(var a in S)d.register(a,S[a])},desChannel:function(){for(var a in S)d.remove(a,S[a])}},U=function(){T.initPlugins();T.regChannel();D=setInterval(T.checkDocHeight,1e3);a.addEvent(window,"scroll",T.debounce);a.addEvent(window,"resize",T.checkWinHeight);v.add("feed_list_third_rend","click",T.expandPlay);window.__WBH5VideoUtils__=R.initPlugins},V=function(){Q();U()};V();f.destroy=function(){a.removeEvent(window,"scroll",T.debounce);a.removeEvent(window,"resize",T.checkWinHeight);T.desChannel();delete __WBH5VideoUtils__;G&&G.Clear();H&&H.Clear();z=null;x=null;y=null;D&&clearInterval(D);J&&clearInterval(J);v.remove("feed_list_third_rend","click",T.expandPlay);v&&v.destroy();P&&P.destroy&&P.destroy();N&&N.destroy&&N.destroy();$qBtn&&$qBtn.destroy&&$qBtn.destroy();O&&O.destroy&&O.destroy()};return f}}});
STK.register("lib.kit.io.cors",function(a){var b=function(){var a=new XMLHttpRequest;if("withCredentials"in a)return a;typeof XDomainRequest!="undefined"?a=new XDomainRequest:a=null;return a};return function(c){var c=a.parseParam({url:"",timeout:3e4,args:{},onSuccess:null,onError:a.core.func.empty,onTimeout:a.core.func.empty,uniqueID:a.getUniqueKey(),method:"get",asynchronous:!0,header:{},isEncode:!1,formData:"",responseType:"json"},c);if(c.url=="")throw"cors need url in parameters object";var d=b();if(!d)throw new Error("CORS not support!");var e=function(){if(d.readyState==4){var a="";if(c.responseType==="xml")a=d.responseXML;else if(c.responseType==="text")a=d.responseText;else try{d.responseText&&typeof d.responseText=="string"?a=JSON.parse(d.responseText):a={}}catch(b){a=c.url+"return error : data error"}d.status==200?c.onSuccess!=null&&c.onSuccess(a,d):d.status!=0&&c.onError!=null&&c.onError(a,d)}},f=function(){c.onError!=null&&c.onError({},d)},g=function(){c.onTimeout!=null&&c.onTimeout({},d)};d.withCredentials=!0;d.timeout=c.timeout;d.onload=e;d.onerror=f;d.ontimeout=g;var h=c.method.toLocaleUpperCase(),i=a.core.util.URL(c.url,{isEncodeQuery:c.isEncode});i.setParams(c.args);d.open(h,i.toString(),c.asynchronous);try{for(var j in c.header)d.setRequestHeader(j,c.header[j])}catch(k){}h=="POST"&&c.formData?d.send(c.formData):d.send("");return d}});
STK.register("lib.kit.extra.storage",function(a){function h(){return c().clear()}function g(a){return c().removeItem(a)}function f(a){for(var b=c().length-1;b>=0;b--){var e=c().key(b);a(d(e),e)}}function e(a,b,e){var f=d(a);if(f)return f;var g={data:b},h=(new Date).getTime();e?g.expire=h+parseInt(e,10)*1e3:g.expire=null;g=JSON.stringify(g);c().setItem(a,g)}function d(a){var b=c().getItem(a);if(!b)return b;b=JSON.parse(b);var d=b.expire,e=(new Date).getTime();if(d&&d<e){g(a);return null}return b.data?b.data:b}function c(){return b.localStorage}var b=typeof window!="undefined"?window:global;return{get:d,set:e,remove:g,each:f,clearAll:h}});
STK.register("lib.feed.plugins.videos.utils",function(a){var b=document.documentElement,c=document.body,d={domHalf:!1,sensitiveHeight:0,initBuff:600,topHeight:50,count:0,getUniqueKey:function(a){return(a||"H5_")+Math.random().toString(36).substring(5,10)+"_"+ +(new Date)+Math.floor(Math.random()*1e4)+this.count++},hideInput:function(){var b;b=document.getElementById("H5_video_url_input");if(b)return b;b=a.C("input");b.style.cssText="position:absolute;top:-9999px;left:-9999px;";b.id="H5_video_url_input";b.type="text";b.readonly="readonly";a.setStyle(b,"opacity",1);document.getElementsByTagName("body")[0].appendChild(b);return b},sendSuda:function(a,b){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack(a,b)},isJSON:function(a){var b=typeof a=="object"&&Object.prototype.toString.call(a).toLowerCase()=="[object object]"&&!a.length;return b},getAttrData:function(b,c){if(!!b&&!!c){var d=b.getAttribute(c),e=d&&a.queryToJson(d)||!1;return e}},setAttrData:function(b,c,d){var e=this.getAttrData(b,c)||{};e=a.core.json.merge(e,d);b.setAttribute(c,a.jsonToQuery(e))},formateJson:function(a){if(!!this.isJSON(a)){var b=[];for(var c in a)b.push(a[c]);return b.join(";")}},setStyles:function(b,c){a.foreach(c,function(c,d){a.setStyle(b,d,c)})},removeTarget:function(b,c){if(!!a.isArray(c)){var d=a.arrIndexOf(b,c);if(d<0)return;return c.splice(d,1)}},getDocHeight:function(){return Math.max(c.scrollHeight,b.scrollHeight,c.offsetHeight,b.offsetHeight,b.clientHeight)},isOutClient:function(a,b,c,d){var e;e=a-b;return e>=d||e<=0-(c-this.topHeight)?!0:!1},isOutPlayZone:function(a,b,c,d){var e,f;e=a-b;f=this.domHalf&&c?parseInt(c/2):0;return e>=d-f||e<=0-(c-f-this.topHeight)?!0:!1},isInAutoPauseClient:function(a,b,c,d){var e,f;e=a-b;f=this.domHalf&&c?parseInt(c/2):0;return e>=d-c+f+this.sensitiveHeight&&e<=d+f+this.sensitiveHeight||e>=0-c-f-this.sensitiveHeight+this.topHeight&&e<=0-f-this.sensitiveHeight+this.topHeight?!0:!1},isInAutoClinet:function(a,b,c,d){var e,f;e=a-b;f=this.domHalf&&c?parseInt(c/2):0;return e>=0-f-this.sensitiveHeight+this.topHeight&&e<=d-c+f+this.sensitiveHeight?!0:!1},getOneDomCenter:function(a,b,c){var d=a-b,e=c/2;return d+e},getOneDomAbsCenter:function(a,b,c,d){return Math.abs(this.getOneDomCenter(a,b,c)-d/2)},isInBuff:function(a,b,c){var d=a-b;return d>=0-2*this.initBuff&&d<=c+4*this.initBuff?!0:!1},filterAutoVideo:function(b,c,d){var e=[],f,g=this;a.foreach(b,function(a,b){e[b]=g.getOneDomAbsCenter(a.top,c,a.height,d)});f=Math.min.apply(Math,e);return b[a.core.arr.indexOf(f,e)]},CONauto:function(){return $CONFIG&&$CONFIG.isAuto=="1"?false:true}};return d});
STK.register("lib.video.playLog",function(a){return{sendPlayLog:function(b){var c=window.$CONFIG&&window.$CONFIG.islogin&&window.$CONFIG.islogin=="1";!c||a.jsonp({url:"//multimedia.api.weibo.com/2/multimedia/post_log.json",args:{source:"2637646381",data:encodeURIComponent(JSON.stringify(b))},onComplete:function(a){},onTimeout:function(a){}})}}});
STK.register("lib.feed.plugins.videos.video",function(a){var b=a.core.func.empty(),c=a.core.json.merge,d=a.lib.kit.extra.language,e=a.core.util.easyTemplate,f=a.conf.trans.feed.feed,g=a.lib.feed.plugins.videos.utils,h=a.lib.kit.extra.getWantTime,i=a.lib.video.playLog;return function(d){if(!d.sources||!d.container)a.log("video : need src and box and log of the base Class");else{var e,j,k,l,m,n,o,p;e=c({id:g.getUniqueKey("H5_"),obj:"",width:"100%",height:"100%",controls:!0,doubleToFullScreen:!1,extraEvents:!0,container:"",className:["wbv-deployable"],poster:"",sources:"",loop:!1,autoplay:!1,muted:!0,cb:b},d,{isDeep:!0});p={sendPlayLog:function(a){var b=e.obj.logObj,c={uid:b.uid||0,oid:b.object_id||0,mid:b.mid||0,rootmid:b.rootmid||0,rootuid:b.rootuid||0,mid_uid:b.mid_uid||0,timeStamp:+(new Date),mediaType:a,remainingTime:j.remainingTime(),bufferedStarted:j.buffered().start(0),bufferedEnded:j.buffered().end(0),bufferedPercent:j.bufferedPercent(),bufferedEnd:j.bufferedEnd(),supportsFullScreen:j.supportsFullScreen(),isFullscreen:j.isFullscreen(),videoWidth:j.videoWidth(),videoHeight:j.videoHeight(),error:j.error(),errcode:j.error_,currentSrc:j.currentSrc(),readyState:j.readyState(),src:j.src(),currentType:j.currentType(),networkState:j.networkState(),hasStarted:j.hasStarted(),seeking:j.seeking(),currentTime:j.currentTime(),paused:j.paused(),playbackRate:j.playbackRate(),ended:j.ended(),controls:j.controls(),loop:j.loop(),ua:navigator.userAgent,referer:location.href};i.sendPlayLog(c);return c}};k={initMedia:function(){return V(e.id,{container:e.container,width:e.width,height:e.height,controls:!0,extraEvents:!0,doubleToFullScreen:e.doubleToFullScreen,initChildren:!0,children:["mediaLoader","posterImage","loadingSpinner","bigPlayButton","EndDisplay","errorDisplay","controlBar","contextMenu",{name:"copyUrlLayer",copyUrl:e.obj.actionData.short_url}],posterImage:{fallbackImg_:!0,playCount:e.obj.actionData.play_count,duration:e.obj.actionData.duration},controlBar:{children:["playToggle","progressControl","currentTimeDisplay","timeDivider","durationDisplay","fullscreenToggle","logo",{name:"volumePanel",hideVolumeControl:!0}]},className:e.className,poster:e.poster,loop:e.loop,autoplay:e.autoplay,muted:e.muted,sources:e.sources},e.cb)},onListen:function(){if(!!j)for(var a in l)j.on(a,l[a])},offListen:function(){if(!!j)for(var a in l)j.off(a,l[a])}};l={loadstart:function(a){p.sendPlayLog("loadstart");this.firstframe_=!1;this.log_&&(this.log_.firstframe_time=+(new Date).getTime())},loadeddata:function(a){p.sendPlayLog("loadeddata");if(this.log_&&!this.firstframe_){this.log_.firstframe_time=+(new Date).getTime()-this.log_.firstframe_time;this.log_.firstframe_status="success";this.firstframe_=!0}},error:function(a){p.sendPlayLog("error");if(this.log_&&!this.firstframe_){this.log_.firstframe_time=+(new Date).getTime()-this.log_.firstframe_time;this.log_.firstframe_status="error";this.firstframe_=!0}this.log_&&this.firstframe_&&(this.log_.quit_status="error");this.trigger("sendLog");this.trigger("sendHistory");var b=this.error_,c=b.code,d=this.networkState();if(c==4||c==2&&d==1){if(this.errorSrc_)return;this.errorSrc_=!0;this.trigger("resetSrc",{type:"error"})}},abort:function(a){p.sendPlayLog("abort");if(this.log_&&!this.firstframe_){this.log_.firstframe_time=+(new Date).getTime()-this.log_.firstframe_time;this.log_.firstframe_status="cancel";this.firstframe_=!0}this.log_&&this.firstframe_&&(this.log_.quit_status="cancel");this.trigger("sendLog");this.trigger("sendHistory")},canplay:function(a){p.sendPlayLog("canplay");this.log_&&(this.log_.duration=this.duration().toFixed(2));this.errorSrc_=!1;this.trigger("sendLog")},firstplay:function(a){p.sendPlayLog("firstplay");this.trigger("playCount");this.trigger("sendHistory")},play:function(a){p.sendPlayLog("play");if(this.log_){this.log_.play_time=h(0,"yyyy-MM-dd hh:mm:ss").Today.Format;this.log_.startplay_time=(this.currentTime()*1e3).toFixed(0)}this.fixUserActivity(!1)},pause:function(a){p.sendPlayLog("pause");this.log_&&this.firstframe_&&(this.log_.quit_status="not_complete");this.trigger("sendLog");this.trigger("sendHistory");this.reportUserActivity();this.fixUserActivity(!0)},waiting:function(a){p.sendPlayLog("waiting")},replay:function(a){this.trigger("playCount");this.trigger("sendHistory")},ended:function(a){this.log_&&this.firstframe_&&(this.log_.quit_status="complete");this.trigger("sendLog");this.trigger("sendHistory");this.nextReportDelay_=null},timeupdate:function(a){var b=this.currentTime();(Math.floor(b)===3&&this.getValidTime()>1||b>3&&Math.round(b)%30===0&&this.getValidTime()>1)&&this.trigger("sendLog");var c=Math.floor(+(new Date).getTime()/1e3);this.nextReportDelay_&&c!=this.lastSendHistory_&&c==this.lastSendHistory_+this.nextReportDelay_&&this.trigger("sendHistory")},fullscreenchange:function(a){this.trigger("dispatchHidemenu")},dispose:function(a){p.sendPlayLog("dispose");this.trigger("sendLog");this.trigger("sendHistory");this.nextReportDelay_=null;k.offListen();var b=this.id(),c=V.keys_;if(!!c){g.removeTarget(b,c.paused);b==c.play?c.play="":null;V.isAuto_&&c.auto==b?c.auto="":null;delete V.players[b]}},resetSrc:function(a,b){p.sendPlayLog("resetSrc");if(!this.requesting_){this.requesting_=!0;var c,d,e,g,h,i,j,k,l,m,n,o;c=this;j=c.log_;i=c.obj_;h=c.cache_;k=i.actionData;l=k.mid;m=k.objectid;o=c.currentTime();b&&(b.curTime=o);h.vData&&h.vData.isPay&&(n=+h.vData.isOpen);d={object_id:m,mid:l,isOpen:n};e=function(a){var d,e;e=a.data&&a.data.video_size;if(!!e){e=V.mergeOptions(h.vSrcs||{qType:"480"},e);c.trigger("refreshSrcs",e);d=decodeURIComponent(e[e.qType||"fluency"]).replace(/^https?:/,"");if(a.data.infos&&a.data.infos.id==m){h.vData.isOpen=!0;V.setExtend(j,{pay:"l"})}if(b&&b.type!="error"&&!n&&h.vData&&!h.vData.isOpen){c.trigger("hidepaylayer",{action:"success",data:a.data,raw:b});c.requesting_=!1;return}c.src(d);c.ready(function(){this.requesting_=!1;if(h.vData&&h.vData.isPay&&!n)this.trigger("hidepaylayer",{action:"success",data:a.data,raw:b});else{this.currentTime(o);this.play()}},!1)}};g=function(a){h.vData&&h.vData.isPay==1&&!n&&this.trigger("hidepaylayer",{action:"fail",data:a.data,raw:b})};f.request("newVideoUrl",{onSuccess:e,onError:g},d)}}};parseDOM=function(){j=k.initMedia()};n=function(){k.onListen()};o=function(){parseDOM();n()};o();return j}}});
STK.register("lib.feed.plugins.videos.followBtn",function(a){var b=a.conf.trans.follow,c=a.lib.dialog.validateCode(),d={},e,f,g,h,i,j,k;e={initFnick:function(){var a,b;a=function(){return i.createEl("div",{className:"name W_autocut",innerText:this.options_.fnick})};b=V.extend(j,{createEl:a});j.registerComponent("FollowFnick",b)},initBtn:function(){var a,d,e,f;a=function(){k.apply(this,arguments);this.click_=!1};d=function(){this.contentEl_=i.createEl("a",{href:"javascript:void(0);",className:"W_btn_b btn_22px",innerHTML:'<em class="W_ficon ficon_add S_ficon">+</em>关注'},{"suda-uatrack":"key=wb_PC_H5_player&value=video_profile_addatten"});var a=i.createEl("div",{append:this.contentEl_,className:"btn"});a.appendChild(this.contentEl_);return a};e=function(a){var d=this;if(!d.click_){d.click_=!0;var e,f,g,h,j,k;k=this.options_;this.contentEl_.innerHTML="已关注";i.addClass(this.contentEl_,"W_btn_b_disable");i.removeAttribute(this.contentEl_,"suda-uatrack");j={uid:k.uid,fnick:k.fnick,refer_flag:k.refer_flag};e=function(a){};f=function(a){};g=function(a){el_.innerHTML='<em class="W_ficon ficon_add S_ficon">+</em>关注';i.removeClass(el_,"W_btn_b_disable");i.setAttribute(el_,"suda-uatrack","key=wb_PC_H5_player&value=video_profile_addatten");d.click_=!1};h=b.getTrans("follow",{onComplete:function(a,b){var d={onSuccess:e,onError:f,requestAjax:h,param:b,onRelease:g};c.validateIntercept(a,b,d)}});h.request(j)}};f=V.extend(k,{constructor:a,handleClick:e,createEl:d});j.registerComponent("FollowBtn",f)},initAdd:function(){var a,b;a=function(){this.contentEl_=i.createEl("div",{className:"inner"});var a=i.createEl("div",{append:this.contentEl_,className:"add"});a.appendChild(this.contentEl_);return a};b=V.extend(j,{createEl:a});b.prototype.options_={children:["followFnick","followBtn"]};j.registerComponent("FollowAdd",b)},initBox:function(){var a,b,c,d,e,f,g;a=function(a,b){k.apply(this,arguments);this.on(this.player_,"play",e);this.on(this.player_,"pause",f)};b=function(){var a=this.options_;this.portraitEl_=i.createEl("div",{className:"img",innerHTML:"<img src="+decodeURIComponent(a.avatar)+" title="+a.fnick+" class=W_face_radius>"});var b=i.createEl("div",{className:"wbv-add-box wbv-hidden"});b.appendChild(this.portraitEl_);return b};e=function(a){this.show()};f=function(a){this.hide()};c=function(a){this.followAdd.addClass("wbv-add-show");this.followAdd.removeClass("wbv-add-hidden")};d=function(a){this.followAdd.removeClass("wbv-add-show");this.followAdd.addClass("wbv-add-hidden")};g=V.extend(k,{constructor:a,createEl:b,handleMouseEnter:c,handleMouseLeave:d});g.prototype.options_={children:["followAdd"]};j.registerComponent("FollowBox",g)}};f=function(){i=V.dom;j=V.getComponent("Component");k=V.getComponent("ClickableComponent")};g=function(){e.initFnick();e.initBtn();e.initAdd();e.initBox()};h=function(){f();g()};window.V&&h();d={init:function(a,b){!i&&window.V&&h();!window.V||!a||!b||a.addChild("FollowBox",{children:["followAdd"],followAdd:{children:[{name:"followFnick",fnick:b.fnick},{name:"followBtn",fnick:b.fnick,uid:b.uid,refer_flag:b.refer_flag}],fnick:b.fnick},avatar:decodeURIComponent(b.avatar_large),fnick:b.fnick,playerOptions:a.options_.playerOptions})}};return d});
STK.register("lib.feed.plugins.videos.quality",function(a){var b={},c,d,e,f,g,h,i,j;c={initQItem:function(){var b,c,d,e;e=function(b){var c=this,d=c.el_.getAttribute("data-type"),e=c.player_.cache_.vSrcs,f=c.player_.controlBar.getChild("QualityBtn");if(d!=e.qType){var g=e[d],h=c.player_.currentTime();if(d=="1080"&&g){c.player_.pause();h=Math.floor(h);var i=decodeURIComponent(g).replace(/^https?/,"http");i=h?a.URL(i).setHash("w",h).toString():i;window.open(i,"_blank");return}c.player_.src(g);c.player_.ready(function(){this.currentTime(h);this.play();f.removeClass("wbv-quality-"+e.qType);f.addClass("wbv-quality-"+d);e.qType=d;a.foreach(f.menu.children_,function(a,b){a.selected(!1)});c.selected(!0)},!1)}};b=V.extend(j,{handleClick:e});g.registerComponent("QualityItem",b)},initQuality:function(b){var c,d,e,f,h,j,k,l,m=V.getComponent("QualityItem");d=function(){i.apply(this,arguments);var a=this.options_.vSrcs;this.menuButton_.addClass("wbv-control");this.refresh(null,a);this.on("mouseenter",this.pressButton);this.on("mouseleave",this.unpressButton);this.on(this.player_,"refreshSrcs",this.refresh);this.on(this.player_,"pause",this.disable);this.on(this.player_,"play",this.enable)};e=function(){var b=this,c=this.options_.vSrcs,d=a.foreach(["1080","720","480","fluency"],function(a,d){if(!c[a]||c.qType=="fluency"||a=="fluency")return null;var e,f,g;f=a+"p";switch(a){case"1080":e='<em class="W_ficon ficon_video_v3"></em>1080P';break;case"720":e="高清";break;case"480":e="标清";break;case"fluency":e="流畅";f="fluency"}g={"suda-uatrack":"key=wb_PC_H5_player&value=quality_"+f,"data-type":a};var h=new m(b.player_,{selected:c.qType==a?!0:!1,label:e,attrs:g});return h}).filter(function(a){return typeof a!="undefined"||a!=undefined});return d};f=function(b,c){var c=a.foreach(c,function(a,b){return decodeURIComponent(a).replace(/^https?:/,"")});this.player_.cache_.vSrcs=c;return c};h=function(){var a=this.options_.vSrcs;return"wbv-quality-panel "+i.prototype.buildWrapperCSSClass.apply(this)+"wbv-quality-"+a.qType};j=function(){return"wbv-quality-button "};c=V.extend(i,{constructor:d,createItems:e,refresh:f,buildWrapperCSSClass:h,buildCSSClass:j});g.registerComponent("QualityBtn",c)}};d=function(){g=V.getComponent("Component");h=V.getComponent("ClickableComponent");i=V.getComponent("MenuButton");j=V.getComponent("MenuItem")};e=function(){c.initQItem();c.initQuality()};f=function(){d();e()};window.V&&f();b={init:function(a,b){!g&&window.V&&f();if(!(!window.V||!a||!b)){var c=a.getChild("ControlBar");c.addChild("QualityBtn",{vSrcs:b},5)}}};return b});
STK.register("lib.feed.plugins.videos.vplus",function(a){return function(b,c){if(!!b&&!!c){var d={},e,f,g,h,i,j,k,l,m;e={initPayIcon:function(a){if(!a.isFake&&!!a.isPay){var c,d;c=function(){return j.createEl("div",{className:"wbv-pay-icon",innerHTML:"<span></span>"})};d=V.extend(k,{createEl:c});k.registerComponent("PayIcon",d);b.addChild("PayIcon")}},initPayBarTipBtn:function(b){var c,d,e;c=function(){return j.createEl("a",{textContent:this.localize("开通了Ta的专属会员")},{href:"javascript:void(0);"})};d=function(b){var c=this.player_.cache_.vData,d=this.player_.obj_.actionData,e=location.protocol+"//vipclub.weibo.com/vmember/opendetail?vuid="+c.vuid+"&F=video_"+d.objectid;window.open(e,"_blank");var f=this.player_.getChild("PayLayer"),g=this.player_.getChild("BigPlayButton");f&&f.show(b,"click");this.player_.pause();g.hide();c.clicked_=!0;var h=this.player_.id();V.isAuto_&&!a.inArray(h,V.keys_.paused)&&V.keys_.paused.push(h)};e=V.extend(l,{createEl:c,handleClick:d});return k.registerComponent("PayBarTipBtn",e)},initPayBarTip:function(a){if(!a.isFake&&!a.isOpen){var b,c,d,e,f;e=this.initPayBarTipBtn(a);b=function(){k.apply(this,arguments);this.on(this.player_,"timeupdate",this.hideTip_)};d=function(){var a,b=j.createEl("div",{className:"wbv-tip-box"});a=new e(this.player_);this.contentEl_=j.createEl("div",{className:"inner",textContent:this.localize("试看部分视频，")},{},a.el());this.contentEl_.appendChild(document.createTextNode(this.localize("可观看完整视频及Ta的全部付费内容。")));b.appendChild(this.contentEl_);return b};c=function(a){(Math.floor(this.player_.currentTime())===3||this.player_.currentTime()>3)&&this.player_.addClass("wbv-pay-notip")};f=V.extend(k,{constructor:b,createEl:d,hideTip_:c});k.registerComponent("PayBarTip",f);m.addChild("PayBarTip",{},1)}},initPayLayerTip:function(a){var b,c,d;b=function(){return j.createEl("div",{className:"tip W_autocut",textContent:this.localize(a.tip)})};c=function(a){var b;switch(a){case"click":b=this.localize("如果付费成功，可以观看完成视频；如果付费失败，只能试看部分视频。");break;case"end":b=this.localize("试看结束，开通Ta的专属会员可观看Ta的全部付费内容。");break;case"open":b=this.localize("如果付费成功，请点击播放按钮继续观看。");break;case"goto":b=this.localize("请去原博主的微博查看完整视频。");break;default:b=this.localize("试看结束，开通Ta的专属会员可观看Ta的全部付费内容。")}j.textContent(this.el(),b)},d=V.extend(k,{createEl:b,updateText:c});return k.registerComponent("PayLayerTip",d)},initPayLayerBtn:function(){var a,b,c,d;a=function(){var a=j.createEl("div",{},{disabletitle:!0});this.contentEl_=j.createEl("button",{className:this.options_.className,innerHTML:'<span aria-hidden="false" class="wbv-icon-placeholder">'},{});this.controlText_=this.localize(this.options_.controlText_);this.createControlTextEl(this.contentEl_);a.appendChild(this.contentEl_);return a};b=function(a){var b={};switch(a){case"click":b.className="wbv-paylayer-play";b.controlText_=this.localize("继续播放");b.type="goon";break;case"end":b.className="wbv-paylayer-open wbv-paylayer-spe";b.controlText_=this.localize("立即开通");b.type=a;break;case"open":b.className="wbv-paylayer-play";b.controlText_=this.localize("继续播放");b.type=a;break;case"goto":b.className="wbv-paylayer-goto";b.controlText_=this.localize("去原微博");b.type=a;break;default:b.className="wbv-paylayer-open wbv-paylayer-spe";b.controlText_=this.localize("立即开通");b.type=a}this.options_=V.mergeOptions(this.options_,b);this.contentEl_.className=this.options_.className;this.controlText(this.options_.controlText_)};c=function(a){var b=this.options_.type,c=this.player_.cache_.vData,d=this.player_.obj_.actionData,e=this.player_.getChild("PayLayer");if(b=="goto")c.oUrl&&window.open(decodeURIComponent(c.oUrl));else{if(b=="end"){var f=location.protocol+"//vipclub.weibo.com/vmember/opendetail?vuid="+c.vuid+"&F=video_"+d.objectid;window.open(f,"_blank");e.show(a,"open");c.clicked_=!0;return}if(b=="replay"){if(c.clicked_){this.player_.trigger("resetSrc",{type:b});return}e.hide();this.player_.currentTime(0);this.player_.play()}else(b=="goon"||b=="open")&&this.player_.trigger("resetSrc",{type:b})}};d=V.extend(l,{createEl:a,resetBtn:b,handleClick:c});return k.registerComponent("PayLayerBtn",d)},initPayLayerCenter:function(a){var b,c;this.initPayLayerBtn(a);b=function(){var a=j.createEl("div",{className:"btn hv-center"});return a};c=V.extend(k,{createEl:b});c.prototype.options_={children:[{componentClass:"PayLayerBtn",name:"replayBtn",className:"wbv-paylayer-replay",controlText_:"重播",type:"replay"},{componentClass:"PayLayerBtn",name:"secondBtn",className:a.secondClass,controlText_:a.secondText,type:a.type}]};return k.registerComponent("payLayerCenter",c)},initPayLayer:function(a){if(!a.isOpen){var c,d,f,g,h,i={};if(a.isFake){i.tip="请去原博主的微博查看完整视频。";i.secondClass="wbv-paylayer-goto";i.secondText="去原微博";i.type="goto"}else{i.tip="试看结束，开通Ta的专属会员可观看Ta的全部付费内容。";i.secondClass="wbv-paylayer-open wbv-paylayer-spe";i.secondText="立即开通";i.type="end"}this.initPayLayerTip(i);this.initPayLayerCenter(i);c=function(){var a=j.createEl("div",{className:"wbv-pay-layer wbv-hidden"});this.contentEl_=j.createEl("div",{className:"inner"});a.appendChild(this.contentEl_);return a};d=function(a,b){var c=this.getChild("PayLayerTip"),d=this.getChild("PayLayerCenter"),e=d.getChild("secondBtn");c.updateText(b);e.resetBtn(b);k.prototype.show.apply(this,arguments);this.player_.preventDefaultMenu_=!0;if(!this.hasShown_){this.one(this.player_,"hidepaylayer",this.hideLayer);this.hasShown_=!0}};f=function(a){this.player_.off("hidepaylayer");k.prototype.hide.apply(this,arguments);this.hasShown_=!1};h=function(a,b){var c,d,f,g,h,i,j=this.player_.getChild("PayLayer"),k=this.player_.controlBar.getChild("PayBarTip");g=this.player_.cache_.vData;h=this.player_.obj_.actionData;i=!!g.isOpen;d=b.raw.type;f=b.action;c=d=="replay"?0:b.raw.curTime-2;j.hide();this.player_.preventDefaultMenu_=!1;this.player_.currentTime(c);this.player_.play();if(i){this.player_.cache_.vData=null;this.player_.getChild("BigPlayButton").show();this.player_.setFakeDuration(!1);this.player_.duration(this.player_.techGet_("duration"));k&&k.dispose&&k.dispose();j&&j.dispose&&j.dispose();e.offListen()}};g=V.extend(k,{createEl:c,show:d,hide:f,hideLayer:h});g.prototype.options_={children:["PayLayerTip","PayLayerCenter"]};k.registerComponent("PayLayer",g);b.addChild("PayLayer")}},onListen:function(a){if(a.isOpen)b.one("firstplay",f.firstplay);else for(var c in f)b.on(c,f[c])},offListen:function(){for(var a in f)b.off(a,f[a])},initOptions:function(){c.isPay=c.isPay==1;c.isFake=c.isFake==1;c.isOpen=c.isOpen==1?1:0;c=a.parseParam({vuid:"",isPay:"",isOpen:"",isFake:"",oUrl:""},c);return c}};f={firstplay:function(a){var b=this.cache_.vData;if(b.isOpen&&!b.isFake)this.trigger("resetSrc");else{this.duration(parseInt(this.obj_.actionData.duration));this.setFakeDuration(!0)}},play:function(a){var b=this.player_.cache_.vData,c=this.player_.getChild("BigPlayButton");c.show();b.clicked_=!1},ended:function(a){var b,c,d=this.player_.getChild("BigPlayButton"),e=this.player_.getChild("PayLayer");d.hide();c=this.player_.cache_.vData;c.isFake?b="goto":b="end";e.show(a,b)},dispose:function(a){e.offListen()}};g=function(){c=e.initOptions();b.cache_.vData=c;j=V.dom;k=V.getComponent("Component");l=V.getComponent("ClickableComponent");m=b.getChild("ControlBar")};h=function(){e.initPayIcon(c);e.initPayBarTip(c);e.initPayLayer(c);b.addClass("wbv-pay");e.onListen(c)};i=function(){g();h()};i()}}});
STK.register("lib.feed.plugins.videos.ad",function(a){var b=a.lib.kit.extra.language,c=a.conf.trans.feed.feed,d=a.lib.kit.extra.scrollMethod,e=a.lib.feed.plugins.videos.utils,f={},g,h,i,j,k,l,m,n;h={replay:function(b){if(!V.flag_||!V.flag_.fullScreen){var c=this,d=this.obj_.adData;if(!d||!d.fUrl||!d.fCount||!this.obj_.ad)return;setTimeout(function(){c.pause()},200);var e=this.id();V.isAuto_&&!a.inArray(e,V.keys_.paused)&&V.keys_.paused.push(e);this.obj_.ad.trigger("dispatchPlay","pread")}},play:function(b){if(!V.flag_||!V.flag_.fullScreen){var c=this.obj_.adData;if(!c||!c.fUrl||c.type!="pread"||!c.fCount||!this.obj_.ad)return;this.pause();var d=this.id();V.isAuto_&&!a.inArray(d,V.keys_.paused)&&V.keys_.paused.push(d);this.obj_.ad.trigger("dispatchPlay","pread")}},ended:function(a){if(!V.flag_||!V.flag_.fullScreen){var b=this.obj_.adData;if(!b||!b.eUrl||!b.eCount||!this.obj_.ad)return;this.obj_.ad.trigger("dispatchPlay","endad")}},dispose:function(a){g.offListen(this,h)}};i={sendCode:function(a,b){var d,e;d=this.obj_.actionData.mid;b=="pread"?e=this.adData_.fMark:e=this.adData_.eMark;sendData={mid:d,mark:e,type:b};c.request("setAD",{onSuccess:function(){},onFail:function(){},onError:function(){}},sendData)},ended:function(b){var c=this,d=this.adData_,f=this.obj_&&this.obj_.media;if(!!f){this.hide();if(!f)return;var i=f.id();(i==V.keys_.auto||i==V.keys_.play)&&!f.ended()&&f.play();V.isAuto_&&a.inArray(i,V.keys_.paused)&&e.removeTarget(i,V.keys_.paused);V.flag_.layer&&d.type=="pread"&&f.play();this.trigger("adEnded",d.type);!d.eCount&&!d.fCount&&setTimeout(function(){g.offListen(f,h);c.dispose();c.obj_.ad=null;c.obj_.adData=null},100)}},dispatchPlay:function(a,b){var c=this.adData_,d=this.obj_.media;if(!!c){var e,f;if(b=="pread"){e="fCount";f="fUrl"}else{e="eCount";f="eUrl"}if(!c[e]||!c[f])return;this.show();c.type!=b&&this.src(c[f]);this.play();c.type=b;c[e]-=1;this.trigger("sendCode",b)}},dispose:function(a){g.offListen(this,i)}};g={onListen:function(a,b,c){for(var d in b){if(c&&a==c&&d=="play"){a.one(d,b[d]);continue}a.on(d,b[d])}},offListen:function(a,b){for(var c in b)a.off(c,b[c])},initCount:function(){var a,c,e,f,g;a=function(a,b){n.apply(this,arguments);this.countTime_=b.countTime_||this.player_.duration();this.throttledUpdateContent_=d.throttle(V.bind(this,this.updateContent),25);this.on(this.player_,"timeupdate",this.throttledUpdateContent_)};c=function(){var a=m.createEl("div",{className:"wbv-ad-countdown"});this.remainedTime_=5;this.countNode_=m.createEl("em");this.contentEl_=m.createEl("span",{},{},this.countNode_);this.contentEl_.appendChild(document.createTextNode(b("秒后关闭广告")));this.updateTextNode_();a.appendChild(this.contentEl_);return a};e=function(){this.textNode_&&this.countNode_.removeChild(this.textNode_);this.textNode_=document.createTextNode(this.remainedTime_);this.countNode_.appendChild(this.textNode_)};f=function(){var a=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),b=Math.ceil(this.countTime_-a);if(b!==this.remainedTime_){this.remainedTime_=b;this.requestAnimationFrame(this.updateTextNode_)}};g=V.extend(n,{constructor:a,createEl:c,updateTextNode_:e,updateContent:f});n.registerComponent("AdCountDown",g)},initAdData:function(a){var b;b=a.adData;b.fUrl=b.fUrl&&decodeURIComponent(b.fUrl);b.eUrl=b.eUrl&&decodeURIComponent(b.eUrl);b.type=b.fUrl?"pread":"endad";return a},initMedia:function(a){var b,c;c=function(){this.hide();this.obj_=a;this.adData_=a.adData};b=V(a.key+"_ad",{container:a.container,controls:!1,extraEvents:!1,doubleToFullScreen:!1,preventDefaultMenu:!0,initChildren:!0,children:["mediaLoader"],adCountDown:{countTime_:5},controlBar:{children:["volumePanel"],volumePanel:{children:["muteToggle"]}},contextMenu:{children:[]},className:["wbv-ad","wbv-hidden"],loop:!1,autoplay:!1,muted:!0,sources:[{src:a.adData.type=="pread"?a.adData.fUrl:a.adData.eUrl,type:"video/mp4"}]},c);a.ad=b;g.onListen(b,i)}};j=function(){m=V.dom;n=V.getComponent("Component")};k=function(){g.initCount()};l=function(){j();k()};window.V&&l();f={init:function(a,b){!m&&window.V&&l();if(!(!window.V||!a||!b)){b=g.initAdData(b);g.initMedia(b);g.onListen(a,h,a)}}};return f});
STK.register("conf.trans.videoView",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("recommend",{url:"/aj/video/getrecomvideo",method:"post"});c("blogInfo",{url:"/aj/video/getvideomblog",method:"get"});c("videoInfo",{url:"/aj/video/getvideoplay",method:"get"});c("fullText",{url:"/p/aj/mblog/getlongtext",method:"get"});return b});
STK.register("lib.videoview.source.utils",function(a){var b=document.documentElement,c=document.body,d={count:0,getUniqueKey:function(a){return(a||"H5_")+Math.random().toString(36).substring(5,10)+"_"+ +(new Date)+Math.floor(Math.random()*1e4)+this.count++},sendSuda:function(a,b){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack(a,b)},isJSON:function(a){var b=typeof a=="object"&&Object.prototype.toString.call(a).toLowerCase()=="[object object]"&&!a.length;return b},getAttrData:function(b,c){if(!!b&&!!c){var d=b.getAttribute(c),e=d&&a.queryToJson(d)||!1;return e}},setAttrData:function(b,c,d){var e=this.getAttrData(b,c)||{};e=a.core.json.merge(e,d);b.setAttribute(c,a.jsonToQuery(e))},formateJson:function(a){if(!!this.isJSON(a)){var b=[];for(var c in a)b.push(a[c]);return b.join(";")}},toTitleCase:function(a){return typeof a!="string"?a:a.charAt(0).toUpperCase()+a.slice(1)},dimension:function(a,b){var c=0;if(b!=="width"&&b!=="height")throw new Error("dimension only accepts width or height value");if(typeof window.getComputedStyle=="function"){var d=window.getComputedStyle(a);c=d.getPropertyValue(b)||d[b]}c=parseFloat(c);if(c===0){var e="offset"+this.toTitleCase(b);c=a[e]}return c},dimensions:function(a){var b={width:this.dimension(a,"width"),height:this.dimension(a,"height")};return b},setStyles:function(b,c){a.foreach(c,function(c,d){a.setStyle(b,d,c)})},removeTarget:function(b,c){if(!!a.isArray(c)){var d=a.arrIndexOf(b,c);if(d<0)return;return c.splice(d,1)}},getDocHeight:function(){return Math.max(c.scrollHeight,b.scrollHeight,c.offsetHeight,b.offsetHeight,b.clientHeight)},mix:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},bind:function(a,b){var c=function(){b.apply(a,arguments)};return c},create:Object.create||function(a){function b(){}b.prototype=a;return new b},inherits:function(a,b){var c=this.create(b.prototype);a.prototype=c;c.constructor=a;a.super_=b;return a},debounce:function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null;c||a.apply(e,f)},h=c&&!d;clearTimeout(d);d=setTimeout(g,b);h&&a.apply(e,f)}},throttle:function(a,b,c){var d,e=new Date;return function(){var f=this,g=arguments,h=new Date;clearTimeout(d);if(h-e>=c){a.apply(f,g);e=h}else d=setTimeout(a,b)}}};return d});
STK.register("lib.videoview.source.eventemitter",function(a){var b=a.lib.videoview.source.utils,c={add:function(b){if(!!b&&!!b.length){a.isArray(b)||(b=[].concat(b));a.custEvent.define(this,b);this.events_=(this.events_||[]).concat(b);return this}},remove:function(){a.custEvent.remove(this);a.custEvent.undefine(this);this.events_=[]},on:function(b,c,d){a.inArray(b,this.events_)||this.add(b);a.custEvent.add(this,b,c,d);return this},off:function(b,c){a.custEvent.remove(this,b,c);return this},one:function(b,c,d){a.inArray(b,this.events_)||this.add(b);a.custEvent.once(this,b,c,d);return this},fire:function(b,c){a.custEvent.fire(this,b,c);return this}},d=function(a){this.add(a)};b.mix(d.prototype,c);d.extend=function(a,c){var e=typeof a;if(e==="function"){a=b.inherits(a,d);b.mix(a.prototype,c)}else if(e==="object"){c=a;a=new d(c.events_);b.mix(a,c)}return a};return d});
STK.register("conf.trans.forward",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("toMicroblog",{url:"/aj/v6/mblog/forward",method:"post",withDomain:!0});c("setDefault",{url:"/aj/mblog/repost/setdefault",method:"post"});c("simpleForwardLinks",{url:"/aj/v6/mblog/repost/unexpanded",method:"get"});c("detailForwardLinks",{url:"/aj/v6/mblog/repost/small",method:"get"});c("toMicrogroup",{url:"/aj/weiqun/forward",method:"post",withDomain:!0});c("microgroupList",{url:"/aj/weiqun/mylist",method:"get"});c("importMiyou",{url:"/aj/f/closefriendsrecom",method:"get"});c("toMiyouCircle",{url:"/aj/mblog/forwardmiyou",method:"post",withDomain:!0});c("toMiyouCirclev5",{url:"/aj/mblog/forwardmiyou",method:"post"});c("create",{url:"/aj/message/add",method:"post"});c("toPriv_delete",{url:"/aj/message/del",method:"post"});c("toPriv_getMsg",{url:"/aj/message/getmessagedetail",method:"get"});c("getuid",{url:"/aj/message/getuid",method:"get"});c("publisherReEdit",{url:"/p/aj/v6/mblog/edit",method:"post",withDomain:!0});return b});
STK.register("lib.forward.source.API",function(a){var b={checkAtNum:function(a){var b=a.match(/@[a-zA-Z0-9\u4e00-\u9fa5_]{0,20}/g),c=a.match(/\/\/@[a-zA-Z0-9\u4e00-\u9fa5_]{0,20}/g);b=b?b.length:0;c=c?c.length:0;return b-c},preventDefault:function(b){a.core.evt.preventDefault(b);return!1}};return b});
STK.register("lib.forward.plugin.report",function(a){return function(b){window.open("http://weibo.com/complaint/complaint.php?url="+a.lib.kit.extra.parseURL().url);a.core.evt.preventDefault(b.evt);return!1}});
STK.register("lib.kit.extra.toFeedText",function(a){var b=function(a){return/^http\:\/\/(t\.cn|sinaurl\.cn)/.test(a)};return function(c){if(typeof c!="string")throw"[lib.kit.extra.toFeedText]:need string as first parameter";var d=a.core.str.parseHTML(c),e=[],f=!1;for(var g=0,h=d.length;g<h;g+=1)if(!d[g][2])f===!1&&e.push(d[g][0]);else if(d[g][2].toLowerCase()==="img"){var i=d[g][3].match(/(?:alt\s*=\s*["|']?([^"|'|\s]+)["|']?)/),j=d[g][3].match(/(?:brand_face\s*=\s*["|']?([^"|'|\s]+)["|']?)/);j?e.push(j[1]):i&&e.push(i[1])}else if(d[g][2].toLowerCase()==="a")if(d[g][1]==="/")f=!1;else{var k;if((k=d[g][3].match(/(?:ignore\s*=\s*["|']?([^"|'|\s]+)["|']?)/))&&k[1])f=!0;else if((k=d[g][3].match(/(?:alt\s*=\s*["|']?([^"|'|\s]+)["|']?)/))&&k[1]){e.push(" "+k[1]+" ");f=!0}else if((k=d[g][3].match(/(?:href\s*=\s*["|']?([^"|'|\s]+)["|']?)/))&&k[1]&&b(k[1])){e.push(" "+k[1]+" ");f=!0}else if((k=d[g][3].match(/(?:shorthref\s*=\s*["|']?([^"|'|\s]+)["|']?)/))&&k[1]){e.push(" http://t.cn/"+k[1]+" ");f=!0}}return e.join("")}});
STK.register("conf.channel.like",function(a){var b=["like","unlike"];return a.lib.kit.extra.listener.define("conf.channel.like",b)});
STK.register("lib.forward.source.like",function(a){var b=a.lib.kit.extra.language,c=a.conf.trans.feed.attitude,d="icon_praised_bc",e="icon_praised_b",f=function(){var a=document.body.style,b=a.WebkitAnimation!==undefined?"-webkit-":a.webkitAnimation!==undefined?"-webkit-":a.MozAnimation!==undefined?"-moz-":a.OAnimation!==undefined?"-o-":a.msAnimation!==undefined?"-ms-":a.animation!==undefined?"":!1;return!!b}();return function(b){function h(b){function q(b){delete g.loading;a.lib.dialog.ioError(b.code,b)}function p(b){setTimeout(function(){delete g.loading},500);g.likeStatus=!b.data.is_del;if(!n){n=a.C("em");a.insertAfter(n,m)}if(n.innerHTML.indexOf("万")<0){var c=n.innerHTML|0;c=Math.max(0,c+(g.likeStatus?1:-1));n.innerHTML=c===0?"":c}if(!g.animation){if(o)g.likeStatus?a.addClassName(k,"UI_ani_praised"):a.removeClassName(k,"UI_ani_praised");else if(g.likeStatus){a.addClassName(m,d);a.removeClassName(m,e)}else{a.removeClassName(m,d);a.addClassName(m,e)}a.conf.channel.like.fire(g.likeStatus?"like":"unlike",j)}}var g=b.el,h=b.data;if(!g.loading){var i=h.object_type==="comment"?"objLike":"miniadd",j=a.core.json.merge({location:$CONFIG.location},h);g.loading=!0;var k=a.sizzle("[node-type=like_status]",g)[0],l=a.lib.kit.dom.children(k),m=l[0],n=l[1],o=a.core.dom.hasClassName(m,"W_ficon");g.likeStatus===undefined&&(g.likeStatus=!!a.core.dom.hasClassName(k,"UI_ani_praised"));if(!g.likeStatus)if(o){if(f){g.animation=!0;a.removeClassName(k,"UI_ani_praised");a.addClassName(k,"UI_ani_stepsV1");setTimeout(function(){a.removeClassName(k,"UI_ani_stepsV1");a.addClassName(k,"UI_ani_praised");delete g.animation},700)}}else{g.animation=!0;a.addClassName(m,d);a.removeClassName(m,e);a.ui.effect(m,"bounce","200",function(){delete g.animation;if(g.likeStatus){a.addClassName(m,d);a.removeClassName(m,e)}else{a.removeClassName(m,d);a.addClassName(m,e)}})}c.request(i,{onSuccess:p,onError:q,onFail:q},j)}}var g=a.delegatedEvent(b);g.add("forward_like",a.lib.kit.touch.cantouch?"tap":"click",h);return{destroy:function(){g.destroy()}}}});
STK.register("lib.forward.source.forwardLink",function(a){var b=a.lib.kit.extra.language,c=a.conf.trans.forward,d=a.lib.kit.dom.parseDOM,e=a.lib.kit.extra.actionData,f,g={on:b('#L{收起}<span class="W_arrow" title="#L{收起}" href="javascript:;" onclick="return false;" action-type="show" action-data="id=2"><em>◆</em></span>'),off:b('#L{展开}<span class="W_arrow" title="#L{展开}" href="javascript:;" onclick="return false;" action-type="show" action-data="id=1"><em>◆</em></span>'),loading:b('<div class="WB_empty" node-type="loading"><div class="WB_innerwrap"><div class="empty_con clearfix"><p class="text"><i class="W_loading"></i>#L{正在加载,请稍候}</p></div> </div></div>')},h;return function(b,i){h=b;var j=i.flNode,k=i.mid,l=i.data,m={},n,o,p,q=!1,r,s,t=a.parseParam({forward_link_status:"on",inDialog:!0,mid:""},l);if(typeof t.mid!="string"&&typeof t.mid!="number")throw new Error("forward.forwardLlink: need string (or number) as mid");var u=function(b){r=r||d(a.builder(f).list);if(!!r.forward_link_more){b.el.innerHTML=g[o];if(o=="on"){r.forward_link_more.style.display="";a.addClassName(b.el,"W_arrow_turn");e(b.el).set("id","2");r.check_more_link&&(r.check_more_link.style.display="")}else if(o=="off"){r.forward_link_more.style.display="none";a.removeClassName(b.el,"W_arrow_turn");e(b.el).set("id","1");r.check_more_link&&(r.check_more_link.style.display="none")}}},v=function(){q=!0;c.request("detailForwardLinks",{onSuccess:function(b,c){var d=a.sizzle('[node-type="loading"]',j)[0];d&&a.removeNode(d);a.custEvent.fire(h,"resetComment",[b]);if(!b.data.num)a.removeNode(f.parentNode);else{o=o=="on"?"off":"on";f.innerHTML=b.data.html||"";a.custEvent.fire(h,"updateNum",[b.data]);w(f)}},onError:function(){f.innerHTML=""},onFail:function(){f.innerHTML=""}},{mid:k,d_expanded:p,expanded_status:q?o==="on"?1:2:""})},w=function(b){var c=a.sizzle("div.list_ul",b)[0];if(!!c){c.style.marginTop=-a.core.dom.getSize(c).height+"px";setTimeout(function(){c.style.webkitTransition="margin-top 0.4s";c.style.mozTransition="margin-top 0.4s";c.style.msTransition="margin-top 0.4s";c.style.transition="margin-top 0.4s";c.style.marginTop="0px"},0)}},x=function(b){var c=a.core.dom.dir.parent(b.el,{expr:'[node-type="forward_link_item"]'})[0],d=b.data,e,f,g,i;if(c){e=a.sizzle('[node-type="forward_again"]',c)[0];i=d.name;if(e){var j="//@"+i+": "+a.trim(e.innerHTML.replace(/[\r|\n|\t]/g,""));a.custEvent.fire(h,"forwardAgain",[d,j])}}},y=function(){f=a.C("div");f.className="list_box";s=a.delegatedEvent(f);j.innerHTML=g.loading;j.appendChild(f);s.add("show","click",function(a){o=a.data.id*1==1?"on":"off";switch(t.forward_link_status){case"off":v(a);break;case"on":default:u(a)}});s.add("forward_again","click",x);p=a.core.util.storage.get("forward_link_status");if(p=="null"||!p)p=t.forward_link_status;o=p;v()};a.custEvent.define(m,["switch"]);a.custEvent.add(m,"switch",function(a,b){if(b.node){var c=f.innerHTML;b.node.innerHTML="";b.node.appendChild(f);f.innerHTML=c}b.base&&(h=b.base)});m.destroy=function(){s.destroy();a.custEvent.undefine(m);a.removeNode(f);f=null};if(f&&t.forward_link_status==n){n=t.forward_link_status;j.innerHTML="";j.appendChild(f)}else y();return m}});
STK.register("lib.image.commentImage",function(a){function f(b){if(!a.contains(document.body,b))return!1;while(b&&b.style){if(a.getStyle(b,"display")==="none")return!1;b=b.parentNode}return!0}var b=a.lib.kit.extra.language,c={width:120,height:120},d=new RegExp(["^",b("#L{回复}"),"@([^:]*):$"].join("")),e="loading";return function(g,h,i){function u(){}function t(a){j&&j.removeAttribute("pid");var c,d=!1;if(a.type=="singleError")if(a.data.sourceData&&a.data.sourceData.code=="A20001")c=b("#L{图片格式错误, 请重新上传}");else{c=b("#L{图片上传失败}");d=!0}if(a.type=="fileNumErr")return 0;a.type=="fileSizeErr"&&(c=b("#L{图片大于20M, 请选择小于20M的图片}"));a.type=="defaultErr"&&(c=b("#L{图片格式错误, 请重新上传}"));if(c){m.getDomList().inner.innerHTML=b('<div class="opt"><span class="txt">'+c+"</span>"+(d?'<a href="javascript:void(0)" action-type="retry" action-data="fid='+a.fid+'" class="W_btn_b">#L{重传}</a>':"")+"</div>");q(m,h)}}function s(f){if(o=="gif"){var g;g=b("#L{评论暂不支持gif图}");m.getDomList().inner.innerHTML=b('<div class="opt"><span class="txt">'+g+"</span>"+'<a href="javascript:void(0)"  action-type="sure" class="W_btn_b">#L{确定}</a>'+"</div>");q(m,h);if(k){k.resetFileNum(1);k.resetUploadedFileNum(0)}}else{var l=f.fid,n=f.data.pid,p=a.lib.kit.extra.imageURL(n,{size:"thumbnail"});if(k){k.resetFileNum(1);k.resetUploadedFileNum(0)}if(j&&j.getAttribute("pid")===e){j.setAttribute("pid",n);m.getState()||m.show();var r=new Image;r.onload=function(){r.onload=null;var a=r.width,b=r.height,d=a,e=b;if(a>c.width){d=c.width;e=c.width/a*b}if(e>c.height){e=c.height;d=c.height/b*a}r.width=d;r.height=e;m.getDomList().inner.innerHTML="";m.getDomList().inner.appendChild(r);q(m,h)};r.src=p;var s=j.value;s==i.placeholder&&(s="");if(s==""||d.test(a.trim(s)))j.value=s+i.emptyText}}}function r(){j&&j.setAttribute("pid",e);a.fireEvent(document.body,"click");m.getDomList().inner.innerHTML='<i class="W_loading"></i>';m.getState()||m.show();q(m,h);n=arguments[0].data[0].name;var c=function(a){var a=a||"",b=a.split(".");return b.length>1?b[b.length-1]:""};o=c(n);if(o!="gif"&&o!="png"&&o!="jpg"&&o!="jpeg"){var d;d=b("#L{图片上传失败}");m.getDomList().inner.innerHTML=b('<div class="opt"><span class="txt">'+d+"</span>"+'<a href="javascript:void(0)" action-type="retry" class="W_btn_b">#L{重传}</a>'+"</div>");q(m,h);p=!0;if(k){k.resetFileNum(1);k.resetUploadedFileNum(0)}}}function q(a,b){if(a.getState()){var c=a.getBox().parentNode,d=c&&a.getBox().nextSibling;a.setArrow("top").setAlignPos(b,j,{offset:{left:-1,top:2}});d&&c.insertBefore(a.getBox(),d)}}if(!!h){i=i||{};i.placeholder=i.placeholder||"";i.emptyText=i.emptyText||b("#L{图片评论}");var j=g.nodeList.textEl,k,l,m=a.ui.bubble({showWithAni:"fadeInDown:fast",hideWithAni:"fadeOutUp:fast"});m.getDomList().inner.className="layer_WB_pic S_bg1";var n,o,p=!1;m.on("hide",function(){clearInterval(l);j&&j.removeAttribute("pid")});m.on("show",function(){l=setInterval(function(){if(f(h))q(m,h);else{clearInterval(l);m.hide()}},500)});m.on("retry","click",function(a){if(p){p=!1;m.hide()}else{var b=a.data.fid;m.getDomList().inner.innerHTML='<i class="W_loading"></i>';j&&j.setAttribute("pid",e);k&&k.reuploadById(b)}});m.on("sure","click",function(a){m.hide()});k=a.lib.image.mUpload(h,{w:20,h:20,uploading:r,uploaded:s,error:t,extra:u,number:1,type:"*.png;*.jpg;*.jpeg;",file_source:i.file_source||0});return{hideLayer:function(){m.hide()},destroy:function(){m&&m.destroy();k&&k.destroy();m=k=null},isShow:function(){return m?m.getState():!1}}}}});
STK.register("lib.image.pastePic",function(a){var b=a.lib.kit.extra.language,c={width:120,height:120},d=new RegExp(["^",b("#L{回复}"),"@([^:]*):$"].join("")),e="loading";return function(f,g,h){function p(b){var f=b.fid,i=b.data.pid,k=a.lib.kit.extra.imageURL(i,{size:"thumbnail"});if(j&&j.getAttribute("pid")===e){j.setAttribute("pid",i);l.getState()||l.show();var m=new Image;m.onload=function(){m.onload=null;var a=m.width,b=m.height,d=a,e=b;if(a>c.width){d=c.width;e=d/a*b}if(e>c.height){e=c.height;d=e/b*a}m.width=d;m.height=e;l.getDomList().inner.innerHTML="";l.getDomList().inner.appendChild(m);n(l,g)};m.src=k;var o=j.value;if(o==""||d.test(a.trim(o)))j.value=o+h.emptyText}}function o(){j&&j.setAttribute("pid",e);a.fireEvent(document.body,"click");l.getDomList().inner.innerHTML='<i class="W_loading"></i>';l.getState()||l.show();n(l,g)}function n(a,b){if(a.getState()){var c=a.getBox().parentNode,d=c&&a.getBox().nextSibling;a.setArrow("top").setAlignPos(b,j,{offset:{left:-1,top:2}});d&&c.insertBefore(a.getBox(),d)}}function m(b){if(!a.contains(document.body,b))return!1;while(b&&b.style){if(a.getStyle(b,"display")==="none")return!1;b=b.parentNode}return!0}var i=[],h=h||{};h.emptyText=h.emptyText||b("#L{图片评论}");var j=f.nodeList.textEl,k,l=a.ui.bubble({showWithAni:"fadeInDown:fast",hideWithAni:"fadeOutUp:fast"});l.getDomList().inner.className="layer_WB_pic S_bg1";l.on("hide",function(){clearInterval(k);j&&j.removeAttribute("pid")});l.on("show",function(){k=setInterval(function(){if(m(g))n(l,g);else{clearInterval(k);l.hide()}},500)});var q=function(b){var c=b.clipboardData||window.clipboardData,d,e,f;if(c&&!c.getData("text")){d=c.items;if(!d)return;f=d[0];e=c.types||[];for(var g=0;g<e.length;g++)if(e[g]==="Files"){f=d[g];break}if(f&&f.kind==="file"&&f.type.match(/^image\//i)){var h=f.getAsFile(),j=new FileReader;j.onload=function(b){var c=a.getUniqueKey();o();i[c]=a.lib.kit.extra.upload({type:"base64",imgName:"img_"+c,base64Str:b.target.result.split(",")[1]});a.custEvent.add(i[c],"uploadSucc",function(a,b){p({data:b,fid:c})})};j.readAsDataURL(h)}}};a.addEvent(j,"paste",q);return{hideLayer:function(){l.hide()},destroy:function(){h=h&&null;l=l&&null;i=i&&[]},isShow:function(){return l?l.getState():!1}}}});
STK.register("lib.forward.source.toMicroblog",function(a){var b=a.lib.kit.extra.language,c=a.lib.kit.extra.toFeedText,d=a.lib.kit.extra.textareaUtils,e=a.lib.kit.extra.shine,f=a.lib.kit.dom.parseDOM,g=null,h,i=a.lib.dialog.validateCode(),j=b('<#et userlist data><div node-type="toMicroblog_client"><#if (data.isDialog == true)><div class="WB_text S_bg1" node-type="content"><#if (data.showArrow == true)><a href="javascript:void(0);" action-type="origin_all" class="W_ficon ficon_arrow_down_lite S_ficon">g</a></#if><span class="con S_txt2">${data.content}</span></div></#if><div class="WB_feed_repeat forward_rpt1"><div class="WB_repeat"><div class="WB_feed_publish clearfix"><div class="WB_publish"><div class="p_input p_textarea"><textarea class="W_input" name="" rows="" cols="" title="#L{转发微博}#L{内容}" node-type="textEl" pubType="forward" >${data.reason}</textarea><span class="tips S_txt2" node-type="num"></span><div class="send_succpic" node-type="success_tip" style="display:none"><span class="W_icon icon_succB"></span><span class="txt">#L{发布成功}</span></div></div><div class="p_opt clearfix"><div class="btn W_fr" ><div class="limits" style="position:relative;" layout-shell="true"><#if (data.isReEdit)><a action-data="rank=0" title="" class="S_ficon_dis" href="javascript:void(0)"  node-type="showPublishTo" title=#L{公开-你发表的微博可以被大家公开查看哦}><span class="W_autocut" node-type="publishTotext">${data.showRange}</span> <i class="W_ficon ficon_arrow_down S_ficon_dis" node-type="publish_to_arrow">c</i></a><#else><a action-data="rank=0" title="" class="S_txt1" href="javascript:void(0)" action-type="showPublishTo" node-type="showPublishTo" title=#L{公开-你发表的微博可以被大家公开查看哦}><span class="W_autocut" node-type="publishTotext">#L{公开}</span> <i class="W_ficon ficon_arrow_down S_ficon_dis" node-type="publish_to_arrow">c</i></a></#if></div><#if (data.isReEdit )><a href="javascript:void(0)" node-type="submit" action-data="reEdit=1" class="W_btn_a">#L{发布}</a><#else><a href="javascript:void(0)" node-type="submit" class="W_btn_a">#L{转发}</a></#if></div><div class="opt clearfix" test=1 node-type="widget"><span class="ico"><a href="javascript:void(0)" title="#L{表情}" node-type="smileyBtn"><i class="W_ficon ficon_face">o</i></a><a href="javascript:void(0);" title="#L{图片}" node-type="imgBtn"><i class="W_ficon ficon_image">p</i></a></span><ul class="ipt" node-type="cmtopts"><#if (!data.isReEdit && data.forwardNick)><li node-type="forwardLi" class="W_autocut"><label for="${data.forwardLiID?data.forwardLiID:"forward_comment_opt_forwardLi"}" class="W_label"><input node-type="forwardInput" name="" type="checkbox" value="" class="W_checkbox" id="${data.forwardLiID?data.forwardLiID:"forward_comment_opt_forwardLi"}"><span>#L{同时评论给} ${data.forwardNick}</span></label></li></#if><#if (!data.isReEdit && data.originNick)><li node-type="originLi" class="W_autocut"><label for="${data.originLiID?data.originLiID:"forward_comment_opt_originLi"}" class="W_label"><input node-type="originInput" name="" type="checkbox" value="" class="W_checkbox" id="${data.originLiID?data.originLiID:"forward_comment_opt_originLi"}"><span><#if (data.forwardNick)> #L{同时评论给原文作者} <#else>#L{同时评论给}</#if> ${data.originNick}</span></label></li></#if></ul></div></div></div></div><#if (data.isDialog == true)><div node-type="forward_link" class="repeat_list S_line1"></div></#if></div></div></#et>'),k={notice:"#L{请输入转发理由}",defUpdate:"#L{转发微博}",netError:"#L{系统繁忙}",success:"#L{转发成功}!",off:"#L{关闭}",on:"#L{开启}"},l={limitNum:140,tipText:b(k.notice),count:"disable"},m=function(a,c){c=="normal"?a.innerHTML=b("#L{转发}"):c=="reEdit"?a.innerHTML=b("#L{发布}"):c=="reEditLoading"?a.innerHTML=b('<i class="W_loading"></i>#L{发布中...}'):a.innerHTML=b('<i class="W_loading"></i>#L{转发中...}')};return function(n,o,p){if(n==null||o==null)throw new Error("[common.forward.toMicroblog]Required parameter client is missing");var q,r=p.data,s=56,t=!1,u=r.originNick?"@"+r.originNick:"",v=c(r.origin.replace(/<[^>]+>/gi,""));v=a.trim(v);r.content=v+"";if(a.bLength(a.core.str.decodeHTML(c(v+u)))>s){r.content=a.leftB(v,s-a.bLength(u))+"...";t=!0}else r.content=r.origin;u?u='<a class="S_txt1" href="//weibo.com/'+(r.domain||r.rootuid||r.uid)+'" target="_blank">'+u+"</a>:":u="";r.content=u+r.content;var w=a.trim(r.reason||""),x=r.forwardNick?"//@"+r.forwardNick+":"+" ":"",y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N=!1,O=!1,P,Q,R=a.lib.forward.source.API,S,T,U,V,W={};W.client=n;W.opts=p.data||{};W.isInit=!1;A=a.parseParam({appkey:"",styleId:"1",mark:"",module:"",page_module_id:"",refer_sort:"",pic_src:"",extra:"",isReEdit:!1,dissDataFromFeed:{}},W.opts);a.custEvent.define(W,["forward","hide","center","count","updateNum","forwardAgain","resetComment"]);var X=function(){if(B)C==="error"&&a.lib.kit.extra.shine(z.textEl);else{var c=a.trim(y.API.getWords()||"");c===b(k.notice)&&(c="");B=!0;C="loading";z.submit.className="W_btn_a W_btn_a_disable";m(z.submit,r.isReEdit?"reEditLoading":"loading");var d={};d.pic_src=A.pic_src;d.pic_id=z.textEl.getAttribute("pid");d.appkey=A.appkey;d.mid=o;d.style_type=A.styleId;d.mark=A.mark;d.reason=c||b(k.defUpdate);d.location=$CONFIG.location;d.pdetail=$CONFIG.page_id;d.module=A.module;d.page_module_id=A.page_module_id;d.refer_sort=A.refer_sort;z.originInput&&z.originInput.checked&&(d.is_comment_base="1");if(z.forwardInput&&z.forwardInput.checked){d.is_comment="1";N=!0}!z.forwardInput&&d.is_comment_base=="1"&&(N=!0);S&&S.disable();if(S){var e=S.rank();d.rank=e.rank;d.rankid=e.rankid}d=a.lib.kit.extra.getDiss(d,z.submit);d=a.core.json.merge(d,A.dissDataFromFeed);p.mark&&(d.mark=p.mark);if(r.postdata){var f=r.postdata.split(";");for(var h=0;f[h];h++){var i=f[h].split(",");i[0]&&i[0]&&(d[i[0]]=i[1])}}g=d;d.isReEdit=r.isReEdit;if(R.checkAtNum(c)>5){a.ui.confirm(b("#L{单条微博里面@ 太多的人，可能被其它用户投诉。如果投诉太多可能会被系统封禁。是否继续转发？}"),{OK:function(){if(r.isReEdit){d.text=d.reason;delete d.reason;L.request(d)}else D.request(d)},cancel:function(){B=!1;C="";z.submit.className="W_btn_a btn_noloading";r.isReEdit?m(z.submit,"reEdit"):m(z.submit,"normal")}});return}A.extra&&(d.ref=A.extra);if(r.isReEdit){d.text=d.reason;delete d.reason;L.request(d)}else D.request(d)}},Y=function(a){if((a.keyCode===13||a.keyCode===10)&&a.ctrlKey){y.API.blur();X()}},Z=function(){var a=y.API.count(),b=l.limitNum-a,c=b>=0?!0:!1;if(c){B=!1;C="";c&&(z.num.innerHTML="<span>"+b+"</span>")}else{B=!0;C="error";z.num.innerHTML='<span class="S_error">'+b+"</span>"}},_=function(b,c){y.API.blur();z.success_tip.style.display="";var d=a.sizzle(".W_icon",z.success_tip)[0],e=a.sizzle(".txt",z.success_tip)[0];e.style.display="none";a.ui.effect(d,"flipInY","normal");setTimeout(function(){e.style.display="";a.ui.effect(e,"fadeInRight","normal")},50);c.isReEdit=r.isReEdit;y.API.reset();U&&U.hideLayer();V&&V.hideLayer();ba(b,c);setTimeout(function(){B=!1;C="";g=null;z.submit.className="W_btn_a btn_noloading";m(z.submit,c.isReEdit?"reEdit":"normal");try{b.data.mid=c.mid;b.data.isComment=N;b.data.isToMiniBlog=!0;if(!r.isReEdit){a.custEvent.fire(W,"forward",[b.data,c,p.inDialog]);a.conf.channel.feed.fire("forward",[b.data,c,p.inDialog])}}catch(d){}a.custEvent.fire(W,"hide");N=!1;S&&S.reset();a.ui.effect(z.success_tip,"fadeOut","fast",function(){z&&z.success_tip&&(z.success_tip.style.display="none")})},1e3)},ba=function(b,c){if(!!c.isReEdit){if(!b.data.html)return;var d=a.sizzle('[mid="'+c.mid+'"]'),e=a.sizzle('[node-type="feed_content"]',d[0]);d[0]&&e[0]&&a.replaceNode(a.builder(b.data.html).list.feed_content[0],e[0])}},bb=function(c,d){B=!1;C="";z.submit.className="W_btn_a btn_noloading";m(z.submit,r.isReEdit?"reEdit":"normal");c.msg=c.msg||b(k.netError);N=!1;S&&S.enable();c.data&&c.data.close&&a.custEvent.fire(W,"hide");a.lib.dialog.ioError(c.code,c)},bc=function(b,c){B=!1;C="";z.submit.className="W_btn_a btn_noloading";m(z.submit,r.isReEdit?"reEdit":"normal");S&&S.enable();a.lib.dialog.ioError(b.code,b)},bd=function(){H=a.builder(n);H=a.lib.kit.dom.parseDOM(H.list).toMicroblog_client;y=a.lib.editor.base(H,l);z=y.nodeList;y.API=y.editor.API;a.custEvent.define(y.editor,"close");T=a.lib.publisher.widget.face(y.editor);U=a.lib.image.commentImage(y.editor,z.imgBtn,{file_source:2});V=a.lib.image.pastePic(y.editor,z.imgBtn);S=a.lib.publisher.source.publishTo({editorWrapEl:n,textEl:z.textEl,isforward:!0});a.addEvent(z.textEl,"focus",function(){P=setInterval(function(){try{Z()}catch(a){}},200)});a.addEvent(z.textEl,"blur",function(){clearInterval(P)});r.isReEdit?y.API.insertText(a.core.str.decodeHTML(c(a.trim(w)))):y.API.insertText(x+a.trim(a.core.str.decodeHTML(c(w))));a.lib.kit.dom.autoHeightTextArea({textArea:z.textEl,maxHeight:145,inputListener:a.funcEmpty});if(!r.isReEdit&&M){q=a.lib.forward.source.like(H);h=a.lib.forward.source.forwardLink(W,{flNode:z.forward_link,mid:o,data:A})}},be=function(){a.addEvent(z.submit,"click",X);a.lib.kit.extra.keySubmit.on(z.textEl,X);a.addEvent(z.smileyBtn,"click",T.show);if(M){K=a.delegatedEvent(H);K.add("origin_all","click",function(a){z.content.innerHTML='<span class="con S_txt2">'+u+r.origin+"</span>"});K.add("report","click",function(b){return a.lib.forward.plugin.report(b)});K.add("switch","click",function(c){var d={1:"on",2:"off"},e=d[c.data.id];setSwitchStatus(e);a.setStyle(c.el,"left",e=="on"?"23px":"0px");c.el.setAttribute("action-data",e=="on"?"id=2":"id=1");c.el.setAttribute("title",e=="on"?b(k.off):b(k.on))});K.add("show","click",function(a){J=a.data.id*1==1?"on":"off";getForwardInfo_more(a)});K.add("forward_again","click",bl)}},bf=function(b,g,h){w=h;y.API.reset();y.API.insertText(a.trim(a.core.str.decodeHTML(c(w))),0);d.setCursor(z.textEl,0,0);e(z.textEl);A=a.parseParam(A,g);o=g.mid;r=$merge(r,g);g.forwardNick=g.name;g.originNick=g.rootname;z.cmtopts.innerHTML=a.core.util.easyTemplate(bk,g).toString();z=$merge(z,f(a.builder(z.cmtopts).list))},bg=function(a,b){if(z.cmtopts&&b.data.permission&&b.data.permission.allowComment==0){z.cmtopts.style.display="none";z.cmtopts.innerHTML=""}else if(z.originLi&&b.data.permission&&b.data.permission.allowRootComment==0){z.originLi.style.display="none";z.originLi.innerHTML=""}},bh=function(){a.custEvent.add(W,"forwardAgain",bf);a.custEvent.add(W,"resetComment",bg)},bi=function(a,b){J=J=="on"?"off":"on"},bj=function(b){a.lib.dialog.ioError(b.code,b)},bk=b('<#et cmt data><#if (data.forwardNick)><li node-type="forwardLi" class="W_autocut"><label class="W_label" for="forward_comment_opt_forwardLi"><input id="forward_comment_opt_forwardLi" type="checkbox" node-type="forwardInput" class="W_checkbox"  /><span>#L{同时评论给} ${data.forwardNick}</span></label></li></#if><#if (data.originNick)><li node-type="originLi" class="W_autocut"><label class="W_label" for="forward_comment_opt_originLi"><input id="forward_comment_opt_originLi" type="checkbox" node-type="originInput" class="W_checkbox" /><span><#if (data.forwardNick)>#L{同时评论给原文作者} <#else>#L{同时评论给} </#if>${data.originNick}</span></label></li></#if>'),bl=function(b){var d=a.core.dom.dir.parent(b.el,{expr:"dl"})[0],e=b.data,f,g,h,i;if(d){f=a.sizzle('em[node-type="forward_again"]',d)[0];i=e.name;if(f){w="//@"+i+": "+a.trim(f.innerHTML.replace(/[\r|\n|\t]/g,""));y.API.reset();y.API.insertText(a.trim(a.core.str.decodeHTML(c(w))),0);a.lib.kit.extra.textareaUtils.setCursor(z.textEl,0,0);a.lib.kit.extra.shine(z.textEl);A=a.parseParam(A,e);o=e.mid;e.forwardNick=e.name;e.originNick=e.rootname;r=a.lib.kit.extra.merge(r,b.data);z.cmtopts.innerHTML=a.core.util.easyTemplate(bk,e).toString();z=a.lib.kit.extra.merge(z,a.lib.kit.dom.parseDOM(a.builder(z.cmtopts).list))}}},bm=function(){D=a.conf.trans.forward.getTrans("toMicroblog",{onComplete:function(a,b){var c={onSuccess:_,onError:bb,requestAjax:D,param:g,onRelease:function(){B=!1;C="";z.submit.className="W_btn_a btn_noloading";m(z.submit,"normal");N=!1;S&&S.enable()}};i.validateIntercept(a,b,c)},onFail:bc,onTimeout:bb});L=a.conf.trans.forward.getTrans("publisherReEdit",{onComplete:function(a,b){var c={onSuccess:_,onError:bb,requestAjax:L,param:g,onRelease:function(){B=!1;C="";z.submit.className="W_btn_a btn_noloading";m(z.submit,"reEdit");N=!1;S&&S.enable()}};i.validateIntercept(a,b,c)},onFail:bc,onTimeout:bb});E=function(b){a.conf.trans.forward.request("setDefault",{onSuccess:bi,onError:bj,onFail:bj},b)}},bn=function(){},bo=function(){bm();bd();be();bn();bh()},bp=function(b){if(W.isInit==!1){p.data.isDialog=b;M=b;p.data.showArrow=t;p.data.visible==1?p.data.showRange="自己可见":p.data.visible==6?p.data.showRange="好友圈":p.data.visible==8?p.data.showRange="群组":p.data.showRange="公开";p.data.forwardLiID="forward_comment_opt_forwardLi"+a.core.util.getUniqueKey();p.data.originLiID="forward_comment_opt_originLi"+a.core.util.getUniqueKey();a.addHTML(n,a.core.util.easyTemplate(j,p.data));y||bo();W.isInit=!0}else{H&&a.setStyle(H,"display","");h&&a.custEvent.fire(h,"switch",[{node:z.forward_link,base:W}])}y.API.focus(0);if(r.isReEdit){a.lib.kit.extra.textareaUtils.setCursor(z.textEl);y.API.cacheCurPos()}},bq=function(){a.lib.kit.extra.shine(y.nodeList.textEl)},br=function(){y.API.blur();H!=null&&a.setStyle(H,"display","none")},bs=function(){a.removeEvent(z.submit,"click",X);a.lib.kit.extra.keySubmit.off(z.textEl,X);a.custEvent.undefine(W);K&&K.remove("origin_all","click");K&&K.remove("report","click");K&&K.remove("switch","click");K&&K.remove("retry","click");K&&K.remove("show","click");K.destroy();K=null;h&&h.destroy&&h.destroy();i&&i.destroy&&i.destroy();S&&S.destroy&&S.destroy();q&&q.destroy&&q.destroy();U&&U.destroy();V&&V.destroy();y.closeWidget();P&&clearInterval(P);y=null;z=null;D=null;H=null;for(var b in W)delete W[b];W=null};W.show=bp;W.hide=br;W.shine=bq;W.destroy=bs;return W}});
STK.register("lib.forward.source.toFriends",function(a){var b=a.lib.kit.extra.language,c=a.lib.editor.base,d=a.lib.publisher.widget.face,e=a.lib.kit.dom.autoHeightTextArea,f=a.lib.kit.extra.shine,g=a.lib.kit.extra.merge,h=a.lib.kit.extra.textareaUtils,i=a.conf.channel.feed,j=a.lib.kit.dom.parseDOM,k=a.conf.trans.forward,l=a.lib.forward.source.API,m=a.lib.kit.extra.report,n=a.lib.kit.extra.toFeedText,o=a.lib.kit.extra.getDiss,p=a.lib.dialog.ioError,q=a.lib.forward.source.forwardLink,r=null,s=a.lib.dialog.validateCode(),t=b('<#et userlist data><div node-type="toFriends_client"><div class="W_tips tips_warn clearfix"><p class="icon"><i class="W_icon icon_warnS"></i></p><p class="txt">将微博定向转发到好友圈，只有你的好友可见这条微博。</p></div><div class="WB_text S_bg1" node-type="content"><#if (data.showArrow == true)><a href="javascript:void(0);" action-type="origin_all" class="W_ficon ficon_arrow_down_lite S_ficon">g</a></#if><span class="con S_txt2">${data.content}</span></div><div class="WB_feed_repeat forward_rpt1"><div class="WB_repeat"><div class="WB_feed_publish clearfix"><div class="WB_publish"><div class="p_input p_textarea"><textarea class="W_input" name="" rows="" cols="" title="#L{转发微博}#L{内容}" node-type="textEl">${data.reason}</textarea><span class="tips S_txt2" node-type="num"></span><div class="send_succpic" node-type="success_tip" style="display:none"><span class="W_icon icon_succB"></span><span class="txt">#L{发布成功}</span></div></div><div class="p_opt clearfix"><div class="btn W_fr"><#if (data.isReEdit)><a href="javascript:void(0)" node-type="submit" class="W_btn_a">发布</a><!--<a href="" class="W_btn_a W_btn_a_disable"><i class="W_loading"></i>发布中</a>--><#else><a href="javascript:void(0)" node-type="submit" class="W_btn_a">转发</a><!--<a href="" class="W_btn_a W_btn_a_disable"><i class="W_loading"></i>转发中</a>--></#if></div><div class="opt clearfix" test=1 node-type="widget"><span class="ico"><a href="javascript:void(0);" title="#L{表情}" node-type="smileyBtn"><i class="W_ficon ficon_face">o</i></a><a href="javascript:void(0);" title="#L{图片}" node-type="imgBtn"><i class="W_ficon ficon_image">p</i></a></span><ul class="ipt" node-type="cmtopts"><#if (!data.isReEdit && data.forwardNick)><li node-type="forwardLi" class="W_autocut"><label for="forward_comment_opt_forwardLi_f" class="W_label"><input node-type="forwardInput" name="" type="checkbox" value="" class="W_checkbox" id="forward_comment_opt_forwardLi_f"><span>#L{同时评论给} ${data.forwardNick}</span></label></li></#if><#if (!data.isReEdit && data.originNick)><li node-type="originLi" class="W_autocut"><label for="forward_comment_opt_originLi_f" class="W_label"><input node-type="originInput" name="" type="checkbox" value="" class="W_checkbox" id="forward_comment_opt_originLi_f"><span><#if (data.forwardNick)>#L{同时评论给原文作者}<#else>#L{同时评论给} </#if>${data.originNick}</span></label></li></#if></ul></div></div></div></div><div node-type="forward_link" class="repeat_list S_line1"></div></div></div></div>'),u=b('<#et cmt data><#if (data.forwardNick)><li node-type="forwardLi" class="W_autocut"><label class="W_label" for="forward_comment_opt_forwardLi_f"><input id="forward_comment_opt_forwardLi_f" type="checkbox" node-type="forwardInput" class="W_checkbox"  /><span>#L{同时评论给} ${data.forwardNick}</span></label></li></#if><#if (data.isReEdit && data.originNick)><li node-type="originLi" class="W_autocut"><label class="W_label" for="forward_comment_opt_originLi_f"><input id="forward_comment_opt_originLi_f" type="checkbox" node-type="originInput" class="W_checkbox" /><span><#if (data.isReEdit && data.forwardNick)>#L{同时评论给原文作者} <#else>#L{同时评论给} </#if>${data.originNick}</span></label></li></#if>'),v={notice:"#L{请输入转发理由}",defUpdate:"#L{转发微博}",netError:"#L{系统繁忙}",success:"#L{转发成功}!",off:"#L{关闭}",on:"#L{开启}"};return function(o,w,x){(o==null||w==null)&&a.log("[common.forward.toMiyouCircle]Required parameter client is missing");var y=a.parseParam({limitNum:140,tipText:b(v.notice),count:"disable"},x||{}),z,A,B,C,D,E,F=!0,G,H=x.data,I=56,J=!1,K=H.originNick?"@"+H.originNick:"",L=n(H.origin.replace(/<[^>]+>/gi,""));H.content=a.trim(L)+"";if(a.bLength(a.core.str.decodeHTML(n(L+K)))>I){H.content=a.leftB(L,I-a.bLength(K))+"...";J=!0}else H.content=H.origin;K?K='<a class="S_func1" href="/'+(H.domain||H.rootuid||H.uid)+'" target="_blank">'+K+"</a>:":K="";H.content=K+H.content;var M=a.trim(H.reason.replace(/[\r|\n|\t]/g,""))||"",N=H.forwardNick?"//@"+H.forwardNick+":"+" ":"",O,P,Q,R,S,T,U,V,W,X,Y,Z,_,ba,bb,bc,bd=!1,be=!1,bf,bg,bh=l,bi,bj={};bj.client=o;bj.opts=x.data||{};bj.isInit=!1;Q=a.parseParam({appkey:"",styleId:"1",mark:"",module:"",page_module_id:"",refer_sort:"",isReEdit:!1,forward_link_status:"on",dissDataFromFeed:{}},bj.opts);a.custEvent.define(bj,["forward","hide","center","count","forwardAgain","resetComment","updateNum"]);var bk={changeBtnText:function(c,d){if(d=="normal"){a.removeClassName(c,"W_btn_a_disable");c.innerHTML=b("#L{转发}")}else if(d=="reEdit"){a.removeClassName(c,"W_btn_a_disable");c.innerHTML=b("#L{发布}")}else if(d=="reEditLoading"){a.addClassName(c,"W_btn_a_disable");c.innerHTML=b('<i class="W_loading"></i>#L{发布中...}')}else{a.addClassName(c,"W_btn_a_disable");c.innerHTML=b('<i class="W_loading"></i>#L{转发中...}')}},canForward:function(){if(!!O&&!!O.API){var a=O.API.count(),b=y.limitNum-a,c=b>=0?!0:!1;if(c){R=!1;S="";c&&(P.num.innerHTML="<span>"+b+"</span>")}else{R=!0;S="error";P.num.innerHTML='<span class="S_error">'+b+"</span>"}}}},bl={updateForward:function(c){if(R)S==="error"&&f(P.textEl);else{var d=a.trim(O.API.getWords()||"");d===b(v.notice)&&(d="");R=!0;S="loading";a.addClassName(P.submit,"W_btn_a_disable");bk.changeBtnText(P.submit,H.isReEdit?"reEditLoading":"loading");var e={};e.appkey=Q.appkey;e.pic_id=P.textEl.getAttribute("pid");e.mid=w;e.style_type=Q.styleId;e.mark=Q.mark;e.reason=d||b(v.defUpdate);P.originInput&&P.originInput.checked&&(e.is_comment_base="1");if(P.forwardInput&&P.forwardInput.checked){e.is_comment="1";bd=!0}e.rank=2;e.rankid="";e.group_source="group_all";e.module=Q.module;e.page_module_id=Q.page_module_id;e.refer_sort=Q.refer_sort;e.isReEdit=Q.isReEdit;e=a.core.json.merge(e,Q.dissDataFromFeed);r=e;e.isReEdit=H.isReEdit;if(bh.checkAtNum(d)>5){a.ui.confirm(b("#L{单条微博里面@ 太多的人，可能被其它用户投诉。如果投诉太多可能会被系统封禁。是否继续转发？}"),{OK:function(){if(H.isReEdit){e.text=e.reason;delete e.reason;U.request(e)}else T.request(e)},cancel:function(){R=!1;S="";a.removeClassName(P.submit,"W_btn_a_disable");bk.changeBtnText(P.submit,H.isReEdit?"reEdit":"normal")}});return}if(H.isReEdit){e.text=e.reason;delete e.reason;U.request(e)}else T.request(e)}},putAside:function(){P.putAside&&(P.putAside.style.display="none");P.submit&&(P.submit.innerHTML=b("#L{转发}"));P.submit&&P.submit.removeAttribute("suda-data")},ctrlUpdateForward:function(a){if((a.keyCode===13||a.keyCode===10)&&a.ctrlKey){O.API.blur();bl.updateForward()}}},bm=function(){_=a.core.util.storage.get("forward_link_status");if(_=="null"||!_)_=Q.forward_link_status;ba=_},bn=function(b,c){O.API.blur();P.success_tip.style.display="";O.API.reset();D&&D.hideLayer();E&&E.hideLayer();bo(b,c);setTimeout(function(){R=!1;S="";r=null;a.removeClassName(P.submit,"W_btn_a_disable");bk.changeBtnText(P.submit,c.isReEdit?"reEdit":"normal");try{b.data.mid=c.mid;b.data.isComment=bd;b.data.isToMiniBlog=!0;if(!c.isReEdit){a.custEvent.fire(bj,"forward",[b.data,c,x.inDialog]);i.fire("forward",[b.data,c,x.inDialog])}}catch(d){}a.custEvent.fire(bj,"hide");bl.putAside();bd=!1},500)},bo=function(b,c){if(!!c.isReEdit){if(!b.data.html)return;var d=a.sizzle('[mid="'+c.mid+'"]'),e=a.sizzle('[node-type="feed_content"]',d[0]);d[0]&&e[0]&&a.replaceNode(a.builder(b.data.html).list.feed_content[0],e[0])}},bp=function(c,d){R=!1;S="";bk.changeBtnText(P.submit,d.isReEdit?"reEdit":"normal");c.msg=c.msg||b(v.netError);bd=!1;c.data&&c.data.close&&a.custEvent.fire(bj,"hide");p(c.code,c)},bq=function(b,c){R=!1;S="";a.removeClassName(P.submit,"W_btn_a_disable");bk.changeBtnText(P.submit,H.isReEdit?"reEdit":"normal");p(b.code,b)},br=function(b,c,d){M=d;O.API.reset();O.API.insertText(a.trim(a.core.str.decodeHTML(n(M))),0);h.setCursor(P.textEl,0,0);f(P.textEl);Q=a.parseParam(Q,c);w=c.mid;H=g(H,c);c.forwardNick=c.name;c.originNick=c.rootname;P.cmtopts.innerHTML=a.core.util.easyTemplate(u,c).toString();P=g(P,j(a.builder(P.cmtopts).list))},bs=function(a,b){if(P.cmtopts&&b.data.permission&&b.data.permission.allowComment==0){P.cmtopts.style.display="none";P.cmtopts.innerHTML=""}else if(P.originLi&&b.data.permission&&b.data.permission.allowRootComment==0){P.originLi.style.display="none";P.originLi.innerHTML=""}},bt=function(){a.custEvent.add(bj,"forwardAgain",br);a.custEvent.add(bj,"resetComment",bs)},bu=function(){T=k.getTrans(x.isWeiboDetail?"toMiyouCirclev5":"toMiyouCircle",{onComplete:function(a,b){var c={onSuccess:bn,onError:bp,requestAjax:T,param:r,onRelease:function(){R=!1;S="";bk.changeBtnText(P.submit,"normal");bd=!1}};s.validateIntercept(a,b,c)},onFail:bq,onTimeout:bp},H);U=k.getTrans(H.isReEdit?"publisherReEdit":x.isWeiboDetail?"toMiyouCirclev5":"toMiyouCircle",{onComplete:function(a,b){var c={onSuccess:bn,onError:bp,requestAjax:U,param:r,onRelease:function(){R=!1;S="";bk.changeBtnText(P.submit,b.isReEdit?"reEdit":"normal");bd=!1}};s.validateIntercept(a,b,c)},onFail:bq,onTimeout:bp},H)},bv=function(){Z=a.builder(o);Z=j(Z.list).toFriends_client;O=c(Z,y);O.API=O.editor.API;a.custEvent.define(O.editor,"close");P=O.nodeList;C=d(O.editor);D=a.lib.image.commentImage(O.editor,P.imgBtn,{file_source:2});E=a.lib.image.pastePic(O.editor,P.imgBtn);a.addEvent(P.textEl,"focus",function(){bf=setInterval(function(){bk.canForward()},200)});a.addEvent(P.textEl,"blur",function(){clearInterval(bf)});O.API.insertText(H.isReEdit?a.core.str.decodeHTML(n(M)):N+a.core.str.decodeHTML(n(M)));e({textArea:P.textEl,maxHeight:145,inputListener:a.funcEmpty});if(!H.isReEdit&&bc){z=a.lib.forward.source.like(Z);A=q(bj,{flNode:P.forward_link,mid:w,data:Q})}},bw=function(){a.addEvent(P.submit,"click",bl.updateForward);a.addEvent(P.putAside,"click",bl.putAside);a.lib.kit.extra.keySubmit.on(P.textEl,bl.updateForward);a.addEvent(P.smileyBtn,"click",C.show);if(bc){bb=a.delegatedEvent(Z);bb.add("origin_all","click",function(b){P.content.innerHTML='<span class="con S_txt2">'+K+a.trim(H.origin)+"</span>"});bb.add("report","click",function(a){return m(a)})}},bx=function(){bm();bt();bu();bv();bw()},by=function(b){if(bj.isInit==!1){x.data.isDialog=b;bc=b;x.data.showArrow=J;a.addHTML(o,a.core.util.easyTemplate(t,x.data));O||bx();bj.isInit=!0}else{Z&&a.setStyle(Z,"display","");a.custEvent.fire(A,"switch",[{node:P.forward_link,base:bj}])}O.API.focus(0);if(H.isReEdit){a.lib.kit.extra.textareaUtils.setCursor(P.textEl);O.API.cacheCurPos()}},bz=function(){a.lib.extra.shine(O.nodeList.textEl)},bA=function(){O.API.blur();Z!=null&&a.setStyle(Z,"display","none")},bB=function(){a.removeEvent(P.submit,"click",bl.updateForward);a.removeEvent(P.putAside,"click",bl.putAside);a.lib.kit.extra.keySubmit.off(P.textEl,bl.updateForward);a.custEvent.undefine(bj);bb&&bb.remove("origin_all","click");bb&&bb.remove("report","click");bb&&bb.remove("switch","click");bb&&bb.remove("retry","click");bb&&bb.remove("show","click");bb=null;A&&A.destroy&&A.destroy();s&&s.destroy&&s.destroy();z&&z.destroy&&z.destroy();O.closeWidget();D&&D.destroy();E&&E.destroy();bf&&clearInterval(bf);O=null;P=null;T=null;U=null;Z=null;for(var b in bj)delete bj[b];bj=null};bj.show=by;bj.hide=bA;bj.shine=bz;bj.destroy=bB;return bj}});
STK.register("conf.trans.global",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("language",{url:"/aj/user/lang",method:"post"});c("followList",{url:"/aj/mblog/attention"});c("topicList",{url:"/aj/mblog/topic"});c("myFollowList",{url:"/aj/relation/attention"});c("closetipsbar",{url:"/aj/tipsbar/closetipsbar",method:"post"});c("weiqunnew",{url:"/ajm/weiqun?action=aj_remindunread"});c("quiet_suggest",{url:"/aj/f/lenovo?ct=10&_wv=5",method:"get"});c("like_object",{url:"/p/aj/like/update",method:"post",withDomain:!0});c("like_weibo",{url:"/p/aj/like/set",method:"post",withDomain:!0});c("take",{url:"/p/aj/general/button",method:"get"});c("pageTabDelete",{url:"/p/aj/tab/delete",method:"post",withDomain:!0});c("getenvelope",{url:"/p/aj/proxy",method:"get"});c("rss",{url:"/p/aj/proxy",method:"get"});return b});
STK.register("conf.channel.flashUpload",function(a){var b=["uploading","uploaded","uploadfail","nofile","complete","deleteFile"];return a.lib.kit.extra.listener.define("conf.channel.flashUpload",b)});
STK.register("lib.message.upload.start",function(a){var b=a.lib.kit.extra.language,c=b('<#et userlist data><div class="img_mod W_fl" fid=${data.fid}><div class="mod_top S_bg1"><p class="prompt S_txt2" node-type="imgLoading_${data.fid}"><i class="W_loading"></i></p><img style="display:none;" width="92" height="92" node-type="imgUrl_${data.fid}" src="${data.url}" alt="${data.fileName}" class="send_img"></div><div class="mod_btm clearfix"><span class="W_autocut S_txt2 W_fl">${data.fileName}</span><a href="javascript:void(0);" class="W_fr" node-type="deleteImg_${data.fid}" action-type="cancelImg" action-data="fid=${data.fid}">#L{删除}</a></div></div>'),d=b('<#et userlist data><div class="files clearfix" fid=${data.fid}><div class="private_file_mod W_fl W_autocut"><span class="mes_acc_icon ${data.fileTypeClass}" node-type="fileType_${data.fid}"></span><span class="W_autocut name S_txt2" node-type="fileName_${data.fid}">${data.fileName} </span> </div><div class="state_mod W_fr"><i class="W_loading" node-type="uploading_icon_${data.fid}"></i><span class="state S_txt1" node-type="uploading_${data.fid}">#L{正在上传}</span><a href="javascript:void(0);" class="W_ficon ficon_close S_ficon" node-type="deleteFile_${data.fid}" action-type="cancelFile" action-data="fid=${data.fid}">X</a></div></div></#et>'),e=a.core.util.easyTemplate,f={img:8,file:38};return function(b){var g={};if(!b.target)return g;var h=a.E(b.target),i,j,k=b.fileName,l=b.fileName.toString().replace(/.*\.(\S{1,8})$/,"$1"),m=h.getAttribute("fileType");if(m=="img"){h.parentNode.style.display="";i=c}else{h.style.display="";i=d}j="acc_icon_"+l;f[m]&&a.core.str.bLength(k)>=f[m]&&(k=a.core.str.leftB(k,f[m]-3)+"...");var n=e(i,{fid:b.fid,fileName:k,fileTypeClass:j}).toString();a.insertHTML(h,n,"beforeend");a.conf.channel.flashUpload.fire("uploading",{fid:b.fid,fileName:b.fileName});return g}});
STK.register("lib.message.upload.complete",function(a){var b=a.lib.kit.extra.language,c=a.lib.kit.extra.actionData,d={1e3:"K",1e6:"M",1e9:"G"};return function(b,d){var e={};if(!b.target)return e;var f,g=a.E(b.target),h=a.lib.kit.dom.parseDOM(a.builder(g).list),i=b.fid,j=b.data.vfid,k=b.data.tovfid,l=b.fileSize,m=b.fileName,n=b.data.thumbnail_120+"&source=209678993",o=b.data.thumbnail_180+"&source=209678993",p=window.location.protocol=="https:"?"https:":"http:",q=function(){if(l<1024)return l+" B";if(l<1048576)return parseInt(l/102.4)/10+" K";if(l<1073741824)return parseInt(l/104857.6)/10+" M"}();if(g.getAttribute("fileType")=="file"){f=g;a.removeNode(h["uploading_"+i]);a.removeNode(h["uploading_icon_"+i]);h["fileName_"+i].innerHTML=m+" ("+q+")";c(h["deleteFile_"+i]).set("fileSize",l);h["deleteFile_"+i].setAttribute("action-type","deleteFile")}else{f=g.parentNode;n&&(n=n.replace(/^http:/,p));o&&(o=o.replace(/^http:/,p));a.removeNode(h["imgLoading_"+i]);h["imgUrl_"+i].style.display="";h["imgUrl_"+i].setAttribute("src",n);h["imgUrl_"+i].setAttribute("action-type","imgEnlarge");h["imgUrl_"+i].setAttribute("action-data","s="+n+"&l="+o+"&size=120");c(h["deleteImg_"+i]).set("fileSize",l);h["deleteImg_"+i].setAttribute("action-type","deleteImg")}f.setAttribute("fids",(f.getAttribute("fids")||"")+","+i);f.setAttribute("tovfids",(f.getAttribute("tovfids")||"")+","+k);f.setAttribute("vfids",(f.getAttribute("vfids")||"")+","+j);a.conf.channel.flashUpload.fire("uploaded",b);return e}});
STK.register("lib.message.upload.init",function(a){return function(){}});
STK.register("lib.message.upload.error",function(a){var b=a.lib.kit.extra.language,c=b('<p class="prompt S_txt2">#L{图片上传失败}</p>'),d=b("#L{上传失败}");return function(e,f){if(e.code&&e.code==-1)return a.ui.alert(b("#L{文件为空或者格式错误，请选择正确的文件上传。}"));if(e.code&&e.code==-3)return a.ui.alert(b("#L{你添加的文件个数已经达到5个了，不可以再添加了哦。}"));var g={};if(!e.target)return g;var h,i=a.E(e.target),j=a.lib.kit.dom.parseDOM(a.builder(i).list),k=e.fid,l=e.fileName,m=e.data.thumbnail_120+"&source=209678993",n=e.data.thumbnail_180+"&source=209678993";if(i.getAttribute("fileType")=="file"){h=i;a.removeNode(j["uploading_"+k]);j["fileName_"+k].innerHTML=l+" ("+d+")";j["deleteFile_"+k].setAttribute("action-type","deleteFile")}else{h=i.parentNode;j["imgUrl_"+k].parentNode.innerHTML=c;j["deleteImg_"+k].setAttribute("action-type","deleteImg")}h.setAttribute("fids",(i.getAttribute("fids")||"")+","+k);a.conf.channel.flashUpload.fire("uploadfail",e);return g}});
STK.register("lib.kit.extra.runFlashMethod",function(a){return function(a,b,c){var d,e,f,g=function(){if(a[b]){e=!0;clearTimeout(d);try{a.TotalFrames()}catch(h){a.TotalFrames}c()}else f=setTimeout(g,100)};g();d=setTimeout(function(){e||clearTimeout(f)},1e4);return{destroy:function(){clearTimeout(d);clearTimeout(f)}}}});
STK.register("lib.message.upload.loadSwf",function(a){var b=a.lib.kit.extra.language;return function(c,d){var e={},f,g=!1,h=a.C("span"),i,j,d=a.parseParam({fileListNode:null,fn_start:"STK.namespace.v6page.lib.message.upload.start",fn_init:"STK.namespace.v6page.lib.message.upload.init",fn_complete:"STK.namespace.v6page.lib.message.upload.complete",fn_error:"STK.namespace.v6page.lib.message.upload.error",uid:$CONFIG.uid,source:"209678993",uploadAPI:"//upload.api.weibo.com/2/mss/upload.json",flashURL:$CONFIG.jsPath+"home/static/swf/upload.swf",fileType:"file",maxFileSize:50,maxFileCount:5,flash_width:25,flash_height:20,areaInfo:"0-20|10-22",flashID:"uploadflash_id_"+a.getUniqueKey(),multiSelect:0,deleteConfirm:null,flashCssText:"",pasteEl:null},d||{});if(!d.fileListNode)throw new Error("message.upload.loadSwf:缺少fileListNode作为文件容器！");if(d.fileType=="img"){i=a.C("div");i.className="imgs clearfix";d.fileListNode.appendChild(i)}else i=d.fileListNode;var k=50,l=1,m={},n={},o=function(c,e){var f=window.$CONFIG&&window.$CONFIG.version||(new Date).getTime(),g={swfid:d.flashID,maxSumSize:d.maxFileSize,maxFileSize:d.maxFileSize,maxFileNum:d.maxFileCount,multiSelect:0,uploadAPI:encodeURIComponent(d.uploadAPI+"?source=209678993&tuid="+d.uid),initFun:d.fn_init,sucFun:d.fn_complete,errFun:d.fn_error,beginFun:d.fn_start,areaInfo:d.areaInfo,fExt:d.fileType=="img"?"*.jpg;*.gif;*.jpeg;*.png":"*",fExtDec:d.fileType=="img"?b("#L{选择图片}"):b("#L{选择文件}")},h=a.core.util.swf.create(c,d.flashURL,{width:d.flash_width,height:d.flash_height,paras:{menu:"false",scale:"noScale",allowFullscreen:"true",allowScriptAccess:"always",bgcolor:"",wmode:"transparent"},flashvars:g});return h},p=function(a){m[a.fid]={fileName:a.fileName,fileSize:a.fileSize}},q=function(b){n[b.fid]={fileName:b.fileName,fileSize:b.fileSize,vfid:b.data.vfid,tovfid:b.data.tovfid};a.custEvent.fire(e,"uploaded",[b.fid,n[b.fid]])},r=function(a,b){},s=function(b){var c=b.clipboardData,d,e,f;if(c){d=c.items;if(!d)return;f=d[0];e=c.types||[];for(var g=0;g<e.length;g++)if(e[g]==="Files"){f=d[g];break}if(f&&f.kind==="file"&&f.type.match(/^image\//i)){var h=f.getAsFile(),i=new FileReader;i.onload=function(b){a.lib.kit.extra.runFlashMethod(j,"screenCapture",function(){j.screenCapture(b.target.result.split(",")[1])})};i.readAsDataURL(h)}}},t=function(){var a=d.fileListNode.getAttribute("fids");a=(a||"").replace(/^\,/,"");return a&&a.split(",")||[]},u=function(){var a=d.fileListNode.getAttribute("vfids");a=(a||"").replace(/^\,/,"");return a&&a.split(",")||[]},v=function(){var a=d.fileListNode.getAttribute("tovfids");a=(a||"").replace(/^\,/,"");return a&&a.split(",")||[]},w=function(){for(var a in m)if(!n[a])return!1;return!0},x=function(){a.lib.kit.extra.installFlash()},y=function(b){var c=a.sizzle('[fid="'+b+'"]',i)[0],f=n[b]||{},g=f.fileSize,h=f.vfid,k=f.tovfid;if(!c||!g)return a.log("找不到要删除的文件！");a.removeNode(c);var l=a.sizzle("[fid]",i);l.length||(d.fileListNode.style.display="none");z("fids",b);h&&z("vfids",h);k&&z("tovfids",k);a.lib.kit.extra.runFlashMethod(j,"removeFileBySize",function(){j.removeFileBySize(g)});a.custEvent.fire(e,"deleted",[b,n[b]]);delete m[b];delete n[b]},z=function(a,b){var c=d.fileListNode.getAttribute(a),e=c.replace(","+b,"");d.fileListNode.setAttribute(a,e)},A=function(){try{j.resetUploadedFileNum(0);j.resetUploadedFileSize(0)}catch(a){}d.fileListNode.style.display="none";i.innerHTML="";d.fileListNode.setAttribute("fids","");d.fileListNode.setAttribute("vfids","");d.fileListNode.setAttribute("tovfids","");m={};n={}},B=function(b){var c=b.data.fid,e=a.sizzle('[fid="'+c+'"]',i)[0],f=(n[c]||{}).fileSize;a.removeNode(e);var g=a.sizzle("[fid]",i);g.length||(d.fileListNode.style.display="none");delete m[c]},C=function(c){var e=c.data;typeof d.deleteConfirm!="function"?a.ui.confirm(b("#L{确定要删除该"+(d.fileType=="img"?"图片":"附件")+"？}"),{OK:function(){y(e.fid)}}):d.deleteConfirm(e,c)},D=function(b){a.lib.kit.extra.runFlashMethod(j,"resetUploadAPI",function(){j.resetUploadAPI(b)})},E=function(){c.style.position="relative";h.style.cssText=d.flashCssText||"display:inline-block;position:absolute;left:0px;top:-2px;z-index:9999";c.appendChild(h);d.fileListNode.className="sendbox_"+(d.fileType=="img"?"img":"file")+" S_line2"},F=function(){f=a.delegatedEvent(d.fileListNode);f.add(d.fileType=="img"?"deleteImg":"deleteFile","click",C);f.add(d.fileType=="img"?"cancelImg":"cancelFile","click",B);a.custEvent.define(e,["deleteConfirm","uploading","uploaded","deleted"]);a.conf.channel.flashUpload.register("uploading",p);a.conf.channel.flashUpload.register("uploaded",q);a.conf.channel.flashUpload.register("uploading",r);d.fileType=="img"&&d.pasteEl&&d.pasteEl.addEventListener&&d.pasteEl.addEventListener("paste",s)},G=function(){f.destroy();a.custEvent.undefine(e,["deleteConfirm","uploading","uploaded","deleted"]);a.conf.channel.flashUpload.remove("uploading",p);a.conf.channel.flashUpload.remove("uploaded",q);a.removeNode(h)};e.resetUploadAPI=D;e.deleteFile=y;e.checkUploadComplete=w;e.getFids=t;e.getVfids=u;e.getTovfids=v;e.deleteAllFiles=A;e.destroy=G;E();F();if(a.lib.kit.extra.getFlashVersion()>=10){j=o(h);e.flashNode=j;if(i){i.setAttribute("id",d.flashID);i.setAttribute("fileType",d.fileType);i.setAttribute("swfid",j.getAttribute("id"))}}else a.addEvent(c,"click",x);return e}});
STK.register("lib.message.upload.mergeFileCount",function(a){return function(b,c){var d={};if(!b)return d;var e=c||{},f={},g=parseInt(e.count)||5,h=0,i=function(c,d,e){if(!f[d]&&!!e){h++;f[d]=e;a.foreach(b,function(b,c){b.flashNode&&a.lib.kit.extra.runFlashMethod(b.flashNode,"resetUploadedFileNum",function(){b.flashNode.resetUploadedFileNum(h)})})}},j=function(c,d,e){if(!!f[d]&&!!e){h--;delete f[d];a.foreach(b,function(b,c){b.flashNode&&a.lib.kit.extra.runFlashMethod(b.flashNode,"resetUploadedFileNum",function(){b.flashNode.resetUploadedFileNum(h)})})}};a.foreach(b,function(b,c){b.flashNode&&a.lib.kit.extra.runFlashMethod(b.flashNode,"resetFileNum",function(){b.flashNode.resetFileNum(g)});a.custEvent.add(b,"uploaded",i);a.custEvent.add(b,"deleted",j)})}});
STK.register("lib.message.upload.getFlash",function(a){return function(b){return a.sizzle('[flashobj="'+b+'"]')[0]}});
STK.register("lib.forward.source.toMessage",function(a){var b=a.lib.kit.extra.language,c=a.lib.editor.base,d=a.lib.publisher.widget.face,e=a.lib.kit.dom.autoHeightTextArea,f=a.lib.kit.extra.shine,g=a.ui.tip,h=a.lib.kit.extra.getDiss,i=a.conf.channel.feed,j=a.lib.forward.source.API,k=a.conf.trans.forward,l=a.lib.kit.dom.smartInput,m=a.lib.dialog.validateCode,n=a.lib.message.upload.loadSwf,o=a.lib.message.upload.getFlash,p=a.lib.dialog.ioError,q=a.lib.kit.dom.parseDOM,r=a.core.dom.hasClassName,s=a.core.dom.addClassName,t=a.core.dom.removeClassName,u,v=a.ui.suggest,w,x,y,z,A={limitNum:1e4,count:"disable"},B=b('<#et userlist data><div node-type="toMessage_client"><div class="WB_feed_repeat forward_rpt2" ><div class="WB_repeat"><!--评论-发表--><div class="WB_feed_publish clearfix"><div class="WB_face W_fl">收信人：</div><div class="WB_publish"><div class="p_input"><textarea class="W_input" node-type="msgTo"></textarea></div></div></div><!--评论-发表--><div class="WB_feed_publish clearfix"><div class="WB_face W_fl">内   容：</div><div class="WB_publish"><div class="sendbox_mod sendbox_mod_down sendbox_mod_focus" node-type="uploadTd"><div class="sendbox_area S_bg2"><textarea node-type="textEl" name="" cols="" rows="" class="W_input W_f14" style="">#L{给你推荐一条微博}&#13;<#if (data.url)>${data.url}</#if></textarea></div><!-- 私信模块 --><div node-type="uploadList" class="sendbox_annex S_bg2 S_line3"><div class="sendbox_file S_line2" node-type="uploadFile" style="display:none;"></div><!-- 私信模块 --><!-- 图片模块 --><div class="sendbox_img S_line2" style="display:none;" node-type="uploadImg"></div></div><!-- 图片模块 --><div class="sendbox_bar clearfix"><div class="sendbox_menu W_fl" node-type="widget"><a href="javascript:void(0);" class="icon_send" node-type="smileyBtn"> <em class="W_ficon ficon_face">o</em></a><a href="javascript:void(0);" class="icon_send" node-type="picBtn" style="cursor:default;"> <em class="W_ficon ficon_image S_ficon_dis">p</em></a><a href="javascript:void(0);" class="icon_send" node-type="attachBtn" style="cursor:default;"><em class="W_ficon ficon_file S_ficon_dis">x</em></a></div><div class="sendbox_btn W_fr"><span class="prompt S_txt1" node-type="num" style="display:none;"> 还可以输入 <em>10000</em> 字 </span><a href="javascript:void(0);" node-type="submit" class="W_btn_a">发送</a></div></div></div></div><!-- 发送附件和图片 --> </div><!--/评论-发表--><#if (data.isDialog == true)></div></div></#if></div></#et>'),C={notice:"#L{请输入转发理由}",nameNotice:"#L{收信人昵称输入正确，才能上传附件哦}",defUpdate:"#L{转发微博}",netError:"#L{系统繁忙}",success:"#L{转发成功}!",retry:'#L{读取失败，请}<a href="#" onclick="return false;" action-type="retry" value="retry">#L{重试}</a>',off:"#L{关闭}",on:"#L{开启}"},D=function(c,d){if(d=="normal"){a.removeClassName(c,"W_btn_a_disable");c.innerHTML=b("#L{转发}")}else{a.addClassName(c,"W_btn_a_disable");c.innerHTML=b('<i class="W_loading"></i>#L{转发中...}')}};return function(h,i,o){function Z(){a.removeEvent(z.msgTo,"focus",Z);w=$suggest({textNode:z.msgTo,callback:function(a){}});w.show()}var v=m();if(h==null||i==null)throw new Error("[lib.invoke.forward.publisher.toPrivateMsg]Required parameter client is missing");var x,z,E,F,G,H,I,J,K,L,M=j,N,O,P={};P.client=h;P.opts=o||{};P.isInit=!1;var Q=null,R=null;a.custEvent.define(P,["forward","hide","center","updateNum"]);var S=function(){if(y){F=!1;G="";y=null;D(z.submit,"normal")}},T=function(){var c=x.API.getExtra();if(F)G==="error"&&f(z.textEl);else{var d=a.trim(x.API.getWords()||"");d===b(C.notice)&&(d="");var e=a.trim(z.msgTo.value);e===b(C.nameNotice)&&(e="");if(d===""){f(z.textEl);return}if(e===""||!Q){f(z.msgTo);return}F=!0;G="loading";D(z.submit,"loading");var g={};g.text=d||b(C.defUpdate);var h=Q&&Q.getTovfids().concat(R.getTovfids());if(h&&h.length!=0){g.fids=h.join(",");g.tovfids=h.join(",")}g.appkey=P.opts.data.appkey;g.id=i;g.screen_name=e;y=g;y.module=P.opts.data.module;y.page_module_id=P.opts.data.page_module_id;y.refer_sort=P.opts.data.refer_sort;_()}},U=function(b){if((b.keyCode===13||b.keyCode===10)&&b.ctrlKey){x.API.blur();a.core.evt.fireEvent(z.submit,"click")}},V=function(){if(!!x&&!!x.API){var a=x.API.count(),c=A.limitNum-a,d=c>=0?!0:!1;if(d){F=!1;G="";if(d){z.num.innerHTML=b("#L{还可以输入}<span>"+c+"</span> #L{字}");z.num.style.display="none"}}else{F=!0;G="error";z.num.innerHTML=b('#L{已经超过}<span class="S_error">'+Math.abs(c)+"</span> #L{字}");z.num.style.display=""}}},W=function(c,d){x.API.blur();y=null;F=!1;G="";D(z.submit,"normal");try{c.data.mid=d.mid;c.data.toPrivateMsg=!0;a.custEvent.fire(P,"forward",[c.data,d,o.inDialog])}catch(e){}a.custEvent.fire(P,"hide");g("lite",{msg:b(C.success),type:"succ",timer:"500"});x.API.reset();L.reset();image&&image.hideLayer()},X=function(a,b){F=!1;y=null;G="";D(z.submit,"normal");p(a.code,a)},Y=function(a,b){F=!1;G="";y=null;D(z.submit,"normal");p(a.code,a)},_=function(b){if(!Q.checkUploadComplete()||!R.checkUploadComplete())setTimeout(function(){_(b)},100);else{y=a.lib.kit.extra.getDiss(y,z.submit);H.request(y)}},ba=function(b,c){a.ui.confirm("确认删除？",{OK:function(){Q.deleteFile(c.fid,c.fileSize)}})},bb=function(b,c){a.ui.confirm("确认删除？",{OK:function(){R.deleteFile(c.fid,c.fileSize)}})},bc=function(b){var c=u.picBtn,d=u.attachBtn,e=a.sizzle("em",c)[0],f=a.sizzle("em",d)[0];k.request("getuid",{onComplete:function(a,b){if(a.code=="100000"){c.style.cursor="";d.style.cursor="";r(e,"S_ficon_dis")&&t(e,"S_ficon_dis");r(f,"S_ficon_dis")&&t(f,"S_ficon_dis");be(a.data.uid)}else{c.style.cursor="default";d.style.cursor="default";r(e,"S_ficon_dis")||s(e,"S_ficon_dis");r(f,"S_ficon_dis")||s(f,"S_ficon_dis");bd()}}},{screen_name:u.msgTo.value})},bd=function(){Q&&Q.deleteAllFiles&&Q.deleteAllFiles();R&&R.deleteAllFiles&&R.deleteAllFiles();Q&&Q.destroy&&Q.destroy();R&&R.destroy&&R.destroy();Q=null;R=null;u.uploadImg.innerHTML="";u.uploadFile.innerHTML=""},be=function(b){bd();Q=n(u.picBtn,{fileType:"img",fileListNode:u.uploadImg,pasteEl:z.textEl,uid:b});R=n(u.attachBtn,{fileType:"file",fileListNode:u.uploadFile,uid:b});a.lib.message.upload.mergeFileCount([Q,R])},bf=function(){a.ui.notice("收信人错误，请重新输入",{icon:"rederrorB",hideDelay:2e3})},bg=function(){I=a.builder(h);u=q(I.list);I=u.toMessage_client;x=c(I,A);x.API=x.editor.API;a.custEvent.define(x.editor,"close");O=d(x.editor);z=x.nodeList;a.addEvent(z.textEl,"focus",function(){V();a.addClassName(z.uploadTd,"sendbox_mod_focus");K=setInterval(function(){V()},200)});a.addEvent(z.textEl,"blur",function(){a.removeClassName(z.uploadTd,"sendbox_mod_focus");clearInterval(K)});e({textArea:z.textEl,maxHeight:145,inputListener:a.funcEmpty})},bh=function(){a.addEvent(z.submit,"click",T);a.lib.kit.extra.keySubmit.on(z.textEl,T);a.addEvent(z.smileyBtn,"click",O.show);a.addEvent(u.msgTo,"blur",bc)},bi=function(){},bj=function(){H=k.getTrans("create",{onComplete:function(a,b){var c={onSuccess:W,onError:X,requestAjax:H,param:b,onRelease:function(){F=!1;y=null;G="";D(z.submit,"normal")}};v.validateIntercept(a,b,c)},onFail:Y})},bk=function(){bj();bg();bh();bi();N=l(z.msgTo,{notice:b(C.nameNotice)});N.restart();a.ui.suggest(z.msgTo,{getUid:bc}).on("suggest",function(b,c,d){a.conf.trans.global.request("followList",{onSuccess:function(b){var c=[];a.foreach(b.data,function(a){var b=a.remark?"("+a.remark+")":"";c.push([a.screen_name+b,a.screen_name])});d(c)}},{q:c})})},bl=function(c){if(P.isInit==!1){J=c;o.data.msgTo=b(C.nameNotice);o.data.isDialog=c;o.data.origin=a.trim(o.data.origin);a.addHTML(h,a.core.util.easyTemplate(B,o.data));x||bk();P.isInit=!0}else I&&a.setStyle(I,"display","");x.API.focus(0)},bm=function(){x.API.blur();I!=null&&a.setStyle(I,"display","none")},bn=function(){z&&z.submit&&a.removeEvent(z.submit,"click",T);z&&z.textEl&&a.lib.kit.extra.keySubmit.off(z.textEl,T);a.custEvent.undefine(P);w&&w.destroy&&w.destroy();x&&x.closeWidget();y=null;K&&clearInterval(K);v&&v.destroy&&v.destroy();x=null;z=null;H=null;I=null;for(var b in P)delete P[b];Q&&Q.destroy&&Q.destroy();R&&R.destroy&&R.destroy();P=null};P.show=bl;P.hide=bm;P.destroy=bn;return P}});
STK.register("lib.forward.source.publisher",function(a){var b=a.lib.kit.extra.language,c=a.lib.forward.source,d=b('<#et userlist data><div class="froward_wrap"><div node-type="forward_tab" class="WB_minitab clearfix"><span class="txt">#L{转发到}：</span><ul class="minitb_ul S_line1 S_bg1 clearfix"><#list data.tab as list><li <#if (list.id==data.type)> class="minitb_item current S_line1" <#else> class="minitb_item S_line1" </#if>><a href="javascript:void(0);" action-type="tab_item" action-data="id=${list.id}"<#if (list.id == data.type && data.isReEdit)> class="minitb_lk S_txt1 S_bg2 "<#elseif (list.id == data.type && !data.isReEdit)> class="minitb_lk S_txt1 S_bg2 " action-type="tab_item" action-data="id=${list.id}"<#elseif (list.id != data.type && data.isReEdit)> class="minitb_lk S_ficon_dis "<#else> class="minitb_lk S_txt1" action-type="tab_item" action-data="id=${list.id}"</#if><#if (list.suda)> suda-data="key=tblog_tran_miyou&value=miyou_group_click"</#if>node-type="tab_item_bg">${list.name}<#if (list.id==3)><i title="#L{他是你的好友哦~}" class="W_icon icon_type_friends"></i></#if></a><span class="cur_block"></span></li></#list></ul></div><div node-type="forward_client"></div></div>'),e=[{id:1,name:b("#L{我的微博}"),first_one:!0}];e.push({id:3,name:b("#L{好友圈}"),suda:!0});e.push({id:2,name:b("#L{私信}"),last_one:!0});return function(f,g){if(f==null)throw new Error("[common.forward.publisher]Required parameter mid is missing");g=g||{type:1,styleId:"1"};var h={instances:{}},i=g.type,j=g.isReEdit,k,l,m,n,o,p,q=a.lib.kit.extra.toFeedText,r={1:c.toMicroblog,2:c.toMessage,3:c.toFriends},s={appkey:"",domInit:!1,forwardNick:"",originNick:"",origin:"",reason:"",url:null,styleId:"1",allowComment:"1",allowForward:"1",allowRootComment:"1",uid:"",rootuid:"",pid:"",domain:"",mark:"",page_module_id:"",module:"",refer_sort:"",pic_src:"",dissDataFromFeed:{},isReEdit:!1,visible:0},t=function(){if(g.domInit==!1)var b=a.core.util.easyTemplate(d),c=b({type:i,tab:e,tab_count:e.length,isReEdit:j}).toString(),f=a.builder(c);var h=a.lib.kit.dom.parseDOM(f.list);k=h.forward_tab;l=h.forward_client;return f.box};a.custEvent.define(h,["hide","center","forward","updateNum"]);var u=function(a){if(f==null)throw new Error("[common.forward.publisher]Required parameter inner is missing");m=a;g.isReEdit||w();y(i,{data:g,client:l})},v=function(b){if(n){a.removeClassName(n.parentNode,"current");a.removeClassName(n,"S_bg2")}n=b.el;a.addClassName(n.parentNode,"current");a.addClassName(n,"S_bg2");i=b.data.id||i;y(i,{data:g,client:l})},w=function(){n=a.sizzle('a[node-type="tab_item_bg"]',m);n=n.length>0?n[0]:null;var b=a.sizzle('div[node-type="forward_tab"]',m);b=b.length>0?b[0]:null;if(b){o=a.delegatedEvent(b);o.add("tab_item","click",function(a){i!=a.data.id&&v(a)})}},x=function(b){var c=function(a,b){return a[b]},d=b.split("."),e=a,f,g=0;while(d[g]){f=d[g];e=c(e,f);g++}return e},y=function(c,d){p!=null&&p.hide();!!l.offsetHeight;c=c.toString();var e;if(h.instances[c]==null){var g={},i;for(var j in s)g[j]=d.data[j];g.type=c;g.isReEdit=!!g.isReEdit;i={client:l,data:g,inDialog:!0};if(i.data.allowForward==="0"){i.data.originNick="";i.data.origin=b("#L{此微博已被原作者删除}")}i.data.reason=q(i.data.reason);e=r[c](l,f,i);h.instances[c]=e;a.custEvent.add(e,"hide",function(){a.custEvent.fire(h,"hide")});a.custEvent.add(e,"center",function(){a.custEvent.fire(h,"center")});a.custEvent.add(e,"updateNum",function(b,c){a.custEvent.fire(h,"updateNum",c)});a.custEvent.add(e,"forward",function(b,c){a.custEvent.fire(h,"forward",c)})}else e=h.instances[c];e.show(!0);p=e},z=function(){for(var b in h.instances){var c=h.instances[b];c&&c.destroy&&c.destroy();c=null}h.instances=null;a.custEvent.undefine(h);k=null;l=null;m=null;n=null;o&&o.remove("tab_item","click");o=null};h.getDom=t;h.init=u;h.destroy=z;return h}});
STK.register("lib.forward.source.init",function(a){var b={title:"#L{转发微博}",title2:"#L{编辑微博}",commentPerson:"#L{同时评论给}",originPerson:"#L{同时评论给原文作者}",notice:"#L{请输入转发理由}",defUpdate:"#L{转发微博}"},c=a.lib.kit.extra.language;return function(d,e){var f={},g={},h,i,j,k=function(){g.cevt=["forward","hide","show","updateNum"];g.callbackCevt=["forward","hide","updateNum"];a.custEvent.define(g,g.cevt)},l=function(){},m=function(){a.custEvent.add(g,"hide",function(){g.destroy()})},n=function(d,e){if(typeof d!="string"&&typeof d!="number")throw new Error("$.common.dialog.forward.show need string (or number) as weiboId");mid=d;e.pic&&(e.pid=e.pic);var k=a.parseParam({appkey:"",type:1,origin:"",reason:"",originNick:"",forwardNick:"",title:e.isReEdit?c(b.title2):c(b.title),domInit:!1,url:null,styleId:"1",allowComment:"1",allowForward:"1",allowRootComment:"1",module:"",page_module_id:"",refer_sort:"",pid:"",domain:"",mark:"",pic_src:"",dissDataFromFeed:{},rank:"",isReEdit:!1,visible:0},e);i=a.ui.dialog();h=i.getDomList().inner;h.className="layer_forward";i.setTitle(k.title);i.show().setMiddle();j=new a.lib.forward.source.publisher(mid,k);h.appendChild(j.getDom());i.setBeforeHideFn(function(){});j.init(h);a.custEvent.add(j,"hide",function(){o()});a.custEvent.add(j,"updateNum",function(b,c){f.backnum=c.num;a.custEvent.fire(g,"updateNum",f)});a.custEvent.add(j,"center",function(){i.setMiddle()});a.custEvent.add(j,"forward",function(b,c){c=a.core.json.merge(c,f);c.cevtType=b.type;a.custEvent.fire(g,"forward",c)});a.custEvent.add(i,"hidden",function(){h.className="detail";j&&j.destroy&&j.destroy();i.clearBeforeHideFn();var b=arguments.callee;a.custEvent.remove(i,"hidden",b);i.clearContent();a.custEvent.fire(g,"hide",f)});i.setMiddle();var l=i._.node;l.style.top=parseInt(l.style.top)-80+"px";a.custEvent.fire(g,"show",{box:i});g.publisher=j},o=function(){i&&i.hide&&i.hide()};g.destroy=function(){o();j.destroy()};var p=function(){k();l();m()};p();g.show=n;return g}});
STK.register("lib.forward.forwardDialog",function(a){return function(b,c){var d=a.lib.forward.source.init();d.show(b,c);return d}});
STK.register("conf.trans.feed.comment",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("smallList",{url:"/aj/v6/comment/small",method:"get"});c("add",{url:"/aj/v6/comment/add",method:"post"});c("delete",{url:"/aj/comment/del",method:"post"});c("hotChange",{url:"/aj/comment/hotchange"});c("privateSetting",{url:"/aj/account/setcommentprivacy",method:"post"});c("privateNoMore",{url:"/aj/bubble/closebubble",method:"get"});c("cfilter",{url:"/aj/v6/comment/small",method:"get"});c("isComment",{url:"/aj/comment/privacy",method:"get"});c("getIn",{url:"/aj/commentbox/in",method:"get"});c("getOut",{url:"/aj/commentbox/out",method:"get"});c("getComment",{url:"/aj/at/comment/comment",method:"get"});c("getCommonComent",{url:"/aj/commentbox/common",method:"get"});c("dialogue",{url:"/aj/v6/comment/conversation",method:"get"});return b});
STK.register("lib.dialog.commentPrivateSetting",function(a){var b=1,c=0,d={},e,f,g=0,h,i={},j=0,k=0,l=a.lib.kit.extra.language,m=function(){var d=a.getUniqueKey,f=a.core.util.easyTemplate,g=a.lib.kit.dom.parseDOM,i={id1:"key"+d(),id2:"key"+d(),id3:"key"+d(),showType:b,set:c},j='<#et privateSetting data><div class="detail layer_setup_privacy" node-type="content"><div class="W_tips tips_warn clearfix"><p class="icon"><span class="icon_warnS"></span></p><p class="txt">#L{为了避免受到不必要的骚扰，建议设置“可信用户”可以评论我的微博。}</p></div><p class="privacy_title">#L{设置谁可以评论我的微博}</p><ul class="privacy_repliable">\t<li><label for="${data.id1}"><input type="radio" class="W_radio" value="0" name="comment" id="${data.id1}" action-type="choose" <#if (data.showType == 1)>checked="checked"</#if><#if (data.showType==2 && data.set==0)>checked="checked"</#if>/>&nbsp;#L{所有人}<span class="S_txt2">#L{（不包括你的黑名单用户）}</span></label></li>  <li><label for="${data.id2}"><input type="radio" class="W_radio" value="2" name="comment" id="${data.id2}" action-type="choose" <#if (data.showType==2 && data.set==2)>checked="checked"</#if>/>&nbsp;#L{可信用户}<span class="S_txt2">#L{（包括我关注的人、新浪认证用户、微博达人以及手机绑定用户）}</span></label></li>  <li><label for="${data.id3}"><input type="radio" class="W_radio" value="1" name="comment" id="${data.id3}" action-type="choose" <#if (data.showType==2 && data.set==1)>checked="checked"</#if>/>&nbsp;#L{我关注的人}</label></li></ul><div class="btn"><a href="javascript:void(0)" class="W_btn_d" action-type="OK" node-type="OK" style="visibility:hidden;"><span>#L{保存}</span></a><#if (data.showType==1)><a href="javascript:void(0)" class="W_btn_b" action-type="cancel" node-type="noMore"><span>#L{不再提示}</span></a></#if><#if (data.showType==2)><a href="javascript:void(0)" class="W_btn_b" action-type="hide" node-type="hide"><span>#L{取消}</span></a></#if></div></div></#et>';e=a.ui.dialog();e.setTitle(l("#L{评论隐私设置}"));e.setContent(f(l(j),i).toString());h=g(a.builder(e.getOuter()).list)},n={chooseItem:function(d){g=d.el.value;b==1?a.setStyle(h.OK,"visibility",g==0?"hidden":"visible"):a.setStyle(h.OK,"visibility",g==c?"hidden":"visible")},save:function(b){g=parseInt(g,10);if(g>-1){if(j)return;j=1;a.conf.trans.comment.request("privateSetting",{onSuccess:o.saveSuccess,onError:o.saveError},{comment:g})}return a.preventDefault(b.evt)},cancel:function(b){if(!k){k=1;s();e.hide();a.conf.trans.comment.request("privateNoMore",{onSuccess:o.noMoreSuccess,onError:o.noMoreError},{bubbletype:5,time:604800});return a.preventDefault(b.evt)}},hide:function(b){s();e.hide();return a.preventDefault(b.evt)}},o={getSetErr:function(){a.ui.alert(l("#L{对不起，评论隐私设置获取失败}"))},getAlert:function(b,c,d){var f=a.ui.tip({showCallback:function(){setTimeout(function(){f&&f.anihide()},500)},hideCallback:function(){f&&f.destroy();b?setTimeout(function(){d&&d();s();e.hide()},200):d&&d()},msg:c,type:b?undefined:"del"});return f},saveSuccess:function(b,c){e.hide();a.ui.tip("lite",{msg:l("#L{保存成功}"),type:"succM",timer:"1000",hideCallback:function(){window.location.reload()}})},saveError:function(){var a=o.getAlert(!1,l("#L{保存失败，请重试}"),function(){j=0});a.setLayerXY(h.OK);a.aniShow()},noMoreSuccess:function(){k=0},noMoreError:function(b){k=0;a.lib.dialog.ioError(b.code,b)}},p=function(){g=0;k=0;f=a.delegatedEvent(h.content);f.add("choose","click",n.chooseItem);f.add("OK","click",n.save);f.add("cancel","click",n.cancel);f.add("hide","click",n.hide)},q=function(){},r=function(a){if(a){a.data&&a.data.set&&(c=a.data.set);b=!c?1:2}q();m();p();e.show();e.setMiddle()},s=function(){f&&f.destroy()};d.show=r;return d});
STK.register("lib.comment.inter",function(a){var b=null,c=function(){},d=a.ui.alert,e,f=a.lib.dialog.commentPrivateSetting,g=a.lib.kit.extra.language,h=function(b,c){if(b&&b.code){b.code!="100000"&&b.code!="100005"&&a.lib.dialog.ioError(b.code,b);c(b)}};return function(f,i){e=a.lib.dialog.validateCode();var j={},k=0,l=a.conf.trans.feed.comment;f=a.parseParam({delete_success:c,delete_fail:c,delete_error:c,add_success:c,add_fail:c,add_error:c,smallList_success:c,smallList_fail:c,smallList_error:c},f||{});j.conf=a.parseParam({act:b,mid:b,cid:b,uid:$CONFIG.uid,page:b,forward:b,isroot:b,content:b,type:b,is_block:b,appkey:b},i);j.merge=function(b){b=a.lib.kit.extra.merge(j.conf,b);return a.core.obj.clear(b)};j.request=function(b,c){if(!k){k=1;var i=j.merge(c),m=l.getTrans(b,{onComplete:function(c,j){if(b=="add"){var l={onSuccess:function(a,c){h(a,function(a){f[b+(a.code=="100000"?"_success":"_fail")](a,i)})},onError:function(c,e){f[b+"_error"](c,h);if(c.code=="100005")d(g("#L{由于对方隐私设置，你无法进行评论。}"),{textSmall:g("#L{绑定手机后可以更多地参与评论。}")+'<a href="//account.weibo.com/settings/mobile" target="_blank">'+g("#L{立即绑定}")+"</a>"});else{if(c.code=="100003"&&c.msg&&c.data&&c.data.location){var h={oKText:"立即绑定手机",cancelText:"我知道了",icon:"warnB",location:"https://security.weibo.com/mobile/index?entry=shiming_bindphone&r=https%3A%2F%2Fweibo.com%2Fu%2F5262214070%2Fhome&msgtype=1&action=autoclose",title:"发布失败"};h=a.lib.kit.extra.merge(h,c.data);c.data.OKText&&(h.okText=c.data.OKText);a.ui.confirm(c.msg.split("\n")||"为了保障你的账号安全，请完成手机号绑定。",h).ok(function(){setTimeout(function(){window.open(c.data.location,"_blank")},100)});return}a.lib.dialog.ioError(c.code,c)}},param:i,requestAjax:m};e.validateIntercept(c,j,l)}else h(c,function(a){if(a.code=="100000")f[b+"_success"](a,i);else{var c=f[b+"_fail"];typeof c=="function"?f[b+"_fail"](a,i):f[b+"_success"](a,i)}});k=0},onFail:function(b){k=0;a.lib.dialog.ioError(b.code,b)}});m.request(i)}};j.load=function(a){j.request("smallList",a)};j.del=function(a){j.request("delete",a)};j.post=function(a){a.location=$CONFIG.location;a.pdetail=$CONFIG.page_id;j.request("add",a)};e.addUnloadEvent();return j}});
STK.register("conf.trans.funnyImg",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("funnypic",{url:"/aj/mblog/funnypic"});return b});
STK.register("lib.publisher.widget.funnyImg",function(a){var b=a.conf.trans.funnyImg,c=a.core.evt.addEvent,d=a.core.evt.removeEvent,e=a.core.json.jsonToQuery,f=a.lib.kit.extra.language,g=new RegExp(["^",f("#L{回复}"),"@([^:]*):$"].join("")),h=f("#L{搜索应用中的GIF}"),i='<li><img action-type="funny_img" action-data="{{actionData}}" src="{{imgsrc}}" alt="趣图"></li>',j='<li><img action-type="funny_img" action-data="{{actionData}}" src="{{imgsrc}}" alt="趣图"><i class="W_icon_tag_v2">'+f("#L{免费}")+"</i></li>",k='                <ul class="clearfix">                   {{imgs}}                </ul>',l='                <div class="tips">                <p><i class="W_loading"></i>'+f("#L{加载中}")+"</p>"+"                </div>",m='                <div class="tips">                <dl>                    <dt>'+f("#L{网络出错啦，请点击按钮重新加载！}")+"</dt>"+'                    <dd><a href="javascript:void(0);" action-type="refresh" class="W_btn_b btn_34px">'+f("#L{重新加载}")+"</a></dd>"+"                </dl>"+"                </div>",n='<div class="W_layer W_layer_pop" node-type="outer">    <div class="content">        <div class="W_layer_close"><a href="javascript:void(0);" action-type="close" class="W_ficon ficon_close S_ficon">X</a></div>        <div class="layer_WB_gif">        <div class="WB_search_s"><input type="text" value="'+h+'" node-type="keyword" action-type="keyword" class="W_input"><span class="pos"><a href="javascript:void(0);" action-type="search" title="搜索" class="W_ficon ficon_search S_ficon">f</a></span></div>'+'        <div class="gif_list" node-type="scrollView">'+l+"        </div>"+"        </div>"+'        <div class="W_layer_arrow"><span node-type="arrow" class="W_arrow_bor W_arrow_bor_t"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div>'+"    </div>"+"</div>",o='<div class="W_layer W_layer_pop" node-type="outer">    <div class="content">        <div class="W_layer_close"><a href="javascript:void(0);" action-type="close" class="W_ficon ficon_close S_ficon">X</a></div>        <div class="layer_WB_pic S_bg1" node-type="funnyContent"><img src="{{imgsrc}}" alt="趣图"></div>        <div class="W_layer_arrow"><span node-type="arrow" class="W_arrow_bor W_arrow_bor_t"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div>    </div></div>';return function(l,p){var q={t:2,l:-13,refer:l.nodeList.textEl,useAlign:!0,arrowOffset:-2,clickToHide:!1},r=null,s=null,t=null,u=null,v=null,w=null,x,y={getImg:function(c){var e=c&&"key_word"in c?c.key_word:"";(!u.funnyImg||!u.funnyImg.funnyKeyword||u.funnyImg.funnyKeyword!=e)&&b.request("funnypic",{onSuccess:function(a,b){y.insertImg(a.data.images);u.funnyImg={funnyKeyword:e,data:a.data}},onError:function(b,c){a.lib.dialog.ioError(b.code,b);t.scrollEl.innerHTML=m;if(b.code=="100002"||b.code=="100008"){y.bubDestroy();d(v.keyword,"focus",z.keywordFocus);d(v.keyword,"blur",z.keywordBlur)}}},c||{})},insertImg:function(a){var b="",c="";for(var d in a){c=a[d].type==1?i:j;b+=c.replace(/{{imgsrc}}|{{actionData}}/g,function(b){var c="";switch(b){case"{{imgsrc}}":c=a[d].large;break;case"{{actionData}}":c=e(a[d])}return c})}t.scrollEl.innerHTML=k.replace(/{{imgs}}/g,b);t.scrollTop(1)},showSelecImg:function(b){var c=l.nodeList.funnyBtn;if(!!c){l.nodeList.textEl.setAttribute("pid",b.pid);l.nodeList.textEl.setAttribute("pic_types",parseInt(b.type)+2);s=a.ui.bubble(o.replace(/{{imgsrc}}/g,b.large),{clickBlankToHide:!1,stopClickPropagation:!0,autoRelease:!0,showWithAni:"fadeInDown:fast",hideWithAni:"fadeOutUp:fast"});y.bindSelectImgEvt();q.refer?s.show().setArrow("top").setAlignPos(c,q.refer,q):s.show().beside(c,q);y.setPos(s,c);var d=l.nodeList.textEl.value;if(d==""||g.test(a.trim(d)))l.nodeList.textEl.value=d+"趣图评论"}},bindSelectImgEvt:function(){s.on("show",z.selecShow);s.on("hide",z.selecBubHide);s.on("close","click",z.selecBubClose)},bubDestroy:function(){if(r){r.off("refresh","click",z.refresh);r.off("search","click",z.search);r.off("close","click",z.close);r.off("keyword","keydown",z.keyword);r.off("funny_img","click",z.funny_img);r.destroy();r=null}},selecBubDestroy:function(){if(s){s.hide();s.off("hide",z.selecBubHide);s.off("close","click",z.selecBubClose);s.off("show",z.selecShow);s.destroy();s=null}},isShowInDocument:function(b){if(!a.contains(document.body,b))return!1;while(b&&b.style){if(a.getStyle(b,"display")==="none")return!1;b=b.parentNode}return!0},setPos:function(a,b){var c=l.nodeList.textEl;if(a.getState()){var d=a.getBox().parentNode,e=d&&a.getBox().nextSibling;a.setArrow("top").setAlignPos(b,c,{offset:{left:-1,top:2}});e&&d.insertBefore(a.getBox(),e)}}},z={refresh:function(a){y.getImg()},search:function(a){var b={key_word:v.keyword.value||""};y.getImg(b)},keyword:function(a){if(a.evt.keyCode==13){var b={key_word:v.keyword.value||""};y.getImg(b)}},keywordFocus:function(a){a.target.value==h&&(a.target.value="")},keywordBlur:function(a){a.target.value==""&&(a.target.value=h)},funny_img:function(b){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("comment_click","qutuchose");var c=u.funnyImg&&u.funnyImg.data&&u.funnyImg.data.mbtype?parseInt(u.funnyImg.data.mbtype):0;if(c==11||c==12||c==13||"type"in b.data&&parseInt(b.data.type)==2){y.bubDestroy();y.showSelecImg(b.data)}else a.ui.confirm(f("#L{会员可在评论中使用gif图，立即开通会员？}"),{icon:"rederrorB",okText:f("#L{立即开通会员}"),cancelText:f("#L{以后再说}"),OK:function(){window.open("//vip.weibo.com","_blank")}})},close:function(){y.bubDestroy();d(v.keyword,"focus",z.keywordFocus);d(v.keyword,"blur",z.keywordBlur)},bubHide:function(){l.nodeList.textEl.removeAttribute("pid");l.nodeList.textEl.removeAttribute("pic_types");y.bubDestroy();d(v.keyword,"focus",z.keywordFocus);d(v.keyword,"blur",z.keywordBlur)},selecBubHide:function(){x&&clearInterval(x);l.nodeList.textEl.removeAttribute("pid");l.nodeList.textEl.removeAttribute("pic_types")},selecBubClose:function(){y.selecBubDestroy()},selecShow:function(){var a=l.nodeList.funnyBtn;!s||!a?x&&clearInterval(x):x=setInterval(function(){if(y.isShowInDocument(a))y.setPos(s,a);else{x&&clearInterval(x);s.hide()}},500)}},A=function(){r.on("refresh","click",z.refresh);r.on("search","click",z.search);r.on("close","click",z.close);r.on("keyword","keydown",z.keyword);r.on("funny_img","click",z.funny_img);r.on("hide",z.bubHide);c(v.keyword,"focus",z.keywordFocus);c(v.keyword,"blur",z.keywordBlur)},B=function(){u=r.getDomList().outer;v=r.getDomList();t=a.ui.scrollView(v.scrollView);w=a.core.evt.delegatedEvent(u)},C=function(){B();A();y.getImg()},D={show:function(){var b=l.nodeList.funnyBtn;if(!!b){if(D.isShow())return;r=a.ui.bubble(n,{clickBlankToHide:!0,stopClickPropagation:!0,autoRelease:!0,showWithAni:"fadeInDown:fast",hideWithAni:"fadeOutUp:fast"});q.refer?r.show().setArrow("top").setAlignPos(b,q.refer,q):r.show().beside(b,q);C()}},destroy:function(){y.bubDestroy();y.selecBubDestroy();d(v.keyword,"focus",z.keywordFocus);d(v.keyword,"blur",z.keywordBlur)},isShow:function(){return!!r||!!s}};return D}});
STK.register("lib.comment.reply",function(a){var b=a.lib.kit.extra.language,c=a.conf.trans.feed.comment,d=a.core.dom.setStyle,e=a.core.dom.getStyle,f=a.core.evt.preventDefault,g=a.lib.kit.extra.setPlainHash,h=[],i={},j={reply:b("#L{回复}"),alert:b("#L{评论内容不能为空哦，写点东西吧。}"),success:b("#L{评论成功}"),block:b("#L{同时将此用户加入黑名单}"),approvalComment:b("#L{由于博主的设置，评论将由Ta筛选后显示}")},k=new RegExp(["^",j.reply,"@([^:]*):"].join("")),l=function(a,c){!a||(c=="normal"?a.innerHTML=b("#L{评论}"):a.innerHTML=b("#L{提交中...}"))},m=function(c,e){function M(a,b,c){return a.nodeName=="BODY"||a.nodeName=="body"?null:a.getAttribute(b)==c?a:arguments.callee(a.parentNode,b,c)}var f={},h,i,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I;a.custEvent.define(f,["reply"]);var J=a.core.evt.delegatedEvent(c),K={add_success:function(b){B=0;q.className="W_btn_a btn_noloading";l(s,"normal");i.API.reset();i.API.insertText(w);i.API.blur();d(c,"display","none");b.forward=t;a.custEvent.fire(f,"reply",[b]);a.ui.tip("lite",{msg:e.approvalComment?j.approvalComment:j.success,type:"succM",timer:"500"});D&&D.hideLayer();E&&E.hideLayer();H&&H.destroy()},add_fail:function(a){B=0;q.className="W_btn_a btn_noloading";l(s,"normal")},add_error:function(a){B=0;q.className="W_btn_a btn_noloading";l(s,"normal")}},L=function(){u=a.core.str.trim(p.value);u==w||u==""?!a.hasClassName(q,"W_btn_a_disable")&&a.addClassName(q,"W_btn_a_disable"):a.hasClassName(q,"W_btn_a_disable")&&a.removeClassName(q,"W_btn_a_disable")},N={onlyFunny:function(c){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("comment_click","qutu");D&&D.isShow()||E&&E.isShow()?a.ui.confirm(b("#L{确定放弃上传图片吗？}"),{icon:"rederrorB",okText:b("#L{确定}"),cancelText:b("#L{取消}"),OK:function(){D&&D.hideLayer();E&&E.hideLayer();H.show()}}):H.show()},onlyImg:function(c){if(e.canUploadImage!="0"&&H.isShow()){a.core.evt.stopEvent(c);a.ui.confirm(b("#L{确定放弃上传趣图吗？}"),{icon:"rederrorB",okText:b("#L{确定}"),cancelText:b("#L{取消}"),OK:function(){H.destroy();var b=a.sizzle("input",G)[0];b&&b.click()}})}}},O=function(c){if(!B){B=1;a.core.evt.preventDefault();t=o.checked?1:0;u=a.core.str.trim(p.value);x=u.match(k);var d=p.getAttribute("pid"),f=p.getAttribute("pic_types");if(d==="loading"){a.ui.tipAlert(b("#L{图片上传中请稍后}"),{icon:"rederrorS"}).beside(p).on("hide",function(){p.focus()});B=0;return}if(u==w||u==""){a.ui.tipAlert(j.alert,{icon:"rederrorS"}).beside(p);B=0;p.focus();!a.hasClassName(q,"W_btn_a_disable")&&a.addClassName(q,"W_btn_a_disable")}else{if(!x||!x[1]||x[1]!=v)e.cid=v=null;u=a.leftB(u,280);e.content=u;if(c&&c.el)var h=M(c.el,"node-type","root_comment"),i=h?h.getAttribute("comment_id"):"0";else var h=M(q,"node-type","root_comment"),i=h?h.getAttribute("comment_id"):"0";y=a.lib.kit.extra.getDiss(a.lib.kit.extra.merge(e,{act:"reply",content:u,forward:t,isroot:0,root_comment_id:i}),c.el);c&&c.el?c.el.className="W_btn_a W_btn_a_disable":q&&(q.className="W_btn_a W_btn_a_disable");l(s,"loading");g("_rnd"+(+(new Date)).toString());m=a.lib.comment.inter(K,y);y=a.lib.kit.extra.merge(c.data,y);d&&(y.pic_id=d);f&&(y.pic_types=f);m.post(y)}}};o=a.sizzle('[node-type="forward"]',c)[0];p=a.sizzle('[node-type="textEl"]',c)[0];q=a.sizzle('[action-type="doReply"]',c)[0];s=a.sizzle('[node-type="btnText"]',c)[0];F=a.sizzle('[node-type="smileyBtn"]',c)[0];I=a.sizzle('[node-type="funnyBtn"]',c)[0];G=a.sizzle('[node-type="imgBtn"]',c)[0];A=a.core.json.jsonToQuery(e);q.setAttribute("action-data",A);v=e.content;w=[j.reply,"@",v,":"].join("");try{h=a.lib.editor.base(c,{count:"disable"});i=h.editor;a.custEvent.define(i,"close");C=a.lib.publisher.widget.face(i);H=a.lib.publisher.widget.funnyImg(i);if(e.canUploadImage=="1"){D=a.lib.image.commentImage(i,G,{file_source:3});E=a.lib.image.pastePic(i,G)}}catch(P){}z=i.API.getWords();z==""?i.API.insertText(w):i.API.insertText("");J.add("doReply","click",O);a.addEvent(F,"click",C.show);a.addEvent(I,"click",N.onlyFunny);a.addEvent(G,"click",N.onlyImg);a.lib.kit.extra.keySubmit.on(p,O);n=setInterval(function(){L()},200);a.lib.kit.dom.autoHeightTextArea({textArea:p,maxHeight:9999,inputListener:function(){var b=a.trim(p.value);a.bLength(b)>280&&(p.value=a.leftB(b,280))}});f.focus=function(){i.API.insertText("")};f.destroy=function(){a.removeEvent(F,"click",C.show);D&&D.destroy();E&&E.destroy();H&&H.destroy();J&&J.destroy&&J.destroy();clearInterval(n);a.lib.kit.extra.keySubmit.off(p,O)};return f},n=function(b,c){var d=a.core.arr.indexOf(b,h);if(!i[d]){h[d=h.length]=b;i[d]=m(b,c)}return i[d]};return function(b,c){(!c||!c.mid)&&a.log("lib.comment/reply.js-------mid is not defined");return n(b,c)}});
STK.register("lib.comment.commentMsg",function(a){return{noPhoneReplyMsg:'#L{由于用户设置，你无法回复评论。}<br><a href="//account.weibo.com/settings/mobile" target="_blank">#L{绑定手机}</a>#L{后可以更多地参与评论。}',noPowerReplyMsg:"#L{由于用户设置，你无法回复评论。}"}});
STK.register("lib.dialog.commentDialogue",function(a){var b=a.lib.comment.commentMsg,c=a.lib.kit.extra.language,d={TITLE:c("#L{查看对话}"),FRAME:c('<div class="layer_dialogue_v5"><div class="WB_empty" node-type="topbox" style="display:none;"><div class="WB_innerwrap"><div class="empty_con clearfix"><p class="subtext" style="display:none;" node-type="more"></p></div>\t\t\t\t\t</div>\t\t\t</div><div class="WB_feed_repeat" node-type="scrollView"><!--模块最外层，需要设置定位和高度值--><div class="WB_repeat"><div class="repeat_list"><div class="list_box"><div class="list_ul" node-type="repeat_list"></div></div></div></div></div>  </div>'),MOREAREA:{LOADING:c('<span>&nbsp;<i class="W_loading"></i>#L{加载中...}</span>'),DELETEED:c("#L{回复记录中部分评论已被原作者删除。}"),RETRY:c('#L{加载失败，请}<a action-type="older" href="javascript:void(0)" onclick="return false;">#L{重试}</a>#L{。}'),DEFAULT:c('<a action-type="older" href="javascript:void(0)" onclick="return false;"><span class="more_arrow">&laquo;</span>#L{查看更早的评论}</a>')}},e={unReply:c(b.noPhoneReplyMsg),unPower:c(b.noPowerReplyMsg)},f=a.conf.trans.comment,g=a.lib.kit.extra.merge,h=a.ui.dialog({isHold:!0}),i=null,j=null,k=a.conf.trans.comment,l,m=!1;return function(){var b,c,n,o,p,q,r,s,t=!0,u=!1,v=[],w,x=function(){h.setTitle(d.TITLE);h.setContent(d.FRAME);var b=h.getDomList().inner;l=a.lib.kit.dom.parseDOM(a.builder(b).list);l.outer=h.getBox();l.inner=b;w=a.ui.scrollView(l.scrollView);y();m=!0},y=function(){r=a.core.evt.delegatedEvent(l.outer);r.add("older","click",b.getDialogueList);r.add("replycomment","click",z.show);a.custEvent.add(h,"hide",b.reset)},z={show:function(b){var c=b.el;{if(!a.core.dom.hasClassName(c,"unclick_rep")){b.data&&b.data.ispower=="1"?k.request("isComment",{onComplete:function(d){if(d.code=="100000")z.showReply(b);else{if(i){i.aniHide&&i.aniHide();i.destroy&&i.destroy();i=null}if(d.code=="100022")i=a.ui.tip("alert",{msg:e.unPower,type:"warn"});else if(d.code=="100001"){c&&c.setAttribute("isphone","1");i=a.ui.tip("alert",{msg:e.unReply,type:"warn"})}else i=a.ui.tip("alert",{msg:d.msg,type:"warn"});i.setLayerXY(c);i.aniShow();a.addClassName(c,"unclick_rep");j&&window.clearTimeout(j);j=window.setTimeout(function(){i.aniHide&&i.aniHide();i.destroy&&i.destroy();i=null},3e3)}}},b.data):z.showReply(b);return a.preventDefault(b.evt)}if(i){i.aniHide&&i.aniHide();i.destroy&&i.destroy();i=null}var d=c.getAttribute("isPhone");d?i=a.ui.tip("alert",{msg:e.unReply,type:"warn"}):i=a.ui.tip("alert",{msg:e.unPower,type:"warn"});i.setLayerXY(c);i.aniShow();j&&window.clearTimeout(j);j=window.setTimeout(function(){i.aniHide&&i.aniHide();i.destroy&&i.destroy();i=null},3e3)}},showReply:function(b){var c=b.el,d,e,f;while(c.className.toLowerCase()!="list_con")c=c.parentNode;d=a.sizzle('[node-type="commentwrap"]',c)[0];var h=b.el;e=h.getAttribute("status");var i=a.core.dom.dir(h,{expr:"li"});if(a.core.dom.getStyle(d,"display")!="none"&&e=="true"){h.setAttribute("status","false");a.core.dom.setStyle(d,"display","none");i[0]&&a.removeClassName(i[0],"curr")}else{h.setAttribute("status","true");a.core.dom.setStyle(d,"display","");i[0]&&a.addClassName(i[0],"curr");f&&f.focus()}if(!e){f=a.lib.comment.reply(d,g(b.data,{approvalComment:parseInt(s)?!0:!1}));f.liNode=i[0];z.funcs.add(f)}w.reset()},reply:function(b,c){a.conf.channel.feed.fire("reply",{obj:b,ret:c,cid:o});c.data&&c.data.content&&z.newDialogue(c.data.content)},newDialogue:function(b){a.core.dom.insertHTML(l.repeat_list,b,"beforeend")},funcs:{add:function(b){var c=z.funcs.get(b);if(!v[c]){v.push(b);a.custEvent.add(b,"reply",z.reply);a.custEvent.add(b,"reply",function(){b.liNode&&a.removeClassName(b.liNode,"curr")})}},remove:function(b){if(v[b]){a.custEvent.remove(b);v[b]=null;delete v[b]}},get:function(a){var b,c=!1;for(var d=0;d<v.length;d++){var e=v[d];if(e==a){b=d;c=!0;break}}return b},destroy:function(){for(var a=0;a<v.length;a++)z.funcs.remove(a)}}};b={show:function(a){!m&&x();t=!0;c=a.data.cid;n=a.data.ouid;o=c;p=a.data.cuid;q=a.data.type||"small";s=a.data.need_approval_comment||"0";b.display();b.getDialogueList()},getCid:function(){var d=!1,e=a.lib.kit.dom.firstChild(l.repeat_list);if(e)var d=e.getAttribute("cid");if(d){c=d;b.moreArea.show()}else b.moreArea.hide()},getDialogueList:function(){var e={cid:c,type:q,ouid:n,cuid:p};t&&(e.is_more=1);if(!u){b.loading.start();f.request("dialogue",{onComplete:function(c){b.loading.end();if(c.code=="100000"){c.data&&c.data.html&&b.addContent(c.data.html);t=!1;b.getCid();b.moreArea.setContent(c.msg?c.msg:d.MOREAREA.DEFAULT)}else if(c.code=="100001"){b.moreArea.setContent(d.MOREAREA.RETRY);b.moreArea.show()}else if(c.code=="100011"){b.moreArea.setContent(d.MOREAREA.DELETEED);b.moreArea.show()}else a.lib.dialog.ioError(c.code,c);w.reset()}},e)}w.reset()},getOldDialogueList:function(){var e={cid:c,type:q,ouid:n,cuid:p};t&&(e.is_more=1);if(!u){b.loading.start();f.request("dialogue",{onComplete:function(c){b.loading.end();if(c.code=="100000"){c.data&&c.data.html&&b.loadmore(c.data.html);t=!1;b.getCid();b.moreArea.setContent(c.msg?c.msg:d.MOREAREA.DEFAULT)}else if(c.code=="100001"){b.moreArea.setContent(d.MOREAREA.RETRY);b.moreArea.show()}else if(c.code=="100011"){b.moreArea.setContent(d.MOREAREA.DELETEED);b.moreArea.show()}else a.lib.dialog.ioError(c.code,c);w.reset()}},e)}w.reset()},loading:{start:function(){u=!0;b.moreArea.setContent(d.MOREAREA.LOADING)},end:function(){u=!1;b.moreArea.setContent(d.MOREAREA.DEFAULT)}},addContent:function(b){a.core.dom.insertHTML(l.repeat_list,b,"afterbegin")},loadmore:function(b){var c=a.sizzle('[node-type="commentconversation"]',l.repeat_list)[0];a.core.dom.insertHTML(c,b,"afterbegin")},moreArea:{show:function(){a.setStyle(l.more,"display","");a.setStyle(l.topbox,"display","")},hide:function(){a.setStyle(l.more,"display","none");a.setStyle(l.topbox,"display","none")},setContent:function(a){l.more.innerHTML=a}},display:function(){b.clear();h.show();h.setMiddle();a.setStyle(l.outer,"top",parseInt(a.getStyle(l.outer,"top"))-30+"px")},clear:function(){l.repeat_list.innerHTML=""},reset:function(){t=!0;b.moreArea.show();b.clear();z.funcs.destroy()},destroy:function(){b=null,z=null;z.funcs.destroy();j&&window.clearTimeout(j);i&&i.aniHide&&i.aniHide();i&&i.destroy&&i.destroy();i=null}};return b}});
STK.register("lib.comment.commentTemp",function(a){function b(b){b=b||{};var c="LAB_"+a.getUniqueKey(),d=b.canUploadImage=="1",e=b.canUploadFunnypic||"0";return'<div node-type="commentwrap" class="WB_repeat_in S_bg2"><div class="WB_feed_publish clearfix"><div class="WB_publish"> <div class="p_input"><textarea node-type="textEl" class="W_input"></textarea></div><div class="p_opt clearfix"> <div class="btn W_fr"><a node-type="btnText" action-type="doReply" href="javascript:;" class="W_btn_a W_btn_a_disable">#L{评论}</a></div> <div node-type="widget" class="opt clearfix"><span class="ico"><a node-type="smileyBtn" href="javascript:void(0);"><i class="W_ficon ficon_face">o</i></a></span>'+(parseInt(e)?'<span class="ico"><a node-type="funnyBtn" href="javascript:void(0);"><i class="W_ficon ficon_gif"></i></a></span>':"")+(d?'<span class="ico"><a node-type="imgBtn" href="javascript:void(0);"><i class="W_ficon ficon_image">p</i></a></span>':'<span class="ico"><a node-type="imgBtn" href="javascript:void(0);" style="cursor:default;" title="非会员暂不支持网页版评论发图功能"><i class="W_ficon ficon_image S_ficon_dis">p</i></a></span>')+' <ul class="ipt">'+'<li><label class="W_label" for="'+c+'"><input node-type="forward" name="" type="checkbox" value="" class="W_checkbox" id="'+c+'"><span>#L{同时转发到我的微博}</span></label></li>'+" </ul>"+"</div>"+"</div>"+"</div>"+"</div>"+"</div>"+""}var c='<#et temp data><div class="WB_expand_media ${data.bgClass}"><div class="tab_feed_a clearfix"><div class="tab"><ul class="clearfix"><li><span class="line S_line1"><a action-type="comment_media_toSmall" href="javascript:void(0);" class="S_txt1" <#if (data.suda && data.suda.retract)>suda-data="${data.suda.retract}"</#if> ><i class="W_ficon ficon_arrow_fold S_ficon">k</i>#L{收起}</a></span></li><li><span class="line S_line1"><a action-type="widget_commentPhotoView" action-data="${data.acdata}" href="javascript:void(0);" class="S_txt1" <#if (data.suda && data.suda.showBig)>suda-data="${data.suda.showBig}"</#if>><i class="W_ficon ficon_search S_ficon">f</i>#L{查看大图}</a></span></li><li><span class="line S_line1"><a action-type="comment_media_toLeft" href="javascript:void(0);" class="S_txt1" <#if (data.suda && data.suda.left)>suda-data="${data.suda.left}"</#if>><i class="W_ficon ficon_turnleft S_ficon">m</i>#L{向左转}</a></span></li><li><span class="line S_line1"><a action-type="comment_media_toRight" href="javascript:void(0);" class="S_txt1" <#if (data.suda && data.suda.right)>suda-data="${data.suda.right}"</#if>><i class="W_ficon ficon_turnright S_ficon">n</i>#L{向右转}</a></span></li></ul></div></div><div class="WB_media_view"><div class="media_show_box"><ul class="clearfix"><li class="smallcursor" action-type="comment_media_bigimgDiv" <#if (data.suda && data.suda.big)>suda-data="${data.suda.big}"</#if>><div class="artwork_box"><img dynamic-id="${data.uniqueId}" action-type="comment_media_bigimg" src="${data.bigSrc}" width="${data.bigWidth}" alt=""></div></li></ul></div></div></div></#et>';return{reply:b(),getReply:b,mediaImage:c}});
STK.register("conf.trans.photoview",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("list",{url:"/aj/photo/popview",method:"get"});c("superPhotoAlbumlist",{url:"/p/aj/proxy?api=http://i.huati.weibo.com/pcpage/papp",method:"get"});c("bloginfo",{url:"/aj/v6/mblog/photolayer",method:"get"});c("poprecomalbum",{url:"/aj/v6/photo/poprecomalbum",method:"get"});c("commentList",{url:"/aj/v6/comment/big",method:"get"});c("forwardList",{url:"/aj/v6/mblog/info/big",method:"get"});c("toMicroblog",{url:"/aj/v6/mblog/forward",method:"post"});return b});
STK.register("lib.photoview.source.channel",function(a){var b=["like","likeChangedFromLayer","updateLayerLikeBtn","commentCount","forwordCount","fakeForwordData"];return a.lib.kit.extra.listener.define("lib.photoview.source.channel",b)});
STK.register("lib.photoview.source.inter",function(a){var b=null,c=function(){},d=a.ui.alert,e,f=a.lib.dialog.commentPrivateSetting,g=a.lib.kit.extra.language,h=function(b,c){if(b&&b.code){b.code!="100000"&&b.code!="100005"&&a.lib.dialog.ioError(b.code,b);c(b)}};return function(f,i){e=a.lib.dialog.validateCode();var j={},k=0,l=a.conf.trans.feed.comment;f=a.parseParam({delete_success:c,delete_fail:c,delete_error:c,add_success:c,add_fail:c,add_error:c,smallList_success:c,smallList_fail:c,smallList_error:c},f||{});j.conf=a.parseParam({act:b,mid:b,cid:b,uid:$CONFIG.uid,page:b,forward:b,isroot:b,content:b,type:b,is_block:b,appkey:b},i);j.merge=function(b){b=a.lib.kit.extra.merge(j.conf,b);return a.core.obj.clear(b)};j.request=function(b,c){if(!k){k=1;var i=j.merge(c),m=l.getTrans(b,{onComplete:function(c,j){if(b=="add"){var l={onSuccess:function(a,c){h(a,function(a){f[b+(a.code=="100000"?"_success":"_fail")](a,i)})},onError:function(c,e){f[b+"_error"](c,i);c.code=="100005"?d(g("#L{由于对方隐私设置，你无法进行评论。}"),{textSmall:g("#L{绑定手机后可以更多地参与评论。}")+'<a href="http://account.weibo.com/settings/mobile" target="_blank">'+g("#L{立即绑定}")+"</a>"}):a.lib.dialog.ioError(c.code,c)},param:i,requestAjax:m};e.validateIntercept(c,j,l)}else h(c,function(a){if(a.code=="100000")f[b+"_success"](a,i);else{var c=f[b+"_fail"];typeof c=="function"?f[b+"_fail"](a,i):f[b+"_success"](a,i)}});k=0},onFail:function(){k=0}});m.request(i)}};j.load=function(a,b){f.smallList_success(a,b)};j.del=function(a){j.request("delete",a)};j.post=function(a){j.request("add",a)};e.addUnloadEvent();return j}});
STK.register("lib.photoview.source.setTextarea",function(a){function h(b){var c=b.parentNode;return c&&c.nodeType===1&&a.contains(document.body,c)}function g(c,d){a.foreach(d,function(a,d){b(c,d,a)})}var b=a.setStyle,c=a.addEvent,d=a.removeEvent,e=a.addClassName,f=a.removeClassName;return function(b,i){var j,k=0,l,m=0,n=function(){if(!b||!h(b))r();else{var a=b.scrollTop;if(a!==m)if(a>=l){e(i,"set_top");g(i,{position:"relative",zoom:1,top:a-l+"px",zIndex:9999})}else{f(i,"set_top");g(i,{position:"relative",top:"0px"})}m=b.scrollTop}},o=function(){j&&clearInterval(j);j=setInterval(n,100)},p=function(a){k&&clearTimeout(k);clearInterval(j);n();k=setTimeout(o,100)},q=function(b,d){if(!b||!d)throw new Error("Illegal argument. target and reference not a valid node.");l=a.position(d,{parent:b}).t;c(b,"scroll",p);o()},r=function(){if(!!b){d(b,"scroll",p);if(k){clearTimeout(k);k=null}if(j){clearInterval(j);j=null}b=null;i=null}};q(b,i);var s={destroy:r};return s}});
STK.register("lib.photoview.source.util",function(a){var b=a.foreach,c=a.setStyle;return{mix:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},isJSON:function(a){var b=typeof a=="object"&&Object.prototype.toString.call(a).toLowerCase()=="[object object]"&&!a.length;return b},throttle:function(a,b){b=b?b:150;if(b===-1)return function(){a.apply(this,arguments)};var c;return function(){var d=+(new Date);if(!c||d-c>b){c=d;a.apply(this,arguments)}}},debounce:function(a,b,c,d){var e;return function(){var f=d||this,g=arguments,h=function(){e=null;c||a.apply(f,g)},i=c&&!e;clearTimeout(e);e=setTimeout(h,b);i&&a.apply(f,g)}},formateJson:function(a){if(!!this.isJSON(a)){var b=[];for(var c in a)b.push(a[c]);return b.join(";")}},empty:function(a){var b;if(a)while(b=a.firstChild)a.removeChild(b)},setStyles:function(a,d){b(d,function(b,d){c(a,d,b)})}}});
STK.register("lib.videoview.source.comment",function(a){function H(b){var c=a.builder(b);G(c.list);return c.box}function G(a){a=g(a);for(var b in a)a.hasOwnProperty(b)&&(F[b]=a[b])}var b=a.lib.photoview.source,c=b.util.mix,d=a.lib.comment.commentMsg,e=a.lib.comment.commentTemp,f=a.lib.comment.reply,g=a.lib.kit.dom.parseDOM,h="",i=a.ui.alert,j=a.ui.tip,k=a.lib.kit.extra.language,l=a.custEvent,m=a.sizzle,n=a.setStyle,o=a.core.dom,p=a.core.evt.preventDefault,q=a.conf.trans.feed.comment,r=a.lib.kit.dom.children,s=a.core.evt.removeEvent,t=a.addClassName,u=a.removeClassName,v,w,x,y,z=!1,A=!1,B=!1,C=1,D,E='<div><i class="W_loading"></i> <span>正在加载中，请稍候...</span></div>',F={},I=function(a,b){return m(a,b)[0]},J=a.lib.photoview.source.channel,K={content:k("#L{评论内容不能为空哦，写点东西吧。}"),"delete":k("#L{确定要删除该回复吗}"),reply:k("#L{回复}"),blcok:k("#L{同时将此用户加入黑名单}"),notice:k("#L{输入评论内容}"),unReply:k(d.noPhoneReplyMsg),unPower:k(d.noPowerReplyMsg)},L=function(a){return parseInt(a.innerHTML.replace(/[^\d]+/,""))||0},M=function(b,d){var g=d.mid,i,m,p,u,A,C,E,G=new RegExp(["^",K.reply,"@([^:]*):(.*)"].join("")),L=a.core.str,M=a.lib.dialog.commentDialogue(),P={},R,S,T,U,V,W,X=function(e){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("big_pic_cover","commt_pub_button");var f=a.trim(w.value),g=f.match(G),j=w.getAttribute("pid");if(j==="loading")a.ui.tipAlert(k("#L{图片上传中请稍后}"),{icon:"rederrorS"}).beside(w).on("hide",function(){w.focus()});else{if(f==""||g&&a.trim(g[2])==""||f==K.notice){a.ui.tipAlert(K.content,{icon:"rederrorS"}).beside(w).on("hide",function(){w.focus()});return}if(!g||!g[1]||g[1]!=p)i=p=null;h=e.el.innerHTML;e&&e.el?e.el.className="W_btn_a W_btn_a_disable":I('[action-type="post"]',b).className="W_btn_a W_btn_a_disable";var l=a.lib.kit.extra.getDiss({act:g?"reply":"post",cid:i,content:L.leftB(f,280),isroot:A&&A.checked?"1":"0",forward:u&&u.checked?"1":"0",appkey:d.appkey,mark:d.mark,type:"videolayer",pic_src:d.shouldPicSrc?"layer":""},e.el);c(l,{log_type:"weibo",refer_sort:"layer",location:$CONFIG.location,pdetail:$CONFIG.page_id});j&&(l.pic_id=j);bh.post(l)}},Y=function(b){var h=b.el,i=b.data.cid,j=b.data.nick,m=b.data.canUploadImage==1,n=b.data.canUploadFunnypic||"0",p="videolayer",q=o.dir(h,{dir:"parent",expr:"li",matchAll:!1})[0],r=d.mark||"",s=o.dir(h,{dir:"parent",expr:".WB_func",matchAll:!1})[0],t=P[i]&&P[i].DOM,u=t?a.core.dom.contains(document.body,t):!1;if(t&&a.getStyle(t,"display")!="none"&&u){a.setStyle(t,"display","none");a.removeClassName(q,"curr")}else{if(!t||!u){t=a.builder(k(e.getReply({canUploadImage:m,canUploadFunnypic:n}))).list.commentwrap[0];s&&a.core.dom.insertAfter(t,s);var v={mid:g,cid:i,content:j,mark:r,module:"scommlist",type:p};c(v,{log_type:"weibo",refer_sort:"layer",location:$CONFIG.location,pdetail:$CONFIG.page_id});P[i]={handle:f(t,v),DOM:t};l.add(P[i].handle,"reply",bc,{liItem:q})}a.setStyle(t,"display","");a.addClassName(q,"curr");P[i]&&P[i].handle.focus()}},Z=function(){var a,b,c=function(){b&&window.clearTimeout(b);if(a){a.aniHide();a.destroy();a=null}},d=function(d){c();a=j("alert",{msg:d,type:"warn"});b=window.setTimeout(c,3e3);return a};d.hide=c;return d}(),_=function(b){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("big_pic_cover","commt_list_reply");var c=b.el,d=b.data,e;if(a.core.dom.hasClassName(c,"unclick_rep")){var f=c.getAttribute("isPhone");f?e=Z(K.unReply):e=Z(K.unPower);e.setLayerXY(c);e.aniShow()}else d&&d.ispower=="1"?q.request("isComment",{onComplete:function(a){if(a.code=="100000"){var f,g;d&&(f=d.nick)&&Y(b)}else{if(a.code=="100022")e=Z(K.unPower);else if(a.code=="100001"){e=Z(K.unReply);c&&c.setAttribute("isphone","1")}else e=Z(K.msg);e.setLayerXY(c);e.aniShow();t(c,"unclick_rep")}},onSuccess:a.funcEmpty},d):Y(b)},ba=function(b){var c=b.data.block?['<input node-type="block_user" id="block_user" name="block_user" value="1" type="checkbox"/><label for="block_user">',K.blcok,"</label>"].join(""):"";a.ui.confirm(K["delete"],{OK:function(a){var c=a.block_user,d,e;(d=b.data)&&(e=d.cid)&&bh.del({act:"delete",cid:e,is_block:c?"1":"0"})},textComplex:c})},bb=function(a){m=a.data.cid;M.show(a)},bc=function(a,b){bd(b,a.data)},bd=function(b,c){var d=b.data;if(!d)return!1;i=p=null;c&&c.liItem&&a.removeClassName(c.liItem,"curr");if(d.comment&&y){a.insertHTML(y,d.comment,"afterbegin");Q()}d.feed&&J.fire("forwardCount",1);J.fire("commentCount",1);bf.changeSubmitBtn();return!0},be=function(){if(!B){var a=F.commentMore;if(a.getAttribute("data-local")==="1"){var b=F.todo_more,c=r(b),d=c.length,e=D.pagenum<D.totalpage;while(d-->4)n(c[d],"display","");a.removeAttribute("data-local");n(a,"display",e?"block":"none");Q()}else{z=!0;O(bh)}}},bf={checkIsEmpty:function(){var c=new RegExp(["^",K.reply,"@([^:]*):(.*)"].join("")),d=a.sizzle("[node-type='submit']",b)[0],e=a.trim(w.value.replace(K.notice,"")),f=e.match(c);d&&(e==""||f&&a.trim(f[2])==""?!a.hasClassName(d,"W_btn_a_disable")&&a.addClassName(d,"W_btn_a_disable"):a.hasClassName(d,"W_btn_a_disable")&&a.removeClassName(d,"W_btn_a_disable"))},changeSubmitBtn:function(){var a=I("a[action-type='post']",b);a.className="W_btn_a";h&&(a.innerHTML=h)},add_success:function(a,b){if(bd(a)){w.value="输入评论内容";var c=I("[node-type=showCommentBtn]",v),d=I("a[node-type=submit]",c);d.className="W_btn_a";n(c,"display","none");n(w,"height","25px");W&&W.hideLayer()}},add_fail:function(){bf.changeSubmitBtn()},add_error:function(){bf.changeSubmitBtn()},delete_success:function(a,c){var d=I(['div[comment_id="'+c.cid+'"]'].join(""),b);if(d){d.parentNode.removeChild(d);J.fire("commentCount",-1);Q()}},delete_fail:function(a,b){},smallList_success:function(c,d){d.focus=!1;var e=c,f={limitNum:140,tipText:K.notice,count:"disable"};if(!!e){b.innerHTML="";b.appendChild(H(c.html));w=F.textEl;T=setTimeout(function(){if(w){a.lib.kit.dom.autoHeightTextArea({textArea:w,maxHeight:9999,inputListener:function(){var b=a.trim(w.value);L.bLength(b)>280&&(w.value=L.leftB(b,280))}});try{E=a.lib.editor.base(b,f);C=E.editor;l.define(C,"close");var c=a.sizzle('[node-type="smileyBtn"]',b)[0],e=a.sizzle('[node-type="imgBtn"]',b)[0];V=a.lib.publisher.widget.face(C);W=a.lib.image.commentImage(C,e,{placeholder:K.notice});a.addEvent(c,"click",V.show);S=setInterval(function(){bf.checkIsEmpty()},200);d.focus&&a.core.dom.selectText(w,{start:0});d.focus&&w.focus()}catch(g){}}},150);a.addEvent(w,"focus",N);u=I("input[name=forward]",b);A=I("input[name=isroot]",b);x=I("div[node-type=commentList]",b);y=I("div[node-type=todo_more]",b);a.core.evt.hotKey.add(x,["ctrl+enter"],X);bg.add("reply","click",_);bg.add("delete","click",ba);bg.add("post","click",X);bg.add("commentDialogue","click",bb);bg.add("commentMoreBtn","click",be)}}},bg=a.delegatedEvent(b),bh=a.lib.photoview.source.inter(bf,d);l.define(bh,["count","feed","comment","del","destroy"]);bh.disposed=!1;bh.focus=function(){w&&w.focus()};bh.destroy=function(){if(!bh.disposed){bh.disposed=!0;if(C){E.destroy();C=null;E=null}if(T){clearTimeout(T);T=null}if(U){U.destroy();U=null}if(R){bg.remove("qface_send","click",R.send);R.destroy();R=null}a.foreach(P,function(a){l.remove(a.handle);l.undefine(a.handle);a.DOM=null;a.handle=null});a.core.evt.hotKey.remove(x,["ctrl+enter"],X);S&&clearInterval(S);Z.hide();bg.remove("commentMoreBtn","click",be);bg.remove("check","foucs",N);bg.remove("reply","click",_);bg.remove("delete","click",ba);bg.remove("post","click",X);bg.remove("commentDialogue","click",bb);bg.destroy();s(w,"focus",N);l.remove(bh);l.undefine(bh)}};return bh},N=function(){a.trim(w.value)==K.notice&&(w.value="");var b=I("[node-type=showCommentBtn]",v),c=I("a[node-type=submit]",b);n(b,"display","")},O=function(b,c){if(!B){B=!0;var d={};d.id=T.mid;d.type="videolayer";d.page=C||1;z&&(F.showCommentMore.innerHTML=E);a.conf.trans.photoview.request("commentList",{onSuccess:function(a,c){P(b,a,c)},onError:function(b){a.lib.dialog.ioError(b.code,b)}},d)}},P=function(b,c,d){if(!b.disposed){B=!1;var e=c.data,f=e&&a.trim(e.html||"");if(!A){A=!0;U.load(T,{focus:!0,mid:T.mid});n(F.showCommentBtn,"display",f?"none":"block")}var g=e.page||{},h=F.commentMore,i=F.showCommentMore,j=F.todo_more,l=!1;if(f){if(g.pagenum===1){var m=T.tabCount,o=T.barCount,p=parseInt(e.count,10)||0;m&&m.innerHTML.indexOf("万")<0&&(m.innerHTML=p>0?k("#L{评论}")+p:k("#L{评论}"));o&&o.innerHTML.indexOf("万")<0&&(o.innerHTML=p>0?p:k("#L{评论}"));f=a.builder(f);var q=r(f.box),s=q.length,t=4;l=s>t;if(l){h.setAttribute("data-local","1");while(s-->t)n(q[s],"display","none")}j.appendChild(f.box)}else{l=g.pagenum<g.totalpage;a.insertHTML(j,f)}C=g.pagenum+1;D=g}n(h,"display",l?"block":"none");i.innerHTML="查看更多评论";Q()}},Q=function(){var a=F.todo_more;if(a){var b=r(a),c=b.length,d=c-1,e=F.commentMore.style.display==="none";while(c--){var f=b[c];e&&c===d?t(f,"last"):u(f,"last")}}},R=function(a){var b=T.tabCount,c=T.barCount,d=b&&L(b);a<0?--d:++d;b&&b.innerHTML.indexOf("万")<0&&(b.innerHTML=d>0?k("#L{评论}")+d:k("#L{评论}"));c&&c.innerHTML.indexOf("万")<0&&(c.innerHTML=d>0?d:k("#L{评论}"))},S=!1,T,U,V=function(a,b,c){U=a;T=c;v=b;A=!1;z=!1;C=1;B=!1;O(a)},W=function(a){S=!0;J.register("commentCount",R)};return function(a,b){S||W(a);a.html.shouldPicSrc=a.shouldPicSrc;if(!a||!a.mid)throw"mid is not defined";var c=M(b,a);V(c,b,a);return c}});
STK.register("lib.videoview.source.like",function(a){var b=a.conf.trans.feed.attitude,c=a.conf.channel.like,d=a.lib.kit.extra.language,e=a.lib.videoview.source,f=e.utils,g=e.eventemitter,h=a.lib.dialog.validateCode(),i=a.core.json.merge;f=i(f,{});var j={events_:["likeOrNot","destroy"],click:function(b){var c=a.sizzle("[node-type=like_status]",b.el)[0]||b.el;if(!c.animate_&&!c.isRequest){var d=b.data,e=a.sizzle("em",c);c.iconEl_=e[0];c.numEl_=e[1];c.oldNum_=c.numEl_.innerHTML|0;this.likeOrNot_(c,d);this.animateOrNot_(c);this.request_(c,d)}},likeOrNot_:function(b){b.likeStatus_===undefined&&(b.likeStatus_=!!a.hasClassName(b,"UI_ani_praised"));var c=Math.max(0,b.oldNum_+(b.likeStatus_?-1:1));b.likeStatus_=c>b.oldNum_?1:0;b.numEl_.innerHTML.indexOf("万")<0&&(b.numEl_.innerHTML=c>0?c:d("#L{赞}"));this.fire("likeOrNot",c)},animateOrNot_:function(b){var c=b.iconEl_,d=a.hasClassName(c,"W_ficon"),e=!b.likeStatus_;if(d)if(e)a.removeClassName(b,"UI_ani_praised");else{a.removeClassName(b,"UI_ani_praised");a.addClassName(b,"UI_ani_stepsV1");b.animate_&&clearTimeout(b.animate_);b.animate_=null;b.animate_=setTimeout(function(){a.removeClassName(b,"UI_ani_stepsV1");a.addClassName(b,"UI_ani_praised");b.animate_&&clearTimeout(b.animate_);b.animate_=null;!b.likeStatus_&&a.removeClassName(b,"UI_ani_praised")},900)}else if(e){a.removeClassName(c,"icon_praised_bc");a.addClassName(c,"icon_praised_b")}else{b.animate_=!0;a.ui.effect(c,"bounce","200",function(){if(b.likeStatus_){a.removeClassName(c,"icon_praised_b");a.addClassName(c,"icon_praised_bc")}delete b.animate_})}},request_:function(d,e){d.isRequest=!0;var f=e.object_type==="comment"||e.object_id?"objLike":"miniadd",g=i({location:"videolayer"},e),j=function(a){var b=!a.data.is_del;c.fire(b?"like":"unlike",g);d.isRequest=!1},k=function(b){a.lib.dialog.ioError(b.code,b);d.isRequest=!1},l=b.getTrans(f,{onComplete:function(a,b){var c={onSuccess:j,onError:k,requestAjax:l,param:g,onRelease:function(){clearTimeout(d.isRequest);delete d.isRequest}};h.validateIntercept(a,b,c)},onFail:k},g);l.request(g)},destroy:function(){this.fire("destroy");this.remove()}},k=g.extend(j);return k});
STK.register("lib.dialog.tipAlert",function(a){var b=a.lib.kit.extra.language;return function(c){var d=c&&c.msg||b("#L{抱歉，此内容被多名用户举报为营销信息，根据《微博社区公约》第二十八条、第二十九条，已被限制传播。}"),e=a.parseParam({title:b("#L{友情提示}"),icon:"warnB",okText:b("#L{确定}"),timer:0,OK:function(){}},c||{});a.ui.alert(d,e)}});
STK.register("lib.videoview.source.info",function(a){var b=a.conf.trans.videoView,c=a.lib.kit.extra.language,d=a.core.util.easyTemplate,e=a.lib.videoview.source,f=e.utils,g=e.eventemitter,h=a.lib.forward.forwardDialog,i=a.lib.videoview.source.comment,j=a.lib.videoview.source.like,k=a.lib.dialog.tipAlert,l=a.core.json.merge,m={empty:d(c('<#et empty data><div class="WB_empty"><div class="WB_innerwrap"><div class="empty_con clearfix"><p class="text" node-type="empty_load"><i class="W_loading"></i>#L{加载中}</p><p class="text" node-type="empty_try" style="display:none;"><i class="W_icon icon_rederrorS"></i>#L{加载失败}<a action-type="info_empty_try" action-data="mid=${data.mid}" href="javascript:void(0);">#L{点击刷新重试}</a></p></div></div></div></#et>')),fold:d(c('<#et foldBtn data><a href="javascript:void(0);" ignore="ignore" suda-data="key=original_blog_unfold&amp;value=click_pickup:${data.mid}:${data.uid}" class="WB_text_opt" action-type="fl_fold">#L{收起全文}<i class="W_ficon ficon_arrow_up">d</i></a></#et>'))};f=l(f,{});var n=["destroy"],o=function(a){if(!(this instanceof q))return new q(a);if(this.initialized_)return this;g.call(this,n);this.layer_=a;this.player_=a.getPlayer();this.dEvent_=a.dEvent();this.vBar_=a.getDom("video_bar");this.mInfo_=a.getDom("inactive_info");this.mComment_=a.getDom("inactive_comment");this.mComCount_=a.getDom("bar_comment_count");this.initEvents_();this.initialized_=!0},p={initEvents_:function(){var a=this,b=this.player_.obj_.actionData,c=b.current_mid||b.mid;this.getInfo(null,c);this.changeInfo_=f.bind(a,a.getInfo);this.layer_.on("changeInfo",this.changeInfo_);this.handleChangePlayer_=f.bind(a,a.changePlayer_);this.layer_.on("changePlayer",this.handleChangePlayer_);this.handleForward_=f.bind(a,a.forward_);this.handleComment_=f.bind(a,a.comment_);this.handleLike_=f.bind(a,a.like_);this.dEvent_.add("layer_forward","click",this.handleForward_);this.dEvent_.add("layer_comment","click",this.handleComment_);this.dEvent_.add("layer_like","click",this.handleLike_);this.handleUnfold_=f.bind(a,a.unfold_);this.handleFold_=f.bind(a,a.fold_);this.handleEmptyTry_=f.bind(a,a.emptyTry_);this.dEvent_.add("fl_unfold","click",this.handleUnfold_);this.dEvent_.add("fl_fold","click",this.handleFold_);this.dEvent_.add("info_empty_try","click",this.handleEmptyTry_);this.layer_.one("destroy",f.bind(a,a.destroy))},changePlayer_:function(a,b){this.player_=b},getInfo:function(d,e){var f=this;if(f.mid_!=e&&!!e){f.mInfo_.innerHTML=m.empty({mid:e}).toString();f.mid_=e;var g=function(b){var d=b.data;if(!!d){d.bar&&d.bar.html&&(f.vBar_.innerHTML=d.bar.html);if(d.mblog&&d.mblog.info){f.mInfo_.innerHTML=d.mblog.info;f.infoTxt_=a.sizzle('[node-type="info_content"]',f.mInfo_)[0];f.infoUnfold_=a.sizzle('[node-type="info_unfold"]',f.mInfo_)[0];f.infoTxtFull_=null}f.mComCount_.innerHTML=d.comment&&d.comment.count?c("#L{评论}"+d.comment.count):c("#L{评论}");var g=a.sizzle('[action-type="layer_comment"]>em',f.vBar_)[1];f.commentList_&&f.commentList_.destroy&&f.commentList_.destroy();f.commentList_=i({html:d.comment.html,dEvent:f.dEvent_,mid:e,tabCount:f.mComCount_,barCount:g},f.mComment_)}},h=function(b){var c=a.sizzle('[node-type="empty_load"]',f.mInfo_)[0],d=a.sizzle('[node-type="empty_try"]',f.mInfo_)[0];c&&a.setStyle(c,"display","none");d&&a.setStyle(d,"display","");f.infoTxt_=null;f.infoUnfold_=null;f.infoTxtFull_=null;f.mid_=null};if(!navigator.onLine){h();return}b.request("blogInfo",{onSuccess:g,onError:h},{mid:e})}},emptyTry_:function(a){this.getInfo(a.evt,a.data.mid)},unfold_:function(c){a.preventDefault(c.evt);var d=this,e=c.el;if(e.loading!==!0&&!!this.infoTxt_){if(this.infoTxtFull_){a.setStyle(this.infoTxt_,"display","none");this.infoUnfold_&&a.setStyle(this.infoUnfold_,"display","none");a.setStyle(this.infoTxtFull_,"display","");return}var f=function(b){d.infoTxtFull_=a.C("div");d.infoTxtFull_.className=d.infoTxt_.className+" WB_text_all";d.infoTxtFull_.innerHTML=b.data.html+m.fold({mid:c.data.mid,uid:$CONFIG.uid}).toString();a.insertAfter(d.infoTxtFull_,d.infoTxt_);a.setStyle(d.infoTxt_,"display","none");d.infoUnfold_&&a.setStyle(d.infoUnfold_,"display","none");e.loading=!1},g=function(b){a.lib.dialog.ioError(b.code,b);e.loading=!1};b.request("fullText",{onSuccess:f,onError:g},c.data)}},fold_:function(b){a.preventDefault(b.evt);if(!!this.infoTxt_&&!!this.infoTxtFull_){a.setStyle(this.infoTxt_,"display","");this.infoUnfold_&&a.setStyle(this.infoUnfold_,"display","");a.setStyle(this.infoTxtFull_,"display","none")}},forward_:function(b){var c=this,d=b.data,e=b.el,f={};d.name&&(f.originNick=d.name);d.rootname&&(f.forwardNick=d.rootname);d.origin&&(d.origin=decodeURIComponent(d.origin));d.reason&&(d.reason=decodeURIComponent(d.reason));f=l(f,d);this.forward_=h(d.mid,f);c.wasPlaying_=!c.player_.paused();c.wasPlaying_&&c.player_.pause();a.custEvent.once(this.forward_,"hide",function(a){c.wasPlaying_&&c.player_.play();c.wasPlaying_=null;c.forward_=null});a.custEvent.once(this.forward_,"forward",function(b,d){var f=a.sizzle("em",e)[1];d.countEl=f;c.upForwardNum_(b,d)});a.custEvent.once(this.forward_,"updateNum",function(b,d){var f=a.sizzle("em",e)[1];d.countEl=f;c.upForwardNum_(b,d)})},upForwardNum_:function(a,b){var c=b.countEl;if(!!c){var d=0,e,f=b.backnum,g=c.innerHTML.match(/\s\d+/);g=g?parseInt(g[0]):0;b.cevtType=="forward"&&(d=1);f&&f>g?e=f+d:e=g+d;e&&c.innerHTML.indexOf("万")<0&&(c.innerHTML=e)}},comment_:function(a){var b=this;if(b.layer_.selectedTab_!="comment"){var c=b.layer_.getDom("recom_tab"),d=b.layer_.getDom("comment_tab");b.layer_.switchTab_({el:d,data:{type:"comment",other:"recom"}})}b.commentList_.focus()},like_:function(a){j.click(a)},destroy:function(){var a=this;this.fire("destroy");this.layer_&&this.layer_.off("changeInfo",this.changeInfo_);this.layer_&&this.layer_.off("changePlayer",this.handleChangePlayer_);this.forward_&&this.forward_.destroy&&this.forward_.destroy();this.forward_=null;this.commentList_&&this.commentList_.destroy&&this.commentList_.destroy();this.commentList_=null;j&&j.destroy&&j.destroy();this.dEvent_&&this.dEvent_.remove("layer_forward","click",this.handleForward_);this.dEvent_&&this.dEvent_.remove("layer_comment","click",this.handleComment_);this.dEvent_&&this.dEvent_.remove("layer_like","click",this.handleLike_);this.dEvent_&&this.dEvent_.remove("fl_unfold","click",this.handleUnfold_);this.dEvent_&&this.dEvent_.remove("fl_fold","click",this.handleFold_);this.dEvent_&&this.dEvent_.remove("info_empty_try","click",this.handleEmptyTry_);this.remove()}},q=g.extend(o,p);return q});
STK.register("lib.videoview.source.media",function(a){var b=a.lib.kit.extra.language,c=a.lib.kit.io.cors,d=a.core.util.easyTemplate,e=a.conf.trans.feed.feed,f=a.lib.kit.extra.sparkMD5,g=a.lib.kit.extra.sendImage,h=a.lib.kit.extra.getWantTime,i=a.lib.kit.extra.storageLog,j=a.lib.videoview.source,k=j.utils,l=a.lib.feed.plugins.videos.video,m=a.lib.feed.plugins.videos.followBtn,n=a.lib.feed.plugins.videos.quality,o=a.lib.feed.plugins.videos.vplus,p=a.lib.feed.plugins.videos.ad,q=a.lib.feed.plugins.video.log,r=a.core.json.merge,s={str:"Log_videoLayer",transKey:"h5playlog"},t="yixiong&zhaolong5",u={80000002:2,80000008:1};k=r(k,{md5Data:function(b,c,d){var e={};e.data=a.jsonToStr(b);e.key=c;e.sig=e.data&&c&&d&&e.data+c+d;e.sig=f.hash(e.sig);return e}});var v={},w,x,y,z,A,B=!1,C,D,E;x={canplay:function(a){this.play();var b=this,c=this.obj_;c.ad&&c.adData&&c.adData.type=="pread"&&c.adData.fCount>=0?c.ad.one("adEnded",function(a,c){c=="pread"&&b.play()}):this.play()},fullscreenchange:function(a){this.isFullscreen()?V.flag_.fullScreen=!0:V.flag_.fullScreen=!1},sendLog:function(a){if(!(this.getValidTime()<=0)){var b;this.log_.playduration=Math.round(this.currentTime()*1e3);this.log_.valid_play_duration=Math.round(this.getValidTime()*1e3);this.resetValidTime();this.log_&&(b=k.formateJson(this.log_));b&&E.set(b)}},sendHistory:function(a){if($CONFIG.islogin=="1"){var b=this,d=Math.floor(+(new Date).getTime()/1e3),e=this.currentTime();if(d==this.lastSendHistory_)return;this.lastSendHistory_=d;var f=this.obj_&&this.obj_.actionData,g={source:"2637646381",play_type:this.clicked_?1:0,video_orientation:f&&f.video_orientation||"horizontal",video_duration:f&&f.duration||parseInt(this.duration(),10),id:f&&f.current_mid?f.current_mid:f.mid,id_type:0,seconds:parseInt(e,10),oid:f&&f.objectid},h=function(a){b.nextReportDelay_=a&&a.data&&a.data.next_report_delay_seconds||0},i=function(a){b.nextReportDelay_=1},j=function(a){b.nextReportDelay_=1};c({url:"//multimedia.api.weibo.com/2/multimedia/user/play_history/report.json",args:g,header:{"Content-Type":"application/x-www-form-urlencoded"},method:"post",onSuccess:h,onError:i,onTimeout:j})}},playCount:function(a,b){var c=b||this.obj_;if(!!c){var d=c.node,f=c.actionData,g=k.md5Data({uid:$CONFIG.uid,mid:f.mid,keys:f.keys,type:f.type},k.getUniqueKey(),t);e.request("playstatistics",{},g)}},dispose:function(a){w.offListen(this);delete V.players[this.id()]}};w={createLogObj:function(b){var c,d;d=b.actionData;if(!!d){c=a.jsonClone(D);c=C.setExtend(c,{sid:C.sid(),qType:"480",vf:"layer"});b.vData&&(b.vData.isPay==1&&b.vData.isOpen==0||b.vData.isFake==1)&&(c=C.setExtend(c,{pay:"s"}));b.vSrcs&&b.vSrcs.qType&&(c=C.setExtend(c,{qType:b.vSrcs.qType}));c.uid=$CONFIG&&$CONFIG.uid||"";c.mid=d.mid;c.mid_uid=d.uid;c.rootuid=d.ruid;c.rootmid=d.rmid;c.object_id=d.objectid;c.duration=d.duration;c.encode_mode=d.encode_mode;c.bitrate=d.bitrate;c.isautoplay=V.isAuto_?"1":"0";return c}},createObj:function(a,b){if(!(!a||!b||!b.action_data)){var c,d,e,f,g,h,i,j,l,m,n;d=k.getUniqueKey();h=b.action_data;i=b.follow_data;j=b.video_sources;j.key=d;if(j&&j.qType&&j.qType!="720"&&j.qType!="1080"){!h.video_src&&j[j.qType]&&(h.video_src=j[j.qType]);j.noQuality=!0}l=b.vplus_data;m=b.ad_data;f=this.createLogObj({actionData:h,vData:l,vSrcs:j});e=a.getDom("video_box");c={type:h.type=="feedlive"?"live":"video",key:d,container:e,actionData:h,logObj:f,vSrcs:j,follow:i,vData:l,adData:m};return c}},initMedia:function(a,b){var c,d,e,f;d=this.createObj(a,b);f=d.actionData;e=function(){this.log_=d.logObj;this.obj_=d;d.adData&&p.init(this,d);d.vSrcs&&!d.vSrcs.noQuality?n.init(this,d.vSrcs):this.cache_.vSrcs=d.vSrcs;d.follow&&d.follow.need_follow==1&&m.init(this,d.follow);d.vData&&(d.vData.isPay==1||d.vData.isFake==1)&&o(this,d.vData)};c=l({obj:d,id:d.key,container:d.container,doubleToFullScreen:!0,muted:!1,className:["wbv-deployable"],poster:f.cover_img&&decodeURIComponent(f.cover_img),sources:[{src:f.video_src&&decodeURIComponent(f.video_src),type:"video/mp4"}],cb:e});d.media=c;w.onListen(c);return c},onListen:function(a){if(!!a)for(var b in x)a.on(b,x[b])},offListen:function(a){if(!!a)for(var b in x)a.off(b,x[b])}};y=function(){C=q();D=C.Obj;E=i(s)};A=function(){y()};v={init:function(a,b){if(!B){A();B=!0}var c=w.initMedia(a,b);return c},destroy:function(){B=!1;E&&E.destroy&&E.destroy();E=null}};return v});
STK.register("lib.videoview.source.recommend",function(a){var b=a.conf.trans.videoView,c=a.lib.kit.extra.language,d=a.core.util.easyTemplate,e=a.lib.videoview.source,f=e.utils,g=e.eventemitter,h=a.lib.videoview.source.media,i=a.core.json.merge,j=d(c('<#et empty data><div class="WB_empty"><div class="WB_innerwrap"><div class="empty_con clearfix"><p class="text" node-type="empty_load"><i class="W_loading"></i>#L{加载中}</p><p class="text" node-type="empty_try" style="display:none;"><i class="W_icon icon_rederrorS"></i>#L{加载失败}<a action-type="empty_try" action-data="mid=${data.mid}&uid=${data.uid}&oid=${data.oid}" href="javascript:void(0);">#L{点击刷新重试}</a></p></div></div></div></#et>')),k=d(c('<#et vError data><div class="video_box_error"><h3>#L{网络不可用，请检查网络设置}</h3><div action-type="error_try" action-data="index=${data.index}&mid=${data.mid}&recom_code=${data.recom_code}&recomid=${data.recomid}"><a href="javascript:void(0);"><span></span><em>#L{重试}</em></a></div></div></#et>')),l=d(c('<#et recommend_list data><ul><#list data.recomentlist as list><li class="PCD_video_a" suda-uatrack="key=video_recommend&value=next_list" action-type="recom_card" action-data="index=${list.index}&mid=${list.mid}&recom_code=${list.recom_code}&recomid=${list.recomid}"><div class="pic_txt clearfix"><div node-type="recom_img" class="pic_box W_piccut_v"><img src="${list.img_url}" alt=""><span class="time W_f12">${list.duration}</span></div><div class="info_box"><div class="info_box_inner"><div class="text_box"><div class="text_cut W_f12">${list.text}</div></div><div class="subinfo_box clearfix"><span class="subinfo W_autocut W_f12 S_txt2">${list.fnick}</span></div></div></div></div></li></#list><span node-type="recom_play_txt" class="txt" style="display:none;">#L{正在播放}</span></ul></#et>')),m=d(c('<#et end_cover data><ul class="WB_video_list_b WB_video_list_b${data.type}" node-type="end_box"><#list data.recomentlist as list><li class="PCD_video_b" suda-uatrack="key=video_recommend&value=grid_recommend" action-type="end_card" action-data="index=${list.index}&mid=${list.mid}&recom_code=${list.recom_code}&recomid=${list.recomid}"><div class="pic_box W_piccut_v"><img src="${list.img_url}" alt=""><dl><dt><h3>${list.text}</h3><p class="W_autocut"><img src="${list.imageurl}" class="W_face_radius">${list.fnick}</p></dt><dd class="clearfix"><span class="W_fl">${list.play_count}#L{次观看}</span><span class="W_fr">${list.duration}</span></dd></dl></div></li></#list></ul><div class="wbv-error-display"><div class="box"><button class="wbv-error-replay" suda-uatrack="key=video_recommend&value=grid_replay" action-type="end_replay"><span aria-hidden="true" class="wbv-icon-placeholder"></span><span class="wbv-control-text">重播</span></button></div></div></#et>')),n=d(c('<#et next_video data><div class="PCD_video_a"><div class="pic_txt clearfix"><div action-type="next_card" suda-uatrack="key=video_recommend&value=next_video" action-data="index=${data.index}&mid=${data.mid}&recom_code=${data.recom_code}&recomid=${data.recomid}"><div class="pic_box W_piccut_v"><img src="${data.img_url}" alt=""><span class="time W_f12">${data.duration}</span><span class="txt">#L{即将播放}</span><div class="W_icon icon_btn_imgplay"><svg width="100%" height="100%" version="1.1" viewBox="0 0 30 30"><circle cx="15" cy="15" fill-opacity="0" r="14" stroke="#fff" stroke-width="2" stroke-dasharray="0 88"></circle></svg></div></div><div class="info_box"><div class="info_box_inner"><div class="text_box"><div class="text_cut W_f12">${data.text}</div></div><div class="subinfo_box clearfix"><span class="subinfo W_autocut W_f12 S_txt2">${data.fnick}</span><span class="subinfo_rgt W_autocut W_f12 S_txt2"><em class="W_ficon ficon_cd_music">K</em>${data.play_count}</span></div></div></div></div><div class="opt_box"><a href="javascript:void(0);" action-type="next_close"><em class="W_ficon ficon_close">X</em></a></div></div></div></#et>'));f=i(f,{});var o=["destroy"],p=function(a){if(!(this instanceof r))return new r(a);if(this.initialized_)return this;g.call(this,o);this.layer_=a;this.player_=a.getPlayer();this.dEvent_=a.dEvent();this.index_=-1;this.mRecom_=a.getDom("inactive_recom");this.vMore_=a.getDom("video_more");this.vNext_=a.getDom("video_next");this.initEvents_();this.initialized_=!0},q={initEvents_:function(){var a=this,b=this.player_.obj_.actionData,c=b.objectid,d=this.player_.log_.rootmid,e=this.player_.log_.rootuid;this.getRecom_(d,c,e);this.handleChangePlayer_=f.bind(a,a.changePlayer_);this.layer_.on("changePlayer",this.handleChangePlayer_);this.handleNextClose_=f.bind(a,a.nextClose_);this.handleNextCardClick_=f.bind(a,a.nextCardClick_);this.handleEndCardClick_=f.bind(a,a.endCardClick_);this.handleRecomCardClick_=f.bind(a,a.recomCardClick_);this.handleErrorTryClick_=f.bind(a,a.errorTryClick_);this.handleEmptyTryClick_=f.bind(a,a.emptyTryClick_);this.dEvent_.add("next_close","click",this.handleNextClose_);this.dEvent_.add("next_card","click",this.handleNextCardClick_);this.dEvent_.add("end_card","click",this.handleEndCardClick_);this.dEvent_.add("recom_card","click",this.handleRecomCardClick_);this.dEvent_.add("error_try","click",this.handleErrorTryClick_);this.dEvent_.add("empty_try","click",this.handleEmptyTryClick_);this.handleReplay_=f.bind(a,a.replay_);this.dEvent_.add("end_replay","click",this.handleReplay_);this.handleResize_=f.bind(a,a.resize_);this.layer_.on("resize",this.handleResize_);this.layer_.one("destroy",f.bind(a,a.destroy))},changePlayer_:function(a,b){this.player_=b},resize_:function(b,c){var d=c.width-290;d>=500&&d<=670?a.addClassName(this.endBoxEl_,"WB_video_list_b3"):a.removeClassName(this.endBoxEl_,"WB_video_list_b3")},getRecom_:function(c,d,e){var f=this;if(!(f.hasRecommend_||f.mid_==c||!c||!d||!e)){f.mRecom_.innerHTML=j({uid:e,mid:c,oid:d}).toString();f.mid_=c;var g=function(b){var c=b.data;if(!c||!c.recomentlist||c.recomentlist.length<=0){var d=f.layer_.getDom("recom_tab"),e=f.layer_.getDom("comment_tab");f.layer_.switchTab_({el:e,data:{type:"comment",other:"recom"}},d)}else{a.foreach(c.recomentlist,function(a,b){a.index=b});f.recomList_=c.recomentlist;var g={},h=c.recomentlist.length;if(h<=4){g=c;g.type="2"}else if(h>9){g.recomentlist=c.recomentlist.slice(0,9);g.type="1"}else{g=c;g.type="1"}f.mRecom_.innerHTML=l(c).toString();f.rendNext();f.vMore_.innerHTML=m(g).toString();f.recomImgEls_=f.layer_.getDom("recom_img",!0);f.recomPlayTxtEl_=f.layer_.getDom("recom_play_txt");f.endBoxEl_=f.layer_.getDom("end_box");var i=f.layer_.get("vSize");i&&i[0]>=500&&i[0]<=670&&a.addClassName(f.endBoxEl_,"WB_video_list_b3");f.hasRecommend_=!0}},h=function(b){var c=a.sizzle('[node-type="empty_load"]',f.mRecom_)[0],d=a.sizzle('[node-type="empty_try"]',f.mRecom_)[0];c&&a.setStyle(c,"display","none");d&&a.setStyle(d,"display","");f.mid_=null};if(!navigator.onLine){h();return}b.request("recommend",{onSuccess:g,onError:h},{mid:c,oid:d,authorid:e})}},rendNext:function(){var b=this,c=this.recomList_.length;this.index_+1<=c-1?this.nextIndex_=this.index_+1:this.nextIndex_=0;this.nextItem_=this.recomList_[this.nextIndex_];this.vNext_.innerHTML=n(this.nextItem_).toString();a.setStyle(this.vNext_,"display","none");this.nextCircle_=a.sizzle("circle",this.vNext_)[0];this.circleNum_=0;if(!this.closeNext_){this.handleTimeUpdate_=f.bind(this,this.timeupdate_);this.player_.on("timeupdate",this.handleTimeUpdate_)}this.handleEnded_=f.bind(this,this.ended_);this.player_.on("ended",this.handleEnded_);this.handlePlay_=f.bind(this,this.play_);this.player_.on("play",this.handlePlay_);this.handleVReplay_=f.bind(this,this.vReplay_);this.handleVPause_=this.vPause.bind(this);this.player_.on("replay",this.handleVReplay_);this.player_.on("seeking",this.handleVReplay_);this.player_.on("pause",this.handleVPause_);this.offListen_=function(){!this.closeNext_&&this.player_.off("timeupdate",this.handleTimeUpdate_);this.player_.off("ended",this.handleEnded_);this.player_.off("play",this.handlePlay_);this.player_.off("replay",this.handleVReplay_);this.player_.off("seeking",this.handleVReplay_);this.player_.off("pause",this.handleVPause_);clearInterval(this.nextTimer_)}},vPause:function(a){if(!this.player_.tech_.el_.ended){clearInterval(this.nextTimer_);this.circleNum_=0;this.nextCircle_&&this.nextCircle_.setAttribute("stroke-dasharray",this.circleNum_+" 88")}},vReplay_:function(a){clearInterval(this.nextTimer_);this.circleNum_=0;this.nextCircle_&&this.nextCircle_.setAttribute("stroke-dasharray",this.circleNum_+" 88")},play_:function(b){var c=this;a.setStyle(this.vMore_,"display","none")},timeupdate_:function(b){var c=this;a.setStyle(this.vNext_,"display","none");var d=this.player_.remainingTime();if(!(d>3||this.closeNext_)){a.setStyle(this.vNext_,"display","");clearInterval(this.nextTimer_);this.nextTimer_=setInterval(f.bind(this,this.nextInterval_),6e3/88,b)}},ended_:function(b){if(this.player_&&this.player_.cache_.vData&&!this.player_.cache_.vData.isOpen){a.setStyle(this.vNext_,"display","none");a.setStyle(this.vMore_,"display","none")}else if(this.closeNext_){a.setStyle(this.vNext_,"display","none");a.setStyle(this.vMore_,"display","")}},nextInterval_:function(a){this.circleNum_++;this.nextCircle_&&this.nextCircle_.setAttribute("stroke-dasharray",this.circleNum_+" 88");if(!this.nextCircle_||this.circleNum_>=88){clearInterval(this.nextTimer_);this.circleNum_=0;this.playRecom(a,this.nextItem_)}},replay_:function(a){this.player_&&this.player_.play()},errorTryClick_:function(a){this.player_.off("timeupdate",this.handleTimeUpdate_);this.playRecom(a.evt,a.data)},emptyTryClick_:function(a){this.getRecom_(a.data)},nextClose_:function(b){a.setStyle(this.vNext_,"display","none");this.closeNext_=!0;this.player_.off("timeupdate",this.handleTimeUpdate_);clearInterval(this.nextTimer_)},nextCardClick_:function(b){var c=a.fixEvent(b.evt).target;c.tagName.toLowerCase()=="a"&&a.preventDefault(b.evt);a.setStyle(this.vNext_,"display","none");this.player_.off("timeupdate",this.handleTimeUpdate_);this.playRecom(b.evt,b.data)},endCardClick_:function(b){var c=a.fixEvent(b.evt).target;c.tagName.toLowerCase()=="a"&&a.preventDefault(b.evt);this.player_.off("timeupdate",this.handleTimeUpdate_);this.playRecom(b.evt,b.data)},recomCardClick_:function(b){var c=a.fixEvent(b.evt).target;c.tagName.toLowerCase()=="a"&&a.preventDefault(b.evt);this.player_.off("timeupdate",this.handleTimeUpdate_);this.playRecom(b.evt,b.data)},playRecom:function(b,c){if(!this.changing_){clearInterval(this.nextTimer_);this.changing_=!0;var d=this,e=this.mid_=c.mid;this.index_=parseInt(c.index,10);var f=this.player_.obj_;if(b.type=="ended"&&f.ad&&f.adData&&f.adData.type=="endad"&&f.adData.eCount>=0){a.setStyle(this.vNext_,"display","none");f.ad.one("adEnded",function(a,b){d.changeMedia()});return}this.changeMedia()}},changeMedia:function(){var c=this,d=function(b){var d=b.data&&b.data[c.mid_];if(!d||!d.action_data)e(b);else{c.layer_.fire("changeInfo",c.mid_);c.initMedia(c.layer_,d);c.rendNext();if(c.index_>=0&&c.recomImgEls_&&c.recomPlayTxtEl_){c.recomImgEls_[c.index_].appendChild(c.recomPlayTxtEl_);a.setStyle(c.recomPlayTxtEl_,"display","")}c.changing_=!1}},e=function(a){var b=c.layer_;if(b.initialLayerKey_&&b.initialLayerKey_==c.player_.id()){c.offListen_();c.player_.pause();c.player_.trigger("outLayer",{action:"change"})}else V.flag_.layer&&c.player_&&c.player_.dispose();var d=b.getDom("video_box");d.innerHTML=k(c.recomList_[c.index_]).toString();c.changing_=!1};navigator.onLine?b.request("videoInfo",{onSuccess:d,onError:e},{mid:this.mid_}):e()},initMedia:function(a,b){if(a.initialLayerKey_&&a.initialLayerKey_==this.player_.id()){this.offListen_();this.player_.pause();this.player_.trigger("outLayer",{action:"change"})}else V.flag_.layer&&this.player_&&this.player_.dispose();var c=h.init(a,b);a.setPlayer(c)},destroy:function(){var a=this;this.remove();this.fire("destroy");this.offListen_&&this.offListen_();clearInterval(this.nextTimer_);this.layer_&&this.layer_.off("changePlayer",this.handleChangePlayer_);this.layer_&&this.layer_.off("resize",this.handleResize_);this.dEvent_&&this.dEvent_.remove("next_close","click",this.handleNextClose_);this.dEvent_&&this.dEvent_.remove("next_card","click",this.handleNextCardClick_);this.dEvent_&&this.dEvent_.remove("end_card","click",this.handleEndCardClick_);this.dEvent_&&this.dEvent_.remove("recom_card","click",this.handleRecomCardClick_);this.dEvent_&&this.dEvent_.remove("end_replay","click",this.handleReplay_);this.dEvent_&&this.dEvent_.remove("error_try","click",this.handleErrorTryClick_);this.dEvent_&&this.dEvent_.remove("empty_try","click",this.handleEmptyTryClick_);h&&h.destroy&&h.destroy();this.changing_=!1;this.hasRecommend_=!1}},r=g.extend(p,q);return r});
STK.register("lib.kit.extra.browserUA",function(){return function(a){if(!a)return{};a=a.toLowerCase();var b,c,d,e,f,g=function(a){var b=0;return parseFloat(a.replace(/\./g,function(){return b++==1?"":"."}))},h=function(){return!!window.ActiveXObject||"ActiveXObject"in window?!0:!1};try{/windows|win32/i.test(a)?f="windows":/macintosh/i.test(a)?f="macintosh":/rhino/i.test(a)&&(f="rhino");if((c=a.match(/applewebkit\/([^\s]*)/))&&c[1]){b="webkit";e=g(c[1])}else if((c=a.match(/presto\/([\d.]*)/))&&c[1]){b="presto";e=g(c[1])}else if(c=a.match(/msie\s([^;]*)/)){b="trident";e=1;(c=a.match(/trident\/([\d.]*)/))&&c[1]&&(e=g(c[1]))}else if(/gecko/.test(a)){b="gecko";e=1;(c=a.match(/rv:([\d.]*)/))&&c[1]&&(e=g(c[1]))}/world/.test(a)?d="world":/360se/.test(a)?d="360":/maxthon/.test(a)||typeof external.max_version=="number"?d="maxthon":/tencenttraveler\s([\d.]*)/.test(a)?d="tt":/se\s([\d.]*)/.test(a)&&(d="sogou")}catch(i){}var j={OS:f,CORE:b,Version:e,EXTRA:d?d:!1,IE:h(),OPERA:/opera/.test(a),MOZ:/gecko/.test(a)&&!/(compatible|webkit)/.test(a),IE5:/msie 5 /.test(a),IE55:/msie 5.5/.test(a),IE6:/msie 6/.test(a),IE7:/msie 7/.test(a),IE8:/msie 8/.test(a),IE9:/msie 9/.test(a),IE10:/msie 10/.test(a),IE11:/trident/.test(a)&&/rv:11\.0/.test(a),EDGE:/edge/.test(a)&&!h(),SAFARI:!/chrome\/([\d.]*)/.test(a)&&/\/([\da-f.]*) safari/.test(a),CHROME:/chrome\/([\d.]*)/.test(a),IPAD:/\(ipad/i.test(a),IPHONE:/\(iphone/i.test(a),ITOUCH:/\(itouch/i.test(a),MOBILE:/mobile/i.test(a)};return j}});
STK.register("lib.videoview.source.mask",function(a){var b=a.lib.kit.dom.fix,c=a.lib.videoview.source.utils,d=a.lib.videoview.source.eventemitter,e={maskNodeKey_:"stk-mask-key",nodeRegList_:[],events_:["beforeShow","afterShow","beforeHide","afterHide"],getMaskNodeReg_:function(a){var b=a.getAttribute(this.maskNodeKey_);if(!b){b=c.getUniqueKey("Mask_");a.setAttribute(this.maskNodeKey_,b)}return">"+a.tagName.toLowerCase()+"["+this.maskNodeKey_+"="+b+"]"},initMask:function(){var d=a.sizzle('[node-type="video_mask"]',document.body)[0];if(d)this.maskNode_=d;else{this.maskNode_=a.C("div");this.maskNode_.setAttribute("node-type","video_mask");document.body.appendChild(this.maskNode_)}this.hasMask_=!0;this.beforeFix_();if(!this.fixDom_){this.fixDom_=b(this.maskNode_,"lt");a.custEvent.add(this.fixDom_,"beforeFix",c.bind(this,this.beforeFix_))}},beforeFix_:function(b){var c=a.winSize();this.maskNode_.style.cssText=a.core.dom.cssText(this.maskNode_.style.cssText).push("width",c.width+"px").push("height",c.height+"px").getCss()},getNode:function(){return this.maskNode_},show:function(b){(!this.hasMask_||!this.maskNode_||!this.fixDom_)&&this.initMask();this.fire("beforeShow");b=a.parseParam({opacity:.3,background:"#000000"},b);b.display="";c.setStyles(this.maskNode_,b);this.fixDom_.setAlign("lt");this.hasShown_=!0;this.fire("afterShow");return this},hide:function(){this.fire("beforeHide");a.setStyle(this.maskNode_,"display","none");this.hasShown_=!1;this.nodeRegList_=[];this.fire("afterHide");return this},forwardShow:function(b,c){if(!!a.isNode(b)){this.show(c);a.setStyle(this.maskNode_,"zIndex",a.getStyle(b,"zIndex"));var d=this.getMaskNodeReg_(b),e=a.arrIndexOf(this.nodeRegList_,d);e>-1&&this.nodeRegList_.splice(e,1);this.nodeRegList_.push(d);a.insertBefore(this.maskNode_,b);return this}},backShow:function(){if(this.nodeRegList_.length<1)return this;var b,c;this.nodeRegList_.pop();if(this.nodeRegList_.length<1)this.hide();else{c=this.nodeRegList_[this.nodeRegList_.length-1];b=c&&a.sizzle(c,document.body)[0];if(!b)return this;a.setStyle(this.maskNode_,"zIndex",a.getStyle(b,"zIndex"));a.insertBefore(this.maskNode_,b)}return this},resetSize:function(){var b=a.winSize();this.maskNode_.style.cssText=a.core.dom.cssText(this.maskNode_.style.cssText).push("width",b.width+"px").push("height",b.height+"px").getCss();return this},destroy:function(){this.hide();this.remove();a.custEvent.remove(this.fixDom_);this.fixDom_=null;a.removeNode(this.maskNode_);this.maskNode_=null;this.hasMask_=!1}},f=d.extend(e);return f});
STK.register("lib.videoview.source.overlayer",function(a){var b=a.lib.kit.extra.browserUA(navigator.userAgent),c=a.lib.kit.extra.language,d=a.core.util.easyTemplate,e=a.lib.videoview.source,f=e.mask,g=e.utils,h=e.eventemitter,i=document.documentElement,j=a.core.json.merge,k=a.core.dom.getSize,l=d(c('<#et video_layer data><div class="layer_multivideo_preview W_layer" node-type="layer_outer"><div node-type="layer_box" class="multivideo_preview"><a action-type="close" href="javascript:void(0);" class="close" title="#L{关闭}"></a><div node-type="layer_scroller" class="scroller"><div node-type="layer_inner" class="inner clearfix"><div node-type="layer_right" class="info_box W_fr S_bg2"><div node-type="inactive_scroller" class="scroller_box"><div class="inner_box"><div class="WB_feed_type"><div node-type="inactive_info" class="WB_feed_detail clearfix"></div><div node-type="inactive_tabs" class="WB_func clearfix S_line1"><div class="WB_handle"><ul class="clearfix"><li suda-uatrack="key=video_recommend&value=comment_tab" action-type="inactive_tab" action-data="type=comment&other=recom" node-type="comment_tab"><span class="line S_line1"><a href="javascript:void(0);" node-type="bar_comment_count" class="S_txt1">#L{评论}</a></span><span class="arrow"><span class="W_arrow_bor W_arrow_bor_t"><i class="S_bg1_br"></i></span></span></li><li suda-uatrack="key=video_recommend&value=next_tab" action-type="inactive_tab" action-data="type=recom&other=comment" node-type="recom_tab" class="curr"><span class="line S_line1"><a href="javascript:void(0);" class="S_txt1">#L{即将播出}</a></span></i></span></span></li></ul></div></div><div node-type="inactive_comment" class="WB_feed_repeat S_bg1" style="display:none"></div><div node-type="inactive_recom" class="WB_video_list_a"></div></div></div></div></div><div node-type="layer_left" class="video_box"><div node-type="video_box" class="video_box_inner"></div><div node-type="video_bar" class="video_box_bar"></div><div node-type="video_next" class="video_box_next" style="display:none"></div><div node-type="video_more" class="video_box_more" style="display:none"></div></div></div></div></div></div></#et>'));g=j(g,{canFixed:function(){if(this.canFixed.value!==undefined)return this.canFixed.value;var a=document.createElement("div"),b=a.cloneNode(!1),c=!1,d=document.body||function(){c=!0;return documentElement.appendChild(document.createElement("body"))}();a.style.cssText="position:fixed;top:42px";d.appendChild(a);d.appendChild(b);var e=a.offsetTop!==b.offsetTop;d.removeChild(a);d.removeChild(b);c&&documentElement.removeChild(d);this.canFixed.value=e;return e},fixOffset:function(a){a[1]===undefined&&(a[1]=a[0]);a[2]===undefined&&(a[2]=a[0]);a[3]===undefined&&(a[3]=a[1]);return a},getStyleVal:function(b,c){var d=parseFloat(a.getStyle(b,c));return isNaN(d)?0:d},getShellVal:function(a,b){switch(b){case"height":return this.getStyleVal(a,"marginTop")+this.getStyleVal(a,"marginBottom")+this.getStyleVal(a,"paddingTop")+this.getStyleVal(a,"paddingBottom")+this.getStyleVal(a,"borderTopWidth")+this.getStyleVal(a,"borderBottomWidth");case"width":return this.getStyleVal(a,"marginLeft")+this.getStyleVal(a,"marginRight")+this.getStyleVal(a,"paddingLeft")+this.getStyleVal(a,"paddingRight")+this.getStyleVal(a,"borderLeftWidth")+this.getStyleVal(a,"borderRightWidth");default:return this.getStyleVal(a,b)}return this.getStyleVal(a,b)},getSize:function(a){var b=k(a);b.width+=this.getStyleVal(a,"marginLeft")+this.getStyleVal(a,"marginRight");b.height+=this.getStyleVal(a,"marginTop")+this.getStyleVal(a,"marginBottom");return b},setMiddle:function(b,c){c=c||window;var d=this.getSize(b),e=c===window?a.winSize():this.getSize(c),f=Math.max((e.width-d.width)/2,0),h=Math.max((e.height-d.height)/2,0);c===window&&a.getStyle(b,"position")!=="fixed"&&(h+=a.scrollPos().top);g.setStyles(b,{top:(h>0?h:0)+"px",left:(f>0?f:0)+"px"})}});var m=["beforeShow","afterShow","beforeHide","afterHide","changePlayer","resize","destroy"],n=function(b,c){if(!(this instanceof p))return new p(b,c);if(this.initialized_)return this;h.call(this,m);this.player_=b;var d=a.winSize(),e=d.width,f=d.height;this.options_=c=j({limits:{maxWidth:e,maxHeight:f,minWidth:790,minHeight:321},offset:[0,0],style:{zIndex:9999,position:"absolute"}},c,{isDeep:!0});g.fixOffset(c.offset);var i=a.ui.mlayer({template:l({test:1}).toString(),autoRelease:!0,showWithAni:"fadeIn:slow",hideWithAni:"bounceOut:fast"});this.layer_=i;this.node_=i.getBox();this.nodes_=i.getDomList();this.dEvent_=i.dEvent();this.initEvents_();this.initialized_=!0},o={initEvents_:function(){var b=this,c=this.node_,d=this.dEvent_;this.handleResize_=g.debounce(function(){b.resize()},50);this.handleHide_=function(){b.hide()};var e=function(c){c=a.fixEvent(c);var d=b.getDom("layer_box"),e=c.target;d!==e&&!a.contains(d,e)&&a.contains(document.body,e)&&b.hide()};this.switchTab_=function(c,d){var e=c.data,f=e.type;if(f!=b.selectedTab_){var g=c.el,h=g.parentNode.children,i=e.other.split(",");d&&a.setStyle(d,"display","none");var j=function(b,c){a.removeClassName(b,"curr")},k=function(c,d){var e=b.getDom("inactive_"+c);a.setStyle(e,"display","none")};a.foreach(i,k);a.setStyle(b.getDom("inactive_"+f),"display","");a.foreach(h,j);a.addClassName(g,"curr");b.selectedTab_=f}};d.add("close","click",b.handleHide_);d.add("inactive_tab","click",b.switchTab_);a.addEvent(c,"click",e);b.one("destroy",function(){d.remove("close","click",b.handleHide_);d.remove("inactive_tab","click",b.switchTab_);a.removeEvent(c,"click",e)});b.layer_.on("hidden",function(){b.destroy()})},getPlayer:function(){return this.player_},setPlayer:function(a){this.player_=a;this.fire("changePlayer",a);return this},getOptions:function(){return this.options_},get:function(a){return this.options_[a]},set:function(a,b){this.options_[a]=b;return this},getNode:function(){return this.node_},getNodes:function(a){a&&(this.nodes_=this.layer_.getDomList(a));return this.nodes_},getDom:function(a,b){b&&this.getNodes(b);return this.nodes_&&this.nodes_[a]},dEvent:function(){return this.dEvent_},getOffset:function(a){var b=this.get("offset");return a==="x"?b[1]+b[3]:b[0]+b[2]},holdPage_:function(){var c=a.scrollPos(),d=c.left,e=c.top;this.scrollTop_=e;this.scrollLeft_=d;i.style.overflow="hidden";b.MOZ&&b.Version<20&&(i.style.marginTop=0-e+"px")},unHoldPage_:function(){i.style.overflow="";i.style.marginTop="0px";i.style.marginRight="0px";window.scrollTo(0,this.scrollTop_)},setSize_:function(b,c){var d=this.getNode();layerBox=this.getDom("layer_box"),layerLeft=this.getDom("layer_left"),inactiveBox=this.getDom("inactive_scroller");g.setStyles(layerBox,{position:"absolute",width:b+"px",height:c+"px"});g.setMiddle(layerBox,d);g.setStyles(layerLeft,{width:b-290+"px",height:c+"px"});a.setStyle(inactiveBox,"height",c-32+"px")},getSize_:function(a){var b=this.get("limits"),c=this.getDom("layer_box"),d=16/9,e=a.width-this.getOffset("x"),f=a.height-this.getOffset("y");e-=g.getShellVal(c,"width");f-=g.getShellVal(c,"height");e=Math.max(Math.min(e,b.maxWidth),b.minWidth);f=Math.max(Math.min(f,b.maxHeight),b.minHeight);var h=e-290,i=f-40;if(h/i<d){i=h/d;f=i+40}else{h=i*d;e=h+290}this.set("vSize",[h,i]);this.set("lSize",[e,f]);return{width:e,height:f}},resize:function(){if(this.resizing_)return this;this.resizing_=!0;var b=this.getNode(),c=a.winSize();if(!!b){g.setStyles(b,{overflow:"hidden",width:c.width+"px",height:c.height+"px"});g.setMiddle(b);var d=this.getSize_(c);this.setSize_(d.width,d.height);this.fire("resize",{width:d.width,height:d.height});this.resizing_=!1}},render_:function(){if(!this.rendered_){var b=document.body,c=this.getNode(),d=this.get("style");a.contains(b,c)||b.appendChild(c);d.position=g.canFixed()?"fixed":"absolute";g.setStyles(c,d);this.rendered_=!0}},show:function(){if(this.shown_)return this;var b=this,c=this.node_;this.fire("beforeShow");this.rendered_||this.render_();this.layer_.show();this.holdPage_();f.forwardShow(c,{opacity:.75});f.resetSize();this.resize();a.addEvent(window,"resize",b.handleResize_);a.hotKey.add(i,["esc"],b.handleHide_,{type:"keyup"});this.shown_=!0;this.fire("afterShow");return this},hide:function(){if(!this.shown_)return this;this.fire("beforeHide");this.layer_&&this.layer_.hide();this.rendered_=!1;a.removeEvent(window,"resize",self.handleResize_);a.hotKey.remove(i,["esc"],self.handleHide_,{type:"keyup"});this.unHoldPage_();f.backShow();f.resetSize();a.setStyle(f.getNode(),"opacity",.3);this.shown_=!1;this.fire("afterHide");return this},destroy:function(){this.hide();this.fire("destroy");this.dEvent_&&this.dEvent_.destroy&&this.dEvent_.destroy();this.layer_&&this.layer_.destroy&&this.layer_.destroy();this.layer_=null;this.node_=null;this.nodes_=null;this.rendered_=null;this.remove();V.players&&a.foreach(V.players,function(a,b){!a&&delete V.players[b]})}},p=h.extend(n,o);return p});
STK.register("lib.videoview.index",function(a){var b=a.lib.videoview.source,c=b.info,d=b.recommend,e=b.overlayer,f={},g,h,i,j,k={inited:!1,shown:!1};g={init:function(a){if(k.inited||h)return h;h=new e(a,{limits:{maxWidth:1314,maxHeight:710,minWidth:790,minHeight:321},offset:[10,15]});h.one("afterShow",g.afterShow_);h.one("beforeHide",g.beforeHide_);h.one("afterHide",g.afterHide_);return h},afterShow_:function(a){var b=this.player_;if(!!b){this.initialLayerKey_=b.id();var e=this.getDom("video_box");b.trigger("intoLayer",{box:e});i=new c(this);j=new d(this);k.shown=!0}},beforeHide_:function(a){var b=this.player_;!b||(this.initialLayerKey_&&this.initialLayerKey_==b.id()?b.trigger("outLayer",{action:"hide"}):b.dispose())},afterHide_:function(a){V.flag_&&(V.flag_.layer=!1);k={};i&&i.destroy&&i.destroy();j&&j.destroy&&j.destroy();h&&h.destroy&&h.destroy();i=null;j=null;h=null;delete this.initialLayerKey_}};f={show:function(a,b){if(!k.shown){if(!k.inited||!h){g.init(b);k.inited=!0}h.show()}},hide:function(){!!k.shown&&!!h&&h.hide()},destroy:function(){k={};h&&h.destroy&&h.destroy();h=null}};return f});
STK.register("lib.feed.plugins.videos.unflod",function(a){var b=a.lib.videoview.index,c=a.lib.feed.plugins.videos.utils,d={},e,f,g,h,i,j,k,l,m,n=a.core.json.merge;c=n(c,{drawBtn:function(a,b){var c={x:a.width/2,y:a.height/2,r:27,bgAlpha:.6,bgColor:"#333333",btnAlpha:1,btnColor:"#FFFFFF"},d=a.ctx;if(!b){d.save();d.globalAlpha=c.btnAlpha;d.strokeStyle=c.btnColor;d.fillStyle=c.btnColor;d.beginPath();d.lineWidth=6;d.strokeStyle="white";d.lineJoin="round";d.moveTo(c.x-12,c.y-15);d.lineTo(c.x-12,c.y+15);d.lineTo(c.x+12,c.y);d.closePath();d.stroke();d.fill();d.restore()}else{d.save();d.globalAlpha=c.btnAlpha;d.strokeStyle=c.btnColor;d.fillStyle=c.btnColor;d.beginPath();d.arc(c.x,c.y,c.r/3,Math.PI*1.5,Math.PI*1,!1);d.arc(c.x,c.y,c.r/4,Math.PI*1,Math.PI*1.5,!0);d.lineTo(c.x,c.y-3.5);d.lineTo(c.x-7,c.y-8);d.lineTo(c.x,c.y-12.5);d.closePath();d.stroke();d.fill();d.restore()}},showCanvasImg:function(b){if(!!b){var c;if(!b.canvas_){b.canvas_=c=a.C("canvas");c.ctx=c.getContext("2d")}else c=b.canvas_;c.width=500;c.height=b.obj_.domHeight||b.obj_.height;c.ctx.clearRect(0,0,c.width,c.height);c.ctx.drawImage(b.tech_.el_,0,0,c.width,c.height);this.drawBtn(c,b.ended());a.setStyle(c,"display","");b.obj_.container.appendChild(c)}},hideCanvasImg:function(b){!!b&&!!b.canvas_&&a.setStyle(b.canvas_,"display","none")}});f={intoLayer:function(a,b){V.flag_&&(V.flag_.layer=!0);this.feedClicked_=this.hasClicked();c.showCanvasImg(this);var d=b.box,e=this.getChild("ControlBar"),f=this.getChild("UnflodCover"),g=e.getChild("UnflodBtn"),h=e.getChild("FullscreenToggle");f.hide();g.hide();h.show();this.dblToFullScreen(!0);d.appendChild(this.el());this.obj_&&this.obj_.ad&&d.appendChild(this.obj_.ad.el());this.muted()&&this.muted(!1);this.paused()&&this.play();this.inLayer_=!0},outLayer:function(a,b){if(!!this.inLayer_){!this.feedClicked_&&this.hasClicked(!1);if(this.obj_&&this.obj_.container){var d=!this.paused(),e=this.getChild("ControlBar"),f=this.getChild("UnflodCover"),g=e.getChild("UnflodBtn"),h=e.getChild("FullscreenToggle");g.show();h.hide();this.dblToFullScreen(!1);c.hideCanvasImg(this);this.obj_.container.appendChild(this.el());this.obj_.ad&&this.obj_.container.appendChild(this.obj_.ad.el());d&&this.play();this.inLayer_=!1}}},fullscreenchange:function(a){c.sendSuda("video_recommend","full_screen")},dispose:function(a){e.offListen(this)}};e={initUnflodCover:function(){var a,c,d,e,f,g;c=function(){l.apply(this,arguments);this.on(this.player_,"pause",this.hideCover_);this.on(this.player_,"play",this.showCover_)};d=function(){this.contentEl_=j.createEl("h4",{innerHTML:"<span>展开</span>"});var a=j.createEl("div",{append:this.contentEl_,className:"wbv-pop-layer wbv-hidden"});a.appendChild(this.contentEl_);return a};e=function(a){b.show(a,this.player_)};f=function(a){this.player_.inLayer_||this.hide()};g=function(a){this.player_.inLayer_||this.show()};a=V.extend(l,{constructor:c,createEl:d,handleClick:e,hideCover_:f,showCover_:g});k.registerComponent("UnflodCover",a)},initUnflodBtn:function(){var a,c,d,e,f;c=function(){m.apply(this,arguments)};d=function(){var a=m.prototype.createEl.call(this,"div",{},{disabletitle:!1});this.controlText("弹层播放",a);return a};e=function(){return"wbv-pop-control "+m.prototype.buildCSSClass.apply(this,arguments)};f=function(a){b.show(a,this.player_)};a=V.extend(m,{constructor:c,createEl:d,buildCSSClass:e,handleClick:f});k.registerComponent("UnflodBtn",a)},onListen:function(a){for(var b in f)a.on(b,f[b])},offListen:function(a){for(var b in f)a.off(b,f[b])}};g=function(){j=V.dom;k=V.getComponent("Component");l=V.getComponent("ClickableComponent");m=V.getComponent("Button")};h=function(){e.initUnflodCover();e.initUnflodBtn()};i=function(){g();h()};window.V&&i();d={init:function(a){!j&&window.V&&i();if(!!window.V){var b=a.getChild("ControlBar"),c=b.getChild("FullscreenToggle");a.addChild("UnflodCover",{},1);b.addChild("UnflodBtn",{},5);c.hide();e.onListen(a)}},destroy:function(){!window.V||b&&b.destroy&&b.destroy()}};return d});
STK.register("lib.feed.plugins.videos.init",function(a){var b=a.lib.kit.dom.parseDOM,c=a.conf.trans.feed.feed,d=a.conf.channel.video,e=a.lib.kit.io.cors,f=a.lib.kit.extra.storage,g=a.lib.kit.extra.merge,h=a.lib.kit.extra.language,i=a.lib.kit.extra.sparkMD5,j=a.lib.kit.extra.sendImage,k=a.lib.kit.extra.HashTable,l=a.lib.kit.extra.getWantTime,m=a.lib.kit.extra.scrollMethod,n=a.lib.kit.extra.storageLog,o=a.lib.kit.extra.arrayRemove,p=a.lib.kit.extra.supportVideo,q=a.lib.feed.plugins.videos.utils,r=a.lib.feed.plugins.videos.video,s=a.lib.feed.plugins.video.log,t=a.lib.feed.plugins.videos.followBtn,u=a.lib.feed.plugins.videos.quality,v=a.lib.feed.plugins.videos.vplus,w=a.lib.feed.plugins.videos.ad,x=a.lib.feed.plugins.videos.unflod,y={str:"Log_h5play",transKey:"h5playlog"},z="WB_video_h5_v2",A="WB_video_h5_v2_h",B="yixiong&zhaolong5",C={80000002:2,80000008:1};q=g(q,{domHalf:!1,sensitiveHeight:270,initBuff:300,md5Data:function(b,c,d){var e={};e.data=a.jsonToStr(b);e.key=c;e.sig=e.data&&c&&d&&e.data+c+d;e.sig=i.hash(e.sig);return e},sendAnalysisRequest:function(b,d){var e=b.getAttribute("data-mark")||"",f=a.queryToJson(e),g=C[d],h=function(a){var b=[];for(var c=0;c<a.attributes.length;c++)a.attributes[c].name.indexOf(d===80000008&&q.CONauto()&&f.monitor_mask?"auto-data-mark-third-analysis":"data-mark-third-analysis")===0&&b.push(a.attributes[c].value);return b}(b);if(f.monitor_mask&&f.monitor_mask&g){j(h,{action_id:d,autoplay:q.CONauto()?1:0});c.request("setADMonitor",{},{action_id:d,monitor:a.foreach(h,function(a){return encodeURIComponent(a)}).join("|"),mark:f.mark})}}});return function(b,g){if(!b)a.log("media : need object of the baseFeedList Class");else{var h={},i,j,l,o,A,C,D,E,F,G,H,I,J,K,L,M,N,O={},P,Q={auto:"",play:"",paused:[]},R={layer:!1,fullScreen:!1,scroll:!1};i={canplay:function(a){var b=this.obj_;I&&Q&&Q.auto&&this.id()==Q.auto&&this.play()},play:function(a){var b=this.id();if(!I||!this.muted()){if(Q.play&&Q.play!=b){var c=P.ObjArr[Q.play];if(c.type=="live"){c.media.destroy();c.init=!1}else V.players[Q.play].pause()}Q.play=b}I&&q.removeTarget(b,Q.paused)},pause:function(b){var c=this.id();if(!!I&&!this.muted()){!a.inArray(c,Q.paused)&&Q.paused.push(c);c==Q.play?Q.play="":null}},volumechange:function(b){var c=this.id();F.setExtend(this.log_,{clicked:1});this.clicked_=!0;if(this.muted()){if(!I)return;if(this.paused())q.removeTarget(c,Q.paused);else{c==Q.play?Q.play="":null;Q.auto?null:Q.auto=c}}else if(this.paused()){if(!I)return;!a.inArray(c,Q.paused)&&Q.paused.push(c)}else{if(c==Q.play)return;if(Q.play&&Q.play!=c){var d=P.ObjArr[Q.play];if(d.type=="live"){d.media.destroy();d.init=!1}else V.players[Q.play].pause()}Q.play=c;I&&Q.auto==c?Q.auto="":null}},fullscreenchange:function(a){this.isFullscreen()?R.fullScreen=!0:R.fullScreen=!1},firstclick:function(b){if(!!this.obj_&&!R.layer){var c=this.obj_.actionData;if(!c)return;var d=parseInt(c.card_width)||this.videoWidth(),e=parseInt(c.card_height)||this.videoHeight(),f=d/e,g=+f.toFixed(2),h;g>1&&g<1.77?h=parseInt(500/f):g<=1&&(h=500);this.height(h);this.deployTimer_=this.setTimeout(function(){this.removeClass("wbv-deployable");this.clearTimeout(this.deployTimer_);a.setStyle(this.obj_.node,"height",h+"px");this.height("100%")},300);F.setExtend(this.log_,{clicked:1});this.feedClicked_=this.clicked_=!0;if(I){this.muted(!1);this.paused()||this.pause()}}},sendLog:function(a){if(!(this.getValidTime()<=0)){var b;this.log_.playduration=Math.round(this.currentTime()*1e3);this.log_.valid_play_duration=Math.round(this.getValidTime()*1e3);this.resetValidTime();this.log_&&(b=q.formateJson(this.log_));b&&H.set(b)}},sendHistory:function(a){if($CONFIG.islogin=="1"){var b=this,c=Math.floor(+(new Date).getTime()/1e3),d=this.currentTime();if(c==this.lastSendHistory_)return;this.lastSendHistory_=c;var f=this.obj_&&this.obj_.actionData,g={source:"2637646381",play_type:this.clicked_?1:0,video_orientation:f&&f.video_orientation||"horizontal",video_duration:f&&f.duration||parseInt(this.duration(),10),id:f&&f.current_mid?f.current_mid:f.mid,id_type:0,seconds:parseInt(d,10),oid:f&&f.objectid},h=function(a){b.nextReportDelay_=a&&a.data&&a.data.next_report_delay_seconds||0},i=function(a){b.nextReportDelay_=1},j=function(a){b.nextReportDelay_=1};e({url:"//multimedia.api.weibo.com/2/multimedia/user/play_history/report.json",args:g,header:{"Content-Type":"application/x-www-form-urlencoded"},method:"post",onSuccess:h,onError:i,onTimeout:j})}},playCount:function(b,d){var e=d||this.obj_,f=e.node,g=e.actionData,h=E.getFeedNode(f,C),i=q.md5Data({uid:$CONFIG.uid,mid:g.mid,keys:g.keys,type:g.type},q.getUniqueKey(),B);c.request("playstatistics",{},i);if(h&&h.getAttribute("data-mark")){q.sendAnalysisRequest(h,80000008);c.request("adDeal",{},{mid:g.mid,short_url:g.short_url,mark:a.queryToJson(h.getAttribute("data-mark")).mark})}}};j={onListen:function(a){if(!!a)for(var b in i)a.on(b,i[b])},offListen:function(a){if(!!a)for(var b in i)a.off(b,i[b])},initMedia:function(b){if(!b||!b.media){var c,d,e;e=b.actionData;d=function(){this.log_=b.logObj;this.obj_=b;a.hasClassName(b.node.parentNode.parentNode,"WB_feed_spec")?a.addClassName(b.node.parentNode.parentNode,z):a.addClassName(b.node,z);b.image&&a.setStyle(b.image,"display","none");b.container&&a.setStyle(b.container,"display","");b.adData&&w.init(this,b);x.init(this);b.vSrcs&&!b.vSrcs.noQuality?u.init(this,b.vSrcs):this.cache_.vSrcs=b.vSrcs;b.follow&&b.follow.need_follow==1&&t.init(this,b.follow);b.vData&&(b.vData.isPay==1||b.vData.isFake==1)&&v(this,b.vData)};c=r({obj:b,id:b.key,container:b.container,muted:I?!0:!1,className:["wbv-deployable"],poster:e.cover_img&&decodeURIComponent(e.cover_img),sources:[{src:e.video_src&&decodeURIComponent(e.video_src),type:"video/mp4"}],cb:d});b.media=c;j.onListen(c);c.on("dispose",function(a){j.offListen(c)})}},getLogData:function(b,c,d){if(!!a.isNode(b)){var e=b&&E.getFeedNode(b,C),f=e&&e.getAttribute("tbinfo")&&a.queryToJson(e.getAttribute("tbinfo")),g=e&&e.getAttribute("minfo")&&a.queryToJson(e.getAttribute("minfo")),h=e&&e.getAttribute("mid");d.uid=$CONFIG&&$CONFIG.uid||"";d.mid=h?h:"";d.mid_uid=f&&f.ouid?f.ouid:"";d.rootuid=g&&g.ru||f&&f.ouid;d.rootmid=g&&g.rm&&g.rm||h&&h;d.object_id=c&&c.objectid;d.duration=c&&c.duration;d.encode_mode=c&&c.encode_mode;d.bitrate=c&&c.bitrate;d.isautoplay=I?"1":"0";return d}},getInitData:function(b){if(!(!b||!a.isNode(b.node)||!a.isNode(b.dom))){var c,d,e;e=a.jsonClone(G);d=b.actionData;if(!d)return;if(d.type==="feedlive")c={logObj:{},uid:window.$CONFIG&&window.$CONFIG.uid||"",objectId:d.objectid,thumbnail:d.cover_img&&decodeURIComponent(d.cover_img),videoH:d.card_height&&d.card_height+"px",videoW:d.card_width&&d.card_width+"px",dom:b.dom,playCount:d.play_count,duration:d.duration,liveStatus:d.liveStatus,cTime:d.cTime,allowMouseRight:!1,isWBLive:!0,uniqueKey:b.key,extend:{is_premium:d.is_premium&&d.is_premium==1?!0:!1}};else{e=F.setExtend(e,{sid:F.sid(),qType:"480"});b.vData&&(b.vData.isPay==1&&b.vData.isOpen==0||b.vData.isFake==1)&&(e=F.setExtend(e,{pay:"s"}));b.vSrcs&&b.vSrcs.qType&&(e=F.setExtend(e,{qType:b.vSrcs.qType}));e=j.getLogData(b.node,d,e);c={logObj:e}}return c}},initOne:function(b,c,d){if(!!b){var e,f,g,h,i,k,l,m,n,o,r,s,t;e=q.getUniqueKey();g=E.getMid(b);h=q.getAttrData(b,"action-data");if(!h)return;if(h.type==="feedlive"&&!p.live())return;h.mid=g;m=q.getAttrData(b,"follow-data");n=q.getAttrData(b,"video-sources");n.key=e;if(n&&n.qType&&n.qType!="720"&&n.qType!="1080"){!h.video_src&&n[n.qType]&&(h.video_src=n[n.qType]);n.noQuality=!0}o=q.getAttrData(b,"vplus-data");r=q.getAttrData(b,"ad-data");b.setAttribute("unique-video",e);i=a.sizzle('[node-type="fl_h5_video_pre"]',b)[0];k=a.sizzle('[node-type="fl_h5_video_disp"]',b)[0];a.removeNode(a.sizzle('[action-type="feed_list_smallPlayer"]',i)[0]);l=j.getInitData({key:e,node:b,dom:k,actionData:h,vData:o,vSrcs:n});if(h.type=="feedlive"){a.addClassName(b,"WB_video_h5");f=new HlsPlayer(l);i.style.display="none";k.style.display=""}s={media:f,type:h.type=="feedlive"?"live":"video",key:e,node:b,container:k,image:i,top:c,height:d,actionData:h,logObj:l.logObj,vSrcs:n,follow:m,vData:o,adData:r};!O.hasOwnProperty(e)&&(O[e]=c);!P.Contains(e)&&P.Add(e,s)}},resetOne:function(a,b,c){var d=P.ObjArr[a];if(!!d){var e=d.top,f=d.domHeight;e!=b&&(d.top=O[a]=b);f!=c&&(d.domHeight=c)}},initVideos:function(){if(!R.fullScreen&&!R.layer){var b=a.sizzle('[node-type="fl_h5_video"]',C);b&&a.foreach(b,function(b){if(!!b){var c=a.position(b).t,d=a.core.dom.getSize(b).height,e=b.getAttribute("unique-video");e?j.resetOne(e,c,d):j.initOne(b,c,d)}})}},thirdRend:function(a){var b=a.data,c=a.el;if(c.getAttribute("node-type")!=="fl_h5_video"||b&&b.type==="feedlive"&&!p.live()){g&&g(a);return E.preventDefault(a.evt)}if(!b||b.type=="feedlive"){var d=c&&c.getAttribute("unique-video"),e=d&&P.ObjArr[d];if(e.init)return;e.media.expandPlay();e.init=!0;if(Q.play){var f=P.ObjArr[Q.play];f.type!="live"&&f.media.pause()}Q.play=d;i.playCount(a.evt,e)}},outBuff:function(b){if(!!b.media)if(b.type=="live"){if(b.node&&a.sizzle(".hv-icon-min",b.node).length)return;b.media.destroy();b.init=!1}else b.media.pause()},inBuff:function(b,c){var d=b.media;if(b.type=="video"&&!d){j.initMedia(b);if(I&&q.isInAutoClinet(b.top,c,b.height,J))return!0}else{if(b.type=="video"&&d.ended()||a.inArray(b.key,Q.paused))return;if(!!q.isInAutoClinet(b.top,c,b.height,J)){if(b.key==Q.play||!I||b.type=="live")return;if(Q.auto==b.key)return!0;d.pause();return!0}if(b.type=="live"){b.media.destroy();b.init=!1}else b.media.pause()}},changeStatus:function(){K=a.scrollPos().top;var b=[],c,d=P&&P.ObjArr;O&&a.foreach(O,function(a,c){var e=d[c];!e||(q.isInBuff(a,K,J)?j.inBuff(e,K)&&b.push(e):j.outBuff(e))});if(!!I){b&&b.length===1&&(c=b[0]);if(b&&b.length>1){c=q.filterAutoVideo(b,K,J);Q.auto&&c.key!=Q.auto&&V.players[Q.auto]&&V.players[Q.auto].pause()}if(!c)return;Q.auto=c.key;c.media||initMedia(c);c.media.isReady_&&c.media.play()}},checkWinHeight:function(){if(!R.fullScreen&&!R.layer){J=a.winSize().height;d.fire("resize")}},checkDocHeight:function(){if(!(R.scroll||R.fullScreen||R.layer)){var b=a.pageSize().page.height;if(b==N)return;N=b;j.initVideos();j.changeStatus();d.fire("docChange")}},scroll:function(){if(!(R.scroll||R.fullScreen||R.layer)){R.scroll=!0;j.changeStatus();d.fire("scroll");clearTimeout(M);M=setTimeout(function(){R.scroll=!1},0)}},getHistoryConfig:function(){var a=f.get("H5_history_config");if(a)V.vConfig_=a;else{var b={ttl:3600,video_play_threshold:{horizontal_seconds:30,vertical_percent:.5}},c=function(a){var c=a.data||b;f.set("H5_history_config",c.video_play_threshold,c.ttl);V.vConfig_=c.video_play_threshold},d=function(a){var c=b;f.set("H5_history_config",c.video_play_threshold,c.ttl);V.vConfig_=c.video_play_threshold},g=function(a){var c=b;f.set("H5_history_config",c.video_play_threshold,c.ttl);V.vConfig_=c.video_play_threshold};e({url:"//multimedia.api.weibo.com/2/multimedia/user/play_history/config.json",args:{source:"2637646381"},header:{"Content-Type":"application/x-www-form-urlencoded"},method:"get",onSuccess:c,onError:d,onTimeout:g})}},debounce:m.debounce(function(){j.scroll()},300),throttle:m.throttle(function(){j.scroll()},500,600),rAF:m.rAF(function(){j.scroll()}),initPlugins:function(){j.checkWinHeight();j.initVideos();j.changeStatus()},dispose:function(){V.players&&a.foreach(V.players,function(a,b){a&&a.dispose&&a.dispose()});V.players={}}};l=function(){I=q.CONauto();C=b.getNode();D=b.getDEvent();E=b.utils;N=a.pageSize().page.height;P=P&&P.Clear()||k();F=s();V.keys_=Q;V.flag_=R;V.isAuto_=I;!V.setExtend&&(V.setExtend=F.setExtend);G=F.Obj;H=n(y)};o=function(){j.initPlugins();L=setInterval(j.checkDocHeight,1e3);a.addEvent(window,"scroll",j.debounce);a.addEvent(window,"resize",j.checkWinHeight);D.add("feed_list_third_rend","click",j.thirdRend)};A=function(){l();o()};A();h.destroy=function(){V.keys_=Q=null;V.flag_=R=null;L&&clearInterval(L);M&&clearInterval(M);a.removeEvent(window,"scroll",j.debounce);a.removeEvent(window,"resize",j.checkWinHeight);D.remove("feed_list_third_rend","click",j.thirdRend);D&&D.destroy&&D.destroy();P&&P.Clear();O=null;j.dispose();j=null;i=null;H&&H.destroy&&H.destroy();x&&x.destroy&&x.destroy()};return h}}});
STK.register("lib.photoview.source.mask",function(a){function k(b){var c;(c=b.getAttribute(f))||b.setAttribute(f,c=a.getUniqueKey());return">"+b.tagName.toLowerCase()+"["+f+'="'+c+'"]'}function j(){b=a.C("div");var c='<div node-type="outer">';a.core.util.browser.IE6&&(c+='<div style="position:absolute;width:100%;height:100%;"></div>');c+="</div>";b=a.builder(c).list.outer[0];document.body.appendChild(b);e=!0;d=a.lib.kit.dom.fix(b,"lt");var f=function(){var c=a.core.util.winSize();b.style.cssText=a.core.dom.cssText(b.style.cssText).push("width",c.width+"px").push("height",c.height+"px").getCss()};i.add(d,"beforeFix",f);f()}var b,c=[],d,e=!1,f="STK-Mask-Key",g=a.core.dom.setStyle,h=a.core.dom.getStyle,i=a.core.evt.custEvent,l={getNode:function(){return b},show:function(c,f){if(e){c=a.core.obj.parseParam({opacity:.3,background:"#000000"},c);b.style.background=c.background;g(b,"opacity",c.opacity);b.style.display="";d.setAlign("lt");f&&f()}else{j();l.show(c,f)}return l},hide:function(){b.style.display="none";c=[];return l},showUnderNode:function(d,e){a.isNode(d)&&l.show(e,function(){g(b,"zIndex",h(d,"zIndex"));var e=k(d),f=a.core.arr.indexOf(c,e);f!=-1&&c.splice(f,1);c.push(e);a.core.dom.insertElement(d,b,"beforebegin")});return l},back:function(){if(c.length<1)return l;var d,e;c.pop();if(c.length<1)l.hide();else if((e=c[c.length-1])&&(d=a.sizzle(e,document.body)[0])){g(b,"zIndex",h(d,"zIndex"));a.core.dom.insertElement(d,b,"beforebegin")}else l.back();return l},resetSize:function(){var c=a.core.util.winSize();b.style.cssText=a.core.dom.cssText(b.style.cssText).push("width",c.width+"px").push("height",c.height+22+"px").getCss();return l},destroy:function(){i.remove(d);b.style.display="none"}};return l});
STK.register("lib.photoview.source.eventemiter",function(a){var b=a.custEvent,c=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},d=function(b,c){return b&&a.core.arr.indexOf(c,b)!==-1},e=Object.create||function(a){function b(){}b.prototype=a;return new b},f=function(a,b,d){var f=e(b.prototype);a.prototype=f;f.constructor=a;c(f,d);return a},g=function(a){this.addEvents(a)};g.prototype={addEvents:function(c){if(!!c&&!!c.length){a.isArray(c)||(c=[].concat(c));b.define(this,c);this._events=(this._events||[]).concat(c);return this}},removeEvents:function(){b.remove(this);b.undefine(this);this._events=[]},on:function(a,c,e){d(this._events,a)||this.addEvents(a);b.add(this,a,c,e);return this},un:function(a,c){b.remove(this,a,c);return this},once:function(a,c){d(this._events,a)||this.addEvents(a);b.once(this,a,c);return this},fire:function(a,c){b.fire(this,a,c);return this}};g.extend=function(a,b){var d=typeof a;if(d==="function")return f(a,g,b);if(d==="object"){b=a;var e=new g(b.events);c(e,b);return e}return a};return g});
STK.register("lib.photoview.source.overlayer",function(a){function C(a){a[1]===undefined&&(a[1]=a[0]);a[2]===undefined&&(a[2]=a[0]);a[3]===undefined&&(a[3]=a[1]);return a}function B(c,d){d=d||b;var e=A(c),f=A(d),g=(f.width-e.width)/2,h=(f.height-e.height)/2;d===b&&a.getStyle(c,"position")!=="fixed"&&(h+=a.scrollPos().top);c.style.top=(h>0?h:0)+"px";c.style.left=(g>0?g:0)+"px"}function A(a){if(a===b)return r();var c,d,e=a.style;if(e.display=="none"){e.visibility="hidden";e.display="";c=a.offsetWidth;d=a.offsetHeight;e.display="none";e.visibility="visible"}else{c=a.offsetWidth;d=a.offsetHeight}c+=y(a,"marginLeft")+y(a,"marginRight");d+=y(a,"marginTop")+y(a,"marginBottom");return{width:c,height:d}}function z(a,b){switch(b){case"height":return y(a,"marginTop")+y(a,"marginBottom")+y(a,"paddingTop")+y(a,"paddingBottom")+y(a,"borderTopWidth")+y(a,"borderBottomWidth");case"width":return y(a,"marginLeft")+y(a,"marginRight")+y(a,"paddingLeft")+y(a,"paddingRight")+y(a,"borderLeftWidth")+y(a,"borderRightWidth");default:}return y(a,b)}function y(b,c){var d=parseInt(a.getStyle(b,c),10);return isNaN(d)?0:d}function x(a,b){return a<b?a:b}function w(a,b){return a>b?a:b}var b=window,c=document,d=document.documentElement,e=a.addEvent,f=a.removeEvent,g=a.core.util.easyTemplate,h=a.lib.kit.extra.language,i=a.core.dom,j=a.core.evt,k=j.custEvent,l=a.lib.photoview.source,m=l.eventemiter,n=l.util.debounce,o=l.mask,p=STK.core.util.browser,q=navigator.userAgent.indexOf("Mac OS X")>-1?0:17,r=a.winSize,s=a.foreach,t=a.core.json.merge,u=function(b,c){s(c,function(c,d){a.setStyle(b,d,c)})},v=function(){if(v.value!==undefined)return v.value;var a=document.createElement("div"),b=a.cloneNode(!1),c=!1,e=document.body||function(){c=!0;return d.appendChild(document.createElement("body"))}();a.style.cssText="position:fixed;top:42px";e.appendChild(a);e.appendChild(b);var f=a.offsetTop!==b.offsetTop;e.removeChild(a);e.removeChild(b);c&&d.removeChild(e);v.value=f;return f},D=["show","hide","beforeHide","resize"],E=m.extend(function(c,i){if(!(this instanceof E))return new E(c,i);var j=this;m.call(j,D);var k=r(),l=k.width,q=k.height;i=t({limits:{maxWidth:l,maxHeight:q,minWidth:l/2,minHeight:q/2},offset:[0,0],style:{zIndex:9999,position:"absolute"},pid:"",mid:"",pic_objects:"",isPrivate:"",relation:"",picsDate:""},i,{isDeep:!0});C(i.offset);var s=decodeURIComponent(i.pic_objects);s=s.split(",");var u=[],v=[],w=[],x=[];for(var y=0,z=s.length;y<z;y++){var A=s[y];A=A.split("|");u.push(A[0]);v.push(A[1]);w.push(A[2]);x.push(A[3])}var B=0;for(var F=0,G=u.length;F<G;F++)if(u[F]==i.pid){B=F;break}var H=a.ui.mlayer({template:h(g(c,{is_liked:+v[B],count:w[B]||0,object_id:x[B],mid:i.mid,pid:u[B]||i.pid,notShowLikeBtn:i.pic_objects!=""}).toString()),showWithAni:"bounceIn:normal",hideWithAni:"bounceOut:fast"});j._layer=H;j._node=H.getBox();j.hidden=!0;j.get=function(a){return i[a]};j.set=function(a,b){i[a]=b};var I=n(function(){j.resize()},50),J=d.style,K=0,L=function(){var b=a.scrollPos(),c=b.left,d=b.top;K=d;J.overflow="hidden";p.MOZ&&p.Version<20&&(J.marginTop=0-d+"px")},M=function(){J.overflow="";J.marginTop="0px";J.marginRight="0px";b.scrollTo(0,K)},N=function(){j.hide()};j.on("show",function(){L();o.showUnderNode(j._node,{opacity:.75});o.resetSize();e(b,"resize",I);a.hotKey.add(d,["esc"],N,{type:"keyup"})});j.on("hide",function(){a.hotKey.remove(d,["esc"],N,{type:"keyup"});o.back();f(b,"resize",I);M();var c=o.getNode();a.setStyle(c,"opacity",.3);o.resetSize()});j._initEvts()},{hidden:!0,_initEvts:function(){var b=this,c=b._node,d=j.delegatedEvent(c);b._delegate=d;d.add("close","click",function(c){b.hide();a.stopEvent(c.evt);return!1});var g=function(c){c=a.fixEvent(c);var d=b.getDom("box"),e=c.target;d!==e&&!a.contains(d,e)&&a.contains(document.body,e)&&b.hide()};e(c,"click",g);b.once("destroy",function(){f(c,"click",g)})},_initUI:function(){var a=this._node,b=this.get("style");b.position=v()?"fixed":"absolute";u(a,b)},_rendered:!1,_render:function(){var a=c.body,b=this._node;i.contains(a,b)||a.appendChild(b);this._initUI();this._rendered=!0},getOuter:function(){return this._node},getDom:function(a){var b=this._layer.getDomList();return b[a]?b[a]:null},getDelegate:function(){return this._delegate},getOffset:function(a){var b=this.get("offset");return a==="x"?b[1]+b[3]:b[0]+b[2]},setSize:function(a,b){var c=this,d=c._node,e=c.getDom("box");u(e,{position:"absolute",width:a+"px",height:b+"px"});B(e,d);c.set("size",[a,b]);c.fire("resize",{width:a,height:b})},resize:function(){var a=this;if(!a._resizing){var b=a.get("limits"),c=a._node,d=a.getDom("box"),e=r();u(c,{overflow:"auto",width:e.width+"px",height:e.height+"px"});B(c);var f=e.width-a.getOffset("x"),g=e.height-a.getOffset("y");f-=z(d,"width");g-=z(d,"height");f=w(x(f,b.maxWidth),b.minWidth);g=w(x(g,b.maxHeight),b.minHeight);a.set("screen",[f,g]);a._resizing=!0;a.setSize(f,g);a._resizing=!1;return a}},show:function(){var a=this;if(a.hidden){var b=c.body,d=a._node;i.contains(b,d)||b.appendChild(d);a._rendered||a._render();a._layer.show();a.fire("show");a.resize();a.hidden=!1}return a},hide:function(){var a=this;if(!a.hidden&&a.fire("beforeHide")!==!1){a._layer.hide();a.fire("hide");a.hidden=!0}return a},destroy:function(){var a=this,b=a._layer;a.hidden||a.hide();a.fire("destroy");a.removeEvents();a._delegate.destroy();k.undefine(b);k.remove(b);a._layer=null;a._node=null}});return E});
STK.register("lib.feed.plugins.gif.gif",function(a){var b=a.core.func.empty(),c=a.core.json.merge,d=a.lib.kit.extra.language,e=a.core.util.easyTemplate,f=a.conf.trans.feed.feed,g=e(d('<#et menu data><#if (data.save)><li><a href="${data.src}" download="${data.src}" action-type="gif_download">#L{保存动图}</a></li></#if><#if (data.voice)><li><a href="javascript:void(0);" action-type="gif_muted" action-data="muted=${data.muted}">${data.muted ? "#L{音量}" : "#L{静音}"}</a></li></#if><#if (data.play)><li><a href="javascript:void(0);" action-type="gif_play" action-data="paused=${data.paused}">${data.paused ? "#L{播放}" : "#L{暂停}"}</a></li></#if></#et>')),h={count:0,getUniqueKey:function(a){return(a||"H5_")+Math.random().toString(36).substring(5,10)+"_"+ +(new Date)+Math.floor(Math.random()*1e4)+h.count++},sendSuda:function(a,b){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack(a,b)},getAttrData:function(b,c){if(!!b&&!!c){var d=b.getAttribute(c),e=d&&a.queryToJson(d)||!1;return e}},setAttrData:function(b,c,d){var e=this.getAttrData(b,c)||{};e=a.core.json.merge(e,d);b.setAttribute(c,a.jsonToQuery(e))}};return function(e){if(!e.sources||!e.box)a.log("gifVideo : need src and box and log of the base Class");else{var i,j,k,l,m,n,o,p,q,r;i=c({id:h.getUniqueKey("Gif_"),loop:!1,autoplay:!0,menu:!0,save:!1,voice:!0,play:!0,muted:!0,src:"",cb:b,box:""},e,{isDeep:!0});if(i.menu){m=i.type=="story"?{children:["togglePlayItem","toggleMuteItem"]}:{children:[]};preventDefaultMenu=i.type=="story"?!1:!0}else{m={children:[]};preventDefaultMenu=i.type=="story"?!1:!0}n={initMedia:function(){return V(i.id,{container:i.box,controls:!1,extraEvents:!0,children:["mediaLoader"],contextMenu:m,preventDefaultMenu:preventDefaultMenu,className:["wbv-gif"],loop:i.loop,autoplay:i.autoplay,muted:i.muted,sources:i.sources},i.cb)},initMenu:function(a){if(!!j&&!!a){!k&&(k=j.getChild("ContextMenu"));var b=g(a).toString();k&&k.contentEl()&&(k.contentEl().innerHTML=b)}},hideMenu:function(a){if(!!j){k&&k.hide&&k.hide();l&&clearTimeout(l);l=setTimeout(function(){j.trigger("hideContextMenu");l&&clearTimeout(l)},200)}},menuMuted:function(a){if(!!j){var b=a.el;if(j.muted()){j.muted(!1);b.innerHTML=d("#L{静音}")}else{j.muted(!0);b.innerHTML=d("#L{音量}")}j.trigger("dispatchHidemenu")}},menuPlay:function(a){if(!!j){var b=a.el;if(j.paused()){j.play();j.trigger("volumechange");b.innerHTML=d("#L{暂停}")}else{j.pause();j.trigger("volumechange");b.innerHTML=d("#L{播放}")}j.trigger("dispatchHidemenu")}},onListen:function(){if(!!j)for(var a in o)j.on(a,o[a])},offListen:function(){if(!!j)for(var a in o)j.off(a,o[a])}};o={play:function(a){if(!!j){j.trigger("volumechange");j.trigger("updateLog");j.trigger("updateMenu")}},canplay:function(a){if(!!j){j.resetValidTime();j.getUrl&&(j.getUrl=!1);if(!j.loop()||!j.gifPlayed)return;j.trigger("sendLog");j.trigger("updateLog",!0);j.unLog=!0}},pause:function(a){if(!!j){j.trigger("volumechange");j.trigger("sendLog");j.trigger("updateMenu")}},ended:function(a){!j||j.trigger("sendLog")},error:function(a){if(!!j){var b=j.error_,c=b.code,d=j.networkState();if(c==4){if(j.getUrl){j.trigger("fail");return}f.request("gifUrl",{onComplete:function(a){if(a.code=="100000"){j.getUrl=!0;var b=a.data;if(!b.gif_url){j.trigger("fail");return}j.src({src:b.gif_url,type:"video/mp4"});j.trigger("updateLog",!0);j.trigger("sendLog");j.trigger("success",b.gif_url);j.unLog=j.gifPlayed=!1}else{j.trigger("fail");console.log(a.code,"视频不可播")}},onFail:function(a){j.trigger("fail");console.log(a.code,"视频不可播")}},{type:i.type,gif_ourl:i.oSrc,object_id:i.gif_oid})}else if(c==2||c==3)if(d!=1){j.trigger("fail");console.log("网络错误")}}},timeupdate:function(a){if(!!j){j.loop()&&!j.gifPlayed&&j.getValidTime()>=1&&(j.gifPlayed=!0);(Math.floor(j.currentTime())===3&&j.getValidTime()>1||j.currentTime()>3&&Math.round(j.currentTime())%3===0&&j.getValidTime()>1)&&j.trigger("sendLog")}},dispose:function(a){j.trigger("sendLog");n.offListen();j&&j.dispose&&j.dispose();k&&k.dispose&&k.dispose();dEvt.remove("gif_download","click",n.hideMenu);dEvt.remove("gif_muted","click",n.menuMuted);dEvt.remove("gif_play","click",n.menuPlay);dEvt&&dEvt.destroy&&dEvt.destroy()},initMenu:function(a,b){i.menu&&n.initMenu({save:b.save,src:b.src,voice:b.voice,play:b.play,muted:j&&j.muted(),paused:j&&j.paused()});i.save=!!b.save;i.src=b.src;i.voice=!!b.voice;i.play=!!b.play;i.gif_oid=b.gif_oid},updateMenu:function(a,b){if(!!j&&!!i.menu){!k&&(k=j.getChild("ContextMenu"));var c=k.$$("[action-type=gif_muted]"),e=k.$$("[action-type=gif_play]");c&&c[0]&&i.voice&&(c[0].innerHTML=j.muted()?d("#L{音量}"):d("#L{静音}"));e&&e[0]&&i.play&&(e[0].innerHTML=j.paused()?d("#L{播放}"):d("#L{暂停}"))}},srcChange:function(a,b){i=c(i,b,{isDeep:!0});j.src(i.sources[0]);j.loop()&&(j.unLog=j.gifPlayed=!1)}};p=function(){j=n.initMedia();i.menu&&i.save&&!i.voice&&!i.play&&n.initMenu({save:i.save,src:i.src,voice:i.voice,play:i.play,muted:j.muted(),paused:j.paused()});dEvt=a.delegatedEvent(i.box)};q=function(){n.onListen();dEvt.add("gif_download","click",n.hideMenu);dEvt.add("gif_muted","click",n.menuMuted);dEvt.add("gif_play","click",n.menuPlay)};r=function(){p();q()};r();return j}}});
STK.register("lib.photoview.source.imagedisplay",function(a){var b=window.document,c=window.setTimeout,d=a.lib.feed.plugins.gif.gif,e=a.lib.kit.extra.getWantTime,f=a.lib.kit.extra.storageLog,g,h=a.lib.kit.extra.supportVideo,i=$CONFIG.imgPath+"/style/images/common/loading.gif",j="about:blank",k=a.lib.photoview.source,l=k.eventemiter,m=k.util,n=a.lib.kit.dom.parseDOM,o=a.insertHTML,p=a.addEvent,q=a.foreach,r=a.setStyle,s=a.removeEvent,t,u=37,v=38,w=39,x=40,y="left",z="right",A={str:"Log_gifLayer",transKey:"h5playlog"},B,C,D=function(b,c,d,e,f){if(typeof e=="function"){f=e;e=null}a.tween(b,{duration:d,animationType:e||"easeoutcubic",end:f}).play(c).destroy()},E=m.throttle,F=m.debounce,G=m.setStyles,H=function(a){a.style.display="block"},I=function(a){a.style.display="none"},J=function(a,b){var c=new Image;b&&(c.onload=b);a&&(c.src=a||j);c.setAttribute("hidefocus",!0);return c},K=function(){var a=new Image;a.onload=function(){G(a,{position:"absolute",top:"50%",left:"50%",marginTop:-1*(a.height/2)+"px",marginLeft:-1*(a.width/2)+"px"});a.onload=null};a.src=i;return a},L=function(c){var d=c.relatedTarget,e=c.fromElement;if(!d||e&&e===c.target){d=c.toElement||e;c.relatedTarget=d}return d==null?!0:d?d!==this&&d.prefix!=="xul"&&this!==b&&!a.contains(this,d):!1},M=function(i,k){var p,s,M,N,O="",P,Q,R,S,T,U,V,W="",X="",Y="",Z=!1,_=!1,ba=function(c){t=n(a.builder(c).list);p=c;M=t.img_box;N=t.gif_box;s=t.loader||o(c,"<div></div>");O=s.className;s.setAttribute("tabIndex",-1);s.setAttribute("hidefocus",!0);s.onselectstart=function(){return!1};s.ondblclick=function(){var a=b.selection;a?a.empty():window.getSelection().removeAllRanges();return!1};M.oncontextmenu=function(a){var b=s.getAttribute("isPrivate");b==1&&a.preventDefault()};G(s,{position:"relative",outline:"none","-moz-user-select":"none","-webkit-user-select":"none"});P=M.appendChild(J());Q=M.appendChild(K());S=N.appendChild(K());q([M,N,P,Q,S],I)},bb=function(c){var d=a[c?"addEvent":"removeEvent"];d(s,"click",bk);d(b,"keydown",bk);if(a.lib.kit.touch.cantouch){d(p,"swipeLeft",bk);d(p,"swipeRight",bk)}else{d(p,"mousemove",bk);d(p,"mouseout",bk);d(p,"mouseover",bk)}},bc=function(){if(!_){_=!0;bb(!0);bx.fire("show")}},bd=function(a,b){s.setAttribute(a,b)},be=function(a){return s.getAttribute(a)},bf=function(a){s.removeAttribute(a)},bg=function(){R&&R.dispose&&R.dispose();C&&C.destroy&&C.destroy();C=null;g&&g.destroy&&g.destroy();B=null;R=null;Y="";Z=!1},bh=function(){if(_){_=!1;q([M,N,P,Q,S],I);X=j;bb(!1);bx.fire("hide");bg()}},bi=E(function(b){var c="",d=T,e=a.position(p),f=b.pageX-e.l,g=b.pageY-e.t;f<d*.5?c=y:f>=d*.5&&(c=z);if(c!==W){W=c;s.className=[O,c+"cursor"].join(" ")}bx.fire("mousemove",{x:f,y:g,event:b})},10),bj=E(function(a){t.likeBtn&&(t.likeBtn.style.display="none");bx.fire("navigate",{dir:a})},400),bk=function(c){var d=c.type;c=a.fixEvent(c);switch(d){case"mousemove":!Z&&bi(c);break;case"mouseover":case"mouseout":L.call(p,c)&&bx.fire(d,c);break;case"click":W&&!Z&&bj(W);break;case"keydown":case"keypress":var e=c.target;if(b.body!==e&&(/TEXTAREA|SELECT/.test(e.nodeName.toUpperCase())||e.type==="text"))return;a.stopEvent(c);var f=c.which||c.keyCode||c.charCode,g="";switch(f){case 72:case v:k.scrollTop-=50;break;case x:k.scrollTop+=50;break;case u:g=y;break;case 76:case w:g=z}g&&bj(g);break;case"swipeLeft":bj(z);break;case"swipeRight":bj(y)}},bl=function(a,b,c){var d=a.width,e=a.height,f=d/e;if(d>0&&e>0)if(f>=b/c){if(d>b){d=b;e=d/f}}else if(e>c){e=c;d=e*f}return{width:d,height:e}},bm=function(a){var b=a||P;G(b,{position:"absolute",top:"50%",left:"50%",marginLeft:b.width/-2+"px",marginTop:b.height/-2+"px"})},bn=function(a){if(!!V){var b=a||P,c=bl(V,T,U);b.width=c.width;b.height=c.height;bm(b)}},bo=300,bp=null,bq=function(){br();bp=c(function(){H(Q)},bo)},br=function(){var a=bp;if(a){clearTimeout(a);bp=null}I(Q)},bs=function(a,b){if(R){Y="";R.pause()}I(N);H(M);bq();var d=new Image,e=function(f){var g=d.width,h=d.height;d=e=d.onload=d.onerror=null;if(f==="error"){if(b){b();b=null}}else c(function(){if(X!==a)b=null;else{V={width:g,height:h};r(P,"opacity",0);H(P);if(b){b();b=null}bx.fire("load",{src:a,width:g,height:h});P.src=a;bn();D(P,{opacity:1},150,function(){br()})}},1)};d.onload=function(){e("load")};d.onerror=function(){e("error")};d.src=a},bt=function(a){if(!!B&&!!a){B=g.setExtend(B,{sid:g.sid(),vf:"layer",doc:"gif"});B.play_time=e(0,"yyyy-MM-dd hh:mm:ss").Today.Format;B.object_id=a.gif_oid;B.uid=$CONFIG.uid;B.mid=a.mid;B.mid_uid=a.uid;B.rootmid=a.mid;B.rootuid=a.uid;B.isautoplay="1"}},bu=function(a){if(!(!R||!B||!a)){if(R.getValidTime()<=0)return;var b;B.playduration=Math.round(R.currentTime()*1e3);B.valid_play_duration=Math.round(R.getValidTime()*1e3);R.resetValidTime();B&&(b=m.formateJson(B));a.unLog!=1&&!R.unLog&&b?C.set(b):null}},bv=function(a){var b=a.data,c=a.callback,d=a.src,h=b.gif_width,i=b.gif_height,j=b.gif_duration;!B&&(B=g.Obj);B=g.setExtend(B,{sid:g.sid()});B.play_time=e(0,"yyyy-MM-dd hh:mm:ss").Today.Format;B.object_id=b.gif_oid;B.duration=j;B.playduration=0;bt(b);!C&&(C=f(A));bu(b);R.gifPlayed=!1;m.setStyles(N,{width:h+"px",height:i+"px"});V={width:h,height:i};if(c){c();c=null}bx.fire("load",{gif:!0,src:d,width:h,height:i});bn(N)},bw=function(b,f,h,i){if(!i||i.gif_oid!=Y){q([M,P],I);q([N,S],H);!g&&(g=a.lib.feed.plugins.video.log());if(R){if(R.currentSrc()==h){f=null;return}R.trigger("srcChange",{gif_oid:i.gif_oid,sources:[{src:h,type:"video/mp4"}]});bv({src:b,callback:f,data:i});R.trigger("initMenu",{src:b,voice:!1,save:!0})}else{var j=function(){if(!!R){N.appendChild(S);bv({src:b,callback:f,data:i})}},k=function(a,b){if(!!R&&!!B){b&&(B=g.setExtend(B,{sid:g.sid()}));B.play_time=e(0,"yyyy-MM-dd hh:mm:ss").Today.Format;B.playduration=0}},l=function(a){bu(i)},m=function(a){I(S)},n=function(a){if(!!R){bs(b,f);bg()}},o=function(b){if(!!s&&!!p){a.addClassName(s,W+"cursor");c(function(){Z=!1},500)}},r=function(b){if(!!s&&!!p){a.removeClassName(s,W+"cursor");Z=!0}};R=d({sources:[{src:h,type:"video/mp4"}],save:!0,voice:!1,src:b,loop:!0,autoplay:!0,gif_oid:i.gif_oid,box:N,cb:j});R.on("updateLog",k);R.on("sendLog",l);R.on("canplay",m);R.on("fail",n);R.on("hideContextMenu",o);R.on("showContextMenu",r)}Y=i.gif_oid}};ba(i);var bx=l.extend({events:["navigate","contextmenu","mousemove","mouseover","mouseout"],getOuter:function(){return p},load:F(function(a,b,c,d){if(!a||a!=X){_||bc();X=a;h.video(!0)&&c?bw(a,b,c,d):bs(a,b)}},10),resize:function(a,b){if(a!==T||b!==U){T=a;U=b;G(s,{width:a+"px",height:b+"px"});bn()}},set:bd,get:be,remove:bf,show:bc,hide:bh,destroy:function(){bx.hide();bx.fire("destroy");bx.removeEvents();_=null;P=null;s=null;N=null;R&&R.dispose&&R.dispose();R=null;C&&C.destroy&&C.destroy();C=null;g&&g.destroy&&g.destroy();Y="";Z=!1}});return bx};return M});
STK.register("lib.photoview.source.carousel",function(a){function V(){var a=this,b=a.get("numItems");if(!!b&&!a.isAnimating()){var c=a._carouselEl,d=a.get("firstVisible"),e=a.get("numVisible"),f=d+e-1;f=f>b-1?b-1:f;var g=a._items,h=g[d].el,i=g[f].el,j;if(i)while(j=p(i))c.removeChild(j);if(h)while(j=o(h))c.removeChild(j);c.style.left="0px";a.flush()}}function U(a,b,c){var d=this,e=d.get("numVisible"),f=d._selectedItem;d.get("selectOnScroll")&&d.get("selectedItem")!==f&&d.setSelectedItem(f);d.fire("afterScroll",{dir:c,first:d.get("firstVisible"),last:b})}function T(a,b){var c=this,d=c.get("CLASSES"),e,f=c._items,g=c.get("numItems"),h=c.get("numVisible"),i=c.get("firstVisible"),l=b,m=i+h-1,n,o=d.SELECTED_ITEM;if(i+h>g-1){m=g-1;i=D(m-h,0);c.set("firstItem",i)}isNaN(a)&&(a=i);if(l!==a){if(l>=0&&l<g){n=f[l];n&&(e=n.el)&&k(e,o)}if(f[a]){var p=f[a].status===X;if(g>h){var q=~~(h/2),r=a-q;r<0&&(r=0);g-r<h&&(r=D(g-h,0));(!p||r!==i)&&c.scrollTo(r)}else{p||c.scrollTo(a);(a<i||a>m)&&c.scrollTo(a)}(e=f[a].el)&&setTimeout(function(){e&&a===c._selectedItem&&j(e,o)},200)}}}function S(){var a=!1,b=this,c=b.get("CLASSES"),d=c.PREV_DISABLED,e=c.NEXT_DISABLED,f,g,l=b.get("numItems"),m=b.get("firstVisible");if(!!b._rendered){f=b.get("navigation");if(g=f.prev){var n=b.get("prevStateFn");if(!n()){i(g,"click",b.get("pcFn"));j(g,d);b._prevEnabled=!1}else a=!b._prevEnabled;if(a){h(g,"click",b.get("pcFn"));k(g,d);b._prevEnabled=!0}}a=!1;if(g=f.next){var o=b.get("nextStateFn");if(!o()){i(g,"click",b.get("ncFn"));j(g,e);b._nextEnabled=!1}else a=!b._nextEnabled;if(a){h(g,"click",b.get("ncFn"));k(g,e);b._nextEnabled=!0}}}}function R(a){var b=this,c=0,d=0,e="width";c=b._itemSize||Q.call(b,e);d=c*a;return d}function Q(a,b){var c=this,d,e=0,f=!1;d=b||q(c._carouselEl);if(!d)return 0;f=a==="height";e=L(d,f?"height":"width");return e}function P(a,b){var c=document.createElement(a);b=b||{};b.className&&j(c,b.className);b.styles&&v(c,b.styles);b.parent&&b.parent.appendChild(c);b.id&&c.setAttribute("id",b.id);b.html&&(b.html.nodeName?c.appendChild(b.html):c.innerHTML=b.html.replace(/src=\"about:blank\"/g,""));return c}function O(a,b){var c=N(a);r(a,"width",b-c+"px")}function N(b){return L(b,"width")-parseInt(a.getStyle(b,"width"))}function M(a,b){switch(b){case"height":return L(a,"marginTop")+L(a,"marginBottom")+L(a,"paddingTop")+L(a,"paddingBottom")+L(a,"borderTopWidth")+L(a,"borderBottomWidth");case"width":return L(a,"marginLeft")+L(a,"marginRight")+L(a,"paddingLeft")+L(a,"paddingRight")+L(a,"borderLeftWidth")+L(a,"borderRightWidth");default:}return L(a,b)}function L(b,c,d){function g(b,c){var d=parseFloat(a.getStyle(b,c));return isNaN(d)?0:d}function f(b,c){var d=parseInt(a.getStyle(b,c),10);return isNaN(d)?0:d}var e;if(!b)return 0;typeof d=="undefined"&&(d="int");switch(c){case"height":e=b.offsetHeight;e>0?e+=f(b,"marginTop")+f(b,"marginBottom"):e=g(b,"height")+f(b,"marginTop")+f(b,"marginBottom")+f(b,"borderTopWidth")+f(b,"borderBottomWidth")+f(b,"paddingTop")+f(b,"paddingBottom");break;case"width":e=b.offsetWidth;e>0?e+=f(b,"marginLeft")+f(b,"marginRight"):e=g(b,"width")+f(b,"marginLeft")+f(b,"marginRight")+f(b,"borderLeftWidth")+f(b,"borderRightWidth")+f(b,"paddingLeft")+f(b,"paddingRight");break;default:d==="int"?e=f(b,c):d==="float"?e=g(b,c):e=a.getStyle(b,c)}return e}function K(a,b){return(a=String(a))?a.replace(J,function(a){var c=a.length,d=a.substring(1,c-1),e=b[d];return e===undefined?a:e}):a}function I(a,b){var c=a.length;while(c--)if(b(a[c]))return c;return-1}function H(b,c){var d=a.core.arr.indexOf(c,b);d!==-1&&b.splice(d,1);return d}function G(a,b){if(a.filter)return a.filter(b);var c=[];for(var d=0,e=-1,f=a.length;d<f;d++)b(a[d],d)&&(c[++e]=a[d]);return c}function F(a,b){"use strict";if(a.map)return a.map(b);if(typeof b!="function")throw TypeError("map need a function");var c=a,d=c.length>>>0,e=Array(d);for(var f=0;f<d;f++)f in c&&(e[f]=b.call(null,c[f],f,c));return e}function E(a,b){return a<b?a:b}function D(a,b){return a>b?a:b}function C(a){return typeof a=="function"}function B(a){return typeof a=="number"}var b=a.lib.photoview.source,c=b.eventemiter,d=a.tween,e=a.core.json.merge,f=a.foreach,g=a.preventDefault,h=a.addEvent,i=a.removeEvent,j=a.addClassName,k=a.removeClassName,l=a.insertHTML,m=a.lib.kit.dom.parseDOM,n=a.core.dom,o=n.prev,p=n.next,q=n.firstChild,r=a.setStyle,s=STK.core.util.browser,t=window.Math,u=b.util,v=u.setStyles,w=[].push,x=[].unshift,y=[].slice,z=function(a){return y.call(a.children,0)};try{y.call(document.documentElement.children,0)[0].nodeType}catch(A){z=function(a){var b=[],a=a.firstChild;while(a){a.nodeType===1&&(b[b.length]=a);a=a.nextSibling}return b}}var J=/\{\w[\w.]*?\}/g,W=0,X=1,Y=!0,Z=function(a){return a.status===X},$=["click","show","hide","render","selectedItemChange","itemLoad","itemAdded","itemRemoved","itemSelected"],_=c.extend(function(a,b){if(!(this instanceof _))return new _(a,b);if(!a||a.nodeType!==1)throw Error("Carousel construct failed, el not a valid html element.");var d=this;c.call(d,$);b=e({itemSize:0,itemMargin:1,numItems:0,numVisible:1,firstVisible:0,scrollIncrement:1,currentPage:1,selectedItem:-1,itemTemplate:"",itemTemplateVpay:"",animation:{method:"easeoutcubic",speed:300},CLASSES:{WRAP:"carousel",LIST:"carousel-list",CLIP:"carousel-clip",ITEM:"carousel-item",SELECTED_ITEM:"current",PREV_DISABLED:"disabled",NEXT_DISABLED:"disabled"}},b,{isDeep:!0});d.get=function(a){return b[a]};d.set=function(a,c){b[a]=c};d.init(a,b)},{_items:null,_carouselEl:null,_clipEl:null,_itemSize:0,_itemMargin:0,_isAnimating:!1,_rendered:!1,_selectedItem:-1,hidden:!1,init:function(b,c){var d=this,e=c.CLASSES,h=m(a.builder(b).list),i,k;h.prev=h.prev||l(b,'<div class="carousel-prev"></div>');h.next=h.next||l(b,'<div class="carousel-next"></div>');h.clip=h.clip||l(b,'<div class="'+e.CLIP+'"></div>');h.list=h.list||l(h.clip,'<ul class="'+e.LIST+'"></ul>');i=h.clip;k=h.list;j(b,e.WRAP);j(i,e.CLIP);j(k,e.LIST);v(i,{overflow:"hidden",position:"relative"});v(k,{overflow:"hidden",position:"relative"});var n={prev:h.prev,next:h.next};f(n,function(a,b){j(a,"carousel-nav")});d._items=[];d._parseItems();d.set("navigation",n);d.set("element",b);d.set("numItems",d._items.length);d._el=b;d._clipEl=i;d._carouselEl=k;d.hide();d.set("pcFn",function(a){g(a);d.get("prevClick")(a)!==!1&&d.scrollPrev()});d.set("ncFn",function(a){g(a);d.get("nextClick")(a)!==!1&&d.scrollNext()});var o=function(){return!0};d.set("prevClick",o);d.set("nextClick",o);d.set("prevStateFn",function(){return!d.isBOF()});d.set("nextStateFn",function(){return!d.isEOF()});d._initEvts()},show:function(){var a=this,b;if(a.hidden){b=a._el.style;b.visibility="visible";b.display="block";a.hidden=!1;a.fire("show")}return a},hide:function(){var a=this;if(!a.hidden){a.hidden=!0;a._el.style.display="none";a.fire("hide")}return a},isBOF:function(){return this.get("numItems")===0||this.get("firstVisible")===0},isEOF:function(){var a=this,b=a.get("firstVisible"),c=a.get("numItems"),d=b+a.get("numVisible");return d>=c},render:function(a){var b=this;if(!b._rendered){b.show();b._refreshUi();b._syncUiItems();return!0}},_parseItems:function(){},_initUiState:function(){var b=this,c=b._el,d=b._clipEl,e=b._carouselEl,f,g=q(e),h,i,j,k,l,m;a.setStyle(d,"width","");m=0;l=L(c,"width");l-=M(c,"width")+M(d,"width");g=q(e);if(!g){f=e.appendChild(b._createItem({}));f.style.visibility="hidden";g=f}h=Q.call(b,"width",g);i=Q.call(b,"height",g);j=L(g,"marginRight","int");b.set("itemSize",h);b.set("itemMargin",j);f&&a.removeNode(f);if(l>0){k=t.floor((l+j)/h);b.set("numVisible",k);m=t.floor((l-k*(h-j))/(k-1))-j}b.set("addMargin",m)},_refreshUi:function(){var a=this,b=a._items.length;a._initUiState();if(!(b<1)){var c=a._clipEl,d=a._carouselEl,e=a.get("itemSize"),f=a.get("itemMargin"),g=a.get("numVisible"),h=a.get("addMargin");f+=h;g<=b&&(a._itemMargin=f);var i=e+h;v(c,{marginRight:"auto",marginLeft:"auto",width:g*i-f+"px"});r(d,"width",b*i+"px");a._itemSize=i;a._rendered=!0;a.fire("render")}},_syncUiForItemAdd:function(){var a=this;a._rendered||a._refreshUi();a._syncUiItems()},_syncUiItems:function(){if(!!Y){var a=this,b=a._items,c=a._itemMargin;if(c>0)for(var d=b.length,e;d--;){e=b[d];if(e.status===X&&e.margin!==c){e.margin=c;r(b[d].el,"marginRight",c+"px")}}var f=a._carouselEl;r(f,"width",z(f).length*a._itemSize+"px");a._selectedItem<0&&a.setSelectedItem(a.get("selectedItem"))}},flush:function(a,b){var c=this,d,e=c._items,f=c._carouselEl,g=c.get("numVisible"),h=c.get("firstVisible"),i=c.get("numItems"),j,k,l,m=0,n,o=0;if(!!i){if(typeof a!="number"||typeof b!="number"){a=h;a<0&&(a=0);b=E(a+g-1,i-1);if(a+g>i-1){b=i-1;a=D(b-g,0)}}else b>=i&&(b=i-1);if(a<h){l=c._findClosestSibling(a);o=L(f,"left","int")}k=b-a+1;if(k>0){Y=!1;while(a<=b){d=e[a];j=d.el;if(!j||d.status===W){j=c._createItem(d.data);d.el=j;d.status=X;c.fire("itemLoad",{prev:e[a-1],next:e[a+1],data:d})}if(j.parentNode!==f){if(l){++m;f.insertBefore(j,l)}else f.appendChild(j);c.fire("itemAdded",d)}++a}Y=!0;c._syncUiItems();if(m>0){n=0-m;o+=R.call(c,n);f.style.left=o+"px"}}}},scrollTo:function(b){var c=this,e,f,g,h,i,j,k,l,m,n,o=c._items;j=c.get("numItems");i=c.get("firstVisible");if(!isNaN(b)&&j!==0&&b!==i&&!c.isAnimating()){e=c._carouselEl;f=c.get("animation");k=c.get("numVisible");b<0&&(b=0);j-b<k&&(b=D(j-k,0));if(b===i)return;h=i>b?"backward":"forward";n=i+k-1;n=n>j-1?j-1:n;m=c.fire("beforeScroll",{dir:h,first:i,last:n});if(m===!1)return;var p=b,q=b+k-1;p>n+1&&(p=n+1);c.flush(p,q);g=0-b;if(i>0){var s=a.core.arr.indexOf(o[i].el,z(c._carouselEl));if(s!==-1&&s!==i){g+=i-s;g=g>0?0:g}}n=b+k;n=n>j-1?j-1:n;l=R.call(c,g);c.set("firstVisible",b);if(f){var t=function(){c._isAnimating=!1;U.call(c,b,n,h)};c._isAnimating=!0;d(e,{duration:f.speed,animationType:f.method,end:t}).play({left:l}).destroy()}else{r(e,"left",l+"px");U.call(c,b,n,h)}}},scrollNext:function(){var a=this;a.scrollTo(a.get("firstVisible")+a.get("scrollIncrement"))},scrollPrev:function(){var a=this;a.scrollTo(a.get("firstVisible")-a.get("scrollIncrement"))},addItems:function(a,b){var c=this,d=c._items,e=a.length,f=c._itemMargin,g=a&&a.length;if(!!g){a=F(a,function(a){return{data:a,el:null,status:W,margin:0}});if(d.length>0&&b){x.apply(d,a);c.set("firstVisible",c.get("firstVisible")+g);var h=c.get("selectedItem");if(h!==-1){h+=g;c._selectedItem=h;c.set("selectedItem",h)}}else w.apply(d,a);c.set("numItems",d.length)}},rewriteItem:function(a,b){var c=this._items,d=b?c[b]:c[this._selectedItem];d.data.is_liked=a.is_liked;d.data.likecount=a.count},removeItems:function(b){var c=this,d=c._items,e,f,g=b.length;while(g--){e=b[g];H(d,e);(f=e.el)&&a.removeNode(f)}c.set("numItems",d.length);c.resize();c.fire("itemsRemoved")},setSelectedItem:function(a){var b=this,c=b._items.length-1,d=b._selectedItem;a=parseInt(a);if(isNaN(a)||a<0)a=0;if(c<0)b.set("selectedItem",a);else{a>c&&(a=c);if(d!==a){b.set("selectedItem",a);b._selectedItem=a;b.fire("selectedItemChange",{prevValue:d,newValue:a})}}},clear:function(){var a=this;a.set("numItems",0);a.set("firstVisible",0);a.set("selectedItem",-1);a._selectedItem=-1;a._rendered=!1;a._items=[];var b=a._carouselEl;b.innerHTML="";b.style.left="0"},resize:function(){var a=this,b=a._carouselEl;if(!!a.get("numItems")&&!a.isAnimating()){u.empty(b);b.style.left="0";a._rendered=!1;a._refreshUi();a.flush()}},filter:function(a){return G(this._items,a)},slice:function(a,b){var c=this._items,d=c.length;a=a<0?0:a;b=b>d?d:b;return c.slice(a,b)},destroy:function(){this.clear();S.call(this);this.removeEvents();this._el=null;this._clipEl=null;this._carouselEl=null},isAnimating:function(){return this._isAnimating},_createItem:function(a){var b=this,c=b.get("CLASSES").ITEM,d=a.className,e=b._itemMargin,f=a.isPrivate==1?b.get("itemTemplateVpay"):b.get("itemTemplate"),g;c&&d&&d!==c&&(c+=" "+d);return P("LI",{className:d,html:a.html||K(f,a)})},_findClosestSibling:function(a){var b=this,c=b._items,d=c.length,e=a+1,f,g,h;while(e<d&&!f){g=c[e++].el;h=g&&g.parentNode;h&&h.nodeType===1&&(f=g)}return f},_initEvts:function(){var b=this;b.on("itemAdded",function(a,c){b._syncUiForItemAdd(c)});b.on("selectedItemChange",function(a,c){T.call(b,c.newValue,c.prevValue);b.fire("itemSelected",b._items[c.newValue])});b.on("afterScroll",function(a,c){V.call(b,c);S.call(b,c)});b.on("render",function(a){b._setNavigation(b.get("navigation"));S.call(b,a);b.show()});b.on("itemsRemoved",function(a){b._setNavigation(b.get("navigation"));S.call(b,a)});b.on("click",function(a,c){b._itemClickHandler(c)&&g(c)});h(b._el,"click",function(c){b.fire("click",a.fixEvent(c))})},_setNavigation:function(a){var b=this;a.prev&&h(a.prev,"click",b.get("pcFn"));a.next&&h(a.next,"click",b.get("ncFn"))},_itemClickHandler:function(a){var b=this,c=b._el,d=b._carouselEl,e,f=a.target,g=f.tagName.toUpperCase();if(g!=="INPUT"&&g!=="SELECT"&&g!=="TEXTAREA"){while(f&&f!==c&&f!==d){if(f.nodeName.toUpperCase()==="LI")break;f=f.parentNode}e=I(b._items,function(a){return a.el===f});if(e>=0){b.setSelectedItem(e);return!0}return!1}}});return _});
STK.register("lib.photoview.source.comment",function(a){function H(b){var c=a.builder(b);G(c.list);return c.box}function G(a){a=g(a);for(var b in a)a.hasOwnProperty(b)&&(F[b]=a[b])}var b=a.lib.photoview.source,c=b.util.mix,d=a.lib.comment.commentMsg,e=a.lib.comment.commentTemp,f=a.lib.comment.reply,g=a.lib.kit.dom.parseDOM,h="",i=a.ui.alert,j=a.ui.tip,k=a.lib.kit.extra.language,l=a.custEvent,m=a.sizzle,n=a.setStyle,o=a.core.dom,p=a.core.evt.preventDefault,q=a.conf.trans.feed.comment,r=a.lib.kit.dom.children,s=a.core.evt.removeEvent,t=a.addClassName,u=a.removeClassName,v,w,x,y,z=!1,A=!1,B=!1,C=1,D,E='<div><i class="W_loading"></i> <span>正在加载中，请稍候...</span></div>',F={},I=function(a,b){return m(a,b)[0]},J=a.lib.photoview.source.channel,K={content:k("#L{评论内容不能为空哦，写点东西吧。}"),"delete":k("#L{确定要删除该回复吗}"),reply:k("#L{回复}"),blcok:k("#L{同时将此用户加入黑名单}"),notice:k("#L{输入评论内容}"),unReply:k(d.noPhoneReplyMsg),unPower:k(d.noPowerReplyMsg)},L=function(a){return parseInt(a.innerHTML.replace(/[^\d]+/,""))||0},M=function(d,g){var i=g.mid,p,u,A,C,E,G,L,M=new RegExp(["^",K.reply,"@([^:]*):(.*)"].join("")),P=a.core.str,R=a.lib.dialog.commentDialogue(),S={},T,U,V,W,X,Y,Z=function(b){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("big_pic_cover","commt_pub_button");var e=a.trim(w.value),f=e.match(M),i=w.getAttribute("pid");if(i==="loading")a.ui.tipAlert(k("#L{图片上传中请稍后}"),{icon:"rederrorS"}).beside(w).on("hide",function(){w.focus()});else{if(e==""||f&&a.trim(f[2])==""||e==K.notice){a.ui.tipAlert(K.content,{icon:"rederrorS"}).beside(w).on("hide",function(){w.focus()});return}if(!f||!f[1]||f[1]!=A)p=A=null;h=a.sizzle('em[node-type="btnText"]',b.el)[0].innerHTML;b&&b.el?b.el.className="W_btn_a W_btn_a_disable":I('[action-type="post"]',d).className="W_btn_a W_btn_a_disable";var j=a.lib.kit.extra.getDiss({act:f?"reply":"post",cid:p,content:P.leftB(e,280),isroot:E&&E.checked?"1":"0",forward:C&&C.checked?"1":"0",appkey:g.appkey,mark:g.mark,type:"photolayer",pic_src:g.shouldPicSrc?"layer":""},b.el);c(j,{log_type:"weibo",refer_sort:"layer",location:$CONFIG.location,pdetail:$CONFIG.page_id});i&&(j.pic_id=i);bj.post(j)}},_=function(b){var d=b.el,h=b.data.cid,j=b.data.nick,m=b.data.canUploadImage==1,n=b.data.canUploadFunnypic||"0",p="photolayer",q=o.dir(d,{dir:"parent",expr:"li",matchAll:!1})[0],r=g.mark||"",s=o.dir(d,{dir:"parent",expr:".WB_func",matchAll:!1})[0],t=S[h]&&S[h].DOM,u=t?a.core.dom.contains(document.body,t):!1;if(t&&a.getStyle(t,"display")!="none"&&u){a.setStyle(t,"display","none");a.removeClassName(q,"curr")}else{if(!t||!u){t=a.builder(k(e.getReply({canUploadImage:m,canUploadFunnypic:n}))).list.commentwrap[0];s&&a.core.dom.insertAfter(t,s);var v={mid:i,cid:h,content:j,mark:r,module:"scommlist",type:p};c(v,{log_type:"weibo",refer_sort:"layer",location:$CONFIG.location,pdetail:$CONFIG.page_id});S[h]={handle:f(t,v),DOM:t};l.add(S[h].handle,"reply",be,{liItem:q})}a.setStyle(t,"display","");a.addClassName(q,"curr");S[h]&&S[h].handle.focus()}},ba=function(){var a,b,c=function(){b&&window.clearTimeout(b);if(a){a.aniHide();a.destroy();a=null}},d=function(d){c();a=j("alert",{msg:d,type:"warn"});b=window.setTimeout(c,3e3);return a};d.hide=c;return d}(),bb=function(b){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("big_pic_cover","commt_list_reply");var c=b.el,d=b.data,e;if(a.core.dom.hasClassName(c,"unclick_rep")){var f=c.getAttribute("isPhone");f?e=ba(K.unReply):e=ba(K.unPower);e.setLayerXY(c);e.aniShow()}else d&&d.ispower=="1"?q.request("isComment",{onComplete:function(a){if(a.code=="100000"){var f,g;d&&(f=d.nick)&&_(b)}else{if(a.code=="100022")e=ba(K.unPower);else if(a.code=="100001"){e=ba(K.unReply);c&&c.setAttribute("isphone","1")}else e=ba(K.msg);e.setLayerXY(c);e.aniShow();t(c,"unclick_rep")}},onSuccess:a.funcEmpty},d):_(b)},bc=function(b){var c=b.data.block?['<input node-type="block_user" id="block_user" name="block_user" value="1" type="checkbox"/><label for="block_user">',K.blcok,"</label>"].join(""):"";a.ui.confirm(K["delete"],{OK:function(a){var c=a.block_user,d,e;(d=b.data)&&(e=d.cid)&&bj.del({act:"delete",cid:e,is_block:c?"1":"0"})},textComplex:c})},bd=function(a){u=a.data.cid;R.show(a)},be=function(a,b){bf(b,a.data)},bf=function(b,c){var d=b.data;if(!d)return!1;p=A=null;c&&c.liItem&&a.removeClassName(c.liItem,"curr");if(d.comment&&y){a.insertHTML(y,d.comment,"afterbegin");Q()}d.feed&&J.fire("forwardCount",1);J.fire("commentCount",1);bh.changeSubmitBtn();return!0},bg=function(){if(!B){var a=F.commentMore;if(a.getAttribute("data-local")==="1"){var b=F.todo_more,c=r(b),d=c.length,e=D.pagenum<D.totalpage;while(d-->4)n(c[d],"display","");a.removeAttribute("data-local");n(a,"display",e?"block":"none");Q()}else{z=!0;O(bj)}}},bh={checkIsEmpty:function(){var b=new RegExp(["^",K.reply,"@([^:]*):(.*)"].join("")),c=a.sizzle("[node-type='submit']",d)[0],e=a.trim(w.value.replace(K.notice,"")),f=e.match(b);c&&(e==""||f&&a.trim(f[2])==""?!a.hasClassName(c,"W_btn_a_disable")&&a.addClassName(c,"W_btn_a_disable"):a.hasClassName(c,"W_btn_a_disable")&&a.removeClassName(c,"W_btn_a_disable"))},changeSubmitBtn:function(){var a=I("em[node-type='btnText']",d),b=I("a[action-type='post']",d);b.className="W_btn_a";h&&(a.innerHTML=h)},add_success:function(a,b){if(bf(a)){w.value="输入评论内容";var c=I("[node-type=showCommentBtn]",v),d=I("a[node-type=submit]",c);d.className="W_btn_a";n(c,"display","none");n(w,"height","25px");Y&&Y.hideLayer()}},add_fail:function(){bh.changeSubmitBtn()},add_error:function(){bh.changeSubmitBtn()},delete_success:function(a,b){var c=I(['div[comment_id="'+b.cid+'"]'].join(""),d);if(c){c.parentNode.removeChild(c);J.fire("commentCount",-1);Q()}},delete_fail:function(a,b){},smallList_success:function(c,e){e.focus=!1;var f=c,g={limitNum:140,tipText:K.notice,count:"disable"};if(!!f){d.innerHTML="";d.appendChild(H(c.html));w=F.textEl;V=setTimeout(function(){if(w){a.lib.kit.dom.autoHeightTextArea({textArea:w,maxHeight:9999,inputListener:function(){var b=a.trim(w.value);P.bLength(b)>280&&(w.value=P.leftB(b,280))}});try{L=a.lib.editor.base(d,g);G=L.editor;l.define(G,"close");var b=a.sizzle('[node-type="smileyBtn"]',d)[0],c=a.sizzle('[node-type="imgBtn"]',d)[0];X=a.lib.publisher.widget.face(G);Y=a.lib.image.commentImage(G,c,{placeholder:K.notice});a.addEvent(b,"click",X.show);U=setInterval(function(){bh.checkIsEmpty()},200);e.focus&&a.core.dom.selectText(w,{start:0});e.focus&&w.focus()}catch(f){}}},150);a.addEvent(w,"focus",N);C=I("input[name=forward]",d);E=I("input[name=isroot]",d);x=I("div[node-type=commentList]",d);y=I("div[node-type=todo_more]",d);a.core.evt.hotKey.add(x,["ctrl+enter"],Z);var h=m("div[node-type=scroller]")[1];W&&W.destroy();W=b.setTextarea(h,x);bi.add("reply","click",bb);bi.add("delete","click",bc);bi.add("post","click",Z);bi.add("commentDialogue","click",bd);bi.add("commentMoreBtn","click",bg)}}},bi=a.delegatedEvent(d),bj=a.lib.photoview.source.inter(bh,g);l.define(bj,["count","feed","comment","del","destroy"]);bj.disposed=!1;bj.destroy=function(){if(!bj.disposed){bj.disposed=!0;if(G){L.destroy();G=null;L=null}if(V){clearTimeout(V);V=null}if(W){W.destroy();W=null}if(T){bi.remove("qface_send","click",T.send);T.destroy();T=null}a.foreach(S,function(a){l.remove(a.handle);l.undefine(a.handle);a.DOM=null;a.handle=null});a.core.evt.hotKey.remove(x,["ctrl+enter"],Z);U&&clearInterval(U);ba.hide();bi.remove("commentMoreBtn","click",bg);bi.remove("check","foucs",N);bi.remove("reply","click",bb);bi.remove("delete","click",bc);bi.remove("post","click",Z);bi.remove("commentDialogue","click",bd);bi.destroy();s(w,"focus",N);l.remove(bj);l.undefine(bj)}};return bj},N=function(){a.trim(w.value)==K.notice&&(w.value="");var b=I("[node-type=showCommentBtn]",v),c=I("a[node-type=submit]",b);n(b,"display","")},O=function(b,c){if(!B){B=!0;var d={};d.id=T.mid;d.type="photolayer";d.page=C||1;z&&(F.showCommentMore.innerHTML=E);a.conf.trans.photoview.request("commentList",{onSuccess:function(a,c){P(b,a,c)},onError:function(b){a.lib.dialog.ioError(b.code,b)}},d)}},P=function(b,c,d){if(!b.disposed){B=!1;var e=c.data,f=e&&a.trim(e.html||"");if(!A){A=!0;U.load(T,{focus:!0,mid:T.mid});n(F.showCommentBtn,"display",f?"none":"block")}var g=c.data.page,h=F.commentMore,i=F.showCommentMore,j=F.todo_more,k=!1;if(f){if(g.pagenum===1){var l=I("cite[node-type=commentCount]",T.tab),m=parseInt(e.count,10)||0;l.innerHTML.indexOf("万")<0&&(l.innerHTML=m>0?" "+m:"");f=a.builder(f);var o=r(f.box),p=o.length,q=4;k=p>q;if(k){h.setAttribute("data-local","1");while(p-->q)n(o[p],"display","none")}j.appendChild(f.box)}else{k=g.pagenum<g.totalpage;a.insertHTML(j,f)}C=g.pagenum+1;D=g}n(h,"display",k?"block":"none");i.innerHTML="查看更多评论";Q()}},Q=function(){var a=F.todo_more;if(a){var b=r(a),c=b.length,d=c-1,e=F.commentMore.style.display==="none";while(c--){var f=b[c];e&&c===d?t(f,"last"):u(f,"last")}}},R=function(a){var b=I("cite[node-type=commentCount]",T.tab),c=L(b);a<0?--c:++c;b.innerHTML.indexOf("万")<0&&(b.innerHTML=c>0?" "+c:"")},S=!1,T,U,V=function(a,b,c){U=a;T=c;v=b;A=!1;z=!1;C=1;B=!1;O(a)},W=function(){S=!0;J.register("commentCount",R)};return function(a,b){S||W(b);a.html.shouldPicSrc=a.shouldPicSrc;if(!a||!a.mid||!(a=a.html))throw"mid is not defined";var c=M(b,a);V(c,b,a);return c}});
STK.register("lib.invoke.forward.source.API",function(a){var b={checkAtNum:function(a){var b=a.match(/@[a-zA-Z0-9\u4e00-\u9fa5_]{0,20}/g),c=a.match(/\/\/@[a-zA-Z0-9\u4e00-\u9fa5_]{0,20}/g);b=b?b.length:0;c=c?c.length:0;return b-c},preventDefault:function(b){a.core.evt.preventDefault(b);return!1}};return b});
STK.register("lib.photoview.source.forward",function(a){var b=a.setStyle,c=a.sizzle,d=a.lib.photoview.source,e=d.util.mix,f=a.lib.kit.dom.parseDOM,g=a.lib.kit.extra.language,h=a.lib.invoke.forward.source.API,i=a.core.evt.preventDefault,j=d.channel,k=a.lib.kit.dom.children,l=a.lib.kit.extra.toFeedText,m=a.core.dom,n=a.addClassName,o=a.removeClassName,p=a.core.evt.removeEvent,q=a.ui.alert,r=a.ui.tip,s,t,u=!1,v,w,x,y,z=1,A,B=!1,C=!1,D={},E={},F='<div><i class="W_loading"></i> <span>正在加载中，请稍候...</span></div>',G={notice:"#L{请输入转发理由}",defUpdate:"#L{转发微博}",netError:"#L{系统繁忙}",success:"#L{转发成功}!",retry:'#L{读取失败，请}<a href="#" onclick="return false;" action-type="retry" value="retry">#L{重试}</a>',off:"#L{关闭}",on:"#L{开启}"},H=function(a,b){b=="normal"?a.innerHTML=g("#L{转发}"):a.innerHTML=g("#L{提交中...}")},I=function(a,b){return c(a,b)[0]},J=function(a){return parseInt(a.innerHTML.replace(/[^\d]+/,""))||0},K=function(a){a=f(a);for(var b in a)a.hasOwnProperty(b)&&(E[b]=a[b])},L=function(b){var c=a.builder(b);K(c.list);return c.box},M,N=!1,O,P,Q,R,S=!1,T=function(){return s||(s=a.lib.dialog.validateCode())},U=function(b){a.lib.forward.forwardDialog(b.mid,b.forwardOpts)},V=function(a){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("big_pic_cover","trans_list_trans");var b=a.data;if(!!b){var d=m.dir.parent(a.el,{expr:"div[node-type=userinfo]"})[0],e=c("div.WB_text",d)[0],f=m.dir.parent(a.el,{expr:"[mid]"})[0],g=l(e.innerHTML),h=l(c("em",f)[0].innerHTML),i=b.mid,j={type:b.allowForward,origin:g,reason:h,originNick:b.rootname,forwardNick:b.name,title:"转发微博",domInit:!1,url:b.url,styleId:"1",allowComment:"1",allowForward:"1",allowRootComment:"1",pid:b.pid,mark:"",domain:"u/"+b.rootuid};U({mid:i,forwardOpts:j})}},W=function(a){E.textEl.value=="请输入转发理由"&&(E.textEl.value="");b(E.showforwradFace,"display","");E.submit.className="W_btn_a"},X=function(){if(!!y){var a=y.API.count(),b=140-a,c=b>=0?!0:!1;if(c){O=!1;R=""}else{O=!0;R="error"}}},Y=function(b){var c=b;if(!c)return!1;a.insertHTML(E.todo_more,c,"afterbegin");j.fire("forwardCount",1);Z();return!0},Z=function(){var a=E.todo_more;if(a){var b=k(a),c=b.length,d=c-1,e=E.forwardMoreBtn.style.display==="none";while(c--){var f=b[c];e&&c===d?n(f,"last"):o(f,"last")}}},$=function(a,c){O=!1;E.submit.className="W_btn_a";H(E.btnText,"normal");b(E.textEl,"height","25px");b(E.showforwradFace,"display","none");try{a.data.isComment=N;a.data.isToMiniBlog=!0}catch(d){}setTimeout(function(){r("lite",{msg:g(G.success),type:"succ",timer:"500"})},150);N=!1;y.API.reset();var e=a.data.html;Y(e);E.textEl.value="请输入转发理由"},_=function(b){var c=b.data,d={};d.mid=c.mid;a.conf.trans.feed.feed.getTrans("delete",{onSuccess:ba,onError:bb,onFail:function(){}}).request(d)},ba=function(a,b){var c=I(['div[mid="'+b.mid+'"]'].join(""),t);c&&c.parentNode.removeChild(c);j.fire("forwardCount",-1);Z()},bb=function(b,c){O=!1;E.submit.className="W_btn_a";H(E.btnText,"normal");b.msg=b.msg||g(G.netError);a.lib.dialog.ioError(b.code,b);N=!1},bc=function(a,b){O=!1;R="";E.submit.className="W_btn_a";H(E.btnText,"normal");q(g(G.netError))},bd=function(b){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("big_pic_cover","trans_pub_button");if(O)R==="error"&&a.lib.kit.extra.shine(E.textEl);else{var c=a.trim(y.API.getWords()||"");c==g(G.notice)&&(c="");var d={};d.reason=c||g(G.defUpdate);d.style_type=3;d.rank=0;d.mid=Q;d.location=$CONFIG.location||"";d.pic_src=D.shouldPicSrc?"layer":"";d.pic_id=E.textEl.getAttribute("pid");O=!0;R="loading";E.submit.className="W_btn_a W_btn_a_disable";E.originInput&&E.originInput.checked&&(d.is_comment_base="1");if(E.forwardInput&&E.forwardInput.checked){d.is_comment="1";N=!0}d=a.lib.kit.extra.getDiss(d,E.submit);e(d,{log_type:"weibo",refer_sort:"layer",location:$CONFIG.location});var f=a.conf.trans.photoview.getTrans("toMicroblog",{onComplete:function(a,b){var c={onSuccess:$,onError:bb,requestAjax:f,param:d,onRelease:function(){O=!1;R="";E.submit.className="W_btn_a";H(E.btnText,"normal");N=!1}};T().validateIntercept(a,b,c)},onFail:bc,onTimeout:bb});if(h.checkAtNum(c)>5){a.ui.confirm(g("#L{单条微博里面@ 太多的人，可能被其它用户投诉。如果投诉太多可能会被系统封禁。是否继续转发？}"),{OK:function(){f.request(d)},cancel:function(){O=!1;R="";E.submit.className="W_btn_a";H(E.btnText,"normal")}});return}f.request(d)}},be=function(a){if((a.keyCode===13||a.keyCode===10)&&a.ctrlKey){y.API.blur();bd()}},bf=function(b){if(!B){B=!0;var c={};c.id=D.mid;c.type="photolayer";c.page=z;C&&(E.forwardMoreBtnBox.innerHTML=F);a.conf.trans.photoview.request("forwardList",{onSuccess:bg,onError:function(b){a.lib.dialog.ioError(b.code,b)}},c)}},bg=function(c,d){B=!1;var e=c.data,f=e&&a.trim(e.html||"");if(!u){u=!0;bh()}var g=e.page,h=E.todo_more,i=E.forwardMoreBtn,j=E.forwardMoreBtnBox,l=!1;if(f){if(g.pagenum===1){var m=I("cite[node-type=forwardCount]",D.tab),n=parseInt(e.count,10)||0;m.innerHTML.indexOf("万")<0&&(m.innerHTML=n>0?" "+n:"");f=a.builder(f);var o=k(f.box),p=o.length,q=4;l=p>q;if(l){i.setAttribute("data-local","1");while(p-->q)b(o[p],"display","none")}h.appendChild(f.box)}else{l=g.pagenum<g.totalpage;a.insertHTML(h,f)}z=g.pagenum+1;A=g}else z===1&&b(E.showforwradFace,"display","");b(i,"display",l?"block":"none");j.innerHTML="查看更多转发";Z()},bh=function(){var b=D,e=b.forwardBox,f=b.repost.html;Q=b.mid;e.innerHTML="";e.appendChild(L(f));t=e;v=setTimeout(function(){a.lib.kit.dom.autoHeightTextArea({textArea:E.textEl,maxHeight:145,inputListener:function(){}});if(E.textEl)try{var b={limitNum:140,tipText:g(G.notice),count:"disable"},c=t;x=a.lib.editor.base(c,b);y=x.editor;a.custEvent.define(y,"close");var d=a.sizzle('[node-type="smileyBtn"]',c)[0],e=a.sizzle('[node-type="imgBtn"]',c)[0],f=a.lib.publisher.widget.face(y),h=a.lib.image.commentImage(y,e,{placeholder:G.notice});a.addEvent(d,"click",f.show)}catch(i){}},100);a.addEvent(E.textEl,"focus",function(){P&&clearInterval(P);P=setInterval(X,200);W()});a.addEvent(E.textEl,"blur",function(){clearInterval(P)});a.addEvent(E.submit,"click",bd);var h=c("div[node-type=scroller]")[1];w&&w.destroy();w=d.setTextarea(h,E.forward)},bi=function(a){var b=I("cite[node-type=forwardCount]",D.tab),c=J(b);a<0?--c:++c;b.innerHTML.indexOf("万")<0&&(b.innerHTML=c>0?" "+c:"")},bj=function(){if(!B){var a=E.forwardMoreBtn;if(a.getAttribute("data-local")==="1"){var c=E.todo_more,d=k(c),e=d.length,f=A.pagenum<A.totalpage;while(e-->4)b(d[e],"display","");a.removeAttribute("data-local");b(a,"display",f?"block":"none");Z()}else{C=!0;bf()}}},bk=function(a){M=a.dEvent;if(!M)throw Error("dEvent is null.");j.register("forwardCount",bi);M.add("feed_list_forward","click",V);M.add("forwardMore","click",bj);M.add("feed_list_delete","click",_)},bl=function(){if(P){clearInterval(P);P=null}if(y){x.destroy();y=null;x=null}if(v){clearTimeout(v);v=null}if(w){w.destroy();w=null}if(s){s.destroy();s=null}M.remove("feed_list_forward","click",V);M.remove("forwardMore","click",bj);M.remove("feed_list_delete","click",_);p(E.btnText,"click",bd);j.remove("forwardCount",bi)},bm=function(a){u=!1;C=!1;B=!1;D=a;z=1;bf()},bn={init:bk,update:bm,destroy:bl};return function(a){bk(a);return bn}});
STK.register("lib.photoview.source.userinfo",function(a){var b=a.lib.kit.dom.parseDOM,c=a.sizzle,d=a.lib.kit.dom.children,e=a.core.json.merge,f=a.custEvent,g=a.lib.kit.extra.language,h=a.lib.photoview.source,i=h.util.mix,j=h.channel,k,l,m=1,n=!0,o,p='<div class="WB_empty"> <div class="WB_innerwrap"> <div class="empty_con clearfix"> <p class="text"><i class="W_loading"></i>正在加载中，请稍候...</p> </div> </div> </div>',q=function(b,c,d){b&&a.setStyle(b,c,d)},r=function(b,c){var d=parseInt(a.getStyle(b,c),10);return isNaN(d)?0:d},s=Object.create||function(a){function b(){}b.prototype=a;return new b},t={},u=function(c){var d=a.builder(c),e=b(d.list);for(var f in e)e.hasOwnProperty(f)&&(t[f]=e[f]);return d.box},v=function(a,b){return c(a,b)[0]},w=function(){function C(b){a.lib.dialog.ioError(b.code,b);e=!1}function B(){e=!1;f=!0;i=0;o=0;q=0}function A(b){var c=a.builder(b);z(c.list);return c.box}function z(a){a=b(a);for(var c in a)a.hasOwnProperty(c)&&(y[c]=a[c])}var c=a.conf.trans.feed.attitude,e=!1,f=!0,h=!1,i=0,o=0,q=0,r=0,s,t=3,u=!1,w=0,x=!1,y={},D=function(b){var c=v('[action-type="like"]',y.tab),d={el:c,data:a.queryToJson(c.getAttribute("action-data"))};F(d,"notfirechange")},E=function(){var b=y.likeMoreBtn.style.display=="none",c=a.core.dom.lastChild(y.likeList);b?a.core.dom.addClassName(c,"last"):a.core.dom.removeClassName(c,"last")},F=function(b){if(f){if(!b){var e=v('[action-type="like"]',y.tab),b={};b.data=a.queryToJson(e.getAttribute("action-data"))}x=!1;var g=a.core.json.merge(b.data,{location:$CONFIG.location,object_type:"pic"});c.getTrans("objLike",{onSuccess:function(b){var c=b.data.html,e=y.panel,f=b.data.is_del?!0:!1,h=g.count;f?h--:h++;var i=h>0?h:0;if(!x){var k=v('[action-type="like"]',y.tab),l=v("em",k),m="W_icon",n="icon_praised_bc",o="icon_praised_b";m+=" "+(f?o:n);k.title=f?"赞":"取消赞";k.innerHTML='<em class="'+m+'"></em>'+(i>0?" "+i:"");var p=a.lib.kit.extra.actionData(k);p.set("count",i);p.set("is_liked",f?0:1);x=!0}if(f)setTimeout(function(){var b=a.sizzle('[node-type="uid='+$CONFIG.uid+'"]',e)[0];a.removeNode(b);var c=y.likeList;if(d(c).length==0){c.style.display="none";y.grabSofa.style.display=""}},100);else{var q=a.sizzle('[node-type="likeList"]',e)[0];q.style.display="";y.grabSofa.style.display="none";a.insertHTML(q,c,"AfterBegin")}E();j.fire("updateLayerLikeBtn",{count:i,isDel:f})},onFail:function(b){a.lib.dialog.ioError(b.code,b)},onError:function(b){a.lib.dialog.ioError(b.code,b)}}).request(g)}return!1},G=function(){var b=y.likeMoreBtn;if(b.getAttribute("data-local")==="1"){var c=y.likeList,e=d(c),f=e.length;for(var g=0,h=f;g<h;g++)a.setStyle(e[g],"display","");w<=5&&a.setStyle(b,"display","none");b.removeAttribute("data-local");E()}else{u=!0;H({object_id:k})}},H=function(b,e){f=!1;x=!1;b.page=m||1;b.object_type="pic";u&&(y.likeMoreBtn.innerHTML=p);c.request("photosmall",{onSuccess:function(b){f=!0;var c=!1,h=b.data,i=h.page;w=h.like_counts;var j=h.is_liked;a.custEvent.fire(L,"uplikestatus",{is_liked:j,like_counts:w});var k=h.html,o=y.panel,p=A(k);if(i.pagenum===1){o.innerHTML="";o.appendChild(p);w==0&&(y.likeList.style.display="none");var q=d(y.likeList),r=q.length;c=r>t;if(c){y.likeMoreBtn&&y.likeMoreBtn.setAttribute("data-local","1");while(r-->t)a.setStyle(q[r],"display","none")}w>t&&y.likeMoreBtn&&(y.likeMoreBtn.style.display="");if(!x){var s=y.tab,p=v('[action-type="like"]',s),u=v("em",p),z="W_icon",B="icon_praised_bc",C="icon_praised_b";z+=" "+(j?B:C);p.title=j?"取消赞":"赞";p.innerHTML='<em class="'+z+'"></em>'+(w>0?" "+w:"");var D=a.lib.kit.extra.actionData(p);D.set("count",w);D.set("is_liked",j?1:0);D.set("object_id",h.object_id);D.set("ref",l);x=!0}}else{a.insertHTML(y.likeList,k);c=i.pagenum<i.totalpage;y.likeMoreBtn.innerHTML='<a href="javascript:void(0)" class="WB_cardmore S_txt1 S_line1 clearfix" action-type="likeMoreBtn">'+g("#L{查看更多赞}")+"</a>";y.likeMoreBtn.style.display=c?"":"none"}m=i.pagenum+1;E();n||e&&e()},onFail:C,onError:C},b)},I;return{init:function(b){var c=b.tab,d=b.panel;y.tab=c;y.panel=d;z(a.builder(c).list);I=b.dEvent;h=!1;I.add("like","click",F);I.add("likeMoreBtn","click",G);j.register("likeChangedFromLayer",D)},load:function(b){m=1;u=!1;b=a.parseParam({mid:null,object_id:null},b);var c=y.panel;c.innerHTML=g('<div class="WB_empty"> <div class="WB_innerwrap"> <div class="empty_con clearfix"> <p class="text"><i class="W_loading"></i>正在加载中，请稍候...</p> </div> </div> </div>');B();s=b.mid;f=!1;setTimeout(function(){h||H(b,F)},100)},destroy:function(){h=!0;j.remove("likeChangedFromLayer",D);I.remove("like","click",F);j.remove("likeChangedFromLayer",D)}}}(),x=function(){function c(c){c=b(c);for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}var a={},d=null,e=null;return{init:function(b){d=b.dEvent;a.tab=b.tab;a.panel=b.panel},load:function(b){var c=E.repost_list;e&&e.destroy();var f=a.panel;f.innerHTML=p;e=h.forward({dEvent:d});e.update({forwardBox:f,repost:c,mid:b.mid,tab:a.tab,shouldPicSrc:b.shouldPicSrc})},destroy:function(){if(e){e.destroy();e=null}}}}(),y=function(){function e(c){var e=a.builder(c);d(b(e.list));return e.box}function d(a){a=b(a);for(var d in a)a.hasOwnProperty(d)&&(c[d]=a[d])}var c={},f,g;return{init:function(a){f=a.dEvent;c.tab=a.tab;c.panel=a.panel},load:function(b){b=a.parseParam({mid:null,page:1,shouldPicSrc:!1},b);var d=c.panel;d.innerHTML=p;g&&g.destroy();g=h.comment({html:E.comment_list,dEvent:f,mid:b.mid,tab:c.tab,shouldPicSrc:b.shouldPicSrc},d)},destroy:function(){if(g){g.destroy();g=null}}}}(),z,A=!1,B,C,D,E,F=function(b){function c(a,b){return d.getDom(a)[b||0]}n=!0;var d=z;d&&d.destroy();d=a.ui.mod.tab({templete:b,eventType:"click",currentTab:"tab"+o,currentClassName:"S_txt1",defaultClassName:"S_txt1"});z=d;var e={},g=function(a,b){var d=s(b);typeof d.init=="function"&&d.init({mid:D,dEvent:B,tab:c(a,0),panel:c(a,1)});e[a]=d},h=d.destroy;d.destroy=function(){h();f.undefine(d);f.remove(d);a.foreach(e,function(a){a.destroy()});e=null};var i=function(b){var d=c("tabarrow");d&&a.foreach(["tab1","tab2","tab3"],function(e){var f=a.core.dom.dir.parent(c(e),{expr:"li"})[0];if(b===e){f.appendChild(d);a.addClassName(f,"curr")}else a.removeClassName(f,"curr")})},j=function(a,b){b==2&&(n=!1);var c=e[a];i(a);c.load({mid:D,object_id:k,shouldPicSrc:C})};f.add(d,"tabIn",function(a,b){j(b,2)});g("tab1",w);g("tab2",x);g("tab3",y);j("tab1");j("tab"+o);return d},G=function(a){var b=['<div node-type="content">','<div class="media_expand S_bg1"   node-type="tab1" style="display:none"></div>','<div class="WB_feed_repeat S_bg1" node-type="tab2" style="display:none"></div>','<div class="WB_feed_repeat S_bg1" node-type="tab3" style="display:none"></div>',"</div>"].join("");a=(a||"").replace(/>\s\s*</g,"><");var c=t.userinfoBox,d=a+b;c.innerHTML="";c.appendChild(u(d));F(t.userinfoBox)},H=function(){if(z){z.destroy();z=null}},I=function(a){var b=t.userinfoBox;b&&(b.innerHTML=a)},J=function(b,c){var d='<div node-type="scroller" class="scroller_box"><div class="inner_box"><div class="WB_feed_type" node-type="userinfoBox"></div></div></div>';b.innerHTML="";b.appendChild(u(d));B=a.delegatedEvent(b);C=c.shouldPicSrc},K=function(a,b){if(!b)I("抱歉，此微博已被删除。");else{E=b;D=a.mid;k=a.object_id;l=a.ref;G(b.mblog.html)}},L={update:K,setLoading:function(a){if(!a||!A){H();A=a;I(a?p:"")}},setCurTabIndex:function(a){o=a||3},resize:function(a){var b=t.scroller,c=r(b,"marginTop")+r(b,"marginBottom")+r(b,"borderTopWidth")+r(b,"borderBottomWidth")+r(b,"paddingTop")+r(b,"paddingBottom");q(b,"height",Math.max(a.height-c,0)+"px")},destroy:function(){H();if(B){B.destroy();B=null}}};a.custEvent.define(L,"uplikestatus");return function(a,b){J(a,b);return L}});
STK.register("lib.photoview.source.recommonedlayer",function(a){function g(b,c){c=c||window;var d=f(b),e=f(c),g=(e.width-d.width)/2,h=(e.height-d.height)/2;c===window&&(h+=a.scrollPos().top);b.style.top=(h>0?h:0)+"px";b.style.left=(g>0?g:0)+"px"}function f(b){if(b===window)return a.winSize();var c,d,e=b.style;if(e.display==="none"){e.visibility="hidden";e.display="";c=b.offsetWidth;d=b.offsetHeight;e.display="none";e.visibility="visible"}else{c=b.offsetWidth;d=b.offsetHeight}return{width:c,height:d}}function e(b,c){a.foreach(c,function(c,d){a.setStyle(b,d,c)})}var b=a.tween,c=a.lib.photoview.source,d=c.eventemiter;return function(c){function y(){if(!!q){w();f.destroy();z.removeEvents();a.removeNode(i);q=!1;i=null;k=null}}function x(){h||g(i,k)}function w(){z.un("load");if(!s&&!h){a.removeEvent(document,"click",n);s=!0;b(i,{duration:300,animationType:"easeoutcubic",end:function(){h=!0;u();i.style.visibility="hidden";a.removeNode(i)}}).play({opacity:0}).destroy()}}function p(b,c){var d=function(b){o=!1;a.lib.dialog.ioError(b.code,b)};o=!0;a.conf.trans.photoview.request("poprecomalbum",{onComplete:a.funcEmpty,onSuccess:function(a){o=!1;var b=a.data;b&&c(b)},onFail:d,onError:d},b)}function n(b){b=a.fixEvent(b);var c=k,d=b.target;c!==d&&!a.contains(c,d)&&a.contains(document.body,d)&&w()}function m(b){f=b||a.delegatedEvent(i);f.add("close","click",function(b){w();a.stopEvent(b.evt);return!1});f.add("refresh","click",function(b){w();z.fire("refresh",b);a.stopEvent(b.evt);return!1});return f}function l(b){var c='<div class="layer_album_end"><table><tbody><tr><td>'+b+"</td></tr></tbody></table>"+"</div>",d=a.insertHTML(j,c);i=d;m();return d}var f=null,h=!0,i=null,j=c,k=c,o=!1,q=!1,r=!1,s=!1,t={},u=function(){s=!1},v=function(c){if(!(s||!h||o||r)){var d=function(){h=!1;i.parentNode!==k&&k.appendChild(i);x();e(i,{visibility:"visible",opacity:0});a.addEvent(document,"click",n);s=!0;b(i,{duration:300,animationType:"easeoutcubic",end:u}).play({opacity:1}).destroy()};if(!q){z.once("load",d);p(c,function(a){var b=a.html;if(b){q=!0;i=l(b);e(i,{display:"block",visibility:"hidden"});r=!0;setTimeout(function(){r=!1;z.fire("load")},300)}})}else d()}},z=d.extend({show:v,hide:w,resize:x,destroy:y});return z}});
STK.register("lib.photoview.index",function(a){function H(a,b){return j(a,{size:b||"mw1024"})}function G(a,b){return(a=String(a))?a.replace(F,function(a){var c=a.length,d=a.substring(1,c-1),e=b[d];return e===undefined?a:e}):a}function E(a,b){"use strict";if(a.map)return a.map(b);if(typeof b!="function")throw TypeError("map need a function");var c=a,d=c.length>>>0,e=Array(d);for(var f=0;f<d;f++)f in c&&(e[f]=b.call(null,c[f],f,c));return e}function D(a,b){return c(a,b||1)}var b=a.lib.feed.imageLikeWhiteList(),c=window.setTimeout,d=a.lib.photoview.source,e=d.channel,f=a.conf.trans.photoview,g=a.conf.channel.video,h=d.util,i=a.ui.alert,j=a.lib.kit.extra.imageURL,k=a.lib.kit.extra.supportVideo,l=a.preventDefault,m=a.funcEmpty,n=a.tween,o=a.setStyle,p=a.addClassName,q=a.lib.kit.extra.language,r,s,t=a.conf.trans.feed.feed,u=h.throttle,v=h.debounce,w=h.mix,x=Math.max,y=Math.min,z=function(a,b){var c=a.length;while(c--)if(b(a[c]))return c;return-1},A=function(a,b){var c=0;for(var d=0;a[d];d++)if(a[d]==b){c=d;break}return c},B=function(b,c){var d=0;switch(c){case"height":d=b.offsetHeight;break;case"width":d=b.offsetWidth}d||(d=parseInt(a.getStyle(b,c),10));return isNaN(d)?0:d},C=function(a){},F=/\{\w[\w.]*?\}/g,I='<#et temp data><div class="W_layer layer_multipic_preview" node-type="outer"><div node-type="box" class="multipic_preview"><a role="button" action-type="close" href="#" class="close" title="#L{关闭}">&times;</a><div node-type="scroller" class="scroller"><div node-type="inner" class="inner clearfix"><div node-type="userinfo" class="info_box W_fr S_bg2"></div><div node-type="desktop" class="pic_box"><div node-type="display" class="pic_show_box"><div node-type="loader" class="pic"><div node-type="img_box"></div><div node-type="gif_box"></div></div><div node-type="wrapIcon" class="pos_icon">'+(b?'<div class="pos_margin" node-type="likeBtn" style="display:none;" action-type="image_like" action-data="mid=${data.mid}&photo_id=${data.pid}&is_liked=${data.is_liked}&count=${data.count}&object_id=${data.object_id}&ref=${data.ref}"><#if (data.is_liked)><a href="javascript:" class="W_btn_alpha" title="#L{取消赞}"><i class="icon_praised"></i><span node-type="count">(${data.count})</span></a><#else><a href="javascript:" class="W_btn_alpha" title="#L{赞}"><i class="icon_praise"></i><span node-type="count">(${data.count})</span></a></#if></div>':"")+'<a suda-data="key=big_pic_cover&value=magnify_pic" node-type="togglesize" action-type="togglesize" style="display:none;" href="javascript:" class="W_btn_alpha"><i class="icon_narrow"></i><span>#L{适应页面}</span></a>'+'<a suda-data="key=big_pic_cover&value=check_pic" node-type="maximum" action-type="maximum" style="display:none;" href="javascript:" class="W_btn_alpha" title="#L{查看原图}" suda-uatrack="key=tblog_newimage_feed&value=view_original"><i class="icon_maximum"></i><span>#L{查看原图}</span></a>'+'<a node-type="gifLoad" style="display:none;" href="javascript:" class="W_btn_alpha" title="#L{保存}"><i class="icon_maximum"></i><span>#L{保存}</span></a>'+"</div>"+"</div>"+'<div node-type="carousel" class="pic_choose_box">'+'<div node-type="prev" class="arrow_boxL"><a href="javascript:;" class="arrow_left_small" title="#L{上一页}"><em class="ico_pic_prev">&lt;</em></em></a></div>'+'<div node-type="clip" class="stage_box"><ul node-type="list" class="choose_box clearfix"></ul></div>'+'<div node-type="next" class="arrow_boxR"><a href="javascript:;" class="arrow_right_small" title="#L{下一页}"><em class="ico_pic_next">&gt;</em></em></a></div>'+"</div>"+"</div>"+"</div>"+"</div>"+"</div>"+"</div>"+"</#et>",J='<#et list data><span class="WB_pic_vip" node-type="pic_vip"><em class="W_f16">开通Ta的专属会员即可浏览图片和Ta的全部付费内容</em><a node-type="fl_vPay_f" action-type="fl_vPay_f" action-data="mid=${data.mid}&&isPrivate=${data.isPrivate}&uid=${data.uid}" href="javascript:;" class="W_btn_a btn_34px">立即开通</a></span></#et>',K=!1,L=!1,M,N,O,P,Q=null,R,S,T,U,V,W,X,Y,Z,$=!1,_,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk=function(b){var e,f=u(function(a){!$&&R[a]&&l(a)&&bw(R[a],m,a)},300),g=function(){e&&clearTimeout(e);e=D(function(){f(p())},1e3)},h=function(b){var d=N.getOuter(),e=a.sizzle("[node-type='pic_vip']",d);if(b.isPrivate==1&&b.relation!=1){if(e[0])return;var f=a.core.util.easyTemplate(J,b).toString(),g=a.builder(f).list.pic_vip[0];c(function(){d.appendChild(g)},200)}else e[0]&&a.removeNode(e[0])},i=function(){var a=2,b=3,c=0,d=[],e={};M.on("hide",function(){M.removeAttr("memberbtnclick");e={};d=[]});var f=function(a){var b=new Image;c++;e[a]=1;b.onload=b.onerror=function(){b=b.onload=b.onerror=null;c--;g()};b.src=a},g=function(){var b;while(c<a&&d.length){b=d.pop();e[b]||f(b)}},h=function(){c=0;g()},i=function(a){return decodeURIComponent(a.data.clear_picSrc||H(a.data.pid))};return function(){var a=y.get("numItems"),c=y.get("selectedItem"),e=b,f=0,g=0;c===-1&&(c=0);f=c-e;f=f>0?f:0;g=c+e+1;g=g>a?a:g;d=E(y.slice(f,g),i);h()}}(),j=function(){if(be){_?be.innerHTML=+(ba||0)!=0?q('<a href="javascript:" class="W_btn_alpha" title="#L{取消赞}"><i class="icon_praised"></i><span>('+(ba||0)+")</span></a>"):q('<a href="javascript:" class="W_btn_alpha" title="#L{取消赞}"><i class="icon_praised"></i></a>'):be.innerHTML=+(ba||0)!=0?q('<a href="javascript:" class="W_btn_alpha" title="#L{赞}"><i class="icon_praise"></i><span>('+(ba||0)+")</span></a>"):q('<a href="javascript:" class="W_btn_alpha" title="#L{赞}"><i class="icon_praise"></i><span>#L{赞}</span></a>');be.setAttribute("action-data","ref="+r+"&mid="+bc+"&photo_id="+bd+"&is_liked="+_+"&count="+(ba||0)+"&object_id="+bb)}},l=function(a){var b=y.get("firstVisible"),c=y.get("scrollIncrement");if(a==="next"){var d=y.get("numItems"),e=y.get("numVisible"),f=b+e;f=f>d-1?d-1:f;return f+c>=d}return b-c<=0},p=function(){var a=y.get("firstVisible"),b=y.get("selectedItem"),c=y.get("numItems"),d=a+y.get("numVisible");d=d>c-1?c-1:d;return d-b<b-a?"next":"prev"},s=function(){return!R.next},v=function(){return!!R.prev||!y.isBOF()},w=function(){return!!R.next||!y.isEOF()},x=function(){i();j()},y=d.carousel(b,{itemSize:60,itemMargin:5,numVisible:20,scrollIncrement:10,itemTemplateVpay:'<a href="javascript:;" suda-uatrack="key=tblog_newimage_feed&value=left_right_nextpage"><img src="about:blank"><i class="W_icon icon_vplus_s"></i></a>',itemTemplate:'<a href="javascript:;" suda-uatrack="key=tblog_newimage_feed&value=left_right_nextpage"><img src="about:blank"></a>',CLASSES:{SELECTED_ITEM:"current",PREV_DISABLED:"btn_pic_prevdis",NEXT_DISABLED:"btn_pic_nextdis"}}).on("itemLoad",function(b,c){var d=c.data,e=c.prev,f=c.next,g=d.data,h=g.pid,i=g.clear_picSrc||"",j=g.isPrivate,k=d.el,l=g.thumb||H(h,"square"),m=new Image;m.onload=m.onerror=function(){var b=a.sizzle("img",k)[0];m=m.onload=m.onerror=null;b.src=l;b=null};m.src=l}).on("itemSelected",function(a,b){var c=N.get("memberbtnclick"),d=function(a){var b=a.data,c=b.mid,d=b.pid,e,f=b.clear_picSrc||H(d);_=+b.is_liked,ba=b.likecount,bb=b.object_id,bi=b.isPrivate||0,bj=b.relation||0;bc=c,bd=d,gifUrl=b.gif_url;N.set("isPrivate",bi);N.set("relation",bj);N.load(f,x,gifUrl,b);bz(b);h(b)};c&&b.data.isPrivate==1&&b.data.relation!=1?t.request("checkVmember",{onSuccess:function(a){if(a.code=="100000"){var c=b.data.pid;b.data.relation=1;b.data.clear_picSrc=a.data[c].picUrl;d(b)}},onFail:function(a){d(b)},onError:function(a){d(b)}},{mid:b.data.mid,pid:b.data.pid,pictype:"mw1024"}):k.video(!0)&&b.data.pid.charAt(21)=="g"?t.request("gifUrl",{onComplete:function(a){if(a.code=="100000"){var c=a.data;b.data.gif_url=c.gif_url;b.data.gif_width=c.gif_width;b.data.gif_height=c.gif_height;b.data.gif_duration=c.gif_duration;d(b)}else d(b)},onFail:function(a){d(b)}},{object_id:b.data.gif_oid}):d(b)}).on("afterScroll",function(a,b){var c=b.dir==="forward"?"next":"prev";f(c)}).on("itemsRemoved",function(){var a="next",b=R[a];if(!b){a="prev";b=R[a];b||(a="")}!$&&a&&l(a)&&bw(b,function(){y.flush()},a)});y.set("prevStateFn",v);y.set("nextStateFn",w);y.set("prevClick",function(a){f("prev")});y.set("nextClick",function(a){f("next")});var z=!1,A=!1,C={duration:300,animationType:"easeoutcubic",end:function(){A=!1}},F=u(function(a){if(!A&&!!z){var b=a.get("element"),c=B(b,"height");z=!1;A=!0;var d=function(){o(b,"bottom",0-c+"px");n(b,C).play({bottom:0,opacity:1}).destroy()};a.isAnimating()?a.once("afterScroll",d):d()}},400),G=u(function(a,b){if(!A&&!z){var c=a.get("element"),d=B(c,"height");z=!0;if(!b){A=!0;var e=function(){o(c,"bottom",0);n(c,C).play({bottom:0-d,opacity:0}).destroy()};a.isAnimating()?a.once("afterScroll",e):e()}else o(c,"bottom",0-d+"px")}},400);y.toggle=function(a,b){a?F(y):G(y,b)};y.isEnd=function(){if(s()){var a=y.get("numItems"),b=y.get("selectedItem");return a&&y.isEOF()&&b===a-1}return!1};y.preload=function(){g()};return y},bl=function(b,c){var f=!0,g=null,h=!1,i=M.getDom("maximum"),j=M.getDom("gifLoad"),k=M.getDom("togglesize"),l=M.getDom("wrapIcon"),m=M.getDom("loader");be=M.getDom("likeBtn");var n=function(a){h=a;var b=a?"":"none";o(l,"display",b)},p=function(a){g=a;var b=N.get("isPrivate"),c=N.get("relation");b&&(i.style.display=b==1?"none":"");if(a.gif){j.style.display="";j.setAttribute("href",a.src);j.setAttribute("download",a.src)}else{j.style.display="none";j.setAttribute("href","javascript:void(0)")}},r=function(b){g=b;var c=N.get("isPrivate"),d=N.get("relation"),e=b.width+bn,h=b.height;if(f){var i=M.get("limits"),j=M.get("screen"),l=M.get("size"),m=a.winSize(),n=e,o=h,p=i.minWidth,r=m.width-M.getOffset("x");e=x(y(e,i.maxWidth),p);e=x(e,l[0]);e>=p&&e>r&&(e=r);if(e<n){var s=(n-290)/o;h=(e-290)/s}h=x(h,j[1]);M.setSize(e,h);k.style.display=c==1&&d==0?"none":""}else{var j=M.get("screen"),e=j[0]-bn,t=e/b.width*b.height;t=Math.min(t,b.height);t<=j[1]?k.style.display="none":k.style.display=c==1&&d==0?"none":"";M.resize()}k.title=q(f?"#L{适应页面}":"#L{放大图片}");a.sizzle("i",k)[0].className=f?"icon_narrow":"icon_enlarge";a.sizzle("span",k)[0].innerHTML=q(f?"#L{适应页面}":"#L{放大图片}")},t=function(b){var c=b.relatedTarget,d=b.fromElement;if(!c||d&&d===b.target){c=b.toElement||d;b.relatedTarget=c}return c==null?!0:c?c!==this&&c.prefix!=="xul"&&this!==document&&!a.contains(this,c):!1},z=function(a,b){t.call(a.currentTarget||this,a)&&bp[b?"stop":"start"]()},A=function(a){z.apply(this,[a,!1])},C=function(a){z.apply(this,[a,!0])},D=d.imagedisplay(b,c).on("show",function(){var b=O&&O.get("element"),c=this.getOuter();if(b){a.addEvent(b,"mouseout",A);a.addEvent(b,"mouseover",C);D.once("hide",function(){a.removeEvent(b,"mouseout",A);a.removeEvent(b,"mouseover",C)})}}).on("navigate",function(a,b){var c=b.dir,d=-1;d=O.get("selectedItem")+(c==="left"?-1:1);if(c!=="left"&&!bq()&&O.isEnd()){br();O.once("itemSelected",bs)}d>-1&&O.setSelectedItem(d);bm("left_right_nextpage")}).on("load",function(a,b){b.height/b.width>2?f=!0:f=!1;r(b);p(b)}).on("hide",function(b){try{var c=N.getOuter(),d=a.sizzle("[node-type='pic_vip']",c);d[0]&&a.removeNode(d[0])}catch(b){}f=!0}).on("mousemove",u(function(a,c){var d=95,e=B(b,"height"),f=c.y>e-d?1:0;bp[f?"show":"start"]();h||n(1)},50)).on("mouseout",function(b,c){n(0);var d=c.relatedTarget,e=O.get("element");e&&(d===e||a.contains(e,d))&&bp.stop()}).on("mouseover",v(function(a,b){n(1)},90)),E=M.getDelegate();E.add("maximum","click",function(a){var b=w({},Z),c=b.short_url||G("http://photo.weibo.com/{uid}/wbphotos/large/mid/{mid}/pid/{pid}",b);window.open(c);return!1});var F=function(a){var b=a.data.uid,c=a.data.mid,d=location.protocol+"//vipclub.weibo.com/vmember/opendetail?vuid="+b+"&F=pic_"+c;N.set("memberbtnclick","1");window.open(d,"_blank")};E.add("fl_vPay_f","click",F);var H=function(b){if(g){f=!f;r(g);s&&s.destroy();var c=a.sizzle("img",M.getDom("loader"))[0];s=a.lib.image.multiimage.showtag({img:c,postdata:{mid:bc,pid:bd},fromLayer:!0})}};E.add("togglesize","click",function(){H()});var I=function(b){var c=b.el,d=b.data,f=+d.is_liked?!0:!1,g=d.count;f?g--:g++;var h=g>0?g:0,i;f?i=h!=0?q('<a class="W_btn_alpha" title="#L{赞}" href="javascript:"><span><i class="W_ficon ficon_praised">ñ</i><em>'+h+"</em></span></a>"):q('<a class="W_btn_alpha" title="#L{赞}" href="javascript:"><span><i class="W_ficon ficon_praised">ñ</i></span></a>'):i=h!=0?q('<a class="W_btn_alpha" title="#L{取消赞}" href="javascript:"><span class="W_praised"><i class="W_ficon ficon_praised">ñ</i><em>'+h+"</em></span></a>"):q('<a class="W_btn_alpha" title="#L{取消赞}" href="javascript:"><span class="W_praised"><i class="W_ficon ficon_praised">ñ</i></span></a>');c.innerHTML=i;var j=a.lib.kit.extra.actionData(c);j.set("count",h);j.set("is_liked",f?0:1);e.fire("likeChangedFromLayer",{isDel:f,num:h});O.rewriteItem({is_liked:f?"0":"1",count:h})};E.add("image_like","click",I);var J=function(b){var c=b.isDel,d=b.count,e=be,f=d>0?d:0,g;c?g=f!=0?q('<a class="W_btn_alpha" title="#L{赞}" href="javascript:"><span><i class="W_ficon ficon_praised">ñ</i><em>'+f+"</em></span></a>"):q('<a class="W_btn_alpha" title="#L{赞}" href="javascript:"><span><i class="W_ficon ficon_praised">ñ</i></span></a>'):g=f!=0?q('<a class="W_btn_alpha" title="#L{取消赞}" href="javascript:"><span class="W_praised"><i class="W_ficon ficon_praised">ñ</i><em>'+f+"</em></span></a>"):q('<a class="W_btn_alpha" title="#L{取消赞}" href="javascript:"><span class="W_praised"><i class="W_ficon ficon_praised">ñ</i></span></a>');e.innerHTML=g;var h=a.lib.kit.extra.actionData(e);h.set("count",d);h.set("is_liked",c?0:1);O.rewriteItem({is_liked:c?"0":"1",count:d})};e.register("updateLayerLikeBtn",J);return D},bm=function(a,b){if(!b){b=a;a="tblog_newimage_feed"}var c=window.SUDA;c&&c.uaTrack&&c.uaTrack(a,b)},bn=290,bo=function(b,c){K=!0;r=c.pic_like_src||"layer";bg=c.curclear_picSrc||"";bf=c.clear_picSrc&&c.clear_picSrc.split(",")||"";bh=c.pids&&c.pids.split(",")||[];bi=c.isPrivate;bj=c.relation;M=d.overlayer(I,{limits:{maxWidth:1314,maxHeight:710,minWidth:740,minHeight:400},offset:[30,80],pid:c.pid,mid:c.mid,ref:r,pic_objects:c.pic_objects,isPrivate:c.isPrivate,relation:c.relation,curclear_picSrc:bg,clear_picSrc:bf});var e=M.getOuter(),f=M.getDom("count");f&&f.innerHTML=="(0)"&&a.removeNode(f);var h=0;M.on("resize",function(a,b){var c=b.width-bn,d=b.height,e=M.getDom("desktop");o(e,"width",c+"px");o(e,"height",d+"px");var f=M.getOuter();f.scrollTop=0;if(h!==c){h=c;O.resize()}N.resize(c,d);P.resize(b);Q&&Q.resize()});M.on("hide",function(){M.get("gifKey")&&g.fire("hidePicLayer",M.get("gifKey"));bA();N.hide();M.remove("memberbtnclick");be&&(be.style.display="none");s&&s.destroy();O.toggle(0,!0);O.clear();bs()});N=bl(M.getDom("display"),e);N.on("navigate",function(){s&&s.destroy()});O=bk(M.getDom("carousel"));P=d.userinfo(M.getDom("userinfo"),{shouldPicSrc:c.picSrc=="photo"?!0:!1});a.custEvent.add(P,"uplikestatus",function(b,c){_=c.is_liked;ba=c.like_counts;if(be){var d=c.like_counts||0;c.is_liked?be.innerHTML=d!=0?q('<a class="W_btn_alpha" title="#L{取消赞}" href="javascript:"><span class="W_praised"><i class="W_ficon ficon_praised">ñ</i><em>'+d+"</em></span></a>"):q('<a class="W_btn_alpha" title="#L{取消赞}" href="javascript:"><span class="W_praised"><i class="W_ficon ficon_praised">ñ</i></span></a>'):be.innerHTML=d!=0?q('<a class="W_btn_alpha" title="#L{赞}" href="javascript:"><span><i class="W_ficon ficon_praised">ñ</i><em>'+d+"</em></span></a>"):q('<a class="W_btn_alpha" title="#L{赞}" href="javascript:"><span><i class="W_ficon ficon_praised">ñ</i></span></a>');be.setAttribute("action-data","ref="+r+"&mid="+bc+"&photo_id="+bd+"&is_liked="+c.is_liked+"&count="+(c.like_counts||0)+"&object_id="+bb);be.style.display=""}s&&s.destroy();var e=a.sizzle("img",M.getDom("loader"))[0];s=a.lib.image.multiimage.showtag({img:e,postdata:{mid:bc,pid:bd},fromLayer:!0})});M.once("destroy",function(){M.hide();O.destroy();N.destroy();P.destroy();M=null;O=null;P=null;N=null})},bp=function(){function f(){b||(b=c(function(){O.toggle(0);b=null},3e3))}function e(){if(L){d();O.toggle(1);!a.lib.kit.touch.cantouch&&f()}}function d(){if(b){clearTimeout(b);b=null}}var b=null,g=function(){e()};w(g,{show:e,start:f,stop:d});return g}(),bq=function(){return!!Z.multiuser},br=function(){if(!Q){Q=d.recommonedlayer(M.getDom("desktop"));Q.on("refresh",function(){O.setSelectedItem(0)})}Q.show({uid:Z.uid})},bs=function(){Q&&Q.hide()},bt=function(a){var b=Z.pid,c=Z.mid,d=z(a,function(a){return a.pid===b&&a.mid===c});d===-1&&(d=0);O.set("selectedItem",d);O.flush()},bu=function(a,b){K||bo(document.body,a);bA(a);M.show();a.uniqueKey&&M.set("gifKey",a.uniqueKey);a=w({mid:"",pid:"",type:0,uid:$CONFIG.uid,page_id:$CONFIG.page_id,pic_like_src:null,short_url:undefined},a);Z=a;Z.short_url&&(Z.short_url=decodeURIComponent(Z.short_url));var c=decodeURIComponent(a.curclear_picSrc&&a.curclear_picSrc.replace("mw690","mw1024")||H(a.pid)),d=a.gif_url&&decodeURIComponent(a.gif_url);N.load(c,null,d,a);L=!1;O.render();O.toggle(!1,!0);P.setLoading(1);P.setCurTabIndex(a.tab);bw(a,function(a){if(a){bt(a.pic_list);L=!0;bp()}})},bv=function(){if(K){K=!1;M.destroy();M=null}},bw=function(a,b,d){if(!$){var e=function(){c(function(){$=!1},500)},g=function(a){e();C(a)};a.uid=Z.uid;var h=!1;$=!0;(function i(a,b){f.request("list",{onError:g,onFail:g,onComplete:m,onSuccess:function(a){if(!(a=a.data)){if(!h){R={prev:0,next:0};h=!0;var c={type:0,mid:X,pid:Y,uid:Z.uid};i(c,function(a){if(a){bt(a.pic_list);b&&b(a)}});return}}else{bx({prev:a.pic_prev,next:a.pic_next,direction:d});(h||!d)&&O.clear();O.addItems(a.pic_list,d==="prev");b&&b(a)}e()}},a)})(a,b)}},bx=function(a){var b=a.direction,c=a.prev,d=a.next,e=-1;b==="next"&&(c=e);b==="prev"&&(d=e);if(c!==e){R.prev=c;R.prevPicUrl=c.clear_picSrc||"";R.prevRelation=c.relation||"";R.prevIsPrivate=c.isPrivate||""}if(d!==e){R.next=d;R.nextPicUrl=d.clear_picSrc||"";R.nextRelation=d.relation||"";R.nextIsPrivate=d.isPrivate||""}},by=function(a){X=a.mid;Y=a.pid},bz=function(a){if(!!a.mid){w(Z,a);D(function(){bE(a)})}},bA=function(a){a&&(r=a.pic_like_src||"layer");W="";X="";Y="";R={prev:0,next:0};S={};T={};U={};V={};$=!1;if(a){var b=decodeURIComponent(a.pic_objects);b=b.split(",");var c=[],d=[],e=[],f=[];for(var g=0,h=b.length;g<h;g++){var i=b[g];i=i.split("|");c.push(i[0]);d.push(i[1]);e.push(i[2]);f.push(i[3])}var j=0;for(var k=0,l=c.length;k<l;k++)if(c[k]==a.pid){j=k;break}}},bB=function(a){w(S,a.mblog_list);w(T,a.comment_list);w(U,a.mblog_like_list);w(V,a.repost_list)},bC=function(a){return S[a]?{mid:a,mblog:S[a],like_list:U[a],comment_list:T[a],repost_list:V[a]}:null},bD=function(a,b,c){f.request("bloginfo",{onComplete:m,onError:c,onFail:c,onTimeout:c,onSuccess:b},{mids:a})},bE=function(a){var b=a.mid,c=a.pid,d=a.object_id,e=function(a,b){try{P.setLoading(0);P.update(a,b)}catch(c){}};if(W===b)e({mid:b,object_id:d,ref:r},bC(b));else{W=b;var f=function(a,b){e(a,null);O.removeItems(O.filter(function(b){return b.data.mid===a}))},g=!1,h=bC(b);if(h&&g)e({mid:b,object_id:d,ref:r},h);else{P.setLoading(1);bD(b,function(a){var g=a.data,h=g.mblog_list,i=h&&h.hasOwnProperty(b);i&&bB(g);D(function(){if(b===W)if(i){by({mid:b,pid:c});e({mid:b,object_id:d,ref:r},bC(b))}else f(b,g)})})}}},bF=!1;return{show:function(b,c){if(bF)return!1;if(b.isPrivate==1&&b.relation!=1)return!1;var d=b.mid;bD(d,function(a){bF=!1;var e=a.data,f=e.mblog_list,g=f&&f.hasOwnProperty(d);g?bu(b,c):i(q("#L{抱歉，此微博已被删除}。"))},function(b){bF=!1;a.lib.dialog.ioError(b.code,b)})},hide:function(){M&&M.hide()},destroy:bv}});
STK.register("lib.feed.plugins.gif.init",function(a){var b=a.lib.photoview.index,c=a.conf.channel.video,d=a.conf.trans.feed.feed,e=a.lib.kit.extra.merge,f=a.lib.kit.extra.language,g=a.lib.kit.extra.imageURL,h=a.lib.kit.extra.HashTable,i=a.lib.kit.extra.getWantTime,j=a.lib.kit.extra.storageLog,k=a.lib.kit.extra.arrayRemove,l=a.lib.kit.extra.supportVideo,m=a.lib.feed.plugins.gif.gif,n=a.lib.feed.plugins.video.utils,o=a.lib.kit.dom.parseDOM,p=a.core.dom.getStyle,q={sensitiveHeight:200,getImgUrl:function(a,b){return g(a,{size:b||"mw1024"})},getGifBox:function(b,c){var d=c.utils.getFeedNode(b,c.getNode()),e=o(a.builder(d).list);if(p(e.feed_list_media_disp,"display")!="none"){var f=a.sizzle('[action-type="feed_list_media_bigimg"]',e.feed_list_media_disp)[0]||e.gifSpanBox;b=f?f:b}return b},getGifLoop:function(b,c){var d=c.utils.getFeedNode(b,c.getNode()),e=o(a.builder(d).list);return p(e.feed_list_media_disp,"display")!="none"}};n=e(n,q);var r={str:"Log_gifplay",transKey:"h5playlog"},s="gif_layer_store_key";return function(d,e){if(!d)a.log("media : need object of the baseFeedList Class");else{var f={},g,k,l,o,p,s,t,u,v,w="",x,y={},z,A,B,C;l={initMedia:function(b){if(!b||!b.media){var c,e=b.gif,f=b.gBox,g=b.vBox,h=b.logObj,j=b.actionData,k=j.gif_url&&decodeURIComponent(j.gif_url),l=j.pid&&n.getImgUrl(j.pid),o=function(a,b){if(!!h||!!c){b&&(h=A.setExtend(h,{sid:A.sid()}));h.play_time=i(0,"yyyy-MM-dd hh:mm:ss").Today.Format}},p=function(a){if(!(!c||!h||!j)){if(c.getValidTime()<=0)return;var b;h.playduration=Math.round(c.currentTime()*1e3);h.valid_play_duration=Math.round(c.getValidTime()*1e3);c.resetValidTime();h&&(b=n.formateJson(h));j.unLog!=1&&!c.unLog&&b?C.set(b):null}},r=function(d){if(!(!c||!g||!f)){a.setStyle(f,"visibility","visible");a.setStyle(g,"display","none");c.dispose&&c.dispose();b.media=c=null}},s=function(b){if(!!e){a.addClassName(e,"bigcursor");e.setAttribute("action-type","feed_list_media_img")}},t=function(b){if(!!e){a.removeClassName(e,"bigcursor");e.removeAttribute("action-type")}},u=function(d){if(!(!c||!g||!f)){a.setStyle(f,"visibility","visible");a.setStyle(g,"display","none");var e=a.C("img");e.src=l||"about:blank";c.el_&&c.el_.parentNode.appendChild(e);c.dispose&&c.dispose();b.media=c=null}},v=function(a,b){if(!!c&&!!j){var d=b&&encodeURIComponent(b);j.gif_url=d}},x=function(b){a.setStyle(g,"display","");a.setStyle(f,"visibility","hidden")},y=function(a){if(b.actionData.object_type=="story"&&!!c)if(b.dis){var d=c.muted(),e=c.paused();if(!d){if(e)return;if(!!w&&w!=b.key&&z.ObjArr[w]){if(!z.ObjArr[w].media)return;z.ObjArr[w].media.pause();z.ObjArr[w].media.trigger("updateMenu")}w=b.key}else w==b.key&&(w="")}else w==b.key&&(w="")},B=function(){c.preventDefaultMenu=j.object_type!="story";h=A.setExtend(h,{sid:A.sid()});h.play_time=i(0,"yyyy-MM-dd hh:mm:ss").Today.Format;h.playduration=0};c=m({sources:[{src:k||"",type:"video/mp4"}],src:l||"",loop:!0,autoplay:!0,gif_oid:j.gif_oid||"",oSrc:j.gif_ourl,type:j.object_type=="story"?"story":"gif",menu:j.object_type=="story"?!0:!1,box:q.getGifBox(g,d),cb:B});c.on("updateLog",o);c.on("sendLog",p);c.on("ended",r);c.on("fail",u);c.on("success",v);c.on("canplay",x);c.on("hideContextMenu",s);c.on("showContextMenu",t);c.on("volumechange",y);b.media=c}},initsMedia:function(b){if(!b||!b.media){var c,e=b.actionData,f=b.gif,g=b.gifObjs,h=g.length,j=b.logObj,k=b.sum,l,o,p,r,s,t,u,v,w,x;while(!(l=g&&g[b.num])){b.num++;b.num>=h&&(b.num=0);if(l)break}var y=function(a){if(!!a){o=a.li;p=a.gBox;r=a.vBox;s=a.liData;t=s.gif_url&&decodeURIComponent(s.gif_url);u=s.gif_oid||"";x=s.pic_id&&n.getImgUrl(s.pic_id)}},z=function(){v=parseFloat(s.gif_width);w=parseFloat(s.gif_height);var b,c,d,e;if(v>=w){c=110;b=Math.ceil(v/w*110);d="X";e=-(b-c)/2}else{b=110;c=Math.ceil(w/v*110);d="Y";e=-(c-b)/2}a.setStyle(o,"overflow","hidden");n.setStyles(r,{width:b+"px",height:c+"px",transform:"translate"+d+"("+e+"px)"});a.setStyle(r,"display","")},B=function(a,b){j=A.setExtend(j,{sid:A.sid()});j.play_time=i(0,"yyyy-MM-dd hh:mm:ss").Today.Format;j.playduration=0;j.duration=b&&b.duration||s&&s.duration;j.object_id=b&&b.oid||u},D=function(a,b){if(!!j){b&&(j=A.setExtend(j,{sid:A.sid()}));j.play_time=i(0,"yyyy-MM-dd hh:mm:ss").Today.Format}},E=function(a){if(!(!c||!j||!e)){if(c.getValidTime()<=0)return;var b;j.playduration=Math.round(c.currentTime()*1e3);j.valid_play_duration=Math.round(c.getValidTime()*1e3);c.resetValidTime();j&&(b=n.formateJson(j));e.unLog!=1&&!c.unLog&&b?C.set(b):null}},F=function(d){if(!(!c||!p||!r)){a.setStyle(p,"visibility","visible");a.setStyle(r,"display","none");var e=a.C("img");e.src=x||"about:blank";c.el_&&c.el_.parentNode.appendChild(e);c.dispose&&c.dispose();b.media=c=null}},G=function(a,b){if(!!c&&!!s){var d=b&&encodeURIComponent(b);s.gif_url=d}},H=function(d,e){if(!(!c||!p||!r)){a.setStyle(p,"visibility","visible");a.setStyle(r,"display","none");e?b.num=e.index:b.num++;if(b.num>=h){b.num=0;!e&&(c.unLog=!0)}while(!(l=g&&g[b.num])){b.num++;b.num>=h&&(b.num=0);if(l)break}if(b.num>=h||!l){c.dispose&&c.dispose();b.media=c=null;b.num=0;return}y(l);z();if(e&&e.index==b.num&&!e.dis){r&&r.appendChild(c.el_);c.play();c.unLog=!1;return}u&&t&&c.trigger("srcChange",{gif_oid:u,sources:[{src:t,type:"video/mp4"}]});e&&(c.unLog=c.gifPlayed=!1);r&&r.appendChild(c.el_);B()}},I=function(b){a.setStyle(p,"visibility","hidden")},J=function(b){if(!!o){a.addClassName(o,"bigcursor");o.setAttribute("action-type","fl_pics")}},K=function(b){if(!!o){a.removeClassName(o,"bigcursor");o.removeAttribute("action-type")}},L=function(){c.preventDefaultMenu=!0;z();B()};y(l);c=m({sources:[{src:t||"",type:"video/mp4"}],loop:q.getGifLoop(r,d)||(k==1?!0:!1),autoplay:!0,gif_oid:u||"",menu:e.object_type=="story"?!0:!1,box:q.getGifBox(r,d),cb:L});c.on("updateLog",D);c.on("sendLog",E);c.on("ended",H);c.on("fail",F);c.on("success",G);c.on("changeLog",B);b.media=c}},getLogData:function(b,c,d){if(!!a.isNode(b)){var e=b&&v.getFeedNode(b,g),f=e&&e.getAttribute("tbinfo")&&a.queryToJson(e.getAttribute("tbinfo")),h=e&&e.getAttribute("minfo")&&a.queryToJson(e.getAttribute("minfo")),j=e&&e.getAttribute("mid");d.uid=$CONFIG&&$CONFIG.uid||"";d.mid=j?j:"";d.mid_uid=f&&f.ouid?f.ouid:"";d.rootuid=h&&h.ru||f&&f.ouid;d.rootmid=h&&h.rm&&h.rm||j&&j;d.object_id=c&&c.gif_oid;d.duration=c&&c.gif_duration;d.encode_mode=c&&c.encode_mode;d.bitrate=c&&c.bitrate;d.play_time=i(0,"yyyy-MM-dd hh:mm:ss").Today.Format;d.isautoplay="1";return d}},getInitData:function(b){if(!!b&&!!a.isNode(b.gif)){var c,d;d=A.setExtend(a.jsonClone(B),{sid:A.sid(),doc:b.actionData.object_type=="story"?"story":"gif"});d=l.getLogData(b.gif,b.actionData,d);c={logObj:d};return c}},resetOne:function(a,b,c,d){var e=z.ObjArr[a].top,f=z.ObjArr[a].domH,g=z.ObjArr[a].domW;e!=b&&(z.ObjArr[a].top=y[a]=b);f!=c&&(z.ObjArr[a].domH=c);g!=d&&(z.ObjArr[a].domW=d)},initOne:function(b,c,d,e){var f,g,h,i,j,k;g=b&&n.getAttrData(b,"action-data");if(!g||!!g.gif_url){f=n.getUniqueKey();b.setAttribute("unique-gif",f);h=a.sizzle('[node-type="feed_gif_box"]',b)[0];i=a.sizzle('[node-type="feed_gif_video_box"]',b)[0];j=l.getInitData({gif:b,actionData:g,uniqueKey:f});k={type:"single",key:f,actionData:g,logObj:j.logObj,gBox:h,vBox:i,gif:b,top:c,domH:d,domW:e};!y.hasOwnProperty(f)&&(y[f]=c);!z.Contains(f)&&z.Add(f,k)}},initsOne:function(b,c,d,e){var f,g,h,i,j=[],k,m,o=0;g=b&&n.getAttrData(b,"action-data");if(!g||!!g.gif_oids){f=n.getUniqueKey();b.setAttribute("unique-gif",f);h=g.gif_oids.split(",");i=a.sizzle("li[action-type=fl_pics]",b);a.foreach(h,function(b,c){if(!b)j.push("");else{var d=i[c];if(!d)return;var e=n.getAttrData(d,"action-data"),f=a.sizzle('[node-type="feed_gif_box"]',d)[0],g=a.sizzle('[node-type="feed_gif_video_box"]',d)[0],h={num:c,li:d,gBox:f,vBox:g,liData:e};j.push(h);o++}});if(o<=0)return;k=l.getInitData({gif:b,actionData:g,uniqueKey:f});m={type:"multi",key:f,actionData:g,gifObjs:j,logObj:k.logObj,gif:b,top:c,domH:d,domW:e,num:0,sum:o};!y.hasOwnProperty(f)&&(y[f]=c);!z.Contains(f)&&z.Add(f,m)}},initGifs:function(){var b=a.sizzle("[node-type=feed_list_media_gif], [node-type=feed_list_media_story]",g),c=a.sizzle("[feed-gifs=true], [feed-storys=true]",g);b&&a.foreach(b,function(b){var c=a.position(b).t,d=a.core.dom.getSize(b),e=d.height,f=d.width,g=b.getAttribute("unique-gif");if(g){if(z.ObjArr[g].dis)return;l.resetOne(g,c,e,f)}else l.initOne(b,c,e,f)});c&&a.foreach(c,function(b){var c=a.position(b).t,d=a.core.dom.getSize(b),e=d.height,f=d.width,g=b.getAttribute("unique-gif");if(g){if(z.ObjArr[g].dis)return;l.resetOne(g,c,e,f)}else l.initsOne(b,c,e,f)})},mediaImg:function(a){var b=a.data,c=a.evt,d=a.el,f=d&&d.getAttribute("unique-gif");if(b.gif_url&&f){a.uniqueKey=f;e(a);return v.preventDefault(a.evt)}e(a)},outClient:function(b){if(!b||!!b.media){if(b.dis&&b.actionData&&b.actionData.object_type=="story"){b.media.pause();b.media.trigger("updateMenu");return}if(b.type=="single"){a.setStyle(b.vBox,"display","none");a.setStyle(b.gBox,"visibility","visible")}else{var c=b.num,d=b.gifObjs&&b.gifObjs[c];a.setStyle(d.vBox,"display","none");a.setStyle(d.gBox,"visibility","visible")}b.media.dispose&&b.media.dispose();b.media=null}},inClient:function(a){if(a&&a.media){if(!a.dis)return;if(a.actionData&&a.actionData.object_type=="story"&&!!w&&w!=a.key)return;a.media.play();a.actionData&&a.actionData.object_type=="story"&&a.media.trigger("volumechange")}else a.type=="single"?l.initMedia(a):l.initsMedia(a)},scrollChange:function(){scrollTop=a.scrollPos().top;var b=z&&z.ObjArr;y&&a.foreach(y,function(a,c){var d=b[c];!d||(n.isInAutoClinet(a,scrollTop,d.domH,x)?l.inClient(d):l.outClient(d))})},initPlugins:function(){o.resize();o.docChange()}};o={showPicLayer:function(a){if(!(!a||!z||!z.Count||!z.ObjArr||!z.ObjArr[a])){var b=z.ObjArr[a];if(!b.media)return;b.media.pause()}},hidePicLayer:function(a){if(!(!a||!z||!z.Count||!z.ObjArr||!z.ObjArr[a])){var b=z.ObjArr[a];if(!b.media)return;b.media.play()}},showPicDis:function(b){if(!(!b||!b.key||!z||!z.Count||!z.ObjArr||!z.ObjArr[b.key]||!b.box)){var c=z.ObjArr[b.key],d=c.media,e,f,g,h;c.dis=!0;if(c.type=="single"){if(!d){l.initMedia(c);d=c.media}}else{if(!d){c.num=b.index;l.initsMedia(c);d=c.media}if(!b.oid)d.pause();else{c.sum!=1&&c.num!=b.index&&d.trigger("ended",{index:b.index,dis:!0});d.loop(!0)}}b.box.appendChild(d.el_);c.type=="single"||c.sum==1||c.num==b.index?d.play():null;if(c.actionData&&c.actionData.object_type=="story"){d.muted(!1);d.trigger("updateMenu");d.preventDefaultMenu=!1;e=a.position(b.box).t;f=a.core.dom.getSize(b.box);g=f.height;h=f.width;l.resetOne(b.key,e,g,h)}d.unLog=d.gifPlayed=!1}},hidePicDis:function(b){if(!(!b||!b.key||!z||!z.Count||!z.ObjArr||!z.ObjArr[b.key])){var c=z.ObjArr[b.key],d=c.media,e,f,g,h;c.dis=!1;if(c.type=="single"){if(!d){l.initMedia(c);return}c.vBox.appendChild(d.el_);d.play()}else{c.num=b.index;if(!d){l.initsMedia(c);return}d.loop(c.sum==1?!0:!1);d.trigger("ended",{index:b.index,dis:!1})}if(c.actionData&&c.actionData.object_type=="story"){d.muted(!0);d.trigger("updateMenu");d.preventDefaultMenu=!0;e=a.position(c.gif).t;f=a.core.dom.getSize(c.gif);g=f.height;h=f.width;l.resetOne(b.key,e,g,h)}d.unLog=d.gifPlayed=!1}},resize:function(){x=a.winSize().height},docChange:function(){l.initGifs();l.scrollChange()},scroll:function(){l.scrollChange()}};p=function(){g=d.getNode();k=d.getDEvent();v=d.utils;z=z&&z.Clear()||h();A=a.lib.feed.plugins.video.log();B=A.Obj;C=j(r)};s=function(){l.initPlugins();k.add("feed_list_media_img","click",l.mediaImg);for(var a in o)c.register(a,o[a])};t=function(){p();s()};t();u=function(){z&&z.Clear();y=null;k.remove("feed_list_media_img","click",l.mediaImg);k&&k.destroy&&k.destroy();for(var a in o)c.remove(a,o[a]);C&&C.destroy&&C.destroy();b&&b.destroy&&b.destroy();f=null};f.destroy=u;return f}}});
STK.register("lib.feed.plugins.video.grayTest",function(a){var b=["1258030893","2687632893","1610526293","1841212313","1748870755","6516579468","2623536602","3699057005","1561984820","1647892991","3078691417","1848514750","1337040644","3665025404","1476938315","1302975672","5632991636","1074886493","1824131445","1683631694","1741467353","1846988384","3772729204","1905262027","1895486551","2284503164","1623780117","1763552305","2198304917","1781721243","1561984820","1758600355","1152759471","1514267615","2598574130","3493392854","1949830945","1667149907","2342802523","1587672612","2131195620","2281038582","2645294417","1762253415","1055376007","1643128167","2204832573","1671714344","2577960770","1824131445","1809500942","3210386741","1644446340","1786724722","1065131250","1937071537","1043848755","1516635112","1390415034","1418537172","1770710823","1478641362","1346563572","1509769134","5438592420","1509769134","5433246115","2909382061","2024722304","2821723515","1688756227","1068362945","1411421222","1871872227","1157840023","1668004737","1651401295","1238034470","1616240402","2089737981","5132310244","2982985805","1664267343","2921842827","3031889461","5834513139","2943840497","6306879671","1504989897","1246667095","5023423913","2334328627","5132646138","1905082415","2591912834","1639936150","1286353610","5527316346","2204131691","3788539372","2322108615","1655014772","1516635112","6400954687","2493413823","5957841087"],c=["0","1","2","3","4","5","6","7"];return function(){var d=window.$CONFIG&&$CONFIG.uid&&$CONFIG.uid.split("").reverse()[1];return a.inArray(window.$CONFIG&&$CONFIG.uid,b)?!0:a.inArray(d,c)?!0:!1}});
STK.register("lib.feed.plugins.media",function(a){var b,c=a.lib.feed.feedTemps,d=a.core.util.easyTemplate,e=a.lib.kit.extra.language,f=a.lib.kit.extra.sparkMD5,g=a.lib.kit.extra.supportVideo,h=a.lib.photoview.index,i=a.lib.feed.plugins.video.grayTest,j=a.conf.channel.video,k=e("#L{加载失败}!"),l=e("#L{很抱歉，该内容无法显示，请稍后再试。}"),m=e("#L{操作失败，请稍候重试。}"),n=a.core.util.browser.IE,o=60,p=a.conf.trans.feed.feed,q=450,r=!1,s={},t=500,u=280,v="yixiong&zhaolong5",w;g.video()&&(r=!0);var x='<#et list data><span class="WB_pic_vip" node-type="pic_vip"><em class="W_f16">开通Ta的专属会员即可浏览图片和Ta的全部付费内容</em><a node-type="fl_vPay" action-type="fl_vPay" action-data="mid=${data.mid}&isPrivate=${data.isPrivate}&uid=${data.uid}" href="javascript:;" class="W_btn_a btn_34px">立即开通</a></span></#et>',y=function(b,c){return{prev:a.sizzle("[node-type=feed_list_media_prev]",b)[0],disp:a.sizzle("[node-type=feed_list_media_disp]",b)[0]}},z=function(f,g,h,i){var k=f.el,l=f.data;l.isPrivate=l.isPrivate?l.isPrivate:0;l.relation=l.relation?l.relation:0;var m=decodeURIComponent(l.pic_objects||""),n="mw690",o=b.getFeedNode(k,g),p=a.core.dom.dir.parent(k,{expr:"ul"})[0],q,r,s=l.photo_filter_ids===undefined?undefined:l.photo_filter_ids.split(":")[1],v=m.split("|");if(!k.loading){k.tagName.toLowerCase()!=="img"&&(k=a.sizzle("img",k)[0]);k.loading=1;var w,z;if(l.pid){w=l.pid;z=a.lib.kit.extra.imageURL(w,{size:n})}else{w=/\/(thumbnail|wap180|thumb180)\/.+(?=\.\w+)/.exec(k.src);w&&(w=w[0].replace(/\/(thumbnail|wap180|thumb180)\//,""));z=k.src.replace(/\/(thumbnail|wap180|thumb180)\//,"/"+n+"/").split("?")[0]}if(l.isPrivate==1){q=a.lib.kit.extra.actionData(p).get("clear_picSrc");z=q&&decodeURIComponent(q)||z}var A="//photo.weibo.com/"+l.uid+"/wbphotos/large/photo_id/"+l.mid+"?refer=weibofeedv5",B=function(b){var c=b.pic_video;if(!c)return null;var d=[];a.foreach(c.split(","),function(a){a=a.split(":");d[a[0]]="//us.sinaimg.cn/"+a[1]+".mov"});return d}(l),C=o.getAttribute("isForward")?1:"",D=b.getMid(k,g),E={pid:l.pid?l.pid:w,clear_picSrc:l.clear_picSrc?l.clear_picSrc:q,mid:l.mid,uid:l.uid,pic_objects:l.pic_objects,isPrivate:l.isPrivate?l.isPrivate:"",relation:l.relation?l.relation:"",gif_width:l.gif_width,gif_height:l.gif_height,gif_url:l.gif_url,gif_oid:l.gif_oid,gif_duration:l.gif_duration,key:f.uniqueKey,type:l.object_type},F,G;if(!o){a.log("parents attribute mid node is undefined!");return}o.isForward=C;var H=y(o,C);if(!H||!H.prev||!H.disp){a.log('node-type="feed_list_media_prev" or node-type="feed_list_media_disp" in a feed\'s node is undefined!');return}if(h.voteObj[D]){h.voteObj[D].destroy();delete h.voteObj[D]}var I=function(){k.loading=0;if(F){k.bigImgWidth=F.width;k.bigImgHeight=F.height;F.onload=null}G&&(G.style.display="none");H.prev.style.display="none";H.disp.innerHTML="";H.disp.style.display="";r=a.builder(d(c.mediaIMGTEMPwithBtn,{uniqueKey:f.uniqueKey,notForward:!C,uniqueId:a.core.util.getUniqueKey(),acdata:E&&a.jsonToQuery(E),notShowLikeBtn:m!="",pid:l.pid?l.pid:w,mid:l.mid,is_liked:+v[1],count:v[2]||0,object_id:v[3],isPrivate:l.isPrivate,relation:l.relation,type:E.type,suda:{retract:"key=feed_image_click&value=image_zoomout",showBig:"key=tblog_newimage_feed&value=single_larger_image",left:"key=feed_image_click&value=image_turnlift",right:"key=feed_image_click&value=image_turnright",big:"key=feed_image_click&value=image_zoomout"}}).toString());H.disp.appendChild(r.box);var b=a.sizzle('[action-type="feed_list_media_bigimg"]',o)[0],g=a.sizzle("img",b)[0],h=b.parentNode.offsetWidth,i=function(){a.setStyle(b,"max-height","500px");a.setStyle(b,"max-width","282px");a.setStyle(b,"width",l.gif_width+"px");a.setStyle(b,"height",l.gif_height+"px");a.setStyle(b,"margin","0 auto")},n,p;if(l.isPrivate==1&&l.relation!=1){n=t+"px";p=u+"px"}else if(h>0&&k.bigImgWidth>h){n=h;p=h/k.bigImgWidth*k.bigImgHeight}n&&b.setAttribute("width",n);p&&b.setAttribute("height",p);if(f.uniqueKey&&l.gif_oid){i();j.fire("showPicDis",{key:f.uniqueKey,box:b,oid:l.gif_oid})}else g.src=z;var q=a.sizzle('[node-type="count"]',H.disp)[0];q&&q.innerHTML=="(0)"&&a.removeNode(q);var y=a.sizzle('[action-type="feed_list_image_like"]',o)[0];if(l.object_ids){var A=decodeURIComponent(l.object_ids);a.lib.feed.plugins.like.likestatus(A,A,function(a){var b=a.count;a.exits==!0?innerHTML=b!=0?e('<a class="W_btn_alpha" title="#L{取消赞}" href="javascript:"><span class="W_praised"><i class="W_ficon ficon_praised">ñ</i><em>'+b+"</em></span></a>"):e('<a class="W_btn_alpha" title="#L{取消赞}" href="javascript:"><span class="W_praised"><i class="W_ficon ficon_praised">ñ</i></span></a>'):innerHTML=b!=0?e('<a class="W_btn_alpha" title="#L{赞}" href="javascript:"><span><i class="W_ficon ficon_praised">ñ</i><em>'+b+"</em></span></a>"):e('<a class="W_btn_alpha" title="#L{赞}" href="javascript:"><span><i class="W_ficon ficon_praised">ñ</i></span></a>');y.innerHTML=innerHTML;y.setAttribute("action-data","object_id="+A+"&mid="+l.mid+"&photo_id="+(l.pid?l.pid:w)+"&count="+a.count);y.style.display=""})}else y.style.display="none";a.lib.image.multiimage.showtag({container:"",img:g,postdata:{mid:l.mid,pid:l.pid?l.pid:w}});if(!B||!B[0]||l.isPrivate==1&&(l.isPrivate!=1||l.relation!=1)){var I=a.sizzle("[action-type=feed_list_media_replay]",H.disp)[0],J=a.core.dom.dir.parent(I,{expr:"li"})[0];J.style.display="none"}else{var D=B[0];a.lib.image.livephoto(g,D,{canNotPlay:function(){var b=a.sizzle("[action-type=feed_list_media_replay]",H.disp)[0],c=a.core.dom.dir.parent(b,{expr:"li"})[0];c.style.display="none"},start:function(){a.foreach(a.sizzle("[action-type=feed_list_media_toLeft],[action-type=feed_list_media_toRight],[action-type=feed_list_media_replay]",H.disp),function(b){var c=a.core.dom.dir.parent(b,{expr:"li"})[0];c.style.display="none"})},end:function(){a.foreach(a.sizzle("[action-type=feed_list_media_toLeft],[action-type=feed_list_media_toRight],[action-type=feed_list_media_replay]",H.disp),function(b){var c=a.core.dom.dir.parent(b,{expr:"li"})[0];c.style.display=""});var b=a.sizzle("[action-type=feed_list_media_replay]",H.disp)[0];b.setAttribute("mp4",D)}})}if(l.isPrivate==1&&l.relation!=1){var K=a.core.util.easyTemplate(x,l).toString(),L=a.builder(K).list.pic_vip[0],M=a.sizzle('[node-type="artwork_box"]',H.disp);M[0]&&M[0].appendChild(L)}s&&window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_pc_image","stickers_image:"+s.replace("|",":"))};(G=a.core.dom.next(k)).style.display="";if(!l.relation&&k.bigImgWidth||f.uniqueKey)I();else{(F=new Image).onload=I;F.src=z}}},A=function(b){var c=a.sizzle("a.S_ficon_dis",b),d=a.sizzle("i.S_ficon_dis",b);for(var e in c){a.removeClassName(c[e],"S_ficon_dis");a.addClassName(c[e],"S_txt1")}for(var e in d){a.removeClassName(d[e],"S_ficon_dis");a.addClassName(d[e],"S_ficon")}},B=function(c,d,e){var f=c.el,g=c.data;if(!!e||!!/(img)|(canvas)|(video)/.test(c.evt.target.tagName.toLowerCase())){var h=b.getFeedNode(f,d);if(!h){a.log("parents attribute mid is undefined!");return}h.disp="";var i=y(h,h.isForward);if(!i||!i.prev||!i.disp){a.log('node-type="feed_list_media_prev" or node-type="feed_list_media_disp" in a feed\'s node is undefined!');return}a.position(i.disp).t<a.scrollPos().top&&h.scrollIntoView();g.key&&j.fire("hidePicDis",{key:g.key});i.prev.style.display="";i.disp.style.display="none";i.disp.innerHTML="";a.removeClassName(i.disp,"WB_expand_media_box_ani");a.removeClassName(i.disp,"WB_expand_media_box_trans")}},C=function(c,d,e){var f=c.el,g=b.getFeedNode(f,d);if(!f.parentNode.uid){var h=a.sizzle('[action-type="feed_list_media_bigimg"],canvas[id]',g)[0],i=a.sizzle("img",h)[0];f.parentNode.uid="rotate_img_"+a.core.dom.uniqueID(i.oImage||i);i.setAttribute("id",f.parentNode.uid)}a.lib.kit.dom.rotateImage.rotateRight(a.E(f.parentNode.uid),e,a.E(f.parentNode.uid).parentNode.offsetWidth)},D=function(c,d){var e=c.el,f=e.getAttribute("mp4"),g=b.getFeedNode(e,d),h=a.sizzle('img[action-type="feed_list_media_bigimg"],canvas[id]',g)[0];h.getAttribute("id")&&a.lib.kit.dom.rotateImage.rotateDefault(h);a.lib.image.livephoto(h,f,{canNotPlay:function(){var b=a.sizzle("[action-type=feed_list_media_replay]",g)[0],c=a.core.dom.dir.parent(b,{expr:"li"})[0];c.style.display="none"},start:function(){a.foreach(a.sizzle("[action-type=feed_list_media_toLeft],[action-type=feed_list_media_toRight],[action-type=feed_list_media_replay]",g),function(b){var c=a.core.dom.dir.parent(b,{expr:"li"})[0];c.style.display="none"})},end:function(){a.foreach(a.sizzle("[action-type=feed_list_media_toLeft],[action-type=feed_list_media_toRight],[action-type=feed_list_media_replay]",g),function(b){var c=a.core.dom.dir.parent(b,{expr:"li"})[0];c.style.display=""})}})},E=function(e,f,g,h){var i=e.el,j=e.data,l=b.getFeedNode(i,f),m=l.getAttribute("isForward")?"1":"",q=b.getMid(i,f),r=y(l,m);if(!r||!r.prev||!r.disp)a.log('node-type="feed_list_media_prev" or node-type="feed_list_media_disp" in a feed\'s node is undefined!');else{if(l.disp==j.short_url)return;if(h.voteObj[q]){h.voteObj[q].destroy();delete h.voteObj[q]}l.disp=j.short_url;l.isForward=m;r.prev.style.display="none";var s=decodeURIComponent(j.title),t=a.bLength(s)>71?a.leftB(s,70)+"...":s;s=a.bLength(s)>24?a.leftB(s,23)+"...":s;r.disp.innerHTML="";r.disp.appendChild(a.builder(d(c.mediaVideoMusicTEMP,{notForward:!m,short_url:decodeURIComponent(j.short_url),full_url:decodeURIComponent(j.full_url),title:s,fTitle:t,type:g}).toString()).box);r.disp.style.display="";var u=a.sizzle('div[node-type="feed_list_media_big'+g+'Div"]',r.disp)[0];if(!u){a.log('media: node-type="feed_list_media_big'+g+'Div" is not be found in feed_list_media_disp node!');return}h.dispContentNode[q]=u;var v="default";try{n?v="object":navigator.plugins["Shockwave Flash"]?v="embed":v="html5"}catch(w){}var x=function(){u.innerHTML=k},z=function(b){if(!b.result||b.error_code||b.error)x();else{var c=h.dispContentNode[q];c.mediaData=b.result;c.innerHTML="";c.appendChild(a.builder(c.mediaData).box);G&&G.setFixed(!0)}};p.request("mediaShow",{onComplete:z,onFail:x},{vers:3,lang:$CONFIG.lang,mid:q,short_url:j.short_url.replace(/http\:\/\/(t|sinaurl)\.cn\//,""),template_name:v,source:"351354573"});if(g==="video"){a.scrollTo(r.disp,{step:1,top:o});setTimeout(function(){($CONFIG.islogin=="2"||$CONFIG.islogin=="0")&&a.lib.dialog.loginLayer()},1e3)}}},F,G,H=function(e,f,g){F&&a.fireEvent(F,"click");var h=e.el,i=e.data.title,j=b.getMid(h,f),k=g.dispContentNode[j],l=k.mediaData,m=a.builder(d(c.mediaVideoMusicFloatTEMP,{title:a.encodeHTML(i)}).toString()),n=m.list.outer[0],o=m.list.mediaContent[0];F=m.list.close[0];document.body.appendChild(n);G=a.lib.kit.dom.fix(n,"rb");if(l){o.innerHTML="";o.appendChild(a.builder(l).box);G.setFixed(!0)}else g.dispContentNode[j]=o;a.addEvent(F,"click",function(){a.removeEvent(F,"click",arguments.callee);G&&G.destroy();if(a.IE){var b=a.sizzle("object",n);for(var c=0,d=b.length;c<d;c++){var e=b[c];e&&(e=e.parentNode)&&(e.innerHTML="")}}a.removeNode(n);G=m=n=F=null});B(e,f,!0)},I=function(){F&&a.fireEvent(F,"click")},J=function(e,f,g){var h=e.el,i=b.getMid(h,f),j=e.data,l=b.getFeedNode(h,f),m=l.getAttribute("isForward")?"1":"",n=y(l,m);if(l.disp!=j.short_url&&!!n.disp){n.disp.innerHTML="";a.lib.feed.widget.clear(i);n.disp.appendChild(a.builder(d(c.widgetTEMP,{notForward:!m,short_url:decodeURIComponent(j.short_url),full_url:decodeURIComponent(j.full_url),title:decodeURIComponent(j.title),suda:decodeURIComponent(j.suda||"")}).toString()).box);n.prev.style.display="none";n.disp.style.display="";var o=a.sizzle('div[node-type="feed_list_media_widgetDiv"]',n.disp)[0];p.request("widget",{onSuccess:function(b){b=b.data;if(!!b.html){o.innerHTML=b.html;a.lib.feed.widget.add(i,n.disp)}},onFail:function(a){o.innerHTML=a&&a.msg||k},onError:function(a){o.innerHTML=a&&a.msg||k}},{short_url:decodeURIComponent(j.short_url),isforward:m,mid:i});l.disp=j.short_url;l.isForward=m}},K=function(a){return a==document.body?!1:a.getAttribute("feedtype")=="ad"?a:arguments.callee(a.parentNode)},L=function(a,b,c,d){if(!!c){c=(c|0)+"px";b.removeAttribute("height");b.style.height!=c&&(b.style.height=c);d("callback")}},M=function(b,c,d,e){var f=a.lib.publisher.publisherDialog(d||{});a.custEvent.add(f,"publish",function(){e("callback")})},N=function(b){a.foreach(a.sizzle("iframe",b),function(a){try{if(a.connect){a.connect.destroy();a.connect=null;a.src="about:blank"}}catch(b){}})},O=function(c,d,e){var f=a.core.dom.dir.parent(c.el,{expr:"[action-type=feed_list_third_rend]"})[0],g=a.queryToJson(f.getAttribute("action-data")),h=g.objectid,i=c.el,j=b.getMid(i,d),k=b.getFeedNode(i,d),l,m,n,o=i.parentNode.getAttribute("mediasize");o&&(m=o.split(":"));var k=b.getFeedNode(i,d),p=k.getAttribute("isForward")?"1":"",q=y(k,p);if(g.video_src){l="video";n=decodeURIComponent(g.video_src)}else if(g.live_src){g.is_live==1?l="live_on":l="live_off";n=decodeURIComponent(g.live_src)}var r=a.sizzle('div[node-type="feed_list_media_widgetDiv"]',q.disp)[0];a.conf.channel.feed.fire("videolayer",{action:"showVideo",args:[l,n,h,j,0,0,m]})},P=function(f,g,h){function l(b,c,d,f,g,h){function m(c){c=c||window.event;!j(c,b)||a.addClassName(k,"W_btn_alpha_v2_b")}function l(c){c=c||window.event;!j(c,b)||a.removeClassName(k,"W_btn_alpha_v2_b")}if(!!a.lib.kit.extra.swfobject.getFlashPlayerVersion().major){var k=a.builder(e('<a href="javascript:void(0);" class="W_btn_alpha_v2">#L{小窗口}</a>')).box.firstChild;a.addEvent(k,"click",function(){var e=0,i={};if(c!="live_on")try{a.foreach(a.sizzle("embed,object",b),function(a){if(a.swfGetTimePlayed){var b=a.swfGetTimePlayed();e=b.data|0;b=a.swfGetSoundLevel();i=b.data}})}catch(j){}a.conf.channel.feed.fire("videolayer",{action:"showVideo",args:[c,d,f,g,e,i,h]});var k=a.core.dom.dir.parent(b,{expr:"[node-type=feed_list_media_disp]"})[0],l=a.sizzle("[action-type=feed_list_media_toSmall]",k)[0];a.fireEvent(l,"click");window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("weibo_video_minwindow","button_click")});b.appendChild(k);window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("weibo_video_minwindow","button_exposure");setTimeout(function(){if(b){a.addClassName(k,"W_btn_alpha_v2_b");a.addEvent(b,"mouseover",l);a.addEvent(b,"mouseout",m)}},3e3);var n=function(){var c=a.core.dom.dir.parent(b,{expr:'[action-type="feed_list_item"]'})[0];return c.getAttribute("feedtype")=="ad"||c.getAttribute("data-mark")?!0:!1};n()||c=="video"&&i(b)}}function j(a,b){if(a&&a.type!="mouseout"&&a.type!="mouseover")return!1;var c=a.relatedTarget?a.relatedTarget:a.type=="mouseout"?a.toElement:a.fromElement;while(c&&c!=b)c=c.parentNode;return c!=b}function i(b){var c=navigator.userAgent.toLowerCase(),d=function(){return c.indexOf("bidubrowser")>-1?!0:!1}(),f=function(){return c.indexOf("firefox")>-1?!0:!1}(),g=f||d?"此浏览器不支持HTML5视频播放器，可更换其他浏览器访问微博观看视频":"升级浏览器可使用最新版视频播放器，更快更轻体验更佳",h='<div class="W_layer_tips" style="position:absolute;"><div class="W_layer_close"><a href="javascript:void(0);" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div><div class="content"><div class="txt"><p>'+e("#L{"+g+"}")+"</p></div>"+"</div>"+'<div class="W_layer_arrow"><span node-type="arrow" class="W_arrow_bor W_arrow_bor_t"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div>'+"</div>",i=a.lib.kit.extra.getWantTime(1),j="wb_h5video_"+$CONFIG.uid,k,l=720,m=!1;if(!!b&&a.cookie.get(j)!="expand"&&!m){var n=a.ui.bubble(h,{showWithAni:"fadeInUp",hideWithAni:"fadeOutDown",autoRelease:!0}).show(),o=function(){if(a.contains(document.body,b)&&n._)n.beside(b,{offsetX:0,offsetY:0});else{n.hide();k&&clearInterval(k)}};k=setInterval(o,1e3);a.cookie.set(j,"expand",{expire:l})}}var m=f.el,n=b.getMid(m,g),o=f.data,q=o.type==="feedvideo"||o.type==="feedlive",r=b.getFeedNode(m,g),s=r.getAttribute("isForward")?"1":"",t=y(r,s);if(r.disp!=a.jsonToStr(o)){t.disp.innerHTML="";a.lib.feed.widget.clear(n);t.disp.appendChild(a.builder(d(c.widgetTEMP,{notForward:!s,short_url:o.short_url&&decodeURIComponent(o.short_url),full_url:o.full_url&&decodeURIComponent(o.full_url),title:o.title&&decodeURIComponent(o.title),suda:decodeURIComponent(o.suda||"")}).toString()).box);t.prev.style.display="none";t.disp.style.display="";var u=a.sizzle('div[node-type="feed_list_media_widgetDiv"]',t.disp)[0],w=m.getAttribute("mediasize"),x,z;if(w){w=w.split(":");x=500;z=x/w[0]*w[1];z=Math.max(Math.min(z,x/9*16),x/16*9);z=z>500?500:z}q&&function(){var b=a.sizzle(".WB_video img",t.prev)[0],c=a.sizzle(".tab_feed_a",t.disp)[0];if(!!b&&!!c){a.addClassName(t.disp,"WB_expand_media_box_ani");u.style.backgroundColor="#000";u.innerHTML='<div class="WB_video_img W_piccut_v"><img src="'+b.src+'" alt="">'+'<i class="W_loading_big"></i>'+"</div>";var d=u.firstChild;d.style.height=b.parentNode.offsetHeight+"px";setTimeout(function(){a.addClassName(t.disp,"WB_expand_media_box_trans");d.style.height=(z||516)+"px"},10)}}();var A=K(m);if(A){var B=A.getAttribute("data-mark");B=a.queryToJson(B)||{};o=a.lib.kit.extra.merge(o,B)}var C,D;if(o.video_src){C="video";D=decodeURIComponent(o.video_src)}else if(o.live_src){o.is_live==1?C="live_on":C="live_off";D=decodeURIComponent(o.live_src)}var E=o.objectid;p.request("third_rend",{onSuccess:function(b){b=b.data;if(b.html){u.innerHTML=decodeURIComponent(b.html).replace(/http:\/\//g,location.protocol=="https:"?"https://":"//");a.foreach(a.sizzle("iframe",u),function(b){if(b.getAttribute("_src")){b.setAttribute("width","100%");b.connect=a.lib.connect.iframe(b);b.connect.on("setHeight",L)}});q&&w&&a.foreach(a.sizzle("object,embed",u),function(a){if(x<400){a.style.width="400px";a.setAttribute("width",300);setTimeout(function(){a.style.width=x+"px";a.setAttribute("width",x)})}else{a.style.width=x+"px";a.setAttribute("width",x)}if(z<300){a.style.height="300px";a.setAttribute("height",300);setTimeout(function(){a.style.height=z+"px";a.setAttribute("height",z)})}else{a.style.height=z+"px";a.setAttribute("height",z)}});a.conf.channel.feed.fire("videolayer",{action:"muiteVideo",args:[n]});D&&l(u,C,D,E,n,w)}else if(b.iframe){var c="feed_iframe_"+a.getUniqueKey();b.iframe=b.iframe+(b.iframe.indexOf("?")>=0?"&":"?")+"skin="+$CONFIG.skin;u.innerHTML='<iframe name="'+c+'" _src="'+b.iframe+'" allowTransparency="true" frameBorder="no" scrolling="no" style="width:100%;height:"'+(b.height||500)+';overflow:hidden;">';var d=u.firstChild;d.connect=a.lib.connect.iframe(d);d.connect.on("setHeight",L);d.connect.on("uiPublish",M)}},onFail:function(a){u.innerHTML=a&&a.msg||k},onError:function(a){u.innerHTML=a&&a.msg||k}},a.lib.kit.extra.merge({isforward:s,mid:n},o));r.disp=a.jsonToStr(o);r.isForward=s;var F=Q.md5Data({uid:$CONFIG.uid,mid:n,keys:o.keys,type:o.type},Q.getUniqueKey(),v);q&&a.conf.trans.feed.feed.request("playstatistics",{},F)}},Q={count:0,getUniqueKey:function(){return"H5_"+Math.random().toString(36).substring(5,10)+"_"+ +(new Date)+Math.floor(Math.random()*1e4)+Q.count++},md5Data:function(b,c,d){var e={};e.data=a.jsonToStr(b);e.key=c;e.sig=e.data&&c&&d&&e.data+c+d;e.sig=f.hash(e.sig);return e},getPDNodes:function(b){return{prev:a.sizzle("[node-type=feed_list_media_prev]",b)[0],disp:a.sizzle("[node-type=feed_list_media_disp]",b)[0]}},getActionData:function(a,b){return a.tagName.toLowerCase=="body"?null:a.getAttribute("node-type")==b?a.getAttribute("action-data"):arguments.callee(a.parentNode,b)}},R=function(e,f,g){var h=e.el,i=b.getMid(h,f),j=e.data,k=b.getFeedNode(h,f),m=k.getAttribute("isForward")?"1":"",n=y(k,m);if(k.disp!=j.short_url){n.disp.innerHTML="";a.lib.feed.widget.clear(i);n.disp.appendChild(a.builder(d(c.qingTEMP,{notForward:!m,short_url:decodeURIComponent(j.short_url),full_url:decodeURIComponent(j.full_url),title:decodeURIComponent(j.title),suda:decodeURIComponent(j.suda||"")}).toString()).box);n.prev.style.display="none";n.disp.style.display="";var p=a.sizzle('div[node-type="feed_list_media_qingDiv"]',n.disp)[0],q=function(b){var c=b.code;if(c+""=="1"){b=b.data;if(!b.result)return;p.innerHTML=b.result;a.lib.feed.widget.add(i,n.disp)}else r(b)},r=function(a){p.innerHTML=l},s=j.template_name;s?s=="video"&&(a.IE?s="object":navigator.plugins&&navigator.plugins["Shockwave Flash"]?s="embed":s="html5"):s="";b.getTrans("qingShow",{onComplete:q,onFail:r}).request({short_url:j.short_url,lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn",mid:i,vers:3,template_name:s});k.disp=j.short_url;k.isForward=m;a.scrollTo(n.disp,{step:1,top:o})}};return function(c,d){if(!c)a.log("media : need object of the baseFeedList Class");else{var f=c.getNode(),i=c.getDEvent();b=c.utils;var j={},k=!0,l={dispContentNode:{},voteObj:{}},m=function(){a.custEvent.fire(c,"clearTips","media")},n="mw690",o=function(){var b=a.foreach(a.sizzle("img[node-type=fl_media_bgimg], img[node-type=feed_list_media_bgimg]",f),function(a){return a.src?a.src.replace("thumbnail",n).replace("square",n):null});a.lib.kit.extra.loadImageInBackground(b);FM.unallRenderReady(o)},q=function(a){m();P(a,f,l);return b.preventDefault(a.evt)};a.custEvent.add(c,"updateFeed",o);FM.isOrigPageRenderReady()?o():FM.onallRenderReady(o);i.add("feed_list_media_toSmall","click",function(c){var d=b.getFeedNode(c.el,f),e,g;a.foreach(a.sizzle("object,embed",d),function(b){if(!!b.src)if(b.src.indexOf("js.t.sinajs.cn")!=-1||b.src.indexOf("video.weibo.com")!=-1){e=b.getP2pDeleteUrl?b.getP2pDeleteUrl().data:null;g=e?a.queryString("pid",{source:a.parseURL(e).query}):null}});a.lib.feed.widget.clear(b.getMid(c.el,f));N(d);m();B(c,f,!0);if(e)try{a.jsonp({url:e,args:{peerid:g}})}catch(h){}return b.preventDefault(c.evt)});var s=function(b,c){p.request("checkVmember",{onSuccess:function(d){if(d.code=="100000"){var e,f,g=a.core.dom.dir.parent(c.obj.el,{expr:"ul"})[0];for(var h in d.data)e=encodeURIComponent(d.data[h].picUrl);c.obj.data.clear_picSrc=e;c.obj.data.relation=1;a.lib.kit.extra.actionData(c.obj.el).set("relation",1);a.lib.kit.extra.actionData(g).set("relation",1);a.lib.kit.extra.actionData(g).set("clear_picSrc",e);c.obj.el.removeAttribute("memberbtnclick");b(c.obj,c.node,c.cData,c.config)}},onFail:function(a){b(c.obj,c.node,c.cData,c.config)},onError:function(a){b(c.obj,c.node,c.cData,c.config)}},{mid:c.obj.data.mid,pictype:"mw690"})},t=function(c){var e=b.getFeedNode(c.el,f),g=c.el.getAttribute("memberbtnclick");m();a.lib.image.multiimage.hastags().add(c.data.photo_tag_pids);a.lib.kit.extra.feedControlHash();g?setTimeout(function(){s(z,{obj:c,node:f,cData:l,config:d})},1e3):z(c,f,l,d);return b.preventDefault(c.evt)};if(g.video(!0))var u=a.lib.feed.plugins.gif.init(c,t);else i.add("feed_list_media_img","click",t);i.add("feed_list_media_bigimgDiv","click",function(a){m();B(a,f);return b.preventDefault(a.evt)});i.add("fl_vPay","click",function(c){var d=b.getFeedNode(c.el,f),e=a.sizzle('[action-type="feed_list_media_img"]',d)[0];e.setAttribute("memberBtnClick","1");var g=c.data.uid,h=c.data.mid,i=location.protocol+"//vipclub.weibo.com/vmember/opendetail?vuid="+g+"&F=pic_"+h;window.open(i,"_blank");B(c,f,!0);return b.preventDefault()});i.add("feed_list_media_bigimgDiv","contextmenu",function(a){if(a.data.isPrivate==1)return b.preventDefault(a.evt)});i.add("feed_list_media_toRight","click",function(c){if(c.data.isPrivate!=1||c.data.relation==1){if(a.hasClassName(c.el,"S_ficon_dis"))return;m();C(c,f,90);return b.preventDefault(c.evt)}});i.add("feed_list_media_toLeft","click",function(c){if(c.data.isPrivate!=1||c.data.relation==1){if(a.hasClassName(c.el,"S_ficon_dis"))return;m();C(c,f,-90);return b.preventDefault(c.evt)}});i.add("feed_list_media_replay","click",function(a){m();D(a,f);return b.preventDefault(a.evt)});i.add("feed_list_media_video","click",function(a){m();E(a,f,"video",l);return b.preventDefault(a.evt)});i.add("feed_list_media_music","click",function(b){a.preventDefault();m();E(b,f,"music",l);return});i.add("feed_list_media_toFloat","click",function(d){m();a.custEvent.fire(c,"clearToFloat");H(d,f,l);return b.preventDefault(d.evt)});a.custEvent.define(c,"clearToFloat");a.custEvent.add(c,"clearToFloat",I);i.add("feed_list_media_magic","click",function(c){m();c.data.swf?a.lib.face.magic(c.data.swf):a.log("魔法表情的地址不存在: node上的action-data swf不存在!");return b.preventDefault(c.evt)});i.add("feed_list_media_v5update","click",function(c){m();c.data.swf?a.lib.face.magic(decodeURIComponent(c.data.swf),undefined,{isV5update:!0}):a.log("魔法表情的地址不存在: node上的action-data swf不存在!");return b.preventDefault(c.evt)});i.add("feed_list_media_widget","click",function(c){var d=a.fixEvent(c.evt),e=d.target,g=b.getFeedNode(e,f),h=a.lib.kit.dom.parseDOM(a.builder(g).list),i=h.feed_list_pulishMood;if(i){a.isArray(i)||(i=[i]);for(var j=0,k=i.length;j<k;j++){var n=i[j];if(e==n||a.core.dom.contains(n,e))return}}m();J(c,f,l);return b.preventDefault(c.evt)});r?g.video(!0)?w=a.lib.feed.plugins.videos.init(c,q):w=a.lib.feed.plugins.video.init(c,q):i.add("feed_list_third_rend","click",q);i.add("feed_list_smallPlayer","click",function(a){m();O(a,f,l);return b.preventDefault(a.evt)});i.add("fl_playmusic","click",function(a){m();"WEIBO_MUSIC_PLAYER"in window?window.WEIBO_MUSIC_PLAYER.playSongByObjectId(a.data.object_id):P(a,f,l);return b.preventDefault(a.evt)});i.add("feed_list_media_qing","click",function(a){m();R(a,f,l);return b.preventDefault(a.evt)});i.add("feed_list_url","click",function(c){var d=c.el,e=b.getMid(d,f),g=b.getFeedNode(d,f),h="";g&&(h=g.getAttribute("minfo")?"&"+g.getAttribute("minfo"):"");var i=g.dataset&&g.dataset.mark||g.getAttribute("data-mark")||"",j=a.core.dom.neighbor(d).parent('[node-type="feed_list_repeat"]').finish(),k=d.href+(d.href.indexOf("?")>=0?"&":"?"),l=null;if(i){i=a.core.json.queryToJson(i);i.mark&&(i.mark=encodeURIComponent(i.mark));i=a.core.json.jsonToQuery(i);if(j&&j!=d)l=window.open(k+"u="+$CONFIG.oid+"&m="+e+"&cu="+$CONFIG.uid+h);else{var m;d.getAttribute("extra-data")&&(m=d);m=m||a.lib.kit.dom.parentElementBy(d,g,function(a){if(a.getAttribute("extra-data"))return!0});if(m){var n=a.core.json.queryToJson(m.getAttribute("extra-data"));n.mid=e;n=a.core.json.merge(n,a.core.json.queryToJson(i));p.getTrans("setAD",{onSuccess:function(){},onFail:function(){},onError:function(){}}).request(n)}l=window.open(k+"u="+$CONFIG.oid+"&m="+e+"&cu="+$CONFIG.uid+"&"+i+h)}}else l=window.open(k+"u="+$CONFIG.oid+"&m="+e+"&cu="+$CONFIG.uid+h);l&&l.opener&&(l.opener=null);return b.preventDefault()});i.add("vote_toSmallInfo","click",function(c){var d=c.el,e=b.getFeedNode(d,f),g=a.lib.kit.dom.parseDOM(a.builder(e).list);g.vote_bigInfo&&(g.vote_bigInfo.style.display="none");g.vote_smallInfo&&(g.vote_smallInfo.style.display="");return a.preventDefault(c.evt)});i.add("vote_toBigInfo","click",function(c){var d=c.el,e=b.getFeedNode(d,f),g=a.lib.kit.dom.parseDOM(a.builder(e).list);g.vote_smallInfo&&(g.vote_smallInfo.style.display="none");g.vote_bigInfo&&(g.vote_bigInfo.style.display="");return a.preventDefault(c.evt)});i.add("vote_refresh_code","click",function(b){var c=b.el,d=c.src.replace(/ts=.+/,"")+"ts="+a.getUniqueKey();c.src=d;return a.preventDefault(b.evt)});i.add("feed_list_image_like","click",function(c){if(!!k){k=!1;var d=c.el,g=a.core.json.merge(c.data,{location:$CONFIG.location,object_type:"pic",ref:"feed"});a.conf.trans.feed.attitude.getTrans("objLike",{onSuccess:function(c,g){var h=c.data.is_del?!0:!1,i=g.count;h?i--:i++;var j=i>0?i:0,l;h?l=j!=0?e('<a class="W_btn_alpha" title="#L{赞}" href="javascript:"><span><i class="W_ficon ficon_praised">ñ</i><em>'+j+"</em></span></a>"):e('<a class="W_btn_alpha" title="#L{赞}" href="javascript:"><span><i class="W_ficon ficon_praised">ñ</i></span></a>'):l=j!=0?e('<a class="W_btn_alpha" title="#L{取消赞}" href="javascript:"><span class="W_praised"><i class="W_ficon ficon_praised">ñ</i><em>'+j+"</em></span></a>"):e('<a class="W_btn_alpha" title="#L{取消赞}" href="javascript:"><span class="W_praised"><i class="W_ficon ficon_praised">ñ</i></span></a>');d.innerHTML=l;var m=a.lib.kit.extra.actionData(d);m.set("count",j);m.set("is_liked",h?0:1);var n=b.getFeedNode(d,f),o=n.getAttribute("isForward")?1:"",p=y(n,o),q=a.sizzle('[action-type="feed_list_media_img"]',p.prev)[0],r=a.lib.kit.extra.actionData(q),s=decodeURIComponent(r.get("pic_objects")),t=s.split("|");t[1]=h?0:1;t[2]=j;r.set("pic_objects",encodeURIComponent(t.join("|")));var u=a.sizzle('[action-type="widget_photoview"]',p.disp)[0],v=a.lib.kit.extra.actionData(u);v.set("pic_objects",encodeURIComponent(t.join("|")));k=!0},onFail:function(b){a.lib.dialog.ioError(b.code,b);k=!0},onError:function(b){a.lib.dialog.ioError(b.code,b);k=!0}}).request(g)}});i.add("fl_url_addparams","click",function(a){var c=a.el,d=b.getMid(c,f),e=b.getFeedNode(c,f),g="";e&&(g=e.getAttribute("tbinfo")?"&"+e.getAttribute("tbinfo"):"");var h=e.getAttribute("omid")||"",i=e.getAttribute("data-mark");i=i?"&"+i:"";var j="mid="+d+(h?"&omid="+h:"")+g+i;window.open(c.href.indexOf("?")>-1?c.href+"&"+j:c.href+"?"+j);return b.preventDefault()});i.add("fl_article_tip","click",function(b){var c=a.ui.confirm([e("#L{您好，您发布了带有文字长图的微博，由于阅读者在非wifi环境下查看长图会耗费较多流量，因此我们会限制文字长图在非wifi环境下的展示，您此条微博阅读量可能受影响。}"),e("#L{建议您使用头条文章发布内容，用户打开速度更快、更节省流量，享有更多曝光机会。 }")]).ok(e("#L{使用头条文章}"),function(){window.open("http://weibo.com/ttarticle/p/editor")}).cancel(e("#L{我知道了}"));c.setTitle(e("#L{尊敬的用户}"));c.getDomList().icon.style.display="none"});window.playCompleted=function(){$CONFIG.islogin=="1"&&location.href.indexOf("spr_sinamkt_buy_baiduv_weibouv_v001")!=-1&&a.lib.dialog.loginLayer({lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn"})};var v=function(b){var c=a.fixEvent(b).target,d;a.core.dom.hasClassName(c,"WB_media_wrap_ani")?d=c:d=a.core.dom.dir.parent(c,{expr:".WB_media_wrap_ani",endpoint:f})[0];if(d&&d.style.height===""){d.style.height=d.scrollHeight+"px";a.addClassName(d,"WB_media_wrap_trans")}};j.destroy=function(){w&&w.destroy&&w.destroy();u&&u.destroy&&u.destroy();N(f);G&&G.destroy();f=i=undefined;a.lib.feed.widget.destroy();a.custEvent.remove(c,"clearToFloat",I);window.playCompleted=null;FM.unallRenderReady(o);a.custEvent.remove(c,"updateFeed",o);h&&h.destroy&&h.destroy()};return j}}});
STK.register("lib.image.multiimages",function(a){var b=a.lib.image.multiimage.showtag,c=a.conf.channel.video,d=a.conf.trans.feed.feed,e=$CONFIG.imgPath,f='<div style="top:0px;left:0px;display:none;" node-type="recLayer" class="W_layer"></div>',g='<#et recimg data><ul class="pic_list clearfix"><#list data.recimgs as list><li><a target="_blank" href="${list.imgsrc}"><img src="${list.img}"></a></li></#list></ul></#et>',h='<#et list data><span class="WB_pic_vip" node-type="pic_vip"><em class="W_f16"><em class="W_f16">开通Ta的专属会员即可浏览图片和Ta的全部付费内容</em></em><a node-type="fl_vPay_M" action-type="fl_vPay_M" action-data="mid=${data.mid}&&isPrivate=${data.isPrivate}&uid=${data.uid}" href="javascript:;" class="W_btn_a btn_34px">立即开通</a></span></#et>',i='<#et images data><div node-type="imagesBox" class="WB_expand_media S_bg1"><div class="tab_feed_a clearfix"><div class="tab"><ul class="clearfix"><#if (data.toSmall == 1)><li><span class="line S_line1"><a action-type="feed_list_img_toSmall" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_arrow_fold S_ficon">k</i>#L{收起}</a></span></li></#if><#if (data.isPrivate == 1 && data.relation !=1)><li><span class="line S_line1"><a action-type="widget_photoview" node-type="tobig"  action-data="pid=${data.currentPid}&clear_picSrc=${data.clear_picSrc}&relation=${data.relation}&isPrivate=${data.isPrivate}"   href="javascript:;" class="S_ficon_dis"><i class="W_ficon ficon_search S_ficon_dis">f</i>#L{查看大图}</a></span></li><li><span class="line S_line1"><a action-type="turnLeft" href="javascript:;" action-data="pid=${data.currentPid}&isPrivate=${data.isPrivate}&relation=${data.relation}" class="S_ficon_dis"><i class="W_ficon ficon_turnleft S_ficon_dis">m</i>#L{向左旋转}</a></span></li><li><span class="line S_line1"><a action-type="turnRight" href="javascript:;" action-data="pid=${data.currentPid}&isPrivate=${data.isPrivate}&relation=${data.relation}" class="S_ficon_dis"><i class="W_ficon ficon_turnright S_ficon_dis">n</i>#L{向右旋转}</a></span></li><li><span class="line S_line1"><a action-type="replay" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_replay S_ficon">y</i>#L{重播}</a></span></li><#else><li><span class="line S_line1"><a action-type="widget_photoview" node-type="tobig" action-data="pid=${data.currentPid}&gif_oid=${data.curgif_oid}&gif_height=${data.curgif_height}&gif_url=${data.curgif_url}&gif_width=${data.curgif_width}&gif_duration=${data.curgif_duration}" href="javascript:;"  class="${data.story ? "S_ficon_dis" : "S_txt1"}"><i class="W_ficon ficon_search ${data.story ? "S_ficon_dis" : "S_ficon"}">f</i>#L{查看大图}</a></span></li><li><span class="line S_line1"><a action-type="turnLeft" href="javascript:;" action-data="pid=${data.currentPid}&isPrivate=${data.isPrivate}&relation=${data.relation}" class="S_txt1"><i class="W_ficon ficon_turnleft S_ficon">m</i>#L{向左旋转}</a></span></li><li><span class="line S_line1"><a action-type="turnRight" href="javascript:;" action-data="pid=${data.currentPid}&isPrivate=${data.isPrivate}&relation=${data.relation}" class="S_txt1"><i class="W_ficon ficon_turnright S_ficon">n</i>#L{向右旋转}</a></span></li><li><span class="line S_line1"><a action-type="replay" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_replay S_ficon">y</i>#L{重播}</a></span></li></#if></ul></div></div><div class="WB_media_view" <#if (data.isAD)> markad-data="type=tagslide"</#if>><div class="media_show_box">          <ul class="clearfix" node-type="picShow"><!--根据鼠标所在区域范围选择，向左的鼠标手型类名leftcursor，向右鼠标手型类名rightcursor,图片变小smallcursor--><li node-type="imgBox" class="leftcursor"><div class="artwork_box" node-type="artwork_box"><#if (data.uniqueKey && !data.curgif_url || !data.uniqueKey)><div node-type="imgSpanBox" style="position:relative;"><img node-type="imgShow" src="${data.currentUrl}"></div><div node-type="gifSpanBox" style="position:relative;display:none;"></div><#else><div node-type="imgSpanBox" style="position:relative;display:none;"></div><div node-type="gifSpanBox" style="position:relative;"></div></#if><span node-type="multi_image_like" style="display:none;" action-type="multi_image_like" action-data="mid=${data.mid}&photo_id=${data.pid}&is_liked=${data.is_liked}&count=${data.count}&object_id=${data.object_id}"><a href="" class="W_btn_alpha" title="赞"><i class="icon_praise"></i><span>赞</span></a><a href="" class="W_btn_alpha" title="取消赞"><i class="icon_praised"></i><span>(0)</span></a></span></div><i node-type="loading" style="display: none;" class="W_loading"></i></li></ul>'+f+"</div>"+'<div class="pic_choose_box clearfix">'+'<a href="javascript:;" node-type="prev" action-type="prev" class="arrow_left_small S_bg2 arrow_dis" title="上一页"><i class="W_ficon ficon_arrow_left S_ficon">b</i></a>'+'<div class="stage_box">'+'<ul node-type="picChoose" class="choose_box clearfix">'+"<#list data.picChoose as picChoose>"+'<li><a href="javascript:;"<#if (picChoose.pid == data.currentPid)> class="current"</#if> node-type="thumbItem" action-type="thumbItem" action-data="pid=${picChoose.pid}"><img class="S_line2" src="${picChoose.url}""  alt=""><#if (picChoose.isPrivate == 1 && data.firstPid != picChoose.pid )><i title="大V会员" class="W_icon icon_vplus_s"></i></#if></a></li>'+"</#list>"+"</ul>"+"</div>"+'<a href="javascript:;" node-type="next" action-type="next" class="arrow_right_small arrow_dis S_bg2" title="#L{下一页}"><i class="W_ficon ficon_arrow_right S_ficon">a</i></a>'+"</div>"+" </div>"+"</div>"+"</#et>",j=500,k=280;return function(e){function K(b,c){var d=a.sizzle("[action-type=turnLeft],[action-type=turnRight],[action-type=replay]",g.imagesBox);a.lib.image.livephoto(b,c,{canNotPlay:function(){var b=a.sizzle("[action-type=replay]",g.imagesBox)[0],c=a.core.dom.dir.parent(b,{expr:"li"})[0];c.style.display="none"},start:function(){a.foreach(d,function(b){var c=a.core.dom.dir.parent(b,{expr:"li"})[0];c.style.display="none"})},end:function(){if(!!a.contains(g.imagesBox,b)){a.foreach(d,function(b){var c=a.core.dom.dir.parent(b,{expr:"li"})[0];c.style.display=""});var e=a.sizzle("[action-type=replay]",g.imagesBox)[0];e.setAttribute("mp4",c)}}})}var f={},g,l,m="",n=0,o=0,p="",q,r,s={},t=!1,u=!1,v=!1,w=a.lib.kit.extra.language,x=[],y,z="",A=a.parseParam({uniqueKey:"",currentPid:"",pids:[],object_ids:"",gif_oids:"",curgif_url:"",curgif_width:"",curgif_height:"",curgif_duration:"",curgif_oid:"",index:"",filter_ids:[],pic_objects:"",pic_video:null,picShowWidth:440,sum:7,thumbWidth:59,imageSize:"bmiddle",mid:"",uid:"",isPrivate:0,relation:0,isForward:0,clear_picSrc:"",thumb_picSrc:"",curthumb_picSrc:"",curclear_picSrc:"",toSmall:1,story:!1,isAD:!1},e),B=[],C=[],D=[],E=[],F=A.clear_picSrc&&A.clear_picSrc.split(",")||"";_clear_thumbSrc=A.thumb_picSrc&&A.thumb_picSrc.split(",")||"";var G=!0,H,I={pic:[3,7],rec:[1,8.6]},J=function(b){var c=b.pic_video;if(!c)return null;var d=[];a.foreach(c.split(","),function(a){a=a.split(":");d[a[0]]="//us.sinaimg.cn/"+a[1]+".mov"});return d}(e),L={getIndex:function(a,b){var c=0;for(var d=0;a[d];d++)if(a[d]==b){c=d;break}return c},setPic:function(b,c){var d=b.pid;if(!(!d&&(p=d)||n<0&&d==p||n>=o)){var e=L.getImgUrl(d),f=g.imgSpanBox,h=a.C("img");s[d]=h;p=d;a.setStyle(g.loading,"display","");a.setStyle(g.gifSpanBox,"display","none");h.onload=function(){h.onload=null;a.setStyle(g.loading,"display","none");a.setStyle(f,"display","");L.setpid();var c=a.core.ani.tween(f,{duration:150,end:function(){f.innerHTML="";a.setStyle(f,"height","");f.appendChild(h);a.tween(f,{duration:100,animationType:"easeoutcubic"}).play({opacity:1}).destroy();L.setLikeStatus(b);setTimeout(function(){h&&L.setTag(h)},0)}});c.play({opacity:.3}).destroy();h&&L.setBoxSize(h,{width:h.width,height:h.height});L.showBtns(!1,h)};h.src=e;for(var i=0;x[i];i++)x[i].onload=null;x.push(h)}},getImgUrl:function(b,c){var d=L.getIndex(A.pids,b);return decodeURIComponent(F[d]||a.lib.kit.extra.imageURL(b,{size:A.imageSize}))},setIndex:function(b){switch(b){case"min":n--;break;case"add":n++;break;default:n=b}n<0&&(n=0);if(n>o-1){v?n=o:n=o-1;L.showRec()}a.position(g.imagesBox).t<a.scrollPos().top&&a.scrollTo(g.imagesBox,{top:120,step:10});n>o-3&&L.getRecPics();A.curclear_picSrc=F[n];L.setCurrentThumb();L.scrollList();var c=A.filter_ids[n];c&&window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_pc_image","stickers_image:"+c.replace("|",":"))},setLikeStatus:function(a){var b=g.multi_image_like;if(b){var c=a.count;a.is_liked?b.innerHTML=c!=0?w('<a class="W_btn_alpha" title="#L{取消赞}" href="javascript:"><span class="W_praised"><i class="W_ficon ficon_praised">ñ</i><em>'+c+"</em></span></a>"):w('<a class="W_btn_alpha" title="#L{取消赞}" href="javascript:"><span class="W_praised"><i class="W_ficon ficon_praised">ñ</i></span></a>'):b.innerHTML=c!=0?w('<a class="W_btn_alpha" title="#L{赞}" href="javascript:"><span><i class="W_ficon ficon_praised">ñ</i><em>'+c+"</em></span></a>"):w('<a class="W_btn_alpha" title="#L{赞}" href="javascript:"><span><i class="W_ficon ficon_praised">ñ</i></span></a>');b.setAttribute("action-data","mid="+A.mid+"&photo_id="+a.pid+"&is_liked="+a.is_liked+"&count="+a.count+"&object_id="+a.object_id);b.style.display=""}},showRec:function(){if(!!v){var b=a.core.dom.getSize(g.picShow),c=a.core.dom.getSize(g.recLayer);b.height<c.height&&(g.picShow.style.height=c.height+"px");var d=y||(b.height-c.height)/2;d=d-c.height/2;d>b.height-c.height&&(d=b.height-c.height);d<0&&(d=0);g.imgSpanBox.innerHTML=reclayerHTML;g.multi_image_like.style.display="none";a.setStyle(g.gifSpanBox,"display","none");a.setStyle(g.imgSpanBox,"display","");t=!0;window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_pic_recommend","recommend_exposure")}},scrollList:function(){return function(a,b){var c=Math.floor(A.sum/2),d=n;b&&(d=a);var e=o;if(e>A.sum){var f=d-c;if(f<=0){f=0;g.prev.className!="arrow_left_small arrow_dis S_bg2"&&(g.prev.className="arrow_left_small arrow_dis S_bg2")}else g.prev.className!="arrow_left_small S_bg2"&&(g.prev.className="arrow_left_small S_bg2");if(f>=e-A.sum){f=e-A.sum;g.next.className!="arrow_right_small arrow_dis S_bg2"&&(g.next.className="arrow_right_small arrow_dis S_bg2")}else g.next.className!="arrow_right_small S_bg2"&&(g.next.className="arrow_right_small S_bg2");var h=0-A.thumbWidth*f;r.play({marginLeft:h})}}}(),setCurrentThumb:function(){for(var b in g.thumbItem)a.removeClassName(g.thumbItem[b],"current");g.thumbItem[n]&&a.addClassName(g.thumbItem[n],"current")},rotateImg:function(b,c){var d=b.el,e=a.sizzle("img",g.imgSpanBox)[0];!e&&(e=document.getElementById(z));d.parentNode.uid=a.core.dom.uniqueID(e)+"_"+a.core.util.getUniqueKey();z=d.parentNode.uid;e.setAttribute("id",d.parentNode.uid);a.lib.kit.dom.rotateImage.rotateRight(a.E(d.parentNode.uid),c,g.imgSpanBox.offsetWidth)},replay:function(b){var c=b.el,d=c.getAttribute("mp4"),e=a.sizzle("img",g.imgSpanBox)[0];e||(e=a.E(z));e.getAttribute("id")&&a.lib.kit.dom.rotateImage.rotateDefault(e);K(e,d)},getImgsrc:function(a,b,c){var d="//photo.weibo.com/"+a+"/wbphotos/large/mid/"+b+"/pid/"+c+"?refer=weibofeedv5";return d},setpid:function(b){var c={pid:p,pids:A.pids.join(","),mid:A.mid,uid:A.uid,pic_objects:H,isPrivate:A.isPrivate,relation:A.relation,curclear_picSrc:A.curclear_picSrc};b&&(c=a.core.json.merge(c,b));g.tobig.setAttribute("action-data",a.jsonToQuery(c))},getRecPics:function(){if(!u){u=!0;a.conf.trans.image.getTrans("recmodlayer_new",{onSuccess:function(a){reclayerHTML=a.data.html;v=!0},onError:function(a){t=!1;v=!1}}).request({mid:A.mid,uid:A.uid})}},setBoxSize:function(b,c){if(!!b){var d,e;if(A.isPrivate==1&&A.relation!=1&&n){d=j+"px";e=k+"px"}else if(A.picShowWidth>0&&c.width>A.picShowWidth){d=A.picShowWidth;e=A.picShowWidth/c.width*c.height}d&&a.setStyle(b,"width",d+"px");e&&a.setStyle(b,"height",e+"px")}},setTag:function(a){!a||b({container:"",img:a,postdata:{mid:A.mid,pid:p}})},showBtns:function(b,c){var d=a.sizzle("[action-type=turnLeft],[action-type=turnRight]",g.imagesBox);a.foreach(d,function(c){var d=a.sizzle("i",c);if(b){a.addClassName(c,"S_ficon_dis");a.removeClassName(c,"S_txt1");d&&d[0]&&a.addClassName(d[0],"S_ficon_dis");d&&d[0]&&a.removeClassName(d[0],"S_ficon")}else{a.removeClassName(c,"S_ficon_dis");a.addClassName(c,"S_txt1");d&&d[0]&&a.removeClassName(d[0],"S_ficon_dis");d&&d[0]&&a.addClassName(d[0],"S_ficon")}var e=a.core.dom.dir.parent(c,{expr:"li"})[0];e.style.display=""});var e=A.isPrivate==1,f=A.isPrivate==1&&A.relation==1||!n;if(!b&&J&&J[n]&&(!e||f))K(c,J[n]);else{var h=a.sizzle("[action-type=replay]",g.imagesBox)[0],i=h&&a.core.dom.dir.parent(h,{expr:"li"})[0];if(i){i.style.display="none";i.removeAttribute("mp4")}}},setGifSize:function(b,c,d){a.setStyle(b,"width",c+"px");a.setStyle(b,"height",d+"px");a.setStyle(b,"margin","0 auto")},setGif:function(b){var e=g.loading,f=g.gifSpanBox,h=g.imgSpanBox;p=B[n]||A.pids[n];a.setStyle(e,"display","");a.setStyle(f,"display","");d.request("gifUrl",{onComplete:function(d){if(d.code=="100000"){var g=d.data,i=g.gif_url,j=g.gif_width,k=g.gif_height;g.gif_url=encodeURIComponent(g.gif_url);L.setpid(g);L.setGifSize(f,j,k);L.setBoxSize(f,{width:j,height:k})}a.setStyle(h,"display","none");c.fire("showPicDis",{key:A.uniqueKey,index:n,box:f,oid:b});a.setStyle(e,"display","none");L.showBtns(!0)},onFail:function(d){a.setStyle(h,"display","none");a.setStyle(e,"display","none");c.fire("showPicDis",{key:A.uniqueKey,index:n,box:f,oid:b});L.showBtns(!0)}},{object_id:b})},toggleVipBtn:function(){if(A.isPrivate==1||A.relation!=1){var b=a.sizzle("[action-type=replay]",g.imagesBox)[0];b.style.display=b&&n?"none":""}if(A.isPrivate==1&&A.relation!=1){var c=a.sizzle("[node-type='pic_vip']",g.picShow);if(n!=0&&n<=o-1){if(c[0])return;var d=a.core.util.easyTemplate(h,A).toString(),e=a.builder(d).list.pic_vip[0];setTimeout(function(){g.artwork_box.appendChild(e)},0)}else a.removeNode(c[0])}}},M=function(){H=A.pic_objects;var b=decodeURIComponent(A.pic_objects);b=b&&b.split(",");var c=decodeURIComponent(A.object_ids);c=c&&c.split(",");B=A.pids||[];E=c;if(c&&c[0]&&c[0]!="")a.lib.feed.plugins.like.likestatus(E[n],E.join(","),function(a,b){for(var c=0,d=E.length;c<d;c++){C.push(b[E[c]].exits);D.push(b[E[c]].count)}var e=[];for(var c=0,d=B.length;c<d;c++)e.push(B[c]+"|"+C[c]+"|"+D[c]+"|"+E[c]);H=encodeURIComponent(e.join(","));L.setLikeStatus({pid:h[n],is_liked:+C[n],count:D[n]||0,object_id:E[n]});L.setpid({gif_oid:A.curgif_oid,gif_url:A.curgif_url,gif_width:A.curgif_width,gif_height:A.curgif_height,gif_duration:A.curgif_duration})});else for(var d=0,e=b.length;d<e;d++){var f=b[d];f=f.split("|");B.push(f[0]);C.push(f[1]);D.push(f[2]);E.push(f[3])}var h=B.length==1&&B[0]==""?A.pids:B;p=A.currentPid||h[0];n=A.index;o=h.length;var j=[],k=[];for(var d=0;d<o;d++)k.push({pid:h[d],url:_clear_thumbSrc&&decodeURIComponent(_clear_thumbSrc[d])||a.lib.kit.extra.imageURL(h[d],{size:"square"}),isPrivate:A.isPrivate});var l=a.core.util.easyTemplate(w(i),{uniqueKey:A.uniqueKey,story:A.story,picShow:j,picChoose:k,currentPid:h[n],firstPid:h[0],currentUrl:A.curclear_picSrc&&decodeURIComponent(A.curclear_picSrc)||a.lib.kit.extra.imageURL(h[n],{size:A.imageSize}),isForward:A.isForward,toSmall:A.toSmall,pic_objects:A.pic_objects,notShowLikeBtn:A.pic_objects!="",is_liked:+C[n],count:D[n]||0,object_id:E[n],mid:A.mid,pid:h[n],isAD:A.isAD,isPrivate:A.isPrivate,relation:A.relation,clear_picSrc:A.clear_picSrc,curgif_width:A.curgif_width,curgif_url:A.curgif_url,curgif_height:A.curgif_height,curgif_duration:A.curgif_duration,curgif_oid:A.curgif_oid}).toString(),m=a.builder(l);g=a.lib.kit.dom.parseDOM(m.list);b&&b[0]&&b[0]!=""&&(g.multi_image_like.style.display="");q=a.delegatedEvent(g.imagesBox);g.picChoose.style.marginLeft="1px";var s=g.count;s&&s.innerHTML=="(0)"&&a.removeNode(s);r=a.core.ani.tween(g.picChoose,{duration:150});var t=g.imgShow;L.setIndex(n);if(A.uniqueKey&&A.curgif_width&&A.curgif_height){var u=g.gifSpanBox;if(!u)return;L.setGifSize(u,A.curgif_width,A.curgif_height);L.setBoxSize(u,{width:A.curgif_width,height:A.curgif_height});L.showBtns(!0)}else{t&&L.setBoxSize(t,{width:t.width,height:t.height});setTimeout(function(){t&&L.setTag(t)},0);L.showBtns(!1,t)}},N={gesture:function(b){b=a.fixEvent(b);var c=b.clientX-a.position(g.picShow).l,d=I.pic;t&&(d=I.rec);if(c<A.picShowWidth*d[0]/10)if(n==0)if(A.toSmall==1){g.imgBox.className="clearfix smallcursor";m="small"}else{g.imgBox.className="clearfix";m=""}else{g.imgBox.className="clearfix leftcursor";m="left"}else if(c<A.picShowWidth*d[1]/10)if(A.toSmall==1&&!t){g.imgBox.className="clearfix smallcursor";m="small"}else{g.imgBox.className="clearfix";m=""}else if(c>A.picShowWidth*d[1]/10)if(t)if(A.toSmall==1){g.imgBox.className="clearfix smallcursor";m="small"}else{g.imgBox.className="clearfix";m=""}else{g.imgBox.className="clearfix rightcursor";m="right"}},left:function(){if(!a.inArray(document.activeElement.tagName.toUpperCase(),["TEXTAREA","INPUT","SELECT"])){var b=a.position(g.imagesBox).t,c=a.core.dom.getSize(g.imagesBox).height,d=a.scrollPos().top,e=a.winSize().height;if(d>b+c)return;if(d+e<b)return;L.setIndex("min");A.uniqueKey&&A.gif_oids[n]?L.setGif(A.gif_oids[n]):L.setPic({pid:B[n]||A.pids[n],is_liked:+C[n],count:D[n]||0,object_id:E[n]},!0);return B[n]||A.pids[n]}},right:function(){if(!a.inArray(document.activeElement.tagName.toUpperCase(),["TEXTAREA","INPUT","SELECT"])){var b=a.position(g.imagesBox).t,c=a.core.dom.getSize(g.imagesBox).height,d=a.scrollPos().top,e=a.winSize().height;if(d>b+c)return;if(d+e<b)return;L.setIndex("add");A.uniqueKey&&A.gif_oids[n]?L.setGif(A.gif_oids[n]):L.setPic({pid:B[n]||A.pids[n],is_liked:+C[n],count:D[n]||0,object_id:E[n]},!0);return B[n]||A.pids[n]}},gestureClick:function(b){var c=a.core.dom.dir.parent(g.picShow,{expr:"[mid]"})[0],d=c.getAttribute("omid")||c.getAttribute("mid")||"",e=a.fixEvent(b);if(e.target.tagName.toLowerCase()!="a"&&e.target.parentNode.tagName.toLowerCase()!="a"){switch(m){case"left":t&&N.closeRecLayer();var f=N.left();f&&window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_newimage_feed",["image_feed_next",d,f].join(":"));break;case"small":N.tosmall();break;case"right":b=a.fixEvent(b);y=b.pageY-a.position(g.picShow).t;var f=N.right();f&&window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_newimage_feed",["image_feed_next",d,f].join(":"))}L.toggleVipBtn()}},prev:function(){var a=n-7;L.scrollList(a,!0)},next:function(){var a=n+7;L.scrollList(a,!0)},tosmall:function(b){A.toSmall!=0&&a.custEvent.fire(f,"tosmall",{index:n})},preventDefaultFn:function(a){if(A.isPrivate==1){a.preventDefault();window.event.returnValue=!1;return!1}},sendAction:function(b){var c;b=a.parseParam({target:"",mid:"",feedNode:"",markData:""},b);if(!b.target)throw"opts need a target node";b.feedNode||(b.feedNode=b.target&&a.core.dom.dir.parent(b.target,{expr:"[action-type=feed_list_item]"})[0]||"");b.mid||(b.mid=b.feedNode&&b.feedNode.getAttribute("mid")||"");b.markData||(b.markData=a.queryToJson(b.feedNode&&b.feedNode.getAttribute("data-mark")||""));b.target.getAttribute("markad-data")&&(c=b.target);c=c||a.lib.kit.dom.parentElementBy(b.target,b.feedNode,function(a){if(a.getAttribute("markad-data"))return!0});if(c){var e=a.queryToJson(c.getAttribute("markad-data")||"");b.mid&&(e.mid=b.mid);b.markData&&(e=a.core.json.merge(e,b.markData));d.getTrans("setAD",{onSuccess:function(){},onFail:function(){},onError:function(){}}).request(e)}},thumbItem:function(b){var c=a.core.dom.dir.parent(g.picShow,{expr:"[mid]"})[0],d=c.getAttribute("omid")||c.getAttribute("mid")||"";t&&N.closeRecLayer();var e=b.data.pid,f=L.getIndex(A.pids,e),h=f<n?!0:!1;L.setIndex(f);A.uniqueKey&&A.gif_oids[n]?L.setGif(A.gif_oids[n]):L.setPic({pid:B[n]||A.pids[n],is_liked:+C[n],count:D[n]||0,object_id:E[n]},h);L.toggleVipBtn();window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_newimage_feed",["image_feed_next",d,e].join(":"))},turnRight:function(b){if(!t){if(b.data.isPrivate==1&&b.data.relation!=1)return;if(a.hasClassName(b.el,"S_ficon_dis"))return;L.rotateImg(b,90)}},turnLeft:function(b){if(!t){if(b.data.isPrivate==1&&b.data.relation!=1)return;if(a.hasClassName(b.el,"S_ficon_dis"))return;L.rotateImg(b,-90)}},replay:function(a){t||L.replay(a)},closeRecLayer:function(){t=!1},like:function(b){var b=a.fixEvent(b);a.core.evt.stopEvent(b);if(!!G){G=!1;var c=g.multi_image_like,d=a.queryToJson(c.getAttribute("action-data"));d=a.core.json.merge(d,{location:$CONFIG.location,object_type:"pic",ref:"feed"});a.conf.trans.feed.attitude.getTrans("objLike",{onSuccess:function(b,d){var e=b.data.is_del?!0:!1,g=d.count;e?g--:g++;var h=g>0?g:0,i;e?i=h!=0?w('<a class="W_btn_alpha" title="#L{赞}" href="javascript:"><span><i class="W_ficon ficon_praised">ñ</i><em>'+h+"</em></span></a>"):w('<a class="W_btn_alpha" title="#L{赞}" href="javascript:"><span><i class="W_ficon ficon_praised">ñ</i></span></a>'):i=h!=0?w('<a class="W_btn_alpha" title="#L{取消赞}" href="javascript:"><span class="W_praised"><i class="W_ficon ficon_praised">ñ</i><em>'+h+"</em></span></a>"):w('<a class="W_btn_alpha" title="#L{取消赞}" href="javascript:"><span class="W_praised"><i class="W_ficon ficon_praised">ñ</i></span></a>');c.innerHTML=i;var j=a.lib.kit.extra.actionData(c);j.set("count",h);j.set("is_liked",e?0:1);for(var k=0,l=E.length;k<l;k++)if(E[k]==d.object_id){C[k]=e?"0":"1";D[k]=h;break}a.custEvent.fire(f,"rewritedata",{isDel:e,count:h,object_id:d.object_id});G=!0},onFail:function(b){a.lib.dialog.ioError(b.code,b);G=!0},onError:function(b){a.lib.dialog.ioError(b.code,b);G=!0}}).request(d)}}},O=function(){g.picShow.style.backgroundImage="url(about:blank)";a.addEvent(g.picShow,"mousemove",N.gesture);a.addEvent(g.picShow,"click",N.gestureClick);a.lib.kit.touch.cantouch&&a.addEvent(g.picShow,"swipeLeft",N.right);a.lib.kit.touch.cantouch&&a.addEvent(g.picShow,"swipeRight",N.left);g.multi_image_like&&a.addEvent(g.multi_image_like,"click",N.like);g.imgBox&&a.addEvent(g.imgBox,"contextmenu",N.preventDefaultFn);q.add("feed_list_img_toSmall","click",N.tosmall);q.add("tosmall","click",N.tosmall);q.add("thumbItem","click",N.thumbItem);q.add("prev","click",N.prev);q.add("next","click",N.next);q.add("turnLeft","click",N.turnLeft);q.add("turnRight","click",N.turnRight);q.add("replay","click",N.replay);q.add("closeRecLayer","click",N.closeRecLayer);a.core.evt.hotKey.add(document.body,["ctrl+Left"],N.left);a.core.evt.hotKey.add(document.body,["ctrl+Right"],N.right);a.custEvent.define(f,["tosmall","rewritedata"])},P=function(){M();O()};P();var Q=function(){a.removeEvent(g.picShow,"mousemove",N.gesture);a.removeEvent(g.picShow,"click",N.gestureClick);a.lib.kit.touch.cantouch&&a.removeEvent(g.picShow,"swipeLeft",N.right);a.lib.kit.touch.cantouch&&a.removeEvent(g.picShow,"swipeRight",N.left);g.imgBox&&a.removeEvent(g.imgBox,"contextmenu",N.preventDefaultFn);g.multi_image_like&&a.removeEvent(g.multi_image_like,"click",N.like);q.remove("feed_list_img_toSmall","click",N.tosmall);q.remove("tosmall","click",N.tosmall);q.remove("thumbItem","click",N.thumbItem);q.remove("prev","click",N.prev);q.remove("next","click",N.next);q.remove("turnLeft","click",N.turnLeft);q.remove("turnRight","click",N.turnRight);q.remove("replay","click",N.replay);q.remove("closeRecLayer","click",N.closeRecLayer);a.core.evt.hotKey.remove(document.body,["ctrl+Left"],N.left);a.core.evt.hotKey.remove(document.body,["ctrl+Right"],N.right);q.destroy();a.removeNode(g.imagesBox);f=null},R=function(){return g.imagesBox};f.destroy=Q;f.getOuter=R;f.domList=g;return f}});
STK.register("lib.image.inImagesList",function(a){return function(){var a={1652503967:!0,1591509437:!0,1143373133:!0,1764389994:!0,1280811967:!0,1729169932:!0,1651510284:!0,1617764514:!0,1946554430:!0,1285469314:!0,1262112935:!0,1676636885:!0,1708288973:!0,1400565967:!0,1495295187:!0,1402678221:!0,1739933965:!0,1570387057:!0,2189475170:!0,1934174435:!0,1957919150:!0,1591319844:!0,1688756227:!0,1210454405:!0,1650751185:!0,1056937372:!0,1727194535:!0,1659551324:!0,2722504223:!0,1809031027:!0,1549063143:!0,1650555225:!0,1151306150:!0,1596771247:!0,1418859182:!0,1005343850:!0,1111681197:!0,1650555225:!0,1514267615:!0,1984946117:!0,1382274984:!0,1674710384:!0,1833036301:!0,1790518657:!0,1680967943:!0,1862732053:!0,1396386905:!0,1708062733:!0,1787875513:!0,2355472515:!0,1161646031:!0,2306169161:!0,1980500411:!0,1663593323:!0,1767645900:!0,2394143903:!0,2126255307:!0,2425455271:!0,1385892075:!0,1233463251:!0,1729076850:!0,1605275581:!0,1957375697:!0,1798857424:!0,2790784425:!0,2016713117:!0,1787355915:!0,1928349275:!0,1658790201:!0,2407023267:!0,1984946117:!0,1970683355:!0},b=$CONFIG.uid.split("");return a[$CONFIG.uid]?!0:(b.pop()||!0)&&b.pop()==4?!0:!1}});
STK.register("lib.feed.plugins.images",function(a){var b=a.lib.photoview.index,c=a.conf.channel.video,d=a.lib.kit.extra.supportVideo,e=$CONFIG.imgPath,f='<#et list data><span class="WB_pic_vip" node-type="pic_vip"><em class="W_f16">开通Ta的专属会员即可浏览图片和Ta的全部付费内容</em><a node-type="fl_vPay_M" action-type="fl_vPay_M" action-data="mid=${data.mid}&isPrivate=${data.isPrivate}&uid=${data.uid}" href="javascript:;" class="W_btn_a btn_34px">立即开通</a></span></#et>';return function(e,g){if(!e)a.log("images : need object of the baseFeedList Class");else{var h=a.lib.image.multiimages,i=a.conf.trans.feed.feed,j=e.getNode(),k=e.getDEvent(),l=e.utils,m={},n,o=504,p=9,q="mw690",r=!1,s={getPDNodes:function(b){return{prev:a.sizzle("[node-type=feed_list_media_prev]",b)[0],disp:a.sizzle("[node-type=feed_list_media_disp]",b)[0]}},getActionData:function(a,b){return a.tagName.toLowerCase=="body"?null:a.getAttribute("node-type")==b?a.getAttribute("action-data"):arguments.callee(a.parentNode,b)},getAttrData:function(b,c){if(!!b&&!!c){var d=b.getAttribute(c),e=d&&a.queryToJson(d)||!1;return e}},searchNode:function(a,b,c){return a.nodeName=="BODY"||a.nodeName=="body"?null:a.getAttribute(b)==c?a:arguments.callee(a.parentNode,b,c)},getIndex:function(a,b){var c=0;for(var d=0;a[d];d++)if(a[d]==b){c=d;break}return c}},t={fl_pics:function(b){if(!r){r=!0;var c=s.searchNode(b.el,"node-type","fl_pic_list"),d=c.getAttribute("memberBtnClick"),e=function(b,c,d){i.request("checkVmember",{onSuccess:function(d){if(d.code=="100000"){var e=0,f=[],g="",h="",i=s.searchNode(c.el,"node-type","fl_pic_list"),j=a.sizzle("li",i),k=a.lib.kit.extra.actionData(c.el).get("pic_id");c.data.clear_picSrc=d.data[k]&&encodeURIComponent(d.data[k].picUrl);c.data.relation=1;a.lib.kit.extra.actionData(c.el).set("relation",1);for(var l in d.data){a.lib.kit.extra.actionData(j[e]).set("relation",1);a.lib.kit.extra.actionData(j[e]).set("clear_picSrc",encodeURIComponent(d.data[l].picUrl));f.push(encodeURIComponent(d.data[l].picUrl));e++}g=f.join(",");a.lib.kit.extra.actionData(i).set("relation",1);a.lib.kit.extra.actionData(i).set("clear_picSrc",g);i.removeAttribute("memberBtnClick");b(c)}},onFail:function(a){b(c)},onError:function(a){b(c)}},{mid:f,pictype:q})};if(d){var f=a.lib.kit.extra.actionData(c).get("omid")||a.lib.kit.extra.actionData(c).get("mid");VPayTimer=setTimeout(function(){e(t.fl_picFn,b,{mid:f})},1e3)}else t.fl_picFn(b)}},fl_picFn:function(b){r=!1;var e=l.getFeedNode(b.el,j);if(e.getAttribute("isimgloading")!=="true"){e.setAttribute("isimgloading","true");if(!n){n=a.C("i");n.className="W_loading"}b.el.tagName.toLowerCase()==="img"?b.el.parentNode.appendChild(n):b.el.appendChild(n);n.style.display="";var g=b.data||{},i=s.searchNode(b.el,"node-type","fl_pic_list"),k=i.getAttribute("feed-gifs"),m=i.getAttribute("unique-gif"),t=s.getPDNodes(e),v=s.getAttrData(i,"action-data"),w,x=!1;e.getAttribute("data-mark")&&e.getAttribute("feedtype")=="ad"&&(x=!0);a.lib.image.multiimage.hastags().add(v.photo_tag_pids);var y=g&&g.object_type=="story"?!0:!1,z=v.pic_ids&&v.pic_ids.split(",");y&&(v.clear_picSrc=v.clear_picSrc.replace(/\%2Flarge\%2F/g,"%2Fmw690%2F"));var A=v.clear_picSrc&&v.clear_picSrc.split(","),B=v.thumb_picSrc&&v.thumb_picSrc.split(","),C=v.gif_oids&&v.gif_oids.split(","),D=v.uid,E=v.mid?v.mid:l.getMid(b.el,j),F=g.pic_id||z[0]||"",G=v.pic_objects||"",H=F&&s.getIndex(z,F)||0,I=A&&A[H]||"",J=B&&B[H]||"",K=g.gif_url,L=g.gif_width,M=g.gif_height,N=g.gif_duration,O=C&&C[H]||"",P=v.pic_video;v.isPrivate=g.isPrivate;v.relation=g.relation;var Q=function(b){n.style.display="none";a.removeNode(n);n=null;var d=v.photo_filter_ids===undefined?undefined:function(b){var c=Array(z.length);a.foreach(b.split(","),function(a){a=a.split(":");c[a[0]|0]=a[1]});return c}(v.photo_filter_ids);t.prev.style.display="none";var f=h({uniqueKey:b,pids:z,pic_objects:G,pic_video:P,object_ids:v.object_ids||"",gif_oids:C,curgif_url:K,curgif_width:L,curgif_height:M,curgif_duration:N,curgif_oid:O,index:H,filter_ids:d,currentPid:F,mid:E,uid:D,isPrivate:v.isPrivate||0,relation:v.relation||0,clear_picSrc:v.clear_picSrc||"",thumb_picSrc:v.thumb_picSrc||"",curclear_picSrc:I||"",curthumb_picSrc:J||"",imageSize:q,picShowWidth:o,sum:p,story:y,isAD:x});w=f.getOuter();t.disp.appendChild(w);t.disp.style.display="";e.removeAttribute("isimgloading");if(b){var g=f.domList.gifSpanBox;if(!g)return;var i=a.C("i");i.className="W_loading";g.appendChild(i);c.fire("showPicDis",{key:b,index:H,box:g,url:K,oid:O,duration:N});i.style.display="none";a.removeNode(i);i=null}a.custEvent.add(f,"tosmall",function(d,g){a.position(t.disp).t<a.scrollPos().top&&e.scrollIntoView();t.disp.style.display="none";t.prev.style.display="";f.destroy();b&&c.fire("hidePicDis",{key:b,index:g.index});return a.stopEvent()});a.custEvent.add(f,"rewritedata",function(b,c){var d=a.sizzle('[node-type="fl_pic_list"]',t.prev)[0],e=a.lib.kit.extra.actionData(d),f=decodeURIComponent(e.get("pic_objects"));f=f.split(",");var g=f.length,h=[],i=[],j=[],k=[];for(var l=0,m=g;l<m;l++){var n=f[l];n=n.split("|");if(n[3]==c.object_id){n[1]=c.isDel?"0":"1";n[2]=c.count}h.push(n[0]);i.push(n[1]);j.push(n[2]);k.push(n[3])}var o=[];for(var l=0,m=g;l<m;l++)o.push(h[l]+"|"+i[l]+"|"+j[l]+"|"+k[l]);e.set("pic_objects",encodeURIComponent(o.join(",")));var p=a.sizzle('[node-type="tobig"]',t.disp)[0],q=a.lib.kit.extra.actionData(p);q.set("pic_objects",encodeURIComponent(o.join(",")))})};if(d.video(!0)&&k&&m)Q(m);else{var R=a.C("img");R.onload=function(){R.onload=null;Q();if(v.relation!=1&&v.isPrivate==1&&H){var b=a.core.util.easyTemplate(f,v).toString(),c=a.builder(b).list.pic_vip[0],d=a.sizzle("[node-type='artwork_box']",w);d[0]&&d[0].appendChild(c)}v.relation==1?u(null,A):u(z,null)};var S=g.clear_picSrc&&decodeURIComponent(g.clear_picSrc)||a.lib.kit.extra.imageURL(F,{size:q});R.src=S}a.lib.kit.extra.feedControlHash()}},fl_vPay_M:function(b){var c=l.getFeedNode(b.el,j),d=a.sizzle('[node-type="fl_pic_list"]',c)[0];d.setAttribute("memberBtnClick","1");var e=b.data.uid,f=b.data.mid,g=location.protocol+"//vipclub.weibo.com/vmember/opendetail?vuid="+e+"&F=pic_"+f;window.open(g,"_blank");var h=s.getPDNodes(c);a.position(h.disp).t<a.scrollPos().top&&c.scrollIntoView();h.disp.style.display="none";h.prev.style.display="";h.disp.innerHTML=""}},u=function(b,c){var d=b||c;if(!!d){var e=a.foreach(d,function(c){var d=b?a.lib.kit.extra.imageURL(c,{size:q}):c;return d});a.lib.kit.extra.loadImageInBackground(e)}},v=function(b){var c=a.sizzle("[node-type=imagesBox]",j),d;while(d=c.shift())if(d.getBoundingClientRect().bottom>50&&d.getBoundingClientRect().top<a.winSize().height)break;if(d){var e=a.sizzle("[action-type=thumbItem]",d),f;if(e&&e.length){var g=b==="left"?"pop":"shift";while(f=e[g]())if(a.core.dom.hasClassName(f,"current"))break;if(f=e[g]()){a.core.evt.fireEvent(f,"click");return}}}},w=function(a){v("left")},x=function(a){v("right")},y=function(){k.add("fl_pics","click",t.fl_pics);k.add("fl_vPay_M","click",t.fl_vPay_M);a.hotKey.add(document.documentElement,["left"],w,{type:"keydown",disableInInput:!0});a.hotKey.add(document.documentElement,["right"],x,{type:"keydown",disableInInput:!0})},z=function(){y()};z();m.destroy=function(){b&&b.destroy&&b.destroy();k.destroy();k.remove("fl_pics","click",t.fl_pics);k.remove("fl_vPay_M","click",t.fl_vPay_M);a.hotKey.remove(document.documentElement,["left"],w,{type:"keydown",disableInInput:!0});a.hotKey.remove(document.documentElement,["right"],x,{type:"keydown",disableInInput:!0})};return m}}});
STK.register("conf.trans.map",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("getInternalInfo",{url:"//api.weibo.com/2/location/geocode/is_domestic.json",method:"get",varkey:"callback",requestMode:"jsonp"});return b});
STK.register("lib.map.map",function(a){var b="//js.t.sinajs.cn/t5/";if(!1)b=$CONFIG.jsPath;var c=b+"page/static/map/",d='<div class="W_layer" node-type="outer" style="display:none;position:absolute;z-index:500">\n\t\t  <div class="bg">\n\t\t\t\t<table border="0" cellspacing="0" cellpadding="0">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<div class="content">\n\t\t\t\t\t\t\t\t\t<div node-type="inner" class="map_box">\n\t\t\t\t\t\t\t\t\t\t<iframe node-type="iframe" frameborder="0" scrolling="no" src="about:blank;" style="width: 400px; height: 250px; border: 0pt none;" id="mini_map_panel"></iframe>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<a node-type="close" title="关闭" class="W_close" href="javascript:;"></a>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t</table>\n\t\t\t\t<div node-type="arrow" class="arrow arrow_b"></div>\n\t\t\t</div>\n\t\t</div>',e=function(){var b,e;return function(){var f=!1;if(!b){e=a.builder(d).list;b=a.ui.mod.layer(e.outer[0],{appendTo:null});var g=a.core.obj.sup(b,["show"]).show,h=e.close[0],i=e.outer[0],j=e.iframe[0],k=function(){b.hide()};a.addEvent(h,"click",k);b.refresh=function(){f=!1;return this};b.show=function(b,d){if(!b)a.log("common.map : node is no defined");else{if(f){g();return}d=a.parseParam({longitude:"",latitude:"",head:"",internal:"",addr:""},d);var e=d.internal==0?"g":"m";j.onload=j.onreadystatechange=function(){if(!f&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){g();j.onload=j.onreadystatechange=null;f=!0}};j.src=[c,e,"map.html?ver=",$CONFIG.version,"&",a.jsonToQuery(d)].join("")}};document.body.appendChild(i);b.destroy=function(){a.removeEvent(h,"click",k);a.removeNode(i);f=!1;return this}}return b}}();return e});
STK.register("lib.kit.extra.rects",function(a){var b=a.core.util.browser,c={},d=5,e=20,f={t:function(a,b){return a.t>b.h},b:function(a,b){return a.b>b.h},l:function(a,b){return a.l>b.w},r:function(a,b){return a.r>b.w}},g={domSize:function(b){var c=a.core.dom.getSize(b);return{w:Math.max(c.width,a.getStyle(b,"width").replace(/px|auto/gi,"")),h:Math.max(c.height,a.getStyle(b,"height").replace(/px|auto/gi,""))}},mouseXY:function(c){var d={x:c.pageX,y:c.pageY};if(b.IE6||b.IE7){var e=a.core.util.scrollPos();d.x=d.x+e.left;d.y=d.y+e.top}return d},getRows:function(a){var c=a.getClientRects();if(b.IE6||b.IE7){var d=[],e={},f;for(var g=0,h=c.length;g<h;g++){var i=c[g];e[i.top]||(e[i.top]=[]);e[i.top].push(i)}for(var j in e){var k=e[j],h=k.length,l=k[0];h>1&&(l.right=k[h-1].right);d.push(l)}c=d}return c},getTextRect:function(b,c){var d=a.parseParam({evt:""},c),e=a.core.util.scrollPos(),f;if(!b.getClientRects){var h=g.domSize(b);return{width:h.w,height:h.h,left:"",right:"",top:"",bottom:""}}var i={rows:g.getRows(b)},j=g.mouseXY(d.evt),k={x:j.x-e.left,y:j.y-e.top};for(var l=0,m=i.rows.length;l<m;l++){var n=i.rows[l];l==0&&(f=n);if(k.y>n.top&&k.y<n.bottom){f=n;break}}if(a.IE){var h=g.domSize(b);f=a.parseParam({width:h.w,height:h.h,left:"",right:"",top:"",bottom:""},f)}return f},getDistance:function(b,c){var d=a.core.util.winSize(),e=g.getTextRect(b,c);return{win:d,rect:e,w:e.width,h:e.height,t:e.top,l:e.left,r:d.width-e.right,b:d.height-e.bottom}},getSeat:function(b,c,d){var h=a.parseParam({distance:e,priority:"trbl"},d),i=g.getDistance(b,d),j=g.domSize(c);i.area="b";var k=h.priority.split("");for(var l=0,m=k.length;l<m;l++){var n=k[l];if(!f[n])throw'priority error, random use "tbrl" combination';if(f[n](i,j)){i.area=n;break}}return i},setArrow:function(b){var c=a.parseParam({evt:"",node:"",layer:"",arrow:"",priority:"trbl",css_t:"arrow arrow_b",css_r:"arrow arrow_l",css_b:"arrow arrow_t",css_l:"arrow arrow_r",offset:d,distance:e,followNode:!1,isFixed:!1,setArrowMiddle:!1},b);if(!c.node)throw"target node is undefined";if(!c.layer)throw"layer node is undefined";if(!c.arrow)throw"arrow node is undefined";var f=g.getSeat(c.node,c.layer,c),h=f.area,i=f.rect;c.arrow.className=c["css_"+h];c.arrow.style.cssText="";var j=g.domSize(c.layer),k=a.scrollPos();window.navigator.userAgent.indexOf("iPad")>-1&&window.navigator.userAgent.indexOf("Version/7.0")>-1&&(k.top=0);var l,m,n,o=a.winSize().width-20,p=a.winSize().height-20,q=j.w,r=j.h,s=0;if(c.setArrowMiddle){if(h=="t"||h=="b")s=parseInt(i.width/2)-d;if(h=="l"||h=="r")s=parseInt(i.height/2)-d}if(h=="t"||h=="b"){if(i.left+j.w>o){c.distance=-(o-(i.left+j.w));c.arrow.style.cssText="left:"+c.distance+"px;right:auto;"}if(i.left-c.distance<0){c.distance=c.followNode?0:i.left;c.arrow.style.cssText="left:"+c.distance+"px;right:auto;"}}if(h=="l"||h=="r"){if(i.top+j.h>p){c.distance=-(p-(i.top+j.h));c.arrow.style.cssText="top:"+c.distance+"px;bottom:auto;"}if(i.top-c.distance<0){c.distance=c.followNode?0:i.top;c.arrow.style.cssText="top:"+c.distance+"px;bottom:auto;"}}if(c.isFixed){a.setStyle(c.layer,"position","fixed");k.top=k.left=0}if(h=="t"||h=="b"){l=h=="t"?i.top+k.top-j.h-c.offset:i.bottom+k.top+c.offset;m=i.left+k.left-c.distance+s}else{l=i.top+k.top-c.distance+s;m=h=="r"?i.right+k.left+c.offset:i.left+k.left-j.w-c.offset}c.layer.style.top=l+"px";c.layer.style.left=m+"px";return h},setLevelCardArrow:function(b){var c=a.parseParam({evt:"",node:"",layer:"",arrow:"",priority:"trbl",css_t:"arrow arrow_b",css_r:"arrow arrow_l",css_b:"arrow arrow_t",css_l:"arrow arrow_r",offset:d,distance:e},b);if(!c.node)throw"target node is undefined";if(!c.layer)throw"layer node is undefined";if(!c.arrow)throw"arrow node is undefined";var f=g.getSeat(c.node,c.layer,c),h=f.area,i=f.rect;c.arrow.className=c["css_"+h];c.arrow.style.cssText="";var j=g.domSize(c.layer),k=a.scrollPos();window.navigator.userAgent.indexOf("iPad")>-1&&window.navigator.userAgent.indexOf("Version/7.0")>-1&&(k.top=0);var l,m,n,o=a.winSize().width,p=j.w;if(h=="t"||h=="b"){l=h=="t"?i.top+k.top-j.h-c.offset:i.bottom+k.top+c.offset;m=i.left+k.left-c.distance;n=i.right+k.left-p+c.distance;if(n>0&&m+p>o+k.left){m=n;c.arrow.style.cssText="right:30px;left:auto;"}}else{l=i.top+k.top-c.distance;m=h=="r"?i.right+k.left+c.offset:i.left+k.left-j.w-c.offset}c.layer.style.top=l+"px";c.layer.style.left=m+"px"},setLayer:function(b){var c=a.parseParam({evt:"",node:"",layer:"",priority:"btrl",offsetX:0,offsetY:0},b);if(!c.node)throw"target node is undefined";if(!c.layer)throw"layer node is undefined";var d=g.getSeat(c.node,c.layer,c),e=d.area,f=d.rect,h=g.domSize(c.layer),i=a.scrollPos();window.navigator.userAgent.indexOf("iPad")>-1&&window.navigator.userAgent.indexOf("Version/7.0")>-1&&(i.top=0);var j,k,l,m=a.winSize().width,n=h.w;if(e=="t"||e=="b"){j=e=="t"?f.top+i.top-h.h+c.offsetY:f.bottom+i.top-c.offsetY;k=f.left+i.left+c.offsetX;l=f.right+i.left-n+c.distance;l>0&&k+n>m+i.left&&(k=l)}else{j=f.top+i.top+c.offsetY;k=e=="r"?f.right+i.left-c.offsetX:f.left+i.left-h.w+c.offsetX}c.layer.style.top=j+"px";c.layer.style.left=k+"px"}};c.getTextRect=g.getTextRect;c.getDistance=g.getDistance;c.getSeat=g.getSeat;c.setArrow=g.setArrow;c.setLevelCardArrow=g.setLevelCardArrow;c.setLayer=g.setLayer;return c});
STK.register("lib.feed.plugins.map",function(a){return function(b){var c=b.utils;if(!b)a.log("map : need object of the baseFeedList Class");else{var d,e;b.getDEvent().add("feed_list_geo_info","click",function(b){var f=a.fixEvent(),g=b.el,h=b.data,i=h.geo;if(!i)a.log("map: feed_list_geo_info node geo is empty");else{var j=function(b){a.lib.dialog.ioError(b.code,b)},k=function(c){if(typeof c=="object"&&c.code==1){var k=c.data.geo.type,l=i.split(",");d||(d=a.lib.map.map());var m=a.builder(d.getBox()).list;m.outer=[d.getBox()];e!=g&&d&&d.refresh();d.show(g,{latitude:l[1],longitude:l[0],head:h.head,addr:h.title,internal:k});a.lib.kit.extra.rects.setArrow({evt:f,node:b.el,layer:m.outer[0],arrow:m.arrow[0]});e=g}else j()};a.conf.trans.map.request("getInternalInfo",{onComplete:k,onFail:j},{coordinates:i+",geo",source:"4526198296"});return c.preventDefault(b.evt)}});var f=function(b){if(!!e){var c=a.fixEvent(b).target;e!=c&&!a.contains(e,c)&&d&&d.hide()}};a.addEvent(document,"click",f);a.custEvent.add(d,"hide",function(){e=undefined});var g={destroy:function(){a.removeEvent(document,"click",f);a.custEvent.remove(d);d&&d.destroy()}};return g}}});
STK.register("lib.feed.plugins.like.commentLike",function(a){return function(b,c){var d={},e,f,g=1,h=a.conf.trans.feed.attitude,i=!1,j,k=1,l,m,n,o=function(){n=a.lib.kit.extra.language},p={TITLE:"#L{%s人赞过此评论}",MAIN:{LOADING:['<div class="quick_reply_list S_line1" node-type="diaContent">','<ul class="clearfix" node-type="commentLikeList">',"#L{正在加载...}","</ul>","</div>"].join("")}},q={moreLike:function(b){var c=b.el,d=b.data;h.getTrans("cmtLikeMore",{onSuccess:function(a){var b=a.data.like_counts||0,c=a.data.html;c=n(c);k=parseInt(a.data.page.totalpage);q.newDialog(b,c);q.dialogEvtInit()},onFail:function(b){a.lib.dialog.ioError(b.code,b)},onError:function(b){a.lib.dialog.ioError(b.code,b)}}).request(b.data)},setLoading:function(){l&&(l.innerHTML=n("#L{正在加载...}"))},newDialog:function(b,c){j&&j.destroy&&j.destroy();j=a.ui.dialog("likeDialog_"+a.getUniqueKey());j.setTitle(n(p.TITLE,b));j.setContent(c||"");j.show();j.setMiddle();j.setBeforeHideFn(q.beforeHide);l=a.sizzle("[node-type=commentLikeList]",j.getBox())[0]},getPageData:function(b,c){i=!0;q.setLoading();h.getTrans("cmtLikeMore",{onSuccess:function(a){var b=a.data.html;q.setContent(b);i=!1;c&&c()},onFail:function(b){a.lib.dialog.ioError(b.code,b);i=!1},onError:function(b){a.lib.dialog.ioError(b.code,b);i=!1}}).request(b)},listNextPage:function(a){if(!i){var b=a.data;q.getPageData(b)}},listPrevPage:function(a){if(!i){var b=a.data;q.getPageData(b)}},setContent:function(a){j&&j.setContent&&j.setContent(a)},beforeHide:function(){g=1;q.dialogEvtDestroy();i=!1},dialogEvtInit:function(){f=a.delegatedEvent(j.getBox());f.add("nextPageOfLike","click",q.listNextPage);f.add("prevPageOfLike","click",q.listPrevPage);f.add("like_del","click",c)},dialogEvtDestroy:function(){f&&f.destroy()}},r=function(){e=b;e.add("moreCommentLike","click",q.moreLike)},s=function(){o();r()};s();d.destroy=function(){e&&e.destroy();j&&j.destroy&&j.destroy();l=null;m=null};return d}});
STK.register("lib.feed.plugins.like.polymorphicLike",function(a){var b='<div class="W_layer W_layer_pop W_layer_attitude" node-type="outer" style="visibility:hidden;"><div class="content" action-type="content"><!--自定义区域--><div class="layer_attitude state1" node-type="attr_outer"><ul class="clearfix"><li action-type="attr_item" action-data="qid=sad&floating=1" class=""><div class="W_ani_att W_ani_att_sad"></div><span class="att_pop">悲伤</span></li><li action-type="attr_item" action-data="qid=angry&floating=1" class=""><div class="W_ani_att W_ani_att_angry"></div><span class="att_pop">愤怒</span></li><li action-type="attr_item" action-data="qid=surprise&floating=1" class=""><div class="W_ani_att W_ani_att_surprised"></div><span class="att_pop">惊讶</span></li><li action-type="attr_item" action-data="qid=happy&floating=1" class=""><div class="W_ani_att W_ani_att_happy"></div><span class="att_pop">高兴</span></li><li action-type="attr_item" action-data="qid=heart&floating=1" class=""><div class="W_ani_att W_ani_att_like"></div><span class="att_pop">赞</span></li></ul><p node-type="attr_tip" style="display:none"><span class="att_pop">选择一个态度</span></p></div><!--/自定义区域--><div class="W_layer_arrow"><span node-type="arrow" class="W_arrow_bor W_arrow_bor_b"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div></div>',c='<span class="pos"><span class="line S_line1"><span node-type="like_status" class="WB_attitude"><i class="W_icon {{likeStyle}}"></i><em>{{likeNum}}</em></span></span></span>',d='<span class="pos"><span class="line S_line1"><span node-type="like_status" class=""><em class="W_ficon ficon_praised S_txt2">ñ</em><em>{{likeNum}}</em></span></span></span>',e={heart:"icon_att_like",angry:"icon_att_angry",surprise:"icon_att_surprised",sad:"icon_att_sad",happy:"icon_att_happy"},f="赞",g='<div class="WB_empty"> <div class="WB_innerwrap"> <div class="empty_con clearfix"> <p class="text"><i class="W_loading"></i>正在加载，请稍候...</p> </div> </div> </div>',h='<div class="W_layer_tips" node-type="outer">    <div class="W_layer_close"><a href="javascript:void(0);" action-type="close" class="W_ficon ficon_close S_ficon">X</a></div>        <div class="content" action-type="content" style="width:180px">            <div class="txt">                <p>{{content}}</p>            </div>        </div>    <div class="W_layer_arrow"><span node-type="arrow" class="W_arrow_bor W_arrow_bor_t"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div>',i="试试将鼠标停在这里，选择态度",j="鼠标悬停更改表态，点击可以取消",k=a.core.dom.removeClassName,l=a.core.dom.addClassName,m=a.conf.trans.feed.attitude,n=a.core.util.storage,o=a.lib.kit.dom.parentElementBy;return function(p,q){var r=null,s=null,t=null,u=null,v,w=!1,x=null,y=null,z,A=!1,B=!1,C=!1,D=500,E={likeLayerShow:function(c){if(u){if(u.besideWhere==c&&x.outer.style.visibility=="")return;E.destroyLikeLyaerEvt();u.hide();u.destroy();u=null;x=null}u=a.ui.bubble(b,{clickBlankToHide:!0,stopClickPropagation:!0,autoRelease:!0,showWithAni:"",hideWithAni:""});u.besideWhere=c;var d=a.queryToJson(c.getAttribute("action-data")),e=5;d.cuslike&&d.cuslike==1&&(e=15);u.show().beside(c,{offsetX:0,offsetY:e});x=u.getDomList();E.bindLikeLayerEvt();v=setTimeout(function(){x&&x.outer&&(x.outer.style.visibility="")},800);if(A&&!C){C=!0;x.attr_tip.style.display=""}},likeLayerHide:function(){if(u){E.destroyLikeLyaerEvt();u.hide();u.destroy();u=null;x=null}},bindLikeLayerEvt:function(){u.on("content","mouseover",F.bubenter);u.on("content","mouseout",F.bubout);u.on("attr_item","mouseover",F.bubItemEnter);u.on("attr_item",a.lib.kit.touch.cantouch?"tap":"click",F.bubItemlclick)},destroyLikeLyaerEvt:function(){if(u&&u._){u.off("content","mouseover",F.bubenter);u.off("content","mouseout",F.bubout);u.off("attr_item","mouseover",F.bubItemEnter);u.off("attr_item",a.lib.kit.touch.cantouch?"tap":"click",F.bubItemlclick)}},hasNode:function(a,b){return a?a==document.body?!1:a==b?!0:E.hasNode(a.parentNode,b):!1},getLikeNum:function(b){var c=a.sizzle("[node-type=like_status]",b)[0],d=a.lib.kit.dom.children(c),e=d[1],f=e.innerText?e.innerText:e.textContent;return f},requestLike:function(b){m.getTrans("miniadd",{onSuccess:function(a){},onFail:function(c){b.el.isLiked>0?E.changeLikeNum(b.el,-1):E.changeLikeNum(b.el,-1);b.el.isLiked=b.el.isLiked-b.el.isLiked*2;a.lib.dialog.ioError(c.code,c)},onError:function(c){b.el.isLiked>0?E.changeLikeNum(b.el,-1):E.changeLikeNum(b.el,-1);b.el.isLiked=b.el.isLiked-b.el.isLiked*2;a.lib.dialog.ioError(c.code,c)}}).request(b.data)},changeLikeNum:function(b,c){var d=a.sizzle("[node-type=like_status]",b)[0],e=a.lib.kit.dom.children(d),g=e[1],h=g.innerText?g.innerText:g.textContent;if(!(h.indexOf("万")>0)){h=h==f?0:parseInt(h);g.innerHTML=h+c<=0?f:h+c}},isChildNode:function(a,b,c){return a==c||a==document.body?!1:a==b?!0:E.isChildNode(a.parentNode,b,c)},getLikeList:function(b,c){var d=a.core.dom.dir.parent(c.el,{expr:"[action-type=feed_list_item]",endpoint:r})[0],e=o(c.el,d,function(a){if(a.getAttribute("node-type")=="feed_list_forwardContent")return!0});if(!e){var f=a.sizzle("[node-type=feed_list_repeat]",d)[0];f.innerHTML=g;f.style.display="";var h=a.sizzle("[node-type=commentBox]",d)[0];h&&(h.style.display="none");m.getTrans("likelist",{onSuccess:function(a){f.innerHTML=a.data.html},onFail:function(b){a.lib.dialog.ioError(b.code,b)},onError:function(b){a.lib.dialog.ioError(b.code,b)}}).request(b||{})}},setPos:function(a,b,c){a.getBox().style.position="absolute";if(a.getState()){var d=a.getBox().parentNode,e=d&&a.getBox().nextSibling;a.setArrow("bottom").setAlignPos(b,c,{offset:{left:-1,top:-100}});e&&d.insertBefore(a.getBox(),e)}},showTip:function(b,c,d){y&&y.hide&&y.hide();y=a.ui.bubble(h.replace(/{{content}}/g,b),{clickBlankToHide:!0,stopClickPropagation:!0,autoRelease:!0,showWithAni:"fadeInDown:slow",hideWithAni:"fadeOutUp:slow"});setTimeout(function(){y.show().beside(c);y.on("hide",function(){z&&clearInterval(z)});y.on("close","click",function(){z&&clearInterval(z);y&&y.hide&&y.hide()});y.on("show",function(){z=setInterval(function(){E.setPos(y,c,d)},500);setTimeout(function(){z&&clearInterval(z);y&&y.hide&&y.hide()},3e3)});E.setPos(y,c,d)},3e3)},hideTip:function(){z&&clearInterval(z);y&&y.hide&&y.hide()}},F={like:function(b){b.el.isClick=!0;if(b.data.hide_multi_attitude=="1"){b.data.floating=0;q&&q.like&&q.like(b)}else{if(b.data.object_type==="comment"||b.data.object_id){b.data.floating=0;q&&q.like&&q.like(b);return}var c=a.sizzle("[node-type=like_status]",b.el)[0];b.data.floating=0;var e;b.el.isLiked?e=b.el.isLiked:a.sizzle("em.ficon_praised",b.el).length?e=0:e=2;if(!e||e==1||e==0||e==-1){b.data.qid="heart";q&&q.like&&q.like(b);e=e>0?-1:1;b.el.isLiked=e}else{if(e==2){e=-2;E.changeLikeNum(b.el,-1);var f=E.getLikeNum(b.el);b.el.innerHTML=d.replace(/{{likeNum}}/g,f)}else{e=2;E.changeLikeNum(b.el,1)}b.el.isLiked=e;E.requestLike(b)}e==-2&&(b.el.isLiked=0)}},likeenter:function(a){if(a.data.hide_multi_attitude!="1"){if(a.data.object_type==="comment"||a.data.object_id)return;v=setTimeout(function(){if(a.el.isClick)a.el.isClick=!1;else{E.hideTip();E.likeLayerShow(a.el);w=!0}},50)}},likeout:function(a){if(a.data.hide_multi_attitude!="1"){if(a.data.object_type==="comment"||a.data.object_id)return;v&&clearTimeout(v);x&&!E.hasNode(a.evt.toElement,a.el)&&!E.hasNode(a.evt.toElement,x.outer)&&(w=!1);setTimeout(function(){w||E.likeLayerHide()},D)}},bubenter:function(){w=!0},bubout:function(a){x&&!E.hasNode(a.evt.toElement,a.el)&&!E.hasNode(a.evt.toElement,x.outer)&&(w=!1);setTimeout(function(){w||E.likeLayerHide()},D)},bubItemEnter:function(b){var c=x.outer,d=a.sizzle("[action-type=attr_item]",c);x.attr_tip.style.display="none";for(var e in d)k(d[e],"curr");l(b.el,"curr");l(x.attr_outer,"state2")},bubItemlclick:function(b){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("like_click",b.data.qid=="heart"?"dianzan":b.data.qid);var d=a.queryToJson(u.besideWhere.getAttribute("action-data")),g={},h=u.besideWhere.isLiked?u.besideWhere.isLiked:0;u.besideWhere.innerHTML=c.replace(/{{likeStyle}}|{{likeNum}}/g,function(a){var c="";switch(a){case"{{likeStyle}}":c=e[b.data.qid];break;case"{{likeNum}}":if(h&&h>0){var d=E.getLikeNum(u.besideWhere);c=d}else{var d=E.getLikeNum(u.besideWhere);d.indexOf("万")>0?c=d:c=d==f?1:parseInt(d)+1}h=2}return c});u.besideWhere.isLiked=h;g=a.core.json.merge(g,b.data);d=a.core.json.merge(d,g);u.besideWhere.setAttribute("action-data",a.jsonToQuery(d));E.requestLike({data:d,el:u.besideWhere});if(A&&!B){B=!0;var i=a.core.dom.dir.parent(u.besideWhere,{expr:"li"})[0];E.showTip(j,u.besideWhere,i)}E.likeLayerHide()},more_like_statue:function(a){E.getLikeList(a.data,a)},feed_like_list_page:function(a){E.getLikeList(a.data,a)}},G=function(){A=parseInt(n.get("isFirstLogin"));var b=a.core.str.parseURL(location.href);if(b.host!="weibo.com")A=!1;else{var c=a.sizzle("[action-type=fl_like]",r)[0];if(!c){A=!1;return}var d=a.core.dom.dir.parent(c,{expr:"li"})[0];if(!A){n.set("isFirstLogin","1");A=!0;E.showTip(i,c,d)}else A=!1}},H=function(){s.add("fl_like",a.lib.kit.touch.cantouch?"tap":"click",F.like);s.add("more_like_statue","click",F.more_like_statue);s.add("feed_like_list_page","click",F.feed_like_list_page);setTimeout(function(){s.add("fl_like","mouseover",F.likeenter);s.add("fl_like","mouseout",F.likeout)},1e3)},I=function(){r=p.getNode();s=p.getDEvent();t=p.utils},J=function(){I();H();G()},K={start:J,destroy:function(){s.remove("fl_like",a.lib.kit.touch.cantouch?"tap":"click",F.like);s.remove("fl_like","mouseover",F.likeenter);s.remove("fl_like","mouseout",F.likeout);s.remove("more_like_statue","click",F.more_like_statue);s.remove("feed_like_list_page","click",F.feed_like_list_page)}};return K}});
STK.register("lib.feed.plugins.like.init",function(a){var b=a.lib.kit.extra.language,c=a.conf.trans.feed.attitude,d=a.lib.dialog.validateCode(),e=a.lib.dialog.tipAlert,f=a.lib.kit.dom.parentElementBy,g=1,h=!0,i=g?"":"icon_praised_bc",j=g?"":"icon_praised_b",k="wb_cusLike_"+$CONFIG.uid,l,m=function(){var a=document.body.style,b=a.WebkitAnimation!==undefined?"-webkit-":a.webkitAnimation!==undefined?"-webkit-":a.MozAnimation!==undefined?"-moz-":a.OAnimation!==undefined?"-o-":a.msAnimation!==undefined?"-ms-":a.animation!==undefined?"":!1;return!!b}();return function(m){function E(){var b=a.cookie.get(k),d=.25;b=="Y"?h=!0:b=="N"?h=!1:c.request("getCuslikeWhiteList",{onSuccess:function(b){if(b.code==1e5){h=!0;a.cookie.set(k,"Y",{expire:d})}},onError:function(){h=!1;a.cookie.set(k,"N",{expire:d})},onFail:function(){console.log("fail")}},{})}function D(b){b=b||window.event;var c=b.target||b.srcElement,d=w.getBox();if(d===c||a.contains(d,c))A();else{var e=y(c),f=w.lastTarget;w.lastTarget=e;if(f&&e&&f===e&&e.hoverData&&e.hoverCount){A(e);return}B();e&&C(e)}}function C(b){function d(){if(w.lastTarget===b&&b.hoverData){w.setContent('<div class="layer_emotion">'+b.hoverData+"</div>");if(a.sizzle("[uid]",w.getBox()).length===0){w.hide();return}A(b)}}if(b.hoverData!==!1)if(b.hoverData)d();else{var e=a.queryToJson(b.getAttribute("action-data")||"");b.hoverData=!1;c.request("cmtLike",{onSuccess:function(c){var e=a.builder(c.data.html).list.likeList[0];b.hoverCount=c.data.like_counts;t(e,b.hoverCount);b.hoverData=s(e);d()},onError:function(){delete b.hoverData},onFail:function(){delete b.hoverData}},a.core.json.merge({location:$CONFIG.location},e))}}function B(){z||w.getState()&&(z=setTimeout(function(){w.hide()},300))}function A(a){if(z){clearTimeout(z);z=null}w.getState()||w.show();a&&w.beside(a,{offsetY:5})}function y(b){if(!a.contains(n,b))return null;b.getAttribute("action-type")!="fl_like"&&(b=a.core.dom.dir.parent(b,{expr:"[action-type=fl_like]",endpoint:n})[0]);if(b){var c=a.queryToJson(b.getAttribute("action-data")||"");if(c.object_type==="comment")return b}return null}function v(b,c){var d=b.hoverData,e=b.hoverCount;if(d){var f=a.builder(d).list.likeList[0],g=a.sizzle("li[uid="+c+"]",f)[0];if(g){a.removeNode(g);e--}t(f,e);b.hoverData=s(f);b.hoverCount=e}}function u(b,c,d){var e=b.hoverData,f=b.hoverCount;if(e){var g=a.builder(e).list.likeList[0];g.style.display="";var h=a.sizzle("li[uid="+c+"]",g)[0];if(h){a.removeNode(h);f--}a.insertHTML(g,d,"afterbegin");f++;t(g,f);b.hoverData=s(g);b.hoverCount=f}}function t(b,c){var d=a.sizzle("li[uid]",b),e=a.sizzle("li[node-type=faceMore]",b)[0],f=c===4?4:3;a.foreach(d,function(a,b){a.style.display=f>b?"":"none"});e&&(e.style.display=c>4?"":"none");b.style.width=(c>=4?4:c)*40+"px"}function s(b){var c=a.C("div"),d="";c.appendChild(b);d=c.innerHTML;c=null;return d}function r(g){function I(b){delete k.isRequest;a.lib.dialog.ioError(b.code,b)}function H(){k.likeStatus===undefined&&(y.liked?k.likeStatus=!!parseInt(y.liked):k.likeStatus=!!a.core.dom.hasClassName(z,"UI_ani_praised"));if(!D){D=a.C("em");a.insertAfter(D,B)}if(D.innerHTML.indexOf("万")>0)k.likeStatus=k.likeStatus?0:1;else{var c=F=D.innerHTML|0;F=Math.max(0,c+(k.likeStatus?-1:1));k.likeStatus=F>=c?1:0;var d=p==="miniadd"||"objLike"?b("#L{赞}"):"";D.innerHTML=F===0?d:F}}function G(b){k&&k.title&&(k.title=k.likeStatus?"取消赞":"赞");k.uninterruptedClick=!0;delete k.isRequest;k.inCallback=!b.data.is_del;if(m.object_type==="comment"){k.inCallback&&k.likeStatus?u(k,$CONFIG.uid,b.data.html):v(k,$CONFIG.uid);C(k)}a.conf.channel.like.fire(k.inCallback?"like":"unlike",y);if(w&&w.mark&&w.monitor_mask&&w.monitor_mask&524288){k.inCallback&&a.lib.kit.extra.sendImage(x,{action_id:"14000098"});a.conf.trans.feed.feed.request("setADMonitor",{},{action_id:"14000098",monitor:a.foreach(x,function(a){return encodeURIComponent(a)}).join("|"),mark:w.mark})}delete k.uninterruptedClick}var k=g.el,m=g.data,o=g.data.cuslike;if(!k.animation){if(k.uninterruptedClick)return;var p=m.object_type==="comment"||m.object_id?"objLike":"miniadd",q=a.core.dom.dir.parent(k,{expr:"[action-type=feed_list_item]",endpoint:n})[0],r=a.sizzle("[node-type=templeLike_ani]",q)[0],s=f(k,q,function(a){if(a.getAttribute("node-type")=="feed_list_forwardContent")return!0}),t=a.queryToJson(q.getAttribute("data-fake")||"");if(t&&t.isFake==1&&t.mlevel&&t.mlevel&512){e(t);return}var w=a.queryToJson(q.getAttribute("data-mark")||""),x=function(a){var b=[];for(var c=0;c<a.attributes.length;c++)a.attributes[c].name.indexOf("data-mark-third-analysis")===0&&b.push(a.attributes[c].value);return b}(q),y=a.core.json.merge({location:$CONFIG.location},m);y=a.core.json.merge(a.lib.kit.extra.getDiss(q),y);y=a.core.json.merge(y,w);var z=a.sizzle("[node-type=like_status]",k)[0],A=a.lib.kit.dom.children(z),B=A[0],D=A[1],E=a.core.dom.hasClassName(B,"W_ficon"),F=D.innerText?D.innerText:D.textContent;H();if(E)if(k.likeStatus){o&&h&&r&&(r.style.display="");a.removeClassName(z,"UI_ani_praised");a.addClassName(z,"UI_ani_stepsV1");k.animation=setTimeout(function(){if(o&&h&&r){a.removeClassName(r.children[0],"UI_ani");a.addClassName(r.children[0],"UI_animated UI_speed_normal UI_ani_fadeOut")}a.removeClassName(z,"UI_ani_stepsV1");a.addClassName(z,"UI_ani_praised");setTimeout(function(){if(o&&h&&r){r.style.display="none";a.addClassName(r.children[0],"UI_ani");a.removeClassName(r.children[0],"UI_animated UI_speed_normal UI_ani_fadeOut")}delete k.animation},500)},900)}else a.removeClassName(z,"UI_ani_praised");else if(k.likeStatus){k.animation=!0;a.ui.effect(B,"bounce","200",function(){delete k.animation;a.removeClassName(B,j);a.addClassName(B,i)})}else{a.removeClassName(B,i);a.addClassName(B,j)}k.isRequest||(k.isRequest=setTimeout(function(){l=c.getTrans(p,{onComplete:function(a,b){var c={onSuccess:G,onError:I,requestAjax:l,param:y,onRelease:function(){clearTimeout(k.isRequest);delete k.isRequest}};d.validateIntercept(a,b,c)},onFail:I},y);l.request(y)},2e3))}}var n=m.getNode(),o=m.getDEvent(),p=m.utils,q=a.lib.feed.plugins.like.polymorphicLike(m,{like:r}),w=a.ui.bubble({showWithAni:!1,hideWithAni:!1,showWithSetWidth:!1});w.getDomList().inner.className="layer_emotion";w.getDomList().close.style.display="none";w.on("beforeShow",function(){w.getBox().style.pointerEvents="none"}).on("shown",function(){w.getBox().style.pointerEvents=""});var x=a.delegatedEvent(w.getDomList().inner),z;g?q.start():o.add("fl_like",a.lib.kit.touch.cantouch?"tap":"click",r);o.add("object_like",a.lib.kit.touch.cantouch?"tap":"click",r);o.add("forward_like",a.lib.kit.touch.cantouch?"tap":"click",r);a.addEvent(document.body,"mouseover",D);var F=a.lib.feed.plugins.like.commentLike(x,r);return{destroy:function(){o.remove("fl_like",a.lib.kit.touch.cantouch?"tap":"click",r);o.remove("object_like",a.lib.kit.touch.cantouch?"tap":"click",r);o.remove("forward_like",a.lib.kit.touch.cantouch?"tap":"click",r);a.removeEvent(document.body,"mouseover",D);F.destroy();w.destroy()}}}});
STK.register("lib.feed.plugins.deleteFeed",function(a){var b,c,d,e,f=a.conf.channel.feed,g=a.lib.kit.extra.language,h=a.core.util.templet,i=a.conf.trans.feed.feed,j={DERRORTEXT:g("#L{删除失败}！")},k=function(b,d){e=a.ui.tip("confirm",{showCallback:function(){setTimeout(function(){e.aniHide()},600)},hideCallback:function(){c=undefined;e&&e.destroy&&e.destroy();e=null},direct:"up",msg:b,type:"error"});e.setLayerXY(d);e.aniShow()},l=function(c,d,e,g){var h=b.getFeedNode(e,g);h.style.height=h.offsetHeight+"px";h.style.overflow="hidden";var i=a.tween(h,{duration:200,animationType:"easeoutcubic",end:function(){h.innerHTML="";a.removeNode(h);g=e=h=null;i.destroy();c.getFeedCount()<1&&window.location.reload()}}).play({height:0});f.fire("delete")};return function(f,h){if(!f)a.log("deleteFeed : need object of the baseFeedList Class");else{b=f.utils;var j=f.getNode(),k=f.getDEvent(),m={},n=a.core.obj.parseParam({trans:i},h),o={init:function(){o.bind()},bind:function(){f.getDEvent().add("feed_list_delete","click",o.requestDelete)},requestDelete:function(e){a.custEvent.fire(f,"clearTips","deleteFeed");var i=e.el,k=b.getMid(i,j);if(c!=k){c=k;var m=b.getFeedNode(i,j).getAttribute("feedtype"),o={okCallback:function(){n.trans.request("delete",{onSuccess:function(){h.isWeiboDetail==1?window.location.href="//weibo.com":l(f,k,i,j)},onFail:function(b){a.lib.dialog.ioError(b.code,b)},onError:function(b){a.lib.dialog.ioError(b.code,b)}},{mid:k})},hideCallback:function(){c=undefined}};m&&m=="top"?o.msg=[g("#L{此条微博为置顶状态}"),g("#L{确认要删除这条微博吗？}")]:e.data.del_top_article==="1"?o.msg=g("#L{确认要删除这条微博及文章吗？}"):o.msg=g("#L{确认要删除这条微博吗？}");var p=i;p=a.core.dom.neighbor(i).parent('[action-type="feed_list_item"]').child('[action-type="fl_menu"]').finish();d=a.ui.tipConfirm(o.msg).ok(o.okCallback).on("hide",o.hideCallback).beside(p);return b.preventDefault(e.evt)}},hideTip:function(a){d&&(a?d.hide():d.anihide())},destroy:function(){e&&e.destroy();d&&d.destroy();d=e=okCallback=o=m=null}};o.init();m.hideTip=o.hideTip;m.destroy=o.destroy;return m}}});
STK.register("conf.trans.feed.tag",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("feedTagList",{url:"/aj/mblog/tag/mytaglist",method:"post"});c("feedTagListHtml",{url:"/p/aj/v6/mblog/taglist",method:"get"});c("feedTagUpdate",{url:"/aj/v6/mblog/tag/updatetags",method:"post"});c("feedTagDel",{url:"/aj/mblog/tag/destroy",method:"post"});c("feedTagEdit",{url:"/aj/mblog/tag/update",method:"post"});return b});
STK.register("lib.feed.plugins.tag.addTag",function(a){var b=a.lib.kit.extra.language,c=b('<#et temp data><div node-type="tagOuter" class="layer_favor_addtags"><div class="form_table_s">\t<dl class="f_normal clearfix">\t\t<dt  class="f_tit" node-type="tagListTitle" style="">#L{我的标签}：</dt>\t\t<dd class="f_con"><div node-type="tagList" class="tags" style="display:none"></div><div node-type="pageList"></div></dd>\t</dl><div class="W_tips tips_warn clearfix"><p class="icon"><span class="W_icon icon_warnS"></span></p><p class="txt" node-type="tag_tip">#L{最多5个标签，用空格分隔}</p><p class="txt" style="display:none;" node-type="tagsInputTip">#L{每个标签仅限14个字符}</p><p class="close"></p></div><dl class="f_normal clearfix">\t\t<dt class="f_tit">#L{添加标签}：</dt>       <dd class="f_con"><div class="input_outer W_input_focus"><input type="text" class="W_input" node-type="tagsInput" value="${data.lastTags}"/></div></dd>\t</dl></div><div class="W_layer_btn S_bg1"><a node-type="tagSave" href="javascript:;" class="W_btn_a btn_34px">#L{确定}</a><a action-type="cancel" node-type="cancel" href="javascript:;" class="W_btn_b btn_34px">#L{取消}</a></div></div></#et>'),d=b("#L{每个标签仅限14个字符}"),e=b("#L{最多5个标签，用空格分隔}"),f=b("#L{当前微博已添满5个标签}"),g="W_btn_tag_cur",h=0,i,j=function(b,c,d){if(b)return c(b);var e=function(a){if(++h==3){h=0;c()}else j(b,c,a)};a.conf.trans.feed.tag.request("feedTagList",{onSuccess:function(a){h=0;c(a.data)},onFail:e,onError:e},d)};return function(h){var k={},l=1;i=a.parseParam({title:"",tipType:"",flag:"add",mid:"",lastTags:"",myTags:""},h);if(!i.mid)a.log("common.dialog.addTag: opts.mid is not defined!");else{var m=function(b){i=a.parseParam({title:"",tipType:"",flag:"add",mid:"",lastTags:"",myTags:""},b);/^(success|error)$/.test(i.tipType)?i.tipType=i.tipType=="success"?"succS":"errorS":i.tipType="succS";o.setTitle(i.title)},n=function(a){a=parseInt(a,10);var b=[];if(a>1){b.push('<div class="W_pages">');for(var c=1;c<=a;c++)b.push('<a class="'+(l==c?"page S_txt1 S_bg1":"page S_txt1")+'" href="javascript:void(0);" action-type="page" action-data="page='+c+'">'+c+"</a>");b.push("</div>")}return b.join("")};a.custEvent.define(k,["success","error","hide"]);var o=a.ui.dialog();o.setTitle(i.title);a.custEvent.add(o,"hide",function(){a.custEvent.fire(k,"hide")});/^(success|error)$/.test(i.tipType)?i.tipType=i.tipType=="success"?"succS":"errorS":i.tipType="succS";var p=a.builder(a.core.util.easyTemplate(c,{tipType:i.tipType,tipInfo:i.tipInfo,lastTags:i.lastTags}).toString()).list,q=p.tagOuter[0],r=p.tagsInputTip[0],s=p.tagsInput[0],t=p.tagListTitle[0],u=p.tagList[0],v=p.pageList[0],w=p.tagSave[0],x=p.tag_tip[0],y=function(b){var c=a.trim(b).split(/ +/);c=a.core.arr.clear(c);var d=b.charAt(b.length-1)==" ";c=a.unique(c);var e={isEndEmpty:d,value:c.join(" ")+(d?" ":"")};return e},z=function(){var b=y(s.value),c=b.value;if(c.length>0){r.style.display="none";x.style.display=""}else{r.style.display="";x.style.display="none"}var h=a.sizzle(">span",u);if(c==d)for(var i=0;i<h.length;i++){h[i]&&a.removeClassName(h[i],g);var j=a.sizzle("em",h[i]);j[0]&&(j[0].className="S_bg2_br");x.innerHTML=e}else{var k=a.trim(c).split(/ +/);k=k.slice(0,5);var l=k.length;for(var i=0;i<k.length;i++){k[i]||l--;k[i]=a.leftB(k[i],14)}k=" "+(s.value=k.join(" ")+(b.isEndEmpty?" ":""))+" ";if(l>=5)for(var i=0;i<h.length;i++){a.addClassName(h[i],g);var j=a.sizzle("em",h[i]);j[0]&&(j[0].className="S_bg1_br");x.innerHTML=f}else for(var i=0;i<h.length;i++){var m=h[i],n=m.getAttribute("action-data").replace(/^tagName=/,"");if((new RegExp(" "+n+" ")).test(k)){a.addClassName(m,g);var j=a.sizzle("em",h[i]);j[0]&&(j[0].className="S_bg1_br")}else{a.removeClassName(m,g);var j=a.sizzle("em",h[i]);j[0]&&(j[0].className="S_bg2_br");x.innerHTML=e}}}};s.value=i.lastTags?i.lastTags:d;var A=a.lib.kit.dom.smartInput(s,{notice:d,needLazyInput:!0,noticeClass:"W_input_default"});A.on("focus",function(){window.setTimeout(function(){if(s.value==""){r.style.display="";x.style.display="none"}},0)});A.on("blur",function(){setTimeout(function(){z&&z()},0)});a.custEvent.add(A,"lazyInput",z);var B=a.delegatedEvent(q);B.add("tagItem","click",function(b){if(!a.hasClassName(b.el,g)){var c=b.data,e=s.value;s.value==d&&(e="");s.value=e+" "+c.tagName;z()}});B.add("cancel","click",function(){o.hide()});B.add("page","click",function(a){l=parseInt(a.data.page,10);j(i.myTags,function(a){var b=a.tags,c=a.total_num,d=[];if(b){var e=b.split(/\ +/);for(var f=0;f<e.length;f++)d.push('<span class="W_btn_b W_btn_tag" action-type="tagItem" action-data="tagName='+e[f]+'"><span class="W_arrow_bor W_arrow_bor_l"><i class="S_line3"></i><em class="S_bg2_br"></em></span><a href="javascript:void(0);" class="S_txt1">'+e[f]+"</a></span>");var g=Math.ceil(parseInt(c,10)/50);if(f>0){t.style.display="";u.style.display=""}else{t.style.display="none";u.style.display="none"}d=d.join("");u.innerHTML=d;v.innerHTML=n(g);s.focus();z();o&&o.setMiddle()}},a.data)});var C=function(c,e){var f=s.value;s.value==d&&(f="");if(f!=""&&/[^a-zA-Z0-9\u4e00-\u9fa5\s\u3000\-_]+/.test(f))a.ui.alert(b('#L{微博标签仅支持中英文、数字、"_"或减号}'));else{var g=function(){o.hide();a.conf.trans.feed.tag.request("feedTagUpdate",{onSuccess:function(b){a.conf.channel.feed.fire("feedTagUpdate",{res:i.lastTags,now:b.data.tags,mid:c.mid});a.conf.channel.feed.fire("feedTagMoreUpdate",{res:i.lastTags,now:b.data.tags,mid:c.mid});a.custEvent.fire(k,"success",b);o.hide()},onFail:function(b){a.custEvent.fire(k,"error",b);a.lib.dialog.ioError(b.code,b);o.hide()},onError:function(b){a.custEvent.fire(k,"error",b);a.lib.dialog.ioError(b.code,b);o.hide()}},a.lib.kit.extra.getDiss({mid:c.mid,tags:f,from:"page",script_url:FM.getURL().path}))};g()}},D=function(a){var b,c;s.value=s.value.replace(/(.+)\s\1$/g,"$1 ");if(i.flag=="add"&&s.value==d){if(i.lastTags){b={mid:i.mid,tags:""};C(b,a)}o.hide()}else{var e=s.value==d?"":s.value;if(e==i.lastTags){o.hide();return}b={mid:i.mid,tags:e};C(b,a)}};a.hotKey.add(s,"enter",D);a.addEvent(w,"click",D);k.show=function(a){m(a);l=1;j(a.myTags,function(a){var b=a.tags,c=a.total_num,d=[];if(b){var e=b.split(/\ +/);for(var f=0;f<e.length;f++)d.push('<span class="W_btn_b W_btn_tag" action-type="tagItem" action-data="tagName='+e[f]+'"><span class="W_arrow_bor W_arrow_bor_l"><i class="S_line3"></i><em class="S_bg2_br"></em></span><a href="javascript:void(0);" class="S_txt1">'+e[f]+"</a></span>");var g=Math.ceil(parseInt(c,10)/50);if(f>0){t.style.display="";u.style.display=""}else{t.style.display="none";u.style.display="none"}d=d.join("");u.innerHTML=d;v.innerHTML=n(g);s.focus();z()}o.setMiddle()},{page:1});s.value=a.lastTags?a.lastTags:d;o.setContent(q);o.show();o.setMiddle()};k.hide=function(){o.hide()};k.destroy=function(){a.hotKey.remove(s,"enter",D);a.removeEvent(w,"click",D);a.custEvent.undefine(k);B.destroy();A.destroy();i=p=q=r=s=w=z=null};return k}}});
STK.register("lib.feed.plugins.tag.showAddTag",function(a){var b=a.lib.kit.extra.language;return function(c,d){var e={},f,g,h,i,j,k=function(b,c){if(!f){c.mid=b;f=a.lib.feed.plugins.tag.addTag(c);a.custEvent.add(f,"success",function(b,c){if(!g)a.log("addtag : there is not 'div[node-type=\"feed_list_tagList\"]' in the feed_item ");else{var d=c.data.tags;if(typeof d!="undefined"){if(d==""){j&&a.setStyle(j,"display","");g&&a.setStyle(g.parentNode,"display","none")}else{j&&a.setStyle(j,"display","none");g&&a.setStyle(g.parentNode,"display","")}h&&h.setAttribute("_tagList",d);i&&i.setAttribute("_tagList",d)}g.innerHTML=c.data.html}});a.custEvent.add(f,"hide",function(b,c){var d=c.data.tags,e=g;d==""&&(e=j);a.core.util.browser.IE6&&document.body.focus();(function(a){setTimeout(function(){a&&a.style.display!="none"&&a.focus();h=null;j=null;g=null},200)})(e)})}f.show(c)},l=function(c,e,f,l){var m=e,n=d.getFeedNode(f);g=a.sizzle('[node-type="feed_list_tagList"]',n)[0];h=a.sizzle('[node-type="feed_list_addTag"]',n)[0];j=a.sizzle('[node-type="feed_list_addtagDiv"]',n)[0];i=a.sizzle('[node-type="feed_list_editTag"]',n)[0];var o={};o.lastTags=m;m?o.title=b("#L{编辑标签}"):o.title=b("#L{添加标签}");var p=a.sizzle('[node-type="feed_list_content"]',n)[0];if(!p){a.log("addtag : there is not '[node-type=\"feed_list_content\"]' in the feed_item ");return d.preventDefault()}var q=a.sizzle(">em",p)[0],r=a.sizzle('dt[node-type="feed_list_forwardContent"]',n)[0];for(var s in l)o[s]=l[s];k(c,o)},m=function(){l(c.mid,c.taglist,c.el,c.data)};e.destroy=function(){if(f){a.custEvent.remove(f);f.destroy();f=null}j=g=null};m();return e}});
STK.register("lib.feed.plugins.tag.init",function(a){return function(b,c){var d=b.utils;if(!b)a.log("forward : need object of the baseFeedList Class");else{var e={},f;b.getDEvent().add("fl_addTag","click",function(b){f=a.lib.feed.plugins.tag.showAddTag({mid:d.getMid(b.el),taglist:b.el.getAttribute("_taglist"),el:b.el,data:b.data},d);return d.preventDefault()});e.showAddtag=a.lib.feed.plugins.tag.showAddTag;e.destroy=function(){f&&f.destroy&&f.destroy()};return e}}});
STK.register("conf.trans.feed.translate",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("translate",{url:"/aj/mblog/translation",method:"get"});return b});
STK.register("lib.feed.plugins.translate",function(a){var b=a.core.util.easyTemplate,c=a.lib.kit.extra.language,d=a.lib.kit.extra.toFeedText,e=a.lib.kit.extra.textareaUtils,f="#"+c("#L{我来翻译}")+"#",g=a.lib.feed.feedTemps.translateTEMP,h=300,i='<div class="WB_empty"> <div class="WB_innerwrap"> <div class="empty_con clearfix"> <p class="text"><i class="W_loading"></i>加载中</p></div></div></div>';return function(c){var e=c.getNode(),j=c.getDEvent(),k={},l={},m=[],n=function(b){var c={parent:"[node-type=feed_list_reason],[node-type=feed_list_content]",translate:"[node-type=feed_translate]"},d=a.core.dom.dir(b,{dir:"parent",expr:c.parent})[0],e=d?a.core.dom.dir(d,{dir:"next",expr:c.translate})[0]:null;return{parent:d,translate:e}},o=function(b,c){c=c||{};var d=c.callback||a.funcEmpty,e=c.text||"";l[b]={prev:e};l[b].translated?d(l[b].translated):a.conf.trans.feed.translate.request("translate",{onSuccess:function(a){var c=a.data;l[b]={prev:e,translated:c};d(c)},onError:function(a){var b=a.msg;b&&d(b)}},{text:encodeURIComponent(a.core.str.trim(e))})},p=function(a,b){if(a.type!="mouseout"&&a.type!="mouseover")return!1;var c=a.relatedTarget?a.relatedTarget:a.type=="mouseout"?a.toElement:a.fromElement;while(c&&c!=b)c=c.parentNode;return c!=b},q,r=function(b){clearTimeout(q);q=setTimeout(function(){var c=n(b.el),d=c.translate;d&&a.custEvent.fire(d,"hide")},h)},s=function(c){clearTimeout(q);q=setTimeout(function(){var e=c.data,f=c.el,j=n(c.el),k=j.translate;if(!k){var l={text:i,bymedata:a.jsonToQuery(c.data)},r=a.builder(b(g,l).toString()).list,s=r.translate_rs[0],k=r.feed_translate[0],t;while(t=m.shift())t.parentNode&&a.custEvent.fire(t,"hide");m.push(k);var u=function(a){a=a||window.event;p(a,k)&&clearTimeout(q)},v=function(b){b=b||window.event;if(p(b,k)){clearTimeout(q);q=setTimeout(function(){k&&a.custEvent.fire(k,"hide")},h)}},w=function(b){var c=b.obj;if(c){a.custEvent.remove(c,"hide",w);a.custEvent.undefine(c,"hide");a.removeEvent(c,"mouseout",v);a.removeEvent(c,"mouseover",u);a.ui.effect(c,"fadeOutUp","fast",function(){a.removeNode(c)})}};a.custEvent.define(k,"hide");a.custEvent.add(k,"hide",w);a.addEvent(k,"mouseout",v);a.addEvent(k,"mouseover",u);o(e.mid,{text:a.decodeHTML(d(j.parent.innerHTML)),callback:function(a){s.innerHTML=a}});a.insertAfter(k,j.parent);a.ui.effect(k,"fadeInDown","fast");try{window.SUDA&&SUDA.uaTrack&&SUDA.uaTrack("tblog_bowen_translate","click_translate")}catch(x){}}},h)},t=function(b){var c=a.core.dom.dir(b.el,{dir:"parent",expr:"[node-type=feed_translate]"})[0];c&&a.custEvent.fire(c,"hide")},u=function(b){var c=b.data,d=b.el,e=1,g={};g.mid=c.mid;g.forwardOpts={originNick:c.originNick,reason:f,uid:c.uid,origin:l[c.mid].prev,type:e,url:c.url};a.lib.forward.forwardDialog(g.mid,g.forwardOpts)},v=function(){j.add("feed_translate","mouseover",s);j.add("feed_translate","mouseout",r);j.add("feed_translate_close","click",t);j.add("feed_translate_by_me","click",u)},w=function(){var b;while(b=m.shift())b.parentNode&&a.custEvent.fire(b,"hide");j.add("feed_translate","mouseover",s);j.add("feed_translate","mouseout",r);j.remove("feed_translate_close","click",t);j.remove("feed_translate_by_me","click",u)};v();k.destroy=w;return k}});
STK.register("lib.feed.plugins.jumpurl",function(a){return function(b){function f(b,c){var d=b.getAttribute("data-mark")||"",e=a.queryToJson(d),f=function(a){var b=[];for(var c=0;c<a.attributes.length;c++)a.attributes[c].name.indexOf("data-mark-third-analysis")===0&&b.push(a.attributes[c].value);return b}(b);if(e.mark&&(!e.monitor_mask||e.monitor_mask&1024)){a.lib.kit.extra.sendImage(f,{action_id:c});a.conf.trans.feed.feed.request("setADMonitor",{},{action_id:c,monitor:a.foreach(f,function(a){return encodeURIComponent(a)}).join("|"),mark:e.mark})}}if(!b)a.log("quote : need object of the baseFeedList Class");else{var c=b.utils,d=b.getNode(),e=function(a,b){return a==b||a==document.body||!a?!1:a.tagName.toUpperCase()=="A"?!0:e(a.parentNode,b)},g=function(b){var c=b.evt,d=b.el,g=b.data,h=decodeURIComponent(g.url),i=g.target;if(!e(c.target,b.el)){i=="_blank"?window.open(h):location.href=h;if(!c.target.getAttribute("markad-data")&&!a.core.dom.dir.parent(c.target,{expr:"[markad-data]",endpoint:d})[0]){var j=a.core.dom.dir.parent(d,{expr:"[action-type=feed_list_item]"})[0];j&&j.getAttribute("data-mark")&&f(j,"25000001")}}},h=function(b){if(b.data.target_url)window.open(decodeURIComponent(b.data.target_url));else{var e=c.getMid(b.el,d);if(b.data.short_url){var g=b.data.short_url+"?mid="+e+"&uid="+$CONFIG.uid;window.open(g)}var h=a.core.dom.dir.parent(b.el,{expr:"[action-type=feed_list_item]"})[0];h&&h.getAttribute("data-mark")&&f(h,"25000001")}},i=b.getDEvent();i.add("fl_jumpurl","click",g);i.add("fl_objjumpurl","click",h);var j={};j.destroy=function(){i.destroy()};return j}}});
STK.register("lib.feed.plugins.updateTime",function(a){var b=function(){var b=a.lib.kit.extra.language,c=b("#L{月}"),d=b("#L{日}"),e=b("#L{今天}"),f=b("#L{秒前}"),g=b("#L{分钟前}");return function(a,c){var d=a.getFullYear(),h=c.getFullYear(),i=a.getMonth()+1,j=c.getMonth()+1,k=a.getDate(),l=c.getDate(),m=a.getHours(),n=c.getHours(),o=c.getMinutes(),p=new Date;p.setTime(c.getTime()+288e5);var q=p.getUTCFullYear(),r=p.getUTCMonth()+1,s=p.getUTCDate(),t=p.getUTCHours(),u=p.getUTCMinutes();n<10&&(n="0"+n);t<10&&(t="0"+t);o<10&&(o="0"+o);u<10&&(u="0"+u);var v=a-c;v=v>0?v:0;v=v/1e3;if(d!=h)return q+"-"+r+"-"+s+" "+t+":"+u;if(i!=j||k!=l)return b("#L{%s月%s日 %s:%s}",r,s,t,u);if(m!=n&&v>3600)return e+" "+t+":"+u;if(v<51){v=v<1?1:v;return Math.floor((v-1)/10)+1+"0"+f}return Math.floor(v/60+1)+g}}(),c=typeof $CONFIG!="undefined"&&"timeDiff"in $CONFIG?$CONFIG.timeDiff:0;c=isNaN(c-1)?0:c;var d=function(d){var e=a.sizzle('a[node-type="feed_list_item_date"]',d),f=new Date;f.setTime(f.getTime()-c);var g;for(var h=0;h<e.length;h++){var i=e[h],j=i.getAttribute("date");if(!/^\s*\d+\s*$/.test(j))continue;var k=new Date;k.setTime(parseInt(j,10));i.innerHTML=b(f,k);g==undefined&&(g=f.getTime()-k.getTime()<6e4)}return g};return function(b){if(!b)a.log("updateTime : need object of the baseFeedList Class");else{var c=b.getNode(),e,f=function(a){clearTimeout(e);e=setTimeout(function(){d(c)?f(1e4):f(6e4)},a)},g=function(){f(1e4)};f(1e4);a.custEvent.add(b,"updateFeed",g);var h={destroy:function(){clearTimeout(e);a.custEvent.remove(b,"updateFeed",g);h=b=c=e=f=g=null}};return h}}});
STK.register("lib.feed.plugins.feedViews",function(a){return function(b){if(!b)a.log("images : need object of the baseFeedList Class");else{var c=b.getNode(),d=b.getDEvent(),e=a.conf.trans.feed.feed,f={},g={},h="",i,j,k,l,m=!1,n=!1,o=a.lib.kit.extra.language,p={showLayer:function(a,b){if(a&&b&&h!==b){k.setContent("");k.setContent(g[b]);h=b}l&&clearTimeout(l);l=null;k.show().setMiddle();!n&&i&&j&&window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack(i,j);n=!0},getTarget:function(a){return a?a==document.body?!1:a.getAttribute("action-type")=="fl_feed_views"?a:arguments.callee(a.parentNode):!1},hideLayer:function(){!l&&(l=setTimeout(function(){k.hide();n=!1},200))}},q={overViews:function(b){var c=b.data,d=c.uid,f=c.mid,h=b.el;if(g[f])p.showLayer(h,f);else{if(m)return;m=!0;e.request("feedViews",{onSuccess:function(b){var c=b.data;g[f]=c.html;var d=a.queryToJson(c.suda);i=d.key;j=d.value;p.showLayer(h,f);m=!1},onFail:function(b){m=!1;a.lib.dialog.ioError(b.code,b)},onError:function(b){m=!1;a.lib.dialog.ioError(b.code,b)}},{uid:d,mid:f})}},outViews:function(b){var c=a.fixEvent(b);c.target!=bubble.getBox()&&!a.contains(bubble.getBox(),c.target)&&bubble.hide()}},r=function(){d.add("fl_feed_views","click",q.overViews)},s=function(){k=a.ui.dialog({isHold:!0});k.setTitle(o("#L{微任务}"));r()};s();var t=function(){d.destroy()};f.destroy=t;return f}}});
STK.register("lib.dialog.popularizeLayer",function(a){return function(b){var c=a.lib.kit.extra.language,d=a.parseParam({src:"//promote.vip.weibo.com/promote",from:"promote_profile",isHold:!0,width:"460",height:"367",mid:"",title:c("#L{推广}"),succCallback:a.core.func.empty,failCallback:a.core.func.empty,from:"p_vip_pc_01 "},b||{}),e,f,g="//weibo.com",h=FM&&FM.getURL&&FM.getURL().href||window.location.href;h=encodeURIComponent(h);var i={},j=function(b){var c="popularizeLayer_"+a.getUniqueKey(),i=decodeURIComponent(d.src);i=i+(i.indexOf("?")>=0?"&":"?")+"from="+d.from+"&mid="+d.mid+"&rnd="+a.getUniqueKey()+"&ru="+g+"&failRu="+h;var j=a.builder('<iframe id="'+c+'" name="'+c+'" node-type="frame" width="'+d.width+'" height="'+d.height+'" allowtransparency="true" scrolling="yes" frameborder="0" ></iframe>');e.setTitle(d.title);e.setContent(j.box);e.show().setMiddle();e.setBeforeHideFn(function(){document.body.style.overflow=""});var k=a.E(c);setTimeout(function(){k.setAttribute("_src",i);f=a.lib.connect.iframe(k);f.on("setHeight",function(a,b,c,d){var f=c;if(!!f){f=(f|0)+"px";b.style.height!=f&&(b.style.height=f);e.setMiddle();d("callback")}})},200);k.attachEvent?k.attachEvent("onload",function(){k.height=d.height;e.setMiddle()}):k.onload=function(){k.height=d.height;e.setMiddle()}},k=function(){e=a.ui.dialog(d)},l=function(){f&&f.destroy&&f.destroy();e&&e.destroy&&e.destroy()};k();i.show=j;i.destroy=l;i.dialog=e;return i}});
STK.register("pl.base.source.widgetsource.publish",function(a){function d(b){function g(b){if(b.data.check_url){var c=decodeURIComponent(b.data.check_url).split("?");c=a.core.json.merge({api:c[0]},a.queryToJson(c[1]||""));e.request("proxy",{onSuccess:function(){h(b)},onError:function(b){a.lib.dialog.ioError(b.code,b)},onFail:function(b){a.lib.dialog.ioError(b.code,b)}},c)}else h(b)}var h=function(b){var g=b.data||{},h=b.el,i={title:g.title?decodeURIComponent(g.title):c("#L{分享}"),content:g.content?decodeURIComponent(g.content):"",extraUrl:g.extraUrl?decodeURIComponent(g.extraUrl):"",pid:g.pid,extraSend:g};if(d){try{d&&d.destroy&&d.destroy()}catch(j){}d=null}var k={};for(var l in g)l!="module"&&l!="title"&&l!="content"&&l!="spr"&&(k[l]=g[l]);k.forpub2000=1;e.getTrans("getpublish",{onSuccess:function(b){i.html=b.data.html;d=a.lib.publisher.publisherDialog(i);a.custEvent.add(d,"publishShare",function(){var b=a.sizzle('[node-type="shareCount"]',h)[0];if(b){var d=a.trim(b.innerHTML).match(/^.*\((\d+)\)$/);d=d?parseInt(d[1]):0;b.innerHTML=c("#L{分享}")+"&nbsp;&nbsp;("+ ++d+")"}});f(h,"widgetPublish",d);if(g.triggerClick){var e=a.sizzle(decodeURIComponent(g.triggerClick),d.dialog.getBox())[0];setTimeout(function(){e&&a.fireEvent(e,"click")},300)}},onError:function(b){a.lib.dialog.ioError(b.code,b)},onFail:function(){}}).request(k)};b&&b.add("widget_publish","click",g);var i=FM.getURL().query||"";if(a.queryToJson(i).withpublisher==1){var j=a.sizzle(['[action-type="widget_publish"].W_btn_a','[action-type="widget_publish"].W_btn_b','[action-type="widget_publish"].W_btn_c','[action-type="widget_publish"].W_btn_d'].join(","),a.E("plc_frame"));j[0]&&j[0].click()}var k={};k.publish=function(a){h(a);return d};k.destroy=function(){b&&b.remove("widget_publish","click",h);d&&d.destroy()};return k}var b=window.$CONFIG||{},c=a.lib.kit.extra.language,d,e=a.conf.trans.publisher,f=a.namespace().data;d.init=function(b){if(d){try{d&&d.destroy&&d.destroy()}catch(c){}d=null}return d=a.lib.publisher.publisherDialog(b)};return d});
STK.register("lib.feed.plugins.feedOnTop",function(a){function g(a,b){window.SUDA&&SUDA.uaTrack&&SUDA.uaTrack(a,b)}var b=a.lib.kit.extra.language,c=a.core.util.templet,d=a.conf.trans.feed.feed,e=!1,f={TIPCONFIRM:b('<table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td><div class="content layer_mini_info layer_mini_center">#{CONTENT}<p class="btn"><a node-type="ok" action-type="ok" class="W_btn_a" href="javascript:void(0)"><span class="btn_30px W_f14" suda-data="key=tblog_fstt&value=chick_top_yes" >#L{确定}</span></a><a node-type="cancel" action-type="cancel" class="W_btn_b" href="javascript:void(0)"><span class="btn_30px W_f14">#L{取消}</span></a></p></div></td></tr></tbody></table>'),TIPCONFIRMTRY:b('<table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td><div class="content layer_mini_info layer_mini_center">#{CONTENT}<p class="btn"><a node-type="ok" action-type="ok" class="W_btn_a" href="javascript:void(0)"><span class="btn_30px W_f14" suda-data="key=tblog_fstt&value=chick_top_yes">#L{试用}</span></a><a node-type="cancel" action-type="cancel" class="W_btn_b" href="javascript:void(0)"><span class="btn_30px W_f14">#L{取消}</span></a></p></div></td></tr></tbody></table>'),INVALIDTOP:b("#L{确认要取消这条微博置顶吗？}"),EXPIRED:b('<table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td><div class="content layer_mini_info layer_mini_center">#{CONTENT}<p class="btn"><a node-type="ok" action-type="ok" class="W_btn_a" href="//vip.weibo.com/paycenter?from=zdsygq" target="_blank"><span class="btn_30px W_f14"><em class=W_icon icon_member"></em>#L{开通会员}</span></a><a node-type="cancel" action-type="cancel" class="W_btn_b"><span class="btn_30px W_f14">#L{知道了}</span></a></p></div></td></tr></tbody></table>')};return function(c,h){if(!c)throw"feedOnTop : need object of the baseFeedList Class";var i=c.utils,j={},k=c.getNode(),l=c.getDEvent(),m={},n,o,p=function(){if($CONFIG.bigpipe=="true"){var b=FM.getURL(),c=a.queryToJson(b.query);c.pids=h.plNode.id;FM.iLoad(b.path+"?"+a.jsonToQuery(c))}else setTimeout(function(){window.location.reload()},200)},q={init:function(){q.bind()},bind:function(){l.add("fl_setToTop","click",q.requestSetTop);l.add("fl_invalidTop","click",q.requestInvalidTop)},hideAllTip:function(){if(o){o.destroy();o=null}},removeFeed:function(b,c){var d=i.getFeedNode(b,k);a.setStyle(d,"height",d.offsetHeight);a.setStyle(d,"overflow","hidden");var e=a.tween(d,{end:function(){d.innerHTML="";a.core.dom.removeNode(d);c&&c();e.destroy();e=d=undefined}}).play({height:0})},requestSetTop:function(c){var f=a.core.dom.dir.parent(c.el,{expr:"[action-type=feed_list_item]"})[0];f=f.getAttribute("mid");if(!e){e=!0;q.hideAllTip();m={mid:i.getMid(c.el,k),el:c.el};var j;h.isWeiboDetail?j=a.core.dom.neighbor(c.el).parent('[node-type="feed_list"]').child('[action-type="fl_menu"]').finish():j=a.core.dom.neighbor(c.el).parent('[action-type="feed_list_item"]').child('[action-type="fl_menu"]').finish();j.getAttribute("action-type")!="fl_menu"&&(j=c.el);d.request("memberTopFeed",{onComplete:function(d){e=!1;if(d.code=="100094")o=a.ui.tipConfirm(d.msg,{}).ok(function(){q.setTop(f)}).cancel(function(){o.destroy();o=null}).beside(j||c.el);else if(d.code=="100092")o=a.ui.tipConfirm(d.msg).ok(function(){q.setTop(f)}).cancel(function(){o.destroy();o=null}).beside(j||c.el);else if(d.code=="100095")a.ui.tipConfirm(d.msg).ok(b("#L{开通会员}"),function(){location.href="http://vip.weibo.com/paycenter?from=zdsygq"}).beside(j||c.el);else if(d.code=="100096")a.ui.tipConfirm(d.msg).ok(b("#L{立即购买}"),function(){location.href="http://pay.vip.weibo.com/vip/pay?uid="+$CONFIG.uid+"&productid=weibo_top&usetimes=1&from=profile&client=pc&return_url="+location.href}).beside(j||c.el);else if(d.code=="100093"){var g=a.ui.confirm([b("#L{置顶功能为微博会员专属特权 }"),b("#L{你已经试用过此功能了，开通微博会员后即可使用}")],{okText:b('<i class="W_icon icon_member"></i> #L{开通会员}'),cancelText:b("#L{知道了}"),OK:function(){window.open("http://vip.weibo.com/paycenter?from=zdsygq")}});g.getDomList().OK.className="W_btn_v"}else a.lib.dialog.ioError(d.code,d)}},{opttype:1,mid:m.mid});g("tblog_fstt","chick_top");return i.preventDefault(c.evt)}},setTop:function(e){q.hideAllTip();a.custEvent.fire(c,"clearTips");d.request("memberTopFeed",{onSuccess:function(c){if(a.trim(c.msg)=="")p();else if(c.data.verified==!1){var d=function(){setTimeout(function(){var c={data:{title:encodeURIComponent(b("#L{将你的置顶微博推荐给粉丝们吧O(∩_∩)O}")),content:encodeURIComponent(b("#L{我刚刚使用了微博会员特权，将一条精彩的微博置顶显示咯，快来我的个人主页瞧瞧吧！}")+"http://weibo.com/u/"+$CONFIG.uid),pid:"a1d3feabjw1eaqax0634kj20c80bcwfi"}};n=a.pl.base.source.widgetsource.publish().publish(c)},10);g("tblog_fstt","top_suc_share")},f=a.ui.confirm(b("#L{置顶成功。推广到首页让更多粉丝看见？}"),{icon:"succB",cancelText:b("#L{取消}"),okText:b("#L{推广}"),OK:function(){setTimeout(function(){var b=a.lib.dialog.popularizeLayer({mid:e,src:"//promote.vip.weibo.com/promote?from=zhiding_promote",width:"660",height:"553"});a.custEvent.add(b.dialog,"hide",function(){setTimeout(function(){if($CONFIG.bigpipe=="true"){var b=FM.getURL(),c=a.queryToJson(b.query);c.pids=h.plNode.id;FM.iLoad(b.path+"?"+a.jsonToQuery(c))}else setTimeout(function(){window.location.reload()},200)},200)});b.show()},10);g("tblog_fstt","top_suc_pop")}});$CONFIG.bigpipe=="true"&&p()}else p()},onFail:function(b){a.lib.dialog.ioError(b.code,b)},onError:function(c){c.code=="100095"?a.ui.confirm(c.msg,{icon:"warnB"}).ok(b("#L{开通会员}"),function(){location.href="http://vip.weibo.com/paycenter?from=zdsygq"}):c.code=="100096"?a.ui.confirm(c.msg,{icon:"warnB"}).ok(b("#L{立即购买}"),function(){location.href="http://pay.vip.weibo.com/vip/pay?uid="+$CONFIG.uid+"&productid=weibo_top&usetimes=1&from=profile&client=pc&return_url="+location.href}):a.lib.dialog.ioError(c.code,c)}},{opttype:2,mid:m.mid});$CONFIG.bigpipe=="true"&&p()},requestInvalidTop:function(b){q.hideAllTip();m={mid:i.getMid(b.el,k),el:b.el};var c=a.core.dom.neighbor(b.el).parent('[action-type="feed_list_item"]').child('[action-type="fl_menu"]').finish();c.getAttribute("action-type")!="fl_menu"&&(c=b.el);o=a.ui.tipConfirm(f.INVALIDTOP).ok(q.invalidTop).cancel(function(){o=null}).beside(c||b.el);return i.preventDefault(b.evt)},invalidTop:function(){a.custEvent.fire(c,"clearTips");d.request("memberTopFeed",{onSuccess:function(a){p()},onFail:function(){},onError:function(b){a.lib.dialog.ioError(b.code,b)}},{opttype:3,mid:m.mid})},destroy:function(){o&&o.destroy&&o.destroy();m=j=q=l=null}};q.init();j.destroy=q.destroy;return j}});
STK.register("conf.trans.feed.thirdExpand",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("Addtbcard",{url:"/Aj/Thirdinter/Addtbcard",method:"post"});return b});
STK.register("lib.feed.plugins.thirdExpand",function(a){return function(b){if(!b)a.log("thirdExpand : need object of the baseFeedList Class");else{var c=b.getNode(),d=b.getDEvent(),e=b.utils,f={},g=a.conf.trans.feed.thirdExpand,h={getPDNodes:function(b){return{prev:a.sizzle("[node-type=feed_list_media_prev]",b)[0],disp:a.sizzle("[node-type=feed_list_media_disp]",b)[0]}},getMid:function(b,c){return b.mid||(b.mid=a.lib.kit.dom.parentAttr(b,"mid",c))},getFeeds:function(b,c){return a.sizzle("["+c+"]",b)},getFeedNode:function(b,c){var d=h.getMid(b,c),e=h.getFeeds(c,'mid="'+d+'"');for(var f=1;f<e.length;f++)if(a.contains(e[f],b))return e[f];return e[0]},getActionData:function(a,b){return a.tagName.toLowerCase=="body"?null:a.getAttribute("node-type")==b?a.getAttribute("action-data"):arguments.callee(a.parentNode,b)},getActionNode:function(b,c){return a.sizzle('[node-type="'+c+'"]',b)},showActionNode:function(a,b){var c=h.getActionNode(a,b);for(var d=0;c[d];d++)c[d].style.display=""},hideActionNode:function(a,b){var c=h.getActionNode(a,b);for(var d=0;c[d];d++)c[d].style.display="none"},getItemIds:function(){}},i={fl_third_expand:function(a){var b=h.getFeedNode(a.el,c);h.showActionNode(b,"WB_card_hide");h.hideActionNode(b,"WB_card_show")},fl_third_pack:function(a){var b=h.getFeedNode(a.el,c);h.hideActionNode(b,"WB_card_hide");h.showActionNode(b,"WB_card_show")},fl_third_addtbcart:function(b){var d=b.data||{},e=h.getFeedNode(b.el,c),f=h.getPDNodes(e).prev,i=a.sizzle("li",f),j=[];for(var k=0;i[k];k++){var l=i[k].getAttribute("action-data")||"",m=a.queryToJson(l);m&&m.item_id&&j.push(m.item_id)}d.item_id=j.join(",");g.getTrans("Addtbcard",{onSuccess:function(c){if(c.data.html){var d=a.builder(c.data.html).box;a.replaceNode(d,b.el)}},onFail:function(b){a.ui.alert(b.msg)},onError:function(b){a.ui.alert(b.msg)}}).request(d)}},j=function(){d.add("fl_third_expand","click",i.fl_third_expand);d.add("fl_third_pack","click",i.fl_third_pack);d.add("fl_third_addtbcart","click",i.fl_third_addtbcart)},k=function(){j()};k();var l=function(){d&&d.destroy&&d.destroy()};f.destroy=l;return f}}});
STK.register("conf.trans.feed.feedShield",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("feedShield",{url:"/aj/user/block",method:"post"});c("activityDelete",{url:"/aj/activities/del",method:"post"});c("activityShield",{url:"/aj/activities/block",method:"post"});c("friendShied",{url:"/aj/mblog/friendsmblogshield?_wv=5",method:"post"});c("adShield",{url:"/aj/user/blockad",method:"post"});c("negative",{url:"/aj/mblog/negative",method:"post"});return b});
STK.register("lib.feed.plugins.rightmenu",function(a){var b=a.lib.kit.extra.language,c='<#et list data><li><a href="javascript:void(0)" action-type="fl_cuslike" action-data="praise_id=${data.id}" suda-uatrack="key=vip_background&value=feed_background_click" title="用此个性赞">用此个性赞</a></li></#et>',d="wb_cusLike_"+$CONFIG.uid,e;return function(c,f){function q(){var b=a.cookie.get(d),c=.25;b?e=b=="Y"?!0:!1:a.conf.trans.feed.feed.request("getCuslikeWhiteList",{onFail:function(){},onError:function(){e=!1;a.cookie.set(d,"N",{expire:c})},onSuccess:function(b){if(b.code=="100000"){e=!0;a.cookie.set(d,"Y",{expire:c})}}})}if(!c)a.log("rightmenu : need object of the baseFeedList Class");else{var g,h={},i=c.getNode(),j=c.getDEvent(),k=c.utils,l,g,m=!1,n,o=function(b){var c=k.getFeedNode(b);n=a.sizzle('[node-type="templeLike_ani"]',c)[0];var d=a.sizzle('[node-type="fl_menu_right"]',c);return d[0]?d[0]:!1},p=function(a){return!a||a==document.body?!1:a.getAttribute&&a.getAttribute("action-type")=="fl_menu"?a:arguments.callee(a.parentNode)},r=function(a){g=o(a.el);s(a)},s=function(b){m=!1;l&&l!=g&&l.style.display!="none"&&~function(b){a.ui.effect(b,"fadeOutUp",100,function(){b.style.display="none";u(b)})}(l);var c=a.sizzle("ul>li",g);if(!c.length)a.ui.alert("你无操作下拉菜单中功能的权限",{icon:"rederrorB"});else{if(g.style.display=="none"){g.style.display="";a.ui.effect(g,"fadeInDown",100)}else a.ui.effect(g,"fadeOutUp",100,function(){g.style.display="none";u(g)});l=g;b.data&&b.data.mark&&a.conf.trans.feed.feedShield.request("adShield",{},b.data)}},t=function(b){var c=a.fixEvent();c.target.getAttribute("node-type")!=="fl_menu_see_more"&&!a.core.dom.dir.parent(c.target,{expr:"[node-type=fl_menu_see_more]"}).length&&!p(c.target)&&l&&l.style.display!="none"&&a.ui.effect(l,"fadeOutUp",100,function(){l.style.display="none";u(l)})},u=function(b){if(b){var c=a.sizzle("[node-type=fl_menu_see_more]",b)[0],d=a.sizzle("[node-type=hide]",b)[0];if(c&&d){c.style.display="";d.style.display="none"}}},v=function(b){if(b){var c=a.sizzle("[node-type=fl_menu_see_more]",b)[0],d=a.sizzle("[node-type=hide]",b)[0];if(c&&d){c.style.display="none";d.style.display=""}}},w=function(a){var b=o(a.el);v(b)},x=function(c){function d(){a.conf.trans.feed.feed.request("proxy",{onSuccess:function(d){a.ui.notice(d.msg||b("#L{请求成功}")).on("hidden",function(){d.data.refresh==1&&($CONFIG.bigpipe==="true"?FM.reload():location.reload())});a.foreach(a.lib.kit.dom.children(c.el.parentNode),function(a){a.style.display=a===c.el?"none":""})},onError:function(b){a.lib.dialog.ioError(b.code,b)},onFail:function(b){a.lib.dialog.ioError(b.code,b)}},c.data)}var e=c.el.getAttribute("msg");e?a.ui.confirm(c.el.getAttribute("msg")).ok(c.el.getAttribute("ok_txt"),d).cancel(c.el.getAttribute("cancel_txt")):d()},y=function(){j.add("fl_menu","click",r);j.add("fl_menu_see_more","click",w);j.add("feed_list_menu_btn","click",x);a.addEvent(document.body,"click",t)};y();var z=function(){j.remove("fl_menu","click",r);j.remove("fl_menu_see_more","click",w);j.remove("feed_list_menu_btn","click",x);a.removeEvent(document.body,"click",t)};return h}}});
STK.register("lib.feed.plugins.feedSet",function(a){var b=a.lib.kit.extra.language,c=a.conf.trans.feed.feed;return function(d,e){function n(b){var c=i.getFeedNode(b,g);c.style.height=c.offsetHeight+"px";c.style.overflow="hidden";var e=a.tween(c,{duration:200,animationType:"easeoutcubic",end:function(){c.innerHTML="";a.removeNode(c);g=b=c=null;e.destroy();d.getFeedCount()<1&&window.location.reload()}}).play({height:0})}var f={},g=d.getNode(),h=d.getDEvent(),i=d.utils,j,k={okCallback:function(){},hideCallback:function(){}},l=function(a){var c={PRIVATE:[b("#L{确定将此微博更改为仅自己可见吗}"),b("(#L{转换为自己可见微博后不可再次转为公开微博})")],FRIENDS:[b("#L{确定将此微博更改为仅好友圈可见吗}"),b("(#L{转换为好友圈微博后不可再次转为公开微博})")],VPLUS:[b("#L{确定将此微博更改为仅付费会员可见吗}"),b("(#L{转换为付费会员可见后不可再次转为公开微博})")]};return c[a]},m=function(a){return a==document.body?!1:a.getAttribute("id")?a.getAttribute("id"):arguments.callee(a.parentNode)},o={closeConfirmTip:function(b){var c=b.el,d=b._confirmTipParam,e=a.core.dom.neighbor(c).parent('[action-type="feed_list_item"]').child('[action-type="fl_menu"]').finish(),f=a.ui.tipConfirm(d.template).ok(d.okCallback).cancel(d.hideCallback).beside(e)},fl_friendVisible:function(b){var d=b.el,f=i.getMid(d,g),h=i.getFeedNode(d);b.data.mid=f;k.template=l("FRIENDS");k.okCallback=function(){c.getTrans("changeLevel",{onSuccess:function(b){if(e&&e.isWeiboDetail==!0)window.location.reload();else{var c=a.builder(b.data.html);a.core.dom.replaceNode(c.box,h)}},onError:function(b){a.lib.dialog.ioError(b.code,b)}}).request(b.data)};o.closeConfirmTip({el:d,_confirmTipParam:k})},fl_personalVisible:function(b){var d=b.el,f=i.getMid(d,g),h=i.getFeedNode(d);b.data.mid=f;k.template=l("PRIVATE");k.okCallback=function(){c.getTrans("changeLevel",{onSuccess:function(b){if(e&&e.isWeiboDetail==!0)window.location.reload();else{var c=a.builder(b.data.html);a.core.dom.replaceNode(c.box,h)}},onError:function(b){a.lib.dialog.ioError(b.code,b)}}).request(b.data)};o.closeConfirmTip({el:d,_confirmTipParam:k})},fl_feedset:function(d){var e={},f=i.getMid(d.el,g),h=i.getFeedNode(d.el);d.data.mid=f;d.data.type==1?e.template=b("#L{确定将此微博置顶吗？}"):d.data.type==2?e.template=b("#L{确定取消置顶？}"):d.data.type==3?e.template=[b("#L{确定隐藏该微博？}"),b("(#L{隐藏后该微博将不再显示，无法恢复})")]:e.template=b("#L{确定？}");e.okCallback=function(){c.getTrans("feedset",{onSuccess:function(b){var c=m(d.el),e=FM.getURL().href;e.replace("#"+FM.getURL().hash,"");e=e.indexOf("?")==-1?e+"?":e+"&";a.historyM.pushState(e+"pids="+c+"#"+c,{callChange:!0})},onError:function(b){a.lib.dialog.ioError(b.code,b)}}).request(d.data)};o.closeConfirmTip({el:d.el,_confirmTipParam:e})},fl_user_settings:function(b){var d={},e=i.getMid(b.el,g),f=i.getFeedNode(b.el);b.data.mid=e;d.msg=b.data.text;d.okCallback=function(){c.getTrans("accountset",{onSuccess:function(a){window.location.reload()},onError:function(b){a.lib.dialog.ioError(b.code,b)}}).request(b.data)};o.closeConfirmTip({el:b.el,_confirmTipParam:d})},proxy:function(d){var e={},f=i.getMid(d.el,g),h=i.getFeedNode(d.el);d.data.mid=f;e.template={4:b("#L{确定将此微博推荐给关注用户吗}？"),5:b("#L{确定将此微博推荐给关注用户吗}？")}[d.data.type||4];e.okCallback=function(){c.getTrans("proxy",{onSuccess:function(c){a.ui.tip("lite",{msg:b("#L{推荐成功}！"),type:"succ",timer:"500"})},onError:function(b){a.lib.dialog.ioError(b.code,b)}}).request(d.data)};o.closeConfirmTip({el:d.el,_confirmTipParam:e})},feed_set:function(d){var e={},f=i.getMid(d.el,g),h=i.getFeedNode(d.el);d.data.mid=f;e.template={1:b("#L{确定将此微博置顶吗？}"),2:b("#L{确定将此微博取消置顶吗？}"),3:b("#L{确定将此微博推荐给关注用户吗}？"),4:b("#L{确定屏蔽此微博吗}？"),5:b("#L{确定屏蔽}"+d.data.screen_name+"#L{的微博吗}？")}[d.data.msgtype||4];var j={1:b("#L{置顶成功}"),2:b("#L{取消置顶成功}"),3:b("#L{推荐成功}")}[d.data.msgtype||4],k="";d.data.msgtype==4?k=b("在此主页将自动屏蔽这条微博。可以在设置-内容管理中取消屏蔽。"):d.data.msgtype==5&&(k=b("该主页将自动屏蔽来自TA的微博。可以在设置-内容管理中取消屏蔽。"));d.data.is_top==1&&(k=b("#L{屏蔽后该微博的置顶状态会同时取消}"));switch(d.data.msgtype){case"1":case"2":case"3":e.okCallback=function(){c.getTrans("feedset_new",{onSuccess:function(b){a.ui.tip("lite",{msg:j,type:"succ",timer:"500"}).on("hide",function(){window.location.reload()})},onError:function(b){a.lib.dialog.ioError(b.code,b)}}).request(d.data)};o.closeConfirmTip({el:d.el,_confirmTipParam:e});break;case"4":case"5":a.ui.confirm([e.template,k]).ok(function(){c.getTrans("feedset_new",{onSuccess:function(a){n(d.el)},onError:function(b){a.lib.dialog.ioError(b.code,b)}}).request(d.data)})}},fl_VPlusVisible:function(b){var d=b.el,f=i.getMid(d,g),h=i.getFeedNode(d);b.data.mid=f;k.template=l("VPLUS");k.okCallback=function(){c.getTrans("changeLevel",{onSuccess:function(b){if(e&&e.isWeiboDetail==!0)window.location.reload();else{var c=a.builder(b.data.html);a.core.dom.replaceNode(c.box,h)}},onError:function(b){a.lib.dialog.ioError(b.code,b)}}).request(b.data)};o.closeConfirmTip({el:d,_confirmTipParam:k})}},p=function(){h.add("fl_friendVisible","click",o.fl_friendVisible);h.add("fl_personalVisible","click",o.fl_personalVisible);h.add("fl_VPlusVisible","click",o.fl_VPlusVisible);h.add("fl_feedset","click",o.fl_feedset);h.add("fl_user_settings","click",o.fl_user_settings);h.add("proxy","click",o.proxy);h.add("feed_set","click",o.feed_set)},q=function(){p()};q();f.destroy=function(){h.remove("fl_friendVisible","click",o.fl_friendVisible);h.remove("fl_personalVisible","click",o.fl_personalVisible);h.remove("fl_VPlusVisible","click",o.fl_VPlusVisible);h.remove("fl_feedset","click",o.fl_feedset);h.remove("fl_user_settings","click",o.fl_user_settings);h.remove("proxy","click",o.proxy);h.remove("feed_set","click",o.feed_set)};return f}});
STK.register("lib.dialog.popularizeEffect",function(a){var b=!1,c=a.lib.kit.extra.language;return function(d){var e=a.parseParam({mid:""},d||{}),f=a.ui.dialog({isHold:!0});f.setTop();var g=a.delegatedEvent(f.getBox()),h={},i=function(){if(!b){b=!0;f.setTitle(c("#L{推广}"));a.conf.trans.feed.feed.request("popularizeEffect",{onSuccess:function(c){f.setContent(c.data.html);f.show().setMiddle();var d=f.getBox(),e=a.sizzle('[action-type="widget_publish"]',d);a.addEvent(e[0],"click",k);b=!1},onFail:function(c){f.destroy();a.lib.dialog.ioError(c.code,c);b=!1},onError:function(c){f.destroy();a.lib.dialog.ioError(c.code,c);b=!1}},{mid:e.mid})}},j=function(b){if($CONFIG.islogin=="3")a.lib.dialog.loginLayer();else{f.destroy();var c=a.lib.dialog.popularizeLayer({mid:b.data.mid});c.show()}},k=function(a){setTimeout(function(){f.destroy()},1)};g.add("fl_pop","click",j);var l=function(){g.remove("fl_pop","click",j);f.destroy()};h.show=i;h.destroy=l;return h}});
STK.register("lib.feed.plugins.more",function(a){var b=a.lib.kit.extra.language;return function(c){var d=c.getDEvent(),e,f={},g,h,g,i,j,k,l={popularize:function(b){if($CONFIG.islogin=="3")a.lib.dialog.loginLayer();else{var c=b.data.mid||n(b.el);b.data.mid=c;b.data.src&&(b.data.src=decodeURIComponent(b.data.src));b.data.title&&(b.data.title=decodeURIComponent(b.data.title));j=a.lib.dialog.popularizeLayer(b.data);document.body.style.overflow="hidden";j.show()}},popularize_effect:function(b){var c=b.data.mid||n(b.el);k=a.lib.dialog.popularizeEffect({mid:c});k.show()},pop:function(a){a.data.width="660";a.data.height="553",a.data.title=b("#L{上头条，阅读量暴涨！}");l.popularize(a)}},m={more:function(b){if(g){a.removeEvent(g,"mouseover",m.layerOver);a.removeEvent(g,"mouseout",m.hide)}h&&p(h);clearTimeout(i);h=b.el;g=o(b.el);a.addEvent(g,"mouseover",m.layerOver);a.addEvent(g,"mouseout",m.hide)},hide:function(a){i=setTimeout(function(){p(h)},100)},layerOver:function(){clearTimeout(i)}},n=function(b){var c=a.core.dom.neighbor(b).parent('[action-type="feed_list_item"]').finish();return c.getAttribute("mid")},o=function(b){var c=a.core.dom.neighbor(b).parent('[action-type="feed_list_item"]').child('[node-type="fl_more_option_layer"]').finish();g=c;c.style.display="";a.addClassName(b,"W_arrow_turn");return c},p=function(b){var c=a.core.dom.neighbor(b).parent('[action-type="feed_list_item"]').child('[node-type="fl_more_option_layer"]').finish();c.style.display="none";a.removeClassName(b,"W_arrow_turn");return c},q=function(){},r=function(){d.add("fl_more_option","mouseover",m.more);d.add("fl_more_option","mouseout",m.hide);d.add("fl_pop","click",l.pop);d.add("fl_pop_effect","click",l.popularize);d.add("thrid_rend_iframe","click",l.popularize)},s=function(){q();r()};s();var t=function(){d.remove("fl_more_option","mouseover",m.more);d.remove("fl_more_option","mouseout",m.hide);d.remove("fl_pop","click",l.pop);d.remove("fl_pop_effect","click",l.popularize);d.remove("thrid_rend_iframe","click",l.popularize);j&&j.destroy&&j.destroy();k&&k.destroy&&k.destroy()};f.destroy=t;return f}});
STK.register("conf.trans.theme",function(a){var b=a.lib.kit.io.inter(),c=b.register,d=$CONFIG.domain;c("getskinSet",{url:"/aj/skin/getskinlist?pcate=1&isSuit=1",method:"get"});c("setskinSet",{url:"/aj/skin/updatesys",method:"post"});c("getskinTemplate",{url:"/aj/skin/getskinlist?pcate=0&isSuit=0",method:"get"});c("setskinTemplate",{url:"/aj/skin/updatesys",method:"post"});c("getskinCover",{url:"/aj/skin/getcoversystem",method:"get"});c("setskinCover",{url:"/aj/skin/setcoversystem",method:"post"});c("getskinCustom",{url:"/aj/skin/getcustom",method:"get"});c("setskinCustom",{url:"/aj/skin/updatecustom",method:"post"});c("setskinCoverCustom",{url:"/aj/skin/setcovercustom",method:"post"});c("getskinSet_page",{url:"/p/aj/v6/skin/getskinsystem?pcate=1&isSuit=1",method:"get"});c("setskinSet_page",{url:"/p/aj/v6/skin/setskinsystem",method:"post"});c("getskinTemplate_page",{url:"/p/aj/v6/skin/getskinsystem?pcate=0&isSuit=0",method:"get"});c("setskinTemplate_page",{url:"/p/aj/v6/skin/setskinsystem",method:"post"});c("getskinCover_page",{url:"/p/aj/v6/skin/getcoversystemlist",method:"get"});c("setskinCover_page",{url:"/p/aj/v6/skin/setcoversystem",method:"post"});c("getskinCustom_page",{url:"/p/aj/v6/skin/getskincustom",method:"get"});c("setskinCustom_page",{url:"/p/aj/v6/skin/setskincustom",method:"post"});c("getCardbg",{url:"/aj/cardbackground/list",method:"get"});c("setCardbg",{url:"/aj/cardbackground/update",method:"post"});c("setskinCoverCustom_page",{url:"/p/aj/v6/skin/setcovercustom",method:"post"});c("getskinSet_object",{url:"/p/aj/v6/skin/matter/getskinsystem?pcate=1&isSuit=1",method:"get"});c("setskinSet_object",{url:"/p/aj/v6/skin/matter/setskinsystem?domain="+d,method:"post"});c("getskinTemplate_object",{url:"/p/aj/v6/skin/matter/getskinsystem?pcate=0&isSuit=0",method:"get"});c("setskinTemplate_object",{url:"/p/aj/v6/skin/matter/setskinsystem?domain="+d,method:"post"});c("getskinCover_object",{url:"/p/aj/v6/skin/matter/getcoversystemlist",method:"get"});c("setskinCover_object",{url:"/p/aj/v6/skin/matter/setcoversystem?domain="+d,method:"post"});c("getskinCustom_object",{url:"/p/aj/v6/skin/matter/getskincustom",method:"get"});c("setskinCustom_object",{url:"/p/aj/v6/skin/matter/setskincustom?domain="+d,method:"post"});c("setskinCoverCustom_object",{url:"/p/aj/v6/skin/matter/setcovercustom?domain="+d,method:"post"});c("getCuslike",{url:"/aj/praise/list",method:"get"});c("setCuslike",{url:"/aj/praise/update",method:"post"});c("getCuslikeWhiteList",{url:"/aj/praise/userwhite",method:"post"});c("checkcardpriv",{url:"/aj/cardbackground/checkcardpriv",method:"post"});c("checkcuslikepriv",{url:"/aj/praise/Checkpraisepriv",method:"get"});return b});
STK.register("lib.feed.plugins.cardbg",function(a){var b=a.lib.kit.extra.language,c='<#et list data><div class="W_layer"><div class="content"><div class="W_layer_title" node-type="title">${data.title}</div><div class="W_layer_close"><a href="javascript:void(0)" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div><div class="layer_point"><dl class="point clearfix"><dt><span class="W_icon icon_warnB"></span></dt><dd><p class="S_txt1">${data.text}</p><p class="S_txt2">${data.desc}</p></dd></dl></div><div class="W_layer_btn S_bg1"><a href="javascript:void(0);" action-type="btn_l" class="W_btn_b btn_34px">${data.btn_l}</a><a href="javascript:void(0);" action-type="btn_r" class="W_btn_a btn_34px"><span><i class="W_icon icon_member"></i> ${data.btn_r}</span></a></div></div></div></#et>';return function(d){function j(b){a.conf.trans.theme.request("checkcardpriv",{onSuccess:i,onError:function(b){a.lib.dialog.ioError(b.code,b)},onFail:function(b){a.lib.dialog.ioError(b.code,b)}},b.data)}function i(c){var d=c.data;if(d.canuse!="1")d.enterprise=="1"?h(d):g();else{if(d.same=="1"){a.ui.confirm(b("#L{你当前正在使用此背景，去模板商城挑选更多卡片背景吧~}")).ok(b("#L{去看看}"),function(){window.open("//weibo.com?skinTab=4")});return}a.ui.confirm([b("#L{确定使用此卡片背景吗?}"),b('#L{此背景将展示在你微博的右上角，去<a target="_blank" href="//weibo.com?skinTab=4">模板商城</a>挑选更多卡片背景}')],{title:b("#L{我也要用卡片背景}")}).ok(function(){a.conf.trans.theme.request("setCardbg",{onSuccess:function(c){a.ui.notice(b("#L{保存成功!}")).on("hidden",function(){c.data.statusText&&a.lib.publisher.publisherDialog({content:c.data.statusText})})},onError:function(b){b.data&&b.data.noprivilege===!0?g():a.lib.dialog.ioError(b.code,b)},onFail:function(b){b.data&&b.data.noprivilege===!0?g():a.lib.dialog.ioError(b.code,b)}},{id:d.id})})}}function h(d){var e={title:b("#L{提示}"),text:b("#L{对不起，此背景目前仅支持 %s 品牌会员使用哦！}",d.entname),desc:b("#L{温馨提示：品牌会员将通过各企业活动进行不定期发放}"),btn_l:b("#L{我知道了}"),btn_r:b("#L{领取品牌会员}"),btn_l_cb:function(){g&&g.hide()},btn_r_cb:function(){window.open("//vip.weibo.com/brandvip?cardbgid="+d.id);g&&g.hide()}},f=a.core.util.easyTemplate(c,e).toString(),g=a.ui.dialog({template:f,autoRelease:!0}).on("btn_l","click",e.btn_l_cb).on("btn_r","click",e.btn_r_cb).show()}function g(){var d={title:b("#L{提示}"),text:b("#L{对不起，你还不是微博会员，此背景仅会员可用哦。}"),desc:b("#L{温馨提示：开通微博会员可免费使用全部背景。}"),btn_l:b("#L{我知道了}"),btn_r:b("#L{立即开通会员}"),btn_l_cb:function(){f&&f.hide()},btn_r_cb:function(){window.open("//pay.vip.weibo.com/vippay?from=cardbackground");f&&f.hide()}},e=a.core.util.easyTemplate(c,d).toString(),f=a.ui.dialog({template:e,autoRelease:!0}).on("btn_l","click",d.btn_l_cb).on("btn_r","click",d.btn_r_cb).show()}var e=d.getNode(),f=d.getDEvent();f.add("fl_cardCover","click",j);return{destroy:function(){f.remove("fl_cardCover","click",j)}}}});
STK.register("lib.feed.plugins.cuslike",function(a){var b=a.lib.kit.extra.language,c='<#et list data><div class="W_layer"><div class="content"><div class="W_layer_title" node-type="title">${data.title}</div><div class="W_layer_close"><a href="javascript:void(0)" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div><div class="layer_point"><dl class="point clearfix"><dt><span class="W_icon icon_warnB"></span></dt><dd><p class="S_txt1">${data.text}</p><p class="S_txt2">${data.desc}</p></dd></dl></div><div class="W_layer_btn S_bg1"><a href="javascript:void(0);" action-type="btn_l" class="W_btn_b btn_34px">${data.btn_l}</a><a href="javascript:void(0);" action-type="btn_r" class="W_btn_a btn_34px"><span><i class="W_icon icon_member"></i> ${data.btn_r}</span></a></div></div></div></#et>';return function(d){function i(b){a.conf.trans.theme.request("checkcuslikepriv",{onSuccess:h,onError:function(b){b.data&&b.data.noprivilege===!0?g():a.lib.dialog.ioError(b.code,b)},onFail:function(b){b.data&&b.data.noprivilege===!0?g():a.lib.dialog.ioError(b.code,b)}},b.data)}function h(c){var d=c.data;d.canuse!="1"?g():a.ui.confirm([b("#L{确定使用此个性赞吗?}"),b('#L{他人给你的博文点赞将展示该赞动效，去<a target="_blank" href="http://weibo.com?skinTab=5">个性赞商城</a>挑选更多个性赞}')],{title:b("#L{我也要用个性赞}")}).ok(function(){a.conf.trans.theme.request("setCuslike",{onSuccess:function(c){a.ui.notice(b("#L{保存成功!}")).on("hidden",function(){c.data.share_text&&a.lib.publisher.publisherDialog({content:c.data.share_text})})},onError:function(b){b.data&&b.data.noprivilege===!0?g():a.lib.dialog.ioError(b.code,b)},onFail:function(b){b.data&&b.data.noprivilege===!0?g():a.lib.dialog.ioError(b.code,b)}},{praise_id:d.id,from:"card"})})}function g(){var d={title:b("#L{提示}"),text:b("#L{对不起，你还不是微博会员，此个性赞仅会员可用哦。}"),desc:b("#L{温馨提示：开通微博会员可免费使用全部个性赞。}"),btn_l:b("#L{我知道了}"),btn_r:b("#L{立即开通会员}"),btn_l_cb:function(){f&&f.hide()},btn_r_cb:function(){window.open("http://pay.vip.weibo.com/vippay?from=p_like");f&&f.hide()}},e=a.core.util.easyTemplate(c,d).toString(),f=a.ui.dialog({template:e,autoRelease:!0}).on("btn_l","click",d.btn_l_cb).on("btn_r","click",d.btn_r_cb).show()}var e=d.getNode(),f=d.getDEvent();f.add("fl_cuslike","click",i);return{destroy:function(){f.remove("fl_cuslike","click",i)}}}});
STK.register("lib.feed.plugins.reEdit",function(a){var b=a.lib.kit.extra.language,c='<#et list data><div class="W_layer"><div class="content"><div class="W_layer_title" node-type="title">${data.title}</div><div class="W_layer_close"><a href="javascript:void(0)" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div><div class="layer_point"><dl class="point clearfix"><dt><span class="W_icon icon_warnB"></span></dt><dd><p class="S_txt1">${data.text}</p><p class="S_txt2">${data.desc}</p></dd></dl></div><div class="W_layer_btn S_bg1"><a href="javascript:void(0);" action-type="btn_l" class="W_btn_b btn_34px">${data.btn_l}</a><a href="javascript:void(0);" action-type="btn_r" class="W_btn_a btn_34px"><span><i class="W_icon icon_member"></i> ${data.btn_r}</span></a></div></div></div></#et>';return function(d){var e=d.getDEvent(),f,g={},h,i,j=a.lib.publisher.publisherDialog,k={show:function(b){if($CONFIG.islogin=="3")a.lib.dialog.loginLayer();else{var c=b.data.mid||l(b.el);b.data.mid=c;k.check(b)}},hide:function(a){},check:function(b){b.data.isReEdit=!0;var c=b.data.is_ori==1?k.success(b.data.mid):k.showForward(b);b.data.can_edit==1?a.conf.trans.publisher.request("getReEdit",{onSuccess:c,onError:k.error,onFail:function(a){}},{mid:b.data.mid}):a.conf.trans.publisher.request("checkeditable",{onSuccess:function(d){a.conf.trans.publisher.request("getReEdit",{onSuccess:c,onError:k.error,onFail:function(a){}},{mid:b.data.mid})},onError:k.error,onFail:function(a){}},{mid:b.data.mid})},success:function(c){return function(d){var e=d.data.html.replace('action-type="multiimage"','action-type="multiimage" node-type="multiimage" '),f={title:b("#L{编辑微博}"),trans:a.conf.trans.publisher,transName:"publisherReEdit",content:"",info:"",tid:"",extraSend:{},html:e,isPri:d.data.isPri||"0",pid:d.data.pic_id,isReEdit:!0,storage:!1,mid:c};publisher=j(f);setTimeout(function(){if(f.pid)var b=a.lib.publisher.widget.multiimage(publisher.editor,f)},200);spec.data&&publisher.addExtraInfo(a.jsonToQuery(spec.data))}},error:function(b){b.code==100010?k.showLimitNotice():a.lib.dialog.ioError(b.code,b)},showVipDialog:function(){var d={title:b("#L{提示}"),text:b("#L{已达到修改次数上限，开通会员可提高修改次数}"),btn_l:b("#L{以后再说}"),btn_r:b("#L{立即开通会员}"),btn_l_cb:function(){f&&f.hide()},btn_r_cb:function(){window.open("http://pay.vip.weibo.com/vippay?from=edit");f&&f.hide()}},e=a.core.util.easyTemplate(c,d).toString(),f=a.ui.dialog({template:e,autoRelease:!0}).on("btn_l","click",d.btn_l_cb).on("btn_r","click",d.btn_r_cb).show()},showLimitNotice:function(){a.ui.notice("已达到修改次数上限",{hideDelay:2e3,icon:"rederrorB"})},showForward:function(b){b.data.isReEdit=!0;return function(c){var d=b.el,e=b.data,f=a.core.dom.neighbor(b.el).parent('[action-type="feed_list_item"]').finish(),g=f.getAttribute("mid")||b.data.mid,h=a.lib.kit.extra.getDiss(f),i={},j=a.sizzle('[node-type="feed_list_content"]',f)[0];i.uid=e.uid?e.uid:"";i.uid=e.rootuid?e.rootuid:"";i.url=(e||"")&&e.url;i.dissDataFromFeed=h;if(!j){a.log("forward : there is not '[node-type=\"feed_list_content\"]' in the feed_item ");return a.preventDefault()}var k=a.sizzle('[node-type="feed_list_reason"]',j)[0];if(!k){var l=a.sizzle("[nick-name]",f);l.length&&(i.originNick=l[0].getAttribute("nick-name"));i.reason=j.innerHTML}else{i.originNick=a.sizzle('[node-type="feed_list_originNick"]',j)[0].getAttribute("nick-name")||"";i.reason=(k.innerHTML||"").replace(/[\r\n]+/g,"")}var m=a.sizzle('[node-type="feed_list_forwardContent"]',f)[0];if(m){i.forwardNick=e.name||i.originNick;i.originNick=a.sizzle('[node-type="feed_list_originNick"]',m)[0].getAttribute("nick-name");var n=a.sizzle('[node-type="feed_list_reason"]',m)[0];if(!n){a.log("forward : there is not 'em' node in the feed_list_forwardContent node ");return a.preventDefault()}i.origin=n.innerHTML}else{i.origin=i.reason;delete i.reason}for(var o in e)i[o]=e[o];var p=a.queryToJson(f.getAttribute("data-mark")||"");for(var q in p)i[q]=p[q];i.visible=c.data.visible;i.type=c.data.visible==0?1:c.data.visible==6?3:1;forwardDialog=a.lib.forward.forwardDialog(g,i);a.custEvent.add(forwardDialog,"forward",function(b,c){a.custEvent.remove(forwardDialog,"forward",arguments.callee)})}}},l=function(b){var c=a.core.dom.neighbor(b).parent('[action-type="feed_list_item"]').finish();return c.getAttribute("mid")},m=function(){},n=function(){e.add("fl_reEdit","click",k.show);e.add("fl_historicEdit","click",k.show)},o=function(){m();n()};o();var p=function(){e.remove("fl_reEdit","click",k.show);h&&h.destroy&&h.destroy();i&&i.destroy&&i.destroy()};g.destroy=p;return g}});
STK.register("lib.feed.plugins.historicRecord",function(a){var b=a.lib.kit.extra.language;return function(b){var c=b.getDEvent(),d=!1,e={},f,g,h,i,j={show:function(b){i=b.data.mid;a.conf.trans.publisher.request("getHistoricRecod",{onSuccess:j.showLayer,onError:j.error,onFail:j.error},{mid:b.data.mid,page:1,page_size:10})},hide:function(a){},error:function(a){d=!1},loadmore:function(b){if(!d){d=!0;var c=b.data;c.page++;a.conf.trans.publisher.request("getHistoricRecod",{onSuccess:j.loadmoreFeed,onError:j.error,onFail:function(a){d=!1}},{mid:i,page:c.page,page_size:10})}},loadmoreFeed:function(b){var c=a.builder(b.data.html);if(g&&h){a.removeNode(h);a.removeNode(feedListTip);feedListTip=c.list.feedList_Tip[0];g.appendChild(c.box)}if(c.list.loadingBar&&c.list.loadingBar[0]){h=c.list.loadingBar[0];g.appendChild(c.list.loadingBar[0])}d=!1},showLayer:function(b){var c=b.data.html,d='<div class="layer_feededitlist" node-type="feedList_record" ><div class="WB_feed WB_feed_v3" node-type="feedList_wrapper" action-type="feedList_wrapper">'+c+"</div></div>";f=a.ui.dialog();f.setTitle("编辑记录");f.setContent(d);f.setBeforeHideFn(function(){f._.dEvent.remove("loadingBar","click",j.loadmore)});g=f.getDomList(!0).feedList_wrapper;feedListTip=f.getDomList(!0).feedList_Tip;h=f.getDomList(!0).loadingBar;f.setMiddle();f.show();f._.dEvent.add("loadingBar","click",j.loadmore)}},k=function(b){var c=a.core.dom.neighbor(b).parent('[action-type="feed_list_item"]').finish();return c.getAttribute("mid")},l=function(){},m=function(){c.add("fl_historyEdit","click",j.show)},n=function(){l();m()};n();var o=function(){c.remove("fl_historyEdit","click",j.show);fansLayer&&fansLayer.destroy&&fansLayer.destroy();popLayer&&popLayer.destroy&&popLayer.destroy()};e.destroy=o;return e}});
STK.register("lib.feed.plugins.moreThan140",function(a){function n(a,c){var d='suda-data="key=original_blog_unfold&value=click_pickup:'+a+":"+c+'"';return b('<a href="javascript:void(0);" ignore="ignore" '+d+' class="WB_text_opt" action-type="fl_fold">#L{收起全文}<i class="W_ficon ficon_arrow_up">d</i></a>')}function g(){return[].join.call(arguments,",")}function f(a){return"[node-type="+d(a)+"]"}function e(a){return"[node-type="+a+"]"}function d(a){return a+"_full"}var b=a.lib.kit.extra.language,c=a.conf.trans.feed.feed,h="feed_list_content",i="feed_list_reason",j=e(h),k=e(i),l=f(h),m=f(i);return function(b){function o(){e.remove("fl_fold","click",i);e.remove("fl_unfold","click",h)}function i(b){a.preventDefault(b.evt);var c=b.el,d=a.core.dom.dir.parent(c,{expr:g(l,m),endpoint:f})[0];if(!!d){var e=a.core.dom.dir.prev(d,{expr:g(j,k)})[0];if(e){d.style.display="none";e.style.display="";if(e.getBoundingClientRect().bottom<70){var h=a.core.dom.dir.parent(e,{expr:"[action-type=feed_list_item]"})[0];h&&window.scrollTo(0,a.scrollPos().top+h.getBoundingClientRect().top-60)}}}}function h(b){a.preventDefault(b.evt);var e=b.el;if(e.loading!==!0){var h=a.core.dom.dir.parent(e,{expr:g(j,k),endpoint:f})[0];if(!h)return;var i=a.core.dom.dir.next(h,{expr:g(l,m)})[0];if(i){h.style.display="none";i.style.display="";return}e.loading=!0;c.request("fullText",{onSuccess:function(c){i=a.C("div");i.setAttribute("node-type",d(h.getAttribute("node-type")));i.className=h.className;i.innerHTML=c.data.html+n(b.data.mid,$CONFIG.uid);a.insertAfter(i,h);h.style.display="none";e.loading=undefined},onFail:function(b){a.lib.dialog.ioError(b.code,b);e.loading=undefined},onError:function(b){a.lib.dialog.ioError(b.code,b);e.loading=undefined}},b.data)}}var e=b.getDEvent(),f=b.getNode();e.add("fl_fold","click",i);e.add("fl_unfold","click",h);return{destroy:o}}});
STK.register("lib.feed.plugins.adTurnPlay",function(a){var b=a.lib.kit.dom.parseDOM,c=a.core.dom.addClassName,d=a.core.dom.removeClassName,e=a.core.dom.hasClassName,f=a.core.ani.tween;return function(g,h){if(!g)a.log("adTurnPlay : need object of the baseFeedList Class");else{var i=null,j=null,k=null,l={getFeedNodes:function(c){var d=k.getFeedNode(c),e=b(a.builder(d).list);return e},setAdClass:function(b,f){var g=a.sizzle(">.WB_feed_spec",f).length;if(f.adData<=1){if(!e(b,"WB_feed_spec_screen1")){d(b,"WB_feed_spec_screen2");d(b,"WB_feed_spec_screen3");c(b,"WB_feed_spec_screen1")}}else if(f.adData>=g){if(!e(b,"WB_feed_spec_screen3")){d(b,"WB_feed_spec_screen2");d(b,"WB_feed_spec_screen1");c(b,"WB_feed_spec_screen3")}}else if(!e(b,"WB_feed_spec_screen2")){d(b,"WB_feed_spec_screen3");d(b,"WB_feed_spec_screen1");c(b,"WB_feed_spec_screen2")}},movePic:function(b,c,d){var e=a.sizzle(">.WB_feed_spec",c).length,g=d.offsetWidth,h=0;"adData"in c||(c.adData=1);if(c.adData<=1&&b==1)c.adData=1;else{if(c.adData>=e&&b==-1){c.adData=e;return}var i=c.offsetWidth/e;if(c.adData<=2&&b==1)h=0;else if(c.adData>=e-1&&b==-1)h=b*i*(e-1)+(g-i);else{var j=b==1?c.adData-2:c.adData;h=-1*i*j+(g-i)/2}f(c,{animationType:"linear",duration:200,delay:3}).finish({left:h});c.adData-=b}}},m={ad_turnleft:function(a){var b=l.getFeedNodes(a.el),c=b.ad_turnpic_inner,d=b.ad_turnpic_outer;l.movePic(1,c,d);l.setAdClass(d,c)},ad_turnright:function(a){var b=l.getFeedNodes(a.el),c=b.ad_turnpic_inner,d=b.ad_turnpic_outer;l.movePic(-1,c,d);l.setAdClass(d,c)},ad_jump:function(a){var b=a.evt.target;if(b.nodeName!="A"||!b.getAttribute("href")){a.data&&a.data.href&&window.open(decodeURIComponent(a.data.href),"_blank");return!1}return!1}},n=function(){j.add("ad_turnleft","click",m.ad_turnleft);j.add("ad_turnright","click",m.ad_turnright);j.add("ad_jump","click",m.ad_jump)},o=function(){i=g.getNode();j=g.getDEvent();k=g.utils},p=function(){o();n()};p();var q={destroy:function(){j.remove("ad_turnleft","click",m.ad_turnleft);j.remove("ad_turnright","click",m.ad_turnright);j.remove("ad_href","click",m.ad_href);i=null;j=null;k=null}};return q}}});
STK.register("conf.trans.relation",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("cfinvite",{url:"/aj/invite/unread",method:"get"});c("followby",{url:"/aj/relation/followbyother",method:"get"});c("adds",{url:"/aj/relation/groupupdate",method:"post"});c("addmulti",{url:"/aj/f/group/update",method:"post"});c("addone",{url:"/aj/relation/groupupdate",method:"post"});c("removes",{url:"/aj/f/group/remove",method:"post"});c("unFollow",{url:"/aj/f/unfollow",method:"post"});c("remarkname",{url:"/aj/f/remarkname",method:"post"});c("addgroup",{url:"/aj/f/group/add",method:"post"});c("renameGroup",{url:"/aj/relation/rename",method:"post"});c("deletegroup",{url:"/aj/relation/delete",method:"post"});c("removecf",{url:"/aj/f/removeclosefriend",method:"post"});c("getLeftNavCount",{url:"/aj/relation/groupnums",method:"post"});c("getInviteList",{url:"/aj/invite/mailinvite",method:"post"});c("getInviteMessage",{url:"/aj/invite/mobileinvite",method:"post"});c("cleartrashfans",{url:"/aj/f/trash/cleartrashfans",method:"post"});c("deltrashfans",{url:"/aj/f/trash/deltrashfans",method:"post"});c("confirmfans",{url:"/aj/f/trash/confirmfans",method:"post"});c("recommendfollow",{url:"/aj/f/recomafterfollow",method:"get"});c("closerecommend",{url:"/aj/f/closerecommend",method:"get"});c("newuserguide",{url:"/aj/user/interest/newuserguide",method:"get"});c("mayinterested",{url:"/aj/user/interest/list",method:"get"});c("uninterested",{url:"/aj/user/interest/uninterested",method:"post"});c("userCard",{url:"/aj/user/cardv5",method:"get"});c("userCard2",{url:"//weibo.com/aj/user/newcard",method:"get",requestMode:"jsonp",varkey:"callback"});c("userCard2_abroad",{url:"//www.weibo.com/aj/user/newcard",method:"get",requestMode:"jsonp",varkey:"callback"});c("follow",{url:"/aj/f/followed",method:"post"});c("follow_register",{url:"/nguide/aj/relation/followed",method:"post"});c("unfollow_register",{url:"/nguide/aj/relation/unfollow",method:"post"});c("block",{url:"/aj/f/addblack",method:"post"});c("unBlock",{url:"/aj/f/delblack",method:"post"});c("removeFans",{url:"/aj/f/remove",method:"post"});c("requestFollow",{url:"/ajax/relation/requestfollow",method:"post"});c("questions",{url:"/aj/invite/attlimit",method:"get"});c("answer",{url:"/aj/invite/att",method:"post"});c("setRemark",{url:"/aj/f/remarkname",method:"post"});c("recommendusers",{url:"/aj/f/recommendusers",method:"get"});c("recommendAttUsers",{url:"/aj/f/worthfollowusers",method:"get"});c("recommendPopularUsers",{url:"/aj/user/interest/recommendpopularusers",method:"get"});c("mayinterestedweiqun",{url:"/aj/weiqun/getinterestedlist",method:"get"});c("moreData",{url:"/aj/f/listuserdetail",method:"get"});c("getInvite",{url:"/aj/invite/unread",method:"get"});c("quiet_addUser",{url:"/aj/f/addwhisper",method:"post"});c("quiet_removeUser",{url:"/aj/f/delwhisper",method:"post"});c("quiet_know",{url:"/aj/tipsbar/closetipsbar",method:"post"});c("groupUserList",{url:"/aj/f/group/getgroupmembers",method:"get"});c("groupSubmit",{url:"/aj/f/group/list",method:"get"});c("wqList",{url:"/aj/proxy?api=//recom.i.t.sina.com.cn/1/weiqun/weiqun_may_interest.php",method:"get"});c("uninterestedWq",{url:"/aj/proxy?api=//recom.i.t.sina.com.cn/1/weiqun/weiqun_uninterest.php",method:"get"});c("inviteNeglect",{url:"/aj/invite/handleinvite",method:"post"});c("checkNeglect",{url:"/aj/invite/shieldedlist",method:"post"});c("inviteLift",{url:"/aj/invite/lift",method:"post"});c("inviteAccept",{url:"/aj/invite/handleinvite",method:"post"});c("searchByTel",{url:"/aj/relation/getuserbymobile",method:"post"});c("inviteCloseTips",{url:"/aj/invite/closetips",method:"post"});c("checkrelation",{url:"/aj/f/checkrelation",method:"post"});c("addCloseFriend",{url:"/aj/f/createclosefriend",method:"post"});c("recommendCf",{url:"/aj/user/closefriend/recommend",method:"get"});c("clearInvalidUsers",{url:"/aj/f/clearinvalidfriends",method:"post"});c("unIstCf",{url:"/aj/user/closefriend/deny",method:"post"});c("fanslikemore",{url:"/aj/relation/fanslikemore",method:"get"});c("getProfileInfo",{url:"/aj/relation/getprofileinfo",method:"get"});c("interestlist",{url:"/aj/user/interest/profileinfo",method:"get"});c("recommendGroupMember",{url:"/aj/user/group/recommend",method:"get"});c("followGroup",{url:"/aj/f/group/followedgroup",method:"post"});c("recommendWholeGroup",{url:"/aj/relation/rename",method:"post"});c("recommendUserAdd",{url:"/aj/f/group/addrecommenduser",method:"post"});c("recommendUserRemove",{url:"/aj/f/group/remove",method:"post"});c("specialAttentionClose",{url:"/aj/limit/increment",method:"get"});c("friendShield",{url:"/aj/mblog/friendsmblogshield",method:"post"});c("friendRecover",{url:"/aj/mblog/friendsshieldrecover",method:"post"});c("rightmod_getCloseFriendRecommend",{url:"/aj/f/recomfriendsmore",method:"get"});c("unsubscribe",{url:"/aj/relation/unsubscribe",method:"post"});c("batch",{url:"/aj/f/group/batch",method:"post"});c("attention",{url:"/aj/relation/attention",method:"get"});c("recommend",{url:"/aj/f/group/recommend",method:"get"});c("interest_uninterested",{url:"/aj/relation/uninterested",method:"post"});c("clearTrash",{url:"/p/aj/relation/cleanfans",method:"post"});c("scanfans",{url:"/p/aj/relation/scanfans",method:"post"});c("getquiet",{url:"/aj/f/lenovo",method:"get"});c("interestUnFollow",{url:"/p/aj/relation/unfollow",method:"post"});c("removeGroup",{url:"/p/aj/groupchat/removeuser",method:"post"});c("reportGroup",{url:"/aj/groupchat/report",method:"post"});c("shieldGroup",{url:"/aj/groupchat/addblack",method:"post"});c("joinGroup",{url:"/p/aj/groupchat/applygroup",method:"post"});c("quietuserIgnore",{url:"/p/aj/relation/ignoreslientuser",method:"post"});c("addSpeical",{url:"/aj/f/group/addspecial",method:"post"});c("delSpecial",{url:"/aj/f/group/delspecial",method:"post"});return b});
STK.register("conf.trans.setRemark",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("setRemark",{url:"/aj/f/remarkname",method:"post"});c("setInterestRemark",{url:"/p/aj/relation/updatepageremark",method:"get"});return b});
STK.register("lib.dialog.setRemark",function(a){var b=a.lib.kit.extra.merge,c='<div class="W_layer" style="top:50px;left:550px;"><div class="content"><div class="W_layer_title" node-type="title">#L{设置备注名}</div><div class="W_layer_close"><a href="javascript:void(0);" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div><div class="layer_prompt" ><dl class="clearfix"><dt node-type="label">#L{备注名}:</dt><dd><input type="text" class="W_input W_input_default" node-type="input"></dd></dl></div><div class="W_layer_btn S_bg1"><a href="javascript:void(0);" action-type="ok" class="W_btn_a btn_34px">#L{确定}</a><a href="javascript:void(0)" action-type="close" class="W_btn_b btn_34px">#L{取消}</a></div></div></div>';return function(d){function o(a){return d.extraPostData?b(a,typeof d.extraPostData=="function"?d.extraPostData():d.extraPostData):a}var e=a.lib.kit.extra.language,f,g,h,i,j,k,l,m="",n={},p={init:function(){p.pars();p.build()},pars:function(){d=d||{};j=d.trans||a.conf.trans.setRemark;k=d.transName||"setRemark";f=d.uid;if(d.uid!=null){g=a.trim(d.remark||"");h=d.callback}},build:function(){i=a.ui.dialog(e(c)).show().on("ok","click",function(){m=a.trim(b.getValue());if(m===g){h&&h(g);i.hide()}else j.request(k,{onSuccess:function(a,b){h&&h(m);i.hide()}||a.funcEmpty,onError:function(b,c){a.lib.dialog.ioError(b.code,b,{beside:i.getDomList().input})},onFail:function(b,c){a.lib.dialog.ioError(b.code,b,{beside:i.getDomList().input})}},o({touid:f,remark:encodeURIComponent(m)}))});i.on("close","click",function(){i.hide()});var b=a.lib.kit.dom.smartInput(i.getDomList().input);b.setNotice(e("#L{请输入备注名}"));b.setValue(g||"");b.setMaxLength(30);b.restart();a.addEvent(b,"keydown",function(){b.value=a.leftB(b.value,30)});setTimeout(function(){b.setCursor({start:b.getValue().length,len:0})},0)},destroy:function(){i.destroy()}};p.init();n.destroy=p.destroy;return n}});
STK.register("lib.follow.followButton",function(a){function l(c,d,e){a.foreach(k,function(b){a.removeClassName(c,b)});a.foreach([].concat(d[1]),function(b){a.addClassName(c,b)});e===!1?c.innerHTML=b(d[0]):a.ui.badge(c,b(d[0]));c.setAttribute("action-type",d[2])}var b=a.lib.kit.extra.language,c=a.templet,d=a.conf.channel.follow,e=a.lib.kit.extra.merge,f=a.lib.kit.dom.hover,g=a.conf.trans.relation,h=a.lib.dialog.ioError,i={0:{temp_follow:['<em class="W_ficon ficon_right S_ficon">Y</em>#L{已关注}<em class="W_ficon ficon_arrow_down_lite S_ficon">g</em>',"W_btn_d","unFollow"],temp_followBoth:['<em class="W_ficon ficon_addtwo S_ficon">Z</em>#L{互相关注}<em class="W_ficon ficon_arrow_down_lite S_ficon">g</em>',"W_btn_d","unFollow"],temp_unfollow:['<em class="W_ficon ficon_add">+</em>#L{关注}',"W_btn_c","follow"],temp_unfollowFan:['<em class="W_ficon ficon_right S_ficon">Y</em><em class="W_vline S_line1"></em><em class="W_ficon ficon_add">+</em>#L{关注}',"W_btn_c","follow"],temp_block:["#L{解除黑名单}","W_btn_d","unBlock"],temp_loading:['<i class="W_loading"></i>#L{关注中}',"W_btn_c","noop"],temp_loading2:['<i class="W_loading"></i>#L{取消关注中}',"W_btn_d","noop"],temp_layer:['<div class="layer_menu_list_b" style="position:absolute;z-index:3000;"><div class="list_wrap"><div class="list_content W_f14"><ul class="list_ul"><li action-type="ok" class="item"><a href="javascript:void(0);" suda-data="key=tblog_profile_v6&value=cancel_atten" class="tlink S_txt1">#L{取消关注}</a></li><li class="item" action-type="setGroup"><a href="javascript:void(0);" suda-data="key=tblog_profile_v6&value=set_up_groups" class="tlink S_txt1">#L{设置分组}</a></li></ul></div></div>'],temp_layerOffset:{x:1,y:2,width:0}},1:{temp_follow:['<em class="W_ficon ficon_right">Y</em>#L{已关注}<em class="W_ficon ficon_arrow_down_lite">g</em>',"W_btn_b","unFollow"],temp_followBoth:['<em class="W_ficon ficon_addtwo">Z</em>#L{互相关注}<em class="W_ficon ficon_arrow_down_lite">g</em>',"W_btn_b","unFollow"],temp_unfollow:['<em class="W_ficon ficon_add">+</em>#L{关注}',"W_btn_b","follow"],temp_unfollowFan:['<em class="W_ficon ficon_right">Y</em><em class="W_vline S_line1"></em><em class="W_ficon ficon_add">+</em>#L{关注}',"W_btn_b","follow"],temp_block:["#L{解除黑名单}","W_btn_b","unBlock"],temp_loading:['<i class="W_loading"></i>#L{关注中}',"W_btn_b","noop"],temp_loading2:['<i class="W_loading"></i>#L{取消关注中}',"W_btn_b","noop"],temp_layer:['<div class="layer_menu_list" style="position:absolute;z-index:3000;"><ul><li action-type="ok"><a href="javascript:void(0);">#L{取消关注}</a></li><li action-type="setGroup"><a href="javascript:void(0);">#L{设置分组}</a></li></ul></div>']},2:{temp_follow:["#L{已关注}",["W_btn_b","W_btn_b W_btn_b_disable"],"noop"],temp_followBoth:["#L{已关注}",["W_btn_b","W_btn_b W_btn_b_disable"],"noop"],temp_unfollow:['<em class="W_ficon ficon_add">+</em>#L{关注}',"W_btn_b","follow"],temp_unfollowFan:['<em class="W_ficon ficon_add">+</em>#L{关注}',"W_btn_b","follow"],temp_block:["#L{解除黑名单}","W_btn_b","unBlock"],temp_loading:['<em class="W_ficon ficon_add">+</em>#L{关注}',"W_btn_b","noop"],temp_loading2:["#L{已关注}","W_btn_b",""],temp_layer:[""]},3:{temp_follow:['<em class="W_ficon ficon_right">Y</em>#L{已关注}',"W_btn_b W_btn_b_disable","noop"],temp_followBoth:['<em class="W_ficon ficon_right">Y</em>#L{已关注}',"W_btn_b W_btn_b_disable","noop"],temp_unfollow:['<em class="W_ficon ficon_add">+</em>#L{关注}',"W_btn_b","follow"],temp_unfollowFan:['<em class="W_ficon ficon_add">+</em>#L{关注}',"W_btn_b","follow"],temp_block:["#L{解除黑名单}","W_btn_b","unBlock"],temp_loading:['<i class="W_loading"></i>#L{关注中}',"W_btn_b","noop"],temp_loading2:['<i class="W_loading"></i>#L{取消关注中}',"W_btn_b","noop"],temp_layer:[""]},4:{temp_follow:['<em class="W_ficon ficon_right">Y</em>#L{已关注}<em class="W_ficon ficon_arrow_down_lite">g</em>',"W_btn_b","unFollow"],temp_followBoth:['<em class="W_ficon ficon_addtwo">Z</em>#L{互相关注}<em class="W_ficon ficon_arrow_down_lite">g</em>',"W_btn_b","unFollow"],temp_unfollow:['<em class="W_ficon ficon_add">+</em>#L{关注}',"W_btn_b","follow"],temp_unfollowFan:['<em class="W_ficon ficon_right">Y</em><em class="W_vline S_line1"></em><em class="W_ficon ficon_add">+</em>#L{关注}',"W_btn_c","follow"],temp_block:["#L{解除黑名单}","W_btn_b","unBlock"],temp_loading:['<i class="W_loading"></i>#L{关注中}',"W_btn_b","noop"],temp_loading2:['<i class="W_loading"></i>#L{取消关注中}',"W_btn_b","noop"],temp_layer:['<div class="layer_menu_list_b" style="position:absolute;z-index:3000;"><div class="list_wrap"><div class="list_content W_f14"><ul class="list_ul"><li action-type="ok" class="item"><a href="javascript:void(0);" suda-data="key=tblog_profile_v6&value=cancel_atten" class="tlink S_txt1">#L{取消关注}</a></li><li class="item" action-type="setGroup"><a href="javascript:void(0);" suda-data="key=tblog_profile_v6&value=set_up_groups" class="tlink S_txt1">#L{设置分组}</a></li></ul></div></div>','<div class="layer_menu_list_b" style="position:absolute;z-index:3000;"><div class="list_wrap"><div class="list_content W_f14"><ul class="list_ul"><li action-type="ok" class="item"><a href="javascript:void(0);" suda-data="key=tblog_profile_v6&value=cancel_atten" class="tlink S_txt1">#L{取消关注}</a></li></ul></div></div>'],temp_layerOffset:{x:1,y:2,width:0}},5:{temp_follow:["#L{已关注}",["W_btn_b","W_btn_b W_btn_b_disable"],"noop"],temp_followBoth:["#L{已关注}",["W_btn_b","W_btn_b W_btn_b_disable"],"noop"],temp_unfollow:['<em class="W_ficon icon_hongbao">+</em>#L{关注}',"W_btn_b","follow"],temp_unfollowFan:['<em class="W_ficon icon_hongbao">+</em>#L{关注}',"W_btn_b","follow"],temp_block:["#L{解除黑名单}","W_btn_b","unBlock"],temp_loading:["#L{关注中}","W_btn_b",""],temp_loading2:["#L{取消中}","W_btn_b",""],temp_layer:[""]},6:{temp_follow:['<em class="W_ficon ficon_right S_ficon">Y</em>#L{已关注}',"W_btn_d","noop"],temp_followBoth:['<em class="W_ficon ficon_addtwo S_ficon">Z</em>#L{互相关注}',"W_btn_d","noop"],temp_unfollow:['<em class="W_ficon ficon_add">+</em>#L{关注}',"W_btn_c","follow"],temp_unfollowFan:['<em class="W_ficon ficon_right S_ficon">Y</em><em class="W_vline S_line1"></em><em class="W_ficon ficon_add">+</em>#L{关注}',"W_btn_c","follow"],temp_block:["#L{解除黑名单}","W_btn_d","unBlock"],temp_loading:['<i class="W_loading"></i>#L{关注中}',"W_btn_c","noop"],temp_loading2:['<i class="W_loading"></i>#L{取消关注中}',"W_btn_d","noop"]},7:{temp_follow:['<em class="W_ficon ficon_right S_ficon">Y</em>#L{已关注}',"W_btn_d","unFollow"],temp_special:['<em class="W_ficon ficon_right S_ficon">Y</em>#L{特别关注}',"W_btn_d","unFollow"],temp_followBoth:['<em class="W_ficon ficon_addtwo S_ficon">Z</em>#L{互相关注}',"W_btn_d","unFollow"],temp_unfollow:['<em class="W_ficon ficon_add">+</em>#L{关注}',"W_btn_c","follow"],temp_unfollowFan:['<em class="W_ficon ficon_right S_ficon">Y</em><em class="W_vline S_line1"></em><em class="W_ficon ficon_add">+</em>#L{关注}',"W_btn_c","follow"],temp_block:["#L{解除黑名单}","W_btn_d","unBlock"],temp_loading:['<i class="W_loading"></i>#L{关注中}',"W_btn_c","noop"],temp_loading1:['<i class="W_loading"></i>#L{关注中}',"W_btn_d","noop"],temp_loading2:['<i class="W_loading"></i>#L{取消关注中}',"W_btn_d","noop"],temp_layer:['<div class="layer_menu_list_b" style="position:absolute;z-index:3000;"><div class="list_wrap"><div class="list_content W_f14"><ul class="list_ul"></li><li class="item" action-type="setGroup"><a href="javascript:void(0);" class="tlink S_txt1">#L{设置分组}</a></li><li class="item"><a href="javascript:void(0);" action-type="setRemark" action-data="remark=" class="tlink">#L{设置备注}</a></li><li action-type="ok" class="item"><a href="javascript:void(0);" class="tlink S_txt1">#L{取消关注}</a></li></ul></div></div>'],temp_layerS:['<div class="layer_menu_list_b" style="position:absolute;z-index:3000;"><div class="list_wrap"><div class="list_content W_f14"><ul class="list_ul"><li class="item" action-type="setSpecial" action-data="special=1"><a href="javascript:void(0);" class="tlink S_txt1">#L{设为特别关注}</a></li><li class="item" action-type="setGroup"><a href="javascript:void(0);" class="tlink S_txt1">#L{设置分组}</a></li><li class="item"><a href="javascript:void(0);" action-type="setRemark" action-data="remark=" class="tlink">#L{设置备注}</a></li><li action-type="ok" class="item"><a href="javascript:void(0);" class="tlink S_txt1">#L{取消关注}</a></li></ul></div></div>','<div class="layer_menu_list_b" style="position:absolute;z-index:3000;"><div class="list_wrap"><div class="list_content W_f14"><ul class="list_ul"><li class="item" action-type="setSpecial" action-data="special=0"><a href="javascript:void(0);" class="tlink S_txt1">#L{移出特别关注}</a></li><li class="item" action-type="setGroup"><a href="javascript:void(0);" class="tlink S_txt1">#L{设置分组}</a></li><li class="item"><a href="javascript:void(0);" action-type="setRemark" action-data="remark=" class="tlink">#L{设置备注}</a></li><li action-type="ok" class="item"><a href="javascript:void(0);" class="tlink S_txt1">#L{取消关注}</a></li></ul></div></div>'],temp_layerOffset:{x:1,y:2,width:0}},8:{temp_follow:['<em class="W_ficon ficon_right">Y</em>#L{已关注}',"W_btn_b","unFollow"],temp_special:['<em class="W_ficon ficon_right">Y</em>#L{特别关注}',"W_btn_b","unFollow"],temp_followBoth:['<em class="W_ficon ficon_addtwo">Z</em>#L{互相关注}',"W_btn_b","unFollow"],temp_unfollow:['<em class="W_ficon ficon_add">+</em>#L{关注}',"W_btn_b","follow"],temp_unfollowFan:['<em class="W_ficon ficon_right">Y</em><em class="W_vline S_line1"></em><em class="W_ficon ficon_add">+</em>#L{关注}',"W_btn_b","follow"],temp_block:["#L{解除黑名单}","W_btn_b","unBlock"],temp_loading:['<i class="W_loading"></i>#L{关注中}',"W_btn_b","noop"],temp_loading1:['<i class="W_loading"></i>#L{关注中}',"W_btn_b","noop"],temp_loading2:['<i class="W_loading"></i>#L{取消关注中}',"W_btn_b","noop"],temp_layer:['<div class="layer_menu_list" style="position:absolute;z-index:3000;"><ul></li><li action-type="setGroup"><a href="javascript:void(0);">#L{设置分组}</a></li><li action-type="setRemark"><a href="javascript:void(0);">#L{设置备注}</a></li><li action-type="ok"><a href="javascript:void(0);">#L{取消关注}</a></li></ul></div>'],temp_layerS:['<div class="layer_menu_list" style="position:absolute;z-index:3000;"><ul><li action-type="setSpecial" action-data="special=1"><a href="javascript:void(0);">#L{设为特别关注}</a></li><li action-type="setGroup"><a href="javascript:void(0);">#L{设置分组}</a></li><li action-type="setRemark"><a href="javascript:void(0);">#L{设置备注}</a></li><li action-type="ok"><a href="javascript:void(0);">#L{取消关注}</a></li></ul></div>','<div class="layer_menu_list" style="position:absolute;z-index:3000;"><ul><li action-type="setSpecial" action-data="special=0"><a href="javascript:void(0);">#L{移出特别关注}</a></li><li action-type="setGroup"><a href="javascript:void(0);">#L{设置分组}</a></li><li action-type="setRemark"><a href="javascript:void(0);">#L{设置备注}</a></li><li action-type="ok"><a href="javascript:void(0);">#L{取消关注}</a></li></ul></div>']}},j={profile_headerv6:{special:["wb_pc_profile","FolHover_SpeFol"],group:["wb_pc_profile","FolHover_SetGop"],remark:["wb_pc_profile","FolHover_SetAli"],unFollow:["wb_pc_profile","FolHover_RemFol"],delSpecial:["wb_pc_profile","SpeFolHover_RemSpeFol"]},single_weibo:{special:["weibo_pc_PostFollow","FolHover_SpeFol"],group:["weibo_pc_PostFollow","FolHover_SetGop"],remark:["weibo_pc_PostFollow","FolHover_SetAli"],unFollow:["weibo_pc_PostFollow","FolHover_RemFol"],delSpecial:["weibo_pc_PostFollow","SpeFolHover_RemSpeFol"]},hotfeed:{special:["weibo_pc_PostFollow_hot","FolHover_SpeFol"],group:["weibo_pc_PostFollow_hot","FolHover_SetGop"],remark:["weibo_pc_PostFollow_hot","FolHover_SetAli"],unFollow:["weibo_pc_PostFollow_hot","FolHover_RemFol"],delSpecial:["weibo_pc_PostFollow_hot","SpeFolHover_RemSpeFol"]},profile_card:{special:["V6newcard","FolHover_SpeFol"],group:["V6newcard","FolHover_SetGop"],remark:["V6newcard","FolHover_SetAli"],unFollow:["V6newcard","FolHover_RemFol"],delSpecial:["V6newcard","SpeFolHover_RemSpeFol"]},homefeed:{special:["weibo_pc_PostFollow_feed","FolHover_SpeFol"],group:["weibo_pc_PostFollow_feed","FolHover_SetGop"],remark:["weibo_pc_PostFollow_feed","FolHover_SetAli"],unFollow:["weibo_pc_PostFollow_feed","FolHover_RemFol"],delSpecial:["weibo_pc_PostFollow_feed","SpeFolHover_RemSpeFol"]}},k=["W_btn_a","W_btn_b","W_btn_c","W_btn_d","W_btn_a_disable","W_btn_b_disable","W_btn_c_disable","W_btn_d_disable"],m=function(a,b){if(a.type!="mouseout"&&a.type!="mouseover")return!1;var c=a.relatedTarget?a.relatedTarget:a.type=="mouseout"?a.toElement:a.fromElement;while(c&&c!=b)c=c.parentNode;return c!=b},n={getAttrData:function(b,c){if(!!b&&!!c){var d=b.getAttribute(c),e=d&&a.queryToJson(d)||!1;return e}},setAttrData:function(b,c,d){var e=this.getAttrData(b,c)||{};e=a.core.json.merge(e,d);b.setAttribute(c,a.jsonToQuery(e))},sendSuda:function(a,b){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack(a,b)}};return function(c){function u(a){return c.extraPostData?e(a,typeof c.extraPostData=="function"?c.extraPostData():c.extraPostData):a}var k={},c=a.parseParam({outer:null,outNodeExpr:'[node-type="followBtnBox"]',refer_sort:"",refer_flag:"",extraPostData:{},needSync:!1,followOpts:null},c),o,p=null,q=a.lib.follow.utils.follow(c.followOpts),r=a.lib.dialog.setGroup,s=a.ui.confirm,t=a.delegatedEvent(c.outer),v=function(b){return a.core.dom.dir.parent(b,{expr:c.outNodeExpr})[0]},w={"click:follow":function(b){a.preventDefault();var d=v(b.el);if(!!d){var e=b.el,f=a.queryToJson(d.getAttribute("action-data")||""),g=d.innerHTML,h,j=f.template||"0";f.onSuccessCb=function(b){var c=b.relation,g=c&&c.follow_me==1;l(p=e,i[j][g?"temp_followBoth":"temp_follow"]);a.custEvent.fire(k,"change",{state:"follow",data:a.core.json.merge(f,b),el:e});b.isrecommend==1&&b.wforce!=0&&a.custEvent.fire(k,"recommend",{state:"follow",data:b,el:d});b.tipMessage&&a.ui.tipAlert(b.tipMessage).beside(a.lib.kit.dom.firstChild(d));b.groupList=b.group;b.fromFollow=!0;if(!b.nogroup){o||(o=r());setTimeout(function(){o.show(b);a.custEvent.fire(k,"showDialog")},700)}};f.onFailCb=function(a){h&&(d.innerHTML=h)};f.onRelease=function(){d.innerHTML=g};setTimeout(function(){h=d.innerHTML;l(e,i[j].temp_loading,!1);f.refer_sort=f.refer_sort||c.refer_sort;f.refer_flag=f.refer_flag||c.refer_flag;f=u(f);if(f.proxy_api){f.api=f.proxy_api;delete f.proxy_api;a.lib.follow.utils.follow({transNameFollow:"proxy"}).follow(f)}else q.follow(f)},0)}},"mouseout:unFollow":function(b){a.preventDefault();if(!!m(b.evt,b.el)){var c=v(b.el);if(c){clearTimeout(c.t);c.t=null}}},"mouseover:unFollow":function(c){a.preventDefault();if(!!m(c.evt,c.el)){var e=v(c.el);if(!e)return;e.confirm||(e.t=setTimeout(function(){var m=c.el,s=a.queryToJson(e.getAttribute("action-data")||""),t=e.innerHTML,v=s.template||"0",w,x,y=s.refer_from,z=s.special_focus&&s.special_focus==1?"temp_layerS":"temp_layer";if(!!i[v][z]&&!!i[v][z][0]){s.onSuccessCb=function(b){var c=b.relation,d=c&&c.follow_me==1;l(p=m,i[v][d?"temp_unfollowFan":"temp_unfollow"]);a.custEvent.fire(k,"change",{state:"unfollow",data:b,el:m});b.isrecommend==1&&a.custEvent.fire(k,"recommend",{state:"unfollow",data:b,el:e})};s.onFailCb=function(a){w&&(e.innerHTML=w)};var A=function(){var a=y&&j[y]&&j[y].unFollow;a&&n.sendSuda(a[0],a[1]);w=e.innerHTML;l(m,i[v].temp_loading2,!1);s.refer_sort="";s=u(s);q.unFollow(s);e.hover.destroy();e.confirm.hide();setTimeout(function(){e.confirm.hide();e.confirm.destroy();e.confirm=null},100)},B=function(b){var c=a.core.util.browser.IE6?"width":"minWidth",d=i[v].temp_layerOffset?i[v].temp_layerOffset.width|0:0;b.style[c]=m.offsetWidth-(parseInt(a.getStyle(b,"padding-left"))||0)-(parseInt(a.getStyle(b,"padding-right"))||0)-(parseInt(a.getStyle(b,"border-left"))||0)-(parseInt(a.getStyle(b,"border-right"))||0)+d+"px"},C=function(c){var f=c.el,k=c.data,o=a.sizzle("em",m)[0];if(!!o){w=e.innerHTML;var q={uids:s.uid},r=y&&j[y]&&j[y][k.special==1?"special":"delSpecial"];r&&n.sendSuda(r[0],r[1]);var t=function(c){var g=a.sizzle("a",f)[0];g.innerHTML=k.special==1?"移出特别关注":"设为特别关注";var h=c.data.follow_data&&c.data.follow_data[s.uid]&&c.data.follow_data[s.uid].follow_me==1;l(m,i[v][h?"temp_followBoth":k.special==1?"temp_special":"temp_follow"],!1);k.special==1?a.ui.alert([b("#L{Ta发布的微博在信息流将置顶显示。}"),b("#L{<a href=%s>特别关注管理</a>}","//weibo.com"+decodeURIComponent(s.redirect_url))],{okText:b("#L{我知道了}"),icon:"succB"}):null;n.setAttrData(f,"action-data",{special:k.special==1?0:1});e.confirm.hide();s.isSpecial=k.special;s.lastBtn=p;s.both=h;d.fire("specialFollow",s)},u=function(a){h(a.code,a);w&&(e.innerHTML=w);e.confirm.hide();e.confirm.destroy();e.confirm=null};l(m,i[v][k.special==1?"temp_loading1":"temp_loading2"],!1);g.request(k.special==1?"addSpeical":"delSpecial",{onSuccess:t,onFail:u,onError:u},q)}},D=i[v][z][0];if(s.isinterest==="true"||s.special_focus==1&&s.is_special==1)D=i[v][z][1];e.confirm=a.ui.mlayer(D,{stopClickPropagation:!0}).on("ok","click",A).on("setGroup","click",function(){var b=y&&j[y]&&j[y].group;b&&n.sendSuda(b[0],b[1]);o||(o=r());o.show(s);e.confirm.hide();a.custEvent.fire(k,"showDialog")}).on("setRemark","click",function(b){var c=y&&j[y]&&j[y].remark;c&&n.sendSuda(c[0],c[1]);a.custEvent.fire(k,"setRemark",{data:a.core.json.merge(s,b.data),el:b.el})}).on("setSpecial","click",C);e.hover=f({act:m,extra:[e.confirm.getBox()],delay:200,isover:!0,onmouseover:function(){e.confirm&&!e.confirm.getState()&&B(e.confirm.show().beside(m,{pos:"bottom-left",offsetX:E,offsetY:F}).getBox())},onmouseout:function(){e.confirm&&e.confirm.hide&&e.confirm.hide();clearTimeout(x)}});var E=i[v].temp_layerOffset?i[v].temp_layerOffset.x|0:0,F=i[v].temp_layerOffset?i[v].temp_layerOffset.y|0:0;B(e.confirm.show().beside(m,{pos:"bottom-left",offsetX:E,offsetY:F}).getBox())}},200))}},"click:unBlock":function(c){var d=v(c.el);if(!!d){var e=c.el,f=a.queryToJson(d.getAttribute("action-data")||""),g=d.innerHTML,h=f.template||"0";f.onSuccessCb=function(){window.location.reload()};var i=function(){f=u(f);q.unBlock(f)};s(b("#L{确认将此用户从你的黑名单中移除吗？}"),{OK:i});a.custEvent.fire(k,"showDialog")}}},x=function(b){var d=b.uid,e=b.objectid,f=b.action.toLowerCase(),g=b.both,h=b.fan,j=a.sizzle(c.outNodeExpr,c.outer);for(var m=0,n=j.length;m<n;m++){var o=j[m],q=a.sizzle("[action-type=noop],[action-type=follow],[action-type=unFollow],[action-type=unBlock]",o)[0],r=a.queryToJson(o.getAttribute("action-data")),s=r.template||"0";if(p!=q)if(r.uid&&r.uid==d||r.objectid&&r.objectid==e){f=="unfollow"?l(q,i[s][h?"temp_unfollowFan":"temp_unfollow"],!1):f=="unblock"?l(q,i[s].temp_unfollow,!1):f=="follow"&&l(q,i[s][g?"temp_followBoth":"temp_follow"],!1);a.custEvent.fire(k,"changeStatus",{state:f,el:q,data:r})}}p=null},y=function(){a.custEvent.define(k,["change","showDialog","changeStatus","recommend","setRemark"]);a.foreach(w,function(a,b){b=b.split(":");t.add(b[1],b[0],a)});c.needSync&&d.register("changeStatus",x)},z=function(){if(c.outer){a.foreach(w,function(a,b){t.remove(b,"click",a)});t.destroy()}c.needSync&&d.remove("changeStatus",x)},A=function(){c.outer&&y()};A();k.renderBtn=function(a,b,c,d){return l(a,i[b][c],d)};k.destroy=z;return k}});
STK.register("lib.follow.recommendFollow",function(a){var b=a.lib.kit.extra.language,c=a.core.util.easyTemplate,d=a.core.ani.tween,e=a.conf.trans.follow,f=a.conf.channel.follow,g={profile:{jump:'suda-uatrack="key=wb_pc_profile&value=Click_RecCardJump"',down:'suda-uatrack="key=wb_pc_profile&value=atten_down"',up:'suda-uatrack="key=wb_pc_profile&value=atten_up"',close:'suda-uatrack="key=wb_pc_profile&value=atten_close"',right:'suda-uatrack="key=wb_pc_profile&value=atten_flip"'},hot:{jump:'suda-uatrack="key=weibo_pc_PostFollow_hot&value=Click_RecCardJump"',down:'suda-uatrack="key=weibo_pc_PostFollow_hot&value=Click_UnfoldTri"',up:'suda-uatrack="key=weibo_pc_PostFollow_hot&value=Click_FoldTri"',close:'suda-uatrack="key=weibo_pc_PostFollow_hot&value=Click_RecCardOff"',right:'suda-uatrack="key=weibo_pc_PostFollow_hot&value=SlideRight_RecArea"'},page:{jump:'suda-uatrack="key=weibo_pc_PostFollow_main&value=Click_RecCardJump"',down:'suda-uatrack="key=weibo_pc_PostFollow_main&value=Click_UnfoldTri"',up:'suda-uatrack="key=weibo_pc_PostFollow_main&value=Click_FoldTri"',close:'suda-uatrack="key=weibo_pc_PostFollow_main&value=Click_RecCardOff"',right:'suda-uatrack="key=weibo_pc_PostFollow_main&value=SlideRight_RecArea"'},feed:{jump:'suda-uatrack="key=weibo_pc_PostFollow_feed&value=Click_RecCardJump"',down:'suda-uatrack="key=weibo_pc_PostFollow_feed&value=Click_UnfoldTri"',up:'suda-uatrack="key=weibo_pc_PostFollow_feed&value=Click_FoldTri"',close:'suda-uatrack="key=weibo_pc_PostFollow_feed&value=Click_RecCardOff"',right:'suda-uatrack="key=weibo_pc_PostFollow_feed&value=SlideRight_RecArea"'},hostFans:{jump:'suda-uatrack="key=weibo_pc_PostFollow_FollowList&value=FanListHost_Click_RecCardJump"',down:'suda-uatrack="key=weibo_pc_PostFollow_FollowList&value=FanListHost_Click_UnfoldTri"',up:'suda-uatrack="key=weibo_pc_PostFollow_FollowList&value=FanListHost_Click_FoldTri"',close:'suda-uatrack="key=weibo_pc_PostFollow_FollowList&value=FanListHost_Click_RecCardOff"',right:'suda-uatrack="key=weibo_pc_PostFollow_FollowList&value=FanListHost_SlideRight_RecArea"'},cusFans:{jump:'suda-uatrack="key=weibo_pc_PostFollow_FollowList&value=FanListGuest_Click_RecCardJump"',down:'suda-uatrack="key=weibo_pc_PostFollow_FollowList&value=FanListGuest_Click_UnfoldTri"',up:'suda-uatrack="key=weibo_pc_PostFollow_FollowList&value=FanListGuest_Click_FoldTri"',close:'suda-uatrack="key=weibo_pc_PostFollow_FollowList&value=FanListGuest_Click_RecCardOff"',right:'suda-uatrack="key=weibo_pc_PostFollow_FollowList&value=FanListGuest_SlideRight_RecArea"'},cusFollow:{jump:'suda-uatrack="key=weibo_pc_PostFollow_FollowList&value=FollowListGuest_Click_RecCardJump"',down:'suda-uatrack="key=weibo_pc_PostFollow_FollowList&value=FollowListGuest_Click_UnfoldTri"',up:'suda-uatrack="key=weibo_pc_PostFollow_FollowList&value=FollowListGuest_Click_FoldTri"',close:'suda-uatrack="key=weibo_pc_PostFollow_FollowList&value=FollowListGuest_Click_RecCardOff"',right:'suda-uatrack="key=weibo_pc_PostFollow_FollowList&value=FollowListGuest_SlideRight_RecArea"'},card:{jump:'suda-uatrack="key=V6newcard&value=Click_RecCardJump"',down:'suda-uatrack="key=V6newcard&value=Click_UnfoldTri"',up:'suda-uatrack="key=V6newcard&value=Click_FoldTri"',close:'suda-uatrack="key=V6newcard&value=Click_RecCardOff"',right:'suda-uatrack="key=V6newcard&value=SlideRight_RecArea"'}},h=c(b('<#et recommendFollow data><div class="user_tit"><span class="W_f14 S_txt2">#L{关注推荐}</span></div><div class="user_scroll" node-type="recommend_outer"><ul class="picitems_ul clearfix" node-type="recommend_inner" style="width: ${data.containerW}px;"><#list data.list as list><li class="picitems S_bg2" node-type="recommendCard"><div class="midbox"><p class="pic_wrap"><span class="pic_box"><a target="_blank" ${data.suda.jump} href="${list.user.profile_url}"><img src="${list.user.avatar_large}" alt="${list.user.screen_name}" title="${list.user.screen_name}" class="pic"></a>${list.verify_icon}</span></p><p class="name W_autocut W_fb W_f14"><a target="_blank" ${data.suda.jump} href="${list.user.profile_url}" class="S_txt1">${list.user.screen_name}</a></p><p class="info"><a target="_blank" ${data.suda.jump} href="${list.user.profile_url}" class="S_txt2">${list.user.verified_reason || list.user.description}</a></p><p class="opt" ${data.outNodeExpr} action-data="uid=${list.user.id}&fnick=${list.user.screen_name}&pos=${list.pos}&f=1&nogroup=1&isrecommend=0&card=1&refer_flag=${list.refer_flag}&refer_from=recommend&template=6"><a href="javascript:void(0);" class="W_btn_c btn_34px" action-type="follow"><em class="W_ficon ficon_add">+</em>#L{关注}</a></p><a href="javascript:void(0);" ${data.suda.close} class="W_ficon ficon_close S_ficon" action-type="follow_cancle" action-data="pos=${list.pos}&uid=${list.user.id}">X</a></div></li></#list></ul><a href="javascript:void(0);" class="scroll_control left" style="display:none;" action-type="follow_turn" action-data="dir=1&"><i class="W_icon icon_scrollarr_l"></i></a><a href="javascript:void(0);" ${data.suda.right} class="scroll_control right" style="${data.showArrR}" action-type="follow_turn" action-data="dir=-1&"><i class="W_icon icon_scrollarr_r"></i></a></div></#et>')),i={special:'<em class="W_ficon S_ficon ficon_right">Y</em>#L{特别关注}',follow:'<em class="W_ficon S_ficon ficon_right">Y</em>#L{已关注}',both:'<em class="W_ficon ficon_addtwo S_ficon">Z</em>#L{互相关注}'},j={getAttrData:function(b,c){if(!!b&&!!c){var d=b.getAttribute(c),e=d&&a.queryToJson(d)||!1;return e}},setAttrData:function(b,c,d){var e=this.getAttrData(b,c)||{};e=a.core.json.merge(e,d);b.setAttribute(c,a.jsonToQuery(e))}};return function(c){c=a.parseParam({outer:"",vf:"profile",dEvt:"",cardW:144,minNum:4,outNodeExpr:'node-type="followBtnBox"',needSync:!1},c);var k,l,m={},n,o,p,q,r=["rended","unrend","followed"];q={render:function(b){if(!!b&&!!b.reqData){var d;d=a.parseParam({uid:window.$CONFIG&&window.$CONFIG.uid,to_uid:"",refer_flag:"",refer_from:""},b.reqData);var f=function(d){if(!!d){if(d.code==100070||!d.data.list){a.ui.tipAlert(d.msg||"暂时没有相关推荐！",{icon:"warnS"}).beside(b.arrBtn||b.el);return}d.data.suda=g[c.vf];d.data.outNodeExpr=c.outNodeExpr;d.data.containerW=d.data.list.length*c.cardW;d.data.showArrR=d.data.list.length>c.minNum?"":"display:none;";var e=h(d.data).toString();b.html=e;a.custEvent.fire(m,"rended",b)}},i=function(c){c.code==100070?a.ui.tipAlert(c.msg,{icon:"warnS"}).beside(b.arrBtn):a.lib.dialog.ioError(c.code,c)};e.request("recommend",{onComplete:f,onFail:i},d)}},showArr:function(b,c,d,e){var f=b.offsetWidth,g=c.offsetWidth,h=Math.abs(c.offsetLeft),i=g-f-h;h<=0?a.setStyle(d,"display","none"):a.setStyle(d,"display","");i<=0?a.setStyle(e,"display","none"):a.setStyle(e,"display","")},followTurn:function(b){var e=b.el,f=b.data,g=f.dir,h=a.core.dom.dir.parent(e,{expr:'[node-type="recommend_outer"]'})[0],i=a.core.dom.dir.prev(e,{expr:'[node-type="recommend_inner"]'})[0],j=h.offsetWidth,k=i.offsetWidth,l=Math.abs(i.offsetLeft),m=k-j-l,n=Math.floor(j/c.cardW)*c.cardW,o,p,r;if(g==1){p=e;r=a.core.dom.dir.next(e,{expr:'a[action-type="follow_turn"]'})[0];if(l<=0)return;l>=n?o=-g*(l-n):o=0}else{r=e;p=a.core.dom.dir.prev(e,{expr:'a[action-type="follow_turn"]'})[0];if(m<=0)return;m>=n?o=g*(l+n):o=g*(l+m)}d(i,{animationType:"linear",duration:200,delay:3,end:function(){!!p&&!!r&&q.showArr(h,i,p,r)}}).finish({left:o})},followed:function(a,b){q.removeCard(b)},removeCard:function(b){var d=b.el,e=a.core.dom.dir.parent(d,{expr:'[node-type="recommendCard"]'})[0],f=a.core.dom.dir.parent(d,{expr:'[node-type="recommend_inner"]'})[0],g=a.core.dom.dir.parent(d,{expr:'[node-type="recommend_outer"]'})[0],h=a.sizzle('a[action-type="follow_turn"]',g),i=f.offsetWidth,j=a.tween(e,{duration:200,end:function(){e.innerHTML="";a.removeNode(e);d=e=null;j.destroy();a.setStyle(f,"width",i-c.cardW+"px");q.showArr(g,f,h[0],h[1]);if(!a.sizzle('[node-type="recommendCard"]',f)[0]){b.el=f;a.custEvent.fire(m,"unrend",b)}}}).play({width:0})},cancelCard:function(b){var c=b.data,d={uid:window.$CONFIG&&window.$CONFIG.uid,to_uid:c.uid},f=function(a){a.code==1e5&&q.removeCard(b)},g=function(b){a.lib.dialog.ioError(b.code,b)};e.request("removeFollow",{onComplete:f,onFail:g},d)},channelSpecial:function(d){if(!!c.outer){var e=d.uid,f=d.lastBtn,g=a.sizzle("["+c.outNodeExpr+"]",c.outer);if(!g||g.length<=0)return;for(var h=0,k=g.length;h<k;h++){var l=g[h],m=a.sizzle("[action-type=noop],[action-type=unFollow],[action-type=unBlock]",l)[0],n=j.getAttrData(l,"action-data");if(f&&f==m)return;if(n.uid&&n.uid==e||n.objectid&&n.objectid==objectid){m.innerHTML=b(i[d.both?"both":d.isSpecial==1?"special":"follow"]);j.setAttrData(l,"action-data",{is_special:d.isSpecial});if(l.confirm){l.confirm.hide();l.confirm.destroy();l.confirm=null}l.hover&&l.hover.destroy()}}}},destroy:function(){m=null;k.remove("follow_cancle","click",q.cancelCard);k.remove("follow_turn","click",q.followTurn);k&&k.destroy&&k.destroy();c.needSync&&f.remove("specialFollow",q.channelSpecial)},initplugins:function(){m.render=q.render;m.destroy=q.destroy}};parseDom=function(){k=c.dEvt||a.delegatedEvent(document.body)};o=function(){a.custEvent.define(m,r);a.custEvent.add(m,"followed",q.followed);k.add("follow_cancle","click",q.cancelCard);k.add("follow_turn","click",q.followTurn);c.needSync&&f.register("specialFollow",q.channelSpecial)};p=function(){parseDom();o();q.initplugins()};p();return m}});
STK.register("lib.feed.plugins.recommendFollow",function(a){var b=a.lib.follow.followButton,c=a.lib.follow.recommendFollow,d=a.core.dom.dir,e=a.lib.kit.extra.language,f=a.core.util.easyTemplate,g=a.lib.kit.extra.parseURL,h={changeVF:function(a){var b=a&&a.host,c=window.$CONFIG&&window.$CONFIG.location;if(/d\.weibo\.com/.test(b))return"hot";if(/weibo\.com/.test(b)&&/^page_/.test(c)&&/_single_weibo/.test(c))return"page"}},i={page:{down:'<em suda-uatrack="key=weibo_pc_PostFollow_main&value=Click_UnfoldTri" class="W_ficon ficon_arrow_down_lite">g</em>',up:'<em suda-uatrack="key=weibo_pc_PostFollow_main&value=Click_FoldTri" class="W_ficon ficon_arrow_up_lite">h</em>'},hot:{down:'<em suda-uatrack="key=weibo_pc_PostFollow_hot&value=Click_UnfoldTri" class="W_ficon ficon_arrow_down_lite">g</em>',up:'<em suda-uatrack="key=weibo_pc_PostFollow_hot&value=Click_FoldTri" class="W_ficon ficon_arrow_up_lite">h</em>'}},j={btn:f(e('<#et followArr data><div class="opt_v2" node-type="follow_recommend_arr"><a class="W_btn_b btn_22px" href="javascript:void(0);" action-type="follow_recommend_arr" action-data="uid=${data.uid}&refer_from=${data.refer_from}">${data.em}</a></div></#et>')),down:'<em class="W_ficon ficon_arrow_down_lite">g</em>',up:'<em class="W_ficon ficon_arrow_up_lite">h</em>',follow:"W_btn_c",unFollow:"W_btn_d"};return function(e,f){if(!!e){var k,l,m,n,o=!0,p="page",q={},r,s,t,u,v;r={getFeedNode:function(b,c){return a.core.dom.dir(b,{expr:"[action-type=feed_list_item]",endpoint:c||document.body})[0]}};s={initArr:function(){var b=h.changeVF(g());if(i[b]){j=a.parseParam(j,i[b]);p=b}},change:function(b,c){if(c.state=="follow"){if(c.data.isrecommend==1&&c.data.wforce!=0)return;if(c.data.isrecommend!=1&&c.data.card==1){setTimeout(function(){a.custEvent.fire($recommend,"followed",c)},800);return}}},recommend:function(b,c){if(!!c&&!!l){var e=c.el,f=c.data,g=c.state,h=r.getFeedNode(e,l);if(!h)return;if(c.state=="follow"){var i={uid:window.$CONFIG&&window.$CONFIG.uid,to_uid:c.data.uid,refer_flag:c.data.refer_flag,refer_from:c.data.refer_from};c.reqData=i;$recommend.render(c)}else if(g=="unfollow"){var j=a.sizzle('[node-type="fl_screen_box"]',h)[0],k=d.next(e,{expr:'[node-type="follow_recommend_arr"]'})[0],m=a.sizzle('[node-type="follow_recommend_box"]',h)[0];k&&a.removeNode(k);j&&a.setStyle(j,"display","");m&&a.setStyle(m,"display","none")}}},rended:function(b,c){if(!!c&&!!l){var d=c.el,e=c.data,f=r.getFeedNode(d,l);if(!f)return;var g=a.sizzle('[node-type="fl_screen_box"]',f)[0],h=a.sizzle('[node-type="follow_recommend_box"]',f)[0];e.em=j.up;var i=j.btn(e).toString();if(!i||!c.html||!h)return;h.innerHTML=c.html;g&&a.setStyle(g,"display","none");a.insertHTML(d,i,"AfterEnd");s.toggleBox(!0,h,a.sizzle('[action-type="follow_recommend_arr"]',f)[0])}},changeStatus:function(b,c){if(!!c&&!!l){var e=c.el,f=c.data,g=c.state,h=r.getFeedNode(e,l);if(!h)return;var i=a.sizzle('[node-type="fl_screen_box"]',h)[0];if(g=="follow"){f.em=j.down;var k=j.btn(f).toString();i&&a.setStyle(i,"display","none");k&&a.insertHTML(e.parentNode,k,"AfterEnd")}else if(g=="unfollow"){var m=d.next(e.parentNode,{expr:'[node-type="follow_recommend_arr"]'})[0],n=a.sizzle('[node-type="follow_recommend_box"]',h)[0];m&&a.removeNode(m);i&&a.setStyle(i,"display","");n&&a.setStyle(n,"display","none")}}},unrend:function(b,c){var d=c.el,e=r.getFeedNode(d,l);if(!!e){var f=a.sizzle('[node-type="follow_recommend_box"]',e)[0],g=a.sizzle('[action-type="follow_recommend_arr"]',e)[0];if(!f||!g)return;s.toggleBox(!1,f,g)}},toggleBox:function(b,c,d){if(!!c&&!!d)if(b){d.innerHTML=j.up;a.setStyle(c,"display","")}else{d.innerHTML=j.down;a.setStyle(c,"display","none")}},arrClick:function(b){var c=b.el,d=r.getFeedNode(c,l);if(!!d){var e=b.data,f=a.sizzle('[node-type="follow_recommend_box"]',d)[0];if(!f)return;var g=!!a.sizzle('[node-type="recommend_outer"]',f)[0],h=!!a.sizzle('[node-type="recommendCard"]',f)[0],i=a.getStyle(f,"display")=="none";if(g&&h){s.toggleBox(i,f,c);return}b.arrBtn=c;var j={uid:window.$CONFIG&&window.$CONFIG.uid,to_uid:e.uid,refer_flag:b.data.refer_flag,refer_from:b.data.refer_from};b.reqData=j;$recommend&&$recommend.render(b)}},setRemark:function(b,c){var d={};d=c.data;d.remark=d.remark&&a.decodeHTML(decodeURIComponent(d.remark))||"";d.callback=function(b){c.el.setAttribute("action-data","remark="+encodeURIComponent(a.encodeHTML(b)))};a.lib.dialog.setRemark(d)}};t=function(){l=e.getNode();k=e.getDEvent();n=b({outer:l,needSync:o,outNodeExpr:'[node-type="feed_recommend_follow"]'});$recommend=c({outer:l,vf:p,dEvt:k,outNodeExpr:'node-type="feed_recommend_follow"',needSync:!0})};u=function(){a.custEvent.add(n,"change",s.change);a.custEvent.add(n,"recommend",s.recommend);a.custEvent.add(n,"setRemark",s.setRemark);o&&a.custEvent.add(n,"changeStatus",s.changeStatus);a.custEvent.add($recommend,"rended",s.rended);a.custEvent.add($recommend,"unrend",s.unrend);k.add("follow_recommend_arr","click",s.arrClick)};v=function(){s.initArr();t();u()};v();q.destroy=function(){a.custEvent.remove(n,"change",s.change);a.custEvent.remove(n,"recommend",s.recommend);o&&a.custEvent.remove(n,"changeStatus",s.changeStatus);n&&n.destroy&&n.destroy();a.custEvent.remove($recommend,"rended",s.rended);a.custEvent.remove($recommend,"unrend",s.unrend);$recommend&&$recommend.destroy&&$recommend.destroy();k.remove("follow_recommend_arr","click",s.arrClick);k&&k.destroy&&k.destroy()};return q}}});
STK.register("pl.content.weiboDetail.source.feedList",function(a){var b=a.pl.content.weiboDetail.source;return function(b,c){var d=[],e=a.lib.feed.base(b,{}),f=a.sizzle("[action-type=feed_list_item]",b)[0];c=c||{};d.push(a.lib.feed.plugins.favorite.init(e,a.core.json.merge(c,{isFavoritePage:!1})));d.push(a.lib.feed.plugins.media(e,c));d.push(a.lib.feed.plugins.images(e,c));d.push(a.lib.feed.plugins.map(e,c));d.push(a.lib.feed.plugins.like.init(e,c));d.push(a.lib.feed.plugins.tag.init(e,c));d.push(a.lib.feed.plugins.updateTime(e,c));d.push(a.lib.feed.plugins.translate(e,c));d.push(a.lib.feed.plugins.deleteFeed(e,c));d.push(a.lib.feed.plugins.feedViews(e,c));d.push(a.lib.feed.plugins.feedOnTop(e,a.core.json.merge(c,{isWeiboDetail:!0})));d.push(a.lib.feed.plugins.jumpurl(e,c));d.push(a.lib.feed.plugins.rightmenu(e,c));d.push(a.lib.feed.plugins.thirdExpand(e,c));d.push(a.lib.feed.plugins.feedSet(e,a.core.json.merge(c,{isWeiboDetail:!0})));d.push(a.lib.feed.plugins.more(e,c));d.push(a.lib.feed.plugins.cardbg(e,c));d.push(a.lib.feed.plugins.cuslike(e,c));d.push(a.lib.feed.plugins.reEdit(e,c));d.push(a.lib.feed.plugins.historicRecord(e,c));d.push(a.lib.feed.plugins.moreThan140(e,c));d.push(a.lib.feed.plugins.adTurnPlay(e,c));d.push(a.lib.feed.plugins.recommendFollow(e,c));if(f.getAttribute("isforward")!=="1"){var g=a.sizzle('[node-type="fl_pic_list"]',f)[0]||a.sizzle('[action-type="feed_list_media_img"]',f)[0]||[],h=g&&a.lib.kit.extra.actionData(g).get("isPrivate")||0,i=h==1?[]:["[action-type=fl_pics]","[action-type=feed_list_media_img]"],j=a.sizzle(i.join(","),b)[0];if(!j){i=["[action-type=feed_list_media_music]","[action-type=feed_list_media_video]","[action-type=feed_list_media_widget]","[action-type=feed_list_third_rend]","[action-type=feed_list_media_qing]"];j=a.sizzle(i.join(","),b)[0]}j&&e.getDEvent().fireDom(j,"click")}var k=a.queryToJson(FM.getURL().query);if(k&&k.flpop)if(k.flpop==1){if($CONFIG&&$CONFIG.uid==$CONFIG.oid){var l=a.sizzle('[action-type="fl_pop"]',b);l&&l[0]&&setTimeout(function(){e.getDEvent().fireDom(l[0],"click")},600)}}else if(k.flpop==2){var l=a.sizzle('[action-type="thrid_rend_iframe"]',b);l&&l[0]&&setTimeout(function(){e.getDEvent().fireDom(l[0],"click")},600)}var m=function(){for(var b in d)d[b].destroy&&d[b].destroy();a.removeEvent(forwardCounter,"click",forwardCounterClick);a.removeEvent(commentCounter,"click",commentCounterClick);a.removeEvent(likeCounter,"click",likeCounterClick);e=null};e.destroy=m;return e}});
STK.register("conf.trans.weiboDetail",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("deleteFeed",{url:"/aj/mblog/del",method:"post"});c("deleteComment",{url:"/aj/comment/del",method:"post"});c("commentList",{url:"/aj/v6/comment/big",method:"get"});c("forwardList",{url:"/aj/v6/mblog/info/big",method:"get"});c("mediaShow",{url:"//api.weibo.com/widget/show.jsonp",varkey:"jsonp",method:"get",requestMode:"jsonp"});c("qingShow",{url:"//api.t.sina.com.cn/widget/show.json?source=351354573",varkey:"callback",method:"get",requestMode:"jsonp"});c("widget",{url:"/aj/mblog/showinfo",method:"post"});c("third_rend",{url:"/aj/mblog/renderfeed",method:"post"});return b});
STK.register("lib.comment.commentSingle",function(a){var b=a.lib.kit.extra.setPlainHash,c=[],d={},e=a.ui.alert,f=a.lib.kit.extra.language,g=a.custEvent,h=a.conf.trans.feed.comment,i=g.fire,j={content:f("#L{评论内容不能为空哦，写点东西吧。}"),"delete":f("#L{确定要删除该回复吗}"),reply:f("#L{回复}"),blcok:f("#L{同时将此用户加入黑名单}")},k=function(c,d,e){var h,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z=new RegExp(["^",j.reply,"@(.*):(.*)"].join("")),A=a.core.str,B,C=a.sizzle("[action-type='post']",c)[0],D=a.sizzle("[node-type='btnText']",c)[0],E=D.innerHTML,F=c.getAttribute("need_approval_comment"),G=function(a,b){b=="normal"?E&&(a.innerHTML=E):a.innerHTML=f("#L{提交中...}")},H=function(c){if(!x){x=!0;var d=a.trim(o.value),g=d.match(z),i=o.getAttribute("pid"),k=o.getAttribute("pic_types");if(i==="loading"){a.ui.tipAlert(f("#L{图片上传中请稍后}"),{icon:"rederrorS"}).beside(o).on("hide",function(){o.focus()});x=!1;return}if(d==""||g&&a.trim(g[2])==""){a.ui.tipAlert(j.content).beside(o);x=!1;return}if(!g||!g[1]||g[1]!=n)m=n=null;if(C){G(D,"loading");C.className="W_btn_a W_btn_a_disable"}b("_rnd"+(+(new Date)).toString());var l={act:g?"reply":"post",cid:m,content:A.leftB(d,280),isroot:q&&q.checked?"1":"0",forward:p&&p.checked?"1":"0"};c.data&&c.data.ref&&(l.ref=c.data.ref);l=a.core.json.merge(l,e.dissDataFromFeed);i&&(l.pic_id=i);k&&(l.pic_types=k);h.post(a.lib.kit.extra.getDiss(l,c.el))}},I=function(a){H(a)},J=a.core.evt.delegatedEvent(c);J.add("post","click",I);var K=function(b){var d=b.data;if(!!d){d.html&&(c.innerHTML=d.html);d.count=d.count||c.getAttribute("count");try{i(k,"count",[l=d.count*1||0])}catch(e){a.log("ERR",e.message)}o=a.sizzle("textarea",c)[0];if(o){B=setInterval(function(){var b=a.trim(o.value);C.className=b.length>0?"W_btn_a":"W_btn_a W_btn_a_disable"},200);setTimeout(function(){a.lib.kit.dom.autoHeightTextArea({textArea:o,maxHeight:9999,inputListener:function(){var b=a.trim(o.value);A.bLength(b)>280&&(o.value=A.leftB(b,280))}});a.lib.kit.extra.keySubmit.on(o,I)},25);var f={count:"disabled"};s=a.lib.editor.base(c,f);t=s.editor;a.custEvent.define(t,"close");var g=a.sizzle('[node-type="smileyBtn"]',c)[0],h=a.sizzle('[node-type="funnyBtn"]',c)[0],j=a.sizzle('[node-type="imgBtn"]',c)[0],m=a.queryToJson(j.getAttribute("action-data")).canUploadImage;u=a.lib.publisher.widget.face(t);y=a.lib.publisher.widget.funnyImg(t);if(m=="1"){v=a.lib.image.commentImage(t,j,{file_source:3});w=a.lib.image.pastePic(t,j)}a.addEvent(g,"click",u.show);a.addEvent(h,"click",N.onlyFunny);a.addEvent(j,"click",N.onlyImg)}p=a.sizzle("input[name=forward]",c)[0];q=a.sizzle("input[name=isroot]",c)[0];b.allowForward==="0"&&p&&(p.parentNode.style.display="none");b.allowRootComment==="0"&&q&&(q.parentNode.style.display="none")}},L=function(){x=!1},M=function(){x=!1;if(C){G(D,"normal");C.className="W_btn_a"}},N={onlyFunny:function(b){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("comment_click","qutu");v&&v.isShow()||w&&w.isShow()?a.ui.confirm(f("#L{确定放弃上传图片吗？}"),{icon:"rederrorB",okText:f("#L{确定}"),cancelText:f("#L{取消}"),OK:function(){v&&v.hideLayer();w&&w.hideLayer();y.show()}}):y.show()},onlyImg:function(b){if(y.isShow()){a.core.evt.stopEvent(b);a.ui.confirm(f("#L{确定放弃上传趣图吗？}"),{icon:"rederrorB",okText:f("#L{确定}"),cancelText:f("#L{取消}"),OK:function(){y.destroy();var d=b.target||b.srcElement,e=a.sizzle('[node-type="imgBtn"]',c)[0],f=a.sizzle("input",e)[0];f&&f.click()}})}}},O={add_success:function(b,c){if(C){G(D,"normal");C.className="W_btn_a"}x=!1;var d=b.data;if(!!d){m=n=null;l+=1;o.value="";d.comment&&i(k,"comment",{html:d.comment,count:l});p&&(p.checked=!1);q&&(q.checked=!1);i(k,"count",l);c.forward==="1"&&i(k,"forward");if(d.feed){i(k,"feed");a.conf.channel.feed.fire("forward",{html:d.feed})}x=!1;v&&v.hideLayer();w&&w.hideLayer();y&&y.destroy();F&&a.ui.tip("lite",{msg:f("#L{由于博主的设置，评论将由Ta筛选后显示}")})}},delete_success:function(b,d){l=Math.max(l-1,0);i(k,"count",l);var e=a.sizzle(["dl[comment_id=",d.cid,"]"].join(""),c)[0];e&&e.parentNode.removeChild(e);i(k,"del",{comment_id:d.cid})},add_fail:M,add_error:M,delete_fail:L,delete_error:L,smallList_fail:L,smallList_error:L,smallList_success:K};h=a.lib.comment.inter(O,d);k=g.define(h,["count","feed","comment","forward","del"]);h.destroy=function(){t.closeWidget();clearInterval(B)};h.focus=function(){t.API.focus(0)};h.shine=function(){a.lib.publisher.source.shine(t.nodeList.textEl)};window.setTimeout(function(){e.data={};K(e);e.needFocus&&t&&t.API&&t.API.focus(0)},200);return h},l=function(b,e,f){var g=a.core.arr.indexOf(b,c);if(!d[g]){c[g=c.length]=b;d[g]=k(b,e,f)}return d[g]};return function(a,b,c){if(!a||!a.mid)throw"mid is not defined";var d=l(b,a,c);return d}});
STK.register("pl.content.weiboDetail.source.utils",function(a){var b=a.core.evt.preventDefault,c=a.lib.kit.extra.language,d=a.core.dom.dir,e=a.lib.kit.dom.firstChild,f=a.lib.kit.dom.parentAttr,g=a.core.util.getUniqueKey,h=a.core.dom.uniqueID,i=a.core.dom.sizzle,j=a.core.dom.next,k=40,l=450,m=c("#L{加载失败}!"),n=c("#L{很抱歉，该内容无法显示，请稍后再试。}"),o,p,q=a.core.util.easyTemplate,r=a.core.dom.hasClassName,s=a.core.dom.addClassName,t=a.core.dom.removeClassName,u=a.conf.trans.weiboDetail,v=a.lib.kit.extra.toFeedText,w=a.lib.kit.extra.parseURL().url,x={"delete":c("#L{确定要删除该回复吗}"),blcok:c("#L{同时将此用户加入黑名单}")},y={getMid:function(a,b){return a.mid||(a.mid=f(a,"mid",b))},getFeedNode:function(a){while(a&&a.getAttribute&&a.getAttribute("node-type")!=="feed_list"&&a.tagName&&a.tagName.toLowerCase()!="dl")a=a.parentNode;return a},preventDefault:function(a){b(a);return!1},tabSwitch:function(a,b,c,d){var e=a.parentNode,f=!1,g=c.split(" "),h;if(d){var j=a.getAttribute("action-type"),k=a.getAttribute("action-data"),l=j==="forword_tab_click"&&(k==="privatemsg"||k==="microgroup");d.feed_list.style.display=l?"none":"";d.feed_cate.style.display=l?"none":""}if(!r(a,b)){h=i("."+b,e)[0];for(var m=0;m<g.length;m++)t(h,g[m]);s(a,c);f=!0}a.blur();return f},getMediaPDNodes:function(b,c){return{prev:a.sizzle("[node-type=feed_list_media_prev]",b)[0],disp:a.sizzle("[node-type=feed_list_media_disp]",b)[0]}},toFloatFun:function(a,b,c){},bigImgFun:function(a,b,c){},newsFeed:function(b,c){var d=b.el;while(d&&!a.hasClassName(d,"WB_info"))d=d.parentNode;var e=a.sizzle("[node-type=feed_list_news]",d)[0];e&&(e.style.display=c?"":"none")},smallVideoMusicClickFun:function(a,b,c,d){},rotateImg:function(a,b){},getForwardOptions:function(b){var c={},d=a.sizzle("[node-type=feed_list_content]",b)[0],e=a.queryToJson(a.sizzle("[action-type=fl_forward]",b)[0].getAttribute("action-data")||"");c.uid=e.uid?e.uid:"";c.uid=e.rootuid?e.rootuid:"";c.url=(e||"")&&e.url;if(!d){a.log("forward : there is not '[node-type=\"feed_list_content\"]' in the feed_item ");return a.preventDefault()}var f=a.sizzle('[node-type="feed_list_reason"]',d)[0];if(!f){var g=a.sizzle("[nick-name]",b);g.length&&(c.originNick=g[0].getAttribute("nick-name"));c.reason=d.innerHTML}else{c.originNick=a.sizzle('[node-type="feed_list_originNick"]',d)[0].getAttribute("nick-name")||"";c.reason=(f.innerHTML||"").replace(/[\r\n]+/g,"")}var h=a.sizzle('[node-type="feed_list_forwardContent"]',b)[0];if(h){c.forwardNick=e.name||c.originNick;var i=a.sizzle('[node-type="feed_list_originNick"]',h)[0];c.originNick=i?i.getAttribute("nick-name"):"";var j=a.sizzle('[node-type="feed_list_reason"]',h)[0];c.origin=j?j.innerHTML:""}else{c.origin=c.reason;delete c.reason}for(var k in e)c[k]=e[k];return c},getCount:function(a){var b=a.match(/\(([\d]*)\)/);b=b?parseInt(b[1]):0;return b},qingExpand:function(a,b,c){},thirdExpand:function(a,b,c){},widgetExpand:function(a,b,c){},feedListDelete:{DERRORTEXT:"#L{删除失败}!",tipOnMid:"",msgTip:null,confirmTip:null,deleteMsg:function(b,c){var d=this,e=d.msgTip;e=a.ui.tip("alert",{showCallback:function(){setTimeout(function(){e.aniHide()},600)},hideCallback:function(){d.tipOnMid=undefined;e.destroy();e=null},msg:b,type:"error",direct:"down"});e.setLayerXY(c);e.aniShow()},getConfirmTip:function(){var b=this,d=c(b.delType?"#L{确定要删除该回复吗？}":"#L{确认要删除这条微博吗？}");return a.ui.tip("confirm",{msg:d,okCallback:function(){b.okCallback()},hideCallback:function(){b.tipOnMid=undefined},direct:"down"})},deleteFeed:function(b,c){var e=y.getFeedNode(b),f=e.offsetHeight;e.style.height=f+"px";var g=e.getAttribute("mid");e.innerHTML="";a.tween(e,{duration:200,animationType:"easeoutcubic",end:function(){var f=!0;if(d.next(e,{expr:"dl"})[0]||d.prev(e,{expr:"dl"})[0])f=!1;a.removeNode(e);node=b=e=null;f?window.location.reload():c()}}).play({height:0})}},parseForwardActData:function(a,b){var c=b;for(var d in c)a[d]=decodeURIComponent(c[d]);return a||{}}};return y});
STK.register("lib.comment.commentMedia",function(a){var b=a.lib.comment.commentTemp,c=a.core.util.easyTemplate,d=a.lib.kit.extra.language,e=d("#L{加载失败}!"),f=d("#L{很抱歉，该内容无法显示，请稍后再试。}"),g=d("#L{操作失败，请稍候重试。}"),h=450,i=function(b){return a.core.dom.dir(b,{expr:"[comment_id]"})[0]},j=function(b){var c=b.getAttribute("comment_id")?b:i(b);return{prev:a.sizzle("[node-type=comment_media_prev]",c)[0],disp:a.sizzle("[node-type=comment_media_disp]",c)[0]}},k=function(e,f){var g=e.el,k=e.data,l=decodeURIComponent(k.pic_objects||""),m=l.split("|");if(!g.loading){g.tagName.toLowerCase()!=="img"&&(g=a.sizzle("img",g)[0]);g.loading=1;var n=/\/thumbnail\/.+(?=\.\w+)/.exec(g.src);n&&(n=n[0].replace("/thumbnail/",""));var o=g.src.replace("/thumbnail/","/bmiddle/").replace("/thumb180/","/bmiddle/"),p=i(g),q=p.getAttribute("comment_id"),r="pid="+(k.pid?k.pid:n)+"&cid="+(k.cid?k.cid:q),s,t,u=j(p),v=function(){g.loading=0;if(s){g.bigImgWidth=s.width;s.onload=null}t&&(t.style.display="none");u.prev.style.display="none";u.disp.innerHTML="";var e=a.core.dom.dir.parent(g,{expr:".WB_feed_comment"})[0]||a.core.dom.dir.parent(g,{expr:".WB_sonFeed"})[0]?"S_bg1":"S_bg2";u.disp.appendChild(a.builder(c(d(b.mediaImage),{bgClass:e,uniqueId:a.core.util.getUniqueKey(),bigSrc:o,acdata:r,pid:k.pid?k.pid:n,mid:k.mid,object_id:m[3],bigWidth:g.bigImgWidth>h?h:g.bigImgWidth,suda:{showBig:"key=comment_pic_click&value=big_pic_button",left:"key=comment_pic_click&value=turnleft_button",right:"key=comment_pic_click&value=turnright_button"}}).toString()).box);u.disp.style.display=""};if(g.bigImgWidth)v();else{var w=g.offsetWidth,x=parseInt(g.offsetHeight/2-8);(t=a.core.dom.next(g)).style.cssText="margin:"+x+"px "+parseInt(w/2-8)+"px "+x+"px -"+parseInt(w/2+8)+"px;";(s=new Image).onload=v;s.src=o}}},l=function(b,c,d){var e=b.el;if(!!d||!!/(img)|(canvas)/.test(b.evt.target.tagName.toLowerCase())){var f=i(e);if(!f){a.log("parents attribute mid is undefined!");return}f.disp="";var g=j(f);if(!g||!g.prev||!g.disp){a.log('node-type="comment_media_prev" or node-type="comment_media_disp" in a feed\'s node is undefined!');return}a.position(g.disp).t<a.scrollPos().top&&f.scrollIntoView();g.prev.style.display="";g.disp.style.display="none";g.disp.innerHTML=""}},m=function(b,c,d){var e=b.el,f=i(e);if(!e.parentNode.uid){var g=a.sizzle('img[action-type="comment_media_bigimg"],canvas[id]',f)[0];e.parentNode.uid="rotate_img_"+a.core.dom.uniqueID(g.oImage||g);g.setAttribute("id",e.parentNode.uid)}a.lib.kit.dom.rotateImage.rotateRight(a.E(e.parentNode.uid),d,h)};return function(b){var c=a.delegatedEvent(b),d={};c.add("comment_media_img","click",function(c){a.lib.kit.extra.feedControlHash();k(c,b);return a.preventDefault(c.evt)});c.add("comment_media_toSmall","click",function(c){l(c,b,!0);return a.preventDefault(c.evt)});c.add("comment_media_bigimgDiv","click",function(c){l(c,b);return a.preventDefault(c.evt)});c.add("comment_media_toRight","click",function(c){m(c,b,90);return a.preventDefault(c.evt)});c.add("comment_media_toLeft","click",function(c){m(c,b,-90);return a.preventDefault(c.evt)});d.destroy=function(){c.destroy()};return d}});
STK.register("pl.content.weiboDetail.source.comment.init",function(a){var b=a.pl.content.weiboDetail.source.utils,c=a.lib.kit.extra.language,d=a.getStyle,e=a.setStyle,f=a.sizzle,g=a.lib.comment.reply,h=a.conf.trans.feed.comment,i=a.conf.trans.weiboDetail,j=a.core.util.hideContainer,k=b.feedListDelete,l=a.lib.kit.extra.setPlainHash,m=a.custEvent,n=a.lib.comment.commentTemp,o,p={unReply:c('#L{由于用户设置，你无法回复评论。}<br><a href="http://account.weibo.com/settings/mobile" target="_blank">#L{绑定手机}</a>#L{后可以更多地参与评论。}'),unPower:c("#L{由于用户设置，你无法回复评论。}"),noComment:c("#L{还没有人评论，赶快抢个沙发}")},q=["forward","comment","deleteComment"];return function(d,e){function J(a){E(a.obj,a.ret)}function G(b){var c=s.feed_cate[1];a.foreach(a.sizzle("[action-type=search_type]",c),function(c){var d=a.queryToJson(c.getAttribute("action-data")||"");d.filter==b?a.addClassName(c,"curr"):a.removeClassName(c,"curr")})}function F(b){var d=b.el,e=b.data.cid,f=b.data.nick,h=b.data.canUploadImage==1,i=b.data.canUploadFunnypic||"0",j=a.core.dom.dir(d,{dir:"parent",expr:'[node-type="replywrap"]',matchAll:!1})[0],l=a.core.dom.dir(d,{dir:"parent",expr:"li",matchAll:!1})[0],m=d.getAttribute("status"),p=z[e]&&z[e].DOM,q=p?a.core.dom.contains(document.body,p):!1;if(p&&a.getStyle(p,"display")!="none"&&q){a.setStyle(p,"display","none");l&&a.removeClassName(l,"curr")}else{if(!p||!q){p=a.builder(c(n.getReply({canUploadImage:h,canUploadFunnypic:i}))).list.commentwrap[0];j.appendChild(p);z[e]={handle:g(p,a.lib.kit.extra.merge(b.data,{mid:k,cid:e,content:f,module:"scommlist",dissDataFromFeed:o})),DOM:p};forward=a.sizzle("[name=forward]",t)[0];forward&&a.core.dom.dir.parent(forward,{expr:"li"})[0].style.display==="none"&&(a.core.dom.neighbor(p).child("[node-type=forward]").parent("li").finish().style.display="none");a.custEvent.add(z[e].handle,"reply",function(){l&&a.removeClassName(l,"curr");E.apply(null,arguments)})}l&&a.addClassName(l,"curr");a.setStyle(p,"display","");z[e]&&z[e].handle.focus()}}function E(b,c){if(D(b,c)){var d=a.position(a.core.dom.firstChild(s.feed_list)),e=a.scrollPos();d.t<e.top&&window.scrollTo(0,d.t-50)}}function D(b,c){m.fire(f,"comment");c.forward&&m.fire(f,"forward");var e;G("0");s.feed_list.innerHTML=A;e=a.sizzle("[node-type=comment_list]",s.feed_list)[0];a.insertHTML(e,c.data.comment,"afterbegin");A=d.feed_list.innerHTML;return!1}function B(){return d.style.display!="none"}var f={},j=a.delegatedEvent(d),k=e.mid,o=e.dissDataFromFeed,r=e.data,s=a.lib.kit.dom.parseDOM(a.builder(d).list),t=s.comment,u,v,w=a.lib.comment.commentMedia(d),x,y=!1,z=[],A="";m.define(f,q);var C=b.parseForwardActData({},a.core.json.clone(r));C.needFocus=B();C.needFocus=!1;C.dissDataFromFeed=o;u=s.textEl&&a.lib.comment.commentSingle({mid:k},t,C);v=a.lib.dialog.commentDialogue();f.load=function(){i.request("commentList",{onSuccess:function(a,b){A=s.feed_list.innerHTML=a.data.html;G("0")},onError:function(b,c){b&&b.code=="100012"&&a.lib.dialog.ioError(b.code,b);d.innerHTML=p.noComment},onFail:function(b,c){b&&b.code=="100012"&&a.lib.dialog.ioError(b.code,b);d.innerHTML=p.noComment}},{id:k})};f.hide=function(){d.style.display="none"};f.getNode=function(){return d};f.getComment=function(){return u};var H={reply:function(c){if($CONFIG.islogin!="1")a.lib.dialog.loginLayer({lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn"});else{var d=c.el;if(a.hasClassName(d,"unclick_rep")){var e=d.getAttribute("isPhone");e?a.ui.tipAlert(p.unReply,{icon:"rederrorS"}).beside(d):a.ui.tipAlert(p.unPower,{icon:"rederrorS"}).beside(d);return}c.data&&c.data.ispower=="1"?h.request("isComment",{onComplete:function(b){if(b.code=="100000")F(c);else{if(b.code=="100022")a.ui.tipAlert(p.unPower,{icon:"rederrorS"}).beside(d);else if(b.code=="100001"){d&&d.setAttribute("isphone","1");a.ui.tipAlert(p.unReply,{icon:"rederrorS"}).beside(d)}else a.ui.tipAlert(b.msg,{icon:"rederrorS"}).beside(d);a.addClassName(d,"unclick_rep")}}},c.data):F(c);return b.preventDefault(c.evt)}},commentDialogue:function(a){v.show(a);return b.preventDefault(a.evt)},"delete":function(b){function e(){d(a.core.dom.dir.parent(b.el,{expr:"[comment_id]"})[0]);a.custEvent.fire(f,"deleteComment")}function d(b,c){var d=-10;b.style.height=b.offsetHeight+d+"px";b.style.overflow="hidden";a.tween(b,{end:function(){a.removeNode(b);A=s.feed_list.innerHTML},duration:200}).play({height:0})}var g=b.data.block?['<input node-type="block_user" id="block_user" name="block_user" value="1" type="checkbox"/><label for="block_user">',c("#L{同时将此用户加入黑名单}"),"</label>"].join(""):"",h=a.ui.tipConfirm([c("#L{确认要删除该评论吗？}"),g],{stopClickPropagation:!1}).beside(b.el).ok(function(){var a=h.getDomList(!0).block_user&&h.getDomList(!0).block_user.checked;b.data.is_block=a?"1":"0";b.data.location=$CONFIG.location;i.request("deleteComment",{onSuccess:e},b.data)});a.core.evt.preventDefault(b.evt)},search_type:function(b){if($CONFIG.islogin==="0")a.lib.dialog.loginLayer({lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn"});else{y=b.el.getAttribute&&b.el.getAttribute("node-type")=="feed_list_commentTabAll"?!1:!0;H.feed_list_page(b);a.core.evt.preventDefault(b.evt)}},feed_list_page:function(b){if($CONFIG.islogin==="0")a.lib.dialog.loginLayer({lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn"});else{var c=b.el;i.request("commentList",{onSuccess:function(b,e){s.feed_list.innerHTML=b.data.html;y||(A=b.data.html);c.getAttribute("action-type")==="feed_list_page"&&a.scrollTo(d,{step:10,top:40});G(e.filter)},onError:function(b,c){b&&b.code=="100012"&&a.lib.dialog.ioError(b.code,b);s.feed_list.innerHTML=p.noComment},onFail:function(b,c){b&&b.code=="100012"&&a.lib.dialog.ioError(b.code,b);s.feed_list.innerHTML=p.noComment}},b.data);l("_rnd"+ +(new Date));a.core.evt.preventDefault(b.evt)}},anotherSearchTab:function(b){var c=a.sizzle('[action-type="search_type"]',d);for(var e=0;c[e];e++){var f=a.queryToJson(c[e].getAttribute("action-data"));if(b.data.filter==f.filter){b.el=c[e];H.search_type(b);return}}}};for(var I in H)j.add(I,"click",H[I]);a.conf.channel.feed.register("reply",J);if(u){m.add(u,"comment",function(b,c){var d;G("0");s.feed_list.innerHTML=A;d=a.sizzle("[node-type=comment_list]",s.feed_list)[0];c&&a.insertHTML(d,c.html,"afterbegin");a.removeNode(a.sizzle(".WB_empty",s.feed_list)[0]);A=s.feed_list.innerHTML;m.fire(f,"comment")});m.add(u,"forward",function(a,b){m.fire(f,"forward")})}f.isVisible=B;f.destroy=function(){for(var b in H)j.remove(b,"click",H[b]);j.destroy();m.undefine(f,q);x&&x.destroy();u&&u.destroy();v&&v.destroy();a.conf.channel.feed.remove("reply",J);w.destroy()};return f}});
STK.register("conf.trans.block",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("block",{url:"/aj/f/addblack",method:"post"});c("shield",{url:"/aj/filter/block",method:"post"});return b});
STK.register("pl.content.weiboDetail.source.comment.initNew",function(a){var b=a.pl.content.weiboDetail.source.utils,c=a.lib.kit.extra.language,d=a.lib.kit.extra.merge,e=a.conf.trans.block,f=a.getStyle,g=a.setStyle,h=a.sizzle,i=a.lib.comment.reply,j=a.conf.trans.feed.comment,k=a.conf.trans.weiboDetail,l=a.core.util.hideContainer,m=b.feedListDelete,n=a.lib.kit.extra.setPlainHash,o=a.custEvent,p=a.lib.comment.commentTemp,q,r={unReply:c('#L{由于用户设置，你无法回复评论。}<br><a href="http://account.weibo.com/settings/mobile" target="_blank">#L{绑定手机}</a>#L{后可以更多地参与评论。}'),unPower:c("#L{由于用户设置，你无法回复评论。}"),noComment:c("#L{还没有人评论，赶快抢个沙发}")},s='<div class="layer_menu_list">\t<ul>\t\t<li><a href="javascript:void(0);" action-type="sheild_user" >屏蔽 这个用户</a></li>\t\t<li><a href="javascript:void(0);" action-type="sheild_keyword" >屏蔽关键词</a></li>\t</ul></div>',t='<dl class="point clearfix"><dd class="no_ico"><p class="S_txt1">设置 #nickname# 的屏蔽范围，全选即可拉黑用户</p><p class="opt"><label><input #status# node-type="shieldInput" type="checkbox" name="status">不看他的微博</label><span class="sub S_txt2">信息流里不再显示他的微博</span></p><p class="opt"><label><input #interact# node-type="shieldInput" type="checkbox" name="interact">禁止他与我互动</label><span class="sub S_txt2">他无法对我转评赞、@、私信</span></p><p class="opt"><label><input #follow# node-type="shieldInput" type="checkbox" name="follow">禁止他关注我</label><span class="sub S_txt2">解除双方关注关系并禁止他关注我</span></p></dd></dl>',u=["forward","comment","deleteComment"];return function(f,g){function Y(a){Q(a.obj,a.ret)}function W(){for(var a in V){l.remove(a,"click",V[a]);l.add(a,"click",V[a])}}function U(a){return a==w.feed_list?null:a.getAttribute("comment_id")?a:U(a.parentNode)}function T(b){var c=w.feed_cate[1];a.foreach(a.sizzle("[action-type=search_type]",c),function(c){var d=a.queryToJson(c.getAttribute("action-data")||"");d.filter==b?a.addClassName(c,"curr"):a.removeClassName(c,"curr")})}function S(b){var d=b.el,e=b.data.cid,f=b.data.nick,g=b.data.canUploadImage==1,h=b.data.canUploadFunnypic||"0",j=R(b.el,"node-type","root_comment"),k=j?j.getAttribute("comment_id"):"0",l=a.core.dom.dir(d,{dir:"parent",expr:'[node-type="replywrap"]',matchAll:!1})[0],n=a.core.dom.dir(d,{dir:"parent",expr:"li",matchAll:!1})[0],o=d.getAttribute("status"),r=D[e]&&D[e].DOM,s=r?a.core.dom.contains(document.body,r):!1;if(r&&a.getStyle(r,"display")!="none"&&s){a.setStyle(r,"display","none");n&&a.removeClassName(n,"curr")}else{if(!r||!s){r=a.builder(c(p.getReply({canUploadImage:g,canUploadFunnypic:h}))).list.commentwrap[0];var t=R(d,"class","WB_func clearfix");t.appendChild(r);D[e]={handle:i(r,a.lib.kit.extra.merge(b.data,{mid:m,cid:e,content:f,module:"scommlist",dissDataFromFeed:q,root_comment_id:k,approvalComment:w.comment.getAttribute("need_approval_comment")?!0:!1})),DOM:r};forward=a.sizzle("[name=forward]",x)[0];forward&&a.core.dom.dir.parent(forward,{expr:"li"})[0].style.display==="none"&&(a.core.dom.neighbor(r).child("[node-type=forward]").parent("li").finish().style.display="none");a.custEvent.add(D[e].handle,"reply",function(){n&&a.removeClassName(n,"curr");Q.apply(null,arguments)})}n&&a.addClassName(n,"curr");a.setStyle(r,"display","");D[e]&&D[e].handle.focus()}}function R(a,b,c){return a.nodeName=="BODY"||a.nodeName=="body"?null:a.getAttribute(b)==c?a:arguments.callee(a.parentNode,b,c)}function Q(b,c){if(P(b,c)){var d=a.position(a.core.dom.firstChild(w.feed_list)),e=a.scrollPos();d.t<e.top&&window.scrollTo(0,d.t-50)}}function P(b,c){o.fire(h,"comment");c.forward&&o.fire(h,"forward");var d,e;if(c.data.root_comment_id=="undefined"){w.feed_list_commentTabAll.click();d=a.sizzle("[node-type=comment_list]",w.feed_list)[0]}else{e=a.sizzle("[comment_id="+c.data.root_comment_id+"]",w.feed_list)[0];d=a.sizzle("[node-type=child_comment]",e)[0]}a.insertHTML(d,c.data.comment,"afterbegin");var f=d.parentNode.style;f.display=="none"&&(f.display="");E=w.feed_list.innerHTML;if(!e)return!1;var g=a.sizzle("[action-type=click_more_child_comment_big]",e)[0];if(g){var i=a.C("div");i.innerHTML=c.data.comment;var j=a.sizzle("[comment_id]",i)[0],k=j.getAttribute("comment_id"),l=a.queryToJson(g.getAttribute("action-data"));l.child_comment_id_list+=k+"|";g.setAttribute("action-data",a.jsonToQuery(l))}return!1}function O(){H=!1;var b=a.queryToJson(a.parseURL(location.href).query);if("root_comment_id"in b){var c=w.feed_list,d=a.lib.kit.dom.parseDOM(a.builder(c).list),e=a.sizzle("[comment_id="+b.root_comment_id+"]",d.comment_list)[0]||"";if(b.root_comment_id=="0"){window.scrollTo(0,a.position(d.comment_list).t-50);H=!1;return}if(e==""&&"comment_loading"in d){window.scrollTo(0,a.position(c).t+F);H=!0;return}if(!(e!=""||"comment_loading"in d)){H=!1;return}window.scrollTo(0,a.position(e).t-50);H=!1;var f=a.sizzle("[action-type=click_more_child_comment_big]",e)[0]||"";f&&f.click()}}function M(){return f.style.display!="none"}function L(a){if(a.nodeName=="BODY"||a.nodeName=="body")return!1;var b=a.getAttribute("id");return b&&b.indexOf("Pl_Official_WeiboDetail")>-1?!0:L(a.parentNode)}function K(b,c){if(!G){I&&(b.from="singleWeiBo");G=!0;k.request("commentList",{onSuccess:c,onError:function(b,c){b&&b.code=="100012"&&a.lib.dialog.ioError(b.code,b);f.innerHTML=r.noComment;G=!1},onFail:function(b,c){b&&b.code=="100012"&&a.lib.dialog.ioError(b.code,b);f.innerHTML=r.noComment;G=!1}},b)}}function J(a){var b={status:"0",interact:"0",follow:"0",nickname:"这个用户"};a=d(b,a);var c=t;for(var e in b)e=="nickname"?c=c.replace(new RegExp("#"+e+"#","g"),a[e]||"这个用户"):c=c.replace(new RegExp("#"+e+"#","g"),parseInt(a[e])?'checked="checked"':"");return c}var h={},l=a.delegatedEvent(f),m=g.mid,q=g.dissDataFromFeed,v=g.data,w=a.lib.kit.dom.parseDOM(a.builder(f).list),x=w.comment,y,z,A=a.lib.comment.commentMedia(f),B,C=!1,D=[],E="",F=w.feed_list.offsetHeight,G=!1,H=!1,I=!0;o.define(h,u);var N=b.parseForwardActData({},a.core.json.clone(v));N.needFocus=M();N.needFocus=!1;N.dissDataFromFeed=q;y=w.textEl&&a.lib.comment.commentSingle({mid:m},x,N);z=a.lib.dialog.commentDialogue();h.load=function(){K({id:m},function(b,c){E=w.feed_list.innerHTML=b.data.html;W();G=!1;F=w.feed_list.offsetHeight;X.startBuilding();var d=a.URL(window.location).getParam("filter")||"hot";b.data.tag&&b.data.tag=="all"&&(d="all");T(d);d=="all"&&b.data.tag!=="all"&&w.feed_list_commentTabAll.click();O()})};h.hide=function(){f.style.display="none"};h.getNode=function(){return f};h.getComment=function(){return y};var V={reply:function(c){if($CONFIG.islogin!="1")a.lib.dialog.loginLayer({lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn"});else{var d=c.el;if(a.hasClassName(d,"unclick_rep")){var e=d.getAttribute("isPhone");e?a.ui.tipAlert(r.unReply,{icon:"rederrorS"}).beside(d):a.ui.tipAlert(r.unPower,{icon:"rederrorS"}).beside(d);return}c.data&&c.data.ispower=="1"?j.request("isComment",{onComplete:function(b){if(b.code=="100000")S(c);else{if(b.code=="100022")a.ui.tipAlert(r.unPower,{icon:"rederrorS"}).beside(d);else if(b.code=="100001"){d&&d.setAttribute("isphone","1");a.ui.tipAlert(r.unReply,{icon:"rederrorS"}).beside(d)}else a.ui.tipAlert(b.msg,{icon:"rederrorS"}).beside(d);a.addClassName(d,"unclick_rep")}}},c.data):S(c);return b.preventDefault(c.evt)}},commentDialogue:function(a){z.show(a);return b.preventDefault(a.evt)},"delete":function(b){function e(){d(a.core.dom.dir.parent(b.el,{expr:"[comment_id]"})[0]);a.custEvent.fire(h,"deleteComment")}function d(c,d){var e=-10;c.style.height=c.offsetHeight+e+"px";c.style.overflow="hidden";a.tween(c,{end:function(){var d=R(b.el,"node-type","child_comment");a.removeNode(c);d&&a.sizzle("[comment_id]",d).length==0&&(d.parentNode.style.display="none");E=w.feed_list.innerHTML},duration:200}).play({height:0})}var f=b.data.block?['<input node-type="block_user" id="block_user" name="block_user" value="1" type="checkbox"/><label for="block_user">',c("#L{同时将此用户加入黑名单}"),"</label>"].join(""):"",g=a.ui.tipConfirm([c("#L{确认要删除该评论吗？}"),f],{stopClickPropagation:!1}).beside(b.el).ok(function(){var c=g.getDomList(!0).block_user&&g.getDomList(!0).block_user.checked;b.data.is_block=c?"1":"0";b.data.location=$CONFIG.location;k.request("deleteComment",{onSuccess:e,onError:function(b){a.lib.dialog.ioError(b.code,b)},onFail:function(b){a.lib.dialog.ioError(b.code,b)}},b.data)});a.core.evt.preventDefault(b.evt)},search_type:function(b){if($CONFIG.islogin==="0")a.lib.dialog.loginLayer({lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn"});else{C=b.el.getAttribute&&b.el.getAttribute("node-type")=="feed_list_commentTabAll"?!1:!0;V.feed_list_page(b);a.core.evt.preventDefault(b.evt)}},feed_list_page:function(b){if($CONFIG.islogin==="0")a.lib.dialog.loginLayer({lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn"});else{var c=b.el;k.request("commentList",{onSuccess:function(b,d){w.feed_list.innerHTML=b.data.html;C||(E=b.data.html);c.getAttribute("action-type")==="feed_list_page"&&a.scrollTo(f,{step:10,top:40});T(d.filter);F=w.feed_list.offsetHeight;X.removeBuilding();X.startBuilding()},onError:function(b,c){b&&b.code=="100012"&&a.lib.dialog.ioError(b.code,b);w.feed_list.innerHTML=r.noComment},onFail:function(b,c){b&&b.code=="100012"&&a.lib.dialog.ioError(b.code,b);w.feed_list.innerHTML=r.noComment}},b.data);n("_rnd"+ +(new Date));a.core.evt.preventDefault(b.evt)}},anotherSearchTab:function(b){var c=a.sizzle('[action-type="search_type"]',f);for(var d=0;c[d];d++){var e=a.queryToJson(c[d].getAttribute("action-data"));if(b.data.filter==e.filter){b.el=c[d];V.search_type(b);return}}},click_more_child_comment_big:function(b){var c=U(b.el),d=a.sizzle("[node-type=more_child_comment]",c)[0]||null,e=d.parentNode,f=!("child_comment_page"in b.data),g='<div class="WB_empty"><div class="WB_innerwrap"><div class="empty_con clearfix"><p class="text"><i class="W_loading"></i></p></div>                  </div>          </div>',h=function(b,g){if(f){e.style.height="";e.style.width="";b.code=="100000"&&(e.innerHTML=b.data.html);G=!1}else{var h=a.sizzle("[comment_id="+g.last_child_comment_id+"]",c)[0]||null;d&&e.removeChild(d);if(h&&b.code=="100000"){var i=a.sizzle("[node-type=comment_line]",e);i.length&&e.removeChild(i[0]);a.insertHTML(h,b.data.html,"afterend")}G=!1}};if(f){var i=a.sizzle("[comment_id]",e).length;if(i){a.addClassName(e,"list_ul_pos");var j=e.offsetHeight;e.innerHTML=g;e.style.height=j+"px"}else e.innerHTML=g}else{a.hasClassName(e,"list_ul_pos")&&a.removeClassName(e,"list_ul_pos");d.innerHTML=g}K(b.data,h)},click_more_comment:function(b){var c=function(c,d){var e=a.lib.kit.dom.parseDOM(a.builder(w.feed_list).list),f=e.comment_list;f.removeChild(b.el);e.warning&&f.removeChild(e.warning);e.click_more_comment&&f.removeChild(e.click_more_comment);var g=a.C("div");g.innerHTML=c.data.html;var h=a.sizzle("[node-type=comment_list]",g)[0],i=h.innerHTML;a.insertHTML(f,i,"beforeend");F=w.feed_list.offsetHeight;G=!1;W()};K(b.data,c)},shieldComment:function(b){var c=s;b.data.screen_name&&(c=c.replace(/这个用户/,b.data.screen_name));var d=a.ui.mlayer(c,{clickBlankToHide:!0,autoRelease:!0}),f=function(c){var f=c.el.getAttribute("action-type");switch(f){case"sheild_keyword":window.open("http://account.weibo.com/set/shield?where=keyword");break;case"sheild_user":a.ui.confirm(J({status:"0",interact:"1",follow:"0",nickname:b.data.screen_name}),{icon:"",title:"屏蔽用户",OK:function(c){var d={uid:b.data.id,filter_type:1},f=a.sizzle("[node-type=shieldInput]",c.obj._.node);for(var g in f)f[g].checked?d[f[g].name]="1":d[f[g].name]="0";e.request("shield",{onSuccess:function(b){a.ui.notice("设置成功",{icon:"succB"})},onError:function(b){a.lib.dialog.ioError(b.code,b)}},d)}})}d.trigger("hide");d.hide()};d.on("sheild_keyword","click",f);d.on("sheild_user","click",f);d.on("hide",function(){shieldTip.off("sheild_keyword","click",f);shieldTip.off("sheild_user","click",f)});d.show().beside(b.el)}},X={scrollWindow:function(b){if(!G){var c=a.scrollPos().top+a.winSize().height,d=a.position(w.feed_list).t+F*1/2;if(c>=d){var e=a.lib.kit.dom.parseDOM(a.builder(w.feed_list).list);if(!e.comment_loading){X.removeBuilding();return}var f=a.queryToJson(e.comment_loading.getAttribute("action-data"));K(f,function(b,c){var d=e.comment_list;d.removeChild(e.comment_loading);e.warning&&d.removeChild(e.warning);e.click_more_comment&&d.removeChild(e.click_more_comment);var f=a.C("div");f.innerHTML=b.data.html;var g=a.sizzle("[node-type=comment_list]",f)[0],h=g.innerHTML;a.insertHTML(d,h,"beforeend");F=w.feed_list.offsetHeight;G=!1;W();H&&O()})}}},startBuilding:function(){a.addEvent(window,"scroll",X.scrollWindow)},removeBuilding:function(){a.removeEvent(window,"scroll",X.scrollWindow)}};a.conf.channel.feed.register("reply",Y);if(y){o.add(y,"comment",function(b,c){var d;T("all");d=a.sizzle("[node-type=comment_list]",w.feed_list)[0];c&&a.insertHTML(d,c.html,"afterbegin");a.removeNode(a.sizzle(".WB_empty",w.feed_list)[0]);E=w.feed_list.innerHTML;o.fire(h,"comment")});o.add(y,"forward",function(a,b){o.fire(h,"forward")})}h.isVisible=M;h.destroy=function(){for(var b in V)l.remove(b,"click",V[b]);l.destroy();o.undefine(h,u);B&&B.destroy();y&&y.destroy();z&&z.destroy();a.conf.channel.feed.remove("reply",Y);X.removeBuilding();A.destroy()};return h}});
STK.register("lib.forward.source.layer",function(a){var b=a.lib.kit.extra.language,c=a.lib.forward.source;return function(b){function m(a,b){f=a;h=b.mid;i=b.forwardOptions||l;if(j==null){f.innerHTML="";j=!0}}b=b||{};var d={instances:{}},e,f,g,h,i,j,k={1:c.toMicroblog,2:c.toMessage,3:c.toFriends},l={appkey:"",domInit:!1,forwardNick:"",originNick:"",origin:"",reason:"",url:"",styleId:"1",allowComment:"1",allowForward:"1",allowRootComment:"1",uid:"",rootuid:"",pid:""};a.custEvent.define(d,["hide","center","forward"]);var n=function(c){var e;c=c.toString();g!=null&&g.hide();if(d.instances[c]==null){var j={},m;for(var n in l)j[n]=i[n];j.type=c;j.extra=b.extra;j.styleId=b.styleId;m={client:f,data:j,inDialog:!1,isWeiboDetail:!0};e=k[c](f,h,m);d.instances[c]=e;a.custEvent.add(e,"hide",function(){a.custEvent.fire(d,"hide")});a.custEvent.add(e,"center",function(){a.custEvent.fire(d,"center")});a.custEvent.add(e,"forward",function(b,c){a.custEvent.fire(d,"forward",c)})}else{e=d.instances[c];e.reset&&e.reset()}e.show();g=e},o=function(a){d.instances[a||"1"].shine()},p=function(){for(var c in d.instances){var e=d.instances[c];e.destory();e=null}d.instances=null;a.custEvent.undefine(d);tab=null;f=null;g=null;h=null;b=null};d.init=m;d.shine=o;d.show=n;d.destory=p;return d}});
STK.register("pl.content.weiboDetail.source.forward.media",function(a){var b=a.lib.feed.feedTemps.mediaIMGTEMP,c=a.core.util.easyTemplate,d=a.lib.kit.extra.language,e=d("#L{加载失败}!"),f=d("#L{很抱歉，该内容无法显示，请稍后再试。}"),g=d("#L{操作失败，请稍候重试。}"),h=450,i=function(b){return a.core.dom.dir(b,{expr:"[mid]"})[0]},j=function(b){var c=b.getAttribute("mid")?b:i(b);return{prev:a.sizzle("[node-type=comment_media_prev]",c)[0],disp:a.sizzle("[node-type=comment_media_disp]",c)[0]}},k=function(e,f){var g=e.el,k=e.data,l=decodeURIComponent(k.pic_objects||""),m=l.split("|");if(!g.loading){g.tagName.toLowerCase()!=="img"&&(g=a.sizzle("img",g)[0]);g.loading=1;var n=/\/thumbnail\/.+(?=\.\w+)/.exec(g.src);n&&(n=n[0].replace("/thumbnail/",""));var o=g.src.replace("/thumbnail/","/bmiddle/"),p=i(g),q=p.getAttribute("mid"),r="pid="+(k.pid?k.pid:n)+"&mid="+(k.mid?k.mid:q),s,t,u=j(p),v=function(){g.loading=0;if(s){g.bigImgWidth=s.width;s.onload=null}t&&(t.style.display="none");u.prev.style.display="none";u.disp.innerHTML="";u.disp.appendChild(a.builder(c(d(b),{uniqueId:a.core.util.getUniqueKey(),bigSrc:o,acdata:r,pid:k.pid?k.pid:n,mid:k.mid,object_id:m[3],bigWidth:g.bigImgWidth>h?h:g.bigImgWidth,suda:{retract:"key=feed_image_click&value=image_zoomout",showBig:"key=transmit_pic&value=transmit_pic_big",left:"key=feed_image_click&value=image_turnlift",right:"key=feed_image_click&value=image_turnright",big:"key=feed_image_click&value=image_zoomout"}}).toString()).box);u.disp.style.display=""};if(g.bigImgWidth)v();else{var w=g.offsetWidth,x=parseInt(g.offsetHeight/2-8);(t=a.core.dom.next(g)).style.cssText="margin:"+x+"px "+parseInt(w/2-8)+"px "+x+"px -"+parseInt(w/2+8)+"px;";(s=new Image).onload=v;s.src=o}}},l=function(b,c,d){var e=b.el;if(!!d||!!/(img)|(canvas)/.test(b.evt.target.tagName.toLowerCase())){var f=i(e);if(!f){a.log("parents attribute mid is undefined!");return}f.disp="";var g=j(f);if(!g||!g.prev||!g.disp){a.log('node-type="comment_media_prev" or node-type="comment_media_disp" in a feed\'s node is undefined!');return}a.position(g.disp).t<a.scrollPos().top&&f.scrollIntoView();g.prev.style.display="";g.disp.style.display="none";g.disp.innerHTML=""}},m=function(b,c,d){var e=b.el,f=i(e);if(!e.parentNode.uid){var g=a.sizzle('img[action-type="feed_list_media_bigimg"],canvas[id]',f)[0];e.parentNode.uid="rotate_img_"+a.core.dom.uniqueID(g.oImage||g);g.setAttribute("id",e.parentNode.uid)}a.lib.kit.dom.rotateImage.rotateRight(a.E(e.parentNode.uid),d,h)};return function(b){var c=a.delegatedEvent(b),d={};c.add("feed_list_media_img","click",function(c){a.lib.kit.extra.feedControlHash();k(c,b);return a.preventDefault(c.evt)});c.add("comment_media_img","click",function(c){a.lib.kit.extra.feedControlHash();k(c,b);return a.preventDefault(c.evt)});c.add("feed_list_media_toSmall","click",function(c){l(c,b,!0);return a.preventDefault(c.evt)});c.add("feed_list_media_bigimgDiv","click",function(c){l(c,b);return a.preventDefault(c.evt)});c.add("feed_list_media_toRight","click",function(c){m(c,b,90);return a.preventDefault(c.evt)});c.add("feed_list_media_toLeft","click",function(c){m(c,b,-90);return a.preventDefault(c.evt)});d.destroy=function(){c.destroy()};return d}});
STK.register("pl.content.weiboDetail.source.forward.init",function(a){var b=a.lib.kit.extra.language,c=a.conf.trans.weiboDetail,d=a.lib.kit.extra.setPlainHash,e=a.core.json.merge,f={noForwward:b("#L{还没有人转发，赶快抢个沙发}"),notAllowForwward:b("#L{还没有人转发，赶快抢个沙发}"),notAllowComment:b("#L{还没有人转发，赶快抢个沙发}")},g=["forward","comment","deleteForward"];return function(h,i){function x(b,c,d){if(!d){t("0");a.custEvent.fire(j,"forward");k.feed_list.innerHTML=p;a.insertHTML(k.feed_list,b.html,"afterbegin");a.removeNode(a.sizzle(".WB_empty",k.feed_list)[0]);p=k.feed_list.innerHTML}}function u(b){var c=a.core.json.clone(n);if(c.allowComment=="0"&&c.ispower=="1"){delete c.originNick;delete c.forwardNick}else c.allowRootComment=="0"&&c.ispower=="1"&&delete c.originNick;r.show({microblog:1,privatemsg:2}[b||"microblog"])}function t(b){var c=k.feed_cate;a.foreach(a.sizzle("[action-type=search_type]",c),function(c){var d=a.queryToJson(c.getAttribute("action-data")||"");d.filter==b?a.addClassName(c,"curr"):a.removeClassName(c,"curr")})}function s(){return h.style.display!="none"}var j={},k=a.lib.kit.dom.parseDOM(a.builder(h).list),l=a.delegatedEvent(h),m=i.mid,n=i.forwardOptions,o=a.pl.content.weiboDetail.source.forward.media(h),p="",q=!1;a.custEvent.define(j,g);var r=a.lib.forward.source.layer({styleId:"2"});r.init(k.forward,i);j.load=function(){k.forwardTip&&(k.forwardTip.style.display="");c.request("forwardList",{onSuccess:function(a,b){p=k.feed_list.innerHTML=a.data.html;t("0")},onError:function(a,b){k.feed_list.innerHTML=f.noForwward},onFail:function(a,b){k.feed_list.innerHTML=f.noForwward}},{id:m});r.show(1)};j.hide=function(){h.style.display="none"};j.getNode=function(){return h};j.getForwardDiv=function(){return r};var v={forword_tab_click:function(b){if(b.evt.clientX!=undefined&&$CONFIG.islogin==="0")a.lib.dialog.loginLayer({lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn"});else{var c=b.el,d=b.el.getAttribute("action-data");a.foreach(a.sizzle("li",k.forward_tab),function(b){if(a.contains(b,c)){a.addClassName(b,"current");a.addClassName(a.sizzle("a",b)[0],"S_bg2")}else{a.removeClassName(b,"current");a.removeClassName(a.sizzle("a",b)[0],"S_bg2")}});u(d);a.core.evt.preventDefault(b.evt)}},search_type:function(b){if($CONFIG.islogin==="0")a.lib.dialog.loginLayer({lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn"});else{q=b.el.getAttribute&&b.el.getAttribute("node-type")=="feed_list_commentTabAll"?!1:!0;v.feed_list_page(b);a.core.evt.preventDefault(b.evt)}},feed_list_page:function(b){if($CONFIG.islogin==="0")a.lib.dialog.loginLayer({lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn"});else{var e=b.el;c.request("forwardList",{onSuccess:function(b,c){k.feed_list.innerHTML=b.data.html;q||(p=b.data.html);e.getAttribute("action-type")==="feed_list_page"&&a.scrollTo(h,{step:10,top:40});t(c.filter)},onError:function(a,b){k.feed_list.innerHTML=f.noComment},onFail:function(a,b){k.feed_list.innerHTML=f.noComment}},b.data);d("_rnd"+ +(new Date));a.core.evt.preventDefault(b.evt)}},feed_list_delete:function(d){function f(){e(a.core.dom.dir.parent(d.el,{expr:"[action-type=feed_list_item]"})[0]);a.custEvent.fire(j,"deleteForward")}function e(b,c){var d=-10;b.style.height=b.offsetHeight+d+"px";b.style.overflow="hidden";a.tween(b,{end:function(){a.removeNode(b);p=k.feed_list.innerHTML},duration:200}).play({height:0})}a.ui.tipConfirm(b("#L{确认要删除这条微博吗？}")).beside(d.el).ok(function(){c.request("deleteFeed",{onSuccess:f},d.data)});a.core.evt.preventDefault(d.evt);a.stopEvent(d.evt)},feed_list_forward:function(b){if($CONFIG.islogin==="0")a.lib.dialog.loginLayer({lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn"});else{var c=a.core.dom.dir.parent(b.el,{expr:"[mid]"})[0],d=c.getAttribute("mid"),f=a.sizzle(".WB_text [node-type=name]",c)[0].innerHTML,g=a.sizzle(".WB_text [node-type=text]",c)[0].innerHTML,h=a.lib.forward.forwardDialog(d,e(b.data,{forwardNick:f,originNick:n.originNick,origin:n.origin,reason:g}));a.custEvent.once(h,"forward",function(a,c){c.isToMiniBlog&&b.el.innerHTML.indexOf("万")<0&&(b.el.innerHTML=b.el.innerHTML.replace(/\d+/,function(a){return parseInt(a)+1}))});a.lib.kit.extra.feedControlHash()}},anotherSearchTab:function(b){var c=a.sizzle('[action-type="search_type"]',h);for(var d=0;c[d];d++){var e=a.queryToJson(c[d].getAttribute("action-data"));if(b.data.filter==e.filter||b.data.filter=="hot"){b.el=c[d];v.search_type(b);return}}}};for(var w in v)l.add(w,"click",v[w]);a.conf.channel.feed.register("forward",x);s()&&l.fireDom(a.sizzle("[action-type=forword_tab_click]",h)[0],"click",null);j.isVisible=s;j.destroy=function(){for(var b in v)l.remove(b,"click",v[b]);l.destroy();a.custEvent.undefine(j,g);a.conf.channel.feed.remove("forward",x);o.destroy()};return j}});
STK.register("lib.feed.plugins.likeWhiteList",function(a){var b=a.conf.trans.feed.feed,c="wb_cusLike_"+$CONFIG.uid,d;return function(){var e=a.cookie.get(c),f=720;e=="Y"?d=!0:e=="N"?d=!1:b.request("getCuslikeWhiteList",{onSuccess:function(b){if(b.code=="100000"){d=!0;a.cookie.set(c,"Y",{expire:f});return d}},onError:function(){d=!1;a.cookie.set(c,"N",{expire:f});return d},onFail:function(){console.log("fail");return d}},{});return d}});
STK.register("pl.content.weiboDetail.source.like.polymorphicLike",function(a){var b='<div class="W_layer W_layer_pop W_layer_attitude" node-type="outer" style="visibility:hidden;"><div class="content" action-type="content"><!--自定义区域--><div class="layer_attitude state1" node-type="attr_outer"><ul class="clearfix"><li action-type="attr_item" action-data="qid=sad&floating=1" class=""><div class="W_ani_att W_ani_att_sad"></div><span class="att_pop">悲伤</span></li><li action-type="attr_item" action-data="qid=angry&floating=1" class=""><div class="W_ani_att W_ani_att_angry"></div><span class="att_pop">愤怒</span></li><li action-type="attr_item" action-data="qid=surprise&floating=1" class=""><div class="W_ani_att W_ani_att_surprised"></div><span class="att_pop">惊讶</span></li><li action-type="attr_item" action-data="qid=happy&floating=1" class=""><div class="W_ani_att W_ani_att_happy"></div><span class="att_pop">高兴</span></li><li action-type="attr_item" action-data="qid=heart&floating=1" class=""><div class="W_ani_att W_ani_att_like"></div><span class="att_pop">赞</span></li></ul><p node-type="attr_tip" style="display:none"><span class="att_pop">选择一个态度</span></p></div><!--/自定义区域--><div class="W_layer_arrow"><span node-type="arrow" class="W_arrow_bor W_arrow_bor_b"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div></div>',c='<span class="pos"><span class="line S_line1"><span node-type="like_status" class="WB_attitude"><i class="W_icon {{likeStyle}}"></i><em>{{likeNum}}</em></span></span></span>',d='<span class="pos"><span class="line S_line1"><span node-type="like_status" class=""><em class="W_ficon ficon_praised S_txt2">ñ</em><em>{{likeNum}}</em></span></span></span>',e={heart:"icon_att_like",angry:"icon_att_angry",surprise:"icon_att_surprised",sad:"icon_att_sad",happy:"icon_att_happy"},f="赞",g='<div class="WB_empty"> <div class="WB_innerwrap"> <div class="empty_con clearfix"> <p class="text"><i class="W_loading"></i>正在加载，请稍候...</p> </div> </div> </div>',h='<div class="W_layer_tips" node-type="outer">    <div class="W_layer_close"><a href="javascript:void(0);" action-type="close" class="W_ficon ficon_close S_ficon">X</a></div>        <div class="content" action-type="content">            <div class="txt">                <p>{{content}}</p>            </div>        </div>    <div class="W_layer_arrow"><span node-type="arrow" class="W_arrow_bor W_arrow_bor_t"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div>',i="试试将鼠标停在这里，选择态度",j="鼠标悬停更改表态，点击可以取消",k=a.core.dom.removeClassName,l=a.core.dom.addClassName,m=a.conf.trans.feed.attitude,n=a.core.util.storage,o=a.lib.kit.dom.parentElementBy;return function(j,p){var q=null,r=null,s=null,t,u=!1,v=null,w=null,x,y=!1,z=!1,A=null,B=!1,C=500,D={likeLayerShow:function(c){if(s){if(s.besideWhere==c&&v.outer.style.visibility=="")return;D.destroyLikeLyaerEvt();s.hide();s.destroy();s=null;v=null}s=a.ui.bubble(b,{clickBlankToHide:!0,stopClickPropagation:!0,autoRelease:!0,showWithAni:"",hideWithAni:""});s.besideWhere=c;var d=a.queryToJson(c.getAttribute("action-data")),e=5;d.cuslike&&d.cuslike==1&&(e=15);s.show().beside(c,{offsetX:0,offsetY:e});v=s.getDomList();D.bindLikeLayerEvt();t=setTimeout(function(){v&&v.outer&&(v.outer.style.visibility="")},800)},likeLayerHide:function(){if(s){D.destroyLikeLyaerEvt();s.hide();s.destroy();s=null;v=null}},bindLikeLayerEvt:function(){s.on("content","mouseover",E.bubenter);s.on("content","mouseout",E.bubout);s.on("attr_item","mouseover",E.bubItemEnter);s.on("attr_item",a.lib.kit.touch.cantouch?"tap":"click",E.bubItemlclick)},destroyLikeLyaerEvt:function(){if(s&&s._){s.off("content","mouseover",E.bubenter);s.off("content","mouseout",E.bubout);s.off("attr_item","mouseover",E.bubItemEnter);s.off("attr_item",a.lib.kit.touch.cantouch?"tap":"click",E.bubItemlclick)}},hasNode:function(a,b){return a?a==document.body?!1:a==b?!0:D.hasNode(a.parentNode,b):!1},getLikeNum:function(b){var c=a.sizzle("[node-type=like_status]",b)[0],d=a.lib.kit.dom.children(c),e=d[1],f=e.innerText?e.innerText:e.textContent;return f},requestLike:function(b){m.getTrans("miniadd",{onSuccess:function(a){},onFail:function(c){b.el.isLiked>0?D.changeLikeNum(b.el,-1):D.changeLikeNum(b.el,-1);b.el.isLiked=b.el.isLiked-b.el.isLiked*2;a.lib.dialog.ioError(c.code,c)},onError:function(c){b.el.isLiked>0?D.changeLikeNum(b.el,-1):D.changeLikeNum(b.el,-1);b.el.isLiked=b.el.isLiked-b.el.isLiked*2;a.lib.dialog.ioError(c.code,c)}}).request(b.data)},changeLikeNum:function(b,c){var d=a.sizzle("[node-type=like_status]",b)[0],e=a.lib.kit.dom.children(d),g=e[1],h=g.innerText?g.innerText:g.textContent;if(!(h.indexOf("万")>0)){h=h==f?0:parseInt(h);g.innerHTML=h+c<=0?f:h+c}},isChildNode:function(a,b,c){return a==c||a==document.body?!1:a==b?!0:D.isChildNode(a.parentNode,b,c)},getLikeList:function(b,c){var d=j,e=o(c.el,d,function(a){if(a.getAttribute("node-type")=="feed_list_forwardContent")return!0});if(!e){var f=a.sizzle("[node-type=like_detail]",d)[0],h=a.sizzle("[node-type=like_list_ul]",d)[0];if(c.method){var i=a.sizzle("[action-type=feed_like_more]",h)[0];if(i){h.removeChild(i);a.core.dom.insertHTML(h,'<div node-type="like_loading">'+g+"</div>","beforeend")}}else{f.innerHTML=g;f.style.display=""}m.getTrans("likelist",{onSuccess:function(b){if(c.method){var d=a.sizzle("[node-type=like_loading]",h);for(var e in d)h.removeChild(d[e]);a.core.dom.insertHTML(h,a.builder(b.data.html).list.like_list_ul[0].innerHTML,"beforeend")}else f.innerHTML=b.data.html;A=a.sizzle("[node-type=like_loading]",f)[0];A=A?A:null;c.success&&c.success()},onFail:function(b){a.lib.dialog.ioError(b.code,b);c.fail&&c.fail()},onError:function(b){a.lib.dialog.ioError(b.code,b);c.fail&&c.fail()}}).request(b||{})}},setPos:function(a,b,c){a.getBox().style.position="absolute";if(a.getState()){var d=a.getBox().parentNode,e=d&&a.getBox().nextSibling;a.setArrow("bottom").setAlignPos(b,c,{offset:{left:-1,top:-100}});e&&d.insertBefore(a.getBox(),e)}},showTip:function(b,c,d){w&&w.hide&&w.hide();w=a.ui.bubble(h.replace(/{{content}}/g,b),{clickBlankToHide:!0,stopClickPropagation:!0,autoRelease:!0,showWithAni:"fadeInDown:slow",hideWithAni:"fadeOutUp:slow"});setTimeout(function(){w.show().beside(c);w.on("close","click",function(){w&&w.hide&&w.hide()});w.on("show",function(){setTimeout(function(){w&&w.hide&&w.hide()},3e3)});D.setPos(w,c,d)},3e3)},hideTip:function(){w&&w.hide&&w.hide()}},E={like:function(b){b.el.isClick=!0;if(b.data.loc=="profile"){if(b.data.hide_multi_attitude=="1"){b.data.floating=0;p&&p.like&&p.like(b);return}if(b.data.object_type==="comment"||b.data.object_id){b.data.floating=0;p&&p.like&&p.like(b);return}var c=a.sizzle("[node-type=like_status]",b.el)[0];if(D.isChildNode(b.evt.target,c,b.el)){b.data.floating=0;var e;b.el.isLiked?e=b.el.isLiked:a.sizzle("em.ficon_praised",b.el).length?e=0:e=2;if(!e||e==1||e==0||e==-1){b.data.qid="heart";p&&p.like&&p.like(b);e=e>0?-1:1;b.el.isLiked=e}else{if(e==2){e=-2;D.changeLikeNum(b.el,-1);var f=D.getLikeNum(b.el);b.el.innerHTML=d.replace(/{{likeNum}}/g,f)}else{e=2;D.changeLikeNum(b.el,1)}b.el.isLiked=e;D.requestLike(b)}e==-2&&(b.el.isLiked=0)}}},likeenter:function(a){if(a.data.hide_multi_attitude!="1"){if(a.data.object_type==="comment"||a.data.object_id)return;t=setTimeout(function(){if(a.el.isClick)a.el.isClick=!1;else{D.likeLayerShow(a.el);u=!0}},50)}},likeout:function(a){if(a.data.hide_multi_attitude!="1"){if(a.data.object_type==="comment"||a.data.object_id)return;t&&clearTimeout(t);v&&!D.hasNode(a.evt.toElement,a.el)&&!D.hasNode(a.evt.toElement,v.outer)&&(u=!1);setTimeout(function(){u||D.likeLayerHide()},C)}},bubenter:function(){u=!0},bubout:function(a){v&&!D.hasNode(a.evt.toElement,a.el)&&!D.hasNode(a.evt.toElement,v.outer)&&(u=!1);setTimeout(function(){u||D.likeLayerHide()},C)},bubItemEnter:function(b){var c=v.outer,d=a.sizzle("[action-type=attr_item]",c);v.attr_tip.style.display="none";for(var e in d)k(d[e],"curr");l(b.el,"curr");l(v.attr_outer,"state2")},bubItemlclick:function(b){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("like_click",b.data.qid=="heart"?"dianzan":b.data.qid);var d=a.queryToJson(s.besideWhere.getAttribute("action-data")),g={},h=s.besideWhere.isLiked?s.besideWhere.isLiked:0;s.besideWhere.innerHTML=c.replace(/{{likeStyle}}|{{likeNum}}/g,function(a){var c="";switch(a){case"{{likeStyle}}":c=e[b.data.qid];break;case"{{likeNum}}":if(h&&h>0){var d=D.getLikeNum(s.besideWhere);c=d}else{var d=D.getLikeNum(s.besideWhere);d.indexOf("万")>0?c=d:c=d==f?1:parseInt(d)+1}h=2}return c});s.besideWhere.isLiked=h;g=a.core.json.merge(g,b.data);d=a.core.json.merge(d,g);s.besideWhere.setAttribute("action-data",a.jsonToQuery(d));D.requestLike({data:d,el:s.besideWhere});D.likeLayerHide()},more_like_statue:function(a){D.getLikeList(a.data,a)},feed_like_list_page:function(a){D.getLikeList(a.data,a)},feed_like_more:function(b){D.getLikeList(b.data,a.core.json.merge(b,{method:1}))},winscroll:function(b){if(A){var c=a.core.util.scrollPos().top+a.core.util.winSize().height,d=a.core.dom.position(A).t;if(c>d&&!B){B=!0;var e=a.queryToJson(A.getAttribute("action-data")),f=a.sizzle("[action-type=fl_like] [node-type=like_status]",p.args.node)[0];e.issingle=1;D.getLikeList(e,{el:f,success:function(){B=!1},fail:function(){B=!1},method:1})}}}},F=function(){y=parseInt(n.get("isFirstLogin"));var b=a.sizzle("[action-type=fl_like]",j)[0];if(!b)y=!1;else{var c=a.core.dom.dir.parent(b,{expr:"li"})[0];if(!y){n.set("isFirstLogin","1");y=!0;D.showTip(i,b,c)}}},G=function(){q.add("fl_like",a.lib.kit.touch.cantouch?"tap":"click",E.like);q.add("more_like_statue","click",E.more_like_statue);q.add("feed_like_list_page","click",E.feed_like_list_page);q.add("feed_like_more","click",E.feed_like_more);a.addEvent(window,"scroll",E.winscroll);setTimeout(function(){q.add("fl_like","mouseover",E.likeenter);q.add("fl_like","mouseout",E.likeout)},1e3)},H=function(){q=a.delegatedEvent(j)},I=function(){H();G()},J={start:I,destroy:function(){q.remove("fl_like",a.lib.kit.touch.cantouch?"tap":"click",E.like);q.remove("fl_like","mouseover",E.likeenter);q.remove("fl_like","mouseout",E.likeout);q.remove("more_like_statue","click",E.more_like_statue);q.remove("feed_like_list_page","click",E.feed_like_list_page);q.remove("feed_like_more","click",E.feed_like_more);a.removeEvent(window,"scroll",E.winscroll)},getLikeList:function(){var b=a.sizzle("[action-type=fl_like] [node-type=like_status]",p.args.node)[0],c=a.core.dom.dir.parent(b,{expr:"ul"})[0],d=a.sizzle("li",c),e=a.core.dom.dir.parent(b,{expr:"li"})[0];if(!!(c&&d&&e)){for(var f in d)k(d[f],"curr");l(e,"curr");var g=a.core.util.URL(location.href).getParam("filter");D.getLikeList({mid:j.getAttribute("mid"),issingle:1,type:g?g:0},{el:b})}}};return J}});
STK.register("pl.content.weiboDetail.source.like.init",function(a){var b=a.conf.trans.feed.attitude,c=a.pl.content.weiboDetail.source.utils,d=a.lib.kit.extra.language,e=a.lib.dialog.tipAlert,f=a.core.dom.firstChild,g=a.core.dom.dir,h=a.removeNode,i=a.custEvent,j,k=a.sizzle,l,m=a.lib.dialog.validateCode(),n="wb_cusLike_"+$CONFIG.uid,o=!0,p=d("#L{接口请求失败}!"),q=["add","edit"],r=a.builder(d('<div class="WB_empty" node-type="faceEmpty"><div class="WB_innerwrap"><div class="empty_con clearfix"><p class="icon_bed"><i class="W_icon icon_warnB"></i></p><p class="text">#L{还没有人赞过这条微博，赶快抢个沙发！}</p></div></div></div>')).list.faceEmpty[0],s='<a title="删除" class="W_ico12 icon_close_bg" href="javascript:void(0);" action-type="like_del" ></a>',t=function(){var a=document.body.style,b=a.WebkitAnimation!==undefined?"-webkit-":a.webkitAnimation!==undefined?"-webkit-":a.MozAnimation!==undefined?"-moz-":a.OAnimation!==undefined?"-o-":a.msAnimation!==undefined?"-ms-":a.animation!==undefined?"":!1;return!!b}();return function(f,g){function K(){var b=a.cookie.get(n),c=.25;b=="Y"?o=!0:b=="N"?o=!1:a.conf.trans.feed.attitude.request("getCuslikeWhiteList",{onSuccess:function(b){if(b.code==1e5){o=!0;a.cookie.set(n,"Y",{expire:c})}},onError:function(){o=!1;a.cookie.set(n,"N",{expire:c})},onFail:function(){console.log("fail")}},{})}function J(a){I(parseInt(a.data.page,10));return c.preventDefault(a.evt)}function I(c){D=!0;b.request("likebig",{onSuccess:function(b){f.innerHTML=b.data.html;l=a.lib.kit.dom.parseDOM(a.builder(f).list);D=!1;var c;while(c=E.pop())c();A()},onFail:function(b){D=!1;a.lib.dialog.ioError(b.code,b)},onError:function(b){D=!1;a.lib.dialog.ioError(b.code,b)}},{mid:k,page:c||1})}function H(c){function B(){p.likeStatus===undefined&&(k.liked?p.likeStatus=!!parseInt(k.liked):p.likeStatus=!!a.core.dom.hasClassName(q,"UI_ani_praised"));if(!v){v=a.C("em");a.insertAfter(v,t)}if(v.innerHTML.indexOf("万")>0)p.likeStatus=p.likeStatus?0:1;else{var b=x=v.innerHTML|0;x=Math.max(0,b+(p.likeStatus?-1:1));p.likeStatus=x>=b?1:0;v.innerHTML=x===0?d("#L{赞}"):x}}function z(b){delete p.isRequest;a.lib.dialog.ioError(b.code,b)}function y(b){h&&h.title&&(h.title=p.likeStatus?"取消赞":"赞");p.uninterruptedClick=!0;delete p.isRequest;p.inCallback=!b.data.is_del;if(p.inCallback&&p.likeStatus){a.removeNode(a.sizzle("li[uid="+$CONFIG.uid+"]",l.faceS)[0]);a.insertHTML(l.faceS,b.data.html,"afterbegin")}else a.removeNode(a.sizzle("li[uid="+$CONFIG.uid+"]",l.faceS)[0]);A();a.conf.channel.like.fire(p.inCallback?"like":"unlike",k);delete p.uninterruptedClick}p=a.sizzle("[action-type=fl_like] [node-type=like_status]",g.node)[0];if(!p.animation){if(p.uninterruptedClick)return;var h=a.core.dom.dir.parent(p,{expr:"[action-type=fl_like]",endpoint:g.node})[0],i=a.core.dom.dir.parent(p,{expr:"[action-type=feed_list_item]",endpoint:f})[0];if(i){var j=a.queryToJson(i.getAttribute("data-fake")||"");if(j&&j.isFake==1&&j.mlevel&&j.mlevel&512){e(j);return a.core.evt.stopEvent(c)}}var k=a.queryToJson(h.getAttribute("action-data")||"");k=a.core.json.merge(u,k);var n=k.cuslike,q=a.sizzle("[node-type=like_status]",p)[0]?a.sizzle("[node-type=like_status]",p)[0]:p,r=a.lib.kit.dom.children(q),t=r[0],v=r[1],w=a.core.dom.hasClassName(t,"W_ficon"),x=v.innerText?v.innerText:v.textContent;B();if(w)if(p.likeStatus){n&&o&&s&&(s.style.display="");a.removeClassName(q,"UI_ani_praised");a.addClassName(q,"UI_ani_stepsV1");p.animation=setTimeout(function(){if(n&&o&&s){a.removeClassName(s.children[0],"UI_ani");a.addClassName(s.children[0],"UI_animated UI_speed_normal UI_ani_fadeOut")}a.removeClassName(q,"UI_ani_stepsV1");a.addClassName(q,"UI_ani_praised");setTimeout(function(){if(n&&o&&s){s.style.display="none";a.addClassName(s.children[0],"UI_ani");a.removeClassName(s.children[0],"UI_animated UI_speed_normal UI_ani_fadeOut")}delete p.animation},500)},700)}else a.removeClassName(q,"UI_ani_praised");else if(p.likeStatus){p.animation=!0;a.ui.effect(t,"bounce","200",function(){delete p.animation;a.removeClassName(t,G);a.addClassName(t,F)})}else{a.removeClassName(t,F);a.addClassName(t,G)}p.isRequest||(p.isRequest=setTimeout(function(){createTrans=b.getTrans("miniadd",{onComplete:function(a,b){var c={onSuccess:y,onError:z,requestAjax:createTrans,param:k,onRelease:function(){clearTimeout(p.isRequest);delete p.isRequest}};m.validateIntercept(a,b,c)},onFail:z},k);createTrans.request(k)},2e3))}}function A(){a.sizzle("li",f).length?r&&a.removeNode(r):r&&l.faceList&&l.faceList.appendChild(r)}function z(){return f.style.display!="none"}var h={},j=a.delegatedEvent(f),k=g.mid,l=a.lib.kit.dom.parseDOM(a.builder(f).list),p=a.sizzle("[action-type=fl_like] [node-type=like_status]",g.node)[0],s=a.sizzle("[node-type=templeLike_ani]")[0],t=!1,u=g.dissDataFromFeed,v=a.core.dom.dir.parent(p,{expr:"[action-type=fl_like]",endpoint:g.node})[0],w=a.queryToJson(v.getAttribute("action-data")||""),x=w.hide_multi_attitude?0:1,y=a.pl.content.weiboDetail.source.like.polymorphicLike(a.core.dom.dir.parent(p,{expr:"[action-type=feed_list_item]",endpoint:f})[0],{like:H,args:g}),B=z(),C,D=!1,E=[],F=x?"":"icon_praised_bc",G=x?"":"icon_praised_b";h.load=function(){t||(x?y.getLikeList():I());t=!0};h.hide=function(){f.style.display="none"};h.getNode=function(){return f};i.define(h,q);x?y.start():a.addEvent(p,"click",H);j.add("feed_list_page","click",J);h.isVisible=z;h.destroy=function(){i.undefine(h,q);a.removeEvent(p,"click",H);j.remove("feed_list_page","click",J)};return h}});
STK.register("pl.content.weiboDetail.source.autoFocus",function(a){return function(b,c){if(!a.isNode(b))throw"[weiboDetail.source.autoFocus] need node as first parameter!";var d,e={},f,g,h,i=0,j,k=a.parseParam({countMax:6,stepTime:300},c||{}),l=function(){d=a.builder(b).list;f=d.comment_counter&&d.comment_counter[0];g=d.forward_counter&&d.forward_counter[0];h=d.like_counter&&d.like_counter[0]},m=function(b,c){var c=c==undefined?40:c;a.scrollTo(b,{top:c})},n=function(){return!!a.sizzle("[action-type=feed_list_media_bigimg]",b)[0]},o=function(a){return d[a]&&d[a][0]&&d[a][0].style.display!="none"?!0:!1},p=function(){return o("comment_detail")?f:o("forward_detail")?g:o("like_detail")?h:f||g||h||b},q=function(){var c=a.queryToJson(a.lib.kit.extra.parseURL().query);if(c.type)switch(c.type){case"comment":if(!a.isNode(f))break;a.fireEvent(f,"click");break;case"repost":if(!a.isNode(g))break;a.fireEvent(g,"click");break;case"like":if(!a.isNode(h))break;m(h);break;default:var d=f||g||h||b;m(d)}},r=function(){var c=a.sizzle(".loading_gif",b);window.setTimeout(function(){if(c[0]){j&&clearInterval(j);j=window.setInterval(function(){i++;if(n()){q();window.clearInterval(j);j=undefined}if(i>k.countMax){window.clearInterval(j);j=undefined;q()}},k.stepTime)}else q()},200)},s=function(){l();r()};s();e.destroy=function(){d=commet=h=g=null;j&&window.clearInterval(j)};return e}});
STK.register("pl.content.weiboDetail.source.init",function(a){var b=a.custEvent,c=a.pl.content.weiboDetail.source.utils,d=a.pl.content.weiboDetail.source.feedList,e=a.pl.content.weiboDetail.source.forward.init,f=a.pl.content.weiboDetail.source.like.init,g,h=a.lib.dialog.tipAlert;return function(b){function y(b){a.contains(i.feed_list_options[0],b.el)&&x({fl_comment:"comment",fl_forward:"repost",fl_like:"like"}[b.el.getAttribute("action-type")])}function x(b){var c=a.queryToJson(p.getAttribute("data-fake")||"");if(c)var d={repost:2,comment:16,like:512}[b];if(c&&c.isFake==1&&c.mlevel&&c.mlevel&d)h(c);else{!u&&b==="repost"&&(b="comment");!v&&b==="like"&&(b="comment");a.foreach(w,function(c,d){if(b===d&&c.tab){c.ctnt.style.display="";a.addClassName(c.tab,"curr");c.ctxt&&c.ctxt.load();$CONFIG.bigpipe==="true"&&FM.replaceQuery({type:b},!1)}else{c.ctnt.style.display="none";c.tab&&a.removeClassName(c.tab,"curr")}})}}function l(b,c){var d=a.sizzle("span.line",b)[0],e=!1,f=a.sizzle("em",d)[1];if(!f||!/万/.test(f.innerHTML)){d.innerHTML=d.innerHTML.replace(/\d+/,function(a){e=!0;var b=c?parseInt(a)+1:parseInt(a)-1;return b<=0?"":b});!e&&c===!0&&(d.innerHTML+=" 1")}}function k(b){var c=a.sizzle("[action-type="+b+"]",i.feed_list_options[0])[0];return c?a.core.dom.dir.parent(c,{expr:"li"})[0]:null}var i=a.builder(b).list,j=a.delegatedEvent(b);"root_child_comment_build"in i?g=a.pl.content.weiboDetail.source.comment.initNew:g=a.pl.content.weiboDetail.source.comment.init;var m=k("fl_comment"),n=k("fl_forward"),o=k("fl_like"),p=a.sizzle("[action-type=feed_list_item]",b)[0],q=p.getAttribute("mid"),r=a.lib.kit.extra.getDiss(p);forwardOptions=n?c.getForwardOptions(i.feed_list[0]):{};forwardOptions.dissDataFromFeed=r;var s=d(i.feed_list[0],{isWeiboDetail:1,plNode:b}),t=g(i.comment_detail[0],{mid:q,dissDataFromFeed:r}),u=n&&e(i.forward_detail[0],{mid:q,forwardOptions:forwardOptions}),v=o&&f(i.like_detail[0],{mid:q,forwardOptions:forwardOptions,node:o,dissDataFromFeed:r});o&&s.getDEvent().pushExcept(o);var w={comment:{ctnt:i.comment_detail[0],tab:m,ctxt:t},repost:{ctnt:i.forward_detail[0],tab:n,ctxt:u},like:{ctnt:i.like_detail[0],tab:o,ctxt:v}};j.add("fl_comment","click",y);j.add("fl_forward","click",y);j.add("fl_like","click",y);var z=a.queryToJson(FM.getURL().query||"");z.type&&setTimeout(function(){a.scrollTo(i.feed_list_options[0],{step:10,onMoveStop:function(){if(z.type==="comment"){var b=a.sizzle("textarea",i.comment_detail[0]);b[0]&&b[0].focus()}}})},1e3);x(z.type||"comment");j.add("feed_private_tipclose","click",function(b){a.removeNode(a.core.dom.dir.parent(b.el,{expr:"[node-type=feed_privateset_tip]"})[0])});a.custEvent.add(t,"deleteComment",function(){l(m,!1)});a.custEvent.add(t,"comment",function(){l(m,!0)});a.custEvent.add(t,"forward",function(){l(n,!0)});if(u){a.custEvent.add(u,"forward",function(){l(n,!0)});a.custEvent.add(u,"deleteForward",function(){l(n,!1)});a.custEvent.add(u,"comment",function(){l(m,!0)})}that.destroy=function(){s.destroy();t.destroy();u&&u.destroy();v.destroy();j.destroy()};return that}});
FM.register("pl.content.weiboDetail.index",function(b,c){return a.pl.content.weiboDetail.source.init(a.E(b),{})})});
