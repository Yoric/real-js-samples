"use strict";honey.def("lib:jquery",function(d){var l,t=d.RangeSlider,p=function(t){var n=new RegExp("(?:^|;+|\\s+)"+t+"=([^;]*)"),e=document.cookie.match(n);return e?e[1]:""},u=!1,e=function(t){var n=document.getElementById(t);return window.MGTVPlayer&&0<$("#mgtv-video-wrap").length?window.MGTVPlayer:-1!=navigator.appName.indexOf("Microsoft")?n:0<n.getElementsByTagName("embed").length?n.getElementsByTagName("embed")[0]:n};$.fn.$watch=function(a){function i(n){!$.browser.msie||"8.0"!=$.browser.version&&"7.0"!=$.browser.version?$(n).bind("input",function(t){e(t,$(n))}):$(n).bind("propertychange",function(t){e(t,$(n))})}function e(t,n){n.unbind("propertychange input");var e=n.val();a&&$.isFunction(a)&&a.apply(n,[e,t]),i(n)}return $(this).each(function(){i(this)}),this};var m=null,c={topShow:.25,flowShow:.6,allShow:1};function n(){this.$box=$('[node-type="c-player-pop-danmu"]'),this.init(),this.bindEvent(),this.count=0}n.prototype={init:function(){(l=""==p("HDCN")?"":p("HDCN").match(/\b\w+\b/g)[0])&&this.$box.find(".c-player-nologin").hide()},getObject:function(t){var n=document.getElementById(t);return window.MGTVPlayer&&0<$("#mgtv-video-wrap").length?window.MGTVPlayer:-1!=navigator.appName.indexOf("Microsoft")?n:0<n.getElementsByTagName("embed").length?n.getElementsByTagName("embed")[0]:n},postMsg:function(t){var n="danmu-data-from",e=$("#danmu-data-from"),a=$(".chat-register-from"),i=p("uuid")||"";l=""==p("HDCN")?"":p("HDCN").match(/\b\w+\b/g)[0];var o="";try{o=this.getObject("hunantv-player-1").OnFMPlayerVersion()}catch(r){}var d="",u="";if("undefined"!=typeof STK&&(d=STK.$.stkuuid(),u=STK.$.os.sys),0==e.length&&$('<iframe frameborder="0" height="0" name="'+n+'" id="'+n+'" width="0"/>').appendTo("body"),0==a.length){var s='<form action="//galaxy.bz.mgtv.com/wrbarrage" target="'+n+'" method="post" class="chat-register-from"><input type="hidden" name="vid" value="'+t.vid+'" /><input type="hidden" name="pid" value="0" /><input type="hidden" name="ticket" value="'+l+'" /><input type="hidden" name="cid" value="'+t.cid+'" /><input type="hidden" name="content" value="" /><input type="hidden" name="time" value="" /><input type="hidden" name="type" value="0" /><input type="hidden" name="abroad" value="0" /><input type="hidden" name="deviceid" value="'+d+'" /><input type="hidden" name="uuid" value="'+i+'" /><input type="hidden" name="platform" value="0" /><input type="hidden" name="os" value="'+u+'" /><input type="hidden" name="version" value="'+o+'" /><input type="hidden" name="reqtype" value="form-post" /></form>';a=$(s).appendTo("body")}$('[name="vid"]',a).val(t.vid),$('[name="cid"]',a).val(t.cid),$('[name="time"]',a).val(t.time),$('[name="content"]',a).val(t.content),$('[name="uuid"]',a).val(i),$('[name="ticket"]',a).val(l),a.submit(),m=setTimeout(function(){console.log("timeout")},1e4)},tips:function(t,n){var e=$("div[node-type=c-player-pop-tips]");e.show().find("span").html(t),e.show().fadeOut(n)},bindEvent:function(){var t=$("body"),n=$(document),e=!1,a=this;t.on("click","[action-type=danmu-switch]",function(){$(this).data("switch")?($(this).removeClass("u-toggle-on"),e=!1,$(this).data("switch",!1)):($(this).addClass("u-toggle-on"),e=!0,$(this).data("switch",!0)),window.MGTVPlayer?a.getObject("hunantv-player-1").setDanmuStatus({visible:e}):a.getObject("hunantv-player-1").setDanmuVisible(e)}),n.on("play.video.reload",function(){a.$box.addClass("disabled")}),$("#data-input-danmu").$watch(function(t){var n=$("#danmu-input-count");n.html(t.length),a.count=t.length,40<t.length?(n.addClass("iswrong"),$("#data-input-danmu").val($("#data-input-danmu").val().substring(0,40))):n.removeClass("iswrong")});var r=$("i[action-type=danmu-switch]");window.FLASH_MGTV_FUN_DANMU=function(t,n,e,a,i){var o=$("div[node-type=c-player-pop-danmu]");if(t?o.removeClass("disabled").fadeIn():o.fadeOut(),n?(r.addClass("u-toggle-on"),r.data("switch",!0)):(r.removeClass("u-toggle-on"),r.data("switch",!1)),e){var d=e==c.topShow?"topShow":e==c.flowShow?"flowShow":"allShow";$("div[node-type=danmu-set-area] a").removeClass("danmuon"),$("div[node-type=danmu-set-area]").find("a[type="+d+"]").addClass("danmuon")}if(a){var u=Math.ceil(100*a);h.setVal(u)}if(i){var s=Math.ceil(100*i);v.setVal(s)}},window.FLASH_MGTV_FUN_SHOWDANMU=function(t){t?(r.addClass("u-toggle-on"),r.data("switch",!0)):(r.removeClass("u-toggle-on"),r.data("switch",!1))},t.on("click","[action-type=danmu-post]",function(){r.addClass("u-toggle-on"),r.data("switch",!0),a.sendMsg()}),$("#data-input-danmu").keydown(function(t){"13"==t.keyCode&&a.sendMsg()}),a.$box.on("click","[action-type=login]",function(){return""==p("HDCN")?d.loginDialog():a.$box.find(".c-player-nologin").hide(),!1}),$("#data-input-danmu").focus(function(t){if($("i[action-type=danmu-switch]").addClass("u-toggle-on"),$("i[action-type=danmu-switch]").data("switch",!0),e=!0,~~(p("danmu_switch")||""))return!1;window.MGTVPlayer?a.getObject("hunantv-player-1").setDanmuStatus({visible:e}):a.getObject("hunantv-player-1").setDanmuVisible(e)}),$(document).on("HONEY-LOGIN-DONE",function(){a.init()})},sendMsg:function(){var n=this;$("a[action-type=danmu-post]");if(""==p("HDCN"))return d.loginDialog(),!1;var e=$("#data-input-danmu").val(),t=Math.floor(1e3*n.getObject("hunantv-player-1").get_time()),a={vid:VIDEOINFO.vid,pid:0,cid:VIDEOINFO.cid,content:e,time:t,type:0};if(""==$.trim(e))return n.tips("亲，您啥也没说~",2e3),!1;if(40<n.count)return n.tips("亲，说的内容有点多~",2e3),!1;n.postMsg(a),$("i[action-type=danmu-switch]").data("switch",!0).addClass("u-toggle-on");var i,o={0:"亲,发射成功",1e3:"您发送失败",1001:"您发送失败",1003:"弹幕功能关闭",1004:"用户鉴权失败",1005:"您被禁言了",1006:"您的IP被限制"};i=function(t){if(m&&clearTimeout(m),m=null,t){if(1100==t.status)return void $(document).trigger("identity.box.show");n.tips(o[t.status],2e3),0==t.status&&n.getObject("hunantv-player-1").sendDanmu(e),$("#data-input-danmu").val(""),$("#danmu-input-count").html("0")}},u||(u=new Messenger("parent","MessengerDanmu")),u.listen(function(t){if(t){var n=JSON.parse(t);i&&i(n),u.clear()}})}},$("[action-type=danmu-pop-bottom]").on("click",function(){$(this).parent().hasClass("danmuon")?$(this).parent().removeClass("danmuon"):$(this).parent().addClass("danmuon")});var a=null;$("[action-type=danmu-pop-setbox]").on("mouseenter",function(){clearTimeout(a)}),$("[action-type=danmu-pop-setbox]").on("mouseleave",function(){var t=this;a=setTimeout(function(){$(t).removeClass("danmuon")},1e3)}),$("div[node-type=danmu-set-area]").on("click","a",function(){$(this).addClass("danmuon"),$(this).siblings().removeClass("danmuon");var t=$(this).attr("type");e("hunantv-player-1").setDanmuStatus({ratio:c[t]})});var h=new t({dom:$(".c-player-popset-opacity"),min:0,max:90,onChange:function(t){var n;n=t,e("hunantv-player-1").setDanmuStatus({transparency:n})}}),v=new t({dom:$(".c-player-popset-rollspeed"),min:50,max:200,onChange:function(t){var n;n=t,e("hunantv-player-1").setDanmuStatus({speed:n})}});!/iPad/i.test(navigator.userAgent)&&window.isH5Player?$("div[node-type=c-player-pop-danmu]").removeClass("no-danmuset"):$("div[node-type=c-player-pop-danmu]").addClass("no-danmuset");d.playerChatBox=new n});