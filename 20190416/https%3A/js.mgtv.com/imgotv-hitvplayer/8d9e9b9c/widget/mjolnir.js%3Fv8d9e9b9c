"use strict";honey.def("lib:jquery, widget:mjolnirLike, widget:mjolnirShare, widget:mjolnirCollection",function(a){if("undefined"!=typeof STK)var r=new STK.start;var i=$("div[action-type=v-panel-approve-wrapper] .up").find("em"),o=$("div[action-type=v-panel-approve-wrapper] .down").find("em"),d=$(".v-panel-count a");var l=function(e){var t=e;return t=4<t.toString().length?(t/1e4).toFixed(1)+"万":t};$("body").on("mouseenter","div[action-type=v-panel-approve]",function(){$(this).addClass("active")}),$("body").on("mouseleave","div[action-type=v-panel-approve]",function(){$(this).removeClass("active")});a.mjolnirPlayCounts=function(){var t,n,e={vid:VIDEOINFO.vid},a={};$.ajax({url:"//vc.mgtv.com/v2/dynamicinfo",data:e,dataType:"JSONP",success:function(e){e&&0==e.code&&e.data&&(a=e.data,t=l(a.like),n=l(a.unlike),i.attr("total-like",a.like).text(t),o.attr("total-like",a.unlike).text(n),0<a.all&&(d.find("span").html(a.allStr),d.parent().show()))}})};var s=function(t,e,n){var a,i,o,d="//vc.mgtv.com/v2/"+(e?"like":"unlike")+"?vid="+VIDEOINFO.vid+"&cid="+VIDEOINFO.cid+"&pid=";i=d,o=function(e){e&&(t=parseInt(t)+1,a=1e4<=t?(t/1e4).toFixed(1)+"万":t,n&&n(t,a))},$.ajax({url:i,type:"GET",dataType:"jsonp"}).done(function(e){e&&o.call(this,e)}).fail(function(){})};$(document).on("click touchstart",".v-panel-approve-wrapper .up",function(e){if(e.preventDefault(),!$(this).hasClass("disabled")){var n=$(this),t=$(this).find("em").attr("total-like");s(t,!0,function(e,t){n.find("em").attr("total-like",e).html(t),n.parent().find("a").addClass("disabled"),$(".down.v-panel-submod").addClass("gray-submod")})}}),$(document).on("click touchstart",".v-panel-approve-wrapper .down",function(e){e.preventDefault();var n=$(this),a=n.prev();if(!$(this).hasClass("disabled")){var t=$(this).find("em").attr("total-like");s(t,!1,function(e,t){$(".v-panel-approve-wrapper .up").remove(),n.after(a),n.find("em").attr("total-like",e).html(t),n.parent().find("a").addClass("disabled"),$(".up.v-panel-submod").addClass("gray-submod")})}}),$("div[node-type=tv-down-details]").on("click",".v-panel-submod",function(e){var t=$(this).parent(".v-panel-info");$(".v-panel-box .extend").hide(),t.hasClass("collapse")?t.removeClass("collapse"):(t.addClass("collapse"),t.find(".extend").show())}),$("div[node-type=tv-down-details]").on("click touchstart",".u-btn-close",function(e){var t=$(this).parents(".v-panel-info");t.removeClass("collapse"),t.find(".extend").hide()}),$(document).on("touchstart","[node-type=guide-app]",function(e){var t=$(this).attr("data-pos");VIDEOINFO.cid,VIDEOINFO.bdid,VIDEOINFO.vid;(STK&&new STK.start).pageStart({bid:"4.1.2",act:"click",pos:t})}),a.moreWayToWatch=function(){var e=$(".v-panel-passage"),t=e.find(".trigger"),d=e.find(".extend"),l=e.find("#2code-box img");t.on("click",function(e){var t=d.is(":visible");$(".v-panel .extend").hide(),$("div[node-type=tv-down-details]").removeClass("collapse"),t?d.hide():d.show();var n=encodeURIComponent(VIDEOINFO.vid+(isNaN(window.seekTime)?"":","+window.seekTime)),a="&plid="+(VIDEOINFO.plid||""),i=(window.seekTime,window.STK&&window.STK.$.getCxid("cxid")||"");if(l.attr("src","//pcweb.api.mgtv.com/qrcode/?source=pc2&from=pcweb&p="+n+a+"&cxid="+i),r){var o={act:"phwt",bid:"isIpad"==STK.$.os.sys?"4.1.1":"1.5.5.5",ref:document.referrer||"",cid:VIDEOINFO.rid||"",vid:VIDEOINFO.vid||"",plid:VIDEOINFO.cid||"",bdid:VIDEOINFO.bdid||"",dc:STK.$.cookie.get("__STKUUID"),value:""};r.pageEvent(o)}e.preventDefault()}),d.on("click touchstart",".u-btn-close",function(){return d.hide(),!1});var n=$("div[action-type=tv-down-conent]"),a=navigator,i=a.userAgent.toLowerCase(),o=a.platform.toLowerCase(),s=(/win/.test(o||i),/mac/.test(o||i)),c="";/iPad/i.test(a.userAgent)?($("div[node-type=tv-down-box]").hide(),$(".v-panel-passage").hide(),$(".v-panel-passage").next().hide()):(c=s?"//mac.api.mgtv.com/v1/version/download":"//pc.api.mgtv.com/web/getdownloadurl",n.find(".u-btn-go").attr("href",c)),$("a[action-type=tv-down-event]").on("click",function(){var e=$("div[action-type=tv-down-conent]"),t=e.is(":visible");$(".v-panel .extend").hide(),$("div[node-type=tv-down-details]").removeClass("collapse"),t?e.hide():e.show()}),$("span[action-type=tv-down-closed]").on("click",function(){$("div[action-type=tv-down-conent]").hide()})},a.Mjolnir=function(e){var t=$(document),n=$(".v-panel-details-extend");$(".v-panel-details").on("click",function(){n.toggle()}),new a.MjolnirShare,new a.MjolnirCollection,a.moreWayToWatch(),a.mjolnirPlayCounts(),t.on("video:stats",function(e,t){var n=1;t&&t.allVVStr&&(n=t.allVVStr),$("#honey-click-stats,[node-type=honey-click-stats]").text(n)}),t.on("page.reload.mock",function(e,t){a.mjolnirPlayCounts(),$(".v-panel-approve-wrapper").find("a.disabled").removeClass("disabled");var n=encodeURIComponent(VIDEOINFO.vid+(isNaN(window.seekTime)?"":","+window.seekTime));$("#2code-box img").attr("src","http://pcweb.api.mgtv.com/qrcode/?source=pc2&from=pcweb&p="+n)})}});