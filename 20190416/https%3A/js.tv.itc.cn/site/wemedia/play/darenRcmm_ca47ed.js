/* sohutv 2018-12-13 16:37:58 */
var DarenRecommand={api:{getTopDaren:"//tv.sohu.com/frag/vrs_inc/sohu_user_133_10.js",getTopVideos:"//api.my.tv.sohu.com/v2/videos.do",getDarenInfo:"//my.tv.sohu.com/user/a/media/productlevels.do?callback=?"},cateInfo:{cateCode:133,count:10,darenList:[],humorCode:133,darenNum:4,videoNum:5,darenShowList:[],videoList:[],videoShowList:[]},creatGetDaren:function(a){this.api.getTopDaren="//tv.sohu.com/frag/vrs_inc/sohu_user_"+a+"_"+this.cateInfo.count+".js"},getCateCode:function(){var a=_videoInfo.cateCode;this.cateInfo.cateCode=a.substr(0,3),this.creatGetDaren(this.cateInfo.cateCode)},getRandomIndex:function(){return.5<Math.random()?-1:1},getRandomVideo:function(a,e){for(var t,i,d,o,n,r,s=this,c=0;c<s.cateInfo.darenNum;c++){(t=s.cateInfo.darenShowList[c]).videos=[],d=[],n=a[o=t.uid],_videoLen=n.length;for(var u=0;u<_videoLen;u++)d.push(u);if(i=d.sort(s.getRandomIndex),0!=_videoLen){r=Math.min(_videoLen,s.cateInfo.videoNum);for(var l=0;l<r;l++)t.videos.push(a[o][i[l]]);t.hotVideos=[];var h=e[o];if(h&&h.length)for(l=0;l<2;l++)t.hotVideos.push(h[i[l]])}}messagebus.publish("js.daren.video")},getDarenInfo:function(){for(var t,i,d=this,a=d.cateInfo.darenShowList[0].uid,e=1;e<d.cateInfo.darenNum;e++)t=d.cateInfo.darenShowList[e],a+=",",a+=i=t.uid;var o={uids:a,type:"02"};$.ajax({url:d.api.getDarenInfo,dataType:"jsonp",data:o,success:function(a){if(200==a.status)for(var e=0;e<d.cateInfo.darenNum;e++)t=d.cateInfo.darenShowList[e],i=t.uid,a.data[i]&&(t.icon=a.data[i].url,t.darenTitle=a.data[i].name);messagebus.publish("js.daren.icon")},error:function(){messagebus.publish("js.daren.icon")}})},getVideos:function(){for(var a,e=this,t=e.cateInfo.darenShowList[0].uid,i=1;i<e.cateInfo.darenNum;i++)t+=",",t+=e.cateInfo.darenShowList[i].uid;a={uids:t,limit:10,charset:"GBK",customizeSizes:"190*110"},$.ajax({url:e.api.getTopVideos+"?callback=?",dataType:"jsonp",data:a,success:function(a){a.errorCode==undefined?e.getRandomVideo(a,[]):$(".tui_daren").hide()},error:function(){$(".tui_daren").hide()}})},getRandomDaren:function(){this.cateInfo.darenList.sort(this.sortByTime("latestUpdateTime"));var a=this.sortByLevel(this.cateInfo.darenList);this.cateInfo.darenShowList=a.splice(0,4),videoLevel&&"1090"==videoLevel||(this.getVideos(),this.getDarenInfo())},sortByTime:function(d){return function(a,e){var t=a[d],i=e[d];return t<i?1:i<t?-1:0}},sortByLevel:function(a){for(var e=0,t=[],i=[],d=0;d<a.length;d++)3!==a[d].producerLevel?t[e++]=a[d]:i.push(a[d]);for(var o=0;o<i.length;o++)t.push(i[o]);return t},getHumorData:function(n){this.creatGetDaren(this.cateInfo.humorCode);var r=this;$.ajax({url:r.api.getTopDaren,dataType:"jsonp",jsonpCallback:"onTopnLoaded",success:function(a){var e=a.videos,t=e.length,i=r.cateInfo.darenNum;r.cateInfo.darenNum=i<=t?i:t+10-n,0==r.cateInfo.darenNum&&n&&(r.cateInfo.darenNum=10-n);var d=n<=t?n:t;if(0<d)for(var o=0;o<d;o++)r.cateInfo.darenList.push(e[o]);r.getRandomDaren(),10!=n&&""!=n&&0!=n||0!=t||$(".tui_daren").hide()},error:function(){$(".tui_daren").hide()}})},getCateDaren:function(){var d=this;$.ajax({url:d.api.getTopDaren,dataType:"jsonp",jsonpCallback:"onTopnLoaded",success:function(a){var e=a.videos,t=e.length;if(0<t)for(var i=0;i<t;i++)d.cateInfo.darenList.push(e[i]);else messagebus.publish("statV2.ping",{type:"impress",txid:"pgc_player_tjcprx"});t<d.cateInfo.count?d.getHumorData(d.cateInfo.count-t):d.getRandomDaren()},error:function(){d.getHumorData(10)}})},tmpl_daren_recomm:'<%@ h:helper %><%for(var i=0,len1=data.length;i<len1;i++){%><%if(data[i].videos !== undefined && data[i].videos.length !== 0){%><div class="tui_daren_row cfix"><div class="tui_daren_info cfix"><div class="info l" pb-click-a><a href="<%=data[i].url%>" target="_blank" data-pb-txid="pgc_player_tjcpr_cprxx" data-pb-other="'+window._uid+'"><img width="40" height="40" class="people-photo va-m" alt="" src="<%=data[i].img%>"></a><a class="people-name va-m" href="<%=data[i].url%>" title="<%=data[i].name%>" target="_blank" data-pb-txid="pgc_player_tjcpr_cprxx" data-pb-other="'+window._uid+'"><%=data[i].name%></a> <%if(data[i].icon!==undefined){%><a href="//my.tv.sohu.com/user/media/index.do" target="_blank" data-pb-txid="pgc_player_tjcpr_icon" data-pb-other="'+window._uid+'" title="<%=data[i].darenTitle %>"><img class="people-ico va-m" src="<%=data[i].icon%>"></span></a><%}%></div><div class="rss r"><span class="read-count"><i class="c-black" data-rss-fanscount="<%=data[i].uid%>"></i>\u4eba\u8ba2\u9605</span><a class="vt_btn_read vt_btn_readable" href="" data-rss-uid="<%=data[i].uid%>" data-pb-txid="pgc_player_tjcpr_dydj" data-pb-txid-sub="pgc_player_tjcpr_dy" data-pb-txid-unsub="pgc_player_tjcpr_qxdy" data-pb-other="{user_id:<%=data[i].uid%>}">\u8ba2\u9605</a></div> </div><ul class="list list_190 cfix" pb-click-a data-pb-txid="pgc_player_tjcpr_spqy" data-pb-other="'+window._uid+'"><% var len2 = (data[i].hotVideos.length ? 3 : data[i].videos.length); %><%for(var j=0;j<len2;j++){%><li><div class="pic"><a href="<%=data[i].videos[j].playUrl%>" target="_blank" data-pb-other="'+window._uid+'|<%=data[i].videos[j].id%>"><img width="190" height="110" src="<%if(data[i].videos[j].coverImageCustomizeSize.length!==0){%><%=data[i].videos[j].coverImageCustomizeSize[0]%><%}else{%><%=data[i].videos[j].coverImage%><%}%>"></a></div><h3 class="hvbt"><a title="<%=data[i].videos[j].title%>" href="<%=data[i].videos[j].playUrl%>" target="_blank" data-pb-other="'+window._uid+'|<%=data[i].videos[j].id%>"><%=data[i].videos[j].title%></a></h3></li><%};%><%for(var j=0;j<data[i].hotVideos.length;j++){%><li><div class="pic"><a href="<%=data[i].hotVideos[j].url%>" target="_blank" data-pb-other="'+window._uid+'|<%=data[i].hotVideos[j].id%>"><img width="190" height="110" src="<%=data[i].hotVideos[j].autoCover || data[i].hotVideos[j].smallCover%>"></a></div><h3 class="hvbt"><a title="<%=data[i].hotVideos[j].title%>" href="<%=data[i].hotVideos[j].url%>" target="_blank" data-pb-other="'+window._uid+'|<%=data[i].hotVideos[j].id%>"><%=data[i].hotVideos[j].title%></a></h3></li><%};%></ul></div><% if(i+1 < len1){ %><div class="bline"></div><%}%><%}%><%};%>',init:function(){var n=this;n.getCateCode();videoLevel&&"1090"==videoLevel||(-1!=["226","221","187","124","100","101","122","130","183","189","190","191","198","106","112","133"].indexOf(this.cateInfo.cateCode)?n.getHumorData(10):n.getCateDaren()),messagebus.wait(["js.daren.video","js.daren.icon"],function(){var a={};a.data=n.cateInfo.darenShowList;for(var e=new kao.Template(n.tmpl_daren_recomm),t=0,i=0,d=a.data.length;i<d;i++)a.data[i].videos!==undefined&&0!==a.data[i].videos.length&&t++;if(0!==t){var o=e.render(a);$(".tui_daren").append(o).attr("pb-impress","").attr("data-pb-txid","pgc_player_tjcpr").attr("data-pb-other",window._uid),$(".tui_daren").find(".tit a").attr("pb-click","").attr("data-pb-txid","pgc_player_tjcpr_qbcpr").attr("data-pb-other",window._uid),messagebus.publish("js.daren.recommend")}else $(".tui_daren").hide()},null,null,{cache:!0})}};messagebus.subscribe("core.loaded_left",function(){DarenRecommand.init()},null,null,{cache:!0});