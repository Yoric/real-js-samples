/* sohutv 2019-04-11 10:27:16 */
!function(){var n,i=sohuHD.dmAPI={},a={};function t(){return document.getElementById("player")||document.getElementById("sohu_player")||document.getElementById("sohuplayer")}var m={parseData:function(t){if(t.info){var e=t.info.comments.length;if(t.status<=0)_e("\u5f39\u5e55\u6570\u636e\u5f02\u5e38status="+t.status);else{if(1!=t.status||0!=e){m.pageTurn=t.info.pg;for(var i=t.info.comments,n=t.info.dfopt,a=t.info.dfd,o=i.length,s=[],l=0;l<o;l++){var r=i[l],c=r.t,p="df"==c?String(n.s):String(r.t.s),d={fcount:r.fcount,id:r.i,vtime:r.v,dtime:1e3*(r.dd+a),size:p,color:"df"==c?String(n.c):String(r.t.c),frame:"n",place:"df"==c?String(n.p):String(r.t.p),roll:"df"==c?String(n.m):String(r.t.m),author:"",content:r.c,star:r.star,photo:r.photo,name:r.name};s.push(d)}return s.sort(m.sortData("dtime")),s.sort(m.sortData("fcount")),s}_e("\u5f39\u5e55\u6570\u636e\u4e3a\u7a7a")}}},sortData:function(a){return function(t,e){var i=Number(t[a]),n=Number(e[a]);return i<n?1:n<i?-1:0}},getData:function(t,e){var i=(t-1)*e,n=t*e,a=[],o=m.pageTurn;try{return n>m.dmLists.length?(n=m.dmLists.length,0):i<0&&(i=0,t=1),i>m.dmLists.length&&console.log("\u5217\u8868\u5df2\u7ecf\u5230\u4e86\u6700\u540e\u4e00\u9875"),a=m.dmLists.slice(i,n),{page:t,flip:n>=m.dmLists.length&&!o?0:1,data:a}}catch(s){}},loadDMData:function(t,e){$.ajax({url:"//api.danmu.tv.sohu.com/dm_v2/dmlist_v3.do",data:{vid:window.vid,pct:"9001"==window.cid?3:2,dct:1,aid:window.playlistId,request_from:"9001"==window.cid?"sohu_ugc_player":"sohu_vrs_player",o:4,time_begin:0,time_end:parseInt(t||3600)},dataType:"jsonp",success:function(t){t=m.dmLists=m.parseData(t)||"",e&&e(t)}})}};window.s2j_checkJsOk=function(){return(n=t())?(["j2s_dmSend","j2s_setSize","j2s_setColor","j2s_setPlace","j2s_setType","j2s_setAlpha","j2s_dmFliter","j2s_dmOpen","j2s_fliterColor"].forEach(function(e){i[e]=function(t){n[e](t)}}),window.s2j_checkJsOk=function(){return n=t(),"1"},messagebus.publish("player.dm_ready",i),"1"):"0"},window.s2j_dmDataOk=function(){i.j2s_getDmData=function(t,e,i){a[t]=function(t){i(t)},n.j2s_getDmData(t,e)},i.j2s_seek=function(t){n.seekTo(t)},messagebus.publish("player.dm_data_ok",i)},window.s2j_initSetting=function(t){messagebus.publish("player.dm_init_setting",t)},window.s2j_inputAllow=function(t){messagebus.publish("player.dm_input_allow",t)},window.s2j_setDmData=function(t){var e=null;t&&t.length&&(t=function n(t){for(var e=[],i=0;i<t.length;i+=4)e.push(String.fromCharCode(parseInt(t.substr(i,4),16)));return e.join("")}(t),e=JSON.parse(t)),e&&"function"==typeof a[e.page]&&(a[e.page](e),a[e.page]=null)};var o=!(window.s2j_dmSwitch=function(t){messagebus.publish("player.dm_switch",t)}),s=window.vid;messagebus.subscribe("dm.data",function(t,e){n=window._player,o||(o=!0,n&&(i={j2s_dmOpen:function(t){var e=2==t?"dm.open":"dm.close";n.emit(e)},j2s_dmSend:function(t){n.emit("dm.send",t)},j2s_setSize:function(t){n.emit("dm.set",{key:"size",val:t})},j2s_setColor:function(t){n.emit("dm.set",{key:"color",val:parseInt(t,16)})},j2s_setPlace:function(t){n.emit("dm.set",{key:"position",val:t})},j2s_setType:function(t){n.emit("dm.set",{key:"type",val:t})},j2s_setAlpha:function(t){n.emit("dm.set",{key:"opacity",val:t/100})},j2s_dmFliter:function(t){n.emit("dm.set",{key:"filter",val:t})},j2s_fliterColor:function(t){n.emit("dm.set",{key:"filterColor",val:t})},j2s_seek:function(t){n.seek(t)},j2s_getDmData:function(t,e,i){var n=m.getData(t,e);i&&i(n)}},messagebus.publish("player.dm_ready",i),m.loadDMData(n.movieDuration,function(t){t&&t.length&&messagebus.publish("player.dm_data_ok",i)}))),s!==window.vid&&(s=window.vid,m.loadDMData(n.movieDuration,function(t){t&&t.length?messagebus.publish("player.dm_data_ok",i):$("[data-tab=album-tab-dmlist]").hide()}))},null,null,{cache:!0})}(),function(n){n.fn.placeholder=function(t){if(!("placeholder"in document.createElement("input"))){var i=(t=t||{}).defclass||"default-val";return this.on("focus",".input-holder",function(){n(this).val()===n(this).attr("placeholder")&&n(this).val("").removeClass(i);var t=event.srcElement?event.srcElement:event.target;if(t.createTextRange){var e=t.createTextRange();e.moveStart("character",n(this).val().length),e.collapse(!0),e.select()}}).on("blur",".input-holder",function(){n(this).val()||n(this).val(n(this).attr("placeholder")).addClass(i)}),this.find(".input-holder").each(function(){n(this).val()||n(this).val(n(this).attr("placeholder")).addClass(i)}),this}}}(jQuery),function(p,a){function c(t){return(t=t||"").replace(/[^\x00-\xff]/g,"mm").length}function i(){return!!sohuHD.dmbar.cookie("ppinf")}sohuHD.dmbar={pageBox:function(){var e=p.extend({box:"#_box",cont:".cont",next:".next",disNext:"disNext",prev:".prev",disPrev:"disPrev",point:".point",cssName:"current",random:!1,page:null},arguments[0]),t=p(e.box),i=t.find(e.cont),n=t.find(e.next),a=t.find(e.prev),o=t.find(e.page),s=t.find(e.point),l=i.length,r=function(t){1<t&&a.removeClass(e.disPrev),t<l&&n.removeClass(e.disNext),1==t&&a.addClass(e.disPrev),t==l&&n.addClass(e.disNext),i.hide(),i.eq(t-1).show(),s.removeClass(e.cssName).eq(t-1).addClass(e.cssName),o.text(t+"/"+l)},c=e.random?Math.floor(Math.random()*l)+1:1;r(c),n.bind("click",function(t){t&&t.preventDefault(),c<l&&r(++c)}),a.bind("click",function(t){t&&t.preventDefault(),1<c&&r(--c)}),s.bind("click",function(t){t&&t.preventDefault(),c=s.index(p(this)),r(++c)}),t.on("selectstart",function(t){t.stopPropagation(),t.preventDefault(),t.returnValue=!1})},processBar:function(){var t=p.extend({box:".box",bar:".bar",barIn:".barIn",barPoint:".barPoint",barText:".tm-bartext",defaultValue:"100"},arguments[0]),e=p(t.box),i=e.find(t.bar),s=e.find(t.barIn),l=e.find(t.barPoint),r=e.find(t.barText),c=t.callback,n=!1,a=function(t){t=~~t;var e=-Math.floor(l.width()/2),i=100+e;(t+=e)<e?t=e:i<t&&(t=i);var n=Math.floor((t-e)/2)+50,a=Math.round(t)+"%",o=Math.round(t-e);l.css({left:a}),s.css({width:o}),r.html(n+"%"),c&&c(Math.round(n))};return a(t.defaultValue),l.on("mousedown",function(t){n=!0}),e.on("selectstart",function(t){t.stopPropagation(),t.preventDefault(),t.returnValue=!1}),i.on("click",function(t){var e=t.clientX,i=s.offset().left;a(e-i)}),p(document).on("mousemove",function(t){if(n){var e=t.clientX,i=s.offset().left;a(e-i)}}).on("mouseup",function(t){n=!1}),{processTo:a}},cookie:function(t,e,i){if(void 0===e){var n=new RegExp("(?:^|; )"+t+"=([^;]*)").exec(document.cookie);return n&&n[1]||""}i=i||{},null===e&&(e="",i.expires=-1);var a,o="";i.expires&&("number"==typeof i.expires||i.expires.toUTCString)&&("number"==typeof i.expires?(a=new Date).setTime(a.getTime()+24*i.expires*60*60*1e3):a=i.expires,o="; expires="+a.toUTCString());var s=i.path?"; path="+i.path:"",l=i.domain?"; domain="+i.domain:"",r=i.secure?"; secure":"";document.cookie=[t,"=",e,o,s,l,r].join("")}};var o,s,l=null,r=null,d=null,m=null,u=null,b=null,n=!1,g=!1,x=null,h=null,f=!1,v={size:function(t){x.j2s_setSize&&x.j2s_setSize(t)},color:function(t){x.j2s_setColor&&x.j2s_setColor(t)},place:function(t){x.j2s_setPlace&&x.j2s_setPlace(t)},type:function(t){x.j2s_setType&&x.j2s_setType(t)},alpha:function(t){x.j2s_setAlpha&&x.j2s_setAlpha(t)},fliter:function(t){x.j2s_dmFliter&&x.j2s_dmFliter(t)},fliterColor:function(t){x.j2s_fliterColor&&x.j2s_fliterColor(t)},open:function(t){o=t,x.j2s_dmOpen&&x.j2s_dmOpen(t)},send:function(t){x.j2s_dmSend&&x.j2s_dmSend(t)}},e={containerId:"sohuplayer",listBox:null,width:"100%",styles:["",,".tmwi-bub-arr,",".tmti-on,",".tmwi-bub-arr,",".tm-arrL,",".tm-arrR,",".tmpo,",".tm-bar,",".tm-barIn,",".tm-barpoint{background:url(//css.tv.itc.cn/channel/play_v1_img/tanmu/ico-png24.png) no-repeat;*background:url(//css.tv.itc.cn/channel/play_v1_img/tanmu/ico.png) no-repeat;}",".tmList{color:#ccc;margin:1px 0 0;background:#2d2d2d;}",".tmi{width:100%;float:left;}",'.tma{display:block;height:19px;padding:5px 0 5px 5px;font-family:arial, "hiragino sans gb",microsoft yahei;margin-right:15px;border-bottom:1px solid #424242;color:#ccc;cursor:pointer;position:relative;}',".tma:hover{background:#494949;border-bottom-color:#494949;color:#fff;}",".tmu .on .tma{background:#9c2d23;color:#fff;}",".tms{width:45px;display:block;}",".tm-txt{width:190px;height:18px;overflow:hidden;display:block;text-overflow:ellipsis;white-space:nowrap;}",".tm-fav{position:absolute;right:0;width:38px;display:block;background:url(//css.tv.itc.cn/channel/play_v1_img/tm-fav.png) no-repeat left center;_background:url(//css.tv.itc.cn/channel/play_v1_img/tm-fav-ie6.png) no-repeat left center;padding:0 0 0 15px;_width:33px;}",".tmPage{width:100%;padding:10px 0 8px;background:#2d2d2d;text-align:right;}",".tmpa{line-height:23px;display:inline-block;margin:0 20px;color:#ccc;vertical-align:top;}",".tmpa-pre,",".tmpa-next{width:35px;height:23px;cursor:pointer;display:inline-block;vertical-align:top;background:url(//css.tv.itc.cn/channel/play_v1_img/tanmu/form.png) no-repeat 0 -243px;}",".tmpa-pre:hover{background-position:-63px -243px;}",".tmpa-pre-unable,",".tmpa-pre-unable:hover{background-position:-125px -243px;cursor:default;}",".tmpa-next{background-position:0 -294px;margin-right:20px;}",".tmpa-next:hover{background-position:-63px -294px;}",".tmpa-next-unable,",".tmpa-next-unable:hover{background-position:-125px -294px;cursor:default;}",".tmps{display:inline-block;width:34px;margin-right:4px;}",".tmBox{width:205px;padding:15px 0 0 15px;height:185px;background:#151515;background:rgba(0,0,0,0.8);_background:#151515;border:1px solid #383838;position:absolute;bottom:37px;right:8px;z-index:10;}",".tmBox a:hover{text-decoration:none;}",".tmBox .ts{color:#858585;margin-right:2px;}",".tm-tab{background:url(//css.tv.itc.cn/channel/play_v1_img/tanmu/tab-line.png) repeat-x left bottom;margin:0 15px 15px 0;}",".tmti{float:left;padding:0 30px 0 0;height:24px;cursor:pointer;color:#999;} /* xhj 20150204 */",".tmsi{float:left;width:32px;height:19px;display:inline;line-height:19px;text-align:center;margin:0 9px 0 8px;cursor:pointer;color:#ccc;}",".tmsi-on{background:#e4382f;color:#fff;border-radius:1px;}",".tmti-on{color:#fff;background-position:0 -46px;width:49px;}",".tmwi{height:22px;line-height:22px;width:80px;float:left;background:#313131;margin:0 8px 8px 0;text-align:center;cursor:pointer;border-radius:2px;position:relative;}",".tmwi a, .tmwi a:link, .tmwi a:visited{color:#b3b3b3;display:block;}",".tmwi2{width:168px;}",".tm-wen{margin-right:-10px;height:180px;}",".tmBox-wen{width:271px;height:200px;right:128px;z-index:20;}",".tmwi a:hover{background:#e73c32;border-radius:2px;color:#fff;}",".tmwi-bub{display:none;padding:0 8px;background:#000;border-radius:1px;border:1px solid #403e3c;line-height:19px;}",".tmwi-bub-arr{background-position:-89px -84px;display:block;width:11px;height:6px;overflow:hidden;position:absolute;bottom:-6px;left:50%;margin:0 0 0 -5px;}",".tmwi:hover .tmwi-bub{top:-28px;left:20%;display:block;}",".tm-arrL,",".tm-arrR,",".tmpo{cursor:pointer;display:inline-block;width:16px;height:16px;overflow:hidden;}",".tm-arrR{background-position:-54px 0;margin-left:3px;}",".tm-arrL-unable,",".tm-arrR-unable{opacity:0.3;filter:alpha(opacity=30);}",".tm-arrL{margin-right:3px;background-position:3px -78px;}",".tmpo{background-position:-42px 0;width:6px;margin:0 3px;}",".tmpo-on{background-position:-18px 0;}",".tmrow{margin:0 0 10px 0;}",".tm-sel{width:150px;color:#fff;}",".tm-barWrap{background:#fcc;}",".tmc{width:22px;height:22px;margin:-2px 1px 4px 0;float:left;}",".tmc span{background:url(//css.tv.itc.cn/channel/play_v1_img/tanmu/color-png24.png) no-repeat;*background:url(//css.tv.itc.cn/channel/play_v1_img/tanmu/color.png) no-repeat;display:block;cursor:pointer;width:22px;height:22px;}",".tmc .tmc-1{background-position:0 0;}",".tmc .tmc-2{background-position:-25px 0;}",".tmc .tmc-3{background-position:-51px 0;}",".tmc .tmc-4{background-position:-76px 0;}",".tmc .tmc-5{background-position:-102px 0;}",".tmc .tmc-6{background-position:-127px 0;}",".tmc .tmc-7{background-position:0 -26px;}",".tmc .tmc-8{background-position:-25px -26px;}",".tmc .tmc-9{background-position:-51px -26px;}",".tmc .tmc-10{background-position:-76px -26px;}",".tmc .tmc-11{background-position:-102px -26px;}",".tmc .tmc-12{background-position:-127px -26px;}",".tmc-on .tmc-1{background-position:0 -56px;}",".tmc-on .tmc-2{background-position:-25px -56px;}",".tmc-on .tmc-3{background-position:-51px -56px;}",".tmc-on .tmc-4{background-position:-76px -56px;}",".tmc-on .tmc-5{background-position:-102px -56px;}",".tmc-on .tmc-6{background-position:-127px -56px;}",".tmc-on .tmc-7{background-position:0 -83px;}",".tmc-on .tmc-8{background-position:-25px -83px;}",".tmc-on .tmc-9{background-position:-51px -83px;}",".tmc-on .tmc-10{background-position:-76px -83px;}",".tmc-on .tmc-11{background-position:-102px -83px;}",".tmc-on .tmc-12{background-position:-128px -83px;}",".tmc-dis .tmc-1{background-position:0 -113px;}",".tmc-dis .tmc-2{background-position:-25px -113px;}",".tmc-dis .tmc-3{background-position:-51px -113px;}",".tmc-dis .tmc-4{background-position:-76px -113px;}",".tmc-dis .tmc-5{background-position:-102px -113px;}",".tmc-dis .tmc-6{background-position:-127px -113px;}",".tmc-dis .tmc-7{background-position:0 -140px;}",".tmc-dis .tmc-8{background-position:-25px -140px;}",".tmc-dis .tmc-9{background-position:-51px -140px;}",".tmc-dis .tmc-10{background-position:-76px -140px;}",".tmc-dis .tmc-11{background-position:-102px -140px;}",".tmc-dis .tmc-12{background-position:-127px -140px;}",".tmrow-4 .tm-sel{width:150px;margin:0 -10px 0 -8px;}",".tmrow-1{margin-bottom:0;height:53px;}",".tmrow-1 .tm-sel{margin-left:6px;}",".tmrow-4 .tmsi{width:56px;}",".tm-bar,",".tm-barIn,",".tm-barpoint{background-position:0 -35px;display:block;width:100px;height:16px;}",".tm-barIn{background-position:0 -19px;}",".tm-bar{margin:0 10px 0 0;_margin-left:0;position:relative;}",".tm-barpoint{background-position:-87px 2px;width:16px;height:16px;cursor:pointer;position:absolute;top:2px;left:20%;}",".tm-wel1{background:url(//css.tv.itc.cn/channel/play_v1_img/tanmu/bub-wel2-v2.png) no-repeat;width:242px;height:55px;position:absolute;top:110px;left:48px;}",".tm-wel2{background:url(//css.tv.itc.cn/channel/play_v1_img/tanmu/bub-wel.png) no-repeat;width:253px;height:85px;position:absolute;bottom:30px;left:48px;}",".tm-wel3{background:url(//css.tv.itc.cn/channel/play_v1_img/tanmu/bub-wel3-v2.png) no-repeat;width:167px;height:62px;position:absolute;top:200px;left:48px;}",'.tm-wel1{_background:none;_filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src="//css.tv.itc.cn/channel/play_v1_img/tanmu/bub-wel2-v2.png", sizingMethod="noscale");}','.tm-wel2{_background:none;_filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src="//css.tv.itc.cn/channel/play_v1_img/tanmu/bub-wel.png", sizingMethod="noscale");}','.tm-wel3{_background:none;_filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src="//css.tv.itc.cn/channel/play_v1_img/tanmu/bub-wel3-v2.png", sizingMethod="noscale");}',".tm-wel1 .tm-close,",".tm-wel2 .tm-close,",".tm-wel3 .tm-close{display:block;width:20px;height:20px;position:absolute;cursor:pointer;}",".tm-wel1 .tm-close{top:21px;right:6px;}",".tm-wel3 .tm-close{top:31px;right:6px;}",".tm-wel1 .tm-close:hover,",".tm-wel3 .tm-close:hover{background:url(//css.tv.itc.cn/channel/play_v1_img/tanmu/form.png) no-repeat -39px -153px;}",".tm-wel2 .tm-close{top:10px;right:10px;}",".tmBox-form{height:36px;background:#1a1a1a;border-top:1px solid #2a2a2a;width:100%;}",".tmBox-formIn{padding:4px 72px 0 133px;}",".tm-tmbtn,",".tm-send,",".tm-tmsz,",".tm-emot{display:inline-block;background:url(//css.tv.itc.cn/channel/play_v1_img/tanmu/form.png) no-repeat;top:4px;cursor:pointer;vertical-align:top;}",".tm-tmbtn{left:10px;top:6px;width:44px;height:24px;line-height:24px;color:#e5e5e5;padding:0 0 0 10px;background-position:0 -193px;}",".tm-tmbtn-over{background-position:-76px -193px;width:34px;padding:0 0 0 20px;}",".tm-tmbtn:hover{_background-color:#1a1a1a;text-decoration:none;color:#e5e5e5;}",".tm-tmbtn i{display:none;background:none;}",".tm-tmbtn:hover i{background:url(//css.tv.itc.cn/channel/play_v1_img/tanmu/form.png) no-repeat -147px -107px;display:block;position:absolute;top:-26px;text-align:center;left:-2px;width:60px;line-height:20px;height:26px;display:inline-block;}",".tm-tmbtn-unable,",".tm-tmbtn-unable:hover{background-position:-151px -193px;cursor:default;color:#717171;}",".tm-send{right:10px;width:60px;height:28px;letter-spacing:2px;line-height:28px;text-align:center;color:#e5e5e5;}",".tm-send:hover{background-position:-72px 0;}",".tm-send-unable,",".tm-send-unable:hover{background-position:-144px 0;cursor:default;color:#7a7a7a;}",".tm-tmsz{width:50px;height:28px;line-height:28px;text-align:center;background-position:0 -51px;left:73px;color:#999;}",".tm-tmsz:hover{background-position:-72px -51px;color:#e5e5e5;}",".tm-tmsz-unable,",".tm-tmsz-unable:hover{background-position:-147px -51px;cursor:default;color:#7a7a7a;}",".tm-in{background:#4d4d4d;height:28px;padding:0 10px;cursor:default;overflow:hidden;}",".tm-in input{background:none;color:#fff;border:none;width:94%;height:28px;line-height:28px;vertical-align:top; padding: 0;}",".tm-emot{width:47px;height:18px;right:82px;top:9px;background:url(//css.tv.itc.cn/channel/play_v1_img/tanmu/yan.png) no-repeat;background-position:-53px 0px;}",".tm-emot:hover{background-position:0px 0px;}",".tm-emot-unable, .tm-emot-unable:hover{background-position:-53px 0px;cursor:default;}",".abs{position:absolute;}",".tm-fliter {width:95px;}",".tm-fliterColor .tmsi,",".tm-fliter .tmsi{background:url(//css.tv.itc.cn/channel/play_v1_img/tanmu/ico-filter.png) no-repeat;width:40px;height:28px;margin:0 0 0 5px;}",".tm-fliterColor .tmsi .tmsi-txt,",".tm-fliter .tmsi .tmsi-txt{display:block;padding-top:30px;}",".tm-fliter .icon-top{background-position:0px -80px;}",".tm-fliter .icon-top.tmsi-on{background-position:-46px -80px;}",".tm-fliter .icon-bottom{background-position:0px -40px;}",".tm-fliter .icon-bottom.tmsi-on{background-position:-46px -40px;}",".tm-fliterColor {width:45px;}",".tm-fliterColor .icon-color{background-position:0px 0px;}",".tm-fliterColor .icon-color.tmsi-dis{background-position:-46px 0px;color:#fff;}",".tm-unlogin {position:absolute;top:8px;left:142px;display:none;}",".tm-unlogin a, .tm-unlogin a:link, .tm-unlogin a:visited{color:#e73c31;}",".tm-in-unlogin .tm-unlogin{display:block;color:#999;}",".tm-in-unlogin .input-holder,",".tm-in-unlogin .tm-emot{display:none;}",".scroll-bar{","position:relative;","overflow-y:auto;overflow-x:hidden;","scrollbar-3dlight-color:#3f3f3f;","scrollbar-highlight-color:#3f3f3f;","scrollbar-arrow-color:#999;","scrollbar-shadow-color:#3f3f3f;","scrollbar-darkshadow-color:#3f3f3f;","scrollbar-base-color:#3f3f3f;","scrollbar-track-color:#010101;}",".scroll-bar::-webkit-scrollbar{width:10px;height:10px;}",".scroll-bar::-webkit-scrollbar-track:vertical{background-color:#010101;}",".scroll-bar::-webkit-scrollbar-track-piece{background-color:transparent;}",".scroll-bar::-webkit-scrollbar-thumb:vertical{background-color:#3f3f3f;}",".tmi-box{background:#212121;border:1px solid #6b6b6b;position:absolute;top:50%;left:50%;width:276px;margin-left:-150px;}",".tmi-box h4{font-size:14px;border-bottom:1px solid #6b6b6b;padding:0 20px;line-height:41px;color:#f8f8f8;}",".tmi-box dl{padding:25px 20px 0;}",".tmi-box dt{font-size:14px;margin:-8px 0 3px;color:#f8f8f8;}",".tmi-box dd{color:#bbbbbb;margin:0 0 16px;line-height:30px;}",".tmi-box .item li{float:left;margin:5px 10px 0 0;cursor:pointer;border:1px solid #bbbbbb;border-radius:2px;line-height:20px;padding:0 5px;}",".tmi-box .item li:hover{color:#e73c31;border:1px solid #e73c31;}",".tmi-box-tips{background:#222;border:1px solid #737373;width:153px;height:51px;line-height:51px;font-size:16px;text-align:center;position:absolute;top:50%;left:50%;margin:-50px 0 0 -90px;display:none;}",".tmi-jubao,.tmi-box-tips{z-index:2;}",".tmi-jubao .tm-txt{width:170px;}",".tmi-jubao a{background:#494949;}",".tmi-jubao .tmi-close{display:inline-block;width:9px;height:9px;background:url(//css.tv.itc.cn/channel/play_v1_img/vip/ico-close-mini.png) no-repeat;position:absolute;top:15px;right:20px;cursor:pointer;overflow:hidden;}",".tmi-jubao .tmi-close:hover{background-position:0 -15px;}",".tips-ok{background:url(//css.tv.itc.cn/channel/play_v1_img/tanmu/ok.png) no-repeat;display:inline-block;margin-right:12px;width:22px;height:22px;vertical-align:middle;}",".tmi-btn{display:none;background:#d3d3d3;border-radius:1px;width:35px;height:20px;line-height:20px;text-align:center;color:#494949;position:absolute;right:10px;}",".tmi-btn:hover{background:#e73c31;color:#fff;}",".tma:hover .tm-fav{display:none;}",".tma:hover .tmi-btn{display:block;}",".tmTip{position:absolute;top:0;width:100%;height:100%;display:none;}",".tmi-tt {white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}"].join(""),emots:[{text:"(=\u30fb\u03c9\u30fb=)",desc:"\u55b5~"},{text:"(\u0e05\u30fb\u03c9\u30fb\u0e05)",desc:"\u6c6a\u6c6a"},{text:"\u256e(\u256f_\u2570)\u256d",desc:"\u65e0\u5948"},{text:"\u03a3( \xb0 \u25b3 \xb0|||)",desc:"\u60ca\uff01"},{text:"(\u0e51>.<\u0e51)\u2661",desc:"\u559c\u6b22"},{text:"\u250f(\u309c\u03c9\u309c)=\u261e",desc:"\u8d70\u4f60"},{text:"(<\u309d\u03c9\u30fb) \u2606",desc:"\u5a9a\u773c"},{text:"\ub208_\ub208",desc:"\u77aa.."},{text:"\uff08\u3064\u0434\uff1b*)",desc:"\u62b9\u6cea"},{text:"( \u309c- \u309c)\u3064\u30ed",desc:"\u5e72\u676f"},{text:"(\u256f\xb0\u53e3\xb0)\u256f\ufe35\u253b\u2501\u253b",desc:"\u6380\u684c"},{text:"_(:3)\u2220)_",desc:"\u8eba\u67aa"},{text:"\uff08\u3065\uffe33\uffe3\uff09\u3065\u256d\u2764\uff5e",desc:"\u4e48\u4e48\u54d2"},{text:"(\u0e51\u2022\u0300\u3142\u2022\u0301)\u0648\u2727",desc:"\u8036~"},{text:"\u03b5 = = (\u3065\u2032\u25bd`)\u3065",desc:"\u5954\u8d70"},{text:"( \uff3f \uff3f)\u30ce\uff5c\u58c1",desc:"\u6276\u5899"},{text:"(* \uffe3\ufe3f\uffe3)",desc:"\u4e0d\u723d"},{text:"w(\uff9f\u0414\uff9f)w",desc:"\u9707\u60ca"},{text:"(*/\u03c9\uff3c*)",desc:"\u7f9e\u7f9e"},{text:"\u03b5(\u252c\u252c\ufe4f\u252c\u252c)3",desc:"\u54ed\u6655"},{text:"\u1555( \u141b )\u1557",desc:"\u5566\u5566"},{text:"\u2511(\uffe3\u0414 \uffe3)\u250d",desc:"\u644a\u624b"},{text:"(\u2764\xb4\u8278\uff40\u2764)",desc:"\u82b1\u75f4"},{text:"(\u25cf\u2014\u25cf)",desc:"\u5927\u767d"},{text:"(\u0e07 \u2022_\u2022)\u0e07",desc:"\u52a0\u6cb9"},{text:"((*\u2032 \u25bd\u2018)\u723b(\u2032\u25bd\u2018*))",desc:"\u5f00\u5fc3\u7684\u4e00\u8d77"},{text:"(\uffe3o\uffe3) . z Z",desc:"\u7761\u5566"},{text:"\u03b5=\u03b5=\u03b5=\u250f(\u309c\u30ed\u309c;)\u251b",desc:"\u9003\uff01"},{text:"(o\u2256\u25e1\u2256)",desc:"\u50b2\u5a07"},{text:"=\u2514(\u2510\u534d^o^)\u534d",desc:"\u6211\u6765\u4e5f"}]};function k(t){this.options=p.extend(!0,{},e,t)}p.extend(k.prototype,{init:function(){var t=this;n||t.renderDM(),t.initSwitch(),t.initEmot(),t.initdmSetting(),t.initSend(),t.setUnable(!1),t.subscribeTopics()},cssText:function(){return["",'<style id="__dmbar">',this.options.styles,"</style>"].join("")},renderDM:function(){n=!0,0==p("#__dmbar").length&&p("head").append(this.cssText()),l=p('<div id="dmbar" class="tmBox-form '+(i()?"":"tm-in-unlogin")+'" style="position:absolute;left:0px;bottom:0;z-index:102;width:'+this.options.width+';"></div>');var t=["",'<div class="tmBox-formIn cfix rel">','    <div class="tm-tmbtn abs">\u5f39\u5e55<i style="display:none;">\u5f00\u542f\u5f39\u5e55</i></div>','    <div class="tm-in">','        <input type="text" class="input-holder" placeholder="\u548c\u5c0f\u4f19\u4f34\u4e00\u8d77\u6b22\u4e50\u6ef4\u5410\u69fd\u5427~\\(\u2267\u25bd\u2266)/~" autocomplete="off" />','        <div class="tm-emot abs" pb-hover data-pb-txid="pg_barrage_expressbutton"></div>','        <div class="tm-unlogin abs"><a href="javascript:void(0);" pb-click data-pb-txid="pg_barrage_login">\u767b\u5f55</a>\u540e\u53d1\u4e00\u6ce2\u5f39\u5e55\u4e00\u5410\u4e3a\u5feb\u5427\uff01</div>',"    </div>",'    <span class="tm-send abs" pb-click data-pb-txid="pg_barrage_send">\u53d1\u9001</span>','    <div class="tm-tmsz abs" pb-hover data-pb-txid="pg_barrage_set">\u8bbe\u7f6e</div>','    <div class="tm-wel3" style="top:-60px;display:none;"><span class="tm-close" data-tips="dm_switch_tips"></span></div>','    <div class="tm-wel1" style="top:-50px;display:none;"><span class="tm-close" data-tips="dm_input_tips"></span></div>',"</div>"].join("");l.html(t),p("#"+this.options.containerId).append(l),r=l.find(".tm-tmbtn"),d=l.find(".tm-in input"),l.find(".tm-in").placeholder(),m=l.find(".tm-emot"),u=l.find(".tm-send"),b=l.find(".tm-tmsz"),l.delegate(".tm-close","click",function(t){t.stopPropagation();var e=p(this);e.parent().hide();var i=e.data("tips");sohuHD.dmbar.cookie(i,!0,{path:"/",expires:20})}).delegate(".tm-unlogin a","click",function(t){sohuHD.initLogin&&(sohuHD.initLogin(),sohuHD.showLoginWinbox())})},initSwitch:function(){var n=this;r.bind("click",function(t){var e=p(this);if(!e.hasClass("tm-tmbtn-unable")){var i=e.hasClass("tm-tmbtn-over")?1:2;n.setDmInfo("open",i),e.toggleClass("tm-tmbtn-over"),messagebus.publish("statV2.ping",{type:"click",txid:"pg_barrage_open_close",other:i})}})},initEmot:function(){for(var t=m,e=this.options.emots,i=e.length/15,n=[],a=[],o=[],s="",l=0;l<i;l++)a=['<ul class="tm-wen cfix" pb-click-a="mc" data-pb-txid="pg_barrage_anexpress">'],o=e.slice(15*l,15*(l+1)),p.each(o,function(t,e){s=10==t||12==t||14==t?"tmwi2":"",a.push('<li class="tmwi ',s,'"><a href="" data-emot="',e.text,'">',e.text,'<span class="tmwi-bub abs">',e.desc,'<em class="tmwi-bub-arr"></em></span></a></li>')}),a.push("</ul>"),n.push(a.join(""));var r=["",'<div class="tmBox tmBox-wen" style="right:0;display:none;cursor:default;bottom:27px;">',n.join(""),'    <ul class="tm-point ta-c cfix">','        <span class="tm-arrL" pb-click data-pb-txid="pg_barrage_leftexpress"></span>','        <span class="tmpo" pb-click data-pb-txid="pg_barrage_leftexpress"></span>','        <span class="tmpo" pb-click data-pb-txid="pg_barrage_rightexpress"></span>','        <span class="tm-arrR" pb-click data-pb-txid="pg_barrage_rightexpress"></span>',"    </ul>","</div>"].join("");t.html(r),sohuHD.dmbar.pageBox({box:".tmBox-wen",cont:"ul.tm-wen",random:!1,next:".tm-arrR",prev:".tm-arrL",disNext:"tm-arrR-unable",disPrev:"tm-arrL-unable",point:".tm-point .tmpo",cssName:"tmpo-on"}),t.on("click",".tm-wen a",function(t){t.preventDefault();var e=p(this).data("emot"),i="";c(i=d.val()!==d.attr("placeholder")?d.val()+e:e)<80&&d.val(i),d.focus()}),this.hoverShowPanel(t,".tmBox-wen","tm-emot-unable")},initdmSetting:function(){var e=this,t=b,i=["",'<div class="tmBox tmBox-set" style="line-height:normal;left:0px;display:none;cursor:default;bottom:32px;color:#999;">','    <ul class="tm-tab cfix">','        <li class="tmti tmti-on">\u6211\u7684\u5f39\u5e55</li>','        <li class="tmti">\u6240\u6709\u5f39\u5e55</li>',"    </ul>",'    <ul class="tm-tab-cont">','        <div class="tmrow tmrow-1 cfix">','            <span class="l ts">\u989c\u8272\uff1a</span>','            <ul class="tm-sel tm-color cfix l" pb-click="mc" data-pb-txid="pg_barrage_setcolor">','                <li class="tmc" data-type="ffffff"><span class="tmc-1"></span></li>','                <li class="tmc" data-type="ff8181"><span class="tmc-2"></span></li>','                <li class="tmc" data-type="e4382f"><span class="tmc-3"></span></li>','                <li class="tmc" data-type="ff7e00"><span class="tmc-4"></span></li>','                <li class="tmc" data-type="ffd631"><span class="tmc-5"></span></li>','                <li class="tmc" data-type="8dd440"><span class="tmc-6"></span></li>','                <li class="tmc" data-type="33e58f"><span class="tmc-7"></span></li>','                <li class="tmc" data-type="62e3ff"><span class="tmc-8"></span></li>','                <li class="tmc" data-type="5168f4"><span class="tmc-9"></span></li>','                <li class="tmc" data-type="b04ae4"><span class="tmc-10"></span></li>','                <li class="tmc" data-type="e22c8f"><span class="tmc-11"></span></li>','                <li class="tmc" data-type="656565"><span class="tmc-12"></span></li>',"            </ul>","        </div>",'        <div class="tmrow tmrow-2 cfix">','            <span class="l ts">\u5927\u5c0f\uff1a</span>','            <ul class="tm-sel tm-size cfix l" pb-click="mc" data-pb-txid="pg_barrage_setcharacter">','                <li class="tmsi" data-type="l">\u5927</li>','                <li class="tmsi" data-type="m">\u4e2d</li>','                <li class="tmsi" data-type="s">\u5c0f</li>',"            </ul>","        </div>",'        <div class="tmrow tmrow-3 cfix">','            <span class="l ts">\u4f4d\u7f6e\uff1a</span>','            <ul class="tm-sel tm-place cfix l" pb-click="mc" data-pb-txid="pg_barrage_setlocation">','                <li class="tmsi" data-type="t">\u9876\u90e8</li>','                <li class="tmsi" data-type="b">\u5e95\u90e8</li>',"            </ul>","        </div>",'        <div class="tmrow tmrow-4 cfix">','            <span class="l ts">\u5c55\u73b0\u7c7b\u578b\uff1a</span>','            <ul class="tm-sel tm-type cfix l" pb-click="mc" data-pb-txid="pg_barrage_settype">','                <li class="tmsi" data-type="r">\u5411\u5de6\u6eda\u52a8</li>','                <li class="tmsi" data-type="f">\u56fa\u5b9a\u6e10\u9690</li>',"            </ul>","        </div>","    </ul>",'    <ul class="tm-tab-cont">','        <div class="tmrow cfix" style="margin:30px 0 50px 0">','            <span class="l ts">\u5c4f\u853d\u8bbe\u7f6e\uff1a</span>','            <ul class="tm-sel tm-fliterColor cfix l" pb-click="mc" data-pb-txid="pg_barrage_shieldcolor">','                <li class="tmsi icon-color" data-type="ff8181|E64E5D|e4382f|ff7e00|ffd631|E6B03C|8dd440|33e58f|35BC9B|62e3ff|3BB0DC|5168f4|b04ae4|9074D6|e22c8f|656565"><span class="tmsi-txt">\u5f69\u8272\u5b57</span></li>',"            </ul>",'            <ul class="tm-sel tm-fliter cfix l" pb-click="mc" data-pb-txid="pg_barrage_setshield">','                <li class="tmsi icon-top" data-type="t"><span class="tmsi-txt">\u9876\u90e8</span></li>','                <li class="tmsi icon-bottom" data-type="b"><span class="tmsi-txt">\u5e95\u90e8</span></li>',"            </ul>","        </div>",'        <div class="tmrow cfix">','            <span class="l ts">\u900f\u660e\u5ea6\uff1a</span>','            <div class="tm-sel tm-opacity cfix l">','                <span class="tm-bar l" pb-click="mc" data-pb-txid="pg_barrage_setalpha" style="cursor:pointer;"><em class="tm-barIn" style="float:left;"><span class="tm-barpoint"></span></em></span>','                <span class="tm-bartext">70%</span>',"            </div>","        </div>","    </ul>","</div>"].join("");t.append(i),sohuHD.dmbar.pageBox({box:".tmBox-set",cont:"ul.tm-tab-cont",random:!1,point:".tm-tab .tmti",cssName:"tmti-on"}),h=sohuHD.dmbar.processBar({box:".tm-opacity",bar:".tm-bar",barIn:".tm-barIn",barPoint:".tm-barpoint",callback:function(t){e.setDmInfo("alpha",t)}}),e.hoverShowPanel(t,".tmBox-set","tm-tmsz-unable"),e.dmSettingEvent(t,"fliter"),e.dmSettingEvent(t,"color"),e.dmSettingEvent(t,"size"),e.dmSettingEvent(t,"place"),e.dmSettingEvent(t,"type"),e.dmSettingEvent(t,"fliterColor")},hoverShowPanel:function(e,t,i){var n=!1,a=e.find(t);e.on("mouseenter click",function(){e.hasClass(i)||(n=!0,a.show())}).mouseleave(function(){n=!1,setTimeout(function(){n||a.hide()},200)}),a.mouseenter(function(t){n=!0,t.stopPropagation()}).mouseleave(function(t){n=!1,e.data("_tid",0),setTimeout(function(){n||a.hide()},200),t.stopPropagation()})},dmSettingEvent:function(t,a){var s=this,e=".tm-"+a+" li",l="on";"fliterColor"==a&&(l="dis"),t.delegate(e,"click",function(t){var e=p(this),i=e.attr("class").slice(0,4).trim()+"-"+l,n=null;if("fliter"==a)n={place:e.data("type"),show:e.hasClass(i)?1:0},e.toggleClass(i);else if("fliterColor"==a){e.toggleClass(i);var o=[];p("."+i).each(function(t,e){for(var i=p(e).data("type").toString().split("|"),n=0,a=i.length;n<a;n++)o.push(parseInt(i[n],16))}),n=o.join("|")}else e.addClass(i).siblings().removeClass(i),n=e.data("type");s.setDmInfo(a,n)})},setDmInfo:function(t,e){if(g){if("open"==t){var i="2"==e?"\u5173\u95ed\u5f39\u5e55":"\u5f00\u542f\u5f39\u5e55";r.attr("title",i)}v[t]&&v[t](e)}},initSend:function(){var i=this,n={background:"#753d38"},o={background:"#4d4d4d"},s=d.parent();function e(){s.css(o);var t=p.trim(d.val());if(!u.hasClass("tm-send-unable")&&t!==d.attr("placeholder"))if(""!=t){var e={content:t,type:i.getInfoValue("type"),color:i.getInfoValue("color"),size:i.getInfoValue("size"),place:i.getInfoValue("place")};r.hasClass("tm-tmbtn-over")||(i.setDmInfo("open",2),r.addClass("tm-tmbtn-over")),i.setDmInfo("send",e),d.val("").focus()}else s.css(n)}u.bind("click",function(t){e()}),d.bind("keydown",function(t){13==t.keyCode&&(e(),messagebus.publish("statV2.ping",{type:"click",txid:"pg_barrage_entersend"}))}).bind("input propertychange",function(){var t=d.val();if(80<c(t))return d.val(function a(t,e){var i=/[^\x00-\xff]/g;if((t=t||"").replace(i,"mm").length>e)for(var n=Math.floor(e/2);n<t.length;n++)if(t.substr(0,n).replace(i,"mm").length>=e)return t.substr(0,n);return t}(t,80)),s.css(n),!1;s.css(o)})},getInfoValue:function(t){return p(".tm-"+t+' li[class*="on"]').data("type")},setUnable:function(t){t?(r.removeClass("tm-tmbtn-unable"),m.removeClass("tm-emot-unable"),d.removeAttr("readonly"),d.off("focus.readonly"),2==o&&r.addClass("tm-tmbtn-over"),i()&&(u.removeClass("tm-send-unable"),b.removeClass("tm-tmsz-unable")),this.dmInitSetting()):(r.addClass("tm-tmbtn-unable").removeClass("tm-tmbtn-over"),m.addClass("tm-emot-unable"),u.addClass("tm-send-unable"),b.addClass("tm-tmsz-unable"),d.attr("readonly","readonly"),d.on("focus.readonly",function(){return p(this).blur(),!1}))},dmInitSetting:function(a){var t=this;if(a=a||t.INIT_SETTING,_e(a),!r.hasClass("tm-tmbtn-unable")&&!t.hasInitSetting&&a){n||t.renderDM();var e=a.dmOpen;t.setDmInfo("open",e),2==e&&r.addClass("tm-tmbtn-over");p.each(["color","size","place","type"],function(t,e){var i=p(".tm-"+e),n=0===t?"tmc-on":"tmsi-on";i.find("li").removeClass(n),i.find('li[data-type="'+a[e]+'"]').addClass(n)});var i=p(".tm-fliter");i.find("li").removeClass("tmsi-on"),p.each(a.fliter,function(t,e){"0"===e.show&&i.find('li[data-type="'+e.place+'"]').addClass("tmsi-on")}),!f&&t.showTips(e),t.hasInitSetting=!0}},showTips:function(t){f=!0;var e=sohuHD.dmbar.cookie("dm_switch_tips");if(2==t&&!e){var i=l.find(".tm-wel3");i.show(),setTimeout(function(){i.hide()},1e4)}var n=sohuHD.dmbar.cookie("dm_input_tips");if(1==t&&!n){var a=l.find(".tm-wel1");a.show(),setTimeout(function(){a.hide()},1e4)}},initMenuList:function(){var e=this.options.listBox;if(e){"string"==typeof e&&(e=p("#"+e));var n,i=e.height(),a={timeFormat:function(t,e){t/=1;var a={"m+":Math.floor(t/60),"s+":t%60};for(var i in e=e.replace(/(m+)/,function(t,e){var i=e,n=(""+a["m+"]).length;return e&&n>e.length&&(i=new Array(n+1).join("m")),i}),a)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,("00"+a[i]).slice(1+~RegExp.$1.length)));return e},escapeXSS:function(t){return(t||"").replace(/</g,"&lt;").replace(/>/g,"&gt;")}},o=["",'<div class="tmList scroll-bar" style="height:<%=height%>px">','    <ul class="tmu td-n cfix" pb-click-a="mc" data-pb-txid="pg_barrage_listseek">',"        <%for(var i = 0, item; item = res.data[i]; i++) {%>",'        <li class="tmi" data-dmlist-seek="<%=Math.floor(item.vtime)%>">','            <a class="tma" href="javascript:void(0);">','                <span class="tms l"><%=helper.timeFormat(Math.floor(item.vtime), "mm:ss")%></span>','                <span class="tm-txt r" title="<%=item.content%>"><%=helper.escapeXSS(item.content)%></span>','                <span class="tmi-btn" data-content="<%=item.content%>" data-id="<%=item.id%>" pb-click data-pb-txid="pg_barrage_listreport">\u4e3e\u62a5</span>',"                <% if(item.fcount && item.fcount >= 10){ %>",'                <span class="tm-fav r"><%=item.fcount > 999 ? "999+" : item.fcount%></span>',"                <%}%>","            </a>","        </li>","        <%}%>","    </ul>","</div>",'<div class="tmPage td-n cfix">',"    <% if(res.page > 1) {%>",'        <span class="tmpa-pre" data-dmlist-page="<%= res.page - 1 %>" pb-click="mc" data-pb-txid="pg_barrage_listpageup"> </span>',"    <%} else {%>",'        <span class="tmpa-pre tmpa-pre-unable" pb-click="mc" data-pb-txid="pg_barrage_listpageup"> </span>',"    <%}%>",'    <span class="tmpa"><%=res.page%></span>',"    <% if(res.flip) {%>",'        <span class="tmpa-next" data-dmlist-page="<%= res.page + 1 %>" pb-click="mc" data-pb-txid="pg_barrage_listpagedown"></span>',"    <%} else {%>",'        <span class="tmpa-next tmpa-next-unable" pb-click="mc" data-pb-txid="pg_barrage_listpagedown"></span>',"    <%}%>",'</div><div class="tmTip"></div>'].join(""),s=function(t){e&&x&&x.j2s_getDmData(t,50,function(t){e.html(sohuHD.tmpl(o,{res:t,height:i-41,helper:a}))})};e&&x&&(e.on("click","[data-dmlist-page]",function(t){var e=parseInt(p(this).attr("data-dmlist-page"),10);s(e),t.preventDefault()}),e.on("dblclick","[data-dmlist-seek]",function(t){var e=p(this),i=parseInt(e.attr("data-dmlist-seek"),10);n&&n.removeClass("on"),(n=e).addClass("on"),x.j2s_seek(i),t.preventDefault()})),s(1)}},subscribeTopics:function(){var i=this,n=!1,a={};messagebus.subscribe("player.dm_ready",function(t,e){g=!0,x=e,messagebus.subscribe("player.dm_init_setting",function(t,e){a.setting=i.INIT_SETTING=e,n||i.dmInitSetting(a.setting)},null,null,{cache:!0})},null,null,{cache:!0}),messagebus.subscribe("player.dm_input_allow",function(t,e){a.allow=Boolean(~~e),n||i.setUnable(a.allow)},null,null,{cache:!0}),messagebus.subscribe("play.onStartAdShown",function(t){n=!0},null,null,{cache:!0}),messagebus.subscribe("play.onStartAdFinish",function(t){n=!1,p.isEmptyObject(a)||(i.dmInitSetting(a.setting),i.setUnable(a.allow))},null,null,{cache:!0}),messagebus.subscribe("play.onMAdShown",function(t){i.setUnable(!1)},null,null,{cache:!0}),messagebus.subscribe("play.onMAdFinish",function(t){i.setUnable(!0)},null,null,{cache:!0}),messagebus.subscribe("play.nextVideoPlayed",function(t){h.processTo(100),b.find(".tm-fliterColor li").removeClass("tmc-dis").removeClass("tmsi-dis")},null,null,{cache:!0}),messagebus.subscribe("player.dm_data_ok",function(t,e){i.initMenuList()},null,null,{cache:!0}),messagebus.subscribe("player.dm_switch",function(t,e){r.hasClass("tm-tmbtn-unable")||(1==e?(o=2,r.addClass("tm-tmbtn-over")):(o=1,r.removeClass("tm-tmbtn-over")))},null,null,{cache:!0}),messagebus.subscribe("core.login",function(t,e){p("#dmbar").removeClass("tm-in-unlogin"),g&&!n&&a.allow&&i.setUnable(a.allow)},null,null,{cache:!0}),messagebus.subscribe("core.logout",function(t,e){p("#dmbar").addClass("tm-in-unlogin"),u.addClass("tm-send-unable"),b.addClass("tm-tmsz-unable")},null,null,{cache:!0})}}),a.showDmbar=function(t){return(s=sohuHD._dmbar=new k(t)).init(),s};var _={},w={dmId:null,dmContent:null,tmpl:["",'<div class="tmi-box tmi-jubao">',"    <h4>\u4e3e\u62a5\u5f39\u5e55</h4>","    <dl>",'        <dt>\u4e3e\u62a5\u5bf9\u8c61<span class="tmi-close"></span></dt>',"        <dd>",'            <div class="tmi-tt" title="<%=dmContent %>"><%=dmContent %></div>',"        </dd>","        <dt>\u4e3e\u62a5\u7406\u7531</dt>","        <dd>",'            <ul class="item cfix" style="margin-right:-10px;">',"                <% $.each(data, function(index, item){ %>",'                <li data-id="<%=item.id %>"><%=item.reason %></li>',"                <% }); %>","            </ul>","        </dd>","    </dl>","</div>",'<div class="tmi-box-tips"><span class="tips-ok"></span><span class="ib va-m">\u4e3e\u62a5\u6210\u529f!</span></div>'].join(""),init:function(){this.$box=p('[data-tab="album-box-dmlist"]'),this.getReason(),this.initEvent()},initEvent:function(){var e=this;e.$box.delegate(".tmi-btn","click",function(){var t=p(this);e.dmId=t.data("id"),e.dmContent=t.data("content"),i()||!sohuHD.showLoginWinbox?e.showWin():sohuHD.showLoginWinbox(function(){e.showWin()})}).delegate(".tmi-close","click",function(){p(this);e.closeWin()}).delegate(".tmTip ul li","click",function(){var t=p(this);e.reasonId=t.data("id"),e.sendReason()})},getReason:function(){var e=p.Deferred(),t={act:"tip_reason",pct:"9001"==a.cid?3:2};return _.reason?e.resolve(_.reason):p.ajax({url:"//api.danmu.tv.sohu.com/danmu",data:t,type:"get",dataType:"jsonp"}).then(function(t){_.reason=t,e.resolve(t)}),e.promise()},sendReason:function(){var i=this,t={act:"dm_tip",vid:a.vid,aid:a.playlistId,dm_id:i.dmId,tip_reason:i.reasonId,pct:"9001"==a.cid?3:2};p.ajax({url:"//api.danmu.tv.sohu.com/dm_v2/dm_tip?",data:t,type:"get",dataType:"jsonp"}).then(function(t){messagebus.publish("statV2.ping",{type:"impress",txid:"pg_barrage_reportsuccess"});var e=i.$box.find(".tmi-box-tips").show();i.$box.find(".tmi-jubao").hide(),setTimeout(function(){e.hide(),i.closeWin()},3e3)})},showWin:function(){var i=this;i.getReason().then(function(t){if(1==t.status){var e=sohuHD.Template.render(i.tmpl,{data:t.data,dmContent:i.dmContent,dmId:i.dmId});i.$box.find(".tmTip").html(e).show(),i.setCenter()}})},closeWin:function(){this.$box.find(".tmTip").hide()},setCenter:function(){var t=this.$box.find(".tmi-jubao"),e=t.outerHeight();t.css({"margin-top":~e/2})}};messagebus.subscribe("core.rendervideo",function(t,e){if(sohuHD&&sohuHD.getPlayerArea){var i=340;1==a.cid&&(i=0);var n=sohuHD.getPlayerArea(i);e=p.extend(!0,{},{width:n.width+"px"},e)}s||showDmbar(e)},null,null,{cache:!0}),messagebus.subscribe("play.player_menu_inited",function(t,i){var n,a=null,o=null,s=!1,l=function(t){a&&o&&o.j2s_getDmData(t,50,function(t){a.html(sohuHD.render("menu_dmlist",{res:t})),sohuHD.play.adjust()})};i.on("active.dmlist",function(t,e){(a=e.$boxElem).data("loaded")||(a.data("loaded",!0),a&&o&&(a.on("click","[data-dmlist-page]",function(t){var e=parseInt(p(this).attr("data-dmlist-page"),10);l(e),t.preventDefault()}),a.on("dblclick","[data-dmlist-seek]",function(t){var e=p(this),i=parseInt(e.attr("data-dmlist-seek"),10);n&&n.removeClass("on"),(n=e).addClass("on"),o.j2s_seek(i),t.preventDefault()})),l(1),w.init())}),messagebus.subscribe("player.dm_init_setting",function(){s||(i.$container.find("[data-tab=album-tab-dmlist]").hide(),i.enable("dmlist",!1))},null,null,{cache:!0}),messagebus.subscribe("player.dm_data_ok",function(t,e){s=!0,i.$container.find("[data-tab=album-tab-dmlist]").show(),o=e,i.enable("dmlist",!0),l(1)},null,null,{cache:!0})},null,null,{cache:!0})}(jQuery,window);