KISSY.add("mui/mallbar/plugin-nav",function(a,e,i,t,o,n,s,r){var m=(['<img class="mui-mbarp-nav-logo mui-mbarp-nav-logo-anim" src="{0}" />'].join(""),function(a){var e=this;m.superclass.constructor.call(e,a),e.init()});return a.extend(m,e,{"init":function(){function a(){i.one(".mui-mbarp-nav-bd").height(i.height())}var e=this,i=e.get(n.K.CONTAINER),t=e.get(n.K.MALLBAR_ITEM),o=t.get(n.K.TAB),r=o.one(".mui-mbar-tab-txt"),m=o.one(".mui-mbar-tab-tip"),l=o.one(".mui-mbar-tab-tip-arr"),c=o.one(".mui-mbar-tab-logo-nav"),u=t.get("data"),b=(t.get(n.K.MALLBAR),o.one(".mui-mbar-tab-logo-nav-top"));e.on(n.E.VISIBILITY_CHANGE,function(e){e.visible&&e.first&&s.getStaticConf({"cb":function(e){i.html(s.fm('<iframe src="{0}" class="mui-mbarp-nav-bd" frameborder="0"></iframe>',e.navUrl||n.U.NAV_TMS)),a()}}),a()});var d="//1111.tmall.com";u&&(u.logo&&c.css(KISSY.UA.ie&&KISSY.UA.ie<9?{"filter":"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+u.logo+"',sizingMethod='scale')"}:{"background-image":"url("+u.logo+")","background-size":"100%"}),u.bgColor&&(o.css("background-color",u.bgColor),m.css("background-color",u.bgColor),l.css("color",u.bgColor)),u.txtColor&&(r.css("color",u.txtColor),m.css("color",u.txtColor)),b&&u.topBgColor&&b.css("background-color",u.topBgColor),u.link&&o.on("click",function(a){var e=window.g_config||{};return"mui-mbar-tab-logo-nav-top"==a.target.className?void window.open(s.replaceSCM(u.topLink||d,"1048.1.7.8")):e.mallbarTaobao?void window.open(s.replaceSCM(u.taobaoLink||"//world.taobao.com/markets/all/15s11/main","1048.1.7.7")):void window.open(s.replaceSCM(u.link||d,"1048.1.7.4"))}))}}),m},{"requires":["base","node","ua","event","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","mui/mallbar/plugin-nav.css"]});KISSY.add("mui/mallbar/plugin-worth",function(a,e,i,t,o,n,r,s){var m=function(a){var e=this;m.superclass.constructor.call(e,a),e.init()};return a.extend(m,e,{"init":function(){function e(){n.getStaticConf({"cb":function(a){var e=h.one(".mui-mbar-tab-logo-worth");a.worthTabLogo&&e.append(n.fm('<img width="35" heigth="30" src="{0}" />',a.worthTabLogo)),a.worthMore&&(d.moreUrl=n.replaceSCM(a.worthMore,"1048.1.13.6")),a.worthBizBubble&&i()}})}function i(){d.isDetail||d.isShop||(A.isLogin?r.get({"k":"mui/mbarp/worth/biz/bubble/"+f.getUid(),"success":function(a){a||t(2,"biz")}}):t(4.4,"biz"))}function t(a,e){var i=['<div class="mui-mbar-bubble mui-mbarp-bubble-worth" >','<div class="mui-mbar-arr mui-mbarp-bubble-worth-arr">\u25c6</div>',"</div>"].join(""),t=['<div class="mui-mbar-bubble mui-mbarp-bubble-worth-biz" >','<div class="mui-mbar-arr mui-mbarp-bubble-worth-arr-biz">\u25c6</div>',"</div>"].join(""),s=i,m="mui/mbarp/worth/bubble/"+f.getUid(),l="WORTH_BUBBLE_SHOW",c="WORTH_BUBBLE_CLICK";"biz"==e&&(s=t,m="mui/mbarp/worth/biz/bubble/"+f.getUid(),l="WORTH_BUBBLE_BIZ_SHOW",c="WORTH_BUBBLE_BIZ_CLICK"),g.bubble({"show":!0,"content":s,"customContentType":3,"flag":a,"height":77,"bubbleType":0,"tab":"WORTH","isNotTabFire":!0,"showed":function(){n.sendLog(o.ARR[l]),A.isLogin&&r.set({"k":m,"v":1,"expires":1})},"clicked":function(){!!h&&h.fire("click"),n.sendLog(o.ARR[c])},"dismiss":function(){}})}function m(){p.html('<div class="mui-mbarp-worth-recommend"></div><div class="mui-mbarp-worth-guess"></div><a class="mui-mbarp-worth-more" target="_blank" href="//www.tmall.com/wow/portal/act/worth-to-buy?scm=1048.1.13.6"><span class="icon">+</span>\u67e5\u770b\u66f4\u591a</span></a>'),d.isDetail?l():c(),u(),b()}function l(){var e='<li class="mui-mbarp-worth-recommand-item">                <a target="_blank" href="{{itemUrl}}">                    <img src="{{itemPic}}_100x100" width="100" height="100"/>                    <p title="&yen;{{itemPrice}}">&yen;{{itemPrice}}</p>                    {{#if tag201511}}<span class="mui-mbarp-11-flag worth"></span>{{/if}}                </a></li>',i=g.get("itemId")||"",t=g.get("sellerId")||"",o="";window.g_config&&window.g_config.categoryId&&(o=window.g_config.categoryId);var r="";n.ajax({"url":"//bar.tmall.com/getSimilarItems.htm","jsonpCallback":"_mallbarWorthRecommend","dataType":"jsonp","data":{"sellerId":t,"nid":i,"categoryId":o},"timeout":5,"success":function(i){if(i){var t=p.one(".mui-mbarp-worth-recommend"),o=i.l||"";o&&o.length>0&&(r+='<p class="mui-mbarp-worth-recommend-hd">\u76f8\u4f3c\u5546\u54c1\u63a8\u8350</p><ul class="mui-mbarp-worth-recommend-ul">',a.each(o,function(a){a.tag201511=a.tag201511&&g.tag201511Time,a.itemUrl=n.replaceSCM(a.itemUrl,"1048.1.13.3"),r+=new s(e).render(a)}),r+="</ul>",t.html(r),!!i.exposureParam&&n.sendLog(i.exposureParam))}},"error":function(){}})}function c(){var e='<li class="mui-mbarp-worth-recommand-item">                <a target="_blank" href="{{url}}">                    <img src="{{picUrl}}_100x100" width="100" height="100"/>                    <p title="&yen;{{wapFinalPrice}}">&yen;{{wapFinalPrice}}</p>                    {{#if tag201511}}<span class="mui-mbarp-11-flag worth"></span>{{/if}}                   <span class="rank">{{index}}</span>                 </a></li>',i="";window.g_config&&window.g_config.cat_rt&&(i=window.g_config.cat_rt);var t="";n.ajax({"url":"//ald.taobao.com/recommend.htm?appId=07011"+(i?"&catId="+i:""),"jsonpCallback":"_mallbarWorthRecommend","dataType":"jsonp","timeout":5,"success":function(i){if(i){var o=p.one(".mui-mbarp-worth-recommend"),r=i.data||[];(r=r[0]||{})&&r.items&&r.items.length>0&&(t+='<p class="mui-mbarp-worth-recommend-hd">'+r.catName+'\u6392\u884c\u699c</p><ul class="mui-mbarp-worth-recommend-ul">',a.each(r.items,function(a,i){a.index=i+1,a.tag201511=a.tag201511&&g.tag201511Time,a.itemUrl=n.replaceSCM(a.url,"1048.1.13.2"),t+=new s(e).render(a)}),t+="</ul>",o.html(t),!!i.exposureParam&&n.sendLog(i.exposureParam))}},"error":function(){}})}function u(){var a=p.one(".mui-mbarp-worth-guess"),e='<li class="mui-mbarp-worth-recommand-item">                <a target="_blank" href="{{itemUrl}}">                    <img src="{{imgUrl}}" width="100" height="100"/>                    <p title="&yen;{{price}}">&yen;{{price}}</p>                     {{#if tag201511}}<span class="mui-mbarp-11-flag worth"></span>{{/if}}                </a>                </li>',i="";n.ajax({"url":"//ald.taobao.com/recommend.htm?appID=2015101022","dataType":"jsonp","jsonpCallback":"_mallbarWorthLists","data":"","timeout":5,"success":function(t){if(t.data&&t.data.length>0){for(var o=t.data,r=o.length,m="<ul>",l="<ul>",c=0;c<2;c++)o[c].tag201511=o[c].tag201511&&g.tag201511Time,o[c].itemUrl=n.replaceSCM(o[c].itemUrl,"1048.1.13.4"),m+=new s(e).render(o[c]);if(m+="</ul>",r>2)for(var c=2;c<r;c++)o[c].tag201511=o[c].tag201511&&g.tag201511Time,o[c].itemUrl=n.replaceSCM(o[c].itemUrl,"1048.1.13.4"),l+=new s(e).render(o[c]);l+="</ul>",i='<p class="mui-mbarp-worth-recommend-hd">\u731c\u4f60\u559c\u6b22</p><div class="mui-mbarp-worth-guess-top">'+m+'</div><div class="mui-mbarp-worth-guess-banner" id="J_WorthGuessBanner"></div><div class="mui-mbarp-worth-guess-bottom">'+l+"</div>",a.html(i),p.one(".mui-mbarp-worth-more").attr("href",d.moreUrl),p.one(".mui-mbarp-worth-more").addClass("show")}}})}function b(){g&&!g.channelRecommend||n.ajax({"url":"//ald.taobao.com/recommend.htm?appId=05110&personalHallCount=1","dataType":"jsonp","jsonpCallback":"_mallbarWorthBanner","data":"","timeout":5,"success":function(e){if(!!e.exposureParam&&n.sendLog(e.exposureParam),e.data&&e.data.length>0){var i=e.data[0];i.action=n.replaceSCM(i.action,"1048.1.13.5");var t='<a class="mui-mbarp-worth-recommend-banner" href="'+i.action+'" target="_blank"><img src="'+i.imgUrl+'"></a>';a.available("#J_WorthGuessBanner",function(){a.one("#J_WorthGuessBanner").html(t)})}}})}var d=this,p=d.get(o.K.CONTAINER),f=d.mallbarItem=d.get(o.K.MALLBAR_ITEM),g=f.get(o.K.MALLBAR),h=f.get(o.K.TAB),v=h.one(".mui-mbar-tab-sup");d.tip=v,d.get("pluginHead"),d.isDownShelf=!1;var _=n.getSysId();d.isDetail="detail"==_,d.isShop="shop"==_;var A=f.getUserInfo(),I=h.one(".mui-mbar-tab-logo"),C=f.get("data"),T=h.one(".mui-mbar-tab-tip"),E=h.one(".mui-mbar-tab-tip-arr"),B=h.one(".mui-mbar-tab-logo-arr");C&&(C.logo&&I.css(KISSY.UA.ie&&KISSY.UA.ie<9?{"filter":"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+C.logo+"',sizingMethod='scale')"}:{"background-image":"url("+C.logo+")","background-size":"100%"}),C.bgColor&&(h.css("background-color",C.bgColor),T.css("background-color",C.bgColor),E.css("color",C.bgColor),B.css("color",C.bgColor))),e();var L=!0;d.on(o.E.VISIBILITY_CHANGE,function(a){d.tip.hide(),a.visible&&L&&m(),L=!1}),d.on(o.E.DATA_CHANGE,function(a){L=!0,f.get(o.K.EXPAND)&&(d.tip.hide(),m())});var R=window.TShop;R&&R.onProduct&&R.onProduct(function(a){a.onLoad("isDownShelf",function(a){a&&(d.isDownShelf=!0,n.getStaticConf({"cb":function(a){var e=g.get(o.K.MODEL).get(o.K.TIMESTAMP);if(d.isDetail){var i=a.handleDownShelfTime||{},r=i.s?i.s:"1",s=i.e?i.e:"1447257600000";if(A.isLogin&&e>r&&e<s){var l="";if(!!window.g_config&&(l=window.g_config.sellerId||""),a.worthBlacklist=a.worthBlacklist||["217101303","700459267","196993935","352469034","2064892827","470168984","1114511827","1714128138","2616970884","1917047079","2037040441","263680407"],a.worthBlacklist&&a.worthBlacklist.length)for(var c=a.worthBlacklist.length,u=a.worthBlacklist,b=0;b<c;b++)l==u[b]&&(d.notNeedExpand=!0);d.notNeedExpand?t(2):(m(),L=!1,!!h&&h.fire("click"),n.sendLog(o.ARR.WORTH_TAB_EXPAND))}else t(2)}}}))})})}}),m},{"requires":["base","node","event","mui/mallbar/conf","mui/mallbar/util","mui/mallbar/store","xtemplate","mui/mallbar/plugin-worth.css"]});