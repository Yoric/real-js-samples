KISSY.add("mui/detail-review/listmz",function(e,t,a,r,i,s,n,l,o,c,d,u,v,f,p,g){var h={};var m=true;var y=true;h.mm=function(e){(new Image).src="//gm.mmstat.com/tmallrate."+e};var b;h.pu=function(e){(new Image).src="//gm.mmstat.com/tmallrate.7.1."+e+"?logtype=4&itemid="+this.config.itemId+"&nick="};h.publicize={bool:false,txt:'<a style="color:rgb(255, 102, 0)" href="//www.tmall.com/go/act/sale/xpjscp.php?ad_id=&am_id=1301056723b1ff6c5c00&cm_id=&pm_id=" target="_blank">5\u670820-5\u670829\u65e5\u671f\u95f4,\u8ba4\u771f\u5199\u8bc4\u4ef7\u5c31\u6709\u673a\u4f1a\u8d62\u5f97500\u4e07\u5f69\u7968\u5927\u5956\uff01</a><a href="//www.tmall.com/go/act/sale/xpjscp.php?ad_id=&am_id=1301056723b1ff6c5c00&cm_id=&pm_id=" target="_blank">\u8be6\u60c5</a>'};h.setPublicize=function(){if(this.publicize.bool&&document.location.href.indexOf("rate_detail")==-1){var t=this.publicize.txt!=""?this.publicize.txt:"\u6d3b\u52a8\u4fe1\u606f<a>\u6d3b\u52a8\u4fe1\u606f</a>";var a='<div class="publicize">'+t+"</div>";e.all(a).insertBefore("div.rate-toolbar")}};h.init=function(r,i,s){codeTrack("detail-review.listMz.init","detail-review.init");if(i.rememberSort){h.LocalStorage=o}var n=this;n.el=t.get(r);n.config=i;if(u.checkEnvironmentAvaliable()){n.config.tagInput=false}if(s!=undefined){m=s}else{n.publicize.bool=false}u.gm("8.2.2");n.queryvars={itemId:i.itemId,spuId:i.spuId,sellerId:i.sellerId,order:n.showCurTagControl()||1,currentPage:1,append:0,content:1,tagId:"",posi:"",picture:"",groupId:i.groupId||""};n._thwlang=i._thwlang?{_thwlang:i._thwlang}:{};n.headerEl=t.get("div.rate-header",n.el);n.subjectEl=t.get("div.rate-subject",n.el);n.toolbarEl=t.get("div.rate-toolbar",n.el);n.gridEl=t.get("div.rate-grid",n.el);n.pageEl=t.get("div.rate-page",n.el);n.chatEl=t.get("div.rate-chat",n.el);n.composeEl=t.get("div.rate-compose",n.el);n.toolbarEl.innerHTML=n.renderToolbar();n.isChatWindowShow=false;n.isChatBucket=false;var l=n.getSortConfig(n.queryvars.order);var c=new f({renderObj:l});t.get(".rate-sort",n.toolbarEl).innerHTML=c.getDomStr();c.render("."+l.contentclass);n.sortselect=c;n.sortSelectListenning();a.on(t.query("input",n.toolbarEl),"click",function(){if(t.hasClass(this,"rate-list-tryreport")){return}if("radiogrounp"===this.name){n.resetQueryvars();n.clearUISelectStyle("carea");if(t.hasClass(this,"rate-list-all")){n.queryvars.tagId="";n.queryvars.posi="";n.queryvars.append=0;n.queryvars.picture=0}if(t.hasClass(this,"rate-list-append")){n.queryvars.tagId="";n.queryvars.posi="";n.queryvars.append=1;n.queryvars.picture=0;u.gm("6.2.7")}if(t.hasClass(this,"rate-list-picture")){n.queryvars.tagId="";n.queryvars.posi="";n.queryvars.append=0;n.queryvars.picture=1;u.gm("8.2.4")}if(t.hasClass(this,"rate-list-chat")){if(n.isChatBucket){n.renderChatWindow(n.hasRenderChatWindow,i);window.TribeModule&&TribeModule.msg.fire("DETAIL.TRIGGER",{isChatWindow:true});n.hasRenderChatWindow=true;n.isChatWindowShow=true;return true}}else{if(n.isChatWindowShow&&n.isChatBucket){t.hide(n.chatEl);t.show(n.gridEl);t.show(n.pageEl);window.TribeModule&&TribeModule.msg.fire("DETAIL.TRIGGER",{isChatWindow:false});n.isChatWindowShow=false}}}if(this.name==="content"){n.queryvars[this.name]=this.checked?1:0;n.queryvars.currentPage=1}n.request()});if(i.listLoader){i.listLoader(function(e){n.render(e)})}else{if(i.rememberSort){switch(parseInt(n.queryvars.order)){case 1:n.pu(1);break;case 2:n.pu(2);break;case 3:n.pu(3);break}}else{n.request(function(t){e.isFunction(n.config.onPaint)&&n.config.onPaint(t)})}}if(n.config.tagInput){n.getCurTextArea(true)}function d(t){if(n.config.inBucketForCloudTag){n.renderTags(t);n.renderCharts(t);if(t.tags){n.renderPersentInfo(t.tags.innerTagCloudList)}if(t&&(!t.tags||!e.isArray(t.tags.userTagCloudList)||t.tags.userTagCloudList.length===0)&&(!t.tags||!e.isArray(t.tags.innerTagCloudList)||t.tags.innerTagCloudList.length===0)&&(t.tags.structuredRateStatisticList&&t.tags.structuredRateStatisticList.length>0)){n.renderStructureList(t)}}else{n.renderNewCharts(t)}}if(i.tagLoader){i.tagLoader(d)}else{if(n.config.inBucketForCloudTag){n.requestTags(d)}else{n.requestNewChart(d)}}if(i.scoreLoader){i.scoreLoader(function(e){n.renderScore(e)})}n.setPublicize()};h.initTryReport=function(){var a=this;if(a.config&&a.config.tryReportDisable){return}codeTrack("detail-review.listMz.initTryReport","detail-review.listMz.init");var r=new d(e.merge(a.config,{container:t.get(".rate-tryreport",a.el),success:function(e){u.gm("8.2.1");a.addTryAnchor(e)}}))};h.addTryAnchor=function(r){var i=e.now();var s=t.create('<input class="rate-list-tryreport " id="J_RateWithTryreport'+i+'" type="radio" name="radiogrounp"/><label for="J_RateWithTryreport'+i+'">\u8bd5\u7528\u62a5\u544a'+"("+r+")"+"</label>");t.append(s,t.get(".rate-filter"));a.on(t.get("#"+"J_RateWithTryreport"+i),"click",function(e){t.scrollTop(t.offset(t.get(".rate-tryreport",self.el)).top-50);u.gm("8.2.8")})};h.sortSelectListenning=function(){var e=this;var t=e.sortselect.get("renderObj");for(var a=0;a<t.list.length;a++){if(t.list[a]){e.sortselect.on(t.list[a].eventval,function(t){e.queryvars.order=t.type.split("_")[1];e.queryvars.currentPage=1;e.request()})}}};h.getSortConfig=function(e){var t=e-0;var a="\u6309\u9ed8\u8ba4";var r=[{text:"\u6309\u65f6\u95f4",eventval:"sort_1",postfixclass:"time",dataobjstr:'{userPropertyId:"10",userPropertyIndex:"1"}'},{text:"\u6309\u9ed8\u8ba4",eventval:"sort_3",postfixclass:"default",dataobjstr:"{userPropertyId:10,userPropertyIndex:0}"}];var i=r;switch(t){case 1:a="\u6309\u65f6\u95f4";i=r;break;case 2:a="\u6309\u4fe1\u7528";i=new Array(r[1],r[0],r[2]);break;case 3:a="\u6309\u9ed8\u8ba4";i=new Array(r[2],r[1],r[0]);break}return{defaulttext:a,contentclass:"tm-rate-sort",list:i}};h.resetQueryvars=function(){this.queryvars.currentPage=1;this.queryvars["itemPropertyId"]="";this.queryvars["itemPropertyIndex"]="";this.queryvars.tagId="";this.queryvars.posi="";this.queryvars.picture=0;this.queryvars.append=0;this.queryvars["userPropertyId"]="";this.queryvars["userPropertyIndex"]="";this.queryvars.rateQuery="";this.queryvars.location=""};h.clearUISelectStyle=function(a){var r=this;if(a!=="newcharts"){p.clearSelectd()}if(a!=="tag"){t.removeClass(r.curTagEl,"selected");r.curTagEl=null}if(a!=="alltheme"){t.removeClass(t.query(".theme-field"),"select hover")}if(a!=="carea"){e.each(t.query("input.rate-radio-group",r.toolbarEl),function(e,a){if(t.hasClass(e,"rate-list-all")){t.attr(e,"checked",true)}else{t.attr(e,"checked",false)}})}if(a!=="chart0"){r.filter0&&r.filter0.resetUI()}if(a!=="chart1"){r.filter1&&r.filter1.resetUI()}};h.renderScore=function(a){if(this.config.rateScoreDisable)return;codeTrack("detail-review.listMz.renderScore","detail-review.listMz.init");var r=e.isPlainObject(a)?a.gradeAvg:0;r=r||0;var i=r-0;var s='<div class="rate-score">';s+="<h4>\u4e0e\u63cf\u8ff0\u76f8\u7b26</h4>";s+="<strong>"+r+"</strong>";s+='<p><span class="score-value-no score-value-'+(""+i).replace(".","d")+'"><em></em></span></p>';s+="</div>";if(!this.config.rateProgressBarDisable){s+='<div class="rate-graph">';s+='<div class="graph-scroller"><span style="width:'+r*20+'%"><em>'+r+"</em></span></div>";s+='<ol class="graph-desc">'+"<li>\u975e\u5e38\u4e0d\u6ee1</li>"+"<li>\u4e0d\u6ee1\u610f</li>"+"<li>\u4e00\u822c</li>"+"<li>\u6ee1\u610f</li>"+"<li>\u975e\u5e38\u6ee1\u610f</li>"+"</ol>"}t.prepend(t.create(s),this.headerEl);t.css(this.headerEl,"display","block")};h.request=function(t,a){var r=this;if(e.isFunction(t)){a=t;t={}}if(typeof t==="undefined"){t={}}codeTrack("detail-review.listMz.request","detail-review.listMz.init");t.needFold=0;r.fetch(t,function(t){var i=t&&t.rateDetail||null;var s=i&&i.paginator;codeTrack("detail-review.listMz.fetch","detail-review.listMz.request");r.render(i);if(!r.queryvars.tagId&&s&&s.page>1&&s.page==s.lastPage){r.renderMoreRate(i)}var n;if(i&&i.rateList){n=i.rateList.length}if(e.isFunction(a)){a(n)}if(y){y=false;setTimeout(function(){r.initTryReport()},999)}})};h.fetch=function(t,a){var i=this;if(e.isFunction(i.config.ua)){i.queryvars["ua"]=i.config.ua()}var s;if(i.config.inBucketForCloudTag){s="//rate."+(i.config.daily?"daily.tmall.net":"tmall.com")+"/list_detail_rate.htm"}else{s="//rate."+(i.config.daily?"daily.tmall.net":"tmall.com")+"/list_detail_rate_tab.htm";i.queryvars["retTagOrRate"]=2}if(e.isFunction(t)){a=t;t={}}i.queryParams=e.merge(i.queryvars,t,i._thwlang);var n;new r(n={url:s,data:i.queryParams,success:function(t){if(e.isPlainObject(t)&&t["rgv587_flag"]==="sm"){e.use("sd/data_sufei/index,sd/data_sufei/css/taobao.css",function(e,a){new a({data:t,ioConfig:n,dialogConfig:{prefixCls:"sufei-tb-",headerContent:"\u8bbf\u95ee\u9a8c\u8bc1"},style:"tmall"})});return}a(t)},dataType:"jsonp",crossDomain:true,cache:false})};h.renderMoreRate=function(r){codeTrack("detail-review.listMz.renderMoreRate","detail-review.listMz.init");var i=this,s=null,n=null,l=1;e.use(["mui/datalazyload/","mui/detail-review/more-rate.tpl"],function(e,o,c){var d=new o(i.gridEl,{autoDestroy:false,diff:100});u(r);function u(e){if(i.queryvars.picture){e.moreRateTotal=e.rateCount.picNum-e.paginator.items}else if(i.queryvars.append){e.moreRateTotal=e.rateCount.used-e.paginator.items}else{e.moreRateTotal=e.rateCount.total-e.paginator.items}if(e.moreRateTotal<1){return}var a=c(e);t.append(t.create(a),i.gridEl);if(!s||!n){setTimeout(function(){s=s||t.get(".tm-more-rate-wrapper",i.gridEl);n=n||t.get(".J_moreRateCommentsBd",s)},0)}}a.delegate(i.gridEl,"click",".J_closeMoreRateBtn",function(){s&&t.removeClass(s,"expanded")});a.delegate(i.gridEl,"click",".J_openMoreRateBtn",function(){s&&t.addClass(s,"expanded");p()});function v(e){var a=i.renderComments(e);n&&t.append(t.create(a.html),n);f()}function f(){l++;d.addCallback(".J_moreRateCommentFt",p)}function p(){i.fetch({currentPage:l,needFold:1},function(e){var a=e&&e.rateDetail||null;if(a&&a.rateList&&a.rateList.length>0){v(a)}else{!t.get(".tm-more-last-tip",".tm-more-rate-bd")&&t.append(t.create('<div class="tm-more-last-tip">\u5df2\u7ecf\u770b\u5230\u6700\u540e\u5566~</div>'),".tm-more-rate-bd")}})}})};h.requestTags=function(t){var a=this;if(a.config.rateCloudDisable)return;codeTrack("detail-review.listMz.requestTags","detail-review.listMz.init");var i="//rate."+(a.config.daily?"daily.tmall.net":"tmall.com")+"/listTagClouds.htm";r.jsonp(i,e.merge({itemId:a.config.itemId,isAll:true,isInner:!a.config.hasCompose,t:e.now(),groupId:a.config.groupId||""},a._thwlang),function(e){t(e)})};h.requestNewChart=function(e,t){var a=this;var i="//rate."+(a.config.daily?"daily.tmall.net":"tmall.com")+"/list_detail_rate_tab.htm";codeTrack("detail-review.listMz.requestNewChart","detail-review.listMz.init");a.queryvars.location=t?encodeURIComponent(t):encodeURIComponent("\u5168\u56fd");a.queryvars.retTagOrRate=1;new r(_ioConfig={url:i,data:a.queryvars,success:function(t){e(t)},dataType:"jsonp",crossDomain:true,cache:false})};h.renderComments=function(t){var a="",r=this;var i="";e.each(t.rateList,function(e){a+=r.renderOneComment(e);i+=e.id+"_"+e.rateDate+";"});return{html:a,dateStr:i}};h.render=function(r,i){if(!r){return}t.show(this.gridEl);var s=this;var n="";var l="";s.applyDanceInfo(r);var o=s.renderComments(r);n+=o.html;l+=o.dateStr;if(""!==l){s.mm("1.5.5?rateDate="+l)}this.detachEvents();if(!n){var c="\u55b5\uff5e\u8be5\u5546\u54c1\u8fd8\u6ca1\u6709\u4eba\u5199\u8bc4\u4ef7\u5462";if(s.queryParams&&s.queryParams.append){c="\u55b5\uff5e\u8be5\u5546\u54c1\u6682\u65e0\u8ffd\u52a0\u8bc4\u4ef7"}else if(s.queryParams&&s.queryParams.picture){c="\u55b5\uff5e\u8be5\u5546\u54c1\u8fd8\u6ca1\u4e70\u5bb6\u6652\u56fe"}n='<tr><td><div class="rate-empty">'+c+"</div></td></tr>"}this.gridEl.innerHTML="<table><tbody>"+n+"</tbody></table>";this.pageEl.innerHTML=this.renderPage(r.ratePaginator||r.paginator);e.each(t.query("div.tm-rate-fulltxt",this.gridEl),function(e){if(t.outerHeight(e)<=190){return}var r=e.parentNode;var i=t.create('<div class="rate-full-trigger"></div>',{html:"<span></span>"});var s=t.get("span",i);t.insertAfter(i,r);a.on(s,"click",function(){var e=t.hasClass(r,"tm-rate-content-collapse");this.title=e?"\u6536\u8d77\u5168\u6587":"\u5c55\u5f00\u5168\u6587";t[e?"removeClass":"addClass"](this,"rate-collapse");t[e?"removeClass":"addClass"](r,"tm-rate-content-collapse");t[e?"addClass":"removeClass"](r,"tm-rate-content-expand")});a.fire(s,"click")});this.initListEvents();this.renderRateCount(r.rateCount)};h.renderRateCount=function(e){this.renderRateCount=function(){};e=e||{};if(e.used||e.used===0){t.html(t.next(t.get("input.rate-list-append",this.toolbarEl)),"\u8ffd\u8bc4 ("+e.used+")")}if(e.picNum||e.picNum===0){t.html(t.next(t.get("input.rate-list-picture",this.toolbarEl)),"\u56fe\u7247 ("+e.picNum+")")}};h.renderOneComment=function(e){return"<tr>"+'<td class="tm-col-master">'+this.renderMaster(e)+"</td>"+'<td class="col-meta">'+this.renderMeta(e)+"</td>"+'<td class="col-author">'+this.renderAuthor(e)+"</td>"+"</tr>"};h.prependComment=function(a,r){var s=t.create(this.renderOneComment(a));t.remove(t.get("div.rate-empty",this.gridEl));t.prepend(s,t.get("tbody",this.gridEl));t.addClass(s,"rate-new");new i(s,{opacity:1},1,"easeOut",function(){setTimeout(function(){t.removeClass(s,"rate-new")},5e3);if(e.isFunction(r)){r(s)}}).run()};h.parseDate=function(e){if(!e.getTime()){return""}this.serverYearStr=e.getFullYear()+".";var t=e.getMonth()+1;if(t<10){t="0"+t}var a=e.getDate();if(a<10){a="0"+a}this.serverTime=this.serverYearStr+t+"."+a};h.applyDanceInfo=function(e){var t=this;var a=e.rateDanceInfo||{};t.parseDate(new Date(a.currentMilles));t.applyDanceInfo=function(){}};h.renderPage=function(t){if(!e.isPlainObject(t)||!t.lastPage){return""}var a="";var r=t.lastPage;if(r>0){a+='<div class="rate-paginator">';var i=t.page;if(i>1){a+='<a data-page="'+(i-1)+'" href="?page='+(i-1)+'">&lt;&lt;\u4e0a\u4e00\u9875</a>'}else{a+='<span class="rate-page-prev">&lt;&lt;\u4e0a\u4e00\u9875</span>'}var s=Math.max(1,i-2);var n=Math.min(r,i+2);if(i<5){s=1}else{if(s>1){a+='<a href="?page=1">1</a>'}if(s>2){a+='<a href="?page=2">2</a>'}if(s>3){a+='<span class="rate-page-break">...</span>'}}for(var l=s;l<=n;l++){if(l===i){a+="<span>"+l+"</span>"}else{a+='<a href="?page='+l+'">'+l+"</a>"}}var o=r-n;if(r-i>2){a+='<span class="rate-page-break">...</span>'}if(i===r){a+='<span class="rate-page-next">\u4e0b\u4e00\u9875&gt;&gt;</span>'}else{a+='<a data-page="'+(i+1)+'" href="?page='+(i+1)+'">\u4e0b\u4e00\u9875&gt;&gt;</a>'}a+="</div>"}return a};h.renderMaster=function(e){var t=this;var a=e.appendComment;var r="";var i=t.formatDate(e.rateDate);if(a){r+='<div class="tm-rate-premiere">            <div class=tm-rate-tag>            <div class="tm-rate-title">\u521d\u6b21\u8bc4\u4ef7:</div>            <div class="tm-rate-date">'+i+"</div></div>"+this.renderComment(e)+"</div>"}else{r+=this.renderOnlyComment(e)}if(a){var s=t.formatDate(a.commentTime);var n="";if(a.days!=undefined){n='<span class="tm-rate-daydiff">\u6536\u8d27'+(a.days?a.days+"\u5929\u540e":"\u5f53\u5929")+"\u8ffd\u52a0\uff1a</span>"}r+='<div class="tm-rate-append">                    <div class=tm-rate-tag>        <div class="tm-rate-title">'+n+'</div>        <div class="tm-rate-date"></div></div>'+this.renderComment({rateContent:a.content,diff:a.days,reply:a.reply,pics:a.pics})+"<s></s></div>"}return r};h.renderOnlyComment=function(e){var t=this;var a="";var r=e.rateContent;var i=e.serviceRateContent;var s=r&&i;var n=e.reply;var l=e.pics;if(!r&&!i){r="\u6b64\u7528\u6237\u6ca1\u6709\u586b\u5199\u8bc4\u8bba\uff01"}if(r){var o="";if("diff"in e){o='<span class="tm-rate-daydiff">\u6536\u8d27'+(e.diff?e.diff+"\u5929\u540e":"\u5f53\u5929")+"\u8ffd\u52a0\uff1a</span>"}var c="";if(l){c=t.renderPhotos(l)}a+='<div class="tm-rate-content"><div class="tm-rate-fulltxt">'+(s?"<span>\u5546\u54c1\uff1a</span>":"")+""+C(r)+"</div>"+(i?"":c)+"</div>"}if(i){a+='<div class="tm-rate-content"><div class="tm-rate-fulltxt">'+(s?"<span>\u670d\u52a1\uff1a</span>":"")+C(i)+"</div>"+c+"</div>"}if(e.carServiceLocation){a+='<div class="tm-rate-date">'+t.formatDate(e.rateDate)+" \u670d\u52a1\u95e8\u5e97\uff1a"+C(e.carServiceLocation)+"</div>"}else{a+='<div class="tm-rate-date">'+t.formatDate(e.rateDate)+"</div>"}if(n){a+='<div class="tm-rate-reply"><div class="tm-rate-fulltxt">\u89e3\u91ca\uff1a'+C(n)+"</div></div>"}return a};h.renderComment=function(e){var t=this;var a="";var r=e.rateContent;var i=e.serviceRateContent;var s=r&&i;var n=e.reply;var l=e.pics;if(!r&&!i){r="\u6b64\u7528\u6237\u6ca1\u6709\u586b\u5199\u8bc4\u8bba\uff01"}if(r){var o="";if("diff"in e){o='<span class="tm-rate-daydiff">\u6536\u8d27'+(e.diff?e.diff+"\u5929\u540e":"\u5f53\u5929")+"\u8ffd\u52a0\uff1a</span>"}var c="";if(l){c=t.renderPhotos(l)}a+='<div class="tm-rate-content"><div class="tm-rate-fulltxt">'+(s?"<span>\u5546\u54c1\uff1a</span>":"")+""+C(r)+"</div>"+(i?"":c)+"</div>"}if(i){a+='<div class="tm-rate-content"><div class="tm-rate-fulltxt">'+(s?"<span>\u670d\u52a1\uff1a</span>":"")+C(i)+"</div>"+c+"</div>"}if(e.carServiceLocation){a+='<div class="tm-rate-content"><div class="tm-rate-fulltxt"><span>\u95e8\u5e97\uff1a</span>'+C(e.carServiceLocation)+"</div></div>"}if(n){a+='<div class="tm-rate-reply"><div class="tm-rate-fulltxt">\u89e3\u91ca\uff1a'+C(n)+"</div></div>"}return a};h.renderPhotos=function(t){if(!e.isArray(t))return"";var a='<div class="tm-m-photos">'+'<ul class="tm-m-photos-thumb">    {{#each pics}}    <li  data-src="{{this}}_400x400.jpg" >        <img src="{{this}}_40x40.jpg"> <b class="tm-photos-arrow"></b>    </li>    {{/each}}</ul><div class="tm-m-photo-viewer" style="width:0px;height:0px;display:none;">    <img src="">    <a class="tm-m-photo-viewer-navleft"><i class="tm-m-photo-viewer-navicon">&#xe600;</i></a>    <a class="tm-m-photo-viewer-navright"><i class="tm-m-photo-viewer-navicon">&#xe601;</i></a></div></div>';var r=new s(a).render({pics:t});return r};h.renderAttrStr=function(t){var a="";e.each((t||"").split(";"),function(e){e=e.split(":");if(2===e.length){a+='<p title="'+e[0]+":"+e[1]+'"><span>'+e[0]+"\uff1a</span>"+e[1]+"</p>"}else{a+='<p title="'+e[0]+'">'+e[0]+"</p>"}});return a};h.renderMeta=function(e){var t="";var a=this.renderAttrStr(e.auctionSku);if(a){t+='<div class="rate-sku">'+a+"</div>"}var r=this.renderAttrStr(e.userInfo);if(r){t+='<div class="rate-user-profile">'+r+"</div>"}return t};h.renderAuthor=function(e){var t='<div class="rate-user-info">';if(e.displayUserNumId){var a="";if(e.displayUserNumId&&m&&e.userIdEncryption){a="//my."+(this.config.daily?"daily.taobao.net":"taobao.com")+"/"+e.userIdEncryption;t+='<a target="_blank" href="'+a+'">'+e.displayUserNick+"</a>"}else{t+='<span class="tm-review-usernick">'+e.displayUserNick+"</span>"}}else{if(e.displayUserNick.indexOf("***")===-1){var r=e.displayUserNick.substring(e.displayUserNick.length-1),i=e.displayUserNick.substring(0,1);t+=i+"***"+r+"<span>\uff08\u533f\u540d\uff09</span>"}else{t+=e.displayUserNick.replace("***","<span>***</span>")+"<span>\uff08\u533f\u540d\uff09</span>"}}t+="</div>";var s="";if(e.goldUser){s+='<p class="gold-user">\u8d85\u7ea7\u4f1a\u5458</p>'}s+=this.renderRateIcon(e);if(s){t+='<div class="rate-user-grade">'+s+"</div>"}if(e.attributes&&e.attributes.indexOf("giftBillId")>-1){t+='<div class="rate-gift">\u83b7\u8ba4\u771f\u8bc4\u4ef7\u5956<s></s></div>'}return t};h.renderRateIcon=function(e){var t=e.displayRateSum;if(t<4||!e.displayRatePic){return""}var a=[0,4,11,41,91,151,251,501,1001,2001,5001,10001,20001,50001,100001,200001,500001,1000001,2000001,5000001,10000001];var r=[0,0];var i=0;while(i<a.length&&t>=a[i]){r[0]=a[i];++i;r[1]=a[i]}--i;if(!r[1]){r.pop();r[0]+="\u4ee5\u4e0a"}else{r[1]=r[1]-1+"\u4e2a"}var s='<img title="'+r.join(" - ")+'\u4e70\u5bb6\u4fe1\u7528\u79ef\u5206" src="//assets.alicdn.com/sys/common/icon/rank_s/'+e.displayRatePic+'" />';if(e.displayUserNumId&&m&&e.userIdEncryption){var n="//my."+(this.config.daily?"daily.taobao.net":"taobao.com")+"/"+e.userIdEncryption;s='<a target="_blank" href="'+n+'">'+s+"</a>"}return s};h.renderToolbar=function(){var t=e.now();var a='<span class="rate-filter">';a+='<input class="rate-list-all rate-radio-group" id="J_RateWithFilterall'+t+'" type="radio" name="radiogrounp" checked /><label for="J_RateWithFilterall'+t+'">\u5168\u90e8</label>';a+='<input class="rate-list-append rate-radio-group" id="J_RateWithAppend'+t+'" type="radio" name="radiogrounp" /><label for="J_RateWithAppend'+t+'">\u8ffd\u8bc4</label>';a+='<input class="rate-list-picture rate-radio-group" id="J_RateWithPicture'+t+'" type="radio" name="radiogrounp" /><label for="J_RateWithPicture'+t+'">\u56fe\u7247</label>';a+="</span>";a+='<span class="rate-chat-btn" style="display: none;"><input class="rate-list-chat rate-radio-group" id="J_ReviewChat'+t+'" type="radio" name="radiogrounp" /><label for="J_ReviewChat'+t+'">\u4e00\u8d77\u901b</label></span>';a+='<span class="tm-toolbar-lft">';a+='<span class="tm-rate-addin"></span>';a+='<input class="rate-list-hascontent" id="J_RateWithContent'+t+'" type="checkbox" name="content" checked /><label for="J_RateWithContent'+t+'">\u6709\u5185\u5bb9</label>';a+='<div class="rate-sort "></div>';a+="</span>";return a};h.renderOneTag=function(e,t){var a=this;return'<span class="tag-'+(e.posi?"posi":"neg")+'"><a id="ratetag'+t+"_"+e.id+(e.posi?"a":"b")+'" href="#" data-posi="'+(e.posi?"1":"-1")+'" data-id="'+e.id+'">'+e.tag+"("+e.count+")"+(a.config.tagInput?"<i></i>":"")+"<s></s></a></span>"};h.renderTags=function(r){if(!e.isPlainObject(r)||!r.tags){return}var i=this;if(i.config.rateCloudDisable)return;var s=r.tags;i.mm("6.2.1");i.mm("4.1.1");i.renderPersentInfo(s.innerTagCloudList);var n=s.tagClouds;if(!e.isArray(n)||0===n.length){return}var l=[];var o=[];var d=e.guid();e.each(n,function(e,t){var a=i.renderOneTag(e,d);e.posi?o.push(a):l.push(a)});var u=o.slice(0,6).join("")+l.slice(0,1).join("");var v=o.join("")+l.join("");var f=t.create('<div class="rate-tag-box"></div>',{html:'<div class="rate-tag-label"><span>\u5927\u5bb6\u90fd\u5199\u5230</span></div>'+'<div class="rate-tag-list"><div class="rate-tag-inner">'+v+"</div></div>"+'<span class="rate-tag-toggle" title="\u663e\u793a\u6240\u6709\u4fe1\u606f"></span>'});var p=t.get("div.rate-tag-list",f);var g=t.get("div.rate-tag-inner",f);var h=false;var m=t.get("span.rate-tag-toggle",f);a.on(m,"click",function(){var e=i.curTagEl?i.curTagEl.id:"";var r=i.curTagEl?t.outerHTML(i.curTagEl.parentNode):"";g.innerHTML=h?v:u;if(e){var s=t.get("#"+e);if(!s){s=t.create(r);t.prepend(s,g);s=t.get("a",s)}else{if(!h&&t.offset(s.parentNode).top>t.offset(g).top+t.outerHeight(g)){t.prepend(s.parentNode,g)}}a.fire(s,"click")}t.height(p,h?t.outerHeight(g):70);t[h?"addClass":"removeClass"](this,"rate-tag-toggle-expand");h=!h});a.on(g,"click",function(a){a.halt();var r=a.target;if(i.config.tagInput&&"I"===r.nodeName){var s=t.parent(t.parent(r));var n=i.getCurTextArea(false);var l={html:t.outerHTML(s),startNode:s,endNode:n};var o=new c(l);o.start(function(){var a=n.value;var r=t.text(s);var l=r.indexOf("(")?r.split("(")[0]:r;t.val(n,a+l);e.log(i.getCurTextArea())})}if("A"!==r.nodeName){return}var d="1"===t.attr(r,"data-posi");var u="";var v="";i.resetQueryvars();i.clearUISelectStyle("tag");t.removeClass(i.curTagEl,"selected");if(i.curTagEl!==r){t.addClass(r,"selected");i.curTagEl=r;u=d?1:-1;v=t.attr(r,"data-id");i.queryvars.append=0}else{i.curTagEl=null}i.queryvars.tagId=v;i.queryvars.posi=u;i.mm(d?"4.1.2":"4.1.3");i.mm(d?"6.2.4":"6.2.3");i.request()});t.addClass(i.headerEl,"rate-header-tags");i.headerEl.appendChild(f);if(t.outerHeight(g)>70||o.length+l.length>7){m.style.visibility="visible"}a.fire(m,"click")};h.renderPersentInfo=function(r){if(this.config.rateSubjectDisable)return;codeTrack("detail-review.listMz.renderPersentInfo","detail-review.listMz.init");if(!e.isArray(r)||!r.length||this.config.hasCompose){return}var i="";var s=0;var n=function(e,t){return t.proportion-e.proportion};var l=this;e.each(r,function(t,a){var r=t.total;var l=t.tagScaleList;var o={};s+=r;e.each(e.clone(l).sort(n),function(e,t){o[e.scale]=t});i+='<div class="rate-theme rate-theme-'+a+'"><h5>'+t.dimenName+"\uff1a</h5><ol>";var c=t.id;e.each(l,function(e){if(!e.count){return}var t=e.scale;var a=o[t];var r=t+":"+e.proportion+"%";var s="theme-opt-"+a;var n="width:"+e.proportion+"%";var l=a?"&nbsp;":e.proportion+"%";var c='<div class="theme-field theme-field-'+e.index+'" data-id="'+this.id+'" data-index="'+e.index+'"><div class="upf"><div class="stag"></div></div><div class="middlef"></div><div class="downf"></div></div>';i+='<li title="'+r+'" class="'+s+'" style="'+n+'">'+c+"<s></s><span>"+t+"</span>"+l+"</li>"},{id:t.id});i+="</ol></div>"});if(20>s){return}this.subjectEl.innerHTML='<h4>\u5927\u5bb6\u8ba4\u4e3a</h4><div class="rate-theme-list">'+i+"</div>";this.subjectEl.style.display="block";e.each(t.query("ol",this.subjectEl),function(a){e.each(t.query("li",a).reverse(),function(e,a){var r=t.get("s",e);var i=t.get("span",e);var s=t.outerWidth(e);t.css(r,"left",(s-t.outerWidth(r))/2);var n=t.outerWidth(i);var l=(s-n)/2;var o=n+l-s;if(a&&o>0){o-=parseFloat(t.css(t.get("span",t.next(e)),"left"),10)-6;if(o>0){l-=o}}t.css(i,"left",l)})});e.each(t.query("ol",this.subjectEl),function(r){var i=t.query("li",r);e.each(i.reverse(),function(r,i){var s=t.outerWidth(t.get("span",r)),n=t.outerWidth(r);var o=t.get("div",r);if(s>n){t.css(o,"width",s);t.addClass(o,"addcolor");var c=t.get(".middlef",o);if(i==0){t.css(c,"width",s-n-1);t.css(c,"margin-left",n+1)}if(i==this.lislen-1){t.css(c,"width",s-n-1);t.css(c,"margin-right",n+1)}}a.on(o,"mouseenter",function(e){t.addClass(o,"hover")});a.on(o,"mouseleave",function(e){if(!t.hasClass(o,"select")){t.removeClass(o,"hover")}});a.on(o,"click",function(a){l.resetQueryvars();l.clearUISelectStyle("alltheme");if(t.hasClass(o,"select")){t.removeClass(o,"select");l.request()}else{var r=e.filter(t.query(".theme-field"),function(e){return e!==o});t.removeClass(r,"select hover");t.addClass(o,"select");l.queryvars["itemPropertyId"]=t.attr(o,"data-id");l.queryvars["itemPropertyIndex"]=t.attr(o,"data-index");l.request()}})},{lislen:i.length})})};h.initPhotos=function(){codeTrack("detail-review.listMz.initPhotos","detail-review.listMz.init");var r=this;var i=t.query(".tm-m-photos",r.el);e.each(i,function(e,r){a.on(e,"click",function(r){if(r.target.tagName.toUpperCase()=="IMG"){a.detach(e,"click");l.run(e,t.query(r.target))}})})};h.initListEvents=function(){var e=this;a.on(t.query("a",e.pageEl),"click",function(a){a.halt();e.mm("6.2.5");var r=t.attr(this,"data-page")||this.innerHTML;if(r){e.queryvars.currentPage=r;e.request(function(a){t.scrollTop(t.offset(e.toolbarEl).top-50)})}});e.initPhotos()};h.detachEvents=function(){a.detach(t.query("a",this.pageEl),"click")};function C(e){return e.replace(/(\\n|\\r)+/g,"<br/>")}h.saveCurTagToLocal=function(e){if(h.LocalStorage&&e){h.LocalStorage.setItem("tml-rate-option",parseInt(e))}};h.showCurTagControl=function(){var e=this;if(h.LocalStorage){return h.LocalStorage.getItem("tml-rate-option")}else if(e.config["inBucket"]){return 3}else{return null}};h.updateSortTag=function(a,r,i){var s=this;s.queryvars.order=a;s.queryvars.currentPage=1;s.request(function(t){e.isFunction(s.config.onPaint)&&s.config.onPaint(t)});e.isFunction(s.saveCurTagToLocal)&&s.saveCurTagToLocal(s.queryvars.order);t.removeClass(r,"active");t.addClass(r[a-1],"active");s.mm(i[t.attr(r[a-1],"data-value")])};h.getCurTextArea=function(e){var r=this;if(!r.config.tagInput)return;if(e){var i=function(){function e(e){var a=arguments.callee;var i=t.query("textarea",r.composeEl);if(!i.length){setTimeout(function(){a(e)},200)}else{e(i)}}e(function(e){a.on(e,"focus blur",function(e){b=t.get(this)})})};i()}return b};h.formatDate=function(e){if(!e)return;var t=e.substr(0,10).replace(/-/g,".");if(t===this.serverTime){t="\u4eca\u5929"}else if(t.indexOf(this.serverYearStr)>-1){t=t.substr(5)}return t};h.renderStructureList=function(a){var r=this;r.chartsHTML=t.get(".rate-charts",r.el);codeTrack("detail-review.listMz.renderStructureList","detail-review.listMz.init");var i=a.tags.structuredRateStatisticList;var s;if(i.length>0){s=e.map(i,function(t){e.each(t.optionList,function(t,a){e.mix(t,{proportion:t.percentage,scale:t.name,index:a})});return{tagScaleList:t.optionList,dimenName:t.label}});if(s.length===0){return}else if(s.length>2){s=s.slice(0,2)}r.chartsHTML.innerHTML='<div class="rate-charts-left"></div><div class="rate-charts-right"></div>';if(s.length===1){r.chartsArray=[t.get(".rate-charts-left",r.el)];v.render(r.chartsArray,s)}else if(s.length===2){r.chartsArray=[t.get(".rate-charts-left",r.el),t.get(".rate-charts-right",r.el)];v.render(r.chartsArray,s)}}};h.renderCharts=function(e){codeTrack("detail-review.listMz.renderCharts","detail-review.listMz.init");var a=this;a.chartsHTML=t.get(".rate-charts",a.el);if(e.tags.userTagCloudList&&e.tags.userTagCloudList.length>0){a.chartsHTML.innerHTML='<div class="rate-charts-left"></div><div class="rate-charts-right"></div>';if(e.tags.userTagCloudList.length===1){a.chartsArray=[t.get(".rate-charts-left",a.el)];v.render(a.chartsArray,e.tags.userTagCloudList);var r=a.mappingConfigForSelectBtn(e.tags.userTagCloudList[0]);var i=new f({renderObj:r});t.get(".tm-rate-addin",a.toolbarEl).innerHTML=i.getDomStr();i.render("."+r.contentclass);a.filter0=i}else if(e.tags.userTagCloudList&&e.tags.userTagCloudList.length===2){a.chartsArray=[t.get(".rate-charts-left",a.el),t.get(".rate-charts-right",a.el)];v.render(a.chartsArray,e.tags.userTagCloudList);var r=a.mappingConfigForSelectBtn(e.tags.userTagCloudList[0]);var s=new f({renderObj:r});var n=a.mappingConfigForSelectBtn(e.tags.userTagCloudList[1]);var l=new f({renderObj:n});t.get(".tm-rate-addin",a.toolbarEl).innerHTML=s.getDomStr()+l.getDomStr();s.render("."+r.contentclass);a.filter0=s;l.render("."+n.contentclass);a.filter1=l}else{}}a.filterListenning()};h.renderNewCharts=function(r){if(!e.isPlainObject(r)){return false}codeTrack("detail-review.listMz.renderNewCharts","detail-review.listMz.init");var i=this;var s=r.rateDetail.structuredRateStatisticList;if(!e.isArray(s)||0===s.length){return false}var n="";var l;var o;var c;for(var d=0;d<s.length;d++){if(d<3&&s[d].optionList.length>3){l="rate-barcharts-box-two-row";o=s.length>2?true:false;c=d>1?"hide":""}else{l="rate-barcharts-box-three-row";o=s.length>3?true:false;c=d>2?"hide":""}n+='<div class="rate-barchart '+c+'"></div>'}var u;var v;var f;if(t.get(".rate-barcharts-box")){v=false;barchartsInnerEl=t.get(".rate-barcharts-box .inner");t.html(barchartsInnerEl,n);t.css(barchartsInnerEl,{overflow:"hidden",height:"140px"})}else{v=true;f=r.rateDetail.logisticTimeCost==""?"":"\u7269\u6d41\u5e73\u5747<em>"+r.rateDetail.logisticTimeCost+'</em>\u5230<span class="ps">\uff08\u6839\u636e\u5e97\u94fa\u53d1\u8d27\u53ca\u7269\u6d41\u60c5\u51b5\u7edf\u8ba1\uff09</span>';u=t.create('<div class="rate-barcharts-box '+l+'"><div class="rate-location">\u81f3<div class="location-select"></div>'+f+'</div><div class="inner clearfix">'+n+'</div><div class="more">\u66f4\u591a</div></div>');i.headerEl.appendChild(u);barchartsInnerEl=t.get(".rate-barcharts-box .inner");i.renderSelect(r.rateDetail.locationList,t.get(".location-select"))}var g=t.get(".rate-barcharts-box .more");var h=t.query(".rate-barchart");t.addClass(i.headerEl,"rate-header-barcharts");p.render(h,s,i);if(!o){t.hide(g)}else{t.css(t.query(".rate-barcharts-box .hide"),{visibility:"hidden"})}var m=t.query(".rate-barcharts-box .hide");a.on(g,"click",function(){if(!v)return false;if(t.hasClass(this,"more-all")){t.removeClass(this,"more-all");t.css(t.query(".rate-barcharts-box .hide"),{visibility:"hidden"});t.css(barchartsInnerEl,{overflow:"hidden",height:"140px"})}else{t.addClass(this,"more-all");t.css(t.query(".rate-barcharts-box .hide"),{visibility:"visible"});t.css(barchartsInnerEl,{overflow:"visible",height:"auto"})}})};h.renderSelect=function(r,i){var s=this;var n="";codeTrack("detail-review.listMz.renderSelect","detail-review.listMz.init");e.each(r,function(e,t){var a="";if(t==0){a="selected"}n+='<li class="'+a+'">'+e+"</li>"});var l='<span class="location-current">'+r[0]+"</span>"+'<ul class="locationlist">'+n+"</ul>";t.html(i,l);a.on(i,"mouseenter",function(e){t.addClass(i,"open")});a.on(i,"mouseleave",function(e){t.removeClass(i,"open")});a.on(t.query("li",i),"click",function(a){u.gm("1.28");t.text(t.get(".location-current"),t.text(this));t.removeClass(t.query("li",i),"selected");t.addClass(this,"selected");t.removeClass(i,"open");s.resetQueryvars();s.clearUISelectStyle("newcharts");s.queryvars.location=t.text(this);s.requestNewChart(e.bind(s.renderNewCharts,s),t.text(this))})};h.filterListenning=function(){var t=this;codeTrack("detail-review.listMz.filterListenning","detail-review.listMz.init");if(t.filter0){var a=t.filter0.get("renderObj");for(var r=0;r<a.list.length;r++){t.filter0.on(a.list[r].eventval,function(a){e.log(a.data);t.resetQueryvars();t.clearUISelectStyle("chart0");t.queryvars[a.type.split(";")[0].split("_")[0]]=a.type.split(";")[0].split("_")[1];t.queryvars[a.type.split(";")[1].split("_")[0]]=a.type.split(";")[1].split("_")[1];t.sendgm(a.type.split(";")[0].split("_")[1]);t.request()})}}if(t.filter1){var i=t.filter1.get("renderObj");for(var r=0;r<i.list.length;r++){t.filter1.on(i.list[r].eventval,function(a){e.log(a.data);t.resetQueryvars();t.clearUISelectStyle("chart1");t.queryvars[a.type.split(";")[0].split("_")[0]]=a.type.split(";")[0].split("_")[1];t.queryvars[a.type.split(";")[1].split("_")[0]]=a.type.split(";")[1].split("_")[1];t.sendgm(a.type.split(";")[0].split("_")[1]);t.request()})}}};h.mappingConfigForSelectBtn=function(t){if(!e.isPlainObject(t))return;var a;var r;if(t.id===25){a="tm-rate-skin";r="\u5168\u90e8\u80a4\u8d28"}else if(t.id===26){a="tm-rate-age";r="\u5168\u90e8\u5e74\u9f84"}else if(t.id===27){a="tm-rate-hair";r="\u5168\u90e8\u53d1\u8d28"}else{a="tm-rate-sort"}var i=new Array(t.tagScaleList.length+1);i[0]={text:r,eventval:"userPropertyId_;userPropertyIndex_",postfixclass:"default",dataobjstr:'{userPropertyId:"",userPropertyIndex:""}'};for(var s=0;s<t.tagScaleList.length;s++){i[s+1]={text:t.tagScaleList[s].scale,eventval:"userPropertyId_"+t.id+";userPropertyIndex_"+t.tagScaleList[s].index,postfixclass:"superstarwulin",dataobjstr:'{userPropertyId:"",userPropertyIndex:""}'}}var n={defaulttext:r,contentclass:a,list:i};return n};h.sendgm=function(e){var t=e-0;switch(t){case 25:u.gm("8.2.6");break;case 26:u.gm("8.2.5");break;default:}};h.renderChatWindow=function(e,a){var r=a.itemId||"";var i=a.daily;if(!e){t.remove("#J_chat_online_tip");g.config({container:".rate-chat",itemId:r,isDaily:i})}this.isChatWindowShow=true;t.show(this.chatEl);t.hide(this.gridEl);t.hide(this.pageEl)};return h},{requires:["dom","event","ajax","anim","xtemplate","ua","mui/detail-review/mallphotos","mui/detail-review/localstorage","mui/detail-review/fly","mui/detail-review/tryreport","mui/detail-review/util","mui/detail-review/charts","mui/detail-review/selectbtn","mui/detail-review/newcharts","mui/tribechat/base","mui/detail-review/css/listmz.css","mui/detail-review/css/tag.css","mui/detail-review/css/mallphotos.css"]});